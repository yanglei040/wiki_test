{
    "hands_on_practices": [
        {
            "introduction": "粒子输运模拟的基石在于量化粒子与物质相互作用的可能性。本练习将针对这一领域提供基础实践。你将通过综合一种复合材料的基本微观数据，计算出决定粒子行程的基本参数——宏观截面和平均自由程，这是任何模拟设置中至关重要的第一步。",
            "id": "3535412",
            "problem": "能量为 $E = 14\\,\\mathrm{MeV}$ 的单能中子束穿过一种均匀聚合物，该聚合物被建模为化学式为 $\\mathrm{CH_2}$ 的聚乙烯。在此能量下，相互作用被认为通过四种独立的过程发生：与氢的弹性散射、与氢的辐射俘获、与碳的弹性散射以及与碳的非弹性散射。该材料的特征是数密度为 $n_{\\mathrm{H}} = 8.08 \\times 10^{22}\\,\\mathrm{cm^{-3}}$ 和 $n_{\\mathrm{C}} = 4.04 \\times 10^{22}\\,\\mathrm{cm^{-3}}$。在 $E = 14\\,\\mathrm{MeV}$ 时，微观截面在自由飞行步长内被认为是恒定的，其值为 $\\sigma_{\\mathrm{H,el}} = 2.7\\,\\mathrm{b}$、$\\sigma_{\\mathrm{H,cap}} = 5.0 \\times 10^{-4}\\,\\mathrm{b}$、$\\sigma_{\\mathrm{C,el}} = 1.3\\,\\mathrm{b}$ 和 $\\sigma_{\\mathrm{C,inel}} = 0.9\\,\\mathrm{b}$，其中 $1\\,\\mathrm{b} = 10^{-24}\\,\\mathrm{cm^2}$。\n\n仅使用微观截面、数密度和单位程长相互作用概率的基本定义，计算：\n- 总宏观截面 $\\Sigma_{t}(E)$，\n- 平均自由程 $\\lambda(E)$，\n- 以及下一次相互作用是弹性散射（与任意一种核素）的概率。\n\n将您的结果四舍五入到四位有效数字。$\\Sigma_{t}$ 以 $\\mathrm{cm^{-1}}$ 表示，$\\lambda$ 以 $\\mathrm{cm}$ 表示，概率以纯小数（无量纲）表示。",
            "solution": "首先对问题进行验证，以确保其科学上合理、内容自洽且适定。\n\n**步骤1：提取已知条件**\n- 中子束能量：$E = 14\\,\\mathrm{MeV}$\n- 材料成分：聚乙烯，$\\mathrm{CH_2}$\n- 氢数密度：$n_{\\mathrm{H}} = 8.08 \\times 10^{22}\\,\\mathrm{cm^{-3}}$\n- 碳数密度：$n_{\\mathrm{C}} = 4.04 \\times 10^{22}\\,\\mathrm{cm^{-3}}$\n- 与氢发生弹性散射的微观截面：$\\sigma_{\\mathrm{H,el}} = 2.7\\,\\mathrm{b}$\n- 与氢发生辐射俘获的微观截面：$\\sigma_{\\mathrm{H,cap}} = 5.0 \\times 10^{-4}\\,\\mathrm{b}$\n- 与碳发生弹性散射的微观截面：$\\sigma_{\\mathrm{C,el}} = 1.3\\,\\mathrm{b}$\n- 与碳发生非弹性散射的微观截面：$\\sigma_{\\mathrm{C,inel}} = 0.9\\,\\mathrm{b}$\n- 转换因子：$1\\,\\mathrm{b} = 10^{-24}\\,\\mathrm{cm^2}$\n- 需要计算的量：总宏观截面 $\\Sigma_{t}$、平均自由程 $\\lambda$ 和弹性散射概率 $P_{\\mathrm{el}}$。\n- 四舍五入要求：四位有效数字。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据**：该问题涉及中子输运理论的基本概念，即宏观截面、微观截面和平均自由程。这些是核物理与核工程的基石性原理。所提供的在 $14\\,\\mathrm{MeV}$ 下的数密度和截面数值在物理上是合理的。化学计量比 $n_{\\mathrm{H}}/n_{\\mathrm{C}} = (8.08 \\times 10^{22}) / (4.04 \\times 10^{22}) = 2$ 与化学式 $\\mathrm{CH_2}$ 一致。该问题在科学上是合理的。\n- **适定性**：该问题提供了计算所求量所需的所有必要数据和清晰定义。存在唯一、稳定且有意义的解。\n- **客观性**：该问题使用精确的、定量的语言陈述，没有歧义或主观论断。\n\n**步骤3：结论与行动**\n该问题被认为是**有效的**。将基于基本原理推导求解。\n\n**解题推导**\n宏观截面 $\\Sigma$ 表示粒子在材料中单位行程长度内发生相互作用的概率。对于特定的核素种类 $i$ 和相互作用类型 $j$，它被定义为核素的数密度 $n_i$ 与该相互作用的微观截面 $\\sigma_{i,j}$ 的乘积：\n$$\n\\Sigma_{i,j} = n_i \\sigma_{i,j}\n$$\n对于核素混合物，总宏观截面 $\\Sigma_t$ 是对所有组分种类 $i$ 和所有可能的相互作用类型 $j$ 的宏观截面之和：\n$$\n\\Sigma_t = \\sum_i \\sum_j \\Sigma_{i,j} = \\sum_i n_i \\left( \\sum_j \\sigma_{i,j} \\right) = \\sum_i n_i \\sigma_{i,t}\n$$\n其中 $\\sigma_{i,t}$ 是核素种类 $i$ 的总微观截面。\n\n对于给定的聚乙烯材料（$\\mathrm{CH_2}$），核素是氢（$\\mathrm{H}$）和碳（$\\mathrm{C}$）。总宏观截面 $\\Sigma_t$ 是这两种核素贡献的总和：\n$$\n\\Sigma_t = \\Sigma_{\\mathrm{H},t} + \\Sigma_{\\mathrm{C},t}\n$$\n氢和碳的总微观截面分别为：\n$$\n\\sigma_{\\mathrm{H},t} = \\sigma_{\\mathrm{H,el}} + \\sigma_{\\mathrm{H,cap}}\n$$\n$$\n\\sigma_{\\mathrm{C},t} = \\sigma_{\\mathrm{C,el}} + \\sigma_{\\mathrm{C,inel}}\n$$\n综合这些，总宏观截面的表达式为：\n$$\n\\Sigma_t = n_{\\mathrm{H}}(\\sigma_{\\mathrm{H,el}} + \\sigma_{\\mathrm{H,cap}}) + n_{\\mathrm{C}}(\\sigma_{\\mathrm{C,el}} + \\sigma_{\\mathrm{C,inel}})\n$$\n\n**1. 总宏观截面 $\\Sigma_t$ 的计算**\n首先，我们代入以靶恩（$\\mathrm{b}$）为单位的给定微观截面值：\n$$\n\\sigma_{\\mathrm{H},t} = 2.7\\,\\mathrm{b} + 5.0 \\times 10^{-4}\\,\\mathrm{b} = 2.7005\\,\\mathrm{b}\n$$\n$$\n\\sigma_{\\mathrm{C},t} = 1.3\\,\\mathrm{b} + 0.9\\,\\mathrm{b} = 2.2\\,\\mathrm{b}\n$$\n现在，我们使用给定的数密度和转换因子 $1\\,\\mathrm{b} = 10^{-24}\\,\\mathrm{cm^2}$ 计算总宏观截面：\n$$\n\\Sigma_t = (8.08 \\times 10^{22}\\,\\mathrm{cm^{-3}})(2.7005\\,\\mathrm{b} \\times 10^{-24}\\,\\mathrm{cm^2/b}) + (4.04 \\times 10^{22}\\,\\mathrm{cm^{-3}})(2.2\\,\\mathrm{b} \\times 10^{-24}\\,\\mathrm{cm^2/b})\n$$\n$$\n\\Sigma_t = (0.2182004\\,\\mathrm{cm^{-1}}) + (0.08888\\,\\mathrm{cm^{-1}})\n$$\n$$\n\\Sigma_t = 0.3070804\\,\\mathrm{cm^{-1}}\n$$\n四舍五入到四位有效数字，我们得到：\n$$\n\\Sigma_t \\approx 0.3071\\,\\mathrm{cm^{-1}}\n$$\n\n**2. 平均自由程 $\\lambda$ 的计算**\n平均自由程 $\\lambda$ 是粒子在两次相互作用之间行进的平均距离。它被定义为总宏观截面的倒数：\n$$\n\\lambda = \\frac{1}{\\Sigma_t}\n$$\n为保证精度，使用未四舍五入的 $\\Sigma_t$ 值：\n$$\n\\lambda = \\frac{1}{0.3070804\\,\\mathrm{cm^{-1}}} \\approx 3.25646\\,\\mathrm{cm}\n$$\n四舍五入到四位有效数字：\n$$\n\\lambda \\approx 3.256\\,\\mathrm{cm}\n$$\n\n**3. 弹性散射概率的计算**\n在发生一次相互作用的条件下，其为某种特定类型的概率是该类型相互作用的宏观截面与总宏观截面的比值。我们关心的是与氢或碳发生弹性散射的概率。设此概率为 $P_{\\mathrm{el}}$。相应的宏观截面 $\\Sigma_{\\mathrm{el}}$ 是与氢和碳发生弹性散射的宏观截面之和：\n$$\n\\Sigma_{\\mathrm{el}} = \\Sigma_{\\mathrm{H,el}} + \\Sigma_{\\mathrm{C,el}} = n_{\\mathrm{H}}\\sigma_{\\mathrm{H,el}} + n_{\\mathrm{C}}\\sigma_{\\mathrm{C,el}}\n$$\n那么概率为：\n$$\nP_{\\mathrm{el}} = \\frac{\\Sigma_{\\mathrm{el}}}{\\Sigma_t}\n$$\n首先，我们计算 $\\Sigma_{\\mathrm{el}}$：\n$$\n\\Sigma_{\\mathrm{el}} = (8.08 \\times 10^{22}\\,\\mathrm{cm^{-3}})(2.7\\,\\mathrm{b} \\times 10^{-24}\\,\\mathrm{cm^2/b}) + (4.04 \\times 10^{22}\\,\\mathrm{cm^{-3}})(1.3\\,\\mathrm{b} \\times 10^{-24}\\,\\mathrm{cm^2/b})\n$$\n$$\n\\Sigma_{\\mathrm{el}} = (0.21816\\,\\mathrm{cm^{-1}}) + (0.05252\\,\\mathrm{cm^{-1}}) = 0.27068\\,\\mathrm{cm^{-1}}\n$$\n现在我们使用未四舍五入的 $\\Sigma_{\\mathrm{el}}$ 和 $\\Sigma_t$ 的值来计算概率：\n$$\nP_{\\mathrm{el}} = \\frac{0.27068\\,\\mathrm{cm^{-1}}}{0.3070804\\,\\mathrm{cm^{-1}}} \\approx 0.88147\n$$\n四舍五入到四位有效数字，概率为：\n$$\nP_{\\mathrm{el}} \\approx 0.8815\n$$\n\n所求的三个量的最终答案，四舍五入到四位有效数字，分别为 $\\Sigma_{t} = 0.3071\\,\\mathrm{cm^{-1}}$，$\\lambda = 3.256\\,\\mathrm{cm}$ 和 $P_{\\mathrm{el}} = 0.8815$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0.3071 & 3.256 & 0.8815 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "真实世界的情景通常涉及复杂的非均匀材料，这给模拟带来了挑战。本练习将介绍虚碰撞方法 (null-collision method)，这是一种强大而巧妙的蒙特卡罗技术，用于处理此类非均匀介质。通过实现该算法，你将获得处理高级工具的实践经验，这对于在实际探测器或屏蔽几何中精确建模粒子路径至关重要。",
            "id": "3535387",
            "problem": "您需要从第一性原理出发，推导并实现一个完整、可运行的程序，用于模拟一个能量为 $E$ 的光子在空间非均匀一维板状介质中沿直线传播时的下一个相互作用事件。光子从板状几何结构 $x \\in [0,L]$ 内的位置 $x_0$ 开始，沿着 $x$ 轴以方向 $\\hat{u} \\in \\{+1,-1\\}$ 传播。三种过程 $k \\in \\{\\text{光电效应}, \\text{康普顿散射}, \\text{电子对生成}\\}$ 的局域宏观反应截面 $\\Sigma_k(E,x)$ 是位置和能量的已知函数。您必须设计并论证一个鲁棒的算法，以便在这种非均匀介质中，根据光子的当前状态，对下一个反应类型和相应的自由程长度进行抽样。\n\n请从以下基本原理开始您的论证：\n- 比尔-朗伯衰减定律和宏观截面的定义：在总宏观截面为 $\\Sigma_t(E)$ 的均匀区域中，到下一次相互作用的自由程 $s$ 呈指数分布，其概率密度为 $p(s) = \\Sigma_t(E)\\,\\exp\\!\\left(-\\Sigma_t(E)\\,s\\right)$（$s \\ge 0$），在程长为 $s$ 的路径上的存活概率为 $\\exp\\!\\left(-\\Sigma_t(E)\\,s\\right)$。\n- 在空间非均匀介质中，到达距离 $s$ 处的存活概率为 $\\exp\\!\\left(-\\int_0^s \\Sigma_t\\!\\left(E, x(s')\\right)\\,\\mathrm{d}s'\\right)$，其中 $\\Sigma_t = \\Sigma_{\\text{光电效应}} + \\Sigma_{\\text{康普顿}} + \\Sigma_{\\text{电子对}}$，而 $x(s')$ 是由程长 $s'$ 参数化的光子路径上的位置。\n- 在一个相互作用点，反应道的选择由局域概率 $p_k(E,x) = \\Sigma_k(E,x)/\\Sigma_t(E,x)$ 决定。\n\n您的算法必须对 $\\Sigma_t(E,x)$ 的强空间变化具有鲁棒性，并且必须能正确处理光子从板中逃逸的边界情况。推导过程应清楚地说明如何在不对 $\\Sigma_t(E,x)$ 的非平凡线积分求逆的情况下抽样自由程，并解释为何该方法是无偏的。您还必须论证在一个已实现的相互作用点处，反应类型是如何被抽样的。算法的终止条件是：抽样到一个真实的相互作用并指定反应类型，或者确定光子在发生任何真实相互作用之前逃离了板。\n\n为便于测试，请对范围为 $x \\in [0,L]$（其中 $L$ 的单位为 $\\mathrm{cm}$）的非均匀板，以及单位为 $\\mathrm{cm}^{-1}$ 的宏观截面，使用以下科学上合理且自洽的定义。定义电子静止质量能量为 $m_e c^2 = 0.511\\,\\mathrm{MeV}$，电子对生成阈值为 $E_{\\text{th}} = 2 m_e c^2 = 1.022\\,\\mathrm{MeV}$。使用参考能量 $E_{\\text{ref}} = 0.5\\,\\mathrm{MeV}$。设基准系数为 $a_0 = 2.0\\,\\mathrm{cm}^{-1}$，$b_0 = 0.2\\,\\mathrm{cm}^{-1}$ 和 $c_0 = 0.5\\,\\mathrm{cm}^{-1}$。宏观截面为：\n- $\\Sigma_{\\text{光电效应}}(E,x) = a_0 \\left(\\dfrac{E_{\\text{ref}}}{E}\\right)^3 \\left(1 + 0.5 \\sin\\!\\left(\\dfrac{\\pi x}{L}\\right)\\right)$,\n- $\\Sigma_{\\text{康普顿}}(E,x) = b_0 \\left(1 + 0.3 \\cos\\!\\left(\\dfrac{\\pi x}{L}\\right)\\right)$,\n- $\\Sigma_{\\text{电子对生成}}(E,x) = \\begin{cases} 0, & E < E_{\\text{th}} \\\\ c_0 \\left(1 - \\dfrac{E_{\\text{th}}}{E}\\right)\\left(1 + 0.2\\,e^{-x/L}\\right), & E \\ge E_{\\text{th}} \\end{cases}$\n\n设总宏观截面为 $\\Sigma_t(E,x) = \\Sigma_{\\text{光电效应}}(E,x) + \\Sigma_{\\text{康普顿}}(E,x) + \\Sigma_{\\text{电子对生成}}(E,x)$。为了在非均匀介质中实现鲁棒的自由程抽样，您必须构造一个恒定的控制截面 $\\Sigma_M(E)$，使得对于所有 $x \\in [0,L]$，都有 $\\Sigma_t(E,x) \\le \\Sigma_M(E)$。利用上述定义中的有界因子，一个有效的控制截面是：\n$$\n\\Sigma_M(E) = a_0 \\left(\\dfrac{E_{\\text{ref}}}{E}\\right)^3 \\left(1 + 0.5\\right)\n+ b_0 \\left(1 + 0.3\\right)\n+ \\begin{cases}\n0, & E < E_{\\text{th}} \\\\\nc_0 \\left(1 - \\dfrac{E_{\\text{th}}}{E}\\right)\\left(1 + 0.2\\right), & E \\ge E_{\\text{th}}\n\\end{cases}\n$$\n\n您必须实现以下计算情景：\n- 几何结构：一维板 $x \\in [0,L]$，其中 $L = 10.0\\,\\mathrm{cm}$。\n- 光子状态：初始位置 $x_0$ 和方向 $\\hat{u} \\in \\{+1,-1\\}$；程长 $s$ 沿着射线 $x(s) = x_0 + \\hat{u}\\,s$ 累积。\n- 终止条件：如果光子在发生任何真实相互作用之前会穿过边界，则宣布为逃逸，并输出从起始位置到边界的程长。\n\n输出的反应类型编码必须为：光电效应 $\\to 1$，康普顿散射 $\\to 2$，电子对生成 $\\to 3$，无相互作用的逃逸 $\\to 0$。\n\n随机性与可复现性：\n- 使用以固定种子 $12345$ 初始化的伪随机数生成器。\n- 您的算法所需的所有随机变量都必须从 $[0,1)$ 上的均匀分布中抽样。\n\n物理单位与数值输出：\n- 以 $\\mathrm{cm}$ 为单位将自由程表示为浮点数。\n- 反应类型必须是如上指定的整数代码。\n\n测试套件：\n- 案例 1：$E = 0.5\\,\\mathrm{MeV}$，$x_0 = 0.0\\,\\mathrm{cm}$，$\\hat{u} = +1$，$L = 10.0\\,\\mathrm{cm}$。\n- 案例 2：$E = 2.5\\,\\mathrm{MeV}$，$x_0 = 9.8\\,\\mathrm{cm}$，$\\hat{u} = +1$，$L = 10.0\\,\\mathrm{cm}$。\n- 案例 3：$E = 1.022\\,\\mathrm{MeV}$，$x_0 = 5.0\\,\\mathrm{cm}$，$\\hat{u} = -1$，$L = 10.0\\,\\mathrm{cm}$。\n\n您的程序必须实现一个鲁棒的非均匀自由程抽样和反应选择算法，并生成单行输出，其中包含一个方括号括起来的逗号分隔列表，每个测试案例由一个二元列表 $[\\text{代码}, \\text{自由程(cm)}]$ 总结。具体来说，最终输出必须具有确切的格式：\n$$\n\\texttt{[[code\\_1,freepath\\_1],[code\\_2,freepath\\_2],[code\\_3,freepath\\_3]]}\n$$\n其中每个 $\\texttt{code\\_i}$ 是一个整数，每个 $\\texttt{freepath\\_i}$ 是一个以 $\\mathrm{cm}$ 为单位的浮点数。",
            "solution": "在物质中传播的光子会经历由宏观反应截面决定的随机相互作用。在总宏观截面为 $\\Sigma_t(E)$ 的均匀介质中，自由程 $s$ 呈指数分布，其概率密度为 $p(s) = \\Sigma_t(E)\\,e^{-\\Sigma_t(E)\\,s}$（$s \\ge 0$），到达距离 $s$ 处的存活概率为 $S(s) = e^{-\\Sigma_t(E)\\,s}$。在总宏观截面依赖于位置的非均匀介质中，存活概率推广为\n$$\nS(s) = \\exp\\!\\left(-\\int_0^s \\Sigma_t\\!\\left(E, x(s')\\right)\\,\\mathrm{d}s'\\right),\n$$\n其中 $x(s) = x_0 + \\hat{u}\\,s$ 是一维直线轨迹。\n\n当 $\\Sigma_t(E,x)$ 随位置发生非平凡变化时，直接对 $S(s)$ 求逆以抽样 $s$ 通常是难以处理的。一个鲁棒的方法是虚碰撞法（也称为 Woodcock 追踪法），它依赖于泊松细化。其思想是用一个恒定的控制率 $\\Sigma_M(E) \\ge \\Sigma_t(E,x)$（对于域中所有位置 $x$）来包络空间变化的相互作用率。然后，通过从一个率为 $\\Sigma_M(E)$ 的均匀泊松过程中抽样潜在相互作用，并以事件发生位置处的接受概率 $\\Sigma_t(E,x)/\\Sigma_M(E)$ 接受每个潜在事件为真实事件，来获得真实相互作用；否则，该事件被视为一次虚碰撞，除了粒子沿路径的位置外，其状态保持不变。\n\n为了论证其正确性，我们考虑一个关于程长的、率为 $\\Sigma_M(E)$ 的均匀泊松过程。在程长 $s$ 处的第一个提议事件被接受为真实事件的概率是\n$$\n\\left[\\Sigma_M(E)\\,e^{-\\Sigma_M(E)\\,s}\\,\\mathrm{d}s\\right] \\times \\left[\\frac{\\Sigma_t(E,x(s))}{\\Sigma_M(E)}\\right] = \\Sigma_t(E,x(s))\\,e^{-\\Sigma_M(E)\\,s}\\,\\mathrm{d}s.\n$$\n考虑到先前可能发生虚碰撞，路径上第一个真实事件的分布具有概率密度\n$$\np_{\\text{real}}(s) = \\Sigma_t(E,x(s))\\,\\exp\\!\\left(-\\int_0^s \\Sigma_t(E,x(s'))\\,\\mathrm{d}s'\\right),\n$$\n这正是一个率为 $\\Sigma_t(E,x(s))$ 的非均匀泊松过程中第一个事件的风险率表征。这与非均匀情况下的存活概率 $S(s)$ 一致，从而证明了虚碰撞方法能够对到第一次真实相互作用的自由程进行无偏抽样。\n\n算法设计：\n- 预计算在整个板上界定 $\\Sigma_t(E,x)$ 的恒定控制截面 $\\Sigma_M(E)$。根据给定的函数形式，有界因子在 $\\sin(\\cdot) = 1$、$\\cos(\\cdot) = 1$ 和 $e^{-x/L} \\le 1$ 时达到最大值，从而得出：\n$$\n\\Sigma_M(E) = a_0 \\left(\\frac{E_{\\text{ref}}}{E}\\right)^3 \\left(1 + 0.5\\right)\n+ b_0 \\left(1 + 0.3\\right)\n+ \\begin{cases}\n0, & E < E_{\\text{th}} \\\\\nc_0 \\left(1 - \\dfrac{E_{\\text{th}}}{E}\\right)\\left(1 + 0.2\\right), & E \\ge E_{\\text{th}}\n\\end{cases}\n$$\n这确保了对于所有 $x \\in [0,L]$ 都有 $\\Sigma_t(E,x) \\le \\Sigma_M(E)$。\n\n- 将光子初始化在位置 $x_0$，方向为 $\\hat{u} \\in \\{+1,-1\\}$，并设置累积程长 $s_{\\text{tot}} = 0$。\n\n- 迭代：\n  1. 通过逆变换采样，从率为 $\\Sigma_M(E)$ 的指数分布中抽样一个提议的自由程增量 $s_{\\Delta}$：$s_{\\Delta} = -\\ln(U)/\\Sigma_M(E)$，其中 $U \\sim \\mathcal{U}[0,1)$。\n  2. 从当前位置 $x$ 沿方向 $\\hat{u}$ 计算到最近边界的距离：\n     $$\n     d_{\\text{exit}} = \\begin{cases}\n     L - x, & \\hat{u} = +1,\\\\\n     x, & \\hat{u} = -1.\n     \\end{cases}\n     $$\n     如果 $s_{\\Delta} > d_{\\text{exit}}$，光子在发生任何潜在事件之前逃逸；记录为一次逃逸，反应代码为 $0$，自由程为 $s_{\\text{tot}} + d_{\\text{exit}}$（单位 cm），然后终止。\n  3. 否则，前进到 $x \\leftarrow x + \\hat{u}\\,s_{\\Delta}$ 并累积 $s_{\\text{tot}} \\leftarrow s_{\\text{tot}} + s_{\\Delta}$。\n  4. 计算在 $(E,x)$ 处的局域宏观截面：\n     $$\n     \\Sigma_{\\text{光电效应}}(E,x),\\quad\n     \\Sigma_{\\text{康普顿}}(E,x),\\quad\n     \\Sigma_{\\text{电子对生成}}(E,x).\n     $$\n     通过求和得到总截面 $\\Sigma_t(E,x)$。\n  5. 以概率 $p_{\\text{acc}} = \\Sigma_t(E,x)/\\Sigma_M(E)$ 接受此事件为真实相互作用。抽取 $U' \\sim \\mathcal{U}[0,1)$。如果 $U' > p_{\\text{acc}}$，则将其视为虚碰撞并返回步骤 1。\n  6. 如果被接受，则根据 $p_k(E,x) = \\Sigma_k(E,x)/\\Sigma_t(E,x)$ 划分单位区间来选择反应类型。抽取 $U'' \\sim \\mathcal{U}[0,1)$ 并选择：\n     $$\n     \\text{光电效应，如果 } U'' < p_{\\text{光电效应}},\\quad\n     \\text{康普顿散射，如果 } p_{\\text{光电效应}} \\le U'' < p_{\\text{光电效应}} + p_{\\text{康普顿}},\\quad\n     \\text{否则为电子对生成}。\n     $$\n     将反应编码为 $1$ (光电效应)、$2$ (康普顿散射) 或 $3$ (电子对生成)。输出反应代码和 $s_{\\text{tot}}$ (单位 cm)，然后终止。\n\n正确性与鲁棒性：\n- 虚碰撞方案能产生非均匀介质中第一次真实相互作用距离的无偏样本，因为它通过对一个率为 $\\Sigma_M(E)$ 的均匀过程进行细化来实现非均匀泊松过程。\n- 接受概率 $p_{\\text{acc}} = \\Sigma_t(E,x)/\\Sigma_M(E)$ 满足 $0 \\le p_{\\text{acc}} \\le 1$，因为 $\\Sigma_M(E)$ 是 $\\Sigma_t(E,x)$ 的上界。\n- 反应道的选择与从宏观截面导出的局域概率 $p_k(E,x)$ 一致。\n- 通过将提议的指数步长与到边界的距离进行比较，可以正确处理边界逃逸，即使在真实相互作用率为零或极小的区域也能确保终止。\n\n应用于指定的测试套件：\n- 案例 1 使用 $E = 0.5\\,\\mathrm{MeV}$，由于 $E < E_{\\text{th}}$，$\\Sigma_{\\text{电子对}} = 0$。由于近似的 $E^{-3}$ 依赖关系，控制截面主要由光电效应项主导。\n- 案例 2 使用 $E = 2.5\\,\\mathrm{MeV}$，$x_0$ 靠近上边界且 $\\hat{u} = +1$；如果提议的指数步长超过到 $x = L$ 的剩余距离，则逃逸是可能的。\n- 案例 3 使用阈值能量 $E = 1.022\\,\\mathrm{MeV}$；根据定义，在阈值处 $\\Sigma_{\\text{电子对}} = 0$，但光电效应和康普顿散射截面保持非零。方向 $\\hat{u} = -1$ 驱动光子向下边界运动。\n\n实现细节：\n- 使用以 $12345$ 为种子的伪随机数生成器，以确保跨次运行的抽样具有可复现性。\n- 计算以 $\\mathrm{cm}$ 为单位的自由程，并返回指定的整数反应代码。\n- 将三个测试案例的输出汇总为确切的单行格式：$\\texttt{[[code\\_1,freepath\\_1],[code\\_2,freepath\\_2],[code\\_3,freepath\\_3]]}$。\n\n该设计将指数衰减和宏观截面的基本物理原理与适用于空间非均匀性的、有原则的抽样方法相结合，确保了正确性和计算鲁棒性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Constants in MeV and cm\nE_REF = 0.5  # MeV\nME_C2 = 0.511  # MeV\nE_TH = 2.0 * ME_C2  # MeV, pair production threshold\nA0 = 2.0  # cm^-1\nB0 = 0.2  # cm^-1\nC0 = 0.5  # cm^-1\n\ndef sigma_photoelectric(E, x, L):\n    # a0 * (E_ref/E)^3 * (1 + 0.5*sin(pi*x/L))\n    return A0 * (E_REF / E) ** 3 * (1.0 + 0.5 * np.sin(np.pi * x / L))\n\ndef sigma_compton(E, x, L):\n    # b0 * (1 + 0.3*cos(pi*x/L))\n    return B0 * (1.0 + 0.3 * np.cos(np.pi * x / L))\n\ndef sigma_pair(E, x, L):\n    # c0 * (1 - E_th/E) * (1 + 0.2*exp(-x/L)) for E >= E_th, else 0\n    if E  E_TH:\n        return 0.0\n    return C0 * (1.0 - E_TH / E) * (1.0 + 0.2 * np.exp(-x / L))\n\ndef sigma_total(E, x, L):\n    sp = sigma_photoelectric(E, x, L)\n    sc = sigma_compton(E, x, L)\n    spp = sigma_pair(E, x, L)\n    return sp + sc + spp, sp, sc, spp\n\ndef sigma_majorant(E):\n    # Max over x in [0, L] using bounded factors:\n    # sin term max = 1, cos term max = 1, exp(-x/L) max = 1\n    photo_max = A0 * (E_REF / E) ** 3 * (1.0 + 0.5)\n    compton_max = B0 * (1.0 + 0.3)\n    if E  E_TH:\n        pair_max = 0.0\n    else:\n        pair_max = C0 * (1.0 - E_TH / E) * (1.0 + 0.2)\n    return photo_max + compton_max + pair_max\n\ndef sample_next_event(E, x0, u, L, rng):\n    \"\"\"\n    Returns (code, free_path_cm)\n    code: 0 escape, 1 photoelectric, 2 Compton, 3 pair production\n    free_path_cm: total path length to event or boundary in cm\n    \"\"\"\n    sigmaM = sigma_majorant(E)\n    # Handle degenerate case where sigmaM is zero (should not occur with given definitions)\n    if sigmaM = 0.0:\n        # No interactions anywhere; just escape to boundary\n        if u > 0:\n            return 0, float(L - x0)\n        else:\n            return 0, float(x0)\n\n    s_tot = 0.0\n    x = x0\n\n    while True:\n        # Sample exponential step with rate sigmaM\n        U = rng.random()\n        # Guard against log(0)\n        while U = 0.0:\n            U = rng.random()\n        s_step = -np.log(U) / sigmaM\n\n        # Distance to boundary along direction u\n        d_exit = (L - x) if (u > 0) else x\n\n        if s_step > d_exit:\n            # Escape before reaching a proposed event\n            s_tot += d_exit\n            return 0, float(s_tot)\n\n        # Advance to proposed event location\n        x = x + u * s_step\n        s_tot += s_step\n\n        # Compute local cross sections\n        sig_t, sig_p, sig_c, sig_pp = sigma_total(E, x, L)\n\n        # Acceptance probability for a real event\n        p_acc = sig_t / sigmaM\n\n        # Accept or reject\n        U_acc = rng.random()\n        if U_acc = p_acc:\n            # Real interaction: select channel\n            if sig_t == 0.0:\n                # Degenerate case: no real processes here, treat as null and continue\n                continue\n            # Probabilities\n            p_photo = sig_p / sig_t\n            p_comp = sig_c / sig_t\n            # p_pair = sig_pp / sig_t = 1 - p_photo - p_comp\n\n            U_sel = rng.random()\n            if U_sel  p_photo:\n                code = 1\n            elif U_sel  p_photo + p_comp:\n                code = 2\n            else:\n                code = 3\n            return code, float(s_tot)\n        # else: null collision, continue looping\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (E [MeV], x0 [cm], u (direction), L [cm])\n    test_cases = [\n        (0.5, 0.0, +1, 10.0),    # Case 1\n        (2.5, 9.8, +1, 10.0),    # Case 2\n        (1.022, 5.0, -1, 10.0),  # Case 3\n    ]\n\n    rng = np.random.default_rng(12345)\n\n    results = []\n    for E, x0, u, L in test_cases:\n        code, s = sample_next_event(E, x0, u, L, rng)\n        results.append((code, s))\n\n    # Build exact required format without spaces: [[code1,freepath1],[code2,freepath2],...]\n    # Ensure float representation is standard; convert to string directly.\n    formatted = \"[\" + \",\".join(f\"[{c},{repr(s)}]\" for c, s in results) + \"]\"\n    print(formatted)\n\nsolve()\n```"
        },
        {
            "introduction": "为了在计算上易于处理，高能模拟通常会采用近似方法，而理解这些近似方法的影响对于物理分析至关重要。本练习深入探讨了一种常见近似——低能径迹截止——对量能器中能量测量的影响。通过推导并应用一个简化的电磁簇射解析模型，你将学会量化系统偏差，这是解读模拟结果和验证物理模型的关键技能。",
            "id": "3535396",
            "problem": "要求您分析和量化在蒙特卡洛（MC）输运模拟中，对次级电子和正电子（$e^\\pm$）以及光子（$\\gamma$）设置的低能产生和径迹追踪阈值如何对电磁采样量能器中的重建能量产生偏差。您的分析必须仅基于基本定义以及关于物质中电磁簇射的经过充分检验的事实。\n\n考虑一个由能量为 $E_0$ 的初始电子入射到一种块状材料上引发的一维电磁簇射，该材料的特性由其辐射长度 $X_0$ 和临界能量 $E_c$ 决定。辐射长度 $X_0$ 定义为超相对论性电子通过韧致辐射损失其能量的 $1 - 1/e$ 分数所需的平均距离，也定义为高能光子发生电子对产生的平均自由程。临界能量 $E_c$ 是电离能量损失等于辐射能量损失时的能量，它设定了簇射倍增阶段的大致终止尺度。假设 $E_0 \\gg E_c$。\n\n假设一个采样量能器，其响应与在活性介质中累积的带电粒子总径迹长度成正比。设活性采样分数为一个固定常数 $f_a \\in (0,1)$。在蒙特卡洛输运中，一个低能产生和径迹追踪阈值 $E_{\\text{cut}}$ 应用于次级 $e^\\pm$ 和 $\\gamma$。当簇射的某个分支的能量低于 $E_{\\text{cut}}$ 时，该分支被终止，其剩余能量瞬时和局域地沉积在吸收体材料中，产生零信号（最坏情况假设）。能量高于 $E_{\\text{cut}}$ 的带电粒子对其路径长度和活性分数 $f_a$ 成比例地贡献信号。忽略横向泄漏，并假设在所考虑的厚度内没有纵向泄漏。\n\n任务：\n1. 仅从以下基础出发：辐射长度 $X_0$ 的定义、临界能量 $E_c$ 的作用，以及电磁簇射中韧致辐射和电子对产生的定性标度不变性，推导出一个能量高于阈值能量 $\\varepsilon$ 的带电粒子总径迹长度的表达式，该表达式是 $E_0$、$X_0$ 和 $\\varepsilon$ 的函数。明确论证引入 $E_c$ 作为簇射饱和标度的合理性，并确定在 $\\varepsilon \\leq E_c$ 和 $\\varepsilon  E_c$ 两种情况下径迹长度的行为。\n2. 使用任务1的结果，推导重建能量 $E_{\\text{reco}}$ 作为 $E_0$、$E_{\\text{cut}}$、$X_0$、$E_c$、$f_a$ 和一个校准常数的函数的公式。在一个参考配置（其中阈值等于临界能量，$E_{\\text{cut,ref}} = E_c$）下校准量能器，使得在该配置下 $E_{\\text{reco}} = E_0$。基于此校准，在所述假设下，推导分数偏差 $b = E_{\\text{reco}}/E_0 - 1$ 作为 $E_{\\text{cut}}$、$X_0$ 和 $E_c$ 的函数。清楚地说明任何对消项，并解释对 $X_0$ 的依赖关系。\n3. 在一个程序中实现推导出的公式，为下面指定的参数集计算分数偏差 $b$。能量单位为兆电子伏特（MeV），辐射长度单位为厘米（cm）。输出必须是分数偏差 $b$，以小数形式表示（而非百分比），并四舍五入到六位小数。\n\n测试套件（每个测试用例是一个元组 $(E_0, X_0, E_c, E_{\\text{cut}})$，其中能量单位为MeV，X_0单位为cm）：\n- 案例 1：$(5000.0, 0.56, 7.4, 1.0)$。\n- 案例 2：$(5000.0, 0.56, 7.4, 7.4)$。\n- 案例 3：$(5000.0, 0.56, 7.4, 20.0)$。\n- 案例 4：$(5000.0, 9.36, 37.0, 5.0)$。\n- 案例 5：$(5000.0, 9.36, 37.0, 50.0)$。\n- 案例 6：$(5000.0, 0.35, 8.0, 30.0)$。\n- 案例 7：$(5000.0, 1.76, 21.0, 21.0)$。\n\n最终输出格式：\n- 您的程序应产生单行输出，包含一个用方括号括起来的逗号分隔列表，例如 `[r_1,r_2,...,r_7]`，其中每个 `r_i` 是案例 `i` 的分数偏差 `b`，四舍五入到六位小数。",
            "solution": "该问题要求推导并应用一个公式，用于计算电磁量能器中由低能粒子径迹追踪阈值引起的分数能量偏差。推导过程必须从电磁簇射物理学的第一性原理出发。\n\n### 步骤1：带电粒子总径迹长度的推导\n\n第一个任务是推导在电磁簇射中，能量高于阈值 $\\varepsilon$ 的带电粒子（电子和正电子）的总径迹长度的表达式。该簇射由能量为 $E_0$ 的初始电子在一种材料中引发，该材料的特性由其辐射长度 $X_0$ 和临界能量 $E_c$ 决定。已知条件是 $E_0 \\gg E_c$。\n\n电磁簇射通过韧致辐射（$e^\\pm \\to e^\\pm \\gamma$）和电子对产生（$\\gamma \\to e^+ e^-$）的级联过程发展。在高能极限（$E \\gg E_c$）下，这两个过程的特征长度标度都是辐射长度 $X_0$。标度不变性意味着这些相互作用的物理性质在很大程度上与绝对能量标度无关。这个倍增过程持续进行，簇射粒子数增加，其平均能量减少，直到平均粒子能量接近临界能量 $E_c$。\n\n临界能量 $E_c$ 定义为一个电子因电离和激发造成的能量损失与其因韧致辐射造成的能量损失相等时的能量。对于能量 $E  E_c$，电离损失占主导地位；对于 $E  E_c$，辐射损失占主导地位。因此，$E_c$ 代表了簇射倍增阶段停止的自然能量标度。在 $E_c$ 以下，粒子主要通过电离介质来损失能量，而不会产生新的簇射粒子，从而有效地终止了级联过程。\n\n簇射中所有带电粒子的总径迹长度是所产生的总电离量的一种量度。根据能量守恒定律，通过电离沉积的总能量必须等于初始能量 $E_0$。一个相对论性粒子的电离能量损失率可以近似为一个常数值，根据 $E_c$ 的定义，该值约为 $(dE/dx)_{\\text{ion}} \\approx E_c/X_0$。那么，总径迹长度 $T_{\\text{total}}$ 就是耗散的总能量除以平均能量损失率：\n$$T_{\\text{total}} = \\frac{E_0}{(dE/dx)_{\\text{ion}}} \\approx \\frac{E_0}{E_c / X_0} = \\frac{E_0}{E_c} X_0$$\n这是簇射理论中的一个标准结果（通常称为罗西近似B）。该公式给出了所有带电粒子从产生到减速至静止的积分径迹长度。\n\n问题要求的是 $T(\\varepsilon)$，即粒子能量高于阈值 $\\varepsilon$ 时的总径迹长度。我们可以通过考虑基于 $\\varepsilon$ 和 $E_c$ 之间关系的两个不同区域来对此进行建模。\n\n情况1：$\\varepsilon \\le E_c$。在此区域，径迹追踪阈值低于簇射倍增阶段的自然终止标度。簇射充分发展，当粒子平均能量达到 $E_c$ 时，粒子数量达到饱和。总径迹长度主要由能量在 $E_c$ 附近及以下的大量粒子所贡献。因此，如果我们将粒子追踪到任意能量 $\\varepsilon \\le E_c$，我们实质上是在测量簇射的整个径迹长度。结果是饱和的，并由总径迹长度公式给出：\n$$T(\\varepsilon) \\approx T_{\\text{total}} = C_1 \\frac{E_0}{E_c} X_0 \\quad (\\text{对于 } \\varepsilon \\le E_c)$$\n其中 $C_1$ 是一个量级为1的常数，它考虑了簇射模型的细节。\n\n情况2：$\\varepsilon  E_c$。在此区域，径迹追踪阈值显著高于临界能量。当粒子能量下降到 $\\varepsilon$ 时，簇射被人为终止，这远早于级联在 $E_c$ 处的自然结束。在能量标度 $E$ 处的级联粒子数近似为 $N \\propto E_0 / E$。这些粒子中的每一个在相互作用前都行进了量级为 $X_0$ 的特征距离。因此，能量高于 $\\varepsilon$ 的粒子累积的总径迹长度与该标度下的粒子数乘以特征长度成正比：\n$$T(\\varepsilon) \\propto \\left( \\frac{E_0}{\\varepsilon} \\right) X_0 = C_1 \\frac{E_0}{\\varepsilon} X_0 \\quad (\\text{对于 } \\varepsilon  E_c)$$\n如果我们将其视为一个连续模型，可以使用相同的常数 $C_1$。\n\n结合这两个区域，我们可以写出能量高于阈值 $\\varepsilon$ 的径迹长度的单个表达式：\n$$T(\\varepsilon) = C_1 X_0 \\frac{E_0}{\\max(\\varepsilon, E_c)}$$\n该表达式正确地捕捉了 $\\varepsilon \\le E_c$ 时径迹长度的饱和现象以及 $\\varepsilon  E_c$ 时对 $1/\\varepsilon$ 的依赖关系。这就完成了第一个任务。\n\n### 步骤2：分数偏差的推导\n\n根据题目，采样量能器的响应与在活性介质中累积的带电粒子总径迹长度成正比。应用了低能阈值 $E_{\\text{cut}}$，这意味着只有能量 $E  E_{\\text{cut}}$ 的粒子的径迹长度才对信号有贡献。活性介质占总材料的 $f_a$ 分数。\n\n因此，测量到的信号 $S$ 与活性采样分数 $f_a$ 和能量高于 $E_{\\text{cut}}$ 的粒子的总径迹长度 $T(E_{\\text{cut}})$ 的乘积成正比。\n$$S(E_{\\text{cut}}) = K \\cdot f_a \\cdot T(E_{\\text{cut}})$$\n其中 $K$ 是一个比例常数，用于将径迹长度转换为电子信号单位。代入我们对 $T(E_{\\text{cut}})$ 的表达式：\n$$S(E_{\\text{cut}}) = K \\cdot f_a \\cdot \\left( C_1 X_0 \\frac{E_0}{\\max(E_{\\text{cut}}, E_c)} \\right)$$\n重建能量 $E_{\\text{reco}}$ 是通过对信号应用一个校准常数 $C_{\\text{calib}}$ 获得的：\n$$E_{\\text{reco}} = C_{\\text{calib}} \\cdot S(E_{\\text{cut}}) = C_{\\text{calib}} K C_1 f_a X_0 \\frac{E_0}{\\max(E_{\\text{cut}}, E_c)}$$\n问题指定了一个校准程序：对于参考阈值 $E_{\\text{cut,ref}} = E_c$，重建能量必须等于真实能量，即 $E_{\\text{reco}} = E_0$。我们应用此条件来确定未知常数。\n$$E_0 = C_{\\text{calib}} K C_1 f_a X_0 \\frac{E_0}{\\max(E_c, E_c)} = (C_{\\text{calib}} K C_1) f_a X_0 \\frac{E_0}{E_c}$$\n我们可以解出所有常数的乘积 $(C_{\\text{calib}} K C_1)$：\n$$1 = (C_{\\text{calib}} K C_1) \\frac{f_a X_0}{E_c} \\implies (C_{\\text{calib}} K C_1) = \\frac{E_c}{f_a X_0}$$\n现在，我们将这个校准过的常数代回到 $E_{\\text{reco}}$ 的一般表达式中：\n$$E_{\\text{reco}} = \\left( \\frac{E_c}{f_a X_0} \\right) f_a X_0 \\frac{E_0}{\\max(E_{\\text{cut}}, E_c)}$$\n一个关键的对消发生了。采样分数 $f_a$ 和辐射长度 $X_0$ 都从表达式中消失了：\n$$E_{\\text{reco}} = E_0 \\frac{E_c}{\\max(E_{\\text{cut}}, E_c)}$$\n这个简洁优美的结果表明，在该模型和指定的校准下，重建能量对特定材料（$X_0$）和构造（$f_a$）的依赖性被消除了。偏差仅取决于能量标度 $E_{\\text{cut}}$ 和 $E_c$ 的比率。\n\n最后一步是求出分数偏差 $b$：\n$$b = \\frac{E_{\\text{reco}}}{E_0} - 1 = \\frac{1}{E_0} \\left( E_0 \\frac{E_c}{\\max(E_{\\text{cut}}, E_c)} \\right) - 1$$\n$$b = \\frac{E_c}{\\max(E_{\\text{cut}}, E_c)} - 1$$\n这是分数偏差的最终公式。它仅取决于临界能量 $E_c$ 和径迹追踪阈值 $E_{\\text{cut}}$。如果 $E_{\\text{cut}} \\le E_c$，偏差为 $b = E_c/E_c - 1 = 0$。如果 $E_{\\text{cut}}  E_c$，偏差为 $b = E_c/E_{\\text{cut}} - 1$，这是一个负值，表明能量被低估，正如预期的那样。\n\n### 步骤3：实现\n\n推导出的公式 $b = E_c / \\max(E_{\\text{cut}}, E_c) - 1$ 被用来实现计算给定测试用例的偏差。每次计算仅需要 $E_c$ 和 $E_{\\text{cut}}$ 的值；$E_0$ 和 $X_0$ 对于 $b$ 的最终计算是不需要的，正如它们的对消所证明的那样。结果按要求四舍五入到六位小数。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the fractional energy bias in an electromagnetic calorimeter\n    based on a simplified analytical shower model.\n    \"\"\"\n    # The test suite provides tuples of (E0, X0, Ec, E_cut).\n    # Per the derivation, the fractional bias b only depends on Ec and E_cut.\n    test_cases = [\n        # (E0 in MeV, X0 in cm, Ec in MeV, E_cut in MeV)\n        (5000.0, 0.56, 7.4, 1.0),    # Case 1\n        (5000.0, 0.56, 7.4, 7.4),    # Case 2\n        (5000.0, 0.56, 7.4, 20.0),   # Case 3\n        (5000.0, 9.36, 37.0, 5.0),   # Case 4\n        (5000.0, 9.36, 37.0, 50.0),  # Case 5\n        (5000.0, 0.35, 8.0, 30.0),   # Case 6\n        (5000.0, 1.76, 21.0, 21.0),  # Case 7\n    ]\n\n    results = []\n    for case in test_cases:\n        E0, X0, Ec, E_cut = case\n\n        # The derived formula for the fractional bias 'b' is:\n        # b = Ec / max(E_cut, Ec) - 1\n        # E0 and X0 cancel out in the derivation due to the calibration procedure.\n        \n        # Calculate the bias using the derived formula.\n        # np.maximum is used as it's part of the allowed numpy library.\n        # Python's built-in max() would also work.\n        bias = Ec / np.maximum(E_cut, Ec) - 1\n\n        # Format the result to six decimal places.\n        # The string formatting f\"{value:.6f}\" ensures the required precision.\n        formatted_result = f\"{bias:.6f}\"\n        results.append(formatted_result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\n# Execute the main function.\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}