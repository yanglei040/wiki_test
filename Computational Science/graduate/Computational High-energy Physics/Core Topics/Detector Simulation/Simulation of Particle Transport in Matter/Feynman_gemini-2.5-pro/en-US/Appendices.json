{
    "hands_on_practices": [
        {
            "introduction": "The foundation of any particle transport simulation lies in quantifying the probability of interaction. This exercise grounds the simulation process in fundamental physics by connecting microscopic cross sections, which represent the quantum mechanical likelihood of a specific reaction, to the macroscopic quantities that govern a particle's journey through a medium. By calculating the total macroscopic cross section $\\Sigma_t$ and mean free path $\\lambda$, you will build the core logic for determining how far a particle travels before its next interaction, a cornerstone of the Monte Carlo method. ",
            "id": "3535412",
            "problem": "A monoenergetic neutron beam of energy $E = 14\\,\\mathrm{MeV}$ traverses a homogeneous polymer modeled as polyethylene with chemical formula $\\mathrm{CH_2}$. At this energy, interactions are considered to occur via four exclusive processes: elastic scattering on hydrogen, radiative capture on hydrogen, elastic scattering on carbon, and inelastic scattering on carbon. The material is characterized by number densities $n_{\\mathrm{H}} = 8.08 \\times 10^{22}\\,\\mathrm{cm^{-3}}$ and $n_{\\mathrm{C}} = 4.04 \\times 10^{22}\\,\\mathrm{cm^{-3}}$. The microscopic cross sections at $E = 14\\,\\mathrm{MeV}$ are taken to be constant over the free-flight step and are given by $\\sigma_{\\mathrm{H,el}} = 2.7\\,\\mathrm{b}$, $\\sigma_{\\mathrm{H,cap}} = 5.0 \\times 10^{-4}\\,\\mathrm{b}$, $\\sigma_{\\mathrm{C,el}} = 1.3\\,\\mathrm{b}$, and $\\sigma_{\\mathrm{C,inel}} = 0.9\\,\\mathrm{b}$, where $1\\,\\mathrm{b} = 10^{-24}\\,\\mathrm{cm^2}$.\n\nUsing only fundamental definitions of microscopic cross section, number density, and path-length interaction probability, compute:\n- the total macroscopic cross section $\\Sigma_{t}(E)$,\n- the mean free path $\\lambda(E)$,\n- and the probability that the next interaction is elastic scattering (on either species).\n\nRound your results to four significant figures. Express $\\Sigma_{t}$ in $\\mathrm{cm^{-1}}$, $\\lambda$ in $\\mathrm{cm}$, and the probability as a pure decimal (dimensionless).",
            "solution": "The problem is first validated to ensure it is scientifically sound, self-contained, and well-posed.\n\n**Step 1: Extract Givens**\n- Neutron beam energy: $E = 14\\,\\mathrm{MeV}$\n- Material composition: Polyethylene, $\\mathrm{CH_2}$\n- Hydrogen number density: $n_{\\mathrm{H}} = 8.08 \\times 10^{22}\\,\\mathrm{cm^{-3}}$\n- Carbon number density: $n_{\\mathrm{C}} = 4.04 \\times 10^{22}\\,\\mathrm{cm^{-3}}$\n- Microscopic cross section for elastic scattering on hydrogen: $\\sigma_{\\mathrm{H,el}} = 2.7\\,\\mathrm{b}$\n- Microscopic cross section for radiative capture on hydrogen: $\\sigma_{\\mathrm{H,cap}} = 5.0 \\times 10^{-4}\\,\\mathrm{b}$\n- Microscopic cross section for elastic scattering on carbon: $\\sigma_{\\mathrm{C,el}} = 1.3\\,\\mathrm{b}$\n- Microscopic cross section for inelastic scattering on carbon: $\\sigma_{\\mathrm{C,inel}} = 0.9\\,\\mathrm{b}$\n- Conversion factor: $1\\,\\mathrm{b} = 10^{-24}\\,\\mathrm{cm^2}$\n- Required computations: total macroscopic cross section $\\Sigma_{t}$, mean free path $\\lambda$, and probability of elastic scattering $P_{\\mathrm{el}}$.\n- Rounding: Four significant figures.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Grounding**: The problem deals with fundamental concepts of neutron transport theory, namely macroscopic and microscopic cross sections, and mean free path. These are cornerstone principles in nuclear physics and engineering. The provided numerical values for number densities and cross sections at $14\\,\\mathrm{MeV}$ are physically plausible. The stoichiometric ratio $n_{\\mathrm{H}}/n_{\\mathrm{C}} = (8.08 \\times 10^{22}) / (4.04 \\times 10^{22}) = 2$ is consistent with the chemical formula $\\mathrm{CH_2}$. The problem is scientifically sound.\n- **Well-Posedness**: The problem provides all necessary data and clear definitions to compute the requested quantities. A unique, stable, and meaningful solution exists.\n- **Objectivity**: The problem is stated using precise, quantitative language, free of ambiguity or subjective claims.\n\n**Step 3: Verdict and Action**\nThe problem is deemed **valid**. A solution will be derived based on fundamental principles.\n\n**Solution Derivation**\nThe macroscopic cross section, $\\Sigma$, represents the probability of an interaction per unit path length of a particle in a material. For a specific nuclide species $i$ and interaction type $j$, it is defined as the product of the number density of the nuclide, $n_i$, and the microscopic cross section for that interaction, $\\sigma_{i,j}$:\n$$\n\\Sigma_{i,j} = n_i \\sigma_{i,j}\n$$\nThe total macroscopic cross section, $\\Sigma_t$, for a mixture of nuclides is the sum of the macroscopic cross sections over all constituent species $i$ and all possible interaction types $j$:\n$$\n\\Sigma_t = \\sum_i \\sum_j \\Sigma_{i,j} = \\sum_i n_i \\left( \\sum_j \\sigma_{i,j} \\right) = \\sum_i n_i \\sigma_{i,t}\n$$\nwhere $\\sigma_{i,t}$ is the total microscopic cross section for species $i$.\n\nFor the given polyethylene material ($\\mathrm{CH_2}$), the nuclides are Hydrogen ($\\mathrm{H}$) and Carbon ($\\mathrm{C}$). The total macroscopic cross section $\\Sigma_t$ is the sum of the contributions from both nuclides:\n$$\n\\Sigma_t = \\Sigma_{\\mathrm{H},t} + \\Sigma_{\\mathrm{C},t}\n$$\nThe total microscopic cross sections for Hydrogen and Carbon are:\n$$\n\\sigma_{\\mathrm{H},t} = \\sigma_{\\mathrm{H,el}} + \\sigma_{\\mathrm{H,cap}}\n$$\n$$\n\\sigma_{\\mathrm{C},t} = \\sigma_{\\mathrm{C,el}} + \\sigma_{\\mathrm{C,inel}}\n$$\nCombining these, the expression for the total macroscopic cross section is:\n$$\n\\Sigma_t = n_{\\mathrm{H}}(\\sigma_{\\mathrm{H,el}} + \\sigma_{\\mathrm{H,cap}}) + n_{\\mathrm{C}}(\\sigma_{\\mathrm{C,el}} + \\sigma_{\\mathrm{C,inel}})\n$$\n\n**1. Calculation of the Total Macroscopic Cross Section $\\Sigma_t$**\nFirst, we substitute the given microscopic cross section values in units of barns ($\\mathrm{b}$):\n$$\n\\sigma_{\\mathrm{H},t} = 2.7\\,\\mathrm{b} + 5.0 \\times 10^{-4}\\,\\mathrm{b} = 2.7005\\,\\mathrm{b}\n$$\n$$\n\\sigma_{\\mathrm{C},t} = 1.3\\,\\mathrm{b} + 0.9\\,\\mathrm{b} = 2.2\\,\\mathrm{b}\n$$\nNow, we compute the total macroscopic cross section using the given number densities and the conversion factor $1\\,\\mathrm{b} = 10^{-24}\\,\\mathrm{cm^2}$:\n$$\n\\Sigma_t = (8.08 \\times 10^{22}\\,\\mathrm{cm^{-3}})(2.7005\\,\\mathrm{b} \\times 10^{-24}\\,\\mathrm{cm^2/b}) + (4.04 \\times 10^{22}\\,\\mathrm{cm^{-3}})(2.2\\,\\mathrm{b} \\times 10^{-24}\\,\\mathrm{cm^2/b})\n$$\n$$\n\\Sigma_t = (0.2182004\\,\\mathrm{cm^{-1}}) + (0.08888\\,\\mathrm{cm^{-1}})\n$$\n$$\n\\Sigma_t = 0.3070804\\,\\mathrm{cm^{-1}}\n$$\nRounding to four significant figures, we get:\n$$\n\\Sigma_t \\approx 0.3071\\,\\mathrm{cm^{-1}}\n$$\n\n**2. Calculation of the Mean Free Path $\\lambda$**\nThe mean free path, $\\lambda$, is the average distance a particle travels between interactions. It is defined as the reciprocal of the total macroscopic cross section:\n$$\n\\lambda = \\frac{1}{\\Sigma_t}\n$$\nUsing the unrounded value of $\\Sigma_t$ for accuracy:\n$$\n\\lambda = \\frac{1}{0.3070804\\,\\mathrm{cm^{-1}}} \\approx 3.25646\\,\\mathrm{cm}\n$$\nRounding to four significant figures:\n$$\n\\lambda \\approx 3.256\\,\\mathrm{cm}\n$$\n\n**3. Calculation of the Probability of Elastic Scattering**\nGiven that an interaction occurs, the probability that it is of a specific type is the ratio of the macroscopic cross section for that type to the total macroscopic cross section. We are interested in the probability of elastic scattering on either hydrogen or carbon. Let this probability be $P_{\\mathrm{el}}$. The corresponding macroscopic cross section, $\\Sigma_{\\mathrm{el}}$, is the sum of the macroscopic cross sections for elastic scattering on hydrogen and carbon:\n$$\n\\Sigma_{\\mathrm{el}} = \\Sigma_{\\mathrm{H,el}} + \\Sigma_{\\mathrm{C,el}} = n_{\\mathrm{H}}\\sigma_{\\mathrm{H,el}} + n_{\\mathrm{C}}\\sigma_{\\mathrm{C,el}}\n$$\nThe probability is then:\n$$\nP_{\\mathrm{el}} = \\frac{\\Sigma_{\\mathrm{el}}}{\\Sigma_t}\n$$\nFirst, we compute $\\Sigma_{\\mathrm{el}}$:\n$$\n\\Sigma_{\\mathrm{el}} = (8.08 \\times 10^{22}\\,\\mathrm{cm^{-3}})(2.7\\,\\mathrm{b} \\times 10^{-24}\\,\\mathrm{cm^2/b}) + (4.04 \\times 10^{22}\\,\\mathrm{cm^{-3}})(1.3\\,\\mathrm{b} \\times 10^{-24}\\,\\mathrm{cm^2/b})\n$$\n$$\n\\Sigma_{\\mathrm{el}} = (0.21816\\,\\mathrm{cm^{-1}}) + (0.05252\\,\\mathrm{cm^{-1}}) = 0.27068\\,\\mathrm{cm^{-1}}\n$$\nNow we calculate the probability using the unrounded values of $\\Sigma_{\\mathrm{el}}$ and $\\Sigma_t$:\n$$\nP_{\\mathrm{el}} = \\frac{0.27068\\,\\mathrm{cm^{-1}}}{0.3070804\\,\\mathrm{cm^{-1}}} \\approx 0.88147\n$$\nRounding to four significant figures, the probability is:\n$$\nP_{\\mathrm{el}} \\approx 0.8815\n$$\n\nThe final answers for the three requested quantities, rounded to four significant figures, are $\\Sigma_{t} = 0.3071\\,\\mathrm{cm^{-1}}$, $\\lambda = 3.256\\,\\mathrm{cm}$, and $P_{\\mathrm{el}} = 0.8815$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0.3071 & 3.256 & 0.8815 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "After determining the statistical likelihood of an interaction, the next step in a simulation is to propagate the particle through the defined world geometry. This practice focuses on the core task of geometric navigation, often called ray tracing, which involves finding the intersection of a particle's path with material boundaries. Mastering this skill is essential for accurately tracking particles through complex detector or shielding configurations and determining the precise location of physical interactions. ",
            "id": "3535374",
            "problem": "A neutral particle of energy sufficiently high to neglect multiple scattering is propagated in a geometric model used in simulation of particle transport in matter. The geometry consists of a homogeneous axis-aligned rectangular box that contains a spherical inclusion of a different material. The box bounds are $x \\in [-100 \\ \\mathrm{mm}, 100 \\ \\mathrm{mm}]$, $y \\in [-100 \\ \\mathrm{mm}, 100 \\ \\mathrm{mm}]$, and $z \\in [0 \\ \\mathrm{mm}, 300 \\ \\mathrm{mm}]$. The sphere has center $\\mathbf{c} = (20 \\ \\mathrm{mm}, -30 \\ \\mathrm{mm}, 80 \\ \\mathrm{mm})$ and radius $r = 50 \\ \\mathrm{mm}$. A ray representing the particle track starts at origin $\\mathbf{o} = (0 \\ \\mathrm{mm}, -20 \\ \\mathrm{mm}, 90 \\ \\mathrm{mm})$ with unit direction $\\hat{\\mathbf{d}} = (0.6, 0.8, 0)$, so that the parametric trajectory is $\\mathbf{p}(t) = \\mathbf{o} + t \\, \\hat{\\mathbf{d}}$, where $t$ is the path length in $\\mathrm{mm}$.\n\nStarting from the parametric ray equation and the implicit definitions of the sphere and the box planes, determine the forward parametric distances to the next boundary for the sphere and for the box, select the actual next boundary encountered, and construct the outward unit normal of the surface at the intersection point. Then, compute the scalar quantity $\\cos\\theta$ defined as the cosine of the angle between the ray direction $\\hat{\\mathbf{d}}$ and the outward unit normal $\\hat{\\mathbf{n}}_{\\mathrm{exit}}$ at the next boundary along the forward direction. Report $\\cos\\theta$ as a single real number. Round your answer to $4$ significant figures. The final answer is dimensionless; do not include units.",
            "solution": "The user wants to solve a computational geometry problem related to particle transport.\n\n### Step 1: Extract Givens\nThe geometric model and particle trajectory are defined by the following parameters:\n-   Box boundaries: $x \\in [-100, 100]$, $y \\in [-100, 100]$, $z \\in [0, 300]$. All units are in $\\mathrm{mm}$.\n-   Spherical inclusion center: $\\mathbf{c} = (20, -30, 80)$.\n-   Spherical inclusion radius: $r = 50$.\n-   Particle starting point (ray origin): $\\mathbf{o} = (0, -20, 90)$.\n-   Particle direction (unit vector): $\\hat{\\mathbf{d}} = (0.6, 0.8, 0)$.\n-   The particle's trajectory is a ray defined by the parametric equation $\\mathbf{p}(t) = \\mathbf{o} + t \\, \\hat{\\mathbf{d}}$, where $t \\ge 0$ is the path length.\n\n### Step 2: Validate Using Extracted Givens\n-   **Scientifically Grounded:** The problem is a standard exercise in 3D computational geometry, which is a core component of ray tracing algorithms used in various scientific simulations, including particle transport codes like Geant4. The assumption of a straight-line trajectory is a valid physical approximation for high-energy neutral particles that do not interact electromagnetically with the medium and for which nuclear scattering event probabilities are low over the path lengths considered.\n-   **Well-Posed:** The problem provides all necessary information (geometric definitions, ray parameters) and has a clear, unambiguous objective. The setup guarantees a unique first intersection point for the ray.\n-   **Objective:** The problem is stated using precise mathematical language, free from any subjectivity or ambiguity.\n\n### Step 3: Verdict and Action\nThe problem is valid as it is scientifically sound, well-posed, and objective. A solution will be derived.\n\n### Solution Derivation\n\nThe primary task is to find the smallest positive path length $t$ at which the ray $\\mathbf{p}(t)$ intersects any boundary of the defined geometry, identify the surface normal at that point, and compute the cosine of the angle between the ray direction and the normal.\n\nThe two candidate boundaries are the sphere and the surrounding box. We must calculate the distance to intersection for both and take the minimum.\n\n**1. Distance to Intersection with the Sphere**\n\nThe surface of the sphere is defined by the implicit equation $|\\mathbf{x} - \\mathbf{c}|^2 = r^2$. To find the intersection points, we substitute the ray equation $\\mathbf{x} = \\mathbf{p}(t) = \\mathbf{o} + t \\, \\hat{\\mathbf{d}}$ into the sphere equation:\n$$|\\mathbf{o} + t \\, \\hat{\\mathbf{d}} - \\mathbf{c}|^2 = r^2$$\nLet $\\mathbf{v} = \\mathbf{o} - \\mathbf{c}$. The equation becomes:\n$$|\\mathbf{v} + t \\, \\hat{\\mathbf{d}}|^2 = r^2$$\nExpanding the dot product:\n$$(\\mathbf{v} + t \\, \\hat{\\mathbf{d}}) \\cdot (\\mathbf{v} + t \\, \\hat{\\mathbf{d}}) = r^2$$\n$$\\mathbf{v} \\cdot \\mathbf{v} + 2t(\\mathbf{v} \\cdot \\hat{\\mathbf{d}}) + t^2(\\hat{\\mathbf{d}} \\cdot \\hat{\\mathbf{d}}) = r^2$$\nSince $\\hat{\\mathbf{d}}$ is a unit vector, $\\hat{\\mathbf{d}} \\cdot \\hat{\\mathbf{d}} = 1$. This gives a quadratic equation for $t$:\n$$t^2 + 2(\\mathbf{v} \\cdot \\hat{\\mathbf{d}})t + (|\\mathbf{v}|^2 - r^2) = 0$$\nFirst, we compute the vector $\\mathbf{v}$ and the necessary dot products:\n$$\\mathbf{v} = \\mathbf{o} - \\mathbf{c} = (0-20, -20-(-30), 90-80) = (-20, 10, 10)$$\n$$|\\mathbf{v}|^2 = (-20)^2 + 10^2 + 10^2 = 400 + 100 + 100 = 600$$\n$$r^2 = 50^2 = 2500$$\nSince $|\\mathbf{v}|^2 < r^2$, the starting point $\\mathbf{o}$ lies inside the sphere.\n$$\\mathbf{v} \\cdot \\hat{\\mathbf{d}} = (-20)(0.6) + (10)(0.8) + (10)(0) = -12 + 8 + 0 = -4$$\nSubstituting these values into the quadratic equation:\n$$t^2 + 2(-4)t + (600 - 2500) = 0$$\n$$t^2 - 8t - 1900 = 0$$\nWe solve for $t$ using the quadratic formula, $t = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$:\n$$t = \\frac{8 \\pm \\sqrt{(-8)^2 - 4(1)(-1900)}}{2} = \\frac{8 \\pm \\sqrt{64 + 7600}}{2} = \\frac{8 \\pm \\sqrt{7664}}{2}$$\nThe two solutions are $t_1 = \\frac{8 + \\sqrt{7664}}{2} \\approx 47.772$ and $t_2 = \\frac{8 - \\sqrt{7664}}{2} \\approx -39.772$.\nSince we are propagating forward in time/distance, we are interested in the smallest positive root. As the particle starts inside the sphere, the positive root corresponds to the exit point.\n$$t_{\\text{sphere}} = \\frac{8 + \\sqrt{7664}}{2} = 4 + \\sqrt{1916} = 4 + 2\\sqrt{479} \\approx 47.772 \\ \\mathrm{mm}$$\n\n**2. Distance to Intersection with the Box**\n\nThe ray starts at $\\mathbf{o}=(0, -20, 90)$, which is inside the box defined by $x \\in [-100, 100]$, $y \\in [-100, 100]$, and $z \\in [0, 300]$. The ray direction is $\\hat{\\mathbf{d}} = (0.6, 0.8, 0)$.\nThe distance to a plane with normal $\\hat{\\mathbf{n}}_p$ at distance $p$ from the origin (equation $\\mathbf{x} \\cdot \\hat{\\mathbf{n}}_p - p = 0$) is $t = \\frac{p - \\mathbf{o} \\cdot \\hat{\\mathbf{n}}_p}{\\hat{\\mathbf{d}} \\cdot \\hat{\\mathbf{n}}_p}$. A simpler approach is to solve component-wise.\nFor a plane $x=x_b$, the intersection distance is $t_x = (x_b - o_x)/d_x$.\n- For $x$-planes: $d_x = 0.6 > 0$, so the ray travels towards the positive $x$ direction. The next potential intersection is with the plane $x=100$.\n$$t_x = \\frac{100 - 0}{0.6} = \\frac{1000}{6} = \\frac{500}{3} \\approx 166.67 \\ \\mathrm{mm}$$\n- For $y$-planes: $d_y = 0.8 > 0$, so the ray travels towards the positive $y$ direction. The next potential intersection is with the plane $y=100$.\n$$t_y = \\frac{100 - (-20)}{0.8} = \\frac{120}{0.8} = 150 \\ \\mathrm{mm}$$\n- For $z$-planes: $d_z = 0$, so the ray is parallel to the $z$-planes. Since the starting $z$-coordinate $o_z=90$ is within the range $[0, 300]$, the ray will never intersect the top or bottom faces of the box. The distance is infinite.\n\nThe distances to the box boundaries are $t_x \\approx 166.67$ and $t_y = 150$. The first intersection with the box occurs at the minimum of these positive distances:\n$$t_{\\text{box}} = \\min(150, \\frac{500}{3}) = 150 \\ \\mathrm{mm}$$\n\n**3. Next Boundary Encountered**\n\nWe compare the distances to the sphere and the box:\n$$t_{\\text{next}} = \\min(t_{\\text{sphere}}, t_{\\text{box}}) = \\min(47.772..., 150) = 47.772...$$\nThe first boundary encountered by the particle is the surface of the sphere.\n\n**4. Outward Normal and $\\cos\\theta$**\n\nThe intersection point is on the sphere. Since the particle starts inside the sphere, it is exiting. The outward unit normal $\\hat{\\mathbf{n}}_{\\mathrm{exit}}$ at any point $\\mathbf{p}$ on the sphere's surface is directed from the center $\\mathbf{c}$ to $\\mathbf{p}$:\n$$\\hat{\\mathbf{n}}_{\\mathrm{exit}} = \\frac{\\mathbf{p} - \\mathbf{c}}{|\\mathbf{p} - \\mathbf{c}|} = \\frac{\\mathbf{p} - \\mathbf{c}}{r}$$\nThe intersection point is $\\mathbf{p}(t_{\\text{next}}) = \\mathbf{o} + t_{\\text{next}}\\hat{\\mathbf{d}}$. So the normal vector is:\n$$\\hat{\\mathbf{n}}_{\\mathrm{exit}} = \\frac{(\\mathbf{o} + t_{\\text{next}}\\hat{\\mathbf{d}}) - \\mathbf{c}}{r} = \\frac{(\\mathbf{o} - \\mathbf{c}) + t_{\\text{next}}\\hat{\\mathbf{d}}}{r} = \\frac{\\mathbf{v} + t_{\\text{next}}\\hat{\\mathbf{d}}}{r}$$\nThe desired quantity is $\\cos\\theta = \\hat{\\mathbf{d}} \\cdot \\hat{\\mathbf{n}}_{\\mathrm{exit}}$:\n$$\\cos\\theta = \\hat{\\mathbf{d}} \\cdot \\left(\\frac{\\mathbf{v} + t_{\\text{next}}\\hat{\\mathbf{d}}}{r}\\right) = \\frac{\\hat{\\mathbf{d}} \\cdot \\mathbf{v} + t_{\\text{next}}(\\hat{\\mathbf{d}} \\cdot \\hat{\\mathbf{d}})}{r}$$\nUsing $\\hat{\\mathbf{d}} \\cdot \\hat{\\mathbf{d}}=1$, $\\mathbf{v} \\cdot \\hat{\\mathbf{d}} = -4$, $r=50$, and $t_{\\text{next}} = t_{\\text{sphere}} = 4 + 2\\sqrt{479}$:\n$$\\cos\\theta = \\frac{-4 + (4 + 2\\sqrt{479})}{50} = \\frac{2\\sqrt{479}}{50} = \\frac{\\sqrt{479}}{25}$$\n\n**5. Numerical Calculation**\n\nWe now compute the final numerical value and round it to $4$ significant figures.\n$$\\cos\\theta = \\frac{\\sqrt{479}}{25} \\approx \\frac{21.88607}{25} \\approx 0.8754428$$\nRounding to $4$ significant figures gives $0.8754$.",
            "answer": "$$\\boxed{0.8754}$$"
        },
        {
            "introduction": "While many introductory problems assume homogeneous materials, real-world scenarios often involve media with spatially varying compositions and densities. This advanced practice introduces a powerful and elegant solution: the null-collision method, also known as Woodcock tracking. You will implement this rejection sampling technique to simulate particle transport through a heterogeneous medium, a task that is intractable with direct sampling methods, thereby developing a robust algorithm essential for high-fidelity simulations. ",
            "id": "3535387",
            "problem": "You are to derive from first principles and implement a complete, runnable program that simulates the next interaction event for a single photon of energy $E$ traveling along a straight line in a spatially heterogeneous one-dimensional slab medium. The photon starts at position $x_0$ within a slab geometry $x \\in [0,L]$ and travels in direction $\\hat{u} \\in \\{+1,-1\\}$ along the $x$-axis. The local macroscopic reaction cross sections $\\Sigma_k(E,x)$ for the three processes $k \\in \\{\\text{photoelectric}, \\text{Compton}, \\text{pair production}\\}$ are known functions of position and energy. You must design and justify a robust algorithm to sample both the next reaction type and the corresponding free path length from the photon’s current state in this heterogeneous medium.\n\nBegin your reasoning from the following fundamental base:\n- The Beer–Lambert law of attenuation and the definition of macroscopic cross section: in a homogeneous region with total macroscopic cross section $\\Sigma_t(E)$, the free path $s$ to the next interaction is exponentially distributed with probability density $p(s) = \\Sigma_t(E)\\,\\exp\\!\\left(-\\Sigma_t(E)\\,s\\right)$ for $s \\ge 0$, and the survival probability over a path length $s$ is $\\exp\\!\\left(-\\Sigma_t(E)\\,s\\right)$.\n- In a spatially heterogeneous medium, the survival probability to distance $s$ is $\\exp\\!\\left(-\\int_0^s \\Sigma_t\\!\\left(E, x(s')\\right)\\,\\mathrm{d}s'\\right)$, where $\\Sigma_t = \\Sigma_{\\text{photoelectric}} + \\Sigma_{\\text{Compton}} + \\Sigma_{\\text{pair}}$ and $x(s')$ is the position along the photon’s path parameterized by path length $s'$.\n- Reaction channel selection at an interaction point is governed by local probabilities $p_k(E,x) = \\Sigma_k(E,x)/\\Sigma_t(E,x)$.\n\nYour algorithm must be robust to strong spatial variation of $\\Sigma_t(E,x)$ and must correctly handle boundary escape from the slab. The derivation should make clear how to sample free paths without inverting a nontrivial line integral of $\\Sigma_t(E,x)$ and why the approach is unbiased. You must also justify how the reaction type is sampled at a realized interaction point. The algorithm should terminate either by sampling a real interaction and assigning a reaction type, or by determining that the photon escapes the slab before any real interaction.\n\nFor testability, use the following scientifically plausible, self-consistent definitions for the heterogeneous slab of extent $x \\in [0,L]$ with $L$ in $\\mathrm{cm}$, and for the macroscopic cross sections in $\\mathrm{cm}^{-1}$. Define the electron rest mass energy as $m_e c^2 = 0.511\\,\\mathrm{MeV}$ and the pair production threshold as $E_{\\text{th}} = 2 m_e c^2 = 1.022\\,\\mathrm{MeV}$. Use a reference energy $E_{\\text{ref}} = 0.5\\,\\mathrm{MeV}$. Let the base coefficients be $a_0 = 2.0\\,\\mathrm{cm}^{-1}$, $b_0 = 0.2\\,\\mathrm{cm}^{-1}$, and $c_0 = 0.5\\,\\mathrm{cm}^{-1}$. The macroscopic cross sections are:\n- $\\Sigma_{\\text{photoelectric}}(E,x) = a_0 \\left(\\dfrac{E_{\\text{ref}}}{E}\\right)^3 \\left(1 + 0.5 \\sin\\!\\left(\\dfrac{\\pi x}{L}\\right)\\right)$,\n- $\\Sigma_{\\text{Compton}}(E,x) = b_0 \\left(1 + 0.3 \\cos\\!\\left(\\dfrac{\\pi x}{L}\\right)\\right)$,\n- $\\Sigma_{\\text{pair}}(E,x) = \\begin{cases}\n0, & E < E_{\\text{th}},\\\\ [6pt]\nc_0 \\left(1 - \\dfrac{E_{\\text{th}}}{E}\\right)\\left(1 + 0.2\\,e^{-x/L}\\right), & E \\ge E_{\\text{th}}.\n\\end{cases}$\n\nLet the total macroscopic cross section be $\\Sigma_t(E,x) = \\Sigma_{\\text{photoelectric}}(E,x) + \\Sigma_{\\text{Compton}}(E,x) + \\Sigma_{\\text{pair}}(E,x)$. To enable a robust free-path sampling in the heterogeneous medium, you must construct a constant majorant cross section $\\Sigma_M(E)$ such that $\\Sigma_t(E,x) \\le \\Sigma_M(E)$ for all $x \\in [0,L]$. Using the bounded factors in the definitions above, a valid majorant is:\n$$\n\\Sigma_M(E) = a_0 \\left(\\dfrac{E_{\\text{ref}}}{E}\\right)^3 \\left(1 + 0.5\\right)\n+ b_0 \\left(1 + 0.3\\right)\n+ \\begin{cases}\n0, & E < E_{\\text{th}},\\\\ [6pt]\nc_0 \\left(1 - \\dfrac{E_{\\text{th}}}{E}\\right)\\left(1 + 0.2\\right), & E \\ge E_{\\text{th}}.\n\\end{cases}\n$$\n\nYou must implement the following computational scenario:\n- Geometry: one-dimensional slab $x \\in [0,L]$ with $L = 10.0\\,\\mathrm{cm}$.\n- Photon state: initial position $x_0$ and direction $\\hat{u} \\in \\{+1,-1\\}$; the path length $s$ accumulates along the ray $x(s) = x_0 + \\hat{u}\\,s$.\n- Termination: if the photon would cross the boundary before any real interaction, declare escape and output the path length to boundary from the starting position.\n\nReaction type encoding for output must be: photoelectric $\\to 1$, Compton $\\to 2$, pair production $\\to 3$, and escape with no interaction $\\to 0$.\n\nRandomness and reproducibility:\n- Use a Pseudo-Random Number Generator initialized with the fixed seed $12345$.\n- All random variables required by your algorithm must be sampled from the uniform distribution on $[0,1)$.\n\nPhysical units and numeric output:\n- Express the free path length in $\\mathrm{cm}$ as a floating-point number.\n- The reaction type must be an integer code as specified above.\n\nTest suite:\n- Case $1$: $E = 0.5\\,\\mathrm{MeV}$, $x_0 = 0.0\\,\\mathrm{cm}$, $\\hat{u} = +1$, $L = 10.0\\,\\mathrm{cm}$.\n- Case $2$: $E = 2.5\\,\\mathrm{MeV}$, $x_0 = 9.8\\,\\mathrm{cm}$, $\\hat{u} = +1$, $L = 10.0\\,\\mathrm{cm}$.\n- Case $3$: $E = 1.022\\,\\mathrm{MeV}$, $x_0 = 5.0\\,\\mathrm{cm}$, $\\hat{u} = -1$, $L = 10.0\\,\\mathrm{cm}$.\n\nYour program must implement a robust heterogeneous free-path sampling and reaction selection algorithm and produce a single line of output containing the results as a comma-separated list enclosed in square brackets with each test case summarized by a two-element list $[\\text{code}, \\text{free path in cm}]$. Specifically, the final output must have the exact format:\n$$\n\\texttt{[[code\\_1,freepath\\_1],[code\\_2,freepath\\_2],[code\\_3,freepath\\_3]]}\n$$\nwhere each $\\texttt{code\\_i}$ is an integer and each $\\texttt{freepath\\_i}$ is a floating-point number in $\\mathrm{cm}$.",
            "solution": "A photon propagating through matter experiences stochastic interactions governed by the macroscopic reaction cross sections. In a homogeneous medium with total macroscopic cross section $\\Sigma_t(E)$, the free path $s$ is exponentially distributed with probability density $p(s) = \\Sigma_t(E)\\,e^{-\\Sigma_t(E)\\,s}$ for $s \\ge 0$, and the survival probability to distance $s$ is $S(s) = e^{-\\Sigma_t(E)\\,s}$. In a heterogeneous medium where the total macroscopic cross section depends on position, the survival probability generalizes to\n$$\nS(s) = \\exp\\!\\left(-\\int_0^s \\Sigma_t\\!\\left(E, x(s')\\right)\\,\\mathrm{d}s'\\right),\n$$\nwith $x(s) = x_0 + \\hat{u}\\,s$ along a straight trajectory in one dimension.\n\nDirect inversion of $S(s)$ to sample $s$ is generally intractable when $\\Sigma_t(E,x)$ varies nontrivially with position. A robust approach is the null-collision method (also known as Woodcock tracking), which relies on Poisson thinning. The idea is to envelop the spatially varying interaction rate with a constant majorant rate $\\Sigma_M(E) \\ge \\Sigma_t(E,x)$ for all positions $x$ in the domain. Real interactions are then obtained by sampling potential interactions from a homogeneous Poisson process of rate $\\Sigma_M(E)$ and accepting each potential event as real with acceptance probability $\\Sigma_t(E,x)/\\Sigma_M(E)$ at the event’s location; otherwise, the event is treated as a null collision that leaves the particle’s state unchanged except for its position along the path.\n\nTo justify correctness, consider a homogeneous Poisson process in path length with rate $\\Sigma_M(E)$. The probability that the first proposed event at path length $s$ is accepted as real is\n$$\n\\left[\\Sigma_M(E)\\,e^{-\\Sigma_M(E)\\,s}\\,\\mathrm{d}s\\right] \\times \\left[\\frac{\\Sigma_t(E,x(s))}{\\Sigma_M(E)}\\right] = \\Sigma_t(E,x(s))\\,e^{-\\Sigma_M(E)\\,s}\\,\\mathrm{d}s.\n$$\nAllowing for the possibility of preceding null collisions, the distribution of the first real event along the path has density\n$$\np_{\\text{real}}(s) = \\Sigma_t(E,x(s))\\,\\exp\\!\\left(-\\int_0^s \\Sigma_t(E,x(s'))\\,\\mathrm{d}s'\\right),\n$$\nwhich is the hazard-rate characterization of the first event in an inhomogeneous Poisson process with rate $\\Sigma_t(E,x(s))$. This aligns with the survival probability $S(s)$ in the heterogeneous case, proving that the null-collision approach yields unbiased sampling of the free path to the first real interaction.\n\nAlgorithmic design:\n- Precompute the constant majorant $\\Sigma_M(E)$ that bounds $\\Sigma_t(E,x)$ over the slab. Given the functional forms, the bounded factors achieve maxima at $\\sin(\\cdot) = 1$, $\\cos(\\cdot) = 1$, and $e^{-x/L} \\le 1$, which yields:\n$$\n\\Sigma_M(E) = a_0 \\left(\\frac{E_{\\text{ref}}}{E}\\right)^3 \\left(1 + 0.5\\right)\n+ b_0 \\left(1 + 0.3\\right)\n+ \\begin{cases}\n0, & E < E_{\\text{th}},\\\\ [6pt]\nc_0 \\left(1 - \\dfrac{E_{\\text{th}}}{E}\\right)\\left(1 + 0.2\\right), & E \\ge E_{\\text{th}}.\n\\end{cases}\n$$\nThis ensures $\\Sigma_t(E,x) \\le \\Sigma_M(E)$ for all $x \\in [0,L]$.\n\n- Initialize the photon at $x_0$ with direction $\\hat{u} \\in \\{+1,-1\\}$ and set the accumulated path length $s_{\\text{tot}} = 0$.\n\n- Iterate:\n  1. Sample a proposed free path increment $s_{\\Delta}$ from the exponential distribution with rate $\\Sigma_M(E)$ via inverse transform sampling: $s_{\\Delta} = -\\ln(U)/\\Sigma_M(E)$, where $U \\sim \\mathcal{U}[0,1)$.\n  2. Compute the distance to the nearest boundary along $\\hat{u}$ from the current position $x$:\n     $$\n     d_{\\text{exit}} = \\begin{cases}\n     L - x, & \\hat{u} = +1,\\\\\n     x, & \\hat{u} = -1.\n     \\end{cases}\n     $$\n     If $s_{\\Delta} > d_{\\text{exit}}$, the photon escapes before any potential event; record an escape with reaction code $0$ and free path $s_{\\text{tot}} + d_{\\text{exit}}$ in $\\mathrm{cm}$, and terminate.\n  3. Otherwise, advance to $x \\leftarrow x + \\hat{u}\\,s_{\\Delta}$ and accumulate $s_{\\text{tot}} \\leftarrow s_{\\text{tot}} + s_{\\Delta}$.\n  4. Evaluate the local macroscopic cross sections at $(E,x)$:\n     $$\n     \\Sigma_{\\text{photoelectric}}(E,x),\\quad\n     \\Sigma_{\\text{Compton}}(E,x),\\quad\n     \\Sigma_{\\text{pair}}(E,x).\n     $$\n     Form the total $\\Sigma_t(E,x)$ by summation.\n  5. Accept this event as a real interaction with probability $p_{\\text{acc}} = \\Sigma_t(E,x)/\\Sigma_M(E)$. Draw $U' \\sim \\mathcal{U}[0,1)$. If $U' > p_{\\text{acc}}$, treat as a null collision and return to step $1$.\n  6. If accepted, select the reaction type by partitioning the unit interval according to $p_k(E,x) = \\Sigma_k(E,x)/\\Sigma_t(E,x)$. Draw $U'' \\sim \\mathcal{U}[0,1)$ and choose:\n     $$\n     \\text{photoelectric if } U'' < p_{\\text{photoelectric}},\\quad\n     \\text{Compton if } p_{\\text{photoelectric}} \\le U'' < p_{\\text{photoelectric}} + p_{\\text{Compton}},\\quad\n     \\text{pair production otherwise}.\n     $$\n     Encode the reaction as $1$ (photoelectric), $2$ (Compton), or $3$ (pair production). Output the reaction code and $s_{\\text{tot}}$ in $\\mathrm{cm}$, and terminate.\n\nCorrectness and robustness:\n- The null-collision scheme yields an unbiased sample of the first real interaction distance in an inhomogeneous medium because it realizes the inhomogeneous Poisson process via thinning of a homogeneous process with rate $\\Sigma_M(E)$.\n- The acceptance probability $p_{\\text{acc}} = \\Sigma_t(E,x)/\\Sigma_M(E)$ respects $0 \\le p_{\\text{acc}} \\le 1$ since $\\Sigma_M(E)$ bounds $\\Sigma_t(E,x)$.\n- Reaction channel selection is consistent with local probabilities $p_k(E,x)$ derived from macroscopic cross sections.\n- Boundary escape is correctly handled by comparing the proposed exponential step to the distance to boundary, ensuring termination even in regions of zero or very small real interaction rates.\n\nApplication to the specified test suite:\n- Case $1$ uses $E = 0.5\\,\\mathrm{MeV}$, where $\\Sigma_{\\text{pair}} = 0$ due to $E < E_{\\text{th}}$. The majorant is dominated by the photoelectric term because of the approximate $E^{-3}$ dependence.\n- Case $2$ uses $E = 2.5\\,\\mathrm{MeV}$, with $x_0$ near the upper boundary and $\\hat{u} = +1$; escape is plausible if the proposed exponential step exceeds the remaining distance to $x = L$.\n- Case $3$ uses $E = 1.022\\,\\mathrm{MeV}$ at threshold; by construction, $\\Sigma_{\\text{pair}} = 0$ at threshold, but photoelectric and Compton remain nonzero. The direction $\\hat{u} = -1$ drives motion toward the lower boundary.\n\nImplementation details:\n- Use a Pseudo-Random Number Generator seeded with $12345$ to ensure reproducible sampling across runs.\n- Compute the free path length in $\\mathrm{cm}$ and return the integer reaction code as specified.\n- Aggregate the outputs for the three test cases in the exact single-line format:\n$\\texttt{[[code\\_1,freepath\\_1],[code\\_2,freepath\\_2],[code\\_3,freepath\\_3]]}$.\n\nThis design integrates the fundamental physics of exponential attenuation and macroscopic cross sections with a principled sampling method suitable for spatial heterogeneity, ensuring both correctness and computational robustness.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Constants in MeV and cm\nE_REF = 0.5  # MeV\nME_C2 = 0.511  # MeV\nE_TH = 2.0 * ME_C2  # MeV, pair production threshold\nA0 = 2.0  # cm^-1\nB0 = 0.2  # cm^-1\nC0 = 0.5  # cm^-1\n\ndef sigma_photoelectric(E, x, L):\n    # a0 * (E_ref/E)^3 * (1 + 0.5*sin(pi*x/L))\n    return A0 * (E_REF / E) ** 3 * (1.0 + 0.5 * np.sin(np.pi * x / L))\n\ndef sigma_compton(E, x, L):\n    # b0 * (1 + 0.3*cos(pi*x/L))\n    return B0 * (1.0 + 0.3 * np.cos(np.pi * x / L))\n\ndef sigma_pair(E, x, L):\n    # c0 * (1 - E_th/E) * (1 + 0.2*exp(-x/L)) for E >= E_th, else 0\n    if E  E_TH:\n        return 0.0\n    return C0 * (1.0 - E_TH / E) * (1.0 + 0.2 * np.exp(-x / L))\n\ndef sigma_total(E, x, L):\n    sp = sigma_photoelectric(E, x, L)\n    sc = sigma_compton(E, x, L)\n    spp = sigma_pair(E, x, L)\n    return sp + sc + spp, sp, sc, spp\n\ndef sigma_majorant(E):\n    # Max over x in [0, L] using bounded factors:\n    # sin term max = 1, cos term max = 1, exp(-x/L) max = 1\n    photo_max = A0 * (E_REF / E) ** 3 * (1.0 + 0.5)\n    compton_max = B0 * (1.0 + 0.3)\n    if E  E_TH:\n        pair_max = 0.0\n    else:\n        pair_max = C0 * (1.0 - E_TH / E) * (1.0 + 0.2)\n    return photo_max + compton_max + pair_max\n\ndef sample_next_event(E, x0, u, L, rng):\n    \"\"\"\n    Returns (code, free_path_cm)\n    code: 0 escape, 1 photoelectric, 2 Compton, 3 pair production\n    free_path_cm: total path length to event or boundary in cm\n    \"\"\"\n    sigmaM = sigma_majorant(E)\n    # Handle degenerate case where sigmaM is zero (should not occur with given definitions)\n    if sigmaM = 0.0:\n        # No interactions anywhere; just escape to boundary\n        if u > 0:\n            return 0, float(L - x0)\n        else:\n            return 0, float(x0)\n\n    s_tot = 0.0\n    x = x0\n\n    while True:\n        # Sample exponential step with rate sigmaM\n        U = rng.random()\n        # Guard against log(0)\n        while U = 0.0:\n            U = rng.random()\n        s_step = -np.log(U) / sigmaM\n\n        # Distance to boundary along direction u\n        d_exit = (L - x) if (u > 0) else x\n\n        if s_step > d_exit:\n            # Escape before reaching a proposed event\n            s_tot += d_exit\n            return 0, float(s_tot)\n\n        # Advance to proposed event location\n        x = x + u * s_step\n        s_tot += s_step\n\n        # Compute local cross sections\n        sig_t, sig_p, sig_c, sig_pp = sigma_total(E, x, L)\n\n        # Acceptance probability for a real event\n        p_acc = sig_t / sigmaM\n\n        # Accept or reject\n        U_acc = rng.random()\n        if U_acc = p_acc:\n            # Real interaction: select channel\n            if sig_t = 0.0:\n                # Degenerate case: no real processes here, treat as null and continue\n                continue\n            # Probabilities\n            p_photo = sig_p / sig_t\n            p_comp = sig_c / sig_t\n            # p_pair = sig_pp / sig_t = 1 - p_photo - p_comp\n\n            U_sel = rng.random()\n            if U_sel  p_photo:\n                code = 1\n            elif U_sel  p_photo + p_comp:\n                code = 2\n            else:\n                code = 3\n            return code, float(s_tot)\n        # else: null collision, continue looping\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (E [MeV], x0 [cm], u (direction), L [cm])\n    test_cases = [\n        (0.5, 0.0, +1, 10.0),    # Case 1\n        (2.5, 9.8, +1, 10.0),    # Case 2\n        (1.022, 5.0, -1, 10.0),  # Case 3\n    ]\n\n    rng = np.random.default_rng(12345)\n\n    results = []\n    for E, x0, u, L in test_cases:\n        code, s = sample_next_event(E, x0, u, L, rng)\n        results.append((code, s))\n\n    # Build exact required format without spaces: [[code1,freepath1],[code2,freepath2],...]\n    # Ensure float representation is standard; convert to string directly.\n    formatted = \"[\" + \",\".join(f\"[{c},{repr(s)}]\" for c, s in results) + \"]\"\n    print(formatted)\n\nsolve()\n```"
        }
    ]
}