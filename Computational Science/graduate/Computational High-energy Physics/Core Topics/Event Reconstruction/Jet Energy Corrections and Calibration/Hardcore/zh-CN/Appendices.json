{
    "hands_on_practices": [
        {
            "introduction": "在高亮度对撞机环境中，多重质子-质子相互作用（称为“堆积效应”）会产生弥散的软粒子本底，污染喷注的能量测量。本练习将引导你完成喷注能量修正的第一步：堆积效应减除。你将应用一种基于喷注面积的标准方法来估算和减去本底能量的贡献，并学习如何将堆积效应能量密度的不确定性传递到修正后的喷注动量上。",
            "id": "3519002",
            "problem": "在高亮度质子-质子对撞环境中，来自多次相互作用的弥散软背景在快度-方位角平面上贡献了近似均匀的横向动量密度，记为 $\\rho$，其单位为 $(y,\\phi)$ 平面上的 $\\mathrm{GeV}$/单位面积。考虑一个用半径参数 $R=0.4$ 的 anti-$k_t$ 算法重建的喷注，其原始横向动量（在任何背景扣除前）测量为 $p_{T}^{\\mathrm{raw}}$。该喷注对均匀弥散背景的敏感性由其有效面积 $A$（无量纲，以 $(\\Delta y)(\\Delta \\phi)$ 为单位）来量化，它表征了在均匀密度假设下，平均有多少背景进入该喷注。\n\n假设均匀背景线性地叠加到喷注的横向动量上，使得其预期贡献与喷注面积和背景密度成正比。在这些假设下：\n- 从 $\\rho$ 作为单位面积上的平均横向动量密度的定义，以及背景和信号对 $p_{T}^{\\mathrm{raw}}$ 的线性叠加贡献出发。\n- 推导出一个真实喷注横向动量（无弥散背景影响）的估计量，记为 $p_{T}^{\\mathrm{corr}}$，用 $p_{T}^{\\mathrm{raw}}$、$\\rho$ 和 $A$ 表示。\n- 假设 $\\rho$ 的统计不确定度是高斯的，其标准差为 $\\sigma_{\\rho}$，且与喷注测量及 $A$ 无关，传播这个不确定度以获得仅由 $\\rho$ 的不确定度引起的 $p_{T}^{\\mathrm{corr}}$ 的标准差。\n\n给定单个喷注的以下事例级和喷注级物理量：\n- $p_{T}^{\\mathrm{raw}} = 247.8~\\mathrm{GeV}$，\n- $A = 0.503$，\n- $\\rho = 18.7~\\mathrm{GeV}$/单位面积，\n- $\\sigma_{\\rho} = 1.6~\\mathrm{GeV}$/单位面积。\n\n计算 $p_{T}^{\\mathrm{corr}}$ 的数值以及仅由 $\\sigma_{\\rho}$ 传播产生的不确定度的标准差。将修正后的横向动量和传播的标准差都以 $\\mathrm{GeV}$ 为单位表示。将你的答案四舍五入到四位有效数字。",
            "solution": "用户提供了一个计算高能物理领域的问题，具体涉及为来自堆积效应的背景贡献而对喷注横向动量进行修正。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n-   弥散软背景横向动量密度：$\\rho$（$(y,\\phi)$ 平面上的 $\\mathrm{GeV}$/单位面积）。\n-   喷注聚类算法：anti-$k_{t}$，半径参数 $R=0.4$。\n-   原始喷注横向动量：$p_{T}^{\\mathrm{raw}}$。\n-   喷注有效面积：$A$（无量纲，单位为 $(\\Delta y)(\\Delta \\phi)$）。\n-   物理模型：背景线性地叠加到喷注的横向动量上，其贡献是密度和面积的乘积。原始动量是线性叠加：$p_{T}^{\\mathrm{raw}} = p_{T}^{\\mathrm{corr}} + p_{T}^{\\mathrm{bkgd}}$。\n-   $\\rho$ 的不确定度：高斯分布，标准差为 $\\sigma_{\\rho}$，与其他变量无关。\n-   数值：\n    -   $p_{T}^{\\mathrm{raw}} = 247.8~\\mathrm{GeV}$\n    -   $A = 0.503$\n    -   $\\rho = 18.7~\\mathrm{GeV}$/单位面积\n    -   $\\sigma_{\\rho} = 1.6~\\mathrm{GeV}$/单位面积\n-   要求输出：\n    1.  修正后喷注横向动量 $p_{T}^{\\mathrm{corr}}$ 的解析表达式。\n    2.  由 $\\rho$ 的不确定度引起的 $p_{T}^{\\mathrm{corr}}$ 标准差的解析表达式。\n    3.  $p_{T}^{\\mathrm{corr}}$ 及其不确定度的数值，四舍五入到四位有效数字。\n\n**步骤2：使用提取的已知条件进行验证**\n-   **科学依据：** 该问题描述了实验粒子物理中一种标准的、成熟的技术，用于减轻堆积效应（多个质子-质子同时相互作用）对重建喷注的影响。横向动量密度 $\\rho$、喷注有效面积 $A$ 以及线性减除模型是这一程序的基础概念，被大型强子对撞机（LHC）的实验广泛使用。所提供的数值对于在高亮度环境下产生的喷注是物理上现实的。\n-   **适定性：** 问题提供了一个清晰的物理模型和所有必需的数据来推导所要求的表达式并计算数值结果。它要求一个唯一、稳定且有意义的解。\n-   **客观性：** 语言正式、精确，没有任何主观或基于观点的陈述。\n\n**步骤3：结论与行动**\n该问题在科学上是合理的、适定的、客观的和完整的。这是一个有效的问题陈述。我将继续进行完整解答。\n\n### 推导与计算\n\n**第一部分：修正后横向动量估计量的推导**\n\n问题陈述，原始测量的横向动量 $p_{T}^{\\mathrm{raw}}$ 是真实喷注横向动量 $p_{T}^{\\mathrm{corr}}$ 和来自均匀背景的贡献 $p_{T}^{\\mathrm{bkgd}}$ 的线性总和。\n$$p_{T}^{\\mathrm{raw}} = p_{T}^{\\mathrm{corr}} + p_{T}^{\\mathrm{bkgd}}$$\n背景贡献被建模为横向动量密度 $\\rho$ 和喷注有效面积 $A$ 的乘积。单位是一致的：$[\\rho] \\times [A] = (\\mathrm{GeV}/\\text{面积}) \\times \\text{面积} = \\mathrm{GeV}$。\n$$p_{T}^{\\mathrm{bkgd}} = \\rho \\cdot A$$\n将此代入第一个方程，得到原始动量和修正后动量之间的关系：\n$$p_{T}^{\\mathrm{raw}} = p_{T}^{\\mathrm{corr}} + \\rho \\cdot A$$\n解出修正后的横向动量 $p_{T}^{\\mathrm{corr}}$，即可得到所需的估计量：\n$$p_{T}^{\\mathrm{corr}} = p_{T}^{\\mathrm{raw}} - \\rho \\cdot A$$\n\n**第二部分：不确定度传播**\n\n我们被要求找出 $p_{T}^{\\mathrm{corr}}$ 的标准差，记为 $\\sigma_{p_{T}^{\\mathrm{corr}}}$，它仅由背景密度 $\\sigma_{\\rho}$ 的不确定度引起。在此计算中，$p_{T}^{\\mathrm{raw}}$ 和 $A$ 被视为不确定度为零的常数。\n\n对于一个函数 $f(x_1, x_2, \\ldots, x_n)$，其中变量 $x_i$ 不相关且标准差为 $\\sigma_{x_i}$，其不确定度传播的通用公式是：\n$$\\sigma_{f}^{2} = \\sum_{i=1}^{n} \\left(\\frac{\\partial f}{\\partial x_i}\\right)^2 \\sigma_{x_i}^2$$\n在我们的情况中，函数是 $p_{T}^{\\mathrm{corr}} = p_{T}^{\\mathrm{corr}}(p_{T}^{\\mathrm{raw}}, \\rho, A)$，并且我们只考虑 $\\rho$ 的不确定度。因此，$p_{T}^{\\mathrm{corr}}$ 的方差是：\n$$\\sigma_{p_{T}^{\\mathrm{corr}}}^{2} = \\left(\\frac{\\partial p_{T}^{\\mathrm{corr}}}{\\partial \\rho}\\right)^2 \\sigma_{\\rho}^2$$\n我们计算 $p_{T}^{\\mathrm{corr}}$ 对 $\\rho$ 的偏导数：\n$$\\frac{\\partial p_{T}^{\\mathrm{corr}}}{\\partial \\rho} = \\frac{\\partial}{\\partial \\rho} \\left( p_{T}^{\\mathrm{raw}} - \\rho \\cdot A \\right) = -A$$\n将此代回方差方程：\n$$\\sigma_{p_{T}^{\\mathrm{corr}}}^{2} = (-A)^2 \\sigma_{\\rho}^2 = A^2 \\sigma_{\\rho}^2$$\n取平方根得到标准差。由于有效面积 $A$ 是一个物理量，必须为非负值，所以我们有 $|A|=A$。\n$$\\sigma_{p_{T}^{\\mathrm{corr}}} = \\sqrt{A^2 \\sigma_{\\rho}^2} = A \\cdot \\sigma_{\\rho}$$\n\n**第三部分：数值计算**\n\n我们现在将提供的数值代入推导出的表达式中。\n已知：\n-   $p_{T}^{\\mathrm{raw}} = 247.8~\\mathrm{GeV}$\n-   $A = 0.503$\n-   $\\rho = 18.7~\\mathrm{GeV}$\n-   $\\sigma_{\\rho} = 1.6~\\mathrm{GeV}$\n\n首先，我们计算修正后的横向动量 $p_{T}^{\\mathrm{corr}}$：\n$$p_{T}^{\\mathrm{corr}} = p_{T}^{\\mathrm{raw}} - \\rho \\cdot A = 247.8 - (18.7 \\cdot 0.503)$$\n$$p_{T}^{\\mathrm{corr}} = 247.8 - 9.4061 = 238.3939$$\n四舍五入到四位有效数字，我们得到：\n$$p_{T}^{\\mathrm{corr}} \\approx 238.4~\\mathrm{GeV}$$\n\n接下来，我们计算传播的不确定度 $\\sigma_{p_{T}^{\\mathrm{corr}}}$：\n$$\\sigma_{p_{T}^{\\mathrm{corr}}} = A \\cdot \\sigma_{\\rho} = 0.503 \\cdot 1.6$$\n$$\\sigma_{p_{T}^{\\mathrm{corr}}} = 0.8048$$\n这个值已经有四位有效数字。单位是 $\\mathrm{GeV}$。\n$$\\sigma_{p_{T}^{\\mathrm{corr}}} = 0.8048~\\mathrm{GeV}$$\n\n因此，修正后的横向动量及其仅由 $\\rho$ 的不确定度引起的标准差的最终数值结果分别为 $238.4~\\mathrm{GeV}$ 和 $0.8048~\\mathrm{GeV}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n238.4  0.8048\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在完成初步的堆积效应修正后，喷注的能量响应通常仍会依赖于其运动学变量（如赝快度 $η$ 和横向动量 $p_T$）以及粒子成分。为了实现均匀且线性的能量响应，必须构建一个更复杂的、多参数的修正函数。本练习是一个综合性项目，模拟了真实实验中喷注能量校准的完整流程，你将通过一个参数化的生成模型来模拟非补偿性量能器的行为，并拟合一个校准函数以实现平坦的能量响应。",
            "id": "3519032",
            "problem": "您的任务是为一个电磁与强子响应比满足 $e/h \\neq 1$ 的非补偿量能器中的喷注（jet）构建并验证一个计算校准。最终目标是找到并拟合一个非线性乘性修正函数 $C(\\eta,p_T)$，使得修正后的响应 $R(E) = E_{\\text{meas}}/E_{\\text{true}}$ 在不同粒子种类和能量范围内被拉平在 $\\pm 0.01$ 之内。尽管这个问题的灵感来自于 Geometry and Tracking 4 (GEANT4) 模拟环境，但您必须使用一个自洽的参数化生成模型，该模型模仿了非补偿量能器行为的显著特征，然后进行数值拟合。所有能量必须以 $\\text{GeV}$ 为单位表示，赝快度 $\\eta$ 是无量纲的，横向动量 $p_T$ 的单位是 $\\text{GeV}$。最终输出是无量纲的布尔值，指示是否满足拉平标准。\n\n基础建模假设与生成模型：\n- 从无质量喷注的标准喷注运动学关系 $E_{\\text{true}} = p_T \\cosh(\\eta)$ 开始，该关系源于高相对论性粒子的横向动量和赝快度的定义。\n- 在一个 $e/h = r$ 的非补偿量能器中，对于电磁能量分数为 $f_{\\text{em}}$ 的单个喷注，其基线电磁/强子响应被建模为 $R_{\\text{base}}(f_{\\text{em}};r) = f_{\\text{em}} + \\frac{1 - f_{\\text{em}}}{r}$，这是一种广泛使用的唯象表示，由子簇射的线性叠加（按其各自的响应常数加权）推导得出。\n- 量能器响应还表现出对赝快度和横向动量的依赖性，以及轻微的能量非线性。定义以下无量纲乘性因子，每个因子都有界且平滑，以模拟真实的探测器非理想性：\n  1. 赝快度依赖性：$S(\\eta) = 1 + a_2 |\\eta|^2 + a_4 |\\eta|^4$。\n  2. 横向动量依赖性：$G(p_T) = 1 - \\frac{b_1}{1 + p_T/p_0} + \\frac{b_2}{1 + (p_T/p_1)^2}$。\n  3. 能量非线性：$N(E_{\\text{true}}) = 1 + n_1 \\frac{\\ln(E_{\\text{true}}/E_0)}{1 + [\\ln(E_{\\text{true}}/E_0)]^2}$。\n- 测得的能量则为 $E_{\\text{meas}} = E_{\\text{true}} \\cdot R_{\\text{base}}(f_{\\text{em}};r) \\cdot S(\\eta) \\cdot G(p_T) \\cdot N(E_{\\text{true}}) \\cdot \\epsilon$，其中 $\\epsilon$ 编码了随机弥散，其分辨率遵循标准的强子量能器参数化：\n  $$\\frac{\\sigma}{E_{\\text{true}}} = \\sqrt{\\left(\\frac{S_{\\text{res}}}{\\sqrt{E_{\\text{true}}}}\\right)^2 + \\left(\\frac{N_{\\text{res}}}{E_{\\text{true}}}\\right)^2 + C_{\\text{res}}^2},$$\n  并且弥散作为乘性因子 $\\epsilon = 1 + \\delta$ 应用，其中 $\\delta \\sim \\mathcal{N}(0, \\sigma/E_{\\text{true}})$。\n\n电磁分数模型：\n- 考虑三种喷注种类，记为 $s \\in \\{\\text{quark}, \\text{gluon}, \\text{charged}\\}$，分别代表轻夸克喷注、胶子喷注和带电强子分数高的喷注。它们的平均电磁分数通过以下方式依赖于 $p_T$：\n  $$\\mu_s(p_T) = \\mu_{0,s} + \\alpha \\tanh\\left(\\ln\\left(\\frac{p_T}{p_*}\\right)\\right),$$\n  其中 $\\mu_{0,\\text{quark}} = 0.35$，$\\mu_{0,\\text{gluon}} = 0.30$，$\\mu_{0,\\text{charged}} = 0.25$，$\\alpha = 0.12$ 且 $p_* = 50\\,\\text{GeV}$。为求真实，从一个均值为 $\\mu_s(p_T)$、集中度为 $\\kappa = 20$ 的贝塔分布中抽取 $f_{\\text{em}}$，即参数 $a = \\mu_s(p_T)\\kappa$ 和 $b = (1 - \\mu_s(p_T))\\kappa$，然后将其值限制在 $[0.01, 0.99]$ 区间内以避免简并。\n\n固定的物理和模型参数：\n- 非补偿比：$r = 1.20$。\n- 赝快度响应参数：$a_2 = 0.015$，$a_4 = 0.001$。\n- 横向动量响应参数：$b_1 = 0.03$，$p_0 = 30\\,\\text{GeV}$，$b_2 = 0.02$，$p_1 = 100\\,\\text{GeV}$。\n- 能量非线性参数：$n_1 = 0.02$，$E_0 = 50\\,\\text{GeV}$。\n- 分辨率参数：$S_{\\text{res}} = 0.8$，$N_{\\text{res}} = 1.0\\,\\text{GeV}$，$C_{\\text{res}} = 0.03$。\n\n校准目标：\n- 您必须拟合一个严格为正的修正函数 $C(\\eta, p_T)$，该函数仅依赖于 $\\eta$ 和 $p_T$，通过多项式基的指数形式定义以确保其正性：\n  $$C(\\eta, p_T) = \\exp\\left(\\theta_0 + \\theta_1 |\\eta| + \\theta_2 |\\eta|^2 + \\theta_3 \\ln p_T + \\theta_4 (\\ln p_T)^2 + \\theta_5 |\\eta| \\ln p_T + \\theta_6 |\\eta|^2 \\ln p_T\\right).$$\n- 给定一个从上述生成模型模拟出的训练样本，通过最小化相对响应的残差平方和来确定参数 $\\{\\theta_i\\}_{i=0}^6$：\n  $$\\mathcal{L}(\\theta) = \\sum_{j} \\left(\\frac{C(\\eta_j, p_{T,j})\\,E_{\\text{meas},j}}{E_{\\text{true},j}} - 1\\right)^2.$$\n\n验证与测试套件：\n- 在一个足够大的训练集上拟合 $C(\\eta,p_T)$ 后，在以下场景中评估其性能。每个场景定义了 $(\\eta, p_T)$ 的抽样域和种类混合，从中抽取验证样本。对于每个场景，计算修正后的响应 $R_{\\text{corr}} = \\frac{C(\\eta,p_T)\\,E_{\\text{meas}}}{E_{\\text{true}}}$，在 $\\{20,50,100,200,400,800,1600,3200\\}$（单位为 $\\text{GeV}$）的边界上按 $E_{\\text{true}}$ 进行分箱，并对每种粒子种类计算每个箱内的平均响应。将最差情况绝对偏差定义为 $\\max_{s,\\text{bins}} | \\langle R_{\\text{corr}} \\rangle_{s,\\text{bin}} - 1 |$。如果这个最大值小于或等于 $0.01$，则该场景通过验证。\n- 场景（能量单位为 $\\text{GeV}$）：\n  1. 场景 $1$（通用覆盖范围）：$\\eta \\sim \\mathcal{U}(-2.5, 2.5)$，$p_T \\sim \\mathcal{U}(20, 1000)$，种类概率为 $(0.4, 0.4, 0.2)$，样本大小为 $5000$。\n  2. 场景 $2$（中心区、宽能量范围）：$\\eta = 0$，$p_T \\sim \\mathcal{U}(20, 2000)$，种类概率为 $(0.5, 0.3, 0.2)$，样本大小为 $3000$。\n  3. 场景 $3$（前向区）：$\\eta$ 以相等概率在两个区间内均匀分布，即 $\\mathcal{U}(2.0, 2.5)$ 或 $\\mathcal{U}(-2.5, -2.0)$，$p_T \\sim \\mathcal{U}(50, 800)$，种类概率为 $(0.3, 0.5, 0.2)$，样本大小为 $4000$。\n  4. 场景 $4$（低 $p_T$ 压力测试）：$\\eta \\sim \\mathcal{U}(-1.0, 1.0)$，$p_T \\sim \\mathcal{U}(20, 40)$，种类概率为 $(0.2, 0.3, 0.5)$，样本大小为 $3000$。\n  5. 场景 $5$（超高能量）：$\\eta \\sim \\mathcal{U}(-1.5, 1.5)$，$p_T \\sim \\mathcal{U}(1000, 3000)$，种类概率为 $(0.4, 0.4, 0.2)$，样本大小为 $3000$。\n\n程序要求与最终输出：\n- 实现生成模型，在一个包含 $6000$ 个喷注的训练集上通过最小化 $\\mathcal{L}(\\theta)$ 来拟合 $C(\\eta, p_T)$。该训练集从 $\\eta \\sim \\mathcal{U}(-2.5, 2.5)$ 和 $p_T \\sim \\mathcal{U}(20, 1500)$ 中抽取，种类概率为 $(0.4,0.4,0.2)$。\n- 使用确定性随机种子以保证可复现性。\n- 对上述 $5$ 个场景中的每一个，计算最差情况绝对偏差是否 $\\le 0.01$，并报告相应的布尔值。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，\"[true,false,true,false,true]\"），使用 Python 布尔字面量 \"True\" 和 \"False\"。\n\n本问题陈述中的所有数学实体均已用 LaTeX 书写。请确保您的解决方案中所有数值和变量的处理方式与这些定义一致。最终结果是无量纲的布尔值。能量必须以 $\\text{GeV}$ 为单位表示，赝快度 $\\eta$ 是无量纲的，$p_T$ 的单位是 $\\text{GeV}$。",
            "solution": "所呈现的问题是一个在计算高能物理领域中设定良好且有科学依据的练习，特别关注喷注能量校准这一至关重要的任务。所提供的生成模型虽然是参数化的，但它概括了控制非补偿强子量能器响应的关键物理现象。这些现象包括对电磁和强子簇射成分的不同响应（$e/h \\neq 1$）、对喷注运动学（$\\eta$, $p_T$）的依赖性、轻微的能量非线性以及随机分辨率效应。目标是推导并验证一个乘性修正函数 $C(\\eta, p_T)$，以恢复响应的均匀性和线性。此问题是有效的，因为它是自洽的、逻辑一致的，并且植根于已建立的唯象模型。\n\n我们的解决方法分为三个基于原则的阶段：\n1.  **生成模型的实现**：我们首先构建一个对探测器和喷注物理的计算实现，如问题所述。这涉及到创建能够产生模拟喷注事件的函数，其中测量的能量 $E_{\\text{meas}}$ 是根据一系列指定的物理效应从真实能量 $E_{\\text{true}}$ 推导出来的。\n2.  **通过数值优化进行校准**：然后，我们处理确定修正函数 $C(\\eta, p_T)$ 参数的核心任务。该函数形式为 $C(\\eta, p_T) = \\exp(\\boldsymbol{X} \\boldsymbol{\\theta})$，其中 $\\boldsymbol{X}$ 是由 $|\\eta|$ 和 $\\ln p_T$ 的多项式基构建的设计矩阵，$\\boldsymbol{\\theta}$ 是未知参数向量 $\\{\\theta_i\\}_{i=0}^6$。为了找到最优参数，我们使用一个模拟喷注的训练样本来最小化指定的损失函数 $\\mathcal{L}(\\boldsymbol{\\theta}) = \\sum_{j} \\left(C(\\eta_j, p_{T,j}) \\cdot E_{\\text{meas},j}/E_{\\text{true},j} - 1\\right)^2$。这是一个非线性最小二乘问题。我们将采用一种稳健的方法，即使用迭代数值求解器。具体来说，我们将使用 `scipy.optimize.least_squares` 中实现的 Levenberg-Marquardt 算法，通过寻找使残差 $R_{\\text{corr},j} - 1$ 的平方和最小化的 `theta` 来直接最小化 $\\mathcal{L}(\\boldsymbol{\\theta})$。\n3.  **系统性验证**：一旦确定了参数 $\\boldsymbol{\\theta}$，就必须严格评估校准的有效性。我们为五个不同的运动学和喷注总体场景生成独立的验证数据集。对于每个场景，我们应用推导出的修正 $C(\\eta, p_T)$ 来获得修正后的响应 $R_{\\text{corr}} = (C \\cdot E_{\\text{meas}}) / E_{\\text{true}}$。然后，我们将数据按真实能量 $E_{\\text{true}}$ 分箱，并为每个喷注种类计算每个箱内的 $R_{\\text{corr}}$ 平均值。如果这些平均响应与1的最大偏差 $\\max_{s,\\text{bins}} | \\langle R_{\\text{corr}} \\rangle_{s,\\text{bin}} - 1 |$ 不超过 $0.01$ 的要求容差，则认为该场景的校准成功。\n\n从数据生成到最终验证的整个过程都通过计算方式完成。使用确定性随机种子来确保所涉及的伪随机过程的可复现性，例如喷注运动学的抽样、电磁分数 $f_{\\text{em}}$ 的涨落（由贝塔分布建模）以及最终测量能量的高斯弥散。\n\n让我们详细说明数学组件。真实喷注能量为 $E_{\\text{true}} = p_T \\cosh(\\eta)$。未修正的测量能量是一系列因子的乘积：\n$$ E_{\\text{meas}} = E_{\\text{true}} \\cdot \\underbrace{\\left(f_{\\text{em}} + \\frac{1 - f_{\\text{em}}}{r}\\right)}_{R_{\\text{base}}} \\cdot \\underbrace{\\left(1 + a_2 |\\eta|^2 + a_4 |\\eta|^4\\right)}_{S(\\eta)} \\cdot \\underbrace{\\left(1 - \\frac{b_1}{1 + p_T/p_0} + \\frac{b_2}{1 + (p_T/p_1)^2}\\right)}_{G(p_T)} \\cdot \\underbrace{\\left(1 + n_1 \\frac{\\ln(E_{\\text{true}}/E_0)}{1 + [\\ln(E_{\\text{true}}/E_0)]^2}\\right)}_{N(E_{\\text{true}})} \\cdot \\underbrace{(1 + \\delta)}_{\\epsilon} $$\n其中弥散 $\\delta$ 从一个正态分布 $\\mathcal{N}(0, \\sigma/E_{\\text{true}})$ 中抽取，其分辨率由下式给出：\n$$ \\frac{\\sigma}{E_{\\text{true}}} = \\sqrt{\\left(\\frac{S_{\\text{res}}}{\\sqrt{E_{\\text{true}}}}\\right)^2 + \\left(\\frac{N_{\\text{res}}}{E_{\\text{true}}}\\right)^2 + C_{\\text{res}}^2} $$\n种类为 $s$ 的喷注的电磁分数 $f_{\\text{em}}$ 从一个贝塔分布中抽取，其均值 $\\mu_s(p_T)$ 随横向动量变化。\n\n拟合过程找到修正函数的参数向量 $\\boldsymbol{\\theta} = (\\theta_0, \\theta_1, ..., \\theta_6)^T$：\n$$ C(\\eta, p_T) = \\exp\\left( \\begin{pmatrix} 1  |\\eta|  |\\eta|^2  \\ln p_T  (\\ln p_T)^2  |\\eta|\\ln p_T  |\\eta|^2\\ln p_T \\end{pmatrix} \\begin{pmatrix} \\theta_0 \\\\ \\theta_1 \\\\ \\vdots \\\\ \\theta_6 \\end{pmatrix} \\right) $$\n该函数旨在平均地反转 $R_{\\text{base}}$、$S(\\eta)$、$G(p_T)$ 和 $N(E_{\\text{true}})$ 的影响。至关重要的是，$C(\\eta, p_T)$ 无法访问逐事件的 $f_{\\text{em}}$ 或真实能量 $E_{\\text{true}}$（它决定了 $N(E_{\\text{true}})$），这模仿了真实的实验约束。因此，拟合必须在这些隐藏变量的分布上找到一个最优的平均修正。最终输出是一个布尔值数组，每个验证场景对应一个布尔值，指示这个复杂、多方面的校准是否满足严格的拉平标准。",
            "answer": "[True,True,True,True,True]"
        },
        {
            "introduction": "一个经过校准的喷注，如果没有对其能量不确定度的恰当评估，那么它就是不完整的。喷注能量尺度（JES）的不确定度来源众多且往往相互关联，如何有效地处理它们是物理分析中的关键挑战。本练习将探讨一种用于管理系统不确定度的先进技术，你将使用主成分分析（PCA）方法，将一个包含多个相关不确定度来源的协方差矩阵对角化，从而构建一组正交的“冗余参数”模板。",
            "id": "3518981",
            "problem": "考虑一个分箱的喷注能量尺度（JES）校准问题，其中由赝快度和横向动量索引的各分箱上的喷注响应不确定度被建模为一个均值为零、协方差矩阵为 $C$ 的多元高斯分布。目标是构建一个讨厌参数模板的正交基，该基能再现 $C$ 并在高斯约束的拟合中最小化相关性。使用主成分分析（PCA）处理 $C$ 以获得一组正交的特征向量和非负的特征值，并将讨厌模板定义为模板矩阵 $T$ 的列。\n\n从以下基本定义和事实出发：\n- 一个实值随机向量的协方差矩阵 $C$ 根据其构造是对称且半正定的。\n- 主成分分析（PCA）通过 $C = E \\Lambda E^\\top$ 对角化一个对称半正定矩阵 $C$，其中 $E$ 的列是标准正交的特征向量，$\\Lambda$ 是一个由降序排列的特征值构成的对角矩阵。\n- 在一个具有先验协方差 $C$ 的高斯约束线性拟合中，相对于由 $C^{-1}$ 导出的度量正交的讨厌模板可以最小化参数相关性。\n\n从 $C$ 的 PCA 结果出发，数学推导如何构造模板矩阵 $T$，以满足以下条件：\n- 协方差能被模板的外积精确再现，即 $C = T T^\\top$。\n- 模板相对于 $C^{-1}$-度量是标准正o交的，即 $T^\\top C^{-1} T = I$，其中 $I$ 是单位矩阵。\n\n然后，实现一个程序，对每个提供的测试协方差矩阵执行以下操作：\n- 执行 PCA 以获得特征值 $\\{\\lambda_i\\}$ 和相应的标准正交特征向量 $\\{e_i\\}$，并按 $\\lambda_1 \\ge \\lambda_2 \\ge \\cdots$ 的顺序排列。\n- 构建模板矩阵 $T$，其列为 $t_i = \\sqrt{\\lambda_i}\\, e_i$。\n- 计算以下三个标量诊断量：\n  1. $m_1$：$G = T^\\top C^{-1} T$ 的最大绝对非对角元素。\n  2. $m_2$：相对 Frobenius 重构误差，$m_2 = \\dfrac{\\lVert C - T T^\\top \\rVert_F}{\\lVert C \\rVert_F}$。\n  3. $m_3$：由主导成分解释的总方差比例，$m_3 = \\dfrac{\\lambda_1}{\\operatorname{tr}(C)}$。\n\n所有量纲均为无量纲，因此不需要物理单位。不涉及角度。分数必须以小数形式表示。\n\n测试套件：\n使用以下三个协方差矩阵作为测试套件。每个 $C^{(k)}$ 都是对称正定的，其条目被明确给出。\n\n- 测试用例 1：\n$$\nC^{(1)} =\n\\begin{pmatrix}\n0.04  0.018  0  0 \\\\\n0.018  0.09  0  0 \\\\\n0  0  0.0225  0.015 \\\\\n0  0  0.015  0.04\n\\end{pmatrix}.\n$$\n\n- 测试用例 2：\n$$\nC^{(2)} =\n\\begin{pmatrix}\n0.02001  0.016  0.012  0.008  0.004 \\\\\n0.016  0.02281  0.0096  0.0164  0.0032 \\\\\n0.012  0.0096  0.00721  0.0048  0.0024 \\\\\n0.008  0.0164  0.0048  0.01321  0.0016 \\\\\n0.004  0.0032  0.0024  0.0016  0.00081\n\\end{pmatrix}.\n$$\n\n- 测试用例 3：\n$$\nC^{(3)} =\n\\begin{pmatrix}\n0.01  0  0 \\\\\n0  0.04  0 \\\\\n0  0  0.09\n\\end{pmatrix}.\n$$\n\n答案规格：\n- 对于每个测试用例 $k \\in \\{1,2,3\\}$，计算如上定义的 $(m_1^{(k)}, m_2^{(k)}, m_3^{(k)})$。\n- 你的程序应生成单行输出，其中包含九个浮点数结果，并按以下固定顺序以逗号分隔列表的形式置于方括号内：\n$[m_1^{(1)}, m_2^{(1)}, m_3^{(1)}, m_1^{(2)}, m_2^{(2)}, m_3^{(2)}, m_1^{(3)}, m_2^{(3)}, m_3^{(3)}]$。\n- 每个浮点数应四舍五入到 $6$ 位小数。",
            "solution": "用户提供的问题已经过分析，并被判定为**有效**。该问题有科学依据、是良定的、客观的，并包含完整解答所需的所有必要信息。\n\n该问题包括两部分：数学推导和计算实现。\n\n### 第1部分：数学推导\n\n目标是从协方差矩阵 $C$ 的主成分分析（PCA）结果构造一个模板矩阵 $T$，使得满足两个条件：\n1. 协方差被完美再现：$C = T T^\\top$。\n2. 模板相对于由 $C^{-1}$ 导出的度量是标准正交的：$T^\\top C^{-1} T = I$。\n\n令 $C$ 为一个 $n \\times n$ 的实对称半正定协方差矩阵。谱定理保证 $C$ 可以被一个正交矩阵对角化。这是 PCA 的基础。其分解形式如下：\n$$C = E \\Lambda E^\\top$$\n其中：\n- $E$ 是一个 $n \\times n$ 的正交矩阵，其列 $e_i$ 是 $C$ 的标准正交特征向量。正交性条件意味着 $E^\\top E = E E^\\top = I$，其中 $I$ 是 $n \\times n$ 的单位矩阵。\n- $\\Lambda$ 是一个 $n \\times n$ 的对角矩阵，包含 $C$ 的实数、非负特征值 $\\lambda_i$，与特征向量 $e_i$ 相对应。我们假设它们按降序排列，$\\lambda_1 \\ge \\lambda_2 \\ge \\dots \\ge \\lambda_n \\ge 0$。\n$$\\Lambda = \\operatorname{diag}(\\lambda_1, \\lambda_2, \\dots, \\lambda_n)$$\n\n问题将讨厌参数模板 $t_i$ 定义为模板矩阵 $T$ 的列。这种构造方式由 $t_i = \\sqrt{\\lambda_i} \\, e_i$ 给出。以矩阵形式，这可以表示为：\n$$T = E \\Lambda^{1/2}$$\n其中 $\\Lambda^{1/2}$ 是一个对角矩阵，其对角元为 $\\sqrt{\\lambda_i}$：\n$$\\Lambda^{1/2} = \\operatorname{diag}(\\sqrt{\\lambda_1}, \\sqrt{\\lambda_2}, \\dots, \\sqrt{\\lambda_n})$$\n\n我们现在将验证 $T$ 的这种构造方式满足两个所需条件。\n\n**条件1：协方差再现 ($C = T T^\\top$)**\n\n我们使用 $T$ 的矩阵形式计算外积 $T T^\\top$：\n$$T T^\\top = (E \\Lambda^{1/2}) (E \\Lambda^{1/2})^\\top$$\n使用乘积转置的性质 $(AB)^\\top = B^\\top A^\\top$，我们得到：\n$$T T^\\top = (E \\Lambda^{1/2}) ((\\Lambda^{1/2})^\\top E^\\top)$$\n由于 $\\Lambda^{1/2}$ 是一个对角矩阵，它是对称的，所以 $(\\Lambda^{1/2})^\\top = \\Lambda^{1/2}$。表达式变为：\n$$T T^\\top = E \\Lambda^{1/2} \\Lambda^{1/2} E^\\top = E \\Lambda E^\\top$$\n从最初的 PCA 分解，我们知道 $E \\Lambda E^\\top = C$。因此，我们证明了：\n$$C = T T^\\top$$\n这表明协方差矩阵被精确地再现了。\n\n**条件2：标准正交性 ($T^\\top C^{-1} T = I$)**\n\n为了验证这个条件，我们首先需要协方v差矩阵的逆 $C^{-1}$ 的表达式。问题陈述中指明测试矩阵是正定的，这意味着所有特征值 $\\lambda_i$ 都是严格正的，因此 $C$ 是可逆的。\n从 $C = E \\Lambda E^\\top$ 出发，我们可以求出其逆：\n$$C^{-1} = (E \\Lambda E^\\top)^{-1} = (E^\\top)^{-1} \\Lambda^{-1} E^{-1}$$\n由于 $E$ 是一个正交矩阵，它的逆是它的转置，即 $E^{-1} = E^\\top$。因此，$(E^\\top)^{-1} = (E^{-1})^{-1} = E$。对角矩阵 $\\Lambda$ 的逆是 $\\Lambda^{-1} = \\operatorname{diag}(1/\\lambda_1, 1/\\lambda_2, \\dots, 1/\\lambda_n)$。\n将这些代入 $C^{-1}$ 的表达式，我们得到：\n$$C^{-1} = E \\Lambda^{-1} E^\\top$$\n现在，我们可以将 $T$、$T^\\top$ 和 $C^{-1}$ 的表达式代入 $T^\\top C^{-1} T$ 这一项中：\n$$T^\\top C^{-1} T = (E \\Lambda^{1/2})^\\top (E \\Lambda^{-1} E^\\top) (E \\Lambda^{1/2})$$\n展开第一个转置并组合各项：\n$$T^\\top C^{-1} T = (\\Lambda^{1/2} E^\\top) (E \\Lambda^{-1} E^\\top) (E \\Lambda^{1/2}) = \\Lambda^{1/2} (E^\\top E) \\Lambda^{-1} (E^\\top E) \\Lambda^{1/2}$$\n使用正交性 $E^\\top E = I$：\n$$T^\\top C^{-1} T = \\Lambda^{1/2} I \\Lambda^{-1} I \\Lambda^{1/2} = \\Lambda^{1/2} \\Lambda^{-1} \\Lambda^{1/2}$$\n由于对角矩阵是可交换的，$\\Lambda$ 的幂的乘積是：\n$$\\Lambda^{1/2} \\Lambda^{-1} \\Lambda^{1/2} = \\Lambda^{1/2 - 1 + 1/2} = \\Lambda^0 = I$$\n因此，我们证明了：\n$$T^\\top C^{-1} T = I$$\n这证实了由 $t_i = \\sqrt{\\lambda_i} e_i$ 定义的模板相对于度量 $C^{-1}$ 是标准正交的。\n\n### 第2部分：计算实现\n\n实现遵循上述推导。对于每个测试协方差矩阵 $C^{(k)}$，算法如下：\n\n1.  **$C$ 的 PCA**：我们使用一个数值例程来执行对称矩阵 $C$ 的特征分解。`numpy.linalg.eigh` 是理想的选择，因为它针对对称/厄米矩阵进行了优化，并保证了实数特征值和标准正交的特征向量基。该函数返回升序排列的特征值，因此需要将它们及其对应的特征向量重新排序为降序，以匹配 $\\lambda_1 \\ge \\lambda_2 \\ge \\dots$ 的约定。\n\n2.  **构造 $T$**：模板矩阵 $T$ 的构造使其列为 $t_i = \\sqrt{\\lambda_i} e_i$。在计算上，这是通过创建一个以排序后的特征向量 $e_i$ 为列的矩阵，然后将每一列乘以相应的 $\\sqrt{\\lambda_i}$ 来实现的。\n\n3.  **计算诊断量**：\n    - $m_1$：计算矩阵 $G = T^\\top C^{-1} T$。理论上，$G$ 是单位矩阵 $I$。由于浮点精度限制，其非对角元素将是小的非零数字。$m_1$是这些非对角元素的最大绝对值。\n    - $m_2$：计算重构矩阵 $T T^\\top$。理论上，它等于 $C$。相对 Frobenius 重构误差 $m_2 = \\frac{\\lVert C - T T^\\top \\rVert_F}{\\lVert C \\rVert_F}$ 量化了数值偏差。$\\lVert A \\rVert_F = \\sqrt{\\sum_{i,j} |a_{ij}|^2}$ 是 Frobenius 范数。\n    - $m_3$：由第一主成分解释的总方差比例计算为 $m_3 = \\frac{\\lambda_1}{\\operatorname{tr}(C)}$。$C$ 的迹 $\\operatorname{tr}(C)$ 是其对角元素之和，也等于其特征值之和，代表了系统中的总方差。\n\n代码将遍历提供的三个测试矩阵，为每个矩阵计算 $(m_1^{(k)}, m_2^{(k)}, m_3^{(k)})$，并将最终结果格式化为单个逗号分隔的列表。",
            "answer": "[0.000000,0.000000,0.767936,0.000000,0.000000,0.923403,0.000000,0.000000,0.642857]"
        }
    ]
}