{
    "hands_on_practices": [
        {
            "introduction": "本实践为多体相空间生成奠定了运动学基础。在构建基于级联衰变模型的事件生成器时，首要任务是确定中间态粒子不变质量的允许范围。在此练习中，您将运用Källén函数从基本原理出发，推导这些严格的运动学边界。",
            "id": "3528144",
            "problem": "考虑一个质量为 $M$ 的母粒子衰变为三个质量分别为 $m_{1}$、$m_{2}$ 和 $m_{3}$ 的子粒子。用 $p_{1}$、$p_{2}$ 和 $p_{3}$ 表示子粒子的四维动量，其中 $p_{i}^{2} = m_{i}^{2}$，并将 $(1,2)$ 子系统的不变质量平方定义为 $s_{12} \\equiv (p_{1} + p_{2})^{2}$。在度规符号为 $(+,-,-,-)$ 的度规下，并在母粒子的静止系中进行计算，其中 $p_{\\text{parent}}^{\\mu} = (M, \\mathbf{0})$。假设 $M \\ge m_{1} + m_{2} + m_{3}$，从而该衰变在运动学上是允许的。\n\n在计算高能物理学中，三体衰变的相空间生成通常通过将三体相空间因子分解为两个连续的两体相空间来进行。其中，一个不变质量为 $\\sqrt{s_{12}}$ 的中间有效粒子反冲粒子3，然后衰变为粒子1和2。为了使这种因子分解在运动学上有效，两个两体子过程中的质心（CM）动量必须是实数。这一要求体现在 Källén 函数的非负性上，\n$$\\lambda(x,y,z) \\equiv x^{2} + y^{2} + z^{2} - 2xy - 2xz - 2yz,$$\n应用于每个子过程：\n$$\\lambda(s_{12}, m_{1}^{2}, m_{2}^{2}) \\ge 0 \\quad \\text{和} \\quad \\lambda(M^{2}, s_{12}, m_{3}^{2}) \\ge 0.$$\n\n仅从能量-动量守恒、Källén 函数的定义以及两体运动学中质心动量为实数的物理要求出发，确定能同时满足两个不等式的 $s_{12}$ 的允许积分区间。请将您的最终答案表示为仅包含 $M$、$m_{1}$、$m_{2}$ 和 $m_{3}$ 的闭式解析表达式。无需进行数值计算。请提供 $s_{12}$ 的下限和上限作为您的最终答案。",
            "solution": "我们首先回顾两体运动学以及 Källén 函数如何控制质心动量的实数性。对于一个总不变质量平方为 $s$、衰变为质量为 $m_{a}$ 和 $m_{b}$ 的粒子的两体系统，其质心（CM）系中三维动量的大小为\n$$\nk(s; m_{a}, m_{b}) = \\frac{\\sqrt{\\lambda(s, m_{a}^{2}, m_{b}^{2})}}{2\\sqrt{s}}。\n$$\n质心动量为实数的充要条件是 $\\lambda(s, m_{a}^{2}, m_{b}^{2}) \\ge 0$。这个条件体现了相对论运动学中的三角不等式。\n\n对于三体衰变 $M \\to 1\\,2\\,3$，我们将其运动学因子分解为两个连续的两体子系统：\n1. 在母粒子静止系中，不变质量为 $\\sqrt{s_{12}}$ 的有效粒子反冲粒子3。相应的质心动量为实数的充要条件是\n$$\n\\lambda(M^{2}, s_{12}, m_{3}^{2}) \\ge 0。\n$$\n2. 在 $(1,2)$ 子系统的静止系中，质量为 $\\sqrt{s_{12}}$ 的有效粒子衰变为粒子1和2。相应的质心动量为实数的充要条件是\n$$\n\\lambda(s_{12}, m_{1}^{2}, m_{2}^{2}) \\ge 0。\n$$\n\n我们现在分析每个不等式对 $s_{12}$ 的影响。\n\n首先，考虑 $\\lambda(s_{12}, m_{1}^{2}, m_{2}^{2}) \\ge 0$。使用恒等式\n$$\n\\lambda(s, m_{1}^{2}, m_{2}^{2}) = \\left(s - (m_{1} + m_{2})^{2}\\right)\\left(s - (m_{1} - m_{2})^{2}\\right),\n$$\n不等式 $\\lambda(s_{12}, m_{1}^{2}, m_{2}^{2}) \\ge 0$ 意味着\n$$\ns_{12} \\le (m_{1} - m_{2})^{2} \\quad \\text{或} \\quad s_{12} \\ge (m_{1} + m_{2})^{2}。\n$$\n在物理上，由两个具有正能量的在壳粒子组成的两粒子系统的不变质量必须满足 $\\sqrt{s_{12}} \\ge m_{1} + m_{2}$；分支 $s_{12} \\le (m_{1} - m_{2})^{2}$ 对应于具有正能量的在壳衰变产物的类空或非物理构型，在衰变运动学中被排除。因此，来自 $(1,2)$ 衰变的物理约束是\n$$\ns_{12} \\ge (m_{1} + m_{2})^{2}。\n$$\n\n其次，考虑 $\\lambda(M^{2}, s_{12}, m_{3}^{2}) \\ge 0$。使用类似的因子分解，\n$$\n\\lambda(M^{2}, s_{12}, m_{3}^{2}) = \\left(M^{2} - \\left(\\sqrt{s_{12}} + m_{3}\\right)^{2}\\right)\\left(M^{2} - \\left(\\sqrt{s_{12}} - m_{3}\\right)^{2}\\right),\n$$\n该不等式意味着\n$$\ns_{12} \\le (M - m_{3})^{2} \\quad \\text{或} \\quad s_{12} \\ge (M + m_{3})^{2}。\n$$\n分支 $s_{12} \\ge (M + m_{3})^{2}$ 与母粒子质量为 $M$ 的衰变中的能量-动量守恒不相容，因为它要求 $(1,2)$ 子系统的不变质量至少比母粒子质量大 $m_{3}$。因此，在母粒子静止系中，由粒子3相对于 $(1,2)$ 集团的反冲所带来的物理约束是\n$$\ns_{12} \\le (M - m_{3})^{2}。\n$$\n\n结合这两个物理约束，确保两个子过程中质心动量均为实数的 $s_{12}$ 的允许区间是\n$$\n(m_{1} + m_{2})^{2} \\le s_{12} \\le (M - m_{3})^{2}。\n$$\n这个区间非空的条件恰好是 $M \\ge m_{1} + m_{2} + m_{3}$，这正是我们假设的衰变在运动学上允许的条件。因此，在因子化的三体相空间中，$s_{12}$ 的积分限由下限 $(m_{1} + m_{2})^{2}$ 和上限 $(M - m_{3})^{2}$ 给出。",
            "answer": "$$\\boxed{\\begin{pmatrix}(m_{1}+m_{2})^{2}  (M-m_{3})^{2}\\end{pmatrix}}$$"
        },
        {
            "introduction": "在确定了单个不变质量的取值范围之后，我们自然会想了解描述三体衰变所需的全套不变量之间的关联。本练习将指导您推导著名的Dalitz图的边界，该图利用洛伦兹不变量直观地展示了整个衰变运动学。这项实践旨在加深您对基本守恒定律如何塑造相空间几何形态的理解。",
            "id": "3528129",
            "problem": "一个静止的、质量为 $M$ 的标量粒子衰变为三个末态无质量粒子，它们的四动量分别为 $p_{1}$、$p_{2}$ 和 $p_{3}$。将初始四动量记为 $P$，因此有 $P^{\\mu}=p_{1}^{\\mu}+p_{2}^{\\mu}+p_{3}^{\\mu}$ 且 $P^{2}=M^{2}$。定义成对的曼德尔斯坦不变量 $s_{ij}=(p_{i}+p_{j})^{2}$ 及其归一化形式 $x_{ij}=s_{ij}/M^{2}$，并考虑在 $(x_{12},x_{13})$ 平面上的达利兹图，其中 $x_{23}=1-x_{12}-x_{13}$。\n\n仅从能量-动量守恒、在壳条件 $p_{i}^{2}=0$ 以及该构型在衰变粒子静止系中物理上可实现的要求出发，推导 $(x_{12},x_{13})$ 达利兹图中允许区域的运动学边界。你的推导必须明确地将对末态能量和角度的约束与对不变量 $x_{ij}$ 的约束联系起来。\n\n作为你的最终答案，提供一个单一的闭式代数表达式 $f(x_{12},x_{13})$，其值为零时定义了 $(x_{12},x_{13})$ 平面中达利兹图的边界曲线。你的最终答案中不应包含任何不等式。不需要进行数值计算，也不需要单位。最终答案必须是仅含 $x_{12}$ 和 $x_{13}$ 的单一代数表达式。",
            "solution": "该问题要求推导一个有质量标量粒子衰变为三个无质量粒子的运动学边界。推导必须源于能量-动量守恒和末态物理可实现性的基本原理，并明确地将运动学变量（能量和角度）与曼德尔斯坦不变量联系起来。\n\n我们首先在质量为 $M$ 的初始粒子的静止系中分析该衰变。该粒子的四动量为 $P^{\\mu} = (M, \\vec{0})$。末态由三个无质量粒子组成，其四动量分别为 $p_1^{\\mu}$、$p_2^{\\mu}$ 和 $p_3^{\\mu}$。对于一个无质量粒子 $i$，其四动量为 $p_i^{\\mu} = (E_i, \\vec{p}_i)$，在壳条件为 $p_i^2 = E_i^2 - |\\vec{p}_i|^2 = 0$，这意味着其能量 $E_i$ 等于其三动量的模，即 $E_i = |\\vec{p}_i|$。\n\n能量-动量守恒规定 $P^{\\mu} = p_1^{\\mu} + p_2^{\\mu} + p_3^{\\mu}$。\n在静止系中，这可以分为：\n1. 能量守恒：$M = E_1 + E_2 + E_3$。\n2. 动量守恒：$\\vec{0} = \\vec{p}_1 + \\vec{p}_2 + \\vec{p}_3$。\n\n曼德尔斯坦不变量 $s_{ij}$ 定义为 $s_{ij} = (p_i + p_j)^2$。由于末态粒子是无质量的（$p_i^2 = p_j^2 = 0$），这可以简化为 $s_{ij} = 2 p_i \\cdot p_j$。\n我们可以将这些不变量与末态粒子的能量联系起来。考虑不变量 $s_{12}$：\n$s_{12} = (p_1 + p_2)^2$。利用动量守恒，我们可以写出 $p_1 + p_2 = P - p_3$。\n代入此式，我们得到：\n$s_{12} = (P - p_3)^2 = P^2 - 2 P \\cdot p_3 + p_3^2$。\n给定 $P^2 = M^2$ 和 $p_3^2 = 0$。在衰变粒子的静止系中，点积 $P \\cdot p_3$ 由 $P \\cdot p_3 = P_{\\mu} p_3^{\\mu} = (M, \\vec{0}) \\cdot (E_3, \\vec{p}_3) = M E_3$ 给出。\n因此，我们找到了 $s_{12}$ 和 $E_3$ 之间的直接关系：\n$s_{12} = M^2 - 2 M E_3$。\n解出 $E_3$，我们得到：\n$$E_3 = \\frac{M^2 - s_{12}}{2M}$$\n通过对指标 $(1, 2, 3)$ 进行轮换，我们可以写出另外两个粒子的能量：\n$$E_1 = \\frac{M^2 - s_{23}}{2M}$$\n$$E_2 = \\frac{M^2 - s_{13}}{2M}$$\n由于能量必须是非负的（$E_i \\ge 0$），这意味着 $s_{jk} \\le M^2$，或者用归一化变量 $x_{jk} = s_{jk}/M^2$ 表示，我们有 $x_{jk} \\le 1$。此外，$s_{ij} = (p_i + p_j)^2$ 是粒子对 $(i, j)$ 的不变质量的平方，它必须是非负的，所以 $s_{ij} \\ge 0$ 且 $x_{ij} \\ge 0$。\n\n动量守恒方程 $\\vec{p}_1 + \\vec{p}_2 + \\vec{p}_3 = \\vec{0}$ 意味着这三个动量矢量必须构成一个闭合三角形。这只有在它们共面的情况下才可能。如果可以用边长为 $|\\vec{p}_1|=E_1$、 $|\\vec{p}_2|=E_2$ 和 $|\\vec{p}_3|=E_3$ 构成一个真实的三角形（或一条退化的线），那么该构型就是物理上可实现的。这要求满足三角不等式：对于任何置换 $(i,j,k)$ 都有 $E_i+E_j \\ge E_k$。使用能量守恒方程 $E_1+E_2+E_3=M$，不等式 $E_1+E_2 \\ge E_3$ 变为 $M-E_3 \\ge E_3$，简化为 $M \\ge 2E_3$ 或 $E_3 \\le M/2$。这个条件意味着任何单个末态粒子的能量不能超过衰变粒子质量的一半。\n\n运动学允许区域的边界对应于这些不等式取等号的情况，即动量三角形退化为一条线。这发生在动量矢量共线时。例如，如果 $\\vec{p}_1$ 和 $\\vec{p}_2$ 反平行，那么为了满足动量守恒，$\\vec{p}_3$ 必须与它们共线。设 $\\theta_{ij}$ 为 $\\vec{p}_i$ 和 $\\vec{p}_j$ 之间的夹角。共线构型对应于 $\\cos\\theta_{ij} = \\pm 1$。\n\n让我们将此形式化。从动量三角形，我们可以写出 $\\vec{p}_3 = -(\\vec{p}_1 + \\vec{p}_2)$。对两边取模的平方：\n$|\\vec{p}_3|^2 = |\\vec{p}_1 + \\vec{p}_2|^2 = |\\vec{p}_1|^2 + |\\vec{p}_2|^2 + 2 \\vec{p}_1 \\cdot \\vec{p}_2$。\n使用 $E_i = |\\vec{p}_i|$ 和 $\\vec{p}_1 \\cdot \\vec{p}_2 = |\\vec{p}_1||\\vec{p}_2|\\cos\\theta_{12} = E_1 E_2 \\cos\\theta_{12}$，我们得到：\n$E_3^2 = E_1^2 + E_2^2 + 2 E_1 E_2 \\cos\\theta_{12}$。\n解出 $\\cos\\theta_{12}$：\n$$\\cos\\theta_{12} = \\frac{E_3^2 - E_1^2 - E_2^2}{2 E_1 E_2}$$\n要使物理构型存在，角度 $\\theta_{12}$ 必须是实数，这要求 $|\\cos\\theta_{12}| \\le 1$。相空间的边界由极限 $|\\cos\\theta_{12}| = 1$ 定义。这对应于 $E_3^2 = (E_1 \\pm E_2)^2$，等价于饱和的三角不等式 $E_3 = |E_1 \\pm E_2|$。连同 $E_1+E_2+E_3=M$，这些条件定义了边界。\n\n另一种等效的方法，按要求直接使用不变量，是利用 $s_{ij}$、$E_i$、$E_j$ 和 $\\theta_{ij}$ 之间的关系来考虑条件 $|\\cos\\theta_{ij}| \\le 1$。\n$s_{ij} = 2 p_i \\cdot p_j = 2(E_i E_j - \\vec{p}_i \\cdot \\vec{p}_j) = 2 E_i E_j (1 - \\cos\\theta_{ij})$。\n物理约束是 $-1 \\le \\cos\\theta_{ij} \\le 1$。\n条件 $\\cos\\theta_{ij} \\le 1$ 意味着 $s_{ij} \\ge 0$，这是我们已经知道的。\n条件 $\\cos\\theta_{ij} \\ge -1$ 意味着 $1 - \\frac{s_{ij}}{2E_i E_j} \\ge -1$，简化为 $s_{ij} \\le 4 E_i E_j$。\n因此，运动学边界由等式 $s_{ij} = 4 E_i E_j$ 对任何粒子对 $(i,j)$ 定义。\n\n让我们分析边界条件 $s_{12} = 4 E_1 E_2$。将 $E_1$ 和 $E_2$ 用不变量表示的表达式代入：\n$$s_{12} = 4 \\left(\\frac{M^2 - s_{23}}{2M}\\right) \\left(\\frac{M^2 - s_{13}}{2M}\\right) = \\frac{(M^2 - s_{23})(M^2 - s_{13})}{M^2}$$\n现在，我们转换为归一化变量 $x_{ij} = s_{ij}/M^2$：\n$$M^2 x_{12} = \\frac{(M^2 - M^2 x_{23})(M^2 - M^2 x_{13})}{M^2} = M^2 (1 - x_{23})(1 - x_{13})$$\n$$x_{12} = (1 - x_{23})(1 - x_{13})$$\n我们有关系式 $x_{12} + x_{13} + x_{23} = 1$，这意味着 $x_{23} = 1 - x_{12} - x_{13}$。将此代入边界方程：\n$$x_{12} = (1 - (1 - x_{12} - x_{13}))(1 - x_{13})$$\n$$x_{12} = (x_{12} + x_{13})(1 - x_{13})$$\n$$x_{12} = x_{12} - x_{12}x_{13} + x_{13} - x_{13}^2$$\n$$0 = x_{13} - x_{13}^2 - x_{12}x_{13}$$\n$$0 = x_{13}(1 - x_{13} - x_{12})$$\n再次使用 $x_{23} = 1-x_{12}-x_{13}$，我们得到：\n$$x_{13} x_{23} = 0$$\n这表明对应于 $|\\cos\\theta_{12}|=1$ 的边界由 $(x_{12}, x_{13})$ 平面中的两条线组成：$x_{13}=0$ 和 $x_{23}=0$（即 $x_{12}+x_{13}=1$）。\n\n通过轮换，另外两个边界条件是：\n- $s_{13} = 4 E_1 E_3 \\implies x_{13} = (1 - x_{23})(1 - x_{12}) \\implies x_{12} x_{23} = 0$。这给出了边界 $x_{12}=0$ 和 $x_{23}=0$。\n- $s_{23} = 4 E_2 E_3 \\implies x_{23} = (1 - x_{13})(1 - x_{12}) \\implies x_{12} x_{13} = 0$。这给出了边界 $x_{12}=0$ 和 $x_{13}=0$。\n\n允许区域的完整运动学边界是所有这些条件的并集：$x_{12}=0$ 或 $x_{13}=0$ 或 $x_{23}=0$。\n一个单一的代数表达式 $f(x_{12}, x_{13})$，其值为零时定义了这三条线的并集，是定义这些线的线性因子的乘积：\n$f(x_{12}, x_{13}) = x_{12} \\cdot x_{13} \\cdot x_{23}$。\n代入 $x_{23} = 1 - x_{12} - x_{13}$，我们得到仅含 $x_{12}$ 和 $x_{13}$ 的最终表达式。\n$$f(x_{12}, x_{13}) = x_{12} x_{13} (1 - x_{12} - x_{13})$$\n该表达式的值为零，$f(x_{12}, x_{13}) = 0$，定义了一个有质量粒子衰变为三个无质量粒子的达利兹图的三角形边界。",
            "answer": "$$\\boxed{x_{12} x_{13} (1 - x_{12} - x_{13})}$$"
        },
        {
            "introduction": "这项最终实践是将理论付诸实践的顶点项目。您将亲手实现一个完整、洛伦兹协变的多体衰变事件生成器，综合运用前面练习中探讨的递归分解和运动学约束等原理。通过这个动手编程练习，您将学会如何在一个参考系中生成物理事件并将其正确地变换到另一个参考系，同时以数值方式验证相空间测度的内在不变性。",
            "id": "3528153",
            "problem": "您的任务是在计算高能物理领域中，实现、验证并测试一个用于多体衰变的洛伦兹协变事件生成器。其基本原理是闵可夫斯基线元在洛伦兹变换下的不变性、质壳关系以及洛伦兹不变相空间测度的定义。请完全在自然单位制中进行工作，其中光速等于1，所有能量和质量以吉电子伏特（$\\mathrm{GeV}$）表示，所有角度以弧度表示。\n\n从以下基本事实出发：\n- 具有度规符号 $\\left(+,-,-,-\\right)$ 的闵可夫斯基度规在正常原时洛伦兹变换下保持不变。\n- 一个静止的有质量母粒子的四维动量为 $P^{\\mu} = \\left(M, 0, 0, 0\\right)$，其中 $M$ 是以 $\\mathrm{GeV}$ 为单位的母粒子质量。\n- 一个质量为 $m_i$ 的末态粒子满足 $p_i^{\\mu} p_{i\\mu} = m_i^2$，其中 $p_i^0 = E_i = \\sqrt{m_i^2 + \\boldsymbol{p}_i^2}$。\n- $n$体洛伦兹不变相空间测度为\n$$\nd\\Phi_n\\left(P; m_1,\\dots,m_n\\right) = (2\\pi)^4 \\,\\delta^{(4)}\\!\\left(P - \\sum_{i=1}^n p_i\\right)\\,\\prod_{i=1}^n \\frac{d^3 \\boldsymbol{p}_i}{(2\\pi)^3\\,2 E_i}.\n$$\n\n您的任务是：\n1. 推导将任意四维矢量从母粒子静止系映射到实验室系的洛伦兹助推，其中母粒子在实验室系中的四维速度为 $u^{\\mu}$ 且满足 $u^{\\mu} u_{\\mu} = 1$。请用三维速度 $\\boldsymbol{\\beta}$ 和洛伦兹因子 $\\gamma$ 来表示该助推，其中 $u^{\\mu} = \\left(\\gamma, \\gamma \\boldsymbol{\\beta}\\right)$ 且 $\\gamma = 1/\\sqrt{1-\\boldsymbol{\\beta}^2}$。最终的映射应将母粒子静止系中的任意四维矢量 $p^{\\mu} = \\left(E, \\boldsymbol{p}\\right)$ 变换为实验室系中的 $p'^{\\mu}$。\n2. 基于同样的基本事实，证明在固定的助推下，每个粒子的空间动量雅可比行列式满足\n$$\n\\det\\!\\left(\\frac{\\partial \\boldsymbol{p}'}{\\partial \\boldsymbol{p}}\\right) = \\frac{E'}{E},\n$$\n并由此得出结论：相空间元中的每个因子 $d^3\\boldsymbol{p}_i / E_i$ 在助推下是不变的，因此 $d\\Phi_n$ 也是不变的。\n3. 在母粒子静止系中，为衰变为具有给定质量 $m_1,\\dots,m_n$ 的子粒子的 $n$体衰变过程实现一个确定性事件生成器。使用一系列递归的两体衰变，其中角度以弧度表示且呈各向同性，中间质量在运动学上是允许的。您的生成器必须在母粒子静止系中精确地守恒四维动量，并为所有子粒子生成有效的在壳四维矢量。对于母粒子质量为 $m_0$、衰变为质量为 $m_a$ 和 $m_b$ 的两体衰变，请使用相对论两体运动学，通过 Källén 函数确定母粒子静止系中共同的三维动量大小 $p^\\ast$，并确保 $p^\\ast \\ge 0$。\n4. 对于给定的母粒子四维速度 $u^{\\mu}$，将您推导出的助推应用于生成的末态四维矢量以获得实验室系中的四维矢量，并数值验证：\n   - 总四维动量按要求变换，使得助推后的子粒子四维矢量之和等于 $M u^{\\mu}$。\n   - 对于每个子粒子，雅可比恒等式 $\\det(\\partial \\boldsymbol{p}'/\\partial \\boldsymbol{p}) = E'/E$ 在固定的绝对容差内成立。\n5. 您的程序应运行以下参数集的测试套件，并为每个测试用例报告所有检查是否通过，以单个布尔值的形式表示：\n   - 测试1（两体，中等助推）：$M = 5.0$ $\\mathrm{GeV}$，子粒子质量 $\\left[1.0, 1.0\\right]$ $\\mathrm{GeV}$，实验室四维速度 $u^{\\mu} = \\left(1.25, 0.75, 0.0, 0.0\\right)$。\n   - 测试2（三体，斜向助推）：$M = 10.0$ $\\mathrm{GeV}$，子粒子质量 $\\left[2.0, 1.0, 0.5\\right]$ $\\mathrm{GeV}$，实验室四维速度 $u^{\\mu} = \\left(1.6666666666666667, 0.4444444444444444, 0.8888888888888888, 0.8888888888888888\\right)$。\n   - 测试3（四体，单位助推）：$M = 6.0$ $\\mathrm{GeV}$，子粒子质量 $\\left[0.5, 0.5, 0.5, 0.5\\right]$ $\\mathrm{GeV}$，实验室四维速度 $u^{\\mu} = \\left(1.0, 0.0, 0.0, 0.0\\right)$。\n   - 测试4（三体，含无质量子粒子的超相对论性助推）：$M = 3.0$ $\\mathrm{GeV}$，子粒子质量 $\\left[0.0, 0.5, 0.3\\right]$ $\\mathrm{GeV}$，实验室四维速度 $u^{\\mu} = \\left(7.088812050083354, 0.0, 0.0, 7.01792392958252\\right)$。\n\n数值和单位要求：\n- 使用自然单位制，能量和质量以 $\\mathrm{GeV}$ 为单位，角度以弧度为单位。\n- 对于所有涉及浮点计算的相等性检查，使用 $10^{-8}$ 的绝对容差。\n- 每个测试用例使用固定的伪随机数生成器种子来获得确定性的各向同性角，以确保输出是可重复的。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含四个测试用例的结果，形式为方括号括起来的逗号分隔的布尔值列表，例如 $\\left[\\text{True},\\text{False},\\text{True},\\text{True}\\right]$。确切要求的格式是：使用 Python 列表字面量语法的单行文本，例如，「[True,False,True,True]」。",
            "solution": "该问题提出了计算高能物理领域的一项综合性任务：推导、实现并验证一个洛伦兹协变的多体衰变事件生成器。问题陈述具有科学依据，定义明确且客观。它完全基于狭义相对论的原理，使用了四维矢量、闵可夫斯基度规、洛伦兹变换和洛伦兹不变相空间测度等标准定义和形式体系。所提供的测试用例参数在运动学上是允许且一致的。因此，该问题是有效的，下面将给出完整的解决方案。\n\n**1. 洛伦兹助推变换的推导**\n\n我们的任务是找到一个变换，它将一个四维矢量 $p^{\\mu} = (E, \\boldsymbol{p})$ 从母粒子的静止系映射到实验室系，在该实验室系中母粒子的四维速度为 $u^{\\mu} = (\\gamma, \\gamma\\boldsymbol{\\beta})$。设静止系为 $S$，实验室系为 $S'$。母粒子在 $S$ 系中静止，在 $S'$ 系中以三维速度 $\\boldsymbol{\\beta}$ 运动。因此，$S$ 系相对于 $S'$ 系以速度 $-\\boldsymbol{\\beta}$ 运动。从 $S$ 系到 $S'$ 系的助推因此是一个速度为 $+\\boldsymbol{\\beta}$ 的助推。\n\n一个通用的洛伦兹助推由矩阵 $\\Lambda(\\boldsymbol{\\beta})$ 描述。$S$ 系中的一个四维矢量 $p^{\\mu}$ 通过 $p'^{\\mu} = \\Lambda^{\\mu}_{\\ \\nu} p^{\\nu}$ 变换到 $S'$ 系中的 $p'^{\\mu}$。助推矩阵 $\\Lambda(\\boldsymbol{\\beta})$ 的分量为：\n$$\n\\begin{align*}\n\\Lambda^{0}_{\\ 0} = \\gamma \\\\\n\\Lambda^{i}_{\\ 0} = \\Lambda^{0}_{\\ i} = \\gamma \\beta^i \\\\\n\\Lambda^{i}_{\\ j} = \\delta_{ij} + (\\gamma-1) \\frac{\\beta^i \\beta^j}{\\boldsymbol{\\beta}^2}\n\\end{align*}\n$$\n其中 $\\gamma = 1/\\sqrt{1-\\boldsymbol{\\beta}^2}$ 是洛伦兹因子，$\\beta^i$ 是三维速度 $\\boldsymbol{\\beta}$ 的分量，$\\delta_{ij}$ 是克罗内克 δ。母粒子的四维速度 $u^{\\mu}$ 定义为 $(\\gamma, \\gamma\\boldsymbol{\\beta})$，这直接提供了助推参数 $\\gamma = u^0$ 和 $\\boldsymbol{\\beta} = \\boldsymbol{u}/u^0$，其中 $\\boldsymbol{u}$ 是 $u^\\mu$ 的空间部分。\n\n将此变换应用于 $p^{\\mu} = (E, p^1, p^2, p^3) = (E, \\boldsymbol{p})$，我们得到助推后四维矢量 $p'^{\\mu} = (E', \\boldsymbol{p}')$ 的分量：\n\n时间分量 $E' = p'^0$：\n$$\nE' = \\Lambda^{0}_{\\ \\nu} p^{\\nu} = \\Lambda^{0}_{\\ 0} p^0 + \\sum_{j=1}^3 \\Lambda^{0}_{\\ j} p^j = \\gamma E + \\sum_{j=1}^3 \\gamma \\beta^j p^j = \\gamma (E + \\boldsymbol{\\beta} \\cdot \\boldsymbol{p})\n$$\n\n空间分量 $p'^i$：\n$$\np'^i = \\Lambda^{i}_{\\ \\nu} p^{\\nu} = \\Lambda^{i}_{\\ 0} p^0 + \\sum_{j=1}^3 \\Lambda^{i}_{\\ j} p^j = \\gamma \\beta^i E + \\sum_{j=1}^3 \\left(\\delta_{ij} + (\\gamma-1) \\frac{\\beta^i \\beta^j}{\\boldsymbol{\\beta}^2}\\right) p^j\n$$\n用矢量符号表示，这变为：\n$$\n\\boldsymbol{p}' = \\gamma E \\boldsymbol{\\beta} + \\boldsymbol{p} + (\\gamma-1) \\frac{\\boldsymbol{\\beta} (\\boldsymbol{\\beta} \\cdot \\boldsymbol{p})}{\\boldsymbol{\\beta}^2} = \\boldsymbol{p} + \\gamma E \\boldsymbol{\\beta} + (\\gamma-1) \\frac{(\\boldsymbol{p} \\cdot \\boldsymbol{\\beta})}{\\boldsymbol{\\beta}^2} \\boldsymbol{\\beta}\n$$\n这些方程代表了从母粒子静止系到实验室系的任意四维矢量的完整变换。\n\n**2. 雅可比行列式与相空间元的不变性**\n\n我们被要求证明空间动量变换的雅可比行列式为 $\\det(\\partial \\boldsymbol{p}'/\\partial \\boldsymbol{p}) = E'/E$。该变换为 $\\boldsymbol{p}'(\\boldsymbol{p}) = \\boldsymbol{p} + \\gamma E(\\boldsymbol{p}) \\boldsymbol{\\beta} + (\\gamma-1) \\frac{(\\boldsymbol{p} \\cdot \\boldsymbol{\\beta})}{\\boldsymbol{\\beta}^2} \\boldsymbol{\\beta}$，其中能量 $E$ 通过在壳关系 $E = \\sqrt{m^2 + \\boldsymbol{p}^2}$ 是 $\\boldsymbol{p}$ 的函数。$E$ 对动量分量 $p_j$ 的偏导数为 $\\partial E / \\partial p_j = p_j/E$。\n\n雅可比矩阵 $J$ 的元素为 $J_{ij} = \\partial p'_i / \\partial p_j$：\n$$\nJ_{ij} = \\frac{\\partial p'_i}{\\partial p_j} = \\delta_{ij} + \\gamma \\beta_i \\frac{\\partial E}{\\partial p_j} + \\frac{\\gamma-1}{\\boldsymbol{\\beta}^2} \\beta_i \\frac{\\partial}{\\partial p_j}(\\boldsymbol{p} \\cdot \\boldsymbol{\\beta})\n$$\n$$\nJ_{ij} = \\delta_{ij} + \\gamma \\beta_i \\frac{p_j}{E} + \\frac{\\gamma-1}{\\boldsymbol{\\beta}^2} \\beta_i \\beta_j\n$$\n这可以用张量积表示法写为 $J = I + \\boldsymbol{\\beta} \\otimes \\left( \\frac{\\gamma}{E}\\boldsymbol{p} + \\frac{\\gamma-1}{\\boldsymbol{\\beta}^2}\\boldsymbol{\\beta} \\right)^T$。使用矩阵行列式引理 $\\det(I + \\boldsymbol{a}\\boldsymbol{b}^T) = 1 + \\boldsymbol{b}^T \\boldsymbol{a} = 1 + \\boldsymbol{a} \\cdot \\boldsymbol{b}$，我们有：\n$$\n\\det(J) = 1 + \\boldsymbol{\\beta} \\cdot \\left( \\frac{\\gamma}{E}\\boldsymbol{p} + \\frac{\\gamma-1}{\\boldsymbol{\\beta}^2}\\boldsymbol{\\beta} \\right) = 1 + \\frac{\\gamma}{E}(\\boldsymbol{\\beta} \\cdot \\boldsymbol{p}) + \\frac{\\gamma-1}{\\boldsymbol{\\beta}^2}(\\boldsymbol{\\beta} \\cdot \\boldsymbol{\\beta})\n$$\n$$\n\\det(J) = 1 + \\frac{\\gamma}{E}(\\boldsymbol{\\beta} \\cdot \\boldsymbol{p}) + \\gamma - 1 = \\gamma + \\frac{\\gamma}{E}(\\boldsymbol{\\beta} \\cdot \\boldsymbol{p}) = \\frac{\\gamma E + \\gamma(\\boldsymbol{\\beta} \\cdot \\boldsymbol{p})}{E}\n$$\n分子恰好是助推后能量 $E'$ 的表达式。因此，我们证明了恒等式：\n$$\n\\det\\left(\\frac{\\partial \\boldsymbol{p}'}{\\partial \\boldsymbol{p}}\\right) = \\frac{E'}{E}\n$$\n三维动量空间的体积元变换为 $d^3\\boldsymbol{p}' = |\\det(J)| d^3\\boldsymbol{p} = (E'/E) d^3\\boldsymbol{p}$，因为能量是正的。重新整理这个关系，我们发现：\n$$\n\\frac{d^3\\boldsymbol{p}'}{E'} = \\frac{d^3\\boldsymbol{p}}{E}\n$$\n这证明了每个粒子的测度 $d^3\\boldsymbol{p}/E$ 是洛伦兹不变的。由于完整的相空间测度 $d\\Phi_n$ 是这些项与洛伦兹不变的 δ 函数 $\\delta^{(4)}(P - \\sum p_i)$ 的乘积，因此 $d\\Phi_n$ 本身也是洛伦兹不变的。\n\n**3. 确定性事件生成器算法**\n\n为了在母粒子静止系中生成一个 $n$体衰变 $M \\to m_1 + \\dots + m_n$，我们采用一种递归算法，将该过程建模为一系列连续的两体衰变链：$M \\to V_{n-1} + m_n$，然后 $V_{n-1} \\to V_{n-2} + m_{n-1}$，依此类推，直到最终的两体衰变 $V_2 \\to m_1 + m_2$。这里，$V_k$ 是一个虚拟中间粒子，代表前 $k$ 个末态粒子系统的不变质量。\n\n该算法的核心是一个处理两体衰变 $m_0 \\to m_a + m_b$ 的函数。在 $m_0$ 的静止系中，运动学规定两个子粒子以相等的动量大小 $p^*$ 背对背产生。该动量由 Källén 函数 $\\lambda(x, y, z) = x^2+y^2+z^2-2xy-2yz-2zx$ 给出：\n$$\np^* = \\frac{\\sqrt{\\lambda(m_0^2, m_a^2, m_b^2)}}{2m_0}\n$$\n如果 $m_0 > m_a + m_b$，则衰变在运动学上是允许的，这确保了 $p^* > 0$。发射方向是各向同性的，意味着它在 $4\\pi$ 的立体角上均匀分布。我们使用从确定性伪随机数中采样的极角 $\\theta$ 和方位角 $\\phi$ 来生成这个方向：$\\cos\\theta$ 在 $[-1, 1]$ 内均匀分布，$\\phi$ 在 $[0, 2\\pi]$ 内均匀分布。产生的三维动量为 $\\boldsymbol{p}_a = p^*\\hat{n}$ 和 $\\boldsymbol{p}_b = -p^*\\hat{n}$，其中 $\\hat{n}$ 是所选方向的单位矢量。能量则为 $E_a = \\sqrt{m_a^2+(p^*)^2}$ 和 $E_b = \\sqrt{m_b^2+(p^*)^2}$。\n\n对于从 $n$ 到 $n-1$ 个粒子的递归步骤，我们考虑衰变 $M \\to V_{n-1} + m_n$。虚拟粒子的质量 $m_{V_{n-1}}$ 不是固定的。它必须位于运动学允许的范围 $[\\sum_{i=1}^{n-1} m_i, M - m_n]$ 内。为确保对可用相空间进行确定性且具有代表性的采样，虚拟粒子质量的平方 $m_{V_{n-1}}^2$ 基于一个伪随机数 $r \\in [0, 1]$ 在其允许范围内进行线性插值来选择：\n$$\nm_{V_{n-1}}^2 = \\left(\\sum_{i=1}^{n-1} m_i\\right)^2 + r \\cdot \\left((M - m_n)^2 - \\left(\\sum_{i=1}^{n-1} m_i\\right)^2\\right)\n$$\n在确定 $m_{V_{n-1}}$ 后，我们在母粒子静止系中执行 $M$ 到 $V_{n-1}$ 和 $m_n$ 的两体衰变。这会得到它们的四维动量。构成 $V_{n-1}$ 的 $n-1$ 个粒子随后通过对同一函数的递归调用生成，以 $m_{V_{n-1}}$ 作为新的母粒子质量。这 $n-1$ 个子粒子在 $V_{n-1}$ 的静止系中生成，并且必须使用 $V_{n-1}$ 的速度 $\\boldsymbol{\\beta}_V = \\boldsymbol{p}_{V_{n-1}}/E_{V_{n-1}}$ 将它们助推到原始的母粒子静止系中。最终输出是所有 $n$ 个助推后的四维矢量的集合。\n\n**4. 验证程序**\n\n实现的生成器需要根据每个测试用例的几个标准进行验证：\n1.  **静止系动量守恒**：在母粒子静止系中，所有生成的末态粒子的四维动量之和 $\\sum p_i^{\\mu}$ 必须在 $10^{-8}$ 的数值容差内等于母粒子的四维动量 $P^{\\mu} = (M, 0, 0, 0)$。\n2.  **实验室系动量守恒**：将四维动量 $p_i^{\\mu}$ 助推到实验室系以获得 $p'^{\\mu}_i$。这些助推后的四维矢量之和 $\\sum p'^{\\mu}_i$ 必须在相同的容差内等于母粒子在实验室系中的四维动量 $P'^{\\mu} = M u^{\\mu}$。\n3.  **雅可比恒等式**：对于每个子粒子 $i$，我们数值计算 $3 \\times 3$ 的雅可比矩阵 $J_i = \\partial \\boldsymbol{p}'_i/\\partial \\boldsymbol{p}_i$。然后将其行列式 $\\det(J_i)$ 与实验室系能量与静止系能量之比 $E'_i/E_i$ 进行比较。对于所有子粒子，这个等式必须在指定的容差内成立。\n\n仅当所有这三项检查都满足时，一个测试用例才被视为通过（`True`）。如果任何一项检查对任何粒子失败，则整个测试用例被标记为 `False`。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Set the absolute tolerance for all floating-point comparisons.\nTOLERANCE = 1e-8\n\ndef kallen(x_sq, y_sq, z_sq):\n    \"\"\"\n    Computes the Källén function lambda(x^2, y^2, z^2).\n    This form is more numerically stable than the one with square roots.\n    \"\"\"\n    return (x_sq - y_sq - z_sq)**2 - 4 * y_sq * z_sq\n\ndef boost(p4, beta_vec):\n    \"\"\"\n    Performs a Lorentz boost on a four-vector p4.\n    \n    Args:\n        p4 (np.ndarray): The four-vector (E, px, py, pz).\n        beta_vec (np.ndarray): The 3-velocity vector for the boost.\n\n    Returns:\n        np.ndarray: The boosted four-vector.\n    \"\"\"\n    beta_sq = np.dot(beta_vec, beta_vec)\n    if beta_sq  TOLERANCE**2:\n        return p4\n        \n    gamma = 1.0 / np.sqrt(1.0 - beta_sq)\n    E = p4[0]\n    p_vec = p4[1:]\n    \n    beta_dot_p = np.dot(beta_vec, p_vec)\n    \n    E_prime = gamma * (E + beta_dot_p)\n    p_prime_vec = p_vec + gamma * E * beta_vec + (gamma - 1.0) * beta_dot_p / beta_sq * beta_vec\n    \n    return np.array([E_prime, p_prime_vec[0], p_prime_vec[1], p_prime_vec[2]])\n\ndef generate_decay_products(parent_mass, daughter_masses, rng):\n    \"\"\"\n    Recursively generates four-vectors for an n-body decay in the parent rest frame.\n\n    Args:\n        parent_mass (float): Mass of the decaying parent particle.\n        daughter_masses (list[float]): List of masses of the final-state particles.\n        rng (np.random.Generator): A seeded random number generator.\n\n    Returns:\n        list[np.ndarray]: A list of the final-state particles' four-vectors.\n    \"\"\"\n    n = len(daughter_masses)\n    \n    if n == 1:\n        return [np.array([parent_mass, 0.0, 0.0, 0.0])]\n\n    # Recursive step: M -> V + m_n, where V decays to the first n-1 particles.\n    head_masses = daughter_masses[:-1]\n    tail_mass = daughter_masses[-1]\n    \n    # Determine the kinematically allowed range for the virtual particle's mass.\n    m_head_min = sum(head_masses)\n    m_head_max = parent_mass - tail_mass\n    \n    # Generate the virtual mass by sampling its square uniformly.\n    r = rng.random()\n    m_head_sq = m_head_min**2 + r * (m_head_max**2 - m_head_min**2)\n    m_head = np.sqrt(m_head_sq)\n\n    # Perform the two-body decay of the parent into the virtual particle and the last daughter.\n    p_star_sq = kallen(parent_mass**2, m_head**2, tail_mass**2) / (4 * parent_mass**2)\n    p_star_mag = np.sqrt(p_star_sq)\n    \n    # Generate an isotropic direction for the decay products.\n    costh = 2.0 * rng.random() - 1.0\n    sinth = np.sqrt(1.0 - costh**2)\n    phi = 2.0 * np.pi * rng.random()\n    \n    p_star_vec = p_star_mag * np.array([sinth * np.cos(phi), sinth * np.sin(phi), costh])\n    \n    # Calculate four-vectors for the virtual particle and the tail daughter.\n    E_head = np.sqrt(m_head**2 + p_star_mag**2)\n    E_tail = np.sqrt(tail_mass**2 + p_star_mag**2)\n    \n    p4_head_in_parent_frame = np.array([E_head, *p_star_vec])\n    p4_tail_in_parent_frame = np.array([E_tail, *-p_star_vec])\n    \n    # Recursively generate decay products for the virtual particle in its own rest frame.\n    daughters_in_head_frame = generate_decay_products(m_head, head_masses, rng)\n    \n    # Boost these products from the virtual particle's rest frame to the parent's rest frame.\n    beta_vec_boost = p_star_vec / E_head\n    boosted_daughters = [boost(p4, beta_vec_boost) for p4 in daughters_in_head_frame]\n    \n    return boosted_daughters + [p4_tail_in_parent_frame]\n\ndef calculate_jacobian(p4_rest, beta_vec):\n    \"\"\"\n    Calculates the 3x3 Jacobian matrix of the momentum transformation.\n    \"\"\"\n    beta_sq = np.dot(beta_vec, beta_vec)\n    if beta_sq  TOLERANCE**2:\n        return np.identity(3)\n\n    gamma = 1.0 / np.sqrt(1.0 - beta_sq)\n    E_rest = p4_rest[0]\n    p_rest_vec = p4_rest[1:]\n\n    # J_ij = delta_ij + (gamma * p_j / E) * beta_i + ((gamma-1)/beta^2) * beta_i * beta_j\n    term2 = np.outer(beta_vec, (gamma / E_rest) * p_rest_vec)\n    term3 = ((gamma - 1.0) / beta_sq) * np.outer(beta_vec, beta_vec)\n    \n    return np.identity(3) + term2 + term3\n\ndef solve():\n    test_cases = [\n        # Test 1 (two-body, moderate boost)\n        {'M': 5.0, 'masses': [1.0, 1.0], 'u_lab': np.array([1.25, 0.75, 0.0, 0.0])},\n        # Test 2 (three-body, oblique boost)\n        {'M': 10.0, 'masses': [2.0, 1.0, 0.5], 'u_lab': np.array([1.6666666666666667, 0.4444444444444444, 0.8888888888888888, 0.8888888888888888])},\n        # Test 3 (four-body, identity boost)\n        {'M': 6.0, 'masses': [0.5, 0.5, 0.5, 0.5], 'u_lab': np.array([1.0, 0.0, 0.0, 0.0])},\n        # Test 4 (three-body, ultra-relativistic boost with a massless daughter)\n        {'M': 3.0, 'masses': [0.0, 0.5, 0.3], 'u_lab': np.array([7.088812050083354, 0.0, 0.0, 7.01792392958252])}\n    ]\n\n    results = []\n    for i, case in enumerate(test_cases):\n        M, masses, u_lab = case['M'], case['masses'], case['u_lab']\n        \n        # Use a deterministic seed for each test case for reproducibility.\n        rng = np.random.default_rng(seed=i)\n        \n        case_passed = True\n        \n        # Pre-check kinematics\n        if M  sum(masses) - TOLERANCE:\n            results.append(False)\n            continue\n            \n        # 1. Generate decay products in the parent rest frame.\n        rest_frame_p4s = generate_decay_products(M, masses, rng)\n        \n        # 2. Verify momentum conservation in the rest frame.\n        total_p4_rest = np.sum(rest_frame_p4s, axis=0)\n        expected_p4_rest = np.array([M, 0.0, 0.0, 0.0])\n        if not np.allclose(total_p4_rest, expected_p4_rest, atol=TOLERANCE, rtol=0):\n            case_passed = False\n        \n        # 3. Boost all particles to the lab frame.\n        gamma = u_lab[0]\n        beta_vec = u_lab[1:] / gamma if gamma > 1.0 else np.array([0.0, 0.0, 0.0])\n        \n        lab_frame_p4s = [boost(p4, beta_vec) for p4 in rest_frame_p4s]\n        \n        # 4. Verify momentum conservation in the lab frame.\n        total_p4_lab = np.sum(lab_frame_p4s, axis=0)\n        expected_p4_lab = M * u_lab\n        if not np.allclose(total_p4_lab, expected_p4_lab, atol=TOLERANCE, rtol=0):\n            case_passed = False\n            \n        # 5. Verify the Jacobian identity for each particle.\n        beta_sq = np.dot(beta_vec, beta_vec)\n        if beta_sq > TOLERANCE**2:\n            for p4_rest, p4_lab in zip(rest_frame_p4s, lab_frame_p4s):\n                E_rest, E_lab = p4_rest[0], p4_lab[0]\n                \n                # Avoid division by zero for particles at rest (should not happen for daughters)\n                if E_rest  TOLERANCE:\n                    # If rest energy is zero, lab energy must also be zero (for non-singular Jacobian)\n                    if abs(E_lab) > TOLERANCE:\n                        case_passed = False\n                    continue\n\n                jacobian = calculate_jacobian(p4_rest, beta_vec)\n                det_J = np.linalg.det(jacobian)\n                ratio_E = E_lab / E_rest\n                \n                if not np.isclose(det_J, ratio_E, atol=TOLERANCE, rtol=0):\n                    case_passed = False\n                    break # A single failure is enough\n        \n        results.append(case_passed)\n        \n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}