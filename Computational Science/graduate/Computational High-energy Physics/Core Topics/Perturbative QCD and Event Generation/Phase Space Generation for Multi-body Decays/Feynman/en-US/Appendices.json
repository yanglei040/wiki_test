{
    "hands_on_practices": [
        {
            "introduction": "A powerful technique for handling complex multi-body decays is to model them as a sequence of simpler two-body decays. This approach introduces intermediate, or \"virtual,\" particles whose masses are not fixed but integrated over. This exercise  guides you through the essential first step of deriving the strict kinematic limits for the invariant mass of such a subsystem, using the elegant and powerful Källén function to ensure the decay chain is physically possible.",
            "id": "3528144",
            "problem": "Consider a parent particle of mass $M$ decaying into three daughter particles with masses $m_{1}$, $m_{2}$, and $m_{3}$. Denote the four-momenta of the daughters by $p_{1}$, $p_{2}$, and $p_{3}$, with $p_{i}^{2} = m_{i}^{2}$, and define the invariant mass squared of the $(1,2)$ subsystem by $s_{12} \\equiv (p_{1} + p_{2})^{2}$. Work in a metric with signature $(+,-,-,-)$ and in the rest frame of the parent where $p_{\\text{parent}}^{\\mu} = (M, \\mathbf{0})$. Assume $M \\ge m_{1} + m_{2} + m_{3}$ so that the decay is kinematically allowed.\n\nIn computational high-energy physics, phase space generation for three-body decays often proceeds by factorizing the three-body phase space into two successive two-body phase spaces, with an intermediate effective particle of invariant mass $\\sqrt{s_{12}}$ recoiling against particle $3$, and then decaying into particles $1$ and $2$. For such a factorization to be kinematically valid, the center-of-mass (CM) momenta in both two-body subprocesses must be real. This requirement is encoded by the non-negativity of the Källén function,\n$\\lambda(x,y,z) \\equiv x^{2} + y^{2} + z^{2} - 2xy - 2yz - 2zx,$\napplied to each subprocess:\n$$\\lambda(s_{12}, m_{1}^{2}, m_{2}^{2}) \\ge 0 \\quad \\text{and} \\quad \\lambda(M^{2}, s_{12}, m_{3}^{2}) \\ge 0.$$\n\nStarting only from energy-momentum conservation, the definition of the Källén function, and the physical requirement that CM momenta be real in two-body kinematics, determine the allowed integration interval for $s_{12}$ that simultaneously satisfies both inequalities. Express your final answer as a closed-form analytic expression in terms of $M$, $m_{1}$, $m_{2}$, and $m_{3}$ only. No numerical evaluation is required. Provide the lower and upper limits for $s_{12}$ as your final answer.",
            "solution": "We begin by recalling two-body kinematics and how the Källén function controls the reality of CM momenta. For a two-body system with total invariant mass squared $s$ decaying into particles of masses $m_{a}$ and $m_{b}$, the magnitude of the three-momentum in the center-of-mass (CM) frame is\n$$\nk(s; m_{a}, m_{b}) = \\frac{\\sqrt{\\lambda(s, m_{a}^{2}, m_{b}^{2})}}{2\\sqrt{s}}.\n$$\nThe CM momentum is real if and only if $\\lambda(s, m_{a}^{2}, m_{b}^{2}) \\ge 0$. This condition embodies the triangle inequalities in relativistic kinematics.\n\nFor the three-body decay $M \\to 1\\,2\\,3$, we factorize the kinematics into two successive two-body subsystems:\n1. The effective particle of invariant mass $\\sqrt{s_{12}}$ recoils against particle $3$ in the parent rest frame. The corresponding CM momentum is real if and only if\n$$\n\\lambda(M^{2}, s_{12}, m_{3}^{2}) \\ge 0.\n$$\n2. In the rest frame of the $(1,2)$ subsystem, the effective particle of mass $\\sqrt{s_{12}}$ decays into particles $1$ and $2$. The corresponding CM momentum is real if and only if\n$$\n\\lambda(s_{12}, m_{1}^{2}, m_{2}^{2}) \\ge 0.\n$$\n\nWe now analyze the implications of each inequality for $s_{12}$.\n\nFirst, consider $\\lambda(s_{12}, m_{1}^{2}, m_{2}^{2}) \\ge 0$. Using the identity\n$$\n\\lambda(s, m_{1}^{2}, m_{2}^{2}) = \\left(s - (m_{1} + m_{2})^{2}\\right)\\left(s - (m_{1} - m_{2})^{2}\\right),\n$$\nthe inequality $\\lambda(s_{12}, m_{1}^{2}, m_{2}^{2}) \\ge 0$ implies\n$$\ns_{12} \\le (m_{1} - m_{2})^{2} \\quad \\text{or} \\quad s_{12} \\ge (m_{1} + m_{2})^{2}.\n$$\nPhysically, the invariant mass of a two-particle system composed of two on-shell particles with positive energies must satisfy $\\sqrt{s_{12}} \\ge m_{1} + m_{2}$; the branch $s_{12} \\le (m_{1} - m_{2})^{2}$ corresponds to a spacelike or unphysical configuration for on-shell decay products with positive energies and is excluded in the decay kinematics. Therefore, the physical constraint from the $(1,2)$ decay is\n$$\ns_{12} \\ge (m_{1} + m_{2})^{2}.\n$$\n\nSecond, consider $\\lambda(M^{2}, s_{12}, m_{3}^{2}) \\ge 0$. Using the analogous factorization,\n$$\n\\lambda(M^{2}, s_{12}, m_{3}^{2}) = \\left(M^{2} - \\left(\\sqrt{s_{12}} + m_{3}\\right)^{2}\\right)\\left(M^{2} - \\left(\\sqrt{s_{12}} - m_{3}\\right)^{2}\\right),\n$$\nthe inequality implies\n$$\ns_{12} \\le (M - m_{3})^{2} \\quad \\text{or} \\quad s_{12} \\ge (M + m_{3})^{2}.\n$$\nThe branch $s_{12} \\ge (M + m_{3})^{2}$ is incompatible with energy-momentum conservation in a decay with parent mass $M$, since it would require the invariant mass of the $(1,2)$ subsystem to exceed the parent mass by at least $m_{3}$. Therefore, the physical constraint from the recoil of particle $3$ against the $(1,2)$ cluster in the parent rest frame is\n$$\ns_{12} \\le (M - m_{3})^{2}.\n$$\n\nCombining the two physical constraints, the allowed interval for $s_{12}$ that ensures real CM momenta in both subprocesses is\n$$\n(m_{1} + m_{2})^{2} \\le s_{12} \\le (M - m_{3})^{2}.\n$$\nThis interval is non-empty precisely when $M \\ge m_{1} + m_{2} + m_{3}$, which is the assumed condition for the decay to be kinematically allowed. Hence, the integration limits for $s_{12}$ in the factorized three-body phase space are given by the lower bound $(m_{1} + m_{2})^{2}$ and the upper bound $(M - m_{3})^{2}$.",
            "answer": "$$\\boxed{\\begin{pmatrix}(m_{1}+m_{2})^{2}  (M-m_{3})^{2}\\end{pmatrix}}$$"
        },
        {
            "introduction": "While abstract variables like invariant masses are powerful, a geometric picture provides deep intuition. The Dalitz plot is a classic tool in particle physics for visualizing the phase space of a three-body decay. Deriving its boundaries from first principles  solidifies the connection between abstract Lorentz invariants and the concrete, geometric shape of the allowed kinematic region, enhancing intuition by showing how energy-momentum conservation carves out a specific area in the space of invariants.",
            "id": "3528129",
            "problem": "A single scalar particle of mass $M$ at rest decays into three massless final-state particles with four-momenta $p_{1}$, $p_{2}$, and $p_{3}$. Denote the initial four-momentum by $P$, so that $P^{\\mu}=p_{1}^{\\mu}+p_{2}^{\\mu}+p_{3}^{\\mu}$ and $P^{2}=M^{2}$. Define the pairwise Mandelstam invariants $s_{ij}=(p_{i}+p_{j})^{2}$ and their normalized forms $x_{ij}=s_{ij}/M^{2}$, and consider a Dalitz plot in the $(x_{12},x_{13})$ plane with $x_{23}=1-x_{12}-x_{13}$.\n\nStarting only from energy-momentum conservation, the mass-shell conditions $p_{i}^{2}=0$, and the requirement that the configuration be physically realizable in the rest frame of the decaying particle, derive the kinematic boundary of the allowed region in the $(x_{12},x_{13})$ Dalitz plot. Your derivation must explicitly connect the constraints on the final-state energies and angles to the constraints on the invariants $x_{ij}$.\n\nProvide, as your final answer, a single closed-form algebraic expression $f(x_{12},x_{13})$ whose vanishing defines the boundary curve of the Dalitz plot in the $(x_{12},x_{13})$ plane. Do not include any inequalities in your final answer. No numerical evaluation is required, and no units are needed. The final answer must be a single algebraic expression in $x_{12}$ and $x_{13}$ only.",
            "solution": "The problem requires the derivation of the kinematic boundary for the decay of a massive scalar particle into three massless particles. The derivation must originate from fundamental principles of energy-momentum conservation and the physical realizability of the final state, and explicitly connect kinematic variables (energies and angles) to the Mandelstam invariants.\n\nWe begin by analyzing the decay in the rest frame of the initial particle of mass $M$. The four-momentum of this particle is $P^{\\mu} = (M, \\vec{0})$. The final state consists of three massless particles with four-momenta $p_1^{\\mu}$, $p_2^{\\mu}$, and $p_3^{\\mu}$. For a massless particle $i$, its four-momentum is $p_i^{\\mu} = (E_i, \\vec{p}_i)$ with the mass-shell condition $p_i^2 = E_i^2 - |\\vec{p}_i|^2 = 0$, which implies that its energy $E_i$ equals the magnitude of its three-momentum, $E_i = |\\vec{p}_i|$.\n\nEnergy-momentum conservation dictates that $P^{\\mu} = p_1^{\\mu} + p_2^{\\mu} + p_3^{\\mu}$.\nIn the rest frame, this separates into:\n1. Energy conservation: $M = E_1 + E_2 + E_3$.\n2. Momentum conservation: $\\vec{0} = \\vec{p}_1 + \\vec{p}_2 + \\vec{p}_3$.\n\nThe Mandelstam invariants $s_{ij}$ are defined as $s_{ij} = (p_i + p_j)^2$. Since the final-state particles are massless ($p_i^2 = p_j^2 = 0$), this simplifies to $s_{ij} = 2 p_i \\cdot p_j$.\nWe can relate these invariants to the energies of the final-state particles. Consider the invariant $s_{12}$:\n$s_{12} = (p_1 + p_2)^2$. Using momentum conservation, we can write $p_1 + p_2 = P - p_3$.\nSubstituting this, we get:\n$s_{12} = (P - p_3)^2 = P^2 - 2 P \\cdot p_3 + p_3^2$.\nWe are given $P^2 = M^2$ and $p_3^2 = 0$. In the rest frame of the decaying particle, the dot product $P \\cdot p_3$ is given by $P \\cdot p_3 = P_{\\mu} p_3^{\\mu} = (M, \\vec{0}) \\cdot (E_3, \\vec{p}_3) = M E_3$.\nTherefore, we find a direct relation between $s_{12}$ and $E_3$:\n$s_{12} = M^2 - 2 M E_3$.\nSolving for $E_3$, we obtain:\n$$E_3 = \\frac{M^2 - s_{12}}{2M}$$\nBy cyclic permutation of the indices $(1, 2, 3)$, we can write the energies of the other two particles:\n$$E_1 = \\frac{M^2 - s_{23}}{2M}$$\n$$E_2 = \\frac{M^2 - s_{13}}{2M}$$\nSince energies must be non-negative ($E_i \\ge 0$), this implies $s_{jk} \\le M^2$, or in terms of normalized variables $x_{jk} = s_{jk}/M^2$, we have $x_{jk} \\le 1$. Also, $s_{ij} = (p_i + p_j)^2$ is the squared invariant mass of the pair $(i, j)$, which must be non-negative, so $s_{ij} \\ge 0$ and $x_{ij} \\ge 0$.\n\nThe momentum conservation equation $\\vec{p}_1 + \\vec{p}_2 + \\vec{p}_3 = \\vec{0}$ implies that the three momentum vectors must form a closed triangle. This is possible only if they are coplanar. A configuration is physically realizable if a real triangle (or a degenerate line) can be formed with side lengths $|\\vec{p}_1|=E_1$, $|\\vec{p}_2|=E_2$, and $|\\vec{p}_3|=E_3$. This requires that the triangle inequalities are satisfied: $E_i+E_j \\ge E_k$ for any permutation $(i,j,k)$. Using the energy conservation equation $E_1+E_2+E_3=M$, the inequality $E_1+E_2 \\ge E_3$ becomes $M-E_3 \\ge E_3$, which simplifies to $M \\ge 2E_3$, or $E_3 \\le M/2$. This condition means that the energy of any single final-state particle cannot exceed half the mass of the decaying particle.\n\nThe boundary of the kinematically allowed region corresponds to the case where these inequalities are saturated, i.e., where the momentum triangle degenerates into a line. This occurs when the momentum vectors are collinear. For example, if $\\vec{p}_1$ and $\\vec{p}_2$ are antiparallel, then $\\vec{p}_3$ must be collinear with them to satisfy momentum conservation. Let $\\theta_{ij}$ be the angle between $\\vec{p}_i$ and $\\vec{p}_j$. The collinear configuration corresponds to $\\cos\\theta_{ij} = \\pm 1$.\n\nLet's formalize this. From the momentum triangle, we can write $\\vec{p}_3 = -(\\vec{p}_1 + \\vec{p}_2)$. Taking the squared magnitude of both sides:\n$|\\vec{p}_3|^2 = |\\vec{p}_1 + \\vec{p}_2|^2 = |\\vec{p}_1|^2 + |\\vec{p}_2|^2 + 2 \\vec{p}_1 \\cdot \\vec{p}_2$.\nUsing $E_i = |\\vec{p}_i|$ and $\\vec{p}_1 \\cdot \\vec{p}_2 = |\\vec{p}_1||\\vec{p}_2|\\cos\\theta_{12} = E_1 E_2 \\cos\\theta_{12}$, we get:\n$E_3^2 = E_1^2 + E_2^2 + 2 E_1 E_2 \\cos\\theta_{12}$.\nSolving for $\\cos\\theta_{12}$:\n$$\\cos\\theta_{12} = \\frac{E_3^2 - E_1^2 - E_2^2}{2 E_1 E_2}$$\nFor a physical configuration to exist, the angle $\\theta_{12}$ must be real, which requires $|\\cos\\theta_{12}| \\le 1$. The boundary of the phase space is defined by the limit $|\\cos\\theta_{12}| = 1$. This corresponds to $E_3^2 = (E_1 \\pm E_2)^2$, which is equivalent to the saturated triangle inequalities $E_3 = |E_1 \\pm E_2|$. Along with $E_1+E_2+E_3=M$, these conditions define the boundary.\n\nAn equivalent approach, which directly involves the invariants as requested, is to consider the condition $|\\cos\\theta_{ij}| \\le 1$ using the relation between $s_{ij}$, $E_i$, $E_j$, and $\\theta_{ij}$.\n$s_{ij} = 2 p_i \\cdot p_j = 2(E_i E_j - \\vec{p}_i \\cdot \\vec{p}_j) = 2 E_i E_j (1 - \\cos\\theta_{ij})$.\nThe physical constraint is $-1 \\le \\cos\\theta_{ij} \\le 1$.\nThe condition $\\cos\\theta_{ij} \\le 1$ implies $s_{ij} \\ge 0$, which we already know.\nThe condition $\\cos\\theta_{ij} \\ge -1$ implies $1 - \\frac{s_{ij}}{2E_i E_j} \\ge -1$, which simplifies to $s_{ij} \\le 4 E_i E_j$.\nThe kinematic boundary is therefore defined by the equality $s_{ij} = 4 E_i E_j$ for any pair $(i,j)$.\n\nLet's analyze the boundary condition $s_{12} = 4 E_1 E_2$. Substituting the expressions for $E_1$ and $E_2$ in terms of invariants:\n$$s_{12} = 4 \\left(\\frac{M^2 - s_{23}}{2M}\\right) \\left(\\frac{M^2 - s_{13}}{2M}\\right) = \\frac{(M^2 - s_{23})(M^2 - s_{13})}{M^2}$$\nNow, we convert to the normalized variables $x_{ij} = s_{ij}/M^2$:\n$$M^2 x_{12} = \\frac{(M^2 - M^2 x_{23})(M^2 - M^2 x_{13})}{M^2} = M^2 (1 - x_{23})(1 - x_{13})$$\n$$x_{12} = (1 - x_{23})(1 - x_{13})$$\nWe are given the relation $x_{12} + x_{13} + x_{23} = 1$, which means $x_{23} = 1 - x_{12} - x_{13}$. Substituting this into the boundary equation:\n$$x_{12} = (1 - (1 - x_{12} - x_{13}))(1 - x_{13})$$\n$$x_{12} = (x_{12} + x_{13})(1 - x_{13})$$\n$$x_{12} = x_{12} - x_{12}x_{13} + x_{13} - x_{13}^2$$\n$$0 = x_{13} - x_{13}^2 - x_{12}x_{13}$$\n$$0 = x_{13}(1 - x_{13} - x_{12})$$\nUsing $x_{23} = 1-x_{12}-x_{13}$ again, we get:\n$$x_{13} x_{23} = 0$$\nThis signifies that the boundary corresponding to $|\\cos\\theta_{12}|=1$ is composed of two lines in the $(x_{12}, x_{13})$ plane: $x_{13}=0$ and $x_{23}=0$ (which is $x_{12}+x_{13}=1$).\n\nBy cyclic permutation, the other two boundary conditions are:\n- $s_{13} = 4 E_1 E_3 \\implies x_{13} = (1 - x_{23})(1 - x_{12}) \\implies x_{12} x_{23} = 0$. This gives the boundaries $x_{12}=0$ and $x_{23}=0$.\n- $s_{23} = 4 E_2 E_3 \\implies x_{23} = (1 - x_{13})(1 - x_{12}) \\implies x_{12} x_{13} = 0$. This gives the boundaries $x_{12}=0$ and $x_{13}=0$.\n\nThe complete kinematic boundary of the allowed region is the union of all these conditions: $x_{12}=0$ or $x_{13}=0$ or $x_{23}=0$.\nA single algebraic expression $f(x_{12}, x_{13})$ whose vanishing defines this union of three lines is the product of the linear factors that define them:\n$f(x_{12}, x_{13}) = x_{12} \\cdot x_{13} \\cdot x_{23}$.\nSubstituting $x_{23} = 1 - x_{12} - x_{13}$, we obtain the final expression in terms of $x_{12}$ and $x_{13}$ only.\n$$f(x_{12}, x_{13}) = x_{12} x_{13} (1 - x_{12} - x_{13})$$\nThe vanishing of this expression, $f(x_{12}, x_{13}) = 0$, defines the triangular boundary of the Dalitz plot for the decay of a massive particle into three massless particles.",
            "answer": "$$\\boxed{x_{12} x_{13} (1 - x_{12} - x_{13})}$$"
        },
        {
            "introduction": "The ultimate goal of studying phase space is to create tools that generate complete events for use in simulations. This capstone practice  challenges you to synthesize your understanding into a functional, Lorentz-covariant event generator. You will implement the sequential decay algorithm and, critically, derive and apply the Lorentz transformations necessary to view the decay in any inertial frame, bridging the gap from theoretical kinematics to a practical, verifiable computational tool.",
            "id": "3528153",
            "problem": "You are asked to implement, verify, and test a Lorentz-covariant event generator for multi-body decays in computational high-energy physics. The fundamental base is the invariance of the Minkowski line element under Lorentz transformations, the mass-shell relation, and the definition of the Lorentz-invariant phase space measure. Work entirely in natural units where the speed of light equals one, with all energies and masses expressed in gigaelectronvolts ($\\mathrm{GeV}$), and all angles expressed in radians.\n\nStarting from the following base facts:\n- The Minkowski metric with signature $\\left(+,-,-,-\\right)$ is preserved by proper orthochronous Lorentz transformations.\n- A massive parent at rest has four-momentum $P^{\\mu} = \\left(M, 0, 0, 0\\right)$, where $M$ is the parent mass in $\\mathrm{GeV}$.\n- A final-state particle of mass $m_i$ satisfies $p_i^{\\mu} p_{i\\mu} = m_i^2$, with $p_i^0 = E_i = \\sqrt{m_i^2 + \\boldsymbol{p}_i^2}$.\n- The $n$-body Lorentz-invariant phase space measure is\n$$\nd\\Phi_n\\left(P; m_1,\\dots,m_n\\right) = (2\\pi)^4 \\,\\delta^{(4)}\\!\\left(P - \\sum_{i=1}^n p_i\\right)\\,\\prod_{i=1}^n \\frac{d^3 \\boldsymbol{p}_i}{(2\\pi)^3\\,2 E_i}.\n$$\n\nYour tasks are:\n1. Derive the Lorentz boost that maps any four-vector from the parent rest frame to a laboratory frame in which the parent has four-velocity $u^{\\mu}$ satisfying $u^{\\mu} u_{\\mu} = 1$. Express the boost in terms of the three-velocity $\\boldsymbol{\\beta}$ and Lorentz factor $\\gamma$, where $u^{\\mu} = \\left(\\gamma, \\gamma \\boldsymbol{\\beta}\\right)$ and $\\gamma = 1/\\sqrt{1-\\boldsymbol{\\beta}^2}$. The final mapping should take an arbitrary four-vector $p^{\\mu} = \\left(E, \\boldsymbol{p}\\right)$ in the parent rest frame to $p'^{\\mu}$ in the lab frame.\n2. From the same base, show that under a fixed boost, the spatial momentum Jacobian for each particle satisfies\n$$\n\\det\\!\\left(\\frac{\\partial \\boldsymbol{p}'}{\\partial \\boldsymbol{p}}\\right) = \\frac{E'}{E},\n$$\nand use this to conclude that each factor $d^3\\boldsymbol{p}_i / E_i$ in the phase space element is invariant under the boost, and hence $d\\Phi_n$ is invariant.\n3. Implement a deterministic event generator in the parent rest frame for an $n$-body decay into daughters with given masses $m_1,\\dots,m_n$. Use a recursive sequence of two-body decays with isotropic angles in radians and kinematically allowed intermediate masses. Your generator must conserve four-momentum exactly in the parent rest frame and produce valid on-shell four-vectors for all daughters. For a two-body decay with parent mass $m_0$ into masses $m_a$ and $m_b$, use the relativistic two-body kinematics to determine the common three-momentum magnitude $p^\\ast$ in the parent rest frame from the Källén function, ensuring $p^\\ast \\ge 0$.\n4. For a given parent four-velocity $u^{\\mu}$, apply your derived boost to the generated final-state four-vectors to obtain lab-frame four-vectors, and verify numerically that:\n   - Total four-momentum transforms as required, so that the sum of boosted daughter four-vectors equals $M u^{\\mu}$.\n   - For each daughter, the Jacobian identity $\\det(\\partial \\boldsymbol{p}'/\\partial \\boldsymbol{p}) = E'/E$ holds to within a fixed absolute tolerance.\n5. Your program should run the following test suite of parameter sets and report, for each test case, whether all checks passed as a single boolean per case:\n   - Test $1$ (two-body, moderate boost): $M = 5.0$ in $\\mathrm{GeV}$, daughter masses $\\left[1.0, 1.0\\right]$ in $\\mathrm{GeV}$, laboratory four-velocity $u^{\\mu} = \\left(1.25, 0.75, 0.0, 0.0\\right)$.\n   - Test $2$ (three-body, oblique boost): $M = 10.0$ in $\\mathrm{GeV}$, daughter masses $\\left[2.0, 1.0, 0.5\\right]$ in $\\mathrm{GeV}$, laboratory four-velocity $u^{\\mu} = \\left(1.6666666666666667, 0.4444444444444444, 0.8888888888888888, 0.8888888888888888\\right)$.\n   - Test $3$ (four-body, identity boost): $M = 6.0$ in $\\mathrm{GeV}$, daughter masses $\\left[0.5, 0.5, 0.5, 0.5\\right]$ in $\\mathrm{GeV}$, laboratory four-velocity $u^{\\mu} = \\left(1.0, 0.0, 0.0, 0.0\\right)$.\n   - Test $4$ (three-body, ultra-relativistic boost with a massless daughter): $M = 3.0$ in $\\mathrm{GeV}$, daughter masses $\\left[0.0, 0.5, 0.3\\right]$ in $\\mathrm{GeV}$, laboratory four-velocity $u^{\\mu} = \\left(7.088812050083354, 0.0, 0.0, 7.01792392958252\\right)$.\n\nNumerical and unit requirements:\n- Use natural units with energies and masses in $\\mathrm{GeV}$, angles in radians.\n- Use an absolute tolerance of $10^{-8}$ for all equality checks involving floating-point computations.\n- Use deterministic isotropic angles obtained from a fixed pseudorandom number generator seed per test case so that outputs are repeatable.\n\nFinal output format:\n- Your program should produce a single line of output containing the results for the four test cases as a comma-separated list of booleans enclosed in square brackets, for example, $\\left[\\text{True},\\text{False},\\text{True},\\text{True}\\right]$. The exact required format is: a single line with the Python literal list syntax, for example, \"[True,False,True,True]\".",
            "solution": "The problem presents a comprehensive task in computational high-energy physics: to derive, implement, and verify a Lorentz-covariant multi-body decay event generator. The problem statement is scientifically grounded, well-posed, and objective. It is based entirely on the principles of special relativity, using standard definitions and formalisms such as four-vectors, the Minkowski metric, Lorentz transformations, and the Lorentz-invariant phase space measure. The provided parameters for test cases are kinematically allowed and consistent. Therefore, the problem is valid, and a full solution is presented below.\n\n**1. Derivation of the Lorentz Boost Transformation**\n\nWe are tasked to find the transformation that maps a four-vector $p^{\\mu} = (E, \\boldsymbol{p})$ from a parent particle's rest frame to a laboratory frame where the parent has a four-velocity $u^{\\mu} = (\\gamma, \\gamma\\boldsymbol{\\beta})$. Let the rest frame be $S$ and the lab frame be $S'$. The parent particle is at rest in $S$ and moves with three-velocity $\\boldsymbol{\\beta}$ in $S'$. Therefore, the frame $S$ moves with velocity $-\\boldsymbol{\\beta}$ relative to $S'$. The boost from $S$ to $S'$ is thus a boost by velocity $+\\boldsymbol{\\beta}$.\n\nA general Lorentz boost is described by the matrix $\\Lambda(\\boldsymbol{\\beta})$. A four-vector $p^{\\mu}$ in $S$ is transformed to $p'^{\\mu}$ in $S'$ via $p'^{\\mu} = \\Lambda^{\\mu}_{\\ \\nu} p^{\\nu}$. The components of the boost matrix $\\Lambda(\\boldsymbol{\\beta})$ are:\n$$\n\\begin{align*}\n\\Lambda^{0}_{\\ 0} = \\gamma \\\\\n\\Lambda^{i}_{\\ 0} = \\Lambda^{0}_{\\ i} = \\gamma \\beta^i \\\\\n\\Lambda^{i}_{\\ j} = \\delta_{ij} + (\\gamma-1) \\frac{\\beta^i \\beta^j}{\\boldsymbol{\\beta}^2}\n\\end{align*}\n$$\nwhere $\\gamma = 1/\\sqrt{1-\\boldsymbol{\\beta}^2}$ is the Lorentz factor, $\\beta^i$ are the components of the three-velocity $\\boldsymbol{\\beta}$, and $\\delta_{ij}$ is the Kronecker delta. The parent four-velocity $u^{\\mu}$ is defined as $(\\gamma, \\gamma\\boldsymbol{\\beta})$, which directly provides the boost parameters $\\gamma = u^0$ and $\\boldsymbol{\\beta} = \\boldsymbol{u}/u^0$, where $\\boldsymbol{u}$ is the spatial part of $u^\\mu$.\n\nApplying this transformation to $p^{\\mu} = (E, p^1, p^2, p^3) = (E, \\boldsymbol{p})$, we obtain the components of the boosted four-vector $p'^{\\mu} = (E', \\boldsymbol{p}')$:\n\nThe time component $E' = p'^0$:\n$$\nE' = \\Lambda^{0}_{\\ \\nu} p^{\\nu} = \\Lambda^{0}_{\\ 0} p^0 + \\sum_{j=1}^3 \\Lambda^{0}_{\\ j} p^j = \\gamma E + \\sum_{j=1}^3 \\gamma \\beta^j p^j = \\gamma (E + \\boldsymbol{\\beta} \\cdot \\boldsymbol{p})\n$$\n\nThe spatial components $p'^i$:\n$$\np'^i = \\Lambda^{i}_{\\ \\nu} p^{\\nu} = \\Lambda^{i}_{\\ 0} p^0 + \\sum_{j=1}^3 \\Lambda^{i}_{\\ j} p^j = \\gamma \\beta^i E + \\sum_{j=1}^3 \\left(\\delta_{ij} + (\\gamma-1) \\frac{\\beta^i \\beta^j}{\\boldsymbol{\\beta}^2}\\right) p^j\n$$\nIn vector notation, this becomes:\n$$\n\\boldsymbol{p}' = \\gamma E \\boldsymbol{\\beta} + \\boldsymbol{p} + (\\gamma-1) \\frac{\\boldsymbol{\\beta} (\\boldsymbol{\\beta} \\cdot \\boldsymbol{p})}{\\boldsymbol{\\beta}^2} = \\boldsymbol{p} + \\gamma E \\boldsymbol{\\beta} + (\\gamma-1) \\frac{(\\boldsymbol{p} \\cdot \\boldsymbol{\\beta})}{\\boldsymbol{\\beta}^2} \\boldsymbol{\\beta}\n$$\nThese equations represent the complete transformation for an arbitrary four-vector from the parent rest frame to the laboratory frame.\n\n**2. Jacobian and Invariance of the Phase Space Element**\n\nWe are asked to show that the Jacobian determinant of the spatial momentum transformation is $\\det(\\partial \\boldsymbol{p}'/\\partial \\boldsymbol{p}) = E'/E$. The transformation is $\\boldsymbol{p}'(\\boldsymbol{p}) = \\boldsymbol{p} + \\gamma E(\\boldsymbol{p}) \\boldsymbol{\\beta} + (\\gamma-1) \\frac{(\\boldsymbol{p} \\cdot \\boldsymbol{\\beta})}{\\boldsymbol{\\beta}^2} \\boldsymbol{\\beta}$, where the energy $E$ is a function of $\\boldsymbol{p}$ through the on-shell relation $E = \\sqrt{m^2 + \\boldsymbol{p}^2}$. The partial derivative of $E$ with respect to a component of momentum $p_j$ is $\\partial E / \\partial p_j = p_j/E$.\n\nThe Jacobian matrix $J$ has elements $J_{ij} = \\partial p'_i / \\partial p_j$:\n$$\nJ_{ij} = \\frac{\\partial p'_i}{\\partial p_j} = \\delta_{ij} + \\gamma \\beta_i \\frac{\\partial E}{\\partial p_j} + \\frac{\\gamma-1}{\\boldsymbol{\\beta}^2} \\beta_i \\frac{\\partial}{\\partial p_j}(\\boldsymbol{p} \\cdot \\boldsymbol{\\beta})\n$$\n$$\nJ_{ij} = \\delta_{ij} + \\gamma \\beta_i \\frac{p_j}{E} + \\frac{\\gamma-1}{\\boldsymbol{\\beta}^2} \\beta_i \\beta_j\n$$\nThis can be written in tensor product notation as $J = I + \\boldsymbol{\\beta} \\otimes \\left( \\frac{\\gamma}{E}\\boldsymbol{p} + \\frac{\\gamma-1}{\\boldsymbol{\\beta}^2}\\boldsymbol{\\beta} \\right)^T$. Using the matrix determinant lemma, $\\det(I + \\boldsymbol{a}\\boldsymbol{b}^T) = 1 + \\boldsymbol{b}^T \\boldsymbol{a} = 1 + \\boldsymbol{a} \\cdot \\boldsymbol{b}$, we have:\n$$\n\\det(J) = 1 + \\boldsymbol{\\beta} \\cdot \\left( \\frac{\\gamma}{E}\\boldsymbol{p} + \\frac{\\gamma-1}{\\boldsymbol{\\beta}^2}\\boldsymbol{\\beta} \\right) = 1 + \\frac{\\gamma}{E}(\\boldsymbol{\\beta} \\cdot \\boldsymbol{p}) + \\frac{\\gamma-1}{\\boldsymbol{\\beta}^2}(\\boldsymbol{\\beta} \\cdot \\boldsymbol{\\beta})\n$$\n$$\n\\det(J) = 1 + \\frac{\\gamma}{E}(\\boldsymbol{\\beta} \\cdot \\boldsymbol{p}) + \\gamma - 1 = \\gamma + \\frac{\\gamma}{E}(\\boldsymbol{\\beta} \\cdot \\boldsymbol{p}) = \\frac{\\gamma E + \\gamma(\\boldsymbol{\\beta} \\cdot \\boldsymbol{p})}{E}\n$$\nThe numerator is precisely the expression for the boosted energy $E'$. Thus, we have proven the identity:\n$$\n\\det\\left(\\frac{\\partial \\boldsymbol{p}'}{\\partial \\boldsymbol{p}}\\right) = \\frac{E'}{E}\n$$\nThe volume element of the three-momentum space transforms as $d^3\\boldsymbol{p}' = |\\det(J)| d^3\\boldsymbol{p} = (E'/E) d^3\\boldsymbol{p}$, since energies are positive. Rearranging this relation, we find:\n$$\n\\frac{d^3\\boldsymbol{p}'}{E'} = \\frac{d^3\\boldsymbol{p}}{E}\n$$\nThis demonstrates that the measure $d^3\\boldsymbol{p}/E$ for each particle is Lorentz-invariant. Since the full phase space measure $d\\Phi_n$ is a product of these terms and the Lorentz-invariant delta function $\\delta^{(4)}(P - \\sum p_i)$, $d\\Phi_n$ is itself Lorentz-invariant.\n\n**3. Deterministic Event Generator Algorithm**\n\nTo generate an $n$-body decay $M \\to m_1 + \\dots + m_n$ in the parent rest frame, we employ a recursive algorithm that models the process as a chain of sequential two-body decays:\n$M \\to V_{n-1} + m_n$, then $V_{n-1} \\to V_{n-2} + m_{n-1}$, and so on, until the final two-body decay $V_2 \\to m_1 + m_2$. Here, $V_k$ is a virtual intermediate particle representing the invariant mass of the system of the first $k$ final-state particles.\n\nThe core of the algorithm is a function for a two-body decay $m_0 \\to m_a + m_b$. In the rest frame of $m_0$, kinematics dictates that the two daughters are produced back-to-back with equal momentum magnitude $p^*$. This momentum is given by the Källén function $\\lambda(x, y, z) = x^2+y^2+z^2-2xy-2yz-2zx$:\n$$\np^* = \\frac{\\sqrt{\\lambda(m_0^2, m_a^2, m_b^2)}}{2m_0}\n$$\nThe decay is kinematically allowed if $m_0  m_a + m_b$, which ensures $p^*  0$. The direction of emission is isotropic, meaning it is uniformly distributed over the solid angle $4\\pi$. We generate this direction using a polar angle $\\theta$ and an azimuthal angle $\\phi$ sampled from deterministic pseudorandom numbers: $\\cos\\theta$ is uniform in $[-1, 1]$ and $\\phi$ is uniform in $[0, 2\\pi]$. The resulting three-momenta are $\\boldsymbol{p}_a = p^*\\hat{n}$ and $\\boldsymbol{p}_b = -p^*\\hat{n}$, where $\\hat{n}$ is the unit vector for the chosen direction. The energies are then $E_a = \\sqrt{m_a^2+(p^*)^2}$ and $E_b = \\sqrt{m_b^2+(p^*)^2}$.\n\nFor the recursive step from $n$ to $n-1$ particles, we consider the decay $M \\to V_{n-1} + m_n$. The mass $m_{V_{n-1}}$ of the virtual particle is not fixed. It must lie in the kinematically allowed range $[\\sum_{i=1}^{n-1} m_i, M - m_n]$. To ensure a deterministic yet representative sampling of the available phase space, the squared mass $m_{V_{n-1}}^2$ is chosen based on a pseudorandom number $r \\in [0, 1]$ by linearly interpolating within its allowed range:\n$$\nm_{V_{n-1}}^2 = \\left(\\sum_{i=1}^{n-1} m_i\\right)^2 + r \\cdot \\left((M - m_n)^2 - \\left(\\sum_{i=1}^{n-1} m_i\\right)^2\\right)\n$$\nAfter determining $m_{V_{n-1}}$, we perform the two-body decay of $M$ into $V_{n-1}$ and $m_n$ in the parent rest frame. This yields their four-momenta. The $n-1$ particles constituting $V_{n-1}$ are then generated by a recursive call to the same function, with $m_{V_{n-1}}$ as the new parent mass. These $n-1$ daughter particles are generated in the rest frame of $V_{n-1}$ and must be boosted into the original parent rest frame using the velocity of $V_{n-1}$, which is $\\boldsymbol{\\beta}_V = \\boldsymbol{p}_{V_{n-1}}/E_{V_{n-1}}$. The final output is the collection of all $n$ boosted four-vectors.\n\n**4. Verification Procedure**\n\nThe implemented generator is verified against several criteria for each test case:\n1.  **Rest-Frame Momentum Conservation**: The sum of the four-momenta of all generated final-state particles in the parent rest frame, $\\sum p_i^{\\mu}$, must equal the parent's four-momentum, $P^{\\mu} = (M, 0, 0, 0)$, within a numerical tolerance of $10^{-8}$.\n2.  **Lab-Frame Momentum Conservation**: The four-momenta $p_i^{\\mu}$ are boosted to the laboratory frame to obtain $p'^{\\mu}_i$. The sum of these boosted four-vectors, $\\sum p'^{\\mu}_i$, must equal the parent's lab-frame four-momentum, $P'^{\\mu} = M u^{\\mu}$, within the same tolerance.\n3.  **Jacobian Identity**: For each daughter particle $i$, we numerically compute the $3 \\times 3$ Jacobian matrix $J_i = \\partial \\boldsymbol{p}'_i/\\partial \\boldsymbol{p}_i$. Its determinant, $\\det(J_i)$, is then compared to the ratio of the lab-frame energy to the rest-frame energy, $E'_i/E_i$. This equality must hold for all daughters within the specified tolerance.\n\nA test case is considered to have passed (`True`) only if all three of these checks are satisfied. If any check fails for any particle, the entire test case is marked as `False`.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Set the absolute tolerance for all floating-point comparisons.\nTOLERANCE = 1e-8\n\ndef kallen(x_sq, y_sq, z_sq):\n    \"\"\"\n    Computes the Källén function lambda(x^2, y^2, z^2).\n    This form is more numerically stable than the one with square roots.\n    \"\"\"\n    return (x_sq - y_sq - z_sq)**2 - 4 * y_sq * z_sq\n\ndef boost(p4, beta_vec):\n    \"\"\"\n    Performs a Lorentz boost on a four-vector p4.\n    \n    Args:\n        p4 (np.ndarray): The four-vector (E, px, py, pz).\n        beta_vec (np.ndarray): The 3-velocity vector for the boost.\n\n    Returns:\n        np.ndarray: The boosted four-vector.\n    \"\"\"\n    beta_sq = np.dot(beta_vec, beta_vec)\n    if beta_sq  TOLERANCE**2:\n        return p4\n        \n    gamma = 1.0 / np.sqrt(1.0 - beta_sq)\n    E = p4[0]\n    p_vec = p4[1:]\n    \n    beta_dot_p = np.dot(beta_vec, p_vec)\n    \n    E_prime = gamma * (E + beta_dot_p)\n    p_prime_vec = p_vec + gamma * E * beta_vec + (gamma - 1.0) * beta_dot_p / beta_sq * beta_vec\n    \n    return np.array([E_prime, p_prime_vec[0], p_prime_vec[1], p_prime_vec[2]])\n\ndef generate_decay_products(parent_mass, daughter_masses, rng):\n    \"\"\"\n    Recursively generates four-vectors for an n-body decay in the parent rest frame.\n\n    Args:\n        parent_mass (float): Mass of the decaying parent particle.\n        daughter_masses (list[float]): List of masses of the final-state particles.\n        rng (np.random.Generator): A seeded random number generator.\n\n    Returns:\n        list[np.ndarray]: A list of the final-state particles' four-vectors.\n    \"\"\"\n    n = len(daughter_masses)\n    \n    if n == 1:\n        return [np.array([parent_mass, 0.0, 0.0, 0.0])]\n\n    # Recursive step: M - V + m_n, where V decays to the first n-1 particles.\n    head_masses = daughter_masses[:-1]\n    tail_mass = daughter_masses[-1]\n    \n    # Determine the kinematically allowed range for the virtual particle's mass.\n    m_head_min = sum(head_masses)\n    m_head_max = parent_mass - tail_mass\n    \n    # Generate the virtual mass by sampling its square uniformly.\n    r = rng.random()\n    m_head_sq = m_head_min**2 + r * (m_head_max**2 - m_head_min**2)\n    m_head = np.sqrt(m_head_sq)\n\n    # Perform the two-body decay of the parent into the virtual particle and the last daughter.\n    p_star_sq = kallen(parent_mass**2, m_head**2, tail_mass**2) / (4 * parent_mass**2)\n    p_star_mag = np.sqrt(p_star_sq)\n    \n    # Generate an isotropic direction for the decay products.\n    costh = 2.0 * rng.random() - 1.0\n    sinth = np.sqrt(1.0 - costh**2)\n    phi = 2.0 * np.pi * rng.random()\n    \n    p_star_vec = p_star_mag * np.array([sinth * np.cos(phi), sinth * np.sin(phi), costh])\n    \n    # Calculate four-vectors for the virtual particle and the tail daughter.\n    E_head = np.sqrt(m_head**2 + p_star_mag**2)\n    E_tail = np.sqrt(tail_mass**2 + p_star_mag**2)\n    \n    p4_head_in_parent_frame = np.array([E_head, *p_star_vec])\n    p4_tail_in_parent_frame = np.array([E_tail, *-p_star_vec])\n    \n    # Recursively generate decay products for the virtual particle in its own rest frame.\n    daughters_in_head_frame = generate_decay_products(m_head, head_masses, rng)\n    \n    # Boost these products from the virtual particle's rest frame to the parent's rest frame.\n    beta_vec_boost = p_star_vec / E_head\n    boosted_daughters = [boost(p4, beta_vec_boost) for p4 in daughters_in_head_frame]\n    \n    return boosted_daughters + [p4_tail_in_parent_frame]\n\ndef calculate_jacobian(p4_rest, beta_vec):\n    \"\"\"\n    Calculates the 3x3 Jacobian matrix of the momentum transformation.\n    \"\"\"\n    beta_sq = np.dot(beta_vec, beta_vec)\n    if beta_sq  TOLERANCE**2:\n        return np.identity(3)\n\n    gamma = 1.0 / np.sqrt(1.0 - beta_sq)\n    E_rest = p4_rest[0]\n    p_rest_vec = p4_rest[1:]\n\n    # J_ij = delta_ij + (gamma * p_j / E) * beta_i + ((gamma-1)/beta^2) * beta_i * beta_j\n    term2 = np.outer(beta_vec, (gamma / E_rest) * p_rest_vec)\n    term3 = ((gamma - 1.0) / beta_sq) * np.outer(beta_vec, beta_vec)\n    \n    return np.identity(3) + term2 + term3\n\ndef solve():\n    test_cases = [\n        # Test 1 (two-body, moderate boost)\n        {'M': 5.0, 'masses': [1.0, 1.0], 'u_lab': np.array([1.25, 0.75, 0.0, 0.0])},\n        # Test 2 (three-body, oblique boost)\n        {'M': 10.0, 'masses': [2.0, 1.0, 0.5], 'u_lab': np.array([1.6666666666666667, 0.4444444444444444, 0.8888888888888888, 0.8888888888888888])},\n        # Test 3 (four-body, identity boost)\n        {'M': 6.0, 'masses': [0.5, 0.5, 0.5, 0.5], 'u_lab': np.array([1.0, 0.0, 0.0, 0.0])},\n        # Test 4 (three-body, ultra-relativistic boost with a massless daughter)\n        {'M': 3.0, 'masses': [0.0, 0.5, 0.3], 'u_lab': np.array([7.088812050083354, 0.0, 0.0, 7.01792392958252])}\n    ]\n\n    results = []\n    for i, case in enumerate(test_cases):\n        M, masses, u_lab = case['M'], case['masses'], case['u_lab']\n        \n        # Use a deterministic seed for each test case for reproducibility.\n        rng = np.random.default_rng(seed=i)\n        \n        case_passed = True\n        \n        # Pre-check kinematics\n        if M = sum(masses):\n            results.append(False)\n            continue\n            \n        # 1. Generate decay products in the parent rest frame.\n        rest_frame_p4s = generate_decay_products(M, masses, rng)\n        \n        # 2. Verify momentum conservation in the rest frame.\n        total_p4_rest = np.sum(rest_frame_p4s, axis=0)\n        expected_p4_rest = np.array([M, 0.0, 0.0, 0.0])\n        if not np.allclose(total_p4_rest, expected_p4_rest, atol=TOLERANCE, rtol=0):\n            case_passed = False\n        \n        # 3. Boost all particles to the lab frame.\n        gamma = u_lab[0]\n        beta_vec = u_lab[1:] / gamma if gamma  1.0 else np.array([0.0, 0.0, 0.0])\n        \n        lab_frame_p4s = [boost(p4, beta_vec) for p4 in rest_frame_p4s]\n        \n        # 4. Verify momentum conservation in the lab frame.\n        total_p4_lab = np.sum(lab_frame_p4s, axis=0)\n        expected_p4_lab = M * u_lab\n        if not np.allclose(total_p4_lab, expected_p4_lab, atol=TOLERANCE, rtol=0):\n            case_passed = False\n            \n        # 5. Verify the Jacobian identity for each particle.\n        beta_sq = np.dot(beta_vec, beta_vec)\n        if beta_sq  TOLERANCE**2:\n            for p4_rest, p4_lab in zip(rest_frame_p4s, lab_frame_p4s):\n                E_rest, E_lab = p4_rest[0], p4_lab[0]\n                \n                # Avoid division by zero for particles at rest (should not happen for daughters)\n                if E_rest  TOLERANCE:\n                    # If rest energy is zero, lab energy must also be zero (for non-singular Jacobian)\n                    if abs(E_lab)  TOLERANCE:\n                        case_passed = False\n                    continue\n\n                jacobian = calculate_jacobian(p4_rest, beta_vec)\n                det_J = np.linalg.det(jacobian)\n                ratio_E = E_lab / E_rest\n                \n                if not np.isclose(det_J, ratio_E, atol=TOLERANCE, rtol=0):\n                    case_passed = False\n                    break # A single failure is enough\n        \n        results.append(case_passed)\n        \n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}