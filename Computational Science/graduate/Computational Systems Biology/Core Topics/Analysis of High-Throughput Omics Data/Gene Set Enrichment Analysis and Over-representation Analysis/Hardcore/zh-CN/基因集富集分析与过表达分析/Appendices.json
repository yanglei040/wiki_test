{
    "hands_on_practices": [
        {
            "introduction": "为了真正掌握基因集富集分析（GSEA），第一步是理解其核心计算引擎。本练习将引导你手动为一个简化的“玩具”数据集计算富集分数（Enrichment Score, ES）。通过逐步构建运行总和统计量，你将亲身体验“命中”（hit）和“错过”（miss）如何影响分数，并识别出对富集信号贡献最大的“领先边”（leading-edge）子集，从而将抽象的算法具体化。",
            "id": "3315251",
            "problem": "考虑基因集富集分析（GSEA），该方法评估一个预定义基因集的成员是否非随机地分布在一个已排序的全基因组列表的两端。GSEA中的富集分数（ES）是通过一个沿排序列表构建的类似柯尔莫哥洛夫-斯米尔诺夫的运行总和统计量来定义的：当遇到集合中的基因时，分数增加；当遇到不在集合中的基因时，分数减少，其中命中增量由基因水平统计量加权，而未命中减量则被选择以平衡整个过程。\n\n给定一个长度为 $N$ 的示例排序列表，由有序的基因-统计量对组成\n$$\\mathcal{L} = \\big[(g_1, r_1), (g_2, r_2), \\dots, (g_{10}, r_{10})\\big],$$\n该列表已按 $|r_i|$ 的降序排列。基因水平统计量的绝对值为\n$$|r_1| = 4.0,\\ |r_2| = 3.0,\\ |r_3| = 2.5,\\ |r_4| = 2.2,\\ |r_5| = 2.0,\\ |r_6| = 1.5,\\ |r_7| = 1.2,\\ |r_8| = 1.0,\\ |r_9| = 1.0,\\ |r_{10}| = 0.8.$$\n一个大小为 $K$ 的小基因集被指定为\n$$\\mathcal{S} = \\{g_2,\\ g_5,\\ g_9\\},\\quad K = 3,\\quad N = 10.$$\n\n假设加权GSEA运行总和统计量的指数参数为 $\\alpha = 1$，并遵循基于标准GSEA定义的以下归一化规则：当位置 $i$ 是一个命中（$g_i \\in \\mathcal{S}$）时，运行总和增加归一化的命中权重 $|r_i|^{\\alpha} / \\sum_{g_j \\in \\mathcal{S}} |r_j|^{\\alpha}$；当位置 $i$ 是一个未命中（$g_i \\notin \\mathcal{S}$）时，运行总和减少 $1/(N-K)$。运行总和从 $0$ 开始，并从 $i = 1$ 到 $i = N$ 顺序更新。\n\n任务：\n- 使用上述规则，计算富集分数（ES），即运行总和沿 $\\mathcal{L}$ 达到的与 $0$ 的最大偏差。\n- 识别前导子集，其定义为在达到ES的位置（包括该位置）之前遇到的 $\\mathcal{S}$ 中的基因所组成的子集。\n\n答案规格：\n- 将ES报告为单个精确的有理数，不进行四舍五入。\n- 无需单位。",
            "solution": "问题陈述已经过验证，被认为是合理、定义明确且科学上基于计算系统生物学原理的。它提供了一套完整且一致的数据和规则来执行所要求的计算。\n\n任务是为一个给定的基因集 $\\mathcal{S}$ 和一个排序的基因列表 $\\mathcal{L}$ 计算富集分数（ES）并识别前导子集。该分析基于加权的基因集富集分析（GSEA）运行总和统计量。\n\n首先，我们根据问题描述确定参数。排序列表中的基因总数为 $N=10$。感兴趣的基因集是 $\\mathcal{S} = \\{g_2, g_5, g_9\\}$，大小为 $K=3$。用于加权的指数参数为 $\\alpha=1$。\n\n运行总和的计算需要识别排序列表中的哪些基因是“命中”（$\\mathcal{S}$的成员），哪些是“未命中”（非$\\mathcal{S}$的成员）。\n基因集为 $\\mathcal{S} = \\{g_2, g_5, g_9\\}$。沿着排序列表 $\\mathcal{L}$（从 $i=1$ 到 $i=10$）的命中和未命中序列如下：\n- $i=1$：$g_1 \\notin \\mathcal{S}$（未命中）\n- $i=2$：$g_2 \\in \\mathcal{S}$（命中）\n- $i=3$：$g_3 \\notin \\mathcal{S}$（未命中）\n- $i=4$：$g_4 \\notin \\mathcal{S}$（未命中）\n- $i=5$：$g_5 \\in \\mathcal{S}$（命中）\n- $i=6$：$g_6 \\notin \\mathcal{S}$（未命中）\n- $i=7$：$g_7 \\notin \\mathcal{S}$（未命中）\n- $i=8$：$g_8 \\notin \\mathcal{S}$（未命中）\n- $i=9$：$g_9 \\in \\mathcal{S}$（命中）\n- $i=10$：$g_{10} \\notin \\mathcal{S}$（未命中）\n\n共有 $K=3$ 个命中和 $N-K=7$ 个未命中。\n\n接下来，我们计算运行总和的步长。\n对于命中，增量由 $\\frac{|r_i|^{\\alpha}}{\\sum_{g_j \\in \\mathcal{S}} |r_j|^{\\alpha}}$ 给出。当 $\\alpha=1$ 时，这变为 $\\frac{|r_i|}{\\sum_{g_j \\in \\mathcal{S}} |r_j|}$。\n我们来计算 $\\mathcal{S}$ 中基因的总权重，也就是命中增量的分母：\n$$ W_{\\mathcal{S}} = \\sum_{g_j \\in \\mathcal{S}} |r_j| = |r_2| + |r_5| + |r_9| $$\n使用给定的值 $|r_2|=3.0$、 $|r_5|=2.0$ 和 $|r_9|=1.0$：\n$$ W_{\\mathcal{S}} = 3.0 + 2.0 + 1.0 = 6.0 $$\n命中的增量为：\n- 对于 $i=2$ 处的 $g_2$：$\\frac{|r_2|}{W_{\\mathcal{S}}} = \\frac{3.0}{6.0} = \\frac{1}{2}$\n- 对于 $i=5$ 处的 $g_5$：$\\frac{|r_5|}{W_{\\mathcal{S}}} = \\frac{2.0}{6.0} = \\frac{1}{3}$\n- 对于 $i=9$ 处的 $g_9$：$\\frac{|r_9|}{W_{\\mathcal{S}}} = \\frac{1.0}{6.0} = \\frac{1}{6}$\n\n对于未命中，减量是一个常数值：\n$$ \\text{Decrement} = \\frac{1}{N-K} = \\frac{1}{10-3} = \\frac{1}{7} $$\n\n现在，我们计算运行总和，记为 $S_i$，从 $S_0=0$ 开始。\n- $i=1$（未命中）：$S_1 = S_0 - \\frac{1}{7} = -\\frac{1}{7}$\n- $i=2$（命中）：$S_2 = S_1 + \\frac{1}{2} = -\\frac{1}{7} + \\frac{1}{2} = -\\frac{2}{14} + \\frac{7}{14} = \\frac{5}{14}$\n- $i=3$（未命中）：$S_3 = S_2 - \\frac{1}{7} = \\frac{5}{14} - \\frac{2}{14} = \\frac{3}{14}$\n- $i=4$（未命中）：$S_4 = S_3 - \\frac{1}{7} = \\frac{3}{14} - \\frac{2}{14} = \\frac{1}{14}$\n- $i=5$（命中）：$S_5 = S_4 + \\frac{1}{3} = \\frac{1}{14} + \\frac{1}{3} = \\frac{3}{42} + \\frac{14}{42} = \\frac{17}{42}$\n- $i=6$（未命中）：$S_6 = S_5 - \\frac{1}{7} = \\frac{17}{42} - \\frac{6}{42} = \\frac{11}{42}$\n- $i=7$（未命中）：$S_7 = S_6 - \\frac{1}{7} = \\frac{11}{42} - \\frac{6}{42} = \\frac{5}{42}$\n- $i=8$（未命中）：$S_8 = S_7 - \\frac{1}{7} = \\frac{5}{42} - \\frac{6}{42} = -\\frac{1}{42}$\n- $i=9$（命中）：$S_9 = S_8 + \\frac{1}{6} = -\\frac{1}{42} + \\frac{7}{42} = \\frac{6}{42} = \\frac{1}{7}$\n- $i=10$（未命中）：$S_{10} = S_9 - \\frac{1}{7} = \\frac{1}{7} - \\frac{1}{7} = 0$\n最终值 $S_{10}=0$ 证实了总增量和总减量之间的平衡。\n\n富集分数（ES）定义为运行总和与 $0$ 的最大偏差。这对应于找到 $\\max_{i \\in \\{1,...,10\\}}|S_i|$。\n我们列出运行总和的绝对值：\n- $|S_1| = |-\\frac{1}{7}| = \\frac{1}{7} = \\frac{6}{42}$\n- $|S_2| = |\\frac{5}{14}| = \\frac{5}{14} = \\frac{15}{42}$\n- $|S_3| = |\\frac{3}{14}| = \\frac{3}{14} = \\frac{9}{42}$\n- $|S_4| = |\\frac{1}{14}| = \\frac{1}{14} = \\frac{3}{42}$\n- $|S_5| = |\\frac{17}{42}| = \\frac{17}{42}$\n- $|S_6| = |\\frac{11}{42}| = \\frac{11}{42}$\n- $|S_7| = |\\frac{5}{42}| = \\frac{5}{42}$\n- $|S_8| = |-\\frac{1}{42}| = \\frac{1}{42}$\n- $|S_9| = |\\frac{1}{7}| = \\frac{1}{7} = \\frac{6}{42}$\n- $|S_{10}| = |0| = 0$\n\n比较这些值，最大值为 $\\frac{17}{42}$。\n因此，富集分数为 $\\text{ES} = \\frac{17}{42}$。这个最大偏差出现在位置 $i=5$ 处。\n\n第二个任务是识别前导子集。该子集被定义为在达到ES的位置（包括该位置）之前，出现在排序列表 $\\mathcal{L}$ 中的 $\\mathcal{S}$ 成员。\nES在 $i=5$ 处达到。\n排序列表中直到位置 $5$ 的基因为 $\\{g_1, g_2, g_3, g_4, g_5\\}$。\n基因集为 $\\mathcal{S} = \\{g_2, g_5, g_9\\}$。\n这两个集合的交集即为前导子集：\n$$ \\text{Leading-edge subset} = \\{g_1, g_2, g_3, g_4, g_5\\} \\cap \\{g_2, g_5, g_9\\} = \\{g_2, g_5\\} $$\n\n富集分数为 $\\frac{17}{42}$，前导子集为 $\\{g_2, g_5\\}$。问题指定将ES作为最终答案报告。",
            "answer": "$$\\boxed{\\frac{17}{42}}$$"
        },
        {
            "introduction": "在真实的生物信息学分析中，我们通常会同时检验成百上千个基因集，这带来了多重假设检验的挑战。本练习将带你进入分析的下一步：统计显著性评估。你将学习并应用Benjamini-Hochberg（BH）方法来控制错误发现率（False Discovery Rate, FDR），这是从大量原始$p$值中筛选出可靠结果的一项关键技能。",
            "id": "3315266",
            "problem": "在一项差异表达研究的过表达分析 (ORA) 中，假设您使用超几何检验对 $m=12$ 个预定义基因集的富集情况进行了检验，得到了基因集 $\\mathrm{GS}1$ 到 $\\mathrm{GS}12$ 的以下原始 $p$ 值：\n- $\\mathrm{GS}1$: $0.004$\n- $\\mathrm{GS}2$: $0.020$\n- $\\mathrm{GS}3$: $0.020$\n- $\\mathrm{GS}4$: $0.0008$\n- $\\mathrm{GS}5$: $0.12$\n- $\\mathrm{GS}6$: $0.040$\n- $\\mathrm{GS}7$: $0.040$\n- $\\mathrm{GS}8$: $0.008$\n- $\\mathrm{GS}9$: $0.16$\n- $\\mathrm{GS}{10}$: $0.0024$\n- $\\mathrm{GS}{11}$: $0.040$\n- $\\mathrm{GS}{12}$: $0.064$\n\n您希望使用 Benjamini–Hochberg (BH) 程序将错误发现率 (FDR) 控制在 $\\alpha=0.05$ 的水平，并报告 Benjamini–Hochberg 校正的 $q$ 值（BH 校正的 $p$ 值）。计算所有 $12$ 个基因集的 BH 校正 $q$ 值，确定在 $\\alpha=0.05$ 水平下哪些基因集是显著的，并简要说明相等的原始 $p$ 值中的结 (ties) 以及超几何 $p$ 值的离散性如何影响 BH 校正和决策规则。\n\n报告在 $\\alpha=0.05$ 水平下显著基因集的数量作为您的最终答案。最终答案必须是单个整数。最终答案无需取整说明。",
            "solution": "此问题已经过验证。\n\n### 步骤 1：提取已知条件\n- 基因集（假设）数量，$m=12$。\n- 来自超几何检验的基因集 $\\mathrm{GS}1$ 到 $\\mathrm{GS}12$ 的原始 $p$ 值集合：\n  - $\\mathrm{GS}1$: $0.004$\n  - $\\mathrm{GS}2$: $0.020$\n  - $\\mathrm{GS}3$: $0.020$\n  - $\\mathrm{GS}4$: $0.0008$\n  - $\\mathrm{GS}5$: $0.12$\n  - $\\mathrm{GS}6$: $0.040$\n  - $\\mathrm{GS}7$: $0.040$\n  - $\\mathrm{GS}8$: $0.008$\n  - $\\mathrm{GS}9$: $0.16$\n  - $\\mathrm{GS}{10}$: $0.0024$\n  - $\\mathrm{GS}{11}$: $0.040$\n  - $\\mathrm{GS}{12}$: $0.064$\n- 期望的错误发现率 (FDR) 控制水平，$\\alpha=0.05$。\n- 指定的统计程序：Benjamini–Hochberg (BH)。\n- 要求输出：\n  1. 所有 $12$ 个基因集的 BH 校正 $q$ 值。\n  2. 在 $\\alpha=0.05$ 水平下显著基因集的识别。\n  3. 关于结 (ties) 和离散性如何影响 BH 程序的说明。\n  4. 显著基因集的总数。\n\n### 步骤 2：使用提取的已知条件进行验证\n评估问题的有效性。\n- **科学依据**：该问题描述了在一个常见的生物信息学背景（过表达分析）中，用于多重假设检验校正的一个标准且广泛使用的统计程序（Benjamini-Hochberg）。使用超几何检验进行 ORA 是标准做法。该问题在科学上是合理的。\n- **定义明确**：该问题提供了所有必要的数据（$m$、完整的 $p$ 值列表、$\\alpha$）和一个明确定义的目标。Benjamini-Hochberg 程序是一个确定性算法，会产生唯一的解。\n- **客观性**：该问题以精确、定量且无偏见的语言陈述。\n\n该问题是自洽的、一致的，并且不违反任何指定的无效标准。\n\n### 步骤 3：结论与行动\n该问题是 **有效的**。将提供解答。\n\nBenjamini–Hochberg (BH) 程序用于控制错误发现率 (FDR)，即在所有被拒绝的原假设中，错误阳性（假阳性）所占的预期比例。该程序包括计算校正后的 $p$ 值（通常称为 $q$ 值），并将其与期望的 FDR 水平 $\\alpha$ 进行比较。\n\n首先，我们必须将 $m=12$ 个原始 $p$ 值从最小到最大排序。设 $P_{(1)}, P_{(2)}, \\dots, P_{(m)}$ 为排序后的 $p$ 值，设 $i$ 为每个 $p$ 值的秩（排名），其中 $i=1, \\dots, m$。\n\n原始 $p$ 值排序如下：\n$$\n\\begin{array}{c|c|c}\n\\text{原始 ID}  \\text{原始 } p\\text{-值}  \\text{秩 } (i) \\\\\n\\hline\n\\mathrm{GS}4  0.0008  1 \\\\\n\\mathrm{GS}{10}  0.0024  2 \\\\\n\\mathrm{GS}1  0.004  3 \\\\\n\\mathrm{GS}8  0.008  4 \\\\\n\\mathrm{GS}2  0.020  5 \\\\\n\\mathrm{GS}3  0.020  6 \\\\\n\\mathrm{GS}6  0.040  7 \\\\\n\\mathrm{GS}7  0.040  8 \\\\\n\\mathrm{GS}{11}  0.040  9 \\\\\n\\mathrm{GS}{12}  0.064  10 \\\\\n\\mathrm{GS}5  0.12  11 \\\\\n\\mathrm{GS}9  0.16  12 \\\\\n\\end{array}\n$$\n\n第 $i$ 个排序后 $p$ 值 $P_{(i)}$ 的 BH 校正 $q$ 值定义为：\n$$q_{(i)} = \\min_{j=i}^{m} \\left( \\frac{m}{j} P_{(j)} \\right)$$\n这个定义确保了得到的 $q$ 值是单调不减的，即 $q_{(1)} \\le q_{(2)} \\le \\dots \\le q_{(m)}$。一个实用的计算方法是，首先为每个秩 $i$ 计算中间值 $q'_{(i)} = \\frac{m}{i} P_{(i)}$，然后通过从秩 $i=m-1$ 向下迭代到 $1$ 并设置 $q_{(i)} = \\min(q'_{(i)}, q_{(i+1)})$ 来强制执行单调性，其中 $q_{(m)} = q'_{(m)}$。\n\n我们现在计算所有 $12$ 个基因集的 $q$ 值。这里，$m=12$。\n$$\n\\begin{array}{c|c|c|c|c}\n\\text{秩 } (i)  \\text{ID}  \\text{原始 } p\\text{-值, } P_{(i)}  q'_{(i)} = \\frac{12}{i} P_{(i)}  \\text{BH 校正 } q\\text{-值, } q_{(i)} \\\\\n\\hline\n1  \\mathrm{GS}4  0.0008  \\frac{12}{1}(0.0008) = 0.0096  0.0096 \\\\\n2  \\mathrm{GS}{10}  0.0024  \\frac{12}{2}(0.0024) = 0.0144  0.0144 \\\\\n3  \\mathrm{GS}1  0.004  \\frac{12}{3}(0.004) = 0.016  0.016 \\\\\n4  \\mathrm{GS}8  0.008  \\frac{12}{4}(0.008) = 0.024  0.024 \\\\\n5  \\mathrm{GS}2  0.020  \\frac{12}{5}(0.020) = 0.048  0.040 \\\\\n6  \\mathrm{GS}3  0.020  \\frac{12}{6}(0.020) = 0.040  0.040 \\\\\n7  \\mathrm{GS}6  0.040  \\frac{12}{7}(0.040) \\approx 0.06857  \\approx 0.05333 \\\\\n8  \\mathrm{GS}7  0.040  \\frac{12}{8}(0.040) = 0.060  \\approx 0.05333 \\\\\n9  \\mathrm{GS}{11}  0.040  \\frac{12}{9}(0.040) \\approx 0.05333  \\approx 0.05333 \\\\\n10  \\mathrm{GS}{12}  0.064  \\frac{12}{10}(0.064) = 0.0768  0.0768 \\\\\n11  \\mathrm{GS}5  0.12  \\frac{12}{11}(0.12) \\approx 0.13091  \\approx 0.13091 \\\\\n12  \\mathrm{GS}9  0.16  \\frac{12}{12}(0.16) = 0.16  0.16 \\\\\n\\end{array}\n$$\n最后一列的最终 $q$ 值是通过确保单调性得出的。例如，$q_{(9)} = \\min(q'_{(9)}, q_{(10)}) = \\min(0.05333..., 0.0768) = 0.05333...$。然后 $q_{(8)} = \\min(q'_{(8)}, q_{(9)}) = \\min(0.060, 0.05333...) = 0.05333...$，以此类推。\n\n如果一个基因集的校正 $q$ 值小于或等于 FDR 控制水平 $\\alpha=0.05$，则认为该基因集是显著的。\n- $q_{\\mathrm{GS}4} = 0.0096 \\le 0.05$ (显著)\n- $q_{\\mathrm{GS}{10}} = 0.0144 \\le 0.05$ (显著)\n- $q_{\\mathrm{GS}1} = 0.016 \\le 0.05$ (显著)\n- $q_{\\mathrm{GS}8} = 0.024 \\le 0.05$ (显著)\n- $q_{\\mathrm{GS}2} = 0.040 \\le 0.05$ (显著)\n- $q_{\\mathrm{GS}3} = 0.040 \\le 0.05$ (显著)\n- $q_{\\mathrm{GS}6} \\approx 0.05333 > 0.05$ (不显著)\n- $q_{\\mathrm{GS}7} \\approx 0.05333 > 0.05$ (不显著)\n- $q_{\\mathrm{GS}{11}} \\approx 0.05333 > 0.05$ (不显著)\n- $q_{\\mathrm{GS}{12}} = 0.0768 > 0.05$ (不显著)\n- $q_{\\mathrm{GS}5} \\approx 0.13091 > 0.05$ (不显著)\n- $q_{\\mathrm{GS}9} = 0.16 > 0.05$ (不显著)\n\n因此，在 FDR 为 $\\alpha=0.05$ 的水平下，有 $6$ 个显著的基因集：$\\mathrm{GS}1$、$\\mathrm{GS}2$、$\\mathrm{GS}3$、$\\mathrm{GS}4$、$\\mathrm{GS}8$ 和 $\\mathrm{GS}{10}$。\n\n关于结 (ties) 和离散性：\n- **结 (Ties)**：原始 $p$ 值包含结（例如，$P_{\\mathrm{GS}2} = P_{\\mathrm{GS}3} = 0.020$）。BH 程序为它们分配连续的秩（秩 5 和 6）。单调性强制步骤 $q_{(i)} = \\min(q'_{(i)}, q_{(i+1)})$ 确保所有具有相同原始 $p$ 值的基因集获得相同的校正 $q$ 值。这是因为任何一组具有结的 $p$ 值的最终 $q$ 值是由在该组中计算出的校正值的最小值决定的。在此示例中，$q'_{(6)} = 0.040$ 小于 $q'_{(5)} = 0.048$，因此 $\\mathrm{GS}2$ 和 $\\mathrm{GS}3$ 都被分配了 $0.040$ 的校正 $q$ 值。这是处理结的标准且正确的方法。\n- **离散性 (Discreteness)**：这些 $p$ 值来自超几何检验，该检验基于离散分布。BH 程序的原始证明假设检验统计量是连续的。对于离散的 $p$ 值，属性 $P(p \\le u|H_0) \\le u$ 成立（而不是等式）。这使得标准的 BH 程序变得保守，意味着实际的 FDR 被控制在名义水平 $\\alpha$ 或以下。虽然这保证了 FDR 控制，但与专为离散检验设计的方法相比，可能会导致统计功效的损失。在此问题的背景下，应用标准的 BH 程序是有效的，尽管可能偏于保守。\n\n发现显著的基因集总数为 $6$。",
            "answer": "$$\\boxed{6}$$"
        },
        {
            "introduction": "掌握了计算方法后，更重要的是理解不同分析策略的适用场景和内在差异。本练习是一个思想实验，旨在深化你对GSEA和传统过表达分析（Over-Representation Analysis, ORA）的理解。通过分析几种精心设计的假设场景，你将能够从第一性原理出发，辨析为何GSEA能够捕捉到ORA因其固有的阈值依赖性而忽略的微妙但重要的生物学信号。",
            "id": "3315305",
            "problem": "您正在分析一项病例-对照RNA测序研究，其中每个基因都根据其差异表达被赋予一个连续的、有符号的排序统计量（例如，双样本$t$统计量或信噪比）。对于一个预定义的通路基因集$S$，我们考虑了两种富集方法：基因集富集分析（GSEA）和过表达分析（ORA）。ORA需要在排序统计量上选择一个固定的阈值，以确定一组差异表达基因，然后检验基因集$S$中超过阈值的基因数量是否比在给定背景中所有超过阈值的基因总数下随机预期的要多。相比之下，GSEA使用完整的排序列表来计算一个移动加和统计量，当在排序列表中遇到$S$的成员时，该统计量会增加（基因水平的统计量越强，贡献越大），否则减少，并通过表型标签置换来评估其显著性。\n\n根据这些方法的基本原理，当基因集$S$中一小部分基因在排序列表的顶端表现出非常强的效应，而$S$的大多数成员表现出微弱但协同的效应，不足以通过固定的阈值时，两种方法的结果可能会出现分歧。请考虑以下几种可能的情景。在每种情景中，$N$是基因总数，$K$是通过固定阈值被确定为差异表达的基因数量，$n=\\lvert S\\rvert$是基因集的大小，$h$是基因集$S$中超过阈值的基因数量。排序指的是在全基因组排序列表中的位置（排序$1$为最高）。\n\n以下哪种情景可能在GSEA中对基因集$S$产生统计显著性（在表型标签置换下），而在ORA中未能达到统计显著性（使用水平为$\\alpha=0.05$的单侧过表达检验）？\n\nA. $N=20000$，$K=400$，$n=200$，$h=6$。来自$S$的$h=6$个超过阈值的基因占据了排序$\\{1,2,3,5,9,27\\}$。$S$中其余的$n-h=194$个成员具有中等强度的正向统计量，使它们中约$75\\%$的排序在$10000$之前（即，在前一半），但没有高到足以超过阈值。\n\nB. $N=20000$，$K=600$，$n=150$，$h=20$。来自$S$的$h=20$个超过阈值的基因占据了排序$\\{1,2,3,4,5,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34\\}$。其余的$n-h=130$个成员几乎均匀地分布在整个排序列表中。\n\nC. $N=20000$，$K=2000$，$n=50$，$h=3$。来自$S$的$h=3$个超过阈值的基因占据了排序$\\{1,2,5\\}$。$S$中其余的$n-h=47$个基因具有微弱的正向统计量，但大多低于阈值，并集中在排序列表的前$60\\%$。\n\nD. $N=20000$，$K=1500$，$n=300$，$h=10$。$S$的$n$个成员均匀地散布在整个排序列表中；特别是，$h=10$个超过阈值的基因散布在排序$5000$到$18000$之间，而其余的$n-h=290$个$S$成员相对于背景没有表现出协同的偏移。\n\n选择所有适用的选项，并从基本原理出发证明你的选择，而不是援引预先记忆的决策规则。你的证明应解释为什么ORA的固定阈值计数模型在你选择的情景中得出非显著结果，而GSEA对排序分布的敏感性能够因$S$中一小部分显著偏移的排序而检测到显著的富集。",
            "solution": "该问题要求识别出基因集富集分析（GSEA）可能具有统计显著性而过表达分析（ORA）不具有统计显著性的情景。这需要对每种方法背后的统计学原理有精确的理解。\n\n**基本原理：ORA vs. GSEA**\n\n**过表达分析（ORA）：**\nORA对基因进行二元分类操作：它们要么是“差异表达”（DE），要么是“非差异表达”。这种分类基于基因的统计量是否超过一个预先定义的固定阈值。然后，该方法检验基因集$S$是否在DE基因列表中过表达。零假设$H_0$是，$S$的成员成为DE基因的可能性不比非$S$中的基因更高。统计检验基于超几何分布。给定总共有$N$个基因，其中$K$个是DE基因，以及一个大小为$n$的基因集$S$，在$S$中偶然观察到恰好$h$个DE基因的概率是：\n$$ P(X=h) = \\frac{\\binom{n}{h} \\binom{N-n}{K-h}}{\\binom{N}{K}} $$\n单侧过表达检验计算p值，即在$S$中观察到$h$个或更多DE基因的概率：\n$$ p = P(X \\ge h) = \\sum_{i=h}^{\\min(n,K)} \\frac{\\binom{n}{i} \\binom{N-n}{K-i}}{\\binom{N}{K}} $$\n如果$p \\le \\alpha$，则结果被认为是统计显著的，题目中指定$\\alpha = 0.05$。ORA的一个关键特征是，它丢弃了所有关于统计量大小超过阈值之外的信息，并完全忽略所有低于阈值的基因。$h$个基因的具体排序无关紧要，只有它们的数量才重要。\n\n**基因集富集分析（GSEA）：**\n相比之下，GSEA是无阈值的。它使用所有$N$个基因的完整排序列表。它评估基因集$S$的成员是随机分布在整个排序列表中，还是集中在顶部或底部。它计算一个移动加和的富集分数（ES）。从排序$1$到$N$遍历排序列表：\n- 如果排序为$j$的基因在$S$中，移动总和增加，通常增加的量与该基因的排序统计量成正比。\n- 如果排序为$j$的基因不在$S$中，移动总和减少。\nES是这个移动总和与零的最大偏差。GSEA可以检测到两种ORA可能错过的信号：\n1.  **领头亚集富集（Leading Edge Enrichment）：** 来自$S$的一个小基因子集（“领头亚集”）高度集中在排序列表的最顶端。即使这类基因的总数很小，它们的极端排序也会对产生大的ES做出重大贡献。\n2.  **协同偏移（Coordinated Shift）：** $S$中的大多数基因在一个方向上表现出微小但协同的偏移（例如，大多数基因轻微上调），即使很少或没有基因能通过ORA所需的严格阈值。\n\n一个产生显著GSEA结果但非显著ORA结果的情景，通常会包含一个GSEA敏感的信号（领头亚集和/或协同偏移），但该信号不足以为ORA产生统计显著的计数$h$。我们现在将评估每个情景。\n\n---\n\n**情景 A 分析**\n\n**给定：** $N=20000$, $K=400$, $n=200$, $h=6$。\n**ORA 分析：**\n在零假设下，基因集$S$中DE基因的期望数量为：\n$$ E[h] = K \\times \\frac{n}{N} = 400 \\times \\frac{200}{20000} = 4 $$\n观察到的计数是$h=6$，仅略高于期望计数$4$。为评估显著性，我们从超几何分布中计算p值$P(X \\ge 6)$，总体为$N=20000$，其中有$K=400$个成功事件（DE基因），抽取一个大小为$n=200$的样本（基因集），观察到$h=6$个成功事件。\np值是$X=6, 7, ..., 200$的概率总和：\n$$ p = P(X \\ge 6) = \\sum_{i=6}^{200} \\frac{\\binom{200}{i} \\binom{19800}{400-i}}{\\binom{20000}{400}} \\approx 0.155 $$\n由于$p \\approx 0.155 > 0.05$，ORA结果**不具有统计显著性**。\n\n**GSEA 分析：**\n题目陈述，来自$S$的$h=6$个DE基因占据了极高的排序：$\\{1, 2, 3, 5, 9, 27\\}$。这构成了一个强大的“领头亚集”。GSEA的移动总和将在排序列表的开始处急剧增加。此外，$S$中剩余的$194$个基因并非随机分布；它们表现出协同的、中等强度的正向偏移，其中“约$75\\%$的排序在$10000$之前（即，在前一半）”。这种集体的微弱信号，与强大的领头亚集相结合，正是GSEA旨在检测的模式类型。这很有可能导致一个大的、正的富集分数（ES），并通过表型置换检验发现其显著性。\n\n**结论：** 这个情景呈现了一个经典案例，即ORA因高于阈值的基因数量不足而失败，而GSEA通过整合来自领头亚集基因的极端排序和基因集其余部分的协同偏移信号而成功。此选项**正确**。\n\n---\n\n**情景 B 分析**\n\n**给定：** $N=20000$, $K=600$, $n=150$, $h=20$。\n**ORA 分析：**\n基因集$S$中DE基因的期望数量为：\n$$ E[h] = K \\times \\frac{n}{N} = 600 \\times \\frac{150}{20000} = 4.5 $$\n观察到的计数是$h=20$，是期望值的四倍多。这表明了强烈的过表达。超几何p值是$P(X \\ge 20)$，其中$N=20000$, $K=600$, $n=150$。\n$$ p = P(X \\ge 20) = \\sum_{i=20}^{150} \\frac{\\binom{150}{i} \\binom{19850}{600-i}}{\\binom{20000}{600}} \\approx 1.5 \\times 10^{-11} $$\n由于$p \\ll 0.05$，ORA结果**高度统计显著**。\n\n**GSEA 分析：**\n$h=20$个DE基因占据了顶部的排序$\\{1, 2, 3, 4, 5, 6, 8, ..., 34\\}$。这构成了一个异常强大的领头亚集，肯定会导致显著的GSEA结果。\n\n**结论：** 在此情景中，ORA和GSEA都会显著。它不满足ORA未能达到显著性的条件。此选项**不正确**。\n\n---\n\n**情景 C 分析**\n\n**给定：** $N=20000$, $K=2000$, $n=50$, $h=3$。\n**ORA 分析：**\n基因集$S$中DE基因的期望数量为：\n$$ E[h] = K \\times \\frac{n}{N} = 2000 \\times \\frac{50}{20000} = 5 $$\n观察到的计数是$h=3$，小于期望数量。这是代表性不足，而不是过表达。针对过表达的单侧检验检查$P(X \\ge h)$。这里我们计算$P(X \\ge 3)$。\n$$ p = P(X \\ge 3) = \\sum_{i=3}^{50} \\frac{\\binom{50}{i} \\binom{19950}{2000-i}}{\\binom{20000}{2000}} \\approx 0.903 $$\n由于$p \\approx 0.903 > 0.05$，ORA结果**不具有统计显著性**。\n\n**GSEA 分析：**\n尽管来自$S$的DE基因数量很少（$h=3$），但它们的排序位于列表的绝对顶端：$\\{1, 2, 5\\}$。这代表了一个非常小但极其有效的领头亚集。GSEA的移动总和会在开始时经历急剧增加。此外，$S$中剩余的$47$个基因表现出协同偏移，它们“集中在排序列表的前$60\\%$”。这种一个强大的（尽管微小）领头亚集和一个微弱的、协同的基因集其余部分偏移的组合，使得GSEA很可能检测到一个显著的富集信号，而ORA因只看到不显著的代表性不足（$h=3$ vs. $E[h]=5$）而失败。\n\n**结论：** 这个情景是GSEA对排序分布敏感性与ORA依赖简单计数的又一个很好的例子。ORA不显著，而GSEA很可能显著。此选项**正确**。\n\n---\n\n**情景 D 分析**\n\n**给定：** $N=20000$, $K=1500$, $n=300$, $h=10$。\n**ORA 分析：**\n基因集$S$中DE基因的期望数量为：\n$$ E[h] = K \\times \\frac{n}{N} = 1500 \\times \\frac{300}{20000} = 22.5 $$\n观察到的计数是$h=10$，不到期望值的一半。与情景C一样，这是代表性不足。对$P(X \\ge 10)$的单侧过表达检验将产生一个非常大的p值。\n$$ p = P(X \\ge 10) = \\sum_{i=10}^{300} \\frac{\\binom{300}{i} \\binom{19700}{1500-i}}{\\binom{20000}{1500}} \\approx 0.9996 $$\n由于$p \\approx 0.9996 > 0.05$，ORA结果**不具有统计显著性**。\n\n**GSEA 分析：**\n题目明确指出，“$S$的$n$个成员均匀地散布在整个排序列表中……而其余的$n-h=290$个$S$成员没有表现出协同的偏移”。基因集成员在排序列表中的均匀或随机分布是GSEA的零假设。这里没有领头亚集（少数DE基因散布广泛且不在顶部），也没有协同偏移。因此，GSEA的移动总和会随机地在零附近振荡，ES将不显著。\n\n**结论：** 在此情景中，ORA和GSEA都不会显著。它不满足指定的标准。此选项**不正确**。",
            "answer": "$$\\boxed{AC}$$"
        }
    ]
}