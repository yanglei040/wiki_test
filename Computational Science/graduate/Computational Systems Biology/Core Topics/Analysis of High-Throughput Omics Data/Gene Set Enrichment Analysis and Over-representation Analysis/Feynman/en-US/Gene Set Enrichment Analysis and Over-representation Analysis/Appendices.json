{
    "hands_on_practices": [
        {
            "introduction": "To truly understand Gene Set Enrichment Analysis (GSEA), it is essential to look under the hood and see how its core statistic is computed. This exercise demystifies the GSEA algorithm by guiding you through a manual, step-by-step calculation of the Enrichment Score ($ES$) on a small, manageable dataset. By working through this example , you will gain a concrete understanding of how the running-sum statistic captures the non-random distribution of a gene set within a ranked list and learn to identify the \"leading-edge\" subset of genes that drives the enrichment signal.",
            "id": "3315251",
            "problem": "Consider Gene Set Enrichment Analysis (GSEA), which assesses whether members of a predefined gene set are non-randomly distributed at the extremes of a ranked genome-wide list. The Enrichment Score (ES) in GSEA is defined via a Kolmogorov–Smirnov-like running-sum statistic constructed along the ranked list: the score increases when encountering a gene in the set and decreases when encountering a gene not in the set, with hit increments weighted by a gene-level statistic and miss decrements chosen to balance the walk.\n\nYou are given a toy ranked list of length $N$ consisting of ordered gene-statistic pairs\n$$\\mathcal{L} = \\big[(g_1, r_1), (g_2, r_2), \\dots, (g_{10}, r_{10})\\big],$$\nwith the list already sorted in descending order by $|r_i|$. The absolute gene-level statistics are\n$$|r_1| = 4.0,\\ |r_2| = 3.0,\\ |r_3| = 2.5,\\ |r_4| = 2.2,\\ |r_5| = 2.0,\\ |r_6| = 1.5,\\ |r_7| = 1.2,\\ |r_8| = 1.0,\\ |r_9| = 1.0,\\ |r_{10}| = 0.8.$$\nA small gene set of size $K$ is specified as\n$$\\mathcal{S} = \\{g_2,\\ g_5,\\ g_9\\},\\quad K = 3,\\quad N = 10.$$\n\nAssume the weighted GSEA running-sum statistic with exponent parameter $\\alpha = 1$ and the following normalization rules grounded in the standard GSEA definition: when a position $i$ is a hit ($g_i \\in \\mathcal{S}$), the running sum increases by the normalized hit weight $|r_i|^{\\alpha} / \\sum_{g_j \\in \\mathcal{S}} |r_j|^{\\alpha}$; when a position $i$ is a miss ($g_i \\notin \\mathcal{S}$), the running sum decreases by $1/(N-K)$. The running sum starts at $0$ and is updated sequentially from $i = 1$ to $i = N$.\n\nTask:\n- Compute the Enrichment Score (ES) as the maximum deviation from $0$ attained by the running sum along $\\mathcal{L}$ using the rules above.\n- Identify the leading-edge subset, defined as the subset of $\\mathcal{S}$ consisting of those genes encountered up to and including the position where the ES is achieved.\n\nAnswer specification:\n- Report the ES as a single exact rational number with no rounding.\n- No units are required.",
            "solution": "The problem statement has been validated and is deemed sound, well-posed, and scientifically grounded in the principles of computational systems biology. It provides a complete and consistent set of data and rules to perform the requested calculations.\n\nThe task is to compute the Enrichment Score (ES) and identify the leading-edge subset for a given gene set $\\mathcal{S}$ and a ranked list of genes $\\mathcal{L}$. The analysis is based on a weighted Gene Set Enrichment Analysis (GSEA) running-sum statistic.\n\nFirst, we establish the parameters from the problem description. The total number of genes in the ranked list is $N=10$. The gene set of interest is $\\mathcal{S} = \\{g_2, g_5, g_9\\}$, with size $K=3$. The exponent parameter for weighting is $\\alpha=1$.\n\nThe running-sum calculation requires identifying which genes in the ranked list are \"hits\" (members of $\\mathcal{S}$) and which are \"misses\" (not members of $\\mathcal{S}$).\nThe gene set is $\\mathcal{S} = \\{g_2, g_5, g_9\\}$. The sequence of hits and misses along the ranked list $\\mathcal{L}$ (from $i=1$ to $i=10$) is as follows:\n- $i=1$: $g_1 \\notin \\mathcal{S}$ (Miss)\n- $i=2$: $g_2 \\in \\mathcal{S}$ (Hit)\n- $i=3$: $g_3 \\notin \\mathcal{S}$ (Miss)\n- $i=4$: $g_4 \\notin \\mathcal{S}$ (Miss)\n- $i=5$: $g_5 \\in \\mathcal{S}$ (Hit)\n- $i=6$: $g_6 \\notin \\mathcal{S}$ (Miss)\n- $i=7$: $g_7 \\notin \\mathcal{S}$ (Miss)\n- $i=8$: $g_8 \\notin \\mathcal{S}$ (Miss)\n- $i=9$: $g_9 \\in \\mathcal{S}$ (Hit)\n- $i=10$: $g_{10} \\notin \\mathcal{S}$ (Miss)\n\nThere are $K=3$ hits and $N-K=7$ misses.\n\nNext, we calculate the step sizes for the running sum.\nFor a hit, the increment is given by $\\frac{|r_i|^{\\alpha}}{\\sum_{g_j \\in \\mathcal{S}} |r_j|^{\\alpha}}$. With $\\alpha=1$, this becomes $\\frac{|r_i|}{\\sum_{g_j \\in \\mathcal{S}} |r_j|}$.\nLet's compute the total weight of genes in $\\mathcal{S}$, which is the denominator of the hit increment:\n$$ W_{\\mathcal{S}} = \\sum_{g_j \\in \\mathcal{S}} |r_j| = |r_2| + |r_5| + |r_9| $$\nUsing the provided values $|r_2|=3.0$, $|r_5|=2.0$, and $|r_9|=1.0$:\n$$ W_{\\mathcal{S}} = 3.0 + 2.0 + 1.0 = 6.0 $$\nThe increments for the hits are:\n- For $g_2$ at $i=2$: $\\frac{|r_2|}{W_{\\mathcal{S}}} = \\frac{3.0}{6.0} = \\frac{1}{2}$\n- For $g_5$ at $i=5$: $\\frac{|r_5|}{W_{\\mathcal{S}}} = \\frac{2.0}{6.0} = \\frac{1}{3}$\n- For $g_9$ at $i=9$: $\\frac{|r_9|}{W_{\\mathcal{S}}} = \\frac{1.0}{6.0} = \\frac{1}{6}$\n\nFor a miss, the decrement is a constant value:\n$$ \\text{Decrement} = \\frac{1}{N-K} = \\frac{1}{10-3} = \\frac{1}{7} $$\n\nNow, we compute the running sum, denoted as $S_i$, starting from $S_0=0$.\n- $i=1$ (Miss): $S_1 = S_0 - \\frac{1}{7} = -\\frac{1}{7}$\n- $i=2$ (Hit): $S_2 = S_1 + \\frac{1}{2} = -\\frac{1}{7} + \\frac{1}{2} = -\\frac{2}{14} + \\frac{7}{14} = \\frac{5}{14}$\n- $i=3$ (Miss): $S_3 = S_2 - \\frac{1}{7} = \\frac{5}{14} - \\frac{2}{14} = \\frac{3}{14}$\n- $i=4$ (Miss): $S_4 = S_3 - \\frac{1}{7} = \\frac{3}{14} - \\frac{2}{14} = \\frac{1}{14}$\n- $i=5$ (Hit): $S_5 = S_4 + \\frac{1}{3} = \\frac{1}{14} + \\frac{1}{3} = \\frac{3}{42} + \\frac{14}{42} = \\frac{17}{42}$\n- $i=6$ (Miss): $S_6 = S_5 - \\frac{1}{7} = \\frac{17}{42} - \\frac{6}{42} = \\frac{11}{42}$\n- $i=7$ (Miss): $S_7 = S_6 - \\frac{1}{7} = \\frac{11}{42} - \\frac{6}{42} = \\frac{5}{42}$\n- $i=8$ (Miss): $S_8 = S_7 - \\frac{1}{7} = \\frac{5}{42} - \\frac{6}{42} = -\\frac{1}{42}$\n- $i=9$ (Hit): $S_9 = S_8 + \\frac{1}{6} = -\\frac{1}{42} + \\frac{7}{42} = \\frac{6}{42} = \\frac{1}{7}$\n- $i=10$ (Miss): $S_{10} = S_9 - \\frac{1}{7} = \\frac{1}{7} - \\frac{1}{7} = 0$\nThe final value $S_{10}=0$ confirms the balance between total increments and decrements.\n\nThe Enrichment Score (ES) is defined as the maximum deviation from $0$ attained by the running sum. This corresponds to finding $\\max_{i \\in \\{1,...,10\\}}|S_i|$.\nLet's list the absolute values of the running sum:\n- $|S_1| = |-\\frac{1}{7}| = \\frac{1}{7} = \\frac{6}{42}$\n- $|S_2| = |\\frac{5}{14}| = \\frac{5}{14} = \\frac{15}{42}$\n- $|S_3| = |\\frac{3}{14}| = \\frac{3}{14} = \\frac{9}{42}$\n- $|S_4| = |\\frac{1}{14}| = \\frac{1}{14} = \\frac{3}{42}$\n- $|S_5| = |\\frac{17}{42}| = \\frac{17}{42}$\n- $|S_6| = |\\frac{11}{42}| = \\frac{11}{42}$\n- $|S_7| = |\\frac{5}{42}| = \\frac{5}{42}$\n- $|S_8| = |-\\frac{1}{42}| = \\frac{1}{42}$\n- $|S_9| = |\\frac{1}{7}| = \\frac{1}{7} = \\frac{6}{42}$\n- $|S_{10}| = |0| = 0$\n\nComparing these values, the maximum is $\\frac{17}{42}$.\nThus, the Enrichment Score is $\\text{ES} = \\frac{17}{42}$. This maximum deviation occurs at position $i=5$.\n\nThe second task is to identify the leading-edge subset. This subset is defined as the members of $\\mathcal{S}$ that appear in the ranked list $\\mathcal{L}$ up to and including the position where the ES is achieved.\nThe ES is achieved at $i=5$.\nThe genes in the ranked list up to position $5$ are $\\{g_1, g_2, g_3, g_4, g_5\\}$.\nThe gene set is $\\mathcal{S} = \\{g_2, g_5, g_9\\}$.\nThe intersection of these two sets gives the leading-edge subset:\n$$ \\text{Leading-edge subset} = \\{g_1, g_2, g_3, g_4, g_5\\} \\cap \\{g_2, g_5, g_9\\} = \\{g_2, g_5\\} $$\n\nThe Enrichment Score is $\\frac{17}{42}$ and the leading-edge subset is $\\{g_2, g_5\\}$. The problem specifies to report the ES as the final answer.",
            "answer": "$$\\boxed{\\frac{17}{42}}$$"
        },
        {
            "introduction": "Gene Set Enrichment Analysis (GSEA) and Over-Representation Analysis (ORA) are two of the most common methods for pathway analysis, yet they operate on fundamentally different principles and answer distinct statistical questions. This can lead to scenarios where one method finds a pathway significant while the other does not. The following thought experiment  challenges you to reason from first principles about how GSEA's threshold-free, rank-based approach differs from ORA's threshold-dependent counting method, building your intuition for when each tool is most powerful.",
            "id": "3315305",
            "problem": "You are analyzing a case-control RNA-sequencing study in which each gene is assigned a continuous, signed ranking statistic based on differential expression (for example, a two-sample $t$-statistic or signal-to-noise ratio). Two enrichment procedures are considered for a predefined pathway gene set $S$: Gene Set Enrichment Analysis (GSEA) and Over-Representation Analysis (ORA). ORA requires selecting a fixed threshold on the ranking statistic to declare a set of genes as differentially expressed, and then tests whether $S$ contains more threshold-exceeding genes than expected by chance given the total number of threshold-exceeding genes in the background. GSEA instead uses the full ranked list to compute a running-sum statistic that increases when encountering members of $S$ in the ranked list (with larger contributions for stronger gene-level statistics) and decreases otherwise, and assesses significance via phenotype-label permutations.\n\nFrom first principles of these procedures, a divergence can occur when a small fraction of genes in $S$ show very strong effects concentrated at the top of the ranked list, while the majority of $S$ members show weak but coordinated effects insufficient to pass the fixed threshold. Consider the following candidate scenarios. In each scenario, $N$ is the total number of genes, $K$ is the number of genes declared differentially expressed by a fixed threshold, $n=\\lvert S\\rvert$ is the size of the gene set, and $h$ is the number of genes from $S$ that surpass the threshold. Ranks refer to positions in the genome-wide ranked list (rank $1$ is the top).\n\nWhich scenario(s) below can plausibly produce statistically significant GSEA for $S$ (under phenotype-label permutations) while failing to reach statistical significance by ORA (using a one-sided over-representation test at level $\\alpha=0.05$)?\n\nA. $N=20000$, $K=400$, $n=200$, $h=6$. The $h=6$ genes from $S$ that surpass the threshold occupy ranks $\\{1,2,3,5,9,27\\}$. The remaining $n-h=194$ members of $S$ have modest positive statistics that place approximately $75\\%$ of them above rank $10000$ (i.e., in the top half), but not high enough to cross the threshold.\n\nB. $N=20000$, $K=600$, $n=150$, $h=20$. The $h=20$ genes from $S$ that surpass the threshold occupy ranks $\\{1,2,3,4,5,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34\\}$. The remaining $n-h=130$ members are near-uniformly distributed across ranks.\n\nC. $N=20000$, $K=2000$, $n=50$, $h=3$. The $h=3$ genes from $S$ that surpass the threshold occupy ranks $\\{1,2,5\\}$. The remaining $n-h=47$ genes from $S$ have weak positive statistics but are largely below the threshold and concentrated in the top $60\\%$ of the ranked list.\n\nD. $N=20000$, $K=1500$, $n=300$, $h=10$. The $n$ members of $S$ are uniformly scattered across the ranked list; in particular, the $h=10$ above-threshold genes are scattered between ranks $5000$ and $18000$, and the remaining $n-h=290$ members of $S$ show no coordinated shift relative to background.\n\nSelect all that apply and justify your choice from first principles, not by invoking pre-memorized decision rules. Your justification should explain why the fixed-threshold counting model for ORA yields a non-significant result in your chosen scenario(s), while the rank-distribution sensitivity of GSEA can detect significant enrichment due to a small fraction of strongly shifted ranks in $S$.",
            "solution": "The problem asks to identify scenarios where Gene Set Enrichment Analysis (GSEA) would plausibly be statistically significant while Over-Representation Analysis (ORA) would not. This requires a precise understanding of the statistical principles underpinning each method.\n\n**First Principles: ORA vs. GSEA**\n\n**Over-Representation Analysis (ORA):**\nORA operates on a binary classification of genes: they are either 'differentially expressed' (DE) or 'not DE'. This classification is based on whether a gene's statistic surpasses a pre-defined, fixed threshold. The method then tests whether the gene set $S$ is over-represented in the list of DE genes. The null hypothesis, $H_0$, is that members of $S$ are no more likely to be DE than genes not in $S$. The statistical test is based on the hypergeometric distribution. Given $N$ total genes, $K$ of which are DE, and a gene set $S$ of size $n$, the probability of observing exactly $h$ DE genes in $S$ by chance is:\n$$ P(X=h) = \\frac{\\binom{n}{h} \\binom{N-n}{K-h}}{\\binom{N}{K}} $$\nA one-sided over-representation test calculates the p-value as the probability of observing $h$ or more DE genes in $S$:\n$$ p = P(X \\ge h) = \\sum_{i=h}^{\\min(n,K)} \\frac{\\binom{n}{i} \\binom{N-n}{K-i}}{\\binom{N}{K}} $$\nThe result is considered statistically significant if $p \\le \\alpha$, where the problem specifies $\\alpha = 0.05$. A key feature of ORA is that it discards all information about the magnitude of the statistic beyond the threshold and completely ignores all genes below the threshold. The exact ranks of the $h$ genes do not matter, only their count.\n\n**Gene Set Enrichment Analysis (GSEA):**\nGSEA, in contrast, is threshold-free. It uses the entire ranked list of all $N$ genes. It evaluates whether the members of the gene set $S$ are randomly distributed throughout the ranked list or are concentrated at the top or bottom. It calculates a running-sum Enrichment Score (ES). Walking down the ranked list from rank $1$ to $N$:\n- If the gene at rank $j$ is in $S$, the running sum increases, typically by an amount proportional to the gene's ranking statistic.\n- If the gene at rank $j$ is not in $S$, the running sum decreases.\nThe ES is the maximum deviation of this running sum from zero. GSEA can detect two types of signals that ORA might miss:\n1.  **Leading Edge Enrichment:** A small subset of genes from $S$ (the \"leading edge\") is highly concentrated at the very top of the ranked list. Even if the total number of such genes is small, their extreme ranks contribute heavily to a large ES.\n2.  **Coordinated Shift:** The majority of genes in $S$ show a modest but coordinated shift in one direction (e.g., most are slightly up-regulated), even if few or none pass the stringent threshold required for ORA.\n\nA scenario that produces significant GSEA but non-significant ORA will typically feature a signal that GSEA is sensitive to (leading edge and/or coordinated shift) but that is insufficient to produce a statistically significant count $h$ for ORA. We will now evaluate each scenario.\n\n---\n\n**Analysis of Scenario A**\n\n**Givens:** $N=20000$, $K=400$, $n=200$, $h=6$.\n**ORA Analysis:**\nUnder the null hypothesis, the expected number of DE genes in set $S$ is:\n$$ E[h] = K \\times \\frac{n}{N} = 400 \\times \\frac{200}{20000} = 4 $$\nThe observed count is $h=6$, which is only slightly greater than the expected count of $4$. To assess significance, we calculate the p-value $P(X \\ge 6)$ from the hypergeometric distribution for a population of $N=20000$, with $K=400$ successes (DE genes), drawing a sample of size $n=200$ (the gene set), and observing $h=6$ successes.\nThe p-value is the summation of probabilities for $X=6, 7, ..., 200$:\n$$ p = P(X \\ge 6) = \\sum_{i=6}^{200} \\frac{\\binom{200}{i} \\binom{19800}{400-i}}{\\binom{20000}{400}} \\approx 0.155 $$\nSince $p \\approx 0.155 > 0.05$, the ORA result is **not statistically significant**.\n\n**GSEA Analysis:**\nThe problem states that the $h=6$ DE genes from $S$ occupy extremely high ranks: $\\{1, 2, 3, 5, 9, 27\\}$. This constitutes a powerful \"leading edge\". The GSEA running sum would increase sharply at the beginning of the ranked list. Furthermore, the remaining $194$ genes in $S$ are not randomly distributed; they show a coordinated, modest positive shift, with \"$75\\%$ of them above rank $10000$ (i.e., in the top half)\". This collective weak signal, combined with the strong leading edge, is precisely the type of pattern GSEA is designed to detect. It is highly plausible that this would result in a large, positive Enrichment Score (ES) that is found to be significant via phenotype permutation testing.\n\n**Verdict:** This scenario presents a classic case where ORA fails due to an insufficient count of above-threshold genes, while GSEA succeeds by integrating the signal from the extreme ranks of the leading-edge genes and the coordinated shift of the rest of the set. This option is **Correct**.\n\n---\n\n**Analysis of Scenario B**\n\n**Givens:** $N=20000$, $K=600$, $n=150$, $h=20$.\n**ORA Analysis:**\nThe expected number of DE genes in set $S$ is:\n$$ E[h] = K \\times \\frac{n}{N} = 600 \\times \\frac{150}{20000} = 4.5 $$\nThe observed count is $h=20$, which is more than four times the expected value. This suggests a strong over-representation. The hypergeometric p-value is $P(X \\ge 20)$ for $N=20000$, $K=600$, $n=150$.\n$$ p = P(X \\ge 20) = \\sum_{i=20}^{150} \\frac{\\binom{150}{i} \\binom{19850}{600-i}}{\\binom{20000}{600}} \\approx 1.5 \\times 10^{-11} $$\nSince $p \\ll 0.05$, the ORA result is **highly statistically significant**.\n\n**GSEA Analysis:**\nThe $h=20$ DE genes occupy the top ranks $\\{1, 2, 3, 4, 5, 6, 8, ..., 34\\}$. This constitutes an exceptionally strong leading edge, which would certainly lead to a significant GSEA result.\n\n**Verdict:** In this scenario, both ORA and GSEA would be significant. It does not meet the condition that ORA fails to reach significance. This option is **Incorrect**.\n\n---\n\n**Analysis of Scenario C**\n\n**Givens:** $N=20000$, $K=2000$, $n=50$, $h=3$.\n**ORA Analysis:**\nThe expected number of DE genes in set $S$ is:\n$$ E[h] = K \\times \\frac{n}{N} = 2000 \\times \\frac{50}{20000} = 5 $$\nThe observed count is $h=3$, which is less than the expected number. This is an under-representation, not an over-representation. A one-sided test for over-representation checks $P(X \\ge h)$. Here we calculate $P(X \\ge 3)$.\n$$ p = P(X \\ge 3) = \\sum_{i=3}^{50} \\frac{\\binom{50}{i} \\binom{19950}{2000-i}}{\\binom{20000}{2000}} \\approx 0.903 $$\nSince $p \\approx 0.903 > 0.05$, the ORA result is **not statistically significant**.\n\n**GSEA Analysis:**\nAlthough the number of DE genes from $S$ is small ($h=3$), their ranks are at the absolute top of the list: $\\{1, 2, 5\\}$. This represents a very small but extremely potent leading edge. The GSEA running sum would experience a dramatic initial increase. Additionally, the remaining $47$ genes in $S$ show a coordinated shift, being \"concentrated in the top $60\\%$ of the ranked list\". This combination of a powerful, albeit tiny, leading edge and a subtle, coordinated shift of the rest of the set makes it very plausible that GSEA would detect a significant enrichment signal where ORA, seeing only an insignificant under-representation ($h=3$ vs. $E[h]=5$), fails.\n\n**Verdict:** This scenario is another good example of GSEA's sensitivity to rank distribution versus ORA's reliance on a simple count. ORA is not significant, while GSEA is plausibly significant. This option is **Correct**.\n\n---\n\n**Analysis of Scenario D**\n\n**Givens:** $N=20000$, $K=1500$, $n=300$, $h=10$.\n**ORA Analysis:**\nThe expected number of DE genes in set $S$ is:\n$$ E[h] = K \\times \\frac{n}{N} = 1500 \\times \\frac{300}{20000} = 22.5 $$\nThe observed count is $h=10$, which is less than half the expected value. As with scenario C, this is an under-representation. A one-sided over-representation test for $P(X \\ge 10)$ will yield a very large p-value.\n$$ p = P(X \\ge 10) = \\sum_{i=10}^{300} \\frac{\\binom{300}{i} \\binom{19700}{1500-i}}{\\binom{20000}{1500}} \\approx 0.9996 $$\nSince $p \\approx 0.9996 > 0.05$, the ORA result is **not statistically significant**.\n\n**GSEA Analysis:**\nThe problem explicitly states that \"The $n$ members of $S$ are uniformly scattered across the ranked list... and the remaining $n-h=290$ members of $S$ show no coordinated shift\". A uniform or random distribution of set members across the ranked list is the null hypothesis for GSEA. There is no leading edge (the few DE genes are scattered widely and not at the top) and no coordinated shift. Therefore, the GSEA running sum would oscillate randomly around zero, and the ES would be non-significant.\n\n**Verdict:** In this scenario, neither ORA nor GSEA would be significant. It does not meet the specified criteria. This option is **Incorrect**.",
            "answer": "$$\\boxed{AC}$$"
        },
        {
            "introduction": "When performing an Over-Representation Analysis (ORA) across thousands of gene sets, a critical challenge arises: multiple hypothesis testing. The more tests you perform, the higher the likelihood of obtaining significant results purely by chance. This practice problem  provides hands-on experience with the Benjamini-Hochberg procedure, a widely used method to control the False Discovery Rate ($FDR$) and ensure that your list of enriched pathways is statistically robust and reliable.",
            "id": "3315266",
            "problem": "In an over-representation analysis (ORA) of a differential expression study, suppose you tested enrichment for $m=12$ predefined gene sets using the hypergeometric test, yielding the following raw $p$-values for gene sets $\\mathrm{GS}1$ through $\\mathrm{GS}12$:\n- $\\mathrm{GS}1$: $0.004$\n- $\\mathrm{GS}2$: $0.020$\n- $\\mathrm{GS}3$: $0.020$\n- $\\mathrm{GS}4$: $0.0008$\n- $\\mathrm{GS}5$: $0.12$\n- $\\mathrm{GS}6$: $0.040$\n- $\\mathrm{GS}7$: $0.040$\n- $\\mathrm{GS}8$: $0.008$\n- $\\mathrm{GS}9$: $0.16$\n- $\\mathrm{GS}10$: $0.0024$\n- $\\mathrm{GS}11$: $0.040$\n- $\\mathrm{GS}12$: $0.064$\n\nYou wish to control the False Discovery Rate (FDR) at level $\\alpha=0.05$ using the Benjamini–Hochberg (BH) procedure, and to report Benjamini–Hochberg adjusted $q$-values (BH-adjusted $p$-values). Compute the BH-adjusted $q$-values for all $12$ gene sets, identify which gene sets are significant at level $\\alpha=0.05$, and briefly justify how ties among equal raw $p$-values and the discreteness of hypergeometric $p$-values affect the BH adjustment and decision rule.\n\nReport as your final answer the number of significant gene sets at level $\\alpha=0.05$. The final answer must be a single integer. No rounding instruction is necessary for the final answer.",
            "solution": "The problem is subjected to validation.\n\n### Step 1: Extract Givens\n- Number of gene sets (hypotheses), $m=12$.\n- The set of raw $p$-values from a hypergeometric test for gene sets $\\mathrm{GS}1$ through $\\mathrm{GS}12$:\n  - $\\mathrm{GS}1$: $0.004$\n  - $\\mathrm{GS}2$: $0.020$\n  - $\\mathrm{GS}3$: $0.020$\n  - $\\mathrm{GS}4$: $0.0008$\n  - $\\mathrm{GS}5$: $0.12$\n  - $\\mathrm{GS}6$: $0.040$\n  - $\\mathrm{GS}7$: $0.040$\n  - $\\mathrm{GS}8$: $0.008$\n  - $\\mathrm{GS}9$: $0.16$\n  - $\\mathrm{GS}10$: $0.0024$\n  - $\\mathrm{GS}11$: $0.040$\n  - $\\mathrm{GS}12$: $0.064$\n- The desired False Discovery Rate (FDR) control level, $\\alpha=0.05$.\n- The specified statistical procedure: Benjamini–Hochberg (BH).\n- Required outputs:\n  1. BH-adjusted $q$-values for all $12$ gene sets.\n  2. Identification of significant gene sets at level $\\alpha=0.05$.\n  3. Justification of how ties and discreteness affect the BH procedure.\n  4. The total number of significant gene sets.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed for validity.\n- **Scientifically Grounded**: The problem describes a standard and widely used statistical procedure (Benjamini-Hochberg) for multiple hypothesis testing correction in a common bioinformatics context (over-representation analysis). The use of hypergeometric tests for ORA is standard practice. The problem is scientifically sound.\n- **Well-Posed**: The problem provides all necessary data ($m$, a complete list of $p$-values, $\\alpha$) and a clearly defined objective. The Benjamini-Hochberg procedure is a deterministic algorithm that yields a unique solution.\n- **Objective**: The problem is stated in precise, quantitative, and unbiased language.\n\nThe problem is self-contained, consistent, and does not violate any of the specified invalidity criteria.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be provided.\n\nThe Benjamini–Hochberg (BH) procedure is used to control the False Discovery Rate (FDR), which is the expected proportion of false positives among all rejected null hypotheses. The procedure involves calculating adjusted $p$-values (often called $q$-values) and comparing them to the desired FDR level $\\alpha$.\n\nFirst, we must order the $m=12$ raw $p$-values from smallest to largest. Let $P_{(i)}$ be the ordered $p$-values and let $i$ be the rank of each $p$-value, where $i=1, \\dots, m$.\n\nThe raw $p$-values are sorted as follows:\n$$\n\\begin{array}{c|c|c}\n\\text{Original ID} & \\text{Raw } p\\text{-value} & \\text{Rank } (i) \\\\\n\\hline\n\\mathrm{GS}4 & 0.0008 & 1 \\\\\n\\mathrm{GS}10 & 0.0024 & 2 \\\\\n\\mathrm{GS}1 & 0.004 & 3 \\\\\n\\mathrm{GS}8 & 0.008 & 4 \\\\\n\\mathrm{GS}2 & 0.020 & 5 \\\\\n\\mathrm{GS}3 & 0.020 & 6 \\\\\n\\mathrm{GS}6 & 0.040 & 7 \\\\\n\\mathrm{GS}7 & 0.040 & 8 \\\\\n\\mathrm{GS}11 & 0.040 & 9 \\\\\n\\mathrm{GS}12 & 0.064 & 10 \\\\\n\\mathrm{GS}5 & 0.12 & 11 \\\\\n\\mathrm{GS}9 & 0.16 & 12 \\\\\n\\end{array}\n$$\n\nThe BH-adjusted $q$-value for the $i$-th ordered $p$-value, $P_{(i)}$, is defined as:\n$$q_{(i)} = \\min_{j=i}^{m} \\left( \\frac{m}{j} P_{(j)} \\right)$$\nThis definition ensures that the resulting $q$-values are monotonically non-decreasing, i.e., $q_{(1)} \\le q_{(2)} \\le \\dots \\le q_{(m)}$. A practical way to compute this is to first calculate the intermediate values $q'_{(i)} = \\frac{m}{i} P_{(i)}$ for each rank $i$, and then enforce monotonicity by iterating from rank $i=m-1$ down to $1$ and setting $q_{(i)} = \\min(q'_{(i)}, q_{(i+1)})$, with $q_{(m)} = q'_{(m)}$.\n\nWe will now compute the $q$-values for all $12$ gene sets. Here, $m=12$.\n$$\n\\begin{array}{c|c|c|c|c}\n\\text{Rank } (i) & \\text{ID} & \\text{Raw } p\\text{-value, } P_{(i)} & q'_{(i)} = \\frac{12}{i} P_{(i)} & \\text{BH-adjusted } q\\text{-value, } q_{(i)} \\\\\n\\hline\n1 & \\mathrm{GS}4 & 0.0008 & \\frac{12}{1}(0.0008) = 0.0096 & 0.0096 \\\\\n2 & \\mathrm{GS}10 & 0.0024 & \\frac{12}{2}(0.0024) = 0.0144 & 0.0144 \\\\\n3 & \\mathrm{GS}1 & 0.004 & \\frac{12}{3}(0.004) = 0.016 & 0.016 \\\\\n4 & \\mathrm{GS}8 & 0.008 & \\frac{12}{4}(0.008) = 0.024 & 0.024 \\\\\n5 & \\mathrm{GS}2 & 0.020 & \\frac{12}{5}(0.020) = 0.048 & 0.040 \\\\\n6 & \\mathrm{GS}3 & 0.020 & \\frac{12}{6}(0.020) = 0.040 & 0.040 \\\\\n7 & \\mathrm{GS}6 & 0.040 & \\frac{12}{7}(0.040) \\approx 0.06857 & \\approx 0.05333 \\\\\n8 & \\mathrm{GS}7 & 0.040 & \\frac{12}{8}(0.040) = 0.060 & \\approx 0.05333 \\\\\n9 & \\mathrm{GS}11 & 0.040 & \\frac{12}{9}(0.040) \\approx 0.05333 & \\approx 0.05333 \\\\\n10 & \\mathrm{GS}12 & 0.064 & \\frac{12}{10}(0.064) = 0.0768 & 0.0768 \\\\\n11 & \\mathrm{GS}5 & 0.12 & \\frac{12}{11}(0.12) \\approx 0.13091 & \\approx 0.13091 \\\\\n12 & \\mathrm{GS}9 & 0.16 & \\frac{12}{12}(0.16) = 0.16 & 0.16 \\\\\n\\end{array}\n$$\nThe final $q$-values in the last column are derived by ensuring monotonicity. For instance, $q_{(9)} = \\min(q'_{(9)}, q_{(10)}) = \\min(0.05333..., 0.0768) = 0.05333...$. Then $q_{(8)} = \\min(q'_{(8)}, q_{(9)}) = \\min(0.060, 0.05333...) = 0.05333...$, and so on.\n\nA gene set is considered significant if its adjusted $q$-value is less than or equal to the FDR control level $\\alpha=0.05$.\n- $q_{\\mathrm{GS}4} = 0.0096 \\le 0.05$ (Significant)\n- $q_{\\mathrm{GS}10} = 0.0144 \\le 0.05$ (Significant)\n- $q_{\\mathrm{GS}1} = 0.016 \\le 0.05$ (Significant)\n- $q_{\\mathrm{GS}8} = 0.024 \\le 0.05$ (Significant)\n- $q_{\\mathrm{GS}2} = 0.040 \\le 0.05$ (Significant)\n- $q_{\\mathrm{GS}3} = 0.040 \\le 0.05$ (Significant)\n- $q_{\\mathrm{GS}6} \\approx 0.05333 > 0.05$ (Not significant)\n- $q_{\\mathrm{GS}7} \\approx 0.05333 > 0.05$ (Not significant)\n- $q_{\\mathrm{GS}11} \\approx 0.05333 > 0.05$ (Not significant)\n- $q_{\\mathrm{GS}12} = 0.0768 > 0.05$ (Not significant)\n- $q_{\\mathrm{GS}5} \\approx 0.13091 > 0.05$ (Not significant)\n- $q_{\\mathrm{GS}9} = 0.16 > 0.05$ (Not significant)\n\nTherefore, there are $6$ significant gene sets at an FDR of $\\alpha=0.05$: $\\mathrm{GS}1$, $\\mathrm{GS}2$, $\\mathrm{GS}3$, $\\mathrm{GS}4$, $\\mathrm{GS}8$, and $\\mathrm{GS}10$.\n\nRegarding ties and discreteness:\n- **Ties**: The raw $p$-values contain ties (e.g., $P_{\\mathrm{GS}2} = P_{\\mathrm{GS}3} = 0.020$). The BH procedure assigns them consecutive ranks (ranks $5$ and $6$). The monotonicity enforcement step, $q_{(i)} = \\min(q'_{(i)}, q_{(i+1)})$, ensures that all gene sets with the same raw $p$-value receive the same adjusted $q$-value. This is because the final $q$-value for any group of tied $p$-values is determined by the minimum of the adjusted values computed across that group. In this example, $q'_{(6)} = 0.040$ is less than $q'_{(5)} = 0.048$, so both $\\mathrm{GS}2$ and $\\mathrm{GS}3$ are assigned the adjusted $q$-value of $0.040$. This is the standard and correct handling of ties.\n- **Discreteness**: The $p$-values are from a hypergeometric test, which is based on a discrete distribution. The original proof for the BH procedure assumes continuous test statistics. For discrete $p$-values, the property that $P(p \\le u|H_0) \\le u$ holds (instead of equality). This makes the standard BH procedure conservative, meaning the actual FDR is controlled at or below the nominal level $\\alpha$. While this guarantees FDR control, it may result in a loss of statistical power compared to methods specifically designed for discrete tests. In the context of this problem, applying the standard BH procedure is valid, though potentially conservative.\n\nThe total number of gene sets found to be significant is $6$.",
            "answer": "$$\\boxed{6}$$"
        }
    ]
}