{
    "hands_on_practices": [
        {
            "introduction": "通量平衡分析（FBA）本质上是一个线性规划问题。要深入理解FBA，不仅要会求解其原始问题，更要掌握其对偶问题的构建和解读。本练习将引导你为一个简化的代谢网络手动构建原始和对偶问题，并求解其最优解，让你亲身体验影子价格（即对偶变量）如何揭示代谢物对于系统目标的边际价值。",
            "id": "2496372",
            "problem": "考虑一个微生物的玩具稳态通量平衡分析（FBA）模型，该模型具有两种细胞内代谢物和两种反应。设化学计量矩阵为 $$S=\\begin{bmatrix}-1  1 \\\\ 0  -1\\end{bmatrix},$$ 其中行对应两种代谢物，列对应两种反应。通量向量为 $$v=\\begin{bmatrix}v_{1} \\\\ v_{2}\\end{bmatrix},$$ 稳态施加了质量平衡约束 $$S\\,v=\\begin{bmatrix}0 \\\\ 0\\end{bmatrix}.$$ 反应边界由逐分量的不等式给出 $$l \\le v \\le u,$$ 其中 $$l=\\begin{bmatrix}-10 \\\\ 0\\end{bmatrix}, \\quad u=\\begin{bmatrix}0 \\\\ 100\\end{bmatrix}.$$ 线性目标是最大化第二个反应，其目标系数向量为 $$c=\\begin{bmatrix}0 \\\\ 1\\end{bmatrix},$$ 因此，原始问题是在 $$S v=0, \\quad l \\le v \\le u$$ 约束下，最大化 $$c^{\\top} v$$。\n\n任务：\n- 从通量平衡分析和线性规划对偶的定义出发，通过为等式约束以及上下界引入拉格朗日乘子，来构建此问题的对偶问题。确定哪些乘子被约束为非负，哪些是自由的。\n- 计算满足卡罗需-库恩-塔克（KKT）条件（包括互补松弛性）的原始最优解和对偶最优解。\n- 解释与 $$S$$ 矩阵第一行所代表的中间代谢物的质量平衡等式相关的影子价格（对偶变量），说明向该质量平衡中引入一个小的外源或汇对最优目标值的边际效应。\n\n在你计算出的解处，将最优目标值 $$c^{\\top} v$$ 作为你的最终数值答案报告。如果你的答案是数值，请不要在最终方框内的答案中包含单位。所有通量均以 $$\\mathrm{mmol}\\ \\mathrm{gDW}^{-1}\\ \\mathrm{h}^{-1}$$ 为单位计量。",
            "solution": "所给问题是通量平衡分析（FBA）背景下的一个标准线性规划问题。首先，我们必须验证问题陈述。\n\n已知条件如下：\n- 化学计量矩阵：$S=\\begin{bmatrix}-1  1 \\\\ 0  -1\\end{bmatrix}$\n- 通量向量：$v=\\begin{bmatrix}v_{1} \\\\ v_{2}\\end{bmatrix}$\n- 稳态约束：$S v = \\mathbf{0}$\n- 下界：$l=\\begin{bmatrix}-10 \\\\ 0\\end{bmatrix}$\n- 上界：$u=\\begin{bmatrix}0 \\\\ 100\\end{bmatrix}$\n- 反应边界：$l \\le v \\le u$\n- 目标向量：$c=\\begin{bmatrix}0 \\\\ 1\\end{bmatrix}$\n- 原始问题 (P)：最大化 $c^{\\top} v$，约束条件为 $S v = \\mathbf{0}$ 和 $l \\le v \\le u$。\n\n该问题具有科学依据，是适定且客观的。它是基于约束的建模的一个典型例子。没有矛盾、缺失数据或含糊之处。因此，问题是有效的，我们开始求解。\n\n问题分为三个部分。我们将依次解决每个部分。\n\n**第一部分：构建对偶问题**\n\n原始线性规划问题是：\n$$ \\text{(P)} \\quad \\begin{aligned}  \\underset{v}{\\text{maximize}}   c^{\\top}v \\\\  \\text{subject to}   Sv = \\mathbf{0} \\\\    v \\le u \\\\    -v \\le -l \\end{aligned} $$\n我们为每组约束引入拉格朗日乘子（对偶变量）。令 $\\lambda$ 为等式约束 $Sv = \\mathbf{0}$ 的乘子向量。$\\lambda$ 的分量在符号上不受限制。令 $\\mu_u$ 为上界约束 $v - u \\le \\mathbf{0}$ 的乘子向量，令 $\\mu_l$ 为下界约束 $l - v \\le \\mathbf{0}$ 的乘子向量。乘子 $\\mu_u$ 和 $\\mu_l$ 必须为非负，即 $\\mu_u \\ge \\mathbf{0}$ 和 $\\mu_l \\ge \\mathbf{0}$。\n\n该问题的拉格朗日函数 $L$ 是：\n$$ L(v, \\lambda, \\mu_u, \\mu_l) = c^{\\top}v - \\lambda^{\\top}(Sv) - \\mu_u^{\\top}(v - u) - \\mu_l^{\\top}(l - v) $$\n重新整理各项：\n$$ L(v, \\lambda, \\mu_u, \\mu_l) = (c^{\\top} - \\lambda^{\\top}S - \\mu_u^{\\top} + \\mu_l^{\\top})v + \\mu_u^{\\top}u - \\mu_l^{\\top}l $$\n对偶问题是通过最小化拉格朗日函数关于原始变量 $v$ 的上确界得到的。为使上确界有界，$v$ 的系数必须为零：\n$$ c^{\\top} - \\lambda^{\\top}S - \\mu_u^{\\top} + \\mu_l^{\\top} = \\mathbf{0}^{\\top} $$\n进行转置，我们得到对偶可行性约束：\n$$ S^{\\top}\\lambda + \\mu_u - \\mu_l = c $$\n对偶目标函数则是拉格朗日函数的剩余部分，需要将其最小化。\n$$ \\begin{aligned}  \\underset{\\lambda, \\mu_u, \\mu_l}{\\text{minimize}}   u^{\\top}\\mu_u - l^{\\top}\\mu_l \\\\  \\text{subject to}   S^{\\top}\\lambda + \\mu_u - \\mu_l = c \\\\    \\mu_u \\ge \\mathbf{0}, \\mu_l \\ge \\mathbf{0} \\\\    \\lambda \\text{ is free} \\end{aligned} $$\n这就是对偶问题的构建。与等式约束相关的乘子 $\\lambda$ 是自由变量，而与不等式边界相关的乘子 $\\mu_u$ 和 $\\mu_l$ 是非负的。\n\n**第二部分：计算原始和对偶最优解**\n\n首先，我们求解原始问题。稳态约束 $Sv = \\mathbf{0}$ 为：\n$$ \\begin{bmatrix}-1  1 \\\\ 0  -1\\end{bmatrix} \\begin{bmatrix}v_{1} \\\\ v_{2}\\end{bmatrix} = \\begin{bmatrix}0 \\\\ 0\\end{bmatrix} $$\n这产生了一个由两个线性方程组成的方程组：\n$$ -v_1 + v_2 = 0 $$\n$$ -v_2 = 0 $$\n从第二个方程，我们立即得到 $v_2 = 0$。将其代入第一个方程得到 $-v_1 + 0 = 0$，这意味着 $v_1 = 0$。\n因此，唯一满足稳态约束的通量向量是 $v = \\begin{bmatrix}0 \\\\ 0\\end{bmatrix}$。我们必须验证该解对于反应边界 $l \\le v \\le u$ 是否可行。\n对于 $v_1$：$-10 \\le 0 \\le 0$，成立。\n对于 $v_2$：$0 \\le 0 \\le 100$，成立。\n解 $v^* = \\begin{bmatrix}0 \\\\ 0\\end{bmatrix}$ 是唯一的可行点。因此，它是原始问题的唯一最优解。最优目标值为 $c^{\\top}v^* = \\begin{bmatrix}0  1\\end{bmatrix} \\begin{bmatrix}0 \\\\ 0\\end{bmatrix} = 0$。\n\n接下来，我们应用卡罗需-库恩-塔克（KKT）条件来寻找一个对偶最优解。一个最优解必须满足原始可行性、对偶可行性以及互补松弛性。\n原始最优解是 $v^* = \\begin{bmatrix}0 \\\\ 0\\end{bmatrix}$。\n\n对偶可行性要求：\n$$ S^{\\top}\\lambda + \\mu_u - \\mu_l = c \\implies \\begin{bmatrix}-1  0 \\\\ 1  -1\\end{bmatrix} \\begin{bmatrix}\\lambda_1 \\\\ \\lambda_2\\end{bmatrix} + \\begin{bmatrix}\\mu_{u1} \\\\ \\mu_{u2}\\end{bmatrix} - \\begin{bmatrix}\\mu_{l1} \\\\ \\mu_{l2}\\end{bmatrix} = \\begin{bmatrix}0 \\\\ 1\\end{bmatrix} $$\n$$ -\\lambda_1 + \\mu_{u1} - \\mu_{l1} = 0 $$\n$$ \\lambda_1 - \\lambda_2 + \\mu_{u2} - \\mu_{l2} = 1 $$\n且 $\\mu_u \\ge \\mathbf{0}$ 和 $\\mu_l \\ge \\mathbf{0}$。\n\n互补松弛性条件是：\n$\\mu_{u_i}(u_i - v_i^*) = 0$ for $i \\in \\{1, 2\\}$\n$\\mu_{l_i}(v_i^* - l_i) = 0$ for $i \\in \\{1, 2\\}$\n\n让我们在最优点 $v^* = \\begin{bmatrix}0 \\\\ 0\\end{bmatrix}$ 处评估每个边界的松弛量：\n- 对于 $v_1^*=0$：\n  - 上界：$u_1 - v_1^* = 0 - 0 = 0$。该约束是激活的。因此，$\\mu_{u1}$ 可以是非零的（$\\mu_{u1} \\ge 0$）。\n  - 下界：$v_1^* - l_1 = 0 - (-10) = 10 \\ne 0$。该约束是非激活的。因此，$\\mu_{l1}$ 必须为 $0$。\n- 对于 $v_2^*=0$：\n  - 上界：$u_2 - v_2^* = 100 - 0 = 100 \\ne 0$。该约束是非激活的。因此，$\\mu_{u2}$ 必须为 $0$。\n  - 下界：$v_2^* - l_2 = 0 - 0 = 0$。该约束是激活的。因此，$\\mu_{l2}$ 可以是非零的（$\\mu_{l2} \\ge 0$）。\n\n将 $\\mu_{l1}=0$ 和 $\\mu_{u2}=0$ 代入对偶可行性方程：\n$$ -\\lambda_1 + \\mu_{u1} = 0 \\implies \\lambda_1 = \\mu_{u1} $$\n$$ \\lambda_1 - \\lambda_2 - \\mu_{l2} = 1 $$\n我们需要找到一个解 $(\\lambda_1, \\lambda_2, \\mu_{u1}, \\mu_{l2})$，它满足这些方程和对 $\\mu$ 的非负约束。由于 $\\mu_{u1} \\ge 0$，我们必须有 $\\lambda_1 \\ge 0$。\n存在一个对偶最优解族。我们可以通过设置一些自由变量来找到一个简单的解。让我们选择 $\\lambda_1 = 0$。这意味着 $\\mu_{u1}=0$。第二个方程变为 $0 - \\lambda_2 - \\mu_{l2} = 1$，或 $\\lambda_2 + \\mu_{l2} = -1$。\n由于 $\\mu_{l2} \\ge 0$，我们必须有 $\\lambda_2 \\le -1$。一个简单的选择是设置 $\\mu_{l2}=0$，这将得到 $\\lambda_2 = -1$。\n\n因此，一个有效的对偶最优解是：\n$\\lambda^* = \\begin{bmatrix}0 \\\\ -1\\end{bmatrix}$，$\\mu_u^* = \\begin{bmatrix}0 \\\\ 0\\end{bmatrix}$，$\\mu_l^* = \\begin{bmatrix}0 \\\\ 0\\end{bmatrix}$。\n该解满足所有KKT条件。\n\n原始最优解：$v^* = \\begin{bmatrix}0 \\\\ 0\\end{bmatrix}$。\n对偶最优解：$\\lambda^* = \\begin{bmatrix}0 \\\\ -1\\end{bmatrix}$，$\\mu_u^* = \\begin{bmatrix}0 \\\\ 0\\end{bmatrix}$，$\\mu_l^* = \\begin{bmatrix}0 \\\\ 0\\end{bmatrix}$。\n\n**第三部分：影子价格的解释**\n\n影子价格，或称对偶变量，关联于一个代谢物的质量平衡，它量化了当该代谢物的可利用性发生微小变化时，最优目标值的边际变化。第一个代谢物由 $S$ 矩阵的第一行表示。其影子价格是 $\\lambda_1^*$。根据我们在第二部分的计算，我们发现 $\\lambda_1^* = 0$。\n\n让我们分析为第一个代谢物引入一个小的外源或汇所产生的影响。这对应于将第一个质量平衡方程从 $-v_1 + v_2 = 0$ 修改为 $-v_1 + v_2 = b_1$，其中 $b_1$ 是一个小参数。一个正的 $b_1$ 代表净汇（消耗），而一个负的 $b_1$ 代表净源（产生）。\n受扰动的稳态方程组变为：\n$$ -v_1 + v_2 = b_1 $$\n$$ -v_2 = 0 $$\n第二个方程保持不变，所以我们仍然有 $v_2 = 0$。代入第一个方程，我们得到 $-v_1 + 0 = b_1$，或 $v_1 = -b_1$。\n新的解是 $v(b_1) = \\begin{bmatrix}-b_1 \\\\ 0\\end{bmatrix}$。该解必须保持可行，因此它必须满足边界条件：\n$-10 \\le -b_1 \\le 0$，这意味着 $0 \\le b_1 \\le 10$。\n$0 \\le 0 \\le 100$，这总是成立的。\n对于范围 $[0, 10]$ 内的任何小扰动 $b_1$，新的最优通量向量是 $v(b_1) = \\begin{bmatrix}-b_1 \\\\ 0\\end{bmatrix}$。\n新的最优目标值为 $c^{\\top}v(b_1) = v_2(b_1) = 0$。\n目标值的变化是 $\\Delta(c^{\\top}v^*) = 0 - 0 = 0$。\n对目标的边际效应是关于 $b_1$ 的导数：\n$$ \\frac{\\partial (c^{\\top}v^*)}{\\partial b_1} \\bigg|_{b_1=0} = \\frac{d(0)}{db_1} = 0 $$\n这证实了我们计算出的影子价格 $\\lambda_1^* = 0$。\n\n解释是，第一个代谢物不是目标函数的限制因素。因为目标反应通量 $v_2$ 被网络化学计量及其自身的下界严格地强制为零，所以第一个代谢物可利用性的任何变化只会改变通量 $v_1$（它不是目标的一部分），而对 $v_2$ 可实现的最大通量没有影响。因此，该代谢物相对于目标的边际价值为零。\n\n最后，问题要求最优目标值 $c^{\\top} v$。\n如计算所得，$v^*=\\begin{bmatrix}0 \\\\ 0\\end{bmatrix}$，所以 $c^{\\top}v^* = 0$。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "掌握了对偶理论后，我们可以将其应用于一个强大的实践中：敏感性分析。影子价格为我们提供了一个无需重新求解优化问题就能预测模型行为的快捷方式。在本练习中，你将通过编程实现一个灵敏度分析，利用对偶变量预测改变营养物吸收速率对生物质产量的影响，并通过与重新求解原始问题的结果进行比较来验证你的预测。",
            "id": "3309004",
            "problem": "考虑一个在稳态下表示为线性规划 (LP) 的通量平衡分析 (FBA) 问题。其基本基础是由化学计量矩阵 $S$ 和通量向量 $v$ 表示的稳态质量平衡条件，即 $S v = 0$，以及对每个反应通量施加的具有物理意义的上下界 $l \\le v \\le u$，和一个表示待最大化的生物量生产的线性目标函数。因此，该 LP 问题为：在约束 $S v = 0$ 和 $l \\le v \\le u$ 下，最大化 $c^{\\top} v$。与约束相关的影子价格（对偶变量）量化了最优值对右侧扰动的局部灵敏度。\n\n构建一个最小化的、科学上合理的类 FBA 模型，该模型包含四个通量变量 $v = [v_{\\mathrm{ex}}, v_{\\mathrm{tr}}, v_{\\mathrm{bio}}, v_{\\mathrm{by}}]^{\\top}$，分别代表与环境的交换通量（$v_{\\mathrm{ex}}$）、从环境输入到内部隔室的导入/转运通量（$v_{\\mathrm{tr}}$）、生物量生产通量（$v_{\\mathrm{bio}}$）和副产物分泌通量（$v_{\\mathrm{by}}$）。将外部和内部物质池的稳态约束强制设为等式：\n- 外部物质池守恒：$v_{\\mathrm{ex}} + v_{\\mathrm{tr}} = 0$。\n- 内部平衡：$v_{\\mathrm{tr}} - v_{\\mathrm{bio}} - v_{\\mathrm{by}} = 0$。\n\n设置边界以编码其生物物理意义：\n- 代表吸收能力的交换通量边界：$l_i \\le v_{\\mathrm{ex}} \\le 0$，其中 $l_i \\le 0$（负值表示允许的吸收量大小）。\n- 转运通量的非负性和可选的能力上限：$0 \\le v_{\\mathrm{tr}} \\le U_{\\mathrm{tr}}$。\n- 生物量通量的非负性和可选的能力上限：$0 \\le v_{\\mathrm{bio}} \\le U_{\\mathrm{bio}}$。\n- 副产物通量的非负性和一个较大的上界：$0 \\le v_{\\mathrm{by}} \\le U_{\\mathrm{by}}$。\n\n设目标为最大化生物量，即 $c = [0, 0, 1, 0]^{\\top}$，因此目标函数为 $c^{\\top} v = v_{\\mathrm{bio}}$。在这些约束下，只要边界是一致的，该 LP 问题就有一个良定义的最优解，并且与 $v_{\\mathrm{ex}}$ 的下界相对应的影子价格（对偶变量）决定了最优值对 $l_i$ 扰动的局部右侧灵敏度。\n\n您的任务是实现一个完整的程序，该程序对下面的测试套件中的每个测试用例执行以下步骤：\n1. 求解一次原始 LP 问题，以获得最优目标值 $z^{\\star}$ 和边界约束的对偶信息。\n2. 使用与 $v_{\\mathrm{ex}}$ 下界相关的对偶解，计算最优值关于参数 $l_i$ 的正确右侧导数。请精确遵循符号约定：LP 求解器执行最小化；您必须将最小化问题的对偶变量与原始最大化目标正确关联，以形成对扰动 $\\Delta l_i$ 情况下 $z^{\\star}$ 的预测变化。\n3. 使用您计算的灵敏度导数，预测在指定扰动 $\\Delta l_i$ 下最优目标值的变化。\n4. 使用扰动后的下界 $l_i + \\Delta l_i$ 重新求解原始 LP 问题，以获得新的最优值 $\\tilde{z}^{\\star}$，并计算实际变化 $\\tilde{z}^{\\star} - z^{\\star}$。\n5. 对于每个测试用例，返回预测变化与实际变化之间的绝对差值，结果为浮点数。\n\n使用以下固定的化学计量、边界（其中 $U_{\\mathrm{by}}$ 选择得足够大，例如 $U_{\\mathrm{by}} = 10^{6}$）和目标函数：\n- 等式约束矩阵 $A_{\\mathrm{eq}}$ 和右侧项 $b_{\\mathrm{eq}}$：\n  $$A_{\\mathrm{eq}} =\n  \\begin{bmatrix}\n  1  1  0  0 \\\\\n  0  1  -1  -1\n  \\end{bmatrix}, \\quad\n  b_{\\mathrm{eq}} =\n  \\begin{bmatrix}\n  0 \\\\\n  0\n  \\end{bmatrix}.$$\n- 最小化问题的目标向量为 $-c$：\n  $$c_{\\mathrm{min}} = \\begin{bmatrix} 0 \\\\ 0 \\\\ -1 \\\\ 0 \\end{bmatrix}.$$\n\n要使用的参数值测试套件 $(l_i, \\Delta l_i, U_{\\mathrm{tr}}, U_{\\mathrm{bio}})$：\n- 情况 1（理想路径，紧的下界）：$l_i = -10.0$, $\\Delta l_i = 0.5$, $U_{\\mathrm{tr}} = +\\infty$, $U_{\\mathrm{bio}} = +\\infty$。\n- 情况 2（带负扰动的理想路径）：$l_i = -10.0$, $\\Delta l_i = -1.2$, $U_{\\mathrm{tr}} = +\\infty$, $U_{\\mathrm{bio}} = +\\infty$。\n- 情况 3（零吸收边界）：$l_i = 0.0$, $\\Delta l_i = -2.0$, $U_{\\mathrm{tr}} = +\\infty$, $U_{\\mathrm{bio}} = +\\infty$。\n- 情况 4（因转运能力导致的非紧下界）：$l_i = -10.0$, $\\Delta l_i = 1.0$, $U_{\\mathrm{tr}} = 5.0$, $U_{\\mathrm{bio}} = +\\infty$。\n- 情况 5（因生物量上限导致的非紧下界）：$l_i = -10.0$, $\\Delta l_i = -3.0$, $U_{\\mathrm{tr}} = +\\infty$, $U_{\\mathrm{bio}} = 4.0$。\n\n科学真实性和自洽性通过以下方式得到保证：外部物质池等式 $v_{\\mathrm{ex}} + v_{\\mathrm{tr}} = 0$ 强制要求内部转运等于从环境中的净吸收；内部平衡强制要求摄入量在生长和副产物之间分配；而边界则编码了吸收能力（$l_i$）、转运能力（$U_{\\mathrm{tr}}$）和生长能力（$U_{\\mathrm{bio}}$）。只要 $l_i \\le 0$ 且 $U_{\\mathrm{tr}}$、$U_{\\mathrm{bio}}$ 为非负数，得到的 LP 问题就是可行的。\n\n最终输出格式要求：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，每个浮点数四舍五入到六位小数。例如：“[$x_1$,$x_2$,$x_3$,$x_4$,$x_5$]”，其中每个 $x_k$ 是情况 $k$ 的绝对差值。\n\n此处不涉及物理单位或角度单位；所有量均为无量纲的速率和边界。最终输出必须是浮点数。",
            "solution": "该问题要求实现一个通量平衡分析 (FBA) 模型，并使用基于线性规划 (LP) 对偶性的灵敏度分析。我们被要求将从影子价格推导出的最优生物量生产的预测变化，与通过使用扰动参数重新求解 LP 计算出的实际变化进行比较。\n\n该 FBA 模型由作用于反应通量向量 $v = [v_{\\mathrm{ex}}, v_{\\mathrm{tr}}, v_{\\mathrm{bio}}, v_{\\mathrm{by}}]^{\\top}$ 的一组线性等式和不等式约束定义。目标是最大化生物量通量 $v_{\\mathrm{bio}}$。\n\n该问题可以被表述为一个标准的 LP 问题。目标是最大化 $z = c^{\\top}v$，其中 $c = [0, 0, 1, 0]^{\\top}$。约束条件如下：\n1. 等式约束：$A_{\\mathrm{eq}}v = b_{\\mathrm{eq}}$，其中\n$$A_{\\mathrm{eq}} = \\begin{bmatrix} 1  1  0  0 \\\\ 0  1  -1  -1 \\end{bmatrix}, \\quad b_{\\mathrm{eq}} = \\begin{bmatrix} 0 \\\\ 0 \\end{bmatrix}$$\n这些方程分别对外部物质池和内部代谢物强制执行稳态质量平衡。\n\n2. 边界约束：$l \\le v \\le u$。对于一个给定的测试用例，其参数为 $(l_i, \\Delta l_i, U_{\\mathrm{tr}}, U_{\\mathrm{bio}})$，这些边界是：\n- $l_i \\le v_{\\mathrm{ex}} \\le 0$\n- $0 \\le v_{\\mathrm{tr}} \\le U_{\\mathrm{tr}}$\n- $0 \\le v_{\\mathrm{bio}} \\le U_{\\mathrm{bio}}$\n- $0 \\le v_{\\mathrm{by}} \\le U_{\\mathrm{by}}$，其中 $U_{\\mathrm{by}}$ 是一个大常数，设为 $10^6$。\n\n由于包括 `scipy.optimize.linprog` 在内的标准 LP 求解器通常被表述为最小化问题，我们将我们的最大化问题转换为一个等价的最小化问题。最大化 $z = c^{\\top}v$ 等价于最小化 $z_{\\mathrm{min}} = -z = -c^{\\top}v$。因此，最小化问题的目标向量是 $c_{\\mathrm{min}} = -c = [0, 0, -1, 0]^{\\top}$。\n\n任务的核心是灵敏度分析。在线性规划中，对偶变量（或影子价格）提供了关于最优目标值如何随约束右侧项 (RHS) 的微小扰动而变化的信息。设 $z_{\\mathrm{min}}^{\\star}(b_k)$ 是最小化问题的最优值，作为第 $k$ 个约束右侧项 $b_k$ 的函数。灵敏度定理指出，与第 $k$ 个约束相关的对偶变量 $\\lambda_k$ 等于最优目标值关于 $b_k$ 的偏导数：\n$$\\lambda_k = \\frac{\\partial z_{\\mathrm{min}}^{\\star}}{\\partial b_k}$$\n\n我们关心的是关于交换通量下界 $v_{\\mathrm{ex}} \\ge l_i$ 的灵敏度。这是提供给求解器的边界约束之一。让我们将此约束写成标准的“$\\le$”形式：$-v_{\\mathrm{ex}} \\le -l_i$。该约束的右侧项是 $-l_i$。然而，像 `scipy.optimize.linprog` 这样的现代求解器可以直接处理边界约束 $v_j \\ge l_j$。相关的对偶变量，我们可以称之为 $\\lambda_{l, j}$，代表了目标函数关于边界值本身的灵敏度：\n$$\\lambda_{l, j} = \\frac{\\partial z_{\\mathrm{min}}^{\\star}}{\\partial l_j}$$\n当使用 `highs` 方法时，`scipy.optimize.linprog` 函数在其结果对象的 `lower.marginals` 属性中返回这些对偶变量。\n\n问题要求的是原始最大化目标 $z^{\\star}$ 关于 $l_i$ 的灵敏度。由于 $z^{\\star} = -z_{\\mathrm{min}}^{\\star}$，我们可以使用链式法则：\n$$\\frac{\\partial z^{\\star}}{\\partial l_i} = \\frac{\\partial (-z_{\\mathrm{min}}^{\\star})}{\\partial l_i} = -\\frac{\\partial z_{\\mathrm{min}}^{\\star}}{\\partial l_i}$$\n对于交换通量 $v_{\\mathrm{ex}}$（即第一个变量，j=1），其灵敏度为：\n$$\\frac{\\partial z^{\\star}}{\\partial l_i} = -\\lambda_{l, 1}$$\n其中 $\\lambda_{l,1}$ 是最小化求解器返回的关于 $v_{\\mathrm{ex}}$ 下界的对偶变量。\n\n使用这个导数，我们可以通过一阶泰勒近似来预测对于微小扰动 $\\Delta l_i$ 的最优目标值变化 $\\Delta z_{\\text{pred}}$：\n$$\\Delta z_{\\text{pred}} = z^{\\star}(l_i + \\Delta l_i) - z^{\\star}(l_i) \\approx \\frac{\\partial z^{\\star}}{\\partial l_i} \\cdot \\Delta l_i = (-\\lambda_{l, 1}) \\cdot \\Delta l_i$$\n只要扰动 $\\Delta l_i$ 足够小，不会导致最优解处的有效约束集发生变化（即没有基变换发生），这个预测就是准确的。\n\n每个测试用例的整体算法如下：\n1. **初始解**：为给定的参数 $(l_i, U_{\\mathrm{tr}}, U_{\\mathrm{bio}})$ 构建并求解初始 LP 问题。使用 `scipy.optimize.linprog` 函数，输入为 $c_{\\mathrm{min}}$、$A_{\\mathrm{eq}}$、$b_{\\mathrm{eq}}$ 和指定的边界。从结果中，我们获得最小化问题的最优目标值 $z_{\\mathrm{min}}^{\\star}$，以及 $v_{\\mathrm{ex}}$ 下界的对偶变量 $\\lambda_{l,1} = \\text{result.lower.marginals}[0]$。最大化问题的最优值为 $z^{\\star} = -z_{\\mathrm{min}}^{\\star}$。\n\n2. **预测**：使用灵敏度公式计算预测变化 $\\Delta z_{\\text{pred}}$：$\\Delta z_{\\text{pred}} = (-\\lambda_{l, 1}) \\cdot \\Delta l_i$。\n\n3. **扰动解**：将 $v_{\\mathrm{ex}}$ 的下界修改为 $l_i' = l_i + \\Delta l_i$。用这个新边界重新求解 LP 问题，以找到新的最优目标值 $\\tilde{z}_{\\mathrm{min}}^{\\star}$。最大化问题的新最优值为 $\\tilde{z}^{\\star} = -\\tilde{z}_{\\mathrm{min}}^{\\star}$。\n\n4. **实际变化**：计算目标值的实际变化：$\\Delta z_{\\text{actual}} = \\tilde{z}^{\\star} - z^{\\star}$。\n\n5. **比较**：计算预测变化与实际变化之间的绝对差值：$|\\Delta z_{\\text{pred}} - \\Delta z_{\\text{actual}}|$。该值量化了线性灵敏度分析对于给定扰动的准确性。\n\n此过程将系统地应用于所提供的五个测试用例中的每一个。数值实现必须通过向求解器传递 `None` 或 `numpy.inf`（视情况而定）来处理无限边界。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef run_fba_sensitivity_case(params):\n    \"\"\"\n    Solves one FBA sensitivity analysis case.\n    \n    Args:\n        params (tuple): A tuple containing (l_i, delta_l_i, U_tr, U_bio).\n\n    Returns:\n        float: The absolute difference between predicted and actual change\n               in the optimal objective value.\n    \"\"\"\n    l_i, delta_l_i, U_tr, U_bio = params\n    \n    # Define the constant components of the LP problem\n    # Objective for minimization (scipy.optimize.linprog minimizes)\n    c_min = np.array([0, 0, -1, 0])\n    \n    # Equality constraints: A_eq * v = b_eq\n    A_eq = np.array([\n        [1, 1, 0, 0],  # External pool: v_ex + v_tr = 0\n        [0, 1, -1, -1]  # Internal balance: v_tr - v_bio - v_by = 0\n    ])\n    b_eq = np.array([0, 0])\n    \n    # Define a large upper bound for the byproduct flux\n    U_by = 1e6\n\n    # Scipy's linprog uses None for infinite bounds\n    U_tr_scipy = U_tr if np.isfinite(U_tr) else None\n    U_bio_scipy = U_bio if np.isfinite(U_bio) else None\n\n    # 1. Solve the primal LP to get the initial optimal value and duals\n    bounds_initial = [\n        (l_i, 0),             # l_i = v_ex = 0\n        (0, U_tr_scipy),      # 0 = v_tr = U_tr\n        (0, U_bio_scipy),     # 0 = v_bio = U_bio\n        (0, U_by)             # 0 = v_by = U_by\n    ]\n    \n    res_initial = linprog(\n        c=c_min, A_eq=A_eq, b_eq=b_eq, bounds=bounds_initial, method='highs'\n    )\n\n    if not res_initial.success:\n        return np.nan\n\n    # The objective is to maximize v_bio, so z_star = -z_min\n    z_star = -res_initial.fun\n    \n    # 2. Compute the derivative from the dual solution\n    # The dual for the lower bound v_ex >= l_i is given by `lower.marginals[0]`.\n    # This marginal is d(z_min)/d(l_i).\n    # The sensitivity for the maximization problem is d(z_max)/d(l_i) = -d(z_min)/d(l_i).\n    lambda_l_ex = res_initial.lower.marginals[0]\n    sensitivity = -lambda_l_ex\n\n    # 3. Predict the change in the optimal objective value\n    predicted_change = sensitivity * delta_l_i\n    \n    # 4. Re-solve the primal LP with the perturbed lower bound\n    l_i_perturbed = l_i + delta_l_i\n    bounds_perturbed = [\n        (l_i_perturbed, 0),\n        (0, U_tr_scipy),\n        (0, U_bio_scipy),\n        (0, U_by)\n    ]\n    \n    res_perturbed = linprog(\n        c=c_min, A_eq=A_eq, b_eq=b_eq, bounds=bounds_perturbed, method='highs'\n    )\n\n    if not res_perturbed.success:\n        return np.nan\n\n    # Get the new optimal value\n    z_star_perturbed = -res_perturbed.fun\n    \n    # 5. Compute the actual change\n    actual_change = z_star_perturbed - z_star\n    \n    # 6. Return the absolute difference between predicted and actual change\n    return abs(predicted_change - actual_change)\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    # Test suite: (l_i, delta_l_i, U_tr, U_bio)\n    test_cases = [\n        (-10.0, 0.5, np.inf, np.inf),    # Case 1\n        (-10.0, -1.2, np.inf, np.inf),   # Case 2\n        (0.0, -2.0, np.inf, np.inf),    # Case 3\n        (-10.0, 1.0, 5.0, np.inf),      # Case 4\n        (-10.0, -3.0, np.inf, 4.0),     # Case 5\n    ]\n\n    results = []\n    for case in test_cases:\n        diff = run_fba_sensitivity_case(case)\n        results.append(f\"{diff:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n\n```"
        }
    ]
}