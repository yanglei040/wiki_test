{
    "hands_on_practices": [
        {
            "introduction": "Before relying on computational solvers, it's crucial to grasp the mathematical foundations of Flux Variability Analysis (FVA). This practice challenges you to perform an FVA calculation analytically on a small, well-defined metabolic network. By manually deriving the optimal state and the feasible flux range for a specific reaction, you will gain a first-principles understanding of how alternative optima arise from network structure and reaction bounds. ",
            "id": "3309703",
            "problem": "You are given a toy metabolic network designed to expose alternative optimal solutions under flux balance analysis (FBA) and to permit an analytical flux variability analysis (FVA). The network contains internal metabolites $S$, $A$, $C$, and $B$, and a biomass sink $X$. Fluxes are measured in millimoles per gram dry weight per hour (mmol gDW$^{-1}$ h$^{-1}$). Assume steady state for all internal metabolites and that all reactions are irreversible.\n\nReactions (all fluxes $v_i \\geq 0$):\n- $v_1$: $\\varnothing \\rightarrow S$, with bound $0 \\leq v_1 \\leq 10$.\n- $v_2$: $S \\rightarrow A$, with bound $0 \\leq v_2$ (no finite upper bound).\n- $v_3$: $A \\rightarrow B$, with bound $0 \\leq v_3 \\leq 8$.\n- $v_4$: $S \\rightarrow C$, with bound $0 \\leq v_4$ (no finite upper bound).\n- $v_5$: $C \\rightarrow B$, with bound $0 \\leq v_5 \\leq 8$.\n- $v_6$: $B \\rightarrow X$ (biomass formation), with bound $0 \\leq v_6$ (no finite upper bound).\n- $v_7$: $A \\rightarrow \\varnothing$ (waste), with bound $0 \\leq v_7$ (no finite upper bound).\n- $v_8$: $C \\rightarrow \\varnothing$ (waste), with bound $0 \\leq v_8$ (no finite upper bound).\n\nAdopt the standard steady-state mass balance for internal metabolites, formalized as $S v = 0$, where $S$ is the stoichiometric matrix and $v$ is the vector of reaction fluxes, together with the given bounds. The FBA problem is to maximize the linear objective $c^{\\top} v$ with $c$ selecting biomass formation, i.e., $c^{\\top} v = v_6$.\n\nTask:\n1. Using only the fundamental definitions above (steady state, linear bounds, and linear objective), derive the optimal biomass value $z^{\\star}$ under FBA.\n2. Then, perform analytical flux variability analysis (FVA) for reaction $v_3$ at the optimal biomass level, i.e., minimize $v_3$ subject to the steady-state constraints, the reaction bounds, and the additional optimality constraint $v_6 = z^{\\star}$.\n3. Report the minimum feasible value of $v_3$ at optimal biomass. Provide the numerical value only (do not include units), and do not round; give the exact value.",
            "solution": "The problem is first subjected to a rigorous validation process.\n\n### Step 1: Extract Givens\n- **Internal Metabolites:** $S, A, C, B$\n- **External Metabolites:** $\\varnothing$ (source/sink), $X$ (biomass)\n- **Reactions and Fluxes ($v_i$):**\n  - $v_1$: $\\varnothing \\rightarrow S$\n  - $v_2$: $S \\rightarrow A$\n  - $v_3$: $A \\rightarrow B$\n  - $v_4$: $S \\rightarrow C$\n  - $v_5$: $C \\rightarrow B$\n  - $v_6$: $B \\rightarrow X$ (biomass formation)\n  - $v_7$: $A \\rightarrow \\varnothing$ (waste)\n  - $v_8$: $C \\rightarrow \\varnothing$ (waste)\n- **Flux Bounds:**\n  - All fluxes are irreversible: $v_i \\geq 0$ for all $i \\in \\{1, ..., 8\\}$.\n  - $0 \\leq v_1 \\leq 10$\n  - $0 \\leq v_3 \\leq 8$\n  - $0 \\leq v_5 \\leq 8$\n  - $v_2, v_4, v_6, v_7, v_8$ have no finite upper bounds, only $v_i \\geq 0$.\n- **Constraint:** Steady state for all internal metabolites, leading to the mass balance equation $S v = 0$.\n- **Objective Function:** Maximize the biomass formation flux, $v_6$.\n- **Task:**\n  1. Find the optimal biomass value, $z^{\\star} = \\max(v_6)$.\n  2. Perform flux variability analysis (FVA) for $v_3$ by finding the minimum feasible value of $v_3$ subject to the additional constraint $v_6 = z^{\\star}$.\n  3. Report the minimum value of $v_3$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded:** The problem is a standard application of flux balance analysis (FBA) and flux variability analysis (FVA), which are core, well-established methods in computational systems biology and metabolic engineering. The Toy network is a common pedagogical tool. The problem is scientifically sound.\n- **Well-Posed:** The problem is formulated as a linear program (LP), which is known to be well-posed. The constraints are linear, and the objective is a linear function of the variables. The feasible region is a convex polytope, and a solution is guaranteed to exist.\n- **Objective:** The problem is stated using precise mathematical and biological terminology. There are no subjective or ambiguous statements. All terms are standard in the field.\n- **Completeness and Consistency:** All necessary information (reactions, bounds, objective) is provided. There are no contradictions in the given data. The problem is self-contained.\n\n### Step 3: Verdict and Action\nThe problem is deemed valid. It is a well-posed, scientifically grounded, and objective problem within the specified domain. I will now proceed with a full, reasoned solution.\n\n### Solution\n\nThe first step is to establish the mathematical formulation of the problem. At steady state, the production rate of each internal metabolite must equal its consumption rate. This gives a system of linear equations, represented as $S v = 0$, where $S$ is the stoichiometric matrix and $v$ is the vector of fluxes.\n\nFor the given network, the mass balance equations for the internal metabolites $S$, $A$, $C$, and $B$ are:\n1. For metabolite $S$: $v_1 - v_2 - v_4 = 0 \\implies v_1 = v_2 + v_4$\n2. For metabolite $A$: $v_2 - v_3 - v_7 = 0 \\implies v_2 = v_3 + v_7$\n3. For metabolite $C$: $v_4 - v_5 - v_8 = 0 \\implies v_4 = v_5 + v_8$\n4. For metabolite $B$: $v_3 + v_5 - v_6 = 0 \\implies v_6 = v_3 + v_5$\n\nThe problem is subject to the irreversibility constraints $v_i \\geq 0$ for all $i$, and the specific bounds: $0 \\leq v_1 \\leq 10$, $0 \\leq v_3 \\leq 8$, and $0 \\leq v_5 \\leq 8$.\n\n**Part 1: Derivation of the Optimal Biomass Value ($z^{\\star}$)**\n\nThe objective of Flux Balance Analysis (FBA) is to maximize the biomass flux, $v_6$.\nFrom equation (4), the objective function is $v_6 = v_3 + v_5$. We need to maximize this sum.\n\nLet's express the objective function in terms of the system's input flux, $v_1$. We can substitute the expressions for $v_2$ and $v_4$ from equations (2) and (3) into equation (1):\n$v_1 = (v_3 + v_7) + (v_5 + v_8)$\n\nRearranging the terms:\n$v_1 = (v_3 + v_5) + (v_7 + v_8)$\n\nNow, substituting $v_6 = v_3 + v_5$:\n$v_1 = v_6 + v_7 + v_8$\n\nThis equation can be rearranged to express the objective $v_6$ in terms of other fluxes:\n$v_6 = v_1 - v_7 - v_8$\n\nTo maximize $v_6$, we must maximize $v_1$ and minimize $v_7$ and $v_8$, subject to their respective bounds.\n- The upper bound for $v_1$ is $10$. To maximize $v_6$, we set $v_1$ to its maximum value: $v_1 = 10$.\n- The lower bound for $v_7$ is $0$ (from $v_7 \\geq 0$). To maximize $v_6$, we set $v_7$ to its minimum value: $v_7 = 0$.\n- The lower bound for $v_8$ is $0$ (from $v_8 \\geq 0$). To maximize $v_6$, we set $v_8$ to its minimum value: $v_8 = 0$.\n\nThis gives a candidate for the maximum value of $v_6$:\n$v_{6, \\text{max}} = 10 - 0 - 0 = 10$\n\nWe must verify if a flux distribution exists that satisfies all constraints for $v_6 = 10$. In other words, is this state feasible?\nIf $v_6 = 10$, then from $v_6 = v_3 + v_5$, we have $v_3 + v_5 = 10$.\nThe problem constraints include $0 \\leq v_3 \\leq 8$ and $0 \\leq v_5 \\leq 8$.\nA solution requires finding $v_3$ and $v_5$ that satisfy all three conditions:\n1. $v_3 + v_5 = 10$\n2. $0 \\leq v_3 \\leq 8$\n3. $0 \\leq v_5 \\leq 8$\n\nFrom $v_3+v_5=10$, we can write $v_5 = 10 - v_3$. Substituting this into the bounds for $v_5$ gives:\n$0 \\leq 10 - v_3 \\leq 8$\nThis yields two inequalities for $v_3$:\n- $10 - v_3 \\geq 0 \\implies v_3 \\leq 10$\n- $10 - v_3 \\leq 8 \\implies 2 \\leq v_3$\nSo, from the constraint on $v_5$, we require $v_3 \\in [2, 10]$.\n\nCombining this with the direct constraint on $v_3$, which is $v_3 \\in [0, 8]$, we find the feasible range for $v_3$ by taking the intersection of the two intervals: $[2, 10] \\cap [0, 8] = [2, 8]$.\nSince this interval is non-empty, feasible solutions exist. For example, if we choose $v_3 = 5$, then $v_5 = 10 - 5 = 5$. This satisfies $0 \\leq 5 \\leq 8$. The complete flux vector would be $(v_1, v_2, v_3, v_4, v_5, v_6, v_7, v_8) = (10, 5, 5, 5, 5, 10, 0, 0)$, which is a valid flux distribution.\n\nTherefore, the maximum achievable biomass flux is $10$.\n$z^{\\star} = 10$\n\n**Part 2: Analytical Flux Variability Analysis (FVA) for $v_3$**\n\nThe task is to find the minimum feasible value of $v_3$ while maintaining the optimal biomass production, i.e., subject to the additional constraint $v_6 = z^{\\star} = 10$. This is formulated as a new linear programming problem:\n\nMinimize: $v_3$\nSubject to:\n1. The steady-state mass balance equations $S v = 0$.\n2. The reaction bounds: $0 \\leq v_1 \\leq 10$, $0 \\leq v_3 \\leq 8$, $0 \\leq v_5 \\leq 8$, and $v_2, v_4, v_6, v_7, v_8 \\geq 0$.\n3. The optimality constraint: $v_6 = 10$.\n\nAs established in the FBA step, the combination of $v_1 = v_6 + v_7 + v_8$, $v_1 \\leq 10$, $v_6=10$, $v_7 \\geq 0$, and $v_8 \\geq 0$ forces $v_7 = 0$ and $v_8 = 0$, which in turn forces $v_1 = 10$.\n\nThe problem is thus reduced to finding the minimum $v_3$ subject to the set of constraints that define the alternative optimal solutions. We already derived this set of constraints in Part 1 when checking for feasibility. The constraints on $v_3$ that ensure a feasible solution with $v_6=10$ are:\n- $v_3 + v_5 = 10$\n- $0 \\leq v_3 \\leq 8$\n- $0 \\leq v_5 \\leq 8$\n\nAs shown previously, combining these constraints leads to the feasible range for $v_3$:\n$2 \\leq v_3 \\leq 8$\n\nThe problem is to minimize $v_3$ over this feasible range. The minimum value in the interval $[2, 8]$ is $2$.\n\n**Part 3: Report the Minimum Value of $v_3$**\n\nThe minimum feasible value of flux $v_3$ at the optimal biomass level $z^{\\star}=10$ is $2$.\nFor this minimum value, $v_3 = 2$, the corresponding value for $v_5$ is $v_5 = 10 - 2 = 8$. This is a valid flux distribution, specifically $(v_1, v_2, v_3, v_4, v_5, v_6, v_7, v_8) = (10, 2, 2, 8, 8, 10, 0, 0)$. All flux bounds are satisfied.",
            "answer": "$$\n\\boxed{2}\n$$"
        },
        {
            "introduction": "While FBA and FVA typically focus on a single, maximal objective value, biological systems often exhibit flexibility and may operate in states that are slightly sub-optimal. This exercise guides you through the process of \"relaxed FVA,\" where we explore the solution space for objective values near the optimum, defined by a relaxation parameter $\\epsilon$. You will computationally quantify how the feasible flux ranges inflate as we move away from the strict optimum, providing insight into the robustness and metabolic plasticity of the network. ",
            "id": "3309665",
            "problem": "You are given a small constraint-based metabolic network and asked to quantify how relaxing the optimality constraint from $c^T v = z^\\star$ to $c^T v \\ge z^\\star - \\epsilon$ inflates Flux Variability Analysis (FVA) ranges and to report the inflation as a function of $\\epsilon$. The network is represented by a stoichiometric matrix $S \\in \\mathbb{R}^{m \\times n}$, a flux vector $v \\in \\mathbb{R}^n$, lower and upper bounds $l \\le v \\le u$, and a linear objective $c^T v$.\n\nFundamental base:\n- Steady-state mass balance: $S v = 0$.\n- Flux bounds: $l \\le v \\le u$.\n- Flux Balance Analysis (FBA): maximize $c^T v$ subject to $S v = 0$ and $l \\le v \\le u$. Let $z^\\star = \\max\\{c^T v \\mid S v = 0, l \\le v \\le u\\}$ denote the optimal objective value.\n- Flux Variability Analysis (FVA) under an optimality relaxation level $\\epsilon \\ge 0$: for each reaction index $i \\in \\{1,\\dots,n\\}$,\n  - compute $\\min v_i$ subject to $S v = 0$, $l \\le v \\le u$, and $c^T v \\ge z^\\star - \\epsilon$,\n  - compute $\\max v_i$ subject to $S v = 0$, $l \\le v \\le u$, and $c^T v \\ge z^\\star - \\epsilon$,\n  - define the FVA range width as $w_i(\\epsilon) = \\max v_i - \\min v_i$.\n\nNetwork specification:\n- Number of metabolites $m = 3$, number of reactions $n = 6$.\n- Metabolites: $\\{\\text{S}, \\text{A}, \\text{B}\\}$.\n- Reactions in order $[v_1, v_2, v_3, v_4, v_5, v_6]$:\n  - $v_1$: uptake, $\\emptyset \\to \\text{S}$,\n  - $v_2$: $\\text{S} \\to \\text{A}$,\n  - $v_3$: $\\text{A} \\to \\text{biomass}$,\n  - $v_4$: $\\text{S} \\to \\text{B}$,\n  - $v_5$: $\\text{B} \\to \\text{biomass}$,\n  - $v_6$: $\\text{S} \\to \\text{waste}$.\n- Stoichiometric matrix $S \\in \\mathbb{R}^{3 \\times 6}$ with rows corresponding to metabolites $\\text{S}, \\text{A}, \\text{B}$ and columns to reactions $v_1$ through $v_6$:\n$$\nS = \\begin{bmatrix}\n+1 & -1 & 0 & -1 & 0 & -1 \\\\\n0 & +1 & -1 & 0 & 0 & 0 \\\\\n0 & 0 & 0 & +1 & -1 & 0\n\\end{bmatrix}.\n$$\n- Objective coefficients $c \\in \\mathbb{R}^6$ maximize biomass production:\n$$\nc = \\begin{bmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 0 \\\\ 1 \\\\ 0 \\end{bmatrix}.\n$$\n- Bounds $l \\le v \\le u$:\n  - For $v_1$: $0 \\le v_1 \\le 10$,\n  - For $v_i$ with $i \\in \\{2,3,4,5,6\\}$: $0 \\le v_i < +\\infty$.\n\nTasks your program must perform:\n1. Compute the optimal FBA objective $z^\\star$.\n2. Compute baseline FVA widths $w_i(0)$ for all $i \\in \\{1,\\dots,6\\}$ using the constraint $c^T v \\ge z^\\star - 0$ (i.e., $c^T v \\ge z^\\star$).\n3. For each $\\epsilon$ in the test suite below, compute the FVA widths $w_i(\\epsilon)$ and the inflation metrics relative to baseline:\n   - Absolute inflation per reaction: $\\Delta_i(\\epsilon) = w_i(\\epsilon) - w_i(0)$.\n   - Mean absolute inflation across all reactions: $\\overline{\\Delta}(\\epsilon) = \\frac{1}{6} \\sum_{i=1}^{6} \\Delta_i(\\epsilon)$.\n   - Maximum absolute inflation across all reactions: $\\max_{i} \\Delta_i(\\epsilon)$.\n   - Mean relative inflation across reactions with positive baseline width: Let $J = \\{i \\mid w_i(0) > 10^{-9}\\}$. Define $\\rho(\\epsilon) = \\frac{1}{|J|} \\sum_{i \\in J} \\frac{w_i(\\epsilon)}{w_i(0)}$. If $J$ is empty, define $\\rho(\\epsilon) = 0$.\n\nTest suite:\n- Use the following $\\epsilon$ values: $\\epsilon \\in \\{0.0, 0.5, 2.0, 10.0, 12.0\\}$.\n\nFinal output format:\n- For each $\\epsilon$ in the order given above, compute the triple $\\left(\\overline{\\Delta}(\\epsilon), \\max_i \\Delta_i(\\epsilon), \\rho(\\epsilon)\\right)$.\n- Your program should produce a single line of output containing the results as a comma-separated list of floating-point numbers rounded to exactly six digits after the decimal point, in the order\n$$\n\\left[\\overline{\\Delta}(0.0), \\max \\Delta(0.0), \\rho(0.0), \\overline{\\Delta}(0.5), \\max \\Delta(0.5), \\rho(0.5), \\overline{\\Delta}(2.0), \\max \\Delta(2.0), \\rho(2.0), \\overline{\\Delta}(10.0), \\max \\Delta(10.0), \\rho(10.0), \\overline{\\Delta}(12.0), \\max \\Delta(12.0), \\rho(12.0)\\right].\n$$\nNo other text should be printed. There are no physical units in this problem; all quantities are dimensionless by construction and should be reported as real numbers rounded to six digits after the decimal point.",
            "solution": "The user has provided a well-defined computational problem in the domain of systems biology, specifically focusing on Flux Balance Analysis (FBA) and Flux Variability Analysis (FVA). The problem is scientifically grounded, self-contained, and algorithmically solvable. All necessary parameters, including the stoichiometric matrix $S$, objective vector $c$, flux bounds $l$ and $u$, and the set of relaxation parameters $\\epsilon$, are explicitly provided. The problem is validated as valid, and a solution will be provided.\n\nThe core of the problem involves solving a series of Linear Programming (LP) problems. The overall procedure can be broken down into three main steps:\n1.  **Optimal Biomass Production ($z^\\star$)**: First, we perform a standard FBA to find the maximum possible biomass production rate, denoted as $z^\\star$. This corresponds to solving the following LP problem:\n    $$\n    z^\\star = \\max_{v} \\{c^T v\\} \\quad \\text{subject to} \\quad S v = 0, \\quad l \\le v \\le u\n    $$\n    The objective vector is $c^T = [0, 0, 1, 0, 1, 0]$, meaning we maximize the sum of fluxes $v_3$ and $v_5$. The constraints $S v = 0$ enforce mass balance at steady state for the metabolites $\\text{S}, \\text{A}, \\text{B}$. The bounds are $0 \\le v_1 \\le 10$ and $v_i \\ge 0$ for $i \\in \\{2, \\dots, 6\\}$.\n    From the mass balance equations $v_2 = v_3$ and $v_4 = v_5$, the objective is $z = v_3+v_5 = v_2+v_4$. The balance for substrate $\\text{S}$ is $v_1 = v_2+v_4+v_6 = z+v_6$. Given the uptake limit $v_1 \\le 10$, we have $z+v_6 \\le 10$. To maximize $z$, we must set $v_6=0$, which yields $z \\le 10$. The maximum is achieved when $v_1=10$, giving the optimal objective value $z^\\star = 10$.\n\n2.  **Flux Variability Analysis (FVA)**: FVA determines the range of possible values for each flux $v_i$ while satisfying the network constraints and an additional constraint on the objective function. For each reaction $i \\in \\{1,\\dots,6\\}$ and each relaxation parameter $\\epsilon$, we solve two LP problems to find the minimum and maximum possible flux values:\n    $$\n    \\min/\\max_v \\{v_i\\} \\quad \\text{subject to} \\quad S v = 0, \\quad l \\le v \\le u, \\quad c^T v \\ge z^\\star - \\epsilon\n    $$\n    The width of the FVA range for reaction $i$ is then $w_i(\\epsilon) = (\\max v_i) - (\\min v_i)$. We first compute the baseline widths $w_i(0)$ for $\\epsilon=0$. This corresponds to the case where the solution must be optimal ($c^T v = z^\\star$). For the given network, this forces $v_3+v_5=10$, $v_1=10$, and $v_6=0$. The reactions on the two parallel biomass-producing pathways ($v_2, v_3, v_4, v_5$) can trade off, leading to ranges $[0, 10]$ and thus widths $w_i(0)=10$ for $i \\in \\{2,3,4,5\\}$. The uptake and waste fluxes are fixed, so $w_1(0)=0$ and $w_6(0)=0$.\n\n3.  **Inflation Metrics Calculation**: For each $\\epsilon$ in the test suite $\\{0.0, 0.5, 2.0, 10.0, 12.0\\}$, we compute the FVA widths $w_i(\\epsilon)$ and then calculate the three specified inflation metrics:\n    -   **Mean Absolute Inflation, $\\overline{\\Delta}(\\epsilon)$**: The average increase in range width across all reactions, $\\frac{1}{6} \\sum_{i=1}^{6} (w_i(\\epsilon) - w_i(0))$. As $\\epsilon$ increases, the feasible solution space expands. This primarily affects fluxes $v_1$ and $v_6$. For $0 \\le \\epsilon < 10$, their ranges become $[10-\\epsilon, 10]$ and $[0, \\epsilon]$ respectively, leading to a width of $\\epsilon$ for both. For $\\epsilon \\ge 10$, the optimality constraint $c^T v \\ge 10-\\epsilon$ becomes non-binding (since fluxes are non-negative), and all fluxes can vary over their widest possible ranges given the uptake limit, resulting in widths of $10$ for all reactions.\n    -   **Maximum Absolute Inflation, $\\max_i \\Delta_i(\\epsilon)$**: The largest increase in width observed for any single reaction. This will be $\\epsilon$ for $0 \\le \\epsilon < 10$ and $10$ for $\\epsilon \\ge 10$, driven by $v_1$ and $v_6$.\n    -   **Mean Relative Inflation, $\\rho(\\epsilon)$**: This metric focuses on reactions that were already flexible at optimality ($\\epsilon=0$). The set of such reactions is $J = \\{i \\mid w_i(0) > 10^{-9}\\}$, which in our case is $J=\\{2,3,4,5\\}$. For these reactions, the FVA width remains $10$ for any $\\epsilon \\ge 0$, because their maximum is determined by the total available substrate ($v_1 \\le 10$) and their minimum is $0$. Thus, $w_i(\\epsilon) = w_i(0) = 10$ for all $i \\in J$. The ratio $w_i(\\epsilon)/w_i(0)$ is always $1$, and therefore $\\rho(\\epsilon) = 1$ for all $\\epsilon \\ge 0$.\n\nThe implementation will use the `scipy.optimize.linprog` function to solve the required LP problems. A main function will orchestrate the FBA and FVA calculations, compute the metrics for each value of $\\epsilon$, and format the results as a single comma-separated string.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves the FBA/FVA problem as described in the problem statement.\n    \"\"\"\n    # --- Problem Definition ---\n    # Stoichiometric matrix S (3 metabolites x 6 reactions)\n    S = np.array([\n        [1, -1, 0, -1, 0, -1],  # Metabolite S\n        [0, 1, -1, 0, 0, 0],   # Metabolite A\n        [0, 0, 0, 1, -1, 0]    # Metabolite B\n    ])\n    \n    # Objective vector c (maximize biomass: v3 + v5)\n    c_obj = np.array([0, 0, 1, 0, 1, 0])\n    \n    # Flux bounds (l <= v <= u)\n    bounds = [\n        (0, 10),    # v1: 0 <= v1 <= 10\n        (0, None),  # v2: 0 <= v2\n        (0, None),  # v3: 0 <= v3\n        (0, None),  # v4: 0 <= v4\n        (0, None),  # v5: 0 <= v5\n        (0, None)   # v6: 0 <= v6\n    ]\n    \n    n_reactions = S.shape[1]\n    n_metabolites = S.shape[0]\n    \n    # Epsilon values for the test suite\n    test_epsilons = [0.0, 0.5, 2.0, 10.0, 12.0]\n\n    # --- Step 1: Compute z_star (optimal FBA objective) ---\n    # We maximize c_obj^T * v, which is equivalent to minimizing -c_obj^T * v.\n    res_fba = linprog(\n        c=-c_obj, \n        A_eq=S, \n        b_eq=np.zeros(n_metabolites),\n        bounds=bounds,\n        method='highs'\n    )\n    \n    if not res_fba.success:\n        # This should not happen for a valid problem definition.\n        raise RuntimeError(\"FBA optimization failed to find the optimal solution.\")\n    z_star = -res_fba.fun\n    \n    # --- FVA solver function ---\n    def run_fva(epsilon, z_star_val):\n        \"\"\"\n        Performs Flux Variability Analysis for a given epsilon.\n        Returns an array of FVA range widths w_i(epsilon).\n        \"\"\"\n        fva_widths = np.zeros(n_reactions)\n\n        # FVA constraint: c_obj^T * v >= z_star - epsilon\n        # For linprog (Ax <= b), this is: -c_obj^T * v <= -(z_star - epsilon)\n        A_ub_fva = -c_obj.reshape(1, -1)\n        b_ub_fva = [-(z_star_val - epsilon)]\n        \n        for i in range(n_reactions):\n            # Minimize v_i\n            c_min = np.zeros(n_reactions)\n            c_min[i] = 1\n            res_min = linprog(\n                c=c_min,\n                A_ub=A_ub_fva,\n                b_ub=b_ub_fva,\n                A_eq=S,\n                b_eq=np.zeros(n_metabolites),\n                bounds=bounds,\n                method='highs'\n            )\n            if not res_min.success:\n                raise RuntimeError(f\"FVA min for v_{i+1} failed at eps={epsilon}\")\n            v_min = res_min.fun\n\n            # Maximize v_i (by minimizing -v_i)\n            c_max = np.zeros(n_reactions)\n            c_max[i] = -1\n            res_max = linprog(\n                c=c_max,\n                A_ub=A_ub_fva,\n                b_ub=b_ub_fva,\n                A_eq=S,\n                b_eq=np.zeros(n_metabolites),\n                bounds=bounds,\n                method='highs'\n            )\n            if not res_max.success:\n                raise RuntimeError(f\"FVA max for v_{i+1} failed at eps={epsilon}\")\n            v_max = -res_max.fun\n            \n            # Clamp small negative values from solver precision to the known lower bound.\n            if bounds[i][0] is not None and v_min < bounds[i][0]:\n                v_min = bounds[i][0]\n\n            fva_widths[i] = v_max - v_min\n            \n        return fva_widths\n\n    # --- Step 2: Compute baseline FVA widths w_i(0) ---\n    w_0 = run_fva(epsilon=0.0, z_star_val=z_star)\n    \n    # Identify reactions with positive baseline width for the rho metric\n    J = np.where(w_0 > 1e-9)[0]\n    len_J = len(J)\n    \n    # --- Step 3: Compute metrics for each epsilon in the test suite ---\n    final_results = []\n    \n    for eps in test_epsilons:\n        # Compute FVA widths for the given epsilon\n        w_eps = run_fva(epsilon=eps, z_star_val=z_star)\n        \n        # Absolute inflation per reaction\n        delta = w_eps - w_0\n        \n        # Mean absolute inflation\n        mean_delta = np.mean(delta)\n        \n        # Maximum absolute inflation\n        max_delta = np.max(delta)\n        \n        # Mean relative inflation\n        if len_J == 0:\n            rho = 0.0\n        else:\n            rho = np.mean(w_eps[J] / w_0[J])\n            \n        final_results.extend([mean_delta, max_delta, rho])\n        \n    # --- Final Output Formatting ---\n    # Format the results into a single comma-separated string with 6 decimal places.\n    output_str = \",\".join([f\"{x:.6f}\" for x in final_results])\n    print(f\"[{output_str}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The existence of a high-dimensional space of alternative optima presents a challenge for predicting cellular behavior. This advanced practice reframes this challenge as a \"minimal intervention problem,\" asking for the smallest set of reaction fluxes one must measure or control to render the optimal state unique. By connecting the affine dimension of the optimal solution space to the rank of the underlying constraint matrix, you will develop a greedy algorithm to identify a minimal set of determinative reactions, a concept with direct applications in experimental design and metabolic engineering. ",
            "id": "3309704",
            "problem": "You are given linear models of metabolic networks posed as a Flux Balance Analysis (FBA) linear program. For each test instance, the network is specified by a stoichiometric matrix $S \\in \\mathbb{R}^{m \\times n}$, lower and upper bounds $l \\in \\mathbb{R}^{n}$ and $u \\in \\mathbb{R}^{n}$ with $l \\le u$, and an objective vector $c \\in \\mathbb{R}^{n}$. Consider the linear program\nmaximize $c^\\top v$ subject to $S v = 0$ and $l \\le v \\le u$, where $v \\in \\mathbb{R}^{n}$ are the reaction fluxes. Let $z^\\star$ denote the optimal objective value and let $\\mathcal{F} = \\{ v \\in \\mathbb{R}^{n} \\mid S v = 0,\\ l \\le v \\le u,\\ c^\\top v = z^\\star \\}$ denote the optimal face (the set of all optimal solutions at steady state within bounds).\n\nThe minimal intervention problem is: choose the smallest set of reaction indices $\\mathcal{K} \\subseteq \\{1,\\dots,n\\}$ such that adding the equalities $v_i = v_i^0$ for all $i \\in \\mathcal{K}$, for some fixed reference optimal point $v^0 \\in \\mathcal{F}$, makes the optimal solution unique. Here, “making the optimum unique” means that the constrained problem has a single optimal solution $\\tilde v$ that is a singleton set. Geometrically, adding $|\\mathcal{K}|$ independent equalities adds $|\\mathcal{K}|$ hyperplanes that intersect the affine hull of $\\mathcal{F}$. The smallest such $|\\mathcal{K}|$ equals the affine dimension of $\\mathcal{F}$.\n\nYour tasks are:\n1. For each test instance, compute a reference optimal objective value $z^\\star$ and any reference optimal flux vector $v^0 \\in \\mathcal{F}$.\n2. Perform Flux Variability Analysis (FVA) on the optimal face by, for each index $i \\in \\{1,\\dots,n\\}$, computing the minimum and maximum achievable values of $v_i$ subject to $S v = 0$, $l \\le v \\le u$, and $c^\\top v = z^\\star$. Call these values $v_i^{\\min}$ and $v_i^{\\max}$. A flux $v_i$ is “globally fixed on $\\mathcal{F}$” if $v_i^{\\min} = v_i^{\\max}$ (numerically within a tolerance you choose).\n3. Using only linear algebra and the equalities that hold for every $v \\in \\mathcal{F}$, determine the affine dimension of $\\mathcal{F}$. This number equals the smallest cardinality $k_{\\min}$ of a set of reaction-fixing equalities $v_i = v_i^0$ necessary to make the optimum unique. Express $k_{\\min}$ as an integer.\n4. Design and implement a greedy algorithm that starts from the equalities that hold for every $v \\in \\mathcal{F}$ and iteratively adds equalities of the form $v_i = v_i^0$ for indices $i$ not yet fixed, each time choosing an index whose addition most reduces the remaining affine dimension of the feasible set restricted to $c^\\top v = z^\\star$, until a unique optimum is guaranteed. Return the number of added equalities $k_{\\mathrm{greedy}}$ (an integer) and the chosen indices as a list of zero-based indices.\n\nYour program must implement the above and run on the following test suite. For each test, $S$, $l$, $u$, and $c$ are given explicitly. Bounds are in arbitrary consistent units; no unit conversion or physical units need to be reported. All angles, if any, are irrelevant to this problem.\n\nTest suite:\n- Test 1 (single internal cycle):\n  - $m = 2$, $n = 4$.\n  - $$S = \\begin{bmatrix}\n  1 & -1 & 0 & 1 \\\\\n  0 & 1 & -1 & -1\n  \\end{bmatrix}.$$\n  - $$l = \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{bmatrix},\\quad u = \\begin{bmatrix} 10 \\\\ 100 \\\\ 100 \\\\ 100 \\end{bmatrix}.$$\n  - $$c = \\begin{bmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 0 \\end{bmatrix}.$$\n- Test 2 (no internal cycles, unique optimum):\n  - $m = 2$, $n = 3$.\n  - $$S = \\begin{bmatrix}\n  1 & -1 & 0 \\\\\n  0 & 1 & -1\n  \\end{bmatrix}.$$\n  - $$l = \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\end{bmatrix},\\quad u = \\begin{bmatrix} 10 \\\\ 100 \\\\ 100 \\end{bmatrix}.$$\n  - $$c = \\begin{bmatrix} 0 \\\\ 0 \\\\ 1 \\end{bmatrix}.$$\n- Test 3 (two independent cycles, one coupled to the objective block and one disjoint):\n  - $m = 5$, $n = 7$.\n  - $$S = \\begin{bmatrix}\n  1 & -1 & 0 & 0 & 0 & 0 & 0 \\\\\n  0 & 1 & -1 & -1 & 1 & 0 & 0 \\\\\n  0 & 0 & 0 & 1 & -1 & 0 & 0 \\\\\n  0 & 0 & 0 & 0 & 0 & -1 & 1 \\\\\n  0 & 0 & 0 & 0 & 0 & 1 & -1\n  \\end{bmatrix}.$$\n  - $$l = \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{bmatrix},\\quad u = \\begin{bmatrix} 10 \\\\ 100 \\\\ 100 \\\\ 100 \\\\ 100 \\\\ 100 \\\\ 100 \\end{bmatrix}.$$\n  - $$c = \\begin{bmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{bmatrix}.$$\n\nFinal output format: Your program should produce a single line of output containing a list of results, one per test case, where each result is a list of the form $[k_{\\min}, k_{\\mathrm{greedy}}, \\text{indices}]$. Here, $k_{\\min}$ and $k_{\\mathrm{greedy}}$ are integers, and $\\text{indices}$ is a list of zero-based integers in nondecreasing order giving the reactions selected by your greedy algorithm. For example, an output for three tests should have the form\n\"[[kmin1,kg1,[i1,i2,...]],[kmin2,kg2,[...]], [kmin3,kg3,[...]]]\".",
            "solution": "The user has provided a problem in the domain of computational systems biology, specifically concerning Flux Balance Analysis (FBA) and the characterization of the space of optimal solutions. The problem is to determine the minimum number of reaction fluxes that must be fixed to ensure a unique optimal flux distribution and to find one such set of reactions using a greedy algorithm. The problem is scientifically valid, well-posed, and all necessary data are provided. A complete solution is therefore provided below.\n\n### I. Theoretical Framework\n\nThe metabolic network is modeled under steady-state conditions, described by the matrix equation $S v = 0$, where $S \\in \\mathbb{R}^{m \\times n}$ is the stoichiometric matrix for a network with $m$ metabolites and $n$ reactions, and $v \\in \\mathbb{R}^{n}$ is the vector of reaction fluxes. The fluxes are further constrained by lower and upper bounds, $l \\le v \\le u$.\n\nFlux Balance Analysis (FBA) seeks to find a flux distribution $v$ that optimizes a given cellular objective, represented by a linear function $c^\\top v$ for some $c \\in \\mathbb{R}^{n}$. This is formulated as a linear program (LP):\n$$\n\\begin{align*}\n\\text{maximize} \\quad & z = c^\\top v \\\\\n\\text{subject to} \\quad & S v = 0 \\\\\n& l \\le v \\le u\n\\end{align*}\n$$\nLet the optimal objective value be $z^\\star$. The set of all flux vectors that achieve this optimal value is called the optimal face, denoted by $\\mathcal{F}$:\n$$\n\\mathcal{F} = \\{ v \\in \\mathbb{R}^{n} \\mid S v = 0, \\ l \\le v \\le u, \\ c^\\top v = z^\\star \\}\n$$\nThe set $\\mathcal{F}$ is a convex polytope. If $\\mathcal{F}$ is not a singleton (i.e., a single point), there are multiple alternative optimal flux distributions. The problem asks for the size of the smallest set of reactions $\\mathcal{K}$ such that fixing their fluxes, $v_i = v_i^0$ for all $i \\in \\mathcal{K}$ (where $v^0 \\in \\mathcal{F}$ is a reference optimal solution), renders the optimal solution unique. This minimum size, $k_{\\min}$, is equal to the affine dimension of $\\mathcal{F}$.\n\n### II. Algorithmic Steps\n\nThe solution proceeds through four main steps as outlined in the problem statement.\n\n**Step 1: Compute the Optimal Objective Value**\n\nFirst, we solve the primary FBA problem to determine the maximum objective value $z^\\star$. This is achieved by solving the LP defined above. A standard LP solver is used for this task. Any resulting optimal flux vector can serve as the reference vector $v^0$. Let the solution to this LP be $v^0$, with $z^\\star = c^\\top v^0$.\n\n**Step 2: Flux Variability Analysis (FVA) on the Optimal Face**\n\nTo characterize the geometry of $\\mathcal{F}$, we must identify which fluxes are fixed across all optimal solutions and which can vary. This is done via Flux Variability Analysis (FVA), but applied to the optimal face $\\mathcal{F}$ rather than the entire feasible space. For each reaction $i \\in \\{1, \\dots, n\\}$, we solve two LPs:\n$$\n\\begin{array}{ll}\nv_i^{\\min} = \\min_{v} v_i & \\quad \\text{subject to } v \\in \\mathcal{F} \\\\\nv_i^{\\max} = \\max_{v} v_i & \\quad \\text{subject to } v \\in \\mathcal{F}\n\\end{array}\n$$\nThese LPs are explicitly:\n$$\n\\begin{align*}\n\\text{minimize/maximize} \\quad & v_i \\\\\n\\text{subject to} \\quad & S v = 0 \\\\\n& c^\\top v = z^\\star \\\\\n& l \\le v \\le u\n\\end{align*}\n$$\nA reaction $i$ is \"globally fixed\" on $\\mathcal{F}$ if its feasible range is a single point, i.e., $v_i^{\\min} = v_i^{\\max}$ (within a numerical tolerance). These fixed fluxes provide additional equality constraints that hold for every point in $\\mathcal{F}$.\n\n**Step 3: Determine the Affine Dimension of $\\mathcal{F}$ ($k_{\\min}$)**\n\nThe affine dimension of $\\mathcal{F}$ is the dimension of the smallest affine subspace containing it. This subspace is defined by all linear equalities that hold for every $v \\in \\mathcal{F}$. These equalities are:\n1. The steady-state constraints: $S v = 0$.\n2. The optimality constraint: $c^\\top v = z^\\star$.\n3. The fixed-flux constraints: $v_i = v_i^{\\min}$ for all reactions $i$ identified as globally fixed by FVA.\n\nLet $v = v^0 + w$, where $v^0$ is our reference point in $\\mathcal{F}$ and $w$ is a direction vector. Any point $v \\in \\mathcal{F}$ must satisfy the equalities, so $w$ must lie in the null space of the matrix representing the homogeneous versions of these constraints. Let $A$ be the matrix whose rows consist of:\n1. The rows of the stoichiometric matrix $S$.\n2. The objective vector $c^\\top$.\n3. The standard basis vectors $e_i^\\top$ for each globally fixed reaction $i$.\n\nThe set of all possible direction vectors $w$ forms a vector space, which is the null space of $A$, i.e., $\\{w \\in \\mathbb{R}^n \\mid A w = 0 \\}$. The affine dimension of $\\mathcal{F}$ is the dimension of this null space. By the rank-nullity theorem, this dimension is:\n$$\nk_{\\min} = \\dim(\\text{null}(A)) = n - \\text{rank}(A)\n$$\nwhere $n$ is the number of reactions (columns of $A$). The rank of matrix $A$ can be computed numerically. This value $k_{\\min}$ is the minimum number of additional, linearly independent constraints required to reduce the dimension to $0$, thus uniquely determining the flux vector.\n\n**Step 4: Greedy Algorithm for Selecting Interventions ($k_{\\text{greedy}}$)**\n\nTo find a specific set of reactions to fix, we employ a greedy algorithm. The goal is to iteratively add constraints of the form $v_i = v_i^0$ to reduce the dimension of the solution space until it becomes zero.\n\nThe algorithm proceeds as follows:\n1. Initialize with the matrix $A$ from Step 3, which incorporates all known equalities on $\\mathcal{F}$. Let the set of selected intervention indices be $\\mathcal{K} = \\emptyset$.\n2. While the affine dimension of the current constrained set is greater than $0$:\n    a. Identify the set of candidate reactions for intervention. These are all reactions that are not yet fixed by the existing set of constraints. A reaction $j$ is not fixed if the constraint $w_j = 0$ (i.e., adding the row $e_j^\\top$) is linearly independent of the rows of the current constraint matrix.\n    b. The problem asks to choose the index that \"most reduces the remaining affine dimension.\" Adding a single linear constraint can reduce the dimension by at most $1$. Therefore, any candidate reaction $j$ whose addition increases the rank of the constraint matrix is a valid choice.\n    c. To ensure a deterministic outcome, we apply a tie-breaking rule: select the candidate reaction with the smallest index.\n    d. Add the selected index $j$ to the set $\\mathcal{K}$ and append the row $e_j^\\top$ to the constraint matrix.\n3. The algorithm terminates when the dimension of the null space is $0$. The number of added reactions is $k_{\\text{greedy}} = |\\mathcal{K}|$, and $\\mathcal{K}$ is the required set of indices. By construction, each step reduces the dimension by one, so we will have $k_{\\text{greedy}} = k_{\\min}$.\n\nThis procedure provides a constructive method for finding a minimal set of interventions to ensure a unique optimal FBA solution.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Main function to run the analysis on all test cases and print the result.\n    \"\"\"\n    \n    # Test 1: Single internal cycle\n    S1 = np.array([\n        [1, -1, 0, 1],\n        [0, 1, -1, -1]\n    ])\n    l1 = np.array([0, 0, 0, 0])\n    u1 = np.array([10, 100, 100, 100])\n    c1 = np.array([0, 0, 1, 0])\n\n    # Test 2: No internal cycles, unique optimum\n    S2 = np.array([\n        [1, -1, 0],\n        [0, 1, -1]\n    ])\n    l2 = np.array([0, 0, 0])\n    u2 = np.array([10, 100, 100])\n    c2 = np.array([0, 0, 1])\n\n    # Test 3: Two independent cycles\n    S3 = np.array([\n        [1, -1, 0, 0, 0, 0, 0],\n        [0, 1, -1, -1, 1, 0, 0],\n        [0, 0, 0, 1, -1, 0, 0],\n        [0, 0, 0, 0, 0, -1, 1],\n        [0, 0, 0, 0, 0, 1, -1]\n    ])\n    l3 = np.array([0, 0, 0, 0, 0, 0, 0])\n    u3 = np.array([10, 100, 100, 100, 100, 100, 100])\n    c3 = np.array([0, 0, 1, 0, 0, 0, 0])\n\n    test_cases = [\n        (S1, l1, u1, c1),\n        (S2, l2, u2, c2),\n        (S3, l3, u3, c3),\n    ]\n\n    results = []\n    for S, l, u, c in test_cases:\n        result = solve_case(S, l, u, c)\n        results.append(result)\n\n    # Format output string manually to match requirements (no spaces)\n    str_results = []\n    for r in results:\n        k_min, k_greedy, indices = r\n        indices_str = f\"[{','.join(map(str, indices))}]\"\n        str_results.append(f\"[{k_min},{k_greedy},{indices_str}]\")\n    \n    print(f\"[{','.join(str_results)}]\")\n\ndef solve_case(S, l, u, c):\n    \"\"\"\n    Solves a single instance of the problem.\n    \"\"\"\n    m, n = S.shape\n    tol = 1e-9\n    bounds = list(zip(l, u))\n    b_eq = np.zeros(m)\n\n    # Task 1: Find optimal objective value z_star\n    # We maximize c'v by minimizing -c'v\n    res_fba = linprog(-c, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs')\n    if not res_fba.success:\n        raise RuntimeError(\"FBA optimization failed.\")\n    z_star = -res_fba.fun\n    \n    # Task 2: Perform Flux Variability Analysis (FVA) on the optimal face\n    A_fva = np.vstack([S, c])\n    b_fva = np.hstack([b_eq, z_star])\n    \n    v_min = np.zeros(n)\n    v_max = np.zeros(n)\n    \n    for i in range(n):\n        # Minimize v_i\n        c_fva = np.zeros(n)\n        c_fva[i] = 1\n        res_min = linprog(c_fva, A_eq=A_fva, b_eq=b_fva, bounds=bounds, method='highs')\n        if res_min.success:\n            v_min[i] = res_min.fun\n        else: # If LP fails, it could be due to infeasibility, but here implies fixed\n            v_min[i] = np.nan\n\n        # Maximize v_i\n        c_fva[i] = -1\n        res_max = linprog(c_fva, A_eq=A_fva, b_eq=b_fva, bounds=bounds, method='highs')\n        if res_max.success:\n            v_max[i] = -res_max.fun\n        else:\n            v_max[i] = np.nan\n\n    fixed_indices = {i for i in range(n) if abs(v_max[i] - v_min[i]) < tol}\n    \n    # Task 3: Determine the affine dimension k_min\n    # Build matrix A for the homogeneous system Aw = 0\n    # The null space of A corresponds to the affine dimension of the optimal face\n    A_eq_rows = [S, c.reshape(1, -1)]\n    for i in sorted(list(fixed_indices)):\n        e_i = np.zeros((1, n))\n        e_i[0, i] = 1\n        A_eq_rows.append(e_i)\n        \n    A = np.vstack(A_eq_rows)\n\n    # Remove linearly dependent rows for a clean basis\n    # This is implicitly handled by matrix_rank, but can be done explicitly\n    # A_basis = get_row_basis(A, tol) #\n    \n    rank_A = np.linalg.matrix_rank(A, tol=tol)\n    k_min = n - rank_A\n\n    # Task 4: Greedy algorithm\n    if k_min == 0:\n        return [0, 0, []]\n\n    greedy_indices = []\n    A_greedy = A.copy()\n    \n    current_rank = rank_A\n    \n    Candidate_indices = sorted(list(set(range(n)) - fixed_indices))\n\n    while n - current_rank > 0:\n        found_next_idx = False\n        for i in Candidate_indices:\n            if i in greedy_indices:\n                continue\n\n            e_i = np.zeros((1, n))\n            e_i[0, i] = 1\n            A_temp = np.vstack([A_greedy, e_i])\n            \n            new_rank = np.linalg.matrix_rank(A_temp, tol=tol)\n            \n            if new_rank > current_rank:\n                # This is a valid choice; it reduces the dimension\n                greedy_indices.append(i)\n                A_greedy = A_temp\n                current_rank = new_rank\n                found_next_idx = True\n                break  # Smallest index tie-breaking\n        \n        if not found_next_idx:\n            # This should not happen if k_min > 0\n            break\n\n    k_greedy = len(greedy_indices)\n    \n    return [k_min, k_greedy, sorted(greedy_indices)]\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}