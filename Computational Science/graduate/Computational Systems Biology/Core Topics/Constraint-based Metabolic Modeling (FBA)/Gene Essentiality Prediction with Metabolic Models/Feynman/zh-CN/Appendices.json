{
    "hands_on_practices": [
        {
            "introduction": "本练习旨在帮助您建立对通量平衡分析（FBA）的基础理解。您将为一个小型代谢网络实施FBA，计算最优生长速率，并观察由基因-蛋白质-反应（GPR）规则控制的单基因缺失如何改变网络的性能。这个练习  是预测遗传变化如何影响表型的基石。",
            "id": "3313723",
            "problem": "考虑一个以稳态形式表达的玩具基因组尺度代谢模型。该模型包括一组内部代谢物和反应、一个化学计量矩阵、反应边界和一个生物量目标函数。您的任务是使用通量平衡分析（FBA；Flux Balance Analysis）计算最佳生长速率，并确定哪些反应在最优点具有非零流。推导的基本基础是稳态质量平衡假设和对通量的线性约束。\n\n内部代谢物为 $m = \\{ \\text{glc}, \\text{pyr} \\}$，分别对应葡萄糖和丙酮酸。反应 $n = \\{ v_1, v_2, v_3, v_4, v_5, v_6 \\}$ 的生化意图定义如下，但您必须纯粹以数学术语求解：\n- $v_1$: 葡萄糖摄取（将葡萄糖导入系统）。\n- $v_2$: 葡萄糖转化为丙酮酸。\n- $v_3$: 丙酮酸转化为生物量。\n- $v_4$: 葡萄糖转化为废物池。\n- $v_5$: 丙酮酸转化为废物池。\n- $v_6$: 葡萄糖通过替代途径直接转化为生物量。\n\n稳态化学计量矩阵 $S \\in \\mathbb{R}^{2 \\times 6}$，按代谢物 $(\\text{glc}, \\text{pyr})$ 和反应 $(v_1,\\dots,v_6)$ 的顺序排列，明确给出如下\n$$\nS =\n\\begin{bmatrix}\n+1  -1  0  -1  0  -1 \\\\\n0  +2  -1  0  -1  0\n\\end{bmatrix}.\n$$\n稳态质量平衡约束为 $S \\, \\mathbf{v} = \\mathbf{0}$，其中 $\\mathbf{v} \\in \\mathbb{R}^6$ 是按 $(v_1,\\dots,v_6)$ 顺序排列的反应流向量。\n\n反应流的默认下界和上界为\n$$\n\\ell = \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{bmatrix}, \\quad\nu = \\begin{bmatrix} 10 \\\\ 100 \\\\ 100 \\\\ 100 \\\\ 100 \\\\ 100 \\end{bmatrix}.\n$$\n生物量目标是最大化线性目标\n$$\n\\max_{\\mathbf{v}} \\; \\mathbf{c}^\\top \\mathbf{v}, \\quad \\text{其中} \\quad \\mathbf{c} = \\begin{bmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 0 \\\\ 0 \\\\ 1 \\end{bmatrix},\n$$\n意味着生物量生产速率为 $v_3 + v_6$。\n\n基因-蛋白质-反应（GPR）规则将基因删除与反应敲除关联起来，如下所示：\n- 反应 $v_1$ 需要基因 $g_T$。\n- 反应 $v_2$ 需要基因 $g_A$。\n- 反应 $v_3$ 需要基因 $g_B$。\n- 反应 $v_6$ 需要一个由与逻辑规则编码的蛋白质复合物：$g_A$ AND $g_C$。如果 $g_A$ 或 $g_C$ 中的任何一个被删除，$v_6$ 将被禁用。\n- 反应 $v_4$ 和 $v_5$ 没有基因要求，除非另有界定，否则保持可用。\n\n基因删除通过将其相应的反应边界设置为 $[0, 0]$ 来禁用其关联的反应。对于 $v_6$ 上的与逻辑规则，如果任何所需基因被删除，$v_6$ 将被禁用。\n\n您必须通过求解以下线性规划来实现 FBA\n$$\n\\max_{\\mathbf{v}} \\; \\mathbf{c}^\\top \\mathbf{v} \\quad \\text{subject to} \\quad S \\mathbf{v} = \\mathbf{0}, \\quad \\ell \\le \\mathbf{v} \\le u.\n$$\n在确定哪些反应在最优点具有非零流时，将任何绝对值严格大于 $\\varepsilon = 10^{-9}$ 的流视为非零。\n\n测试套件：\n在以下参数集下评估模型。每个测试用例包含一组删除的基因，以及可选的对 $v_1$（葡萄糖摄取）的修改后上界。如果指定了修改后的上界，它将替换该测试用例的默认边界；否则，使用默认值。\n- 测试用例 1：删除的基因 $= \\varnothing$；未指定修改后的 $v_1$ 上界。\n- 测试用例 2：删除的基因 $= \\{ g_A \\}$；未指定修改后的 $v_1$ 上界。\n- 测试用例 3：删除的基因 $= \\{ g_B \\}$；未指定修改后的 $v_1$ 上界。\n- 测试用例 4：删除的基因 $= \\{ g_C \\}$；未指定修改后的 $v_1$ 上界。\n- 测试用例 5：删除的基因 $= \\{ g_T \\}$；未指定修改后的 $v_1$ 上界。\n- 测试用例 6：删除的基因 $= \\varnothing$；修改后的 $v_1$ 上界 $= 3$。\n- 测试用例 7：删除的基因 $= \\{ g_B \\}$；修改后的 $v_1$ 上界 $= 3$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。对于每个测试用例，输出一个扁平的数字列表，形式为\n$$\n[\\; \\text{growth},\\; a_1,\\; a_2,\\; a_3,\\; a_4,\\; a_5,\\; a_6 \\;],\n$$\n其中 $\\text{growth}$ 是作为实数的最佳目标值 $\\mathbf{c}^\\top \\mathbf{v}$，而 $a_i$ 是反应 $v_i$ 的活性指示符，定义为如果 $|v_i| > \\varepsilon$，则 $a_i = 1$，否则 $a_i = 0$。将每个测试用例的列表按照测试套件的顺序聚合到单个顶级列表中。例如，\n$$\n\\big[ \\; [\\text{growth}_1,a_{1,1},\\dots,a_{1,6}],\\; [\\text{growth}_2,a_{2,1},\\dots,a_{2,6}],\\; \\dots \\; \\big].\n$$",
            "solution": "该问题要求实施通量平衡分析（FBA），以预测一个玩具代谢模型在几种遗传和环境条件下的最佳生长速率和活性代谢通量。该问题是适定的，其科学基础是计算系统生物学的原理，并为获得唯一解提供了所有必要的数据。\n\n通量平衡分析（FBA）是一种数学方法，用于预测生物系统在稳态下的代谢通量分布。它依赖于质量守恒原理，该原理规定，对于处于稳态的系统，每种内部代谢物的产生速率必须等于其消耗速率。这由矩阵方程 $S \\mathbf{v} = \\mathbf{0}$ 表示，其中 $S$ 是化学计量矩阵，$\\mathbf{v}$ 是反应通量的向量。\n\n所有满足稳态条件以及热力学和容量约束（反应边界 $\\ell \\le \\mathbf{v} \\le u$）的通量向量 $\\mathbf{v}$ 的集合构成一个可行解空间。FBA 在此空间内寻找一个特定的通量分布，该分布能最大化或最小化给定的代谢目标，该目标被表达为一个线性目标函数 $\\mathbf{c}^\\top \\mathbf{v}$。因此，该问题是一个线性规划（LP）：\n$$\n\\max_{\\mathbf{v}} \\; \\mathbf{c}^\\top \\mathbf{v} \\quad \\text{subject to} \\quad S \\mathbf{v} = \\mathbf{0}, \\quad \\ell \\le \\mathbf{v} \\le u.\n$$\n为了使用执行最小化的标准 LP 求解器来解决这个最大化问题，我们将其重新表述为最小化目标函数的负值：\n$$\n\\min_{\\mathbf{v}} \\; (-\\mathbf{c}^\\top) \\mathbf{v} \\quad \\text{subject to} \\quad S \\mathbf{v} = \\mathbf{0}, \\quad \\ell \\le \\mathbf{v} \\le u.\n$$\n\nLP 的组成部分定义如下：\n- 化学计量矩阵 $S$：\n$$\nS =\n\\begin{bmatrix}\n+1  -1  0  -1  0  -1 \\\\\n0  +2  -1  0  -1  0\n\\end{bmatrix}\n$$\n- 用于最大化生物量（$v_3 + v_6$）的目标向量 $\\mathbf{c}$：\n$$\n\\mathbf{c} = [0, 0, 1, 0, 0, 1]^\\top\n$$\n- 默认边界：$\\ell = [0, 0, 0, 0, 0, 0]^\\top$ 和 $u = [10, 100, 100, 100, 100, 100]^\\top$。\n\n通过修改通量边界来应用基因-蛋白质-反应（GPR）规则。如果一个基因删除禁用了反应 $v_i$，其上下界都设置为 $0$，从而有效地将其从网络中移除（$v_i=0$）。\n\n分析过程是通过为七个测试用例中的每一个构建和求解 LP 来进行的。\n\n**测试用例 1：野生型（无删除，默认葡萄糖摄取）**\n- **条件**：删除的基因 $\\varnothing$；$v_1$ 上界为默认值 $10$。\n- **分析**：系统可以使用两种途径产生生物量：$v_1 \\to v_2 \\to v_3$ 或 $v_1 \\to v_6$。生物量目标是 $v_3+v_6$。质量平衡方程为 $v_1 = v_2 + v_4 + v_6$ 和 $2v_2 = v_3 + v_5$。为了最大化生长，废物通量 $v_4$ 和 $v_5$ 被最小化为 $0$。约束变为 $v_1 = v_2 + v_6$ 和 $2v_2=v_3$。目标 $v_3+v_6$ 可以用输入重写为 $2v_1 - v_6$。为了最大化这个值，$v_1$ 应为最大值（$10$），$v_6$ 应为最小值（$0$）。这得到 $v_1=10$，$v_2=10$，$v_3=20$，其他通量为 $0$。\n- **结果**：最佳生长为 $20.0$。活性通量为 $v_1, v_2, v_3$。\n\n**测试用例 2：基因 $g_A$ 删除**\n- **条件**：删除的基因 $\\{g_A\\}$；默认葡萄糖摄取。\n- **分析**：反应 $v_2$ 和 $v_6$ 需要基因 $g_A$。删除 $g_A$ 会将 $v_2$ 和 $v_6$ 的边界设置为 $[0,0]$，迫使 $v_2=0$ 和 $v_6=0$。质量平衡方程变为 $v_1 - v_4 = 0$ 和 $-v_3 - v_5 = 0$。由于所有通量必须为非负数，第二个方程意味着 $v_3=0$ 和 $v_5=0$。由于两个产生生物量的反应 $v_3$ 和 $v_6$ 都为零，目标值为 $0$。\n- **结果**：最佳生长为 $0.0$。没有产生生物量的反应可以被激活，最小通量解为 $\\mathbf{v}=\\mathbf{0}$。\n\n**测试用例 3：基因 $g_B$ 删除**\n- **条件**：删除的基因 $\\{g_B\\}$；默认葡萄糖摄取。\n- **分析**：$v_3$ 需要基因 $g_B$，所以 $v_3=0$。目标变为最大化 $v_6$。约束（废物通量设置为 $0$）为 $v_1 = v_2 + v_6$ 和 $2v_2=0$，这意味着 $v_2=0$。第一个约束简化为 $v_1 = v_6$。为了最大化 $v_6$，我们必须最大化 $v_1$，其限制为 $10$。因此，$v_1=10, v_6=10$。\n- **结果**：最佳生长为 $10.0$。活性通量为 $v_1, v_6$。\n\n**测试用例 4：基因 $g_C$ 删除**\n- **条件**：删除的基因 $\\{g_C\\}$；默认葡萄糖摄取。\n- **分析**：由于与逻辑规则（$g_A$ AND $g_C$），$v_6$ 需要基因 $g_C$，所以 $v_6=0$。系统被迫使用 $v_1 \\to v_2 \\to v_3$ 途径。这等同于野生型情况，其中最优解已经有 $v_6=0$。\n- **结果**：最佳生长为 $20.0$。活性通量为 $v_1, v_2, v_3$。\n\n**测试用例 5：基因 $g_T$ 删除**\n- **条件**：删除的基因 $\\{g_T\\}$；默认葡萄糖摄取。\n- **分析**：基因 $g_T$ 是葡萄糖摄取（$v_1$）所必需的，所以 $v_1=0$。没有底物进入系统，就不可能有代谢活动。第一个质量平衡方程 $-v_2 - v_4 - v_6 = 0$，加上非负性约束，迫使 $v_2, v_4, v_6$ 为 $0$。这随后迫使所有其他通量为 $0$。\n- **结果**：最佳生长为 $0.0$。所有通量均为 $0$。\n\n**测试用例 6：野生型，低葡萄糖摄取**\n- **条件**：删除的基因 $\\varnothing$；$v_1$ 上界修改为 $3$。\n- **分析**：此情况与野生型（案例1）相同，但葡萄糖供应减少。最佳策略是相同的：使用 $v_1 \\to v_2 \\to v_3$ 途径。生长率为 $2v_1$。当 $v_1$ 限制为 $3$ 时，最大生长率为 $2 \\times 3 = 6$。这需要 $v_1=3, v_2=3, v_3=6$。\n- **结果**：最佳生长为 $6.0$。活性通量为 $v_1, v_2, v_3$。\n\n**测试用例 7：基因 $g_B$ 删除，低葡萄糖摄取**\n- **条件**：删除的基因 $\\{g_B\\}$；$v_1$ 上界修改为 $3$。\n- **分析**：这结合了案例3（$g_B$ 删除）和案例6（低葡萄糖）的条件。删除 $g_B$ 迫使系统使用替代的生物量途径 $v_1 \\to v_6$，其中 $v_1=v_6$，生长率为 $v_6$。当 $v_1$ 限制为 $3$ 时，最大生长率为 $3$。这需要 $v_1=3, v_6=3$。\n- **结果**：最佳生长为 $3.0$。活性通量为 $v_1, v_6$。\n\n活性通量通过检查通量的绝对值 $|v_i|$ 是否严格大于容差 $\\varepsilon = 10^{-9}$ 来确定。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves a series of Flux Balance Analysis (FBA) problems for a toy metabolic model.\n    \"\"\"\n    \n    # Define model parameters\n    # Stoichiometric matrix S for metabolites (glc, pyr) and reactions (v1-v6)\n    S = np.array([\n        [1, -1, 0, -1, 0, -1],\n        [0, 2, -1, 0, -1, 0]\n    ])\n\n    # Objective vector c (maximizes v3 + v6)\n    c_max = np.array([0, 0, 1, 0, 0, 1])\n    \n    # For scipy.optimize.linprog, we minimize -c^T * v\n    c_min = -c_max\n\n    # Default lower and upper bounds for fluxes\n    l_default = np.array([0.0, 0.0, 0.0, 0.0, 0.0, 0.0])\n    u_default = np.array([10.0, 100.0, 100.0, 100.0, 100.0, 100.0])\n\n    # Right-hand side for steady-state equation Sv = 0\n    b_eq = np.array([0.0, 0.0])\n\n    # Nonzero flux tolerance\n    epsilon = 1e-9\n\n    # Define the test suite\n    test_cases = [\n        # (set of deleted genes, modified v1 upper bound or None)\n        (set(), None),\n        ({'g_A'}, None),\n        ({'g_B'}, None),\n        ({'g_C'}, None),\n        ({'g_T'}, None),\n        (set(), 3.0),\n        ({'g_B'}, 3.0)\n    ]\n\n    results = []\n    for deleted_genes, v1_upper_bound_mod in test_cases:\n        # Initialize bounds for the current test case\n        u_b = u_default.copy()\n\n        # Apply optional v1 upper bound modification\n        if v1_upper_bound_mod is not None:\n            u_b[0] = v1_upper_bound_mod\n\n        # Apply gene deletions based on GPR rules\n        # GPR: v1 - g_T\n        if 'g_T' in deleted_genes:\n            u_b[0] = 0.0\n        # GPR: v2 - g_A\n        if 'g_A' in deleted_genes:\n            u_b[1] = 0.0\n        # GPR: v3 - g_B\n        if 'g_B' in deleted_genes:\n            u_b[2] = 0.0\n        # GPR: v6 - g_A AND g_C\n        if 'g_A' in deleted_genes or 'g_C' in deleted_genes:\n            u_b[5] = 0.0\n\n        # Combine lower and upper bounds for the solver\n        bounds = list(zip(l_default, u_b))\n\n        # Solve the linear programming problem\n        # The 'highs' method is robust and recommended.\n        res = linprog(c=c_min, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs')\n        \n        # Process the results\n        if res.success:\n            # Optimal value from minimization is -growth, so negate it\n            growth = -res.fun\n            fluxes = res.x\n        else:\n            # If solver fails, assume zero growth and fluxes\n            growth = 0.0\n            fluxes = np.zeros(len(c_max))\n\n        # Ensure growth is not a small negative number close to zero\n        if abs(growth) < epsilon:\n            growth = 0.0\n        \n        # Determine which reactions carry nonzero flux\n        activity = [1 if abs(v) > epsilon else 0 for v in fluxes]\n\n        # Format the result for this case as [growth, a1, a2, ..., a6]\n        case_result = [growth] + activity\n        results.append(case_result)\n    \n    # Format the final output string as a list of lists.\n    # The map(str, ...) will convert each inner list to its string representation.\n    # The ','.join(...) will join these strings with commas.\n    # The f-string will add the outer brackets.\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "真实的生物系统通常涉及复杂的遗传关系，例如由多个亚基组成的酶（AND逻辑）或提供功能冗余的同工酶（OR逻辑）。本练习  专门训练如何将这些复杂的布尔GPR规则转化为对反应通量的数学约束。掌握这一步对于精确模拟基因敲除的影响至关重要。",
            "id": "3313638",
            "problem": "给定一个玩具代谢网络，要求您在稳态通量平衡分析下，预测基因敲除对反应活性和最大可达生物质生成速率的影响。其基本依据是细胞内代谢物的准稳态假设、线性稳态约束 $S v = 0$（其中 $S$ 是化学计量矩阵，$v$ 是反应通量向量），以及使用被解释为布尔逻辑的基因-蛋白质-反应（GPR）规则，将基因敲除映射到反应的可用性。“与”门表示催化需要所有基因，而“或”门表示任何一个基因都足够。没有功能性催化剂的反应必须通过将其上下限均设置为零来禁用。\n\n该网络包含内部代谢物 $A$、$B$ 和 $C$，以及一个生物质汇。这些反应是：\n\n- $R_1$ 通量为 $v_1$：$\\varnothing \\rightarrow A$（摄取/转运），界限为 $0 \\le v_1 \\le 8$，GPR 为 $g_{11}$。\n- $R_2$ 通量为 $v_2$：$A \\rightarrow 2 B$，界限为 $0 \\le v_2 \\le 1000$，GPR 为 $\\big( g_1 \\land g_2 \\big) \\lor g_3$。\n- $R_3$ 通量为 $v_3$：$B \\rightarrow C$，界限为 $0 \\le v_3 \\le 1000$，GPR 为 $g_4 \\land \\big( g_5 \\lor g_6 \\big)$。\n- $R_4$ 通量为 $v_4$：$C \\rightarrow \\mathrm{Biomass}$，界限为 $0 \\le v_4 \\le 1000$，GPR 为 $g_7$。\n- $R_5$ 通量为 $v_5$：$A \\rightarrow C$，界限为 $0 \\le v_5 \\le 1000$，GPR 为 $g_2 \\land g_8$。\n- $R_6$ 通量为 $v_6$：$2 B \\rightarrow \\mathrm{Biomass}$，界限为 $0 \\le v_6 \\le 1000$，GPR 为 $g_9 \\lor g_{10}$。\n\n内部代谢物的稳态质量平衡由上述化学计量关系隐含，并由以下公式给出：\n- $A$：$v_1 - v_2 - v_5 = 0$，\n- $B$：$2 v_2 - v_3 - 2 v_6 = 0$，\n- $C$：$v_3 + v_5 - v_4 = 0$。\n\n目标是最大化生物质生成速率，定义为 $v_{\\mathrm{bio}} = v_4 + v_6$。\n\n执行双基因敲除：$g_2$ 和 $g_{10}$ 被敲除。所有其他基因均存在且功能正常。\n\n任务：\n1. 使用GPR规则，确定哪些反应因此次敲除而被禁用，并相应地更新每个 $i \\in \\{1,2,3,4,5,6\\}$ 的界限 $l_i \\le v_i \\le u_i$。被禁用的反应必须满足 $l_i = u_i = 0$。\n2. 使用更新后的界限和稳态约束 $S v = 0$，在通量平衡分析下求解最大生物质生成速率 $v_{\\mathrm{bio}}^{\\star}$。请以单个实数的形式提供您的最终答案。无需四舍五入，也无需单位。",
            "solution": "该问题要求在特定基因敲除情景下，对代谢网络进行两步分析。首先，我们必须评估基因-蛋白质-反应（GPR）规则，以确定哪些反应被禁用。其次，我们必须使用更新后的反应约束进行通量平衡分析（FBA），以找到最大生物质生成速率。\n\n**第一步：GPR评估与更新反应界限**\n\n问题指定了基因 $g_2$ 和 $g_{10}$ 的双基因敲除。在GPR的布尔逻辑中，被敲除的基因对应于逻辑值 `FALSE`（用 $0$ 表示），而功能正常的基因对应于 `TRUE`（用 $1$ 表示）。除 $g_2$ 和 $g_{10}$ 外的所有基因都是功能正常的。我们对每个反应的GPR进行评估：\n\n- **反应 $R_1$**：GPR为 $g_{11}$。由于 $g_{11}$ 功能正常，其值为 $1$。该规则评估为 `TRUE`。$R_1$ 处于活动状态。界限保持为 $0 \\le v_1 \\le 8$。\n- **反应 $R_2$**：GPR为 $(g_1 \\land g_2) \\lor g_3$。当 $g_1=1$, $g_2=0$, $g_3=1$ 时，表达式变为 $(1 \\land 0) \\lor 1 = 0 \\lor 1 = 1$。该规则评估为 `TRUE`。$R_2$ 处于活动状态。界限保持为 $0 \\le v_2 \\le 1000$。这个GPR代表一个反应，该反应可由需要 $g_1$ 和 $g_2$ 的酶复合物催化，或者由来自 $g_3$ 的同工酶催化。$g_2$ 的敲除禁用了该酶复合物，但来自 $g_3$ 的同工酶使得该反应能够进行。\n- **反应 $R_3$**：GPR为 $g_4 \\land (g_5 \\lor g_6)$。这些基因都没有被敲除，所以 $g_4=1$, $g_5=1$, $g_6=1$。表达式为 $1 \\land (1 \\lor 1) = 1$。该规则评估为 `TRUE`。$R_3$ 处于活动状态。界限保持为 $0 \\le v_3 \\le 1000$。\n- **反应 $R_4$**：GPR为 $g_7$。基因 $g_7$ 功能正常（$1$）。该规则评估为 `TRUE`。$R_4$ 处于活动状态。界限保持为 $0 \\le v_4 \\le 1000$。\n- **反应 $R_5$**：GPR为 $g_2 \\land g_8$。当 $g_2=0$ 和 $g_8=1$ 时，表达式为 $0 \\land 1 = 0$。该规则评估为 `FALSE`。$R_5$ 被禁用。其界限更新为 $l_5 = u_5 = 0$，这意味着 $v_5=0$。这是因为该酶需要来自 $g_2$ 和 $g_8$ 的基因产物。\n- **反应 $R_6$**：GPR为 $g_9 \\lor g_{10}$。当 $g_9=1$ 和 $g_{10}=0$ 时，表达式为 $1 \\lor 0 = 1$。该规则评估为 `TRUE`。$R_6$ 处于活动状态。界限保持为 $0 \\le v_6 \\le 1000$。该反应可由来自 $g_9$ 的酶或来自 $g_{10}$ 的同工酶催化。由于 $g_9$ 功能正常，该反应得以进行。\n\n总而言之，唯一被敲除禁用的反应是 $R_5$。约束 $v_5=0$ 必须被纳入模型中。\n\n**第二步：通量平衡分析**\n\n目标是在稳态质量平衡约束和更新后的通量界限下，最大化生物质生成速率 $v_{\\mathrm{bio}} = v_4 + v_6$。\n\n线性规划问题是：\n最大化 $Z = v_4 + v_6$\n约束条件：\n1. $v_1 - v_2 - v_5 = 0$（代谢物 $A$ 平衡）\n2. $2 v_2 - v_3 - 2 v_6 = 0$（代谢物 $B$ 平衡）\n3. $v_3 + v_5 - v_4 = 0$（代谢物 $C$ 平衡）\n以及界限：\n- $0 \\le v_1 \\le 8$\n- $0 \\le v_2 \\le 1000$\n- $0 \\le v_3 \\le 1000$\n- $0 \\le v_4 \\le 1000$\n- $v_5 = 0$\n- $0 \\le v_6 \\le 1000$\n\n我们首先将敲除约束 $v_5=0$ 代入质量平衡方程：\n1. $v_1 - v_2 = 0 \\implies v_1 = v_2$\n2. $2 v_2 - v_3 - 2 v_6 = 0$\n3. $v_3 - v_4 = 0 \\implies v_3 = v_4$\n\n该系统可以简化。从(1)可知，$v_1$ 的约束（$0 \\le v_1 \\le 8$）直接转化为对 $v_2$ 的更严格约束，即 $0 \\le v_2 \\le 8$。原来的界限 $0 \\le v_2 \\le 1000$ 被取代。\n\n我们可以用一组独立通量来表示目标函数和其他变量。我们选择 $v_2$ 和 $v_6$。\n从(3)可知，$v_4 = v_3$。\n从(2)可知，$v_3 = 2 v_2 - 2 v_6$。\n因此，$v_4 = 2 v_2 - 2 v_6$。\n\n目标函数 $Z = v_4 + v_6$ 可以重写为：\n$Z = (2 v_2 - 2 v_6) + v_6 = 2 v_2 - v_6$。\n\n现在我们用 $v_2$ 和 $v_6$ 来重新表述问题：\n最大化 $Z(v_2, v_6) = 2 v_2 - v_6$\n受 $v_2$ 和 $v_6$ 的约束。这些约束来自于通量界限。\n- $0 \\le v_2 \\le 8$（由 $v_1=v_2$ 和 $0 \\le v_1 \\le 8$ 得出）\n- $0 \\le v_6 \\le 1000$（原始界限）\n- 所有通量必须为非负。由于所有下限均为 $0$，我们必须确保依赖通量的表达式为非负。\n    - $v_1 = v_2 \\ge 0$（由 $v_2 \\ge 0$ 保证）\n    - $v_3 = 2 v_2 - 2 v_6 \\ge 0 \\implies 2 v_2 \\ge 2 v_6 \\implies v_2 \\ge v_6$\n    - $v_4 = v_3 \\ge 0$（相同的条件，$v_2 \\ge v_6$）\n\n因此，简化的约束条件是：\n1. $0 \\le v_2 \\le 8$\n2. $0 \\le v_6 \\le v_2$\n3. $0 \\le v_6 \\le 1000$\n\n条件 $0 \\le v_6 \\le v_2$ 与 $v_2 \\le 8$ 相结合，意味着 $v_6 \\le 8$。这对 $v_6$ 来说是一个比 $v_6 \\le 1000$ 更严格的约束。\n问题简化为：\n最大化 $Z(v_2, v_6) = 2 v_2 - v_6$\n约束条件：\n- $0 \\le v_2 \\le 8$\n- $0 \\le v_6 \\le v_2$\n\n这是一个在 $(v_2, v_6)$ 平面上的多边形可行域上的线性规划问题。目标函数的最大值必定出现在该区域的某个顶点上。顶点由边界线的交点给出：\n- $v_2=0, v_6=0 \\implies (0, 0)$\n- $v_2=8, v_6=0 \\implies (8, 0)$\n- $v_2=8, v_6=v_2 \\implies (8, 8)$\n\n我们在每个顶点处评估目标函数 $Z = 2 v_2 - v_6$：\n- 在 $(v_2, v_6) = (0, 0)$ 处：$Z = 2(0) - 0 = 0$。\n- 在 $(v_2, v_6) = (8, 0)$ 处：$Z = 2(8) - 0 = 16$。\n- 在 $(v_2, v_6) = (8, 8)$ 处：$Z = 2(8) - 8 = 16 - 8 = 8$。\n\n目标函数的最大值是 $16$。这就是最大生物质生成速率 $v_{\\mathrm{bio}}^{\\star}$。\n该最大值通过以下通量向量实现：\n- $v_2 = 8$\n- $v_6 = 0$\n- $v_1 = v_2 = 8$\n- $v_3 = 2(8) - 2(0) = 16$\n- $v_4 = v_3 = 16$\n- $v_5 = 0$\n生物质生成速率为 $v_{\\mathrm{bio}} = v_4 + v_6 = 16 + 0 = 16$。\n所有通量值都在其各自的界限内，因此该解是可行的。例如，$0 \\le v_3 = 16 \\le 1000$ 且 $0 \\le v_4 = 16 \\le 1000$。\n\n最大生物质生成速率是 $16$。",
            "answer": "$$ \\boxed{16} $$"
        },
        {
            "introduction": "在掌握了基础知识之后，我们现在可以将所学技能应用于系统生物学和药物发现中的一个重要问题：识别合成致死相互作用。本练习  要求您系统地进行计算机内的单基因和双基因敲除，并利用FBA结果筛选出那些单独敲除时非必需、但同时敲除时却致命的基因对。这展示了代谢模型在揭示非显而易见的遗传脆弱性方面的强大能力。",
            "id": "3313719",
            "problem": "给定一个用于通过通量平衡分析 (FBA) 探究基因必需性的玩具代谢网络。通量平衡分析 (FBA) 由稳态质量平衡约束 $S \\, v = 0$（其中 $S$ 是化学计量矩阵，$v$ 是反应通量向量）、边界约束 $l \\le v \\le u$ 以及一个要最大化的线性目标（此处为生物量通量）共同定义。基因必需性通过基因-蛋白质-反应 (GPR) 逻辑进行评估，该逻辑将基因敲除映射到反应失活。如果一对基因中的每个单基因敲除在指定的生存阈值下都是非致死的，但双基因敲除在指定的致死阈值下是致死的，则这对基因是合成致死的。\n\n考虑以下具有平行同工酶和旁路途径的化学计量平衡、生物学上合理的玩具网络。内部代谢物为 $A$、$B$、$C$ 和 $D$。反应（按顺序）为：\n- 源摄取 $R_{\\text{src}}$: $\\varnothing \\rightarrow A$。\n- 同工酶分支步骤 $R_{2a}$: $A \\rightarrow B$。\n- 同工酶分支步骤 $R_{2b}$: $A \\rightarrow B$。\n- 主分支转化 $R_{3}$: $B \\rightarrow C$。\n- 旁路进入 $R_{4}$: $A \\rightarrow D$。\n- 旁路转化 $R_{5}$: $D \\rightarrow C$。\n- 生物量反应 $R_{\\text{bio}}$: $C \\rightarrow \\varnothing$。\n\n设化学计量矩阵 $S \\in \\mathbb{R}^{4 \\times 7}$ 定义在行 $(A,B,C,D)$ 和列 $(R_{\\text{src}}, R_{2a}, R_{2b}, R_{3}, R_{4}, R_{5}, R_{\\text{bio}})$ 上，如下所示：\n$$\nS =\n\\begin{bmatrix}\n+1  -1  -1  0  -1  0  0 \\\\\n0  +1  +1  -1  0  0  0 \\\\\n0  0  0  +1  0  +1  -1 \\\\\n0  0  0  0  +1  -1  0 \\\\\n\\end{bmatrix}.\n$$\n\n除非另有说明，反应边界遵循标准的不可逆常规。在所有情况下，对所有反应施加下界 $l_j = 0$。上界 $u_j$ 为：\n- $u_{\\text{src}} = 10$，\n- $u_{2a} = 1000$, $u_{2b} = 1000$，\n- $u_{3} = 1000$，\n- $u_{4} = U_{\\text{bypass}}$，\n- $u_{5} = U_{\\text{bypass}}$，\n- $u_{\\text{bio}} = 1000$。\n\n生物量目标是最大化 $v_{\\text{bio}}$。\n\n基因-蛋白质-反应 (GPR) 关联如下：\n- $R_{2a}$ 需要基因 $g_1$，\n- $R_{2b}$ 需要基因 $g_2$，\n- $R_{3}$ 需要基因 $g_3$，\n- $R_{4}$ 需要基因 $g_4$，\n- $R_{5}$ 需要基因 $g_5$，\n- $R_{\\text{src}}$ 和 $R_{\\text{bio}}$ 没有基因要求。\n\n基因敲除通过将其上界设置为 $0$ 来使任何 GPR 未满足的反应失活。同工酶 $R_{2a}$ 和 $R_{2b}$ 在反应层面实现“或”逻辑：每个反应都有自己的基因，因此敲除一个基因会使另一个反应仍然可用。\n\n设野生型生物量通量 $v_{\\text{bio}}^{\\text{WT}}$ 为在给定边界下且无基因敲除时的最优目标值。对于单基因敲除 $g$，设 $v_{\\text{bio}}^{\\{g\\}}$ 为最优生物量通量；对于双基因敲除 $\\{g_i,g_j\\}$，设 $v_{\\text{bio}}^{\\{g_i,g_j\\}}$ 为最优生物量通量。定义两个相对于野生型的阈值：一个非致死生存阈值 $\\alpha \\in [0,1]$ 和一个致死阈值 $\\beta \\in [0,1]$，其中 $\\beta \\ll 1$。当且仅当 $v_{\\text{bio}}^{\\{g_i\\}} \\ge \\alpha \\, v_{\\text{bio}}^{\\text{WT}}$ 和 $v_{\\text{bio}}^{\\{g_j\\}} \\ge \\alpha \\, v_{\\text{bio}}^{\\text{WT}}$ 同时成立，且 $v_{\\text{bio}}^{\\{g_i,g_j\\}}  \\beta \\, v_{\\text{bio}}^{\\text{WT}}$ 时，双基因敲除 $\\{g_i,g_j\\}$ 是合成致死的。\n\n您的任务是编写一个完整的程序，该程序：\n1. 使用上述矩阵 $S$ 和边界以及最大化 $v_{\\text{bio}}$ 的目标，为基因集 $\\{g_1,g_2,g_3,g_4,g_5\\}$ 上的野生型、所有单基因敲除和所有双基因敲除求解 FBA 线性规划问题。\n2. 在基因敲除下应用 GPR 逻辑，将被敲除基因所需反应的上界置零。\n3. 对于下方的每个测试用例，计算合成致死基因对的数量，其中测试用例指定了 $(U_{\\text{bypass}}, \\alpha, \\beta)$。\n4. 生成所需的输出格式。\n\n假设所有通量都使用任意一致的单位；无需进行物理单位转换。不使用角度。所有与阈值的数值比较都应严格按照所述执行。\n\n测试套件：\n- 情况 $1$：$(U_{\\text{bypass}}, \\alpha, \\beta) = (1000, 0.9, 1 \\times 10^{-9})$。\n- 情况 $2$：$(U_{\\text{bypass}}, \\alpha, \\beta) = (4, 0.6, 1 \\times 10^{-9})$。\n- 情况 $3$：$(U_{\\text{bypass}}, \\alpha, \\beta) = (6, 0.5, 1 \\times 10^{-9})$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个方括号括起来的逗号分隔列表（例如，“[r1,r2,r3]”），每个条目是相应测试用例的合成致死对的整数计数，顺序与上面列出的顺序相同。",
            "solution": "该问题要求我们使用通量平衡分析 (FBA) 在给定的玩具代谢网络中识别并计数合成致死基因对。如果基因 $g_i$ 和基因 $g_j$ 的单独敲除都是非致死的，但同时敲除两个基因是致死的，则基因对 $\\{g_i, g_j\\}$ 被定义为合成致死。这是通过将预测的最大生物量生产速率与相对于野生型生物体的指定阈值进行比较来确定的。\n\n该方法的核心是 FBA，这是一种基于约束的建模技术，用于预测代谢通量分布。FBA 被表述为一个线性规划 (LP) 问题。其基本假设是代谢网络在伪稳态下运行，意味着内部代谢物的浓度不随时间变化。这导致了质量平衡约束：\n$$S v = 0$$\n其中 $S \\in \\mathbb{R}^{m \\times n}$ 是 $m$ 个代谢物和 $n$ 个反应的化学计量矩阵，$v \\in \\mathbb{R}^n$ 是反应通量向量。\n\n解空间进一步受到热力学和容量限制的约束，这些限制表示为每个通量 $v_j$ 的下界和上界：\n$$l_j \\le v_j \\le u_j$$\n在这个通量分布的可行空间（一个凸多胞体）内，FBA 假设细胞的运作是为了优化一个特定的生物学目标，该目标由一个线性目标函数 $Z = c^T v$ 表示。对于这个问题，目标是最大化生物量生产速率 $v_{\\text{bio}}$。最大化函数 $Z$ 等同于最小化 $-Z$。因此，LP 问题是：\n$$\n\\begin{array}{ll}\n\\text{minimize}  -c^T v \\\\\n\\text{subject to}  S v = 0 \\\\\n l \\le v \\le u\n\\end{array}\n$$\n在这里，目标向量 $c$ 是一个零向量，在对应于生物量反应通量 $v_{\\text{bio}}$ 的位置上为 $1$。\n\n基因敲除的模拟是通过基因-蛋白质-反应 (GPR) 关联来介导的。所提供的 GPR 规则说明了特定反应激活需要哪个基因。基因敲除的模拟方法是，将相应反应通量的上界设置为 $0$，从而有效地将其从网络中移除。例如，敲除反应 $R_{2a}$ 所需的基因 $g_1$，是通过将上界 $u_{2a}$ 设置为 $0$ 来建模的。\n\n为解决每个给定测试用例 $(U_{\\text{bypass}}, \\alpha, \\beta)$ 的问题，总体算法按一个结构化的、多步骤的模拟过程进行：\n\n$1$. **野生型模拟：** 首先，我们为没有基因敲除的野生型生物体求解 FBA 问题。下界 $l_j$ 全部为 $0$，上界 $u_j$ 设置为其默认值，其中 $u_{4}$ 和 $u_{5}$（旁路反应）使用测试用例指定的 $U_{\\text{bypass}}$。求解此 LP 问题得到最大野生型生物量通量 $v_{\\text{bio}}^{\\text{WT}}$，它将作为所有后续比较的参考。\n\n$2$. **单基因敲除模拟：** 接下来，我们遍历基因集 $\\{g_1, g_2, g_3, g_4, g_5\\}$ 中的每个基因 $g_i$。对于每个基因，我们通过创建一组新的通量边界来模拟其敲除，其中与 $g_i$ 相关联的反应的上界被设置为 $0$。然后我们用这些修改后的边界求解 FBA 问题，以获得最大生物量通量 $v_{\\text{bio}}^{\\{g_i\\}}$。对所有 $5$ 个基因重复此过程。\n\n$3$. **识别合成致死对：** 我们遍历来自 $5$ 个基因集合的所有唯一基因对 $\\{g_i, g_j\\}$。对于每一对，我们应用合成致死的定义：\n    a. **生存能力检查：** 我们首先检查单基因敲除是否为非致死。如果 $v_{\\text{bio}}^{\\{g_i\\}} \\ge \\alpha \\, v_{\\text{bio}}^{\\text{WT}}$ 和 $v_{\\text{bio}}^{\\{g_j\\}} \\ge \\alpha \\, v_{\\text{bio}}^{\\text{WT}}$ 都满足，则此条件成立。如果任一条件不满足，则该对不是合成致死的，我们继续处理下一对。\n    b. **致死性检查：** 如果两个单基因敲除都具有生存能力，我们接着模拟双基因敲除。创建一个新的边界集，其中与 $g_i$ 和 $g_j$ 两个基因相关的所有反应的上界都设置为 $0$。用这些边界求解 FBA 问题，以找到双敲除生物量通量 $v_{\\text{bio}}^{\\{g_i,g_j\\}}$。\n    c. **分类：** 如果双敲除生物量低于致死阈值：$v_{\\text{bio}}^{\\{g_i,g_j\\}}  \\beta \\, v_{\\text{bio}}^{\\text{WT}}$，则该对 $\\{g_i, g_j\\}$ 被分类为合成致死。如果满足此条件，合成致死对的计数器加一。\n\n对三个测试用例中的每一个都执行这整个过程，并记录每个情况下的合成致死对的最终整数计数。该实现使用 `scipy.optimize.linprog` 来求解构成的 LP 问题。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\nfrom itertools import combinations\n\ndef solve():\n    \"\"\"\n    Solves the FBA problem to find synthetic lethal gene pairs for a toy metabolic network.\n    \"\"\"\n\n    # Define the problem structure as given in the problem statement.\n    # Stoichiometric matrix S for metabolites (A, B, C, D) and reactions\n    # (R_src, R_2a, R_2b, R_3, R_4, R_5, R_bio).\n    S = np.array([\n        [1., -1., -1., 0., -1., 0., 0.],  # Metabolite A\n        [0., 1., 1., -1., 0., 0., 0.],   # Metabolite B\n        [0., 0., 0., 1., 0., 1., -1.],  # Metabolite C\n        [0., 0., 0., 0., 1., -1., 0.]    # Metabolite D\n    ])\n\n    # Genes and their associated reaction indices (0-indexed).\n    genes = ['g1', 'g2', 'g3', 'g4', 'g5']\n    gpr = {\n        'g1': [1],  # R_2a\n        'g2': [2],  # R_2b\n        'g3': [3],  # R_3\n        'g4': [4],  # R_4\n        'g5': [5]   # R_5\n    }\n\n    # Test cases from the problem statement: (U_bypass, alpha, beta)\n    test_cases = [\n        (1000., 0.9, 1e-9),\n        (4., 0.6, 1e-9),\n        (6., 0.5, 1e-9)\n    ]\n\n    def solve_fba(current_bounds):\n        \"\"\"\n        Solves a single FBA linear program.\n        \"\"\"\n        # Objective: maximize v_bio (last flux).\n        # linprog minimizes, so we minimize -v_bio.\n        num_reactions = S.shape[1]\n        c = np.zeros(num_reactions)\n        c[-1] = -1.\n\n        # Equality constraints: S*v = 0\n        A_eq = S\n        b_eq = np.zeros(S.shape[0])\n\n        # `linprog` with the 'highs' solver is robust and suitable.\n        res = linprog(c, A_eq=A_eq, b_eq=b_eq, bounds=current_bounds, method='highs')\n\n        if res.success:\n            # The result `res.fun` is the minimum of -v_bio.\n            # Negating it gives the maximum v_bio.\n            max_biomass = -res.fun\n            # Clamp values very close to zero to handle floating point inaccuracies.\n            if abs(max_biomass)  1e-12:\n                return 0.0\n            return max_biomass\n        else:\n            # If the solver fails (e.g., infeasible), biomass production is zero.\n            return 0.0\n\n    final_results = []\n    \n    for U_bypass, alpha, beta in test_cases:\n        # Define base upper bounds for the current test case.\n        u_base = np.array([10., 1000., 1000., 1000., U_bypass, U_bypass, 1000.])\n        l_base = np.zeros_like(u_base)\n\n        # 1. Solve for Wild-Type (WT)\n        bounds_wt = list(zip(l_base, u_base))\n        v_bio_wt = solve_fba(bounds_wt)\n\n        # If WT biomass is zero, no growth is possible, so no SL pairs exist.\n        if v_bio_wt  1e-12:\n            final_results.append(0)\n            continue\n        \n        viability_threshold = alpha * v_bio_wt\n        lethality_threshold = beta * v_bio_wt\n        \n        # 2. Solve for all single-gene knockouts\n        single_ko_biomass = {}\n        for gene in genes:\n            u_ko = u_base.copy()\n            for reaction_idx in gpr[gene]:\n                u_ko[reaction_idx] = 0.0\n            \n            bounds_ko = list(zip(l_base, u_ko))\n            single_ko_biomass[gene] = solve_fba(bounds_ko)\n\n        # 3. Identify synthetic lethal pairs\n        synthetic_lethal_count = 0\n        gene_pairs = combinations(genes, 2)\n        \n        for g1, g2 in gene_pairs:\n            # Condition 1: Both single knockouts must be viable.\n            if single_ko_biomass[g1] = viability_threshold and \\\n               single_ko_biomass[g2] = viability_threshold:\n                \n                # Simulate the double knockout.\n                u_double_ko = u_base.copy()\n                for reaction_idx in gpr[g1]:\n                    u_double_ko[reaction_idx] = 0.0\n                for reaction_idx in gpr[g2]:\n                    u_double_ko[reaction_idx] = 0.0\n                \n                bounds_double_ko = list(zip(l_base, u_double_ko))\n                v_bio_double = solve_fba(bounds_double_ko)\n                \n                # Condition 2: The double knockout must be lethal.\n                if v_bio_double  lethality_threshold:\n                    synthetic_lethal_count += 1\n                    \n        final_results.append(synthetic_lethal_count)\n        \n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```"
        }
    ]
}