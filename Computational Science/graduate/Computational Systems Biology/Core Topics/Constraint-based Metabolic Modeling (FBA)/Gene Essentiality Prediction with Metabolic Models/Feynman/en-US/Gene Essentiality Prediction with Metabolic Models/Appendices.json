{
    "hands_on_practices": [
        {
            "introduction": "The foundation of predicting gene essentiality lies in understanding and implementing Flux Balance Analysis (FBA). This first practice guides you through the core computational task: translating a metabolic network's stoichiometry, reaction bounds, and gene-protein-reaction (GPR) rules into a solvable linear program. By building a basic FBA simulator for a toy model , you will gain hands-on experience with the fundamental mechanics of constraint-based modeling.",
            "id": "3313723",
            "problem": "Consider a toy genome-scale metabolic model expressed in a steady-state formalism. The model includes a set of internal metabolites and reactions, a stoichiometric matrix, reaction bounds, and a biomass objective function. Your task is to compute the optimal growth rate using Flux Balance Analysis (FBA) and identify which reactions carry nonzero flux at the optimum. The fundamental base for the derivation is the steady-state mass balance assumption and linear constraints on fluxes.\n\nThe internal metabolites are $m = \\{ \\text{glc}, \\text{pyr} \\}$, corresponding to glucose and pyruvate. The reactions $n = \\{ v_1, v_2, v_3, v_4, v_5, v_6 \\}$ are defined as follows in biochemical intent, but you must solve in purely mathematical terms:\n- $v_1$: Glucose uptake (imports glucose into the system).\n- $v_2$: Glucose conversion to pyruvate.\n- $v_3$: Pyruvate conversion into biomass.\n- $v_4$: Glucose conversion to a waste sink.\n- $v_5$: Pyruvate conversion to a waste sink.\n- $v_6$: Direct glucose conversion into biomass via an alternative route.\n\nThe steady-state stoichiometric matrix $S \\in \\mathbb{R}^{2 \\times 6}$, ordered by metabolites $(\\text{glc}, \\text{pyr})$ and reactions $(v_1,\\dots,v_6)$, is given explicitly as\n$$\nS =\n\\begin{bmatrix}\n+1 & -1 & 0 & -1 & 0 & -1 \\\\\n0 & +2 & -1 & 0 & -1 & 0\n\\end{bmatrix}.\n$$\nThe steady-state mass balance constraints are $S \\, \\mathbf{v} = \\mathbf{0}$, where $\\mathbf{v} \\in \\mathbb{R}^6$ is the vector of reaction fluxes ordered as $(v_1,\\dots,v_6)$.\n\nThe default lower and upper bounds for reaction fluxes are\n$$\n\\ell = \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{bmatrix}, \\quad\nu = \\begin{bmatrix} 10 \\\\ 100 \\\\ 100 \\\\ 100 \\\\ 100 \\\\ 100 \\end{bmatrix}.\n$$\nThe biomass objective is to maximize the linear objective\n$$\n\\max_{\\mathbf{v}} \\; \\mathbf{c}^\\top \\mathbf{v}, \\quad \\text{with} \\quad \\mathbf{c} = \\begin{bmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 0 \\\\ 0 \\\\ 1 \\end{bmatrix},\n$$\nmeaning the biomass production rate is $v_3 + v_6$.\n\nGene–protein–reaction (GPR) rules link gene deletions to reaction knockouts as follows:\n- Reaction $v_1$ requires gene $g_T$.\n- Reaction $v_2$ requires gene $g_A$.\n- Reaction $v_3$ requires gene $g_B$.\n- Reaction $v_6$ requires a protein complex encoded by an AND rule: $g_A$ AND $g_C$. If any of $g_A$ or $g_C$ is deleted, $v_6$ is disabled.\n- Reactions $v_4$ and $v_5$ have no gene requirements and remain available unless otherwise bounded.\n\nA gene deletion disables its associated reaction(s) by setting the corresponding reaction bounds to $[0, 0]$. For the AND rule on $v_6$, if any required gene is deleted, $v_6$ is disabled.\n\nYou must implement FBA by solving the linear program\n$$\n\\max_{\\mathbf{v}} \\; \\mathbf{c}^\\top \\mathbf{v} \\quad \\text{subject to} \\quad S \\mathbf{v} = \\mathbf{0}, \\quad \\ell \\le \\mathbf{v} \\le u.\n$$\nWhen determining which reactions carry nonzero flux at the optimum, treat any flux with magnitude strictly greater than $\\varepsilon = 10^{-9}$ as nonzero.\n\nTest Suite:\nEvaluate the model under the following parameter sets. Each test case consists of a set of deleted genes and, optionally, a modified upper bound for $v_1$ (glucose uptake). If a modified upper bound is specified, it replaces the default bound for that test case; otherwise, use the default.\n- Test case $1$: Deleted genes $= \\varnothing$; modified $v_1$ upper bound unspecified.\n- Test case $2$: Deleted genes $= \\{ g_A \\}$; modified $v_1$ upper bound unspecified.\n- Test case $3$: Deleted genes $= \\{ g_B \\}$; modified $v_1$ upper bound unspecified.\n- Test case $4$: Deleted genes $= \\{ g_C \\}$; modified $v_1$ upper bound unspecified.\n- Test case $5$: Deleted genes $= \\{ g_T \\}$; modified $v_1$ upper bound unspecified.\n- Test case $6$: Deleted genes $= \\varnothing$; modified $v_1$ upper bound $= 3$.\n- Test case $7$: Deleted genes $= \\{ g_B \\}$; modified $v_1$ upper bound $= 3$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output a flat list of numbers in the form\n$$\n[\\; \\text{growth},\\; a_1,\\; a_2,\\; a_3,\\; a_4,\\; a_5,\\; a_6 \\;],\n$$\nwhere $\\text{growth}$ is the optimal objective value $\\mathbf{c}^\\top \\mathbf{v}$ as a real number, and $a_i$ is an activity indicator for reaction $v_i$ defined as $a_i = 1$ if $|v_i| > \\varepsilon$ and $a_i = 0$ otherwise. Aggregate these per-test-case lists into a single top-level list in the order of the test suite. For example,\n$$\n\\big[ \\; [\\text{growth}_1,a_{1,1},\\dots,a_{1,6}],\\; [\\text{growth}_2,a_{2,1},\\dots,a_{2,6}],\\; \\dots \\; \\big].\n$$",
            "solution": "The problem requires the implementation of Flux Balance Analysis (FBA) to predict the optimal growth rate and active metabolic fluxes for a toy metabolic model under several genetic and environmental conditions. The problem is well-posed, scientifically grounded in the principles of computational systems biology, and provides all necessary data for a unique solution.\n\nFlux Balance Analysis (FBA) is a mathematical method used to predict metabolic flux distributions in a biological system at steady state. It relies on the principle of mass conservation, which dictates that for a system in a steady state, the production rate of each internal metabolite must equal its consumption rate. This is expressed by the matrix equation $S \\mathbf{v} = \\mathbf{0}$, where $S$ is the stoichiometric matrix, and $\\mathbf{v}$ is the vector of reaction fluxes.\n\nThe set of all flux vectors $\\mathbf{v}$ that satisfy the steady-state condition and the thermodynamic and capacity constraints (reaction bounds $\\ell \\le \\mathbf{v} \\le u$) forms a feasible solution space. FBA finds a particular flux distribution within this space that maximizes or minimizes a given metabolic objective, which is formulated as a linear objective function $\\mathbf{c}^\\top \\mathbf{v}$. The problem is thus a Linear Program (LP):\n$$\n\\max_{\\mathbf{v}} \\; \\mathbf{c}^\\top \\mathbf{v} \\quad \\text{subject to} \\quad S \\mathbf{v} = \\mathbf{0}, \\quad \\ell \\le \\mathbf{v} \\le u.\n$$\nTo solve this maximization problem using a standard LP solver that performs minimization, we reformulate it as minimizing the negative of the objective function:\n$$\n\\min_{\\mathbf{v}} \\; (-\\mathbf{c}^\\top) \\mathbf{v} \\quad \\text{subject to} \\quad S \\mathbf{v} = \\mathbf{0}, \\quad \\ell \\le \\mathbf{v} \\le u.\n$$\n\nThe components of the LP are defined as:\n- Stoichiometric matrix $S$:\n$$\nS =\n\\begin{bmatrix}\n+1 & -1 & 0 & -1 & 0 & -1 \\\\\n0 & +2 & -1 & 0 & -1 & 0\n\\end{bmatrix}\n$$\n- Objective vector $\\mathbf{c}$ for maximizing biomass ($v_3 + v_6$):\n$$\n\\mathbf{c} = [0, 0, 1, 0, 0, 1]^\\top\n$$\n- Default bounds: $\\ell = [0, 0, 0, 0, 0, 0]^\\top$ and $u = [10, 100, 100, 100, 100, 100]^\\top$.\n\nGene-protein-reaction (GPR) rules are applied by modifying the flux bounds. If a gene deletion disables a reaction $v_i$, its lower and upper bounds are both set to $0$, effectively removing it from the network ($v_i=0$).\n\nThe analysis proceeds by constructing and solving the LP for each of the seven test cases.\n\n**Test Case 1: Wild Type (no deletions, default glucose uptake)**\n- **Conditions**: Deleted genes $\\varnothing$; $v_1$ upper bound is the default, $10$.\n- **Analysis**: The system can use two pathways to produce biomass: $v_1 \\to v_2 \\to v_3$ or $v_1 \\to v_6$. The biomass objective is $v_3+v_6$. The mass balance equations are $v_1 = v_2 + v_4 + v_6$ and $2v_2 = v_3 + v_5$. To maximize growth, waste fluxes $v_4$ and $v_5$ are minimized to $0$. The constraints become $v_1 = v_2 + v_6$ and $2v_2=v_3$. The objective $v_3+v_6$ can be rewritten in terms of inputs as $2v_1 - v_6$. To maximize this, $v_1$ should be maximal ($10$) and $v_6$ minimal ($0$). This yields $v_1=10$, $v_2=10$, $v_3=20$, and other fluxes are $0$.\n- **Result**: Optimal growth is $20.0$. Active fluxes are $v_1, v_2, v_3$.\n\n**Test Case 2: Gene $g_A$ deletion**\n- **Conditions**: Deleted genes $\\{g_A\\}$; default glucose uptake.\n- **Analysis**: Gene $g_A$ is required for reactions $v_2$ and $v_6$. Deleting $g_A$ sets the bounds for $v_2$ and $v_6$ to $[0,0]$, forcing $v_2=0$ and $v_6=0$. The mass balance equations become $v_1 - v_4 = 0$ and $-v_3 - v_5 = 0$. Since all fluxes must be non-negative, the second equation implies $v_3=0$ and $v_5=0$. As both biomass-producing reactions $v_3$ and $v_6$ are zero, the objective value is $0$.\n- **Result**: Optimal growth is $0.0$. No reactions producing biomass can be active, and a minimal flux solution is $\\mathbf{v}=\\mathbf{0}$.\n\n**Test Case 3: Gene $g_B$ deletion**\n- **Conditions**: Deleted genes $\\{g_B\\}$; default glucose uptake.\n- **Analysis**: Gene $g_B$ is required for $v_3$, so $v_3=0$. The objective becomes maximizing $v_6$. The constraints (with waste fluxes set to $0$) are $v_1 = v_2 + v_6$ and $2v_2=0$, which implies $v_2=0$. The first constraint simplifies to $v_1 = v_6$. To maximize $v_6$, we must maximize $v_1$, which is limited to $10$. Thus, $v_1=10, v_6=10$.\n- **Result**: Optimal growth is $10.0$. Active fluxes are $v_1, v_6$.\n\n**Test Case 4: Gene $g_C$ deletion**\n- **Conditions**: Deleted genes $\\{g_C\\}$; default glucose uptake.\n- **Analysis**: Gene $g_C$ is required for $v_6$ due to the AND rule ($g_A$ AND $g_C$), so $v_6=0$. The system is forced to use the $v_1 \\to v_2 \\to v_3$ pathway. This is equivalent to the wild-type case where the optimal solution already had $v_6=0$.\n- **Result**: Optimal growth is $20.0$. Active fluxes are $v_1, v_2, v_3$.\n\n**Test Case 5: Gene $g_T$ deletion**\n- **Conditions**: Deleted genes $\\{g_T\\}$; default glucose uptake.\n- **Analysis**: Gene $g_T$ is required for glucose uptake ($v_1$), so $v_1=0$. With no substrate entering the system, no metabolic activity is possible. The first mass balance equation, $-v_2 - v_4 - v_6 = 0$, with non-negativity constraints, forces $v_2, v_4, v_6$ to be $0$. This subsequently forces all other fluxes to $0$.\n- **Result**: Optimal growth is $0.0$. All fluxes are $0$.\n\n**Test Case 6: Wild Type, low glucose uptake**\n- **Conditions**: Deleted genes $\\varnothing$; $v_1$ upper bound modified to $3$.\n- **Analysis**: This case is identical to the wild-type (Case 1) but with a reduced glucose supply. The optimal strategy is the same: use the $v_1 \\to v_2 \\to v_3$ pathway. The growth is $2v_1$. With $v_1$ limited to $3$, the maximum growth is $2 \\times 3 = 6$. This requires $v_1=3, v_2=3, v_3=6$.\n- **Result**: Optimal growth is $6.0$. Active fluxes are $v_1, v_2, v_3$.\n\n**Test Case 7: Gene $g_B$ deletion, low glucose uptake**\n- **Conditions**: Deleted genes $\\{g_B\\}$; $v_1$ upper bound modified to $3$.\n- **Analysis**: This combines the conditions of Case 3 ($g_B$ deletion) and Case 6 (low glucose). The deletion of $g_B$ forces the use of the alternative biomass pathway $v_1 \\to v_6$, where $v_1=v_6$ and growth is $v_6$. With $v_1$ limited to $3$, the maximum growth is $3$. This requires $v_1=3, v_6=3$.\n- **Result**: Optimal growth is $3.0$. Active fluxes are $v_1, v_6$.\n\nThe active fluxes are determined by checking if the magnitude of a flux, $|v_i|$, is strictly greater than the tolerance $\\varepsilon = 10^{-9}$.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves a series of Flux Balance Analysis (FBA) problems for a toy metabolic model.\n    \"\"\"\n    \n    # Define model parameters\n    # Stoichiometric matrix S for metabolites (glc, pyr) and reactions (v1-v6)\n    S = np.array([\n        [1, -1, 0, -1, 0, -1],\n        [0, 2, -1, 0, -1, 0]\n    ])\n\n    # Objective vector c (maximizes v3 + v6)\n    c_max = np.array([0, 0, 1, 0, 0, 1])\n    \n    # For scipy.optimize.linprog, we minimize -c^T * v\n    c_min = -c_max\n\n    # Default lower and upper bounds for fluxes\n    l_default = np.array([0.0, 0.0, 0.0, 0.0, 0.0, 0.0])\n    u_default = np.array([10.0, 100.0, 100.0, 100.0, 100.0, 100.0])\n\n    # Right-hand side for steady-state equation Sv = 0\n    b_eq = np.array([0.0, 0.0])\n\n    # Nonzero flux tolerance\n    epsilon = 1e-9\n\n    # Define the test suite\n    test_cases = [\n        # (set of deleted genes, modified v1 upper bound or None)\n        (set(), None),\n        ({'g_A'}, None),\n        ({'g_B'}, None),\n        ({'g_C'}, None),\n        ({'g_T'}, None),\n        (set(), 3.0),\n        ({'g_B'}, 3.0)\n    ]\n\n    results = []\n    for deleted_genes, v1_upper_bound_mod in test_cases:\n        # Initialize bounds for the current test case\n        u_b = u_default.copy()\n\n        # Apply optional v1 upper bound modification\n        if v1_upper_bound_mod is not None:\n            u_b[0] = v1_upper_bound_mod\n\n        # Apply gene deletions based on GPR rules\n        # GPR: v1 <- g_T\n        if 'g_T' in deleted_genes:\n            u_b[0] = 0.0\n        # GPR: v2 <- g_A\n        if 'g_A' in deleted_genes:\n            u_b[1] = 0.0\n        # GPR: v3 <- g_B\n        if 'g_B' in deleted_genes:\n            u_b[2] = 0.0\n        # GPR: v6 <- g_A AND g_C\n        if 'g_A' in deleted_genes or 'g_C' in deleted_genes:\n            u_b[5] = 0.0\n\n        # Combine lower and upper bounds for the solver\n        bounds = list(zip(l_default, u_b))\n\n        # Solve the linear programming problem\n        # The 'highs' method is robust and recommended.\n        res = linprog(c=c_min, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs')\n        \n        # Process the results\n        if res.success:\n            # Optimal value from minimization is -growth, so negate it\n            growth = -res.fun\n            fluxes = res.x\n        else:\n            # If solver fails, assume zero growth and fluxes\n            growth = 0.0\n            fluxes = np.zeros(len(c_max))\n\n        # Ensure growth is not a small negative number close to zero\n        if abs(growth) < epsilon:\n            growth = 0.0\n        \n        # Determine which reactions carry nonzero flux\n        activity = [1 if abs(v) > epsilon else 0 for v in fluxes]\n\n        # Format the result for this case as [growth, a1, a2, ..., a6]\n        case_result = [growth] + activity\n        results.append(case_result)\n    \n    # Format the final output string as a list of lists.\n    # The map(str, ...) will convert each inner list to its string representation.\n    # The ','.join(...) will join these strings with commas.\n    # The f-string will add the outer brackets.\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "Beyond predicting the effect of a single gene deletion, a key application of metabolic models is to uncover complex genetic interactions. This practice introduces the concept of synthetic lethality, where the simultaneous loss of two non-essential genes proves fatal, a phenomenon with significant implications for drug discovery. By systematically simulating all double-gene knockouts in a network with redundant pathways , you will learn how to perform large-scale in silico screens to identify these critical interactions.",
            "id": "3313719",
            "problem": "You are given a toy metabolic network designed to probe gene essentiality via Flux Balance Analysis (FBA). Flux Balance Analysis (FBA) is defined by the steady-state mass balance constraint $S \\, v = 0$, where $S$ is the stoichiometric matrix and $v$ is the vector of reaction fluxes, together with bound constraints $l \\le v \\le u$ and a linear objective to maximize, here the biomass flux. Gene essentiality is evaluated using Gene-Protein-Reaction (GPR) logic that maps gene knockouts to reaction inactivation. A pair of genes is synthetic lethal if each single knockout is individually non-lethal under a specified viability threshold, but the double knockout is lethal under a specified lethality threshold.\n\nConsider the following stoichiometrically balanced, biologically plausible toy network with parallel isozymes and a bypass pathway. Internal metabolites are $A$, $B$, $C$, and $D$. Reactions (in order) are:\n- Source uptake $R_{\\text{src}}$: $\\varnothing \\rightarrow A$.\n- Isozyme branch step $R_{2a}$: $A \\rightarrow B$.\n- Isozyme branch step $R_{2b}$: $A \\rightarrow B$.\n- Main branch conversion $R_{3}$: $B \\rightarrow C$.\n- Bypass entry $R_{4}$: $A \\rightarrow D$.\n- Bypass conversion $R_{5}$: $D \\rightarrow C$.\n- Biomass reaction $R_{\\text{bio}}$: $C \\rightarrow \\varnothing$.\n\nLet the stoichiometric matrix $S \\in \\mathbb{R}^{4 \\times 7}$ be defined over rows $(A,B,C,D)$ and columns $(R_{\\text{src}}, R_{2a}, R_{2b}, R_{3}, R_{4}, R_{5}, R_{\\text{bio}})$ as:\n$$\nS =\n\\begin{bmatrix}\n+1 & -1 & -1 & 0 & -1 & 0 & 0 \\\\\n0 & +1 & +1 & -1 & 0 & 0 & 0 \\\\\n0 & 0 & 0 & +1 & 0 & +1 & -1 \\\\\n0 & 0 & 0 & 0 & +1 & -1 & 0 \\\\\n\\end{bmatrix}.\n$$\n\nReaction bounds follow standard irreversible conventions unless specified. For all cases, impose lower bounds $l_j = 0$ for all reactions. The upper bounds $u_j$ are:\n- $u_{\\text{src}} = 10$,\n- $u_{2a} = 1000$, $u_{2b} = 1000$,\n- $u_{3} = 1000$,\n- $u_{4} = U_{\\text{bypass}}$,\n- $u_{5} = U_{\\text{bypass}}$,\n- $u_{\\text{bio}} = 1000$.\n\nThe biomass objective is to maximize $v_{\\text{bio}}$.\n\nGene-Protein-Reaction (GPR) associations are:\n- $R_{2a}$ requires gene $g_1$,\n- $R_{2b}$ requires gene $g_2$,\n- $R_{3}$ requires gene $g_3$,\n- $R_{4}$ requires gene $g_4$,\n- $R_{5}$ requires gene $g_5$,\n- $R_{\\text{src}}$ and $R_{\\text{bio}}$ have no gene requirements.\n\nGene knockouts inactivate any reaction whose GPR is unsatisfied by setting its upper bound to $0$. The isozymes $R_{2a}$ and $R_{2b}$ implement an \"OR\" at the reaction level: each reaction has its own gene, so knocking out one gene leaves the other reaction available.\n\nLet wild-type biomass flux $v_{\\text{bio}}^{\\text{WT}}$ be the optimal objective under the given bounds and no gene knockouts. For a single gene knockout $g$, let $v_{\\text{bio}}^{\\{g\\}}$ be the optimal biomass flux; for a double knockout $\\{g_i,g_j\\}$, let $v_{\\text{bio}}^{\\{g_i,g_j\\}}$ be the optimal biomass flux. Define two thresholds relative to wild-type: a non-lethal viability threshold $\\alpha \\in [0,1]$ and a lethality threshold $\\beta \\in [0,1]$ with $\\beta \\ll 1$. A double knockout $\\{g_i,g_j\\}$ is synthetic lethal if and only if both $v_{\\text{bio}}^{\\{g_i\\}} \\ge \\alpha \\, v_{\\text{bio}}^{\\text{WT}}$ and $v_{\\text{bio}}^{\\{g_j\\}} \\ge \\alpha \\, v_{\\text{bio}}^{\\text{WT}}$, and $v_{\\text{bio}}^{\\{g_i,g_j\\}} < \\beta \\, v_{\\text{bio}}^{\\text{WT}}$.\n\nYour task is to write a complete program that:\n1. Solves the FBA linear programs for the wild-type, all single knockouts, and all double knockouts over the gene set $\\{g_1,g_2,g_3,g_4,g_5\\}$, using the above $S$ and bounds and the objective to maximize $v_{\\text{bio}}$.\n2. Applies the GPR logic under gene knockouts by zeroing upper bounds for reactions whose required gene is knocked out.\n3. For each test case below, counts the number of synthetic lethal gene pairs, where the test case specifies $(U_{\\text{bypass}}, \\alpha, \\beta)$.\n4. Produces the required output format.\n\nAssume all fluxes are in arbitrary consistent units; no physical unit conversion is needed. Angles are not used. All numerical comparisons to thresholds should be performed exactly as stated.\n\nTest suite:\n- Case $1$: $(U_{\\text{bypass}}, \\alpha, \\beta) = (1000, 0.9, 1 \\times 10^{-9})$.\n- Case $2$: $(U_{\\text{bypass}}, \\alpha, \\beta) = (4, 0.6, 1 \\times 10^{-9})$.\n- Case $3$: $(U_{\\text{bypass}}, \\alpha, \\beta) = (6, 0.5, 1 \\times 10^{-9})$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[r1,r2,r3]\"), where each entry is the integer count of synthetic lethal pairs for the corresponding test case, in the same order as listed above.",
            "solution": "The problem requires us to identify and count synthetic lethal gene pairs in a given toy metabolic network using Flux Balance Analysis (FBA). A gene pair $\\{g_i, g_j\\}$ is defined as synthetic lethal if the individual knockout of gene $g_i$ and gene $g_j$ are both non-lethal, but the simultaneous knockout of both genes is lethal. This is determined by comparing the predicted maximum biomass production rate against specified thresholds relative to the wild-type organism.\n\nThe core of the methodology is FBA, which is a constraint-based modeling technique used to predict metabolic flux distributions. FBA is formulated as a linear programming (LP) problem. The fundamental assumption is that the metabolic network operates at a pseudo-steady state, meaning the concentration of internal metabolites does not change over time. This leads to the mass balance constraint:\n$$S v = 0$$\nwhere $S \\in \\mathbb{R}^{m \\times n}$ is the stoichiometric matrix for $m$ metabolites and $n$ reactions, and $v \\in \\mathbb{R}^n$ is the vector of reaction fluxes.\n\nThe solution space is further constrained by thermodynamic and capacity limitations, which are represented as lower and upper bounds on each flux $v_j$:\n$$l_j \\le v_j \\le u_j$$\nWithin this feasible space of flux distributions (a convex polytope), FBA assumes that the cell operates to optimize a specific biological objective, which is represented by a linear objective function, $Z = c^T v$. For this problem, the objective is to maximize the biomass production rate, $v_{\\text{bio}}$. Maximizing a function $Z$ is equivalent to minimizing $-Z$. Therefore, the LP problem is:\n$$\n\\begin{array}{ll}\n\\text{minimize} & -c^T v \\\\\n\\text{subject to} & S v = 0 \\\\\n& l \\le v \\le u\n\\end{array}\n$$\nHere, the objective vector $c$ is a vector of zeros with a $1$ at the position corresponding to the biomass reaction flux $v_{\\text{bio}}$.\n\nThe simulation of gene knockouts is mediated through Gene-Protein-Reaction (GPR) associations. The provided GPR rules state which gene is required for a specific reaction to be active. A gene knockout is simulated by setting the upper bound of the corresponding reaction flux to $0$, effectively removing it from the network. For example, knocking out gene $g_1$, which is required for reaction $R_{2a}$, is modeled by setting the upper bound $u_{2a}$ to $0$.\n\nThe overall algorithm to solve the problem for each given test case $(U_{\\text{bypass}}, \\alpha, \\beta)$ proceeds in a structured, multi-step simulation process:\n\n$1$. **Wild-Type Simulation:** First, we solve the FBA problem for the wild-type organism with no gene knockouts. The lower bounds $l_j$ are all $0$, and the upper bounds $u_j$ are set to their default values, with $u_{4}$ and $u_{5}$ (the bypass reactions) using the specified $U_{\\text{bypass}}$ for the test case. Solving this LP yields the maximum wild-type biomass flux, $v_{\\text{bio}}^{\\text{WT}}$, which serves as the reference for all subsequent comparisons.\n\n$2$. **Single-Gene Knockout Simulations:** Next, we iterate through each gene $g_i$ in the set $\\{g_1, g_2, g_3, g_4, g_5\\}$. For each gene, we simulate its knockout by creating a new set of flux bounds where the upper bound for the reaction(s) associated with $g_i$ is set to $0$. We then solve the FBA problem with these modified bounds to obtain the maximum biomass flux $v_{\\text{bio}}^{\\{g_i\\}}$. This is repeated for all $5$ genes.\n\n$3$. **Identification of Synthetic Lethal Pairs:** We iterate through all unique pairs of genes $\\{g_i, g_j\\}$ from the set of $5$ genes. For each pair, we apply the definition of synthetic lethality:\n    a. **Viability Check:** We first check if the single knockouts are non-lethal. This condition is met if both $v_{\\text{bio}}^{\\{g_i\\}} \\ge \\alpha \\, v_{\\text{bio}}^{\\text{WT}}$ and $v_{\\text{bio}}^{\\{g_j\\}} \\ge \\alpha \\, v_{\\text{bio}}^{\\text{WT}}$. If either of these conditions fails, the pair is not synthetic lethal, and we proceed to the next pair.\n    b. **Lethality Check:** If both single knockouts are viable, we then simulate the double knockout. A new set of bounds is created where the upper bounds for all reactions associated with both $g_i$ and $g_j$ are set to $0$. The FBA problem is solved with these bounds to find the double-knockout biomass flux, $v_{\\text{bio}}^{\\{g_i,g_j\\}}$.\n    c. **Classification:** The pair $\\{g_i, g_j\\}$ is classified as synthetic lethal if the double-knockout biomass is below the lethality threshold: $v_{\\text{bio}}^{\\{g_i,g_j\\}} < \\beta \\, v_{\\text{bio}}^{\\text{WT}}$. If this condition is met, a counter for synthetic lethal pairs is incremented.\n\nThis entire process is performed for each of the three test cases, and the final integer count of synthetic lethal pairs for each case is recorded. The implementation uses `scipy.optimize.linprog` to solve the constituent LP problems.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\nfrom itertools import combinations\n\ndef solve():\n    \"\"\"\n    Solves the FBA problem to find synthetic lethal gene pairs for a toy metabolic network.\n    \"\"\"\n\n    # Define the problem structure as given in the problem statement.\n    # Stoichiometric matrix S for metabolites (A, B, C, D) and reactions\n    # (R_src, R_2a, R_2b, R_3, R_4, R_5, R_bio).\n    S = np.array([\n        [1., -1., -1., 0., -1., 0., 0.],  # Metabolite A\n        [0., 1., 1., -1., 0., 0., 0.],   # Metabolite B\n        [0., 0., 0., 1., 0., 1., -1.],  # Metabolite C\n        [0., 0., 0., 0., 1., -1., 0.]    # Metabolite D\n    ])\n\n    # Genes and their associated reaction indices (0-indexed).\n    genes = ['g1', 'g2', 'g3', 'g4', 'g5']\n    gpr = {\n        'g1': [1],  # R_2a\n        'g2': [2],  # R_2b\n        'g3': [3],  # R_3\n        'g4': [4],  # R_4\n        'g5': [5]   # R_5\n    }\n\n    # Test cases from the problem statement: (U_bypass, alpha, beta)\n    test_cases = [\n        (1000., 0.9, 1e-9),\n        (4., 0.6, 1e-9),\n        (6., 0.5, 1e-9)\n    ]\n\n    def solve_fba(current_bounds):\n        \"\"\"\n        Solves a single FBA linear program.\n        \"\"\"\n        # Objective: maximize v_bio (last flux).\n        # linprog minimizes, so we minimize -v_bio.\n        num_reactions = S.shape[1]\n        c = np.zeros(num_reactions)\n        c[-1] = -1.\n\n        # Equality constraints: S*v = 0\n        A_eq = S\n        b_eq = np.zeros(S.shape[0])\n\n        # `linprog` with the 'highs' solver is robust and suitable.\n        res = linprog(c, A_eq=A_eq, b_eq=b_eq, bounds=current_bounds, method='highs')\n\n        if res.success:\n            # The result `res.fun` is the minimum of -v_bio.\n            # Negating it gives the maximum v_bio.\n            max_biomass = -res.fun\n            # Clamp values very close to zero to handle floating point inaccuracies.\n            if abs(max_biomass) < 1e-12:\n                return 0.0\n            return max_biomass\n        else:\n            # If the solver fails (e.g., infeasible), biomass production is zero.\n            return 0.0\n\n    final_results = []\n    \n    for U_bypass, alpha, beta in test_cases:\n        # Define base upper bounds for the current test case.\n        u_base = np.array([10., 1000., 1000., 1000., U_bypass, U_bypass, 1000.])\n        l_base = np.zeros_like(u_base)\n\n        # 1. Solve for Wild-Type (WT)\n        bounds_wt = list(zip(l_base, u_base))\n        v_bio_wt = solve_fba(bounds_wt)\n\n        # If WT biomass is zero, no growth is possible, so no SL pairs exist.\n        if v_bio_wt < 1e-12:\n            final_results.append(0)\n            continue\n        \n        viability_threshold = alpha * v_bio_wt\n        lethality_threshold = beta * v_bio_wt\n        \n        # 2. Solve for all single-gene knockouts\n        single_ko_biomass = {}\n        for gene in genes:\n            u_ko = u_base.copy()\n            for reaction_idx in gpr[gene]:\n                u_ko[reaction_idx] = 0.0\n            \n            bounds_ko = list(zip(l_base, u_ko))\n            single_ko_biomass[gene] = solve_fba(bounds_ko)\n\n        # 3. Identify synthetic lethal pairs\n        synthetic_lethal_count = 0\n        gene_pairs = combinations(genes, 2)\n        \n        for g1, g2 in gene_pairs:\n            # Condition 1: Both single knockouts must be viable.\n            if single_ko_biomass[g1] >= viability_threshold and \\\n               single_ko_biomass[g2] >= viability_threshold:\n                \n                # Simulate the double knockout.\n                u_double_ko = u_base.copy()\n                for reaction_idx in gpr[g1]:\n                    u_double_ko[reaction_idx] = 0.0\n                for reaction_idx in gpr[g2]:\n                    u_double_ko[reaction_idx] = 0.0\n                \n                bounds_double_ko = list(zip(l_base, u_double_ko))\n                v_bio_double = solve_fba(bounds_double_ko)\n                \n                # Condition 2: The double knockout must be lethal.\n                if v_bio_double < lethality_threshold:\n                    synthetic_lethal_count += 1\n                    \n        final_results.append(synthetic_lethal_count)\n        \n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The ultimate goal of metabolic modeling often shifts from analysis to design: how can we engineer a network to achieve a desired phenotype? This advanced exercise tackles this question by framing it as a bi-level optimization problem, seeking the minimum number of gene deletions to constrain cellular growth. While the formal solution involves Mixed-Integer Linear Programming (MILP), this practice  demonstrates how to solve this design problem for smaller networks using an iterative search, providing a practical entry point into the powerful field of computational metabolic engineering.",
            "id": "3313708",
            "problem": "You are given a steady-state metabolic network and asked to construct a Mixed-Integer Linear Program (MILP) that identifies the minimum number of gene deletions required to ensure the maximum achievable biomass flux is at or below a specified threshold. The objective is to derive the MILP from first principles and to justify its correctness using linear programming dual bounds. Then, implement an algorithm that computes the minimal number of deletions for provided test networks.\n\nFundamental base:\n- The steady-state mass balance of metabolites enforces the linear constraint $S v = 0$, where $S \\in \\mathbb{R}^{m \\times n}$ is the stoichiometric matrix, $v \\in \\mathbb{R}^{n}$ is the vector of reaction fluxes, $m$ is the number of metabolites, and $n$ is the number of reactions.\n- Each reaction $j$ has an irreversible flux bound $0 \\le v_j \\le U_j$, where $U_j \\in \\mathbb{R}_{\\ge 0}$.\n- Biomass production is represented by a linear objective $c^{\\top} v$, where $c \\in \\mathbb{R}^{n}_{\\ge 0}$.\n- Gene deletions affect reaction activity; assume a one-to-one mapping where deleting gene $j$ disables reaction $j$. Let the binary decision variable $x_j \\in \\{0,1\\}$ indicate deletion of gene $j$ ($x_j = 1$ means gene $j$ deleted, $x_j = 0$ means intact). When gene $j$ is deleted, its reaction’s upper bound becomes $0$. Therefore, the effective upper bound under deletions is $u_j(x) = U_j \\cdot (1 - x_j)$, and the feasible primal flux space is $0 \\le v \\le u(x)$ with $S v = 0$.\n- The Flux Balance Analysis (FBA) problem is the linear program $\\max_{v} \\{ c^{\\top} v \\mid S v = 0, \\ 0 \\le v \\le u(x) \\}$.\n\nTask:\n1. Starting only from $S v = 0$, linear bound constraints, and linear programming duality, derive a single-level MILP that minimizes $\\sum_{j=1}^{n} x_j$ subject to the condition that the maximum achievable biomass flux is at most a given threshold $\\theta \\in \\mathbb{R}_{\\ge 0}$.\n2. Justify correctness by proving, using dual bounds, that the MILP constraints indeed enforce that the optimal biomass flux under the chosen deletions is at most $\\theta$.\n3. Implement a program that, given a list of test networks with $(S, c, U, \\theta)$, computes the minimal integer number of gene deletions required. The implementation must be self-contained and must not rely on external files. All quantities are treated as dimensionless scalars; no physical units are required. Angles are not involved. Percentages are not involved.\n\nTest suite:\n- Test case $1$ (happy path, single chain):\n  - $m = 2$, $n = 3$.\n  - $$S = \\begin{bmatrix} 1 & -1 & 0 \\\\ 0 & 1 & -1 \\end{bmatrix}, \\quad c = \\begin{bmatrix} 0 \\\\ 0 \\\\ 1 \\end{bmatrix}, \\quad U = \\begin{bmatrix} 10 \\\\ 10 \\\\ 10 \\end{bmatrix}, \\quad \\theta = 5.$$\n  - Interpretation: A linear chain of three irreversible reactions with capacity $10$ each, maximizing $v_3$; find the minimum deletions so that the maximum biomass flux is at most $5$.\n\n- Test case $2$ (two independent modules feeding biomass, requiring multiple deletions):\n  - $m = 2$, $n = 4$.\n  - $$S = \\begin{bmatrix} 1 & -1 & 0 & 0 \\\\ 0 & 0 & 1 & -1 \\end{bmatrix}, \\quad c = \\begin{bmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 1 \\end{bmatrix}, \\quad U = \\begin{bmatrix} 5 \\\\ 5 \\\\ 5 \\\\ 5 \\end{bmatrix}, \\quad \\theta = 3.$$\n  - Interpretation: Two separate nutrient modules, each capable of supplying up to $5$ biomass flux, maximizing $v_2 + v_4$; find the minimum deletions so that the maximum biomass flux is at most $3$.\n\n- Test case $3$ (boundary condition where no deletions are needed):\n  - $m = 2$, $n = 3$.\n  - $$S = \\begin{bmatrix} 1 & -1 & 0 \\\\ 0 & 1 & -1 \\end{bmatrix}, \\quad c = \\begin{bmatrix} 0 \\\\ 0 \\\\ 1 \\end{bmatrix}, \\quad U = \\begin{bmatrix} 10 \\\\ 10 \\\\ 10 \\end{bmatrix}, \\quad \\theta = 10.$$\n  - Interpretation: Same chain as in test case $1$, but the threshold equals the baseline maximum; compute the minimal deletions required so that the maximum biomass flux is at most $10$.\n\nAnswer specification:\n- For each test case, the output must be a single integer equal to the minimal number of gene deletions required to enforce the biomass flux threshold condition.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, `[1,2,0]`.",
            "solution": "The problem requires the formulation of a Mixed-Integer Linear Program (MILP) to find the minimum number of gene deletions that restrict the maximum biomass production of a metabolic network to a given threshold $\\theta$. This is a canonical bi-level optimization problem in metabolic engineering. We will derive the single-level MILP from first principles using linear programming duality and then provide an algorithmic implementation to solve the specific test cases provided.\n\nThe overall problem can be formally stated as:\n$$ \\min_{x} \\quad \\sum_{j=1}^{n} x_j $$\n$$ \\text{subject to:} \\quad Z(x) \\le \\theta $$\n$$ \\quad \\quad \\quad x_j \\in \\{0, 1\\} \\quad \\forall j \\in \\{1, \\dots, n\\} $$\nwhere $Z(x)$ is the optimal value of the inner Flux Balance Analysis (FBA) problem for a given gene deletion vector $x$. The vector $x$ has components $x_j=1$ if gene $j$ is deleted and $x_j=0$ otherwise. The inner FBA problem is a linear program (LP) that maximizes the biomass flux $c^{\\top}v$ over the space of feasible steady-state flux vectors $v$:\n$$ Z(x) = \\max_{v} \\quad c^{\\top} v $$\n$$ \\text{s.t.} \\quad S v = 0 $$\n$$ \\quad \\quad 0 \\le v_j \\le U_j (1 - x_j) \\quad \\forall j \\in \\{1, \\dots, n\\} $$\nHere, $S \\in \\mathbb{R}^{m \\times n}$ is the stoichiometric matrix, $v \\in \\mathbb{R}^{n}$ is the vector of reaction fluxes, $c \\in \\mathbb{R}^{n}_{\\ge 0}$ is the biomass objective vector, and $U \\in \\mathbb{R}^{n}_{\\ge 0}$ is the vector of reaction flux upper bounds. The effect of deleting gene $j$ ($x_j=1$) is to set the upper bound of reaction $j$ to $0$.\n\nTo transform this bi-level structure into a single-level MILP, we leverage the properties of LP duality. Let us rewrite the inner FBA problem, which we will refer to as the primal problem $P(x)$:\n$$ P(x): \\quad \\max_{v} \\quad c^{\\top}v $$\n$$ \\text{s.t.} \\quad S v = 0 $$\n$$ \\quad \\quad v - u(x) \\le 0 $$\n$$ \\quad \\quad -v \\le 0 $$\nwhere $u(x)_j = U_j (1 - x_j)$. The corresponding dual LP, $D(x)$, can be formulated by associating dual variables $\\lambda \\in \\mathbb{R}^{m}$ with the equality constraints $S v = 0$, $\\mu \\in \\mathbb{R}^{n}_{\\ge 0}$ with the upper bound constraints $v \\le u(x)$, and $\\pi \\in \\mathbb{R}^{n}_{\\ge 0}$ with the non-negativity constraints $-v \\le 0$. The dual problem is:\n$$ D(x): \\quad \\min_{\\lambda, \\mu, \\pi} \\quad \\mu^{\\top} u(x) $$\n$$ \\text{s.t.} \\quad S^{\\top}\\lambda + \\mu - \\pi = c $$\n$$ \\quad \\quad \\lambda \\text{ free}, \\mu \\ge 0, \\pi \\ge 0 $$\n\nThe strong duality theorem of linear programming states that if the primal problem has a finite optimal solution, then so does the dual, and their optimal objective values are equal, i.e., $Z(x) = \\max_{v} c^{\\top}v = \\min_{\\lambda, \\mu, \\pi} \\mu^{\\top}u(x)$. The FBA primal is always feasible (e.g., $v=0$) and bounded (since $v_j \\le U_j$), so strong duality holds.\n\nThe constraint on the maximum biomass flux, $Z(x) \\le \\theta$, can therefore be replaced by its dual equivalent:\n$$ \\min_{\\lambda, \\mu, \\pi} \\{ \\mu^{\\top}u(x) \\mid S^{\\top}\\lambda + \\mu - \\pi = c, \\mu \\ge 0, \\pi \\ge 0 \\} \\le \\theta $$\nThis inequality holds if and only if there exists a feasible dual solution $(\\lambda, \\mu, \\pi)$ for which the dual objective function value is at most $\\theta$. This allows us to replace the inner optimization with a set of existential constraints on the dual variables. Our bi-level problem can now be rewritten as a single-level problem:\n$$ \\min_{x, \\lambda, \\mu, \\pi} \\quad \\sum_{j=1}^{n} x_j $$\n$$ \\text{s.t.} \\quad S^{\\top}\\lambda + \\mu - \\pi = c $$\n$$ \\quad \\quad \\mu^{\\top}u(x) \\le \\theta $$\n$$ \\quad \\quad x_j \\in \\{0, 1\\} \\quad \\forall j $$\n$$ \\quad \\quad \\lambda \\text{ free}, \\mu \\ge 0, \\pi \\ge 0 $$\n\nThe constraint $\\mu^{\\top}u(x) \\le \\theta$ is non-linear due to the product of variables $\\mu_j$ and $x_j$, as seen when expanded:\n$$ \\sum_{j=1}^{n} \\mu_j U_j (1 - x_j) = \\sum_{j=1}^{n} \\mu_j U_j - \\sum_{j=1}^{n} (\\mu_j U_j) x_j \\le \\theta $$\nTo linearize this, we introduce auxiliary variables $w_j$ intended to represent the product $\\mu_j x_j$. The relationship $w_j = \\mu_j x_j$ can be enforced using linear constraints with the \"big-M\" method. If $x_j=0$, then $w_j=0$. If $x_j=1$, then $w_j=\\mu_j$. This logic is captured by the following set of linear inequalities, where $M$ is a sufficiently large positive constant that serves as an upper bound on any potential value of $\\mu_j$:\n1. $w_j \\ge 0$\n2. $w_j \\le \\mu_j$\n3. $w_j \\le M x_j$\n4. $w_j \\ge \\mu_j - M (1 - x_j)$\n\nIf $x_j = 0$, constraints $3$ and $1$ force $w_j=0$. Constraint $2$ ($0 \\le \\mu_j$) is satisfied, and constraint $4$ ($0 \\ge \\mu_j-M$) is satisfied as long as $M \\ge \\mu_j$.\nIf $x_j = 1$, constraint $3$ becomes $w_j \\le M$, which is non-binding. Constraint $4$ becomes $w_j \\ge \\mu_j$. Combined with constraint $2$ ($w_j \\le \\mu_j$), this forces $w_j = \\mu_j$.\n\nSubstituting $w_j$ for $\\mu_j x_j$, we arrive at the final single-level MILP formulation:\n$$ \\min_{x, \\lambda, \\mu, \\pi, w} \\quad \\sum_{j=1}^{n} x_j $$\n$$ \\text{s.t.} $$\n$$ S^{\\top}\\lambda + \\mu - \\pi = c $$\n$$ \\sum_{j=1}^{n} \\mu_j U_j - \\sum_{j=1}^{n} w_j U_j \\le \\theta $$\n$$ w_j \\le M x_j \\quad \\forall j \\in \\{1, \\dots, n\\} $$\n$$ w_j \\ge 0 \\quad \\forall j \\in \\{1, \\dots, n\\} $$\n$$ w_j \\le \\mu_j \\quad \\forall j \\in \\{1, \\dots, n\\} $$\n$$ w_j \\ge \\mu_j - M (1-x_j) \\quad \\forall j \\in \\{1, \\dots, n\\} $$\n$$ x_j \\in \\{0, 1\\} \\quad \\forall j \\in \\{1, \\dots, n\\} $$\n$$ \\lambda \\in \\mathbb{R}^m, \\mu \\in \\mathbb{R}^n_{\\ge 0}, \\pi \\in \\mathbb{R}^n_{\\ge 0} $$\nThis formulation correctly finds the minimum number of gene deletions. Its correctness is founded upon the strong duality of linear programming, which guarantees that satisfying the constraints on the dual variables $(\\lambda, \\mu, \\pi)$ is equivalent to enforcing the upper-bound constraint on the primal biomass maximization problem.\n\nFor the implementation, given the constraint of not using a dedicated MILP solver and the small size of the reaction networks in the test suite ($n \\le 4$), an exhaustive search approach is computationally feasible and appropriate. The algorithm will iterate through the number of deletions $k$ from $0$ to $n$. For each $k$, it will test all combinations of $k$ gene deletions. For each combination, it solves the corresponding FBA problem (an LP). The first value of $k$ for which a deletion strategy satisfies the biomass threshold $\\theta$ is the minimal number of deletions. This approach is guaranteed to find the minimum because it explores solutions in increasing order of their objective function value ($\\sum x_j = k$).",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\nfrom itertools import combinations\n\ndef solve():\n    \"\"\"\n    Main function to solve the gene deletion problem for all test cases.\n    \"\"\"\n    \n    # Test case 1: Happy path, single chain\n    S1 = np.array([[1, -1, 0], [0, 1, -1]])\n    c1 = np.array([0, 0, 1])\n    U1 = np.array([10, 10, 10])\n    theta1 = 5.0\n\n    # Test case 2: Two independent modules feeding biomass\n    S2 = np.array([[1, -1, 0, 0], [0, 0, 1, -1]])\n    c2 = np.array([0, 1, 0, 1])\n    U2 = np.array([5, 5, 5, 5])\n    theta2 = 3.0\n    \n    # Test case 3: Boundary condition where no deletions are needed\n    S3 = np.array([[1, -1, 0], [0, 1, -1]])\n    c3 = np.array([0, 0, 1])\n    U3 = np.array([10, 10, 10])\n    theta3 = 10.0\n\n    test_cases = [\n        (S1, c1, U1, theta1),\n        (S2, c2, U2, theta2),\n        (S3, c3, U3, theta3),\n    ]\n\n    results = []\n    for case in test_cases:\n        S, c, U, theta = case\n        result = compute_minimal_deletions(S, c, U, theta)\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef solve_fba(S, c, u_bounds):\n    \"\"\"\n    Solves the Flux Balance Analysis (FBA) problem for a given network and bounds.\n    \n    The FBA problem is:\n    max c^T * v\n    s.t. S * v = 0\n         0 <= v_j <= u_bounds_j\n\n    Args:\n        S (np.ndarray): Stoichiometric matrix (m x n).\n        c (np.ndarray): Biomass objective vector (n,).\n        u_bounds (np.ndarray): Reaction flux upper bounds (n,).\n\n    Returns:\n        float: The maximum biomass flux. Returns 0.0 if infeasible.\n    \"\"\"\n    m, n = S.shape\n    \n    # an LP solver like linprog minimizes, so we minimize -c^T * v\n    obj_coeffs = -c\n    \n    # Equality constraints: S * v = 0\n    A_eq = S\n    b_eq = np.zeros(m)\n    \n    # Bounds for fluxes: 0 <= v_j <= u_bounds_j\n    bounds = [(0, u_j) for u_j in u_bounds]\n    \n    # Solve the LP\n    res = linprog(c=obj_coeffs, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n    \n    if res.success:\n        # res.fun is the minimum of -c^T * v, so -res.fun is the maximum of c^T * v\n        return -res.fun\n    else:\n        # If the problem is infeasible (e.g., bounds make it so), max flux is 0.\n        return 0.0\n\ndef compute_minimal_deletions(S, c, U, theta):\n    \"\"\"\n    Computes the minimal number of gene deletions to meet the biomass threshold.\n    This function iterates through the number of deletions k=0, 1, 2, ...\n    For each k, it checks all combinations of k deletions. The first k that\n    yields a valid strategy is the minimum.\n\n    Args:\n        S (np.ndarray): Stoichiometric matrix.\n        c (np.ndarray): Biomass objective vector.\n        U (np.ndarray): Base upper bounds for all reactions.\n        theta (float): The target maximum biomass flux.\n\n    Returns:\n        int: The minimal number of deletions required.\n    \"\"\"\n    n = S.shape[1]\n    reaction_indices = range(n)\n    \n    # A small tolerance for floating point comparisons\n    TOLERANCE = 1e-9\n\n    # Iterate through the number of deletions, from 0 to n\n    for k in range(n + 1):\n        # Generate all combinations of k deletions\n        for deletion_indices in combinations(reaction_indices, k):\n            # Create the deletion vector x (1 for deleted, 0 for intact)\n            x = np.zeros(n)\n            x[list(deletion_indices)] = 1\n            \n            # Calculate the effective upper bounds u(x)\n            u_effective = U * (1 - x)\n            \n            # Solve the FBA problem for this deletion strategy\n            max_biomass = solve_fba(S, c, u_effective)\n\n            # Check if the biomass constraint is met\n            if max_biomass <= theta + TOLERANCE:\n                # Since we are iterating k from 0 upwards, the first\n                # k for which we find a solution is the minimum.\n                return k\n    \n    # This part should not be reached in a well-defined problem,\n    # as deleting all reactions (k=n) guarantees zero flux.\n    return n\n\nsolve()\n```"
        }
    ]
}