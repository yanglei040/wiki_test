{
    "hands_on_practices": [
        {
            "introduction": "The stoichiometric matrix $S$ elegantly captures the mass balance constraints of a metabolic network through the steady-state equation $S \\boldsymbol{v} = \\boldsymbol{0}$. However, to build a biophysically realistic model, we must also incorporate thermodynamic constraints that dictate the direction of metabolic flux. This exercise connects the fundamental principles of chemical thermodynamics with the practical formulation of flux constraints in FBA . By calculating the transformed reaction Gibbs energy, $\\Delta_r G'$, from standard formation energies and metabolite activities, you will learn how to determine a reaction's spontaneous direction and set appropriate bounds on its flux, thereby enhancing the predictive power of the model.",
            "id": "3316719",
            "problem": "Consider a single intracellular reaction embedded within a genome-scale stoichiometric representation of metabolism. The reaction consumes metabolite $A$ and $B$ to produce metabolite $C$ and $D$ according to the stoichiometry $2A + B \\rightarrow C + D$. The corresponding column of the stoichiometric matrix for this reaction, written as a stoichiometric coefficient vector, is $\\boldsymbol{\\nu}^{(r)} = \\begin{pmatrix} \\nu_A \\\\ \\nu_B \\\\ \\nu_C \\\\ \\nu_D \\end{pmatrix} = \\begin{pmatrix} -2 \\\\ -1 \\\\ 1 \\\\ 1 \\end{pmatrix}$. Assume standard Gibbs free energies of formation at biochemical standard state (pH $7$, $I \\approx 0.1$ M) are given by $\\Delta_f G_A^\\circ = -120$ kJ/mol, $\\Delta_f G_B^\\circ = -80$ kJ/mol, $\\Delta_f G_C^\\circ = -220$ kJ/mol, and $\\Delta_f G_D^\\circ = -90$ kJ/mol. Cytosolic activities are $a_A = 0.2$, $a_B = 0.1$, $a_C = 1.0 \\times 10^{-6}$, and $a_D = 1.0 \\times 10^{-4}$. Let the absolute temperature be $T = 310$ K and the universal gas constant be $R = 8.314462618 \\times 10^{-3}$ kJ mol$^{-1}$ K$^{-1}$. The sign convention for the reaction free energy is set by the stoichiometry above, and the forward flux $v_r$ is defined positive when the reaction proceeds in the written direction, consuming $A$ and $B$ and forming $C$ and $D$.\n\nStarting from the definition of chemical potential and the stoichiometric representation of reactions, derive the standard reaction Gibbs energy $\\Delta_r G^\\circ$ in terms of the standard Gibbs free energies of formation $\\Delta_f G_i^\\circ$ and the stoichiometric coefficients $\\nu_i$, then use metabolite activities to obtain the transformed reaction Gibbs energy $\\Delta_r G^\\prime$ at temperature $T$. In the context of steady-state Flux Balance Analysis (FBA), where fluxes $\\boldsymbol{v}$ satisfy $\\mathbf{S}\\boldsymbol{v} = \\boldsymbol{0}$, formulate the inequalities on the scalar flux $v_r$ that enforce irreversibility of the reaction when $\\Delta_r G^\\prime \\ll 0$ under the given activities. Finally, compute the numerical value of $\\Delta_r G^\\prime$ using the provided data and express your final numerical answer in kJ/mol, rounded to four significant figures.",
            "solution": "The problem is first subjected to validation.\n\n**Step 1: Extracted Givens**\n- Reaction stoichiometry: $2A + B \\rightarrow C + D$\n- Stoichiometric coefficient vector: $\\boldsymbol{\\nu}^{(r)} = \\begin{pmatrix} \\nu_A \\\\ \\nu_B \\\\ \\nu_C \\\\ \\nu_D \\end{pmatrix} = \\begin{pmatrix} -2 \\\\ -1 \\\\ 1 \\\\ 1 \\end{pmatrix}$\n- Standard Gibbs free energies of formation: $\\Delta_f G_A^\\circ = -120$ kJ/mol, $\\Delta_f G_B^\\circ = -80$ kJ/mol, $\\Delta_f G_C^\\circ = -220$ kJ/mol, $\\Delta_f G_D^\\circ = -90$ kJ/mol.\n- Cytosolic activities: $a_A = 0.2$, $a_B = 0.1$, $a_C = 1.0 \\times 10^{-6}$, $a_D = 1.0 \\times 10^{-4}$.\n- Absolute temperature: $T = 310$ K.\n- Universal gas constant: $R = 8.314462618 \\times 10^{-3}$ kJ mol$^{-1}$ K$^{-1}$.\n- Flux sign convention: $v_r > 0$ for the forward reaction.\n\n**Step 2: Validation Using Extracted Givens**\nThe problem is scientifically grounded, drawing upon fundamental principles of chemical thermodynamics and their application in computational systems biology (Flux Balance Analysis). It is well-posed, providing a complete and consistent set of data necessary to perform the requested derivations and calculations. The language is objective and precise. The problem does not violate any of the invalidity criteria. For instance, the stoichiometric relation $2A + B \\rightarrow C + D$ is fully consistent with the stoichiometric vector provided, where reactants have negative coefficients and products have positive coefficients. All physical quantities have appropriate units and plausible magnitudes for a biochemical context.\n\n**Step 3: Verdict and Action**\nThe problem is deemed valid. A complete solution will be provided.\n\n**Derivation of Reaction Gibbs Energy**\n\nThe standard Gibbs free energy of reaction, $\\Delta_r G^\\circ$, is the change in Gibbs energy when one mole of reaction proceeds with all reactants and products maintained in their standard states. According to Hess's Law, this can be calculated from the standard Gibbs free energies of formation, $\\Delta_f G_i^\\circ$, of each species $i$. The change is the sum of the energies of formation of the products minus the sum of the energies of formation of the reactants, each weighted by its stoichiometric coefficient. Using the convention where stoichiometric coefficients $\\nu_i$ are positive for products and negative for reactants, this relationship is expressed compactly as a sum over all participating species:\n$$\n\\Delta_r G^\\circ = \\sum_i \\nu_i \\Delta_f G_i^\\circ\n$$\nIn vector notation, this corresponds to the dot product of the transposed stoichiometric vector for the reaction, $(\\boldsymbol{\\nu}^{(r)})^T$, and the vector of standard Gibbs free energies of formation, $\\boldsymbol{\\Delta_f G^\\circ}$:\n$$\n\\Delta_r G^\\circ = (\\boldsymbol{\\nu}^{(r)})^T \\boldsymbol{\\Delta_f G^\\circ} = \\begin{pmatrix} -2 & -1 & 1 & 1 \\end{pmatrix} \\begin{pmatrix} \\Delta_f G_A^\\circ \\\\ \\Delta_f G_B^\\circ \\\\ \\Delta_f G_C^\\circ \\\\ \\Delta_f G_D^\\circ \\end{pmatrix}\n$$\n\nThe chemical potential $\\mu_i$ of a species $i$ at a specified activity $a_i$ is related to its standard chemical potential $\\mu_i^\\circ$ (which is equal to its standard Gibbs free energy of formation, $\\Delta_f G_i^\\circ$) by the equation:\n$$\n\\mu_i = \\mu_i^\\circ + RT \\ln a_i\n$$\nwhere $R$ is the universal gas constant and $T$ is the absolute temperature. The actual Gibbs free energy of reaction under these non-standard conditions, known as the transformed reaction Gibbs energy $\\Delta_r G^\\prime$, is the sum of the chemical potentials of the products and reactants, weighted by their stoichiometric coefficients $\\nu_i$:\n$$\n\\Delta_r G^\\prime = \\sum_i \\nu_i \\mu_i\n$$\nSubstituting the expression for $\\mu_i$:\n$$\n\\Delta_r G^\\prime = \\sum_i \\nu_i (\\mu_i^\\circ + RT \\ln a_i) = \\sum_i \\nu_i \\mu_i^\\circ + \\sum_i \\nu_i RT \\ln a_i\n$$\nThe first term is the definition of $\\Delta_r G^\\circ$. The second term can be simplified:\n$$\n\\Delta_r G^\\prime = \\Delta_r G^\\circ + RT \\sum_i \\ln(a_i^{\\nu_i}) = \\Delta_r G^\\circ + RT \\ln \\left( \\prod_i a_i^{\\nu_i} \\right)\n$$\nThe product term, $\\prod_i a_i^{\\nu_i}$, is the reaction quotient, $Q$. For the reaction $2A + B \\rightarrow C + D$, this is:\n$$\nQ = a_A^{-2} a_B^{-1} a_C^{1} a_D^{1} = \\frac{a_C a_D}{a_A^2 a_B}\n$$\nThus, the final derived expression for the transformed reaction Gibbs energy is:\n$$\n\\Delta_r G^\\prime = \\Delta_r G^\\circ + RT \\ln Q\n$$\n\n**Flux Irreversibility Constraint in FBA**\n\nThe second law of thermodynamics requires that a reaction can only proceed spontaneously if the change in Gibbs free energy is negative ($\\Delta_r G < 0$). In the context of FBA, the flux $v_r$ represents the rate of the reaction. The direction of the flux is linked to the sign of $\\Delta_r G^\\prime$.\n- If $\\Delta_r G^\\prime < 0$, the forward reaction is spontaneous, implying $v_r \\ge 0$.\n- If $\\Delta_r G^\\prime > 0$, the reverse reaction is spontaneous, implying $v_r \\le 0$.\n- If $\\Delta_r G^\\prime = 0$, the reaction is at equilibrium, and the net flux is zero, $v_r = 0$.\n\nThe problem specifies a scenario where $\\Delta_r G^\\prime \\ll 0$. This indicates a large negative Gibbs energy change, meaning the forward reaction is strongly favored and thermodynamically irreversible. The reverse reaction is not possible under these conditions. Therefore, the flux $v_r$ must be non-negative. In the constraint-based modeling framework of FBA, this is formulated as an inequality setting a lower bound on the flux:\n$$\nv_r \\ge 0\n$$\nThis is the standard way to enforce irreversibility for a reaction in FBA. A typical full constraint would be $0 \\le v_r \\le v_{max}$, where $v_{max}$ is an upper bound on flux capacity.\n\n**Numerical Calculation**\n\nFirst, we compute the standard reaction Gibbs energy, $\\Delta_r G^\\circ$:\n$$\n\\Delta_r G^\\circ = \\nu_A \\Delta_f G_A^\\circ + \\nu_B \\Delta_f G_B^\\circ + \\nu_C \\Delta_f G_C^\\circ + \\nu_D \\Delta_f G_D^\\circ\n$$\n$$\n\\Delta_r G^\\circ = (-2)(-120 \\text{ kJ/mol}) + (-1)(-80 \\text{ kJ/mol}) + (1)(-220 \\text{ kJ/mol}) + (1)(-90 \\text{ kJ/mol})\n$$\n$$\n\\Delta_r G^\\circ = (240 + 80 - 220 - 90) \\text{ kJ/mol} = (320 - 310) \\text{ kJ/mol} = 10 \\text{ kJ/mol}\n$$\nNext, we compute the reaction quotient, $Q$, using the given activities:\n$$\nQ = \\frac{a_C a_D}{a_A^2 a_B} = \\frac{(1.0 \\times 10^{-6})(1.0 \\times 10^{-4})}{(0.2)^2 (0.1)} = \\frac{1.0 \\times 10^{-10}}{(0.04)(0.1)} = \\frac{1.0 \\times 10^{-10}}{0.004} = \\frac{1.0 \\times 10^{-10}}{4 \\times 10^{-3}} = 2.5 \\times 10^{-8}\n$$\nNow, we calculate the term $RT \\ln Q$:\n$$\nR = 8.314462618 \\times 10^{-3} \\text{ kJ mol}^{-1} \\text{ K}^{-1}\n$$\n$$\nT = 310 \\text{ K}\n$$\n$$\nRT = (8.314462618 \\times 10^{-3})(310) \\text{ kJ/mol} \\approx 2.57748 \\text{ kJ/mol}\n$$\n$$\n\\ln Q = \\ln(2.5 \\times 10^{-8}) \\approx -17.504397\n$$\n$$\nRT \\ln Q \\approx (2.57748)( -17.504397) \\text{ kJ/mol} \\approx -45.12028 \\text{ kJ/mol}\n$$\nFinally, we compute the transformed reaction Gibbs energy, $\\Delta_r G^\\prime$:\n$$\n\\Delta_r G^\\prime = \\Delta_r G^\\circ + RT \\ln Q\n$$\n$$\n\\Delta_r G^\\prime \\approx 10 \\text{ kJ/mol} - 45.12028 \\text{ kJ/mol} = -35.12028 \\text{ kJ/mol}\n$$\nRounding the final answer to four significant figures as requested:\n$$\n\\Delta_r G^\\prime = -35.12 \\text{ kJ/mol}\n$$\nThe highly negative value confirms that the reaction is indeed strongly favorable in the forward direction under the specified cytosolic conditions and is effectively irreversible, justifying the constraint $v_r \\ge 0$.",
            "answer": "$$\n\\boxed{-35.12}\n$$"
        },
        {
            "introduction": "A primary application of genome-scale metabolic models is to predict an organism's phenotype, such as its growth rate, from its genotype. This requires a formal mapping between genes, the proteins they encode, and the reactions they catalyze, known as Gene-Protein-Reaction (GPR) rules. This hands-on programming exercise challenges you to implement the logic of GPRs to determine which reactions are active after specific gene deletions and then use Flux Balance Analysis (FBA) to predict the impact on the organism's optimal growth . This practice simulates a core workflow in computational systems biology, providing essential skills for analyzing gene essentiality and designing metabolic engineering strategies.",
            "id": "3316755",
            "problem": "You are given a toy genome-scale metabolic reconstruction in steady state that obeys the law of mass conservation for intracellular metabolites. Under the standard steady-state assumption in constraint-based modeling, the intracellular metabolite concentrations do not change with time. This implies the linear conservation law $S v = 0$, where $S$ is the stoichiometric matrix and $v$ is the vector of reaction fluxes. Enzyme availability constraints arise from gene-protein-reaction (GPR) rules, which are Boolean expressions in genes that determine whether a reaction is catalytically enabled. A reaction affected by a GPR rule is enabled if and only if its GPR evaluates to true given the set of non-deleted genes. Exchange and biomass sink reactions without GPR rules are assumed to be always available. The Flux Balance Analysis (FBA) optimal growth is computed by maximizing the biomass reaction flux subject to these constraints and reaction bounds. The effect on the feasible flux space can be summarized, to first order, by the dimension of the null space of the active-stoichiometry submatrix, which is $n_{\\text{active}} - \\operatorname{rank}(S_{\\text{active}})$, where $n_{\\text{active}}$ is the number of reactions not disabled by gene deletions and $S_{\\text{active}}$ is the restriction of $S$ to those reactions.\n\nThe metabolic network is defined over two intracellular metabolites, $G$ and $P$, with six reactions labeled by zero-based indices $0$ through $5$. The stoichiometric matrix $S \\in \\mathbb{R}^{2 \\times 6}$ has rows ordered as $[G, P]$ and columns ordered as reactions $[0,1,2,3,4,5]$. The entries of $S$ are:\n$$\nS = \\begin{bmatrix}\n+1 & -1 & -1 & 0 & 0 & -1 \\\\\n0  & +2 & +1 & -1 & -1 & 0\n\\end{bmatrix}.\n$$\nThe reactions and their default flux bounds (all fluxes are in a consistent arbitrary unit; report floats as plain numbers) are:\n- Reaction $0$ (glucose uptake exchange, no GPR): bounds $[0,10]$.\n- Reaction $1$ (glycolysis, GPR requires an enzyme complex): bounds $[0,1000]$.\n- Reaction $2$ (alternative pathway, GPR represents isoenzymes): bounds $[0,1000]$.\n- Reaction $3$ (biomass sink, no GPR; this is the objective to maximize): bounds $[0,1000]$.\n- Reaction $4$ (byproduct sink, GPR is a single gene): bounds $[0,1000]$.\n- Reaction $5$ (maintenance drain, GPR is a single gene): bounds $[0,1000]$.\n\nThe GPR rules are:\n- Reaction $0$: no rule (always enabled).\n- Reaction $1$: $(gA \\land gB)$, that is, requires both gene $gA$ and gene $gB$ present.\n- Reaction $2$: $(gC \\lor gD)$, that is, any one of gene $gC$ or gene $gD$ present.\n- Reaction $3$: no rule (always enabled).\n- Reaction $4$: gene $gE$.\n- Reaction $5$: gene $gF$.\n\nGiven a set of deleted genes, a reaction is disabled if its GPR evaluates to false. A disabled reaction must have its flux fixed to $0$ by tightening both its lower and upper bounds to $0$. Reactions without GPR remain enabled regardless of gene deletions.\n\nYour tasks for each test case (set of gene deletions) are:\n1. Determine which reactions are disabled by evaluating the GPR rules against the set of deleted genes. Report the disabled reactions as a sorted list of their zero-based indices.\n2. Compute the dimension of the feasible steady-state subspace approximated by the null space dimension $d = n_{\\text{active}} - \\operatorname{rank}(S_{\\text{active}})$, where $S_{\\text{active}}$ is $S$ restricted to the columns of enabled reactions and $\\operatorname{rank}(\\cdot)$ is the matrix rank over the real numbers.\n3. Predict the optimal growth by solving a linear program that maximizes the flux of reaction $3$ subject to $S v = 0$, the original bounds for enabled reactions, and $v_j = 0$ for disabled reactions. Express the optimal biomass flux as a float rounded to six decimal places.\n\nYou must implement a program that carries out the above for the following test suite of gene deletion sets:\n- Test case $1$: $[]$ (no deletions).\n- Test case $2$: $[gA]$.\n- Test case $3$: $[gC]$.\n- Test case $4$: $[gC,gD]$.\n- Test case $5$: $[gA,gB,gC,gD]$.\n- Test case $6$: $[gE,gF]$.\n- Test case $7$: $[gB]$.\n\nAll gene symbols are case-sensitive. For each test case, your program must output a list of the form $[\\text{disabled}, d, b]$, where $\\text{disabled}$ is the list of disabled reaction indices, $d$ is the integer null space dimension, and $b$ is the optimal biomass flux as a float rounded to six decimal places. Aggregate the results for all test cases into a single line of output containing a JSON-like list with no spaces, for example:\n\"[item1,item2,item3,...]\" where each item is itself of the form \"[disabled_list,dimension_float,biomass_float]\" without spaces. Ensure that the floats are rounded to six decimal places. If a linear program is infeasible in any test case, report the optimal biomass as a floating-point Not-a-Number value encoded as \"nan\". No physical unit conversion is required; all reported numbers are unitless.",
            "solution": "The problem is well-posed and grounded in the established principles of computational systems biology, specifically concerning genome-scale metabolic reconstruction and Flux Balance Analysis (FBA). All necessary data and constraints are provided, allowing for a unique and meaningful solution for each test case.\n\nThe core of the problem lies in analyzing a metabolic network under the steady-state assumption. This assumption dictates that the concentrations of intracellular metabolites do not change over time, leading to the fundamental mass balance equation for a set of $m$ metabolites and $n$ reactions:\n$$S v = 0$$\nwhere $S \\in \\mathbb{R}^{m \\times n}$ is the stoichiometric matrix and $v \\in \\mathbb{R}^{n}$ is the vector of reaction fluxes. In this problem, $m=2$ metabolites ($G$ and $P$) and $n=6$ reactions, and the stoichiometric matrix is given as:\n$$\nS = \\begin{bmatrix}\n+1 & -1 & -1 & 0 & 0 & -1 \\\\\n0  & +2 & +1 & -1 & -1 & 0\n\\end{bmatrix}\n$$\nThe system is further constrained by thermodynamic and enzymatic capacity limitations, expressed as lower and upper bounds on each flux, $l_j \\le v_j \\le u_j$.\n\nThe first task is to determine the impact of gene deletions on reaction availability. This is governed by Gene-Protein-Reaction (GPR) rules, which are Boolean expressions. A reaction is considered \"enabled\" if its GPR rule evaluates to true given the set of available (non-deleted) genes; otherwise, it is \"disabled\". A disabled reaction cannot carry flux, a constraint that is imposed by setting both its lower and upper bounds to $0$, i.e., $v_j = 0$. For each test case, the set of deleted genes is provided, and the GPRs must be evaluated:\n- Reaction $1$: $(gA \\land gB)$ is true if both gene $gA$ and gene $gB$ are present.\n- Reaction $2$: $(gC \\lor gD)$ is true if gene $gC$ or gene $gD$ (or both) are present.\n- Reaction $4$: $gE$ is true if gene $gE$ is present.\n- Reaction $5$: $gF$ is true if gene $gF$ is present.\nReactions $0$ and $3$ have no GPR rules and are always enabled. The disabled reactions for each case are reported as a sorted list of indices.\n\nThe second task is to compute the dimension of the steady-state feasible flux space, which is approximated by the dimension of the null space of the \"active\" stoichiometric matrix. For a given set of gene deletions, let $S_{\\text{active}}$ be the submatrix of $S$ formed by retaining only the columns corresponding to enabled reactions. Let $n_{\\text{active}}$ be the number of such reactions. The dimension of the null space, $d$, is given by the rank-nullity theorem:\n$$d = \\operatorname{dim}(\\operatorname{null}(S_{\\text{active}})) = n_{\\text{active}} - \\operatorname{rank}(S_{\\text{active}})$$\nwhere $\\operatorname{rank}(\\cdot)$ denotes the matrix rank. This value $d$ represents the number of degrees of freedom in the metabolic network's flux distribution under steady-state conditions.\n\nThe third task is to predict the maximum possible biomass production rate using Flux Balance Analysis (FBA). FBA is a mathematical optimization method that finds a specific flux distribution $v$ within the feasible space that maximizes or minimizes a given objective function. Here, the objective is to maximize the flux through the biomass sink reaction, which is reaction $3$ ($v_3$). This is formulated as a Linear Program (LP):\n$$\n\\begin{align*}\n\\text{maximize} \\quad & v_3 \\\\\n\\text{subject to} \\quad & S v = 0 \\\\\n& l_j \\le v_j \\le u_j \\quad \\text{for each reaction } j \\in \\{0, 1, ..., 5\\}\n\\end{align*}\n$$\nFor each test case, the bounds $\\{l_j, u_j\\}$ are adjusted first: for enabled reactions, the default bounds are used; for disabled reactions, the bounds are set to $[0, 0]$. The resulting LP is then solved to find the optimal biomass flux. If the LP is found to be infeasible, the optimal flux is undefined. The solution will be numerically determined using an appropriate LP solver. The biomass flux will be reported as a float rounded to six decimal places.\n\nThe procedure will be systematically applied to each of the provided gene deletion scenarios.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves a series of computational systems biology problems involving gene deletions\n    and their effect on a toy metabolic network.\n    \"\"\"\n    # Define the stoichiometric matrix S\n    S = np.array([\n        [1, -1, -1, 0, 0, -1],\n        [0,  2,  1, -1, -1,  0]\n    ])\n\n    # Default flux bounds for reactions 0 through 5\n    default_bounds = [\n        (0, 10),    # R0: Glucose uptake\n        (0, 1000),  # R1: Glycolysis\n        (0, 1000),  # R2: Alternative pathway\n        (0, 1000),  # R3: Biomass sink\n        (0, 1000),  # R4: Byproduct sink\n        (0, 1000)   # R5: Maintenance drain\n    ]\n\n    # All genes in the model\n    all_genes = {'gA', 'gB', 'gC', 'gD', 'gE', 'gF'}\n\n    # GPR rules are defined as lambda functions that take the set of present genes\n    # and return True if the reaction is enabled.\n    gpr_rules = {\n        1: lambda present: {'gA', 'gB'}.issubset(present),        # R1: (gA AND gB)\n        2: lambda present: not {'gC', 'gD'}.isdisjoint(present), # R2: (gC OR gD)\n        4: lambda present: 'gE' in present,                      # R4: gE\n        5: lambda present: 'gF' in present                       # R5: gF\n    }\n    \n    # Test cases: sets of deleted genes\n    test_cases = [\n        [],            # Case 1: No deletions\n        ['gA'],        # Case 2\n        ['gC'],        # Case 3\n        ['gC', 'gD'],  # Case 4\n        ['gA', 'gB', 'gC', 'gD'], # Case 5\n        ['gE', 'gF'],  # Case 6\n        ['gB']         # Case 7\n    ]\n\n    results = []\n    \n    # Objective function for FBA: maximize v3, which is equivalent to minimizing -v3.\n    # c is the coefficient vector for the objective function.\n    c = np.array([0, 0, 0, -1, 0, 0])\n\n    for deleted_genes_list in test_cases:\n        deleted_genes = set(deleted_genes_list)\n        present_genes = all_genes - deleted_genes\n        \n        # Task 1: Determine disabled reactions\n        disabled_reactions = []\n        enabled_reactions = []\n        current_bounds = list(default_bounds)\n\n        for i in range(S.shape[1]):\n            is_enabled = gpr_rules.get(i, lambda pg: True)(present_genes)\n            if is_enabled:\n                enabled_reactions.append(i)\n            else:\n                disabled_reactions.append(i)\n                current_bounds[i] = (0, 0) # Constrain flux to 0 for disabled reactions\n        \n        disabled_reactions.sort()\n        \n        # Task 2: Compute null space dimension\n        n_active = len(enabled_reactions)\n        if n_active > 0:\n            S_active = S[:, enabled_reactions]\n            rank_S_active = np.linalg.matrix_rank(S_active)\n        else:\n            rank_S_active = 0\n            \n        d = n_active - rank_S_active\n        \n        # Task 3: Predict optimal growth (FBA)\n        A_eq = S\n        b_eq = np.zeros(S.shape[0])\n\n        res = linprog(c, A_eq=A_eq, b_eq=b_eq, bounds=current_bounds, method='highs')\n        \n        biomass = float('nan')\n        if res.success:\n            # The objective was to minimize -v3, so the max v3 is -res.fun\n            biomass = -res.fun\n        # Note: For this problem, v=0 is always a feasible solution, so the LP\n        # should not be infeasible. This 'else' is for general robustness.\n\n        results.append((disabled_reactions, d, biomass))\n\n    # Format the final output string as per the requirements\n    final_items_str = []\n    for item in results:\n        disabled_list, d_val, b_val = item\n        disabled_str = str(disabled_list).replace(\" \", \"\")\n        d_str = str(d_val)\n        \n        if np.isnan(b_val):\n            b_str = \"nan\"\n        else:\n            # Round to 6 decimal places before formatting to handle float inaccuracies\n            b_str = f\"{round(b_val, 6):.6f}\"\n\n        item_str = f\"[{disabled_str},{d_str},{b_str}]\"\n        final_items_str.append(item_str)\n        \n    print(f\"[{','.join(final_items_str)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Automated reconstructions of metabolic networks are often incomplete, containing \"gaps\" that prevent the model from simulating the production of essential biomass components. This exercise guides you through a principled gap-filling procedure, a critical step in model curation that restores network functionality. You will implement an algorithm to find the minimal set of candidate reactions needed to repair a gapped network, enabling biomass synthesis . A key challenge is to ensure that the added reactions do not create thermodynamically infeasible energy-generating cycles, teaching you how to build models that are not only connected but also biophysically consistent.",
            "id": "3316760",
            "problem": "Construct a principled gap-filling algorithm for small metabolic networks using the stoichiometric matrix formalism. The goal is to restore feasibility of biomass synthesis by adding the minimal number of reactions from a provided candidate set, while rigorously excluding energy-generating cycles. Your program must implement the following mathematical framework and apply it to the specified test suite.\n\nDefinitions and fundamental base:\n- A metabolic network is represented by a stoichiometric matrix $S \\in \\mathbb{R}^{m \\times n}$ over $m$ metabolites and $n$ reactions, and a flux vector $v \\in \\mathbb{R}^{n}$. Steady state requires $S v = 0$.\n- Each reaction $j$ has lower and upper bounds $l_j \\le v_j \\le u_j$. Bounds can encode irreversibility (for example, $l_j = 0$) or uptake limits (for example, $l_j = -10$, $u_j = 1000$).\n- Flux Balance Analysis (FBA) is a Linear Programming (LP) problem that maximizes an objective (here biomass reaction flux) subject to $S v = 0$ and bounds $l \\le v \\le u$.\n- A set of exchange reactions $E \\subset \\{0,\\dots,n-1\\}$ represents exchange with the environment. To exclude energy-generating cycles, we will test for their presence by closing the environment, which imposes $v_j = 0$ for all $j \\in E$.\n- An energy-generating cycle is operationally detected by testing whether, with all exchanges closed, the LP that maximizes an Adenosine Triphosphate (ATP) hydrolysis drain reaction admits a strictly positive optimal flux. Formally, let $a$ index the ATP drain reaction. Solve\n  $$\\max_{v \\in \\mathbb{R}^n} \\ v_a \\quad \\text{subject to} \\quad S v = 0, \\quad l' \\le v \\le u',$$\n  where $l'_j = u'_j = 0$ for all $j \\in E$ (closed exchanges) and $l'_j = l_j$, $u'_j = u_j$ otherwise. If the optimum is strictly greater than $0$ (numerically, greater than a small tolerance), then the network admits an energy-generating cycle and is invalid.\n- The gap-filling problem is: given a base network $(S_{\\text{base}}, l_{\\text{base}}, u_{\\text{base}})$ with a designated biomass reaction index $b$ and an ATP drain index $a$, and a set of candidate reactions $\\{(s^{(k)}, \\ell^{(k)}, u^{(k)})\\}_{k=0}^{K-1}$, select a minimal-cardinality subset of candidates such that:\n  1. The augmented network admits a feasible steady state with strictly positive biomass flux when solving\n     $$\\max_{v} \\ v_b \\quad \\text{subject to} \\quad S_{\\text{aug}} v = 0, \\quad l_{\\text{aug}} \\le v \\le u_{\\text{aug}},$$\n     where $S_{\\text{aug}}$ and the bounds include the selected candidates appended to the base.\n  2. The augmented network does not admit an energy-generating cycle as per the LP above with all exchanges closed.\n  If multiple minimal-cardinality subsets satisfy these criteria, choose the lexicographically smallest set of candidate indices.\n\nTest suite:\nFor all tests, the metabolite order is $(A, B, ATP, ADP, Pi)$, and all flux bounds not otherwise specified are in consistent arbitrary units. All numbers below are exact constants. Indices are zero-based.\n\n- Test 1:\n  - Base reactions (columns indexed $0$ through $2$):\n    - Index $0$ (exchange for $A$): stoichiometric vector $( -1, 0, 0, 0, 0 )$, bounds $l_0 = -10$, $u_0 = 1000$.\n    - Index $1$ (biomass): stoichiometric vector $( 0, -1, -1, +1, +1 )$, bounds $l_1 = 0$, $u_1 = 1000$.\n    - Index $2$ (ATP drain): stoichiometric vector $( 0, 0, -1, +1, +1 )$, bounds $l_2 = 0$, $u_2 = 1000$.\n  - Candidate reactions (indices $c0$ through $c2$):\n    - $c0$: $( -1, +1, 0, 0, 0 )$, bounds $0 \\le v \\le 1000$.\n    - $c1$: $( 0, 0, +1, -1, -1 )$, bounds $0 \\le v \\le 1000$.\n    - $c2$: $( -1, +1, +1, -1, -1 )$, bounds $0 \\le v \\le 1000$.\n  - Exchange indices: $E = \\{ 0 \\}$.\n  - Biomass index: $b = 1$.\n  - ATP drain index: $a = 2$.\n\n- Test 2:\n  - Base reactions (columns indexed $0$ through $3$):\n    - Index $0$ (exchange for $A$): $( -1, 0, 0, 0, 0 )$, bounds $l_0 = -10$, $u_0 = 1000$.\n    - Index $1$ (present $A \\to B$): $( -1, +1, 0, 0, 0 )$, bounds $l_1 = 0$, $u_1 = 1000$.\n    - Index $2$ (biomass): $( 0, -1, -1, +1, +1 )$, bounds $l_2 = 0$, $u_2 = 1000$.\n    - Index $3$ (ATP drain): $( 0, 0, -1, +1, +1 )$, bounds $l_3 = 0$, $u_3 = 1000$.\n  - Candidate reactions (indices $c0$ through $c2$):\n    - $c0$: $( 0, 0, +1, -1, -1 )$, bounds $0 \\le v \\le 1000$.\n    - $c1$: $( -1, 0, +1, -1, -1 )$, bounds $0 \\le v \\le 1000$.\n    - $c2$: $( -1, +1, +1, -1, -1 )$, bounds $0 \\le v \\le 1000$.\n  - Exchange indices: $E = \\{ 0 \\}$.\n  - Biomass index: $b = 2$.\n  - ATP drain index: $a = 3$.\n\n- Test 3:\n  - Base reactions (columns indexed $0$ through $3$):\n    - Index $0$ (exchange for $A$): $( -1, 0, 0, 0, 0 )$, bounds $l_0 = -2$, $u_0 = 1000$.\n    - Index $1$ (ATP coupled to $A$): $( -1, 0, +1, -1, -1 )$, bounds $l_1 = 0$, $u_1 = 1000$.\n    - Index $2$ (biomass): $( 0, -1, -1, +1, +1 )$, bounds $l_2 = 0$, $u_2 = 1000$.\n    - Index $3$ (ATP drain): $( 0, 0, -1, +1, +1 )$, bounds $l_3 = 0$, $u_3 = 1000$.\n  - Candidate reactions (indices $c0$ through $c2$):\n    - $c0$: $( -1, +1, 0, 0, 0 )$, bounds $0 \\le v \\le 1000$.\n    - $c1$: $( -2, +1, 0, 0, 0 )$, bounds $0 \\le v \\le 1000$.\n    - $c2$: $( 0, 0, +1, -1, -1 )$, bounds $0 \\le v \\le 1000$.\n  - Exchange indices: $E = \\{ 0 \\}$.\n  - Biomass index: $b = 2$.\n  - ATP drain index: $a = 3$.\n\nRequirements for your program:\n- For each test, enumerate subsets of candidates in order of increasing cardinality and, within each cardinality, in lexicographic order of candidate indices.\n- For a given subset, form the augmented network and:\n  1. Verify absence of energy-generating cycles by solving the LP that maximizes $v_a$ with exchanges closed as defined above. Reject the subset if the optimal $v_a$ is strictly greater than $0$.\n  2. If it passes, solve the FBA to maximize the biomass flux $v_b$ with the original exchange bounds. Accept the subset if the optimal $v_b$ is strictly greater than $0$.\n- Select the first subset that satisfies both criteria. If no subset satisfies both, return the empty list for that test.\n- Numerical tolerance: treat any flux $\\le 10^{-9}$ as zero.\n- Final output format: Your program should produce a single line containing a list of lists of integers, where the $i$-th inner list contains the zero-based indices of the chosen candidate reactions for Test $i$ in increasing order. For example, an output like $[[2],[1],[0]]$ indicates selecting candidate $2$ for Test $1$, candidate $1$ for Test $2$, and candidate $0$ for Test $3$.\n\nYour program must be a complete, runnable implementation that hardcodes the above test suite and prints only the final result line in the specified format. No units are required in the output.",
            "solution": "The user has posed a problem in computational systems biology, specifically concerning the algorithmic gap-filling of a metabolic network. I have validated the problem statement and found it to be scientifically grounded, well-posed, and objective. The provided definitions, data, and procedural requirements are complete and mathematically consistent. Therefore, I will proceed with a full solution.\n\nThe problem asks for the implementation of an algorithm to identify a minimal set of reactions from a candidate pool to restore the functionality of a gapped metabolic network. Functionality is defined by two criteria: the ability to produce biomass at a non-zero rate, and the absence of thermodynamically infeasible energy-generating cycles.\n\nThe core of the solution is a systematic search through all possible subsets of the candidate reactions. To ensure minimality and uniqueness, this search is structured first by the size (cardinality) of the subset, from $0$ to the total number of candidates $K$, and second, for subsets of the same size, in lexicographical order of the candidate indices. The first subset that satisfies both required criteria is the solution.\n\nFor each candidate subset, we construct an augmented metabolic network by adding the selected reactions to the base network. The augmented network is described by its stoichiometric matrix $S_{\\text{aug}} \\in \\mathbb{R}^{m \\times n_{\\text{aug}}}$, and reaction flux bounds $l_{\\text{aug}} \\le v \\le u_{\\text{aug}}$. This augmented network is then subjected to two validation tests, both formulated as Linear Programming (LP) problems.\n\n**1. Energy-Generating Cycle Test:**\nAn energy-generating cycle represents a \"free lunch\" in the model, where energy, typically in the form of Adenosine Triphosphate (ATP), can be produced from nothing. This is biologically unrealistic and points to errors in the network definition. The problem provides a specific an L-P-based operational test for such cycles. We close the network to any exchange with the environment by setting the flux bounds of all exchange reactions to zero ($v_j=0$ for all $j \\in E$). Then, we attempt to maximize the flux through a synthetic ATP drain reaction, $v_a$, which models ATP consumption.\n\nThe LP formulation is:\n$$ \\max_{v} v_a \\quad \\text{subject to} \\quad \\begin{cases} S_{\\text{aug}} v = 0 \\\\ l'_{\\text{aug}} \\le v \\le u'_{\\text{aug}} \\end{cases} $$\nwhere the bounds $l'_{\\text{aug}}$ and $u'_{\\text{aug}}$ are identical to $l_{\\text{aug}}$ and $u_{\\text{aug}}$, except that for every exchange reaction index $j \\in E$, $l'_{j} = u'_{j} = 0$. If the resulting optimal value of $v_a$ is strictly greater than a small numerical tolerance (given as $10^{-9}$), it implies the network can spontaneously generate ATP. Such a network is invalid, and the corresponding candidate subset is rejected.\n\n**2. Biomass Production Test:**\nIf the network passes the cycle test, we then check if it is \"repaired,\" i.e., capable of producing biomass. This is a standard Flux Balance Analysis (FBA) problem. We use the original flux bounds, including the non-zero uptake rates for exchange reactions, and maximize the flux of the biomass reaction, $v_b$.\n\nThe LP formulation is:\n$$ \\max_{v} v_b \\quad \\text{subject to} \\quad \\begin{cases} S_{\\text{aug}} v = 0 \\\\ l_{\\text{aug}} \\le v \\le u_{\\text{aug}} \\end{cases} $$\nIf the optimal value of $v_b$ is strictly greater than the tolerance $10^{-9}$, the network is functional. The current candidate subset is therefore a valid solution. Since we are iterating in order of minimality and lexicographical rank, this first valid subset is the desired answer.\n\nThe overall algorithm is implemented by iterating through candidate subsets generated by `itertools.combinations`. For each subset, the two LPs are constructed and solved using `scipy.optimize.linprog`. If a solution is found for a given test case, the search for that test case terminates, and the algorithm proceeds to the next. If the search completes for a test case without finding any valid subset, the solution is an empty set. This procedure is applied independently to each test case in the provided suite.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\nimport itertools\n\ndef solve():\n    \"\"\"\n    Solves the metabolic gap-filling problem for a suite of test cases.\n    \"\"\"\n    TOL = 1e-9\n\n    # Metabolite order for all tests: (A, B, ATP, ADP, Pi)\n    # m = 5\n    m = 5\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test 1\n        {\n            \"s_base\": np.array([\n                [-1, 0, 0],   # A\n                [0, -1, 0],   # B\n                [0, -1, -1],  # ATP\n                [0, 1, 1],    # ADP\n                [0, 1, 1]     # Pi\n            ]),\n            \"l_base\": np.array([-10, 0, 0]),\n            \"u_base\": np.array([1000, 1000, 1000]),\n            \"candidates\": [\n                {\"s\": np.array([-1, 1, 0, 0, 0]), \"l\": 0, \"u\": 1000},  # c0\n                {\"s\": np.array([0, 0, 1, -1, -1]), \"l\": 0, \"u\": 1000},  # c1\n                {\"s\": np.array([-1, 1, 1, -1, -1]), \"l\": 0, \"u\": 1000}    # c2\n            ],\n            \"exchange_indices\": {0},\n            \"biomass_idx\": 1,\n            \"atp_drain_idx\": 2\n        },\n        # Test 2\n        {\n            \"s_base\": np.array([\n                [-1, -1, 0, 0],  # A\n                [0, 1, -1, 0],   # B\n                [0, 0, -1, -1],  # ATP\n                [0, 0, 1, 1],    # ADP\n                [0, 0, 1, 1]     # Pi\n            ]),\n            \"l_base\": np.array([-10, 0, 0, 0]),\n            \"u_base\": np.array([1000, 1000, 1000, 1000]),\n            \"candidates\": [\n                {\"s\": np.array([0, 0, 1, -1, -1]), \"l\": 0, \"u\": 1000},  # c0\n                {\"s\": np.array([-1, 0, 1, -1, -1]), \"l\": 0, \"u\": 1000},  # c1\n                {\"s\": np.array([-1, 1, 1, -1, -1]), \"l\": 0, \"u\": 1000}    # c2\n            ],\n            \"exchange_indices\": {0},\n            \"biomass_idx\": 2,\n            \"atp_drain_idx\": 3\n        },\n        # Test 3\n        {\n            \"s_base\": np.array([\n                [-1, -1, 0, 0],  # A\n                [0, 0, -1, 0],   # B\n                [0, 1, -1, -1],  # ATP\n                [0, -1, 1, 1],   # ADP\n                [0, -1, 1, 1]    # Pi\n            ]),\n            \"l_base\": np.array([-2, 0, 0, 0]),\n            \"u_base\": np.array([1000, 1000, 1000, 1000]),\n            \"candidates\": [\n                {\"s\": np.array([-1, 1, 0, 0, 0]), \"l\": 0, \"u\": 1000},  # c0\n                {\"s\": np.array([-2, 1, 0, 0, 0]), \"l\": 0, \"u\": 1000},  # c1\n                {\"s\": np.array([0, 0, 1, -1, -1]), \"l\": 0, \"u\": 1000}    # c2\n            ],\n            \"exchange_indices\": {0},\n            \"biomass_idx\": 2,\n            \"atp_drain_idx\": 3\n        }\n    ]\n\n    final_results = []\n    \n    for case in test_cases:\n        s_base = case[\"s_base\"]\n        l_base = case[\"l_base\"]\n        u_base = case[\"u_base\"]\n        candidates = case[\"candidates\"]\n        exchange_indices = case[\"exchange_indices\"]\n        biomass_idx = case[\"biomass_idx\"]\n        atp_drain_idx = case[\"atp_drain_idx\"]\n\n        n_base = s_base.shape[1]\n        n_candidates = len(candidates)\n        b_eq = np.zeros(m)\n        solution_found = False\n        \n        for k in range(n_candidates + 1):\n            if solution_found:\n                break\n            # Iterate through subsets of size k in lexicographical order\n            for subset_indices in itertools.combinations(range(n_candidates), k):\n                # 1. Construct the augmented network\n                s_aug = s_base\n                l_aug = list(l_base)\n                u_aug = list(u_base)\n\n                if subset_indices:\n                    s_to_add = np.array([candidates[i][\"s\"] for i in subset_indices]).T\n                    s_aug = np.hstack((s_base, s_to_add))\n                    l_to_add = [candidates[i][\"l\"] for i in subset_indices]\n                    u_to_add = [candidates[i][\"u\"] for i in subset_indices]\n                    l_aug.extend(l_to_add)\n                    u_aug.extend(u_to_add)\n                \n                n_aug = s_aug.shape[1]\n                \n                # 2. Test for energy-generating cycles\n                c_atp = np.zeros(n_aug)\n                c_atp[atp_drain_idx] = -1  # Maximize ATP drain flux\n                \n                # Close exchanges for cycle test\n                bounds_cycle_test = list(zip(l_aug, u_aug))\n                for ex_idx in exchange_indices:\n                    bounds_cycle_test[ex_idx] = (0, 0)\n                \n                res_cycle = linprog(c=c_atp, A_eq=s_aug, b_eq=b_eq, bounds=bounds_cycle_test, method='highs')\n                \n                max_atp_flux = -res_cycle.fun if res_cycle.success else 0\n                \n                if max_atp_flux > TOL:\n                    continue  # Cycle detected, this subset is invalid\n\n                # 3. Test for biomass production\n                c_biomass = np.zeros(n_aug)\n                c_biomass[biomass_idx] = -1 # Maximize biomass flux\n\n                bounds_biomass_test = list(zip(l_aug, u_aug))\n\n                res_biomass = linprog(c=c_biomass, A_eq=s_aug, b_eq=b_eq, bounds=bounds_biomass_test, method='highs')\n\n                max_biomass_flux = -res_biomass.fun if res_biomass.success else 0\n\n                if max_biomass_flux > TOL:\n                    final_results.append(list(subset_indices))\n                    solution_found = True\n                    break\n\n        if not solution_found:\n            final_results.append([])\n\n    # Final print statement in the exact required format.\n    # The str(final_results).replace(\" \", \"\") format ensures compliance with the\n    # example structure specified in the problem `[[2],[1],[0]]`.\n    print(str(final_results).replace(\" \", \"\"))\n\nsolve()\n```"
        }
    ]
}