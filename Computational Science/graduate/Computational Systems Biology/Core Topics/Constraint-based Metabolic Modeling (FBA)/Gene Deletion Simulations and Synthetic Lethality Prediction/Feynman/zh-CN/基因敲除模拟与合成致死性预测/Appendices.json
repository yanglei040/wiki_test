{
    "hands_on_practices": [
        {
            "introduction": "理解代谢网络中基因功能的第一步是预测移除它们后产生的影响。本练习将通过通量平衡分析（Flux Balance Analysis, FBA）提供一个实现单基因删除模拟的实践指南。通过该练习，您将学习如何将基因-蛋白质-反应（Gene-Protein-Reaction, GPR）规则转化为模型约束，并评估细胞的生存能力，这是计算系统生物学中的一项基本技能。",
            "id": "3313310",
            "problem": "考虑使用通量平衡分析（FBA）计算单基因必需性的问题。通量平衡分析（FBA）定义在一个代谢网络上，该网络包含一个化学计量矩阵 $S \\in \\mathbb{R}^{m \\times n}$、一个通量向量 $v \\in \\mathbb{R}^{n}$、稳态质量平衡约束 $S v = 0$ 以及反应界限 $l \\le v \\le u$，其中 $l \\in \\mathbb{R}^{n}$ 且 $u \\in \\mathbb{R}^{n}$。通过最大化一个线性目标 $c^{\\top} v$ 来表示生长，其中 $c \\in \\mathbb{R}^{n}$。基因-反应关联由基因-蛋白质-反应规则表示，这些规则使用析取范式（即“与”的“或”）的布尔逻辑。每个反应 $i$ 都有一个关联规则 $\\mathcal{R}_i = \\bigvee_{k} \\bigwedge_{g \\in C_{i,k}} g$，其中 $C_{i,k}$ 是基因索引的子句；一个反应是活跃的，当且仅当至少有一个子句被存在的基因完全满足。单基因敲除会移除一个基因，导致其规则不再被满足的反应，必须通过设置 $l_i = u_i = 0$ 将其界限强制为 $v_i = 0$。一个基因被定义为必需基因，当且仅当在 $S v = 0$ 和 $l \\le v \\le u$ 条件下的野生型最优目标值 $z_{\\mathrm{WT}} = \\max_{v} c^{\\top} v$ 大于或等于给定阈值 $\\epsilon$，并且在相同约束下但对已敲除基因强制执行规则后计算出的敲除型最优目标值 $z_{\\mathrm{KO}}^{(g)}$ 严格小于 $\\epsilon$。所有数值比较必须使用实数，并严格按照所述方式实现。\n\n您的任务是编写一个完整、可运行的程序，该程序：\n- 对于每个提供的测试用例，通过求解线性规划 $\\max_{v} c^{\\top} v$（约束条件为 $S v = 0$ 和 $l \\le v \\le u$）来计算 $z_{\\mathrm{WT}}$。\n- 对于每个基因索引 $g \\in \\{0, 1, \\dots, G-1\\}$，通过在反应规则上强制执行基因敲除（对于因基因 $g$ 敲除而规则不满足的反应 $i$，设置 $v_i = 0$），并重新求解线性规划，来计算 $z_{\\mathrm{KO}}^{(g)}$。\n- 确定该测试用例的必需基因集合，即满足 $z_{\\mathrm{WT}} \\ge \\epsilon$ 和 $z_{\\mathrm{KO}}^{(g)}  \\epsilon$ 的所有索引 $g$。\n- 生成单行输出，其中包含所有测试用例的结果。该输出为一个逗号分隔的列表，并用方括号括起来，其中每个元素是代表相应测试用例的必需基因索引（按升序排列）的整数列表（例如，$[\\,[0,2],\\,[1]\\,]$）。\n\n使用以下纯数学术语表述的测试套件。在所有情况下，均使用指定的目标向量 $c$ 和界限 $(l, u)$。除非另有说明，所有反应都是正向不可逆的。通量单位是任意的，不影响逻辑判定；无需报告物理单位。\n\n测试用例 1（含同工酶的标准情况）：\n- 代谢物：$m = 2$，标记为 $A$ 和 $B$；反应：$n = 3$，标记为 $0, 1, 2$。\n- 化学计量矩阵：\n$$\nS = \n\\begin{bmatrix}\n1  -1  0 \\\\\n0  1  -1\n\\end{bmatrix}.\n$$\n- 界限：\n$$\nl = \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\end{bmatrix}, \\quad\nu = \\begin{bmatrix} 10 \\\\ 1000 \\\\ 1000 \\end{bmatrix}.\n$$\n- 目标：\n$$\nc = \\begin{bmatrix} 0 \\\\ 0 \\\\ 1 \\end{bmatrix}.\n$$\n- 基因数量：$G = 3$，索引为 $0, 1, 2$。\n- 反应规则：\n  - 反应 0：无基因规则（始终活跃）。\n  - 反应 1：$(0) \\lor (1)$。\n  - 反应 2：$(2)$。\n- 阈值：$\\epsilon = 10^{-6}$。\n\n测试用例 2（具有复合需求的边界情况）：\n- $S$、$c$ 和 $l, u$ 与测试用例 1 相同。\n- 基因数量：$G = 3$，索引为 $0, 1, 2$。\n- 反应规则：\n  - 反应 0：无基因规则（始终活跃）。\n  - 反应 1：$(0 \\land 1)$。\n  - 反应 2：$(2)$。\n- 阈值：$\\epsilon = 10^{-6}$。\n\n测试用例 3（野生型零生长且存在未映射基因的边缘情况）：\n- 化学计量矩阵：\n$$\nS = \n\\begin{bmatrix}\n1  -1  0 \\\\\n0  1  -1\n\\end{bmatrix}.\n$$\n- 界限：\n$$\nl = \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\end{bmatrix}, \\quad\nu = \\begin{bmatrix} 0 \\\\ 1000 \\\\ 1000 \\end{bmatrix}.\n$$\n- 目标：\n$$\nc = \\begin{bmatrix} 0 \\\\ 0 \\\\ 1 \\end{bmatrix}.\n$$\n- 基因数量：$G = 4$，索引为 $0, 1, 2, 3$。\n- 反应规则：\n  - 反应 0：无基因规则（始终活跃）。\n  - 反应 1：$(0) \\lor (1)$。\n  - 反应 2：$(2)$。\n- 阈值：$\\epsilon = 10^{-6}$。\n\n测试用例 4（数值阈值边界情况）：\n- 化学计量矩阵：\n$$\nS = \n\\begin{bmatrix}\n1  -1  0 \\\\\n0  1  -1\n\\end{bmatrix}.\n$$\n- 界限：\n$$\nl = \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\end{bmatrix}, \\quad\nu = \\begin{bmatrix} 10^{-6} \\\\ 1000 \\\\ 1000 \\end{bmatrix}.\n$$\n- 目标：\n$$\nc = \\begin{bmatrix} 0 \\\\ 0 \\\\ 1 \\end{bmatrix}.\n$$\n- 基因数量：$G = 3$，索引为 $0, 1, 2$。\n- 反应规则：\n  - 反应 0：无基因规则（始终活跃）。\n  - 反应 1：$(0) \\lor (1)$。\n  - 反应 2：$(2)$。\n- 阈值：$\\epsilon = 10^{-6}$。\n\n您的程序必须构建并求解每个线性规划，通过将规则不满足的反应界限置零来强制执行基因敲除，使用所述标准确定必需基因，并以 $[\\text{case}_1,\\text{case}_2,\\text{case}_3,\\text{case}_4]$ 的确切格式输出单行结果，其中每个 $\\text{case}_k$ 是一个 Python 风格的整数列表，表示测试用例 $k$ 的必需基因索引（按升序排列）。",
            "solution": "问题陈述已经过仔细审查，并被确定为有效。它在科学上基于计算系统生物学的既定原则，特别是通量平衡分析（FBA）和代谢网络建模。该问题定义明确，为每个测试用例提供了所有必要的数学定义和数据（$S$、$l$、$u$、$c$、基因-蛋白质-反应规则和必需性阈值 $\\epsilon$）。语言客观精确，没有歧义。任务是实现一个标准的计算机模拟基因必需性分析，这是一个可形式化和可验证的计算问题。\n\n解决方案从第一性原理出发，始于通量平衡分析的数学公式。FBA 模拟代谢网络在稳态下的行为。FBA 的核心是一个线性规划（LP），旨在找到一个通过网络中所有反应的特定通量分布 $v$，以优化给定的细胞目标，如生物质的产生。\n\nFBA问题的一般形式为：\n$$\n\\begin{align*}\n\\text{maximize} \\quad  z = c^{\\top} v \\\\\n\\text{subject to} \\quad  S v = \\mathbf{0} \\\\\n l \\le v \\le u\n\\end{align*}\n$$\n其中：\n- $v \\in \\mathbb{R}^{n}$ 是网络中 $n$ 个反应的反应通量向量。\n- $S \\in \\mathbb{R}^{m \\times n}$ 是化学计量矩阵，表示 $m$ 种代谢物的质量平衡。\n- $c \\in \\mathbb{R}^{n}$ 是目标向量，定义了要最大化的通量的线性组合（例如，一个“生物质反应”）。\n- $l, u \\in \\mathbb{R}^{n}$ 分别是单个反应通量的下界和上界，由于热力学和酶容量的限制而约束了反应速率。\n- 约束 $S v = \\mathbf{0}$ 强制执行稳态假设，意味着对于每种代谢物，其总生产速率等于总消耗速率。\n\n基因-反应关联由基因-蛋白质-反应（GPR）规则编码。问题将这些规则指定为析取范式（DNF），即“与”的“或”形式。一个反应 $i$ 被催化，因此可以承载通量，当且仅当其 GPR 规则 $\\mathcal{R}_i$ 的值为真。规则 $\\mathcal{R}_i = \\bigvee_{k} \\bigwedge_{g \\in C_{i,k}} g$ 为真，如果其至少一个“与”子句 $C_{i,k}$ 为真。一个子句为真，如果其中的所有基因 $g$ 都存在且功能正常。\n\n单基因敲除模拟涉及将特定基因 $g$ 指定为缺失。这可能导致一些 GPR 规则的计算值为假。如果反应 $i$ 的规则 $\\mathcal{R}_i$ 变为假，该反应被视为“被敲除”。这在模型中通过将其反应通量的界限设置为零来强制执行，即 $l_i = u_i = 0$，从而强制 $v_i = 0$。\n\n基因必需性的确定遵循一个精确的标准。一个基因 $g$ 是必需的，当且仅当满足两个条件：\n1. 野生型（WT）生物体的最优目标值 $z_{\\mathrm{WT}}$ 大于或等于一个生存力阈值 $\\epsilon$，即 $z_{\\mathrm{WT}} \\ge \\epsilon$。\n2. 基因 $g$ 被敲除（KO）的生物体的最优目标值 $z_{\\mathrm{KO}}^{(g)}$ 严格小于此阈值，即 $z_{\\mathrm{KO}}^{(g)}  \\epsilon$。\n\n解决每个测试用例的算法如下：\n\n1.  **解析GPR规则**：将提供的布尔规则解析为适合计算的数据结构。一个列表的列表的列表是合适的，其中外层列表对应于反应，中间列表对应于“或”子句，内层列表对应于“与”连接的基因。对于没有规则的反应，使用一个特殊值（例如 `None`）。\n2.  **求解野生型生长**：使用原始界限（$l, u$）构建并求解一个线性规划，以计算野生型最优目标值 $z_{\\mathrm{WT}}$。这通过一个数值LP求解器实现。请注意，像 `scipy.optimize.linprog` 这样的标准求解器执行的是最小化。为了最大化 $c^{\\top}v$，我们最小化 $-c^{\\top}v$，然后将得到的最优值取反。\n3.  **评估野生型生存能力**：将计算出的 $z_{\\mathrm{WT}}$ 与阈值 $\\epsilon$ 进行比较。如果 $z_{\\mathrm{WT}}  \\epsilon$，则认为该生物体从一开始就不可行，根据定义，没有基因可以是必需的。此用例的结果是一个空集。\n4.  **执行单基因敲除分析**：如果 $z_{\\mathrm{WT}} \\ge \\epsilon$，我们继续测试每个基因。对于每个基因索引 $g \\in \\{0, 1, ..., G-1\\}$：\n    a. 从野生型界限 $(l, u)$ 初始化一套新的通量界限 $(l_{\\mathrm{KO}}, u_{\\mathrm{KO}})$。\n    b. 对于每个反应 $i$，在基因 $g$ 缺失的条件下评估其 GPR 规则 $\\mathcal{R}_i$。\n    c. 如果 $\\mathcal{R}_i$ 的计算值为假，则通过将其界限设置为零来敲除该反应：$l_{\\mathrm{KO}, i} = 0$ 和 $u_{\\mathrm{KO}, i} = 0$。\n    d. 使用这些修改后的界限求解一个新的线性规划，以计算敲除目标值 $z_{\\mathrm{KO}}^{(g)}$。\n    e. 应用必需性标准：如果 $z_{\\mathrm{KO}}^{(g)}  \\epsilon$，则将基因 $g$ 添加到当前测试用例的必需基因列表中。\n5.  **汇总并格式化结果**：遍历所有基因后，将必需基因索引列表按升序排序。对所有测试用例重复此过程。最终输出是一个格式化的字符串，包含每个用例的必需基因列表。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves for essential genes in a series of metabolic models\n    using Flux Balance Analysis (FBA).\n    \"\"\"\n\n    test_cases = [\n        # Test Case 1: happy path with isoenzymes\n        {\n            \"S\": np.array([[1, -1, 0], [0, 1, -1]], dtype=np.float64),\n            \"l\": np.array([0, 0, 0], dtype=np.float64),\n            \"u\": np.array([10, 1000, 1000], dtype=np.float64),\n            \"c\": np.array([0, 0, 1], dtype=np.float64),\n            \"G\": 3,\n            \"gpr_rules\": [None, [[0], [1]], [[2]]],\n            \"epsilon\": 1e-6,\n        },\n        # Test Case 2: boundary with complex requirement\n        {\n            \"S\": np.array([[1, -1, 0], [0, 1, -1]], dtype=np.float64),\n            \"l\": np.array([0, 0, 0], dtype=np.float64),\n            \"u\": np.array([10, 1000, 1000], dtype=np.float64),\n            \"c\": np.array([0, 0, 1], dtype=np.float64),\n            \"G\": 3,\n            \"gpr_rules\": [None, [[0, 1]], [[2]]],\n            \"epsilon\": 1e-6,\n        },\n        # Test Case 3: edge case with zero wild-type growth and an unmapped gene\n        {\n            \"S\": np.array([[1, -1, 0], [0, 1, -1]], dtype=np.float64),\n            \"l\": np.array([0, 0, 0], dtype=np.float64),\n            \"u\": np.array([0, 1000, 1000], dtype=np.float64),\n            \"c\": np.array([0, 0, 1], dtype=np.float64),\n            \"G\": 4,\n            \"gpr_rules\": [None, [[0], [1]], [[2]]],\n            \"epsilon\": 1e-6,\n        },\n        # Test Case 4: numerical threshold boundary\n        {\n            \"S\": np.array([[1, -1, 0], [0, 1, -1]], dtype=np.float64),\n            \"l\": np.array([0, 0, 0], dtype=np.float64),\n            \"u\": np.array([1e-6, 1000, 1000], dtype=np.float64),\n            \"c\": np.array([0, 0, 1], dtype=np.float64),\n            \"G\": 3,\n            \"gpr_rules\": [None, [[0], [1]], [[2]]],\n            \"epsilon\": 1e-6,\n        },\n    ]\n\n    all_results = []\n\n    def run_fba(c_obj, S, l_bounds, u_bounds):\n        \"\"\"Helper to run a single FBA linear program.\"\"\"\n        m, n = S.shape\n        bounds = list(zip(l_bounds, u_bounds))\n        # scipy.optimize.linprog minimizes, so we minimize -c to maximize c\n        res = linprog(-c_obj, A_eq=S, b_eq=np.zeros(m), bounds=bounds, method='highs')\n        \n        # If solver is successful, return the maximized objective. Otherwise, 0.\n        # The zero vector is always feasible in these problems, so infeasibility implies 0 growth.\n        # Unboundedness is not possible with finite upper bounds.\n        if res.success:\n            return -res.fun\n        return 0.0\n\n    def is_reaction_active(rule, deleted_gene_idx):\n        \"\"\"Evaluates a GPR rule given a deleted gene.\"\"\"\n        if rule is None:\n            return True  # Reaction always active if no rule\n        \n        # OR logic over clauses\n        for clause in rule:\n            is_clause_satisfied = True\n            # AND logic over genes in a clause\n            for gene in clause:\n                if gene == deleted_gene_idx:\n                    is_clause_satisfied = False\n                    break\n            if is_clause_satisfied:\n                return True # One satisfied clause is enough\n        \n        return False # No clause was satisfied\n\n    for case in test_cases:\n        S, l, u, c = case[\"S\"], case[\"l\"], case[\"u\"], case[\"c\"]\n        G, gpr_rules, epsilon = case[\"G\"], case[\"gpr_rules\"], case[\"epsilon\"]\n        \n        # 1. Compute wild-type growth\n        z_wt = run_fba(c, S, l, u)\n\n        # 2. Check for viability. If not viable, no genes are essential.\n        if z_wt  epsilon:\n            all_results.append([])\n            continue\n\n        # 3. Perform single gene deletion analysis\n        essential_genes = []\n        for g_idx in range(G):\n            # Create copies of bounds for the knockout simulation\n            l_ko, u_ko = l.copy(), u.copy()\n\n            # Apply GPR logic for the deleted gene\n            for i, rule in enumerate(gpr_rules):\n                if not is_reaction_active(rule, g_idx):\n                    # Knock out the reaction by setting bounds to 0\n                    l_ko[i] = 0.0\n                    u_ko[i] = 0.0\n            \n            # Compute knockout growth\n            z_ko = run_fba(c, S, l_ko, u_ko)\n\n            # 4. Check essentiality criterion\n            if z_ko  epsilon:\n                essential_genes.append(g_idx)\n        \n        essential_genes.sort()\n        all_results.append(essential_genes)\n\n    # 5. Format output\n    formatted_results = []\n    for res_list in all_results:\n        # Convert list to string like '[1,2,3]' and remove spaces\n        s = str(res_list).replace(\" \", \"\")\n        formatted_results.append(s)\n\n    # Join the strings with commas and enclose in brackets\n    output_str = f\"[{','.join(formatted_results)}]\"\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "在单基因敲除分析的基础上，本练习将探索合成致死的概念，即两个非必需基因的同时缺失导致细胞死亡。您将使用一个简化的代谢模型来实施双基因删除模拟，并应用识别合成致死相互作用的正式标准，这是药物靶点发现和理解网络冗余性的一个关键策略。",
            "id": "3313293",
            "problem": "给定一个最小的稳态代谢网络，要求您使用通量平衡分析 (FBA) 来实施双基因敲除模拟，以确定合成致死。从第一性原理出发，FBA 假设细胞内浓度处于准稳态，从而施加了线性约束 $$S \\, v = 0,$$ 其中 $S$ 是化学计量矩阵，$v$ 是反应通量向量。反应通量受限于 $$\\ell \\le v \\le u,$$ 其中 $\\ell$ 和 $u$ 分别是下界和上界。细胞生长的替代指标通过最大化一个线性目标函数来表示：$$\\max_{v} \\; c^\\top v.$$ 基因敲除通过基因-蛋白质-反应 (GPR) 映射传播至反应敲除：如果一个反应所需的基因被敲除，则相应反应的通量界限被设为零。活性定义为最优目标值是否至少达到一个阈值；对于一个基因对，合成致死意味着每次单基因敲除都有活性，而双基因敲除则没有活性。\n\n网络定义：\n- 代谢物：内源葡萄糖 $G$、中间物 $X$ 和中间物 $Y$。\n- 反应：\n    - $r_1$：葡萄糖摄取，表示为外部来源到内源 $G$。\n    - $r_2$：$G \\rightarrow X$。\n    - $r_3$：$G \\rightarrow Y$。\n    - $r_4$：$X + Y \\rightarrow$ 生物质流出。\n    - $r_5$：$G \\rightarrow$ 生物质流出。\n- 化学计量矩阵 $S \\in \\mathbb{R}^{3 \\times 5}$，代谢物行序为 $(G, X, Y)$，反应列序为 $(r_1, r_2, r_3, r_4, r_5)$：\n$$\nS =\n\\begin{bmatrix}\n+1  -1  -1  0  -1 \\\\\n0  +1  0  -1  0 \\\\\n0  0  +1  -1  0 \\\\\n\\end{bmatrix}.\n$$\n- 目标函数是产生生物质的通量之和，即 $c = [0, 0, 0, 1, 1]^\\top$，因此目标值为 $v_4 + v_5$。\n- 界限：\n    - 所有反应都是不可逆的，其下界为 $\\ell_i = 0$，$i \\in \\{1,2,3,4,5\\}$。\n    - 葡萄糖摄取反应 $r_1$ 的上界为 $u_1 = U$，其中 $U$ 是一个非负常数（单位为毫摩尔/克干重·小时，缩写为 mmol/(gDW·h)）。\n    - 所有其他反应的上界为 $u_i = L$，$i \\in \\{2,3,4,5\\}$，其中 $L$ 是一个大的有限常数（使用 $L = 10^6$）。\n- 基因-蛋白质-反应 (GPR) 映射：\n    - $r_2$ 需要基因 $gA$。\n    - $r_3$ 需要基因 $gB$。\n    - $r_4$ 需要基因 $gC$。\n    - $r_5$ 需要基因 $gD$。\n    - $r_1$（摄取）在此设置中被视为受环境限制，而非受基因限制。\n- 基因敲除规则：敲除基因 $g$ 会将每个需要 $g$ 的 GPR 对应的反应 $r_j$ 的通量上下界设置为 $u_j = \\ell_j = 0$，而其他边界保持不变。\n- 活性判据：给定阈值 $\\tau \\ge 0$（单位为 mmol/(gDW·h)），如果最优目标值满足 $v_4^\\star + v_5^\\star \\ge \\tau$，则菌株具有活性。\n- 基因对 $(g_p, g_q)$ 的合成致死判据：在相同的 $(U, \\tau)$ 条件下进行评估，两次单基因敲除均有活性，双基因敲除则无活性，且野生型有活性。\n\n任务：\n- 实现一个程序，对每个测试用例执行以下操作：\n    - 对野生型进行 FBA 计算最优目标值。\n    - 分别对 $g_p$ 和 $g_q$ 进行单基因敲除，并对每种情况进行 FBA。\n    - 对 $(g_p, g_q)$ 进行双基因敲除并进行 FBA。\n    - 返回一个布尔值，指示是否如上文定义的那样存在合成致死。\n\n所有通量和阈值的单位均为 mmol/(gDW·h)；不涉及其他单位。不使用角度。最终输出为布尔值。\n\n测试套件：\n- 情况 1：$(gA, gD)$，其中 $U = 10$ 且 $\\tau = 1.0$。\n- 情况 2：$(gA, gB)$，其中 $U = 10$ 且 $\\tau = 0.5$。\n- 情况 3：$(gB, gD)$，其中 $U = 8$ 且 $\\tau = 4.0$。\n- 情况 4：$(gA, gD)$，其中 $U = 0$ 且 $\\tau = 0.0$。\n- 情况 5：$(gC, gD)$，其中 $U = 6$ 且 $\\tau = 2.5$。\n\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如， $[{\\text{True}},{\\text{False}},\\dots]$），不含空格。",
            "solution": "我们从稳态质量平衡假设开始，即在感兴趣的时间尺度上，细胞内代谢物浓度近似恒定，这产生了线性约束 $$S \\, v = 0,$$ 其中 $S$ 是化学计量矩阵，$v$ 是反应通量向量。通量平衡分析 (FBA) 提出了一个线性规划问题：$$\\max_{v} \\; c^\\top v \\quad \\text{subject to} \\quad S v = 0, \\quad \\ell \\le v \\le u.$$ 这依赖于一个被广泛使用且经过充分检验的观察结果：在稳态下，代谢通量会重新分配，以在物理化学约束下最大化某个细胞目标。\n\n在我们的网络中，代谢物是 $G$、$X$ 和 $Y$，反应按 $(r_1, r_2, r_3, r_4, r_5)$ 排序，其化学计量关系为\n$$\nS =\n\\begin{bmatrix}\n+1  -1  -1  0  -1 \\\\\n0  +1  0  -1  0 \\\\\n0  0  +1  -1  0 \\\\\n\\end{bmatrix}.\n$$\n这些约束展开为：\n- 对于代谢物 $G$：$$+1 \\cdot v_1 - 1 \\cdot v_2 - 1 \\cdot v_3 - 1 \\cdot v_5 = 0.$$\n- 对于代谢物 $X$：$$+1 \\cdot v_2 - 1 \\cdot v_4 = 0 \\;\\Rightarrow\\; v_4 = v_2.$$\n- 对于代谢物 $Y$：$$+1 \\cdot v_3 - 1 \\cdot v_4 = 0 \\;\\Rightarrow\\; v_4 = v_3.$$\n\n因此，在稳态下，通过 $r_4$ 汇入生物质的 $X$ 和 $Y$ 通路需要相等的通量 $v_2 = v_3 = v_4$，而 $G$ 则由 $v_1 = v_2 + v_3 + v_5 = 2 v_4 + v_5$ 平衡。所有反应都是不可逆的，下界为 $\\ell_i = 0$。摄取反应的上界为 $u_1 = U$ (mmol/(gDW·h))，而内部反应具有较大的上界 $u_i = L$，$i \\in \\{2,3,4,5\\}$，其中 $L = 10^6$。目标是最大化 $$c^\\top v = v_4 + v_5.$$\n\n基因通过基因-蛋白质-反应 (GPR) 映射调控反应：$gA \\rightarrow r_2$、$gB \\rightarrow r_3$、$gC \\rightarrow r_4$、$gD \\rightarrow r_5$。敲除一个基因会将相应反应的边界设置为零（$\\ell_j = u_j = 0$），从而有效地将该反应从可行集中移除。活性由最优目标值是否满足 $$v_4^\\star + v_5^\\star \\ge \\tau$$ 来定义，其中 $\\tau$ 是给定的阈值 (mmol/(gDW·h))。对于 $(g_p, g_q)$ 的合成致死成立的条件是：在相同的 $(U, \\tau)$ 下评估时，野生型有活性，两次单基因敲除都有活性，而双基因敲除则无活性。\n\n算法设计：\n- 针对每种情况（野生型、单基因敲除、双基因敲除），使用相同的化学计量约束和界限来构建线性规划问题，其中基因敲除会将需要被敲除基因的反应的界限设为零。\n- 使用一个线性规划求解器来最大化 $c^\\top v$。由于常见的求解器是最小化问题，我们等价地最小化 $-c^\\top v$。等式约束 $S v = 0$ 和界限 $\\ell \\le v \\le u$ 都被强制执行。\n- 计算每种情况下的最优目标值 $z^\\star = v_4^\\star + v_5^\\star$，并与阈值 $\\tau$ 进行比较，以确定活性和合成致死。\n\n对网络结构的推理提供了直观理解：\n- 当所有反应都存在时，通过 $r_5$ 的 $G \\rightarrow$ 生物质路径每单位目标消耗 1 单位的 $G$，而通过 $r_4$ 的 $X + Y \\rightarrow$ 生物质路径每单位目标需要 2 单位的 $G$（因为 $v_2 = v_3 = v_4$，且每个反应消耗 1 单位的 $G$）。因此，对于固定的摄取上限 $U$，最优解会偏好 $r_5$（直接路径），并得到 $$z^\\star_{\\text{WT}} = U.$$\n- 如果 $r_5$ 被敲除（通过敲除 $gD$），唯一的生长路径是通过 $r_4$，这需要每单位生长消耗 2 单位的 $G$，得到 $$2 v_4 \\le U \\;\\Rightarrow\\; z^\\star_{\\text{single }gD} = v_4^\\star \\le \\frac{U}{2}.$$ 在内部界限很大的情况下，最优选择是 $v_4^\\star = \\frac{U}{2}$，所以 $$z^\\star_{\\text{single }gD} = \\frac{U}{2}.$$\n- 如果 $r_2$ 或 $r_3$ 被敲除（通过敲除 $gA$ 或 $gB$），根据化学计量关系 $v_4 = 0$，唯一的生长路径是通过 $r_5$（如果存在），得到 $$z^\\star_{\\text{single }gA} = U \\quad \\text{和} \\quad z^\\star_{\\text{single }gB} = U.$$\n- 对于双基因敲除：\n    - $(gA, gD)$ 敲除 $r_2$ 和 $r_5$，留下 $r_3$ 和 $r_4$，但由于 $v_2 = 0$，等式 $v_4 = v_2$ 意味着 $v_4 = 0$，并且由于 $r_5$ 也被敲除，没有替代路径，所以 $$z^\\star_{\\text{double }(gA,gD)} = 0.$$\n    - $(gB, gD)$ 与 $(gA, gD)$ 对称，同样得到 $$z^\\star_{\\text{double }(gB,gD)} = 0.$$\n    - $(gA, gB)$ 敲除 $r_2$ 和 $r_3$，所以 $v_4 = 0$，但 $r_5$ 仍然存在，得到 $$z^\\star_{\\text{double }(gA,gB)} = U.$$\n    - $(gC, gD)$ 敲除两个生物质反应 $r_4$ 和 $r_5$，得到 $$z^\\star_{\\text{double }(gC,gD)} = 0.$$\n\n应用阈值：\n- 情况 1：$(gA, gD)$，$U = 10$，$\\tau = 1.0$。\n    - 野生型：$10 \\ge 1.0$，有活性。\n    - 单敲除 $gA$：$10 \\ge 1.0$，有活性；单敲除 $gD$：$5 \\ge 1.0$，有活性。\n    - 双敲除：$0  1.0$，无活性。\n    - 合成致死：True。\n- 情况 2：$(gA, gB)$，$U = 10$，$\\tau = 0.5$。\n    - 野生型：$10 \\ge 0.5$，有活性。\n    - 单敲除 $gA$：$10 \\ge 0.5$，有活性；单敲除 $gB$：$10 \\ge 0.5$，有活性。\n    - 双敲除：$10 \\ge 0.5$，有活性。\n    - 合成致死：False。\n- 情况 3：$(gB, gD)$，$U = 8$，$\\tau = 4.0$。\n    - 野生型：$8 \\ge 4.0$，有活性。\n    - 单敲除 $gB$：$8 \\ge 4.0$，有活性；单敲除 $gD$：$\\frac{8}{2} = 4.0 \\ge 4.0$，在等号处有活性。\n    - 双敲除：$0  4.0$，无活性。\n    - 合成致死：True。\n- 情况 4：$(gA, gD)$，$U = 0$，$\\tau = 0.0$。\n    - 野生型：$0 \\ge 0.0$，在等号处有活性。\n    - 单敲除 $gA$：$0 \\ge 0.0$，有活性；单敲除 $gD$：$0 \\ge 0.0$，有活性。\n    - 双敲除：$0 \\ge 0.0$，有活性。\n    - 合成致死：False。\n- 情况 5：$(gC, gD)$，$U = 6$，$\\tau = 2.5$。\n    - 野生型：$6 \\ge 2.5$，有活性。\n    - 单敲除 $gC$：$6 \\ge 2.5$，有活性；单敲除 $gD$：$3 \\ge 2.5$，有活性。\n    - 双敲除：$0  2.5$，无活性。\n    - 合成致死：True。\n\n因此，预期的布尔值结果按顺序为 $[{\\text{True}},{\\text{False}},{\\text{True}},{\\text{False}},{\\text{True}}]$。该程序为通用性实现了线性规划，并通过对每种情况求解优化问题并应用合成致死判据来重现这些结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef fba_growth(U, deleted_genes):\n    \"\"\"\n    Compute the maximal growth (objective value v4 + v5) for the given uptake bound U\n    and a set of deleted genes under steady-state FBA with linear constraints.\n    \"\"\"\n    # Stoichiometric matrix S for metabolites (G, X, Y) and reactions (r1..r5)\n    S = np.array([\n        [ 1.0, -1.0, -1.0,  0.0, -1.0],  # G balance\n        [ 0.0,  1.0,  0.0, -1.0,  0.0],  # X balance\n        [ 0.0,  0.0,  1.0, -1.0,  0.0],  # Y balance\n    ])\n\n    # Objective c: maximize v4 + v5 - in linprog, minimize -c^T v\n    c = np.array([0.0, 0.0, 0.0, 1.0, 1.0])\n    c_min = -c  # since linprog minimizes\n\n    # Large upper bound for internal reactions\n    L = 1e6\n\n    # Base bounds: all irreversible, r1 upper bound = U\n    lower_bounds = np.zeros(5, dtype=float)\n    upper_bounds = np.array([U, L, L, L, L], dtype=float)\n\n    # Gene-to-reaction mapping\n    gene_to_reactions = {\n        'gA': [1],  # r2\n        'gB': [2],  # r3\n        'gC': [3],  # r4\n        'gD': [4],  # r5\n        # r1 uptake is environmentally constrained (no gene mapping)\n    }\n\n    # Apply gene deletions: set bounds of mapped reactions to zero\n    for g in deleted_genes:\n        for rxn_idx in gene_to_reactions.get(g, []):\n            lower_bounds[rxn_idx] = 0.0\n            upper_bounds[rxn_idx] = 0.0\n\n    bounds = list(zip(lower_bounds.tolist(), upper_bounds.tolist()))\n\n    # Equality constraints Sv = 0\n    A_eq = S\n    b_eq = np.zeros(S.shape[0], dtype=float)\n\n    # Solve LP\n    res = linprog(c=c_min, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n    if not res.success:\n        # If infeasible or solver failed, return 0.0 growth (conservative)\n        return 0.0\n\n    v = res.x\n    growth = float(v[3] + v[4])  # v4 + v5\n    # Numerical safety: tiny negative due to tolerance - clip to 0\n    if growth  0 and growth > -1e-9:\n        growth = 0.0\n    return growth\n\ndef is_synthetic_lethal(g1, g2, U, tau):\n    \"\"\"\n    Determine synthetic lethality for a gene pair (g1, g2) under (U, tau):\n    WT viable, both singles viable, double non-viable.\n    \"\"\"\n    wt_growth = fba_growth(U, deleted_genes=[])\n    g1_growth = fba_growth(U, deleted_genes=[g1])\n    g2_growth = fba_growth(U, deleted_genes=[g2])\n    double_growth = fba_growth(U, deleted_genes=[g1, g2])\n\n    wt_ok = wt_growth >= tau\n    singles_ok = (g1_growth >= tau) and (g2_growth >= tau)\n    double_fail = double_growth  tau\n\n    return wt_ok and singles_ok and double_fail\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each test case: (gene1, gene2, U, tau)\n    test_cases = [\n        ('gA', 'gD', 10.0, 1.0),   # Case 1\n        ('gA', 'gB', 10.0, 0.5),   # Case 2\n        ('gB', 'gD', 8.0, 4.0),    # Case 3\n        ('gA', 'gD', 0.0, 0.0),    # Case 4\n        ('gC', 'gD', 6.0, 2.5),    # Case 5\n    ]\n\n    results = []\n    for g1, g2, U, tau in test_cases:\n        result = is_synthetic_lethal(g1, g2, U, tau)\n        results.append(result)\n\n    # Final print statement in the exact required format: no spaces.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "本练习将超越致死或存活的二元分类，引入一个量化遗传相互作用的框架。通过基于FBA预测的适应度值计算上位性系数（epistasis coefficient），您将学会如何确定两个基因是协同作用还是拮抗作用。这种量化分析能为我们更深入地洞察代谢网络的鲁棒性和系统架构提供有力工具。",
            "id": "3313307",
            "problem": "考虑一个最小代谢网络模型，其中单一限制性碳底物通过两条平行的通路供给生物量生产，每条通路都由一个独特的基因编码。该生物体在流平衡分析（FBA）框架下进行建模，该框架假设在容量限制下达到稳态质量平衡和线性动力学。设内部代谢物池用 $X$ 表示，外部底物摄取通量用 $v_1$ 表示，两个生物量生产反应用 $v_2$ 和 $v_3$ 表示。生物量生产通量定义为 $v_{\\mathrm{bio}} = v_2 + v_3$。$X$ 的稳态质量平衡为 $v_1 - v_2 - v_3 = 0$。所有反应在正方向上都是不可逆的。\n\n野生型生物体具有以下限制：\n- 摄取限制：$0 \\leq v_1 \\leq 9$。\n- 通路 A 容量：$0 \\leq v_2 \\leq 6$，由基因 $g_A$ 编码。\n- 通路 B 容量：$0 \\leq v_3 \\leq 5$，由基因 $g_B$ 编码。\n\n假设在任一通路中，每消耗一个单位的 $X$，生物量产率为 $1$，即 $v_2$ 或 $v_3$ 的每个单位通量对 $v_{\\mathrm{bio}}$ 的贡献相等，并消耗一个单位的 $X$。除了 $v_2$ 和 $v_3$ 之外，没有其他消耗 $X$ 的反应，也没有 $X$ 的分泌。\n\n通过将相应的反应容量设置为零来模拟基因敲除：\n- 敲除 $g_A$：将 $v_2$ 的上限设置为 $0$。\n- 敲除 $g_B$：将 $v_3$ 的上限设置为 $0$。\n- 双敲除 $g_A$ 和 $g_B$：将两个上限都设置为 $0$。\n\n使用 FBA 的核心原则，即稳态约束为 $S v = 0$，目标是在容量限制和质量平衡的约束下最大化 $v_{\\mathrm{bio}}$，计算野生型、单基因敲除突变体和双基因敲除突变体的最大生物量生产通量。将基因型的相对适应度定义为 $w = W / W_0$，其中 $W$ 是其最大生物量通量，$W_0$ 是野生型的最大生物量通量。在乘法零模型下，将上位性系数定义为 $\\varepsilon = w_{AB} - w_A w_B$，其中 $A$ 和 $B$ 分别指基因 $g_A$ 和 $g_B$ 的敲除。\n\n计算该系统的上位性系数 $\\varepsilon$。将最终答案表示为一个精确值，不带单位。无需四舍五入。",
            "solution": "首先对问题进行验证，以确保其具有科学依据、问题适定且客观。\n\n**步骤1：提取已知条件**\n- **变量**：内部代谢物 $X$；通量 $v_1$ (摄取)，$v_2$ (通路 A)，$v_3$ (通路 B)。\n- **定义**：\n  - 生物量生产通量：$v_{\\mathrm{bio}} = v_2 + v_3$。\n  - 相对适应度：$w = W / W_0$，其中 $W$ 是给定基因型的最大生物量通量，$W_0$ 是野生型的最大生物量通量。\n  - 上位性系数：$\\varepsilon = w_{AB} - w_A w_B$，其中 $A$ 和 $B$ 分别表示基因 $g_A$ 和 $g_B$ 的敲除。\n- **约束与条件**：\n  - 稳态质量平衡：$v_1 - v_2 - v_3 = 0$。\n  - 野生型通量限制：\n    - $0 \\leq v_1 \\leq 9$。\n    - $0 \\leq v_2 \\leq 6$ (通路 A，基因 $g_A$)。\n    - $0 \\leq v_3 \\leq 5$ (通路 B，基因 $g_B$)。\n  - 基因敲除效应：\n    - 敲除 $g_A$：$v_2$ 的上限变为 $0$。\n    - 敲除 $g_B$：$v_3$ 的上限变为 $0$。\n    - 双敲除（$g_A$ 和 $g_B$）：$v_2$ 和 $v_3$ 的上限均变为 $0$。\n- **目标函数**：对每种基因型，最大化 $v_{\\mathrm{bio}}$。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据**：该问题是流平衡分析（FBA）的一个标准应用，FBA是计算系统生物学中分析代谢网络的基石方法。最大化生物学目标函数（生物量生产）、基因敲除和上位性等概念是该领域的核心。该模型虽然是最小化的，但在科学上是合理的。\n- **问题适定**：对于每种基因型，该问题被表述为一个线性规划问题：在一组线性等式和不等式约束下，最大化一个线性目标函数（$v_2 + v_3$）。对于每种情况，可行集是一个紧凸多胞体，在此类集合上的线性函数保证有唯一的最大值。该问题是适定的。\n- **客观性**：该问题以精确的数学定义和约束进行陈述。所有术语都是客观且明确的。\n- **结论**：该问题是有效的，因为它在代谢建模的框架内是自洽、一致且科学合理的。\n\n**步骤3：结论与行动**\n问题有效。下面提供完整解法。\n\n问题的核心是为每种基因型求解一系列线性规划问题，以找到最大生物量生产通量（$W$）。在所有情况下，目标函数都是最大化 $v_{\\mathrm{bio}} = v_2 + v_3$。约束条件根据基因型而变化。根据稳态质量平衡方程，$v_1 = v_2 + v_3$，因此目标等同于最大化底物摄取通量 $v_1$。\n\n1.  **野生型（WT）最大生物量通量, $W_0$**\n    优化问题为：\n    最大化 $v_{\\mathrm{bio}} = v_2 + v_3$\n    约束条件：\n    $v_1 = v_2 + v_3$\n    $0 \\leq v_1 \\leq 9$\n    $0 \\leq v_2 \\leq 6$\n    $0 \\leq v_3 \\leq 5$\n\n    为了最大化 $v_2 + v_3$，我们必须考虑各个通量的约束。通过两条通路的总潜在通量受其各自容量之和的限制：$v_2 + v_3 \\leq v_{2,\\max} + v_{3,\\max} = 6 + 5 = 11$。底物摄取受 $v_1 \\leq 9$ 的限制。由于 $v_1 = v_2 + v_3$，生物量生产既受总通路容量的限制，也受底物摄取的限制。$v_{\\mathrm{bio}}$ 的有效上限是 $\\min(9, 11) = 9$。\n    因此，野生型的最大生物量通量为 $W_0 = 9$。这可以通过例如通量分布 $(v_1, v_2, v_3) = (9, 4, 5)$ 或 $(9, 6, 3)$ 来实现，两者都满足所有约束条件。\n\n2.  **单基因敲除突变体 $\\Delta g_A$ 的最大生物量通量, $W_A$**\n    对于此突变体，基因 $g_A$ 被敲除，因此 $v_2$ 的上限设为 $0$。由于通量是非负的，这意味着 $v_2 = 0$。\n    优化问题为：\n    最大化 $v_{\\mathrm{bio}} = 0 + v_3 = v_3$\n    约束条件：\n    $v_1 = v_3$\n    $0 \\leq v_1 \\leq 9$\n    $0 \\leq v_3 \\leq 5$\n\n    由 $v_1 = v_3$ 可知，对 $v_3$ 的约束为 $v_3 \\leq 9$ 和 $v_3 \\leq 5$。更严格的约束是 $v_3 \\leq 5$。\n    因此，最大生物量通量为 $W_A = \\max(v_3) = 5$。\n\n3.  **单基因敲除突变体 $\\Delta g_B$ 的最大生物量通量, $W_B$**\n    对于此突变体，基因 $g_B$ 被敲除，因此 $v_3$ 的上限设为 $0$。这意味着 $v_3 = 0$。\n    优化问题为：\n    最大化 $v_{\\mathrm{bio}} = v_2 + 0 = v_2$\n    约束条件：\n    $v_1 = v_2$\n    $0 \\leq v_1 \\leq 9$\n    $0 \\leq v_2 \\leq 6$\n\n    由 $v_1 = v_2$ 可知，对 $v_2$ 的约束为 $v_2 \\leq 9$ 和 $v_2 \\leq 6$。更严格的约束是 $v_2 \\leq 6$。\n    因此，最大生物量通量为 $W_B = \\max(v_2) = 6$。\n\n4.  **双基因敲除突变体 $\\Delta g_A \\Delta g_B$ 的最大生物量通量, $W_{AB}$**\n    对于此突变体，两个基因都被敲除，因此 $v_2$ 和 $v_3$ 的上限都设为 $0$。这意味着 $v_2 = 0$ 且 $v_3 = 0$。\n    目标是最大化 $v_{\\mathrm{bio}} = v_2 + v_3 = 0 + 0 = 0$。\n    最大生物量通量显然为 $W_{AB} = 0$。通量分布必须为 $(v_1, v_2, v_3) = (0, 0, 0)$。这代表了一种合成致死相互作用。\n\n5.  **相对适应度的计算**\n    基因型的相对适应度定义为 $w = W / W_0$。使用 $W_0=9$：\n    -   $\\Delta g_A$ 的相对适应度：$w_A = \\frac{W_A}{W_0} = \\frac{5}{9}$。\n    -   $\\Delta g_B$ 的相对适应度：$w_B = \\frac{W_B}{W_0} = \\frac{6}{9} = \\frac{2}{3}$。\n    -   $\\Delta g_A \\Delta g_B$ 的相对适应度：$w_{AB} = \\frac{W_{AB}}{W_0} = \\frac{0}{9} = 0$。\n\n6.  **上位性系数的计算**\n    上位性系数 $\\varepsilon$ 由乘法零模型定义：$\\varepsilon = w_{AB} - w_A w_B$。\n    代入计算出的相对适应度值：\n    $$ \\varepsilon = 0 - \\left(\\frac{5}{9}\\right) \\left(\\frac{2}{3}\\right) $$\n    $$ \\varepsilon = - \\frac{10}{27} $$\n    负的上位性值表示协同相互作用，即两个突变的组合效应比它们各自效应的预期更严重。",
            "answer": "$$\\boxed{-\\frac{10}{27}}$$"
        }
    ]
}