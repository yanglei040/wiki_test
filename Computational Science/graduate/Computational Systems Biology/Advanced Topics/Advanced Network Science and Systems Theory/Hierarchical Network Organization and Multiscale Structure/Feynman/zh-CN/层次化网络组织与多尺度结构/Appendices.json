{
    "hands_on_practices": [
        {
            "introduction": "我们如何从一组生物组分（如蛋白质或基因）的成对相似性数据中，系统地揭示它们潜在的层次化组织？层次凝聚聚类（Hierarchical Agglomerative Clustering, HAC）提供了一种强大的、自下而上的方法来解决这个问题。通过该练习 ，您将亲手应用经典的单链接聚类算法，从一个给定的相似性矩阵出发，逐步构建出一个树状图，从而将数据中隐含的“模块中的模块”结构直观地呈现出来。",
            "id": "3318635",
            "problem": "在计算系统生物学中，可以通过对节点相似性矩阵进行聚类来推断分层网络组织和多尺度结构，从而揭示不同尺度上的模块。考虑一个包含$5$个分子子系统的系统，标记为$1,2,3,4,5$。给定对称相似性矩阵 $S \\in \\mathbb{R}^{5 \\times 5}$，其元素为 $s_{ij}$，其中对所有$i$有$s_{ii} = 1$，且当 $i \\neq j$ 时有 $s_{ij} \\in [0,1]$：\n$$\nS = \\begin{pmatrix}\n1.00  0.95  0.67  0.69  0.90 \\\\\n0.95  1.00  0.66  0.70  0.88 \\\\\n0.67  0.66  1.00  0.92  0.72 \\\\\n0.69  0.70  0.92  1.00  0.71 \\\\\n0.90  0.88  0.72  0.71  1.00\n\\end{pmatrix}.\n$$\n从以下定义出发：(i) 相异性可通过相似性计算得出，$d_{ij} = 1 - s_{ij}$；(ii) 单链接层次凝聚聚类 (HAC) 在每一步合并具有最小簇间相异性的两个簇，其中簇 $A$ 和 $B$ 之间的距离为 $\\min_{i \\in A, j \\in B} d_{ij}$；(iii) 两个叶节点 $i$ 和 $j$ 之间的超度量（共表型）距离 $u_{ij}$ 等于在树状图中 $i$ 和 $j$ 首次属于同一个簇时的合并高度，请执行以下操作：\n\n- 首先通过相似性矩阵 $S$ 构建相异性矩阵 $D$，然后对 $D$ 应用单链接 HAC，不断合并簇，直到只剩下一个簇。如果在选择要合并的簇时出现平局，则选择簇标签按字典序最小的有序对来打破平局，其中簇以其排序后的成员集合进行标记。\n- 根据生成的树状图，确定所有超度量距离 $u_{ij}$，其中 $1 \\leq i  j \\leq 5$。\n\n最后，计算标量\n$$\nU_{\\mathrm{sum}} = \\sum_{1 \\leq i  j \\leq 5} u_{ij}.\n$$\n将您的最终答案表示为一个无量纲实数，并四舍五入到$4$位有效数字。",
            "solution": "该问题已经过验证，被认为是合理、适定、客观且在计算系统生物学领域有科学依据的。它提供了一套完整且一致的数据和定义，可以通过标准的算法程序获得唯一解。\n\n求解过程分为四个主要步骤：\n1.  将相似性矩阵 $S$ 转换为相异性矩阵 $D$。\n2.  对 $D$ 应用单链接层次凝聚聚类 (HAC)。\n3.  从生成的树状图中确定超度量（共表型）距离 $u_{ij}$。\n4.  计算最终的和 $U_{\\mathrm{sum}}$。\n\n**步骤1：计算相异性矩阵**\n\n相异性 $d_{ij}$ 定义为 $d_{ij} = 1 - s_{ij}$。使用给定的相似性矩阵 $S$：\n$$\nS = \\begin{pmatrix}\n1.00  0.95  0.67  0.69  0.90 \\\\\n0.95  1.00  0.66  0.70  0.88 \\\\\n0.67  0.66  1.00  0.92  0.72 \\\\\n0.69  0.70  0.92  1.00  0.71 \\\\\n0.90  0.88  0.72  0.71  1.00\n\\end{pmatrix}\n$$\n得到的相异性矩阵 $D$ 是：\n$$\nD = 1 - S = \\begin{pmatrix}\n0.00  0.05  0.33  0.31  0.10 \\\\\n0.05  0.00  0.34  0.30  0.12 \\\\\n0.33  0.34  0.00  0.08  0.28 \\\\\n0.31  0.30  0.08  0.00  0.29 \\\\\n0.10  0.12  0.28  0.29  0.00\n\\end{pmatrix}\n$$\n对角线元素为 $d_{ii} = 1 - 1 = 0$，符合预期。\n\n**步骤2：执行单链接层次凝聚聚类 (HAC)**\n\n聚类过程从5个子系统各自作为独立的簇开始：$\\{1\\}, \\{2\\}, \\{3\\}, \\{4\\}, \\{5\\}$。在每一步，我们合并具有最小簇间相异性的两个簇。对于单链接，两个簇 $A$ 和 $B$ 之间的距离由 $d(A, B) = \\min_{i \\in A, j \\in B} d_{ij}$ 给出。\n\n**迭代 1：**\n初始的簇间距离是矩阵 $D$ 的元素。最小的非对角线元素是 $d_{12} = 0.05$。\n- 合并簇 $\\{1\\}$ 和 $\\{2\\}$，形成新簇 $\\{1, 2\\}$。\n- 合并高度（相异性）为 $0.05$。\n- 当前簇：$\\{1, 2\\}, \\{3\\}, \\{4\\}, \\{5\\}$。\n\n**迭代 2：**\n我们计算新簇 $\\{1, 2\\}$ 与其余簇之间的相异性：\n- $d(\\{1, 2\\}, \\{3\\}) = \\min(d_{13}, d_{23}) = \\min(0.33, 0.34) = 0.33$。\n- $d(\\{1, 2\\}, \\{4\\}) = \\min(d_{14}, d_{24}) = \\min(0.31, 0.30) = 0.30$。\n- $d(\\{1, 2\\}, \\{5\\}) = \\min(d_{15}, d_{25}) = \\min(0.10, 0.12) = 0.10$。\n其他距离保持不变：$d_{34} = 0.08$，$d_{35} = 0.28$，$d_{45} = 0.29$。\n当前簇间相异性的集合是 $\\{0.33, 0.30, 0.10, 0.08, 0.28, 0.29\\}$。最小值是 $d_{34} = 0.08$。\n- 合并簇 $\\{3\\}$ 和 $\\{4\\}$，形成新簇 $\\{3, 4\\}$。\n- 合并高度为 $0.08$。\n- 当前簇：$\\{1, 2\\}, \\{3, 4\\}, \\{5\\}$。\n\n**迭代 3：**\n我们计算当前簇之间的相异性：\n- $d(\\{1, 2\\}, \\{5\\}) = 0.10$（来自上一步）。\n- $d(\\{3, 4\\}, \\{5\\}) = \\min(d_{35}, d_{45}) = \\min(0.28, 0.29) = 0.28$。\n- $d(\\{1, 2\\}, \\{3, 4\\}) = \\min(d_{13}, d_{14}, d_{23}, d_{24}) = \\min(0.33, 0.31, 0.34, 0.30) = 0.30$。\n当前簇间相异性的集合是 $\\{0.10, 0.28, 0.30\\}$。最小值是 $0.10$。\n- 合并簇 $\\{1, 2\\}$ 和 $\\{5\\}$，形成新簇 $\\{1, 2, 5\\}$。\n- 合并高度为 $0.10$。\n- 当前簇：$\\{1, 2, 5\\}, \\{3, 4\\}$。\n\n**迭代 4：**\n只剩下两个簇。我们计算它们之间的相异性：\n- $d(\\{1, 2, 5\\}, \\{3, 4\\}) = \\min(d(\\{1, 2\\}, \\{3, 4\\}), d(\\{5\\}, \\{3, 4\\})) = \\min(0.30, 0.28) = 0.28$。\n- 合并簇 $\\{1, 2, 5\\}$ 和 $\\{3, 4\\}$，形成最终的簇 $\\{1, 2, 3, 4, 5\\}$。\n- 合并高度为 $0.28$。\n聚类过程完成。\n\n**步骤3：确定超度量（共表型）距离**\n\n两个初始项 $i$ 和 $j$ 之间的超度量距离 $u_{ij}$ 是它们首次出现在同一个簇中的合并高度。根据 HAC 步骤：\n- $\\{1\\}$ 和 $\\{2\\}$ 的合并发生在高度 $0.05$ 处。所以，$u_{12} = 0.05$。\n- $\\{3\\}$ 和 $\\{4\\}$ 的合并发生在高度 $0.08$ 处。所以，$u_{34} = 0.08$。\n- $\\{1, 2\\}$ 和 $\\{5\\}$ 的合并发生在高度 $0.10$ 处。这是来自 $\\{1, 2\\}$ 的元素首次与 $5$ 聚类。因此，$u_{15} = 0.10$ 且 $u_{25} = 0.10$。\n- $\\{1, 2, 5\\}$ 和 $\\{3, 4\\}$ 的合并发生在高度 $0.28$ 处。这是来自 $\\{1, 2, 5\\}$ 的元素首次与来自 $\\{3, 4\\}$ 的元素聚类。这适用于 $3 \\times 2 = 6$ 对。\n  - $u_{13} = u_{14} = 0.28$。\n  - $u_{23} = u_{24} = 0.28$。\n  - $u_{35} = u_{45} = 0.28$。（注意 $u_{35} = u_{53}$ 且 $u_{45}=u_{54}$）\n\n总而言之，$\\binom{5}{2} = 10$ 个唯一的超度量距离是：\n- $u_{12} = 0.05$\n- $u_{13} = 0.28$\n- $u_{14} = 0.28$\n- $u_{15} = 0.10$\n- $u_{23} = 0.28$\n- $u_{24} = 0.28$\n- $u_{25} = 0.10$\n- $u_{34} = 0.08$\n- $u_{35} = 0.28$\n- $u_{45} = 0.28$\n\n**步骤4：计算总和**\n\n我们现在计算总和 $U_{\\mathrm{sum}} = \\sum_{1 \\leq i  j \\leq 5} u_{ij}$。\n$$\nU_{\\mathrm{sum}} = u_{12} + u_{13} + u_{14} + u_{15} + u_{23} + u_{24} + u_{25} + u_{34} + u_{35} + u_{45}\n$$\n对值进行分组：\n$$\nU_{\\mathrm{sum}} = (u_{12}) + (u_{34}) + (u_{15} + u_{25}) + (u_{13} + u_{14} + u_{23} + u_{24} + u_{35} + u_{45})\n$$\n$$\nU_{\\mathrm{sum}} = (0.05) + (0.08) + 2 \\times (0.10) + 6 \\times (0.28)\n$$\n$$\nU_{\\mathrm{sum}} = 0.05 + 0.08 + 0.20 + 1.68\n$$\n$$\nU_{\\mathrm{sum}} = 0.13 + 0.20 + 1.68\n$$\n$$\nU_{\\mathrm{sum}} = 0.33 + 1.68\n$$\n$$\nU_{\\mathrm{sum}} = 2.01\n$$\n问题要求答案四舍五入到4位有效数字。精确答案 $2.01$ 有三位有效数字。为了用四位有效数字表示，我们追加一个零。\n$$\nU_{\\mathrm{sum}} \\approx 2.010\n$$",
            "answer": "$$\\boxed{2.010}$$"
        },
        {
            "introduction": "识别出网络的模块化结构后，一个自然的问题是：这种结构如何影响系统的动力学？在某些理想情况下，如果微观状态之间的转换速率在宏观模块划分上表现出特定的一致性，我们就可以在不损失宏观尺度信息的前提下，对动力学模型进行精确简化。本练习  引入了连续时间马尔可夫链的强集总性（strong lumpability）概念，并要求您在一个假设的生化网络模型中检验此条件，从而体验如何将一个复杂的微观状态模型精确地粗粒化为一个更简单的宏观状态模型。",
            "id": "3318660",
            "problem": "一个生物化学信号基序由于磷酸化和衔接蛋白结合构型的不同而表现出四种快速的微观状态。在较长的时间尺度上，假设该系统可以采用一种粗粒化的双宏观状态描述，分别对应于低输出和高输出活动。微观状态动力学被建模为一个连续时间马尔可夫链 (CTMC)，其生成元矩阵为 $Q \\in \\mathbb{R}^{4 \\times 4}$ (单位为 $\\mathrm{min}^{-1}$)，状态标签 $1,2,3,4$ 代表不同的微观构型。该生成元矩阵为\n$$\nQ \\;=\\;\n\\begin{pmatrix}\n-0.9  0.4  0.3  0.2 \\\\\n0.7  -1.2  0.3  0.2 \\\\\n0.25  0.15  -0.9  0.5 \\\\\n0.25  0.15  0.6  -1.0\n\\end{pmatrix}.\n$$\n给定一个建议的双区块划分 $\\mathcal{B} = \\{B_{1}, B_{2}\\}$，其中 $B_{1}=\\{1,2\\}$ (低输出) 且 $B_{2}=\\{3,4\\}$ (高输出)。仅使用CTMC生成元的定义和连续时间马尔可夫链 (CTMC) 的强可集聚性概念，判断划分 $\\mathcal{B}$ 在 CTMC 层面上是否能产生一个有效的强可集聚粗粒化。如果可以，计算在宏观状态集 $\\{B_{1},B_{2}\\}$ 上控制宏观状态过程的聚合 $2 \\times 2$ 生成元矩阵 $\\tilde{Q}$ (单位为 $\\mathrm{min}^{-1}$)。\n\n以 $\\mathrm{min}^{-1}$ 为单位，使用精确小数（不进行四舍五入）表示最终的 $2 \\times 2$ 矩阵。最终矩阵不应包含任何额外评注。",
            "solution": "该问题要求我们判断一个连续时间马尔可夫链 (CTMC) 的状态空间的给定划分是否是强可集聚的，如果是，则计算聚合过程的生成元矩阵。\n\n首先，我们必须验证所提供的矩阵 $Q$ 是否是一个有效的 CTMC 生成元矩阵。一个矩阵 $Q = (Q_{ij})$ 是生成元矩阵当且仅当其非对角元素为非负值（对于 $i \\ne j$ 有 $Q_{ij} \\ge 0$）并且每行元素之和为零（对于所有 $i$ 有 $\\sum_{j} Q_{ij} = 0$）。我们来验证给定的矩阵：\n$$\nQ \\;=\\;\n\\begin{pmatrix}\n-0.9  0.4  0.3  0.2 \\\\\n0.7  -1.2  0.3  0.2 \\\\\n0.25  0.15  -0.9  0.5 \\\\\n0.25  0.15  0.6  -1.0\n\\end{pmatrix}\n$$\n所有非对角元素显然都是非负的。我们检查行和：\n第 1 行：$-0.9 + 0.4 + 0.3 + 0.2 = -0.9 + 0.9 = 0$。\n第 2 行：$0.7 - 1.2 + 0.3 + 0.2 = 1.2 - 1.2 = 0$。\n第 3 行：$0.25 + 0.15 - 0.9 + 0.5 = 0.9 - 0.9 = 0$。\n第 4 行：$0.25 + 0.15 + 0.6 - 1.0 = 1.0 - 1.0 = 0$。\n由于所有条件都满足，$Q$ 是一个有效的生成元矩阵。该问题是良定的。\n\n问题的核心在于 CTMC 强可集聚性的定义。设状态空间为 $S = \\{1, 2, 3, 4\\}$，划分为 $\\mathcal{B} = \\{B_1, B_2, \\dots, B_M\\}$。对于生成元矩阵 $Q$，一个划分是强可集聚的，如果对于任意两个区块（宏观状态）$B_I, B_J \\in \\mathcal{B}$，从任意微观状态 $i \\in B_I$ 到区块 $B_J$ 的转移速率之和是恒定的。也就是说，对于所有 $i, k \\in B_I$，必须满足以下条件：\n$$\n\\sum_{j \\in B_J} Q_{ij} = \\sum_{j \\in B_J} Q_{kj}\n$$\n如果此条件成立，则聚合过程也是一个在宏观状态 $\\{B_1, \\dots, B_M\\}$ 上的 CTMC，其生成元矩阵为 $\\tilde{Q}$，其中元素 $\\tilde{Q}_{IJ}$ 由这个公共和给出。\n\n给定的划分为 $\\mathcal{B} = \\{B_1, B_2\\}$，其中 $B_1 = \\{1,2\\}$ 且 $B_2 = \\{3,4\\}$。我们必须对所有宏观状态对 $(B_I, B_J)$ 检查可集聚性条件。\n\n1.  **源于宏观状态 $B_1 = \\{1,2\\}$ 的转移：**\n    我们需要检查从微观状态 $1$ 和 $2$ 到每个宏观状态（$B_1$ 和 $B_2$）的速率之和是否相等。\n\n    a.  **从 $B_1$ 到 $B_1$ 的速率**：检查是否 $\\sum_{j \\in B_1} Q_{1j} = \\sum_{j \\in B_1} Q_{2j}$。\n        对于微观状态 $i=1$：$\\sum_{j \\in \\{1,2\\}} Q_{1j} = Q_{11} + Q_{12} = -0.9 + 0.4 = -0.5$。\n        对于微观状态 $i=2$：$\\sum_{j \\in \\{1,2\\}} Q_{2j} = Q_{21} + Q_{22} = 0.7 + (-1.2) = -0.5$。\n        和相等。此条件满足。\n\n    b.  **从 $B_1$ 到 $B_2$ 的速率**：检查是否 $\\sum_{j \\in B_2} Q_{1j} = \\sum_{j \\in B_2} Q_{2j}$。\n        对于微观状态 $i=1$：$\\sum_{j \\in \\{3,4\\}} Q_{1j} = Q_{13} + Q_{14} = 0.3 + 0.2 = 0.5$。\n        对于微观状态 $i=2$：$\\sum_{j \\in \\{3,4\\}} Q_{2j} = Q_{23} + Q_{24} = 0.3 + 0.2 = 0.5$。\n        和相等。此条件也满足。\n\n2.  **源于宏观状态 $B_2 = \\{3,4\\}$ 的转移：**\n    我们需要检查从微观状态 $3$ 和 $4$ 到每个宏观状态（$B_1$ 和 $B_2$）的速率之和是否相等。\n\n    a.  **从 $B_2$ 到 $B_1$ 的速率**：检查是否 $\\sum_{j \\in B_1} Q_{3j} = \\sum_{j \\in B_1} Q_{4j}$。\n        对于微观状态 $i=3$：$\\sum_{j \\in \\{1,2\\}} Q_{3j} = Q_{31} + Q_{32} = 0.25 + 0.15 = 0.4$。\n        对于微观状态 $i=4$：$\\sum_{j \\in \\{1,2\\}} Q_{4j} = Q_{41} + Q_{42} = 0.25 + 0.15 = 0.4$。\n        和相等。此条件满足。\n\n    b.  **从 $B_2$ 到 $B_2$ 的速率**：检查是否 $\\sum_{j \\in B_2} Q_{3j} = \\sum_{j \\in B_2} Q_{4j}$。\n        对于微观状态 $i=3$：$\\sum_{j \\in \\{3,4\\}} Q_{3j} = Q_{33} + Q_{34} = -0.9 + 0.5 = -0.4$。\n        对于微观状态 $i=4$：$\\sum_{j \\in \\{3,4\\}} Q_{4j} = Q_{43} + Q_{44} = 0.6 + (-1.0) = -0.4$。\n        和相等。此条件也满足。\n\n由于强可集聚性的所有四个条件都已满足，划分 $\\mathcal{B} = \\{\\{1,2\\}, \\{3,4\\}\\}$ 是一个有效的强可集聚划分。我们现在可以构建 $2 \\times 2$ 的聚合生成元矩阵 $\\tilde{Q}$，其中状态对应于 $B_1$（低输出）和 $B_2$（高输出）。矩阵项 $\\tilde{Q}_{IJ}$ 是我们计算出的公共和。\n\n$\\tilde{Q}_{11} = (\\text{从 } B_1 \\text{ 到 } B_1 \\text{ 的速率}) = -0.5 \\, \\mathrm{min}^{-1}$。\n$\\tilde{Q}_{12} = (\\text{从 } B_1 \\text{ 到 } B_2 \\text{ 的速率}) = 0.5 \\, \\mathrm{min}^{-1}$。\n$\\tilde{Q}_{21} = (\\text{从 } B_2 \\text{ 到 } B_1 \\text{ 的速率}) = 0.4 \\, \\mathrm{min}^{-1}$。\n$\\tilde{Q}_{22} = (\\text{从 } B_2 \\text{ 到 } B_2 \\text{ 的速率}) = -0.4 \\, \\mathrm{min}^{-1}$。\n\n作为最后的检查，$\\tilde{Q}$ 的行和必须为零：\n第 1 行：$\\tilde{Q}_{11} + \\tilde{Q}_{12} = -0.5 + 0.5 = 0$。\n第 2 行：$\\tilde{Q}_{21} + \\tilde{Q}_{22} = 0.4 + (-0.4) = 0$。\n结果矩阵是一个有效的生成元矩阵。\n\n聚合生成元矩阵是：\n$$\n\\tilde{Q} =\n\\begin{pmatrix}\n-0.5  0.5 \\\\\n0.4  -0.4\n\\end{pmatrix}\n$$\n单位是 $\\mathrm{min}^{-1}$，继承自原始生成元矩阵 $Q$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-0.5  0.5 \\\\\n0.4  -0.4\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在许多真实的生物系统中，精确集总的条件过于严苛而无法满足，但我们仍然可以利用系统内在的多尺度特性进行模型降维。一个常见的场景是时间尺度分离，例如，细胞内的生化反应可能比细胞间的物质扩散快得多。本练习  探讨了在这种情况下如何运用准稳态近似（quasi-steady-state approximation, QSSA）来分离快慢动力学，从而推导出一个描述慢变量（模块总浓度）演化的简化模型，并量化评估该近似模型的准确性。",
            "id": "3318636",
            "problem": "给定一个双模块反应-扩散网络，该网络模拟了每个模块内单一的可逆反应以及各物种的线性模块间扩散。在每个模块内，物种 $A_i$ 和 $B_i$ 根据质量作用动力学相互转化，且每个物种通过菲克耦合在两个模块之间扩散。该系统由以下常微分方程（ordinary differential equation (ODE)）组成，其中模块 $i \\in \\{1,2\\}$，$j$ 表示另一个模块：\n- 模块内反应 $A_i \\rightleftharpoons B_i$，正向速率常数为 $k_{f,i}$（对于 $A_i \\to B_i$），逆向速率常数为 $k_{b,i}$（对于 $B_i \\to A_i$）。\n- 模块间扩散，物种 $A$ 的扩散系数为 $D_A$，物种 $B$ 的扩散系数为 $D_B$。\n\n设状态向量为 $(A_1,B_1,A_2,B_2)$。其动力学方程为\n$$\n\\frac{dA_1}{dt} = -k_{f,1} A_1 + k_{b,1} B_1 + D_A (A_2 - A_1), \\quad\n\\frac{dB_1}{dt} = \\phantom{-}k_{f,1} A_1 - k_{b,1} B_1 + D_B (B_2 - B_1),\n$$\n$$\n\\frac{dA_2}{dt} = -k_{f,2} A_2 + k_{b,2} B_2 + D_A (A_1 - A_2), \\quad\n\\frac{dB_2}{dt} = \\phantom{-}k_{f,2} A_2 - k_{b,2} B_2 + D_B (B_1 - B_2).\n$$\n假设总物质量\n$$\nN_{\\mathrm{tot}} = A_1 + B_1 + A_2 + B_2\n$$\n是守恒的。所有量均为无量纲。\n\n任务：\n1) 通过应用时间尺度分离和准稳态近似（quasi-steady-state approximation (QSSA)），推导模块总和 $T_i = A_i + B_i$ 的慢动力学简化模型。在该近似下，模块内反应相比模块间扩散会快速弛豫。在此假设下，每个模块 $i$ 内的快速反应达到平衡，使得\n$$\nA_i \\approx \\alpha_i T_i, \\qquad B_i \\approx (1 - \\alpha_i) T_i, \\qquad \\alpha_i = \\frac{k_{b,i}}{k_{f,i} + k_{b,i}}.\n$$\n证明慢动力学满足\n$$\n\\frac{dT_1}{dt} = D_A \\big(\\alpha_2 T_2 - \\alpha_1 T_1\\big) + D_B \\big((1-\\alpha_2) T_2 - (1-\\alpha_1) T_1\\big), \\qquad \\frac{dT_2}{dt} = -\\frac{dT_1}{dt},\n$$\n并在约束条件 $T_1^\\ast + T_2^\\ast = N_{\\mathrm{tot}}$ 下计算简化模型的稳态 $(T_1^\\ast,T_2^\\ast)$。\n2) 通过将常微分方程的右侧设为零并施加守恒约束，计算完整系统的稳态 $(A_1^\\ast,B_1^\\ast,A_2^\\ast,B_2^\\ast)$。这将构成一个线性代数系统。然后计算完整系统的模块总和 $T_1^{\\mathrm{full}} = A_1^\\ast + B_1^\\ast$ 和 $T_2^{\\mathrm{full}} = A_2^\\ast + B_2^\\ast$。\n3) 通过报告以下数值来比较简化模型和完整系统的稳态：\n- 来自简化模型的 $T_1^\\ast$，\n- 来自完整系统的 $T_1^{\\mathrm{full}}$，\n- 绝对差 $\\lvert T_1^\\ast - T_1^{\\mathrm{full}} \\rvert$，\n- 完整系统稳态与简化模型在稳态下的物种重构之间的物种水平差异的欧几里得范数，定义为\n$$\n\\Delta_{\\mathrm{species}} = \\sqrt{(A_1^\\ast - \\alpha_1 T_1^\\ast)^2 + (B_1^\\ast - (1-\\alpha_1) T_1^\\ast)^2 + (A_2^\\ast - \\alpha_2 T_2^\\ast)^2 + (B_2^\\ast - (1-\\alpha_2) T_2^\\ast)^2 }.\n$$\n\n数值要求：\n- 对于每个测试用例，将上述四个量以浮点数形式输出，并精确到 $6$ 位小数。\n- 你的程序应生成单行输出，其中包含一个由列表组成的列表，格式为逗号分隔，无空格，并用方括号括起。每个内部列表对应下方的一个测试用例，顺序相同。例如，格式应为“[[x11,x12,x13,x14],[x21,x22,x23,x24],[x31,x32,x33,x34]]”，其中每个 $x_{ij}$ 都是精确到 $6$ 位小数的浮点数。\n\n测试套件：\n为以下三组参数计算指定的输出。所有量均为无量纲。\n\n- 案例 $\\mathbf{1}$（对称模块）：\n  - $k_{f,1} = 2$, $k_{b,1} = 1$, $k_{f,2} = 2$, $k_{b,2} = 1$, $D_A = 0.5$, $D_B = 0.5$, $N_{\\mathrm{tot}} = 10$。\n- 案例 $\\mathbf{2}$（非对称反应，扩散有利于 $B$）：\n  - $k_{f,1} = 10$, $k_{b,1} = 1$, $k_{f,2} = 1$, $k_{b,2} = 10$, $D_A = 0.2$, $D_B = 1.0$, $N_{\\mathrm{tot}} = 10$。\n- 案例 $\\mathbf{3}$（仅 $A$ 扩散）：\n  - $k_{f,1} = 3$, $k_{b,1} = 1$, $k_{f,2} = 1$, $k_{b,2} = 3$, $D_A = 1.5$, $D_B = 0.0$, $N_{\\mathrm{tot}} = 8$。\n\n你的程序必须为每个案例计算简化模型稳态和完整系统稳态，按照规定进行比较，并以上述确切的单行格式输出所有三个案例的结果。不需要用户输入。所有数值均为无量纲，并应精确到 $6$ 位小数。最终输出必须是指定格式的单行字符串。",
            "solution": "我们从基本且广为接受的规则开始：可逆反应的质量作用动力学和线性物种交换的菲克扩散。对于模块 $i \\in \\{1,2\\}$，可逆反应 $A_i \\rightleftharpoons B_i$ 遵循\n$$\n\\frac{dA_i}{dt}\\Big|_{\\mathrm{rxn}} = -k_{f,i} A_i + k_{b,i} B_i, \\qquad \\frac{dB_i}{dt}\\Big|_{\\mathrm{rxn}} = k_{f,i} A_i - k_{b,i} B_i,\n$$\n这会使模块总和 $T_i = A_i + B_i$ 守恒，因为反应项在求和时会相互抵消。模块间扩散，建模为线性交换，其贡献为\n$$\n\\frac{dA_i}{dt}\\Big|_{\\mathrm{diff}} = D_A (A_j - A_i), \\qquad \\frac{dB_i}{dt}\\Big|_{\\mathrm{diff}} = D_B (B_j - B_i),\n$$\n其中 $j \\neq i$。结合反应和扩散，得到所给定的常微分方程（ordinary differential equation (ODE)），并保持全局总量 $N_{\\mathrm{tot}} = A_1 + B_1 + A_2 + B_2$ 守恒。\n\n通过时间尺度分离和准稳态近似（quasi-steady-state approximation (QSSA)）得到的简化模型：\n- 假设：相对于扩散，每个模块内的反应在快速时间尺度上达到平衡。在快速流形上，对于每个模块 $i$，我们将反应项设为零：\n$$\n-k_{f,i} A_i + k_{b,i} B_i \\approx 0 \\quad \\Rightarrow \\quad \\frac{B_i}{A_i} \\approx \\frac{k_{f,i}}{k_{b,i}}.\n$$\n用模块总和 $T_i = A_i + B_i$ 表示 $A_i$ 和 $B_i$ 可得\n$$\nA_i \\approx \\alpha_i T_i, \\qquad B_i \\approx (1 - \\alpha_i) T_i, \\qquad \\alpha_i = \\frac{k_{b,i}}{k_{f,i} + k_{b,i}}.\n$$\n- 模块总和的慢动力学可以通过对一个模块内的常微分方程求和得到（这将抵消反应项）：\n$$\n\\frac{dT_1}{dt} = \\frac{dA_1}{dt} + \\frac{dB_1}{dt} = D_A (A_2 - A_1) + D_B (B_2 - B_1).\n$$\n代入准稳态表达式 $A_i \\approx \\alpha_i T_i$，$B_i \\approx (1 - \\alpha_i) T_i$ 可得\n$$\n\\frac{dT_1}{dt} = D_A \\big(\\alpha_2 T_2 - \\alpha_1 T_1\\big) + D_B \\big((1 - \\alpha_2) T_2 - (1 - \\alpha_1) T_1\\big),\n$$\n且根据守恒定律，$\\frac{dT_2}{dt} = -\\frac{dT_1}{dt}$。简化模型的稳态 $(T_1^\\ast, T_2^\\ast)$ 满足 $\\frac{dT_1}{dt} = 0$ 和 $T_1^\\ast + T_2^\\ast = N_{\\mathrm{tot}}$。定义系数\n$$\nc_1 = D_A \\alpha_1 + D_B (1 - \\alpha_1), \\qquad c_2 = D_A \\alpha_2 + D_B (1 - \\alpha_2).\n$$\n那么稳态条件简化为\n$$\n0 = -c_1 T_1^\\ast + c_2 T_2^\\ast, \\qquad T_2^\\ast = N_{\\mathrm{tot}} - T_1^\\ast,\n$$\n解得\n$$\n(c_1 + c_2) T_1^\\ast = c_2 N_{\\mathrm{tot}} \\quad \\Rightarrow \\quad T_1^\\ast = \\frac{c_2}{c_1 + c_2} N_{\\mathrm{tot}}, \\qquad T_2^\\ast = N_{\\mathrm{tot}} - T_1^\\ast.\n$$\n简化模型在稳态下的物种重构为\n$$\nA_i^{\\mathrm{red}} = \\alpha_i T_i^\\ast, \\qquad B_i^{\\mathrm{red}} = (1 - \\alpha_i) T_i^\\ast.\n$$\n\n完整系统稳态：\n- 将常微分方程的右侧设为零并施加守恒约束。将变量排序为 $x = [A_1, B_1, A_2, B_2]^\\top$，稳态方程是线性的：\n$$\n\\begin{aligned}\n(-k_{f,1} - D_A) A_1 + k_{b,1} B_1 + D_A A_2 + 0 \\cdot B_2 = 0, \\\\\nk_{f,1} A_1 + (-k_{b,1} - D_B) B_1 + 0 \\cdot A_2 + D_B B_2 = 0, \\\\\nD_A A_1 + 0 \\cdot B_1 + (-k_{f,2} - D_A) A_2 + k_{b,2} B_2 = 0, \\\\\n0 \\cdot A_1 + D_B B_1 + k_{f,2} A_2 + (-k_{b,2} - D_B) B_2 = 0,\n\\end{aligned}\n$$\n以及\n$$\nA_1 + B_1 + A_2 + B_2 = N_{\\mathrm{tot}}.\n$$\n由于动力学中隐含的守恒定律，这五个方程中有一个是线性相关的；因此，我们以最小二乘法同时求解它们，以获得满足所有约束的唯一解。那么，完整系统的模块总和为\n$$\nT_1^{\\mathrm{full}} = A_1^\\ast + B_1^\\ast, \\qquad T_2^{\\mathrm{full}} = A_2^\\ast + B_2^\\ast.\n$$\n\n比较指标：\n- 模块1总和的绝对差：$\\lvert T_1^\\ast - T_1^{\\mathrm{full}} \\rvert$。\n- 完整系统稳态与简化模型重构之间的物种水平欧几里得差异：\n$$\n\\Delta_{\\mathrm{species}} = \\sqrt{(A_1^\\ast - \\alpha_1 T_1^\\ast)^2 + (B_1^\\ast - (1 - \\alpha_1) T_1^\\ast)^2 + (A_2^\\ast - \\alpha_2 T_2^\\ast)^2 + (B_2^\\ast - (1 - \\alpha_2) T_2^\\ast)^2 }.\n$$\n\n每个测试用例的算法实现步骤：\n- 使用 $\\alpha_i = \\frac{k_{b,i}}{k_{f,i} + k_{b,i}}$ 计算 $i \\in \\{1,2\\}$ 的 $\\alpha_i$。\n- 计算 $c_1$ 和 $c_2$，然后计算 $T_1^\\ast = \\frac{c_2}{c_1 + c_2} N_{\\mathrm{tot}}$ 和 $T_2^\\ast = N_{\\mathrm{tot}} - T_1^\\ast$。\n- 通过 $A_i^{\\mathrm{red}} = \\alpha_i T_i^\\ast$，$B_i^{\\mathrm{red}} = (1 - \\alpha_i) T_i^\\ast$ 重构简化模型的物种 $(A_i^{\\mathrm{red}}, B_i^{\\mathrm{red}})$。\n- 构建对应于四个稳态方程和一个守恒方程的线性系统矩阵和向量，并使用最小二乘法求解器求解 $(A_1^\\ast, B_1^\\ast, A_2^\\ast, B_2^\\ast)$。\n- 计算 $T_1^{\\mathrm{full}} = A_1^\\ast + B_1^\\ast$ 和 $T_2^{\\mathrm{full}} = A_2^\\ast + B_2^\\ast$。\n- 计算 $\\lvert T_1^\\ast - T_1^{\\mathrm{full}} \\rvert$ 和 $\\Delta_{\\mathrm{species}}$。\n- 将所有报告值四舍五入到恰好 $6$ 位小数，并将最终输出格式化为单行字符串：一个包含三个内部列表的方括号括起的逗号分隔列表，每个内部列表包含一个测试用例的四个四舍五入后的浮点数，无空格。\n\n提供的测试套件涵盖：\n- 一个对称案例，用于验证简化模型和完整系统稳态的一致性。\n- 一个非对称反应案例，其中扩散有利于物种 $B$，用于评估模块总和如何不同。\n- 一个仅 $A$ 扩散的案例，用于探究边缘行为以及反应-扩散耦合如何重新分配模块总和。\n\n所有量均为无量纲，且无需用户输入。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef reduced_steady_state(kf1, kb1, kf2, kb2, DA, DB, Ntot):\n    # Compute alpha_i for each module\n    alpha1 = kb1 / (kf1 + kb1)\n    alpha2 = kb2 / (kf2 + kb2)\n    # Effective coefficients for the slow T dynamics\n    c1 = DA * alpha1 + DB * (1 - alpha1)\n    c2 = DA * alpha2 + DB * (1 - alpha2)\n    # Solve for T1*, T2* under T1* + T2* = Ntot and steady-state condition\n    denom = c1 + c2\n    # To avoid numerical issues in edge cases (should not occur in given tests)\n    if denom == 0:\n        # If both c1 and c2 are zero, diffusion does not change totals; split evenly\n        T1_star = Ntot / 2.0\n    else:\n        T1_star = (c2 / denom) * Ntot\n    T2_star = Ntot - T1_star\n    # Reduced species reconstruction\n    A1r = alpha1 * T1_star\n    B1r = (1 - alpha1) * T1_star\n    A2r = alpha2 * T2_star\n    B2r = (1 - alpha2) * T2_star\n    return (T1_star, T2_star), (A1r, B1r, A2r, B2r), (alpha1, alpha2)\n\ndef full_steady_state(kf1, kb1, kf2, kb2, DA, DB, Ntot):\n    # Build the linear system M x = b with 5 equations (4 steady-state, 1 conservation)\n    # Variables x = [A1, B1, A2, B2]\n    M = np.array([\n        [-kf1 - DA,   kb1,        DA,      0.0],   # dA1/dt = 0\n        [  kf1,     -kb1 - DB,    0.0,     DB ],   # dB1/dt = 0\n        [  DA,         0.0,     -kf2 - DA, kb2],   # dA2/dt = 0\n        [  0.0,        DB,        kf2,   -kb2 - DB], # dB2/dt = 0\n        [  1.0,        1.0,       1.0,     1.0]    # conservation\n    ], dtype=float)\n    b = np.array([0.0, 0.0, 0.0, 0.0, Ntot], dtype=float)\n    # Solve least squares to handle linear dependence (one redundant equation)\n    x, residuals, rank, s = np.linalg.lstsq(M, b, rcond=None)\n    A1, B1, A2, B2 = x\n    return (A1, B1, A2, B2)\n\ndef format_inner_list(vals):\n    # Format a list of floats with exactly 6 decimals, no spaces, enclosed in brackets\n    return \"[\" + \",\".join(f\"{v:.6f}\" for v in vals) + \"]\"\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (kf1, kb1, kf2, kb2, DA, DB, Ntot)\n    test_cases = [\n        (2.0, 1.0, 2.0, 1.0, 0.5, 0.5, 10.0),  # Case 1\n        (10.0, 1.0, 1.0, 10.0, 0.2, 1.0, 10.0), # Case 2\n        (3.0, 1.0, 1.0, 3.0, 1.5, 0.0, 8.0),    # Case 3\n    ]\n\n    results = []\n    for case in test_cases:\n        kf1, kb1, kf2, kb2, DA, DB, Ntot = case\n\n        # Reduced model steady state\n        (T1_star, T2_star), (A1r, B1r, A2r, B2r), (alpha1, alpha2) = reduced_steady_state(\n            kf1, kb1, kf2, kb2, DA, DB, Ntot\n        )\n\n        # Full system steady state\n        A1, B1, A2, B2 = full_steady_state(kf1, kb1, kf2, kb2, DA, DB, Ntot)\n        T1_full = A1 + B1\n        T2_full = A2 + B2\n\n        # Comparisons\n        abs_diff_T1 = abs(T1_star - T1_full)\n        # Species-level Euclidean discrepancy\n        species_diff = np.array([A1 - A1r, B1 - B1r, A2 - A2r, B2 - B2r], dtype=float)\n        delta_species = float(np.linalg.norm(species_diff, ord=2))\n\n        # Prepare output for this case: [T1_reduced, T1_full, |diff|, species_L2]\n        results.append([T1_star, T1_full, abs_diff_T1, delta_species])\n\n    # Final print statement in the exact required format: list of lists, no spaces\n    output = \"[\" + \",\".join(format_inner_list(r) for r in results) + \"]\"\n    print(output)\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}