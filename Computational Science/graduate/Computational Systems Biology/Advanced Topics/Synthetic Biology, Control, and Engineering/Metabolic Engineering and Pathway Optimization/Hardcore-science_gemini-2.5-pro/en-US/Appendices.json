{
    "hands_on_practices": [
        {
            "introduction": "Flux Balance Analysis (FBA) is a cornerstone of computational systems biology, allowing us to predict metabolic capabilities from a genome-scale network reconstruction. The method relies on the principle of mass conservation at steady state, represented by the equation $S v = 0$, where $S$ is the stoichiometric matrix and $v$ is the vector of reaction fluxes. This foundational exercise  will guide you through a basic FBA calculation for a simple linear pathway, stripping the method down to its essential components. By maximizing a target flux subject to stoichiometric and capacity constraints, you will develop a concrete understanding of how linear programming is applied to find optimal metabolic states.",
            "id": "3325736",
            "problem": "Consider a minimal pathway optimization scenario in computational systems biology for metabolic engineering, modeled using Flux Balance Analysis (FBA). A pathway involves two intracellular metabolites and three irreversible reactions arranged in series. The network is represented by a stoichiometric matrix $S$ that encodes mass conservation at steady state. The flux vector is $v \\in \\mathbb{R}^{3}$ with components $v_1$, $v_2$, and $v_3$ corresponding to three reactions. The system is operated at steady state, so metabolite accumulation is zero and the intracellular fluxes satisfy $S v = 0$.\n\nYou are given the stoichiometric matrix\n$$\nS=\\begin{bmatrix}\n-1 & 1 & 0 \\\\\n0 & -1 & 1\n\\end{bmatrix},\n$$\nflux bounds $0 \\leq v_i \\leq 10$ for each $i \\in \\{1,2,3\\}$, and the linear objective vector $c=(0,0,1)$ that encodes the engineering target of maximizing the flux through reaction $3$ (for instance, the synthesis or export of a desired product). Assume all reactions are irreversible (thermodynamically constrained to nonnegative fluxes) and there are no additional constraints beyond the stated bounds and steady-state mass balance.\n\nFormulate and solve the FBA optimization problem of maximizing $c^{\\top} v$ subject to $S v = 0$ and the given bounds. Determine the optimal objective value $\\max c^{\\top} v$. Express the final answer in $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$. No rounding is necessary; report the exact value.",
            "solution": "The problem posed is a standard application of Flux Balance Analysis (FBA), which is a mathematical method used to predict metabolic flux distributions. The problem is a linear program, which can be formally stated as follows:\n\nMaximize:\n$$z = c^{\\top} v$$\nSubject to:\n$$S v = 0$$\n$$v_{lb} \\leq v \\leq v_{ub}$$\n\nHere, we are given the specific components for this problem. The flux vector is $v = \\begin{pmatrix} v_1 \\\\ v_2 \\\\ v_3 \\end{pmatrix}$. The stoichiometric matrix is given as:\n$$\nS=\\begin{bmatrix}\n-1 & 1 & 0 \\\\\n0 & -1 & 1\n\\end{bmatrix}\n$$\nThe objective vector is $c = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix}$, which means the objective function to maximize is $z = c^{\\top} v = (0)v_1 + (0)v_2 + (1)v_3 = v_3$.\n\nThe flux bounds are given as $0 \\leq v_i \\leq 10$ for each flux $v_i$, where $i \\in \\{1, 2, 3\\}$. This can be written as lower bounds $v_{lb} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}$ and upper bounds $v_{ub} = \\begin{pmatrix} 10 \\\\ 10 \\\\ 10 \\end{pmatrix}$.\n\nFirst, we analyze the steady-state mass balance constraint, $S v = 0$. This matrix equation expands into a system of linear equations:\n$$\n\\begin{bmatrix}\n-1 & 1 & 0 \\\\\n0 & -1 & 1\n\\end{bmatrix}\n\\begin{pmatrix}\nv_1 \\\\\nv_2 \\\\\nv_3\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0 \\\\\n0\n\\end{pmatrix}\n$$\n\nThis system corresponds to two equations:\nEquation 1: $(-1)v_1 + (1)v_2 + (0)v_3 = 0 \\implies -v_1 + v_2 = 0 \\implies v_1 = v_2$.\nEquation 2: $(0)v_1 + (-1)v_2 + (1)v_3 = 0 \\implies -v_2 + v_3 = 0 \\implies v_2 = v_3$.\n\nCombining these two results, we find that the steady-state condition imposes the following relationship between the fluxes:\n$$v_1 = v_2 = v_3$$\nThis is the expected outcome for a simple linear pathway operating at steady state, where the flux must be conserved through each step of the pathway. Let us define a common flux variable $v_c$ such that $v_c = v_1 = v_2 = v_3$.\n\nNow we can reformulate the optimization problem in terms of this single variable $v_c$. The objective is to maximize $v_3$, which is equivalent to maximizing $v_c$.\nThe constraints on the individual fluxes must all be satisfied. We substitute $v_c$ into the flux bounds:\n1. For $v_1$: $0 \\leq v_1 \\leq 10 \\implies 0 \\leq v_c \\leq 10$.\n2. For $v_2$: $0 \\leq v_2 \\leq 10 \\implies 0 \\leq v_c \\leq 10$.\n3. For $v_3$: $0 \\leq v_3 \\leq 10 \\implies 0 \\leq v_c \\leq 10$.\n\nAll three constraints are identical. The problem is thus reduced to finding the maximum value of $v_c$ that satisfies the condition $0 \\leq v_c \\leq 10$.\nThe optimization problem simplifies to:\nMaximize: $v_c$\nSubject to: $0 \\leq v_c \\leq 10$.\n\nThe maximum value of $v_c$ that satisfies this inequality is clearly $10$.\nThe optimal objective value is the maximum value of $z = v_3$. Since $v_3 = v_c$, the maximum value is:\n$$\\max(z) = \\max(v_3) = \\max(v_c) = 10$$\nThe optimal flux distribution is $v_{opt} = \\begin{pmatrix} v_1 \\\\ v_2 \\\\ v_3 \\end{pmatrix} = \\begin{pmatrix} 10 \\\\ 10 \\\\ 10 \\end{pmatrix}$. We can verify that this solution satisfies all constraints:\n$S v_{opt} = \\begin{bmatrix} -1 & 1 & 0 \\\\ 0 & -1 & 1 \\end{bmatrix} \\begin{pmatrix} 10 \\\\ 10 \\\\ 10 \\end{pmatrix} = \\begin{pmatrix} -10+10 \\\\ -10+10 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$. The steady-state condition is met.\nThe bounds $0 \\leq 10 \\leq 10$ are also met.\nThe objective value is $c^{\\top} v_{opt} = v_3 = 10$.\n\nThe problem phrasing requests the answer in units of $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$. Since the problem is defined with dimensionless numbers, we assume the flux values and bounds are given in these units. Therefore, the optimal objective value is $10$ in the specified units.",
            "answer": "$$\\boxed{10}$$"
        },
        {
            "introduction": "While FBA can determine the optimal value for a metabolic objective, it often does not provide a unique flux distribution that achieves this optimum. Metabolic networks possess inherent redundancy and flexibility, leading to a space of alternative optimal solutions. To characterize this flexibility, we use Flux Variability Analysis (FVA), a technique that calculates the range of possible values for each flux while the network operates at its optimal objective value. This hands-on coding practice  will task you with implementing FVA to explore how network structure and flux bounds define the feasible metabolic phenotypes at optimality, revealing the difference between a network with a single, rigid optimal state and one with flexible, parallel pathways.",
            "id": "3325767",
            "problem": "Consider a steady-state metabolic network represented by a stoichiometric matrix $S \\in \\mathbb{R}^{m \\times n}$, a flux vector $v \\in \\mathbb{R}^n$, and lower and upper bounds on reaction fluxes given by $l \\in \\mathbb{R}^n$ and $u \\in \\mathbb{R}^n$. The steady-state assumption imposes the mass balance constraints $S v = 0$. Reaction bounds impose $l_i \\le v_i \\le u_i$ for all $i \\in \\{1,\\dots,n\\}$. Flux Balance Analysis (FBA) seeks to maximize a linear objective function $c^\\top v$ under these constraints. Flux Variability Analysis (FVA) at optimality seeks the range of each reaction flux while the objective is fixed at its optimal value, by solving two linear programs: one minimizing $v_j$ and one maximizing $v_j$ subject to $S v = 0$, $l \\le v \\le u$, and $c^\\top v = c^\\top v^\\star$, where $v^\\star$ solves the original FBA.\n\nAll fluxes must be expressed in millimoles per gram dry weight per hour (mmol gDW$^{-1}$ h$^{-1}$). Your program must compute FVA ranges at optimality for one specified reaction in each test case and print the results rounded to three decimals, without printing the unit symbol.\n\nUse the following test suite, which employs physically plausible, low-dimensional networks to test different facets including a unique optimum, alternative parallel pathways that induce variability, and an upper-bound-limited optimum:\n\n- Test case $1$ (unique optimum): $S = \\begin{bmatrix} -1 & 1 & 0 \\\\ -1 & 0 & 1 \\end{bmatrix}$, bounds $0 \\le v_i \\le 10$ for all $i \\in \\{1,2,3\\}$, objective $\\max v_3$ (that is, $c = (0,0,1)$), and compute the FVA range for $v_2$ at optimality.\n- Test case $2$ (parallel pathways induce variability): $S = \\begin{bmatrix} 1 & -1 & 0 & -1 \\\\ 0 & 1 & -1 & 1 \\end{bmatrix}$, bounds $0 \\le v_i \\le 10$ for all $i \\in \\{1,2,3,4\\}$, objective $\\max v_3$ (that is, $c = (0,0,1,0)$), and compute the FVA range for $v_2$ at optimality.\n- Test case $3$ (upper-bound-limited optimum): $S = \\begin{bmatrix} -1 & 1 & 0 \\\\ -1 & 0 & 1 \\end{bmatrix}$, bounds $0 \\le v_1 \\le 10$, $0 \\le v_2 \\le 10$, $0 \\le v_3 \\le 5$, objective $\\max v_3$ (that is, $c = (0,0,1)$), and compute the FVA range for $v_2$ at optimality.\n\nIn all cases, treat reactions as irreversible within the stated bounds. Explicitly, the general FBA problem is:\n$$\n\\begin{aligned}\n\\text{maximize} \\quad & c^\\top v \\\\\n\\text{subject to} \\quad & S v = 0, \\\\\n& l \\le v \\le u.\n\\end{aligned}\n$$\nGiven the optimal value $c^\\top v^\\star$, the FVA range for index $j$ is computed by solving:\n$$\n\\begin{aligned}\n\\text{minimize} \\quad & v_j \\\\\n\\text{subject to} \\quad & S v = 0, \\\\\n& l \\le v \\le u, \\\\\n& c^\\top v = c^\\top v^\\star,\n\\end{aligned}\n$$\nand\n$$\n\\begin{aligned}\n\\text{maximize} \\quad & v_j \\\\\n\\text{subject to} \\quad & S v = 0, \\\\\n& l \\le v \\le u, \\\\\n& c^\\top v = c^\\top v^\\star.\n\\end{aligned}\n$$\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is a two-element list $[v_j^{\\min}, v_j^{\\max}]$ for the corresponding test case. For example, the output format must be exactly like $[[a_1,b_1],[a_2,b_2],[a_3,b_3]]$, where each $a_k$ and $b_k$ are floats rounded to three decimals in mmol gDW$^{-1}$ h$^{-1}$.",
            "solution": "The problem statement is subjected to a rigorous validation process before a solution is attempted.\n\n### Step 1: Extract Givens\nThe problem provides the following information:\n- A steady-state metabolic network is described by a stoichiometric matrix $S \\in \\mathbb{R}^{m \\times n}$ and a flux vector $v \\in \\mathbb{R}^n$.\n- Mass balance constraints are given by $S v = 0$.\n- Flux bounds are given by $l \\le v \\le u$, where $l, u \\in \\mathbb{R}^n$.\n- Flux Balance Analysis (FBA) is defined as the optimization problem:\n$$\n\\begin{aligned}\n\\text{maximize} \\quad & c^\\top v \\\\\n\\text{subject to} \\quad & S v = 0, \\\\\n& l \\le v \\le u.\n\\end{aligned}\n$$\n- Flux Variability Analysis (FVA) at optimality for a flux $v_j$ is defined by finding the minimum and maximum of $v_j$ subject to the FBA constraints plus the additional constraint that the objective function equals its optimal value, $c^\\top v = c^\\top v^\\star$.\n- All fluxes are in units of mmol gDW$^{-1}$ h$^{-1}$.\n- Test Case 1: $S = \\begin{bmatrix} -1 & 1 & 0 \\\\ -1 & 0 & 1 \\end{bmatrix}$, bounds $0 \\le v_i \\le 10$ for $i \\in \\{1,2,3\\}$, objective $c = (0,0,1)^\\top$ (maximize $v_3$), FVA for $v_2$.\n- Test Case 2: $S = \\begin{bmatrix} 1 & -1 & 0 & -1 \\\\ 0 & 1 & -1 & 1 \\end{bmatrix}$, bounds $0 \\le v_i \\le 10$ for $i \\in \\{1,2,3,4\\}$, objective $c = (0,0,1,0)^\\top$ (maximize $v_3$), FVA for $v_2$.\n- Test Case 3: $S = \\begin{bmatrix} -1 & 1 & 0 \\\\ -1 & 0 & 1 \\end{bmatrix}$, bounds $0 \\le v_1 \\le 10$, $0 \\le v_2 \\le 10$, $0 \\le v_3 \\le 5$, objective $c = (0,0,1)^\\top$ (maximize $v_3$), FVA for $v_2$.\n- The output format is specified as a single line containing a comma-separated list of two-element lists, e.g., $[[a_1,b_1],[a_2,b_2],[a_3,b_3]]$, with numbers rounded to three decimal places.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed against the validation criteria.\n- **Scientifically Grounded**: The problem is based on Flux Balance Analysis and Flux Variability Analysis, which are standard, well-established techniques in computational systems biology and metabolic engineering. The underlying principle is the conservation of mass in a biochemical reaction network at steady state, a fundamental concept in physical chemistry and biology. The problem is scientifically sound.\n- **Well-Posed**: The problem requires solving a series of linear programs (LPs). For a given set of constraints, an LP is well-posed: it either has an optimal solution, is unbounded, or is infeasible. The constraints provided (bounded flux variables) ensure that the solution space is a convex polytope, guaranteeing that the objective function will have a finite optimum. The problem is well-posed.\n- **Objective**: The problem is stated using precise mathematical formalism and objective language. All terms ($S$, $v$, $l$, $u$, $c$) are clearly defined, and the optimization problems are specified unambiguously.\n- **Completeness**: All necessary data (stoichiometric matrices, bounds, objectives) are provided for each test case.\n- **Consistency**: The givens for each test case are internally consistent and do not contain contradictions.\n\n### Step 3: Verdict and Action\nThe problem is valid. It is a well-defined computational problem in metabolic engineering that is scientifically grounded, mathematically consistent, and complete. A solution will be provided.\n\n### Principle-Based Solution\n\nThe task is to compute the Flux Variability Analysis (FVA) range for a specific reaction flux at the optimal objective value. This is a two-stage process for each test case, involving the solution of Linear Programming (LP) problems.\n\n**Stage 1: Flux Balance Analysis (FBA)**\nFirst, we determine the maximum value of the biological objective function. This is achieved by solving the FBA problem, which is an LP:\n$$\n\\begin{aligned}\nz^\\star = \\max_{v} \\quad & c^\\top v \\\\\n\\text{subject to} \\quad & S v = 0 \\\\\n& l \\le v \\le u\n\\end{aligned}\n$$\nThe result of this optimization is the optimal objective value, $z^\\star$.\n\n**Stage 2: Flux Variability Analysis (FVA)**\nNext, we determine the feasible range $[v_j^{\\min}, v_j^{\\max}]$ for a specific flux $v_j$ while ensuring the objective remains at its optimum, $z^\\star$. This requires solving two additional LPs.\n\nTo find the minimum possible flux, $v_j^{\\min}$:\n$$\n\\begin{aligned}\nv_j^{\\min} = \\min_{v} \\quad & v_j \\\\\n\\text{subject to} \\quad & S v = 0 \\\\\n& l \\le v \\le u \\\\\n& c^\\top v = z^\\star\n\\end{aligned}\n$$\nTo find the maximum possible flux, $v_j^{\\max}$:\n$$\n\\begin{aligned}\nv_j^{\\max} = \\max_{v} \\quad & v_j \\\\\n\\text{subject to} \\quad & S v = 0 \\\\\n& l \\le v \\le u \\\\\n& c^\\top v = z^\\star\n\\end{aligned}\n$$\nThese LPs will be solved computationally using the `scipy.optimize.linprog` function, which finds the minimum of an objective function. Maximization problems are solved by minimizing the negative of the objective function.\n\n**Analysis of Test Cases**\n\n**Test Case 1: Unique Optimum**\n- $S = \\begin{bmatrix} -1 & 1 & 0 \\\\ -1 & 0 & 1 \\end{bmatrix}$, $l=(0,0,0)^\\top$, $u=(10,10,10)^\\top$, $c=(0,0,1)^\\top$, FVA for $v_2$.\n- The steady-state constraints $Sv=0$ translate to:\n  $$-v_1 + v_2 = 0 \\implies v_1 = v_2$$\n  $$-v_1 + v_3 = 0 \\implies v_1 = v_3$$\n- Thus, we must have $v_1 = v_2 = v_3$.\n- The FBA objective is to maximize $v_3$. Given the bounds $0 \\le v_i \\le 10$, the maximum value for $v_3$ is $10$. So, $z^\\star = 10$.\n- The optimal state is unique: $v_1^\\star = v_2^\\star = v_3^\\star = 10$.\n- For the FVA, we add the constraint $c^\\top v = v_3 = 10$. This, combined with $v_1 = v_2 = v_3$, forces $v_2$ to be exactly $10$.\n- The FVA range for $v_2$ is $[10.0, 10.0]$.\n\n**Test Case 2: Parallel Pathways**\n- $S = \\begin{bmatrix} 1 & -1 & 0 & -1 \\\\ 0 & 1 & -1 & 1 \\end{bmatrix}$, $l=(0,0,0,0)^\\top$, $u=(10,10,10,10)^\\top$, $c=(0,0,1,0)^\\top$, FVA for $v_2$.\n- The constraints $Sv=0$ translate to:\n  $$v_1 - v_2 - v_4 = 0 \\implies v_1 = v_2 + v_4$$\n  $$v_2 - v_3 + v_4 = 0 \\implies v_3 = v_2 + v_4$$\n- This implies $v_1 = v_3$.\n- The FBA objective is to maximize $v_3$. Since $v_3 = v_1$ and $v_1$ is bounded by $0 \\le v_1 \\le 10$, the maximum value for $v_3$ is $10$. So, $z^\\star = 10$.\n- For the FVA, we add the constraint $c^\\top v = v_3 = 10$. This implies $v_1 = 10$. The system equations become $10 = v_2 + v_4$.\n- We need to find the range of $v_2$ subject to $v_2 + v_4 = 10$ and the bounds $0 \\le v_2 \\le 10$ and $0 \\le v_4 \\le 10$.\n  - To minimize $v_2$, we maximize $v_4$. The maximum value for $v_4$ is $10$, which gives $v_2 = 10 - 10 = 0$. So, $v_2^{\\min} = 0$.\n  - To maximize $v_2$, we minimize $v_4$. The minimum value for $v_4$ is $0$, which gives $v_2 = 10 - 0 = 10$. So, $v_2^{\\max} = 10$.\n- The FVA range for $v_2$ is $[0.0, 10.0]$.\n\n**Test Case 3: Upper-Bound-Limited Optimum**\n- $S = \\begin{bmatrix} -1 & 1 & 0 \\\\ -1 & 0 & 1 \\end{bmatrix}$, $l=(0,0,0)^\\top$, $u=(10,10,5)^\\top$, $c=(0,0,1)^\\top$, FVA for $v_2$.\n- The system of equations is the same as in Case 1: $v_1 = v_2 = v_3$.\n- The FBA objective is to maximize $v_3$. The bounds are $0 \\le v_1 \\le 10$, $0 \\le v_2 \\le 10$, and $0 \\le v_3 \\le 5$.\n- The maximum value for $v_3$ is directly limited by its upper bound, $u_3=5$. So, $z^\\star = 5$.\n- The optimal state is unique: $v_1^\\star = v_2^\\star = v_3^\\star = 5$.\n- For the FVA, we add the constraint $c^\\top v = v_3 = 5$. This, combined with $v_1 = v_2 = v_3$, forces $v_2$ to be exactly $5$.\n- The FVA range for $v_2$ is $[5.0, 5.0]$.\n\n**Computational Implementation**\nA Python function is implemented to automate this two-stage process. The function (`run_fva`) takes the model parameters ($S, c, l, u$) and the index of the flux to analyze.\n1. It first sets up and solves the FBA problem using `scipy.optimize.linprog`. The objective vector for `linprog` is $-c$ to perform maximization. The equality constraints are $A_{eq}=S$ and $b_{eq}=0$.\n2. The optimal objective value $z^\\star$ is extracted from the result.\n3. For the FVA step, the equality constraint matrix is augmented to include the new constraint $c^\\top v = z^\\star$. The new matrix is $A'_{eq} = \\begin{bmatrix} S \\\\ c^\\top \\end{bmatrix}$ and the vector is $b'_{eq} = \\begin{bmatrix} 0 \\\\ \\vdots \\\\ 0 \\\\ z^\\star \\end{bmatrix}$.\n4. Two LPs are then solved with these new constraints.\n   - To find $v_j^{\\min}$, the objective vector has a $1$ at index $j$ and zeros elsewhere.\n   - To find $v_j^{\\max}$, the objective vector has a $-1$ at index $j$ and zeros elsewhere. The result is then negated.\nThe results from all test cases are collected, rounded, and formatted into the required output string.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef run_fva(S, c_obj, l, u, fva_idx):\n    \"\"\"\n    Performs Flux Balance Analysis (FBA) followed by Flux Variability Analysis (FVA)\n    for a specified reaction.\n\n    Args:\n        S (np.ndarray): Stoichiometric matrix (m x n).\n        c_obj (np.ndarray): Objective function vector (n,).\n        l (np.ndarray): Lower bounds for fluxes (n,).\n        u (np.ndarray): Upper bounds for fluxes (n,).\n        fva_idx (int): Index of the reaction for which to compute the FVA range.\n\n    Returns:\n        list: A list containing the minimum and maximum flux values [v_min, v_max],\n              or [None, None] if any optimization fails.\n    \"\"\"\n    n_metabolites, n_reactions = S.shape\n    \n    # Stage 1: FBA to find the optimal objective value z_star\n    # We negate c_obj because linprog minimizes\n    c_fba = -c_obj\n    A_eq = S\n    b_eq = np.zeros(n_metabolites)\n    bounds = list(zip(l, u))\n\n    res_fba = linprog(c=c_fba, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs-ipm')\n\n    if not res_fba.success:\n        # FBA optimization failed\n        return [None, None]\n    \n    # The optimal objective value. Negate back because we minimized -c'v\n    z_star = -res_fba.fun\n\n    # Stage 2: FVA\n    # Add the constraint c'v = z_star to the equality constraints\n    A_eq_fva = np.vstack([S, c_obj])\n    # Use a small tolerance for floating point comparison in the constraint\n    # This can improve robustness, although standard linprog handles it well.\n    # The value z_star is used directly.\n    b_eq_fva = np.hstack([b_eq, z_star])\n\n    v_min, v_max = None, None\n\n    # --- Minimize v_j ---\n    c_fva_min = np.zeros(n_reactions)\n    c_fva_min[fva_idx] = 1.0\n    res_min = linprog(c=c_fva_min, A_eq=A_eq_fva, b_eq=b_eq_fva, bounds=bounds, method='highs-ipm')\n    if res_min.success:\n        v_min = res_min.fun\n\n    # --- Maximize v_j (by minimizing -v_j) ---\n    c_fva_max = np.zeros(n_reactions)\n    c_fva_max[fva_idx] = -1.0\n    res_max = linprog(c=c_fva_max, A_eq=A_eq_fva, b_eq=b_eq_fva, bounds=bounds, method='highs-ipm')\n    if res_max.success:\n        v_max = -res_max.fun\n\n    return [v_min, v_max]\n\n\ndef solve():\n    \"\"\"\n    Defines and solves the test cases provided in the problem statement.\n    \"\"\"\n    test_cases = [\n        {\n            \"name\": \"Test Case 1: Unique Optimum\",\n            \"S\": np.array([\n                [-1, 1, 0],\n                [-1, 0, 1]\n            ]),\n            \"c_obj\": np.array([0, 0, 1]),\n            \"l\": np.array([0, 0, 0]),\n            \"u\": np.array([10, 10, 10]),\n            \"fva_idx\": 1  # FVA for v2 (0-indexed)\n        },\n        {\n            \"name\": \"Test Case 2: Parallel Pathways\",\n            \"S\": np.array([\n                [1, -1, 0, -1],\n                [0, 1, -1, 1]\n            ]),\n            \"c_obj\": np.array([0, 0, 1, 0]),\n            \"l\": np.array([0, 0, 0, 0]),\n            \"u\": np.array([10, 10, 10, 10]),\n            \"fva_idx\": 1  # FVA for v2\n        },\n        {\n            \"name\": \"Test Case 3: Upper-bound-limited Optimum\",\n            \"S\": np.array([\n                [-1, 1, 0],\n                [-1, 0, 1]\n            ]),\n            \"c_obj\": np.array([0, 0, 1]),\n            \"l\": np.array([0, 0, 0]),\n            \"u\": np.array([10, 10, 5]),\n            \"fva_idx\": 1  # FVA for v2\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        v_min, v_max = run_fva(case[\"S\"], case[\"c_obj\"], case[\"l\"], case[\"u\"], case[\"fva_idx\"])\n        \n        # Round final results to three decimal places\n        if v_min is not None and v_max is not None:\n             # Handle potential -0.0 from rounding\n            v_min_rounded = 0.0 if np.isclose(v_min, 0) else round(v_min, 3)\n            v_max_rounded = 0.0 if np.isclose(v_max, 0) else round(v_max, 3)\n            results.append([v_min_rounded, v_max_rounded])\n        else:\n            # Append a placeholder if optimization fails, though it shouldn't for these cases\n            results.append([None, None])\n\n    # Format the output string exactly as required\n    result_strings = [f\"[{r[0]:.3f}, {r[1]:.3f}]\" for r in results]\n    final_output = f\"[{','.join(result_strings)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "Predicting the phenotype of a genetically modified organism, such as a gene knockout mutant, is a central goal of metabolic engineering. A common approach is to re-optimize the metabolic network's objective function under the new constraints. However, an alternative and often more accurate hypothesis is that the organism makes the minimum necessary adjustment from its original wild-type state. This principle is formalized in the Minimization of Metabolic Adjustment (MOMA) algorithm, which uses quadratic programming to find a feasible mutant flux distribution that minimizes the Euclidean distance to the wild-type flux vector. In this exercise , you will implement MOMA to predict the post-knockout state of a simple network, providing insight into a different modeling paradigm that prioritizes metabolic homeostasis over global re-optimization.",
            "id": "3325763",
            "problem": "Consider a small metabolic network under the steady-state assumption from Flux Balance Analysis (FBA), where the stoichiometric matrix is given by the single-row matrix\n$$\nS=\\begin{bmatrix}1 & -1 & -1\\end{bmatrix},\n$$\nand the flux vector is\n$$\nv=\\begin{bmatrix}v_1\\\\ v_2\\\\ v_3\\end{bmatrix}.\n$$\nThe steady-state constraint is\n$$\nS v = 0,\n$$\nand all fluxes are bounded by\n$$\n0 \\le v_i \\le 10 \\quad \\text{for } i \\in \\{1,2,3\\}.\n$$\nA gene knockout sets reaction $2$ inactive, that is,\n$$\nv_2 = 0.\n$$\nUsing Minimization Of Metabolic Adjustment (MOMA), compute the post-knockout flux vector by solving the convex optimization problem\n$$\n\\min_{v \\in \\mathbb{R}^3} \\ \\|v - v^{wt}\\|_2^2 \\quad \\text{subject to} \\quad S v = 0, \\ v_2 = 0, \\ 0 \\le v_i \\le 10 \\ \\text{for } i \\in \\{1,2,3\\},\n$$\nwhere $v^{wt}$ is the wild-type flux vector. Treat fluxes as unitless real numbers and report numerical values rounded to six decimal places.\n\nUse the following test suite of wild-type flux vectors:\n- Test $1$: $v^{wt} = (5,5,0)$.\n- Test $2$: $v^{wt} = (0,0,0)$.\n- Test $3$: $v^{wt} = (10,10,0)$.\n- Test $4$: $v^{wt} = (0,0,10)$.\n\nYour program should compute the MOMA-predicted post-knockout flux vector $v^\\star$ for each test case. The final program output must be a single line containing the list of all results, where each result is itself a list of three floats corresponding to $(v_1^\\star, v_2^\\star, v_3^\\star)$, rounded to six decimal places. The required format is\n$$\n\\text{[ [v1\\_1,v2\\_1,v3\\_1], [v1\\_2,v2\\_2,v3\\_2], [v1\\_3,v2\\_3,v3\\_3], [v1\\_4,v2\\_4,v3\\_4] ]},\n$$\nwith no additional characters or whitespace beyond standard commas and brackets. For example, a valid output shape looks like\n$$\n\\text{[[a,b,c],[d,e,f],[g,h,i],[j,k,l]]}.\n$$",
            "solution": "The problem is scientifically grounded, well-posed, and contains all necessary information to find a unique solution. It is a valid optimization problem rooted in the principles of computational systems biology.\n\nThe problem asks to find the post-knockout flux vector $v^\\star = \\begin{bmatrix} v_1^\\star & v_2^\\star & v_3^\\star \\end{bmatrix}^T$ that minimizes the squared Euclidean distance to a given wild-type flux vector $v^{wt}$. This is the core principle of Minimization Of Metabolic Adjustment (MOMA). The optimization problem is formulated as:\n$$\n\\min_{v \\in \\mathbb{R}^3} \\ \\|v - v^{wt}\\|_2^2\n$$\nsubject to the following constraints:\n1. Steady-state condition: $S v = 0$\n2. Gene knockout condition: $v_2 = 0$\n3. Flux bounds: $0 \\le v_i \\le 10$ for $i \\in \\{1,2,3\\}$\n\nLet $v = \\begin{bmatrix} v_1 \\\\ v_2 \\\\ v_3 \\end{bmatrix}$ and $v^{wt} = \\begin{bmatrix} v_1^{wt} \\\\ v_2^{wt} \\\\ v_3^{wt} \\end{bmatrix}$. The objective function to minimize is:\n$$\nf(v_1, v_2, v_3) = (v_1 - v_1^{wt})^2 + (v_2 - v_2^{wt})^2 + (v_3 - v_3^{wt})^2\n$$\nThe constraints can be simplified. The stoichiometric matrix is $S = \\begin{bmatrix} 1 & -1 & -1 \\end{bmatrix}$. The steady-state constraint $S v = 0$ thus translates to:\n$$\nv_1 - v_2 - v_3 = 0\n$$\nWe are also given the knockout constraint $v_2 = 0$. Substituting this into the steady-state equation gives:\n$$\nv_1 - 0 - v_3 = 0 \\implies v_1 = v_3\n$$\nThe feasible flux vectors must therefore be of the form $v = \\begin{bmatrix} v_1 \\\\ 0 \\\\ v_1 \\end{bmatrix}$. The bounds on the fluxes are $0 \\le v_1 \\le 10$, $0 \\le v_2 \\le 10$, and $0 \\le v_3 \\le 10$. Since $v_2=0$ and $v_1=v_3$, the active constraints become $0 \\le v_1 \\le 10$.\n\nThe problem has been reduced to finding the point on the line segment defined by $v = (t, 0, t)$ for $t \\in [0, 10]$ that is closest to the point $v^{wt}$.\nWe can substitute the constrained form of $v$ into the objective function. The problem becomes minimizing a function of a single variable, $v_1$:\n$$\ng(v_1) = (v_1 - v_1^{wt})^2 + (0 - v_2^{wt})^2 + (v_1 - v_3^{wt})^2\n$$\nsubject to $0 \\le v_1 \\le 10$.\n\nThis is a quadratic function of $v_1$, which describes a parabola opening upwards. To find the unconstrained minimum, we take the derivative of $g(v_1)$ with respect to $v_1$ and set it to zero:\n$$\n\\frac{dg}{dv_1} = 2(v_1 - v_1^{wt}) + 2(v_1 - v_3^{wt}) = 4v_1 - 2(v_1^{wt} + v_3^{wt})\n$$\nSetting the derivative to zero:\n$$\n4v_1 - 2(v_1^{wt} + v_3^{wt}) = 0\n$$\n$$\nv_1 = \\frac{v_1^{wt} + v_3^{wt}}{2}\n$$\nLet's call this unconstrained solution $v_{1,unc}$. To find the solution to the constrained problem, we must project this value onto the feasible interval $[0, 10]$. This is achieved by clamping the value:\n$$\nv_1^\\star = \\max(0, \\min(10, v_{1,unc}))\n$$\nThe optimal post-knockout flux vector $v^\\star$ is then given by $v^\\star = \\begin{bmatrix} v_1^\\star \\\\ 0 \\\\ v_1^\\star \\end{bmatrix}$.\n\nWe now apply this general solution to each test case.\n\n**Test Case 1:** $v^{wt} = (5, 5, 0)$\n- $v_{1,unc} = \\frac{5 + 0}{2} = 2.5$\n- Since $0 \\le 2.5 \\le 10$, we have $v_1^\\star = 2.5$.\n- $v^\\star = (2.5, 0, 2.5)$\n\n**Test Case 2:** $v^{wt} = (0, 0, 0)$\n- $v_{1,unc} = \\frac{0 + 0}{2} = 0$\n- Since $0 \\le 0 \\le 10$, we have $v_1^\\star = 0$.\n- $v^\\star = (0, 0, 0)$\n\n**Test Case 3:** $v^{wt} = (10, 10, 0)$\n- $v_{1,unc} = \\frac{10 + 0}{2} = 5$\n- Since $0 \\le 5 \\le 10$, we have $v_1^\\star = 5$.\n- $v^\\star = (5, 0, 5)$\n\n**Test Case 4:** $v^{wt} = (0, 0, 10)$\n- $v_{1,unc} = \\frac{0 + 10}{2} = 5$\n- Since $0 \\le 5 \\le 10$, we have $v_1^\\star = 5$.\n- $v^\\star = (5, 0, 5)$\n\nThe results are now ready to be formatted and presented in the final answer.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the MOMA-predicted post-knockout flux vector for a series of wild-type flux vectors.\n    \"\"\"\n    # Define the wild-type flux vectors from the problem statement.\n    test_cases = [\n        np.array([5.0, 5.0, 0.0]),  # Test 1\n        np.array([0.0, 0.0, 0.0]),  # Test 2\n        np.array([10.0, 10.0, 0.0]), # Test 3\n        np.array([0.0, 0.0, 10.0])   # Test 4\n    ]\n\n    flux_bounds = (0.0, 10.0)\n    results = []\n\n    for v_wt in test_cases:\n        # The MOMA problem is to minimize ||v - v_wt||^2 subject to Sv=0, v_2=0, and bounds.\n        # Constraints Sv=0 (v_1 - v_2 - v_3 = 0) and v_2=0 simplify to v_1 = v_3.\n        # The feasible solution is of the form v = [v1, 0, v1].\n        # The objective function becomes: (v1 - v1_wt)^2 + (0 - v2_wt)^2 + (v1 - v3_wt)^2.\n        # This is a 1D quadratic minimization problem for v1.\n        # The unconstrained minimum is found by setting the derivative to zero:\n        # 2*(v1 - v1_wt) + 2*(v1 - v3_wt) = 0  =>  4*v1 = 2*(v1_wt + v3_wt)\n        # v1_unc = (v1_wt + v3_wt) / 2\n        \n        v1_wt = v_wt[0]\n        v3_wt = v_wt[2]\n        \n        v1_unc = (v1_wt + v3_wt) / 2.0\n        \n        # The solution for v1 must respect the flux bounds [0, 10].\n        # This is achieved by clamping the unconstrained solution to the bounds.\n        v1_star = np.clip(v1_unc, flux_bounds[0], flux_bounds[1])\n        \n        # The final MOMA flux vector.\n        v_star = [v1_star, 0.0, v1_star]\n        \n        results.append(v_star)\n\n    # Format the output string as per the problem specification.\n    # [[v1_1,v2_1,v3_1],[v1_2,v2_2,v3_2],...] with 6 decimal places and no extra spaces.\n    formatted_vectors = []\n    for vec in results:\n        formatted_nums = [f\"{x:.6f}\" for x in vec]\n        formatted_vectors.append(f\"[{','.join(formatted_nums)}]\")\n    \n    final_output = f\"[{','.join(formatted_vectors)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        }
    ]
}