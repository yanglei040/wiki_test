{
    "hands_on_practices": [
        {
            "introduction": "我们将从通量平衡分析（FBA）的基础开始。FBA是计算系统生物学中的一种核心方法，它利用线性规划，在化学计量和通量容量的约束下，通过优化一个特定的细胞目标（如生物量生产或产物合成）来预测代谢通量分布。通过解决一个关于最小线性途径的FBA问题，您将亲身体验如何建立优化模型，并理解化学计量矩阵、通量边界和最优解之间的基本关系。",
            "id": "3325736",
            "problem": "考虑一个计算系统生物学中用于代谢工程的最小通路优化场景，该场景使用流平衡分析（FBA; Flux Balance Analysis）进行建模。一条通路涉及两种细胞内代谢物和三个串联的不可逆反应。该网络由一个化学计量矩阵 $S$ 表示，该矩阵编码了稳态下的质量守恒。通量向量为 $v \\in \\mathbb{R}^{3}$，其分量 $v_1$、$v_2$ 和 $v_3$ 对应于三个反应。该系统在稳态下运行，因此代谢物积累为零，细胞内通量满足 $S v = 0$。\n\n给定化学计量矩阵\n$$\nS=\\begin{bmatrix}\n-1  1  0 \\\\\n0  -1  1\n\\end{bmatrix},\n$$\n通量边界为 $0 \\leq v_i \\leq 10$（对于每个 $i \\in \\{1,2,3\\}$），以及线性目标向量 $c=(0,0,1)$，该向量编码了最大化反应 3 通量（例如，所需产物的合成或输出）的工程目标。假设所有反应都是不可逆的（热力学上限制为非负通量），并且除了所述的边界和稳态质量平衡外，没有其他额外的约束。\n\n建立并求解在 $S v = 0$ 和给定边界约束下最大化 $c^{\\top} v$ 的 FBA 优化问题。确定最优目标值 $\\max c^{\\top} v$。最终答案以 $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$ 为单位表示。无需四舍五入，报告精确值。",
            "solution": "所提出的问题是流平衡分析（FBA）的一个标准应用，FBA 是一种用于预测代谢通量分布的数学方法。该问题是一个线性规划问题，可以正式表述如下：\n\n最大化：\n$$z = c^{\\top} v$$\n约束条件：\n$$S v = 0$$\n$$v_{lb} \\leq v \\leq v_{ub}$$\n\n在这里，我们给出了该问题的具体组成部分。通量向量为 $v = \\begin{pmatrix} v_1 \\\\ v_2 \\\\ v_3 \\end{pmatrix}$。化学计量矩阵给定为：\n$$\nS=\\begin{bmatrix}\n-1  1  0 \\\\\n0  -1  1\n\\end{bmatrix}\n$$\n目标向量为 $c = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix}$，这意味着要最大化的目标函数是 $z = c^{\\top} v = (0)v_1 + (0)v_2 + (1)v_3 = v_3$。\n\n每个通量 $v_i$（其中 $i \\in \\{1, 2, 3\\}$）的通量边界为 $0 \\leq v_i \\leq 10$。这可以写成下界 $v_{lb} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}$ 和上界 $v_{ub} = \\begin{pmatrix} 10 \\\\ 10 \\\\ 10 \\end{pmatrix}$。\n\n首先，我们分析稳态质量平衡约束 $S v = 0$。这个矩阵方程展开为一个线性方程组：\n$$\n\\begin{bmatrix}\n-1  1  0 \\\\\n0  -1  1\n\\end{bmatrix}\n\\begin{pmatrix}\nv_1 \\\\\nv_2 \\\\\nv_3\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0 \\\\\n0\n\\end{pmatrix}\n$$\n\n该系统对应于两个方程：\n方程 1: $(-1)v_1 + (1)v_2 + (0)v_3 = 0 \\implies -v_1 + v_2 = 0 \\implies v_1 = v_2$。\n方程 2: $(0)v_1 + (-1)v_2 + (1)v_3 = 0 \\implies -v_2 + v_3 = 0 \\implies v_2 = v_3$。\n\n结合这两个结果，我们发现稳态条件要求通量之间存在以下关系：\n$$v_1 = v_2 = v_3$$\n对于在稳态下运行的简单线性通路，这是一个预期的结果，其中通量必须在通路的每一步都守恒。让我们定义一个共同的通量变量 $v_c$，使得 $v_c = v_1 = v_2 = v_3$。\n\n现在我们可以用这个单一变量 $v_c$ 来重新表述优化问题。目标是最大化 $v_3$，这等同于最大化 $v_c$。\n对各个通量的约束都必须满足。我们将 $v_c$ 代入通量边界：\n1. 对于 $v_1$: $0 \\leq v_1 \\leq 10 \\implies 0 \\leq v_c \\leq 10$。\n2. 对于 $v_2$: $0 \\leq v_2 \\leq 10 \\implies 0 \\leq v_c \\leq 10$。\n3. 对于 $v_3$: $0 \\leq v_3 \\leq 10 \\implies 0 \\leq v_c \\leq 10$。\n\n所有三个约束都是相同的。因此，问题简化为找到满足条件 $0 \\leq v_c \\leq 10$ 的 $v_c$ 的最大值。\n优化问题简化为：\n最大化：$v_c$\n约束条件：$0 \\leq v_c \\leq 10$。\n\n满足这个不等式的 $v_c$ 的最大值显然是 $10$。\n最优目标值是 $z = v_3$ 的最大值。因为 $v_3 = v_c$，所以最大值是：\n$$\\max(z) = \\max(v_3) = \\max(v_c) = 10$$\n最优通量分布是 $v_{opt} = \\begin{pmatrix} v_1 \\\\ v_2 \\\\ v_3 \\end{pmatrix} = \\begin{pmatrix} 10 \\\\ 10 \\\\ 10 \\end{pmatrix}$。我们可以验证该解满足所有约束：\n$S v_{opt} = \\begin{bmatrix} -1  1  0 \\\\ 0  -1  1 \\end{bmatrix} \\begin{pmatrix} 10 \\\\ 10 \\\\ 10 \\end{pmatrix} = \\begin{pmatrix} -10+10 \\\\ -10+10 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$。稳态条件得到满足。\n边界 $0 \\leq 10 \\leq 10$ 也得到满足。\n目标值为 $c^{\\top} v_{opt} = v_3 = 10$。\n\n问题要求以 $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$ 为单位给出答案。由于问题是用无量纲数定义的，我们假设通量值和边界是以这些单位给出的。因此，最优目标值在指定单位下是 $10$。",
            "answer": "$$\\boxed{10}$$"
        },
        {
            "introduction": "在通过FBA找到一个最优通量解之后，一个自然的问题是：这个解是唯一的吗？通量变异性分析（FVA）正是为了回答这个问题而设计的。通过在保持主要目标（例如，最大生长速率）为最优值的前提下，计算网络中每个反应通量的允许变化范围，FVA揭示了代谢网络的内在灵活性和冗余性。这个编程练习将指导您实现FVA，并将其应用于不同结构的网络，从而学会区分唯一的通量解和存在替代途径的灵活解，这对于理解代谢鲁棒性和设计新途径至关重要。",
            "id": "3325767",
            "problem": "考虑一个稳态代谢网络，其由化学计量矩阵 $S \\in \\mathbb{R}^{m \\times n}$、通量向量 $v \\in \\mathbb{R}^n$ 以及反应通量的下界 $l \\in \\mathbb{R}^n$ 和上界 $u \\in \\mathbb{R}^n$ 表示。稳态假设施加了质量平衡约束 $S v = 0$。反应界限施加了对于所有 $i \\in \\{1,\\dots,n\\}$ 都有 $l_i \\le v_i \\le u_i$。通量平衡分析 (Flux Balance Analysis, FBA) 旨在在这些约束下最大化一个线性目标函数 $c^\\top v$。最优状态下的通量变异性分析 (Flux Variability Analysis, FVA) 旨在通过求解两个线性规划问题，来寻求当目标固定在其最优值时每个反应通量的范围：一个问题是在满足 $S v = 0$、$l \\le v \\le u$ 和 $c^\\top v = c^\\top v^\\star$ 的约束条件下最小化 $v_j$，另一个是最大化 $v_j$。其中 $v^\\star$ 是原始 FBA 问题的解。\n\n所有通量必须以毫摩尔每克干重每小时 (mmol gDW$^{-1}$ h$^{-1}$) 为单位表示。您的程序必须为每个测试用例中的一个指定反应计算最优状态下的 FVA 范围，并打印结果，四舍五入到三位小数，不打印单位符号。\n\n使用以下测试套件，该套件采用物理上合理的低维网络来测试不同方面，包括唯一最优解、引起变异性的替代平行通路以及受上界限制的最优解：\n\n- 测试用例 1 (唯一最优解)：$S = \\begin{bmatrix} -1  1  0 \\\\ -1  0  1 \\end{bmatrix}$，界限为对于所有 $i \\in \\{1,2,3\\}$ 都有 $0 \\le v_i \\le 10$，目标为 $\\max v_3$ (即 $c = (0,0,1)$)，并在最优状态下计算 $v_2$ 的 FVA 范围。\n- 测试用例 2 (平行通路引起变异性)：$S = \\begin{bmatrix} 1  -1  0  -1 \\\\ 0  1  -1  1 \\end{bmatrix}$，界限为对于所有 $i \\in \\{1,2,3,4\\}$ 都有 $0 \\le v_i \\le 10$，目标为 $\\max v_3$ (即 $c = (0,0,1,0)$)，并在最优状态下计算 $v_2$ 的 FVA 范围。\n- 测试用例 3 (受上界限制的最优解)：$S = \\begin{bmatrix} -1  1  0 \\\\ -1  0  1 \\end{bmatrix}$，界限为 $0 \\le v_1 \\le 10$，$0 \\le v_2 \\le 10$，$0 \\le v_3 \\le 5$，目标为 $\\max v_3$ (即 $c = (0,0,1)$)，并在最优状态下计算 $v_2$ 的 FVA 范围。\n\n在所有情况下，将反应在给定界限内视为不可逆。明确地说，一般的 FBA 问题是：\n$$\n\\begin{aligned}\n\\text{maximize} \\quad  c^\\top v \\\\\n\\text{subject to} \\quad  S v = 0, \\\\\n l \\le v \\le u.\n\\end{aligned}\n$$\n给定最优值 $c^\\top v^\\star$，索引 $j$ 的 FVA 范围通过求解以下问题计算得出：\n$$\n\\begin{aligned}\n\\text{minimize} \\quad  v_j \\\\\n\\text{subject to} \\quad  S v = 0, \\\\\n l \\le v \\le u, \\\\\n c^\\top v = c^\\top v^\\star,\n\\end{aligned}\n$$\n和\n$$\n\\begin{aligned}\n\\text{maximize} \\quad  v_j \\\\\n\\text{subject to} \\quad  S v = 0, \\\\\n l \\le v \\le u, \\\\\n c^\\top v = c^\\top v^\\star.\n\\end{aligned}\n$$\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。列表中的每个元素都是一个对应于相应测试用例的双元素列表 $[v_j^{\\min}, v_j^{\\max}]$。例如，输出格式必须完全像 $[[a_1,b_1],[a_2,b_2],[a_3,b_3]]$，其中每个 $a_k$ 和 $b_k$ 都是以 mmol gDW$^{-1}$ h$^{-1}$ 为单位、四舍五入到三位小数的浮点数。",
            "solution": "在尝试解决问题之前，问题陈述经过了严格的验证过程。\n\n### 步骤 1：提取已知条件\n问题提供了以下信息：\n- 一个稳态代谢网络由化学计量矩阵 $S \\in \\mathbb{R}^{m \\times n}$ 和通量向量 $v \\in \\mathbb{R}^n$ 描述。\n- 质量平衡约束由 $S v = 0$ 给出。\n- 通量界限由 $l \\le v \\le u$ 给出，其中 $l, u \\in \\mathbb{R}^n$。\n- 通量平衡分析 (FBA) 定义为以下优化问题：\n$$\n\\begin{aligned}\n\\text{maximize} \\quad  c^\\top v \\\\\n\\text{subject to} \\quad  S v = 0, \\\\\n l \\le v \\le u.\n\\end{aligned}\n$$\n- 对于一个通量 $v_j$，最优状态下的通量变异性分析 (FVA) 定义为在 FBA 约束的基础上，加上目标函数等于其最优值 $c^\\top v = c^\\top v^\\star$ 的额外约束，求 $v_j$ 的最小值和最大值。\n- 所有通量单位均为 mmol gDW$^{-1}$ h$^{-1}$。\n- 测试用例 1：$S = \\begin{bmatrix} -1  1  0 \\\\ -1  0  1 \\end{bmatrix}$，界限为对于 $i \\in \\{1,2,3\\}$ 都有 $0 \\le v_i \\le 10$，目标为 $c = (0,0,1)^\\top$ (最大化 $v_3$)，对 $v_2$ 进行 FVA。\n- 测试用例 2：$S = \\begin{bmatrix} 1  -1  0  -1 \\\\ 0  1  -1  1 \\end{bmatrix}$，界限为对于 $i \\in \\{1,2,3,4\\}$ 都有 $0 \\le v_i \\le 10$，目标为 $c = (0,0,1,0)^\\top$ (最大化 $v_3$)，对 $v_2$ 进行 FVA。\n- 测试用例 3：$S = \\begin{bmatrix} -1  1  0 \\\\ -1  0  1 \\end{bmatrix}$，界限为 $0 \\le v_1 \\le 10$，$0 \\le v_2 \\le 10$，$0 \\le v_3 \\le 5$，目标为 $c = (0,0,1)^\\top$ (最大化 $v_3$)，对 $v_2$ 进行 FVA。\n- 输出格式被指定为包含一个逗号分隔的双元素列表的单行，例如 $[[a_1,b_1],[a_2,b_2],[a_3,b_3]]$，数字四舍五入到三位小数。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据验证标准对问题进行评估。\n- **有科学依据**：该问题基于通量平衡分析和通量变异性分析，这是计算系统生物学和代谢工程中的标准、成熟的技术。其基本原理是稳态下生物化学反应网络中的质量守恒，这是物理化学和生物学中的一个基本概念。该问题在科学上是合理的。\n- **良构的**：该问题需要求解一系列线性规划 (LP) 问题。对于给定的约束集，一个 LP 问题是良构的：它要么有最优解，要么是无界的，要么是不可行的。所提供的约束（有界通量变量）确保解空间是一个凸多胞体，从而保证目标函数将有一个有限的最优解。该问题是良构的。\n- **客观性**：该问题使用精确的数学形式和客观语言进行陈述。所有术语（$S$, $v$, $l$, $u$, $c$）都得到了清晰定义，优化问题也得到了明确无误的说明。\n- **完整性**：为每个测试用例提供了所有必要的数据（化学计量矩阵、界限、目标）。\n- **一致性**：每个测试用例的已知条件都是内部一致的，不包含矛盾。\n\n### 步骤 3：结论与行动\n该问题是有效的。它是一个定义明确的代谢工程计算问题，具有科学依据，数学上一致且完整。将提供一个解决方案。\n\n### 基于原理的解决方案\n\n任务是计算在最优目标值下特定反应通量的通量变异性分析 (FVA) 范围。对于每个测试用例，这是一个涉及求解线性规划 (LP) 问题的两阶段过程。\n\n**阶段 1：通量平衡分析 (FBA)**\n首先，我们确定生物学目标函数的最大值。这通过求解 FBA 问题来实现，它是一个 LP：\n$$\n\\begin{aligned}\nz^\\star = \\max_{v} \\quad  c^\\top v \\\\\n\\text{subject to} \\quad  S v = 0 \\\\\n l \\le v \\le u\n\\end{aligned}\n$$\n此优化的结果是最优目标值 $z^\\star$。\n\n**阶段 2：通量变异性分析 (FVA)**\n接下来，我们确定特定通量 $v_j$ 的可行范围 $[v_j^{\\min}, v_j^{\\max}]$，同时确保目标保持其最优值 $z^\\star$。这需要求解两个额外的 LP。\n\n为了找到可能的最小通量 $v_j^{\\min}$：\n$$\n\\begin{aligned}\nv_j^{\\min} = \\min_{v} \\quad  v_j \\\\\n\\text{subject to} \\quad  S v = 0 \\\\\n l \\le v \\le u \\\\\n c^\\top v = z^\\star\n\\end{aligned}\n$$\n为了找到可能的最大通量 $v_j^{\\max}$：\n$$\n\\begin{aligned}\nv_j^{\\max} = \\max_{v} \\quad  v_j \\\\\n\\text{subject to} \\quad  S v = 0 \\\\\n l \\le v \\le u \\\\\n c^\\top v = z^\\star\n\\end{aligned}\n$$\n这些 LP 将使用 `scipy.optimize.linprog` 函数进行计算求解，该函数用于寻找目标函数的最小值。最大化问题通过最小化目标函数的相反数来求解。\n\n**测试用例分析**\n\n**测试用例 1：唯一最优解**\n- $S = \\begin{bmatrix} -1  1  0 \\\\ -1  0  1 \\end{bmatrix}$, $l=(0,0,0)^\\top$, $u=(10,10,10)^\\top$, $c=(0,0,1)^\\top$, 对 $v_2$ 进行 FVA。\n- 稳态约束 $Sv=0$ 转换为：\n  $$-v_1 + v_2 = 0 \\implies v_1 = v_2$$\n  $$-v_1 + v_3 = 0 \\implies v_1 = v_3$$\n- 因此，我们必须有 $v_1 = v_2 = v_3$。\n- FBA 的目标是最大化 $v_3$。给定界限 $0 \\le v_i \\le 10$， $v_3$ 的最大值为 $10$。所以，$z^\\star = 10$。\n- 最优状态是唯一的：$v_1^\\star = v_2^\\star = v_3^\\star = 10$。\n- 对于 FVA，我们添加约束 $c^\\top v = v_3 = 10$。这与 $v_1 = v_2 = v_3$ 相结合，迫使 $v_2$ 恰好为 $10$。\n- $v_2$ 的 FVA 范围是 $[10.0, 10.0]$。\n\n**测试用例 2：平行通路**\n- $S = \\begin{bmatrix} 1  -1  0  -1 \\\\ 0  1  -1  1 \\end{bmatrix}$, $l=(0,0,0,0)^\\top$, $u=(10,10,10,10)^\\top$, $c=(0,0,1,0)^\\top$, 对 $v_2$ 进行 FVA。\n- 约束 $Sv=0$ 转换为：\n  $$v_1 - v_2 - v_4 = 0 \\implies v_1 = v_2 + v_4$$\n  $$v_2 - v_3 + v_4 = 0 \\implies v_3 = v_2 + v_4$$\n- 这意味着 $v_1 = v_3$。\n- FBA 的目标是最大化 $v_3$。由于 $v_3 = v_1$ 且 $v_1$ 受限于 $0 \\le v_1 \\le 10$， $v_3$ 的最大值为 $10$。所以，$z^\\star = 10$。\n- 对于 FVA，我们添加约束 $c^\\top v = v_3 = 10$。这意味着 $v_1 = 10$。系统方程变为 $10 = v_2 + v_4$。\n- 我们需要找到 $v_2$ 在约束 $v_2 + v_4 = 10$ 以及界限 $0 \\le v_2 \\le 10$ 和 $0 \\le v_4 \\le 10$ 下的范围。\n  - 为了最小化 $v_2$，我们最大化 $v_4$。$v_4$ 的最大值为 $10$，这得到 $v_2 = 10 - 10 = 0$。所以，$v_2^{\\min} = 0$。\n  - 为了最大化 $v_2$，我们最小化 $v_4$。$v_4$ 的最小值为 $0$，这得到 $v_2 = 10 - 0 = 10$。所以，$v_2^{\\max} = 10$。\n- $v_2$ 的 FVA 范围是 $[0.0, 10.0]$。\n\n**测试用例 3：受上界限制的最优解**\n- $S = \\begin{bmatrix} -1  1  0 \\\\ -1  0  1 \\end{bmatrix}$, $l=(0,0,0)^\\top$, $u=(10,10,5)^\\top$, $c=(0,0,1)^\\top$, 对 $v_2$ 进行 FVA。\n- 方程组与案例 1 相同：$v_1 = v_2 = v_3$。\n- FBA 的目标是最大化 $v_3$。界限为 $0 \\le v_1 \\le 10$，$0 \\le v_2 \\le 10$ 和 $0 \\le v_3 \\le 5$。\n- $v_3$ 的最大值直接受其上界 $u_3=5$ 的限制。所以，$z^\\star = 5$。\n- 最优状态是唯一的：$v_1^\\star = v_2^\\star = v_3^\\star = 5$。\n- 对于 FVA，我们添加约束 $c^\\top v = v_3 = 5$。这与 $v_1 = v_2 = v_3$ 相结合，迫使 $v_2$ 恰好为 $5$。\n- $v_2$ 的 FVA 范围是 $[5.0, 5.0]$。\n\n**计算实现**\n实现一个 Python 函数来自动化这个两阶段过程。该函数 (`run_fva`) 接受模型参数（$S, c, l, u$）和要分析的通量的索引。\n1. 它首先使用 `scipy.optimize.linprog` 设置并求解 FBA 问题。为执行最大化，`linprog` 的目标向量是 $-c$。等式约束为 $A_{eq}=S$ 和 $b_{eq}=0$。\n2. 从结果中提取最优目标值 $z^\\star$。\n3. 对于 FVA 步骤，增广等式约束矩阵以包含新约束 $c^\\top v = z^\\star$。新矩阵是 $A'_{eq} = \\begin{bmatrix} S \\\\ c^\\top \\end{bmatrix}$，新向量是 $b'_{eq} = \\begin{bmatrix} 0 \\\\ \\vdots \\\\ 0 \\\\ z^\\star \\end{bmatrix}$。\n4. 然后使用这些新约束求解两个 LP。\n   - 为了找到 $v_j^{\\min}$，目标向量在索引 $j$ 处为 $1$，其他位置为零。\n   - 为了找到 $v_j^{\\max}$，目标向量在索引 $j$ 处为 $-1$，其他位置为零。然后将结果取反。\n所有测试用例的结果被收集、四舍五入，并格式化为所需的输出字符串。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef run_fva(S, c_obj, l, u, fva_idx):\n    \"\"\"\n    Performs Flux Balance Analysis (FBA) followed by Flux Variability Analysis (FVA)\n    for a specified reaction.\n\n    Args:\n        S (np.ndarray): Stoichiometric matrix (m x n).\n        c_obj (np.ndarray): Objective function vector (n,).\n        l (np.ndarray): Lower bounds for fluxes (n,).\n        u (np.ndarray): Upper bounds for fluxes (n,).\n        fva_idx (int): Index of the reaction for which to compute the FVA range.\n\n    Returns:\n        list: A list containing the minimum and maximum flux values [v_min, v_max],\n              or [None, None] if any optimization fails.\n    \"\"\"\n    n_metabolites, n_reactions = S.shape\n    \n    # Stage 1: FBA to find the optimal objective value z_star\n    # We negate c_obj because linprog minimizes\n    c_fba = -c_obj\n    A_eq = S\n    b_eq = np.zeros(n_metabolites)\n    bounds = list(zip(l, u))\n\n    res_fba = linprog(c=c_fba, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs-ipm')\n\n    if not res_fba.success:\n        # FBA optimization failed\n        return [None, None]\n    \n    # The optimal objective value. Negate back because we minimized -c'v\n    z_star = -res_fba.fun\n\n    # Stage 2: FVA\n    # Add the constraint c'v = z_star to the equality constraints\n    A_eq_fva = np.vstack([S, c_obj])\n    # Use a small tolerance for floating point comparison in the constraint\n    # This can improve robustness, although standard linprog handles it well.\n    # The value z_star is used directly.\n    b_eq_fva = np.hstack([b_eq, z_star])\n\n    v_min, v_max = None, None\n\n    # --- Minimize v_j ---\n    c_fva_min = np.zeros(n_reactions)\n    c_fva_min[fva_idx] = 1.0\n    res_min = linprog(c=c_fva_min, A_eq=A_eq_fva, b_eq=b_eq_fva, bounds=bounds, method='highs-ipm')\n    if res_min.success:\n        v_min = res_min.fun\n\n    # --- Maximize v_j (by minimizing -v_j) ---\n    c_fva_max = np.zeros(n_reactions)\n    c_fva_max[fva_idx] = -1.0\n    res_max = linprog(c=c_fva_max, A_eq=A_eq_fva, b_eq=b_eq_fva, bounds=bounds, method='highs-ipm')\n    if res_max.success:\n        v_max = -res_max.fun\n\n    return [v_min, v_max]\n\n\ndef solve():\n    \"\"\"\n    Defines and solves the test cases provided in the problem statement.\n    \"\"\"\n    test_cases = [\n        {\n            \"name\": \"Test Case 1: Unique Optimum\",\n            \"S\": np.array([\n                [-1, 1, 0],\n                [-1, 0, 1]\n            ]),\n            \"c_obj\": np.array([0, 0, 1]),\n            \"l\": np.array([0, 0, 0]),\n            \"u\": np.array([10, 10, 10]),\n            \"fva_idx\": 1  # FVA for v2 (0-indexed)\n        },\n        {\n            \"name\": \"Test Case 2: Parallel Pathways\",\n            \"S\": np.array([\n                [1, -1, 0, -1],\n                [0, 1, -1, 1]\n            ]),\n            \"c_obj\": np.array([0, 0, 1, 0]),\n            \"l\": np.array([0, 0, 0, 0]),\n            \"u\": np.array([10, 10, 10, 10]),\n            \"fva_idx\": 1  # FVA for v2\n        },\n        {\n            \"name\": \"Test Case 3: Upper-bound-limited Optimum\",\n            \"S\": np.array([\n                [-1, 1, 0],\n                [-1, 0, 1]\n            ]),\n            \"c_obj\": np.array([0, 0, 1]),\n            \"l\": np.array([0, 0, 0]),\n            \"u\": np.array([10, 10, 5]),\n            \"fva_idx\": 1  # FVA for v2\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        v_min, v_max = run_fva(case[\"S\"], case[\"c_obj\"], case[\"l\"], case[\"u\"], case[\"fva_idx\"])\n        \n        # Round final results to three decimal places\n        if v_min is not None and v_max is not None:\n             # Handle potential -0.0 from rounding\n            v_min_rounded = 0.0 if np.isclose(v_min, 0) else round(v_min, 3)\n            v_max_rounded = 0.0 if np.isclose(v_max, 0) else round(v_max, 3)\n            results.append([v_min_rounded, v_max_rounded])\n        else:\n            # Append a placeholder if optimization fails, though it shouldn't for these cases\n            results.append([None, None])\n\n    # Format the output string exactly as required\n    result_strings = [f\"[{r[0]:.3f}, {r[1]:.3f}]\" for r in results]\n    final_output = f\"[{','.join(result_strings)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "FBA及其变体通常假设细胞在受到基因扰动（如基因敲除）后会重新优化其代谢网络以达到新的最优状态。然而，代谢调整最小化（MOMA）假说提出了一个不同的观点：它假设细胞会进行最小程度的代谢重组，使其通量分布尽可能接近原始的野生型状态。这个练习将引导您实现MOMA算法，通过求解一个二次规划问题来预测基因敲除后的代谢表型。通过实践MOMA，您将接触到一种与FBA不同的建模思想，它在预测未经长期适应性进化的突变株表型时，有时能提供更准确的结果。",
            "id": "3325763",
            "problem": "考虑一个源于流平衡分析（FBA）并处于稳态假设下的小型代谢网络，其化学计量矩阵为一个单行矩阵\n$$\nS=\\begin{bmatrix}1  -1  -1\\end{bmatrix},\n$$\n其通量向量为\n$$\nv=\\begin{bmatrix}v_1\\\\ v_2\\\\ v_3\\end{bmatrix}.\n$$\n稳态约束为\n$$\nS v = 0,\n$$\n且所有通量均受以下边界约束\n$$\n0 \\le v_i \\le 10 \\quad \\text{for } i \\in \\{1,2,3\\}.\n$$\n基因敲除使反应 $2$ 失活，即\n$$\nv_2 = 0.\n$$\n使用代谢调整最小化（MOMA）方法，通过求解以下凸优化问题来计算敲除后的通量向量\n$$\n\\min_{v \\in \\mathbb{R}^3} \\ \\|v - v^{wt}\\|_2^2 \\quad \\text{subject to} \\quad S v = 0, \\ v_2 = 0, \\ 0 \\le v_i \\le 10 \\ \\text{for } i \\in \\{1,2,3\\},\n$$\n其中 $v^{wt}$ 是野生型通量向量。将通量视为无量纲实数，并报告四舍五入到六位小数的数值。\n\n使用以下野生型通量向量测试集：\n- 测试 $1$：$v^{wt} = (5,5,0)$。\n- 测试 $2$：$v^{wt} = (0,0,0)$。\n- 测试 $3$：$v^{wt} = (10,10,0)$。\n- 测试 $4$：$v^{wt} = (0,0,10)$。\n\n您的程序应为每个测试用例计算 MOMA 预测的敲除后通量向量 $v^\\star$。最终的程序输出必须是包含所有结果列表的单行文本，其中每个结果本身是对应于 $(v_1^\\star, v_2^\\star, v_3^\\star)$ 的三个浮点数的列表，四舍五入到六位小数。要求的格式为\n$$\n\\text{[ [v1\\_1,v2\\_1,v3\\_1], [v1\\_2,v2\\_2,v3\\_2], [v1\\_3,v2\\_3,v3\\_3], [v1\\_4,v2\\_4,v3\\_4] ]},\n$$\n除了标准的逗号和方括号外，不含任何额外的字符或空格。例如，一个有效的输出形式如下\n$$\n\\text{[[a,b,c],[d,e,f],[g,h,i],[j,k,l]]}.\n$$",
            "solution": "该问题具有科学依据，定义明确，并包含求得唯一解所需的所有信息。这是一个基于计算系统生物学原理的有效优化问题。\n\n该问题要求找到敲除后的通量向量 $v^\\star = \\begin{bmatrix} v_1^\\star  v_2^\\star  v_3^\\star \\end{bmatrix}^T$，使其与给定的野生型通量向量 $v^{wt}$ 之间的欧几里得距离的平方最小。这是代谢调整最小化（MOMA）的核心原理。该优化问题可表述为：\n$$\n\\min_{v \\in \\mathbb{R}^3} \\ \\|v - v^{wt}\\|_2^2\n$$\n约束条件如下：\n1. 稳态条件：$S v = 0$\n2. 基因敲除条件：$v_2 = 0$\n3. 通量边界：$0 \\le v_i \\le 10$，其中 $i \\in \\{1,2,3\\}$\n\n令 $v = \\begin{bmatrix} v_1 \\\\ v_2 \\\\ v_3 \\end{bmatrix}$ 和 $v^{wt} = \\begin{bmatrix} v_1^{wt} \\\\ v_2^{wt} \\\\ v_3^{wt} \\end{bmatrix}$。需要最小化的目标函数为：\n$$\nf(v_1, v_2, v_3) = (v_1 - v_1^{wt})^2 + (v_2 - v_2^{wt})^2 + (v_3 - v_3^{wt})^2\n$$\n约束条件可以简化。化学计量矩阵为 $S = \\begin{bmatrix} 1  -1  -1 \\end{bmatrix}$。因此，稳态约束 $S v = 0$ 可转化为：\n$$\nv_1 - v_2 - v_3 = 0\n$$\n我们还已知敲除约束 $v_2 = 0$。将此代入稳态方程可得：\n$$\nv_1 - 0 - v_3 = 0 \\implies v_1 = v_3\n$$\n因此，可行的通量向量必须为 $v = \\begin{bmatrix} v_1 \\\\ 0 \\\\ v_1 \\end{bmatrix}$ 的形式。通量的边界为 $0 \\le v_1 \\le 10$，$0 \\le v_2 \\le 10$ 和 $0 \\le v_3 \\le 10$。由于 $v_2=0$ 且 $v_1=v_3$，有效的约束变为 $0 \\le v_1 \\le 10$。\n\n问题被简化为，在由 $v = (t, 0, t)$ 定义的线段上（其中 $t \\in [0, 10]$）找到距离点 $v^{wt}$ 最近的点。\n我们可以将 $v$ 的约束形式代入目标函数。问题变为最小化单变量 $v_1$ 的函数：\n$$\ng(v_1) = (v_1 - v_1^{wt})^2 + (0 - v_2^{wt})^2 + (v_1 - v_3^{wt})^2\n$$\n约束条件为 $0 \\le v_1 \\le 10$。\n\n这是一个关于 $v_1$ 的二次函数，其图像为一条开口向上的抛物线。为了找到无约束情况下的最小值，我们对 $g(v_1)$ 求关于 $v_1$ 的导数，并令其为零：\n$$\n\\frac{dg}{dv_1} = 2(v_1 - v_1^{wt}) + 2(v_1 - v_3^{wt}) = 4v_1 - 2(v_1^{wt} + v_3^{wt})\n$$\n令导数为零：\n$$\n4v_1 - 2(v_1^{wt} + v_3^{wt}) = 0\n$$\n$$\nv_1 = \\frac{v_1^{wt} + v_3^{wt}}{2}\n$$\n我们将此无约束解称为 $v_{1,unc}$。为了找到有约束问题的解，我们必须将此值投影到可行区间 $[0, 10]$ 上。这通过将值限制在该区间内来实现：\n$$\nv_1^\\star = \\max(0, \\min(10, v_{1,unc}))\n$$\n最优的敲除后通量向量 $v^\\star$ 则由 $v^\\star = \\begin{bmatrix} v_1^\\star \\\\ 0 \\\\ v_1^\\star \\end{bmatrix}$ 给出。\n\n现在我们将此通用解应用于每个测试用例。\n\n**测试用例 1:** $v^{wt} = (5, 5, 0)$\n- $v_{1,unc} = \\frac{5 + 0}{2} = 2.5$\n- 因为 $0 \\le 2.5 \\le 10$，我们得到 $v_1^\\star = 2.5$。\n- $v^\\star = (2.5, 0, 2.5)$\n\n**测试用例 2:** $v^{wt} = (0, 0, 0)$\n- $v_{1,unc} = \\frac{0 + 0}{2} = 0$\n- 因为 $0 \\le 0 \\le 10$，我们得到 $v_1^\\star = 0$。\n- $v^\\star = (0, 0, 0)$\n\n**测试用例 3:** $v^{wt} = (10, 10, 0)$\n- $v_{1,unc} = \\frac{10 + 0}{2} = 5$\n- 因为 $0 \\le 5 \\le 10$，我们得到 $v_1^\\star = 5$。\n- $v^\\star = (5, 0, 5)$\n\n**测试用例 4:** $v^{wt} = (0, 0, 10)$\n- $v_{1,unc} = \\frac{0 + 10}{2} = 5$\n- 因为 $0 \\le 5 \\le 10$，我们得到 $v_1^\\star = 5$。\n- $v^\\star = (5, 0, 5)$\n\n现在可以将结果格式化并呈现在最终答案中。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the MOMA-predicted post-knockout flux vector for a series of wild-type flux vectors.\n    \"\"\"\n    # Define the wild-type flux vectors from the problem statement.\n    test_cases = [\n        np.array([5.0, 5.0, 0.0]),  # Test 1\n        np.array([0.0, 0.0, 0.0]),  # Test 2\n        np.array([10.0, 10.0, 0.0]), # Test 3\n        np.array([0.0, 0.0, 10.0])   # Test 4\n    ]\n\n    flux_bounds = (0.0, 10.0)\n    results = []\n\n    for v_wt in test_cases:\n        # The MOMA problem is to minimize ||v - v_wt||^2 subject to Sv=0, v_2=0, and bounds.\n        # Constraints Sv=0 (v_1 - v_2 - v_3 = 0) and v_2=0 simplify to v_1 = v_3.\n        # The feasible solution is of the form v = [v1, 0, v1].\n        # The objective function becomes: (v1 - v1_wt)^2 + (0 - v2_wt)^2 + (v1 - v3_wt)^2.\n        # This is a 1D quadratic minimization problem for v1.\n        # The unconstrained minimum is found by setting the derivative to zero:\n        # 2*(v1 - v1_wt) + 2*(v1 - v3_wt) = 0  =  4*v1 = 2*(v1_wt + v3_wt)\n        # v1_unc = (v1_wt + v3_wt) / 2\n        \n        v1_wt = v_wt[0]\n        v3_wt = v_wt[2]\n        \n        v1_unc = (v1_wt + v3_wt) / 2.0\n        \n        # The solution for v1 must respect the flux bounds [0, 10].\n        # This is achieved by clamping the unconstrained solution to the bounds.\n        v1_star = np.clip(v1_unc, flux_bounds[0], flux_bounds[1])\n        \n        # The final MOMA flux vector.\n        v_star = [v1_star, 0.0, v1_star]\n        \n        results.append(v_star)\n\n    # Format the output string as per the problem specification.\n    # [[v1_1,v2_1,v3_1],[v1_2,v2_2,v3_2],...] with 6 decimal places and no extra spaces.\n    formatted_vectors = []\n    for vec in results:\n        formatted_nums = [f\"{x:.6f}\" for x in vec]\n        formatted_vectors.append(f\"[{','.join(formatted_nums)}]\")\n    \n    final_output = f\"[{','.join(formatted_vectors)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        }
    ]
}