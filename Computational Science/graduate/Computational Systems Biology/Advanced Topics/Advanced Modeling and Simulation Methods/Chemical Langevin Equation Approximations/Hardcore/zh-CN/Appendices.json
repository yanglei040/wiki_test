{
    "hands_on_practices": [
        {
            "introduction": "构建任何化学系统的随机模型的第一步是定义其基本组成部分。本练习侧重于推导一个简单双分子反应的倾向函数和化学计量向量。这两个元素是化学朗之万方程（Chemical Langevin Equation, CLE）的基石，分别定义了其漂移项和扩散项。掌握此推导对于将生物反应网络正确转化为可用于模拟和分析的数学模型至关重要。",
            "id": "3294926",
            "problem": "考虑一个体积固定为 $\\Omega$、充分搅拌的等温隔室，其中包含三种化学物种 $A$、$B$ 和 $C$，其分子数分别为 $(x_A, x_B, x_C)$。单一反应 $A + B \\to C$ 遵循确定性质量作用定律，其宏观双分子速率常数为 $k$。在由化学主方程 (CME) 控制的随机性描述中，倾向函数被定义为在给定当前状态的条件下，单位时间内发生一个反应事件的概率。化学朗之万方程 (CLE) 是 CME 的一种扩散近似，它使用相同的倾向函数和化学计量矩阵来定义漂移项和扩散项。\n\n从以下基本出发点开始：(i) 确定性质量作用定律将反应速率与浓度联系起来，(ii) 任何物种 $X$ 的浓度与其分子数成正比，关系为 $[X] = x_X / \\Omega$，以及 (iii) CME 倾向函数等于在一个小时间间隔内单位时间发生反应事件的期望数。请推导反应 $A + B \\to C$ 的质量作用倾向函数的符号表达式，用 $k$、$\\Omega$、$x_A$ 和 $x_B$ 表示。然后，构建相应的化学计量列向量，该向量表示单个反应事件引起的 $(x_A, x_B, x_C)$ 的净变化。\n\n请将您的最终答案以单个解析表达式的形式给出，该表达式是一个包含两个条目的行矩阵：第一个是倾向函数，第二个是化学计量列向量。无需进行数值计算，也无需四舍五入。最终答案中不要包含任何单位。",
            "solution": "本题要求推导双分子反应 $A + B \\to C$ 的质量作用倾向函数和化学计量向量。该系统由固定体积 $\\Omega$ 内各物种的分子数 $\\mathbf{x} = (x_A, x_B, x_C)^T$ 来描述。\n\n首先，我们推导倾向函数，记作 $a(\\mathbf{x})$。推导过程是通过将宏观确定性速率定律与微观随机性描述联系起来进行的。\n\n确定性质量作用定律指出，反应速率 $v$ 与反应物浓度的乘积成正比。对于反应 $A + B \\to C$，其表达式为：\n$$v = k [A] [B]$$\n其中 $k$ 是宏观双分子速率常数，$[A]$ 和 $[B]$ 分别是物种 $A$ 和 $B$ 的浓度。速率 $v$ 的单位是浓度/单位时间。\n\n为了求出在整个体积 $\\Omega$ 内单位时间发生的反应事件总数，我们将速率 $v$ 乘以体积 $\\Omega$。我们将这个宏观速率称为 $R_{macro}$：\n$$R_{macro} = v \\Omega = k [A] [B] \\Omega$$\n\n题目给出了物种 $X$ 的浓度（记作 $[X]$）与其分子数 $x_X$ 之间的关系：\n$$[X] = \\frac{x_X}{\\Omega}$$\n将 $[A]$ 和 $[B]$ 的表达式代入 $R_{macro}$ 的方程：\n$$R_{macro} = k \\left(\\frac{x_A}{\\Omega}\\right) \\left(\\frac{x_B}{\\Omega}\\right) \\Omega = \\frac{k}{\\Omega} x_A x_B$$\n这个表达式代表了从宏观、确定性的角度来看，单位时间内反应事件的期望数。\n\n在随机化学动力学形式体系中，倾向函数 $a(\\mathbf{x})$ 的定义是：在时间 $t$ 状态为 $\\mathbf{x}$ 的条件下，$a(\\mathbf{x}) dt$ 是系统在下一个无穷小时间间隔 $[t, t+dt)$ 内发生单个反应事件的概率。因此，倾向函数 $a(\\mathbf{x})$ 是在状态 $\\mathbf{x}$ 的条件下，单位时间内反应事件的期望数。\n\n确定性框架和随机性框架之间的基本联系是通过假设在宏观极限（分子数巨大）下，平均随机速率等于确定性速率来建立的。因此，我们将倾向函数 $a(\\mathbf{x})$ 与宏观速率 $R_{macro}$ 等同起来：\n$$a(x_A, x_B) = R_{macro} = \\frac{k x_A x_B}{\\Omega}$$\n这就是用给定参数表示的该反应的质量作用倾向函数的符号表达式。\n\n接下来，我们构建化学计量列向量。这个向量通常用 $\\nu$ 表示，描述了单个反应事件导致的每种物种分子数的净变化。系统的状态向量是 $\\mathbf{x} = (x_A, x_B, x_C)^T$。\n\n反应是 $A + B \\to C$。该反应每发生一次：\n1.  物种 $A$ 的一个分子被消耗，所以 $x_A$ 的变化是 $\\Delta x_A = -1$。\n2.  物种 $B$ 的一个分子被消耗，所以 $x_B$ 的变化是 $\\Delta x_B = -1$。\n3.  物种 $C$ 的一个分子被生成，所以 $x_C$ 的变化是 $\\Delta x_C = +1$。\n\n化学计量向量是这些变化的列向量：\n$$\\nu = \\begin{pmatrix} \\Delta x_A \\\\ \\Delta x_B \\\\ \\Delta x_C \\end{pmatrix} = \\begin{pmatrix} -1 \\\\ -1 \\\\ 1 \\end{pmatrix}$$\n这个向量捕获了发生一次反应事件后状态向量 $\\mathbf{x}$ 的更新：$\\mathbf{x} \\to \\mathbf{x} + \\nu$。\n\n最终答案要求将倾向函数和化学计量向量组合成一个单独的行矩阵。第一个条目是倾向函数，第二个是化学计量列向量。",
            "answer": "$$\\boxed{\\begin{pmatrix} \\frac{k x_A x_B}{\\Omega}  \\begin{pmatrix} -1 \\\\ -1 \\\\ 1 \\end{pmatrix} \\end{pmatrix}}$$"
        },
        {
            "introduction": "化学朗之万方程一经确立，通常必须通过数值方法求解，其中最简单和最常见的是欧拉-丸山（Euler-Maruyama）方法。本练习探讨了数值随机微分方程（SDE）求解器的均方稳定性概念，并揭示了时间步长 $h$ 的选择不仅关乎精度，更受到基本约束以防止模拟的方差爆炸。通过为一个简单的生灭过程推导稳定性条件，您将深入理解为何随机系统的数值模拟可能会失败以及如何避免这种情况。",
            "id": "3294887",
            "problem": "考虑一个单物种生灭反应系统，其反应为：出生反应 $\\varnothing \\to X$，速率为恒定出生率 $k_{b}  0$；死亡反应 $X \\to \\varnothing$，速率为一级死亡率 $k_{d} X$ 且 $k_{d}  0$。化学朗之万方程（CLE）通过一个伊藤随机微分方程（SDE）来近似底层的连续时间马尔可夫链，该SDE的漂移项等于净期望变化率，其扩散振幅是总倾向性的平方根。\n\n从这一基本描述出发，完成以下任务：\n\n1. 推导拷贝数 $X(t)$ 的CLE方程以及对应的均值确定性速率方程。确定其确定性不动点 $X^{\\ast}$。\n2. 引入涨落变量 $Y(t) = X(t) - X^{\\ast}$，在线性噪声近似下，获得 $Y(t)$ 的线性化SDE，其中状态依赖的扩散振幅被固定在其于 $X^{\\ast}$ 处的值。\n3. 使用均匀时间步长 $h  0$ 的显式欧拉-丸山（EM）方法离散化此线性化SDE，并推导 $Y_{n}$ 的单步更新公式。\n4. 仅使用高斯增量和条件期望的性质，推导在EM格式下二阶矩 $\\mathbb{E}[Y_{n}^{2}]$ 的仿射标量递归关系。从此递归关系中，确定对于任意有限初始方差，要满足均方稳定性（即 $\\sup_{n \\ge 0} \\mathbb{E}[Y_{n}^{2}]  \\infty$）所需的时间步长 $h$ 的充要条件。\n5. 以仅含 $k_{d}$ 的闭式解析表达式报告最大容许步长 $h_{\\max}$。您的最终答案必须只用 $k_{d}$ 的符号形式表示。\n\n您的最终答案必须是单一的解析表达式。不要提供数值计算或单位。",
            "solution": "首先验证该问题，以确保其科学上合理、内容自洽且提法适定。\n\n### 第1步：提取已知条件\n- **系统**：单物种生灭过程。\n- **物种**：$X$。\n- **反应**：\n  1. 出生：$\\varnothing \\to X$\n  2. 死亡：$X \\to \\varnothing$\n- **速率**：\n  1. 出生率（倾向性）：$a_1(X) = k_{b}$，其中 $k_{b}  0$。\n  2. 死亡率（倾向性）：$a_2(X) = k_{d} X$，其中 $k_{d}  0$。\n- **化学计量**：\n  1. 出生：$\\nu_1 = +1$。\n  2. 死亡：$\\nu_2 = -1$。\n- **化学朗之万方程（CLE）定义**：一个形式为 $dX(t) = A(X(t))dt + B(X(t))dW(t)$ 的伊藤SDE，其中漂移项 $A(X)$ 是净期望变化率，扩散项振幅的平方 $B(X)^2$ 是总倾向性。\n- **线性噪声近似（LNA）**：涨落 $Y(t) = X(t) - X^{\\ast}$ 的SDE被线性化，并且状态依赖的扩散振幅被固定在其于确定性不动点 $X^{\\ast}$ 处的值。\n- **数值方法**：采用均匀时间步长 $h  0$ 的显式欧拉-丸山（EM）方法。\n- **稳定性判据**：均方稳定性，定义为对于任意有限初始方差，$\\sup_{n \\ge 0} \\mathbb{E}[Y_{n}^{2}]  \\infty$。\n\n### 第2步：使用提取的已知条件进行验证\n- **科学依据**：该问题坚实地植根于计算系统生物学、随机过程和数值分析的既定原则。生灭过程、化学朗之万方程、线性噪声近似、欧拉-丸山方法以及均方稳定性的概念都是这些领域的标准和严谨课题。\n- **适定性**：该问题被构造为一系列逻辑推导。每个部分为下一个部分提供了必要的基础，从而导出一个唯一的、定义明确的解析结果。\n- **客观性**：该问题使用精确、无歧义的数学和科学术语进行陈述。\n\n### 第3步：结论与行动\n该问题被判定为**有效**。它在科学上是合理的，提法是适定的，并且是客观的。我现在将进行完整的推导。\n\n---\n\n**第1部分：CLE、确定性速率方程和不动点**\n\nCLE的漂移项 $A(X)$ 是各反应的化学计量乘以其各自倾向性的总和：\n$$A(X) = \\sum_{j=1}^{2} \\nu_j a_j(X) = (+1)k_{b} + (-1)k_{d} X = k_{b} - k_{d} X$$\n扩散振幅的平方 $B(X)^2$ 是倾向性之和：\n$$B(X)^2 = \\sum_{j=1}^{2} a_j(X) = k_{b} + k_{d} X$$\n因此，拷贝数 $X(t)$ 的化学朗之万方程为：\n$$dX(t) = (k_{b} - k_{d} X(t)) dt + \\sqrt{k_{b} + k_{d} X(t)} dW(t)$$\n其中 $dW(t)$ 是标准维纳过程的增量。\n\n确定性速率方程描述了在没有噪声的情况下均值的动力学，它仅考虑漂移项得到：\n$$\\frac{d\\langle X \\rangle}{dt} = k_{b} - k_{d} \\langle X \\rangle$$\n确定性不动点 $X^{\\ast}$ 是使漂移项为零的 $X$ 的值：\n$$A(X^{\\ast}) = k_{b} - k_{d} X^{\\ast} = 0$$\n解出 $X^{\\ast}$ 得：\n$$X^{\\ast} = \\frac{k_{b}}{k_{d}}$$\n\n**第2部分：涨落的线性化SDE**\n\n我们引入涨落变量 $Y(t) = X(t) - X^{\\ast}$。其微分为 $dY(t) = dX(t)$。将 $X(t) = Y(t) + X^{\\ast}$ 代入CLE：\n$$dY(t) = (k_{b} - k_{d} (Y(t) + X^{\\ast})) dt + \\sqrt{k_{b} + k_{d} (Y(t) + X^{\\ast})} dW(t)$$\n使用不动点条件 $k_b = k_d X^{\\ast}$，漂移项简化为：\n$$k_{b} - k_{d} Y(t) - k_{d} X^{\\ast} = (k_{d} X^{\\ast}) - k_{d} Y(t) - k_{d} X^{\\ast} = -k_{d} Y(t)$$\nSDE变为：\n$$dY(t) = -k_{d} Y(t) dt + \\sqrt{k_{b} + k_{d}X^{\\ast} + k_{d}Y(t)} dW(t)$$\n在线性噪声近似下，扩散项在不动点处求值，即我们在平方根内设置 $Y(t) = 0$。扩散振幅变为一个常数：\n$$\\sqrt{k_{b} + k_{d}X^{\\ast}} = \\sqrt{k_{b} + k_{d}\\left(\\frac{k_{b}}{k_{d}}\\right)} = \\sqrt{k_{b} + k_{b}} = \\sqrt{2k_{b}}$$\n得到的关于 $Y(t)$ 的线性化SDE是一个Ornstein-Uhlenbeck过程：\n$$dY(t) = -k_{d} Y(t) dt + \\sqrt{2k_{b}} dW(t)$$\n\n**第3部分：欧拉-丸山离散化**\n\n显式欧拉-丸山（EM）方法将SDE $dZ_t = a(Z_t)dt + b(Z_t)dW_t$ 离散化为 $Z_{n+1} = Z_n + a(Z_n)h + b(Z_n)\\Delta W_n$，其中 $h$ 是时间步长，$\\Delta W_n = W(t_{n+1}) - W(t_n)$ 是一个服从 $N(0, h)$ 分布的随机增量。\n将此方法应用于 $Y(t)$ 的线性化SDE，其漂移系数为 $a(Y) = -k_d Y$，常数扩散系数为 $b(Y) = \\sqrt{2k_b}$，我们得到 $Y_n \\approx Y(t_n)$ 的单步更新公式：\n$$Y_{n+1} = Y_n + (-k_d Y_n)h + \\sqrt{2k_b} \\Delta W_n$$\n$$Y_{n+1} = (1 - k_d h) Y_n + \\sqrt{2k_b} \\Delta W_n$$\n\n**第4部分：二阶矩递归与稳定性分析**\n\n为了推导二阶矩 $M_n = \\mathbb{E}[Y_n^2]$ 的递归关系，我们将EM更新规则平方：\n$$Y_{n+1}^2 = \\left( (1 - k_d h) Y_n + \\sqrt{2k_b} \\Delta W_n \\right)^2$$\n$$Y_{n+1}^2 = (1 - k_d h)^2 Y_n^2 + 2(1 - k_d h)\\sqrt{2k_b} Y_n \\Delta W_n + 2k_b (\\Delta W_n)^2$$\n现在，我们对等式两边取期望。我们使用伊藤积分的性质，特别是维纳过程的未来增量与当前状态无关（$\\mathbb{E}[Y_n \\Delta W_n] = \\mathbb{E}[Y_n]\\mathbb{E}[\\Delta W_n] = 0$），以及增量的二阶矩是其方差（$\\mathbb{E}[(\\Delta W_n)^2] = h$）。\n$$\\mathbb{E}[Y_{n+1}^2] = \\mathbb{E}\\left[ (1 - k_d h)^2 Y_n^2 \\right] + \\mathbb{E}\\left[ 2(1 - k_d h)\\sqrt{2k_b} Y_n \\Delta W_n \\right] + \\mathbb{E}\\left[ 2k_b (\\Delta W_n)^2 \\right]$$\n$$\\mathbb{E}[Y_{n+1}^2] = (1 - k_d h)^2 \\mathbb{E}[Y_n^2] + 2(1 - k_d h)\\sqrt{2k_b} \\mathbb{E}[Y_n]\\mathbb{E}[\\Delta W_n] + 2k_b \\mathbb{E}[(\\Delta W_n)^2]$$\n代入 $\\mathbb{E}[\\Delta W_n] = 0$ 和 $\\mathbb{E}[(\\Delta W_n)^2] = h$：\n$$\\mathbb{E}[Y_{n+1}^2] = (1 - k_d h)^2 \\mathbb{E}[Y_n^2] + 2k_b h$$\n令 $M_n = \\mathbb{E}[Y_n^2]$，我们得到仿射标量递归关系：\n$$M_{n+1} = (1 - k_d h)^2 M_n + 2k_b h$$\n其形式为 $M_{n+1} = A M_n + B$，其中放大因子为 $A = (1 - k_d h)^2$，偏移量为 $B = 2k_b h$。\n为使二阶矩序列 $\\{M_n\\}$ 对任意有限初始矩 $M_0$ 都有界（均方稳定性的条件 $\\sup_n M_n  \\infty$），放大因子 $A$ 必须满足 $|A|  1$。\n当 $A=1$ 时，得到 $M_{n+1} = M_n + B$，这意味着 $M_n = M_0 + nB$。由于 $B = 2k_b h  0$，$M_n$ 将线性增长至无穷大，违反了稳定性条件。\n因此，我们要求严格不等式：\n$$| (1 - k_d h)^2 |  1$$\n由于实数的平方是非负的，这等价于：\n$$(1 - k_d h)^2  1$$\n对两边取平方根得到：\n$$|1 - k_d h|  1$$\n这个不等式可以展开为：\n$$-1  1 - k_d h  1$$\n我们分别分析不等式的两部分：\n1. $1 - k_d h  1 \\implies -k_d h  0 \\implies k_d h  0$。由于已知 $k_d  0$ 和 $h  0$，此条件始终满足。\n2. $-1  1 - k_d h \\implies -2  -k_d h \\implies k_d h  2$。\n\n均方稳定性的充要条件是 $0  k_d h  2$。\n\n**第5部分：最大容许步长**\n\n稳定性条件为 $h  \\frac{2}{k_d}$。容许步长的集合是区间 $(0, 2/k_d)$。最大容许步长 $h_{\\max}$ 是该集合的最小上界（上确界）。\n$$h_{\\max} = \\frac{2}{k_d}$$\n该表达式按要求仅依赖于 $k_d$。",
            "answer": "$$\\boxed{\\frac{2}{k_{d}}}$$"
        },
        {
            "introduction": "模拟CLE的一个重要挑战在于其状态空间的连续性，这可能导致非物理状态的出现，例如分子数为负，尤其是在接近物种灭绝等边界时。这项动手编程练习将研究处理零分子数边界的两种常见策略：吸收边界和反射边界。通过为逻辑斯谛增长模型实现一个CLE模拟器，您将能够量化不同数值边界处理所引入的偏差，并体会到实现细节如何显著影响如灭绝概率等生物学相关预测。",
            "id": "3294849",
            "problem": "您的任务是构建一个 Monte Carlo 模拟器，以评估在将化学 Langevin 方程 (CLE) 近似应用于计算系统生物学中使用的一维逻辑斯谛增长系统时，边界引起的灭绝估计偏差。起点必须是用于充分混合系统的、包含倾向函数的化学 Langevin 方程的一般形式，并且所有推导都必须从此基础出发。然后，您必须在原点实现两种边界处理方法，并量化它们在有限时间范围内对灭绝估计的影响。\n\n使用的基本原理：化学 Langevin 方程指出，对于一个具有状态 $x(t)$、化学计量系数 $\\nu_j$ 和倾向函数 $a_j(x)$ 的充分混合系统，其随机动力学可以（在适当的介观条件下）近似为\n$$\ndx(t) \\;=\\; \\sum_{j} \\nu_j\\,a_j\\big(x(t)\\big)\\,dt \\;+\\; \\sum_{j} \\nu_j\\,\\sqrt{a_j\\big(x(t)\\big)}\\,dW_j(t),\n$$\n其中 $W_j(t)$ 是独立的标准 Wiener 过程。在此处使用的一维单通道有效描述中，您将考虑一个有效倾向 $a(x)$ 和被吸收到一维动力学中的化学计量，这会导出一个形式为\n$$\ndx(t) \\;=\\; f(x)\\,dt \\;+\\; g(x)\\,dW(t),\n$$\n的 Itô 随机微分方程，其漂移项 $f(x)$ 和扩散振幅 $g(x)$ 由 CLE 近似所隐含。\n\n待近似的系统：考虑随机逻辑斯谛增长，其有效漂移项 $f(x)$ 和扩散振幅 $g(x)$ 源自一个单一的有效 CLE 通道，其总速率等于逻辑斯谛净速率的非负部分。具体而言，取\n$$\nf(x) \\;=\\; r\\,x\\left(1 - \\frac{x}{K}\\right),\n\\quad\ng(x) \\;=\\; \\sqrt{\\max\\!\\Big( r\\,x\\left(1 - \\frac{x}{K}\\right),\\,0 \\Big)},\n$$\n其中参数 $r  0$ 和 $K  0$，因此当有效 CLE 速率保持非负时，$g(x)$ 为实值。\n\n任务：\n1. 从上述 Itô 随机微分方程出发，推导一个具有固定时间步长 $\\Delta t$ 的一阶弱 Euler–Maruyama 离散化方法，用于模拟样本路径 $\\{x_n\\}_{n=0}^{N_T}$，直至有限时间范围 $T = N_T\\,\\Delta t$。您的推导必须基于 CLE 形式和 Itô 解释，不得在此基础之外调用任何快捷公式。\n2. 在原点 $x=0$ 实现两种边界处理方法：\n   - 在 $x=0$ 处的吸收边界：如果一个步长提议满足 $x_{n+1} \\le 0$，则设置 $x_{n+1} \\leftarrow 0$，并在此后保持轨迹为 $0$。\n   - 在 $x=0$ 处的反射边界：如果一个步长提议满足 $x_{n+1}  0$，则通过 $x_{n+1} \\leftarrow |x_{n+1}|$ 对其进行反射并继续。\n3. 使用独立同分布的正态变量 $\\eta_n \\sim \\mathcal{N}(0,1)$ 作为每一步 Euler–Maruyama 创新的来源，执行 Monte Carlo 估计：\n   - 吸收边界灭绝概率 $p_{\\mathrm{abs}}$，定义为在吸收边界条件下，到时间 $T$ 时已达到 $x \\le 0$ 的轨迹所占的比例。\n   - 反射边界实现灭绝概率 $p_{\\mathrm{ref}}$，定义为在反射边界条件下，到时间 $T$ 时位于数值灭绝阈值 $x_{\\mathrm{thr}}$ 或以下的轨迹所占的比例，其中 $x_{\\mathrm{thr}} = 10^{-8}$。\n   - 因使用反射边界而非吸收边界处理而引入的灭绝偏差 $\\mathrm{bias} = p_{\\mathrm{ref}} - p_{\\mathrm{abs}}$。\n\n实现要求：\n- 使用 Euler–Maruyama 方案的向量化实现，该方案具有固定的步长 $\\Delta t$ 和由 $\\sqrt{\\Delta t}$ 缩放的独立标准正态增量。\n- 在每个时间步和轨迹索引上，对吸收和反射模拟使用相同的高斯增量，以确保对边界处理进行公平比较。\n- 为避免因随机过冲导致 $x  K$ 时出现复数值扩散，请使用有效 CLE 速率的非负部分来实现 $g(x)$，即 $g(x) = \\sqrt{\\max\\big(r\\,x(1-x/K),\\,0\\big)}$。\n- 使用阈值 $x_{\\mathrm{thr}} = 10^{-8}$（无量纲）定义反射边界处的数值灭绝。\n- 所有量均为无量纲；以小数形式报告概率，不带百分号。\n\n测试套件：\n对于每个参数元组 $(r,K,x_0,T,\\Delta t,N,\\text{seed})$，使用给定的随机种子以保证可复现性，从 $x(0)=x_0$ 开始，以步长 $\\Delta t$ 模拟 $N$ 条独立轨迹，直到时间 $T$。计算并报告每种情况下四舍五入到四位小数的 $p_{\\mathrm{abs}}$、$p_{\\mathrm{ref}}$ 和 $\\mathrm{bias}$。\n\n使用以下测试用例：\n- 情况 A（正常路径）：$(r,K,x_0,T,\\Delta t,N,\\text{seed}) = (1.0,\\,50.0,\\,1.0,\\,8.0,\\,0.005,\\,4000,\\,1729)$。\n- 情况 B（近边界初始条件）：$(r,K,x_0,T,\\Delta t,N,\\text{seed}) = (1.2,\\,12.0,\\,0.3,\\,6.0,\\,0.0025,\\,4000,\\,2027)$。\n- 情况 C（较慢增长，更长时间范围）：$(r,K,x_0,T,\\Delta t,N,\\text{seed}) = (0.6,\\,30.0,\\,1.0,\\,12.0,\\,0.01,\\,4000,\\,2718)$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个类 JSON 格式的列表，按 A、B、C 的顺序列出三种情况的结果，其中每种情况贡献一个包含三个四舍五入小数的列表 $[p_{\\mathrm{abs}},p_{\\mathrm{ref}},\\mathrm{bias}]$。例如，一个有效的输出形状是\n\"[[pA_abs,pA_ref,pA_bias],[pB_abs,pB_ref,pB_bias],[pC_abs,pC_ref,pC_bias]]\"\n每个值都四舍五入到四位小数。不应打印任何额外文本。",
            "solution": "我们从化学 Langevin 方程 (CLE) 开始，该方程近似了一个充分混合的介观化学系统的动力学。对于状态 $x(t)$、化学计量系数 $\\nu_j$ 和倾向函数 $a_j(x)$，CLE 的形式为\n$$\ndx(t) \\;=\\; \\sum_{j} \\nu_j\\,a_j\\big(x(t)\\big)\\,dt \\;+\\; \\sum_{j} \\nu_j\\,\\sqrt{a_j\\big(x(t)\\big)}\\,dW_j(t),\n$$\n其中 $W_j(t)$ 是独立的 Wiener 过程。在一维有效描述（单通道代理）中，我们将化学计量吸收到一维状态中，并定义一个有效总速率 $a(x)$，得到\n$$\ndx(t) \\;=\\; f(x)\\,dt \\;+\\; g(x)\\,dW(t),\n$$\n其中 $f(x)$ 是漂移项，$g(x)$ 是扩散振幅。对于逻辑斯谛增长，计算系统生物学中一种常见的有效 CLE 近似选择逻辑斯谛净速率作为有效通道，其中\n$$\nf(x) \\;=\\; r\\,x\\left(1 - \\frac{x}{K}\\right), \\quad g(x) \\;=\\; \\sqrt{\\max\\!\\left(r\\,x\\left(1 - \\frac{x}{K}\\right),\\,0\\right)}.\n$$\n使用非负部分是为了确保在存在 $x  K$ 的随机过冲时，$g(x)$ 保持为实数。\n\n为了模拟样本路径，我们使用 Itô 解释和 Euler–Maruyama 方法。设 $\\Delta t  0$ 为固定时间步长，$N_T = \\lfloor T/\\Delta t \\rfloor$ 为步数，并定义离散时间 $t_n = n\\,\\Delta t$、状态 $x_n \\approx x(t_n)$ 以及独立标准正态变量 $\\eta_n \\sim \\mathcal{N}(0,1)$。Euler–Maruyama 更新规则为\n$$\nx_{n+1} \\;=\\; x_n \\;+\\; f(x_n)\\,\\Delta t \\;+\\; g(x_n)\\,\\sqrt{\\Delta t}\\,\\eta_n.\n$$\n这是通过在 $[t_n,t_{n+1}]$ 上对 CLE 进行积分，并使用一阶求积公式 $f(x_n)\\,\\Delta t$ 近似漂移项积分，以及使用 Wiener 增量 $\\Delta W_n = \\sqrt{\\Delta t}\\,\\eta_n$ 近似随机积分得到的。\n\n在原点 $x=0$ 的边界处理实现如下：\n- 吸收边界：如果一个提议的更新 $x_{n+1}$ 满足 $x_{n+1} \\le 0$，则设置 $x_{n+1} \\leftarrow 0$ 并在所有后续步骤中保持该值。在此方案下，当路径首次到达原点时发生灭绝。\n- 反射边界：如果一个提议的更新 $x_{n+1}$ 满足 $x_{n+1}  0$，则设置 $x_{n+1} \\leftarrow |x_{n+1}|$。这在构造上防止了灭绝，过程在正域中继续演化。\n\nMonte Carlo 估计量：\n- 设 $N$ 为模拟的独立轨迹数量。在吸收边界条件下，为轨迹 $i$ 定义指示函数 $I_i$，表示它在时间 $T$ 之前是否已达到 $x \\le 0$。吸收边界灭绝概率的估计量为\n$$\n\\widehat{p}_{\\mathrm{abs}} \\;=\\; \\frac{1}{N}\\sum_{i=1}^{N} I_i.\n$$\n- 在反射边界下，灭绝不会发生；我们定义一个数值灭绝阈值 $x_{\\mathrm{thr}} = 10^{-8}$ 并计算实现的灭绝估计量\n$$\n\\widehat{p}_{\\mathrm{ref}} \\;=\\; \\frac{1}{N}\\sum_{i=1}^{N} \\mathbf{1}\\{x_i(T) \\le x_{\\mathrm{thr}}\\}.\n$$\n- 使用反射边界条件而非吸收边界条件所产生的灭绝偏差为\n$$\n\\widehat{\\mathrm{bias}} \\;=\\; \\widehat{p}_{\\mathrm{ref}} \\;-\\; \\widehat{p}_{\\mathrm{abs}}.\n$$\n\n算法设计：\n- 对所有 $N$ 条轨迹的 Euler–Maruyama 更新进行向量化。在每一步 $n$，抽取一个独立标准正态向量 $\\eta^{(n)} \\in \\mathbb{R}^{N}$，并将其重复用于吸收和反射模拟，以确保对边界处理进行公平的配对比较。\n- 使用 $f(x) = r\\,x\\,(1-x/K)$ 和 $g(x) = \\sqrt{\\max(r\\,x\\,(1-x/K),0)}$ 逐点计算 $f(x)$ 和 $g(x)$。当 $x  K$ 时，$\\max(\\cdot,0)$ 裁剪避免了复数扩散振幅的出现。\n- 吸收更新：提议 $x^{\\mathrm{abs}}_{n+1} = x^{\\mathrm{abs}}_n + f(x^{\\mathrm{abs}}_n)\\Delta t + g(x^{\\mathrm{abs}}_n)\\sqrt{\\Delta t}\\,\\eta^{(n)}$，然后将 $x^{\\mathrm{abs}}_{n+1} \\le 0$ 的条目设为 $0$，并在之后保持为 $0$。\n- 反射更新：提议 $x^{\\mathrm{ref}}_{n+1} = x^{\\mathrm{ref}}_n + f(x^{\\mathrm{ref}}_n)\\Delta t + g(x^{\\mathrm{ref}}_n)\\sqrt{\\Delta t}\\,\\eta^{(n)}$，然后设置 $x^{\\mathrm{ref}}_{n+1} \\leftarrow |x^{\\mathrm{ref}}_{n+1}|$。\n- $N_T$ 步后，将至少被设为 $0$ 一次的吸收边界轨迹的比例作为 $\\widehat{p}_{\\mathrm{abs}}$ 的估计，并将终端值 $\\le x_{\\mathrm{thr}}$ 的反射边界轨迹的比例作为 $\\widehat{p}_{\\mathrm{ref}}$ 的估计。\n\n数值考量：\n- 步长 $\\Delta t$ 必须足够小，以便解析 $x=0$ 附近的乘性噪声，在该处漂移项和扩散项都随 $x$ 线性消失。测试套件使用的 $\\Delta t$ 是为了平衡准确性和计算成本而选择的。\n- 对两种边界方案使用相同的 Wiener 增量，可以在比较 $p_{\\mathrm{abs}}$ 和 $p_{\\mathrm{ref}}$ 时减少估计量的方差。\n- 逻辑斯谛 CLE 可能会随机超过 $K$；裁剪 $g(x)$ 内部的参数可以保持更新值为实数，同时保留将 $x$ 推回承载能力尺度的确定性漂移。\n\n输出与解释：\n- 对于反射边界，实现的灭绝概率 $\\widehat{p}_{\\mathrm{ref}}$ 通常接近 $0$，因为该方案阻止了对 $x=0$ 的穿越。因此，$\\widehat{\\mathrm{bias}}$ 通常为负，且接近 $-\\widehat{p}_{\\mathrm{abs}}$，这量化了在 $x=0$ 处使用反射边界而非吸收边界时对灭绝概率的低估程度。\n- 程序必须计算三种指定情况的结果，并以 \"[[pA_abs,pA_ref,pA_bias],[pB_abs,pB_ref,pB_bias],[pC_abs,pC_ref,pC_bias]]\" 的形式打印单行输出，其中数值四舍五入到四位小数。\n\n此设计直接遵循 CLE 框架、Itô 解释和 Euler–Maruyama 方案，并在离散时间提议层面上实施边界处理，以近似预期的连续时间边界行为。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef simulate_cle_logistic(r, K, x0, T, dt, N, seed, x_thr=1e-8):\n    \"\"\"\n    Simulate the CLE-approximated stochastic logistic growth using Euler–Maruyama\n    under two boundary treatments at x=0: absorbing and reflecting.\n\n    Parameters:\n        r (float): intrinsic growth rate.\n        K (float): carrying capacity scale.\n        x0 (float): initial condition.\n        T (float): final time.\n        dt (float): time step.\n        N (int): number of Monte Carlo trajectories.\n        seed (int): random seed for reproducibility.\n        x_thr (float): numerical extinction threshold for reflecting scheme.\n\n    Returns:\n        (p_abs, p_ref, bias): tuple of floats.\n            p_abs: absorbing-boundary extinction probability by time T.\n            p_ref: reflecting-boundary realized extinction probability at time T.\n            bias: p_ref - p_abs.\n    \"\"\"\n    rng = np.random.default_rng(seed)\n    n_steps = int(np.floor(T / dt))\n    sqrt_dt = np.sqrt(dt)\n\n    # Initialize states for both boundary treatments\n    x_abs = np.full(N, float(x0), dtype=np.float64)\n    x_ref = np.full(N, float(x0), dtype=np.float64)\n\n    # Track extinction under absorbing boundary\n    alive = np.ones(N, dtype=bool)  # True until absorbed\n\n    # Time stepping with shared Gaussian innovations\n    for _ in range(n_steps):\n        # Draw shared innovations\n        eta = rng.standard_normal(N, dtype=np.float64)\n\n        # Absorbing scheme update\n        # Compute drift and diffusion amplitude only for alive trajectories\n        f_abs = r * x_abs * (1.0 - x_abs / K)\n        diff_rate_abs = r * x_abs * (1.0 - x_abs / K)\n        # Clip diffusion rate to avoid negative under sqrt\n        diff_rate_abs = np.maximum(diff_rate_abs, 0.0)\n        g_abs = np.sqrt(diff_rate_abs)\n\n        # Propose update only for alive trajectories; dead ones remain at 0\n        x_prop_abs = x_abs + f_abs * dt + g_abs * sqrt_dt * eta\n\n        # Apply absorbing boundary: clamp to 0 if proposal = 0\n        became_extinct = alive  (x_prop_abs = 0.0)\n        # Update states: extinct ones set to 0, others take proposal\n        x_abs = np.where(became_extinct, 0.0, x_prop_abs)\n        # Update alive mask\n        alive = alive  (~became_extinct)\n\n        # Reflecting scheme update\n        f_ref = r * x_ref * (1.0 - x_ref / K)\n        diff_rate_ref = r * x_ref * (1.0 - x_ref / K)\n        diff_rate_ref = np.maximum(diff_rate_ref, 0.0)\n        g_ref = np.sqrt(diff_rate_ref)\n\n        x_prop_ref = x_ref + f_ref * dt + g_ref * sqrt_dt * eta\n        # Reflect at 0\n        x_ref = np.abs(x_prop_ref)\n\n    # Compute probabilities\n    p_abs = 1.0 - np.mean(alive)  # fraction that have hit zero by time T\n    p_ref = np.mean(x_ref = x_thr)  # realized extinction under reflecting\n    bias = p_ref - p_abs\n\n    return p_abs, p_ref, bias\n\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each tuple: (r, K, x0, T, dt, N, seed)\n    test_cases = [\n        (1.0, 50.0, 1.0, 8.0, 0.005, 4000, 1729),   # Case A\n        (1.2, 12.0, 0.3, 6.0, 0.0025, 4000, 2027),  # Case B\n        (0.6, 30.0, 1.0, 12.0, 0.01, 4000, 2718),   # Case C\n    ]\n\n    results = []\n    for params in test_cases:\n        r, K, x0, T, dt, N, seed = params\n        p_abs, p_ref, bias = simulate_cle_logistic(r, K, x0, T, dt, N, seed)\n        # Round to four decimals as specified\n        results.append([round(p_abs, 4), round(p_ref, 4), round(bias, 4)])\n\n    # Final print statement in the exact required format.\n    # Produce a single line: list of lists with rounded decimals.\n    print(str(results))\n\nsolve()\n```"
        }
    ]
}