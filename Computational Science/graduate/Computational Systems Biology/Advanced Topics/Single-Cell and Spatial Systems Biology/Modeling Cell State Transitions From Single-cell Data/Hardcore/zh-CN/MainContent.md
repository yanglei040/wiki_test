## 引言
理解细胞如何从一种状态转变为另一种状态，是破解发育、再生和疾病等基本生物学过程的关键。近年来，[单细胞测序](@entry_id:198847)技术使我们能够以前所未有的分辨率捕捉到异质细胞群体的静态快照。然而，这些静态数据本身并不能揭示细胞状态转换背后的动态机制、路径和调控逻辑。如何从这些离散的快照中重建连续的、具有预测能力的动态过程，构成了[计算系统生物学](@entry_id:747636)中的一个核心挑战和知识缺口。

本文旨在系统性地阐述应对这一挑战的现代计算与数学框架。通过本文的学习，您将掌握从原始单细胞数据中提取动态信息的核心原理与方法。我们将首先在“原理与机制”一章中，深入探讨如何从数学上定义细胞状态、构建几何图谱，并介绍马尔可夫链、[最优输运](@entry_id:196008)和[随机微分方程](@entry_id:146618)等核心模型来模拟细胞间的转换。接着，在“应用与跨学科连接”一章中，我们将展示这些理论如何在真实的生物学问题（如[轨迹推断](@entry_id:176370)、命运预测和[临界点](@entry_id:144653)检测）中发挥作用，并将其视野拓展至生物学之外的交叉领域。最后，“动手实践”部分将提供具体的计算问题，引导您将理论知识应用于解决实际的建模挑战。这趟旅程将从数据的第一性原理出发，最终带领您抵达系统控制和多学科整合的前沿。

## 原理与机制

本章深入探讨了从单细胞数据中建模细胞状态转换的核心原理和机制。我们将从如何定义和表示细胞状态的几何视图开始，进而讨论如何在代表细胞[状态空间](@entry_id:177074)的图上模拟转换路径和[随机流](@entry_id:197438)，最后介绍用于捕捉全局和连续动态的几种高级框架。

### 定义细胞状态及其关系：几何视图

对细胞状态转换进行建模的第一步，是在高维基因表达空间中为每个细胞建立一个精确的数学表示，并定义它们之间的关系。这个过程将原始的测序读数转化为一个几何结构，即细胞状态[流形](@entry_id:153038)。

#### 从计数到状态：[数据转换](@entry_id:170268)与噪声处理

[单细胞RNA测序](@entry_id:142269)（[scRNA-seq](@entry_id:155798)）实验的原始输出是每个细胞中每个基因的[唯一分子标识符](@entry_id:192673)（Unique Molecular Identifier, UMI）计数。一个直接的挑战是如何区分真正的生物学变异（不同细胞间真实的表达水平差异）和技术噪声（由分子捕获和测序过程的随机性引入的变异）。

UMI计数通常可以用**泊松分布**很好地建模。如果一个细胞中基因 $g$ 的真实平均表达水平为 $\mu_g$，并受细胞特异性[测序深度](@entry_id:178191)或“大小因子” $s$ 的影响，那么其观测到的UMI计数 $Y_g$ 可以被建模为 $Y_g \sim \mathrm{Poisson}(s \mu_g)$。[泊松分布](@entry_id:147769)的一个关键特性是其均值和[方差](@entry_id:200758)相等，即 $\mathrm{Var}(Y_g) = \mathbb{E}[Y_g] = s \mu_g$。这意味着高表达基因的计数变异性远大于低表达基因。如果我们简单地通过除以大小因子来进行归一化，得到 $x_g = Y_g/s$，虽然[期望值](@entry_id:153208)是正确的（$\mathbb{E}[x_g] = \mu_g$），但[方差](@entry_id:200758)仍然依赖于均值：$\mathrm{Var}(x_g) = \mu_g/s$。

这种均值-[方差](@entry_id:200758)耦合关系会对下游分析（如计算细胞间的欧氏距离）产生不利影响，因为它会使得高表达基因对距离的计算贡献过大的技术噪声。为了解决这个问题，我们采用**[方差稳定变换](@entry_id:273381)（variance-stabilizing transforms, VSTs）**。VST的目标是找到一个函数 $f$，使得变换后的变量 $f(Y_g)$ 的[方差近似](@entry_id:268585)为一个与均值无关的常数。

对于[泊松分布](@entry_id:147769)，一个经典的选择是**平方根变换**。具体来说，我们可以定义一个变换后的变量 $Z_g = 2\sqrt{Y_g}$。利用[Delta方法](@entry_id:276272)可以证明，这个变换后变量的[方差近似](@entry_id:268585)为1，即 $\mathrm{Var}(Z_g) \approx 1$，这与基因的表达水平均无关。在实践中，我们通常对归一化后的表达值应用一个等价的变换，如 $f(x_g) = 2\sqrt{sx_g}$。

这种变换的深远意义在于它如何分离生物学信号和技术噪声。考虑两个细胞A和B，它们的真实表达谱为 $\mu^{(A)}$ 和 $\mu^{(B)}$。在经过平方根变换后，它们状态向量之间的期望平方欧氏距离可以分解为两个部分：
$$
\mathbb{E}\left[\|f(x^{(A)}) - f(x^{(B)})\|_2^2\right] \approx \sum_{g=1}^p \left(2\sqrt{s\mu^{(A)}_{g}} - 2\sqrt{s\mu^{(B)}_{g}}\right)^2 + 2p
$$
这个表达式  清晰地揭示了变换后的距离是如何构成的：第一项是两个细胞真实表达水平在变换空间中的差异，代表了**生物学差异**；第二项 $2p$ 是一个常数，它代表了来自两个细胞所有 $p$ 个基因的恒定技术噪声贡献之和。通过稳定[方差](@entry_id:200758)，我们使得每个基因对技术噪声的贡献变得均等，从而在计算细胞间距离时能够更公平地衡量它们真实的生物学差异。

#### 衡量细胞状态间的距离

在获得经过预处理的细胞[状态向量](@entry_id:154607)后，下一步是量化它们之间的相似性或差异性。选择合适的[距离度量](@entry_id:636073)至关重要，因为它隐含了关于哪些特征是生物学相关的假设。

*   **欧氏距离** ($d_E(x,y) = \|x-y\|_2$)：这是最直观的[距离度量](@entry_id:636073)，它对基因表达的绝对差异很敏感。如果细胞间总mRNA含量的差异或整体转录活性的变化本身就是重要的生物学信号，那么欧氏距离是合适的选择。

*   **余[弦距离](@entry_id:170189)** ($d_C(x,y) = 1 - \frac{x^\top y}{\|x\|_2 \|y\|_2}$)：余[弦距离](@entry_id:170189)衡量的是两个向量方向上的差异，而对它们的模长不敏感。这意味着它对细胞[测序深度](@entry_id:178191)的差异具有[不变性](@entry_id:140168)。如果我们将细胞的表达谱进行 $\ell_2$ 归一化，即 $\hat{x} = x/\|x\|_2$，那么归一化后向量间的欧氏距离与原始向量的余[弦距离](@entry_id:170189)有直接关系：$\|\hat{x} - \hat{y}\|_2^2 = 2\,d_C(x,y)$。因此，在归一化数据上使用欧氏距离等价于使用余[弦距离](@entry_id:170189) 。

*   **[皮尔逊相关](@entry_id:260880)距离** ($d_R(x,y) = 1 - \rho(x,y)$)：[皮尔逊相关](@entry_id:260880)性是中心化后的向量之间的余弦相似度。它不仅对向量的模长不敏感（尺度不变性），还对向量的整体平移不敏感（[平移不变性](@entry_id:195885)）。这意味着 $d_R$ 对于诸如 $x \mapsto ax+b\mathbf{1}$（其中 $a>0$）这样的每个细胞独立的[仿射变换](@entry_id:144885)是不变的 。当基因表达谱的相对模式比绝对水平更重要时，这是一个非常有用的性质。

#### 构建细胞[状态图](@entry_id:176069)

为了捕捉细胞群体潜在的连续[流形](@entry_id:153038)结构，我们将单个细胞视为节点，并根据它们之间的距离构建一个图。这个图为后续的[轨迹推断](@entry_id:176370)和动态建模提供了基础。

常见的图构建方法包括：

*   **$\varepsilon$-图**：在距离小于或等于某个全局阈值 $\varepsilon$ 的所有细胞对之间添加一条边。这种方法的主要缺点是它对细胞密度的不均匀性非常敏感。在细胞密集的区域，节点度会非常高，导致“过度连接”；而在稀疏区域（如连接两个主要细胞群的“桥”），节点度可能非常低，甚至导致图的断开 。

*   **$k$-最近邻（$k$-NN）图**：为每个[细胞连接](@entry_id:146782)其最近的 $k$ 个邻居。这种方法通过保证每个节点至少有 $k$ 个出边，适应了密度的变化，从而在稀疏区域也能保持连通性。然而，这也带来了新的问题：稀疏区域的细胞为了找到 $k$ 个邻居，其搜索半径会变得非常大，这可能导致它连接到在[流形](@entry_id:153038)上距离很远但在[欧氏空间](@entry_id:138052)中看似很近的稠密区域的细胞。这种非对称的连接会产生“捷径”或**伪迹边（spurious edges）** 。

*   **相互$k$-最近邻（Mutual $k$-NN）图**：只有当细胞 $i$ 在细胞 $j$ 的 $k$-近邻中，并且细胞 $j$ 也在细胞 $i$ 的 $k$-近邻中时，才在它们之间添加一条边。这种强制的**互惠性**有效地修剪了从稀疏区域到稠密区域的非对称长距离连接，从而产生一个更能忠实反映局部[流形](@entry_id:153038)结构的图 。

在构建图之后，我们通常会使用一个[核函数](@entry_id:145324)将距离转换为亲和力（或边的权重）。一个常用的核是**高斯核** $k(x,y) = \exp(-\|x-y\|_2^2/\sigma^2)$。这里，带宽 $\sigma$ 的选择至关重要。使用**固定的全局带宽** $\sigma$ 会再次引入对密度的敏感性。而在**自适应核**中，带宽本身是局部的，例如，$\sigma_i$ 可以被设为细胞 $x_i$ 到其第 $k$ 个近邻的距离。使用如 $k_{\text{ad}}(x_i,x_j) = \exp(-\|x_i-x_j\|_2^2/(\sigma_i\sigma_j))$ 这样的自适应核，可以在数学上证明，其构建的[图拉普拉斯算子](@entry_id:275190)在极限情况下能够收敛到[流形](@entry_id:153038)内在的**[拉普拉斯-贝尔特拉米算子](@entry_id:267002)**，同时消除了采样密度不[均匀性](@entry_id:152612)造成的影响。这对于基于[扩散](@entry_id:141445)的[轨迹推断](@entry_id:176370)方法尤其重要，因为它确保了推断出的动态反映的是内在几何，而非采样伪影 。

### 模拟图上的路径和流

一旦细胞[状态图](@entry_id:176069)被构建，我们就可以利用它来模拟细胞状态的转换。这些模型大致可以分为两类：确定性的路径模型和随机的过程模型。

#### [测地线](@entry_id:269969)路径和[伪时间](@entry_id:262363)

最简单的转换模型将细胞间的演化视为图上的一条路径。**[测地线](@entry_id:269969)路径（Geodesic paths）**定义为在[加权图](@entry_id:274716)上连接两个细胞的、总边长（距离）最短的路径。这种方法提供了一个从一个细胞状态到另一个细胞状态的“最可能”的转换序列。

一个更全局的观点是由**主树/[主曲线](@entry_id:161549)（principal trees/curves）**提供的。这些方法假设所有细胞都位于一个嵌入在高维空间中的一维树状结构附近。通过将细胞投影到这个学习到的树上，我们可以为每个细胞分配一个从某个“根”或起始点开始沿树的距离。这个距离被称为**[伪时间](@entry_id:262363)（pseudotime）**，它为细胞的发育过程提供了一个确定性的、连续的排序 。

#### 随机转换：马尔可夫模型

虽然路径模型很直观，但它们通常忽略了[细胞决策](@entry_id:165282)过程中的随机性。一个更灵活的框架是将状态转换建模为一个[随机过程](@entry_id:159502)，特别是**[马尔可夫链](@entry_id:150828)**。

##### [离散时间马尔可夫链](@entry_id:263188)（DTMCs）

我们可以将图的节点（细胞或细胞簇）视为一个[马尔可夫链](@entry_id:150828)的状态。基于节点间的亲和力，我们可以构建一个行随机的**转移矩阵** $P$，其中 $P_{ij}$ 表示从状态 $i$ 在一个时间步内转移到状态 $j$ 的概率。

[马尔可夫过程](@entry_id:160396)的一个基本性质由**查普曼-科尔莫戈罗夫方程**描述，它表明在 $t$ 个时间步内从状态 $i$ 转移到状态 $j$ 的概率，恰好由矩阵 $P$ 的 $t$ 次幂 $P^t$ 的 $(i,j)$ 元素给出，即 $(P^t)_{ij}$ 。

对于满足某些良好性质（不可约和非周期性）的**遍历**马尔可夫链，当时间趋于无穷时，系统会“忘记”其初始状态。转移矩阵 $P^t$ 会收敛到一个所有行都相同的矩阵，每一行都是唯一的**平稳分布** $\pi$。这意味着，无论细胞从哪个状态开始，在很长时间后，它处于状态 $j$ 的概率都将是 $\pi_j$ 。这个平稳分布描述了系统在[长期演化](@entry_id:158486)后达到的平衡状态。

##### 可逆性与[非平衡动力学](@entry_id:160262)

平稳分布的一个深刻特性与**[可逆性](@entry_id:143146)（reversibility）**有关。如果一个马尔可夫链在平稳状态下满足**[细致平衡条件](@entry_id:265158)**（detailed balance condition），即 $\pi_i P_{ij} = \pi_j P_{ji}$ 对于所有状态对 $(i,j)$ 都成立，那么这个过程就是可逆的。这个条件意味着从 $i$ 到 $j$ 的[概率流](@entry_id:150949)与从 $j$ 到 $i$ 的概率流完全相等。这样的系统类似于物理学中的热力学平衡态，没有宏观的净流动。

然而，许多生物过程，如分化和[细胞周期](@entry_id:140664)，都是由能量驱动的、有方向性的过程。这些过程更适合用**非可逆的**（non-reversible）[马尔可夫链](@entry_id:150828)来描述。在非[可逆系统](@entry_id:269797)中，[细致平衡](@entry_id:145988)被打破，导致存在非零的净概率流 $J_{ij} = \pi_i P_{ij} - \pi_j P_{ji} \neq 0$。在平稳状态下，这些净流必须形成**循环**，这正是有方向性的、[远离平衡态](@entry_id:185355)的动态过程的标志。

我们可以通过统计检验来判断从数据中推断出的马尔可夫模型是否可逆。一种有效的方法是，对于每一对状态 $(i,j)$，检验从 $i \to j$ 的观测转移数 $N_{ij}$ 与从 $j \to i$ 的观测转移数 $N_{ji}$ 是否显著不同。这可以构建为一个聚合的[卡方检验](@entry_id:174175)。如果检验结果显著，拒绝了[可逆性](@entry_id:143146)的原假设，我们就获得了细胞过程是由非平衡流驱动的有力证据 。

##### [连续时间马尔可夫链](@entry_id:276307)（CTMCs）与RNA速度

将离散时间步的概念推广，我们可以使用**[连续时间马尔可夫链](@entry_id:276307)（CTMCs）**。CTMC的动态由一个**生成元矩阵** $\mathcal{L}$ 描述，它定义了状态间的瞬时转移速率。[概率分布](@entry_id:146404) $p(t)$ 的演化由[主方程](@entry_id:142959) $\frac{d p(t)}{dt} = p(t) \mathcal{L}$ 给出。

一个强大的最新进展是将CTMC模型与**RNA速度**联系起来。RNA速度通过分析新生（未[剪接](@entry_id:181943)）和成熟（已[剪接](@entry_id:181943)）mRNA的比例，为每个细胞估计了一个指向其未来状态方向和速率的高维向量。这个速度向量 $v_i$ 可以被看作是细胞在状态空间中的瞬时漂移。我们可以利用这个信息来约束生成元矩阵 $\mathcal{L}$。具体而言，我们要求模型产生的期望瞬时位移与观测到的RNA速度相匹配，即：
$$
\sum_{j} (x_j - x_i)\,\mathcal{L}_{ij} = v_i
$$
这个**漂移约束**为我们从静态的单细胞快照中推断动态的、有[方向性](@entry_id:266095)的模型提供了一个强有力的、有物理意义的框架 。

### 高级动态建模框架

除了基于图的马尔可夫模型，还有一系列更高级的数学框架，它们从不同的角度对细胞状态转换进行建模。

#### [最优输运](@entry_id:196008)：全局种群视角

当实验提供了在两个或多个离散时间点（例如，$t_0$ 和 $t_1$）的细胞群体快照时，一个自然的问题是：如何推断 $t_0$ 的细胞最有可能演变成了 $t_1$ 的哪些细胞？**[最优输运](@entry_id:196008)（Optimal Transport, OT）**为这个问题提供了一个全局的、连续的解决方案。

OT将两个时间的细胞群体[分布](@entry_id:182848)（$r$ 和 $c$）视为概率质量的[分布](@entry_id:182848)，并寻找一个**[耦合矩阵](@entry_id:191757)**（或输运方案）$\pi$，以最小的总代价将质量从 $r$ 输运到 $c$。这里的“代价”$C_{ij}$ 通常是基于生物学考虑定义的，例如细胞 $i$ 和细胞 $j$ 在基因表达空间中的平方欧氏距离。

标准的OT问题是一个计算成本高昂的[线性规划](@entry_id:138188)问题。一个关键的创新是引入**[熵正则化](@entry_id:749012)**，它在最小化输运代价的同时，也最大化输运方案 $\pi$ 的熵。这个正则化的OT问题不仅计算上更高效，而且其解也更平滑，能更好地反映[生物过程](@entry_id:164026)的随机性。[熵正则化](@entry_id:749012)OT问题的解可以通过一个称为**Sinkhorn-Knopp算法**的快速迭代过程找到。该算法揭示了[最优耦合](@entry_id:264340)矩阵具有一个优雅的结构 $\pi = \text{diag}(u) K \text{diag}(v)$，其中 $K = \exp(-C/\varepsilon)$ 是吉布斯核，$\varepsilon$ 是正则化强度，$u$ 和 $v$ 是缩放向量 。最终得到的[耦合矩阵](@entry_id:191757) $\pi$ 为连接两个时间点的细胞群体提供了一个概率性的祖先-后代关系图。

#### [随机微分方程](@entry_id:146618)与稀有事件

另一种强大的建模方法是将细胞状态的演化描述为一个**[随机微分方程](@entry_id:146618)（Stochastic Differential Equation, SDE）**：
$$
\mathrm{d}X_{t} = b(X_{t})\,\mathrm{d}t + \sqrt{2\varepsilon}\, \mathrm{d}W_{t}
$$
这里，$X_t$ 是细胞状态向量，$b(X_t)$ 是漂移项（可从RNA速度推断），$\mathrm{d}W_t$ 是代表随机噪声的[维纳过程](@entry_id:137696)，$\varepsilon$ 是噪声强度。

在低噪声（small-noise）极限下，根据**[Freidlin-Wentzell理论](@entry_id:274374)**，系统的大部[分时](@entry_id:274419)间将停留在由漂移场 $b(x)$ 定义的稳定状态（吸引子）附近。从一个稳定状态到另一个稳定状态的转换是稀有事件，它们总是沿着特定的路径发生，这些路径被称为**最小作用量路径（Minimal Action Paths, MAPs）**。

我们可以定义一个**[准势](@entry_id:196547)（quasipotential）** $W(x)$，它表示从一个吸引子 $x_A$ 出发，到达状态 $x$ 所需的最小作用量。这个准[势函数](@entry_id:176105)满足一个称为**汉密尔顿-[雅可比方程](@entry_id:158713)**的[偏微分方程](@entry_id:141332) $H(x, \nabla W) = 0$。

在一个特别重要的情况下，即漂移场是保守的（即 $b(x) = -\nabla U(x)$，其中 $U(x)$ 是一个[标量势](@entry_id:276177)函数），可以证明[准势](@entry_id:196547)就是[势能](@entry_id:748988)的差值：$W(x) = U(x) - U(x_A)$。更有趣的是，此时的最小作用量路径恰好是原始确[定性动力学](@entry_id:263136)（$\dot{x} = -\nabla U(x)$）的**时间反演**（$\dot{x} = +\nabla U(x)$）。这个理论将[细胞分化](@entry_id:273644)等转换过程与物理学中的“爬山”过程联系起来，为理解细胞状态景观中的转换路径提供了深刻的见解。

#### [库普曼算子理论](@entry_id:266030)：非线性动力学的线性化

[细胞动力学](@entry_id:747181)本质上是高度[非线性](@entry_id:637147)的。直接处理非线性系统非常困难。**[库普曼算子](@entry_id:183136)（Koopman operator）**理论提供了一个革命性的视角：它将研究重点从状态本身的[非线性](@entry_id:637147)演化，转移到状态的**[可观测量](@entry_id:267133)（observables）**（即状态的函数）的线性演化上。虽然[库普曼算子](@entry_id:183136)本身是无限维的，但它的线性特性使其在理论上极具吸[引力](@entry_id:175476)。

**扩展动态[模态分解](@entry_id:637725)（Extended Dynamic Mode Decomposition, EDMD）**是一种数据驱动的方法，用于寻找[库普曼算子](@entry_id:183136)的有限维近似 $K$。其核心思想是，首先选择一个由“[基函数](@entry_id:170178)”组成的**字典** $\phi(x)$，将原始状态数据 $x$ 提升到一个更高维的特征空间 $\phi(x)$。然后，通过求解一个线性最小二乘问题，找到一个矩阵 $K$，使得 $\phi(y) \approx K \phi(x)$，其中 $y$ 是 $x$ 经过一小段时间演化后的状态。

这个近似算子 $K$ 的谱（[特征值](@entry_id:154894)和[特征向量](@entry_id:151813)）包含了原始[非线性动力学](@entry_id:190195)的重要信息：
*   靠近1的[特征值](@entry_id:154894)对应于系统中的**稳定状态或吸引子**。
*   位于[单位圆](@entry_id:267290)上的[复共轭](@entry_id:174690)[特征值](@entry_id:154894)对则对应于**周期性行为**，如[细胞周期](@entry_id:140664)。

EDMD的成败极度依赖于字典 $\phi(x)$ 的选择。一个简单的线性字典（即 $\phi(x)=x$）通常不足以捕捉[非线性动力学](@entry_id:190195)。为了区分多个[吸引子](@entry_id:275077)，字典需要能够近似表示那些在不同吸引盆之间急剧变化的函数；为了捕捉[非线性](@entry_id:637147)周期，字典需要能够近似表示沿着循环轨迹变化的复杂函数 。选择合适的字典是应用此强大框架于细胞生物学数据的核心挑战和艺术。