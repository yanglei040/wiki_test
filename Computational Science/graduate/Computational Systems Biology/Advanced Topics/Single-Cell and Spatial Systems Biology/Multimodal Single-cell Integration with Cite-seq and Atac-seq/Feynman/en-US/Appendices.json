{
    "hands_on_practices": [
        {
            "introduction": "Before attempting to integrate complex multimodal datasets, it is imperative to ensure the quality of each individual modality. This foundational exercise focuses on quality control (QC) for single-cell ATAC-seq data by implementing two standard metrics from first principles: Transcription Start Site (TSS) enrichment and Fraction of Reads in Peaks (FRiP) . By working with a simplified toy dataset, you will develop a concrete understanding of how these metrics quantify the biological signal-to-noise ratio, a critical step for any downstream analysis.",
            "id": "3330229",
            "problem": "You are tasked with formalizing and computing two standard single-cell Assay for Transposase-Accessible Chromatin using sequencing (ATAC-seq) quality control metrics, then deciding quality control pass or fail for multiple threshold regimes. These metrics are Transcription Start Site (TSS) enrichment and Fraction of Reads in Peaks (FRiP), used prior to multimodal integration with Cellular Indexing of Transcriptomes and Epitopes by sequencing (CITE-seq) and ATAC-seq. The problem is deliberately defined on a toy genome with discrete integer coordinates to emphasize first principles.\n\nAll intervals below are closed intervals on the integer line. A closed interval $[a,b]$ is the set $\\{x \\in \\mathbb{Z} \\mid a \\le x \\le b\\}$. Two closed intervals $[a,b]$ and $[c,d]$ overlap if and only if $\\max(a,c) \\le \\min(b,d)$.\n\nDefinitions to implement:\n\n- Base coverage. Given a cell with a multiset of fragments $\\mathcal{F} = \\{[s_i,e_i]\\}$ and a position $p \\in \\mathbb{Z}$, define the per-base coverage function\n$$\n\\operatorname{cov}(p;\\mathcal{F}) = \\sum_{[s_i,e_i]\\in \\mathcal{F}} \\mathbf{1}\\{s_i \\le p \\le e_i\\},\n$$\nwhere $\\mathbf{1}\\{\\cdot\\}$ is the indicator of the condition.\n\n- Aggregated TSS profile and TSS enrichment. Let the set of TSS positions be $G = \\{g_1,\\dots,g_{|G|}\\}$ on a single chromosome. Fix a symmetric window radius $W \\in \\mathbb{N}$. For each offset $o \\in \\{-W, -W+1, \\dots, -1, 0, 1, \\dots, W\\}$, define the aggregated offset coverage\n$$\nC(o) = \\sum_{g \\in G} \\operatorname{cov}(g+o;\\mathcal{F}).\n$$\nDefine the central set $S_{\\text{center}} = \\{-1,0,1\\}$ and the background set $S_{\\text{bg}} = \\{-W,\\dots,-2,2,\\dots,W\\}$. Define the mean coverages\n$$\n\\overline{C}(S) = \\frac{1}{|S|} \\sum_{o\\in S} C(o).\n$$\nDefine TSS enrichment\n$$\nE = \\begin{cases}\n\\frac{\\overline{C}(S_{\\text{center}})}{\\overline{C}(S_{\\text{bg}})} & \\text{if } \\overline{C}(S_{\\text{bg}}) > 0, \\\\\n+\\infty & \\text{if } \\overline{C}(S_{\\text{bg}}) = 0 \\text{ and } \\overline{C}(S_{\\text{center}}) > 0, \\\\\n0 & \\text{if } \\overline{C}(S_{\\text{bg}}) = 0 \\text{ and } \\overline{C}(S_{\\text{center}}) = 0.\n\\end{cases}\n$$\n\n- Fraction of Reads in Peaks (FRiP). Let the set of peak intervals be $\\mathcal{P} = \\{[u_j,v_j]\\}$. Let $N_{\\text{frag}} = |\\mathcal{F}|$ be the number of fragments in the cell. Let $N_{\\text{in\\_peaks}}$ be the number of fragments in $\\mathcal{F}$ that overlap at least one peak in $\\mathcal{P}$. Define\n$$\nF = \\begin{cases}\n\\frac{N_{\\text{in\\_peaks}}}{N_{\\text{frag}}} & \\text{if } N_{\\text{frag}} > 0, \\\\\n0 & \\text{if } N_{\\text{frag}} = 0.\n\\end{cases}\n$$\nExpress $F$ as a decimal.\n\n- Quality control pass rule. For thresholds $\\tau_F \\in \\mathbb{R}_{\\ge 0}$, $\\tau_E \\in \\mathbb{R}_{\\ge 0}$, and $\\tau_n \\in \\mathbb{N}_0$, a cell passes if and only if all three conditions hold:\n$$\nN_{\\text{frag}} \\ge \\tau_n,\\quad F \\ge \\tau_F,\\quad E \\ge \\tau_E.\n$$\n\nUse the following fixed toy dataset for all test cases:\n\n- TSS set $G = \\{1000, 2000\\}$.\n\n- Window radius $W = 5$.\n\n- Peak set $\\mathcal{P} = \\{[990,1010], [1990,2005], [3000,3010]\\}$.\n\n- Three cells with fragment sets:\n\n    - Cell $1$: $\\mathcal{F}_1 = \\{[995,1005], [999,1002], [1998,2002], [2999,3001], [4000,4003]\\}$.\n\n    - Cell $2$: $\\mathcal{F}_2 = \\{[985,988], [1008,1012], [1993,1994], [2006,2008], [3005,3005]\\}$.\n\n    - Cell $3$: $\\mathcal{F}_3 = \\{\\}$ (no fragments).\n\nTest suite of threshold triples $(\\tau_F,\\tau_E,\\tau_n)$:\n\n- Test $1$: $(0.5, 2.0, 1)$.\n\n- Test $2$: $(0.8, \\frac{24}{11}, 5)$.\n\n- Test $3$: $(0.0, 0.0, 0)$.\n\n- Test $4$: $(0.9, 3.0, 6)$.\n\nYour program must, for each test case in the order above, compute the number of cells that pass quality control under the given thresholds. Your program should produce a single line of output containing these four integers as a comma-separated list enclosed in square brackets, for example, $[x_1,x_2,x_3,x_4]$ where each $x_i$ is the count of passing cells for test $i$.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of single-cell genomics quality control, is mathematically well-posed, and provides a complete, self-contained set of definitions and data. The use of a toy integer genome is a standard pedagogical simplification to focus on the first-principles implementation of the QC metrics.\n\nThe task is to compute three quality control (QC) metrics for three different single-cell ATAC-seq profiles and then determine, for four different sets of thresholds, how many cells pass QC. The metrics are the number of unique fragments ($N_{\\text{frag}}$), the Fraction of Reads in Peaks ($F$, or FRiP), and the Transcription Start Site (TSS) enrichment score ($E$).\n\nThe overall procedure will be to first calculate the triplet of QC metrics $(N_{\\text{frag}}, F, E)$ for each of the three cells. Subsequently, for each of the four test cases, we will compare the metrics of each cell against the given thresholds $(\\tau_n, \\tau_F, \\tau_E)$ to determine the number of cells that pass.\n\nThe fixed parameters for all calculations are:\n- TSS set $G = \\{1000, 2000\\}$.\n- Window radius $W = 5$.\n- Peak set $\\mathcal{P} = \\{[990,1010], [1990,2005], [3000,3010]\\}$.\n\n**Step 1: Computation of QC Metrics for Each Cell**\n\nWe will compute $(N_{\\text{frag}}, F, E)$ for Cell $1$, Cell $2$, and Cell $3$.\n\n**Cell 1: $\\mathcal{F}_1 = \\{[995,1005], [999,1002], [1998,2002], [2999,3001], [4000,4003]\\}$**\n\n1.  **Number of Fragments ($N_{\\text{frag},1}$):**\n    The number of fragments is the size of the multiset $\\mathcal{F}_1$.\n    $$N_{\\text{frag},1} = |\\mathcal{F}_1| = 5$$\n\n2.  **Fraction of Reads in Peaks ($F_1$):**\n    We count the number of fragments in $\\mathcal{F}_1$ that overlap with at least one peak in $\\mathcal{P}$.\n    - $[995,1005]$ overlaps with $[990,1010]$.\n    - $[999,1002]$ overlaps with $[990,1010]$.\n    - $[1998,2002]$ overlaps with $[1990,2005]$.\n    - $[2999,3001]$ overlaps with $[3000,3010]$.\n    - $[4000,4003]$ does not overlap with any peak in $\\mathcal{P}$.\n    The number of fragments in peaks is $N_{\\text{in\\_peaks},1} = 4$.\n    $$F_1 = \\frac{N_{\\text{in\\_peaks},1}}{N_{\\text{frag},1}} = \\frac{4}{5} = 0.8$$\n\n3.  **TSS Enrichment ($E_1$):**\n    We need to compute the aggregated offset coverage $C(o) = \\sum_{g \\in G} \\operatorname{cov}(g+o;\\mathcal{F}_1)$ for offsets $o \\in \\{-5, \\dots, 5\\}$.\n    The TSSs are at positions $g_1 = 1000$ and $g_2 = 2000$.\n    For a given offset $o$, $C(o) = \\operatorname{cov}(1000+o;\\mathcal{F}_1) + \\operatorname{cov}(2000+o;\\mathcal{F}_1)$.\n\n    The coverages at positions near the TSSs are:\n    - For $o = -5$: $C(-5) = \\operatorname{cov}(995) + \\operatorname{cov}(1995) = 1 + 0 = 1$.\n    - For $o = -4$: $C(-4) = \\operatorname{cov}(996) + \\operatorname{cov}(1996) = 1 + 0 = 1$.\n    - For $o = -3$: $C(-3) = \\operatorname{cov}(997) + \\operatorname{cov}(1997) = 1 + 0 = 1$.\n    - For $o = -2$: $C(-2) = \\operatorname{cov}(998) + \\operatorname{cov}(1998) = 1 + 1 = 2$.\n    - For $o = -1$: $C(-1) = \\operatorname{cov}(999) + \\operatorname{cov}(1999) = 2 + 1 = 3$.\n    - For $o = 0$: $C(0) = \\operatorname{cov}(1000) + \\operatorname{cov}(2000) = 2 + 1 = 3$.\n    - For $o = 1$: $C(1) = \\operatorname{cov}(1001) + \\operatorname{cov(2001)} = 2 + 1 = 3$.\n    - For $o = 2$: $C(2) = \\operatorname{cov}(1002) + \\operatorname{cov(2002)} = 2 + 1 = 3$.\n    - For $o = 3$: $C(3) = \\operatorname{cov}(1003) + \\operatorname{cov(2003)} = 1 + 0 = 1$.\n    - For $o = 4$: $C(4) = \\operatorname{cov}(1004) + \\operatorname{cov(2004)} = 1 + 0 = 1$.\n    - For $o = 5$: $C(5) = \\operatorname{cov}(1005) + \\operatorname{cov(2005)} = 1 + 0 = 1$.\n\n    The mean coverage over the central set $S_{\\text{center}}=\\{-1,0,1\\}$ is:\n    $$\\overline{C}(S_{\\text{center}}) = \\frac{C(-1) + C(0) + C(1)}{3} = \\frac{3+3+3}{3} = 3$$\n    The mean coverage over the background set $S_{\\text{bg}}=\\{-5,-4,-3,-2,2,3,4,5\\}$ is:\n    $$\\overline{C}(S_{\\text{bg}}) = \\frac{C(-5)+C(-4)+C(-3)+C(-2)+C(2)+C(3)+C(4)+C(5)}{8} = \\frac{1+1+1+2+3+1+1+1}{8} = \\frac{11}{8}$$\n    Since $\\overline{C}(S_{\\text{bg}}) > 0$, the enrichment is:\n    $$E_1 = \\frac{\\overline{C}(S_{\\text{center}})}{\\overline{C}(S_{\\text{bg}})} = \\frac{3}{11/8} = \\frac{24}{11}$$\n    The metrics for Cell $1$ are $(N_{\\text{frag},1}, F_1, E_1) = (5, 0.8, \\frac{24}{11})$.\n\n**Cell 2: $\\mathcal{F}_2 = \\{[985,988], [1008,1012], [1993,1994], [2006,2008], [3005,3005]\\}$**\n\n1.  **Number of Fragments ($N_{\\text{frag},2}$):**\n    $$N_{\\text{frag},2} = |\\mathcal{F}_2| = 5$$\n\n2.  **Fraction of Reads in Peaks ($F_2$):**\n    - $[985,988]$: No overlap.\n    - $[1008,1012]$ overlaps with $[990,1010]$.\n    - $[1993,1994]$ overlaps with $[1990,2005]$.\n    - $[2006,2008]$: No overlap.\n    - $[3005,3005]$ overlaps with $[3000,3010]$.\n    The number of fragments in peaks is $N_{\\text{in\\_peaks},2} = 3$.\n    $$F_2 = \\frac{N_{\\text{in\\_peaks},2}}{N_{\\text{frag},2}} = \\frac{3}{5} = 0.6$$\n\n3.  **TSS Enrichment ($E_2$):**\n    For Cell $2$, none of the fragments in $\\mathcal{F}_2$ cover any position $p$ in the ranges $[995, 1005]$ or $[1995, 2005]$. These are the positions $g+o$ for $g \\in G$ and $o \\in \\{-5, \\dots, 5\\}$. Therefore, $\\operatorname{cov}(g+o;\\mathcal{F}_2) = 0$ for all relevant $g$ and $o$.\n    This results in $C(o) = 0$ for all $o \\in \\{-5, \\dots, 5\\}$.\n    Consequently, $\\overline{C}(S_{\\text{center}}) = 0$ and $\\overline{C}(S_{\\text{bg}}) = 0$.\n    According to the definition for this case:\n    $$E_2 = 0$$\n    The metrics for Cell $2$ are $(N_{\\text{frag},2}, F_2, E_2) = (5, 0.6, 0)$.\n\n**Cell 3: $\\mathcal{F}_3 = \\{\\}$**\n\n1.  **Number of Fragments ($N_{\\text{frag},3}$):**\n    $$N_{\\text{frag},3} = |\\mathcal{F}_3| = 0$$\n\n2.  **Fraction of Reads in Peaks ($F_3$):**\n    By definition, if $N_{\\text{frag}}=0$, then $F=0$.\n    $$F_3 = 0$$\n\n3.  **TSS Enrichment ($E_3$):**\n    With no fragments, the coverage is $0$ everywhere. Thus, as with Cell $2$, $\\overline{C}(S_{\\text{center}}) = 0$ and $\\overline{C}(S_{\\text{bg}}) = 0$.\n    $$E_3 = 0$$\n    The metrics for Cell $3$ are $(N_{\\text{frag},3}, F_3, E_3) = (0, 0, 0)$.\n\n**Step 2: Evaluation of Test Cases**\n\nWe use the QC rule: a cell passes if $N_{\\text{frag}} \\ge \\tau_n$, $F \\ge \\tau_F$, and $E \\ge \\tau_E$.\n\n**Summary of Cell Metrics:**\n- Cell $1$: $(5, 0.8, \\frac{24}{11} \\approx 2.18)$\n- Cell $2$: $(5, 0.6, 0)$\n- Cell $3$: $(0, 0, 0)$\n\n**Test 1: $(\\tau_F, \\tau_E, \\tau_n) = (0.5, 2.0, 1)$**\n- Cell $1$: $5 \\ge 1$ (Pass), $0.8 \\ge 0.5$ (Pass), $24/11 \\ge 2.0$ (Pass). $\\implies$ **Pass**\n- Cell $2$: $5 \\ge 1$ (Pass), $0.6 \\ge 0.5$ (Pass), $0 \\ge 2.0$ (Fail). $\\implies$ **Fail**\n- Cell $3$: $0 \\ge 1$ (Fail). $\\implies$ **Fail**\nNumber of passing cells = $1$.\n\n**Test 2: $(\\tau_F, \\tau_E, \\tau_n) = (0.8, \\frac{24}{11}, 5)$**\n- Cell $1$: $5 \\ge 5$ (Pass), $0.8 \\ge 0.8$ (Pass), $24/11 \\ge 24/11$ (Pass). $\\implies$ **Pass**\n- Cell $2$: $5 \\ge 5$ (Pass), $0.6 \\ge 0.8$ (Fail). $\\implies$ **Fail**\n- Cell $3$: $0 \\ge 5$ (Fail). $\\implies$ **Fail**\nNumber of passing cells = $1$.\n\n**Test 3: $(\\tau_F, \\tau_E, \\tau_n) = (0.0, 0.0, 0)$**\n- Cell $1$: $5 \\ge 0$ (Pass), $0.8 \\ge 0.0$ (Pass), $24/11 \\ge 0.0$ (Pass). $\\implies$ **Pass**\n- Cell $2$: $5 \\ge 0$ (Pass), $0.6 \\ge 0.0$ (Pass), $0 \\ge 0.0$ (Pass). $\\implies$ **Pass**\n- Cell $3$: $0 \\ge 0$ (Pass), $0.0 \\ge 0.0$ (Pass), $0.0 \\ge 0.0$ (Pass). $\\implies$ **Pass**\nNumber of passing cells = $3$.\n\n**Test 4: $(\\tau_F, \\tau_E, \\tau_n) = (0.9, 3.0, 6)$**\n- Cell $1$: $5 \\ge 6$ (Fail). $\\implies$ **Fail**\n- Cell $2$: $5 \\ge 6$ (Fail). $\\implies$ **Fail**\n- Cell $3$: $0 \\ge 6$ (Fail). $\\implies$ **Fail**\nNumber of passing cells = $0$.\n\nThe final results are the counts of passing cells for each of the four tests.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes ATAC-seq QC metrics for a toy dataset and determines the number of passing cells\n    for several QC thresholds.\n    \"\"\"\n\n    # --- Fixed Dataset ---\n    G = [1000, 2000]  # TSS set\n    W = 5             # Window radius\n    P = [[990, 1010], [1990, 2005], [3000, 3010]]  # Peak set\n\n    cells_fragments = [\n        # Cell 1\n        [[995, 1005], [999, 1002], [1998, 2002], [2999, 3001], [4000, 4003]],\n        # Cell 2\n        [[985, 988], [1008, 1012], [1993, 1994], [2006, 2008], [3005, 3005]],\n        # Cell 3\n        []\n    ]\n\n    test_cases = [\n        (0.5, 2.0, 1),\n        (0.8, 24/11, 5),\n        (0.0, 0.0, 0),\n        (0.9, 3.0, 6),\n    ]\n    \n    def compute_metrics(fragments, tss_set, peak_set, window_radius):\n        \"\"\"\n        Computes N_frag, FRiP (F), and TSS Enrichment (E) for a single cell.\n        \"\"\"\n        N_frag = len(fragments)\n\n        # Handle the case of an empty cell\n        if N_frag == 0:\n            return (0, 0.0, 0.0)\n\n        # --- Compute Fraction of Reads in Peaks (FRiP) ---\n        N_in_peaks = 0\n        for s_frag, e_frag in fragments:\n            in_any_peak = False\n            for s_peak, e_peak in peak_set:\n                if max(s_frag, s_peak) <= min(e_frag, e_peak):\n                    in_any_peak = True\n                    break\n            if in_any_peak:\n                N_in_peaks += 1\n        F = N_in_peaks / N_frag\n\n        # --- Compute TSS Enrichment (E) ---\n        C = {o: 0 for o in range(-window_radius, window_radius + 1)}\n        \n        # Calculate aggregated offset coverage C(o)\n        for g in tss_set:\n            for s_frag, e_frag in fragments:\n                # The offsets o relative to g covered by the fragment are in [s_frag - g, e_frag - g]\n                o_start = s_frag - g\n                o_end = e_frag - g\n                \n                # Iterate through offsets in the intersection of the covered range and the window [-W, W]\n                # to increment the aggregated coverage counts.\n                start_offset = max(-window_radius, o_start)\n                end_offset = min(window_radius, o_end)\n                for o in range(start_offset, end_offset + 1):\n                    C[o] += 1\n        \n        # Calculate mean coverages for center and background\n        s_center_offsets = [-1, 0, 1]\n        s_bg_offsets = list(range(-window_radius, -1)) + list(range(2, window_radius + 1))\n        \n        C_center_values = [C[o] for o in s_center_offsets]\n        C_bg_values = [C[o] for o in s_bg_offsets]\n        \n        mean_C_center = np.mean(C_center_values) if C_center_values else 0.0\n        mean_C_bg = np.mean(C_bg_values) if C_bg_values else 0.0\n        \n        # Apply definition of TSS enrichment E\n        if mean_C_bg > 0:\n            E = mean_C_center / mean_C_bg\n        elif mean_C_center > 0:\n            E = np.inf\n        else:  # mean_C_bg == 0 and mean_C_center == 0\n            E = 0.0\n            \n        return (N_frag, F, E)\n\n    # Calculate metrics for all cells once\n    cell_metrics = []\n    for frags in cells_fragments:\n        metrics = compute_metrics(frags, G, P, W)\n        cell_metrics.append(metrics)\n\n    # Evaluate each test case\n    final_results = []\n    for tau_F, tau_E, tau_n in test_cases:\n        passed_count = 0\n        for n_frag, f, e in cell_metrics:\n            if n_frag >= tau_n and f >= tau_F and e >= tau_E:\n                passed_count += 1\n        final_results.append(passed_count)\n\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A core challenge in integrating RNA and ATAC-seq data is their different feature spaces: gene expression versus chromatin accessibility peaks. To bridge this gap, we often compute 'gene activity scores' from the ATAC-seq data, creating a common gene-centric view . This hands-on problem guides you through implementing a common approach where accessibility peaks are aggregated in a distance-weighted manner around a gene's promoter, reflecting the principle that proximal regulatory elements have a stronger influence. You will then assess the validity of this constructed score by correlating it with measured mRNA expression.",
            "id": "3330201",
            "problem": "Consider the task of integrating Assay for Transposase-Accessible Chromatin using sequencing (ATAC-seq) chromatin accessibility with Cellular Indexing of Transcriptomes and Epitopes by Sequencing (CITE-seq) messenger ribonucleic acid (mRNA) expression to assess concordance at the single-cell level. You are given a small peak-by-cell accessibility matrix, peak genomic coordinates, two gene Transcription Start Site (TSS) positions, and a genomic window size in base pairs. Assume the following foundations: chromatin accessibility proximal to a gene’s TSS contributes to its transcriptional activity, and regulatory influence decays with genomic distance from the TSS according to an exponential kernel. You must compute gene activity scores per cell by aggregating accessibility signals from peaks within a symmetric window around the TSS, weight them by the exponential kernel, and then compute the Pearson correlation coefficient between these activity scores and mRNA expression across cells for each gene to assess concordance.\n\nData and parameters:\n1. Peaks are on a single chromosome and represented by closed intervals in base pairs (bp). Peak intervals are:\n$$\nP_1 = [1000,1100],\\quad\nP_2 = [1500,1600],\\quad\nP_3 = [2000,2100],\\quad\nP_4 = [2600,2700],\\quad\nP_5 = [3000,3100].\n$$\nDefine the peak center $c_p$ as the midpoint of its interval.\n\n2. The peak-by-cell accessibility matrix $X \\in \\mathbb{R}^{5 \\times 4}$ (rows are peaks $P_1, \\dots, P_5$; columns are cells $C_1,\\dots,C_4$) is:\n$$\nX = \\begin{bmatrix}\n2 & 0 & 1 & 0 \\\\\n3 & 1 & 0 & 0 \\\\\n0 & 2 & 2 & 0 \\\\\n0 & 1 & 0 & 3 \\\\\n1 & 0 & 3 & 2\n\\end{bmatrix}.\n$$\n\n3. Two genes, with TSS positions (in bp) on the same chromosome, are:\n$$\ng_A: t_A = 1550,\\quad g_B: t_B = 3050.\n$$\n\n4. Messenger ribonucleic acid (mRNA) expression across the same $4$ cells for these genes is provided as:\n$$\ny_A = [5,2,3,0], \\quad y_B = [0,1,0,2].\n$$\n\n5. The exponential decay kernel parameter (length scale) is specified as:\n$$\n\\tau = 500\\ \\text{bp}.\n$$\n\nGene activity computation:\n- For a gene $g$ with TSS $t_g$, and a symmetric window size $w$ (in base pairs), select peaks whose centers satisfy $|c_p - t_g| \\le w$. If no peaks are selected, the activity score vector for $g$ is the zero vector.\n- Define the weight for a selected peak $p$ at distance $d_p = |c_p - t_g|$ as:\n$$\nK(d_p) = \\exp\\left(-\\frac{d_p}{\\tau}\\right).\n$$\n- The gene activity score for gene $g$ in cell $i$ is:\n$$\nA_{g,i}(w) = \\sum_{p:\\ |c_p - t_g| \\le w} X_{p,i}\\, K(|c_p - t_g|).\n$$\n\nConcordance computation:\n- Let $A_g(w) \\in \\mathbb{R}^4$ be the activity scores across the $4$ cells, and $y_g \\in \\mathbb{R}^4$ be the mRNA expression across the same $4$ cells. The Pearson correlation coefficient is defined as:\n$$\nr_g(w) = \n\\begin{cases}\n0, & \\text{if}\\ \\sum_{i=1}^{4} \\left(A_{g,i}(w) - \\bar{A}_g(w)\\right)^2 = 0\\ \\text{or}\\ \\sum_{i=1}^{4} \\left(y_{g,i} - \\bar{y}_g\\right)^2 = 0, \\\\\n\\displaystyle \\frac{\\sum_{i=1}^{4} \\left(A_{g,i}(w) - \\bar{A}_g(w)\\right)\\left(y_{g,i} - \\bar{y}_g\\right)}{\\sqrt{\\sum_{i=1}^{4} \\left(A_{g,i}(w) - \\bar{A}_g(w)\\right)^2}\\ \\sqrt{\\sum_{i=1}^{4} \\left(y_{g,i} - \\bar{y}_g\\right)^2}}, & \\text{otherwise},\n\\end{cases}\n$$\nwhere $\\bar{A}_g(w)$ and $\\bar{y}_g$ denote the means of $A_g(w)$ and $y_g$, respectively.\n\nTest suite:\n- Use the following window sizes (in base pairs): \n$$\nw_1 = 600,\\quad w_2 = 0,\\quad w_3 = 400.\n$$\nFor each $w_j$, compute $r_{g_A}(w_j)$ and $r_{g_B}(w_j)$.\n\nFinal output format:\n- Your program should produce a single line of output containing the $6$ correlation results for the test suite, ordered as:\n$$\n\\left[r_{g_A}(w_1), r_{g_B}(w_1), r_{g_A}(w_2), r_{g_B}(w_2), r_{g_A}(w_3), r_{g_B}(w_3)\\right],\n$$\nprinted as a comma-separated list enclosed in square brackets, with the values as floating-point numbers without units (dimensionless).",
            "solution": "We begin from the principle that in eukaryotic gene regulation, open chromatin regions (accessible DNA measured by Assay for Transposase-Accessible Chromatin using sequencing (ATAC-seq)) near a gene’s Transcription Start Site (TSS) facilitate transcription initiation, and their regulatory influence declines with genomic distance from the TSS. To model this distance-dependent influence, we adopt a widely used exponential kernel reflecting a decaying contribution of distal regulatory elements. For single-cell concordance assessment, we compare chromatin-derived gene activity scores with messenger ribonucleic acid (mRNA) expression measured by Cellular Indexing of Transcriptomes and Epitopes by Sequencing (CITE-seq).\n\nDefinitions and derivations:\n1. Peak representation and centers: Each chromatin accessibility peak $p$ is an interval $[s_p, e_p]$ in base pairs (bp) on a chromosome. Its center is:\n$$\nc_p = \\frac{s_p + e_p}{2}.\n$$\nThis center provides a consistent scalar representation for distance computations relative to a gene’s TSS.\n\n2. Window-based selection: For a gene $g$ with TSS at position $t_g$, and a symmetric window size $w$ (in bp), we include peaks whose centers satisfy:\n$$\n|c_p - t_g| \\le w.\n$$\nThis condition enforces a physically meaningful locality constraint around the TSS. The inclusion is defined to be inclusive of the boundary to ensure well-defined behavior at $|c_p - t_g| = w$.\n\n3. Exponential decay kernel: Regulatory influence decays with distance $d_p = |c_p - t_g|$ according to:\n$$\nK(d_p) = \\exp\\left(-\\frac{d_p}{\\tau}\\right),\n$$\nwhere $\\tau > 0$ is a length-scale parameter (in bp). This kernel is consistent with biophysical intuition that the probability of interaction and functional effect of accessible regions decreases approximately exponentially with genomic distance.\n\n4. Gene activity aggregation: Given the peak-by-cell matrix $X \\in \\mathbb{R}^{m \\times n}$ (here $m = 5$, $n = 4$), the gene activity score for gene $g$ in cell $i$ for window size $w$ is:\n$$\nA_{g,i}(w) = \\sum_{p:\\ |c_p - t_g| \\le w} X_{p,i}\\, \\exp\\left(-\\frac{|c_p - t_g|}{\\tau}\\right).\n$$\nIf the selection set is empty, we define $A_g(w)$ to be the zero vector in $\\mathbb{R}^n$, reflecting no accessible regulatory evidence within the window.\n\n5. Concordance via Pearson correlation: To quantify the linear concordance between chromatin-derived activity $A_g(w)$ and mRNA expression $y_g$, the Pearson correlation coefficient is:\n$$\nr_g(w) = \n\\begin{cases}\n0, & \\text{if}\\ \\sum_{i=1}^{n} \\left(A_{g,i}(w) - \\bar{A}_g(w)\\right)^2 = 0\\ \\text{or}\\ \\sum_{i=1}^{n} \\left(y_{g,i} - \\bar{y}_g\\right)^2 = 0, \\\\\n\\displaystyle \\frac{\\sum_{i=1}^{n} \\left(A_{g,i}(w) - \\bar{A}_g(w)\\right)\\left(y_{g,i} - \\bar{y}_g\\right)}{\\sqrt{\\sum_{i=1}^{n} \\left(A_{g,i}(w) - \\bar{A}_g(w)\\right)^2}\\ \\sqrt{\\sum_{i=1}^{n} \\left(y_{g,i} - \\bar{y}_g\\right)^2}}, & \\text{otherwise},\n\\end{cases}\n$$\nwith $n = 4$ in this setup, and where $\\bar{A}_g(w)$ and $\\bar{y}_g$ denote the means across cells. The zero-case safeguard handles degenerate scenarios where either vector is constant.\n\nAlgorithmic steps aligned with the above principles:\n- Compute peak centers $c_p$ from the given intervals $[s_p,e_p]$ using $c_p = (s_p + e_p)/2$.\n- For each gene $g \\in \\{g_A,g_B\\}$ and each window size $w \\in \\{w_1, w_2, w_3\\}$, form the selection mask for peaks whose centers satisfy $|c_p - t_g| \\le w$.\n- For selected peaks, compute weights $K(d_p) = \\exp(-d_p/\\tau)$, with $d_p = |c_p - t_g|$ and $\\tau = 500$.\n- Aggregate the activity per cell using the weighted sum across selected peaks:\n$$\nA_{g,i}(w) = \\sum_{p} \\left(\\mathbf{1}\\{|c_p - t_g| \\le w\\}\\, X_{p,i}\\, K(|c_p - t_g|)\\right).\n$$\n- Compute $r_g(w)$ according to the Pearson correlation formula above, including the zero-case handling when standard deviations vanish.\n- Produce the final results as a single list in the order:\n$$\n\\left[r_{g_A}(w_1), r_{g_B}(w_1), r_{g_A}(w_2), r_{g_B}(w_2), r_{g_A}(w_3), r_{g_B}(w_3)\\right].\n$$\n\nThis procedure operationalizes the integration of ATAC-seq accessibility with CITE-seq mRNA expression by deriving an interpretable gene activity score that reflects local chromatin context modulated by distance, and then quantifies concordance via a standard correlation measure. The test suite covers a general case ($w_1$), a boundary case capturing exact TSS-matching peaks ($w_2$), and an edge case testing inclusive window boundaries ($w_3$).",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_peak_centers(starts, ends):\n    return (np.array(starts, dtype=float) + np.array(ends, dtype=float)) / 2.0\n\ndef exponential_kernel(distances, tau):\n    return np.exp(-np.abs(distances) / float(tau))\n\ndef compute_activity(X, centers, tss, window, tau):\n    distances = np.abs(centers - float(tss))\n    mask = distances <= float(window)\n    if not np.any(mask):\n        # No peaks in window: return zero activity vector\n        return np.zeros(X.shape[1], dtype=float)\n    weights = exponential_kernel(distances[mask], tau)  # shape (k,)\n    X_sel = X[mask, :]  # shape (k, n_cells)\n    # Weighted sum across peaks -> activity per cell\n    activity = (weights[:, None] * X_sel).sum(axis=0)\n    return activity\n\ndef pearson_correlation(x, y):\n    x = np.asarray(x, dtype=float)\n    y = np.asarray(y, dtype=float)\n    # Center\n    x_dev = x - x.mean()\n    y_dev = y - y.mean()\n    ssx = np.dot(x_dev, x_dev)\n    ssy = np.dot(y_dev, y_dev)\n    if ssx == 0.0 or ssy == 0.0:\n        return 0.0\n    num = np.dot(x_dev, y_dev)\n    den = np.sqrt(ssx * ssy)\n    return float(num / den)\n\ndef solve():\n    # Define data from the problem statement.\n    # Peak intervals (bp)\n    starts = [1000, 1500, 2000, 2600, 3000]\n    ends   = [1100, 1600, 2100, 2700, 3100]\n    centers = compute_peak_centers(starts, ends)  # shape (5,)\n\n    # Peak-by-cell ATAC accessibility matrix X (5 peaks x 4 cells)\n    X = np.array([\n        [2, 0, 1, 0],\n        [3, 1, 0, 0],\n        [0, 2, 2, 0],\n        [0, 1, 0, 3],\n        [1, 0, 3, 2]\n    ], dtype=float)\n\n    # Gene TSS positions (bp)\n    tss_A = 1550\n    tss_B = 3050\n\n    # CITE-seq mRNA expression across 4 cells\n    y_A = np.array([5, 2, 3, 0], dtype=float)\n    y_B = np.array([0, 1, 0, 2], dtype=float)\n\n    # Exponential kernel length scale (bp)\n    tau = 500\n\n    # Test suite: window sizes (bp)\n    test_windows = [600, 0, 400]\n\n    results = []\n    for w in test_windows:\n        # Gene A\n        A_A = compute_activity(X, centers, tss_A, w, tau)\n        r_A = pearson_correlation(A_A, y_A)\n        results.append(r_A)\n        # Gene B\n        A_B = compute_activity(X, centers, tss_B, w, tau)\n        r_B = pearson_correlation(A_B, y_B)\n        results.append(r_B)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Successfully running an integration algorithm is only half the battle; the other half is critically evaluating the result to determine if the modalities are meaningfully aligned. This practice takes the form of a thought experiment to build your intuition for standard integration benchmarks like LISI, FOSCTTM, and silhouette width . By predicting how these metrics will behave when the biological signal linking the modalities is intentionally destroyed, you will gain a deeper appreciation for what they measure and how to interpret them in real-world analyses.",
            "id": "3330175",
            "problem": "A consortium releases a joint dataset combining Cellular Indexing of Transcriptomes and Epitopes by Sequencing (CITE-seq) and Assay for Transposase-Accessible Chromatin using sequencing (ATAC-seq). The CITE-seq profiles include messenger ribonucleic acid (mRNA) counts and Antibody-Derived Tags (ADT) for surface proteins; the ATAC-seq profiles are summarized into gene activity scores by aggregating chromatin accessibility peaks using a curated peak-to-gene mapping. An integrative method learns a shared embedding from these modalities using a shared gene feature space. Assume that the method builds local neighborhoods using a $k$-nearest neighbor graph in the embedding and aims to align modalities while preserving biological structure (cell types).\n\nTo stress test modality alignment, the consortium constructs a perturbed dataset as follows: in a random fraction $p \\in [0,1]$ of ATAC-seq cells, the peak-to-gene links are permuted among genes on a per-cell basis before computing gene activity scores. This permutation preserves the marginal distribution of peak counts per cell and per peak but destroys any systematic association between a cell’s true regulatory landscape and its corresponding gene activity profile. The CITE-seq measurements remain unchanged. The integrative method is then retrained on the perturbed dataset.\n\nThree evaluation metrics are computed in the learned embedding:\n\n- Local Inverse Simpson’s Index (LISI) for modality mixing (iLISI), defined by $$\\mathrm{iLISI} = \\frac{1}{\\sum_{m \\in \\{\\text{CITE}, \\text{ATAC}\\}} \\pi_m^2},$$ where $\\pi_m$ is the fraction of $k$-nearest neighbors (by embedding distance) from modality $m$. Higher values indicate better mixing across modalities.\n\n- Fraction of Samples Closer Than the True Match (FOSCTTM), computed for cells with known cross-modality correspondences from matched multiome measurements. For a cell $i$ in one modality with true counterpart $i^\\ast$ in the other modality, let $r_i$ be the number of cells in the other modality closer to $i$ than $i^\\ast$ in the embedding, and let $n$ be the total number of cells in that other modality. Then $$\\mathrm{FOSCTTM} = \\frac{1}{N}\\sum_{i=1}^{N} \\frac{r_i}{n},$$ where $N$ is the number of matched pairs. Lower values indicate better alignment of true pairs.\n\n- Average Silhouette Width (ASW) with respect to a label set $\\mathcal{L}$, defined for each point by $$s = \\frac{b-a}{\\max(a,b)},$$ where $a$ is the average distance to points in the same label and $b$ is the smallest average distance to points in any other label in $\\mathcal{L}$. We consider $\\mathrm{ASW}_{\\text{celltype}}$ computed with cell type labels (higher is better), and $\\mathrm{ASW}_{\\text{modality}}$ computed with modality labels (lower is better for mixing).\n\nUsing first principles about signal and noise, neighborhood composition, and distances in embeddings, reason about how the expected values of these metrics over all cells will change as $p$ increases from $p=0$ (unperturbed) to $p=1$ (all ATAC-seq cells permuted). Assume the integrative method relies on cross-modality covariance between gene activity and mRNA/ADT to align modalities, and that perturbations are independent across cells.\n\nWhich of the following patterns best describes the expected direction of change in the metrics as $p$ increases?\n\nA. $\\mathrm{iLISI}$ decreases, $\\mathrm{FOSCTTM}$ increases, $\\mathrm{ASW}_{\\text{celltype}}$ decreases, and $\\mathrm{ASW}_{\\text{modality}}$ increases, with the changes dominated by the perturbed ATAC-seq subset and approximately monotonic in $p$ under random perturbations.\n\nB. $\\mathrm{iLISI}$ increases because within-modality structure is destroyed leading to better mixing, $\\mathrm{FOSCTTM}$ decreases, $\\mathrm{ASW}_{\\text{celltype}}$ increases, and $\\mathrm{ASW}_{\\text{modality}}$ decreases.\n\nC. All metrics remain approximately unchanged because the marginal distributions per peak and per cell are preserved by permutation, so the integrative method and neighborhood structure are unaffected in expectation.\n\nD. $\\mathrm{iLISI}$ decreases, but $\\mathrm{ASW}_{\\text{celltype}}$ increases because the perturbation reduces cross-type contamination; $\\mathrm{FOSCTTM}$ remains roughly constant since true pairs are still close on average; $\\mathrm{ASW}_{\\text{modality}}$ is unchanged.\n\nE. For small $p$, $\\mathrm{iLISI}$ increases and $\\mathrm{ASW}_{\\text{modality}}$ decreases due to regularization effects of noise, but for large $p$ both reverse; $\\mathrm{FOSCTTM}$ and $\\mathrm{ASW}_{\\text{celltype}}$ are non-monotonic with a minimum at intermediate $p$.",
            "solution": "The problem asks to predict the change in four evaluation metrics for single-cell data integration as the strength of a specific perturbation, controlled by a parameter $p$, increases from $0$ to $1$. The core of the problem lies in understanding the nature of the data, the integration method, the perturbation, and the metrics themselves.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n- **Data Modalities**:\n    1.  CITE-seq: messenger ribonucleic acid (mRNA) counts and Antibody-Derived Tags (ADT).\n    2.  ATAC-seq: Gene activity scores, computed by aggregating chromatin accessibility peaks via a peak-to-gene mapping.\n- **Integration Method**:\n    - Learns a shared embedding from both modalities.\n    - Uses a shared gene feature space.\n    - Builds a $k$-nearest neighbor ($k$-NN) graph in the embedding.\n    - Aims to align modalities and preserve cell type structure.\n    - Relies on cross-modality covariance between gene activity (from ATAC-seq) and mRNA/ADT (from CITE-seq).\n- **Perturbation**:\n    - Applied to a random fraction $p \\in [0,1]$ of ATAC-seq cells.\n    - For a perturbed cell, peak-to-gene links are permuted before calculating gene activity scores.\n    - This permutation is performed on a per-cell basis.\n    - It preserves the marginal distribution of peak counts per cell and per peak.\n    - It destroys the systematic association between a cell's true regulatory state and its gene activity profile.\n    - CITE-seq data is not changed.\n    - The method is retrained on the perturbed dataset.\n- **Evaluation Metrics**:\n    1.  **Local Inverse Simpson’s Index (iLISI)** for modality mixing: $$\\mathrm{iLISI} = \\frac{1}{\\sum_{m \\in \\{\\text{CITE}, \\text{ATAC}\\}} \\pi_m^2}$$. Higher values indicate better mixing.\n    2.  **Fraction of Samples Closer Than the True Match (FOSCTTM)**: $$\\mathrm{FOSCTTM} = \\frac{1}{N}\\sum_{i=1}^{N} \\frac{r_i}{n}$$. Lower values indicate better alignment of true pairs.\n    3.  **Average Silhouette Width (ASW)**: $$s = \\frac{b-a}{\\max(a,b)}$$.\n        - $\\mathrm{ASW}_{\\text{celltype}}$: Computed on cell type labels. Higher is better.\n        - $\\mathrm{ASW}_{\\text{modality}}$: Computed on modality labels. Lower is better for mixing.\n- **Question**: Determine the expected direction of change for these metrics as $p$ increases from $p=0$ to $p=1$.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Grounding**: The problem is well-grounded in computational systems biology. CITE-seq and ATAC-seq are standard high-throughput single-cell assays. Their integration is a major area of research. The concept of gene activity scores, shared embeddings, and the use of covariance for alignment (as in Canonical Correlation Analysis and related methods) are all standard. The described perturbation is a valid and common strategy for stress-testing and evaluating the robustness of an integration method. The metrics (iLISI, FOSCTTM, ASW) are standard in the field. The setup is scientifically and methodologically sound.\n- **Well-Posedness**: The problem is well-posed. It clearly defines the initial state ($p=0$), the perturbed state (for a given $p$), the mechanism of perturbation, and the specific metrics to evaluate. The question asks for the expected trend, which is a solvable qualitative inference problem based on the provided information.\n- **Objectivity**: The problem is stated in objective, technical language. All key concepts and metrics are either standard in the field or explicitly defined.\n\n**Step 3: Verdict and Action**\nThe problem statement is valid. It is scientifically grounded, well-posed, and objective, providing a sufficient basis for a rigorous derivation. I will proceed with the solution.\n\n### Derivation from First Principles\n\nThe fundamental principle at play is the signal-to-noise ratio. The integrative method relies on a specific \"signal\": the biological correlation between gene expression (mRNA) and chromatin accessibility at corresponding gene loci (gene activity). The perturbation systematically replaces this signal with noise for a fraction $p$ of the ATAC-seq cells.\n\n1.  **Effect of the Perturbation on Data**: For an unperturbed ATAC-seq cell, the gene activity score vector $A_i$ is biologically related to the cell's type and state. For a CITE-seq cell of the same type, its mRNA vector $R_j$ is also related to that type. The integration method finds a mapping into an embedding $Z$ such that if cells $i$ and $j$ are of the same type, $\\text{Cov}(Z_i, Z_j)$ is high, driven by the underlying $\\text{Cov}(A_i, R_j)$. When the peak-to-gene links for an ATAC-seq cell $k$ are permuted, its resulting gene activity vector $A'_k$ is essentially a random vector with respect to biological identity. The covariance between $A'_k$ and the mRNA vector $R_j$ of any CITE-seq cell, including its true counterpart, will be near zero in expectation.\n\n2.  **Effect on the Embedding**: The integration method, when trained on the dataset with a fraction $p$ of perturbed ATAC-seq cells, will fail to align these perturbed cells with any of the CITE-seq cells. The CITE-seq cells and the unperturbed ($1-p$ fraction) ATAC-seq cells still contain valid biological signals and will be integrated together into structured clusters corresponding to cell types. The perturbed ATAC-seq cells, lacking the required cross-modality signal, will not be mapped into these structures. They will effectively be \"rejected\" by the alignment process, forming a separate, likely diffuse group in the embedding space, or being scattered randomly, far from the well-integrated clusters. As $p$ increases, the size of this rejected group grows.\n\n3.  **Analysis of Metric Changes as $p$ Increases**:\n\n    -   **$\\mathrm{iLISI}$ (Modality Mixing)**: This metric measures the diversity of modalities in a cell's local neighborhood. At $p=0$, integration is successful, and neighborhoods within a cell type cluster are well-mixed with both CITE-seq and ATAC-seq cells, leading to a high $\\mathrm{iLISI}$ (approaching $2$ for balanced modalities). As $p$ increases, the perturbed ATAC-seq cells are pushed away from the CITE-seq cells. The neighborhood of a CITE-seq cell becomes progressively dominated by other CITE-seq cells and the remaining unperturbed ATAC-seq cells. The neighborhood of a perturbed ATAC-seq cell becomes dominated by other perturbed ATAC-seq cells. This constitutes a *decrease* in local modality mixing. The neighborhood purity with respect to modality increases, which by definition means iLISI decreases (approaching $1$). Therefore, **$\\mathrm{iLISI}$ is expected to decrease**.\n\n    -   **$\\mathrm{FOSCTTM}$ (True Pair Alignment)**: This metric assesses if a cell's true counterpart from the other modality is closer than other cells. At $p=0$, a CITE-seq cell $i$ is close to its true ATAC-seq match $i^*$, so $r_i$ (the number of closer cells) is small, and $\\mathrm{FOSCTTM}$ is low. If the cell pair $(i, i^*)$ is part of the test set and the ATAC-seq cell $i^*$ is selected for perturbation, its gene activity profile becomes noise. The embedding will place the perturbed $i^*$ far from the CITE-seq cell $i$. Consequently, many other ATAC-seq cells (especially unperturbed ones of the correct cell type) will be closer to $i$ than the true match $i^*$, causing $r_i$ to become very large. As $p$ increases, a larger fraction of matched pairs have their ATAC-seq member perturbed, leading to a monotonic increase in the average $r_i/n$. Therefore, **$\\mathrm{FOSCTTM}$ is expected to increase**.\n\n    -   **$\\mathrm{ASW}_{\\text{celltype}}$ (Cell Type Separation)**: This metric measures the quality of cell type clustering. A high score means cells are closer to other cells of the same type ($a$ is small) than to cells of other types ($b$ is large). At $p=0$, clusters are well-defined, and $\\mathrm{ASW}_{\\text{celltype}}$ is high. As $p$ increases, a perturbed ATAC-seq T-cell, for example, is pushed out of the main T-cell cluster because its features no longer resemble a T-cell. This increases the average distance between members of the T-cell cluster (an increase in intra-cluster distance, $a$). The cell may also end up closer to another cluster, decreasing inter-cluster distance $b$. Both effects, increasing $a$ and decreasing $b$, cause the silhouette score $s = (b-a)/\\max(a,b)$ to decrease. Thus, the overall biological structure is degraded. Therefore, **$\\mathrm{ASW}_{\\text{celltype}}$ is expected to decrease**.\n\n    -   **$\\mathrm{ASW}_{\\text{modality}}$ (Modality Separation)**: This metric checks for separation based on modality labels. Good mixing corresponds to a low score. At $p=0$, good mixing means cells from the \"CITE\" and \"ATAC\" labels are interspersed, resulting in a small distance between modalities ($b$ is small) and a low $\\mathrm{ASW}_{\\text{modality}}$. As $p$ increases, the perturbed ATAC-seq cells are pushed away from all CITE-seq cells. This creates a separation between the group of CITE-seq cells and the group of perturbed ATAC-seq cells. The average distance between points of different modalities ($b$) will increase significantly. The average distance within the ATAC-seq modality ($a$) might not increase as much, as the perturbed cells may form their own cluster. An increase in inter-cluster distance $b$ relative to intra-cluster distance $a$ leads to an increase in the silhouette score. This reflects the de-mixing of modalities. Therefore, **$\\mathrm{ASW}_{\\text{modality}}$ is expected to increase**.\n\n### Option-by-Option Analysis\n\n-   **A. $\\mathrm{iLISI}$ decreases, $\\mathrm{FOSCTTM}$ increases, $\\mathrm{ASW}_{\\text{celltype}}$ decreases, and $\\mathrm{ASW}_{\\text{modality}}$ increases, with the changes dominated by the perturbed ATAC-seq subset and approximately monotonic in $p$ under random perturbations.**\n    - This option perfectly matches the derived expectations for all four metrics.\n    - $\\mathrm{iLISI}$ decreases (worsening mixing). **Correct**.\n    - $\\mathrm{FOSCTTM}$ increases (worsening true pair alignment). **Correct**.\n    - $\\mathrm{ASW}_{\\text{celltype}}$ decreases (degradation of biological structure). **Correct**.\n    - $\\mathrm{ASW}_{\\text{modality}}$ increases (increasing separation of modalities). **Correct**.\n    - The reasoning that changes are monotonic and driven by the perturbed subset is also sound based on the nature of the perturbation. **Verdict: Correct**.\n\n-   **B. $\\mathrm{iLISI}$ increases because within-modality structure is destroyed leading to better mixing, $\\mathrm{FOSCTTM}$ decreases, $\\mathrm{ASW}_{\\text{celltype}}$ increases, and $\\mathrm{ASW}_{\\text{modality}}$ decreases.**\n    - This option predicts the opposite trend for every metric. Destroying the biological signal in ATAC-seq cells prevents, rather than improves, mixing with CITE-seq cells. All claims are incorrect. **Verdict: Incorrect**.\n\n-   **C. All metrics remain approximately unchanged because the marginal distributions per peak and per cell are preserved by permutation, so the integrative method and neighborhood structure are unaffected in expectation.**\n    - This reasoning is flawed. While marginal distributions are preserved, the integrative method relies on cross-modality *covariance*, a feature of the joint distribution of gene activities, which is destroyed by the permutation. The method's performance will be severely degraded. **Verdict: Incorrect**.\n\n-   **D. $\\mathrm{iLISI}$ decreases, but $\\mathrm{ASW}_{\\text{celltype}}$ increases because the perturbation reduces cross-type contamination; $\\mathrm{FOSCTTM}$ remains roughly constant since true pairs are still close on average; $\\mathrm{ASW}_{\\text{modality}}$ is unchanged.**\n    - This option contains multiple incorrect claims. $\\mathrm{ASW}_{\\text{celltype}}$ will decrease, not increase. Perturbing cells introduces noise and degrades clusters. $\\mathrm{FOSCTTM}$ will not remain constant; it will increase as true pairs are pushed apart. $\\mathrm{ASW}_{\\text{modality}}$ will increase, not remain unchanged, as modalities de-mix. **Verdict: Incorrect**.\n\n-   **E. For small $p$, $\\mathrm{iLISI}$ increases and $\\mathrm{ASW}_{\\text{modality}}$ decreases due to regularization effects of noise, but for large $p$ both reverse; $\\mathrm{FOSCTTM}$ and $\\mathrm{ASW}_{\\text{celltype}}$ are non-monotonic with a minimum at intermediate $p$.**\n    - This proposes a non-monotonic, regularization-like effect. The perturbation described is not small, random noise that could regularize a model; it is a complete destruction of the relevant signal for the affected cells. It is extremely unlikely that destroying the very signal the method uses for alignment would lead to an initial *improvement* in any metric. The degradation should be monotonic with the fraction of corrupted data, $p$. **Verdict: Incorrect**.",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}