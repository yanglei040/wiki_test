## 应用与交叉学科联系

### 引言

前面的章节已经系统地阐述了整合单细胞和[空间组学](@entry_id:156223)数据集的核心原理与机制。我们已经理解了这些数据模态的独特结构、它们带来的计算挑战，以及为解决这些挑战而设计的各种算法基础。然而，理论知识的真正价值在于其应用。本章旨在将这些核心原理置于更广阔的科学图景之中，通过一系列跨学科的应用案例，展示这些计算方法如何被用于解决真实世界中的生物学问题。

本章的目标不是重复讲授基本概念，而是演示它们的实用性、扩展性以及在不同应用领域中的融合。我们将探讨如何利用这些整合策略，从最初的数据对齐和映射，到构建复杂的机理模型，再到探索前沿的几何与拓扑学分析方法。通过这些案例，我们将看到，单细胞与[空间组学](@entry_id:156223)的整合不仅仅是数据的简单叠加，更是一个能够催生新知识、提出新假设、并最终深化我们对复杂生命系统理解的强大引擎。这些应用横跨了从基础细胞生物学到临床病理学，从[发育生物学](@entry_id:141862)到[肿瘤微环境](@entry_id:152167)研究的多个领域，充分体现了这一技术交叉融合的巨大潜力。

### 建立对应关系：数据集的对齐与映射

整合不同组学数据的第一步，往往是建立不同数据点之间的有意义的对应关系。这种对应关系可以是几何上的刚性对齐，也可以是基于相似性的概率映射。本节将探讨几种关键的对"齐与映射"策略。

#### 共享潜在空间中的对齐

许多整合方法首先将不同模态的数据（如scRNA-seq和空间转录组）嵌入到一个共享的低维潜在空间中。然而，由于[降维](@entry_id:142982)过程的随机性或算法本身的特性，即使是匹配的细胞和空间点，其在潜在空间中的表征也可能存在任意的旋转或镜像变换。为了消除这种无生理意义的差异，同时保持每个数据集内部的几何结构，我们需要对这些嵌入进行对齐。

[普氏分析](@entry_id:178503)（Procrustes analysis）是解决此类问题的经典方法。假设我们有两个匹配的点云，分别由矩阵 $Z_X \in \mathbb{R}^{n \times d}$ 和 $Z_Y \in \mathbb{R}^{n \times d}$ 表示，其中 $n$ 是匹配点的数量，$d$ 是[潜在空间](@entry_id:171820)的维度。[普氏分析](@entry_id:178503)旨在寻找一个[正交矩阵](@entry_id:169220) $R$ (代表旋转或镜像)，通过最小化两个点云之间的[弗罗贝尼乌斯范数](@entry_id:143384)（Frobenius norm）差异来对齐它们：
$$
\min_{R \in \mathbb{R}^{d \times d}} \lVert Z_X R - Z_Y \rVert_F^2 \quad \text{subject to} \quad R^\top R = I_d
$$
这个[优化问题](@entry_id:266749)有一个基于奇异值分解（SVD）的解析解。如果 $Z_X^\top Z_Y$ 的SVD为 $U \Sigma V^\top$，那么最优的[正交变换](@entry_id:155650)矩阵为 $R^\star = U V^\top$。由于[正交变换](@entry_id:155650)是保距变换，它不改变点云内部各点之间的[欧几里得距离](@entry_id:143990)。因此，通过[普氏分析](@entry_id:178503)对齐点云不会改变数据集内部的几何邻接关系，如 $k$-最近邻图，从而保留了其内在的生物学邻域结构。然而，必须认识到，该方法的基本假设是两个[嵌入空间](@entry_id:637157)之间存在近似刚性的等距关系。如果不同模态之间存在[非线性](@entry_id:637147)的批次效应或基因依赖的尺度差异，这种非等距的扭曲将无法通过单一的正交变换来校正，此时[普氏分析](@entry_id:178503)可能无法恢复跨模态的生物学邻域对应关系 。

#### 组织样本的物理空间对齐

与抽象的[潜在空间](@entry_id:171820)对齐不同，[空间组学](@entry_id:156223)数据与组织病理学图像的整合需要在物理空间中进行精确的几何对齐。例如，一个常见的任务是将高分辨率的苏木精-伊红（HE）染色图像与[空间转录组学](@entry_id:270096)数据对齐。

一个[仿射变换](@entry_id:144885) $T(x) = Ax + b$ 在整个图像域上施加一个统一的线性形变（旋转、缩放、剪切）和平移，它虽然能保持拓扑结构（当 $A$ 可逆时），但无法捕捉局部的拉伸或压缩。对于需要保留细胞级别邻域结构的任务而言，这种全局变换可能导致显著的错位。

为了解决这个问题，更先进的图像配准技术采用更灵活的[非线性变换](@entry_id:636115)模型。[微分同胚](@entry_id:147249)变换（Diffeomorphic transformation）是计算解剖学中的黄金标准。这种变换是通过对一个光滑的速度场进行积分生成的，其数学构造保证了变换是拓扑保持的（即不会撕裂或折叠组织），并且是可逆的。一个典型的策略是采用两步配准：首先，使用全局[仿射变换](@entry_id:144885)校正整体的平移、[旋转和缩放](@entry_id:154036)；然后，在此基础上，使用一个正则化的微分同胚变换来精细地校正局部的、非刚性的形变。通过对变换的[雅可比矩阵](@entry_id:264467)施加约束（例如，要求其[行列式](@entry_id:142978)大于零且矩阵本身接近单位阵），可以确保变换在保留局部方向的同时，也近似保持微小尺度（如细胞尺度）的距离，从而避免对细胞微环境结构的扭曲 。

#### 概率映射与[反卷积](@entry_id:141233)

在许多情况下，单细胞数据和空间数据之间并不存在一对一的明确对应关系。例如，一个空间转录组的采样点（spot）通常包含多个细胞的信号。在这种情况下，建立对应关系就转化为一个概率映射或[反卷积](@entry_id:141233)问题。

最优传输（Optimal Transport, OT）理论为此提供了一个强大的数学框架。它旨在寻找一个“传输方案” $T$，以最低的成本将scRNA-seq细胞的“质量”分配到空间采样点上。其[成本矩阵](@entry_id:634848) $C$ 可以灵活地定义，以整合多种信息。例如，成本 $C_{ij}$ 可以是单细胞 $i$ 的表达谱与空间点 $j$ 的表达谱之间的[欧几里得距离](@entry_id:143990)，还可以加上一项惩罚，该惩罚项基于空间点 $j$ 邻域的[组织学](@entry_id:147494)纹理特征。通过求解一个带[熵正则化](@entry_id:749012)的最优传输问题，可以得到一个概率性的传输矩阵 $T^\star$。这个矩阵不仅将每个单细胞映射到一个或多个空间位置，还为每个空间位置提供了一个可能的细胞来源的[概率分布](@entry_id:146404)。[熵正则化](@entry_id:749012)使得问题变为严格凸的，并允许使用高效且数值稳定的[Sinkhorn算法](@entry_id:754924)进行求解 。

另一个核心任务是空间反卷积（spatial deconvolution），即推断每个空间采样点内部不同细胞类型的构成比例。这是一个典型的[统计推断](@entry_id:172747)问题，通常在贝叶斯框架下解决。一个完整的贝叶斯[反卷积](@entry_id:141233)模型包含三个要素：一个似然函数、一个[先验分布](@entry_id:141376)和一个推断算法。
- **[似然函数](@entry_id:141927)**：它将观测到的空间点基因表达计数 $y_s$ 与未知的细胞类型比例 $\pi_s$ 以及已知的细胞类型参考表达谱 $\phi_k$ 联系起来。常用的[似然](@entry_id:167119)模型包括多项式[分布](@entry_id:182848)（Multinomial）和更灵活的负二项分布（Negative Binomial），后者可以更好地处理真实测[序数](@entry_id:150084)据中普遍存在的过离散现象。
- **先验分布**：它编码了我们关于细胞类型比例 $\pi_s$ 的先验知识。由于比例向量必须位于单纯形上（即所有元素非负且和为1），[狄利克雷分布](@entry_id:274669)（Dirichlet）是一个自然的选择。更高级的模型可能会使用对数正态先验（logistic-normal prior），这种先验更加灵活，并且可以方便地引入[空间相关性](@entry_id:203497)结构，例如，通过高斯过程对相邻空间点的比例施加平滑约束。
- **推断与[不确定性量化](@entry_id:138597)**：由于后验分布通常没有解析形式，需要使用马尔可夫链蒙特卡洛（MCMC）等[采样方法](@entry_id:141232)进行[近似推断](@entry_id:746496)。这种方法不仅能提供比例的[点估计](@entry_id:174544)，还能给出其完整的后验分布，从而可以计算可信区间（credible intervals），对推断结果的不确定性进行量化 。

### 联合建模以解耦生物学与技术变异

简单地对齐或映射数据虽然有用，但更深入的整合策略旨在构建一个统一的生成模型，以捕捉不同模态数据背后的共同生物学过程，并将其与模态特有的技术或生物学变异分离开来。这种“[解耦](@entry_id:637294)”（disentanglement）是实现真正[多组学整合](@entry_id:267532)的关键。

组[因子分析](@entry_id:165399)（Group Factor Analysis）是实现这一目标的强大框架。这类模型假设观测到的[高维数据](@entry_id:138874)（如scRNA-seq的基因表达矩阵 $Y_{\mathrm{sc}}$ 和[空间组学](@entry_id:156223)的 $Y_{\mathrm{sp}}$）是由一组低维的潜在因子（latent factors）线性生成的。模型的关键在于将这些因子划分为两类：
- **共享因子 ($z_{\mathrm{shared}}$)**：这些因子捕捉了跨越所有数据模态的共同生物学变异，例如，不同细胞类型共有的核心基因程序。
- **私有因子 ($z_{\mathrm{sc}}, z_{\mathrm{sp}}$)**：这些因子捕捉了仅在单一模态中存在的变异，例如，[scRNA-seq](@entry_id:155798)数据中的解离效应或空间数据特有的[空间自相关](@entry_id:177050)模式。

模型的生成过程可以写为：
$$
y_{\mathrm{sc}} = W_{\mathrm{sc}}^{\mathrm{shared}} z_{\mathrm{shared}} + W_{\mathrm{sc}}^{\mathrm{private}} z_{\mathrm{sc}} + \epsilon_{\mathrm{sc}}
$$
$$
y_{\mathrm{sp}} = W_{\mathrm{sp}}^{\mathrm{shared}} z_{\mathrm{shared}} + W_{\mathrm{sp}}^{\mathrm{private}} z_{\mathrm{sp}} + \epsilon_{\mathrm{sp}}
$$
其中 $W$ 是载荷矩阵，将潜在因子映射到观测空间。为了实现有效的[解耦](@entry_id:637294)，[贝叶斯先验](@entry_id:183712)的精巧设计至关重要。一个成功的策略包括：
1. **潜在因子的独立性**：为共享因子和各个私有因子赋予独立的[先验分布](@entry_id:141376)（如[标准正态分布](@entry_id:184509)），以确保它们的贡献在统计上是可分离的。
2. **载荷矩阵的[组稀疏性](@entry_id:750076)**：为了使一个共享因子要么在所有模态中都活跃，要么在所有模态中都沉寂，可以对共享载荷矩阵 $W_{\mathrm{sc}}^{\mathrm{shared}}$ 和 $W_{\mathrm{sp}}^{\mathrm{shared}}$ 的对应列施加一个共同的[稀疏先验](@entry_id:755119)。[自动相关性确定](@entry_id:746592)（Automatic Relevance Determination, ARD）就是一种实现这一目标的经典方法，它为每一对共享载荷列分配一个共同的精度超参数，从而鼓励它们被联合地剪枝或保留。
3. **空间结构建模**：为了将空间信息融入模型，可以将[空间平滑](@entry_id:202768)先验（如[高斯马尔可夫随机场](@entry_id:749746)）专门施加在空间模态的私有因子 $z_{\mathrm{sp}}$ 或其载荷 $W_{\mathrm{sp}}^{\mathrm{private}}$ 上。这使得模型能够捕捉空间模式，而不会错误地将这种结构归因于非空间的[scRNA-seq](@entry_id:155798)数据或共享的生物学过程 。

### 利用空间信息深化推断

[空间组学](@entry_id:156223)数据的核心价值在于其固有的空间坐标信息。善用这一信息不仅能提高数据分析的准确性，还能揭示仅在空间背景下才显现的生物学现象。

#### [空间平滑](@entry_id:202768)与特征增强

原始的[空间组学](@entry_id:156223)数据通常含有大量技术噪声。利用空间点之间的邻接关系进行[信息聚合](@entry_id:137588)或平滑，是增强信号、降低噪声的有效手段。[图神经网络](@entry_id:136853)（Graph Neural Networks, GNNs），特别是[图卷积网络](@entry_id:194500)（Graph Convolutional Networks, GCNs），为此提供了一个强大的框架。

在这种方法中，空间采样点被视为图的节点，相邻的点之间通过边连接。GCN通过在图上传播和聚合信息来学习每个节点（空间点）的特征表示。一个标准的GCN层通过对邻域节点的特征进行加权平均来更新中心节点的特征，其传播规则通常写作：
$$
H^{(l+1)} = \sigma\left(\tilde{D}^{-1/2} \tilde{A} \tilde{D}^{-1/2} H^{(l)} W^{(l)}\right)
$$
其中，$\tilde{A} = A + I$ 是加入了自环的[邻接矩阵](@entry_id:151010)，$A$ 是原始的空间邻接图，$\tilde{D}$ 是 $\tilde{A}$ 的度矩阵。这种对称归一化的传播方式可以有效地聚合邻域信息，同时避免了由节点度数差异引起的偏倚，并保证了多层传播的数值稳定性。

然而，在[半监督学习](@entry_id:636420)任务（如利用部分有标注的空间点预测其余点的细胞类型）中，一个严峻的实践挑战是“标签泄漏”（label leakage）。如果[验证集](@entry_id:636445)或测试集的真实标签以任何直接或间接的方式被用于模型训练过程，例如被用作输入特征或用于构建图结构，都会导致模型性能的虚高和评估结果的失效。一个严谨的分析流程必须：(1) 仅使用无标签信息（如基因表达和空间坐标）构建图和特征；(2) 通过掩码（mask）将监督损失严格限制在[训练集](@entry_id:636396)上；(3) 考虑到[空间自相关](@entry_id:177050)性，采用空间上不相交的数据集划分（如区块划分），而不是随机划分，来确保训练集和验证/[测试集](@entry_id:637546)在地理上是分离的 。

#### 空间感知的先验与正则化

除了作为特征增强的工具，空间信息也可以被编码为[统计模型](@entry_id:165873)中的先验或正则化项，以指导参数的推断。

- 在前述的贝叶斯反卷积模型中，通过为控制细胞类型比例的[潜变量](@entry_id:143771)施加一个空间[高斯过程](@entry_id:182192)先验，可以鼓励相邻空间点拥有相似的细胞类型组成，这与组织生物学的直觉相符 。

- 在整合空间表观遗传学数据时，可以通过图拉普拉斯二次型正则项施加[空间平滑](@entry_id:202768)。具体而言，对每个[染色质](@entry_id:272631)特征在所有空间点上的值向量 $h_{:,j}$，可以最小化一个包含保真项和正则项的目标函数：$\|h_{:,j} - y_{:,j}\|_2^2 + \alpha h_{:,j}^\top L h_{:,j}$。其中 $y_{:,j}$ 是观测值，$L$ 是空间邻接图的拉普拉斯矩阵，$\alpha$ 控制平滑强度。这个问题的解可以通过求解一个[线性方程组](@entry_id:148943) $(I + \alpha L) h_{:,j} = y_{:,j}$ 得到，从而获得[去噪](@entry_id:165626)且[空间平滑](@entry_id:202768)的[染色质状态](@entry_id:190061)估计 。

- 更进一步，模型甚至可以推断空间变化的参数。例如，在研究[基因调控网络](@entry_id:150976)时，可以假设[转录因子](@entry_id:137860)（TF）与目标基因之间的调控权重 $W(\mathbf{x})$ 是空间位置 $\mathbf{x}$ 的函数。一种推断策略是，首先使用局部加权回归（locally weighted regression）为每个空间点独立地估计一个局部的调控权重。然后，将这些离散的、有噪声的权重估计场视为一个信号，并使用图[拉普拉斯正则化](@entry_id:634509)对其进行平滑，以获得一个在空间上连续变化的、更稳健的权重场估计 。

### 构建并检验生物学机理模型

整合[多组学](@entry_id:148370)数据的最终目标之一是超越描述性的关联分析，构建能够解释生物学现象并可供检验的机理模型。

#### 推断调控逻辑

通过整合不同层面的分子数据，我们可以重构[基因调控](@entry_id:143507)的级联反应。
- **从[染色质](@entry_id:272631)到转录**：整合单细胞[ATAC-seq](@entry_id:169892)（测量[染色质开放](@entry_id:187103)性）和RNA-seq数据，是推断[基因调控网络](@entry_id:150976)的第一步。一个常见的做法是，基于[染色质开放](@entry_id:187103)性数据构建一个“基因活性得分”（gene activity score）矩阵。一个简单的线性模型将基因 $g$ 的活性定义为其附近所有开放[染色质](@entry_id:272631)区域（peaks）信号的加权和：$G = A^\top X_{\mathrm{ATAC}}$，其中 $A$ 是一个预先定义的峰-基因[关联矩阵](@entry_id:263683)。然而，将这个推断的基因活性与实测的RNA表达进行比对时，会面临诸多挑战。例如，基于基因组距离的简单[关联矩阵](@entry_id:263683) $A$ 可能会错误地连接远端调控元件，而引入[转录因子](@entry_id:137860)基序（motif）或共开放性信息可以构建更准确的关联。此外，空间数据中的细胞类型[异质性](@entry_id:275678)会引入组成偏倚，必须通过反卷积等方法进行校正 。

- **检验特定调控假设**：整合分析也可以被设计用来检验特定的生物学假设。例如，为了检验[DNA甲基化](@entry_id:146415)是否在空间上调控基因表达，可以构建一个[非线性回归](@entry_id:178880)模型。使用[核方法](@entry_id:276706)（kernel methods），我们可以分别构建基于空间距离的核函数 $K_s$ 和基于甲基化水平相似性的[核函数](@entry_id:145324) $K_m$。通过比较一个仅使用 $K_s$ 的模型（零假设模型）和一个使用组合核 $K_s + K_m$ 的模型（[备择假设](@entry_id:167270)模型）的交叉验证[预测误差](@entry_id:753692)，我们可以评估甲基化是否提供了超越空间位置本身的额外预测能力。其统计显著性可以通过[置换检验](@entry_id:175392)（permutation test）来严格评估，即通过随机打乱甲基化数据与空间位置的对应关系来构建[零分布](@entry_id:195412) 。

- **推断[转录后调控](@entry_id:147164)**：中心法则的调控链并未在转录后终止。通过整合空间[蛋白质组学](@entry_id:155660)和[转录组学](@entry_id:139549)数据，我们可以探索[转录后调控](@entry_id:147164)机制，如微小RNA（[miRNA](@entry_id:149310)）对翻译的抑制。一个巧妙的建模策略是，首先构建一个基线模型，用局部和邻域平滑后的转录本丰度来预测蛋白质丰度。然后，计算蛋白质丰度的观测值与基线模型预测值之间的残差。这些残差代表了无法被转录本水平解释的蛋白质丰度变化，理论上富集了[转录后调控](@entry_id:147164)的信号。最后，通过一个正则化的线性模型（如[岭回归](@entry_id:140984)），将这些残差与空间上匹配的miRNA表达水平进行关联，从而识别出可能在该空间背景下发挥调控作用的miRNA 。

#### 基于约束的因果建模

更高层次的整合旨在构建能够进行预测和模拟的系统级模型。
- **代谢流平衡分析（Flux Balance Analysis, FBA）**：这是一种[基于约束的建模](@entry_id:173286)方法，用于预测细胞在特定环境下的[代谢通量](@entry_id:268603)[分布](@entry_id:182848)。通过整合scRNA-seq和空间[代谢组学](@entry_id:148375)数据，我们可以为FB[A模型](@entry_id:158323)提供生物学上更相关的约束。例如，基因表达数据可以通过[基因-蛋白质-反应](@entry_id:261823)（GPR）规则（如"AND"逻辑用于复合酶，"OR"逻辑用于[同工酶](@entry_id:171985)）转化为模型中各个生化反应的速率上限。同时，由[质谱成像](@entry_id:751716)（MSI）测量的空间代谢物浓度，可以通过[米氏动力学](@entry_id:147129)（[Michaelis-Menten](@entry_id:145978) kinetics）模型转化为代谢物摄取反应的速率上限。在一个给定的空间位置，结合了这些[多组学](@entry_id:148370)约束的FB[A模型](@entry_id:158323)可以被求解，以最大化一个生物学目标（如生物质生成速率），从而推断出该位置活跃的代谢通路和通量状态 。

- **反事实推断与干预模拟**：整合模型的最终检验之一是其预测扰动效应的能力。通过构建一个描述空间信号通讯的模型，我们可以进行“反事实”或“虚拟”的干[预实验](@entry_id:172791)。例如，我们可以构建一个模型，其中细胞 $i$ 的基因表达程序 $x_i$ 的[稳态](@entry_id:182458)水平，由其[自身受体](@entry_id:174391)水平 $r_i$ 和接收到的来自周围细胞 $j$ 的[配体](@entry_id:146449)信号 $s_i = \sum_j K_{ij} m_j$ 共同决定。$K_{ij}$ 是一个依赖于空间距离的[核函数](@entry_id:145324)，$m_j$ 是细胞 $j$ 的[配体](@entry_id:146449)表达水平。基于这个模型，我们可以预测在特定区域 $R$ 内敲除[配体](@entry_id:146449)生产（即令 $j \in R$ 的 $m_j=0$）后，系统中所有细胞 $i$ 的基因表达程序[稳态](@entry_id:182458)水平的变化 $\Delta x_i$。这种*in silico*的扰动预测，可以与真实的[Perturb-seq](@entry_id:172948)等实验数据进行对比，以验证和改进我们对[细胞间通讯](@entry_id:151578)网络的理解 。

### 先进的几何与拓扑学整合框架

除了传统的统计和机器学习方法，来自几何学和拓扑学的抽象数学工具为数据整合提供了全新的视角，它们关注数据集的内在形状和结构，而非单个数据点的对应。

#### 利用[格罗莫夫-瓦瑟斯坦距离](@entry_id:750072)比较数据集

在比较来自不同样本（如不同病人）的[空间组学](@entry_id:156223)数据时，一个核心挑战是这些数据集不仅在特征上存在差异，其空间结构和细胞组成也可能完全不同。它们存在于不同的[度量空间](@entry_id:138860)中，无法直接比较。格罗莫夫-瓦瑟斯坦（Gromov-Wasserstein, GW）距离为此提供了一个解决方案。它是一种最优传输理论的扩展，用于衡量两个度量-[测度空间](@entry_id:191702)（metric-measure space）之间的差异，而无需它们嵌入在同一个背景空间中。

更进一步，我们可以计算多个空间的GW重心（barycenter）。给定多个来自不同病人的空间数据集和一个作为参考的单细胞数据集，GW重心算法可以学习到一个“平均”或“模板”的度量-[测度空间](@entry_id:191702)，它最小化了与所有输入空间的加权GW距离之和。这个模板空间为整合异质性极大的多样本数据提供了一个共同的参考框架。通过交替优化求解[耦合矩阵](@entry_id:191757)和重心空间的[距离矩阵](@entry_id:165295)，可以迭代地逼近这个重心。计算出重心后，每个病人样本与其的GW距离可以作为衡量该病人偏离“平均”模式程度的量化指标，从而为研究病人间的[异质性](@entry_id:275678)提供了一个有原则的数学工具 。

#### 利用[拓扑数据分析](@entry_id:154661)进行结构比较

[拓扑数据分析](@entry_id:154661)（Topological Data Analysis, TDA）关注数据集中独立于具体坐标和度量的不变结构特征，如连通性、环状结构和空洞。持久同调（Persistent homology）是TDA的核心工具，它通过追踪在不同尺度下拓扑特征（由贝蒂数 $\beta_k$ 量化，$\beta_0$ 计连通分支，$\beta_1$ 计环）的产生和消失，来捕捉数据的多尺度拓扑信息。

在整合[scRNA-seq](@entry_id:155798)和[空间组学](@entry_id:156223)数据时，我们可以假设有意义的生物学结构（如细胞簇或空间域）在不同模态中应具有相似的拓扑特征。例如，如果scRNA-seq数据在某个[嵌入空间](@entry_id:637157)中呈现为两个分离的簇，我们可能期望其在组织空间中也对应两个分离的区域。我们可以为每个数据集（[scRNA-seq](@entry_id:155798)嵌入点云和空间点云）在不同[尺度参数](@entry_id:268705) $\varepsilon$ 下构建Vietoris-Rips单纯复形，并计算其[贝蒂数](@entry_id:153109) $\beta_0(\varepsilon)$ 和 $\beta_1(\varepsilon)$。然后，可以定义一个拓扑[损失函数](@entry_id:634569)，该函数惩罚两个模态在各个尺度上[贝蒂数](@entry_id:153109)的差异：
$$
\mathcal{L}_{\text{topo}} = \sum_{i} w_0 (\beta_0^{\mathrm{rna}}(\varepsilon_i) - \beta_0^{\mathrm{spatial}}(\varepsilon_i))^2 + w_1 (\beta_1^{\mathrm{rna}}(\varepsilon_i) - \beta_1^{\mathrm{spatial}}(\varepsilon_i))^2
$$
这种损失函数可以被用作更复杂的整合模型的正则化项，引导模型学习一种既能在特征空间上对齐数据，又能保持其宏观拓扑结构一致性的整合方案 。

### 结论

本章通过一系列精心设计的应用案例，展示了单细胞与空间[组学数据整合](@entry_id:268201)领域的广度与深度。我们看到，整合的实践远不止于数据的可视化叠加，它是一个涵盖了从严谨的统计推断、复杂的机器学习建模到深刻的生物学机理探索的完整谱系。这些方法论的交叉融合，使得我们能够对齐[异构数据](@entry_id:265660)、[解耦](@entry_id:637294)复杂变异、利用空间信息、检验调控假设，甚至构建可预测的系统模型。随着新算法的不断涌现和[数据质量](@entry_id:185007)的持续提升，我们有理由相信，单细胞与[空间组学](@entry_id:156223)的整合将继续作为[计算系统生物学](@entry_id:747636)的核心驱动力之一，为揭示生命的复杂奥秘提供前所未有的洞察力。