{
    "hands_on_practices": [
        {
            "introduction": "In multiscale modeling, a crucial first step is to understand the interplay between different physical processes occurring at different scales. Nondimensionalization is a powerful mathematical technique that transforms a model's equations into a universal form, revealing the core dimensionless groups that govern the system's behavior. This practice guides you through the process of nondimensionalizing a reaction-diffusion equation to derive key parameters like the Damköhler number, which compares reaction and diffusion timescales, allowing you to quantitatively assess when a simplified continuum model is appropriate versus when a detailed discrete-cell model is necessary .",
            "id": "3330669",
            "problem": "Consider a hybrid multiscale model for a diffusing signaling molecule with concentration field $c(\\mathbf{x},t)$ in a three-dimensional tissue domain with characteristic length scale $L$. At the tissue scale, the concentration evolves according to mass conservation and Fickian diffusion, with a linear clearance due to biochemical degradation and cellular uptake. The macroscopic dynamics are represented by the partial differential equation (PDE)\n$$\n\\partial_t c(\\mathbf{x},t) = D \\nabla^2 c(\\mathbf{x},t) - k\\,c(\\mathbf{x},t) - \\lambda\\,c(\\mathbf{x},t)\n$$,\nwhere $D$ is the diffusion coefficient, $k$ is the intrinsic first-order biochemical clearance rate, and $\\lambda$ is an effective first-order uptake rate coefficient that aggregates discrete cell-level uptake events occurring at rate $\\lambda$ per cell into a continuum sink term under a homogenization assumption.\n\nStarting from conservation of mass and Fick's law of diffusion, nondimensionalize this equation using the scalings $c = c_0 \\tilde{c}$, $\\mathbf{x} = L \\tilde{\\mathbf{x}}$, and $t = \\tau \\tilde{t}$, where $\\tau$ is chosen to be the diffusive timescale. Identify two independent, interpretable dimensionless groups that control the balance of processes: one capturing the ratio of reaction to diffusion over the domain scale and one measuring the relative strength of cellular uptake to intrinsic biochemical clearance. Then, interpret how the magnitudes of these groups inform regime selection for multiscale hybrid modeling, specifically whether a continuum approximation of uptake is appropriate or whether discrete event-based modeling at the cell scale is warranted.\n\nFor a tissue slab with parameters $L = 500~\\mu\\mathrm{m}$, $D = 2 \\times 10^{-10}~\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k = 1 \\times 10^{-3}~\\mathrm{s}^{-1}$, and $\\lambda = 5 \\times 10^{-4}~\\mathrm{s}^{-1}$, compute the two dimensionless groups you identified. Express the final values as dimensionless numbers and round your answer to four significant figures. Report your final numeric values for the two dimensionless groups in a single row matrix in the order $(\\mathrm{Da}, \\Lambda)$.",
            "solution": "The problem statement is first subjected to validation.\n\n### Step 1: Extract Givens\n- **Governing Equation:** The concentration $c(\\mathbf{x},t)$ of a signaling molecule evolves according to the partial differential equation (PDE):\n$$\n\\partial_t c(\\mathbf{x},t) = D \\nabla^2 c(\\mathbf{x},t) - k\\,c(\\mathbf{x},t) - \\lambda\\,c(\\mathbf{x},t)\n$$\n- **Variable Definitions:**\n  - $c(\\mathbf{x},t)$: Concentration field in a three-dimensional tissue domain.\n  - $\\mathbf{x}$: Position vector.\n  - $t$: Time.\n- **Parameter Definitions:**\n  - $D$: Diffusion coefficient.\n  - $k$: Intrinsic first-order biochemical clearance rate.\n  - $\\lambda$: Effective first-order uptake rate coefficient.\n  - $L$: Characteristic length scale of the tissue domain.\n- **Nondimensionalization Scalings:**\n  - $c = c_0 \\tilde{c}$, where $c_0$ is a characteristic concentration.\n  - $\\mathbf{x} = L \\tilde{\\mathbf{x}}$.\n  - $t = \\tau \\tilde{t}$, where $\\tau$ is chosen to be the diffusive timescale.\n- **Numerical Values for Calculation:**\n  - $L = 500~\\mu\\mathrm{m}$\n  - $D = 2 \\times 10^{-10}~\\mathrm{m}^2\\,\\mathrm{s}^{-1}$\n  - $k = 1 \\times 10^{-3}~\\mathrm{s}^{-1}$\n  - $\\lambda = 5 \\times 10^{-4}~\\mathrm{s}^{-1}$\n- **Tasks:**\n  1. Nondimensionalize the governing equation.\n  2. Identify two independent, interpretable dimensionless groups.\n  3. Interpret the meaning of these groups for multiscale modeling regime selection.\n  4. Compute the numerical values of these two groups, denoted $(\\mathrm{Da}, \\Lambda)$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded:** The governing equation is a standard linear reaction-diffusion equation, a cornerstone of modeling transport phenomena in physics, chemistry, and biology. The concepts of Fickian diffusion, first-order reaction/clearance, and homogenization are well-established scientific principles. The problem is firmly grounded in the field of computational systems biology.\n- **Well-Posed:** The problem is a well-defined mathematical task. It provides a PDE and a clear set of instructions for analysis (nondimensionalization, identification of parameters, interpretation, and calculation). It provides all necessary data for the numerical part.\n- **Objective:** The language is precise and quantitative. The terms are standard in the field and their definitions are provided. The tasks are objective and do not involve subjective judgment.\n\n### Step 3: Verdict and Action\nThe problem is valid as it is scientifically sound, well-posed, and objective. There are no contradictions, missing information, or unsound premises. The process will proceed to a full solution.\n\n### Solution Derivation\n\nThe analysis begins with the nondimensionalization of the governing PDE. We introduce the dimensionless variables $\\tilde{c}$, $\\tilde{\\mathbf{x}}$, and $\\tilde{t}$ as defined by the scalings:\n$c = c_0 \\tilde{c}$\n$\\mathbf{x} = L \\tilde{\\mathbf{x}}$\n$t = \\tau \\tilde{t}$\n\nFrom these scalings, we can transform the derivative operators. The spatial derivatives are transformed using the chain rule. The gradient operator $\\nabla$ with respect to $\\mathbf{x}$ is related to the gradient operator $\\tilde{\\nabla}$ with respect to $\\tilde{\\mathbf{x}}$ as:\n$$ \\nabla = \\frac{\\partial}{\\partial \\mathbf{x}} = \\frac{\\partial \\tilde{\\mathbf{x}}}{\\partial \\mathbf{x}} \\frac{\\partial}{\\partial \\tilde{\\mathbf{x}}} = \\frac{1}{L} \\tilde{\\nabla} $$\nThis implies the Laplacian operator transforms as:\n$$ \\nabla^2 = \\nabla \\cdot \\nabla = \\left(\\frac{1}{L} \\tilde{\\nabla}\\right) \\cdot \\left(\\frac{1}{L} \\tilde{\\nabla}\\right) = \\frac{1}{L^2} \\tilde{\\nabla}^2 $$\nThe time derivative transforms as:\n$$ \\frac{\\partial}{\\partial t} = \\frac{d \\tilde{t}}{d t} \\frac{\\partial}{\\partial \\tilde{t}} = \\frac{1}{\\tau} \\frac{\\partial}{\\partial \\tilde{t}} $$\nSubstituting these transformed operators and the scaled concentration $c = c_0 \\tilde{c}$ into the original PDE:\n$$ \\frac{1}{\\tau} \\frac{\\partial (c_0 \\tilde{c})}{\\partial \\tilde{t}} = D \\left(\\frac{1}{L^2} \\tilde{\\nabla}^2 (c_0 \\tilde{c})\\right) - k(c_0 \\tilde{c}) - \\lambda(c_0 \\tilde{c}) $$\nAssuming the characteristic concentration $c_0$ is a non-zero constant, it can be factored out and cancelled from all terms:\n$$ \\frac{c_0}{\\tau} \\frac{\\partial \\tilde{c}}{\\partial \\tilde{t}} = \\frac{D c_0}{L^2} \\tilde{\\nabla}^2 \\tilde{c} - (k + \\lambda) c_0 \\tilde{c} $$\n$$ \\frac{1}{\\tau} \\frac{\\partial \\tilde{c}}{\\partial \\tilde{t}} = \\frac{D}{L^2} \\tilde{\\nabla}^2 \\tilde{c} - (k + \\lambda) \\tilde{c} $$\nThe problem states that the characteristic timescale $\\tau$ is the diffusive timescale over the length $L$. This timescale is given by $\\tau = L^2/D$. Substituting this into the equation:\n$$ \\frac{1}{(L^2/D)} \\frac{\\partial \\tilde{c}}{\\partial \\tilde{t}} = \\frac{D}{L^2} \\tilde{\\nabla}^2 \\tilde{c} - (k + \\lambda) \\tilde{c} $$\n$$ \\frac{D}{L^2} \\frac{\\partial \\tilde{c}}{\\partial \\tilde{t}} = \\frac{D}{L^2} \\tilde{\\nabla}^2 \\tilde{c} - (k + \\lambda) \\tilde{c} $$\nTo obtain the canonical nondimensional form where the diffusion and time derivative terms have coefficients of $1$, we multiply the entire equation by the factor $L^2/D$:\n$$ \\frac{\\partial \\tilde{c}}{\\partial \\tilde{t}} = \\tilde{\\nabla}^2 \\tilde{c} - \\frac{(k + \\lambda)L^2}{D} \\tilde{c} $$\nThis is the nondimensional form of the governing equation. The dimensionless group $\\frac{(k + \\lambda)L^2}{D}$ governs the strength of the total clearance relative to diffusion.\n\nWe are asked to identify two independent, interpretable dimensionless groups. We can decompose the combined group as follows:\n$$ \\frac{(k + \\lambda)L^2}{D} = \\frac{kL^2}{D} + \\frac{\\lambda L^2}{D} $$\nThe first group, as requested, should capture \"the ratio of reaction to diffusion\". This is the Damköhler number, which compares the characteristic timescale of diffusion ($\\tau_{diff} = L^2/D$) to the characteristic timescale of reaction ($\\tau_{reac} = 1/k$). Associating \"reaction\" with the intrinsic biochemical clearance rate $k$, we define the first group as:\n$$ \\mathrm{Da} \\equiv \\frac{\\tau_{diff}}{\\tau_{reac}} = \\frac{kL^2}{D} $$\nThe second group should measure \"the relative strength of cellular uptake to intrinsic biochemical clearance\". This is the ratio of their respective rate coefficients, $\\lambda$ and $k$. We define this second group, $\\Lambda$, as:\n$$ \\Lambda \\equiv \\frac{\\lambda}{k} $$\nThese two groups, $\\mathrm{Da}$ and $\\Lambda$, are independent and have clear physical interpretations. We can rewrite the nondimensional equation in terms of them:\n$$ \\frac{\\partial \\tilde{c}}{\\partial \\tilde{t}} = \\tilde{\\nabla}^2 \\tilde{c} - \\left(\\frac{kL^2}{D} + \\frac{\\lambda}{k} \\frac{kL^2}{D}\\right) \\tilde{c} $$\n$$ \\frac{\\partial \\tilde{c}}{\\partial \\tilde{t}} = \\tilde{\\nabla}^2 \\tilde{c} - (\\mathrm{Da} + \\Lambda \\mathrm{Da})\\tilde{c} = \\tilde{\\nabla}^2 \\tilde{c} - \\mathrm{Da}(1+\\Lambda)\\tilde{c} $$\nThe composite group $\\mathrm{Da}(1+\\Lambda)$ is the total Damköhler number for the combined clearance process.\n\nNext, we interpret the magnitudes of these groups for multiscale modeling. The term $\\lambda c$ in the original equation is a continuum approximation (homogenization) of discrete uptake events by individual cells. The validity of this approximation depends on whether the signaling molecule diffuses far enough to \"average out\" the discrete nature of the cellular sinks. The characteristic length scale over which concentration gradients decay due to reaction and uptake is the reaction-diffusion length, $L_{rd} = \\sqrt{D/k_{tot}} = \\sqrt{D/(k+\\lambda)}$.\nThe continuum approximation is valid when this length scale is much larger than the characteristic distance between cells, $l_{cell}$. That is, when $L_{rd} \\gg l_{cell}$.\nIn terms of our dimensionless groups:\n$$ L_{rd} = \\sqrt{\\frac{D}{k(1+\\lambda/k)}} = \\sqrt{\\frac{D}{k(1+\\Lambda)}} = \\sqrt{\\frac{L^2 D}{kL^2(1+\\Lambda)}} = L \\sqrt{\\frac{1}{\\mathrm{Da}(1+\\Lambda)}} = \\frac{L}{\\sqrt{\\mathrm{Da}(1+\\Lambda)}} $$\nThe condition for the validity of the continuum model, $L_{rd} \\gg l_{cell}$, becomes $\\frac{L}{\\sqrt{\\mathrm{Da}(1+\\Lambda)}} \\gg l_{cell}$, or rearranged, $\\mathrm{Da}(1+\\Lambda) \\ll \\left(\\frac{L}{l_{cell}}\\right)^2$.\n- If $\\mathrm{Da}(1+\\Lambda)$ is small, diffusion dominates clearance. $L_{rd}$ is large, meaning a molecule diffuses past many cells before being cleared. The concentration field is smooth, and the homogenized continuum model is appropriate.\n- If $\\mathrm{Da}(1+\\Lambda)$ is large, clearance dominates diffusion. $L_{rd}$ is small. If $L_{rd}$ becomes comparable to or smaller than the intercellular distance $l_{cell}$, the concentration field will exhibit sharp gradients around each cell. The discrete nature of the sinks is critical, and the continuum approximation fails. In this regime, a discrete (e.g., agent-based) or hybrid model, where cells are explicitly represented, is required.\nThe group $\\Lambda = \\lambda/k$ indicates the dominant clearance mechanism. If $\\Lambda \\gg 1$, cellular uptake is dominant, and correctly modeling it (continuum vs. discrete) is critical. If $\\Lambda \\ll 1$, intrinsic degradation dominates, and the details of the uptake model may be less important.\n\nFinally, we compute the numerical values for the two identified groups.\nGiven parameters:\n$L = 500~\\mu\\mathrm{m} = 5 \\times 10^{-4}~\\mathrm{m}$\n$D = 2 \\times 10^{-10}~\\mathrm{m}^2\\,\\mathrm{s}^{-1}$\n$k = 1 \\times 10^{-3}~\\mathrm{s}^{-1}$\n$\\lambda = 5 \\times 10^{-4}~\\mathrm{s}^{-1}$\n\nCalculation of the Damköhler number, $\\mathrm{Da}$:\n$$ \\mathrm{Da} = \\frac{kL^2}{D} = \\frac{(1 \\times 10^{-3}~\\mathrm{s}^{-1})(5 \\times 10^{-4}~\\mathrm{m})^2}{2 \\times 10^{-10}~\\mathrm{m}^2\\,\\mathrm{s}^{-1}} $$\n$$ \\mathrm{Da} = \\frac{(1 \\times 10^{-3})(25 \\times 10^{-8})}{2 \\times 10^{-10}} = \\frac{25 \\times 10^{-11}}{2 \\times 10^{-10}} = \\frac{2.5 \\times 10^{-10}}{2 \\times 10^{-10}} = 1.25 $$\nCalculation of the uptake-to-clearance ratio, $\\Lambda$:\n$$ \\Lambda = \\frac{\\lambda}{k} = \\frac{5 \\times 10^{-4}~\\mathrm{s}^{-1}}{1 \\times 10^{-3}~\\mathrm{s}^{-1}} = 0.5 $$\nThe problem requires rounding the answers to four significant figures.\n$\\mathrm{Da} = 1.250$\n$\\Lambda = 0.5000$\n\nThe final values for the two dimensionless groups are $(\\mathrm{Da}, \\Lambda) = (1.250, 0.5000)$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.250 & 0.5000\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "The validity of any computational model of a physical system rests on its adherence to fundamental conservation laws. Before implementing a numerical scheme, it is essential to confirm that the underlying mathematical formulation is self-consistent and correctly accounts for all sources and sinks. This exercise challenges you to rigorously derive the global mass balance for a system where a diffusing ligand is consumed by discrete cellular sinks, proving from first principles that mass is perfectly conserved . This analytical result serves as a critical benchmark for verifying the accuracy of numerical solvers.",
            "id": "3330684",
            "problem": "A diffusible signaling ligand with concentration field $c(\\mathbf{x}, t)$ evolves in a bounded tissue domain $\\Omega \\subset \\mathbb{R}^{3}$ with boundary $\\partial \\Omega$ over a time interval from $t_{0}$ to $t_{1} = t_{0} + \\Delta t$. The ligand is transported by diffusion with diffusivity $D > 0$ in the interstitial space and is removed by $N$ discrete cells at fixed positions $\\{\\mathbf{x}_{i}\\}_{i=1}^{N}$, each acting as a localized sink. The governing local conservation law for $c(\\mathbf{x}, t)$ is coupled to Fickian transport and the discrete sinks as follows: the flux is $\\mathbf{J}(\\mathbf{x}, t) = -D \\nabla c(\\mathbf{x}, t)$ and the boundary satisfies a homogeneous Neumann condition (no-flux), $\\mathbf{J}(\\mathbf{x}, t) \\cdot \\mathbf{n}(\\mathbf{x}) = 0$ for all $\\mathbf{x} \\in \\partial \\Omega$ and all $t \\in [t_{0}, t_{1}]$. Each cell $i$ removes ligand at a rate proportional to the local concentration evaluated at the cell position, with coefficient $\\kappa_{i} > 0$, represented as a distributional sink term $-\\kappa_{i} c(\\mathbf{x}_{i}, t) \\delta(\\mathbf{x} - \\mathbf{x}_{i})$. Assume that $c(\\mathbf{x}, t)$ is sufficiently smooth in $\\Omega \\setminus \\{\\mathbf{x}_{i}\\}$ and bounded, and that all integrals below are well-defined in the sense of distributions.\n\nLet the total ligand mass be $M(t) = \\int_{\\Omega} c(\\mathbf{x}, t) \\, d\\mathbf{x}$. Starting from first principles, namely the local conservation law for a transported scalar coupled to Fick’s law and the divergence theorem, rigorously derive the global mass balance over $[t_{0}, t_{1}]$ for this hybrid representation. Define the mass-balance residual over the simulation interval as\n$$\nR(\\Delta t) \\equiv M(t_{1}) - M(t_{0}) \\;+\\; \\int_{t_{0}}^{t_{1}} \\int_{\\partial \\Omega} \\mathbf{J}(\\mathbf{x}, t) \\cdot \\mathbf{n}(\\mathbf{x}) \\, dS \\, dt \\;+\\; \\sum_{i=1}^{N} \\int_{t_{0}}^{t_{1}} \\kappa_{i} \\, c(\\mathbf{x}_{i}, t) \\, dt .\n$$\nCompute $R(\\Delta t)$ exactly in closed form under the stated assumptions. Your final answer must be a single exact value or expression. Do not assume spatial uniformity of $c(\\mathbf{x}, t)$. You may use only foundational definitions and the property of the Dirac delta distribution that for any sufficiently regular test function $\\varphi$, $\\int_{\\Omega} \\delta(\\mathbf{x} - \\mathbf{x}_{i}) \\, \\varphi(\\mathbf{x}) \\, d\\mathbf{x} = \\varphi(\\mathbf{x}_{i})$. No numerical rounding is required. Express your final answer without units.",
            "solution": "The problem is deemed valid as it is scientifically grounded, well-posed, and objective. It presents a standard problem in transport phenomena and asks for a rigorous derivation of a fundamental conservation principle.\n\nThe starting point for the derivation is the local conservation law for the scalar concentration field $c(\\mathbf{x}, t)$. The general form of this law states that the rate of change of the concentration at a point is a balance between the divergence of the flux and the local sources or sinks. Mathematically, this is expressed as:\n$$\n\\frac{\\partial c(\\mathbf{x}, t)}{\\partial t} + \\nabla \\cdot \\mathbf{J}(\\mathbf{x}, t) = S(\\mathbf{x}, t)\n$$\nwhere $S(\\mathbf{x}, t)$ is the net rate of production of the substance per unit volume.\n\nIn this problem, the flux is given by Fick's law, $\\mathbf{J}(\\mathbf{x}, t) = -D \\nabla c(\\mathbf{x}, t)$, where $D$ is the constant diffusivity. The source/sink term $S(\\mathbf{x}, t)$ represents the removal of the ligand by $N$ discrete cells, which are modeled as point sinks. The total sink term is the sum of the individual contributions:\n$$\nS(\\mathbf{x}, t) = -\\sum_{i=1}^{N} \\kappa_{i} c(\\mathbf{x}_{i}, t) \\delta(\\mathbf{x} - \\mathbf{x}_{i})\n$$\nwhere $\\delta(\\mathbf{x} - \\mathbf{x}_{i})$ is the Dirac delta distribution centered at the position of the $i$-th cell, $\\mathbf{x}_{i}$.\n\nSubstituting the expressions for the flux and the sink term into the local conservation law yields the governing partial differential equation (PDE) for the concentration field $c(\\mathbf{x}, t)$:\n$$\n\\frac{\\partial c(\\mathbf{x}, t)}{\\partial t} + \\nabla \\cdot (-D \\nabla c(\\mathbf{x}, t)) = -\\sum_{i=1}^{N} \\kappa_{i} c(\\mathbf{x}_{i}, t) \\delta(\\mathbf{x} - \\mathbf{x}_{i})\n$$\nSince $D$ is a positive constant, this can be written as:\n$$\n\\frac{\\partial c(\\mathbf{x}, t)}{\\partial t} - D \\nabla^2 c(\\mathbf{x}, t) = -\\sum_{i=1}^{N} \\kappa_{i} c(\\mathbf{x}_{i}, t) \\delta(\\mathbf{x} - \\mathbf{x}_{i})\n$$\n\nTo obtain the global mass balance, we integrate this PDE over the entire spatial domain $\\Omega$:\n$$\n\\int_{\\Omega} \\frac{\\partial c(\\mathbf{x}, t)}{\\partial t} \\, d\\mathbf{x} + \\int_{\\Omega} \\nabla \\cdot \\mathbf{J}(\\mathbf{x}, t) \\, d\\mathbf{x} = \\int_{\\Omega} \\left( -\\sum_{i=1}^{N} \\kappa_{i} c(\\mathbf{x}_{i}, t) \\delta(\\mathbf{x} - \\mathbf{x}_{i}) \\right) d\\mathbf{x}\n$$\n\nWe analyze each term of this integrated equation.\nThe first term on the left-hand side can be rewritten by interchanging the order of differentiation and integration (by Leibniz integral rule, as the domain $\\Omega$ is fixed), which gives the rate of change of the total mass $M(t)$:\n$$\n\\int_{\\Omega} \\frac{\\partial c(\\mathbf{x}, t)}{\\partial t} \\, d\\mathbf{x} = \\frac{d}{dt} \\int_{\\Omega} c(\\mathbf{x}, t) \\, d\\mathbf{x} = \\frac{dM(t)}{dt}\n$$\nThe second term on the left-hand side is transformed using the divergence theorem (Gauss's theorem), which relates a volume integral of a divergence to a surface integral of the vector field over the boundary $\\partial \\Omega$:\n$$\n\\int_{\\Omega} \\nabla \\cdot \\mathbf{J}(\\mathbf{x}, t) \\, d\\mathbf{x} = \\int_{\\partial \\Omega} \\mathbf{J}(\\mathbf{x}, t) \\cdot \\mathbf{n}(\\mathbf{x}) \\, dS\n$$\nwhere $\\mathbf{n}(\\mathbf{x})$ is the outward unit normal vector to the surface $\\partial \\Omega$ at point $\\mathbf{x}$.\n\nThe term on the right-hand side is evaluated using the sifting property of the Dirac delta distribution. We can interchange the summation and integration:\n$$\n\\int_{\\Omega} \\left( -\\sum_{i=1}^{N} \\kappa_{i} c(\\mathbf{x}_{i}, t) \\delta(\\mathbf{x} - \\mathbf{x}_{i}) \\right) d\\mathbf{x} = -\\sum_{i=1}^{N} \\kappa_{i} c(\\mathbf{x}_{i}, t) \\int_{\\Omega} \\delta(\\mathbf{x} - \\mathbf{x}_{i}) \\, d\\mathbf{x}\n$$\nSince each cell position $\\mathbf{x}_{i}$ is within the domain $\\Omega$, the integral $\\int_{\\Omega} \\delta(\\mathbf{x} - \\mathbf{x}_{i}) \\, d\\mathbf{x} = 1$. The expression simplifies to:\n$$\n-\\sum_{i=1}^{N} \\kappa_{i} c(\\mathbf{x}_{i}, t)\n$$\nNote that the problem statement provided the more general property $\\int_{\\Omega} \\delta(\\mathbf{x} - \\mathbf{x}_{i}) \\varphi(\\mathbf{x}) d\\mathbf{x} = \\varphi(\\mathbf{x}_{i})$. Setting the test function $\\varphi(\\mathbf{x})$ to be the constant function $1$ yields the result used here.\n\nAssembling these results, we obtain the ordinary differential equation for the total mass $M(t)$:\n$$\n\\frac{dM(t)}{dt} + \\int_{\\partial \\Omega} \\mathbf{J}(\\mathbf{x}, t) \\cdot \\mathbf{n}(\\mathbf{x}) \\, dS = -\\sum_{i=1}^{N} \\kappa_{i} c(\\mathbf{x}_{i}, t)\n$$\nThis equation represents the instantaneous global mass balance: the rate of change of total mass plus the rate of mass efflux through the boundary equals the total rate of mass removal by the sinks.\n\nTo find the balance over the time interval $[t_{0}, t_{1}]$, we integrate this equation with respect to time from $t_{0}$ to $t_{1}$:\n$$\n\\int_{t_{0}}^{t_{1}} \\frac{dM(t)}{dt} \\, dt + \\int_{t_{0}}^{t_{1}} \\left( \\int_{\\partial \\Omega} \\mathbf{J}(\\mathbf{x}, t) \\cdot \\mathbf{n}(\\mathbf{x}) \\, dS \\right) dt = \\int_{t_{0}}^{t_{1}} \\left( -\\sum_{i=1}^{N} \\kappa_{i} c(\\mathbf{x}_{i}, t) \\right) dt\n$$\nBy the fundamental theorem of calculus, the first term is $M(t_{1}) - M(t_{0})$. We can also interchange the sum and integral in the right-hand side term. This gives:\n$$\nM(t_{1}) - M(t_{0}) + \\int_{t_{0}}^{t_{1}} \\int_{\\partial \\Omega} \\mathbf{J}(\\mathbf{x}, t) \\cdot \\mathbf{n}(\\mathbf{x}) \\, dS \\, dt = -\\sum_{i=1}^{N} \\int_{t_{0}}^{t_{1}} \\kappa_{i} c(\\mathbf{x}_{i}, t) \\, dt\n$$\nRearranging this equation by moving all terms to one side, we obtain the integral form of the global mass balance:\n$$\nM(t_{1}) - M(t_{0}) + \\int_{t_{0}}^{t_{1}} \\int_{\\partial \\Omega} \\mathbf{J}(\\mathbf{x}, t) \\cdot \\mathbf{n}(\\mathbf{x}) \\, dS \\, dt + \\sum_{i=1}^{N} \\int_{t_{0}}^{t_{1}} \\kappa_{i} c(\\mathbf{x}_{i}, t) \\, dt = 0\n$$\nThe problem defines the mass-balance residual $R(\\Delta t)$ as:\n$$\nR(\\Delta t) \\equiv M(t_{1}) - M(t_{0}) + \\int_{t_{0}}^{t_{1}} \\int_{\\partial \\Omega} \\mathbf{J}(\\mathbf{x}, t) \\cdot \\mathbf{n}(\\mathbf{x}) \\, dS \\, dt + \\sum_{i=1}^{N} \\int_{t_{0}}^{t_{1}} \\kappa_{i} c(\\mathbf{x}_{i}, t) \\, dt\n$$\nBy direct comparison, the expression defining $R(\\Delta t)$ is precisely the left-hand side of our derived global mass balance equation. Therefore, the value of the residual must be exactly zero, as a direct consequence of the local conservation law.\n\nThis derivation holds irrespective of the specific boundary conditions. However, the problem provides the homogeneous Neumann (no-flux) condition, $\\mathbf{J}(\\mathbf{x}, t) \\cdot \\mathbf{n}(\\mathbf{x}) = 0$. This implies that the boundary flux term in the definition of $R(\\Delta t)$ is independently zero:\n$$\n\\int_{t_{0}}^{t_{1}} \\int_{\\partial \\Omega} \\mathbf{J}(\\mathbf{x}, t) \\cdot \\mathbf{n}(\\mathbf{x}) \\, dS \\, dt = \\int_{t_{0}}^{t_{1}} \\int_{\\partial \\Omega} 0 \\, dS \\, dt = 0\n$$\nThe derived identity remains $0 + 0 = 0$, confirming the result. Thus, the mass-balance residual for this analytically-defined system is identically zero.\n$$\nR(\\Delta t) = 0\n$$",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "Bridging the gap between stochastic, discrete-molecule simulations at the cellular scale and deterministic, continuum models at the tissue scale is a central challenge in hybrid modeling. The key to a stable and accurate coupling lies in ensuring that fundamental quantities, like mass, are conserved across the interface between the different model domains. This hands-on coding exercise requires you to design and implement a mass-conserving exchange mechanism between a central stochastic compartment and its surrounding deterministic, continuum environment, translating Fick's law of diffusion into a set of rules compatible with both simulation paradigms .",
            "id": "3330619",
            "problem": "Consider a one-dimensional tissue segment composed of a central compartment that uses Gillespie’s Stochastic Simulation Algorithm (SSA) and exterior regions that are modeled by a diffusion-decay partial differential equation. The central stochastic compartment of length $L_s$ contains a discrete number of molecules $N_s$ and is flanked on both sides by two exterior finite-volume cells of equal width $h$ with concentrations $c_L$ (left cell) and $c_R$ (right cell). Molecular exchange occurs only via diffusion between the central compartment and the immediate exterior cells; the exterior domain evolves via diffusion and linear decay, and the central compartment evolves via SSA reactions.\n\nThe exterior dynamics are governed by the diffusion-decay equation\n$$\n\\partial_t c = D \\,\\partial_{xx} c - k\\, c\n$$,\nwhere $D$ is the diffusion coefficient and $k$ is the first-order decay rate. The SSA compartment maps its discrete molecule count $N_s$ to a concentration via $c_s = N_s/L_s$. Let $A$ denote the cross-sectional area, and for this problem take $A = 1$ for simplicity. The exchange across each interface obeys Fick’s law. Approximating gradients across faces by central differences between cell centers, the face-to-the-right flux $F$ across the left interface (between the left cell and the central compartment) is\n$$\nF_{\\text{left}} = - D \\,\\frac{c_s - c_L}{d},\n$$\nand across the right interface (between the central compartment and the right cell) is\n$$\nF_{\\text{right}} = - D \\,\\frac{c_R - c_s}{d},\n$$\nwhere $d = \\tfrac{1}{2}(h + L_s)$ is the distance between the respective cell centers. By convention, a positive $F$ denotes flux to the right. The finite-volume updates for the exterior cells over a single time step $\\Delta t$ with zero-flux outer boundaries are\n$$\nc_L^{n+1} = c_L^n - \\frac{\\Delta t}{h}\\,F_{\\text{left}} - k\\,c_L^n\\,\\Delta t,\n\\quad\nc_R^{n+1} = c_R^n + \\frac{\\Delta t}{h}\\,F_{\\text{right}} - k\\,c_R^n\\,\\Delta t.\n$$\nLet $\\Delta N_{\\text{rxn}}$ be the net number of molecules created (positive) or consumed (negative) by SSA reactions in the central compartment during the time step $\\Delta t$. The total diffusive exchange into the SSA compartment over $\\Delta t$ must be computed to maintain detailed mass balance. You must derive and implement the mass-conserving exchange update for the SSA compartment $N_s$ using the above fundamental laws and definitions, so that the sum of mass changes in all three compartments over $\\Delta t$ equals the sum of SSA reaction production and exterior decay loss.\n\nAll quantities carry the following units and must be treated consistently: $D$ in $\\mu\\text{m}^2/\\text{s}$, $k$ in $\\text{s}^{-1}$, $h$ and $L_s$ in $\\mu\\text{m}$, $c$ in molecules$/\\mu\\text{m}$, $N_s$ in molecules, and $\\Delta t$ in $\\text{s}$. Express any molecule counts as real-valued floats (not rounded) and any concentrations in molecules$/\\mu\\text{m}$.\n\nYour program must, for each test case below, compute over a single time step $\\Delta t$:\n- the net diffusive exchange into the SSA compartment $\\Delta N_{\\text{ex}}$ in molecules,\n- the updated SSA molecule count $N_s^{n+1}$ in molecules,\n- the updated exterior concentrations $c_L^{n+1}$ and $c_R^{n+1}$ in molecules$/\\mu\\text{m}$,\n- the mass-balance residual defined as\n$$\n\\text{residual} = \\Big( N_s^{n+1} + h\\,c_L^{n+1} + h\\,c_R^{n+1} \\Big) - \\Big( N_s^n + h\\,c_L^n + h\\,c_R^n \\Big) - \\Big( \\Delta N_{\\text{rxn}} - k\\,\\Delta t\\,h\\,(c_L^n + c_R^n) \\Big),\n$$\nwhich should be numerically close to $0$ if the exchange is implemented correctly.\n\nUse the following test suite, which explores a happy path, symmetry, no-diffusion, and asymmetric geometry conditions:\n- Test $1$: $D = 10$, $k = 0.05$, $h = 5$, $L_s = 5$, $\\Delta t = 0.1$, $N_s = 500$, $c_L = 140$, $c_R = 80$, $\\Delta N_{\\text{rxn}} = 0$.\n- Test $2$: $D = 10$, $k = 0.1$, $h = 5$, $L_s = 5$, $\\Delta t = 0.1$, $N_s = 500$, $c_L = 100$, $c_R = 100$, $\\Delta N_{\\text{rxn}} = 10$.\n- Test $3$: $D = 0$, $k = 0$, $h = 5$, $L_s = 5$, $\\Delta t = 0.1$, $N_s = 500$, $c_L = 120$, $c_R = 80$, $\\Delta N_{\\text{rxn}} = -5$.\n- Test $4$: $D = 20$, $k = 0$, $h = 10$, $L_s = 2$, $\\Delta t = 0.05$, $N_s = 200$, $c_L = 50$, $c_R = 200$, $\\Delta N_{\\text{rxn}} = 0$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must concatenate, in order for each test case, the five floats $[\\Delta N_{\\text{ex}}, N_s^{n+1}, c_L^{n+1}, c_R^{n+1}, \\text{residual}]$. For all numerical outputs, use raw floating-point numbers (no percentage signs), and ensure units are as specified above.",
            "solution": "The core requirement is to design a mathematically consistent coupling between a stochastic compartment and surrounding deterministic diffusion-decay exterior, guaranteeing detailed mass balance over a time step $\\Delta t$. We ground the derivation in the following principles:\n- Fick’s law of diffusion: the flux $J$ is $J = -D\\,\\partial_x c$.\n- Finite-volume conservation: the change in the average concentration in a cell equals the net flux through its boundaries divided by its volume (here in one dimension with cross-sectional area set to $1$, volume reduces to length $h$), minus any reaction terms.\n- Mapping between discrete molecules and concentration within the SSA compartment: $c_s = N_s/L_s$.\n\nWe discretize the exterior by two finite-volume cells adjacent to the central SSA compartment: a left cell with average concentration $c_L$ and a right cell with average concentration $c_R$. The distance between the left cell center and the SSA center, and between the SSA center and the right cell center, is modeled by $d = \\tfrac{1}{2}(h + L_s)$, assuming uniform properties and linear concentration profiles across each interface region.\n\nUsing central differences for the gradient across the left interface (left cell center to SSA center), the face-to-the-right flux is\n$$\nF_{\\text{left}} = -D\\,\\frac{c_s - c_L}{d}.\n$$\nA positive $F_{\\text{left}}$ indicates net flow from the left cell into the SSA compartment (to the right across the left face). Across the right interface (SSA center to right cell center), the face-to-the-right flux is\n$$\nF_{\\text{right}} = -D\\,\\frac{c_R - c_s}{d}.\n$$\nA positive $F_{\\text{right}}$ indicates net flow from the SSA compartment into the right exterior cell (to the right across the right face).\n\nFor each exterior cell, finite-volume conservation in one dimension with zero-flux outer boundaries gives, over a single time step $\\Delta t$,\n$$\nc_L^{n+1} = c_L^n - \\frac{\\Delta t}{h}\\,F_{\\text{left}} - k\\,c_L^n\\,\\Delta t,\n$$\n$$\nc_R^{n+1} = c_R^n + \\frac{\\Delta t}{h}\\,F_{\\text{right}} - k\\,c_R^n\\,\\Delta t.\n$$\nThe signs follow from the standard update $c_i^{n+1} = c_i^n - (\\Delta t/h)\\,(F_{i+1/2} - F_{i-1/2}) - k\\,c_i^n\\,\\Delta t$ with $F_{L-1/2} = 0$ and $F_{R+1/2} = 0$.\n\nThe SSA compartment must receive the net diffusive exchange equal to the sum of inflows from the left interface and from the right interface (taken with appropriate signs to represent inflow to SSA). Inflow to SSA from the left interface equals $+\\Delta t\\,F_{\\text{left}}$ (positive flux to the right across the left face moves molecules from the left cell into SSA). Inflow to SSA from the right interface equals $-\\Delta t\\,F_{\\text{right}}$ (a positive flux to the right across the right face moves molecules from SSA into the right cell, which is an outflow from SSA; hence inflow is minus that). Therefore, the net diffusive exchange into SSA is\n$$\n\\Delta N_{\\text{ex}} = \\Delta t\\,\\Big(F_{\\text{left}} - F_{\\text{right}}\\Big).\n$$\nLet $\\Delta N_{\\text{rxn}}$ denote the net molecules produced (positive) or consumed (negative) by SSA reactions during the time step $\\Delta t$. The SSA compartment update is then\n$$\nN_s^{n+1} = N_s^n + \\Delta N_{\\text{rxn}} + \\Delta N_{\\text{ex}}.\n$$\nBy construction, detailed mass balance is preserved across the interfaces because the net mass change in the exterior due to interface fluxes equals $-\\Delta N_{\\text{ex}}$:\n$$\n\\Delta M_{\\text{ext, interface}} = h\\,(c_L^{n+1} - c_L^n)_{\\text{interface}} + h\\,(c_R^{n+1} - c_R^n)_{\\text{interface}} = -\\Delta t\\,F_{\\text{left}} + \\Delta t\\,F_{\\text{right}} = -\\Delta N_{\\text{ex}}.\n$$\nThus, summing all compartments, the only net mass creation or loss arises from SSA reactions inside the central compartment and exterior decay in the exterior cells:\n$$\n\\Big(N_s^{n+1} + h\\,c_L^{n+1} + h\\,c_R^{n+1}\\Big) - \\Big(N_s^n + h\\,c_L^n + h\\,c_R^n\\Big) = \\Delta N_{\\text{rxn}} - k\\,\\Delta t\\,h\\,(c_L^n + c_R^n).\n$$\nTo numerically verify mass conservation, we compute the residual\n$$\n\\text{residual} = \\Big( N_s^{n+1} + h\\,c_L^{n+1} + h\\,c_R^{n+1} \\Big) - \\Big( N_s^n + h\\,c_L^n + h\\,c_R^n \\Big) - \\Big( \\Delta N_{\\text{rxn}} - k\\,\\Delta t\\,h\\,(c_L^n + c_R^n) \\Big),\n$$\nwhich should evaluate to $0$ up to floating-point roundoff.\n\nAlgorithmic steps for each test case:\n- Compute $c_s = N_s/L_s$ and $d = \\tfrac{1}{2}(h + L_s)$.\n- Compute $F_{\\text{left}}$ and $F_{\\text{right}}$ using the above formulas.\n- Compute $\\Delta N_{\\text{ex}} = \\Delta t\\,(F_{\\text{left}} - F_{\\text{right}})$.\n- Update $N_s^{n+1}$ using $N_s^{n+1} = N_s^n + \\Delta N_{\\text{rxn}} + \\Delta N_{\\text{ex}}$.\n- Update exterior concentrations:\n  $c_L^{n+1} = c_L^n - (\\Delta t/h)\\,F_{\\text{left}} - k\\,c_L^n\\,\\Delta t$ and\n  $c_R^{n+1} = c_R^n + (\\Delta t/h)\\,F_{\\text{right}} - k\\,c_R^n\\,\\Delta t$.\n- Compute the residual to verify mass balance.\n\nThe explicit scheme is scientifically realistic and stable for the provided time steps and parameters (e.g., with $D$ and $h$ chosen such that $\\Delta t/h^2$ remains small), and uses only fundamental laws without shortcut formulas. The program outputs, for each test case, the five floats in the order $[\\Delta N_{\\text{ex}}, N_s^{n+1}, c_L^{n+1}, c_R^{n+1}, \\text{residual}]$, concatenated across all test cases into a single bracketed list on one line, as required.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef hybrid_step(D, k, h, Ls, dt, Ns, cL, cR, dN_rxn):\n    \"\"\"\n    Perform one hybrid step coupling a central SSA compartment and two exterior PDE cells.\n    Units:\n      D: um^2/s\n      k: 1/s\n      h, Ls: um\n      dt: s\n      Ns: molecules\n      cL, cR: molecules/um\n      dN_rxn: molecules\n    Returns:\n      (dN_ex, Ns_new, cL_new, cR_new, residual)\n    \"\"\"\n    # Map SSA molecules to concentration in the compartment\n    cs = Ns / Ls\n    # Distance between centers across each interface\n    d = 0.5 * (h + Ls)\n\n    # Face-to-the-right fluxes by Fick's law (central differences)\n    F_left = -D * (cs - cL) / d      # left interface: left cell (cL) to SSA (cs)\n    F_right = -D * (cR - cs) / d     # right interface: SSA (cs) to right cell (cR)\n\n    # Net diffusive exchange into SSA (in molecules) over dt\n    dN_ex = dt * (F_left - F_right)\n\n    # Update SSA molecule count with reactions and exchange\n    Ns_new = Ns + dN_rxn + dN_ex\n\n    # Exterior updates via finite volume with zero outer fluxes\n    cL_new = cL - (dt / h) * F_left - k * cL * dt\n    cR_new = cR + (dt / h) * F_right - k * cR * dt\n\n    # Mass-balance residual check (should be ~0)\n    M_before = Ns + h * (cL + cR)\n    M_after = Ns_new + h * (cL_new + cR_new)\n    predicted_change = dN_rxn - k * dt * h * (cL + cR)\n    residual = M_after - M_before - predicted_change\n\n    return dN_ex, Ns_new, cL_new, cR_new, residual\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (D, k, h, Ls, dt, Ns, cL, cR, dN_rxn)\n    test_cases = [\n        (10.0, 0.05, 5.0, 5.0, 0.1, 500.0, 140.0, 80.0, 0.0),    # Test 1\n        (10.0, 0.1, 5.0, 5.0, 0.1, 500.0, 100.0, 100.0, 10.0),   # Test 2\n        (0.0, 0.0, 5.0, 5.0, 0.1, 500.0, 120.0, 80.0, -5.0),     # Test 3\n        (20.0, 0.0, 10.0, 2.0, 0.05, 200.0, 50.0, 200.0, 0.0),   # Test 4\n    ]\n\n    results = []\n    for case in test_cases:\n        D, k, h, Ls, dt, Ns, cL, cR, dN_rxn = case\n        dN_ex, Ns_new, cL_new, cR_new, residual = hybrid_step(D, k, h, Ls, dt, Ns, cL, cR, dN_rxn)\n        # Append results in required flat order for each test case\n        results.extend([dN_ex, Ns_new, cL_new, cR_new, residual])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}