{
    "hands_on_practices": [
        {
            "introduction": "The first decision in building a multiscale model is selecting the right level of detail. For example, should cellular processes be averaged into a continuum description, or must they be modeled as discrete events? This exercise  demonstrates how to answer this question using nondimensionalization, a foundational technique in physical modeling. By deriving and interpreting key dimensionless groups, you can compare the characteristic timescales of diffusion, reaction, and cellular uptake to make a principled choice about the model's structure.",
            "id": "3330669",
            "problem": "Consider a hybrid multiscale model for a diffusing signaling molecule with concentration field $c(\\mathbf{x},t)$ in a three-dimensional tissue domain with characteristic length scale $L$. At the tissue scale, the concentration evolves according to mass conservation and Fickian diffusion, with a linear clearance due to biochemical degradation and cellular uptake. The macroscopic dynamics are represented by the partial differential equation (PDE)\n$$\n\\partial_t c(\\mathbf{x},t) = D \\nabla^2 c(\\mathbf{x},t) - k\\,c(\\mathbf{x},t) - \\lambda\\,c(\\mathbf{x},t)\n$$\nwhere $D$ is the diffusion coefficient, $k$ is the intrinsic first-order biochemical clearance rate, and $\\lambda$ is an effective first-order uptake rate coefficient that aggregates discrete cell-level uptake events occurring at rate $\\lambda$ per cell into a continuum sink term under a homogenization assumption.\n\nStarting from conservation of mass and Fick's law of diffusion, nondimensionalize this equation using the scalings $c = c_0 \\tilde{c}$, $\\mathbf{x} = L \\tilde{\\mathbf{x}}$, and $t = \\tau \\tilde{t}$, where $\\tau$ is chosen to be the diffusive timescale. Identify two independent, interpretable dimensionless groups that control the balance of processes: one capturing the ratio of reaction to diffusion over the domain scale and one measuring the relative strength of cellular uptake to intrinsic biochemical clearance. Then, interpret how the magnitudes of these groups inform regime selection for multiscale hybrid modeling, specifically whether a continuum approximation of uptake is appropriate or whether discrete event-based modeling at the cell scale is warranted.\n\nFor a tissue slab with parameters $L = 500~\\mu\\mathrm{m}$, $D = 2 \\times 10^{-10}~\\mathrm{m}^2\\,\\mathrm{s}^{-1}$, $k = 1 \\times 10^{-3}~\\mathrm{s}^{-1}$, and $\\lambda = 5 \\times 10^{-4}~\\mathrm{s}^{-1}$, compute the two dimensionless groups you identified. Express the final values as dimensionless numbers and round your answer to four significant figures. Report your final numeric values for the two dimensionless groups in a single row matrix in the order $(\\mathrm{Da}, \\Lambda)$.",
            "solution": "The problem statement is first subjected to validation.\n\n### Step 1: Extract Givens\n- **Governing Equation:** The concentration $c(\\mathbf{x},t)$ of a signaling molecule evolves according to the partial differential equation (PDE):\n$$\n\\partial_t c(\\mathbf{x},t) = D \\nabla^2 c(\\mathbf{x},t) - k\\,c(\\mathbf{x},t) - \\lambda\\,c(\\mathbf{x},t)\n$$\n- **Variable Definitions:**\n  - $c(\\mathbf{x},t)$: Concentration field in a three-dimensional tissue domain.\n  - $\\mathbf{x}$: Position vector.\n  - $t$: Time.\n- **Parameter Definitions:**\n  - $D$: Diffusion coefficient.\n  - $k$: Intrinsic first-order biochemical clearance rate.\n  - $\\lambda$: Effective first-order uptake rate coefficient.\n  - $L$: Characteristic length scale of the tissue domain.\n- **Nondimensionalization Scalings:**\n  - $c = c_0 \\tilde{c}$, where $c_0$ is a characteristic concentration.\n  - $\\mathbf{x} = L \\tilde{\\mathbf{x}}$.\n  - $t = \\tau \\tilde{t}$, where $\\tau$ is chosen to be the diffusive timescale.\n- **Numerical Values for Calculation:**\n  - $L = 500~\\mu\\mathrm{m}$\n  - $D = 2 \\times 10^{-10}~\\mathrm{m}^2\\,\\mathrm{s}^{-1}$\n  - $k = 1 \\times 10^{-3}~\\mathrm{s}^{-1}$\n  - $\\lambda = 5 \\times 10^{-4}~\\mathrm{s}^{-1}$\n- **Tasks:**\n  1. Nondimensionalize the governing equation.\n  2. Identify two independent, interpretable dimensionless groups.\n  3. Interpret the meaning of these groups for multiscale modeling regime selection.\n  4. Compute the numerical values of these two groups, denoted $(\\mathrm{Da}, \\Lambda)$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded:** The governing equation is a standard linear reaction-diffusion equation, a cornerstone of modeling transport phenomena in physics, chemistry, and biology. The concepts of Fickian diffusion, first-order reaction/clearance, and homogenization are well-established scientific principles. The problem is firmly grounded in the field of computational systems biology.\n- **Well-Posed:** The problem is a well-defined mathematical task. It provides a PDE and a clear set of instructions for analysis (nondimensionalization, identification of parameters, interpretation, and calculation). It provides all necessary data for the numerical part.\n- **Objective:** The language is precise and quantitative. The terms are standard in the field and their definitions are provided. The tasks are objective and do not involve subjective judgment.\n\n### Step 3: Verdict and Action\nThe problem is valid as it is scientifically sound, well-posed, and objective. There are no contradictions, missing information, or unsound premises. The process will proceed to a full solution.\n\n### Solution Derivation\n\nThe analysis begins with the nondimensionalization of the governing PDE. We introduce the dimensionless variables $\\tilde{c}$, $\\tilde{\\mathbf{x}}$, and $\\tilde{t}$ as defined by the scalings:\n$c = c_0 \\tilde{c}$\n$\\mathbf{x} = L \\tilde{\\mathbf{x}}$\n$t = \\tau \\tilde{t}$\n\nFrom these scalings, we can transform the derivative operators. The spatial derivatives are transformed using the chain rule. The gradient operator $\\nabla$ with respect to $\\mathbf{x}$ is related to the gradient operator $\\tilde{\\nabla}$ with respect to $\\tilde{\\mathbf{x}}$ as:\n$$ \\nabla = \\frac{\\partial}{\\partial \\mathbf{x}} = \\frac{\\partial \\tilde{\\mathbf{x}}}{\\partial \\mathbf{x}} \\frac{\\partial}{\\partial \\tilde{\\mathbf{x}}} = \\frac{1}{L} \\tilde{\\nabla} $$\nThis implies the Laplacian operator transforms as:\n$$ \\nabla^2 = \\nabla \\cdot \\nabla = \\left(\\frac{1}{L} \\tilde{\\nabla}\\right) \\cdot \\left(\\frac{1}{L} \\tilde{\\nabla}\\right) = \\frac{1}{L^2} \\tilde{\\nabla}^2 $$\nThe time derivative transforms as:\n$$ \\frac{\\partial}{\\partial t} = \\frac{d \\tilde{t}}{d t} \\frac{\\partial}{\\partial \\tilde{t}} = \\frac{1}{\\tau} \\frac{\\partial}{\\partial \\tilde{t}} $$\nSubstituting these transformed operators and the scaled concentration $c = c_0 \\tilde{c}$ into the original PDE:\n$$ \\frac{1}{\\tau} \\frac{\\partial (c_0 \\tilde{c})}{\\partial \\tilde{t}} = D \\left(\\frac{1}{L^2} \\tilde{\\nabla}^2 (c_0 \\tilde{c})\\right) - k(c_0 \\tilde{c}) - \\lambda(c_0 \\tilde{c}) $$\nAssuming the characteristic concentration $c_0$ is a non-zero constant, it can be factored out and cancelled from all terms:\n$$ \\frac{c_0}{\\tau} \\frac{\\partial \\tilde{c}}{\\partial \\tilde{t}} = \\frac{D c_0}{L^2} \\tilde{\\nabla}^2 \\tilde{c} - (k + \\lambda) c_0 \\tilde{c} $$\n$$ \\frac{1}{\\tau} \\frac{\\partial \\tilde{c}}{\\partial \\tilde{t}} = \\frac{D}{L^2} \\tilde{\\nabla}^2 \\tilde{c} - (k + \\lambda) \\tilde{c} $$\nThe problem states that the characteristic timescale $\\tau$ is the diffusive timescale over the length $L$. This timescale is given by $\\tau = L^2/D$. Substituting this into the equation:\n$$ \\frac{1}{(L^2/D)} \\frac{\\partial \\tilde{c}}{\\partial \\tilde{t}} = \\frac{D}{L^2} \\tilde{\\nabla}^2 \\tilde{c} - (k + \\lambda) \\tilde{c} $$\n$$ \\frac{D}{L^2} \\frac{\\partial \\tilde{c}}{\\partial \\tilde{t}} = \\frac{D}{L^2} \\tilde{\\nabla}^2 \\tilde{c} - (k + \\lambda) \\tilde{c} $$\nTo obtain the canonical nondimensional form where the diffusion and time derivative terms have coefficients of $1$, we multiply the entire equation by the factor $L^2/D$:\n$$ \\frac{\\partial \\tilde{c}}{\\partial \\tilde{t}} = \\tilde{\\nabla}^2 \\tilde{c} - \\frac{(k + \\lambda)L^2}{D} \\tilde{c} $$\nThis is the nondimensional form of the governing equation. The dimensionless group $\\frac{(k + \\lambda)L^2}{D}$ governs the strength of the total clearance relative to diffusion.\n\nWe are asked to identify two independent, interpretable dimensionless groups. We can decompose the combined group as follows:\n$$ \\frac{(k + \\lambda)L^2}{D} = \\frac{kL^2}{D} + \\frac{\\lambda L^2}{D} $$\nThe first group, as requested, should capture \"the ratio of reaction to diffusion\". This is the Damköhler number, which compares the characteristic timescale of diffusion ($\\tau_{diff} = L^2/D$) to the characteristic timescale of reaction ($\\tau_{reac} = 1/k$). Associating \"reaction\" with the intrinsic biochemical clearance rate $k$, we define the first group as:\n$$ \\mathrm{Da} \\equiv \\frac{\\tau_{diff}}{\\tau_{reac}} = \\frac{kL^2}{D} $$\nThe second group should measure \"the relative strength of cellular uptake to intrinsic biochemical clearance\". This is the ratio of their respective rate coefficients, $\\lambda$ and $k$. We define this second group, $\\Lambda$, as:\n$$ \\Lambda \\equiv \\frac{\\lambda}{k} $$\nThese two groups, $\\mathrm{Da}$ and $\\Lambda$, are independent and have clear physical interpretations. We can rewrite the nondimensional equation in terms of them:\n$$ \\frac{\\partial \\tilde{c}}{\\partial \\tilde{t}} = \\tilde{\\nabla}^2 \\tilde{c} - \\left(\\frac{kL^2}{D} + \\frac{\\lambda}{k} \\frac{kL^2}{D}\\right) \\tilde{c} $$\n$$ \\frac{\\partial \\tilde{c}}{\\partial \\tilde{t}} = \\tilde{\\nabla}^2 \\tilde{c} - (\\mathrm{Da} + \\Lambda \\mathrm{Da})\\tilde{c} = \\tilde{\\nabla}^2 \\tilde{c} - \\mathrm{Da}(1+\\Lambda)\\tilde{c} $$\nThe composite group $\\mathrm{Da}(1+\\Lambda)$ is the total Damköhler number for the combined clearance process.\n\nNext, we interpret the magnitudes of these groups for multiscale modeling. The term $\\lambda c$ in the original equation is a continuum approximation (homogenization) of discrete uptake events by individual cells. The validity of this approximation depends on whether the signaling molecule diffuses far enough to \"average out\" the discrete nature of the cellular sinks. The characteristic length scale over which concentration gradients decay due to reaction and uptake is the reaction-diffusion length, $L_{rd} = \\sqrt{D/k_{tot}} = \\sqrt{D/(k+\\lambda)}$.\nThe continuum approximation is valid when this length scale is much larger than the characteristic distance between cells, $l_{cell}$. That is, when $L_{rd} \\gg l_{cell}$.\nIn terms of our dimensionless groups:\n$$ L_{rd} = \\sqrt{\\frac{D}{k(1+\\lambda/k)}} = \\sqrt{\\frac{D}{k(1+\\Lambda)}} = \\sqrt{\\frac{L^2 D}{kL^2(1+\\Lambda)}} = L \\sqrt{\\frac{1}{\\mathrm{Da}(1+\\Lambda)}} = \\frac{L}{\\sqrt{\\mathrm{Da}(1+\\Lambda)}} $$\nThe condition for the validity of the continuum model, $L_{rd} \\gg l_{cell}$, becomes $\\frac{L}{\\sqrt{\\mathrm{Da}(1+\\Lambda)}} \\gg l_{cell}$, or rearranged, $\\mathrm{Da}(1+\\Lambda) \\ll \\left(\\frac{L}{l_{cell}}\\right)^2$.\n- If $\\mathrm{Da}(1+\\Lambda)$ is small, diffusion dominates clearance. $L_{rd}$ is large, meaning a molecule diffuses past many cells before being cleared. The concentration field is smooth, and the homogenized continuum model is appropriate.\n- If $\\mathrm{Da}(1+\\Lambda)$ is large, clearance dominates diffusion. $L_{rd}$ is small. If $L_{rd}$ becomes comparable to or smaller than the intercellular distance $l_{cell}$, the concentration field will exhibit sharp gradients around each cell. The discrete nature of the sinks is critical, and the continuum approximation fails. In this regime, a discrete (e.g., agent-based) or hybrid model, where cells are explicitly represented, is required.\nThe group $\\Lambda = \\lambda/k$ indicates the dominant clearance mechanism. If $\\Lambda \\gg 1$, cellular uptake is dominant, and correctly modeling it (continuum vs. discrete) is critical. If $\\Lambda \\ll 1$, intrinsic degradation dominates, and the details of the uptake model may be less important.\n\nFinally, we compute the numerical values for the two identified groups.\nGiven parameters:\n$L = 500~\\mu\\mathrm{m} = 5 \\times 10^{-4}~\\mathrm{m}$\n$D = 2 \\times 10^{-10}~\\mathrm{m}^2\\,\\mathrm{s}^{-1}$\n$k = 1 \\times 10^{-3}~\\mathrm{s}^{-1}$\n$\\lambda = 5 \\times 10^{-4}~\\mathrm{s}^{-1}$\n\nCalculation of the Damköhler number, $\\mathrm{Da}$:\n$$ \\mathrm{Da} = \\frac{kL^2}{D} = \\frac{(1 \\times 10^{-3}~\\mathrm{s}^{-1})(5 \\times 10^{-4}~\\mathrm{m})^2}{2 \\times 10^{-10}~\\mathrm{m}^2\\,\\mathrm{s}^{-1}} $$\n$$ \\mathrm{Da} = \\frac{(1 \\times 10^{-3})(25 \\times 10^{-8})}{2 \\times 10^{-10}} = \\frac{25 \\times 10^{-11}}{2 \\times 10^{-10}} = \\frac{2.5 \\times 10^{-10}}{2 \\times 10^{-10}} = 1.25 $$\nCalculation of the uptake-to-clearance ratio, $\\Lambda$:\n$$ \\Lambda = \\frac{\\lambda}{k} = \\frac{5 \\times 10^{-4}~\\mathrm{s}^{-1}}{1 \\times 10^{-3}~\\mathrm{s}^{-1}} = 0.5 $$\nThe problem requires rounding the answers to four significant figures.\n$\\mathrm{Da} = 1.250$\n$\\Lambda = 0.5000$\n\nThe final values for the two dimensionless groups are $(\\mathrm{Da}, \\Lambda) = (1.250, 0.5000)$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.250  0.5000\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "A core challenge in hybrid modeling is creating a numerically stable and physically accurate interface between the discrete and continuum sub-models. Ensuring that fundamental laws like mass conservation are not violated at this interface is paramount. This practical exercise  guides you in implementing a coupling scheme between a stochastic simulation compartment and a deterministic finite-volume domain. The task emphasizes the careful accounting of molecular flux to maintain exact mass balance, a critical step in verifying any hybrid simulation code.",
            "id": "3330619",
            "problem": "Consider a one-dimensional tissue segment composed of a central compartment that uses Gillespie’s Stochastic Simulation Algorithm (SSA) and exterior regions that are modeled by a diffusion-decay partial differential equation. The central stochastic compartment of length $L_s$ contains a discrete number of molecules $N_s$ and is flanked on both sides by two exterior finite-volume cells of equal width $h$ with concentrations $c_L$ (left cell) and $c_R$ (right cell). Molecular exchange occurs only via diffusion between the central compartment and the immediate exterior cells; the exterior domain evolves via diffusion and linear decay, and the central compartment evolves via SSA reactions.\n\nThe exterior dynamics are governed by the diffusion-decay equation\n$$\n\\partial_t c = D \\,\\partial_{xx} c - k\\, c\n$$\nwhere $D$ is the diffusion coefficient and $k$ is the first-order decay rate. The SSA compartment maps its discrete molecule count $N_s$ to a concentration via $c_s = N_s/L_s$. Let $A$ denote the cross-sectional area, and for this problem take $A = 1$ for simplicity. The exchange across each interface obeys Fick’s law. Approximating gradients across faces by central differences between cell centers, the face-to-the-right flux $F$ across the left interface (between the left cell and the central compartment) is\n$$\nF_{\\text{left}} = - D \\,\\frac{c_s - c_L}{d}\n$$\nand across the right interface (between the central compartment and the right cell) is\n$$\nF_{\\text{right}} = - D \\,\\frac{c_R - c_s}{d}\n$$\nwhere $d = \\tfrac{1}{2}(h + L_s)$ is the distance between the respective cell centers. By convention, a positive $F$ denotes flux to the right. The finite-volume updates for the exterior cells over a single time step $\\Delta t$ with zero-flux outer boundaries are\n$$\nc_L^{n+1} = c_L^n - \\frac{\\Delta t}{h}\\,F_{\\text{left}} - k\\,c_L^n\\,\\Delta t, \\quad c_R^{n+1} = c_R^n + \\frac{\\Delta t}{h}\\,F_{\\text{right}} - k\\,c_R^n\\,\\Delta t\n$$\nLet $\\Delta N_{\\text{rxn}}$ be the net number of molecules created (positive) or consumed (negative) by SSA reactions in the central compartment during the time step $\\Delta t$. The total diffusive exchange into the SSA compartment over $\\Delta t$ must be computed to maintain detailed mass balance. You must derive and implement the mass-conserving exchange update for the SSA compartment $N_s$ using the above fundamental laws and definitions, so that the sum of mass changes in all three compartments over $\\Delta t$ equals the sum of SSA reaction production and exterior decay loss.\n\nAll quantities carry the following units and must be treated consistently: $D$ in $\\mu\\text{m}^2/\\text{s}$, $k$ in $\\text{s}^{-1}$, $h$ and $L_s$ in $\\mu\\text{m}$, $c$ in molecules$/\\mu\\text{m}$, $N_s$ in molecules, and $\\Delta t$ in $\\text{s}$. Express any molecule counts as real-valued floats (not rounded) and any concentrations in molecules$/\\mu\\text{m}$.\n\nYour program must, for each test case below, compute over a single time step $\\Delta t$:\n- the net diffusive exchange into the SSA compartment $\\Delta N_{\\text{ex}}$ in molecules,\n- the updated SSA molecule count $N_s^{n+1}$ in molecules,\n- the updated exterior concentrations $c_L^{n+1}$ and $c_R^{n+1}$ in molecules$/\\mu\\text{m}$,\n- the mass-balance residual defined as\n$$\n\\text{residual} = \\Big( N_s^{n+1} + h\\,c_L^{n+1} + h\\,c_R^{n+1} \\Big) - \\Big( N_s^n + h\\,c_L^n + h\\,c_R^n \\Big) - \\Big( \\Delta N_{\\text{rxn}} - k\\,\\Delta t\\,h\\,(c_L^n + c_R^n) \\Big),\n$$\nwhich should be numerically close to $0$ if the exchange is implemented correctly.\n\nUse the following test suite, which explores a happy path, symmetry, no-diffusion, and asymmetric geometry conditions:\n- Test $1$: $D = 10$, $k = 0.05$, $h = 5$, $L_s = 5$, $\\Delta t = 0.1$, $N_s = 500$, $c_L = 140$, $c_R = 80$, $\\Delta N_{\\text{rxn}} = 0$.\n- Test $2$: $D = 10$, $k = 0.1$, $h = 5$, $L_s = 5$, $\\Delta t = 0.1$, $N_s = 500$, $c_L = 100$, $c_R = 100$, $\\Delta N_{\\text{rxn}} = 10$.\n- Test $3$: $D = 0$, $k = 0$, $h = 5$, $L_s = 5$, $\\Delta t = 0.1$, $N_s = 500$, $c_L = 120$, $c_R = 80$, $\\Delta N_{\\text{rxn}} = -5$.\n- Test $4$: $D = 20$, $k = 0$, $h = 10$, $L_s = 2$, $\\Delta t = 0.05$, $N_s = 200$, $c_L = 50$, $c_R = 200$, $\\Delta N_{\\text{rxn}} = 0$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must concatenate, in order for each test case, the five floats $[\\Delta N_{\\text{ex}}, N_s^{n+1}, c_L^{n+1}, c_R^{n+1}, \\text{residual}]$. For all numerical outputs, use raw floating-point numbers (no percentage signs), and ensure units are as specified above.",
            "solution": "The core requirement is to design a mathematically consistent coupling between a stochastic compartment and surrounding deterministic diffusion-decay exterior, guaranteeing detailed mass balance over a time step $\\Delta t$. We ground the derivation in the following principles:\n- Fick’s law of diffusion: the flux $J$ is $J = -D\\,\\partial_x c$.\n- Finite-volume conservation: the change in the average concentration in a cell equals the net flux through its boundaries divided by its volume (here in one dimension with cross-sectional area set to $1$, volume reduces to length $h$), minus any reaction terms.\n- Mapping between discrete molecules and concentration within the SSA compartment: $c_s = N_s/L_s$.\n\nWe discretize the exterior by two finite-volume cells adjacent to the central SSA compartment: a left cell with average concentration $c_L$ and a right cell with average concentration $c_R$. The distance between the left cell center and the SSA center, and between the SSA center and the right cell center, is modeled by $d = \\tfrac{1}{2}(h + L_s)$, assuming uniform properties and linear concentration profiles across each interface region.\n\nUsing central differences for the gradient across the left interface (left cell center to SSA center), the face-to-the-right flux is\n$$\nF_{\\text{left}} = -D\\,\\frac{c_s - c_L}{d}.\n$$\nA positive $F_{\\text{left}}$ indicates net flow from the left cell into the SSA compartment (to the right across the left face). Across the right interface (SSA center to right cell center), the face-to-the-right flux is\n$$\nF_{\\text{right}} = -D\\,\\frac{c_R - c_s}{d}.\n$$\nA positive $F_{\\text{right}}$ indicates net flow from the SSA compartment into the right exterior cell (to the right across the right face).\n\nFor each exterior cell, finite-volume conservation in one dimension with zero-flux outer boundaries gives, over a single time step $\\Delta t$,\n$$\nc_L^{n+1} = c_L^n - \\frac{\\Delta t}{h}\\,F_{\\text{left}} - k\\,c_L^n\\,\\Delta t,\n$$\n$$\nc_R^{n+1} = c_R^n + \\frac{\\Delta t}{h}\\,F_{\\text{right}} - k\\,c_R^n\\,\\Delta t.\n$$\nThe signs follow from the standard update $c_i^{n+1} = c_i^n - (\\Delta t/h)\\,(F_{i+1/2} - F_{i-1/2}) - k\\,c_i^n\\,\\Delta t$ with $F_{L-1/2} = 0$ and $F_{R+1/2} = 0$.\n\nThe SSA compartment must receive the net diffusive exchange equal to the sum of inflows from the left interface and from the right interface (taken with appropriate signs to represent inflow to SSA). Inflow to SSA from the left interface equals $+\\Delta t\\,F_{\\text{left}}$ (positive flux to the right across the left face moves molecules from the left cell into SSA). Inflow to SSA from the right interface equals $-\\Delta t\\,F_{\\text{right}}$ (a positive flux to the right across the right face moves molecules from SSA into the right cell, which is an outflow from SSA; hence inflow is minus that). Therefore, the net diffusive exchange into SSA is\n$$\n\\Delta N_{\\text{ex}} = \\Delta t\\,\\Big(F_{\\text{left}} - F_{\\text{right}}\\Big).\n$$\nLet $\\Delta N_{\\text{rxn}}$ denote the net molecules produced (positive) or consumed (negative) by SSA reactions during the time step $\\Delta t$. The SSA compartment update is then\n$$\nN_s^{n+1} = N_s^n + \\Delta N_{\\text{rxn}} + \\Delta N_{\\text{ex}}.\n$$\nBy construction, detailed mass balance is preserved across the interfaces because the net mass change in the exterior due to interface fluxes equals $-\\Delta N_{\\text{ex}}$:\n$$\n\\Delta M_{\\text{ext, interface}} = h\\,(c_L^{n+1} - c_L^n)_{\\text{interface}} + h\\,(c_R^{n+1} - c_R^n)_{\\text{interface}} = -\\Delta t\\,F_{\\text{left}} + \\Delta t\\,F_{\\text{right}} = -\\Delta N_{\\text{ex}}.\n$$\nThus, summing all compartments, the only net mass creation or loss arises from SSA reactions inside the central compartment and exterior decay in the exterior cells:\n$$\n\\Big(N_s^{n+1} + h\\,c_L^{n+1} + h\\,c_R^{n+1}\\Big) - \\Big(N_s^n + h\\,c_L^n + h\\,c_R^n\\Big) = \\Delta N_{\\text{rxn}} - k\\,\\Delta t\\,h\\,(c_L^n + c_R^n).\n$$\nTo numerically verify mass conservation, we compute the residual\n$$\n\\text{residual} = \\Big( N_s^{n+1} + h\\,c_L^{n+1} + h\\,c_R^{n+1} \\Big) - \\Big( N_s^n + h\\,c_L^n + h\\,c_R^n \\Big) - \\Big( \\Delta N_{\\text{rxn}} - k\\,\\Delta t\\,h\\,(c_L^n + c_R^n) \\Big),\n$$\nwhich should evaluate to $0$ up to floating-point roundoff.\n\nAlgorithmic steps for each test case:\n- Compute $c_s = N_s/L_s$ and $d = \\tfrac{1}{2}(h + L_s)$.\n- Compute $F_{\\text{left}}$ and $F_{\\text{right}}$ using the above formulas.\n- Compute $\\Delta N_{\\text{ex}} = \\Delta t\\,(F_{\\text{left}} - F_{\\text{right}})$.\n- Update $N_s^{n+1}$ using $N_s^{n+1} = N_s^n + \\Delta N_{\\text{rxn}} + \\Delta N_{\\text{ex}}$.\n- Update exterior concentrations:\n  $c_L^{n+1} = c_L^n - (\\Delta t/h)\\,F_{\\text{left}} - k\\,c_L^n\\,\\Delta t$ and\n  $c_R^{n+1} = c_R^n + (\\Delta t/h)\\,F_{\\text{right}} - k\\,c_R^n\\,\\Delta t$.\n- Compute the residual to verify mass balance.\n\nThe explicit scheme is scientifically realistic and stable for the provided time steps and parameters (e.g., with $D$ and $h$ chosen such that $\\Delta t/h^2$ remains small), and uses only fundamental laws without shortcut formulas. The program outputs, for each test case, the five floats in the order $[\\Delta N_{\\text{ex}}, N_s^{n+1}, c_L^{n+1}, c_R^{n+1}, \\text{residual}]$, concatenated across all test cases into a single bracketed list on one line, as required.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef hybrid_step(D, k, h, Ls, dt, Ns, cL, cR, dN_rxn):\n    \"\"\"\n    Perform one hybrid step coupling a central SSA compartment and two exterior PDE cells.\n    Units:\n      D: um^2/s\n      k: 1/s\n      h, Ls: um\n      dt: s\n      Ns: molecules\n      cL, cR: molecules/um\n      dN_rxn: molecules\n    Returns:\n      (dN_ex, Ns_new, cL_new, cR_new, residual)\n    \"\"\"\n    # Map SSA molecules to concentration in the compartment\n    cs = Ns / Ls\n    # Distance between centers across each interface\n    d = 0.5 * (h + Ls)\n\n    # Face-to-the-right fluxes by Fick's law (central differences)\n    F_left = -D * (cs - cL) / d      # left interface: left cell (cL) to SSA (cs)\n    F_right = -D * (cR - cs) / d     # right interface: SSA (cs) to right cell (cR)\n\n    # Net diffusive exchange into SSA (in molecules) over dt\n    dN_ex = dt * (F_left - F_right)\n\n    # Update SSA molecule count with reactions and exchange\n    Ns_new = Ns + dN_rxn + dN_ex\n\n    # Exterior updates via finite volume with zero outer fluxes\n    cL_new = cL - (dt / h) * F_left - k * cL * dt\n    cR_new = cR + (dt / h) * F_right - k * cR * dt\n\n    # Mass-balance residual check (should be ~0)\n    M_before = Ns + h * (cL + cR)\n    M_after = Ns_new + h * (cL_new + cR_new)\n    predicted_change = dN_rxn - k * dt * h * (cL + cR)\n    residual = M_after - M_before - predicted_change\n\n    return dN_ex, Ns_new, cL_new, cR_new, residual\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (D, k, h, Ls, dt, Ns, cL, cR, dN_rxn)\n    test_cases = [\n        (10.0, 0.05, 5.0, 5.0, 0.1, 500.0, 140.0, 80.0, 0.0),    # Test 1\n        (10.0, 0.1, 5.0, 5.0, 0.1, 500.0, 100.0, 100.0, 10.0),   # Test 2\n        (0.0, 0.0, 5.0, 5.0, 0.1, 500.0, 120.0, 80.0, -5.0),     # Test 3\n        (20.0, 0.0, 10.0, 2.0, 0.05, 200.0, 50.0, 200.0, 0.0),   # Test 4\n    ]\n\n    results = []\n    for case in test_cases:\n        D, k, h, Ls, dt, Ns, cL, cR, dN_rxn = case\n        dN_ex, Ns_new, cL_new, cR_new, residual = hybrid_step(D, k, h, Ls, dt, Ns, cL, cR, dN_rxn)\n        # Append results in required flat order for each test case\n        results.extend([dN_ex, Ns_new, cL_new, cR_new, residual])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Solving the continuum part of a hybrid model can be computationally demanding, especially when discrete agents create sharp, localized gradients in the field. This exercise  introduces a powerful technique to manage this complexity: Adaptive Mesh Refinement (AMR). You will implement a solver that uses an \"agent activity indicator\" to intelligently refine the computational mesh only in regions where high accuracy is required, demonstrating how to build an efficient simulation by letting the discrete and continuum components inform each other's numerical solution.",
            "id": "3330692",
            "problem": "Consider a one-dimensional, dimensionless tissue segment occupying the domain $[0,1]$. A diffusing and degrading molecular field $u(x)$ is produced by discrete agents located at positions $\\{x_j\\}$ that act as localized sources. Starting from conservation of mass and Fick’s law, the steady state of a diffusion with first-order degradation and sources satisfies\n$$-D \\frac{d^2 u}{dx^2} + \\lambda u = s(x), \\quad x \\in (0,1)$$\nwith homogeneous Dirichlet boundary conditions\n$$u(0)=0, \\quad u(1)=0$$\nwhere $D0$ is the diffusion coefficient, $\\lambda0$ is the degradation rate, and $s(x)$ is the source density induced by agents. Model each agent at position $x_j$ as producing a smooth, localized source approximated by a Gaussian kernel. With production strength $q0$ per agent and kernel width $\\sigma0$, define\n$$s(x) = \\sum_{j} q \\cdot \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\!\\left(-\\frac{(x-x_j)^2}{2\\sigma^2}\\right)$$\nDefine an agent activity indicator as\n$$\\eta(x) = \\sum_{j} \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\!\\left(-\\frac{(x-x_j)^2}{2\\sigma^2}\\right)$$\nwhich is proportional to $s(x)$ and measures local agent activity independent of production strength $q$.\n\nYou are to implement Adaptive Mesh Refinement (AMR) guided by the agent activity indicator $\\eta(x)$ and use it to solve the steady-state Partial Differential Equation (PDE). Discretize the PDE conservatively on a nonuniform node set $\\{x_i\\}_{i=0}^{N-1}$ that includes the boundaries with $x_0=0$ and $x_{N-1}=1$, and interior nodes indexed by $i=1,\\dots,N-2$. Using a finite-volume balance on a control volume around each interior node and Fick’s law, approximate the second derivative at node $i$ by\n$$\\left.\\frac{d^2 u}{dx^2}\\right|_{x_i} \\approx \\frac{\\displaystyle \\frac{u_{i+1}-u_i}{x_{i+1}-x_i} - \\frac{u_i - u_{i-1}}{x_i - x_{i-1}}}{\\displaystyle \\frac{(x_{i+1}-x_i) + (x_i - x_{i-1})}{2}},$$\nwhich yields the linear system for interior nodes\n$$\\left(\\frac{D}{\\delta_i}\\left(\\frac{1}{x_{i+1}-x_i} + \\frac{1}{x_i - x_{i-1}}\\right) + \\lambda\\right) u_i - \\frac{D}{\\delta_i}\\frac{u_{i-1}}{x_i - x_{i-1}} - \\frac{D}{\\delta_i}\\frac{u_{i+1}}{x_{i+1}-x_i} = s(x_i),$$\nwith $\\delta_i = \\tfrac{1}{2}\\big((x_{i+1}-x_i)+(x_i-x_{i-1})\\big)$, and with $u_0=u_{N-1}=0$ enforced by the boundary conditions.\n\nImplement AMR by starting from a coarse partition of $[0,1]$ into $M_0$ equal cells. Iteratively bisect any cell whose midpoint activity indicator exceeds a threshold $\\tau0$, that is, a cell $[a,b]$ with midpoint $c=\\tfrac{a+b}{2}$ is marked if $\\eta(c)\\tau$. Continue until no cell is marked or a maximum refinement level $L_{\\max}$ is reached. Construct the node set $\\{x_i\\}$ as the sorted, unique set of all cell endpoints after refinement.\n\nDefine the co-simulation error as the $L^2$-norm of the difference between the AMR solution and a reference solution computed on a fine, uniform reference grid of $N_{\\text{ref}}$ nodes over $[0,1]$. Interpolate the AMR solution linearly onto the reference grid and compute\n$$\\|u_{\\text{AMR}} - u_{\\text{ref}}\\|_{L^2(0,1)} = \\left(\\int_0^1 \\left(u_{\\text{AMR}}(x) - u_{\\text{ref}}(x)\\right)^2 dx\\right)^{1/2},$$\nnumerically approximated on the reference grid using the trapezoidal rule. All quantities are dimensionless. Your program must use the same values of $D$, $\\lambda$, $q$, and $\\sigma$ in both the AMR and the reference computations.\n\nUse the following fixed parameter values for all tests:\n- $D = 1.0$,\n- $\\lambda = 1.0$,\n- $q = 0.02$,\n- $\\sigma = 0.02$,\n- $M_0 = 32$,\n- $L_{\\max} = 6$,\n- $\\tau = 0.35$,\n- $N_{\\text{ref}} = 2049$.\n\nTest suite. For each of the following agent position sets, compute the co-simulation error as defined above:\n- Test $1$ (agents separated): $\\{x_j\\} = [0.2, 0.5, 0.8]$.\n- Test $2$ (agents clustered in the interior): $\\{x_j\\} = [0.48, 0.5, 0.52]$.\n- Test $3$ (agents clustered near the boundary): $\\{x_j\\} = [0.02, 0.04, 0.06]$.\n\nFinal output format. Your program should produce a single line of output containing the three co-simulation errors, in the order of the tests above, as a comma-separated list enclosed in square brackets, with each number formatted as a floating-point value rounded to six decimal places, for example, $[0.123456,0.234567,0.345678]$.",
            "solution": "We begin from conservation of mass for a diffusing and degrading molecular field with sources. Let $u(x)$ denote the steady-state concentration. The mass balance in one spatial dimension with Fick’s law of diffusion and first-order degradation yields the steady-state Partial Differential Equation (PDE)\n$$-D \\frac{d^2 u}{dx^2} + \\lambda u = s(x), \\quad x \\in (0,1),$$\nsubject to homogeneous Dirichlet boundary conditions $u(0)=0$ and $u(1)=0$. Here $D0$ is the diffusion coefficient and $\\lambda0$ is the degradation rate. The source term $s(x)$ arises from agents producing the field. To regularize the Dirac distribution for numerical purposes, each agent at position $x_j$ is represented by a Gaussian of width $\\sigma0$ and strength $q0$, so the total source is\n$$s(x) = \\sum_{j} q \\cdot \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\!\\left(-\\frac{(x-x_j)^2}{2\\sigma^2}\\right).$$\nTo guide Adaptive Mesh Refinement (AMR), the agent activity indicator is defined as a normalized sum of Gaussians,\n$$\\eta(x) = \\sum_{j} \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\!\\left(-\\frac{(x-x_j)^2}{2\\sigma^2}\\right),$$\nwhich is proportional to $s(x)$ and independent of $q$.\n\nDiscretization on a nonuniform grid is constructed from first principles using a finite-volume balance on a control volume around each interior node $x_i$, for $i=1,\\dots,N-2$. Let the node set be $0=x_0  x_1  \\dots  x_{N-2}  x_{N-1}=1$ and define the spacings $\\Delta x_{i-1/2} = x_i - x_{i-1}$, $\\Delta x_{i+1/2} = x_{i+1} - x_i$, and the average half-width $\\delta_i = \\tfrac{1}{2}(\\Delta x_{i-1/2} + \\Delta x_{i+1/2})$. Fick’s law gives flux $J = -D \\tfrac{du}{dx}$. Integrating the diffusion term over the control volume and approximating the face gradients by one-sided differences results in the conservative discrete Laplacian\n$$\\left.\\frac{d^2 u}{dx^2}\\right|_{x_i} \\approx \\frac{\\displaystyle \\frac{u_{i+1}-u_i}{\\Delta x_{i+1/2}} - \\frac{u_i - u_{i-1}}{\\Delta x_{i-1/2}}}{\\displaystyle \\delta_i}.$$\nInserting this into the PDE produces, for each interior node,\n$$-D \\cdot \\frac{\\displaystyle \\frac{u_{i+1}-u_i}{\\Delta x_{i+1/2}} - \\frac{u_i - u_{i-1}}{\\Delta x_{i-1/2}}}{\\displaystyle \\delta_i} + \\lambda u_i = s(x_i).$$\nRearranging gives a symmetric tridiagonal linear system\n$$a_{i-1} u_{i-1} + a_i u_i + a_{i+1} u_{i+1} = s(x_i),$$\nwith coefficients\n$$a_{i-1} = -\\frac{D}{\\delta_i} \\cdot \\frac{1}{\\Delta x_{i-1/2}}, \\quad a_{i+1} = -\\frac{D}{\\delta_i} \\cdot \\frac{1}{\\Delta x_{i+1/2}}, \\quad a_i = \\frac{D}{\\delta_i}\\left(\\frac{1}{\\Delta x_{i-1/2}} + \\frac{1}{\\Delta x_{i+1/2}}\\right) + \\lambda.$$\nThe boundary conditions $u_0=0$ and $u_{N-1}=0$ are enforced directly and remove unknowns at $i=0$ and $i=N-1$, so the tridiagonal system is solved for interior unknowns $u_1,\\dots,u_{N-2}$.\n\nAdaptive Mesh Refinement is driven by the activity indicator $\\eta(x)$. Begin with a uniform partition of $[0,1]$ into $M_0$ cells at refinement level $0$. For a cell $[a,b]$ at level $\\ell$ with midpoint $c=\\tfrac{a+b}{2}$, mark it for refinement if $\\eta(c)\\tau$ and $\\ell  L_{\\max}$. Each marked cell is bisected into two child cells of level $\\ell+1$. Iterate the mark-and-bisect procedure until no cell is marked or the maximum refinement level $L_{\\max}$ is reached. The node set $\\{x_i\\}$ used to discretize the PDE is the sorted set of all cell endpoints after refinement. This aligns refinement with regions of high agent activity, where $s(x)$ is sharply peaked and where $u(x)$ tends to exhibit steep gradients.\n\nThe co-simulation error is computed by comparing the AMR solution to a reference solution on a fine, uniform grid with $N_{\\text{ref}}$ nodes over $[0,1]$. Compute the reference solution by applying the same discrete operator on the uniform grid. Interpolate the AMR solution linearly onto the reference grid, yielding $u_{\\text{AMR}}(x_k)$ at uniform nodes $x_k$. Approximate the $L^2$ error norm using the trapezoidal rule,\n$$\\|u_{\\text{AMR}} - u_{\\text{ref}}\\|_{L^2(0,1)} \\approx \\left( \\int_0^1 \\left(u_{\\text{AMR}}(x) - u_{\\text{ref}}(x)\\right)^2 dx \\right)^{1/2} \\approx \\left( \\sum_{k=0}^{N_{\\text{ref}}-1} w_k \\left(u_{\\text{AMR}}(x_k) - u_{\\text{ref}}(x_k)\\right)^2 \\right)^{1/2},$$\nwhere $w_k$ are the trapezoidal quadrature weights with $w_0 = w_{N_{\\text{ref}}-1} = \\tfrac{\\Delta x}{2}$ and $w_k = \\Delta x$ for $1 \\le k \\le N_{\\text{ref}}-2$, and $\\Delta x = \\tfrac{1}{N_{\\text{ref}}-1}$.\n\nAlgorithmic steps:\n- Define parameters $D$, $\\lambda$, $q$, $\\sigma$, $M_0$, $L_{\\max}$, $\\tau$, and $N_{\\text{ref}}$.\n- For each test case agent set $\\{x_j\\}$:\n  - Build the AMR mesh by iterative midpoint indicator marking with threshold $\\tau$ until no marks or maximum level $L_{\\max}$ is reached.\n  - Form the nonuniform node vector from refined cell endpoints.\n  - Assemble and solve the tridiagonal system for the AMR grid using the coefficients above and right-hand side $s(x_i)$ evaluated at nodes.\n  - Assemble and solve the reference system on the uniform grid of $N_{\\text{ref}}$ nodes with the same $D$, $\\lambda$, $q$, and $\\sigma$.\n  - Interpolate the AMR solution onto the uniform reference grid and compute the $L^2$ error via the trapezoidal rule.\n- Output the three errors in the specified list format.\n\nJustification of correctness:\n- The governing equation is derived from mass conservation and Fick’s law, with linear degradation and smooth sources, ensuring a well-posed, linear, self-adjoint elliptic boundary value problem with a unique solution for $D0$ and $\\lambda0$.\n- The finite-volume discretization on a nonuniform grid is conservative and yields a symmetric positive definite tridiagonal system due to $D0$, $\\lambda0$, and strictly increasing nodes, ensuring numerical stability and uniqueness of the discrete solution.\n- The AMR strategy targets regions where $\\eta(x)$ is large, which coincide with localized sources and steep gradients in $u(x)$, thereby concentrating resolution where it is most beneficial.\n- The $L^2$ error computed on a fine, uniform reference grid provides a consistent, quantitative measure of co-simulation discrepancy between AMR and reference solutions.\n\nAll quantities are dimensionless, and the three requested tests are:\n- Test $1$: $\\{x_j\\} = [0.2, 0.5, 0.8]$,\n- Test $2$: $\\{x_j\\} = [0.48, 0.5, 0.52]$,\n- Test $3$: $\\{x_j\\} = [0.02, 0.04, 0.06]$.\n\nThe program must print a single line containing the three error values as $[e_1,e_2,e_3]$, each rounded to six decimal places.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef gaussian_mixture(x, agents, q, sigma):\n    # Compute sum_j q * Gaussian(x - x_j; sigma)\n    # Gaussian normalization 1/(sigma*sqrt(2*pi))\n    x = np.asarray(x)\n    val = np.zeros_like(x, dtype=float)\n    norm = 1.0 / (sigma * np.sqrt(2.0 * np.pi))\n    for aj in agents:\n        val += q * norm * np.exp(-0.5 * ((x - aj) / sigma) ** 2)\n    return val\n\ndef activity_indicator(x, agents, sigma):\n    # Same as gaussian mixture but with q=1\n    x = np.asarray(x)\n    val = np.zeros_like(x, dtype=float)\n    norm = 1.0 / (sigma * np.sqrt(2.0 * np.pi))\n    for aj in agents:\n        val += norm * np.exp(-0.5 * ((x - aj) / sigma) ** 2)\n    return val\n\ndef build_amr_nodes(agents, sigma, tau, M0, Lmax, max_cells=8192):\n    # Cells represented as tuples (a, b, level)\n    cells = []\n    # initial uniform partition\n    edges = np.linspace(0.0, 1.0, M0 + 1)\n    for i in range(M0):\n        cells.append([edges[i], edges[i+1], 0])\n    # Refinement loop\n    changed = True\n    while changed:\n        changed = False\n        new_cells = []\n        for a, b, lev in cells:\n            c = 0.5 * (a + b)\n            eta_c = activity_indicator(np.array([c]), agents, sigma)[0]\n            if (eta_c  tau) and (lev  Lmax):\n                # bisect\n                mid = 0.5 * (a + b)\n                new_cells.append([a, mid, lev + 1])\n                new_cells.append([mid, b, lev + 1])\n                changed = True\n            else:\n                new_cells.append([a, b, lev])\n        cells = new_cells\n        if len(cells)  max_cells:\n            break\n        if not changed:\n            break\n    # Build nodes from cell endpoints\n    nodes = np.unique(np.array([c[0] for c in cells] + [cells[-1][1]]))\n    return nodes\n\ndef assemble_tridiagonal_nonuniform(nodes, D, lam, source_fn):\n    # nodes: array of length N, with boundaries at nodes[0]=0, nodes[-1]=1\n    N = len(nodes)\n    # interior indices: 1..N-2\n    n_int = N - 2\n    if n_int = 0:\n        # trivial case, no interior unknowns\n        return np.zeros((0,)), np.zeros((0,)), np.zeros((0,)), np.zeros((0,))\n    xi = nodes\n    # compute spacings\n    dxm = xi[1:-1] - xi[0:-2]     # length n_int\n    dxp = xi[2:] - xi[1:-1]       # length n_int\n    denom = 0.5 * (dxm + dxp)     # length n_int\n\n    # Coefficients for interior points\n    aW = -D / denom / dxm\n    aE = -D / denom / dxp\n    aP = (D / denom) * (1.0/dxm + 1.0/dxp) + lam\n\n    # RHS s(x_i)\n    x_interior = xi[1:-1]\n    b = source_fn(x_interior).copy()\n\n    # Tridiagonal arrays\n    lower = aW[1:]          # sub-diagonal of length n_int-1\n    diag = aP.copy()        # main diagonal of length n_int\n    upper = aE[:-1]         # super-diagonal of length n_int-1\n\n    # Dirichlet boundaries are zero, so no modifications to b needed\n    return lower, diag, upper, b\n\ndef thomas_solve(lower, diag, upper, rhs):\n    # Solve tridiagonal system with Thomas algorithm\n    n = len(diag)\n    if n == 0:\n        return np.zeros((0,))\n    c = np.zeros(n-1, dtype=float)\n    d = np.zeros(n, dtype=float)\n    # forward elimination\n    c[0:1] = upper[0:1] / diag[0]\n    d[0] = rhs[0] / diag[0]\n    for i in range(1, n):\n        denom = diag[i] - lower[i-1] * c[i-1]\n        if i  n-1:\n            c[i] = upper[i] / denom\n        d[i] = (rhs[i] - lower[i-1] * d[i-1]) / denom\n    # back substitution\n    x = np.zeros(n, dtype=float)\n    x[-1] = d[-1]\n    for i in range(n-2, -1, -1):\n        x[i] = d[i] - c[i] * x[i+1]\n    return x\n\ndef solve_nonuniform(nodes, D, lam, agents, q, sigma):\n    # Build source function\n    def sfun(x):\n        return gaussian_mixture(x, agents, q, sigma)\n    lower, diag, upper, b = assemble_tridiagonal_nonuniform(nodes, D, lam, sfun)\n    u_int = thomas_solve(lower, diag, upper, b)\n    # assemble full solution with Dirichlet boundaries zero\n    u_full = np.zeros_like(nodes)\n    if len(u_int)  0:\n        u_full[1:-1] = u_int\n    return u_full\n\ndef l2_error_on_uniform_ref(u_ref, x_ref, x_amr, u_amr):\n    # Interpolate AMR solution to reference grid and compute L2 norm via trapezoidal rule\n    u_amr_interp = np.interp(x_ref, x_amr, u_amr)\n    diff2 = (u_amr_interp - u_ref) ** 2\n    err_sq = np.trapz(diff2, x_ref)\n    return np.sqrt(err_sq)\n\ndef solve_case(agents, params):\n    D = params[\"D\"]\n    lam = params[\"lam\"]\n    q = params[\"q\"]\n    sigma = params[\"sigma\"]\n    M0 = params[\"M0\"]\n    Lmax = params[\"Lmax\"]\n    tau = params[\"tau\"]\n    Nref = params[\"Nref\"]\n\n    # Reference grid and solution\n    x_ref = np.linspace(0.0, 1.0, Nref)\n    u_ref = solve_nonuniform(x_ref, D, lam, agents, q, sigma)\n\n    # AMR grid and solution\n    x_amr = build_amr_nodes(agents, sigma, tau, M0, Lmax, max_cells=8192)\n    u_amr = solve_nonuniform(x_amr, D, lam, agents, q, sigma)\n\n    # L2 error\n    err = l2_error_on_uniform_ref(u_ref, x_ref, x_amr, u_amr)\n    return err\n\ndef solve():\n    # Define parameters\n    params = {\n        \"D\": 1.0,\n        \"lam\": 1.0,\n        \"q\": 0.02,\n        \"sigma\": 0.02,\n        \"M0\": 32,\n        \"Lmax\": 6,\n        \"tau\": 0.35,\n        \"Nref\": 2049,\n    }\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        [0.2, 0.5, 0.8],        # Test 1: separated agents\n        [0.48, 0.5, 0.52],      # Test 2: clustered interior\n        [0.02, 0.04, 0.06],     # Test 3: clustered near boundary\n    ]\n\n    results = []\n    for agents in test_cases:\n        err = solve_case(agents, params)\n        # Round to six decimal places for output formatting\n        results.append(f\"{err:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}