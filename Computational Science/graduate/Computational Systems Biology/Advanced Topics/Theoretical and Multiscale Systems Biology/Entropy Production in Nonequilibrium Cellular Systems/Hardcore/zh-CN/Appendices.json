{
    "hands_on_practices": [
        {
            "introduction": "在真实的生物学实验中，我们往往无法观测到系统的所有状态。当关键的中间态被隐藏时，我们对系统能量耗散的估计会发生什么变化？本练习旨在探讨这一“粗粒化”问题对熵产生计算的影响，通过比较一个完整三态系统的真实耗散与仅从观测到的两态子系统推断出的“表观”耗散，您将亲手量化由于信息不完整而导致的“隐藏熵产生”。这个问题揭示了实验生物物理学中的一个关键挑战，并阐明了为何表观热力学效率可能具有误导性。",
            "id": "3305753",
            "problem": "在非平衡细胞环境中，一个膜转运蛋白作为一个连续时间马尔可夫跳跃过程，在三个构象态 $A \\leftrightarrow B \\leftrightarrow C \\leftrightarrow A$ 之间循环。该系统通过恒定的化学驱动维持在非平衡状态，并处于非平衡稳态。所有跃迁都是沿环的单步过程，速率常数（单位为 $\\mathrm{s}^{-1}$）为：$k_{AB} = 8$，$k_{BA} = 3$，$k_{BC} = 6$，$k_{CB} = 2$，$k_{CA} = 5$，$k_{AC} = 1$。在整个问题中，将玻尔兹曼常数 $k_{B}$ 作为熵的单位。\n\n一位实验者只能观察到状态 $A$ 和 $B$；状态 $C$ 是未被观察到的。从一个长的单分子时间序列中，实验者获取了以下统计数据：\n- 完整三态系统中状态A和B的稳态占据概率分别为：$p_A = \\frac{51}{166}$ 和 $p_B = \\frac{58}{166}$。\n- 从 A 到 B 和从 B 到 A 的单向稳态通量（即单位时间内的直接跃迁次数）分别为：$J_{A \\to B} = \\frac{204}{83}\\ \\mathrm{s}^{-1}$ 和 $J_{B \\to A} = \\frac{87}{83}\\ \\mathrm{s}^{-1}$。\n\n使用以下基本原理：\n- 连续时间马尔可夫链的稳态由主方程 $\\frac{d\\boldsymbol{p}}{dt} = \\boldsymbol{p} \\boldsymbol{Q}$ 的平稳解定义，满足 $\\boldsymbol{p} \\boldsymbol{Q} = \\boldsymbol{0}$ 和 $\\sum_{i} p_{i} = 1$，其中 $\\boldsymbol{Q}$ 是速率矩阵。\n- 在随机热力学（ST）中，马尔可夫跳跃过程的稳态熵产生率等于对所有跃迁求和，每一项是概率流乘以该跃迁的热力学力（亲和势），由稳态流计算得出。对于任意一对状态 $i$ 和 $j$，稳态概率流为 $J_{ij} = k_{ij} p_{i} - k_{ji} p_{j}$，力为 $\\ln\\!\\left(\\frac{k_{ij} p_{i}}{k_{ji} p_{j}}\\right)$。\n\n任务：\n1. 仅使用上述基本定义，计算完整三态系统的真实稳态熵产生率 $\\sigma_{\\mathrm{true}}$。\n2. 如果一个观察者仅限于观察 $\\{A,B\\}$ 状态对，并且只使用观察到的直接跃迁 $A \\leftrightarrow B$ 以及该边的测量稳态流，忽略状态 $C$，计算他将得到的表观熵产生率 $\\sigma_{\\mathrm{app}}$。\n3. 计算差值 $\\Delta \\sigma = \\sigma_{\\mathrm{true}} - \\sigma_{\\mathrm{app}}$。\n\n将 $\\Delta \\sigma$ 的最终结果以 $k_{B}\\,\\mathrm{s}^{-1}$ 为单位表示，并将您的单个数值答案四舍五入到四位有效数字。",
            "solution": "该问题描述了一个在非平衡稳态（NESS）下的三态 $\\{A, B, C\\}$ 连续时间马尔可夫跳跃过程。我们被要求计算和比较两种熵产生率的度量：一种是针对完整系统，另一种是针对受限于子系统的观察者。\n\n首先，我们确定稳态概率 $p_A$、$p_B$ 和 $p_C$。系统的速率矩阵 $\\boldsymbol{Q}$ 由给定的速率常数 $k_{ij}$（单位为 $\\mathrm{s}^{-1}$）构建：$k_{AB} = 8$，$k_{BA} = 3$，$k_{BC} = 6$，$k_{CB} = 2$，$k_{CA} = 5$ 和 $k_{AC} = 1$。矩阵元素为 $Q_{ij} = k_{ij}$（当 $i \\neq j$ 时）和 $Q_{ii} = -\\sum_{j \\neq i} k_{ij}$。\n$$\n\\boldsymbol{Q} = \\begin{pmatrix} -(k_{AB}+k_{AC})  k_{AB}  k_{AC} \\\\ k_{BA}  -(k_{BA}+k_{BC})  k_{BC} \\\\ k_{CA}  k_{CB}  -(k_{CA}+k_{CB}) \\end{pmatrix} = \\begin{pmatrix} -(8+1)  8  1 \\\\ 3  -(3+6)  6 \\\\ 5  2  -(5+2) \\end{pmatrix} = \\begin{pmatrix} -9  8  1 \\\\ 3  -9  6 \\\\ 5  2  -7 \\end{pmatrix}\n$$\n稳态概率向量 $\\boldsymbol{p} = (p_A, p_B, p_C)$ 是主方程 $\\boldsymbol{p}\\boldsymbol{Q} = \\boldsymbol{0}$ 在归一化条件 $\\sum_i p_i = 1$ 下的解。这给出了一个线性方程组：\n$$\n-9p_A + 3p_B + 5p_C = 0 \\\\\n8p_A - 9p_B + 2p_C = 0 \\\\\np_A + 6p_B - 7p_C = 0 \\\\\np_A + p_B + p_C = 1\n$$\n解这个方程组，我们可以用两个平衡方程将 $p_A$ 和 $p_B$ 表示为 $p_C$ 的函数。例如，从第二个和第三个方程中，我们得到 $p_A = \\frac{51}{57} p_C$ 和 $p_B = \\frac{58}{57} p_C$。将这些代入归一化条件：\n$$\n\\frac{51}{57} p_C + \\frac{58}{57} p_C + p_C = 1 \\implies \\left(\\frac{51+58+57}{57}\\right)p_C = 1 \\implies \\frac{166}{57}p_C = 1\n$$\n这得到 $p_C = \\frac{57}{166}$。其他概率则为 $p_A = \\frac{51}{57} \\times \\frac{57}{166} = \\frac{51}{166}$ 和 $p_B = \\frac{58}{57} \\times \\frac{57}{166} = \\frac{58}{166}$。这些计算出的概率与问题中提供的值相符。\n\n**1. 真实稳态熵产生率 ($\\sigma_{\\mathrm{true}}$)**\n在非平衡稳态下，马尔可夫跳跃过程的总熵产生率是每个跃迁对贡献的总和。对于一个单环系统，这简化为环流 $J$ 和环亲和势 $\\mathcal{A}$ 的乘积。\n环流 $J$ 是环周围的净流量，在稳态下，每条边的净流量必须相等：$J = J_{AB} = J_{BC} = J_{CA}$。我们使用边 $A \\leftrightarrow B$ 来计算 $J$：\n$$\nJ = J_{AB} = k_{AB} p_A - k_{BA} p_B = 8 \\left(\\frac{51}{166}\\right) - 3 \\left(\\frac{58}{166}\\right) = \\frac{408 - 174}{166} = \\frac{234}{166} = \\frac{117}{83} \\ \\mathrm{s}^{-1}\n$$\n环亲和势 $\\mathcal{A}$ 是环上正向速率乘积与反向速率乘积之比的对数：\n$$\n\\mathcal{A} = \\ln\\left(\\frac{k_{AB}k_{BC}k_{CA}}{k_{BA}k_{CB}k_{AC}}\\right) = \\ln\\left(\\frac{8 \\times 6 \\times 5}{3 \\times 2 \\times 1}\\right) = \\ln\\left(\\frac{240}{6}\\right) = \\ln(40)\n$$\n那么，真实的熵产生率为：\n$$\n\\sigma_{\\mathrm{true}} = J \\mathcal{A} = \\frac{117}{83} \\ln(40) \\ k_{B}\\,\\mathrm{s}^{-1}\n$$\n\n**2. 表观熵产生率 ($\\sigma_{\\mathrm{app}}$)**\n表观熵产生率是观察者仅看到状态 $A$ 和 $B$ 之间的直接跃迁时所计算出的值。该计算基于该边的测量稳态流。给定的单向通量为 $J_{A \\to B} = \\frac{204}{83}\\ \\mathrm{s}^{-1}$ 和 $J_{B \\to A} = \\frac{87}{83}\\ \\mathrm{s}^{-1}$。\n表观流是净流量：$J_{\\mathrm{app}} = J_{A \\to B} - J_{B \\to A} = \\frac{204}{83} - \\frac{87}{83} = \\frac{117}{83} \\ \\mathrm{s}^{-1}$，这与环流 $J$ 相同。\n表观力是单向流量之比的对数：\n$$\n\\mathcal{F}_{\\mathrm{app}} = \\ln\\left(\\frac{J_{A \\to B}}{J_{B \\to A}}\\right) = \\ln\\left(\\frac{204/83}{87/83}\\right) = \\ln\\left(\\frac{204}{87}\\right) = \\ln\\left(\\frac{68}{29}\\right)\n$$\n表观熵产生率是这两个量的乘积：\n$$\n\\sigma_{\\mathrm{app}} = J_{\\mathrm{app}} \\mathcal{F}_{\\mathrm{app}} = \\frac{117}{83} \\ln\\left(\\frac{68}{29}\\right) \\ k_{B}\\,\\mathrm{s}^{-1}\n$$\n这个量代表了单一边 $A \\leftrightarrow B$ 对总熵产生的贡献。\n\n**3. 差值 ($\\Delta \\sigma$)**\n差值 $\\Delta \\sigma$ 是真实熵产生率与表观熵产生率之间的差。这代表了系统中未被观察到的部分（$B \\leftrightarrow C \\leftrightarrow A$）发生的隐藏熵产生。\n$$\n\\Delta \\sigma = \\sigma_{\\mathrm{true}} - \\sigma_{\\mathrm{app}} = \\frac{117}{83} \\ln(40) - \\frac{117}{83} \\ln\\left(\\frac{68}{29}\\right)\n$$\n使用对数性质 $\\ln(x) - \\ln(y) = \\ln(x/y)$：\n$$\n\\Delta \\sigma = \\frac{117}{83} \\ln\\left(\\frac{40}{68/29}\\right) = \\frac{117}{83} \\ln\\left(\\frac{40 \\times 29}{68}\\right)\n$$\n由于 $40 = 4 \\times 10$ 且 $68 = 4 \\times 17$：\n$$\n\\Delta \\sigma = \\frac{117}{83} \\ln\\left(\\frac{10 \\times 29}{17}\\right) = \\frac{117}{83} \\ln\\left(\\frac{290}{17}\\right) \\ k_{B}\\,\\mathrm{s}^{-1}\n$$\n为了求出数值，我们计算：\n$$\n\\Delta \\sigma = \\frac{117}{83} \\times \\ln\\left(\\frac{290}{17}\\right) \\approx 1.40963855 \\times \\ln(17.0588235) \\approx 1.40963855 \\times 2.836667 \\approx 3.998539 \\ k_{B}\\,\\mathrm{s}^{-1}\n$$\n将结果四舍五入到四位有效数字，得到 $3.999 \\ k_{B}\\,\\mathrm{s}^{-1}$。",
            "answer": "$$\n\\boxed{3.999}\n$$"
        },
        {
            "introduction": "生物系统通常受到精密的动态调控。我们能否设计出既能实现特定功能，又兼具能量效率的控制策略？本练习将从稳态分析拓展到周期性驱动系统，这是细胞调控中的一个典型场景。您将通过数值模拟，为一个合成基因开关比较不同控制协议（例如正弦波、方波和三角波），目标是在达到指定稳定性的前提下，找出熵产生最小的驱动方式，从而将抽象的热力学原理与合成生物学电路设计的工程挑战联系起来。",
            "id": "3305715",
            "problem": "细胞中的一个合成双稳态拨动开关可以粗粒化为一个两状态连续时间马尔可夫链，其状态标记为 $A$ 和 $B$，代表一个基因对另一个基因的显性。通过周期为 $T$、协议形状为 $\\lambda(t)$ 的周期性刺激施加非平衡控制，该刺激调节吸引盆的深度，从而调节跃迁速率。目标是计算每个周期的熵产生，并在一系列候选周期性形状中，确定哪种协议形状能在满足由吸引盆深度约束量化的特定鲁棒性目标的同时，最小化熵产生。\n\n基本原理：\n1. 具有含时跃迁速率 $k_{A \\to B}(t)$ 和 $k_{B \\to A}(t)$ 的两状态马尔可夫过程的主方程控制着处于状态 $A$ 的概率 $p_A(t)$ 和处于状态 $B$ 的概率 $p_B(t)=1-p_A(t)$：\n$$\n\\frac{dp_A}{dt} = -p_A(t)\\,k_{A \\to B}(t) + p_B(t)\\,k_{B \\to A}(t).\n$$\n2. 在自然单位（奈特/秒）下，马尔可夫跳跃过程的瞬时熵产生率（Schnakenberg 公式）为\n$$\n\\sigma(t) = J(t)\\,\\ln\\left(\\frac{k_{A \\to B}(t)\\,p_A(t)}{k_{B \\to A}(t)\\,p_B(t)}\\right),\n$$\n其中净概率流为\n$$\nJ(t) = p_A(t)\\,k_{A \\to B}(t) - p_B(t)\\,k_{B \\to A}(t).\n$$\n3. 吸引盆深度与速率之间的关系通过设置以下关系来满足瞬时极限下的细致平衡：\n$$\n\\Delta U(t) = U_B(t) - U_A(t) = \\Delta U_{\\text{base}} + c\\,\\lambda(t),\n$$\n并施加\n$$\n\\frac{k_{A \\to B}(t)}{k_{B \\to A}(t)} = e^{-\\beta \\Delta U(t)},\n$$\n以及调制的对称分裂\n$$\nk_{A \\to B}(t) = k_0\\,e^{-\\frac{\\beta}{2}\\Delta U(t)}, \\quad k_{B \\to A}(t) = k_0\\,e^{+\\frac{\\beta}{2}\\Delta U(t)},\n$$\n其中 $k_0$ 是以 $\\text{s}^{-1}$ 为单位的基线速率，$\\beta$ 是以自然单位表示的逆热能标度 $1/(k_{\\mathrm{B}}T)$，$\\Delta U(t)$ 是以奈特为单位的吸引盆深度差。\n\n鲁棒性约束和协议形状：\n- 鲁棒性目标是要求在一个周期 $T$ 内的时间平均吸引盆深度达到 $\\Delta U_{\\text{target}}$：\n$$\n\\frac{1}{T}\\int_0^T \\Delta U(t)\\,dt = \\Delta U_{\\text{target}}.\n$$\n使用 $\\Delta U(t) = \\Delta U_{\\text{base}} + c\\,\\lambda(t)$，这意味着\n$$\n\\frac{1}{T}\\int_0^T \\lambda(t)\\,dt = m = \\frac{\\Delta U_{\\text{target}} - \\Delta U_{\\text{base}}}{c}.\n$$\n- 为确保在给定固定刺激预算的情况下对不同协议形状进行公平比较，将协议在一个周期内的均方根（RMS）值约束为一个固定值 $L_{\\mathrm{rms}}$：\n$$\n\\sqrt{\\frac{1}{T}\\int_0^T \\lambda^2(t)\\,dt} = L_{\\mathrm{rms}}.\n$$\n设 $S(t)$ 是一个零均值、单位振幅的周期性形状，并将 $\\lambda(t)$ 参数化为\n$$\n\\lambda(t) = m + s\\,S(t),\n$$\n其中选择 $s$ 以满足 RMS 约束。对于给定的形状 $S(t)$，缩放比例为\n$$\ns = \\frac{\\sqrt{L_{\\mathrm{rms}}^2 - m^2}}{\\sqrt{\\frac{1}{T}\\int_0^T S^2(t)\\,dt}},\n$$\n该表达式仅当 $L_{\\mathrm{rms}}^2 \\ge m^2$ 时有实数解；如果 $L_{\\mathrm{rms}}^2  m^2$，则取 $s=0$。待评估的候选形状 $S(t)$ 有：\n- 正弦波：$S_{\\sin}(t) = \\sin\\left(\\frac{2\\pi t}{T}\\right)$，其中 $\\frac{1}{T}\\int_0^T S_{\\sin}^2(t)\\,dt = \\frac{1}{2}$。\n- 方波：$S_{\\mathrm{sq}}(t) = \\mathrm{sign}\\left(\\sin\\left(\\frac{2\\pi t}{T}\\right)\\right)$，其中 $\\frac{1}{T}\\int_0^T S_{\\mathrm{sq}}^2(t)\\,dt = 1$。\n- 三角波：$S_{\\triangle}(t)$ 是在 $[0,T)$ 上振幅为 $1$ 且零均值的分段函数，例如\n$$\nS_{\\triangle}(t) =\n\\begin{cases}\n4\\phi - 1,  \\phi \\in [0,\\frac{1}{2}) \\\\\n-4\\phi + 3,  \\phi \\in [\\frac{1}{2},1)\n\\end{cases}\n$$\n其中 $\\phi = \\left(\\frac{t}{T}\\right) \\bmod 1$，且 $\\frac{1}{T}\\int_0^T S_{\\triangle}^2(t)\\,dt = \\frac{1}{3}$。\n\n目标：\n- 对每个候选形状，计算满足平均深度和 RMS 约束的协议 $\\lambda(t)$，将主方程演化至周期性稳态，然后计算每个周期的总熵产生\n$$\n\\Sigma = \\int_0^T \\sigma(t)\\,dt\n$$\n单位为奈特/周期。在候选形状中，找出最小化 $\\Sigma$ 的那一个。\n\n算法要求：\n- 使用固定时间步长 $\\Delta t$ 对主方程进行数值积分，跨越多个周期以达到周期性稳态。使用显式高阶方法，如四阶 Runge–Kutta 方法。将概率裁剪到开区间 $(0,1)$ 内，以避免对数中的数值奇异点。\n- 在每个时间步长使用 Schnakenberg 表达式计算 $\\sigma(t)$，并使用合适的数值积分法在最后一个周期内对 $\\Sigma$ 进行积分。\n\n单位和输出：\n- 时间参数以秒为单位指定，速率以 $\\text{s}^{-1}$ 为单位，熵产生输出必须以奈特/周期为单位。你的程序的最终输出必须是一行，包含所有测试用例的结果，形式为方括号括起来的逗号分隔列表，其中每个结果是最小化熵的形状的整数索引：$0$ 代表正弦波，$1$ 代表方波，$2$ 代表三角波。\n\n测试套件：\n对于每个测试用例，参数以元组 $(\\beta, k_0, \\Delta U_{\\text{base}}, \\Delta U_{\\text{target}}, c, T, L_{\\mathrm{rms}}, N_{\\text{trans}})$ 的形式给出，其中 $N_{\\text{trans}}$ 是在计算最后一个周期的熵产生之前需要模拟的瞬态周期数。\n\n使用以下测试用例：\n- 用例 1（中等驱动，理想路径）： $(1.0, 0.5, 0.5, 1.0, 1.0, 10.0, 0.6, 10)$\n- 用例 2（准静态慢驱动）： $(1.0, 0.5, 0.5, 1.0, 1.0, 100.0, 0.6, 6)$\n- 用例 3（快驱动，非绝热）： $(1.0, 0.5, 0.5, 1.0, 1.0, 1.0, 0.4, 20)$\n- 用例 4（超出平均要求的最小控制）： $(1.0, 0.5, 0.5, 1.0, 1.0, 10.0, 0.51, 10)$\n- 用例 5（强耦合与中等周期）： $(1.5, 0.5, 0.3, 0.9, 2.0, 5.0, 0.7, 12)$\n\n你的程序应产生一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，\"[result1,result2,result3,result4,result5]\"），其中每个“result”是对应测试用例下，使每个周期的总熵产生最小化的形状的整数索引。",
            "solution": "该问题要求在三个候选（正弦波、方波、三角波）周期性控制协议中，找到使双稳态细胞开关每个周期的总熵产生最小化的协议。该系统被建模为一个受控制协议约束的两状态连续时间马尔可夫过程。解决方案需要采用数值方法，其主要步骤如下：协议参数化、模拟系统动力学以找到周期性稳态，以及随后计算熵产生。\n\n**1. 协议参数化**\n\n控制协议 $\\lambda(t)$ 是周期为 $T$ 的周期函数。它受到目标时间平均吸引盆深度和固定均方根（RMS）值的约束。这些约束决定了每种候选形状下 $\\lambda(t)$ 的具体形式。\n\n协议被参数化为 $\\lambda(t) = m + s\\,S(t)$，其中 $S(t)$ 是一个零均值、单位振幅的周期函数，代表形状（正弦、方形或三角形），$m$ 是均值， $s$ 是振幅缩放因子。\n\n- 均值 $m$ 由关于时间平均吸引盆深度的鲁棒性约束固定，即 $\\frac{1}{T}\\int_0^T \\Delta U(t)\\,dt = \\Delta U_{\\text{target}}$。给定 $\\Delta U(t) = \\Delta U_{\\text{base}} + c\\,\\lambda(t)$，并且 $\\frac{1}{T}\\int_0^T S(t)\\,dt = 0$，我们得到：\n    $$m = \\frac{1}{T}\\int_0^T \\lambda(t)\\,dt = \\frac{\\Delta U_{\\text{target}} - \\Delta U_{\\text{base}}}{c}$$\n- 缩放因子 $s$ 由 RMS 约束确定，即 $\\sqrt{\\frac{1}{T}\\int_0^T \\lambda^2(t)\\,dt} = L_{\\mathrm{rms}}$。将其平方并代入 $\\lambda(t) = m + s\\,S(t)$ 得：\n    $$L_{\\mathrm{rms}}^2 = \\frac{1}{T}\\int_0^T (m + s\\,S(t))^2\\,dt = m^2 + s^2 \\left(\\frac{1}{T}\\int_0^T S^2(t)\\,dt\\right)$$\n    解出 $s$ 得：\n    $$s = \\frac{\\sqrt{L_{\\mathrm{rms}}^2 - m^2}}{\\sqrt{\\frac{1}{T}\\int_0^T S^2(t)\\,dt}}$$\n    这在 $L_{\\mathrm{rms}}^2 \\ge m^2$ 时有效。如果 $L_{\\mathrm{rms}}^2  m^2$，则无法用实数 $s$ 满足此约束，因此我们取 $s=0$。问题给出了每种形状的均方值：正弦波为 $1/2$，方波为 $1$，三角波为 $1/3$。\n\n**2. 系统动力学和数值模拟**\n\n系统的状态由处于状态 $A$ 的概率 $p_A(t)$ 描述。$p_A(t)$ 的时间演化由主方程决定：\n$$ \\frac{dp_A}{dt} = -p_A(t)\\,k_{A \\to B}(t) + (1-p_A(t))\\,k_{B \\to A}(t) $$\n这是一个具有含时系数的一阶线性常微分方程（ODE）。跃迁速率 $k_{A \\to B}(t)$ 和 $k_{B \\to A}(t)$ 通过吸引盆深度差 $\\Delta U(t)$ 依赖于协议 $\\lambda(t)$：\n$$ \\Delta U(t) = \\Delta U_{\\text{base}} + c\\,\\lambda(t) $$\n$$ k_{A \\to B}(t) = k_0\\,e^{-\\frac{\\beta}{2}\\Delta U(t)}, \\quad k_{B \\to A}(t) = k_0\\,e^{+\\frac{\\beta}{2}\\Delta U(t)} $$\n由于速率是周期为 $T$ 的周期函数，系统会演化到一个唯一的周期性稳态，其中 $p_A(t+T) = p_A(t)$。为了找到这个状态，我们从任意初始条件（例如，$p_A(0)=0.5$）开始，对 ODE 进行数值积分，经过多个瞬态周期（$N_{\\text{trans}}$），直到解变为周期性。\n\n积分使用四阶 Runge-Kutta（RK4）方法，采用固定的时间步长 $\\Delta t$，该步长选择为周期 $T$ 的一小部分（例如，$\\Delta t = T/2000$）以确保数值稳定性和准确性。令 $f(t, p_A) = \\frac{dp_A}{dt}$。从时间 $t_i$ 到 $t_{i+1} = t_i + \\Delta t$ 的 RK4 更新规则是：\n$$ p_A(t_{i+1}) = p_A(t_i) + \\frac{\\Delta t}{6}(k_1 + 2k_2 + 2k_3 + k_4) $$\n其中：\n$$ k_1 = f(t_i, p_A(t_i)) $$\n$$ k_2 = f(t_i + \\frac{\\Delta t}{2}, p_A(t_i) + \\frac{\\Delta t}{2}k_1) $$\n$$ k_3 = f(t_i + \\frac{\\Delta t}{2}, p_A(t_i) + \\frac{\\Delta t}{2}k_2) $$\n$$ k_4 = f(t_i + \\Delta t, p_A(t_i) + \\Delta t k_3) $$\n为防止熵公式中对数出现数值问题，每一步之后将概率 $p_A$ 裁剪到区间 $(0, 1)$ 内的一个小的 epsilon 范围内。\n\n**3. 熵产生计算**\n\n一旦系统达到周期性稳态，我们计算一个周期内的总熵产生 $\\Sigma$。瞬时熵产生率 $\\sigma(t)$ 由 Schnakenberg 公式给出：\n$$ \\sigma(t) = J(t)\\,\\ln\\left(\\frac{k_{A \\to B}(t)\\,p_A(t)}{k_{B \\to A}(t)\\,p_B(t)}\\right) $$\n其中 $p_B(t) = 1 - p_A(t)$，净概率流 $J(t)$ 为：\n$$ J(t) = p_A(t)\\,k_{A \\to B}(t) - p_B(t)\\,k_{B \\to A}(t) $$\n使用关系 $\\frac{k_{A \\to B}(t)}{k_{B \\to A}(t)} = e^{-\\beta \\Delta U(t)}$，对数的参数可以简化，得到：\n$$ \\sigma(t) = J(t) \\left(-\\beta \\Delta U(t) + \\ln\\left(\\frac{p_A(t)}{1-p_A(t)}\\right)\\right) $$\n每个周期的总熵产生 $\\Sigma$ 是 $\\sigma(t)$ 在模拟最后一个周期上的积分：\n$$ \\Sigma = \\int_{N_{\\text{trans}}T}^{(N_{\\text{trans}}+1)T} \\sigma(t)\\,dt $$\n该积分使用梯形法则进行数值计算，将在最后一个周期的每个时间步 $t_i$ 计算的 $\\sigma(t_i)\\Delta t$ 值相加。\n\n**4. 优化**\n\n对三种候选协议形状（正弦、方波、三角波）分别执行上述过程。比较得到的总熵产生值 $\\Sigma_{\\sin}$、$\\Sigma_{\\text{sq}}$ 和 $\\Sigma_{\\triangle}$。与最小 $\\Sigma$ 值对应的形状被确定为给定参数集的最优协议。对每个提供的测试用例重复此过程。\n```python\nimport numpy as np\n\n# A small constant for clipping probabilities to avoid log(0) or division by zero.\nEPS = 1e-12\n\ndef s_sin(t, T):\n    \"\"\"Sine wave shape function.\"\"\"\n    return np.sin(2 * np.pi * t / T)\n\ndef s_sq(t, T):\n    \"\"\"Square wave shape function.\"\"\"\n    val = np.sign(np.sin(2 * np.pi * t / T))\n    # Ensure it's -1 or 1 for robustness if t is an exact multiple of T/2\n    if isinstance(val, np.ndarray):\n        val[val == 0] = 1.0 # Arbitrarily set to 1 at discontinuities\n    elif val == 0:\n        val = 1.0\n    return val\n\ndef s_triangle_vec(t, T):\n    \"\"\"Vectorized triangle wave shape function.\"\"\"\n    phi = (t / T) % 1.0\n    return np.where(phi  0.5, 4 * phi - 1, -4 * phi + 3)\n\n# Dictionary of shape properties: (shape_function, mean_square_integral)\nSHAPES = {\n    0: (s_sin, 0.5),           # Index 0 for sine\n    1: (s_sq, 1.0),            # Index 1 for square\n    2: (s_triangle_vec, 1.0 / 3.0) # Index 2 for triangle\n}\n\ndef dpA_dt(t, p_A, params):\n    \"\"\"\n    Calculates the derivative dp_A/dt for the master equation.\n    f(t, p_A) = k_BA(t) - p_A(t) * (k_AB(t) + k_BA(t))\n    \"\"\"\n    beta, k0, c, T, m, s, S_func, dU_base = params\n    \n    # Calculate protocol and rates at time t\n    lambda_t = m + s * S_func(t, T)\n    dU_t = dU_base + c * lambda_t\n    \n    k_ab_t = k0 * np.exp(-0.5 * beta * dU_t)\n    k_ba_t = k0 * np.exp(0.5 * beta * dU_t)\n    \n    return k_ba_t - p_A * (k_ab_t + k_ba_t)\n\ndef compute_total_entropy(case_params, shape_idx):\n    \"\"\"\n    Computes the total entropy production per period for a given protocol shape.\n    \"\"\"\n    beta, k0, dU_base, dU_target, c, T, L_rms, N_trans = case_params\n    \n    # Numerical integration parameters\n    N_steps_per_period = 2000\n    dt = T / N_steps_per_period\n    total_steps = (N_trans + 1) * N_steps_per_period\n    \n    # Calculate protocol parameters m and s\n    m = (dU_target - dU_base) / c\n    S_func, S_sq_int = SHAPES[shape_idx]\n    \n    if L_rms**2  m**2:\n        s = 0.0\n    else:\n        s = np.sqrt(L_rms**2 - m**2) / np.sqrt(S_sq_int)\n        \n    ode_params = (beta, k0, c, T, m, s, S_func, dU_base)\n    \n    # RK4 integration to find the periodic steady state\n    p_A = np.zeros(total_steps + 1)\n    p_A[0] = 0.5  # Initial condition\n    \n    time_points = np.linspace(0, (N_trans + 1) * T, total_steps + 1)\n    \n    for i in range(total_steps):\n        t_i = time_points[i]\n        p_A_i = p_A[i]\n        \n        # RK4 steps\n        k1 = dpA_dt(t_i, p_A_i, ode_params)\n        k2 = dpA_dt(t_i + dt/2, p_A_i + dt/2 * k1, ode_params)\n        k3 = dpA_dt(t_i + dt/2, p_A_i + dt/2 * k2, ode_params)\n        k4 = dpA_dt(t_i + dt, p_A_i + dt * k3, ode_params)\n        \n        p_A[i+1] = p_A_i + (dt/6) * (k1 + 2*k2 + 2*k3 + k4)\n        \n        # Clip probability to avoid numerical singularities\n        p_A[i+1] = np.clip(p_A[i+1], EPS, 1.0 - EPS)\n        \n    # Extract the last period for entropy calculation\n    start_idx = N_trans * N_steps_per_period\n    final_p_A = p_A[start_idx:]\n    final_t = time_points[start_idx:]\n    \n    # Compute instantaneous entropy production rate sigma(t) over the last period\n    lambda_t = m + s * S_func(final_t, T)\n    dU_t = dU_base + c * lambda_t\n    \n    k_ab_t = k0 * np.exp(-0.5 * beta * dU_t)\n    k_ba_t = k0 * np.exp(0.5 * beta * dU_t)\n    \n    final_p_B = 1.0 - final_p_A\n    \n    # Net probability current J(t)\n    J_t = final_p_A * k_ab_t - final_p_B * k_ba_t\n    \n    # Affinity term in the entropy production formula\n    log_term = -beta * dU_t + np.log(final_p_A / final_p_B)\n    \n    sigma_t = J_t * log_term\n    \n    # Integrate total entropy production Sigma using trapezoidal rule\n    Sigma = np.trapz(sigma_t, final_t)\n    \n    return Sigma\n\ndef solve():\n    \"\"\"\n    Main solver function to run all test cases and find the entropy-minimizing shape.\n    \"\"\"\n    test_cases = [\n        # (beta, k0, dU_base, dU_target, c, T, L_rms, N_trans)\n        (1.0, 0.5, 0.5, 1.0, 1.0, 10.0, 0.6, 10),\n        (1.0, 0.5, 0.5, 1.0, 1.0, 100.0, 0.6, 6),\n        (1.0, 0.5, 0.5, 1.0, 1.0, 1.0, 0.4, 20),\n        (1.0, 0.5, 0.5, 1.0, 1.0, 10.0, 0.51, 10),\n        (1.5, 0.5, 0.3, 0.9, 2.0, 5.0, 0.7, 12)\n    ]\n\n    results = []\n    for case in test_cases:\n        entropies = []\n        for shape_idx in range(len(SHAPES)):\n            sigma_total = compute_total_entropy(case, shape_idx)\n            entropies.append(sigma_total)\n        \n        # Find the index of the shape that minimizes entropy production\n        min_entropy_idx = np.argmin(entropies)\n        results.append(min_entropy_idx)\n\n    return f\"[{','.join(map(str, results))}]\"\n\n```",
            "answer": "[2,2,0,2,2]"
        }
    ]
}