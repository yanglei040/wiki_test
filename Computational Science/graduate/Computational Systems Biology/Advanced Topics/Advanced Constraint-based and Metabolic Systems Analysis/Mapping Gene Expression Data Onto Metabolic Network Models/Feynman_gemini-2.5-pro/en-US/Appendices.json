{
    "hands_on_practices": [
        {
            "introduction": "To bridge the gap between high-throughput transcriptomic data and metabolic function, we must first convert raw sequencing reads into a quantitative measure of gene expression. This exercise guides you through the process of calculating Transcripts Per Million (TPM), a widely used metric that normalizes for both gene length and sequencing depth, ensuring that expression values are comparable across genes and samples.\n\nOnce gene-level expression is quantified, the next step is to infer the activity of the metabolic reactions they catalyze. This practice  challenges you to apply Gene-Protein-Reaction (GPR) rules, which are logical statements that describe how gene products assemble into functional enzymes. By translating the Boolean logic of GPRs into mathematical operations, you will learn how to estimate a reaction's potential activity from the expression levels of its associated genes.",
            "id": "3324702",
            "problem": "You are given a small RNA Sequencing (RNA-Seq) dataset for a single condition, consisting of raw read counts and gene lengths for four genes that encode enzymes associated with two metabolic reactions in a genome-scale model. Use the standard definition of Transcripts Per Million (TPM) as a length-normalized and library-size-normalized measure of transcript abundance. The dataset is as follows: gene $g_{1}$ has length $2000$ base pairs and $500$ mapped reads; gene $g_{2}$ has length $1000$ base pairs and $1000$ mapped reads; gene $g_{3}$ has length $3000$ base pairs and $300$ mapped reads; gene $g_{4}$ has length $1500$ base pairs and $1200$ mapped reads. Consider two reactions with Gene-Protein-Reaction (GPR) associations: reaction $\\mathcal{R}_{1}$ is catalyzed by an obligate heteromeric complex requiring both subunits encoded by $g_{1}$ AND $g_{2}$; reaction $\\mathcal{R}_{2}$ is catalyzed by two isoenzymes encoded by $g_{3}$ OR $g_{4}$. Starting from the Central Dogma of molecular biology (deoxyribonucleic acid to ribonucleic acid to protein) and the principle that RNA-Seq read counts are proportional to transcript abundance times transcript effective length, derive the TPM computation and compute TPM for each gene. Then, using first-principles reasoning about enzyme complex stoichiometry and isoenzyme additivity, derive how to aggregate gene-level TPMs into a single reaction activity score for $\\mathcal{R}_{1}$ and $\\mathcal{R}_{2}$. Finally, compute the reaction activity score for $\\mathcal{R}_{1}$ using the derived aggregation and report it as a single unitless decimal number. Round your answer to four significant figures.",
            "solution": "The problem requires a multi-step derivation and calculation, starting from fundamental principles of molecular biology and data analysis to compute a reaction activity score. The process involves three main parts: first, deriving the formula for Transcripts Per Million (TPM) and calculating it for four genes; second, deriving the logic for aggregating gene-level expression data into reaction-level scores based on Gene-Protein-Reaction (GPR) rules; and third, applying this logic to compute the score for reaction $\\mathcal{R}_{1}$.\n\nThe provided data for the four genes are:\n- Gene $g_{1}$: length $L_1 = 2000$ base pairs (bp), read count $C_1 = 500$.\n- Gene $g_{2}$: length $L_2 = 1000$ bp, read count $C_2 = 1000$.\n- Gene $g_{3}$: length $L_3 = 3000$ bp, read count $C_3 = 300$.\n- Gene $g_{4}$: length $L_4 = 1500$ bp, read count $C_4 = 1200$.\n\nThe GPR associations are:\n- Reaction $\\mathcal{R}_{1}$: $g_{1}$ AND $g_{2}$ (obligate heteromeric complex).\n- Reaction $\\mathcal{R}_{2}$: $g_{3}$ OR $g_{4}$ (isoenzymes).\n\nPart 1: Derivation and Computation of Transcripts Per Million (TPM)\n\nThe problem states that RNA-Seq read counts are proportional to transcript abundance and effective transcript length. For a given gene $g_i$, its read count $C_i$ can be modeled as being proportional to the molar concentration of its corresponding transcript, which we denote as its abundance $A_i$, and its length $L_i$.\n$$C_i \\propto A_i \\cdot L_i$$\nThis relationship implies that to estimate the relative abundance $A_i$, we must normalize the read count $C_i$ by the gene length $L_i$.\n$$A_i \\propto \\frac{C_i}{L_i}$$\nThe term $\\frac{C_i}{L_i}$ represents the rate of reads mapping per base of the transcript. Let us define this rate as $r_i = \\frac{C_i}{L_i}$. This step normalizes for gene length.\n\nHowever, these rates $r_i$ are also dependent on the total sequencing depth of the library. To make expression levels comparable across different samples (or, in this case, to create a normalized measure within a single sample), we must also normalize by library size. TPM accomplishes this by expressing each gene's rate $r_i$ as a fraction of the total rates for all genes, and then scaling this fraction to a 'per million' value.\n\nThe sum of all rates, $\\sum_{j} r_j = \\sum_{j} \\frac{C_j}{L_j}$, is a proxy for the total number of mapped reads divided by the length of the transcriptome, and thus serves as a measure of library size. The TPM for gene $g_i$ is defined as the fraction of total rates that is attributable to gene $g_i$, scaled by $10^6$.\n$$\n\\text{TPM}_i = \\left(\\frac{r_i}{\\sum_{j} r_j}\\right) \\times 10^6 = \\left(\\frac{C_i / L_i}{\\sum_{j} (C_j / L_j)}\\right) \\times 10^6\n$$\nNow, we compute the TPM for each of the four genes. It is convenient to express gene lengths in kilobase pairs (kb) to simplify the numbers, where $1 \\text{ kb} = 1000 \\text{ bp}$.\n- $L_1 = 2.0$ kb, $C_1 = 500$\n- $L_2 = 1.0$ kb, $C_2 = 1000$\n- $L_3 = 3.0$ kb, $C_3 = 300$\n- $L_4 = 1.5$ kb, $C_4 = 1200$\n\nFirst, we calculate the rates $r_i = C_i/L_i$ (in units of reads per kb):\n- $r_1 = \\frac{500}{2.0} = 250$\n- $r_2 = \\frac{1000}{1.0} = 1000$\n- $r_3 = \\frac{300}{3.0} = 100$\n- $r_4 = \\frac{1200}{1.5} = 800$\n\nNext, we calculate the sum of these rates, which is the normalization factor for the library size:\n$$\n\\sum_{j=1}^{4} r_j = r_1 + r_2 + r_3 + r_4 = 250 + 1000 + 100 + 800 = 2150\n$$\nFinally, we compute the TPM for each gene:\n- $\\text{TPM}_1 = \\frac{r_1}{\\sum r_j} \\times 10^6 = \\frac{250}{2150} \\times 10^6 \\approx 116279.07$\n- $\\text{TPM}_2 = \\frac{r_2}{\\sum r_j} \\times 10^6 = \\frac{1000}{2150} \\times 10^6 \\approx 465116.28$\n- $\\text{TPM}_3 = \\frac{r_3}{\\sum r_j} \\times 10^6 = \\frac{100}{2150} \\times 10^6 \\approx 46511.63$\n- $\\text{TPM}_4 = \\frac{r_4}{\\sum r_j} \\times 10^6 = \\frac{800}{2150} \\times 10^6 \\approx 372093.02$\n\nPart 2: Derivation of GPR Aggregation Rules\n\nThe Central Dogma states that genetic information flows from DNA to RNA to protein. We assume that the abundance of a gene's transcript (mRNA), as measured by TPM, is a reasonable proxy for the abundance of the protein it encodes. The GPR rules describe how these proteins combine to form functional enzymes that catalyze metabolic reactions.\n\nFor reaction $\\mathcal{R}_{2}$ ($g_{3}$ OR $g_{4}$), the OR logical operator signifies that the proteins encoded by $g_{3}$ and $g_{4}$ are isoenzymes. Each can independently catalyze the reaction. Therefore, the total catalytic capacity for $\\mathcal{R}_{2}$ is the sum of the capacities of the individual enzymes. The reaction score is the sum of the expression levels of the corresponding genes.\n$$\n\\text{Score}(\\mathcal{R}_\\text{OR}) = \\sum_i \\text{TPM}_i\n$$\nSo, for $\\mathcal{R}_{2}$, $\\text{Score}(\\mathcal{R}_2) = \\text{TPM}_3 + \\text{TPM}_4$.\n\nFor reaction $\\mathcal{R}_{1}$ ($g_{1}$ AND $g_{2}$), the AND logical operator signifies that the proteins encoded by $g_{1}$ and $g_{2}$ are both required, forming an obligate heteromeric complex. The assembly of this functional complex depends on the availability of all its constituent subunits. According to the principle of limiting reactants (derived from the law of mass action), the rate of formation of the final product (the enzyme complex) is limited by the subunit that is least abundant. Therefore, the total amount of functional enzyme complex, and thus the reaction's catalytic capacity, is determined by the minimum of the abundances of its subunits. The reaction score is the minimum of the expression levels of the required genes.\n$$\n\\text{Score}(\\mathcal{R}_\\text{AND}) = \\min(\\{\\text{TPM}_i\\})\n$$\nSo, for $\\mathcal{R}_{1}$, $\\text{Score}(\\mathcal{R}_1) = \\min(\\text{TPM}_1, \\text{TPM}_2)$.\n\nPart 3: Computation of Reaction Activity Score for $\\mathcal{R}_{1}$\n\nUsing the rule derived for the AND relationship and the TPM values calculated in Part 1, we can compute the activity score for reaction $\\mathcal{R}_{1}$.\n$$\n\\text{Score}(\\mathcal{R}_1) = \\min(\\text{TPM}_1, \\text{TPM}_2)\n$$\nSubstituting the calculated values:\n$$\n\\text{Score}(\\mathcal{R}_1) = \\min(116279.069..., 465116.279...)\n$$\nThe minimum of these two values is $\\text{TPM}_1$.\n$$\n\\text{Score}(\\mathcal{R}_1) = 116279.069...\n$$\nThe problem requires this answer to be rounded to four significant figures. The first four significant digits are $1, 1, 6, 2$. The fifth digit is $7$, which is greater than or equal to $5$, so we round up the fourth digit. The digit $2$ becomes $3$. The remaining digits are replaced with zeros to maintain the magnitude of the number.\n$$\n\\text{Score}(\\mathcal{R}_1) \\approx 116300\n$$\nThus, the reaction activity score for $\\mathcal{R}_{1}$ is $116300$.",
            "answer": "$$\n\\boxed{116300}\n$$"
        },
        {
            "introduction": "After estimating the activity state of individual reactions, a key challenge is to understand how these local constraints propagate through the entire metabolic network. This requires a framework that respects both the gene expression data and the fundamental biophysical constraints of the system, such as mass balance. The Integrative Metabolic Analysis Tool (iMAT) algorithm provides an elegant solution by formulating this problem as a mixed-integer linear program (MILP).\n\nThis exercise  asks you to construct the iMAT formulation for a small, well-defined metabolic network. You will use binary variables to represent the on/off state of reactions and define an objective function that seeks a flux distribution maximally consistent with predefined sets of highly and lowly expressed genes. This practice provides a concrete look into how systems-level predictions are made by integrating transcriptomic data into a stoichiometric model.",
            "id": "3324646",
            "problem": "Consider a minimal metabolic network of three intracellular metabolites $A$, $B$, and $C$ connected by $4$ irreversible reactions $R_1, R_2, R_3, R_4$. The stoichiometric matrix $S \\in \\mathbb{R}^{3 \\times 4}$ encodes the steady-state mass balance constraints for metabolites $A$, $B$, and $C$ via $S v = 0$, where $v \\in \\mathbb{R}^{4}$ is the reaction flux vector. The reactions are:\n- $R_1$: Uptake of metabolite $A$ from the environment, increasing intracellular $A$, with stoichiometry $+1$ for $A$ and bounds $0 \\leq v_1 \\leq U_1$,\n- $R_2$: Conversion $A \\to B$ with stoichiometry $-1$ for $A$, $+1$ for $B$ and bounds $0 \\leq v_2 \\leq U_2$,\n- $R_3$: Conversion $B \\to C$ with stoichiometry $-1$ for $B$, $+1$ for $C$ and bounds $0 \\leq v_3 \\leq U_3$,\n- $R_4$: Loss of $C$ to a biomass sink with stoichiometry $-1$ for $C$ and bounds $0 \\leq v_4 \\leq U_4$.\n\nExplicitly, the stoichiometric matrix $S$ is\n$$\nS \\;=\\; \\begin{pmatrix}\n+1 & -1 & 0 & 0 \\\\\n0 & +1 & -1 & 0 \\\\\n0 & 0 & +1 & -1\n\\end{pmatrix},\n$$\nso that the steady-state mass balance constraints are\n$$\nv_1 - v_2 = 0, \\quad v_2 - v_3 = 0, \\quad v_3 - v_4 = 0,\n$$\nand each reaction flux is nonnegative and bounded above by\n$$\n0 \\leq v_j \\leq U_j, \\quad j \\in \\{1,2,3,4\\}.\n$$\n\nSuppose discretized gene expression integration is performed using the Integrative Metabolic Analysis Tool (iMAT), which maps high and low expression sets to desired reaction activity states. Let the high-expression set be $H = \\{2,3\\}$ and the low-expression set be $L = \\{4\\}$. Reaction $R_1$ is neither high nor low. Let the minimal activity threshold be $\\delta > 0$, so that an active reaction must carry at least $\\delta$ flux, and let the upper bounds be $U_1 = U_2 = U_3 = U_4 = 10$.\n\nStarting from the principles of Flux Balance Analysis (FBA), namely the steady-state constraint $S v = 0$ and reaction bounds, and the Gene-Protein-Reaction (GPR) mapping concept that associates discretized expression states to desired reaction activity states, formulate the mixed-integer linear program for iMAT that maximizes consistency with the high and low expression sets while enforcing $S v = 0$ and flux bounds. Use binary activity variables $y_j \\in \\{0,1\\}$ to indicate whether reaction $j$ is active. Explicitly write down the objective function and all constraints needed to link $y_j$ and $v_j$, ensuring scientific realism for irreversible reactions.\n\nThen, for the specified toy network with $H = \\{2,3\\}$, $L = \\{4\\}$, $U_j = 10$ for all $j$, and minimal activity threshold $\\delta = 1$, determine the optimal objective value of the iMAT formulation. Express the optimal objective value as a single integer. No rounding is needed, and no units are required for the reported number.",
            "solution": "The solution is presented in two parts as requested: first, the general formulation of the iMAT mixed-integer linear program (MILP), and second, the solution for the specific instance provided.\n\n#### Part 1: General iMAT Formulation\nThe objective of the Integrative Metabolic Analysis Tool (iMAT) is to find a steady-state flux distribution $v$ that maximizes its consistency with gene expression data. The data is provided as a set of reactions associated with highly expressed genes, $H$, which should preferably be active, and a set of reactions associated with lowly expressed genes, $L$, which should preferably be inactive. This can be formulated as an MILP.\n\n**Variables:**\n-   $v_j \\in \\mathbb{R}$: the flux of reaction $j$. Since all reactions are irreversible, $v_j \\ge 0$.\n-   $y_j \\in \\{0, 1\\}$: a binary variable indicating the activity state of reaction $j$. $y_j=1$ if reaction $j$ is active (carries flux above a certain threshold), and $y_j=0$ if it is inactive (carries zero flux).\n\n**Objective Function:**\nThe goal is to maximize the number of agreements between the flux state and the expression data. A point is awarded for each reaction in $H$ that is active and for each reaction in $L$ that is inactive.\n-   For a reaction $j \\in H$, consistency means it is active, i.e., $y_j=1$.\n-   For a reaction $j \\in L$, consistency means it is inactive, i.e., $y_j=0$. This is equivalent to $1-y_j=1$.\nThe objective function to maximize is the total count of consistent states:\n$$ \\text{maximize} \\quad Z = \\sum_{j \\in H} y_j + \\sum_{j \\in L} (1 - y_j) $$\n\n**Constraints:**\n1.  **Steady-State Mass Balance**: The net production of each internal metabolite must be zero at steady state.\n    $$ S v = 0 $$\n2.  **Flux Capacity Constraints**: Each reaction flux $v_j$ is constrained by its lower and upper bounds. For the given irreversible reactions:\n    $$ 0 \\leq v_j \\leq U_j \\quad \\forall j $$\n3.  **Flux-Activity Coupling**: The binary activity variables $y_j$ must be linked to the continuous flux variables $v_j$. A reaction $j$ is defined as active ($y_j=1$) if its flux $v_j$ is greater than or equal to a minimal threshold $\\delta > 0$, and inactive ($y_j=0$) if its flux is zero. For an irreversible reaction, this is enforced by two inequalities:\n    $$ \\delta \\cdot y_j \\leq v_j $$\n    $$ v_j \\leq U_j \\cdot y_j $$\n    If $y_j=0$, these constraints simplify to $0 \\leq v_j \\leq 0$, forcing $v_j=0$. If $y_j=1$, they become $\\delta \\leq v_j \\leq U_j$, enforcing the active state. These two constraints must hold for all reactions $j$ for which an activity state is defined, typically all reactions in $H \\cup L$ and any other reactions coupled to them. For a complete formulation, we apply them to all reactions $j \\in \\{1, 2, 3, 4\\}$.\n\nCombining these elements, the complete MILP is:\n$$ \\begin{aligned}\n\\text{maximize} \\quad & \\sum_{j \\in H} y_j + \\sum_{j \\in L} (1 - y_j) \\\\\n\\text{subject to} \\quad & S v = 0 \\\\\n& 0 \\leq v_j \\leq U_j & \\forall j \\\\\n& \\delta \\cdot y_j \\leq v_j \\leq U_j \\cdot y_j & \\forall j \\\\\n& v_j \\in \\mathbb{R}_{\\ge 0} & \\forall j \\\\\n& y_j \\in \\{0, 1\\} & \\forall j\n\\end{aligned} $$\n\n#### Part 2: Solution for the Specific Network\nWe now apply this formulation to the given network with parameters $H = \\{2, 3\\}$, $L = \\{4\\}$, $U_j = 10$ for all $j$, and $\\delta = 1$.\n\nThe specific MILP is:\n**Objective Function:**\n$$ \\text{maximize} \\quad Z = y_2 + y_3 + (1 - y_4) $$\n\n**Constraints:**\n1.  $v_1 - v_2 = 0$\n2.  $v_2 - v_3 = 0$\n3.  $v_3 - v_4 = 0$\n4.  $0 \\leq v_j \\leq 10$ for $j \\in \\{1, 2, 3, 4\\}$\n5.  $1 \\cdot y_j \\leq v_j \\leq 10 \\cdot y_j$ for $j \\in \\{1, 2, 3, 4\\}$\n6.  $v_j \\in \\mathbb{R}_{\\ge 0}$, $y_j \\in \\{0, 1\\}$ for $j \\in \\{1, 2, 3, 4\\}$\n\nFrom constraints $1, 2, 3$, all fluxes must be equal. Let $v_{common} = v_1 = v_2 = v_3 = v_4$. The problem simplifies significantly. The coupling constraints for all four reactions must hold for this single flux value $v_{common}$:\n$$ y_j \\leq v_{common} \\leq 10 \\cdot y_j \\quad \\text{for } j=1, 2, 3, 4 $$\n\nWe can now analyze the possible scenarios based on the value of $v_{common}$.\n\n**Case 1: The network is inactive.**\nLet's assume the flux through the pathway is zero, $v_{common} = 0$.\nThe constraint $y_j \\leq v_{common}$ becomes $y_j \\leq 0$. Since $y_j$ must be $0$ or $1$, this forces $y_j=0$ for all $j \\in \\{1, 2, 3, 4\\}$.\nThe right-hand side of the constraint, $v_{common} \\leq 10 \\cdot y_j$, becomes $0 \\leq 10 \\cdot 0$, which is $0 \\leq 0$. This is satisfied.\nSo, a feasible solution is $v_1=v_2=v_3=v_4=0$ and $y_1=y_2=y_3=y_4=0$.\nFor this solution, the objective function value is:\n$$ Z = y_2 + y_3 + (1 - y_4) = 0 + 0 + (1 - 0) = 1 $$\n\n**Case 2: The network is active.**\nLet's assume the flux through the pathway is non-zero, $v_{common} > 0$.\nThe constraint $v_{common} \\leq 10 \\cdot y_j$ implies that if $y_j=0$, then $v_{common} \\leq 0$. This contradicts our assumption $v_{common} > 0$. Therefore, if the pathway is active, we must have $y_j=1$ for all $j \\in \\{1, 2, 3, 4\\}$.\nWith $y_j=1$ for all $j$, the coupling constraints become:\n$$ 1 \\leq v_{common} \\leq 10 $$\nAny choice of $v_{common}$ in the interval $[1, 10]$ (e.g., $v_{common}=5$) constitutes a feasible solution where all reactions are active.\nIn this case, we have the binary variable assignment $y_1=1, y_2=1, y_3=1, y_4=1$.\nThe objective function value is:\n$$ Z = y_2 + y_3 + (1 - y_4) = 1 + 1 + (1 - 1) = 2 $$\n\n**Conclusion:**\nWe have found two possible types of feasible solutions, corresponding to the entire pathway being off or on.\n-   If the pathway is off, the objective value is $1$. This solution is consistent with the low-expression data for $R_4$ but inconsistent with the high-expression data for $R_2$ and $R_3$.\n-   If the pathway is on, the objective value is $2$. This solution is consistent with the high-expression data for $R_2$ and $R_3$ but inconsistent with the low-expression data for $R_4$.\n\nThe goal of the MILP is to maximize the objective function. Comparing the two cases, the maximum achievable value is $2$. This is the optimal objective value.",
            "answer": "$$\n\\boxed{2}\n$$"
        },
        {
            "introduction": "While methods like iMAT are powerful, their reliance on \"hard\" on/off constraints can be a simplification, as biological systems often operate in intermediate states and face trade-offs between competing objectives. A more nuanced approach treats gene expression not as a strict directive but as a \"soft\" constraint, creating a model that balances the drive for a biological function, like growth, against the desirability of adhering to the measured expression profile.\n\nThis advanced practice  introduces a multi-objective optimization framework to explore this very trade-off. You will formulate a linear program that simultaneously maximizes the growth rate $\\mu$ while minimizing the \"discordance\" between metabolic fluxes and the capacities implied by gene expression. By solving for different values of a trade-off parameter $\\lambda$, you will trace the Pareto front, revealing the spectrum of optimal states from maximum growth to maximum expression consistency.",
            "id": "3324661",
            "problem": "Consider a small, scientifically plausible metabolic network model under steady-state assumptions. The network has $3$ internal metabolites (Glucose, Pyruvate, Precursor) and $5$ reactions, with flux vector $v \\in \\mathbb{R}^5$ ordered as follows: $v_1$ (uptake, $\\rightarrow$ Glucose), $v_2$ (glycolysis, Glucose $\\rightarrow$ Pyruvate), $v_3$ (conversion, Pyruvate $\\rightarrow$ Precursor), $v_4$ (secretion, Pyruvate $\\rightarrow$ $\\emptyset$), and $v_5$ (biomass, Precursor $\\rightarrow$ Biomass). The steady-state (mass balance) constraints are encoded by the stoichiometric matrix $S \\in \\mathbb{R}^{3 \\times 5}$ and the equality $S v = 0$, with rows (metabolites) and columns (reactions) defined so that:\n- For Glucose: $+1 \\cdot v_1 - 1 \\cdot v_2 = 0$,\n- For Pyruvate: $+1 \\cdot v_2 - 1 \\cdot v_3 - 1 \\cdot v_4 = 0$,\n- For Precursor: $+1 \\cdot v_3 - 1 \\cdot v_5 = 0$.\n\nAssume reaction flux bounds consistent with Flux Balance Analysis (FBA) are $v_1 \\in [0, 10]$ (mmol per gram dry weight per hour), and $v_2, v_3, v_4, v_5 \\in [0, 100]$ (mmol per gram dry weight per hour). All fluxes are nonnegative.\n\nLet $e \\in \\mathbb{R}^5$ denote the gene expression levels mapped to the reactions via a one-to-one gene–protein–reaction association. Assume $e$ is dimensionless and scaled so that $e_r$ is proportional to enzyme abundance for reaction $r$. Let $\\kappa > 0$ be a proportionality factor mapping expression to an implied flux capacity. To penalize discordance between flux and expression, define nonnegative slack variables $t \\in \\mathbb{R}^5_{\\ge 0}$ satisfying, for each reaction $r$,\n$$t_r \\ge \\max\\left(0, v_r - \\kappa e_r\\right),$$\nwhich can be enforced via linear inequalities\n$$v_r - t_r \\le \\kappa e_r, \\quad t_r \\ge 0.$$\n\nLet the growth rate be $ \\mu = v_5$ (per hour). Consider the scalarized multi-objective optimization that trades off growth and discordance by minimizing\n$$ -\\mu + \\lambda \\sum_{r=1}^5 t_r, $$\nsubject to the steady-state constraints $S v = 0$, flux bounds, and slack constraints above, where $\\lambda \\ge 0$ is a trade-off parameter with units of $1/(\\text{mmol}/\\text{gDW})$ so that the combined objective is in units of per hour. Tracing the Pareto front amounts to solving the linear program for a sequence of $\\lambda$ values and recording the pairs $(\\mu, \\sum_r t_r)$.\n\nStarting from the fundamental base that at steady state intracellular metabolite concentrations do not change ($S v = 0$) and that gene expression constrains enzyme-mediated reaction capacities (Central Dogma of Molecular Biology and enzyme capacity proportional to expression), derive the linear programming formulation that enforces the above and numerically trace the Pareto fronts by solving the program at a grid of $\\lambda$ values.\n\nDefine “biologically plausible” $\\lambda$ values for a given condition as those that simultaneously satisfy:\n- $ \\mu(\\lambda) \\ge \\theta \\cdot \\mu_{\\max}$ with $\\theta = 0.95$ (dimensionless), where $\\mu_{\\max}$ is the growth rate at $\\lambda = 0$; and\n- $\\sum_r t_r(\\lambda) \\le \\eta \\cdot \\left.\\sum_r t_r\\right|_{\\lambda=0}$ with $\\eta = 0.5$ (dimensionless).\n\nYour task is to implement a program that, for each specified test case, solves the linear program across the given $\\lambda$ grid, computes the Pareto front pairs $(\\mu, \\sum_r t_r)$, and returns the list of $\\lambda$ values that meet the biological plausibility criteria above.\n\nPhysical and numerical units:\n- All fluxes $v_r$ and slack variables $t_r$ are in mmol per gram dry weight per hour (mmol/gDW/h).\n- Growth rate $\\mu$ is in per hour.\n- The trade-off parameter $\\lambda$ is in $1/(\\text{mmol}/\\text{gDW})$.\n\nAngle units are not used. Percentages are avoided by specifying $\\theta$ and $\\eta$ as decimals.\n\nTest suite:\n- Case $1$ (discordant growth): $e = [5, 3, 2, 8, 1]$, $\\kappa = 1$, $\\lambda$ grid $[0, 0.05, 0.1, 0.5, 1, 2, 5, 10]$.\n- Case $2$ (high expression everywhere): $e = [10, 10, 10, 10, 10]$, $\\kappa = 1$, $\\lambda$ grid $[0, 0.05, 0.1, 0.5, 1, 2, 5, 10]$.\n- Case $3$ (missing expression for conversion): $e = [5, 3, 0, 8, 2]$, $\\kappa = 1$, $\\lambda$ grid $[0, 0.05, 0.1, 0.5, 1, 2, 5, 10]$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case contributes one list of $\\lambda$ values (floats) that are biologically plausible for that case, in the same order as above. For example, an output could look like “$[[0.1,0.5,1],[0,0.05,0.1,0.5,1,2,5,10],[]]$”, with all values understood to be in $1/(\\text{mmol}/\\text{gDW})$.",
            "solution": "The problem statement is assessed to be valid. It is scientifically grounded in the principles of computational systems biology, specifically Flux Balance Analysis (FBA) and its extensions for integrating transcriptomic data. The problem is well-posed as a Linear Program (LP), with all necessary constraints, variables, and objective functions clearly and consistently defined. The language is objective and the parameters are specified, making it a solvable and verifiable problem.\n\nThe core of this problem is to formulate and solve a series of linear programs. The goal is to identify a set of trade-off parameters, $\\lambda$, that result in a metabolic state which is a \"biologically plausible\" compromise between maximizing a biological objective (growth) and maintaining consistency with gene expression data.\n\nFirst, we formalize the optimization problem. The decision variables are the flux vector $v = [v_1, v_2, v_3, v_4, v_5]^T \\in \\mathbb{R}^5$ and the slack vector $t = [t_1, t_2, t_3, t_4, t_5]^T \\in \\mathbb{R}^5$. We can combine these into a single state vector $x \\in \\mathbb{R}^{10}$ where $x = [v^T, t^T]^T$.\n\nThe objective is to minimize a scalarized combination of negative growth rate ($-\\mu = -v_5$) and total discordance ($\\sum_{r=1}^5 t_r$). The objective function $f(x)$ is:\n$$ \\min_{x} \\left( -\\mu + \\lambda \\sum_{r=1}^5 t_r \\right) = \\min_{x} \\left( -v_5 + \\lambda \\sum_{r=1}^5 t_r \\right) $$\nThis can be expressed in the standard LP form $\\min c^T x$, where the cost vector $c \\in \\mathbb{R}^{10}$ is given by:\n$$ c^T = [0, 0, 0, 0, -1, \\lambda, \\lambda, \\lambda, \\lambda, \\lambda] $$\n\nThe optimization is subject to several linear constraints:\n\n1.  **Steady-State Mass Balance**: The condition $S v = 0$ ensures that the concentrations of internal metabolites do not change over time. Given the problem's definitions, the stoichiometric matrix $S \\in \\mathbb{R}^{3 \\times 5}$ is:\n    $$ S = \\begin{pmatrix} 1 & -1 & 0 & 0 & 0 \\\\ 0 & 1 & -1 & -1 & 0 \\\\ 0 & 0 & 1 & 0 & -1 \\end{pmatrix} $$\n    This gives rise to the equality constraints $A_{eq} x = b_{eq}$, where:\n    $$ A_{eq} = \\begin{pmatrix} S & \\mathbf{0}_{3 \\times 5} \\end{pmatrix} = \\begin{pmatrix} 1 & -1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\\\ 0 & 1 & -1 & -1 & 0 & 0 & 0 & 0 & 0 & 0 \\\\ 0 & 0 & 1 & 0 & -1 & 0 & 0 & 0 & 0 & 0 \\end{pmatrix} $$\n    and $b_{eq} = [0, 0, 0]^T$.\n\n2.  **Discordance Slack Constraints**: The inequalities $v_r - t_r \\le \\kappa e_r$ for $r \\in \\{1, \\dots, 5\\}$ link the fluxes to the gene expression levels. These can be written in the matrix form $A_{ub} x \\le b_{ub}$. The matrix $A_{ub}$ is a $5 \\times 10$ matrix composed of a $5 \\times 5$ identity matrix $I_5$ and its negative:\n    $$ A_{ub} = \\begin{pmatrix} I_5 & -I_5 \\end{pmatrix} = \\begin{pmatrix}\n    1 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 & 0 \\\\\n    0 & 1 & 0 & 0 & 0 & 0 & -1 & 0 & 0 & 0 \\\\\n    0 & 0 & 1 & 0 & 0 & 0 & 0 & -1 & 0 & 0 \\\\\n    0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & -1 & 0 \\\\\n    0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & -1\n    \\end{pmatrix} $$\n    The corresponding vector $b_{ub} \\in \\mathbb{R}^5$ is given by the scaled expression levels:\n    $$ b_{ub} = \\kappa e = [\\kappa e_1, \\kappa e_2, \\kappa e_3, \\kappa e_4, \\kappa e_5]^T $$\n\n3.  **Variable Bounds**: All fluxes and slack variables are non-negative. Additionally, specific upper bounds are provided for the fluxes. This defines a range $[l_i, u_i]$ for each component $x_i$ of the state vector $x$:\n    -   $v_1$: $0 \\le v_1 \\le 10$\n    -   $v_2, v_3, v_4, v_5$: $0 \\le v_r \\le 100$ for $r \\in \\{2,3,4,5\\}$\n    -   $t_r$: $0 \\le t_r < \\infty$ for $r \\in \\{1, \\dots, 5\\}$\n\nThe algorithmic procedure to identify the biologically plausible $\\lambda$ values for each test case is as follows:\n\n1.  **Establish Baselines**: Solve the LP for the case where $\\lambda = 0$. This corresponds to pure growth maximization, as the penalty term for discordance vanishes. The solution to this LP yields the maximum possible growth rate, $\\mu_{\\max} = v_5^*$, and the corresponding total slack, $T_0 = \\sum_r t_r^*$.\n\n2.  **Define Plausibility Thresholds**: Using the baseline values, calculate the minimum acceptable growth rate and the maximum acceptable total slack according to the given criteria:\n    -   Minimum growth: $\\mu_{min} = \\theta \\cdot \\mu_{\\max} = 0.95 \\cdot \\mu_{\\max}$\n    -   Maximum slack: $T_{max} = \\eta \\cdot T_0 = 0.5 \\cdot T_0$\n\n3.  **Evaluate Each $\\lambda$**: For each $\\lambda$ in the provided grid (including $\\lambda=0$), solve the complete LP with the corresponding cost vector $c$. This yields the optimal growth rate $\\mu(\\lambda)$ and total slack $T(\\lambda) = \\sum_r t_r(\\lambda)$.\n\n4.  **Apply Criteria**: A given $\\lambda$ is deemed biologically plausible if its corresponding solution simultaneously satisfies both conditions:\n    -   $\\mu(\\lambda) \\ge \\mu_{min}$\n    -   $T(\\lambda) \\le T_{max}$\n\n5.  **Collect Results**: Compile a list of all $\\lambda$ values from the grid that meet these criteria. This process is repeated for each of the three test cases. The final output is a list containing the plausible $\\lambda$ lists for each case. This entire procedure will be implemented using `scipy.optimize.linprog` to solve the LPs.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves the metabolic modeling problem for a set of test cases.\n\n    For each case, it traces a Pareto front by solving a linear program\n    for different values of a trade-off parameter lambda. It then identifies\n    the lambda values that satisfy predefined \"biologically plausible\"\n    criteria for growth rate and gene expression discordance.\n    \"\"\"\n\n    test_cases = [\n        # Case 1 (discordant growth)\n        {'e': np.array([5, 3, 2, 8, 1]), 'kappa': 1, 'lambda_grid': [0, 0.05, 0.1, 0.5, 1, 2, 5, 10]},\n        # Case 2 (high expression everywhere)\n        {'e': np.array([10, 10, 10, 10, 10]), 'kappa': 1, 'lambda_grid': [0, 0.05, 0.1, 0.5, 1, 2, 5, 10]},\n        # Case 3 (missing expression for conversion)\n        {'e': np.array([5, 3, 0, 8, 2]), 'kappa': 1, 'lambda_grid': [0, 0.05, 0.1, 0.5, 1, 2, 5, 10]},\n    ]\n    \n    # Constants from the problem description\n    THETA = 0.95\n    ETA = 0.5\n    \n    # LP problem structure (constant for all cases)\n    # Variables: x = [v1, v2, v3, v4, v5, t1, t2, t3, t4, t5]\n    \n    # Equality constraints: S*v = 0\n    A_eq = np.array([\n        [1, -1, 0, 0, 0, 0, 0, 0, 0, 0],\n        [0, 1, -1, -1, 0, 0, 0, 0, 0, 0],\n        [0, 0, 1, 0, -1, 0, 0, 0, 0, 0]\n    ])\n    b_eq = np.array([0, 0, 0])\n\n    # Inequality constraints: v_r - t_r <= kappa * e_r\n    # Represented as A_ub * x <= b_ub\n    A_ub = np.hstack([np.identity(5), -np.identity(5)])\n    \n    # Bounds for variables: v_r and t_r\n    # v1 in [0, 10], v2-v5 in [0, 100], t_r in [0, inf)\n    bounds = (\n        (0, 10), (0, 100), (0, 100), (0, 100), (0, 100),\n        (0, None), (0, None), (0, None), (0, None), (0, None)\n    )\n\n    all_results = []\n\n    for case in test_cases:\n        e = case['e']\n        kappa = case['kappa']\n        lambda_grid = case['lambda_grid']\n        \n        # Inequality constraint vector b_ub depends on e and kappa\n        b_ub = kappa * e\n        \n        # Step 1: Solve for lambda = 0 to get baselines\n        c_base = np.array([0, 0, 0, 0, -1, 0, 0, 0, 0, 0])\n        res_base = linprog(c=c_base, A_ub=A_ub, b_ub=b_ub, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n        \n        if not res_base.success:\n            # Handle cases where the base LP fails, though not expected for this problem\n            all_results.append([])\n            continue\n\n        v_base = res_base.x[:5]\n        t_base = res_base.x[5:]\n        \n        # For the lambda=0 case where t_r are not in the objective, some solvers\n        # might not return the minimal t_r. To be rigorous, we calculate the minimal\n        # slack required for the optimal fluxes.\n        mu_max = v_base[4]\n        min_slacks_base = np.maximum(0, v_base - kappa * e)\n        T0 = np.sum(min_slacks_base)\n        \n        # Step 2: Define plausibility thresholds\n        mu_min = THETA * mu_max\n        T_max = ETA * T0\n        \n        plausible_lambdas = []\n        \n        # Step 3 & 4: Evaluate each lambda and apply criteria\n        for lam in lambda_grid:\n            c = np.array([0, 0, 0, 0, -1] + [lam] * 5)\n            res = linprog(c=c, A_ub=A_ub, b_ub=b_ub, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n            \n            if res.success:\n                v = res.x[:5]\n                t = res.x[5:]\n                mu_lam = v[4]\n                T_lam = np.sum(t)\n\n                # Check for numerical precision issues\n                if mu_lam < mu_min - 1e-9:\n                    continue\n                if T_lam > T_max + 1e-9:\n                    continue\n                \n                # If T0 is 0, T_max is 0. Only solutions with T_lam=0 are valid.\n                if T0 == 0 and T_lam > 1e-9:\n                    continue\n\n                plausible_lambdas.append(lam)\n\n        all_results.append(plausible_lambdas)\n\n    # Final print statement in the exact required format\n    case_results_str = [f\"[{','.join(map(str, res))}]\" for res in all_results]\n    print(f\"[{','.join(case_results_str)}]\")\n\nsolve()\n```"
        }
    ]
}