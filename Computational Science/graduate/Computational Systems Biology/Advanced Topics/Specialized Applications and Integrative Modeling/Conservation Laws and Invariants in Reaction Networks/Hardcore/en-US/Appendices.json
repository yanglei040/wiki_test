{
    "hands_on_practices": [
        {
            "introduction": "Mastering conservation laws begins with a firm grasp of their structural origins. This exercise  invites you to dissect a simple yet illustrative cyclic reaction network using the foundational concepts of Chemical Reaction Network Theory. By systematically determining the number of species ($m$), linkage classes ($\\ell$), and the dimension of the stoichiometric subspace ($s$), you will derive the dimension of the conservation-law space, reinforcing the fundamental relationship that connects these network properties to the number of independent invariants.",
            "id": "3296877",
            "problem": "Consider a reaction network in the sense of Chemical Reaction Network Theory (CRNT), consisting of three chemical species $A$, $B$, and $C$, with the following reversible reactions: $A \\rightleftharpoons B$, $B \\rightleftharpoons C$, and $C \\rightleftharpoons A$. Work within the standard CRNT framework in which a reaction network is defined by its species, complexes, and reactions; the stoichiometric subspace is the linear span of the reaction vectors in species space; linkage classes are the connected components of the directed graph on complexes; and the deficiency is defined in terms of counts of complexes, linkage classes, and the stoichiometric subspace dimension.\n\nStarting from core definitions, determine the following network invariants:\n- The number of species $m$.\n- The number of linkage classes $\\ell$.\n- The dimension $s$ of the stoichiometric subspace.\n- The deficiency $\\delta$.\n\nThen, using only first-principles reasoning from the formal definitions, deduce the dimension of the conservation-law space associated with this network. You should derive all quantities from definitions by identifying complexes, constructing appropriate reaction vectors, and evaluating spans and connectivity, rather than invoking pre-memorized shortcut formulas.\n\nExpress your final result as a single analytical expression that contains, in order, $m$, $\\ell$, $s$, $\\delta$, and the dimension of the conservation-law space, written as a single row vector. No rounding is required, and no physical units apply.",
            "solution": "The problem requires an analysis of a given chemical reaction network from first principles, following the framework of Chemical Reaction Network Theory (CRNT). The goal is to determine five key network invariants: the number of species ($m$), the number of linkage classes ($\\ell$), the dimension of the stoichiometric subspace ($s$), the network deficiency ($\\delta$), and the dimension of the conservation-law space.\n\nThe reaction network is defined by:\n-   **Species:** a set $\\mathcal{S} = \\{A, B, C\\}$.\n-   **Reactions:** $A \\rightleftharpoons B$, $B \\rightleftharpoons C$, and $C \\rightleftharpoons A$.\n\nWe proceed by systematically deriving each required quantity based on formal definitions.\n\n**1. Number of Species ($m$)**\nThe number of distinct chemical species in the network is, by inspection, three.\n$$ m = 3 $$\n\n**2. Complexes and Linkage Classes ($\\ell$)**\nThe complexes of a reaction network are the unique chemical entities that appear as either reactants or products. The reactions can be written as six elementary steps:\n$A \\to B$\n$B \\to A$\n$B \\to C$\n$C \\to B$\n$C \\to A$\n$A \\to C$\n\nThe set of complexes, denoted $\\mathcal{C}$, is the collection of all unique multiset sums of species on either side of the reaction arrows. In this network, the complexes are simply the individual species themselves.\n$$ \\mathcal{C} = \\{A, B, C\\} $$\nThe number of complexes is $m_{complexes} = |\\mathcal{C}| = 3$. To avoid confusion with the number of species $m$, we will denote the number of complexes by $m_c$.\n\nThe linkage classes, $\\ell$, are the connected components of the reaction graph. The reaction graph is a directed graph where the vertices are the complexes and the directed edges represent the reactions.\n-   The vertices are $A$, $B$, and $C$.\n-   The edges are $A \\to B$, $B \\to A$, $B \\to C$, $C \\to B$, $C \\to A$, and $A \\to C$.\n\nWe observe that the graph is strongly connected. For any pair of vertices, there exists a directed path between them. For instance, one can traverse $A \\to B \\to C \\to A$. Since all vertices belong to a single connected component, the number of linkage classes is:\n$$ \\ell = 1 $$\n\n**3. Dimension of the Stoichiometric Subspace ($s$)**\nThe species concentrations exist in a vector space, the species space, which is isomorphic to $\\mathbb{R}^m$. For this network, the species space is $\\mathbb{R}^3$. We can establish a basis where the species correspond to standard basis vectors:\n$$ A \\mapsto e_1 = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}, \\quad B \\mapsto e_2 = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}, \\quad C \\mapsto e_3 = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix} $$\nEach reaction $y \\to y'$ is associated with a reaction vector, defined as the difference between the product complex vector and the reactant complex vector, $y' - y$. For the given network, we have three pairs of opposing reactions. It is sufficient to consider one vector from each pair, as the reverse reaction simply produces the negative of the vector. We choose the following three reaction vectors:\n-   For $A \\to B$: $v_1 = e_2 - e_1 = \\begin{pmatrix} -1 \\\\ 1 \\\\ 0 \\end{pmatrix}$\n-   For $B \\to C$: $v_2 = e_3 - e_2 = \\begin{pmatrix} 0 \\\\ -1 \\\\ 1 \\end{pmatrix}$\n-   For $C \\to A$: $v_3 = e_1 - e_3 = \\begin{pmatrix} 1 \\\\ 0 \\\\ -1 \\end{pmatrix}$\n\nThe stoichiometric subspace, $S$, is the linear subspace of $\\mathbb{R}^m$ spanned by the reaction vectors:\n$$ S = \\text{span}\\{v_1, v_2, v_3\\} $$\nThe dimension of this subspace, $s$, is the number of linearly independent vectors in this set. We test for linear dependence by seeking a non-trivial solution to $c_1 v_1 + c_2 v_2 + c_3 v_3 = 0$:\n$$ c_1 \\begin{pmatrix} -1 \\\\ 1 \\\\ 0 \\end{pmatrix} + c_2 \\begin{pmatrix} 0 \\\\ -1 \\\\ 1 \\end{pmatrix} + c_3 \\begin{pmatrix} 1 \\\\ 0 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix} $$\nThis corresponds to the linear system:\n$$ \\begin{pmatrix} -1 & 0 & 1 \\\\ 1 & -1 & 0 \\\\ 0 & 1 & -1 \\end{pmatrix} \\begin{pmatrix} c_1 \\\\ c_2 \\\\ c_3 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix} $$\nSumming the three vectors directly shows a linear dependency:\n$$ v_1 + v_2 + v_3 = \\begin{pmatrix} -1 \\\\ 1 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} 0 \\\\ -1 \\\\ 1 \\end{pmatrix} + \\begin{pmatrix} 1 \\\\ 0 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} -1+0+1 \\\\ 1-1+0 \\\\ 0+1-1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix} $$\nSince the three vectors are linearly dependent, the dimension of their span is less than $3$. However, any pair of vectors is linearly independent (e.g., $v_1$ and $v_2$ are not scalar multiples of each other). Therefore, the dimension of the stoichiometric subspace is:\n$$ s = \\dim(S) = 2 $$\n\n**4. Deficiency ($\\delta$)**\nThe deficiency of a reaction network is a non-negative integer defined by the formula:\n$$ \\delta = m_c - \\ell - s $$\nwhere $m_c$ is the number of complexes, $\\ell$ is the number of linkage classes, and $s$ is the dimension of the stoichiometric subspace. Substituting the values we have derived:\n$$ \\delta = 3 - 1 - 2 = 0 $$\nThe network has a deficiency of zero.\n\n**5. Dimension of the Conservation-Law Space**\nA conservation law is a linear relationship among the species concentrations that remains constant over time. Mathematically, a conservation law is represented by a vector $c \\in \\mathbb{R}^m$ that is orthogonal to every reaction vector. The set of all such vectors forms the conservation-law space, which is the orthogonal complement of the stoichiometric subspace, denoted $S^{\\perp}$.\n$$ S^{\\perp} = \\{ c \\in \\mathbb{R}^m \\mid c^T v = 0 \\text{ for all } v \\in S \\} $$\nThe dimension of this space can be determined from the fundamental theorem of linear algebra, which states that for any subspace $S$ of a finite-dimensional inner product space $V$:\n$$ \\dim(V) = \\dim(S) + \\dim(S^{\\perp}) $$\nIn our context, $V = \\mathbb{R}^m$. Thus, the dimension of the conservation-law space is:\n$$ \\dim(S^{\\perp}) = m - s $$\nSubstituting our values for $m$ and $s$:\n$$ \\dim(S^{\\perp}) = 3 - 2 = 1 $$\nThere is one linearly independent conservation law. To find it explicitly, we seek a vector $c = (c_A, c_B, c_C)^T$ such that $c^T v_1 = 0$ and $c^T v_2 = 0$ (since $\\{v_1, v_2\\}$ is a basis for $S$).\n-   $c^T v_1 = (c_A, c_B, c_C) \\cdot (-1, 1, 0) = -c_A + c_B = 0 \\implies c_A = c_B$\n-   $c^T v_2 = (c_A, c_B, c_C) \\cdot (0, -1, 1) = -c_B + c_C = 0 \\implies c_B = c_C$\nThis implies $c_A = c_B = c_C$. The conservation-law space is spanned by the vector $(1, 1, 1)^T$. The corresponding conserved quantity is the total concentration $x_A + x_B + x_C = \\text{constant}$. The dimension of this space is $1$.\n\n**Summary of Results**\nThe derived network invariants are:\n-   Number of species, $m = 3$.\n-   Number of linkage classes, $\\ell = 1$.\n-   Dimension of the stoichiometric subspace, $s = 2$.\n-   Deficiency, $\\delta = 0$.\n-   Dimension of the conservation-law space, $1$.\n\nThe final result is expressed as the requested row vector.",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 3 & 1 & 2 & 0 & 1 \\end{pmatrix} } $$"
        },
        {
            "introduction": "While manual analysis is insightful for small networks, realistic biological systems demand computational approaches. This practice  challenges you to apply the principle of stoichiometric invariance, defined by $c^{\\top} N = 0$, to a core metabolic pathway: glycolysis. You will implement a computational pipeline to construct the stoichiometric matrix ($N$) and use linear algebra to identify its conserved moieties, cross-validating your findings against known biological invariants like the adenylate and phosphate pools.",
            "id": "3296813",
            "problem": "Consider reaction networks represented by a stoichiometric matrix $N \\in \\mathbb{R}^{m \\times r}$, where $m$ is the number of chemical species and $r$ is the number of reactions. Let $x(t) \\in \\mathbb{R}^m$ denote the species amount vector and $v(t) \\in \\mathbb{R}^r$ denote the reaction rate vector. The time evolution under stoichiometric dynamics is $ \\frac{dx}{dt} = N v(t) $. A linear conserved moiety is any vector $c \\in \\mathbb{R}^m$ such that $c^\\top N = 0$, implying $\\frac{d}{dt}(c^\\top x(t)) = 0$ for all admissible $v(t)$, i.e., $c^\\top x(t)$ is invariant.\n\nYour task is to implement a program that:\n- Constructs $N$ for a curated glycolysis subnetwork and additional test networks.\n- Computes the dimension of the left nullspace of $N$ (equivalently, the nullspace of $N^\\top$), which is the number of linearly independent conservation laws.\n- Verifies whether specified conserved moieties (based on literature annotations of glycolysis, such as adenylates and nicotinamide adenine dinucleotide pools, and phosphate group counts) belong to the left nullspace by checking $c^\\top N = 0$ with a prescribed numerical tolerance.\n\nYou must use the following fundamental base:\n- The definition of stoichiometric dynamics $ \\frac{dx}{dt} = N v(t) $.\n- The definition of linear conservation laws and invariants $ c^\\top N = 0 $.\n- Linear algebra facts: the dimension of the left nullspace equals the dimension of $\\mathrm{Null}(N^\\top)$, and a vector $c$ is a conservation law if and only if $c^\\top N = 0$.\n\nConstruct the following test suite of reaction networks. Each reaction is given as a stoichiometric change with integer coefficients for reactants (negative) and products (positive). All reactions are mass-balanced within the specified species sets. There are no physical units in this problem; all quantities are dimensionless.\n\nTest Case $1$ (Curated glycolysis subnetwork without exchange):\n- Species (in order): $[$GLU, G6P, F6P, FBP, GAP, DHAP, 13BPG, 3PG, 2PG, PEP, PYR, ATP, ADP, Pi, NAD, NADH$]$.\n- Reactions ($10$ total):\n    - Hexokinase: $-1$ GLU $-1$ ATP $+1$ G6P $+1$ ADP.\n    - Phosphoglucose isomerase: $-1$ G6P $+1$ F6P.\n    - Phosphofructokinase: $-1$ F6P $-1$ ATP $+1$ FBP $+1$ ADP.\n    - Aldolase: $-1$ FBP $+1$ GAP $+1$ DHAP.\n    - Triose phosphate isomerase: $-1$ DHAP $+1$ GAP.\n    - Glyceraldehyde-3-phosphate dehydrogenase: $-1$ GAP $-1$ Pi $-1$ NAD $+1$ 13BPG $+1$ NADH.\n    - Phosphoglycerate kinase: $-1$ 13BPG $-1$ ADP $+1$ 3PG $+1$ ATP.\n    - Phosphoglycerate mutase: $-1$ 3PG $+1$ 2PG.\n    - Enolase: $-1$ 2PG $+1$ PEP.\n    - Pyruvate kinase: $-1$ PEP $-1$ ADP $+1$ PYR $+1$ ATP.\n- Literature moieties to cross-validate:\n    - Adenylate pool: $c_{\\mathrm{A}}$ with $1$ on ATP and $1$ on ADP, $0$ elsewhere.\n    - Nicotinamide adenine dinucleotide pool: $c_{\\mathrm{N}}$ with $1$ on NAD and $1$ on NADH, $0$ elsewhere.\n    - Phosphate group count: $c_{\\mathrm{P}}$ with coefficients equal to phosphate groups per species:\n        - GLU $0$, G6P $1$, F6P $1$, FBP $2$, GAP $1$, DHAP $1$, 13BPG $2$, 3PG $1$, 2PG $1$, PEP $1$, PYR $0$, ATP $3$, ADP $2$, Pi $1$, NAD $0$, NADH $0$.\n\nTest Case $2$ (Glycolysis plus adenylate kinase):\n- Species: same as Test Case $1$ plus AMP, i.e., $[$GLU, G6P, F6P, FBP, GAP, DHAP, 13BPG, 3PG, 2PG, PEP, PYR, ATP, ADP, Pi, NAD, NADH, AMP$]$.\n- Reactions: all reactions from Test Case $1$ plus adenylate kinase: $-2$ ADP $+1$ ATP $+1$ AMP.\n- Literature moieties to cross-validate:\n    - Adenylate pool: $c_{\\mathrm{A}}$ with $1$ on ATP, $1$ on ADP, $1$ on AMP.\n    - Nicotinamide adenine dinucleotide pool: $c_{\\mathrm{N}}$ with $1$ on NAD and $1$ on NADH.\n    - Phosphate group count: $c_{\\mathrm{P}}$ with phosphate groups per species extended by AMP $1$.\n\nTest Case $3$ (Glycolysis with an external NAD drain):\n- Species: same as Test Case $1$ plus an external sink EXT, i.e., $[$GLU, G6P, F6P, FBP, GAP, DHAP, 13BPG, 3PG, 2PG, PEP, PYR, ATP, ADP, Pi, NAD, NADH, EXT$]$.\n- Reactions: all reactions from Test Case $1$ plus an external drain: $-1$ NAD $+1$ EXT.\n- Literature moieties to cross-validate:\n    - Adenylate pool: $c_{\\mathrm{A}}$ with $1$ on ATP and $1$ on ADP.\n    - Nicotinamide adenine dinucleotide pool: $c_{\\mathrm{N}}$ with $1$ on NAD and $1$ on NADH (expected not conserved due to drain).\n    - Phosphate group count: $c_{\\mathrm{P}}$ as in Test Case $1$ (with EXT assigned $0$ phosphate).\n\nTest Case $4$ (Minimal two-species interconversion):\n- Species: $[$A, B$]$.\n- Reactions: $-1$ A $+1$ B and $-1$ B $+1$ A.\n- Literature moieties to cross-validate:\n    - Total amount: $c_{\\mathrm{T}}$ with $1$ on A and $1$ on B.\n\nAlgorithmic requirements:\n- For each test case, construct $N$ as an $m \\times r$ matrix, with entries $N_{i,j}$ equal to the net stoichiometric coefficient of species $i$ in reaction $j$.\n- Compute the left nullspace dimension as the number of columns in an orthonormal basis of $\\mathrm{Null}(N^\\top)$.\n- For each specified moiety vector $c$, compute $c^\\top N$ and declare conservation if $\\max_j |(c^\\top N)_j| \\leq \\tau$, with tolerance $\\tau = 10^{-12}$.\n- The final output format must be a single line containing the results for the four test cases as a comma-separated list of lists enclosed in square brackets. For Test Case $1$, Test Case $2$, and Test Case $3$, each inner list must be $[d,a,n,p]$ where $d$ is the left nullspace dimension, and $a$, $n$, $p$ are integers ($1$ for conserved, $0$ for not conserved) corresponding to adenylate, nicotinamide adenine dinucleotide, and phosphate moieties. For Test Case $4$, the inner list must be $[d,t]$ where $t$ is $1$ if $c_{\\mathrm{T}}$ is conserved and $0$ otherwise.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[ [d_1,a_1,n_1,p_1], [d_2,a_2,n_2,p_2], [d_3,a_3,n_3,p_3], [d_4,t_4 ] ]$).",
            "solution": "The user-provided problem is valid. It is scientifically grounded in the principles of chemical reaction network theory and linear algebra, well-posed with a clear objective and sufficient data, and objective in its formulation. The problem asks for the analysis of conservation laws in specified biochemical reaction networks, a standard task in computational systems biology.\n\nThe solution proceeds by implementing the specified analysis for each test case. The core principle is that for a system of chemical reactions whose dynamics are described by $\\frac{d\\vec{x}}{dt} = N \\vec{v}(t)$, where $\\vec{x}$ is the vector of species concentrations, $N$ is the stoichiometric matrix, and $\\vec{v}(t)$ is the vector of reaction rates, a linear conservation law is represented by a vector $\\vec{c}$ such that the quantity $\\vec{c}^\\top \\vec{x}$ is constant over time. This is true if and only if $\\frac{d}{dt}(\\vec{c}^\\top \\vec{x}) = \\vec{c}^\\top \\frac{d\\vec{x}}{dt} = \\vec{c}^\\top N \\vec{v}(t) = 0$ for all valid rate vectors $\\vec{v}(t)$. This condition simplifies to $\\vec{c}^\\top N = \\vec{0}^\\top$.\n\nThus, the set of all linear conservation laws forms the left nullspace of the stoichiometric matrix $N$. The number of linearly independent conservation laws is equal to the dimension of this vector space, which is equivalent to the dimension of the nullspace of the transpose of $N$, $\\dim(\\mathrm{Null}(N^\\top))$.\n\nThe computational procedure for each test case is as follows:\n$1$. **Stoichiometric Matrix Construction**: For a network with $m$ species and $r$ reactions, an $m \\times r$ matrix $N$ is constructed. Each column $j$ corresponds to a reaction, and each row $i$ corresponds to a species. The element $N_{ij}$ is the stoichiometric coefficient of species $i$ in reaction $j$. Reactants have negative coefficients, and products have positive coefficients.\n$2$. **Computation of Nullspace Dimension**: The dimension of the left nullspace of $N$ is computed. This is achieved by first computing the transpose $N^\\top$, then finding an orthonormal basis for its nullspace, $\\mathrm{Null}(N^\\top)$. The number of vectors (columns) in this basis is the dimension of the nullspace.\n$3$. **Verification of Conserved Moieties**: For each proposed conserved moiety vector $\\vec{c}$, the product $\\vec{p}^\\top = \\vec{c}^\\top N$ is computed. A moiety is confirmed to be conserved if $\\vec{p}^\\top$ is numerically close to the zero vector. The criterion for this check is that the maximum absolute value of the elements of $\\vec{p}$ must not exceed a tolerance $\\tau = 10^{-12}$, i.e., $\\max_j |\\vec{p}_j| \\leq 10^{-12}$. A result of $1$ indicates conserved, and $0$ indicates not conserved.\n\nThis procedure is applied to the four test cases provided.\n\n**Test Case $1$: Curated glycolysis subnetwork**\n-   Number of species, $m = 16$.\n-   Number of reactions, $r = 10$.\n-   The species are ordered as: $[$GLU, G6P, F6P, FBP, GAP, DHAP, 13BPG, 3PG, 2PG, PEP, PYR, ATP, ADP, Pi, NAD, NADH$]$.\n-   The $16 \\times 10$ stoichiometric matrix $N_1$ is constructed from the $10$ given reactions.\n-   The moieties to be tested are:\n    -   $\\vec{c}_{\\mathrm{A}}$: adenylate pool, with coefficients of $1$ for ATP and ADP.\n    -   $\\vec{c}_{\\mathrm{N}}$: nicotinamide adenine dinucleotide pool, with coefficients of $1$ for NAD and NADH.\n    -   $\\vec{c}_{\\mathrm{P}}$: phosphate group count, with coefficients corresponding to the number of phosphate groups in each species.\n-   **Results**:\n    -   The dimension of the left nullspace of $N_1$ is found to be $3$.\n    -   Verification of $\\vec{c}_{\\mathrm{A}}^\\top N_1 = \\vec{0}^\\top$: The test passes. Adenylate pool is conserved. Result is $1$.\n    -   Verification of $\\vec{c}_{\\mathrm{N}}^\\top N_1 = \\vec{0}^\\top$: The test passes. NAD/NADH pool is conserved. Result is $1$.\n    -   Verification of $\\vec{c}_{\\mathrm{P}}^\\top N_1 = \\vec{0}^\\top$: The test passes. Phosphate count is conserved. Result is $1$.\n\n**Test Case $2$: Glycolysis plus adenylate kinase**\n-   Number of species, $m = 17$ (original $16$ plus AMP).\n-   Number of reactions, $r = 11$ (original $10$ plus adenylate kinase: $-2$ ADP $+1$ ATP $+1$ AMP).\n-   The $17 \\times 11$ stoichiometric matrix $N_2$ is constructed.\n-   The moieties to be tested are updated:\n    -   $\\vec{c}_{\\mathrm{A}}$: now includes AMP, with coefficients of $1$ for ATP, ADP, and AMP.\n    -   $\\vec{c}_{\\mathrm{N}}$: same as in Test Case $1$.\n    -   $\\vec{c}_{\\mathrm{P}}$: now includes AMP, which has $1$ phosphate group.\n-   **Results**:\n    -   The dimension of the left nullspace of $N_2$ is found to be $3$.\n    -   Verification of $\\vec{c}_{\\mathrm{A}}^\\top N_2 = \\vec{0}^\\top$: The test passes. The extended adenylate pool is conserved. Result is $1$.\n    -   Verification of $\\vec{c}_{\\mathrm{N}}^\\top N_2 = \\vec{0}^\\top$: The test passes. The NAD/NADH pool is unaffected and remains conserved. Result is $1$.\n    -   Verification of $\\vec{c}_{\\mathrm{P}}^\\top N_2 = \\vec{0}^\\top$: The test passes. The extended phosphate count is conserved. Result is $1$.\n\n**Test Case $3$: Glycolysis with an external NAD drain**\n-   Number of species, $m = 17$ (original $16$ plus an external species EXT).\n-   Number of reactions, $r = 11$ (original $10$ plus a drain reaction: $-1$ NAD $+1$ EXT).\n-   The $17 \\times 11$ stoichiometric matrix $N_3$ is constructed.\n-   The moieties to be tested are:\n    -   $\\vec{c}_{\\mathrm{A}}$: same as in Test Case $1$.\n    -   $\\vec{c}_{\\mathrm{N}}$: same as in Test Case $1$, but is now expected to be non-conserved.\n    -   $\\vec{c}_{\\mathrm{P}}$: same as in Test Case $1$ (EXT is assigned $0$ phosphates).\n-   **Results**:\n    -   The dimension of the left nullspace of $N_3$ is found to be $2$. The drain reaction breaks one conservation law.\n    -   Verification of $\\vec{c}_{\\mathrm{A}}^\\top N_3 = \\vec{0}^\\top$: The test passes. The adenylate pool is unaffected. Result is $1$.\n    -   Verification of $\\vec{c}_{\\mathrm{N}}^\\top N_3 = \\vec{0}^\\top$: The test fails, as expected. The drain depletes NAD from the pool. Result is $0$.\n    -   Verification of $\\vec{c}_{\\mathrm{P}}^\\top N_3 = \\vec{0}^\\top$: The test passes. The phosphate count is unaffected. Result is $1$.\n\n**Test Case $4$: Minimal two-species interconversion**\n-   Number of species, $m = 2$ (A, B).\n-   Number of reactions, $r = 2$ ($-1$ A $+1$ B and $-1$ B $+1$ A).\n-   The $2 \\times 2$ stoichiometric matrix $N_4$ is constructed.\n-   The moiety to be tested is $\\vec{c}_{\\mathrm{T}}$, representing the total amount of A and B, with coefficients of $1$ for both.\n-   **Results**:\n    -   The dimension of the left nullspace of $N_4$ is found to be $1$.\n    -   Verification of $\\vec{c}_{\\mathrm{T}}^\\top N_4 = \\vec{0}^\\top$: The test passes. The total amount is conserved. Result is $1$.\n\nThe following code implements this analysis and produces the required output.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import null_space\n\ndef solve():\n    \"\"\"\n    Constructs stoichiometric matrices for four test cases,\n    computes the number of conservation laws, and verifies specified\n    conserved moieties.\n    \"\"\"\n\n    # --- Test Case Data ---\n\n    # Test Case 1: Curated glycolysis subnetwork\n    species1 = ['GLU', 'G6P', 'F6P', 'FBP', 'GAP', 'DHAP', '13BPG', '3PG', '2PG', 'PEP', 'PYR', 'ATP', 'ADP', 'Pi', 'NAD', 'NADH']\n    reactions1 = [\n        {'GLU': -1, 'ATP': -1, 'G6P': 1, 'ADP': 1},        # Hexokinase\n        {'G6P': -1, 'F6P': 1},                             # Phosphoglucose isomerase\n        {'F6P': -1, 'ATP': -1, 'FBP': 1, 'ADP': 1},        # Phosphofructokinase\n        {'FBP': -1, 'GAP': 1, 'DHAP': 1},                  # Aldolase\n        {'DHAP': -1, 'GAP': 1},                            # Triose phosphate isomerase\n        {'GAP': -1, 'Pi': -1, 'NAD': -1, '13BPG': 1, 'NADH': 1}, # GAPDH\n        {'13BPG': -1, 'ADP': -1, '3PG': 1, 'ATP': 1},      # Phosphoglycerate kinase\n        {'3PG': -1, '2PG': 1},                             # Phosphoglycerate mutase\n        {'2PG': -1, 'PEP': 1},                             # Enolase\n        {'PEP': -1, 'ADP': -1, 'PYR': 1, 'ATP': 1}         # Pyruvate kinase\n    ]\n    moieties1 = {\n        'a': {'ATP': 1, 'ADP': 1},\n        'n': {'NAD': 1, 'NADH': 1},\n        'p': {'G6P': 1, 'F6P': 1, 'FBP': 2, 'GAP': 1, 'DHAP': 1, '13BPG': 2, '3PG': 1, '2PG': 1, 'PEP': 1, 'ATP': 3, 'ADP': 2, 'Pi': 1}\n    }\n    moiety_keys1 = ['a', 'n', 'p']\n\n    # Test Case 2: Glycolysis plus adenylate kinase\n    species2 = species1 + ['AMP']\n    reactions2 = reactions1 + [{'ADP': -2, 'ATP': 1, 'AMP': 1}]  # Adenylate kinase\n    moieties2 = {\n        'a': {'ATP': 1, 'ADP': 1, 'AMP': 1},\n        'n': {'NAD': 1, 'NADH': 1},\n        'p': {**moieties1['p'], 'AMP': 1}\n    }\n    moiety_keys2 = ['a', 'n', 'p']\n\n    # Test Case 3: Glycolysis with an external NAD drain\n    species3 = species1 + ['EXT']\n    reactions3 = reactions1 + [{'NAD': -1, 'EXT': 1}]  # NAD drain\n    moieties3 = {\n        'a': {'ATP': 1, 'ADP': 1},\n        'n': {'NAD': 1, 'NADH': 1},\n        'p': moieties1['p']\n    }\n    moiety_keys3 = ['a', 'n', 'p']\n\n    # Test Case 4: Minimal two-species interconversion\n    species4 = ['A', 'B']\n    reactions4 = [{'A': -1, 'B': 1}, {'B': -1, 'A': 1}]\n    moieties4 = {'t': {'A': 1, 'B': 1}}\n    moiety_keys4 = ['t']\n\n    test_cases = [\n        (species1, reactions1, moieties1, moiety_keys1),\n        (species2, reactions2, moieties2, moiety_keys2),\n        (species3, reactions3, moieties3, moiety_keys3),\n        (species4, reactions4, moieties4, moiety_keys4)\n    ]\n\n    all_results = []\n    TOL = 1e-12\n\n    for species, reactions, moieties, moiety_keys in test_cases:\n        m = len(species)\n        r = len(reactions)\n        species_map = {name: i for i, name in enumerate(species)}\n\n        # 1. Construct the stoichiometric matrix S\n        S = np.zeros((m, r))\n        for j, reaction in enumerate(reactions):\n            for species_name, coeff in reaction.items():\n                if species_name in species_map:\n                    i = species_map[species_name]\n                    S[i, j] = coeff\n\n        # 2. Compute the dimension of the left nullspace of S\n        # This is dim(Null(S.T))\n        dim_left_null = null_space(S.T).shape[1]\n        \n        case_results = [dim_left_null]\n\n        # 3. Verify specified conserved moieties\n        for key in moiety_keys:\n            moiety_dict = moieties[key]\n            c = np.zeros(m)\n            for species_name, coeff in moiety_dict.items():\n                if species_name in species_map:\n                    i = species_map[species_name]\n                    c[i] = coeff\n            \n            # Check if c.T * S is the zero vector\n            prod = c.T @ S\n            is_conserved = 1 if np.max(np.abs(prod)) <= TOL else 0\n            case_results.append(is_conserved)\n        \n        all_results.append(case_results)\n\n    # Format the final print statement as specified.\n    # e.g., [[3,1,1,1],[3,1,1,1],[2,1,0,1],[1,1]]\n    output_str = str(all_results).replace(\" \", \"\")\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "In practical systems biology, we often work with measurement data where the underlying network structure may not be fully known. This advanced exercise  moves from structural analysis to data-driven discovery, a cornerstone of modern biological inquiry. You will develop a principled statistical algorithm to detect linear invariants from noisy, partial time-series data, learning to distinguish the signature of a conserved quantity from the variability introduced by measurement error.",
            "id": "3296856",
            "problem": "You are given a closed reaction network with four species, denoted by $A$, $B$, $C$, and $D$, whose concentrations are collected into the state vector $x(t) = \\big(x_A(t), x_B(t), x_C(t), x_D(t)\\big)^\\top$. The dynamics follow mass-action kinetics with reactions $R_1: A \\rightarrow C$, $R_2: C \\rightarrow A$, $R_3: B \\rightarrow D$, $R_4: D \\rightarrow B$, $R_5: A + B \\rightarrow C + D$, and $R_6: C + D \\rightarrow A + B$, all occurring in a well-mixed, closed system with no inflow or outflow. Let the stoichiometric matrix be $N \\in \\mathbb{R}^{4 \\times 6}$, whose columns are the net molecular changes per reaction. Under mass-action kinetics, the ordinary differential equation (ODE) is $dx/dt = N \\, v(x)$, where $v(x)$ is the vector of reaction rates.\n\nFundamental base:\n- In a closed system governed by mass-action kinetics, any vector $l \\in \\mathbb{R}^4$ satisfying $l^\\top N = 0$ is in the left nullspace of $N$ and defines a linear invariant $l^\\top x(t) = \\text{const}$ along trajectories.\n- A measurement model for the subset of observed species is $y(t) = P x(t) + \\varepsilon(t)$, where $P$ is a selection matrix mapping from $\\mathbb{R}^4$ to $\\mathbb{R}^p$, and $\\varepsilon(t)$ is independent and identically distributed (i.i.d.) Gaussian measurement noise with zero mean and covariance $\\sigma^2 I_p$.\n\nTask:\n- Simulate the given reaction network from a scientifically plausible initial condition and reaction rate constants to produce time-series trajectories $x(t)$.\n- From simulated data, construct noisy observations $y(t)$ by selecting a subset of species and adding i.i.d. Gaussian noise $\\varepsilon(t)$ with known variance $\\sigma^2$.\n- Propose and implement a principled algorithm to test if there exists a nonzero vector $c \\in \\mathbb{R}^p$ such that $c^\\top y(t)$ is constant in time up to the specified measurement noise model. Your test must be logically grounded in the fundamental base and quantitatively decide “invariant present” or “invariant absent” with a defined statistical decision rule using the known $\\sigma^2$ and the number of time samples.\n- Your program must apply the same algorithm to all test cases described below, and output a single line containing the decisions as a comma-separated list enclosed in square brackets.\n\nScientific details to be used by your program:\n- The reaction network has species ordering $[A,B,C,D]$ in the state vector, and reactions $R_1$ through $R_6$ as described above. Use mass-action kinetics with rate constants $k_1 = 0.5$, $k_2 = 0.3$, $k_3 = 0.4$, $k_4 = 0.2$, $k_5 = 0.05$, $k_6 = 0.01$, all understood as per unit time and appropriate concentration units. You do not need to report physical units in the output; the problem is purely mathematical. The initial condition is $x(0) = \\big(5.0, 1.0, 0.0, 9.0\\big)^\\top$.\n- Simulate the ODE on a uniform time grid with $T$ samples over the interval $[0, t_{\\text{end}}]$ using a numerically stable ODE solver. Use the exact values of $T$ and $t_{\\text{end}}$ provided in the test suite below.\n\nNoise model and decision rule requirement:\n- The measurement noise is i.i.d. Gaussian $\\varepsilon(t) \\sim \\mathcal{N}(0, \\sigma^2 I_p)$, known $\\sigma^2$. A valid decision rule must compare the observed minimal temporal variance of a linear combination $c^\\top y(t)$ to a noise-consistent bound. It must decide “invariant present” if the smallest possible variance over unit-norm $c$ is not significantly larger than the variance expected from noise only. You must justify the choice of statistical threshold in the solution using a known distributional fact from the fundamental base, and you must implement this decision rule in code.\n\nTest suite:\n- For each test case, the program must simulate the trajectory, construct the noisy observations, run the invariant test, and append a boolean to the result list indicating whether an invariant was detected.\n- Use the following test cases, each specified by the observed species indices (zero-based), the noise standard deviation $\\sigma$, the number of time samples $T$, and the final time $t_{\\text{end}}$:\n  $1.$ Observed indices $[0, 2]$, $\\sigma = 0.001$, $T = 1001$, $t_{\\text{end}} = 40.0$.\n  $2.$ Observed indices $[1, 3]$, $\\sigma = 0.005$, $T = 1001$, $t_{\\text{end}} = 40.0$.\n  $3.$ Observed indices $[0, 1]$, $\\sigma = 0.0001$, $T = 1001$, $t_{\\text{end}} = 40.0$.\n  $4.$ Observed indices $[2, 3]$, $\\sigma = 0.0001$, $T = 1001$, $t_{\\text{end}} = 40.0$.\n  $5.$ Observed index $[0]$, $\\sigma = 0.0001$, $T = 1001$, $t_{\\text{end}} = 40.0$.\n\nOutput format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[result_1, result_2, result_3, result_4, result_5]$), where each $result_i$ is either $\\text{True}$ or $\\text{False}$.",
            "solution": "We begin from the principle that for a closed reaction network with mass-action kinetics, the time evolution is governed by $dx/dt = N \\, v(x)$ where $N$ is the stoichiometric matrix and $v(x)$ collects the reaction rates. Any vector $l \\in \\mathbb{R}^4$ such that $l^\\top N = 0$ defines a linear invariant since\n$$\n\\frac{d}{dt}\\big(l^\\top x(t)\\big) = l^\\top \\frac{dx}{dt} = l^\\top N \\, v(x(t)) = 0,\n$$\nimplying $l^\\top x(t) = \\text{const}$ along solutions. For the specified reactions $R_1$ through $R_6$, with species ordered $[A,B,C,D]$, each reaction’s stoichiometric change vector is:\n- $R_1: A \\rightarrow C$ yields $(-1, 0, +1, 0)^\\top$,\n- $R_2: C \\rightarrow A$ yields $(+1, 0, -1, 0)^\\top$,\n- $R_3: B \\rightarrow D$ yields $(0, -1, 0, +1)^\\top$,\n- $R_4: D \\rightarrow B$ yields $(0, +1, 0, -1)^\\top$,\n- $R_5: A + B \\rightarrow C + D$ yields $(-1, -1, +1, +1)^\\top$,\n- $R_6: C + D \\rightarrow A + B$ yields $(+1, +1, -1, -1)^\\top$.\n\nBy inspection, $l_1 = (1, 0, 1, 0)^\\top$ and $l_2 = (0, 1, 0, 1)^\\top$ satisfy $l_i^\\top N = 0$, thus $x_A(t) + x_C(t)$ and $x_B(t) + x_D(t)$ are invariants. Consequently, any observation $y(t) = P x(t) + \\varepsilon(t)$ that selects species aligned with a conserved moiety admits a linear invariant on observed coordinates.\n\nWe observe a subset of species with selection matrix $P$ (constructed by extracting rows of the $4 \\times 4$ identity corresponding to observed indices), and we add independent and identically distributed (i.i.d.) Gaussian noise $\\varepsilon(t) \\sim \\mathcal{N}(0, \\sigma^2 I_p)$ where $p$ is the number of observed species. The testing goal is to decide whether there exists a nonzero vector $c \\in \\mathbb{R}^p$ such that $c^\\top y(t)$ is constant in time up to the measurement noise.\n\nFormulating the test as an optimization:\nWe consider the problem of finding $c$ and a constant $m$ to minimize the temporal fluctuation of $c^\\top y(t)$,\n$$\n\\min_{\\|c\\|_2 = 1, \\, m \\in \\mathbb{R}} \\sum_{i=1}^{T} \\big(c^\\top y(t_i) - m\\big)^2.\n$$\nFor fixed $c$, the optimal $m$ is the sample mean of $c^\\top y(t_i)$, and the objective reduces to the sample variance of $c^\\top y(t_i)$. Let $Y \\in \\mathbb{R}^{T \\times p}$ be the matrix of observed time-series, and let $\\tilde{Y}$ be $Y$ centered column-wise. The associated sample covariance matrix is\n$$\n\\Sigma_Y = \\frac{1}{T-1} \\tilde{Y}^\\top \\tilde{Y}.\n$$\nThe minimized sample variance over unit-norm $c$ equals the smallest eigenvalue of $\\Sigma_Y$, by the Rayleigh-Ritz characterization:\n$$\n\\min_{\\|c\\|_2 = 1} c^\\top \\Sigma_Y \\, c = \\lambda_{\\min}(\\Sigma_Y),\n$$\nand the minimizer $c$ is the eigenvector associated with $\\lambda_{\\min}(\\Sigma_Y)$.\n\nNoise-consistency decision rule:\nUnder the null that a true invariant exists on the observed coordinates (so $c^\\top x(t)$ is constant) and the only variation in $c^\\top y(t)$ comes from additive noise $\\varepsilon$, the sample variance $s^2$ of $c^\\top y(t)$ is distributed as\n$$\ns^2 \\sim \\sigma^2 \\cdot \\frac{\\chi^2_{T-1}}{T-1},\n$$\nwhere $\\chi^2_{T-1}$ denotes the chi-square distribution with $T-1$ degrees of freedom. A principled acceptance region for “invariant present” is to require that the minimized sample variance does not exceed the $q$-quantile of this distribution,\n$$\n\\lambda_{\\min}(\\Sigma_Y) \\le \\sigma^2 \\cdot \\frac{Q_q(T-1)}{T-1},\n$$\nwhere $Q_q(T-1)$ is the $q$-quantile of $\\chi^2_{T-1}$. Choosing $q = 0.95$ provides a $95\\%$ upper bound on variance attributable to noise alone. If an observed invariant exists, the minimization will discover a $c$ aligned with the invariant direction and yield a minimal variance consistent with noise. If no observed invariant exists, all directions will inherit additional dynamical variability from $x(t)$ beyond noise, and the minimized variance will typically exceed this bound.\n\nAlgorithm steps:\n$1.$ Simulate the ODE $dx/dt = N \\, v(x)$ with mass-action rates $v(x)$ defined by the given reaction scheme and rate constants from $t = 0$ to $t = t_{\\text{end}}$ at $T$ uniformly spaced times, starting from $x(0) = (5.0, 1.0, 0.0, 9.0)^\\top$.\n$2.$ Construct $Y$ by selecting observed species indices with matrix $P$ and adding i.i.d. Gaussian noise $\\varepsilon(t) \\sim \\mathcal{N}(0, \\sigma^2 I_p)$.\n$3.$ Center $Y$ by subtracting the column-wise mean to obtain $\\tilde{Y}$, compute $\\Sigma_Y = \\frac{1}{T-1} \\tilde{Y}^\\top \\tilde{Y}$, and compute its smallest eigenvalue $\\lambda_{\\min}$.\n$4.$ Compute the threshold $\\tau = \\sigma^2 \\cdot \\frac{Q_{0.95}(T-1)}{T-1}$.\n$5.$ Decide “invariant present” if $\\lambda_{\\min} \\le \\tau$ and “invariant absent” otherwise.\n\nValidation on simulated data:\n- For observed indices $[0,2]$ and $[1,3]$, the conserved moieties $x_A + x_C$ and $x_B + x_D$ exist, so the algorithm should detect invariants at moderate noise.\n- For observed indices $[0,1]$, $[2,3]$, and $[0]$, there is no linear invariant supported solely on the observed species, so the algorithm should correctly reject.\n\nThe final program implements these steps, uses the specified parameters for all test cases, and prints a single line with a list of booleans $[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4,\\text{result}_5]$ indicating whether an invariant was detected in each case.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\nfrom scipy.stats import chi2\n\n# Reaction network simulation and invariant detection per the problem description.\n\ndef simulate_reaction_network(T, t_end, x0, rates):\n    \"\"\"\n    Simulate the specified reaction network with mass-action kinetics.\n    Species order: x = [A, B, C, D]\n    Reactions:\n      R1: A -> C       rate k1 * A\n      R2: C -> A       rate k2 * C\n      R3: B -> D       rate k3 * B\n      R4: D -> B       rate k4 * D\n      R5: A + B -> C + D   rate k5 * A * B\n      R6: C + D -> A + B   rate k6 * C * D\n    \"\"\"\n    k1, k2, k3, k4, k5, k6 = rates\n\n    def rhs(t, x):\n        A, B, C, D = x\n        v1 = k1 * A\n        v2 = k2 * C\n        v3 = k3 * B\n        v4 = k4 * D\n        v5 = k5 * A * B\n        v6 = k6 * C * D\n        dA = -v1 + v2 - v5 + v6\n        dB = -v3 + v4 - v5 + v6\n        dC = +v1 - v2 + v5 - v6\n        dD = +v3 - v4 + v5 - v6\n        return np.array([dA, dB, dC, dD], dtype=float)\n\n    t_eval = np.linspace(0.0, t_end, T)\n    sol = solve_ivp(rhs, (0.0, t_end), x0, t_eval=t_eval, method='RK45', atol=1e-9, rtol=1e-9)\n    # Ensure non-negativity numerically (mass-action implies non-negative, but solver may drift slightly)\n    X = np.maximum(sol.y.T, 0.0)\n    return t_eval, X\n\ndef detect_linear_invariant(Y, sigma, q=0.95):\n    \"\"\"\n    Given observed time-series Y (T x p), test for existence of c such that c^T y(t) is constant up to noise.\n    Decision rule:\n      Compute covariance of centered Y, take smallest eigenvalue lambda_min.\n      Compare lambda_min to sigma^2 * chi2_quantile(q, df=T-1) / (T-1).\n      If lambda_min <= threshold, declare invariant present (True), else False.\n    \"\"\"\n    T = Y.shape[0]\n    # Center Y column-wise\n    Y_centered = Y - Y.mean(axis=0, keepdims=True)\n    # Sample covariance\n    Cov = (Y_centered.T @ Y_centered) / (T - 1)\n    # Smallest eigenvalue\n    evals = np.linalg.eigvalsh(Cov)\n    lambda_min = evals[0]\n    # Threshold from chi-square quantile\n    threshold = (sigma ** 2) * (chi2.ppf(q, df=T - 1) / (T - 1))\n    return lambda_min <= threshold\n\ndef solve():\n    # Fixed random seed for reproducibility\n    rng = np.random.default_rng(0)\n\n    # Reaction rate constants and initial condition as specified\n    rates = (0.5, 0.3, 0.4, 0.2, 0.05, 0.01)\n    x0 = np.array([5.0, 1.0, 0.0, 9.0], dtype=float)\n\n    # Define test cases: (observed_indices, sigma, T, t_end)\n    test_cases = [\n        ([0, 2], 0.001, 1001, 40.0),   # Expect invariant (A + C)\n        ([1, 3], 0.005, 1001, 40.0),   # Expect invariant (B + D)\n        ([0, 1], 0.0001, 1001, 40.0),  # No invariant on A,B\n        ([2, 3], 0.0001, 1001, 40.0),  # No invariant on C,D\n        ([0],    0.0001, 1001, 40.0),  # Single species A not invariant alone\n    ]\n\n    results = []\n    for obs_idx, sigma, T, t_end in test_cases:\n        # Simulate network\n        t, X = simulate_reaction_network(T, t_end, x0, rates)\n        # Observations: select species\n        Y = X[:, obs_idx]\n        # Add i.i.d. Gaussian noise with known sigma\n        noise = rng.normal(loc=0.0, scale=sigma, size=Y.shape)\n        Y_noisy = Y + noise\n        # Detect invariant\n        decision = detect_linear_invariant(Y_noisy, sigma, q=0.95)\n        results.append(decision)\n\n    # Print results in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}