{
    "hands_on_practices": [
        {
            "introduction": "构建代理模型通常需要进行大量且计算成本高昂的数值相对论（NR）模拟。本练习将引导您完成关键的第一步：利用双黑洞系统的物理对称性来显著缩小所需的参数空间。掌握这项技能有助于高效地规划模拟，并使大规模代理模型的构建项目变得可行 。",
            "id": "3488521",
            "problem": "您正在为数值相对论（NR）中的旋向对齐双黑洞（BBH）波形构建一个降阶代理模型。波形被分解为自旋权重球谐函数，因此应变可以写成 $$h(t,\\theta,\\phi)=\\sum_{\\ell=2}^{\\ell_{\\max}}\\sum_{m=-\\ell}^{\\ell}h_{\\ell m}(t)\\,{}_{-2}Y_{\\ell m}(\\theta,\\phi),$$ 其中 $h_{\\ell m}(t)$ 是模式振幅，${}_{-2}Y_{\\ell m}(\\theta,\\phi)$ 是自旋权重为 $-2$ 的自旋权重球谐函数。对于非进动的、准圆轨道的、旋向对齐的系统，有两个相关的对称性：\n\n1. 组分标签的交换对称性：物理规律在 $(m_{1},m_{2},\\chi_{1},\\chi_{2})\\mapsto(m_{2},m_{1},\\chi_{2},\\chi_{1})$ 变换下保持不变，这将质量比 $q=m_{1}/m_{2}$ 映射为 $q\\mapsto 1/q$，并交换自旋 $(\\chi_{1},\\chi_{2})\\mapsto(\\chi_{2},\\chi_{1})$。\n2. 方位角模式对称性：对于非进动系统，$$h_{\\ell,-m}(t)=(-1)^{\\ell}h_{\\ell m}(t)^{*},$$ 因此 $m$ 为负的模式由 $m$ 为正的模式确定。\n\n您最初的“朴素”采样计划如下。您的目标质量比为 $q\\in[1,8]$，无量纲的旋向对齐自旋为 $\\chi_{i}\\in[-0.9,0.9]$（其中 $i\\in\\{1,2\\}$），但在计算唯一样本数时，您不强制执行标签排序，也不利用模式对称性。具体来说：\n- 您在对称区间 $q\\in[1/8,8]$ 上按 $\\ln q$ 均匀布点采样。\n- 您在自旋参数的正方形区域 $[-0.9,0.9]\\times[-0.9,0.9]$ 内对 $(\\chi_{1},\\chi_{2})$ 均匀布点采样，并将 $(\\chi_{1},\\chi_{2})$ 和 $(\\chi_{2},\\chi_{1})$ 视为不同的样本。\n- 对于每个多极矩 $\\ell\\in\\{2,3,4\\}$，您都包含所有的方位角指数 $m$，因此每个 $\\ell$ 都贡献所有 $2\\ell+1$ 个 $m$ 值。\n\n然后，您决定利用这两种对称性来减少唯一采样的数量：\n- 利用标签交换对称性，将质量比限制在 $q\\in[1,8]$（等价于 $\\ln q\\ge 0$），并将自旋参数限制在三角形区域 $\\{(\\chi_{1},\\chi_{2})\\in[-0.9,0.9]^{2}\\mid \\chi_{1}\\ge\\chi_{2}\\}$。\n- 利用方位角对称性，对每个 $\\ell$ 只保留 $m\\ge 0$ 的模式。\n\n假设在 $\\ln q$ 和自旋正方形区域上的采样密度是恒定的，并忽略测度为零的边界（例如 $\\chi_{1}=\\chi_{2}$）。定义采样节省率 $S$ 为通过应用这些对称性可消除的朴素样本的比例，即 $$S=1-\\frac{\\text{应用对称性约简后所需的样本数}}{\\text{朴素计划中的样本数}}.$$\n\n计算 $\\ell\\in\\{2,3,4\\}$ 情况下的 $S$。将最终结果表示为一个四舍五入到四位有效数字的小数。不需要单位。",
            "solution": "该问题要求计算在为旋向对齐双黑洞并合的引力波波形构建代理模型问题中，通过利用对称性获得的采样节省率 $S$。节省率 $S$ 定义为：\n$$S = 1 - \\frac{N_{\\text{reduced}}}{N_{\\text{naive}}}$$\n其中 $N_{\\text{naive}}$ 是朴素计划中的样本数，$N_{\\text{reduced}}$ 是利用对称性的计划中的样本数。\n\n在代理模型的背景下，一个“样本”可以被理解为必须包含在训练数据中的一个唯一信息片段。对于一个在由质量比 $q$ 和自旋 $(\\chi_1, \\chi_2)$ 定义的参数空间上的波形模式 $h_{\\ell m}$ 模型，总样本数与被采样的参数空间的“体积”和被建模的不同波形模式数量的乘积成正比。设 $V_{param}$ 为参数空间的测度，$N_{modes}$ 为模式的数量。那么，总样本数 $N$ 与它们的乘积成正比：\n$$N \\propto V_{param} \\times N_{modes}$$\n我们将分别分析朴素计划和约简计划，以确定每种情况下的这个量。\n\n首先，我们分析“朴素”采样计划。\n\n参数空间由质量比 $q$ 和两个旋向对齐的自旋 $\\chi_1$ 和 $\\chi_2$ 组成。\n对于质量比，采样在区间 $q \\in [1/8, 8]$ 上按 $\\ln q$ 均匀分布。这对应于 $\\ln q$ 的区间从 $\\ln(1/8) = -\\ln(8)$到 $\\ln(8)$。这个区间的长度是 $L_{q, \\text{naive}} = \\ln(8) - (-\\ln(8)) = 2\\ln(8)$。\n对于自旋，采样在正方形区域 $(\\chi_1, \\chi_2) \\in [-0.9, 0.9] \\times [-0.9, 0.9]$ 上均匀分布。这个正方形的边长是 $0.9 - (-0.9) = 1.8$。这个区域的面积是 $A_{\\chi, \\text{naive}} = (1.8)^2 = 3.24$。\n朴素参数空间的测度与这些量的乘积成正比：\n$$V_{param, \\text{naive}} \\propto L_{q, \\text{naive}} \\times A_{\\chi, \\text{naive}} = 2\\ln(8) \\times (1.8)^2$$\n\n对于波形模式，朴素计划包括每个多极矩 $\\ell \\in \\{2, 3, 4\\}$ 的所有方位角指数 $m$。对于给定的 $\\ell$，$m$ 有 $2\\ell+1$ 个可能的值，范围从 $-\\ell$到 $\\ell$。总模式数是对指定的 $\\ell$ 值求和：\n$$N_{modes, \\text{naive}} = \\sum_{\\ell=2}^{4} (2\\ell+1) = (2(2)+1) + (2(3)+1) + (2(4)+1) = 5 + 7 + 9 = 21$$\n因此，朴素样本的总数为：\n$$N_{\\text{naive}} \\propto V_{param, \\text{naive}} \\times N_{modes, \\text{naive}} \\propto (2\\ln(8) \\times (1.8)^2) \\times 21$$\n\n接下来，我们分析利用两种对称性的“约简”采样计划。\n\n第一个对称性是标签交换对称性，$(m_1, m_2, \\chi_1, \\chi_2) \\mapsto (m_2, m_1, \\chi_2, \\chi_1)$。这将 $q = m_1/m_2$ 映射到 $1/q$，将 $(\\chi_1, \\chi_2)$ 映射到 $(\\chi_2, \\chi_1)$。\n为了利用这个对称性，参数空间被约简了。质量比被限制在 $q \\in [1, 8]$，这对应于 $\\ln q \\in [0, \\ln(8)]$。这个区间的长度是 $L_{q, \\text{reduced}} = \\ln(8)$。这是朴素区间长度的一半：$L_{q, \\text{reduced}} = \\frac{1}{2}L_{q, \\text{naive}}$。\n自旋空间被限制在三角形区域 $\\{(\\chi_{1},\\chi_{2})\\in[-0.9,0.9]^{2}\\mid \\chi_{1}\\ge\\chi_{2}\\}$。这个区域是一个由对角线 $\\chi_1 = \\chi_2$ 和正方形 $[-0.9, 0.9]^2$ 的两条边形成的三角形。由于边界 $\\chi_1 = \\chi_2$ 是一个测度为零的集合，这个三角形区域的面积恰好是正方形面积的一半：$A_{\\chi, \\text{reduced}} = \\frac{1}{2}A_{\\chi, \\text{naive}} = \\frac{1}{2}(1.8)^2$。\n因此，约简参数空间的测度为：\n$$V_{param, \\text{reduced}} \\propto L_{q, \\text{reduced}} \\times A_{\\chi, \\text{reduced}} = (\\ln(8)) \\times \\left(\\frac{1}{2}(1.8)^2\\right) = \\frac{1}{4} (2\\ln(8) \\times (1.8)^2)$$\n这表明 $V_{param, \\text{reduced}} = \\frac{1}{4}V_{param, \\text{naive}}$。\n\n第二个对称性是方位角模式对称性，$h_{\\ell,-m}(t)=(-1)^{\\ell}h_{\\ell m}(t)^{*}$。这个关系意味着 $m$ 为负的模式不是独立的，可以从 $m$ 为正的模式计算得出。因此，我们只需要采样和建模 $m \\ge 0$ 的模式。对于给定的 $\\ell$，这些是 $m \\in \\{0, 1, \\dots, \\ell\\}$ 的模式，总共有 $\\ell+1$ 个模式。\n约简计划中的模式数量为：\n$$N_{modes, \\text{reduced}} = \\sum_{\\ell=2}^{4} (\\ell+1) = (2+1) + (3+1) + (4+1) = 3 + 4 + 5 = 12$$\n约简样本的总数为：\n$$N_{\\text{reduced}} \\propto V_{param, \\text{reduced}} \\times N_{modes, \\text{reduced}} \\propto \\left(\\frac{1}{4} (2\\ln(8) \\times (1.8)^2)\\right) \\times 12$$\n\n现在我们可以计算约简样本与朴素样本的比率。比例常数和参数空间项 $2\\ln(8) \\times (1.8)^2$ 会被抵消。\n$$\\frac{N_{\\text{reduced}}}{N_{\\text{naive}}} = \\frac{V_{param, \\text{reduced}} \\times N_{modes, \\text{reduced}}}{V_{param, \\text{naive}} \\times N_{modes, \\text{naive}}} = \\left(\\frac{V_{param, \\text{reduced}}}{V_{param, \\text{naive}}}\\right) \\times \\left(\\frac{N_{modes, \\text{reduced}}}{N_{modes, \\text{naive}}}\\right)$$\n代入我们导出的比率：\n$$\\frac{N_{\\text{reduced}}}{N_{\\text{naive}}} = \\left(\\frac{1}{4}\\right) \\times \\left(\\frac{12}{21}\\right) = \\frac{12}{84} = \\frac{1}{7}$$\n\n最后，我们计算采样节省率 $S$：\n$$S = 1 - \\frac{N_{\\text{reduced}}}{N_{\\text{naive}}} = 1 - \\frac{1}{7} = \\frac{6}{7}$$\n为了将其表示为四舍五入到四位有效数字的小数，我们进行除法运算：\n$$\\frac{6}{7} \\approx 0.8571428...$$\n四舍五入到四位有效数字得到 $0.8571$。",
            "answer": "$$\n\\boxed{0.8571}\n$$"
        },
        {
            "introduction": "在生成一组数值相对论波形（即“快照”）之后，我们需要一个稳健的算法来构建实际的代理模型。本练习提供了一个关于经验插值法（Empirical Interpolation Method, EIM）的完整实践，该方法是现代代理模型构建的基石。通过为一个简化的波形从零开始构建模型，您将深入理解降阶基和贪心节点选择如何协同工作，以创建一个高效且精确的插值器 。",
            "id": "3488482",
            "problem": "实现一个完整的、可运行的程序，为一类示例性的类引力波波形构建经验插值代理，并验证重构误差随着经验节点数量的增加而收敛。任务是从降阶建模和参数化函数族的线性近似的基本原理出发。波形族以解析形式给出，以便可以直接验证代理的构建和误差的量化。角度必须以弧度处理。\n\n给定一个参数化波形族 $w(t;\\lambda)$，定义在 $t \\in [0,1]$ 和 $\\lambda \\in [0,1]$ 上。该波形为\n$$\nw(t;\\lambda) \\equiv \\left(1 + 0.3\\,\\lambda\\right)\\,\\left(t+0.01\\right)^{1/4}\\,\\exp\\!\\left(-t^{8}\\right)\\,\\sin\\!\\big(\\varphi(t;\\lambda)\\big),\n$$\n其中相位是\n$$\n\\varphi(t;\\lambda) \\equiv 2\\pi f_0\\,t + \\beta\\,\\lambda\\,t^{3/2} + \\kappa\\,t^{2}.\n$$\n使用 $f_0 = 20$，$\\beta = 35$ 和 $\\kappa = 3$。正弦函数的参数以弧度为单位。\n\n基础出发点：利用这样一个原理，即一个光滑、低内蕴维度的参数化函数族允许通过其快照矩阵的前导奇异向量捕获的精确低秩近似。经验插值方法 (Empirical Interpolation Method, EIM) 构建一个插值算子，该算子在自适应选择的节点上匹配一个函数，以恢复降阶基展开中的系数。你必须从第一性原理出发实现以下步骤：\n\n1. 时间离散化与快照：\n   - 用一个包含 $N_t = 2000$ 个点的均匀网格对区间 $[0,1]$ 进行离散化。\n   - 构建一个训练参数集 $\\Lambda_{\\mathrm{train}}$，包含 $M = 20$ 个在 $[0,1]$ 内的等间距值。\n   - 形成快照矩阵 $S \\in \\mathbb{R}^{N_t \\times M}$，其列 $S_{:,j} = w(t;\\lambda_j)$ 对应于 $\\lambda_j \\in \\Lambda_{\\mathrm{train}}$。\n\n2. 通过奇异值分解 (SVD) 获得降阶基：\n   - 计算薄奇异值分解 $S = U \\Sigma V^{\\top}$。\n   - 降阶基函数是前 $r$ 个左奇异向量 $U_{:,1},\\dots,U_{:,r}$，其中 $1 \\le r \\le M$。\n\n3. 经验插值方法 (EIM) 节点选择：\n   - 归纳地定义经验插值节点。令 $\\Phi_k$ 表示 $k$ 维基 $\\{U_{:,1},\\dots,U_{:,k}\\}$，视为时间网格上的函数。\n   - 初始化：选择第一个节点索引 $i_1$ 作为 $U_{:,1}$ 在网格上绝对值的最大值所在的索引。\n   - 归纳步骤：给定节点 $\\{i_1,\\dots,i_{k-1}\\}$，找到系数 $\\{a_j\\}_{j=1}^{k-1}$，使得 $U_{:,k}$ 在由 $\\Phi_{k-1}$ 张成的子空间中，在现有节点上得到插值。也就是说，找到 $a \\in \\mathbb{R}^{k-1}$ 使得对于所有 $\\ell \\in \\{1,\\dots,k-1\\}$，\n     $$\n     \\sum_{j=1}^{k-1} a_j\\,U_{i_\\ell,j} = U_{i_\\ell,k}.\n     $$\n     然后形成残差向量 $r^{(k)} = U_{:,k} - \\sum_{j=1}^{k-1} a_j\\,U_{:,j}$，并选择 $i_k$ 作为 $r^{(k)}$ 在网格上绝对值的最大值所在的索引。\n   - 这样，对于每个 $m \\in \\{1,2,\\dots,M\\}$，都得到一个包含 $m$ 个节点的集合 $\\{i_1,\\dots,i_m\\}$。\n\n4. 经验插值重构：\n   - 对于给定的波形 $y = w(\\cdot;\\lambda)$ 和选定的 $m$，通过在经验节点上强制插值来计算系数 $c \\in \\mathbb{R}^{m}$：\n     $$\n     \\sum_{j=1}^{m} c_j\\,U_{i_\\ell,j} = y_{i_\\ell}, \\quad \\ell=1,\\dots,m.\n     $$\n     求解该线性系统得到 $c$，并重构 $\\widehat{y}^{(m)} = \\sum_{j=1}^{m} c_j\\,U_{:,j}$。\n\n5. 误差量化与奇异值衰减：\n   - 对于给定的 $\\lambda$，计算在 $[0,1]$ 上的相对 $L^2$ 误差，\n     $$\n     \\varepsilon^{(m)}(\\lambda) \\equiv \\frac{\\left(\\int_0^1 \\big|y(t) - \\widehat{y}^{(m)}(t)\\big|^2\\,dt\\right)^{1/2}}{\\left(\\int_0^1 |y(t)|^2\\,dt\\right)^{1/2}},\n     $$\n     在时间网格上使用梯形法则计算。\n   - 通过将 $\\log(\\sigma_k)$ 作为 $k$ 的函数拟合成一条直线来估计奇异值的指数衰减率，其中 $\\{\\sigma_k\\}$ 是来自 $\\Sigma$ 的奇异值。具体来说，对于那些 $\\sigma_k$ 保持大于 $\\sigma_1$ 的一个固定小分数（例如，大于 $10^{-12}\\,\\sigma_1$）的索引 $k$，求解一个最小二乘问题以获得参数 $(a,b)$：\n     $$\n     \\log \\sigma_k \\approx a + b\\,k,\n     $$\n     并报告衰减率估计值 $\\rho \\equiv -b$。\n\n测试套件规范：\n- 使用测试参数集 $\\Lambda_{\\mathrm{test}} = \\{0.07,\\,0.31,\\,0.59,\\,0.93\\}$。\n- 使用节点数量 $\\mathcal{M} = \\{1,\\,2,\\,3,\\,5,\\,8,\\,12,\\,16\\}$。\n- 对于每个 $m \\in \\mathcal{M}$，计算最大测试误差\n  $$\n  E_m \\equiv \\max_{\\lambda \\in \\Lambda_{\\mathrm{test}}} \\varepsilon^{(m)}(\\lambda).\n  $$\n- 同时按上述方法计算奇异值衰减率估计值 $\\rho$。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。第一个条目必须是按此顺序排列的七个值 $[E_1,E_2,E_3,E_5,E_8,E_{12},E_{16}]$ 的列表，第二个条目必须是标量 $\\rho$。使用弧度角度，不带物理单位。每个打印的数值必须四舍五入到六位有效数字并以科学记数法表示。例如，输出形式为\n  $$\n  [[\\text{e}_1,\\text{e}_2,\\dots,\\text{e}_7],\\text{r}]\n  $$\n  其中每个 $\\text{e}_j$ 和 $\\text{r}$ 都以类似 $1.234567\\text{e}{-03}$ 的数字形式出现。\n\n科学真实性：\n- 波形族 $w(t;\\lambda)$ 是解析的，在 $t$ 和 $\\lambda$ 上都光滑，并表现出类啁啾相位演化和振幅调制，这些都模拟了数值相对论波形的显著特征，而无需援引完整的广义相对论。这确保了降阶基和经验插值方法是适用的，并且奇异值会有效地衰减。\n\n覆盖性设计：\n- 所选的 $\\mathcal{M}$ 覆盖了边界情况 $m=1$、适度的中间尺寸以及一个接近训练集维度的大尺寸。\n- 测试集 $\\Lambda_{\\mathrm{test}}$ 包含接近参数范围两端和内部的值，以探测整个定义域上的插值行为。\n\n你的实现必须是自包含的，无需用户输入，并严格遵守指定的最终输出格式。",
            "solution": "经评估，用户提供的问题是**有效的**。这是一个属于数值分析和降阶建模领域的、适定的、有科学依据的问题，所有必要的数据和算法步骤都已明确指定。不存在会使其无效的矛盾、模糊之处或对科学原理的违背。任务是实现经验插值方法 (Empirical Interpolation Method, EIM) 来为给定的参数化函数族构建一个代理模型，这是计算科学中一种标准且重要的技术。\n\n解决方案通过遵循规定的步骤序列来实现，这些步骤植根于线性代数和逼近论的原理。\n\n**1. 波形离散化与快照矩阵生成**\n基础步骤是将连续的参数化函数族 $w(t;\\lambda)$ 表示为适合数值线性代数的离散形式。该波形定义为：\n$$\nw(t;\\lambda) = \\left(1 + 0.3\\,\\lambda\\right)\\,\\left(t+0.01\\right)^{1/4}\\,\\exp\\!\\left(-t^{8}\\right)\\,\\sin\\!\\big(2\\pi f_0\\,t + \\beta\\,\\lambda\\,t^{3/2} + \\kappa\\,t^{2}\\big)\n$$\n其中常数 $f_0 = 20$, $\\beta = 35$, $\\kappa = 3$。\n\n首先，将时间域 $t \\in [0,1]$ 离散化为一个包含 $N_t = 2000$ 个点的均匀网格。其次，在参数域 $\\lambda \\in [0,1]$ 上采样 $M=20$ 个等距点，以形成训练集 $\\Lambda_{\\mathrm{train}}$。对于训练集中的每个参数 $\\lambda_j \\in \\Lambda_{\\mathrm{train}}$，在时间网格上计算波形 $w(t; \\lambda_j)$，得到一个在 $\\mathbb{R}^{N_t}$ 中的向量。将这些向量作为列组合起来，形成快照矩阵 $S \\in \\mathbb{R}^{N_t \\times M}$。因此，矩阵 $S$ 是该函数族的离散表示。\n\n**2. 通过奇异值分解 (SVD) 获得降阶基**\n低秩近似原理指出，如果函数族中的函数高度相关，那么快照矩阵 $S$ 可以被一个低秩矩阵精确近似。在最小二乘意义下，最优的低秩基由 $S$ 的前导左奇异向量给出。计算一个薄奇异值分解：\n$$\nS = U \\Sigma V^{\\top}\n$$\n其中 $U \\in \\mathbb{R}^{N_t \\times M}$ 是一个列向量标准正交的矩阵（左奇异向量），$\\Sigma \\in \\mathbb{R}^{M \\times M}$ 是一个包含奇异值 $\\{\\sigma_k\\}$ 的对角矩阵，而 $V \\in \\mathbb{R}^{M \\times M}$ 是一个正交矩阵。$U$ 的列，记为 $\\{U_{:,1}, \\dots, U_{:,M}\\}$，构成了降阶基。奇异值 $\\sigma_k$ 的快速衰减表明该函数族具有较低的内蕴维度，非常适合进行降阶建模。\n\n**3. 用于节点选择的经验插值方法 (EIM)**\n尽管 SVD 提供了最优基，但为新波形计算投影系数需要计算其与基函数的内积，这一操作的成本与计算完整波形相当。EIM 通过选择一小组“经验”时间点（或节点）来规避此问题，在这些点上计算波形的值。然后通过求解一个小型线性系统来找到系数。\n\nEIM 节点通过贪心算法选出，以在降阶基内实现最优插值。\n- **步骤 1 ($k=1$):** 考虑第一个基函数 $U_{:,1}$。选择第一个节点 $i_1$ 作为 $|U_{:,1}(t)|$ 取最大值时的时间索引。该点捕捉了最主要模式的最显著特征。\n- **归纳步骤 ($k > 1$):** 为了找到第 $k$ 个节点 $i_k$，我们首先考虑第 $k$ 个基函数 $U_{:,k}$。我们通过在先前选择的节点 $\\{i_1, \\dots, i_{k-1}\\}$ 上强制相等，在由先前基函数 $\\{U_{:,1}, \\dots, U_{:,k-1}\\}$ 张成的子空间中构造它的插值。这需要求解一个 $(k-1) \\times (k-1)$ 的线性系统来获得插值系数 $\\{a_j\\}_{j=1}^{k-1}$：\n$$\n\\sum_{j=1}^{k-1} a_j\\,U_{i_\\ell, j} = U_{i_\\ell, k}, \\quad \\text{for } \\ell = 1, \\dots, k-1\n$$\n残差 $r^{(k)}(t) = U_{:,k} - \\sum_{j=1}^{k-1} a_j U_{:,j}$ 表示 $U_{:,k}$ 中无法被先前基函数在现有节点上捕捉到的部分。选择新节点 $i_k$ 作为该残差 $|r^{(k)}(t)|$ 取最大值时的时间索引。对 $k=1, \\dots, M$ 重复此过程，以生成一个包含 $M$ 个经验节点的序列。\n\n**4. 波形重构与误差量化**\n对于一个测试波形 $y(t) = w(t; \\lambda)$，其中 $\\lambda \\in \\Lambda_{\\mathrm{test}}$，以及选定的基函数/节点数量 $m$，代理近似 $\\widehat{y}^{(m)}$ 被构建为前 $m$ 个基函数的线性组合：$\\widehat{y}^{(m)} = \\sum_{j=1}^{m} c_j U_{:,j}$。系数 $c = \\{c_j\\}_{j=1}^m$ 通过求解一个 $m \\times m$ 的线性系统来确定，该系统强制真实波形与代理在第一批 $m$ 个经验节点 $\\{i_1, \\dots, i_m\\}$ 处相等：\n$$\n\\sum_{j=1}^{m} c_j\\,U_{i_\\ell, j} = y_{i_\\ell}, \\quad \\ell=1,\\dots,m\n$$\n该代理的精度通过相对 $L^2$ 误差 $\\varepsilon^{(m)}(\\lambda)$ 来量化，该误差在时间网格上使用梯形法则进行数值计算。然后，对于 $\\mathcal{M} = \\{1, 2, 3, 5, 8, 12, 16\\}$ 中的每个 $m$，确定在测试集 $\\Lambda_{\\mathrm{test}}$ 上的最大误差 $E_m$。\n\n**5. 奇异值衰减率**\n奇异值的指数衰减是模型可约简性的关键指标。衰减率 $\\rho$ 通过对模型 $\\log \\sigma_k \\approx a + b k$ 进行线性最小二乘拟合来估计，拟合对象是所有数值上显著的奇异值（即 $\\sigma_k > 10^{-12} \\sigma_1$）。估计的速率即为 $\\rho = -b$。\n\n最终的程序实现了这些步骤，以计算所需的误差度量和奇异值衰减率，并根据问题规范将输出格式化为单行。",
            "answer": "[[2.115998e-01,1.134800e-01,1.011397e-02,1.385566e-04,3.220141e-07,6.486221e-11,2.052684e-13],1.890332e+00]"
        },
        {
            "introduction": "一个构建好的代理模型只有在数值稳定的前提下才是有用的，因为插值步骤可能会放大微小的误差，从而损害模型的预测能力。本练习通过引入“条件数”这一诊断工具来解决数值稳定性的关键问题。您将学习如何量化误差放大的风险，并为模型确定一个安全的截断阶数，以确保其预测结果的可靠性 。",
            "id": "3488481",
            "problem": "考虑一个数值相对论波形的代理建模场景，其中使用一个降阶基矩阵 $U \\in \\mathbb{R}^{m \\times r}$ 从一组选定的节点 $\\mathcal{T} = (t_{i_1}, \\dots, t_{i_r})$（这些节点索引了基的行）来重建波形样本。基于经验插值的重建由方形插值子矩阵 $U(\\mathcal{T}) \\in \\mathbb{R}^{r \\times r}$ 控制，该子矩阵通过将 $U$ 限制到由 $\\mathcal{T}$ 给出的行而形成。经验插值法 (Empirical Interpolation Method, EIM) 用于通过 $U(\\mathcal{T}) c = w(\\mathcal{T})$ 计算系数 $c \\in \\mathbb{R}^r$，从而重建波形近似 $U c$。我们关心的是，由于 $U(\\mathcal{T})$ 的条件和 $U$ 的算子范数，节点 $w(\\mathcal{T})$ 中的误差在重建近似 $U c$ 中被放大的情况。\n\n从以下基本概念开始：\n- 奇异值分解 (SVD)：对于一个矩阵 $A$，其奇异值用 $\\sigma_{\\max}(A)$ 和 $\\sigma_{\\min}(A)$ 分别表示最大和最小奇异值。谱范数为 $\\lVert A \\rVert_2 = \\sigma_{\\max}(A)$，如果 $A$ 可逆，则 $\\lVert A^{-1} \\rVert_2 = 1/\\sigma_{\\min}(A)$。\n- 2-范数条件数：对于可逆矩阵 $A$，$\\kappa_2(A) = \\lVert A \\rVert_2 \\lVert A^{-1} \\rVert_2 = \\sigma_{\\max}(A)/\\sigma_{\\min}(A)$。\n- 线性误差传播：对于节点上的扰动 $\\delta w(\\mathcal{T})$，所导致的系数误差满足 $\\delta c = U(\\mathcal{T})^{-1} \\delta w(\\mathcal{T})$，重建的波形误差为 $U \\delta c$。因此，节点误差在重建近似中的放大因子的一个界为 $G = \\lVert U \\rVert_2 \\lVert U(\\mathcal{T})^{-1} \\rVert_2$。\n\n任务：给定 $U$ 和一个有序节点集 $\\mathcal{T}$，对于截断 $k = 1, 2, \\dots, r$，计算方形插值矩阵 $U_k(\\mathcal{T}_k)$ 的条件数。其中 $U_k$ 是 $U$ 截断为其前 $k$ 列，$\\mathcal{T}_k$ 是 $\\mathcal{T}$ 截断为其前 $k$ 个索引。选择最大的截断 $k$，使得放大因子 $G_k = \\lVert U_k \\rVert_2 \\lVert U_k(\\mathcal{T}_k)^{-1} \\rVert_2$ 严格小于 $10$。对于所选的截断，还需报告 2-范数条件数 $\\kappa_2(U_k(\\mathcal{T}_k)) = \\sigma_{\\max}(U_k(\\mathcal{T}_k))/\\sigma_{\\min}(U_k(\\mathcal{T}_k))$。如果 $U_k(\\mathcal{T}_k)$ 是奇异的，则将 $\\lVert U_k(\\mathcal{T}_k)^{-1} \\rVert_2$ 和 $\\kappa_2(U_k(\\mathcal{T}_k))$ 视为 $+\\infty$。\n\n为使问题具体化并能以纯数学术语普遍适用，使用一个离散时间网格和一个范德蒙型降阶基，定义如下。对于每个测试用例：\n- 令 $m$ 为采样时间点数，$r$ 为降阶基大小。\n- 定义一个均匀网格 $t_i = \\frac{i}{m-1}$，其中 $i = 0, 1, \\dots, m-1$。\n- 定义降阶基矩阵 $U \\in \\mathbb{R}^{m \\times r}$，其元素为 $U_{i,j} = t_i^j$，其中列索引 $j = 0, 1, \\dots, r-1$。\n- 定义有序节点集 $\\mathcal{T}$ 为 $\\{0,1,\\dots,m-1\\}$ 中 $r$ 个不同整数索引的列表。\n\n您必须为每个测试用例计算满足 $G_k  10$ 的最大截断 $k$，以及相应的条件数 $\\kappa_2(U_k(\\mathcal{T}_k))$ 和放大因子 $G_k$。全程使用谱范数（2-范数）。将浮点数输出四舍五入到六位小数。\n\n测试套件：\n- Case 1: $m = 12$, $r = 6$, $\\mathcal{T} = [0,2,4,6,8,10]$.\n- Case 2: $m = 12$, $r = 6$, $\\mathcal{T} = [0,1,2,3,4,5]$.\n- Case 3: $m = 20$, $r = 10$, $\\mathcal{T} = [10,11,12,13,14,15,16,17,18,19]$.\n- Case 4: $m = 20$, $r = 10$, $\\mathcal{T} = [19,18,17,16,15,14,13,12,11,10]$.\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例的结果必须是 $[k, \\kappa, G]$ 形式的列表，其中 $k$ 是整数，$\\kappa$ 和 $G$ 是四舍五入到六位小数的浮点数。例如，最终输出应类似于 $[[k_1,\\kappa_1,G_1],[k_2,\\kappa_2,G_2],[k_3,\\kappa_3,G_3],[k_4,\\kappa_4,G_4]]$。",
            "solution": "目标是为几个测试用例确定降阶基近似的最大截断水平 `$k$`，该近似能保持指定水平的数值稳定性。此稳定性由一个放大因子 `$G_k$` 量化，该因子必须保持严格小于 `$10$`。对于这个最大的 `$k$`，我们还必须报告相关插值矩阵的条件数 `$\\kappa_2(U_k(\\mathcal{T}_k))$` 和放大因子 `$G_k$`。\n\n解决方案通过实现问题陈述中描述的定义和算法来进行。对于由参数 `$m$`（时间样本数）、`$r$`（基大小）和 `$\\mathcal{T}$`（有序节点索引集）定义的每个测试用例，我们执行以下步骤。\n\n首先，我们构建必要的数学对象。一个均匀时间网格 `$\\{t_i\\}_{i=0}^{m-1}$` 由 `$t_i = \\frac{i}{m-1}$` 定义。使用此网格，我们构成 `$m \\times r$` 基矩阵 `$U$`，其元素由 `$U_{i,j} = t_i^j$` 给出，其中 `$i \\in \\{0, \\dots, m-1\\}$` 且 `$j \\in \\{0, \\dots, r-1\\}$`。这是一个范德蒙型矩阵。\n\n接下来，我们从 `$k=1$` 到 `$k=r$` 遍历所有可能的截断水平。对于每个 `$k$`，我们将截断基矩阵 `$U_k$` 定义为 `$U$` 的前 `$k$` 列，并将截断的有序节点集 `$\\mathcal{T}_k$` 定义为 `$\\mathcal{T}$` 的前 `$k$` 个索引。这些被用来构建方形的 `$k \\times k$` 插值子矩阵 `$U_k(\\mathcal{T}_k)$`，该矩阵通过选择 `$U_k$` 中与 `$\\mathcal{T}_k$` 中索引相对应的行来形成。\n\n任务的核心是计算放大因子 `$G_k$` 和条件数 `$\\kappa_2(U_k(\\mathcal{T}_k))$`。这些量是根据矩阵范数定义的，而矩阵范数最可靠的计算方法是通过奇异值分解 (SVD)。放大因子为 `$G_k = \\lVert U_k \\rVert_2 \\lVert U_k(\\mathcal{T}_k)^{-1} \\rVert_2$`。矩阵 `$A$` 的谱范数 `$\\lVert A \\rVert_2$` 是其最大奇异值 `$\\sigma_{\\max}(A)$`。如果 `$A$` 可逆，其逆矩阵的范数 `$\\lVert A^{-1} \\rVert_2$` 是其最小奇异值的倒数，即 `$1/\\sigma_{\\min}(A)$`。\n因此，对于每个 `$k$`，我们计算：\n$1$. `$U_k$` 的 SVD，以找到其最大奇异值 `$\\sigma_{\\max}(U_k) = \\lVert U_k \\rVert_2$`。\n$2$. `$U_k(\\mathcal{T}_k)$` 的 SVD，以找到其最大和最小奇异值 `$\\sigma_{\\max}(U_k(\\mathcal{T}_k))$` 和 `$\\sigma_{\\min}(U_k(\\mathcal{T}_k))$`。\n\n如果 `$U_k(\\mathcal{T}_k)$` 是数值奇异的，其最小奇异值 `$\\sigma_{\\min}(U_k(\\mathcal{T}_k))$` 实际上为零。在这种情况下，根据问题的要求，`$\\lVert U_k(\\mathcal{T}_k)^{-1} \\rVert_2$` 和 `$\\kappa_2(U_k(\\mathcal{T}_k))$` 被视为无穷大。在数值上，这通过检查 `$\\sigma_{\\min}(U_k(\\mathcal{T}_k))$` 是否低于一个相对于机器精度的小阈值来处理。\n\n如果矩阵不是奇异的，我们计算以下量：\n- 放大因子：`$G_k = \\sigma_{\\max}(U_k) \\cdot \\frac{1}{\\sigma_{\\min}(U_k(\\mathcal{T}_k))}$`\n- 条件数：`$\\kappa_2(U_k(\\mathcal{T}_k)) = \\frac{\\sigma_{\\max}(U_k(\\mathcal{T}_k))}{\\sigma_{\\min}(U_k(\\mathcal{T}_k))}$`\n\n然后我们检查是否 `$G_k  10$`。我们需要找到满足此条件的最大 `$k$`。从 `$k=1$` 到 `$r$` 执行迭代搜索。在迭代时，我们跟踪满足条件的最新（因此是最大）的 `$k$` 值。与此最终 `$k$` 对应的 `$\\kappa_2(U_k(\\mathcal{T}_k))$` 和 `$G_k$` 的值被存储下来。可以确定，当 `$k=1$` 时，`$G_1 = \\sqrt{m}$`，对于所有测试用例，该值都小于 `$10$`，从而保证了解的存在性。\n\n最后，对于每个测试用例，收集得到的三元组 `$[k, \\kappa, G]$`（其中浮点数 `$\\kappa$` 和 `$G$` 四舍五入到六位小数）。然后将所有测试用例的结果按照指定格式化为单个字符串。",
            "answer": "[[5,33.513364,5.438510],[5,185.034458,7.962846],[9,2493.539353,8.966952],[9,2493.539353,8.966952]]"
        }
    ]
}