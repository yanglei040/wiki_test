{
    "hands_on_practices": [
        {
            "introduction": "在分析并合后的物质流时，首要任务是区分引力束缚的物质和将要逃逸形成抛射物的非束缚物质。在广义相对论的静态时空中，这一判断基于守恒的能量。本练习将探讨两种常用的非束缚判据：适用于无压强测试粒子的测地线判据 ($u_t < -1$)，以及适用于包含热能和压强重要贡献的热流体的伯努利判据 ($h u_t < -1$)。通过将这些判据应用于数值模拟的“示踪粒子”数据，你将能够量化不同判据对预测的总抛射物质量和对r过程至关重要的平均电子分数的影响 。",
            "id": "3484886",
            "problem": "给定代表数值相对论 (NR) 模拟的致密天体并合后抛出物中物质元的离散示踪粒子数据。在广义相对论 (GR) 中，一项常见任务是根据从静态时空中的基本守恒律推导出的两个判据——测地线判据和流体动力学伯努利判据——来确定流体元是否是引力非束缚的。从核天体物理学的角度来看，您必须估算这些不同的非束缚判据如何改变预测的非束缚质量以及与快中子俘获 (r-过程) 核合成相关的组分代理指标。\n\n基本原理：\n- 在具有类时基林矢量的静态时空中，四维速度的协变时间分量 $u_t$ 与测试粒子的单位静止质量守恒能量相关。对于弹道（无压）运动，如果一个物质元在无穷远处的比能超过1（在光速 $c$ 等于 $1$ 的单位制下），则该物质元是非束缚的，这产生了测地线非束缚条件 $u_t < -1$。\n- 对于压强和内能不可忽略的绝热相对论性流体，相对论性伯努利常数意味着 $h u_t$ 的近似守恒，其中 $h$ 是比焓。在这种情况下，如果 $h u_t < -1$，则认为流体元是非束缚的。\n- 比焓定义为 $h = 1 + \\epsilon + p/\\rho$，其中 $\\epsilon$ 是比内能，$p$ 是压强，$\\rho$ 是静止质量密度。所有量均在 $c=G=1$ 的相对论单位制下测量。\n\n定义和任务：\n- 对于每个示踪粒子 $i$，给定元组 $(m_i, u_{t,i}, \\epsilon_i, p_i, \\rho_i, Y_{e,i})$，其中 $m_i$ 是以太阳质量为单位的静止质量权重，$u_{t,i}$ 是四维速度的协变时间分量，$\\epsilon_i$ 是比内能，$p_i$ 是压强，$\\rho_i$ 是静止质量密度，$Y_{e,i}$ 是电子分数。比焓为 $h_i = 1 + \\epsilon_i + p_i/\\rho_i$。\n- 必须为每个示踪粒子计算两个非束缚标志：\n  - 测地线判据：$u_{t,i} < -1$。\n  - 伯努利判据：$h_i u_{t,i} < -1$。\n  不等式是严格的；如果等式成立，则将示踪粒子视为束缚的。\n- 对于每个判据 $C \\in \\{\\mathrm{geodesic}, \\mathrm{Bernoulli}\\}$，计算：\n  1. 总非束缚质量 $M^{(C)}_{\\mathrm{unb}} = \\sum_{i \\in U_C} m_i$，单位为太阳质量，其中 $U_C$ 是根据判据 $C$ 标记为非束缚的索引集合。\n  2. 质量加权平均电子分数 $\\langle Y_e \\rangle^{(C)} = \\left(\\sum_{i \\in U_C} m_i Y_{e,i}\\right) \\Big/ \\left(\\sum_{i \\in U_C} m_i\\right)$。如果 $\\sum_{i \\in U_C} m_i = 0$，则定义 $\\langle Y_e \\rangle^{(C)} = 0$。\n  3. 产生镧系元素的质量分数代理指标 $f_{\\mathrm{lan}}^{(C)}$，定义为 $M^{(C)}_{\\mathrm{unb}}$ 中满足 $Y_{e,i} < Y_e^{\\mathrm{lan}}$ (其中 $Y_e^{\\mathrm{lan}} = 0.25$) 的质量分数。如果 $\\sum_{i \\in U_C} m_i = 0$，则定义 $f_{\\mathrm{lan}}^{(C)} = 0$。\n- 同时计算质量差 $\\Delta M = M^{(\\mathrm{Bernoulli})}_{\\mathrm{unb}} - M^{(\\mathrm{geodesic})}_{\\mathrm{unb}}$。\n\n物理单位和数值约定：\n- 所有质量必须以太阳质量 $M_\\odot$ 表示。\n- 使用 $c=G=1$ 的自然单位制。\n- 数值输出必须四舍五入到六位小数。\n\n测试套件：\n- 对于下面的每个数据集，示踪粒子列表是一个形如 $(m_i, u_{t,i}, \\epsilon_i, p_i, \\rho_i, Y_{e,i})$ 的元组列表。所有数字都采用 LaTeX 格式。您的程序必须独立为每个数据集计算各项指标。\n\n数据集 A (理想情况，两种判据结果不同)：\n- 示踪粒子：\n  - $(2\\times 10^{-5}, -0.95, 0.6, 0.3, 1.0, 0.20)$\n  - $(1\\times 10^{-5}, -1.02, 0.1, 0.05, 1.0, 0.30)$\n  - $(5\\times 10^{-6}, -0.99, 0.8, 0.4, 1.0, 0.18)$\n  - $(3\\times 10^{-5}, -1.10, 0.0, 0.0, 1.0, 0.27)$\n  - $(8\\times 10^{-6}, -0.92, 0.2, 0.1, 1.0, 0.40)$\n  - $(1.5\\times 10^{-5}, -0.88, 0.05, 0.05, 1.0, 0.50)$\n  - $(4\\times 10^{-6}, -1.005, 0.3, 0.2, 1.0, 0.22)$\n  - $(6\\times 10^{-6}, -0.97, 0.6, 0.5, 1.0, 0.24)$\n\n数据集 B (边界和近边界行为)：\n- 示踪粒子：\n  - $(1\\times 10^{-5}, -1.0, 0.0, 0.0, 1.0, 0.25)$\n  - $(1.5\\times 10^{-5}, -0.909, 0.05, 0.05, 1.0, 0.24)$\n  - $(2\\times 10^{-5}, -1.001, 0.0, 0.0, 1.0, 0.30)$\n  - $(8\\times 10^{-6}, -0.95, 0.7, 0.3, 1.0, 0.10)$\n  - $(5\\times 10^{-6}, -0.85, 0.2, 0.1, 1.0, 0.35)$\n  - $(4\\times 10^{-6}, -0.8, 0.0, 0.0, 1.0, 0.50)$\n\n数据集 C (没有非束缚抛出物的边缘情况)：\n- 示踪粒子：\n  - $(1\\times 10^{-5}, -0.95, 0.02, 0.01, 1.0, 0.20)$\n  - $(2\\times 10^{-5}, -0.97, 0.0, 0.0, 1.0, 0.28)$\n  - $(1.2\\times 10^{-5}, -0.92, 0.03, 0.02, 1.0, 0.22)$\n  - $(8\\times 10^{-6}, -0.88, 0.10, 0.0, 1.0, 0.40)$\n  - $(5\\times 10^{-6}, -0.80, 0.0, 0.0, 1.0, 0.18)$\n\n必需的最终输出格式：\n- 对于每个数据集，生成一个列表 $[M^{(\\mathrm{geod})}_{\\mathrm{unb}}, M^{(\\mathrm{bern})}_{\\mathrm{unb}}, \\Delta M, \\langle Y_e \\rangle^{(\\mathrm{geod})}, \\langle Y_e \\rangle^{(\\mathrm{bern})}, f_{\\mathrm{lan}}^{(\\mathrm{geod})}, f_{\\mathrm{lan}}^{(\\mathrm{bern})}]$，其中所有浮点数都四舍五入到六位小数。\n- 您的程序应生成单行输出，其中包含所有数据集的结果，格式为一个由逗号分隔的、包含在方括号中的各数据集列表，例如：$[[\\dots],[\\dots],[\\dots]]$。",
            "solution": "所述问题在科学上是合理的、内容自洽且定义明确。它提出了数值相对论和相对论天体物理学领域的一项标准分析任务，具体涉及致密双星并合抛出物性质的分析。其物理原理、定义和计算任务清晰，并基于已有文献。因此，我们可以着手解决。\n\n问题的核心是区分用于识别引力非束缚物质的两种判据，并量化这一选择对与 r-过程核合成相关的天体物理可观测量的影响。这些判据源于广义相对论中的基本守恒律。\n\n首先，我们建立理论基础。在静态时空中（这是对并合后晚期环境的一个合理近似），存在一个类时基林矢量场，通常表示为 $\\xi^{\\mu}$。在远离中心天体的标准坐标系中，此矢量为 $\\xi^{\\mu} = (1, 0, 0, 0)$。粒子或流体元的四维动量为 $p^{\\mu} = m_0 u^{\\mu}$，其中 $m_0$ 是静止质量，$u^{\\mu}$ 是四维速度。量 $E = -p_{\\mu}\\xi^{\\mu}$ 沿着测试粒子的世界线是守恒的。因此，比能（单位静止质量的能量）为 $e = -u_{\\mu}\\xi^{\\mu}$。在我们选择的坐标系中，这简化为 $e = -u_t$，其中 $u_t$ 是四维速度的协变时间分量。为了让一个粒子能够逃逸到无穷远并具有非负动能，其比能必须大于1（在 $c=1$ 的单位制下）。这导致了条件 $e > 1$，或 $-u_t > 1$，这等价于**测地线非束缚判据**：\n$$\nu_t  -1\n$$\n该判据适用于“测试粒子”或“弹道”抛出物，其中压强和热能可以忽略不计。\n\n然而，从并合事件中抛出的物质是高温、高密度的流体。总能量包括静止质量、内能（热能）以及压强力所做功的贡献。对于绝热相对论性流体，从相对论性欧拉方程推导出的一个更普适的守恒量与相对论性伯努利方程有关。这个沿着流体流线近似守恒的量是 $h u_t$，其中 $h$ 是比焓。比焓定义为：\n$$\nh = 1 + \\epsilon + \\frac{p}{\\rho}\n$$\n这里，$\\epsilon$ 是比内能，$p$ 是流体压强，$\\rho$ 是静止质量密度。$\\epsilon$ 项代表热能，$p/\\rho$ 项代表压强的“势能”。要使流体元非束缚，其包含这些贡献的总比能必须在无穷远处超过1。这给出了**流体动力学或伯努利非束缚判据**：\n$$\nh u_t  -1\n$$\n由于 $\\epsilon$、$p$ 和 $\\rho$ 都是非负的，比焓 $h \\ge 1$。因此，如果一个流体元根据测地线判据是非束缚的（$u_t  -1$），那么它根据伯努利判据也必然是非束缚的（$h u_t \\le u_t  -1$）。反之则不然；一个流体元可以是测地线束缚的（$u_t \\ge -1$），但拥有足够的热能和压强能，从而通过伯努利判据变为非束缚。这就是我们预期 $M^{(\\mathrm{Bernoulli})}_{\\mathrm{unb}} \\ge M^{(\\mathrm{geodesic})}_{\\mathrm{unb}}$ 的原因。\n\n该问题要求我们为一组给定的示踪粒子计算几个量，每个示踪粒子代表一个质量为 $m_i$ 的流体元。对于每个判据 $C \\in \\{\\mathrm{geodesic}, \\mathrm{Bernoulli}\\}$，我们必须计算：\n1. 总非束缚质量，$M^{(C)}_{\\mathrm{unb}} = \\sum_{i \\in U_C} m_i$，其中 $U_C$ 是满足判据 $C$ 的示踪粒子的集合。\n2. 质量加权平均电子分数 $\\langle Y_e \\rangle^{(C)}$，它是最终核合成丰度模式的一个代理指标。其计算公式为 $\\langle Y_e \\rangle^{(C)} = (\\sum_{i \\in U_C} m_i Y_{e,i}) / M^{(C)}_{\\mathrm{unb}}$。\n3. 产生镧系元素的物质的质量分数代理指标 $f_{\\mathrm{lan}}^{(C)}$。这是非束缚质量中电子分数 $Y_{e,i}$ 低于阈值 $Y_e^{\\mathrm{lan}} = 0.25$ 的部分所占的比例，因为需要非常富中子的条件（$Y_e  0.25$）来产生最重的 r-过程元素（镧系元素和锕系元素）。其计算公式为 $f_{\\mathrm{lan}}^{(C)} = (\\sum_{i \\in U_C, Y_{e,i}  Y_e^{\\mathrm{lan}}} m_i) / M^{(C)}_{\\mathrm{unb}}$。\n\n计算步骤如下：\n1. 对每个数据集，为测地线判据和伯努利判据分别初始化总非束缚质量、质量加权 $Y_e$ 分子项和产生镧系元素的质量的累加器。所有累加器均初始化为 0。\n2. 遍历每个示踪粒子 $i$ 及其属性 $(m_i, u_{t,i}, \\epsilon_i, p_i, \\rho_i, Y_{e,i})$。\n3. 对每个示踪粒子，评估两个非束缚判据。问题指定了严格不等式。\n    a. **测地线判据**：检查是否 $u_{t,i}  -1$。如果为真，则该示踪粒子是测地线非束缚的。\n    b. **伯努利判据**：首先计算比焓 $h_i = 1 + \\epsilon_i + p_i/\\rho_i$。然后，检查是否 $h_i u_{t,i}  -1$。如果为真，则该示踪粒子根据伯努利判据是非束缚的。\n4. 如果发现一个示踪粒子根据测地线判据是非束缚的，则将其质量 $m_i$ 加到 $M^{(\\mathrm{geodesic})}_{\\mathrm{unb}}$ 上，将乘积 $m_i Y_{e,i}$ 加到相应的 $Y_e$ 分子项上，并且如果 $Y_{e,i}  0.25$，则将其质量 $m_i$ 也加到测地线判据的镧系元素质量累加器上。\n5. 对伯努利判据独立地遵循相同的步骤。\n6. 在处理完一个数据集中的所有示踪粒子后，计算最终的量。对于每个判据 $C$：\n    a. 如果 $M^{(C)}_{\\mathrm{unb}} > 0$，则通过将累加和除以 $M^{(C)}_{\\mathrm{unb}}$ 来计算 $\\langle Y_e \\rangle^{(C)}$ 和 $f_{\\mathrm{lan}}^{(C)}$。\n    b. 如果 $M^{(C)}_{\\mathrm{unb}} = 0$，则 $\\langle Y_e \\rangle^{(C)}$ 和 $f_{\\mathrm{lan}}^{(C)}$ 都定义为 0。\n7. 计算非束缚质量之差：$\\Delta M = M^{(\\mathrm{Bernoulli})}_{\\mathrm{unb}} - M^{(\\mathrm{geodesic})}_{\\mathrm{unb}}$。\n8. 收集七个值（$M^{(\\mathrm{geod})}_{\\mathrm{unb}}, M^{(\\mathrm{bern})}_{\\mathrm{unb}}, \\Delta M, \\langle Y_e \\rangle^{(\\mathrm{geod})}, \\langle Y_e \\rangle^{(\\mathrm{bern})}, f_{\\mathrm{lan}}^{(\\mathrm{geod})}, f_{\\mathrm{lan}}^{(\\mathrm{bern})}$），将每个值四舍五入到六位小数，并按要求格式化。对所有提供的数据集重复此过程。",
            "answer": "```python\nimport numpy as np\n# from scipy import ... # Not required for this problem.\n\ndef solve():\n    \"\"\"\n    Processes tracer data from numerical relativity simulations to\n    calculate unbound mass and composition proxies based on two\n    different unboundness criteria.\n    \"\"\"\n    datasets = [\n        # Dataset A\n        [\n            (2e-5, -0.95, 0.6, 0.3, 1.0, 0.20),\n            (1e-5, -1.02, 0.1, 0.05, 1.0, 0.30),\n            (5e-6, -0.99, 0.8, 0.4, 1.0, 0.18),\n            (3e-5, -1.10, 0.0, 0.0, 1.0, 0.27),\n            (8e-6, -0.92, 0.2, 0.1, 1.0, 0.40),\n            (1.5e-5, -0.88, 0.05, 0.05, 1.0, 0.50),\n            (4e-6, -1.005, 0.3, 0.2, 1.0, 0.22),\n            (6e-6, -0.97, 0.6, 0.5, 1.0, 0.24),\n        ],\n        # Dataset B\n        [\n            (1e-5, -1.0, 0.0, 0.0, 1.0, 0.25),\n            (1.5e-5, -0.909, 0.05, 0.05, 1.0, 0.24),\n            (2e-5, -1.001, 0.0, 0.0, 1.0, 0.30),\n            (8e-6, -0.95, 0.7, 0.3, 1.0, 0.10),\n            (5e-6, -0.85, 0.2, 0.1, 1.0, 0.35),\n            (4e-6, -0.8, 0.0, 0.0, 1.0, 0.50),\n        ],\n        # Dataset C\n        [\n            (1e-5, -0.95, 0.02, 0.01, 1.0, 0.20),\n            (2e-5, -0.97, 0.0, 0.0, 1.0, 0.28),\n            (1.2e-5, -0.92, 0.03, 0.02, 1.0, 0.22),\n            (8e-6, -0.88, 0.10, 0.0, 1.0, 0.40),\n            (5e-6, -0.80, 0.0, 0.0, 1.0, 0.18),\n        ],\n    ]\n\n    Y_e_lan_threshold = 0.25\n    all_results = []\n\n    for tracers in datasets:\n        # Initialize accumulators for geodesic criterion\n        m_unb_geod = 0.0\n        m_ye_num_geod = 0.0\n        m_lan_geod = 0.0\n\n        # Initialize accumulators for Bernoulli criterion\n        m_unb_bern = 0.0\n        m_ye_num_bern = 0.0\n        m_lan_bern = 0.0\n\n        for m_i, u_t_i, eps_i, p_i, rho_i, Ye_i in tracers:\n            # Geodesic unbound criterion: u_t  -1\n            if u_t_i  -1.0:\n                m_unb_geod += m_i\n                m_ye_num_geod += m_i * Ye_i\n                if Ye_i  Y_e_lan_threshold:\n                    m_lan_geod += m_i\n\n            # Bernoulli unbound criterion: h * u_t  -1\n            h_i = 1.0 + eps_i + p_i / rho_i\n            if h_i * u_t_i  -1.0:\n                m_unb_bern += m_i\n                m_ye_num_bern += m_i * Ye_i\n                if Ye_i  Y_e_lan_threshold:\n                    m_lan_bern += m_i\n\n        # --- Final calculations for the dataset ---\n\n        # Geodesic metrics\n        if m_unb_geod > 0:\n            avg_Ye_geod = m_ye_num_geod / m_unb_geod\n            f_lan_geod = m_lan_geod / m_unb_geod\n        else:\n            avg_Ye_geod = 0.0\n            f_lan_geod = 0.0\n\n        # Bernoulli metrics\n        if m_unb_bern > 0:\n            avg_Ye_bern = m_ye_num_bern / m_unb_bern\n            f_lan_bern = m_lan_bern / m_unb_bern\n        else:\n            avg_Ye_bern = 0.0\n            f_lan_bern = 0.0\n        \n        # Mass difference\n        delta_M = m_unb_bern - m_unb_geod\n\n        dataset_results = [\n            m_unb_geod,\n            m_unb_bern,\n            delta_M,\n            avg_Ye_geod,\n            avg_Ye_bern,\n            f_lan_geod,\n            f_lan_bern,\n        ]\n        all_results.append(dataset_results)\n\n    # Format the final output string according to the specification\n    formatted_dataset_strings = []\n    for res_list in all_results:\n        # Format each number to 6 decimal places as a fixed-point string\n        formatted_numbers = [f\"{num:.6f}\" for num in res_list]\n        formatted_dataset_strings.append(f\"[{','.join(formatted_numbers)}]\")\n    \n    final_output_string = f\"[{','.join(formatted_dataset_strings)}]\"\n    print(final_output_string)\n\nsolve()\n```"
        },
        {
            "introduction": "在识别出非束缚物质后，下一个关键步骤是理解其物理来源，因为不同的抛射机制会产生具有不同热力学性质和核合成产物的物质流。并合事件中的抛射物通常分为两大类：“潮汐抛射物”（通常较冷、低熵且集中在赤道面）和“激波驱动抛射物”（经过激波加热，因而更热、高熵且分布更广）。本练习要求你基于示踪粒子的热力学和几何属性，实现一个分类算法来区分这两种成分，并进一步根据它们的平均电子分数 $\\langle Y_e \\rangle$ 将它们与不同的r过程丰度模式联系起来 。",
            "id": "3484926",
            "problem": "给定来自三个独立的、具有指定质量比的双中子星并合数值相对论（NR）模拟的理想化示踪粒子摘要。您的任务是设计并实现一个有原则的算法，使用示踪粒子属性将抛射物分为潮汐剥离和激波驱动两部分，然后使用基于电子分数的物理动机诊断方法，将每个通道映射到一个独特的快中子俘获（r-过程）丰度模式类别。该情景设定在数值相对论和引力波天体物理学的框架内，重点关注并合动力学和质量比如何影响抛射物质的热力学条件，从而影响r-过程的产额。\n\n使用的基本依据和约束条件：\n- 穿过间断面的流体激波遵循质量、动量和能量守恒，并产生不可逆的熵增。因此，经过激波处理的物质往往比潮汐剥离的物质具有更高的熵。设每个粒子的比熵为 $s$，单位为每个重子的 Boltzmann constant。\n- 潮汐抛射物主要由于引力和离心力从赤道面发射，通常温度更低、熵更低，而激波驱动的抛射物可以更强烈地朝向极向出现，并由于激波加热而经历更高的峰值温度。设抛射的极角为 $\\theta$，单位为弧度，其中北极为 $\\theta = 0$，南极为 $\\theta = \\pi$，赤道面在 $\\theta = \\pi/2$。\n- 电子分数 $Y_e$ 在电中性条件下决定了质子分数，从而决定了可用于快中子俘获的中子-种子核比率。达到第三峰的重r-过程需要足够富中子的成分，这在低 $Y_e$ 时可以实现。使用此原理，为每个抛射物通道定义一个基于质量加权平均 $Y_e$ 的分类映射。\n- 假设所提供的示踪粒子集代表非束缚抛射物（因此不需要进行束缚/非束缚的筛选）。每个示踪粒子具有以下属性：质量 $m$（单位为太阳质量 $M_\\odot$）、电子分数 $Y_e$（无量纲）、比熵 $s$（单位为每个重子 $k_B$）、峰值温度 $T_{\\mathrm{peak}}$（单位为吉咖开尔文）、极角 $\\theta$（单位为弧度）和渐近速度 $v$（单位为千米/秒）。角度必须使用弧度。\n\n从第一性原理实现的分类规则：\n- 如果一个示踪粒子满足以下任一条件，反映了激波加热和/或极向出现，则将其分类为激波驱动：\n  1. $s \\ge s_{\\mathrm{thr}}$，其中 $s_{\\mathrm{thr}} = 12$。\n  2. $T_{\\mathrm{peak}} \\ge T_{\\mathrm{thr}}$，其中 $T_{\\mathrm{thr}} = 5$（单位为吉咖开尔文）。\n  3. 示踪粒子在极冠内出现：$\\min(\\theta, |\\pi - \\theta|) \\le \\theta_{\\mathrm{polar}}$，其中 $\\theta_{\\mathrm{polar}} = 0.35$（弧度）。\n- 否则，将示踪粒子分类为潮汐剥离。\n\n使用 $Y_e$ 进行r-过程丰度模式映射：\n- 对于每个通道（潮汐或激波），根据该通道中的示踪粒子计算质量加权平均电子分数 $\\langle Y_e \\rangle$。定义三个离散的丰度模式类别：\n  - 重r-过程（稳健，能达到第三峰）：如果 $\\langle Y_e \\rangle  0.25$，编码为整数 $2$。\n  - 弱r-过程（达到第二峰）：如果 $0.25 \\le \\langle Y_e \\rangle  0.35$，编码为整数 $1$。\n  - 可忽略的重r-过程（仅轻的超铁元素）：如果 $\\langle Y_e \\rangle \\ge 0.35$，编码为整数 $0$。\n- 如果一个通道包含的质量为零，则将类别编码为整数 $-1$。\n\n每个测试用例要产生的输出：\n- 潮汐剥离抛射物的质量分数 $f_{\\mathrm{tidal}} = M_{\\mathrm{tidal}} / M_{\\mathrm{tot}}$ 和激波驱动抛射物的质量分数 $f_{\\mathrm{shock}} = M_{\\mathrm{shock}} / M_{\\mathrm{tot}}$，其中 $M_{\\mathrm{tot}} = M_{\\mathrm{tidal}} + M_{\\mathrm{shock}}$。\n- 潮汐通道 $C_{\\mathrm{tidal}}$ 和激波通道 $C_{\\mathrm{shock}}$ 的丰度类别代码，如上定义。\n- 将 $f_{\\mathrm{tidal}}$ 和 $f_{\\mathrm{shock}}$ 表示为四舍五入到六位小数的小数。类别代码是整数。角度必须以弧度解释。最终列表不需要输出单位，因为分数和代码都是无量纲的。\n\n测试套件：\n提供以下三个测试用例，每个用例包含一个质量比 $q$ 和一个示踪粒子的明确列表。您的程序必须仅使用示踪粒子属性和上述规则；$q$ 仅为上下文提供，不应直接用于计算。所有角度 $\\theta$ 以弧度为单位；所有温度 $T_{\\mathrm{peak}}$ 以吉咖开尔文为单位；速度 $v$ 以千米/秒为单位；质量 $m$ 以太阳质量 $M_\\odot$ 为单位。\n\n- 测试用例 $1$，质量比 $q = 1.0$：\n  示踪粒子 $\\{(m, Y_e, s, T_{\\mathrm{peak}}, \\theta, v)\\}$：\n  1. $(6\\times 10^{-5}, 0.32, 22, 7.0, 0.25, 15000)$\n  2. $(4\\times 10^{-5}, 0.30, 18, 6.0, 0.40, 14000)$\n  3. $(5\\times 10^{-5}, 0.36, 25, 8.0, 2.90, 16000)$\n  4. $(3\\times 10^{-5}, 0.28, 15, 5.5, 0.50, 13500)$\n  5. $(2\\times 10^{-5}, 0.40, 20, 6.5, 3.00, 17000)$\n  6. $(2\\times 10^{-5}, 0.18, 8, 3.5, 1.50, 9000)$\n  7. $(3\\times 10^{-5}, 0.22, 10, 4.0, 1.60, 9500)$\n  8. $(1.5\\times 10^{-5}, 0.20, 9, 3.8, 1.70, 9200)$\n  9. $(1.2\\times 10^{-5}, 0.15, 7, 3.2, 1.55, 8800)$\n  10. $(1.0\\times 10^{-5}, 0.24, 11, 4.2, 1.57, 9100)$\n\n- 测试用例 $2$，质量比 $q = 0.85$：\n  示踪粒子：\n  1. $(2.5\\times 10^{-5}, 0.33, 19, 6.2, 0.30, 14500)$\n  2. $(1.8\\times 10^{-5}, 0.31, 16, 5.4, 2.95, 15000)$\n  3. $(3.0\\times 10^{-5}, 0.21, 9, 3.6, 1.45, 9400)$\n  4. $(2.2\\times 10^{-5}, 0.17, 7, 3.2, 1.60, 8700)$\n  5. $(2.8\\times 10^{-5}, 0.23, 10, 4.0, 1.70, 9600)$\n  6. $(2.0\\times 10^{-5}, 0.19, 8, 3.7, 1.55, 9300)$\n  7. $(1.6\\times 10^{-5}, 0.27, 11, 4.5, 1.60, 9800)$\n  8. $(1.2\\times 10^{-5}, 0.20, 9, 3.9, 1.50, 9100)$\n  9. $(0.9\\times 10^{-5}, 0.22, 10, 4.1, 1.58, 9000)$\n\n- 测试用例 $3$，质量比 $q = 0.60$：\n  示踪粒子：\n  1. $(0.7\\times 10^{-5}, 0.34, 18, 5.2, 0.20, 15500)$\n  2. $(4.0\\times 10^{-5}, 0.12, 6, 3.0, 1.60, 8800)$\n  3. $(3.5\\times 10^{-5}, 0.20, 9, 3.8, 1.50, 9200)$\n  4. $(2.8\\times 10^{-5}, 0.25, 10, 4.1, 1.57, 9400)$\n  5. $(2.2\\times 10^{-5}, 0.18, 8, 3.6, 1.45, 9000)$\n  6. $(1.5\\times 10^{-5}, 0.10, 5, 2.8, 1.70, 8500)$\n\n要求的最终输出格式：\n- 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表。对于每个测试用例，按顺序附加四个值 $[f_{\\mathrm{tidal}}, f_{\\mathrm{shock}}, C_{\\mathrm{tidal}}, C_{\\mathrm{shock}}]$，分数使用六位小数四舍五入，代码使用整数，以便最终输出将所有测试用例聚合到一个扁平列表中（对于三个测试用例，总共有 $12$ 个值）。",
            "solution": "该问题要求开发一个有原则的算法，来分析来自双中子星并合数值相对论模拟的示踪粒子数据。目标是将抛射物划分为两个不同的形成通道——潮汐剥离和激波驱动——并随后对每个通道的核合成产物进行分类。此分析将对提供的三个测试用例进行，每个用例代表一个不同质量比的并合事件。整个过程必须基于流体动力学和核天体物理学的基本物理原理，并由一组明确的规则加以规定。\n\n该算法方法分为三个主要阶段，这些阶段将物理原理直接映射到计算步骤上。\n\n1.  **抛射物通道分类：**第一阶段涉及将每个示踪粒子分类为潮汐抛射物或激波驱动抛射物的一部分。这种区分的物理动机在于将物质从系统中解绑的不同机制。\n    -   **潮汐抛射物：**在旋近晚期和并合过程中，引力潮汐力可以从中子星外层剥离物质。这些物质通常被甩到赤道平面上，并且因为它没有经历强烈的激波压缩，所以它保持相对冷却且比熵较低。\n    -   **激波驱动抛射物：**在碰撞点或并合后遗迹中，会形成强烈的流体动力学激波。穿过这些激波的物质被加热到高温，导致其比熵（用 $s$ 表示）发生不可逆的增加。这种热的、高熵的物质通常以双极、偏离赤道的方向被抛射出去。\n\n    基于这些原理，我们建立了一套定量标准。一个具有属性（$m_i$，$Y_{e,i}$，$s_i$，$T_{\\mathrm{peak},i}$，$\\theta_i$，$v_i$）的示踪粒子如果满足以下任一条件，就会被分类为**激波驱动**，这些条件是其经历过显著激波加热或沿极向轨迹抛射的代理指标：\n    1.  比熵 $s_i$ 大于或等于阈值 $s_{\\mathrm{thr}} = 12$ $k_B$ 每重子。\n    2.  流体元经历的峰值温度 $T_{\\mathrm{peak},i}$ 大于或等于阈值 $T_{\\mathrm{thr}} = 5$ 吉咖开尔文。\n    3.  抛射角 $\\theta_i$ 在一个指定的极向锥内。条件为 $\\min(\\theta_i, |\\pi - \\theta_i|) \\le \\theta_{\\mathrm{polar}}$，其中极向角截断值为 $\\theta_{\\mathrm{polar}} = 0.35$ 弧度。这等同于在北极附近（$\\theta_i \\le \\theta_{\\mathrm{polar}}$）或南极附近（$\\theta_i \\ge \\pi - \\theta_{\\mathrm{polar}}$）被抛射。\n\n    任何不满足这些条件的示踪粒子，通过排除法，被分类为**潮汐剥离**。这个过程将完整的示踪粒子集划分为两个不相交的子集 $S_{\\mathrm{tidal}}$ 和 $S_{\\mathrm{shock}}$。\n\n2.  **质量分数计算：**一旦所有示踪粒子被分类，下一步是计算与每个通道相关的总质量及其相对于总抛射物质量的各自质量分数。\n    -   潮汐抛射物的总质量为 $M_{\\mathrm{tidal}} = \\sum_{i \\in S_{\\mathrm{tidal}}} m_i$。\n    -   激波驱动抛射物的总质量为 $M_{\\mathrm{shock}} = \\sum_{i \\in S_{\\mathrm{shock}}} m_i$。\n    -   总抛射物质量为 $M_{\\mathrm{tot}} = M_{\\mathrm{tidal}} + M_{\\mathrm{shock}}$。\n    -   相应的质量分数为 $f_{\\mathrm{tidal}} = M_{\\mathrm{tidal}} / M_{\\mathrm{tot}}$ 和 $f_{\\mathrm{shock}} = M_{\\mathrm{shock}} / M_{\\mathrm{tot}}$。根据定义，$f_{\\mathrm{tidal}} + f_{\\mathrm{shock}} = 1$。\n\n3.  **r-过程丰度模式映射：**最后阶段将抛射物的热力学历史与其预期的核合成产额联系起来。控制快中子俘获过程（r-过程）结果的关键参数是电子分数 $Y_e$，即每个重子的质子数。在电中性的富中子物质中，低的 $Y_e$ 意味着高的中子-质子比，这对于合成最重的r-过程元素直到第三峰（例如金、铂）至关重要。\n    -   我们为每个通道计算质量加权平均电子分数：\n        $$ \\langle Y_e \\rangle_{\\mathrm{channel}} = \\frac{\\sum_{i \\in S_{\\mathrm{channel}}} m_i Y_{e,i}}{\\sum_{i \\in S_{\\mathrm{channel}}} m_i} $$\n    -   基于这个单一的诊断量，我们将每个通道映射到三个r-过程类别之一，并分配整数代码。这些阈值是基于物理动机的：\n        -   **重r-过程（代码 $2$）：**如果 $\\langle Y_e \\rangle  0.25$。这种富中子条件能稳健地产生所有r-过程元素，直至第三峰。\n        -   **弱r-过程（代码 $1$）：**如果 $0.25 \\le \\langle Y_e \\rangle  0.35$。这些中子丰度较低的条件通常能产生直至第二r-过程峰的元素，但无法大量产生最重的元素。\n        -   **可忽略的重r-过程（代码 $0$）：**如果 $\\langle Y_e \\rangle \\ge 0.35$。在这种富质子物质中，r-过程被抑制，只能合成较轻的超铁元素。\n    -   如果一个通道包含的质量为零，即 $M_{\\mathrm{tidal}} = 0$ 或 $M_{\\mathrm{shock}} = 0$，则分配一个特殊代码 $-1$。\n\n该算法包括对每个测试用例依次应用这三个步骤。对于每个用例，我们遍历其示踪粒子列表，进行分类，计算总质量和质量分数，计算潮汐和激波子集的质量加权平均电子分数，最后确定整数类别代码。每个测试用例所需的输出是一个元组（$f_{\\mathrm{tidal}}$，$f_{\\mathrm{shock}}$，$C_{\\mathrm{tidal}}$，$C_{\\mathrm{shock}}$），其中分数四舍五入到六位小数。最终结果是将所有测试用例的这些元组聚合到一个扁平列表中。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of classifying ejecta and mapping r-process patterns\n    for given tracer particle data from binary neutron star merger simulations.\n    \"\"\"\n    \n    # Fundamental constant and thresholds from the problem statement\n    s_thr = 12.0  # k_B per baryon\n    T_thr = 5.0   # Giga-Kelvin\n    theta_polar = 0.35  # radians\n\n    # Test suite data: Each case is a list of tuples, where each tuple represents\n    # a tracer particle: (m, Y_e, s, T_peak, theta, v)\n    test_cases = [\n        # Test case 1, q = 1.0\n        [\n            (6e-5, 0.32, 22, 7.0, 0.25, 15000),\n            (4e-5, 0.30, 18, 6.0, 0.40, 14000),\n            (5e-5, 0.36, 25, 8.0, 2.90, 16000),\n            (3e-5, 0.28, 15, 5.5, 0.50, 13500),\n            (2e-5, 0.40, 20, 6.5, 3.00, 17000),\n            (2e-5, 0.18, 8, 3.5, 1.50, 9000),\n            (3e-5, 0.22, 10, 4.0, 1.60, 9500),\n            (1.5e-5, 0.20, 9, 3.8, 1.70, 9200),\n            (1.2e-5, 0.15, 7, 3.2, 1.55, 8800),\n            (1.0e-5, 0.24, 11, 4.2, 1.57, 9100)\n        ],\n        # Test case 2, q = 0.85\n        [\n            (2.5e-5, 0.33, 19, 6.2, 0.30, 14500),\n            (1.8e-5, 0.31, 16, 5.4, 2.95, 15000),\n            (3.0e-5, 0.21, 9, 3.6, 1.45, 9400),\n            (2.2e-5, 0.17, 7, 3.2, 1.60, 8700),\n            (2.8e-5, 0.23, 10, 4.0, 1.70, 9600),\n            (2.0e-5, 0.19, 8, 3.7, 1.55, 9300),\n            (1.6e-5, 0.27, 11, 4.5, 1.60, 9800),\n            (1.2e-5, 0.20, 9, 3.9, 1.50, 9100),\n            (0.9e-5, 0.22, 10, 4.1, 1.58, 9000)\n        ],\n        # Test case 3, q = 0.60\n        [\n            (0.7e-5, 0.34, 18, 5.2, 0.20, 15500),\n            (4.0e-5, 0.12, 6, 3.0, 1.60, 8800),\n            (3.5e-5, 0.20, 9, 3.8, 1.50, 9200),\n            (2.8e-5, 0.25, 10, 4.1, 1.57, 9400),\n            (2.2e-5, 0.18, 8, 3.6, 1.45, 9000),\n            (1.5e-5, 0.10, 5, 2.8, 1.70, 8500)\n        ]\n    ]\n\n    final_results = []\n    \n    for case_tracers in test_cases:\n        tidal_tracers = []\n        shock_tracers = []\n\n        # Step 1: Classify each tracer\n        for tracer in case_tracers:\n            m, Ye, s, T_peak, theta, v = tracer\n            # Condition for being shock-driven\n            is_shock = (s >= s_thr) or \\\n                       (T_peak >= T_thr) or \\\n                       (min(theta, abs(np.pi - theta)) = theta_polar)\n            \n            if is_shock:\n                shock_tracers.append(tracer)\n            else:\n                tidal_tracers.append(tracer)\n        \n        # Step 2: Compute mass fractions\n        M_tidal = sum(t[0] for t in tidal_tracers)\n        M_shock = sum(t[0] for t in shock_tracers)\n        M_tot = M_tidal + M_shock\n\n        if M_tot > 0:\n            f_tidal = M_tidal / M_tot\n            f_shock = M_shock / M_tot\n        else: # Handle case with no tracers\n            f_tidal, f_shock = 0.0, 0.0\n\n        # Step 3: Determine R-process category codes\n        def get_category_code(tracers, total_mass):\n            if total_mass == 0:\n                return -1\n            \n            # Calculate mass-weighted mean electron fraction\n            sum_m_Ye = sum(t[0] * t[1] for t in tracers)\n            mean_Ye = sum_m_Ye / total_mass\n            \n            if mean_Ye  0.25:\n                return 2  # Heavy r-process\n            elif mean_Ye  0.35:\n                return 1  # Weak r-process\n            else:\n                return 0  # Negligible heavy r-process\n\n        C_tidal = get_category_code(tidal_tracers, M_tidal)\n        C_shock = get_category_code(shock_tracers, M_shock)\n        \n        # Append results for this case to the final list\n        final_results.extend([\n            round(f_tidal, 6),\n            round(f_shock, 6),\n            C_tidal,\n            C_shock\n        ])\n\n    # Print the final aggregated list in the required format\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "分析流程的最终目标是预测详细的核合成产额，这通常是通过追踪流体元的“示踪粒子”并后处理其记录的热力学历史来完成的。本练习将指导你构建一个简化的“单区”核合成模型，该模型是大型核反应网络计算的核心逻辑的缩影。你将利用示踪粒子的关键属性，如电子分数 $Y_e$、熵 $S$ 以及温度演化历史，通过一个简化的中子俘获定律来计算最终重元素的平均原子质量数，从而将宏观的流体动力学演化与微观的核物理过程直接联系起来 。",
            "id": "3484914",
            "problem": "给定一个简化的、基于第一性原理的并合后r-过程核合成模型，该模型追踪一次数值相对论(NR)模拟中单个示踪粒子的热力学历史。示踪粒子是一个拉格朗日流体元，它随流体被动平流，并记录其路径上的热力学量。在单区近似中，粒子的密度历史可以被建模为同源膨胀，其指数形式由体积元的连续性方程导出：如果特征膨胀时标为 $\\tau_{\\mathrm{exp}}$，则密度为 $\\rho(t) = \\rho_0 \\exp(-t / \\tau_{\\mathrm{exp}})$，其中 $\\rho_0$ 是初始密度。对于在辐射主导区域内、每重子熵 $S$（以玻尔兹曼常数 $k_B$ 为单位）恒定的绝热膨胀，温度的标度关系为 $T(t) \\propto \\rho(t)^{1/3}$，这意味着对于给定的初始温度 $T_0$，有 $T(t) = T_0 \\exp(-t / (3 \\tau_{\\mathrm{exp}}))$。\n\n假设r-过程可以近似为对预先存在的种子核的中子俘获。设 $Y_n(t)$ 为每重子中子数分数，$Y_s$ 为每重子种子核数分数。在这个玩具模型中，$Y_s$ 在中子俘获阶段被视为常数（带电粒子冻结已产生种子核），而 $Y_n(t)$ 根据质量作用俘获定律演化：\n$$\n\\frac{d Y_n}{d t} = - \\lambda(t) \\, Y_n(t) \\, Y_s,\n$$\n其中 $\\lambda(t)$ 是每个种子核的有效中子俘获率，假定其依赖于温度，形式如下\n$$\n\\lambda(t) = \\lambda_0 \\left(\\frac{T(t)}{T_0}\\right)^{\\nu}.\n$$\n假设 $\\nu = 1$（线性温度标度）。当温度降至阈值 $T_{\\mathrm{thr}}$ 以下时，俘获阶段在时间 $t_{\\mathrm{end}}$ 结束，定义为 $T(t_{\\mathrm{end}}) = T_{\\mathrm{thr}}$。如果 $T_{\\mathrm{thr}} \\ge T_0$，则 $t_{\\mathrm{end}} = 0$（不发生俘获）。\n\n初始的每重子种子核数分数参数化为\n$$\nY_s = k_{\\mathrm{seed}} \\, \\frac{\\max(0, \\, 0.5 - Y_e)}{S / S_0},\n$$\n其中 $Y_e$ 是示踪粒子的电子分数，$S$ 是以 $k_B$ 为单位的每重子熵，$S_0$ 是一个参考熵，$k_{\\mathrm{seed}}$ 是一个无量纲标度常数。该参数化反映了较高的熵会抑制种子核的形成，而较低的 $Y_e$（更富中子的物质）有利于种子核的形成。在带电粒子冻结后，可用于被种子核俘获的初始每重子中子数分数由重子份额近似得出\n$$\nY_{n,0} = \\max\\left(0, \\, 1 - Y_e - A_{\\mathrm{seed}} \\, Y_s\\right),\n$$\n其中 $A_{\\mathrm{seed}}$ 是种子核的平均质量数。俘获定律在 $t = 0$ 到 $t = t_{\\mathrm{end}}$ 的区间内给出一个解析解：\n$$\nY_n(t_{\\mathrm{end}}) = Y_{n,0} \\, \\exp\\left[- Y_s \\int_0^{t_{\\mathrm{end}}} \\lambda_0 \\exp\\left(-\\frac{t}{3 \\tau_{\\mathrm{exp}}}\\right) dt \\right],\n$$\n其中\n$$\nt_{\\mathrm{end}} = 3 \\, \\tau_{\\mathrm{exp}} \\, \\ln\\left(\\frac{T_0}{T_{\\mathrm{thr}}}\\right) \\quad \\text{for} \\quad T_{\\mathrm{thr}}  T_0,\n$$\n并且\n$$\n\\int_0^{t_{\\mathrm{end}}} \\lambda_0 \\exp\\left(-\\frac{t}{3 \\tau_{\\mathrm{exp}}}\\right) dt = \\lambda_0 \\, \\frac{1 - \\exp\\left(-\\frac{t_{\\mathrm{end}}}{3 \\tau_{\\mathrm{exp}}}\\right)}{1/(3 \\tau_{\\mathrm{exp}})}.\n$$\n最终的平均质量数通过将被俘获的中子分配到种子核上来估计：\n$$\nA_{\\mathrm{final}} = \n\\begin{cases}\nA_{\\mathrm{seed}} + \\dfrac{Y_{n,0} - Y_n(t_{\\mathrm{end}})}{Y_s},   \\text{if } Y_s > \\epsilon, \\\\\n0,   \\text{if } Y_s \\le \\epsilon,\n\\end{cases}\n$$\n其中 $\\epsilon$ 是一个很小的阈值，用于在实际没有种子核时避免除以零。为在没有完整的裂变循环网络的情况下保证物理合理性，将结果以 $A_{\\mathrm{cap}}$ 为上限：\n$$\nA_{\\mathrm{final}} \\leftarrow \\min\\left(A_{\\mathrm{final}}, A_{\\mathrm{cap}}\\right).\n$$\n该模型通过使用示踪粒子的 $(Y_e, S, \\rho(t), T(t))$ 历史来驱动一个简化的中子俘获计算，从而与数值相对论模拟中的示踪粒子方法相联系。\n\n你的任务是实现一个程序，为每个测试用例根据上述模型计算 $A_{\\mathrm{final}}$。对所有测试用例统一使用以下常量：\n- $S_0 = 10$ (参考熵，以 $k_B$ 为单位)，\n- $k_{\\mathrm{seed}} = 0.01$ (无量纲)，\n- $\\nu = 1$，\n- $\\epsilon = 10^{-12}$，\n- $A_{\\mathrm{cap}} = 250$。\n\n每个测试用例指定一个元组 $(Y_e, S, \\tau_{\\mathrm{exp}}, \\rho_0, T_0, T_{\\mathrm{thr}}, \\lambda_0, A_{\\mathrm{seed}})$，单位如下：\n- $Y_e$ 和 $S$ 是无量纲的（$S$ 以每重子 $k_B$ 为单位），\n- $\\tau_{\\mathrm{exp}}$ 单位为秒，\n- $\\rho_0$ 单位为 $\\mathrm{g\\,cm^{-3}}$ (通过指数定律隐式使用；在定义 $T(t)$ 的比率中被消去)，\n- $T_0$ 和 $T_{\\mathrm{thr}}$ 单位为吉开尔文（写作 $\\mathrm{GK}$），\n- $\\lambda_0$ 单位为 $\\mathrm{s^{-1}}$，\n- $A_{\\mathrm{seed}}$ 是无量纲的。\n\n请严格按照规定实现计算，包括上限，并为每个测试用例返回最终的平均质量数 $A_{\\mathrm{final}}$。测试套件包含以下五个用例：\n1. $(Y_e, S, \\tau_{\\mathrm{exp}}, \\rho_0, T_0, T_{\\mathrm{thr}}, \\lambda_0, A_{\\mathrm{seed}}) = (0.05, 10, 0.005, 10^{11}, 6, 1, 10000, 90)$,\n2. $(Y_e, S, \\tau_{\\mathrm{exp}}, \\rho_0, T_0, T_{\\mathrm{thr}}, \\lambda_0, A_{\\mathrm{seed}}) = (0.25, 30, 0.05, 10^{10}, 6, 1.5, 5000, 90)$,\n3. $(Y_e, S, \\tau_{\\mathrm{exp}}, \\rho_0, T_0, T_{\\mathrm{thr}}, \\lambda_0, A_{\\mathrm{seed}}) = (0.45, 20, 0.02, 5 \\times 10^{10}, 5, 1.2, 3000, 90)$,\n4. $(Y_e, S, \\tau_{\\mathrm{exp}}, \\rho_0, T_0, T_{\\mathrm{thr}}, \\lambda_0, A_{\\mathrm{seed}}) = (0.20, 100, 0.01, 10^{11}, 6, 1, 8000, 90)$,\n5. $(Y_e, S, \\tau_{\\mathrm{exp}}, \\rho_0, T_0, T_{\\mathrm{thr}}, \\lambda_0, A_{\\mathrm{seed}}) = (0.10, 20, 0.01, 10^{11}, 1, 1, 5000, 90)$.\n\n以上列出的所有数值输入均采用指定单位，且必须如此处理。每个测试用例的输出是一个代表 $A_{\\mathrm{final}}$ 的浮点数，该值无量纲。你的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表，每个浮点数四舍五入到三位小数，例如 $[90.000,140.123, \\dots]$。",
            "solution": "在尝试任何解决方案之前，该问题都经过了严格的验证过程。\n\n### 步骤1：提取已知条件\n\n提供的模型由以下方程和参数定义：\n\n**热力学演化：**\n- 密度：$\\rho(t) = \\rho_0 \\exp(-t / \\tau_{\\mathrm{exp}})$\n- 温度：$T(t) = T_0 \\exp(-t / (3 \\tau_{\\mathrm{exp}}))$\n\n**中子俘获动力学：**\n- 中子数分数的变化率：$\\frac{d Y_n}{d t} = - \\lambda(t) \\, Y_n(t) \\, Y_s$\n- 与温度相关的俘获率：$\\lambda(t) = \\lambda_0 \\left(\\frac{T(t)}{T_0}\\right)^{\\nu}$，其中 $\\nu = 1$。\n\n**初始条件与参数化：**\n- 初始种子核数分数：$Y_s = k_{\\mathrm{seed}} \\, \\frac{\\max(0, \\, 0.5 - Y_e)}{S / S_0}$\n- 初始中子数分数：$Y_{n,0} = \\max\\left(0, \\, 1 - Y_e - A_{\\mathrm{seed}} \\, Y_s\\right)$\n\n**俘获阶段终点与解：**\n- 俘获结束时间 $t_{\\mathrm{end}}$ 由 $T(t_{\\mathrm{end}}) = T_{\\mathrm{thr}}$ 定义。\n- 对于 $T_{\\mathrm{thr}}  T_0$，$t_{\\mathrm{end}} = 3 \\, \\tau_{\\mathrm{exp}} \\, \\ln\\left(\\frac{T_0}{T_{\\mathrm{thr}}}\\right)$。\n- 对于 $T_{\\mathrm{thr}} \\ge T_0$，$t_{\\mathrm{end}} = 0$。\n- 最终中子分数：$Y_n(t_{\\mathrm{end}}) = Y_{n,0} \\, \\exp\\left[- Y_s \\int_0^{t_{\\mathrm{end}}} \\lambda_0 \\exp\\left(-\\frac{t}{3 \\tau_{\\mathrm{exp}}}\\right) dt \\right]$\n- 该定积分由下式给出：$\\int_0^{t_{\\mathrm{end}}} \\lambda_0 \\exp\\left(-\\frac{t}{3 \\tau_{\\mathrm{exp}}}\\right) dt = \\lambda_0 \\, \\frac{1 - \\exp\\left(-\\frac{t_{\\mathrm{end}}}{3 \\tau_{\\mathrm{exp}}}\\right)}{1/(3 \\tau_{\\mathrm{exp}})}$\n\n**最终质量数计算：**\n- 对于 $Y_s > \\epsilon$，$A_{\\mathrm{final}} = A_{\\mathrm{seed}} + \\dfrac{Y_{n,0} - Y_n(t_{\\mathrm{end}})}{Y_s}$。\n- 对于 $Y_s \\le \\epsilon$，$A_{\\mathrm{final}} = 0$。\n- 设置上限：$A_{\\mathrm{final}} \\leftarrow \\min\\left(A_{\\mathrm{final}}, A_{\\mathrm{cap}}\\right)$。\n\n**常量：**\n- $S_0 = 10$\n- $k_{\\mathrm{seed}} = 0.01$\n- $\\nu = 1$\n- $\\epsilon = 10^{-12}$\n- $A_{\\mathrm{cap}} = 250$\n\n**测试用例 (元组 $(Y_e, S, \\tau_{\\mathrm{exp}}, \\rho_0, T_0, T_{\\mathrm{thr}}, \\lambda_0, A_{\\mathrm{seed}})$):**\n1. $(0.05, 10, 0.005, 10^{11}, 6, 1, 10000, 90)$\n2. $(0.25, 30, 0.05, 10^{10}, 6, 1.5, 5000, 90)$\n3. $(0.45, 20, 0.02, 5 \\times 10^{10}, 5, 1.2, 3000, 90)$\n4. $(0.20, 100, 0.01, 10^{11}, 6, 1, 8000, 90)$\n5. $(0.10, 20, 0.01, 10^{11}, 1, 1, 5000, 90)$\n\n### 步骤2：使用提取的已知条件进行验证\n\n根据所需标准对问题进行评估。\n- **科学依据：** 该问题提出了一个简化的、用于r-过程核合成的单区模型。这是核天体物理学中一种标准的教学和研究工具。物理参数化，例如种子核形成对电子分数 $Y_e$ 和熵 $S$ 的依赖关系，以及中子俘获的质量作用定律，都基于已建立的物理原理。这是对底层物理的简化，而非违背。\n- **适定性：** 该问题提供了一套完整、有序的方程和条件，可以从一组给定的输入参数中计算出 $A_{\\mathrm{final}}$ 的唯一值。边界情况，例如当没有种子核形成时（$Y_s \\le \\epsilon$）或初始温度太低无法进行俘获时（$T_0 \\le T_{\\mathrm{thr}}$），都有明确的定义。\n- **客观性：** 问题以精确、定量且无偏见的科学语言陈述。\n- **完整性与一致性：** 提供了所有必需的常数和公式。变量 $\\rho_0$ 被提及，但正确地指出计算中不需要它，因为温度演化仅取决于比率 $T(t)/T_0$。所提供的反应速率时间积分公式已经过验证且正确无误。逻辑流程一致，没有矛盾。\n- **合理性：** 测试用例的输入参数对于中子星并合抛射物是物理上合理的。\n\n### 步骤3：结论与行动\n\n该问题被判定为**有效**。这是一个独立的、科学上连贯且适定的计算问题。将开发一个解决方案。\n\n解决方案通过为每个测试用例实现问题陈述中定义的计算序列来进行。\n\n**1. 计算初始种子核分数 ($Y_s$)**\n对于每个测试用例，根据电子分数 $Y_e$ 和每重子熵 $S$ 计算初始种子核数分数 $Y_s$。公式为：\n$$\nY_s = k_{\\mathrm{seed}} \\, \\frac{\\max(0, \\, 0.5 - Y_e)}{S / S_0}\n$$\n$\\max(0, 0.5 - Y_e)$ 项反映了只有在富中子条件下 ($Y_e  0.5$) 才会形成大量种子核。分母 $S/S_0$ 模拟了高熵对复杂原子核形成的抑制作用。如果计算出的 $Y_s$ 小于或等于阈值 $\\epsilon = 10^{-12}$，则种子核丰度可忽略不计。在这种情况下，根据问题规则将 $A_{\\mathrm{final}}$ 设为 $0$，该用例无需进一步计算。\n\n**2. 计算初始中子分数 ($Y_{n,0}$)**\n如果 $Y_s > \\epsilon$，我们继续。可用于俘获的初始中子数分数 $Y_{n,0}$ 由总重子份额决定。假设所有重子要么是自由中子，要么束缚在种子核中，我们有：\n$$\nY_{n,0} = \\max\\left(0, \\, 1 - Y_e - A_{\\mathrm{seed}} \\, Y_s\\right)\n$$\n在这里，$1$ 代表总重子数分数，$Y_e$ 近似于质子分数（因为电中性要求 $Y_p = Y_e$），$A_{\\mathrm{seed}} Y_s$ 代表锁定在种子核中的总重子分数。\n\n**3. 确定中子俘获持续时间**\n假设当中子俘获过程的温度降至阈值 $T_{\\mathrm{thr}}$ 时，该过程停止。\n首先，我们比较初始温度 $T_0$ 和 $T_{\\mathrm{thr}}$。\n- 如果 $T_0 \\le T_{\\mathrm{thr}}$，温度已经等于或低于俘获阈值。因此，不发生俘获，俘获持续时间 $t_{\\mathrm{end}}$ 为 $0$，最终质量数 $A_{\\mathrm{final}}$ 就是初始种子核质量数 $A_{\\mathrm{seed}}$。\n- 如果 $T_0 > T_{\\mathrm{thr}}$，俘获阶段会持续一段有限的时间 $t_{\\mathrm{end}}$。通过求解 $T(t_{\\mathrm{end}}) = T_{\\mathrm{thr}}$ 来找到该持续时间：\n$$\nT_{\\mathrm{thr}} = T_0 \\exp\\left(-\\frac{t_{\\mathrm{end}}}{3 \\tau_{\\mathrm{exp}}}\\right) \\implies t_{\\mathrm{end}} = 3 \\tau_{\\mathrm{exp}} \\ln\\left(\\frac{T_0}{T_{\\mathrm{thr}}}\\right)\n$$\n\n**4. 计算积分反应项**\n最终中子分数 $Y_n(t_{\\mathrm{end}})$ 取决于俘获率的时间积分的指数。设此积分为 $I$：\n$$\nI = \\int_0^{t_{\\mathrm{end}}} \\lambda(t) dt = \\int_0^{t_{\\mathrm{end}}} \\lambda_0 \\left(\\frac{T(t)}{T_0}\\right) dt = \\int_0^{t_{\\mathrm{end}}} \\lambda_0 \\exp\\left(-\\frac{t}{3 \\tau_{\\mathrm{exp}}}\\right) dt\n$$\n该积分的计算方法已给出。一个更直接的计算利用了关系 $\\exp(-t_{\\mathrm{end}} / (3 \\tau_{\\mathrm{exp}})) = T_{\\mathrm{thr}} / T_0$：\n$$\nI = \\lambda_0 \\left[ -3 \\tau_{\\mathrm{exp}} \\exp\\left(-\\frac{t}{3 \\tau_{\\mathrm{exp}}}\\right) \\right]_0^{t_{\\mathrm{end}}} = 3 \\tau_{\\mathrm{exp}} \\lambda_0 \\left(1 - \\exp\\left(-\\frac{t_{\\mathrm{end}}}{3 \\tau_{\\mathrm{exp}}}\\right)\\right) = 3 \\tau_{\\mathrm{exp}} \\lambda_0 \\left(1 - \\frac{T_{\\mathrm{thr}}}{T_0}\\right)\n$$\n这个简化形式在数值上是稳健的，并用于计算。\n\n**5. 计算最终中子分数 ($Y_n(t_{\\mathrm{end}})$)**\n有了积分速率 $I$，通过求解 $Y_n$ 的微分方程找到最终的中子分数：\n$$\nY_n(t_{\\mathrm{end}}) = Y_{n,0} \\exp(-Y_s \\cdot I)\n$$\n\n**6. 计算最终平均质量数 ($A_{\\mathrm{final}}$)**\n最终平均质量数是初始种子核质量数 $A_{\\mathrm{seed}}$ 加上每个种子核平均俘获的中子数。被俘获的中子总数分数为 $Y_{n,0} - Y_n(t_{\\mathrm{end}})$。将这些中子分配给 $Y_s$ 个种子核，得到：\n$$\nA_{\\mathrm{final}} = A_{\\mathrm{seed}} + \\frac{Y_{n,0} - Y_n(t_{\\mathrm{end}})}{Y_s}\n$$\n该表达式仅在 $Y_s > \\epsilon$ 时有效。\n\n**7. 应用上限**\n为了考虑像裂变这样的物理过程（这些过程未包含在此简单模型中，但会限制重核的增长），最终质量数被限制在 $A_{\\mathrm{cap}} = 250$：\n$$\nA_{\\mathrm{final}} \\leftarrow \\min(A_{\\mathrm{final}}, A_{\\mathrm{cap}})\n$$\n这样就完成了一个测试用例的计算。对所有提供的用例重复此过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the final average mass number for r-process nucleosynthesis\n    in a simplified one-zone model for several test cases.\n    \"\"\"\n\n    # Define the constants from the problem statement.\n    S0 = 10.0           # Reference entropy in units of k_B\n    k_seed = 0.01       # Dimensionless seed formation scaling constant\n    epsilon = 1e-12     # Small threshold for seed fraction\n    A_cap = 250.0       # Maximum plausible final mass number\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (Ye, S, tau_exp, rho0, T0, T_thr, lambda0, A_seed)\n    # rho0 is not used in the calculation.\n    test_cases = [\n        (0.05, 10.0, 0.005, 1e11, 6.0, 1.0, 10000.0, 90.0),\n        (0.25, 30.0, 0.05, 1e10, 6.0, 1.5, 5000.0, 90.0),\n        (0.45, 20.0, 0.02, 5e10, 5.0, 1.2, 3000.0, 90.0),\n        (0.20, 100.0, 0.01, 1e11, 6.0, 1.0, 8000.0, 90.0),\n        (0.10, 20.0, 0.01, 1e11, 1.0, 1.0, 5000.0, 90.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        Ye, S, tau_exp, _, T0, T_thr, lambda0, A_seed = case\n\n        # Step 1: Calculate the initial seed number fraction, Y_s.\n        # This parameterization models seed suppression at high entropy (S)\n        # and preference for neutron-rich conditions (low Ye).\n        Ys = k_seed * np.max([0.0, 0.5 - Ye]) / (S / S0)\n\n        # Step 2: Handle cases with negligible seeds.\n        if Ys = epsilon:\n            A_final = 0.0\n            results.append(A_final)\n            continue\n\n        # Step 3: Calculate the initial neutron number fraction, Yn0.\n        # This is the baryon budget available for neutron capture.\n        Yn0 = np.max([0.0, 1.0 - Ye - A_seed * Ys])\n        \n        # If there are no initial neutrons, no captures can occur.\n        if Yn0 = 0.0:\n            A_final = A_seed\n            results.append(A_final)\n            continue\n            \n        # Step 4: Determine the duration of the neutron capture phase.\n        # If T0 = T_thr, no capture occurs.\n        if T0 = T_thr:\n            A_final = A_seed\n        else:\n            # Step 5: Calculate the integrated reaction term, I.\n            # The simplified form I = 3 * tau_exp * lambda0 * (1 - T_thr / T0) is used.\n            # This follows directly from the given integral and temperature evolution.\n            integrated_rate_term = 3.0 * tau_exp * lambda0 * (1.0 - T_thr / T0)\n\n            # Step 6: Calculate the final neutron fraction, Yn(t_end).\n            # This is the solution to the mass-action capture law.\n            Yn_tend = Yn0 * np.exp(-Ys * integrated_rate_term)\n\n            # Step 7: Calculate the average final mass number.\n            # This distributes the captured neutrons (Yn0 - Yn_tend) over the seeds (Ys).\n            A_final = A_seed + (Yn0 - Yn_tend) / Ys\n\n        # Step 8: Apply the upper cap to the final mass number.\n        # This enforces a physical limit not captured by the simple model (e.g., fission).\n        A_final = np.min([A_final, A_cap])\n        results.append(A_final)\n\n    # Final print statement in the exact required format.\n    # The output is a comma-separated list of floats rounded to three decimal places,\n    # enclosed in square brackets.\n    formatted_results = [f\"{r:.3f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}