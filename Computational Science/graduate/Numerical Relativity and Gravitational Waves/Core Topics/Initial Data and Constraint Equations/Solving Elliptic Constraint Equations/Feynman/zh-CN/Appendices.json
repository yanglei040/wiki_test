{
    "hands_on_practices": [
        {
            "introduction": "在深入研究复杂的数值解之前，通过解析方法理解约束方程的结构至关重要。这项练习  演示了特定的物理假设（如恒定平均曲率）如何将动量约束方程简化为更易于处理的形式。通过这个“纸笔”推导，我们可以获得对系统行为和解唯一性条件的关键洞察，为更复杂的数值研究奠定坚实的理论基础。",
            "id": "3486526",
            "problem": "考虑广义相对论 $3\\!+\\!1$ 分解中的真空柯西初始数据，其中动量约束由 $\\nabla_{j}\\!\\left(K^{ij}-\\gamma^{ij}K\\right)=0$ 给出。采用共形横向无迹分解，其中 $\\gamma_{ij}=\\psi^{4}\\tilde{\\gamma}_{ij}$，$K=\\text{const}$，外曲率的无迹部分分解为 $A^{ij}=\\psi^{-10}\\left(\\tilde{A}_{\\mathrm{TT}}^{ij}+(\\tilde{\\mathbb{L}}W)^{ij}\\right)$。这里 $\\tilde{A}_{\\mathrm{TT}}^{ij}$ 是相对于共形度规 $\\tilde{\\gamma}_{ij}$ 的一个给定的横向无迹(TT)张量，$(\\tilde{\\mathbb{L}}W)^{ij}$ 是作用在矢量场 $W^{i}$ 上的共形基灵算子，定义为 $(\\tilde{\\mathbb{L}}W)^{ij}=\\tilde{\\nabla}^{i}W^{j}+\\tilde{\\nabla}^{j}W^{i}-\\tfrac{2}{3}\\tilde{\\gamma}^{ij}\\tilde{\\nabla}_{k}W^{k}$。假设在流形 $\\mathbb{R}^{3}$ 上具有渐近欧几里得衰减的共形平坦背景 $\\tilde{\\gamma}_{ij}=\\delta_{ij}$，当 $r\\to\\infty$ 时，$\\tilde{A}_{\\mathrm{TT}}^{ij}=\\mathcal{O}(r^{-3})$ 且 $W^{i}=\\mathcal{O}(r^{-1})$，其中 $r$ 是欧几里得半径。从动量约束和上述基本定义出发，推导 $W^{i}$ 在此设置下必须满足的椭圆系统，在所述边界条件下求解该系统，并证明解 $W^{i}$ 在相差 $\\tilde{\\gamma}_{ij}$ 的一个共形基灵矢量(CKV)的意义下的唯一性。将解 $W^{i}$ 的三个分量表示为单个行矩阵。本题不要求四舍五入，也不涉及物理单位。",
            "solution": "本题要求我们推导并求解矢量场 $W^i$ 所满足的椭圆系统。该矢量场是在常数平均曲率（$K=\\text{const}$）切片的假设下，真空广义相对论中外曲率的共形横向无迹分解的一部分。\n\n出发点是真空时空的动量约束方程：\n$$\n\\nabla_{j}\\!\\left(K^{ij}-\\gamma^{ij}K\\right)=0\n$$\n其中 $\\nabla_j$ 是与空间度规 $\\gamma_{ij}$ 相容的协变导数，$K^{ij}$ 是外曲率张量，$K = \\gamma_{ij}K^{ij}$ 是其迹。\n\n我们将外曲率分解为其无迹部分 $A^{ij}$ 和其迹部分：\n$$\nK^{ij} = A^{ij} + \\frac{1}{3}\\gamma^{ij}K\n$$\n将此代入动量约束得到：\n$$\n\\nabla_{j}\\!\\left(A^{ij} + \\frac{1}{3}\\gamma^{ij}K - \\gamma^{ij}K\\right) = \\nabla_{j}\\!\\left(A^{ij} - \\frac{2}{3}\\gamma^{ij}K\\right) = 0\n$$\n展开散度：\n$$\n\\nabla_{j}A^{ij} - \\frac{2}{3}\\nabla_{j}(\\gamma^{ij}K) = 0\n$$\n$$\n\\nabla_{j}A^{ij} - \\frac{2}{3}(K\\nabla_{j}\\gamma^{ij} + \\gamma^{ij}\\nabla_{j}K) = 0\n$$\n由于度规相容性，$\\nabla_{j}\\gamma^{ij}=0$。题目说明 $K=\\text{const}$，这意味着其协变导数为零，即 $\\nabla_j K = \\partial_j K = 0$。因此，动量约束显著简化为：\n$$\n\\nabla_{j}A^{ij} = 0\n$$\n接下来，我们应用共形分解。空间度规为 $\\gamma_{ij} = \\psi^4 \\tilde{\\gamma}_{ij}$，这意味着逆度规为 $\\gamma^{ij} = \\psi^{-4} \\tilde{\\gamma}^{ij}$。外曲率的无迹部分由 $A^{ij}=\\psi^{-10}\\tilde{A}^{ij}$ 给出，其中 $\\tilde{A}^{ij} = \\tilde{A}_{\\mathrm{TT}}^{ij}+(\\tilde{\\mathbb{L}}W)^{ij}$。张量 $\\tilde{A}^{ij}$ 相对于共形度规 $\\tilde{\\gamma}_{ij}$ 是无迹的，即 $\\tilde{\\gamma}_{ij}\\tilde{A}^{ij}=0$。\n\n我们需要将物理散度 $\\nabla_j A^{ij}$ 与相对于共形度规的散度 $\\tilde{\\nabla}_j \\tilde{A}^{ij}$ 联系起来。使用二阶逆变张量的协变导数变换法则，我们有：\n$$\n\\nabla_j A^{ij} = \\partial_j A^{ij} + \\Gamma^i_{jk} A^{jk} + \\Gamma^j_{jk} A^{ik}\n$$\n克里斯托费尔符号通过 $\\Gamma^i_{jk} = \\tilde{\\Gamma}^i_{jk} + 2(\\delta^i_j \\tilde{\\nabla}_k\\ln\\psi + \\delta^i_k \\tilde{\\nabla}_j\\ln\\psi - \\tilde{\\gamma}_{jk}\\tilde{\\nabla}^i\\ln\\psi)$ 和 $\\Gamma^j_{jk} = \\tilde{\\Gamma}^j_{jk} + 6\\tilde{\\nabla}_k\\ln\\psi$ 相关联。代入 $A^{ij} = \\psi^{-10}\\tilde{A}^{ij}$ 和克里斯托费尔符号的关系式：\n$$\n\\nabla_j (\\psi^{-10}\\tilde{A}^{ij}) = \\partial_j(\\psi^{-10}\\tilde{A}^{ij}) + \\left(\\tilde{\\Gamma}^i_{jk} + 2(\\delta^i_j \\tilde{\\nabla}_k\\ln\\psi + \\delta^i_k \\tilde{\\nabla}_j\\ln\\psi - \\tilde{\\gamma}_{jk}\\tilde{\\nabla}^i\\ln\\psi)\\right)\\psi^{-10}\\tilde{A}^{jk} + \\left(\\tilde{\\Gamma}^j_{jk} + 6\\tilde{\\nabla}_k\\ln\\psi\\right)\\psi^{-10}\\tilde{A}^{ik}\n$$\n展开并合并各项，我们得到：\n$$\n\\psi^{10}\\nabla_j A^{ij} = (\\partial_j \\tilde{A}^{ij} + \\tilde{\\Gamma}^i_{jk}\\tilde{A}^{jk} + \\tilde{\\Gamma}^j_{jk}\\tilde{A}^{ik}) - 10\\tilde{A}^{ij}\\tilde{\\nabla}_j\\ln\\psi + 2\\tilde{A}^{ik}\\tilde{\\nabla}_k\\ln\\psi + 2\\tilde{A}^{ji}\\tilde{\\nabla}_j\\ln\\psi - 2\\tilde{\\gamma}_{jk}\\tilde{A}^{jk}\\tilde{\\nabla}^i\\ln\\psi + 6\\tilde{A}^{ik}\\tilde{\\nabla}_k\\ln\\psi\n$$\n第一个括号中的项是 $\\tilde{\\nabla}_j\\tilde{A}^{ij}$。由于 $\\tilde{A}^{ij}$ 是无迹的，$\\tilde{\\gamma}_{jk}\\tilde{A}^{jk}=0$。利用 $\\tilde{A}^{ij}$ 的对称性，余下的项是：\n$$\n\\psi^{10}\\nabla_j A^{ij} = \\tilde{\\nabla}_j \\tilde{A}^{ij} + (-10+2)\\tilde{A}^{ij}\\tilde{\\nabla}_j\\ln\\psi + (2+6)\\tilde{A}^{ik}\\tilde{\\nabla}_k\\ln\\psi = \\tilde{\\nabla}_j \\tilde{A}^{ij} - 8\\tilde{A}^{ij}\\tilde{\\nabla}_j\\ln\\psi + 8\\tilde{A}^{ik}\\tilde{\\nabla}_k\\ln\\psi\n$$\n通过将最后一项中的哑求和指标从 $k$ 重标记为 $j$，我们看到涉及 $\\psi$ 导数的项相互抵消。\n$$\n\\nabla_j A^{ij} = \\psi^{-10} \\tilde{\\nabla}_j \\tilde{A}^{ij}\n$$\n因此，动量约束 $\\nabla_j A^{ij} = 0$ 等价于 $\\tilde{\\nabla}_j \\tilde{A}^{ij} = 0$。现在我们代入分解式 $\\tilde{A}^{ij} = \\tilde{A}_{\\mathrm{TT}}^{ij} + (\\tilde{\\mathbb{L}}W)^{ij}$：\n$$\n\\tilde{\\nabla}_j (\\tilde{A}_{\\mathrm{TT}}^{ij} + (\\tilde{\\mathbb{L}}W)^{ij}) = 0\n$$\n根据定义，横向无迹张量 $\\tilde{A}_{\\mathrm{TT}}^{ij}$ 相对于共形度规是无散度的，即 $\\tilde{\\nabla}_j \\tilde{A}_{\\mathrm{TT}}^{ij} = 0$。这给我们留下了矢量场 $W^i$ 的一个椭圆方程：\n$$\n\\tilde{\\nabla}_j (\\tilde{\\mathbb{L}}W)^{ij} = 0\n$$\n题目指定了 $\\mathbb{R}^3$ 上的共形平坦背景，因此 $\\tilde{\\gamma}_{ij}=\\delta_{ij}$。在这种情况下，共形协变导数 $\\tilde{\\nabla}_j$ 变为普通偏导数 $\\partial_j$。共形基灵算子变为：\n$$\n(\\tilde{\\mathbb{L}}W)^{ij} = \\partial^{i}W^{j}+\\partial^{j}W^{i}-\\frac{2}{3}\\delta^{ij}\\partial_{k}W^{k}\n$$\n$W^i$ 的方程是 $\\partial_j (\\tilde{\\mathbb{L}}W)^{ij} = 0$。我们展开它：\n$$\n\\partial_j \\left(\\partial^{i}W^{j}+\\partial^{j}W^{i}-\\frac{2}{3}\\delta^{ij}\\partial_{k}W^{k}\\right) = 0\n$$\n$$\n\\partial^i(\\partial_j W^j) + \\partial_j\\partial^j W^i - \\frac{2}{3}\\partial^i(\\partial_k W^k) = 0\n$$\n使用矢量记号，其中散度为 $\\vec{\\nabla}\\cdot\\vec{W} = \\partial_j W^j$，拉普拉斯算子为 $\\nabla^2 = \\partial_j \\partial^j$，则 $\\vec{W}$ 的第 $i$ 个分量的方程为：\n$$\n\\nabla^2 W^i + \\frac{1}{3} \\partial^i (\\partial_j W^j) = 0\n$$\n这就是 $W^i$ 必须满足的椭圆系统。为了求解它，我们通过作用 $\\partial_i$ 来求它的散度：\n$$\n\\partial_i(\\nabla^2 W^i) + \\partial_i\\left(\\frac{1}{3} \\partial^i (\\partial_j W^j)\\right) = 0\n$$\n$$\n\\nabla^2 (\\partial_i W^i) + \\frac{1}{3} \\nabla^2 (\\partial_j W^j) = 0\n$$\n令 $\\theta = \\partial_j W^j$。方程变为 $\\frac{4}{3}\\nabla^2\\theta=0$，这意味着 $\\nabla^2\\theta=0$。所以，$\\vec{W}$ 的散度是 $\\mathbb{R}^3$ 上的一个调和函数。$W^i$ 的边界条件是当 $r \\to \\infty$ 时 $W^i = \\mathcal{O}(r^{-1})$。这意味着它的导数衰减得更快：$\\partial_j W^i = \\mathcal{O}(r^{-2})$。因此，$\\theta = \\partial_j W^j = \\mathcal{O}(r^{-2})$。一个在 $\\mathbb{R}^3$ 上且在无穷远处为零（$\\mathcal{O}(r^{-2})$ 符合此条件）的调和函数必须恒等于零。因此，$\\theta = \\partial_j W^j = 0$。\n\n将 $\\partial_j W^j = 0$ 代回 $W^i$ 的椭圆系统，我们得到：\n$$\n\\nabla^2 W^i = 0\n$$\n每个分量 $W^i$ 都必须是 $\\mathbb{R}^3$ 上的调和函数。边界条件是 $W^i = \\mathcal{O}(r^{-1})$，这意味着 $\\lim_{r\\to\\infty} W^i(x) = 0$。根据势论的一个标准定理（调和函数的刘维尔定理的一个推论），任何在整个 $\\mathbb{R}^n$ ($n\\geq 2$) 上且在无穷远处为零的调和函数都必须恒等于零。因此，满足给定条件的唯一解是 $W^i = 0$（$i=1, 2, 3$）。\n\n问题提到了解在相差一个共形基灵矢量(CKV)的意义下的唯一性。如果一个矢量场 $X^i$ 的共形基灵算子为零，即 $(\\tilde{\\mathbb{L}}X)^{ij}=0$，那么它就是 $\\tilde{\\gamma}_{ij}$ 的一个CKV。如果 $W^i$ 是 $\\tilde{\\nabla}_j(\\tilde{\\mathbb{L}}W)^{ij}=0$ 的一个解，那么 $W^i+X^i$ 也是一个解。这构成了不确定性。然而，解必须满足边界条件 $W^i = \\mathcal{O}(r^{-1})$。如果两个解 $W_1^i$ 和 $W_2^i$ 满足此条件，它们的差 $\\delta W^i = W_1^i - W_2^i$ 也必须满足此条件，因此 $\\delta W^i=\\mathcal{O}(r^{-1})$。这个差必须是一个CKV。平坦空间 $\\mathbb{R}^3$ 的CKV包括平移（$X^i=c^i$）、旋转（$X^i=\\omega^i_j x^j$）、伸缩（$X^i=cx^i$）和特殊共形变换（$X^i=b^i r^2 - 2x^i(b\\cdot x)$）。这些非平凡的CKV在无穷远处都不衰减。唯一满足 $\\mathcal{O}(r^{-1})$ 衰减条件的CKV是平凡解 $X^i=0$。因此，边界条件唯一地确定了解，消除了由CKV带来的任何不确定性。解是 $W^i=0$。\n\n解矢量 $W^i$ 的三个分量是 $(W^1, W^2, W^3) = (0, 0, 0)$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0  0  0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "从理论走向实践，需要将连续的偏微分方程离散化，并且至关重要地，要施加具有明确物理意义的边界条件。这项练习  提供了宝贵的实践经验，指导我们使用有限差分法，在包含黑洞视界 (apparent horizon) 的区域上求解共形因子。这类带有混合边界条件的问题是数值相对论中构造黑洞初始数据的典型场景，也是检验数值方法稳定性和准确性的关键一步。",
            "id": "3486554",
            "problem": "您需要设计并实现一个程序，该程序用于数值求解在准平衡条件和表观视界混合内部边界条件下，广义相对论（GR）中黑洞初始数据构造所遇到的椭圆约束方程的简化模型。目标数学模型是严格一维、球对称且无量纲的，所有量均被视为无单位的纯数。\n\n从空间度规的共形分解以及真空哈密顿约束和动量约束出发，并引入时间对称的初始切片和球对称性。使用以下基本事实作为您的基础：(i) 在时间对称的真空切片中，外部曲率消失，真空哈密顿约束简化为关于共形因子的齐次线性椭圆方程；(ii) 在球对称下，作用于仅依赖于半径的标量的平直空间拉普拉斯算子简化为一个径向算子。避免假设任何预先推导的离散化表达式或求解公式；您的推导必须遵循这些原则。\n\n考虑一个半径 $r \\in [R_{\\mathrm{h}}, R_{\\max}]$ 的球壳区域，其中 $R_{\\mathrm{h}} > 0$ 是一个代表表观视界（AH）的给定内边界，而 $R_{\\max} > R_{\\mathrm{h}}$ 是一个近似空间无穷远的有限外边界。令 $\\psi(r)$ 表示共形因子，$\\beta^r(r)$ 表示移位矢量的径向分量。假设共形平直背景和时间对称性，因此真空哈密顿约束简化为关于 $\\psi(r)$ 的齐次椭圆方程，并假设在球对称下，与非旋转、球对称准平衡构型中源和力矩的消失相一致的关于 $\\beta^r(r)$ 的齐次椭圆方程。\n\n施加以下边界条件：\n- 内边界，位于 $r = R_{\\mathrm{h}}$：\n  - 对于共形因子 $\\psi(r)$，施加一个准平衡表观视界（AH）条件，其形式为一个与球对称中的孤立等距喉（isolated isometry throat）相一致的罗宾（Robin）边界条件：在 $r = R_{\\mathrm{h}}$ 处，$r \\,\\partial_r \\psi + \\psi = 0$。\n  - 对于移位分量 $\\beta^r(r)$，施加一个代表表观视界无垂直于其表面的坐标运动的诺伊曼（Neumann）条件：在 $r = R_{\\mathrm{h}}$ 处，$\\partial_r \\beta^r = 0$。\n- 外边界，位于 $r = R_{\\max}$：\n  - 共形因子的渐近平直性：$\\psi(R_{\\max}) = 1$。\n  - 惯性系中移位消失：$\\beta^r(R_{\\max}) = 0$。\n\n任务：\n1. 从球对称下拉普拉斯算子的散度形式出发，推导作用于任意径向函数 $u(r)$ 的一维算子，并写出在区域 $r \\in (R_{\\mathrm{h}}, R_{\\max})$ 内 $\\psi(r)$ 和 $\\beta^r(r)$ 满足的齐次椭圆方程。\n2. 在覆盖区间 $[R_{\\mathrm{h}}, R_{\\max}]$ 的 $N+1$ 个节点的均匀网格上（$N \\in \\mathbb{N}$）推导一个二阶有限差分格式。确保您的内部模板是二阶精确的，并且您能够一致且稳定地施加混合内部边界条件（对 $\\psi$ 是罗宾条件，对 $\\beta^r$ 是诺伊曼条件）和外部狄利克雷（Dirichlet）条件（对两个场）。您的实现必须构建并求解由此产生的关于 $\\psi$ 和 $\\beta^r$ 的线性系统。\n3. 对于 $\\psi(r)$，推导在给定混合边界条件下相应齐次椭圆方程在球对称下的解析解。使用此解析解作为参考，量化整个网格上的最大范数相对误差。\n4. 定义以下诊断量以评估准平衡的执行情况和解的质量：\n   - $E_{\\psi}^{\\infty}$：$\\psi$ 的最大相对误差，相对于推导出的解析解，在所有网格节点上计算，定义为 $|\\psi_{\\mathrm{num}}(r_i) - \\psi_{\\mathrm{ref}}(r_i)|$ 在所有 $i$ 上的最大值除以 $|\\psi_{\\mathrm{ref}}(r_i)|$ 在所有 $i$ 上的最大值。\n   - $R_{\\psi}^{\\infty}$：作用于 $\\psi_{\\mathrm{num}}$ 的离散椭圆算子在内部节点上的最大绝对值，即内部的离散残差。\n   - $B_{\\psi}$：在 $r = R_{\\mathrm{h}}$ 处计算的离散内边界残差 $R_{\\mathrm{h}} \\,(\\partial_r \\psi)_{\\mathrm{disc}} + \\psi$ 的绝对值。\n   - $R_{\\beta}^{\\infty}$：作用于 $\\beta^r_{\\mathrm{num}}$ 的离散椭圆算子在内部节点上的最大绝对值。\n   - $B_{\\beta}$：在 $r = R_{\\mathrm{h}}$ 处计算的离散内边界残差 $(\\partial_r \\beta^r)_{\\mathrm{disc}}$ 的绝对值。\n5. 对于下面的每个测试用例，计算一个单一的标量质量得分 $q$，定义为 $q = \\max\\{ E_{\\psi}^{\\infty}, R_{\\psi}^{\\infty}, B_{\\psi}, R_{\\beta}^{\\infty}, B_{\\beta} \\}$。您的程序必须将指定测试套件的这些质量得分作为单行输出。\n\n所有计算都是无量纲的。角度不出现。将所有最终数值输出表示为无单位的浮点数。\n\n测试套件：\n- 情况 1：$R_{\\mathrm{h}} = 2$，$R_{\\max} = 10$，$N = 200$。\n- 情况 2：$R_{\\mathrm{h}} = 2$，$R_{\\max} = 10$，$N = 40$。\n- 情况 3：$R_{\\mathrm{h}} = 9$，$R_{\\max} = 10$，$N = 200$。\n- 情况 4：$R_{\\mathrm{h}} = 0.5$，$R_{\\max} = 5$，$N = 200$。\n\n最终输出格式要求：\n- 您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表，顺序与测试用例一致，即 $[q_1, q_2, q_3, q_4]$。\n\n您提交的必须是一个完整的、可运行的程序，实现上述要求，无需任何用户输入或外部文件，并且必须严格遵守最终输出格式。",
            "solution": "用户提供了一个有效且适定的计算物理问题，具体涉及广义相对论中简化的椭圆约束方程的数值解。该问题具有科学依据、客观，并包含进行唯一解所需的所有必要信息。\n\n### 1. 控制方程与解析解\n\n该问题要求在一个球对称的一维区域 $r \\in [R_{\\mathrm{h}}, R_{\\max}]$ 中，求解关于共形因子 $\\psi(r)$ 和径向移位矢量分量 $\\beta^r(r)$ 的齐次椭圆方程。合适的算子是球坐标系中作用于纯径向函数 $u(r)$ 的拉普拉斯算子。从散度形式 $\\nabla^2 u = \\vec{\\nabla} \\cdot (\\vec{\\nabla} u)$ 出发，我们注意到对于 $u(r)$，其梯度为 $\\vec{\\nabla} u = \\frac{du}{dr} \\hat{r}$。该矢量场的散度为 $\\vec{\\nabla} \\cdot (\\frac{du}{dr} \\hat{r}) = \\frac{1}{r^2} \\frac{d}{dr}(r^2 \\frac{du}{dr})$。展开此式得到算子：\n$$\n\\nabla^2 u(r) = \\frac{d^2 u}{dr^2} + \\frac{2}{r} \\frac{du}{dr}\n$$\n两个场的控制方程都是拉普拉斯方程的实例，$\\nabla^2 u = 0$：\n$$\n\\frac{d^2 \\psi}{dr^2} + \\frac{2}{r} \\frac{d \\psi}{dr} = 0\n$$\n$$\n\\frac{d^2 \\beta^r}{dr^2} + \\frac{2}{r} \\frac{d \\beta^r}{dr} = 0\n$$\n这些是柯西-欧拉常微分方程。通解的形式为 $u(r) = A + B/r$，其中 $A$ 和 $B$ 是由边界条件决定的常数。\n\n**$\\psi(r)$ 的解析解：**\n边界条件为 $\\psi(R_{\\max}) = 1$ 以及在 $r=R_{\\mathrm{h}}$ 处的罗宾条件 $r \\frac{d\\psi}{dr} + \\psi = 0$。\n将罗宾条件应用于通解形式 $\\psi(r) = A + B/r$（其导数为 $\\frac{d\\psi}{dr} = -B/r^2$）：\n$$\nR_{\\mathrm{h}} \\left(-\\frac{B}{R_{\\mathrm{h}}^2}\\right) + \\left(A + \\frac{B}{R_{\\mathrm{h}}}\\right) = 0 \\implies -\\frac{B}{R_{\\mathrm{h}}} + A + \\frac{B}{R_{\\mathrm{h}}} = 0 \\implies A = 0\n$$\n解的形式必须为 $\\psi(r) = B/r$。应用外边界的狄利克雷条件：\n$$\n\\psi(R_{\\max}) = \\frac{B}{R_{\\max}} = 1 \\implies B = R_{\\max}\n$$\n因此，解析参考解为 $\\psi_{\\mathrm{ref}}(r) = R_{\\max}/r$。\n\n**$\\beta^r(r)$ 的解析解：**\n边界条件为 $\\beta^r(R_{\\max}) = 0$ 以及在 $r=R_{\\mathrm{h}}$ 处的诺伊曼条件 $\\frac{d\\beta^r}{dr} = 0$。\n将诺伊曼条件应用于通解形式 $\\beta^r(r) = C + D/r$：\n$$\n\\frac{d\\beta^r}{dr}\\bigg|_{r=R_{\\mathrm{h}}} = -\\frac{D}{R_{\\mathrm{h}}^2} = 0 \\implies D = 0\n$$\n解的形式必须为 $\\beta^r(r) = C$。应用外边界的狄利克雷条件：\n$$\n\\beta^r(R_{\\max}) = C = 0 \\implies C = 0\n$$\n因此，解析解是平凡解 $\\beta^r(r) = 0$。\n\n### 2. 有限差分离散化\n我们使用 $N+1$ 个均匀间隔的节点 $r_i = R_{\\mathrm{h}} + i \\cdot \\Delta r$（$i=0, 1, \\dots, N$）来离散化区域 $[R_{\\mathrm{h}}, R_{\\max}]$，其中网格间距为 $\\Delta r = (R_{\\max} - R_{\\mathrm{h}})/N$。令 $u_i$ 表示 $u(r_i)$ 的数值近似。\n\n**内部模板：**对于内部节点 $i=1, \\dots, N-1$，我们使用二阶中心差分来近似导数：\n$$\n\\frac{d u}{d r}\\bigg|_{r_i} \\approx \\frac{u_{i+1} - u_{i-1}}{2\\Delta r}, \\quad \\frac{d^2 u}{d r^2}\\bigg|_{r_i} \\approx \\frac{u_{i+1} - 2u_i + u_{i-1}}{(\\Delta r)^2}\n$$\n将这些代入控制方程 $u'' + (2/r)u' = 0$ 中，得到每个内部节点的离散方程：\n$$\n\\left(1 - \\frac{\\Delta r}{r_i}\\right)u_{i-1} - 2u_i + \\left(1 + \\frac{\\Delta r}{r_i}\\right)u_{i+1} = 0\n$$\n\n**边界条件：**\n未知数是值 $u_0, u_1, \\dots, u_{N-1}$。值 $u_N$ 由外边界条件固定。这产生一个包含 $N$ 个方程和 $N$ 个未知数的线性系统。\n\n- **外边界 ($r_N = R_{\\max}$):** 狄利克雷条件被精确执行：\n  - $\\psi_N = 1$\n  - $\\beta^r_N = 0$\n  这些值不是未知数；它们被并入用于节点 $i=N-1$ 的方程的线性系统的右侧。\n\n- **$\\psi$ 的内边界 ($r_0 = R_{\\mathrm{h}}$):** 罗宾条件 $r\\psi' + \\psi = 0$ 使用二阶精确的单边有限差分来离散化导数 $\\psi'(r_0)$：\n  $$\n  \\psi'(r_0) \\approx \\frac{-3\\psi_0 + 4\\psi_1 - \\psi_2}{2\\Delta r}\n  $$\n  将此代入罗宾条件，得到 $\\psi$ 线性系统的第一个方程：\n  $$\n  R_{\\mathrm{h}}\\left(\\frac{-3\\psi_0 + 4\\psi_1 - \\psi_2}{2\\Delta r}\\right) + \\psi_0 = 0 \\implies (-3R_{\\mathrm{h}} + 2\\Delta r)\\psi_0 + (4R_{\\mathrm{h}})\\psi_1 - R_{\\mathrm{h}}\\psi_2 = 0\n  $$\n\n- **$\\beta^r$ 的内边界 ($r_0 = R_{\\mathrm{h}}$):** 诺伊曼条件 $(\\beta^r)'=0$ 使用虚拟点法进行离散化，以保持二阶精度。我们在 $r_{-1} = r_0 - \\Delta r$ 处引入一个虚拟点，并在 $r_0$ 处同时施加边界条件和控制偏微分方程。\n  1. 边界条件的中心差分：$\\frac{\\beta^r_1 - \\beta^r_{-1}}{2\\Delta r} = 0 \\implies \\beta^r_{-1} = \\beta^r_1$。\n  2. 在 $r_0$ 处的偏微分方程：$(\\beta^r)'' + \\frac{2}{r_0}(\\beta^r)' = 0$。使用中心差分，这将 $\\beta^r_{-1}, \\beta^r_0, \\beta^r_1$ 联系起来。\n  将 $\\beta^r_{-1} = \\beta^r_1$ 代入在 $r_0$ 处的离散化偏微分方程，简化为：\n  $$\n  \\beta^r_0 - \\beta^r_1 = 0\n  $$\n  这为 $\\beta^r$ 系统提供了第一个方程。虽然它看起来是一阶的，但它源于一个二阶精确的过程。\n\n### 3. 线性系统与诊断\n\n对于每个场 $\\psi$ 和 $\\beta^r$，我们构建一个 $N \\times N$ 的线性系统 $A\\mathbf{u} = \\mathbf{b}$，然后求解未知数向量 $\\mathbf{u} = [u_0, \\dots, u_{N-1}]^T$。矩阵 $A$ 是近似三对角的。\n\n数值解 $\\psi_{\\mathrm{num}}$ 和 $\\beta^r_{\\mathrm{num}}$ 的质量通过五个诊断量进行评估：\n\n1.  $E_{\\psi}^{\\infty}$：$\\psi$ 的最大范数相对误差，将数值解 $\\psi_{\\mathrm{num}}$ 与解析参考解 $\\psi_{\\mathrm{ref}}(r_i) = R_{\\max}/r_i$ 进行比较。\n    $$\n    E_{\\psi}^{\\infty} = \\frac{\\max_i |\\psi_{\\mathrm{num}}(r_i) - \\psi_{\\mathrm{ref}}(r_i)|}{\\max_i |\\psi_{\\mathrm{ref}}(r_i)|}\n    $$\n2.  $R_{\\psi}^{\\infty}$：区域内部离散椭圆算子的最大绝对残差，用于衡量数值解满足控制方程的程度。\n    $$\n    R_{\\psi}^{\\infty} = \\max_{i=1,\\dots,N-1} \\left| \\frac{1}{(\\Delta r)^2} \\left[ \\left(1 - \\frac{\\Delta r}{r_i}\\right)\\psi_{\\mathrm{num},i-1} - 2\\psi_{\\mathrm{num},i} + \\left(1 + \\frac{\\Delta r}{r_i}\\right)\\psi_{\\mathrm{num},i+1} \\right] \\right|\n    $$\n3.  $B_{\\psi}$：内边界上罗宾边界条件的绝对残差，使用一致的二阶单边导数进行评估。\n    $$\n    B_{\\psi} = \\left| R_{\\mathrm{h}} \\left(\\frac{-3\\psi_{\\mathrm{num},0} + 4\\psi_{\\mathrm{num},1} - \\psi_{\\mathrm{num},2}}{2 \\Delta r}\\right) + \\psi_{\\mathrm{num},0} \\right|\n    $$\n4.  $R_{\\beta}^{\\infty}$：$\\beta^r$ 的最大绝对内部残差，与 $R_{\\psi}^{\\infty}$ 类似。\n5.  $B_{\\beta}$：内边界上诺伊曼边界条件的绝对残差，为保持一致性，使用相同的二阶单边导数进行评估。\n    $$\n    B_{\\beta} = \\left| \\frac{-3\\beta^r_{\\mathrm{num},0} + 4\\beta^r_{\\mathrm{num},1} - \\beta^r_{\\mathrm{num},2}}{2 \\Delta r} \\right|\n    $$\n最后，对于每个测试用例，计算一个单一的质量得分 $q$，作为这五个诊断值的最大值：\n$$\nq = \\max\\{ E_{\\psi}^{\\infty}, R_{\\psi}^{\\infty}, B_{\\psi}, R_{\\beta}^{\\infty}, B_{\\beta} \\}\n$$",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve_system_and_get_q(Rh, Rmax, N):\n    \"\"\"\n    Solves the 1D elliptic equations for psi and beta_r and computes the quality score q.\n    \"\"\"\n    # 1. Setup grid\n    delta_r = (Rmax - Rh) / N\n    # r is a grid of N+1 nodes from Rh to Rmax\n    r = np.linspace(Rh, Rmax, N + 1)\n    \n    # 2. Solve for psi\n    # We solve for N unknowns: psi_0 to psi_{N-1}. psi_N is known.\n    # We construct and solve the linear system A_psi * x = b_psi.\n    A_psi = np.zeros((N, N))\n    b_psi = np.zeros(N)\n    \n    psi_N = 1.0\n\n    # The problem constraints ensure N is large enough (>= 40), so N > 2.\n    # Row 0: Inner Robin BC for psi (using 2nd-order one-sided derivative)\n    # (-3*Rh + 2*delta_r)*psi_0 + (4*Rh)*psi_1 - Rh*psi_2 = 0\n    A_psi[0, 0] = -3 * Rh + 2 * delta_r\n    A_psi[0, 1] = 4 * Rh\n    A_psi[0, 2] = -Rh\n    # b_psi[0] is 0\n    \n    # Rows 1 to N-2: Interior points\n    for i in range(1, N - 1):\n        ri = r[i]\n        A_psi[i, i - 1] = 1.0 - delta_r / ri\n        A_psi[i, i] = -2.0\n        A_psi[i, i + 1] = 1.0 + delta_r / ri\n        # b_psi[i] is 0\n        \n    # Row N-1: Interior point adjacent to outer boundary\n    r_nm1 = r[N - 1]\n    A_psi[N - 1, N - 2] = 1.0 - delta_r / r_nm1\n    A_psi[N - 1, N - 1] = -2.0\n    b_psi[N - 1] = -(1.0 + delta_r / r_nm1) * psi_N\n    \n    psi_sol = np.linalg.solve(A_psi, b_psi)\n    psi_num = np.append(psi_sol, psi_N)\n\n    # 3. Solve for beta_r\n    # We solve for N unknowns: beta_0 to beta_{N-1}. beta_N is known.\n    A_beta = np.zeros((N, N))\n    b_beta = np.zeros(N) # b_beta is entirely zeros\n\n    beta_N = 0.0\n    \n    # Row 0: Inner Neumann BC for beta (from 2nd-order ghost point method)\n    # beta_0 - beta_1 = 0\n    A_beta[0, 0] = 1.0\n    A_beta[0, 1] = -1.0\n    \n    # Rows 1 to N-2: Interior points\n    for i in range(1, N - 1):\n        ri = r[i]\n        A_beta[i, i - 1] = 1.0 - delta_r / ri\n        A_beta[i, i] = -2.0\n        A_beta[i, i + 1] = 1.0 + delta_r / ri\n\n    # Row N-1: Interior point adjacent to outer boundary\n    r_nm1 = r[N - 1]\n    A_beta[N - 1, N - 2] = 1.0 - delta_r / r_nm1\n    A_beta[N - 1, N - 1] = -2.0\n    # b_beta[N-1] is -(1.0 + delta_r/r_nm1) * beta_N = 0\n    \n    beta_sol = np.linalg.solve(A_beta, b_beta)\n    beta_num = np.append(beta_sol, beta_N)\n    \n    # 4. Calculate diagnostic measures\n    # Analytic solution for psi\n    psi_ref = Rmax / r\n    \n    # E_psi_inf: Max-norm relative error for psi\n    E_psi_inf_num = np.max(np.abs(psi_num - psi_ref))\n    E_psi_inf_den = np.max(np.abs(psi_ref)) # This is psi_ref[0] = Rmax/Rh\n    E_psi_inf = E_psi_inf_num / E_psi_inf_den\n\n    # R_psi_inf: Max absolute interior residual for psi\n    residuals_psi = []\n    for i in range(1, N): # Interior nodes are from r_1 to r_{N-1}\n        ri = r[i]\n        op_val = (1.0 / (delta_r**2)) * \\\n                 ((1.0 - delta_r / ri) * psi_num[i - 1] - 2.0 * psi_num[i] + (1.0 + delta_r / ri) * psi_num[i + 1])\n        residuals_psi.append(np.abs(op_val))\n    R_psi_inf = np.max(residuals_psi) if residuals_psi else 0.0\n\n    # B_psi: Absolute inner boundary residual for psi\n    d_psi_dr_0 = (-3*psi_num[0] + 4*psi_num[1] - psi_num[2]) / (2.0 * delta_r)\n    B_psi = np.abs(Rh * d_psi_dr_0 + psi_num[0])\n    \n    # R_beta_inf: Max absolute interior residual for beta_r\n    residuals_beta = []\n    for i in range(1, N):\n        ri = r[i]\n        op_val = (1.0 / (delta_r**2)) * \\\n                 ((1.0 - delta_r / ri) * beta_num[i - 1] - 2.0 * beta_num[i] + (1.0 + delta_r / ri) * beta_num[i + 1])\n        residuals_beta.append(np.abs(op_val))\n    R_beta_inf = np.max(residuals_beta) if residuals_beta else 0.0\n    \n    # B_beta: Absolute inner boundary residual for beta_r\n    d_beta_dr_0 = (-3*beta_num[0] + 4*beta_num[1] - beta_num[2]) / (2.0 * delta_r)\n    B_beta = np.abs(d_beta_dr_0)\n    \n    # 5. Compute quality score q\n    q = np.max([E_psi_inf, R_psi_inf, B_psi, R_beta_inf, B_beta])\n    \n    return q\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (Rh, Rmax, N)\n        (2.0, 10.0, 200),\n        (2.0, 10.0, 40),\n        (9.0, 10.0, 200),\n        (0.5, 5.0, 200),\n    ]\n\n    results = []\n    for case in test_cases:\n        Rh, Rmax, N = case\n        q = solve_system_and_get_q(Rh, Rmax, int(N))\n        results.append(q)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "真实的引力波初始数据问题通常归结为求解耦合的、非线性的椭圆型方程组，这比线性问题要复杂得多。这项高级练习  引导您实现一个强大的牛顿-康托罗维奇 (Newton-Kantorovich) 迭代求解器，并结合回溯线搜索等全局化策略来确保收敛。这是现代数值相对论求解器中的核心算法，通过解决一个具有代表性的非线性模型系统，您将掌握应对爱因斯坦约束方程完整复杂性的核心技术。",
            "id": "3486586",
            "problem": "考虑一个简化的一维表示，该表示源于数值相对论中用于生成引力波初始数据的非恒定平均曲率 (non-CMC) 扩展共形薄三明治 (XCTS) 椭圆约束系统。从爱因斯坦约束方程和共形薄三明治分解作为基本基础开始。在共形分解中，主阶结构是关于共形因子、lapse 函数和位移向量的椭圆系统。为了设计一个可数值测试的问题，在域 $[0,1]$ 上使用 Dirichlet 边界条件对系统进行建模，并使用光滑的、预先指定的背景场。\n\n将未知数 $u(x) = (\\phi(x), \\alpha(x), \\beta(x))$ 定义为一维空间中的共形因子 $\\phi$、lapse 函数 $\\alpha$ 和位移向量 $\\beta$。令 $x \\in [0,1]$ 且角度参数以弧度为单位。考虑以下受 XCTS 结构启发的半线性椭圆系统：\n$$\n\\begin{aligned}\n&-\\frac{d^2 \\phi}{dx^2} + a_1 S(x)\\,\\phi(x)^{-7} + a_2 K(x)^2\\,\\phi(x)^{5} + a_3 \\rho(x)\\,\\phi(x)^{5} = 0, \\\\\n&-\\frac{d^2 \\beta}{dx^2} + b_1 \\frac{dK}{dx}(x) + b_2 \\phi(x)^{-6}\\,\\beta(x) = 0, \\\\\n&-\\frac{d^2 \\alpha}{dx^2} + c_1 \\phi(x)^{4}\\,\\alpha(x) + c_2 K(x)^2\\,\\alpha(x) - c_3 \\phi(x)^{6} = 0,\n\\end{aligned}\n$$\n服从 Dirichlet 边界条件\n$$\n\\phi(0) = 1,\\quad \\phi(1) = 1,\\quad \\alpha(0) = 1,\\quad \\alpha(1) = 1,\\quad \\beta(0) = 0,\\quad \\beta(1) = 0.\n$$\n此处，$S(x)$、$K(x)$ 和 $\\rho(x)$ 是预先指定的光滑函数，分别代表外在曲率的无迹部分的平方度量、平均曲率和物质密度。常数 $a_1$、$a_2$、$a_3$、$b_1$、$b_2$、$c_1$、$c_2$、$c_3$ 是正的，并设定了耦合项的尺度。$S(x)$ 和 $K(x)$ 中的角度参数以弧度为单位。\n\n使用 $N$ 个均匀间隔点离散化域 $[0,1]$，间距为 $h = \\frac{1}{N-1}$。对二阶导数使用二阶中心有限差分：\n$$\n\\frac{d^2 u}{dx^2}\\biggr|_{x_i} \\approx \\frac{u_{i-1} - 2 u_i + u_{i+1}}{h^2},\n$$\n对于内部点 $i$，并通过形如 $u_i - u_{\\text{bc},i} = 0$ 的残差方程在边界上强制施加 Dirichlet 边界条件。\n\n令 $F(U)$ 表示所有网格点上所有三个场的组合非线性残差向量，令 $J(U)$ 表示其关于 $U$ 的雅可比矩阵。实现一个 Newton–Kantorovich 迭代\n$$\nJ(U_k)\\,\\delta U_k = -F(U_k),\\quad U_{k+1}^{\\text{trial}} = U_k + \\lambda\\,\\delta U_k,\n$$\n该迭代通过在价值函数上进行回溯线搜索进行全局化\n$$\n\\Phi(U) = \\frac{1}{2}\\,\\|F(U)\\|_2^2,\n$$\n并满足 Armijo 充分下降条件\n$$\n\\Phi(U_k + \\lambda\\,\\delta U_k) \\le \\Phi(U_k) + c\\,\\lambda\\,\\frac{d}{d\\lambda}\\Phi(U_k + \\lambda\\,\\delta U_k)\\biggr|_{\\lambda=0}.\n$$\n利用以下事实：沿着牛顿方向 $\\delta U_k$，方向导数满足\n$$\n\\frac{d}{d\\lambda}\\Phi(U_k + \\lambda\\,\\delta U_k)\\biggr|_{\\lambda=0} = F(U_k)^\\top J(U_k)\\,\\delta U_k = -\\|F(U_k)\\|_2^2.\n$$\n选择 $c \\in (0,1)$ 并使用因子 $\\tau \\in (0,1)$ 进行回溯，直到 Armijo 条件成立或达到最小步长。为保持物理可容许性，在形成试验更新后，通过投影到正的下限值来在每一步强制 $\\phi(x) > 0$。\n\n为内部点的雅可比块实现以下特定的离散化细节：\n- 对于 $\\phi$-方程行，来自拉普拉斯算子的对角贡献为 $\\frac{2}{h^2}$，非对角贡献为 $-\\frac{1}{h^2}$；加上非线性项的局域导数\n$$\n\\partial_\\phi\\left(a_1 S\\,\\phi^{-7}\\right) = -7 a_1 S\\,\\phi^{-8},\\quad\n\\partial_\\phi\\left(a_2 K^2\\,\\phi^{5}\\right) = 5 a_2 K^2\\,\\phi^{4},\\quad\n\\partial_\\phi\\left(a_3 \\rho\\,\\phi^{5}\\right) = 5 a_3 \\rho\\,\\phi^{4}.\n$$\n- 对于 $\\beta$-方程行，拉普拉斯算子对 $\\beta$ 的贡献如上，其局域导数贡献为\n$$\n\\partial_\\beta\\left(b_2 \\phi^{-6}\\,\\beta\\right) = b_2 \\phi^{-6},\\quad\n\\partial_\\phi\\left(b_2 \\phi^{-6}\\,\\beta\\right) = -6 b_2 \\phi^{-7}\\,\\beta.\n$$\n- 对于 $\\alpha$-方程行，拉普拉斯算子对 $\\alpha$ 的贡献如上，其局域导数为\n$$\n\\partial_\\alpha\\left(c_1 \\phi^{4}\\,\\alpha + c_2 K^2\\,\\alpha\\right) = c_1 \\phi^{4} + c_2 K^2,\\quad\n\\partial_\\phi\\left(c_1 \\phi^{4}\\,\\alpha - c_3 \\phi^{6}\\right) = 4 c_1 \\phi^{3}\\,\\alpha - 6 c_3 \\phi^{5}.\n$$\n在边界点，为强制 $u_i - u_{\\text{bc},i} = 0$ 的相应未知数将雅可比行设置为单位矩阵。\n\n选择背景场\n$$\nS(x) = s_0 + s_1 \\sin(2\\pi x),\\quad\nK(x) = K_0 + K_1 \\sin(\\pi x),\\quad\n\\frac{dK}{dx}(x) = K_1 \\pi \\cos(\\pi x),\\quad\n\\rho(x) = r_0 \\exp\\left(-\\frac{(x - 1/2)^2}{\\sigma^2}\\right),\n$$\n角度以弧度为单位。\n\n你的程序必须实现具有所述全局化策略的 Newton–Kantorovich 迭代，使用稀疏矩阵表示雅可比矩阵，并使用直接稀疏求解器求解线性系统，必要时回退到最小二乘迭代求解器。初始猜测应为扩展到内部的边界数据：$\\phi(x) \\equiv 1$，$\\alpha(x) \\equiv 1$，$\\beta(x) \\equiv 0$。\n\n测试套件：\n通过改变参数提供三个测试用例以演练不同的情景：\n- 用例 1（顺利路径）：$N = 64$，$a_1 = 0.125$，$a_2 = \\frac{1}{12}$，$a_3 = 0.1$，$b_1 = 0.05$，$b_2 = 0.1$，$c_1 = 0.5$，$c_2 = 0.1$，$c_3 = 0.01$，$K_0 = 0.1$，$K_1 = 0.05$，$s_0 = 0.1$，$s_1 = 0.05$，$r_0 = 0.01$，$\\sigma = 0.15$。\n- 用例 2（强非线性）：$N = 64$，$a_1 = 0.125$，$a_2 = \\frac{1}{12}$，$a_3 = 0.1$，$b_1 = 0.05$，$b_2 = 0.1$，$c_1 = 0.5$，$c_2 = 0.1$，$c_3 = 0.01$，$K_0 = 0.1$，$K_1 = 0.3$，$s_0 = 0.5$，$s_1 = 0.3$，$r_0 = 0.2$，$\\sigma = 0.15$。\n- 用例 3（粗网格和变号曲率的边缘情况）：$N = 32$，$a_1 = 0.125$，$a_2 = \\frac{1}{12}$，$a_3 = 0.1$，$b_1 = 0.05$，$b_2 = 0.1$，$c_1 = 0.5$，$c_2 = 0.1$，$c_3 = 0.01$，$K_0 = -0.05$，$K_1 = 0.2$，$s_0 = 0.2$，$s_1 = 0.15$，$r_0 = 0.05$，$\\sigma = 0.2$。\n\n停止准则：\n对残差范数 $\\|F(U)\\|_2$ 使用容差 $\\varepsilon = 10^{-10}$，最大牛顿迭代次数为 $50$ 次，Armijo 参数 $c = 10^{-4}$，回溯因子 $\\tau = \\frac{1}{2}$，以及最小步长 $\\lambda_{\\min} = 10^{-6}$。每次试验更新后强制执行正性下限 $\\phi_{\\min} = 10^{-8}$。\n\n要求的最终输出格式：\n你的程序应生成单行输出，包含三个测试用例在终止时（收敛或达到迭代限制）的残差范数，格式为方括号内以逗号分隔的列表，例如 $[\\text{result}_1,\\text{result}_2,\\text{result}_3]$。每个条目必须是浮点数。",
            "solution": "所提出的问题是计算物理学中一个有效且适定的任务，具体来说，是广义相对论中数值方法的试验平台。它涉及在有限域上用 Dirichlet 边界条件求解一个由三个耦合的、非线性的、二阶椭圆型常微分方程组成的系统。该系统是扩展共形薄三明治 (XCTS) 方程的简化一维模拟，该方程用于为引力波模拟生成初始数据。所提供的数值策略，即一个用回溯线搜索进行全局化的 Newton-Kantorovich 方法，是解决此类问题的标准且稳健的方法。以下部分详细介绍了其实现的分步过程。\n\n**离散化和系统公式化**\n\n连续域 $x \\in [0, 1]$ 被离散化为 $N$ 个点的均匀网格 $x_i = i h$，其中 $i=0, 1, \\dots, N-1$，网格间距为 $h = 1/(N-1)$。连续未知函数 $\\phi(x)$、$\\alpha(x)$ 和 $\\beta(x)$ 由其在这些网格点上的值表示，记为 $\\phi_i$、$\\alpha_i$ 和 $\\beta_i$。这些离散值被组合成一个大小为 $3N$ 的单一状态向量 $U$：\n$$\nU = [\\phi_0, \\dots, \\phi_{N-1}, \\alpha_0, \\dots, \\alpha_{N-1}, \\beta_0, \\dots, \\beta_{N-1}]^\\top.\n$$\n微分方程组被转换为非线性代数方程组 $F(U) = 0$。对于内部网格点 $i=1, \\dots, N-2$，二阶导数算子使用二阶中心有限差分格式进行近似：\n$$\n\\frac{d^2 u}{dx^2}\\biggr|_{x_i} \\approx \\frac{u_{i-1} - 2 u_i + u_{i+1}}{h^2}.\n$$\n将此应用于三个控制方程，得到内部点的离散残差方程：\n\n对于 $\\phi_i$（残差向量的第 $i$ 个分量，$F_i$）：\n$$\nF_i(U) = -\\frac{\\phi_{i-1} - 2\\phi_i + \\phi_{i+1}}{h^2} + a_1 S_i \\phi_i^{-7} + (a_2 K_i^2 + a_3 \\rho_i) \\phi_i^5 = 0.\n$$\n对于 $\\alpha_i$（残差向量的第 $N+i$ 个分量，$F_{N+i}$）：\n$$\nF_{N+i}(U) = -\\frac{\\alpha_{i-1} - 2\\alpha_i + \\alpha_{i+1}}{h^2} + (c_1 \\phi_i^4 + c_2 K_i^2)\\alpha_i - c_3 \\phi_i^6 = 0.\n$$\n对于 $\\beta_i$（残差向量的第 $2N+i$ 个分量，$F_{2N+i}$）：\n$$\nF_{2N+i}(U) = -\\frac{\\beta_{i-1} - 2\\beta_i + \\beta_{i+1}}{h^2} + b_1 \\left(\\frac{dK}{dx}\\right)_i + b_2 \\phi_i^{-6} \\beta_i = 0.\n$$\n此处，$S_i$、$K_i$、$\\rho_i$ 和 $(dK/dx)_i$ 是预先指定的背景场在网格点 $x_i$ 处的值。\n\n对于边界点（$i=0$ 和 $i=N-1$），Dirichlet 条件被直接作为残差方程强制执行：\n$$\nF_0(U) = \\phi_0 - 1 = 0, \\quad F_{N-1}(U) = \\phi_{N-1} - 1 = 0,\n$$\n$$\nF_N(U) = \\alpha_0 - 1 = 0, \\quad F_{2N-1}(U) = \\alpha_{N-1} - 1 = 0,\n$$\n$$\nF_{2N}(U) = \\beta_0 - 0 = 0, \\quad F_{3N-1}(U) = \\beta_{N-1} - 0 = 0.\n$$\n\n**Newton-Kantorovich 迭代**\n\n非线性系统 $F(U) = 0$ 使用 Newton-Kantorovich 方法进行迭代求解。从初始猜测 $U_0$ 开始，该方法生成一个收敛到解的近似序列 $U_k$。每次迭代都涉及求解一个线性系统以获得更新步长 $\\delta U_k$：\n$$\nJ(U_k) \\delta U_k = -F(U_k),\n$$\n其中 $J(U_k)$ 是在当前迭代点 $U_k$ 处计算的残差向量 $F$ 的雅可比矩阵。雅可比矩阵的元素为 $J_{ij} = \\partial F_i / \\partial U_j$。由于有限差分格式的局部性和耦合性，雅可比矩阵是一个大型但稀疏的矩阵。非零元素的结构如下：\n\n*   **边界行：** 对于对应边界条件的行，雅可比矩阵是单位行，即 $J_{p,p} = 1$ 且对于 $q \\ne p$ 有 $J_{p,q}=0$，其中 $p$ 是边界变量的索引。例如，对于 $F_0 = \\phi_0 - 1$，$J$ 的第一行有 $J_{0,0}=1$，所有其他元素均为零。\n\n*   **内部行（对于 $i \\in \\{1, \\dots, N-2\\}$）：**\n    *   **$\\phi$-方程（行 $i$）：**\n        *   $\\frac{\\partial F_i}{\\partial \\phi_{i-1}} = -1/h^2$\n        *   $\\frac{\\partial F_i}{\\partial \\phi_i} = 2/h^2 - 7a_1 S_i \\phi_i^{-8} + 5(a_2 K_i^2 + a_3 \\rho_i) \\phi_i^4$\n        *   $\\frac{\\partial F_i}{\\partial \\phi_{i+1}} = -1/h^2$\n    *   **$\\alpha$-方程（行 $N+i$）：**\n        *   $\\frac{\\partial F_{N+i}}{\\partial \\phi_i} = 4c_1 \\phi_i^3 \\alpha_i - 6c_3 \\phi_i^5$\n        *   $\\frac{\\partial F_{N+i}}{\\partial \\alpha_{i-1}} = -1/h^2$\n        *   $\\frac{\\partial F_{N+i}}{\\partial \\alpha_i} = 2/h^2 + c_1 \\phi_i^4 + c_2 K_i^2$\n        *   $\\frac{\\partial F_{N+i}}{\\partial \\alpha_{i+1}} = -1/h^2$\n    *   **$\\beta$-方程（行 $2N+i$）：**\n        *   $\\frac{\\partial F_{2N+i}}{\\partial \\phi_i} = -6b_2 \\phi_i^{-7} \\beta_i$\n        *   $\\frac{\\partial F_{2N+i}}{\\partial \\beta_{i-1}} = -1/h^2$\n        *   $\\frac{\\partial F_{2N+i}}{\\partial \\beta_i} = 2/h^2 + b_2 \\phi_i^{-6}$\n        *   $\\frac{\\partial F_{2N+i}}{\\partial \\beta_{i+1}} = -1/h^2$\n\n所有其他偏导数均为零。这定义了一个块矩阵结构，其中对角块是三对角的，一些非对角块是对角的。利用稀疏矩阵数据结构和线性求解器来利用这种稀疏结构。\n\n**全局化和正则化**\n\n原始的牛顿步长 $\\delta U_k$ 不能保证残差的减小，特别是当远离解时。需要一个全局化策略。采用回溯线搜索来为更新找到一个合适的步长 $\\lambda \\in (0,1]$：\n$$\nU_{k+1} = U_k + \\lambda \\delta U_k.\n$$\n选择步长 $\\lambda$ 以满足价值函数 $\\Phi(U) = \\frac{1}{2}\\|F(U)\\|_2^2$ 上的 Armijo 充分下降条件。该条件是：\n$$\n\\Phi(U_k + \\lambda \\delta U_k) \\le \\Phi(U_k) + c \\lambda \\nabla\\Phi(U_k)^\\top \\delta U_k,\n$$\n其中 $c$ 是一个小常数（此处为 $c=10^{-4}$）。方向导数 $\\nabla\\Phi(U_k)^\\top \\delta U_k$ 简化为 $-F(U_k)^\\top J(U_k) J(U_k)^{-1} F(U_k) = -\\|F(U_k)\\|_2^2$。因此，条件变为：\n$$\n\\Phi(U_{k+1}^{\\text{trial}}) \\le \\Phi(U_k) - c \\lambda \\|F(U_k)\\|_2^2.\n$$\n对 $\\lambda$ 的搜索从 $\\lambda=1$ 开始，并以因子 $\\tau = 1/2$ 递减，直到条件满足或达到最小步长 $\\lambda_{\\min}$。\n\n此外，问题的物理性质要求共形因子为正，$\\phi(x) > 0$。像 $\\phi^{-7}$ 和 $\\phi^{-8}$ 这样的项的存在使得系统在 $\\phi \\to 0$ 时是奇异的。为了防止迭代进入这个非物理且数值不稳定的区域，在每次试验更新后，通过将任何低于下限值 $\\phi_{\\min} = 10^{-8}$ 的 $\\phi_i$ 值投影回下限值来强制执行正性约束：$\\phi_i \\leftarrow \\max(\\phi_i, \\phi_{\\min})$。\n\n**算法摘要**\n\n完整的算法过程如下：\n1.  **初始化：** 对于给定的参数集，构建网格 $x_i$ 并计算背景场 $S_i, K_i, \\rho_i, (dK/dx)_i$。用 $\\phi_i \\equiv 1$、$\\alpha_i \\equiv 1$ 和 $\\beta_i \\equiv 0$ 初始化状态向量 $U_0$。\n2.  **迭代：** 对于 $k = 0, 1, \\dots, \\text{max\\_iterations}-1$：\n    a. 计算残差向量 $F(U_k)$ 及其欧几里得范数 $\\|F(U_k)\\|_2$。\n    b. 检查收敛性：如果 $\\|F(U_k)\\|_2  \\varepsilon$，则终止并报告成功。\n    c. 计算稀疏雅可比矩阵 $J(U_k)$。\n    d. 求解线性系统 $J(U_k) \\delta U_k = -F(U_k)$ 以找到牛顿步长 $\\delta U_k$。使用直接稀疏求解器，并为了稳健性回退到迭代最小二乘求解器。\n    e. 执行回溯线搜索以找到可接受的步长 $\\lambda$。\n    f. 更新解：$U_{k+1} = U_k + \\lambda \\delta U_k$。\n    g. 强制正性：对于每个 $i$，设置 $\\phi_i \\leftarrow \\max(\\phi_i, \\phi_{\\min})$。\n3.  **终止：** 如果循环因达到最大迭代次数而结束，则过程终止，并报告最终的残差范数。\n\n将此过程应用于问题陈述中指定的三个测试用例中的每一个，以获得所需的最终结果。",
            "answer": "```python\nimport numpy as np\nfrom scipy import sparse\nfrom scipy.sparse.linalg import spsolve, lsqr\n\ndef compute_residual(U, N, h, p):\n    \"\"\"Computes the nonlinear residual vector F(U).\"\"\"\n    phi = U[0:N]\n    alpha = U[N:2*N]\n    beta = U[2*N:3*N]\n    F = np.zeros(3 * N)\n    \n    # Unpack parameters\n    a1, a2, a3 = p['a1'], p['a2'], p['a3']\n    b1, b2 = p['b1'], p['b2']\n    c1, c2, c3 = p['c1'], p['c2'], p['c3']\n    S, K, dKdx, rho = p['S_vals'], p['K_vals'], p['dKdx_vals'], p['rho_vals']\n    h2 = h**2\n\n    # Interior points\n    for i in range(1, N - 1):\n        # Phi equation\n        lap_phi = (phi[i-1] - 2 * phi[i] + phi[i+1]) / h2\n        F[i] = -lap_phi + a1 * S[i] * phi[i]**-7 + (a2 * K[i]**2 + a3 * rho[i]) * phi[i]**5\n        \n        # Beta equation\n        lap_beta = (beta[i-1] - 2 * beta[i] + beta[i+1]) / h2\n        F[2*N + i] = -lap_beta + b1 * dKdx[i] + b2 * phi[i]**-6 * beta[i]\n\n        # Alpha equation\n        lap_alpha = (alpha[i-1] - 2 * alpha[i] + alpha[i+1]) / h2\n        F[N + i] = -lap_alpha + (c1 * phi[i]**4 + c2 * K[i]**2) * alpha[i] - c3 * phi[i]**6\n        \n    # Boundary conditions\n    F[0] = phi[0] - 1.0\n    F[N-1] = phi[N-1] - 1.0\n    F[N] = alpha[0] - 1.0\n    F[2*N-1] = alpha[N-1] - 1.0\n    F[2*N] = beta[0] - 0.0\n    F[3*N-1] = beta[N-1] - 0.0\n\n    return F\n\ndef run_newton_solver(params):\n    \"\"\"\n    Solves the 1D non-linear elliptic system using a Newton-Kantorovich method.\n    \"\"\"\n    # Unpack general parameters\n    N = params['N']\n    tol = params['tol']\n    max_iter = params['max_iter']\n    armijo_c = params['armijo_c']\n    backtrack_tau = params['backtrack_tau']\n    min_lambda = params['min_lambda']\n    phi_min = params['phi_min']\n\n    # Grid setup\n    x = np.linspace(0, 1, N)\n    h = 1.0 / (N - 1)\n    h2 = h**2\n    \n    # Evaluate background fields\n    K0, K1, s0, s1, r0, sigma = params['K0'], params['K1'], params['s0'], params['s1'], params['r0'], params['sigma']\n    params['S_vals'] = s0 + s1 * np.sin(2 * np.pi * x)\n    params['K_vals'] = K0 + K1 * np.sin(np.pi * x)\n    params['dKdx_vals'] = K1 * np.pi * np.cos(np.pi * x)\n    params['rho_vals'] = r0 * np.exp(-(x - 0.5)**2 / sigma**2)\n\n    # Initial guess\n    U = np.zeros(3 * N)\n    U[0:N] = 1.0      # phi\n    U[N:2*N] = 1.0    # alpha\n    U[2*N:3*N] = 0.0  # beta\n\n    # Unpack physics parameters\n    a1, a2, a3 = params['a1'], params['a2'], params['a3']\n    b1, b2 = params['b1'], params['b2']\n    c1, c2, c3 = params['c1'], params['c2'], params['c3']\n    S, K, dKdx, rho = params['S_vals'], params['K_vals'], params['dKdx_vals'], params['rho_vals']\n    \n    final_res_norm = -1.0\n    for k in range(max_iter):\n        F = compute_residual(U, N, h, params)\n        res_norm = np.linalg.norm(F)\n        final_res_norm = res_norm\n\n        if res_norm  tol:\n            break\n\n        # Assemble Jacobian\n        J = sparse.lil_matrix((3 * N, 3 * N))\n        phi, alpha, beta = U[0:N], U[N:2*N], U[2*N:3*N]\n\n        for i in range(1, N - 1):\n            # Phi equation row (index i)\n            J[i, i-1] = -1.0 / h2\n            J[i, i] = 2.0 / h2 - 7 * a1 * S[i] * phi[i]**-8 + 5 * (a2 * K[i]**2 + a3 * rho[i]) * phi[i]**4\n            J[i, i+1] = -1.0 / h2\n            \n            # Beta equation row (index 2N+i)\n            J[2*N + i, 2*N + i-1] = -1.0 / h2\n            J[2*N + i, 2*N + i] = 2.0 / h2 + b2 * phi[i]**-6\n            J[2*N + i, 2*N + i+1] = -1.0 / h2\n            J[2*N + i, i] = -6 * b2 * phi[i]**-7 * beta[i]\n\n            # Alpha equation row (index N+i)\n            J[N + i, N + i-1] = -1.0 / h2\n            J[N + i, N + i] = 2.0 / h2 + c1 * phi[i]**4 + c2 * K[i]**2\n            J[N + i, N + i+1] = -1.0 / h2\n            J[N + i, i] = 4 * c1 * phi[i]**3 * alpha[i] - 6 * c3 * phi[i]**5\n        \n        # Boundary rows in Jacobian\n        J[0, 0] = J[N-1, N-1] = 1.0\n        J[N, N] = J[2*N-1, 2*N-1] = 1.0\n        J[2*N, 2*N] = J[3*N-1, 3*N-1] = 1.0\n        \n        J_csc = J.tocsc()\n        \n        # Solve linear system\n        try:\n            dU = spsolve(J_csc, -F)\n            if np.any(np.isnan(dU)):\n                raise np.linalg.LinAlgError(\"NaNs in solution from spsolve\")\n        except (np.linalg.LinAlgError, RuntimeError):\n            # Fallback to least-squares iterative solver\n            dU = lsqr(J_csc, -F)[0]\n        \n        # Backtracking line search\n        lambda_ = 1.0\n        merit_k = 0.5 * res_norm**2\n        search_dir_dot_grad = -res_norm**2\n        \n        while lambda_ > min_lambda:\n            U_trial = U + lambda_ * dU\n            # Enforce positivity on phi\n            phi_trial = U_trial[0:N]\n            phi_trial[phi_trial  phi_min] = phi_min\n            U_trial[0:N] = phi_trial\n\n            F_trial = compute_residual(U_trial, N, h, params)\n            merit_trial = 0.5 * np.linalg.norm(F_trial)**2\n            \n            if merit_trial = merit_k + armijo_c * lambda_ * search_dir_dot_grad:\n                break\n            \n            lambda_ *= backtrack_tau\n        \n        U = U + lambda_ * dU\n        # Final enforcement of positivity after step\n        U[0:N][U[0:N]  phi_min] = phi_min\n\n    return final_res_norm\n\ndef solve():\n    # Define solver settings\n    solver_settings = {\n        'tol': 1e-10,\n        'max_iter': 50,\n        'armijo_c': 1e-4,\n        'backtrack_tau': 0.5,\n        'min_lambda': 1e-6,\n        'phi_min': 1e-8\n    }\n    \n    # Define test cases\n    test_cases = [\n        # Case 1\n        {**solver_settings, 'N': 64, 'a1': 0.125, 'a2': 1.0/12.0, 'a3': 0.1, 'b1': 0.05, 'b2': 0.1, \n         'c1': 0.5, 'c2': 0.1, 'c3': 0.01, 'K0': 0.1, 'K1': 0.05, 's0': 0.1, 's1': 0.05, 'r0': 0.01, 'sigma': 0.15},\n        # Case 2\n        {**solver_settings, 'N': 64, 'a1': 0.125, 'a2': 1.0/12.0, 'a3': 0.1, 'b1': 0.05, 'b2': 0.1,\n         'c1': 0.5, 'c2': 0.1, 'c3': 0.01, 'K0': 0.1, 'K1': 0.3, 's0': 0.5, 's1': 0.3, 'r0': 0.2, 'sigma': 0.15},\n        # Case 3\n        {**solver_settings, 'N': 32, 'a1': 0.125, 'a2': 1.0/12.0, 'a3': 0.1, 'b1': 0.05, 'b2': 0.1,\n         'c1': 0.5, 'c2': 0.1, 'c3': 0.01, 'K0': -0.05, 'K1': 0.2, 's0': 0.2, 's1': 0.15, 'r0': 0.05, 'sigma': 0.2},\n    ]\n\n    results = []\n    for case in test_cases:\n        final_norm = run_newton_solver(case)\n        results.append(final_norm)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}