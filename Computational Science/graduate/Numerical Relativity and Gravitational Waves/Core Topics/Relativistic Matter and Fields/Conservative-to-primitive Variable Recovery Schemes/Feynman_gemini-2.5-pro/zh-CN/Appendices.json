{
    "hands_on_practices": [
        {
            "introduction": "在解决从守恒量恢复原始变量这一复杂的逆问题之前，我们必须首先掌握“正向”变换。这个练习将通过在简化的时空中使用3+1分解，从基本原始变量（$\\rho, v^i, \\epsilon$）构建守恒变量（$D, S_i, \\tau$），从而巩固你的理解。通过从第一性原理出发推导这些关系并将其应用于一个具体例子，你将为后续更高级的数值格式建立坚实的基础。",
            "id": "3468862",
            "problem": "在应用于引力波源建模的数值相对论的计算广义相对论流体动力学中，瓦伦西亚格式 (Valencia formulation) 根据时空的 $3+1$ 分解以及在欧拉观测者上的投影，以守恒变量的形式重写了理想流体方程。考虑一个在狭义相对论闵可夫斯基时空中的均匀流体元，其度规为 $g_{\\mu\\nu}=\\mathrm{diag}(-1,1,1,1)$，lapse 函数为 $\\alpha=1$，shift 向量为 $\\beta^{i}=0$，空间度规为 $\\gamma_{ij}=\\delta_{ij}$。该流体由其静质量密度 $\\rho$、比内能 $\\epsilon$、由欧拉观测者测量的空间三维速度 $v^{i}$ 以及理想气体状态方程 (EOS) $p=(\\Gamma-1)\\rho\\,\\epsilon$ 来描述，其中 $p$ 是压强，$\\Gamma$ 是绝热指数。比焓定义为 $h=1+\\epsilon+\\frac{p}{\\rho}$，与三维速度相关的洛伦兹因子为 $W=(1-v^{2})^{-1/2}$，其中 $v^{2}=\\gamma_{ij}v^{i}v^{j}$。\n\n仅从静质量流 $J^{\\mu}=\\rho\\,u^{\\mu}$、理想流体应力-能量张量 $T^{\\mu\\nu}=\\rho\\,h\\,u^{\\mu}u^{\\nu}+p\\,g^{\\mu\\nu}$ 以及使用欧拉观测者 $n^{\\mu}$ 的 $3+1$ 分解的基本定义出发，推导瓦伦西亚守恒变量在闵可夫斯基时空中的表达式，然后为以下原始数据计算它们的值：\n- $\\rho=1$,\n- $v^{i}=(0.3,\\,0,\\,0)$,\n- $\\epsilon=0.5$,\n- $\\Gamma=2$.\n\n在你的推导中，请明确展示计算洛伦兹因子 $W$、压强 $p$ 和比焓 $h$ 的中间步骤，然后再计算由静质量密度 $D$、动量密度 $S_{i}$ 和能量变量 $\\tau$ 组成的守恒三元组。将你的最终数值 $D$、$S_{x}$、$S_{y}$、$S_{z}$ 和 $\\tau$ 四舍五入到六位有效数字。最终答案以几何单位制（光速 $c=1$、牛顿常数 $G=1$）表示，并将这五个量以 $(D,\\,S_{x},\\,S_{y},\\,S_{z},\\,\\tau)$ 的顺序列为单个行向量。",
            "solution": "该问题要求在一个简化的平直时空设置中推导瓦伦西亚守恒变量，并随后为一组给定的原始流体变量计算这些变量的值。对问题陈述的验证发现，其具有科学依据、适定且客观，并为得出唯一解提供了所有必要信息。\n\n首先，我们建立框架。问题设置在闵可夫斯基时空中，度规由 $g_{\\mu\\nu}=\\mathrm{diag}(-1,1,1,1)$ 给出，因此 $g^{\\mu\\nu}=\\mathrm{diag}(-1,1,1,1)$。$3+1$ 分解是平凡的，lapse 函数为 $\\alpha=1$，shift 向量为零 $\\beta^{i}=0$，空间度规为平直的 $\\gamma_{ij}=\\delta_{ij}$。这意味着空间度规的行列式为 $\\gamma = \\det(\\gamma_{ij}) = 1$。在该坐标系中静止的欧拉观测者，其四维速度为 $n^{\\mu} = (1/\\alpha, -\\beta^i/\\alpha) = (1,0,0,0)$。对应的协变矢量为 $n_{\\mu} = g_{\\mu\\nu}n^{\\nu} = (-1,0,0,0)$。\n\n流体的四维速度 $u^{\\mu}$ 通过洛伦兹因子 $W$ 与欧拉观测者测量的三维速度 $v^{i}$ 相关。其分量为 $u^{\\mu} = W(1, v^1, v^2, v^3)$。洛伦兹因子定义为 $W=(1-v^{2})^{-1/2}$，其中 $v^{2} = \\gamma_{ij}v^{i}v^{j}$。该定义正确地归一化了四维速度，因为 $u^{\\mu}u_{\\mu} = g_{\\mu\\nu}u^{\\mu}u^{\\nu} = W^2(-1 + v^2) = (1-v^2)^{-1}(-1+v^2) = -1$。\n\n瓦伦西亚守恒变量（$D$, $S_i$, $\\tau$）是通过使用欧拉观测者的四维速度 $n^\\mu$ 和空间度规 $\\gamma_{ij}$ 投影基本的相对论流体动力学张量——静质量流 $J^{\\mu}$ 和应力-能量张量 $T^{\\mu\\nu}$——来定义的。\n\n1.  **守恒静质量密度 $D$ 的推导**：\n    $D$ 定义为欧拉观测者测量的静质量密度，并按空间度规行列式的平方根 $\\sqrt{\\gamma}$ 进行缩放。它是通过将静质量流 $J^{\\mu}=\\rho\\,u^{\\mu}$ 沿法向量方向 $n_{\\mu}$ 投影得到的：\n    $$D = -\\sqrt{\\gamma} n_{\\mu} J^{\\mu}$$\n    在我们简化的时空中代入已知量（$\\sqrt{\\gamma}=1$, $n_{\\mu}=(-1,0,0,0)$ 和 $J^{\\mu}=\\rho W(1, v^i)$）：\n    $$D = -1 \\cdot [(-1)(\\rho W) + (0)(\\rho W v^1) + (0)(\\rho W v^2) + (0)(\\rho W v^3)] = \\rho W$$\n\n2.  **守恒动量密度 $S_i$ 的推导**：\n    $S_i$ 是欧拉观测者测量的动量密度。它是通过将应力-能量张量 $T^{\\mu\\nu}$ 沿观测者世界线的方向投影到空间超曲面上得到的。理想流体的应力-能量张量是 $T^{\\mu\\nu}=\\rho\\,h\\,u^{\\mu}u^{\\nu}+p\\,g^{\\mu\\nu}$，其中 $h$ 是比焓，$p$ 是压强。\n    $S_i$ 的定义是：\n    $$S_i = \\alpha \\sqrt{\\gamma} \\, T_{i\\mu} n^{\\mu}$$\n    在我们的例子中，$\\alpha=1$ 且 $\\sqrt{\\gamma}=1$。分量 $T_{i\\mu}$ 是 $T_{i\\mu}=g_{i\\nu}T^{\\nu\\mu} = \\delta_{i\\nu}T^{\\nu\\mu} = T^{i\\mu}$。当 $n^{\\mu}=(1,0,0,0)$ 时，表达式简化为：\n    $$S_i = T^{i0}$$\n    现在我们计算应力-能量张量的 $T^{i0}$ 分量：\n    $$T^{i0} = \\rho h u^i u^0 + p g^{i0}$$\n    因为 $g^{i0}=0$，并且我们有 $u^i = W v^i$ 和 $u^0 = W$，所以这变为：\n    $$S_i = \\rho h (W v^i) (W) = \\rho h W^2 v^i$$\n    由于空间度规是笛卡尔度规，协变分量 $v_i = \\gamma_{ij}v^j = \\delta_{ij}v^j$ 在数值上与逆变分量 $v^i$ 相同。因此，我们可以写作 $S_i = \\rho h W^2 v_i$。\n\n3.  **守恒能量变量 $\\tau$ 的推导**：\n    $\\tau$ 表示欧拉观测者测量的总能量密度减去静质量能量密度 $D$。总能量密度 $E$ 是通过将 $T^{\\mu\\nu}$ 沿 $n_{\\mu}$ 进行两次投影得到的：\n    $$E = \\alpha^2 \\sqrt{\\gamma} T^{\\mu\\nu} n_{\\mu} n_{\\nu}$$\n    变量 $\\tau$ 随后定义为 $\\tau = E - D$。当 $\\alpha=1$ 且 $\\sqrt{\\gamma}=1$ 时：\n    $$E = T^{\\mu\\nu}n_{\\mu}n_{\\nu} = T^{00}(-1)(-1) = T^{00}$$\n    我们计算 $T^{00}$ 分量：\n    $$T^{00} = \\rho h u^0 u^0 + p g^{00} = \\rho h W^2 - p$$\n    因此，$\\tau$ 的表达式为：\n    $$\\tau = E - D = (\\rho h W^2 - p) - \\rho W$$\n\n现在我们继续为给定的原始数据计算这些量：$\\rho=1$、$v^{i}=(0.3,\\,0,\\,0)$、$\\epsilon=0.5$ 和 $\\Gamma=2$。\n\n首先，我们计算中间量：\n-   三维速度的大小平方为 $v^2 = \\gamma_{ij}v^{i}v^{j} = \\delta_{ij}v^{i}v^{j} = (0.3)^2 + 0^2 + 0^2 = 0.09$。\n-   洛伦兹因子为 $W = (1-v^2)^{-1/2} = (1-0.09)^{-1/2} = (0.91)^{-1/2} \\approx 1.0482848367$。\n-   压强 $p$ 由理想气体状态方程给出：$p = (\\Gamma-1)\\rho\\,\\epsilon = (2-1)(1)(0.5) = 0.5$。\n-   比焓 $h$ 为 $h = 1+\\epsilon+\\frac{p}{\\rho} = 1+0.5+\\frac{0.5}{1} = 2.0$。\n\n使用这些值，我们计算守恒变量：\n-   静质量密度 $D$：\n    $$D = \\rho W = 1 \\times (0.91)^{-1/2} \\approx 1.0482848367$$\n    四舍五入到六位有效数字，$D \\approx 1.04828$。\n\n-   动量密度 $S_i$：我们需要计算 $S_x$、$S_y$ 和 $S_z$。\n    $$S_i = \\rho h W^2 v_i = (1)(2.0)(0.91)^{-1} v_i = \\frac{2}{0.91}v_i$$\n    对于 $S_x = S_1$：\n    $$S_x = \\frac{2}{0.91} \\times 0.3 = \\frac{0.6}{0.91} \\approx 0.6593406593$$\n    四舍五入到六位有效数字，$S_x \\approx 0.659341$。\n    对于 $S_y = S_2$ 和 $S_z = S_3$，由于 $v_y=0$ 和 $v_z=0$：\n    $$S_y = 0$$\n    $$S_z = 0$$\n\n-   能量变量 $\\tau$：\n    $$\\tau = \\rho h W^2 - p - D = (1)(2.0)(0.91)^{-1} - 0.5 - 1.0482848367$$\n    $$\\tau = \\frac{2}{0.91} - 0.5 - (0.91)^{-1/2} \\approx 2.1978021978 - 0.5 - 1.0482848367$$\n    $$\\tau \\approx 0.6495173611$$\n    四舍五入到六位有效数字，$\\tau \\approx 0.649517$。\n\n最终计算出的守恒变量，四舍五入到六位有效数字，是：\n$D \\approx 1.04828$\n$S_x \\approx 0.659341$\n$S_y = 0$\n$S_z = 0$\n$\\tau \\approx 0.649517$",
            "answer": "$$ \\boxed{ \\begin{pmatrix} 1.04828,  0.659341,  0,  0,  0.649517 \\end{pmatrix} } $$"
        },
        {
            "introduction": "尽管通用的恢复格式可能很复杂，但某些物理假设可以催生出高度简化且稳健的算法。本练习将探讨“冷”多方气体状态方程的情况，在这种情况下，恢复问题可以巧妙地简化为求解一个关于洛伦兹因子 $W$ 的单调方程。你不仅需要推导此关系，还要证明其单调性，这为使用像二分法这样简单而强大的数值方法提供了理论依据。这个练习  将教你如何利用物理简化来提高数值效率，并引入一种实用的诊断工具来检验模型假设的适用范围，例如在出现激波加热时。",
            "id": "3468855",
            "problem": "考虑平直时空中的狭义相对论流体力学瓦伦西亚格式，其中光速设为1。设守恒变量由静止质量密度 $D = \\rho W$、动量密度 $S_i = \\rho h W^2 v_i$ 和能量变量 $\\tau = \\rho h W^2 - p - D$ 定义，其中 $\\rho$ 是静止质量密度，$p$ 是压强，$v_i$ 是三维速度的空间分量，其大小的平方为 $v^2 = v_i v^i$，$W = 1/\\sqrt{1 - v^2}$ 是洛伦兹因子，$h = 1 + \\epsilon + p/\\rho$ 是比焓，$\\epsilon$ 是比内能。假设采用冷多方物态方程 (EOS) $p = K \\rho^\\Gamma$ 以及冷假设 $\\epsilon = p/((\\Gamma - 1)\\rho)$，其中 $K  0$ 和 $\\Gamma  1$ 是常数。所有量在几何单位制中都是无量纲的。\n\n您的任务如下。\n\n1) 从上述定义出发，仅使用冷多方物态方程，将所有原初变量表示为 $W$ 和 $D$ 的函数。然后，推导一个关于单一未知数 $W$ 的显式标量方程，该方程强制与动量大小保持一致，即对于给定的 $D$ 和 $S^2 = \\delta^{ij} S_i S_j$，该方程的根是物理上的 $W$。证明对于任何固定的 $D  0$、$K  0$ 和 $\\Gamma \\in (1, 2]$，这个标量方程定义了一个在 $W \\in [1, \\infty)$ 上的严格递增函数，从而确保解的存在性和唯一性。您的推导必须仅依赖于给定的定义、冷物态方程的规范以及恒等式 $v^2 = 1 - 1/W^2$。不要假设任何非由这些基本原理推导出的辅助公式。\n\n2) 基于您的推导，设计一个鲁棒的数值算法。给定 $(D, S^2, \\tau, K, \\Gamma)$，该算法通过首先使用区间套和二分法求解关于 $W$ 的一维方程来恢复原初变量。然后，在冷物态方程的假设下，计算 $\\rho = D/W$、$p = K \\rho^\\Gamma$ 和 $\\tau_{\\text{pred}} = \\rho h W^2 - p - D$。使用 $\\tau_{\\text{pred}}$ 与给定 $\\tau$ 的比较作为诊断冷物态方程被违背（例如，激波加热）的指标。如果 $|\\tau - \\tau_{\\text{pred}}|$ 超过一个小的数值容差，则定义一个布尔诊断量 $\\text{breakdown} = \\text{True}$，否则为 $\\text{False}$。\n\n3) 将该算法实现为一个完整、可运行的程序。对于下面的每个测试用例，计算恢复的洛伦兹因子 $W$ 和击穿诊断。报告每个 $W$ 值，四舍五入到八位小数。使用以下常数和测试套件：\n- 对所有情况使用 $\\Gamma = 2.0$ 和 $K = 1.0$。\n- 测试用例 A (正常路径)：选择 $\\rho = 1.0 \\times 10^{-3}$ 和大小为 $v = 0.3$ 的一维速度。根据这些原初变量，使用定义计算 $D$、$S^2$ 和 $\\tau$。\n- 测试用例 B (边界情况，动量为零)：选择 $\\rho = 1.0 \\times 10^{-2}$ 和 $v = 0.0$。根据这些原初变量，计算 $D$、$S^2$ 和 $\\tau$。\n- 测试用例 C (超相对论性)：选择 $\\rho = 1.0 \\times 10^{-3}$ 和 $v = 0.99$。根据这些原初变量，计算 $D$、$S^2$ 和 $\\tau$。\n- 测试用例 D (激波加热违背)：重用测试用例 A 中计算的守恒变量，但将 $\\tau$ 替换为 $\\tau + \\Delta$，其中 $\\Delta = 0.05$。\n\n您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个测试用例对应一个包含两个元素的列表 $[W,\\text{breakdown}]$。例如，一个包含两个假设结果的有效输出看起来像 `[[1.23456789,False],[2.34567890,True]]`。确保打印的 $W$ 值四舍五入到八位小数，并且布尔值为不带引号的形式。",
            "solution": "该问题要求在冷多方物态方程的假设下，推导并实现一个用于狭义相对论流体力学的从守恒量到原初变量的恢复方案。这个过程涉及两个主要任务：首先，推导一个关于洛伦兹因子 $W$ 的单标量方程，并证明其解的存在性和唯一性；其次，设计并实现一个数值算法来求解该方程并计算一个诊断量。\n\n让我们首先形式化原初变量 $(\\rho, v_i, \\epsilon, p)$ 和守恒变量 $(D, S_i, \\tau)$ 之间的关系。给定的定义是：\n- 静止质量密度：$D = \\rho W$\n- 动量密度：$S_i = \\rho h W^2 v_i$\n- 能量变量：$\\tau = \\rho h W^2 - p - D$\n\n这里，$\\rho$ 是静止质量密度，$p$ 是压强，$v_i$ 是三维速度，$W = (1 - v^2)^{-1/2}$ 是洛伦兹因子，其中 $v^2 = \\delta^{ij}v_i v_j$，$h$ 是比焓。\n该系统通过冷多方物态方程 (EOS) 来闭合：\n- 压强：$p = K \\rho^\\Gamma$\n- 比内能：$\\epsilon = \\frac{p}{(\\Gamma - 1)\\rho}$\n\n比焓 $h$ 定义为 $h = 1 + \\epsilon + p/\\rho$。使用冷物态方程，我们可以将 $h$ 表示为 $\\rho$ 的函数：\n$$h = 1 + \\frac{p}{(\\Gamma - 1)\\rho} + \\frac{p}{\\rho} = 1 + \\left(\\frac{1}{\\Gamma-1} + 1\\right)\\frac{p}{\\rho} = 1 + \\frac{\\Gamma}{\\Gamma-1}\\frac{p}{\\rho}$$\n代入 $p$ 的表达式：\n$$h = 1 + \\frac{\\Gamma K \\rho^\\Gamma}{(\\Gamma-1)\\rho} = 1 + \\frac{\\Gamma K}{\\Gamma-1} \\rho^{\\Gamma-1}$$\n这个方程将比焓与静止质量密度联系起来。\n\n我们的第一个目标是利用已知量 $D$ 和 $S^2 = \\delta^{ij}S_i S_j$ 来推导一个关于 $W$ 的标量方程。为此，我们将所有原初变量表示为 $D$ 和 $W$ 的函数。\n根据 $D$ 的定义，我们立即得到：\n$$\\rho = \\frac{D}{W}$$\n将此代入 $p$ 和 $h$ 的表达式中：\n$$p = K \\left(\\frac{D}{W}\\right)^\\Gamma$$\n$$h = 1 + \\frac{\\Gamma K}{\\Gamma-1} \\left(\\frac{D}{W}\\right)^{\\Gamma-1}$$\n现在，我们考虑动量密度的平方大小 $S^2$：\n$$S^2 = \\delta^{ij}S_i S_j = (\\rho h W^2)^2 \\delta^{ij}v_i v_j = (\\rho h W^2)^2 v^2$$\n使用恒等式 $v^2 = 1 - 1/W^2 = (W^2 - 1)/W^2$，我们得到：\n$$S^2 = (\\rho h W^2)^2 \\frac{W^2-1}{W^2} = (\\rho h)^2 W^2 (W^2-1)$$\n现在，我们将 $\\rho$ 和 $h$ 的表达式（用 $D$ 和 $W$ 表示）代入：\n$$S^2 = \\left(\\frac{D}{W} \\left(1 + \\frac{\\Gamma K}{\\Gamma-1} \\left(\\frac{D}{W}\\right)^{\\Gamma-1}\\right)\\right)^2 W^2 (W^2-1)$$\n$$S^2 = \\frac{D^2}{W^2} \\left(1 + \\frac{\\Gamma K D^{\\Gamma-1}}{(\\Gamma-1)W^{\\Gamma-1}}\\right)^2 W^2 (W^2-1)$$\n这简化为我们所期望的关于 $W$ 的标量方程：\n$$S^2 = D^2 (W^2 - 1) \\left(1 + \\frac{\\Gamma K D^{\\Gamma-1}}{(\\Gamma-1)W^{\\Gamma-1}}\\right)^2$$\n让我们将函数 $F(W)$ 定义为该方程的右侧：\n$$F(W) = D^2 (W^2 - 1) \\left(1 + C W^{1-\\Gamma}\\right)^2$$\n其中 $C = \\frac{\\Gamma K D^{\\Gamma-1}}{\\Gamma-1}$ 对于 $D0$、$K0$ 和 $\\Gamma1$ 是一个正常数。问题现在简化为在 $W \\in [1, \\infty)$ 区间内寻找 $F(W)-S^2=0$ 的根。\n\n接下来，我们必须证明对于任何固定的 $D  0$、$K  0$ 和 $\\Gamma \\in (1, 2]$，$F(W)$ 在 $W \\in [1, \\infty)$ 上是 $W$ 的一个严格递增函数。这将保证对于任何给定的 $S^2 \\ge 0$，$W$ 的唯一解存在。\n我们计算 $F(W)$ 关于 $W$ 的导数（对于 $W1$）：\n$$F'(W) = \\frac{d}{dW} \\left[ D^2 (W^2 - 1) \\left(1 + C W^{1-\\Gamma}\\right)^2 \\right]$$\n使用乘法法则，设 $u(W) = W^2 - 1$ 和 $v(W) = (1 + C W^{1-\\Gamma})^2$：\n$$u'(W) = 2W$$\n$$v'(W) = 2(1 + C W^{1-\\Gamma}) \\cdot C(1-\\Gamma)W^{-\\Gamma} = -2C(\\Gamma-1)W^{-\\Gamma}(1 + C W^{1-\\Gamma})$$\n$$F'(W) = D^2 [u'v + uv'] = D^2 \\left[ 2W(1 + C W^{1-\\Gamma})^2 - (W^2 - 1) \\cdot 2C(\\Gamma-1)W^{-\\Gamma}(1 + C W^{1-\\Gamma}) \\right]$$\n提取公因式 $2D^2(1 + C W^{1-\\Gamma})$：\n$$F'(W) = 2D^2(1 + C W^{1-\\Gamma}) \\left[ W(1 + C W^{1-\\Gamma}) - (W^2 - 1)C(\\Gamma-1)W^{-\\Gamma} \\right]$$\n让我们分析在 $W1$、$D0$、$K0$ 和 $\\Gamma \\in (1,2]$ 条件下每一项的符号。\n前置因子 $2D^2(1 + C W^{1-\\Gamma})$ 是严格为正的，因为 $C0$ 且 $W^{1-\\Gamma}0$。\n我们检查方括号中的项：\n$$ \\text{Bracket term} = W + C W^{2-\\Gamma} - C(\\Gamma-1)W^{2-\\Gamma} + C(\\Gamma-1)W^{-\\Gamma} $$\n$$ = W + C(1 - (\\Gamma-1))W^{2-\\Gamma} + C(\\Gamma-1)W^{-\\Gamma} $$\n$$ = W + C(2-\\Gamma)W^{2-\\Gamma} + C(\\Gamma-1)W^{-\\Gamma} $$\n我们分析这个和中的每一项：\n1.  $W$：严格为正，因为 $W1$。\n2.  $C(2-\\Gamma)W^{2-\\Gamma}$：由于 $\\Gamma \\le 2$，我们有 $2-\\Gamma \\ge 0$。因为 $C0$ 且 $W0$，所以此项为非负。\n3.  $C(\\Gamma-1)W^{-\\Gamma}$：由于 $\\Gamma  1$，我们有 $\\Gamma-1  0$。因为 $C0$ 且 $W0$，所以此项严格为正。\n\n一个严格为正的项（$W$）、一个非负项和一个严格为正的项之和是严格为正的。因此，方括号中的项是正的。\n由于 $F'(W)$ 是两个严格为正的项的乘积，所以对于所有 $W1$，$F'(W)  0$。这证明了 $F(W)$ 在区间 $(1, \\infty)$ 上是一个严格递增函数。\n在边界 $W=1$ 处，我们有 $F(1) = 0$。由于 $S^2 \\ge 0$，并且当 $W \\to \\infty$ 时，$W^{1-\\Gamma} \\to 0$ 且 $F(W) \\approx D^2 W^2 \\to \\infty$，根据介值定理，对于任何给定的 $S^2 \\ge 0$ 值，都存在一个唯一的解 $W \\in [1, \\infty)$。$S^2=0$ 的情况唯一对应于 $W=1$。\n\n基于这个证明，我们可以设计一个鲁棒的数值算法。$F(W)$ 的严格单调性使得二分法成为寻找 $f(W) = F(W) - S^2 = 0$ 根的理想选择。\n\n该算法如下：\n1.  **输入：** 守恒变量 $(D, S^2, \\tau)$，物态方程参数 $(K, \\Gamma)$。\n2.  **求解 W：**\n    a. 处理平凡情况：如果 $S^2$ 低于机器精度容差，则速度为零，因此 $W=1$。\n    b. 对于 $S^2  0$，为二分法找到一个区间套 $[W_L, W_R]$，使得 $f(W_L) \\le 0$ 且 $f(W_R)  0$。\n       i. 设置下界 $W_L = 1$。这得到 $f(1) = 0 - S^2 \\le 0$。\n       ii. 通过一个初始猜测（例如，$W_R=2$）并不断加倍直到 $f(W_R)  0$ 来找到一个上界 $W_R$。由于 $F(W) \\to \\infty$，这个过程保证会终止。\n    c. 在区间 $[W_L, W_R]$ 上应用二分法，以期望的数值容差找到 $f(W)=0$ 的根 $W$。\n3.  **计算原初变量和预测能量：** 一旦找到唯一的 $W$，计算原初变量：\n    a. 静止质量密度：$\\rho = D/W$\n    b. 压强：$p = K \\rho^\\Gamma$\n4.  **计算诊断量：** 冷物态方程假设意味着守恒变量之间存在特定的关系。我们可以通过使用恢复的原初变量计算一个预测的能量变量 $\\tau_{\\text{pred}}$，并将其与输入的 $\\tau$ 进行比较来验证这一点。\n    a. 计算比焓：$h = 1 + \\frac{\\Gamma K}{\\Gamma-1} \\rho^{\\Gamma-1}$。\n    b. 计算预测能量：$\\tau_{\\text{pred}} = \\rho h W^2 - p - D$。\n    c. 定义击穿诊断：如果 $|\\tau - \\tau_{\\text{pred}}|$ 超过预定义的数值容差（例如，$10^{-9}$），则 $\\text{breakdown} = \\text{True}$，否则为 $\\text{False}$。`True` 值表示状态与冷物态方程不一致，这可能是由简单模型未捕捉到的物理过程（如激波加热）引起的。\n5.  **输出：** 返回恢复的洛伦兹因子 $W$ 和击穿诊断。\n\n这完成了算法的原理设计。实现将遵循这些步骤来解决提供的具体测试用例。",
            "answer": "```python\nimport numpy as np\n\ndef recover_primitives(D, S2, tau_in, K, Gamma, tol_bisection=1e-12, tol_breakdown=1e-9):\n    \"\"\"\n    Recovers primitive variables from conserved variables for a cold polytropic EOS.\n\n    Args:\n        D (float): Conserved rest-mass density.\n        S2 (float): Magnitude squared of conserved momentum.\n        tau_in (float): Conserved energy variable.\n        K (float): Polytropic constant.\n        Gamma (float): Polytropic index.\n        tol_bisection (float): Numerical tolerance for the bisection solver.\n        tol_breakdown (float): Numerical tolerance for the breakdown diagnostic.\n\n    Returns:\n        tuple[float, bool]: The recovered Lorentz factor W and the breakdown diagnostic.\n    \"\"\"\n    # If momentum vanishes, velocity is zero and W=1.\n    if S2  tol_bisection**2:\n        W = 1.0\n    else:\n        # Define the function g(W) = F(W) - S^2 whose root we need to find.\n        # F(W) = D^2 * (W^2 - 1) * (1 + (Gamma*K)/(Gamma-1) * (D/W)**(Gamma-1))**2\n        def g(W_val):\n            # This is to prevent division by zero or log(0) issues at W=1, although handled by bracketing.\n            if W_val = 1.0:\n                return -S2\n            \n            # For numerical stability with large Gamma, calculate log of base first, but for Gamma=2 it's simple.\n            h_term_base = D / W_val\n            h = 1.0 + (Gamma * K) / (Gamma - 1.0) * h_term_base**(Gamma - 1.0)\n            \n            # The function F(W) from the derivation\n            f_W = D**2 * (W_val**2 - 1.0) * h**2\n            return f_W - S2\n\n        # Bisection Method\n        # 1. Find a valid bracket [W_low, W_high]\n        W_low = 1.0\n        W_high = 2.0\n        \n        # g(W_low) is guaranteed to be = 0. We need to find W_high such that g(W_high) > 0.\n        # The bracket is expanded exponentially until the function sign changes.\n        # This is robust because we proved the function is monotonic and unbounded.\n        max_expansion_iter = 60 # 2^60 is astronomical, a safe upper limit\n        for _ in range(max_expansion_iter):\n            if g(W_high) > 0:\n                break\n            W_high *= 2.0\n        else:\n            # This would indicate a failure to find a bracket, which shouldn't happen for valid physics.\n            return np.nan, True\n\n        # 2. Bisection iterations\n        max_bisection_iter = 100 # Provides precision far beyond what's needed for double.\n        for _ in range(max_bisection_iter):\n            if W_high - W_low  tol_bisection:\n                break\n            W_mid = (W_low + W_high) / 2.0\n            if g(W_mid)  0:\n                W_low = W_mid\n            else:\n                W_high = W_mid\n        W = (W_low + W_high) / 2.0\n\n    # With W recovered, calculate primitives and the predicted tau.\n    rho = D / W\n    p = K * rho**Gamma\n    \n    # Calculate specific enthalpy h using the derived formula\n    h = 1.0 + (Gamma * K) / (Gamma - 1.0) * rho**(Gamma - 1.0)\n\n    # Calculate predicted tau value assuming a cold EOS\n    tau_pred = rho * h * W**2 - p - D\n\n    # Compare predicted tau with input tau for the breakdown diagnostic\n    breakdown = abs(tau_in - tau_pred) > tol_breakdown\n    \n    return W, breakdown\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    K_val = 1.0\n    Gamma_val = 2.0\n\n    # --- Generate Test Cases ---\n    \n    # Test Case A: Happy path\n    rho_A = 1.0e-3\n    v_A = 0.3\n    W_A = 1.0 / np.sqrt(1.0 - v_A**2)\n    D_A = rho_A * W_A\n    p_A = K_val * rho_A**Gamma_val\n    h_A = 1.0 + (Gamma_val * K_val) / (Gamma_val - 1.0) * rho_A**(Gamma_val - 1.0)\n    S2_A = (rho_A * h_A)**2 * W_A**2 * (W_A**2 - 1.0)\n    tau_A = rho_A * h_A * W_A**2 - p_A - D_A\n    \n    # Test Case B: Boundary case (zero momentum)\n    rho_B = 1.0e-2\n    v_B = 0.0\n    W_B = 1.0 / np.sqrt(1.0 - v_B**2)\n    D_B = rho_B * W_B\n    p_B = K_val * rho_B**Gamma_val\n    h_B = 1.0 + (Gamma_val * K_val) / (Gamma_val - 1.0) * rho_B**(Gamma_val - 1.0)\n    S2_B = (rho_B * h_B)**2 * W_B**2 * (W_B**2 - 1.0)\n    tau_B = rho_B * h_B * W_B**2 - p_B - D_B\n    \n    # Test Case C: Ultra-relativistic\n    rho_C = 1.0e-3\n    v_C = 0.99\n    W_C = 1.0 / np.sqrt(1.0 - v_C**2)\n    D_C = rho_C * W_C\n    p_C = K_val * rho_C**Gamma_val\n    h_C = 1.0 + (Gamma_val * K_val) / (Gamma_val - 1.0) * rho_C**(Gamma_val - 1.0)\n    S2_C = (rho_C * h_C)**2 * W_C**2 * (W_C**2 - 1.0)\n    tau_C = rho_C * h_C * W_C**2 - p_C - D_C\n    \n    # Test Case D: Shock heating violation\n    D_D = D_A\n    S2_D = S2_A\n    tau_D = tau_A + 0.05\n    \n    test_cases = [\n        (D_A, S2_A, tau_A),\n        (D_B, S2_B, tau_B),\n        (D_C, S2_C, tau_C),\n        (D_D, S2_D, tau_D)\n    ]\n    \n    results = []\n    for D, S2, tau in test_cases:\n        W, breakdown = recover_primitives(D, S2, tau, K_val, Gamma_val)\n        # Format the result for the current test case as specified: [W,breakdown]\n        # round() is used for final value, but formatting to .8f ensures trailing zeros.\n        W_rounded = round(W, 8)\n        results.append(f\"[{W_rounded:.8f},{'True' if breakdown else 'False'}]\")\n    \n    # Print the final list of results in the exact specified format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在真实的数值模拟中，尤其是那些包含像磁流体力学这样的复杂物理过程的模拟，仅仅获得一个解是不够的；我们还必须验证其一致性和稳健性。这个高级练习要求你实现一个关键的验证步骤：一个一致性检查，它从恢复的原始变量中重构守恒量，并将其与原始值进行比较。通过设计一个能够适应挑战性区域（如高速或强磁场）的自适应容差，你将深入了解构建可靠数值相对论代码的实践工程，并将你的理解扩展到狭义相对论磁流体力学（SRMHD）的领域。",
            "id": "3468812",
            "problem": "考虑广义相对论磁流体动力学（GRMHD）中从守恒量到原始变量的恢复步骤，该步骤用于致密天体和引力波的数值相对论模拟。在这一步中，我们恢复原始变量 $(\\rho, p, v^i)$，并用它们来重构守恒量 $(D, S_i, \\tau)$ 以检查一致性。在平直时空（狭义相对论磁流体动力学，SRMHD）中使用笛卡尔坐标和闵可夫斯基度规，并采用几何化单位制，其中 $c=G=1$（所有量均为无量纲）。假设理想磁流体动力学和带有恒定绝热指数 $\\Gamma$ 的 $\\Gamma$-律状态方程。\n\n根据应力-能量守恒和标准的瓦伦西亚（Valencia）公式，适用以下定义：\n- 洛伦兹因子为 $W = (1 - v^2)^{-1/2}$，其中 $v^2 = v_i v^i$，并且使用欧几里得空间度规，因此 $v_i = v^i$。\n- 比焓为 $h = 1 + \\epsilon + \\frac{p}{\\rho}$，对于 $\\Gamma$-律状态方程 $p = (\\Gamma - 1)\\rho \\epsilon$，这简化为 $h = 1 + \\frac{\\Gamma}{\\Gamma - 1}\\frac{p}{\\rho}$。\n- 共动磁场 $b^\\mu$ 满足 $b^0 = W\\, B^i v_i$ 和 $b^i = \\frac{B^i}{W} + b^0 v^i$。其大小为 $b^2 = b^\\mu b_\\mu = \\frac{B^2}{W^2} + (B^i v_i)^2$，其中 $B^2 = B_i B^i$，并且使用欧几里得空间度规，因此 $B_i = B^i$。\n- 守恒量为\n$$\nD = \\rho W,\n$$\n$$\nS_i = \\left(\\rho h + b^2\\right) W^2 v_i - b^0 b_i,\n$$\n$$\n\\tau = \\left(\\rho h + b^2\\right) W^2 - \\left(p + \\frac{b^2}{2}\\right) - \\left(b^0\\right)^2 - D.\n$$\n\n您的任务是实现一个一致性检查，在给定恢复的原始变量 $(\\rho, p, v^i)$ 和磁场 $B^i$ 的情况下，验证重构的 $(D_{\\mathrm{calc}}, S_{i,\\mathrm{calc}}, \\tau_{\\mathrm{calc}})$ 与原始的 $(D, S_i, \\tau)$ 在一个依赖于 $W$ 和 $b^2$ 的自适应容差范围内匹配。具体而言：\n\n1. 使用上述定义，从 $(\\rho, p, v^i, B^i)$ 计算重构的 $(D_{\\mathrm{calc}}, S_{i,\\mathrm{calc}}, \\tau_{\\mathrm{calc}})$。\n\n2. 计算残差\n$$\n\\Delta D = D_{\\mathrm{calc}} - D_{\\mathrm{orig}},\n\\quad\n\\Delta S_i = S_{i,\\mathrm{calc}} - S_{i,\\mathrm{orig}},\n\\quad\n\\Delta \\tau = \\tau_{\\mathrm{calc}} - \\tau_{\\mathrm{orig}}.\n$$\n\n3. 使用以下公式定义缩放后的残差范数\n$$\nD_{\\mathrm{scale}} = \\max\\left(|D_{\\mathrm{orig}}|, 1\\right),\n\\quad\nS_{\\mathrm{scale}} = \\max\\left(\\sqrt{S_i S^i}, 1\\right),\n\\quad\n\\tau_{\\mathrm{scale}} = \\max\\left(|\\tau_{\\mathrm{orig}}|, 1\\right),\n$$\n其中 $S_i S^i$ 使用欧几里得空间度规。\n\n4. 设计一个对 $W$ 和 $b^2$ 自适应的接受标准。设基础容差为 $\\epsilon_0 = 10^{-12}$，并定义放大因子\n$$\nF(W,b^2) = 1 + \\frac{1}{2}(W - 1) + \\frac{1}{2} \\frac{b^2}{\\rho h + b^2}.\n$$\n设置自适应容差\n$$\n\\epsilon_D = \\epsilon_0 F(W,b^2),\n\\quad\n\\epsilon_S = \\epsilon_0 F(W,b^2),\n\\quad\n\\epsilon_\\tau = \\epsilon_0 F(W,b^2).\n$$\n当且仅当以下条件成立时，接受该恢复结果\n$$\n\\frac{|\\Delta D|}{D_{\\mathrm{scale}}} \\le \\epsilon_D,\n\\quad\n\\frac{\\sqrt{\\Delta S_i \\Delta S^i}}{S_{\\mathrm{scale}}} \\le \\epsilon_S,\n\\quad\n\\frac{|\\Delta \\tau|}{\\tau_{\\mathrm{scale}}} \\le \\epsilon_\\tau.\n$$\n\n实现一个程序，对以下测试套件评估此接受标准。在所有情况下均使用 $\\Gamma = \\frac{4}{3}$。\n\n所有量均为无量纲，并以 $c=G=1$ 的几何化单位表示。速度 $v^i$ 必须满足 $v^2  1$；不使用角度。对于没有明确给出 $(D_{\\mathrm{orig}}, S_{i,\\mathrm{orig}}, \\tau_{\\mathrm{orig}})$ 的情况，从给定的原始变量精确计算它们，以代表一个完全一致的恢复。\n\n- 情况A（流体动力学，无磁场）：\n  - $\\rho = 1.0$, $p = 0.1$, $v^i = (0.1, 0.2, 0.0)$, $B^i = (0.0, 0.0, 0.0)$。\n  - 令 $(D_{\\mathrm{orig}}, S_{i,\\mathrm{orig}}, \\tau_{\\mathrm{orig}})$ 由这些原始变量计算得出。\n\n- 情况B（中等磁化）：\n  - $\\rho = 1.0$, $p = 0.5$, $v^i = (0.3, -0.2, 0.1)$, $B^i = (0.5, 0.3, -0.2)$。\n  - 令 $(D_{\\mathrm{orig}}, S_{i,\\mathrm{orig}}, \\tau_{\\mathrm{orig}})$ 由这些原始变量计算得出。\n\n- 情况C（高相对论性和强磁化）：\n  - $\\rho = 0.1$, $p = 0.01$, $v^i = (0.95, 0.0, 0.0)$, $B^i = (3.0, 0.0, 0.0)$。\n  - 令 $(D_{\\mathrm{orig}}, S_{i,\\mathrm{orig}}, \\tau_{\\mathrm{orig}})$ 由这些原始变量计算得出。\n\n- 情况D（近真空流体动力学）：\n  - $\\rho = 10^{-6}$, $p = 10^{-8}$, $v^i = (0.4, -0.4, 0.2)$, $B^i = (0.0, 0.0, 0.0)$。\n  - 令 $(D_{\\mathrm{orig}}, S_{i,\\mathrm{orig}}, \\tau_{\\mathrm{orig}})$ 由这些原始变量计算得出。\n\n- 情况E（基于情况B的不一致的扰动守恒量）：\n  - 使用与情况B中相同的原始变量和 $B^i$。\n  - 从这些原始变量计算 $(D_{\\mathrm{orig}}, S_{i,\\mathrm{orig}}, \\tau_{\\mathrm{orig}})$，然后如下扰动它们\n    $D_{\\mathrm{orig}} \\leftarrow D_{\\mathrm{orig}} + 10^{-3}$,\n    $S_{i,\\mathrm{orig}} \\leftarrow S_{i,\\mathrm{orig}} + (10^{-3}, -2 \\cdot 10^{-3}, 10^{-3})$,\n    $\\tau_{\\mathrm{orig}} \\leftarrow \\tau_{\\mathrm{orig}} - 5 \\cdot 10^{-3}$.\n\n您的程序应生成单行输出，其中包含情况A到E的接受结果，格式为方括号内以逗号分隔的列表（例如，“[True,False,True,True,False]”），其中每个条目都是一个布尔值，指示在该自适应标准下，该情况的恢复是否被接受。",
            "solution": "问题陈述已经过严格验证，被认为是科学上合理、定义明确且自洽的。它基于狭义相对论磁流体动力学（SRMHD）的既定原理，这是数值模拟中使用的广义相对论磁流体动力学（GRMHD）的标准简化。所有必需的方程、常数和测试数据都已提供，不存在内部矛盾、歧义或事实错误。任务是为从守恒量到原始变量的恢复实现一个精确定义的一致性检查，这是该领域的标准程序。\n\n解决方案的实现首先是创建一个函数，用于从原始变量 $(\\rho, p, v^i, B^i)$ 重构守恒量 $(D, S_i, \\tau)$，然后应用一个指定的自适应接受标准，将这些重构值与一组用于多个测试用例的“原始”守恒量进行比较。\n\n方法步骤如下：\n\n1.  **守恒量的重构**\n\n给定一组原始变量——静质量密度 $\\rho$、气体压力 $p$、三维速度 $v^i$ 和磁场 $B^i$——以及绝热指数 $\\Gamma$，我们首先计算重构守恒量所需的一组中间量。所有计算都在几何化单位制（其中 $c=1$）中执行。假设为平直时空，具有闵可夫斯基度规和相应的欧几里得空间度规 $\\delta_{ij}$。\n\na.  三维速度的平方大小 $v^2$ 计算为欧几里得点积 $v^2 = v_i v^i$。\n\nb.  然后根据速度计算洛伦兹因子 $W$：\n    $$\n    W = \\frac{1}{\\sqrt{1 - v^2}}\n    $$\n\nc.  对于 $\\Gamma$-律理想气体，比焓 $h$ 由下式给出：\n    $$\n    h = 1 + \\epsilon + \\frac{p}{\\rho}\n    $$\n    其中 $\\epsilon$ 是比内能。使用状态方程 $p = (\\Gamma - 1)\\rho \\epsilon$，我们可以仅用 $\\rho$ 和 $p$ 表示 $h$：\n    $$\n    h = 1 + \\frac{\\Gamma}{\\Gamma - 1}\\frac{p}{\\rho}\n    $$\n\nd.  实验室坐标系下的磁场 $B^i$ 用于计算与共动磁场 $b^\\mu$ 相关的量。计算实验室坐标系下磁场的平方大小 $B^2 = B_i B^i$ 及其沿速度方向的投影 $B^iv_i$。四维矢量 $b^\\mu$ 的分量为：\n    $$\n    b^0 = W (B^j v_j)\n    $$\n    $$\n    b^i = \\frac{B^i}{W} + b^0 v^i\n    $$\n    共动磁场的相对论不变量平方大小 $b^2 = b^\\mu b_\\mu$ 则为：\n    $$\n    b^2 = \\frac{B^2}{W^2} + (B^j v_j)^2\n    $$\n\ne.  有了这些中间量，就可以使用标准的瓦伦西亚公式定义来重构守恒量 $(D, S_i, \\tau)$：\n    -   守恒静质量密度 $D$：\n        $$\n        D = \\rho W\n        $$\n    -   守恒动量密度 $S_i$：\n        $$\n        S_i = \\left(\\rho h + b^2\\right) W^2 v_i - b^0 b_i\n        $$\n        其中由于欧几里得空间度规，$b_i = b^i$。\n    -   守恒总能量密度减去守恒静质量密度，$\\tau$：\n        $$\n        \\tau = \\left(\\rho h + b^2\\right) W^2 - \\left(p + \\frac{b^2}{2}\\right) - (b^0)^2 - D\n        $$\n\n这个重构过程被封装在一个专用函数中，该函数返回计算出的守恒量 $(D_{\\mathrm{calc}}, S_{i,\\mathrm{calc}}, \\tau_{\\mathrm{calc}})$ 以及计算容差所需的中间值 $W$ 和 $b^2$。\n\n2.  **自适应接受标准**\n\n任务的核心是验证重构的守恒量（记为 $(D_{\\mathrm{calc}}, S_{i,\\mathrm{calc}}, \\tau_{\\mathrm{calc}})$）是否与给定的一组“原始”守恒量 $(D_{\\mathrm{orig}}, S_{i,\\mathrm{orig}}, \\tau_{\\mathrm{orig}})$ 在指定的容差范围内一致。\n\na.  首先，计算残差，即计算值与原始值之间的差：\n    $$\n    \\Delta D = D_{\\mathrm{calc}} - D_{\\mathrm{orig}}\n    $$\n    $$\n    \\Delta S_i = S_{i,\\mathrm{calc}} - S_{i,\\mathrm{orig}}\n    $$\n    $$\n    \\Delta \\tau = \\tau_{\\mathrm{calc}} - \\tau_{\\mathrm{orig}}\n    $$\n\nb.  为了提供一个尺度无关的误差度量，这些残差通过比例因子进行归一化。比例因子的设计旨在防止除以小数，并在量很小时从相对误差度量过渡到绝对误差度量。\n    $$\n    D_{\\mathrm{scale}} = \\max\\left(|D_{\\mathrm{orig}}|, 1.0\\right)\n    $$\n    $$\n    S_{\\mathrm{scale}} = \\max\\left(\\sqrt{S_{i,\\mathrm{orig}} S^i_{\\mathrm{orig}}}, 1.0\\right)\n    $$\n    $$\n    \\tau_{\\mathrm{scale}} = \\max\\left(|\\tau_{\\mathrm{orig}}|, 1.0\\right)\n    $$\n\nc.  一个关键特性是自适应容差，它考虑了在高相对论性（$W \\gg 1$）或强磁化（$b^2$ 很大）区域中增加的数值计算难度。基础容差 $\\epsilon_0 = 10^{-12}$ 被一个因子 $F(W, b^2)$ 放大：\n    $$\n    F(W, b^2) = 1 + \\frac{1}{2}(W - 1) + \\frac{1}{2} \\frac{b^2}{\\rho h + b^2}\n    $$\n    该因子使用与给定原始状态相对应的 $W$、$b^2$、$\\rho$ 和 $h$ 的值计算。自适应容差则为：\n    $$\n    \\epsilon_D = \\epsilon_0 F(W, b^2)\n    $$\n    $$\n    \\epsilon_S = \\epsilon_0 F(W, b^2)\n    $$\n    $$\n    \\epsilon_\\tau = \\epsilon_0 F(W, b^2)\n    $$\n\nd.  最后，如果以下所有三个条件都满足，则恢复结果被接受为一致的：\n    $$\n    \\frac{|\\Delta D|}{D_{\\mathrm{scale}}} \\le \\epsilon_D\n    $$\n    $$\n    \\frac{\\sqrt{\\Delta S_i \\Delta S^i}}{S_{\\mathrm{scale}}} \\le \\epsilon_S\n    $$\n    $$\n    \\frac{|\\Delta \\tau|}{\\tau_{\\mathrm{scale}}} \\le \\epsilon_\\tau\n    $$\n\n3.  **测试用例评估**\n\n该算法应用于五个测试用例。\n\n-   **情况A、B、C和D**：对于这些情况，“原始”守恒量 $(D_{\\mathrm{orig}}, S_{i,\\mathrm{orig}}, \\tau_{\\mathrm{orig}})$ 被定义为从给定原始变量重构的结果。因此，$(D_{\\mathrm{calc}}, S_{i,\\mathrm{calc}}, \\tau_{\\mathrm{calc}})$ 与 $(D_{\\mathrm{orig}}, S_{i,\\mathrm{orig}}, \\tau_{\\mathrm{orig}})$ 完全相同。残差 $(\\Delta D, \\Delta S_i, \\Delta \\tau)$ 在计算上为零（或在机器精度级别）。由于不等式的右侧是一个非常小的正数，这四种情况预计将通过一致性检查，结果为 `True`。\n\n-   **情况E**：这种情况旨在测试失败条件。原始变量取自情况B。因此，“计算出的”守恒量 $(D_{\\mathrm{calc}}, S_{i,\\mathrm{calc}}, \\tau_{\\mathrm{calc}})$ 与情况B中的相同。然而，“原始”守恒量 $(D_{\\mathrm{orig}}, S_{i,\\mathrm{orig}}, \\tau_{\\mathrm{orig}})$ 是通过向计算值添加量级为 $10^{-3}$ 的显式非零扰动来定义的。这将产生显著的残差 $(\\Delta D, \\Delta S_i, \\Delta \\tau)$，比自适应容差 $\\epsilon \\sim 10^{-12}$ 大许多数量级。因此，接受不等式将不被满足，这种情况预计将无法通过一致性检查，结果为 `False`。\n\n该实现将为每个情况产生一个布尔结果，然后将这些结果汇总成所需的输出格式。",
            "answer": "```python\nimport numpy as np\n\ndef compute_conserved_variables(rho, p, v, B, Gamma):\n    \"\"\"\n    Computes conserved variables (D, S_i, tau) from primitive variables.\n    \n    Args:\n        rho (float): Rest-mass density.\n        p (float): Gas pressure.\n        v (np.ndarray): 3-velocity vector.\n        B (np.ndarray): Lab-frame magnetic field vector.\n        Gamma (float): Adiabatic index.\n    \n    Returns:\n        tuple: A tuple containing D, S, tau, W, and b_squared.\n    \"\"\"\n    v_squared = np.dot(v, v)\n    if v_squared >= 1.0:\n        # This state is unphysical, but problem guarantees v^2  1.\n        # Handle gracefully in a real application. Here we can assume it won't happen.\n        raise ValueError(\"Velocity magnitude must be less than 1.\")\n\n    W = 1.0 / np.sqrt(1.0 - v_squared)\n    h = 1.0 + (Gamma / (Gamma - 1.0)) * (p / rho) if rho > 0 else 1.0\n    \n    B_squared = np.dot(B, B)\n    B_dot_v = np.dot(B, v)\n    \n    b0 = W * B_dot_v\n    b_squared = B_squared / (W**2) + B_dot_v**2\n    \n    # Conserved density\n    D = rho * W\n    \n    # Conserved momentum density\n    # b_i = b^i = B^i/W + b^0 v^i\n    b = B / W + b0 * v\n    total_pressure_term = (rho * h + b_squared) * (W**2)\n    S = total_pressure_term * v - b0 * b\n    \n    # Conserved energy density (minus D)\n    tau = total_pressure_term - (p + b_squared / 2.0) - b0**2 - D\n    \n    return D, S, tau, W, h, b_squared\n\ndef check_consistency(rho, p, v, B, Gamma, D_orig, S_orig, tau_orig):\n    \"\"\"\n    Performs the consistency check for a given state.\n    \n    Args:\n        rho, p, v, B, Gamma: Primitive state variables.\n        D_orig, S_orig, tau_orig: \"Original\" conserved variables to check against.\n        \n    Returns:\n        bool: True if the state is consistent, False otherwise.\n    \"\"\"\n    eps0 = 1e-12\n\n    # 1. Compute reconstructed conserved variables from primitives\n    D_calc, S_calc, tau_calc, W, h, b_squared = compute_conserved_variables(rho, p, v, B, Gamma)\n\n    # 2. Compute residuals\n    delta_D = D_calc - D_orig\n    delta_S = S_calc - S_orig\n    delta_tau = tau_calc - tau_orig\n\n    # 3. Define scaled residual norms\n    D_scale = max(abs(D_orig), 1.0)\n    S_norm_orig = np.sqrt(np.dot(S_orig, S_orig))\n    S_scale = max(S_norm_orig, 1.0)\n    tau_scale = max(abs(tau_orig), 1.0)\n\n    # 4. Design an acceptance criterion\n    # Compute amplification factor F(W, b^2)\n    # The denominator term rho * h + b_squared can be zero in vacuum,\n    # but the test cases here are not vacuum.\n    F_denom = rho * h + b_squared\n    F_b_term = 0.0 if F_denom == 0.0 else b_squared / F_denom\n    F = 1.0 + 0.5 * (W - 1.0) + 0.5 * F_b_term\n\n    # Set adaptive tolerances\n    eps_D = eps0 * F\n    eps_S = eps0 * F\n    eps_tau = eps0 * F\n    \n    # Perform checks\n    check_D = (abs(delta_D) / D_scale) = eps_D\n    \n    delta_S_norm = np.sqrt(np.dot(delta_S, delta_S))\n    check_S = (delta_S_norm / S_scale) = eps_S\n    \n    check_tau = (abs(delta_tau) / tau_scale) = eps_tau\n    \n    return check_D and check_S and check_tau\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    \"\"\"\n    Gamma = 4.0 / 3.0\n\n    # Define the test cases\n    test_cases = [\n        {\n            \"name\": \"A\",\n            \"rho\": 1.0, \"p\": 0.1, \"v\": np.array([0.1, 0.2, 0.0]), \"B\": np.array([0.0, 0.0, 0.0]),\n            \"perturb\": None\n        },\n        {\n            \"name\": \"B\",\n            \"rho\": 1.0, \"p\": 0.5, \"v\": np.array([0.3, -0.2, 0.1]), \"B\": np.array([0.5, 0.3, -0.2]),\n            \"perturb\": None\n        },\n        {\n            \"name\": \"C\",\n            \"rho\": 0.1, \"p\": 0.01, \"v\": np.array([0.95, 0.0, 0.0]), \"B\": np.array([3.0, 0.0, 0.0]),\n            \"perturb\": None\n        },\n        {\n            \"name\": \"D\",\n            \"rho\": 1e-6, \"p\": 1e-8, \"v\": np.array([0.4, -0.4, 0.2]), \"B\": np.array([0.0, 0.0, 0.0]),\n            \"perturb\": None\n        },\n        {\n            \"name\": \"E\",\n            \"rho\": 1.0, \"p\": 0.5, \"v\": np.array([0.3, -0.2, 0.1]), \"B\": np.array([0.5, 0.3, -0.2]),\n            \"perturb\": {\n                \"dD\": 1e-3,\n                \"dS\": np.array([1e-3, -2e-3, 1e-3]),\n                \"dtau\": -5e-3\n            }\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        rho, p, v, B = case[\"rho\"], case[\"p\"], case[\"v\"], case[\"B\"]\n        \n        # Calculate the base conserved variables from primitives\n        D_base, S_base, tau_base, _, _, _ = compute_conserved_variables(rho, p, v, B, Gamma)\n\n        if case[\"perturb\"] is None:\n            # For cases A-D, D_orig is computed from primitives\n            D_orig, S_orig, tau_orig = D_base, S_base, tau_base\n        else:\n            # For case E, D_orig is the perturbed version\n            perturb = case[\"perturb\"]\n            D_orig = D_base + perturb[\"dD\"]\n            S_orig = S_base + perturb[\"dS\"]\n            tau_orig = tau_base + perturb[\"dtau\"]\n\n        # The 'recovered' primitives are just the given ones.\n        # The consistency check compares the conserveds computed from\n        # these primitives against D_orig, S_orig, tau_orig.\n        is_consistent = check_consistency(rho, p, v, B, Gamma, D_orig, S_orig, tau_orig)\n        results.append(is_consistent)\n\n    # Format the final output string\n    output_str = f\"[{','.join(map(str, results))}]\".replace(\"True\", \"True\").replace(\"False\", \"False\")\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}