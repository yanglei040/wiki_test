{
    "hands_on_practices": [
        {
            "introduction": "This exercise goes back to first principles, as it is essential to understand the analytical structure of solutions before implementing complex numerical schemes. This problem has you solve a classic Riemann problem for a simple scalar conservation law, deriving the shock speed from the fundamental Rankine-Hugoniot jump condition and ensuring its physical relevance with the Lax entropy condition . Mastering this foundational calculation provides the physical and mathematical intuition for why high-resolution shock-capturing methods are necessary.",
            "id": "3476830",
            "problem": "Consider a one-dimensional scalar conservation law in units where the speed of light is $1$,\n$$u_{t} + f(u)_{x} = 0,$$\nused as a surrogate benchmark for High-Resolution Shock-Capturing (HRSC) schemes such as Weighted Essentially Non-Oscillatory (WENO) reconstructions in numerical relativity and gravitational-wave source modeling. Take the convex flux\n$$f(u) = \\frac{u^{2}}{2},$$\nand the Riemann initial data\n$$u(x,0) = \\begin{cases}\nu_{L}, & x < 0,\\\\\nu_{R}, & x > 0,\n\\end{cases}\n\\quad \\text{with} \\quad u_{L} = 0.85, \\quad u_{R} = -0.15.$$\nStarting from the integral formulation of conservation laws and invoking the Rankine–Hugoniot jump condition together with the Lax entropy condition, determine the unique entropy-satisfying weak solution structure for $t>0$ and compute the corresponding shock speed $s$. Report the shock speed in dimensionless units. Round your final numerical answer to four significant figures.",
            "solution": "The problem as stated is scientifically grounded, well-posed, and objective. It presents a standard Riemann problem for the inviscid Burgers' equation, which is a fundamental test case in the study of hyperbolic conservation laws and numerical methods like High-Resolution Shock-Capturing (HRSC) schemes. All necessary data and conditions are provided, and there are no internal contradictions or violations of physical or mathematical principles. Therefore, the problem is valid, and we may proceed with the solution.\n\nThe one-dimensional scalar conservation law is given by\n$$u_{t} + f(u)_{x} = 0,$$\nwhere $u=u(x,t)$ is the conserved quantity and $f(u)$ is the flux function. The integral form of this law over a spatial interval $[x_{1}, x_{2}]$ is\n$$\\frac{d}{dt} \\int_{x_{1}}^{x_{2}} u(x,t) \\, dx = f(u(x_{1},t)) - f(u(x_{2},t)).$$\nFor a weak solution that includes a discontinuity (a shock) propagating at a speed $s$, we consider an arbitrarily small interval $[x_{1}, x_{2}]$ that moves with the shock. The state $u(x,t)$ is assumed to be piecewise constant across the shock, with a state $u_{L}$ to the left and $u_{R}$ to the right. Applying the integral conservation law across this moving discontinuity leads to the Rankine–Hugoniot jump condition, which relates the shock speed $s$ to the states on either side:\n$$s = \\frac{f(u_{R}) - f(u_{L})}{u_{R} - u_{L}} = \\frac{[f(u)]}{[u]},$$\nwhere $[\\cdot]$ denotes the jump in the quantity across the shock.\n\nThe given flux function is convex:\n$$f(u) = \\frac{u^{2}}{2}.$$\nThe characteristic speed $a(u)$ of the hyperbolic equation is given by the derivative of the flux function:\n$$a(u) = f'(u) = \\frac{d}{du}\\left(\\frac{u^{2}}{2}\\right) = u.$$\nThe Riemann initial data are\n$$u(x,0) = \\begin{cases}\nu_{L} = 0.85, & x < 0,\\\\\nu_{R} = -0.15, & x > 0.\n\\end{cases}$$\nThe type of solution (shock or rarefaction wave) depends on the relationship between the characteristic speeds at the left and right states, $a(u_{L})$ and $a(u_{R})$.\nFor our specific case, the characteristic speeds are:\n$$a(u_{L}) = u_{L} = 0.85,$$\n$$a(u_{R}) = u_{R} = -0.15.$$\nSince $a(u_{L}) > a(u_{R})$, the characteristics are converging, which leads to the formation of a shock wave. A rarefaction wave would form if $a(u_{L}) < a(u_{R})$. The solution is therefore a single discontinuity separating the two constant states $u_{L}$ and $u_{R}$.\n\nTo ensure the solution is physically meaningful and unique, it must satisfy an entropy condition. The Lax entropy condition for a shock wave states that the characteristic speed to the left of the shock must be greater than the shock speed, which in turn must be greater than the characteristic speed to the right of the shock. Mathematically,\n$$a(u_{L}) > s > a(u_{R}).$$\nWe now calculate the shock speed $s$ using the Rankine–Hugoniot condition for the given flux and states:\n$$s = \\frac{f(u_{R}) - f(u_{L})}{u_{R} - u_{L}} = \\frac{\\frac{1}{2}u_{R}^{2} - \\frac{1}{2}u_{L}^{2}}{u_{R} - u_{L}}.$$\nThis expression can be simplified algebraically:\n$$s = \\frac{\\frac{1}{2}(u_{R} - u_{L})(u_{R} + u_{L})}{u_{R} - u_{L}} = \\frac{u_{R} + u_{L}}{2}.$$\nSubstituting the given numerical values for $u_{L}$ and $u_{R}$:\n$$s = \\frac{-0.15 + 0.85}{2} = \\frac{0.70}{2} = 0.35.$$\nWe must verify that this shock speed satisfies the Lax entropy condition:\n$$a(u_{L}) > s > a(u_{R})$$\n$$0.85 > 0.35 > -0.15.$$\nThe inequality holds, confirming that our shock solution is the unique, entropy-satisfying weak solution. The structure of this solution for $t>0$ is a single shock front moving with constant speed $s$:\n$$u(x,t) = \\begin{cases}\n0.85, & x < st,\\\\\n-0.15, & x > st,\n\\end{cases}$$\nwhere $s = 0.35$.\n\nThe problem requires the shock speed $s$ rounded to four significant figures. The calculated value is exactly $0.35$. To express this with four significant figures, we write it as $0.3500$.",
            "answer": "$$\\boxed{0.3500}$$"
        },
        {
            "introduction": "Moving from scalar theory to relativistic hydrodynamics introduces significant new challenges, a primary one being the conversion from conserved to primitive variables. Unlike in Newtonian physics, this \"con2prim\" step in relativistic codes requires solving a nonlinear system of equations at every grid point at every time step. This practice problem guides you through the derivation and implementation of a robust solver, a critical hands-on skill for developing any code for numerical relativity or relativistic astrophysics .",
            "id": "3476915",
            "problem": "Consider one-dimensional Special Relativistic Hydrodynamics (SRHD) in natural units where the speed of light is set to $c = 1$. In a High-Resolution Shock-Capturing (HRSC) method, such as those employing Weighted Essentially Non-Oscillatory (WENO) reconstruction, a finite-volume update evolves a set of conserved variables. After each time update, one must recover the primitive variables to compute fluxes and characteristic speeds for the next step. This problem asks you to implement a robust primitive-variable recovery algorithm from the conserved variables for a gamma-law ideal fluid, suitable for use in a numerical relativity and gravitational wave code.\n\nFundamental base:\n- The flow is governed by Special Relativistic Hydrodynamics in flat spacetime.\n- The conserved variables in one spatial dimension are defined as $D$, $S$, and $\\tau$. The primitive variables are the rest-mass density $\\rho$, the fluid velocity $v$ (with $|v| < 1$), and the pressure $p$ (with $p \\ge 0$).\n- The Lorentz factor is $W = 1/\\sqrt{1 - v^2}$.\n- The specific enthalpy for a gamma-law ideal fluid is $h = 1 + \\epsilon + p/\\rho$, and for the gamma-law equation of state with adiabatic index $\\Gamma$, the internal energy per unit mass is $\\epsilon = p/((\\Gamma - 1)\\rho)$, so $h = 1 + \\Gamma p / ((\\Gamma - 1)\\rho)$.\n- The conserved variables are related to the primitives by\n$$\nD = \\rho W,\n$$\n$$\nS = \\rho h W^2 v,\n$$\n$$\n\\tau = \\rho h W^2 - p - D.\n$$\nDefine $E = \\tau + D$ for brevity.\n\nProblem objective:\n- Given $(D, S, \\tau)$ and $\\Gamma$, recover $(\\rho, v, p)$ that satisfy the above relations, subject to the physical constraints $0 \\le \\rho$, $|v| < 1$, and $0 \\le p$.\n\nDerivation constraints:\n- You must start from the fundamental definitions listed above and derive a nonlinear equation for $p$ alone. Use the fact that $E = \\rho h W^2 - p$ and $S = \\rho h W^2 v$ to express $v$ as a function of $p$ via\n$$\nv(p) = \\frac{S}{E + p}.\n$$\n- Use this relation to express $W(p)$ and then formulate a scalar residual $R(p)$ such that the physical solution satisfies $R(p) = 0$. This residual must be derived from the definitions and the gamma-law equation of state without assuming any shortcut formulas.\n- Design a solver that enforces $p \\ge 0$ and $|v| < 1$ during iterations. Your solver must be robust for mildly and highly relativistic states.\n\nAlgorithmic requirements:\n- Implement a hybrid root-finding scheme that uses Newton-Raphson when it is safe and efficient, with a fallback to a bracketing method (such as bisection) if Newton-Raphson fails to converge or attempts to leave the physically allowed domain.\n- You must derive and implement the derivative $\\mathrm{d}R/\\mathrm{d}p$ analytically from the same fundamental relations used to derive $R(p)$.\n- After recovering $p$, compute $v$ and $W$, and finally compute $\\rho$ via $\\rho = D/W$.\n\nNumerical conditions and units:\n- Use natural units where $c = 1$.\n- All computations are dimensionless. No physical units are required.\n\nTest suite:\nYour program must run the recovery on the following five test cases, each is a tuple $(D, S, \\tau, \\Gamma)$:\n- Case $1$: $(D, S, \\tau, \\Gamma) = (1.04828484, 0.46153846, 0.39017670, 1.33333333)$.\n- Case $2$: $(D, S, \\tau, \\Gamma) = (1.14707867, 3.31578948, 2.48713186, 1.33333333)$.\n- Case $3$: $(D, S, \\tau, \\Gamma) = (1.20000000, 0.00000000, 0.30000000, 1.66666667)$.\n- Case $4$: $(D, S, \\tau, \\Gamma) = (1.15470054, 0.66666668, 0.17863281, 1.66666667)$.\n- Case $5$: $(D, S, \\tau, \\Gamma) = (0.70888121, 6.96482412, 6.31629468, 1.33333333)$.\n\nCoverage rationale:\n- Case $1$ is a moderate-velocity, moderate-pressure state.\n- Case $2$ is a highly relativistic state with large Lorentz factor.\n- Case $3$ is a pure energy recovery at zero momentum ($S = 0$).\n- Case $4$ probes the near-cold regime with very small pressure.\n- Case $5$ is a near-ultrarelativistic momentum-dominated state.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each element of the list corresponds to one test case and must be itself a list of three floats $[\\rho, v, p]$ rounded to $8$ decimal places, for example\n$$\n[[\\rho_1, v_1, p_1],[\\rho_2, v_2, p_2],\\dots]\n$$\nwith each float rounded to $8$ decimal places.",
            "solution": "The user has provided a well-defined problem in the domain of special relativistic hydrodynamics. The problem is scientifically grounded, self-contained, and requires the derivation and implementation of a numerical algorithm. The validation criteria are met.\n\nThe problem requires the recovery of primitive variables $(\\rho, v, p)$ from the conserved variables $(D, S, \\tau)$ for a one-dimensional flow of a gamma-law ideal fluid. The quantities are the rest-mass density $\\rho$, fluid velocity $v$, pressure $p$, conserved rest-mass density $D$, conserved momentum $S$, and conserved energy $\\tau$. The adiabatic index is $\\Gamma$. The problem is set in natural units where the speed of light $c=1$.\n\nThe fundamental relations are:\nThe Lorentz factor:\n$$\nW = \\frac{1}{\\sqrt{1 - v^2}}\n$$\nThe specific enthalpy for a gamma-law fluid:\n$$\nh = 1 + \\frac{\\Gamma p}{(\\Gamma - 1)\\rho}\n$$\nThe conserved variables are defined in terms of the primitive variables as:\n1.  $D = \\rho W$\n2.  $S = \\rho h W^2 v$\n3.  $\\tau = \\rho h W^2 - p - D$\n\nThe physical constraints are $\\rho \\ge 0$, $p \\ge 0$, and $|v| < 1$.\n\nThe task is to derive and solve a single non-linear equation for the pressure $p$ and then recover the other primitive variables.\n\n**Step 1: Derivation of the Residual Equation for Pressure**\n\nWe are guided to use the auxiliary variable $E = \\tau + D$. From the definition of $\\tau$, this simplifies to:\n$$\nE = (\\rho h W^2 - p - D) + D = \\rho h W^2 - p\n$$\nRearranging gives a crucial identity for the total energy-momentum term:\n$$\n\\rho h W^2 = E + p\n$$\nThis quantity must be positive for any physical state, as $\\rho > 0$, $h \\ge 1$, and $W \\ge 1$.\n\nNext, we use the definition of the conserved momentum $S$:\n$$\nS = (\\rho h W^2) v = (E+p) v\n$$\nThis allows us to express the velocity $v$ as a function of pressure $p$:\n$$\nv(p) = \\frac{S}{E+p}\n$$\nThe physical constraint $|v| < 1$ translates to $|S| < |E+p|$. Since $E+p = \\rho h W^2$ is positive, this becomes $|S| < E+p$. This condition sets a lower bound on the pressure:\n$$\np > |S| - E\n$$\nCombined with the constraint $p \\ge 0$, the physically admissible pressure must satisfy $p \\ge \\max(0, |S|-E)$.\n\nFrom $v(p)$, we can express the squared Lorentz factor $W^2$ as a function of $p$:\n$$\nW^2(p) = \\frac{1}{1 - v(p)^2} = \\frac{1}{1 - \\left(\\frac{S}{E+p}\\right)^2} = \\frac{(E+p)^2}{(E+p)^2 - S^2}\n$$\n\nNow, we need to find a self-consistency relation that depends only on $p$. We have not yet used the definition of $D$ in combination with the equation of state.\nFrom $D=\\rho W$, we have $\\rho = D/W$. Substituting this into the specific enthalpy equation:\n$$\nh = 1 + \\frac{\\Gamma p}{(\\Gamma-1)\\rho} = 1 + \\frac{\\Gamma p W}{(\\Gamma-1)D}\n$$\nNow, substitute the expressions for $\\rho$ and $h$ into the identity $E+p=\\rho h W^2$:\n$$\nE+p = \\left(\\frac{D}{W}\\right) \\left(1 + \\frac{\\Gamma p W}{(\\Gamma-1)D}\\right) W^2\n$$\n$$\nE+p = \\frac{D}{W}W^2 + \\frac{D}{W}\\frac{\\Gamma p W}{(\\Gamma-1)D}W^2\n$$\n$$\nE+p = D W + \\frac{\\Gamma p}{\\Gamma-1}W^2\n$$\nThis equation involves only $p$ and the known quantities $(D,S,E,\\Gamma)$, since $W$ is a function of $p$. We can define a residual function $R(p)$ whose root is the desired pressure:\n$$\nR(p) = (E+p) - D W(p) - \\frac{\\Gamma p}{\\Gamma-1} W^2(p) = 0\n$$\nwhere $W(p) = \\sqrt{\\frac{(E+p)^2}{(E+p)^2 - S^2}}$. This is the non-linear equation to be solved.\n\n**Step 2: Derivation of the Derivative $\\mathrm{d}R/\\mathrm{d}p$**\n\nFor a Newton-Raphson-based solver, we need the analytical derivative of $R(p)$.\n$$\nR'(p) = \\frac{\\mathrm{d}R}{\\mathrm{d}p} = 1 - D \\frac{\\mathrm{d}W}{\\mathrm{d}p} - \\frac{\\Gamma}{\\Gamma-1} \\frac{\\mathrm{d}}{\\mathrm{d}p}(p W^2)\n$$\nUsing the product rule on the last term:\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}p}(p W^2) = 1 \\cdot W^2 + p \\frac{\\mathrm{d}(W^2)}{\\mathrm{d}p}\n$$\nWe need the derivatives of $W$ and $W^2$ with respect to $p$. It is convenient to first find $\\mathrm{d}v/\\mathrm{d}p$:\n$$\nv(p) = \\frac{S}{E+p} \\quad \\implies \\quad \\frac{\\mathrm{d}v}{\\mathrm{d}p} = - \\frac{S}{(E+p)^2} = - \\frac{v}{E+p}\n$$\nNow we differentiate $W^2 = (1-v^2)^{-1}$:\n$$\n\\frac{\\mathrm{d}(W^2)}{\\mathrm{d}p} = -(1-v^2)^{-2}(-2v)\\frac{\\mathrm{d}v}{\\mathrm{d}p} = 2vW^4 \\left(-\\frac{v}{E+p}\\right) = -\\frac{2v^2W^4}{E+p}\n$$\nAnd for $W = (W^2)^{1/2}$:\n$$\n\\frac{\\mathrm{d}W}{\\mathrm{d}p} = \\frac{1}{2W}\\frac{\\mathrm{d}(W^2)}{\\mathrm{d}p} = \\frac{1}{2W}\\left(-\\frac{2v^2W^4}{E+p}\\right) = -\\frac{v^2W^3}{E+p}\n$$\nSubstituting these into the expression for $R'(p)$:\n$$\nR'(p) = 1 - D\\left(-\\frac{v^2W^3}{E+p}\\right) - \\frac{\\Gamma}{\\Gamma-1}\\left(W^2 + p\\left(-\\frac{2v^2W^4}{E+p}\\right)\\right)\n$$\n$$\nR'(p) = 1 + \\frac{D v^2 W^3}{E+p} - \\frac{\\Gamma W^2}{\\Gamma-1} + \\frac{2 \\Gamma p v^2 W^4}{(\\Gamma-1)(E+p)}\n$$\nThis expression can be used in the Newton-Raphson iteration.\n\n**Step 3: Algorithmic Implementation**\n\nA robust root-finding algorithm is built as a hybrid of the Newton-Raphson method and the Bisection method. This ensures both rapid convergence when possible and guaranteed (but slower) convergence when Newton steps are unsafe.\n\n1.  **Special Case**: If $S=0$, then $v=0$ and $W=1$. The equations simplify significantly. The residual becomes linear:\n    $R(p) = (E+p) - D - \\frac{\\Gamma p}{\\Gamma-1} = (\\tau+D+p)-D - \\frac{\\Gamma p}{\\Gamma-1} = \\tau + p - \\frac{\\Gamma p}{\\Gamma-1} = 0$.\n    Solving for $p$: $\\tau = p(\\frac{\\Gamma}{\\Gamma-1} - 1) = p(\\frac{1}{\\Gamma-1})$, which gives $p = \\tau(\\Gamma-1)$. And from $D=\\rho W$, we get $\\rho=D$.\n\n2.  **Bracketing**: For the general case $S \\neq 0$, we must find a bracket $[p_{low}, p_{high}]$ that contains the root.\n    Analysis shows that for large $p$, $v \\to 0$, $W \\to 1$, and $R(p) \\approx \\tau - p/(\\Gamma-1)$, which tends to $-\\infty$. For the provided test cases, one can verify that the condition $\\tau^2+2\\tau D > S^2$ holds (or is very close), which guarantees that $R(0) \\ge 0$.\n    Thus, a root is guaranteed in $[0, \\infty)$. We can set $p_{low} = 0$ as the lower end of the bracket. The upper end, $p_{high}$, can be found by starting with a guess (e.g., $p_{high} = E(\\Gamma-1)$) and iteratively increasing it until $R(p_{high}) < 0$.\n\n3.  **Hybrid Solver**:\n    a. Initialize the bracket $[p_{neg}, p_{pos}]$ such that $R(p_{neg}) < 0$ and $R(p_{pos}) \\ge 0$.\n    b. Start with an initial guess for the pressure, for example, $p_{sol} = p_{pos}$.\n    c. Iterate until convergence:\n        i.   Calculate the Newton-Raphson step: $\\Delta p = -R(p_{sol})/R'(p_{sol})$.\n        ii.  Calculate the proposed update: $p_{new} = p_{sol} + \\Delta p$.\n        iii. Calculate the bisection point: $p_{bisect} = (p_{pos} + p_{neg})/2$.\n        iv.  If the Newton step is safe (i.e., $p_{new}$ is within the current bracket $[p_{neg}, p_{pos}]$), update $p_{sol} = p_{new}$. Otherwise, fall back to bisection: $p_{sol} = p_{bisect}$.\n        v.  Update the bracket $[p_{neg}, p_{pos}]$ based on the sign of $R(p_{sol})$.\n        vi. Check for convergence, e.g., if $|p_{pos} - p_{neg}|$ is below a tolerance.\n\n4.  **Final Recovery**: Once the root $p$ is found to sufficient precision, the remaining primitive variables are computed:\n    $$\n    v = \\frac{S}{E+p}\n    $$\n    $$\n    W = \\frac{1}{\\sqrt{1-v^2}}\n    $$\n    $$\n    \\rho = \\frac{D}{W}\n    $$\nThe solution adheres to these derivations and algorithmic design.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the primitive variable recovery for the given test cases.\n    \"\"\"\n    \n    TOL = 1e-12\n    MAX_ITER = 50\n\n    def recover_primitives(D, S, tau, Gamma):\n        \"\"\"\n        Recovers primitive variables (rho, v, p) from conserved variables (D, S, tau).\n        \"\"\"\n        if D <= 0:\n            # Unphysical state, though test cases should be valid.\n            return [np.nan, np.nan, np.nan]\n\n        E = tau + D\n        Gamma_m1 = Gamma - 1\n\n        # Case 1: Special case for S=0 (zero velocity)\n        if abs(S) < 1e-14:\n            p = tau * Gamma_m1\n            if p < 0:\n                # Unphysical pressure\n                return [np.nan, np.nan, np.nan]\n            rho = D\n            v = 0.0\n            return [rho, v, p]\n\n        # Case 2: Generic case with S != 0. Solve for p.\n        \n        # Define residual R(p) and its derivative R'(p)\n        def R_and_R_prime(p):\n            # Check physical bound on p. p must satisfy E+p > |S|\n            if E + p <= abs(S):\n                # Pressure is too low, v >= 1.\n                # R -> -inf as p approaches this limit from above.\n                # Return a large negative value for R and a large positive R' \n                # to push the solver towards higher p.\n                return -1e30, 1e30\n\n            v_val = S / (E + p)\n            v_sq = v_val**2\n            \n            if v_sq >= 1.0:\n                 return -1e30, 1e30\n\n            W_sq = 1.0 / (1.0 - v_sq)\n            W = np.sqrt(W_sq)\n\n            # R(p) = (E+p) - D*W - (Gamma*p/Gamma_m1) * W_sq\n            R_val = (E + p) - D * W - (Gamma * p / Gamma_m1) * W_sq\n\n            # R'(p) = 1 + (D*v^2*W^3)/(E+p) - (Gamma*W^2)/Gamma_m1 + (2*Gamma*p*v^2*W^4)/(Gamma_m1*(E+p))\n            term1_pr = 1.0\n            term2_pr = (D * v_sq * W**3) / (E + p)\n            term3_pr = (Gamma * W_sq) / Gamma_m1\n            term4_pr = (2 * Gamma * p * v_sq * W**4) / (Gamma_m1 * (E + p))\n            R_prime_val = term1_pr + term2_pr - term3_pr + term4_pr\n            \n            return R_val, R_prime_val\n\n        # Bracketing the root\n        # For the given test cases, R(0) >= 0.\n        p_pos = 0.0\n        r_pos, _ = R_and_R_prime(p_pos)\n        \n        if r_pos < 0:\n            # This indicates a more complex scenario, not expected for these test cases.\n            # A more robust bracketing by finding the function's maximum would be needed.\n            # However, for this problem set, this branch should not be taken.\n             return [np.nan, np.nan, np.nan]\n        \n        # Find upper bound for bracket where R < 0\n        p_neg_guess = max(TOL, E * Gamma_m1) \n        p_neg = p_neg_guess\n        for _ in range(10): # Limit doublings to avoid infinite loops\n            r_neg, _ = R_and_R_prime(p_neg)\n            if r_neg < 0:\n                break\n            p_neg *= 2.0\n        else:\n             return [np.nan, np.nan, np.nan] # Failed to find a bracket.\n\n        # Hybrid Newton-Raphson / Bisection solver\n        p_sol = p_pos # Start guess from a known side of the bracket\n        \n        for _ in range(MAX_ITER):\n            # Check for convergence\n            if abs(p_pos - p_neg) < TOL * (p_pos + p_neg + TOL):\n                break\n\n            r_sol, r_prime_sol = R_and_R_prime(p_sol)\n\n            # Safeguarded Newton-Raphson step\n            if abs(r_prime_sol) > TOL:\n                dp = -r_sol / r_prime_sol\n                p_new = p_sol + dp\n                \n                # If Newton step is within bracket, accept it. Otherwise, fall back to bisection.\n                if p_neg < p_new < p_pos:\n                    p_sol = p_new\n                else:\n                    p_sol = 0.5 * (p_pos + p_neg)\n            else:\n                 p_sol = 0.5 * (p_pos + p_neg) # Derivative is zero, use bisection\n            \n            # Update bracket\n            r_new, _ = R_and_R_prime(p_sol)\n            if r_new > 0:\n                p_pos = p_sol\n            else:\n                p_neg = p_sol\n        \n        # Once p is found, recover other primitive variables\n        p = p_sol\n        v = S / (E + p)\n        W = 1.0 / np.sqrt(1.0 - v**2)\n        rho = D / W\n        \n        if rho < 0 or p < 0:\n            return [np.nan, np.nan, np.nan]\n\n        return [rho, v, p]\n\n    test_cases = [\n        # (D, S, tau, Gamma)\n        (1.04828484, 0.46153846, 0.39017670, 1.33333333),\n        (1.14707867, 3.31578948, 2.48713186, 1.33333333),\n        (1.20000000, 0.00000000, 0.30000000, 1.66666667),\n        (1.15470054, 0.66666668, 0.17863281, 1.66666667),\n        (0.70888121, 6.96482412, 6.31629468, 1.33333333),\n    ]\n\n    results = []\n    for case in test_cases:\n        D_val, S_val, tau_val, Gamma_val = case\n        rho, v, p = recover_primitives(D_val, S_val, tau_val, Gamma_val)\n        \n        # Format the result with 8 decimal places\n        formatted_result = [f\"{x:.8f}\" for x in [rho, v, p]]\n        results.append(f\"[{','.join(formatted_result)}]\")\n\n    print(f\"[[{'],['.join(results)}]]\")\n\nsolve()\n```"
        }
    ]
}