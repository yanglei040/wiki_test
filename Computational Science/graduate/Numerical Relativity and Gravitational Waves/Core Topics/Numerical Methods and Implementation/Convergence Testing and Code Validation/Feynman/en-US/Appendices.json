{
    "hands_on_practices": [
        {
            "introduction": "A cornerstone of code validation is confirming that numerical errors decrease at the expected rate as the grid resolution is improved. This hands-on calculation demonstrates how to perform an *a posteriori* analysis from a standard three-resolution convergence test . Using hypothetical data from a binary black hole simulation, you will apply the foundational formulas to extract the observed convergence order and then use Richardson extrapolation to produce a more accurate estimate of the continuum value, providing essential practice in interpreting raw numerical output.",
            "id": "3470456",
            "problem": "A three-resolution convergence test is performed in a Numerical Relativity (NR) simulation of an equal-mass, non-spinning binary black hole merger governed by the General Theory of Relativity (GR). The code computes the dimensionless radiated energy fraction $E_{\\mathrm{rad}}/M$ at the peak of the $(\\ell=2,m=2)$ gravitational-wave amplitude, using a finite-difference discretization on a Cartesian mesh. Let the baseline grid spacing be $h$, and consider successive uniform refinements $h/2$ and $h/4$. The measured values of the observable at these resolutions are $u_h = 0.03450$, $u_{h/2} = 0.0354375$, and $u_{h/4} = 0.03549609375$. Assume the leading-order truncation error scales as $C h^p$ for some constant $C$ and order $p$, and that the floating-point arithmetic is IEEE 754 double precision with machine epsilon $\\epsilon = 2^{-52}$. Treat each reported $u$ as subject to an independent relative round-off uncertainty bounded by $\\epsilon$.\n\nStarting from the scaling assumption for the truncation error and first principles of a posteriori convergence analysis, determine:\n1) An a posteriori estimate of the convergence order $p$.\n2) A continuum-limit estimate of the observable via Richardson extrapolation constructed from the pair $(h/2,h/4)$.\n3) The absolute uncertainty in $p$ due to finite precision, using first-order linearization with respect to the differences involved in the $p$ estimate.\n4) The absolute uncertainty in the extrapolated continuum value from finite precision, obtained by first-order propagation of the independent round-off bounds on $u_{h/4}$, $u_{h/2}$, and the uncertainty in $p$.\n\nRound your final reported numbers to four significant figures. Express all quantities as dimensionless numbers.",
            "solution": "The problem is subjected to validation prior to any attempt at a solution.\n\n### Step 1: Extract Givens\n- **Simulation:** Numerical Relativity (NR), equal-mass, non-spinning binary black hole merger.\n- **Underlying Theory:** General Theory of Relativity (GR).\n- **Observable:** Dimensionless radiated energy fraction $E_{\\mathrm{rad}}/M$, denoted as $u$.\n- **Numerical Scheme:** Finite-difference on a Cartesian mesh with three grid spacings: $h$, $h/2$, and $h/4$.\n- **Measured Values:**\n    - $u_h = 0.03450$\n    - $u_{h/2} = 0.0354375$\n    - $u_{h/4} = 0.03549609375$\n- **Error Model:** The leading-order truncation error scales as $C h^p$, implying $u_k \\approx u_0 + C k^p$ for some continuum value $u_0$, constant $C$, order $p$, and where $k$ represents the grid spacing.\n- **Precision:** IEEE 754 double precision with machine epsilon $\\epsilon = 2^{-52}$.\n- **Uncertainty Model:** Each measurement $u$ has an independent relative round-off uncertainty bounded by $\\epsilon$, such that the absolute uncertainty is $\\delta u \\approx |u|\\epsilon$.\n- **Required Quantities:**\n    1. A posteriori estimate of convergence order $p$.\n    2. Continuum-limit estimate via Richardson extrapolation from $(h/2, h/4)$.\n    3. Absolute uncertainty in $p$, $\\delta p$, from finite precision.\n    4. Absolute uncertainty in the extrapolated continuum value, $\\delta u_0$, from finite precision.\n- **Reporting:** Round final numbers to four significant figures.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientific Grounding:** The problem is firmly grounded in computational science and numerical relativity. Convergence testing, Richardson extrapolation, and round-off error analysis are standard, essential procedures for code validation and obtaining reliable results from numerical simulations. The physical context (BBH merger) and the observable ($E_{\\mathrm{rad}}/M$) are standard in the field.\n- **Well-Posedness:** The problem is well-posed. It provides all necessary data and a clear error model to determine the requested quantities uniquely.\n- **Objectivity:** The problem is stated in precise, technical language with no subjective or ambiguous terms.\n- **Completeness and Consistency:** The data and assumptions are self-contained and consistent. The provided numerical values converge, and the parameters are sufficient for the analysis.\n- **Realism:** The numerical values for the radiated energy fraction are physically realistic for a binary black hole merger (a few percent of the total mass-energy). A convergence order of $p=4$ is achievable with higher-order finite-difference schemes.\n\n### Step 3: Verdict and Action\nThe problem is scientifically sound, well-posed, and complete. It is therefore deemed **VALID**. A detailed solution will be provided.\n\n### Solution Derivations\n\nThe fundamental assumption for the numerical solution $u_k$ at a grid spacing $k$ is its relation to the exact continuum solution $u_0$:\n$$u_k \\approx u_0 + C k^p$$\nwhere $C$ is a constant and $p$ is the convergence order. We are given three measurements at successively refined resolutions: $u_h$, $u_{h/2}$, and $u_{h/4}$.\n\n**1) A posteriori estimate of the convergence order $p$**\n\nWe write the approximation for the three resolutions:\n$$u_h \\approx u_0 + C h^p$$\n$$u_{h/2} \\approx u_0 + C \\left(\\frac{h}{2}\\right)^p = u_0 + \\frac{C h^p}{2^p}$$\n$$u_{h/4} \\approx u_0 + C \\left(\\frac{h}{4}\\right)^p = u_0 + \\frac{C h^p}{4^p}$$\nTo find $p$, we form differences to eliminate $u_0$:\n$$u_{h/2} - u_h \\approx \\frac{C h^p}{2^p} - C h^p = C h^p \\left(\\frac{1}{2^p} - 1\\right)$$\n$$u_{h/4} - u_{h/2} \\approx \\frac{C h^p}{4^p} - \\frac{C h^p}{2^p} = \\frac{C h^p}{2^p} \\left(\\frac{1}{2^p} - 1\\right)$$\nTaking the ratio of these differences eliminates $C$ and the term $(1/2^p - 1)$:\n$$R = \\frac{u_{h/2} - u_h}{u_{h/4} - u_{h/2}} \\approx \\frac{C h^p \\left(\\frac{1}{2^p} - 1\\right)}{\\frac{C h^p}{2^p} \\left(\\frac{1}{2^p} - 1\\right)} = 2^p$$\nThis gives the formula for the convergence order $p$:\n$$p = \\log_2(R) = \\frac{\\ln(R)}{\\ln(2)} = \\frac{\\ln\\left(\\frac{u_{h/2} - u_h}{u_{h/4} - u_{h/2}}\\right)}{\\ln(2)}$$\nSubstituting the given values:\n$$u_{h/2} - u_h = 0.0354375 - 0.03450 = 0.0009375$$\n$$u_{h/4} - u_{h/2} = 0.03549609375 - 0.0354375 = 0.00005859375$$\n$$R = \\frac{0.0009375}{0.00005859375} = 16$$\n$$p = \\log_2(16) = 4$$\nThe estimated convergence order is exactly $p=4$. Reporting to four significant figures gives $p=4.000$.\n\n**2) Continuum-limit estimate via Richardson extrapolation**\n\nRichardson extrapolation provides a higher-order estimate of the continuum value $u_0$. The general formula for a refinement factor $r$ is $u_0 \\approx u_{\\text{fine}} + \\frac{u_{\\text{fine}} - u_{\\text{coarse}}}{r^p - 1}$. The problem specifies using the pair $(h/2, h/4)$, for which the grid spacing is refined by a factor $r=2$. Thus, $u_{\\text{coarse}} = u_{h/2}$ and $u_{\\text{fine}} = u_{h/4}$.\nLet the extrapolated value be $u_{ext}$.\n$$u_{ext} \\approx u_{h/4} + \\frac{u_{h/4} - u_{h/2}}{2^p - 1}$$\nUsing $p=4$ and the previously calculated difference:\n$$u_{ext} \\approx 0.03549609375 + \\frac{0.00005859375}{2^4 - 1} = 0.03549609375 + \\frac{0.00005859375}{15}$$\n$$u_{ext} \\approx 0.03549609375 + 0.00000390625 = 0.0355$$\nThe continuum-limit estimate is exactly $u_{ext}=0.0355$. Reporting to four significant figures gives $u_{ext}=0.03550$.\n\n**3) Absolute uncertainty in $p$ due to finite precision**\n\nThe formula for $p$ is $p = \\frac{\\ln(A/B)}{\\ln(2)}$, where $A = u_{h/2} - u_h$ and $B = u_{h/4} - u_{h/2}$. The uncertainty $\\delta p$ is found by propagating the uncertainties of the measurements.\n$$(\\delta p)^2 = \\left(\\frac{1}{\\ln(2)}\\right)^2 \\left[ \\frac{(\\delta A)^2}{A^2} + \\frac{(\\delta B)^2}{B^2} \\right]$$\nThe uncertainties $\\delta A$ and $\\delta B$ arise from the uncertainties in the $u$ values, which are given as $\\delta u_k = u_k \\epsilon$. Since the round-off errors are independent, they add in quadrature:\n$$(\\delta A)^2 = (\\delta u_{h/2})^2 + (\\delta u_h)^2 = (u_{h/2}\\epsilon)^2 + (u_h\\epsilon)^2 = \\epsilon^2 (u_{h/2}^2 + u_h^2)$$\n$$(\\delta B)^2 = (\\delta u_{h/4})^2 + (\\delta u_{h/2})^2 = (u_{h/4}\\epsilon)^2 + (u_{h/2}\\epsilon)^2 = \\epsilon^2 (u_{h/4}^2 + u_{h/2}^2)$$\nSubstituting these into the expression for $(\\delta p)^2$:\n$$\\delta p = \\frac{\\epsilon}{\\ln(2)} \\sqrt{\\frac{u_{h/2}^2 + u_h^2}{(u_{h/2} - u_h)^2} + \\frac{u_{h/4}^2 + u_{h/2}^2}{(u_{h/4} - u_{h/2})^2}}$$\nWe now substitute the numerical values:\n$$ (u_{h/2}-u_h)^2 = (0.0009375)^2 \\approx 8.78906 \\times 10^{-7} $$\n$$ (u_{h/4}-u_{h/2})^2 = (0.00005859375)^2 \\approx 3.43323 \\times 10^{-9} $$\n$$ u_{h/2}^2 + u_h^2 = (0.0354375)^2 + (0.03450)^2 \\approx 0.0012558 + 0.0011903 = 0.0024461 $$\n$$ u_{h/4}^2 + u_{h/2}^2 = (0.03549609375)^2 + (0.0354375)^2 \\approx 0.00125997 + 0.00125581 = 0.00251578 $$\n$$\\frac{0.0024461}{8.78906 \\times 10^{-7}} \\approx 2783.1$$\n$$\\frac{0.00251578}{3.43323 \\times 10^{-9}} \\approx 732779$$\n$$\\delta p \\approx \\frac{2^{-52}}{\\ln(2)} \\sqrt{2783.1 + 732779} = \\frac{2^{-52}}{\\ln(2)} \\sqrt{735562} \\approx \\frac{2.2204 \\times 10^{-16}}{0.69315} \\times 857.65$$\n$$\\delta p \\approx (3.2033 \\times 10^{-16}) \\times 857.65 \\approx 2.7473 \\times 10^{-13}$$\nTo four significant figures, the absolute uncertainty in $p$ is $2.747 \\times 10^{-13}$.\n\n**4) Absolute uncertainty in the extrapolated continuum value**\n\nThe extrapolated value is $u_{ext} = \\frac{2^p u_{h/4} - u_{h/2}}{2^p - 1}$. We treat $u_{h/4}$, $u_{h/2}$, and $p$ as independent variables for the uncertainty propagation, as per the problem statement's structure.\n$$(\\delta u_{ext})^2 = \\left(\\frac{\\partial u_{ext}}{\\partial u_{h/4}}\\right)^2 (\\delta u_{h/4})^2 + \\left(\\frac{\\partial u_{ext}}{\\partial u_{h/2}}\\right)^2 (\\delta u_{h/2})^2 + \\left(\\frac{\\partial u_{ext}}{\\partial p}\\right)^2 (\\delta p)^2$$\nThe partial derivatives are:\n$$\\frac{\\partial u_{ext}}{\\partial u_{h/4}} = \\frac{2^p}{2^p - 1} = \\frac{16}{15}$$\n$$\\frac{\\partial u_{ext}}{\\partial u_{h/2}} = -\\frac{1}{2^p - 1} = -\\frac{1}{15}$$\n$$\\frac{\\partial u_{ext}}{\\partial p} = \\frac{(\\ln 2) 2^p (u_{h/2} - u_{h/4})}{(2^p - 1)^2} = \\frac{16 \\ln(2) (-0.00005859375)}{15^2} \\approx -2.889 \\times 10^{-6}$$\nThe uncertainties are $\\delta u_k = u_k \\epsilon$ and $\\delta p$ from part 3. Let's evaluate the contribution of each term to the total variance $(\\delta u_{ext})^2$.\nTerm 1 (from $u_{h/4}$):\n$$\\left(\\frac{16}{15}\\right)^2 (\\delta u_{h/4})^2 = \\left(\\frac{16}{15}\\right)^2 (u_{h/4} \\epsilon)^2 \\approx (1.1378) (0.035496 \\times 2^{-52})^2 \\approx 7.086 \\times 10^{-35}$$\nTerm 2 (from $u_{h/2}$):\n$$\\left(-\\frac{1}{15}\\right)^2 (\\delta u_{h/2})^2 = \\left(\\frac{1}{15}\\right)^2 (u_{h/2} \\epsilon)^2 \\approx (0.00444) (0.035438 \\times 2^{-52})^2 \\approx 2.757 \\times 10^{-37}$$\nTerm 3 (from $p$):\n$$\\left(\\frac{\\partial u_{ext}}{\\partial p}\\right)^2 (\\delta p)^2 \\approx (-2.889 \\times 10^{-6})^2 (2.747 \\times 10^{-13})^2 \\approx (8.346 \\times 10^{-12}) (7.546 \\times 10^{-26}) \\approx 6.30 \\times 10^{-37}$$\nThe contribution from the uncertainty in $u_{h/4}$ is dominant. The other two terms are more than two orders of magnitude smaller and can be considered negligible for this level of precision.\n$$(\\delta u_{ext})^2 \\approx \\left(\\frac{16}{15}\\right)^2 (u_{h/4}\\epsilon)^2 + \\left(-\\frac{1}{15}\\right)^2 (u_{h/2}\\epsilon)^2 = \\frac{\\epsilon^2}{15^2} [16^2 u_{h/4}^2 + u_{h/2}^2]$$\n$$\\delta u_{ext} \\approx \\frac{\\epsilon}{15} \\sqrt{256 u_{h/4}^2 + u_{h/2}^2} = \\frac{2^{-52}}{15} \\sqrt{256(0.035496...)^2 + (0.0354375)^2}$$\n$$\\delta u_{ext} \\approx \\frac{2^{-52}}{15} \\sqrt{0.32255 + 0.001256} = \\frac{2^{-52}}{15} \\sqrt{0.32381} \\approx \\frac{2.2204 \\times 10^{-16}}{15} \\times 0.56904$$\n$$\\delta u_{ext} \\approx (1.4803 \\times 10^{-17}) \\times 0.56904 \\approx 8.4235 \\times 10^{-18}$$\nTo four significant figures, the absolute uncertainty in $u_{ext}$ is $8.424 \\times 10^{-18}$.\n\n### Summary of Results\n- Estimated convergence order $p = 4.000$\n- Extrapolated continuum value $u_{ext} = 0.03550$\n- Absolute uncertainty in order $\\delta p = 2.747 \\times 10^{-13}$\n- Absolute uncertainty in extrapolated value $\\delta u_{ext} = 8.424 \\times 10^{-18}$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 4.000 & 0.03550 & 2.747 \\times 10^{-13} & 8.424 \\times 10^{-18} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "In complex simulations like a black hole merger, numerical accuracy is not uniform; strong-field effects near the merger can degrade convergence. This exercise moves beyond a single convergence value to a more realistic diagnostic: mapping where and when the simulation is in the \"asymptotic regime\" of clean convergence . By implementing a criterion on synthetic data that mimics a gravitational wave signal, you will create a spacetime map of numerical reliability, a powerful technique for assessing the trustworthiness of simulation results.",
            "id": "3470415",
            "problem": "You are validating a numerical relativity code that solves the Einstein field equations for binary black hole mergers in Geometric Units where the gravitational constant and speed of light are set to one ($G=c=1$). In the asymptotic discretization regime, the leading numerical truncation error of a finite difference scheme with formal order $p$ scales like $C h^{p}$ for a smooth quantity $u$, where $C$ is a smooth field and $h$ is a characteristic grid spacing. For a refinement factor $s$, consider three numerical solutions $u_{h}$, $u_{h/s}$, and $u_{h/s^{2}}$ computed with grid spacings $h$, $h/s$, and $h/s^{2}$, respectively. An operational asymptotic regime criterion requires that the ratio of norms of consecutive inter-resolution differences be close to $s^{p}$, computed across a set of variables at fixed spacetime points. Specifically, at each spacetime point $(t, x)$, define a variable vector $\\mathbf{u} = \\left(u^{(1)}, u^{(2)}, u^{(3)}\\right)$ comprising three physically relevant fields: the plus polarization strain $h_{+}$, the cross polarization strain $h_{\\times}$, and a curvature proxy $\\psi$. For each resolution triple, compute the Euclidean norm across variables of the difference vectors and test whether the ratio is close to $s^{p}$ within a specified tolerance.\n\nYou will construct synthetic fields on a one-dimensional spatial domain and three time instants representing pre-merger, merger, and post-merger. Use dimensionless Geometric Units; distances and times are measured in multiples of the total mass $M$ of the binary, but the final outputs are dimensionless fractions, so no unit conversion is required. The underlying exact fields are specified by a smooth envelope and phase, designed to mimic a gravitational-wave signal that peaks at the merger time. Let the spatial coordinate be $x \\in [-X_{\\max}, X_{\\max}]$ and the three evaluation times be $t_{\\mathrm{pre}}$, $t_{\\mathrm{merge}}$, and $t_{\\mathrm{post}}$. Define the envelope and phase,\n$$\nA(t) = \\exp\\!\\left(-\\frac{(t - t_{\\mathrm{merge}})^{2}}{2 \\sigma_{t}^{2}}\\right), \\quad\n\\Phi(t) = 2\\pi\\left(f_{0} t + \\frac{\\alpha}{2}(t - t_{\\mathrm{merge}})^{2} + \\frac{\\beta}{3}(t - t_{\\mathrm{merge}})^{3}\\right),\n$$\nand the exact fields,\n$$\nh_{+}^{\\mathrm{exact}}(t, x) = A(t)\\,\\cos\\!\\big(\\Phi(t)\\big)\\,\\exp\\!\\left(-\\frac{(x-x_{0})^{2}}{2\\sigma_{x}^{2}}\\right),\n$$\n$$\nh_{\\times}^{\\mathrm{exact}}(t, x) = A(t)\\,\\sin\\!\\big(\\Phi(t)\\big)\\,\\exp\\!\\left(-\\frac{(x-x_{0})^{2}}{2\\sigma_{x}^{2}}\\right),\n$$\n$$\n\\psi^{\\mathrm{exact}}(t, x) = A(t)\\,\\cos\\!\\big(2\\Phi(t) + \\pi/4\\big)\\,\\exp\\!\\left(-\\frac{(x-x_{0})^{2}}{\\sigma_{x}^{2}}\\right).\n$$\nSynthetic numerical solutions at resolution $h$ are defined by adding controlled truncation errors to the exact fields. Let the variable-dependent leading error amplitude be\n$$\nC_{+}(t, x) = A(t)\\left(1 + 0.3\\cos\\!\\big(\\Phi(t)\\big)\\right)\\exp\\!\\left(-\\frac{(x-x_{0})^{2}}{2\\sigma_{x}^{2}}\\right),\n$$\n$$\nC_{\\times}(t, x) = 1.1\\,C_{+}(t, x), \\quad C_{\\psi}(t, x) = 0.9\\,C_{+}(t, x).\n$$\nAllow the local effective order $p_{\\mathrm{actual}}(t)$ to degrade near merger, modeling strong-field effects: set\n$$\np_{\\mathrm{actual}}(t) = \\begin{cases}\np_{\\mathrm{degrade}} & \\text{if } A(t) \\ge \\theta,\\\\\np_{\\mathrm{formal}} & \\text{otherwise}.\n\\end{cases}\n$$\nOptionally include a subdominant error term with exponent $q = p_{\\mathrm{formal}} + 1$ and amplitude factor $\\gamma$ to probe sensitivity. For each variable $v \\in \\{+, \\times, \\psi\\}$ with corresponding amplitudes $C_{v}$ and $D_{v}$ (take $D_{v}(t, x) = 0.5\\,C_{v}(t, x)$), define the synthetic numerical fields\n$$\nu^{(v)}_{h}(t, x) = u^{(v)}_{\\mathrm{exact}}(t, x) + C_{v}(t, x)\\,h^{p_{\\mathrm{actual}}(t)} + \\gamma\\,D_{v}(t, x)\\,h^{q}.\n$$\nUse the refinement factor $s$, so that the three resolutions are $h$, $h/s$, and $h/s^{2}$. At each $(t, x)$, form the variable-difference vectors\n$$\n\\Delta_{1}(t, x) = \\big(u^{(v)}_{h} - u^{(v)}_{h/s}\\big)_{v}, \\qquad\n\\Delta_{2}(t, x) = \\big(u^{(v)}_{h/s} - u^{(v)}_{h/s^{2}}\\big)_{v},\n$$\ncompute their Euclidean norms across variables,\n$$\n\\|\\Delta_{1}(t, x)\\|_{2} = \\sqrt{\\sum_{v} \\big(u^{(v)}_{h}(t, x) - u^{(v)}_{h/s}(t, x)\\big)^{2}}, \\quad\n\\|\\Delta_{2}(t, x)\\|_{2} = \\sqrt{\\sum_{v} \\big(u^{(v)}_{h/s}(t, x) - u^{(v)}_{h/s^{2}}(t, x)\\big)^{2}},\n$$\nand define the ratio at $(t, x)$ as\n$$\nR(t, x) = \\frac{\\|\\Delta_{1}(t, x)\\|_{2}}{\\|\\Delta_{2}(t, x)\\|_{2}}.\n$$\nDeclare $(t, x)$ to be in the asymptotic regime if the denominator is safely nonzero and the relative deviation from the formal prediction $s^{p_{\\mathrm{formal}}}$ is within tolerance $\\tau$:\n$$\n\\|\\Delta_{2}(t, x)\\|_{2} > \\varepsilon \\quad \\text{and} \\quad \\frac{\\big|R(t, x) - s^{p_{\\mathrm{formal}}}\\big|}{s^{p_{\\mathrm{formal}}}} \\le \\tau.\n$$\nCompute, for each prescribed time, the fraction (a unitless float) of spatial points $x$ that satisfy the criterion. The final output for each test case is the list $\\big[f_{\\mathrm{pre}}, f_{\\mathrm{merge}}, f_{\\mathrm{post}}\\big]$ where each entry is the fraction at $t_{\\mathrm{pre}}$, $t_{\\mathrm{merge}}$, and $t_{\\mathrm{post}}$, respectively.\n\nImplementation details and constants to use:\n- Use a uniform grid with $N_{x}$ points over $x \\in [-X_{\\max}, X_{\\max}]$.\n- Use $x_{0} = 0$.\n- Use $h = 1$ as the base spacing parameter for error scaling, then $h/s$ and $h/s^{2}$ for the refined spacings.\n- Use a safety threshold $\\varepsilon$ for the denominator test.\n- Time and space are measured in multiples of $M$; the outputs are dimensionless fractions.\n\nYour program must implement the above model and compute the requested fractions for the following test suite, each being a separate case:\n\n- Case $1$ (general happy path with degradation near merger): $s = 1.2$, $p_{\\mathrm{formal}} = 4$, $p_{\\mathrm{degrade}} = 2$, $\\theta = 0.6$, $\\gamma = 0.0$, $t_{\\mathrm{merge}} = 50$, $t_{\\mathrm{pre}} = 30$, $t_{\\mathrm{post}} = 70$, $\\sigma_{t} = 10$, $f_{0} = 0.02$, $\\alpha = 8\\times 10^{-4}$, $\\beta = 5\\times 10^{-5}$, $X_{\\max} = 50$, $\\sigma_{x} = 20$, $N_{x} = 501$, $\\varepsilon = 10^{-12}$, $\\tau = 0.05$.\n- Case $2$ (edge case where formal and actual orders match everywhere): $s = 1.2$, $p_{\\mathrm{formal}} = 2$, $p_{\\mathrm{degrade}} = 2$, $\\theta = 0.6$, $\\gamma = 0.0$, $t_{\\mathrm{merge}} = 50$, $t_{\\mathrm{pre}} = 30$, $t_{\\mathrm{post}} = 70$, $\\sigma_{t} = 10$, $f_{0} = 0.02$, $\\alpha = 8\\times 10^{-4}$, $\\beta = 5\\times 10^{-5}$, $X_{\\max} = 50$, $\\sigma_{x} = 20$, $N_{x} = 501$, $\\varepsilon = 10^{-12}$, $\\tau = 0.05$.\n- Case $3$ (strict tolerance with mixed-order subdominant errors): $s = 1.2$, $p_{\\mathrm{formal}} = 4$, $p_{\\mathrm{degrade}} = 4$, $\\theta = 0.6$, $\\gamma = 0.15$, $t_{\\mathrm{merge}} = 50$, $t_{\\mathrm{pre}} = 30$, $t_{\\mathrm{post}} = 70$, $\\sigma_{t} = 10$, $f_{0} = 0.02$, $\\alpha = 8\\times 10^{-4}$, $\\beta = 5\\times 10^{-5}$, $X_{\\max} = 50$, $\\sigma_{x} = 20$, $N_{x} = 501$, $\\varepsilon = 10^{-12}$, $\\tau = 0.02$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each entry corresponds to a test case and is itself a list of three floats in the order $\\big[f_{\\mathrm{pre}}, f_{\\mathrm{merge}}, f_{\\mathrm{post}}\\big]$. For example, the format must be exactly like $[[r_{11}, r_{12}, r_{13}],[r_{21}, r_{22}, r_{23}],[r_{31}, r_{32}, r_{33}]]$ with no additional text.",
            "solution": "The user has provided a problem that requires the validation of a numerical relativity code by analyzing synthetic data. I will first validate the problem statement itself, then proceed to construct a solution.\n\n### Step 1: Problem Validation\n\nThe problem asks to implement a specific numerical analysis procedure on synthetic data designed to mimic gravitational wave signals from a binary black hole merger. I will verify the problem's validity based on the established criteria.\n\n-   **Extracted Givens**:\n    -   **Physical Model**: Binary black hole merger in Geometric Units ($G=c=1$).\n    -   **Numerical Scheme**: Finite difference with formal order $p$ and truncation error scaling like $C h^p$.\n    -   **Variables**: A vector $\\mathbf{u} = (h_{+}, h_{\\times}, \\psi)$ at each spacetime point $(t, x)$.\n    -   **Resolutions**: Three levels with spacings corresponding to abstract error parameters $h_1=1$, $h_2=1/s$, and $h_3=1/s^2$.\n    -   **Exact Fields**: Functions $h_{+}^{\\mathrm{exact}}(t,x)$, $h_{\\times}^{\\mathrm{exact}}(t,x)$, and $\\psi^{\\mathrm{exact}}(t,x)$ are provided, based on an envelope $A(t)$ and phase $\\Phi(t)$. All parameters and functional forms are explicitly defined.\n    -   **Synthetic Data Model**: Synthetic numerical solutions $u_h(t,x)$ are generated by adding a controlled error term to the exact solutions: $u^{(v)}_{h} = u^{(v)}_{\\mathrm{exact}} + C_{v} h^{p_{\\mathrm{actual}}} + \\gamma D_{v} h^{q}$. The error coefficients $C_v, D_v$ and the effective order $p_{\\mathrm{actual}}$ are precisely defined.\n    -   **Convergence Analysis**: The ratio $R(t, x) = \\|\\Delta_{1}\\|_{2} / \\|\\Delta_{2}\\|_{2}$ is computed, where $\\Delta_1$ and $\\Delta_2$ are inter-resolution differences of the variable vector $\\mathbf{u}$.\n    -   **Asymptotic Regime Criterion**: A spacetime point $(t,x)$ is deemed to be in the asymptotic regime if $\\|\\Delta_{2}(t, x)\\|_{2} > \\varepsilon$ and $|R(t, x) - s^{p_{\\mathrm{formal}}}| / s^{p_{\\mathrm{formal}}} \\le \\tau$.\n    -   **Task**: For three specific time instances ($t_{\\mathrm{pre}}, t_{\\mathrm{merge}}, t_{\\mathrm{post}}$), calculate the fraction of spatial points that satisfy the criterion.\n    -   **Constants and Parameters**: All necessary numerical values for three distinct test cases are provided, including refinement factor $s$, orders $p_{\\mathrm{formal}}, p_{\\mathrm{degrade}}$, thresholds $\\theta, \\varepsilon, \\tau$, subdominant error factor $\\gamma$, domain parameters $X_{\\max}, N_x, x_0$, and field parameters $\\sigma_t, \\sigma_x, f_0, \\alpha, \\beta$.\n\n-   **Validation Verdict**:\n    1.  **Scientific Soundness**: The problem is scientifically sound. It uses established concepts from numerical analysis (convergence order, truncation error) and applies them to a context (gravitational waves, numerical relativity) where such tests are standard practice. The use of synthetic data with known properties (an \"exact\" solution plus controlled error) is a cornerstone of verification and validation in computational science.\n    2.  **Formalizability and Relevance**: The problem is highly formal, with all components defined by precise mathematical expressions. It is directly relevant to the specified topic of code validation in numerical relativity.\n    3.  **Completeness and Consistency**: The problem is self-contained and complete. All necessary data, functions, and parameters are provided for each test case. There are no contradictions in the setup.\n    4.  **Feasibility**: The model is a simulation, and the parameters are well within a reasonable range for numerical computation. The task is computationally feasible.\n    5.  **Well-Posedness**: The problem is well-posed. The instructions lead to a unique, deterministic result for each test case. The terminology is unambiguous.\n    6.  **Triviality**: The problem is not trivial, as it requires careful implementation of multiple mathematical formulas and logical conditions. It represents a meaningful exercise in computational validation.\n    7.  **Verifiability**: The problem is completely verifiable by an independent implementation of the described algorithm.\n\n-   **Conclusion**: The problem statement is valid. I will proceed with generating a solution.\n\n### Step 2: Solution Design\n\nThe solution will be a direct implementation of the model described. The core of the algorithm involves iterating through a set of test cases. For each case, it iterates through three specified time points. At each time, it calculates the required quantities for all points on a one-dimensional spatial grid. The use of the NumPy library is ideal for performing these calculations efficiently on arrays of spatial points.\n\nThe logical flow for a single test case at a single time $t$ is as follows:\n1.  Define the spatial grid $x$ of $N_x$ points on $[-X_{\\max}, X_{\\max}]$.\n2.  Calculate the time-dependent quantities: the envelope $A(t)$, the phase $\\Phi(t)$, and the actual convergence order $p_{\\mathrm{actual}}(t)$. The latter is determined by comparing $A(t)$ to the threshold $\\theta$.\n3.  Calculate the exact fields $h_{+}^{\\mathrm{exact}}$, $h_{\\times}^{\\mathrm{exact}}$, and $\\psi^{\\mathrm{exact}}$ as functions of $x$ at the given time $t$. These are vector (array) quantities.\n4.  Calculate the error amplitude fields $C_{+}$, $C_{\\times}$, and $C_{\\psi}$ as functions of $x$ at time $t$. The subdominant error amplitudes $D_v$ are proportional to $C_v$.\n5.  Define the three resolution parameters $h_1=1$, $h_2=1/s$, $h_3=1/s^2$.\n6.  For each variable $v \\in \\{+, \\times, \\psi\\}$, construct the three synthetic numerical solutions $u^{(v)}_{h_1}, u^{(v)}_{h_2}, u^{(v)}_{h_3}$ by adding the specified error terms to the exact solution.\n7.  Calculate the difference vectors. For each spatial point $x_i$, $\\Delta_1(t, x_i) = (u^{(+)}_{h_1} - u^{(+)}_{h_2}, u^{(\\times)}_{h_1} - u^{(\\times)}_{h_2}, u^{(\\psi)}_{h_1} - u^{(\\psi)}_{h_2})_i$ and similarly for $\\Delta_2(t, x_i)$ using resolutions $h_2$ and $h_3$.\n8.  Compute the Euclidean norms $\\|\\Delta_1(t, x)\\|_2$ and $\\|\\Delta_2(t, x)\\|_2$ across the variables for each spatial point. This yields two arrays of length $N_x$.\n9.  Calculate the ratio $R(t, x) = \\|\\Delta_1(t, x)\\|_2 / \\|\\Delta_2(t, x)\\|_2$.\n10. Apply the asymptotic regime criterion at each spatial point:\n    a. Check if $\\|\\Delta_2(t, x)\\|_2 > \\varepsilon$.\n    b. For points satisfying (a), check if the relative deviation $|R(t, x) - s^{p_{\\mathrm{formal}}}|/s^{p_{\\mathrm{formal}}} \\le \\tau$.\n11. Count the number of spatial points that satisfy both conditions.\n12. The result for time $t$ is this count divided by the total number of points, $N_x$.\n\nThis process is repeated for each of the three times ($t_{\\mathrm{pre}}, t_{\\mathrm{merge}}, t_{\\mathrm{post}}$) to generate the list of three fractions for the test case. The final output aggregates these lists from all three test cases.\n\nLet's briefly analyze the expected outcomes:\n-   **Case 1**: $p_{\\mathrm{formal}}=4$, $p_{\\mathrm{degrade}}=2$. At $t_{\\text{pre/post}}$, $p_{\\mathrm{actual}}=4$, so the measured ratio $R$ should be $s^4$, matching the formal prediction. At $t_{\\text{merge}}$, $p_{\\mathrm{actual}}=2$, so $R=s^2$, which deviates significantly from $s^4$. We expect fractions close to $[1.0, 0.0, 1.0]$.\n-   **Case 2**: $p_{\\mathrm{formal}}=2$, $p_{\\mathrm{degrade}}=2$. The actual order $p_{\\mathrm{actual}}$ is always $2$. The ratio $R$ will always be $s^2$, matching the formal prediction $s^2$. We expect fractions close to $[1.0, 1.0, 1.0]$.\n-   **Case 3**: $p_{\\mathrm{formal}}=4$, $p_{\\mathrm{degrade}}=4$. The actual order $p_{\\mathrm{actual}}$ is always $4$. However, a subdominant error term with $\\gamma=0.15$ is included. This will cause the ratio $R$ to deviate slightly from the ideal $s^4$. A preliminary calculation indicates this deviation is within the specified tolerance $\\tau=0.02$. We expect fractions close to $[1.0, 1.0, 1.0]$.\n\nThe implementation will follow this logic using NumPy for vectorized computations.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of validating a numerical relativity code using synthetic data.\n    Computes the fraction of spatial points in the asymptotic regime for three test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: general happy path with degradation near merger\n        {'s': 1.2, 'p_formal': 4, 'p_degrade': 2, 'theta': 0.6, 'gamma': 0.0,\n         't_merge': 50, 't_pre': 30, 't_post': 70, 'sigma_t': 10, 'f0': 0.02,\n         'alpha': 8e-4, 'beta': 5e-5, 'X_max': 50, 'sigma_x': 20, 'N_x': 501,\n         'epsilon': 1e-12, 'tau': 0.05, 'x0': 0},\n        # Case 2: edge case where formal and actual orders match everywhere\n        {'s': 1.2, 'p_formal': 2, 'p_degrade': 2, 'theta': 0.6, 'gamma': 0.0,\n         't_merge': 50, 't_pre': 30, 't_post': 70, 'sigma_t': 10, 'f0': 0.02,\n         'alpha': 8e-4, 'beta': 5e-5, 'X_max': 50, 'sigma_x': 20, 'N_x': 501,\n         'epsilon': 1e-12, 'tau': 0.05, 'x0': 0},\n        # Case 3: strict tolerance with mixed-order subdominant errors\n        {'s': 1.2, 'p_formal': 4, 'p_degrade': 4, 'theta': 0.6, 'gamma': 0.15,\n         't_merge': 50, 't_pre': 30, 't_post': 70, 'sigma_t': 10, 'f0': 0.02,\n         'alpha': 8e-4, 'beta': 5e-5, 'X_max': 50, 'sigma_x': 20, 'N_x': 501,\n         'epsilon': 1e-12, 'tau': 0.02, 'x0': 0}\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        # Unpack parameters for the current test case\n        s, p_formal, p_degrade, theta, gamma = case['s'], case['p_formal'], case['p_degrade'], case['theta'], case['gamma']\n        t_merge, sigma_t = case['t_merge'], case['sigma_t']\n        f0, alpha, beta = case['f0'], case['alpha'], case['beta']\n        X_max, sigma_x, N_x, x0 = case['X_max'], case['sigma_x'], case['N_x'], case['x0']\n        epsilon, tau = case['epsilon'], case['tau']\n        \n        times = [case['t_pre'], case['t_merge'], case['t_post']]\n\n        # Spatial grid\n        x = np.linspace(-X_max, X_max, N_x)\n        \n        # Resolutions based on the abstract error parameter h=1\n        resolutions_h = [1.0, 1.0 / s, 1.0 / s**2]\n        \n        case_fractions = []\n\n        for t in times:\n            # Calculate time-dependent components\n            A_t = np.exp(-(t - t_merge)**2 / (2 * sigma_t**2))\n            dt = t - t_merge\n            Phi_t = 2 * np.pi * (f0 * t + 0.5 * alpha * dt**2 + beta / 3 * dt**3)\n            \n            p_actual = p_degrade if A_t >= theta else p_formal\n            q = p_formal + 1\n\n            # Calculate spatially-dependent components\n            spatial_gauss_1 = np.exp(-(x - x0)**2 / (2 * sigma_x**2))\n            spatial_gauss_2 = np.exp(-(x - x0)**2 / (sigma_x**2))\n\n            # Define exact fields\n            u_exact = {\n                '+': A_t * np.cos(Phi_t) * spatial_gauss_1,\n                'x': A_t * np.sin(Phi_t) * spatial_gauss_1,\n                'psi': A_t * np.cos(2 * Phi_t + np.pi / 4) * spatial_gauss_2,\n            }\n\n            # Define error amplitudes\n            C_plus = A_t * (1 + 0.3 * np.cos(Phi_t)) * spatial_gauss_1\n            C_v = {\n                '+': C_plus,\n                'x': 1.1 * C_plus,\n                'psi': 0.9 * C_plus,\n            }\n            D_v = {v: 0.5 * C_v[v] for v in C_v}\n\n            # Generate synthetic data for all variables and resolutions\n            u_solutions = {}\n            for v in ['+', 'x', 'psi']:\n                u_solutions[v] = [\n                    u_exact[v] + C_v[v] * h**p_actual + gamma * D_v[v] * h**q\n                    for h in resolutions_h\n                ]\n\n            # Calculate inter-resolution differences\n            diff1 = {v: u_solutions[v][0] - u_solutions[v][1] for v in u_solutions}\n            diff2 = {v: u_solutions[v][1] - u_solutions[v][2] for v in u_solutions}\n\n            # Calculate Euclidean norms of the difference vectors\n            norm_delta1 = np.sqrt(sum(d**2 for d in diff1.values()))\n            norm_delta2 = np.sqrt(sum(d**2 for d in diff2.values()))\n\n            # Calculate the ratio R, handling potential division by zero\n            with np.errstate(divide='ignore', invalid='ignore'):\n                R = norm_delta1 / norm_delta2\n                # Resulting NaNs or Infs will be handled by the criterion logic.\n            \n            # Apply the asymptotic regime criterion\n            s_p_formal = s**p_formal\n            \n            # 1. Denominator must be non-zero (greater than a small epsilon)\n            valid_denominator_mask = norm_delta2 > epsilon\n            \n            # Initialize all points as not satisfying the criterion\n            asymptotic_mask = np.full(N_x, False)\n            \n            # 2. On points with a valid denominator, check the ratio condition\n            if np.any(valid_denominator_mask):\n                relative_deviation = np.abs(R[valid_denominator_mask] - s_p_formal) / s_p_formal\n                asymptotic_mask[valid_denominator_mask] = (relative_deviation <= tau)\n            \n            # Calculate the fraction of points satisfying the full criterion\n            asymptotic_count = np.sum(asymptotic_mask)\n            fraction = asymptotic_count / N_x\n            case_fractions.append(fraction)\n            \n        all_results.append(case_fractions)\n\n    # Final print statement in the exact required format.\n    print(f\"[[{all_results[0][0]},{all_results[0][1]},{all_results[0][2]}],[{all_results[1][0]},{all_results[1][1]},{all_results[1][2]}],[{all_results[2][0]},{all_results[2][1]},{all_results[2][2]}]]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The stability and accuracy of an evolution code depend critically on its time-integration algorithm. This practice focuses on analyzing the time-stepping component of a numerical relativity code, using a simplified model of constraint propagation . You will investigate the stability properties of widely-used Strong-Stability-Preserving Runge-Kutta (SSP-RK) schemes to determine their maximum allowable Courant-Friedrichs-Lewy (CFL) number and then perform a convergence study to verify that the schemes achieve their theoretical order of accuracy in time.",
            "id": "3470417",
            "problem": "Consider a simplified one-dimensional model of the constraint-damped Generalized Harmonic (GH) evolution used in numerical relativity to analyze gravitational-wave spacetimes. In this model, the propagation of gauge constraints is represented by a scalar advection-damping equation on a periodic domain, which is evolved in time by explicit Strong-Stability-Preserving Runge-Kutta (SSP RK) schemes. The goal is two-fold: to compare the allowable Courant-Friedrichs-Lewy (CFL) numbers for different SSP RK schemes in terms of linear stability for the semi-discrete operator, and to validate the temporal convergence of the solution under timestep refinement while holding the spatial discretization fixed.\n\nFundamental base:\n- The model partial differential equation (PDE) is\n$$\n\\partial_t u(x,t) + v\\,\\partial_x u(x,t) = -\\gamma\\,u(x,t),\n$$\nwhere $u$ is the scalar constraint proxy, $v>0$ is the advection speed, and $\\gamma\\ge 0$ is the constraint damping parameter.\n- The method-of-lines semi-discretization uses a first-order upwind difference for the spatial derivative on a periodic grid. For $N$ grid points on the interval $[0,L)$ with spacing $\\Delta x = L/N$, the semi-discrete operator acts on a grid function $u_i$ as\n$$\n\\left(\\mathcal{L}u\\right)_i = -\\,v\\,\\frac{u_i - u_{i-1}}{\\Delta x} - \\gamma\\,u_i,\\quad i=0,1,\\dots,N-1,\n$$\nwith periodic indexing $u_{-1}\\equiv u_{N-1}$. This yields a circulant matrix whose eigenvalues are given by the discrete Fourier symbol of the upwind operator shifted by the damping:\n$$\n\\lambda_m = -\\gamma - v\\,\\frac{1 - e^{-\\,\\mathrm{i}\\,\\theta_m}}{\\Delta x},\\quad \\theta_m = \\frac{2\\pi m}{N},\\quad m=0,1,\\dots,N-1.\n$$\n- An explicit $s$-stage Strong-Stability-Preserving Runge-Kutta (SSP RK) scheme defines a polynomial stability function $R(z)$ for the linear test problem $\\dot{y}=\\lambda y$, such that one step advances $y^{n+1} = R(\\Delta t\\,\\lambda)\\,y^n$. Linear stability of the time-stepping method for the semi-discrete operator requires\n$$\n\\max_{m\\in\\{0,\\dots,N-1\\}} \\left| R\\left(\\Delta t\\,\\lambda_m\\right) \\right| \\le 1.\n$$\nThe associated CFL number is $\\nu = v\\,\\Delta t/\\Delta x$.\n\nTasks:\n1. Implement the periodic semi-discrete operator $\\mathcal{L}$ as specified above for given $(L,v,\\gamma,N)$, and compute its spectrum $\\{\\lambda_m\\}$ via the discrete Fourier symbol.\n2. For the second-order two-stage Strong-Stability-Preserving Runge-Kutta method (SSP RK$(2,2)$) and the third-order three-stage Strong-Stability-Preserving Runge-Kutta method (SSP RK$(3,3)$), determine numerically the maximum allowable CFL numbers $\\nu_{\\max}$ such that the linear stability requirement holds for the entire spectrum of $\\mathcal{L}$. You must search over $\\Delta t$ and verify the bound $\\left|R\\left(\\Delta t\\,\\lambda_m\\right)\\right|\\le 1$ for all modes $m$; then report $\\nu_{\\max} = v\\,\\Delta t_{\\max}/\\Delta x$.\n3. Validate temporal convergence under timestep refinement at fixed spatial resolution using both SSP RK$(2,2)$ and SSP RK$(3,3)$. Evolve the PDE from $t=0$ to $t=T$ for the smooth initial data\n$$\nu(x,0) = \\sin\\!\\left(\\frac{2\\pi x}{L}\\right),\n$$\nand compare the numerical solution to the exact solution\n$$\nu(x,t) = e^{-\\gamma t}\\,\\sin\\!\\left(\\frac{2\\pi}{L}\\left(x - v\\,t\\right)\\right).\n$$\nCompute the discrete $\\ell_2$ error at $t=T$,\n$$\nE(\\Delta t) = \\left( \\Delta x \\sum_{i=0}^{N-1} \\left[ u_i^{\\mathrm{num}}(T) - u^{\\mathrm{exact}}(x_i,T) \\right]^2 \\right)^{1/2}.\n$$\nUse at least four timestep sizes $\\Delta t$ with approximately halving refinement, and estimate the empirical temporal order $p$ of each scheme by a least-squares fit to the relation $\\log E(\\Delta t) \\approx \\alpha + p\\,\\log(\\Delta t)$. Report the slope $p$ for SSP RK$(2,2)$ and SSP RK$(3,3)$.\n\nUnits:\n- Use dimensionless units consistent with relativistic codes, i.e., set the speed of light to $c=1$. All quantities are to be treated as dimensionless. No physical units are required in the output.\n\nAngle unit:\n- All angles in trigonometric functions are in radians.\n\nTest suite:\n- Compute $\\nu_{\\max}$ for the following three parameter sets:\n  - Case $1$: $L=1$, $v=1$, $\\gamma=0$, $N=128$.\n  - Case $2$: $L=1$, $v=1$, $\\gamma=0.1$, $N=128$.\n  - Case $3$: $L=1$, $v=1$, $\\gamma=2.0$, $N=128$.\n- Validate convergence for\n  - Convergence case: $L=1$, $v=1$, $\\gamma=0.5$, $N=512$, $T=0.5$, with timestep refinements corresponding to CFL numbers $\\nu\\in\\{0.1,\\,0.05,\\,0.025,\\,0.0125\\}$ for each scheme.\n\nAnswer specification:\n- For each of the three stability cases, return the maximum CFL numbers found for SSP RK$(2,2)$ and SSP RK$(3,3)$.\n- For the convergence case, return the empirical temporal orders $p$ for SSP RK$(2,2)$ and SSP RK$(3,3)$ as floating-point numbers.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets in the following order:\n$$\n[\\nu_{\\max}^{(2,2)}\\text{(Case 1)},\\ \\nu_{\\max}^{(3,3)}\\text{(Case 1)},\\ \\nu_{\\max}^{(2,2)}\\text{(Case 2)},\\ \\nu_{\\max}^{(3,3)}\\text{(Case 2)},\\ \\nu_{\\max}^{(2,2)}\\text{(Case 3)},\\ \\nu_{\\max}^{(3,3)}\\text{(Case 3)},\\ p^{(2,2)},\\ p^{(3,3)}].\n$$\nAll entries must be floats. Your program must not read any input and must print exactly this single line.",
            "solution": "The problem poses a well-defined task in the field of numerical analysis for partial differential equations, specifically focusing on the stability and convergence of time-integration schemes for a model equation relevant to numerical relativity. The problem statement is scientifically sound, internally consistent, and contains all necessary information, assuming standard knowledge of the specified numerical methods. We will proceed to a full solution.\n\n**1. The Semi-Discrete System and its Spectrum**\n\nThe governing partial differential equation (PDE) is the $1$D linear advection-damping equation on a periodic domain $[0,L)$:\n$$\n\\partial_t u(x,t) + v\\,\\partial_x u(x,t) = -\\gamma\\,u(x,t)\n$$\nHere, $u(x,t)$ is a scalar field, $v > 0$ is the constant advection speed, and $\\gamma \\ge 0$ is the damping coefficient.\n\nThe method of lines is employed, where the spatial derivatives are discretized first, yielding a system of ordinary differential equations (ODEs) in time. The spatial domain is discretized into $N$ grid points $x_i = i\\Delta x$ for $i=0,\\dots,N-1$, with grid spacing $\\Delta x=L/N$. The spatial derivative $\\partial_x u$ is approximated using a first-order upwind finite difference scheme, chosen because the advection speed $v$ is positive. This leads to the semi-discrete system:\n$$\n\\frac{d u_i(t)}{dt} = \\left(\\mathcal{L}u\\right)_i = -v\\,\\frac{u_i(t) - u_{i-1}(t)}{\\Delta x} - \\gamma\\,u_i(t)\n$$\nwhere $u_i(t) \\approx u(x_i, t)$ and periodic boundary conditions imply $u_{-1} \\equiv u_{N-1}$. The operator $\\mathcal{L}$ can be represented by a circulant matrix.\n\nThe eigenvalues of a circulant matrix are given by its discrete Fourier symbol. For the operator $\\mathcal{L}$, the eigenvalues are explicitly given as:\n$$\n\\lambda_m = -\\gamma - v\\,\\frac{1 - e^{-\\mathrm{i}\\,\\theta_m}}{\\Delta x}, \\quad \\text{for } m = 0, 1, \\dots, N-1\n$$\nwhere $\\theta_m = \\frac{2\\pi m}{N}$. These eigenvalues lie in the complex plane. We can rewrite the expression to understand their geometric arrangement:\n$$\n\\lambda_m = -\\gamma - \\frac{v}{\\Delta x} + \\frac{v}{\\Delta x}e^{-\\mathrm{i}\\,\\theta_m}\n$$\nThis shows that the eigenvalues $\\{\\lambda_m\\}_{m=0}^{N-1}$ lie on a circle in the complex plane with center $C = -\\gamma - \\frac{v}{\\Delta x}$ and radius $R = \\frac{v}{\\Delta x}$. All eigenvalues reside in the left-half of the complex plane, as $\\operatorname{Re}(\\lambda_m) = -\\gamma - \\frac{v}{\\Delta x}(1-\\cos\\theta_m) \\le -\\gamma \\le 0$.\n\n**2. SSP RK Methods and Linear Stability Analysis**\n\nThe system of ODEs $\\frac{d\\vec{u}}{dt} = \\mathcal{L}\\vec{u}$ is integrated in time using explicit Strong-Stability-Preserving (SSP) Runge-Kutta (RK) methods. For a linear ODE $\\dot{y} = \\lambda y$, a single step of an RK method advances the solution as $y^{n+1} = R(z) y^n$, where $z = \\Delta t \\lambda$ and $R(z)$ is the stability polynomial of the method.\n\nThe problem specifies two methods:\n- **SSP RK(2,2)**: A second-order, two-stage method with stability polynomial $R_{(2,2)}(z) = 1 + z + \\frac{1}{2}z^2$.\n- **SSP RK(3,3)**: A third-order, three-stage method with stability polynomial $R_{(3,3)}(z) = 1 + z + \\frac{1}{2}z^2 + \\frac{1}{6}z^3$.\n\nFor the full semi-discrete system to be stable, the time-stepping method must be stable for every mode, which translates to the condition:\n$$\n\\max_{m=0,\\dots,N-1} \\left| R\\left(\\Delta t\\,\\lambda_m\\right) \\right| \\le 1\n$$\nThe set of points $\\{z \\in \\mathbb{C} : |R(z)| \\le 1\\}$ is called the region of absolute stability. The stability condition requires that the scaled spectrum of the operator, $\\{\\Delta t \\lambda_m\\}$, must lie entirely within this region.\n\nThe task is to find the maximum allowable CFL number, $\\nu_{\\max} = v\\,\\Delta t_{\\max}/\\Delta x$. This is equivalent to finding the maximum time step $\\Delta t_{\\max}$ for which the stability condition holds. This is a root-finding problem for $\\Delta t_{\\max}$. A robust method to find it is a bisection search over the CFL number $\\nu = v\\,\\Delta t/\\Delta x$. For a given $\\nu$, we compute $\\Delta t = \\nu \\Delta x / v$ and check if $\\max_m |R(\\Delta t\\,\\lambda_m)| \\le 1$. The search identifies the largest $\\nu$ (and thus $\\Delta t$) that satisfies this criterion.\n\n**3. Temporal Convergence Validation**\n\nThe second task is to verify that the numerical schemes achieve their expected theoretical order of convergence in time. This is done by evolving a known smooth initial condition and comparing the numerical result to the exact analytical solution.\n\nThe PDE is evolved from $t=0$ to $t=T$ with the initial condition $u(x,0) = \\sin(2\\pi x/L)$. The exact solution is given as:\n$$\nu(x,t) = e^{-\\gamma t}\\,\\sin\\left(\\frac{2\\pi}{L}(x - vt)\\right)\n$$\nThe numerical solution $u_i^{\\mathrm{num}}(T)$ is computed by applying the time-stepping algorithm for a fixed spatial resolution $N$ and a given time step $\\Delta t$. For the SSP RK(2,2) and SSP RK(3,3) methods, one time step $u^n \\to u^{n+1}$ is performed by computing intermediate stages according to the respective Butcher tableaux. For instance, for SSP RK(3,3):\n1. $k_1 = \\mathcal{L}(u^n)$\n2. $k_2 = \\mathcal{L}(u^n + \\Delta t\\,k_1)$\n3. $k_3 = \\mathcal{L}(u^n + \\frac{1}{4}\\Delta t\\,k_1 + \\frac{1}{4}\\Delta t\\,k_2)$\n4. $u^{n+1} = u^n + \\Delta t\\left(\\frac{1}{6}k_1 + \\frac{1}{6}k_2 + \\frac{2}{3}k_3\\right)$\n\nThe error of the numerical solution is measured at the final time $T$ using the discrete $\\ell_2$ norm:\n$$\nE(\\Delta t) = \\left( \\Delta x \\sum_{i=0}^{N-1} \\left[ u_i^{\\mathrm{num}}(T) - u^{\\mathrm{exact}}(x_i,T) \\right]^2 \\right)^{1/2}\n$$\nFor a method of order $p$, the error is expected to behave as $E(\\Delta t) \\propto (\\Delta t)^p$, assuming the time step is small enough so that temporal error dominates spatial error. This relationship can be expressed as $\\log E(\\Delta t) \\approx \\alpha + p\\,\\log(\\Delta t)$. The empirical order of convergence $p$ is estimated by computing the error $E(\\Delta t)$ for a sequence of refining time steps (in this case, four values of $\\Delta t$) and performing a linear least-squares fit to the $(\\log(\\Delta t), \\log(E))$ data. The slope of the resulting line is the estimated order $p$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the given problem: calculates maximum CFL numbers for stability and\n    validates temporal convergence orders for two SSP RK schemes.\n    \"\"\"\n\n    # --- Part 1: Stability Analysis ---\n\n    def R_ssp_rk22(z):\n        \"\"\"Stability polynomial for SSP RK(2,2).\"\"\"\n        return 1 + z + 0.5 * z**2\n\n    def R_ssp_rk33(z):\n        \"\"\"Stability polynomial for SSP RK(3,3).\"\"\"\n        return 1 + z + 0.5 * z**2 + (1/6.0) * z**3\n\n    def is_stable(nu, L, v, gamma, N, R_func):\n        \"\"\"Checks if a given CFL number 'nu' is stable.\"\"\"\n        dx = L / N\n        dt = nu * dx / v\n        m = np.arange(N)\n        theta_m = 2 * np.pi * m / N\n        \n        # Calculate eigenvalues of the semi-discrete operator\n        lambda_m = -gamma - (v / dx) * (1 - np.exp(-1j * theta_m))\n        \n        # Scaled eigenvalues for stability function\n        z = dt * lambda_m\n        \n        # Check if all amplification factors are within the unit circle\n        amplification_factors = np.abs(R_func(z))\n        \n        # Use a small tolerance for floating-point comparisons\n        return np.max(amplification_factors) <= 1.0 + 1e-9\n\n    def find_nu_max(L, v, gamma, N, R_func):\n        \"\"\"\n        Finds the maximum stable CFL number using a bisection search.\n        \"\"\"\n        nu_low = 0.0\n        nu_high = 2.5 # A safe upper bound for these methods\n\n        # Bisection search for 100 iterations for high precision\n        for _ in range(100):\n            nu_mid = (nu_low + nu_high) / 2\n            # Break if converged\n            if nu_mid == nu_low or nu_mid == nu_high:\n                break\n            \n            if is_stable(nu_mid, L, v, gamma, N, R_func):\n                nu_low = nu_mid  # This value is stable, try for a higher one\n            else:\n                nu_high = nu_mid # This value is unstable, reduce the upper bound\n        \n        return nu_low\n\n    stability_cases = [\n        (1, 1, 0.0, 128),  # Case 1\n        (1, 1, 0.1, 128),  # Case 2\n        (1, 1, 2.0, 128),  # Case 3\n    ]\n    \n    results = []\n    for L, v, gamma, N in stability_cases:\n        nu_max_22 = find_nu_max(L, v, gamma, N, R_ssp_rk22)\n        nu_max_33 = find_nu_max(L, v, gamma, N, R_ssp_rk33)\n        results.extend([nu_max_22, nu_max_33])\n\n    # --- Part 2: Convergence Analysis ---\n\n    def L_operator(u, dx, v, gamma):\n        \"\"\"Applies the semi-discrete operator L to a grid function u.\"\"\"\n        u_left_shifted = np.roll(u, 1)\n        # First-order upwind difference for positive v\n        du_dx = (u - u_left_shifted) / dx\n        return -v * du_dx - gamma * u\n\n    def rk22_step(u, dt, dx, v, gamma):\n        \"\"\"Performs one time step using SSP RK(2,2).\"\"\"\n        k1 = L_operator(u, dx, v, gamma)\n        k2 = L_operator(u + dt * k1, dx, v, gamma)\n        return u + dt * (0.5 * k1 + 0.5 * k2)\n\n    def rk33_step(u, dt, dx, v, gamma):\n        \"\"\"Performs one time step using SSP RK(3,3).\"\"\"\n        k1 = L_operator(u, dx, v, gamma)\n        k2 = L_operator(u + dt * k1, dx, v, gamma)\n        u_stage3 = u + 0.25 * dt * (k1 + k2)\n        k3 = L_operator(u_stage3, dx, v, gamma)\n        return u + dt * ((1/6.0) * k1 + (1/6.0) * k2 + (2/3.0) * k3)\n\n    def evolve(u0, T, dt, dx, v, gamma, rk_stepper):\n        \"\"\"Evolves the solution from t=0 to t=T.\"\"\"\n        u = np.copy(u0)\n        num_steps = int(round(T / dt))\n        for _ in range(num_steps):\n            u = rk_stepper(u, dt, dx, v, gamma)\n        return u\n\n    L_conv, v_conv, gamma_conv, N_conv, T_conv = 1, 1, 0.5, 512, 0.5\n    nu_vals = [0.1, 0.05, 0.025, 0.0125]\n    \n    dx_conv = L_conv / N_conv\n    x_grid = np.linspace(0, L_conv, N_conv, endpoint=False)\n    \n    # Exact solution at final time T\n    u_exact_T = np.exp(-gamma_conv * T_conv) * np.sin(2 * np.pi / L_conv * (x_grid - v_conv * T_conv))\n    \n    # Initial condition\n    u0 = np.sin(2 * np.pi * x_grid / L_conv)\n    \n    schemes = {\n        'rk22': (rk22_step, []),\n        'rk33': (rk33_step, [])\n    }\n    \n    all_dts = []\n    for nu in nu_vals:\n        dt = nu * dx_conv / v_conv\n        all_dts.append(dt)\n        for stepper_func, errors_list in schemes.values():\n            u_num = evolve(u0, T_conv, dt, dx_conv, v_conv, gamma_conv, stepper_func)\n            error = np.sqrt(dx_conv * np.sum((u_num - u_exact_T)**2))\n            errors_list.append(error)\n            \n    # Fit for convergence order p\n    log_dts = np.log(all_dts)\n    p_22 = np.polyfit(log_dts, np.log(schemes['rk22'][1]), 1)[0]\n    p_33 = np.polyfit(log_dts, np.log(schemes['rk33'][1]), 1)[0]\n    \n    results.extend([p_22, p_33])\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}