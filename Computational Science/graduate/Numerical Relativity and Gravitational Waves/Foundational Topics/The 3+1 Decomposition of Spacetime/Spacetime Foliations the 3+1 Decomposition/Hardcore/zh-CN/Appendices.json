{
    "hands_on_practices": [
        {
            "introduction": "要掌握3+1分解，首要任务是能够从给定的时空几何中计算出其基本元素：直减函数 $\\alpha$、移位矢量 $\\beta^i$ 和外曲率 $K_{ij}$。本练习将通过一个具体且重要的例子——闵可夫斯基时空的双曲面切片——来训练这项基本功。完成这项推导将加深您对3+1分解中各个几何量物理意义的理解。",
            "id": "3487089",
            "problem": "考虑四维闵可夫斯基时空，其度规为 $g_{ab}$，在全局笛卡尔坐标 $(t,x,y,z)$ 下的符号为 $(-,+,+,+)$，其中 $r^{2} = x^{2} + y^{2} + z^{2}$。通过关系式 $t = \\sqrt{\\tau^{2} + r^{2}}$ 定义一个双曲面时间坐标 $\\tau$，使得每个水平集 $\\tau = \\text{constant}$ 都是一个类空双曲面。仅使用 Arnowitt–Deser–Misner (ADM) 形式主义中 $3+1$ 分解的核心定义，导出与坐标系 $(\\tau, x, y, z)$ 相关联的、指向未来的单位法向量 $n^{a}$、直观函数 $\\alpha$ 和移动向量 $\\beta^{i}$。然后计算 $\\tau = \\text{constant}$ 切片的外曲率 $K$ 的迹，并说明为什么在每个切片上 $K$ 都是常数且为负。请以仅含 $\\tau$ 的单个闭式解析表达式给出 $K$ 的最终答案。",
            "solution": "我们从笛卡尔坐标 $(t,x,y,z)$ 下的闵可夫斯基时空开始，其度规 $g_{ab}$ 满足 $ds^{2} = -dt^{2} + dx^{2} + dy^{2} + dz^{2}$，符号为 $(-,+,+,+)$。我们通过 $t = \\sqrt{\\tau^{2} + r^{2}}$ 定义双曲面时间坐标 $\\tau$，其中 $r^{2} = x^{2} + y^{2} + z^{2}$。等价地，在区域 $t^{2} > r^{2}$ 上，$\\tau$ 是函数 $\\tau = \\sqrt{t^{2} - r^{2}}$。\n\n对于由 $\\tau$ 的水平集构成的叶状结构，指向未来的单位法向量 $n^{a}$（垂直于超曲面 $\\tau = \\text{constant}$）可以从 $\\tau$ 的梯度得到。梯度协向量为\n$$\n\\nabla_{a}\\tau = \\left(\\frac{\\partial \\tau}{\\partial t}, \\frac{\\partial \\tau}{\\partial x}, \\frac{\\partial \\tau}{\\partial y}, \\frac{\\partial \\tau}{\\partial z}\\right) = \\left(\\frac{t}{\\tau}, -\\frac{x}{\\tau}, -\\frac{y}{\\tau}, -\\frac{z}{\\tau}\\right).\n$$\n其范数的平方为\n$$\ng^{ab}\\nabla_{a}\\tau \\nabla_{b}\\tau = -\\left(\\frac{t}{\\tau}\\right)^{2} + \\frac{x^{2}+y^{2}+z^{2}}{\\tau^{2}} = -\\frac{t^{2}-r^{2}}{\\tau^{2}} = -1,\n$$\n因此 $|\\nabla \\tau|^{2} = -1$。在类空切片的 $3+1$ 分解中，单位法协向量通过 $n_{a} = -\\alpha \\nabla_{a}\\tau$ 与叶状结构函数相关，其中 $\\alpha$ 是直观函数。由于 $|\\nabla \\tau|^{2} = -1$，归一化要求 $\\alpha = 1$，因此\n$$\nn_{a} = -\\nabla_{a}\\tau = \\left(-\\frac{t}{\\tau}, \\frac{x}{\\tau}, \\frac{y}{\\tau}, \\frac{z}{\\tau}\\right).\n$$\n用 $g^{ab}$ 升指标，我们得到指向未来的单位法向量\n$$\nn^{a} = g^{ab} n_{b} = \\left(\\frac{t}{\\tau}, \\frac{x}{\\tau}, \\frac{y}{\\tau}, \\frac{z}{\\tau}\\right).\n$$\n因此直观函数为 $\\alpha = 1$。\n\n接下来，我们通过将度规表示在 $(\\tau,x,y,z)$ 坐标下来计算移动向量 $\\beta^{i}$。对 $t(\\tau,x,y,z) = \\sqrt{\\tau^{2} + r^{2}}$ 微分得到\n$$\n\\frac{\\partial t}{\\partial \\tau} = \\frac{\\tau}{t}, \\quad \\frac{\\partial t}{\\partial x^{i}} = \\frac{x^{i}}{t},\n$$\n所以\n$$\ndt = \\frac{\\tau}{t}\\, d\\tau + \\frac{x^{i}}{t}\\, dx^{i}.\n$$\n代入 $ds^{2} = -dt^{2} + \\delta_{ij} dx^{i} dx^{j}$，我们发现\n$$\nds^{2} = -\\left(\\frac{\\tau}{t}\\, d\\tau + \\frac{x^{i}}{t}\\, dx^{i}\\right)^{2} + \\delta_{ij} dx^{i} dx^{j}.\n$$\n展开后，\n$$\nds^{2} = -\\frac{\\tau^{2}}{t^{2}}\\, d\\tau^{2} - \\frac{2\\tau x^{i}}{t^{2}}\\, d\\tau\\, dx^{i} + \\left(\\delta_{ij} - \\frac{x^{i} x^{j}}{t^{2}}\\right) dx^{i} dx^{j}.\n$$\n由此可确定切片上的空间度规为\n$$\n\\gamma_{ij} = \\delta_{ij} - \\frac{x^{i} x^{j}}{t^{2}},\n$$\n以及混合分量为\n$$\ng_{\\tau i} = - \\frac{\\tau x^{i}}{t^{2}}.\n$$\n在 $3+1$ 形式下，$g_{\\tau i} = \\gamma_{ij} \\beta^{j}$，所以\n$$\n\\beta^{i} = \\gamma^{ij} g_{\\tau j}.\n$$\n$\\gamma_{ij}$ 的逆可以通过 Sherman–Morrison 公式得到。注意到 $t^{2} = \\tau^{2} + r^{2}$，可以验证\n$$\n\\gamma^{ij} = \\delta^{ij} + \\frac{x^{i} x^{j}}{\\tau^{2}}.\n$$\n因此，\n$$\n\\beta^{i} = \\left(\\delta^{ij} + \\frac{x^{i} x^{j}}{\\tau^{2}}\\right)\\left(-\\frac{\\tau x^{j}}{t^{2}}\\right) = -\\frac{\\tau}{t^{2}}\\left(x^{i} + \\frac{x^{i} r^{2}}{\\tau^{2}}\\right) = -\\frac{\\tau}{t^{2}}\\frac{t^{2}}{\\tau^{2}} x^{i} = -\\frac{x^{i}}{\\tau}.\n$$\n我们也可以通过 $g_{\\tau\\tau} = -\\alpha^{2} + \\gamma_{ij}\\beta^{i}\\beta^{j}$ 来验证直观函数。根据上述结果，\n$$\ng_{\\tau\\tau} = -\\frac{\\tau^{2}}{t^{2}}, \\quad \\gamma_{ij}\\beta^{i}\\beta^{j} = \\left(\\delta_{ij} - \\frac{x^{i} x^{j}}{t^{2}}\\right)\\frac{x^{i} x^{j}}{\\tau^{2}} = \\frac{r^{2}}{\\tau^{2}} - \\frac{r^{4}}{t^{2}\\tau^{2}} = \\frac{r^{2}}{t^{2}}.\n$$\n因此 $-\\frac{\\tau^{2}}{t^{2}} = -\\alpha^{2} + \\frac{r^{2}}{t^{2}}$，这意味着 $\\alpha^{2} = \\frac{\\tau^{2} + r^{2}}{t^{2}} = 1$，从而 $\\alpha = 1$，这与上面的归一化结果一致。\n\n最后，我们计算外曲率的迹 $K$。在符号为 $(-,+,+,+)$ 的 ADM 约定下，外曲率张量是 $K_{ij} = -\\frac{1}{2}\\mathcal{L}_{n}\\gamma_{ij}$ 加上包含移动向量的项，其迹满足\n$$\nK = \\gamma^{ij} K_{ij} = -\\nabla_{a} n^{a},\n$$\n其中 $\\nabla_{a}$ 是与 $g_{ab}$ 相容的协变导数。在闵可夫斯基惯性坐标系中，$\\nabla_{a} n^{a} = \\partial_{a} n^{a}$，因为克里斯托费尔符号为零，但需要注意的是 $n^{a}$ 通过 $\\tau = \\sqrt{t^{2} - r^{2}}$ 依赖于 $(t,x,y,z)$。定义 $\\sigma(t,x,y,z) = \\sqrt{t^{2} - r^{2}}$。那么\n$$\nn^{a} = \\left(\\frac{t}{\\sigma}, \\frac{x}{\\sigma}, \\frac{y}{\\sigma}, \\frac{z}{\\sigma}\\right).\n$$\n使用\n$$\n\\partial_{t}\\sigma = \\frac{t}{\\sigma}, \\quad \\partial_{x}\\sigma = -\\frac{x}{\\sigma}, \\quad \\partial_{y}\\sigma = -\\frac{y}{\\sigma}, \\quad \\partial_{z}\\sigma = -\\frac{z}{\\sigma},\n$$\n我们计算\n\\begin{align*}\n\\partial_{t}\\left(\\frac{t}{\\sigma}\\right) = \\frac{\\sigma - t\\,\\partial_{t}\\sigma}{\\sigma^{2}} = \\frac{\\sigma - t^{2}/\\sigma}{\\sigma^{2}} = \\frac{\\sigma^{2} - t^{2}}{\\sigma^{3}} = -\\frac{r^{2}}{\\sigma^{3}}, \\\\\n\\partial_{x}\\left(\\frac{x}{\\sigma}\\right) = \\frac{\\sigma - x\\,\\partial_{x}\\sigma}{\\sigma^{2}} = \\frac{\\sigma + x^{2}/\\sigma}{\\sigma^{2}} = \\frac{\\sigma^{2} + x^{2}}{\\sigma^{3}}, \\\\\n\\partial_{y}\\left(\\frac{y}{\\sigma}\\right) = \\frac{\\sigma^{2} + y^{2}}{\\sigma^{3}}, \\\\\n\\partial_{z}\\left(\\frac{z}{\\sigma}\\right) = \\frac{\\sigma^{2} + z^{2}}{\\sigma^{3}}.\n\\end{align*}\n求和得到\n$$\n\\nabla_{a} n^{a} = \\partial_{a} n^{a} = -\\frac{r^{2}}{\\sigma^{3}} + \\frac{\\sigma^{2} + x^{2}}{\\sigma^{3}} + \\frac{\\sigma^{2} + y^{2}}{\\sigma^{3}} + \\frac{\\sigma^{2} + z^{2}}{\\sigma^{3}} = \\frac{3\\sigma^{2}}{\\sigma^{3}} = \\frac{3}{\\sigma}.\n$$\n限制在超曲面 $\\tau = \\sigma$ 上，我们得到\n$$\n\\nabla_{a} n^{a} = \\frac{3}{\\tau}, \\quad \\text{因此} \\quad K = -\\nabla_{a} n^{a} = -\\frac{3}{\\tau}.\n$$\n这表明在每个双曲面切片 $\\tau = \\text{constant}$ 上，外曲率的迹在空间上是常数且为负。其常数性是因为 $\\nabla_{a} n^{a}$ 仅依赖于 $\\sigma = \\sqrt{t^{2} - r^{2}}$，而在切片上各处 $\\sigma$ 都等于切片标签 $\\tau$；其负性是由于 ADM 符号约定 $K = -\\nabla_{a} n^{a}$，并且在符号为 $(-,+,+,+)$ 的时空中 $n^{a}$ 被选为指向未来。",
            "answer": "$$\\boxed{-\\frac{3}{\\tau}}$$"
        },
        {
            "introduction": "在理解了如何使用直减函数之后，我们转向如何求解它。在数值相对论中，选择并求解标尺条件（如直减函数 $\\alpha$ 的演化）是实现稳定模拟的关键步骤。本问题对比了两种主流的“最大切片”条件实施策略：直接求解一个计算量可能很大的椭圆型方程，或是演化一个更简单但需要迭代的演化型双曲方程。这个练习旨在阐明数值相对论学家在计算成本和算法复杂性之间所面临的实际权衡。",
            "id": "3487119",
            "problem": "你的任务是，在广义相对论的3+1分解框架下，针对各向同性坐标系中球对称、时间对称的史瓦西时空切片，实现并分析 lapse 函数的数值规范条件。你的任务必须基于3+1分解的基本原理，并以纯数学术语来表达和解决。\n\n从3+1分解中外曲率迹的演化方程开始，\n$$\n\\partial_t K \\;=\\; - D^i D_i \\alpha \\;+\\; \\alpha \\left( K_{ij} K^{ij} + 4\\pi(\\rho + S) \\right) \\;+\\; \\beta^i \\partial_i K,\n$$\n其中 $K$ 是外曲率 $K_{ij}$ 的迹，$\\alpha$ 是 lapse 函数，$\\beta^i$ 是移位矢量，$D_i$ 是与空间三维 度规 $\\gamma_{ij}$ 兼容的空间协变导数，$\\rho$ 和 $S$ 分别是物质能量密度和空间应力的迹。在真空史瓦西时空和时间对称切片上，我们有 $K_{ij} = 0$, $K = 0$, $\\rho = 0$, $S = 0$，并取 $\\beta^i = 0$。施加最大切片条件意味着 $K = 0$ 保持不变，因此 $\\partial_t K = 0$，这会得到一个椭圆型方程 $D^i D_i \\alpha = 0$。\n\n在史瓦西时空的各向同性坐标系中，空间三维 度规是共形平坦的，$\\gamma_{ij} = \\psi^4 \\delta_{ij}$，共形因子为 $\\psi(r) = 1 + \\frac{M}{2 r}$，其中 $M$ 是史瓦西质量，$r$ 是各向同性半径。对于球对称下的标量 $\\alpha(r)$，方程 $D^i D_i \\alpha = 0$ 简化为以下常微分方程：\n$$\n\\partial_r \\!\\left( r^2 \\psi(r)^2 \\,\\partial_r \\alpha(r) \\right) \\;=\\; 0,\n$$\n该方程必须在径向区间 $r \\in [r_h, r_{\\max}]$ 上求解，其中 $r_h = \\frac{M}{2}$ 表示各向同性坐标系中的视界半径。施加狄利克雷边界条件 $\\alpha(r_h) = 0$ 和 $\\alpha(r_{\\max}) = 1$。在该域上的精确解是在各向同性坐标系下表示的静态史瓦西 lapse 函数的限制，\n$$\n\\alpha_{\\text{exact}}(r) \\;=\\; \\frac{1 - \\frac{M}{2r}}{1 + \\frac{M}{2r}}.\n$$\n\nA 部分（椭圆型求解与精度）：在一个均匀网格 $r_i = r_h + i\\,\\Delta r$（$i = 0,1,\\dots,N-1$，$ \\Delta r = \\frac{r_{\\max} - r_h}{N-1}$）上，使用二阶守恒通量形式的有限差分格式，对常微分方程\n$$\n\\partial_r \\!\\left( r^2 \\psi(r)^2 \\,\\partial_r \\alpha(r) \\right) \\;=\\; 0\n$$\n进行离散化。令 $r_{i+\\frac{1}{2}} = \\frac{r_i + r_{i+1}}{2}$ 并定义中点系数 $A_{i+\\frac{1}{2}} = r_{i+\\frac{1}{2}}^2\\,\\psi(r_{i+\\frac{1}{2}})^2$。对于内部节点 $i = 1,2,\\dots,N-2$，施加离散方程\n$$\n\\frac{1}{\\Delta r}\\left[ A_{i+\\frac{1}{2}} \\frac{\\alpha_{i+1} - \\alpha_i}{\\Delta r} \\;-\\; A_{i-\\frac{1}{2}} \\frac{\\alpha_i - \\alpha_{i-1}}{\\Delta r} \\right] \\;=\\; 0,\n$$\n边界值为 $\\alpha_0 = 0$ 和 $\\alpha_{N-1} = 1$。这将得到一个关于未知向量 $(\\alpha_1,\\dots,\\alpha_{N-2})$ 的三对角线性系统，用托马斯算法求解。求解后，计算离散最大范数误差\n$$\n\\|\\alpha - \\alpha_{\\text{exact}}\\|_{\\infty} \\;=\\; \\max_{0 \\le i \\le N-1} \\left| \\alpha_i - \\alpha_{\\text{exact}}(r_i) \\right|.\n$$\n\nB 部分（双曲规范驱动的成本模型与阈值）：考虑一个更简单的用于 lapse 的双曲规范驱动器，它是一个关于辅助时间 $\\tau$ 的阻尼波动方程，\n$$\n\\partial_{\\tau}^2 \\alpha \\;+\\; \\eta\\, \\partial_{\\tau} \\alpha \\;=\\; c_g^2 \\, D^i D_i \\alpha,\n$$\n具有相同的狄利克雷边界条件 $\\alpha(r_h,\\tau) = 0$ 和 $\\alpha(r_{\\max},\\tau) = 1$。在稳态下，该双曲驱动器求解的是相同的椭圆型方程 $D^i D_i \\alpha = 0$。假设采用显式二阶有限差分时间积分，并遵循库朗-弗里德里希斯-路维（Courant–Friedrichs–Lewy）时间步长限制 $\\Delta \\tau = \\text{CFL} \\cdot \\frac{\\Delta r}{c_g}$。为成本模型假设以下固定操作计数：\n- 每个内部网格点的椭圆型构建与求解成本：$c_{\\text{build}} = 100$ 和 $c_{\\text{solve}} = 40$，因此 $c_E = c_{\\text{build}} + c_{\\text{solve}} = 140$ 次操作，用于组装系数和执行一次三对角求解。\n- 每个内部网格点的双曲型每步更新成本：$c_H = 20$ 次操作。\n\n假设边界信息必须以有限速度遍历整个域以施加狄利克雷条件，因此将双曲步骤的最小数量估计为\n$$\nN_{\\text{steps}} \\;=\\; \\left\\lceil \\frac{N-1}{\\text{CFL}} \\right\\rceil.\n$$\n然后通过以下公式估算成本：\n$$\n\\text{cost}_{\\text{elliptic}} \\;=\\; c_E \\cdot (N-2), \\qquad\n\\text{cost}_{\\text{hyperbolic}} \\;=\\; c_H \\cdot (N-2) \\cdot N_{\\text{steps}}.\n$$\n通过求解以下方程来定义成本相等时的阈值网格大小 $N_{\\star}$：\n$$\nc_E \\cdot (N_{\\star}-2) \\;=\\; c_H \\cdot (N_{\\star}-2) \\cdot \\left\\lceil \\frac{N_{\\star}-1}{\\text{CFL}} \\right\\rceil.\n$$\n为了本作业的目的，使用不带向上取整的连续近似来推导并报告\n$$\nN_{\\star} \\;=\\; \\left\\lceil 1 + \\frac{c_E \\cdot \\text{CFL}}{c_H} \\right\\rceil.\n$$\n\n实现要求：\n- 实现 A 部分中的椭圆型有限差分求解器，计算 $\\|\\alpha - \\alpha_{\\text{exact}}\\|_{\\infty}$，并将其作为浮点数报告。\n- 按照 B 部分的规定实现成本模型，并计算 $\\text{cost}_{\\text{elliptic}}$、$\\text{cost}_{\\text{hyperbolic}}$、阈值 $N_{\\star}$，以及一个指示 $\\text{cost}_{\\text{elliptic}}  \\text{cost}_{\\text{hyperbolic}}$ 是否成立的布尔标志。\n\n测试套件：\n使用以下参数集，每个参数集指定为一个元组 $(M, r_{\\max}, N, c_g, \\eta, \\text{CFL})$：\n- 测试 $1$：$(1, 10, 64, 1, 1, 0.5)$。\n- 测试 $2$：$(1, 100, 256, 1, 1, 0.5)$。\n- 测试 $3$：$(2, 40, 128, 1, 1, 0.5)$。\n- 测试 $4$（点数较少的边缘情况）：$(1, 2, 8, 1, 1, 0.5)$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含一个按测试划分的结果列表，每个测试结果本身是一个列表，按以下顺序包含五个条目：\n$[\\|\\alpha - \\alpha_{\\text{exact}}\\|_{\\infty}, \\text{cost}_{\\text{elliptic}}, \\text{cost}_{\\text{hyperbolic}}, N_{\\star}, (\\text{cost}_{\\text{elliptic}}  \\text{cost}_{\\text{hyperbolic}})]$。\n例如，一个有效的输出可能看起来像\n$[[e_1,cE_1,cH_1,N_{\\star},b_1],[e_2,cE_2,cH_2,N_{\\star},b_2],\\dots]$，\n所有数字均为纯小数，布尔值为 $True$ 或 $False$，打印在单行上。不需要进行物理单位转换；将所有量报告为纯数字。",
            "solution": "用户提供的问题已经过分析，并被认为是有效的。该问题在科学上是合理的，提法恰当，内容自洽，并且与数值相对论领域直接相关。其前提和目标基于爱因斯坦方程的标准 3+1 分解以及求解规范条件的常用数值技术。\n\n按照要求，解答分为两部分。A 部分详细说明了 lapse 函数的椭圆型方程的数值解法。B 部分概述了指定计算成本模型的实现。\n\n### A 部分：最大切片 lapse 函数的椭圆型求解器\n\n问题从 3+1 形式中外曲率迹 $K$ 的演化方程开始。在真空 Schwarzschild 时空 ($ \\rho=0, S=0 $)、时间对称初始切片 ($ K_{ij}=0 \\implies K=0 $) 和零移位矢量 ($ \\beta^i=0 $) 的指定条件下，施加最大切片条件 ($ \\partial_t K = 0 $) 将此演化方程简化为关于 lapse 函数 $ \\alpha $ 的以下椭圆型偏微分方程：\n$$\nD^i D_i \\alpha = 0\n$$\n其中 $ D^i D_i $ 是三维空间切片上的拉普拉斯-贝尔特拉米算子。\n\n空间几何在各向同性坐标系中给出，其中三维 度规 $ \\gamma_{ij} $ 是共形平坦的：\n$$\n\\gamma_{ij} = \\psi^4(r) \\delta_{ij}\n$$\n质量为 $ M $ 的 Schwarzschild 黑洞的共形因子 $ \\psi(r) $ 是\n$$\n\\psi(r) = 1 + \\frac{M}{2r}\n$$\n对于一个仅依赖于各向同性半径 $r$ 的标量函数 $\\alpha(r)$，方程 $D^i D_i \\alpha = 0$ 简化为一个二阶常微分方程（ODE）：\n$$\n\\partial_r \\left( r^2 \\psi(r)^2 \\partial_r \\alpha(r) \\right) = 0\n$$\n该常微分方程在域 $ r \\in [r_h, r_{\\max}] $ 上求解，其中 $ r_h = M/2 $ 是各向同性坐标系中的事件视界半径。狄利克雷边界条件为 $ \\alpha(r_h) = 0 $ 和 $ \\alpha(r_{\\max}) = 1 $。\n\n为了进行数值求解，我们使用二阶守恒有限差分格式。我们定义一个均匀网格 $ r_i = r_h + i \\Delta r $，其中 $ i = 0, \\dots, N-1 $，步长为 $ \\Delta r = (r_{\\max} - r_h) / (N-1) $。该常微分方程呈通量形式 $ \\partial_r F(r) = 0 $，其中通量为 $ F(r) = r^2 \\psi(r)^2 \\partial_r \\alpha(r) $。在内部节点 $ r_i $ 处的守恒离散化由下式给出：\n$$\n\\frac{F_{i+1/2} - F_{i-1/2}}{\\Delta r} = 0\n$$\n在单元面（中点 $ r_{i \\pm 1/2} $）处近似导数和系数，得到指定的离散方程：\n$$\n\\frac{1}{\\Delta r^2} \\left[ A_{i+1/2} (\\alpha_{i+1} - \\alpha_i) - A_{i-1/2} (\\alpha_i - \\alpha_{i-1}) \\right] = 0\n$$\n其中 $ \\alpha_i = \\alpha(r_i) $ 且系数 $ A_{i+1/2} = r_{i+1/2}^2 \\psi(r_{i+1/2})^2 $。\n对内部点（$ i = 1, \\dots, N-2 $）的未知数 $ \\alpha_i $ 进行重排，得到一个线性方程：\n$$\n(-A_{i-1/2})\\alpha_{i-1} + (A_{i+1/2} + A_{i-1/2})\\alpha_i + (-A_{i+1/2})\\alpha_{i+1} = 0\n$$\n边界条件是 $ \\alpha_0 = 0 $ 和 $ \\alpha_{N-1} = 1 $。这些方程为内部未知数向量 $ (\\alpha_1, \\alpha_2, \\dots, \\alpha_{N-2})^T $ 构成一个三对角线性系统。该系统是对角占优的，确保可以使用托马斯算法（或等效的带状 LU 求解器）找到唯一且稳定的解。系统的右侧除了最后一个方程（$ i = N-2 $）外处处为零，该方程包含了在 $ \\alpha_{N-1} $ 处的边界条件：\n$$\n(-A_{N-5/2})\\alpha_{N-3} + (A_{N-3/2} + A_{N-5/2})\\alpha_{N-2} = A_{N-3/2} \\alpha_{N-1} = A_{N-3/2}\n$$\n解完此系统后，我们得到所有网格点上的数值解 $ \\alpha_i $。通过计算与给定精确解的离散最大范数误差来评估其准确性：\n$$\n\\alpha_{\\text{exact}}(r) = \\frac{1 - M/(2r)}{1 + M/(2r)} = \\frac{2r - M}{2r + M}\n$$\n误差为：\n$$\n\\|\\alpha - \\alpha_{\\text{exact}}\\|_{\\infty} = \\max_{0 \\le i \\le N-1} | \\alpha_i - \\alpha_{\\text{exact}}(r_i) |\n$$\n\n### B 部分：双曲规范驱动的成本模型\n\n这部分涉及计算成本的理论比较。将直接椭圆型求解与基于双曲规范驱动方程的迭代方案进行比较。成本使用简化模型进行估算。\n椭圆型求解器的成本建模为与内部网格点数 $ N-2 $ 成正比：\n$$\n\\text{cost}_{\\text{elliptic}} = c_E (N-2)\n$$\n其中 $ c_E = c_{\\text{build}} + c_{\\text{solve}} = 100 + 40 = 140 $ 次操作/点。\n\n双曲型求解器的成本建模为每点每更新步的成本 ($ c_H = 20 $) 乘以内部点数 ($ N-2 $) 和解弛豫到稳态所需的估计时间步数 ($ N_{\\text{steps}} $)。步数是根据信息传播穿过网格所需的时间估算的：\n$$\nN_{\\text{steps}} = \\left\\lceil \\frac{N-1}{\\text{CFL}} \\right\\rceil\n$$\n其中 CFL 是库朗-弗里德里希斯-路维数。因此，双曲型成本为：\n$$\n\\text{cost}_{\\text{hyperbolic}} = c_H (N-2) N_{\\text{steps}}\n$$\n阈值网格大小 $ N_{\\star} $ 是假设这些成本相等的尺寸。使用指定的连续近似（在成本均衡中忽略向上取整函数），我们有 $ c_E = c_H (N_{\\star}-1)/\\text{CFL} $。求解 $ N_{\\star} $ 并按指示应用最终的向上取整函数可得：\n$$\nN_{\\star} = \\left\\lceil 1 + \\frac{c_E \\cdot \\text{CFL}}{c_H} \\right\\rceil\n$$\n对于每个测试用例，我们计算这两种成本、常数阈值 $ N_{\\star} $，以及一个指示椭圆型方法是否更便宜的布尔标志：$ (\\text{cost}_{\\text{elliptic}}  \\text{cost}_{\\text{hyperbolic}}) $。\n\n实现过程首先为每个测试用例定义参数。然后，对每个用例执行椭圆型求解器以找到数值解及其误差。随后，应用成本模型来计算椭圆型和双曲型成本、阈值 $ N_{\\star} $ 以及成本比较标志。最后将结果汇总并以指定格式打印。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        (1.0, 10.0, 64, 1.0, 1.0, 0.5),\n        (1.0, 100.0, 256, 1.0, 1.0, 0.5),\n        (2.0, 40.0, 128, 1.0, 1.0, 0.5),\n        (1.0, 2.0, 8, 1.0, 1.0, 0.5),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_test_case(*case)\n        results.append(result)\n\n    # Format the final output string as a list of lists.\n    # [ [val1, val2, ...], [val1, val2, ...], ... ]\n    output_str = \"[\" + \",\".join([\n        f\"[{r[0]},{r[1]},{r[2]},{r[3]},{'True' if r[4] else 'False'}]\"\n        for r in results\n    ]) + \"]\"\n    \n    print(output_str)\n\ndef run_test_case(M, r_max, N, c_g, eta, CFL):\n    \"\"\"\n    Executes Parts A and B for a single test case.\n\n    Args:\n        M (float): Schwarzschild mass.\n        r_max (float): Outer boundary of the radial domain.\n        N (int): Number of grid points.\n        c_g (float): Gauge wave speed (unused in cost model).\n        eta (float): Damping parameter (unused in cost model).\n        CFL (float): Courant-Friedrichs-Lewy number for cost model.\n\n    Returns:\n        list: A list containing the five required output values.\n    \"\"\"\n    \n    # --- Part A: Elliptic Solver ---\n\n    # 1. Grid setup\n    r_h = M / 2.0\n    # Ensure N  2 to have at least one interior point\n    if N = 2:\n        # Problem is ill-defined for N=2, cannot form a system.\n        # Returning NaNs or error values.\n        # The problem asks for N_star and a boolean, so we need valid numbers.\n        # Cost model calculation is still possible, but elliptic error is not.\n        c_E = 140.0\n        c_H = 20.0\n        cost_elliptic = c_E * (N-2) if N > 1 else 0\n        N_steps = np.ceil((N-1)/CFL) if N > 0 else 0\n        cost_hyperbolic = c_H * (N-2) * N_steps if N > 1 else 0\n        N_star_float = 1.0 + (c_E * CFL) / c_H\n        N_star = int(np.ceil(N_star_float))\n        is_elliptic_cheaper = cost_elliptic  cost_hyperbolic\n        return [float('nan'), cost_elliptic, cost_hyperbolic, N_star, is_elliptic_cheaper]\n\n    r_grid = np.linspace(r_h, r_max, N)\n    delta_r = (r_max - r_h) / (N - 1)\n\n    # 2. Define helper functions and coefficients\n    def psi(r_val, M_val):\n        # Add a small epsilon to avoid division by zero if r_val is exactly 0\n        # although r_h = M/2 ensures r_val > 0 for M > 0.\n        return 1.0 + M_val / (2.0 * r_val)\n\n    def alpha_exact(r_val, M_val):\n        return (1.0 - M_val / (2.0 * r_val)) / (1.0 + M_val / (2.0 * r_val))\n\n    # Coefficients A_{i+1/2} on midpoints\n    r_mid = r_grid[:-1] + delta_r / 2.0\n    A_mid = r_mid**2 * psi(r_mid, M)**2\n\n    # 3. Construct the tridiagonal system for interior points\n    N_interior = N - 2\n    \n    # SciPy's solve_banded expects diagonals in a specific format (l+u+1, M)\n    # For a tridiagonal system, l=1, u=1. The matrix `ab` is shape (3, N_interior).\n    # ab[0,:]: upper diagonal\n    # ab[1,:]: main diagonal\n    # ab[2,:]: lower diagonal\n    ab = np.zeros((3, N_interior))\n    \n    # Main diagonal: A_{i+1/2} + A_{i-1/2} for i=1,...,N-2\n    ab[1, :] = A_mid[1:] + A_mid[:-1]\n    \n    # Upper diagonal: -A_{i+1/2} for i=1,...,N-3\n    ab[0, 1:] = -A_mid[1:-1]\n    \n    # Lower diagonal: -A_{i-1/2} for i=2,...,N-2\n    ab[2, :-1] = -A_mid[1:-1]\n\n    # 4. Construct the right-hand side (RHS) vector\n    rhs = np.zeros(N_interior)\n    # The only non-zero term comes from alpha_{N-1}=1 boundary condition\n    rhs[-1] = A_mid[-1] * 1.0 # A_{N-3/2} * alpha_{N-1}\n\n    # 5. Solve the system\n    alpha_interior = solve_banded((1, 1), ab, rhs)\n\n    # 6. Assemble full solution and compute error\n    alpha_numerical = np.zeros(N)\n    alpha_numerical[0] = 0.0  # BC at r_h\n    alpha_numerical[1:-1] = alpha_interior\n    alpha_numerical[-1] = 1.0 # BC at r_max\n\n    alpha_exact_vals = alpha_exact(r_grid, M)\n    max_norm_error = np.max(np.abs(alpha_numerical - alpha_exact_vals))\n    \n    # --- Part B: Cost Model ---\n\n    # 1. Define cost constants\n    c_E = 140.0\n    c_H = 20.0\n    \n    # 2. Calculate costs\n    cost_elliptic = c_E * (N - 2)\n    \n    N_steps = np.ceil((N - 1) / CFL)\n    cost_hyperbolic = c_H * (N - 2) * N_steps\n\n    # 3. Calculate threshold N_star\n    N_star_float = 1.0 + (c_E * CFL) / c_H\n    N_star = int(np.ceil(N_star_float))\n\n    # 4. Determine if elliptic is cheaper\n    is_elliptic_cheaper = cost_elliptic  cost_hyperbolic\n    \n    return [\n        max_norm_error,\n        cost_elliptic,\n        cost_hyperbolic,\n        N_star,\n        is_elliptic_cheaper\n    ]\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        }
    ]
}