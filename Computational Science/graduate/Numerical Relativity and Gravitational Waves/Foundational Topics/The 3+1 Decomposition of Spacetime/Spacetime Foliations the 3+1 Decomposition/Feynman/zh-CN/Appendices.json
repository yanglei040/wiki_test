{
    "hands_on_practices": [
        {
            "introduction": "这项练习是检验对3+1分解几何定义理解的基础。通过将时间函数（lapse）、空间漂移（shift）和外在曲率的定义应用于闵可夫斯基时空的一个具体的、非平凡的切片，您将把抽象的公式与具体的结果联系起来。这个“纸笔”练习将巩固您对3+1分解基本构件的掌握。",
            "id": "3487089",
            "problem": "考虑四维闵可夫斯基时空，其度规为 $g_{ab}$，号差为 $(-,+,+,+)$，采用全局笛卡尔坐标 $(t,x,y,z)$，其中 $r^{2} = x^{2} + y^{2} + z^{2}$。通过关系式 $t = \\sqrt{\\tau^{2} + r^{2}}$ 定义一个双曲面时间坐标 $\\tau$，使得每个水平集 $\\tau = \\text{constant}$ 都是一个类空双曲面。仅使用 Arnowitt–Deser–Misner (ADM) 形式主义中 $3+1$ 分解的核心定义，推导与坐标系 $(\\tau, x, y, z)$ 相关联的、指向切片未来的单位法向量 $n^{a}$、lapse 函数 $\\alpha$ 和 shift 矢量 $\\beta^{i}$。然后，计算 $\\tau = \\text{constant}$ 切片的外曲率的迹 $K$，并证明为何 $K$ 在每个切片上都是负的常数。请给出 $K$ 仅用 $\\tau$ 表示的单一闭合形式解析表达式作为最终答案。",
            "solution": "我们从笛卡尔坐标 $(t,x,y,z)$ 下的闵可夫斯基时空开始，其度规 $g_{ab}$ 满足 $ds^{2} = -dt^{2} + dx^{2} + dy^{2} + dz^{2}$，号差为 $(-,+,+,+)$。我们通过 $t = \\sqrt{\\tau^{2} + r^{2}}$ 定义双曲面时间坐标 $\\tau$，其中 $r^{2} = x^{2} + y^{2} + z^{2}$。等价地，在区域 $t^{2} > r^{2}$ 上，$\\tau$ 是函数 $\\tau = \\sqrt{t^{2} - r^{2}}$。\n\n对于由 $\\tau$ 的水平集构成的叶状剖分，指向超曲面 $\\tau = \\text{constant}$ 未来的单位法向量 $n^{a}$ 可由 $\\tau$ 的梯度得到。梯度协变矢量为\n$$\n\\nabla_{a}\\tau = \\left(\\frac{\\partial \\tau}{\\partial t}, \\frac{\\partial \\tau}{\\partial x}, \\frac{\\partial \\tau}{\\partial y}, \\frac{\\partial \\tau}{\\partial z}\\right) = \\left(\\frac{t}{\\tau}, -\\frac{x}{\\tau}, -\\frac{y}{\\tau}, -\\frac{z}{\\tau}\\right).\n$$\n其范数的平方为\n$$\ng^{ab}\\nabla_{a}\\tau \\nabla_{b}\\tau = -\\left(\\frac{t}{\\tau}\\right)^{2} + \\frac{x^{2}+y^{2}+z^{2}}{\\tau^{2}} = -\\frac{t^{2}-r^{2}}{\\tau^{2}} = -1,\n$$\n所以 $|\\nabla \\tau|^{2} = -1$。在类空切片的 $3+1$ 分解中，单位法向协变矢量通过 $n_{a} = -\\alpha \\nabla_{a}\\tau$ 与叶状剖分函数相关联，其中 $\\alpha$ 是 lapse 函数。由于 $|\\nabla \\tau|^{2} = -1$，归一化要求 $\\alpha = 1$，因此\n$$\nn_{a} = -\\nabla_{a}\\tau = \\left(-\\frac{t}{\\tau}, \\frac{x}{\\tau}, \\frac{y}{\\tau}, \\frac{z}{\\tau}\\right).\n$$\n用 $g^{ab}$ 提升指标，我们得到未来指向的单位法向量\n$$\nn^{a} = g^{ab} n_{b} = \\left(\\frac{t}{\\tau}, \\frac{x}{\\tau}, \\frac{y}{\\tau}, \\frac{z}{\\tau}\\right).\n$$\n因此 lapse 函数为 $\\alpha = 1$。\n\n接下来，我们通过在 $(\\tau,x,y,z)$ 坐标下表示度规来计算 shift 矢量 $\\beta^{i}$。对 $t(\\tau,x,y,z) = \\sqrt{\\tau^{2} + r^{2}}$ 求导可得\n$$\n\\frac{\\partial t}{\\partial \\tau} = \\frac{\\tau}{t}, \\quad \\frac{\\partial t}{\\partial x^{i}} = \\frac{x^{i}}{t},\n$$\n所以\n$$\ndt = \\frac{\\tau}{t}\\, d\\tau + \\frac{x^{i}}{t}\\, dx^{i}.\n$$\n代入 $ds^{2} = -dt^{2} + \\delta_{ij} dx^{i} dx^{j}$，我们发现\n$$\nds^{2} = -\\left(\\frac{\\tau}{t}\\, d\\tau + \\frac{x^{i}}{t}\\, dx^{i}\\right)^{2} + \\delta_{ij} dx^{i} dx^{j}.\n$$\n展开后，\n$$\nds^{2} = -\\frac{\\tau^{2}}{t^{2}}\\, d\\tau^{2} - \\frac{2\\tau x^{i}}{t^{2}}\\, d\\tau\\, dx^{i} + \\left(\\delta_{ij} - \\frac{x^{i} x^{j}}{t^{2}}\\right) dx^{i} dx^{j}.\n$$\n这确定了切片上的空间度规为\n$$\n\\gamma_{ij} = \\delta_{ij} - \\frac{x^{i} x^{j}}{t^{2}},\n$$\n混合分量为\n$$\ng_{\\tau i} = - \\frac{\\tau x^{i}}{t^{2}}.\n$$\n在 $3+1$ 形式中，$g_{\\tau i} = \\gamma_{ij} \\beta^{j}$，所以\n$$\n\\beta^{i} = \\gamma^{ij} g_{\\tau j}.\n$$\n$\\gamma_{ij}$ 的逆矩阵可通过 Sherman–Morrison 公式求得。注意到 $t^{2} = \\tau^{2} + r^{2}$，可以验证\n$$\n\\gamma^{ij} = \\delta^{ij} + \\frac{x^{i} x^{j}}{\\tau^{2}}.\n$$\n因此，\n$$\n\\beta^{i} = \\left(\\delta^{ij} + \\frac{x^{i} x^{j}}{\\tau^{2}}\\right)\\left(-\\frac{\\tau x^{j}}{t^{2}}\\right) = -\\frac{\\tau}{t^{2}}\\left(x^{i} + \\frac{x^{i} r^{2}}{\\tau^{2}}\\right) = -\\frac{\\tau}{t^{2}}\\frac{t^{2}}{\\tau^{2}} x^{i} = -\\frac{x^{i}}{\\tau}.\n$$\n我们也可以从 $g_{\\tau\\tau} = -\\alpha^{2} + \\gamma_{ij}\\beta^{i}\\beta^{j}$ 证实 lapse 函数。根据上述结果，\n$$\ng_{\\tau\\tau} = -\\frac{\\tau^{2}}{t^{2}}, \\quad \\gamma_{ij}\\beta^{i}\\beta^{j} = \\left(\\delta_{ij} - \\frac{x^{i} x^{j}}{t^{2}}\\right)\\frac{x^{i} x^{j}}{\\tau^{2}} = \\frac{r^{2}}{\\tau^{2}} - \\frac{r^{4}}{t^{2}\\tau^{2}} = \\frac{r^{2}}{t^{2}}.\n$$\n因此 $-\\frac{\\tau^{2}}{t^{2}} = -\\alpha^{2} + \\frac{r^{2}}{t^{2}}$，这意味着 $\\alpha^{2} = \\frac{\\tau^{2} + r^{2}}{t^{2}} = 1$，所以 $\\alpha = 1$，这与上面的归一化结果一致。\n\n最后，我们计算外曲率的迹 $K$。在号差为 $(-,+,+,+)$ 的 ADM 约定下，外曲率张量为 $K_{ij} = -\\frac{1}{2}\\mathcal{L}_{n}\\gamma_{ij}$ 再加上包含 shift 矢量的项，其迹满足\n$$\nK = \\gamma^{ij} K_{ij} = -\\nabla_{a} n^{a},\n$$\n其中 $\\nabla_{a}$ 是与 $g_{ab}$ 相容的协变导数。在闵可夫斯基惯性坐标系中，由于 Christoffel 符号为零，$\\nabla_{a} n^{a} = \\partial_{a} n^{a}$，但需要注意的是 $n^{a}$ 通过 $\\tau = \\sqrt{t^{2} - r^{2}}$ 依赖于 $(t,x,y,z)$。定义 $\\sigma(t,x,y,z) = \\sqrt{t^{2} - r^{2}}$。那么\n$$\nn^{a} = \\left(\\frac{t}{\\sigma}, \\frac{x}{\\sigma}, \\frac{y}{\\sigma}, \\frac{z}{\\sigma}\\right).\n$$\n使用\n$$\n\\partial_{t}\\sigma = \\frac{t}{\\sigma}, \\quad \\partial_{x}\\sigma = -\\frac{x}{\\sigma}, \\quad \\partial_{y}\\sigma = -\\frac{y}{\\sigma}, \\quad \\partial_{z}\\sigma = -\\frac{z}{\\sigma},\n$$\n我们计算\n\\begin{align*}\n\\partial_{t}\\left(\\frac{t}{\\sigma}\\right) = \\frac{\\sigma - t\\,\\partial_{t}\\sigma}{\\sigma^{2}} = \\frac{\\sigma - t^{2}/\\sigma}{\\sigma^{2}} = \\frac{\\sigma^{2} - t^{2}}{\\sigma^{3}} = -\\frac{r^{2}}{\\sigma^{3}}, \\\\\n\\partial_{x}\\left(\\frac{x}{\\sigma}\\right) = \\frac{\\sigma - x\\,\\partial_{x}\\sigma}{\\sigma^{2}} = \\frac{\\sigma + x^{2}/\\sigma}{\\sigma^{2}} = \\frac{\\sigma^{2} + x^{2}}{\\sigma^{3}}, \\\\\n\\partial_{y}\\left(\\frac{y}{\\sigma}\\right) = \\frac{\\sigma^{2} + y^{2}}{\\sigma^{3}}, \\\\\n\\partial_{z}\\left(\\frac{z}{\\sigma}\\right) = \\frac{\\sigma^{2} + z^{2}}{\\sigma^{3}}.\n\\end{align*}\n求和得到\n$$\n\\nabla_{a} n^{a} = \\partial_{a} n^{a} = -\\frac{r^{2}}{\\sigma^{3}} + \\frac{\\sigma^{2} + x^{2}}{\\sigma^{3}} + \\frac{\\sigma^{2} + y^{2}}{\\sigma^{3}} + \\frac{\\sigma^{2} + z^{2}}{\\sigma^{3}} = \\frac{3\\sigma^{2}}{\\sigma^{3}} = \\frac{3}{\\sigma}.\n$$\n限制在超曲面 $\\tau = \\sigma$ 上，我们得到\n$$\n\\nabla_{a} n^{a} = \\frac{3}{\\tau}, \\quad \\text{因此} \\quad K = -\\nabla_{a} n^{a} = -\\frac{3}{\\tau}.\n$$\n这表明，在每个双曲面切片 $\\tau = \\text{constant}$ 上，外曲率的迹在空间上是常数且为负。其常数性源于 $\\nabla_{a} n^{a}$ 仅依赖于 $\\sigma = \\sqrt{t^{2} - r^{2}}$，而在切片上各处，该值都等于切片标签 $\\tau$。其负性则源于 ADM 符号约定 $K = -\\nabla_{a} n^{a}$，并且在号差为 $(-,+,+,+)$ 的时空中 $n^{a}$ 被选为未来指向。",
            "answer": "$$\\boxed{-\\frac{3}{\\tau}}$$"
        },
        {
            "introduction": "这个更高级的问题探讨了规范选择的动力学及其潜在的病态行为。时间函数和空间漂移的演化方程并非任意，不当的选择可能导致数值不稳定。本练习将使用特征线法来展示某些切片条件如何导致坐标网格“破裂”并形成坐标激波，这是确保数值模拟稳定性的一个关键概念。",
            "id": "3487151",
            "problem": "考虑一个真空时空，用3+1分解写出，其lapse函数为$\\,\\alpha\\,$，移位为零$\\,\\beta^{i}=0\\,$，空间度规为$\\,\\gamma_{ij}\\,$。假设具有平面对称性，只有一个空间坐标$\\,x\\,$，并且是在闵可夫斯基数据周围的小振幅规范微扰，因此在领头阶上$\\,\\gamma_{ij}\\approx \\delta_{ij}\\,$。仅使用以下几点作为基本出发点：\n- 外曲率的迹的定义$\\,K:=\\gamma^{ij}K_{ij}\\,$以及空间度规的3+1演化方程，这两者在移位为零时共同蕴含恒等式$\\,\\partial_{t}\\ln\\gamma=-2\\alpha K\\,$，其中$\\,\\gamma=\\det(\\gamma_{ij})\\,$。\n- Bona–Massó切片条件$\\,\\partial_{t}\\alpha=-\\alpha^{2}f(\\alpha)K\\,$，其中$\\,f(\\alpha)>0\\,$是某个正的规范驱动函数。\n- 真空中$\\,K\\,$的演化方程的著名主部$\\,\\partial_{t}K\\simeq- D^{i}D_{i}\\alpha\\,$，其中$\\,D_{i}\\,$是关于$\\,\\gamma_{ij}\\,$的协变导数。在当前的小振幅、平面、闵可夫斯基背景近似下，可以取$\\,D^{i}D_{i}\\alpha\\simeq \\partial_{x}^{2}\\alpha\\,$。\n\n在微扰振幅的领头非平庸阶上进行计算，并按以下步骤进行：\n1. 结合以上各式，得到关于lapse函数的示意形式为$\\,\\partial_{t}^{2}\\alpha - c^{2}(\\alpha)\\,\\partial_{x}^{2}\\alpha \\simeq 0\\,$的拟线性波动方程，并用$\\,\\alpha\\,$和$\\,f(\\alpha)\\,$确定函数$\\,c(\\alpha)\\,$。\n2. 在适用于右行规范波的单向、弱非线性近似中，将其简化为一个一阶输运偏微分方程(PDE) $\\,\\partial_{t}\\alpha + c(\\alpha)\\,\\partial_{x}\\alpha=0\\,$，该方程控制着lapse函数的领头阶非线性陡峭化。\n3. 使用拟线性一阶偏微分方程的特征线法，推导最早的坐标激波形成时间$\\,t_{s}\\,$的通用表达式，用初始lapse函数分布$\\,\\alpha_{0}(x):=\\alpha(x,0)\\,$表示，即特征线相交的最早时间。\n4. 特别地，考虑由$\\,f(\\alpha)=\\dfrac{2}{\\alpha}\\,$定义的1+log切片，以及光滑的初始lapse函数分布$\\,\\alpha_{0}(x)=1-\\varepsilon\\cos(kx)\\,$，其中振幅$\\,\\varepsilon\\,$为小正数（$\\,\\varepsilon\\ll 1\\,$），波数$\\,k>0\\,$。计算在$\\,\\varepsilon\\,$的领头阶上，最早的激波形成时间$\\,t_{s}\\,$，给出一个仅含$\\,\\varepsilon\\,$和$\\,k\\,$的闭式解析表达式。无需四舍五入，也无需报告物理单位。将最终答案以单个解析表达式的形式给出。",
            "solution": "我们从移位为零时空间度规行列式的3+1演化关系开始，\n$$\n\\partial_{t}\\ln\\gamma=-2\\alpha K,\n$$\n以及Bona–Massó切片条件，\n$$\n\\partial_{t}\\alpha=-\\alpha^{2} f(\\alpha)\\,K,\n$$\n根据假设，$\\,f(\\alpha)>0\\,$。我们还使用真空中外曲率迹的演化的主部，\n$$\n\\partial_{t}K\\simeq - D^{i}D_{i}\\alpha.\n$$\n在所述近似（平面对称性和闵可夫斯基数据周围的小振幅微扰）下，我们取$\\,\\gamma_{ij}\\simeq \\delta_{ij}\\,$，因此$\\,D^{i}D_{i}\\alpha\\simeq \\partial_{x}^{2}\\alpha\\,$。\n\n对切片条件关于时间求导：\n$$\n\\partial_{t}^{2}\\alpha \\;=\\; -\\,\\partial_{t}\\big(\\alpha^{2} f(\\alpha)\\,K\\big)\n\\;=\\; -\\big(2\\alpha f(\\alpha)+\\alpha^{2} f'(\\alpha)\\big)\\,(\\partial_{t}\\alpha)\\,K \\;-\\; \\alpha^{2} f(\\alpha)\\,\\partial_{t}K.\n$$\n这里$\\,f'(\\alpha)=\\dfrac{d f}{d\\alpha}\\,$。在弱非线性、小振幅情况下，乘积项$\\,(\\partial_{t}\\alpha)\\,K\\,$是微扰振幅的二次项，在领头阶上可以忽略。保留主部可得\n$$\n\\partial_{t}^{2}\\alpha \\;\\simeq\\; -\\,\\alpha^{2} f(\\alpha)\\,\\partial_{t}K \\;\\simeq\\; \\alpha^{2} f(\\alpha)\\,\\partial_{x}^{2}\\alpha.\n$$\n因此，lapse函数在领头阶上服从一个变系数波动方程\n$$\n\\partial_{t}^{2}\\alpha \\;-\\; c^{2}(\\alpha)\\,\\partial_{x}^{2}\\alpha \\;\\simeq\\; 0,\n$$\n其中\n$$\nc(\\alpha) \\;=\\; \\alpha\\,\\sqrt{f(\\alpha)}.\n$$\n\n为了揭示非线性波的陡峭化，我们考虑一个单向、弱非线性的近似，其中我们限制于主要为右行的波。对于常数$\\,c\\,$，一维波动算子可以分解为$\\,\\partial_{t}^{2}-c^{2}\\partial_{x}^{2}=(\\partial_{t}-c\\partial_{x})(\\partial_{t}+c\\partial_{x})\\,$，纯粹的右行波满足$\\,(\\partial_{t}+c\\partial_{x})\\alpha=0\\,$。当$\\,c=c(\\alpha)\\,$随$\\,\\alpha\\,$缓慢变化时，领头阶单向近似推广为拟线性输运偏微分方程\n$$\n\\partial_{t}\\alpha \\;+\\; c(\\alpha)\\,\\partial_{x}\\alpha \\;=\\; 0,\n$$\n其中$\\,c(\\alpha)=\\alpha\\sqrt{f(\\alpha)}\\,$如上所得。这个一阶方程捕捉了导致非线性陡峭化的、依赖于振幅的传播速度。\n\n我们现在分析拟线性一阶偏微分方程的激波形成\n$$\n\\partial_{t}u + c(u)\\,\\partial_{x}u = 0,\\qquad u(x,0)=u_{0}(x),\n$$\n其中$\\,u=\\alpha\\,$且$\\,c(u)=\\alpha\\sqrt{f(\\alpha)}\\,$。特征线法给出了沿曲线$\\,x(t)\\,$的常微分方程：\n$$\n\\frac{d x}{d t} = c(u),\\qquad \\frac{d u}{d t} = 0.\n$$\n因此，$\\,u\\,$沿着特征线是常数，其值取自初始数据，$\\,u=u_{0}(x_{0})\\,$，其中$\\,x_{0}\\,$标记了初始线$\\,t=0\\,$上的足点。特征线则为\n$$\nx(t; x_{0}) = x_{0} + c\\big(u_{0}(x_{0})\\big)\\,t.\n$$\n当特征线相交时，激波形成。这发生在映射$\\,x_{0}\\mapsto x(t;x_{0})\\,$失去单调性时，即当$\\,\\partial x/\\partial x_{0}=0\\,$时。我们计算\n$$\n\\frac{\\partial x}{\\partial x_{0}} = 1 + c'\\big(u_{0}(x_{0})\\big)\\,u_{0}'(x_{0})\\,t,\n$$\n其中$\\,c'(u)=\\dfrac{d c}{d u}\\,$，$\\,u_{0}\\,$上的撇号表示空间导数。因此，最早的激波时间$\\,t_{s}\\,$是\n$$\nt_{s} \\;=\\; -\\,\\frac{1}{\\displaystyle \\min_{x_{0}}\\big[c'\\big(u_{0}(x_{0})\\big)\\,u_{0}'(x_{0})\\big]}\\,,\n$$\n条件是该最小值为负。\n\n现在我们特别考虑1+log切片，$\\,f(\\alpha)=\\dfrac{2}{\\alpha}\\,$，此时\n$$\nc(\\alpha) \\;=\\; \\alpha\\,\\sqrt{\\frac{2}{\\alpha}} \\;=\\; \\sqrt{2\\,\\alpha},\\qquad c'(\\alpha) \\;=\\; \\frac{\\sqrt{2}}{2}\\,\\alpha^{-1/2}.\n$$\n取初始lapse函数分布\n$$\n\\alpha_{0}(x) \\;=\\; 1 - \\varepsilon \\cos(k x),\\qquad \\varepsilon>0,\\; k>0,\\;\\varepsilon\\ll 1,\n$$\n其导数为\n$$\n\\alpha_{0}'(x) \\;=\\; \\varepsilon k \\,\\sin(k x).\n$$\n那么\n$$\nc'\\big(\\alpha_{0}(x)\\big)\\,\\alpha_{0}'(x) \\;=\\; \\frac{\\sqrt{2}}{2}\\,\\big(\\alpha_{0}(x)\\big)^{-1/2}\\,\\varepsilon k \\,\\sin(k x).\n$$\n此表达式的最小值为负，并且出现在$\\,\\sin(kx)\\,$达到其最负值，而$\\,\\alpha_{0}(x)\\,$不会通过因子$\\,(\\alpha_{0})^{-1/2}\\,$显著增加其量值的地方。对于小$\\,\\varepsilon\\,$，领头阶的最小值在$\\,kx=-\\frac{\\pi}{2}\\,$处，此时$\\,\\sin(kx)=-1\\,$且$\\,\\cos(kx)=0\\,$，因此$\\,\\alpha_{0}=1\\,$。因此，在$\\,\\varepsilon\\,$的领头阶上，\n$$\n\\min_{x}\\Big[c'\\big(\\alpha_{0}(x)\\big)\\,\\alpha_{0}'(x)\\Big] \\;\\simeq\\; -\\,\\frac{\\sqrt{2}}{2}\\,\\varepsilon k.\n$$\n因此，最早的激波形成时间为\n$$\nt_{s} \\;\\simeq\\; -\\,\\frac{1}{-\\,\\dfrac{\\sqrt{2}}{2}\\,\\varepsilon k} \\;=\\; \\frac{\\sqrt{2}}{\\varepsilon k},\n$$\n在$\\,\\varepsilon\\,$的领头阶上，正如所要求。这为Bona–Massó切片在1+log选择下，给出了非线性陡峭化和坐标激波形成的一个具体展示。",
            "answer": "$$\\boxed{\\frac{\\sqrt{2}}{\\varepsilon k}}$$"
        },
        {
            "introduction": "这项实践将带您进入3+1分解的数值计算领域。许多流行的规范条件，如最大切片（$K=0$），会产生必须在每个时间步求解的椭圆型方程。本练习要求您在史瓦西黑洞的背景下，为时间函数实现一个有限差分求解器，并分析其计算成本，从而获得现代数值相对论代码中核心技术的实践经验。",
            "id": "3487119",
            "problem": "您的任务是，在广义相对论的三加一分解框架下，实现并分析针对 lapse 函数的数值规范条件。该问题特化于各向同性坐标下的 Schwarzschild 时空中一个球对称、时间对称的切片。您的任务必须基于三加一分解的第一性原理，并以纯数学术语进行表述和求解。\n\n从三加一分解中外曲率的迹的演化方程开始，\n$$\n\\partial_t K \\;=\\; - D^i D_i \\alpha \\;+\\; \\alpha \\left( K_{ij} K^{ij} + 4\\pi(\\rho + S) \\right) \\;+\\; \\beta^i \\partial_i K,\n$$\n其中 $K$ 是外曲率 $K_{ij}$ 的迹，$\\alpha$ 是 lapse 函数，$\\beta^i$ 是 shift 向量，$D_i$ 是与空间三维度规 $\\gamma_{ij}$ 兼容的空间协变导数，$\\rho$ 和 $S$ 分别是物质能量密度和空间应力的迹。在真空 Schwarzschild 和时间对称切片上，我们有 $K_{ij} = 0$，$K = 0$，$\\rho = 0$，$S = 0$，并取 $\\beta^i = 0$。施行最大切片条件意味着保持 $K = 0$，因此 $\\partial_t K = 0$，这产生椭圆型方程\n$$\nD^i D_i \\alpha \\;=\\; 0.\n$$\n在 Schwarzschild 的各向同性坐标中，空间三维度规是共形平坦的，$\\gamma_{ij} = \\psi^4 \\delta_{ij}$，其共形因子为 $\\psi(r) = 1 + \\frac{M}{2 r}$，其中 $M$ 是 Schwarzschild 质量，$r$ 是各向同性半径。对于球对称中的标量 $\\alpha(r)$，Laplace–Beltrami 算子简化为\n$$\nD^i D_i \\alpha \\;=\\; \\frac{1}{r^2}\\,\\partial_r\\!\\Big( r^2 \\,\\psi(r)^2\\, \\partial_r \\alpha \\Big) \\;=\\; 0,\n$$\n该方程必须在径向区间 $r \\in [r_h, r_{\\max}]$ 上求解，其中 $r_h = \\frac{M}{2}$ 表示各向同性坐标中的视界半径。施加 Dirichlet 边界条件 $\\alpha(r_h) = 0$ 和 $\\alpha(r_{\\max}) = 1$。此域上的精确解是在各向同性坐标中表示的静态 Schwarzschild lapse 的限制，\n$$\n\\alpha_{\\text{exact}}(r) \\;=\\; \\frac{1 - \\frac{M}{2r}}{1 + \\frac{M}{2r}}.\n$$\n\nA部分（椭圆型求解与精度）：离散化常微分方程\n$$\n\\partial_r \\!\\left( r^2 \\psi(r)^2 \\,\\partial_r \\alpha(r) \\right) \\;=\\; 0\n$$\n在均匀网格 $r_i = r_h + i\\,\\Delta r$（其中 $i = 0,1,\\dots,N-1$，$\\Delta r = \\frac{r_{\\max} - r_h}{N-1}$）上，使用通量形式的二阶守恒有限差分格式。令 $r_{i+\\frac{1}{2}} = \\frac{r_i + r_{i+1}}{2}$ 并定义中点系数 $A_{i+\\frac{1}{2}} = r_{i+\\frac{1}{2}}^2\\,\\psi(r_{i+\\frac{1}{2}})^2$。对于内部节点 $i = 1,2,\\dots,N-2$，施行离散方程\n$$\n\\frac{1}{\\Delta r}\\left[ A_{i+\\frac{1}{2}} \\frac{\\alpha_{i+1} - \\alpha_i}{\\Delta r} \\;-\\; A_{i-\\frac{1}{2}} \\frac{\\alpha_i - \\alpha_{i-1}}{\\Delta r} \\right] \\;=\\; 0,\n$$\n边界值为 $\\alpha_0 = 0$ 和 $\\alpha_{N-1} = 1$。这为未知向量 $(\\alpha_1,\\dots,\\alpha_{N-2})$ 产生一个三对角线性系统，该系统将通过 Thomas 算法求解。求解后，计算离散最大范数误差\n$$\n\\|\\alpha - \\alpha_{\\text{exact}}\\|_{\\infty} \\;=\\; \\max_{0 \\le i \\le N-1} \\left| \\alpha_i - \\alpha_{\\text{exact}}(r_i) \\right|.\n$$\n\nB部分（双曲型规范驱动成本模型与阈值）：考虑一个更简单的用于 lapse 的双曲型规范驱动，这是一个在辅助时间 $\\tau$ 中的阻尼波动方程，\n$$\n\\partial_{\\tau}^2 \\alpha \\;+\\; \\eta\\, \\partial_{\\tau} \\alpha \\;=\\; c_g^2 \\, D^i D_i \\alpha,\n$$\n具有相同的 Dirichlet 边界条件 $\\alpha(r_h,\\tau) = 0$ 和 $\\alpha(r_{\\max},\\tau) = 1$。在稳态下，此双曲型驱动求解的是相同的椭圆型方程 $D^i D_i \\alpha = 0$。假设采用显式二阶有限差分时间积分，并遵循 Courant–Friedrichs–Lewy 时间步长限制 $\\Delta \\tau = \\text{CFL} \\cdot \\frac{\\Delta r}{c_g}$。为建立成本模型，假设以下固定操作计数：\n- 每个内部网格点的椭圆型构建与求解成本：$c_{\\text{build}} = 100$ 和 $c_{\\text{solve}} = 40$，因此 $c_E = c_{\\text{build}} + c_{\\text{solve}} = 140$ 次操作，用于组装系数并执行一次三对角求解。\n- 每个内部网格点的双曲型每步更新成本：$c_H = 20$ 次操作。\n\n假设边界信息必须以有限速度遍历整个域以施行 Dirichlet 条件，因此将双曲型步骤的最小数量估计为\n$$\nN_{\\text{steps}} \\;=\\; \\left\\lceil \\frac{N-1}{\\text{CFL}} \\right\\rceil.\n$$\n然后通过以下公式估算成本\n$$\n\\text{cost}_{\\text{elliptic}} \\;=\\; c_E \\cdot (N-2), \\qquad\n\\text{cost}_{\\text{hyperbolic}} \\;=\\; c_H \\cdot (N-2) \\cdot N_{\\text{steps}}.\n$$\n通过求解以下方程定义成本相等时的阈值网格大小 $N_{\\star}$\n$$\nc_E \\cdot (N_{\\star}-2) \\;=\\; c_H \\cdot (N_{\\star}-2) \\cdot \\left\\lceil \\frac{N_{\\star}-1}{\\text{CFL}} \\right\\rceil.\n$$\n为了本任务的目的，使用不带上取整函数的连续近似来推导并报告\n$$\nN_{\\star} \\;=\\; \\left\\lceil 1 + \\frac{c_E \\cdot \\text{CFL}}{c_H} \\right\\rceil.\n$$\n\n实现要求：\n- 实现A部分中的椭圆型有限差分求解器，计算 $\\|\\alpha - \\alpha_{\\text{exact}}\\|_{\\infty}$，并将其报告为浮点数。\n- 按照B部分的规定实现成本模型，并计算 $\\text{cost}_{\\text{elliptic}}$、$\\text{cost}_{\\text{hyperbolic}}$、阈值 $N_{\\star}$ 以及一个指示 $\\text{cost}_{\\text{elliptic}}  \\text{cost}_{\\text{hyperbolic}}$ 是否成立的布尔标志。\n\n测试套件：\n使用以下参数集，每个参数集指定为一个元组 $(M, r_{\\max}, N, c_g, \\eta, \\text{CFL})$：\n- 测试 1：$(1, 10, 64, 1, 1, 0.5)$。\n- 测试 2：$(1, 100, 256, 1, 1, 0.5)$。\n- 测试 3：$(2, 40, 128, 1, 1, 0.5)$。\n- 测试 4（点数较少的边界情况）：$(1, 2, 8, 1, 1, 0.5)$。\n\n最终输出格式：\n您的程序应生成单行输出，包含一个由各测试结果组成的列表，其中每个测试结果本身是一个包含五个条目的列表，顺序如下：\n$[\\|\\alpha - \\alpha_{\\text{exact}}\\|_{\\infty}, \\text{cost}_{\\text{elliptic}}, \\text{cost}_{\\text{hyperbolic}}, N_{\\star}, (\\text{cost}_{\\text{elliptic}}  \\text{cost}_{\\text{hyperbolic}})]$。\n例如，一个有效的输出可能看起来像\n$[[e_1,cE_1,cH_1,N_{\\star},b_1],[e_2,cE_2,cH_2,N_{\\star},b_2],\\dots]$，\n所有数字均为普通十进制数，布尔值为 $True$ 或 $False$，打印在单行上。不需要进行物理单位转换；将所有量报告为纯数字。",
            "solution": "用户提供的问题已经过分析，并被认为是有效的。它在科学上是合理的、适定的、自洽的，并且与数值相对论领域直接相关。其前提和目标都基于爱因斯坦方程的标准3+1分解以及求解规范条件的常用数值技术。\n\n按照要求，解答分为两部分。A部分详细说明了 lapse 函数的椭圆型方程的数值解法。B部分概述了指定计算成本模型的实现。\n\n### A部分：最大切片 lapse 的椭圆型求解器\n\n问题始于3+1形式下外曲率的迹 $K$ 的演化方程。在真空 Schwarzschild 时空（$ \\rho=0, S=0 $）、时间对称初始切片（$ K_{ij}=0 \\implies K=0 $）以及 shift 向量为零（$ \\beta^i=0 $）的指定条件下，施行最大切片条件（$ \\partial_t K = 0 $）将此演化方程简化为关于 lapse 函数 $ \\alpha $ 的以下椭圆型偏微分方程：\n$$\nD^i D_i \\alpha = 0\n$$\n其中 $ D^i D_i $ 是三维空间切片上的 Laplace–Beltrami 算子。\n\n空间几何结构在各向同性坐标中给出，其中三维 度规 $ \\gamma_{ij} $ 是共形平坦的：\n$$\n\\gamma_{ij} = \\psi^4(r) \\delta_{ij}\n$$\n质量为 $ M $ 的 Schwarzschild 黑洞的共形因子 $ \\psi(r) $ 是\n$$\n\\psi(r) = 1 + \\frac{M}{2r}\n$$\n对于一个仅依赖于各向同性半径 $ r $ 的函数 $ \\alpha $，Laplace–Beltrami 算子得以简化，方程变为一个二阶常微分方程（ODE）：\n$$\nD^i D_i \\alpha(r) = \\frac{1}{r^2 \\psi^4(r)} \\partial_r \\left( r^2 \\psi^4(r) \\sqrt{\\det(\\delta_{ij})} \\gamma^{rr} \\partial_r \\alpha(r) \\right) = \\frac{1}{r^2} \\partial_r \\left( r^2 \\psi(r)^2 \\partial_r \\alpha(r) \\right) = 0\n$$\n由于当 $ r0 $ 时 $ \\frac{1}{r^2} \\neq 0 $，这等价于求解：\n$$\n\\partial_r \\left( r^2 \\psi(r)^2 \\partial_r \\alpha(r) \\right) = 0\n$$\n此常微分方程在域 $ r \\in [r_h, r_{\\max}] $ 上求解，其中 $ r_h = M/2 $ 是各向同性坐标中的事件视界半径。Dirichlet 边界条件为 $ \\alpha(r_h) = 0 $ 和 $ \\alpha(r_{\\max}) = 1 $。\n\n为进行数值求解，我们采用二阶守恒有限差分格式。我们定义一个均匀网格 $ r_i = r_h + i \\Delta r $，其中 $ i = 0, \\dots, N-1 $，步长为 $ \\Delta r = (r_{\\max} - r_h) / (N-1) $。该常微分方程具有通量形式 $ \\partial_r F(r) = 0 $，其中通量为 $ F(r) = r^2 \\psi(r)^2 \\partial_r \\alpha(r) $。在内部节点 $ r_i $ 处的守恒离散化由下式给出：\n$$\n\\frac{F_{i+1/2} - F_{i-1/2}}{\\Delta r} = 0\n$$\n在单元面（中点 $ r_{i \\pm 1/2} $）处近似导数和系数，得到指定的离散方程：\n$$\n\\frac{1}{\\Delta r^2} \\left[ A_{i+1/2} (\\alpha_{i+1} - \\alpha_i) - A_{i-1/2} (\\alpha_i - \\alpha_{i-1}) \\right] = 0\n$$\n其中 $ \\alpha_i = \\alpha(r_i) $，系数为 $ A_{i+1/2} = r_{i+1/2}^2 \\psi(r_{i+1/2})^2 $。对内部点（$ i = 1, \\dots, N-2 $）的未知数 $ \\alpha_i $ 进行重新整理，得到一个线性方程：\n$$\n(-A_{i-1/2})\\alpha_{i-1} + (A_{i+1/2} + A_{i-1/2})\\alpha_i + (-A_{i+1/2})\\alpha_{i+1} = 0\n$$\n边界条件为 $ \\alpha_0 = 0 $ 和 $ \\alpha_{N-1} = 1 $。这些方程为内部未知数向量 $ (\\alpha_1, \\alpha_2, \\dots, \\alpha_{N-2})^T $ 构成一个三对角线性系统。该系统是对角占优的，确保可以使用 Thomas 算法（或等效的带状 LU 求解器）找到唯一且稳定的解。该系统的右端项处处为零，除了最后一个方程（$ i = N-2 $），它包含了边界条件 $ \\alpha_{N-1} $：\n$$\n(-A_{N-5/2})\\alpha_{N-3} + (A_{N-3/2} + A_{N-5/2})\\alpha_{N-2} = A_{N-3/2} \\alpha_{N-1} = A_{N-3/2}\n$$\n解出此系统后，我们得到所有网格点上的数值解 $ \\alpha_i $。通过计算与给定精确解的离散最大范数误差来评估其精度：\n$$\n\\alpha_{\\text{exact}}(r) = \\frac{1 - M/(2r)}{1 + M/(2r)} = \\frac{2r - M}{2r + M}\n$$\n误差为：\n$$\n\\|\\alpha - \\alpha_{\\text{exact}}\\|_{\\infty} = \\max_{0 \\le i \\le N-1} | \\alpha_i - \\alpha_{\\text{exact}}(r_i) |\n$$\n\n### B部分：双曲型规范驱动成本模型\n\n这一部分涉及计算成本的理论比较。将直接椭圆型求解与基于双曲型规范驱动方程的迭代格式进行比较。成本使用一个简化模型进行估算。\n椭圆型求解器的成本被建模为与内部网格点数 $ N-2 $ 成正比：\n$$\n\\text{cost}_{\\text{elliptic}} = c_E (N-2)\n$$\n其中 $ c_E = c_{\\text{build}} + c_{\\text{solve}} = 100 + 40 = 140 $ 次操作/每点。\n\n双曲型求解器的成本被建模为每点每更新步骤的成本（$ c_H = 20 $）乘以内部点数（$ N-2 $）以及解松弛到稳态所需的估计时间步数（$ N_{\\text{steps}} $）。步数是根据信息在网格上传播所需的时间来估算的：\n$$\nN_{\\text{steps}} = \\left\\lceil \\frac{N-1}{\\text{CFL}} \\right\\rceil\n$$\n其中 CFL 是 Courant–Friedrichs–Lewy 数。因此，双曲型成本为：\n$$\n\\text{cost}_{\\text{hyperbolic}} = c_H (N-2) N_{\\text{steps}}\n$$\n阈值网格大小 $ N_{\\star} $ 是这些成本在假设上相等的尺寸。使用指定的连续近似（在成本均衡中忽略上取整函数），我们有 $ c_E = c_H (N_{\\star}-1)/\\text{CFL} $。求解 $ N_{\\star} $ 并按指示应用最终的上取整函数，得到：\n$$\nN_{\\star} = \\left\\lceil 1 + \\frac{c_E \\cdot \\text{CFL}}{c_H} \\right\\rceil\n$$\n对于每个测试用例，我们计算这两种成本、恒定的阈值 $ N_{\\star} $，以及一个指示椭圆方法是否更便宜的布尔标志：$ (\\text{cost}_{\\text{elliptic}}  \\text{cost}_{\\text{hyperbolic}}) $。\n\n实现过程首先为每个测试用例定义参数。然后，对每个用例，执行椭圆型求解器以找到数值解及其误差。随后，应用成本模型来计算椭圆型和双曲型成本、阈值 $N_{\\star}$ 以及成本比较标志。结果被汇总并以指定格式打印。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        (1.0, 10.0, 64, 1.0, 1.0, 0.5),\n        (1.0, 100.0, 256, 1.0, 1.0, 0.5),\n        (2.0, 40.0, 128, 1.0, 1.0, 0.5),\n        (1.0, 2.0, 8, 1.0, 1.0, 0.5),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_test_case(*case)\n        results.append(result)\n\n    # Format the final output string as a list of lists.\n    # [ [val1, val2, ...], [val1, val2, ...], ... ]\n    output_str = \"[\" + \",\".join([\n        f\"[{r[0]},{r[1]},{r[2]},{r[3]},{str(r[4])}]\"\n        for r in results\n    ]).replace(\"True\", \"True\").replace(\"False\", \"False\") + \"]\"\n    \n    print(output_str)\n\ndef run_test_case(M, r_max, N, c_g, eta, CFL):\n    \"\"\"\n    Executes Parts A and B for a single test case.\n\n    Args:\n        M (float): Schwarzschild mass.\n        r_max (float): Outer boundary of the radial domain.\n        N (int): Number of grid points.\n        c_g (float): Gauge wave speed (unused in cost model).\n        eta (float): Damping parameter (unused in cost model).\n        CFL (float): Courant-Friedrichs-Lewy number for cost model.\n\n    Returns:\n        list: A list containing the five required output values.\n    \"\"\"\n    \n    # --- Part A: Elliptic Solver ---\n\n    # 1. Grid setup\n    r_h = M / 2.0\n    # Ensure N > 2 to have at least one interior point\n    if N = 2:\n        # Problem is ill-defined for N=2, cannot form a system.\n        # Returning NaNs or error values.\n        c_E = 140.0\n        c_H = 20.0\n        N_star_float = 1.0 + (c_E * CFL) / c_H\n        N_star = int(np.ceil(N_star_float))\n        return [float('nan'), 0, 0, N_star, False]\n\n    r_grid = np.linspace(r_h, r_max, N)\n    delta_r = (r_max - r_h) / (N - 1)\n\n    # 2. Define helper functions and coefficients\n    def psi(r_val, M_val):\n        return 1.0 + M_val / (2.0 * r_val)\n\n    def alpha_exact(r_val, M_val):\n        # Handle r_val = 0 case to avoid division by zero, though r_h > 0\n        with np.errstate(divide='ignore', invalid='ignore'):\n            exact = (1.0 - M_val / (2.0 * r_val)) / (1.0 + M_val / (2.0 * r_val))\n        return np.nan_to_num(exact)\n\n\n    # Coefficients A_{i+1/2} on midpoints\n    r_mid = r_grid[:-1] + delta_r / 2.0\n    A_mid = r_mid**2 * psi(r_mid, M)**2\n\n    # 3. Construct the tridiagonal system for interior points\n    N_interior = N - 2\n    \n    # SciPy's solve_banded expects diagonals in a specific format (l+u+1, M)\n    # For a tridiagonal system, l=1, u=1. The matrix `ab` is shape (3, N_interior).\n    # ab[0,:]: upper diagonal\n    # ab[1,:]: main diagonal\n    # ab[2,:]: lower diagonal\n    ab = np.zeros((3, N_interior))\n    \n    # Main diagonal: A_{i+1/2} + A_{i-1/2} for i=1,...,N-2\n    ab[1, :] = A_mid[1:] + A_mid[:-1]\n    \n    # Upper diagonal: -A_{i+1/2} for i=1,...,N-3\n    ab[0, 1:] = -A_mid[1:-1]\n    \n    # Lower diagonal: -A_{i-1/2} for i=2,...,N-2\n    ab[2, :-1] = -A_mid[1:-1]\n\n    # 4. Construct the right-hand side (RHS) vector\n    rhs = np.zeros(N_interior)\n    # The only non-zero term comes from alpha_{N-1}=1 boundary condition\n    rhs[-1] = A_mid[-1] * 1.0 # A_{N-3/2} * alpha_{N-1}\n\n    # 5. Solve the system\n    alpha_interior = solve_banded((1, 1), ab, rhs)\n\n    # 6. Assemble full solution and compute error\n    alpha_numerical = np.zeros(N)\n    alpha_numerical[0] = 0.0  # BC at r_h\n    alpha_numerical[1:-1] = alpha_interior\n    alpha_numerical[-1] = 1.0 # BC at r_max\n\n    alpha_exact_vals = alpha_exact(r_grid, M)\n    max_norm_error = np.max(np.abs(alpha_numerical - alpha_exact_vals))\n    \n    # --- Part B: Cost Model ---\n\n    # 1. Define cost constants\n    c_E = 140.0\n    c_H = 20.0\n    \n    # 2. Calculate costs\n    cost_elliptic = c_E * (N - 2)\n    \n    N_steps = np.ceil((N - 1) / CFL)\n    cost_hyperbolic = c_H * (N - 2) * N_steps\n\n    # 3. Calculate threshold N_star\n    N_star_float = 1.0 + (c_E * CFL) / c_H\n    N_star = int(np.ceil(N_star_float))\n\n    # 4. Determine if elliptic is cheaper\n    is_elliptic_cheaper = cost_elliptic  cost_hyperbolic\n    \n    # Ensure raw booleans are returned for later string formatting\n    return [\n        max_norm_error,\n        cost_elliptic,\n        cost_hyperbolic,\n        N_star,\n        is_elliptic_cheaper\n    ]\n\nif __name__ == \"__main__\":\n    # To run this code for testing, need to adjust the print statement\n    # to match the desired final single-line output format.\n    \n    test_cases = [\n        (1.0, 10.0, 64, 1.0, 1.0, 0.5),\n        (1.0, 100.0, 256, 1.0, 1.0, 0.5),\n        (2.0, 40.0, 128, 1.0, 1.0, 0.5),\n        (1.0, 2.0, 8, 1.0, 1.0, 0.5),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_test_case(*case)\n        results.append(result)\n\n    output_str = \"[\" + \",\".join([\n        f\"[{r[0]},{r[1]},{r[2]},{r[3]},{str(r[4])}]\" for r in results\n    ]) + \"]\"\n    \n    print(output_str.replace(\"'\",\"\")) # Simple replacement for testing outside platform\n```"
        }
    ]
}