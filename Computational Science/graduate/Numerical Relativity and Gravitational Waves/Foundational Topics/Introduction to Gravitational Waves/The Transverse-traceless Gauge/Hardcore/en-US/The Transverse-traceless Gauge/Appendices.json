{
    "hands_on_practices": [
        {
            "introduction": "The Transverse-Traceless (TT) gauge is invaluable in linearized gravity because its defining conditions are linear. This exercise  invites you to directly verify this crucial property, demonstrating that the principle of superposition applies to gravitational waves in this gauge. This linearity is fundamental, as it ensures that the combination of two valid gravitational wave solutions results in another valid solution.",
            "id": "1877334",
            "problem": "In the theory of linearized gravity, weak gravitational fields are described by a small perturbation $h_{\\mu\\nu}$ to the flat spacetime Minkowski metric $\\eta_{\\mu\\nu}$, such that $g_{\\mu\\nu} = \\eta_{\\mu\\nu} + h_{\\mu\\nu}$. For analyzing gravitational waves, it is convenient to work in the Transverse-Traceless (TT) gauge. In Cartesian coordinates, the spatial components $h_{ij}$ of a perturbation in the TT gauge satisfy two conditions:\n1.  **Traceless condition:** The spatial trace vanishes, i.e., $\\delta^{ij} h_{ij} = 0$, where $\\delta^{ij}$ is the Kronecker delta and summation over repeated indices is implied.\n2.  **Transverse condition:** The spatial divergence vanishes, i.e., $\\partial_i h_{ij} = 0$ for each component $j$, where $\\partial_i$ denotes the partial derivative with respect to the spatial coordinate $x^i$.\n\nSuppose a gravitational wave detector simultaneously observes two independent gravitational waves. The first wave is described by the perturbation $h^{(1)}_{ij}$ and the second by $h^{(2)}_{ij}$. Both $h^{(1)}_{ij}$ and $h^{(2)}_{ij}$ individually satisfy the conditions for the Transverse-Traceless (TT) gauge. The total perturbation measured by the detector is the linear superposition of the two, given by $h^{(\\text{total})}_{ij} = h^{(1)}_{ij} + h^{(2)}_{ij}$.\n\nWhich of the following statements correctly describes the properties of the total perturbation $h^{(\\text{total})}_{ij}$?\n\nA. $h^{(\\text{total})}_{ij}$ is transverse, but it is not guaranteed to be traceless.\n\nB. $h^{(\\text{total})}_{ij}$ is traceless, but it is not guaranteed to be transverse.\n\nC. $h^{(\\text{total})}_{ij}$ is guaranteed to be both transverse and traceless.\n\nD. $h^{(\\text{total})}_{ij}$ is guaranteed to be neither transverse nor traceless.\n\nE. Whether $h^{(\\text{total})}_{ij}$ is transverse or traceless depends on the relative phase and amplitude of the two original waves and cannot be determined in general.",
            "solution": "The problem asks us to determine if the sum of two metric perturbations, each in the Transverse-Traceless (TT) gauge, also remains in the TT gauge. Let the two individual perturbations be $h^{(1)}_{ij}$ and $h^{(2)}_{ij}$. The total perturbation is their sum, $h^{(\\text{total})}_{ij} = h^{(1)}_{ij} + h^{(2)}_{ij}$.\n\nFor a perturbation to be in the TT gauge, it must satisfy two conditions: the traceless condition and the transverse condition. We will check if $h^{(\\text{total})}_{ij}$ satisfies each of these conditions, given that $h^{(1)}_{ij}$ and $h^{(2)}_{ij}$ do.\n\nFirst, let's analyze the traceless condition. The traceless condition for a general perturbation $h_{ij}$ is $\\delta^{ij} h_{ij} = 0$. Since both $h^{(1)}_{ij}$ and $h^{(2)}_{ij}$ are in the TT gauge, they are both traceless:\n$$\n\\delta^{ij} h^{(1)}_{ij} = 0\n$$\n$$\n\\delta^{ij} h^{(2)}_{ij} = 0\n$$\nNow, we compute the trace of the total perturbation $h^{(\\text{total})}_{ij}$:\n$$\n\\delta^{ij} h^{(\\text{total})}_{ij} = \\delta^{ij} (h^{(1)}_{ij} + h^{(2)}_{ij})\n$$\nThe operation of taking the trace is a linear operation. Therefore, we can distribute it over the sum:\n$$\n\\delta^{ij} h^{(\\text{total})}_{ij} = \\delta^{ij} h^{(1)}_{ij} + \\delta^{ij} h^{(2)}_{ij}\n$$\nUsing the given information that each individual perturbation is traceless, we substitute their trace values:\n$$\n\\delta^{ij} h^{(\\text{total})}_{ij} = 0 + 0 = 0\n$$\nThus, the total perturbation $h^{(\\text{total})}_{ij}$ is traceless.\n\nNext, let's analyze the transverse condition. The transverse condition for a general perturbation $h_{ij}$ is $\\partial_i h_{ij} = 0$. Since both $h^{(1)}_{ij}$ and $h^{(2)}_{ij}$ are in the TT gauge, they are both transverse:\n$$\n\\partial_i h^{(1)}_{ij} = 0\n$$\n$$\n\\partial_i h^{(2)}_{ij} = 0\n$$\nNow, we compute the divergence of the total perturbation $h^{(\\text{total})}_{ij}$:\n$$\n\\partial_i h^{(\\text{total})}_{ij} = \\partial_i (h^{(1)}_{ij} + h^{(2)}_{ij})\n$$\nThe partial derivative operator $\\partial_i$ is a linear operator. This means the derivative of a sum is the sum of the derivatives:\n$$\n\\partial_i h^{(\\text{total})}_{ij} = \\partial_i h^{(1)}_{ij} + \\partial_i h^{(2)}_{ij}\n$$\nUsing the given information that each individual perturbation is transverse, we substitute their divergence values:\n$$\n\\partial_i h^{(\\text{total})}_{ij} = 0 + 0 = 0\n$$\nThus, the total perturbation $h^{(\\text{total})}_{ij}$ is transverse.\n\nSince $h^{(\\text{total})}_{ij}$ satisfies both the traceless condition and the transverse condition, it is guaranteed to be in the TT gauge. This conclusion corresponds to option C. This result is a direct consequence of the linearity of the defining conditions of the TT gauge. The properties of the sum do not depend on the specific details like amplitude or phase of the original waves, only that they individually obey the gauge conditions.",
            "answer": "$$\\boxed{C}$$"
        },
        {
            "introduction": "Having confirmed the basic properties of the TT gauge, we now explore its deeper physical implications. This practice  challenges you to move beyond the familiar four-dimensional spacetime and determine the number of independent gravitational wave polarizations in a spacetime of arbitrary dimension $D$. This calculation reveals how the gauge constraints directly determine the physical degrees of freedom of gravity.",
            "id": "1877367",
            "problem": "In the theory of linearized gravity, gravitational waves are described as small perturbations, $h_{\\mu\\nu}$, to a background flat spacetime metric, $\\eta_{\\mu\\nu}$, in a $D$-dimensional spacetime. The full metric is given by $g_{\\mu\\nu} = \\eta_{\\mu\\nu} + h_{\\mu\\nu}$, where $|h_{\\mu\\nu}| \\ll 1$ and $h_{\\mu\\nu}$ is a symmetric tensor.\n\nTo simplify the analysis of a gravitational plane wave propagating with a light-like wave vector $k^\\mu$ (i.e., $k^\\mu k_\\mu = 0$), one can work in the Transverse-Traceless (TT) gauge. This gauge is defined by two algebraic conditions imposed on the components of the perturbation tensor $h_{\\mu\\nu}$:\n\n1.  **Traceless Condition**: The trace of the perturbation must vanish: $\\eta^{\\mu\\nu} h_{\\mu\\nu} = 0$.\n2.  **Transverse Condition**: The contraction of the wave vector with the perturbation tensor must be zero: $k^\\mu h_{\\mu\\nu} = 0$.\n\nThe number of independent components of $h_{\\mu\\nu}$ that remain after satisfying these gauge conditions corresponds to the number of physical polarization states of the gravitational wave.\n\nDetermine the number of independent polarization states for a gravitational wave in a spacetime of arbitrary dimension $D$. Express your answer as a function of $D$. The analysis is intended for spacetimes where gravitational waves can propagate, so your result should be applicable for $D \\ge 3$.",
            "solution": "Start with a plane-wave solution of the linearized Einstein equations in flat background,\n$$\nh_{\\mu\\nu}(x)=\\epsilon_{\\mu\\nu}\\exp(i k_{\\rho} x^{\\rho}),\n$$\nwhere $\\epsilon_{\\mu\\nu}$ is a constant symmetric polarization tensor and $k^{\\mu}$ is light-like, $k^{\\mu}k_{\\mu}=0$. The Transverse-Traceless (TT) gauge conditions are\n$$\n\\eta^{\\mu\\nu}\\epsilon_{\\mu\\nu}=0\n\\quad\\text{and}\\quad\nk^{\\mu}\\epsilon_{\\mu\\nu}=0.\n$$\nBecause $\\epsilon_{\\mu\\nu}$ is symmetric, $k^{\\mu}\\epsilon_{\\mu\\nu}=0$ implies also $k^{\\nu}\\epsilon_{\\mu\\nu}=0$, so both indices of $\\epsilon_{\\mu\\nu}$ are transverse to the propagation direction.\n\nChoose a Lorentz frame where the wave propagates along a null direction and decompose the tangent space into the $(D-2)$-dimensional subspace orthogonal to the spatial direction of propagation (the little-group space) and the two null directions spanned by the wave vector and a complementary null vector. The physical polarization tensor must transform irreducibly under the little group of a massless particle, which is $\\mathrm{SO}(D-2)$, and gauge invariance removes components proportional to the wave vector as well as the trace. Therefore, in TT gauge, the nonzero components of $\\epsilon_{\\mu\\nu}$ can be chosen to lie entirely in the $(D-2)$-dimensional transverse subspace, where they form a symmetric traceless rank-2 tensor.\n\nLet $n=D-2$ denote the dimension of this transverse subspace. The number of independent components of a symmetric rank-2 tensor in $n$ dimensions is\n$$\n\\frac{n(n+1)}{2}.\n$$\nImposing the traceless condition removes one additional component, leaving\n$$\n\\frac{n(n+1)}{2}-1.\n$$\nSubstituting $n=D-2$ gives\n$$\n\\frac{(D-2)(D-1)}{2}-1\n=\n\\frac{D^{2}-3D}{2}\n=\n\\frac{D(D-3)}{2}.\n$$\nThis is the number of independent physical polarization states of a gravitational wave in $D$-dimensional spacetime, valid for $D\\geq 3$. Special cases check: for $D=3$ this yields $0$ and for $D=4$ it yields $2$, as expected.",
            "answer": "$$\\boxed{\\frac{D(D-3)}{2}}$$"
        },
        {
            "introduction": "This final practice bridges the gap between abstract theory and computational reality, a core skill in numerical relativity. You will implement a numerical projection operator to extract the Transverse-Traceless (TT) component from a generic metric perturbation . By verifying that the projector correctly annihilates pure scalar modes, you will confirm a key theoretical property and build a tool essential for gravitational wave data analysis.",
            "id": "3496323",
            "problem": "You are asked to implement a numerical unit test for the Transverse-Traceless (TT) gauge projection in the context of linearized gravity. Work in three spatial dimensions with a periodic cubic domain and consider a pure scalar perturbation of the spatial metric of the form $h_{ij} = \\partial_i \\partial_j \\phi$. The goal is to demonstrate numerically that the TT projection annihilates pure scalar perturbations, i.e., $P^{\\mathrm{TT}} h_{ij} \\approx 0$, to within machine precision at sufficiently high resolution.\n\nStart from the following fundamental base:\n- Linearized gravity on a Minkowski background employs small metric perturbations $h_{\\mu\\nu}$, and in Fourier space one can decompose fields into longitudinal and transverse parts via the Helmholtz decomposition.\n- The Transverse-Traceless (TT) gauge is defined by the conditions $k^i h^{\\mathrm{TT}}_{ij}(k) = 0$ (transversality) and $\\delta^{ij} h^{\\mathrm{TT}}_{ij}(k) = 0$ (tracelessness), where $k^i$ is the wavevector and $\\delta^{ij}$ is the Kronecker delta.\n\nYour task is to:\n1. Construct a three-dimensional periodic grid with side length $L = 2\\pi$ (coordinates measured in radians) and resolutions specified in the test suite below. Use coordinates $x,y,z \\in [0,2\\pi)$.\n2. Define a smooth scalar field $\\phi(x,y,z)$ as a superposition of trigonometric functions,\n   $$\\phi(x,y,z) = \\cos(x) + \\sin(2y) + \\cos(3z) + \\tfrac{1}{2}\\cos(x+y+2z),$$\n   where all angles are in radians.\n3. Compute $h_{ij}$ spectrally by differentiating in Fourier space, i.e., use the Fast Fourier Transform (FFT) to obtain $\\tilde{\\phi}(\\mathbf{k})$, and then define\n   $$\\tilde{h}_{ij}(\\mathbf{k}) = -k_i k_j \\tilde{\\phi}(\\mathbf{k}),$$\n   for each wavevector $\\mathbf{k} = (k_x,k_y,k_z)$.\n4. From fundamental TT conditions, derive and implement a Fourier-space projection operator $P^{\\mathrm{TT}}$ that maps any symmetric tensor $\\tilde{h}_{ij}(\\mathbf{k})$ to its transverse-traceless part $\\tilde{h}^{\\mathrm{TT}}_{ij}(\\mathbf{k})$, satisfying $k^i \\tilde{h}^{\\mathrm{TT}}_{ij}(\\mathbf{k}) = 0$ and $\\delta^{ij}\\tilde{h}^{\\mathrm{TT}}_{ij}(\\mathbf{k}) = 0$ for each nonzero $\\mathbf{k}$. Handle the $\\mathbf{k}=\\mathbf{0}$ mode consistently (do not allow division by zero; assign the projection to zero for this mode).\n5. Compute the relative residual\n   $$\\mathcal{R} = \\frac{\\left\\| h^{\\mathrm{TT}} \\right\\|_2}{\\left\\| h \\right\\|_2},$$\n   where $\\left\\| \\cdot \\right\\|_2$ denotes the Euclidean norm over all grid points and all tensor components, and $h^{\\mathrm{TT}}$ is obtained by applying the TT projection to $h$ as computed above. You may compute norms either in real space or in Fourier space, but be consistent across numerator and denominator. No physical units are required beyond specifying angles in radians for trigonometric functions.\n6. Produce the outputs for the following test suite, which exercises different resolutions and anisotropies:\n   - Test case 1 (happy path, small cubic grid): $(N_x,N_y,N_z) = (32,32,32)$.\n   - Test case 2 (anisotropic grid): $(N_x,N_y,N_z) = (64,48,40)$.\n   - Test case 3 (high resolution cubic grid): $(N_x,N_y,N_z) = (96,96,96)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\"). Each result must be a float representing the relative residual $\\mathcal{R}$ for the corresponding test case. Angles must be treated in radians in all trigonometric evaluations.",
            "solution": "The problem requires a numerical verification that the Transverse-Traceless (TT) projection of a pure scalar metric perturbation is zero. This is a fundamental concept in the study of gravitational waves and linearized gravity. We will first establish the theoretical basis for the TT projection and then outline the numerical procedure to compute the desired residual.\n\n### Theoretical Foundation\n\nWe work in three-dimensional Euclidean space with a periodic domain of side length $L=2\\pi$. The coordinates are $(x, y, z)$. A function $f(x,y,z)$ on this domain can be expanded in a Fourier series, and its discrete representation on a grid with $N_x \\times N_y \\times N_z$ points can be handled using the Fast Fourier Transform (FFT).\n\nThe spatial metric perturbation is given as a pure scalar mode:\n$$h_{ij} = \\partial_i \\partial_j \\phi(x,y,z)$$\nwhere the indices $i, j \\in \\{1, 2, 3\\}$ correspond to the spatial coordinates $(x, y, z)$. The scalar potential $\\phi$ is given by\n$$\\phi(x,y,z) = \\cos(x) + \\sin(2y) + \\cos(3z) + \\tfrac{1}{2}\\cos(x+y+2z)$$\nIn Fourier space, differentiation becomes multiplication by $i$ times the wavevector component. Let $\\tilde{f}(\\mathbf{k})$ be the Fourier transform of $f(\\mathbf{x})$. The Fourier transform of $\\partial_i f$ is $i k_i \\tilde{f}(\\mathbf{k})$. Consequently, the Fourier transform of $h_{ij}$ is:\n$$\\tilde{h}_{ij}(\\mathbf{k}) = (i k_i)(i k_j) \\tilde{\\phi}(\\mathbf{k}) = -k_i k_j \\tilde{\\phi}(\\mathbf{k})$$\nwhere $\\mathbf{k} = (k_x, k_y, k_z)$ is the wavevector. On a periodic domain of size $2\\pi$, the components of $\\mathbf{k}$ are integers.\n\nThe Transverse-Traceless (TT) gauge is defined by two conditions on a tensor $\\tilde{h}^{\\mathrm{TT}}_{ij}$:\n1.  **Transverse Condition:** $k^i \\tilde{h}^{\\mathrm{TT}}_{ij}(\\mathbf{k}) = 0$. This means the perturbation is orthogonal to the direction of propagation $\\mathbf{k}$.\n2.  **Traceless Condition:** $\\delta^{ij} \\tilde{h}^{\\mathrm{TT}}_{ij}(\\mathbf{k}) = 0$. This means the trace of the perturbation tensor is zero.\n\nTo project an arbitrary symmetric tensor $\\tilde{h}_{ij}$ onto its TT part, we construct a projection operator. For any non-zero wavevector $\\mathbf{k}$, we define the projector transverse to $\\mathbf{k}$ as:\n$$P_{ij}(\\mathbf{k}) = \\delta_{ij} - \\frac{k_i k_j}{|\\mathbf{k}|^2}, \\quad |\\mathbf{k}|^2 = k_x^2 + k_y^2 + k_z^2 \\neq 0$$\nThis operator has the property that $P_{ij} k_j = 0$. The fully transverse projection of a rank-$2$ tensor $\\tilde{h}_{mn}$ is $\\tilde{h}^{\\mathrm{T}}_{ij} = P_{im} P_{jn} \\tilde{h}_{mn}$.\n\nTo enforce the traceless condition, we subtract the trace of $\\tilde{h}^{\\mathrm{T}}_{ij}$ in a way that preserves transversality. The trace of $\\tilde{h}^{\\mathrm{T}}_{ij}$ is:\n$$\\mathrm{Tr}(\\tilde{h}^{\\mathrm{T}}) = \\delta_{ij} \\tilde{h}^{\\mathrm{T}}_{ij} = \\delta_{ij} P_{im} P_{jn} \\tilde{h}_{mn} = P_{jm} P_{jn} \\tilde{h}_{mn} = P_{mn} \\tilde{h}_{mn}$$\nThe trace of the transverse projector itself is $\\mathrm{Tr}(P) = \\delta_{ij}P_{ij} = 3 - 1 = 2$. Therefore, the TT part of $\\tilde{h}_{ij}$ is given by:\n$$\\tilde{h}^{\\mathrm{TT}}_{ij} = \\tilde{h}^{\\mathrm{T}}_{ij} - \\frac{1}{2} P_{ij} \\mathrm{Tr}(\\tilde{h}^{\\mathrm{T}})$$\nThe full TT projection operator acting on $\\tilde{h}_{kl}$ can be written as:\n$$\\Lambda_{ij,kl} = P_{ik}P_{jl} - \\frac{1}{2} P_{ij} P_{kl}$$\nsuch that $\\tilde{h}^{\\mathrm{TT}}_{ij} = \\Lambda_{ij,kl} \\tilde{h}_{kl}$.\n\nNow, we apply this projector to our pure scalar perturbation $\\tilde{h}_{kl} = -k_k k_l \\tilde{\\phi}$.\nLet's analyze the first term of the projector:\n$$P_{ik}P_{jl}(-k_k k_l \\tilde{\\phi}) = (-\\tilde{\\phi}) (P_{ik}k_k) (P_{jl}k_l)$$\nSince $P_{ij} k_j = 0$, this term is identically zero for any $\\mathbf{k} \\neq \\mathbf{0}$.\n\nNext, let's analyze the second term:\n$$-\\frac{1}{2} P_{ij} P_{kl} (-k_k k_l \\tilde{\\phi}) = \\frac{1}{2} P_{ij} \\tilde{\\phi} (P_{kl} k_k k_l)$$\nThe contraction $P_{kl}k_k k_l$ is:\n$$P_{kl}k_k k_l = \\sum_{k,l} (\\delta_{kl} - \\frac{k_k k_l}{|\\mathbf{k}|^2}) k_k k_l = (\\sum_m k_m^2) - \\frac{1}{|\\mathbf{k}|^2} (\\sum_m k_m^2)(\\sum_n k_n^2) = |\\mathbf{k}|^2 - \\frac{|\\mathbf{k}|^4}{|\\mathbf{k}|^2} = 0$$\nThis term is also identically zero for any $\\mathbf{k} \\neq \\mathbf{0}$.\n\nThus, for a pure scalar perturbation, its TT projection is analytically zero: $\\tilde{h}^{\\mathrm{TT}}_{ij}(\\mathbf{k}) = 0$ for all $\\mathbf{k} \\neq \\mathbf{0}$. For $\\mathbf{k} = \\mathbf{0}$, the projection is ill-defined due to division by $|\\mathbf{k}|^2$. As instructed, we define the projection to be zero for the $\\mathbf{k}=\\mathbf{0}$ mode. The numerical implementation should demonstrate this cancellation to within machine precision.\n\n### Numerical Implementation Strategy\n\n1.  **Grid and Wavevectors**: For a given resolution $(N_x, N_y, N_z)$, we construct a $3$D real-space grid on $[0, 2\\pi) \\times [0, 2\\pi) \\times [0, 2\\pi)$. The corresponding integer wavevectors $k_x, k_y, k_z$ are obtained using `numpy.fft.fftfreq`.\n\n2.  **Metric Perturbation**: We evaluate $\\phi(x,y,z)$ on the real-space grid, then compute its $3$D FFT to obtain $\\tilde{\\phi}(\\mathbf{k})$. The six independent components of the symmetric tensor $\\tilde{h}_{ij}(\\mathbf{k})$ are then calculated using $\\tilde{h}_{ij} = -k_i k_j \\tilde{\\phi}$.\n\n3.  **TT Projection**: For each grid point in Fourier space (i.e., for each $\\mathbf{k}$), we apply the TT projection.\n    -   We first compute the transverse part $\\tilde{h}^{\\mathrm{T}}_{ij} = P_{im}P_{jn}\\tilde{h}_{mn}$. This involves tensor contractions with the transverse projector $P_{ij}$.\n    -   Next, we compute the trace of this transverse tensor, $\\mathrm{Tr}(\\tilde{h}^{\\mathrm{T}})=P_{mn}\\tilde{h}_{mn}$.\n    -   Finally, we subtract the trace part to obtain $\\tilde{h}^{\\mathrm{TT}}_{ij}$.\n    -   The special case $\\mathbf{k}=\\mathbf{0}$ is handled by setting $|\\mathbf{k}|^2=1$ to avoid division by zero and ensuring the projected components are set to $0$ as the final result, consistent with the problem constraints and physical interpretation (the zero mode represents a constant offset, which has no transverse or traceless structure).\n\n4.  **Relative Residual**: The objective is to compute the relative residual $\\mathcal{R} = \\|h^{\\mathrm{TT}}\\|_2 / \\|h\\|_2$. By Parseval's theorem, norms can be computed in Fourier space. The squared $L_2$-norm of a tensor field $T_{ij}$ is given by $\\|T\\|^2_2 \\propto \\sum_{\\mathbf{k}, i, j} |\\tilde{T}_{ij}(\\mathbf{k})|^2$. The constant of proportionality cancels in the ratio, so we compute:\n    $$\\mathcal{R}^2 = \\frac{\\sum_{i,j,\\mathbf{k}} |\\tilde{h}^{\\mathrm{TT}}_{ij}(\\mathbf{k})|^2}{\\sum_{i,j,\\mathbf{k}} |\\tilde{h}_{ij}(\\mathbf{k})|^2}$$\n    The sum over $i,j$ covers all nine components of the tensor. For a symmetric tensor, this is equivalent to $\\sum_i |\\tilde{h}_{ii}|^2 + \\sum_{i<j} 2|\\tilde{h}_{ij}|^2$.\n\nThe code will execute this procedure for each specified resolution, producing a value for $\\mathcal{R}$ that is expected to be close to machine floating-point precision ($ \\approx 10^{-15} $).",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a numerical unit test for the Transverse-Traceless (TT) gauge projection.\n    \"\"\"\n    test_cases = [\n        (32, 32, 32),\n        (64, 48, 40),\n        (96, 96, 96),\n    ]\n\n    results = []\n    for case in test_cases:\n        Nx, Ny, Nz = case\n        \n        # 1. Construct grid and wavevectors\n        # Domain is [0, 2*pi) in each dimension.\n        # This setup makes the wavevectors correspond to integer mode numbers.\n        x = np.linspace(0, 2 * np.pi, Nx, endpoint=False)\n        y = np.linspace(0, 2 * np.pi, Ny, endpoint=False)\n        z = np.linspace(0, 2 * np.pi, Nz, endpoint=False)\n        X, Y, Z = np.meshgrid(x, y, z, indexing='ij')\n\n        kx = np.fft.fftfreq(Nx) * Nx\n        ky = np.fft.fftfreq(Ny) * Ny\n        kz = np.fft.fftfreq(Nz) * Nz\n        KX, KY, KZ = np.meshgrid(kx, ky, kz, indexing='ij')\n\n        # 2. Define scalar field and compute h_ij in Fourier space\n        # phi(x,y,z) = cos(x) + sin(2y) + cos(3z) + 0.5*cos(x+y+2z)\n        phi = np.cos(X) + np.sin(2 * Y) + np.cos(3 * Z) + 0.5 * np.cos(X + Y + 2 * Z)\n        \n        phi_tilde = np.fft.fftn(phi)\n\n        # h_ij = d_i d_j phi  =>  h_tilde_ij = -k_i k_j phi_tilde\n        h_tilde_xx = -KX * KX * phi_tilde\n        h_tilde_xy = -KX * KY * phi_tilde\n        h_tilde_xz = -KX * KZ * phi_tilde\n        h_tilde_yy = -KY * KY * phi_tilde\n        h_tilde_yz = -KY * KZ * phi_tilde\n        h_tilde_zz = -KZ * KZ * phi_tilde\n        \n        # 3. Apply the TT projection operator\n        k_sq = KX**2 + KY**2 + KZ**2\n        \n        # Handle the k=0 mode to avoid division by zero.\n        # The projection is defined to be zero for this mode.\n        # We can use a mask for safe division.\n        inv_k_sq = np.zeros_like(k_sq, dtype=float)\n        nonzero_k = k_sq != 0\n        inv_k_sq[nonzero_k] = 1.0 / k_sq[nonzero_k]\n\n        #\n        # A) Project to the transverse space: h_T_ij = P_ik P_jl h_kl\n        #\n        # Contract with one k: h_k_j = k_i * h_ij\n        h_k_x = KX * h_tilde_xx + KY * h_tilde_xy + KZ * h_tilde_xz\n        h_k_y = KX * h_tilde_xy + KY * h_tilde_yy + KZ * h_tilde_yz\n        h_k_z = KX * h_tilde_xz + KY * h_tilde_yz + KZ * h_tilde_zz\n        \n        # Contract with two k's: h_kk = k_i k_j h_ij\n        h_kk = KX * h_k_x + KY * h_k_y + KZ * h_k_z\n\n        # Use the expansion: h_T_ij = h_ij - (k_i/k^2)h_k_j - (k_j/k^2)h_k_i + (k_i k_j/k^4)h_kk\n        h_T_xx = h_tilde_xx - 2 * KX * inv_k_sq * h_k_x + KX**2 * inv_k_sq**2 * h_kk\n        h_T_xy = h_tilde_xy - (KX * inv_k_sq * h_k_y + KY * inv_k_sq * h_k_x) + KX * KY * inv_k_sq**2 * h_kk\n        h_T_xz = h_tilde_xz - (KX * inv_k_sq * h_k_z + KZ * inv_k_sq * h_k_x) + KX * KZ * inv_k_sq**2 * h_kk\n        h_T_yy = h_tilde_yy - 2 * KY * inv_k_sq * h_k_y + KY**2 * inv_k_sq**2 * h_kk\n        h_T_yz = h_tilde_yz - (KY * inv_k_sq * h_k_z + KZ * inv_k_sq * h_k_y) + KY * KZ * inv_k_sq**2 * h_kk\n        h_T_zz = h_tilde_zz - 2 * KZ * inv_k_sq * h_k_z + KZ**2 * inv_k_sq**2 * h_kk\n\n        #\n        # B) Subtract the trace to get the TT part: h_TT_ij = h_T_ij - 0.5 * P_ij * tr(h_T)\n        #\n        # tr(h_T) = P_ij h_ij = tr(h) - h_kk/k^2\n        tr_h = h_tilde_xx + h_tilde_yy + h_tilde_zz\n        tr_h_T = tr_h - h_kk * inv_k_sq\n\n        # Projector P_ij = delta_ij - k_i k_j / k^2\n        P_xx = 1.0 - KX**2 * inv_k_sq\n        P_xy = -KX * KY * inv_k_sq\n        P_xz = -KX * KZ * inv_k_sq\n        P_yy = 1.0 - KY**2 * inv_k_sq\n        P_yz = -KY * KZ * inv_k_sq\n        P_zz = 1.0 - KZ**2 * inv_k_sq\n        \n        h_TT_xx = h_T_xx - 0.5 * P_xx * tr_h_T\n        h_TT_xy = h_T_xy - 0.5 * P_xy * tr_h_T\n        h_TT_xz = h_T_xz - 0.5 * P_xz * tr_h_T\n        h_TT_yy = h_T_yy - 0.5 * P_yy * tr_h_T\n        h_TT_yz = h_T_yz - 0.5 * P_yz * tr_h_T\n        h_TT_zz = h_T_zz - 0.5 * P_zz * tr_h_T\n\n        # 4. Calculate the relative residual using norms in Fourier space\n        # Norm^2 = sum over k of ( |h_ii|^2 + 2*|h_ij|^2 for i<j )\n        norm_h_sq = (\n            np.sum(np.abs(h_tilde_xx)**2) + \n            np.sum(np.abs(h_tilde_yy)**2) + \n            np.sum(np.abs(h_tilde_zz)**2) +\n            2 * (np.sum(np.abs(h_tilde_xy)**2) + \n                 np.sum(np.abs(h_tilde_xz)**2) + \n                 np.sum(np.abs(h_tilde_yz)**2))\n        )\n        \n        norm_h_TT_sq = (\n            np.sum(np.abs(h_TT_xx)**2) + \n            np.sum(np.abs(h_TT_yy)**2) + \n            np.sum(np.abs(h_TT_zz)**2) +\n            2 * (np.sum(np.abs(h_TT_xy)**2) + \n                 np.sum(np.abs(h_TT_xz)**2) + \n                 np.sum(np.abs(h_TT_yz)**2))\n        )\n        \n        # Avoid division by zero if norm_h_sq is zero (it won't be for this problem).\n        residual = 0.0\n        if norm_h_sq > 0:\n            residual = np.sqrt(norm_h_TT_sq / norm_h_sq)\n        \n        results.append(residual)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}