{
    "hands_on_practices": [
        {
            "introduction": "经典的LCS问题处理的是两个字符串，一个自然的扩展是思考如何寻找三个或更多字符串的最长公共子序列。这个练习将引导你把二维动态规划的思想推广到三维空间，这不仅能巩固你对LCS核心原理的理解，也是掌握多维动态规划问题的重要一步。通过解决这个问题 ()，你将体会到动态规划在处理更复杂对齐问题时的威力与局限性。",
            "id": "3247529",
            "problem": "给定三个基于字母表 $\\{X, Y, Z, A, B, C, W, D\\}$ 的字符串：\n- $A =$ \"XAYBZCWD\",\n- $B =$ \"ZAXBYCWD\",\n- $C =$ \"YAZBXCWD\".\n仅使用基本原理——即子序列的定义和最优性原理——设计一个动态规划 (DP) 解法来计算 $A$、$B$ 和 $C$ 之间的最长公共子序列的长度，并针对三个长度分别为 $n$、$m$ 和 $p$ 的任意字符串，将你的方法的时间和空间复杂度表示为输入长度 $n$、$m$ 和 $p$ 的函数进行分析。然后，计算上面给定的特定字符串 $A$、$B$ 和 $C$ 的最长公共子序列的长度。仅报告最长公共子序列的长度作为最终答案。无需四舍五入，不涉及单位。",
            "solution": "该问题要求设计一个动态规划解法来找出三个字符串的最长公共子序列（LCS）的长度，分析其复杂度，并应用此方法找出三个特定字符串的LCS长度。\n\n首先，让我们建立基本原理。一个字符串的子序列是通过从原字符串中删除零个或多个字符而不改变其余字符的顺序而形成的新字符串。两个或多个字符串的公共子序列是它们共有的子序列。最长公共子序列是具有最大可能长度的公共子序列。\n\n该问题要求一个基于基本原理的解法，特别是动态规划，它依赖于最优性原理。最优性原理指出，一个问题的最优解可以由其子问题的最优解构造而成。\n\n设三个字符串为 $S_1$、$S_2$ 和 $S_3$，其长度分别为 $n$、$m$ 和 $p$。我们将一个子问题定义为找出这些字符串前缀的LCS长度。令 $L(i, j, k)$ 表示前缀 $S_1[1..i]$、$S_2[1..j]$ 和 $S_3[1..k]$ 的LCS长度，其中 $0 \\le i \\le n$，$0 \\le j \\le m$，$0 \\le k \\le p$。我们的最终目标是计算 $L(n, m, p)$。\n\n我们通过考虑前缀末尾的字符来构造 $L(i, j, k)$ 的解：$S_1[i]$、$S_2[j]$ 和 $S_3[k]$。有两种情况：\n\n情况1：前缀末尾的字符相同。\n如果 $S_1[i] = S_2[j] = S_3[k]$，这个公共字符可以附加到前述前缀 $S_1[1..i-1]$、$S_2[1..j-1]$ 和 $S_3[1..k-1]$ 的LCS之后。根据最优性原理，前缀 $S_1[1..i]$、$S_2[1..j]$ 和 $S_3[1..k]$ 的任何LCS都必须以这种方式形成，因为选择不包括这个共同的末尾字符会导致一个更短或等长的子序列。因此，LCS的长度比结束于 $i-1$、$j-1$ 和 $k-1$ 的前缀的LCS长度大一。\n这种情况的递推关系是：\n$$L(i, j, k) = 1 + L(i-1, j-1, k-1)$$\n\n情况2：前缀末尾的字符不全相同。\n在这种情况下，$S_1[i]$、$S_2[j]$ 和 $S_3[k]$ 不能都成为LCS的最后一个字符的一部分。因此，$S_1[1..i]$、$S_2[1..j]$ 和 $S_3[1..k]$ 的LCS必须是某组前缀的LCS，其中至少有一个字符串被缩短。可能性有：\n1. $S_1[1..i-1]$、$S_2[1..j]$ 和 $S_3[1..k]$ 的LCS。\n2. $S_1[1..i]$、$S_2[1..j-1]$ 和 $S_3[1..k]$ 的LCS。\n3. $S_1[1..i]$、$S_2[1..j]$ 和 $S_3[1..k-1]$ 的LCS。\n原始前缀的LCS长度将是这三个子问题得出的长度中的最大值。\n这种情况的递推关系是：\n$$L(i, j, k) = \\max(L(i-1, j, k), L(i, j-1, k), L(i, j, k-1))$$\n\n递归的基准情况是一个或多个前缀为空。任何字符串与空字符串的LCS都是空字符串，因此其长度为 $0$。\n$$L(i, j, k) = 0 \\text{ if } i=0 \\text{ or } j=0 \\text{ or } k=0$$\n\n综合以上，对于 $i,j,k > 0$，$L(i, j, k)$ 的完整动态规划递推关系是：\n$$\nL(i, j, k) =\n\\begin{cases}\n1 + L(i-1, j-1, k-1)  &\\text{if } S_1[i] = S_2[j] = S_3[k] \\\\\n\\max(L(i-1, j, k), L(i, j-1, k), L(i, j, k-1))  &\\text{otherwise}\n\\end{cases}\n$$\n\n**复杂度分析**\n对于三个长度分别为 $n$、$m$ 和 $p$ 的任意字符串：\n- **时间复杂度**：该算法计算一个大小为 $(n+1) \\times (m+1) \\times (p+1)$ 的三维表中每个单元格 $(i, j, k)$ 的值。每次计算都涉及常数次比较和对先前计算过的单元格的查找。因此，时间复杂度与子问题的数量成正比，即 $O(n \\cdot m \\cdot p)$。\n- **空间复杂度**：一个朴素的实现需要存储整个三维DP表，导致空间复杂度为 $O(n \\cdot m \\cdot p)$。如果只需要LCS的长度，这可以被优化。注意到计算索引 $i$ 的平面仅依赖于索引 $i-1$ 的平面。因此，我们只需要存储两个大小为 $(m+1) \\times (p+1)$ 的平面，从而将空间复杂度降低到 $O(m \\cdot p)$。\n\n**应用于给定字符串**\n我们给定的字符串是：\n- $A = \\text{\"XAYBZCWD\"}$ (长度 $n=8$)\n- $B = \\text{\"ZAXBYCWD\"}$ (长度 $m=8$)\n- $C = \\text{\"YAZBXCWD\"}$ (长度 $p=8$)\n\n我们观察到所有三个字符串共享一个共同的后缀，$S_{common} = \\text{\"CWD\"}$，长度为 $3$。这个属性可以用来简化问题。令 $A = A'S_{common}$，$B = B'S_{common}$，$C = C'S_{common}$。LCS的一个基本性质是 $\\text{length}(\\text{LCS}(A,B,C)) = \\text{length}(\\text{LCS}(A',B',C')) + \\text{length}(S_{common})$。这直接源于DP递推关系：因为最后 $3$ 个字符是相同的，计算将是 $L(n, m, p) = 1 + L(n-1, m-1, p-1)$，重复 $3$ 次，得到 $L(n, m, p) = 3 + L(n-3, m-3, p-3)$。\n\n前缀是：\n- $A' = \\text{\"XAYBZ\"}$\n- $B' = \\text{\"ZAXBY\"}$\n- $C' = \\text{\"YAZBX\"}$\n\n我们现在需要找到这些前缀的LCS长度，即对于 $A'$、$B'$、$C'$ 的 $L(5, 5, 5)$。我们寻求这三个字符串的最长公共子序列。\n\n让我们测试一个长度为 $2$ 的公共子序列。子序列 \"AB\" 是一个候选。\n- 在 $A' = \\text{\"XAYBZ\"}$ 中，\"AB\" 是一个子序列。\n- 在 $B' = \\text{\"ZAXBY\"}$ 中，\"AB\" 是一个子序列。\n- 在 $C' = \\text{\"YAZBX\"}$ 中，\"AB\" 是一个子序列。\n因为 \"AB\" 是 $A'$、$B'$ 和 $C'$ 的一个公共子序列，所以它们的LCS长度至少为 $2$。\n\n长度能大于 $2$ 吗？让我们测试一个长度为 $3$ 的公共子序列。$A'$ 的所有长度为 $3$ 的子序列集合是 $\\{\\text{XAY, XAB, XAZ, XYB, XYZ, XBZ, AYB, AYZ, ABZ, YBZ}\\}$。我们可以测试一个候选，例如 \"AYB\"：\n- 在 $A' = \\text{\"XAYBZ\"}$ 中，\"AYB\" 是一个子序列。\n- 在 $B' = \\text{\"ZAXBY\"}$ 中，字符 'B' 出现在 'Y' 之前。所以 \"AYB\" 不是一个子序列。\n通过系统性地排除，可以证明对于 $A'$、$B'$ 和 $C'$ 不存在长度为 $3$ 的公共子序列。例如，任何公共子序列都不能以 $A'$ 中的 'X' 和 $B'$ 中的 'Z' 开始，因为它们在两个字符串中的相对顺序不同。其他字符也会出现类似的冲突，从而阻止了长度为 $3$ 的公共子序列的形成。\n\n因此，前缀 $A'$、$B'$ 和 $C'$ 的LCS长度为 $2$。\n\n原始字符串 $A$、$B$ 和 $C$ 的LCS总长度是前缀的LCS长度与公共后缀长度之和：\n$$\\text{Length} = \\text{length}(\\text{LCS}(A', B', C')) + \\text{length}(S_{common}) = 2 + 3 = 5$$\n最长公共子序列是 \"ABCWD\"。问题要求的是其长度。",
            "answer": "$$\\boxed{5}$$"
        },
        {
            "introduction": "在找到最长公共子序列的长度后，一个更具挑战性的问题是：存在多少个不同的最长公共子序列？这个问题 () 引导我们超越了寻找最优值的范畴，进入了对最优解进行计数的领域。解决它通常需要两阶段的动态规划，在第一阶段计算长度的基础上，第二阶段专门用于计数，并需要仔细处理路径合并时可能出现的重复计算问题。",
            "id": "3247580",
            "problem": "给定两个固定字母表上的有限字符串。字符串的子序列是通过删除零个或多个符号而不改变其余符号的相对顺序得到的。两个字符串的最长公共子序列（LCS）是同时作为两个字符串的子序列的、长度最长的任何子序列。从子序列的定义和考虑输入字符串前缀时出现的最优子结构性质严格出发，推导一个动态规划过程，用于计算两个字符串的不同最长公共子序列（LCS）的数量。你的推导必须定义一个关于前缀的递推关系，证明基本情况，并论证为什么你的计数方法不会因为可以通过不同对齐方式实现的相同子序列而重复计数。\n\n在推导你的方法后，将其应用于具体的字符串\n- $A = \\text{BACBCA}$，长度为 $6$，\n- $B = \\text{ABCABA}$，长度为 $6$，\n并计算 $A$ 和 $B$ 的不同最长公共子序列的数量。仅报告最终计数，结果为精确整数。不需要四舍五入。最终答案必须是单个实数值。",
            "solution": "问题要求做两件事：首先，推导一个动态规划过程，用于计算两个字符串的不同最长公共子序列（LCS）的数量；其次，将此过程应用于特定字符串 $A = \\text{BACBCA}$ 和 $B = \\text{ABCABA}$。\n\n### 第1部分：动态规划过程的推导\n\n设两个字符串为 $A = a_1a_2...a_m$ 和 $B = b_1b_2...b_n$。我们将 $A$ 的长度为 $i$ 的前缀表示为 $A_i = a_1...a_i$，类似地，$B$ 的长度为 $j$ 的前缀表示为 $B_j = b_1...b_j$。\n\n该推导需要两个阶段的动态规划。首先，我们计算所有前缀对的最长公共子序列的长度。其次，我们利用这些信息来计算不同最长公共子序列的数量。\n\n**第1阶段：计算最长公共子序列的长度**\n\n设 $L(i,j)$ 是前缀 $A_i$ 和 $B_j$ 的一个最长公共子序列的长度。$L(i,j)$ 的值由基于最长公共子序列问题的最优子结构性质的著名递推关系确定。\n\n- **基本情况**：任何字符串与空字符串的最长公共子序列是空字符串，其长度为 $0$。\n$$ L(i,0) = 0 \\text{ for } 0 \\le i \\le m $$\n$$ L(0,j) = 0 \\text{ for } 0 \\le j \\le n $$\n- **递推关系**：对于 $i > 0$ 和 $j > 0$：\n如果前缀的最后一个字符匹配（$a_i = b_j$），则 $A_i$ 和 $B_j$ 的最长公共子序列是通过找到较短前缀 $A_{i-1}$ 和 $B_{j-1}$ 的一个最长公共子序列，并在其后附加公共字符 $a_i$ 形成的。\n如果最后一个字符不匹配（$a_i \\neq b_j$），则 $A_i$ 和 $B_j$ 的一个最长公共子序列要么是 $A_{i-1}$ 和 $B_j$ 的一个最长公共子序列，要么是 $A_i$ 和 $B_{j-1}$ 的一个最长公共子序列。我们取其中长度最大的那个。\n这导出了递推关系：\n$$ L(i,j) = \\begin{cases} 1 + L(i-1, j-1)  &\\text{if } a_i=b_j \\\\ \\max(L(i-1,j), L(i,j-1))  &\\text{if } a_i \\neq b_j \\end{cases} $$\n使用这些规则计算一个大小为 $(m+1) \\times (n+1)$ 的 $L(i,j)$ 表。\n\n**第2阶段：计算不同最长公共子序列的数量**\n\n设 $C(i,j)$ 是前缀 $A_i$ 和 $B_j$ 的不同最长公共子序列的数量。这些最长公共子序列的长度由 $L(i,j)$ 给出。我们推导一个依赖于预先计算的 $L$ 表的 $C(i,j)$ 的递推关系。\n\n对于 $A_i, B_j$ 的不同最长公共子序列集合，我们称之为 $S(i,j)$，它是由对最大长度 $L(i,j)$ 有贡献的子问题的最长公共子序列集合的并集形成的。计数 $C(i,j)$ 就是 $|S(i,j)|$。\n\n- **基本情况**：任何字符串与空字符串之间唯一的公共子序列是空字符串。因此，总存在且仅存在一个最长公共子序列（即空字符串）。\n$$ C(i,0) = 1 \\text{ for } 0 \\le i \\le m $$\n$$ C(0,j) = 1 \\text{ for } 0 \\le j \\le n $$\n\n- **递推关系**：对于 $i > 0$ 和 $j > 0$，我们考虑与长度计算相同的几种情况。\n\n1.  **情况：$a_i = b_j$**\n    $A_i, B_j$ 的最长公共子序列是通过将 $a_i$ 附加到 $A_{i-1}, B_{j-1}$ 的最长公共子序列之后形成的。其长度为 $L(i,j) = 1+L(i-1, j-1)$。任何从子问题 $(A_{i-1}, B_j)$ 或 $(A_i, B_{j-1})$ 获得的最长公共子序列的长度至多为 $L(i-1, j-1)+1$。可以证明，它们的长度严格小于 $L(i,j)$，因此它们对 $A_i, B_j$ 的最长公共子序列集合没有贡献。因此，$(A_i, B_j)$ 的不同最长公共子序列的数量与 $(A_{i-1}, B_{j-1})$ 的相同。\n    $$ C(i,j) = C(i-1, j-1) $$\n\n2.  **情况：$a_i \\neq b_j$**\n    $A_i, B_j$ 的最长公共子序列是 $A_{i-1}, B_j$ 的最长公共子序列和/或 $A_i, B_{j-1}$ 的最长公共子序列。其长度为 $L(i,j) = \\max(L(i-1,j), L(i,j-1))$。\n\n    a) 如果 $L(i-1,j) > L(i,j-1)$：$(A_i, B_{j-1})$ 的最长公共子序列严格更短。$(A_i, B_j)$ 的所有最长公共子序列都必须来自 $(A_{i-1}, B_j)$。\n    $$ C(i,j) = C(i-1,j) $$\n\n    b) 如果 $L(i,j-1) > L(i-1,j)$：对称地，所有最长公共子序列都必须来自 $(A_i, B_{j-1})$。\n    $$ C(i,j) = C(i,j-1) $$\n\n    c) 如果 $L(i-1,j) = L(i,j-1)$：最长公共子序列可能来自两个子问题。最长公共子序列的集合是 $S(i-1,j) \\cup S(i,j-1)$。根据容斥原理，计数为 $C(i,j) = |S(i-1,j)| + |S(i,j-1)| - |S(i-1,j) \\cap S(i,j-1)|$。\n    交集 $S(i-1,j) \\cap S(i,j-1)$ 包含了同时是 $A_{i-1}$ 和 $B_{j-1}$ 的子序列的最长公共子序列。为了使这些序列成为交集的成员，它们的长度必须是 $L(i,j)$。如果 $L(i,j) > L(i-1,j-1)$，这个交集必须为空，因为 $A_{i-1}$ 和 $B_{j-1}$ 的任何公共子序列都太短了。如果 $L(i,j)=L(i-1,j-1)$，则交集恰好是 $A_{i-1}, B_{j-1}$ 的最长公共子序列集合。\n    因此：\n    - 如果 $L(i-1,j-1) < L(i,j)$：$C(i,j) = C(i-1,j) + C(i,j-1)$。这确保了没有重复计数，因为来自 $(A_{i-1},B_j)$ 的最长公共子序列和来自 $(A_i,B_{j-1})$ 的最长公共子序列构成了不相交的字符串集合。更正式地说，交集中的任何字符串都必须是 $A_{i-1}$ 和 $B_{j-1}$ 的子序列，但其长度 $L(i,j)$ 严格大于这对字符串的最长公共子序列长度 $L(i-1,j-1)$，这是一个矛盾。\n    - 如果 $L(i-1,j-1) = L(i,j)$：$C(i,j) = C(i-1,j) + C(i,j-1) - C(i-1,j-1)$。这正确地减去了两个子问题共有的最长公共子序列的数量，这些公共子序列正是 $(A_{i-1}, B_{j-1})$ 的最长公共子序列。\n\n使用这些规则计算一个大小为 $(m+1) \\times (n+1)$ 的 $C(i,j)$ 表。最终答案是 $C(m,n)$。\n\n### 第2部分：应用于给定字符串\n\n我们将推导出的方法应用于 $A = \\text{BACBCA}$（长度 $m=6$）和 $B = \\text{ABCABA}$（长度 $n=6$）。\n\n**第1阶段：$L(i,j)$ 表**\n\n计算出的 $L(i,j)$ 表如下，其中行对应 $A$ 的前缀，列对应 $B$ 的前缀：\n$$\nL = \\begin{pmatrix}\n  \\text{ } & \\text{ } & \\text{A} & \\text{B} & \\text{C} & \\text{A} & \\text{B} & \\text{A} \\\\\n  \\text{ } & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\\\\n\\text{B} & 0 & 0 & 1 & 1 & 1 & 1 & 1 \\\\\n\\text{A} & 0 & 1 & 1 & 1 & 2 & 2 & 2 \\\\\n\\text{C} & 0 & 1 & 1 & 2 & 2 & 2 & 2 \\\\\n\\text{B} & 0 & 1 & 2 & 2 & 2 & 3 & 3 \\\\\n\\text{C} & 0 & 1 & 2 & 3 & 3 & 3 & 3 \\\\\n\\text{A} & 0 & 1 & 2 & 3 & 4 & 4 & 4\n\\end{pmatrix}\n$$\n$A$ 和 $B$ 的最长公共子序列的长度是 $L(6,6)=4$。\n\n**第2阶段：$C(i,j)$ 表**\n\n使用 $L$ 表和 $C(i,j)$ 的递推关系，我们计算 $C(i,j)$ 表。\n- 对所有 $i,j$，$C(i,0) = 1$ 且 $C(0,j)=1$。\n- 对于 $i,j > 0$：\n  - 如果 $a_i=b_j$，$C(i,j) = C(i-1,j-1)$。\n  - 如果 $a_i \\ne b_j$：\n    - 如果 $L(i-1,j) > L(i,j-1)$，$C(i,j) = C(i-1,j)$。\n    - 如果 $L(i-1,j) < L(i,j-1)$，$C(i,j) = C(i,j-1)$。\n    - 如果 $L(i-1,j) = L(i,j-1)$：\n      - 如果 $L(i-1,j-1) < L(i,j)$，$C(i,j) = C(i-1,j) + C(i,j-1)$。\n      - 如果 $L(i-1,j-1) = L(i,j)$，$C(i,j) = C(i-1,j) + C(i,j-1) - C(i-1,j-1)$。\n\n计算出的 $C(i,j)$ 表为：\n$$\nC = \\begin{pmatrix}\n  \\text{ } & \\text{ } & \\text{A} & \\text{B} & \\text{C} & \\text{A} & \\text{B} & \\text{A} \\\\\n  \\text{ } & 1 & 1 & 1 & 1 & 1 & 1 & 1 \\\\\n\\text{B} & 1 & 1 & 1 & 1 & 1 & 1 & 1 \\\\\n\\text{A} & 1 & 1 & 2 & 2 & 1 & 1 & 1 \\\\\n\\text{C} & 1 & 1 & 2 & 2 & 3 & 3 & 3 \\\\\n\\text{B} & 1 & 1  1  3  4  3  3 \\\\\n\\text{C}  1  1  1  1  1  4  4 \\\\\n\\text{A}  1  1  1  1  1  1  4\n\\end{pmatrix}\n$$\n我们来验证最后一项，$C(6,6)$：\n$a_6 = \\text{'A'}$ 且 $b_6=\\text{'A'}$。它们匹配。\n所以，$C(6,6) = C(5,5)$。\n从表中可知，$C(5,5) = 4$。\n我们来验证 $C(5,5)$：\n$a_5=\\text{'C'}, b_5=\\text{'B'}$。它们不匹配。\n$L(5,5)=3$。从 $L$ 表中，$L(4,5)=3$ 且 $L(5,4)=3$。它们相等。\n我们将 $L(5,5)$ 与 $L(4,4)=2$ 进行比较。由于 $L(5,5)  L(4,4)$，我们使用加法规则：\n$C(5,5) = C(4,5) + C(5,4) = 3 + 1 = 4$。\n值 $C(4,5)=3$ 和 $C(5,4)=1$ 是通过类似地从前面行和列的条目计算得出的。完整的表格计算证实了这些值。\n\n字符串 $A$ 和 $B$ 的不同最长公共子序列的最终计数由 $C(6,6)$ 给出。\n$C(6,6) = 4$。\n\n四个不同的最长公共子序列是：`BCBA`, `BABA`, `ACBA`, `ABCA`。",
            "answer": "$$\\boxed{4}$$"
        }
    ]
}