{
    "hands_on_practices": [
        {
            "introduction": "To begin our exploration of the water-filling algorithm, let's start with the most fundamental scenario. Imagine you have a limited power budget to distribute across two communication channels, each with a different level of background noise. This exercise  walks you through the core optimization problem: how to allocate power to maximize the total data rate. By working through this simple case, you will build a concrete understanding of why it's optimal to allocate more power to the less noisy, or \"cleaner,\" channel.",
            "id": "1668042",
            "problem": "A wireless communication system operates over two distinct, non-interfering frequency bands. Each band can be modeled as a parallel Additive White Gaussian Noise (AWGN) channel, where AWGN refers to a channel model in which the only impairment is a linear addition of wideband or white noise with a constant spectral density and a Gaussian distribution of amplitude. For the purposes of this problem, assume the channel power gain for both bands is unity.\n\nThe noise power in the first frequency band is characterized by a variance of $\\sigma_1^2 = 1.0$ arbitrary units, while the noise power variance in the second band is $\\sigma_2^2 = 3.0$ arbitrary units. The transmitter has a total power budget of $P = 4.0$ arbitrary units that can be distributed between the two bands.\n\nTo achieve the maximum possible total information-theoretic capacity across both channels, an optimal power allocation strategy must be employed. Determine the optimal power $P_1$ to be allocated to the first channel and the optimal power $P_2$ to be allocated to the second channel.\n\nProvide your answer as a pair of numerical values $(P_1, P_2)$ in arbitrary units.",
            "solution": "We model the two bands as parallel AWGN channels with unit gains and noise variances $\\sigma_{1}^{2}$ and $\\sigma_{2}^{2}$. Let $P_{1}$ and $P_{2}$ be the powers allocated to channels $1$ and $2$, with $P_{1} \\ge 0$, $P_{2} \\ge 0$, and $P_{1} + P_{2} = P$.\n\nThe total capacity (per channel use) is proportional to\n$$\nC(P_{1},P_{2}) \\propto \\ln\\!\\left(1 + \\frac{P_{1}}{\\sigma_{1}^{2}}\\right) + \\ln\\!\\left(1 + \\frac{P_{2}}{\\sigma_{2}^{2}}\\right),\n$$\nwhere the use of $\\ln$ (natural logarithm) is without loss of generality because any positive multiplicative or monotonic transformation does not change the maximizer under the same constraint.\n\nForm the Lagrangian for maximizing $C$ subject to $P_{1} + P_{2} = P$ and $P_{i} \\ge 0$:\n$$\n\\mathcal{L} = \\sum_{i=1}^{2} \\ln\\!\\left(1 + \\frac{P_{i}}{\\sigma_{i}^{2}}\\right) - \\lambda\\left(P_{1} + P_{2} - P\\right) - \\sum_{i=1}^{2} \\nu_{i} P_{i},\n$$\nwith $\\lambda$ the multiplier for the equality constraint and $\\nu_{i} \\ge 0$ for the nonnegativity constraints.\n\nKKT stationarity for any $i$ with $P_{i} > 0$ (hence $\\nu_{i} = 0$) gives\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial P_{i}} = \\frac{1}{\\sigma_{i}^{2} + P_{i}} - \\lambda = 0\n\\;\\;\\Rightarrow\\;\\;\nP_{i} = \\frac{1}{\\lambda} - \\sigma_{i}^{2}.\n$$\nImposing $P_{i} \\ge 0$ yields the water-filling solution\n$$\nP_{i} = \\max\\!\\left(0,\\, \\mu - \\sigma_{i}^{2}\\right), \\quad \\text{where } \\mu \\equiv \\frac{1}{\\lambda},\n$$\nwith $\\mu$ chosen to satisfy the total power constraint\n$$\n\\sum_{i=1}^{2} \\max\\!\\left(0,\\, \\mu - \\sigma_{i}^{2}\\right) = P.\n$$\n\nSubstitute the given values $\\sigma_{1}^{2} = 1$, $\\sigma_{2}^{2} = 3$, and $P = 4$. Check whether both channels are active. If $\\mu \\le 3$, then $P_{2} = 0$ and $P_{1} = \\mu - 1$. Enforcing $P_{1} = 4$ would require $\\mu = 5$, which contradicts $\\mu \\le 3$. Therefore $\\mu > 3$, so both channels are active and\n$$\n(\\mu - 1) + (\\mu - 3) = 4\n\\;\\;\\Rightarrow\\;\\;\n2\\mu - 4 = 4\n\\;\\;\\Rightarrow\\;\\;\n\\mu = 4.\n$$\nHence\n$$\nP_{1} = \\mu - \\sigma_{1}^{2} = 4 - 1 = 3,\n\\qquad\nP_{2} = \\mu - \\sigma_{2}^{2} = 4 - 3 = 1,\n$$\nwhich satisfy $P_{1} + P_{2} = 4$ and $P_{i} \\ge 0$ and therefore solve the optimal allocation problem.",
            "answer": "$$\\boxed{\\begin{pmatrix}3 & 1\\end{pmatrix}}$$"
        },
        {
            "introduction": "Building on the basic principle, we now consider a slightly more complex system with more channels. A key insight of the water-filling algorithm is that it's not always optimal to use every available channel, especially if some are excessively noisy. This practice  demonstrates how the algorithm makes this decision by introducing the concept of a \"water level\" that determines which channels are worth allocating power to. You will not only determine the optimal power distribution but also see how some channels are left inactive to maximize the overall system capacity.",
            "id": "1668060",
            "problem": "Consider a simplified model of a communication system employing parallel channels, which is a foundational concept in technologies like Orthogonal Frequency-Division Multiplexing (OFDM). The system is comprised of four independent parallel Additive White Gaussian Noise (AWGN) channels. The noise power, represented by the variance $\\sigma_i^2$, for each of the four channels is given as $\\sigma_1^2 = 1.0$, $\\sigma_2^2 = 2.0$, $\\sigma_3^2 = 4.0$, and $\\sigma_4^2 = 8.0$, all in standardized power units.\n\nA total transmission power budget of $P_{\\text{total}} = 10.0$ units is available to be distributed among these four channels. To maximize the overall data rate, the power is allocated according to the water-filling algorithm.\n\nThe capacity $C_i$ of an individual channel $i$ with allocated power $P_i$ and noise power $\\sigma_i^2$ is governed by the formula $C_i = \\log_2(1 + P_i / \\sigma_i^2)$. The unit for capacity is bits per channel use.\n\nCalculate the total capacity of the system, $C_{\\text{total}} = \\sum_{i=1}^4 C_i$. Express your final answer in bits per channel use, rounded to four significant figures.",
            "solution": "We must maximize the sum capacity over four independent AWGN subchannels with noise variances $\\sigma_{1}^{2}=1$, $\\sigma_{2}^{2}=2$, $\\sigma_{3}^{2}=4$, $\\sigma_{4}^{2}=8$, subject to the total power constraint $\\sum_{i=1}^{4}P_{i}=P_{\\text{total}}=10$ and $P_{i}\\geq 0$. The per-channel capacity is $C_{i}=\\log_{2}\\!\\left(1+\\frac{P_{i}}{\\sigma_{i}^{2}}\\right)$, so the optimization problem is\n$$\n\\max_{P_{i}\\geq 0,\\ \\sum P_{i}=10}\\ \\sum_{i=1}^{4}\\log_{2}\\!\\left(1+\\frac{P_{i}}{\\sigma_{i}^{2}}\\right).\n$$\nUsing the KKT conditions for this concave optimization, the optimal allocation is given by the water-filling rule\n$$\nP_{i}=\\max\\{0,\\ \\lambda-\\sigma_{i}^{2}\\},\n$$\nwhere the water level $\\lambda$ is chosen to satisfy $\\sum_{i=1}^{4}P_{i}=10$.\n\nOrder the noise variances as $1,2,4,8$. First test the hypothesis that all four channels are active, which requires $\\lambda>8$. Then\n$$\n\\sum_{i=1}^{4}P_{i}=\\sum_{i=1}^{4}(\\lambda-\\sigma_{i}^{2})=4\\lambda-(1+2+4+8)=4\\lambda-15=10,\n$$\nwhich gives $\\lambda=\\frac{25}{4}=6.25$, contradicting $\\lambda>8$. Hence not all four are active.\n\nNext test three active channels (the first three), which requires $4<\\lambda\\leq 8$. Then\n$$\n\\sum_{i=1}^{3}P_{i}=3\\lambda-(1+2+4)=3\\lambda-7=10 \\quad\\Rightarrow\\quad \\lambda=\\frac{17}{3}.\n$$\nSince $\\frac{17}{3}\\in(4,8)$, this is consistent. Therefore, the optimal powers are\n$$\nP_{1}=\\frac{17}{3}-1=\\frac{14}{3},\\quad P_{2}=\\frac{17}{3}-2=\\frac{11}{3},\\quad P_{3}=\\frac{17}{3}-4=\\frac{5}{3},\\quad P_{4}=0,\n$$\nand indeed $\\frac{14}{3}+\\frac{11}{3}+\\frac{5}{3}=10$.\n\nFor active channels, note that\n$$\n1+\\frac{P_{i}}{\\sigma_{i}^{2}}=1+\\frac{\\lambda-\\sigma_{i}^{2}}{\\sigma_{i}^{2}}=\\frac{\\lambda}{\\sigma_{i}^{2}}.\n$$\nThus the individual capacities are\n$$\nC_{1}=\\log_{2}\\!\\left(\\frac{\\lambda}{\\sigma_{1}^{2}}\\right)=\\log_{2}\\!\\left(\\frac{17}{3}\\right),\\quad\nC_{2}=\\log_{2}\\!\\left(\\frac{17}{6}\\right),\\quad\nC_{3}=\\log_{2}\\!\\left(\\frac{17}{12}\\right),\\quad\nC_{4}=0,\n$$\nand the total capacity is\n$$\nC_{\\text{total}}=\\log_{2}\\!\\left(\\frac{17}{3}\\right)+\\log_{2}\\!\\left(\\frac{17}{6}\\right)+\\log_{2}\\!\\left(\\frac{17}{12}\\right)\n=\\log_{2}\\!\\left(\\frac{17^{3}}{3\\cdot 6\\cdot 12}\\right)\n=\\log_{2}\\!\\left(\\frac{4913}{216}\\right).\n$$\nNumerically, \n$$\nC_{\\text{total}}=\\log_{2}\\!\\left(\\frac{4913}{216}\\right)\\approx 4.507501\\ \\text{bits per channel use},\n$$\nwhich rounded to four significant figures is $4.508$.",
            "answer": "$$\\boxed{4.508}$$"
        },
        {
            "introduction": "Having tackled specific numerical examples, we can now generalize our understanding to a more abstract and powerful level. This final practice  moves away from fixed values and asks you to analyze a system with a large number of channels whose noise characteristics follow a predictable pattern. Your task is to derive a general formula that links the total available power to the number of channels that will be activated. This exercise sharpens your analytical skills and reveals the elegant mathematical structure underlying the water-filling principle.",
            "id": "1668046",
            "problem": "In a multi-carrier digital communication system, such as one using Orthogonal Frequency-Division Multiplexing (OFDM), the total available bandwidth is divided into $M$ independent, parallel, flat-fading sub-channels. The goal is to distribute a total transmission power $P$ among these sub-channels to maximize the overall data rate (i.e., the sum-capacity).\n\nThe capacity of the $i$-th sub-channel is given by $C_i = B \\log_2(1 + P_i/N_i)$, where $B$ is the bandwidth of a sub-channel, $P_i$ is the power allocated to it, and $N_i$ is the noise power in that sub-channel. For simplicity, we will assume $B=1$ and use natural logarithms, which only scales the capacity by a constant factor. The total capacity is $C = \\sum_{i} \\ln(1 + P_i/N_i)$, subject to the total power constraint $\\sum_{i} P_i \\le P$.\n\nThe optimal power allocation strategy is described by the water-filling algorithm. This strategy allocates power $P_i = \\max(0, \\mu - N_i)$ for each channel $i$, where the constant $\\mu$, often called the \"water level,\" is chosen to satisfy the total power constraint. Channels for which $\\mu \\le N_i$ are not used ($P_i = 0$).\n\nConsider a system with a large number of sub-channels ($M \\to \\infty$) whose noise powers are sorted in non-decreasing order, $N_1 \\le N_2 \\le N_3 \\le \\dots$. The noise power for the $i$-th channel is found to follow an arithmetic progression:\n$$N_i = \\alpha + (i-1)\\beta$$\nwhere $\\alpha > 0$ is a base noise power level and $\\beta > 0$ is the incremental noise power per channel index.\n\nThe optimal number of channels to use, denoted $K^*$, is the largest integer $k$ such that the power allocated to the $k$-th channel, $P_k$, is positive. We are interested in the specific boundary condition where the optimal number of active channels is exactly $K$. This occurs when the water level $\\mu$ is precisely equal to the noise level of the next available channel, i.e., $\\mu = N_{K+1}$. In this scenario, channel $K$ receives a positive amount of power, but channel $K+1$ and all subsequent channels receive exactly zero power.\n\nDetermine the exact total power $P$ required for this specific boundary condition to occur. Express your answer in terms of $K$, $\\alpha$, and $\\beta$.",
            "solution": "We use the water-filling allocation $P_{i}=\\max(0,\\mu-N_{i})$ with the water level $\\mu$ chosen to meet the total power constraint. At the boundary where exactly $K$ channels are active, we are given $\\mu=N_{K+1}$ and $P_{K}>0$, $P_{K+1}=0$. With the arithmetic progression $N_{i}=\\alpha+(i-1)\\beta$, we have\n$$\n\\mu=N_{K+1}=\\alpha+K\\beta.\n$$\nFor $i\\in\\{1,\\dots,K\\}$, the allocated power is\n$$\nP_{i}=\\mu-N_{i}=(\\alpha+K\\beta)-\\bigl(\\alpha+(i-1)\\beta\\bigr)=(K-i+1)\\beta,\n$$\nwhich is strictly positive since $\\beta>0$ and $i\\leq K$. For $i\\geq K+1$, $P_{i}=0$ by construction.\n\nThe total power required at this boundary is the sum over the active channels:\n$$\nP=\\sum_{i=1}^{K}P_{i}=\\sum_{i=1}^{K}(K-i+1)\\beta=\\beta\\sum_{j=1}^{K}j=\\beta\\,\\frac{K(K+1)}{2}.\n$$\nEquivalently, using $P=\\sum_{i=1}^{K}(\\mu-N_{i})=K\\mu-\\sum_{i=1}^{K}N_{i}$,\n$$\n\\sum_{i=1}^{K}N_{i}=\\sum_{i=1}^{K}\\bigl(\\alpha+(i-1)\\beta\\bigr)=K\\alpha+\\beta\\frac{K(K-1)}{2},\n$$\nand with $\\mu=\\alpha+K\\beta$,\n$$\nP=K(\\alpha+K\\beta)-\\left(K\\alpha+\\beta\\frac{K(K-1)}{2}\\right)=\\beta\\,\\frac{K(K+1)}{2}.\n$$\nThus the required total power depends only on $K$ and $\\beta$; the $\\alpha$ terms cancel.",
            "answer": "$$\\boxed{\\frac{\\beta K(K+1)}{2}}$$"
        }
    ]
}