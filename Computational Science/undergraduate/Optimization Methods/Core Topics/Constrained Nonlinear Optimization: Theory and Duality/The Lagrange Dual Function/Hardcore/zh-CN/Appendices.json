{
    "hands_on_practices": [
        {
            "introduction": "我们将从一个基本但非常重要的问题开始：求一个点到一个仿射子空间的投影。这个问题不仅在几何上直观，也是学习拉格朗日对偶的绝佳起点 。通过这个练习，你将学会如何为一个等式约束的二次规划问题构建拉格朗日函数，并通过最小化导出其对偶函数。",
            "id": "2167450",
            "problem": "考虑将一个点投影到仿射子空间的问题。这等价于在子空间中寻找一个点 $x$，使其与给定的外部点 $x_0$ 之间的欧几里得距离最短。仿射子空间定义为满足线性系统 $Ax = b$ 的所有点 $x \\in \\mathbb{R}^n$ 的集合，其中 $A$ 是一个给定的 $m \\times n$ 矩阵，$b$ 是一个给定的 $\\mathbb{R}^m$ 中的向量。外部点为 $x_0 \\in \\mathbb{R}^n$。\n\n为了找到这个投影，我们求解以下优化问题：\n$$\n\\begin{array}{ll}\n\\text{minimize} & \\frac{1}{2}\\|x - x_0\\|_2^2 \\\\\n\\text{subject to} & Ax = b\n\\end{array}\n$$\n其中 $\\| \\cdot \\|_2$ 表示标准的欧几里得范数。\n\n你的任务是求出拉格朗日对偶问题的目标函数。这个对偶目标函数，记为 $g(\\nu)$，是与等式约束相关的拉格朗日乘子向量 $\\nu \\in \\mathbb{R}^m$ 的函数。请用含 $\\nu$、$A$、$b$ 和 $x_0$ 的符号表达式来表示你的答案。",
            "solution": "我们为该等式约束问题构造拉格朗日函数。对约束 $Ax=b$ 引入乘子 $\\nu \\in \\mathbb{R}^{m}$，拉格朗日函数为\n$$\nL(x,\\nu)=\\frac{1}{2}\\|x-x_{0}\\|_{2}^{2}+\\nu^{T}(Ax-b).\n$$\n为计算对偶函数 $g(\\nu)=\\inf_{x}L(x,\\nu)$，我们对 $L$ 关于 $x$ 求最小值。令关于 $x$ 的梯度为零，得到平稳性条件：\n$$\n\\nabla_{x}L(x,\\nu)=(x-x_{0})+A^{T}\\nu=0 \\quad \\Longrightarrow \\quad x^{\\star}(\\nu)=x_{0}-A^{T}\\nu.\n$$\n将 $x^{\\star}(\\nu)$ 代回 $L$ 中，得到\n$$\ng(\\nu)=L(x^{\\star}(\\nu),\\nu)=\\frac{1}{2}\\|x_{0}-A^{T}\\nu - x_{0}\\|_{2}^{2}+\\nu^{T}\\big(A(x_{0}-A^{T}\\nu)-b\\big).\n$$\n逐项化简，\n$$\n\\frac{1}{2}\\|x_{0}-A^{T}\\nu - x_{0}\\|_{2}^{2}=\\frac{1}{2}\\|-A^{T}\\nu\\|_{2}^{2}=\\frac{1}{2}\\nu^{T}AA^{T}\\nu,\n$$\n以及\n$$\n\\nu^{T}\\big(A(x_{0}-A^{T}\\nu)-b\\big)=\\nu^{T}Ax_{0}-\\nu^{T}AA^{T}\\nu-\\nu^{T}b.\n$$\n因此，\n$$\ng(\\nu)=\\frac{1}{2}\\nu^{T}AA^{T}\\nu+\\nu^{T}Ax_{0}-\\nu^{T}AA^{T}\\nu-\\nu^{T}b\n=-\\frac{1}{2}\\nu^{T}AA^{T}\\nu+\\nu^{T}(Ax_{0}-b).\n$$\n等价地，$g(\\nu)=-\\frac{1}{2}\\|A^{T}\\nu\\|_{2}^{2}+(Ax_{0}-b)^{T}\\nu$。",
            "answer": "$$\\boxed{-\\frac{1}{2}\\nu^{T}AA^{T}\\nu+\\nu^{T}(Ax_{0}-b)}$$"
        },
        {
            "introduction": "在掌握了基本技巧后，我们将挑战一个在机器学习和统计学中至关重要的问题：将一个向量投影到概率单纯形上 。这个问题同时包含了等式和不等式约束，让你练习处理更复杂的场景。这个练习的精髓在于，通过求解对偶问题，我们能揭示原问题最优解所具有的优美“阈值”结构，深刻体会对偶理论的威力。",
            "id": "3191755",
            "problem": "考虑向量 $y \\in \\mathbb{R}^{n}$ 在概率单纯形 $\\Delta^{n} = \\{ x \\in \\mathbb{R}^{n} : x \\geq 0, \\ \\mathbf{1}^{\\top} x = 1 \\}$ 上的欧几里得投影，该问题可表述为如下凸优化问题\n$$\n\\min_{x \\in \\mathbb{R}^{n}} \\ \\frac{1}{2} \\| x - y \\|_{2}^{2} \\quad \\text{subject to} \\quad x \\geq 0, \\ \\mathbf{1}^{\\top} x = 1,\n$$\n其中 $\\mathbf{1} \\in \\mathbb{R}^{n}$ 表示全一向量。从拉格朗日函数和拉格朗日对偶函数的定义出发，通过对不等式乘子进行最大化来消去它们，从而推导出与等式乘子 $\\nu \\in \\mathbb{R}$ 相关联的对偶函数 $g(\\nu)$。然后，描述最大化 $g(\\nu)$ 的最优标量 $\\nu$ 如何为原最优解 $x^{\\star}$ 导出一种阈值形式。\n\n您必须从核心定义出发：拉格朗日函数、对偶函数（定义为拉格朗日函数对原变量的下确界）以及卡鲁什-库恩-塔克（KKT）条件（平稳性、原始可行性、对偶可行性和互补松弛性）。不要假设任何预先推导出的投影公式。\n\n您的最终答案必须是关于 $\\nu$ 和 $y$ 的对偶函数 $g(\\nu)$ 的单一闭式解析表达式。不需要进行数值计算。",
            "solution": "我们从以下凸优化问题开始\n$$\n\\min_{x \\in \\mathbb{R}^{n}} \\ \\frac{1}{2} \\| x - y \\|_{2}^{2} \\quad \\text{subject to} \\quad x \\geq 0, \\ \\mathbf{1}^{\\top} x = 1.\n$$\n为不等式约束 $x \\geq 0$ 引入拉格朗日乘子 $\\mu \\in \\mathbb{R}^{n}$，为等式约束 $\\mathbf{1}^{\\top} x = 1$ 引入拉格朗日乘子 $\\nu \\in \\mathbb{R}$。拉格朗日函数为\n$$\n\\mathcal{L}(x, \\mu, \\nu) = \\frac{1}{2} \\| x - y \\|_{2}^{2} - \\mu^{\\top} x + \\nu \\left( \\mathbf{1}^{\\top} x - 1 \\right),\n$$\n其中对偶可行性要求 $\\mu \\geq 0$。拉格朗日对偶函数 $g(\\mu, \\nu)$ 定义为拉格朗日函数对原变量 $x$ 的下确界：\n$$\ng(\\mu, \\nu) = \\inf_{x \\in \\mathbb{R}^{n}} \\ \\mathcal{L}(x, \\mu, \\nu).\n$$\n由于目标函数关于 $x$ 是严格凸的，其下确界在唯一的驻点处取得，该驻点处的梯度为零。计算平稳性条件：\n$$\n\\nabla_{x} \\mathcal{L}(x, \\mu, \\nu) = x - y - \\mu + \\nu \\mathbf{1} = 0 \\quad \\Rightarrow \\quad x^{\\star}(\\mu, \\nu) = y + \\mu - \\nu \\mathbf{1}.\n$$\n将 $x^{\\star}(\\mu, \\nu)$ 代入拉格朗日函数：\n\\begin{align*}\n\\mathcal{L}\\big(x^{\\star}(\\mu, \\nu), \\mu, \\nu\\big)\n&= \\frac{1}{2} \\| x^{\\star}(\\mu, \\nu) - y \\|_{2}^{2} - \\mu^{\\top} x^{\\star}(\\mu, \\nu) + \\nu \\left( \\mathbf{1}^{\\top} x^{\\star}(\\mu, \\nu) - 1 \\right) \\\\\n&= \\frac{1}{2} \\| \\mu - \\nu \\mathbf{1} \\|_{2}^{2} - \\mu^{\\top} \\big( y + \\mu - \\nu \\mathbf{1} \\big) + \\nu \\big( \\mathbf{1}^{\\top} y + \\mathbf{1}^{\\top} \\mu - n \\nu - 1 \\big).\n\\end{align*}\n逐项展开并简化，\n\\begin{align*}\n\\frac{1}{2} \\| \\mu - \\nu \\mathbf{1} \\|_{2}^{2} &= \\frac{1}{2} \\left( \\| \\mu \\|_{2}^{2} - 2 \\nu \\mathbf{1}^{\\top} \\mu + n \\nu^{2} \\right), \\\\\n- \\mu^{\\top} ( y + \\mu - \\nu \\mathbf{1} ) &= - \\mu^{\\top} y - \\| \\mu \\|_{2}^{2} + \\nu \\mathbf{1}^{\\top} \\mu, \\\\\n\\nu ( \\mathbf{1}^{\\top} y + \\mathbf{1}^{\\top} \\mu - n \\nu - 1 ) &= \\nu \\mathbf{1}^{\\top} y + \\nu \\mathbf{1}^{\\top} \\mu - n \\nu^{2} - \\nu.\n\\end{align*}\n因此，\n\\begin{align*}\ng(\\mu, \\nu)\n&= \\left[ \\frac{1}{2} \\| \\mu \\|_{2}^{2} - \\nu \\mathbf{1}^{\\top} \\mu + \\frac{1}{2} n \\nu^{2} \\right]\n   + \\left[ - \\mu^{\\top} y - \\| \\mu \\|_{2}^{2} + \\nu \\mathbf{1}^{\\top} \\mu \\right]\n   + \\left[ \\nu \\mathbf{1}^{\\top} y + \\nu \\mathbf{1}^{\\top} \\mu - n \\nu^{2} - \\nu \\right] \\\\\n&= - \\frac{1}{2} \\| \\mu \\|_{2}^{2} - \\mu^{\\top} y + \\nu \\mathbf{1}^{\\top} y + \\nu \\mathbf{1}^{\\top} \\mu - \\frac{1}{2} n \\nu^{2} - \\nu.\n\\end{align*}\n按分量收集项会很方便；注意，对 $\\mu_{i}$ 的依赖是可分离的：\n$$\ng(\\mu, \\nu) = \\sum_{i=1}^{n} \\left( - \\frac{1}{2} \\mu_{i}^{2} - \\mu_{i} y_{i} + \\nu \\mu_{i} \\right) + \\nu \\left( \\sum_{i=1}^{n} y_{i} - 1 \\right) - \\frac{1}{2} n \\nu^{2}.\n$$\n对于固定的 $\\nu$，我们逐分量计算 $g(\\mu, \\nu)$ 在 $\\mu \\geq 0$ 上的上确界。对每个索引 $i$，考虑关于 $\\mu_{i}$ 的凹二次函数：\n$$\n\\phi_{i}(\\mu_{i}; \\nu) = - \\frac{1}{2} \\mu_{i}^{2} - \\mu_{i} ( y_{i} - \\nu ), \\quad \\text{subject to} \\quad \\mu_{i} \\geq 0.\n$$\n无约束最大化解满足 $\\frac{\\partial \\phi_{i}}{\\partial \\mu_{i}} = - \\mu_{i} - ( y_{i} - \\nu ) = 0$，因此 $\\mu_{i}^{\\star} = - ( y_{i} - \\nu )$。施加 $\\mu_{i} \\geq 0$ 的约束得到\n$$\n\\mu_{i}^{\\star}(\\nu) = \\max\\{ 0, \\ \\nu - y_{i} \\}.\n$$\n将 $\\mu_{i}^{\\star}$ 代回 $\\phi_{i}$ 得到\n$$\n\\sup_{\\mu_{i} \\geq 0} \\ \\phi_{i}(\\mu_{i}; \\nu)\n= \\begin{cases}\n\\frac{1}{2} ( \\nu - y_{i} )^{2}, & \\text{if } \\nu \\geq y_{i}, \\\\\n0, & \\text{if } \\nu < y_{i},\n\\end{cases}\n= \\frac{1}{2} \\big( \\nu - y_{i} \\big)_{+}^{2},\n$$\n其中 $(a)_{+} = \\max\\{ a, 0 \\}$。因此，在对 $\\mu \\geq 0$ 进行最大化之后，对偶函数简化为标量函数\n$$\ng(\\nu) = \\sum_{i=1}^{n} \\frac{1}{2} \\big( \\nu - y_{i} \\big)_{+}^{2} + \\nu \\left( \\sum_{i=1}^{n} y_{i} - 1 \\right) - \\frac{1}{2} n \\nu^{2}.\n$$\n这个 $g(\\nu)$ 是关于 $\\nu$ 的凹函数，因为它是凹函数（每个都是分段二次凹函数）之和减去一个正的二次项。\n\n我们现在使用卡鲁什-库恩-塔克（KKT）条件，根据最大化 $g(\\nu)$ 的 $\\nu$ 来提取原最优解 $x^{\\star}$。根据平稳性条件，\n$$\nx^{\\star} = y + \\mu^{\\star} - \\nu^{\\star} \\mathbf{1},\n$$\n并从 $\\mu^{\\star}$ 的表达式中，我们逐分量地得到\n$$\nx_{i}^{\\star} = y_{i} + \\max\\{ 0, \\ \\nu^{\\star} - y_{i} \\} - \\nu^{\\star} = \\max\\{ y_{i} - \\nu^{\\star}, \\ 0 \\}.\n$$\n因此 $x^{\\star} = \\big( y - \\nu^{\\star} \\mathbf{1} \\big)_{+}$，这是一个由 $\\nu^{\\star}$ 参数化的阈值规则。施加等式约束 $\\mathbf{1}^{\\top} x^{\\star} = 1$ 得到标量方程\n$$\n\\sum_{i=1}^{n} \\max\\{ y_{i} - \\nu^{\\star}, \\ 0 \\} = 1,\n$$\n该方程在一般情况下唯一确定了 $\\nu^{\\star}$（目标函数的严格凸性保证了唯一的 $x^{\\star}$；当多个索引在阈值处相等时，任何满足该方程的相应 $\\nu^{\\star}$ 都会产生相同的 $x^{\\star}$）。总而言之，对偶函数是上述的标量凹函数 $g(\\nu)$，而原问题的解是一个阈值化向量，其阈值为 $\\nu^{\\star}$，该阈值使得向量各分量之和为一。\n\n所要求的最终答案是 $g(\\nu)$ 的解析表达式。",
            "answer": "$$\\boxed{g(\\nu)=\\sum_{i=1}^{n}\\frac{1}{2}\\big(\\nu-y_{i}\\big)_{+}^{2}+\\nu\\left(\\sum_{i=1}^{n}y_{i}-1\\right)-\\frac{1}{2}n\\,\\nu^{2}}$$"
        }
    ]
}