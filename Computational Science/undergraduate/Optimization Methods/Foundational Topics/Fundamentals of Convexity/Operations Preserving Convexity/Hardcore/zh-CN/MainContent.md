## 引言
[凸性](@entry_id:138568)是现代优化的基石，它保证了局部最优即是全局最优，使得问题在计算上变得可行。然而，在面对复杂的现实问题时，我们如何系统地构建和验证目标函数或约束是凸的？这正是“保持[凸性](@entry_id:138568)的运算”这一主题的核心价值所在：它为我们提供了一套如同“微积分”般的法则，让我们能够从已知的简单[凸函数](@entry_id:143075)（如线性函数、二次函数）出发，像搭建积木一样，可靠地构造出描述复杂系统的、更高阶的凸函数。

本文旨在填补理论定义与实际建模之间的鸿沟，系统性地梳理这些保凸运算，并揭示其在多个学科中的强大应用。读者将通过本文学习到：在“原理与机制”一章中，我们将深入探讨构成“[凸函数](@entry_id:143075)微积分”核心的基本运算，如非负加权和、与[仿射映射](@entry_id:746332)的复合、[逐点上确界](@entry_id:635105)，以及更高级的复合规则和几何构造方法。接下来的“应用与跨学科联系”一章将展示这些抽象原理如何在机器学习、信号处理、工程设计乃至几何分析等领域大放异彩，将理论与实践紧密相连。最后，“动手实践”部分提供了精选的练习，旨在通过具体问题加深对这些核心概念的理解和应用能力。

让我们首先进入第一章，系统地学习这些保凸运算的原理与机制。

## 原理与机制

在深入探讨凸优化算法之前，我们必须首先掌握其基石——[凸函数](@entry_id:143075)。识别并构造凸函数是应用凸[优化理论](@entry_id:144639)解决实际问题的关键第一步。本章将系统地阐述一系列保持函数凸性的运算，这些运算构成了“凸函数微积分”的核心。通过掌握这些原理与机制，我们能够像搭建积木一样，从简单的已知凸函数出发，构建出描述复杂问题的、更高阶的[凸函数](@entry_id:143075)。

### 基本保凸运算

最基础的保凸运算构成了我们工具箱的基石。它们直接源于[凸性](@entry_id:138568)的定义，并且具有直观的几何或代数解释。

#### 非负加权和

最直接的保凸运算是求和。如果函数 $f_1, \dots, f_m$ 均为[凸函数](@entry_id:143075)，那么它们的非负加权和同样是[凸函数](@entry_id:143075)。

形式上，令 $w_1, \dots, w_m$ 为一组非负标量（即 $w_i \ge 0$），则函数 $f(x) = \sum_{i=1}^m w_i f_i(x)$ 是[凸函数](@entry_id:143075)。我们可以通过凸性的定义来验证这一点。对于任意 $x, y \in \mathbb{R}^n$ 和 $\theta \in [0,1]$：

$$
\begin{align}
f(\theta x + (1-\theta)y)  = \sum_{i=1}^m w_i f_i(\theta x + (1-\theta)y) \\
 \le \sum_{i=1}^m w_i (\theta f_i(x) + (1-\theta)f_i(y)) \quad (\text{因为 } f_i \text{ 是凸函数且 } w_i \ge 0) \\
 = \theta \sum_{i=1}^m w_i f_i(x) + (1-\theta) \sum_{i=1}^m w_i f_i(y) \\
 = \theta f(x) + (1-\theta)f(y)
\end{align}
$$

其中，从第一行到第二行的不等式成立，是因为每个 $f_i$ 都是[凸函数](@entry_id:143075)，且非负权重 $w_i$ 保持了不等号的方向。

权重 $w_i$ 的非负性是至关重要的。如果允许负权重，凸性通常会遭到破坏。例如，考虑两个[凸函数](@entry_id:143075) $f_1(x)=x^2$ 和 $f_2(x)=(2x)^2$。如果我们使用负权重（例如 $w_1=1, w_2=-1$）对它们求和，得到的函数 $f(x) = f_1(x) - f_2(x) = x^2 - 4x^2 = -3x^2$ 是一个[凹函数](@entry_id:274100)，而非凸函数 。

然而，这个规则有一个有趣的例外：如果某个负权重 $w_j \lt 0$ 对应的函数 $f_j(x)$ 是一个常数，那么凸性依然可以保持。这是因为加上一个常数项（无论是正还是负）等价于对函数的图像进行垂直平移，这不会改变其本身的凹凸性。更严谨地说，一个常数函数本身是凸函数（也是[凹函数](@entry_id:274100)），因此，一个凸函数加上一个[常数函数](@entry_id:152060)，仍然是凸函数 。

#### 与[仿射映射](@entry_id:746332)的复合

另一个极其重要的保凸运算是与[仿射映射](@entry_id:746332)的复合。**[仿射映射](@entry_id:746332)** (affine map) 是指形如 $Ax+b$ 的变换，其中 $A$ 是一个矩阵，$b$ 是一个向量。如果 $f: \mathbb{R}^m \to \mathbb{R}$ 是一个[凸函数](@entry_id:143075)，那么对于任意矩阵 $A \in \mathbb{R}^{m \times n}$ 和向量 $b \in \mathbb{R}^m$，[复合函数](@entry_id:147347) $g(x) = f(Ax+b)$ 是一个定义在 $\mathbb{R}^n$ 上的凸函数。

证明同样直接运用定义：
$$
\begin{align}
g(\theta x + (1-\theta)y)  = f(A(\theta x + (1-\theta)y) + b) \\
 = f(\theta(Ax+b) + (1-\theta)(Ay+b)) \quad (\text{因为映射是仿射的}) \\
 \le \theta f(Ax+b) + (1-\theta)f(Ay+b) \quad (\text{因为 } f \text{ 是凸函数}) \\
 = \theta g(x) + (1-\theta)g(y)
\end{align}
$$
这个性质极为强大。例如，它意味着如果我们有一个一维凸函数 $\phi(t)$，那么对于任意向量 $a \in \mathbb{R}^n$，函数 $f(x) = \phi(a^T x)$ 都是凸的。结合非负加权和的性质，我们可以立即推断出，形如 $f(x) = \sum_{i=1}^m w_i \phi_i(a_i^T x)$ 的函数，只要所有 $w_i \ge 0$ 且所有 $\phi_i$ 都是[凸函数](@entry_id:143075)，那么 $f(x)$ 也必定是凸函数 。这个结构在统计学和机器学习的模型中非常常见。

### 更复杂的复合运算

基于上述基本运算，我们可以推导出更普适和更强大的复合规则。

#### 一般复合规则

对于标量[函数复合](@entry_id:144881) $h(x) = \phi(f(x))$，其中 $f: \mathbb{R}^n \to \mathbb{R}$，$ \phi: \mathbb{R} \to \mathbb{R}$，凸性是否保持取决于内外函数的性质。一个通用的法则是：
如果 $f$ 是[凸函数](@entry_id:143075)，且 $\phi$ 是一个凸的、**非减** (non-decreasing) 函数，那么[复合函数](@entry_id:147347) $h(x) = \phi(f(x))$ 是[凸函数](@entry_id:143075)。

证明这个法则需要两步：
首先，由于 $f$ 是凸的，我们有 $f(\theta x + (1-\theta)y) \le \theta f(x) + (1-\theta)f(y)$。
其次，因为 $\phi$ 是非减函数，我们可以将它作用于不等式两侧而不改变方向：
$$ \phi(f(\theta x + (1-\theta)y)) \le \phi(\theta f(x) + (1-\theta)f(y)) $$
最后，因为 $\phi$ 本身是[凸函数](@entry_id:143075)，我们得到：
$$ \phi(\theta f(x) + (1-\theta)f(y)) \le \theta \phi(f(x)) + (1-\theta)\phi(f(y)) $$
将这几步结合起来，便证明了 $h(x)$ 的凸性：$h(\theta x + (1-\theta)y) \le \theta h(x) + (1-\theta)h(y)$ [@problem_id:3160291, @problem_id:3160281]。

“非减”这一条件不可或缺。如果 $\phi$ 是递减的，即使它本身是凸的，复合函数也可能不是凸的。例如，$\phi(t) = e^{-t}$ 是一个凸且严格递减的函数。如果 $f(x)=x^2$（[凸函数](@entry_id:143075)），那么复合函数 $h(x)=e^{-x^2}$ 是一个[钟形曲线](@entry_id:150817)，它并不是[凸函数](@entry_id:143075)。

#### 逐点[上确界与下确界](@entry_id:146074)

**[逐点上确界](@entry_id:635105) (pointwise supremum)** 运算是构造凸函数的一种非常强大的方式。如果对于某个索引集 $\mathcal{I}$，函数族 $\{f_i(x)\}_{i \in \mathcal{I}}$ 中的每一个函数都是凸函数，那么它们在每一点的[上确界](@entry_id:140512)（或最大值）所定义的函数
$$ f(x) = \sup_{i \in \mathcal{I}} f_i(x) $$
也是一个[凸函数](@entry_id:143075)。

这个性质的几何意义是，一个函数的**上境图** (epigraph) 是其图像上方所有点的集合，即 $\mathbf{epi}(f) = \{(x,t) | t \ge f(x)\}$。一个函数是凸的，当且仅当其上境图是一个[凸集](@entry_id:155617)。而[逐点上确界](@entry_id:635105)函数的上境图，恰好是所有单个函数上境图的交集：
$$ \mathbf{epi}(f) = \bigcap_{i \in \mathcal{I}} \mathbf{epi}(f_i) $$
由于任意数量[凸集](@entry_id:155617)的交集仍然是[凸集](@entry_id:155617)，所以 $f$ 的上境图是凸的，因此 $f$ 是[凸函数](@entry_id:143075)。

这个原理有一个极其重要的应用：任何一个凸函数都可以表示为一族[仿射函数](@entry_id:635019)的[逐点上确界](@entry_id:635105)。一个典型的例子就是 $f(x) = \sup_{i \in I} (a_i^T x + b_i)$。由于每个[仿射函数](@entry_id:635019) $a_i^T x + b_i$ 都是凸的，它们的上确界也必然是凸的。无论我们在这个集合中增加或删除某些[仿射函数](@entry_id:635019)，只要集合非空，最终得到的函数仍然是凸的 。

与[上确界](@entry_id:140512)相对，**逐点[下确界](@entry_id:140118) (pointwise infimum)** 通常不保持[凸性](@entry_id:138568)。实际上，两个凸函数的逐点下确界很可能是一个非凸函数。一个经典的例子是 $h(x) = \min((x-1)^2, (x+1)^2)$，它的图像在原点处有一个向上的“[尖点](@entry_id:636792)”，破坏了[凸性](@entry_id:138568) 。另一个例子是 $h(x) = \inf(x, -x) = -|x|$，它是一个典型的[凹函数](@entry_id:274100) 。

### 从几何到函数：凸集与[凸函数](@entry_id:143075)的关系

凸函数和凸集之间存在着深刻的内在联系。这种联系不仅为我们提供了理解[凸性](@entry_id:138568)的新视角，还允许我们从一个领域的对象构造另一个领域的对象。

#### 凸函数的[水平集](@entry_id:751248)

一个函数 $f$ 的 $\alpha$-**水平集** ($\alpha$-sublevel set) 被定义为所有使得函数值不大于 $\alpha$ 的点的集合，即 $L_{\alpha}(f) = \{x \in \mathbb{R}^n | f(x) \le \alpha\}$。

一个核心性质是：**如果函数 $f$ 是[凸函数](@entry_id:143075)，那么它的所有水平集都是[凸集](@entry_id:155617)** 。
证明很简单：任取两点 $x, y \in L_{\alpha}(f)$，这意味着 $f(x) \le \alpha$ 且 $f(y) \le \alpha$。对于任意 $\theta \in [0,1]$，由于 $f$ 是[凸函数](@entry_id:143075)，我们有：
$$ f(\theta x + (1-\theta)y) \le \theta f(x) + (1-\theta)f(y) \le \theta \alpha + (1-\theta)\alpha = \alpha $$
这表明点 $\theta x + (1-\theta)y$ 也在 $L_{\alpha}(f)$ 中，因此该水平集是凸集。

这个性质为我们理解其他保凸运算提供了几何直觉。例如，考虑函数 $h(x) = \max(f(x), g(x))$，其中 $f,g$ 均为凸函数。$h(x)$ 的[水平集](@entry_id:751248)为：
$$ L_{\alpha}(h) = \{x | \max(f(x), g(x)) \le \alpha\} = \{x | f(x) \le \alpha \text{ and } g(x) \le \alpha\} = L_{\alpha}(f) \cap L_{\alpha}(g) $$
由于 $f$ 和 $g$ 都是[凸函数](@entry_id:143075)，它们的[水平集](@entry_id:751248) $L_{\alpha}(f)$ 和 $L_{\alpha}(g)$ 都是[凸集](@entry_id:155617)。而两个凸集的交集仍然是[凸集](@entry_id:155617)，所以 $L_{\alpha}(h)$ 是[凸集](@entry_id:155617)。这与 $h(x)$ 是[凸函数](@entry_id:143075)的事实相符 。

需要注意的是，[水平集](@entry_id:751248)的并集通常不是[凸集](@entry_id:155617)。但有一个特殊情况：如果 $\alpha \lt \beta$，那么 $L_{\alpha}(f) \subseteq L_{\beta}(f)$。因此它们的并集就是较大的那个集合 $L_{\beta}(f)$，它本身是凸的 。

#### 从凸集构造凸函数：Minkowski 泛函

我们也可以反向操作：从一个[凸集](@entry_id:155617)出发构造一个[凸函数](@entry_id:143075)。一个优美的例子是 **Minkowski 泛函** (Minkowski functional)，也称为**[规范函数](@entry_id:749731)** (gauge function)。

给定一个包含原点的[凸集](@entry_id:155617) $C \subset \mathbb{R}^n$，其[规范函数](@entry_id:749731) $\gamma_C(x)$ 定义为：
$$ \gamma_C(x) := \inf\{\lambda \gt 0 : x \in \lambda C\} $$
其中 $\lambda C = \{\lambda c : c \in C\}$ 是对集合 $C$ 的缩放。直观上，$\gamma_C(x)$ 回答了这样一个问题：“我们需要将集合 $C$ ‘膨胀’多少倍才能刚好包含点 $x$？”

这个由几何定义的函数具有两个关键的代数性质：
1.  **非负齐次性 (Non-negative homogeneity):** 对任意 $\alpha \ge 0$，有 $\gamma_C(\alpha x) = \alpha \gamma_C(x)$。
2.  **[次可加性](@entry_id:137224) (Subadditivity) 或[三角不等式](@entry_id:143750):** 对任意 $x, y$，有 $\gamma_C(x+y) \le \gamma_C(x) + \gamma_C(y)$。

同时满足这两个性质的函数被称为**[次线性泛函](@entry_id:143368)** (sublinear functional)，而任何[次线性泛函](@entry_id:143368)都是[凸函数](@entry_id:143075)。我们可以直接验证这一点：
$$ \gamma_C(\theta x + (1-\theta)y) \le \gamma_C(\theta x) + \gamma_C((1-\theta)y) = \theta \gamma_C(x) + (1-\theta)\gamma_C(y) $$
第一步利用了[次可加性](@entry_id:137224)，第二步利用了非负齐次性（因为 $\theta, 1-\theta \ge 0$）。这证明了 $\gamma_C(x)$ 是一个凸函数 。这为我们提供了一条从[凸几何](@entry_id:262845)到[凸函数](@entry_id:143075)的优雅路径。

### 高等保凸运算及其在优化中的应用

除了上述基本操作，一些在现代优化和机器学习中至关重要的、更高级的运算同样保持凸性。

#### 期望与风险度量

在处理不确定性的[优化问题](@entry_id:266749)中，我们常常需要对与某个[随机变量](@entry_id:195330) $\xi$ 相关的[损失函数](@entry_id:634569) $\ell(x, \xi)$ 进行操作。如果对于每一个可能的 $\xi$，函数 $x \mapsto \ell(x, \xi)$ 都是凸的，那么：

- **期望 (Expectation)** 运算保持凸性。函数 $f(x) = \mathbb{E}[\ell(x, \xi)]$ 是凸的。这可以看作是“非负加权和”在[连续概率](@entry_id:151395)空间中的推广 。

- **分位数 (Quantile)** 或 **风险价值 (Value-at-Risk, VaR)** 通常**不**保持[凸性](@entry_id:138568)。$\mathrm{Quantile}_{\alpha}(\ell(x,\xi))$ 函数，即使对于简单的凸[损失函数](@entry_id:634569)族，也可能产生非凸的结果。我们之前看到的 $\min((x-1)^2, (x+1)^2)$ 的例子就可以被解释为某个随机损失的 $0.5$-分位数（即[中位数](@entry_id:264877)） 。

- **[条件风险价值](@entry_id:136521) (Conditional Value-at-Risk, C[VaR](@entry_id:140792))** 则保持[凸性](@entry_id:138568)。$\mathrm{CVaR}_{\alpha}$ 定义为超过 $\alpha$-[分位数](@entry_id:178417)的所有损失的平均值，它有一个等价的变分表示：
$$ \mathrm{CVaR}_{\alpha}(\ell(x,\xi)) = \inf_{t \in \mathbb{R}} \left( t + \frac{1}{1-\alpha} \mathbb{E}[\max\{0, \ell(x, \xi) - t\}] \right) $$
我们可以使用复合运算法则来证明右侧的函数是关于 $x$ 的[凸函数](@entry_id:143075)。具体来说，表达式 $\max\{0, \ell(x, \xi) - t\}$ 是一个关于 $(x,t)$ 的[凸函数](@entry_id:143075)（[凸函数](@entry_id:143075)与非减[凸函数](@entry_id:143075) $\max(0,\cdot)$ 的复合），取期望后仍然是关于 $(x,t)$ 的[凸函数](@entry_id:143075)，加上 $t$ 后亦然。最后，对一个联合凸函数取关于部分变量（这里是 $t$）的下确界，得到的函数是凸的。因此，CVaR 是一种在优化模型中比 VaR 更受欢迎的风险度量，因为它能保持问题的凸性 。

#### Moreau 包络：一种正则化与[平滑技术](@entry_id:634779)

**Moreau 包络 (Moreau envelope)** 是一个在现代优化理论和算法中扮演核心角色的运算。对于一个正常、下半连续的[凸函数](@entry_id:143075) $f$，其 Moreau 包络定义为：
$$ e_\lambda f(x) = \inf_{y \in \mathbb{R}^n} \left\{ f(y) + \frac{1}{2\lambda} \|x-y\|^2 \right\} $$
其中 $\lambda \gt 0$ 是一个参数。这个运算也被称为**[下确界](@entry_id:140118)卷积 (infimal convolution)**。

Moreau 包络最重要的性质包括：
1.  **保[凸性](@entry_id:138568):** 如果 $f$ 是凸函数，那么 $e_\lambda f$ 也是凸函数。这可以通过证明它是两个[凸函数](@entry_id:143075) $f(y)$ 和 $g(x-y)=\frac{1}{2\lambda}\|x-y\|^2$ 的[下确界](@entry_id:140118)卷积来确立。反之，如果 $f$ 不是凸函数，那么 $e_\lambda f$ 通常也不是[凸函数](@entry_id:143075) 。
2.  **平滑性:** 无论原始函数 $f$ 是否光滑（例如 $f(x)=|x|$ 在原点处不可导），它的 Moreau 包络 $e_\lambda f$ 总是处处可微的，并且其梯度是 Lipschitz 连续的，Lipschitz 常数为 $1/\lambda$ 。这使得 Moreau 包络成为将[非光滑优化](@entry_id:167581)问题转化为光滑问题的一种强大工具。
3.  **逼近性:** Moreau 包络是原函数 $f$ 的一种下逼近，即 $e_\lambda f(x) \le f(x)$。当 $\lambda \to 0$ 时， $e_\lambda f(x)$ 从下方[逐点收敛](@entry_id:145914)于 $f(x)$；而当 $\lambda \to \infty$ 时，它收敛于 $f$ 的[全局最小值](@entry_id:165977) $\inf_y f(y)$ 。

#### 复合的微妙之处：[Softmax](@entry_id:636766) 案例分析

最后，我们来看一个高级的复合例子，它揭示了保凸运算的微妙之处。在机器学习中，**[Softmax](@entry_id:636766) 函数** $\sigma: \mathbb{R}^n \to \mathbb{R}^n$ 将一个向量映射到[概率单纯形](@entry_id:635241)上。一个自然的问题是：如果 $f$ 是定义在[概率单纯形](@entry_id:635241)上的凸函数，那么复合函数 $g(x) = f(\sigma(x))$ 是否也是[凸函数](@entry_id:143075)？

答案是否定的。例如，即使 $f(z)=z_1$ 这样一个简单的线性（因此是凸的）函数，其复合 $g(x) = \sigma_1(x) = \frac{\exp(x_1)}{\sum_j \exp(x_j)}$ 也不是一个凸函数。

要进行严格的分析，需要动用多元微积分中的[链式法则](@entry_id:190743)计算[复合函数](@entry_id:147347) $g(x)$ 的[海森矩阵](@entry_id:139140) (Hessian matrix)。一个二次可微的函数是凸的，当且仅当其海森矩阵在定义域内处处是半正定的。$g(x)$ 的[海森矩阵](@entry_id:139140)可以表示为：
$$ \nabla^2 g(x) = J_{\sigma}(x)^T \nabla^2 f(\sigma(x)) J_{\sigma}(x) + \sum_{i=1}^n \frac{\partial f}{\partial z_i}(\sigma(x)) H_{\sigma_i}(x) $$
其中 $J_{\sigma}$ 是 $\sigma$ 的雅可比矩阵，$\nabla^2 f$ 是 $f$ 的[海森矩阵](@entry_id:139140)，$H_{\sigma_i}$ 是 $\sigma$ 第 $i$ 个分量的海森矩阵 。

由于 $f$ 是凸的，$\nabla^2 f$ 是半正定的，因此第一项 $J_{\sigma}^T (\nabla^2 f) J_{\sigma}$ 总是半正定的。然而，第二项是一个由 $f$ 的梯度和 $\sigma$ 各分量的[海森矩阵](@entry_id:139140)加权构成的和。即使 $f$ 的梯度分量非负，$\sigma$ 各分量的[海森矩阵](@entry_id:139140) $H_{\sigma_i}(x)$ 也不是半正定的。因此，第二项整体的符号不确定，它可能“压倒”第一项的正定性，导致整个 $\nabla^2 g(x)$ 变得不定，从而破坏了 $g(x)$ 的[凸性](@entry_id:138568)。这个例子警示我们，对于复杂的[复合函数](@entry_id:147347)，直觉可能会失效，必须进行严谨的数学分析。