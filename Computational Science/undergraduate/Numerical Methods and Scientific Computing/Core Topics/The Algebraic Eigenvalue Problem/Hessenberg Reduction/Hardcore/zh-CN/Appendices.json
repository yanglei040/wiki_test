{
    "hands_on_practices": [
        {
            "introduction": "要真正掌握一个算法，通过一个简单而又非凡的例子进行手动计算是极好的方法。本练习将聚焦于豪斯霍尔德变换（Householder transformation），这是海森伯格约化的核心构建模块。我们将使用一个特殊构造的整数矩阵，其约化过程可以完全在有理数域内精确完成，从而在不受浮点误差干扰的情况下，揭示算法引入零元素的底层机制 。",
            "id": "3238489",
            "problem": "考虑使用由Householder反射构建的正交相似变换将一个实矩阵约化为Hessenberg形式的任务。回顾一下，对于实对称矩阵，其上Hessenberg形式与三对角形式是一致的。构建一个特定的整数矩阵\n$$\nA \\;=\\;\n\\begin{pmatrix}\n7  & 1 & 2 & 2 \\\\\n1  & 1 & 0 & 0 \\\\\n2  & 0 & 1 & 0 \\\\\n2  & 0 & 0 & 1\n\\end{pmatrix},\n$$\n这是一个对称的 $4 \\times 4$ 矩阵。从正交矩阵和Householder反射的基本定义出发（不借助任何预先打包的算法捷径），执行第一步相似变换，该变换只非平凡地作用于尾部的 $(4-1) \\times (4-1)$ 子块（即索引为 2 到 4 的行和列），以便在第 1 列的次对角线下方引入零。然后，仔细论证为什么对于这个特定的矩阵 $A$，整个三对角化过程可以仅使用有理数算术来完成。\n\n令 $T$ 表示通过此Hessenberg（三对角）约化从 $A$ 得到的最终三对角矩阵。计算 $T$ 的 $(2,1)$ 元素的精确值。请以精确形式表示最终答案，无需四舍五入。",
            "solution": "问题要求做两件事：首先，计算通过Householder约化从给定对称矩阵 $A$ 得到的最终三对角矩阵 $T$ 的 $(2,1)$ 元素；其次，为这个特定矩阵提供一个详细的论证，说明为什么整个三对角化过程可以仅使用有理数算术来完成。\n\n给定的矩阵是：\n$$\nA \\;=\\;\n\\begin{pmatrix}\n7  & 1 & 2 & 2 \\\\\n1  & 1 & 0 & 0 \\\\\n2  & 0 & 1 & 0 \\\\\n2  & 0 & 0 & 1\n\\end{pmatrix}\n$$\n这是一个实的、对称的 $4 \\times 4$ 矩阵。对称矩阵的Hessenberg约化会产生一个三对角矩阵。该过程涉及使用Householder矩阵进行的一系列相似变换。对于一个 $n \\times n$ 矩阵，这需要 $n-2$ 步。在我们的例子中，$n=4$，所以最多需要 2 步。\n\n约化的第一步旨在在 $A$ 的第一列的 $(3,1)$ 和 $(4,1)$ 位置引入零。这是通过相似变换 $A_1 = P_1 A P_1$ 实现的。矩阵 $P_1$ 是一个形式如下的正交矩阵：\n$$\nP_1 = \\begin{pmatrix}\n1  & \\mathbf{0}^\\top \\\\\n\\mathbf{0}  & H\n\\end{pmatrix}\n$$\n其中 $H$ 是一个 $3 \\times 3$ 的Householder矩阵。选择矩阵 $H$ 作用于我们想要修改的 $A$ 的第一列的子向量上。令 $a_1$ 为 $A$ 的第一列。我们将其分块为：\n$$\na_1 = \\begin{pmatrix} a_{11} \\\\ x \\end{pmatrix} = \\begin{pmatrix} 7 \\\\ 1 \\\\ 2 \\\\ 2 \\end{pmatrix}, \\quad \\text{其中} \\quad x = \\begin{pmatrix} 1 \\\\ 2 \\\\ 2 \\end{pmatrix}.\n$$\nHouseholder矩阵 $H$ 的构造方式是，它将向量 $x$ 映射到第一个标准基向量 $e_1 = (1, 0, 0)^\\top$ 的一个倍数。即，对于某个标量 $\\alpha$，有 $Hx = \\alpha e_1$。\n\nHouseholder反射是一种正交变换，因此它保持欧几里得范数。因此，我们必须有 $\\|Hx\\|_2 = \\|x\\|_2$。这意味着 $|\\alpha| = \\|x\\|_2$。我们计算 $x$ 的范数：\n$$\n\\|x\\|_2 = \\sqrt{1^2 + 2^2 + 2^2} = \\sqrt{1 + 4 + 4} = \\sqrt{9} = 3.\n$$\n为了数值稳定性，$\\alpha$ 的符号选择为与 $x$ 的第一个分量的符号相反。这里，$x_1=1$，是正数。所以我们选择 $\\alpha = -\\text{sgn}(x_1)\\|x\\|_2 = -(+1)(3) = -3$。\n目标向量是 $Hx = \\begin{pmatrix} -3 \\\\ 0 \\\\ 0 \\end{pmatrix}$。\n\n变换后的矩阵 $A_1 = P_1 A P_1$ 的第一列由 $P_1 A (P_1 e_1)$ 给出。由于 $P_1$ 的第一列是 $e_1$，所以 $P_1 e_1 = e_1$。因此 $A_1$ 的第一列是 $P_1 a_1$。\n$$\nP_1 a_1 = \\begin{pmatrix} 1  & \\mathbf{0}^\\top \\\\ \\mathbf{0}  & H \\end{pmatrix} \\begin{pmatrix} a_{11} \\\\ x \\end{pmatrix} = \\begin{pmatrix} a_{11} \\\\ Hx \\end{pmatrix} = \\begin{pmatrix} 7 \\\\ -3 \\\\ 0 \\\\ 0 \\end{pmatrix}.\n$$\n矩阵 $A$ 是对称的，Householder矩阵 $P_1$ 也是对称的（$P_1^\\top = P_1$）和正交的（$P_1^{-1} = P_1^\\top = P_1$）。因此，变换后的矩阵 $A_1 = P_1 A P_1$ 也是对称的。这意味着 $A_1$ 的第一行必须是其第一列的转置：$(7, -3, 0, 0)$。\n所以，第一步之后，矩阵 $A_1$ 的形式为：\n$$\nA_1 = \\begin{pmatrix}\n7  & -3 & 0 & 0 \\\\\n-3 & A_1(2,2) & A_1(2,3) & A_1(2,4) \\\\\n0  & A_1(3,2) & A_1(3,3) & A_1(3,4) \\\\\n0  & A_1(4,2) & A_1(4,3) & A_1(4,4)\n\\end{pmatrix}.\n$$\n元素 $A_1(2,1)$ 是 $-3$。\n\n如果需要的话，三对角化过程的第二步将应用一个变换 $A_2 = P_2 A_1 P_2$，其中 $P_2$ 的形式为：\n$$\nP_2 = \\begin{pmatrix}\n1  & 0 & 0 & 0 \\\\\n0  & 1 & 0 & 0 \\\\\n0  & 0 & \\tilde{H} & \\\\\n0  & 0 & &\n\\end{pmatrix}.\n$$\n这个变换作用于第 3 和第 4 行及列，并保持前两行和前两列不变。具体来说，$A_2$ 的 $(2,1)$ 元素将与 $A_1$ 的 $(2,1)$ 元素相同。\n因此，最终三对角矩阵 $T$ 的 $(2,1)$ 元素仅由第一步确定。其值为 $T(2,1) = A_1(2,1) = -3$。\n\n现在，我们必须论证为什么三对角化过程可以仅使用有理数算术来完成。\n对于一个向量 $y$，其一般的Householder变换由矩阵 $P = I - 2 \\frac{vv^\\top}{v^\\top v}$ 给出，其中Householder向量为 $v = y \\pm \\|y\\|_2 e_1$。对于一个具有有理数元素的向量 $y$，要使变换矩阵 $P$ 具有有理数元素，其充分必要条件是 $\\|y\\|_2$ 是一个有理数。如果这个条件在每一步都成立，并且初始矩阵 $A$ 是有理的，那么整个过程都将在有理数域 $\\mathbb{Q}$ 内进行。\n\n初始矩阵 $A$ 具有整数元素，这些元素是有理数。\n\n对于第一步，被变换的向量是 $x = (1, 2, 2)^\\top$。它的元素是有理数。它的范数是 $\\|x\\|_2 = 3$，这是一个有理数。\n因此，Householder向量 $v = x - (-3)e_1 = (1,2,2)^\\top + (3,0,0)^\\top = (4,2,2)^\\top$ 具有有理数元素。相应的 $3 \\times 3$ 矩阵 $H = I_3 - 2\\frac{vv^\\top}{v^\\top v}$ 和完整的 $4 \\times 4$ 矩阵 $P_1$ 都具有有理数元素。因此，矩阵 $A_1 = P_1 A P_1$ 的所有元素也必须在 $\\mathbb{Q}$ 中。\n\n对于 $4 \\times 4$ 约化的第二步（也是最后一步），我们将应用一个变换来将元素 $A_1(4,2)$ 置零。此步骤作用于向量 $y = (A_1(3,2), A_1(4,2))^\\top$。我们来计算这个向量。\n根据 $A_1$ 的对称性，我们有 $A_1(3,2) = A_1(2,3)$ 和 $A_1(4,2) = A_1(2,4)$。我们需要计算 $A_1$ 的第二行（或列）的后两个元素。$A_1=P_1AP_1$。\n完整的 $3 \\times 3$ Householder矩阵 $H$ 为： $H = \\frac{1}{3}\\begin{pmatrix}-1 & -2 & -2 \\\\ -2 & 2 & -1 \\\\ -2 & -1 & 2\\end{pmatrix}$。\n$P_1$ 的第二行是 $(0, -1/3, -2/3, -2/3)$。\n$A_1$ 的第二行是 $(e_2^\\top P_1) A P_1$。\n$(e_2^\\top P_1) A = (0, -1/3, -2/3, -2/3) \\begin{pmatrix} 7 & 1 & 2 & 2 \\\\ 1 & 1 & 0 & 0 \\\\ 2 & 0 & 1 & 0 \\\\ 2 & 0 & 0 & 1 \\end{pmatrix} = (-1/3-4/3-4/3, -1/3, -2/3, -2/3) = (-3, -1/3, -2/3, -2/3)$。\n最后，$( (e_2^\\top P_1) A )P_1 = (-3, -1/3, -2/3, -2/3) \\begin{pmatrix} 1 & 0 & 0 & 0 \\\\ 0 & -1/3 & -2/3 & -2/3 \\\\ 0 & -2/3 & 2/3 & -1/3 \\\\ 0 & -2/3 & -1/3 & 2/3 \\end{pmatrix}$。\n$A_1(2,3) = (-3)(0) + (-1/3)(-2/3) + (-2/3)(2/3) + (-2/3)(-1/3) = 2/9 - 4/9 + 2/9 = 0$。\n$A_1(2,4) = (-3)(0) + (-1/3)(-2/3) + (-2/3)(-1/3) + (-2/3)(2/3) = 2/9 + 2/9 - 4/9 = 0$。\n因此，第二步的向量是 $y = (A_1(3,2), A_1(4,2))^\\top = (0, 0)^\\top$。\n\n其范数是 $\\|y\\|_2 = 0$，这是一个有理数。对于零向量的Householder变换是单位矩阵（或者在实践中，这一步被跳过）。这意味着 $A_1$ 已经是三对角矩阵。\n由于约化过程中每个阶段的向量范数都是有理数（$3$ 和 $0$），整个三对角化过程可以仅使用有理数算术来完成。\n\n最终的三对角矩阵是 $T=A_1$。其 $(2,1)$ 元素是 $-3$。",
            "answer": "$$\\boxed{-3}$$"
        },
        {
            "introduction": "海森伯格约化的主要目标是简化矩阵的特征值问题。这个练习将直接展示海森伯格结构带来的一个好处。通过构造一个特定类型的海森伯格矩阵，我们将看到该矩阵的某些性质如何让我们仅通过观察就能确定其一个特征值，从而将矩阵的形式与其谱特性（spectral properties）直接联系起来 。",
            "id": "3238609",
            "problem": "您正在研究上Hessenberg结构在迭代特征值算法中的作用，其中将一个稠密矩阵约化为上Hessenberg形式可以保持其特征值不变，同时引入一种近三角模式，从而实现高效计算。一个 $n \\times n$ 矩阵称为上Hessenberg矩阵，如果其第一副对角线下方严格位置的所有元素均为零；如果其第一副对角线上的所有元素均非零，则称该矩阵为非约化的。\n\n请明确构造一个满足以下性质的实数 $5 \\times 5$ 非约化上Hessenberg矩阵 $A$：\n- 对于所有 $i > j + 1$，都有 $A_{i,j} = 0$。\n- 对于 $i = 1, 2, 3, 4$，都有 $A_{i+1,i} \\neq 0$。\n- 每一行的元素之和等于同一个常数 $c$，其中 $c = 3$。\n\n仅使用特征值和特征向量的定义，解释为什么从您的构造中可以通过简单观察确定 $A$ 的一个特征值，并指出该特征值。请提供一个这样的矩阵 $A$ 的明确例子，并证明它满足所述性质。您的最终答案必须是那个可以通过直接观察立即确定的单个特征值。无需四舍五入。",
            "solution": "我们从核心定义开始。一个矩阵 $A \\in \\mathbb{R}^{n \\times n}$ 是上Hessenberg矩阵，如果当 $i > j + 1$ 时，$A_{i,j} = 0$。如果对所有 $i = 1, \\dots, n-1$ 都有 $A_{i+1,i} \\neq 0$，则该矩阵是非约化的。如果存在一个非零向量 $x \\in \\mathbb{R}^{n}$ 使得 $A x = \\lambda x$，则标量 $\\lambda \\in \\mathbb{R}$ 是 $A$ 的一个特征值。\n\n我们将构造一个满足所要求性质的显式 $5 \\times 5$ 矩阵 $A$。考虑\n$$\nA \\;=\\;\n\\begin{pmatrix}\n0  & 1 & 0 & 0 & 2 \\\\\n1  & 0 & 0 & 2 & 0 \\\\\n0  & 1 & 0 & 1 & 1 \\\\\n0  & 0 & 1 & 2 & 0 \\\\\n0  & 0 & 0 & 1 & 2\n\\end{pmatrix}.\n$$\n我们验证其所需的结构性质：\n- 上Hessenberg性质：第一副对角线下方严格位置的元素均为零。确实，对于所有 $i > j + 1$，矩阵 $A$ 中对应的元素均为 $0$。只有第一副对角线位置 $(2,1)$、$(3,2)$、$(4,3)$、$(5,4)$ 的元素可以非零。\n- 非约化性质：第一副对角线上的元素为 $A_{2,1} = 1$、$A_{3,2} = 1$、$A_{4,3} = 1$、$A_{5,4} = 1$，它们都非零。\n\n接下来，我们确保每一行的元素之和等于同一个常数 $c = 3$：\n- 第 1 行：$0 + 1 + 0 + 0 + 2 = 3$。\n- 第 2 行：$1 + 0 + 0 + 2 + 0 = 3$。\n- 第 3 行：$0 + 1 + 0 + 1 + 1 = 3$。\n- 第 4 行：$0 + 0 + 1 + 2 + 0 = 3$。\n- 第 5 行：$0 + 0 + 0 + 1 + 2 = 3$。\n\n令 $ \\mathbf{1} = (1, 1, 1, 1, 1)^{\\mathsf{T}}$。通过直接的矩阵-向量乘法和线性性质，$A \\mathbf{1}$ 的第 $i$ 个分量等于 $A$ 的第 $i$ 行元素之和。由于每一行的和都是 $3$，我们得到\n$$\nA \\mathbf{1} = 3 \\mathbf{1}.\n$$\n根据特征值和特征向量的定义，这表明 $\\lambda = 3$ 是 $A$ 的一个特征值，其对应的特征向量为 $\\mathbf{1}$。这个特征值可以通过简单观察确定，因为一旦我们注意到所有行的元素之和都等于公共常数 $3$，等式 $A \\mathbf{1} = 3 \\mathbf{1}$ 就立即成立。\n\n因此，从所构造的非约化上Hessenberg矩阵中可以通过观察直接读出的特征值是 $3$。",
            "answer": "$$\\boxed{3}$$"
        },
        {
            "introduction": "在数值计算中，理论上的等价并不意味着实践中的等效。这个练习将通过编程实现，对比两种用于海森伯格约化的方法：数值稳定的豪斯霍尔德方法与数值不稳定的经典格拉姆-施密特（Classical Gram-Schmidt）方法。通过在一个精心设计的矩阵上测试这两种算法，你将亲身体会到数值不稳定性的现象，并理解为何像豪斯霍尔德约化这样的稳健算法在专业软件中是必不可少的 。",
            "id": "3238560",
            "problem": "您的任务是对比两种针对实方阵的上Hessenberg约简方法：一种是基于嵌入Arnoldi过程的经典Gram-Schmidt正交化的朴素方法，另一种是基于作为双边相似变换应用的Householder反射的稳定方法。目标是构造并分析一些矩阵，对于这些矩阵，经典Gram-Schmidt方法会表现出数值不稳定性，而基于Householder的方法则保持稳健。\n\n基本核心定义：\n- 一个矩阵 $H \\in \\mathbb{R}^{n \\times n}$ 是上Hessenberg矩阵，如果对于所有 $i \\ge j + 2$ 都有 $H_{i,j} = 0$。\n- 对于一个向量序列 $\\{w_j\\}$，经典Gram-Schmidt正交化过程构造 $v_1 = w_1 / \\|w_1\\|_2$，并且对于 $j \\ge 1$，定义\n$$\nh_{i,j} = v_i^\\top w_j, \\quad \\tilde{w}_j = w_j - \\sum_{i=1}^{j} h_{i,j} v_i, \\quad v_{j+1} = \\tilde{w}_j / \\|\\tilde{w}_j\\|_2,\n$$\n当 $\\|\\tilde{w}_j\\|_2 \\ne 0$ 时成立。Arnoldi过程将此应用于 $w_j = A v_j$（其中 $A \\in \\mathbb{R}^{n \\times n}$ 是一个矩阵），生成一个标准正交基 $V_k = [v_1,\\dots,v_k]$ 和一个上Hessenberg矩阵 $H_k \\in \\mathbb{R}^{k \\times k}$，满足 $A V_k \\approx V_k H_k$。\n- Householder反射矩阵形如 $P = I - 2 u u^\\top$，其中 $u \\in \\mathbb{R}^m$ 的选择使得对于任意给定向量 $x \\in \\mathbb{R}^m$ 和某个标量 $\\alpha \\in \\mathbb{R}$，都有 $P x = \\alpha e_1$。基于Householder的Hessenberg约简在左侧和右侧应用一系列此类反射矩阵，以计算一个正交矩阵 $Q$ 和一个上Hessenberg矩阵 $H$，使得 $A = Q H Q^\\top$。\n\n您的任务：\n1. 实现一个经典的Gram-Schmidt Arnoldi例程，给定 $A \\in \\mathbb{R}^{n \\times n}$、一个起始单位向量 $v_1 \\in \\mathbb{R}^n$ 和目标维度 $k$，返回一个标准正交矩阵 $V \\in \\mathbb{R}^{n \\times m}$（其中 $m \\le k$ 取决于是否发生分解）和一个上Hessenberg矩阵 $H \\in \\mathbb{R}^{m \\times m}$，使得 $A V \\approx V H$。使用单次经典Gram-Schmidt过程，不进行任何再正交化。使用以下指标量化数值稳定性：\n   - 正交性损失度量 $o = \\max_{i \\ne j} |(V^\\top V)_{i,j}|$。\n   - Arnoldi残差比 $r_A = \\|A V - V H\\|_F / \\|A\\|_F$。\n   - 如果一个新向量的范数低于阈值 $\\tau = 10^{-14}$，则宣告过程分解（breakdown），导致 $m < k$。\n\n2. 实现一个基于Householder的完全Hessenberg约简，计算满足 $A = Q H Q^\\top$ 的 $Q \\in \\mathbb{R}^{n \\times n}$ 和 $H \\in \\mathbb{R}^{n \\times n}$。应用一系列Householder反射矩阵 $P_j = I - 2 u_j u_j^\\top$（其中 $j = 0,1,\\dots,n-3$），每个反射矩阵旨在将第 $j$ 列中第一副对角线以下的元素置零。使用以下指标量化数值上的成功：\n   - 第二副对角线以下范数 $b = \\sqrt{\\sum_{i \\ge j+2} \\sum_j H_{i,j}^2}$。\n   - 重构残差比 $r_H = \\|A - Q H Q^\\top\\|_F / \\|A\\|_F$。\n\n3. 构造并分析以下测试矩阵和起始向量组：\n   - 情况1（病态的近单位Jordan扰动）：设 $n = 25$, $\\varepsilon = 10^{-16}$，且 $J \\in \\mathbb{R}^{n \\times n}$ 是Jordan块，其中对所有 $i$ 有 $J_{i,i} = 0$，对 $i = 1,\\dots,n-1$ 有 $J_{i,i+1} = 1$，所有其他元素为 $0$。定义 $A_1 = I + \\varepsilon J$。使用的起始向量 $v_1$ 的所有元素 $(v_1)_i = 1$，并归一化为单位$2$-范数。选择此矩阵是为了使Krylov序列 $\\{A_1^j v_1\\}$ 变得近似共线，从而在经典Gram-Schmidt Arnoldi过程中引发数值不稳定性。\n   - 情况2（良态的对称三对角Toeplitz矩阵）：设 $n = 20$，且 $A_2 \\in \\mathbb{R}^{n \\times n}$ 定义为 $(A_2)_{i,i} = 2$，$(A_2)_{i,i+1} = -1$，$(A_2)_{i+1,i} = -1$（其中 $i = 1,\\dots,n-1$），所有其他元素为 $0$。使用的起始向量 $v_1$ 的元素为 $(v_1)_i = \\sin(i)$，并归一化为单位$2$-范数。\n   - 情况3（中等规模的性状良好的三对角矩阵）：设 $n = 6$ 并以与 $A_2$ 相同的方式定义 $A_3$，但大小为 $n=6$。使用的起始向量 $v_1$ 的所有元素 $(v_1)_i = 1$，并归一化为单位$2$-范数。\n\n每种情况的判定规则：\n- 如果满足以下任一条件，则判定经典Gram-Schmidt Arnoldi方法失败：$m < n$，$o > 10^{-3}$，或 $r_A > 10^{-8}$。\n- 如果同时满足 $b < 10^{-12}$ 和 $r_H < 10^{-12}$，则判定Householder方法成功。\n- 对于每种情况，程序必须输出一个布尔值，表示基于朴素Gram-Schmidt的Hessenberg约简是否因数值不稳定性而失败，而基于Householder的方法是否成功。即，如果经典Gram-Schmidt Arnoldi失败而Householder成功，则输出 $\\text{True}$，否则输出 $\\text{False}$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如，\"[result1,result2,result3]\"），其中每个结果是对应于 $A_1$, $A_2$, $A_3$ 三种情况顺序的布尔值。\n\n本问题不涉及任何物理单位、角度或百分比；所有量均为无量纲的实数和矩阵。程序必须完全自包含，无需用户输入。",
            "solution": "问题陈述已经过严格评估，并被确定为有效。它在科学上基于数值线性代数的原理，问题设定良好，具有清晰的定义和客观标准，并且内部一致。它提出了对两种Hessenberg约简基本算法的标准且重要的比较分析。\n\n任务是比较计算实方阵 $A \\in \\mathbb{R}^{n \\times n}$ 上Hessenberg分解的两种方法的数值稳定性。第一种方法是采用经典Gram-Schmidt（CGS）且不进行再正交化的Arnoldi过程。第二种方法是一系列Householder相似变换。\n\n### 方法1：经典Gram-Schmidt Arnoldi（CGS-Arnoldi）过程\n\nArnoldi过程是一种迭代方法，它为Krylov子空间 $\\mathcal{K}_k(A, v_1) = \\text{span}\\{v_1, A v_1, \\dots, A^{k-1} v_1\\}$ 构造一个标准正交基。当使用经典Gram-Schmidt过程实现时，它会生成一个标准正交向量序列 $v_1, v_2, \\dots, v_k$ 和一个上Hessenberg矩阵 $H_k \\in \\mathbb{R}^{k \\times k}$，它们满足Arnoldi关系 $A V_k = V_k H_k + f_k e_k^\\top$，其中 $V_k = [v_1, \\dots, v_k]$, $f_k$ 是残差向量，$e_k$ 是第 $k$ 个标准基向量。\n\n给定 $A \\in \\mathbb{R}^{n \\times n}$、一个起始单位向量 $v_1 \\in \\mathbb{R}^n$ 和一个目标维度 $k$，算法流程如下：\n1. 初始化一个 $n \\times k$ 矩阵 $V$ 和一个 $k \\times k$ 矩阵 $H$。将 $V$ 的第一列设置为 $v_1$。\n2. 对于 $j = 1, \\dots, k$:\n   a. 计算下一个Krylov向量，$w = A v_j$。\n   b. 将 $w$ 与先前计算的基向量 $\\{v_1, \\dots, v_j\\}$ 正交化：\n      对于 $i = 1, \\dots, j$:\n      i. 计算投影系数：$h_{i,j} = v_i^\\top w$。\n      ii. 从 $w$ 中减去投影：$w \\leftarrow w - h_{i,j} v_i$。\n   c. 如果 $j < k$:\n      i. 计算新向量的范数：$h_{j+1,j} = \\|w\\|_2$。\n      ii. 如果 $h_{j+1,j}$ 低于某个阈值 $\\tau$（例如 $10^{-14}$），则称过程发生分解（break down）。Krylov子空间是不变的，算法终止，得到维度为 $n \\times j$ 的矩阵 $V$ 和维度为 $j \\times j$ 的矩阵 $H$。\n      iii. 归一化以获得下一个基向量：$v_{j+1} = w / h_{j+1,j}$。\n\nCGS的核心数值问题出现在步骤2b中。如果向量 $A v_j$ 与之前的基向量 $\\{v_1, \\dots, v_j\\}$ 近似线性相关，那么正交化后的向量 $w$ 将是减去大的、几乎相等的量的结果。这会导致灾难性抵消和计算出的 $w$ 的巨大相对误差。因此，新计算出的向量 $v_{j+1}$ 将不与先前的向量正交，导致基 $V$ 的正交性损失。这种不稳定性通过正交性损失度量 $o = \\max_{i \\ne j} |(V^\\top V)_{i,j}|$ 来量化。Arnoldi残差比 $r_A = \\|A V - V H\\|_F / \\|A\\|_F$ 度量了分解在由 $V$ 张成的子空间上对 $A$ 的作用的近似程度。\n\n### 方法2：Householder Hessenberg约简\n\n此方法通过使用Householder反射矩阵的一系列相似变换，将一个稠密矩阵 $A$ 约简为上Hessenberg形式 $H$。目标是找到一个正交矩阵 $Q$ 使得 $A = Q H Q^\\top$。Householder反射矩阵是一个形如 $P = I - 2 u u^\\top$ 的正交矩阵，其中 $u$ 是一个单位向量。对于一个给定向量 $x$，可以选择 $u$ 使得 $P x$ 是第一个标准基向量 $e_1$ 的倍数。\n\n对于一个 $A \\in \\mathbb{R}^{n \\times n}$ 的完全约简算法如下：\n1. 初始化 $H = A$ 和 $Q = I_n$。\n2. 对于 $j = 0, 1, \\dots, n-3$:\n   a. 考虑由第 $j$ 列中第一副对角线以下的元素组成的向量 $x$：$x = H_{j+2:n, j}$。\n   b. 构造一个Householder向量 $u_j \\in \\mathbb{R}^{n-j-1}$，使得相应的反射矩阵 $P'_j = I - 2 u_j u_j^\\top$ 将 $x$ 除第一个元素外的所有元素置零。一个稳定的中间向量 $v$ 的选择是 $v = x + \\text{sign}(x_1) \\|x\\|_2 e_1$，由此得到 $u_j=v/\\|v\\|_2$。\n   c. 通过将 $P'_j$ 嵌入到一个单位矩阵中来形成完整的 $n \\times n$ 反射矩阵 $P_j$：\n      $$ P_j = \\begin{pmatrix} I_{j+1} & 0 \\\\ 0 & P'_{j} \\end{pmatrix} $$\n   d. 对矩阵应用相似变换：$H \\leftarrow P_j H P_j^\\top$。由于 $P_j$ 是自身的逆，所以 $P_j^\\top=P_j$。这是通过左乘 $H \\leftarrow P_j H$ 和右乘 $H \\leftarrow H P_j$ 来完成的。\n   e. 累积正交变换：$Q \\leftarrow Q P_j$。\n\n经过 $n-2$ 步后，得到的矩阵 $H$ 是上Hessenberg矩阵。最终的正交矩阵是 $Q = P_0 P_1 \\dots P_{n-3}$。由于每个变换 $P_j$ 都是正交的，它们的乘积 $Q$ 也是正交的。这个性质使得Householder约简是后向稳定的。计算出的 $H$ 是一个与原始矩阵 $A$ 非常接近的矩阵的精确Hessenberg形式。这种稳定性通过重构残差比 $r_H = \\|A - Q H Q^\\top\\|_F / \\|A\\|_F$ 进行评估，而 $H$ 的结构则通过第二副对角线以下范数 $b = \\sqrt{\\sum_{i \\ge j+2} \\sum_j H_{i,j}^2}$ 来检查。\n\n### 测试用例分析\n\n所提供的测试用例旨在突显这两种方法的不同稳定性特性。\n\n**情况1: $A_1 = I + \\varepsilon J$ 其中 $\\varepsilon = 10^{-16}$, $n=25$.**\n矩阵 $J$ 是一个幂零Jordan块。$J$ 的幂 $J^m$ 将非零的对角线（由1构成）进一步向右上推，对于 $m \\ge n$ 时变为零。对于一个小的 $\\varepsilon$，$A_1^m v_1 = (I + \\varepsilon J)^m v_1 \\approx (I + m \\varepsilon J) v_1$。构成Krylov序列的向量 $v_1, A_1 v_1, A_1^2 v_1, \\dots$ 将很快变得近似共线。这是CGS因灾难性抵消而失败的典型场景。我们预期会有严重的正交性损失（大的 $o$）和高的Arnoldi残差（大的 $r_A$）。相反，Householder约简通过稳定的正交变换进行操作，应不受影响，并能成功地将 $A_1$ 高精度地约简为Hessenberg形式。因此，预计CGS-Arnoldi会失败，而Householder会成功。\n\n**情况2: 对称三对角Toeplitz矩阵, $n=20$.**\n这个矩阵 $A_2$ 是一维离散拉普拉斯算子的负矩阵。它是对称且良态的。对于对称矩阵，Arnoldi过程（在精确算术中）变为Lanczos算法，产生一个对称三对角矩阵 $H$。$A_2$的特征值是良好分离的，这通常会导致一个良态的Krylov基。因此，预计CGS-Arnoldi会表现良好，保持良好的正交性。Householder方法，作为普适稳定的方法，也将成功。测试结果为`True`的条件（CGS失败且Householder成功）将不会被满足。\n\n**情况3: 对称三对角Toeplitz矩阵, $n=6$.**\n这是情况2的一个较小版本。同样的逻辑也适用：$A_3$ 是一个性状良好的对称矩阵，对于它，CGS-Arnoldi是稳定的。两种方法都将成功。测试条件将不会被满足。\n\n现在将通过实现来从计算上验证这些理论预测。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef classical_gram_schmidt_arnoldi(A, v1_start, k, tau=1e-14):\n    \"\"\"\n    Performs Hessenberg reduction using the classical Gram-Schmidt Arnoldi process.\n    \"\"\"\n    n = A.shape[0]\n    V = np.zeros((n, k), dtype=np.float64)\n    H = np.zeros((k, k), dtype=np.float64)\n    \n    # Normalize the starting vector\n    V[:, 0] = v1_start / np.linalg.norm(v1_start)\n    \n    m = k\n    for j in range(k):\n        w = A @ V[:, j]\n        \n        for i in range(j + 1):\n            H[i, j] = V[:, i].T @ w\n            w = w - H[i, j] * V[:, i]\n            \n        if j + 1 < k:\n            norm_w = np.linalg.norm(w)\n            if norm_w < tau:\n                # Breakdown\n                m = j + 1\n                break\n            H[j + 1, j] = norm_w\n            V[:, j + 1] = w / H[j + 1, j]\n\n    if m < k:\n        V = V[:, :m]\n        H = H[:m, :m]\n    \n    # Calculate stability metrics\n    # Orthogonality loss\n    ortho_matrix = V.T @ V - np.eye(m)\n    np.fill_diagonal(ortho_matrix, 0)\n    ortho_loss = np.max(np.abs(ortho_matrix)) if m > 1 else 0.0\n\n    # Arnoldi residual ratio\n    norm_A_F = np.linalg.norm(A, 'fro')\n    if norm_A_F == 0:\n        norm_A_F = 1.0 # Avoid division by zero\n    \n    residual_matrix = A @ V - V @ H\n    arnoldi_residual = np.linalg.norm(residual_matrix, 'fro') / norm_A_F\n    \n    return m, ortho_loss, arnoldi_residual\n\ndef householder_hessenberg(A):\n    \"\"\"\n    Performs full Hessenberg reduction using Householder transformations.\n    \"\"\"\n    n = A.shape[0]\n    H = A.copy()\n    Q = np.eye(n, dtype=np.float64)\n\n    for j in range(n - 2):\n        x = H[j + 1:, j].copy()\n        norm_x = np.linalg.norm(x)\n        \n        # Construct Householder vector\n        v = x.copy()\n        # Stable choice for sign\n        v[0] += np.copysign(norm_x, x[0]) if x[0] != 0 else norm_x\n        \n        norm_v = np.linalg.norm(v)\n        if norm_v < 1e-15: # No reflection needed if already zero\n            continue\n            \n        u = v / norm_v\n        u = u.reshape(-1, 1)\n\n        # Apply similarity transformation H = P H P\n        # Left multiplication: H_sub = H_sub - 2 * u * (u.T @ H_sub)\n        H_sub = H[j + 1:, j:]\n        H[j + 1:, j:] -= 2 * u @ (u.T @ H_sub)\n        \n        # Right multiplication: H_sub = H_sub - 2 * (H_sub @ u) * u.T\n        H_sub = H[:, j + 1:]\n        H[:, j + 1:] -= 2 * (H_sub @ u) @ u.T\n\n        # Accumulate Q: Q = Q P\n        Q_sub = Q[:, j + 1:]\n        Q[:, j + 1:] -= 2 * (Q_sub @ u) @ u.T\n\n    # Calculate success metrics\n    # Below-second-subdiagonal norm\n    b_norm = 0.0\n    for j in range(n - 2):\n        for i in range(j + 2, n):\n            b_norm += H[i, j]**2\n    b_norm = np.sqrt(b_norm)\n\n    # Reconstruction residual ratio\n    norm_A_F = np.linalg.norm(A, 'fro')\n    if norm_A_F == 0:\n        norm_A_F = 1.0\n    \n    reconstruction_residual = np.linalg.norm(A - Q @ H @ Q.T, 'fro') / norm_A_F\n\n    return b_norm, reconstruction_residual\n\ndef solve():\n    \"\"\"\n    Sets up test cases, runs the analyses, and prints the final result.\n    \"\"\"\n    \n    # Case 1: Ill-conditioned near-identity Jordan perturbation\n    n1 = 25\n    eps1 = 1e-16\n    A1 = np.eye(n1, dtype=np.float64) + eps1 * np.diag(np.ones(n1 - 1), 1)\n    v1_1_unnormalized = np.ones(n1, dtype=np.float64)\n    v1_1 = v1_1_unnormalized / np.linalg.norm(v1_1_unnormalized)\n\n    # Case 2: Well-conditioned symmetric tridiagonal Toeplitz\n    n2 = 20\n    diag2 = 2 * np.ones(n2)\n    off_diag2 = -1 * np.ones(n2 - 1)\n    A2 = np.diag(diag2) + np.diag(off_diag2, 1) + np.diag(off_diag2, -1)\n    v1_2_unnormalized = np.sin(np.arange(1, n2 + 1, dtype=np.float64))\n    v1_2 = v1_2_unnormalized / np.linalg.norm(v1_2_unnormalized)\n\n    # Case 3: Moderately sized well-behaved tridiagonal\n    n3 = 6\n    diag3 = 2 * np.ones(n3)\n    off_diag3 = -1 * np.ones(n3 - 1)\n    A3 = np.diag(diag3) + np.diag(off_diag3, 1) + np.diag(off_diag3, -1)\n    v1_3_unnormalized = np.ones(n3, dtype=np.float64)\n    v1_3 = v1_3_unnormalized / np.linalg.norm(v1_3_unnormalized)\n\n    test_cases = [\n        (A1, v1_1, n1),\n        (A2, v1_2, n2),\n        (A3, v1_3, n3)\n    ]\n\n    results = []\n    for A, v1, n in test_cases:\n        # Run Classical Gram-Schmidt Arnoldi\n        m, o, rA = classical_gram_schmidt_arnoldi(A, v1, k=n)\n        \n        # Check for CGS-Arnoldi failure\n        cgs_failed = (m < n) or (o > 1e-3) or (rA > 1e-8)\n\n        # Run Householder Hessenberg\n        b, rH = householder_hessenberg(A)\n\n        # Check for Householder success\n        hh_succeeded = (b < 1e-12) and (rH < 1e-12)\n\n        # Final decision for the case\n        decision = cgs_failed and hh_succeeded\n        results.append(str(decision))\n\n    # Print results in the required format\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}