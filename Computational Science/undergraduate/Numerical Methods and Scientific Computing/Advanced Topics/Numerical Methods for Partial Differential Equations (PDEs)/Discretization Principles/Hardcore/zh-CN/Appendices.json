{
    "hands_on_practices": [
        {
            "introduction": "将连续的偏微分方程（PDE）转化为可解的代数方程组，是数值方法的核心。本练习将以平流扩散方程为模型，指导你应用Crank-Nicolson方法进行离散化。通过这个实践，你将掌握如何构建一个以其优越稳定性而闻名的隐式格式，并熟悉将时间和空间导数替换为有限差分近似的基本流程。",
            "id": "2139864",
            "problem": "考虑一维平流-扩散方程，该方程模拟了诸如渠道中污染物输运等现象。该方程由下式给出：\n$$ \\frac{\\partial u}{\\partial t} + c \\frac{\\partial u}{\\partial x} = D \\frac{\\partial^2 u}{\\partial x^2} $$\n其中，$u(x,t)$ 是物质在位置 $x$ 和时间 $t$ 处的浓度，$c$ 是恒定的平流速度，$D$ 是恒定的扩散系数。\n\n我们希望构建一个有限差分格式，在空间步长为 $\\Delta x$、时间步长为 $\\Delta t$ 的均匀网格上数值求解此方程。我们将 $u(j\\Delta x, n\\Delta t)$ 的数值近似值记为 $u_j^n$。\n\n该格式将通过应用 Crank-Nicolson 方法来建立，该方法涉及在半时间步 $t_{n+1/2} = (n + 1/2)\\Delta t$ 处对有限差分进行中心化。具体的离散化规则如下：\n1.  时间导数 $\\frac{\\partial u}{\\partial t}$ 在时间 $t_{n+1/2}$ 处用中心差分近似。\n2.  扩散项 $D \\frac{\\partial^2 u}{\\partial x^2}$ 用时间层 $n$ 和 $n+1$ 处二阶空间导数的标准中心差分近似的平均值来近似。\n3.  平流项 $c \\frac{\\partial u}{\\partial x}$ 用空间中心差分来近似。然后通过平均其在时间层 $n$ 和 $n+1$ 处的值，在半时间步 $t_{n+1/2}$ 处计算此空间差分。\n\n遵循这些规则，推导出有限差分方程，并将其整理为标准的隐式三对角形式：\n$$ A u_{j-1}^{n+1} + B u_j^{n+1} + C u_{j+1}^{n+1} = E u_{j-1}^{n} + F u_j^{n} + G u_{j+1}^{n} $$\n确定系数 $A, B, C, E, F$ 和 $G$ 关于无量纲库朗数 $\\nu = \\frac{c \\Delta t}{\\Delta x}$ 和扩散数 $\\mu = \\frac{D \\Delta t}{(\\Delta x)^2}$ 的表达式。\n\n将您的最终答案表示为一个单行矩阵，其中包含按 $\\begin{pmatrix} A  B  C  E  F  G \\end{pmatrix}$ 顺序排列的六个系数。",
            "solution": "我们从平流-扩散方程开始\n$$\n\\frac{\\partial u}{\\partial t} + c \\frac{\\partial u}{\\partial x} = D \\frac{\\partial^{2} u}{\\partial x^{2}}.\n$$\n在均匀网格上，有 $u_{j}^{n} \\approx u(j\\Delta x,n\\Delta t)$，在半时间步 $t_{n+1/2}$ 处的 Crank-Nicolson 离散化使用：\n- 对时间导数使用中心时间差分，\n- 对一阶和二阶空间导数均使用时间层 $n$ 和 $n+1$ 处中心空间差分的平均值。\n\n因此，\n$$\n\\frac{u_{j}^{n+1} - u_{j}^{n}}{\\Delta t}\n+ c \\cdot \\frac{1}{2} \\left[ \\frac{u_{j+1}^{n} - u_{j-1}^{n}}{2\\Delta x} + \\frac{u_{j+1}^{n+1} - u_{j-1}^{n+1}}{2\\Delta x} \\right]\n= D \\cdot \\frac{1}{2} \\left[ \\frac{u_{j+1}^{n} - 2u_{j}^{n} + u_{j-1}^{n}}{(\\Delta x)^{2}} + \\frac{u_{j+1}^{n+1} - 2u_{j}^{n+1} + u_{j-1}^{n+1}}{(\\Delta x)^{2}} \\right].\n$$\n两边乘以 $\\Delta t$ 并引入库朗数 $\\nu = \\frac{c \\Delta t}{\\Delta x}$ 和扩散数 $\\mu = \\frac{D \\Delta t}{(\\Delta x)^{2}}$，得到\n$$\nu_{j}^{n+1} - u_{j}^{n}\n+ \\frac{\\nu}{4} \\left[ \\left(u_{j+1}^{n} - u_{j-1}^{n}\\right) + \\left(u_{j+1}^{n+1} - u_{j-1}^{n+1}\\right) \\right]\n= \\frac{\\mu}{2} \\left[ \\left(u_{j+1}^{n} - 2u_{j}^{n} + u_{j-1}^{n}\\right) + \\left(u_{j+1}^{n+1} - 2u_{j}^{n+1} + u_{j-1}^{n+1}\\right) \\right].\n$$\n将时间层 $n+1$ 的项收集到左边，时间层 $n$ 的项收集到右边：\n$$\nu_{j}^{n+1}\n+ \\frac{\\nu}{4}\\left(u_{j+1}^{n+1} - u_{j-1}^{n+1}\\right)\n- \\frac{\\mu}{2}\\left(u_{j+1}^{n+1} - 2u_{j}^{n+1} + u_{j-1}^{n+1}\\right)\n= u_{j}^{n}\n- \\frac{\\nu}{4}\\left(u_{j+1}^{n} - u_{j-1}^{n}\\right)\n+ \\frac{\\mu}{2}\\left(u_{j+1}^{n} - 2u_{j}^{n} + u_{j-1}^{n}\\right).\n$$\n展开并分别在左边和右边收集 $u_{j-1}^{n+1}$, $u_{j}^{n+1}$, $u_{j+1}^{n+1}$ 和 $u_{j-1}^{n}$, $u_{j}^{n}$, $u_{j+1}^{n}$ 的系数。这就得到了三对角形式\n$$\nA u_{j-1}^{n+1} + B u_{j}^{n+1} + C u_{j+1}^{n+1} = E u_{j-1}^{n} + F u_{j}^{n} + G u_{j+1}^{n},\n$$\n其中\n$$\nA = -\\frac{\\mu}{2} - \\frac{\\nu}{4}, \\quad\nB = 1 + \\mu, \\quad\nC = -\\frac{\\mu}{2} + \\frac{\\nu}{4}, \\quad\nE = \\frac{\\mu}{2} + \\frac{\\nu}{4}, \\quad\nF = 1 - \\mu, \\quad\nG = \\frac{\\mu}{2} - \\frac{\\nu}{4}.\n$$\n当 $c=0$ 时，这些系数正确地简化为标准的 Crank-Nicolson 扩散格式；当 $D=0$ 时，它们简化为中心梯形平流格式。",
            "answer": "$$\\boxed{\\begin{pmatrix}-\\frac{\\mu}{2}-\\frac{\\nu}{4}  1+\\mu  -\\frac{\\mu}{2}+\\frac{\\nu}{4}  \\frac{\\mu}{2}+\\frac{\\nu}{4}  1-\\mu  \\frac{\\mu}{2}-\\frac{\\nu}{4}\\end{pmatrix}}$$"
        },
        {
            "introduction": "掌握了基本的离散化技术后，我们来探讨一个更深层次的概念性问题。物理世界中的点源或集中力通常用狄拉克$\\delta$函数来数学化地描述，这给数值模拟带来了挑战。这个练习将引导你思考，在有限差分法（FDM）、有限体积法（FVM）和有限元法（FEM）这三种主流方法中，应如何正确地表示这种奇异源项，从而深刻理解它们各自的理论基础和核心思想。",
            "id": "3223758",
            "problem": "考虑在一个有界域 $\\Omega \\subset \\mathbb{R}^d$ 上带有奇异源的泊松问题：\n$$\n\\Delta u(x) = \\delta(x - x_0), \\quad x \\in \\Omega,\n$$\n边界条件为齐次狄利克雷边界条件 $u(x) = 0$ on $\\partial \\Omega$，其中 $\\delta$ 表示狄拉克$\\delta$分布，$x_0 \\in \\Omega$ 是一个点源位置。狄拉克$\\delta$分布由其在测试函数 $v \\in C_c^\\infty(\\Omega)$ 上的作用定义，\n$$\n\\int_{\\Omega} \\delta(x - x_0)\\, v(x)\\, dx = v(x_0).\n$$\n你使用以下三种方法，在间距为 $h  0$ 的均匀网格上对该问题进行离散化：\n- 有限差分法 (FDM)，基于微分算子在网格节点处的逐点相容性。\n- 有限体积法 (FVM)，基于控制体上的积分守恒和跨界面的通量平衡。\n- 有限元法 (FEM)，基于使用拉格朗日基函数 $\\{\\phi_i\\}$ 的弱（变分）形式。\n\n哪个选项正确描述了在每种方法中应如何表示狄拉克$\\delta$源项，以使离散系统与狄拉克分布的定义性质相容？\n\nA. 有限差分：在包含 $x_0$ 的网格节点 $\\boldsymbol{j}^\\ast$ 处放置一个离散点源，将右端项设置为 $f_{\\boldsymbol{j}^\\ast} = 1/h^d$，对于所有 $\\boldsymbol{j} \\neq \\boldsymbol{j}^\\ast$ 设置 $f_{\\boldsymbol{j}} = 0$，从而使得 $\\sum_{\\boldsymbol{j}} f_{\\boldsymbol{j}}\\, h^d = 1$。有限体积：在每个控制体 $V_{\\boldsymbol{j}}$ 上积分；源项的贡献为 $\\int_{V_{\\boldsymbol{j}}} \\delta(x - x_0)\\, dx$，如果 $x_0 \\in V_{\\boldsymbol{j}}$，该值等于 $1$，否则等于 $0$。有限元：在弱形式中，将载荷向量的各项组装为 $L_i = \\int_{\\Omega} \\delta(x - x_0)\\, \\phi_i(x)\\, dx = \\phi_i(x_0)$；如果 $x_0$ 与节点 $i$ 重合，则 $L_i = 1$ 且所有其他项为 $0$，否则载荷根据 $\\{\\phi_i(x_0)\\}$ 进行分布。\n\nB. 有限差分：在最近的网格节点处将源设置为 $f_{\\boldsymbol{j}^\\ast} = 1$，其他地方为 $0$，忽略 $h$ 的缩放。有限体积：将单位源均等地分布在与 $x_0$ 相邻的 $2^d$ 个控制体中，以避免局部化。有限元：用一个窄高斯函数 $\\delta_\\varepsilon$ 来近似 $\\delta$ 分布，并设置 $L_i = \\int_{\\Omega} \\delta_\\varepsilon(x - x_0)\\, \\phi_i(x)\\, dx$ 对于小的 $\\varepsilon  0$。\n\nC. 有限差分：在任意空间维度中，在最近的网格节点处用一个大的有限值 $f_{\\boldsymbol{j}^\\ast} = 1/h^2$ 来表示 $\\delta$，因为拉普拉斯算子有二阶导数。有限体积：将内部源替换为在 $\\partial \\Omega$ 上大小为 $1$ 的边界诺伊曼通量。有限元：通过在最接近 $x_0$ 的节点的刚度矩阵对角线上加 $1$ 来合并源。\n\nD. 有限差分：通过对 $\\boldsymbol{j} = 1,\\dots,N$ 设置 $f_{\\boldsymbol{j}} = 1/N$ 将源均匀地分布到所有节点上，其中 $N$ 是网格节点的总数。有限体积：忽略源，因为它在连续统中测度为零。有限元：使用 $L_i = \\nabla \\phi_i(x_0)$，因为 $\\Delta u$ 涉及梯度。\n\n选择正确的选项。",
            "solution": "该问题陈述经确认为具有科学依据、适定且客观。它提出了数值分析中的一个标准、基本的问题，即关于泊松方程奇异源项的离散化。该问题是自洽的，没有矛盾。\n\n问题的核心是在三种不同的数值方法中，如何正确地将狄拉克$\\delta$分布 $\\delta(x - x_0)$ 表示为方程 $\\Delta u = f$ 离散形式中的源项 $f$。这种表示必须与$\\delta$分布的定义性质相容，即其在积分下的作用：$\\int_{\\Omega} \\delta(x - x_0) v(x) dx = v(x_0)$。一个关键的推论是它在整个域上的积分为 $\\int_{\\Omega} \\delta(x-x_0) dx = 1$。离散源项必须以适合每种方法公式的方式反映这一性质。\n\n**1. 有限元法 (FEM)**\nFEM 基于偏微分方程的弱（或变分）形式。我们将方程乘以一个来自合适空间（此处因狄利克雷边界条件而为 $H_0^1(\\Omega)$）的测试函数 $v$，并在域 $\\Omega$ 上积分：\n$$\n\\int_{\\Omega} (\\Delta u) v \\, dx = \\int_{\\Omega} \\delta(x - x_0) v(x) \\, dx\n$$\n对左侧应用分部积分（格林第一恒等式）并利用 $v = 0$ on $\\partial \\Omega$ 的事实：\n$$\n-\\int_{\\Omega} \\nabla u \\cdot \\nabla v \\, dx = \\int_{\\Omega} \\delta(x - x_0) v(x) \\, dx\n$$\n右侧使用狄拉克$\\delta$的筛选性质进行计算：\n$$\n\\int_{\\Omega} \\delta(x - x_0) v(x) \\, dx = v(x_0)\n$$\n弱形式是：找到 $u \\in H_0^1(\\Omega)$，使得对于所有 $v \\in H_0^1(\\Omega)$，都有 $a(u,v) = L(v)$，其中 $a(u,v) = \\int_{\\Omega} \\nabla u \\cdot \\nabla v \\, dx$ 且 $L(v) = v(x_0)$。\n\n在离散公式中，解 $u_h$ 被近似为基函数的线性组合，$u_h = \\sum_j U_j \\phi_j(x)$，我们对每个基函数 $\\phi_i$ 进行测试。得到的线性系统是 $KU = F$，其中载荷向量 $F$ 的分量为 $F_i = L(\\phi_i)$。\n应用我们推导出的 $L$ 的形式，我们得到：\n$$\nF_i = \\phi_i(x_0)\n$$\n这是在源位置 $x_0$ 处计算的基函数 $\\phi_i$ 的值。如果 $x_0$ 恰好与某个网格节点 $k$ 重合，则由于拉格朗日基函数的性质（$\\phi_i(x_k) = \\delta_{ik}$），载荷向量变为 $F_i = \\delta_{ik}$。也就是说，$F_k=1$ 且所有其他分量为 $0$。如果 $x_0$ 不是节点，它位于某个单元内部，载荷会根据其相应基函数在 $x_0$ 处的值分布到该单元的节点上。这是一种自然且一致的处理点源的方式。\n\n**2. 有限体积法 (FVM)**\nFVM 的基础是确保在一组剖分域 $\\Omega$ 的控制体 $\\{V_{\\boldsymbol{j}}\\}$ 上的守恒性。控制方程在每个控制体 $V_{\\boldsymbol{j}}$ 上积分：\n$$\n\\int_{V_{\\boldsymbol{j}}} \\Delta u \\, dx = \\int_{V_{\\boldsymbol{j}}} \\delta(x - x_0) \\, dx\n$$\n右侧表示包含在控制体 $V_{\\boldsymbol{j}}$ 内的总源量。根据积分的定义，该积分的计算结果为：\n$$\n\\int_{V_{\\boldsymbol{j}}} \\delta(x - x_0) \\, dx = \\begin{cases} 1  \\text{if } x_0 \\in V_{\\boldsymbol{j}} \\\\ 0  \\text{if } x_0 \\notin V_{\\boldsymbol{j}} \\end{cases}\n$$\n（假设 $x_0$ 不位于控制体之间的边界上，这是一个测度为零的情况）。左侧使用散度定理转换为在 $\\partial V_{\\boldsymbol{j}}$ 上的边界积分，然后由数值通量近似。对于源项的关键点是，它对单元 $\\boldsymbol{j}$ 方程的贡献就是它在该单元上的积分，即为 $1$ 或 $0$。\n\n**3. 有限差分法 (FDM)**\nFDM 在离散网格节点 $x_{\\boldsymbol{j}}$ 处近似逐点微分方程 $\\Delta u(x_{\\boldsymbol{j}}) = f(x_{\\boldsymbol{j}})$。狄拉克$\\delta$不是经典函数，因此 $f(x_0)$ 是未定义的。我们必须找到一个相容的离散表示。相容性是通过确保离散源项在积分时与连续源的积分相匹配来达成的。连续源的积分为 $1$。积分的离散等价物是在所有网格节点上求和，并由每个节点的体积元加权。对于在 $d$ 维空间中间距为 $h$ 的均匀网格，体积元为 $h^d$。\n我们寻求一个离散源 $f_{\\boldsymbol{j}}$ 使得：\n$$\n\\sum_{\\boldsymbol{j}} f_{\\boldsymbol{j}} h^d \\approx \\int_{\\Omega} \\delta(x-x_0) \\, dx = 1\n$$\n为了表示集中在 $x_0$ 的源，我们将整个源强度放置在最接近（或包含）$x_0$ 的网格节点 $\\boldsymbol{j}^\\ast$ 上。这意味着对于所有 $\\boldsymbol{j} \\neq \\boldsymbol{j}^\\ast$，有 $f_{\\boldsymbol{j}} = 0$。为了满足求和条件，我们必须有：\n$$\nf_{\\boldsymbol{j}^\\ast} h^d = 1 \\quad \\implies \\quad f_{\\boldsymbol{j}^\\ast} = \\frac{1}{h^d}\n$$\n这个缩放是必不可少的。当 $h \\to 0$ 时，值 $f_{\\boldsymbol{j}^\\ast}$ 发散，模仿了$\\delta$函数的奇异性质，而总积分强度保持为常数 $1$。\n\n**选项评估**\n\n**A. 有限差分：在包含 $x_0$ 的网格节点 $\\boldsymbol{j}^\\ast$ 处放置一个离散点源，将右端项设置为 $f_{\\boldsymbol{j}^\\ast} = 1/h^d$，对于所有 $\\boldsymbol{j} \\neq \\boldsymbol{j}^\\ast$ 设置 $f_{\\boldsymbol{j}} = 0$，从而使得 $\\sum_{\\boldsymbol{j}} f_{\\boldsymbol{j}}\\, h^d = 1$。有限体积：在每个控制体 $V_{\\boldsymbol{j}}$ 上积分；源项的贡献为 $\\int_{V_{\\boldsymbol{j}}} \\delta(x - x_0)\\, dx$，如果 $x_0 \\in V_{\\boldsymbol{j}}$，该值等于 $1$，否则等于 $0$。有限元：在弱形式中，将载荷向量的各项组装为 $L_i = \\int_{\\Omega} \\delta(x - x_0)\\, \\phi_i(x)\\, dx = \\phi_i(x_0)$；如果 $x_0$ 与节点 $i$ 重合，则 $L_i = 1$ 且所有其他项为 $0$，否则载荷根据 $\\{\\phi_i(x_0)\\}$ 进行分布。**\n\n- FDM 的描述正是上面推导出的相容公式，包括关键的缩放因子 $1/h^d$。\n- FVM 的描述正确地应用了该方法的基本原理——在控制体上积分。\n- FEM 的描述是推导弱形式并对基函数进行测试的直接结果，正确地得出了 $L_i = \\phi_i(x_0)$。\n**结论：正确。**\n\n**B. 有限差分：在最近的网格节点处将源设置为 $f_{\\boldsymbol{j}^\\ast} = 1$，其他地方为 $0$，忽略 $h$ 的缩放。有限体积：将单位源均等地分布在与 $x_0$ 相邻的 $2^d$ 个控制体中，以避免局部化。有限元：用一个窄高斯函数 $\\delta_\\varepsilon$ 来近似 $\\delta$ 分布，并设置 $L_i = \\int_{\\Omega} \\delta_\\varepsilon(x - x_0)\\, \\phi_i(x)\\, dx$ 对于小的 $\\varepsilon  0$。**\n\n- FDM 的描述是不正确的，因为它缺少 $1/h^d$ 的缩放。其离散积分 $\\sum f_{\\boldsymbol{j}} h^d = h^d$ 在 $h \\to 0$ 时趋于零。\n- FVM 的描述是一个特设的程序，而不是该方法原理的直接应用。\n- FEM 的描述是一种有效的近似技术（正则化），但不是在弱公式中对$\\delta$源的直接、精确表示。\n**结论：不正确。**\n\n**C. 有限差分：在任意空间维度中，在最近的网格节点处用一个大的有限值 $f_{\\boldsymbol{j}^\\ast} = 1/h^2$ 来表示 $\\delta$，因为拉普拉斯算子有二阶导数。有限体积：将内部源替换为在 $\\partial \\Omega$ 上大小为 $1$ 的边界诺伊曼通量。有限元：通过在最接近 $x_0$ 的节点的刚度矩阵对角线上加 $1$ 来合并源。**\n\n- FDM 的缩放 $1/h^2$ 仅在 $d=2$ 时正确。正确的一般缩放是 $1/h^d$。所给出的理由是不合逻辑的推论。\n- FVM 的描述是不正确的；用边界通量替换内部源从根本上改变了问题。\n- FEM 的描述是不正确的；源项贡献于载荷向量（右端项），而不是刚度矩阵（左端项）。\n**结论：不正确。**\n\n**D. 有限差分：通过对 $\\boldsymbol{j} = 1,\\dots,N$ 设置 $f_{\\boldsymbol{j}} = 1/N$ 将源均匀地分布到所有节点上，其中 $N$ 是网格节点的总数。有限体积：忽略源，因为它在连续统中测度为零。有限元：使用 $L_i = \\nabla \\phi_i(x_0)$，因为 $\\Delta u$ 涉及梯度。**\n\n- FDM 的描述代表了均匀源分布，而不是集中的点源。\n- FVM 的描述是不正确的。狄拉克$\\delta$是一个积分不为零的测度；忽略它是错误的。\n- FEM 的描述给出了一个错误的载荷向量公式。载荷向量项是 $\\phi_i(x_0)$，而不是其梯度。\n**结论：不正确。**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "在许多科学和工程问题中，解在很小区域内会发生剧烈变化，形成所谓的“边界层”。在这种情况下，均匀网格往往效率低下，而一个精心设计的非均匀网格则能事半功倍。本练习是一个编程实践，你将为一个具有边界层的常微分方程设计并实现一个非均匀网格，通过调整网格的疏密分布来精确捕捉解的快速变化，亲身体验自适应离散化的强大威力。",
            "id": "3223740",
            "problem": "您将研究奇异摄动边值问题的非均匀网格设计，通过推导一个在非均匀网格上的稳定有限差分格式，实现该格式，并经验性地选择一个网格加密参数以最小化一个精确的误差度量。考虑常微分方程 (ODE)\n$$\n\\varepsilon\\,u''(x) + u'(x) = 0,\\quad x\\in(0,1),\n$$\n其边界条件为\n$$\nu(0)=0,\\qquad u(1)=1,\n$$\n其中 $\\varepsilon0$ 是一个给定的参数。当 $\\varepsilon$ 很小时，该问题在 $x=0$ 附近表现出边界层。\n\n您必须完成以下任务。\n\n1) 在一个严格递增的非均匀网格 $\\{x_j\\}_{j=0}^{N}$（其中 $x_0=0$，$x_N=1$）上，推导该 ODE 的一个相容且稳定的有限差分格式，需使用：\n- 对二阶导数使用一个守恒三点近似，该近似由相邻子区间上扩散通量的差分得到，以及\n- 对一阶导数使用一个迎风（后向）差分，该差分遵从对流项的方向。\n\n推导过程必须从导数作为差商极限的定义以及控制体上的积分平衡出发，并且除了严格单调性外，不得假定任何特殊的网格规律性。令 $h_{j-1/2}=x_j-x_{j-1}$ 且 $h_{j+1/2}=x_{j+1}-x_j$，对于 $j\\in\\{1,\\dots,N-1\\}$。在 $x_0$ 和 $x_N$ 处强施加边界条件。\n\n2) 设非均匀网格由一个单参数指数映射 $\\varphi_\\alpha:[0,1]\\to[0,1]$ 生成，对于 $\\alpha0$ 定义为\n$$\n\\varphi_\\alpha(t)=\\frac{e^{\\alpha t}-1}{e^{\\alpha}-1},\n$$\n对于 $\\alpha=0$ 定义为 $\\varphi_0(t)=t$。通过 $x_j=\\varphi_\\alpha\\!\\left(\\frac{j}{N}\\right)$ 定义网格节点，其中 $j\\in\\{0,1,\\dots,N\\}$。参数 $\\alpha$ 控制 $x=0$ 附近的网格加密；$\\alpha$ 越大，加密程度越强。\n\n3) 对于给定的 $(\\varepsilon,N)$ 对，定义加密参数的候选集为\n$$\n\\mathcal{A}=\\{0,2,4,6,8,10\\}.\n$$\n对于每一个 $\\alpha\\in\\mathcal{A}$，构建网格 $\\{x_j\\}$，组装并求解离散系统，并计算相对于 ODE 精确解 $u_{\\text{exact}}(x)$ 的无穷范数下的最大节点误差。精确解由 ODE 和边界条件唯一确定。\n\n设离散解为 $\\{u_j\\}_{j=0}^{N}$，定义误差为\n$$\nE(\\alpha;\\varepsilon,N)=\\max_{0\\le j\\le N}\\,\\left|u_j - u_{\\text{exact}}(x_j)\\right|.\n$$\n定义 $(\\varepsilon,N)$ 的经验最优加密参数为\n$$\n\\alpha^\\star(\\varepsilon,N)=\\arg\\min_{\\alpha\\in\\mathcal{A}} E(\\alpha;\\varepsilon,N),\n$$\n若存在多个最优值，则选择最小的 $\\alpha$。\n\n4) 实现一个程序，对以下测试套件中的每个测试用例执行上述过程：\n- 测试 $1$：$(\\varepsilon,N)=\\left(10^{-1},\\,64\\right)$。\n- 测试 $2$：$(\\varepsilon,N)=\\left(5\\cdot 10^{-2},\\,64\\right)$。\n- 测试 $3$：$(\\varepsilon,N)=\\left(10^{-2},\\,32\\right)$。\n- 测试 $4$：$(\\varepsilon,N)=\\left(10^{-3},\\,64\\right)$。\n\n5) 您的程序必须生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。该列表必须是\n$$\n[\\alpha^\\star(\\varepsilon_1,N_1),\\alpha^\\star(\\varepsilon_2,N_2),\\alpha^\\star(\\varepsilon_3,N_3),\\alpha^\\star(\\varepsilon_4,N_4)],\n$$\n按测试 1 到测试 4 的顺序排列，每个条目都是来自 $\\mathcal{A}$ 的整数。例如，格式应如 [$x$,$y$,$z$,$w$]。\n\n注意事项和约束：\n- 不涉及物理单位。\n- 不涉及角度。\n- 唯一允许使用的库是标准库和一个数值数组库，并且程序必须是自包含的，无需用户输入。\n- 对于所有 $\\alpha\\in\\mathcal{A}$ 和 $N\\in\\{32,64\\}$，网格必须是严格递增的。\n- 对于每个网格，离散线性系统应被精确求解（在浮点运算精度内），并且必须在包括端点在内的所有网格节点上计算误差。",
            "solution": "用户要求使用非均匀网格上的有限差分法求解一个奇异摄动边值问题 (BVP)。核心任务是推导数值格式，实现它，并用它为几个测试用例找到经验最优的网格加密参数。\n\n### 第 1 部分：有限差分格式的推导\n\n给定的 BVP 是：\n$$\n\\varepsilon\\,u''(x) + u'(x) = 0, \\quad x \\in (0,1)\n$$\n边界条件为 $u(0)=0$ 和 $u(1)=1$。\n\n我们要在严格递增的非均匀网格 $\\{x_j\\}_{j=0}^{N}$（其中 $x_0=0$ 且 $x_N=1$）上对此方程进行离散化。步长定义为 $h_{j-1/2} = x_j - x_{j-1}$ 和 $h_{j+1/2} = x_{j+1} - x_j$。离散化针对内部节点 $j=1, \\dots, N-1$。\n\n**二阶导数 ($u''$) 的离散化**\n\n问题要求对二阶导数使用一个守恒三点近似，该近似从扩散通量的差分推导而来。这通常通过在以 $x_j$ 为中心的控制体（例如 $[(x_{j-1}+x_j)/2, (x_j+x_{j+1})/2]$）上使用有限体积法来实现。该控制体的长度为 $\\frac{1}{2}(h_{j-1/2} + h_{j+1/2})$。项 $\\varepsilon u''$ 对应于扩散通量 $\\varepsilon u'$ 的散度。在控制体上对 $\\varepsilon u''$ 进行积分得到 $\\varepsilon[u']_{(x_{j-1}+x_j)/2}^{(x_j+x_{j+1})/2}$。用中心差分近似控制体面上的导数，得到：\n$$\nu'\\left(\\frac{x_j+x_{j+1}}{2}\\right) \\approx \\frac{u_{j+1}-u_j}{x_{j+1}-x_j} = \\frac{u_{j+1}-u_j}{h_{j+1/2}}\n$$\n$$\nu'\\left(\\frac{x_{j-1}+x_j}{2}\\right) \\approx \\frac{u_j-u_{j-1}}{x_j-x_{j-1}} = \\frac{u_j-u_{j-1}}{h_{j-1/2}}\n$$\n除以控制体长度，节点 $x_j$ 处 $u''(x_j)$ 的近似为：\n$$\nu''(x_j) \\approx \\frac{ \\frac{u_{j+1}-u_j}{h_{j+1/2}} - \\frac{u_j-u_{j-1}}{h_{j-1/2}} }{ \\frac{1}{2}(h_{j-1/2} + h_{j+1/2}) } = \\frac{2}{h_{j-1/2} + h_{j+1/2}} \\left( \\frac{u_{j+1}-u_j}{h_{j+1/2}} - \\frac{u_j-u_{j-1}}{h_{j-1/2}} \\right)\n$$\n\n**一阶导数 ($u'$) 的离散化**\n\n问题指定对一阶导数使用迎风（后向）差分。由于 $u'(x)$ 的系数为正 ($+1$)，因此“风”或输运方向是从左到右。因此，$x_j$ 处的迎风格式使用来自上游节点（即 $x_j$ 和 $x_{j-1}$）的信息。后向差分近似为：\n$$\nu'(x_j) \\approx \\frac{u_j - u_{j-1}}{x_j - x_{j-1}} = \\frac{u_j - u_{j-1}}{h_{j-1/2}}\n$$\n\n**组装离散方程**\n\n结合两个导数的近似，内部节点 $x_j$ 处的离散方程为：\n$$\n\\varepsilon \\frac{2}{h_{j-1/2} + h_{j+1/2}} \\left( \\frac{u_{j+1}-u_j}{h_{j+1/2}} - \\frac{u_j-u_{j-1}}{h_{j-1/2}} \\right) + \\frac{u_j - u_{j-1}}{h_{j-1/2}} = 0\n$$\n为构成一个线性系统，我们按未知数 $u_{j-1}$、$u_j$ 和 $u_{j+1}$ 对各项进行分组：\n$a_j u_{j-1} + b_j u_j + c_j u_{j+1} = 0$，其中：\n- $u_{j-1}$ 的系数：\n  $a_j = \\varepsilon \\frac{2}{(h_{j-1/2} + h_{j+1/2})h_{j-1/2}} - \\frac{1}{h_{j-1/2}}$\n- $u_{j+1}$ 的系数：\n  $c_j = \\varepsilon \\frac{2}{(h_{j-1/2} + h_{j+1/2})h_{j+1/2}}$\n- $u_j$ 的系数：\n  $b_j = -\\varepsilon \\frac{2}{h_{j-1/2} + h_{j+1/2}}\\left(\\frac{1}{h_{j+1/2}} + \\frac{1}{h_{j-1/2}}\\right) + \\frac{1}{h_{j-1/2}}$\n\n这些方程对 $j=1, \\dots, N-1$ 成立。通过强施加边界条件 $u_0 = u(0) = 0$ 和 $u_N = u(1) = 1$，我们可以为内部未知数 $\\mathbf{u} = [u_1, u_2, \\dots, u_{N-1}]^T$ 构建一个线性系统。\n- 对于 $j=1$：$a_1 u_0 + b_1 u_1 + c_1 u_2 = 0 \\implies b_1 u_1 + c_1 u_2 = -a_1 u_0 = 0$。\n- 对于 $j=N-1$：$a_{N-1} u_{N-2} + b_{N-1} u_{N-1} + c_{N-1} u_N = 0 \\implies a_{N-1} u_{N-2} + b_{N-1} u_{N-1} = -c_{N-1} u_N = -c_{N-1}$。\n\n这会产生一个 $(N-1) \\times (N-1)$ 的三对角线性方程组 $A\\mathbf{u}=\\mathbf{f}$，求解该方程组可以得到内部节点的值。\n\n### 第 2 部分：精确解与数值求解过程\n\n**精确解**\n\n该 ODE 是一个二阶线性常系数齐次方程。其特征方程为 $\\varepsilon r^2 + r = 0$，根为 $r_1=0$ 和 $r_2=-1/\\varepsilon$。通解为 $u(x) = C_1 + C_2 e^{-x/\\varepsilon}$。应用边界条件 $u(0)=0$ 和 $u(1)=1$ 得到唯一解：\n$$\nu_{\\text{exact}}(x) = \\frac{1 - e^{-x/\\varepsilon}}{1 - e^{-1/\\varepsilon}}\n$$\n\n**数值求解过程**\n\n对于每个测试用例 $(\\varepsilon, N)$，我们执行以下优化过程：\n1.  初始化 $\\alpha^\\star = -1$ 和 $E_{min} = \\infty$。\n2.  遍历候选集 $\\mathcal{A}=\\{0, 2, 4, 6, 8, 10\\}$ 中的每个 $\\alpha$。\n3.  对于每个 $\\alpha$：\n    a. 使用映射 $x_j=\\varphi_\\alpha\\!\\left(j/N\\right)$ 生成非均匀网格 $\\{x_j\\}_{j=0}^N$，其中对于 $\\alpha0$，$\\varphi_\\alpha(t)=\\frac{e^{\\alpha t}-1}{e^{\\alpha}-1}$，对于 $\\alpha=0$，$\\varphi_0(t)=t$。\n    b. 使用推导出的系数 $a_j, b_j, c_j$ 为未知数 $\\{u_j\\}_{j=1}^{N-1}$ 组装三对角矩阵 $A$ 和右端向量 $\\mathbf{f}$。\n    c. 求解线性系统 $A\\mathbf{u}=\\mathbf{f}$ 以找到内部节点上的数值解。\n    d. 通过包含边界值 $u_0=0$ 和 $u_N=1$ 来构建完整的数值解向量 $\\{u_j\\}_{j=0}^N$。\n    e. 在每个网格节点上计算精确解 $u_{\\text{exact}}(x_j)$。\n    f. 计算最大节点误差 $E(\\alpha) = \\max_{0\\le j\\le N} |u_j - u_{\\text{exact}}(x_j)|$。\n    g. 如果 $E(\\alpha)  E_{min}$，则更新 $E_{min} = E(\\alpha)$ 和 $\\alpha^\\star = \\alpha$。\n4.  最终的 $\\alpha^\\star$ 是给定 $(\\varepsilon, N)$ 的经验最优参数。\n\n对问题中指定的所有测试用例重复此过程。最终输出是最优 $\\alpha^\\star$ 值的列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives, implements, and tests a finite difference scheme for a singularly\n    perturbed boundary value problem to find an optimal grid clustering parameter.\n    \"\"\"\n\n    def generate_mesh(N, alpha):\n        \"\"\"Generates a non-uniform mesh using an exponential mapping.\"\"\"\n        t = np.linspace(0, 1, N + 1)\n        if alpha == 0:\n            x = t\n        else:\n            x = (np.exp(alpha * t) - 1) / (np.exp(alpha) - 1)\n        return x\n\n    def solve_bvp(eps, N, x):\n        \"\"\"\n        Assembles and solves the tridiagonal linear system for the BVP.\n        \"\"\"\n        # We need to solve for N-1 interior unknowns u_1, ..., u_{N-1}.\n        # The system size is (N-1)x(N-1).\n        \n        # Calculate step sizes h (N elements).\n        # h[k] corresponds to x_{k+1}-x_k, which is h_{k+1/2}.\n        h = np.diff(x)\n        \n        # Diagonals of the matrix A\n        main_diag = np.zeros(N - 1)\n        lower_diag = np.zeros(N - 2)\n        upper_diag = np.zeros(N - 2)\n        \n        # Right-hand side vector f\n        f = np.zeros(N - 1)\n\n        # Loop over interior nodes j = 1, ..., N-1\n        # This corresponds to rows i = 0, ..., N-2 of the matrix.\n        for j in range(1, N):\n            i = j - 1 # Matrix row index\n            \n            h_prev = h[j - 1]  # h_{j-1/2}\n            h_next = h[j]      # h_{j+1/2}\n            h_sum = h_prev + h_next\n\n            # Coefficients a_j, b_j, c_j\n            a_j = eps * 2 / (h_sum * h_prev) - 1 / h_prev\n            c_j = eps * 2 / (h_sum * h_next)\n            b_j = -eps * 2 / h_sum * (1 / h_next + 1 / h_prev) + 1 / h_prev\n\n            main_diag[i] = b_j\n            if j > 1:\n                lower_diag[i - 1] = a_j\n            if j  N - 1:\n                upper_diag[i] = c_j\n        \n        # Build the tridiagonal matrix\n        A = np.diag(main_diag) + np.diag(lower_diag, k=-1) + np.diag(upper_diag, k=1)\n        \n        # Set the right-hand side vector f\n        # Boundary condition u_N = 1 affects the last equation (j = N-1)\n        # Calculate c_{N-1}\n        h_prev_N_minus_1 = h[N - 2]\n        h_next_N_minus_1 = h[N - 1]\n        h_sum_N_minus_1 = h_prev_N_minus_1 + h_next_N_minus_1\n        c_N_minus_1 = eps * 2 / (h_sum_N_minus_1 * h_next_N_minus_1)\n        \n        f[-1] = -c_N_minus_1 * 1.0  # u_N = 1\n\n        # Solve the linear system A*u_internal = f\n        u_internal = np.linalg.solve(A, f)\n        \n        # Construct full solution including boundaries\n        u_numerical = np.zeros(N + 1)\n        u_numerical[0] = 0.0\n        u_numerical[1:N] = u_internal\n        u_numerical[N] = 1.0\n        \n        return u_numerical\n\n    def get_exact_solution(x, eps):\n        \"\"\"Computes the exact solution of the ODE.\"\"\"\n        # The denominator can underflow to 1.0 for small eps, which is correct.\n        # np.exp(-1/eps) -> 0 for eps -> 0.\n        denominator = 1.0 - np.exp(-1.0 / eps)\n        if denominator == 0:\n             # This case is not expected for eps > 0 but is a safeguard.\n             return np.ones_like(x)\n        numerator = 1.0 - np.exp(-x / eps)\n        return numerator / denominator\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (1e-1, 64),\n        (5e-2, 64),\n        (1e-2, 32),\n        (1e-3, 64),\n    ]\n\n    alpha_candidates = [0, 2, 4, 6, 8, 10]\n    \n    optimal_alphas = []\n\n    for eps, N in test_cases:\n        min_error = float('inf')\n        optimal_alpha = -1\n\n        for alpha in alpha_candidates:\n            # 1. Generate mesh\n            x_nodes = generate_mesh(N, alpha)\n            \n            # 2. Solve BVP numerically\n            u_numerical = solve_bvp(eps, N, x_nodes)\n            \n            # 3. Get exact solution\n            u_exact = get_exact_solution(x_nodes, eps)\n            \n            # 4. Compute error\n            error = np.max(np.abs(u_numerical - u_exact))\n            \n            # 5. Update optimal alpha\n            if error  min_error:\n                min_error = error\n                optimal_alpha = alpha\n        \n        optimal_alphas.append(optimal_alpha)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, optimal_alphas))}]\")\n\nsolve()\n\n```"
        }
    ]
}