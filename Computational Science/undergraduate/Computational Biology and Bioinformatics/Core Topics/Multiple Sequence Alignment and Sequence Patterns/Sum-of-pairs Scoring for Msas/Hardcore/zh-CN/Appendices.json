{
    "hands_on_practices": [
        {
            "introduction": "要真正掌握配对求和（Sum-of-Pairs, SP）得分的计算方法，最好的起点是分析最简单的一种多序列比对：所有序列都完全相同且完美对齐。这个练习将帮助你理解SP得分中的核心计数原理，即如何计算序列对的数量，并揭示总得分如何随序列数量 $k$ 的增加而变化。通过这个基础情景，你将为处理更复杂的比对打下坚实的基础。",
            "id": "2432594",
            "problem": "考虑一个包含 $k$ 个序列的多序列比对（MSA），其中多序列比对（MSA）指的是将序列排列成 $L$ 个对齐的列。设这些序列是来自字母表 $\\Sigma$ 的单个序列 $X = x_{1} x_{2} \\dots x_{L}$ 的 $k$ 个相同副本，并假设比对是无间隙的，因此这 $k$ 个相同副本是按列堆叠的。设配对评分函数为 $s : \\left(\\Sigma \\cup \\{-\\}\\right) \\times \\left(\\Sigma \\cup \\{-\\}\\right) \\to \\mathbb{R}$，其中 $-$ 表示间隙符号，并假设 $s$ 在其定义域内的所有参数都有定义。\n\nMSA 的配对总分定义为\n$$\n\\mathrm{SP} = \\sum_{1 \\le i  j \\le k} \\sum_{c=1}^{L} s\\!\\left(A_{i,c}, A_{j,c}\\right),\n$$\n其中 $A_{i,c}$ 表示比对矩阵中第 $i$ 行和第 $c$ 列的字符。\n\n对于所描述的由 $X$ 的 $k$ 个相同副本组成的无间隙 MSA，请将配对总分表示为关于 $k$、$L$、序列字符 $x_{1},\\dots,x_{L}$ 以及评分函数 $s$ 的闭式解析表达式。请提供精确的表达式；不需要数值近似或四舍五入。",
            "solution": "所述问题是有效的。它在科学上基于计算生物学的原理，特别是多序列比对的评估，并且在数学上是适定的。所有术语都有明确定义，并提供了足够的信息来推导出唯一的解析解。\n\n问题要求计算一个由 $k$ 个相同的、无间隙的序列组成的多序列比对（MSA）的配对总分（$\\mathrm{SP}$）分数。设唯一的底层序列为 $X = x_{1} x_{2} \\dots x_{L}$，其中 $L$ 是序列的长度，每个字符 $x_{c}$ 属于字母表 $\\Sigma$。该 MSA 表示为一个大小为 $k \\times L$ 的矩阵 $A$。由于所有序列都相同且无间隙比对，因此在任意给定行 $i$ 和列 $c$ 处的字符，记作 $A_{i,c}$，就是序列 $X$ 中的字符 $x_{c}$。也就是说，对于所有 $i \\in \\{1, \\dots, k\\}$ 和 $c \\in \\{1, \\dots, L\\}$，我们有：\n$$\nA_{i,c} = x_{c}\n$$\n配对总分定义为所有不同序列对的配对得分之和，再对所有比对列求和。其公式如下：\n$$\n\\mathrm{SP} = \\sum_{1 \\le i  j \\le k} \\sum_{c=1}^{L} s(A_{i,c}, A_{j,c})\n$$\n其中 $s$ 是配对评分函数。\n\n我们将 $A_{i,c}$ 的值代入此定义。由于对于任意一对行 $i$ 和 $j$，$A_{i,c} = x_{c}$ 且 $A_{j,c} = x_{c}$，因此评分项变为 $s(x_{c}, x_{c})$。\n$$\n\\mathrm{SP} = \\sum_{1 \\le i  j \\le k} \\sum_{c=1}^{L} s(x_{c}, x_{c})\n$$\n注意到项 $s(x_{c}, x_{c})$ 仅依赖于列索引 $c$，而与行索引 $i$ 和 $j$ 无关。有限和的求和顺序可以交换。因此，我们可以将表达式重写为：\n$$\n\\mathrm{SP} = \\sum_{c=1}^{L} \\sum_{1 \\le i  j \\le k} s(x_{c}, x_{c})\n$$\n对于固定的列 $c$，项 $s(x_{c}, x_{c})$ 相对于关于索引 $i$ 和 $j$ 的内层求和是一个常数。因此，我们可以将其从内层求和中提取出来：\n$$\n\\mathrm{SP} = \\sum_{c=1}^{L} \\left( s(x_{c}, x_{c}) \\sum_{1 \\le i  j \\le k} 1 \\right)\n$$\n内层求和 $\\sum_{1 \\le i  j \\le k} 1$ 计算的是从总共 $k$ 行中可以选择出的不同行对 $(i, j)$ 的数量。这是一个标准的组合问题，即从一个包含 $k$ 个元素的集合中选择 $2$ 个元素，其结果由二项式系数 $\\binom{k}{2}$ 给出。\n$$\n\\sum_{1 \\le i  j \\le k} 1 = \\binom{k}{2} = \\frac{k(k-1)}{2}\n$$\n将此结果代回 $\\mathrm{SP}$ 分数的表达式中：\n$$\n\\mathrm{SP} = \\sum_{c=1}^{L} s(x_{c}, x_{c}) \\frac{k(k-1)}{2}\n$$\n项 $\\frac{k(k-1)}{2}$ 相对于对列 $c$ 的求和是一个常数。我们可以将该项从整个求和中提取出来：\n$$\n\\mathrm{SP} = \\frac{k(k-1)}{2} \\sum_{c=1}^{L} s(x_{c}, x_{c})\n$$\n这就是由序列 $X$ 的 $k$ 个相同的、无间隙的副本组成的 MSA 的配对总分的最终闭式表达式。它按照要求，用序列数 $k$、评分函数 $s$ 和序列的字符 $x_{1}, \\dots, x_{L}$ 来表示。长度 $L$ 作为求和的上限隐式地存在于表达式中。",
            "answer": "$$\n\\boxed{\\frac{k(k-1)}{2} \\sum_{c=1}^{L} s(x_{c}, x_{c})}\n$$"
        },
        {
            "introduction": "在掌握了最简单的情景后，我们现在来探讨一个更接近真实情况的挑战：分析一个包含多种残基的单列。这个练习要求你将问题分解，通过对残基对进行分类并应用基本的组合学原理来精确计数。这是理解SP得分如何反映序列组成和保守性的关键一步。",
            "id": "2432583",
            "problem": "考虑一个由 $k$ 个同源蛋白质序列组成的多序列比对（MSA）中的单个比对列，其中 $k$ 是一个正偶数。该列恰好包含 $k/2$ 个丙氨酸（$\\mathrm{A}$）残基和 $k/2$ 个甘氨酸（$\\mathrm{G}$）残基，且不含任何空位符。一个列的配对加和（SP）得分定义为对所有无序序列对 $(i, j)$ 的得分总和，其中 $1 \\le i  j \\le k$。使用 $s_{AA}$ 代表丙氨酸-丙氨酸配对得分，$s_{GG}$ 代表甘氨酸-甘氨酸配对得分，$s_{AG}$ 代表丙氨酸-甘氨酸配对得分。请给出该列SP得分的闭式表达式。",
            "solution": "要解决这个问题，我们需要计算给定列中所有可能残基对的总分。该列包含 $k$ 个残基，其中 $k/2$ 个是丙氨酸（A），$k/2$ 个是甘氨酸（G）。我们可以将所有配对分为三种互斥的类型：丙氨酸-丙氨酸（A-A）对、甘氨酸-甘氨酸（G-G）对，以及丙氨酸-甘氨酸（A-G）对。\n\n1.  **丙氨酸-丙氨酸（A-A）配对**:\n    我们有 $k/2$ 个丙氨酸残基。从中选择任意两个丙氨酸形成一个配对，其数量由组合数公式给出：\n    $$ \\text{A-A 配对数} = \\binom{k/2}{2} = \\frac{(k/2)(k/2 - 1)}{2} = \\frac{(k/2)((k-2)/2)}{2} = \\frac{k(k-2)}{8} $$\n    每个 A-A 配对的得分为 $s_{AA}$。因此，来自 A-A 配对的总得分贡献为：\n    $$ \\text{得分}_{AA} = \\frac{k(k-2)}{8} s_{AA} $$\n\n2.  **甘氨酸-甘氨酸（G-G）配对**:\n    类似地，我们有 $k/2$ 个甘氨酸残基。从中选择任意两个甘氨酸形成一个配对的数量也是：\n    $$ \\text{G-G 配对数} = \\binom{k/2}{2} = \\frac{k(k-2)}{8} $$\n    每个 G-G 配对的得分为 $s_{GG}$。因此，来自 G-G 配对的总得分贡献为：\n    $$ \\text{得分}_{GG} = \\frac{k(k-2)}{8} s_{GG} $$\n\n3.  **丙氨酸-甘氨酸（A-G）配对**:\n    每个丙氨酸残基都可以与每个甘氨酸残基配对。由于有 $k/2$ 个丙氨酸和 $k/2$ 个甘氨酸，A-G 配对的总数为：\n    $$ \\text{A-G 配对数} = \\left(\\frac{k}{2}\\right) \\times \\left(\\frac{k}{2}\\right) = \\frac{k^2}{4} $$\n    每个 A-G 配对的得分为 $s_{AG}$。因此，来自 A-G 配对的总得分贡献为：\n    $$ \\text{得分}_{AG} = \\frac{k^2}{4} s_{AG} $$\n\n该列的总 SP 得分是这三种类型配对的得分贡献之和：\n$$ S_{col} = \\text{得分}_{AA} + \\text{得分}_{GG} + \\text{得分}_{AG} = \\frac{k(k-2)}{8} s_{AA} + \\frac{k(k-2)}{8} s_{GG} + \\frac{k^2}{4} s_{AG} $$\n我们可以将前两项合并，得到最终的闭式表达式：\n$$ S_{col} = \\frac{k(k-2)}{8} (s_{AA} + s_{GG}) + \\frac{k^2}{4} s_{AG} $$",
            "answer": "$$\n\\boxed{\\frac{k(k-2)}{8} (s_{AA} + s_{GG}) + \\frac{k^2}{4} s_{AG}}\n$$"
        },
        {
            "introduction": "最后的这个练习将理论与实践联系起来，要求你通过编程实现SP得分的计算算法。这个任务将挑战你把数学公式转化为具体的计算机程序，并在包含空位和错配的多种比对上进行测试。完成这个练习将巩固你对SP得分方法的全面理解，并让你具备将其应用于实际生物信息学问题的能力。",
            "id": "2432587",
            "problem": "给定多序列比对（MSA）的配对加和（Sum-of-Pairs, SP）得分的形式化定义。设存在 $k$ 条已比对的序列，每条序列的长度为 $L$，表示为字符串数组 $A = (A_1,\\dots,A_k)$，其中每个 $A_i$ 的长度为 $L$，其字符集由大写字母和间隙符 `\"-\"` 组成。A 的配对加和（SP）得分 $S$ 定义为\n$$\nS \\;=\\; \\sum_{c=1}^{L} \\sum_{1 \\le i  j \\le k} s\\!\\left(A_{i,c}, A_{j,c}\\right),\n$$\n其中 $A_{i,c}$ 表示序列 $i$ 在第 $c$ 列的符号，配对评分函数 $s(\\cdot,\\cdot)$ 定义如下：\n- $s(x,y)=+1$，如果 $x=y$ 且 $x \\ne '-'$\n- $s(x,y)=-1$，如果 $x \\ne y$ 且 $x \\ne '-'$ 且 $y \\ne '-'$\n- $s(x,y)=-2$，如果 $x$ 或 $y$ 中恰好有一个等于 `'-'`\n- $s(x,y)=0$，如果 $x=y='-'$\n\n对于下面测试套件中提供的每个 MSA 实例，确定两个整数：\n- 如上定义的 SP 得分 $S$。\n- 所有列中无序符号对的总数，这等于在每一列考虑的所有不同的无序索引对 $\\{i,j\\}$（其中 $1 \\le i  j \\le k$）的总和，再对所有 $L$ 列进行累加。\n\n您的程序必须为每个测试用例计算这两个整数，并生成一行输出，其中包含所有按顺序排列的结果，形式为方括号内以逗号分隔的列表。对于给定的每个测试用例，输出必须按顺序先列出 SP 得分 $S$，然后是该测试用例的无序符号对计数。因此，如果有 $n$ 个测试用例，输出行必须总共包含 $2n$ 个整数，格式如 $[r_1,r_2,\\dots,r_{2n}]$。\n\n无需读取任何输入；所有测试数据都嵌入在程序中。本问题不涉及物理单位。\n\n测试套件：\n- 测试用例 $1$（包含匹配、错配和间隙的一般情况）：$k=3$，$L=5$，\n  $$\n  \\begin{aligned}\n  A_1 = \\text{\"A-CGT\"},\\\\\n  A_2 = \\text{\"ATCG-\"},\\\\\n  A_3 = \\text{\"AT-GT\"}.\n  \\end{aligned}\n  $$\n- 测试用例 $2$（所有序列相同，无间隙）：$k=4$，$L=4$，\n  $$\n  \\begin{aligned}\n  A_1 = \\text{\"ACGT\"},\\\\\n  A_2 = \\text{\"ACGT\"},\\\\\n  A_3 = \\text{\"ACGT\"},\\\\\n  A_4 = \\text{\"ACGT\"}.\n  \\end{aligned}\n  $$\n- 测试用例 $3$（全间隙比对）：$k=3$，$L=4$，\n  $$\n  \\begin{aligned}\n  A_1 = \\text{\"----\"},\\\\\n  A_2 = \\text{\"----\"},\\\\\n  A_3 = \\text{\"----\"}.\n  \\end{aligned}\n  $$\n- 测试用例 $4$（两条序列，有匹配和错配，无间隙）：$k=2$，$L=6$，\n  $$\n  \\begin{aligned}\n  A_1 = \\text{\"ACGTAC\"},\\\\\n  A_2 = \\text{\"TCATGC\"}.\n  \\end{aligned}\n  $$\n- 测试用例 $5$（大量间隙和重复字母）：$k=5$，$L=3$，\n  $$\n  \\begin{aligned}\n  A_1 = \\text{\"A-G\"},\\\\\n  A_2 = \\text{\"--G\"},\\\\\n  A_3 = \\text{\"A--\"},\\\\\n  A_4 = \\text{\"A-G\"},\\\\\n  A_5 = \\text{\"---\"}.\n  \\end{aligned}\n  $$\n\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果（例如 $[r_1,r_2,r_3,r_4,r_5,r_6]$）。必须按照上面给出的确切顺序为每个测试用例附加配对 $(S,\\text{pair\\_count})$。",
            "solution": "问题要求在指定评分函数下，计算一个多序列比对（MSA）的配对加和（SP）得分，以及整个比对中所考虑的无序符号对的数量。根据定义，对于 $k$ 条长度为 $L$ 的序列，SP 得分为\n$$\nS \\;=\\; \\sum_{c=1}^{L} \\sum_{1 \\le i  j \\le k} s\\!\\left(A_{i,c}, A_{j,c}\\right),\n$$\n其中 $s(\\cdot,\\cdot)$ 如前所定。此定义纯粹是逐列和成对的：在每一列 $c$，考虑所有无序索引对 $\\{i,j\\}$（其中 $1 \\le i  j \\le k$），将 $s$ 应用于该列的两个符号，然后求和。\n\n在整个比对中考虑的无序符号对总数是每列的无序索引对数量在 $L$ 列上的累加。对于给定的一列，无序对的数量是二项式系数\n$$\n\\binom{k}{2} \\;=\\; \\frac{k(k-1)}{2}.\n$$\n在 $L$ 列上累加可得\n$$\nU \\;=\\; L \\cdot \\binom{k}{2} \\;=\\; L \\cdot \\frac{k(k-1)}{2}.\n$$\n这个 $U$ 也是一种直接枚举方法所执行的成对评估的确切计数，该方法访问每一列的每一个无序对。\n\n一个直接的算法遵循以下定义：\n- 对于从 $1$ 到 $L$ 的每一列 $c$，\n  - 对于每一个无序对 $(i,j)$，其中 $1 \\le i  j \\le k$，\n    - 将 $s\\!\\left(A_{i,c}, A_{j,c}\\right)$ 累加到运行总和中。\n\n这种直接枚举的时间复杂度主要由对 $L$ 列和每列 $\\binom{k}{2}$ 个无序序列对的嵌套循环决定，得出\n$$\nT(L,k) \\in \\Theta\\!\\left(L \\cdot \\binom{k}{2}\\right) \\;=\\; \\Theta\\!\\left(L \\cdot k^2\\right).\n$$\n除了输入存储之外，空间复杂度为 $O(1)$ 的辅助空间，因为只需要维护一个运行总和。\n\n现在为测试套件计算所要求的输出。\n\n测试用例 1：$k=3$，$L=5$，序列 $A_1=\\text{\"A-CGT\"}$，$A_2=\\text{\"ATCG-\"}$，$A_3=\\text{\"AT-GT\"}$。\n- 第 1 列：$(\\text{A},\\text{A},\\text{A})$ 产生三个匹配：$+1+1+1=+3$。\n- 第 2 列：$(\\text{-},\\text{T},\\text{T})$ 产生两个间隙-字母对和一个匹配：$-2-2+1=-3$。\n- 第 3 列：$(\\text{C},\\text{C},\\text{-})$ 产生一个匹配和两个间隙-字母对：$+1-2-2=-3$。\n- 第 4 列：$(\\text{G},\\text{G},\\text{G})$ 产生三个匹配：$+3$。\n- 第 5 列：$(\\text{T},\\text{-},\\text{T})$ 产生一个匹配和两个间隙-字母对：$+1-2-2=-3$。\n总分 $S = +3-3-3+3-3 = -3$。无序对计数 $U = L \\cdot \\binom{k}{2} = 5 \\cdot 3 = 15$。\n\n测试用例 2：$k=4$，$L=4$，所有序列相同且无间隙。每列有 $\\binom{4}{2}=6$ 个相同字母对，每对得分 $+1$。因此 $S = 4 \\cdot 6 \\cdot (+1) = 24$。无序对计数 $U = 4 \\cdot 6 = 24$。\n\n测试用例 3：$k=3$，$L=4$，每一列的所有符号都是间隙。每一对都是间隙-间隙，得分为 $0$。因此 $S = 0$。无序对计数 $U = 4 \\cdot \\binom{3}{2} = 4 \\cdot 3 = 12$。\n\n测试用例 4：$k=2$，$L=6$，序列 $A_1=\\text{\"ACGTAC\"}$，$A_2=\\text{\"TCATGC\"}$。每列恰好有一个无序对。\n- 逐列配对：$(\\text{A},\\text{T})=-1$, $(\\text{C},\\text{C})=+1$, $(\\text{G},\\text{A})=-1$, $(\\text{T},\\text{T})=+1$, $(\\text{A},\\text{G})=-1$, $(\\text{C},\\text{C})=+1$。\n总和 $S = -1+1-1+1-1+1 = 0$。无序对计数 $U = 6 \\cdot \\binom{2}{2} = 6 \\cdot 1 = 6$。\n\n测试用例 5：$k=5$，$L=3$，序列 $A_1=\\text{\"A-G\"}$，$A_2=\\text{\"--G\"}$，$A_3=\\text{\"A--\"}$，$A_4=\\text{\"A-G\"}$，$A_5=\\text{\"---\"}$。\n- 第 1 列：符号 $(\\text{A},\\text{-},\\text{A},\\text{A},\\text{-})$ 有三个字母 $\\text{A}$ 和两个间隙。字母-字母对贡献 $\\binom{3}{2} \\times (+1) = +3$，字母-间隙对贡献 $3 \\cdot 2 \\cdot (-2) = -12$，间隙-间隙对贡献 $\\binom{2}{2} \\times 0 = 0$。列总和为 $3 - 12 + 0 = -9$。\n- 第 2 列：全为间隙，总和为 $0$。\n- 第 3 列：符号 $(\\text{G},\\text{G},\\text{-},\\text{G},\\text{-})$ 有三个字母 $\\text{G}$ 和两个间隙，与第 1 列组成相同，总和为 $-9$。\n总分 $S = -9 + 0 - 9 = -18$。无序对计数 $U = 3 \\cdot \\binom{5}{2} = 3 \\cdot 10 = 30$。\n\n因此，所要求的单行输出，按顺序列出每个测试用例的 $(S,U)$，是\n[-3,15,24,24,0,12,0,6,-18,30].\n此程序可以通过直接应用定义来计算每个 $S$，并通过计算每列的无序对来计算每个 $U$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef sp_pair_score(x: str, y: str) - int:\n    \"\"\"\n    Scoring function s(x,y):\n    - +1 if x == y and x != '-'\n    - -1 if x != y and x != '-' and y != '-'\n    - -2 if exactly one of x or y is '-'\n    -  0 if x == y == '-'\n    \"\"\"\n    if x == '-' and y == '-':\n        return 0\n    if x == '-' or y == '-':\n        return -2\n    if x == y:\n        return +1\n    return -1\n\ndef sp_score(msa):\n    \"\"\"\n    Compute Sum-of-Pairs (SP) score for an MSA given as a list of equal-length strings.\n    \"\"\"\n    k = len(msa)\n    if k == 0:\n        return 0\n    L = len(msa[0])\n    # Sanity: ensure all sequences have the same length\n    for s in msa:\n        if len(s) != L:\n            raise ValueError(\"All sequences must have equal length.\")\n    total = 0\n    # For each column, sum over all unordered pairs of sequences\n    for c in range(L):\n        # collect column symbols\n        col = [msa[i][c] for i in range(k)]\n        # sum over unordered pairs\n        for i in range(k):\n            xi = col[i]\n            for j in range(i + 1, k):\n                total += sp_pair_score(xi, col[j])\n    return total\n\ndef unordered_pair_count(k: int, L: int) - int:\n    \"\"\"\n    Total number of unordered index pairs per column aggregated over all columns: L * C(k,2)\n    \"\"\"\n    return L * (k * (k - 1) // 2)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each test case is a tuple: (msa_list, k, L)\n    test_cases = [\n        ([\"A-CGT\", \"ATCG-\", \"AT-GT\"], 3, 5),  # Test case 1\n        ([\"ACGT\", \"ACGT\", \"ACGT\", \"ACGT\"], 4, 4),  # Test case 2\n        ([\"----\", \"----\", \"----\"], 3, 4),  # Test case 3\n        ([\"ACGTAC\", \"TCATGC\"], 2, 6),  # Test case 4\n        ([\"A-G\", \"--G\", \"A--\", \"A-G\", \"---\"], 5, 3),  # Test case 5\n    ]\n\n    results = []\n    for msa, k, L in test_cases:\n        # Compute SP score\n        s = sp_score(msa)\n        # Compute unordered pair count\n        u = unordered_pair_count(k, L)\n        results.append(s)\n        results.append(u)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}