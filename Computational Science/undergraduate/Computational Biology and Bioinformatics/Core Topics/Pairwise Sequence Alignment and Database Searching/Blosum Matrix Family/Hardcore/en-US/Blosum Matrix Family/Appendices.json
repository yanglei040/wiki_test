{
    "hands_on_practices": [
        {
            "introduction": "The heart of any BLOSUM matrix is the log-odds score for each amino acid pair. This exercise provides a hands-on opportunity to calculate such a score from the ground up, using raw observational data. By working through a hypothetical scenario involving a new synthetic amino acid, you will apply the core formulas to derive joint probabilities and marginal frequencies, ultimately computing a final substitution score .",
            "id": "2376348",
            "problem": "A synthetic amino acid, denoted $Z$, is introduced into protein sequences. You are given a set of aligned sequence blocks clustered at the $62\\%$ identity threshold used for constructing the BLOcks SUbstitution Matrix (BLOSUM) family, and you will extend the BLOSUM62-style scoring to include $Z$. Let unordered aligned-pair counts be denoted $c_{ij}$ for residues $i$ and $j$, with total unordered pairs $N = \\sum_{i \\le j} c_{ij}$. For $Z$, the only observed unordered counts involving $Z$ in the dataset are:\n- $c_{ZZ} = 10$,\n- $c_{ZA} = 8$,\n- $c_{ZG} = 6$,\n- $c_{ZS} = 4$,\n- $c_{ZP} = 2$,\n- $c_{ZX} = 0$ for all other canonical amino acids $X \\in \\{ \\text{C}, \\text{D}, \\text{E}, \\text{F}, \\text{H}, \\text{I}, \\text{K}, \\text{L}, \\text{M}, \\text{N}, \\text{Q}, \\text{R}, \\text{T}, \\text{V}, \\text{W}, \\text{Y} \\}$.\nAll unordered aligned-pair counts not involving $Z$ sum to $50$, i.e., $\\sum_{i \\le j,\\, i,j \\neq Z} c_{ij} = 50$.\n\nDefine the empirical joint probabilities $p_{ij} = c_{ij} / N$ for unordered pairs and the marginal residue frequencies\n$$\nq_i \\;=\\; p_{ii} \\;+\\; \\sum_{j \\neq i} \\frac{p_{ij}}{2} \\, ,\n$$\nwhich represent the probability that a randomly chosen residue in an aligned column is $i$. In the BLOSUM framework, the substitution score is the scaled base-$2$ log-odds\n$$\ns_{ij} \\;=\\; \\beta \\,\\log_{2}\\!\\left(\\frac{p_{ij}}{q_i\\,q_j}\\right),\n$$\nwith scaling factor $\\beta = 2$ for BLOSUM62-style integer units.\n\nUsing only the data above and these definitions, compute the exact BLOSUM62-style integer score for the self-substitution $s_{ZZ}$. Report a single number. Do not round; the value in this dataset is an exact integer.",
            "solution": "The problem statement is scientifically grounded, well-posed, objective, and contains sufficient information for a unique solution. The given definitions and data are consistent with the standard methodology for constructing BLOSUM matrices. We proceed with the calculation.\n\nThe objective is to compute the self-substitution score for the synthetic amino acid $Z$, denoted as $s_{ZZ}$. The formula provided is:\n$$\ns_{ij} = \\beta \\log_{2}\\left(\\frac{p_{ij}}{q_i q_j}\\right)\n$$\nFor the self-substitution of $Z$, this becomes:\n$$\ns_{ZZ} = \\beta \\log_{2}\\left(\\frac{p_{ZZ}}{q_Z^2}\\right)\n$$\nWe are given the scaling factor $\\beta = 2$. To compute $s_{ZZ}$, we must first determine the values of the total number of unordered aligned-pairs $N$, the joint probability $p_{ZZ}$, and the marginal frequency $q_Z$.\n\nFirst, we calculate the total number of unordered aligned-pairs, $N$. This is the sum of all observed counts $c_{ij}$. The problem provides counts involving the amino acid $Z$ and the sum of all counts not involving $Z$.\n$$\nN = \\sum_{i \\le j} c_{ij} = \\left(\\sum_{i \\le j, \\, i,j \\neq Z} c_{ij}\\right) + \\sum_{j} c_{Zj}\n$$\nThe first term is given as $50$. The second term is the sum of all counts where at least one residue is $Z$. These consist of pairs of $Z$ with itself ($c_{ZZ}$) and pairs of $Z$ with other amino acids ($c_{Zj}$ for $j \\neq Z$).\n$$\n\\sum_{j} c_{Zj} = c_{ZZ} + c_{ZA} + c_{ZG} + c_{ZS} + c_{ZP} + \\sum_{X} c_{ZX}\n$$\nwhere $X$ represents all other canonical amino acids for which the count $c_{ZX}$ is zero. Substituting the given values:\n$$\n\\sum_{j} c_{Zj} = 10 + 8 + 6 + 4 + 2 + 0 = 30\n$$\nThus, the total number of pairs is:\n$$\nN = 50 + 30 = 80\n$$\n\nNext, we calculate the empirical joint probability $p_{ZZ}$. This is the ratio of the count of $Z-Z$ pairs to the total number of pairs.\n$$\np_{ZZ} = \\frac{c_{ZZ}}{N} = \\frac{10}{80} = \\frac{1}{8}\n$$\n\nNow, we compute the marginal frequency of the residue $Z$, denoted $q_Z$. The provided formula is:\n$$\nq_Z = p_{ZZ} + \\sum_{j \\neq Z} \\frac{p_{Zj}}{2}\n$$\nWe need to calculate the probabilities $p_{Zj} = c_{Zj}/N$ for all $j \\neq Z$. The non-zero counts are for $j \\in \\{ A, G, S, P \\}$. The sum of these probabilities is:\n$$\n\\sum_{j \\neq Z} p_{Zj} = \\frac{c_{ZA}}{N} + \\frac{c_{ZG}}{N} + \\frac{c_{ZS}}{N} + \\frac{c_{ZP}}{N} = \\frac{8}{80} + \\frac{6}{80} + \\frac{4}{80} + \\frac{2}{80} = \\frac{8+6+4+2}{80} = \\frac{20}{80} = \\frac{1}{4}\n$$\nSubstituting this into the formula for $q_Z$:\n$$\nq_Z = p_{ZZ} + \\frac{1}{2} \\left(\\sum_{j \\neq Z} p_{Zj}\\right) = \\frac{1}{8} + \\frac{1}{2}\\left(\\frac{1}{4}\\right) = \\frac{1}{8} + \\frac{1}{8} = \\frac{2}{8} = \\frac{1}{4}\n$$\n\nFinally, we have all the components to calculate the substitution score $s_{ZZ}$.\n$$\ns_{ZZ} = \\beta \\log_{2}\\left(\\frac{p_{ZZ}}{q_Z^2}\\right) = 2 \\log_{2}\\left(\\frac{1/8}{(1/4)^2}\\right)\n$$\nWe evaluate the argument of the logarithm:\n$$\n\\frac{p_{ZZ}}{q_Z^2} = \\frac{1/8}{1/16} = \\frac{1}{8} \\times \\frac{16}{1} = \\frac{16}{8} = 2\n$$\nSubstituting this result back into the expression for $s_{ZZ}$:\n$$\ns_{ZZ} = 2 \\log_{2}(2)\n$$\nSince $\\log_{2}(2) = 1$, the final score is:\n$$\ns_{ZZ} = 2 \\times 1 = 2\n$$\nThe resulting score is an integer, as specified in the problem statement.",
            "answer": "$$\\boxed{2}$$"
        },
        {
            "introduction": "Building a full substitution matrix is a complex process that combines statistics with computational analysis of conserved protein blocks. This computational project challenges you to replicate the original methodology of Henikoff & Henikoff on a miniature scale, constructing a custom BLOSUM matrix from a given set of alignments. You will implement key steps including sequence clustering and weighting, providing deep insight into how these matrices are tailored for different evolutionary distances .",
            "id": "2376363",
            "problem": "You are given a small set of aligned amino acid sequence blocks and asked to construct a miniature BLOcks SUbstitution Matrix (BLOSUM) at a specified clustering identity threshold, and then quantitatively compare the resulting substitution score matrix to the standard BLOSUM62 integer score matrix. The aligned blocks contain no gaps, and all symbols are the standard uppercase one-letter amino acid codes.\n\nData: The aligned blocks are as follows.\n\n- Block $\\#1$ (length $8$):\n    - $ACDEFGHI$\n    - $ACDFYGHV$\n    - $SCDEYGHV$\n    - $ACDEFGHV$\n\n- Block $\\#2$ (length $9$):\n    - $KLMNPQRST$\n    - $KLMDPQART$\n    - $RLMNPQKST$\n    - $KLVNPQRST$\n\n- Block $\\#3$ (length $6$):\n    - $GAWIVM$\n    - $GAWIIM$\n    - $GPWIVL$\n    - $GAWLVL$\n\nDefinitions to use:\n\n1. For each block, define pairwise sequence identity between two sequences as the fraction of aligned positions (over the full block length) with identical residues. For two sequences $x$ and $y$ of the same length $L$, this is\n   $$\\mathrm{Id}(x,y) = \\frac{1}{L}\\sum_{\\ell=1}^{L} \\mathbf{1}\\{x_\\ell = y_\\ell\\}.$$\n\n2. For a given identity threshold $t \\in [0,1]$, construct an undirected graph over the sequences within each block where an edge is placed between two sequences if $\\mathrm{Id}(x,y) \\ge t$. The connected components of this graph are clusters. If a cluster has size $\\lvert C \\rvert$, assign each sequence in that cluster a weight $w = 1/\\lvert C \\rvert$. Only sequence pairs drawn from different clusters contribute to subsequent counts.\n\n3. Consider all blocks. For each block, for every ordered pair of distinct sequences $(i,j)$ whose clusters are different, and for every column position $\\ell$ in that block, let $a$ be the residue at position $\\ell$ in sequence $i$ and $b$ the residue at position $\\ell$ in sequence $j$. Accumulate an ordered pair count\n   $$\\mathrm{count}(a,b) \\leftarrow \\mathrm{count}(a,b) + w_i \\cdot w_j,$$\n   where $w_i$ and $w_j$ are the cluster-derived weights of sequences $i$ and $j$, respectively. Let $T = \\sum_{a}\\sum_{b} \\mathrm{count}(a,b)$ denote the total ordered-pair count.\n\n4. Define the empirical ordered-pair probability matrix $P$ by\n   $$p_{ab} = \\frac{\\mathrm{count}(a,b)}{T}.$$\n   Define the background residue probabilities $q_a$ by\n   $$q_a = \\sum_{b} p_{ab}.$$\n\n5. For each amino acid pair $(a,b)$ with $p_{ab} > 0$, define the log-odds substitution score in half-bit units by\n   $$S_{ab} = \\mathrm{Round}\\left(\\lambda \\log_2 \\frac{p_{ab}}{q_a q_b}\\right),$$\n   where $\\lambda = 2$, $\\log_2$ is the base-$2$ logarithm, and $\\mathrm{Round}$ maps a real number $x$ to the nearest integer with ties at $\\pm 0.5$ rounded away from $0$. The resulting matrix $S$ is symmetric because ordered pairs are counted for both directions.\n\n6. For comparison, use the standard BLOSUM62 integer score matrix $S^{62}$ defined over the $20$ standard amino acids. For any analysis that requires comparing $S$ to $S^{62}$, only include those amino acid pairs $(a,b)$ for which $p_{ab} > 0$ as defined above.\n\nTasks:\n\n- For each specified threshold $t$, compute the miniature BLOSUM matrix $S$ using the definitions above.\n- Quantitatively compare $S$ to the standard BLOSUM62 matrix $S^{62}$ by computing two quantities over the set of comparable pairs $(a,b)$ with $p_{ab} > 0$:\n  1. The Pearson correlation coefficient between the flattened upper-triangular (including diagonal) entries of $S$ and the corresponding entries of $S^{62}$, expressed as a real number. If fewer than $2$ comparable pairs exist, define this correlation to be $0$.\n  2. The mean absolute difference, that is\n     $$\\frac{1}{K} \\sum_{(a,b)} \\left\\lvert S_{ab} - S^{62}_{ab} \\right\\rvert,$$\n     where the sum is over the $K$ comparable pairs in the upper triangle (including diagonal).\n\nTest suite and required output:\n\n- Use the following identity thresholds as test cases: $t \\in \\{0.4, 0.6, 1.0\\}$.\n- For each threshold $t$, compute and report the two quantities in the order specified above.\n- Final output format: Your program should produce a single line containing a list of three elements, one per threshold, where each element is itself a two-element list holding the correlation and the mean absolute difference for that threshold. For example,\n  $$\\texttt{[[corr\\_0.4,mad\\_0.4],[corr\\_0.6,mad\\_0.6],[corr\\_1.0,mad\\_1.0]]}$$\n  where each placeholder is replaced by the numeric result as a decimal. No units are involved, and no angles are used. All numeric outputs must be printed as decimal numbers.",
            "solution": "The problem presented is a well-posed exercise in computational biology, requiring the implementation of the foundational principles behind the construction of BLOCKS SUbstitution Matrices (BLOSUM). The problem is scientifically grounded, free of ambiguity, and contains all necessary data and definitions for a unique, verifiable solution. We shall proceed with the derivation.\n\nThe core task is to compute a custom substitution matrix, which we will denote $S$, from a small set of aligned protein sequence blocks for three different identity thresholds $t \\in \\{0.4, 0.6, 1.0\\}$. Subsequently, this computed matrix $S$ is to be compared with the standard $S^{62}$ matrix. The entire procedure is algorithmic and can be decomposed into the following sequential steps, which are executed for each value of the threshold $t$.\n\nFirst, for each of the three provided sequence blocks, we perform a clustering of the sequences based on pairwise identity. The identity between two sequences $x$ and $y$ of length $L$ is defined as the fraction of positions at which the residues are identical:\n$$\n\\mathrm{Id}(x,y) = \\frac{1}{L}\\sum_{\\ell=1}^{L} \\mathbf{1}\\{x_\\ell = y_\\ell\\}\n$$\nwhere $\\mathbf{1}\\{\\cdot\\}$ is the indicator function. Within each block, we can imagine an undirected graph where the sequences are vertices and an edge connects any two vertices $x$ and $y$ if and only if $\\mathrm{Id}(x,y) \\ge t$. The connected components of this graph form the clusters. All sequences belonging to a cluster $C$ of size $\\lvert C \\rvert$ are assigned a weight $w = 1/\\lvert C \\rvert$. This weighting scheme is designed to down-weight contributions from highly similar sequences, thereby reducing redundancy in the dataset.\n\nSecond, we calculate the frequency of observed amino acid substitutions. This is done by aggregating weighted pair counts over all blocks. We initialize a $20 \\times 20$ matrix of counts, $\\mathrm{count}(a,b)$, for all possible amino acid pairs $(a,b)$. For each block, we consider every possible ordered pair of distinct sequences, $(i, j)$, such that sequence $i$ and sequence $j$ belong to different clusters. For each such pair of sequences, we iterate through all alignment positions $\\ell$. If the residue at position $\\ell$ in sequence $i$ is $a$ and in sequence $j$ is $b$, we increment the count for the ordered pair $(a,b)$ by the product of the sequence weights, $w_i \\cdot w_j$:\n$$\n\\mathrm{count}(a,b) \\leftarrow \\mathrm{count}(a,b) + w_i \\cdot w_j\n$$\nBecause we consider all ordered pairs $(i,j)$, the contribution from a pair of residues $(a,b)$ at a specific position from sequences $i$ and $j$ is balanced by the contribution to $(b,a)$ from the ordered pair $(j,i)$. Consequently, the final count matrix is symmetric, i.e., $\\mathrm{count}(a,b) = \\mathrm{count}(b,a)$. The total weighted count is $T = \\sum_{a,b} \\mathrm{count}(a,b)$.\n\nThird, we derive the substitution scores. From the count matrix, we compute the empirical probability of observing the pair $(a,b)$ as $p_{ab} = \\mathrm{count}(a,b) / T$. The background probability, or marginal frequency, of a single amino acid $a$ is then calculated as $q_a = \\sum_{b} p_{ab}$. The substitution score $S_{ab}$ is the log-odds ratio of the observed pair probability to the expected probability under a random model where residues occur independently with frequencies $q_a$ and $q_b$. The formula, specified in half-bit units (by setting the scaling factor $\\lambda=2$), is:\n$$\nS_{ab} = \\mathrm{Round}\\left(2 \\log_2 \\frac{p_{ab}}{q_a q_b}\\right)\n$$\nThis score is computed for all pairs $(a,b)$ for which $p_{ab} > 0$. The $\\mathrm{Round}$ function maps a real number to the nearest integer, with ties at $\\pm 0.5$ rounded away from zero.\n\nFinally, the resulting miniature BLOSUM matrix $S$ is quantitatively compared to the standard $S^{62}$ matrix. The comparison is restricted to the set of amino acid pairs $(a,b)$ for which a score was computed, i.e., where $p_{ab} > 0$. We consider the upper-triangular entries (including the diagonal) of both matrices for this set of pairs. Two metrics are calculated:\n1. The Pearson correlation coefficient, $r$, between the flattened vectors of scores from $S$ and $S^{62}$. This measures the linear relationship between the two sets of scores.\n2. The Mean Absolute Difference (MAD), which measures the average magnitude of the difference between scores:\n$$\n\\mathrm{MAD} = \\frac{1}{K} \\sum_{(a,b)} \\left\\lvert S_{ab} - S^{62}_{ab} \\right\\rvert\n$$\nwhere the sum is over the $K$ comparable pairs in the upper triangle.\n\nThis procedure, from clustering to final comparison, is repeated for each of the specified thresholds, and the resulting pairs of metrics $(r, \\mathrm{MAD})$ are reported. The implementation utilizes numerical libraries for efficient graph analysis and matrix operations. The standard $S^{62}$ matrix is incorporated as a constant for the comparison.",
            "answer": "```python\nimport numpy as np\nfrom scipy.sparse.csgraph import connected_components\n\ndef solve():\n    \"\"\"\n    Solves the problem of constructing a miniature BLOSUM matrix and comparing it to BLOSUM62.\n    \"\"\"\n    # Provided data and problem parameters\n    blocks = [\n        [\"ACDEFGHI\", \"ACDFYGHV\", \"SCDEYGHV\", \"ACDEFGHV\"],\n        [\"KLMNPQRST\", \"KLMDPQART\", \"RLMNPQKST\", \"KLVNPQRST\"],\n        [\"GAWIVM\", \"GAWIIM\", \"GPWIVL\", \"GAWLVL\"],\n    ]\n    thresholds = [0.4, 0.6, 1.0]\n\n    # Amino acid order for matrix indexing\n    AA_ORDER = 'ACDEFGHIKLMNPQRSTVWY'\n    AA_MAP = {aa: i for i, aa in enumerate(AA_ORDER)}\n    \n    # BLOSUM62 matrix with rows/columns ordered according to AA_ORDER.\n    # Original source: NCBI, standard order 'ARNDCQEGHILKMFPSTWYV'.\n    # This matrix has been reordered to match AA_ORDER.\n    BLOSUM62 = np.array([\n        [ 4,  0, -2, -1, -2,  0, -2, -1, -1, -1, -1, -2, -1, -1, -1,  1,  0,  0, -3, -2], # A\n        [ 0,  9, -3, -4, -2, -3, -3, -1, -3, -1, -1, -3, -3, -3, -3, -1, -1, -1, -2, -2], # C\n        [-2, -3,  6,  2, -3, -1, -1, -3,  1, -4, -3,  1, -1,  0, -2,  0, -1, -3, -4, -3], # D\n        [-1, -4,  2,  5, -3, -2,  0, -3,  1, -3, -2,  0, -1,  2,  0,  0, -1, -2, -3, -2], # E\n        [-2, -2, -3, -3,  6, -3, -1,  0, -3,  0,  0, -3, -4, -3, -3, -2, -2, -1,  1,  3], # F\n        [ 0, -3, -1, -2, -3,  6, -2, -4, -2, -4, -3,  0, -2, -2, -2,  0, -2, -3, -2, -3], # G\n        [-2, -3, -1,  0, -1, -2,  8, -3,  0, -3, -2,  1, -2,  0,  0, -1, -2, -3, -2,  2], # H\n        [-1, -1, -3, -3,  0, -4, -3,  4, -3,  2,  1, -3, -3, -3, -3, -2, -1,  3, -3, -1], # I\n        [-1, -3,  1,  1, -3, -2,  0, -3,  5, -2, -1,  0, -1,  1,  2,  0, -1, -2, -3, -2], # K\n        [-1, -1, -4, -3,  0, -4, -3,  2, -2,  4,  2, -3, -3, -2, -2, -2, -1,  1, -2, -1], # L\n        [-1, -1, -3, -2,  0, -3, -2,  1, -1,  2,  5, -2, -2,  0, -1, -1, -1,  1, -1, -1], # M\n        [-2, -3,  1,  0, -3,  0,  1, -3,  0, -3, -2,  6, -2,  0,  0,  1,  0, -3, -4, -2], # N\n        [-1, -3, -1, -1, -4, -2, -2, -3, -1, -3, -2, -2,  7, -1, -2, -1, -1, -2, -4, -3], # P\n        [-1, -3,  0,  2, -3, -2,  0, -3,  1, -2,  0,  0, -1,  5,  1,  0, -1, -2, -2, -1], # Q\n        [-1, -3, -2,  0, -3, -2,  0, -3,  2, -2, -1,  0, -2,  1,  5, -1, -1, -3, -3, -2], # R\n        [ 1, -1,  0,  0, -2,  0, -1, -2,  0, -2, -1,  1, -1,  0, -1,  4,  1, -2, -3, -2], # S\n        [ 0, -1, -1, -1, -2, -2, -2, -1, -1, -1, -1,  0, -1, -1, -1,  1,  5,  0, -2, -2], # T\n        [ 0, -1, -3, -2, -1, -3, -3,  3, -2,  1,  1, -3, -2, -2, -3, -2,  0,  4, -3, -1], # V\n        [-3, -2, -4, -3,  1, -2, -2, -3, -3, -2, -1, -4, -4, -2, -3, -3, -2, -3, 11,  2], # W\n        [-2, -2, -3, -2,  3, -3,  2, -1, -2, -1, -1, -2, -3, -1, -2, -2, -2, -1,  2,  7]  # Y\n    ])\n\n    results = []\n    \n    def custom_round(x):\n        return np.sign(x) * np.floor(np.abs(x) + 0.5)\n\n    for t in thresholds:\n        count_matrix = np.zeros((20, 20), dtype=np.float64)\n\n        for block in blocks:\n            sequences = block\n            N = len(sequences)\n            L = len(sequences[0])\n\n            # Build adjacency matrix for clustering\n            adj_matrix = np.zeros((N, N))\n            for i in range(N):\n                for j in range(i + 1, N):\n                    identity = sum(1 for k in range(L) if sequences[i][k] == sequences[j][k]) / L\n                    if identity >= t:\n                        adj_matrix[i, j] = adj_matrix[j, i] = 1\n            \n            # Find connected components (clusters)\n            n_components, labels = connected_components(adj_matrix, directed=False, connection='weak')\n            \n            if n_components == 1 and N > 1: # All sequences in one cluster\n                continue\n            \n            cluster_sizes = np.bincount(labels)\n            weights = 1.0 / cluster_sizes[labels]\n            \n            # Accumulate weighted pair counts\n            for i in range(N):\n                for j in range(N):\n                    if i == j:\n                        continue\n                    if labels[i] != labels[j]:\n                        w_i, w_j = weights[i], weights[j]\n                        seq_i, seq_j = sequences[i], sequences[j]\n                        for k in range(L):\n                            aa1, aa2 = seq_i[k], seq_j[k]\n                            if aa1 in AA_MAP and aa2 in AA_MAP:\n                                idx1, idx2 = AA_MAP[aa1], AA_MAP[aa2]\n                                count_matrix[idx1, idx2] += w_i * w_j\n        \n        total_count = np.sum(count_matrix)\n\n        if total_count == 0:\n            results.append([0.0, 0.0])\n            continue\n\n        p_matrix = count_matrix / total_count\n        q_vec = np.sum(p_matrix, axis=1)\n\n        score_matrix = np.zeros((20, 20))\n        comparable_indices = np.where(p_matrix > 0)\n        \n        for i, j in zip(*comparable_indices):\n            p_ij = p_matrix[i, j]\n            q_i, q_j = q_vec[i], q_vec[j]\n            \n            # Ensure q_i and q_j are positive to avoid division by zero or log of zero\n            if q_i > 0 and q_j > 0:\n                log_odds = 2 * np.log2(p_ij / (q_i * q_j))\n                score_matrix[i, j] = custom_round(log_odds)\n\n        # Comparison with BLOSUM62\n        s_vec, s62_vec = [], []\n        for i in range(20):\n            for j in range(i, 20):\n                if p_matrix[i, j] > 0:\n                    s_vec.append(score_matrix[i, j])\n                    s62_vec.append(BLOSUM62[i, j])\n        \n        s_vec = np.array(s_vec)\n        s62_vec = np.array(s62_vec)\n\n        # 1. Pearson correlation\n        if len(s_vec) < 2:\n            corr = 0.0\n        else:\n            # Handle cases where variance is zero, which would result in NaN\n            corr_matrix = np.corrcoef(s_vec, s62_vec)\n            corr = corr_matrix[0, 1] if not np.isnan(corr_matrix[0, 1]) else 0.0\n\n        # 2. Mean Absolute Difference\n        if len(s_vec) == 0:\n            mad = 0.0\n        else:\n            mad = np.mean(np.abs(s_vec - s62_vec))\n\n        results.append([corr, mad])\n\n    # Format output as specified\n    results_str = [f\"[{res[0]},{res[1]}]\" for res in results]\n    print(f\"[{','.join(results_str)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The scores in a BLOSUM matrix are not arbitrary numbers; they are intimately linked to the statistical framework used to evaluate alignment significance. This practice explores the fundamental relationship between the mathematical construction of the matrix—specifically, the base of the logarithm used—and the resulting E-values produced by tools like BLAST. Through this thought experiment, you will uncover an important invariance principle that underpins Karlin-Altschul statistics .",
            "id": "2376389",
            "problem": "A Blocks Substitution Matrix (BLOSUM) is a log-odds scoring matrix with entries defined, for a chosen logarithm base $b$, by $S^{(b)}_{ij} = \\log_{b}\\!\\left(\\frac{q_{ij}}{p_{i} p_{j}}\\right)$, where $p_{i}$ and $p_{j}$ are background amino acid frequencies and $q_{ij}$ is the observed aligned pair frequency in conserved blocks. Consider the amino acids alanine ($\\mathrm{A}$) and glycine ($\\mathrm{G}$) with background frequencies $p_{\\mathrm{A}} = 0.08$ and $p_{\\mathrm{G}} = 0.07$, and the following symmetric observed pair frequencies in aligned blocks: $q_{\\mathrm{AA}} = 0.011$, $q_{\\mathrm{AG}} = q_{\\mathrm{GA}} = 0.006$, and $q_{\\mathrm{GG}} = 0.004$.\n\nUsing the natural logarithm $\\ln$ (base $\\exp(1)$) instead of base $2$, recalculate the scores $S^{(e)}_{\\mathrm{AA}}$, $S^{(e)}_{\\mathrm{AG}}$, and $S^{(e)}_{\\mathrm{GG}}$ for this portion of the matrix from first principles, starting from the definition of log-odds. Then, consider a local alignment scored as the sum of these substitution scores without gap penalties. Assume the Karlin–Altschul statistics hold and that the expected number of high-scoring segment pairs with score at least $S$ is given by $E = K\\, m\\, n \\exp(-\\lambda S)$ for both scoring schemes, where $K$, $m$, and $n$ are the same under both schemes. Assume further that the two scoring schemes are exact log-odds matrices differing only by the change of logarithm base (no additional integer scaling or rounding).\n\nUnder these assumptions, what is the value of the ratio $E^{(e)}/E^{(2)}$ of the Basic Local Alignment Search Tool (BLAST) E-values when using the natural logarithm–based matrix versus the base-$2$ matrix for the same alignment? Provide your final answer as a single real number. No rounding is required.",
            "solution": "The problem requires an analysis of the effect of changing the logarithm base in a BLOSUM scoring matrix on the resulting E-value from a BLAST search. We are given the definition of a BLOSUM score, $S_{ij}$, for a pair of amino acids $i$ and $j$, as a log-odds ratio:\n$$ S^{(b)}_{ij} = \\log_{b}\\!\\left(\\frac{q_{ij}}{p_{i} p_{j}}\\right) $$\nHere, $p_i$ is the background frequency of amino acid $i$, $q_{ij}$ is the observed frequency of the aligned pair $(i, j)$ in conserved blocks, and $b$ is the base of the logarithm.\n\nThe problem compares two scoring schemes: one using the natural logarithm (base $e$), denoted $S^{(e)}_{ij}$, and one using base $2$, denoted $S^{(2)}_{ij}$. Their definitions are:\n$$ S^{(e)}_{ij} = \\ln\\!\\left(\\frac{q_{ij}}{p_{i} p_{j}}\\right) $$\n$$ S^{(2)}_{ij} = \\log_{2}\\!\\left(\\frac{q_{ij}}{p_{i} p_{j}}\\right) $$\nWe can relate these two scores using the change of base formula for logarithms, $\\log_{a}(x) = \\frac{\\log_{c}(x)}{\\log_{c}(a)}$. Let us convert the base-$2$ logarithm to the natural logarithm:\n$$ S^{(2)}_{ij} = \\frac{\\ln\\!\\left(\\frac{q_{ij}}{p_{i} p_{j}}\\right)}{\\ln(2)} = \\frac{S^{(e)}_{ij}}{\\ln(2)} $$\nThis establishes a simple scaling relationship between the scores in the two systems:\n$$ S^{(e)}_{ij} = S^{(2)}_{ij} \\ln(2) $$\nThe total score of an alignment, $S$, is the sum of the scores of the individual aligned pairs. If an alignment consists of a sequence of pairs, the total scores, $S^{(e)}$ and $S^{(2)}$, are related by the same scaling factor:\n$$ S^{(e)} = \\sum_{k} S^{(e)}_{i_k j_k} = \\sum_{k} \\left(S^{(2)}_{i_k j_k} \\ln(2)\\right) = \\left(\\ln(2)\\right) \\sum_{k} S^{(2)}_{i_k j_k} = S^{(2)} \\ln(2) $$\n\nNext, we must analyze the Karlin-Altschul statistical parameter $\\lambda$. For a given scoring matrix $S_{ij}$ and background frequencies $p_i$, $\\lambda$ is the unique positive root of the equation:\n$$ \\sum_{i,j} p_i p_j \\exp(\\lambda S_{ij}) = 1 $$\nLet $\\lambda^{(e)}$ and $\\lambda^{(2)}$ be the parameters corresponding to the base-$e$ and base-$2$ scoring matrices, respectively. They must satisfy their respective equations:\n$$ \\sum_{i,j} p_i p_j \\exp(\\lambda^{(e)} S_{ij}^{(e)}) = 1 $$\n$$ \\sum_{i,j} p_i p_j \\exp(\\lambda^{(2)} S_{ij}^{(2)}) = 1 $$\nWe substitute the relationship $S_{ij}^{(e)} = S_{ij}^{(2)} \\ln(2)$ into the first equation:\n$$ \\sum_{i,j} p_i p_j \\exp\\left(\\lambda^{(e)} (S_{ij}^{(2)} \\ln(2))\\right) = 1 $$\nRearranging the term inside the exponent gives:\n$$ \\sum_{i,j} p_i p_j \\exp\\left((\\lambda^{(e)} \\ln(2)) S_{ij}^{(2)}\\right) = 1 $$\nSince $\\lambda$ is the unique positive solution for a given matrix, comparing this equation to the defining equation for $\\lambda^{(2)}$, we must have equality of the coefficients of $S_{ij}^{(2)}$ in the exponent:\n$$ \\lambda^{(2)} = \\lambda^{(e)} \\ln(2) $$\nThis gives us the relationship between the $\\lambda$ parameters for the two systems:\n$$ \\lambda^{(e)} = \\frac{\\lambda^{(2)}}{\\ln(2)} $$\n\nThe problem asks for the ratio of E-values, $E^{(e)}/E^{(2)}$. The E-value is given by the formula $E = K m n \\exp(-\\lambda S)$, where $K$, $m$, and $n$ are constants related to the search space and statistical properties of the score matrix. The problem states that these are the same for both schemes.\nThe two E-values are:\n$$ E^{(e)} = K m n \\exp(-\\lambda^{(e)} S^{(e)}) $$\n$$ E^{(2)} = K m n \\exp(-\\lambda^{(2)} S^{(2)}) $$\nThe ratio is:\n$$ \\frac{E^{(e)}}{E^{(2)}} = \\frac{K m n \\exp(-\\lambda^{(e)} S^{(e)})}{K m n \\exp(-\\lambda^{(2)} S^{(2)})} = \\exp\\left(-\\lambda^{(e)} S^{(e)} + \\lambda^{(2)} S^{(2)}\\right) $$\nLet us examine the term $\\lambda^{(e)} S^{(e)}$ by substituting the derived relationships:\n$$ \\lambda^{(e)} S^{(e)} = \\left(\\frac{\\lambda^{(2)}}{\\ln(2)}\\right) \\left(S^{(2)} \\ln(2)\\right) = \\lambda^{(2)} S^{(2)} $$\nThis demonstrates that the product $\\lambda S$ is invariant under a change of logarithm base for the scoring matrix. This product represents the score in dimensionless units (nats), which is fundamental to the statistical theory.\nTherefore, the exponent in the ratio of E-values is zero:\n$$ -\\lambda^{(e)} S^{(e)} + \\lambda^{(2)} S^{(2)} = 0 $$\nThe ratio simplifies to:\n$$ \\frac{E^{(e)}}{E^{(2)}} = \\exp(0) = 1 $$\nThe specific numerical data provided for frequencies ($p_{\\mathrm{A}} = 0.08$, $p_{\\mathrm{G}} = 0.07$) and observed pairs ($q_{\\mathrm{AA}} = 0.011$, $q_{\\mathrm{AG}} = 0.006$, $q_{\\mathrm{GG}} = 0.004$) are not necessary for this derivation. The result is general and holds for any alignment and any valid set of probabilities, given the condition that the scoring matrices are exact log-odds matrices differing only by the logarithm base. The prompt to calculate specific scores is a distraction from the core theoretical question.",
            "answer": "$$\n\\boxed{1}\n$$"
        }
    ]
}