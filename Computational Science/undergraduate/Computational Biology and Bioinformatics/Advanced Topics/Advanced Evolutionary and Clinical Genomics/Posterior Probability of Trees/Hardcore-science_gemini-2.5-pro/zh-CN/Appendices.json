{
    "hands_on_practices": [
        {
            "introduction": "在贝叶斯系统发育分析中，我们从 MCMC（马尔可夫链蒙特卡洛）模拟中获得的是树的后验分布样本，而不是单一的一棵“正确”的树。这项实践的核心任务是学习如何利用这个样本来计算特定演化支（即单系群）的后验概率，这通常被称为演化支的可信度。这个练习将帮助你理解如何从原始 MCMC 输出中提取关键信息，并阐明了演化支的后验概率与最大后验概率（MAP）树之间的重要区别，后者仅代表后验概率最高的单一点估计 。",
            "id": "2415452",
            "problem": "对一个分子序列比对进行贝叶斯系统发育分析，在指定的替换模型和先验条件下，通过马尔可夫链蒙特卡洛 (MCMC) 方法产生了一个包含 $10,000$ 棵有根树的后验样本。最大后验 (MAP) 树是样本中在所有采样状态里具有最高后验概率的单一树 $T^{\\ast}$。考虑一个由一组固定分类单元定义的特定单系群 $C$。这个群 $C$ 不存在于最大后验树 $T^{\\ast}$ 中。经诊断，MCMC 在迭代 $2,000$ 次后达到平稳状态，前 $2,000$ 棵树作为预烧期 (burn-in) 被丢弃。为了减少自相关性，从剩余的 $8,000$ 棵树中每隔 $5$ 棵保留一棵，从而得到一个包含 $1,600$ 棵树的后验样本。在这个保留的样本中，群 $C$ 恰好出现在 $482$ 棵树中。仅使用这个保留的后验样本，计算在给定数据 $D$ 的情况下单系群 $C$ 的后验概率 $\\Pr(C \\mid D)$。将您的答案表示为小数，并四舍五入到 $4$ 位有效数字。",
            "solution": "该问题要求计算在给定一组分子序列数据 $D$ 的情况下，一个单系群（或称分支）$C$ 的后验概率。该量表示为 $\\Pr(C \\mid D)$。\n\n在贝叶斯系统发育学的框架中，推断的核心对象是系统发育树的后验概率分布 $\\Pr(T \\mid D)$，其中 $T$ 代表树的拓扑结构及其相关的枝长。该分布通过贝叶斯定理获得：\n$$\n\\Pr(T \\mid D) = \\frac{\\Pr(D \\mid T) \\Pr(T)}{\\Pr(D)}\n$$\n其中 $\\Pr(D \\mid T)$ 是给定树时数据的似然，$\\Pr(T)$ 是树的先验概率，而 $\\Pr(D)$ 是边际似然，一个归一化常数。\n\n树的某个特定特征（如分支 $C$）的后验概率，定义为所有包含该特征的树的后验概率之和。这对应于对后验分布进行边缘化。如果我们令 $I(C \\in T)$ 为一个指示函数，当树 $T$ 包含分支 $C$ 时其值为 $1$，否则为 $0$，那么 $C$ 的后验概率由该指示函数在后验分布上的期望给出：\n$$\n\\Pr(C \\mid D) = \\int I(C \\in T) \\Pr(T \\mid D) \\, dT\n$$\n这个在所有可能树的巨大空间上的积分在分析上是难以计算的。因此，它通过使用马尔可夫链蒙特卡洛 (MCMC) 算法从后验分布 $\\Pr(T \\mid D)$ 中抽取的一组样本来近似。\n\n马尔可夫链的遍历定理指出，对于一个足够长的链，采样序列中某个状态的频率会收敛到该状态在平稳分布中的真实概率。因此，分支 $C$ 的后验概率可以估计为 MCMC 样本中包含 $C$ 的树的比例。\n\n问题提供了关于 MCMC 模拟的以下细节：\n- 初始 MCMC 运行产生了 $10,000$ 棵树的样本。\n- 前 $2,000$ 棵树作为预烧期 (burn-in) 被丢弃。这是一个标准程序，以确保样本是从马尔可夫链的平稳分布中抽取的。\n- 预烧期后剩余的树的数量是 $10,000 - 2,000 = 8,000$。\n- 通过每隔 $5$ 棵树保留一棵来对链进行稀疏化，以减少连续样本之间的自相关性。\n- 最终的有效后验样本包含 $N = \\frac{8,000}{5} = 1,600$ 棵树。\n\n问题陈述，在这个最终的 $1,600$ 棵树的样本中，分支 $C$ 恰好出现在 $N_C = 482$ 棵树中。\n\n分支 $C$ 的后验概率的估计值是它在这个最终样本中出现的频率：\n$$\n\\Pr(C \\mid D) \\approx \\frac{N_C}{N} = \\frac{482}{1,600}\n$$\n分支 $C$ 不存在于最大后验 (MAP) 树 $T^{\\ast}$ 中的信息与此计算无关。MAP 树是对应于后验分布众数的单点估计。然而，一个分支的后验概率是一个边际概率，代表了所有包含该分支的树的总概率质量。在系统发育推断中，一个分支具有显著的后验概率（例如，大于 $0.5$）但却不存在于 MAP 树中是常见现象，特别是当后验分布弥散在多个具有相似概率的冲突拓扑结构上时。\n\n进行计算：\n$$\n\\frac{482}{1,600} = 0.30125\n$$\n问题要求答案表示为小数并四舍五入到 $4$ 位有效数字。前四位有效数字是 $3$、$0$、$1$ 和 $2$。第五位数字是 $5$，所以我们将第四位数字向上取整。这得到：\n$$\n\\Pr(C \\mid D) \\approx 0.3013\n$$",
            "answer": "$$\\boxed{0.3013}$$"
        },
        {
            "introduction": "除了评估单个演化支的可信度，我们还可以利用后验样本来检验更复杂的演化假说。本练习将引导你计算一个类群相对于另一个分类单元是“并系”的后验概率。要做到这一点，你需要识别出后验样本中所有符合并系定义的树拓扑，并将它们的频率相加。这项实践旨在强化一个核心概念：通过对后验分布进行边缘化，我们可以量化任何明确定义的演化情景（即使它对应多种拓扑结构）的可信度 。",
            "id": "2415499",
            "problem": "您正在分析来自四个分类单元的DNA序列数据 $\\mathcal{D}$：三个内群物种 $A$、$B$ 和 $C$（统称为 $G=\\{A,B,C\\}$），以及一个焦点分类单元 $O$。您在一个时间可逆替换模型下，使用严格分子钟和确定了根的化石校准，进行贝叶斯系统发育推断，并对这四个分类单元的所有有根二叉拓扑结构设置了均匀先验。在丢弃预烧期样本并确认收敛后，您使用马尔可夫链蒙特卡洛（MCMC）方法获得了 $N=2000$ 个等权重的有根树后验样本。\n\n定义事件 $E$ 为：“$G$ 相对于 $O$ 是并系的”，这意味着 $A$、$B$ 和 $C$ 的最近共同祖先拥有后代 $O$（等价地，包含 $A$、$B$ 和 $C$ 的最小演化支也包含 $O$）。\n\n您的 MCMC 样本可以划分为以下互斥且穷尽的类别，其计数如下：\n- $1200$ 棵树，其中 $G$ 是单系的，且 $O$ 在包含 $A$、$B$ 和 $C$ 的演化支之外。\n- $400$ 棵树，其中 $O$ 与 $A$ 在由 $A$、$B$ 和 $C$ 的最近共同祖先所界定的演化支内部形成一个演化支。\n- $280$ 棵树，其中 $O$ 与 $B$ 在由 $A$、$B$ 和 $C$ 的最近共同祖先所界定的演化支内部形成一个演化支。\n- $120$ 棵树，其中 $O$ 与 $C$ 在由 $A$、$B$ 和 $C$ 的最近共同祖先所界定的演化支内部形成一个演化支。\n\n从树的贝叶斯后验定义以及将后验概率解释为该后验下的期望出发，推导后验概率 $\\Pr(E \\mid \\mathcal{D})$ 的表达式，并使用提供的 MCMC 样本进行计算。最终答案以小数形式表示，并四舍五入至四位有效数字。请勿使用百分号。",
            "solution": "我们从给定分类单元上的有根二叉树离散空间 $\\mathcal{T}$ 的贝叶斯定理开始。对于任何树 $T \\in \\mathcal{T}$，\n$$\n\\Pr(T \\mid \\mathcal{D}) \\propto \\Pr(\\mathcal{D} \\mid T)\\,\\Pr(T),\n$$\n其中比例常数由模型证据给出。在所述的对有根二叉拓扑结构的均匀先验以及分支长度在其先验下积分的条件下，这定义了 $\\mathcal{T}$ 上的一个后验概率质量函数。\n\n对于一个事件 $E \\subseteq \\mathcal{T}$，其后验概率是指示函数 $I_{E}(T)$ 的后验期望，\n$$\n\\Pr(E \\mid \\mathcal{D}) \\;=\\; \\sum_{T \\in \\mathcal{T}} I_{E}(T)\\,\\Pr(T \\mid \\mathcal{D}) \\;=\\; \\mathbb{E}_{T \\sim \\Pr(\\cdot \\mid \\mathcal{D})}\\!\\big[I_{E}(T)\\big],\n$$\n其中，如果 $T \\in E$，则 $I_{E}(T)=1$，否则 $I_{E}(T)=0$。\n\n马尔可夫链蒙特卡洛（MCMC）通过蒙特卡洛积分为该期望提供了一个经验近似。给定一个从 $\\Pr(\\cdot \\mid \\mathcal{D})$ 中抽取的等权重后验样本 $\\{T_{i}\\}_{i=1}^{N}$，$\\Pr(E \\mid \\mathcal{D})$ 的蒙特卡洛估计量为\n$$\n\\widehat{\\Pr}(E \\mid \\mathcal{D}) \\;=\\; \\frac{1}{N}\\sum_{i=1}^{N} I_{E}(T_{i}) \\;=\\; \\frac{\\#\\{i: T_{i} \\in E\\}}{N}.\n$$\n\n根据问题的定义，当 $O$ 是 $A$、$B$ 和 $C$ 的最近共同祖先的后代时，即当 $O$ 嵌套在包含 $A$、$B$ 和 $C$ 的最小演化支内时，事件 $E$ 恰好发生。在所提供的分类中，事件 $E$ 恰好对应于 $O$ 与 $A$、$B$ 或 $C$ 中的一个在由 $A$、$B$ 和 $C$ 的最近共同祖先所界定的演化支内部形成演化支的三种类别。\n\n令 $n_{AO}$、$n_{BO}$ 和 $n_{CO}$ 分别表示 $O$ 与 $A$、$B$ 和 $C$ 形成演化支的树的计数，令 $n_{\\text{mono}}$ 表示 $G$ 是单系且 $O$ 在外部的计数。我们已知\n$$\nn_{\\text{mono}} = 1200,\\quad n_{AO} = 400,\\quad n_{BO} = 280,\\quad n_{CO} = 120,\\quad N=2000.\n$$\n满足 $E$ 的样本数量为\n$$\nn_{E} \\;=\\; n_{AO} + n_{BO} + n_{CO} \\;=\\; 400 + 280 + 120 \\;=\\; 800.\n$$\n因此，\n$$\n\\widehat{\\Pr}(E \\mid \\mathcal{D}) \\;=\\; \\frac{n_{E}}{N} \\;=\\; \\frac{800}{2000} \\;=\\; 0.4.\n$$\n\n按要求四舍五入到四位有效数字，得到 $0.4000$。",
            "answer": "$$\\boxed{0.4000}$$"
        },
        {
            "introduction": "有时，我们需要一个单一的数值来概括系统发育推断的整体不确定性或冲突程度。香农熵是信息论中一个强有力的工具，可以用来衡量一个概率分布的“混乱”或“不确定”程度。在这个练习中，你将计算树拓扑后验分布的香农熵，从而对分析结果的整体确定性进行量化评估。高熵值意味着后验概率分散在许多不同的树上，表明数据中存在显著的冲突或不确定性；而低熵值则表示大部分概率集中在少数几棵树上，推断结果更为明确 。",
            "id": "2415418",
            "problem": "对四个分类单元进行了一项贝叶斯系统发育分析，得到了一个关于三种可能的无根、完全解析的树拓扑结构（记为 $T_{1}$、$T_{2}$ 和 $T_{3}$）的后验分布。在对分支长度和替换模型参数进行积分后，这些拓扑结构的边际后验概率为：\n$p(T_{1}) = 0.60$，$p(T_{2}) = 0.25$，以及 $p(T_{3}) = 0.15$。\n将此视为一个关于树拓扑结构的离散后验分布。使用自然对数计算该分布的香农熵 $H$，即以奈特（nats）为单位。报告你的最终结果，结果应为一个纯数（无量纲），并四舍五入到 $4$ 位有效数字。",
            "solution": "本题要求计算给定离散概率分布的香non熵。该分布描述了三种不同的无根系统发育树拓扑结构（记为 $T_{1}$、$T_{2}$ 和 $T_{3}$）的后验概率。给定的概率为 $p(T_{1}) = 0.60$，$p(T_{2}) = 0.25$，以及 $p(T_{3}) = 0.15$。这些概率之和为 $0.60 + 0.25 + 0.15 = 1.00$，这证实了它是一个有效的概率质量函数。\n\n对于一个具有可能结果集 $\\{x_1, x_2, \\dots, x_n\\}$ 和相应概率 $p(x_i)$ 的离散随机变量，其香农熵 $H$ 定义为：\n$$ H = - \\sum_{i=1}^{n} p(x_i) \\log_{b} p(x_i) $$\n在本题中，熵以奈特（nats）为单位度量，这意味着使用自然对数（以 $e$ 为底）。因此，公式变为：\n$$ H = - \\sum_{i=1}^{n} p(x_i) \\ln(p(x_i)) $$\n\n对于给定的三种拓扑结构及其后验概率，熵的计算如下：\n$$ H = - \\left[ p(T_{1})\\ln(p(T_{1})) + p(T_{2})\\ln(p(T_{2})) + p(T_{3})\\ln(p(T_{3})) \\right] $$\n将概率的数值代入：\n$$ H = - \\left[ 0.60 \\ln(0.60) + 0.25 \\ln(0.25) + 0.15 \\ln(0.15) \\right] $$\n我们来计算这个表达式。\n方括号内的各项分别为：\n$$ 0.60 \\ln(0.60) \\approx 0.60 \\times (-0.5108256) \\approx -0.30649536 $$\n$$ 0.25 \\ln(0.25) \\approx 0.25 \\times (-1.3862944) \\approx -0.34657360 $$\n$$ 0.15 \\ln(0.15) \\approx 0.15 \\times (-1.8971200) \\approx -0.28456800 $$\n将这些值相加，得到方括号内的总和：\n$$ \\sum_{i=1}^{3} p(T_{i}) \\ln(p(T_{i})) \\approx -0.30649536 - 0.34657360 - 0.28456800 \\approx -0.93763696 $$\n熵 $H$ 是这个和的负值：\n$$ H = -(-0.93763696) \\approx 0.93763696 $$\n题目要求最终答案以纯数的形式报告，并四舍五入到 $4$ 位有效数字。前四位有效数字是 $9, 3, 7, 6$。第五位有效数字是 $3$，小于 $5$，因此我们不对最后一位数字进行进位。\n因此，四舍五入到 $4$ 位有效数字的熵为 $0.9376$。",
            "answer": "$$\\boxed{0.9376}$$"
        }
    ]
}