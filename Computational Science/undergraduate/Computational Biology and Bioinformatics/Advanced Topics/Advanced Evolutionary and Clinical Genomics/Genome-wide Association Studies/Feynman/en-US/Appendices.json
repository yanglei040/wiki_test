{
    "hands_on_practices": [
        {
            "introduction": "A defining feature of Genome-Wide Association Studies (GWAS) is the immense number of simultaneous statistical tests, often numbering in the millions. Using a conventional significance threshold, such as $\\alpha = 0.05$, would lead to an unacceptably high number of false-positive associations. This first practice demonstrates how to manage this multiple testing problem by applying the Bonferroni correction, a foundational method for controlling the family-wise error rate and deriving the stringent p-value threshold necessary for declaring genome-wide significance. ",
            "id": "1494362",
            "problem": "A team of geneticists is conducting a Genome-Wide Association Study (GWAS) to identify genetic markers associated with a newly discovered complex disorder. A GWAS involves scanning the genomes of many individuals to determine if any specific genetic variants are more frequent in people with the disease compared to a control group. The genetic variants being analyzed in this study are Single Nucleotide Polymorphisms (SNPs).\n\nIn this particular study, the researchers are simultaneously testing $m = 1,000,000$ independent SNPs for a statistical association with the disorder. Conventionally, for a single statistical test, a p-value threshold (alpha level) for significance is set at $\\alpha = 0.05$. However, performing such a large number of tests significantly inflates the probability of obtaining at least one \"false positive\" result (a Type I error) purely by chance.\n\nTo counteract this multiple testing problem, the research team decides to control the Family-Wise Error Rate (FWER), defined as the probability of making one or more Type I errors among all the tests performed. They aim to keep the FWER at or below 0.05. To achieve this, they will apply the Bonferroni correction to their significance threshold.\n\nGiven the number of independent SNPs being tested and the desired FWER, calculate the new, Bonferroni-corrected p-value threshold that a single SNP must meet to be considered statistically significant. Express your answer in scientific notation.",
            "solution": "The family-wise error rate under the Bonferroni procedure satisfies the Bonferroni inequality:\n$$\n\\text{FWER} \\leq \\sum_{i=1}^{m} \\alpha_{i}.\n$$\nIf each of the $m$ tests is conducted at the same per-test significance level $\\alpha^{*}$, then\n$$\n\\text{FWER} \\leq m \\alpha^{*}.\n$$\nTo control the FWER at the desired level $\\alpha$, choose $\\alpha^{*}$ such that\n$$\nm \\alpha^{*} \\leq \\alpha \\quad \\Rightarrow \\quad \\alpha^{*} = \\frac{\\alpha}{m}.\n$$\nWith $\\alpha = 0.05$ and $m = 1{,}000{,}000 = 10^{6}$, write $0.05 = 5 \\times 10^{-2}$ and compute\n$$\n\\alpha^{*} = \\frac{5 \\times 10^{-2}}{10^{6}} = 5 \\times 10^{-2-6} = 5 \\times 10^{-8}.\n$$\nThus, the Bonferroni-corrected p-value threshold is $5 \\times 10^{-8}$.",
            "answer": "$$\\boxed{5 \\times 10^{-8}}$$"
        },
        {
            "introduction": "Before searching for true associations, we must ensure the quality of our genetic data. Genotyping errors can mimic or mask real genetic signals, so rigorous quality control (QC) is a critical first step in any GWAS pipeline. This hands-on coding problem introduces a cornerstone of GWAS QC: testing for deviations from Hardy-Weinberg Equilibrium (HWE), as significant departures in control populations often point to systematic genotyping artifacts. ",
            "id": "2394652",
            "problem": "You are given the task of constructing a program that implements a quality control filter for a Genome-Wide Association Study (GWAS). The filter must detect and mark single-nucleotide polymorphisms (SNPs) in control samples that show a statistically significant deviation from Hardy-Weinberg equilibrium (HWE). A SNP is biallelic with alleles denoted by $A$ and $a$. For each SNP, you are provided the genotype counts in controls: $n_{AA}$ for homozygous $AA$, $n_{Aa}$ for heterozygous $Aa$, and $n_{aa}$ for homozygous $aa$. Let $n = n_{AA} + n_{Aa} + n_{aa}$ denote the number of control individuals.\n\nUnder the null hypothesis of Hardy-Weinberg equilibrium (HWE), the population is assumed to arise from random mating given the underlying allele frequencies. Consider the exact conditional test for HWE that conditions on the total number of copies of one allele in the sample. Let there be $2n$ chromosomal positions and let $r$ denote the number of copies of the rarer allele among these $2n$ positions. Assume that every allocation of the $r$ rarer-allele copies to the $2n$ chromosomal positions is equally likely under the null hypothesis. Define the two-sided exact $p$-value for a given observed genotype configuration as the sum of the conditional probabilities of all genotype configurations that have the same total allele count and are at least as unlikely as the observed configuration under the null hypothesis.\n\nFor each SNP, use the following decision rule: remove the SNP (mark it as $1$) if the exact two-sided HWE $p$-value is strictly less than the given significance level $\\alpha$, otherwise keep it (mark it as $0$).\n\nImplement a single program that applies this rule to the following test suite of independent SNPs, each specified as a tuple $(n_{AA}, n_{Aa}, n_{aa}, \\alpha)$:\n\n- Test $1$: $(50, 20, 30, 10^{-6})$, i.e., $n_{AA} = 50$, $n_{Aa} = 20$, $n_{aa} = 30$, $\\alpha = 10^{-6}$.\n- Test $2$: $(36, 48, 16, 10^{-6})$, i.e., $n_{AA} = 36$, $n_{Aa} = 48$, $n_{aa} = 16$, $\\alpha = 10^{-6}$.\n- Test $3$: $(100, 0, 0, 10^{-6})$, i.e., $n_{AA} = 100$, $n_{Aa} = 0$, $n_{aa} = 0$, $\\alpha = 10^{-6}$.\n- Test $4$: $(18, 2, 0, 0.05)$, i.e., $n_{AA} = 18$, $n_{Aa} = 2$, $n_{aa} = 0$, $\\alpha = 0.05$.\n- Test $5$: $(0, 10, 0, 0.01)$, i.e., $n_{AA} = 0$, $n_{Aa} = 10$, $n_{aa} = 0$, $\\alpha = 0.01$.\n- Test $6$: $(405, 90, 5, 0.05)$, i.e., $n_{AA} = 405$, $n_{Aa} = 90$, $n_{aa} = 5$, $\\alpha = 0.05$.\n\nYour program should produce a single line of output containing the results as a comma-separated list of integers enclosed in square brackets, in the same order as the tests above, where each entry is $1$ if the SNP is to be removed and $0$ otherwise. For example, a valid output format is [1,0,1] (this is only an example of formatting, not the correct answers).",
            "solution": "The user-provided problem is subjected to rigorous validation.\n\nStep 1: Extract Givens\n- **Task**: Implement a quality control filter for a Genome-Wide Association Study (GWAS) to remove single-nucleotide polymorphisms (SNPs) that deviate from Hardy-Weinberg Equilibrium (HWE).\n- **Model**: SNPs are biallelic with alleles $A$ and $a$.\n- **Input Data**: For each SNP, genotype counts are given: $n_{AA}$, $n_{Aa}$, $n_{aa}$.\n- **Total Sample Size**: $n = n_{AA} + n_{Aa} + n_{aa}$.\n- **Statistical Test**: A two-sided exact conditional test for HWE.\n- **Conditioning**: The test is conditional on the total observed counts of each allele.\n- **Null Hypothesis ($H_0$)**: The genotype counts follow HWE. Under $H_0$, any allocation of the $r$ rarer-allele copies to the $2n$ chromosomal positions is equally likely.\n- **P-value Definition**: The sum of conditional probabilities of all genotype configurations that have the same total allele count and are at least as unlikely as the observed configuration.\n- **Decision Rule**: Remove SNP (mark as $1$) if $p < \\alpha$; otherwise, keep SNP (mark as $0$).\n- **Test Cases**:\n    - Test 1: $(n_{AA}=50, n_{Aa}=20, n_{aa}=30, \\alpha=10^{-6})$\n    - Test 2: $(n_{AA}=36, n_{Aa}=48, n_{aa}=16, \\alpha=10^{-6})$\n    - Test 3: $(n_{AA}=100, n_{Aa}=0, n_{aa}=0, \\alpha=10^{-6})$\n    - Test 4: $(n_{AA}=18, n_{Aa}=2, n_{aa}=0, \\alpha=0.05)$\n    - Test 5: $(n_{AA}=0, n_{Aa}=10, n_{aa}=0, \\alpha=0.01)$\n    - Test 6: $(n_{AA}=405, n_{Aa}=90, n_{aa}=5, \\alpha=0.05)$\n- **Output Format**: A single line with a comma-separated list of results, e.g., `[1,0,1]`.\n\nStep 2: Validate Using Extracted Givens\n- **Scientifically Grounded**: The problem is valid. It describes the implementation of the HWE exact test, a standard and fundamental statistical procedure in population genetics and bioinformatics, often used for quality control in GWAS. The concepts of alleles, genotypes, and HWE are cornerstones of genetics.\n- **Well-Posed**: The problem is valid. It provides all necessary components: input data ($n_{AA}, n_{Aa}, n_{aa}, \\alpha$), the specific statistical test to use (conditional exact test), a precise definition for the $p$-value, and a clear decision rule. This structure allows for a unique, computable solution for each test case.\n- **Objective**: The problem is valid. It is formulated using objective, technical language devoid of subjectivity or ambiguity.\n\nStep 3: Verdict and Action\nThe problem is scientifically sound, well-posed, and objective. It is **valid**. A solution will be constructed.\n\n---\n\nThe problem requires the implementation of an exact test for Hardy-Weinberg Equilibrium (HWE). This test is a standard procedure for quality control in genetic studies, as significant deviations from HWE can indicate genotyping errors. The solution involves calculating a two-sided $p$-value for a given set of observed genotype counts and comparing it to a significance level $\\alpha$.\n\nLet the observed genotype counts for a biallelic SNP be $n_{AA}$, $n_{Aa}$, and $n_{aa}$. The total number of individuals in the sample is $n = n_{AA} + n_{Aa} + n_{aa}$. The counts of the two alleles, which we denote as $A$ and $a$, are:\n- Number of $A$ alleles: $N_A = 2n_{AA} + n_{Aa}$\n- Number of $a$ alleles: $N_a = 2n_{aa} + n_{Aa}$\nThe total number of alleles in the sample is $2n = N_A + N_a$.\n\nThe exact test for HWE is conditional on the observed allele counts, $N_A$ and $N_a$. Under the null hypothesis of HWE, we can conceptualize the $2n$ alleles in the sample as being randomly paired to form $n$ diploid individuals. Keeping the allele counts $N_A$ and $N_a$ fixed restricts the possible genotype configurations. Specifically, if we know the number of heterozygotes, $n_{Aa}$, the counts of homozygotes are determined:\n$$ n_{AA} = \\frac{N_A - n_{Aa}}{2} $$\n$$ n_{aa} = \\frac{N_a - n_{Aa}}{2} $$\nSince $n_{AA}$ and $n_{aa}$ must be non-negative integers, the number of heterozygotes, $n_{Aa}$, uniquely defines the genotype counts for a fixed $N_A$ and $N_a$. The probability of observing a specific count of heterozygotes, $k$, given the allele counts, follows a specific probability distribution derived from combinatorial arguments. The probability mass function (PMF) is:\n$$ P(n_{Aa} = k | n, N_A, N_a) = \\frac{n! N_A! N_a! 2^k}{(2n)! n_{AA_k}! k! n_{aa_k}!} $$\nwhere $n_{AA_k} = (N_A - k)/2$ and $n_{aa_k} = (N_a - k)/2$.\n\nThe range of possible values for $k$ (the support of the distribution) is determined by the constraints that genotype counts must be non-negative integers.\n1.  $k \\geq 0$\n2.  $n_{AA_k} \\geq 0 \\implies k \\leq N_A$\n3.  $n_{aa_k} \\geq 0 \\implies k \\leq N_a$\n4.  Furthermore, for $n_{AA_k}$ and $n_{aa_k}$ to be integers, $(N_A - k)$ and $(N_a - k)$ must be even. This implies that $k$ must have the same parity (even or odd) as $N_A$ and $N_a$. Note that $N_A$ and $N_a$ always have the same parity because their sum, $2n$, is even.\n\nThe two-sided $p$-value is defined as the sum of probabilities of all possible configurations that are as probable or less probable than the observed configuration. Let the observed heterozygote count be $n_{Aa,obs}$. The probability of this observation is $P_{obs} = P(n_{Aa} = n_{Aa,obs})$. The $p$-value is then:\n$$ p = \\sum_{k \\in \\text{support}} P(n_{Aa} = k) \\quad \\text{such that} \\quad P(n_{Aa} = k) \\leq P_{obs} $$\n\nThe calculation involves factorials of large numbers, which can lead to numerical overflow or underflow. To maintain precision, computations should be performed in log-space. The logarithm of the PMF is:\n$$ \\ln P(k) = \\ln(n!) + \\ln(N_A!) + \\ln(N_a!) + k\\ln(2) - \\ln((2n)!) - \\ln(n_{AA_k}!) - \\ln(k!) - \\ln(n_{aa_k}!) $$\nThe log-factorial, $\\ln(x!)$, can be computed using the log-gamma function, `gammaln`, as $\\ln(x!) = \\text{gammaln}(x+1)$.\n\nThe algorithm proceeds as follows for each test case:\n1.  Calculate $n, N_A, N_a$ from the input genotype counts $n_{AA,obs}, n_{Aa,obs}, n_{aa,obs}$.\n2.  Handle the trivial case where the SNP is monomorphic (i.e., $N_A=0$ or $N_a=0$). In this situation, only one genotype configuration is possible, its probability is $1$, and thus the $p$-value is $1$.\n3.  Determine the support for $n_{Aa}$: iterate from the minimum possible value (0 or 1, depending on parity) to the maximum possible value, $\\min(N_A, N_a)$, with a step of $2$.\n4.  Calculate the log-probability of the observed configuration, $\\ln(P_{obs})$.\n5.  Initialize the $p$-value to $0$. Iterate through all possible values $k$ in the support. For each $k$, calculate its log-probability, $\\ln(P_k)$.\n6.  If $\\ln(P_k) \\leq \\ln(P_{obs})$, add the probability $P_k = \\exp(\\ln(P_k))$ to the total $p$-value.\n7.  Finally, compare the calculated $p$-value with the given significance level $\\alpha$. If $p < \\alpha$, the result is $1$ (remove). Otherwise, the result is $0$ (keep).\n\nThis procedure is implemented for each of the specified test cases to produce the final output.",
            "answer": "[0,0,0,0,1,0]"
        },
        {
            "introduction": "Even with robust statistical thresholds and clean data, systematic biases can still lead to widespread spurious findings in a GWAS. A primary concern is population stratification, where subtle ancestry differences between cases and controls inflate association test statistics across the genome. This practice introduces the genomic inflation factor ($\\lambda$) as a crucial diagnostic tool to quantify such systematic inflation, allowing researchers to assess the validity of their results and determine if corrective measures are needed. ",
            "id": "2394670",
            "problem": "In Genome-Wide Association Studies (GWAS), the genomic inflation factor ($\\lambda$) quantifies systematic inflation of test statistics that can arise from confounding such as population stratification. Consider two simulated scenarios for single-nucleotide polymorphisms (SNPs): a null scenario with no stratification and a stratified scenario with strong population structure. For each scenario, an additive association test yields a one degree-of-freedom ($1$ d.f.) chi-square statistic for each SNP. The observed chi-square statistics are:\n\nNull scenario ($n = 21$ SNPs):\n$$\\{0.03,\\, 0.07,\\, 0.12,\\, 0.19,\\, 0.26,\\, 0.31,\\, 0.37,\\, 0.41,\\, 0.44,\\, 0.45,\\, 0.46,\\, 0.49,\\, 0.53,\\, 0.61,\\, 0.74,\\, 0.88,\\, 1.02,\\, 1.18,\\, 1.36,\\, 1.57,\\, 1.82\\}.$$\n\nStratified scenario ($n = 21$ SNPs):\n$$\\{0.054,\\, 0.126,\\, 0.216,\\, 0.342,\\, 0.468,\\, 0.558,\\, 0.666,\\, 0.738,\\, 0.792,\\, 0.81,\\, 0.828,\\, 0.882,\\, 0.954,\\, 1.098,\\, 1.332,\\, 1.584,\\, 1.836,\\, 2.124,\\, 2.448,\\, 2.826,\\, 3.276\\}.$$\n\nBy definition, for an association test with $1$ degree of freedom, the genomic inflation factor is\n$$\\lambda \\;=\\; \\frac{\\operatorname{median}\\!\\left(\\chi^{2}_{\\text{obs}}\\right)}{\\operatorname{median}\\!\\left(\\chi^{2}_{1,\\text{null}}\\right)},$$\nwhere $\\operatorname{median}\\!\\left(\\chi^{2}_{1,\\text{null}}\\right)$ is the population median of a chi-square distribution with $1$ degree of freedom under the null hypothesis.\n\nCompute $\\lambda$ for the null scenario and for the stratified scenario. Report your final answers as two numbers in a single row matrix $\\bigl[\\lambda_{\\text{null}}\\;\\;\\lambda_{\\text{stratified}}\\bigr]$, rounded to $4$ significant figures. No units are required.",
            "solution": "The problem statement is first subjected to rigorous validation.\n\n**Step 1: Extract Givens**\n-   The context is Genome-Wide Association Studies (GWAS).\n-   The quantity to be computed is the genomic inflation factor, $\\lambda$.\n-   The test statistic for each single-nucleotide polymorphism (SNP) follows a chi-square distribution with one degree of freedom ($1$ d.f.).\n-   Two scenarios are presented, each with $n = 21$ SNPs.\n-   The set of observed chi-square statistics for the null scenario is:\n    $\\chi^{2}_{\\text{obs, null}} = \\{0.03,\\, 0.07,\\, 0.12,\\, 0.19,\\, 0.26,\\, 0.31,\\, 0.37,\\, 0.41,\\, 0.44,\\, 0.45,\\, 0.46,\\, 0.49,\\, 0.53,\\, 0.61,\\, 0.74,\\, 0.88,\\, 1.02,\\, 1.18,\\, 1.36,\\, 1.57,\\, 1.82\\}$.\n-   The set of observed chi-square statistics for the stratified scenario is:\n    $\\chi^{2}_{\\text{obs, stratified}} = \\{0.054,\\, 0.126,\\, 0.216,\\, 0.342,\\, 0.468,\\, 0.558,\\, 0.666,\\, 0.738,\\, 0.792,\\, 0.81,\\, 0.828,\\, 0.882,\\, 0.954,\\, 1.098,\\, 1.332,\\, 1.584,\\, 1.836,\\, 2.124,\\, 2.448,\\, 2.826,\\, 3.276\\}$.\n-   The definition of the genomic inflation factor is given as:\n    $$\\lambda \\;=\\; \\frac{\\operatorname{median}\\!\\left(\\chi^{2}_{\\text{obs}}\\right)}{\\operatorname{median}\\!\\left(\\chi^{2}_{1,\\text{null}}\\right)}$$\n    where $\\operatorname{median}\\!\\left(\\chi^{2}_{1,\\text{null}}\\right)$ is the population median of a $\\chi^{2}$ distribution with $1$ degree of freedom.\n-   The final answer must be a row matrix $[\\lambda_{\\text{null}}\\;\\;\\lambda_{\\text{stratified}}]$, with values rounded to $4$ significant figures.\n\n**Step 2: Validate Using Extracted Givens**\n-   **Scientific Grounding**: The problem is scientifically sound. The genomic inflation factor $\\lambda$ is a standard metric in GWAS for detecting and quantifying confounding, such as population stratification. The use of chi-square statistics and their theoretical null distribution is fundamental to this field. The provided formula is the correct definition.\n-   **Well-Posedness**: The problem is well-posed. It provides all necessary data (the observed statistics for both scenarios) and a clear, unambiguous formula for the calculation. The only external piece of information required, the median of the $\\chi^{2}_{1}$ distribution, is a known statistical constant, the retrieval of which is part of standard scientific knowledge, not a missing piece of data.\n-   **Objectivity**: The problem is stated in precise, objective language, free of any subjective or speculative content.\n\n**Step 3: Verdict and Action**\nThe problem is deemed **valid**. It is a straightforward computational exercise based on established principles of statistical genetics. We may proceed with the solution.\n\n**Solution Derivation**\n\nThe task is to compute the genomic inflation factor $\\lambda$ for two scenarios: a null scenario and a stratified scenario. The calculation requires three components: the median of the observed $\\chi^{2}$ statistics for each scenario and the theoretical median of a $\\chi^{2}$ distribution with $1$ degree of freedom.\n\nFirst, we determine the theoretical median, $\\operatorname{median}\\!\\left(\\chi^{2}_{1,\\text{null}}\\right)$. A random variable $X$ that follows a chi-square distribution with one degree of freedom ($X \\sim \\chi^{2}_{1}$) can be represented as the square of a standard normal random variable, $X = Z^2$, where $Z \\sim N(0,1)$. The median of $X$ is the value $m$ such that $P(X \\le m) = 0.5$. This is equivalent to $P(Z^2 \\le m) = 0.5$, which simplifies to $P(-\\sqrt{m} \\le Z \\le \\sqrt{m}) = 0.5$.\n\nLet $\\Phi(z)$ be the cumulative distribution function (CDF) of the standard normal distribution. Then, $P(-\\sqrt{m} \\le Z \\le \\sqrt{m}) = \\Phi(\\sqrt{m}) - \\Phi(-\\sqrt{m})$. Due to the symmetry of the normal distribution, $\\Phi(-z) = 1 - \\Phi(z)$, so the expression becomes $2\\Phi(\\sqrt{m}) - 1$.\nWe set this equal to $0.5$:\n$$2\\Phi(\\sqrt{m}) - 1 = 0.5$$\n$$\\Phi(\\sqrt{m}) = \\frac{1.5}{2} = 0.75$$\nTherefore, $\\sqrt{m}$ is the $0.75$-quantile of the standard normal distribution, often denoted $z_{0.75}$. The median $m$ is the square of this quantile.\n$$m = \\left(z_{0.75}\\right)^2$$\nThe value of $z_{0.75}$ is a standard statistical constant, approximately $0.67449$.\n$$\\operatorname{median}\\!\\left(\\chi^{2}_{1,\\text{null}}\\right) = (0.67449)^2 \\approx 0.454936$$\n\nNext, we compute the median of the observed $\\chi^{2}$ statistics for each scenario. For both scenarios, the number of observations is $n = 21$, which is an odd number. For a sorted dataset of size $n$, the median is the value at position $\\frac{n+1}{2}$.\nFor $n = 21$, the median is the value at position $\\frac{21+1}{2} = 11$.\n\nFor the **null scenario**, the provided list of statistics is already sorted in ascending order. The $11^{th}$ value is $0.46$.\n$$\\operatorname{median}(\\chi^{2}_{\\text{obs, null}}) = 0.46$$\n\nFor the **stratified scenario**, the list is also sorted. The $11^{th}$ value is $0.828$.\n$$\\operatorname{median}(\\chi^{2}_{\\text{obs, stratified}}) = 0.828$$\n\nNow we apply the formula for $\\lambda$ to each scenario.\n\nFor the null scenario:\n$$\\lambda_{\\text{null}} = \\frac{\\operatorname{median}(\\chi^{2}_{\\text{obs, null}})}{\\operatorname{median}(\\chi^{2}_{1,\\text{null}})} = \\frac{0.46}{0.454936} \\approx 1.01113$$\nRounding to $4$ significant figures, we get $\\lambda_{\\text{null}} = 1.011$. This value is very close to $1$, which is expected under the null hypothesis of no population stratification.\n\nFor the stratified scenario:\n$$\\lambda_{\\text{stratified}} = \\frac{\\operatorname{median}(\\chi^{2}_{\\text{obs, stratified}})}{\\operatorname{median}(\\chi^{2}_{1,\\text{null}})} = \\frac{0.828}{0.454936} \\approx 1.82001$$\nRounding to $4$ significant figures, we get $\\lambda_{\\text{stratified}} = 1.820$. This value is substantially greater than $1$, indicating a systematic inflation of the test statistics, consistent with the presence of population structure.\n\nThe final answer is the row matrix containing these two values.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.011 & 1.820\n\\end{pmatrix}\n}\n$$"
        }
    ]
}