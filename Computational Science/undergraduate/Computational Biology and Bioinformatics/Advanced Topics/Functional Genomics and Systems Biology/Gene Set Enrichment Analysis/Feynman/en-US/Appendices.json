{
    "hands_on_practices": [
        {
            "introduction": "At the heart of Gene Set Enrichment Analysis (GSEA) is the calculation of an Enrichment Score ($ES$) from a running sum. To truly grasp how this works, it is invaluable to consider a simplified case. This exercise challenges you to derive the $ES$ for a gene set containing just a single gene, revealing the direct relationship between a gene's rank and the behavior of the GSEA algorithm .",
            "id": "2393962",
            "problem": "Consider Gene Set Enrichment Analysis (GSEA) applied to a ranked list of genes. Let there be a ranked list $\\mathcal{L}$ of $N$ distinct genes ordered from rank $1$ (top) to rank $N$ (bottom). Let the gene set $\\mathcal{S}$ contain exactly one gene (so $N_H = |\\mathcal{S}| = 1$), and suppose that this gene appears at rank $k \\in \\{1,2,\\dots,N\\}$ in $\\mathcal{L}$. Use the standard weighted running-sum definition of GSEA with exponent $p \\ge 0$: when scanning down the list from $i=1$ to $i=N$, define the running sum $R(i)$ as follows. If the $i$-th ranked gene is in $\\mathcal{S}$, increase $R(i)$ by $|r_i|^{p} / NR$, where $NR = \\sum_{g \\in \\mathcal{S}} |r_g|^{p}$, and if it is not in $\\mathcal{S}$, decrease $R(i)$ by $1/(N - N_H)$. Define the Enrichment Score ($ES$) to be the maximum value of the running sum encountered along the walk, i.e., $ES = \\max_{1 \\le i \\le N} R(i)$. Express $ES$ solely as a closed-form function of $N$ and $k$. No numerical evaluation or rounding is required, and no units are to be reported.",
            "solution": "The problem as stated is subject to validation.\n\n**Step 1: Extract Givens**\n- A ranked list $\\mathcal{L}$ of $N$ distinct genes. Ranks are from $1$ to $N$.\n- A gene set $\\mathcal{S}$ with size $N_H = |\\mathcal{S}| = 1$.\n- The single gene in $\\mathcal{S}$ is located at rank $k$, where $k \\in \\{1, 2, \\dots, N\\}$.\n- The GSEA exponent is $p \\ge 0$.\n- The running sum $R(i)$ is computed by scanning from $i=1$ to $i=N$.\n- If the $i$-th gene is in $\\mathcal{S}$ (a \"hit\"), the increment is $|r_i|^p / NR$. The term $r_i$ denotes the correlation or metric value for the gene at rank $i$.\n- $NR$ is defined as $NR = \\sum_{g \\in \\mathcal{S}} |r_g|^p$.\n- If the $i$-th gene is not in $\\mathcal{S}$ (a \"miss\"), the decrement is $1/(N - N_H)$.\n- The Enrichment Score is $ES = \\max_{1 \\le i \\le N} R(i)$.\n- The initial condition is implicitly $R(0)=0$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, as it is based on the well-established Gene Set Enrichment Analysis (GSEA) methodology. The setup with a single-gene set ($N_H=1$) is a simplification that renders the problem analytically tractable, but does not violate any fundamental principles. The problem is well-posed and objective.\n\nA potential ambiguity regarding the correlation values $r_i$ is resolved by careful inspection of the definitions. Since the gene set $\\mathcal{S}$ contains only one gene, which is at rank $k$, let its associated metric value be $r_k$. The normalization factor $NR$ is then $NR = \\sum_{g \\in \\mathcal{S}} |r_g|^p = |r_k|^p$. The increment for a hit, which occurs only at step $i=k$, is calculated as $|r_k|^p / NR = |r_k|^p / |r_k|^p = 1$. This holds for $p > 0$ under the reasonable assumption that the metric value $r_k$ is non-zero. For the case $p=0$, which corresponds to the unweighted GSEA statistic, the increment is $|r_k|^0 / NR = 1 / \\sum_{g \\in \\mathcal{S}} |r_g|^0 = 1 / N_H = 1/1 = 1$. Thus, for any $p \\ge 0$, the increment at a hit is precisely $1$.\n\nThe decrement for a miss is given by $1/(N-N_H)$. With $N_H=1$, this is $1/(N-1)$. This term is undefined if $N=1$. However, if $N=1$, then $N_H=1$ and the set of \"misses\" is empty. The problem implicitly assumes $N > 1$ for the decrement step to be meaningful, which is a standard condition in such analyses. The problem is therefore deemed self-contained and consistent.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A solution will be derived.\n\n**Derivation of the Solution**\nWe define the running sum $R(i)$ starting from $R(0)=0$. The change in the running sum at each step $j \\in \\{1, 2, \\dots, N\\}$ is $\\Delta_j$.\nA \"hit\" occurs only at rank $i=k$. The increment is $\\Delta_k = 1$.\nA \"miss\" occurs at any rank $i \\neq k$. The decrement is $-\\frac{1}{N-N_H}$. Since $N_H=1$, the decrement is $-\\frac{1}{N-1}$.\nSo, $\\Delta_j = 1$ if $j=k$, and $\\Delta_j = -\\frac{1}{N-1}$ if $j \\neq k$.\n\nThe running sum at step $i$ is given by $R(i) = \\sum_{j=1}^{i} \\Delta_j$. We analyze $R(i)$ in three cases based on the value of $i$ relative to $k$.\n\nCase 1: $1 \\le i < k$.\nIn this range, every step is a \"miss\".\n$$R(i) = \\sum_{j=1}^{i} \\left(-\\frac{1}{N-1}\\right) = i \\left(-\\frac{1}{N-1}\\right) = -\\frac{i}{N-1}$$\nSince $i \\ge 1$ and $N > 1$, all values of $R(i)$ in this range are negative. The function is strictly decreasing with $i$. The value just before the hit is $R(k-1) = -\\frac{k-1}{N-1}$.\n\nCase 2: $i=k$.\nThe running sum includes $k-1$ misses and one hit at step $k$.\n$$R(k) = R(k-1) + \\Delta_k = -\\frac{k-1}{N-1} + 1 = \\frac{-(k-1) + (N-1)}{N-1} = \\frac{N-k}{N-1}$$\nSince $1 \\le k \\le N$, we have $0 \\le N-k \\le N-1$, so $0 \\le R(k) \\le 1$.\n\nCase 3: $k < i \\le N$.\nThe running sum at step $i$ is the sum at step $k$ plus the decrements for all steps from $k+1$ to $i$. There are $i-k$ such steps, all of which are misses.\n$$R(i) = R(k) + \\sum_{j=k+1}^{i} \\left(-\\frac{1}{N-1}\\right) = R(k) - \\frac{i-k}{N-1}$$\nSubstituting the expression for $R(k)$:\n$$R(i) = \\frac{N-k}{N-1} - \\frac{i-k}{N-1} = \\frac{(N-k) - (i-k)}{N-1} = \\frac{N-i}{N-1}$$\nFor this range $k < i \\le N$, as $i$ increases, $N-i$ decreases, so $R(i)$ is a strictly decreasing function of $i$. The sequence of values starts at $R(k+1) = \\frac{N-(k+1)}{N-1}$ and ends at $R(N) = \\frac{N-N}{N-1}=0$.\n\nTo find the Enrichment Score, $ES = \\max_{1 \\le i \\le N} R(i)$, we must find the maximum value among the expressions for $R(i)$.\n- For $1 \\le i < k$, $R(i) = -i/(N-1) < 0$.\n- For $i \\ge k$, $R(i) = (N-i)/(N-1)$ for $i>k$ and $R(k)=(N-k)/(N-1)$. Since $i>k$, $N-i < N-k$, which implies $R(i) < R(k)$ for all $i > k$ (assuming $N-1>0$).\nThe sequence of values $R(i)$ for $i \\ge k$ is $R(k), R(k+1), \\dots, R(N)$, which is a strictly decreasing sequence.\nThus, the maximum value in the range $i \\ge k$ is $R(k)$.\nSince all values for $i<k$ are negative and $R(k) \\ge 0$, the global maximum over $1 \\le i \\le N$ must be $R(k)$.\n\nTherefore, the Enrichment Score is:\n$$ES = R(k) = \\frac{N-k}{N-1}$$\nThis expression is a closed-form function dependent only on $N$ and $k$, as required.\nFor verification, if the gene is ranked first ($k=1$), $ES = \\frac{N-1}{N-1} = 1$, the maximum possible score. If the gene is ranked last ($k=N$), $ES = \\frac{N-N}{N-1} = 0$. In this case, $R(i) = -i/(N-1)$ for $i < N$, all negative, and $R(N)=0$, so the maximum is indeed $0$. The result is consistent.",
            "answer": "$$\\boxed{\\frac{N-k}{N-1}}$$"
        },
        {
            "introduction": "An enrichment score, no matter how large, is meaningless without statistical context. GSEA establishes significance by comparing the observed score to a null distribution generated via phenotype permutations. This practice explores a fundamental property of this method: the resolution of the $p$-value is limited by the number of permutations performed . Calculating the smallest possible non-zero $p$-value for a given number of permutations will clarify your understanding of how significance is estimated and reported.",
            "id": "2393990",
            "problem": "You are analyzing a differential expression experiment using Gene Set Enrichment Analysis (GSEA). You generate a null distribution for the enrichment score by permuting phenotype labels exactly $M = 10000$ times. Let $b$ denote the number of permuted enrichment scores that are at least as extreme as the observed enrichment score for a given gene set. To avoid zero probability estimates in finite samples, you estimate the empirical $p$-value using the add-one estimator\n$$\n\\hat{p} \\;=\\; \\frac{b + 1}{M + 1}.\n$$\nAssuming this estimator is used and that $b$ can only take nonnegative integer values, what is the smallest possible non-zero value of $\\hat{p}$ you can obtain when $M = 10000$? Express your answer as an exact fraction. No rounding is required.",
            "solution": "The problem requires the determination of the smallest possible non-zero value for an estimated empirical $p$-value, denoted as $\\hat{p}$. The estimation is performed in the context of a Gene Set Enrichment Analysis (GSEA) using a permutation-based null distribution.\n\nFirst, I shall conduct a validation of the problem statement.\n\nStep 1: Extract Givens.\n- The number of permutations is $M = 10000$.\n- The variable $b$ represents the number of permuted enrichment scores that are at least as extreme as the observed enrichment score.\n- The constraint on $b$ is that it must be a non-negative integer, i.e., $b \\in \\{0, 1, 2, \\dots\\}$.\n- The estimator for the empirical $p$-value is given by the formula $\\hat{p} = \\frac{b + 1}{M + 1}$.\n\nStep 2: Validate Using Extracted Givens.\nThe problem is scientifically grounded. The use of permutation testing to generate a null distribution for enrichment scores is a standard and robust method in bioinformatics. The provided estimator, $\\hat{p} = \\frac{b + 1}{M + 1}$, is a well-known technique called the \"add-one\" or Laplace smoothing rule, used to avoid reporting $p$-values of $0$, which is an artifact of finite sampling. The problem is well-posed, with all necessary information provided and no contradictions. The language is objective and unambiguous. It is a straightforward mathematical problem derived from a valid scientific context.\n\nStep 3: Verdict and Action.\nThe problem is valid. I will proceed with the solution.\n\nThe expression for the estimated $p$-value is\n$$\n\\hat{p} \\;=\\; \\frac{b + 1}{M + 1}\n$$\nWe are given the number of permutations, $M = 10000$. Substituting this value into the expression gives:\n$$\n\\hat{p} \\;=\\; \\frac{b + 1}{10000 + 1} \\;=\\; \\frac{b + 1}{10001}\n$$\nThe problem states that $b$ is a non-negative integer. This means the set of possible values for $b$ is $b \\in \\{0, 1, 2, 3, \\dots\\}$.\n\nWe are asked to find the smallest possible non-zero value of $\\hat{p}$. The value of $\\hat{p}$ is a function of $b$. The denominator, $10001$, is a positive constant. Therefore, to minimize the value of the fraction $\\hat{p}$, we must minimize the value of its numerator, which is $b + 1$.\n\nThe expression $b+1$ is minimized when $b$ itself is minimized. According to the problem constraints, the smallest possible value for the non-negative integer $b$ is $0$.\n\nLet us substitute the minimum value of $b$ into the expression for $\\hat{p}$:\nWhen $b = 0$,\n$$\n\\hat{p}_{min} \\;=\\; \\frac{0 + 1}{10001} \\;=\\; \\frac{1}{10001}\n$$\nThis value, $\\frac{1}{10001}$, is clearly non-zero. For any other allowed value of $b$, such as $b=1, 2, 3, \\dots$, the numerator $b+1$ will be larger. For example, if $b=1$, then $\\hat{p} = \\frac{1+1}{10001} = \\frac{2}{10001}$. Since $\\frac{1}{10001} < \\frac{2}{10001}$ and so on for all $b > 0$, the value calculated for $b=0$ is indeed the smallest possible value for $\\hat{p}$.\n\nThe problem requires the answer as an exact fraction, which $\\frac{1}{10001}$ is.",
            "answer": "$$\\boxed{\\frac{1}{10001}}$$"
        },
        {
            "introduction": "Interpreting the results of a GSEA run requires distinguishing between the magnitude of an effect and its statistical significance, a nuance that can be challenging. This exercise presents a common but seemingly paradoxical scenario: a gene set with a very high Enrichment Score ($ES$) that nonetheless has a high, non-significant False Discovery Rate ($FDR$) . By exploring the reasons behind this outcome, you will develop the critical skill of interpreting GSEA results in the context of multiple hypothesis testing and biological complexity.",
            "id": "2393971",
            "problem": "You run Gene Set Enrichment Analysis (GSEA) on a ranked list of genes derived from a case–control study. For one biological pathway (gene set), the Enrichment Score ($ES$) is reported near $1$ (for example, $ES \\approx 0.95$), but the False Discovery Rate (FDR) for that pathway is high (for example, $FDR > 0.25$). In GSEA, the Enrichment Score ($ES$) summarizes the degree to which the genes in a set are concentrated at the top or bottom of the ranked list, and the False Discovery Rate (FDR) estimates the expected proportion of false positives among findings at least as extreme, accounting for multiple testing across all gene sets. Which statements best explain how this result is possible and what it implies?\n\nA. A large $ES$ indicates strong concentration of the set’s genes near one end of the ranked list, but a high $FDR$ can arise if many gene sets (or phenotype label permutations) attain similar or larger scores; after correcting for multiple testing, the observed enrichment is not statistically significant.\n\nB. This discrepancy occurs only because the number of permutations is too small; as the number of permutations increases, a large $ES$ will always yield a small $FDR$, so the pathway is in fact significantly enriched.\n\nC. Overlap and co-regulation among gene sets can cause many sets to achieve high scores under the observed ranking, inflating the across-set null and increasing $FDR$; the signal is non-specific and may reflect a broad shift rather than pathway-specific enrichment.\n\nD. Because $ES \\in [-1,1]$, values near $1$ guarantee statistical significance; therefore an $FDR > 0.25$ with $ES \\approx 1$ indicates a computational error.\n\nE. Small gene sets can attain extreme $ES$ by chance; after normalizing by gene set size and comparing to a null built from label permutations, the score may be common for sets of similar size, resulting in high $FDR$, so no pathway-level claim should be made.",
            "solution": "The problem statement is subject to validation.\n\n**Step 1: Extract Givens**\n- Analysis Method: Gene Set Enrichment Analysis (GSEA)\n- Input Data: A ranked list of genes from a case–control study.\n- Observation: For a specific biological pathway (gene set), the Enrichment Score ($ES$) is approximately $0.95$.\n- Observation: For the same pathway, the False Discovery Rate ($FDR$) is greater than $0.25$.\n- Provided Definition of $ES$: The Enrichment Score summarizes the degree to which the genes in a set are concentrated at the top or bottom of the ranked list.\n- Provided Definition of $FDR$: The False Discovery Rate estimates the expected proportion of false positives among findings at least as extreme, accounting for multiple testing across all gene sets.\n- Question: Explain how this result ($ES \\approx 0.95$ and $FDR > 0.25$) is possible and what it implies.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientific Grounding**: The problem is grounded in the established principles of computational biology and statistics, specifically the GSEA method developed by Subramanian et al. The concepts of Enrichment Score, phenotype permutation, and False Discovery Rate correction are central to this field. The stated values ($ES \\approx 0.95$, $FDR > 0.25$) are plausible and represent a common scenario in real-world data analysis.\n- **Well-Posedness**: The problem is well-posed. It presents a non-contradictory set of observations and asks for a logical explanation based on the underlying methodology. A meaningful and specific set of explanations can be derived.\n- **Objectivity**: The problem is stated in objective, technical language.\n- **Completeness**: The problem provides sufficient information and definitions to proceed with a rigorous analysis. The apparent paradox of a high $ES$ and high $FDR$ is the core of the question, not a flaw in the setup.\n\n**Step 3: Verdict and Action**\nThe problem statement is scientifically sound, well-posed, and complete. It is therefore **valid**. The solution will proceed.\n\n**Derivation of Principles**\n\nThe Gene Set Enrichment Analysis (GSEA) methodology is built upon several key statistical concepts that must be understood to resolve the apparent discrepancy.\n\n$1$. **The Enrichment Score ($ES$)**: Given a ranked list of all genes $L$ (from most up-regulated to most down-regulated in the 'case' phenotype, for example) and a pre-defined gene set $S$, the analysis proceeds by walking down the list $L$. A running-sum statistic is calculated. This sum is increased for each gene encountered that is a member of $S$ (a 'hit') and decreased for each gene that is not (a 'miss'). The magnitude of the increment for a hit is weighted by the gene's rank correlation. The Enrichment Score, $ES$, is defined as the maximum deviation of this running-sum from zero. An $ES$ value approaching $+1$ indicates that the genes in set $S$ are predominantly found at the top of the ranked list $L$. An $ES$ approaching $-1$ indicates concentration at the bottom. An $ES$ near $0$ indicates a random distribution. The observed $ES \\approx 0.95$ correctly signifies a very strong concentration of the pathway's genes at one end of the list. It is, in essence, a measure of effect size for the gene set.\n\n$2$. **Significance Testing and the Null Distribution**: A large $ES$ is not, in itself, proof of statistical significance. The score's significance is assessed by comparing it to a null distribution. GSEA generates this null distribution by permuting the phenotype labels (case vs. control) a large number of times (e.g., $N = 1000$). For each permutation, the entire gene ranking and subsequent $ES$ calculation for the set $S$ are repeated. This creates a distribution of $ES_{null}$ scores, representing the range of scores that can be expected for this set by chance under the null hypothesis that there is no association between the gene set and the phenotype. The nominal p-value for the set $S$ is the fraction of permutations where $|ES_{null}| \\ge |ES_{obs}|$.\n\n$3$. **Correction for Multiple Hypothesis Testing (FDR)**: In a typical analysis, thousands of gene sets are tested simultaneously. This constitutes a massive multiple testing problem, which mandates a stringent correction. GSEA uses the False Discovery Rate ($FDR$) for this purpose. The procedure involves normalizing the observed $ES$ for each set to account for differences in gene set size. This is done by dividing the observed $ES$ by the mean of the absolute values of the $ES_{null}$ scores for that set, yielding a Normalized Enrichment Score ($NES$). A similar normalization is applied to all $ES_{null}$ scores for all sets. The $FDR$ is then calculated by comparing the observed $NES$ for our pathway of interest against the aggregated distribution of all $NES_{null}$ scores from all sets across all permutations. An $FDR > 0.25$ indicates that if we declare all pathways with an $NES$ at least as large as the one observed to be significant, we expect over $25\\%$ of those declarations to be false positives. By convention, this is not considered statistically significant.\n\nThe core of the problem is to explain why a large effect size ($ES \\approx 0.95$) does not translate to statistical significance ($FDR > 0.25$). This occurs when the observed (and normalized) score, while large in absolute terms, is not sufficiently extreme relative to the null distribution constructed from all tested sets and permutations.\n\n**Option-by-Option Analysis**\n\nA. A large $ES$ indicates strong concentration of the set’s genes near one end of the ranked list, but a high $FDR$ can arise if many gene sets (or phenotype label permutations) attain similar or larger scores; after correcting for multiple testing, the observed enrichment is not statistically significant.\n\nThis statement is a precise and accurate description of the GSEA multiple testing correction procedure. The $ES$ measures concentration, as stated. The statistical significance, quantified by the $FDR$, is determined by comparing the observed Normalized Enrichment Score ($NES$) to a null distribution pooled from all permutations and all tested gene sets. If many other gene sets (in the actual data) or many permuted instances (in the null model) achieve scores comparable to or greater than the one observed for the pathway in question, the finding is not exceptional. The resulting high $FDR$ correctly reflects that the enrichment is not statistically significant after accounting for the full burden of multiple tests.\n\nVerdict: **Correct**.\n\nB. This discrepancy occurs only because the number of permutations is too small; as the number of permutations increases, a large $ES$ will always yield a small $FDR$, so the pathway is in fact significantly enriched.\n\nThis statement is fundamentally flawed. Increasing the number of permutations improves the resolution and stability of the $p$-value and $FDR$ estimates, but it does not change the underlying statistical reality. If the observed enrichment is not truly significant relative to the null distribution, more permutations will simply converge on a more precise, but still high, $FDR$ value. The claim that a large $ES$ *will always* yield a small $FDR$ with enough permutations is false. It ignores the critical context of the other gene sets being tested and the results from the permutations.\n\nVerdict: **Incorrect**.\n\nC. Overlap and co-regulation among gene sets can cause many sets to achieve high scores under the observed ranking, inflating the across-set null and increasing $FDR$; the signal is non-specific and may reflect a broad shift rather than pathway-specific enrichment.\n\nThis statement provides a sophisticated and common biological explanation for the statistical phenomenon. Biological pathways are not independent; they often share genes due to functional relationships. If a set of coregulated genes is strongly perturbed and appears at the top of the ranked list, every gene set containing a substantial fraction of these genes will exhibit a high $ES$. This leads to a situation where many observed sets have high $NES$ values. The $FDR$ calculation correctly captures this non-specificity. The statistical significance of any single set is diminished because the enrichment signal is diluted across many correlated sets. Thus, the high $FDR$ implies the signal is not specific to our single pathway of interest. This is a primary reason why the scenario described in option A occurs.\n\nVerdict: **Correct**.\n\nD. Because $ES \\in [-1,1]$, values near $1$ guarantee statistical significance; therefore an $FDR > 0.25$ with $ES \\approx 1$ indicates a computational error.\n\nThis statement demonstrates a basic misunderstanding of statistical inference. The magnitude of a statistic ($ES$, an effect size) is distinct from its statistical significance ($p$-value or $FDR$). A large effect can be observed by chance, and its significance can only be judged relative to a proper null distribution and after correcting for multiple comparisons. The range of the $ES$ being $[-1, 1]$ is irrelevant to this principle. Attributing this common and well-understood statistical outcome to a \"computational error\" is unscientific and incorrect.\n\nVerdict: **Incorrect**.\n\nE. Small gene sets can attain extreme $ES$ by chance; after normalizing by gene set size and comparing to a null built from label permutations, the score may be common for sets of similar size, resulting in high $FDR$, so no pathway-level claim should be made.\n\nThis statement identifies another valid mechanism. Due to sampling variability, a small gene set can achieve a very high $ES$ if just a few of its members happen to fall at the top of the ranked list. The GSEA methodology explicitly accounts for this by normalizing the raw $ES$ to produce the $NES$. This normalization is based on the distribution of $ES$ values for sets of a similar size under permutation. If high $ES$ values are common for small sets by chance, the normalization will reduce the score's magnitude, leading to a non-extreme $NES$ and consequently a high $FDR$. The conclusion that no pathway-level claim should be made is the correct interpretation of a high $FDR$.\n\nVerdict: **Correct**.",
            "answer": "$$\\boxed{ACE}$$"
        }
    ]
}