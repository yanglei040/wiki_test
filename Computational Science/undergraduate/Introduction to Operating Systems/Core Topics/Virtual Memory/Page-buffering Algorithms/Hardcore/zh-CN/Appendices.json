{
    "hands_on_practices": [
        {
            "introduction": "为了理解系统如何处理连续的写入流，我们可以运用排队论的工具。本练习将脏页列表建模为一个基本的 $M/M/1$ 队列，让我们能从第一性原理推导出其期望长度。掌握此模型为我们分析任何缓冲系统在随机负载下的稳定性和性能提供了强大的理论视角。",
            "id": "3667425",
            "problem": "一个操作系统（OS）中的存储子系统使用一种页缓冲算法，该算法维护一个脏页的修改列表。由于应用程序的写请求，脏页会进入该修改列表。假设将页面标记为脏页的写请求遵循泊松过程到达，其速率为 $\\lambda_{w}$，并且刷新守护进程通过将脏页写回到稳定存储中来清空修改列表，其服务时间是独立同分布的指数分布，速率为 $\\mu$，每次处理一个页面。假设服务遵循先来先服务（FCFS）原则，并将修改列表的长度建模为稳态下的 $M/M/1$ 单服务器排队系统中的顾客数。\n\n仅从生灭过程的基本特征和连续时间马尔可夫链的稳态平衡出发，推导修改列表的稳态期望长度，用 $\\lambda_{w}$ 和 $\\mu$ 表示。明确陈述稳态存在的稳定性条件，并解释其在该操作系统环境下的操作意义。以 $\\lambda_{w}$ 和 $\\mu$ 的形式，提供一个单一的闭式解析表达式作为最终的期望长度。不需要数值近似。",
            "solution": "问题要求推导操作系统中脏页修改列表的稳态期望长度，该列表被建模为一个 $M/M/1$ 队列。推导必须从生灭过程的基本原理开始。\n\n首先，我们验证问题陈述。\n\n### 步骤 1：提取已知条件\n-   系统是一个页缓冲算法的修改列表。\n-   到达（使页面变脏的写请求）遵循速率为 $\\lambda_{w}$ 的泊松过程。\n-   服务器是一个将页面写入稳定存储的刷新守护进程。\n-   服务时间是独立同分布（i.i.d.）的指数分布，速率为 $\\mu$。\n-   只有一个服务器（一次处理一个页面）。\n-   服务规则是先来先服务（FCFS）。\n-   模型是稳态下的 $M/M/1$ 单服务器队列。\n-   关注的量是修改列表的稳态期望长度。\n-   推导必须从生灭过程的基本特征和稳态平衡开始。\n-   必须陈述和解释稳定性条件。\n-   最终答案必须是闭式解析表达式。\n\n### 步骤 2：使用提取的已知条件进行验证\n-   **科学依据**：该问题基于排队论，这是应用数学的一个成熟分支。$M/M/1$ 队列是一个经典的（canonical）模型，广泛用于计算机系统（包括操作系统组件）的性能分析。泊松到达和指数服务时间的假设是创建易于处理的基础模型的标准方法。该问题在科学上和数学上都是合理的。\n-   **适定性**：该问题是适定的（well-posed）。它清楚地定义了系统、模型（$M/M/1$）、参数（$\\lambda_w$, $\\mu$）和目标（从第一性原理推导系统中的期望数量）。问题指定了推导的起点，确保了在稳定性条件成立的情况下，有一条通往明确解的唯一路径。\n-   **客观性**：语言正式、精确，没有主观或模糊的术语。\n\n### 步骤 3：结论与行动\n该问题是有效的。这是一个应用于计算机科学的标准、适定的排队论问题。我们将进行完整的推导。\n\n### 推导\n\n设 $N(t)$ 是表示在时间 $t$ 修改列表中脏页数量的随机变量。问题陈述该系统可以建模为一个 $M/M/1$ 队列，这是一种连续时间马尔可夫链（CTMC）。具体来说，它是一个生灭过程，其中系统的状态是列表中的页面数，$n \\in \\{0, 1, 2, ...\\}$。\n\n生率 $\\lambda_n$ 表示从状态 $n$ 转换到状态 $n+1$ 的速率。灭率 $\\mu_n$ 表示从状态 $n$ 转换到状态 $n-1$ 的速率。\n\n-   **生**：脏页根据泊松过程以恒定速率 $\\lambda_w$ 到达，与列表中已有的页面数量无关。因此，对于所有状态 $n \\geq 0$，生率是恒定的：\n    $$ \\lambda_n = \\lambda_w \\quad \\text{for } n = 0, 1, 2, \\dots $$\n\n-   **灭**：刷新守护进程以速率 $\\mu$ 的指数服务时间一次服务一个页面。这意味着当列表不为空时（即当 $n \\ge 1$ 时），页面以速率 $\\mu$ 被完成并从列表中移除。当列表为空时（$n=0$），没有服务可以发生，因此灭率为 $0$。\n    $$ \\mu_n = \\begin{cases} \\mu  \\text{for } n = 1, 2, 3, \\dots \\\\ 0  \\text{for } n = 0 \\end{cases} $$\n\n我们关心的是系统的稳态行为。设 $p_n$ 为列表中有 $n$ 个页面的稳态概率，即 $p_n = \\lim_{t \\to \\infty} P(N(t) = n)$。在稳态下，流入任何状态 $n$ 的速率必须等于流出该状态的速率。对于生灭过程，这可以简化为细致平衡方程，该方程表明从状态 $n$ 到 $n+1$ 的转移速率必须等于从状态 $n+1$ 到 $n$ 的转移速率。\n\n$$ \\lambda_n p_n = \\mu_{n+1} p_{n+1} \\quad \\text{for } n = 0, 1, 2, \\dots $$\n\n将我们特定的生率和灭率代入这个一般平衡方程：\n对于 $n=0$: $\\lambda_0 p_0 = \\mu_1 p_1 \\implies \\lambda_w p_0 = \\mu p_1$\n对于 $n=1$: $\\lambda_1 p_1 = \\mu_2 p_2 \\implies \\lambda_w p_1 = \\mu p_2$\n对于一般的 $n \\geq 0$：\n$$ \\lambda_w p_n = \\mu p_{n+1} $$\n\n由此，我们可以建立概率 $p_n$ 的递归关系：\n$$ p_{n+1} = \\left(\\frac{\\lambda_w}{\\mu}\\right) p_n $$\n\n让我们定义流量强度（traffic intensity）$\\rho$ 为到达速率与服务速率之比：\n$$ \\rho = \\frac{\\lambda_w}{\\mu} $$\n递推关系变为：\n$$ p_{n+1} = \\rho p_n $$\n\n我们可以用 $p_0$ 来表示所有概率 $p_n$：\n$p_1 = \\rho p_0$\n$p_2 = \\rho p_1 = \\rho (\\rho p_0) = \\rho^2 p_0$\n一般地，通过归纳法：\n$$ p_n = \\rho^n p_0 \\quad \\text{for } n = 0, 1, 2, \\dots $$\n\n为了使这些概率描述一个有效的稳态分布，它们的和必须为 $1$。存在非平凡稳态的条件是这个和必须收敛。\n$$ \\sum_{n=0}^{\\infty} p_n = 1 $$\n$$ \\sum_{n=0}^{\\infty} \\rho^n p_0 = p_0 \\sum_{n=0}^{\\infty} \\rho^n = 1 $$\n\n这个和是一个几何级数，它收敛当且仅当 $|\\rho|  1$。由于速率是非负的，所以条件是 $\\rho  1$。这就是**稳定性条件**：\n$$ \\rho = \\frac{\\lambda_w}{\\mu}  1 \\implies \\lambda_w  \\mu $$\n如果这个条件成立，几何级数的和是 $\\sum_{n=0}^{\\infty} \\rho^n = \\frac{1}{1-\\rho}$。\n将此代回归一化方程：\n$$ p_0 \\left( \\frac{1}{1-\\rho} \\right) = 1 \\implies p_0 = 1 - \\rho $$\n\n现在我们得到了列表中页面数量的完整稳态概率分布：\n$$ p_n = (1-\\rho)\\rho^n \\quad \\text{for } n = 0, 1, 2, \\dots $$\n这是一个在非负整数上的几何分布。\n\n**稳定性条件 $\\lambda_w  \\mu$ 的操作意义**是，脏页生成的平均速率必须严格小于刷新守护进程将其写回稳定存储的最大平均速率。如果到达速率大于或等于服务速率（$\\lambda_w \\ge \\mu$），脏页队列将随时间无限增长，系统将变得饱和，无法达到稳态。\n\n最后，我们推导修改列表的期望长度，记为 $L$。这是表示系统中页面数量的随机变量的期望值。\n$$ L = E[N] = \\sum_{n=0}^{\\infty} n p_n $$\n代入 $p_n$ 的表达式：\n$$ L = \\sum_{n=0}^{\\infty} n (1-\\rho)\\rho^n = (1-\\rho) \\sum_{n=0}^{\\infty} n \\rho^n $$\n为了计算和 $\\sum_{n=0}^{\\infty} n \\rho^n$，我们使用几何级数的一个标准结果。考虑和 $S = \\sum_{n=0}^{\\infty} x^n = \\frac{1}{1-x}$，其中 $|x|1$。对 $x$ 求导：\n$$ \\frac{dS}{dx} = \\sum_{n=1}^{\\infty} n x^{n-1} = \\frac{d}{dx} \\left( \\frac{1}{1-x} \\right) = \\frac{1}{(1-x)^2} $$\n注意，由于 $n=0$ 项为零，求和可以从 $n=1$ 开始。两边乘以 $x$：\n$$ x \\frac{dS}{dx} = \\sum_{n=1}^{\\infty} n x^{n} = \\frac{x}{(1-x)^2} $$\n令 $x = \\rho$，我们有：\n$$ \\sum_{n=0}^{\\infty} n \\rho^n = \\frac{\\rho}{(1-\\rho)^2} $$\n将此代回 $L$ 的表达式中：\n$$ L = (1-\\rho) \\left( \\frac{\\rho}{(1-\\rho)^2} \\right) = \\frac{\\rho}{1-\\rho} $$\n\n这是用流量强度 $\\rho$ 表示的期望长度。为了用原始参数 $\\lambda_w$ 和 $\\mu$ 表示它，我们代入 $\\rho = \\frac{\\lambda_w}{\\mu}$：\n$$ L = \\frac{\\frac{\\lambda_w}{\\mu}}{1 - \\frac{\\lambda_w}{\\mu}} = \\frac{\\frac{\\lambda_w}{\\mu}}{\\frac{\\mu - \\lambda_w}{\\mu}} $$\n$$ L = \\frac{\\lambda_w}{\\mu - \\lambda_w} $$\n这就是修改列表稳态期望长度的最终闭式解析表达式，在条件 $\\lambda_w  \\mu$ 下有效。",
            "answer": "$$\\boxed{\\frac{\\lambda_{w}}{\\mu - \\lambda_{w}}}$$"
        },
        {
            "introduction": "尽管排队论描述了稳态行为，但系统设计者还必须为峰值负载做规划。本问题从抽象理论转向具体的工程计算，要求计算系统在特定时间限制内可以处理的最大写入突发。这种“餐巾纸背面”式的估算对于确定存储子系统的规模和确保其在压力下满足性能要求至关重要。",
            "id": "3667345",
            "problem": "一个缓冲式回写页面缓存会累积脏页，并定期将它们刷写到存储设备。考虑一个存储设备，其在没有干扰的情况下的持续顺序写入带宽为 $800\\,\\text{MB/s}$，其中 $1\\,\\text{MB} = 10^{6}\\,\\text{B}$。操作系统的页面刷写器，在单独运行时，由于软件和调度开销，能达到该带宽的一个恒定比例 $0.8$。在一次突发写入后清空脏页时，并发的读输入/输出 (I/O) 会消耗设备时间的恒定比例 $0.2$，剩余的时间则用于回写。页面大小为 $4\\,\\text{KiB}$，其中 $1\\,\\text{KiB} = 1024\\,\\text{B}$。假设在一次大量写入突发后，直到该突发产生的所有脏页都被刷写完成之前，不会再有新的写入操作发生，并且每个脏页都需要正好一次页面大小的顺序写入。\n\n一名操作员要求，任何脏页突发都必须在 $48\\,\\text{s}$ 内被完全清空。仅使用基本的速率-时间-工作量关系，确定在所述条件下，可以在 $48\\,\\text{s}$ 内被完全清空的最大可接受突发大小 $X_{\\max}$（以页面为单位）。将您的最终答案四舍五入到四位有效数字，并以页面为单位表示。",
            "solution": "用户希望确定在给定的时间限制内可以刷写到存储设备的脏页的最大可接受突发大小，记为 $X_{\\max}$。这个问题可以通过应用工作量、速率和时间之间的基本关系来解决：$\\text{Work} = \\text{Rate} \\times \\text{Time}$。在此背景下，“工作量”是指脏页中的总数据量，“速率”是指存储系统在运行条件下的有效写入带宽，而“时间”则是指用于清空该突发的指定持续时间。\n\n首先，我们定义并量化问题陈述中提供的参数。\n存储设备的理想持续顺序写入带宽是 $B_{\\text{device}} = 800\\,\\text{MB/s}$。\n问题定义了 $1\\,\\text{MB} = 10^{6}\\,\\text{B}$。因此，以字节/秒为单位的理想带宽是：\n$$B_{\\text{device}} = 800 \\times 10^{6}\\,\\text{B/s}$$\n\n由于软件和调度开销，操作系统的页面刷写器无法达到这个理想带宽。它能达到理想带宽的一个恒定比例 $f_{\\text{os}} = 0.8$。如果刷写器在没有任何其他 I/O 争用的情况下运行，其带宽为：\n$$B_{\\text{flusher}} = B_{\\text{device}} \\times f_{\\text{os}} = (800 \\times 10^{6}\\,\\text{B/s}) \\times 0.8 = 640 \\times 10^{6}\\,\\text{B/s}$$\n\n在回写过程中，存在并发的读 I/O，它消耗了设备时间的比例 $f_{\\text{read}} = 0.2$。这意味着只有剩余的时间比例可用于回写操作。可用于写入的时间比例为：\n$$f_{\\text{write}} = 1 - f_{\\text{read}} = 1 - 0.2 = 0.8$$\n\n有效写入带宽 $B_{\\text{effective}}$，是刷写器的带宽 $B_{\\text{flusher}}$ 乘以其能够实际使用设备的时间比例。这模拟了 I/O 通道的时间分割复用。\n$$B_{\\text{effective}} = B_{\\text{flusher}} \\times f_{\\text{write}} = (640 \\times 10^{6}\\,\\text{B/s}) \\times 0.8 = 512 \\times 10^{6}\\,\\text{B/s}$$\n这是脏页数据可以被写入存储设备的实际速率。\n\n问题要求整个脏页突发必须在 $T_{\\text{drain}} = 48\\,\\text{s}$ 的时间段内被清空。在此时间内，以有效带宽可以写入的总数据量 $W_{\\text{total}}$ 为：\n$$W_{\\text{total}} = B_{\\text{effective}} \\times T_{\\text{drain}} = (512 \\times 10^{6}\\,\\text{B/s}) \\times 48\\,\\text{s}$$\n$$W_{\\text{total}} = 24576 \\times 10^{6}\\,\\text{B}$$\n\n这个总数据量对应于 $X_{\\max}$ 个脏页的突发量。单个页面的大小 $S_{\\text{page}}$ 给定为 $4\\,\\text{KiB}$，其中定义 $1\\,\\text{KiB} = 1024\\,\\text{B}$。\n$$S_{\\text{page}} = 4 \\times 1024\\,\\text{B} = 4096\\,\\text{B}$$\n\n总工作量也是页面数量乘以每页的大小：$W_{\\text{total}} = X_{\\max} \\times S_{\\text{page}}$。我们现在可以求解 $X_{\\max}$：\n$$X_{\\max} = \\frac{W_{\\text{total}}}{S_{\\text{page}}}$$\n代入计算出的值：\n$$X_{\\max} = \\frac{24576 \\times 10^{6}\\,\\text{B}}{4096\\,\\text{B}}$$\n我们进行除法运算：\n$$\\frac{24576}{4096} = 6$$\n因此，最大可接受的突发大小是：\n$$X_{\\max} = 6 \\times 10^{6}\\,\\text{pages}$$\n\n问题要求最终答案四舍五入到四位有效数字。确切答案是 $6,000,000$。为了用四位有效数字表示这个值，我们将其写成科学记数法形式 $6.000 \\times 10^{6}$。",
            "answer": "$$\\boxed{6.000 \\times 10^6}$$"
        },
        {
            "introduction": "一个健壮的系统不仅要在正常条件下表现良好，还必须能从诸如内存突然耗尽等紧急情况中优雅地恢复。本练习模拟了一个在可用内存降至临界阈值以下时激活的紧急页面回收器。通过分析此场景，我们学习如何量化恢复机制的有效性，并预测系统恢复到安全状态的速度。",
            "id": "3667406",
            "problem": "一个使用页面缓冲算法的操作系统维护着一个空闲页面池，该池设有一个低水位阈值 $F_{\\min}$。当可用空闲页面数 $F(t)$ 降至 $F_{\\min}$ 以下时，会触发紧急回收机制。在时刻 $t=0$ 时，一次突发的内存压力峰值导致空闲池中的页面数降至 $F(0)=F_{0}$，其中 $F_{0}  F_{\\min}$。当激活时，紧急回收机制会部署 $k$ 个并行的回收器线程，它们共同以总吞吐量 $\\mu$ 释放页面。同时，其他系统活动继续以恒定速率 $a$ 分配空闲页面。假设在紧急阶段，回收吞吐量 $\\mu$ 和分配速率 $a$ 都是常数，并且 $\\mu  a$ 以确保能够恢复。每个回收器线程独立地检查内存中的候选页面。对于每个候选页面，页面是干净的概率为 $q$，是脏的概率为 $1-q$。释放一个干净页面需要时间 $t_c$；跳过一个脏页面需要时间 $t_s$。\n\n首先，推导总回收吞吐量 $\\mu$ 的表达式，用 $k, q, t_c, t_s$ 表示。然后，推导恢复时间 $t_{\\text{rec}}$ 的表达式，即空闲池大小从 $F_0$ 恢复到 $F_{\\min}$ 所需的时间。最后，使用以下参数计算 $t_{\\text{rec}}$ 的数值（以秒为单位），并四舍五入到四位有效数字：$F_{\\min}=2000$ 页，$F_{0}=500$ 页，$a = 2.0 \\times 10^{4}$ 页/秒，$k=8$，$q=0.6$，$t_c=1.5\\times 10^{-4}$ 秒，$t_s=1.0\\times 10^{-5}$ 秒。",
            "solution": "问题陈述已经过验证，被认为是有效的。它在科学上基于操作系统内存管理和性能建模的原理，问题阐述清晰，目标明确，信息充分，语言客观。该问题是一个应用概率和速率分析基本原理的可形式化的练习。\n\n第一个任务是推导总回收吞吐量 $\\mu$ 的表达式。这是 $k$ 个回收器线程释放干净页面的总速率。我们首先考虑单个回收器线程。\n\n单个线程重复处理候选页面。对于每个候选页面，有两种可能的结果：\n1.  页面是干净的，概率为 $q$。在这种情况下，页面被释放，所用时间为 $t_{c}$。一个页面被成功回收。\n2.  页面是脏的，概率为 $1-q$。在这种情况下，页面被跳过，所用时间为 $t_{s}$。回收了零个页面。\n\n单个线程处理一个候选页面的期望时间 $E[T]$ 是每种结果所用时间的加权平均值：\n$$E[T] = q \\cdot t_{c} + (1-q) \\cdot t_{s}$$\n每个处理的候选页面所释放的期望页面数 $E[P]$ 为：\n$$E[P] = q \\cdot 1 + (1-q) \\cdot 0 = q$$\n单个线程的吞吐量 $\\mu_{1}$ 是释放页面的速率，即每单位时间释放的期望页面数。根据更新回报定理，该速率是每个周期的期望回报（释放的页面数）与每个周期的期望持续时间（处理每个候选页面的时间）之比。\n$$\\mu_{1} = \\frac{E[P]}{E[T]} = \\frac{q}{q t_{c} + (1-q) t_{s}}$$\n问题陈述中有 $k$ 个相同的线程无竞争地运行。因此，总回收吞吐量 $\\mu$ 就是单个线程吞吐量的 $k$ 倍：\n$$\\mu = k \\cdot \\mu_{1} = \\frac{k q}{q t_{c} + (1-q) t_{s}}$$\n第二个任务是推导恢复时间 $t_{\\text{rec}}$ 的表达式。空闲页面数 $F(t)$ 的演变由给定的确定性速率方程决定：\n$$\\frac{dF}{dt} = \\mu - a$$\n由于在紧急阶段 $\\mu$ 和 $a$ 是常数，空闲页面的净变化率 $\\mu - a$ 也是常数。我们可以通过直接积分来求解这个一阶常微分方程。我们从紧急阶段的开始时刻 $t=0$ 积分到结束时刻 $t=t_{\\text{rec}}$：\n$$\\int_{F(0)}^{F(t_{\\text{rec}})} dF = \\int_{0}^{t_{\\text{rec}}} (\\mu - a) dt$$\n计算该积分可得：\n$$F(t)\\Big|_{F(0)}^{F(t_{\\text{rec}})} = (\\mu - a) t \\Big|_{0}^{t_{\\text{rec}}}$$\n$$F(t_{\\text{rec}}) - F(0) = (\\mu - a) t_{\\text{rec}}$$\n问题定义了初始条件为 $F(0) = F_{0}$，最终条件为 $F(t_{\\text{rec}}) = F_{\\min}$。将这些代入方程得到：\n$$F_{\\min} - F_{0} = (\\mu - a) t_{\\text{rec}}$$\n解出 $t_{\\text{rec}}$，我们得到：\n$$t_{\\text{rec}} = \\frac{F_{\\min} - F_{0}}{\\mu - a}$$\n这个表达式仅在 $\\mu > a$ 时才有物理意义，这意味着回收速率必须超过分配速率，空闲池才能恢复。代入推导出的 $\\mu$ 的表达式：\n$$t_{\\text{rec}} = \\frac{F_{\\min} - F_{0}}{\\frac{k q}{q t_{c} + (1-q) t_{s}} - a}$$\n最后一个任务是根据给定的数值参数计算 $t_{\\text{rec}}$：\n$F_{\\min} = 2000$ 页\n$F_{0} = 500$ 页\n$a = 2.0 \\times 10^{4}$ 页/秒\n$k = 8$\n$q = 0.6$\n$t_{c} = 1.5 \\times 10^{-4}$ 秒\n$t_{s} = 1.0 \\times 10^{-5}$ 秒\n\n首先，我们计算总回收吞吐量 $\\mu$。单个线程处理每个候选页面的平均时间是：\n$$E[T] = (0.6)(1.5 \\times 10^{-4}) + (1-0.6)(1.0 \\times 10^{-5})$$\n$$E[T] = (0.6)(1.5 \\times 10^{-4}) + (0.4)(1.0 \\times 10^{-5})$$\n$$E[T] = 9.0 \\times 10^{-5} + 0.4 \\times 10^{-5} = 9.4 \\times 10^{-5} \\text{ 秒}$$\n那么总吞吐量 $\\mu$ 为：\n$$\\mu = \\frac{k q}{E[T]} = \\frac{8 \\times 0.6}{9.4 \\times 10^{-5}} = \\frac{4.8}{9.4 \\times 10^{-5}} \\approx 51063.83 \\text{ 页/秒}$$\n我们验证恢复是可能的：$\\mu \\approx 5.106 \\times 10^{4} > a = 2.0 \\times 10^{4}$。该条件成立。\n\n现在我们计算空闲页面池的净变化率：\n$$\\mu - a = 51063.83 - 20000 = 31063.83 \\text{ 页/秒}$$\n需要恢复的总页面数是：\n$$F_{\\min} - F_{0} = 2000 - 500 = 1500 \\text{ 页}$$\n最后，我们计算恢复时间 $t_{\\text{rec}}$：\n$$t_{\\text{rec}} = \\frac{F_{\\min} - F_{0}}{\\mu - a} = \\frac{1500}{31063.83} \\approx 0.0482880... \\text{ 秒}$$\n将结果四舍五入到四位有效数字，得到：\n$$t_{\\text{rec}} \\approx 0.04829 \\text{ 秒}$$",
            "answer": "$$\\boxed{0.04829}$$"
        }
    ]
}