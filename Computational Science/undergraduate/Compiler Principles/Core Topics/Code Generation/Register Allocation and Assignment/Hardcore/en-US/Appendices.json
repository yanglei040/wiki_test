{
    "hands_on_practices": [
        {
            "introduction": "A fundamental choice in compiler design is the scope of register allocation. Performing allocation locally, on a per-basic-block basis, is simpler to implement but can introduce significant overhead from mismatched register assignments at block boundaries. This exercise provides a concrete scenario to quantify this exact cost, asking you to calculate the number of \"reconciliation moves\" needed to patch together locally-allocated blocks, thereby demonstrating the performance motivation for more complex global register allocation strategies. ",
            "id": "3666593",
            "problem": "Consider a straight-line hot path consisting of $10$ short basic blocks $B_1 \\rightarrow B_2 \\rightarrow \\dots \\rightarrow B_{10}$ in a Control Flow Graph (CFG). Assume an architecture with $k=5$ physical registers $\\{R_1, R_2, R_3, R_4, R_5\\}$ and no spilling is required along this path. Let the variables be $\\{x_1, x_2, \\dots, x_{10}\\}$, each with a single contiguous live interval along the path (so that the interference graph induced by these live intervals on the straight-line path is an interval graph).\n\nFor each boundary $i \\in \\{1,2,\\dots,9\\}$ between $B_i$ and $B_{i+1}$, the set of variables live across that boundary is $S_i$, and independent local register allocation per block yields possibly different register assignments on the left (block exit) and right (block entry) sides of the boundary, denoted $L_i$ and $R_i$, respectively. A reconciliation move is required for each variable whose register assignment differs between $L_i$ and $R_i$; each such move is a single instruction.\n\nThe live-across-boundary sets are:\n- $S_1 = \\{x_1, x_2, x_3\\}$\n- $S_2 = \\{x_1, x_2, x_3, x_4\\}$\n- $S_3 = \\{x_1, x_3, x_4, x_5\\}$\n- $S_4 = \\{x_1, x_4, x_5, x_6\\}$\n- $S_5 = \\{x_4, x_5, x_6, x_7\\}$\n- $S_6 = \\{x_5, x_6, x_7, x_8\\}$\n- $S_7 = \\{x_6, x_7, x_8, x_9\\}$\n- $S_8 = \\{x_7, x_8, x_9, x_{10}\\}$\n- $S_9 = \\{x_8, x_9, x_{10}\\}$\n\nThe local (per-block) assignments at each boundary are:\n- Boundary $1$: $L_1:\\{x_1 \\mapsto R_1, x_2 \\mapsto R_2, x_3 \\mapsto R_3\\}$, $R_1:\\{x_1 \\mapsto R_2, x_2 \\mapsto R_3, x_3 \\mapsto R_1\\}$\n- Boundary $2$: $L_2:\\{x_1 \\mapsto R_1, x_2 \\mapsto R_2, x_3 \\mapsto R_3, x_4 \\mapsto R_4\\}$, $R_2:\\{x_1 \\mapsto R_1, x_2 \\mapsto R_3, x_3 \\mapsto R_2, x_4 \\mapsto R_4\\}$\n- Boundary $3$: $L_3:\\{x_1 \\mapsto R_1, x_3 \\mapsto R_2, x_4 \\mapsto R_3, x_5 \\mapsto R_4\\}$, $R_3:\\{x_1 \\mapsto R_1, x_3 \\mapsto R_2, x_4 \\mapsto R_4, x_5 \\mapsto R_3\\}$\n- Boundary $4$: $L_4:\\{x_1 \\mapsto R_1, x_4 \\mapsto R_2, x_5 \\mapsto R_3, x_6 \\mapsto R_4\\}$, $R_4:\\{x_1 \\mapsto R_1, x_4 \\mapsto R_2, x_5 \\mapsto R_5, x_6 \\mapsto R_3\\}$\n- Boundary $5$: $L_5:\\{x_4 \\mapsto R_2, x_5 \\mapsto R_3, x_6 \\mapsto R_4, x_7 \\mapsto R_1\\}$, $R_5:\\{x_4 \\mapsto R_2, x_5 \\mapsto R_3, x_6 \\mapsto R_4, x_7 \\mapsto R_1\\}$\n- Boundary $6$: $L_6:\\{x_5 \\mapsto R_1, x_6 \\mapsto R_2, x_7 \\mapsto R_3, x_8 \\mapsto R_4\\}$, $R_6:\\{x_5 \\mapsto R_1, x_6 \\mapsto R_2, x_7 \\mapsto R_4, x_8 \\mapsto R_3\\}$\n- Boundary $7$: $L_7:\\{x_6 \\mapsto R_1, x_7 \\mapsto R_2, x_8 \\mapsto R_3, x_9 \\mapsto R_4\\}$, $R_7:\\{x_6 \\mapsto R_2, x_7 \\mapsto R_3, x_8 \\mapsto R_4, x_9 \\mapsto R_5\\}$\n- Boundary $8$: $L_8:\\{x_7 \\mapsto R_2, x_8 \\mapsto R_3, x_9 \\mapsto R_4, x_{10} \\mapsto R_1\\}$, $R_8:\\{x_7 \\mapsto R_2, x_8 \\mapsto R_3, x_9 \\mapsto R_1, x_{10} \\mapsto R_4\\}$\n- Boundary $9$: $L_9:\\{x_8 \\mapsto R_3, x_9 \\mapsto R_1, x_{10} \\mapsto R_4\\}$, $R_9:\\{x_8 \\mapsto R_3, x_9 \\mapsto R_1, x_{10} \\mapsto R_4\\}$\n\nAssume that, under global register allocation across the entire hot path, the interference graph formed by these live intervals is colorable with at most $k=5$ colors, and coalescing is performed so that any variable that remains live across a boundary keeps a consistent register. Using the foundational definitions of liveness and interference, compute the total reconciliation move overhead across all boundaries for local allocation minus that for global allocation. Express your final answer as a single integer (no units). No rounding is required.",
            "solution": "The problem asks for the difference in reconciliation move overhead between a local and a global register allocation strategy. Let $C_{local}$ be the total overhead for the local allocation and $C_{global}$ be the total overhead for the global allocation. The final answer is $C_{local} - C_{global}$.\n\n**Step 1: Calculate the overhead for global allocation ($C_{global}$)**\n\nThe problem states that for the global allocation scheme, \"any variable that remains live across a boundary keeps a consistent register.\" This means that for any variable live at a boundary, its register assignment is the same on both sides of the boundary. By this definition, there are no mismatches, and thus zero reconciliation moves are needed.\n$$C_{global} = 0$$\n\n**Step 2: Calculate the overhead for local allocation ($C_{local}$)**\n\nThe overhead for local allocation is the total number of reconciliation moves required across all 9 boundaries. At each boundary $i$, a move is required for each variable in the live set $S_i$ whose register assignment in $L_i$ (exit of block $B_i$) differs from its assignment in $R_i$ (entry of block $B_{i+1}$). We count the number of mismatches for each boundary.\n\n- **Boundary 1:** $S_1 = \\{x_1, x_2, x_3\\}$\n  - $x_1: R_1 \\neq R_2$ (Mismatch)\n  - $x_2: R_2 \\neq R_3$ (Mismatch)\n  - $x_3: R_3 \\neq R_1$ (Mismatch)\n  - Moves = 3.\n\n- **Boundary 2:** $S_2 = \\{x_1, x_2, x_3, x_4\\}$\n  - $x_1: R_1 = R_1$ (Match)\n  - $x_2: R_2 \\neq R_3$ (Mismatch)\n  - $x_3: R_3 \\neq R_2$ (Mismatch)\n  - $x_4: R_4 = R_4$ (Match)\n  - Moves = 2.\n\n- **Boundary 3:** $S_3 = \\{x_1, x_3, x_4, x_5\\}$\n  - $x_1: R_1 = R_1$ (Match)\n  - $x_3: R_2 = R_2$ (Match)\n  - $x_4: R_3 \\neq R_4$ (Mismatch)\n  - $x_5: R_4 \\neq R_3$ (Mismatch)\n  - Moves = 2.\n\n- **Boundary 4:** $S_4 = \\{x_1, x_4, x_5, x_6\\}$\n  - $x_1: R_1 = R_1$ (Match)\n  - $x_4: R_2 = R_2$ (Match)\n  - $x_5: R_3 \\neq R_5$ (Mismatch)\n  - $x_6: R_4 \\neq R_3$ (Mismatch)\n  - Moves = 2.\n\n- **Boundary 5:** $S_5 = \\{x_4, x_5, x_6, x_7\\}$\n  - All assignments match.\n  - Moves = 0.\n\n- **Boundary 6:** $S_6 = \\{x_5, x_6, x_7, x_8\\}$\n  - $x_5: R_1 = R_1$ (Match)\n  - $x_6: R_2 = R_2$ (Match)\n  - $x_7: R_3 \\neq R_4$ (Mismatch)\n  - $x_8: R_4 \\neq R_3$ (Mismatch)\n  - Moves = 2.\n\n- **Boundary 7:** $S_7 = \\{x_6, x_7, x_8, x_9\\}$\n  - $x_6: R_1 \\neq R_2$ (Mismatch)\n  - $x_7: R_2 \\neq R_3$ (Mismatch)\n  - $x_8: R_3 \\neq R_4$ (Mismatch)\n  - $x_9: R_4 \\neq R_5$ (Mismatch)\n  - Moves = 4.\n\n- **Boundary 8:** $S_8 = \\{x_7, x_8, x_9, x_{10}\\}$\n  - $x_7: R_2 = R_2$ (Match)\n  - $x_8: R_3 = R_3$ (Match)\n  - $x_9: R_4 \\neq R_1$ (Mismatch)\n  - $x_{10}: R_1 \\neq R_4$ (Mismatch)\n  - Moves = 2.\n\n- **Boundary 9:** $S_9 = \\{x_8, x_9, x_{10}\\}$\n  - All assignments match.\n  - Moves = 0.\n\nThe total number of moves for local allocation is the sum of moves at each boundary:\n$$C_{local} = 3 + 2 + 2 + 2 + 0 + 2 + 4 + 2 + 0 = 17$$\n\n**Step 3: Calculate the final difference**\n\nThe required value is the difference between the local and global allocation overheads.\n$$ \\text{Difference} = C_{local} - C_{global} = 17 - 0 = 17 $$",
            "answer": "$$\n\\boxed{17}\n$$"
        },
        {
            "introduction": "Global register allocation is often modeled as a graph coloring problem, but what happens when we don't have enough colors (registers)? The allocator must \"spill\" a variable to memory, but the choice of which variable to spill is a critical heuristic decision. This practice delves into that choice, challenging you to compare two common strategies—one based on spill cost and another on graph connectivity—and see how they can lead to dramatically different outcomes for the exact same program. ",
            "id": "3666504",
            "problem": "Consider register allocation via interference graph coloring with $K$ available machine registers, where $K=3$. The interference graph is constructed by standard liveness analysis and has vertices representing live ranges $v_a$, $v_b$, $v_c$, $v_d$, $v_e$, $v_{x_1}$, $v_{x_2}$, $v_{x_3}$, $v_{y_1}$, $v_{y_2}$, and $v_{y_3}$. Adjacency is defined as follows:\n\n- The subgraph induced by $\\{v_a, v_b, v_c, v_d\\}$ is a complete graph $K_4$, i.e., each of $v_a$, $v_b$, $v_c$, and $v_d$ interferes with the other three.\n- The vertex $v_e$ interferes with $v_a$, $v_b$, $v_{x_1}$, $v_{x_2}$, $v_{x_3}$, $v_{y_1}$, $v_{y_2}$, and $v_{y_3}$.\n- The vertices $\\{v_{x_1}, v_{x_2}, v_{x_3}\\}$ and $\\{v_{y_1}, v_{y_2}, v_{y_3}\\}$ form a complete bipartite subgraph $K_{3,3}$: for all $i \\in \\{1,2,3\\}$ and $j \\in \\{1,2,3\\}$, $v_{x_i}$ interferes with $v_{y_j}$. There are no other interferences beyond those stated.\n\nAssume no precolored vertices, no coalescing, and no live range splitting. A spill incurs a scalar cost $c(v)$ that adds linearly to the total spill cost. The per-vertex spill costs are:\n$c(v_a)=7$, $c(v_b)=6$, $c(v_c)=5$, $c(v_d)=1$, $c(v_e)=9$, and $c(v_{x_1})=c(v_{x_2})=c(v_{x_3})=c(v_{y_1})=c(v_{y_2})=c(v_{y_3})=3$.\n\nUse the following two deterministic heuristics to choose spill candidates when no vertex has degree strictly less than $K$:\n\n- Heuristic $\\mathcal{H}_{\\text{cost}}$: choose the vertex with the smallest spill cost $c(v)$. Ties are broken alphabetically by the vertex name.\n- Heuristic $\\mathcal{H}_{\\text{degree}}$: choose the vertex of maximum degree in the current interference graph. Ties are broken alphabetically by the vertex name.\n\nAt each step, if any vertex has degree strictly less than $K$, that vertex may be simplified (pushed on the stack) rather than spilled; otherwise, a single vertex is spilled according to the heuristic, removed from the graph, and the process repeats. When the remaining graph becomes $K$-colorable, allocation proceeds without further spills. Ignore any runtime costs beyond $c(v)$ and assume that each spilled vertex contributes exactly its $c(v)$ once to the total.\n\nCompute, for the described graph and costs, the difference $\\Delta$ between the total spill cost obtained under $\\mathcal{H}_{\\text{degree}}$ and the total spill cost obtained under $\\mathcal{H}_{\\text{cost}}$, where\n$$\n\\Delta = \\text{total\\_spill\\_cost}(\\mathcal{H}_{\\text{degree}}) - \\text{total\\_spill\\_cost}(\\mathcal{H}_{\\text{cost}}).\n$$\nProvide your final answer as a single real-valued number. No rounding is required.",
            "solution": "To solve this problem, we must simulate the register allocation process for two different spill heuristics and calculate the total spill cost for each. The number of registers is $K=3$.\n\n**Step 1: Initial Graph Analysis**\n\nFirst, let's compute the degree of each vertex in the initial interference graph:\n- $\\text{deg}(v_a) = 4$ (neighbors: $v_b, v_c, v_d, v_e$)\n- $\\text{deg}(v_b) = 4$ (neighbors: $v_a, v_c, v_d, v_e$)\n- $\\text{deg}(v_c) = 3$ (neighbors: $v_a, v_b, v_d$)\n- $\\text{deg}(v_d) = 3$ (neighbors: $v_a, v_b, v_c$)\n- $\\text{deg}(v_e) = 8$ (neighbors: $v_a, v_b, v_{x_1}, v_{x_2}, v_{x_3}, v_{y_1}, v_{y_2}, v_{y_3}$)\n- $\\text{deg}(v_{x_i})$ for $i \\in \\{1,2,3\\} = 4$ (neighbors: $v_e, v_{y_1}, v_{y_2}, v_{y_3}$)\n- $\\text{deg}(v_{y_j})$ for $j \\in \\{1,2,3\\} = 4$ (neighbors: $v_e, v_{x_1}, v_{x_2}, v_{x_3}$)\n\nSince all vertices have a degree of at least $K=3$, no vertex can be simplified initially. The graph is not 3-colorable because it contains a $K_4$ subgraph (on $\\{v_a, v_b, v_c, v_d\\}$), which requires 4 colors. Therefore, a spill is necessary.\n\n**Step 2: Simulation with Heuristic $\\mathcal{H}_{\\text{cost}}$**\n\n1.  **First Spill:** We must spill a vertex. $\\mathcal{H}_{\\text{cost}}$ selects the vertex with the minimum spill cost. Comparing costs, $c(v_d)=1$ is the minimum.\n    - Spill $v_d$.\n    - Spill Cost = 1.\n2.  **Graph after spilling $v_d$:** The degrees of its neighbors ($v_a, v_b, v_c$) decrease by 1.\n    - $\\text{deg}(v_a) = 3$, $\\text{deg}(v_b) = 3$, $\\text{deg}(v_c) = 2$.\n3.  **Simplify:** Now, $\\text{deg}(v_c) = 2 < 3$, so we can simplify $v_c$. After simplifying $v_c$, the degrees of its neighbors ($v_a, v_b$) decrease by 1, becoming $\\text{deg}(v_a)=2$ and $\\text{deg}(v_b)=2$. Both can now be simplified.\n4.  **Check Kernel:** After simplifying $v_c, v_a, v_b$, the remaining graph consists of vertices $\\{v_e, v_{x_1}, \\dots, v_{y_3}\\}$. This remaining graph is 3-colorable: we can assign color 1 to $v_e$, color 2 to the set $\\{v_{x_1}, v_{x_2}, v_{x_3}\\}$, and color 3 to the set $\\{v_{y_1}, v_{y_2}, v_{y_3}\\}$. This is a valid coloring since the subgraph on the $v_x, v_y$ vertices is bipartite ($K_{3,3}$).\n5.  **Conclusion:** The process stops. Only one spill was needed.\n    - Total spill cost for $\\mathcal{H}_{\\text{cost}} = c(v_d) = 1$.\n\n**Step 3: Simulation with Heuristic $\\mathcal{H}_{\\text{degree}}$**\n\n1.  **First Spill:** We must spill a vertex. $\\mathcal{H}_{\\text{degree}}$ selects the vertex with the maximum degree.\n    - $\\text{deg}(v_e) = 8$ is the unique maximum.\n    - Spill $v_e$.\n    - Spill Cost = $c(v_e) = 9$.\n2.  **Graph after spilling $v_e$:** The degrees of all its neighbors decrease by 1.\n    - $\\text{deg}(v_a) = 3$, $\\text{deg}(v_b) = 3$, $\\text{deg}(v_{x_i}) = 3$, $\\text{deg}(v_{y_j}) = 3$.\n    - The degrees of $v_c$ and $v_d$ remain 3.\n    - Now all vertices in the graph have degree 3. No simplification is possible. The graph still contains the $K_4$ subgraph and is not 3-colorable. We must spill again.\n3.  **Second Spill:** All vertices have degree 3. We use the alphabetical tie-breaker. The first vertex in alphabetical order is $v_a$.\n    - Spill $v_a$.\n    - Spill Cost = $c(v_e) + c(v_a) = 9 + 7 = 16$.\n4.  **Graph after spilling $v_a$:** The degrees of its neighbors ($v_b, v_c, v_d$) decrease by 1.\n    - $\\text{deg}(v_b) = 2$, $\\text{deg}(v_c) = 2$, $\\text{deg}(v_d) = 2$.\n5.  **Simplify:** Now $v_b, v_c, v_d$ can all be simplified since their degrees are less than 3.\n6.  **Check Kernel:** After simplifying these, the remaining graph is the $K_{3,3}$ on $\\{v_{x_1}, \\dots, v_{y_3}\\}$. This graph is 2-colorable, and thus 3-colorable.\n7.  **Conclusion:** The process stops. Two spills were needed.\n    - Total spill cost for $\\mathcal{H}_{\\text{degree}} = 16$.\n\n**Step 4: Final Calculation**\n\nThe problem asks for the difference $\\Delta$.\n$$ \\Delta = \\text{total\\_spill\\_cost}(\\mathcal{H}_{\\text{degree}}) - \\text{total\\_spill\\_cost}(\\mathcal{H}_{\\text{cost}}) $$\n$$ \\Delta = 16 - 1 = 15 $$",
            "answer": "$$\n\\boxed{15}\n$$"
        },
        {
            "introduction": "We often think of spilling as a last resort, a necessary evil when register pressure is too high. This exercise reveals a more nuanced reality, exploring the strategic trade-off between spilling and another key optimization, move coalescing. You will analyze a scenario where proactively spilling a variable, despite its direct cost, can so simplify the interference graph that it enables the elimination of other instructions, potentially leading to a net performance gain. ",
            "id": "3666563",
            "problem": "Consider a single straight-line basic block in a compiler’s register allocation phase with an interference graph abstraction. You have $k = 3$ allocatable general-purpose registers. The block has temporaries $a$, $b$, $c$, $d$, and $s$. The interference graph $G$ has vertex set $\\{a,b,c,d,s\\}$ and undirected edges\n$$(a,c),\\ (a,d),\\ (a,s),\\ (b,c),\\ (b,d),\\ (b,s),\\ (c,s),\\ (d,s).$$\nThere are exactly $2$ copy (move) instructions eligible for coalescing: a move $a \\rightarrow b$ and a move $c \\rightarrow d$. By construction, there is no interference edge between $a$ and $b$, and no interference edge between $c$ and $d$.\n\nThe allocator uses the following well-tested conservative copy coalescing rule due to Briggs: a move $x \\rightarrow y$ may be coalesced if and only if $x$ and $y$ do not interfere and, after hypothetically merging $x$ and $y$, the union of their neighbors whose degrees in $G$ are at least $k$ has cardinality strictly less than $k$. If the test fails, the move cannot be coalesced.\n\nAssume that choosing to spill a single temporary removes its node and all incident edges from the interference graph before running coalescing. You are allowed to consider only two plans:\n- Plan $A$: do not spill any temporary; attempt to coalesce moves under the conservative rule.\n- Plan $B$: spill the temporary $s$; then attempt to coalesce moves under the conservative rule.\n\nSpilling $s$ in this block induces the following normalized spill latency: $s$ has $1$ definition that must be stored and $2$ uses that must be reloaded, and each memory operation contributes a cost of $1$ in the same normalized units used to count residual moves. Thus, the spill latency is $spill\\_lat = 3$. If no spill is performed, $spill\\_lat = 0$.\n\nDefine the objective as\n$$\\text{cost} \\;=\\; spill\\_lat \\;+\\; moves,$$\nwhere $moves$ is the number of remaining move instructions after applying conservative coalescing under the chosen plan, and $spill\\_lat$ is as specified above. Compute the minimal achievable cost over the two plans, and report it as a single real-valued number. No rounding is required, and no physical units are used.",
            "solution": "To find the minimal cost, we must evaluate the total cost for both Plan A and Plan B and then choose the smaller of the two. The cost is the sum of spill latency and the number of moves remaining after attempting to coalesce. We have $k=3$ registers.\n\n**Step 1: Analyze Plan A (No Spill)**\n\nIn this plan, the spill latency is $spill\\_lat_A = 0$. We work with the original interference graph $G$. First, we compute the degrees of all vertices in $G$:\n- $\\text{deg}(a) = |\\{c, d, s\\}| = 3$\n- $\\text{deg}(b) = |\\{c, d, s\\}| = 3$\n- $\\text{deg}(c) = |\\{a, b, s\\}| = 3$\n- $\\text{deg}(d) = |\\{a, b, s\\}| = 3$\n- $\\text{deg}(s) = |\\{a, b, c, d\\}| = 4$\n\nAll vertices have a degree $\\ge k=3$. These are \"significant-degree\" nodes.\n\nNow, we apply Briggs's conservative coalescing rule to the two moves.\n- **Move $a \\rightarrow b$**:\n  1. The neighbors are $N(a)=\\{c,d,s\\}$ and $N(b)=\\{c,d,s\\}$. The union is $\\{c,d,s\\}$.\n  2. We count how many of these neighbors have a degree $\\ge k=3$.\n     - $\\text{deg}(c)=3 \\ge 3$\n     - $\\text{deg}(d)=3 \\ge 3$\n     - $\\text{deg}(s)=4 \\ge 3$\n     All three neighbors have significant degree. The count is 3.\n  3. The rule requires this count to be strictly less than $k$. We check if $3  3$. This is false.\n  4. The move $a \\rightarrow b$ cannot be coalesced.\n\n- **Move $c \\rightarrow d$**:\n  1. The neighbors are $N(c)=\\{a,b,s\\}$ and $N(d)=\\{a,b,s\\}$. The union is $\\{a,b,s\\}$.\n  2. We count how many of these neighbors have a degree $\\ge k=3$.\n     - $\\text{deg}(a)=3 \\ge 3$\n     - $\\text{deg}(b)=3 \\ge 3$\n     - $\\text{deg}(s)=4 \\ge 3$\n     All three neighbors have significant degree. The count is 3.\n  3. The rule requires $3  3$, which is false.\n  4. The move $c \\rightarrow d$ cannot be coalesced.\n\nUnder Plan A, neither move is coalesced. The number of remaining moves is 2.\n- $\\text{cost}_A = spill\\_lat_A + moves_A = 0 + 2 = 2$.\n\n**Step 2: Analyze Plan B (Spill temporary `s`)**\n\nIn this plan, we first spill $s$. The spill latency is given as $spill\\_lat_B = 3$. Spilling $s$ removes it and its incident edges from the graph. The new graph $G'$ has vertices $\\{a,b,c,d\\}$. The edges connected to $s$ are removed, leaving edges $\\{(a,c), (a,d), (b,c), (b,d)\\}$.\n\nWe compute the degrees of the vertices in the new graph $G'$:\n- $\\text{deg}_{G'}(a) = |\\{c, d\\}| = 2$\n- $\\text{deg}_{G'}(b) = |\\{c, d\\}| = 2$\n- $\\text{deg}_{G'}(c) = |\\{a, b\\}| = 2$\n- $\\text{deg}_{G'}(d) = |\\{a, b\\}| = 2$\n\nNow all vertices have a degree less than $k=3$. There are no significant-degree nodes.\n\nWe apply the coalescing rule in graph $G'$.\n- **Move $a \\rightarrow b$**:\n  1. The neighbors are $N_{G'}(a)=\\{c,d\\}$ and $N_{G'}(b)=\\{c,d\\}$. The union is $\\{c,d\\}$.\n  2. We count neighbors with degree $\\ge k=3$. Since $\\text{deg}_{G'}(c)=2$ and $\\text{deg}_{G'}(d)=2$, this count is 0.\n  3. The rule requires $0  3$, which is true.\n  4. The move $a \\rightarrow b$ can be coalesced.\n\n- **Move $c \\rightarrow d$**:\n  1. The neighbors are $N_{G'}(c)=\\{a,b\\}$ and $N_{G'}(d)=\\{a,b\\}$. The union is $\\{a,b\\}$.\n  2. We count neighbors with degree $\\ge k=3$. Since $\\text{deg}_{G'}(a)=2$ and $\\text{deg}_{G'}(b)=2$, this count is 0.\n  3. The rule requires $0  3$, which is true.\n  4. The move $c \\rightarrow d$ can be coalesced.\n\nUnder Plan B, both moves are successfully coalesced. The number of remaining moves is 0.\n- $\\text{cost}_B = spill\\_lat_B + moves_B = 3 + 0 = 3$.\n\n**Step 3: Compare Costs and Find Minimum**\n\n- Cost of Plan A = 2\n- Cost of Plan B = 3\n\nThe minimal achievable cost is the minimum of the two, which is 2.",
            "answer": "$$\n\\boxed{2}\n$$"
        }
    ]
}