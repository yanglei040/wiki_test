## 引言
[求解线性方程组](@entry_id:169069) $A\mathbf{x} = \mathbf{b}$ 是科学与工程计算中的一个基本任务，而高斯消元法是最经典的方法之一。然而，当直接应用[高斯消元法](@entry_id:153590)时，可能会遇到主元过小导致的数值不稳定性问题，这会严重放大舍入误差，产生不可靠的解。为了缓解这一问题，[部分主元法](@entry_id:138396)被提出，但它仅考虑主元的绝对大小，忽略了方程的整体尺度，在处理“缩放不当”的系统时仍有缺陷。本文将深入探讨一种更稳健的策略——比例主元法，它通过一种巧妙的规范化思想解决了这一知识鸿沟。

在接下来的内容中，你将系统地学习比例主元法。第一章“原理和机制”将揭示其算法核心，解释它如何通过[比例因子](@entry_id:266678)做出更优的主元选择。第二章“应用与跨学科联系”将展示该方法在物理、金融、统计等多个领域的实际应用，并探讨其与病态问题和稀疏矩阵的关联。最后，在“动手实践”部分，你将通过具体的练习来巩固和应用所学知识。

## 原理和机制

在使用[高斯消元法](@entry_id:153590)求解线性方程组 $A\mathbf{x} = \mathbf{b}$ 的过程中，我们面临的一个核心挑战是[数值不稳定性](@entry_id:137058)。当主元（即用于消去其他方程中变量的系数）的[绝对值](@entry_id:147688)过小或接近于零时，计算过程中会引入巨大的乘数。这些大乘数会放大固有的[舍入误差](@entry_id:162651)，最终可能导致计算出的解与真实解相去甚远，甚至完全错误。为了应对这一挑战，发展出了多种**主元选择策略 (pivoting strategies)**。

### [部分主元法](@entry_id:138396)及其局限性

最直接的主元选择策略是**[部分主元法](@entry_id:138396) (Partial Pivoting)**。在消元的第 $k$ 步，该策略在当前主元所在列（第 $k$ 列）的对角线及下方元素中，选取[绝对值](@entry_id:147688)最大的元素作为新的主元，并通过行交换将其移动到[主元位置](@entry_id:155686) $(k, k)$。这种方法在大多数情况下是有效的，因为它能确保在每一步中使用的乘数 $m_{ik} = a_{ik}^{(k)} / a_{kk}^{(k)}$ 的[绝对值](@entry_id:147688)都不超过1，从而限制了误差的增长。

然而，[部分主元法](@entry_id:138396)并非万无一失。它的判断标准完全依赖于主元候选元素的绝对大小，而忽略了这些元素所在方程的整体“尺度”。如果[方程组](@entry_id:193238)中某个方程的所有系数都被乘以一个极大的数，那么即使它原本的候选主元相对较小，也可能因为被放大而错误地被选中。

我们可以通过一个简单的例子来理解这一缺陷。考虑以下 $2 \times 2$ 线性系统 ：
$$
\begin{pmatrix}
2  1 \\
3  100
\end{pmatrix}
\begin{pmatrix}
x_1 \\
x_2
\end{pmatrix}
=
\begin{pmatrix}
4 \\
106
\end{pmatrix}
$$
若采用标准的[部分主元法](@entry_id:138396)，在第一步中，我们需要比较第一列的元素 $|2|$ 和 $|3|$。由于 $|3| > |2|$，算法将选择第二行作为主元行，并将其与第一行交换。然而，从直觉上看，第二行中的系数 $3$ 与同行的另一个系数 $100$ 相比非常小。选择 $3$ 作为主元似乎并不是一个稳健的选择。相反，第一行中的系数 $2$ 与其同行中的系数 $1$ 相比，是相对较大的。这表明，一个理想的主元选择策略应该考虑元素在其所在行内的相对大小，而不仅仅是它的[绝对值](@entry_id:147688)。

### 比例主元法的原理与算法

为了克服[部分主元法](@entry_id:138396)的上述缺陷，**比例主元法 (Scaled Partial Pivoting)** 应运而生。该方法的核心思想是：一个好的主元，应该是其所在行中“相对”最大的元素。它通过引入一个比例因子来规范化比较过程，从而使选择标准不受方程任意缩放的影响。

比例主元法的算法步骤如下：

1.  **计算[比例因子](@entry_id:266678) (Scale Factors)**：在进行任何消元操作之前，首先为矩阵 $A$ 的每一行计算一个**比例因子** $s_i$。该因子定义为该行所有元素[绝对值](@entry_id:147688)中的最大值：
    $$
    s_i = \max_{1 \le j \le n} |a_{ij}|
    $$
    这些比例因子在整个消元过程中保持不变，只需计算一次。如果某一行的比例因子 $s_k = 0$，这意味着该行的所有元素均为零。这直接表明矩阵 $A$ 是奇异的（其[行列式](@entry_id:142978)为零），因此[方程组](@entry_id:193238) $A\mathbf{x} = \mathbf{b}$ 没有唯一解 。

2.  **选择主元行**：在消元的第 $k$ 步，对于所有候选行 $i$（$i \ge k$），计算候选主元 $|a_{ik}|$ 与其对应行的[比例因子](@entry_id:266678) $s_i$ 的比值：
    $$
    \frac{|a_{ik}|}{s_i}
    $$
    然后，选择使该比值最大的行 $p$ 作为主元行。也就是说，寻找行索引 $p$ 满足：
    $$
    \frac{|a_{pk}|}{s_p} = \max_{i=k, \dots, n} \left( \frac{|a_{ik}|}{s_i} \right)
    $$
    如果出现平局，通常选择索引最小的行。

3.  **行交换与消元**：将选出的主元行 $p$ 与当前行 $k$ 进行交换，然后像标准[高斯消元法](@entry_id:153590)一样，利用新的主元 $a_{kk}$ 来消去其下方同列的所有元素。

让我们通过一个实例来具体说明这个过程 。考虑如下[增广矩阵](@entry_id:150523)：
$$
\begin{pmatrix}
2  1  0.5  |  5 \\
-3  400  -50  |  350 \\
1  -2  100  |  100
\end{pmatrix}
$$
首先，我们计算每一行的[比例因子](@entry_id:266678)（仅基于系数矩阵）：
$s_1 = \max\{|2|, |1|, |0.5|\} = 2$
$s_2 = \max\{|-3|, |400|, |-50|\} = 400$
$s_3 = \max\{|1|, |-2|, |100|\} = 100$

接下来，在第一步（$k=1$），我们计算第一列各元素与其比例因子的比值：
对于第一行：$\frac{|a_{11}|}{s_1} = \frac{|2|}{2} = 1$
对于第二行：$\frac{|a_{21}|}{s_2} = \frac{|-3|}{400} = \frac{3}{400}$
对于第三行：$\frac{|a_{31}|}{s_3} = \frac{|1|}{100} = \frac{1}{100}$

比较这三个比值，第一行的比值 $1$ 是最大的。因此，比例主元法会选择第一行作为主元行。注意，标准的[部分主元法](@entry_id:138396)会错误地选择第二行，因为 $|-3|>|2|>|1|$。这个例子清晰地展示了比例主元法如何通过考虑行内元素的相对大小，做出更稳健的选择。类似地，对于矩阵 $A = \begin{pmatrix} 3  4  -2 \\ 6  2  -4 \\ 12  200  5 \end{pmatrix}$，尽管 $a_{31}=12$ 是第一列中[绝对值](@entry_id:147688)最大的元素，但比例主元法会选择 $a_{21}=6$作为主元，因为比值 $\frac{|6|}{\max\{|6|,|2|,|-4|\}} = 1$ 是最大的 。即使系数以[科学记数法](@entry_id:140078)表示，例如在处理不同[数量级](@entry_id:264888)的方程时，该方法同样有效 。

### 关键特性：对行缩放的不变性

比例主元法最核心的优点在于其**对行缩放的[不变性](@entry_id:140168) (invariance to row scaling)**。这意味着，如果你将[线性方程组](@entry_id:148943)中的某一个方程（即矩阵的某一行以及右端向量的对应元素）乘以任何非零常数 $C$，比例主元法的选择结果不会改变。

让我们来验证这一点。假设我们将第 $i$ 行乘以 $C$。新的行元素为 $a'_{ij} = C \cdot a_{ij}$。那么，新的比例因子 $s'_i$ 将是：
$$
s'_i = \max_{j} |a'_{ij}| = \max_{j} |C \cdot a_{ij}| = |C| \cdot \max_{j} |a_{ij}| = |C| s_i
$$
在选择主元时，计算的比值将是：
$$
\frac{|a'_{ik}|}{s'_i} = \frac{|C \cdot a_{ik}|}{|C| s_i} = \frac{|C| |a_{ik}|}{|C| s_i} = \frac{|a_{ik}|}{s_i}
$$
比值完全没有变化！因此，算法的选择决策与方程的缩放无关。这个特性正是它优于标准[部分主元法](@entry_id:138396)的地方。例如，如果我们有一个矩阵，并将其第一行所有元素乘以 $10^6$，标准[部分主元法](@entry_id:138396)几乎肯定会选择第一行作为主元行。然而，比例主元法的决策将保持不变，因为它会自动“看穿”这种人为的缩放 。

### 在 LU 分解中的实现与[数值稳定性](@entry_id:146550)

在实践中，主元选择通常与 **LU 分解**相结合。带有主元选择的 LU 分解过程，最终得到的不是原矩阵 $A$ 的分解，而是其行[置换](@entry_id:136432)后的矩阵 $PA$ 的分解，其中 $P$ 是一个**[置换矩阵](@entry_id:136841) (permutation matrix)**，记录了所有的行交换操作。分解的形式为：
$$
PA = LU
$$
其中 $L$ 是单位下[三角矩阵](@entry_id:636278)，$U$ 是上三角矩阵。

要解原[方程组](@entry_id:193238) $A\mathbf{x} = \mathbf{b}$，我们首先在两边同时左乘[置换矩阵](@entry_id:136841) $P$：
$$
PA\mathbf{x} = P\mathbf{b}
$$
由于 $P$ 是可逆的，这个新[方程组](@entry_id:193238)与原[方程组](@entry_id:193238)是等价的，它们拥有完全相同的解向量 $\mathbf{x}$。关键在于，行交换只改变了方程的顺序，而没有改变变量 $x_1, x_2, \dots, x_n$ 的顺序。因此，解出 $PA\mathbf{x} = P\mathbf{b}$ 的 $\mathbf{x}$ 就是原问题的解，无需进行任何“反向[置换](@entry_id:136432)” 。

求解过程分为两步：
1.  令 $\mathbf{y} = U\mathbf{x}$，首先通过**前向替换 (forward substitution)** 解下三角系统 $L\mathbf{y} = P\mathbf{b}$，得到中间向量 $\mathbf{y}$。
2.  然后，通过**后向替换 (backward substitution)** 解[上三角系统](@entry_id:635483) $U\mathbf{x} = \mathbf{y}$，得到最终解 $\mathbf{x}$。

比例主元法通过选择相对较大的主元，旨在控制消元过程中元素大小的增长。我们用**增长因子 (growth factor)** $\rho$ 来衡量[数值稳定性](@entry_id:146550)，它定义为消元过程中出现的所有元素[绝对值](@entry_id:147688)的最大值与原始矩阵中元素[绝对值](@entry_id:147688)的最大值之比。理想情况下，$\rho$ 应保持为一个较小的数。

让我们通过一个在[有限精度算术](@entry_id:142321)下求解的例子，来直观感受比例主元法的威力 。考虑系统：
$$
\begin{align*}
11 x_1 + 59140 x_2 = 59151 \\
7 x_1 - x_2 = 6
\end{align*}
$$
其精确解为 $x_1=1, x_2=1$。
比例因子为 $s_1=59140$，$s_2=7$。第一步的比值为 $\frac{11}{59140} \approx 1.860 \times 10^{-4}$ 和 $\frac{7}{7} = 1.000$。因此，算法选择第二行作为主元行，并交换两行。使用四位四舍五入算术进行消元，最终可以得到非常精确的解 $(1.000, 1.000)$。相反，如果不进行行交换（相当于选择了第一行的 $11$ 作为主元），巨大的系数 $59140$ 会在计算中导致严重的[舍入误差](@entry_id:162651)，产生灾难性的结果。

尽管比例主元法旨在控制元素增长，但这并不意味着元素大小不会增加。例如，在对矩阵 $A = \begin{pmatrix} 2  1  -1 \\ 1  2  1 \\ 4  100  1 \end{pmatrix}$ 进行消元时，比例主元法选择 $a_{11}=2$ 作为主元。经过一步消元后，矩阵变为 $A^{(2)} = \begin{pmatrix} 2  1  -1 \\ 0  1.5  1.5 \\ 0  98  3 \end{pmatrix}$。我们看到，尽管初始矩阵中最大的元素是 $100$，但新矩阵中出现了元素 $98$ 。这种元素的增长是正常的，比例主元法的目标是防止这种增长失控。作为比较，**[完全主元法](@entry_id:176607) (Complete/Full Pivoting)** 在每一步都搜索整个子矩阵以找到[绝对值](@entry_id:147688)最大的元素作为主元，这在理论上能更好地控制增长因子，但其搜索成本（需要列交换）远高于比例主元法，因此后者在实践中是稳定性和效率之间的一个出色折衷 。

### 局限性与[病态问题](@entry_id:137067)

尽管比例主元法是一种非常有效的启发式策略，但它并非绝对可靠。可以构造一些特殊的“病态”矩阵，使得比例主元法做出次优甚至糟糕的选择。这类矩阵通常也是**病态的 (ill-conditioned)**，即其**条件数 (condition number)** $\kappa(A)$ 非常大，意味着解对输入数据的微小扰动极为敏感。

考虑以下依赖于小参数 $\epsilon > 0$ 的矩阵 ：
$$
A(\epsilon) = \begin{pmatrix}
\epsilon  \epsilon  \epsilon \\
1  0  1/\epsilon \\
0  1  2
\end{pmatrix}
$$
首先计算[比例因子](@entry_id:266678)：$s_1=\epsilon$, $s_2=1/\epsilon$, $s_3=2$。
在第一步选择主元时，计算比值：
$\frac{|a_{11}|}{s_1} = \frac{\epsilon}{\epsilon} = 1$, $\frac{|a_{21}|}{s_2} = \frac{1}{1/\epsilon} = \epsilon$, $\frac{|a_{31}|}{s_3} = \frac{0}{2} = 0$。
比例主元法会选择第一行作为主元行，因为其比值为 $1$，是三者中最大的。这导致消去第二行第一个元素时使用的乘数为 $m_{21} = \frac{a_{21}}{a_{11}} = \frac{1}{\epsilon}$。当 $\epsilon \to 0$ 时，这个乘数会趋于无穷大，这正是我们试图通过主元选择来避免的情况。

如果我们不遵循比例主元法，而是选择第一列中[绝对值](@entry_id:147688)最大的元素 $a_{21}=1$ 作为主元，那么所用的乘数将是 $m_{11} = \frac{a_{11}}{a_{21}} = \epsilon$，这是一个非常小的值。

这个例子揭示了一个深刻的联系：当比例主元法表现不佳时，往往与矩阵本身的病态性质有关。对于上述矩阵 $A(\epsilon)$，可以证明当 $\epsilon \to 0$ 时，其条件数 $\kappa_\infty(A(\epsilon))$ 的增长速度与 $\epsilon^{-2}$ 成正比。同时，比例主元法选择的乘数大小与“最优”选择的乘数大小之比，其增长速度也与 $\epsilon^{-2}$ 成正比 。这表明，算法的失效与问题的内在困难（病态性）是紧密相连的。这也提醒我们，在数值计算中，没有任何一种算法能完全克服由问题本身的病态性所带来的根本挑战。