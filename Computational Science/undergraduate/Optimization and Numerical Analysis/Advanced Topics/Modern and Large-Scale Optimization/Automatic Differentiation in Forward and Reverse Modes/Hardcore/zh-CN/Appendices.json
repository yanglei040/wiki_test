{
    "hands_on_practices": [
        {
            "introduction": "要掌握自动微分的前向模式，我们可以从一个简单而强大的代数工具——对偶数入手。这个动手练习  将演示如何通过使用对偶数 $x_0 + \\epsilon$ 对函数求值，从而在一次计算中巧妙地同时得到函数值 $f(x_0)$ 和其导数 $f'(x_0)$。",
            "id": "2154638",
            "problem": "在计算科学领域，自动微分是一种用于数值计算函数导数的强大技术。自动微分的前向模式可以使用对偶数来实现。一个对偶数的形式为 $z = a + b\\epsilon$，其中 $a$ 和 $b$ 是实数，$\\epsilon$ 是一个非实数，其性质为 $\\epsilon^2 = 0$。对偶数的算术运算是自然定义的；例如，$(a+b\\epsilon)(c+d\\epsilon) = ac + (ad+bc)\\epsilon + bd\\epsilon^2 = ac + (ad+bc)\\epsilon$。\n\n一个关键性质是，如果我们在对偶数 $x = x_0 + 1\\epsilon$ 处计算多项式函数 $f(x)$ 的值，结果将是对偶数 $f(x_0) + f'(x_0)\\epsilon$。这使得我们可以在点 $x_0$ 处同时计算函数值及其导数值。\n\n考虑一个简单的信号处理模型，其中滤波器的响应由多项式函数 $f(x) = 2x^3 - 5x^2 + 3x + 7$ 描述。一位工程师想要确定在输入信号频率 $x_0 = 4$ 时，滤波器的增益 $f(x_0)$ 及其变化敏感度 $f'(x_0)$。\n\n通过计算 $f(4 + 1\\epsilon)$，工程师得到一个形如 $A + B\\epsilon$ 的结果。数值对 $(A, B)$ 是什么？\n\nA. $(67, 59)$\n\nB. $(59, 67)$\n\nC. $(67, 56)$\n\nD. $(67, 96)$\n\nE. $(128, 96)",
            "solution": "我们使用对偶数的性质：对于 $x=x_{0}+\\epsilon$ 且 $\\epsilon^{2}=0$，计算一个多项式可得\n$$\nf(x_{0}+\\epsilon)=f(x_{0})+f'(x_{0})\\epsilon.\n$$\n给定 $f(x)=2x^{3}-5x^{2}+3x+7$ 和 $x_{0}=4$，我们可以通过直接展开（使用 $\\epsilon^{2}=0$）来验证：\n$$\n(4+\\epsilon)^{2}=16+8\\epsilon,\\quad (4+\\epsilon)^{3}=64+48\\epsilon.\n$$\n然后\n$$\nf(4+\\epsilon)=2(64+48\\epsilon)-5(16+8\\epsilon)+3(4+\\epsilon)+7.\n$$\n分离常数部分和 $\\epsilon$ 部分：\n- 常数部分：\n$$\n2\\cdot 64-5\\cdot 16+3\\cdot 4+7=128-80+12+7=67.\n$$\n- $\\epsilon$ 的系数：\n$$\n2\\cdot 48-5\\cdot 8+3\\cdot 1=96-40+3=59.\n$$\n因此\n$$\nf(4+\\epsilon)=67+59\\epsilon,\n$$\n所以 $(A,B)=(67,59)$，对应选项 A。\n\n为了通过导数进行验证，计算\n$$\nf'(x)=6x^{2}-10x+3,\\quad f'(4)=6\\cdot 16-10\\cdot 4+3=96-40+3=59,\n$$\n这与上面找到的 $\\epsilon$ 的系数一致。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "反向模式自动微分，通常被称为反向传播，是现代机器学习的基石。通过构建计算图，我们可以追踪最终输出的变化如何影响到每一个输入，这个练习  就要求你手动执行这一过程。这项实践将揭开链式法则应用的神秘面纱，并为梯度计算建立基础性的理解。",
            "id": "2154653",
            "problem": "在机器学习领域，自动微分是训练复杂模型的一项关键技术。它能够高效、精确地计算梯度。考虑一个函数 $f(x_1, x_2)$，其值通过一系列基本运算计算得出，构成一个计算图。该序列定义如下：\n\n1.  $v_1 = x_1 + 5$\n2.  $v_2 = v_1 \\cdot x_2$\n3.  $v_3 = \\frac{1}{v_1}$\n4.  $v_4 = \\exp(v_2)$\n5.  $f = v_3 + v_4$\n\n你的任务是计算函数 $f$ 相对于其输入 $x_1$ 和 $x_2$ 的梯度。利用反向模式自动微分（也称为反向传播）的原理，计算在点 $(x_1, x_2) = (-4, 0)$ 处偏导数 $\\frac{\\partial f}{\\partial x_1}$ 和 $\\frac{\\partial f}{\\partial x_2}$ 的精确值。\n\n将你对 $\\left(\\frac{\\partial f}{\\partial x_1}, \\frac{\\partial f}{\\partial x_2}\\right)$ 的答案以行矩阵的形式呈现。最终答案必须是解析表达式，而不是数值近似。",
            "solution": "我们给定的计算序列为：\n$$\nv_{1}=x_{1}+5,\\quad v_{2}=v_{1}x_{2},\\quad v_{3}=\\frac{1}{v_{1}},\\quad v_{4}=\\exp(v_{2}),\\quad f=v_{3}+v_{4}.\n$$\n我们使用反向模式自动微分在点 $(x_{1},x_{2})=(-4,0)$ 处计算梯度，该方法通过将伴随变量 $\\bar{u}=\\frac{\\partial f}{\\partial u}$ 在计算图中反向传播来应用链式法则。\n\n在点 $(x_{1},x_{2})=(-4,0)$ 处的正向求值：\n$$\nv_{1}=(-4)+5=1,\\quad v_{2}=v_{1}x_{2}=1\\cdot 0=0,\\quad v_{3}=\\frac{1}{v_{1}}=\\frac{1}{1}=1,\\quad v_{4}=\\exp(v_{2})=\\exp(0)=1,\n$$\n因此\n$$\nf=v_{3}+v_{4}=1+1=2.\n$$\n\n反向传播（链式法则）：\n1. 设定输出的伴随变量初值：\n$$\n\\bar{f}=1.\n$$\n由于 $f=v_{3}+v_{4}$，\n$$\n\\frac{\\partial f}{\\partial v_{3}}=1,\\quad \\frac{\\partial f}{\\partial v_{4}}=1 \\;\\Rightarrow\\; \\bar{v}_{3}=\\bar{f}\\cdot 1=1,\\quad \\bar{v}_{4}=\\bar{f}\\cdot 1=1.\n$$\n\n2. 对于 $v_{4}=\\exp(v_{2})$，我们有 $\\frac{\\partial v_{4}}{\\partial v_{2}}=\\exp(v_{2})=v_{4}$，因此\n$$\n\\bar{v}_{2}=\\bar{v}_{4}\\cdot \\frac{\\partial v_{4}}{\\partial v_{2}}=\\bar{v}_{4}\\cdot \\exp(v_{2})=1\\cdot 1=1.\n$$\n\n3. 对于 $v_{3}=\\frac{1}{v_{1}}$，我们有 $\\frac{\\partial v_{3}}{\\partial v_{1}}=-\\frac{1}{v_{1}^{2}}$，因此\n$$\n\\bar{v}_{1}\\mathrel{+}= \\bar{v}_{3}\\cdot \\left(-\\frac{1}{v_{1}^{2}}\\right)=1\\cdot \\left(-\\frac{1}{1^{2}}\\right)=-1.\n$$\n\n4. 对于 $v_{2}=v_{1}x_{2}$，我们有 $\\frac{\\partial v_{2}}{\\partial v_{1}}=x_{2}$ 和 $\\frac{\\partial v_{2}}{\\partial x_{2}}=v_{1}$，因此\n$$\n\\bar{v}_{1}\\mathrel{+}= \\bar{v}_{2}\\cdot x_{2}=1\\cdot 0=0,\\quad \\bar{x}_{2}\\mathrel{+}= \\bar{v}_{2}\\cdot v_{1}=1\\cdot 1=1.\n$$\n因此 $\\bar{v}_{1}=-1+0=-1$。\n\n5. 对于 $v_{1}=x_{1}+5$，我们有 $\\frac{\\partial v_{1}}{\\partial x_{1}}=1$，因此\n$$\n\\bar{x}_{1}=\\bar{v}_{1}\\cdot 1=-1.\n$$\n\n因此，在点 $(-4,0)$ 处的梯度为\n$$\n\\left(\\frac{\\partial f}{\\partial x_{1}},\\frac{\\partial f}{\\partial x_{2}}\\right)=(-1,1).\n$$\n作为行矩阵，其形式为\n$$\n\\begin{pmatrix}\n-1  1\n\\end{pmatrix}.\n$$",
            "answer": "$$\\boxed{\\begin{pmatrix}-1  1\\end{pmatrix}}$$"
        },
        {
            "introduction": "在前向模式和反向模式之间的选择并非随意的，而是一个基于计算效率的关键决策。这个问题  将引导你对一个具有多个输入的简单函数，分析两种模式的运算成本。通过比较运算次数，你将揭示出为什么反向模式是训练大规模模型时的首选方法这一根本原因。",
            "id": "2154645",
            "problem": "自动微分 (AD) 是一系列用于数值计算由计算机程序指定的函数导数的技术。AD 有两种主要模式：前向模式和反向模式。考虑一个函数 $f: \\mathbb{R}^n \\to \\mathbb{R}$，定义为其输入的乘积：\n$$f(x_1, x_2, \\dots, x_n) = \\prod_{i=1}^{n} x_i$$\n为了分析计算梯度 $\\nabla f$ 的计算成本，我们可以将函数的求值过程表示为一系列基本操作，从而形成一个计算图。我们如下定义这个序列：\n- 以初始值 $v_0 = 1$ 开始。\n- 对于 $i = 1, 2, \\dots, n$，计算中间变量 $v_i = v_{i-1} \\cdot x_i$。\n- 最终结果为 $y = v_n$。\n\n我们关心的是使用这两种模式计算完整梯度向量 $\\nabla f = \\left(\\frac{\\partial f}{\\partial x_1}, \\frac{\\partial f}{\\partial x_2}, \\dots, \\frac{\\partial f}{\\partial x_n}\\right)$ 所需的算术运算（定义为单次乘法或单次加法）总数。\n\n**前向模式 AD：**\n梯度是通过对计算图进行 $n$ 次遍历来计算的，每次遍历对应一个输入变量 $x_j$。单次遍历计算一个偏导数 $\\frac{\\partial f}{\\partial x_j}$。总成本包括：\n1.  一次“前向计算过程 (primal pass)”来计算并存储所有变量 $v_i$ 的值。\n2.  $n$ 次“切线计算过程 (tangent passes)”。在每次计算过程 $j$ 中，导数（或称“切线”）$\\dot{v}_i = \\frac{\\partial v_i}{\\partial x_j}$ 会被前向传播。对于乘法步骤 $v_i = v_{i-1} \\cdot x_i$，其传播规则是 $\\dot{v}_i = \\dot{v}_{i-1} \\cdot x_i + v_{i-1} \\cdot \\dot{x}_i$。这个计算 $\\dot{v}_i$ 的过程需要两次乘法和一次加法。\n\n**反向模式 AD：**\n在正向计算过程之后，整个梯度在单次反向计算过程中被计算出来。总成本包括：\n1.  一次“前向计算过程 (primal pass)”来计算并存储所有变量 $v_i$ 和 $x_i$ 的值。\n2.  一次“伴随计算过程 (adjoint pass)”，它反向传播伴随值 $\\bar{v}_i = \\frac{\\partial f}{\\partial v_i}$ 和 $\\bar{x}_i = \\frac{\\partial f}{\\partial x_i}$。对于乘法步骤 $v_i = v_{i-1} \\cdot x_i$，伴随值通过以下规则更新：$\\bar{v}_{i-1} \\mathrel{+}= \\bar{v}_i \\cdot x_i$ 和 $\\bar{x}_i \\mathrel{+}= \\bar{v}_i \\cdot v_{i-1}$。这些更新规则中的每一个都需要一次乘法和一次加法。\n\n令 $N_{\\text{fwd}}$ 为使用前向模式计算整个梯度所需的算术运算（乘法和加法）总数，令 $N_{\\text{rev}}$ 为使用反向模式所需的相应总数。确定比率 $R = \\frac{N_{\\text{fwd}}}{N_{\\text{rev}}}$，表示为关于 $n$ 的表达式。",
            "solution": "我们将求值过程建模为序列 $v_{0}=1$，$v_{i}=v_{i-1}\\cdot x_{i}$（对于 $i=1,\\dots,n$）以及 $y=v_{n}$。算术运算指乘法和加法。\n\n前向模式 AD：\n- 前向计算过程用 $n$ 次乘法计算所有 $v_{i}$，因此前向计算成本为 $n$。\n- 对于每个以 $x_{j}$ 为种子的切线计算过程，步骤 $i$ 的传播规则是\n$$\n\\dot{v}_{i}=\\dot{v}_{i-1}\\cdot x_{i}+v_{i-1}\\cdot \\dot{x}_{i},\n$$\n这需要两次乘法和一次加法。每次计算有 $n$ 个这样的步骤，所以每次计算成本为 $3n$ 次运算。对于 $j=1,\\dots,n$ 有 $n$ 次计算过程，因此总切线计算成本为 $3n^{2}$。因此\n$$\nN_{\\text{fwd}}=n+3n^{2}.\n$$\n\n反向模式 AD：\n- 前向计算成本与上述相同：$n$ 次乘法，所以成本为 $n$。\n- 在伴随计算过程中，对于每个乘法节点 $v_{i}=v_{i-1}\\cdot x_{i}$，我们执行\n$$\n\\bar{v}_{i-1}\\mathrel{+}=\\bar{v}_{i}\\cdot x_{i},\\quad \\bar{x}_{i}\\mathrel{+}=\\bar{v}_{i}\\cdot v_{i-1},\n$$\n每次更新需要一次乘法和一次加法。因此，每个 $i$ 步需要 $2$ 次乘法和 $2$ 次加法，即 $4$ 次运算。在 $n$ 个步骤中，伴随计算过程的成本为 $4n$。因此\n$$\nN_{\\text{rev}}=n+4n=5n.\n$$\n\n比率为\n$$\nR=\\frac{N_{\\text{fwd}}}{N_{\\text{rev}}}=\\frac{n+3n^{2}}{5n}=\\frac{3n+1}{5}.\n$$",
            "answer": "$$\\boxed{\\frac{3n+1}{5}}$$"
        }
    ]
}