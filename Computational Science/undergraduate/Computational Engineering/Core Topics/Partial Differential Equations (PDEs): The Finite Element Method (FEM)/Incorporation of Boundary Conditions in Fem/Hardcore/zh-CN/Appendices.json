{
    "hands_on_practices": [
        {
            "introduction": "这项实践模拟了一个经典的土木工程场景：一座承受静水压力的大坝。在有限元方法中，像压力这样的分布载荷并不能直接施加，而是需要转化为单元节点上的“一致节点力”。本练习  将引导你计算线性变化的压力所产生的节点力，从而加深对虚功原理的理解，这是处理诺伊曼 (Neumann) 边界条件的核心原则。",
            "id": "2402844",
            "problem": "一个垂直的混凝土大坝在平面应变条件下被建模为二维模型，其平面外厚度为单位厚度。上游水面与全局坐标系中的直线 $x=0$ 重合，从 $z=0$ 处的自由水面延伸至深度 $z=H$。坐标系的定义为：$x$ 轴水平指向大坝内部，$z$ 轴从自由水面开始垂直向下。水对大坝施加的静水压力为 $p(z)=\\rho g z$，其中 $\\rho$ 是流体密度，$g$ 是重力加速度。压力垂直于坝面并指向大坝内部。\n\n考虑沿上游坝面的一个单一的直线边界有限元，连接节点 $1$（位于 $(x,z)=(0,0)$）和节点 $2$（位于 $(x,z)=(0,H)$）。沿该边界段使用线性插值，节点自由度的顺序为 $\\big[u_{1x},u_{1z},u_{2x},u_{2z}\\big]$。确定该边界单元在全局坐标系下的等效节点力向量，以行向量 $\\big[F_{1x},F_{1z},F_{2x},F_{2z}\\big]$ 的形式表示，并用 $\\rho$、$g$ 和 $H$ 来表达。\n\n最终结果以牛顿每单位平面外厚度表示。请以单个行矩阵的形式提供您的答案。无需四舍五入。",
            "solution": "首先将对问题陈述进行严格的验证，以确定其科学和逻辑的完整性。\n\n**步骤 1：提取已知条件**\n\n*   **模型**：一个在平面应变条件下的二维垂直混凝土大坝，其平面外厚度为单位厚度。\n*   **坐标系**：$x$ 轴水平指向大坝内部。$z$ 轴垂直，从水的自由表面指向下方。\n*   **几何形状**：大坝的上游面是一条位于 $x=0$ 的垂直线，从 $z=0$ 的自由表面延伸至深度 $z=H$。\n*   **荷载**：水在上游面上施加静水压力 $p(z) = \\rho g z$，其中 $\\rho$ 是流体密度，$g$ 是重力加速度。压力作用方向垂直于坝面并指向大坝内部。\n*   **有限元离散化**：使用一个单一的直线边界单元来模拟上游面。该单元连接节点 $1$（位于 $(x,z)=(0,0)$）和节点 $2$（位于 $(x,z)=(0,H)$）。\n*   **插值**：沿边界单元使用线性插值。\n*   **自由度**：节点自由度按向量 $\\big[u_{1x}, u_{1z}, u_{2x}, u_{2z}\\big]$ 的顺序排列。\n*   **目标**：确定该边界单元的一致等效节点力向量，以行向量 $\\big[F_{1x}, F_{1z}, F_{2x}, F_{2z}\\big]$ 的形式表示，并用 $\\rho$、$g$ 和 $H$ 来表达。结果以单位平面外厚度的力为单位。\n\n**步骤 2：使用提取的已知条件进行验证**\n\n根据所需准则对问题进行分析。\n\n*   **科学依据**：该问题是有限元法（FEM）在结构力学中的一个标准应用。静水压力公式 $p(z) = \\rho g z$ 是流体静力学的基本原理。从虚功原理推导出的一致节点荷载概念是有限元法的核心原则。该设置是分析大坝时一种有效且常见的简化方法。\n*   **适定性**：问题提供了所有必要信息——几何形状、荷载函数、单元类型、形函数（由“线性插值”隐含）和自由度——以唯一确定等效节点力向量。\n*   **目标明确性**：问题使用精确、客观、无歧义的技术语言陈述。\n\n该问题没有任何缺陷。它在科学上是合理的，问题是适定的，信息是完整的，并且可以使用既定的计算工程原理直接求解。\n\n**步骤 3：结论与行动**\n\n该问题被判定为**有效**。将推导解答。\n\n**解答推导**\n\n一致等效节点力向量 $\\mathbf{F}_e$ 是通过将分布面力向量 $\\mathbf{t}$ 所做的虚功与节点力所做的虚功相等来推导的。其控制关系为：\n$$ \\delta W_{ext} = \\int_{\\Gamma_e} (\\delta \\mathbf{u})^T \\mathbf{t} \\, d\\Gamma = (\\delta \\mathbf{d}_e)^T \\mathbf{F}_e $$\n其中 $\\Gamma_e$ 是单元的边界，$\\delta \\mathbf{u}$ 是沿边界的虚位移场，$\\delta \\mathbf{d}_e$ 是虚节点位移向量。\n\n沿单元的位移场 $\\mathbf{u}(z)$ 是通过使用线性形函数从节点位移 $\\mathbf{d}_e = \\begin{pmatrix} u_{1x}  u_{1z}  u_{2x}  u_{2z} \\end{pmatrix}^T$ 插值得到的。该单元从 $z=0$ 延伸到 $z=H$。用垂直坐标 $z$ 表示的线性形函数为：\n$$ N_1(z) = 1 - \\frac{z}{H} $$\n$$ N_2(z) = \\frac{z}{H} $$\n位移向量 $\\mathbf{u}(z) = \\begin{pmatrix} u_x(z) \\\\ u_z(z) \\end{pmatrix}$ 可以写成矩阵形式：\n$$ \\mathbf{u}(z) = \\begin{bmatrix} N_1(z)  0  N_2(z)  0 \\\\ 0  N_1(z)  0  N_2(z) \\end{bmatrix} \\mathbf{d}_e = \\mathbf{N}(z) \\mathbf{d}_e $$\n其中 $\\mathbf{N}(z)$ 是形函数矩阵。那么虚位移场为 $\\delta\\mathbf{u}(z) = \\mathbf{N}(z) \\delta\\mathbf{d}_e$。\n\n将此代入虚功方程，得到：\n$$ (\\delta \\mathbf{d}_e)^T \\mathbf{F}_e = \\int_{\\Gamma_e} (\\mathbf{N}(z) \\delta\\mathbf{d}_e)^T \\mathbf{t}(z) \\, d\\Gamma = (\\delta \\mathbf{d}_e)^T \\int_{\\Gamma_e} \\mathbf{N}(z)^T \\mathbf{t}(z) \\, d\\Gamma $$\n由于该等式对于任意虚节点位移向量 $\\delta\\mathbf{d}_e$ 都必须成立，我们可以推导出等效节点力向量的表达式：\n$$ \\mathbf{F}_e = \\int_{\\Gamma_e} \\mathbf{N}(z)^T \\mathbf{t}(z) \\, d\\Gamma $$\n压力 $p(z) = \\rho g z$ 垂直于坝面并指向结构内部。坝面位于 $x=0$，因此力沿着正 $x$ 轴方向。因此，面力向量 $\\mathbf{t}(z)$ 为：\n$$ \\mathbf{t}(z) = \\begin{pmatrix} p(z) \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} \\rho g z \\\\ 0 \\end{pmatrix} $$\n积分沿单元长度进行，因此 $d\\Gamma = dz$，积分限为从 $z=0$ 到 $z=H$。根据要求，积分是按单位平面外厚度进行的。\n\n我们计算乘积 $\\mathbf{N}(z)^T \\mathbf{t}(z)$：\n$$ \\mathbf{N}(z)^T \\mathbf{t}(z) = \\begin{bmatrix} N_1(z)  0 \\\\ 0  N_1(z) \\\\ N_2(z)  0 \\\\ 0  N_2(z) \\end{bmatrix} \\begin{pmatrix} \\rho g z \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} N_1(z) \\rho g z \\\\ 0 \\\\ N_2(z) \\rho g z \\\\ 0 \\end{pmatrix} $$\n代入形函数的表达式：\n$$ \\mathbf{N}(z)^T \\mathbf{t}(z) = \\begin{pmatrix} (1 - \\frac{z}{H}) \\rho g z \\\\ 0 \\\\ (\\frac{z}{H}) \\rho g z \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} \\rho g (z - \\frac{z^2}{H}) \\\\ 0 \\\\ \\frac{\\rho g z^2}{H} \\\\ 0 \\end{pmatrix} $$\n现在，我们将此向量从 $z=0$ 积分到 $z=H$，以求得 $\\mathbf{F}_e = \\begin{pmatrix} F_{1x}  F_{1z}  F_{2x}  F_{2z} \\end{pmatrix}^T$ 的分量。\n\n第一个分量，$F_{1x}$，是：\n$$ F_{1x} = \\int_{0}^{H} \\rho g \\left(z - \\frac{z^2}{H}\\right) dz = \\rho g \\left[ \\frac{z^2}{2} - \\frac{z^3}{3H} \\right]_{0}^{H} = \\rho g \\left( \\frac{H^2}{2} - \\frac{H^3}{3H} \\right) = \\rho g \\left( \\frac{H^2}{2} - \\frac{H^2}{3} \\right) = \\frac{1}{6} \\rho g H^2 $$\n第二个分量，$F_{1z}$，是：\n$$ F_{1z} = \\int_{0}^{H} 0 \\, dz = 0 $$\n第三个分量，$F_{2x}$，是：\n$$ F_{2x} = \\int_{0}^{H} \\frac{\\rho g z^2}{H} dz = \\frac{\\rho g}{H} \\left[ \\frac{z^3}{3} \\right]_{0}^{H} = \\frac{\\rho g}{H} \\left( \\frac{H^3}{3} \\right) = \\frac{1}{3} \\rho g H^2 $$\n第四个分量，$F_{2z}$，是：\n$$ F_{2z} = \\int_{0}^{H} 0 \\, dz = 0 $$\n得到的协调等效节点力向量为 $\\mathbf{F}_e = \\begin{pmatrix} \\frac{1}{6} \\rho g H^2 \\\\ 0 \\\\ \\frac{1}{3} \\rho g H^2 \\\\ 0 \\end{pmatrix}$。\n问题要求结果以行向量 $\\big[F_{1x}, F_{1z}, F_{2x}, F_{2z}\\big]$ 的形式表示。\n因此，最终答案是 $\\left[ \\frac{1}{6} \\rho g H^2, 0, \\frac{1}{3} \\rho g H^2, 0 \\right]$。\n\n一个简短的验证证实了结果。总水平力为 $\\int_{0}^{H} \\rho g z \\, dz = \\frac{1}{2} \\rho g H^2$。节点力的总和为 $F_{1x} + F_{2x} = \\frac{1}{6} \\rho g H^2 + \\frac{1}{3} \\rho g H^2 = \\frac{1}{2} \\rho g H^2$。总力是守恒的。\n由压力产生的绕节点 $1$（位于 $z=0$）的力矩为 $\\int_{0}^{H} z (\\rho g z) \\, dz = \\frac{1}{3} \\rho g H^3$。由节点力产生的力矩为 $H \\cdot F_{2x} = H \\cdot (\\frac{1}{3} \\rho g H^2) = \\frac{1}{3} \\rho g H^3$。力矩也是守恒的。推导是正确的。",
            "answer": "$$\n\\boxed{\n\\begin{bmatrix}\n\\frac{1}{6} \\rho g H^{2}  0  \\frac{1}{3} \\rho g H^{2}  0\n\\end{bmatrix}\n}\n$$"
        },
        {
            "introduction": "在真实世界的工程问题中，部件的边界很少会与我们选择的坐标系完全对齐。本练习  通过考虑作用在任意方向单元边界上的均匀压力，来解决这种几何复杂性。你将学习如何确定边界的法向量，并将压力分解为全局坐标系下的力分量，这是在实际工程分析中精确建模边界牵引力的关键技能。",
            "id": "2402849",
            "problem": "一个厚度恒定的平面三节点线性三角形有限元嵌入在一个二维实体中。节点坐标（单位：米）为：节点 $A$ 位于 $(x,y)=(1,2)$，节点 $B$ 位于 $(x,y)=(5,5)$，节点 $C$ 位于 $(x,y)=(2,7)$。该单元的厚度均匀，为 $t=0.010~\\mathrm{m}$。一个大小为 $p=3.2\\times 10^{3}~\\mathrm{N/m^{2}}$ 的均布压力作用在连接节点 $A$ 和 $B$ 的单元边上。该压力的作用方向为沿该边指向单元内部的单位内法线方向。\n\n将此视为边界牵引力（一个诺伊曼边界条件），在全局坐标系中，确定在有限元公式中正确引入该边界条件后，在节点 $A$ 处的单个等效节点力的 $x$ 分量。\n\n最终答案以 $\\mathrm{N}$ 为单位表示，并将结果四舍五入到四位有效数字。",
            "solution": "该问题要求计算作用在线性三角形有限元一条边上的均布压力所产生的等效节点力分量。这是有限元方法（FEM）中处理诺伊曼边界条件的一个标准流程。\n\n首先，必须验证问题陈述。\n**步骤 1：提取已知条件**\n- 单元类型：平面三节点线性三角形有限元。\n- 节点坐标：节点 $A$ 位于 $(x,y)=(1,2)$，节点 $B$ 位于 $(x,y)=(5,5)$，节点 $C$ 位于 $(x,y)=(2,7)$。所有坐标单位均为米 $(\\mathrm{m})$。\n- 单元厚度：$t=0.010~\\mathrm{m}$。\n- 施加载荷：均布压力 $p=3.2\\times 10^{3}~\\mathrm{N/m^{2}}$。\n- 载荷施加位置：连接节点 $A$ 和 $B$ 的单元边。\n- 载荷方向：沿 $AB$ 边指向单元内部的单位内法线方向。\n- 目标：确定节点 $A$ 处等效节点力的 $x$ 分量，记为 $F_{Ax}$。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据，是连续介质力学和有限元方法既定原理的直接应用。问题提法恰当，提供了计算唯一解所需的所有几何和载荷数据。语言客观、精确。问题是完整的、一致的且可行的。\n\n**步骤 3：结论与行动**\n问题有效。将推导解答。\n\n由表面牵引力 $\\{T\\}$ 引起的单元等效节点力 $\\{f^e\\}$，是通过确保节点力所做的功等于牵引力所做的功来求得的。根据虚功原理，可得到以下积分表达式：\n$$ \\{f^e\\} = \\int_{S_e} [N]^T \\{T\\} \\, dS $$\n其中 $[N]$ 是单元形函数矩阵，$S_e$ 是施加牵引力的表面。对于本问题，该表面是连接节点 $A$ 和 $B$ 的边的面。微分表面积为 $dS = t \\, dL$，其中 $t$ 是单元厚度，$dL$ 是沿边的微分长度。\n\n对于线性单元，沿边 $A-B$ 的位移场是由节点 $A$ 和 $B$ 的节点位移线性插值得到的。节点 $A$ 和 $B$ 的形函数沿该边线性变化，而节点 $C$ 的形函数为零。对于均匀牵引力 $\\{T\\}$ 和线性形函数，该积分可简化，使得作用在该边上的总力均等地分配给定义该边的两个节点。\n\n总力矢量 $\\vec{F}_{total}$ 是牵引力矢量 $\\vec{T}$ 与边界面积 $A_{edge}$ 的乘积。\n$$ \\vec{F}_{total} = \\vec{T} \\cdot A_{edge} $$\n面积为 $A_{edge} = L_{AB} \\cdot t$，其中 $L_{AB}$ 是边 $A-B$ 的长度。\n\n首先，我们确定边 $A-B$ 的几何形状。坐标为 $A(1, 2)$ 和 $B(5, 5)$。\n从 $A$ 到 $B$ 沿该边的矢量为：\n$$ \\vec{V}_{AB} = (x_B - x_A, y_B - y_A) = (5 - 1, 5 - 2) = (4, 3) $$\n这条边的长度是：\n$$ L_{AB} = \\sqrt{(x_B - x_A)^2 + (y_B - y_A)^2} = \\sqrt{4^2 + 3^2} = \\sqrt{16 + 9} = \\sqrt{25} = 5~\\mathrm{m} $$\n压力作用面的面积是：\n$$ A_{edge} = L_{AB} \\cdot t = (5~\\mathrm{m}) \\cdot (0.010~\\mathrm{m}) = 0.05~\\mathrm{m^2} $$\n\n接下来，我们确定牵引力矢量 $\\vec{T}$。牵引力的大小即为压力 $p = 3.2 \\times 10^3~\\mathrm{N/m^2}$。方向是边 $A-B$ 的单位内法线方向。\n为求内法线，我们首先求外法线。给定单元节点 $A(1,2)$、$B(5,5)$ 和 $C(2,7)$，我们可以检查它们的定向。有向面积计算得出：\n$$ 2 \\times \\text{Area} = \\det \\begin{pmatrix} x_A  y_A  1 \\\\ x_B  y_B  1 \\\\ x_C  y_C  1 \\end{pmatrix} = \\det \\begin{pmatrix} 1  2  1 \\\\ 5  5  1 \\\\ 2  7  1 \\end{pmatrix} = 1(5-7) - 2(5-2) + 1(35-10) = -2 - 6 + 25 = 17 $$\n由于结果为正，节点 $A-B-C$ 是以逆时针（CCW）顺序列出的。对于一个逆时针排序的单元，从节点 $A$ 到节点 $B$ 的边的单位外法线矢量 $\\hat{n}_{out}$ 由下式给出：\n$$ \\hat{n}_{out} = \\frac{1}{L_{AB}}(y_B - y_A, -(x_B - x_A)) = \\frac{1}{5}(5-2, -(5-1)) = \\frac{1}{5}(3, -4) $$\n问题指明压力作用方向为单位内法线 $\\hat{n}_{in}$ 方向，该方向与外法线方向相反：\n$$ \\hat{n}_{in} = -\\hat{n}_{out} = -\\frac{1}{5}(3, -4) = \\begin{pmatrix} -3/5 \\\\ 4/5 \\end{pmatrix} $$\n牵引力矢量 $\\vec{T}$ 是压力乘以该方向矢量：\n$$ \\vec{T} = p \\cdot \\hat{n}_{in} = (3.2 \\times 10^3~\\mathrm{N/m^2}) \\cdot \\begin{pmatrix} -3/5 \\\\ 4/5 \\end{pmatrix} = \\begin{pmatrix} -1920 \\\\ 2560 \\end{pmatrix}~\\mathrm{N/m^2} $$\n因此，$T_x = -1920~\\mathrm{N/m^2}$ 且 $T_y = 2560~\\mathrm{N/m^2}$。\n\n作用在该边上的总力矢量为：\n$$ \\vec{F}_{total} = \\vec{T} \\cdot A_{edge} = \\begin{pmatrix} -1920 \\\\ 2560 \\end{pmatrix} \\cdot (0.05) = \\begin{pmatrix} -96 \\\\ 128 \\end{pmatrix}~\\mathrm{N} $$\n对于沿一条边施加均匀牵引力的线性单元，此总力均等地分配到该边上的两个节点 $A$ 和 $B$。节点 $C$ 处的力为零。\n$$ \\vec{F}_A = \\vec{F}_B = \\frac{1}{2} \\vec{F}_{total} $$\n节点 $A$ 处的等效节点力矢量为：\n$$ \\vec{F}_A = \\frac{1}{2} \\begin{pmatrix} -96 \\\\ 128 \\end{pmatrix} = \\begin{pmatrix} -48 \\\\ 64 \\end{pmatrix}~\\mathrm{N} $$\n节点 $A$ 处力的分量为 $F_{Ax} = -48~\\mathrm{N}$ 和 $F_{Ay} = 64~\\mathrm{N}$。\n\n问题要求的是节点 $A$ 处等效节点力的 $x$ 分量，即 $F_{Ax}$。\n$$ F_{Ax} = -48~\\mathrm{N} $$\n问题要求答案四舍五入到四位有效数字。\n$$ F_{Ax} = -48.00~\\mathrm{N} $$",
            "answer": "$$\\boxed{-48.00}$$"
        },
        {
            "introduction": "从手动计算到编程实践是掌握有限元方法的关键一步。这项高级练习  要求你为一个具有混合边界条件的场景编写一个完整的求解器，其中一条边界边部分固定（狄利克雷条件），部分满足零通量条件（诺伊曼条件）。这个实践突显了这两种边界条件在弱形式和最终代码实现中的根本区别，从而将理论知识与实际应用联系起来。",
            "id": "2402813",
            "problem": "要求您设计并实现一个二维有限元法 (FEM) 求解器，以仅使用第一性原理来演示在单个边界边上整合混合边界条件的方法。背景设定为单位方形域 $\\Omega = [0,1] \\times [0,1]$ 以及带有均匀源项的标量泊松方程。您的任务是推导恰当的弱形式，设计线性三角形单元离散化，并实现混合边界条件，其中底部边界被分为两部分：左侧部分为狄利克雷边界，右侧部分为诺伊曼边界。您必须确保对于不同的网格分辨率和分割位置，实现都是正确的。\n\n从强形式偏微分方程 (PDE) 开始\n$$\n- \\nabla \\cdot \\left( \\nabla u \\right) = f \\quad \\text{in } \\Omega,\n$$\n其中源项是均匀的 $f(x,y) = 1$。边界 $\\partial \\Omega$ 分解如下：\n- 在左边界 $\\{0\\} \\times [0,1]$、右边界 $\\{1\\} \\times [0,1]$ 以及上边界 $[0,1] \\times \\{1\\}$ 上，施加齐次狄利克雷边界条件 $u = 0$。\n- 在下边界 $[0,1] \\times \\{0\\}$ 上，施加由分割参数 $s \\in [0,1]$ 定义的混合边界条件：\n  - 对于 $x \\in [0,s]$，施加齐次狄利克雷边界条件 $u = 0$。\n  - 对于 $x \\in (s,1]$，施加齐次诺伊曼边界条件 $\\frac{\\partial u}{\\partial n} = 0$。\n\n您的解答必须：\n- 从强形式和散度定理出发，推导伽辽金弱形式，并清晰地阐明狄利克雷和诺伊曼边界条件是如何从第一性原理进入该公式的。\n- 使用结构化三角形网格对 $\\Omega$ 进行离散化，该网格通过将均匀 $(N_x \\times N_y)$ 网格的每个矩形沿一条对角线分割成两个三角形而形成，并在每个三角形上使用线性形函数。\n- 使用线性三角形和常数 $f$ 的精确单元积分来组装全局刚度矩阵和载荷向量。在相应节点上强行施加狄利克雷边界条件（通过指定值进行行和列修改），并自然地处理齐次诺伊曼条件（对该边界上的载荷没有贡献）。\n- 计算域平均解值\n$$\n\\bar{u} = \\frac{1}{|\\Omega|} \\int_{\\Omega} u(x,y) \\, d\\Omega,\n$$\n其中 $|\\Omega| = 1$。使用线性三角形的精确单元公式来计算 $\\int_T u \\, d\\Omega$。\n\n您的程序必须实现并运行以下测试套件，无需任何用户输入：\n- 测试用例 1：$N_x = 8$， $N_y = 8$， $s = 0.5$。\n- 测试用例 2：$N_x = 9$， $N_y = 7$， $s = \\frac{1}{3}$。\n- 测试用例 3：$N_x = 10$， $N_y = 10$， $s = 0$。\n- 测试用例 4：$N_x = 6$， $N_y = 12$， $s = 1$。\n\n对于每个测试用例，返回一个等于 $\\bar{u}$ 的浮点数，四舍五入到 $6$ 位小数。您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，$[a_1,a_2,a_3,a_4]$）。不需要物理单位。不使用角度。不使用百分比。输出必须严格遵守此格式的单行。",
            "solution": "该问题已经过验证，并被认定为有效。这是一个来自计算工程领域的适定问题陈述，为构建和求解所需量提供了所有必要的信息。它具有科学依据、客观，并且不包含任何矛盾或歧义。\n\n任务是使用有限元法 (FEM) 求解单位方形域上带有恒定源项的二维泊松方程。边界条件是混合的，在底部边界上有一个分割条件。\n\n控制偏微分方程 (PDE) 或强形式为：\n$$\n- \\nabla \\cdot \\left( \\nabla u \\right) = f \\quad \\text{in } \\Omega = [0,1] \\times [0,1]\n$$\n其中源项为 $f(x,y) = 1$。边界 $\\partial \\Omega$ 被划分为狄利克雷边界 $\\Gamma_D$ 和诺伊曼边界 $\\Gamma_N$。\n边界条件为：\n1.  在左、右、上边界以及下边界的左侧部分施加齐次狄利克雷条件 $u = 0$。具体来说，$\\Gamma_D = (\\{0\\} \\times [0,1]) \\cup (\\{1\\} \\times [0,1]) \\cup ([0,1] \\times \\{1\\}) \\cup ([0,s] \\times \\{0\\})$。\n2.  在下边界的右侧部分施加齐次诺伊曼条件 $\\frac{\\partial u}{\\partial n} = \\nabla u \\cdot \\mathbf{n} = 0$。具体来说，$\\Gamma_N = ((s,1] \\times \\{0\\})$。\n\n**1. 弱形式的推导**\n\n为推导弱形式，我们将 PDE 乘以一个检验函数 $v$ 并在域 $\\Omega$ 上积分：\n$$\n- \\int_{\\Omega} (\\nabla^2 u) v \\, d\\Omega = \\int_{\\Omega} f v \\, d\\Omega\n$$\n我们对左侧项应用格林第一恒等式（一种分部积分形式）：\n$$\n\\int_{\\Omega} (\\nabla u \\cdot \\nabla v) \\, d\\Omega - \\int_{\\partial \\Omega} (\\nabla u \\cdot \\mathbf{n}) v \\, dS = \\int_{\\Omega} f v \\, d\\Omega\n$$\n重新整理后得到通用弱形式：\n$$\n\\int_{\\Omega} (\\nabla u \\cdot \\nabla v) \\, d\\Omega = \\int_{\\Omega} f v \\, d\\Omega + \\int_{\\partial \\Omega} \\frac{\\partial u}{\\partial n} v \\, dS\n$$\n试探函数 $u$ 必须属于一个足够光滑并满足狄利克雷边界条件的函数空间。检验函数 $v$ 从一个相应的空间中选取，但必须在指定狄利克雷条件的地方为零。因此，对于我们的问题，$v=0$ 在 $\\Gamma_D$ 上。边界积分可以分解为狄利克雷和诺伊曼两部分：\n$$\n\\int_{\\partial \\Omega} \\frac{\\partial u}{\\partial n} v \\, dS = \\int_{\\Gamma_D} \\frac{\\partial u}{\\partial n} v \\, dS + \\int_{\\Gamma_N} \\frac{\\partial u}{\\partial n} v \\, dS\n$$\n第一项为零，因为在 $\\Gamma_D$ 上 $v=0$。第二项也为零，因为在 $\\Gamma_N$ 上规定的诺伊曼条件是齐次的，即 $\\frac{\\partial u}{\\partial n} = 0$。因此，整个边界积分为零。这被称为齐次诺伊曼边界条件的“自然”并入；它不会在最终方程中引入任何新项。\n\n最终的弱形式是寻找 $u \\in V$，使得对于所有 $v \\in V_0$：\n$$\n\\int_{\\Omega} \\nabla u \\cdot \\nabla v \\, d\\Omega = \\int_{\\Omega} f v \\, d\\Omega\n$$\n其中 $V = \\{u \\in H^1(\\Omega) | u=0 \\text{ on } \\Gamma_D\\}$ 且 $V_0 = \\{v \\in H^1(\\Omega) | v=0 \\text{ on } \\Gamma_D\\}$。\n\n**2. 有限元离散化**\n\n我们将域 $\\Omega$ 离散化为三角形单元网格。在每个单元内，解 $u$ 通过基函数（或形函数）$N_j$ 的线性组合来近似：\n$$\nu(x,y) \\approx u_h(x,y) = \\sum_{j=1}^{N_{nodes}} U_j N_j(x,y)\n$$\n其中 $U_j$ 是网格节点处的未知解值。伽辽金方法使用与检验函数相同的基函数，即 $v = N_i$。将近似解 $u_h$ 代入弱形式，并对每个基函数 $N_i$ 进行检验，得到一个线性方程组 $KU=F$：\n$$\n\\sum_{j=1}^{N_{nodes}} \\left( \\int_{\\Omega} \\nabla N_j \\cdot \\nabla N_i \\, d\\Omega \\right) U_j = \\int_{\\Omega} f N_i \\, d\\Omega \\quad \\text{for } i=1, \\dots, N_{nodes}\n$$\n全局刚度矩阵 $K$ 和载荷向量 $F$ 的分量为：\n$$\nK_{ij} = \\int_{\\Omega} \\nabla N_j \\cdot \\nabla N_i \\, d\\Omega \\quad \\text{and} \\quad F_i = \\int_{\\Omega} f N_i \\, d\\Omega\n$$\n对于一个顶点为 $(x_1, y_1), (x_2, y_2), (x_3, y_3)$、面积为 $A$ 的线性三角形单元（P1单元），其形函数是线性的。它们的梯度 $\\nabla N_k$ 在整个单元上是常数。单元刚度矩阵 $K^e$ 可以精确计算。对于单元的节点 $i,j \\in \\{1,2,3\\}$：\n$$\nK^e_{ij} = \\int_{T_e} \\nabla N_j \\cdot \\nabla N_i \\, d\\Omega = \\frac{1}{4A} (b_i b_j + c_i c_j)\n$$\n其中 $b_k = y_j - y_m$ 和 $c_k = x_m - x_j$，索引 $(k,j,m)$ 进行循环置换。由于源项 $f=1$ 是常数，单元载荷向量 $F^e$ 也可以精确计算：\n$$\nF^e_i = \\int_{T_e} (1) N_i \\, d\\Omega = \\frac{A}{3}\n$$\n\n**3. 组装与边界条件**\n\n全局刚度矩阵 $K$ 和载荷向量 $F$ 是通过对所有单元矩阵 $K^e$ 和向量 $F^e$ 的贡献求和来组装的。该域被离散化为一个 $N_x \\times N_y$ 的结构化矩形网格，每个矩形被分割成两个三角形。\n\n- **齐次诺伊曼条件：** 如前所述，此条件是自然的，由弱形式本身处理。对于位于 $\\Gamma_N$ 上的节点，无需对组装好的 $K$ 和 $F$ 进行修改。\n\n- **齐次狄利克雷条件：** 此条件通过修改线性系统来“强行”施加。对于狄利克雷边界 $\\Gamma_D$ 上的每个节点 $k$，我们必须强制执行 $U_k = 0$。这是通过指定的行和列修改方法实现的。对于每个狄利克雷节点 $k$，刚度矩阵 $K$ 的第 $k$ 行和第 $k$ 列被设置为零，对角线元素 $K_{kk}$ 被设置为 $1$，载荷向量中对应的项 $F_k$ 被设置为 $0$。此过程将狄利克雷节点的方程分离为 $1 \\cdot U_k = 0$，同时为剩余的未知（“自由”）节点值正确调整系统。由于指定值为零，因此无需修改 $F$ 中的其他项。\n\n**4. 平均解的计算**\n\n在求解系统 $KU=F$ 得到节点值 $U$ 后，计算域平均解 $\\bar{u}$。由于域面积 $|\\Omega|=1$，该值等于解在整个域上的积分。该积分通过对每个单元上的积分求和来计算：\n$$\n\\bar{u} = \\int_{\\Omega} u_h \\, d\\Omega = \\sum_{e \\in \\text{mesh}} \\int_{T_e} u_h^e \\, d\\Omega\n$$\n对于线性三角形单元，该积分为单元面积乘以其节点值的平均值：\n$$\n\\int_{T_e} u_h^e \\, d\\Omega = \\int_{T_e} \\sum_{k=1}^3 U_k^e N_k^e \\, d\\Omega = \\frac{A_e}{3} \\sum_{k=1}^3 U_k^e\n$$\n将所有单元的这些贡献相加，即可得到 $\\bar{u}$ 的最终值。",
            "answer": "```python\nimport numpy as np\nfrom scipy.sparse import lil_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef calculate_element_matrices(coords):\n    \"\"\"\n    Calculates the element stiffness matrix and load vector for a linear triangular element.\n\n    Args:\n        coords (np.ndarray): A 3x2 array of the element's nodal coordinates.\n\n    Returns:\n        tuple: A tuple containing:\n            - Ke (np.ndarray): The 3x3 element stiffness matrix.\n            - Fe (np.ndarray): The 3x1 element load vector.\n            - area (float): The area of the element.\n    \"\"\"\n    p1, p2, p3 = coords[0, :], coords[1, :], coords[2, :]\n    \n    # Area calculation using the determinant of the coordinate matrix\n    mat = np.array([[1.0, p1[0], p1[1]], \n                    [1.0, p2[0], p2[1]], \n                    [1.0, p3[0], p3[1]]])\n    area = 0.5 * np.linalg.det(mat)\n\n    # b_k = y_j - y_m, c_k = x_m - x_j (cyclic permutation)\n    b = np.array([p2[1] - p3[1], p3[1] - p1[1], p1[1] - p2[1]])\n    c = np.array([p3[0] - p2[0], p1[0] - p3[0], p2[0] - p1[0]])\n\n    # Element stiffness matrix: K^e_ij = (b_i*b_j + c_i*c_j) / (4*A)\n    Ke = (np.outer(b, b) + np.outer(c, c)) / (4.0 * area)\n\n    # Element load vector for f=1: F^e_i = integral(1 * N_i dOmega) = A / 3\n    Fe = np.full(3, area / 3.0)\n\n    return Ke, Fe, area\n\ndef solve_fem_poisson(Nx, Ny, s):\n    \"\"\"\n    Solves the 2D Poisson equation on a unit square with mixed boundary conditions.\n\n    Args:\n        Nx (int): Number of elements in the x-direction.\n        Ny (int): Number of elements in the y-direction.\n        s (float): Split parameter for the bottom boundary condition.\n\n    Returns:\n        float: The domain-averaged solution value.\n    \"\"\"\n    # 1. Mesh Generation\n    hx = 1.0 / Nx\n    hy = 1.0 / Ny\n    num_nodes = (Nx + 1) * (Ny + 1)\n\n    nodes = np.zeros((num_nodes, 2))\n    for j in range(Ny + 1):\n        for i in range(Nx + 1):\n            node_idx = i + j * (Nx + 1)\n            nodes[node_idx] = [i * hx, j * hy]\n\n    elements = []\n    for j in range(Ny):\n        for i in range(Nx):\n            n1 = i + j * (Nx + 1)        # bottom-left\n            n2 = (i + 1) + j * (Nx + 1)  # bottom-right\n            n3 = (i + 1) + (j + 1) * (Nx + 1) # top-right\n            n4 = i + (j + 1) * (Nx + 1)  # top-left\n            elements.append([n1, n2, n3]) # Triangle 1\n            elements.append([n1, n3, n4]) # Triangle 2\n    \n    # 2. Assembly\n    K = lil_matrix((num_nodes, num_nodes))\n    F = np.zeros(num_nodes)\n\n    for el_nodes_indices in elements:\n        coords = nodes[el_nodes_indices, :]\n        Ke, Fe, _ = calculate_element_matrices(coords)\n        \n        for local_i in range(3):\n            global_i = el_nodes_indices[local_i]\n            F[global_i] += Fe[local_i]\n            for local_j in range(3):\n                global_j = el_nodes_indices[local_j]\n                K[global_i, global_j] += Ke[local_i, local_j]\n    \n    # 3. Apply Boundary Conditions\n    dirichlet_nodes = set()\n    tolerance = 1e-9\n\n    # Left, Right, Top boundaries\n    for j in range(Ny + 1):\n        dirichlet_nodes.add(0 + j * (Nx + 1))      # x=0\n        dirichlet_nodes.add(Nx + j * (Nx + 1))   # x=1\n    for i in range(1, Nx):\n        dirichlet_nodes.add(i + Ny * (Nx + 1))   # y=1\n\n    # Bottom boundary split ([0,s] is Dirichlet)\n    for i in range(Nx + 1):\n        if nodes[i, 0] = s + tolerance:\n            dirichlet_nodes.add(i)\n\n    # Row and column modification for homogeneous Dirichlet BC (u=0)\n    for node_idx in dirichlet_nodes:\n        # Since prescribed value is 0, no need to update F for other rows.\n        # F -= K[:, node_idx] * 0\n        K[node_idx, :] = 0.0\n        K[:, node_idx] = 0.0\n        K[node_idx, node_idx] = 1.0\n        F[node_idx] = 0.0\n\n    # 4. Solve the linear system\n    K_csc = K.tocsc()\n    U = spsolve(K_csc, F)\n    \n    # 5. Post-processing: Compute domain-averaged solution\n    total_integral = 0.0\n    for el_nodes_indices in elements:\n        coords = nodes[el_nodes_indices, :]\n        \n        # Re-calculate area (or store it during assembly)\n        p1, p2, p3 = coords[0, :], coords[1, :], coords[2, :]\n        mat = np.array([[1.0, p1[0], p1[1]], [1.0, p2[0], p2[1]], [1.0, p3[0], p3[1]]])\n        area = 0.5 * np.linalg.det(mat)\n        \n        u_vals = U[el_nodes_indices]\n        el_integral = (abs(area) / 3.0) * np.sum(u_vals)\n        total_integral += el_integral\n        \n    # Domain area is 1, so u_bar is the total_integral\n    return total_integral\n\ndef solve():\n    \"\"\"\n    Main function to run the specified test cases and print the results.\n    \"\"\"\n    test_cases = [\n        (8, 8, 0.5),\n        (9, 7, 1.0/3.0),\n        (10, 10, 0.0),\n        (6, 12, 1.0)\n    ]\n\n    results = []\n    for Nx, Ny, s in test_cases:\n        u_bar = solve_fem_poisson(Nx, Ny, s)\n        results.append(f\"{u_bar:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}