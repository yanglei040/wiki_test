{
    "hands_on_practices": [
        {
            "introduction": "掌握单元刚度矩阵的推导是理解有限元方法的基石。该练习将超越简单的均匀网格，带你处理一种更贴近实际的对数间隔网格 。通过从第一性原理出发，你将学会如何将变分形式应用于任意单元，并为更复杂的几何和网格变化做好准备，这对于解决真实世界的工程问题至关重要。",
            "id": "2420728",
            "problem": "考虑一个一维空间中的边值问题：在区间 $\\left[x_{a}, x_{b}\\right]$（其中 $x_{a} > 0$）上，寻找一个足够光滑的函数 $u$，使得对于 $x \\in (x_{a}, x_{b})$，满足 $-\\dfrac{d}{dx}\\left(\\kappa \\dfrac{du}{dx}\\right) = f(x)$，其中 $\\kappa > 0$ 是一个常数。设该区域被一个严格递增的节点序列 $\\{x_{j}\\}_{j=0}^{N}$ 划分为 $N$ 个单元，该序列由一个对数间距的等比级数定义，\n$$\nx_{j} = x_{a}\\, r^{\\,j}, \\quad r = \\left(\\dfrac{x_{b}}{x_{a}}\\right)^{\\!1/N}, \\quad j = 0, 1, \\dots, N,\n$$\n使得 $x_{0} = x_{a}$ 且 $x_{N} = x_{b}$。在此网格上，考虑有限元法（FEM）中使用的标准连续分段线性帽子函数 $\\{\\varphi_{j}\\}_{j=0}^{N}$。对于具有局部线性基 $\\{\\varphi_{i}, \\varphi_{i+1}\\}$ 的单元 $e_{i} = [x_{i}, x_{i+1}]$，推导由该微分算子导出的双线性形式所关联的 $2 \\times 2$ 单元刚度矩阵 $K^{(i)}$。使用上面定义的比率 $r$，将你的最终结果完全用 $x_{a}$、$x_{b}$、$N$、$i$ 和 $\\kappa$ 表示。\n\n你的最终答案必须是 $K^{(i)}$ 的单个闭式解析表达式。不需要进行数值舍入。",
            "solution": "对问题陈述进行验证。\n\n**第一步：提取已知条件**\n- **微分方程：** $-\\dfrac{d}{dx}\\left(\\kappa \\dfrac{du}{dx}\\right) = f(x)$ 对于 $x \\in (x_{a}, x_{b})$。\n- **定义域：** 区间 $[x_{a}, x_{b}]$，其中 $x_{a} > 0$。\n- **参数：** $\\kappa > 0$ 是一个常数。\n- **网格：** 通过严格递增的节点序列 $\\{x_{j}\\}_{j=0}^{N}$ 将定义域划分为 $N$ 个单元。\n- **节点定义：** $x_{j} = x_{a}\\, r^{\\,j}$，其中 $r = \\left(\\dfrac{x_{b}}{x_{a}}\\right)^{1/N}$，对于 $j = 0, 1, \\dots, N$。这意味着 $x_0 = x_a$ 且 $x_N = x_b$。\n- **单元定义：** $e_{i} = [x_{i}, x_{i+1}]$ 对于 $i=0, 1, \\dots, N-1$。\n- **基函数：** 标准连续分段线性帽子函数 $\\{\\varphi_{j}\\}_{j=0}^{N}$。在单元 $e_i$ 上，局部基为 $\\{\\varphi_i, \\varphi_{i+1}\\}$。\n- **任务：** 推导单元 $e_i$ 的 $2 \\times 2$ 单元刚度矩阵 $K^{(i)}$。\n- **输出要求：** 最终结果必须用 $x_{a}$、$x_{b}$、$N$、$i$ 和 $\\kappa$ 表示，并使用比率 $r$。\n\n**第二步：使用提取的已知条件进行验证**\n- **科学依据：** 该问题描述了一个标准的一维二阶椭圆边值问题，这是物理学和工程学中用于描述热传导或扩散等现象的基本模型。所提出的方法——使用线性帽子函数的有限元法（FEM）——是求解此类方程的标准且严谨的数值技术。该问题在计算工程和应用数学中有坚实的基础。\n- **适定性：** 在有限元法框架内，推导单元刚度矩阵是一个定义明确的子问题。给定微分算子和基函数，其过程是确定性的，并会导出一个唯一的结果。\n- **客观性：** 该问题使用精确的数学语言陈述，没有歧义、主观性或观点。\n- **完整性：** 提供了所有必要信息——微分算子、区域划分、基函数以及所需的输出变量。该问题是自包含的。\n\n**第三步：结论与行动**\n该问题被认为是有效的。这是一个计算工程中的标准、适定的问题，没有科学或逻辑上的缺陷。将推导求解。\n\n通过乘以一个测试函数 $v(x)$ 并在定义域 $[x_a, x_b]$ 上积分，可以得到微分方程的弱形式。我们对左侧项应用分部积分：\n$$\n\\int_{x_a}^{x_b} -\\dfrac{d}{dx}\\left(\\kappa \\dfrac{du}{dx}\\right) v(x) \\,dx = \\int_{x_a}^{x_b} \\kappa \\dfrac{du}{dx}\\dfrac{dv}{dx} \\,dx - \\left[\\kappa \\dfrac{du}{dx} v(x)\\right]_{x_a}^{x_b}\n$$\n因此，与该微分算子关联的双线性形式 $a(u,v)$ 为：\n$$\na(u,v) = \\int_{x_a}^{x_b} \\kappa \\dfrac{du}{dx}\\dfrac{dv}{dx} \\,dx\n$$\n全局刚度矩阵 $K$ 的元素由 $K_{jk} = a(\\varphi_k, \\varphi_j)$ 给出。对于单元 $e_i = [x_i, x_{i+1}]$，其单元刚度矩阵是一个与局部基函数 $\\varphi_i$ 和 $\\varphi_{i+1}$ 关联的 $2 \\times 2$ 矩阵 $K^{(i)}$。其元素通过将积分限制在单元域 $[x_i, x_{i+1}]$ 上来计算。设局部索引为 $1$ 和 $2$，对应于全局索引 $i$ 和 $i+1$。$K^{(i)}$ 的元素为：\n$$\nK^{(i)}_{mn} = \\int_{x_i}^{x_{i+1}} \\kappa \\dfrac{d\\varphi_{i+m-1}}{dx}\\dfrac{d\\varphi_{i+n-1}}{dx} \\,dx, \\quad \\text{for } m, n \\in \\{1, 2\\}\n$$\n在单元 $e_i = [x_i, x_{i+1}]$ 上，线性基函数定义为：\n$$\n\\varphi_i(x) = \\dfrac{x_{i+1} - x}{x_{i+1} - x_i}\n$$\n$$\n\\varphi_{i+1}(x) = \\dfrac{x - x_i}{x_{i+1} - x_i}\n$$\n单元的长度为 $h_i = x_{i+1} - x_i$。这些基函数的导数在区间 $(x_i, x_{i+1})$ 上是常数：\n$$\n\\dfrac{d\\varphi_i}{dx} = -\\dfrac{1}{x_{i+1} - x_i} = -\\dfrac{1}{h_i}\n$$\n$$\n\\dfrac{d\\varphi_{i+1}}{dx} = \\dfrac{1}{x_{i+1} - x_i} = \\dfrac{1}{h_i}\n$$\n现在，我们计算单元刚度矩阵 $K^{(i)}$ 的四个元素。由于 $\\kappa$ 是一个常数，可以将其移到积分符号之外。\n\n元素 $K^{(i)}_{11}$：\n$$\nK^{(i)}_{11} = \\int_{x_i}^{x_{i+1}} \\kappa \\left(\\dfrac{d\\varphi_i}{dx}\\right)^2 \\,dx = \\kappa \\int_{x_i}^{x_{i+1}} \\left(-\\dfrac{1}{h_i}\\right)^2 \\,dx = \\dfrac{\\kappa}{h_i^2} \\int_{x_i}^{x_{i+1}} \\,dx = \\dfrac{\\kappa}{h_i^2} (x_{i+1} - x_i) = \\dfrac{\\kappa}{h_i}\n$$\n元素 $K^{(i)}_{22}$：\n$$\nK^{(i)}_{22} = \\int_{x_i}^{x_{i+1}} \\kappa \\left(\\dfrac{d\\varphi_{i+1}}{dx}\\right)^2 \\,dx = \\kappa \\int_{x_i}^{x_{i+1}} \\left(\\dfrac{1}{h_i}\\right)^2 \\,dx = \\dfrac{\\kappa}{h_i^2} \\int_{x_i}^{x_{i+1}} \\,dx = \\dfrac{\\kappa}{h_i^2} (x_{i+1} - x_i) = \\dfrac{\\kappa}{h_i}\n$$\n元素 $K^{(i)}_{12}$ 和 $K^{(i)}_{21}$：\n$$\nK^{(i)}_{12} = K^{(i)}_{21} = \\int_{x_i}^{x_{i+1}} \\kappa \\left(\\dfrac{d\\varphi_i}{dx}\\right)\\left(\\dfrac{d\\varphi_{i+1}}{dx}\\right) \\,dx = \\kappa \\int_{x_i}^{x_{i+1}} \\left(-\\dfrac{1}{h_i}\\right)\\left(\\dfrac{1}{h_i}\\right) \\,dx = -\\dfrac{\\kappa}{h_i^2} \\int_{x_i}^{x_{i+1}} \\,dx = -\\dfrac{\\kappa}{h_i^2} (x_{i+1} - x_i) = -\\dfrac{\\kappa}{h_i}\n$$\n综合这些结果，单元刚度矩阵为：\n$$\nK^{(i)} = \\begin{pmatrix} \\dfrac{\\kappa}{h_i}  -\\dfrac{\\kappa}{h_i} \\\\ -\\dfrac{\\kappa}{h_i}  \\dfrac{\\kappa}{h_i} \\end{pmatrix} = \\dfrac{\\kappa}{h_i} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}\n$$\n最后一步是用给定的参数表示单元长度 $h_i$。节点坐标由等比级数 $x_j = x_a r^j$ 定义。因此，单元 $e_i$ 的长度为：\n$$\nh_i = x_{i+1} - x_i = x_a r^{i+1} - x_a r^i = x_a r^i (r - 1)\n$$\n将 $h_i$ 的这个表达式代入矩阵公式，得到单元刚度矩阵的最终形式：\n$$\nK^{(i)} = \\dfrac{\\kappa}{x_a r^i (r - 1)} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}\n$$\n这个表达式仅依赖于指定的参数 $\\kappa$、$x_a$、$i$ 和比率 $r$，而 $r$ 本身又由 $x_a$、$x_b$ 和 $N$ 定义。推导至此完成。",
            "answer": "$$\n\\boxed{\\frac{\\kappa}{x_{a} r^{i} (r - 1)} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在掌握了单元矩阵的构建之后，下一步是将其组装成一个完整的线性系统并求解。本练习通过一个包含点源（狄拉克 $\\delta$ 函数）的边界值问题，展示了有限元方法的完整流程 。你将看到弱形式如何优雅地处理这种在物理和工程中常见的奇异源项，并学习如何利用求得的节点值来计算域内任意一点的解。",
            "id": "2420776",
            "problem": "考虑区间 $[0,1]$ 上的边值问题：\n$$-u''(x) = \\delta(x - x_0), \\quad u(0)=0,\\quad u(1)=0,$$\n其中 $\\delta$ 是 Dirac delta 分布，且 $x_0=\\frac{3}{5}$ 不是一个网格节点。\n\n将区域 $[0,1]$ 划分为 $N=4$ 个相等的子区间，节点为 $x_i=\\frac{i}{4}$，$i=0,1,2,3,4$。设 $V_h$ 是此网格上的连续分段线性函数空间，这些函数在边界处为零，由与内部节点 $x_1=\\frac{1}{4}$、$x_2=\\frac{1}{2}$ 和 $x_3=\\frac{3}{4}$ 相关联的标准帽子函数张成。设 $u_h \\in V_h$ 表示标准伽辽金有限元近似解。\n\n计算在 $x_0=\\frac{3}{5}$ 处 $u_h(x_0)$ 的值。将您的答案表示为无单位的纯数。将您的答案四舍五入到三位有效数字。",
            "solution": "给定问题是一个带点源的泊松方程的一维边值问题。该问题将使用带有分段线性基函数的标准伽辽金有限元方法来求解。\n\n问题陈述为：找到一个函数 $u(x)$，使得\n$$ -u''(x) = \\delta(x - x_0), \\quad x \\in (0,1) $$\n边界条件为 $u(0)=0$ 和 $u(1)=0$。点源位于 $x_0 = \\frac{3}{5}$。\n\n首先，我们推导弱形式。设 $V = H_0^1(0,1)$ 是 Sobolev 空间，其中的函数一阶导数平方可积，并在边界 $x=0$ 和 $x=1$ 处为零。我们将该微分方程乘以一个任意检验函数 $v \\in V$，并在区域 $[0,1]$ 上积分：\n$$ -\\int_0^1 u''(x) v(x) \\,dx = \\int_0^1 \\delta(x - x_0) v(x) \\,dx $$\n对左侧应用分部积分法，我们得到：\n$$ \\int_0^1 u'(x) v'(x) \\,dx - [u'(x)v(x)]_0^1 = \\int_0^1 \\delta(x - x_0) v(x) \\,dx $$\n由于 $v \\in H_0^1(0,1)$，我们有 $v(0)=0$ 和 $v(1)=0$，所以边界项 $[u'(x)v(x)]_0^1$ 为零。Dirac delta 分布的筛选性质简化了右侧：\n$$ \\int_0^1 \\delta(x - x_0) v(x) \\,dx = v(x_0) $$\n因此，弱形式为：找到 $u \\in V$，使得对所有 $v \\in V$ 都成立\n$$ a(u, v) = L(v) $$\n其中双线性形式为 $a(u,v) = \\int_0^1 u'(x) v'(x) \\,dx$，线性泛函为 $L(v) = v(x_0)$。\n\n接下来，我们建立 Galerkin 问题。区域 $[0,1]$ 被划分为 $N=4$ 个相等的子区间，节点为 $x_i = \\frac{i}{4}$，$i=0, 1, 2, 3, 4$。网格尺寸为 $h = x_{i+1} - x_i = \\frac{1}{4}$。有限元空间 $V_h \\subset V$ 由在此网格上的连续分段线性函数组成，这些函数在 $x=0$ 和 $x=1$ 处为零。$V_h$ 的基是与内部节点 $x_1=\\frac{1}{4}$、$x_2=\\frac{1}{2}$ 和 $x_3=\\frac{3}{4}$ 相关联的标准“帽子”函数集合 $\\{\\phi_j(x)\\}_{j=1}^3$。\n\n有限元近似解 $u_h \\in V_h$ 表示为这些基函数的线性组合：\n$$ u_h(x) = \\sum_{j=1}^3 U_j \\phi_j(x) $$\n其中 $U_j = u_h(x_j)$ 是未知的节点值。Galerkin 方法旨在找到 $u_h \\in V_h$，使得对所有 $v_h \\in V_h$ 都有 $a(u_h, v_h) = L(v_h)$。只需对每个基函数 $v_h = \\phi_i(x)$（$i=1, 2, 3$）强制执行此条件即可：\n$$ \\int_0^1 \\left( \\sum_{j=1}^3 U_j \\phi_j'(x) \\right) \\phi_i'(x) \\,dx = \\phi_i(x_0) $$\n这产生一个线性方程组 $A \\vec{U} = \\vec{f}$，其中 $\\vec{U} = (U_1, U_2, U_3)^T$，刚度矩阵 $A$ 的元素为 $A_{ij} = \\int_0^1 \\phi_i'(x) \\phi_j'(x) \\,dx$，载荷向量 $\\vec{f}$ 的元素为 $f_i = \\phi_i(x_0)$。\n\n我们计算刚度矩阵 $A$。帽子函数 $\\phi_i(x)$ 的导数是分段常数：\n$$ \\phi_i'(x) = \\begin{cases} \\frac{1}{h}  \\text{for } x \\in (x_{i-1}, x_i) \\\\ -\\frac{1}{h}  \\text{for } x \\in (x_i, x_{i+1}) \\\\ 0  \\text{otherwise} \\end{cases} $$\n对于均匀网格，刚度矩阵的元素是标准的：\n$A_{ii} = \\int_{x_{i-1}}^{x_{i+1}} (\\phi_i'(x))^2 \\,dx = \\int_{x_{i-1}}^{x_i} (\\frac{1}{h})^2 \\,dx + \\int_{x_i}^{x_{i+1}} (-\\frac{1}{h})^2 \\,dx = \\frac{1}{h^2} (h) + \\frac{1}{h^2} (h) = \\frac{2}{h}$。\n$A_{i, i+1} = \\int_0^1 \\phi_i'(x) \\phi_{i+1}'(x) \\,dx = \\int_{x_i}^{x_{i+1}} (-\\frac{1}{h})(\\frac{1}{h}) \\,dx = -\\frac{1}{h^2} (h) = -\\frac{1}{h}$。\n根据对称性，$A_{i+1, i} = -\\frac{1}{h}$。所有其他非对角元素均为零。\n当 $h=\\frac{1}{4}$ 时，我们有 $\\frac{1}{h}=4$。刚度矩阵为：\n$$ A = \\frac{1}{h} \\begin{pmatrix} 2  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  2 \\end{pmatrix} = 4 \\begin{pmatrix} 2  -1  0 \\\\ -1  2  -1 \\\\ 0  -1  2 \\end{pmatrix} = \\begin{pmatrix} 8  -4  0 \\\\ -4  8  -4 \\\\ 0  -4  8 \\end{pmatrix} $$\n\n我们计算载荷向量 $\\vec{f}$。元素为 $f_i = \\phi_i(x_0)$，其中 $x_0=\\frac{3}{5}=0.6$。节点为 $x_1=0.25$，$x_2=0.5$，$x_3=0.75$。点 $x_0=0.6$ 位于子区间 $[x_2, x_3] = [0.5, 0.75]$ 内。在此区间内，只有 $\\phi_2(x)$ 和 $\\phi_3(x)$ 是非零的。\n因此，$f_1 = \\phi_1(x_0)=0$。\n$f_2 = \\phi_2(x_0) = \\frac{x_3 - x_0}{h} = \\frac{\\frac{3}{4} - \\frac{3}{5}}{\\frac{1}{4}} = \\frac{\\frac{15-12}{20}}{\\frac{1}{4}} = \\frac{3}{20} \\cdot 4 = \\frac{3}{5}$。\n$f_3 = \\phi_3(x_0) = \\frac{x_0 - x_2}{h} = \\frac{\\frac{3}{5} - \\frac{1}{2}}{\\frac{1}{4}} = \\frac{\\frac{6-5}{10}}{\\frac{1}{4}} = \\frac{1}{10} \\cdot 4 = \\frac{2}{5}$。\n载荷向量为 $\\vec{f} = (0, \\frac{3}{5}, \\frac{2}{5})^T$。\n\n现在，我们求解线性系统 $A \\vec{U} = \\vec{f}$：\n$$ \\begin{pmatrix} 8  -4  0 \\\\ -4  8  -4 \\\\ 0  -4  8 \\end{pmatrix} \\begin{pmatrix} U_1 \\\\ U_2 \\\\ U_3 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ \\frac{3}{5} \\\\ \\frac{2}{5} \\end{pmatrix} $$\n从第一个方程，$8U_1 - 4U_2 = 0 \\implies U_1 = \\frac{1}{2}U_2$。\n第二个和第三个方程构成一个关于 $U_2$ 和 $U_3$ 的方程组：\n$$ -4U_2 + 8U_3 = \\frac{2}{5} \\implies -2U_2 + 4U_3 = \\frac{1}{5} \\quad (1) $$\n$$ -4 (\\frac{1}{2}U_2) + 8U_2 - 4U_3 = \\frac{3}{5} \\implies -2U_2 + 8U_2 - 4U_3 = \\frac{3}{5} \\implies 6U_2 - 4U_3 = \\frac{3}{5} \\quad (2) $$\n将方程 (1) 和方程 (2) 相加：\n$$ (-2U_2 + 4U_3) + (6U_2 - 4U_3) = \\frac{1}{5} + \\frac{3}{5} $$\n$$ 4U_2 = \\frac{4}{5} \\implies U_2 = \\frac{1}{5} $$\n将 $U_2=\\frac{1}{5}$ 代入 (1)：\n$$ -2(\\frac{1}{5}) + 4U_3 = \\frac{1}{5} \\implies 4U_3 = \\frac{3}{5} \\implies U_3 = \\frac{3}{20} $$\n最后，$U_1 = \\frac{1}{2}U_2 = \\frac{1}{2}(\\frac{1}{5}) = \\frac{1}{10}$。\n节点值为 $\\vec{U} = (\\frac{1}{10}, \\frac{1}{5}, \\frac{3}{20})^T$。\n\n任务是计算 $u_h(x_0)$。由于 $x_0 \\in [x_2, x_3]$，解 $u_h(x_0)$ 由节点值 $U_2$ 和 $U_3$ 之间的线性插值决定。在此区间上，$u_h(x)$ 的公式为：\n$$ u_h(x) = U_2 \\phi_2(x) + U_3 \\phi_3(x), \\quad x \\in [x_2, x_3] $$\n我们在 $x=x_0=\\frac{3}{5}$ 处计算该式：\n$$ u_h(x_0) = U_2 \\phi_2(x_0) + U_3 \\phi_3(x_0) $$\n我们已经计算出 $U_2 = \\frac{1}{5}$、$U_3 = \\frac{3}{20}$、$\\phi_2(x_0) = \\frac{3}{5}$ 和 $\\phi_3(x_0) = \\frac{2}{5}$。\n代入这些值：\n$$ u_h(\\frac{3}{5}) = (\\frac{1}{5}) (\\frac{3}{5}) + (\\frac{3}{20}) (\\frac{2}{5}) = \\frac{3}{25} + \\frac{6}{100} = \\frac{12}{100} + \\frac{6}{100} = \\frac{18}{100} = \\frac{9}{50} $$\n作为小数，其值为 $0.18$。题目要求答案四舍五入到三位有效数字。因此，该值为 $0.180$。",
            "answer": "$$\\boxed{0.180}$$"
        },
        {
            "introduction": "本练习将你的技能从静态问题扩展到动态问题的领域，介绍了有限元分析中的另一个核心概念：质量矩阵 。你将通过编程实现理论上精确的“一致质量矩阵”及计算上更高效的“集总质量矩阵”，并利用特征值分析这一强大工具，深入探究这两种方法在数值特性上的差异。这对于理解和选择适合动态或波传播模拟的数值方案至关重要。",
            "id": "2420751",
            "problem": "考虑一个一维域 $\\Omega = [0,L]$（其中 $L = 1$），该域被离散化为节点 $\\{x_0, x_1, \\dots, x_N\\}$，其中 $x_0 = 0$ 且 $x_N = 1$。令 $\\{\\varphi_i(x)\\}_{i=0}^N$ 表示与这些节点相关的标准分段线性“帽”基函数，其中每个 $\\varphi_i(x)$ 都是连续的，在节点 $x_i$ 处等于 $1$，在所有其他节点 $x_j$（$j \\neq i$）处等于 $0$，并且在每个子区间 $[x_{i-1}, x_i]$ 和 $[x_i, x_{i+1}]$（在其定义域内）上是线性的。假设密度为常数 $\\rho = 1$。\n\n使用伽辽金有限元法 (FEM)，一致质量矩阵 $\\mathbf{M} \\in \\mathbb{R}^{(N+1)\\times(N+1)}$ 由 $L^2(\\Omega)$ 内积定义：\n$$\nM_{ij} = \\int_0^L \\varphi_i(x)\\,\\varphi_j(x)\\,dx \\quad \\text{for all } i,j \\in \\{0,1,\\dots,N\\}.\n$$\n集中质量矩阵 $\\mathbf{M}_{\\mathrm{L}} \\in \\mathbb{R}^{(N+1)\\times(N+1)}$ 是将行和启发式方法应用于 $\\mathbf{M}$ 所形成的对角矩阵，即：\n$$\n(\\mathbf{M}_{\\mathrm{L}})_{ii} = \\sum_{j=0}^N M_{ij}, \\quad (\\mathbf{M}_{\\mathrm{L}})_{ij} = 0 \\text{ for } i \\neq j.\n$$\n\n任务 A（推导）。仅从基函数 $\\{\\varphi_i(x)\\}$ 的定义和上述定义 $M_{ij}$ 的内积出发，推导在一个长度为 $h_e = x_{e+1} - x_e$ 的通用单元 $[x_e, x_{e+1}]$ 上的单元级局部一致质量矩阵。推导中使用从 $[x_e, x_{e+1}]$ 线性映射到 $[0,h_e]$ 的两个局部帽函数。说明如何从这些局部贡献中组装出全局一致质量矩阵 $\\mathbf{M}$。\n\n任务 B（实现与比较）。为任意严格递增的节点数组 $\\{x_i\\}_{i=0}^N$ 实现 $\\mathbf{M}$ 和 $\\mathbf{M}_{\\mathrm{L}}$ 的组装。为了以一种与基无关的方式定量比较它们的特征值谱，构建对称正定 (SPD) 相似变换矩阵：\n$$\n\\mathbf{S} = \\mathbf{M}_{\\mathrm{L}}^{-\\frac{1}{2}}\\,\\mathbf{M}\\,\\mathbf{M}_{\\mathrm{L}}^{-\\frac{1}{2}},\n$$\n该矩阵的谱与 $\\mathbf{M}_{\\mathrm{L}}^{-1}\\mathbf{M}$ 的谱相等。对下面列出的每个测试网格，计算 $\\mathbf{S}$ 的最小和最大特征值。将每对结果以实数列表 $[\\lambda_{\\min}, \\lambda_{\\max}]$ 的形式报告。\n\n测试套件（按此顺序使用以下四个网格）：\n- 测试用例 1（单单元，均匀）：节点 $[0, 1]$。\n- 测试用例 2（均匀，多单元）：节点 $[0, \\tfrac{1}{4}, \\tfrac{1}{2}, \\tfrac{3}{4}, 1]$。\n- 测试用例 3（非均匀）：节点 $[0, 0.1, 0.3, 0.6, 1.0]$。\n- 测试用例 4（均匀，更精细）：节点 $[0, \\tfrac{1}{50}, \\tfrac{2}{50}, \\dots, 1]$。\n\n最终输出格式。您的程序应生成单行输出，其中包含一个以逗号分隔的列表的列表，结果顺序与测试用例相同，且不含空格。例如，要求的格式是：\n$[ [\\lambda_{\\min}^{(1)},\\lambda_{\\max}^{(1)}], [\\lambda_{\\min}^{(2)},\\lambda_{\\max}^{(2)}], [\\lambda_{\\min}^{(3)},\\lambda_{\\max}^{(3)}], [\\lambda_{\\min}^{(4)},\\lambda_{\\max}^{(4)}] ]$\n但不含空格。每个 $\\lambda_{\\min}^{(k)}$ 和 $\\lambda_{\\max}^{(k)}$ 都必须作为浮点数输出。此问题不涉及物理单位，也不需要角度或百分比。",
            "solution": "该问题基于标准的一维有限元方法，在覆盖 $\\Omega = [0,1]$ 的网格 $\\{x_i\\}_{i=0}^N$ 上使用分段线性基函数。质量矩阵表示基函数的 $L^2(\\Omega)$ 内积，“集中”变体则通过对每行求和来构造一个对角近似，以取代完整的矩阵。为了推导和实现比较，我们从第一性原理出发。\n\n帽函数的定义。对于每个节点 $x_i$，帽函数 $\\varphi_i(x)$ 是一个连续的分段线性函数，满足 $\\varphi_i(x_i) = 1$ 且对于所有 $j \\neq i$ 有 $\\varphi_i(x_j) = 0$。它的支撑集仅在 $[x_{i-1}, x_i] \\cup [x_i, x_{i+1}]$ 上（在边界处有明显的截断）。在任何长度为 $h_e = x_{e+1}-x_e$ 的单元 $[x_e, x_{e+1}]$ 上，恰好有两个非零的局部基函数，我们将其表示为 $\\hat{\\varphi}_1$ 和 $\\hat{\\varphi}_2$，使得 $\\hat{\\varphi}_1(x_e) = 1$，$\\hat{\\varphi}_1(x_{e+1}) = 0$，以及 $\\hat{\\varphi}_2(x_e) = 0$，$\\hat{\\varphi}_2(x_{e+1}) = 1$。根据线性关系，在该单元上并使用由 $\\xi = x - x_e$ 定义的局部坐标 $\\xi \\in [0,h_e]$，这些局部基函数为：\n$$\n\\hat{\\varphi}_1(\\xi) = 1 - \\frac{\\xi}{h_e}, \\quad \\hat{\\varphi}_2(\\xi) = \\frac{\\xi}{h_e}.\n$$\n\n单元级一致质量矩阵。单元级一致质量矩阵 $\\mathbf{M}^{(e)} \\in \\mathbb{R}^{2\\times 2}$ 由单元上局部基函数乘积的积分定义：\n$$\nM^{(e)}_{ij} = \\int_{x_e}^{x_{e+1}} \\hat{\\varphi}_i(x)\\,\\hat{\\varphi}_j(x)\\,dx = \\int_{0}^{h_e} \\hat{\\varphi}_i(\\xi)\\,\\hat{\\varphi}_j(\\xi)\\,d\\xi,\\quad i,j \\in \\{1,2\\}.\n$$\n根据定义直接计算这些积分可得：\n$$\n\\int_{0}^{h_e} \\left(1 - \\frac{\\xi}{h_e}\\right)^2 d\\xi = \\int_{0}^{h_e} \\left(1 - \\frac{2\\xi}{h_e} + \\frac{\\xi^2}{h_e^2}\\right) d\\xi\n= \\left[\\xi - \\frac{\\xi^2}{h_e} + \\frac{\\xi^3}{3 h_e^2}\\right]_0^{h_e} = \\frac{h_e}{3},\n$$\n$$\n\\int_{0}^{h_e} \\left(\\frac{\\xi}{h_e}\\right)^2 d\\xi = \\int_{0}^{h_e} \\frac{\\xi^2}{h_e^2} d\\xi = \\left[\\frac{\\xi^3}{3 h_e^2}\\right]_0^{h_e} = \\frac{h_e}{3},\n$$\n$$\n\\int_{0}^{h_e} \\left(1 - \\frac{\\xi}{h_e}\\right)\\left(\\frac{\\xi}{h_e}\\right) d\\xi\n= \\int_{0}^{h_e} \\left(\\frac{\\xi}{h_e} - \\frac{\\xi^2}{h_e^2}\\right) d\\xi\n= \\left[\\frac{\\xi^2}{2 h_e} - \\frac{\\xi^3}{3 h_e^2}\\right]_0^{h_e} = \\frac{h_e}{6}.\n$$\n因此，\n$$\n\\mathbf{M}^{(e)} = \\begin{bmatrix}\n\\frac{h_e}{3}  \\frac{h_e}{6} \\\\\n\\frac{h_e}{6}  \\frac{h_e}{3}\n\\end{bmatrix} \\;=\\; \\frac{h_e}{6} \\begin{bmatrix}\n2  1 \\\\ 1  2\n\\end{bmatrix}.\n$$\n\n全局一致质量矩阵的组装。全局矩阵 $\\mathbf{M} \\in \\mathbb{R}^{(N+1)\\times(N+1)}$ 是通过将每个单元的贡献累加到其端点全局节点索引对应的行和列中得到的。具体来说，对于具有全局节点 $(e, e+1)$ 的单元 $e$，我们加上：\n$$\nM_{e,e} \\mathrel{+}= \\frac{h_e}{3}, \\quad M_{e,e+1} \\mathrel{+}= \\frac{h_e}{6}, \\quad M_{e+1,e} \\mathrel{+}= \\frac{h_e}{6}, \\quad M_{e+1,e+1} \\mathrel{+}= \\frac{h_e}{3}.\n$$\n处理完所有单元后，$\\mathbf{M}$ 是对称正定 (SPD) 的。\n\n通过行和启发式方法得到的集中质量矩阵。集中质量矩阵 $\\mathbf{M}_{\\mathrm{L}}$ 定义为：\n$$\n(\\mathbf{M}_{\\mathrm{L}})_{ii} = \\sum_{j=0}^{N} M_{ij}, \\quad (\\mathbf{M}_{\\mathrm{L}})_{ij} = 0 \\text{ for } i \\neq j.\n$$\n等价地，可以从局部公式验证，每个单元 $[x_e, x_{e+1}]$ 为其两个端点节点的对角线元素各贡献 $\\frac{h_e}{2}$，因此对于内部节点 $i \\in \\{1,\\dots,N-1\\}$，有：\n$$\n(\\mathbf{M}_{\\mathrm{L}})_{ii} = \\frac{h_{i-1}}{2} + \\frac{h_{i}}{2},\n$$\n而对于边界节点，\n$$\n(\\mathbf{M}_{\\mathrm{L}})_{00} = \\frac{h_{0}}{2}, \\quad (\\mathbf{M}_{\\mathrm{L}})_{NN} = \\frac{h_{N-1}}{2}.\n$$\n对于分段线性单元，两种构造方法（对 $\\mathbf{M}$ 进行行求和或对单元级的贡献求和）会得到相同的对角矩阵。\n\n用于谱比较的相似变换。为了以与基无关的方式比较谱，构造：\n$$\n\\mathbf{S} = \\mathbf{M}_{\\mathrm{L}}^{-\\frac{1}{2}}\\,\\mathbf{M}\\,\\mathbf{M}_{\\mathrm{L}}^{-\\frac{1}{2}},\n$$\n该矩阵是 SPD 的，因为 $\\mathbf{M}$ 和 $\\mathbf{M}_{\\mathrm{L}}$ 都是 SPD 的，并且 $\\mathbf{M}_{\\mathrm{L}}^{-\\frac{1}{2}}$ 存在。$\\mathbf{S}$ 的特征值与 $\\mathbf{M}_{\\mathrm{L}}^{-1}\\mathbf{M}$ 的特征值相等，但 $\\mathbf{S}$ 是对称的，因此在使用对称特征求解器计算特征值时，数值上更可取。如果 $\\mathbf{M}$ 完全等于 $\\mathbf{M}_{\\mathrm{L}}$，则 $\\mathbf{S}$ 将是单位矩阵，所有特征值都等于 $1$。特征值与 $1$ 的偏差量化了一致质量矩阵和集中质量矩阵之间的差异。\n\n对每个测试用例网格 $\\{x_i\\}$ 的算法步骤：\n1. 对所有 $e \\in \\{0,\\dots,N-1\\}$，计算单元长度 $h_e = x_{e+1} - x_e$ 并验证 $h_e > 0$。\n2. 将 $\\mathbf{M}$ 初始化为 $\\mathbb{R}^{(N+1)\\times(N+1)}$ 中的零矩阵。\n3. 对于每个单元 $e$，将局部矩阵贡献 $\\frac{h_e}{6}\\begin{bmatrix}2  1 \\\\ 1  2\\end{bmatrix}$ 添加到全局项 $(e,e)$、$(e,e+1)$、$(e+1,e)$、$(e+1,e+1)$ 中。\n4. 通过对 $\\mathbf{M}$ 的行求和来构造 $\\mathbf{M}_{\\mathrm{L}}$ 的对角线元素，非对角线元素设为零。\n5. 利用对角线元素通过缩放行和列来高效地构造 $\\mathbf{S}$：如果 $\\mathbf{D} = \\operatorname{diag}(\\mathbf{M}_{\\mathrm{L}})$ 且 $\\mathbf{d} = \\operatorname{diag}(\\mathbf{D})$，则 $\\mathbf{S}_{ij} = \\mathbf{M}_{ij} / \\sqrt{d_i d_j}$。\n6. 使用对称特征求解器计算 $\\mathbf{S}$ 的最小和最大特征值。\n7. 按测试用例的顺序记录 $[\\lambda_{\\min}, \\lambda_{\\max}]$。\n\n单单元情况（测试用例 1）的解析检验。对于节点 $[0,1]$，我们有 $h_0 = 1$，所以：\n$$\n\\mathbf{M} = \\frac{1}{6}\\begin{bmatrix}2  1 \\\\ 1  2\\end{bmatrix} = \\begin{bmatrix}\\frac{1}{3}  \\frac{1}{6} \\\\ \\frac{1}{6}  \\frac{1}{3}\\end{bmatrix}, \\quad\n\\mathbf{M}_{\\mathrm{L}} = \\begin{bmatrix}\\frac{1}{2}  0 \\\\ 0  \\frac{1}{2}\\end{bmatrix}.\n$$\n则\n$$\n\\mathbf{S} = \\mathbf{M}_{\\mathrm{L}}^{-\\frac{1}{2}} \\mathbf{M} \\mathbf{M}_{\\mathrm{L}}^{-\\frac{1}{2}} = 2 \\mathbf{M} = \\begin{bmatrix}\\frac{2}{3}  \\frac{1}{3} \\\\ \\frac{1}{3}  \\frac{2}{3}\\end{bmatrix}.\n$$\n一个对角线元素相等（为 $a$）且非对角线元素为 $c$ 的对称 $2\\times 2$ 矩阵的特征值为 $a+c$ 和 $a-c$。这里 $a = \\frac{2}{3}$ 且 $c = \\frac{1}{3}$，所以特征值为 $1$ 和 $\\frac{1}{3}$。这为实现提供了一致性检查。\n\n实现说明。组装可以用 $\\mathcal{O}(N)$ 次操作完成。矩阵 $\\mathbf{S}$ 是通过用 $\\mathbf{M}_{\\mathrm{L}}$ 对角线元素平方根的倒数来缩放 $\\mathbf{M}$ 的行和列而构建的。特征值计算使用对称特征求解器，该求解器对于 SPD 矩阵是稳健的。对于所有四个测试用例，矩阵都较小且良态，因此直接进行密集计算是合适的。\n\n程序将完全按照规定构造四个网格，并打印单行输出，其中包含一个包含四个列表的列表，每个列表都包含相应测试用例的最小和最大特征值，且不含空格。第一对结果应在浮点舍入误差范围内与解析值 $[\\frac{1}{3}, 1]$ 匹配。其他几对将通过数值计算得出。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef assemble_consistent_mass(x):\n    \"\"\"\n    Assemble the global consistent mass matrix M for 1D linear finite elements\n    on the given strictly increasing node array x (length N+1).\n    Density rho = 1 is assumed.\n    Returns:\n        M: (N+1)x(N+1) symmetric positive definite numpy array\n    \"\"\"\n    x = np.asarray(x, dtype=float)\n    N = len(x) - 1  # number of elements\n    n_nodes = N + 1\n    M = np.zeros((n_nodes, n_nodes), dtype=float)\n    for e in range(N):\n        h = x[e+1] - x[e]\n        if h = 0:\n            raise ValueError(\"Node coordinates must be strictly increasing.\")\n        # Local consistent mass matrix for linear element: h/6 * [[2,1],[1,2]]\n        m00 = h / 3.0\n        m01 = h / 6.0\n        m11 = h / 3.0\n        i = e\n        j = e + 1\n        M[i, i] += m00\n        M[i, j] += m01\n        M[j, i] += m01\n        M[j, j] += m11\n    return M\n\ndef lump_mass_by_rowsum(M):\n    \"\"\"\n    Construct lumped mass matrix diagonal by row-sum heuristic.\n    Returns:\n        diag: 1D numpy array of diagonal entries of lumped mass matrix\n    \"\"\"\n    # Row-sum of M yields the diagonal of the lumped mass matrix for linear elements\n    diag = M.sum(axis=1)\n    # Ensure strict positivity\n    if np.any(diag = 0):\n        raise ValueError(\"Lumped mass diagonal must be strictly positive.\")\n    return diag\n\ndef scaled_similarity_matrix(M, lump_diag):\n    \"\"\"\n    Form S = D^{-1/2} M D^{-1/2}, where D = diag(lump_diag).\n    Returns:\n        S: symmetric similarity-transformed matrix\n    \"\"\"\n    inv_sqrt = 1.0 / np.sqrt(lump_diag)\n    # Efficient symmetric scaling: S_ij = M_ij / sqrt(d_i * d_j)\n    S = (inv_sqrt[:, None] * M) * inv_sqrt[None, :]\n    # Symmetrize numerically to avoid tiny asymmetry due to floating point ops\n    S = 0.5 * (S + S.T)\n    return S\n\ndef eigen_extremes_symmetric(S):\n    \"\"\"\n    Compute the smallest and largest eigenvalues of a symmetric matrix S.\n    Returns:\n        (lam_min, lam_max)\n    \"\"\"\n    # Using eigh for symmetric matrices; returns sorted eigenvalues\n    evals = np.linalg.eigvalsh(S)\n    return float(evals[0]), float(evals[-1])\n\ndef format_nested_no_spaces(nested):\n    \"\"\"\n    Format a nested list (list of lists of floats) without spaces, like JSON.\n    \"\"\"\n    def format_number(x):\n        # Use a compact representation while preserving precision reasonably\n        return f\"{x:.16g}\"\n    parts = []\n    parts.append(\"[\")\n    for i, sub in enumerate(nested):\n        parts.append(\"[\")\n        parts.append(\",\".join(format_number(v) for v in sub))\n        parts.append(\"]\")\n        if i != len(nested) - 1:\n            parts.append(\",\")\n    parts.append(\"]\")\n    return \"\".join(parts)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1: single element, uniform\n        [0.0, 1.0],\n        # Test case 2: uniform, multiple elements (4 elements)\n        [0.0, 0.25, 0.5, 0.75, 1.0],\n        # Test case 3: non-uniform\n        [0.0, 0.1, 0.3, 0.6, 1.0],\n        # Test case 4: uniform, finer (50 elements -> 51 nodes)\n        list(np.linspace(0.0, 1.0, 51)),\n    ]\n\n    results = []\n    for x in test_cases:\n        M = assemble_consistent_mass(x)\n        lump_diag = lump_mass_by_rowsum(M)\n        S = scaled_similarity_matrix(M, lump_diag)\n        lam_min, lam_max = eigen_extremes_symmetric(S)\n        results.append([lam_min, lam_max])\n\n    # Final print statement in the exact required format (no spaces).\n    print(format_nested_no_spaces(results))\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}