{
    "hands_on_practices": [
        {
            "introduction": "To truly understand the difference between conservation and non-conservation forms, we must see it in action. This first practice provides a direct, hands-on test of the core principle. You will prove analytically why a finite volume scheme built on the conservation form, $u_t + (f(u))_x = 0$, naturally preserves the total quantity of $u$, and then demonstrate why a seemingly equivalent scheme based on the non-conservation form, $u_t + u u_x = 0$, fails to do so . By implementing both, you will numerically verify this fundamental distinction, observing how one method conserves mass to machine precision while the other produces significant error.",
            "id": "2379409",
            "problem": "Consider the scalar, inviscid Burgers’ equation written in two algebraically equivalent but numerically distinct forms on the periodic one-dimensional domain $[0,1)$:\n1) Conservation form: $u_t + (f(u))_x = 0$ with $f(u) = \\frac{u^2}{2}$.\n2) Nonconservation form: $u_t + u\\,u_x = 0$.\n\nYour tasks are:\nA) Starting from the integral conservation law and a cell-averaged viewpoint, derive a fully discrete finite volume update for the conservation form using a numerical interface flux. Use the following discrete update on a uniform mesh with $N$ cells of width $\\Delta x = 1/N$ and periodic boundary conditions:\n$$\nu_i^{n+1} \\;=\\; u_i^n \\;-\\; \\frac{\\Delta t}{\\Delta x}\\left(F_{i+\\tfrac{1}{2}}^n - F_{i-\\tfrac{1}{2}}^n\\right),\n$$\nwith the Rusanov (local Lax–Friedrichs) numerical flux\n$$\nF_{i+\\tfrac{1}{2}}^n \\;=\\; \\tfrac{1}{2}\\left(f(u_i^n) + f(u_{i+1}^n)\\right) \\;-\\; \\tfrac{1}{2}\\, a_{i+\\tfrac{1}{2}}^n \\left(u_{i+1}^n - u_i^n\\right),\n\\quad f(u) = \\tfrac{u^2}{2},\n\\quad a_{i+\\tfrac{1}{2}}^n = \\max\\left(\\lvert u_i^n\\rvert, \\lvert u_{i+1}^n\\rvert\\right).\n$$\nProve from first principles (the discrete divergence theorem on a periodic mesh) that the total discrete mass\n$$\nM^n \\;=\\; \\sum_{i=0}^{N-1} u_i^n \\,\\Delta x\n$$\nis exactly conserved for all time steps $n$, that is, $M^{n+1} = M^n$.\n\nB) Consider the nonconservation form $u_t + u\\,u_x = 0$ discretized at cell centers with a forward finite difference for the spatial derivative and forward Euler in time:\n$$\nu_i^{n+1} \\;=\\; u_i^n \\;-\\; \\Delta t\\,u_i^n\\,\\frac{u_{i+1}^n - u_i^n}{\\Delta x},\n$$\nwith periodic indexing $u_{N}^n \\equiv u_0^n$. Show analytically that, in general, the total discrete mass $M^n$ is not invariant under this update by expressing $M^{n+1} - M^n$ in terms of the discrete field $u_i^n$ and demonstrating that it does not vanish for generic data.\n\nC) Implementation task. Write a complete, runnable program that:\n- Uses periodic boundary conditions on $[0,1)$ and a uniform grid with cell centers at $x_i = \\left(i + \\tfrac{1}{2}\\right)\\Delta x$.\n- Uses forward Euler in time for both updates.\n- Uses a time step chosen dynamically each step by the Courant–Friedrichs–Lewy (CFL) rule\n$$\n\\Delta t \\;=\\; \\text{CFL}\\cdot \\frac{\\Delta x}{\\max_i \\lvert u_i^n\\rvert + 10^{-12}},\n$$\nwith the minimum added only to avoid division by zero.\n- Evolves to a specified final time $T$.\n\nTest suite. For each test, return a single floating-point number equal to the mass difference $\\Delta M = M^{\\text{final}} - M^{\\text{initial}}$. Use the following tests:\n- Test 1 (conservative scheme): $N = 200$, $\\text{CFL} = 0.9$, $T = 0.1$, initial condition $u(x,0) = 0.5 + 0.5\\sin(2\\pi x)$. Expect $\\Delta M$ to be approximately zero to machine precision due to exact telescoping of the flux differences on a periodic mesh.\n- Test 2 (nonconservative scheme): $N = 200$, $\\text{CFL} = 0.4$, $T = 0.1$, initial condition $u(x,0) = 0.5 + 0.5\\sin(2\\pi x)$. Expect $\\Delta M$ to be nonzero.\n- Test 3 (nonconservative scheme): $N = 200$, $\\text{CFL} = 0.4$, $T = 0.1$, initial condition $u(x,0) = \\sin(2\\pi x)$. Expect $\\Delta M$ to be nonzero.\n\nFinal output format. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[r1,r2,r3]\"), where each $r_k$ is the floating-point mass difference for the corresponding test in the exact order listed above. No additional text should be printed. There are no physical units in this problem; all quantities are nondimensional.",
            "solution": "The problem as stated is subjected to validation.\n\n**Step 1: Extract Givens**\n- **Equations:**\n    1. Conservation form: $u_t + (\\frac{u^2}{2})_x = 0$.\n    2. Nonconservation form: $u_t + u\\,u_x = 0$.\n- **Domain:** Periodic, $[0,1)$.\n- **Task A (Conservative Scheme):**\n    - Finite volume update: $u_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+\\tfrac{1}{2}}^n - F_{i-\\tfrac{1}{2}}^n\\right)$.\n    - Rusanov numerical flux: $F_{i+\\tfrac{1}{2}}^n = \\tfrac{1}{2}\\left(f(u_i^n) + f(u_{i+1}^n)\\right) - \\tfrac{1}{2}\\, a_{i+\\tfrac{1}{2}}^n \\left(u_{i+1}^n - u_i^n\\right)$, with $f(u) = \\tfrac{u^2}{2}$ and $a_{i+\\tfrac{1}{2}}^n = \\max\\left(\\lvert u_i^n\\rvert, \\lvert u_{i+1}^n\\rvert\\right)$.\n    - Discrete mass: $M^n = \\sum_{i=0}^{N-1} u_i^n \\,\\Delta x$.\n    - Objective: Prove $M^{n+1} = M^n$.\n- **Task B (Nonconservative Scheme):**\n    - Discretization: $u_i^{n+1} = u_i^n - \\Delta t\\,u_i^n\\,\\frac{u_{i+1}^n - u_i^n}{\\Delta x}$, with periodic index $u_N^n \\equiv u_0^n$.\n    - Objective: Show $M^{n+1} \\neq M^n$ in general.\n- **Task C (Implementation):**\n    - Grid: Uniform with $N$ cells, centers at $x_i = \\left(i + \\tfrac{1}{2}\\right)\\Delta x$, where $\\Delta x = 1/N$.\n    - Time step: $\\Delta t = \\text{CFL}\\cdot \\frac{\\Delta x}{\\max_i \\lvert u_i^n\\rvert + 10^{-12}}$.\n    - Final time: $T$.\n- **Test Suite:**\n    - Test $1$: Conservative, $N=200$, $\\text{CFL}=0.9$, $T=0.1$, $u(x,0) = 0.5 + 0.5\\sin(2\\pi x)$.\n    - Test $2$: Nonconservative, $N=200$, $\\text{CFL}=0.4$, $T=0.1$, $u(x,0) = 0.5 + 0.5\\sin(2\\pi x)$.\n    - Test $3$: Nonconservative, $N=200$, $\\text{CFL}=0.4$, $T=0.1$, $u(x,0) = \\sin(2\\pi x)$.\n- **Output:** Mass difference $\\Delta M = M^{\\text{final}} - M^{\\text{initial}}$ for each test.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is well-defined, scientifically sound, and objective. It addresses fundamental concepts of numerical methods for conservation laws, specifically the distinction between conservative and nonconservative discretizations of the Burgers' equation. All parameters and conditions required for both the analytical derivations and the numerical implementation are provided. The problem is a standard exercise in computational mathematics and engineering.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A rigorous solution will be provided.\n\n---\n\n**A) Proof of Mass Conservation for the Conservative Scheme**\n\nThe total discrete mass at time step $n+1$ is defined as\n$$\nM^{n+1} = \\sum_{i=0}^{N-1} u_i^{n+1} \\Delta x.\n$$\nSubstituting the finite volume update rule for $u_i^{n+1}$:\n$$\nM^{n+1} = \\sum_{i=0}^{N-1} \\left[ u_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+\\tfrac{1}{2}}^n - F_{i-\\tfrac{1}{2}}^n\\right) \\right] \\Delta x.\n$$\nDistributing the summation and the $\\Delta x$ term:\n$$\nM^{n+1} = \\sum_{i=0}^{N-1} u_i^n \\Delta x - \\Delta t \\sum_{i=0}^{N-1} \\left(F_{i+\\tfrac{1}{2}}^n - F_{i-\\tfrac{1}{2}}^n\\right).\n$$\nThe first term is the total mass at time step $n$, $M^n$. The equation becomes:\n$$\nM^{n+1} = M^n - \\Delta t \\sum_{i=0}^{N-1} \\left(F_{i+\\tfrac{1}{2}}^n - F_{i-\\tfrac{1}{2}}^n\\right).\n$$\nTo prove conservation, we must show that the summation term vanishes. The sum is a discrete analogue of an integral of a divergence over a domain. Let us expand the sum:\n$$\n\\sum_{i=0}^{N-1} \\left(F_{i+\\tfrac{1}{2}}^n - F_{i-\\tfrac{1}{2}}^n\\right) = \\left(F_{\\tfrac{1}{2}}^n - F_{-\\tfrac{1}{2}}^n\\right) + \\left(F_{\\tfrac{3}{2}}^n - F_{\\tfrac{1}{2}}^n\\right) + \\left(F_{\\tfrac{5}{2}}^n - F_{\\tfrac{3}{2}}^n\\right) + \\dots + \\left(F_{N-\\tfrac{1}{2}}^n - F_{N-\\tfrac{3}{2}}^n\\right).\n$$\nThis is a telescoping sum. The terms cancel out pairwise: the positive $F_{i+\\tfrac{1}{2}}^n$ from cell $i$ cancels the negative $F_{j-\\tfrac{1}{2}}^n$ from cell $j=i+1$. Let us formalize this. Let the numerical flux function be denoted by $\\mathcal{F}(u_L, u_R)$, such that $F_{i+\\tfrac{1}{2}}^n = \\mathcal{F}(u_i^n, u_{i+1}^n)$. The sum over all cells $i = 0, \\dots, N-1$ is:\n$$\n\\sum_{i=0}^{N-1} \\left( \\mathcal{F}(u_i^n, u_{i+1}^n) - \\mathcal{F}(u_{i-1}^n, u_i^n) \\right).\n$$\nDue to the periodic boundary conditions, the grid indices are interpreted modulo $N$. Specifically, $u_{N}^n = u_0^n$ and $u_{-1}^n = u_{N-1}^n$.\nLet's examine the sum by re-indexing. Let $G_i = \\mathcal{F}(u_{i-1}^n, u_i^n)$. The sum is $\\sum_{i=0}^{N-1} G_{i+1} - \\sum_{i=0}^{N-1} G_i$.\nLet us change the index in the first sum, $j=i+1$. When $i=0$, $j=1$; when $i=N-1$, $j=N$. So $\\sum_{j=1}^{N} G_j$.\nThe sum becomes $\\sum_{j=1}^{N} G_j - \\sum_{i=0}^{N-1} G_i = (G_1 + \\dots + G_{N-1} + G_N) - (G_0 + G_1 + \\dots + G_{N-1}) = G_N - G_0$.\nBy definition, $G_N = \\mathcal{F}(u_{N-1}^n, u_N^n)$ and $G_0 = \\mathcal{F}(u_{-1}^n, u_0^n)$.\nUsing periodicity, $u_N^n = u_0^n$ and $u_{-1}^n = u_{N-1}^n$.\nTherefore, $G_N = \\mathcal{F}(u_{N-1}^n, u_0^n)$ and $G_0 = \\mathcal{F}(u_{N-1}^n, u_0^n)$.\nThus, $G_N - G_0 = 0$.\nThe sum of flux differences over the periodic domain is identically zero. This is a manifestation of the discrete divergence theorem on a discrete torus.\nConsequently,\n$$\nM^{n+1} = M^n - \\Delta t \\cdot 0 = M^n.\n$$\nThe total discrete mass is exactly conserved at every time step, regardless of the specific form of the consistent and conservative numerical flux $\\mathcal{F}$. This concludes the proof.\n\n**B) Analysis of Mass Conservation for the Nonconservative Scheme**\n\nThe nonconservative scheme is given by the update rule:\n$$\nu_i^{n+1} = u_i^n - \\Delta t\\,u_i^n\\,\\frac{u_{i+1}^n - u_i^n}{\\Delta x}.\n$$\nThe change in total discrete mass from time step $n$ to $n+1$ is\n$$\nM^{n+1} - M^n = \\sum_{i=0}^{N-1} \\left(u_i^{n+1} - u_i^n\\right) \\Delta x.\n$$\nSubstituting the expression for $u_i^{n+1} - u_i^n$ from the update rule:\n$$\nM^{n+1} - M^n = \\sum_{i=0}^{N-1} \\left( -\\Delta t\\,u_i^n\\,\\frac{u_{i+1}^n - u_i^n}{\\Delta x} \\right) \\Delta x.\n$$\nThe $\\Delta x$ terms cancel:\n$$\nM^{n+1} - M^n = -\\Delta t \\sum_{i=0}^{N-1} u_i^n \\left(u_{i+1}^n - u_i^n\\right).\n$$\nExpanding the product inside the summation:\n$$\nM^{n+1} - M^n = -\\Delta t \\sum_{i=0}^{N-1} \\left( u_i^n u_{i+1}^n - (u_i^n)^2 \\right) = \\Delta t \\left( \\sum_{i=0}^{N-1} (u_i^n)^2 - \\sum_{i=0}^{N-1} u_i^n u_{i+1}^n \\right).\n$$\nThe index $i+1$ is taken modulo $N$ due to periodic boundary conditions. For mass to be conserved, the term in the parenthesis must be zero.\n$$\n\\sum_{i=0}^{N-1} (u_i^n)^2 - \\sum_{i=0}^{N-1} u_i^n u_{i+1}^n = 0.\n$$\nThis condition is not satisfied for generic field data $u_i^n$. Consider a simple case with $N=2$. The condition becomes:\n$$\n(u_0^n)^2 + (u_1^n)^2 - (u_0^n u_1^n + u_1^n u_0^n) = (u_0^n-u_1^n)^2 = 0,\n$$\nwhich requires $u_0^n=u_1^n$. For a nontrivial field where values are not all equal, e.g., $u_0^n=1$ and $u_1^n=2$, the expression is $(1-2)^2=1 \\neq 0$. The mass is not conserved.\nThe algebraic equivalence of the continuous equations $u_t + (u^2/2)_x = 0$ and $u_t + u u_x = 0$ relies on the chain rule, which is valid only for smooth solutions. Discretizations of the nonconservation form do not inherit the conservation property of the original integral law and fail to capture the correct physics (e.g., shock speeds) when discontinuities arise. This derivation demonstrates that failure at the discrete level.\n\n**C) Numerical Implementation**\n\nThe implementation will consist of two primary functions: one for the conservative finite volume scheme and one for the nonconservative finite difference scheme. Both will use a forward Euler time-stepping method with a dynamic time step determined by the CFL condition.\n\n- **Grid and State:** A uniform grid on $[0, 1)$ with $N$ cells is used. The state vector `u` stores the cell-averaged values $u_i$. Periodic boundary conditions are handled using array-shifting operations (e.g., `numpy.roll`).\n- **Conservative Scheme:** The update requires computing the Rusanov flux $F_{i+\\frac{1}{2}}$ at each cell interface. This is vectorized by creating shifted versions of the state vector `u` to represent $u_{i+1}$. The fluxes are computed for all interfaces simultaneously. The update for $u_i$ involves the difference of fluxes at its right and left boundaries, $F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}$. This is also vectorized by computing a vector of fluxes `F` and a shifted version `numpy.roll(F, 1)`.\n- **Nonconservative Scheme:** The update is simpler. The spatial derivative term $u_x$ is approximated by a forward difference, $\\frac{u_{i+1}-u_i}{\\Delta x}$. This is vectorized using `numpy.roll` to get the $u_{i+1}$ values.\n- **Time Loop:** For each test case, the system is initialized with the given initial condition and evolved from $t=0$ to the final time $T$. In each step, the maximum wave speed $\\max_i|u_i^n|$ is found to compute a stable $\\Delta t$ according to the CFL rule, ensuring that the time step does not exceed the remaining time to reach $T$.\n- **Mass Calculation:** The initial mass $M^{\\text{initial}}$ is computed before the time loop. The final mass $M^{\\text{final}}$ is computed after the loop finishes. The difference $\\Delta M = M^{\\text{final}} - M^{\\text{initial}}$ is then reported for each test. For Test $1$, this value is expected to be near machine precision, confirming the analytical proof. For Tests $2$ and $3$, nonzero values are expected.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_conservative(N, CFL, T, u0_func):\n    \"\"\"\n    Solves the Burgers' equation using the conservative finite volume scheme.\n    \"\"\"\n    dx = 1.0 / N\n    x = (np.arange(N) + 0.5) * dx\n    u = u0_func(x)\n\n    M_initial = np.sum(u) * dx\n    \n    t = 0.0\n    while t < T:\n        max_abs_u = np.max(np.abs(u))\n        dt = CFL * dx / (max_abs_u + 1e-12)\n        if t + dt > T:\n            dt = T - t\n        \n        # Periodic boundary conditions via np.roll\n        u_right = np.roll(u, -1) # u_{i+1}\n\n        # Physical flux f(u) = u^2 / 2\n        f_u = 0.5 * u**2\n        f_u_right = 0.5 * u_right**2\n\n        # Rusanov flux (Local Lax-Friedrichs)\n        # a_{i+1/2} = max(|u_i|, |u_{i+1}|)\n        a = np.maximum(np.abs(u), np.abs(u_right))\n        \n        # F_{i+1/2}\n        flux = 0.5 * (f_u + f_u_right) - 0.5 * a * (u_right - u)\n        \n        # F_{i-1/2} via roll\n        flux_left = np.roll(flux, 1)\n\n        # Update u\n        u = u - (dt / dx) * (flux - flux_left)\n        \n        t += dt\n    \n    M_final = np.sum(u) * dx\n    return M_final - M_initial\n\ndef run_nonconservative(N, CFL, T, u0_func):\n    \"\"\"\n    Solves the Burgers' equation using the nonconservative finite difference scheme.\n    \"\"\"\n    dx = 1.0 / N\n    x = (np.arange(N) + 0.5) * dx\n    u = u0_func(x)\n\n    M_initial = np.sum(u) * dx\n\n    t = 0.0\n    while t < T:\n        max_abs_u = np.max(np.abs(u))\n        dt = CFL * dx / (max_abs_u + 1e-12)\n        if t + dt > T:\n            dt = T - t\n        \n        # Periodic boundary conditions for u_{i+1}\n        u_right = np.roll(u, -1)\n\n        # Forward difference for u_x\n        ux = (u_right - u) / dx\n\n        # Update u\n        u = u - dt * u * ux\n        \n        t += dt\n\n    M_final = np.sum(u) * dx\n    return M_final - M_initial\n\n\ndef solve():\n    \"\"\"\n    Executes the test suite and prints the results.\n    \"\"\"\n    test_cases = [\n        {\n            \"scheme\": \"conservative\",\n            \"N\": 200, \"CFL\": 0.9, \"T\": 0.1,\n            \"u0_func\": lambda x: 0.5 + 0.5 * np.sin(2 * np.pi * x)\n        },\n        {\n            \"scheme\": \"nonconservative\",\n            \"N\": 200, \"CFL\": 0.4, \"T\": 0.1,\n            \"u0_func\": lambda x: 0.5 + 0.5 * np.sin(2 * np.pi * x)\n        },\n        {\n            \"scheme\": \"nonconservative\",\n            \"N\": 200, \"CFL\": 0.4, \"T\": 0.1,\n            \"u0_func\": lambda x: np.sin(2 * np.pi * x)\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        if case[\"scheme\"] == \"conservative\":\n            delta_M = run_conservative(case[\"N\"], case[\"CFL\"], case[\"T\"], case[\"u0_func\"])\n        else:\n            delta_M = run_nonconservative(case[\"N\"], case[\"CFL\"], case[\"T\"], case[\"u0_func\"])\n        results.append(delta_M)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Having established that non-conservative schemes fail to conserve mass, we now ask: what is the physical consequence? This practice focuses on the most critical ramification for hyperbolic systems: the incorrect speed of shock waves. You will set up a simulation of the Burgers' equation with a shock and compare a conservative scheme's result against a non-conservative one . By tracking the shock's position over time, you will see how the conservative method correctly captures the propagation speed dictated by the Rankine-Hugoniot condition, while the non-conservative method's solution diverges, leading to a physically incorrect result.",
            "id": "2379415",
            "problem": "Consider the scalar conservation law and its nonconservative counterpart on a one-dimensional domain:\n1) Conservation form: $\\partial_t u + \\partial_x f(u) = 0$ with $f(u) = \\frac{1}{2} u^2$.\n2) Nonconservation (advective) form: $\\partial_t u + u \\, \\partial_x u = 0$.\n\nOn the spatial interval $[0,L]$ with $L = 6$, impose piecewise-constant initial data with a single discontinuity located at $x = x_0$, with $x_0 = 1$. Let the left and right constant states be $u_L$ and $u_R$, respectively, so that\n$$\nu(x,0) = \\begin{cases}\nu_L, & x < x_0,\\\\\nu_R, & x \\ge x_0.\n\\end{cases}\n$$\nImpose fixed boundary states (Dirichlet in time) $u(0,t) = u_L$ and $u(L,t) = u_R$ for all $t \\ge 0$.\n\nFor the conservation-law problem with $u_L > u_R$, $u_L \\ge 0$, and $u_R \\ge 0$, the unique entropy solution is a shock that propagates with Rankine–Hugoniot speed $s = \\frac{f(u_L) - f(u_R)}{u_L - u_R} = \\frac{u_L + u_R}{2}$, so the exact shock position is $x_{\\text{exact}}(t) = x_0 + s \\, t$.\n\nTask. Implement two explicit, first-order-in-time, finite-difference or finite-volume semi-discrete approximations on a uniform grid with $N$ cells, where $N = 1200$, grid spacing $\\Delta x = L/N$, and a shared time step $\\Delta t$ chosen dynamically so that a Courant–Friedrichs–Lewy (CFL) number strictly less than $1$ is respected at every step. Use the same $\\Delta t$ at each step for both approximations.\n- One approximation must be conservative for the conservation form $\\partial_t u + \\partial_x f(u) = 0$, meaning its update over each time step can be written in a telescoping flux-difference form that preserves the discrete total integral of $u$ in the absence of boundary flux changes.\n- The other approximation must discretize the nonconservation form $\\partial_t u + u \\, \\partial_x u = 0$ in a way that is not conservative, meaning it cannot be written as a telescoping flux difference and therefore does not, in general, preserve the discrete total integral of $u$.\n\nEvolve both approximations from $t=0$ to $t=T$ on the same grid. At the final time $t = T$, approximate the shock position $x_{\\text{num}}$ from each numerical solution as the unique location where $u(x,T)$ equals the midpoint value $\\frac{u_L + u_R}{2}$, determined by linear interpolation between adjacent grid nodes that straddle this midpoint; if no such straddling occurs, take the grid location where $|u(x,T) - \\frac{u_L + u_R}{2}|$ is minimized.\n\nFor each test case below, compute the signed error of the nonconservative approximation’s shock position relative to the exact shock position, defined as $E_{\\text{nc}} = x_{\\text{nc}}(T) - x_{\\text{exact}}(T)$, expressed in the same spatial units as $x$ (dimensionless here). Positive $E_{\\text{nc}}$ indicates that the nonconservative approximation’s shock is to the right of the exact location; negative indicates it is to the left. Use $L = 6$, $x_0 = 1$, $N = 1200$, and a fixed Courant–Friedrichs–Lewy (CFL) number of $0.45$ for time stepping. Assume $u_L \\ge 0$ and $u_R \\ge 0$ in all cases.\n\nTest Suite. Use the following parameter sets, each a triple $(u_L, u_R, T)$:\n- Case $1$: $(2.0, 0.0, 0.5)$.\n- Case $2$: $(2.0, 0.0, 2.0)$.\n- Case $3$: $(2.0, 0.0, 4.0)$.\n- Case $4$: $(1.5, 0.2, 4.0)$.\n\nFinal Output Format. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the cases above:\n$[E_{\\text{nc}}^{(1)}, E_{\\text{nc}}^{(2)}, E_{\\text{nc}}^{(3)}, E_{\\text{nc}}^{(4)}]$.",
            "solution": "The problem as stated is subjected to validation.\n\n**Step 1: Extracted Givens**\n- Governing Equations:\n  1. Conservation Form: $\\partial_t u + \\partial_x f(u) = 0$, with flux function $f(u) = \\tfrac{1}{2} u^2$.\n  2. Nonconservation Form: $\\partial_t u + u \\, \\partial_x u = 0$.\n- Domain and Parameters: Spatial interval $x \\in [0,L]$ with $L=6$; number of grid cells $N=1200$; grid spacing $\\Delta x = L/N$.\n- Initial Condition (IC): A Riemann problem with a discontinuity at $x_0=1$.\n  $$\nu(x,0) = \\begin{cases} u_L, & x < x_0 \\\\ u_R, & x \\ge x_0 \\end{cases}\n$$\n- Boundary Conditions (BCs): $u(0,t) = u_L$ and $u(L,t) = u_R$ for $t \\ge 0$.\n- Solution Properties: The problem considers cases where $u_L > u_R$ and $u_L, u_R \\ge 0$, for which the entropy solution is a shock wave.\n- Exact Shock Propagation: Rankine-Hugoniot speed $s = \\frac{f(u_L) - f(u_R)}{u_L - u_R} = \\frac{u_L + u_R}{2}$. Exact position is $x_{\\text{exact}}(t) = x_0 + s \\, t$.\n- Numerical Method Requirements:\n  - Two explicit, first-order-in-time semi-discrete approximations. One must be conservative, the other non-conservative.\n  - A shared, dynamic time step $\\Delta t$ is computed at each step using a Courant–Friedrichs–Lewy (CFL) number of $0.45$.\n- Task:\n  - Evolve both numerical approximations from $t=0$ to a final time $t=T$.\n  - At $t=T$, determine the numerical shock position $x_{\\text{num}}$ from each solution. The position is defined as the location where $u(x,T) = \\frac{u_L + u_R}{2}$, found via linear interpolation. If no grid cells straddle this value, the position is the grid point where $|u(x,T) - \\frac{u_L + u_R}{2}|$ is minimized.\n  - Compute the signed error for the non-conservative scheme: $E_{\\text{nc}} = x_{\\text{nc}}(T) - x_{\\text{exact}}(T)$.\n- Test Suite: Parameters $(u_L, u_R, T)$ are provided for four distinct cases.\n\n**Step 2: Validation of Problem Statement**\nThe problem is subjected to scrutiny based on scientific and mathematical principles.\n- **Scientific Grounding**: The problem addresses the inviscid Burgers' equation, a fundamental and non-trivial model equation in the study of hyperbolic partial differential equations and fluid dynamics. The distinction between conservative and non-conservative numerical schemes and their differing convergence properties for discontinuous solutions (shocks) is a cornerstone of computational physics. The problem is scientifically sound.\n- **Well-Posedness**: The initial-boundary value problem for a scalar hyperbolic conservation law is well-posed. For the specified condition $u_L > u_R$ and convex flux $f(u) = \\frac{1}{2}u^2$, the analytical solution is a unique, stable shock wave. The numerical task is explicitly defined with all necessary parameters, rendering it unambiguous.\n- **Objectivity**: The problem is articulated using precise, objective mathematical language, free from any subjective or speculative content.\n\n**Step 3: Verdict**\nThe problem is valid. It is a well-defined exercise in numerical analysis that demonstrates a critical principle: non-conservative numerical schemes fail to converge to the correct weak solution for problems with shocks, specifically by propagating discontinuities at an incorrect speed. We proceed with the solution.\n\n**Principle-Based Solution**\n\nThe objective is to compare the shock propagation in numerical solutions of the Burgers' equation obtained from a conservative scheme versus a non-conservative one. This demonstrates the critical importance of the conservation form for capturing correct shock physics.\n\n**1. Discretization of the Domain**\nThe spatial domain $[0, L]$ is discretized into $N$ uniform cells. We use a cell-centered finite volume/difference approach. The cells are indexed by $i = 0, 1, \\dots, N-1$. The center of cell $i$ is located at $x_i = (i + 0.5)\\Delta x$, where $\\Delta x = L/N$. The discrete solution variable $U_i(t)$ represents the cell average of $u(x,t)$ over cell $i$.\n\n**2. Conservative Numerical Scheme**\nThe conservation form $\\partial_t u + \\partial_x f(u) = 0$ is the correct starting point for problems admitting shock solutions. Integrating over a control volume (cell $i$) from $x_{i-1/2}$ to $x_{i+1/2}$ yields:\n$$ \\frac{d}{dt} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t) \\,dx + f(u(x_{i+1/2},t)) - f(u(x_{i-1/2},t)) = 0 $$\nDefining the cell average $U_i(t) = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t) \\,dx$ and numerical fluxes $F_{i\\pm1/2}$ at cell interfaces, we obtain the semi-discrete finite volume form:\n$$ \\frac{d U_i}{dt} = -\\frac{1}{\\Delta x} (F_{i+1/2} - F_{i-1/2}) $$\nThis form is manifestly conservative: when summed over all cells, the internal fluxes cancel in a telescoping manner, ensuring that the total quantity $\\sum_i U_i \\Delta x$ changes only due to boundary fluxes.\n\nFor a first-order scheme, we use an upwind flux. The characteristic speed is $f'(u) = u$. Given $u_L, u_R \\ge 0$, the solution $u(x,t)$ remains non-negative, and information propagates from left to right. The upwind flux at interface $i+1/2$ is therefore determined by the state to its left, $U_i$.\n$$ F_{i+1/2} = f(U_i) = \\frac{1}{2} U_i^2 $$\nSubstituting this into the semi-discrete form gives:\n$$ \\frac{d U_i}{dt} = -\\frac{1}{\\Delta x} (f(U_i) - f(U_{i-1})) $$\nApplying explicit Euler time integration ($U_i^{n+1} = U_i^n + \\Delta t \\frac{d U_i}{dt}|_n$) yields the fully discrete conservative scheme:\n$$ U_{i,\\text{c}}^{n+1} = U_{i,\\text{c}}^n - \\frac{\\Delta t}{\\Delta x} \\left( \\frac{1}{2}(U_{i,\\text{c}}^n)^2 - \\frac{1}{2}(U_{i-1,\\text{c}}^n)^2 \\right) $$\n\n**3. Non-Conservative Numerical Scheme**\nThe non-conservation form $\\partial_t u + u \\partial_x u = 0$ is mathematically equivalent to the conservation form for smooth solutions, but this equivalence breaks down at discontinuities. A numerical scheme based on this form is not guaranteed to satisfy the integral conservation property and will generally compute incorrect shock speeds.\n\nWe discretize this equation directly. Using explicit Euler for time and a first-order upwind (backward) difference for the spatial derivative $\\partial_x u$ to respect the direction of information flow:\n$$ \\frac{U_i^{n+1} - U_i^n}{\\Delta t} + U_i^n \\frac{U_i^n - U_{i-1}^n}{\\Delta x} = 0 $$\nThis gives the fully discrete non-conservative scheme:\n$$ U_{i,\\text{nc}}^{n+1} = U_{i,\\text{nc}}^n - \\frac{\\Delta t}{\\Delta x} U_{i,\\text{nc}}^n (U_{i,\\text{nc}}^n - U_{i-1,\\text{nc}}^n) $$\nThis update rule cannot be written in the flux-difference form required for conservation.\n\n**4. Boundary and Initial Conditions**\n- **Initial Condition:** The piecewise constant initial data is mapped onto the grid by setting $U_i(0) = u_L$ for cell centers $x_i < x_0$ and $U_i(0) = u_R$ for $x_i \\ge x_0$. For $x_0 = 1$ and $N=1200$, the discontinuity falls between cells $i=199$ and $i=200$.\n- **Boundary Conditions:** For $u > 0$, the boundary at $x=0$ is an inflow boundary, while $x=L$ is an outflow boundary.\n  - At the inflow ($x=0$), the state is determined by the external condition $u(0,t)=u_L$. This is handled by using a ghost cell at index $i=-1$ with the value $U_{-1}^n = u_L$ for both schemes.\n  - At the outflow ($x=L$), the state is determined by the dynamics within the domain. No boundary condition needs to be imposed. The one-sided nature of our chosen upwind schemes naturally handles this by not requiring information from beyond the rightmost cell. The given condition $u(L,t)=u_R$ is thus an observation of the expected outflow state, not an imposed constraint for this flow direction.\n\n**5. Time Stepping and Stability**\nAn explicit Forward Euler method requires a limit on the time step size for stability, governed by the Courant–Friedrichs–Lewy (CFL) condition. The time step $\\Delta t$ must satisfy:\n$$ \\Delta t \\le \\text{CFL} \\frac{\\Delta x}{\\max_i |u_i|} $$\nThe problem specifies a dynamic $\\Delta t$ using $\\text{CFL} = 0.45$. At each time step $n$, we compute the global maximum speed $u_{\\max}^n = \\max(\\max_i |U_{i,\\text{c}}^n|, \\max_i |U_{i,\\text{nc}}^n|)$ across both solutions to ensure stability for both schemes with a shared $\\Delta t$. The time step is then $\\Delta t^n = 0.45 \\cdot \\Delta x / u_{\\max}^n$. The simulation time is advanced incrementally until the final time $T$ is reached.\n\n**6. Shock Position Localization and Error Calculation**\nAt the final time $T$, the numerical shock position $x_{\\text{nc}}$ for the non-conservative solution is found. We search for adjacent grid points $(x_i, U_{i,\\text{nc}})$ and $(x_{i+1}, U_{i+1,\\text{nc}})$ that straddle the midpoint value $u_{\\text{mid}} = (u_L+u_R)/2$. If found, the position is determined by linear interpolation:\n$$ x_{\\text{nc}} = x_i + \\Delta x \\frac{u_{\\text{mid}} - U_{i,\\text{nc}}}{U_{i+1,\\text{nc}} - U_{i,\\text{nc}}} $$\nIf no such pair exists, $x_{\\text{nc}}$ is taken as the grid location $x_j$ where $|U_{j,\\text{nc}} - u_{\\text{mid}}|$ is minimized. The exact shock location is computed as $x_{\\text{exact}}(T) = x_0 + sT$. The required error is $E_{\\text{nc}} = x_{\\text{nc}}(T) - x_{\\text{exact}}(T)$.\n\nThis procedure is systematically applied to all test cases to quantify the error in shock speed produced by the non-conservative discretization.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve_burgers(u_L, u_R, T, L, N, cfl, x0):\n    \"\"\"\n    Solves Burgers' equation using conservative and non-conservative schemes\n    and returns the final state of the non-conservative solution.\n    \"\"\"\n    dx = L / N\n    x = np.linspace(dx / 2, L - dx / 2, N)\n\n    # Initial conditions\n    u_c = np.full_like(x, u_R)\n    u_nc = np.full_like(x, u_R)\n    \n    # Locate the discontinuity index\n    # Based on x_i < x0 ==> (i+0.5)*dx < x0 ==> i < x0/dx - 0.5\n    split_idx_float = x0 / dx - 0.5\n    split_idx = int(np.floor(split_idx_float)) + 1\n    \n    u_c[:split_idx] = u_L\n    u_nc[:split_idx] = u_L\n\n    t = 0.0\n    while t < T:\n        # Determine shared dynamic time step\n        u_max_c = np.max(np.abs(u_c))\n        u_max_nc = np.max(np.abs(u_nc))\n        u_max = max(u_max_c, u_max_nc, 1e-9) # Avoid division by zero\n        \n        dt = cfl * dx / u_max\n        if t + dt > T:\n            dt = T - t\n        \n        # --- Conservative Scheme (Upwind Finite Volume) ---\n        # Extend solution array with ghost cell for inflow BC\n        u_c_ghost = np.concatenate(([u_L], u_c))\n        \n        # Flux at cell interfaces (f(u) = 0.5*u^2). Upwind implies f(u_left).\n        # We need N fluxes for N cells updates\n        # The flux at the right of cell i is f(u_i)\n        # The flux at the left of cell i is f(u_{i-1})\n        # F_{i+1/2} corresponds to f(U_i), so the flux vector would be f(U_i) for i in 0..N-1\n        # The update is U_i^{n+1} = U_i^n - dt/dx * (F_{i+1/2} - F_{i-1/2})\n        #                         = U_i^n - dt/dx * (f(U_i) - f(U_{i-1}))\n        # Vectorized implementation:\n        flux_c = 0.5 * u_c_ghost**2\n        flux_diff_c = flux_c[1:] - flux_c[:-1]\n        u_c = u_c - (dt / dx) * flux_diff_c\n\n        # --- Non-Conservative Scheme (Upwind Finite Difference) ---\n        u_nc_ghost = np.concatenate(([u_L], u_nc))\n        \n        # Advective term: u * (u_i - u_{i-1})/dx\n        adv_term_nc = u_nc_ghost[1:] * (u_nc_ghost[1:] - u_nc_ghost[:-1])\n        u_nc = u_nc - (dt / dx) * adv_term_nc\n        \n        t += dt\n\n    return u_nc, x\n\ndef find_shock_pos(u_final, x_grid, u_L, u_R):\n    \"\"\"\n    Finds the numerical shock position by interpolation.\n    \"\"\"\n    u_mid = (u_L + u_R) / 2.0\n    \n    # Search for straddling grid cells\n    for i in range(len(u_final) - 1):\n        # (u[i] - u_mid) and (u[i+1] - u_mid) have different signs\n        if (u_final[i] - u_mid) * (u_final[i+1] - u_mid) <= 0:\n            u_i = u_final[i]\n            u_i1 = u_final[i+1]\n            x_i = x_grid[i]\n            dx = x_grid[1] - x_grid[0]\n            \n            # Avoid division by zero if u_i1 == u_i\n            if abs(u_i1 - u_i) < 1e-9:\n                return x_i + dx/2.0\n                \n            # Linear interpolation\n            return x_i + dx * (u_mid - u_i) / (u_i1 - u_i)\n\n    # If no straddling found, find closest point\n    min_dist_idx = np.argmin(np.abs(u_final - u_mid))\n    return x_grid[min_dist_idx]\n    \ndef solve():\n    \"\"\"\n    Main function to run test cases and produce the final output.\n    \"\"\"\n    # Problem definition\n    L = 6.0\n    x0 = 1.0\n    N = 1200\n    CFL = 0.45\n    \n    test_cases = [\n        (2.0, 0.0, 0.5),  # Case 1\n        (2.0, 0.0, 2.0),  # Case 2\n        (2.0, 0.0, 4.0),  # Case 3\n        (1.5, 0.2, 4.0),  # Case 4\n    ]\n\n    results = []\n    for u_L, u_R, T in test_cases:\n        # Calculate exact shock position\n        s_exact = (u_L + u_R) / 2.0\n        x_exact = x0 + s_exact * T\n        \n        # Run simulation to get final state\n        u_nc_final, x_grid = solve_burgers(u_L, u_R, T, L, N, CFL, x0)\n        \n        # Find numerical shock position for non-conservative scheme\n        x_nc = find_shock_pos(u_nc_final, x_grid, u_L, u_R)\n        \n        # Compute the error\n        error_nc = x_nc - x_exact\n        results.append(error_nc)\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.12f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Our final practice moves to a comparative study of two well-known methods, revealing further pathologies of non-conservative discretizations. You will implement the classic Godunov scheme, which is inherently conservative, and compare it to the Lax-Wendroff scheme applied to the non-conservative form of the Burgers' equation . This exercise highlights that beyond the failure to conserve mass, non-conservative schemes often introduce non-physical artifacts, such as spurious oscillations and undershoots near discontinuities, which compromise the solution's integrity. This provides a clear illustration of why conservative methods are indispensable for reliably simulating flows with sharp gradients or shocks.",
            "id": "2379434",
            "problem": "Construct a complete program that compares a conservative and a non-conservative numerical formulation on the one-dimensional inviscid Burgers’ equation. Consider the scalar field $u(x,t)$ defined on the periodic domain $x \\in [0,1]$ with time $t \\ge 0$. The conservation form is\n$$\nu_t + \\left( \\tfrac{1}{2} u^2 \\right)_x = 0,\n$$\nand its algebraically equivalent non-conservative form on smooth solutions is\n$$\nu_t + u\\,u_x = 0.\n$$\nImplement a solver that advances two numerical solutions starting from the same initial condition on the same spatial grid:\n- a conservative solution using a Godunov-type method applied to the conservation form, and\n- a non-conservative solution using a Lax–Wendroff method applied to the non-conservative form $u_t + u\\,u_x = 0$.\n\nUse periodic boundary conditions on $[0,1]$ for both formulations. Use a uniform grid with $N_x$ cells, cell width $\\Delta x = 1/N_x$, and a common adaptive time step $\\Delta t$ chosen at each step to satisfy the Courant–Friedrichs–Lewy (CFL) condition\n$$\n\\Delta t \\le \\mathrm{CFL} \\cdot \\frac{\\Delta x}{\\max_x |u(x,t)|},\n$$\nand apply the same $\\Delta t$ to both solutions at each time step. The initial value problems below represent sharp-gradient data and are dimensionless, so no physical units are required.\n\nInitial conditions to be used in the test suite:\n- $I_1$ (discontinuous step): \n$$\nu(x,0) = \\begin{cases}\n1, & 0 \\le x < 0.5,\\\\\n0, & 0.5 \\le x \\le 1.\n\\end{cases}\n$$\n- $I_2$ (smoothed step with width $\\varepsilon$):\n$$\nu(x,0) = \\tfrac{1}{2}\\left(1 - \\tanh\\!\\left(\\frac{x - 0.5}{\\varepsilon}\\right)\\right).\n$$\n\nRun the following three test cases:\n- Case $1$: $N_x = 200$, $\\mathrm{CFL} = 0.45$, $T = 1.0$, initial condition $I_1$.\n- Case $2$: $N_x = 200$, $\\mathrm{CFL} = 0.95$, $T = 1.0$, initial condition $I_1$.\n- Case $3$: $N_x = 400$, $\\mathrm{CFL} = 0.45$, $T = 2.0$, initial condition $I_2$ with $\\varepsilon = 0.01$.\n\nFor each case, let $M_0 = \\int_0^1 u(x,0)\\,dx$ denote the initial mass, and let $M_{\\mathrm{G}}(T)$ and $M_{\\mathrm{LW}}(T)$ denote the numerical masses at time $T$ for the Godunov and Lax–Wendroff evolutions, respectively, computed as the discrete sums over the grid times $\\Delta x$. Compute the two scalars for each case:\n- $D = |M_{\\mathrm{LW}}(T) - M_0| - |M_{\\mathrm{G}}(T) - M_0|$,\n- $m = \\min_x u_{\\mathrm{LW}}(x,T)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets in the following order:\n$$\n[D_1, m_1, D_2, m_2, D_3, m_3].\n$$\nAll values are dimensionless real numbers. No angles or percentages are involved. The program must be self-contained and must not require any user input.",
            "solution": "The problem requires a comparative analysis of two numerical schemes for the one-dimensional inviscid Burgers' equation, a prototypical nonlinear hyperbolic partial differential equation (PDE). The core of the problem lies in the distinction between its conservation and non-conservation forms, which are algebraically equivalent for smooth solutions but lead to different weak solutions in the presence of discontinuities (shocks).\n\nThe conservation form of the Burgers' equation is given by:\n$$\nu_t + \\left( \\frac{1}{2} u^2 \\right)_x = 0\n$$\nThis can be written as $u_t + f(u)_x = 0$, where $f(u) = \\frac{1}{2}u^2$ is the flux function. The integral form of this conservation law states that the total quantity $\\int u \\, dx$ within a domain is conserved over time, changing only due to flux through the boundaries. For a solution with a discontinuity (a shock) propagating at speed $s$, this leads to the Rankine-Hugoniot jump condition:\n$$\ns = \\frac{f(u_L) - f(u_R)}{u_L - u_R} = \\frac{\\frac{1}{2}u_L^2 - \\frac{1}{2}u_R^2}{u_L - u_R} = \\frac{1}{2}(u_L + u_R)\n$$\nwhere $u_L$ and $u_R$ are the states to the left and right of the shock. Numerical methods that correctly model the physics of shocks must honor this condition.\n\nThe non-conservation form, derived using the chain rule on the flux term assuming $u$ is differentiable, is:\n$$\nu_t + u u_x = 0\n$$\nWhile this equation is identical to the conservation form for smooth solutions, it is fundamentally different when solutions are weak (discontinuous). A numerical scheme that discretizes this non-conservative form will not generally satisfy the Rankine-Hugoniot condition and will compute shocks that propagate at an incorrect speed, leading to physically wrong solutions and failure to conserve quantities like mass.\n\nThe analysis proceeds by implementing two distinct numerical methods, each tailored to one form of the equation. Both solutions evolve from the same initial conditions on an identical grid, using a common adaptive time step.\n\n**Conservative Scheme: The Godunov Method**\n\nThe Godunov method is a finite volume scheme applied to the conservation form. The domain is divided into cells, and the method evolves the cell-averaged value of $u$. The update for cell $i$ from time $t_n$ to $t_{n+1} = t_n + \\Delta t$ is:\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right)\n$$\nwhere $\\Delta x$ is the cell width and $F_{i\\pm1/2}$ are numerical fluxes at the cell interfaces. This \"telescoping sum\" structure ensures that, for periodic boundary conditions where the flux leaving the last cell enters the first ($F_{N_x-1+1/2} = F_{-1/2}$), the total mass $\\sum_i u_i^n \\Delta x$ is conserved to machine precision at every time step.\n\nThe key to the Godunov method is the calculation of the flux $F_{i+1/2}$, which is determined by solving the exact Riemann problem at the interface between cell $i$ (with state $u_L = u_i^n$) and cell $i+1$ (with state $u_R = u_{i+1}^n$). The flux is then $f(u^*(0))$, where $u^*(x/t)$ is the self-similar solution to this Riemann problem evaluated on the interface itself ($x/t=0$). For the Burgers' equation, the resulting flux logic is:\n1.  If $u_L \\le u_R$ (rarefaction wave): The flux is $f(u_L)$ if $u_L, u_R > 0$; $f(u_R)$ if $u_L, u_R  0$; and $f(0)=0$ if $u_L  0  u_R$.\n2.  If $u_L > u_R$ (shock wave): The flux is $f(u_L)$ if the shock speed $s = (u_L+u_R)/2 > 0$; it is $f(u_R)$ if $s  0$. If $s=0$, the flux is $0$.\n\nThis construction ensures that the numerical solution converges to the correct weak solution that satisfies the entropy condition.\n\n**Non-Conservative Scheme: The Lax-Wendroff Method**\n\nThe Lax-Wendroff method is a second-order accurate scheme in both space and time for smooth solutions. We apply a variant, the MacCormack scheme, to the non-conservative equation $u_t = -u u_x$. This scheme consists of a predictor-corrector sequence.\n\n1.  **Predictor step**: A temporary solution $\\tilde{u}$ is calculated using a forward difference for the spatial derivative:\n    $$\n    \\tilde{u}_i = u_i^n - \\Delta t \\left( u_i^n \\frac{u_{i+1}^n - u_i^n}{\\Delta x} \\right)\n    $$\n2.  **Corrector step**: The final solution $u^{n+1}$ is computed using the predicted values and a backward difference for the spatial derivative:\n    $$\n    u_i^{n+1} = \\frac{1}{2} \\left( u_i^n + \\tilde{u}_i - \\Delta t \\left( \\tilde{u}_i \\frac{\\tilde{u}_i - \\tilde{u}_{i-1}}{\\Delta x} \\right) \\right)\n    $$\nThis scheme is not written in conservation form. Consequently, when a shock forms and the underlying solution is no longer smooth, the scheme fails to conserve mass and propagates the shock with an incorrect velocity, leading to significant errors. The high-order nature of the scheme also produces spurious oscillations (Gibbs phenomenon) near discontinuities.\n\n**Numerical Setup and Expected Results**\n\nBoth solvers are implemented on a periodic domain $[0,1]$ with a common time step $\\Delta t$ determined at each step by the Courant–Friedrichs–Lewy (CFL) condition, $\\Delta t = \\mathrm{CFL} \\cdot \\Delta x / \\max_x |u|$, ensuring stability.\n\nThe initial conditions involve sharp gradients or discontinuities, which are guaranteed to form shocks.\n-   For the Godunov scheme, the absolute error in mass conservation, $|M_{\\mathrm{G}}(T) - M_0|$, is expected to be near zero (on the order of floating-point error).\n-   For the Lax-Wendroff scheme, $|M_{\\mathrm{LW}}(T) - M_0|$ is expected to be significantly larger than zero, as the method does not enforce conservation. This will result in a positive value for the diagnostic $D = |M_{\\mathrm{LW}}(T) - M_0| - |M_{\\mathrm{G}}(T) - M_0|$.\n-   The minimum value of the Lax-Wendroff solution, $m = \\min_x u_{\\mathrm{LW}}(x,T)$, is expected to be negative for the test cases, even though the analytical solution is non-negative. This is a direct consequence of the spurious undershoots generated by the scheme near the shock.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D inviscid Burgers' equation using a conservative Godunov scheme\n    and a non-conservative Lax-Wendroff (MacCormack) scheme to compare their\n    properties when handling shocks.\n    \"\"\"\n\n    def godunov_flux(uL, uR):\n        \"\"\"\n        Computes the Godunov flux for the Burgers' equation f(u) = 0.5*u^2.\n        \"\"\"\n        fL = 0.5 * uL**2\n        fR = 0.5 * uR**2\n        s = 0.5 * (uL + uR)  # Shock speed for the Riemann problem\n\n        flux = np.zeros_like(uL)\n\n        # Case 1: Rarefaction (uL = uR)\n        is_rarefaction = uL = uR\n        # Subcase 1.1: uL and uR  0. Characteristics move right. u_at_interface = uL.\n        cond_raref_1 = is_rarefaction  (uL  0.0)\n        flux[cond_raref_1] = fL[cond_raref_1]\n        # Subcase 1.2: uL and uR  0. Characteristics move left. u_at_interface = uR.\n        cond_raref_2 = is_rarefaction  (uR  0.0)\n        flux[cond_raref_2] = fR[cond_raref_2]\n        # Subcase 1.3: uL = 0 = uR. Stationary char at interface. u_at_interface = 0. flux = f(0) = 0.\n        # This is the default value of flux, so no explicit action is needed.\n\n        # Case 2: Shock (uL  uR)\n        is_shock = ~is_rarefaction\n        # Subcase 2.1: Shock moves right (s  0). u_at_interface = uL.\n        cond_shock_1 = is_shock  (s  0.0)\n        flux[cond_shock_1] = fL[cond_shock_1]\n        # Subcase 2.2: Shock moves left (s  0). u_at_interface = uR.\n        cond_shock_2 = is_shock  (s  0.0)\n        flux[cond_shock_2] = fR[cond_shock_2]\n        # Subcase 2.3: Stationary shock (s = 0). flux = 0.\n        # This is the default value of flux.\n\n        return flux\n\n    test_cases = [\n        {'Nx': 200, 'CFL': 0.45, 'T': 1.0, 'ic_type': 1, 'epsilon': None},\n        {'Nx': 200, 'CFL': 0.95, 'T': 1.0, 'ic_type': 1, 'epsilon': None},\n        {'Nx': 400, 'CFL': 0.45, 'T': 2.0, 'ic_type': 2, 'epsilon': 0.01},\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        Nx = case['Nx']\n        CFL = case['CFL']\n        T_final = case['T']\n        \n        dx = 1.0 / Nx\n        x = np.linspace(0, 1, Nx, endpoint=False) + 0.5 * dx # cell centers\n\n        # Initial conditions\n        if case['ic_type'] == 1:\n            u0 = np.where(x  0.5, 1.0, 0.0)\n        else: # ic_type == 2\n            epsilon = case['epsilon']\n            u0 = 0.5 * (1.0 - np.tanh((x - 0.5) / epsilon))\n\n        u_g = u0.copy() # Godunov solution\n        u_lw = u0.copy() # Lax-Wendroff solution\n        \n        M0 = np.sum(u0) * dx\n        \n        t = 0.0\n        while t  T_final:\n            # Shared adaptive time step\n            max_vel = np.max([np.max(np.abs(u_g)), np.max(np.abs(u_lw))])\n            dt = CFL * dx / (max_vel + 1e-9) # Add epsilon for stability if max_vel is 0\n            if t + dt  T_final:\n                dt = T_final - t\n\n            # --- Godunov Update ---\n            # States at interfaces (u_i, u_{i+1}) due to periodic BC\n            uL = u_g\n            uR = np.roll(u_g, -1)\n            \n            fluxes = godunov_flux(uL, uR)\n            \n            # Finite volume update\n            u_g -= (dt / dx) * (fluxes - np.roll(fluxes, 1))\n\n            # --- Lax-Wendroff (MacCormack) Update ---\n            # Predictor step (forward difference for u_x)\n            u_p1 = np.roll(u_lw, -1)\n            u_x_fwd = (u_p1 - u_lw) / dx\n            u_tilde = u_lw - dt * u_lw * u_x_fwd\n\n            # Corrector step (backward difference for u_x on tilde values)\n            u_tilde_m1 = np.roll(u_tilde, 1)\n            u_tilde_x_bwd = (u_tilde - u_tilde_m1) / dx\n            u_lw = 0.5 * (u_lw + u_tilde - dt * u_tilde * u_tilde_x_bwd)\n            \n            t += dt\n\n        # Calculate final quantities\n        M_g_T = np.sum(u_g) * dx\n        M_lw_T = np.sum(u_lw) * dx\n        \n        D = np.abs(M_lw_T - M0) - np.abs(M_g_T - M0)\n        m = np.min(u_lw)\n        \n        results.extend([D, m])\n\n    print(f\"[{','.join(f'{v:.6e}' for v in results)}]\")\n\nsolve()\n```"
        }
    ]
}