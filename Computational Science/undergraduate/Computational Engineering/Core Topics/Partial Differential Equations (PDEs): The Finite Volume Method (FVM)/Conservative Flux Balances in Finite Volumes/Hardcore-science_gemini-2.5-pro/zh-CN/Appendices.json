{
    "hands_on_practices": [
        {
            "introduction": "有限体积方法的核心在于将积分形式的守恒定律应用于单个控制体积。本练习将挑战您在一个非笛卡尔网格（六边形）上从零开始推导离散方程，这在许多工程应用中都是真实场景 。这个实践旨在检验您处理复杂几何形状并正确应用散度定理以构建守恒通量平衡的能力。",
            "id": "2379775",
            "problem": "考虑一个标量场 $\\phi(\\boldsymbol{x}, t)$ 在一个由全等正六边形控制体密铺的二维 ($2$D) 域中的瞬态扩散过程。其守恒形式的控制偏微分方程 (PDE) 为\n$$\n\\frac{\\partial \\phi}{\\partial t} + \\nabla \\cdot \\boldsymbol{j} = s(\\boldsymbol{x}, t),\n$$\n其本构关系 (菲克定律) 为 $\\boldsymbol{j} = - D(\\boldsymbol{x}) \\nabla \\phi$，其中 $D(\\boldsymbol{x})$ 是一个严格为正的扩散率场，$s(\\boldsymbol{x}, t)$ 是一个体源项。在平面外方向上采用单位厚度 ($1$)，并使用有限体积法 (FVM)。\n\n关注一个内部的六边形控制体 $V_i$，其面积为 $A_i$，边界 $\\partial V_i$ 由6个直面组成，索引为 $k \\in \\{1,\\dots,6\\}$。令 $\\ell_k$ 表示面 $k$ 的长度，$\\boldsymbol{n}_k$ 为其向外的单位法向量。令 $N_k$ 表示与 $V_i$ 共享面 $k$ 的相邻控制体。用 $\\phi_i(t)$ 和 $D_i$ 表示 $V_i$ 中的单元平均标量和扩散率，用 $\\phi_{N_k}(t)$ 和 $D_{N_k}$ 表示相邻单元 $N_k$ 中的相应量。假设连接 $V_i$ 和 $N_k$ 形心的线与面 $k$ 正交，形心间距为 $d_k>0$。定义单元平均源为 $S_i(t) \\equiv \\frac{1}{A_i}\\int_{V_i} s(\\boldsymbol{x}, t)\\,\\mathrm{d}V$。\n\n使用基于单元中心值的两点法向梯度和界面处扩散率的调和平均来近似计算穿过面 $k$ 的法向扩散通量：\n$$\nD_{f,k} \\equiv \\frac{2 D_i D_{N_k}}{D_i + D_{N_k}},\n\\qquad\n\\nabla \\phi \\cdot \\boldsymbol{n}_k \\big|_{f,k} \\approx \\frac{\\phi_{N_k} - \\phi_i}{d_k}.\n$$\n\n从第一性原理（$V_i$ 上的局部守恒）出发，推导内部单元 $i$ 的半离散守恒通量平衡方程，并用 $\\{\\phi_i, \\phi_{N_k}, D_i, D_{N_k}, \\ell_k, d_k, A_i, S_i\\}$ 表示其右侧。您的最终答案必须是右侧 $R_i$ 的单个闭式解析表达式，$R_i$ 由下式隐式定义：\n$$\nA_i \\,\\frac{\\mathrm{d}\\phi_i}{\\mathrm{d} t} \\;=\\; R_i.\n$$\n您的最终结果中不应包含等号。无需进行数值计算或四舍五入。请以符号形式表示您的答案。",
            "solution": "问题陈述具有科学依据、适定且客观。它描述了有限体积法在瞬态扩散方程上的一个标准应用，这是计算工程中的一项基本任务。所有必要的数据和近似都已提供，没有任何矛盾或含糊之处。我将开始进行推导。\n\n起点是给出的守恒形式的控制偏微分方程：\n$$\n\\frac{\\partial \\phi}{\\partial t} + \\nabla \\cdot \\boldsymbol{j} = s(\\boldsymbol{x}, t)\n$$\n有限体积法基于守恒定律的积分形式。我们将此方程在任意内部控制体 $V_i$ 上积分：\n$$\n\\int_{V_i} \\left( \\frac{\\partial \\phi}{\\partial t} + \\nabla \\cdot \\boldsymbol{j} \\right) \\mathrm{d}V = \\int_{V_i} s(\\boldsymbol{x}, t) \\mathrm{d}V\n$$\n利用积分的线性性质，该方程可分为三项：\n$$\n\\int_{V_i} \\frac{\\partial \\phi}{\\partial t} \\mathrm{d}V + \\int_{V_i} \\nabla \\cdot \\boldsymbol{j} \\mathrm{d}V = \\int_{V_i} s(\\boldsymbol{x}, t) \\mathrm{d}V\n$$\n现在我们通过引入给定的单元平均量近似来处理每一项。\n\n第一项表示标量 $\\phi$ 在体积 $V_i$ 上积分后随时间的变化率。单元平均标量 $\\phi_i(t)$ 定义为 $\\phi_i(t) \\equiv \\frac{1}{A_i}\\int_{V_i} \\phi(\\boldsymbol{x}, t)\\,\\mathrm{d}V$。由于控制体 $V_i$ 不随时间变化，我们可以交换积分和时间微分的顺序：\n$$\n\\int_{V_i} \\frac{\\partial \\phi}{\\partial t} \\mathrm{d}V = \\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{V_i} \\phi(\\boldsymbol{x}, t) \\mathrm{d}V = \\frac{\\mathrm{d}}{\\mathrm{d}t} \\left(A_i \\phi_i(t)\\right) = A_i \\frac{\\mathrm{d}\\phi_i}{\\mathrm{d} t}\n$$\n方程的右侧是积分源项。使用给定的单元平均源定义 $S_i(t) \\equiv \\frac{1}{A_i}\\int_{V_i} s(\\boldsymbol{x}, t)\\,\\mathrm{d}V$，我们得到：\n$$\n\\int_{V_i} s(\\boldsymbol{x}, t) \\mathrm{d}V = A_i S_i(t)\n$$\n左侧第二项是通量矢量 $\\boldsymbol{j}$ 散度的体积分。我们应用高斯-奥斯特罗格拉德斯基散度定理（高斯散度定理）将其转换为边界 $\\partial V_i$ 上的面积分：\n$$\n\\int_{V_i} \\nabla \\cdot \\boldsymbol{j} \\mathrm{d}V = \\oint_{\\partial V_i} \\boldsymbol{j} \\cdot \\boldsymbol{n} \\, \\mathrm{d}S\n$$\n其中 $\\boldsymbol{n}$ 是边界面上向外的单位法向量。六边形控制体的边界由6个面组成，索引为 $k \\in \\{1,\\dots,6\\}$。穿过边界的总通量是穿过每个面的通量之和：\n$$\n\\oint_{\\partial V_i} \\boldsymbol{j} \\cdot \\boldsymbol{n} \\, \\mathrm{d}S = \\sum_{k=1}^{6} \\int_{f_k} \\boldsymbol{j} \\cdot \\boldsymbol{n}_k \\, \\mathrm{d}S\n$$\n问题指定了一个二维域，其单位厚度为 $1$。因此，面 $f_k$ 上的面元 $\\mathrm{d}S$ 是 $\\mathrm{d}\\ell \\times 1$，其中 $\\mathrm{d}\\ell$ 是线微元。假设垂直于面的通量分量 $\\boldsymbol{j} \\cdot \\boldsymbol{n}_k$ 在每个面 $f_k$ 上是常数，则在该面上的积分可近似为：\n$$\n\\int_{f_k} \\boldsymbol{j} \\cdot \\boldsymbol{n}_k \\, \\mathrm{d}\\ell \\approx (\\boldsymbol{j} \\cdot \\boldsymbol{n}_k)|_{f,k} \\cdot \\ell_k\n$$\n其中 $\\ell_k$ 是面 $k$ 的长度。现在我们将本构关系（菲克定律）$\\boldsymbol{j} = - D(\\boldsymbol{x}) \\nabla \\phi$ 代入面通量项。在面上的通量矢量的法向分量为 $(\\boldsymbol{j} \\cdot \\boldsymbol{n}_k)|_{f,k} = (-D \\nabla\\phi \\cdot \\boldsymbol{n}_k)|_{f,k}$。这可以使用给定的面扩散率 $D_{f,k}$ 和面法向梯度来近似：\n$$\n(\\boldsymbol{j} \\cdot \\boldsymbol{n}_k)|_{f,k} \\approx -D_{f,k} \\left(\\nabla \\phi \\cdot \\boldsymbol{n}_k \\big|_{f,k}\\right)\n$$\n代入给定的 $D_{f,k}$ 表达式和梯度近似：\n$$\nD_{f,k} = \\frac{2 D_i D_{N_k}}{D_i + D_{N_k}} \\quad \\text{and} \\quad \\nabla \\phi \\cdot \\boldsymbol{n}_k \\big|_{f,k} \\approx \\frac{\\phi_{N_k} - \\phi_i}{d_k}\n$$\n因此，从单元 $i$ 穿过面 $k$ 的总通量可近似为：\n$$\n\\int_{f_k} \\boldsymbol{j} \\cdot \\boldsymbol{n}_k \\, \\mathrm{d}\\ell \\approx - \\left( \\frac{2 D_i D_{N_k}}{D_i + D_{N_k}} \\right) \\left( \\frac{\\phi_{N_k} - \\phi_i}{d_k} \\right) \\ell_k\n$$\n现在我们将所有近似项组合成积分平衡方程：\n$$\nA_i \\frac{\\mathrm{d}\\phi_i}{\\mathrm{d} t} + \\sum_{k=1}^{6} \\left[ - \\frac{2 \\ell_k D_i D_{N_k}}{d_k (D_i + D_{N_k})} (\\phi_{N_k} - \\phi_i) \\right] = A_i S_i\n$$\n问题要求的是方程 $A_i \\,\\frac{\\mathrm{d}\\phi_i}{\\mathrm{d} t} = R_i$ 的右侧 $R_i$。我们通过将求和项移到右侧，将推导出的方程重新整理成这种形式：\n$$\nA_i \\frac{\\mathrm{d}\\phi_i}{\\mathrm{d} t} = A_i S_i - \\sum_{k=1}^{6} \\left[ - \\frac{2 \\ell_k D_i D_{N_k}}{d_k (D_i + D_{N_k})} (\\phi_{N_k} - \\phi_i) \\right]\n$$\n简化此表达式可得到右侧的最终形式：\n$$\nA_i \\frac{\\mathrm{d}\\phi_i}{\\mathrm{d} t} = A_i S_i + \\sum_{k=1}^{6} \\frac{2 \\ell_k D_i D_{N_k}}{d_k (D_i + D_{N_k})} (\\phi_{N_k} - \\phi_i)\n$$\n这个表达式代表了源项和来自所有相邻单元的扩散通量的净效应，即所要求的右侧 $R_i$。$\\phi_i$、$\\phi_{N_k}$ 和 $S_i$ 的时间依赖性是隐式理解的。",
            "answer": "$$\n\\boxed{\\sum_{k=1}^{6} \\left( \\frac{2 \\ell_k D_i D_{N_k}}{d_k (D_i + D_{N_k})} \\left(\\phi_{N_k} - \\phi_i\\right) \\right) + A_i S_i}\n$$"
        },
        {
            "introduction": "在掌握了内部单元的处理后，下一个关键步骤是处理计算域的边界。这个练习展示了如何将一个物理边界条件（例如，可以推广到狄利克雷和诺伊曼条件的罗宾条件）转化为一个一致的数值通量表达式 。这确保了整个数值格式在计算域的边缘处能够正确地反映物理行为。",
            "id": "2379800",
            "problem": "考虑有界域 $\\Omega \\subset \\mathbb{R}^{d}$ 上标量场 $u(\\vec{x},t)$ 的标量守恒律，其总通量矢量为 $\\vec{f}(\\vec{x},t)$。在有限体积离散化中，设边界控制体 $P$ 有一个边界边 $b \\subset \\partial \\Omega$，其单位法向量 $\\hat{n}$ 指向 $P$ 的外部。在 $P$ 上的守恒平衡涉及边法向通量 $F_{b}$，其定义为在边 $b$ 上计算的 $F_{b} \\equiv \\vec{f}\\cdot \\hat{n}$，当通量离开 $P$ 时为正值。在边界边 $b$ 上，给定一个形式为 $\\alpha u + \\beta \\,\\vec{f}\\cdot \\hat{n} = \\gamma$ 的 Robin 条件，其中 $\\alpha$、$\\beta$ 和 $\\gamma$ 是给定常数，且 $\\beta \\neq 0$。假设边 $b$ 上主变量的边中心值由相邻的单元中心值近似，即 $u|_{b} \\approx u_{P}$，其中 $u_{P}$ 表示 $P$ 中的单元平均值。\n\n仅使用 $F_{b}$ 的守恒律定义和边界条件，确定数值边界通量 $F_{b}$ 关于 $\\alpha$、$\\beta$、$\\gamma$ 和 $u_{P}$ 的封闭形式解析表达式。\n\n请以单个封闭形式的符号表达式给出答案。不要包含单位。",
            "solution": "该问题要求推导边界控制体 $P$ 的边 $b$ 上的数值边界通量的封闭形式表达式。推导必须仅基于所提供的定义和条件。\n\n让我们从系统地分析给定信息开始。\n我们给定一个标量场 $u(\\vec{x},t)$ 的标量守恒律，其总通量矢量为 $\\vec{f}(\\vec{x},t)$。\n穿过具有向外单位法向量 $\\hat{n}$ 的边界边 $b$ 的数值通量定义为在该边上计算的总通量矢量的边法向分量。这由以下关系式给出：\n$$\nF_{b} \\equiv \\vec{f} \\cdot \\hat{n}\n$$\n此通量 $F_{b}$ 对于从控制体 $P$ 流出的情况被认为是正的。\n\n在同一个边界边 $b$ 上，施加了一个 Robin 型边界条件。该条件将场变量 $u$ 与其在边界上的通量的法向分量 $\\vec{f} \\cdot \\hat{n}$ 联系起来。该条件的具体形式是：\n$$\n\\alpha u + \\beta \\,(\\vec{f} \\cdot \\hat{n}) = \\gamma\n$$\n其中 $\\alpha$、$\\beta$ 和 $\\gamma$ 是指定的常数，并且规定 $\\beta \\neq 0$。\n\n我们的目标是找到数值通量 $F_{b}$ 的表达式。我们可以将 $F_{b}$ 的定义代入边界条件方程。边界条件在边 $b$ 上成立，因此所有量都在那里计算。代入后得到：\n$$\n\\alpha u|_{b} + \\beta F_{b} = \\gamma\n$$\n这里，$u|_{b}$ 表示场变量 $u$ 在边界边 $b$ 上的值。\n\n问题陈述指定了用于此边值的近似方法。在以单元为中心的有限体积格式中，主变量是作为单元平均量已知的。设 $u_{P}$ 为与边界边 $b$ 相邻的控制体 $P$ 中 $u$ 的单元平均值。问题规定了边值 $u|_{b}$ 的以下近似：\n$$\nu|_{b} \\approx u_{P}\n$$\n这是一个标准的一阶近似，其中边值被认为等于相邻单元中心的值。我们被要求使用这个近似。\n\n将这个近似代入我们正在推导的边界通量方程中，我们得到：\n$$\n\\alpha u_{P} + \\beta F_{b} = \\gamma\n$$\n这个方程现在直接将数值边界通量 $F_{b}$ 与已知的单元中心值 $u_{P}$ 以及给定的常数 $\\alpha$、$\\beta$ 和 $\\gamma$ 联系起来。最后一步是解这个关于 $F_{b}$ 的线性代数方程。\n\n为了分离出 $F_{b}$，我们首先从方程两边减去项 $\\alpha u_{P}$：\n$$\n\\beta F_{b} = \\gamma - \\alpha u_{P}\n$$\n接下来，我们除以系数 $\\beta$。问题陈述中关键性地给出了条件 $\\beta \\neq 0$，这确保了这个除法是一个定义明确的操作。因此，我们可以写出：\n$$\nF_{b} = \\frac{\\gamma - \\alpha u_{P}}{\\beta}\n$$\n这就是数值边界通量 $F_{b}$ 关于给定参数 $\\alpha$、$\\beta$、$\\gamma$ 和单元中心变量 $u_{P}$ 的封闭形式解析表达式。推导完成，且仅依赖于问题中陈述的原理和近似。",
            "answer": "$$\n\\boxed{\\frac{\\gamma - \\alpha u_{P}}{\\beta}}\n$$"
        },
        {
            "introduction": "为什么严格遵守守恒形式 $u_i^{n+1} = u_i^n - (\\Delta t / \\Delta x)(F_{i+1/2} - F_{i-1/2})$ 如此重要？本练习通过一个计算实验来回答这个问题 。通过故意实现一个看似合理但实际上非守恒的格式，您将从数值上证明它无法守恒总质量并量化其产生的误差，从而深刻理解守恒通量所依赖的“伸缩求和”特性的重要性。",
            "id": "2379829",
            "problem": "考虑一个定义在具有均匀单元的周期性域上的一维线性平流方程，该方程以无量纲形式给出，\n$$\n\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0,\\quad x \\in [0,L],\\quad t \\ge 0,\n$$\n其在 $[0,L]$ 上具有周期性边界条件，和一个空间上恒定的平流速度 $a \\in \\mathbb{R}$。设该域被划分为 $N$ 个宽度为 $\\Delta x = L/N$ 的均匀有限体积（单元），单元中心位于 $x_i = (i+\\tfrac{1}{2})\\Delta x$，其中 $i \\in \\{0,1,\\dots,N-1\\}$。令 $u_i^n$ 表示在离散时间层 $t^n = n\\,\\Delta t$（整数 $n \\ge 0$ 且时间步长 $\\Delta t > 0$）时，$u(x,t)$ 在单元 $i$ 上的单元平均值。所有量均为无量纲。\n\n将界面 $x_{i+\\frac{1}{2}}$ 处的数值面通量通过迎风选择定义为\n$$\nF_{i+\\frac{1}{2}}^n =\n\\begin{cases}\na\\,u_i^n,  a \\ge 0 \\\\\na\\,u_{i+1}^n,  a  0\n\\end{cases}\n$$\n其中索引以 $N$ 为模进行周期性处理。考虑以下的面不平衡更新格式，它对每个单元的右侧和左侧面使用不同的权重：\n$$\nu_i^{n+1} \\;=\\; u_i^n \\;-\\; \\frac{\\Delta t}{\\Delta x}\\Big[(1+\\eta)\\,F_{i+\\frac{1}{2}}^n \\;-\\; (1-\\eta)\\,F_{i-\\frac{1}{2}}^n\\Big],\n$$\n其中 $\\eta \\in \\mathbb{R}$ 是一个固定的偏置参数。当 $\\eta \\ne 0$ 时，此更新作为加权面平衡看似合理，但不是一个严格的伸缩通量差。\n\n初始数据由从周期性剖面采样得到的单元平均值给出\n$$\nu(x,0) = 1 + 0.2 \\,\\sin(2\\pi x/L).\n$$\n你必须在具有周期性边界的均匀网格上实现上述格式，并为每个测试用例计算在最终时间 $t^{n_{\\text{steps}}} = n_{\\text{steps}}\\,\\Delta t$ 时的最终相对全局质量误差。在时间层 $n$ 的离散全局质量为\n$$\nM^n = \\Delta x \\sum_{i=0}^{N-1} u_i^n.\n$$\n对于每个测试用例，报告一对浮点数\n$$\n\\Big[\\,E_{\\text{num}},\\;E_{\\text{theory}}\\,\\Big]\n\\quad\\text{with}\\quad\nE_{\\text{num}} = \\frac{M^{n_{\\text{steps}}} - M^0}{M^0},\\qquad\nE_{\\text{theory}} = \\left(1 - 2\\,\\eta\\,a\\,\\frac{\\Delta t}{\\Delta x}\\right)^{n_{\\text{steps}}} - 1,\n$$\n其中 $E_{\\text{theory}}$ 是由上述更新规则在周期性索引下所蕴含的解析预测的相对质量误差。\n\n测试套件（所有用例中 $L=1$）：\n- 用例 1 (正常路径)：$N=100$, $a=1$, $\\Delta t=0.005$, $\\eta=0.1$, $n_{\\text{steps}}=40$。\n- 用例 2 (保守边界)：$N=64$, $a=1$, $\\Delta t=0.0046875$, $\\eta=0$, $n_{\\text{steps}}=50$。\n- 用例 3 (负平流下的质量增长)：$N=80$, $a=-1.5$, $\\Delta t=\\tfrac{1}{300}$, $\\eta=0.25$, $n_{\\text{steps}}=5$。\n- 用例 4 (零平流)：$N=32$, $a=0$, $\\Delta t=0.01$, $\\eta=0.3$, $n_{\\text{steps}}=100$。\n\n最终输出格式：\n你的程序应生成单行输出，其中包含结果，格式为逗号分隔的列表的列表，每个内部列表对应一个测试用例，并按 $[E_{\\text{num}},E_{\\text{theory}}]$ 的顺序排列。例如，输出必须具有以下形式\n$$\n\\big[ [e_{1,\\text{num}},e_{1,\\text{theory}}], [e_{2,\\text{num}},e_{2,\\text{theory}}], [e_{3,\\text{num}},e_{3,\\text{theory}}], [e_{4,\\text{num}},e_{4,\\text{theory}}] \\big].\n$$\n只应打印这一行。",
            "solution": "所述问题需要经过验证。\n\n**步骤 1：提取已知条件**\n*   **控制方程**：一维线性平流方程，$\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0$。\n*   **域**：$x \\in [0,L]$, $t \\ge 0$，具有周期性边界条件。\n*   **平流速度**：$a \\in \\mathbb{R}$，常数。\n*   **离散化**：$N$ 个宽度为 $\\Delta x = L/N$ 的均匀有限体积。单元中心位于 $x_i = (i+\\tfrac{1}{2})\\Delta x$，其中 $i \\in \\{0,1,\\dots,N-1\\}$。\n*   **状态变量**：$u_i^n$ 是在时间 $t^n = n\\Delta t$ 时单元 $i$ 中的单元平均值。\n*   **数值通量**：在面 $x_{i+\\frac{1}{2}}$ 处的迎风通量为 $F_{i+\\frac{1}{2}}^n = \\begin{cases} a\\,u_i^n,  a \\ge 0 \\\\ a\\,u_{i+1}^n,  a  0 \\end{cases}$，具有周期性索引。\n*   **更新格式**：$u_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}\\Big[(1+\\eta)\\,F_{i+\\frac{1}{2}}^n - (1-\\eta)\\,F_{i-\\frac{1}{2}}^n\\Big]$，其中偏置参数 $\\eta \\in \\mathbb{R}$。\n*   **初始条件**：从 $u(x,0) = 1 + 0.2 \\,\\sin(2\\pi x/L)$ 采样得到的单元平均值。\n*   **关注量**：离散全局质量 $M^n = \\Delta x \\sum_{i=0}^{N-1} u_i^n$。\n*   **输出**：对于每个测试用例，报告该对 $[E_{\\text{num}}, E_{\\text{theory}}]$，其中：\n    *   $E_{\\text{num}} = \\frac{M^{n_{\\text{steps}}} - M^0}{M^0}$\n    *   $E_{\\text{theory}} = \\left(1 - 2\\,\\eta\\,a\\,\\frac{\\Delta t}{\\Delta x}\\right)^{n_{\\text{steps}}} - 1$\n*   **测试用例**：所有用例中 $L=1$。\n    1.  $N=100$, $a=1$, $\\Delta t=0.005$, $\\eta=0.1$, $n_{\\text{steps}}=40$。\n    2.  $N=64$, $a=1$, $\\Delta t=0.0046875$, $\\eta=0$, $n_{\\text{steps}}=50$。\n    3.  $N=80$, $a=-1.5$, $\\Delta t=\\tfrac{1}{300}$, $\\eta=0.25$, $n_{\\text{steps}}=5$。\n    4.  $N=32$, $a=0$, $\\Delta t=0.01$, $\\eta=0.3$, $n_{\\text{steps}}=100$。\n\n**步骤 2：验证**\n问题经过了严格的科学和逻辑审查。\n*   **科学依据**：该问题涉及线性平流方程的数值解，这是计算工程和物理学中的一个基本课题。所提出的数值格式是标准有限体积法的一种变体。对其非保守性质的分析是一个有效且具有指导意义的练习。理论质量误差公式可以从如下所示的第一性原理推导出来，这证实了其科学合理性。\n*   **适定性**：该问题是适定的。所有必需的参数、初始条件、边界条件和定义都已提供。任务的规定没有歧义。对于给定的测试用例，该格式的稳定性是满足的，因为 Courant-Friedrichs-Lewy (CFL) 数 $C = |a|\\frac{\\Delta t}{\\Delta x}$ 在所有情况下都小于或等于 $1$。\n*   **一致性与完整性**：该问题是自洽且内部一致的。没有缺失的数据或矛盾的约束。\n\n**步骤 3：结论**\n该问题被判定为**有效**。这是数值分析中一个清晰、一致且科学合理的问题。\n\n**解法推导**\n有限体积法的基本原理是量的守恒，这是通过确保进出域边界的通量总和为零来强制执行的。单元 $i$ 的标准守恒更新为 $u_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}(F_{i+\\frac{1}{2}}^n - F_{i-\\frac{1}{2}}^n)$。当在周期性域上的所有单元上求和时，通量项形成一个伸缩和，其结果为零，因此总质量 $M^n = \\Delta x \\sum_{i=0}^{N-1} u_i^n$ 是守恒的，$M^{n+1} = M^n$。\n\n指定的格式 $u_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}\\Big[(1+\\eta)\\,F_{i+\\frac{1}{2}}^n - (1-\\eta)\\,F_{i-\\frac{1}{2}}^n\\Big]$ 在 $\\eta \\ne 0$ 时是一个非守恒的修改。我们必须分析在此规则下总质量 $M^n$ 的演变。\n\n将更新规则在所有单元 $i=0, \\dots, N-1$ 上求和，并乘以 $\\Delta x$：\n$$\n\\Delta x \\sum_{i=0}^{N-1} u_i^{n+1} = \\Delta x \\sum_{i=0}^{N-1} u_i^n - \\Delta t \\sum_{i=0}^{N-1} \\Big[(1+\\eta)\\,F_{i+\\frac{1}{2}}^n - (1-\\eta)\\,F_{i-\\frac{1}{2}}^n\\Big]\n$$\n这等价于：\n$$\nM^{n+1} = M^n - \\Delta t \\left[ (1+\\eta)\\sum_{i=0}^{N-1}F_{i+\\frac{1}{2}}^n - (1-\\eta)\\sum_{i=0}^{N-1}F_{i-\\frac{1}{2}}^n \\right]\n$$\n由于周期性索引，对面 $i-\\frac{1}{2}$ 的求和与对面 $i+\\frac{1}{2}$ 的求和是相同的：$\\sum_{i=0}^{N-1} F_{i-\\frac{1}{2}}^n = \\sum_{j=-1}^{N-2} F_{j+\\frac{1}{2}}^n = \\sum_{j=0}^{N-1} F_{j+\\frac{1}{2}}^n$。令 $\\mathcal{F}^n = \\sum_{i=0}^{N-1}F_{i+\\frac{1}{2}}^n$。表达式简化为：\n$$\nM^{n+1} = M^n - \\Delta t \\Big[ (1+\\eta)\\mathcal{F}^n - (1-\\eta)\\mathcal{F}^n \\Big] = M^n - 2\\eta\\Delta t \\mathcal{F}^n\n$$\n现在，我们计算总通量 $\\mathcal{F}^n$。使用迎风通量定义。\n如果 $a \\ge 0$，则 $F_{i+\\frac{1}{2}}^n = a u_i^n$。总和为 $\\mathcal{F}^n = \\sum_{i=0}^{N-1} a u_i^n = a \\sum_{i=0}^{N-1} u_i^n = \\frac{a}{\\Delta x} M^n$。\n如果 $a  0$，则 $F_{i+\\frac{1}{2}}^n = a u_{i+1}^n$。总和为 $\\mathcal{F}^n = \\sum_{i=0}^{N-1} a u_{i+1}^n = a \\sum_{j=1}^{N} u_j^n$。由于周期性（$u_N^n=u_0^n$），这再次得到 $\\mathcal{F}^n = a \\sum_{j=0}^{N-1} u_j^n = \\frac{a}{\\Delta x} M^n$。此结果对任何 $a \\in \\mathbb{R}$ 都成立。\n\n将 $\\mathcal{F}^n$ 的表达式代入质量演化方程，得到 $M^n$ 的递推关系：\n$$\nM^{n+1} = M^n - 2\\eta\\Delta t \\left(\\frac{a}{\\Delta x} M^n\\right) = M^n \\left(1 - 2\\eta a \\frac{\\Delta t}{\\Delta x}\\right)\n$$\n这是一个等比数列。经过 $n_{\\text{steps}}$ 个时间步后，最终质量 $M^{n_{\\text{steps}}}$ 与初始质量 $M^0$ 的关系为：\n$$\nM^{n_{\\text{steps}}} = M^0 \\left(1 - 2\\eta a \\frac{\\Delta t}{\\Delta x}\\right)^{n_{\\text{steps}}}\n$$\n因此，理论相对质量误差 $E_{\\text{theory}}$ 为：\n$$\nE_{\\text{theory}} = \\frac{M^{n_{\\text{steps}}} - M^0}{M^0} = \\left(1 - 2\\eta a \\frac{\\Delta t}{\\Delta x}\\right)^{n_{\\text{steps}}} - 1\n$$\n这证实了问题陈述中提供的公式。任务简化为实现数值格式，并将其计算出的质量误差 $E_{\\text{num}}$ 与此解析预测进行比较。\n\n**算法实现**\n1.  对于每个测试用例，定义网格参数：单元宽度 $\\Delta x = L/N$ 和单元中心坐标 $x_i = (i+0.5)\\Delta x$，其中 $i \\in \\{0, \\dots, N-1\\}$。\n2.  通过在单元中心对初始剖面进行采样来初始化解向量 $u^0$：$u_i^0 = 1 + 0.2 \\sin(2\\pi x_i/L)$。\n3.  计算初始全局质量 $M^0 = \\Delta x \\sum_{i=0}^{N-1} u_i^0$。对于给定的初始剖面，解析积分表明 $M^0 = L$。由于正弦函数的对称性，逐点采样也得到 $M^0 = L$。\n4.  开始时间步进循环，从 $n=0$ 到 $n_{\\text{steps}}-1$。\n5.  在循环内部，对于当前解 $u^n$：\n    a.  计算面通量向量 $F_{i+\\frac{1}{2}}^n$。这是基于 $a$ 的符号完成的。使用数组移位（例如 `numpy.roll`）的向量化操作对于处理周期性边界是高效的。\n    b.  通过对右侧面通量向量进行周期性移位来构造左侧面的通量 $F_{i-\\frac{1}{2}}^n$。\n    c.  应用面不平衡更新公式以同时计算整个解向量 $u^{n+1}$。\n6.  循环结束后，计算最终全局质量 $M^{n_{\\text{steps}}} = \\Delta x \\sum_{i=0}^{N-1} u_i^{n_{\\text{steps}}}$。\n7.  使用其定义计算数值和理论相对质量误差 $E_{\\text{num}}$ 和 $E_{\\text{theory}}$。\n8.  存储该对 $[E_{\\text{num}}, E_{\\text{theory}}]$ 并继续下一个测试用例。\n9.  按指定格式化最终结果集合。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_simulation(L, N, a, dt, eta, n_steps):\n    \"\"\"\n    Runs a single simulation of the face-imbalanced finite volume scheme.\n\n    Args:\n        L (float): Domain length.\n        N (int): Number of cells.\n        a (float): Advection speed.\n        dt (float): Time step size.\n        eta (float): Face imbalance parameter.\n        n_steps (int): Number of time steps.\n\n    Returns:\n        list: A list containing [E_num, E_theory].\n    \"\"\"\n    # 1. Grid setup\n    dx = L / N\n    # Cell centers, not cell boundaries\n    x_centers = (np.arange(N) + 0.5) * dx\n\n    # 2. Initial condition\n    # Sampled at cell centers.\n    u = 1.0 + 0.2 * np.sin(2 * np.pi * x_centers / L)\n\n    # 3. Initial mass calculation\n    # For this IC, M0 is analytically L, but we compute from the discrete data\n    # to maintain consistency for E_num calculation.\n    M0 = dx * np.sum(u)\n\n    # 4. Time-stepping loop\n    for _ in range(n_steps):\n        # 5a. Compute fluxes at right faces (i + 1/2) using upwinding\n        if a = 0:\n            # Information comes from cell i (the current cell)\n            flux_right_faces = a * u\n        else:\n            # Information comes from cell i+1 (the cell to the right)\n            # np.roll(u, -1) provides the array of right neighbors u_{i+1}\n            flux_right_faces = a * np.roll(u, -1)\n        \n        # 5b. Compute fluxes at left faces (i - 1/2)\n        # The flux at face i-1/2 is the same as flux_right_faces for cell i-1.\n        # This is a circular shift to the right.\n        flux_left_faces = np.roll(flux_right_faces, 1)\n\n        # 5c. Apply the face-imbalanced update rule\n        u = u - (dt / dx) * ((1 + eta) * flux_right_faces - (1 - eta) * flux_left_faces)\n\n    # 6. Final mass calculation\n    Mf = dx * np.sum(u)\n\n    # 7. Compute numerical and theoretical errors\n    E_num = (Mf - M0) / M0\n    E_theory = (1 - 2 * eta * a * dt / dx)**n_steps - 1\n\n    # In cases where theory predicts exactly 0, ensure output is 0.0, not a small float.\n    if np.isclose(E_num, 0.0):\n        E_num = 0.0\n    if np.isclose(E_theory, 0.0):\n        E_theory = 0.0\n\n    return [E_num, E_theory]\n\ndef solve():\n    \"\"\"\n    Defines and runs the test suite, then prints the results in the required format.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (L, N, a, dt, eta, n_steps)\n        # Case 1: happy path\n        (1.0, 100, 1.0, 0.005, 0.1, 40),\n        # Case 2: conservative boundary\n        (1.0, 64, 1.0, 0.0046875, 0.0, 50),\n        # Case 3: mass growth with negative advection\n        (1.0, 80, -1.5, 1.0/300.0, 0.25, 5),\n        # Case 4: zero advection\n        (1.0, 32, 0.0, 0.01, 0.3, 100),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_simulation(*case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # The format string produces output like: [[v1,v2],[v3,v4]]\n    # where map(str, results) converts each inner list [v1, v2] to its string '[v1, v2]'.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}