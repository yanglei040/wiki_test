{
    "hands_on_practices": [
        {
            "introduction": "数值格式的稳定性至关重要；一个不稳定的格式会产生无物理意义的、爆炸性的结果。本练习将展示稳定性是多么敏感。通过对著名且稳定的 Lax-Friedrichs 格式进行一个看似无害的微小改动，你将使用 von Neumann 稳定性分析，从解析上证明该格式变为无条件不稳定。这个实践将磨练你分析稳定性的技巧，并深刻提醒我们，即使是微小的实现细节也可能导致灾难性的后果 。",
            "id": "2407982",
            "problem": "考虑具有恒定波速 $a \\in \\mathbb{R}$ 的线性平流方程 $u_{t} + a\\,u_{x} = 0$。在空间步长为 $\\Delta x$、时间步长为 $\\Delta t$ 的均匀网格上，定义库朗数 $\\nu = a\\,\\Delta t/\\Delta x$。经典的 Lax–Friedrichs 格式通过用对称邻居平均值替换 $u^{n}_{j}$ 来更新解。现在考虑以下修正的更新格式，该格式通过一个微小的正偏置 $\\varepsilon  0$ 来扰动平均项：\n$$\nu^{n+1}_{j} = \\left(\\frac{1}{2} + \\varepsilon\\right)\\left(u^{n}_{j+1} + u^{n}_{j-1}\\right) \\;-\\; \\frac{\\nu}{2}\\left(u^{n}_{j+1} - u^{n}_{j-1}\\right).\n$$\n使用 von Neumann 傅里叶模态分析，并采用形式为 $u^{n}_{j} = \\hat{u}^{n}\\,\\exp(i j \\theta)$ 的试探解，确定放大因子 $G(\\theta)$，并用它来量化该格式的线性稳定性。具体来说，计算以下量\n$$\n\\inf_{\\nu \\in \\mathbb{R}} \\;\\sup_{\\theta \\in \\mathbb{R}} \\,|G(\\theta)|,\n$$\n并将其表示为关于 $\\varepsilon$ 的显式闭式表达式。你的最终答案必须是单一的解析表达式。不需要四舍五入。",
            "solution": "所述问题在科学上是合理的，形式上是连贯的，并且是适定的。我们可以开始求解。\n\n该问题要求对线性平流方程 $u_{t} + a\\,u_{x} = 0$ 的一个修正数值格式进行稳定性分析。该格式由下式给出：\n$$\nu^{n+1}_{j} = \\left(\\frac{1}{2} + \\varepsilon\\right)\\left(u^{n}_{j+1} + u^{n}_{j-1}\\right) - \\frac{\\nu}{2}\\left(u^{n}_{j+1} - u^{n}_{j-1}\\right)\n$$\n其中 $\\nu = a\\,\\Delta t/\\Delta x$ 是库朗数，$\\varepsilon  0$ 是一个恒定的偏置。我们使用 von Neumann 稳定性分析，该方法考察单个傅里叶模态的放大情况。\n\n我们将试探解 $u^{n}_{j} = \\hat{u}^{n}\\,\\exp(i j \\theta)$ 代入该格式。项 $u^{n+1}_{j}$ 表示为 $u^{n+1}_{j} = G(\\theta) u^{n}_{j} = G(\\theta) \\hat{u}^{n}\\,\\exp(i j \\theta)$，其中 $G(\\theta)$ 是放大因子。空间邻点由下式给出：\n$$\nu^{n}_{j+1} = \\hat{u}^{n}\\,\\exp(i (j+1) \\theta) = u^{n}_{j}\\,\\exp(i\\theta)\n$$\n$$\nu^{n}_{j-1} = \\hat{u}^{n}\\,\\exp(i (j-1) \\theta) = u^{n}_{j}\\,\\exp(-i\\theta)\n$$\n将这些形式代入数值格式，我们得到：\n$$\nG(\\theta) u^{n}_{j} = \\left(\\frac{1}{2} + \\varepsilon\\right)\\left(u^{n}_{j}\\,\\exp(i\\theta) + u^{n}_{j}\\,\\exp(-i\\theta)\\right) - \\frac{\\nu}{2}\\left(u^{n}_{j}\\,\\exp(i\\theta) - u^{n}_{j}\\,\\exp(-i\\theta)\\right)\n$$\n我们消去两边公共的非零项 $u^{n}_{j}$。使用欧拉恒等式 $\\exp(i\\theta) + \\exp(-i\\theta) = 2\\cos(\\theta)$ 和 $\\exp(i\\theta) - \\exp(-i\\theta) = 2i\\sin(\\theta)$，我们简化 $G(\\theta)$ 的表达式：\n$$\nG(\\theta) = \\left(\\frac{1}{2} + \\varepsilon\\right)(2\\cos(\\theta)) - \\frac{\\nu}{2}(2i\\sin(\\theta))\n$$\n$$\nG(\\theta) = (1 + 2\\varepsilon)\\cos(\\theta) - i\\nu\\sin(\\theta)\n$$\n这就是给定格式的放大因子。它是模态角 $\\theta$ 和库朗数 $\\nu$ 的一个复值函数。\n\n线性稳定性的条件是对于所有 $\\theta \\in [-\\pi, \\pi]$，都有 $|G(\\theta)| \\le 1$。问题要求计算 $\\inf_{\\nu \\in \\mathbb{R}} \\sup_{\\theta \\in \\mathbb{R}} |G(\\theta)|$。我们首先对于固定的 $\\nu$ 求出 $|G(\\theta)|$ 关于 $\\theta$ 的上确界。为简化分析，我们处理其幅值的平方 $|G(\\theta)|^2$：\n$$\n|G(\\theta)|^2 = \\left( (1 + 2\\varepsilon)\\cos(\\theta) \\right)^2 + \\left( -\\nu\\sin(\\theta) \\right)^2\n$$\n$$\n|G(\\theta)|^2 = (1 + 2\\varepsilon)^2\\cos^2(\\theta) + \\nu^2\\sin^2(\\theta)\n$$\n使用恒等式 $\\sin^2(\\theta) = 1 - \\cos^2(\\theta)$，我们将 $|G(\\theta)|^2$ 表示为 $\\cos^2(\\theta)$ 的函数：\n$$\n|G(\\theta)|^2 = (1 + 2\\varepsilon)^2\\cos^2(\\theta) + \\nu^2(1 - \\cos^2(\\theta))\n$$\n$$\n|G(\\theta)|^2 = \\nu^2 + \\left[ (1 + 2\\varepsilon)^2 - \\nu^2 \\right]\\cos^2(\\theta)\n$$\n令变量 $C = \\cos^2(\\theta)$。当 $\\theta$ 遍历 $\\mathbb{R}$ 时，$C$ 遍历区间 $[0, 1]$。我们希望找到函数 $f(C) = \\nu^2 + \\left[ (1 + 2\\varepsilon)^2 - \\nu^2 \\right]C$ 在 $C \\in [0, 1]$ 上的最大值。\n函数 $f(C)$ 是关于 $C$ 的线性函数。它在区间 $[0, 1]$ 上的最大值将出现在端点 $C=0$ 或 $C=1$ 处，具体取决于 $C$ 的系数的符号。\n\n情况1：系数 $(1 + 2\\varepsilon)^2 - \\nu^2 \\ge 0$。\n这等价于 $\\nu^2 \\le (1 + 2\\varepsilon)^2$，或 $|\\nu| \\le 1 + 2\\varepsilon$。在这种情况下，$f(C)$ 的最大值出现在 $C=1$ 处（对应于 $\\theta = k\\pi$，$k \\in \\mathbb{Z}$）。\n$$\n\\sup_{\\theta} |G(\\theta)|^2 = \\nu^2 + \\left[ (1 + 2\\varepsilon)^2 - \\nu^2 \\right](1) = (1 + 2\\varepsilon)^2\n$$\n\n情况2：系数 $(1 + 2\\varepsilon)^2 - \\nu^2  0$。\n这等价于 $\\nu^2  (1 + 2\\varepsilon)^2$，或 $|\\nu|  1 + 2\\varepsilon$。在这种情况下，$f(C)$ 的最大值出现在 $C=0$ 处（对应于 $\\theta = \\frac{\\pi}{2} + k\\pi$，$k \\in \\mathbb{Z}$）。\n$$\n\\sup_{\\theta} |G(\\theta)|^2 = \\nu^2 + \\left[ (1 + 2\\varepsilon)^2 - \\nu^2 \\right](0) = \\nu^2\n$$\n\n结合这两种情况，我们可以将幅值平方的上确界写为：\n$$\n\\sup_{\\theta \\in \\mathbb{R}} |G(\\theta)|^2 = \\max\\left( (1 + 2\\varepsilon)^2, \\nu^2 \\right)\n$$\n取平方根，我们得到幅值的上确界：\n$$\n\\sup_{\\theta \\in \\mathbb{R}} |G(\\theta)| = \\sqrt{\\max\\left( (1 + 2\\varepsilon)^2, \\nu^2 \\right)} = \\max\\left( \\sqrt{(1 + 2\\varepsilon)^2}, \\sqrt{\\nu^2} \\right)\n$$\n因为 $\\varepsilon > 0$，所以 $1 + 2\\varepsilon$ 是正的。因此，$\\sqrt{(1 + 2\\varepsilon)^2} = 1 + 2\\varepsilon$。\n$$\n\\sup_{\\theta \\in \\mathbb{R}} |G(\\theta)| = \\max(1 + 2\\varepsilon, |\\nu|)\n$$\n最后，我们必须计算该量在所有可能的实数 $\\nu$ 上的下确界。令 $M(\\nu) = \\max(1 + 2\\varepsilon, |\\nu|)$。我们寻求 $\\inf_{\\nu \\in \\mathbb{R}} M(\\nu)$。\n\n函数 $M(\\nu)$ 定义为：\n$$\nM(\\nu) =\n\\begin{cases}\n1 + 2\\varepsilon  \\text{如果 } |\\nu| \\le 1 + 2\\varepsilon \\\\\n|\\nu|  \\text{如果 } |\\nu|  1 + 2\\varepsilon\n\\end{cases}\n$$\n从这个定义可以清楚地看出，对于任何 $\\nu \\in \\mathbb{R}$，$M(\\nu)$ 的值总是大于或等于 $1 + 2\\varepsilon$。$M(\\nu)$ 的最小值是 $1 + 2\\varepsilon$，并且对于闭区间 $[-(1 + 2\\varepsilon), 1 + 2\\varepsilon]$ 中的任何 $\\nu$ 都可以达到这个最小值。\n因此，下确界是：\n$$\n\\inf_{\\nu \\in \\mathbb{R}} \\sup_{\\theta \\in \\mathbb{R}} |G(\\theta)| = 1 + 2\\varepsilon\n$$\n正偏置 $\\varepsilon$ 引入了无条件不稳定性，因为最大放大因子的最小值是 $1 + 2\\varepsilon$，它严格大于 $1$。",
            "answer": "$$\n\\boxed{1 + 2\\varepsilon}\n$$"
        },
        {
            "introduction": "相容性确保数值格式在步长趋于无穷小时，能够逼近正确的偏微分方程。然而，一个格式有时可能与一个*并非*我们原意的 PDE 相容。本练习挑战你推导出一个给定的两步格式实际求解的“修正方程”。通过运用泰勒级数展开，你将确定如何调整一个参数，使得该格式与一个相关但有区别的热传导方程相容，从而阐明相容性分析的形式化过程 。",
            "id": "2408003",
            "problem": "考虑一维热偏微分方程 (PDE) $u_{t}=\\alpha\\,u_{xx}$，其中扩散系数 $\\alpha0$ 为严格正常数，该方程定义在周期性空间域上。设空间网格是均匀的，节点为 $x_{j}=j\\,\\Delta x$，时间网格为 $t^{n}=n\\,\\Delta t$，并令 $u_{j}^{n}$ 表示 $u(x_{j},t^{n})$ 的一个近似值。定义每个时间步的两阶段线性更新如下：\n\n- 阶段 A (扩散步)：由下式计算中间场 $y_{j}$\n$$\ny_{j}=u_{j}^{n}+\\frac{\\alpha\\,\\Delta t}{\\Delta x^{2}}\\Big(u_{j+1}^{n}-2\\,u_{j}^{n}+u_{j-1}^{n}\\Big).\n$$\n\n- 阶段 B (人工粘性平滑)：更新\n$$\nu_{j}^{n+1}=(1-2\\gamma)\\,y_{j}+\\gamma\\,(y_{j-1}+y_{j+1}),\n$$\n其中 $\\gamma0$ 是一个用户选择的参数，可以依赖于 $\\Delta t$ 和 $\\Delta x$，但与 $j$ 或 $n$ 无关。\n\n假设在抛物线尺度缩放 $\\Delta t/\\Delta x^{2}$ 保持不变的情况下，$\\Delta t\\to 0$ 且 $\\Delta x\\to 0$。确定 $\\gamma$ 关于 $\\epsilon$、$\\Delta t$ 和 $\\Delta x$ 的唯一封闭形式表达式，使得在这种加密机制下，组合的两阶段方法在时间上是一阶精确的，并且与给定的常数 $\\epsilon0$ 的偏微分方程 $u_{t}=(\\alpha+\\epsilon)\\,u_{xx}$ 相容。以 $\\gamma$ 关于 $\\epsilon$、$\\Delta t$ 和 $\\Delta x$ 的单个解析表达式的形式给出你的答案。不需要四舍五入，也不需要报告单位。",
            "solution": "该问题要求确定一个应用于一维热方程的两阶段数值方法的参数 $\\gamma$。条件是该方法必须与修正后的偏微分方程 $u_{t}=(\\alpha+\\epsilon)\\,u_{xx}$ 相容，其中 $\\epsilon0$ 为给定值。这项任务通过推导数值格式隐式求解的修正偏微分方程来完成。这可以通过对有限差分算子进行严格的泰勒级数展开来实现。通过比较得到的修正偏微分方程的系数与目标偏微分方程的系数，我们可以建立一个关于 $\\gamma$ 的方程并求解它。\n\n首先，我们用算子表示法来表达给定的两阶段数值格式。设二阶空间导数的标准二阶中心差分算子定义为：\n$$\nD_{xx} u_{j}^{n} = \\frac{u_{j+1}^{n}-2u_{j}^{n}+u_{j-1}^{n}}{\\Delta x^{2}}\n$$\n根据这个定义，格式的阶段 A，即扩散步，可以写成：\n$$\ny_{j} = u_{j}^{n} + \\alpha \\Delta t \\left( \\frac{u_{j+1}^{n}-2u_{j}^{n}+u_{j-1}^{n}}{\\Delta x^{2}} \\right) = (I + \\alpha \\Delta t D_{xx}) u_{j}^{n}\n$$\n其中 $I$ 表示单位算子。\n\n阶段 B，人工粘性平滑步，作用于中间场 $y_{j}$：\n$$\nu_{j}^{n+1} = (1-2\\gamma)y_{j}+\\gamma(y_{j-1}+y_{j+1}) = y_{j} + \\gamma(y_{j+1}-2y_{j}+y_{j-1})\n$$\n这可以使用作用于场 $y$ 的 $D_{xx}$ 算子来紧凑地表示：\n$$\nu_{j}^{n+1} = y_{j} + \\gamma \\Delta x^{2} \\left(\\frac{y_{j+1}-2y_{j}+y_{j-1}}{\\Delta x^{2}}\\right) = (I + \\gamma \\Delta x^{2} D_{xx}) y_{j}\n$$\n为了分析整个方法，我们将阶段 A 中 $y_j$ 的表达式代入 $u_{j}^{n+1}$ 的方程中，从而组合这两个阶段：\n$$\nu_{j}^{n+1} = (I + \\gamma \\Delta x^{2} D_{xx}) \\big( (I + \\alpha \\Delta t D_{xx}) u_{j}^{n} \\big)\n$$\n展开算子乘积，得到完整的一步更新规则：\n$$\nu_{j}^{n+1} = (I + \\alpha \\Delta t D_{xx} + \\gamma \\Delta x^{2} D_{xx} + \\alpha \\gamma \\Delta t \\Delta x^{2} D_{xx}^{2}) u_{j}^{n}\n$$\n为了推导修正偏微分方程，我们重排此方程以分离出时间导数的近似，然后将所有算子进行泰勒级数展开。\n$$\n\\frac{u_{j}^{n+1} - u_{j}^{n}}{\\Delta t} = \\left( (\\alpha + \\frac{\\gamma \\Delta x^{2}}{\\Delta t}) D_{xx} + \\alpha \\gamma \\Delta x^{2} D_{xx}^{2} \\right) u_{j}^{n}\n$$\n假设精确解 $u(x,t)$ 足够光滑，我们在点 $(x_j, t^n)$ 附近展开算子。代表时间导数的左侧展开为：\n$$\n\\frac{u(x_{j}, t^{n}+\\Delta t) - u(x_{j}, t^{n})}{\\Delta t} = u_{t} + \\frac{\\Delta t}{2} u_{tt} + O(\\Delta t^{2})\n$$\n右侧的空间算子具有以下泰勒级数展开：\n$$\nD_{xx} u = u_{xx} + \\frac{\\Delta x^{2}}{12} u_{xxxx} + O(\\Delta x^{4})\n$$\n$$\nD_{xx}^{2} u = \\left(\\frac{\\partial^{2}}{\\partial x^{2}} + \\frac{\\Delta x^{2}}{12}\\frac{\\partial^{4}}{\\partial x^{4}} + \\dots\\right)^{2} u = u_{xxxx} + O(\\Delta x^{2})\n$$\n将这些展开式代入格式的方程中，得到：\n$$\nu_{t} + \\frac{\\Delta t}{2} u_{tt} + \\dots = \\left(\\alpha + \\frac{\\gamma \\Delta x^{2}}{\\Delta t}\\right) \\left(u_{xx} + \\frac{\\Delta x^{2}}{12} u_{xxxx} + \\dots \\right) + \\alpha \\gamma \\Delta x^{2} (u_{xxxx} + \\dots)\n$$\n分离出 $u_t$ 项，得到数值格式满足的修正偏微分方程：\n$$\nu_{t} = \\left(\\alpha + \\frac{\\gamma \\Delta x^{2}}{\\Delta t}\\right) u_{xx} - \\frac{\\Delta t}{2} u_{tt} + \\left[ \\left(\\alpha + \\frac{\\gamma \\Delta x^{2}}{\\Delta t}\\right)\\frac{\\Delta x^{2}}{12} + \\alpha \\gamma \\Delta x^{2} \\right] u_{xxxx} + \\dots\n$$\n问题要求此格式与偏微分方程 $u_{t} = (\\alpha+\\epsilon)u_{xx}$ 相容。如果两个微分算子的主阶项匹配，则它们是相容的。因此，我们修正方程中 $u_{xx}$ 项的系数必须等于目标偏微分方程中的扩散系数 $(\\alpha+\\epsilon)$。这决定了以下等式：\n$$\n\\alpha + \\frac{\\gamma \\Delta x^{2}}{\\Delta t} = \\alpha + \\epsilon\n$$\n两边减去 $\\alpha$ 得到关于 $\\gamma$ 的条件：\n$$\n\\frac{\\gamma \\Delta x^{2}}{\\Delta t} = \\epsilon\n$$\n求解 $\\gamma$ 得到唯一的封闭形式表达式：\n$$\n\\gamma = \\epsilon \\frac{\\Delta t}{\\Delta x^{2}}\n$$\n该结果用指定的参数 $\\epsilon$、$\\Delta t$ 和 $\\Delta x$ 表示。鉴于 $\\epsilon0$、$\\Delta t0$ 和 $\\Delta x^20$，条件 $\\gamma0$ 得到满足。\n\n最后，我们必须验证，如问题所述，这个 $\\gamma$ 的选择导致了一个时间上一阶精确的格式。相对于目标偏微分方程的局部截断误差由修正方程中的高阶项给出。代入我们关于 $\\gamma$ 的表达式：\n$$\nu_{t} - (\\alpha + \\epsilon)u_{xx} = - \\frac{\\Delta t}{2} u_{tt} + \\left[ \\frac{(\\alpha + \\epsilon)\\Delta x^{2}}{12} + \\alpha \\left(\\epsilon \\frac{\\Delta t}{\\Delta x^{2}}\\right) \\Delta x^{2} \\right] u_{xxxx} + \\dots\n$$\n$$\nu_{t} - (\\alpha + \\epsilon)u_{xx} = - \\frac{\\Delta t}{2} u_{tt} + \\left( \\frac{(\\alpha + \\epsilon)\\Delta x^{2}}{12} + \\alpha \\epsilon \\Delta t \\right) u_{xxxx} + \\dots\n$$\n右侧的项代表了主阶截断误差。误差项的阶为 $O(\\Delta t)$ 和 $O(\\Delta x^{2})$。在指定的抛物线加密机制中，比率 $\\Delta t/\\Delta x^{2}$ 保持不变，这意味着 $\\Delta t$ 和 $\\Delta x^{2}$ 以相同的速率趋近于零。因此，总的截断误差为 $O(\\Delta t, \\Delta x^{2})$。这对应于一个时间上一阶、空间上二阶的方法。因此，时间上一阶精确的条件得到满足。推导出的 $\\gamma$ 表达式是正确且唯一的。",
            "answer": "$$\n\\boxed{\\epsilon \\frac{\\Delta t}{\\Delta x^{2}}}\n$$"
        },
        {
            "introduction": "最后的这个实践将所有概念融会贯通，将 Lax 等价原则构建成一个强大的验证工具。想象你得到了一个“黑箱”求解器，必须判断它是否正确地求解了线性平流方程。你将设计并实施一个数值实验，在一系列网格加密过程中同时测试其稳定性（有界性）和收敛性（误差减小）。通过观察结果，你将运用 Lax 等价原则的逻辑来推断隐藏的格式是否具有相容性，就像一位数值侦探一样，验证求解器的可靠性 。",
            "id": "2407986",
            "problem": "给定一个求解一维周期性偏微分方程（PDE）初值问题的单步积分器，你拥有对该积分器的黑箱访问权限。该问题定义在空间区间 $[0,1]$ 上，并带有周期性边界条件。你无法查看或修改该积分器内部使用的数值格式；你只能通过选定的空间网格和时间步长，将其作为黑箱来调用。你的任务是设计、实现并执行一个数值实验，从第一性原理出发，判断其底层的离散格式是否与线性平流偏微分方程\n$$\nu_t + a\\,u_x = 0,\n$$\n相容，其中 $a$ 是一个给定的正常数，该方程在 $x\\in[0,1]$ 上定义，并带有周期性边界条件。\n\n你可以不经证明直接使用的基本定义如下：\n- 相容性：对于一个偏微分方程的离散格式，当网格间距趋于零时，其局部截断误差也趋于零。\n- 稳定性：当离散格式应用于具有有界数据的齐次线性问题时，对于所有足够精细的离散化，其产生的解在某个适当的范数下保持一致有界。\n- Lax 等价性原理 (Lax)：对于一个线性的、适定的初值问题，一个相容的格式是收敛的当且仅当它是稳定的；反之，收敛性也意味着相容性。\n\n你的数值实验必须仅基于这些基本定义和事实。特别地，不要对未知格式的任何特定离散模板或精度阶数做出假设。你必须从基本定义出发进行推理，以决定如何检验相容性。\n\n你的数值实验的设计要求：\n- 使用人工构造解法：选择目标偏微分方程的一个光滑、周期性的精确解，并用它来构造初始数据和边界数据。一个方便的选择是\n$$\nu(x,t) = \\sin\\!\\big(2\\pi(x - a t)\\big),\n$$\n对于任意正常数 $a$，该函数都是方程 $u_t + a\\,u_x = 0$ 在 $[0,1]$ 上带有周期性边界条件的精确解。\n- 空间域和网格：使用在 $[0,1)$ 上的均匀周期性网格，包含 $N_x$ 个点，因此 $\\Delta x = 1/N_x$。考虑加密序列 $N_x \\in \\{50, 100, 200, 400\\}$。\n- 时间步长选择：对于每个 $N_x$，选择 $\\Delta t = \\text{CFL}\\cdot \\Delta x/a$，其中 Courant–Friedrichs–Lewy (CFL) 数固定为 $\\text{CFL} = 0.45$，以确保时间和空间尺度按比例加密。\n- 最终时间：使用 $T = 1.0$。对于所选的人工构造解和 $a=1$ 的情况，由于周期性，$u(\\cdot,T)$ 等于 $u(\\cdot,0)$，这简化了误差评估。\n- 误差度量：对于每个网格，计算在时间 $T$ 时的离散均方根（RMS）误差，\n$$\nE(N_x) = \\Bigg(\\frac{1}{N_x}\\sum_{j=0}^{N_x-1}\\big(u_j^{\\text{num}}(T) - u(x_j,T)\\big)^2\\Bigg)^{1/2},\n$$\n其中 $x_j=j\\Delta x$，$u_j^{\\text{num}}(T)$ 是在时间 $T$ 的黑箱解。\n- 有界性监控：对于每次运行，计算放大率\n$$\nG = \\frac{\\max_j |u_j^{\\text{num}}(T)|}{\\max_j |u_j^{\\text{num}}(0)|}.\n$$\n如果在任何加密级别上，运行产生了非有限数值或 $G  10^3$，则判定该格式在当前测试配置下不稳定，并且该情况下的相容性结论为不确定。\n\n基于 Lax 等价性原理的判定规则：\n- 如果在任何加密级别上检测到不稳定性（非有限数值或 $G10^3$），则对该情况输出整数 $-1$（不稳定；无法得出相容性结论）。\n- 否则，如果误差序列 $E(N_x)$ 随加密严格递减，并且最细网格上的误差满足 $E(400)  0.05$，则判定该格式是收敛的，因此根据 Lax 原理是相容的；对该情况输出整数 $1$。\n- 否则，如果序列不递减或最细网格上的误差未降至指定容差以下，则判定该格式与目标偏微分方程不相容；对该情况输出整数 $0$。\n\n测试套件和参数：\n- 将你的实验应用于三个不透明的求解器实例，它们都号称能求解目标问题，分别标识为 $\\text{BB1}$、$\\text{BB2}$ 和 $\\text{BB3}$。将它们视为内部无法检查的黑箱。对这三者均使用参数 $a=1.0$、$\\text{CFL}=0.45$ 和 $T=1.0$。\n- 你的程序必须按照 $[\\text{BB1},\\text{BB2},\\text{BB3}]$ 的顺序为这三个标识符执行实验，并使用上述判定规则为每个标识符产生一个结论。\n\n最终输出格式：\n- 你的程序应产生一行输出，其中包含按 $[\\text{BB1},\\text{BB2},\\text{BB3}]$ 顺序排列的三个整数结果，形式为用方括号括起来的逗号分隔列表。例如，一个有效的输出可以是 $[1,0,-1]$。",
            "solution": "我们从相容性、稳定性和 Lax 等价性原理 (Lax) 的基本定义开始。对于一个线性的、适定的初值问题，例如带有周期性边界条件的常系数平流方程 $u_t + a u_x = 0$，Lax 等价性原理指出，相容性加上稳定性等价于收敛性，反之，收敛性也意味着相容性。因此，如果我们能通过经验观察到收敛，同时在加密路径上排除了不稳定性，那么我们就可以断定底层格式相对于给定偏微分方程是相容的。\n\n为了在仅有求解器黑箱访问权限的情况下将此付诸实践，我们使用人工构造解法。选择目标偏微分方程的一个精确光滑解；我们选取 $u(x,t) = \\sin(2\\pi(x - a t))$，对于任意正常数 $a$，它都满足在 $[0,1]$ 上带有周期性边界条件的方程 $u_t + a u_x = 0$。当 $a=1$ 和 $T=1$ 时，周期性使得 $u(x,1)=u(x,0)$，这有助于误差评估，因为在时间 $T$ 的任何差异都完全源于离散化效应，而非精确解在周期域上的振幅或相位的变化。\n\n我们通过均匀网格定义一个加密路径，其中 $N_x \\in \\{50,100,200,400\\}$，使得 $\\Delta x = 1/N_x$。为了平衡空间和时间的加密，我们选择固定的 Courant–Friedrichs–Lewy 数 $\\text{CFL}=0.45$，并设置 $\\Delta t = \\text{CFL}\\cdot \\Delta x/a$。这确保了 $\\Delta x \\to 0$ 和 $\\Delta t \\to 0$ 成比例地进行，这与典型的显式平流格式的稳定性约束兼容，并保持了测试的通用性。\n\n对于每个加密级别，我们将人工构造的初始条件 $u(x,0)=\\sin(2\\pi x)$ 提供给黑箱求解器，并积分到最终时间 $T=1$。然后我们计算离散均方根误差\n$$\nE(N_x) = \\left(\\frac{1}{N_x}\\sum_{j=0}^{N_x-1}\\big(u_j^{\\text{num}}(T) - \\sin(2\\pi(x_j - a T))\\big)^2\\right)^{1/2}.\n$$\n为防止不稳定性（不稳定性会使从收敛失败推导出的相容性结论无效），我们还监控放大率\n$$\nG = \\frac{\\max_j |u_j^{\\text{num}}(T)|}{\\max_j |u_j^{\\text{num}}(0)|}.\n$$\n如果在任何加密级别上出现非有限数值或 $G10^3$，我们将其归类为不稳定运行并报告 $-1$，因为 Lax 原理指出，在没有稳定性的情况下，不收敛并不意味着不相容。\n\n如果所有运行都保持有界，我们通过 $E(N_x)$ 在不同加密级别上的行为来评估收敛性。一个相容且稳定的格式应该在 $N_x\\to\\infty$ 时产生 $E(N_x)\\to 0$。我们采用两个稳健且不假设特定阶数的定量检查：\n- 误差必须随每次加密而严格减小，即 $E(400)  E(200)  E(100)  E(50)$。\n- 最细网格上的误差必须相对于信号幅度较小；我们要求 $E(400)  0.05$。\n\n如果两者都满足，我们判定其为收敛，并根据 Lax 原理判定其为相容，报告 $1$。否则，该格式有界但不收敛于目标偏微分方程的解；我们判定其不相容并报告 $0$。\n\n对于提供的测试套件，有三个不透明的求解器实例：$\\text{BB1}$、$\\text{BB2}$ 和 $\\text{BB3}$，均使用 $a=1.0$、$\\text{CFL}=0.45$、$T=1.0$ 进行测试。应用该程序：\n- 对于 $\\text{BB1}$，误差在网格加密下减小，且最细网格误差低于阈值，表明收敛；因此，根据 Lax 原理，该格式与平流偏微分方程是相容的，结论为 $1$。\n- 对于 $\\text{BB2}$，运行保持有界，但随着网格加密，误差并未减小到接近零（由于求解的是一个不同的动力学系统，误差渐近到一个非零的建模误差），因此结论为 $0$（不相容）。\n- 对于 $\\text{BB3}$，放大率在至少一个加密级别上超过了稳定性阈值，表明不稳定；我们无法得出相容性的结论，因此结论为 $-1$。\n\n该程序实现了这个实验，计算了误差和放大率，应用了判定规则，并以 $[r_1,r_2,r_3]$ 的格式（对应 $[\\text{BB1},\\text{BB2},\\text{BB3}]$）将结果打印为一行。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef manufactured_solution(x, t, a):\n    # u(x,t) = sin(2*pi*(x - a t))\n    return np.sin(2.0 * np.pi * (x - a * t))\n\ndef bb1_upwind_advection(u0, a, dx, dt, T):\n    \"\"\"\n    Black-box BB1: Upwind scheme for linear advection (a>0), periodic domain.\n    Stable for CFL = 1, first-order accurate, consistent with advection PDE.\n    \"\"\"\n    u = u0.copy()\n    steps = max(1, int(np.ceil(T / dt)))\n    dt_eff = T / steps\n    cfl = a * dt_eff / dx\n    max_amp = np.max(np.abs(u))\n    for _ in range(steps):\n        u = u - cfl * (u - np.roll(u, 1))\n        # Monitor growth\n        max_amp = max(max_amp, np.max(np.abs(u)))\n        if not np.isfinite(max_amp) or max_amp > 1e8:  # early exit on blow-up\n            break\n    return u, max_amp\n\ndef bb2_implicit_heat(u0, nu, dx, dt, T):\n    \"\"\"\n    Black-box BB2: Backward Euler (implicit) for heat equation u_t = nu u_xx, periodic.\n    Unconditionally stable, but inconsistent with advection PDE if tested against it.\n    Uses spectral diagonalization of the discrete Laplacian.\n    \"\"\"\n    u = u0.copy()\n    N = u.size\n    steps = max(1, int(np.ceil(T / dt)))\n    dt_eff = T / steps\n    mu = nu * dt_eff / (dx * dx)\n\n    # Precompute spectral denominator for backward Euler: 1 + 4*mu*sin^2(pi k / N)\n    k = np.arange(0, N//2 + 1, dtype=float)  # rfft frequencies\n    s2 = np.sin(np.pi * k / N) ** 2\n    denom = 1.0 + 4.0 * mu * s2\n\n    max_amp = np.max(np.abs(u))\n    for _ in range(steps):\n        U = np.fft.rfft(u)\n        U_next = U / denom\n        u = np.fft.irfft(U_next, n=N)\n        max_amp = max(max_amp, np.max(np.abs(u)))\n        if not np.isfinite(max_amp) or max_amp > 1e8:\n            break\n    return u, max_amp\n\ndef bb3_ftcs_advection(u0, a, dx, dt, T):\n    \"\"\"\n    Black-box BB3: FTCS (Forward-Time Centered-Space) for advection, periodic.\n    This is known to be unstable for linear advection; intended to trigger instability.\n    \"\"\"\n    u = u0.copy()\n    steps = max(1, int(np.ceil(T / dt)))\n    dt_eff = T / steps\n    cfl = a * dt_eff / dx\n    max_amp = np.max(np.abs(u))\n    for _ in range(steps):\n        u = u - 0.5 * cfl * (np.roll(u, -1) - np.roll(u, 1))\n        max_amp = max(max_amp, np.max(np.abs(u)))\n        if np.any(~np.isfinite(u)) or max_amp > 1e8:\n            break\n    return u, max_amp\n\ndef run_black_box(identifier, Nx, a, cfl, T, nu_heat=0.01):\n    \"\"\"\n    Emulated black-box dispatcher. Interface is opaque to the experiment logic.\n    \"\"\"\n    dx = 1.0 / Nx\n    dt = cfl * dx / abs(a) if a != 0 else cfl * dx\n    x = np.linspace(0.0, 1.0, Nx, endpoint=False)\n    u0 = manufactured_solution(x, 0.0, a)\n\n    if identifier == \"BB1\":\n        un, max_amp = bb1_upwind_advection(u0, a, dx, dt, T)\n    elif identifier == \"BB2\":\n        un, max_amp = bb2_implicit_heat(u0, nu_heat, dx, dt, T)\n    elif identifier == \"BB3\":\n        un, max_amp = bb3_ftcs_advection(u0, a, dx, dt, T)\n    else:\n        raise ValueError(\"Unknown black-box identifier.\")\n\n    return x, u0, un, max_amp, dt\n\ndef classify_consistency(identifier, a=1.0, cfl=0.45, T=1.0):\n    \"\"\"\n    Execute the Lax-principle-based numerical experiment to determine\n    if the black-box scheme is consistent with the advection PDE.\n    Returns:\n    -1: unstable (cannot conclude),\n     1: consistent (convergent and bounded),\n     0: inconsistent (bounded but non-convergent).\n    \"\"\"\n    Nx_list = [50, 100, 200, 400]\n    errors = []\n    unstable = False\n    for Nx in Nx_list:\n        x, u0, un, max_amp, dt_used = run_black_box(identifier, Nx, a, cfl, T)\n        # Exact at final time\n        u_exact_T = manufactured_solution(x, T, a)\n        # Compute RMS error\n        err = np.sqrt(np.mean((un - u_exact_T) ** 2))\n        errors.append(err)\n        # Boundedness monitor\n        init_amp = np.max(np.abs(u0))\n        if init_amp == 0:\n            growth = np.inf if np.max(np.abs(un)) > 0 else 1.0\n        else:\n            growth = (np.max(np.abs(un)) / init_amp)\n        if not np.isfinite(growth) or growth > 1e3 or not np.all(np.isfinite(un)):\n            unstable = True\n            break\n\n    if unstable:\n        return -1\n\n    # Check monotonic decrease and small finest error\n    monotone = all(errors[i+1]  errors[i] for i in range(len(errors)-1))\n    finest_small = errors[-1]  5e-2  # threshold per problem design\n    if monotone and finest_small:\n        return 1\n    else:\n        return 0\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Three opaque solvers: BB1, BB2, BB3; parameters a=1.0, CFL=0.45, T=1.0\n    test_cases = [\n        (\"BB1\", 1.0, 0.45, 1.0),\n        (\"BB2\", 1.0, 0.45, 1.0),\n        (\"BB3\", 1.0, 0.45, 1.0),\n    ]\n\n    results = []\n    for ident, a, cfl, T in test_cases:\n        verdict = classify_consistency(ident, a=a, cfl=cfl, T=T)\n        results.append(verdict)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}