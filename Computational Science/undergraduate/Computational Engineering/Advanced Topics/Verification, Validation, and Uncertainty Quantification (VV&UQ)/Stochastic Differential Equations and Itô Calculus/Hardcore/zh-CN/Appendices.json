{
    "hands_on_practices": [
        {
            "introduction": "当我们将随机微分方程从理论转向计算机模拟时，数值方法的稳定性是一个首要问题。与常微分方程不同，随机项引入了新的不稳定性来源。本练习  将引导你分析最常用的欧拉-丸山（Euler-Maruyama）格式的均方稳定性，并推导出稳定时间步长的边界，这对于确保任何SDE模拟结果的可靠性都至关重要。",
            "id": "2439998",
            "problem": "考虑以下伊东意义下的标量线性随机微分方程（SDE）\n$$\ndX_t = \\lambda X_t \\, dt + \\mu X_t \\, dW_t,\\quad X_0 = x_0,\n$$\n其中 $W_t$ 表示标准维纳过程（标准布朗运动），$\\lambda \\in \\mathbb{R}$ 和 $\\mu \\in \\mathbb{R}$ 为常数。将具有均匀时间步长 $h>0$ 的显式欧拉–丸山 (EM) 方法应用于此 SDE，可得到以下递推关系\n$$\nX_{n+1} = X_n + \\lambda h X_n + \\mu X_n \\Delta W_n,\n$$\n其中 $\\Delta W_n = W_{t_{n+1}} - W_{t_n}$ 是服从分布 $\\mathcal{N}(0,h)$ 的独立高斯随机变量。\n\n定义离散时间方法的零解的均方稳定性如下：对于固定的步长 $h>0$，如果对于任何具有有限二阶矩的初始条件 $X_0$ 都满足\n$$\n\\mathbb{E}\\big[|X_n|^2\\big] \\to 0 \\text{ as } n \\to \\infty\n$$\n则零解是均方稳定的。均方稳定性边界 $h^\\star(\\lambda,\\mu)$ 是使欧拉–丸山方法均方稳定的所有 $h>0$ 的上确界。\n\n任务：从第一性原理和上述定义出发，推导 $h^\\star(\\lambda,\\mu)$ 作为 $\\lambda$ 和 $\\mu$ 的函数的封闭形式表达式，覆盖所有情况，包括不存在正步长可使方法达到均方稳定的情况。然后，编写一个程序，对下方指定的测试套件中的每对参数计算 $h^\\star(\\lambda,\\mu)$，将每个结果四舍五入到 $6$ 位小数，并输出这些值的列表。\n\n测试套件（每个条目是一对 $(\\lambda,\\mu)$）：\n- $(-2.0, 1.0)$\n- $(-1.0, 0.0)$\n- $(-0.5, 1.0)$\n- $(0.5, 0.1)$\n- $(-3.0, 2.0)$\n\n要求的最终输出格式：您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表（例如，$[r_1,r_2,r_3,r_4,r_5]$），其中每个 $r_k$ 是第 $k$ 个测试用例的 $h^\\star(\\lambda,\\mu)$ 值，四舍五入到 $6$ 位小数。不涉及物理单位，所有数值结果必须报告为实数。",
            "solution": "该问题要求推导应用于标量线性随机微分方程的显式欧拉-丸山方法的均方稳定性边界，记为 $h^\\star(\\lambda, \\mu)$。推导过程必须从第一性原理出发。\n\n所讨论的 SDE 为\n$$\ndX_t = \\lambda X_t \\, dt + \\mu X_t \\, dW_t, \\quad X_0 = x_0,\n$$\n其中 $\\lambda \\in \\mathbb{R}$ 和 $\\mu \\in \\mathbb{R}$ 是常数，而 $W_t$ 是标准维纳过程。\n\n欧拉-丸山 (EM) 方法提供了一种离散时间近似。对于均匀时间步长 $h > 0$，递推关系如下\n$$\nX_{n+1} = X_n + \\lambda h X_n + \\mu X_n \\Delta W_n,\n$$\n其中 $\\Delta W_n = W_{t_{n+1}} - W_{t_n}$。这些增量是独立同分布的高斯随机变量，$\\Delta W_n \\sim \\mathcal{N}(0, h)$。我们可以将 $X_{n+1}$ 的表达式进行因式分解：\n$$\nX_{n+1} = (1 + \\lambda h + \\mu \\Delta W_n) X_n.\n$$\n零解的均方稳定性由条件 $\\mathbb{E}\\big[|X_n|^2\\big] \\to 0$（当 $n \\to \\infty$ 时）定义。我们定义 $M_n = \\mathbb{E}\\big[|X_n|^2\\big]$ 并为其推导一个递推关系。\n$$\nM_{n+1} = \\mathbb{E}\\big[|X_{n+1}|^2\\big] = \\mathbb{E}\\Big[\\big|(1 + \\lambda h + \\mu \\Delta W_n) X_n\\big|^2\\Big] = \\mathbb{E}\\Big[|1 + \\lambda h + \\mu \\Delta W_n|^2 |X_n|^2\\Big].\n$$\n$X_n$ 的值由维纳过程直到时间 $t_n$ 的历史所确定，因此它是 $\\mathcal{F}_{t_n}$-可测的。增量 $\\Delta W_n = W_{t_{n+1}} - W_{t_n}$ 独立于 $\\sigma$-代数 $\\mathcal{F}_{t_n}$。因此，$X_n$ 和 $\\Delta W_n$ 是独立的。这使我们可以分离期望：\n$$\nM_{n+1} = \\mathbb{E}\\Big[|1 + \\lambda h + \\mu \\Delta W_n|^2\\Big] \\cdot \\mathbb{E}\\big[|X_n|^2\\big] = R(\\lambda, \\mu, h) M_n,\n$$\n其中 $R(\\lambda, \\mu, h) = \\mathbb{E}\\big[|1 + \\lambda h + \\mu \\Delta W_n|^2\\big]$ 是均方放大因子。\n\n为了求出 $R(\\lambda, \\mu, h)$，我们展开期望内的表达式：\n$$\nR(\\lambda, \\mu, h) = \\mathbb{E}\\big[(1 + \\lambda h)^2 + 2(1 + \\lambda h)\\mu \\Delta W_n + \\mu^2 (\\Delta W_n)^2\\big].\n$$\n利用期望的线性性质，我们得到\n$$\nR(\\lambda, \\mu, h) = (1 + \\lambda h)^2 + 2(1 + \\lambda h)\\mu \\mathbb{E}[\\Delta W_n] + \\mu^2 \\mathbb{E}[(\\Delta W_n)^2].\n$$\n维纳增量的性质是 $\\mathbb{E}[\\Delta W_n] = 0$ 和 $\\mathbb{E}[(\\Delta W_n)^2] = \\text{Var}(\\Delta W_n) = h$。将这些值代入 $R$ 的表达式可得\n$$\nR(\\lambda, \\mu, h) = (1 + \\lambda h)^2 + 2(1 + \\lambda h)\\mu \\cdot 0 + \\mu^2 h = (1 + \\lambda h)^2 + \\mu^2 h.\n$$\n展开此式，我们有\n$$\nR(\\lambda, \\mu, h) = 1 + 2\\lambda h + \\lambda^2 h^2 + \\mu^2 h.\n$$\n递推关系 $M_{n+1} = R(\\lambda, \\mu, h) M_n$ 描述了均方值的几何级数。要使 $M_n \\to 0$（当 $n \\to \\infty$ 时），其充分必要条件是放大因子满足 $|R(\\lambda, \\mu, h)|  1$。\n由于 $h > 0$ 且 $\\mu^2 \\ge 0$，我们有 $R(\\lambda, \\mu, h) = (1+\\lambda h)^2 + \\mu^2 h \\ge 0$。因此，稳定性条件简化为 $0 \\le R(\\lambda, \\mu, h)  1$。这等价于\n$$\n1 + 2\\lambda h + \\lambda^2 h^2 + \\mu^2 h  1.\n$$\n两边减 1 得\n$$\n2\\lambda h + \\lambda^2 h^2 + \\mu^2 h  0.\n$$\n由于我们寻求 $h > 0$ 的解，我们可以用 $h$ 除该不等式：\n$$\n2\\lambda + \\mu^2 + \\lambda^2 h  0.\n$$\n现在我们必须解这个关于 $h$ 的不等式。\n\n情况 1：$\\lambda = 0$。\n不等式变为 $2(0) + \\mu^2 + (0)^2 h  0$，简化为 $\\mu^2  0$。对于任何实数 $\\mu$，此不等式都无解。因此，如果 $\\lambda = 0$，不存在任何步长 $h > 0$ 能使 EM 方法均方稳定。稳定步长的集合是空集，其上确界为 $h^\\star(0, \\mu) = 0$。\n\n情况 2：$\\lambda \\ne 0$。\n我们重排不等式以分离出 $h$：\n$$\n\\lambda^2 h  -(2\\lambda + \\mu^2).\n$$\n由于 $\\lambda \\ne 0$，所以 $\\lambda^2 > 0$。用 $\\lambda^2$ 除不等式，方向不变：\n$$\nh  -\\frac{2\\lambda + \\mu^2}{\\lambda^2}.\n$$\n为了存在满足此条件的正数 $h$，不等式右侧必须为正。这要求\n$$\n-\\frac{2\\lambda + \\mu^2}{\\lambda^2} > 0 \\implies -(2\\lambda + \\mu^2) > 0 \\implies 2\\lambda + \\mu^2  0.\n$$\n如果 $2\\lambda + \\mu^2  0$，那么区间 $\\left(0, -\\frac{2\\lambda + \\mu^2}{\\lambda^2}\\right)$ 内的任何步长 $h$ 都会得到一个均方稳定的格式。稳定性边界 $h^\\star(\\lambda, \\mu)$ 是这组稳定步长的上确界，即该区间的上界：\n$$\nh^\\star(\\lambda, \\mu) = -\\frac{2\\lambda + \\mu^2}{\\lambda^2}.\n$$\n另一方面，如果 $2\\lambda + \\mu^2 \\ge 0$，则关于 $h$ 的不等式的右侧小于或等于零。没有正数 $h$ 能满足该条件。稳定步长的集合是空集，其上确界为 $h^\\star(\\lambda, \\mu) = 0$。\n\n综合这些结果，我们推导出均方稳定性边界的最终封闭形式表达式：\n$$\nh^\\star(\\lambda, \\mu) =\n\\begin{cases}\n    -\\frac{2\\lambda + \\mu^2}{\\lambda^2}  \\text{如果 } \\lambda \\neq 0 \\text{ 且 } 2\\lambda + \\mu^2  0 \\\\\n    0  \\text{其他情况}\n\\end{cases}\n$$\n该表达式在提供的程序中实现，用于计算指定测试用例的 $h^\\star(\\lambda, \\mu)$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the mean-square stability boundary h_star for the Euler-Maruyama\n    method applied to a scalar linear SDE for a given set of parameters.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each entry is a tuple (lambda, mu).\n    test_cases = [\n        (-2.0, 1.0),\n        (-1.0, 0.0),\n        (-0.5, 1.0),\n        (0.5, 0.1),\n        (-3.0, 2.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        lambda_val, mu_val = case\n        \n        # The stability boundary h_star is derived from the condition\n        # for mean-square stability of the Euler-Maruyama method:\n        # h_star = sup{h > 0 | (1 + lambda*h)^2 + mu^2*h  1}.\n        # This simplifies to h  -(2*lambda + mu^2) / lambda^2,\n        # which requires 2*lambda + mu^2  0 for a positive solution h to exist.\n\n        # The closed-form expression for h_star is:\n        # h_star = - (2*lambda + mu^2) / lambda^2   if 2*lambda + mu^2  0 and lambda != 0\n        # h_star = 0                                otherwise\n\n        h_star = 0.0\n        \n        # Check if lambda is non-zero to avoid division by zero.\n        if lambda_val != 0.0:\n            stability_condition = 2 * lambda_val + mu_val**2\n            \n            # If the condition is met, a positive stability boundary exists.\n            if stability_condition  0.0:\n                h_star = -stability_condition / (lambda_val**2)\n\n        # Round the result to 6 decimal places as required.\n        # Using f-string for formatting ensures the trailing zeros are kept.\n        rounded_result = f\"{h_star:.6f}\"\n        results.append(rounded_result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "一个强大的数学模型如果不能与真实世界的数据相结合，其价值将大打折扣。此练习  聚焦于金融领域基石性的几何布朗运动（Geometric Brownian Motion, GBM）模型，带你实践如何从离散的观测数据中估计其关键参数——漂移率 $\\mu$ 和波动率 $\\sigma$。你将运用伊东引理（Itô's lemma）和最大似然估计（Maximum Likelihood Estimation）原理，亲手搭建起连接抽象理论与具体金融时间序列分析的桥梁。",
            "id": "2440008",
            "problem": "考虑一个标量资产价格，其模型为几何布朗运动 (GBM)，即它满足随机微分方程 (SDE) $dS_t = \\mu S_t \\, dt + \\sigma S_t \\, dW_t$，其中 $S_t$ 是时间 $t$ 的价格，$\\mu$ 是漂移率，$\\sigma$ 是波动率，$W_t$ 是标准布朗运动 (BM)。从该SDE出发，并且仅使用伊东微积分的基本定义（特别是应用于对数的伊东引理），为未知参数 $\\mu$ 和 $\\sigma$ 推导一个基于最大似然估计 (MLE) 的统计学上合理的估计量，该估计量基于在均匀时间步长 $\\Delta t$ 采样得到的离散时间序列观测值 $S_0,S_1,\\dots,S_n$。\n\n您的推导必须从SDE定义开始，使用伊东引理得到 $\\log S_t$ 的动态过程，然后继续使用基于似然的论证，针对独立同分布 (IID) 的增量，从而生成以观测序列 $S_0,\\dots,S_n$ 和采样间隔 $\\Delta t$ 表示的 $\\mu$ 和 $\\sigma$ 的显式估计量。除了直接从这些原理中得到的公式外，不要引用任何快捷公式。\n\n然后，在一个完整的、可运行的程序中实现这些估计量，对于下方的每个测试用例，该程序将根据给定的初始值和预设的对数收益率序列重建观测到的价格序列，并仅使用重建的价格序列（而不是给定的收益率）计算 $\\mu$ 和 $\\sigma$ 的MLE估计值。为了保证不同实现之间的数值可复现性，将报告的每个 $\\mu$ 和 $\\sigma$ 四舍五入到六位小数。\n\n测试套件规范：\n- 每个测试用例提供一个初始价格 $S_0$、一个时间步长 $\\Delta t$ 以及一个对数收益率列表 $Y_1,\\dots,Y_n$。观测价格由 $S_k = S_{k-1} \\exp(Y_k)$ 对 $k=1,\\dots,n$ 递归定义。您的程序必须首先根据这些定义重建价格序列，然后从重建的序列中计算MLE。\n- 测试用例：\n  1. 具有中等变异性的一般情况：\n     - $S_0 = 100$，$\\Delta t = 0.1$，$[Y_1,\\dots,Y_{10}] = [0.02,-0.05,0.03,0.1,-0.08,0.04,0.0,-0.02,0.06,-0.03]$。\n  2. 具有单个增量和零变异性的边界情况：\n     - $S_0 = 50$，$\\Delta t = 0.5$，$[Y_1] = [0.0]$。\n  3. 具有小变异性的负漂移：\n     - $S_0 = 80$，$\\Delta t = 0.25$，$[Y_1,\\dots,Y_8] = [-0.1,0.02,-0.03,-0.04,0.01,-0.019,-0.05,0.03]$。\n  4. 具有混合符号的高变异性：\n     - $S_0 = 10$，$\\Delta t = 0.5$，$[Y_1,\\dots,Y_5] = [0.15,0.0,-0.2,0.25,-0.1]$。\n\n输出规范：\n- 对于每个测试用例，从重建的序列中计算MLE $\\hat{\\mu}$ 和 $\\hat{\\sigma}$。\n- 将所有结果按 $[\\hat{\\mu}_1,\\hat{\\sigma}_1,\\hat{\\mu}_2,\\hat{\\sigma}_2,\\hat{\\mu}_3,\\hat{\\sigma}_3,\\hat{\\mu}_4,\\hat{\\sigma}_4]$ 的顺序聚合到一个扁平列表中，其中下标表示测试用例的索引。\n- 在输出前将每个数字四舍五入到六位小数。\n- 您的程序应生成单行输出，其中包含四舍五入后的结果，格式为逗号分隔的列表，并用方括号括起来，例如 $[\\hat{\\mu}_1,\\hat{\\sigma}_1,\\dots]$，每个条目格式化为六位小数。\n\n所有答案都是没有物理单位的实数，不涉及角度。您的最终输出必须是格式化为六位小数的浮点数。程序必须是自包含的并且不使用任何输入。",
            "solution": "问题陈述經评估有效。这是一个随机微积分和统计推断领域中定义明确的问题，基于成熟的金融工程原理。数据完整，目标明确。我们继续进行推导和求解。\n\n资产价格 $S_t$ 由几何布朗运动 (GBM) 的随机微分方程 (SDE) 建模：\n$$ dS_t = \\mu S_t \\, dt + \\sigma S_t \\, dW_t $$\n其中 $\\mu$ 是漂移参数，$\\sigma$ 是波动率参数，$W_t$ 是标准维纳过程或布朗运动。我们的目标是根据在均匀时间间隔 $\\Delta t$ 采样的离散时间序列观测值 $S_0, S_1, \\dots, S_n$ 来推导 $\\mu$ 和 $\\sigma$ 的最大似然估计量 (MLE)。\n\n推导始于对函数 $f(S_t) = \\log S_t$ 应用伊东引理。令 $X_t = \\log S_t$。函数 $f(S_t)$ 关于 $t$ 和 $S_t$ 的偏导数为：\n$$ \\frac{\\partial f}{\\partial t} = 0, \\quad \\frac{\\partial f}{\\partial S_t} = \\frac{1}{S_t}, \\quad \\frac{\\partial^2 f}{\\partial S_t^2} = -\\frac{1}{S_t^2} $$\n根据伊东引理，微分 $dX_t$ 由下式给出：\n$$ dX_t = \\left( \\frac{\\partial f}{\\partial t} + \\mu S_t \\frac{\\partial f}{\\partial S_t} + \\frac{1}{2} \\sigma^2 S_t^2 \\frac{\\partial^2 f}{\\partial S_t^2} \\right) dt + \\left( \\sigma S_t \\frac{\\partial f}{\\partial S_t} \\right) dW_t $$\n将偏导数代入此表达式可得：\n$$ dX_t = \\left( 0 + \\mu S_t \\left(\\frac{1}{S_t}\\right) + \\frac{1}{2} \\sigma^2 S_t^2 \\left(-\\frac{1}{S_t^2}\\right) \\right) dt + \\left( \\sigma S_t \\left(\\frac{1}{S_t}\\right) \\right) dW_t $$\n简化各项，我们得到对数价格过程 $X_t$ 的SDE：\n$$ dX_t = \\left(\\mu - \\frac{1}{2}\\sigma^2\\right) dt + \\sigma dW_t $$\n这是一个具有恒定漂移 $\\mu - \\frac{1}{2}\\sigma^2$ 和恒定波动率 $\\sigma$ 的算术布朗运动。\n\n为了分析离散观测值，我们将此SDE在时间区间 $[t_{k-1}, t_k]$ 上积分，其中 $t_k = k \\Delta t$。此区间内对数价格的变化为：\n$$ X_{t_k} - X_{t_{k-1}} = \\int_{t_{k-1}}^{t_k} \\left(\\mu - \\frac{1}{2}\\sigma^2\\right) dt + \\int_{t_{k-1}}^{t_k} \\sigma dW_t $$\n令 $Y_k = X_{t_k} - X_{t_{k-1}} = \\log(S_{t_k}) - \\log(S_{t_{k-1}})$ 为第 $k$ 个区间的对数收益率。第一个积分是确定性的，而第二个是伊东积分。\n$$ Y_k = \\left(\\mu - \\frac{1}{2}\\sigma^2\\right) (t_k - t_{k-1}) + \\sigma (W_{t_k} - W_{t_{k-1}}) $$\n由于 $t_k - t_{k-1} = \\Delta t$，这变为：\n$$ Y_k = \\left(\\mu - \\frac{1}{2}\\sigma^2\\right) \\Delta t + \\sigma (W_{t_k} - W_{t_{k-1}}) $$\n标准布朗运动的增量 $W_{t_k} - W_{t_{k-1}}$ 是独立的，并且服从均值为 $0$、方差为 $\\Delta t$ 的正态分布。即，$W_{t_k} - W_{t_{k-1}} \\sim \\mathcal{N}(0, \\Delta t)$。\n因此，对数收益率 $Y_k$（对于 $k=1, \\dots, n$）是来自正态分布的独立同分布 (IID) 的随机变量：\n$$ Y_k \\sim \\mathcal{N}\\left( \\left(\\mu - \\frac{1}{2}\\sigma^2\\right) \\Delta t, \\sigma^2 \\Delta t \\right) $$\n我们为此正态分布定义新的参数：均值 $\\nu = (\\mu - \\frac{1}{2}\\sigma^2) \\Delta t$ 和方差 $\\tau^2 = \\sigma^2 \\Delta t$。因此，$Y_k \\sim \\mathcal{N}(\\nu, \\tau^2)$。\n\n我们现在基于 $n$ 个观测值 $Y_1, \\dots, Y_n$ 推导 $\\nu$ 和 $\\tau^2$ 的MLE。似然函数是每个观测值的概率密度函数的乘积：\n$$ L(\\nu, \\tau^2; Y_1, \\dots, Y_n) = \\prod_{k=1}^n \\frac{1}{\\sqrt{2\\pi \\tau^2}} \\exp\\left( -\\frac{(Y_k - \\nu)^2}{2\\tau^2} \\right) $$\n处理对数似然函数 $\\mathcal{L} = \\log L$ 更为方便：\n$$ \\mathcal{L}(\\nu, \\tau^2) = \\sum_{k=1}^n \\left( -\\frac{1}{2} \\log(2\\pi) - \\frac{1}{2} \\log(\\tau^2) - \\frac{(Y_k - \\nu)^2}{2\\tau^2} \\right) $$\n$$ \\mathcal{L}(\\nu, \\tau^2) = -\\frac{n}{2} \\log(2\\pi\\tau^2) - \\frac{1}{2\\tau^2} \\sum_{k=1}^n (Y_k - \\nu)^2 $$\n为了找到最大化此函数的估计量，我们计算关于 $\\nu$ 和 $\\tau^2$ 的偏导数并将其设为零。\n$$ \\frac{\\partial \\mathcal{L}}{\\partial \\nu} = \\frac{1}{\\tau^2} \\sum_{k=1}^n (Y_k - \\nu) = 0 \\implies \\sum_{k=1}^n Y_k - n\\nu = 0 $$\n这得到了 $\\nu$ 的MLE：\n$$ \\hat{\\nu} = \\frac{1}{n} \\sum_{k=1}^n Y_k = \\bar{Y} $$\n正态分布均值的MLE是其样本均值。\n接下来，我们对 $\\tau^2$ 求导：\n$$ \\frac{\\partial \\mathcal{L}}{\\partial (\\tau^2)} = -\\frac{n}{2\\tau^2} + \\frac{1}{2(\\tau^2)^2} \\sum_{k=1}^n (Y_k - \\nu)^2 = 0 $$\n将 $\\hat{\\nu}$ 代替 $\\nu$ 并求解 $\\tau^2$：\n$$ \\frac{n}{2\\hat{\\tau}^2} = \\frac{1}{2(\\hat{\\tau}^2)^2} \\sum_{k=1}^n (Y_k - \\hat{\\nu})^2 \\implies \\hat{\\tau}^2 = \\frac{1}{n} \\sum_{k=1}^n (Y_k - \\bar{Y})^2 $$\n这是对数收益率的样本方差，我们记为 $s_Y^2$。\n\n最后，我们使用最大似然估计量的不变性来找到我们原始参数 $\\mu$ 和 $\\sigma$ 的估计量。关系如下：\n$$ \\tau^2 = \\sigma^2 \\Delta t \\quad \\text{and} \\quad \\nu = \\left(\\mu - \\frac{1}{2}\\sigma^2\\right) \\Delta t $$\n从第一个关系中，我们估计 $\\sigma^2$：\n$$ \\hat{\\sigma}^2 = \\frac{\\hat{\\tau}^2}{\\Delta t} = \\frac{s_Y^2}{\\Delta t} = \\frac{1}{n \\Delta t} \\sum_{k=1}^n (Y_k - \\bar{Y})^2 $$\n因此，波动率 $\\sigma$ 的估计量为：\n$$ \\hat{\\sigma} = \\sqrt{\\frac{1}{n \\Delta t} \\sum_{k=1}^n (Y_k - \\bar{Y})^2} $$\n从第二个关系中，我们解出 $\\mu$：\n$$ \\mu = \\frac{\\nu}{\\Delta t} + \\frac{1}{2}\\sigma^2 $$\n代入估计量 $\\hat{\\nu}$ 和 $\\hat{\\sigma}^2$，我们得到漂移率 $\\mu$ 的估计量：\n$$ \\hat{\\mu} = \\frac{\\hat{\\nu}}{\\Delta t} + \\frac{1}{2}\\hat{\\sigma}^2 = \\frac{\\bar{Y}}{\\Delta t} + \\frac{1}{2}\\hat{\\sigma}^2 $$\n这些是根据要求从第一性原理推导出的 $\\mu$ 和 $\\sigma$ 的显式估计量。实现将从重建的价格序列中计算这些量。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (S0, delta_t, list_of_log_returns)\n    test_cases = [\n        (100.0, 0.1, [0.02, -0.05, 0.03, 0.1, -0.08, 0.04, 0.0, -0.02, 0.06, -0.03]),\n        (50.0, 0.5, [0.0]),\n        (80.0, 0.25, [-0.1, 0.02, -0.03, -0.04, 0.01, -0.019, -0.05, 0.03]),\n        (10.0, 0.5, [0.15, 0.0, -0.2, 0.25, -0.1])\n    ]\n\n    all_results = []\n    \n    for s0, delta_t, yk_list in test_cases:\n        # Reconstruct the price series S_k from S_0 and log-returns Y_k\n        # S_k = S_{k-1} * exp(Y_k)\n        price_series = [s0]\n        current_price = s0\n        for yk in yk_list:\n            current_price *= np.exp(yk)\n            price_series.append(current_price)\n        \n        # As per problem, compute estimators using ONLY the reconstructed price series.\n        # This means we must re-calculate log-returns from the price series.\n        price_series_np = np.array(price_series)\n        \n        # n is the number of returns, which is number of prices - 1.\n        n = len(price_series_np) - 1\n        \n        if n > 0:\n            # Calculate log-returns Yk = log(S_k) - log(S_{k-1})\n            log_returns = np.log(price_series_np[1:]) - np.log(price_series_np[:-1])\n            \n            # Compute sample mean of log-returns\n            y_mean = np.mean(log_returns)\n            \n            # Compute sample variance of log-returns (MLE version, ddof=0 is default in np.var)\n            y_var_mle = np.var(log_returns)\n            \n            # Estimate sigma^2 using the derived formula\n            sigma_sq_hat = y_var_mle / delta_t\n            \n            # Estimate sigma\n            sigma_hat = np.sqrt(sigma_sq_hat)\n            \n            # Estimate mu using the derived formula\n            mu_hat = (y_mean / delta_t) + 0.5 * sigma_sq_hat\n        else:\n            # If n=0 (only S0 given), estimators are undefined from returns.\n            # Handle this as an edge case, though not expected by the problem setup.\n            # The narrowest case in test suite is n=1.\n            mu_hat = 0.0\n            sigma_hat = 0.0\n\n        all_results.append(f\"{mu_hat:.6f}\")\n        all_results.append(f\"{sigma_hat:.6f}\")\n        \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "随机微分方程的最终目标之一是在不确定的环境中做出最优决策。本练习  将我们带入数学生态学的一个经典问题：如何在环境噪声的影响下，制定最优的捕捞策略以实现渔业产量的长期最大化。通过求解福克-普朗克（Fokker-Planck）方程来分析系统的稳态行为，你将学会如何运用SDE理论来解决现实世界中的资源管理和优化问题。",
            "id": "2439927",
            "problem": "给定一个单一鱼类种群在按单位生物量捕捞下的随机种群模型。其生物量过程 $\\{X_t\\}_{t \\ge 0}$ 由以下随机微分方程建模：\n$$\ndX_t \\;=\\; \\Big(r\\,X_t\\big(1 - \\tfrac{X_t}{K}\\big) \\;-\\; u\\,X_t\\Big)\\,dt \\;+\\; \\sigma\\,X_t\\,dW_t,\\quad X_0>0,\n$$\n其中 $r>0$ 是内禀增长率，$K>0$ 是环境承载力，$\\sigma \\ge 0$ 是环境噪声强度，$u \\ge 0$ 是一个恒定的单位生物量捕捞率，$\\{W_t\\}_{t \\ge 0}$ 是一个标准维纳过程（布朗运动）。长期性能准则为遍历平均产量：\n$$\nJ(u) \\;=\\; \\liminf_{T\\to\\infty}\\,\\frac{1}{T}\\,\\mathbb{E}\\!\\left[\\int_0^T u\\,X_t\\,dt\\right].\n$$\n在恒定捕捞率 $u \\in [0,u_{\\max}]$ 的类别中，设计一个最优的恒定捕捞策略以最大化 $J(u)$，并为给定的参数集计算相应的稳态平均生物量和产量。\n\n从伊东扩散和相关的福克-普朗克（前向科尔莫戈罗夫）方程的基本定义开始。仔细论证存在稳态密度和遍历平均所需的任何假设。不要假设目标公式；相反，从零通量稳态福克-普朗克方程推导出稳态密度的形状，然后获得稳态平均生物量。使用这些结果将 $J(u)$ 完全用 $(r,K,\\sigma,u)$ 表示，然后在容许界限内对 $u$ 进行最大化。\n\n您的程序必须实现推导出的最优恒定捕捞率 $u^\\star$ 的公式，并为每个测试用例报告一个三元组：\n$$\n\\big[u^\\star,\\ \\mathbb{E}[X]_{\\mathrm{stat}}(u^\\star),\\ J(u^\\star)\\big],\n$$\n作为浮点数，四舍五入到六位小数。\n\n假设所有参数都以无量纲正实数的形式给出，其中 $r>0$，$K>0$，$u_{\\max}\\ge 0$，$\\sigma\\ge 0$。如果确保可归一化稳态分布的条件不满足，您的控制应正确地默认为您的推导所暗示的最佳容许选择，并且您必须在该极限策略下返回 $\\mathbb{E}[X]_{\\mathrm{stat}}$ 和 $J$ 的一致值。\n\n测试套件：\n- 案例 A（内部最优解）：$(r,K,\\sigma,u_{\\max})=(1.0,1000.0,0.4,10.0)$。\n- 案例 B（控制边界有效）：$(r,K,\\sigma,u_{\\max})=(1.0,1000.0,0.4,0.3)$。\n- 案例 C（无正可行稳态捕捞）：$(r,K,\\sigma,u_{\\max})=(0.5,800.0,1.2,10.0)$。\n- 案例 D（正有效增长率小，边界有效）：$(r,K,\\sigma,u_{\\max})=(0.6,750.0,1.0,0.03)$。\n\n最终输出格式：\n您的程序应生成单行输出，包含所有测试用例的结果，顺序为 A、B、C、D。结果形式为一个列表的列表，其中每个内部列表的格式为：\n$$\n[u^\\star,\\ \\mathbb{E}[X]_{\\mathrm{stat}}(u^\\star),\\ J(u^\\star)],\n$$\n四舍五入到六位小数，最外层的列表包含这四个内部列表。例如，输出必须看起来像：\n$$\n[[a_1,b_1,c_1],[a_2,b_2,c_2],[a_3,b_3,c_3],[a_4,b_4,c_4]]\n$$\n不含额外的空格或文本。",
            "solution": "经严格审阅，我们确认该问题陈述有效。其科学基础是成熟的随机微分方程理论及其在种群动态学中的应用，问题本身是适定的，且所有给定信息均自洽且一致。因此，我们可以着手进行解的形式化推导。\n\n问题的核心是确定最优的恒定捕捞率 $u^\\star$，以最大化一个鱼类种群的长期平均产量，该种群的生物量 $X_t$ 由以下随机微分方程（SDE）控制：\n$$\ndX_t \\;=\\; \\Big(r\\,X_t\\big(1 - \\tfrac{X_t}{K}\\big) \\;-\\; u\\,X_t\\Big)\\,dt \\;+\\; \\sigma\\,X_t\\,dW_t\n$$\n这是一个形式为 $dX_t = a(X_t)dt + b(X_t)dW_t$ 的伊东扩散过程，其中生物量的状态空间为 $x>0$。通过整理方程，可以确定漂移系数和扩散系数：\n$$\na(x) = (r-u)x - \\frac{r}{K}x^2\n$$\n$$\nb(x) = \\sigma x\n$$\n过程 $X_t$ 的概率密度函数 $p(x,t)$ 的演化由福克-普朗克（或前向科尔莫戈罗夫）方程描述：\n$$\n\\frac{\\partial p(x,t)}{\\partial t} = -\\frac{\\partial}{\\partial x} \\big[ a(x)p(x,t) \\big] + \\frac{1}{2}\\frac{\\partial^2}{\\partial x^2} \\big[ b(x)^2 p(x,t) \\big]\n$$\n我们通过设置 $\\frac{\\partial p}{\\partial t} = 0$ 来寻求一个对应系统长期行为的稳态解 $p_s(x)$。这意味着概率通量 $S(x)$ 必须为常数：\n$$\nS(x) = a(x)p_s(x) - \\frac{1}{2}\\frac{d}{dx}\\big[ b(x)^2 p_s(x) \\big] = \\text{constant}\n$$\n为了在定义域 $(0, \\infty)$ 上存在稳态分布，边界上必须没有概率质量的净流动。如果种群可能灭绝，则边界 $x=0$ 是一个出口边界；而边界 $x=\\infty$ 必须没有概率逃逸。一个非平凡的稳态对应于零通量条件，即对于所有 $x>0$，$S(x) = 0$。这给出了一个关于 $p_s(x)$ 的一阶常微分方程：\n$$\na(x)p_s(x) = \\frac{1}{2}\\frac{d}{dx}\\big[ b(x)^2 p_s(x) \\big]\n$$\n分离变量并积分，得到稳态密度的一般形式：\n$$\np_s(x) = \\frac{N}{b(x)^2} \\exp\\left( \\int \\frac{2a(x)}{b(x)^2} dx \\right)\n$$\n其中 $N$ 是归一化常数。现在我们代入具体的漂移和扩散系数：\n$$\n\\frac{2a(x)}{b(x)^2} = \\frac{2\\left((r-u)x - \\frac{r}{K}x^2\\right)}{(\\sigma x)^2} = \\frac{2(r-u)}{\\sigma^2 x} - \\frac{2r}{\\sigma^2 K}\n$$\n积分为：\n$$\n\\int \\left( \\frac{2(r-u)}{\\sigma^2 x} - \\frac{2r}{\\sigma^2 K} \\right) dx = \\frac{2(r-u)}{\\sigma^2}\\ln x - \\frac{2r}{\\sigma^2 K} x\n$$\n将此结果代回 $p_s(x)$ 的表达式中：\n$$\np_s(x) = \\frac{N}{(\\sigma x)^2} \\exp\\left( \\frac{2(r-u)}{\\sigma^2}\\ln x - \\frac{2r}{\\sigma^2 K} x \\right) \\propto x^{-2} x^{\\frac{2(r-u)}{\\sigma^2}} \\exp\\left( -\\left(\\frac{2r}{\\sigma^2 K}\\right) x \\right)\n$$\n$$\np_s(x) = N' x^{\\left(\\frac{2(r-u)}{\\sigma^2}-2\\right)} \\exp\\left( -\\left(\\frac{2r}{\\sigma^2 K}\\right) x \\right)\n$$\n这是伽马分布的函数形式，$p(x;\\alpha,\\beta) \\propto x^{\\alpha-1}e^{-\\beta x}$。通过比较，我们确定其形状参数 $\\alpha$ 和率参数 $\\beta$：\n$$\n\\alpha - 1 = \\frac{2(r-u)}{\\sigma^2} - 2 \\implies \\alpha = \\frac{2(r-u)}{\\sigma^2} - 1\n$$\n$$\n\\beta = \\frac{2r}{\\sigma^2 K}\n$$\n为了使该密度可归一化，即积分 $\\int_0^\\infty p_s(x) dx$ 有限，我们需要 $\\alpha > 0$。这对捕捞率 $u$ 施加了一个关键条件：\n$$\n\\frac{2(r-u)}{\\sigma^2} - 1 > 0 \\implies 2(r-u) > \\sigma^2 \\implies u  r - \\frac{\\sigma^2}{2}\n$$\n如果不满足此条件，即 $u \\ge r - \\frac{\\sigma^2}{2}$，则归一化积分发散，意味着概率质量在 $x=0$ 处累积。种群几乎必然灭绝。在这种情况下，稳态是平凡的，$\\mathbb{E}[X]_{\\mathrm{stat}} = 0$，因此长期平均产量 $J(u) = 0$。\n\n如果生存条件 $u  r - \\sigma^2/2$ 成立，则存在一个非平凡的稳态分布，且过程是遍历的。遍历性意味着状态的任何函数的时间平均值将收敛于该函数相对于稳态分布的期望值。因此，性能准则由下式给出：\n$$\nJ(u) = u \\, \\mathbb{E}[X]_{\\mathrm{stat}}(u)\n$$\n伽马分布的均值是 $\\mathbb{E}[X] = \\alpha/\\beta$。因此，稳态平均生物量为：\n$$\n\\mathbb{E}[X]_{\\mathrm{stat}}(u) = \\frac{\\alpha}{\\beta} = \\frac{\\frac{2(r-u)}{\\sigma^2} - 1}{\\frac{2r}{\\sigma^2 K}} = \\frac{K}{2r}\\left(2(r-u)-\\sigma^2\\right) = K\\left(1 - \\frac{u}{r} - \\frac{\\sigma^2}{2r}\\right)\n$$\n于是，长期产量为：\n$$\nJ(u) = u K \\left(1 - \\frac{u}{r} - \\frac{\\sigma^2}{2r}\\right)\n$$\n此表达式在 $u  r - \\sigma^2/2$ 时有效。我们定义有效内禀增长率 $r_{eff} = r - \\sigma^2/2$。\n\n优化问题是在 $u \\in [0, u_{\\max}]$ 上最大化 $J(u)$。\n首先，考虑 $r_{eff} \\le 0$ 的情况，即 $r \\le \\sigma^2/2$。在这种情境下，对于任何非负捕捞率 $u \\ge 0$，条件 $u  r_{eff}$ 永远无法满足。因此，对所有 $u \\ge 0$，种群都会灭绝，且 $J(u) = 0$。最大可能产量为 $0$，在 $u^\\star = 0$ 时达到。\n\n接下来，考虑 $r_{eff} > 0$ 的情况。产量函数 $J(u)$ 是在区间 $[0, r_{eff})$ 上关于 $u$ 的开口向下的抛物线。为了找到无约束最大值，我们对 $J(u)$ 关于 $u$ 求导，并令其结果为零：\n$$\n\\frac{dJ}{du} = K\\left(1 - \\frac{u}{r} - \\frac{\\sigma^2}{2r}\\right) + uK\\left(-\\frac{1}{r}\\right) = K\\left(1 - \\frac{2u}{r} - \\frac{\\sigma^2}{2r}\\right) = 0\n$$\n$$\n1 - \\frac{\\sigma^2}{2r} = \\frac{2u}{r} \\implies u = \\frac{r}{2}\\left(1 - \\frac{\\sigma^2}{2r}\\right) = \\frac{r}{2} - \\frac{\\sigma^2}{4}\n$$\n设此候选最优值为 $u_{cand} = \\frac{r}{2} - \\frac{\\sigma^2}{4}$。由于 $r_{eff}>0$ 意味着 $r>\\sigma^2/2$，我们有 $u_{cand} > 0$。同时，$u_{cand}  r - \\sigma^2/2 = r_{eff}$，因此该最大值位于抛物线产量函数的有效域内。\n最终的最优捕捞率 $u^\\star$ 还必须满足约束条件 $u \\in [0, u_{\\max}]$。由于 $J(u)$ 在 $u \\in [0, u_{cand}]$ 上是递增的，最优的带约束控制为：\n$$\nu^\\star = \\min(u_{cand}, u_{\\max}) = \\min\\left(\\frac{r}{2} - \\frac{\\sigma^2}{4}, u_{\\max}\\right)\n$$\n基于此推导，完整的算法如下：\n1. 给定 $(r, K, \\sigma, u_{\\max})$，计算生存阈值 $r_{eff} = r - \\sigma^2/2$。\n2. 如果 $r_{eff} \\le 0$：系统不可持续。最优策略是不捕捞。设置 $u^\\star=0$，$\\mathbb{E}[X]_{\\mathrm{stat}}(u^\\star)=0$，以及 $J(u^\\star)=0$。\n3. 如果 $r_{eff} > 0$：系统可以维持捕捞。\n    a. 计算无约束最优率 $u_{cand} = r/2 - \\sigma^2/4$。\n    b. 最优约束率为 $u^\\star = \\min(u_{cand}, u_{\\max})$。\n    c. 相应的稳态平均生物量为 $\\mathbb{E}[X]_{\\mathrm{stat}}(u^\\star) = K(1 - u^\\star/r - \\sigma^2/(2r))$。\n    d. 最大产量为 $J(u^\\star) = u^\\star \\cdot \\mathbb{E}[X]_{\\mathrm{stat}}(u^\\star)$。\n\n该算法被实现以解决给定的测试用例。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the optimal constant harvesting strategy for a stochastic\n    population model and computes the corresponding stationary mean biomass and yield.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (r, K, sigma, u_max)\n    test_cases = [\n        (1.0, 1000.0, 0.4, 10.0),  # Case A\n        (1.0, 1000.0, 0.4, 0.3),   # Case B\n        (0.5, 800.0, 1.2, 10.0),   # Case C\n        (0.6, 750.0, 1.0, 0.03)    # Case D\n    ]\n\n    results = []\n    for r, K, sigma, u_max in test_cases:\n        sigma_sq = sigma**2\n        \n        # Calculate the effective growth rate condition for population survival.\n        # If r_eff_survival = 0, the population goes extinct even with no harvesting.\n        r_eff_survival = r - sigma_sq / 2.0\n        \n        if r_eff_survival = 0:\n            # No sustainable positive yield is possible.\n            # Optimal strategy is to not harvest.\n            u_star = 0.0\n            E_X_stat = 0.0\n            J_u_star = 0.0\n        else:\n            # A sustainable population is possible.\n            # Calculate the candidate for the optimal harvesting rate, which maximizes the yield parabola.\n            u_cand = r / 2.0 - sigma_sq / 4.0\n            \n            # The optimal harvesting rate is the candidate rate, capped by the maximum allowed rate.\n            u_star = np.minimum(u_cand, u_max)\n            \n            # Calculate the stationary mean biomass at the optimal harvesting rate.\n            E_X_stat = K * (1.0 - u_star / r - sigma_sq / (2.0 * r))\n            if E_X_stat  0: # Should not happen with correct logic, but as safeguard\n                E_X_stat = 0.0\n\n            # Calculate the corresponding optimal long-run average yield.\n            J_u_star = u_star * E_X_stat\n\n        # Store the triplet of results, rounded to six decimal places.\n        results.append([\n            round(u_star, 6),\n            round(E_X_stat, 6),\n            round(J_u_star, 6)\n        ])\n\n    # Format the final output according to the problem specification:\n    # [[a1,b1,c1],[a2,b2,c2],...] with no extraneous whitespace.\n    formatted_results = [f\"[{r[0]},{r[1]},{r[2]}]\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}