{
    "hands_on_practices": [
        {
            "introduction": "通量限制器（Flux Limiter）方法的核心在于限制器函数 $\\phi(r)$，它根据解的局部光滑度（由梯度比 $r$ 体现）来智能地调整数值格式。在动手实现一个完整的求解器之前，理解不同限制器在关键情况下的行为至关重要。本练习将通过分析解在局部极值点或平坦区域（对应于 $r$ 的特殊值，如 $0$、$\\infty$ 或未定义）附近的几种典型数据形态，检验您对常用限制器函数特性的掌握程度。",
            "id": "2394421",
            "problem": "考虑常正波速 $a0$ 的一维线性平流方程，该方程在均匀网格上离散，网格上的单元平均值为 $\\{u_i\\}$。高分辨率的总变差减小 (TVD) 方法使用一个通量限制器函数 $\\phi(r)$，该函数依赖于连续梯度的比率\n$$\nr \\equiv \\frac{u_i - u_{i-1}}{u_{i+1} - u_i},\n$$\n该比率在单元 $i$ 和 $i+1$ 之间的界面上计算。当 $r$ 的分母为零且分子为正时，取 $r=+\\infty$。当分子和分母都为零时，$r$ 未定义。\n\n定义了四个经典的限制器函数（对所有实数 $r$）：\n- Minmod: $\\displaystyle \\phi_{\\mathrm{MM}}(r) = \\max\\!\\big(0,\\;\\min(1,\\,r)\\big)$.\n- Superbee: $\\displaystyle \\phi_{\\mathrm{SB}}(r) = \\max\\!\\big(0,\\;\\min(2r,\\,1),\\;\\min(r,\\,2)\\big)$.\n- Van Leer: $\\displaystyle \\phi_{\\mathrm{VL}}(r) = \\frac{r + |r|}{1 + |r|}$.\n- Van Albada: $\\displaystyle \\phi_{\\mathrm{VA}}(r) = \\max\\!\\Big(0,\\;\\frac{r^2 + r}{1 + r^2}\\Big)$.\n\n对于 $a0$，分析固定索引 $i$ 周围的以下三种局部数据配置：\n\n- 配置 I: $(u_{i-1},u_i,u_{i+1})=(0,\\,1,\\,1)$。\n\n- 配置 II: $(u_{i-1},u_i,u_{i+1})=(0,\\,0,\\,1)$。\n\n- 配置 III: $(u_{i-1},u_i,u_{i+1})=(c,\\,c,\\,c)$ 对于任意常数 $c\\in\\mathbb{R}$。\n\n假设通量计算按给定方式使用上述 $\\phi(r)$，并且在任何实现中，$r=+\\infty$ 都被解释为 $\\phi(r)$ 在 $r\\to+\\infty$ 时的极限。\n\n下列哪个陈述是正确的？\n\nA. 在配置 I 中，有 $r=+\\infty$，Superbee 和 Van Leer 限制器都给出 $\\phi=2$，而 Minmod 和 Van Albada 限制器都给出 $\\phi=1$。\n\nB. 在配置 II 中，有 $r=0$，所有四个限制器都给出 $\\phi=0$。\n\nC. 在配置 III 中，$r$ 未定义 ($0/0$)。一个稳健的实现应该检测到这种情况并设置 $\\phi=0$，以保持常数解并避免除以零。\n\nD. 在配置 I 中，Van Albada 限制器得出 $\\phi=2$，因为 $\\lim_{r\\to+\\infty}\\phi_{\\mathrm{VA}}(r)=2$。\n\nE. 在配置 II 中，Minmod 限制器得出 $\\phi=1$，因为在 $r=0$ 时 $\\min(1,r)=1$。",
            "solution": "对问题陈述进行验证。\n\n### 步骤 1：提取已知条件\n- **方程**：一维线性平流方程，$u_t + a u_x = 0$，具有恒定波速 $a0$。\n- **离散化**：均匀网格上的单元平均值 $\\{u_i\\}$。\n- **方法**：使用通量限制器函数 $\\phi(r)$ 的高分辨率总变差减小 (TVD) 格式。\n- **梯度比**：比率 $r$ 在单元 $i$ 和 $i+1$ 之间的界面上定义为 $r \\equiv \\frac{u_i - u_{i-1}}{u_{i+1} - u_i}$。\n- **r 的特殊情况**：\n    - 如果 $u_{i+1} - u_i = 0$ 且 $u_i - u_{i-1}  0$，则 $r=+\\infty$。\n    - 如果 $u_{i+1} - u_i = 0$ 且 $u_i - u_{i-1} = 0$，则 $r$ 未定义。\n- **限制器函数**：\n    - Minmod: $\\phi_{\\mathrm{MM}}(r) = \\max\\!\\big(0,\\;\\min(1,\\,r)\\big)$\n    - Superbee: $\\phi_{\\mathrm{SB}}(r) = \\max\\!\\big(0,\\;\\min(2r,\\,1),\\;\\min(r,\\,2)\\big)$\n    - Van Leer: $\\phi_{\\mathrm{VL}}(r) = \\frac{r + |r|}{1 + |r|}$\n    - Van Albada: $\\phi_{\\mathrm{VA}}(r) = \\max\\!\\Big(0,\\;\\frac{r^2 + r}{1 + r^2}\\Big)$\n- **数据配置**：\n    - 配置 I: $(u_{i-1},u_i,u_{i+1})=(0,\\,1,\\,1)$\n    - 配置 II: $(u_{i-1},u_i,u_{i+1})=(0,\\,0,\\,1)$\n    - 配置 III: $(u_{i-1},u_i,u_{i+1})=(c,\\,c,\\,c)$ 对于任意 $c\\in\\mathbb{R}$\n- **实现假设**：$r=+\\infty$ 的情况通过取 $\\phi(r)$ 在 $r\\to+\\infty$ 时的极限来处理。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据，是适定的、客观的。它涉及计算工程和偏微分方程数值解领域的标准、成熟的概念和技术。通量限制器的定义是标准的。局部数据配置是简单、有效的测试用例。提供了所有必要的信息，并且没有矛盾之处。该问题要求直接应用和评估明确定义的数学函数和原理。\n\n### 步骤 3：结论和行动\n问题陈述有效。将推导完整解答。\n\n### 配置分析\n\n首先，我们分析每个数据配置，以确定梯度比 $r$ 的值以及限制器函数的相应值。\n\n**配置 I: $(u_{i-1},u_i,u_{i+1})=(0,\\,1,\\,1)$**\n差值为 $u_i - u_{i-1} = 1 - 0 = 1$ 和 $u_{i+1} - u_i = 1 - 1 = 0$。\n分子为正 ($1$)，分母为零。根据问题陈述，这对应于 $r = +\\infty$。我们必须计算每个限制器函数在 $r \\to +\\infty$ 时的极限。\n\n- **Minmod**: $\\lim_{r\\to+\\infty} \\phi_{\\mathrm{MM}}(r) = \\lim_{r\\to+\\infty} \\max(0, \\min(1, r))$。当 $r \\to +\\infty$ 时，$\\min(1,r) \\to 1$。因此，极限为 $\\max(0,1) = 1$。\n- **Superbee**: $\\lim_{r\\to+\\infty} \\phi_{\\mathrm{SB}}(r) = \\lim_{r\\to+\\infty} \\max(0, \\min(2r, 1), \\min(r, 2))$。当 $r \\to \\infty$ 时，$\\min(2r, 1) \\to 1$ 且 $\\min(r, 2) \\to 2$。极限为 $\\max(0, 1, 2) = 2$。\n- **Van Leer**: $\\lim_{r\\to+\\infty} \\phi_{\\mathrm{VL}}(r) = \\lim_{r\\to+\\infty} \\frac{r + |r|}{1 + |r|}$。对于大的正数 $r$，有 $|r|=r$，所以 $\\phi_{\\mathrm{VL}}(r) = \\frac{r+r}{1+r} = \\frac{2r}{1+r}$。极限为 $\\lim_{r\\to+\\infty} \\frac{2r}{1+r} = \\lim_{r\\to+\\infty} \\frac{2}{1/r+1} = 2$。\n- **Van Albada**: $\\lim_{r\\to+\\infty} \\phi_{\\mathrm{VA}}(r) = \\lim_{r\\to+\\infty} \\max\\Big(0, \\frac{r^2 + r}{1 + r^2}\\Big)$。有理函数的极限由首项系数的比值决定：$\\lim_{r\\to+\\infty} \\frac{r^2+r}{1+r^2} = 1$。因此，极限为 $\\max(0,1) = 1$。\n\n配置 I 总结：$\\phi_{\\mathrm{MM}} = 1$, $\\phi_{\\mathrm{SB}} = 2$, $\\phi_{\\mathrm{VL}} = 2$, $\\phi_{\\mathrm{VA}} = 1$。\n\n**配置 II: $(u_{i-1},u_i,u_{i+1})=(0,\\,0,\\,1)$**\n差值为 $u_i - u_{i-1} = 0 - 0 = 0$ 和 $u_{i+1} - u_i = 1 - 0 = 1$。\n梯度比为 $r = \\frac{0}{1} = 0$。我们在 $r=0$ 处计算每个限制器的值。\n\n- **Minmod**: $\\phi_{\\mathrm{MM}}(0) = \\max(0, \\min(1, 0)) = \\max(0, 0) = 0$。\n- **Superbee**: $\\phi_{\\mathrm{SB}}(0) = \\max(0, \\min(2 \\cdot 0, 1), \\min(0, 2)) = \\max(0, \\min(0,1), \\min(0,2)) = \\max(0, 0, 0) = 0$。\n- **Van Leer**: $\\phi_{\\mathrm{VL}}(0) = \\frac{0 + |0|}{1 + |0|} = \\frac{0}{1} = 0$。\n- **Van Albada**: $\\phi_{\\mathrm{VA}}(0) = \\max\\Big(0, \\frac{0^2 + 0}{1 + 0^2}\\Big) = \\max(0, 0) = 0$。\n\n配置 II 总结：所有四个限制器都得出 $\\phi=0$。\n\n**配置 III: $(u_{i-1},u_i,u_{i+1})=(c,\\,c,\\,c)$**\n差值为 $u_i - u_{i-1} = c - c = 0$ 和 $u_{i+1} - u_i = c - c = 0$。\n梯度比为 $r = \\frac{0}{0}$，如问题所述，这是未定义的。在任何数值实现中，都必须显式处理此情况以避免浮点异常（除以零）。\n对于任何合理的守恒律数值格式，一个基本的一致性条件是它必须精确地保持常数状态（这有时被称为零阶精度）。对于有限体积格式 $u_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}(F_{i+1/2} - F_{i-1/2})$，当解为常数时，这要求数值通量差为零，即 $F_{i+1/2} = F_{i-1/2}$。高分辨率通量的形式为 $F_{i+1/2} = F_{i+1/2}^{\\text{low}} + \\psi_{i+1/2}$，其中修正项 $\\psi_{i+1/2}$ 与 $u_{i+1}-u_i$ 成正比。例如，一种常见的形式是 $\\psi = \\phi(r) \\cdot (\\text{某项}) \\cdot (u_{i+1}-u_i)$。在常数状态下，$u_{i+1}-u_i=0$，因此只要 $\\phi(r)$ 是有限的，修正项就为零，*与 $\\phi(r)$ 的值无关*。\n选项 C 中的陈述提出，稳健的实现应该检测 $0/0$ 的情况并设置 $\\phi=0$。这是一个合理的工程实践。主要原因是为了防止除法操作产生致命的运行时错误。对于保持常数状态而言，赋给 $\\phi$ 的值的选择是次要的，但将 $\\phi$ 设置为 0 是一个简单而有效的选择。这对应于局部地退化为一阶格式，而一阶格式对于常数状态是精确的。另一种常见的做法是设置 $r=1$（因为常数状态是可能的最平滑状态），这将得到 $\\phi=1$。两种选择都是有效的，并且都能得到一个稳健的、保持常数解的格式。关于稳健的数值编码，声称实现*应该*检测到这种情况并且可以设置 $\\phi=0$ 是一个完全有效的陈述。\n\n### 选项评估\n\n**A. 在配置 I 中，有 $r=+\\infty$，Superbee 和 Van Leer 限制器都给出 $\\phi=2$，而 Minmod 和 Van Albada 限制器都给出 $\\phi=1$。**\n根据我们对配置 I 的分析，$r=+\\infty$。极限值确实是 $\\phi_{\\mathrm{SB}}=2$, $\\phi_{\\mathrm{VL}}=2$, $\\phi_{\\mathrm{MM}}=1$ 和 $\\phi_{\\mathrm{VA}}=1$。这个陈述是我们研究结果的精确总结。\n**结论：正确。**\n\n**B. 在配置 II 中，有 $r=0$，所有四个限制器都给出 $\\phi=0$。**\n根据我们对配置 II 的分析，$r=0$。在 $r=0$ 时，所有四个限制器的值确实是 $\\phi=0$。这个陈述也是我们研究结果的精确总结。\n**结论：正确。**\n\n**C. 在配置 III 中，$r$ 未定义 ($0/0$)。一个稳健的实现应该检测到这种情况并设置 $\\phi=0$，以保持常数解并避免除以零。**\n我们对配置 III 的分析证实了 $r$ 是未定义的 ($0/0$)。对于一个稳健的计算机程序来说，检测和处理这种情况以防止除以零是绝对必要的。虽然设置 $\\phi=0$ 不是唯一的选择（例如，设置 $\\phi=1$ 也可以），但它是一种常见、有效且安全的选择。所述的理由——保持常数解和避免除以零——是正确的。常数状态的保持得到了保证，因为与 $\\phi$ 相乘的项为零，而避免除以零是处理此情况的主要驱动因素。该陈述准确地描述了稳健数值实现的一个关键方面。\n**结论：正确。**\n\n**D. 在配置 I 中，Van Albada 限制器得出 $\\phi=2$，因为 $\\lim_{r\\to+\\infty}\\phi_{\\mathrm{VA}}(r)=2$。**\n我们对配置 I 的分析表明，对于 Van Albada 限制器，$\\lim_{r\\to+\\infty}\\phi_{\\mathrm{VA}}(r)=1$。该陈述声称极限为 $2$，因此 $\\phi=2$。其理由和结论都是错误的。\n**结论：不正确。**\n\n**E. 在配置 II 中，Minmod 限制器得出 $\\phi=1$，因为在 $r=0$ 时 $\\min(1,r)=1$。**\n我们对配置 II 的分析表明，$r=0$ 且 $\\phi_{\\mathrm{MM}}(0)=0$。该陈述声称 $\\phi=1$。这是错误的。其提供的理由是“在 $r=0$ 时 $\\min(1,r)=1$”。这也是错误的，因为 $\\min(1,0)=0$。该陈述在所有方面都是不正确的。\n**结论：不正确。**\n\n最终正确的陈述是 A、B 和 C。",
            "answer": "$$\\boxed{ABC}$$"
        },
        {
            "introduction": "掌握了限制器函数在特定点的理论行为后，下一步是将其付诸实践，观察它们在完整模拟中的宏观效果。本练习要求您编写代码，模拟一个带有尖锐间断的方波的平流过程，这是一个检验数值方法性能的经典算例。通过亲手实现并对比 Minmod、Superbee 和 Van Leer 等不同限制器的效果，您将直观地看到它们在抑制数值振荡和控制数值耗散方面的差异，从而深化对 TVD 格式实际性能的理解。",
            "id": "2448960",
            "problem": "考虑一维线性平流方程\n$$\n\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0\n$$\n在周期性空间域 $[0,1)$ 上，具有恒定的正速度 $a0$。所有量均为无量纲。初始条件是一个单位幅度的方波\n$$\nu(x,0) = \\begin{cases}\n1,  x \\in [0.25,\\,0.5),\\\\\n0,  \\text{otherwise,}\n\\end{cases}\n$$\n具有周期性边界条件。\n\n使用包含 $N$ 个控制体积的均匀网格，网格宽度为 $\\Delta x = 1/N$，并用 $u_i^n$ 表示在时间层 $t^n$ 时单元 $i \\in \\{0,1,\\dots,N-1\\}$ 内的单元平均值。令无量纲的 Courant 数为\n$$\n\\lambda \\equiv \\frac{a\\,\\Delta t}{\\Delta x}.\n$$\n使用守恒的显式更新来演化单元平均值\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+\\frac{1}{2}}^n - F_{i-\\frac{1}{2}}^n\\right),\n$$\n其中，对于 $a0$，界面 $x_{i+\\frac{1}{2}}$ 处的数值通量由通量限制的高分辨率迎风格式定义\n$$\nF_{i+\\frac{1}{2}}^n = a\\,u_i^n + \\frac{a}{2}\\left(1-\\lambda\\right)\\,\\phi(r_i^n)\\,\\left(u_{i+1}^n - u_i^n\\right),\n$$\n采用模 $N$ 的周期性索引。光滑度指示器 $r_i^n$ 由下式给出\n$$\nr_i^n = \\frac{u_i^n - u_{i-1}^n}{u_{i+1}^n - u_i^n + \\varepsilon},\n$$\n其中 $\\varepsilon$ 是一个小的正数，以避免除以零，而 $\\phi(\\cdot)$ 是从以下集合中选择的通量限制器：\n- Minmod 限制器：\n$$\n\\phi_{\\text{minmod}}(r) = \\max\\left(0, \\min(1, r)\\right).\n$$\n- Superbee 限制器：\n$$\n\\phi_{\\text{superbee}}(r) = \\max\\left(0, \\min(2r,1), \\min(r,2)\\right).\n$$\n- Van Leer 限制器：\n$$\n\\phi_{\\text{van\\,Leer}}(r) = \\frac{r + |r|}{1 + |r|}.\n$$\n\n将 $u_i^0$ 初始化为方波在每个控制体积上的精确单元平均值。将解演化到最终时间 $T=1$（对于 $a=1$ 在 $[0,1)$ 上是一个完整的平流周期），使用的时间步长 $\\Delta t$ 满足 $\\lambda \\le \\text{CFL}$，其中时间步数被选择以恰好达到 $T$。\n\n对于每次模拟，计算在 $t=T$ 时的以下三个定量诊断指标：\n- 相对于精确解 $u(x,T) = u(x,0)$ 的离散 $L^1$ 误差：\n$$\nE_1 = \\sum_{i=0}^{N-1} \\left|u_i^N - u_i^0\\right|\\,\\Delta x.\n$$\n- 超过名义最大值 $1$ 的最大过冲：\n$$\nO = \\max\\left(0, \\max_{i} u_i^N - 1\\right).\n$$\n- 低于名义最小值 $0$ 的最小下冲：\n$$\nU = \\min\\left(0, \\min_{i} u_i^N\\right).\n$$\n\n所有测试采用以下固定参数：$a=1$，$T=1$，以及 $\\varepsilon = 10^{-12}$。所有量均为无量纲。对所有索引操作使用周期性边界条件。\n\n测试套件：\n为以下每一组参数 $(N,\\ \\text{CFL},\\ \\text{limiter})$ 计算 $(E_1, O, U)$：\n1. $(200,\\ 0.5,\\ \\text{minmod})$\n2. $(200,\\ 0.5,\\ \\text{superbee})$\n3. $(200,\\ 0.5,\\ \\text{van\\,Leer})$\n4. $(200,\\ 0.95,\\ \\text{superbee})$\n5. $(40,\\ 0.5,\\ \\text{van\\,Leer})$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的浮点数列表。将这些值按照测试套件的精确顺序，逐个将三元组展开进行聚合，即：\n$$\n[E_1^{(1)},\\,O^{(1)},\\,U^{(1)},\\,E_1^{(2)},\\,O^{(2)},\\,U^{(2)},\\,E_1^{(3)},\\,O^{(3)},\\,U^{(3)},\\,E_1^{(4)},\\,O^{(4)},\\,U^{(4)},\\,E_1^{(5)},\\,O^{(5)},\\,U^{(5)}].\n$$\n输出时，每个浮点数必须精确到 $6$ 位小数。不应打印任何额外的文本。",
            "solution": "该问题陈述已经过严格验证，被认为是科学上合理、完整且适定的。它构成了双曲守恒律计算方法领域的一个标准基准问题。我们将着手构建解决方案。\n\n该问题要求数值求解一维线性平流方程，\n$$\n\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0,\n$$\n针对在周期域 $x \\in [0,1)$ 上具有恒定正平流速度 $a  0$ 的标量 $u(x,t)$。该方程是典型的双曲守恒律。其精确解是初始剖面的简单平移，$u(x,t) = u_0(x-at)$。对于给定的参数 $a=1$ 和最终时间 $T=1$，在周期域 $[0,1)$ 上的精确解与初始条件相同，$u(x,T) = u(x-1,0) = u(x,0)$。\n\n数值解将使用有限体积法获得。该域被离散为 $N$ 个均匀的控制体积（或单元），每个控制体积的宽度为 $\\Delta x = 1/N$。第 $i$ 个单元（$i \\in \\{0, 1, \\dots, N-1\\}$）占据空间区间 $[x_{i-1/2}, x_{i+1/2}]$，其中 $x_{i-1/2} = i\\Delta x$。数值解由单元平均值表示，\n$$\nu_i^n \\approx \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x, t^n) \\, dx.\n$$\n初始条件 $u_i^0$ 是通过对给定的方波剖面 $u(x,0)$ 精确计算此积分得到的。对于单元 $i$，初始平均值是波占据该单元体积的比例，由下式给出\n$$\nu_i^0 = \\frac{1}{\\Delta x} \\int_{i\\Delta x}^{(i+1)\\Delta x} u(x,0) \\, dx = \\frac{\\text{length}([i\\Delta x, (i+1)\\Delta x] \\cap [0.25, 0.5))}{\\Delta x}.\n$$\n这计算为 $u_i^0 = \\max(0, \\min((i+1)\\Delta x, 0.5) - \\max(i\\Delta x, 0.25)) / \\Delta x$。这种初始化确保了离散总质量 $\\sum_i u_i^0 \\Delta x$ 与连续初始条件一致。\n\n时间演化由显式守恒公式控制：\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{i+\\frac{1}{2}}^n - F_{i-\\frac{1}{2}}^n \\right).\n$$\n这种形式保证了单元 $i$ 中平均值的变化完全是由于通过其边界 $x_{i-1/2}$ 和 $x_{i+1/2}$ 的净通量，从而确保了离散守恒性。时间步长 $\\Delta t$ 的确定方式是使得最终时间 $T$ 在整数个步数 $N_t$ 内达到。给定一个 Courant-Friedrichs-Lewy (CFL) 数，最大允许时间步长为 $\\Delta t_{\\max} = \\text{CFL} \\cdot \\Delta x / a$。我们选择时间步数为 $N_t = \\lceil T/\\Delta t_{\\max} \\rceil$，则实际时间步长为 $\\Delta t = T/N_t$。由此产生的 Courant 数 $\\lambda = a \\Delta t / \\Delta x$ 保证小于或等于指定的 $\\text{CFL}$ 值，这是显式格式稳定性的一个必要条件。\n\n该方法的核心在于数值通量 $F_{i+1/2}^n$ 的定义。指定的通量是一种高分辨率的通量限制格式。对于 $a0$，单元 $i$ 和 $i+1$ 之间的界面 $x_{i+1/2}$ 处的通量由下式给出\n$$\nF_{i+\\frac{1}{2}}^n = a\\,u_i^n + \\frac{a}{2}\\left(1-\\lambda\\right)\\,\\phi(r_i^n)\\,\\left(u_{i+1}^n - u_i^n\\right).\n$$\n第一项 $a\\,u_i^n$ 是一阶迎风通量。仅此通量会产生一个稳定但耗散性很强的格式，会抹平尖锐特征。第二项是有限制的反扩散修正项。它的构建是为了抵消一阶格式的过度数值扩散，同时防止在间断点附近引入伪振荡，这是高阶线性格式（例如 Lax-Wendroff）的常见问题。\n\n修正项由一个通量限制器函数 $\\phi(r)$ 调制，该函数依赖于光滑度指示器，\n$$\nr_i^n = \\frac{u_i^n - u_{i-1}^n}{u_{i+1}^n - u_i^n + \\varepsilon}.\n$$\n比率 $r_i^n$ 比较了迎风单元的梯度 $(u_i^n - u_{i-1}^n)$ 和顺风单元的梯度 $(u_{i+1}^n - u_i^n)$。在解的光滑区域，$r \\approx 1$，限制器 $\\phi(r)$ 的选择应使格式趋向于更高阶的精度。在间断点或极值点附近，$r$ 会显著变化，此时限制器必须减小修正项的幅度，即 $\\phi \\to 0$，迫使格式回到稳健的一阶迎风方法。这种自适应行为是实现高分辨率而无振荡的关键，这一性质被称为总变差减小（TVD）。参数 $\\varepsilon=10^{-12}$ 是一个小数，用于在梯度 $u_{i+1}^n - u_i^n$ 为零时防止除零错误。\n\n该问题指定了三种不同的通量限制器：\n1.  **Minmod**：$\\phi_{\\text{minmod}}(r) = \\max(0, \\min(1, r))$。这是 TVD 限制器中耗散性最强的一种，它能强力保证单调性（不产生新的极值），但代价是比其他限制器更容易抹平剖面。\n2.  **Superbee**：$\\phi_{\\text{superbee}}(r) = \\max(0, \\min(2r,1), \\min(r,2))$。这是一种压缩性更强的限制器，旨在保持接触间断的尖锐分辨率。它的耗散性低于 Minmod，但可能会使光滑剖面变得稍微陡峭。\n3.  **Van Leer**：$\\phi_{\\text{van\\,Leer}}(r) = \\frac{r + |r|}{1 + |r|}$。这种限制器在控制振荡和保持精度之间提供了良好的平衡，并且是可微的，这在某些情况下可能是有利的。\n\n模拟通过迭代应用更新公式 $N_t$ 步进行。通过对所有空间索引使用模运算来强制执行周期性边界条件，例如，$u_{N} \\equiv u_0$ 和 $u_{-1} \\equiv u_{N-1}$。达到最终时间 $T$ 后，将数值解 $u_i^{N_t}$ 与初始（也是精确的最终）解 $u_i^0$ 进行比较，以计算 $L^1$ 误差 $E_1$、最大过冲 $O$ 和最小下冲 $U$。这些诊断指标量化了每组参数下该格式的精度和单调性保持特性。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D linear advection equation using a high-resolution flux-limited scheme\n    for a set of test cases and prints the diagnostic results.\n    \"\"\"\n\n    # --- Flux Limiter Functions ---\n    def limiter_minmod(r):\n        return np.maximum(0, np.minimum(1, r))\n\n    def limiter_superbee(r):\n        term1 = np.minimum(2 * r, 1)\n        term2 = np.minimum(r, 2)\n        # In NumPy, np.maximum(array1, array2) is element-wise.\n        # To get max of three things, we chain it.\n        return np.maximum(0, np.maximum(term1, term2))\n\n    def limiter_vanleer(r):\n        # Note: abs(r) is used, equivalent to |r|\n        # Add a small epsilon to the denominator to prevent division by zero if r = -1\n        return (r + np.abs(r)) / (1 + np.abs(r) + 1e-15)\n\n    limiter_map = {\n        'minmod': limiter_minmod,\n        'superbee': limiter_superbee,\n        'van_Leer': limiter_vanleer\n    }\n\n    # --- Problem Parameters ---\n    a = 1.0\n    T = 1.0\n    epsilon = 1e-12\n\n    test_cases = [\n        (200, 0.5, 'minmod'),\n        (200, 0.5, 'superbee'),\n        (200, 0.5, 'van_Leer'),\n        (200, 0.95, 'superbee'),\n        (40, 0.5, 'van_Leer'),\n    ]\n\n    all_results = []\n\n    for N, CFL, limiter_name in test_cases:\n        # --- Discretization ---\n        dx = 1.0 / N\n        x_faces = np.linspace(0.0, 1.0, N + 1)\n        \n        # --- Initial Condition (Cell Averages) ---\n        # u(x,0) is 1 on [0.25, 0.5), 0 otherwise\n        overlap = np.maximum(0, np.minimum(x_faces[1:], 0.5) - np.maximum(x_faces[:-1], 0.25))\n        u0 = overlap / dx\n        \n        # --- Time Stepping ---\n        dt_max = CFL * dx / a\n        num_steps = int(np.ceil(T / dt_max))\n        dt = T / num_steps\n        lambda_val = a * dt / dx\n\n        # --- Select Limiter ---\n        selected_limiter = limiter_map[limiter_name]\n        \n        # --- Time Evolution Loop ---\n        u_current = u0.copy()\n        \n        for _ in range(num_steps):\n            # Enforce periodic boundary conditions using np.roll\n            u_im1 = np.roll(u_current, 1)  # u_{i-1}\n            u_ip1 = np.roll(u_current, -1) # u_{i+1}\n            \n            # Gradients\n            du_forward = u_ip1 - u_current  # u_{i+1} - u_i\n            du_backward = u_current - u_im1 # u_i - u_{i-1}\n            \n            # Smoothness indicator r\n            # Suppress division by zero warnings, handled by epsilon\n            with np.errstate(divide='ignore', invalid='ignore'):\n                r = du_backward / (du_forward + epsilon)\n                r[np.isnan(r)] = 0  # Handle potential 0/0 -> NaN cases\n\n            # Limiter values\n            phi = selected_limiter(r)\n            \n            # Numerical flux F_{i+1/2}\n            # F[i] corresponds to F_{i+1/2}\n            flux = a * u_current + (a / 2.0) * (1.0 - lambda_val) * phi * du_forward\n            \n            # Flux difference across cell i: F_{i+1/2} - F_{i-1/2}\n            flux_diff = flux - np.roll(flux, 1)\n            \n            # Update solution\n            u_current -= (dt / dx) * flux_diff\n\n        u_final = u_current\n\n        # --- Diagnostics ---\n        # L1 error\n        e1 = np.sum(np.abs(u_final - u0)) * dx\n        \n        # Overshoot\n        overshoot = np.maximum(0, np.max(u_final) - 1.0)\n        \n        # Undershoot\n        # np.min(u_final) could be positive, so we need min(0, ...)\n        undershoot = np.minimum(0, np.min(u_final))\n        \n        # Append results for this case\n        all_results.extend([e1, overshoot, undershoot])\n\n    # --- Final Output Formatting ---\n    formatted_results = [f\"{val:.6f}\" for val in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在许多真实的工程应用中，为了高效地解析复杂的几何或流动特征，我们通常采用非均匀网格。这就要求我们将之前在均匀网格上学到的理论进行推广。本练习将引导您推导在非均匀网格下，光滑度指标 $r$ 的正确表达式。这个推导过程将帮助您理解 $r$ 的物理本质——即相邻区域的“梯度”之比，而不仅仅是“差分”之比，这是将 TVD 方案应用于更高级计算模拟的关键一步。",
            "id": "2394403",
            "problem": "考虑一维域上的标量线性平流方程 $u_{t} + a\\,u_{x} = 0$，其中速度 $a  0$ 为常数。在一个严格递增的非均匀网格上使用有限体积法进行离散化，网格单元中心位于 $\\{x_{j}\\}_{j\\in\\mathbb{Z}}$，其中 $h_{j+1/2} \\equiv x_{j+1} - x_{j}$ 且 $h_{j-1/2} \\equiv x_{j} - x_{j-1}$。令 $u_{j}$ 表示单元 $j$ 内的单元平均解。在全变差递减 (TVD) 格式中，通量限制器函数在界面 $x_{j+1/2}$ 处使用无量纲比率 $r_{j+1/2}$ 来比较 $a0$ 时的上游和下游梯度。\n\n假设在每个单元中进行分段线性重构，并将 $r_{j+1/2}$ 定义为在界面 $x_{j+1/2}$ 处空间梯度的左偏线性估计与右偏线性估计之比，每个估计都是根据非均匀网格上最近邻的单元平均值构建的。推导 $r_{j+1/2}$ 关于 $u_{j-1}$、$u_{j}$、$u_{j+1}$ 以及网格间距 $h_{j-1/2}$ 和 $h_{j+1/2}$ 的封闭形式解析表达式。以单个简化表达式的形式提供最终结果。无需进行数值计算或四舍五入。",
            "solution": "对问题陈述进行验证。\n\n**步骤1：提取已知条件**\n-   控制方程：标量线性平流方程 $u_{t} + a\\,u_{x} = 0$，速度 $a  0$ 为常数。\n-   离散化：在一维严格递增的非均匀网格上的有限体积格式。\n-   网格几何：单元中心位于 $\\{x_{j}\\}_{j\\in\\mathbb{Z}}$。\n-   网格间距定义：$h_{j+1/2} \\equiv x_{j+1} - x_{j}$ 且 $h_{j-1/2} \\equiv x_{j} - x_{j-1}$。\n-   解变量：$u_{j}$ 表示单元 $j$ 内的单元平均解。\n-   格式背景：该格式为全变差递减 (TVD)。\n-   核心量：在界面 $x_{j+1/2}$ 处使用无量纲比率 $r_{j+1/2}$。\n-   重构：假设在每个单元中进行分段线性重构。\n-   $r_{j+1/2}$ 的定义：在界面 $x_{j+1/2}$ 处空间梯度的左偏线性估计与右偏线性估计之比，由最近邻的单元平均值构建。\n-   目标：推导 $r_{j+1/2}$ 关于 $u_{j-1}$、$u_{j}$、$u_{j+1}$、$h_{j-1/2}$ 和 $h_{j+1/2}$ 的封闭形式解析表达式。\n\n**步骤2：使用提取的已知条件进行验证**\n-   **科学依据**：该问题在双曲守恒律数值方法的既定理论中基础扎实，特别是关于高分辨率有限体积格式和通量限制器的概念。所有概念在计算工程和应用数学中都是标准的。\n-   **适定性**：该问题是适定的。它为待推导的量 $r_{j+1/2}$ 提供了明确的定义，并列出了所有必要的输入变量。目标是进行一次数学推导，其结果是唯一的。\n-   **客观性**：问题以精确、客观、技术性的语言陈述，没有歧义或主观看法。\n\n**步骤3：结论与行动**\n该问题在科学上是合理的、自洽的且适定的。因此，判定其为 **有效**。将进行严谨的推导。\n\n目标是推导在界面 $x_{j+1/2}$ 处的比率 $r_{j+1/2}$ 的表达式。问题将此比率定义为：\n$$\nr_{j+1/2} = \\frac{\\text{左偏梯度估计}}{\\text{右偏梯度估计}}\n$$\n这些估计是针对空间梯度 $\\frac{\\partial u}{\\partial x}$ 的，并且是根据非均匀网格上最近邻的单元平均值构建的。界面 $x_{j+1/2}$ 位于单元中心 $x_j$ 和 $x_{j+1}$ 之间。\n\n首先，我们必须将梯度的“左偏线性估计”形式化。该估计是使用相对于目标区域“左侧”的单元平均值构建的。对于界面 $x_{j+1/2}$，其左侧最直接的数据点是位于单元中心 $x_j$ 和 $x_{j-1}$ 的单元平均值 $u_j$ 和 $u_{j-1}$。由这两点得到的梯度线性估计由以下有限差分给出：\n$$\n(\\nabla u)_{\\text{左}} = \\frac{u_{j} - u_{j-1}}{x_{j} - x_{j-1}}\n$$\n使用提供的网格间距定义 $h_{j-1/2} \\equiv x_{j} - x_{j-1}$，上式变为：\n$$\n(\\nabla u)_{\\text{左}} = \\frac{u_{j} - u_{j-1}}{h_{j-1/2}}\n$$\n这表示在区间 $[x_{j-1}, x_j]$ 上的平均梯度。\n\n接下来，我们将梯度的“右偏线性估计”形式化。按照同样的逻辑，该估计是使用定义了“右侧”斜率的单元平均值构建的。相关的数据点是位于单元中心 $x_{j+1}$ 和 $x_j$ 的单元平均值 $u_{j+1}$ 和 $u_j$。相应的梯度线性估计为：\n$$\n(\\nabla u)_{\\text{右}} = \\frac{u_{j+1} - u_{j}}{x_{j+1} - x_{j}}\n$$\n使用提供的网格间距定义 $h_{j+1/2} \\equiv x_{j+1} - x_j$，上式变为：\n$$\n(\\nabla u)_{\\text{右}} = \\frac{u_{j+1} - u_{j}}{h_{j+1/2}}\n$$\n这表示在区间 $[x_j, x_{j+1}]$ 上的平均梯度。\n\n问题明确指出 $r_{j+1/2}$ 是左偏估计与右偏估计之比。因此，我们使用上面推导出的表达式来构造这个比率：\n$$\nr_{j+1/2} = \\frac{(\\nabla u)_{\\text{左}}}{(\\nabla u)_{\\text{右}}} = \\frac{\\frac{u_{j} - u_{j-1}}{h_{j-1/2}}}{\\frac{u_{j+1} - u_{j}}{h_{j+1/2}}}\n$$\n这个表达式是一个复合分数。为了得到最终的简化形式，我们重新排列各项：\n$$\nr_{j+1/2} = \\left( \\frac{u_{j} - u_{j-1}}{u_{j+1} - u_{j}} \\right) \\left( \\frac{h_{j+1/2}}{h_{j-1/2}} \\right)\n$$\n这个表达式是 $r_{j+1/2}$ 关于指定量的封闭形式结果。它表示连续梯度近似值的比率，并针对非均匀网格间距进行了正确缩放。",
            "answer": "$$\\boxed{\\frac{(u_{j} - u_{j-1}) h_{j+1/2}}{(u_{j+1} - u_{j}) h_{j-1/2}}}$$"
        }
    ]
}