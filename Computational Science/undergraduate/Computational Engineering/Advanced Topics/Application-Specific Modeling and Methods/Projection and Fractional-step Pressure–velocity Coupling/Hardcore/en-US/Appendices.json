{
    "hands_on_practices": [
        {
            "introduction": "The pressure Poisson equation (PPE) is the mathematical core of the projection method, responsible for enforcing incompressibility. Before implementing a solver, it's crucial to understand the conditions under which this equation has a valid, unique solution. This practice problem  challenges you to analyze the well-posedness of the PPE in a periodic channel flow, a canonical case in computational fluid dynamics, touching upon solvability conditions and the nature of pressure itself in a closed system.",
            "id": "2428874",
            "problem": "Consider incompressible, isothermal flow of a Newtonian fluid with density $\\rho$ and kinematic viscosity $\\nu$ in a two-dimensional channel domain $\\Omega = [0,L]\\times[0,H]$. The flow is periodic in the streamwise ($x$) direction with period $L$ and bounded by stationary no-slip walls at $y=0$ and $y=H$. The governing equations are the incompressible Navier–Stokes equations,\n$$\n\\frac{\\partial \\boldsymbol{u}}{\\partial t} + (\\boldsymbol{u}\\cdot\\nabla)\\boldsymbol{u} = -\\frac{1}{\\rho}\\nabla p + \\nu \\nabla^2 \\boldsymbol{u} + \\boldsymbol{f},\\qquad \\nabla\\cdot \\boldsymbol{u} = 0,\n$$\nwhere $\\boldsymbol{u}(x,y,t)$ is the velocity, $p(x,y,t)$ is the pressure, and $\\boldsymbol{f}(x,y,t)$ is a body force. A fractional-step (projection) time-integration is used from time $t^n$ to $t^{n+1}=t^n+\\Delta t$:\n- A provisional velocity $\\boldsymbol{u}^\\ast$ is computed without the pressure gradient term.\n- The velocity is corrected by a pressure at the new time level according to\n$$\n\\boldsymbol{u}^{n+1} = \\boldsymbol{u}^\\ast - \\frac{\\Delta t}{\\rho}\\,\\nabla p^{n+1},\n$$\nand enforced to satisfy the divergence-free constraint $\\nabla\\cdot \\boldsymbol{u}^{n+1}=0$.\nOn the solid walls, no-slip and no-penetration are prescribed for the physical velocity $\\boldsymbol{u}$, and periodic boundary conditions are applied in the $x$-direction to all fields consistent with the method.\n\nWhich of the following statements about the well-posedness, boundary conditions, and uniqueness of the pressure problem in this setting are correct? Select all that apply.\n\nA. With periodicity in $x$ and enforcing no-penetration on $y=0$ and $y=H$, the pressure Poisson problem that arises in the projection step always has a solution and yields a unique pressure without any additional constraint, because the divergence-free condition alone determines the pressure level.\n\nB. In the stated periodic channel, the pressure from the projection step is determined only up to an arbitrary additive constant; a common and sufficient way to ensure uniqueness is to impose a zero-mean condition on $p^{n+1}$ at each time step.\n\nC. If the flow is driven by a constant mean streamwise pressure gradient, then a strictly periodic pressure field in $x$ cannot represent that mean gradient; a standard remedy is to add an equivalent constant body force $\\boldsymbol{f}$ in the momentum equation and solve only for a periodic pressure fluctuation with zero spatial mean.\n\nD. To fix the pressure level in the Poisson problem, one may impose a Dirichlet condition $p^{n+1}=0$ at a single point on a wall; this approach is incompatible with the projection method because it violates global mass conservation.\n\nE. Under the stated periodic and no-slip boundary conditions, the solvability (compatibility) condition for the pressure Poisson equation reduces to requiring zero normal pressure gradient at the walls, independently of the provisional velocity $\\boldsymbol{u}^\\ast$.",
            "solution": "From the incompressibility condition $\\nabla\\cdot \\boldsymbol{u}^{n+1}=0$ and the correction step\n$$\n\\boldsymbol{u}^{n+1} = \\boldsymbol{u}^\\ast - \\frac{\\Delta t}{\\rho}\\,\\nabla p^{n+1},\n$$\nwe obtain, by taking the divergence,\n$$\n0 = \\nabla\\cdot \\boldsymbol{u}^{n+1} = \\nabla\\cdot \\boldsymbol{u}^\\ast - \\frac{\\Delta t}{\\rho}\\,\\nabla\\cdot\\nabla p^{n+1}\n= \\nabla\\cdot \\boldsymbol{u}^\\ast - \\frac{\\Delta t}{\\rho}\\,\\nabla^2 p^{n+1}.\n$$\nTherefore, the pressure $p^{n+1}$ satisfies the Poisson equation\n$$\n\\nabla^2 p^{n+1} = \\frac{\\rho}{\\Delta t}\\,\\nabla\\cdot \\boldsymbol{u}^\\ast \\quad \\text{in } \\Omega.\n$$\nTo determine boundary conditions for $p^{n+1}$, require that the corrected velocity satisfies the normal velocity condition at the solid walls. For a stationary wall at $y=0$ and $y=H$, the no-penetration condition is $ \\boldsymbol{n}\\cdot \\boldsymbol{u}^{n+1} = 0$, where $\\boldsymbol{n}$ is the outward unit normal. Using the correction formula,\n$$\n\\boldsymbol{n}\\cdot \\boldsymbol{u}^{n+1} = \\boldsymbol{n}\\cdot \\boldsymbol{u}^\\ast - \\frac{\\Delta t}{\\rho}\\,\\boldsymbol{n}\\cdot \\nabla p^{n+1} = 0\n\\;\\;\\Rightarrow\\;\\;\n\\frac{\\partial p^{n+1}}{\\partial n} = \\frac{\\rho}{\\Delta t}\\,\\boldsymbol{n}\\cdot \\boldsymbol{u}^\\ast \\quad \\text{on } y=0,H.\n$$\nIf the provisional velocity is constructed to satisfy $\\boldsymbol{n}\\cdot \\boldsymbol{u}^\\ast=0$ at the walls (a standard consistent choice), then the boundary condition simplifies to homogeneous Neumann,\n$$\n\\frac{\\partial p^{n+1}}{\\partial n} = 0 \\quad \\text{on } y=0,H.\n$$\nIn the streamwise direction $x$, the fields are periodic with period $L$, so $p^{n+1}$ and its derivatives are periodic in $x$.\n\nWe now analyze solvability and uniqueness. Integrate the Poisson equation over $\\Omega$ and apply the divergence theorem:\n$$\n\\int_{\\Omega} \\nabla^2 p^{n+1}\\, \\mathrm{d}\\Omega = \\int_{\\partial \\Omega} \\frac{\\partial p^{n+1}}{\\partial n}\\, \\mathrm{d}S\n= \\frac{\\rho}{\\Delta t} \\int_{\\Omega} \\nabla\\cdot \\boldsymbol{u}^\\ast \\, \\mathrm{d}\\Omega.\n$$\nFor a rectangular domain with periodic boundaries at $x=0$ and $x=L$, the contributions from the two periodic boundaries cancel exactly because the pressure and its normal derivative are periodic. At the solid walls $y=0$ and $y=H$, if $\\boldsymbol{n}\\cdot \\boldsymbol{u}^\\ast=0$ then $\\partial p^{n+1}/\\partial n = 0$, so the boundary integral vanishes. Thus, the compatibility (solvability) condition becomes\n$$\n\\int_{\\Omega} \\nabla^2 p^{n+1}\\, \\mathrm{d}\\Omega = 0\n\\quad \\Leftrightarrow \\quad\n\\frac{\\rho}{\\Delta t} \\int_{\\Omega} \\nabla\\cdot \\boldsymbol{u}^\\ast \\, \\mathrm{d}\\Omega = 0.\n$$\nThis condition is satisfied if the provisional velocity has zero net divergence in an integral sense, which holds for consistent discretizations that respect the discrete divergence theorem and wall-normal conditions. However, even when solvability holds, with periodic and Neumann boundary conditions the Laplacian operator has a nontrivial nullspace consisting of constants, so $p^{n+1}$ is determined only up to an arbitrary additive constant. To obtain a unique solution, one must fix the pressure level, for example by prescribing the spatial mean of $p^{n+1}$ to be zero or by anchoring $p^{n+1}$ at a single point.\n\nNow consider a flow driven by a constant mean streamwise pressure gradient. In a periodic domain, a pressure field that is strictly periodic in $x$ cannot have a nonzero mean gradient in $x$. A standard practice is to decompose the pressure into a mean linear component and a periodic fluctuation, or equivalently to move the mean gradient into the body force $\\boldsymbol{f}$ in the momentum equation and solve the Poisson problem only for the periodic fluctuation with zero mean. This maintains periodicity of the solved pressure field while representing the physical driving.\n\nEvaluate each statement:\n\nA. The first part, that the pressure Poisson problem has a solution, is contingent on the compatibility condition $\\int_{\\Omega} (\\rho/\\Delta t)\\,\\nabla\\cdot \\boldsymbol{u}^\\ast\\,\\mathrm{d}\\Omega=0$, which is satisfied under consistent construction of $\\boldsymbol{u}^\\ast$ and the stated boundary conditions. However, the claim that the pressure is unique without any additional constraint is false. With periodic and homogeneous Neumann boundary conditions, the solution is determined only up to an additive constant. Verdict: Incorrect.\n\nB. This states that the pressure is determined up to an additive constant and that imposing a zero-mean condition suffices for uniqueness. This is precisely the standard resolution of the constant nullspace of the Laplacian with periodic/Neumann boundary conditions. Verdict: Correct.\n\nC. This asserts that a constant mean streamwise pressure gradient cannot be represented by a strictly periodic pressure field and that one can instead include a constant body force and solve for a periodic, zero-mean pressure fluctuation. This is the standard approach in periodic channel simulations and is consistent with the decomposition of pressure into mean and fluctuating parts. Verdict: Correct.\n\nD. Fixing the pressure level by imposing $p^{n+1}=0$ at a single point is a common technique to eliminate the constant nullspace; it does not, by itself, violate mass conservation provided the Poisson right-hand side satisfies the compatibility condition. It is compatible with the projection method. The claim that it is incompatible and violates global mass conservation is false. Verdict: Incorrect.\n\nE. The solvability condition is an integral condition tying the domain integral of the right-hand side to the boundary fluxes of $\\partial p^{n+1}/\\partial n$. It does not reduce to “requiring zero normal pressure gradient at the walls” independently of $\\boldsymbol{u}^\\ast$; rather, homogeneous Neumann at the walls arises from enforcing no-penetration via the correction, and solvability requires the volume integral of $\\nabla\\cdot \\boldsymbol{u}^\\ast$ to vanish (with periodic side cancellations). The statement confuses a boundary condition with the compatibility condition. Verdict: Incorrect.",
            "answer": "$$\\boxed{BC}$$"
        },
        {
            "introduction": "While the theory of the projection method assumes an exact solution to the pressure Poisson equation, practical simulations almost always use iterative solvers that only approximate the true pressure field. This hands-on coding exercise  allows you to directly quantify the consequences of this approximation. By implementing a basic iterative solver, you will investigate how the degree of solver convergence impacts the enforcement of the divergence-free condition, providing a tangible link between computational effort and physical fidelity.",
            "id": "2428935",
            "problem": "Consider the two-dimensional incompressible flow projection in a periodic square domain. Let the domain be $\\Omega = [0,1] \\times [0,1]$ with periodic boundary conditions in both directions. Let $\\rho > 0$ denote the constant density and $\\nu \\ge 0$ the kinematic viscosity. Let $N \\in \\mathbb{N}$ be the number of uniformly spaced grid points per direction, with grid spacing $h = 1/N$. Use a collocated, cell-centered discretization with the following discrete operators built from second-order central differences with periodic wrapping:\n\n- The discrete gradient $\\nabla_h$ and divergence $\\nabla_h \\cdot$ act componentwise using central differences with stride $h$.\n- The discrete Laplacian $\\Delta_h$ is the standard five-point stencil\n$$\n(\\Delta_h \\phi)_{i,j} = \\frac{\\phi_{i+1,j} + \\phi_{i-1,j} + \\phi_{i,j+1} + \\phi_{i,j-1} - 4 \\phi_{i,j}}{h^2},\n$$\nwith periodic indexing for $(i \\pm 1)$ and $(j \\pm 1)$.\n\nDefine an initial discrete velocity field $u^0 = (u^0_x, u^0_y)$ from a discrete streamfunction $\\psi$ sampled at cell centers $x_j = (j + \\tfrac{1}{2}) h$, $y_i = (i + \\tfrac{1}{2}) h$ by\n$$\nu^0_x = \\frac{\\partial \\psi}{\\partial y}\\Big|_h, \\quad u^0_y = -\\frac{\\partial \\psi}{\\partial x}\\Big|_h,\n$$\nwhere $\\psi(x,y) = \\sin(2\\pi x)\\sin(2\\pi y)$ and $\\tfrac{\\partial}{\\partial x}\\big|_h$, $\\tfrac{\\partial}{\\partial y}\\big|_h$ are the central-difference operators. This construction yields a discrete field with $\\nabla_h \\cdot u^0 = 0$.\n\nLet $\\phi(x,y) = \\sin(2\\pi x)\\sin(2\\pi y)$ be a discrete scalar potential sampled at the same grid points, and define a discrete forcing $f = (f_x,f_y)$ as the discrete gradient $f = \\alpha \\nabla_h \\phi$ with some scalar amplitude $\\alpha \\in \\mathbb{R}$. Consider a single explicit fractional step with time step $\\Delta t > 0$:\n- Tentative velocity\n$$\nu^\\star = u^0 + \\Delta t\\left(\\nu\\, \\Delta_h u^0 + f\\right).\n$$\n- Pressure update by the discrete Poisson equation\n$$\n\\Delta_h p^{1} = \\frac{\\rho}{\\Delta t}\\, \\nabla_h \\cdot u^\\star,\n$$\nwith periodic boundary conditions and the additional constraint that the discrete mean of $p^{1}$ over the grid is zero.\n- Velocity correction\n$$\nu^{1} = u^\\star - \\frac{\\Delta t}{\\rho}\\, \\nabla_h p^{1}.\n$$\n\nThe quality of mass conservation after the projection is quantified by the discrete $L^2$ norm of the divergence of the corrected velocity,\n$$\nE = \\left( h^2 \\sum_{i=0}^{N-1}\\sum_{j=0}^{N-1} \\left[\\left(\\nabla_h \\cdot u^{1}\\right)_{i,j}\\right]^2 \\right)^{1/2}.\n$$\n\nIn practice, $p^{1}$ is computed by an iterative solver applied to the linear system $\\Delta_h p^{1} = \\tfrac{\\rho}{\\Delta t}\\, \\nabla_h \\cdot u^\\star$. In this task, $p^{1}$ must be approximated by applying exactly $k \\in \\mathbb{N}$ sweeps of either:\n- the pointwise Jacobi iteration,\n- or the pointwise Gauss–Seidel iteration,\nfor the five-point Laplacian with periodic neighbors, starting from the zero initial guess and enforcing zero mean for $p^{1}$ after each sweep.\n\nYour program must:\n- Implement the operators $\\nabla_h$, $\\nabla_h \\cdot$, and $\\Delta_h$ as defined above with periodic boundary conditions.\n- Build $u^0$ from $\\psi$ as above, and $f$ from $\\phi$ as above.\n- Form $u^\\star$, assemble the right-hand side $\\tfrac{\\rho}{\\Delta t}\\, \\nabla_h \\cdot u^\\star$, and compute $p^1$ using exactly $k$ iterations of the specified iterative method with mean-zero enforcement after each sweep.\n- Compute $u^{1}$ and the mass conservation error $E$.\n\nUse the following test suite, where each case is specified as a tuple $(N, \\Delta t, \\nu, \\rho, \\alpha, k, \\text{solver})$:\n- Case $1$: $(N, \\Delta t, \\nu, \\rho, \\alpha, k, \\text{solver}) = (32, 0.01, 0.01, 1.0, 1.0, 1, \\text{\"jacobi\"})$.\n- Case $2$: $(32, 0.01, 0.01, 1.0, 1.0, 20, \\text{\"jacobi\"})$.\n- Case $3$: $(32, 0.01, 0.01, 1.0, 1.0, 2000, \\text{\"jacobi\"})$.\n- Case $4$: $(32, 0.01, 0.01, 1.0, 1.0, 20, \\text{\"gauss-seidel\"})$.\n- Case $5$: $(8, 0.01, 0.01, 1.0, 1.0, 100, \\text{\"jacobi\"})$.\n\nAll physical and numerical quantities are nondimensional. The final output of your program must be a single line containing a Python-style list with the $5$ floating-point results $E$ corresponding to the cases above, in the same order, each formatted in scientific notation with exactly six significant digits. For example, the required format is $[a,b,c,d,e]$ where each of $a,b,c,d,e$ is printed as in $\\texttt{1.234567e-03}$.\n\nYour program must produce exactly one line of output in this format and must not read any input.",
            "solution": "The problem statement is assessed to be valid. It describes a well-defined numerical experiment in computational fluid dynamics, based on established principles of the fractional-step method for incompressible flows. All parameters, operators, and procedures are specified without ambiguity or contradiction, making it scientifically grounded, well-posed, and objective. The task is to implement this numerical scheme and calculate a specific error metric for a given set of test cases.\n\nThe solution is implemented following these structured steps:\n\n1.  **Discretization and Discrete Operators**\n    The continuous domain $\\Omega = [0,1] \\times [0,1]$ is discretized into a uniform grid of $N \\times N$ cells. The grid spacing is $h = 1/N$. All scalar and vector fields are defined at the cell centers, located at coordinates $(x_j, y_i) = ((j + 0.5)h, (i + 0.5)h)$ for $i,j \\in \\{0, \\dots, N-1\\}$.\n\n    The discrete differential operators with periodic boundary conditions are implemented as follows:\n    -   **Gradient ($\\nabla_h$)**: For a scalar field $\\phi$, the gradient $(\\nabla_h \\phi)_{i,j} = ((\\partial_x \\phi)_h, (\\partial_y \\phi)_h)_{i,j}$ is computed using second-order central differences:\n        $$(\\partial_x \\phi)_h = \\frac{\\phi_{i,j+1} - \\phi_{i,j-1}}{2h}, \\quad (\\partial_y \\phi)_h = \\frac{\\phi_{i+1,j} - \\phi_{i-1,j}}{2h}$$\n    -   **Divergence ($\\nabla_h \\cdot$)**: For a vector field $u = (u_x, u_y)$, the divergence $(\\nabla_h \\cdot u)_{i,j}$ is:\n        $$(\\nabla_h \\cdot u)_{i,j} = \\frac{(u_x)_{i,j+1} - (u_x)_{i,j-1}}{2h} + \\frac{(u_y)_{i+1,j} - (u_y)_{i-1,j}}{2h}$$\n    -   **Laplacian ($\\Delta_h$)**: For a scalar field $\\phi$, the Laplacian is given by the standard five-point stencil:\n        $$(\\Delta_h \\phi)_{i,j} = \\frac{\\phi_{i+1,j} + \\phi_{i-1,j} + \\phi_{i,j+1} + \\phi_{i,j-1} - 4\\phi_{i,j}}{h^2}$$\n    Periodic indexing (e.g., $\\phi_{N,j} = \\phi_{0,j}$, $\\phi_{i,-1} = \\phi_{i,N-1}$) is used for all operators.\n\n2.  **State Initialization**\n    -   An initial velocity field $u^0$ is constructed from a discrete streamfunction $\\psi = \\sin(2\\pi x)\\sin(2\\pi y)$ to ensure it is discretely divergence-free ($\\nabla_h \\cdot u^0 = 0$). The components are defined as:\n        $$u^0_x = \\frac{\\partial \\psi}{\\partial y}\\Big|_h, \\quad u^0_y = -\\frac{\\partial \\psi}{\\partial x}\\Big|_h$$\n    -   A forcing term $f$ is defined as the gradient of a scalar potential $\\phi = \\sin(2\\pi x)\\sin(2\\pi y)$ with amplitude $\\alpha$:\n        $$f = \\alpha \\nabla_h \\phi$$\n\n3.  **The Fractional-Step Algorithm**\n    A single time step of the projection method consists of three main parts:\n    -   **Prediction Step**: A tentative velocity field $u^\\star$ is computed by advancing the momentum equation forward in time with an explicit Euler step. This step incorporates the viscous and forcing terms but omits the unknown pressure gradient term.\n        $$u^\\star = u^0 + \\Delta t\\left(\\nu\\, \\Delta_h u^0 + f\\right)$$\n        The resulting field $u^\\star$ is not, in general, divergence-free.\n\n    -   **Projection Step**: This step enforces the incompressibility constraint by projecting $u^\\star$ onto the space of divergence-free fields. This is accomplished by finding a pressure-like field $p^1$ that corrects the velocity. The field $p^1$ is the solution to the discrete Poisson equation:\n        $$\\Delta_h p^{1} = \\frac{\\rho}{\\Delta t}\\, \\nabla_h \\cdot u^\\star$$\n        This equation is derived by enforcing the condition $\\nabla_h \\cdot u^1 = 0$ on the corrected velocity $u^1 = u^\\star - \\frac{\\Delta t}{\\rho} \\nabla_h p^1$. On a periodic domain, the operator $\\Delta_h$ is singular. A unique solution for $p^1$ is obtained by imposing the constraint that its discrete spatial mean is zero, i.e., $\\sum_{i,j} p^1_{i,j} = 0$.\n\n        The linear system for $p^1$ is solved approximately using exactly $k$ iterations of one of the following methods, starting from an initial guess of $p^1=0$:\n        -   **Pointwise Jacobi Iteration**: An explicit update rule where the value at each grid point for the next iteration, $p^{n+1}$, depends only on the values from the current iteration, $p^n$. The update for grid point $(i,j)$ is:\n            $$p_{i,j}^{n+1} = \\frac{1}{4}\\left( p_{i+1,j}^n + p_{i-1,j}^n + p_{i,j+1}^n + p_{i,j-1}^n - h^2 (\\tfrac{\\rho}{\\Delta t} \\nabla_h \\cdot u^\\star)_{i,j} \\right)$$\n        -   **Pointwise Gauss-Seidel Iteration**: An implicit update rule where the calculation at each grid point immediately uses the newest available values from the current iteration. For a raster-scan order, the update is:\n            $$p_{i,j}^{n+1} = \\frac{1}{4}\\left( p_{i-1,j}^{n+1} + p_{i,j-1}^{n+1} + p_{i+1,j}^n + p_{i,j+1}^n - h^2 (\\tfrac{\\rho}{\\Delta t} \\nabla_h \\cdot u^\\star)_{i,j} \\right)$$\n        After each iteration (sweep), the zero-mean constraint is enforced by subtracting the mean value from the pressure field.\n\n    -   **Correction Step**: The final velocity field $u^1$ for the time step is obtained by correcting the tentative velocity $u^\\star$ using the gradient of the computed pressure $p^1$:\n        $$u^{1} = u^\\star - \\frac{\\Delta t}{\\rho}\\, \\nabla_h p^{1}$$\n        By construction, this field $u^1$ better approximates the divergence-free condition.\n\n4.  **Error Quantification**\n    The quality of mass conservation is measured by the discrete $L^2$-norm of the divergence of the final velocity field $u^1$. The error $E$ is calculated as:\n    $$E = \\left( h^2 \\sum_{i=0}^{N-1}\\sum_{j=0}^{N-1} \\left[\\left(\\nabla_h \\cdot u^{1}\\right)_{i,j}\\right]^2 \\right)^{1/2}$$\n    A smaller value of $E$ indicates a more accurate enforcement of the incompressibility constraint. The provided program implements this complete algorithm to compute $E$ for each test case.",
            "answer": "```python\nimport numpy as np\n\ndef grad(phi, h):\n    \"\"\"Computes the 2D gradient of a scalar field using central differences.\"\"\"\n    dphi_dx = (np.roll(phi, -1, axis=1) - np.roll(phi, 1, axis=1)) / (2 * h)\n    dphi_dy = (np.roll(phi, -1, axis=0) - np.roll(phi, 1, axis=0)) / (2 * h)\n    return dphi_dx, dphi_dy\n\ndef div(u, h):\n    \"\"\"Computes the 2D divergence of a vector field using central differences.\"\"\"\n    ux, uy = u\n    dux_dx = (np.roll(ux, -1, axis=1) - np.roll(ux, 1, axis=1)) / (2 * h)\n    duy_dy = (np.roll(uy, -1, axis=0) - np.roll(uy, 1, axis=0)) / (2 * h)\n    return dux_dx + duy_dy\n\ndef laplace(phi, h):\n    \"\"\"Computes the 2D Laplacian of a scalar field using a five-point stencil.\"\"\"\n    return (np.roll(phi, 1, axis=0) + np.roll(phi, -1, axis=0) +\n            np.roll(phi, 1, axis=1) + np.roll(phi, -1, axis=1) - 4 * phi) / h**2\n\ndef jacobi_sweep(p, b, h):\n    \"\"\"Performs one sweep of the Jacobi iteration for the Poisson equation.\"\"\"\n    p_new = 0.25 * (np.roll(p, 1, axis=0) + np.roll(p, -1, axis=0) +\n                    np.roll(p, 1, axis=1) + np.roll(p, -1, axis=1) - h**2 * b)\n    return p_new\n\ndef gauss_seidel_sweep(p, b, h):\n    \"\"\"Performs one sweep of the Gauss-Seidel iteration using raster scan.\"\"\"\n    N = p.shape[0]\n    # This function modifies p in place\n    for i in range(N):\n        for j in range(N):\n            # Neighbors are accessed from the single array 'p'. For a raster scan,\n            # (i-1) and (j-1) elements have already been updated in this sweep.\n            neighbors = (p[(i - 1) % N, j] + p[(i + 1) % N, j] +\n                         p[i, (j - 1) % N] + p[i, (j + 1) % N])\n            p[i, j] = 0.25 * (neighbors - h**2 * b[i, j])\n    return p\n\ndef run_simulation(N, dt, nu, rho, alpha, k, solver_type):\n    \"\"\"\n    Executes one full fractional-step simulation and returns the divergence error E.\n    \"\"\"\n    # 1. Grid setup\n    h = 1.0 / N\n    x = (np.arange(N) + 0.5) * h\n    y = (np.arange(N) + 0.5) * h\n    # Use 'xy' indexing for standard matrix layout: array[i, j] -> (y_i, x_j)\n    xx, yy = np.meshgrid(x, y, indexing='xy')\n\n    # 2. Initial and Forcing Fields\n    psi = np.sin(2 * np.pi * xx) * np.sin(2 * np.pi * yy)\n    grad_psi_x, grad_psi_y = grad(psi, h)\n    u0x = grad_psi_y\n    u0y = -grad_psi_x\n    u0 = (u0x, u0y)\n\n    phi = np.sin(2 * np.pi * xx) * np.sin(2 * np.pi * yy)\n    grad_phi_x, grad_phi_y = grad(phi, h)\n    fx = alpha * grad_phi_x\n    fy = alpha * grad_phi_y\n    f = (fx, fy)\n\n    # 3. Tentative Velocity (Prediction Step)\n    lap_u0x = laplace(u0x, h)\n    lap_u0y = laplace(u0y, h)\n    u_star_x = u0x + dt * (nu * lap_u0x + fx)\n    u_star_y = u0y + dt * (nu * lap_u0y + fy)\n    u_star = (u_star_x, u_star_y)\n\n    # 4. Pressure Poisson (Projection Step)\n    div_u_star = div(u_star, h)\n    poisson_rhs = (rho / dt) * div_u_star\n    \n    p1 = np.zeros((N, N))\n    if solver_type == \"jacobi\":\n        for _ in range(k):\n            p1 = jacobi_sweep(p1, poisson_rhs, h)\n            p1 -= np.mean(p1)  # Enforce zero mean\n    elif solver_type == \"gauss-seidel\":\n        for _ in range(k):\n            p1 = gauss_seidel_sweep(p1, poisson_rhs, h)\n            p1 -= np.mean(p1)  # Enforce zero mean\n            \n    # 5. Velocity Correction\n    grad_p1_x, grad_p1_y = grad(p1, h)\n    u1_x = u_star_x - (dt / rho) * grad_p1_x\n    u1_y = u_star_y - (dt / rho) * grad_p1_y\n    u1 = (u1_x, u1_y)\n\n    # 6. Error Calculation\n    div_u1 = div(u1, h)\n    error_E = np.sqrt(h**2 * np.sum(np.square(div_u1)))\n    \n    return error_E\n\ndef solve():\n    test_cases = [\n        # (N, Δt, ν, ρ, α, k, solver)\n        (32, 0.01, 0.01, 1.0, 1.0, 1, \"jacobi\"),\n        (32, 0.01, 0.01, 1.0, 1.0, 20, \"jacobi\"),\n        (32, 0.01, 0.01, 1.0, 1.0, 2000, \"jacobi\"),\n        (32, 0.01, 0.01, 1.0, 1.0, 20, \"gauss-seidel\"),\n        (8, 0.01, 0.01, 1.0, 1.0, 100, \"jacobi\"),\n    ]\n\n    results = []\n    for case in test_cases:\n        E = run_simulation(*case)\n        results.append(E)\n\n    formatted_results = [f\"{res:.5e}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A stable numerical scheme is a prerequisite for any meaningful simulation. While the projection step itself is inherently stable, the overall stability of an explicit fractional-step method is governed by the predictor step. This exercise  guides you through the process of determining the maximum stable time step, $\\Delta t_{\\max}$, by combining the constraints from both the explicit advection (the CFL condition) and diffusion terms. Mastering this analysis is essential for configuring and running robust explicit solvers.",
            "id": "2428893",
            "problem": "Consider a $2$-dimensional, incompressible, Newtonian fluid with kinematic viscosity $\\nu$ on a uniform rectangular grid with spacings $\\Delta x$ and $\\Delta y$ and periodic boundary conditions in both directions. Let the pressure–velocity coupling be performed by a projection (fractional-step) approach: an explicit velocity predictor step advances the momentum equation with both convection and diffusion treated explicitly, followed by a pressure projection that enforces the discrete divergence-free constraint. Assume the velocity field has been linearized about constant bounds on its components, with maximum magnitudes $|u| \\le U_{\\max}$ and $|v| \\le V_{\\max}$, where $U_{\\max}$ and $V_{\\max}$ are given constants. The explicit predictor advances the velocity by a single forward-Euler step using first-order upwind differences for the convective derivatives and the standard $5$-point Laplacian for the diffusive term. The projection step is an $\\ell^2$-orthogonal projection onto the discrete divergence-free subspace.\n\nDefine numerical stability as follows: for periodic boundary conditions, the one-step update must not increase the $\\ell^2$ norm of any discrete Fourier mode of the predictor; in addition, the subsequent pressure projection must not increase the $\\ell^2$ norm.\n\nFor each parameter set in the test suite below, determine the maximum stable time step $\\Delta t_{\\max}$ (in seconds), i.e., the largest $\\Delta t$ for which the above stability requirement holds for all grid-admissible wavenumbers. Express each answer in $\\mathrm{s}$ as a floating-point number.\n\nUse the following test suite, where each case is a tuple $(\\Delta x,\\Delta y,U_{\\max},V_{\\max},\\nu)$ with $\\Delta x$ and $\\Delta y$ in $\\mathrm{m}$, $U_{\\max}$ and $V_{\\max}$ in $\\mathrm{m/s}$, and $\\nu$ in $\\mathrm{m^2/s}$:\n\n- Case $1$: $(0.01, 0.02, 1.0, 0.5, 10^{-3})$\n- Case $2$: $(0.005, 0.005, 0.0, 0.0, 10^{-4})$\n- Case $3$: $(0.1, 0.05, 2.0, 1.0, 0.0)$\n- Case $4$: $(0.01, 0.01, 0.3, 0.1, 10^{-3})$\n- Case $5$: $(0.005, 0.005, 0.1, 0.1, 10^{-2})$\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $[x_1,x_2,x_3,x_4,x_5]$), where $x_i$ is the computed $\\Delta t_{\\max}$ for Case $i$, in $\\mathrm{s}$.",
            "solution": "The problem as presented is scientifically grounded, well-posed, and objective. It presents a standard problem in the numerical analysis of partial differential equations relevant to computational engineering. Therefore, a rigorous solution is pursued.\n\nThe problem requires finding the maximum stable time step, $\\Delta t_{\\max}$, for a numerical scheme solving the $2$-dimensional incompressible Navier-Stokes equations on a periodic domain. The governing equations are:\n$$\n\\frac{\\partial \\mathbf{u}}{\\partial t} + (\\mathbf{u} \\cdot \\nabla) \\mathbf{u} = -\\nabla p + \\nu \\nabla^2 \\mathbf{u}\n$$\n$$\n\\nabla \\cdot \\mathbf{u} = 0\n$$\nHere, $\\mathbf{u}=(u,v)$ is the velocity vector, $p$ is the kinematic pressure (pressure divided by constant density $\\rho$), and $\\nu$ is the kinematic viscosity.\n\nThe solution employs a fractional-step (or projection) method. This method decouples the velocity and pressure updates.\n$1$. Predictor Step: An intermediate velocity field $\\mathbf{u}^*$ is calculated by advancing the momentum equation explicitly, omitting the pressure gradient.\n$$\n\\frac{\\mathbf{u}^* - \\mathbf{u}^n}{\\Delta t} = -(\\mathbf{u}^n \\cdot \\nabla) \\mathbf{u}^n + \\nu \\nabla^2 \\mathbf{u}^n\n$$\n$2$. Projection Step: The intermediate velocity $\\mathbf{u}^*$ is projected onto the space of discretely divergence-free vector fields to obtain the velocity at the new time step, $\\mathbf{u}^{n+1}$. This step enforces the incompressibility constraint.\n\nThe problem defines stability based on the $\\ell^2$ norm of discrete Fourier modes. The projection step is an $\\ell^2$-orthogonal projection, which is a non-expansive operator; its operator norm is at most $1$. Consequently, the projection step cannot amplify any Fourier mode and does not introduce instability. The overall stability of the scheme is therefore dictated entirely by the stability of the explicit predictor step.\n\nThe stability of the predictor step is assessed using von Neumann stability analysis. The analysis is performed on the linearized version of the predictor equation, where the nonlinear convective term $(\\mathbf{u} \\cdot \\nabla)\\mathbf{u}$ is replaced by $(\\mathbf{U} \\cdot \\nabla)\\mathbf{u}$, with $\\mathbf{U}=(U,V)$ being a constant velocity. To ensure stability for any flow condition within the given bounds, we must consider the worst-case scenario where $|U| = U_{\\max}$ and $|V| = V_{\\max}$.\n\nThe predictor step for a scalar component of velocity (denoted by $\\phi$) is discretized using forward Euler for time, first-order upwind for convection, and the standard $5$-point stencil for diffusion. The fully discretized equation at grid point $(j,l)$ is:\n$$\n\\frac{\\phi_{j,l}^{n+1} - \\phi_{j,l}^{n}}{\\Delta t} = - \\left( U\\frac{\\phi_{j,l}^n - \\phi_{j-\\sigma_x,l}^n}{\\sigma_x\\Delta x} + V\\frac{\\phi_{j,l}^n - \\phi_{j,l-\\sigma_y}^n}{\\sigma_y\\Delta y} \\right) + \\nu \\left( \\frac{\\phi_{j+1,l}^n - 2\\phi_{j,l}^n + \\phi_{j-1,l}^n}{\\Delta x^2} + \\frac{\\phi_{j,l+1}^n - 2\\phi_{j,l}^n + \\phi_{j,l-1}^n}{\\Delta y^2} \\right)\n$$\nwhere $\\sigma_x = \\text{sgn}(U)$ and $\\sigma_y = \\text{sgn}(V)$. For the stability analysis, we use the magnitudes $|U|$ and $|V|$. The equation can be written as:\n$$\n\\phi_{j,l}^{n+1} = \\phi_{j,l}^{n} - \\Delta t \\left( \\frac{|U|}{\\Delta x}(\\phi_{j,l}^n - \\phi_{j-\\sigma_x,l}^n) + \\frac{|V|}{\\Delta y}(\\phi_{j,l}^n - \\phi_{j,l-\\sigma_y}^n) \\right) + \\Delta t \\nu [\\nabla_h^2 \\phi^n]_{j,l}\n$$\nWe substitute a single Fourier mode $\\phi_{j,l}^n = \\hat{\\phi}^n(\\theta_x, \\theta_y) e^{i(j\\theta_x + l\\theta_y)}$, where $\\theta_x = k_x\\Delta x$ and $\\theta_y = k_y\\Delta y$ are the dimensionless wavenumbers. The amplification factor $G = \\hat{\\phi}^{n+1}/\\hat{\\phi}^n$ is found to be:\n$$\nG(\\theta_x, \\theta_y) = 1 - \\frac{|U|\\Delta t}{\\Delta x}(1-e^{-i\\sigma_x\\theta_x}) - \\frac{|V|\\Delta t}{\\Delta y}(1-e^{-i\\sigma_y\\theta_y}) + \\frac{\\nu\\Delta t}{\\Delta x^2}(2\\cos\\theta_x-2) + \\frac{\\nu\\Delta t}{\\Delta y^2}(2\\cos\\theta_y-2)\n$$\nLet $C_x = \\frac{|U|\\Delta t}{\\Delta x}$, $C_y = \\frac{|V|\\Delta t}{\\Delta y}$ be the Courant numbers, and $D_x = \\frac{\\nu\\Delta t}{\\Delta x^2}$, $D_y = \\frac{\\nu\\Delta t}{\\Delta y^2}$ be the diffusion numbers.\n$$\nG = 1 - C_x(1-\\cos\\theta_x) - C_y(1-\\cos\\theta_y) - 2D_x(1-\\cos\\theta_x) - 2D_y(1-\\cos\\theta_y) - i(C_x \\sigma_x \\sin\\theta_x + C_y \\sigma_y \\sin\\theta_y)\n$$\nStability requires $|G| \\le 1$ for all $\\theta_x, \\theta_y \\in [-\\pi, \\pi]$. The most restrictive condition is typically found for the highest frequency modes, where $\\theta_x \\to \\pm\\pi$ and $\\theta_y \\to \\pm\\pi$. Let us examine the case $\\theta_x=\\pi, \\theta_y=\\pi$. Here, $\\sin\\theta_x = \\sin\\theta_y = 0$ and $1-\\cos\\theta_x = 1-\\cos\\theta_y = 2$.\nThe amplification factor becomes purely real:\n$$\nG(\\pi,\\pi) = 1 - 2C_x - 2C_y - 4D_x - 4D_y = 1 - 2(C_x+C_y+2D_x+2D_y)\n$$\nThe stability condition $|G| \\le 1$ becomes $-1 \\le G \\le 1$.\n$G \\le 1$ is always satisfied since all terms $C_x, C_y, D_x, D_y$ are non-negative.\nThe condition $G \\ge -1$ requires:\n$$\n1 - 2(C_x+C_y+2D_x+2D_y) \\ge -1\n$$\n$$\n2 \\ge 2(C_x+C_y+2D_x+2D_y)\n$$\n$$\n1 \\ge C_x+C_y+2D_x+2D_y\n$$\nSubstituting the definitions of $C_x, C_y, D_x, D_y$ and using the maximum velocity magnitudes $U_{\\max}$ and $V_{\\max}$:\n$$\n1 \\ge \\frac{U_{\\max}\\Delta t}{\\Delta x} + \\frac{V_{\\max}\\Delta t}{\\Delta y} + \\frac{2\\nu\\Delta t}{\\Delta x^2} + \\frac{2\\nu\\Delta t}{\\Delta y^2}\n$$\nFactoring out $\\Delta t$, we obtain the stability constraint:\n$$\n\\Delta t \\left( \\frac{U_{\\max}}{\\Delta x} + \\frac{V_{\\max}}{\\Delta y} + 2\\nu \\left(\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2}\\right) \\right) \\le 1\n$$\nThis condition, derived from the most unstable mode, can be shown to be necessary and sufficient for the $L_2$-stability of the scheme for all wavenumbers.\nThe maximum stable time step $\\Delta t_{\\max}$ is obtained when the equality holds:\n$$\n\\Delta t_{\\max} = \\frac{1}{\\frac{U_{\\max}}{\\Delta x} + \\frac{V_{\\max}}{\\Delta y} + 2\\nu \\left(\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2}\\right)}\n$$\nThis formula is used to compute the result for each test case. Should the denominator be zero (i.e., $U_{\\max}=V_{\\max}=\\nu=0$), $\\Delta t_{\\max}$ is infinite, as the trivial system $\\partial \\mathbf{u} / \\partial t = 0$ is unconditionally stable. For all given test cases, the denominator is positive.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the maximum stable time step for a 2D incompressible\n    Navier-Stokes solver using an explicit fractional-step method.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (delta_x, delta_y, U_max, V_max, nu)\n    test_cases = [\n        (0.01, 0.02, 1.0, 0.5, 1e-3),\n        (0.005, 0.005, 0.0, 0.0, 1e-4),\n        (0.1, 0.05, 2.0, 1.0, 0.0),\n        (0.01, 0.01, 0.3, 0.1, 1e-3),\n        (0.005, 0.005, 0.1, 0.1, 1e-2)\n    ]\n\n    results = []\n    for case in test_cases:\n        dx, dy, u_max, v_max, nu = case\n\n        # Numerator of the stability condition is 1. We compute the denominator.\n        \n        # Convective constraint term\n        # This corresponds to the CFL condition part.\n        conv_term = u_max / dx + v_max / dy\n\n        # Diffusive constraint term\n        # This corresponds to the explicit diffusion stability part.\n        diff_term = 0.0\n        if nu > 0:\n            diff_term = 2.0 * nu * (1.0 / dx**2 + 1.0 / dy**2)\n\n        # The overall stability constraint is the sum of the inverses of the\n        # time steps from each physical process.\n        denominator = conv_term + diff_term\n\n        # The maximum stable time step is the reciprocal of this sum.\n        if denominator == 0:\n            # This case occurs if U_max, V_max, and nu are all zero.\n            # The scheme is unconditionally stable, so dt_max is infinite.\n            dt_max = float('inf')\n        else:\n            dt_max = 1.0 / denominator\n        \n        results.append(dt_max)\n\n    # Final print statement in the exact required format.\n    # A comma-separated list of floating-point numbers in square brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}