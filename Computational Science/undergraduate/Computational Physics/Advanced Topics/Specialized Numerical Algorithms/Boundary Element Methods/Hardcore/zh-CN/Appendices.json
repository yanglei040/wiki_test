{
    "hands_on_practices": [
        {
            "introduction": "边界元方法的核心在于将偏微分方程转化为边界积分方程。精确求解这些积分，特别是当源点和场点重合或非常接近时出现的奇异积分，对于方法的准确性至关重要。本练习  将指导你从第一性原理出发，推导并实现二维拉普拉斯问题中对数核在直线单元上的解析积分，这是编写任何二维 BEM 代码都必须掌握的基础技能。",
            "id": "2377305",
            "problem": "考虑 Laplace 方程的二维对数核，其定义为标量函数 $K(\\mathbf{x},\\mathbf{x}_0) = \\ln r$，其中 $r = \\|\\mathbf{x} - \\mathbf{x}_0\\|$ 是源点 $\\mathbf{x}$ 与场点 $\\mathbf{x}_0$ 之间的欧几里得距离。对于一个直线常数单元，设该单元为平面上连接端点 $\\mathbf{A} = (x_1, y_1)$ 和 $\\mathbf{B} = (x_2, y_2)$ 的线段 $\\Gamma$，且场点为 $\\mathbf{P} = (x_f, y_f)$。定义线积分\n$$\nI(\\mathbf{A}, \\mathbf{B}, \\mathbf{P}) = \\int_{\\Gamma} \\ln\\!\\left(\\frac{\\|\\mathbf{x} - \\mathbf{P}\\|}{L_0}\\right)\\, d\\ell,\n$$\n其中 $d\\ell$ 是沿 $\\Gamma$ 的线元，$L_0$ 是为使对数参数无量纲而引入的固定参考长度。所有距离必须以米为单位，并使用 $L_0 = 1\\,\\mathrm{m}$。量 $I(\\mathbf{A}, \\mathbf{B}, \\mathbf{P})$ 的单位是米。\n\n任务：\n- 从第一性原理出发，推导一个 $I(\\mathbf{A}, \\mathbf{B}, \\mathbf{P})$ 的闭式表达式，该表达式对任何非退化的直线段 $\\Gamma$ 和平面上的任何场点 $\\mathbf{P}$ 均有效，包括从 $\\mathbf{P}$ 到线段所在直线的垂直距离为零且 $\\mathbf{P}$ 在该直线上的投影位于线段内的极限情况。\n- 实现一个程序，使用推导出的闭式表达式为以下测试组计算 $I(\\mathbf{A}, \\mathbf{B}, \\mathbf{P})$，其中所有坐标均以米为单位：\n  - 测试 $1$：$\\mathbf{A} = (0,0)$，$\\mathbf{B} = (1,0)$，$\\mathbf{P} = (0.3,0.4)$。\n  - 测试 $2$：$\\mathbf{A} = (0,0)$，$\\mathbf{B} = (1,0)$，$\\mathbf{P} = (0.3,0)$。\n  - 测试 $3$：$\\mathbf{A} = (0,0)$，$\\mathbf{B} = (1,0)$，$\\mathbf{P} = (0.3,10^{-12})$。\n  - 测试 $4$：$\\mathbf{A} = (0,0)$，$\\mathbf{B} = (1,0)$，$\\mathbf{P} = (-0.5,0)$。\n  - 测试 $5$：$\\mathbf{A} = (1,2)$，$\\mathbf{B} = (4,6)$，$\\mathbf{P} = (3,3)$。\n  - 测试 $6$：$\\mathbf{A} = (0,0)$，$\\mathbf{B} = (10^{-9},0)$，$\\mathbf{P} = (0,1)$。\n  - 测试 $7$：$\\mathbf{A} = (0,0)$，$\\mathbf{B} = (1,0)$，$\\mathbf{P} = (1,0)$。\n\n在任何中间表达式中（例如，反正切），角度单位（若适用）必须为弧度。最终的数值结果必须以米表示。\n\n您的程序必须生成单行输出，其中包含测试 $1$ 到 $7$ 的结果，形式为一个逗号分隔的十进制数列表，每个数小数点后精确到 $12$ 位，并用方括号括起来。例如，输出格式必须是\n$[r_1,r_2,r_3,r_4,r_5,r_6,r_7]$\n其中每个 $r_k$ 是对应于测试 $k$ 的浮点数（单位为米），格式化为小数点后 $12$ 位。不允许有其他额外输出。",
            "solution": "该问题已经过验证，被认为是有效的。它具有科学依据，是适定的、客观的。问题陈述是完整的、一致的且可形式化的。该积分是二维势理论和边界元方法中的一个标准单元。对数奇点是可积的，这确保了即使当计算点位于积分路径上时，问题也是适定的。\n\n该问题要求推导并实现以下积分的闭式解：\n$$\nI(\\mathbf{A}, \\mathbf{B}, \\mathbf{P}) = \\int_{\\Gamma} \\ln\\!\\left(\\frac{\\|\\mathbf{x} - \\mathbf{P}\\|}{L_0}\\right)\\, d\\ell\n$$\n给定参考长度 $L_0=1$，对数的参数变为无量纲。由于 $\\ln(1)=0$，我们有 $\\ln(\\|\\mathbf{x} - \\mathbf{P}\\|/L_0) = \\ln(\\|\\mathbf{x} - \\mathbf{P}\\|) - \\ln(L_0) = \\ln(\\|\\mathbf{x} - \\mathbf{P}\\|)$。令 $r = \\|\\mathbf{x} - \\mathbf{P}\\|$。该积分简化为：\n$$\nI = \\int_{\\Gamma} \\ln r \\, d\\ell\n$$\n\n为求解此积分，我们为线段 $\\Gamma$ 建立一个局部坐标系 $(\\xi, \\eta)$。设原点位于点 $\\mathbf{A}$，$\\xi$ 轴与从 $\\mathbf{A}$ 到 $\\mathbf{B}$ 的向量对齐。线段的长度为 $L = \\|\\mathbf{B} - \\mathbf{A}\\|$。线段上的一个点 $\\mathbf{x}$ 可由 $\\xi \\in [0, L]$ 参数化。线元为 $d\\ell = d\\xi$。\n\n沿线段的单位切向向量为 $\\mathbf{t} = (\\mathbf{B} - \\mathbf{A})/L$。由 $\\mathbf{t}$ 逆时针旋转得到的单位法向向量为 $\\mathbf{n}$。场点 $\\mathbf{P}$ 可以在此局部坐标系中用坐标 $(\\xi_p, \\eta_p)$ 描述，它们是向量 $\\mathbf{P} - \\mathbf{A}$ 在局部坐标轴上的投影：\n$$\n\\xi_p = (\\mathbf{P} - \\mathbf{A}) \\cdot \\mathbf{t}\n$$\n$$\n\\eta_p = (\\mathbf{P} - \\mathbf{A}) \\cdot \\mathbf{n}\n$$\n从线段上一点 $\\mathbf{x}(\\xi)$（局部坐标为 $(\\xi, 0)$）到场点 $\\mathbf{P}$（局部坐标为 $(\\xi_p, \\eta_p)$）的距离 $r$ 由下式给出：\n$$\nr = \\sqrt{(\\xi - \\xi_p)^2 + \\eta_p^2}\n$$\n积分变为：\n$$\nI = \\int_{0}^{L} \\ln \\sqrt{(\\xi - \\xi_p)^2 + \\eta_p^2} \\, d\\xi = \\frac{1}{2} \\int_{0}^{L} \\ln \\left( (\\xi - \\xi_p)^2 + \\eta_p^2 \\right) \\, d\\xi\n$$\n\n我们使用分部积分法 $\\int u \\, dv = uv - \\int v \\, du$ 来求解不定积分 $J(\\xi) = \\int \\ln \\left( (\\xi - \\xi_p)^2 + \\eta_p^2 \\right) \\, d\\xi$。令 $u = \\ln((\\xi - \\xi_p)^2 + \\eta_p^2)$ 和 $dv = d\\xi$。为方便起见，我们选择 $v = \\xi - \\xi_p$。则 $du = \\frac{2(\\xi - \\xi_p)}{(\\xi - \\xi_p)^2 + \\eta_p^2} d\\xi$。\n$$\nJ(\\xi) = (\\xi - \\xi_p) \\ln \\left( (\\xi - \\xi_p)^2 + \\eta_p^2 \\right) - \\int (\\xi - \\xi_p) \\frac{2(\\xi - \\xi_p)}{(\\xi - \\xi_p)^2 + \\eta_p^2} \\, d\\xi\n$$\n余下的积分通过换元法计算。令 $s = \\xi - \\xi_p$：\n$$\n\\int \\frac{2s^2}{s^2 + \\eta_p^2} \\, ds = \\int \\frac{2(s^2 + \\eta_p^2) - 2\\eta_p^2}{s^2 + \\eta_p^2} \\, ds = \\int \\left( 2 - \\frac{2\\eta_p^2}{s^2 + \\eta_p^2} \\right) ds\n$$\n$$\n= 2s - 2\\eta_p^2 \\int \\frac{1}{s^2 + \\eta_p^2} ds = 2s - 2\\eta_p \\arctan\\left(\\frac{s}{\\eta_p}\\right)\n$$\n这对任何 $\\eta_p \\neq 0$ 的符号都成立。将 $s = \\xi - \\xi_p$ 代回：\n$$\nJ(\\xi) = (\\xi - \\xi_p) \\ln\\left( (\\xi - \\xi_p)^2 + \\eta_p^2 \\right) - 2(\\xi - \\xi_p) + 2\\eta_p \\arctan\\left(\\frac{\\xi - \\xi_p}{\\eta_p}\\right)\n$$\n定积分为 $I = \\frac{1}{2}[J(L) - J(0)]$。令 $R_A = \\|\\mathbf{P} - \\mathbf{A}\\| = \\sqrt{\\xi_p^2 + \\eta_p^2}$ 及 $R_B = \\|\\mathbf{P} - \\mathbf{B}\\| = \\sqrt{(L-\\xi_p)^2 + \\eta_p^2}$。\n$$\nJ(L) = (L-\\xi_p)\\ln(R_B^2) - 2(L-\\xi_p) + 2\\eta_p \\arctan\\left(\\frac{L-\\xi_p}{\\eta_p}\\right)\n$$\n$$\nJ(0) = (-\\xi_p)\\ln(R_A^2) - 2(-\\xi_p) + 2\\eta_p \\arctan\\left(\\frac{-\\xi_p}{\\eta_p}\\right)\n$$\n相减并化简得：\n$$\nI = (L - \\xi_p) \\ln R_B + \\xi_p \\ln R_A - L + \\eta_p \\left( \\arctan\\left(\\frac{L - \\xi_p}{\\eta_p}\\right) - \\arctan\\left(\\frac{-\\xi_p}{\\eta_p}\\right) \\right)\n$$\n使用恒等式 $\\arctan(-x) = -\\arctan(x)$，表达式化简为：\n$$\nI = (L - \\xi_p) \\ln R_B + \\xi_p \\ln R_A - L + \\eta_p \\left( \\arctan\\left(\\frac{L - \\xi_p}{\\eta_p}\\right) + \\arctan\\left(\\frac{\\xi_p}{\\eta_p}\\right) \\right)\n$$\n此表达式是 $\\eta_p$ 的偶函数，因为当 $\\eta_p \\to 0$ 时，初始因子 $\\eta_p$ 为负，但每个 $\\arctan$ 项也会变号，结果值相同。因此，我们可以使用 $|\\eta_p|$ 来写公式以强调这种对称性：\n$$\nI = (L - \\xi_p) \\ln R_B + \\xi_p \\ln R_A - L + |\\eta_p| \\left( \\arctan\\left(\\frac{L - \\xi_p}{|\\eta_p|}\\right) + \\arctan\\left(\\frac{\\xi_p}{|\\eta_p|}\\right) \\right)\n$$\n\n现在，考虑极限情况，即 $\\mathbf{P}$ 位于包含线段 $\\Gamma$ 的直线上，即 $\\eta_p = 0$。我们直接对这种情况计算积分：\n$$\nI = \\int_0^L \\ln|\\xi - \\xi_p| \\, d\\xi\n$$\n使用 $\\ln|u|$ 的原函数 $u \\ln|u| - u$：\n$$\nI = \\left[ (\\xi - \\xi_p) \\ln|\\xi - \\xi_p| - (\\xi - \\xi_p) \\right]_0^L\n$$\n$$\n= \\left((L - \\xi_p)\\ln|L - \\xi_p| - (L - \\xi_p)\\right) - \\left((-\\xi_p)\\ln|-\\xi_p| - (-\\xi_p)\\right)\n$$\n$$\nI = (L - \\xi_p)\\ln|L - \\xi_p| + \\xi_p\\ln|\\xi_p| - L\n$$\n该表达式也是通用公式在 $\\eta_p \\to 0$ 时的极限，因为 $\\lim_{y \\to 0} y \\arctan(K/y) = 0$。在实现时，必须注意对数参数为零的情况（即 $\\xi_p=0$ 或 $\\xi_p=L$）。在这些情况下，项 $x \\ln|x|$ 必须按其极限值（即 $0$）进行计算。\n\n实现将使用这两个公式。一个关于 $|\\eta_p|/L$ 的小数值容差用于在通用公式和数值上更稳定的共线情况公式之间进行选择。\n$\\mathbf{P}$ 在局部坐标系中的坐标计算如下：\n$L = \\sqrt{(x_2-x_1)^2 + (y_2-y_1)^2}$\n$\\xi_p = \\frac{(x_f-x_1)(x_2-x_1) + (y_f-y_1)(y_2-y_1)}{L}$\n$\\eta_p = \\frac{(y_f-y_1)(x_2-x_1) - (x_f-x_1)(y_2-y_1)}{L}$\n量 $(y_f-y_1)(x_2-x_1) - (x_f-x_1)(y_2-y_1)$ 与二维向量叉积有关，表示由向量 $\\mathbf{P}-\\mathbf{A}$ 和 $\\mathbf{B}-\\mathbf{A}$ 构成的平行四边形的有向面积。",
            "answer": "```python\nimport numpy as np\n\ndef _x_times_log_abs_x(x):\n    \"\"\"\n    Calculates x * log(|x|) with a safeguard for x=0.\n    The limit of x*log|x| as x approaches 0 is 0.\n    \"\"\"\n    if np.abs(x)  1e-30:\n        return 0.0\n    return x * np.log(np.abs(x))\n\ndef calculate_integral(A_coords, B_coords, P_coords):\n    \"\"\"\n    Calculates the integral I = integral over Gamma of ln(r) dl,\n    where Gamma is the line segment from A to B and r is the distance from a point on Gamma to P.\n    \n    Args:\n        A_coords (tuple): Coordinates of point A (x1, y1).\n        B_coords (tuple): Coordinates of point B (x2, y2).\n        P_coords (tuple): Coordinates of field point P (xf, yf).\n\n    Returns:\n        float: The value of the integral.\n    \"\"\"\n    A = np.array(A_coords, dtype=np.float64)\n    B = np.array(B_coords, dtype=np.float64)\n    P = np.array(P_coords, dtype=np.float64)\n\n    vec_AB = B - A\n    L_sq = vec_AB.dot(vec_AB)\n\n    # If the segment is a point (degenerate), the integral is zero.\n    if L_sq  1e-30:\n        return 0.0\n    \n    L = np.sqrt(L_sq)\n    vec_AP = P - A\n\n    # Project P onto the local coordinate system of the segment.\n    # xi_p is the coordinate along the segment.\n    xi_p = vec_AP.dot(vec_AB) / L\n    \n    # eta_p is the perpendicular distance from P to the line containing the segment.\n    # It is calculated using the 2D cross product equivalent.\n    # The sign convention here corresponds to a normal vector obtained by a\n    # counter-clockwise rotation of the tangent vector.\n    # However, the final formula is independent of the sign of eta_p.\n    cross_prod = vec_AP[0] * vec_AB[1] - vec_AP[1] * vec_AB[0]\n    eta_p = -cross_prod / L\n\n    # Check for collinearity using a relative tolerance.\n    # If P is on (or very close to) the line containing the segment.\n    if np.abs(eta_p) / L  1e-15:\n        term1 = _x_times_log_abs_x(L - xi_p)\n        term2 = _x_times_log_abs_x(xi_p)\n        return term1 + term2 - L\n    else:\n        # General case where P is not on the line.\n        abs_eta_p = np.abs(eta_p)\n        \n        # Distances from P to endpoints A and B.\n        # Calculated using local coordinates for robustness.\n        R_A = np.sqrt(xi_p**2 + eta_p**2)\n        R_B = np.sqrt((L - xi_p)**2 + eta_p**2)\n\n        term_log_A = xi_p * np.log(R_A)\n        term_log_B = (L - xi_p) * np.log(R_B)\n        \n        # Arctangent term.\n        arg1 = (L - xi_p) / abs_eta_p\n        arg2 = xi_p / abs_eta_p\n        term_atan = abs_eta_p * (np.arctan(arg1) + np.arctan(arg2))\n        \n        return term_log_A + term_log_B - L + term_atan\n\ndef solve():\n    \"\"\"\n    Solves the problem for the given test cases and prints the results\n    in the required format.\n    \"\"\"\n    test_cases = [\n        # Test 1: General case\n        {'A': (0.0, 0.0), 'B': (1.0, 0.0), 'P': (0.3, 0.4)},\n        # Test 2: P on the segment\n        {'A': (0.0, 0.0), 'B': (1.0, 0.0), 'P': (0.3, 0.0)},\n        # Test 3: P very close to the segment\n        {'A': (0.0, 0.0), 'B': (1.0, 0.0), 'P': (0.3, 1e-12)},\n        # Test 4: P on line extension\n        {'A': (0.0, 0.0), 'B': (1.0, 0.0), 'P': (-0.5, 0.0)},\n        # Test 5: General segment and point\n        {'A': (1.0, 2.0), 'B': (4.0, 6.0), 'P': (3.0, 3.0)},\n        # Test 6: Very short segment\n        {'A': (0.0, 0.0), 'B': (1e-9, 0.0), 'P': (0.0, 1.0)},\n        # Test 7: P at an endpoint\n        {'A': (0.0, 0.0), 'B': (1.0, 0.0), 'P': (1.0, 0.0)},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_integral(case['A'], case['B'], case['P'])\n        results.append(f\"{result:.12f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在掌握了单个单元的积分计算之后，下一步是理解如何将这些积分组合成一个线性方程组来求解整个边值问题。通过本练习 ，你将手动构建并求解一个用于模拟单位正方形内部势场问题的 $4 \\times 4$ BEM 系统。这个过程将让你亲身体验直接边界积分法中 $H$ 矩阵和 $G$ 矩阵的构建，并揭示其内在的数学结构和物理意义。",
            "id": "2374819",
            "problem": "考虑在单位正方形域 $\\Omega = (0,1)\\times(0,1)$（其边界为 $\\Gamma = \\partial\\Omega$）上二维（$2$D）拉普拉斯方程的内部边值问题。令 $u$ 表示势，令 $q = \\partial u/\\partial n$ 表示外向法向通量。使用拉普拉斯算子的直接边界积分方程，其二维自由空间格林函数为\n$$\nG(\\mathbf{x},\\mathbf{y}) \\;=\\; -\\frac{1}{2\\pi}\\,\\ln|\\mathbf{x}-\\mathbf{y}|\\;,\n$$\n并在光滑边界点 $\\mathbf{x}\\in\\Gamma$ 处采用标准的内部约定 $c(\\mathbf{x}) = \\tfrac{1}{2}$。用每边一个常数强度的直线单元（共四个单元）对边界进行离散化，并在每个单元的中点进行配置。单元索引如下：\n- $\\Gamma_{1}:\\ \\{(s,0)\\,|\\,0\\le s\\le 1\\}$，外向法向量为 $\\mathbf{n}_{1}=(0,-1)$，\n- $\\Gamma_{2}:\\ \\{(1,s)\\,|\\,0\\le s\\le 1\\}$，外向法向量为 $\\mathbf{n}_{2}=(1,0)$，\n- $\\Gamma_{3}:\\ \\{(s,1)\\,|\\,0\\le s\\le 1\\}$，外向法向量为 $\\mathbf{n}_{3}=(0,1)$，\n- $\\Gamma_{4}:\\ \\{(0,s)\\,|\\,0\\le s\\le 1\\}$，外向法向量为 $\\mathbf{n}_{4}=(-1,0)$，\n配置点为\n$$\n\\mathbf{x}_{1}=(\\tfrac{1}{2},0),\\quad \\mathbf{x}_{2}=(1,\\tfrac{1}{2}),\\quad \\mathbf{x}_{3}=(\\tfrac{1}{2},1),\\quad \\mathbf{x}_{4}=(0,\\tfrac{1}{2}).\n$$\n施加狄利克雷数据\n$$\nu=0\\ \\text{on}\\ \\Gamma_{1}\\cup\\Gamma_{4},\\qquad u=1\\ \\text{on}\\ \\Gamma_{2}\\cup\\Gamma_{3}.\n$$\n对每个单元使用分片常数的 $u$ 和 $q$ 并在中点进行配置，通过精确计算所需的边界积分，从第一性原理构建所得的 $4\\times 4$ 线性系统。然后求解该系统，得到四个未知的单元常数外向通量 $\\{q_{j}\\}_{j=1}^{4}$。使用以弧度为单位的反三角函数主值，并将最终结果精确地（无数值舍入）表示为行矩阵 $(q_{1}\\ q_{2}\\ q_{3}\\ q_{4})$。",
            "solution": "所提出的问题是一个定义明确的二维拉普拉斯方程边值问题，将使用直接边界元法求解。所有需要的数据，包括几何形状、边界条件和离散化方案，都已给出。该问题具有科学依据、自成体系且客观。因此，该问题被认为是有效的，并将提供解答。\n\n由拉普拉斯方程控制的内部势问题的直接边界积分方程 (BIE) 由下式给出\n$$c(\\mathbf{x}) u(\\mathbf{x}) + \\int_{\\Gamma} u(\\mathbf{y}) \\frac{\\partial G(\\mathbf{x}, \\mathbf{y})}{\\partial n_y} \\, d\\Gamma_y = \\int_{\\Gamma} q(\\mathbf{y}) G(\\mathbf{x}, \\mathbf{y}) \\, d\\Gamma_y$$\n其中 $\\mathbf{x}$ 是边界 $\\Gamma$ 上的一个点，$c(\\mathbf{x})$ 是立体角系数，$u$ 是势，$q = \\partial u/\\partial n$ 是法向通量，$G(\\mathbf{x},\\mathbf{y})$ 是自由空间格林函数。对于本问题，$G(\\mathbf{x},\\mathbf{y}) = -\\frac{1}{2\\pi}\\ln|\\mathbf{x}-\\mathbf{y}|$。格林函数的法向导数为 $\\frac{\\partial G}{\\partial n_y} = \\nabla_y G \\cdot \\mathbf{n}_y = -\\frac{1}{2\\pi} \\frac{(\\mathbf{y}-\\mathbf{x})\\cdot\\mathbf{n}_y}{|\\mathbf{y}-\\mathbf{x}|^2}$。\n\n边界 $\\Gamma$ 被离散为四个常数强度单元 $\\Gamma_j$，其中 $j=1,2,3,4$。势 $u$ 和通量 $q$ 在每个单元 $\\Gamma_j$ 上被假定为分片常数，记作 $u_j$ 和 $q_j$。在每个单元 $\\Gamma_i$ 的中点 $\\mathbf{x}_i$ 应用 BIE，可得到一个线性代数方程组。由于配置点位于直线段的中点，它们是边界上的光滑点，因此对所有 $i$ 都有 $c(\\mathbf{x}_i) = 1/2$。离散化的 BIE 为：\n$$\\frac{1}{2} u_i + \\sum_{j=1}^{4} u_j \\left( \\int_{\\Gamma_j} \\frac{\\partial G(\\mathbf{x}_i, \\mathbf{y})}{\\partial n_y} \\, d\\Gamma_y \\right) = \\sum_{j=1}^{4} q_j \\left( \\int_{\\Gamma_j} G(\\mathbf{x}_i, \\mathbf{y}) \\, d\\Gamma_y \\right)$$\n这可以写成矩阵形式 $(\\mathbf{H} + \\frac{1}{2}\\mathbf{I})\\mathbf{u} = \\mathbf{G}\\mathbf{q}$，其中矩阵元素由下式给出：\n$$H_{ij} = \\int_{\\Gamma_j} \\frac{\\partial G(\\mathbf{x}_i, \\mathbf{y})}{\\partial n_y} \\, d\\Gamma_y \\quad \\text{和} \\quad G_{ij} = \\int_{\\Gamma_j} G(\\mathbf{x}_i, \\mathbf{y}) \\, d\\Gamma_y$$\n已知量是每个单元上的势，由狄利克雷边界条件给出：$u_1 = 0$, $u_2 = 1$, $u_3 = 1$, $u_4 = 0$。势向量为 $\\mathbf{u} = (0, 1, 1, 0)^T$。未知量是通量 $\\mathbf{q} = (q_1, q_2, q_3, q_4)^T$。\n\n我们现在必须计算矩阵系数 $H_{ij}$ 和 $G_{ij}$。\n由于正方形的几何形状和配置点的选择，矩阵 $\\mathbf{H}$ 和 $\\mathbf{G}$ 将表现出对称结构。我们将有对角元 ($i=j$)、相邻元 (如 $i=1, j=2$) 和相对元 (如 $i=1, j=3$)。\n\n计算 $H_{ij}$：\n对于直线单元，当 $i=j$ 时，向量 $\\mathbf{y}-\\mathbf{x}_i$ 与单元 $\\Gamma_i$ 相切。法向量 $\\mathbf{n}_i$ 与该单元正交。因此，$(\\mathbf{y}-\\mathbf{x}_i) \\cdot \\mathbf{n}_i = 0$，这意味着对所有 $i=1,2,3,4$ 都有 $H_{ii} = 0$。\n对于非对角元，我们计算积分。让我们计算第一行（$i=1$，其中 $\\mathbf{x}_1 = (1/2, 0)$）。\n$H_{12}$：在 $\\Gamma_2$ 上积分，其中 $\\mathbf{y}=(1,s)$ 对于 $s\\in[0,1]$ 且 $\\mathbf{n}_2=(1,0)$。\n$H_{12} = -\\frac{1}{2\\pi} \\int_0^1 \\frac{((1,s)-(1/2,0))\\cdot(1,0)}{|(1,s)-(1/2,0)|^2} ds = -\\frac{1}{2\\pi} \\int_0^1 \\frac{1/2}{(1/2)^2+s^2} ds = -\\frac{1}{4\\pi} \\left[2\\arctan(2s)\\right]_0^1 = -\\frac{\\arctan(2)}{2\\pi}$。\n$H_{14}$：在 $\\Gamma_4$ 上积分，其中 $\\mathbf{y}=(0,s)$ 对于 $s\\in[0,1]$ 且 $\\mathbf{n}_4=(-1,0)$。\n$H_{14} = -\\frac{1}{2\\pi} \\int_0^1 \\frac{((0,s)-(1/2,0))\\cdot(-1,0)}{|(0,s)-(1/2,0)|^2} ds = -\\frac{1}{2\\pi} \\int_0^1 \\frac{1/2}{(-1/2)^2+s^2} ds = H_{12} = -\\frac{\\arctan(2)}{2\\pi}$。\n$H_{13}$：在 $\\Gamma_3$ 上积分，其中 $\\mathbf{y}=(s,1)$ 对于 $s\\in[0,1]$ 且 $\\mathbf{n}_3=(0,1)$。\n$H_{13} = -\\frac{1}{2\\pi} \\int_0^1 \\frac{((s,1)-(1/2,0))\\cdot(0,1)}{|(s,1)-(1/2,0)|^2} ds = -\\frac{1}{2\\pi} \\int_0^1 \\frac{1}{(s-1/2)^2+1^2} ds = -\\frac{1}{2\\pi} \\left[\\arctan(s-1/2)\\right]_0^1 = -\\frac{1}{2\\pi}(\\arctan(1/2)-\\arctan(-1/2)) = -\\frac{\\arctan(1/2)}{\\pi}$。\n根据对称性，令 $h_a = H_{12} = H_{14} = H_{21} = \\dots = -\\frac{\\arctan(2)}{2\\pi}$ 和 $h_o = H_{13} = H_{31} = \\dots = -\\frac{\\arctan(1/2)}{\\pi}$。\n矩阵 $\\mathbf{H}$ 为：\n$\\mathbf{H} = \\begin{pmatrix} 0  h_a  h_o  h_a \\\\ h_a  0  h_a  h_o \\\\ h_o  h_a  0  h_a \\\\ h_a  h_o  h_a  0 \\end{pmatrix}$。\n注意，每行的和为 $2h_a+h_o = -\\frac{\\arctan(2)}{\\pi} - \\frac{\\arctan(1/2)}{\\pi} = -\\frac{1}{\\pi}(\\arctan(2)+\\arctan(1/2)) = -\\frac{1}{\\pi}(\\frac{\\pi}{2}) = -1/2$，这满足求和规则 $\\sum_j H_{ij} = -c(\\mathbf{x}_i)$。\n\n计算 $G_{ij}$：\n我们使用通用积分公式：$\\int \\ln(t^2+c^2)dt = t\\ln(t^2+c^2) - 2t + 2c\\arctan(t/c)$。\n$G_{11}$：在 $\\Gamma_1$ 上积分，其中 $\\mathbf{y}=(s,0)$ 对于 $s\\in[0,1]$。\n$G_{11} = -\\frac{1}{2\\pi}\\int_0^1 \\ln|s-1/2| ds = -\\frac{1}{2\\pi} (2 \\int_0^{1/2} \\ln(t) dt) = -\\frac{1}{\\pi}[t\\ln t - t]_0^{1/2} = -\\frac{1}{\\pi}(\\frac{1}{2}\\ln(1/2)-\\frac{1}{2}) = \\frac{1+\\ln 2}{2\\pi}$。\n$G_{12}$：在 $\\Gamma_2$ 上积分，$\\mathbf{y}=(1,s)$，$s\\in[0,1]$。\n$G_{12} = -\\frac{1}{2\\pi} \\int_0^1 \\ln\\sqrt{(1/2)^2+s^2} ds = -\\frac{1}{4\\pi}\\int_0^1 \\ln(s^2+(1/2)^2) ds = -\\frac{1}{4\\pi}[s\\ln(s^2+1/4)-2s+\\arctan(2s)]_0^1 = -\\frac{1}{4\\pi}(\\ln(5/4)-2+\\arctan(2)) = \\frac{2-\\ln(5/4)-\\arctan(2)}{4\\pi}$。\n$G_{13}$：在 $\\Gamma_3$ 上积分，$\\mathbf{y}=(s,1)$，$s\\in[0,1]$。\n$G_{13} = -\\frac{1}{2\\pi} \\int_0^1 \\ln\\sqrt{(s-1/2)^2+1^2} ds = -\\frac{1}{4\\pi}\\int_{-1/2}^{1/2} \\ln(t^2+1) dt = -\\frac{2}{4\\pi}\\int_0^{1/2} \\ln(t^2+1) dt = -\\frac{1}{2\\pi}[t\\ln(t^2+1)-2t+2\\arctan(t)]_0^{1/2} = -\\frac{1}{2\\pi}(\\frac{1}{2}\\ln(5/4)-1+2\\arctan(1/2)) = \\frac{1-\\frac{1}{2}\\ln(5/4)-2\\arctan(1/2)}{2\\pi}$。\n根据对称性，令 $g_d = G_{11} = G_{22} = \\dots = \\frac{1+\\ln 2}{2\\pi}$，$g_a = G_{12} = G_{14} = \\dots = \\frac{2-\\ln(5/4)-\\arctan(2)}{4\\pi}$，以及 $g_o = G_{13} = G_{31} = \\dots = \\frac{2-\\ln(5/4)-4\\arctan(1/2)}{4\\pi}$。\n矩阵 $\\mathbf{G}$ 为：\n$\\mathbf{G} = \\begin{pmatrix} g_d  g_a  g_o  g_a \\\\ g_a  g_d  g_a  g_o \\\\ g_o  g_a  g_d  g_a \\\\ g_a  g_o  g_a  g_d \\end{pmatrix}$。\n\n现在我们构建并求解系统 $\\mathbf{G}\\mathbf{q}=\\mathbf{v}$，其中 $\\mathbf{v} = (\\mathbf{H} + \\frac{1}{2}\\mathbf{I})\\mathbf{u}$。\n对于 $\\mathbf{u}=(0,1,1,0)^T$：\n$v_1 = \\frac{1}{2}u_1 + H_{12}u_2 + H_{13}u_3 + H_{14}u_4 = h_a(1) + h_o(1) = h_a+h_o$。\n$v_2 = H_{21}u_1 + \\frac{1}{2}u_2 + H_{23}u_3 + H_{24}u_4 = \\frac{1}{2}(1) + h_a(1) = 1/2+h_a$。\n$v_3 = H_{31}u_1 + H_{32}u_2 + \\frac{1}{2}u_3 + H_{34}u_4 = h_a(1) + \\frac{1}{2}(1) = 1/2+h_a$。\n$v_4 = H_{41}u_1 + H_{42}u_2 + H_{43}u_3 + \\frac{1}{2}u_4 = h_o(1) + h_a(1) = h_a+h_o$。\n所以，$\\mathbf{v} = (h_a+h_o, 1/2+h_a, 1/2+h_a, h_a+h_o)^T$。\n\n该问题关于直线 $y=x$ 具有反射对称性。边界条件也遵循此对称性。因此，通量的解也必须是对称的：$q_1=q_4$ 和 $q_2=q_3$。令 $q_1=q_4=A$ 和 $q_2=q_3=B$。这个 $4 \\times 4$ 系统可简化为 $2 \\times 2$ 系统：\n\\begin{align*} (g_d+g_a)A + (g_a+g_o)B = h_a+h_o \\\\ (g_a+g_o)A + (g_d+g_a)B = 1/2+h_a \\end{align*}\n两方程相减得：\n$((g_d+g_a)-(g_a+g_o))A + ((g_a+g_o)-(g_d+g_a))B = (h_a+h_o)-(1/2+h_a)$\n$(g_d-g_o)A - (g_d-g_o)B = h_o-1/2$\n$(g_d-g_o)(A-B) = h_o-1/2$。\n两方程相加得：\n$((g_d+g_a)+(g_a+g_o))(A+B) = (h_a+h_o) + (1/2+h_a)$\n$(g_d+2g_a+g_o)(A+B) = 1/2+2h_a+h_o$。\n由于 $2h_a+h_o = -1/2$，右侧为 $0$。和 $g_d+2g_a+g_o$ 非零，因此我们必须有 $A+B=0$，所以 $B=-A$。这与无源域的总流出通量为零的物理要求相一致：$\\sum q_j L_j = q_1(1)+q_2(1)+q_3(1)+q_4(1) = A+B+B+A = 2(A+B)=0$。\n将 $B=-A$ 代入 $2 \\times 2$ 系统的第一个方程：\n$(g_d+g_a)A - (g_a+g_o)A = h_a+h_o$\n$(g_d-g_o)A = h_a+h_o \\implies A = \\frac{h_a+h_o}{g_d-g_o}$。\n我们计算分子和分母。\n$h_a+h_o = -\\frac{\\arctan(2)}{2\\pi} - \\frac{\\arctan(1/2)}{\\pi} = -\\frac{1}{2\\pi}(\\arctan(2)+2\\arctan(1/2))$。使用恒等式 $\\arctan(2)+\\arctan(1/2)=\\pi/2$，所以 $\\arctan(2)=\\pi/2-\\arctan(1/2)$，我们得到：\n$h_a+h_o = -\\frac{1}{2\\pi}(\\pi/2 - \\arctan(1/2) + 2\\arctan(1/2)) = -\\frac{1}{2\\pi}(\\frac{\\pi}{2}+\\arctan(1/2))$。\n对于分母：\n$g_d=\\frac{1+\\ln 2}{2\\pi}$ 和 $g_o=\\frac{2-\\ln(5/4)-4\\arctan(1/2)}{4\\pi}=\\frac{1-\\frac{1}{2}(\\ln 5 - 2\\ln 2)-2\\arctan(1/2)}{2\\pi}$。\n$g_d-g_o = \\frac{1}{2\\pi}[(1+\\ln 2) - (1-\\frac{1}{2}\\ln 5 + \\ln 2-2\\arctan(1/2))] = \\frac{1}{2\\pi}(\\frac{1}{2}\\ln 5 + 2\\arctan(1/2))$。\n因此，\n$A = \\frac{-\\frac{1}{2\\pi}(\\frac{\\pi}{2}+\\arctan(1/2))}{\\frac{1}{2\\pi}(\\frac{1}{2}\\ln 5+2\\arctan(1/2))} = -\\frac{\\frac{\\pi}{2}+\\arctan(1/2)}{\\frac{1}{2}\\ln 5+2\\arctan(1/2)}$。\n那么通量为：\n$q_1=q_4=A = -\\frac{\\pi/2+\\arctan(1/2)}{1/2\\ln 5+2\\arctan(1/2)}$\n$q_2=q_3=B=-A = \\frac{\\pi/2+\\arctan(1/2)}{1/2\\ln 5+2\\arctan(1/2)}$。\n\n最终结果是行矩阵 $(q_1 \\ q_2 \\ q_3 \\ q_4)$。\n令常数 $C = \\frac{\\frac{\\pi}{2}+\\arctan(\\frac{1}{2})}{\\frac{1}{2}\\ln 5+2\\arctan(\\frac{1}{2})} = \\frac{\\pi+2\\arctan(\\frac{1}{2})}{\\ln 5+4\\arctan(\\frac{1}{2})}$。\n则 $q_1 = -C$, $q_2 = C$, $q_3 = C$, $q_4 = -C$。\n最终答案如下所示。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} -\\frac{\\pi+2\\arctan(\\frac{1}{2})}{\\ln 5+4\\arctan(\\frac{1}{2})}  \\frac{\\pi+2\\arctan(\\frac{1}{2})}{\\ln 5+4\\arctan(\\frac{1}{2})}  \\frac{\\pi+2\\arctan(\\frac{1}{2})}{\\ln 5+4\\arctan(\\frac{1}{2})}  -\\frac{\\pi+2\\arctan(\\frac{1}{2})}{\\ln 5+4\\arctan(\\frac{1}{2})} \\end{pmatrix} } $$"
        },
        {
            "introduction": "理论和基础练习的最终目的是为了解决实际的科学与工程问题。本练习  是一个综合性的编程项目，要求你运用边界元方法来模拟电化学沉积过程中金属枝晶尖端的电场增强效应。通过解决这个具有实际物理背景的问题，你将把前面学到的离散化、矩阵组装、系统求解和后处理等技能融会贯通，从而体会到 BEM 在模拟复杂几何和场集中现象时的强大能力。",
            "id": "2377246",
            "problem": "考虑一个二维准静态电化学沉积场景，其中金属枝晶被建模为一个嵌入在均匀电解质中的不可穿透的完美导电夹杂物。在稀溶液稳态下，静电势满足拉普拉斯方程。您将使用边界元法 (BEM) 来模拟枝晶尖端的电场增强效应。\n\n基本原理和模型。设电解质占据有界域 $\\Omega \\subset \\mathbb{R}^2$，该区域定义为以原点为中心、半径为 $R$ 的外圆与一个内部金属夹杂物之间的区域。该金属夹杂物通过一个半轴为 $a$ 和 $b$、与坐标轴对齐且同样以原点为中心的椭圆来近似枝晶的横截面。静电势 $\\phi(\\mathbf{x})$ 在 $\\Omega$ 中满足拉普拉斯方程 $\\nabla^2 \\phi = 0$。金属夹杂物边界 $\\Gamma_c$ 是一个等势导体，因此在 $\\Gamma_c$ 上施加狄利克雷数据 $\\phi = 0$。远场通过一个半径为 $R$ 的大边界圆 $\\Gamma_R$ 来近似，在该圆上规定狄利克雷数据 $\\phi(\\mathbf{x}) = -E_0 x$，以模拟一个沿正 $x$ 轴方向、大小为 $E_0$ 的均匀外加电场。这里 $x$ 表示第一个笛卡尔坐标，$E_0 > 0$ 是一个常数。所有长度都是无量纲的，角度必须以弧度处理。\n\n边界积分表示法。使用拉普拉斯方程的二维自由空间格林函数 $G(\\mathbf{x},\\mathbf{y}) = -\\dfrac{1}{2\\pi} \\ln \\|\\mathbf{x}-\\mathbf{y}\\|$。利用在边界并集 $\\Gamma = \\Gamma_c \\cup \\Gamma_R$ 上具有未知密度 $\\sigma$ 的单层势来表示 $\\Omega$ 中的解：\n$$\n\\phi(\\mathbf{x}) = \\int_{\\Gamma} G(\\mathbf{x},\\mathbf{y}) \\, \\sigma(\\mathbf{y}) \\, \\mathrm{d}s_{\\mathbf{y}}, \\quad \\mathbf{x} \\in \\Omega \\cup \\Gamma.\n$$\n在边界配置点上强制施加狄利克雷条件，从而获得一个关于 $\\sigma$ 的积分方程，该方程将进行数值求解。\n\n数值离散化。通过对椭圆 $(x(t),y(t)) = (a \\cos t, b \\sin t)$（其中 $t \\in [0, 2\\pi)$）进行均匀参数化，得到具有 $N_c$ 个直线单元的折线来离散化 $\\Gamma_c$；通过对圆 $(x(\\theta),y(\\theta)) = (R \\cos \\theta, R \\sin \\theta)$（其中 $\\theta \\in [0,2\\pi)$）进行均匀参数化，得到具有 $N_R$ 个直线单元的折线来离散化 $\\Gamma_R$。在每个单元上使用常数基函数，并在单元中点进行配置。对于单层算子，非对角相互作用通过中点法则近似，自作用项通过计算在直线上段上的精确积分来处理。具体来说，对于长度为 $L_j$、中点为 $\\mathbf{y}_j$ 的单元 $j$，以及位于单元 $i \\neq j$ 上的配置点 $\\mathbf{x}_i$，近似为\n$$\n\\int_{\\Gamma_j} G(\\mathbf{x}_i,\\mathbf{y}) \\, \\mathrm{d}s_{\\mathbf{y}} \\approx G(\\mathbf{x}_i,\\mathbf{y}_j) \\, L_j,\n$$\n其中 $G(\\mathbf{x},\\mathbf{y}) = -\\dfrac{1}{2\\pi} \\ln \\|\\mathbf{x}-\\mathbf{y}\\|$。对于对角项 $i=j$，使用以配置点为中心的长度为 $L_i$ 的直线上段的解析自作用项，\n$$\n\\int_{-L_i/2}^{L_i/2} \\left(-\\dfrac{1}{2\\pi}\\right) \\ln |s| \\, \\mathrm{d}s \\;=\\; -\\dfrac{1}{2\\pi} \\left( L_i \\ln\\frac{L_i}{2} - L_i \\right).\n$$\n组装关于未知单层密度向量 $\\boldsymbol{\\sigma}$ 的稠密线性系统并直接求解。\n\n电场评估与增强因子。电场为 $\\mathbf{E}(\\mathbf{x}) = -\\nabla \\phi(\\mathbf{x})$。在求解出 $\\boldsymbol{\\sigma}$ 后，在椭圆前端尖端附近的一点 $(x,y) = (a+\\delta, 0)$ 处计算 $\\nabla \\phi$，其中 $\\delta$ 是测试套件中指定的一个小的正偏移量。使用常数单元和中点近似，\n$$\n\\nabla \\phi(\\mathbf{x}) \\approx \\sum_{j=1}^{N} \\sigma_j \\, \\left[ \\int_{\\Gamma_j} \\nabla_{\\mathbf{x}} G(\\mathbf{x},\\mathbf{y}) \\, \\mathrm{d}s_{\\mathbf{y}} \\right] \\approx \\sum_{j=1}^{N} \\sigma_j \\, \\left( \\nabla_{\\mathbf{x}} G(\\mathbf{x},\\mathbf{y}_j) \\, L_j \\right),\n$$\n其中\n$$\n\\nabla_{\\mathbf{x}} G(\\mathbf{x},\\mathbf{y}) = -\\dfrac{1}{2\\pi} \\dfrac{\\mathbf{x}-\\mathbf{y}}{\\|\\mathbf{x}-\\mathbf{y}\\|^2}.\n$$\n计算增强因子 $\\beta = \\dfrac{\\|\\mathbf{E}(a+\\delta,0)\\|}{E_0}$。\n\n测试套件。实现所描述的算法，并为以下三组参数集计算 $\\beta$。这三组参数分别用于探测圆形夹杂物、中等细长的椭圆和高度细长的椭圆。在所有情况下，角度均以弧度为单位，结果为无量纲数。\n\n- 情况 1（基准，近似圆形导体）：$a = 1.0$, $b = 1.0$, $R = 10.0$, $N_c = 120$, $N_R = 180$, $E_0 = 1.0$, $\\delta = 0.02 \\, a$。\n- 情况 2（中等细长的枝晶）：$a = 2.0$, $b = 0.5$, $R = 12.0$, $N_c = 140$, $N_R = 200$, $E_0 = 1.0$, $\\delta = 0.02 \\, a$。\n- 情况 3（高度细长的枝晶）：$a = 3.0$, $b = 0.3$, $R = 15.0$, $N_c = 160$, $N_R = 220$, $E_0 = 1.0$, $\\delta = 0.02 \\, a$。\n\n最终输出格式。您的程序应生成单行输出，其中包含一个逗号分隔的列表，用方括号括起来，按上述情况的顺序排列结果，例如 $[\\beta_1,\\beta_2,\\beta_3]$。每个 $\\beta_k$ 都必须是一个浮点数。",
            "solution": "我们从均匀、稳态、无自由电荷的电解质中静电场的基本控制方程开始，即在域 $\\Omega$ 内的拉普拉斯方程 $\\nabla^2 \\phi = 0$。边界是并集 $\\Gamma = \\Gamma_c \\cup \\Gamma_R$，其中 $\\Gamma_c$ 表示金属夹杂物（枝晶横截面），$\\Gamma_R$ 表示一个近似远场的大型人工边界。指定了狄利克雷数据：在 $\\Gamma_c$ 上 $\\phi = 0$，因为导体是等势的；在 $\\Gamma_R$ 上 $\\phi = -E_0 x$，以模拟一个与 $x$ 轴对齐、大小为 $E_0$ 的均匀外加电场。\n\n边界积分表示法原理。对于二维拉普拉斯方程，其基本解（自由空间格林函数）是 $G(\\mathbf{x},\\mathbf{y}) = -\\dfrac{1}{2\\pi} \\ln \\|\\mathbf{x}-\\mathbf{y}\\|$。一个经典的表示公式将谐函数 $\\phi$ 表示为支承在边界上的单层势，\n$$\n\\phi(\\mathbf{x}) = \\int_{\\Gamma} G(\\mathbf{x},\\mathbf{y}) \\, \\sigma(\\mathbf{y}) \\, \\mathrm{d}s_{\\mathbf{y}}, \\quad \\mathbf{x} \\in \\Omega \\cup \\Gamma.\n$$\n对于在足够光滑边界上的狄利克雷边值问题，单层势假设产生一个关于未知密度 $\\sigma$ 的第一类弗雷德霍姆积分方程，该方程通过从域内取极限 $\\mathbf{x} \\to \\Gamma$ 并强制施加规定的边界值得到。得到的方程是\n$$\n\\int_{\\Gamma} G(\\mathbf{x},\\mathbf{y}) \\, \\sigma(\\mathbf{y}) \\, \\mathrm{d}s_{\\mathbf{y}} = f(\\mathbf{x}), \\quad \\mathbf{x} \\in \\Gamma,\n$$\n其中在 $\\Gamma_c$ 上 $f(\\mathbf{x}) = 0$，在 $\\Gamma_R$ 上 $f(\\mathbf{x}) = -E_0 x$。对于狄利克雷问题，该算子在满足当前几何形状的技术条件下是可逆的，从而确保了唯一的解 $\\sigma$。\n\n通过常数单元和配置进行离散化。我们将边界 $\\Gamma$ 划分成 $N = N_c + N_R$ 个直线段。在椭圆上，我们使用参数曲线 $(x(t),y(t)) = (a\\cos t,b\\sin t)$，其中 $t \\in [0,2\\pi)$，并均匀划分为 $N_c$ 个段；在圆上，我们使用 $(x(\\theta),y(\\theta)) = (R\\cos \\theta,R\\sin \\theta)$，其中 $\\theta \\in [0,2\\pi)$，并均匀划分为 $N_R$ 个段。在每个段 $j$ 上，我们将 $\\sigma$ 近似为常数值 $\\sigma_j$，并在段的中点 $\\mathbf{x}_i$ 处配置积分方程。对于 $i \\neq j$，中点法则得出\n$$\n\\int_{\\Gamma_j} G(\\mathbf{x}_i,\\mathbf{y}) \\, \\sigma_j \\, \\mathrm{d}s_{\\mathbf{y}} \\approx G(\\mathbf{x}_i,\\mathbf{y}_j) \\, L_j \\, \\sigma_j,\n$$\n其中 $\\mathbf{y}_j$ 是段 $j$ 的中点，$L_j$ 是其长度。对于对角自作用项 $i=j$，我们对以配置点为中心的直线段精确计算积分。在局部坐标中，段与 $s$ 轴在 $s \\in [-L_i/2,L_i/2]$ 上重合，且配置点位于 $s=0$ 处，我们有\n$$\n\\int_{\\Gamma_i} G(\\mathbf{x}_i,\\mathbf{y}) \\, \\mathrm{d}s_{\\mathbf{y}} = -\\frac{1}{2\\pi} \\int_{-L_i/2}^{L_i/2} \\ln|s| \\, \\mathrm{d}s = -\\frac{1}{2\\pi} \\left( \\int_{0}^{L_i/2} 2 \\ln s \\, \\mathrm{d}s \\right).\n$$\n使用反导数 $\\int \\ln s \\, \\mathrm{d}s = s \\ln s - s$，我们得到\n$$\n\\int_{0}^{L_i/2} 2 \\ln s \\, \\mathrm{d}s = 2 \\left[ s \\ln s - s \\right]_{0}^{L_i/2} = 2 \\left( \\frac{L_i}{2} \\ln \\frac{L_i}{2} - \\frac{L_i}{2} \\right) = L_i \\ln \\frac{L_i}{2} - L_i.\n$$\n因此，对角项为\n$$\n\\int_{\\Gamma_i} G(\\mathbf{x}_i,\\mathbf{y}) \\, \\mathrm{d}s_{\\mathbf{y}} = -\\frac{1}{2\\pi} \\left( L_i \\ln \\frac{L_i}{2} - L_i \\right).\n$$\n收集所有项定义了一个稠密线性系统 $\\mathbf{A} \\boldsymbol{\\sigma} = \\mathbf{f}$，其中\n$$\nA_{ij} = \\begin{cases}\n-\\dfrac{1}{2\\pi} \\ln \\|\\mathbf{x}_i - \\mathbf{y}_j\\| \\cdot L_j,  i \\neq j, \\\\[6pt]\n-\\dfrac{1}{2\\pi} \\left( L_i \\ln \\dfrac{L_i}{2} - L_i \\right),  i = j,\n\\end{cases}\n$$\n而 $\\mathbf{f}$ 堆叠了中点处的边界数据值：对于 $\\mathbf{x}_i \\in \\Gamma_c$，$f(\\mathbf{x}_i) = 0$；对于 $\\mathbf{x}_i \\in \\Gamma_R$，$f(\\mathbf{x}_i) = -E_0 x_i$。求解此系统得到单层密度 $\\boldsymbol{\\sigma}$ 的常数单元近似。\n\n电场评估。电场为 $\\mathbf{E} = -\\nabla \\phi$。在积分号下对单层势求导得到\n$$\n\\nabla_{\\mathbf{x}} \\phi(\\mathbf{x}) = \\int_{\\Gamma} \\nabla_{\\mathbf{x}} G(\\mathbf{x},\\mathbf{y}) \\, \\sigma(\\mathbf{y}) \\, \\mathrm{d}s_{\\mathbf{y}}, \\quad \\nabla_{\\mathbf{x}} G(\\mathbf{x},\\mathbf{y}) = -\\frac{1}{2\\pi} \\frac{\\mathbf{x}-\\mathbf{y}}{\\|\\mathbf{x}-\\mathbf{y}\\|^2}.\n$$\n使用常数单元和中点近似，\n$$\n\\nabla_{\\mathbf{x}} \\phi(\\mathbf{x}) \\approx \\sum_{j=1}^{N} \\sigma_j \\left( -\\frac{1}{2\\pi} \\frac{\\mathbf{x}-\\mathbf{y}_j}{\\|\\mathbf{x}-\\mathbf{y}_j\\|^2} \\right) L_j.\n$$\n我们在 $\\mathbf{x}_{\\mathrm{tip}} = (a+\\delta, 0)$ 处计算该值，其中 $\\delta$ 为一个小的正数，以避免在边界上出现奇异行为。增强因子则为\n$$\n\\beta = \\frac{\\|\\mathbf{E}(\\mathbf{x}_{\\mathrm{tip}})\\|}{E_0} = \\frac{\\| -\\nabla \\phi(\\mathbf{x}_{\\mathrm{tip}}) \\|}{E_0}.\n$$\n\n与原理相结合的算法步骤。\n- 通过分别对 $t \\in [0,2\\pi)$ 和 $\\theta \\in [0,2\\pi)$ 进行 $N_c$ 和 $N_R$ 个点的均匀采样，构造 $\\Gamma_c$ 和 $\\Gamma_R$，并在连续采样点之间形成直线段。计算段中点 $\\mathbf{y}_j$ 和长度 $L_j$。\n- 使用上述 $A_{ij}$ 的表达式构建稠密矩阵 $\\mathbf{A}$，对非对角项进行向量化计算，对角项使用解析表达式。根据规定的边界值组装右侧向量 $\\mathbf{f}$。\n- 使用直接线性求解器求解 $\\mathbf{A} \\boldsymbol{\\sigma} = \\mathbf{f}$。\n- 通过中点求积公式在 $\\mathbf{x}_{\\mathrm{tip}}$ 处计算 $\\nabla \\phi$，并计算 $\\beta$。\n- 对每个测试用例重复上述步骤。\n\n验证预期。对于圆形夹杂物情况 $a=b$，经典势论表明，在均匀场中的圆柱形导体，其前端极点处的表面场强大小约为 $2 E_0$，因此计算出的 $\\beta$ 值接近 2 表明实现是一致的。增加长宽比 $a/b$ 会使尖端更锐利，并增加 $\\beta$ 值，这与尖锐导体处的场增强效应一致。\n\n程序将以 $[\\beta_1,\\beta_2,\\beta_3]$ 的格式输出单行结果，其中每个 $\\beta_k$ 是对应测试用例计算出的浮点增强因子。",
            "answer": "```python\nimport numpy as np\n\ndef discretize_ellipse(a, b, N):\n    # Uniform parameterization in radians\n    t = np.linspace(0.0, 2.0*np.pi, N+1)\n    x = a * np.cos(t)\n    y = b * np.sin(t)\n    # Segment endpoints\n    x0, y0 = x[:-1], y[:-1]\n    x1, y1 = x[1:], y[1:]\n    # Midpoints and lengths\n    cx = 0.5 * (x0 + x1)\n    cy = 0.5 * (y0 + y1)\n    lengths = np.sqrt((x1 - x0)**2 + (y1 - y0)**2)\n    centers = np.column_stack((cx, cy))\n    return centers, lengths\n\ndef discretize_circle(R, N):\n    theta = np.linspace(0.0, 2.0*np.pi, N+1)\n    x = R * np.cos(theta)\n    y = R * np.sin(theta)\n    x0, y0 = x[:-1], y[:-1]\n    x1, y1 = x[1:], y[1:]\n    cx = 0.5 * (x0 + x1)\n    cy = 0.5 * (y0 + y1)\n    lengths = np.sqrt((x1 - x0)**2 + (y1 - y0)**2)\n    centers = np.column_stack((cx, cy))\n    return centers, lengths\n\ndef assemble_single_layer_matrix(centers, lengths):\n    # centers: (N,2), lengths: (N,)\n    X = centers[:, 0][:, None]\n    Y = centers[:, 1][:, None]\n    dX = X - X.T\n    dY = Y - Y.T\n    r = np.sqrt(dX**2 + dY**2)\n    # Avoid log(0) on diagonal temporarily\n    np.fill_diagonal(r, 1.0)\n    G = -(1.0/(2.0*np.pi)) * np.log(r)\n    # Multiply each column by source element length\n    A = G * lengths[None, :]\n    # Replace diagonal with analytic self-term\n    diag = -(1.0/(2.0*np.pi)) * (lengths * (np.log(lengths/2.0) - 1.0))\n    np.fill_diagonal(A, diag)\n    return A\n\ndef solve_bem_beta(a, b, R, Nc, NR, E0, delta_frac):\n    # Discretize boundaries\n    c_centers, c_lengths = discretize_ellipse(a, b, Nc)\n    R_centers, R_lengths = discretize_circle(R, NR)\n    centers = np.vstack((c_centers, R_centers))\n    lengths = np.concatenate((c_lengths, R_lengths))\n    N = centers.shape[0]\n    # Boundary data f: 0 on conductor, -E0*x on outer boundary\n    f_conductor = np.zeros(Nc)\n    f_outer = -E0 * R_centers[:, 0]\n    f = np.concatenate((f_conductor, f_outer))\n    # Assemble matrix and solve\n    A = assemble_single_layer_matrix(centers, lengths)\n    sigma = np.linalg.solve(A, f)\n    # Evaluate gradient at tip point (a+delta, 0)\n    delta = delta_frac * a\n    x_eval = np.array([a + delta, 0.0])\n    dx = x_eval[0] - centers[:, 0]\n    dy = x_eval[1] - centers[:, 1]\n    r2 = dx*dx + dy*dy\n    # Gradient of Green's function wrt field point: -(1/(2π)) * (r_vec)/|r|^2\n    factor = -(1.0/(2.0*np.pi))\n    # Weighted by element lengths and densities\n    w = sigma * lengths\n    grad_phi_x = np.sum(w * factor * (dx / r2))\n    grad_phi_y = np.sum(w * factor * (dy / r2))\n    Ex = -grad_phi_x\n    Ey = -grad_phi_y\n    E_mag = np.sqrt(Ex*Ex + Ey*Ey)\n    beta = E_mag / E0\n    return beta\n\ndef solve():\n    # Test cases: (a, b, R, Nc, NR, E0, delta_frac)\n    test_cases = [\n        (1.0, 1.0, 10.0, 120, 180, 1.0, 0.02),\n        (2.0, 0.5, 12.0, 140, 200, 1.0, 0.02),\n        (3.0, 0.3, 15.0, 160, 220, 1.0, 0.02),\n    ]\n\n    results = []\n    for case in test_cases:\n        a, b, R, Nc, NR, E0, delta_frac = case\n        beta = solve_bem_beta(a, b, R, Nc, NR, E0, delta_frac)\n        results.append(beta)\n\n    # Print in required single-line format\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}