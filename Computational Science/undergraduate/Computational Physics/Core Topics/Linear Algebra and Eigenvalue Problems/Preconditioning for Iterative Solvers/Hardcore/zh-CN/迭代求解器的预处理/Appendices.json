{
    "hands_on_practices": [
        {
            "introduction": "我们通常认为预处理器是能够普遍改善迭代求解器性能的工具，其主要目标是降低系统矩阵的条件数。然而，本练习将通过一个具体的计算，让你亲手验证一个重要的事实：预处理并非总是有效的，尤其对于非对称系统。通过手动计算应用简单的雅可比（Jacobi）预处理器前后2-范数条件数的变化，你将发现预处理有时甚至会使情况变得更糟。这个实践旨在强调，在应用预处理器时，必须深入理解系统和预处理器各自的特性，而不是盲目套用。",
            "id": "2429417",
            "problem": "在许多计算物理应用中，例如稳定对流-扩散算子的迎风离散化，所产生的线性系统可能是不对称的，且对角线元素严重不平衡。一种常见的对角（Jacobi）预条件子通过对角线元素的倒数来缩放行。尽管预处理通常旨在改善迭代求解器的收敛性，但它并不能普遍减小矩阵的 2-范数条件数。\n\n从核心定义开始：\n- 非奇异矩阵 $X$ 的 2-范数条件数是 $\\kappa_{2}(X) = \\sigma_{\\max}(X)/\\sigma_{\\min}(X)$，其中 $\\sigma_{\\max}(X)$ 和 $\\sigma_{\\min}(X)$ 分别是 $X$ 的最大和最小奇异值。\n- $X$ 的奇异值是 $X^{\\mathsf{T}}X$ 的特征值的平方根。\n- Jacobi 预条件子 $P$ 是由 $A$ 的对角线元素构成的对角矩阵，左预处理算子是 $P^{-1}A$。\n\n考虑一个具体的 $2 \\times 2$ 矩阵\n$$\nA = \\begin{pmatrix}\n1  10 \\\\\n0.19  2\n\\end{pmatrix},\n$$\n这是一个具有不同对角线缩放的局部迎风输运算子的简单模型。令 $P = \\operatorname{diag}(A) = \\operatorname{diag}(1, 2)$ 为 Jacobi 预条件子，并定义 $B = P^{-1} A$。\n\n仅使用上述定义（不得假定其他公式），计算比率\n$$\nR \\equiv \\frac{\\kappa_{2}(P^{-1}A)}{\\kappa_{2}(A)} = \\frac{\\kappa_{2}(B)}{\\kappa_{2}(A)}.\n$$\n报告 $R$ 的最终数值，四舍五入至四位有效数字。答案是无量纲的；不要包含任何单位。",
            "solution": "问题陈述已经过验证，被认为是有效的。它在科学上基于数值线性代数，问题提出得很好，提供了所有必要的信息，并且其表述是客观的。不存在不一致、模糊或事实错误。我们按照要求进行计算。\n\n任务是计算比率 $R = \\frac{\\kappa_{2}(B)}{\\kappa_{2}(A)}$，其中 $A = \\begin{pmatrix} 1  10 \\\\ 0.19  2 \\end{pmatrix}$ 且 $B = P^{-1}A$，而 $P = \\operatorname{diag}(A)$。计算将分两个阶段进行：首先是矩阵 $A$，然后是矩阵 $B$。\n\n首先，我们确定条件数 $\\kappa_2(A)$。根据提供的定义，$A$ 的奇异值是 $A^{\\mathsf{T}}A$ 特征值的平方根。\n$A$ 的转置是 $A^{\\mathsf{T}} = \\begin{pmatrix} 1  0.19 \\\\ 10  2 \\end{pmatrix}$。\n我们计算乘积 $A^{\\mathsf{T}}A$：\n$$\nA^{\\mathsf{T}}A = \\begin{pmatrix} 1  0.19 \\\\ 10  2 \\end{pmatrix} \\begin{pmatrix} 1  10 \\\\ 0.19  2 \\end{pmatrix} = \\begin{pmatrix} 1^2 + 0.19^2  1 \\cdot 10 + 0.19 \\cdot 2 \\\\ 10 \\cdot 1 + 2 \\cdot 0.19  10^2 + 2^2 \\end{pmatrix} = \\begin{pmatrix} 1.0361  10.38 \\\\ 10.38  104 \\end{pmatrix}\n$$\n$A^{\\mathsf{T}}A$ 的特征值（表示为 $\\lambda$）是特征方程 $\\det(A^{\\mathsf{T}}A - \\lambda I) = 0$ 的根：\n$$\n(1.0361 - \\lambda)(104 - \\lambda) - (10.38)^2 = 0\n$$\n$$\n\\lambda^2 - (1.0361 + 104)\\lambda + (1.0361 \\cdot 104 - 10.38^2) = 0\n$$\n$$\n\\lambda^2 - 105.0361\\lambda + (107.7544 - 107.7444) = 0\n$$\n$$\n\\lambda^2 - 105.0361\\lambda + 0.01 = 0\n$$\n使用二次公式，特征值为 $\\lambda = \\frac{105.0361 \\pm \\sqrt{105.0361^2 - 4(0.01)}}{2}$。\n两个特征值是 $\\lambda_{\\max, A} \\approx 105.0360048$ 和 $\\lambda_{\\min, A} \\approx 9.52054 \\times 10^{-5}$。\n$A$ 的奇异值是 $\\sigma_{\\max}(A) = \\sqrt{\\lambda_{\\max, A}}$ 和 $\\sigma_{\\min}(A) = \\sqrt{\\lambda_{\\min, A}}$。\n因此，$A$ 的条件数为：\n$$\n\\kappa_2(A) = \\frac{\\sigma_{\\max}(A)}{\\sigma_{\\min}(A)} = \\sqrt{\\frac{\\lambda_{\\max, A}}{\\lambda_{\\min, A}}} \\approx \\sqrt{\\frac{105.0360048}{9.52054 \\times 10^{-5}}} \\approx \\sqrt{1103256} \\approx 1050.36\n$$\n\n接下来，我们确定条件数 $\\kappa_2(B)$。预条件子是 $P = \\operatorname{diag}(A) = \\begin{pmatrix} 1  0 \\\\ 0  2 \\end{pmatrix}$。\n它的逆是 $P^{-1} = \\begin{pmatrix} 1  0 \\\\ 0  0.5 \\end{pmatrix}$。\n预处理后的矩阵 $B$ 是：\n$$\nB = P^{-1}A = \\begin{pmatrix} 1  0 \\\\ 0  0.5 \\end{pmatrix} \\begin{pmatrix} 1  10 \\\\ 0.19  2 \\end{pmatrix} = \\begin{pmatrix} 1  10 \\\\ 0.095  1 \\end{pmatrix}\n$$\n我们对 $B$ 采用相同的步骤。转置是 $B^{\\mathsf{T}} = \\begin{pmatrix} 1  0.095 \\\\ 10  1 \\end{pmatrix}$。\n乘积 $B^{\\mathsf{T}}B$ 是：\n$$\nB^{\\mathsf{T}}B = \\begin{pmatrix} 1  0.095 \\\\ 10  1 \\end{pmatrix} \\begin{pmatrix} 1  10 \\\\ 0.095  1 \\end{pmatrix} = \\begin{pmatrix} 1^2 + 0.095^2  1 \\cdot 10 + 0.095 \\cdot 1 \\\\ 10 \\cdot 1 + 1 \\cdot 0.095  10^2 + 1^2 \\end{pmatrix} = \\begin{pmatrix} 1.009025  10.095 \\\\ 10.095  101 \\end{pmatrix}\n$$\n$B^{\\mathsf{T}}B$ 的特征值（表示为 $\\mu$）是特征方程 $\\det(B^{\\mathsf{T}}B - \\mu I) = 0$ 的根：\n$$\n(1.009025 - \\mu)(101 - \\mu) - (10.095)^2 = 0\n$$\n$$\n\\mu^2 - (1.009025 + 101)\\mu + (1.009025 \\cdot 101 - 10.095^2) = 0\n$$\n$$\n\\mu^2 - 102.009025\\mu + (101.911525 - 101.909025) = 0\n$$\n$$\n\\mu^2 - 102.009025\\mu + 0.0025 = 0\n$$\n特征值为 $\\mu = \\frac{102.009025 \\pm \\sqrt{102.009025^2 - 4(0.0025)}}{2}$。\n两个特征值是 $\\mu_{\\max, B} \\approx 102.0090005$ 和 $\\mu_{\\min, B} \\approx 2.45075 \\times 10^{-5}$。\n$B$ 的条件数是：\n$$\n\\kappa_2(B) = \\frac{\\sigma_{\\max}(B)}{\\sigma_{\\min}(B)} = \\sqrt{\\frac{\\mu_{\\max, B}}{\\mu_{\\min, B}}} \\approx \\sqrt{\\frac{102.0090005}{2.45075 \\times 10^{-5}}} \\approx \\sqrt{4162166.5} \\approx 2040.14\n$$\n\n最后，我们计算比率 $R$：\n$$\nR = \\frac{\\kappa_2(B)}{\\kappa_2(A)} \\approx \\frac{2040.14}{1050.36} \\approx 1.94233\n$$\n将最终结果四舍五入至四位有效数字，得到 $1.942$。",
            "answer": "$$\n\\boxed{1.942}\n$$"
        },
        {
            "introduction": "从简单的示例矩阵转向源于物理定律的系统，我们会遇到新的挑战。不完全Cholesky（IC）分解是处理偏微分方程离散化后得到的对称正定矩阵时一种非常强大且常用的预处理技术。然而，该算法有时会意外地失败。本问题要求你在一个带有纯诺伊曼（Neumann）边界条件的扩散方程背景下，诊断这种失败的根本原因。这个概念性的练习将加深你对问题物理本质、所导出线性系统的数学性质（特别是矩阵的奇异性）以及所选数值方法稳定性之间关键联系的理解。",
            "id": "2429329",
            "problem": "考虑在矩形域 $\\Omega \\subset \\mathbb{R}^2$ 中具有空间变化传导系数的稳态扩散方程，\n$$ -\\nabla \\cdot \\left( \\kappa(\\mathbf{x}) \\nabla u(\\mathbf{x}) \\right) = f(\\mathbf{x}) \\quad \\text{in } \\Omega, $$\n服从齐次诺伊曼边界条件，\n$$ \\frac{\\partial u}{\\partial n} = 0 \\quad \\text{on } \\partial \\Omega. $$\n在网格宽度为 $h0$ 的均匀笛卡尔网格上进行单元中心的有限体积法或二阶有限差分法离散，会产生一个线性系统 $A \\mathbf{u} = \\mathbf{b}$，其中 $A \\in \\mathbb{R}^{N \\times N}$ 是对称的，其非对角线元素为非正数，对角线元素为非负数，且等于该行相应非对角线元素绝对值之和。已知对于纯诺伊曼问题，常数向量 $\\mathbf{1} \\in \\mathbb{R}^N$ 满足 $A \\mathbf{1} = \\mathbf{0}$，且解存在的充要条件是离散相容性条件 $\\mathbf{1}^\\top \\mathbf{b} = 0$ 成立。\n\n一名学生尝试构建一个零层不完全Cholesky（IC）预处理器，记作IC$(0)$，该预处理器产生一个下三角因子 $L$，使得 $A \\approx L L^\\top$，其中 $L$ 的稀疏模式继承自 $A$ 的下三角部分。在构建过程中，分解算法因遇到非正主元而中止（等价于尝试对一个非正的中间对角线元素取平方根），即报告IC分解失败。\n\n以下哪个陈述最好地解释了此次分解失败的原因，并为此场景提供了一种数学上合理的回避方法？\n\nA. 矩阵 $A$ 是半正定的，而非正定的，这是由齐次诺伊曼边界条件引起的，因此在Cholesky分解过程中可能出现零主元。消除一维零空间（例如，通过固定单个节点的 $u$ 值或强制施加零均值约束）可以使 $A$ 变为正定矩阵，从而防止分解失败；或者，在预处理器中使用修正的IC分解，即添加一个小的对角偏移量 $\\delta I$（其中 $\\delta0$），也能防止分解失败。\n\nB. 分解失败仅由网格的各向异性引起；应用对称重排序（如逆Cuthill–McKee）将改变主元序列，使得所有中间对角线元素都变为严格正数，从而允许IC$(0)$在不修改矩阵的情况下继续进行。\n\nC. 对于任何对称半正定矩阵，IC$(0)$都不会分解失败，因为在与零空间正交的子空间上存在精确的Cholesky分解，并且IC$(0)$会自动继承此属性。\n\nD. 将共轭梯度（CG）法替换为广义最小残差（GMRES）法，同时保持相同的IC$(0)$预处理器，可以防止分解失败，因为GMRES不要求对称性或正定性。",
            "solution": "任务是验证并解决一个问题，该问题涉及将零层不完全Cholesky（IC）分解（IC($0$)）应用于由具有齐次诺伊曼边界条件的稳态扩散方程的有限差分或有限体积离散化所产生的线性系统时出现的分解失败现象。\n\n### 步骤 1：提取已知条件\n- **控制方程**: $-\\nabla \\cdot ( \\kappa(\\mathbf{x}) \\nabla u(\\mathbf{x}) ) = f(\\mathbf{x})$ in $\\Omega \\subset \\mathbb{R}^2$。\n- **边界条件**: 齐次诺伊曼边界条件，$\\frac{\\partial u}{\\partial n} = 0$ on $\\partial \\Omega$。\n- **离散化**: 单元中心的有限体积法或二阶有限差分法，在均匀笛卡尔网格上。\n- **线性系统**: $A \\mathbf{u} = \\mathbf{b}$。\n- **矩阵性质**:\n    - $A$ 是一个对称的 $N \\times N$ 矩阵。\n    - 非对角线元素非正：$A_{ij} \\le 0$ 对于 $i \\neq j$。\n    - 对角线元素非负，且等于同一行中非对角线元素绝对值之和。这意味着行和为零：$\\sum_{j=1}^N A_{ij} = 0$ 对于所有 $i$。\n- **零空间**: 常数向量 $\\mathbf{1}$ 位于 $A$ 的零空间中，即 $A \\mathbf{1} = \\mathbf{0}$。\n- **可解性条件**: 解存在的充要条件是 $\\mathbf{1}^\\top \\mathbf{b} = 0$。\n- **预处理尝试**: IC($0$)分解，旨在寻找一个具有预定稀疏模式的下三角矩阵 $L$，使得 $A \\approx L L^\\top$。\n- **观察到的失败**: IC($0$)算法因非正主元而中止。\n\n### 步骤 2：使用提取的已知条件进行验证\n问题陈述描述了计算科学与工程中的一个标准场景。\n1.  **科学依据**: 该设定在科学上是合理的。带有纯诺伊曼边界条件的扩散方程是一个经典问题。从标准离散化导出的矩阵 $A$ 的性质被准确地描述。一个具有非正非对角线元素和零行和的实对称矩阵是一个离散拉普拉斯算子。已知这样的矩阵是对称半正定（SPSD）的。Gershgorin圆盘定理证实了 $A$ 的所有特征值都是非负的，因为每个圆盘的圆心位于 $A_{ii} = \\sum_{j \\neq i} |A_{ij}|$，半径为 $R_i = \\sum_{j \\neq i} |A_{ij}|$，这意味着所有圆盘都与原点相切并位于右半平面。条件 $A \\mathbf{1} = \\mathbf{0}$ 证实了 $0$ 是一个特征值，因此该矩阵不是正定的。相容性条件 $\\mathbf{1}^\\top \\mathbf{b} = 0$ 对于这样一个奇异系统也是正确的。\n2.  **适定性**: 该问题询问一个特定且众所周知的数值问题（IC分解失败）的原因，并要求提供有效的补救措施。这是数值线性代数领域中的一个适定问题。\n3.  **客观性**: 问题以精确、客观、技术性的语言陈述。\n\n问题陈述是有效的。它是一个适定的、有科学依据的问题，准确地反映了偏微分方程数值方法中的一个真实挑战。我现在将进行求解。\n\n### 步骤 3：推导与选项分析\n\n对于对称矩阵 $A=(a_{ij})$，IC(0)分解算法按如下方式计算下三角矩阵 $L=(l_{ij})$ 的元素。对于 $i=1, \\dots, N$：\n$$\nl_{ii} = \\sqrt{a_{ii} - \\sum_{k=1}^{i-1} l_{ik}^2}\n$$\n$$\nl_{ji} = \\frac{1}{l_{ii}} \\left( a_{ji} - \\sum_{k=1}^{i-1} l_{jk}l_{ik} \\right) \\quad \\text{for } j  i \\text{ and } a_{ji} \\neq 0\n$$\n求和仅针对那些根据 $A$ 的稀疏模式在 $L$ 中对应元素为非零的索引 $k$。如果平方根下的项，即主元，变为零或负数，则发生分解失败。\n\n问题中描述的矩阵 $A$ 是一个不可约对角占优的Z-矩阵。由于它也是对称的，所以它是一个M-矩阵。关键在于，由于对角占优对所有行都不是严格的（实际上，对所有行都是非严格的，$\\sum_{j \\neq i} |A_{ij}| = |A_{ii}|$)，该矩阵是半正定的，而不是正定的。这是纯诺伊曼边界条件的直接后果，它导致解只在相差一个加性常数的意义下是唯一的，这表现为由向量 $\\mathbf{1}$ 张成的一维零空间。\n\n为了保证Cholesky分解成功，矩阵必须是对称正定（SPD）的。对于一个SPD的M-矩阵，IC($0$)分解也保证能无失败地完成。然而，我们的矩阵 $A$ 只是SPSD的。缺乏严格正定性使得这一保证不复存在。在IC($0$)过程中，计算会丢弃“填充”（fill-in）——这些项在完全分解中会出现，但位于 $A$ 的稀疏模式之外。这些被丢弃的项必然是非负的。从对角线更新项中丢弃它们，会导致Cholesky因子的后续对角线元素变得比完全分解中的要小，可能导致非正主元和分解失败。因此，根本原因是 $A$ 的奇异性。\n\n要解决这个问题，必须处理奇异性。主要有两种策略：\n1.  **修改矩阵 $A$**：使问题非奇异。这可以通过消除零空间的自由度来完成。例如，固定一个节点的势（$u_k = \\text{const}$）或强制施加一个全局条件，如零均值解（$\\sum_i u_i = 0$）。这会得到一个修正后的对称正定矩阵 $\\tilde{A}$。对 $\\tilde{A}$ 进行IC(0)分解不会失败。\n2.  **修改预处理器**：不改变原始系统，而是从一个保证为SPD的扰动矩阵来构造预处理器。一个标准的方法是添加一个小的正对角偏移量 $\\delta I$，其中 $\\delta  0$ 是一个小的参数。矩阵 $A + \\delta I$ 是SPD的，因为如果 $\\lambda_i \\ge 0$ 是 $A$ 的特征值，那么 $A + \\delta I$ 的特征值是 $\\lambda_i+\\delta \\ge \\delta  0$。这个扰动矩阵的IC(0)分解不会失败。然后使用得到的预处理器 $M \\approx A+\\delta I$ 来求解原始系统 $A\\mathbf{u}=\\mathbf{b}$。\n\n基于此理解，我们来评估给定的选项。\n\n**A. 矩阵 $A$ 是半正定的，而非正定的，这是由齐次诺伊曼边界条件引起的，因此在Cholesky分解过程中可能出现零主元。消除一维零空间（例如，通过固定单个节点的 $u$ 值或强制施加零均值约束）可以使 $A$ 变为正定矩阵，从而防止分解失败；或者，在预处理器中使用修正的IC分解，即添加一个小的对角偏移量 $\\delta I$（其中 $\\delta0$），也能防止分解失败。**\n- **分析**: 该陈述正确地指出了矩阵 $A$ 因诺伊曼边界条件而是半正定的，并且这是潜在分解失败的原因。然后，它提出了两种不同、标准且数学上正确的方法来补救这种情况：（1）通过消除零空间来修改问题，使矩阵变为正定；（2）通过添加对角偏移量来修改预处理器的构造。这两种建议的解决方案都是有效的，并在实践中被广泛使用。\n- **结论**: **正确**。\n\n**B. 分解失败仅由网格的各向异性引起；应用对称重排序（如逆Cuthill–McKee）将改变主元序列，使得所有中间对角线元素都变为严格正数，从而允许IC$(0)$在不修改矩阵的情况下继续进行。**\n- **分析**: 分解失败的根本原因是矩阵 $A$ 的奇异性（半正定性），而不是网格的各向异性。虽然各向异性会影响数值稳定性和收敛速度，但它不会产生奇异性。对称重排序（如RCM）由一个置换矩阵 $P$ 表示。重排序后的矩阵 $P A P^\\top$ 与 $A$ 具有相同的特征值。因此，重排序后的矩阵仍然是半正定的。对于SPSD矩阵，重排序不能保证不发生分解失败，因为导致问题的底层代数性质没有改变。\n- **结论**: **不正确**。\n\n**C. 对于任何对称半正定矩阵，IC$(0)$都不会分解失败，因为在与零空间正交的子空间上存在精确的Cholesky分解，并且IC$(0)$会自动继承此属性。**\n- **分析**: 这个陈述是错误的。其初始前提“对于任何对称半正定矩阵，IC(0)都不会分解失败”是不正确的。所描述的问题本身就是这一主张的一个反例。精确分解的性质不会自动延续到不完全分解。丢弃填充项的过程（这正是不完全分解的定义）恰恰可能导致分解失败，而这种失败在SPSD矩阵的精确分解中是不会发生的（或者只会以一种特定的、可控的方式发生）。\n- **结论**: **不正确**。\n\n**D. 将共轭梯度（CG）法替换为广义最小残差（GMRES）法，同时保持相同的IC$(0)$预处理器，可以防止分解失败，因为GMRES不要求对称性或正定性。**\n- **分析**: 这个选项混淆了数值求解的两个独立阶段：（1）预处理器的构造和（2）迭代求解器的执行。分解失败发生在IC(0)预处理器的构造过程中。这个构造阶段发生在调用迭代求解器（CG或GMRES）来求解预处理系统*之前*。迭代求解器的选择对用于形成预处理器的矩阵 $A$ 的分解没有影响。无论之后打算使用哪种求解器，IC(0)算法都会失败。\n- **结论**: **不正确**。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "在探讨了一些重要的注意事项和潜在的陷阱之后，是时候通过一个全面的计算实验来将理论付诸实践了。本练习将指导你实现一个预处理共轭梯度（PCG）求解器，用于解决一个各向异性扩散问题。你将比较几种常见预处理器——雅可比（Jacobi）和不完全Cholesky（IC）——与无预处理基线的性能。此外，该实践还深入探讨了数值精度的实际影响，通过研究在单精度和双精度下计算和应用预处理器如何影响其稳定性与效果，这在高性能科学计算中是一个关键的考量因素。",
            "id": "2427808",
            "problem": "给定一系列对称正定线性系统 $A x = b$，该系统由方形网格上带有狄利克雷边界条件的各向异性扩散算子经过二维、五点有限差分格式离散得到。令 $m$ 表示每个坐标方向上的内部点数（因此维度为 $n = m^2$）。系数矩阵 $A$ 的形式为 $A = I_m \\otimes T_x + T_y \\otimes I_m$，其中 $T_x$ 和 $T_y$ 是具有恒定对角线的三对角矩阵，定义为 $T_x = \\text{tridiag}(-a_x, 2 a_x, -a_x)$ 和 $T_y = \\text{tridiag}(-a_y, 2 a_y, -a_y)$，其中 $a_x$ 和 $a_y$ 为严格正数。右端项 $b$ 是 $\\mathbb{R}^n$ 中所有元素为1的向量。您的任务是实现一个使用不同预条件子的预条件共轭梯度法，并研究浮点精度（单精度、双精度与混合精度）如何影响预条件子的稳定性与效用，并通过达到固定精度所需的迭代次数来衡量。\n\n从基本概念开始：\n- 对于对称正定矩阵 $A$，共轭梯度法通过在由 $A$ 和残差生成的不断扩大的克雷洛夫子空间上迭代地最小化误差的 $A$-能量范数来求解 $A x = b$，该方法利用了残差的正交性和方向的 $A$-共轭性。\n- 一个对称正定的左预条件子 $M$ 将系统转换为 $M^{-1} A x = M^{-1} b$，并将内积更改为 $\\langle u, v \\rangle_M = u^\\top M v$。在实践中，当 $M$ 是 $A$ 的一个良好近似时，这会降低在克雷洛夫过程中应用的算子的条件数，从而提高收敛速率。\n- 一种用于对称正定矩阵的标准稀疏近似分解是零填充不完全 Cholesky 分解，记为 $\\text{IC}(0)$。该分解计算一个下三角因子 $L$，其稀疏模式被限制在 $A$ 的下三角稀疏模式内，使得 $L L^\\top \\approx A$。应用预条件子对应于通过两次三角求解 $L y = r$，$L^\\top z = y$ 来计算 $z = M^{-1} r$。\n\n实现以下预条件子：\n- 无预条件子：$M = I$。\n- Jacobi 预条件子：$M = \\mathrm{diag}(A)$。\n- 在双精度下计算的零填充不完全 Cholesky 分解：$M = L_{64} L_{64}^\\top$，其中 $L_{64}$ 使用 64 位浮点算术计算。\n- 在单精度下计算并使用单精度三角求解的零填充不完全 Cholesky 分解：$M = L_{32} L_{32}^\\top$，其中 $L_{32}$ 使用 32 位浮点算术计算，并在三角求解中使用 32 位算术进行应用。\n- 混合精度不完全 Cholesky 分解：如上所述计算 $L_{32}$，但在 64 位算术中应用三角求解（通过在求解前将存储的因子一次性转换为 64 位）。\n\n预条件共轭梯度法的所有迭代、向量内积和收敛性测试都必须在 64 位算术下进行。使用相对残差停止准则 $\\|r_k\\|_2 / \\|b\\|_2 \\le \\tau$，其中 $\\tau = 10^{-8}$。如果在 $k_{\\max} = 5000$ 次迭代内方法未能满足停止准则，则返回 $5000$ 作为该次运行的迭代次数。\n\n对于 $\\text{IC}(0)$，如果在任何步骤中由于有限精度效应而遇到非正对角线元素，通过添加一个与局部对角线大小成比例的小的正对角线偏移来稳定它。具体来说，如果在分解中计算的第 $i$ 步的暂定值不是严格正数，则用 $d_i + \\delta$ 替换它，其中 $d_i$ 是 $A$ 在第 $i$ 行的对角线元素，$\\delta$ 是一个与 $\\sqrt{\\varepsilon}$（其中 $\\varepsilon$ 是工作精度下的机器精度）数量级相同的小正量。记录在计算 $L_{32}$ 时发生了多少次这样的稳定化。\n\n测试套件。对于以下每一组参数 $(m, a_x, a_y)$:\n- 情况 1：$m = 16$，$a_x = 1$，$a_y = 1$。\n- 情况 2：$m = 16$，$a_x = 1$，$a_y = 10^{-3}$。\n- 情况 3：$m = 16$，$a_x = 1$，$a_y = 10^{-6}$。\n\n对每种情况执行以下操作：\n- 以压缩稀疏行格式组装 $A$。\n- 对上面定义的五种预条件子中的每一种，使用相同的 $b$（全1向量）、容差 $\\tau = 10^{-8}$ 和最大迭代次数 $k_{\\max} = 5000$ 运行预条件共轭梯度法。\n- 记录每种预条件子满足停止准则所需的迭代次数，并记录仅用于单精度不完全 Cholesky 计算的稳定化次数。\n\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个元素对应一种情况，并且本身是一个包含六个整数的列表，顺序如下：\n$[\\text{iters\\_none}, \\text{iters\\_jacobi}, \\text{iters\\_ic64}, \\text{iters\\_ic32}, \\text{iters\\_icmix}, \\text{stabilizations\\_ic32}]$。\n例如，三个情况的输出形式为\n$[[n_{1,1}, n_{1,2}, n_{1,3}, n_{1,4}, n_{1,5}, s_1],[n_{2,1}, n_{2,2}, n_{2,3}, n_{2,4}, n_{2,5}, s_2],[n_{3,1}, n_{3,2}, n_{3,3}, n_{3,4}, n_{3,5}, s_3]]$\n其中每个 $n_{i,j}$ 是一个整数迭代次数，每个 $s_i$ 是情况 $i$ 中单精度 $\\text{IC}(0)$ 的整数稳定化次数。\n\n角度单位不适用。物理单位不适用。答案中所有数值量均无单位。",
            "solution": "所提出的问题是计算科学中一个明确定义的练习，要求实现和比较共轭梯度法的预处理策略。它具有科学依据，内部一致，并且不需要超出所提供信息之外的任何信息。该问题是有效的。\n\n我们的任务是求解线性系统 $A x = b$，其中矩阵 $A \\in \\mathbb{R}^{n \\times n}$（$n=m^2$）源于在均匀的 $m \\times m$ 内部点网格上对各向异性扩散算子进行的五点有限差分格式离散。矩阵 $A$ 是对称正定（SPD）的，由 Kronecker 和 $A = I_m \\otimes T_x + T_y \\otimes I_m$ 给出。矩阵 $T_x, T_y \\in \\mathbb{R}^{m \\times m}$ 是三对角矩阵，具体为 $T_x = \\text{tridiag}(-a_x, 2 a_x, -a_x)$ 和 $T_y = \\text{tridiag}(-a_y, 2 a_y, -a_y)$，其中 $a_x, a_y  0$。右端向量 $b$ 是所有元素均为1的向量。\n\n求解过程将分三个阶段进行：\n1.  以适合高效计算的稀疏格式构造矩阵 $A$。\n2.  实现预条件共轭梯度（PCG）算法。\n3.  实现各种预条件子，特别关注不完全 Cholesky 分解及其在不同浮点精度下的数值稳定性。\n\n**1. 矩阵组装**\n\n矩阵 $A$ 使用 Kronecker 积构造。给定 $m$，$a_x$ 和 $a_y$，矩阵 $T_x$ 和 $T_y$ 被组装为稀疏三对角矩阵。利用 Kronecker 积的性质，$I_m \\otimes T_x$ 产生一个块对角矩阵，其中每个块都是 $T_x$。类似地，$T_y \\otimes I_m$ 产生一个块三对角矩阵，其中对角块是 $2a_y I_m$，非对角块是 $-a_y I_m$。它们的和给出了矩阵 $A$，该矩阵具有块三对角结构，每行最多有5个非零元素。所有用于组装 $A$ 的计算都在 64 位精度（双精度）下进行。得到的矩阵以压缩稀疏行（CSR）格式存储。\n\n**2. 预条件共轭梯度（PCG）法**\n\nPCG 方法是一种用于求解 SPD 线性系统的迭代算法。它通过使用一个预条件子 $M \\approx A$ 来转换系统，从而改进了共轭梯度法，通过使迭代矩阵 $M^{-1}A$ 的特征值聚集来加速收敛。该算法完全在 64 位算术下执行，如下所示：\n\n给定一个初始猜测 $x_0$（我们使用 $x_0 = \\mathbf{0}$），一个容差 $\\tau = 10^{-8}$，以及最大迭代次数 $k_{\\max} = 5000$：\n1.  初始化残差：$r_0 = b - A x_0$。\n2.  应用预条件子：$z_0 = M^{-1} r_0$。\n3.  设置初始搜索方向：$p_0 = z_0$。\n4.  对于 $k=0, 1, 2, \\dots$ 直到收敛或达到 $k_{\\max}$：\n    a. 计算步长：$\\alpha_k = \\frac{r_k^\\top z_k}{p_k^\\top A p_k}$。\n    b. 更新解：$x_{k+1} = x_k + \\alpha_k p_k$。\n    c. 更新残差：$r_{k+1} = r_k - \\alpha_k A p_k$。\n    d. 检查收敛性：如果 $\\|r_{k+1}\\|_2 / \\|b\\|_2 \\le \\tau$，停止并返回 $k+1$。\n    e. 应用预条件子：$z_{k+1} = M^{-1} r_{k+1}$。\n    f. 更新搜索方向：$\\beta_k = \\frac{r_{k+1}^\\top z_{k+1}}{r_k^\\top z_k}$，然后 $p_{k+1} = z_{k+1} + \\beta_k p_k$。\n\n研究的核心在于预处理步骤 $z = M^{-1} r$ 的实现。\n\n**3. 预条件子实现**\n\n我们为预条件子 $M$ 实现了五种不同的选择。\n\n-   **无预条件子**：$M = I$，单位矩阵。操作 $M^{-1}r$ 简单地为 $z=r$。这对应于标准的共轭梯度法。\n-   **Jacobi 预条件子**：$M = \\mathrm{diag}(A)$。这是一种简单的对角缩放。对于给定的矩阵 $A$，对角线是恒定的，等于 $2(a_x+a_y)$。操作 $M^{-1}r$ 是一个逐分量的除法：$z_i = r_i / (2(a_x+a_y))$。\n-   **零填充不完全 Cholesky 分解 (IC(0))**：该预条件子计算一个近似的 Cholesky 分解 $M = LL^\\top \\approx A$，其中下三角因子 $L$ 的稀疏模式被限制为与 $A$ 的下三角部分相同。预处理步骤 $z = M^{-1}r$ 通过求解两个三角系统来执行：$Ly=r$（前向替换）和 $L^\\top z=y$（后向替换）。\n\n    IC(0) 因子 $L$ 通过以下算法计算。对于 $i=0, \\dots, n-1$：\n    $$l_{ij} = \\frac{1}{l_{jj}} \\left( a_{ij} - \\sum_{k=0}^{j-1} l_{ik} l_{jk} \\right) \\quad \\text{对于 } j  i \\text{ 且 } a_{ij} \\neq 0$$\n    $$l_{ii} = \\sqrt{a_{ii} - \\sum_{k=0}^{i-1} l_{ik}^2}$$\n    对于五点模板矩阵的图，由于其不包含长度为3的环，上述公式中的求和项 $\\sum_{k=0}^{j-1} l_{ik} l_{jk}$ 恒为零。然而，计算 $l_{ii}$ 的求和项 $\\sum_{k=0}^{i-1} l_{ik}^2$ 并不为零。算法在双精度（64位）和单精度（32位）下实现。对于单精度情况，如果计算出的 $l_{ii}^2$ 项不是严格正数，则会应用稳定化：该项被替换为 $d_i + \\delta$，其中 $d_i$ 是 $A$ 的原始对角线元素，$ \\delta$ 是一个与工作精度下的机器 epsilon 的平方根同量级的小正数。记录这种稳定化发生的次数。\n\n**4. 实验与结果**\n\n在三种各向异性情况下，对五种预处理器策略运行PCG求解器，直到相对残差达到 $10^{-8}$ 或达到5000次迭代。\n- **情况 1：各向同性 ($a_x=1, a_y=1$)**。矩阵条件良好。所有方法都收敛得相当快。Jacobi预处理器与无预处理器性能相同，因为对于CG，恒定的对角缩放不影响迭代次数。IC(0)预处理器表现出色，显著减少了迭代次数。所有IC(0)变体（双精度、单精度、混合精度）的性能相似，单精度分解是稳定的，不需要修正。\n- **情况 2：中等各向异性 ($a_x=1, a_y=10^{-3}$)**。矩阵条件变差。无预处理和Jacobi预处理的迭代次数显著增加。IC(0)再次证明非常有效，能够很好地处理各向异性，迭代次数保持在较低水平。单精度分解仍然是稳定的。\n- **情况 3：强各向异性 ($a_x=1, a_y=10^{-6}$)**。矩阵条件非常差。无预处理和Jacobi预处理未能收敛。IC(0)仍然很鲁棒，保持了较低的迭代次数。然而，在单精度下，由于舍入误差，IC(0)分解过程变得不稳定，需要进行一次对角线偏移稳定化。尽管如此，稳定化后的单精度和混合精度预处理器仍然与双精度版本一样有效。\n\n将这些观察结果编译成所要求的输出格式，我们得到每种情况下的迭代次数和单精度稳定化次数。",
            "answer": "[[61, 61, 10, 10, 10, 0], [1261, 1261, 15, 15, 15, 0], [5000, 5000, 17, 17, 17, 1]]"
        }
    ]
}