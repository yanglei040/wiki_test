{
    "hands_on_practices": [
        {
            "introduction": "掌握稀疏矩阵的第一步是理解其存储结构。本练习将从最基础的任务开始：从压缩稀疏行（CSR）格式的数据中重建原始的稠密矩阵。通过这个过程，你将加深对值（$V$）、列索引（$C$）和行指针（$R$）这三个核心数组如何协同工作以编码矩阵结构的理解，这就像学习阅读稀疏矩阵的语言。",
            "id": "2204554",
            "problem": "在许多科学和工程应用中，矩阵通常是“稀疏”的，这意味着它们的大部分元素为零。存储所有这些零是低效的。压缩稀疏行（CSR）格式是一种通过使用三个一维数组来存储稀疏矩阵的常用方法。\n\n考虑一个大小为 $4 \\times 4$ 的稀疏矩阵 $A$。在 CSR 格式（使用基于 0 的索引）中，该矩阵由以下三个数组表示：\n1.  数组 `V`，包含 $A$ 的非零元素，按行从左到右读取。\n2.  数组 `C`，包含 `V` 中每个对应元素的列索引。\n3.  数组 `R`（行指针），大小为 $m+1$（其中 $m$ 是行数），其中第 $i$ 个元素指示 `V` 和 `C` 中第 $i$ 行数据开始的索引。`R` 的最后一个元素是非零元素的总数。\n\n我们的 $4 \\times 4$ 矩阵 $A$ 的三个数组如下：\n- `V = [5.1, -1.2, 2.0, -3.5, 4.0, 9.8]`\n- `C = [1, 3, 0, 2, 3, 0]`\n- `R = [0, 2, 3, 5, 6]`\n\n重建原始的 $4 \\times 4$ 稠密矩阵 $A$。将您的答案表示为一个 $4 \\times 4$ 的矩阵。",
            "solution": "我们使用基于 0 索引的 CSR 定义。对于每个行索引 $i \\in \\{0,1,2,3\\}$，第 $i$ 行的非零条目存储在 `V` 和 `C` 中索引从 $R[i]$ 到 $R[i+1]-1$ 的片段中，其中列索引为 $C[j]$，值为 $V[j]$。最后一个元素 $R[4]=6$ 等于非零元素的总数，这与 $\\lvert V \\rvert=6$ 相匹配。\n\n第 $0$ 行：索引 $j=R[0]\\ldots R[1]-1=0\\ldots 1$。\n- $j=0$：$C[0]=1$, $V[0]=5.1$ 得到 $A_{0,1}=5.1$。\n- $j=1$：$C[1]=3$, $V[1]=-1.2$ 得到 $A_{0,3}=-1.2$。\n因此第 $0$ 行为 $[0,\\,5.1,\\,0,\\,-1.2]$。\n\n第 $1$ 行：索引 $j=R[1]\\ldots R[2]-1=2\\ldots 2$。\n- $j=2$：$C[2]=0$, $V[2]=2.0$ 得到 $A_{1,0}=2.0$。\n因此第 $1$ 行为 $[2.0,\\,0,\\,0,\\,0]$。\n\n第 $2$ 行：索引 $j=R[2]\\ldots R[3]-1=3\\ldots 4$。\n- $j=3$：$C[3]=2$, $V[3]=-3.5$ 得到 $A_{2,2}=-3.5$。\n- $j=4$：$C[4]=3$, $V[4]=4.0$ 得到 $A_{2,3}=4.0$。\n因此第 $2$ 行为 $[0,\\,0,\\,-3.5,\\,4.0]$。\n\n第 $3$ 行：索引 $j=R[3]\\ldots R[4]-1=5\\ldots 5$。\n- $j=5$：$C[5]=0$, $V[5]=9.8$ 得到 $A_{3,0}=9.8$。\n因此第 $3$ 行为 $[9.8,\\,0,\\,0,\\,0]$。\n\n因此，重建的稠密矩阵 $A$ 为\n$$\n\\begin{pmatrix}\n0  5.1  0  -1.2 \\\\\n2.0  0  0  0 \\\\\n0  0  -3.5  4.0 \\\\\n9.8  0  0  0\n\\end{pmatrix}.\n$$",
            "answer": "$$\\boxed{\\begin{pmatrix}0  5.1  0  -1.2 \\\\ 2.0  0  0  0 \\\\ 0  0  -3.5  4.0 \\\\ 9.8  0  0  0\\end{pmatrix}}$$"
        },
        {
            "introduction": "稀疏格式的真正威力在于能够直接进行计算，而无需构建内存消耗巨大的稠密矩阵。本练习将挑战一个在科学计算算法中至关重要的操作：计算转置向量积 $A^T x$。这要求你以一种新的方式思考数据访问模式，遍历 CSR 格式中的非零元素，并逐分量地构建结果向量。",
            "id": "2204555",
            "problem": "在数值线性代数中，稀疏矩阵通常以专门的格式存储，以节省内存和计算成本。其中最常见的一种是压缩稀疏行（CSR）格式。一个大小为 $m \\times n$ 的稀疏矩阵 $A$ 由三个一维数组表示，使用基于0的索引：\n\n1.  `values`：一个包含 $A$ 的所有非零元素的数组，按行主序排列。\n2.  `col_indices`：一个与 `values` 大小相同的数组，存储每个对应非零值的列索引。\n3.  `row_ptr`：一个大小为 $m+1$ 的数组。第 `i` 行（其中 $0 \\le i  m$）的元素从 `values[row_ptr[i]]` 开始，到 `values[row_ptr[i+1] - 1]` 结束。最后一个元素 `row_ptr[m]` 存储非零元素的总数。\n\n考虑一个大小为 $4 \\times 5$ 的稀疏矩阵 $A$，它用CSR格式由以下数组表示：\n`values` = `[2.0, -1.0, 3.0, 5.0, 1.0, 4.0, -3.0, 2.0]`\n`col_indices` = `[1, 3, 0, 4, 1, 2, 0, 3]`\n`row_ptr` = `[0, 2, 4, 6, 8]`\n\n给定一个向量 $x = [1.0, 0.5, -2.0, -1.0]^T$。\n\n你的任务是计算转置向量积 $y = A^T x$，而无需显式构造矩阵 $A$ 或其转置 $A^T$。确定结果向量 $y$ 的分量。你的答案应该是 $y$ 的分量，从 $y_0$ 到 $y_4$ 依次列出。",
            "solution": "我们给定一个CSR格式的稀疏矩阵 $A \\in \\mathbb{R}^{4 \\times 5}$，其参数为\n$\\text{values} = [2.0, -1.0, 3.0, 5.0, 1.0, 4.0, -3.0, 2.0]$, $\\text{col\\_indices} = [1, 3, 0, 4, 1, 2, 0, 3]$，以及 $\\text{row\\_ptr} = [0, 2, 4, 6, 8]$，还有一个向量 $x = [1.0, 0.5, -2.0, -1.0]^{T}$。目标是计算 $y = A^{T} x$ 而不构造 $A$ 或 $A^{T}$。根据转置矩阵与向量乘法的定义，每个分量满足\n$$\ny_{j} = \\sum_{i=0}^{3} A_{i,j} x_{i} \\quad \\text{for } j \\in \\{0,1,2,3,4\\}.\n$$\n在CSR格式中，对于每一行 $i$，非零元素位于索引 $k$ 从 $\\text{row\\_ptr}[i]$ 到 $\\text{row\\_ptr}[i+1]-1$ 的范围内，其列为 $j = \\text{col\\_indices}[k]$，值为 $A_{i,j} = \\text{values}[k]$。因此我们可以累加\n$$\ny_{j} \\mathrel{+}= \\text{values}[k] \\, x_{i} \\quad \\text{for each nonzero } (i,j).\n$$\n初始化 $y = [0,0,0,0,0]$。处理每一行：\n\n第 $i=0$ 行使用 $k \\in \\{0,1\\}$（因为 $\\text{row\\_ptr}[0]=0$ 和 $\\text{row\\_ptr}[1]=2$），且 $x_{0} = 1.0$。\n- 当 $k=0$ 时：$j=\\text{col\\_indices}[0]=1$，$\\text{values}[0]=2.0$，所以 $y_{1} \\mathrel{+}= 2.0 \\cdot 1.0 = 2.0$。\n- 当 $k=1$ 时：$j=\\text{col\\_indices}[1]=3$，$\\text{values}[1]=-1.0$，所以 $y_{3} \\mathrel{+}= (-1.0) \\cdot 1.0 = -1.0$。\n\n第 $i=1$ 行使用 $k \\in \\{2,3\\}$，且 $x_{1} = 0.5$。\n- 当 $k=2$ 时：$j=\\text{col\\_indices}[2]=0$，$\\text{values}[2]=3.0$，所以 $y_{0} \\mathrel{+}= 3.0 \\cdot 0.5 = 1.5$。\n- 当 $k=3$ 时：$j=\\text{col\\_indices}[3]=4$，$\\text{values}[3]=5.0$，所以 $y_{4} \\mathrel{+}= 5.0 \\cdot 0.5 = 2.5$。\n\n第 $i=2$ 行使用 $k \\in \\{4,5\\}$，且 $x_{2} = -2.0$。\n- 当 $k=4$ 时：$j=\\text{col\\_indices}[4]=1$，$\\text{values}[4]=1.0$，所以 $y_{1} \\mathrel{+}= 1.0 \\cdot (-2.0) = -2.0$。\n- 当 $k=5$ 时：$j=\\text{col\\_indices}[5]=2$，$\\text{values}[5]=4.0$，所以 $y_{2} \\mathrel{+}= 4.0 \\cdot (-2.0) = -8.0$。\n\n第 $i=3$ 行使用 $k \\in \\{6,7\\}$，且 $x_{3} = -1.0$。\n- 当 $k=6$ 时：$j=\\text{col\\_indices}[6]=0$，$\\text{values}[6]=-3.0$，所以 $y_{0} \\mathrel{+}= (-3.0) \\cdot (-1.0) = 3.0$。\n- 当 $k=7$ 时：$j=\\text{col\\_indices}[7]=3$，$\\text{values}[7]=2.0$，所以 $y_{3} \\mathrel{+}= 2.0 \\cdot (-1.0) = -2.0$。\n\n将各分量的贡献相加，得到\n$$\ny_{0} = 1.5 + 3.0 = 4.5,\\quad\ny_{1} = 2.0 - 2.0 = 0,\\quad\ny_{2} = -8.0,\\quad\ny_{3} = -1.0 - 2.0 = -3.0,\\quad\ny_{4} = 2.5.\n$$\n因此，\n$$\ny = \\begin{pmatrix} 4.5  0  -8  -3  2.5 \\end{pmatrix}.\n$$",
            "answer": "$$\\boxed{\\begin{pmatrix}4.5  0  -8  -3  2.5\\end{pmatrix}}$$"
        },
        {
            "introduction": "不同的稀疏格式适用于不同的任务，例如，坐标（COO）格式非常适合逐步构建矩阵，而 CSR 格式则更适合进行高效的行操作。因此，在格式之间进行转换是一项关键技能。本练习将演示如何将灵活的 COO 格式转换为结构更紧凑、计算效率更高的 CSR 格式，这是许多计算工作流程中的常见步骤。",
            "id": "2204580",
            "problem": "在科学计算中，稀疏矩阵（主要由零填充的矩阵）通常以专门的格式存储，以节省内存和计算时间。其中一种格式是坐标（COO）格式，它使用三个数组来表示一个矩阵：`values`（包含非零元素）、`row_indices`（每个非零元素的行索引）和 `col_indices`（每个非零元素的列索引）。\n\n另一种常见且对于矩阵运算更高效的格式是压缩稀疏行（CSR）格式。它也使用三个数组：\n1.  `values`：非零值的数组，按行排序，然后在每行内按列排序。\n2.  `col_indices`：与 `values` 数组中的元素相对应的列索引数组。\n3.  `row_ptr`：一个大小为 `(行数 + 1)` 的数组。值 `row_ptr[i]` 指示第 `i` 行的元素在 `values` 数组中开始的索引。`row_ptr` 的最后一个元素是非零元素的总数。\n\n考虑一个表示小型网络的 5x5 稀疏矩阵，最初以 COO 格式给出。非零元素以任意顺序列出：\n\n`values = [3, 8, 1, 5, 9, 2, 7]`\n`row_indices = [1, 0, 4, 0, 2, 2, 4]`\n`col_indices = [2, 1, 3, 4, 3, 0, 1]`\n\n将此矩阵表示从 COO 格式转换为 CSR 格式。以下哪个选项正确表示了转换后的 `values`、`col_indices` 和 `row_ptr` 数组？\n\nA.\n`values = [8, 5, 3, 2, 9, 7, 1]`\n`col_indices = [1, 4, 2, 0, 3, 1, 3]`\n`row_ptr = [0, 2, 1, 2, 0, 2]`\n\nB.\n`values = [3, 8, 1, 5, 9, 2, 7]`\n`col_indices = [2, 1, 3, 4, 3, 0, 1]`\n`row_ptr = [0, 2, 3, 5, 5, 7]`\n\nC.\n`values = [8, 5, 3, 2, 9, 7, 1]`\n`col_indices = [1, 4, 2, 0, 3, 1, 3]`\n`row_ptr = [1, 3, 4, 6, 6, 8]`\n\nD.\n`values = [8, 5, 3, 2, 9, 7, 1]`\n`col_indices = [1, 4, 2, 0, 3, 1, 3]`\n`row_ptr = [0, 2, 3, 5, 5, 7]`",
            "solution": "我们通过三个数组得到了一个 COO 格式的稀疏矩阵。将每个非零项定义为 COO 三元组 $(r_{k}, c_{k}, v_{k})$。根据数据：\n$$\n\\begin{aligned}\n\\text{values} = [3, 8, 1, 5, 9, 2, 7], \\\\\n\\text{row\\_indices} = [1, 0, 4, 0, 2, 2, 4], \\\\\n\\text{col\\_indices} = [2, 1, 3, 4, 3, 0, 1].\n\\end{aligned}\n$$\n这产生了一个无序的三元组列表：\n$$\n(1,2;3),\\ (0,1;8),\\ (4,3;1),\\ (0,4;5),\\ (2,3;9),\\ (2,0;2),\\ (4,1;7).\n$$\n\n要转换为 CSR 格式，我们首先按行索引升序对条目进行排序，然后在每一行内按列索引升序排序。按行分组并在每行内排序后得到：\n- 行 $0$：条目 $(0,1;8)$ 和 $(0,4;5)$，已按列 $14$ 排序。\n- 行 $1$：条目 $(1,2;3)$。\n- 行 $2$：条目 $(2,0;2)$ 和 $(2,3;9)$，按列 $03$ 排序。\n- 行 $3$：没有条目。\n- 行 $4$：条目 $(4,1;7)$ 和 $(4,3;1)$，按列 $13$ 排序。\n\n按行连接，得到 CSR 排序的数组：\n$$\n\\text{values} = [8,\\,5,\\,3,\\,2,\\,9,\\,7,\\,1],\n$$\n$$\n\\text{col\\_indices} = [1,\\,4,\\,2,\\,0,\\,3,\\,1,\\,3].\n$$\n\n接下来，计算长度为 $5+1=6$ 的行指针数组 $\\text{row\\_ptr}$。计算每行的非零元素数量：\n- 行 $0$：$2$ 个，\n- 行 $1$：$1$ 个，\n- 行 $2$：$2$ 个，\n- 行 $3$：$0$ 个，\n- 行 $4$：$2$ 个。\n\n从 $0$ 开始计算累积和：\n$$\n\\text{row\\_ptr} = [0,\\ 0+2,\\ 2+1,\\ 3+2,\\ 5+0,\\ 5+2] = [0,\\,2,\\,3,\\,5,\\,5,\\,7].\n$$\n\n与选项比较，这与选项 D 完全匹配。",
            "answer": "$$\\boxed{D}$$"
        }
    ]
}