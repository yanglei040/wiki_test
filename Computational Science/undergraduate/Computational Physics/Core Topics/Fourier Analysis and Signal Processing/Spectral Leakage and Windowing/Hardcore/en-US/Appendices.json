{
    "hands_on_practices": [
        {
            "introduction": "Before we can manage spectral leakage, we must first understand precisely what it is and where it comes from. This foundational exercise  explores the effect of observing a pure sinusoidal signal for a finite duration. This truncation is equivalent to applying a rectangular window, and you will see how this seemingly simple act transforms the infinitely sharp spectrum of an ideal sinusoid into a pattern of a central \"main lobe\" and a series of decaying \"side lobes,\" the very signature of spectral leakage.",
            "id": "1753673",
            "problem": "An engineer is analyzing a discrete-time signal $x[n]$ known to be a pure deterministic sinusoid with amplitude $A$ and a constant, normalized angular frequency $\\omega_0$, where $0 < \\omega_0 < \\pi$. The signal is given by the expression $x[n] = A \\cos(\\omega_0 n)$.\n\nFor practical analysis using a digital computer, only a finite-length segment of the signal can be processed. This truncation is modeled by multiplying the ideal signal $x[n]$ by a rectangular window function, $w_R[n]$. The window is of length $M$ and is defined as $w_R[n] = 1$ for $0 \\le n \\le M-1$ and $w_R[n] = 0$ otherwise. The resulting signal to be analyzed is $y[n] = x[n] w_R[n]$.\n\nThe engineer then computes the Discrete-Time Fourier Transform (DTFT) of the windowed signal, denoted as $Y(e^{j\\omega})$. Which of the following options provides the most accurate qualitative description of the magnitude spectrum, $|Y(e^{j\\omega})|$, for the principal frequency range $-\\pi < \\omega < \\pi$?\n\nA. Two infinitely sharp impulses (Dirac delta functions) located precisely at frequencies $\\omega = \\omega_0$ and $\\omega = -\\omega_0$.\n\nB. A single broad central peak (main lobe) centered at $\\omega = 0$, accompanied by a series of smaller, decaying ripples (sidelobes) that extend across the frequency range.\n\nC. Two prominent peaks (main lobes), centered near the frequencies $\\omega = \\omega_0$ and $\\omega = -\\omega_0$, with each peak being accompanied by a series of smaller, decaying ripples (sidelobes).\n\nD. A spectrum with a constant, non-zero magnitude across the entire frequency range from $-\\pi$ to $\\pi$.\n\nE. A series of equally spaced, equally high impulses located at integer multiples of the frequency $\\frac{2\\pi}{M}$.",
            "solution": "We start from the given signal and window:\n$$x[n]=A\\cos(\\omega_{0} n),\\quad w_{R}[n]=\\begin{cases}1,&0\\leq n\\leq M-1\\\\ 0,&\\text{otherwise}\\end{cases},\\quad y[n]=x[n]w_{R}[n].$$\nUsing Euler's identity, write the cosine as\n$$x[n]=\\frac{A}{2}\\left(\\exp(j\\omega_{0} n)+\\exp(-j\\omega_{0} n)\\right),$$\nso\n$$y[n]=\\frac{A}{2}\\left(w_{R}[n]\\exp(j\\omega_{0} n)+w_{R}[n]\\exp(-j\\omega_{0} n)\\right).$$\nDefine the DTFT by\n$$Y(\\exp(j\\omega))=\\sum_{n=-\\infty}^{\\infty}y[n]\\exp(-j\\omega n).$$\nBy linearity and the modulation property of the DTFT,\n$$\\mathcal{F}\\{w_{R}[n]\\exp(j\\omega_{0} n)\\}=W_{R}(\\exp(j(\\omega-\\omega_{0}))),\\quad \\mathcal{F}\\{w_{R}[n]\\exp(-j\\omega_{0} n)\\}=W_{R}(\\exp(j(\\omega+\\omega_{0}))),$$\nso\n$$Y(\\exp(j\\omega))=\\frac{A}{2}\\left(W_{R}(\\exp(j(\\omega-\\omega_{0})))+W_{R}(\\exp(j(\\omega+\\omega_{0})))\\right).$$\nThe DTFT of the length-$M$ rectangular window is the Dirichlet kernel (up to a linear phase):\n$$W_{R}(\\exp(j\\omega))=\\exp\\!\\left(-j\\omega\\frac{M-1}{2}\\right)\\frac{\\sin\\!\\left(\\frac{M\\omega}{2}\\right)}{\\sin\\!\\left(\\frac{\\omega}{2}\\right)}.$$\nTherefore,\n$$|W_{R}(\\exp(j\\omega))|=\\left|\\frac{\\sin\\!\\left(\\frac{M\\omega}{2}\\right)}{\\sin\\!\\left(\\frac{\\omega}{2}\\right)}\\right|,$$\nwhich has a main lobe centered at $\\omega=0$ with decaying sidelobes. Substituting into $Y(\\exp(j\\omega))$ gives\n$$|Y(\\exp(j\\omega))|=\\frac{A}{2}\\left|W_{R}(\\exp(j(\\omega-\\omega_{0})))+W_{R}(\\exp(j(\\omega+\\omega_{0})))\\right|,$$\nwhich, qualitatively, is the superposition of two shifted copies of the Dirichlet magnitude, one centered at $\\omega=\\omega_{0}$ and the other at $\\omega=-\\omega_{0}$. Because $0<\\omega_{0}<\\pi$, both peaks lie within the principal range $-\\pi<\\omega<\\pi$. Each of these two peaks exhibits a main lobe with accompanying decaying sidelobes due to the rectangular window.\n\nHence, the correct qualitative description is two prominent main lobes centered near $\\omega=\\pm\\omega_{0}$, each with sidelobes.\n\nComparing with the options:\n- A is incorrect because truncation by a finite window broadens deltas into main lobes with sidelobes.\n- B is the spectrum of the window alone (centered at $0$), not of the modulated windowed sinusoid.\n- C matches the derived structure.\n- D is incorrect; the magnitude is not flat.\n- E describes a line spectrum for periodic/discrete frequencies, not the DTFT of a finite segment.\n\nTherefore, the correct choice is C.",
            "answer": "$$\\boxed{C}$$"
        },
        {
            "introduction": "With a firm grasp of what causes spectral leakage, we can now explore techniques to control it. This practice  delves into the core trade-off of windowing: frequency resolution versus side-lobe suppression. You will computationally compare the performance of the rectangular, Hann, and Blackman windows in the challenging task of resolving two closely spaced sinusoids, gaining a practical understanding of how different window shapes affect your ability to distinguish spectral features.",
            "id": "2440581",
            "problem": "You will model the effect of spectral leakage on the discrete Fourier transform when attempting to resolve two continuous-time sinusoidal components whose frequency separation is strictly less than the discrete Fourier transform frequency resolution. Consider a real-valued signal composed of two sinusoids of equal amplitude, sampled uniformly at a constant sampling frequency. Let the total number of samples be $N$, the sampling frequency be $f_{s}$ in Hz, and the discrete Fourier transform frequency resolution be $\\Delta f = \\frac{f_{s}}{N}$ in Hz. The signal is\n$$\nx[n] = \\sin\\!\\left(2\\pi \\frac{f_{1}}{f_{s}} n + \\phi_{1}\\right) + \\sin\\!\\left(2\\pi \\frac{f_{2}}{f_{s}} n + \\phi_{2}\\right), \\quad n = 0,1,2,\\dots,N-1,\n$$\nwith phases $\\phi_{1}$ and $\\phi_{2}$ in radians. You must analyze the windowed discrete Fourier transform magnitude spectrum of $x[n]$ for the following three windows $w[n]$ of length $N$:\n- Rectangular window: $w_{\\mathrm{rect}}[n] = 1$ for all $n$.\n- Hann window: $w_{\\mathrm{hann}}[n] = \\tfrac{1}{2}\\left(1 - \\cos\\!\\left(\\tfrac{2\\pi n}{N-1}\\right)\\right)$.\n- Blackman window: $w_{\\mathrm{black}}[n] = 0.42 - 0.5 \\cos\\!\\left(\\tfrac{2\\pi n}{N-1}\\right) + 0.08 \\cos\\!\\left(\\tfrac{4\\pi n}{N-1}\\right)$.\n\nDefine the discrete Fourier transform of the windowed signal as\n$$\nX[k] = \\sum_{n=0}^{N-1} x[n]\\,w[n]\\,e^{-j 2\\pi \\frac{k n}{N}}, \\quad k = 0,1,2,\\dots,N-1,\n$$\nand define the nonnegative-frequency magnitude spectrum as $M[k] = |X[k]|$ for $k = 0,1,2,\\dots,\\tfrac{N}{2}$.\n\nFor each window, quantify spectral leakage and peak structure as follows:\n- Let $p_{1} = \\mathrm{round}\\!\\left(\\frac{f_{1}}{\\Delta f}\\right)$ and $p_{2} = \\mathrm{round}\\!\\left(\\frac{f_{2}}{\\Delta f}\\right)$, both clipped to the integer interval $[0, \\tfrac{N}{2}]$. Define the leakage fraction\n$$\nL = \\frac{\\sum_{k=0,\\,k \\neq p_{1},\\,k \\neq p_{2}}^{N/2} M[k]^{2}}{\\sum_{k=0}^{N/2} M[k]^{2}},\n$$\na dimensionless number in $[0,1]$.\n- Let $M_{\\max}$ be the largest value of $M[k]$ over $k = 0,1,2,\\dots,\\tfrac{N}{2}$, and let $M_{\\mathrm{second}}$ be the second-largest value over the same index set. Define the peak ratio\n$$\nR = \\frac{M_{\\mathrm{second}}}{M_{\\max}},\n$$\na dimensionless number in $[0,1]$.\n\nAll phases must be specified in radians. Frequencies must be specified in Hz. Sampling times are $t_{n} = \\tfrac{n}{f_{s}}$ in s. All requested outputs are dimensionless real numbers.\n\nTest suite. Use the following parameter sets, where each case satisfies $|f_{1} - f_{2}| < \\Delta f$:\n- Case $1$: $f_{s} = 1024$ Hz, $N = 256$, $f_{1} = 100.0$ Hz, $f_{2} = 102.0$ Hz, $\\phi_{1} = 0$ rad, $\\phi_{2} = 0$ rad.\n- Case $2$: $f_{s} = 1024$ Hz, $N = 256$, $f_{1} = 99.0$ Hz, $f_{2} = 101.0$ Hz, $\\phi_{1} = 0$ rad, $\\phi_{2} = 0$ rad.\n- Case $3$: $f_{s} = 1024$ Hz, $N = 256$, $f_{1} = 100.0$ Hz, $f_{2} = 100.25$ Hz, $\\phi_{1} = 0$ rad, $\\phi_{2} = 0$ rad.\n\nFor each case, compute the $6$-tuple of outputs\n$$\n\\left[L_{\\mathrm{rect}},\\,L_{\\mathrm{hann}},\\,L_{\\mathrm{black}},\\,R_{\\mathrm{rect}},\\,R_{\\mathrm{hann}},\\,R_{\\mathrm{black}}\\right],\n$$\nwhere each $L_{\\cdot}$ and $R_{\\cdot}$ is as defined above for the corresponding window.\n\nFinal output format. Your program should produce a single line of output containing a list of three elements (one per test case), where each element is the comma-separated list\n$[L_{\\mathrm{rect}},L_{\\mathrm{hann}},L_{\\mathrm{black}},R_{\\mathrm{rect}},R_{\\mathrm{hann}},R_{\\mathrm{black}}]$ with all entries as decimal floats. The overall output must be a single bracketed list of these three lists with no spaces, for example\n\"[[a,b,c,d,e,f],[a,b,c,d,e,f],[a,b,c,d,e,f]]\".",
            "solution": "The problem posed is a well-defined exercise in computational physics and digital signal processing. It is scientifically grounded, self-contained, and algorithmically formalizable. All parameters and functions are explicitly defined, and the test cases are consistent with the premises. The problem is therefore deemed valid and a full solution will be provided.\n\nThe fundamental task is to analyze the performance of different window functions in resolving two sinusoidal signals whose frequencies, $f_{1}$ and $f_{2}$, are separated by less than the frequency resolution of the Discrete Fourier Transform (DFT), $\\Delta f = \\frac{f_{s}}{N}$. This situation is common in experimental data analysis, where spectral components may be closely spaced.\n\nThe core principle behind this analysis is the understanding of the DFT and the phenomenon of spectral leakage. The DFT assumes that the finite-length signal segment $x[n]$ of length $N$ is one period of an infinitely periodic signal. If the signal segment does not contain an integer number of cycles of its constituent sinusoids, a sharp discontinuity arises at the boundary where the signal wraps around. This discontinuity manifests in the frequency domain as spectral leakage, where energy from the true frequency \"leaks\" into other frequency bins.\n\nWindowing is a technique to mitigate this effect. A window function $w[n]$ is applied to the signal, $y[n] = x[n]w[n]$, before the DFT is computed. Window functions taper towards zero at the ends of the segment, reducing the boundary discontinuities. This comes at a cost. The Fourier transform of the window function is convolved with the true spectrum of the signal. This convolution broadens the main spectral peaks (main lobes) and reduces the amplitude of the spurious peaks (side lobes). This creates a trade-off:\n\n$1$. **Rectangular Window, $w_{\\mathrm{rect}}[n]$**: This is equivalent to applying no window, simply truncating the signal. Its transform has the narrowest main lobe, offering the highest theoretical frequency resolution. However, it also has the highest side lobes (the first side lobe is only about $-13$ dB down from the main lobe), leading to severe spectral leakage that can obscure nearby weaker signals or merge with adjacent strong signals.\n\n$2$. **Hann Window, $w_{\\mathrm{hann}}[n]$**: This is a smooth, bell-shaped window. Its main lobe is approximately twice as wide as that of the rectangular window, thus reducing frequency resolution. Its significant advantage is the much lower side-lobe level (first side lobe at about $-31$ dB), which provides excellent leakage suppression.\n\n$3$. **Blackman Window, $w_{\\mathrm{black}}[n]$**: This window provides an even wider main lobe (approximately three times that of the rectangular window) and, in return, even lower side lobes (first side lobe at about $-58$ dB). It offers superior leakage suppression at the cost of further reduced frequency resolution.\n\nThe problem requires a quantitative analysis of this trade-off using two metrics for the magnitude spectrum $M[k] = |X[k]|$.\n\n- **Leakage Fraction, $L$**: This metric, defined as $L = (\\sum_{k=0,\\,k \\neq p_{1},\\,k \\neq p_{2}}^{N/2} M[k]^{2}) / (\\sum_{k=0}^{N/2} M[k]^{2})$, measures the fraction of spectral energy that has leaked outside the primary frequency bins associated with the signals, $p_{1}$ and $p_{2}$. These bins are identified by rounding the true frequencies normalized by the DFT frequency resolution, $f/\\Delta f$. A lower value of $L$ indicates better suppression of spectral leakage. We expect $L_{\\mathrm{rect}} > L_{\\mathrm{hann}} > L_{\\mathrm{black}}$.\n\n- **Peak Ratio, $R$**: This metric, defined as $R = M_{\\mathrm{second}} / M_{\\max}$, quantifies the resolvability of the two spectral components. If the two sinusoids are resolved into two distinct peaks in the spectrum, $R$ will be close to $1$ (since the sinusoids have equal amplitude). If they merge into a single, broad peak, $M_{\\max}$ will be this merged peak and $M_{\\mathrm{second}}$ will be the highest side lobe, resulting in a small value of $R$. Since $|f_{1} - f_{2}| < \\Delta f$, the components are not resolvable according to the classic Rayleigh criterion for a rectangular window. We will investigate whether they are nonetheless distinguishable.\n\nThe algorithmic procedure to solve the problem for each test case is as follows:\n\n$1$. Define the parameters $f_{s}$, $N$, $f_{1}$, $f_{2}$, $\\phi_{1}$, and $\\phi_{2}$.\n$2$. Generate the discrete time vector $n = [0, 1, \\dots, N-1]$.\n$3$. Construct the signal $x[n] = \\sin(2\\pi \\frac{f_{1}}{f_{s}} n + \\phi_{1}) + \\sin(2\\pi \\frac{f_{2}}{f_{s}} n + \\phi_{2})$.\n$4$. For each of the three specified window functions $w[n]$ (Rectangular, Hann, Blackman):\n    a. Generate the window sequence $w[n]$.\n    b. Apply the window to the signal: $y[n] = x[n] \\cdot w[n]$.\n    c. Compute the DFT of the windowed signal, $X[k] = \\sum_{n=0}^{N-1} y[n]\\,e^{-j 2\\pi \\frac{k n}{N}}$, using the Fast Fourier Transform (FFT) algorithm for efficiency.\n    d. Extract the non-negative frequency magnitude spectrum, $M[k] = |X[k]|$ for $k = 0, 1, \\dots, N/2$.\n    e. Calculate the DFT frequency resolution $\\Delta f = f_{s}/N$.\n    f. Determine the closest integer DFT bin indices for the two frequencies: $p_{1} = \\mathrm{round}(f_{1}/\\Delta f)$ and $p_{2} = \\mathrm{round}(f_{2}/\\Delta f)$, clipped to the valid range $[0, N/2]$.\n    g. Calculate the leakage fraction $L$ by summing the squared magnitudes of all bins except $p_{1}$ and $p_{2}$, and dividing by the total sum of squared magnitudes.\n    h. Calculate the peak ratio $R$ by finding the two largest values in the spectrum $M[k]$ and computing their ratio.\n$5$. Consolidate the six computed values ($L_{\\mathrm{rect}}, L_{\\mathrm{hann}}, L_{\\mathrm{black}}, R_{\\mathrm{rect}}, R_{\\mathrm{hann}}, R_{\\mathrm{black}}$) into a single list for the test case.\n$6$. Repeat for all test cases and format the final output as specified.\n\nThis procedure is implemented in the following program.",
            "answer": "```python\nimport numpy as np\nfrom scipy.fft import fft\n\ndef solve():\n    \"\"\"\n    Solves the spectral analysis problem for the given test cases.\n    \"\"\"\n    test_cases = [\n        # (fs, N, f1, f2, phi1, phi2)\n        (1024.0, 256, 100.0, 102.0, 0.0, 0.0),\n        (1024.0, 256, 99.0, 101.0, 0.0, 0.0),\n        (1024.0, 256, 100.0, 100.25, 0.0, 0.0),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        fs, N, f1, f2, phi1, phi2 = case\n\n        # Step 1: Generate signal x[n]\n        n = np.arange(N)\n        x_n = np.sin(2 * np.pi * f1 / fs * n + phi1) + \\\n              np.sin(2 * np.pi * f2 / fs * n + phi2)\n        \n        # Step 2: Define window functions\n        w_rect = np.ones(N)\n        # The problem defines windows symmetric about the midpoint, using N-1.\n        w_hann = 0.5 * (1 - np.cos(2 * np.pi * n / (N - 1)))\n        w_black = 0.42 - 0.5 * np.cos(2 * np.pi * n / (N - 1)) + \\\n                  0.08 * np.cos(4 * np.pi * n / (N - 1))\n\n        windows = {\n            \"rect\": w_rect,\n            \"hann\": w_hann,\n            \"black\": w_black,\n        }\n        \n        L_results = {}\n        R_results = {}\n\n        # Step 3: Loop through each window to perform analysis\n        for name, w_n in windows.items():\n            # Step 3a: Apply window\n            y_n = x_n * w_n\n            \n            # Step 3b: Compute DFT\n            X_k = fft(y_n)\n            \n            # Step 3c: Get non-negative frequency magnitude spectrum M[k]\n            # M[k] covers frequencies from 0 to fs/2. The size is N/2 + 1.\n            num_freq_bins = N // 2 + 1\n            M_k = np.abs(X_k[:num_freq_bins])\n\n            # Step 3d: Calculate metrics\n            delta_f = fs / N\n            # As per problem, determine peak indices p1, p2\n            p1 = int(np.round(f1 / delta_f))\n            p2 = int(np.round(f2 / delta_f))\n            \n            # Clip indices to the range of the non-negative spectrum\n            p1 = np.clip(p1, 0, N // 2)\n            p2 = np.clip(p2, 0, N // 2)\n            \n            # Calculate Leakage Fraction L\n            total_energy = np.sum(M_k**2)\n            if total_energy  1e-12:  # Avoid division by zero for null signal\n                L = 0.0\n            else:\n                peak_indices = np.unique([p1, p2])\n                peak_energy = np.sum(M_k[peak_indices]**2)\n                leakage_energy = total_energy - peak_energy\n                L = leakage_energy / total_energy\n            \n            L_results[name] = L\n\n            # Calculate Peak Ratio R\n            # Find M_max and M_second\n            if M_k.size  2:\n                R = 0.0\n            else:\n                sorted_M = np.sort(M_k)\n                M_max = sorted_M[-1]\n                M_second = sorted_M[-2]\n                if M_max  1e-12: # Avoid division by zero\n                    R = 0.0\n                else:\n                    R = M_second / M_max\n\n            R_results[name] = R\n            \n        # Step 4: Assemble results for the case in the specified order\n        case_results = [\n            L_results[\"rect\"], L_results[\"hann\"], L_results[\"black\"],\n            R_results[\"rect\"], R_results[\"hann\"], R_results[\"black\"]\n        ]\n        all_results.append(case_results)\n\n    # Step 5: Format the final output string\n    # e.g., \"[[a,b,c,d,e,f],[...]]\"\n    output_parts = []\n    for res_list in all_results:\n        output_parts.append(f\"[{','.join(map(str, res_list))}]\")\n    \n    final_output = f\"[{','.join(output_parts)}]\"\n\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "The choice of a window function is not a one-size-fits-all decision; it is dictated by the goals of your analysis. This exercise  shifts our focus from resolving frequencies to achieving accurate amplitude measurements, a critical task in many experimental physics applications. You will compare the performance of a standard rectangular window against a specialized Flat Top window, which is designed to minimize amplitude errors (scalloping loss) even when a signal's frequency falls between DFT bins.",
            "id": "2440597",
            "problem": "You are to write a complete program that evaluates the amplitude measurement accuracy for a real-valued sinusoidal signal using a five-term Flat Top window against a rectangular window, when the signal frequency is not necessarily located at a Discrete Fourier Transform (DFT) bin center. The evaluation must be based on first principles using explicit mathematical definitions provided below. The program must compute, for each test case, the relative amplitude error obtained by each window and aggregate the results in the required output format.\n\nDefinitions and requirements:\n- Let the sampling frequency be $f_s = 48000$ hertz. Let the number of acquired samples be $N = 1024$. Let the sinusoid amplitude be $A = 1.0$ (unitless). Let the sinusoid phase be fixed at $0$ (radians). All angles must be treated in radians.\n- The real-valued discrete-time signal is $x_n = A \\cos\\!\\left(2\\pi f \\frac{n}{f_s}\\right)$ for $n \\in \\{0,1,\\dots,N-1\\}$, where $f$ is the sinusoid frequency set by each test case below.\n- The DFT of a length-$M$ sequence $\\{y_n\\}$ is defined as $X_k = \\sum_{n=0}^{M-1} y_n \\, e^{-j 2\\pi k n / M}$ for $k \\in \\{0,1,\\dots,M-1\\}$, with no normalization factor. You must use zero-padding, that is, $y_n = w_n x_n$ for $0 \\le n \\le N-1$ and $y_n = 0$ for $N \\le n \\le M-1$, where $M = Z N$ and $Z$ is the integer zero-padding factor specified below.\n- For amplitude measurement, for a given window $w_n$, define the coherent gain $G = \\frac{1}{N}\\sum_{n=0}^{N-1} w_n$. Define the amplitude estimate\n$$\n\\hat{A} = \\frac{2}{N G} \\max_{0 \\le k \\le \\left\\lfloor M/2 \\right\\rfloor} \\left| X_k \\right|,\n$$\nwhere $X_k$ is computed from the zero-padded, windowed sequence $y_n$, and $\\left| \\cdot \\right|$ denotes complex magnitude. The factor $2$ accounts for the energy split between positive and negative frequencies for a real sinusoid.\n- The rectangular window is $w_n^{(\\mathrm{rect})} = 1$ for all $n$.\n- The five-term Flat Top window is defined by\n$$\nw_n^{(\\mathrm{ft})} = a_0 - a_1 \\cos\\!\\left(\\frac{2\\pi n}{N-1}\\right) + a_2 \\cos\\!\\left(\\frac{4\\pi n}{N-1}\\right) - a_3 \\cos\\!\\left(\\frac{6\\pi n}{N-1}\\right) + a_4 \\cos\\!\\left(\\frac{8\\pi n}{N-1}\\right),\n$$\nfor $n \\in \\{0,1,\\dots,N-1\\}$, with coefficients $a_0 = 1.0$, $a_1 = 1.93$, $a_2 = 1.29$, $a_3 = 0.388$, $a_4 = 0.028$.\n- Use the zero-padding factor $Z = 32$, so $M = Z N$.\n\nFor each test case below, compute the relative amplitude error for each window as\n$$\n\\varepsilon = \\left| \\frac{\\hat{A}}{A} - 1 \\right|,\n$$\na unitless quantity expressed as a floating-point number.\n\nTest suite (use the following frequency specifications; here $m$ denotes a DFT-bin index and $f = m \\frac{f_s}{N}$):\n1. On-bin reference: $m = 100$, so $f = 100 \\cdot \\frac{f_s}{N}$.\n2. Half-bin offset: $m = 100.5$, so $f = 100.5 \\cdot \\frac{f_s}{N}$.\n3. Fractional offset: $m = 250.3$, so $f = 250.3 \\cdot \\frac{f_s}{N}$.\n4. Near-Nyquist fractional offset: $m = \\frac{N}{2} - 5 + 0.37$, so $f = \\left(\\frac{N}{2} - 5 + 0.37\\right) \\cdot \\frac{f_s}{N}$.\n5. Tiny offset: $m = 75.01$, so $f = 75.01 \\cdot \\frac{f_s}{N}$.\n\nYour program must, for each test case (in the order listed above), produce a two-element list $[\\varepsilon_{\\mathrm{rect}}, \\varepsilon_{\\mathrm{ft}}]$ containing the relative amplitude error for the rectangular window and for the Flat Top window, respectively.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is the two-element list for one test case, in order. For example, the output must look like\n\"[ [e_rect_1, e_ft_1], [e_rect_2, e_ft_2], [e_rect_3, e_ft_3], [e_rect_4, e_ft_4], [e_rect_5, e_ft_5] ]\"\nwith the actual floating-point values in place of the symbols. No additional text should be printed.",
            "solution": "The problem statement is subjected to validation.\n\nStep 1: Extract Givens\n- Sampling frequency: $f_s = 48000$ hertz.\n- Number of samples: $N = 1024$.\n- Sinusoid amplitude: $A = 1.0$ (unitless).\n- Sinusoid phase: $0$ radians.\n- Discrete-time signal: $x_n = A \\cos\\!\\left(2\\pi f \\frac{n}{f_s}\\right)$ for $n \\in \\{0, 1, \\dots, N-1\\}$.\n- DFT definition: $X_k = \\sum_{n=0}^{M-1} y_n \\, e^{-j 2\\pi k n / M}$ for $k \\in \\{0, 1, \\dots, M-1\\}$.\n- Zero-padding: The windowed sequence $y_n = w_n x_n$ for $0 \\le n \\le N-1$ is padded with zeros to length $M = Z N$.\n- Zero-padding factor: $Z = 32$.\n- Coherent Gain: $G = \\frac{1}{N}\\sum_{n=0}^{N-1} w_n$.\n- Amplitude estimate: $\\hat{A} = \\frac{2}{N G} \\max_{0 \\le k \\le \\left\\lfloor M/2 \\right\\rfloor} \\left| X_k \\right|$.\n- Rectangular window: $w_n^{(\\mathrm{rect})} = 1$ for all $n \\in \\{0, 1, \\dots, N-1\\}$.\n- Five-term Flat Top window: $w_n^{(\\mathrm{ft})} = a_0 - a_1 \\cos\\!\\left(\\frac{2\\pi n}{N-1}\\right) + a_2 \\cos\\!\\left(\\frac{4\\pi n}{N-1}\\right) - a_3 \\cos\\!\\left(\\frac{6\\pi n}{N-1}\\right) + a_4 \\cos\\!\\left(\\frac{8\\pi n}{N-1}\\right)$, for $n \\in \\{0, 1, \\dots, N-1\\}$, with coefficients $a_0 = 1.0$, $a_1 = 1.93$, $a_2 = 1.29$, $a_3 = 0.388$, $a_4 = 0.028$.\n- Relative amplitude error: $\\varepsilon = \\left| \\frac{\\hat{A}}{A} - 1 \\right|$.\n- Test cases for frequency determination via $f = m \\frac{f_s}{N}$:\n    1. $m = 100$.\n    2. $m = 100.5$.\n    3. $m = 250.3$.\n    4. $m = \\frac{N}{2} - 5 + 0.37$.\n    5. $m = 75.01$.\n\nStep 2: Validate Using Extracted Givens\nThe problem is analyzed against the specified validation criteria.\n- **Scientifically Grounded**: The problem is built upon fundamental principles of digital signal processing (DSP), specifically the Discrete Fourier Transform (DFT), window functions, and spectral analysis. The concepts of spectral leakage, scalloping loss (the \"picket-fence effect\"), zero-padding for spectral interpolation, and window-specific gain normalization are all standard and well-established in computational physics and engineering. The provided formulas are correct representations of these concepts.\n- **Well-Posed**: The problem is specified with mathematical precision. All necessary constants ($f_s$, $N$, $A$, $Z$), functional forms (signal, DFT, windows), and procedures (amplitude estimation, error calculation) are explicitly defined. The test suite provides a concrete, finite set of inputs. This ensures that a unique and meaningful numerical solution can be systematically computed.\n- **Objective**: The language is entirely quantitative and formal. There are no subjective, ambiguous, or opinion-based statements.\n- **Flaw Checklist**: The problem does not violate any of the invalidity criteria. It is scientifically sound, fully formalized, self-contained, computationally feasible, and well-structured.\n\nStep 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\nThe objective is to compute and compare the amplitude measurement accuracy of a rectangular window versus a five-term Flat Top window for a sinusoidal signal. The comparison is made under various conditions where the signal frequency does not align perfectly with a DFT bin center, a common scenario that leads to measurement errors due to spectral leakage.\n\nThe computational procedure for each test case follows a sequence of steps derived from first principles.\n\n1.  **Signal Generation**: For each test case defined by a parameter $m$, the signal frequency $f$ is first calculated as $f = m \\frac{f_s}{N}$. The discrete-time signal $x_n$ of length $N$ is then synthesized according to the formula:\n    $$\n    x_n = A \\cos\\!\\left(2\\pi f \\frac{n}{f_s}\\right) \\quad \\text{for } n = 0, 1, \\dots, N-1\n    $$\n    Given $A=1.0$ and phase is $0$, this simplifies to $x_n = \\cos\\!\\left(2\\pi m \\frac{n}{N}\\right)$.\n\n2.  **Window Definition and Application**: Two window functions are used.\n    - The rectangular window is simply a sequence of ones:\n      $$\n      w_n^{(\\mathrm{rect})} = 1 \\quad \\text{for } n = 0, 1, \\dots, N-1\n      $$\n    - The five-term Flat Top window is constructed using the given coefficients:\n      $$\n      w_n^{(\\mathrm{ft})} = a_0 - a_1 \\cos\\!\\left(\\frac{2\\pi n}{N-1}\\right) + a_2 \\cos\\!\\left(\\frac{4\\pi n}{N-1}\\right) - a_3 \\cos\\!\\left(\\frac{6\\pi n}{N-1}\\right) + a_4 \\cos\\!\\left(\\frac{8\\pi n}{N-1}\\right)\n      $$\n      where $a_0 = 1.0$, $a_1 = 1.93$, $a_2 = 1.29$, $a_3 = 0.388$, and $a_4 = 0.028$.\n    For each window $w_n$, the signal $x_n$ is multiplied element-wise to produce the windowed signal $y_n = w_n x_n$. This step is crucial for reducing spectral leakage.\n\n3.  **Coherent Gain Calculation**: The coherent gain $G$ of a window corrects for the window's effect on the amplitude of a signal component that lies exactly on a DFT bin. It is the average value of the window sequence:\n    $$\n    G = \\frac{1}{N} \\sum_{n=0}^{N-1} w_n\n    $$\n    This value is computed for each of the two windows. For the rectangular window, $G=1$.\n\n4.  **Zero-Padding**: The windowed sequence $y_n$ of length $N$ is appended with $(Z-1)N$ zeros to create a new sequence of total length $M = ZN$. In this problem, $N=1024$ and $Z=32$, so $M=32768$. Zero-padding does not add information to the signal but interpolates its DFT spectrum, providing a much finer frequency grid. This allows for a more accurate estimation of the peak frequency and magnitude, especially for off-bin signals.\n\n5.  **DFT Computation**: The DFT of the zero-padded sequence is computed using the formula:\n    $$\n    X_k = \\sum_{n=0}^{M-1} y_n \\, e^{-j 2\\pi k n / M}\n    $$\n    Since $y_n=0$ for $n \\ge N$, this is equivalent to $\\sum_{n=0}^{N-1} y_n \\, e^{-j 2\\pi k n / M}$. This computation is typically performed using a Fast Fourier Transform (FFT) algorithm for efficiency.\n\n6.  **Amplitude Estimation**: The amplitude of the original sinusoid is estimated from the computed spectrum. The formula accounts for the energy split between positive and negative frequencies in the spectrum of a real signal and normalizes by the signal length and window gain:\n    $$\n    \\hat{A} = \\frac{2}{N G} \\max_{0 \\le k \\le \\left\\lfloor M/2 \\right\\rfloor} \\left| X_k \\right|\n    $$\n    The search for the maximum magnitude $|X_k|$ is restricted to the first half of the spectrum ($k$ from $0$ to $M/2$), as the spectrum of a real signal is conjugate-symmetric.\n\n7.  **Error Calculation**: Finally, the relative amplitude error $\\varepsilon$ is calculated to quantify the accuracy of the measurement. Since the true amplitude is given as $A=1.0$:\n    $$\n    \\varepsilon = \\left| \\frac{\\hat{A}}{A} - 1 \\right| = \\left| \\hat{A} - 1 \\right|\n    $$\n    This entire procedure is repeated for each of the five test cases and for both the rectangular and Flat Top windows, yielding a pair of error values $[\\varepsilon_{\\mathrm{rect}}, \\varepsilon_{\\mathrm{ft}}]$ for each case.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and compares the amplitude measurement error for a sinusoidal signal\n    using rectangular and Flat Top windows.\n    \"\"\"\n    # Define constants from the problem statement.\n    fs = 48000.0\n    N = 1024\n    A = 1.0\n    Z = 32\n    M = Z * N\n\n    # Define the test cases by the bin index 'm'.\n    # f = m * fs / N\n    test_cases_m = [\n        100.0,\n        100.5,\n        250.3,\n        (N / 2 - 5 + 0.37),\n        75.01,\n    ]\n\n    # Define the coefficients for the five-term Flat Top window.\n    a = [1.0, 1.93, 1.29, 0.388, 0.028]\n\n    # Generate the time vector for the signal and windows.\n    n_N = np.arange(N)\n\n    # Generate the window sequences.\n    # 1. Rectangular window\n    rect_window = np.ones(N)\n\n    # 2. Five-term Flat Top window\n    # w_n = a0 - a1*cos(2*pi*n/(N-1)) + a2*cos(4*pi*n/(N-1)) - ...\n    ft_window = (a[0]\n                 - a[1] * np.cos(2 * np.pi * n_N / (N - 1))\n                 + a[2] * np.cos(4 * np.pi * n_N / (N - 1))\n                 - a[3] * np.cos(6 * np.pi * n_N / (N - 1))\n                 + a[4] * np.cos(8 * np.pi * n_N / (N - 1)))\n\n    windows = [\n        (\"rect\", rect_window),\n        (\"ft\", ft_window),\n    ]\n\n    # List to store final results for all test cases.\n    all_results = []\n\n    # Iterate through each test case.\n    for m in test_cases_m:\n        # Calculate signal frequency.\n        f = m * fs / N\n        \n        # Generate the real-valued sinusoidal signal.\n        # x_n = A * cos(2*pi*f*n/fs) with A=1\n        x_n = np.cos(2 * np.pi * f * n_N / fs)\n\n        # List to store results for the current test case.\n        case_results = []\n\n        # Iterate through each window type.\n        for _, w_n in windows:\n            # 1. Calculate coherent gain G.\n            G = np.sum(w_n) / N\n\n            # 2. Apply window to the signal.\n            y_n = w_n * x_n\n\n            # 3. Zero-pad the windowed signal to length M.\n            y_n_padded = np.zeros(M)\n            y_n_padded[:N] = y_n\n\n            # 4. Compute the DFT.\n            X_k = np.fft.fft(y_n_padded)\n\n            # 5. Find the maximum magnitude in the first half of the spectrum.\n            # For real signals, the spectrum is symmetric, so we only need to check up to M/2.\n            max_Xk_mag = np.max(np.abs(X_k[0 : M // 2 + 1]))\n\n            # 6. Estimate the amplitude A_hat.\n            A_hat = (2.0 / (N * G)) * max_Xk_mag\n            \n            # 7. Calculate the relative amplitude error.\n            error = np.abs(A_hat / A - 1.0)\n            \n            case_results.append(error)\n        \n        all_results.append(case_results)\n\n    # Format and print the final output as specified.\n    # The output format should be like \"[[e1, e2], [e3, e4], ...]\"\n    # Using str() on a list of lists produces the desired format including spaces.\n    # To be more robust and match the boilerplate \"[{,}.join...]\", we build it.\n    final_string_parts = []\n    for res_pair in all_results:\n        final_string_parts.append(f\"[{res_pair[0]}, {res_pair[1]}]\")\n    \n    print(f\"[{', '.join(final_string_parts)}]\")\n\n\nsolve()\n```"
        }
    ]
}