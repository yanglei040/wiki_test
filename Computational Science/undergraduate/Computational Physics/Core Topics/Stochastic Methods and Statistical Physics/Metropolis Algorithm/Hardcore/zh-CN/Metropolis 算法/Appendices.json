{
    "hands_on_practices": [
        {
            "introduction": "在实践中，Metropolis 算法的接受准则常常通过一行简洁的代码实现。这项练习旨在挑战你分析一个常见的代码实现并验证其正确性。通过理解为何一个简单的条件语句能同时正确处理能量增加和减少的情况，你将能更深刻地领会该算法的精妙逻辑，并避免在自己编写代码时陷入常见误区。",
            "id": "1964945",
            "problem": "学生Alex正在为一个简单的二维格点气体模型编写一个Metropolis蒙特卡罗模拟程序。在这个模型中，粒子占据网格上的格点，系统的总能量 $E$ 是根据相邻粒子间的相互作用计算的。该模拟的目标是在给定温度 $T$ 下，从正则系综中抽样组态。\n\nAlex的模拟是分步进行的。在每一步中，都会提出一个试探移动（例如，将单个粒子移动到随机相邻的空位上）。设当前组态的能量为 $E_{old}$，提出的新组态的能量为 $E_{new}$。能量变化为 $\\Delta E = E_{new} - E_{old}$。\n\nAlex用下面这行伪代码实现了核心的接受/拒绝逻辑，其中 `rand()` 是一个返回区间 $[0, 1)$ 内均匀分布的随机浮点数的函数。如果条件为真，则接受该移动。\n\n`if rand()  exp(-ΔE / (k_B * T))`\n\n这里，$k_B$ 是玻尔兹曼常数。Alex运行模拟后发现，系统似乎正在达到一个合理的平衡态。然而，他们担心的是，他们的代码没有包含一个明确的 `if/else` 结构来区分增加能量的移动（$\\Delta E  0$）和减少能量的移动（$\\Delta E \\le 0$），而他们的教科书中正是这样介绍该算法的。\n\n以下哪个陈述对Alex的实现给出了最准确的分析？\n\nA. 该代码存在根本性缺陷，因为它永远不会接受降低系统能量的移动（$\\Delta E \\le 0$）。\n\nB. 该代码存在根本性缺陷，因为它会接受所有提议的移动，无论能量如何变化，从而阻止系统达到热平衡。\n\nC. 该代码能正常工作，因为对于任何降低能量的移动（$\\Delta E \\le 0$），项 $\\exp(-\\Delta E / (k_B T))$ 的计算结果大于或等于1，从而确保接受条件始终被满足。\n\nD. 该代码仅在高温极限（$k_B T \\gg |\\Delta E|$）下是正确的，此时指数项可以近似为1，但在低温下会失效。\n\nE. 该代码存在根本性缺陷，因为它没有以1的接受概率显式处理 $\\Delta E \\le 0$ 的情况，从而违反了细致平衡原理。",
            "solution": "令 $\\beta$ 表示逆温度，$\\beta = \\frac{1}{k_{B}T}$。在具有对称提议分布的Metropolis算法中，确保从正则系综中抽样并满足细致平衡的接受概率为\n$$\nA(\\Delta E) = \\min\\!\\left(1,\\exp(-\\beta \\Delta E)\\right).\n$$\nAlex的代码在满足以下条件时接受移动，其中 $r \\sim \\text{Uniform}[0,1)$ 是一个均匀随机变量\n$$\nr  \\exp(-\\beta \\Delta E).\n$$\n此规则实现的接受概率是事件 $\\{r  \\exp(-\\beta \\Delta E)\\}$ 相对于 $r$ 发生的概率。由于 $r$ 在 $[0,1)$ 上是均匀分布的，\n$$\nP(\\text{accept}) = \\int_{0}^{1} \\mathbf{1}\\{r  \\exp(-\\beta \\Delta E)\\} \\, dr.\n$$\n该积分根据 $\\exp(-\\beta \\Delta E)$ 相对于 $1$ 的值分段计算：\n\n1) 如果 $\\Delta E \\le 0$，那么 $-\\beta \\Delta E \\ge 0$，因此\n$$\n\\exp(-\\beta \\Delta E) \\ge 1.\n$$\n因为 $r \\in [0,1)$ 且 $\\exp(-\\beta \\Delta E) \\ge 1$，所以对于 $[0,1)$ 中的所有 $r$，不等式 $r  \\exp(-\\beta \\Delta E)$ 都成立。因此，\n$$\nP(\\text{accept}) = 1 = \\min\\!\\left(1,\\exp(-\\beta \\Delta E)\\right).\n$$\n特别地，当 $\\Delta E = 0$ 时，$\\exp(0) = 1$，并且由于对于 $r \\in [0,1)$ 几乎必然有 $r  1$，所以接受概率为1，符合要求。\n\n2) 如果 $\\Delta E  0$，那么 $-\\beta \\Delta E  0$，因此\n$$\n\\exp(-\\beta \\Delta E)  1,\n$$\n事件 $\\{r  \\exp(-\\beta \\Delta E)\\}$ 发生的概率恰好为 $\\exp(-\\beta \\Delta E)$，因为区间 $\\{r \\in [0,1) : r  \\exp(-\\beta \\Delta E)\\}$ 的长度是 $\\exp(-\\beta \\Delta E)$。因此，\n$$\nP(\\text{accept}) = \\exp(-\\beta \\Delta E) = \\min\\!\\left(1,\\exp(-\\beta \\Delta E)\\right).\n$$\n\n综合这两种情况，\n$$\nP(\\text{accept}) = \\min\\!\\left(1,\\exp(-\\beta \\Delta E)\\right),\n$$\n这恰好是为对称提议强制执行细致平衡的Metropolis接受准则。因此，Alex的单行条件隐式地实现了 $\\min$ 操作，因为 $r$ 被限制在 $[0,1)$ 区间内。它以概率1接受所有降低能量或能量不变的移动，并以概率 $\\exp(-\\beta \\Delta E)$ 接受增加能量的移动。因此：\n- 降低能量的移动不会被拒绝（排除A）。\n- 它不会接受所有移动（排除B）。\n- 它不局限于高温区域（排除D）。\n- 它没有违反细致平衡；正确的接受概率得以实现（排除E）。\n\n因此，最准确的陈述是，该代码在所有温度下都能正常工作，因为当 $\\Delta E \\le 0$ 时，$\\exp(-\\Delta E/(k_{B}T)) \\ge 1$，确保了移动被接受；而当 $\\Delta E  0$ 时，它能得出正确的概率性接受结果。",
            "answer": "$$\\boxed{C}$$"
        },
        {
            "introduction": "现在，让我们将该算法应用于一个具体的物理系统。本练习将引导你逐步完成一个蒙特卡洛模拟的前几个步骤，模拟对象是伊辛模型（Ising model）——统计物理学中用于描述磁性的一个基本模型。通过亲手计算能量变化并应用接受准则，你将直观地看到系统在热涨落的影响下如何从一个状态演化到另一个状态。",
            "id": "2005989",
            "problem": "考虑一个磁性材料的简化模型，该模型由一个2x2方形晶格上的四个经典自旋表示。自旋位于位置 $(i,j)$ 处，其中 $i,j \\in \\{1, 2\\}$，并记为 $s_{ij}$。每个自旋只能指向两个方向之一，由值 $s_{ij} = +1$ 或 $s_{ij} = -1$ 表示。系统的总能量由铁磁伊辛哈密顿量给出：\n$$H = -J \\sum_{\\langle (ij), (kl) \\rangle} s_{ij} s_{kl}$$\n其中求和遍及晶格上所有唯一的最近邻自旋对，而 $J$ 是一个正的耦合常数。系统初始处于铁磁基态，其中所有四个自旋都对齐：$s_{11} = s_{12} = s_{21} = s_{22} = +1$。\n\n系统通过蒙特卡洛模拟演化，与固定温度 $T$ 的热浴接触。模拟以离散步骤进行。在每一步中，选择一个自旋并尝试将其翻转（即改变其符号）。计算由提议的翻转引起的能量变化 $\\Delta E$。\n- 如果 $\\Delta E \\le 0$，翻转总是被接受。\n- 如果 $\\Delta E  0$，翻转以概率 $P = \\exp(-\\Delta E / (k_B T))$ 被接受，其中 $k_B$ 是玻尔兹曼常数。\n\n为了使此问题的过程确定化，概率性决策按如下方式处理：对于第 $k$ 次需要此类决策的移动，当且仅当计算出的概率 $P$ 大于给定的比较值 $R_k$ 时，该移动被接受。\n\n系统处于一个温度下，其热能由 $k_B T = \\frac{4J}{\\ln 2}$ 给出。模拟的两个步骤按照以下顺序执行：\n1.  尝试翻转自旋 $s_{11}$。如果需要，此步骤的比较值为 $R_1 = 0.4$。\n2.  从第一步产生的构型开始，尝试翻转自旋 $s_{22}$。如果需要，此步骤的比较值为 $R_2 = 0.4$。\n\n计算这两步之后系统的最终能量 $H_{final}/J$。你的答案应该是一个整数。",
            "solution": "我们考虑一个具有开放边界条件的2x2晶格，因此对唯一最近邻对的求和恰好包括四个键：$(11)-(12)$、$(11)-(21)$、$(12)-(22)$ 和 $(21)-(22)$。伊辛哈密顿量为 $H=-J\\sum_{\\langle (ij),(kl)\\rangle}s_{ij}s_{kl}$，其中 $J0$。在完全对齐的初始状态下，每对都有 $s_{ij}s_{kl}=+1$，因此初始能量为\n$$\nH_{0}=-J\\,(1+1+1+1)=-4J.\n$$\n\n在位置 $p$ 处的单自旋翻转仅改变接触该位置的键。能量变化的标准结果是\n$$\n\\Delta E=2J\\,s_{p}\\sum_{q\\in \\text{nn}(p)}s_{q},\n$$\n其中求和遍及 $p$ 的最近邻。对于 $\\Delta E0$ 的 Metropolis 接受概率是 $P=\\exp\\!\\big(-\\Delta E/(k_{B}T)\\big)$，此处的确定性规则是：当且仅当 $PR_{k}$ 时接受。\n\n步骤1：提议翻转 $s_{11}$。它的邻居是 $s_{12}$ 和 $s_{21}$，初始时均为 $+1$，且 $s_{11}=+1$。因此\n$$\n\\Delta E_{1}=2J\\,(+1)\\big[(+1)+(+1)\\big]=4J0.\n$$\n当 $k_{B}T=\\frac{4J}{\\ln 2}$ 时，接受概率为\n$$\nP_{1}=\\exp\\!\\left(-\\frac{\\Delta E_{1}}{k_{B}T}\\right)=\\exp\\!\\left(-\\frac{4J}{4J/\\ln 2}\\right)=\\exp(-\\ln 2)=2^{-1}.\n$$\n由于 $2^{-1}=0.5R_{1}=0.4$，翻转被接受。新的能量是\n$$\nH_{1}=H_{0}+\\Delta E_{1}=-4J+4J=0.\n$$\n\n步骤2：从此构型开始，提议翻转 $s_{22}$。它的邻居是 $s_{12}=+1$ 和 $s_{21}=+1$，且 $s_{22}=+1$，所以\n$$\n\\Delta E_{2}=2J\\,(+1)\\big[(+1)+(+1)\\big]=4J0.\n$$\n接受概率与之前相同，\n$$\nP_{2}=\\exp\\!\\left(-\\frac{4J}{4J/\\ln 2}\\right)=2^{-1}.\n$$\n由于 $2^{-1}=0.5R_{2}=0.4$，此翻转被接受。因此，最终能量为\n$$\nH_{\\text{final}}=H_{1}+\\Delta E_{2}=0+4J=4J,\n$$\n所以\n$$\n\\frac{H_{\\text{final}}}{J}=4.\n$$",
            "answer": "$$\\boxed{4}$$"
        },
        {
            "introduction": "一个高效的蒙特卡洛模拟不仅依赖于正确的接受准则，还取决于所提出的“移动”策略。这个问题要求你为一个二维晶格气体模型比较两种不同的移动方案。通过计算并比较它们的接受概率，你将探索移动集的设计如何影响模拟探索状态空间的效率。",
            "id": "2005984",
            "problem": "一个计算模型被用来模拟一种薄膜材料的行为，该材料被简化为二维格点气体。该系统由一个具有周期性边界条件的 $4 \\times 4$ 方形格点组成，这意味着格点的右边界与左边界相连，上边界与下边界相连。在这个格点上，有 $M=4$ 个全同、不可分辨的粒子。系统的总能量由相邻格点上粒子间的相互作用决定。能量由 $E = -\\epsilon \\sum_{\\langle i,j \\rangle} n_i n_j$ 给出，其中 $\\epsilon$ 是一个代表键能的正常数，求和遍及所有唯一的最近邻格点对 $\\langle i,j \\rangle$，$n_k$ 是格点 $k$ 的占据数（如果被占据，$n_k=1$；如果为空，$n_k=0$）。系统维持在恒定温度 $T$下，使得无量纲量 $\\frac{\\epsilon}{k_B T}$ 等于 $2.0$，其中 $k_B$ 是玻尔兹曼常数。\n\n模拟从一个初始构型 $C_0$ 开始，其中四个粒子位于坐标为 (1,1), (1,2), (2,1) 和 (4,4) 的格点上。坐标（行，列）是从1开始索引的。从这个初始状态出发，提出了两种不同的微观移动，并使用 Metropolis 算法评估它们的接受概率。\n\n- **移动 A：** 提议将位于格点 (1,2) 的粒子移动到空格点 (3,3)。\n- **移动 B：** 提议交换位于格点 (1,1) 的粒子和位于格点 (4,4) 的粒子。\n\n计算移动 A 的接受概率与移动 B 的接受概率之比，即 $P_{\\text{acc,A}} / P_{\\text{acc,B}}$。将最终答案四舍五入到三位有效数字。",
            "solution": "问题要求计算从同一初始构型 $C_0$ 开始的两种不同提议移动 A 和 B 的 Metropolis 接受概率之比。从能量为 $E_i$ 的状态移动到能量为 $E_f$ 的状态，其接受概率 $P_{\\text{acc}}$ 由 $P_{\\text{acc}} = \\min(1, \\exp(-\\Delta E/k_B T))$ 给出，其中 $\\Delta E = E_f - E_i$。\n\n首先，我们必须计算初始构型 $C_0$ 的能量。粒子位于格点 (1,1), (1,2), (2,1) 和 (4,4) 上。能量是 $E = -\\epsilon$ 乘以最近邻键的数量。我们必须检查所有被占据格点的已占据邻居，同时要考虑 $4 \\times 4$ 格点的周期性边界条件。\n- 格点 (1,1) 的邻居是 (1,2), (2,1), (1,4) 和 (4,1)。被占据的邻居是 (1,2) 和 (2,1)。\n- 格点 (1,2) 的邻居是 (1,1), (2,2), (1,3) 和 (4,2)。唯一被占据的邻居是 (1,1)。\n- 格点 (2,1) 的邻居是 (1,1), (2,2), (3,1) 和 (4,1)。唯一被占据的邻居是 (1,1)。\n- 格点 (4,4) 的邻居是 (4,3), (1,4), (4,1) 和 (3,4)。这些邻居都没有被占据。\n唯一的键存在于 ((1,1), (1,2)) 和 ((1,1), (2,1)) 之间。共有2个这样的键。\n所以，初始能量为 $E_0 = -2\\epsilon$。\n\n接下来，我们分析移动 A。一个粒子从 (1,2) 移动到 (3,3)。新构型 $C_A$ 中，粒子位于 (1,1), (2,1), (3,3) 和 (4,4)。我们计算这个新状态的能量 $E_A$。\n- (1,1) 的邻居是 (1,2), (2,1), (1,4), (4,1)。唯一被占据的邻居是 (2,1)。\n- (2,1) 的邻居是 (1,1), (2,2), (3,1), (4,1)。唯一被占据的邻居是 (1,1)。\n- 格点 (3,3) 和 (4,4) 没有被占据的邻居。\n唯一的键存在于 (1,1) 和 (2,1) 之间。只有1个这样的键。\n所以，构型 $C_A$ 的能量为 $E_A = -1\\epsilon = -\\epsilon$。\n\n移动 A 的能量变化为 $\\Delta E_A = E_A - E_0 = (-\\epsilon) - (-2\\epsilon) = \\epsilon$。\n移动 A 的接受概率为 $P_{\\text{acc,A}} = \\min(1, \\exp(-\\Delta E_A / k_B T))$。因为 $\\epsilon0$，所以 $\\Delta E_A  0$，因此概率小于1。\n$P_{\\text{acc,A}} = \\exp(-\\epsilon / k_B T)$。\n\n现在，我们分析移动 B。这个移动提议交换位于 (1,1) 的粒子和位于 (4,4) 的粒子。问题陈述中提到粒子是全同且不可分辨的。交换两个不可分辨的粒子不会产生新的物理构型。被占据的格点集合仍然是 {(1,1), (1,2), (2,1), (4,4)}，这与初始构型 $C_0$ 相同。\n因此，最终构型 $C_B$ 与初始构型 $C_0$ 相同。\n最终能量 $E_B$ 等于初始能量 $E_0$。\n移动 B 的能量变化为 $\\Delta E_B = E_B - E_0 = E_0 - E_0 = 0$。\n移动 B 的接受概率为 $P_{\\text{acc,B}} = \\min(1, \\exp(-\\Delta E_B / k_B T)) = \\min(1, \\exp(0)) = \\min(1,1) = 1$。\n\n最后，我们计算所求的比率 $R = P_{\\text{acc,A}} / P_{\\text{acc,B}}$。\n$R = \\frac{\\exp(-\\epsilon / k_B T)}{1} = \\exp(-\\epsilon / k_B T)$。\n题目给定无量纲量 $\\frac{\\epsilon}{k_B T} = 2.0$。\n代入此值，我们得到 $R = \\exp(-2.0)$。\n\n为了得到数值答案，我们计算其值并四舍五入到三位有效数字。\n$R = \\exp(-2.0) \\approx 0.135335...$\n四舍五入到三位有效数字得到 $0.135$。",
            "answer": "$$\\boxed{0.135}$$"
        }
    ]
}