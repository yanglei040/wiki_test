{
    "hands_on_practices": [
        {
            "introduction": "Our journey into the practical application of the Bethe-Salpeter equation begins with the fundamental task of constructing the excitonic Hamiltonian. This exercise guides you through implementing a simplified BSE Hamiltonian within the Tamm-Dancoff approximation, where the electron-hole exchange interaction is neglected. By building the Hamiltonian matrix and calculating its eigenvalues, you will directly observe the resulting spin-degeneracy of the excitonic spectrum, a key consequence of this approximation. ",
            "id": "2463511",
            "problem": "Consider a minimal model of the Bethe-Salpeter equation (BSE) for neutral excitations in the Tamm–Dancoff approximation (TDA), where only the resonant electron–hole subspace is retained. Let the set of valence band energies be $\\{E_{v_i}\\}$ and the set of conduction band energies be $\\{E_{c_a}\\}$, both expressed in electronvolts (eV). Define a basis of electron–hole transitions labeled by pairs $(i,a)$ with $i$ indexing valence states and $a$ indexing conduction states. For each spin $s \\in \\{\\uparrow,\\downarrow\\}$, define the basis states $\\lvert v_i \\to c_a, s \\rangle$. In the Tamm–Dancoff approximation and neglecting the electron–hole exchange term (i.e., set the screened exchange kernel to zero, $W_c = 0$), the excitonic Hamiltonian for neutral excitations is\n$$\nH_{(i a s),(j b s')} \\;=\\; \\delta_{i j}\\,\\delta_{a b}\\,\\delta_{s s'}\\,(E_{c_a} - E_{v_i}) \\;-\\; W^{\\mathrm{d}}_{(i a),(j b)},\n$$\nwhere $W^{\\mathrm{d}}_{(i a),(j b)}$ is the screened direct electron–hole attraction (expressed in electronvolts), independent of spin and symmetric in its pair indices, and $\\delta$ denotes the Kronecker delta. The spin structure implies that the full Hamiltonian is block-diagonal with two identical blocks (one per spin), because $W^{\\mathrm{d}}$ does not couple different spins when the exchange term is neglected. Consequently, the excitonic spectrum is expected to be spin-degenerate.\n\nYour task is to write a complete, runnable program that, for each of the following test cases, constructs the spinless block Hamiltonian $H^{(0)}$ of dimension $N \\times N$ with elements\n$$\nH^{(0)}_{(i a),(j b)} \\;=\\; \\delta_{i j}\\,\\delta_{a b}\\,(E_{c_a} - E_{v_i}) \\;-\\; W^{\\mathrm{d}}_{(i a),(j b)},\n$$\nand the full spinful Hamiltonian $H$ of dimension $(2N) \\times (2N)$, which is the direct sum of two identical copies of $H^{(0)}$. For each test case, compute:\n1. The sorted list of all $N$ eigenvalues of $H^{(0)}$ (the spinless exciton energies), each reported in electronvolts (eV) rounded to three decimal places.\n2. A boolean value indicating whether the spectrum of $H$ is exactly two identical copies of the spectrum of $H^{(0)}$ within an absolute tolerance of $10^{-6}$ electronvolts (i.e., spin-degenerate).\n\nExpress all energies in electronvolts (eV). Angles do not appear in this problem. The final program output must be a single line containing the results for all test cases as a comma-separated list enclosed in square brackets, where each test case result is itself a two-element list of the form [list_of_eigenvalues_of_$H^{(0)}$, degeneracy_boolean]. The numerical entries in the inner lists must be rounded to three decimal places.\n\nUse the following test suite. In all cases, the transition index ordering for $W^{\\mathrm{d}}$ is the lexicographic ordering of pairs $(i,a)$ with $i$ running first, then $a$.\n\nTest Case 1 (happy path, moderate diagonal screening, multiple transitions):\n- Valence energies: $E_{v} = [-1.00, -0.50]$ eV.\n- Conduction energies: $E_{c} = [1.50, 2.00]$ eV.\n- Transition ordering: $(0,0),(0,1),(1,0),(1,1)$.\n- Screened direct interaction matrix $W^{\\mathrm{d}}$ (in eV):\n$$\nW^{\\mathrm{d}} = \\begin{pmatrix}\n0.30 & 0.00 & 0.00 & 0.00\\\\\n0.00 & 0.25 & 0.00 & 0.00\\\\\n0.00 & 0.00 & 0.20 & 0.00\\\\\n0.00 & 0.00 & 0.00 & 0.28\n\\end{pmatrix}.\n$$\n\nTest Case 2 (boundary case, no screening, single transition):\n- Valence energies: $E_{v} = [-1.00]$ eV.\n- Conduction energies: $E_{c} = [1.80]$ eV.\n- Transition ordering: $(0,0)$.\n- Screened direct interaction matrix $W^{\\mathrm{d}}$ (in eV):\n$$\nW^{\\mathrm{d}} = \\begin{pmatrix}\n0.00\n\\end{pmatrix}.\n$$\n\nTest Case 3 (edge case, degenerate single-particle gaps with off-diagonal coupling):\n- Valence energies: $E_{v} = [-1.00]$ eV.\n- Conduction energies: $E_{c} = [1.00, 1.00]$ eV.\n- Transition ordering: $(0,0),(0,1)$.\n- Screened direct interaction matrix $W^{\\mathrm{d}}$ (in eV):\n$$\nW^{\\mathrm{d}} = \\begin{pmatrix}\n0.40 & 0.30\\\\\n0.30 & 0.40\n\\end{pmatrix}.\n$$\n\nYour program must:\n- Build $H^{(0)}$ and $H$ for each test case according to the definitions above.\n- Compute the eigenvalues of $H^{(0)}$ and $H$ in electronvolts.\n- Round the eigenvalues of $H^{(0)}$ to three decimal places and sort them in ascending order for reporting.\n- Determine whether the eigenvalues of $H$ equal two concatenated copies of the eigenvalues of $H^{(0)}$ within an absolute tolerance of $10^{-6}$ electronvolts, returning a boolean per test case.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to one test case and is itself a two-element list containing the sorted, rounded eigenvalues of $H^{(0)}$ (in eV) and the degeneracy boolean. For example, the output must look like\n$[$[eigs\\_case1,degeneracy\\_case1],[eigs\\_case2,degeneracy\\_case2],[eigs\\_case3,degeneracy\\_case3]$]$,\nwith numerical entries rounded to three decimals.",
            "solution": "The Bethe-Salpeter equation (BSE) for neutral excitations can be formulated as an effective eigenvalue problem in the space of electron–hole transitions. Within the Tamm–Dancoff approximation (TDA), one retains only the resonant block, which yields a Hermitian eigenproblem for the excitonic Hamiltonian. In second-quantized language, the basis states are particle–hole excitations $\\lvert v_i \\to c_a \\rangle$, and the Hamiltonian matrix elements combine independent-particle energy differences with interaction kernels.\n\nLet the valence band energies be $\\{E_{v_i}\\}$ and the conduction band energies be $\\{E_{c_a}\\}$. The independent-particle contribution to the excitation energies is given by the diagonal matrix with entries $E_{c_a} - E_{v_i}$ for each transition $(i,a)$. Electron–hole interactions enter through two kernels: the screened direct attraction $W^{\\mathrm{d}}$ and the screened exchange term $W_c$. When the screened exchange is neglected by setting $W_c = 0$, the spin structure decouples because $W^{\\mathrm{d}}$ is spin-independent and does not connect different spin sectors. Consequently, the full Hamiltonian $H$ in the spinful basis $\\lvert v_i \\to c_a, s \\rangle$ with $s \\in \\{\\uparrow,\\downarrow\\}$ is block-diagonal:\n$$\nH \\;=\\; \\begin{pmatrix}\nH^{(0)} & 0\\\\\n0 & H^{(0)}\n\\end{pmatrix},\n$$\nwhere $H^{(0)}$ is the spinless block defined by\n$$\nH^{(0)}_{(i a),(j b)} \\;=\\; \\delta_{i j}\\,\\delta_{a b}\\,(E_{c_a} - E_{v_i}) \\;-\\; W^{\\mathrm{d}}_{(i a),(j b)}.\n$$\nHere, $W^{\\mathrm{d}}$ is a symmetric matrix encoding the screened direct interaction. The negative sign in front of $W^{\\mathrm{d}}$ reflects the attractive nature of the electron–hole interaction, which lowers the excitation energies relative to the independent-particle gaps. Since $H$ is a direct sum of two identical blocks, its spectrum is the union of the spectrum of $H^{(0)}$ with itself. Therefore, every eigenvalue of $H^{(0)}$ appears twice in the spectrum of $H$, establishing spin degeneracy in this approximation.\n\nAlgorithmic design consistent with these principles proceeds as follows:\n1. For each test case, enumerate the transitions $(i,a)$ in lexicographic order with $i$ (valence index) running slowest and $a$ (conduction index) running fastest. Let the number of transitions be $N$.\n2. Form the vector of independent-particle gaps $\\Delta_{(i a)} = E_{c_a} - E_{v_i}$, each in electronvolts. Construct the diagonal matrix $\\mathrm{diag}(\\Delta)$.\n3. Subtract the screened direct interaction matrix to obtain $H^{(0)} = \\mathrm{diag}(\\Delta) - W^{\\mathrm{d}}$.\n4. Construct the spinful Hamiltonian $H$ as the block-diagonal direct sum $H = H^{(0)} \\oplus H^{(0)}$, yielding a $(2N) \\times (2N)$ matrix.\n5. Compute the eigenvalues of $H^{(0)}$ and $H$. Since $H^{(0)}$ is symmetric (Hermitian) by construction, the eigenvalues are real. Sort the eigenvalues of $H^{(0)}$ in ascending order and round each to three decimal places for reporting in electronvolts.\n6. To verify spin degeneracy, sort the eigenvalues of $H$ and compare them elementwise to the sorted concatenation of two copies of the eigenvalues of $H^{(0)}$, using an absolute tolerance of $10^{-6}$ electronvolts. If all elements match within this tolerance, the degeneracy boolean is true.\n\nNow apply this to the provided test suite.\n\nTest Case 1:\n- $E_{v} = [-1.00, -0.50]$ eV and $E_{c} = [1.50, 2.00]$ eV produce the independent-particle gaps (in the transition order $(0,0),(0,1),(1,0),(1,1)$): $(2.50, 3.00, 2.00, 2.50)$ eV.\n- The screened direct matrix $W^{\\mathrm{d}}$ is diagonal with entries $(0.30, 0.25, 0.20, 0.28)$ eV. Therefore,\n$$\nH^{(0)} = \\mathrm{diag}(2.50, 3.00, 2.00, 2.50) - \\mathrm{diag}(0.30, 0.25, 0.20, 0.28) = \\mathrm{diag}(2.20, 2.75, 1.80, 2.22)\\ \\text{eV}.\n$$\n- The eigenvalues of $H^{(0)}$ are $(1.80, 2.20, 2.22, 2.75)$ eV. The full spinful matrix $H$ is the direct sum of two identical $H^{(0)}$, hence every eigenvalue appears twice and the degeneracy check is satisfied.\n\nTest Case 2:\n- $E_{v} = [-1.00]$ eV and $E_{c} = [1.80]$ eV give one gap $\\Delta = 2.80$ eV.\n- $W^{\\mathrm{d}} = [0.00]$ eV. Thus $H^{(0)} = [2.80]$ eV and its only eigenvalue is $2.80$ eV.\n- The full $H$ has two identical eigenvalues $2.80$ eV, so the degeneracy check is satisfied.\n\nTest Case 3:\n- $E_{v} = [-1.00]$ eV and $E_{c} = [1.00, 1.00]$ eV yield two identical gaps $(2.00, 2.00)$ eV.\n- With\n$$\nW^{\\mathrm{d}} = \\begin{pmatrix}0.40 & 0.30\\\\ 0.30 & 0.40\\end{pmatrix}\\ \\text{eV},\n$$\nwe obtain\n$$\nH^{(0)} = \\begin{pmatrix}2.00 & 0\\\\ 0 & 2.00\\end{pmatrix} - \\begin{pmatrix}0.40 & 0.30\\\\ 0.30 & 0.40\\end{pmatrix} = \\begin{pmatrix}1.60 & -0.30\\\\ -0.30 & 1.60\\end{pmatrix}\\ \\text{eV}.\n$$\n- The eigenvalues of this $2 \\times 2$ symmetric matrix are $1.60 \\pm 0.30$, i.e., $(1.30, 1.90)$ eV. The full spinful $H$ consists of two copies of this block, hence each of these energies appears exactly twice and the degeneracy check is satisfied.\n\nIn all cases, energies are reported in electronvolts and rounded to three decimal places as required. The degeneracy boolean is true across the test suite, reflecting the expected spin degeneracy when the exchange term is neglected ($W_c = 0$).",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef build_spinless_h(ev, ec, Wd):\n    \"\"\"\n    Build the spinless Tamm–Dancoff Bethe–Salpeter Hamiltonian H^(0)\n    given valence energies ev, conduction energies ec, and the screened direct\n    interaction matrix Wd provided in the lexicographic transition ordering.\n    \"\"\"\n    ev = np.array(ev, dtype=float)\n    ec = np.array(ec, dtype=float)\n    nv = ev.size\n    nc = ec.size\n    # Construct the independent-particle gaps in lexicographic order: (i,a) with i running first then a\n    gaps = []\n    for i in range(nv):\n        for a in range(nc):\n            gaps.append(ec[a] - ev[i])\n    gaps = np.array(gaps, dtype=float)\n    # Validate Wd shape\n    N = gaps.size\n    Wd = np.array(Wd, dtype=float)\n    if Wd.shape != (N, N):\n        raise ValueError(\"Wd shape does not match number of transitions\")\n    # Build H0 = diag(gaps) - Wd\n    H0 = np.diag(gaps) - Wd\n    # Symmetrize numerically to avoid small asymmetries\n    H0 = 0.5 * (H0 + H0.T)\n    return H0\n\ndef spinful_from_spinless(H0):\n    \"\"\"Construct the spinful Hamiltonian as a direct sum of two identical blocks.\"\"\"\n    return np.block([[H0, np.zeros_like(H0)], [np.zeros_like(H0), H0]])\n\ndef eigen_sorted(H):\n    \"\"\"Compute sorted eigenvalues of a symmetric matrix.\"\"\"\n    vals = np.linalg.eigh(H)[0]\n    vals.sort()\n    return vals\n\ndef degeneracy_check(vals_spinless, vals_spinful, atol=1e-6):\n    \"\"\"\n    Check if the spinful eigenvalues equal two copies of spinless eigenvalues\n    (elementwise after sorting) within absolute tolerance atol.\n    \"\"\"\n    rep = np.sort(np.concatenate([vals_spinless, vals_spinless]))\n    if rep.shape != vals_spinful.shape:\n        return False\n    return np.allclose(rep, vals_spinful, atol=atol, rtol=0.0)\n\ndef format_result(eigs, flag):\n    \"\"\"Format one test case result as [list_of_rounded_eigs,boolean] with strict formatting.\"\"\"\n    eigs_rounded = [f\"{x:.3f}\" for x in eigs]\n    inner = \"[\" + \",\".join(eigs_rounded) + \"]\"\n    return \"[\" + inner + \",\" + (\"True\" if flag else \"False\") + \"]\"\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (ev, ec, Wd)\n    test_cases = [\n        # Test Case 1\n        (\n            [-1.00, -0.50],  # ev (eV)\n            [1.50, 2.00],    # ec (eV)\n            [\n                [0.30, 0.00, 0.00, 0.00],\n                [0.00, 0.25, 0.00, 0.00],\n                [0.00, 0.00, 0.20, 0.00],\n                [0.00, 0.00, 0.00, 0.28],\n            ],\n        ),\n        # Test Case 2\n        (\n            [-1.00],         # ev (eV)\n            [1.80],          # ec (eV)\n            [\n                [0.00],\n            ],\n        ),\n        # Test Case 3\n        (\n            [-1.00],         # ev (eV)\n            [1.00, 1.00],    # ec (eV)\n            [\n                [0.40, 0.30],\n                [0.30, 0.40],\n            ],\n        ),\n    ]\n\n    results = []\n    for ev, ec, Wd in test_cases:\n        H0 = build_spinless_h(ev, ec, Wd)\n        H = spinful_from_spinless(H0)\n        vals0 = eigen_sorted(H0)\n        vals = eigen_sorted(H)\n        is_degenerate = degeneracy_check(vals0, vals, atol=1e-6)\n        # Prepare rounded eigenvalues of H0 (in eV)\n        results.append(format_result(vals0, is_degenerate))\n\n    # Final print statement in the exact required format.\n    print(\"[\" + \",\".join(results) + \"]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Solving the BSE eigenvalue problem yields not only the exciton energies but also the corresponding eigenvectors, which describe the exciton's quantum state. This practice delves into the physical interpretation of these eigenvectors, often called exciton wavefunctions. You will learn how to decompose an exciton into its constituent electron-hole pair transitions, allowing you to quantify the \"character\" of the excitation and identify which single-particle transitions are most dominant. ",
            "id": "2463513",
            "problem": "Consider the lowest-energy neutral excitation (exciton) in a simple diatomic molecule within the framework of the Bethe-Salpeter equation (BSE). In the Tamm-Dancoff approximation (TDA), the exciton is expanded in a basis of single-particle electron-hole transitions (valence-to-conduction), indexed by an integer label. Let there be $N$ such transitions, with independent-particle transition energies $\\Delta_i$ in electronvolts (eV) for $i \\in \\{0,1,\\dots,N-1\\}$. Let $K_{ij}$ in electronvolts (eV) be the static screened electron-hole interaction kernel (assumed real and symmetric). Define the excitonic Hamiltonian matrix $H$ with elements\n$$\nH_{ij} = \\Delta_i \\delta_{ij} + K_{ij},\n$$\nwhere $\\delta_{ij}$ is the Kronecker delta. The exciton energies $\\Omega$ and amplitudes $A_i$ are obtained from the eigenvalue problem\n$$\n\\sum_{j=0}^{N-1} H_{ij} A_j = \\Omega A_i.\n$$\nFor the lowest-energy exciton (the eigenvector corresponding to the smallest eigenvalue), define the contribution (weight) of transition $i$ to the exciton wavefunction as\n$$\nw_i = \\frac{|A_i|^2}{\\sum_{j=0}^{N-1} |A_j|^2},\n$$\nwhich is dimensionless and satisfies $\\sum_{i=0}^{N-1} w_i = 1$.\n\nYour task is to compute, for each test case below, the list of weights $[w_0, w_1, \\dots, w_{N-1}]$ corresponding to the lowest-energy exciton. All energies must be treated in electronvolts, but the requested outputs (the weights) are dimensionless numbers. Each weight must be reported rounded to six decimal places as a decimal number.\n\nTest Suite (each case specifies $N$, the vector $\\Delta$ in electronvolts, and the matrix $K$ in electronvolts):\n- Case $1$: $N = 1$, $\\Delta = [\\,2.0\\,]$ eV, $K = \\begin{bmatrix} -0.4 \\end{bmatrix}$ eV.\n- Case $2$: $N = 2$, $\\Delta = [\\,2.0,\\,2.3\\,]$ eV, $K = \\begin{bmatrix} -0.5 & 0.0 \\\\ 0.0 & -0.2 \\end{bmatrix}$ eV.\n- Case $3$: $N = 2$, $\\Delta = [\\,2.1,\\,2.2\\,]$ eV, $K = \\begin{bmatrix} -0.4 & -0.05 \\\\ -0.05 & -0.3 \\end{bmatrix}$ eV.\n- Case $4$: $N = 3$, $\\Delta = [\\,2.5,\\,2.5,\\,2.5\\,]$ eV, $K$ has all diagonal entries $-0.3$ and all off-diagonal entries $-0.05$ eV, i.e., $K = \\begin{bmatrix} -0.3 & -0.05 & -0.05 \\\\ -0.05 & -0.3 & -0.05 \\\\ -0.05 & -0.05 & -0.3 \\end{bmatrix}$ eV.\n- Case $5$: $N = 2$, $\\Delta = [\\,2.0,\\,2.0\\,]$ eV, $K = \\begin{bmatrix} -0.3 & 0.2 \\\\ 0.2 & -0.3 \\end{bmatrix}$ eV.\n\nFinal Output Format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each result must itself be a list of the weights in the order of the input transitions for that case, with each weight rounded to six decimal places. For example, a valid overall output could look like $[[\\,\\dots\\,],[\\,\\dots\\,],\\dots]$ with no extra text.",
            "solution": "The problem statement is critically examined and found to be valid. It is scientifically grounded in the principles of quantum mechanics as applied to computational chemistry and condensed matter physics, specifically the theory of excitons. The formulation adheres to the standard Bethe-Salpeter equation within the Tamm-Dancoff approximation (BSE/TDA). The problem is well-posed, providing all necessary parameters and definitions for a unique solution to be determined via standard methods of linear algebra.\n\nThe task is to find the weights $w_i$ of each electron-hole pair transition for the lowest-energy exciton. This requires solving the eigenvalue problem for the excitonic Hamiltonian matrix $H$. The procedure for each test case is as follows.\n\n1.  **Construction of the Excitonic Hamiltonian $H$**: The Hamiltonian matrix $H$ of size $N \\times N$ is constructed based on the given independent-particle transition energies $\\Delta_i$ and the electron-hole interaction kernel $K_{ij}$. The elements of $H$ are given by the formula:\n    $$\n    H_{ij} = \\Delta_i \\delta_{ij} + K_{ij}\n    $$\n    Here, $\\delta_{ij}$ is the Kronecker delta, which is $1$ if $i=j$ and $0$ otherwise. This means the diagonal elements of $H$ are $H_{ii} = \\Delta_i + K_{ii}$, and the off-diagonal elements are $H_{ij} = K_{ij}$ for $i \\neq j$. Both $\\Delta$ and $K$ are given in units of electronvolts (eV), so the resulting Hamiltonian $H$ also has units of eV. Since $K$ is stipulated to be real and symmetric, and the diagonal matrix formed from the vector $\\Delta$ is also real and symmetric, $H$ is a real, symmetric matrix.\n\n2.  **Solution of the Eigenvalue Problem**: We must solve the eigenvalue equation for the exciton energies $\\Omega$ (the eigenvalues) and the exciton amplitudes $A$ (the eigenvectors):\n    $$\n    H A = \\Omega A\n    $$\n    For a real symmetric matrix $H$ of size $N \\times N$, there exist $N$ real eigenvalues $\\Omega_k$ and a corresponding set of $N$ mutually orthogonal eigenvectors $A^{(k)}$, for $k \\in \\{0, 1, \\dots, N-1\\}$. We are interested in the lowest-energy exciton, which corresponds to the smallest eigenvalue, $\\Omega_{\\text{min}} = \\min_k\\{\\Omega_k\\}$. Let the eigenvector corresponding to $\\Omega_{\\text{min}}$ be $A = (A_0, A_1, \\dots, A_{N-1})^T$. Standard numerical algorithms, such as those implemented in `numpy.linalg.eigh`, are employed to find the eigenvalues and eigenvectors. These algorithms return eigenvalues in ascending order and the corresponding eigenvectors as columns of a matrix. The eigenvectors are also guaranteed to be normalized.\n\n3.  **Calculation of Transition Weights $w_i$**: The contribution, or weight $w_i$, of the $i$-th electron-hole transition to this lowest-energy exciton is defined as the squared magnitude of the corresponding component of the normalized eigenvector:\n    $$\n    w_i = \\frac{|A_i|^2}{\\sum_{j=0}^{N-1} |A_j|^2}\n    $$\n    If the eigenvector $A$ is normalized such that $\\sum_{j=0}^{N-1} |A_j|^2 = 1$, which is the case for the output of standard numerical libraries, this simplifies to:\n    $$\n    w_i = |A_i|^2\n    $$\n    Since $H$ is a real matrix, the eigenvectors $A_i$ can be chosen to be real, and thus $w_i = A_i^2$. The set of weights $\\{w_i\\}$ for $i \\in \\{0, 1, \\dots, N-1\\}$ forms a probability distribution, satisfying $\\sum_i w_i = 1$. The final step involves computing these weights for each test case and rounding the results to six decimal places as required.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the BSE/TDA eigenvalue problem for several test cases to find\n    the weights of the constituent transitions for the lowest-energy exciton.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"N\": 1,\n            \"delta\": np.array([2.0]),\n            \"K\": np.array([[-0.4]])\n        },\n        {\n            \"N\": 2,\n            \"delta\": np.array([2.0, 2.3]),\n            \"K\": np.array([[-0.5, 0.0], [0.0, -0.2]])\n        },\n        {\n            \"N\": 2,\n            \"delta\": np.array([2.1, 2.2]),\n            \"K\": np.array([[-0.4, -0.05], [-0.05, -0.3]])\n        },\n        {\n            \"N\": 3,\n            \"delta\": np.array([2.5, 2.5, 2.5]),\n            \"K\": np.array([[-0.3, -0.05, -0.05], [-0.05, -0.3, -0.05], [-0.05, -0.05, -0.3]])\n        },\n        {\n            \"N\": 2,\n            \"delta\": np.array([2.0, 2.0]),\n            \"K\": np.array([[-0.3, 0.2], [0.2, -0.3]])\n        }\n    ]\n\n    results_str = []\n    for case in test_cases:\n        delta = case[\"delta\"]\n        K = case[\"K\"]\n\n        # 1. Construct the Hamiltonian matrix H.\n        # H_ij = Delta_i * delta_ij + K_ij\n        H = np.diag(delta) + K\n\n        # 2. Solve the eigenvalue problem.\n        # H is real and symmetric, so use eigh for efficiency and stability.\n        # eigh returns eigenvalues in ascending order and corresponding normalized eigenvectors as columns.\n        eigenvalues, eigenvectors = np.linalg.eigh(H)\n\n        # 3. Identify the eigenvector for the lowest-energy exciton.\n        # This is the first column of the eigenvectors matrix, corresponding to the smallest eigenvalue.\n        lowest_energy_eigenvector = eigenvectors[:, 0]\n\n        # 4. Calculate the weights.\n        # w_i = |A_i|^2. Since the eigenvector is normalized, sum(|A_i|^2) = 1.\n        weights = np.square(lowest_energy_eigenvector)\n\n        # 5. Format the output for this case.\n        # The output format is a string like '[w0,w1,...]' without spaces.\n        case_result_str = f\"[{','.join([f'{w:.6f}' for w in weights])}]\"\n        results_str.append(case_result_str)\n\n    # Final print statement in the exact required format.\n    # The output is a string representation of a list of lists of weights,\n    # for example: [[w0,w1],[w0,w1,w2],...]\n    print(f\"[{','.join(results_str)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "A crucial aspect of any computational model is ensuring the results are reliable and independent of artificial parameters, such as the size of the basis set. This exercise addresses the fundamental concept of convergence in the context of BSE calculations. By systematically increasing the number of conduction bands included in the model, you will investigate how the exciton binding energy changes and determine the basis size needed to achieve a result converged to a specified numerical tolerance. ",
            "id": "2463564",
            "problem": "You are asked to design and implement a program that quantifies the convergence of the exciton binding energy in a simplified Bethe-Salpeter Equation (BSE) model as a function of the number of empty (conduction) bands included. Work within the Tamm–Dancoff approximation (resonant block only) and use a minimal, physically consistent model constructed from first principles.\n\nStart from the following fundamental base: in many-body perturbation theory, electron–hole excitations in an insulator or semiconductor can be modeled as eigenstates of an effective two-particle Hamiltonian whose resonant block is the sum of an independent-particle part and an attractive screened interaction kernel. In a finite basis of transitions from occupied (valence) bands to unoccupied (conduction) bands, adding more conduction bands expands the variational space and can only lower the ground-state eigenvalue by the Rayleigh–Ritz variational principle. The exciton binding energy is defined as the difference between the independent-particle gap and the lowest exciton energy.\n\nModel the resonant BSE Hamiltonian in a transition basis labeled by an index $i \\in \\{0,1,\\dots,N-1\\}$, where $N$ is the number of included conduction bands. Let the independent-particle transition energies be\n$$\n\\Omega_i = E_{\\mathrm{g}} + i\\,\\Delta_{\\mathrm{c}},\n$$\nwith $E_{\\mathrm{g}}$ the independent-particle band gap and $\\Delta_{\\mathrm{c}}$ the energy spacing between successive conduction states. Use a rank-one, attractive, separable screened interaction kernel,\n$$\nK_{ij} = -\\alpha\\,u_i\\,u_j,\\quad\\text{with}\\quad u_i = (i+1)^{-p/2},\n$$\nwhere $\\alpha$ is a positive coupling strength and $p$ is a dimensionless exponent controlling the decay of couplings with transition index. The Hamiltonian matrix is then\n$$\nH^{(N)}_{ij} = \\delta_{ij}\\,\\Omega_i + K_{ij}.\n$$\nFor a given $N$, define the lowest exciton energy as the smallest eigenvalue $E_0^{(N)}$ of $H^{(N)}$, and the exciton binding energy as\n$$\nE_{\\mathrm{bind}}^{(N)} = E_{\\mathrm{g}} - E_0^{(N)}.\n$$\nBy construction, $E_{\\mathrm{bind}}^{(N)} \\ge 0$. As $N$ increases, $E_{\\mathrm{bind}}^{(N)}$ should be non-decreasing and approach a finite limit in this model.\n\nYour task is to implement a program that:\n1. For each parameter set in the test suite below, evaluates $E_{\\mathrm{bind}}^{(N)}$ for a monotone increasing sequence of $N$ values.\n2. Determines the smallest $N$ (denote it $N_{\\star}$) at which the absolute change in binding energy with respect to the previous $N$ in the sequence is less than a prescribed tolerance $\\tau$, that is,\n$$\n\\left|E_{\\mathrm{bind}}^{(N)} - E_{\\mathrm{bind}}^{(N_{\\mathrm{prev}})}\\right| < \\tau,\n$$\nwhere $N_{\\mathrm{prev}}$ is the immediately preceding value of $N$ in the sequence.\n3. If no such $N$ exists within the provided sequence, report $N_{\\star} = -1$.\n4. Reports, in addition to $N_{\\star}$, the binding energy computed at the largest $N$ in the sequence, $E_{\\mathrm{bind}}^{(N_{\\max})}$.\n\nAll energies must be expressed in electronvolts (eV). Your program must output floating-point energies in eV. For each test case, round the reported $E_{\\mathrm{bind}}^{(N_{\\max})}$ to $6$ decimal places.\n\nTest suite. For each case, use the provided sequence of $N$ values and tolerance $\\tau$:\n- Case A: $E_{\\mathrm{g}} = 1.50$ eV, $\\Delta_{\\mathrm{c}} = 0.50$ eV, $\\alpha = 0.20$ eV, $p = 1.0$, $N \\in \\{1,2,4,8,16,32,64,128\\}$, $\\tau = 1.0\\times 10^{-3}$ eV.\n- Case B: $E_{\\mathrm{g}} = 2.00$ eV, $\\Delta_{\\mathrm{c}} = 0.30$ eV, $\\alpha = 0.05$ eV, $p = 1.0$, $N \\in \\{1,2,4,8,16,32,64\\}$, $\\tau = 5.0\\times 10^{-4}$ eV.\n- Case C: $E_{\\mathrm{g}} = 1.00$ eV, $\\Delta_{\\mathrm{c}} = 0.10$ eV, $\\alpha = 0.35$ eV, $p = 0.8$, $N \\in \\{1,2,4,8,16,32,64,128,256\\}$, $\\tau = 1.0\\times 10^{-3}$ eV.\n- Case D: $E_{\\mathrm{g}} = 1.80$ eV, $\\Delta_{\\mathrm{c}} = 0.05$ eV, $\\alpha = 0.30$ eV, $p = 1.2$, $N \\in \\{1,2,4,8,16,32\\}$, $\\tau = 1.0\\times 10^{-4}$ eV.\n\nFinal output format. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each element must itself be a two-element bracketed list with no spaces, containing $N_{\\star}$ (an integer) and the value of $E_{\\mathrm{bind}}^{(N_{\\max})}$ (a float in eV with six digits after the decimal point). For example:\n\"[[-1,0.123456],[8,0.045678],...]\".",
            "solution": "The problem posed is to determine the convergence behavior of the exciton binding energy within a simplified Bethe-Salpeter Equation (BSE) model. This requires calculating the binding energy for an increasing number of basis functions and identifying the point at which the energy converges within a given tolerance. The model and parameters are physically reasonable and mathematically well-defined, rendering the problem valid.\n\nThe core of the problem lies in finding the lowest eigenvalue of the excitonic Hamiltonian, which, within the Tamm-Dancoff approximation, is given for an $N$-dimensional basis as:\n$$\nH^{(N)}_{ij} = \\delta_{ij} \\Omega_i + K_{ij}\n$$\nHere, $\\delta_{ij}$ is the Kronecker delta, $\\Omega_i = E_{\\mathrm{g}} + i\\,\\Delta_{\\mathrm{c}}$ are the independent-particle transition energies for an excitation to the $i$-th conduction band ($i \\in \\{0, 1, \\dots, N-1\\}$), and $K_{ij} = -\\alpha\\,u_i\\,u_j$ is the screened electron-hole interaction kernel. The terms $E_{\\mathrm{g}}$, $\\Delta_{\\mathrm{c}}$, and $\\alpha$ are the band gap, conduction band spacing, and coupling strength, respectively. The coupling form factors are $u_i = (i+1)^{-p/2}$. The Hamiltonian can be written as the sum of a diagonal matrix $D^{(N)}$ of the transition energies $\\Omega_i$ and a rank-one interaction matrix $K^{(N)} = -\\alpha \\mathbf{u}\\mathbf{u}^T$, where $\\mathbf{u}$ is a column vector with elements $u_i$.\n\nThe exciton energies $E$ are the eigenvalues of $H^{(N)}$. For a rank-one perturbation of a diagonal matrix, the eigenvalues can be found by solving a secular equation rather than the full characteristic polynomial. The eigenvalue equation $H^{(N)}\\mathbf{v} = E\\mathbf{v}$ can be written as:\n$$\n(D^{(N)} - E I) \\mathbf{v} = \\alpha (\\mathbf{u}^T \\mathbf{v}) \\mathbf{u}\n$$\nAssuming $E$ is not one of the independent-particle energies $\\Omega_i$, we can invert $(D^{(N)} - E I)$ to get:\n$$\n\\mathbf{v} = \\alpha (\\mathbf{u}^T \\mathbf{v}) (D^{(N)} - E I)^{-1} \\mathbf{u}\n$$\nFor a non-trivial eigenvector $\\mathbf{v}$, we must have $\\mathbf{u}^T \\mathbf{v} \\neq 0$. Multiplying from the left by $\\mathbf{u}^T$ and dividing by the scalar $\\mathbf{u}^T \\mathbf{v}$ yields the secular equation for the eigenvalues $E$:\n$$\n1 = \\alpha \\sum_{i=0}^{N-1} \\frac{u_i^2}{\\Omega_i - E}\n$$\nThe lowest eigenvalue, $E_0^{(N)}$, corresponds to the bound exciton state. This eigenvalue is guaranteed to be less than the smallest independent-particle energy, $\\Omega_0 = E_{\\mathrm{g}}$. The exciton binding energy is defined as the energy reduction from the gap edge, $E_{\\mathrm{bind}}^{(N)} = E_{\\mathrm{g}} - E_0^{(N)}$. Let $X = E_{\\mathrm{bind}}^{(N)}$. Substituting $E_0^{(N)} = E_{\\mathrm{g}} - X$ into the secular equation gives an equation for the binding energy itself:\n$$\n\\frac{1}{\\alpha} = \\sum_{i=0}^{N-1} \\frac{(i+1)^{-p}}{i\\Delta_{\\mathrm{c}} + X}\n$$\nThis equation could be solved for $X$ using a numerical root-finding algorithm. However, given that the maximum value of $N$ is $256$, a more direct and robust numerical approach is to construct the $N \\times N$ matrix $H^{(N)}$ and find its eigenvalues using a standard linear algebra library. This method is less susceptible to issues related to bracket selection or slow convergence in root-finding.\n\nThe computational procedure for each test case is as follows:\n1. Initialize variables: $E_{\\text{bind}}^{\\text{prev}} = 0.0$, $N_{\\star} = -1$, and a list to hold the final results.\n2. Iterate through the prescribed sequence of basis sizes $\\{N_1, N_2, \\dots, N_{\\max}\\}$.\n3. For each $N$ in the sequence:\n   a. Construct the $N \\times N$ real symmetric Hamiltonian matrix $H^{(N)}$. The diagonal elements are $H^{(N)}_{ii} = E_{\\mathrm{g}} + i\\Delta_{\\mathrm{c}} - \\alpha (i+1)^{-p}$, and the off-diagonal elements are $H^{(N)}_{ij} = -\\alpha (i+1)^{-p/2} (j+1)^{-p/2}$.\n   b. Compute the eigenvalues of $H^{(N)}$ using a numerically stable algorithm, such as one provided by NumPy for symmetric matrices. The eigenvalues are real, and we are interested in the smallest one, $E_0^{(N)}$.\n   c. Calculate the binding energy $E_{\\mathrm{bind}}^{(N)} = E_{\\mathrm{g}} - E_0^{(N)}$.\n   d. For $N > N_1$, check the convergence criterion: if $|E_{\\mathrm{bind}}^{(N)} - E_{\\text{bind}}^{\\text{prev}}| < \\tau$ and $N_{\\star}$ has not yet been assigned, set $N_{\\star} = N$.\n   e. Update $E_{\\text{bind}}^{\\text{prev}} = E_{\\mathrm{bind}}^{(N)}$.\n4. After the loop, the final binding energy $E_{\\mathrm{bind}}^{(N_{\\max})}$ is the value computed for the largest $N$ in the sequence.\n5. The result for the test case is the pair $[N_{\\star}, E_{\\mathrm{bind}}^{(N_{\\max})}]$, where the energy is rounded to six decimal places.\n\nThis procedure is systematically applied to all provided test cases to produce the final output.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the BSE convergence problem for a suite of test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case A\n        {'Eg': 1.50, 'delta_c': 0.50, 'alpha': 0.20, 'p': 1.0, \n         'N_values': [1, 2, 4, 8, 16, 32, 64, 128], 'tau': 1.0e-3},\n        # Case B\n        {'Eg': 2.00, 'delta_c': 0.30, 'alpha': 0.05, 'p': 1.0, \n         'N_values': [1, 2, 4, 8, 16, 32, 64], 'tau': 5.0e-4},\n        # Case C\n        {'Eg': 1.00, 'delta_c': 0.10, 'alpha': 0.35, 'p': 0.8, \n         'N_values': [1, 2, 4, 8, 16, 32, 64, 128, 256], 'tau': 1.0e-3},\n        # Case D\n        {'Eg': 1.80, 'delta_c': 0.05, 'alpha': 0.30, 'p': 1.2, \n         'N_values': [1, 2, 4, 8, 16, 32], 'tau': 1.0e-4},\n    ]\n\n    all_results = []\n    for params in test_cases:\n        result = compute_convergence_for_case(**params)\n        all_results.append(result)\n\n    # Format the final output string as specified in the problem.\n    # e.g., \"[[N_star1,E_bind1],[N_star2,E_bind2],...]\"\n    result_strings = [f\"[{res[0]},{res[1]:.6f}]\" for res in all_results]\n    print(f\"[{','.join(result_strings)}]\")\n\ndef compute_convergence_for_case(Eg, delta_c, alpha, p, N_values, tau):\n    \"\"\"\n    Computes N_star and E_bind_Nmax for a single parameter set.\n\n    Args:\n        Eg (float): Independent-particle band gap in eV.\n        delta_c (float): Energy spacing of conduction states in eV.\n        alpha (float): Coupling strength in eV.\n        p (float): Dimensionless exponent for coupling decay.\n        N_values (list[int]): Sequence of numbers of conduction bands to include.\n        tau (float): Convergence tolerance in eV.\n\n    Returns:\n        tuple[int, float]: A tuple containing N_star and the binding energy at N_max.\n    \"\"\"\n    N_star = -1\n    E_bind_prev = 0.0\n    E_bind_Nmax = 0.0\n\n    for i, N in enumerate(N_values):\n        # Construct the BSE Hamiltonian matrix H(N).\n        \n        # indices for transitions, i -> 0, 1, ..., N-1\n        indices = np.arange(N, dtype=np.float64)\n\n        # Diagonal part: independent-particle transition energies Omega_i\n        # D_ii = E_g + i * delta_c\n        D = np.diag(Eg + indices * delta_c)\n\n        # Interaction kernel part: K_ij = -alpha * u_i * u_j\n        # u_i = (i+1)^(-p/2)\n        u_vec = (indices + 1.0)**(-p / 2.0)\n        K = -alpha * np.outer(u_vec, u_vec)\n\n        # Full Hamiltonian H = D + K\n        H = D + K\n\n        # Find the eigenvalues. eigh returns sorted eigenvalues for a symmetric matrix.\n        eigenvalues = np.linalg.eigh(H)[0]\n        E0_N = eigenvalues[0]  # The lowest eigenvalue\n\n        # Calculate the exciton binding energy\n        E_bind_N = Eg - E0_N\n\n        # Check for convergence after the first step\n        if i > 0:\n            abs_change = np.abs(E_bind_N - E_bind_prev)\n            if abs_change < tau and N_star == -1:\n                N_star = N\n        \n        E_bind_prev = E_bind_N\n\n    # The final binding energy is the one for the largest N in the sequence\n    E_bind_Nmax = E_bind_N\n\n    return N_star, E_bind_Nmax\n\nsolve()\n```"
        }
    ]
}