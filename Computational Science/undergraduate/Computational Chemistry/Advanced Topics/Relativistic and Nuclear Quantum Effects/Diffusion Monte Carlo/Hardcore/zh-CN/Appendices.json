{
    "hands_on_practices": [
        {
            "introduction": "扩散蒙特卡洛方法的核心在于行走者群体的演化，而权重更新是驱动这一演化的关键机制。本练习将其他复杂性（如行走者在空间中的移动）剥离，让您专注于权重动态本身。通过模拟一个具有极低局域能的“流氓行走者”的影响，您将亲身体会到为何一个行走者就能“绑架”整个系综，导致有效布居数崩溃，这对于理解和诊断真实DMC模拟中的统计效率至关重要。",
            "id": "2454178",
            "problem": "考虑一个简化的虚时扩散蒙特卡洛（DMC）公式，其中一个由 $N$ 个独立行者组成的系综，在恒定时间步长 $\\Delta \\tau$ 下演化 $T$ 步，演化仅通过其标量权重进行。每个行者 $i$ 都被赋予一个不随时间变化的局域能量 $E_i$。设所有 $i$ 的初始权重为 $w_i(0)=1$，并设 $E_{\\mathrm{ref}}$ 为一个固定的参考能量。一个时间步长后的权重更新定义为\n$$\nw_i(t+1)=w_i(t)\\exp\\!\\big(-\\Delta \\tau\\,(E_i-E_{\\mathrm{ref}})\\big),\\quad t=0,1,\\dots,T-1.\n$$\n在 $T$ 步之后，定义归一化权重 $\\tilde{w}_i(T)=\\dfrac{w_i(T)}{\\sum_{j=1}^N w_j(T)}$、有效布居数\n$$\nN_{\\mathrm{eff}}(T)=\\frac{1}{\\sum_{i=1}^N \\tilde{w}_i(T)^2},\n$$\n以及加权平均能量\n$$\nE_{\\mathrm{avg}}(T)=\\sum_{i=1}^N \\tilde{w}_i(T)\\,E_i.\n$$\n为了模拟单个“流氓行者”的影响，假设所有非流氓行者具有相同的局域能量 $E_{\\mathrm{typ}}$，而最多只有一个指定的流氓行者具有极低的局域能量 $E_{\\mathrm{rog}} \\ll E_{\\mathrm{typ}}$。",
            "solution": "在尝试给出解法前，需对问题进行验证。\n\n### 第1步：提取已知信息\n-   行者数量：$N$\n-   时间步长：$\\Delta \\tau$\n-   总步数：$T$\n-   所有行者的初始权重：$w_i(0)=1$\n-   行者 $i$ 的不随时间变化的局域能量：$E_i$\n-   固定参考能量：$E_{\\mathrm{ref}}$\n-   权重更新规则：$w_i(t+1)=w_i(t)\\exp(-\\Delta \\tau\\,(E_i-E_{\\mathrm{ref}}))$ for $t=0,1,\\dots,T-1$\n-   归一化最终权重：$\\tilde{w}_i(T)=\\dfrac{w_i(T)}{\\sum_{j=1}^N w_j(T)}$\n-   有效布居数：$N_{\\mathrm{eff}}(T)=\\dfrac{1}{\\sum_{i=1}^N \\tilde{w}_i(T)^2}$\n-   加权平均能量：$E_{\\mathrm{avg}}(T)=\\sum_{i=1}^N \\tilde{w}_i(T)\\,E_i$\n-   流氓行者模型：\n    -   典型能量：$E_{\\mathrm{typ}}$\n    -   流氓能量：$E_{\\mathrm{rog}} \\ll E_{\\mathrm{typ}}$\n    -   流氓行者数量：$r \\in \\{0, 1\\}$\n    -   如果 $r=0$，则所有 $E_i=E_{\\mathrm{typ}}$。\n    -   如果 $r=1$，则一个行者具有能量 $E_{\\mathrm{rog}}$，$N-1$ 个行者具有能量 $E_{\\mathrm{typ}}$。\n-   测试用例：\n    1.  $(N, \\Delta \\tau, T, E_{\\mathrm{typ}}, E_{\\mathrm{ref}}, r, E_{\\mathrm{rog}}) = (5, 0.1, 0, 1.0, 0.0, 0, 0.0)$\n    2.  $(N, \\Delta \\tau, T, E_{\\mathrm{typ}}, E_{\\mathrm{ref}}, r, E_{\\mathrm{rog}}) = (5, 0.1, 10, 1.0, 1.0, 0, 0.0)$\n    3.  $(N, \\Delta \\tau, T, E_{\\mathrm{typ}}, E_{\\mathrm{ref}}, r, E_{\\mathrm{rog}}) = (5, 0.1, 10, 1.0, 1.0, 1, -50.0)$\n    4.  $(N, \\Delta \\tau, T, E_{\\mathrm{typ}}, E_{\\mathrm{ref}}, r, E_{\\mathrm{rog}}) = (10, 0.0, 100, 2.0, 1.0, 1, -20.0)$\n\n### 第2步：使用提取的已知信息进行验证\n该问题具有科学依据，描述了扩散蒙特卡洛（一种计算科学中的标准方法）中简化的权重传播过程。该问题是适定的，所有必要的方程、初始条件和参数都有定义，确保了每个测试用例都有唯一的解。语言客观且数学上精确。问题的设定是自洽的，没有矛盾。该问题不违反任何无效性标准。\n\n### 第3步：结论与行动\n该问题是 **有效的**。将提供一个解法。\n\n### 基于原理的解法\n问题要求计算一个行者系综的最终平均能量 $E_{\\mathrm{avg}}(T)$ 和有效布居数 $N_{\\mathrm{eff}}(T)$。问题的核心在于确定最终权重 $w_i(T)$。\n\n首先，我们找到最终权重 $w_i(T)$ 的闭式表达式。权重更新规则是一个递推关系：\n$$\nw_i(t+1)=w_i(t)\\exp(-\\Delta \\tau\\,(E_i-E_{\\mathrm{ref}}))\n$$\n设行者 $i$ 的增长因子为 $g_i = \\exp(-\\Delta \\tau\\,(E_i-E_{\\mathrm{ref}}))$。该关系为 $w_i(t+1) = w_i(t) g_i$。根据初始条件 $w_i(0)=1$，我们可以展开这个递推关系：\n$w_i(1) = w_i(0) g_i = g_i$\n$w_i(2) = w_i(1) g_i = g_i^2$\n...\n经过 $T$ 步后，最终权重为：\n$$\nw_i(T) = w_i(0) g_i^T = g_i^T = \\exp(-T \\Delta \\tau\\,(E_i-E_{\\mathrm{ref}}))\n$$\n此公式适用于任意步数 $T \\ge 0$。如果 $T=0$，指数为 $0$，得到 $w_i(0)=1$，这与初始条件一致。\n\n问题根据流氓行者的数量 $r$ 定义了两种情况。\n\n**情况1：无流氓行者 ($r=0$)**\n在这种情况下，所有 $N$ 个行者都是相同的。它们的局域能量都等于 $E_{\\mathrm{typ}}$。\n$E_i = E_{\\mathrm{typ}}$ for all $i \\in \\{1, \\dots, N\\}$。\n因此，它们的最终权重也相同：\n$$\nw_i(T) = \\exp(-T \\Delta \\tau\\,(E_{\\mathrm{typ}}-E_{\\mathrm{ref}})) = w_{\\mathrm{typ}}(T)\n$$\n所有权重的总和是 $\\sum_{j=1}^N w_j(T) = N w_{\\mathrm{typ}}(T)$。归一化权重为：\n$$\n\\tilde{w}_i(T) = \\frac{w_{\\mathrm{typ}}(T)}{N w_{\\mathrm{typ}}(T)} = \\frac{1}{N}\n$$\n平均能量是能量的简单算术平均值，即 $E_{\\mathrm{typ}}$：\n$$\nE_{\\mathrm{avg}}(T) = \\sum_{i=1}^N \\tilde{w}_i(T) E_i = \\sum_{i=1}^N \\frac{1}{N} E_{\\mathrm{typ}} = N \\left(\\frac{E_{\\mathrm{typ}}}{N}\\right) = E_{\\mathrm{typ}}\n$$\n有效布居数的计算如下：\n$$\nN_{\\mathrm{eff}}(T) = \\frac{1}{\\sum_{i=1}^N \\tilde{w}_i(T)^2} = \\frac{1}{\\sum_{i=1}^N \\left(\\frac{1}{N}\\right)^2} = \\frac{1}{N \\cdot \\frac{1}{N^2}} = \\frac{1}{1/N} = N\n$$\n因此，对于任何 $r=0$ 的情况，结果都是 $E_{\\mathrm{avg}}(T) = E_{\\mathrm{typ}}$ 和 $N_{\\mathrm{eff}}(T) = N$。\n\n**情况2：一个流氓行者 ($r=1$)**\n在这种情况下，存在两种不同类型的行者。不失一般性，我们可以将索引 $i=1$ 分配给流氓行者，将索引 $i=2, \\dots, N$ 分配给典型行者。\n-   流氓行者的能量为 $E_1 = E_{\\mathrm{rog}}$。\n-   $N-1$ 个典型行者的能量为 $E_i = E_{\\mathrm{typ}}$（$i > 1$）。\n\n它们的最终未归一化权重为：\n$$\nw_{\\mathrm{rog}}(T) \\equiv w_1(T) = \\exp(-T \\Delta \\tau\\,(E_{\\mathrm{rog}}-E_{\\mathrm{ref}}))\n$$\n$$\nw_{\\mathrm{typ}}(T) \\equiv w_i(T) \\text{ for } i>1 = \\exp(-T \\Delta \\tau\\,(E_{\\mathrm{typ}}-E_{\\mathrm{ref}}))\n$$\n所有权重的总和 $S_w$ 为：\n$$\nS_w = w_{\\mathrm{rog}}(T) + (N-1)w_{\\mathrm{typ}}(T)\n$$\n归一化权重为 $\\tilde{w}_{\\mathrm{rog}}(T) = w_{\\mathrm{rog}}(T)/S_w$ 和 $\\tilde{w}_{\\mathrm{typ}}(T) = w_{\\mathrm{typ}}(T)/S_w$。平均能量是能量的加权和：\n$$\nE_{\\mathrm{avg}}(T) = \\tilde{w}_{\\mathrm{rog}}(T) E_{\\mathrm{rog}} + (N-1)\\tilde{w}_{\\mathrm{typ}}(T) E_{\\mathrm{typ}} = \\frac{w_{\\mathrm{rog}}(T) E_{\\mathrm{rog}} + (N-1)w_{\\mathrm{typ}}(T) E_{\\mathrm{typ}}}{w_{\\mathrm{rog}}(T) + (N-1)w_{\\mathrm{typ}}(T)}\n$$\n有效布居数为：\n$$\nN_{\\mathrm{eff}}(T) = \\frac{1}{\\tilde{w}_{\\mathrm{rog}}(T)^2 + (N-1)\\tilde{w}_{\\mathrm{typ}}(T)^2} = \\frac{S_w^2}{w_{\\mathrm{rog}}(T)^2 + (N-1)w_{\\mathrm{typ}}(T)^2}\n$$\n代入 $S_w$：\n$$\nN_{\\mathrm{eff}}(T) = \\frac{\\big(w_{\\mathrm{rog}}(T) + (N-1)w_{\\mathrm{typ}}(T)\\big)^2}{w_{\\mathrm{rog}}(T)^2 + (N-1)w_{\\mathrm{typ}}(T)^2}\n$$\n这些通用公式将用于解决测试用例。\n\n**将公式应用于测试用例：**\n\n-   **测试用例 1：** $(5, 0.1, 0, 1.0, 0.0, 0, 0.0)$\n    $r=0$。使用为此情况推导出的结果：$E_{\\mathrm{avg}}(0) = E_{\\mathrm{typ}} = 1.0$ 和 $N_{\\mathrm{eff}}(0) = N = 5.0$。\n\n-   **测试用例 2：** $(5, 0.1, 10, 1.0, 1.0, 0, 0.0)$\n    $r=0$。类似地，$E_{\\mathrm{avg}}(10) = E_{\\mathrm{typ}} = 1.0$ 和 $N_{\\mathrm{eff}}(10) = N = 5.0$。注意到 $E_{\\mathrm{typ}} - E_{\\mathrm{ref}} = 0$，因此在整个模拟过程中所有权重都保持为 $1$，从而导致相同的结果。\n\n-   **测试用例 3：** $(5, 0.1, 10, 1.0, 1.0, 1, -50.0)$\n    $r=1$。参数：$N=5$, $\\Delta \\tau=0.1$, $T=10$, $E_{\\mathrm{typ}}=1.0$, $E_{\\mathrm{ref}}=1.0$, $E_{\\mathrm{rog}}=-50.0$。\n    乘积 $T \\Delta \\tau = 1.0$。\n    流氓行者的指数：$-T \\Delta \\tau (E_{\\mathrm{rog}} - E_{\\mathrm{ref}}) = -1.0(-50.0 - 1.0) = 51.0$。\n    典型行者的指数：$-T \\Delta \\tau (E_{\\mathrm{typ}} - E_{\\mathrm{ref}}) = -1.0(1.0 - 1.0) = 0.0$。\n    权重：$w_{\\mathrm{rog}}(10) = \\exp(51.0)$，$w_{\\mathrm{typ}}(10) = \\exp(0.0) = 1.0$。\n    $N-1=4$。\n    $E_{\\mathrm{avg}}(10) = \\frac{\\exp(51.0) \\cdot (-50.0) + 4 \\cdot 1.0 \\cdot 1.0}{\\exp(51.0) + 4 \\cdot 1.0}$。由于 $\\exp(51.0)$ 是一个天文数字，$E_{\\mathrm{avg}}(10) \\approx \\frac{\\exp(51.0) \\cdot (-50.0)}{\\exp(51.0)} = -50.0$。\n    $N_{\\mathrm{eff}}(10) = \\frac{(\\exp(51.0) + 4)^2}{\\exp(51.0)^2 + 4}$。由于流氓行者的权重占主导地位，该项趋近于 $1.0$。有效布居数坍缩到一个占主导地位的行者。计算得出 $E_{\\mathrm{avg}}(10) \\approx -50.0$ 和 $N_{\\mathrm{eff}}(10) \\approx 1.0$。\n\n-   **测试用例 4：** $(10, 0.0, 100, 2.0, 1.0, 1, -20.0)$\n    $r=1$。参数：$N=10$, $\\Delta \\tau=0.0$, $T=100$, $E_{\\mathrm{typ}}=2.0$, $E_{\\mathrm{ref}}=1.0$, $E_{\\mathrm{rog}}=-20.0$。\n    时间步长 $\\Delta \\tau = 0.0$。这意味着权重更新中的指数始终为 $0$。\n    $w_i(T) = \\exp(-T \\cdot 0 \\cdot (E_i - E_{\\mathrm{ref}})) = \\exp(0) = 1$ 对所有行者成立。\n    所有行者的最终权重都为 $1$，无论其能量如何。该系综是等权重的。\n    归一化权重为 $\\tilde{w}_i(100) = 1/N = 1/10$。\n    $E_{\\mathrm{avg}}(100)$ 是这 $10$ 个行者能量的简单平均值：\n    $E_{\\mathrm{avg}}(100) = \\frac{1}{10} (E_{\\mathrm{rog}} + (10-1)E_{\\mathrm{typ}}) = \\frac{1}{10}(-20.0 + 9 \\cdot 2.0) = \\frac{-2.0}{10} = -0.2$。\n    对于等权重的行者，有效布居数为 $N$：\n    $N_{\\mathrm{eff}}(100) = N = 10.0$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the simplified Diffusion Monte Carlo problem for a given test suite.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each tuple is (N, delta_tau, T, E_typ, E_ref, r, E_rog)\n    test_cases = [\n        (5, 0.1, 0, 1.0, 0.0, 0, 0.0),\n        (5, 0.1, 10, 1.0, 1.0, 0, 0.0),\n        (5, 0.1, 10, 1.0, 1.0, 1, -50.0),\n        (10, 0.0, 100, 2.0, 1.0, 1, -20.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, delta_tau, T, E_typ, E_ref, r, E_rog = case\n\n        if r == 0:\n            # All walkers are identical.\n            # Local energy for all walkers is E_typ.\n            # Normalized weights are all 1/N.\n            e_avg = E_typ\n            n_eff = float(N)\n        else: # r == 1\n            # One rogue walker and N-1 typical walkers.\n            \n            # The exponent term simplifies to T * delta_tau.\n            # This correctly handles cases where T=0 or delta_tau=0,\n            # as the product becomes 0 and exp(0)=1.\n            time_product = float(T) * delta_tau\n\n            # Calculate final unnormalized weights\n            w_rog = np.exp(-time_product * (E_rog - E_ref))\n            w_typ = np.exp(-time_product * (E_typ - E_ref))\n\n            # Sum of weights\n            sum_of_weights = w_rog + (N - 1.0) * w_typ\n\n            # Calculate weighted average energy\n            # E_avg = (w_rog*E_rog + (N-1)*w_typ*E_typ) / (w_rog + (N-1)*w_typ)\n            e_avg_numerator = w_rog * E_rog + (N - 1.0) * w_typ * E_typ\n            \n            # Handle the case where all weights might hypothetically decay to zero,\n            # although not expected with the given test cases.\n            if sum_of_weights == 0.0:\n                 # This would lead to a 0/0 division. In a real DMC, it means the \n                 # simulation died. A robust implementation would handle this,\n                 # but for this specific problem, we assume it does not occur.\n                 # With positive weights, this is impossible.\n                 e_avg = 0.0 # Placeholder\n            else:\n                e_avg = e_avg_numerator / sum_of_weights\n\n            # Calculate effective population\n            # N_eff = (sum_of_weights)^2 / (w_rog^2 + (N-1)*w_typ^2)\n            n_eff_numerator = sum_of_weights**2\n            n_eff_denominator = w_rog**2 + (N - 1.0) * w_typ**2\n            \n            if n_eff_denominator == 0.0:\n                # Similarly, handle division by zero.\n                n_eff = 0.0 # Placeholder\n            else:\n                n_eff = n_eff_numerator / n_eff_denominator\n\n        # Append formatted results for the current test case\n        results.append(f\"[{e_avg:.6f},{n_eff:.6f}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在理解了权重机制后，我们现在将实现一个包含漂移、扩散和分支步骤的完整DMC模拟。本练习的核心是解决将DMC应用于费米子体系的关键挑战——节固定近似。您将通过为一个简化的三电子体系分别设置正确与错误的自旋多重度，来直接计算由错误的节结构（由泡利不相容原理决定）所引入的能量偏差，这是理解量子蒙特卡洛计算中主要误差来源的关键实践。",
            "id": "2454198",
            "problem": "您需要在一个最小化的、完全指定的模型中，定量研究对一个类似于锂的三电子原子使用强制施加错误自旋多重度的试探波函数所产生的后果。计算框架必须是原子单位下的扩散蒙特卡罗（DMC）。您将把电子模拟为一维谐振子束缚势中的无相互作用粒子，并通过轨道占据约束来比较两种不同自旋多重度所蕴含的多体能量：物理上正确的双重态和不正确的四重态。目标是计算纯粹由试探波函数的自旋对称性不匹配所引起的固定节点能量偏差。\n\n从以下基本基础开始：\n- 单个粒子在势 $V(x)$ 中的含时薛定谔方程，\n$$\ni \\frac{\\partial \\Psi(x,t)}{\\partial t} = \\left[-\\frac{1}{2}\\frac{\\partial^2}{\\partial x^2} + V(x)\\right]\\Psi(x,t),\n$$\n以及虚时变换 $t \\to -i \\tau$，当使用试探波函数 $\\Psi_T(x)$ 进行重要性抽样时，该变换为 $f(x,\\tau) = \\Psi(x,\\tau) \\Psi_T(x)$ 产生类扩散动力学。\n- $f(x,\\tau)$ 的等效福克-普朗克形式，其中漂移速度为 $v(x) = \\nabla \\ln \\Psi_T(x)$，分支由局域能量 $E_L(x) = \\left(H \\Psi_T\\right)/\\Psi_T$ 控制。\n- 泡利不相容原理，其推论是，对于具有相同自旋的电子，其空间波函数在交换粒子坐标时必须是反对称的。这决定了不同自旋多重度下允许的轨道占据，从而改变了DMC必须通过固定节点约束来遵守的节面结构。\n\n在最小化模型中：\n- 考虑一维谐振子势 $V(x) = \\tfrac{1}{2}\\omega^2 x^2$，其频率参数在原子单位下为 $\\omega$。使用高斯试探函数 $\\Psi_T(x) \\propto \\exp\\left(-\\tfrac{1}{2}\\alpha x^2\\right)$，其参数为 $\\alpha$（不一定等于 $\\omega$）。对于此 $\\Psi_T(x)$，漂移速度为 $v(x) = \\nabla \\ln \\Psi_T(x) = -\\alpha x$，局域能量为\n$$\nE_L(x) = \\frac{\\alpha}{2} + \\frac{1}{2}\\left(\\omega^2 - \\alpha^2\\right) x^2.\n$$\n- 实现一个最小化的重要性抽样扩散蒙特卡罗（DMC），用于单个粒子，通过使用漂移-扩散位移 $x \\leftarrow x + \\sqrt{\\Delta \\tau}\\,\\eta + \\Delta \\tau \\,\\nabla \\ln \\Psi_T(x)$（其中 $\\eta \\sim \\mathcal{N}(0,1)$）演化一个行走子系综，并根据与 $\\exp\\left(-\\Delta \\tau\\, E_L(x)\\right)$ 成正比的权重对行走子进行重抽样，从而估计谐振子基态能量 $E_0(\\omega)$。使用固定布居重抽样方案，以使行走子数量保持恒定。在一个平衡阶段之后，将 $E_0(\\omega)$ 估计为加权平均局域能量的时间平均值。\n- 在这个无相互作用模型中，通过谐振子势阱中的轨道占据来表示不同自旋多重度下的三电子能量：\n  - 对于物理上正确的双重态（总自旋 $S=\\tfrac{1}{2}$），两个自旋相反的电子可以占据相同的空间轨道。能量最低的构型是将两个电子置于基态空间轨道，一个电子置于第一激发空间轨道。\n  - 对于不正确的四重态（总自旋 $S=\\tfrac{3}{2}$），所有三个自旋都是平行的，因此根据泡利不相容原理，每个电子必须占据一个不同的空间轨道。\n  - 在这个理想化的无相互作用模型中，固定节点扩散蒙特卡罗（DMC）能量等于与所施加的自旋对称性及其节点相符的已占据单粒子能量之和。对于整数 $n$，使用谐振子能级阶梯的能量 $E_n(\\omega) = E_0(\\omega) + n\\,\\omega$，则以 $E_0(\\omega)$ 和 $\\omega$ 表示的多体能量为：\n    - 双重态：占据 $n=0,0,1$，因此 $E_{\\text{doublet}} = 2\\,E_0(\\omega) + E_1(\\omega) = 3\\,E_0(\\omega) + \\omega$。\n    - 四重态：占据 $n=0,1,2$，因此 $E_{\\text{quartet}} = E_0(\\omega)+E_1(\\omega)+E_2(\\omega) = 3\\,E_0(\\omega) + 3\\,\\omega$。\n  - 因此，仅由强制施加错误自旋多重度引起的固定节点偏差为 $\\Delta E = E_{\\text{quartet}} - E_{\\text{doublet}} = 2\\,\\omega$，与DMC估计的 $E_0(\\omega)$ 无关。尽管如此，您仍必须实现DMC来估计 $E_0(\\omega)$，然后根据上述占据关系构建 $E_{\\text{doublet}}$ 和 $E_{\\text{quartet}}$。\n\n您的程序必须：\n- 按照所述，使用给定的 $\\alpha$ 和时间步长 $\\Delta \\tau$，为谐振子势中频率为 $\\omega$ 的单个粒子实现重要性抽样扩散蒙特卡罗（DMC），并使用试探函数 $\\Psi_T(x)$。\n- 使用固定的行走子布居，并在每个时间步长进行重抽样步骤，以保持行走子数量恒定。\n- 平衡后，以哈特里（原子单位）为单位估计 $E_0(\\omega)$。\n- 如上所述，从DMC估计的 $E_0(\\omega)$ 构建双重态和四重态的多体能量，并以哈特里为单位计算偏差 $\\Delta E$。\n\n物理和数值单位及输出规范：\n- 全程使用原子单位。所有能量必须以哈特里为单位报告。不允许使用其他单位。\n- 每个测试用例的最终输出是 $\\Delta E$ 的值，以哈特里为单位，四舍五入到恰好六位小数。\n\n测试套件：\n对于每个参数元组 $(\\omega, \\alpha, \\Delta \\tau, N_{\\text{steps}}, N_{\\text{walkers}}, N_{\\text{equil}}, \\text{seed})$，运行您的DMC程序并报告标量偏差 $\\Delta E$（以哈特里为单位，四舍五入到六位小数）。使用以下四种情况：\n- 情况A：$(\\omega, \\alpha, \\Delta \\tau, N_{\\text{steps}}, N_{\\text{walkers}}, N_{\\text{equil}}, \\text{seed}) = (1.0, 0.9, 0.01, 400, 2000, 100, 12345)$。\n- 情况B：$(\\omega, \\alpha, \\Delta \\tau, N_{\\text{steps}}, N_{\\text{walkers}}, N_{\\text{equil}}, \\text{seed}) = (0.5, 0.45, 0.02, 600, 1500, 100, 2021)$。\n- 情况C：$(\\omega, \\alpha, \\Delta \\tau, N_{\\text{steps}}, N_{\\text{walkers}}, N_{\\text{equil}}, \\text{seed}) = (2.0, 1.8, 0.005, 600, 1500, 100, 99)$。\n- 情况D（低频边缘）：$(\\omega, \\alpha, \\Delta \\tau, N_{\\text{steps}}, N_{\\text{walkers}}, N_{\\text{equil}}, \\text{seed}) = (0.2, 0.18, 0.02, 600, 1500, 100, 7)$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，顺序为 [情况 A, 情况 B, 情况 C, 情况 D]，例如“[xA,xB,xC,xD]”。每个条目必须是偏差 $\\Delta E$，以哈特里为单位，四舍五入到恰好六位小数。",
            "solution": "所陈述的问题是有效的。它提出了一个计算上明确且科学上合理的量子蒙特卡罗方法练习。问题的目标是构建一个扩散蒙特卡罗（DMC）模拟，以研究一个模型三电子系统两种自旋态之间的能量差异。然而，对所提供的无相互作用模型的批判性分析揭示了一个显著的特点。待计算的量，即固定节点能量偏差 $\\Delta E$，被定义为四重态和双重态总能量之差：\n$$\n\\Delta E = E_{\\text{quartet}} - E_{\\text{doublet}}\n$$\n根据问题本身对这些无相互作用多体能量的定义，这些定义基于单粒子谐振子能级 $E_n(\\omega) = E_0(\\omega) + n\\omega$：\n$$\nE_{\\text{doublet}} = 2E_0(\\omega) + E_1(\\omega) = 3E_0(\\omega) + \\omega\n$$\n$$\nE_{\\text{quartet}} = E_0(\\omega) + E_1(\\omega) + E_2(\\omega) = 3E_0(\\omega) + 3\\omega\n$$\n相减得到：\n$$\n\\Delta E = (3E_0(\\omega) + 3\\omega) - (3E_0(\\omega) + \\omega) = 2\\omega\n$$\n这个结果是模型前提的一个精确解析推论，并且与从DMC模拟中数值估计得到的基态能量 $E_0(\\omega)$ 无关。问题明确承认了这一点（“固定节点偏差......因此为 $\\Delta E = 2\\omega$，与DMC估计的 $E_0(\\omega)$ 无关”），但仍坚持要求完成整个计算过程（“尽管如此，您仍必须实现DMC来估计 $E_0(\\omega)$，然后构建......”）。这种结构将问题定义为对程序遵守和模型理解的教学性测试，而不是一个真正进行数值发现的任务。DMC模拟虽然是所需程序的必要部分，但在得出 $\\Delta E$ 的最终数值答案方面，成为一个形式上多余的步骤。我们将严格遵循这些指示进行操作。\n\n问题的核心是虚时薛定谔方程的模拟。对于一个质量为 $m=1$ 的粒子在势 $V(x)$ 中，方程为：\n$$\n\\frac{\\partial \\Psi(x,\\tau)}{\\partial \\tau} = \\frac{1}{2}\\frac{\\partial^2 \\Psi(x,\\tau)}{\\partial x^2} - V(x)\\Psi(x,\\tau)\n$$\n这里进行了威克转动 $t \\to -i\\tau$。该方程描述了一个扩散（来自激能项）和反应/分支（来自势能项）的过程。为提高模拟效率，我们引入了使用试探波函数 $\\Psi_T(x)$ 的重要性抽样。我们考虑混合分布 $f(x, \\tau) = \\Psi(x, \\tau) \\Psi_T(x)$，其中 $\\Psi(x, \\tau)$ 是虚时 $\\tau$ 时的精确波函数。$f(x, \\tau)$ 的演化方程是福克-普朗克方程：\n$$\n\\frac{\\partial f}{\\partial \\tau} = \\frac{1}{2}\\frac{\\partial^2 f}{\\partial x^2} - \\frac{\\partial}{\\partial x}(v(x)f) - (E_L(x) - E_{\\text{ref}})f\n$$\n该方程描述了一个“行走子”布居在三个过程下的演化：\n1. 扩散：项 $\\frac{1}{2}\\frac{\\partial^2 f}{\\partial x^2}$ 对应于随机运动，通过在时间步长 $\\Delta\\tau$ 内为每个行走子的位置加上一个方差为 $\\Delta\\tau$ 的高斯随机变量来模拟。\n2. 漂移：项 $-\\frac{\\partial}{\\partial x}(v(x)f)$ 对应于确定性漂移。漂移速度 $v(x)$ 由 $v(x) = \\nabla \\ln \\Psi_T(x)$ 给出。在离散时间步长算法中，该项对应于位移 $v(x)\\Delta\\tau$。\n3. 分支：项 $-(E_L(x) - E_{\\text{ref}})f$ 描述了行走子的产生或销毁，由局域能量 $E_L(x) = (H\\Psi_T)/\\Psi_T$ 控制。\n\n对于指定的一维谐振子势 $V(x) = \\frac{1}{2}\\omega^2 x^2$ 和高斯试探函数 $\\Psi_T(x) \\propto \\exp(-\\frac{1}{2}\\alpha x^2)$，我们有：\n- 用于漂移项的对数梯度：$\\nabla\\ln\\Psi_T(x) = -\\alpha x$。\n- 用于分支项的局域能量：$E_L(x) = \\frac{H\\Psi_T}{\\Psi_T} = \\frac{\\alpha}{2} + \\frac{1}{2}(\\omega^2-\\alpha^2)x^2$。\n\nDMC算法对于一个由 $N_{\\text{walkers}}$ 个行走子组成的系综（每个行走子位于位置 $x_i$）按如下方式进行：\n1. 初始化：在空间中分布行走子，例如，根据高斯分布。\n2. 迭代：对于指定数量的时间步长 $\\Delta\\tau$：\n    a. 漂移-扩散：更新每个行走子的位置：\n    $$\n    x_i(\\tau + \\Delta\\tau) = x_i(\\tau) + \\sqrt{\\Delta\\tau}\\eta_i + (\\nabla\\ln\\Psi_T(x_i))\\Delta\\tau = x_i(\\tau) + \\sqrt{\\Delta\\tau}\\eta_i - \\alpha x_i(\\tau)\\Delta\\tau,\n    $$\n    其中 $\\eta_i$ 是来自标准正态分布 $\\mathcal{N}(0,1)$ 的随机数。\n    b. 分支/重抽样：为每个行走子计算局域能量 $E_L(x_i)$。然后调整布居以维持固定的 $N_{\\text{walkers}}$ 数量。这是通过为每个行走子计算权重 $w_i \\propto \\exp(-\\Delta\\tau(E_L(x_i) - E_{\\text{ref}}))$ 实现的，其中 $E_{\\text{ref}}$ 是一个参考能量（例如，系综的平均局域能量）。然后通过从当前布居中按与这些权重成比例的概率进行重抽样来创建新一代的行走子。\n3. 平衡与测量：系综经过一定数量的平衡步数 $N_{\\text{equil}}$ 进行演化，以使其弛豫到分布 $f(x) = \\Psi_0(x)\\Psi_T(x)$。平衡后，通过在随后的生产步骤中对行走子布居的平均局域能量进行平均，来估计基态能量 $E_0(\\omega)$。\n$$\nE_0(\\omega) \\approx \\left\\langle \\frac{1}{N_{\\text{walkers}}} \\sum_{i=1}^{N_{\\text{walkers}}} E_L(x_i) \\right\\rangle_{\\text{time}}\n$$\n这个值 $E_0^{\\text{DMC}}$ 是问题流程所要求的数值估计。\n\n最后，我们按照指示构建多体能量并计算偏差。尽管 $E_0^{\\text{DMC}}$ 会有统计误差，但在计算 $\\Delta E$ 时其贡献会完全抵消：\n$$\nE_{\\text{doublet}}^{\\text{DMC}} = 3 E_0^{\\text{DMC}} + \\omega\n$$\n$$\nE_{\\text{quartet}}^{\\text{DMC}} = 3 E_0^{\\text{DMC}} + 3\\omega\n$$\n$$\n\\Delta E = E_{\\text{quartet}}^{\\text{DMC}} - E_{\\text{doublet}}^{\\text{DMC}} = 2\\omega\n$$\n我们构建的程序将忠实地执行所有步骤：DMC估计 $E_0(\\omega)$，然后构建能量并进行最终减法，这将产生解析值 $2\\omega$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_dmc_simulation(omega, alpha, dt, n_steps, n_walkers, n_equil, seed):\n    \"\"\"\n    Performs an importance-sampled Diffusion Monte Carlo (DMC) simulation for a \n    single particle in a 1D harmonic oscillator potential to estimate the ground-state energy.\n    Then, it computes the energy bias between quartet and doublet spin states as per the problem.\n\n    Args:\n        omega (float): Harmonic potential frequency parameter.\n        alpha (float): Trial wavefunction parameter.\n        dt (float): Time step (delta_tau).\n        n_steps (int): Total number of simulation steps.\n        n_walkers (int): Number of walkers in the ensemble.\n        n_equil (int): Number of equilibration steps.\n        seed (int): Seed for the random number generator.\n\n    Returns:\n        float: The fixed-node energy bias, Delta E.\n    \"\"\"\n    \n    # Set up the random number generator for reproducibility.\n    rng = np.random.default_rng(seed)\n    \n    # 1. Initialization\n    # Initialize walker positions, drawing from a standard normal distribution.\n    walkers_x = rng.normal(loc=0.0, scale=1.0, size=n_walkers)\n    \n    energy_history = []\n\n    # 2. Main DMC Loop\n    for step in range(n_steps):\n        # a. Drift-Diffusion Step\n        # The drift term is -alpha * x * dt.\n        # The diffusion term is a Gaussian random step with variance dt.\n        drift = -alpha * walkers_x * dt\n        diffusion = rng.normal(loc=0.0, scale=np.sqrt(dt), size=n_walkers)\n        walkers_x = walkers_x + drift + diffusion\n\n        # b. Calculate Local Energy for each walker\n        # E_L(x) = alpha/2 + 0.5 * (omega^2 - alpha^2) * x^2\n        local_energies = 0.5 * alpha + 0.5 * (omega**2 - alpha**2) * walkers_x**2\n\n        # c. Accumulate energy statistics after equilibration\n        if step >= n_equil:\n            # The simple mean of local energies over the resampled population is an\n            # estimator for the ground state energy.\n            energy_history.append(np.mean(local_energies))\n        \n        # d. Branching/Resampling Step (to maintain a fixed population)\n        # Use average local energy as the reference energy to stabilize weights.\n        E_ref = np.mean(local_energies)\n        \n        # Calculate weights. The term (local_energies - E_ref) prevents\n        # numerical overflow/underflow.\n        weights = np.exp(-dt * (local_energies - E_ref))\n        \n        # Normalize weights to get sampling probabilities.\n        probs = weights / np.sum(weights)\n\n        # Resample walkers with replacement based on their probabilities.\n        # `rng.choice` is an efficient way to perform stochastic resampling.\n        parent_indices = rng.choice(n_walkers, size=n_walkers, p=probs)\n        walkers_x = walkers_x[parent_indices]\n\n    # 3. Estimate Ground-State Energy\n    # The estimate is the average of the mean energies recorded during production steps.\n    E0_estimate = np.mean(energy_history)\n\n    # 4. Assemble Many-Body Energies and Compute Bias\n    # Per the problem statement, we use the DMC estimate of E0 to assemble the\n    # doublet and quartet energies, then find their difference.\n    E_doublet = 3 * E0_estimate + omega\n    E_quartet = 3 * E0_estimate + 3 * omega\n    \n    # The bias delta_E will be exactly 2 * omega due to perfect cancellation.\n    delta_E = E_quartet - E_doublet\n    \n    return delta_E\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # (omega, alpha, dt, N_steps, N_walkers, N_equil, seed)\n    test_cases = [\n        (1.0, 0.9, 0.01, 400, 2000, 100, 12345),  # Case A\n        (0.5, 0.45, 0.02, 600, 1500, 100, 2021), # Case B\n        (2.0, 1.8, 0.005, 600, 1500, 100, 99),   # Case C\n        (0.2, 0.18, 0.02, 600, 1500, 100, 7),     # Case D\n    ]\n\n    results = []\n    for case in test_cases:\n        omega, alpha, dt, n_steps, n_walkers, n_equil, seed = case\n        \n        # Run the full DMC procedure as required by the problem.\n        bias_energy = run_dmc_simulation(omega, alpha, dt, n_steps, n_walkers, n_equil, seed)\n        \n        # Format the result to exactly six decimal places.\n        results.append(f\"{bias_energy:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "一个能够运行的算法与一个能够产生精确结果的算法之间存在着巨大差异，而数值参数的选择是其中的关键。本练习是一个思想实验，旨在探讨DMC模拟中一个至关重要的参数——时间步长 $\\Delta\\tau$ ——的选择所带来的影响。通过分析使用过大时间步长的后果，您将深入理解在模拟效率和系统性时间步长偏差及布居稳定性之间存在的微妙权衡。",
            "id": "2454150",
            "problem": "标准的含时重要性采样的扩散蒙特卡罗（DMC）模拟使用算符 $\\exp\\!\\left[-\\Delta\\tau\\left(\\hat{H}-E_{\\mathrm{ref}}\\right)\\right]$ 的格林函数的短时近似来传播虚时波函数，其中 $\\hat{H}$ 是哈密顿算符，$E_{\\mathrm{ref}}$ 是用于布居数控制的可调参考能量。在采用固定节点约束和相当准确但非精确的试探波函数的漂移-扩散-分支算法中，行走者的分支由乘法权重 $w=\\exp\\!\\left[-\\Delta\\tau\\left(E_{\\mathrm{L}}-E_{\\mathrm{ref}}\\right)\\right]$ 控制，其中 $E_{\\mathrm{L}}$ 是局域能量。混合估计基态能量是通过行走者在长虚时极限下采样的稳态分布得到的。考虑选择一个非常大的固定时间步长 $\\Delta\\tau$（相对于系统的内在能量标度和关联时间而言很大）。对于计算出的基态能量和行走者布居数稳定性的综合影响，最准确的预测是什么？\n\nA. 估计的基态能量表现出更大的系统性时间步长偏差（更多地偏离固定节点极限），并且行走者布居数因剧烈波动而变得不稳定，除非施加强力的布居数控制，否则可能会爆炸或崩溃。\n\nB. 估计的基态能量变得更准确，因为更快的投影减少了激发态污染，并且行走者布居数变得更稳定，因为所需的传播步骤更少。\n\nC. 在无限行走者和长时间极限下，估计的基态能量不受影响，尽管行走者布居数变得不稳定；这种不稳定性不影响能量估计值。\n\nD. 估计的基态能量会遭受更大的时间步长偏差，但行走者布居数变得更稳定，因为在较大的 $\\Delta\\tau$ 下分支事件频率较低。",
            "solution": "在尝试给出任何解答之前，必须首先验证问题陈述的科学合理性和一致性。\n\n### 第1步：提取已知条件\n- **方法**：含时重要性采样的扩散蒙特卡罗（DMC）。\n- **传播子**：虚时演化由算符 $\\exp[-\\Delta\\tau(\\hat{H}-E_{\\mathrm{ref}})]$ 控制。\n- **近似**：使用格林函数的短时近似。\n- **系统参数**：$\\hat{H}$ 是哈密顿算符，$E_{\\mathrm{ref}}$ 是可调参考能量，$\\Delta\\tau$ 是时间步长。\n- **算法细节**：采用漂移-扩散-分支算法，并带有固定节点约束。\n- **试探波函数**：使用相当准确但非精确的试探波函数。\n- **分支因子**：一个行走者的乘法权重为 $w=\\exp[-\\Delta\\tau(E_{\\mathrm{L}}-E_{\\mathrm{ref}})]$，其中 $E_{\\mathrm{L}}$ 是局域能量。\n- **能量计算**：使用混合估计法计算基态能量。\n- **条件**：选择一个非常大的固定时间步长 $\\Delta\\tau$。\n- **问题**：预测这个大的 $\\Delta\\tau$ 对计算出的基态能量和行走者布居数稳定性的综合影响。\n\n### 第2步：使用提取的已知条件进行验证\n该问题陈述是关于扩散蒙特卡罗方法数值稳定性和准确性的一个标准探究，而该方法是计算量子化学中的一项基石技术。对算法的描述，包括含时重要性采样传播子、试探波函数的作用、局域能量、分支因子和固定节点近似，都与已建立的理论和实践完全一致。所提出的问题涉及改变一个关键模拟参数 $\\Delta\\tau$ 的后果，这是分析任何此类随机算法性能的一个基本方面。该问题具有科学依据，提法得当，客观，且没有明显缺陷。\n\n### 第3步：结论与行动\n该问题是**有效的**。将推导解答。\n\nDMC算法的核心是迭代应用虚时传播子 $e^{-\\Delta\\tau\\hat{H}}$ 的短时近似。对于含时重要性采样DMC，我们考虑分布 $f(\\mathbf{R}, \\tau) = \\Psi_T(\\mathbf{R})\\Phi(\\mathbf{R}, \\tau)$ 的传播，其中 $\\Psi_T$ 是试探波函数，$\\Phi$ 是基态波函数。$f$ 的演化由一个可以分解为漂移、扩散和分支项的算符控制。这种分解是一种近似，通常通过Trotter-Suzuki分解实现，并且仅在 $\\Delta\\tau$ 很小时才准确。由这种近似引起的误差被称为**时间步长偏差**。\n\n我们来分析问题的两个方面：基态能量和布居数稳定性。\n\n**1. 对基态能量的影响**\n\n使用有限的时间步长 $\\Delta\\tau$ 会在计算中引入系统性误差。算符指数 $\\exp[-\\Delta\\tau(\\hat{H})]$ 通常被近似为动能算符 $\\hat{T}$ 和势能算符 $\\hat{V}$ 的指数乘积，例如 $\\exp(-\\Delta\\tau\\hat{H}) \\approx \\exp(-\\frac{1}{2}\\Delta\\tau\\hat{V})\\exp(-\\Delta\\tau\\hat{T})\\exp(-\\frac{1}{2}\\Delta\\tau\\hat{V})$。这种对称Trotter分解的单步误差量级为 $\\mathcal{O}(\\Delta\\tau^3)$，导致总能量偏差量级为 $\\mathcal{O}(\\Delta\\tau^2)$。对于更简单的非对称分解，偏差量级为 $\\mathcal{O}(\\Delta\\tau)$。\n\n无论具体阶数如何，误差都是 $\\Delta\\tau$ 的直接函数。一个“非常大”的 $\\Delta\\tau$ 会使整个算法所依赖的基本短时近似失效。对于小的 $\\Delta\\tau$ 可以忽略的误差项将变得占主导地位。因此，计算出的能量 $E(\\Delta\\tau)$ 将显著偏离真实的固定节点能量 $E_{\\mathrm{FN}} = \\lim_{\\Delta\\tau \\to 0} E(\\Delta\\tau)$。因此，大的 $\\Delta\\tau$ 会导致**更大的系统性时间步长偏差**。\n\n**2. 对行走者布居数稳定性的影响**\n\n行走者的布居数由分支因子 $w = \\exp[-\\Delta\\tau(E_{\\mathrm{L}} - E_{\\mathrm{ref}})]$ 控制。对于非精确的试探波函数 $\\Psi_T$，局域能量 $E_{\\mathrm{L}}(\\mathbf{R}) = \\hat{H}\\Psi_T(\\mathbf{R})/\\Psi_T(\\mathbf{R})$ 不是一个常数。它随着行走者在组态空间 $\\mathbf{R}$ 的不同区域采样而波动。参考能量 $E_{\\mathrm{ref}}$ 被动态调整到接近平均基态能量，因此平均而言 $\\langle w \\rangle \\approx 1$。\n\n考虑指数的自变量 $-\\Delta\\tau(E_{\\mathrm{L}} - E_{\\mathrm{ref}})$。项 $(E_{\\mathrm{L}} - E_{\\mathrm{ref}})$ 代表局域能量围绕目标能量的波动。当 $\\Delta\\tau$ 很大时，这个自变量可以取非常大的正值或负值。\n- 如果一个行走者移动到 $E_{\\mathrm{L}} \\ll E_{\\mathrm{ref}}$ 的区域，权重 $w$ 会变得指数级大，导致大量后代行走者的产生（单个行走者导致的布居数爆炸）。\n- 如果一个行走者移动到 $E_{\\mathrm{L}} \\gg E_{\\mathrm{ref}}$ 的区域（例如，在 $\\Psi_T$ 的节点附近），权重 $w$ 会变得指数级小，实际上杀死了该行走者。\n\n大的 $\\Delta\\tau$ 极大地放大了局域能量波动对分支权重的影响。整个布居数中权重的方差将急剧增加。这就是不稳定模拟的定义。布居数将由极少数高权重行走者主导，而绝大多数行走者被消除。这样的模拟在统计上是低效的，并且容易发生灾难性失败，要么是所有行走者死亡（崩溃），要么是布居数无法控制地增加（爆炸）。需要强力的布居数控制算法来抵消这种情况，但它们可能会引入自身的偏差。因此，大的 $\\Delta\\tau$ 导致**行走者布居数的严重不稳定性**。\n\n### 逐项分析\n\n**A. 估计的基态能量表现出更大的系统性时间步长偏差（更多地偏离固定节点极限），并且行走者布居数因剧烈波动而变得不稳定，除非施加强力的布居数控制，否则可能会爆炸或崩溃。**\n该陈述与我们的推导完全一致。大的 $\\Delta\\tau$ 使短时近似失效，增加了时间步长偏差。它还放大了分支权重的波动，导致布居数不稳定。\n**结论：正确。**\n\n**B. 估计的基态能量变得更准确，因为更快的投影减少了激发态污染，并且行走者布居数变得更稳定，因为所需的传播步骤更少。**\n这从根本上是错误的。较大的投影算符 $e^{-\\Delta\\tau\\hat{H}}$ 的理论好处，完全被其在大 $\\Delta\\tau$ 下的*近似*的灾难性失败所抵消。准确度由时间步长偏差主导，而该偏差会恶化。关于布居数稳定性提高的说法也是错误的；稳定性由每一步权重的方差决定，而大 $\\Delta\\tau$ 会严重降低稳定性。\n**结论：错误。**\n\n**C. 在无限行走者和长时间极限下，估计的基态能量不受影响，尽管行走者布居数变得不稳定；这种不稳定性不影响能量估计值。**\n这是错误的。时间步长偏差是*系统性*误差，而非统计误差。它不会通过增加行走者数量或总模拟时间而消失。模拟会收敛到错误的值 $E(\\Delta\\tau)$，而不是 $E_{\\mathrm{FN}}$。此外，严重的布居数不稳定性以及为减轻它所需的强力控制措施可能会给能量估计值引入额外的偏差。\n**结论：错误。**\n\n**D. 估计的基态能量会遭受更大的时间步长偏差，但行走者布居数变得更稳定，因为在较大的 $\\Delta\\tau$ 下分支事件频率较低。**\n陈述的第一部分是正确的。然而，第二部分是错误的。该逻辑混淆了分支步骤的频率与每一步内布居数的稳定性。稳定性由分支因子 $w$ 的方差决定，正如所推导的，该方差随 $\\Delta\\tau$ 急剧增加，导致严重的不稳定性。\n**结论：错误。**",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}