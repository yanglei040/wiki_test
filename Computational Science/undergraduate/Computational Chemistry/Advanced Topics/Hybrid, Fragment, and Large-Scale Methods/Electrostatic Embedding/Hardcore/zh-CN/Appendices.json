{
    "hands_on_practices": [
        {
            "introduction": "本练习旨在从第一性原理出发，为初学者提供一个实现静电嵌入能量计算的入门实践。通过编写代码来计算一个量子力学（QM）水分子与周围分子力学（MM）点电荷环境之间的静电相互作用，您将加深对库仑定律在QM/MM模型中具体应用的理解。这个基础练习是掌握更复杂静电嵌入应用的关键第一步。",
            "id": "2454995",
            "problem": "您必须编写一个完整的程序，计算在静电嵌入近似下，位于一个由固定经典点电荷填充的半径为 $R$ 的空心球内部的单个水分子的一阶静电嵌入能。该计算在量子力学/分子力学 (QM/MM) 水平上进行处理。水分子是量子力学 (QM) 子系统，球体上周围的点电荷是分子力学 (MM) 环境。计算必须仅基于电荷之间的基本静电相互作用。\n\n物理模型和定义：\n- 用位于其原子位置的三个点电荷（一个氧原子和两个氢原子）来表示水分子。氧原子和每个氢原子上分别使用固定的部分电荷 $q_{\\mathrm{O}}=-0.834\\,e$ 和 $q_{\\mathrm{H}}=+0.417\\,e$，其中 $e$ 是基本电荷。几何结构固定如下：将氧原子置于原点，分子位于 $x$-$z$ 平面内，其角平分线沿 $+z$ 轴排列。使用氧-氢键长为 $d_{\\mathrm{OH}}=0.09572$ 纳米，氢-氧-氢键角为 $\\alpha=104.52$ 度。定义半角 $\\theta=\\alpha/2$，并将氢原子置于位置 $\\mathbf{r}_{\\mathrm{H1}}=\\left(d_{\\mathrm{OH}}\\sin\\theta,\\,0,\\,d_{\\mathrm{OH}}\\cos\\theta\\right)$ 和 $\\mathbf{r}_{\\mathrm{H2}}=\\left(-d_{\\mathrm{OH}}\\sin\\theta,\\,0,\\,d_{\\mathrm{OH}}\\cos\\theta\\right)$，而氧原子位置为 $\\mathbf{r}_{\\mathrm{O}}=\\left(0,\\,0,\\,0\\right)$。所有坐标均以纳米为单位。\n- 设 MM 点电荷集为 $\\left\\{q_a,\\,\\mathbf{R}_a\\right\\}$，约束在以原点为中心、半径为 $R$ 的球面上，即 $\\left\\lVert \\mathbf{R}_a \\right\\rVert=R$。每个 $q_a$ 以基本电荷 $e$ 为单位给出，每个 $\\mathbf{R}_a$ 以纳米为单位给出。\n- 由 MM 电荷在位置 $\\mathbf{r}$ 处产生的静电势为 $V_{\\mathrm{MM}}(\\mathbf{r})=\\sum_a \\dfrac{k_e\\,q_a^{(\\mathrm{C})}}{\\left\\lVert \\mathbf{r}^{(\\mathrm{m})}-\\mathbf{R}_a^{(\\mathrm{m})}\\right\\rVert}$，其中 $k_e=\\dfrac{1}{4\\pi\\varepsilon_0}$ 是库仑常数，上标 $(\\mathrm{C})$ 表示库仑单位，上标 $(\\mathrm{m})$ 表示位置以米为单位。一阶静电嵌入能为\n$$\nE_{\\mathrm{embed}}=\\sum_{i\\in\\{\\mathrm{O},\\mathrm{H1},\\mathrm{H2}\\}} q_i^{(\\mathrm{C})}\\,V_{\\mathrm{MM}}\\!\\left(\\mathbf{r}_i\\right)\\,,\n$$\n其中所有距离以米为单位，电荷以库仑为单位。此外，由 MM 电荷在氧原子位置产生的电场为\n$$\n\\mathbf{E}_{\\mathrm{O}}=\\sum_a k_e\\,q_a^{(\\mathrm{C})}\\,\\frac{\\mathbf{r}_{\\mathrm{O}}^{(\\mathrm{m})}-\\mathbf{R}_a^{(\\mathrm{m})}}{\\left\\lVert \\mathbf{r}_{\\mathrm{O}}^{(\\mathrm{m})}-\\mathbf{R}_a^{(\\mathrm{m})}\\right\\rVert^3}\\,.\n$$\n\n使用的常数和单位：\n- 库仑常数 $k_e=8.9875517923\\times 10^{9}$ $\\mathrm{N\\,m^2\\,C^{-2}}$，\n- 基本电荷 $e=1.602176634\\times 10^{-19}$ $\\mathrm{C}$，\n- Avogadro 常数 $N_{\\mathrm{A}}=6.02214076\\times 10^{23}$ $\\mathrm{mol^{-1}}$。\n- 位置按给定值使用纳米，内部通过 $1~\\mathrm{nm}=1.0\\times 10^{-9}~\\mathrm{m}$ 转换为米。\n- 将嵌入能 $E_{\\mathrm{embed}}$ 以千焦耳每摩尔表示，四舍五入到六位小数。\n- 将氧原子处的电场强度大小 $\\left\\lVert \\mathbf{E}_{\\mathrm{O}} \\right\\rVert$ 以伏特每纳米表示，四舍五入到六位小数。请注意，$1~\\mathrm{V/nm}=10^{9}~\\mathrm{V/m}$，因此通过除以 $10^{9}$ 将 V/m 转换为 V/nm。\n- 角度必须按规定以度为单位进行解释。\n\n测试套件：\n对于每个测试用例，都指定了空心球半径 $R$（以纳米为单位）和 MM 电荷集 $\\left(q_a,\\,\\mathbf{R}_a\\right)$。所有 MM 电荷 $q_a$ 均以基本电荷 $e$ 为单位给出，所有位置 $\\mathbf{R}_a$ 均以纳米为单位给出。\n\n- 测试用例 A (一般排列): $R=1.0$ 时的 MM 电荷\n  - $q_1=+0.2$ 位于 $\\mathbf{R}_1=(0,\\,0,\\,R)$，\n  - $q_2=-0.2$ 位于 $\\mathbf{R}_2=(0,\\,0,\\,-R)$，\n  - $q_3=+0.1$ 位于 $\\mathbf{R}_3=\\left(\\dfrac{R}{\\sqrt{2}},\\,0,\\,\\dfrac{R}{\\sqrt{2}}\\right)$。\n- 测试用例 B (近球面，强轴向电荷): $R=0.3$ 时的 MM 电荷\n  - $q_1=+1.0$ 位于 $\\mathbf{R}_1=(0,\\,0,\\,R)$，\n  - $q_2=-1.0$ 位于 $\\mathbf{R}_2=(0,\\,0,\\,-R)$，\n  - $q_3=+0.5$ 位于 $\\mathbf{R}_3=(0,\\,R,\\,0)$。\n- 测试用例 C (近乎抵消的对称集): $R=2.0$ 时的 MM 电荷\n  - $q_1=+0.5$ 位于 $\\mathbf{R}_1=(R,\\,0,\\,0)$，\n  - $q_2=-0.5$ 位于 $\\mathbf{R}_2=(-R,\\,0,\\,0)$，\n  - $q_3=+0.25$ 位于 $\\mathbf{R}_3=(0,\\,0,\\,R)$，\n  - $q_4=-0.25$ 位于 $\\mathbf{R}_4=(0,\\,0,\\,-R)$。\n\n每个测试用例所需的计算和输出：\n- 以千焦耳每摩尔为单位计算 $E_{\\mathrm{embed}}$。\n- 以伏特每纳米为单位计算 $\\left\\lVert \\mathbf{E}_{\\mathrm{O}} \\right\\rVert$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含三个测试用例的结果，格式为逗号分隔的列表的列表，每个子列表包含两个浮点数，顺序为 $\\left[E_{\\mathrm{embed}}~(\\mathrm{kJ/mol}),\\,\\left\\lVert \\mathbf{E}_{\\mathrm{O}} \\right\\rVert~(\\mathrm{V/nm})\\right]$，每个浮点数四舍五入到六位小数，并用方括号括起来。例如：\n\"[[eA,EA],[eB,EB],[eC,EC]]\"，其中 $e\\mathrm{A}$ 表示测试用例 A 的能量，$\\mathrm{EA}$ 表示测试用例 A 的电场强度大小，依此类推。",
            "solution": "问题陈述已经过验证，被认定为具有科学依据、提法恰当、客观且完整。它描述了 QM/MM 模拟领域中的一个标准计算练习，特别是计算一阶静电相互作用。物理模型、数学公式和提供的常数均与经典静电学的既定原理一致。没有矛盾或含糊之处。因此，将提供一个解决方案。\n\n这个问题的核心是应用库仑定律来计算由两组点电荷之间的相互作用产生的静电势能和电场。第一组代表量子力学 (QM) 水分子，第二组代表经典的分子力学 (MM) 环境。\n\n我们的步骤如下：\n1.  根据提供的内坐标（键长和键角），定义水分子三个原子（QM子系统）的笛卡尔坐标。\n2.  构建由 MM 点电荷产生的一阶静电嵌入能 ($E_{\\mathrm{embed}}$) 和氧原子处电场 ($\\mathbf{E}_{\\mathrm{O}}$) 的表达式。\n3.  为所有物理量建立一个一致的单位体系（国际单位制，SI），并推导出必要的转换因子，以按要求的单位千焦耳每摩尔 ($\\mathrm{kJ/mol}$) 和伏特每纳米 ($\\mathrm{V/nm}$) 报告最终结果。\n4.  实现一个算法，为所提供的三个测试用例中的每一个计算这些量。\n\n**1. 水分子（QM 子系统）的几何结构**\n\n水分子的几何结构是固定的。氧原子位于原点 $\\mathbf{r}_{\\mathrm{O}} = (0, 0, 0)$。分子位于 $x$-$z$ 平面内，其偶极矩与 $z$ 轴对齐。\n给定参数为 O-H 键长 $d_{\\mathrm{OH}} = 0.09572 \\, \\mathrm{nm}$ 和 H-O-H 键角 $\\alpha = 104.52^\\circ$。半角为 $\\theta = \\alpha/2 = 52.26^\\circ$。为了使用三角函数，我们将其转换为弧度：$\\theta_{\\mathrm{rad}} = 52.26 \\times (\\pi / 180)$。\n\n两个氢原子 $\\mathbf{r}_{\\mathrm{H1}}$ 和 $\\mathbf{r}_{\\mathrm{H2}}$ 的位置计算如下：\n$$\n\\mathbf{r}_{\\mathrm{H1}} = \\left( d_{\\mathrm{OH}}\\sin\\theta, 0, d_{\\mathrm{OH}}\\cos\\theta \\right)\n$$\n$$\n\\mathbf{r}_{\\mathrm{H2}} = \\left( -d_{\\mathrm{OH}}\\sin\\theta, 0, d_{\\mathrm{OH}}\\cos\\theta \\right)\n$$\n部分电荷为 $q'_{\\mathrm{O}} = -0.834$ 和 $q'_{\\mathrm{H1}} = q'_{\\mathrm{H2}} = +0.417$，单位为基本电荷 $e$。我们用撇号 ($q'$) 表示以 $e$ 为单位的电荷，用撇号 ($\\mathbf{r}'$) 表示以纳米为单位的位置。\n\n**2. 静电嵌入能 ($E_{\\mathrm{embed}}$)**\n\n一阶静电嵌入能是每个 QM 电荷与所有 MM 电荷之间成对库仑相互作用的总和。\n$$\nE_{\\mathrm{embed}} = \\sum_{i \\in \\{\\mathrm{O,H1,H2}\\}} \\sum_{a \\in \\mathrm{MM}} \\frac{k_e q_i^{(\\mathrm{C})} q_a^{(\\mathrm{C})}}{\\left\\lVert \\mathbf{r}_i^{(\\mathrm{m})} - \\mathbf{R}_a^{(\\mathrm{m})} \\right\\rVert}\n$$\n其中 $k_e$ 是库仑常数，上标 $(\\mathrm{C})$ 和 $(\\mathrm{m})$ 分别表示以库仑为单位的电荷和以米为单位的位置。\n\n为了便于计算，我们使用以 $e$ 为单位的电荷 ($q'$) 和以纳米为单位的位置 ($\\mathbf{r}'$)。\n$q_i^{(\\mathrm{C})} = q'_i e$，$q_a^{(\\mathrm{C})} = q'_a e$ 以及 $\\mathbf{r}^{(\\mathrm{m})} = \\mathbf{r}' \\times 10^{-9}$。将这些代入能量表达式，得到单个分子的能量（单位为焦耳）：\n$$\nE_{\\mathrm{embed}} [\\mathrm{J}] = \\sum_{i,a} \\frac{k_e (q'_i e)(q'_a e)}{\\left\\lVert (\\mathbf{r}'_i - \\mathbf{R}'_a) \\times 10^{-9} \\right\\rVert} = \\frac{k_e e^2}{10^{-9}} \\sum_{i,a} \\frac{q'_i q'_a}{\\left\\lVert \\mathbf{r}'_i - \\mathbf{R}'_a \\right\\rVert_{\\mathrm{nm}}}\n$$\n为了得到以千焦耳每摩尔为单位的摩尔能量，我们乘以 Avogadro 常数 $N_{\\mathrm{A}}$ 并将焦耳转换为千焦耳 ($1/1000$)。\n$$\nE_{\\mathrm{embed}} [\\mathrm{kJ/mol}] = E_{\\mathrm{embed}} [\\mathrm{J}] \\times N_{\\mathrm{A}} \\times 10^{-3} = \\left(\\frac{k_e e^2 N_{\\mathrm{A}}}{10^{-6}}\\right) \\sum_{i,a} \\frac{q'_i q'_a}{\\left\\lVert \\mathbf{r}'_i - \\mathbf{R}'_a \\right\\rVert_{\\mathrm{nm}}}\n$$\n前置因子 $C_E = k_e e^2 N_{\\mathrm{A}} / 10^{-6}$ 是一个转换常数，其值约为 $138935.4576 \\, \\mathrm{kJ \\cdot nm \\cdot mol^{-1}}$。\n\n**3. 氧原子处的电场 ($\\mathbf{E}_{\\mathrm{O}}$)**\n\n由 MM 电荷在氧原子位置（$\\mathbf{r}_{\\mathrm{O}} = \\mathbf{0}$）产生的电场由下式给出：\n$$\n\\mathbf{E}_{\\mathrm{O}} = -\\sum_{a \\in \\mathrm{MM}} k_e q_a^{(\\mathrm{C})} \\frac{\\mathbf{R}_a^{(\\mathrm{m})}}{\\left\\lVert \\mathbf{R}_a^{(\\mathrm{m})} \\right\\rVert^3}\n$$\nMM 电荷位于半径为 $R$ 的球面上，因此 $\\left\\lVert \\mathbf{R}_a \\right\\rVert = R$。使用以 $e$ 为单位的电荷和以纳米为单位的位置，我们得到国际单位制 (V/m) 下的电场：\n$$\n\\mathbf{E}_{\\mathrm{O}}[\\mathrm{V/m}] = -\\sum_{a} k_e (q'_a e) \\frac{\\mathbf{R}'_a \\times 10^{-9}}{(R' \\times 10^{-9})^3} = -\\frac{k_e e}{(10^{-9})^2} \\sum_{a} \\frac{q'_a \\mathbf{R}'_a}{(R')^3} = -k_e e \\cdot 10^{18} \\sum_{a} \\frac{q'_a \\mathbf{R}'_a}{(R')^3}\n$$\n问题要求以伏特每纳米 ($\\mathrm{V/nm}$) 为单位的电场强度大小。转换关系为 $1 \\, \\mathrm{V/nm} = 10^9 \\, \\mathrm{V/m}$。\n$$\n\\left\\lVert \\mathbf{E}_{\\mathrm{O}} \\right\\rVert_{\\mathrm{V/nm}} = \\frac{\\left\\lVert \\mathbf{E}_{\\mathrm{O}} \\right\\rVert_{\\mathrm{V/m}}}{10^9} = k_e e \\cdot 10^9 \\left\\lVert \\sum_a \\frac{q'_a \\mathbf{R}'_a}{(R')^3} \\right\\rVert\n$$\n前置因子 $C_F = k_e e \\cdot 10^9$ 的单位是 $\\mathrm{V \\cdot nm}$，其值约为 $1.4399645$。因此，最终的表达式是：\n$$\n\\left\\lVert \\mathbf{E}_{\\mathrm{O}} \\right\\rVert_{\\mathrm{V/nm}} = \\frac{C_F}{(R'_{\\mathrm{nm}})^3} \\left\\lVert \\sum_a q'_a \\mathbf{R}'_a \\right\\rVert\n$$\n\n**4. 算法实现**\n\n该算法遍历每个测试用例。对于每个用例：\n- 定义 QM 和 MM 电荷的位置和值。为了与国际单位制保持一致，所有位置都转换为米，所有电荷都转换为库仑，以进行内部计算。\n- 对于能量计算，对 QM 原子 $i$ 和 MM 电荷 $a$ 执行双重循环。计算并求和成对相互作用能 $k_e q_i q_a / d_{ia}$。最终以焦耳为单位的总和被转换为 kJ/mol。\n- 对于电场计算，计算并求和每个 MM 电荷在原点处的矢量贡献。然后确定总场矢量的大小，并从 V/m 转换为 V/nm。\n- 每个测试用例的两个结果值四舍五入到六位小数并存储。\n- 最终输出是一个格式化的字符串，表示这些结果对的列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.spatial.distance import cdist\n\ndef solve():\n    \"\"\"\n    Computes the electrostatic embedding energy and electric field for a water molecule\n    in a sphere of point charges.\n    \"\"\"\n    # Physical constants in SI units\n    K_E = 8.9875517923e9  # Coulomb constant (N m^2 C^-2)\n    E_CHARGE = 1.602176634e-19  # Elementary charge (C)\n    N_A = 6.02214076e23  # Avogadro constant (mol^-1)\n    \n    # Conversion factors\n    NM_TO_M = 1.0e-9\n\n    # --- QM Subsystem (Water Molecule) Setup ---\n    # Partial charges in units of elementary charge e\n    Q_O = -0.834\n    Q_H = 0.417\n    qm_charges_e = np.array([Q_O, Q_H, Q_H])\n    qm_charges_C = qm_charges_e * E_CHARGE\n    \n    # Geometry in nanometers\n    D_OH = 0.09572  # O-H bond length (nm)\n    ALPHA_DEG = 104.52  # H-O-H angle (degrees)\n    theta_rad = np.deg2rad(ALPHA_DEG / 2.0)\n    \n    r_O_nm = np.array([0.0, 0.0, 0.0])\n    r_H1_nm = np.array([D_OH * np.sin(theta_rad), 0.0, D_OH * np.cos(theta_rad)])\n    r_H2_nm = np.array([-D_OH * np.sin(theta_rad), 0.0, D_OH * np.cos(theta_rad)])\n    \n    qm_pos_nm = np.array([r_O_nm, r_H1_nm, r_H2_nm])\n    qm_pos_m = qm_pos_nm * NM_TO_M\n\n    # --- Test Cases ---\n    test_cases = [\n        {\n            \"R_nm\": 1.0, \n            \"mm_charges\": [\n                (0.2, (0, 0, 1.0)),\n                (-0.2, (0, 0, -1.0)),\n                (0.1, (1.0/np.sqrt(2), 0, 1.0/np.sqrt(2)))\n            ]\n        },\n        {\n            \"R_nm\": 0.3, \n            \"mm_charges\": [\n                (1.0, (0, 0, 0.3)),\n                (-1.0, (0, 0, -0.3)),\n                (0.5, (0, 0.3, 0))\n            ]\n        },\n        {\n            \"R_nm\": 2.0,\n            \"mm_charges\": [\n                (0.5, (2.0, 0, 0)),\n                (-0.5, (-2.0, 0, 0)),\n                (0.25, (0, 0, 2.0)),\n                (-0.25, (0, 0, -2.0))\n            ]\n        }\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        R_nm = case[\"R_nm\"]\n        mm_charges_tuples = case[\"mm_charges\"]\n        \n        mm_charges_e = np.array([charge[0] for charge in mm_charges_tuples])\n        mm_pos_nm = np.array([charge[1] for charge in mm_charges_tuples])\n        \n        # Convert to SI units for calculation\n        mm_charges_C = mm_charges_e * E_CHARGE\n        mm_pos_m = mm_pos_nm * NM_TO_M\n        R_m = R_nm * NM_TO_M\n\n        # --- Embedding Energy Calculation ---\n        # Calculate pairwise distances between all QM atoms and all MM charges\n        # cdist computes a (N_QM x N_MM) matrix of distances in meters\n        dist_matrix_m = cdist(qm_pos_m, mm_pos_m, 'euclidean')\n        \n        # Create a (N_QM x N_MM) matrix of charge products (q_i * q_a)\n        charge_product_matrix_C2 = np.outer(qm_charges_C, mm_charges_C)\n        \n        # Calculate interaction energy for each pair and sum them up\n        # The result is the total energy in Joules\n        energy_matrix_J = K_E * charge_product_matrix_C2 / dist_matrix_m\n        total_energy_J = np.sum(energy_matrix_J)\n        \n        # Convert to kJ/mol\n        energy_kJ_per_mol = total_energy_J * N_A / 1000.0\n\n        # --- Electric Field Calculation ---\n        # Position of oxygen is the origin, so r_O is the zero vector\n        # E = sum( k_e * q_a * (r_O - R_a) / |r_O - R_a|^3 ) = -k_e * sum(q_a * R_a / |R_a|^3)\n        # Since |R_a| = R for all a, we can factor out R^3\n        \n        # Reshape for broadcasting\n        mm_charges_C_col = mm_charges_C[:, np.newaxis]\n        \n        # Sum of q_a * R_a vectors\n        sum_qR_vec_Cm = np.sum(mm_charges_C_col * mm_pos_m, axis=0) # Result is a 1x3 vector\n        \n        # Total E-field vector in V/m\n        E_vec_Vm = -K_E * sum_qR_vec_Cm / (R_m**3)\n        \n        # Magnitude of the E-field in V/m\n        E_mag_Vm = np.linalg.norm(E_vec_Vm)\n        \n        # Convert to V/nm\n        E_mag_Vnm = E_mag_Vm / 1.0e9\n\n        all_results.append([round(energy_kJ_per_mol, 6), round(E_mag_Vnm, 6)])\n\n    # Format the final output string exactly as requested\n    sub_lists = [f\"[{e},{E}]\" for e, E in all_results]\n    final_string = f\"[{','.join(sub_lists)}]\"\n    print(final_string)\n\nsolve()\n```"
        },
        {
            "introduction": "在掌握了基本的QM/MM静电相互作用能计算后，本练习将引导您应用这一技能来分析一个模拟的酶活性位点。您将通过一种称为“计算突变”或“电荷静默”的强大技术，系统地关闭特定MM残基的电荷，从而量化它们对QM区域的静电贡献。这项实践模拟了计算生物化学中常用的分析方法，旨在揭示哪些氨基酸残基在稳定关键化学基团中起主导作用。",
            "id": "2455018",
            "problem": "您需要实现一个程序，用于量化在量子力学/分子力学 (QM/MM) 设置中，选择性屏蔽分子力学 (MM) 残基对静电嵌入能量的影响。在静电嵌入中，量子区域受到由代表 MM 环境的点电荷产生的外部静电势的影响。在此，您需要将量子力学 (QM) 区域建模为一组固定点电荷，并将分子力学 (MM) 环境建模为一组按残基分组的点电荷。屏蔽一个残基意味着将其所有的 MM 点电荷设置为零。\n\n请从以下基本原理和定义出发，不要使用任何未经证明的捷径：\n- 库仑定律：点电荷的电场和电势源于其与距离的平方成反比关系，以及与电荷大小的正比关系。\n- 电荷分布在与外部电势相互作用时的静电势能，以及点电荷的叠加原理。\n- 库仑常数定义为 $k_{e} = \\dfrac{1}{4\\pi \\varepsilon_{0}}$，其中 $\\varepsilon_{0}$ 是真空介电常数。\n\n您的任务是：\n- 从第一性原理出发，推导出真空中 QM 点电荷与 MM 点电荷之间静电相互作用能的可计算表达式。\n- 实现此表达式，以计算所有 MM 残基都存在时的基线能量，以及特定残基被屏蔽时的能量。\n- 报告每个给定测试用例的能量变化 $\\Delta E = E_{\\text{muted}} - E_{\\text{full}}$。\n\n单位和常数：\n- 距离以纳米为单位，电荷以基本电荷为单位。\n- 您必须以千焦耳/摩尔为单位表示最终能量，并四舍五入到六位小数。\n- 使用基本电荷 $e = 1.602176634\\times 10^{-19}\\ \\text{C}$、真空介电常数 $\\varepsilon_{0} = 8.8541878128\\times 10^{-12}\\ \\text{C}^{2}\\ \\text{N}^{-1}\\ \\text{m}^{-2}$、阿伏伽德罗常数 $N_{\\text{A}} = 6.02214076\\times 10^{23}\\ \\text{mol}^{-1}$，以及定义 $k_{e} = \\dfrac{1}{4\\pi \\varepsilon_{0}}$。在您的推导中，必须将以纳米为单位的距离一致地转换为米，之后再将最终结果转换为千焦耳/摩尔。\n\n体系说明：\n- QM 区域电荷（每个表示为 $(q, (x,y,z))$，其中 $q$ 以 $e$ 为单位，$(x,y,z)$ 以纳米为单位）：\n    - $q_{1} = +0.70$ 位于 $(0.000, 0.000, 0.000)$\n    - $q_{2} = -0.80$ 位于 $(0.120, 0.000, 0.000)$\n    - $q_{3} = +0.10$ 位于 $(-0.100, 0.100, 0.000)$\n- MM 残基，每个残基是一个点电荷列表 $(Q, (x,y,z))$，其中 $Q$ 以 $e$ 为单位，$(x,y,z)$ 以纳米为单位：\n    - $\\text{ASP25}$:\n        - $Q = -0.80$ 位于 $(0.500, 0.000, 0.000)$\n        - $Q = -0.80$ 位于 $(0.520, 0.080, 0.000)$\n        - $Q = +0.60$ 位于 $(0.480, -0.050, 0.000)$\n    - $\\text{LYS72}$:\n        - $Q = -0.30$ 位于 $(0.000, 0.600, 0.100)$\n        - $Q = +0.4333333333$ 位于 $(0.040, 0.650, 0.120)$\n        - $Q = +0.4333333333$ 位于 $(-0.040, 0.650, 0.080)$\n        - $Q = +0.4333333333$ 位于 $(0.000, 0.550, 0.060)$\n    - $\\text{LEU100}$:\n        - $Q = +0.10$ 位于 $(0.900, 0.900, 0.900)$\n        - $Q = -0.10$ 位于 $(0.950, 0.920, 0.880)$\n    - $\\text{WAT301}$:\n        - $Q = -0.834$ 位于 $(0.300, 0.200, 0.500)$\n        - $Q = +0.417$ 位于 $(0.240, 0.220, 0.540)$\n        - $Q = +0.417$ 位于 $(0.340, 0.150, 0.460)$\n\n屏蔽的定义：\n- 对于任何指定的要屏蔽的残基集合，将这些残基中的所有 $Q$ 值设置为 0，并使用相同的几何构型在真空中重新计算 QM-MM 静电相互作用能。\n\n所需输出和测试套件：\n- 对于以下每个测试用例，计算以千焦耳/摩尔为单位的 $\\Delta E = E_{\\text{muted}} - E_{\\text{full}}$，并四舍五入到六位小数：\n    1. 屏蔽 $\\{\\text{ASP25}\\}$。\n    2. 屏蔽 $\\{\\text{LYS72}, \\text{WAT301}\\}$。\n    3. 屏蔽 $\\{\\}$（不屏蔽任何残基）。\n    4. 屏蔽 $\\{\\text{ASP25}, \\text{LYS72}, \\text{LEU100}, \\text{WAT301}\\}$。\n    5. 屏蔽 $\\{\\text{LEU100}\\}$。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[\\Delta E_{1},\\Delta E_{2},\\Delta E_{3},\\Delta E_{4},\\Delta E_{5}]$），每个值都以千焦耳/摩尔为单位，并四舍五入到六位小数。",
            "solution": "问题在于，当特定的分子力学 (MM) 残基被“屏蔽”（即其原子部分电荷被设置为零）时，量化量子力学 (QM) 区域和分子力学 (MM) 区域之间静电相互作用能的变化。这需要从第一性原理出发，推导出 QM/MM 相互作用能的可计算表达式。\n\n推导始于库仑定律，该定律指出，位于位置 $\\vec{R}_j$ 的单个点电荷 $Q_j$ 在位置 $\\vec{r}_i$ 处产生静电势 $V_j$，其表达式为：\n$$ V_j(\\vec{r}_i) = k_e \\frac{Q_j}{|\\vec{r}_i - \\vec{R}_j|} $$\n此处，$k_e = \\frac{1}{4\\pi\\varepsilon_0}$ 是库仑常数，其中 $\\varepsilon_0$ 是真空介电常数。MM 环境被建模为此类点电荷的集合。根据叠加原理，由所有 MM 电荷在位置 $\\vec{r}_i$ 处产生的总静电势 $V_{\\text{MM}}$ 是它们各自电势的总和：\n$$ V_{\\text{MM}}(\\vec{r}_i) = k_e \\sum_{j \\in \\text{MM}} \\frac{Q_j}{|\\vec{r}_i - \\vec{R}_j|} $$\nQM 区域也被建模为位于固定位置 $\\{\\vec{r}_i\\}$ 的一组点电荷 $\\{q_i\\}$。单个 QM 电荷 $q_i$ 在由 MM 环境产生的外部电势中的静电势能 $U_i$ 为 $U_i = q_i V_{\\text{MM}}(\\vec{r}_i)$。QM 部分与 MM 部分之间的总静电相互作用能 $E_{\\text{QM/MM}}$ 是所有 QM 电荷势能的总和：\n$$ E_{\\text{QM/MM}} = \\sum_{i \\in \\text{QM}} U_i = \\sum_{i \\in \\text{QM}} q_i V_{\\text{MM}}(\\vec{r}_i) $$\n代入 $V_{\\text{MM}}$ 的表达式，我们得到相互作用能的完整表达式，即一个对所有 QM 电荷 $i$ 和所有 MM 电荷 $j$ 的双重求和：\n$$ E_{\\text{QM/MM}} = k_e \\sum_{i \\in \\text{QM}} \\sum_{j \\in \\text{MM}} \\frac{q_i Q_j}{|\\vec{r}_i - \\vec{R}_j|} $$\n问题要求此能量以千焦耳/摩尔 ($\\text{kJ/mol}$) 表示。给定的输入单位是：$q_i$ 和 $Q_j$ 以基本电荷 ($e$) 为单位，距离以纳米 ($\\text{nm}$) 为单位。设 $q'_i$ 和 $Q'_j$ 是以 $e$ 为单位的电荷数值，而 $d_{ij}$ 是以 $\\text{nm}$ 为单位的距离 $|\\vec{r}_i - \\vec{R}_j|$。以国际单位制（焦耳）表示的能量为：\n$$ E_{\\text{QM/MM}} [\\text{J}] = \\frac{1}{4\\pi\\varepsilon_0} \\sum_{i,j} \\frac{(q'_i e)(Q'_j e)}{d_{ij} \\times 10^{-9}} $$\n为了将其转换为 $\\text{kJ/mol}$，我们乘以阿伏伽德罗常数 $N_A$ 并除以 $1000$：\n$$ E_{\\text{QM/MM}} [\\text{kJ/mol}] = \\left( \\frac{e^2 N_A}{4\\pi\\varepsilon_0 \\times 10^{-9} \\times 1000} \\right) \\sum_{i,j} \\frac{q'_i Q'_j}{d_{ij}} $$\n括号中的项是一个转换因子 $C_{\\text{factor}}$。使用所提供的常数 $e = 1.602176634 \\times 10^{-19}\\ \\text{C}$、$\\varepsilon_0 = 8.8541878128 \\times 10^{-12}\\ \\text{C}^2\\text{N}^{-1}\\text{m}^{-2}$ 和 $N_A = 6.02214076 \\times 10^{23}\\ \\text{mol}^{-1}$，计算出的值为：\n$$ C_{\\text{factor}} \\approx 1389.35458\\ \\frac{\\text{kJ}\\cdot\\text{nm}}{\\text{mol}\\cdot e^2} $$\n最终的可计算表达式为：\n$$ E_{\\text{QM/MM}} [\\text{kJ/mol}] = C_{\\text{factor}} \\sum_{i \\in \\text{QM}} \\sum_{j \\in \\text{MM}} \\frac{q'_i Q'_j}{d_{ij}[\\text{nm}]} $$\n题目要求我们计算能量变化 $\\Delta E = E_{\\text{muted}} - E_{\\text{full}}$。总相互作用能 $E_{\\text{full}}$ 可以表示为每个 MM 残基 $k$ 贡献的总和：$E_{\\text{full}} = \\sum_k E_{\\text{QM/res}_k}$。当一组残基 $M$ 被屏蔽时，它们的电荷 $Q_j$ 被设置为 0，因此它们对总能量的贡献消失。被屏蔽体系的能量为 $E_{\\text{muted}} = \\sum_{k \\notin M} E_{\\text{QM/res}_k}$。因此，能量变化为：\n$$ \\Delta E = E_{\\text{muted}} - E_{\\text{full}} = \\sum_{k \\notin M} E_{\\text{QM/res}_k} - \\sum_k E_{\\text{QM/res}_k} = -\\sum_{k \\in M} E_{\\text{QM/res}_k} $$\n这个结果提供了一个显著的计算简化：能量变化就是 QM 区域与被屏蔽的特定残基之间相互作用能的负值。因此，算法如下：\n1. 对每个 MM 残基，计算其与整个 QM 区域的总相互作用能 $E_{\\text{QM/res}_k}$。\n2. 存储这些预先计算的基于残基的能量。\n3. 对每个测试用例，确定要屏蔽的残基集合 $M$。\n4. 通过对集合 $M$ 中残基的预计算能量求和并取负值来计算 $\\Delta E$。\n5. 按要求将最终结果四舍五入至六位小数。\n这种方法避免了为每个测试用例重新计算完整的相互作用总和，从而实现了一个高效、直接的解决方案。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the QM/MM electrostatic embedding problem by calculating the energy change\n    upon muting specific MM residues.\n    \"\"\"\n    # Define physical constants as per the problem statement.\n    # Elementary charge in Coulombs.\n    E_CHARGE = 1.602176634e-19  # C\n    # Vacuum permittivity in Farads per meter (C^2 N^-1 m^-2).\n    VACUUM_PERMITTIVITY = 8.8541878128e-12\n    # Avogadro's number in mol^-1.\n    AVOGADRO = 6.02214076e+23\n\n    # Derive the conversion factor to convert from dimensionless energy sum (e^2/nm) to kJ/mol.\n    # The formula is C = (e^2 * N_A) / (4 * pi * epsilon_0 * (1 nm - m) * (1 J - kJ)).\n    # (1 nm - m) = 1e-9 m, (1 J - kJ) = 1/1000 kJ.\n    CONVERSION_FACTOR = (E_CHARGE**2 * AVOGADRO) / (4 * np.pi * VACUUM_PERMITTIVITY * 1e-9 * 1000)\n    # The resulting factor is approximately 1389.35458 kJ·nm / (mol·e^2).\n\n    # Define the QM region as a list of tuples: (charge in elementary charge units, position in nm).\n    qm_charges = [\n        (0.70, np.array([0.000, 0.000, 0.000])),\n        (-0.80, np.array([0.120, 0.000, 0.000])),\n        (0.10, np.array([-0.100, 0.100, 0.000])),\n    ]\n\n    # Define the MM residues as a dictionary mapping residue names to a list of their atoms.\n    # Each atom is a tuple: (charge in elementary charge units, position in nm).\n    mm_residues = {\n        \"ASP25\": [\n            (-0.80, np.array([0.500, 0.000, 0.000])),\n            (-0.80, np.array([0.520, 0.080, 0.000])),\n            (0.60, np.array([0.480, -0.050, 0.000])),\n        ],\n        \"LYS72\": [\n            (-0.30, np.array([0.000, 0.600, 0.100])),\n            (0.4333333333, np.array([0.040, 0.650, 0.120])),\n            (0.4333333333, np.array([-0.040, 0.650, 0.080])),\n            (0.4333333333, np.array([0.000, 0.550, 0.060])),\n        ],\n        \"LEU100\": [\n            (0.10, np.array([0.900, 0.900, 0.900])),\n            (-0.10, np.array([0.950, 0.920, 0.880])),\n        ],\n        \"WAT301\": [\n            (-0.834, np.array([0.300, 0.200, 0.500])),\n            (0.417, np.array([0.240, 0.220, 0.540])),\n            (0.417, np.array([0.340, 0.150, 0.460])),\n        ],\n    }\n\n    def calculate_residue_interaction(res_atoms):\n        \"\"\"\n        Calculates the interaction energy between the entire QM region and a single MM residue.\n        Returns the energy in kJ/mol.\n        \"\"\"\n        energy_sum = 0.0\n        for q_val, q_pos in qm_charges:\n            for Q_val, Q_pos in res_atoms:\n                distance = np.linalg.norm(q_pos - Q_pos)\n                if distance == 0:\n                    # Problem setup guarantees no overlapping atoms, but this is good practice.\n                    raise ValueError(\"QM and MM atoms cannot occupy the same position.\")\n                energy_sum += (q_val * Q_val) / distance\n        return CONVERSION_FACTOR * energy_sum\n\n    # Pre-calculate the interaction energy of each MM residue with the QM region.\n    residue_interaction_energies = {\n        res_name: calculate_residue_interaction(res_atoms)\n        for res_name, res_atoms in mm_residues.items()\n    }\n\n    # Define the test cases as sets of residue names to be muted.\n    test_cases = [\n        {\"ASP25\"},\n        {\"LYS72\", \"WAT301\"},\n        set(),  # Case 3: No residues are muted.\n        {\"ASP25\", \"LYS72\", \"LEU100\", \"WAT301\"},\n        {\"LEU100\"},\n    ]\n\n    results = []\n    # Process each test case.\n    for mute_set in test_cases:\n        # The energy change, Delta E, is the negative of the sum of the interaction\n        # energies of the muted residues.\n        delta_e = -sum(residue_interaction_energies.get(res_name, 0.0) for res_name in mute_set)\n        \n        # Format the result to six decimal places for the final output.\n        results.append(f\"{delta_e:.6f}\")\n\n    # Print the final results in the specified single-line format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "本高级练习展示了静电嵌入方法如何超越简单的基态能量计算，用于解释环境对分子电子性质的影响。您将通过微扰理论，研究一个丙酮分子在外部点电荷（模拟精氨酸阳离子）的电场作用下，其 $S_0 \\rightarrow S_1$ 激发能发生的变化。这个练习将静电势的概念与可观测的光谱位移联系起来，揭示了QM/MM在理解和预测溶剂化显色效应等现象中的强大能力。",
            "id": "2454992",
            "problem": "您将为一个简单的量子力学/分子力学 (QM/MM) 场景实现一个基于物理的静电嵌入模型，以量化当单个精氨酸阳离子靠近羰基氧时，丙酮的单重基态到第一激发态的激发能如何变化。量子子系统是丙酮，分子力学环境被模拟为代表精氨酸阳离子的单个点电荷。您将通过将外部静电场视为经典微扰，并结合经典静电学使用不含时微扰理论的前几阶来计算激发能的变化。\n\n使用以下标准且被广泛接受的基本依据：\n- 来自库仑定律的点电荷电场：对于位于位置矢量 $\\mathbf{R}$、电荷量为 $q$ 的点电荷，在相对介电常数为 $\\varepsilon_{r}$ 的介质中，原点处的电场为 $\\mathbf{E} = -\\dfrac{1}{4\\pi \\varepsilon_{0} \\varepsilon_{r}} \\dfrac{q \\, \\mathbf{R}}{\\lVert \\mathbf{R} \\rVert^{3}}$。\n- 永久偶极子 $\\boldsymbol{\\mu}$ 在均匀电场 $\\mathbf{E}$ 中的能量为 $U_{\\text{perm}} = - \\boldsymbol{\\mu} \\cdot \\mathbf{E}$。\n- 对于一个具有标量极化率 $\\alpha$ 的各向同性可极化系统，在场强大小为 $E$ 的均匀电场中，与感生偶极子相关的能量为 $U_{\\text{ind}} = - \\dfrac{1}{2}\\,\\alpha\\,E^{2}$。\n- 在量子力学/分子力学 (QM/MM) 类型的静电嵌入中，由经典场引起的电子态能量的移动由该态的永久偶极子相互作用和感生偶极子能量之和给出。\n- 激发能移动是激发电子态和基态电子态的场致移动之差。\n\n丙酮和精氨酸阳离子的假设和参数：\n- 考虑丙酮的羰基氧位于原点，羰基轴沿 $+x$ 方向。我们关心的电子跃迁是单重基态到第一激发态 ($S_{0} \\rightarrow S_{1}$)。假设跃迁偶极矩差 $\\Delta \\boldsymbol{\\mu} = \\boldsymbol{\\mu}_{S_{1}} - \\boldsymbol{\\mu}_{S_{0}}$ 沿 $+x$ 方向排列，其大小为 $\\lVert \\Delta \\boldsymbol{\\mu} \\rVert = 1.20$ 德拜。两个态之间的各向同性极化率差为 $\\Delta \\alpha_{\\text{iso}} = 3.00$ $\\text{\\AA}^{3}$。\n- 将精氨酸阳离子建模为电荷量为 $q = +e$ 的点电荷，其中 $e$ 是元电荷。\n- 丙酮的基准气相激发能为 $E_{\\text{gas}} = 4.40$ 电子伏特。\n- 在每个测试案例中，通过库仑定律中的相对介电常数 $\\varepsilon_{r}$ 来处理介质，具体数值按案例指定。\n\n需要使用的物理常数和单位换算：\n- 真空介电常数 $\\varepsilon_{0} = 8.8541878128 \\times 10^{-12}$ $\\text{F}\\,\\text{m}^{-1}$。\n- 元电荷 $e = 1.602176634 \\times 10^{-19}$ $\\text{C}$。\n- 德拜到库仑-米：$1$ 德拜 $= 3.33564 \\times 10^{-30}$ $\\text{C}\\,\\text{m}$。\n- 埃到米：$1$ $\\text{\\AA} = 1.0 \\times 10^{-10}$ $\\text{m}$。\n- 各向同性极化率换算：$1$ $\\text{\\AA}^{3}$ 对应的极化率为 $(4\\pi \\varepsilon_{0}) \\times 10^{-30}$ $\\text{C}\\,\\text{m}^{2}\\,\\text{V}^{-1}$。\n\n几何设置：\n- 将丙酮的氧原子置于原点。羰基轴沿 $+x$ 方向。偶极矩差矢量为 $\\Delta \\boldsymbol{\\mu} = \\lVert \\Delta \\boldsymbol{\\mu} \\rVert \\,\\hat{\\mathbf{x}}$。对于每个测试案例，精氨酸阳离子点电荷被放置在相对于原点的位置矢量 $\\mathbf{R}$（以 $\\text{\\AA}$ 为单位）处。\n- 使用库仑定律计算点电荷在原点产生的电场 $\\mathbf{E}$。\n- 使用永久偶极子和感生偶极子能量，计算 $S_{0}$ 和 $S_{1}$ 的一阶和二阶态能量移动，然后将激发能移动构成激发态和基态移动之差。将每个案例的最终激发能表示为 $E_{\\text{exc}} = E_{\\text{gas}} + \\Delta E_{\\text{exc}}$，单位为电子伏特。您必须通过各向同性极化率差同时包括永久偶极子贡献和感生偶极子贡献。\n- 使用符号约定，即稳定化相互作用（能量降低）产生负的能量移动。\n\n角度单位：\n- 所有角度都通过笛卡尔坐标中矢量的点积隐式处理，因此不需要明确的角度单位。\n\n数值输出要求：\n- 对于每个测试案例，计算以电子伏特为单位的 $E_{\\text{exc}}$，并四舍五入到小数点后六位。\n\n测试套件：\n- 案例 1 (近距离共线，类蛋白质介电常数): $\\mathbf{R} = (3.0, 0.0, 0.0)$ $\\text{\\AA}$, $\\varepsilon_{r} = 2.0$。\n- 案例 2 (在另一侧近距离共线，类蛋白质介电常数): $\\mathbf{R} = (-3.0, 0.0, 0.0)$ $\\text{\\AA}$, $\\varepsilon_{r} = 2.0$。\n- 案例 3 (中等距离，类蛋白质介电常数): $\\mathbf{R} = (5.0, 0.0, 0.0)$ $\\text{\\AA}$, $\\varepsilon_{r} = 2.0$。\n- 案例 4 (垂直接近，类蛋白质介电常数): $\\mathbf{R} = (0.0, 3.0, 0.0)$ $\\text{\\AA}$, $\\varepsilon_{r} = 2.0$。\n- 案例 5 (高介电常数中远距离): $\\mathbf{R} = (100.0, 0.0, 0.0)$ $\\text{\\AA}$, $\\varepsilon_{r} = 80.0$。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含五个测试案例的激发能，格式为方括号内以逗号分隔的列表，例如 $[x_{1},x_{2},x_{3},x_{4},x_{5}]$，其中每个 $x_{i}$ 是以电子伏特为单位的激发能，四舍五入到小数点后六位。",
            "solution": "该问题已经过验证，被认为是具有科学依据、提法得当且客观的。它展示了计算化学中一个标准但简化的场景，涉及量子力学/分子力学 (QM/MM) 静电嵌入模型。所有必要的参数、常数和清晰的方法论都已提供。因此，该问题被视为有效，并将构建一个正式的解决方案。\n\n目标是计算由于附近精氨酸阳离子的静电场引起的丙酮分子 $S_{0} \\rightarrow S_{1}$ 电子激发能的移动。这是微扰理论的一个经典应用，其中来自自分子力学 (MM) 点电荷的外部场微扰了量子力学 (QM) 子系统（丙酮）的能级。\n\n在均匀外部电场 $\\mathbf{E}$ 中，电子态 $n$ 的总能量可以表示为级数展开。到二阶，能量移动 $\\Delta E_{n}$ 由下式给出：\n$$\n\\Delta E_{n} = -\\boldsymbol{\\mu}_{n} \\cdot \\mathbf{E} - \\frac{1}{2} \\mathbf{E} \\cdot \\boldsymbol{\\alpha}_{n} \\cdot \\mathbf{E} + \\dots\n$$\n此处，$\\boldsymbol{\\mu}_{n}$ 是态 $n$ 的永久电偶极矩，$\\boldsymbol{\\alpha}_{n}$ 是其极化率张量。问题指定了各向同性极化率，因此张量 $\\boldsymbol{\\alpha}_{n}$ 被标量 $\\alpha_n$ 乘以单位矩阵所取代，将二阶项简化为 $-\\frac{1}{2} \\alpha_{n} E^2$，其中 $E = \\lVert \\mathbf{E} \\rVert$。\n\n激发能的移动 $\\Delta E_{\\text{exc}}$ 是激发态 ($S_{1}$) 和基态 ($S_{0}$) 能量移动之差：\n$$\n\\Delta E_{\\text{exc}} = \\Delta E_{S_{1}} - \\Delta E_{S_{0}}\n$$\n代入态能量移动的表达式：\n$$\n\\Delta E_{\\text{exc}} = \\left( -\\boldsymbol{\\mu}_{S_{1}} \\cdot \\mathbf{E} - \\frac{1}{2} \\alpha_{S_{1}} E^2 \\right) - \\left( -\\boldsymbol{\\mu}_{S_{0}} \\cdot \\mathbf{E} - \\frac{1}{2} \\alpha_{S_{0}} E^2 \\right)\n$$\n这个表达式可以根据两个态之间的差值性质重新排列：\n$$\n\\Delta E_{\\text{exc}} = -(\\boldsymbol{\\mu}_{S_{1}} - \\boldsymbol{\\mu}_{S_{0}}) \\cdot \\mathbf{E} - \\frac{1}{2}(\\alpha_{S_{1}} - \\alpha_{S_{0}})E^2\n$$\n设偶极矩差为 $\\Delta \\boldsymbol{\\mu} = \\boldsymbol{\\mu}_{S_{1}} - \\boldsymbol{\\mu}_{S_{0}}$，各向同性极化率差为 $\\Delta \\alpha_{\\text{iso}} = \\alpha_{S_{1}} - \\alpha_{S_{0}}$。则激发能移动为：\n$$\n\\Delta E_{\\text{exc}} = \\underbrace{- \\Delta \\boldsymbol{\\mu} \\cdot \\mathbf{E}}_{\\Delta E^{(1)}} \\underbrace{- \\frac{1}{2} \\Delta \\alpha_{\\text{iso}} E^2}_{\\Delta E^{(2)}}\n$$\n其中 $\\Delta E^{(1)}$ 是一阶贡献（与永久偶极矩差的相互作用），$\\Delta E^{(2)}$ 是二阶贡献（与极化率差相关的相互作用）。\n\n计算过程如下：\n首先，我们建立一个一致的单位制。所有计算都将以国际单位制 (SI) 进行。给定的参数和常数是：\n- 真空介电常数：$\\varepsilon_{0} = 8.8541878128 \\times 10^{-12} \\, \\text{F}\\,\\text{m}^{-1}$。\n- 元电荷：$e = 1.602176634 \\times 10^{-19} \\, \\text{C}$。\n- 位置矢量 $\\mathbf{R}$ 以埃 ($\\text{\\AA}$) 为单位给出，必须转换为米 ($1\\,\\text{\\AA} = 1.0 \\times 10^{-10}\\,\\text{m}$)。\n- 精氨酸阳离子的电荷：$q = +e = 1.602176634 \\times 10^{-19} \\, \\text{C}$。\n- 偶极矩差的大小：$\\lVert \\Delta \\boldsymbol{\\mu} \\rVert = 1.20$ 德拜。将其转换为库仑-米 ($1\\,\\text{D} = 3.33564 \\times 10^{-30}\\,\\text{C}\\,\\text{m}$)，得到 $\\lVert \\Delta \\boldsymbol{\\mu} \\rVert_{SI} = 1.20 \\times 3.33564 \\times 10^{-30} \\approx 4.002768 \\times 10^{-30}\\,\\text{C}\\,\\text{m}$。由于它沿 $+x$ 轴排列，因此 $\\Delta \\boldsymbol{\\mu} = (\\lVert \\Delta \\boldsymbol{\\mu} \\rVert_{SI}, 0, 0)$。\n- 各向同性极化率差：$\\Delta \\alpha_{\\text{iso}} = 3.00 \\, \\text{\\AA}^{3}$。到 SI 单位的换算为 $\\alpha_{SI} = \\alpha_{\\text{\\AA}^3} \\times (4\\pi \\varepsilon_{0} \\times 10^{-30} \\, \\text{C}\\,\\text{m}^{2}\\,\\text{V}^{-1})$。因此，$\\Delta \\alpha_{\\text{iso, SI}} = 3.00 \\times (4\\pi \\times 8.8541878128 \\times 10^{-12}) \\times 10^{-30} \\approx 3.33795 \\times 10^{-40}\\,\\text{C}\\,\\text{m}^{2}\\,\\text{V}^{-1}$。\n- 基准气相激发能：$E_{\\text{gas}} = 4.40 \\, \\text{eV}$。\n\n对于每个由位置矢量 $\\mathbf{R}$ 和相对介电常数 $\\varepsilon_r$ 指定的测试案例：\n1.  使用提供的公式计算位于位置 $\\mathbf{R}$ 的点电荷 $q$ 在原点产生的电场 $\\mathbf{E}$：\n    $$\n    \\mathbf{E} = -\\frac{1}{4\\pi \\varepsilon_{0} \\varepsilon_{r}} \\frac{q \\, \\mathbf{R}}{\\lVert \\mathbf{R} \\rVert^{3}}\n    $$\n    这个公式在定义的相互作用能表达式 $U = -\\boldsymbol{\\mu} \\cdot \\mathbf{E}$ 中是物理上正确的。矢量 $\\mathbf{R}$ 及其范数 $\\lVert \\mathbf{R} \\rVert$ 首先被转换为 SI 单位。\n\n2.  计算一阶能量移动 $\\Delta E^{(1)}$。鉴于 $\\Delta \\boldsymbol{\\mu}$ 只有一个 x 分量，这可以简化为：\n    $$\n    \\Delta E^{(1)} = - \\Delta \\mu_x E_x\n    $$\n\n3.  计算二阶能量移动 $\\Delta E^{(2)}$。这需要电场大小的平方，$E^2 = \\lVert \\mathbf{E} \\rVert^2$：\n    $$\n    \\Delta E^{(2)} = - \\frac{1}{2} \\Delta \\alpha_{\\text{iso, SI}} E^2\n    $$\n\n4.  以焦耳为单位的总激发能移动 $\\Delta E_{\\text{exc, J}}$ 是 $\\Delta E^{(1)} + \\Delta E^{(2)}$ 的和。\n\n5.  通过除以元电荷 $e$，将此移动从焦耳转换为电子伏特 (eV)：\n    $$\n    \\Delta E_{\\text{exc, eV}} = \\frac{\\Delta E_{\\text{exc, J}}}{e}\n    $$\n\n6.  最后，通过将移动加到气相值上，计算出存在电荷时的总激发能 $E_{\\text{exc}}$：\n    $$\n    E_{\\text{exc}} = E_{\\text{gas}} + \\Delta E_{\\text{exc, eV}}\n    $$\n每个案例的最终结果按要求四舍五入到六位小数。此过程系统地应用于所有指定的测试案例。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the solvent-shifted excitation energy of acetone due to an arginine cation.\n    \"\"\"\n    # Physical constants in SI units\n    EPSILON_0 = 8.8541878128e-12  # F/m (vacuum permittivity)\n    E_CHARGE = 1.602176634e-19    # C (elementary charge)\n    \n    # Unit conversions\n    DEBYE_TO_CM = 3.33564e-30      # C*m per Debye\n    ANGSTROM_TO_M = 1.0e-10        # m per Angstrom\n    JOULE_TO_EV = 1 / E_CHARGE     # eV per Joule\n\n    # Acetone quantum system parameters\n    # Difference dipole moment (S1 - S0)\n    DELTA_MU_MAG_D = 1.20  # Debye\n    delta_mu_mag_si = DELTA_MU_MAG_D * DEBYE_TO_CM  # C*m\n    # The vector is aligned along +x\n    delta_mu_vec_si = np.array([delta_mu_mag_si, 0.0, 0.0])\n\n    # Isotropic difference polarizability (S1 - S0)\n    DELTA_ALPHA_A3 = 3.00  # Angstrom^3\n    # The problem provides its own specific conversion: 1 A^3 -> 4*pi*eps0 * 1e-30.\n    alpha_si_per_a3 = 4 * np.pi * EPSILON_0 * 1e-30\n    delta_alpha_iso_si = DELTA_ALPHA_A3 * alpha_si_per_a3 # C*m^2/V\n\n    # Baseline gas-phase excitation energy\n    E_GAS_EV = 4.40  # eV\n\n    # Arginine MM environment parameter\n    q_cation = E_CHARGE  # C\n\n    test_cases = [\n        # (R_vector in Angstrom, relative_permittivity)\n        (np.array([3.0, 0.0, 0.0]), 2.0),\n        (np.array([-3.0, 0.0, 0.0]), 2.0),\n        (np.array([5.0, 0.0, 0.0]), 2.0),\n        (np.array([0.0, 3.0, 0.0]), 2.0),\n        (np.array([100.0, 0.0, 0.0]), 80.0),\n    ]\n\n    results = []\n    for R_vec_A, eps_r in test_cases:\n        # Convert position vector to SI units (meters)\n        R_vec_si = R_vec_A * ANGSTROM_TO_M\n        R_mag_si = np.linalg.norm(R_vec_si)\n\n        # 1. Calculate the electric field E at the origin (in V/m)\n        # E = - (1 / (4*pi*eps0*eps_r)) * (q * R_vec / R_mag^3)\n        coulomb_const = 1 / (4 * np.pi * EPSILON_0)\n        E_vec_si = -(coulomb_const / eps_r) * (q_cation * R_vec_si) / (R_mag_si**3)\n        E_mag_sq_si = np.dot(E_vec_si, E_vec_si)\n\n        # 2. Calculate first-order energy shift (permanent dipole interaction) in Joules\n        delta_E1_J = -np.dot(delta_mu_vec_si, E_vec_si)\n\n        # 3. Calculate second-order energy shift (induced dipole interaction) in Joules\n        delta_E2_J = -0.5 * delta_alpha_iso_si * E_mag_sq_si\n\n        # 4. Total excitation energy shift in Joules\n        delta_E_exc_J = delta_E1_J + delta_E2_J\n\n        # 5. Convert energy shift to electronvolts\n        delta_E_exc_eV = delta_E_exc_J * JOULE_TO_EV\n        \n        # 6. Calculate the final excitation energy\n        E_exc_eV = E_GAS_EV + delta_E_exc_eV\n        \n        # 7. Round and store the result\n        results.append(round(E_exc_eV, 6))\n\n    # Format the final output as a comma-separated list in brackets\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}