{
    "hands_on_practices": [
        {
            "introduction": "The first step in mastering electrostatic embedding is to build a solid computational foundation. This exercise guides you through the process of implementing the core calculation from first principles: the electrostatic interaction between a quantum mechanical (QM) region and its molecular mechanics (MM) environment. By programming the direct summation of Coulomb's law interactions, you will compute both the embedding energy $E_{\\text{embed}}$ and the electric field $\\mathbf{E}$ at a specific point, developing the essential skills needed for all subsequent QM/MM applications .",
            "id": "2454995",
            "problem": "You must write a complete program that computes the first-order electrostatic embedding energy of a single water molecule, treated at the quantum mechanics/molecular mechanics (QM/MM) level under the electrostatic embedding approximation, inside a hollow sphere of radius $R$ populated with fixed classical point charges. The water molecule is the quantum mechanical (QM) subsystem and the surrounding point charges on the sphere are the molecular mechanics (MM) environment. The computation must be based solely on the fundamental electrostatic interaction between charges.\n\nPhysical model and definitions:\n- Represent the water molecule by three point charges located at its atomic positions: one oxygen atom and two hydrogen atoms. Use fixed partial charges $q_{\\mathrm{O}}=-0.834\\,e$ and $q_{\\mathrm{H}}=+0.417\\,e$ on oxygen and on each hydrogen, respectively, where $e$ is the elementary charge. The geometry is fixed as follows: place the oxygen atom at the origin, the molecule lies in the $x$-$z$ plane, with the bisector aligned along the $+z$ axis. Use an oxygen-hydrogen bond length of $d_{\\mathrm{OH}}=0.09572$ nanometers and a hydrogen-oxygen-hydrogen angle of $\\alpha=104.52$ degrees. Define the half-angle $\\theta=\\alpha/2$ and place the hydrogens at positions $\\mathbf{r}_{\\mathrm{H1}}=\\left(d_{\\mathrm{OH}}\\sin\\theta,\\,0,\\,d_{\\mathrm{OH}}\\cos\\theta\\right)$ and $\\mathbf{r}_{\\mathrm{H2}}=\\left(-d_{\\mathrm{OH}}\\sin\\theta,\\,0,\\,d_{\\mathrm{OH}}\\cos\\theta\\right)$, while $\\mathbf{r}_{\\mathrm{O}}=\\left(0,\\,0,\\,0\\right)$. All coordinates are in nanometers.\n- Let the set of MM point charges be $\\left\\{q_a,\\,\\mathbf{R}_a\\right\\}$, constrained to lie on the sphere of radius $R$ centered at the origin, i.e., $\\left\\lVert \\mathbf{R}_a \\right\\rVert=R$. Each $q_a$ is given in units of the elementary charge $e$, and each $\\mathbf{R}_a$ is given in nanometers.\n- The electrostatic potential at position $\\mathbf{r}$ due to the MM charges is $V_{\\mathrm{MM}}(\\mathbf{r})=\\sum_a \\dfrac{k_e\\,q_a^{(\\mathrm{C})}}{\\left\\lVert \\mathbf{r}^{(\\mathrm{m})}-\\mathbf{R}_a^{(\\mathrm{m})}\\right\\rVert}$, where $k_e=\\dfrac{1}{4\\pi\\varepsilon_0}$ is the Coulomb constant, superscript $(\\mathrm{C})$ denotes Coulomb units, and superscript $(\\mathrm{m})$ denotes that the positions are in meters. The first-order electrostatic embedding energy is\n$$\nE_{\\mathrm{embed}}=\\sum_{i\\in\\{\\mathrm{O},\\mathrm{H1},\\mathrm{H2}\\}} q_i^{(\\mathrm{C})}\\,V_{\\mathrm{MM}}\\!\\left(\\mathbf{r}_i\\right)\\,,\n$$\nwith all distances in meters and charges in Coulombs. Additionally, the electric field at the oxygen site due to MM charges is\n$$\n\\mathbf{E}_{\\mathrm{O}}=\\sum_a k_e\\,q_a^{(\\mathrm{C})}\\,\\frac{\\mathbf{r}_{\\mathrm{O}}^{(\\mathrm{m})}-\\mathbf{R}_a^{(\\mathrm{m})}}{\\left\\lVert \\mathbf{r}_{\\mathrm{O}}^{(\\mathrm{m})}-\\mathbf{R}_a^{(\\mathrm{m})}\\right\\rVert^3}\\,.\n$$\n\nConstants and units to use:\n- Coulomb constant $k_e=8.9875517923\\times 10^{9}$ $\\mathrm{N\\,m^2\\,C^{-2}}$,\n- Elementary charge $e=1.602176634\\times 10^{-19}$ $\\mathrm{C}$,\n- Avogadro constant $N_{\\mathrm{A}}=6.02214076\\times 10^{23}$ $\\mathrm{mol^{-1}}$.\n- Use nanometers for positions as given, convert to meters internally via $1~\\mathrm{nm}=1.0\\times 10^{-9}~\\mathrm{m}$.\n- Express the embedding energy $E_{\\mathrm{embed}}$ in kilojoules per mole, rounded to six decimal places.\n- Express the magnitude of the electric field at oxygen $\\left\\lVert \\mathbf{E}_{\\mathrm{O}} \\right\\rVert$ in volts per nanometer, rounded to six decimal places. Note that $1~\\mathrm{V/nm}=10^{9}~\\mathrm{V/m}$, so convert from $\\mathrm{V/m}$ to $\\mathrm{V/nm}$ by dividing by $10^{9}$.\n- Angles must be interpreted in degrees, as specified.\n\nTest suite:\nFor each test case, the hollow sphere radius $R$ (in nanometers) and the set of MM charges $\\left(q_a,\\,\\mathbf{R}_a\\right)$ are specified. All MM charges $q_a$ are given in units of the elementary charge $e$, and all positions $\\mathbf{R}_a$ are in nanometers.\n\n- Test case A (general arrangement): $R=1.0$ with MM charges\n  - $q_1=+0.2$ at $\\mathbf{R}_1=(0,\\,0,\\,R)$,\n  - $q_2=-0.2$ at $\\mathbf{R}_2=(0,\\,0,\\,-R)$,\n  - $q_3=+0.1$ at $\\mathbf{R}_3=\\left(\\dfrac{R}{\\sqrt{2}},\\,0,\\,\\dfrac{R}{\\sqrt{2}}\\right)$.\n- Test case B (close sphere, strong axial charges): $R=0.3$ with MM charges\n  - $q_1=+1.0$ at $\\mathbf{R}_1=(0,\\,0,\\,R)$,\n  - $q_2=-1.0$ at $\\mathbf{R}_2=(0,\\,0,\\,-R)$,\n  - $q_3=+0.5$ at $\\mathbf{R}_3=(0,\\,R,\\,0)$.\n- Test case C (nearly cancelling symmetric set): $R=2.0$ with MM charges\n  - $q_1=+0.5$ at $\\mathbf{R}_1=(R,\\,0,\\,0)$,\n  - $q_2=-0.5$ at $\\mathbf{R}_2=(-R,\\,0,\\,0)$,\n  - $q_3=+0.25$ at $\\mathbf{R}_3=(0,\\,0,\\,R)$,\n  - $q_4=-0.25$ at $\\mathbf{R}_4=(0,\\,0,\\,-R)$.\n\nRequired computations and outputs for each test case:\n- Compute $E_{\\mathrm{embed}}$ in kilojoules per mole.\n- Compute $\\left\\lVert \\mathbf{E}_{\\mathrm{O}} \\right\\rVert$ in volts per nanometer.\n\nFinal output format:\nYour program should produce a single line of output containing the results for the three test cases as a comma-separated list of lists, each sublist containing two floats in the order $\\left[E_{\\mathrm{embed}}~(\\mathrm{kJ/mol}),\\,\\left\\lVert \\mathbf{E}_{\\mathrm{O}} \\right\\rVert~(\\mathrm{V/nm})\\right]$, with each float rounded to six decimal places, enclosed in square brackets. For example:\n\"[[eA,EA],[eB,EB],[eC,EC]]\" where $e\\mathrm{A}$ denotes the energy for test case A, and $\\mathrm{EA}$ the field magnitude for test case A, etc.",
            "solution": "The problem statement has been validated and is found to be scientifically grounded, well-posed, objective, and complete. It describes a standard computational exercise in the field of QM/MM simulations, specifically calculating first-order electrostatic interactions. The physical model, mathematical formulas, and provided constants are all consistent with established principles of classical electrostatics. There are no contradictions or ambiguities. Therefore, a solution will be provided.\n\nThe core of this problem is the application of Coulomb's Law to calculate the electrostatic potential energy and electric field arising from the interaction between two sets of point charges. The first set represents the quantum mechanical (QM) water molecule, and the second set represents the classical molecular mechanics (MM) environment.\n\nOur procedure is as follows:\n1.  Define the Cartesian coordinates of the three atoms of the water molecule (the QM subsystem) based on the provided internal coordinates (bond length and angle).\n2.  Formulate the expressions for the electrostatic embedding energy ($E_{\\mathrm{embed}}$) and the electric field at the oxygen atom ($\\mathbf{E}_{\\mathrm{O}}$) due to the MM point charges.\n3.  Establish a consistent system of units (SI units) for all physical quantities and derive the necessary conversion factors to report the final results in the requested units of kilojoules per mole ($\\mathrm{kJ/mol}$) and volts per nanometer ($\\mathrm{V/nm}$).\n4.  Implement an algorithm to compute these quantities for each of the three test cases provided.\n\n**1. Geometry of the Water Molecule (QM Subsystem)**\n\nThe water molecule's geometry is fixed. The oxygen atom is at the origin, $\\mathbf{r}_{\\mathrm{O}} = (0, 0, 0)$. The molecule lies in the $x$-$z$ plane with its dipole moment aligned with the $z$-axis.\nThe given parameters are the O-H bond length $d_{\\mathrm{OH}} = 0.09572 \\, \\mathrm{nm}$ and the H-O-H bond angle $\\alpha = 104.52^\\circ$. The half-angle is $\\theta = \\alpha/2 = 52.26^\\circ$. To use trigonometric functions, we convert this to radians: $\\theta_{\\mathrm{rad}} = 52.26 \\times (\\pi / 180)$.\n\nThe positions of the two hydrogen atoms, $\\mathbf{r}_{\\mathrm{H1}}$ and $\\mathbf{r}_{\\mathrm{H2}}$, are calculated as:\n$$\n\\mathbf{r}_{\\mathrm{H1}} = \\left( d_{\\mathrm{OH}}\\sin\\theta, 0, d_{\\mathrm{OH}}\\cos\\theta \\right)\n$$\n$$\n\\mathbf{r}_{\\mathrm{H2}} = \\left( -d_{\\mathrm{OH}}\\sin\\theta, 0, d_{\\mathrm{OH}}\\cos\\theta \\right)\n$$\nThe partial charges are $q'_{\\mathrm{O}} = -0.834$ and $q'_{\\mathrm{H1}} = q'_{\\mathrm{H2}} = +0.417$, in units of the elementary charge $e$. We denote charges in units of $e$ with a prime ($q'$) and positions in nanometers with a prime ($\\mathbf{r}'$).\n\n**2. Electrostatic Embedding Energy ($E_{\\mathrm{embed}}$)**\n\nThe first-order electrostatic embedding energy is the sum of pairwise Coulomb interactions between each QM charge and all MM charges.\n$$\nE_{\\mathrm{embed}} = \\sum_{i \\in \\{\\mathrm{O,H1,H2}\\}} \\sum_{a \\in \\mathrm{MM}} \\frac{k_e q_i^{(\\mathrm{C})} q_a^{(\\mathrm{C})}}{\\left\\lVert \\mathbf{r}_i^{(\\mathrm{m})} - \\mathbf{R}_a^{(\\mathrm{m})} \\right\\rVert}\n$$\nwhere $k_e$ is the Coulomb constant, superscripts $(\\mathrm{C})$ and $(\\mathrm{m})$ denote charges in Coulombs and positions in meters, respectively.\n\nTo facilitate computation, we work with charges in units of $e$ ($q'$) and positions in nanometers ($\\mathbf{r}'$).\n$q_i^{(\\mathrm{C})} = q'_i e$, $q_a^{(\\mathrm{C})} = q'_a e$, and $\\mathbf{r}^{(\\mathrm{m})} = \\mathbf{r}' \\times 10^{-9}$. Substituting these into the energy expression gives the energy for a single molecule in Joules:\n$$\nE_{\\mathrm{embed}} [\\mathrm{J}] = \\sum_{i,a} \\frac{k_e (q'_i e)(q'_a e)}{\\left\\lVert (\\mathbf{r}'_i - \\mathbf{R}'_a) \\times 10^{-9} \\right\\rVert} = \\frac{k_e e^2}{10^{-9}} \\sum_{i,a} \\frac{q'_i q'_a}{\\left\\lVert \\mathbf{r}'_i - \\mathbf{R}'_a \\right\\rVert_{\\mathrm{nm}}}\n$$\nTo obtain the molar energy in kilojoules per mole, we multiply by Avogadro's constant $N_{\\mathrm{A}}$ and convert Joules to kilojoules ($1/1000$).\n$$\nE_{\\mathrm{embed}} [\\mathrm{kJ/mol}] = E_{\\mathrm{embed}} [\\mathrm{J}] \\times N_{\\mathrm{A}} \\times 10^{-3} = \\left(\\frac{k_e e^2 N_{\\mathrm{A}}}{10^{-6}}\\right) \\sum_{i,a} \\frac{q'_i q'_a}{\\left\\lVert \\mathbf{r}'_i - \\mathbf{R}'_a \\right\\rVert_{\\mathrm{nm}}}\n$$\nThe pre-factor $C_E = k_e e^2 N_{\\mathrm{A}} / 10^{-6}$ is a conversion constant with a value of approximately $138935.4576 \\, \\mathrm{kJ \\cdot nm \\cdot mol^{-1}}$.\n\n**3. Electric Field at Oxygen ($\\mathbf{E}_{\\mathrm{O}}$)**\n\nThe electric field at the oxygen atom's position ($\\mathbf{r}_{\\mathrm{O}} = \\mathbf{0}$) due to the MM charges is given by:\n$$\n\\mathbf{E}_{\\mathrm{O}} = \\sum_a k_e\\,q_a^{(\\mathrm{C})}\\,\\frac{\\mathbf{r}_{\\mathrm{O}}^{(\\mathrm{m})}-\\mathbf{R}_a^{(\\mathrm{m})}}{\\left\\lVert \\mathbf{r}_{\\mathrm{O}}^{(\\mathrm{m})}-\\mathbf{R}_a^{(\\mathrm{m})}\\right\\rVert^3}\n$$\nThe MM charges are located on a sphere of radius $R$, so $\\left\\lVert \\mathbf{R}_a \\right\\rVert = R$. Since $\\mathbf{r}_{\\mathrm{O}}=\\mathbf{0}$, the expression simplifies. Using charges in units of $e$ and positions in nanometers, we get the field in SI units (V/m):\n$$\n\\mathbf{E}_{\\mathrm{O}}[\\mathrm{V/m}] = -\\sum_{a} k_e (q'_a e) \\frac{\\mathbf{R}'_a \\times 10^{-9}}{(R' \\times 10^{-9})^3} = -\\frac{k_e e}{(10^{-9})^2} \\sum_{a} \\frac{q'_a \\mathbf{R}'_a}{(R')^3} = -k_e e \\cdot 10^{18} \\sum_{a} \\frac{q'_a \\mathbf{R}'_a}{(R')^3}\n$$\nThe problem requires the magnitude of the field in volts per nanometer ($\\mathrm{V/nm}$). The conversion is $1 \\, \\mathrm{V/nm} = 10^9 \\, \\mathrm{V/m}$.\n$$\n\\left\\lVert \\mathbf{E}_{\\mathrm{O}} \\right\\rVert_{\\mathrm{V/nm}} = \\frac{\\left\\lVert \\mathbf{E}_{\\mathrm{O}} \\right\\rVert_{\\mathrm{V/m}}}{10^9} = k_e e \\cdot 10^9 \\left\\lVert \\sum_a \\frac{q'_a \\mathbf{R}'_a}{(R')^3} \\right\\rVert\n$$\nThe pre-factor $C_F = k_e e \\cdot 10^9$ has units of $\\mathrm{V \\cdot nm}$ and a value of approximately $1.4399645$. Thus, the final expression is:\n$$\n\\left\\lVert \\mathbf{E}_{\\mathrm{O}} \\right\\rVert_{\\mathrm{V/nm}} = \\frac{C_F}{(R'_{\\mathrm{nm}})^3} \\left\\lVert \\sum_a q'_a \\mathbf{R}'_a \\right\\rVert\n$$\n\n**4. Algorithmic Implementation**\n\nThe algorithm iterates through each test case. For each case:\n- The QM and MM charge positions and values are defined. All positions are converted to meters and charges to Coulombs for internal calculations to maintain consistency with SI units.\n- For the energy calculation, a double loop is performed over QM atoms $i$ and MM charges $a$. The pairwise interaction energy $k_e q_i q_a / d_{ia}$ is computed and summed. The final sum in Joules is converted to kJ/mol.\n- For the electric field calculation, the vector contribution from each MM charge at the origin is calculated and summed. The magnitude of the total field vector is then determined and converted from V/m to V/nm.\n- The two resulting values for each test case are rounded to six decimal places and stored.\nThe final output is a formatted string representing a list of these result pairs.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.spatial.distance import cdist\n\ndef solve():\n    \"\"\"\n    Computes the electrostatic embedding energy and electric field for a water molecule\n    in a sphere of point charges.\n    \"\"\"\n    # Physical constants in SI units\n    K_E = 8.9875517923e9  # Coulomb constant (N m^2 C^-2)\n    E_CHARGE = 1.602176634e-19  # Elementary charge (C)\n    N_A = 6.02214076e23  # Avogadro constant (mol^-1)\n    \n    # Conversion factors\n    NM_TO_M = 1.0e-9\n\n    # --- QM Subsystem (Water Molecule) Setup ---\n    # Partial charges in units of elementary charge e\n    Q_O = -0.834\n    Q_H = 0.417\n    qm_charges_e = np.array([Q_O, Q_H, Q_H])\n    qm_charges_C = qm_charges_e * E_CHARGE\n    \n    # Geometry in nanometers\n    D_OH = 0.09572  # O-H bond length (nm)\n    ALPHA_DEG = 104.52  # H-O-H angle (degrees)\n    theta_rad = np.deg2rad(ALPHA_DEG / 2.0)\n    \n    r_O_nm = np.array([0.0, 0.0, 0.0])\n    r_H1_nm = np.array([D_OH * np.sin(theta_rad), 0.0, D_OH * np.cos(theta_rad)])\n    r_H2_nm = np.array([-D_OH * np.sin(theta_rad), 0.0, D_OH * np.cos(theta_rad)])\n    \n    qm_pos_nm = np.array([r_O_nm, r_H1_nm, r_H2_nm])\n    qm_pos_m = qm_pos_nm * NM_TO_M\n\n    # --- Test Cases ---\n    test_cases = [\n        {\n            \"R_nm\": 1.0, \n            \"mm_charges\": [\n                (0.2, (0, 0, 1.0)),\n                (-0.2, (0, 0, -1.0)),\n                (0.1, (1.0/np.sqrt(2), 0, 1.0/np.sqrt(2)))\n            ]\n        },\n        {\n            \"R_nm\": 0.3, \n            \"mm_charges\": [\n                (1.0, (0, 0, 0.3)),\n                (-1.0, (0, 0, -0.3)),\n                (0.5, (0, 0.3, 0))\n            ]\n        },\n        {\n            \"R_nm\": 2.0,\n            \"mm_charges\": [\n                (0.5, (2.0, 0, 0)),\n                (-0.5, (-2.0, 0, 0)),\n                (0.25, (0, 0, 2.0)),\n                (-0.25, (0, 0, -2.0))\n            ]\n        }\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        R_nm = case[\"R_nm\"]\n        mm_charges_tuples = case[\"mm_charges\"]\n        \n        mm_charges_e = np.array([charge[0] for charge in mm_charges_tuples])\n        mm_pos_nm = np.array([charge[1] for charge in mm_charges_tuples])\n        \n        # Convert to SI units for calculation\n        mm_charges_C = mm_charges_e * E_CHARGE\n        mm_pos_m = mm_pos_nm * NM_TO_M\n        R_m = R_nm * NM_TO_M\n\n        # --- Embedding Energy Calculation ---\n        # Calculate pairwise distances between all QM atoms and all MM charges\n        # cdist computes a (N_QM x N_MM) matrix of distances in meters\n        dist_matrix_m = cdist(qm_pos_m, mm_pos_m, 'euclidean')\n        \n        # Create a (N_QM x N_MM) matrix of charge products (q_i * q_a)\n        charge_product_matrix_C2 = np.outer(qm_charges_C, mm_charges_C)\n        \n        # Calculate interaction energy for each pair and sum them up\n        # The result is the total energy in Joules\n        energy_matrix_J = K_E * charge_product_matrix_C2 / dist_matrix_m\n        total_energy_J = np.sum(energy_matrix_J)\n        \n        # Convert to kJ/mol\n        energy_kJ_per_mol = total_energy_J * N_A / 1000.0\n\n        # --- Electric Field Calculation ---\n        # Position of oxygen is the origin, so r_O is the zero vector\n        # E = sum_a k_e * q_a * (r_O - R_a) / |r_O - R_a|^3\n        # E = -k_e * sum(q_a * R_a / |R_a|^3)\n        # Since |R_a| = R for all a, we can factor out R^3\n        \n        # Reshape for broadcasting\n        mm_charges_C_col = mm_charges_C[:, np.newaxis]\n        \n        # Sum of q_a * R_a vectors\n        sum_qR_vec_Cm = np.sum(mm_charges_C_col * mm_pos_m, axis=0) # Result is a 1x3 vector\n        \n        # Total E-field vector in V/m\n        E_vec_Vm = -K_E * sum_qR_vec_Cm / (R_m**3)\n        \n        # Magnitude of the E-field in V/m\n        E_mag_Vm = np.linalg.norm(E_vec_Vm)\n        \n        # Convert to V/nm\n        E_mag_Vnm = E_mag_Vm / 1.0e9\n\n        all_results.append([round(energy_kJ_per_mol, 6), round(E_mag_Vnm, 6)])\n\n    # Format the final output string exactly as requested\n    sub_lists = [f\"[{e},{E}]\" for e, E in all_results]\n    final_string = f\"[{','.join(sub_lists)}]\"\n    print(final_string)\n\nsolve()\n```"
        },
        {
            "introduction": "With a grasp of the fundamental calculations, we can now explore a key consequence of electrostatic embedding: its effect on the electronic properties of the QM system. The electrostatic field from the MM environment perturbs the quantum energy levels, leading to measurable changes in spectroscopic properties. This practice challenges you to quantify such a change—specifically, the shift in the $S_0 \\rightarrow S_1$ electronic excitation energy of an acetone molecule—providing a tangible link between the abstract theory of embedding and real-world spectroscopic observations .",
            "id": "2454992",
            "problem": "You will implement a physically grounded electrostatic embedding model for a simple quantum mechanics/molecular mechanics scenario to quantify how the singlet ground-to-first excited state excitation energy of acetone changes when a single arginine cation is brought near the carbonyl oxygen. The quantum subsystem is acetone, and the molecular mechanics environment is modeled as a single point charge representing an arginine cation. You will compute the change in the excitation energy by treating the external electrostatic field as a classical perturbation and using the leading orders of time-independent perturbation theory together with classical electrostatics.\n\nUse the following fundamental base, which is standard and widely accepted:\n- The electric field of a point charge from Coulomb’s law: for a point charge of magnitude $q$ located at position vector $\\mathbf{R}$ in a medium with relative permittivity $\\varepsilon_{r}$, the field at the origin is $\\mathbf{E} = -\\dfrac{1}{4\\pi \\varepsilon_{0} \\varepsilon_{r}} \\dfrac{q \\, \\mathbf{R}}{\\lVert \\mathbf{R} \\rVert^{3}}$.\n- The energy of a permanent dipole $\\boldsymbol{\\mu}$ in a uniform electric field $\\mathbf{E}$ is $U_{\\text{perm}} = - \\boldsymbol{\\mu} \\cdot \\mathbf{E}$.\n- The energy associated with an induced dipole for an isotropically polarizable system with scalar polarizability $\\alpha$ in a uniform field of magnitude $E$ is $U_{\\text{ind}} = - \\dfrac{1}{2}\\,\\alpha\\,E^{2}$.\n- In electrostatic embedding of a quantum mechanics/molecular mechanics (QM/MM) type, the shift of an electronic state’s energy due to the classical field is given by the sum of the permanent dipole interaction and the induced dipole energy for that state.\n- The excitation energy shift is the difference between the field-induced shifts of the excited and ground electronic states.\n\nAssumptions and parameters for acetone and the arginine cation:\n- Consider the acetone carbonyl oxygen located at the origin, with the carbonyl axis along the $+x$ direction. The electronic transition of interest is the singlet ground to first excited state ($S_{0} \\rightarrow S_{1}$). Assume the transition difference dipole $\\Delta \\boldsymbol{\\mu} = \\boldsymbol{\\mu}_{S_{1}} - \\boldsymbol{\\mu}_{S_{0}}$ is aligned along $+x$ with magnitude $\\lVert \\Delta \\boldsymbol{\\mu} \\rVert = 1.20$ Debye. The isotropic difference polarizability between the two states is $\\Delta \\alpha_{\\text{iso}} = 3.00$ $\\text{\\AA}^{3}$.\n- Model the arginine cation as a point charge with $q = +e$, where $e$ is the elementary charge.\n- The baseline gas-phase excitation energy of acetone is $E_{\\text{gas}} = 4.40$ electronvolts.\n- Treat the medium through the relative permittivity $\\varepsilon_{r}$ in Coulomb’s law as specified in each test case.\n\nRequired physical constants and unit conversions to use:\n- Vacuum permittivity $\\varepsilon_{0} = 8.8541878128 \\times 10^{-12}$ $\\text{F}\\,\\text{m}^{-1}$.\n- Elementary charge $e = 1.602176634 \\times 10^{-19}$ $\\text{C}$.\n- Debye to Coulomb-meter: $1$ Debye $= 3.33564 \\times 10^{-30}$ $\\text{C}\\,\\text{m}$.\n- Angstrom to meter: $1$ $\\text{\\AA} = 1.0 \\times 10^{-10}$ $\\text{m}$.\n- Isotropic polarizability conversion: $1$ $\\text{\\AA}^{3}$ corresponds to a polarizability of $(4\\pi \\varepsilon_{0}) \\times 10^{-30}$ $\\text{C}\\,\\text{m}^{2}\\,\\text{V}^{-1}$.\n\nGeometric setup:\n- Place the acetone oxygen at the origin. The carbonyl axis is along $+x$. The difference dipole vector is $\\Delta \\boldsymbol{\\mu} = \\lVert \\Delta \\boldsymbol{\\mu} \\rVert \\,\\hat{\\mathbf{x}}$. For each test case, the arginine cation point charge is placed at the position vector $\\mathbf{R}$ (given in $\\text{\\AA}$) relative to the origin.\n- Compute the electric field $\\mathbf{E}$ at the origin due to the point charge using Coulomb’s law.\n- Compute the first-order and second-order state energy shifts for $S_{0}$ and $S_{1}$ using the permanent dipole and induced dipole energies, and then form the excitation energy shift as the difference between the excited and ground state shifts. Express the final excitation energy for each case as $E_{\\text{exc}} = E_{\\text{gas}} + \\Delta E_{\\text{exc}}$, in electronvolts. You must include both the permanent dipole contribution and the induced dipole contribution via the isotropic difference polarizability.\n- Use the sign convention that a stabilizing interaction (lowering of energy) produces a negative shift in energy.\n\nAngle unit:\n- All angles are handled implicitly by dot products of vectors in Cartesian coordinates, so no explicit angle unit is required.\n\nNumerical output requirements:\n- For each test case, compute $E_{\\text{exc}}$ in electronvolts and round to six digits after the decimal point.\n\nTest suite:\n- Case $1$ (near and colinear, protein-like dielectric): $\\mathbf{R} = (3.0, 0.0, 0.0)$ $\\text{\\AA}$, $\\varepsilon_{r} = 2.0$.\n- Case $2$ (near and colinear on the opposite side, protein-like dielectric): $\\mathbf{R} = (-3.0, 0.0, 0.0)$ $\\text{\\AA}$, $\\varepsilon_{r} = 2.0$.\n- Case $3$ (moderate distance, protein-like dielectric): $\\mathbf{R} = (5.0, 0.0, 0.0)$ $\\text{\\AA}$, $\\varepsilon_{r} = 2.0$.\n- Case $4$ (perpendicular approach, protein-like dielectric): $\\mathbf{R} = (0.0, 3.0, 0.0)$ $\\text{\\AA}$, $\\varepsilon_{r} = 2.0$.\n- Case $5$ (far in high dielectric): $\\mathbf{R} = (100.0, 0.0, 0.0)$ $\\text{\\AA}$, $\\varepsilon_{r} = 80.0$.\n\nFinal output format:\n- Your program should produce a single line of output containing the excitation energies for the five test cases, as a comma-separated list enclosed in square brackets, for example $[x_{1},x_{2},x_{3},x_{4},x_{5}]$, where each $x_{i}$ is the excitation energy in electronvolts rounded to six digits after the decimal point.",
            "solution": "The problem has been validated and found to be scientifically grounded, well-posed, and objective. It presents a standard, albeit simplified, scenario in computational chemistry involving a quantum mechanics/molecular mechanics (QM/MM) electrostatic embedding model. All necessary parameters, constants, and a clear methodology are provided. The problem is therefore deemed valid and a formal solution will be constructed.\n\nThe objective is to compute the shift in the $S_{0} \\rightarrow S_{1}$ electronic excitation energy of an acetone molecule due to the electrostatic field of a nearby arginine cation. This is a classic application of perturbation theory, where the external field from the molecular mechanics (MM) point charge perturbs the energy levels of the quantum mechanical (QM) subsystem, acetone.\n\nThe total energy of an electronic state $n$ within a uniform external electric field $\\mathbf{E}$ can be expressed as a series expansion. To second order, the energy shift $\\Delta E_{n}$ is given by:\n$$\n\\Delta E_{n} = -\\boldsymbol{\\mu}_{n} \\cdot \\mathbf{E} - \\frac{1}{2} \\mathbf{E} \\cdot \\boldsymbol{\\alpha}_{n} \\cdot \\mathbf{E} + \\dots\n$$\nHere, $\\boldsymbol{\\mu}_{n}$ is the permanent electric dipole moment of state $n$ and $\\boldsymbol{\\alpha}_{n}$ is its polarizability tensor. The problem specifies an isotropic polarizability, so the tensor $\\boldsymbol{\\alpha}_{n}$ is replaced by a scalar $\\alpha_n$ times the identity matrix, simplifying the second-order term to $-\\frac{1}{2} \\alpha_{n} E^2$, where $E = \\lVert \\mathbf{E} \\rVert$.\n\nThe shift in the excitation energy, $\\Delta E_{\\text{exc}}$, is the difference between the energy shift of the excited state ($S_{1}$) and the ground state ($S_{0}$):\n$$\n\\Delta E_{\\text{exc}} = \\Delta E_{S_{1}} - \\Delta E_{S_{0}}\n$$\nSubstituting the expressions for the state energy shifts:\n$$\n\\Delta E_{\\text{exc}} = \\left( -\\boldsymbol{\\mu}_{S_{1}} \\cdot \\mathbf{E} - \\frac{1}{2} \\alpha_{S_{1}} E^2 \\right) - \\left( -\\boldsymbol{\\mu}_{S_{0}} \\cdot \\mathbf{E} - \\frac{1}{2} \\alpha_{S_{0}} E^2 \\right)\n$$\nThis expression can be rearranged in terms of the difference properties between the two states:\n$$\n\\Delta E_{\\text{exc}} = -(\\boldsymbol{\\mu}_{S_{1}} - \\boldsymbol{\\mu}_{S_{0}}) \\cdot \\mathbf{E} - \\frac{1}{2}(\\alpha_{S_{1}} - \\alpha_{S_{0}})E^2\n$$\nLet the difference dipole moment be $\\Delta \\boldsymbol{\\mu} = \\boldsymbol{\\mu}_{S_{1}} - \\boldsymbol{\\mu}_{S_{0}}$ and the isotropic difference polarizability be $\\Delta \\alpha_{\\text{iso}} = \\alpha_{S_{1}} - \\alpha_{S_{0}}$. The excitation energy shift is then:\n$$\n\\Delta E_{\\text{exc}} = \\underbrace{- \\Delta \\boldsymbol{\\mu} \\cdot \\mathbf{E}}_{\\Delta E^{(1)}} \\underbrace{- \\frac{1}{2} \\Delta \\alpha_{\\text{iso}} E^2}_{\\Delta E^{(2)}}\n$$\nwhere $\\Delta E^{(1)}$ is the first-order contribution (interaction with the permanent difference dipole) and $\\Delta E^{(2)}$ is the second-order contribution (interaction related to the difference in polarizability).\n\nThe calculation proceeds as follows:\nFirst, we establish a consistent system of units. All calculations will be performed in SI units. The given parameters and constants are:\n- Vacuum permittivity: $\\varepsilon_{0} = 8.8541878128 \\times 10^{-12} \\, \\text{F}\\,\\text{m}^{-1}$.\n- Elementary charge: $e = 1.602176634 \\times 10^{-19} \\, \\text{C}$.\n- Position vectors $\\mathbf{R}$ are given in Angstroms ($\\text{\\AA}$), and must be converted to meters ($1\\,\\text{\\AA} = 1.0 \\times 10^{-10}\\,\\text{m}$).\n- Charge of arginine cation: $q = +e = 1.602176634 \\times 10^{-19} \\, \\text{C}$.\n- Difference dipole moment magnitude: $\\lVert \\Delta \\boldsymbol{\\mu} \\rVert = 1.20$ Debye. This is converted to Coulomb-meters ($1\\,\\text{D} = 3.33564 \\times 10^{-30}\\,\\text{C}\\,\\text{m}$), yielding $\\lVert \\Delta \\boldsymbol{\\mu} \\rVert_{SI} = 1.20 \\times 3.33564 \\times 10^{-30} \\approx 4.002768 \\times 10^{-30}\\,\\text{C}\\,\\text{m}$. Since it is aligned along the $+x$ axis, $\\Delta \\boldsymbol{\\mu} = (\\lVert \\Delta \\boldsymbol{\\mu} \\rVert_{SI}, 0, 0)$.\n- Isotropic difference polarizability: $\\Delta \\alpha_{\\text{iso}} = 3.00 \\, \\text{\\AA}^{3}$. The conversion to SI units is $\\alpha_{SI} = \\alpha_{\\text{\\AA}^3} \\times (4\\pi \\varepsilon_{0} \\times 10^{-30} \\, \\text{C}\\,\\text{m}^{2}\\,\\text{V}^{-1})$. Thus, $\\Delta \\alpha_{\\text{iso, SI}} = 3.00 \\times (4\\pi \\times 8.8541878128 \\times 10^{-12}) \\times 10^{-30} \\approx 3.33795 \\times 10^{-40}\\,\\text{C}\\,\\text{m}^{2}\\,\\text{V}^{-1}$.\n- Baseline gas-phase excitation energy: $E_{\\text{gas}} = 4.40 \\, \\text{eV}$.\n\nFor each test case, specified by a position vector $\\mathbf{R}$ and relative permittivity $\\varepsilon_r$:\n1.  The electric field $\\mathbf{E}$ at the origin generated by the point charge $q$ at position $\\mathbf{R}$ is calculated using the standard formula:\n    $$\n    \\mathbf{E} = -\\dfrac{1}{4\\pi \\varepsilon_{0} \\varepsilon_{r}} \\dfrac{q \\, \\mathbf{R}}{\\lVert \\mathbf{R} \\rVert^{3}}\n    $$\n    This is because the vector from the source charge at $\\mathbf{R}$ to the observation point at the origin is $-\\mathbf{R}$. The vector $\\mathbf{R}$ and its norm $\\lVert \\mathbf{R} \\rVert$ are first converted to SI units.\n\n2.  The first-order energy shift $\\Delta E^{(1)}$ is computed. Given that $\\Delta \\boldsymbol{\\mu}$ has only an x-component, this simplifies to:\n    $$\n    \\Delta E^{(1)} = - \\Delta \\mu_x E_x\n    $$\n\n3.  The second-order energy shift $\\Delta E^{(2)}$ is computed. This requires the squared magnitude of the electric field, $E^2 = \\lVert \\mathbf{E} \\rVert^2$:\n    $$\n    \\Delta E^{(2)} = - \\frac{1}{2} \\Delta \\alpha_{\\text{iso, SI}} E^2\n    $$\n\n4.  The total excitation energy shift in Joules, $\\Delta E_{\\text{exc, J}}$, is the sum $\\Delta E^{(1)} + \\Delta E^{(2)}$.\n\n5.  This shift is converted from Joules to electronvolts (eV) by dividing by the elementary charge $e$:\n    $$\n    \\Delta E_{\\text{exc, eV}} = \\frac{\\Delta E_{\\text{exc, J}}}{e}\n    $$\n\n6.  Finally, the total excitation energy in the presence of the charge, $E_{\\text{exc}}$, is computed by adding the shift to the gas-phase value:\n    $$\n    E_{\\text{exc}} = E_{\\text{gas}} + \\Delta E_{\\text{exc, eV}}\n    $$\nThe final result for each case is rounded to six decimal places, as required. This procedure is systematically applied to all specified test cases.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the solvent-shifted excitation energy of acetone due to an arginine cation.\n    \"\"\"\n    # Physical constants in SI units\n    EPSILON_0 = 8.8541878128e-12  # F/m (vacuum permittivity)\n    E_CHARGE = 1.602176634e-19    # C (elementary charge)\n    \n    # Unit conversions\n    DEBYE_TO_CM = 3.33564e-30      # C*m per Debye\n    ANGSTROM_TO_M = 1.0e-10        # m per Angstrom\n    JOULE_TO_EV = 1 / E_CHARGE     # eV per Joule\n\n    # Acetone quantum system parameters\n    # Difference dipole moment (S1 - S0)\n    DELTA_MU_MAG_D = 1.20  # Debye\n    delta_mu_mag_si = DELTA_MU_MAG_D * DEBYE_TO_CM  # C*m\n    # The vector is aligned along +x\n    delta_mu_vec_si = np.array([delta_mu_mag_si, 0.0, 0.0])\n\n    # Isotropic difference polarizability (S1 - S0)\n    DELTA_ALPHA_A3 = 3.00  # Angstrom^3\n    # Conversion factor from Angstrom^3 to SI polarizability (C*m^2/V)\n    alpha_si_per_a3 = 4 * np.pi * EPSILON_0 * 1e-30\n    delta_alpha_iso_si = DELTA_ALPHA_A3 * alpha_si_per_a3 # C*m^2/V\n\n    # Baseline gas-phase excitation energy\n    E_GAS_EV = 4.40  # eV\n\n    # Arginine MM environment parameter\n    q_cation = E_CHARGE  # C\n\n    test_cases = [\n        # (R_vector in Angstrom, relative_permittivity)\n        (np.array([3.0, 0.0, 0.0]), 2.0),\n        (np.array([-3.0, 0.0, 0.0]), 2.0),\n        (np.array([5.0, 0.0, 0.0]), 2.0),\n        (np.array([0.0, 3.0, 0.0]), 2.0),\n        (np.array([100.0, 0.0, 0.0]), 80.0),\n    ]\n\n    results = []\n    for R_vec_A, eps_r in test_cases:\n        # Convert position vector to SI units (meters)\n        R_vec_si = R_vec_A * ANGSTROM_TO_M\n        R_mag_si = np.linalg.norm(R_vec_si)\n\n        # 1. Calculate the electric field E at the origin (in V/m)\n        # E = -(1 / (4*pi*eps0*eps_r)) * (q * R_vec / R_mag^3)\n        coulomb_const = 1 / (4 * np.pi * EPSILON_0)\n        # CORRECTED: Added a negative sign to fix the vector direction.\n        E_vec_si = -(coulomb_const / eps_r) * (q_cation * R_vec_si) / (R_mag_si**3)\n        E_mag_sq_si = np.dot(E_vec_si, E_vec_si)\n\n        # 2. Calculate first-order energy shift (permanent dipole interaction) in Joules\n        delta_E1_J = -np.dot(delta_mu_vec_si, E_vec_si)\n\n        # 3. Calculate second-order energy shift (induced dipole interaction) in Joules\n        delta_E2_J = -0.5 * delta_alpha_iso_si * E_mag_sq_si\n\n        # 4. Total excitation energy shift in Joules\n        delta_E_exc_J = delta_E1_J + delta_E2_J\n\n        # 5. Convert energy shift to electronvolts\n        delta_E_exc_eV = delta_E_exc_J * JOULE_TO_EV\n        \n        # 6. Calculate the final excitation energy\n        E_exc_eV = E_GAS_EV + delta_E_exc_eV\n        \n        # 7. Round and store the result\n        results.append(round(E_exc_eV, 6))\n\n    # Format the final output as a comma-separated list in brackets\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "One of the most powerful applications of QM/MM methods is the ability to dissect complex interactions within large biomolecular systems like enzymes. This final practice introduces you to a common analytical technique where the electrostatic contributions of specific MM residues are \"muted,\" or turned off, to quantify their individual impact on the QM region. By implementing this form of computational mutagenesis, you will learn how electrostatic embedding is used as a precise tool to pinpoint key residues responsible for an enzyme's function, moving from simple calculation to scientific inquiry .",
            "id": "2455018",
            "problem": "You are to implement a program that quantifies the effect of selectively muting Molecular Mechanics (MM) residues on the electrostatic embedding energy in a Quantum Mechanics/Molecular Mechanics (QM/MM) setup. In electrostatic embedding, the quantum region is influenced by an external electrostatic potential generated by point charges representing the MM environment. Here, you will model the Quantum Mechanics (QM) region as fixed point charges and the Molecular Mechanics (MM) environment as a set of residue-grouped point charges. Muting a residue means setting all of its MM point charges to zero.\n\nStart from the following foundational principles and definitions without invoking any unproven shortcuts:\n- Coulomb’s law: the electric field and potential of a point charge arise from the inverse-square dependence on distance and the proportionality to the charge magnitude.\n- The electrostatic potential energy of a charge distribution interacting with an external potential, and the superposition principle for point charges.\n- The Coulomb constant defined by $k_{e} = \\dfrac{1}{4\\pi \\varepsilon_{0}}$, where $\\varepsilon_{0}$ is the vacuum permittivity.\n\nYour task is to:\n- Derive, from first principles, a computable expression for the electrostatic interaction energy between the QM point charges and the MM point charges in vacuum.\n- Implement this expression to compute a baseline energy with all MM residues present and a mutated energy when specific residues are muted.\n- Report the energy change $\\Delta E = E_{\\text{muted}} - E_{\\text{full}}$ for each provided test case.\n\nUnits and constants:\n- Distances are given in nanometers, and charges are given in units of the elementary charge.\n- You must express final energies in kilojoules per mole, rounded to six decimal places.\n- Use the elementary charge $e = 1.602176634\\times 10^{-19}\\ \\text{C}$, vacuum permittivity $\\varepsilon_{0} = 8.8541878128\\times 10^{-12}\\ \\text{C}^{2}\\ \\text{N}^{-1}\\ \\text{m}^{-2}$, Avogadro’s number $N_{\\text{A}} = 6.02214076\\times 10^{23}\\ \\text{mol}^{-1}$, and the definition $k_{e} = \\dfrac{1}{4\\pi \\varepsilon_{0}}$. Distances in nanometers must be converted consistently to meters in your derivation before converting the final result to kilojoules per mole.\n\nSystem specification:\n- QM region charges (each as $(q, (x,y,z))$ with $q$ in units of $e$ and $(x,y,z)$ in nanometers):\n    - $q_{1} = +0.70$ at $(0.000, 0.000, 0.000)$\n    - $q_{2} = -0.80$ at $(0.120, 0.000, 0.000)$\n    - $q_{3} = +0.10$ at $(-0.100, 0.100, 0.000)$\n- MM residues, each a list of point charges $(Q, (x,y,z))$ with $Q$ in units of $e$ and $(x,y,z)$ in nanometers:\n    - $\\text{ASP25}$:\n        - $Q = -0.80$ at $(0.500, 0.000, 0.000)$\n        - $Q = -0.80$ at $(0.520, 0.080, 0.000)$\n        - $Q = +0.60$ at $(0.480, -0.050, 0.000)$\n    - $\\text{LYS72}$:\n        - $Q = -0.30$ at $(0.000, 0.600, 0.100)$\n        - $Q = +0.4333333333$ at $(0.040, 0.650, 0.120)$\n        - $Q = +0.4333333333$ at $(-0.040, 0.650, 0.080)$\n        - $Q = +0.4333333333$ at $(0.000, 0.550, 0.060)$\n    - $\\text{LEU100}$:\n        - $Q = +0.10$ at $(0.900, 0.900, 0.900)$\n        - $Q = -0.10$ at $(0.950, 0.920, 0.880)$\n    - $\\text{WAT301}$:\n        - $Q = -0.834$ at $(0.300, 0.200, 0.500)$\n        - $Q = +0.417$ at $(0.240, 0.220, 0.540)$\n        - $Q = +0.417$ at $(0.340, 0.150, 0.460)$\n\nDefinition of muting:\n- For any specified set of residues to mute, set all $Q$ values in those residues to $0$ and recompute the QM–MM electrostatic interaction energy in vacuum with the same geometry.\n\nRequired outputs and test suite:\n- For each of the following test cases, compute $\\Delta E = E_{\\text{muted}} - E_{\\text{full}}$ in kilojoules per mole, rounded to six decimal places:\n    1. Mute $\\{\\text{ASP25}\\}$.\n    2. Mute $\\{\\text{LYS72}, \\text{WAT301}\\}$.\n    3. Mute $\\{\\}$ (no residues muted).\n    4. Mute $\\{\\text{ASP25}, \\text{LYS72}, \\text{LEU100}, \\text{WAT301}\\}$.\n    5. Mute $\\{\\text{LEU100}\\}$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $[\\Delta E_{1},\\Delta E_{2},\\Delta E_{3},\\Delta E_{4},\\Delta E_{5}]$), with each value rounded to six decimal places and expressed in kilojoules per mole.",
            "solution": "The problem is to quantify the change in electrostatic interaction energy between a Quantum Mechanics (QM) region and a Molecular Mechanics (MM) region when specific MM residues are \"muted,\" meaning their atomic partial charges are set to zero. This requires deriving a computable expression for the QM/MM interaction energy from first principles.\n\nThe derivation begins with Coulomb's law, which states that a single point charge $Q_j$ located at position $\\vec{R}_j$ generates an electrostatic potential $V_j$ at a position $\\vec{r}_i$ given by:\n$$ V_j(\\vec{r}_i) = k_e \\frac{Q_j}{|\\vec{r}_i - \\vec{R}_j|} $$\nHere, $k_e = \\frac{1}{4\\pi\\varepsilon_0}$ is the Coulomb constant, where $\\varepsilon_0$ is the vacuum permittivity. The MM environment is modeled as a collection of such point charges. According to the superposition principle, the total electrostatic potential $V_{\\text{MM}}$ at position $\\vec{r}_i$ due to all MM charges is the sum of their individual potentials:\n$$ V_{\\text{MM}}(\\vec{r}_i) = \\sum_{j \\in \\text{MM}} V_j(\\vec{r}_i) = k_e \\sum_{j \\in \\text{MM}} \\frac{Q_j}{|\\vec{r}_i - \\vec{R}_j|} $$\nThe QM region is also modeled as a set of point charges $\\{q_i\\}$ at fixed positions $\\{\\vec{r}_i\\}$. The electrostatic potential energy, $U_i$, of a single QM charge $q_i$ in the external potential created by the MM environment is $U_i = q_i V_{\\text{MM}}(\\vec{r}_i)$. The total electrostatic interaction energy between the QM part and the MM part, $E_{\\text{QM/MM}}$, is the sum of the potential energies of all QM charges:\n$$ E_{\\text{QM/MM}} = \\sum_{i \\in \\text{QM}} U_i = \\sum_{i \\in \\text{QM}} q_i V_{\\text{MM}}(\\vec{r}_i) $$\nSubstituting the expression for $V_{\\text{MM}}$, we arrive at the full expression for the interaction energy, a double summation over all QM charges $i$ and all MM charges $j$:\n$$ E_{\\text{QM/MM}} = k_e \\sum_{i \\in \\text{QM}} \\sum_{j \\in \\text{MM}} \\frac{q_i Q_j}{|\\vec{r}_i - \\vec{R}_j|} $$\nThe problem requires this energy to be expressed in kilojoules per mole ($\\text{kJ/mol}$). The given input units are elementary charges ($e$) for $q_i$ and $Q_j$, and nanometers ($\\text{nm}$) for distances. Let $q'_i$ and $Q'_j$ be the numerical values of the charges in units of $e$, and $d_{ij}$ be the distance $|\\vec{r}_i - \\vec{R}_j|$ in units of $\\text{nm}$. The energy in SI units (Joules) is:\n$$ E_{\\text{QM/MM}} [\\text{J}] = \\frac{1}{4\\pi\\varepsilon_0} \\sum_{i,j} \\frac{(q'_i e)(Q'_j e)}{d_{ij} \\times 10^{-9}} $$\nTo convert this to $\\text{kJ/mol}$, we multiply by Avogadro's number $N_A$ and divide by $1000$:\n$$ E_{\\text{QM/MM}} [\\text{kJ/mol}] = \\left( \\frac{e^2 N_A}{4\\pi\\varepsilon_0 \\times 10^{-9} \\times 1000} \\right) \\sum_{i,j} \\frac{q'_i Q'_j}{d_{ij}} $$\nThe term in parentheses is a conversion factor, $C_{\\text{factor}}$. Using the provided constants $e = 1.602176634 \\times 10^{-19}\\ \\text{C}$, $\\varepsilon_0 = 8.8541878128 \\times 10^{-12}\\ \\text{C}^2\\text{N}^{-1}\\text{m}^{-2}$, and $N_A = 6.02214076 \\times 10^{23}\\ \\text{mol}^{-1}$, the value is calculated as:\n$$ C_{\\text{factor}} \\approx 1389.35458\\ \\frac{\\text{kJ}\\cdot\\text{nm}}{\\text{mol}\\cdot e^2} $$\nThe final computable expression is:\n$$ E_{\\text{QM/MM}} [\\text{kJ/mol}] = C_{\\text{factor}} \\sum_{i \\in \\text{QM}} \\sum_{j \\in \\text{MM}} \\frac{q'_i Q'_j}{d_{ij}[\\text{nm}]} $$\nWe are asked to find the energy change $\\Delta E = E_{\\text{muted}} - E_{\\text{full}}$. The total interaction energy $E_{\\text{full}}$ can be expressed as a sum over the contributions from each MM residue $k$: $E_{\\text{full}} = \\sum_k E_{\\text{QM/res}_k}$. When a set of residues $M$ is muted, their charges $Q_j$ are set to $0$, so their contribution to the total energy vanishes. The energy of the muted system is $E_{\\text{muted}} = \\sum_{k \\notin M} E_{\\text{QM/res}_k}$. Therefore, the energy change is:\n$$ \\Delta E = E_{\\text{muted}} - E_{\\text{full}} = \\sum_{k \\notin M} E_{\\text{QM/res}_k} - \\sum_k E_{\\text{QM/res}_k} = -\\sum_{k \\in M} E_{\\text{QM/res}_k} $$\nThis result provides a significant computational simplification: the change in energy is simply the negative of the interaction energy between the QM region and the specific residues that were muted. The algorithm is thus:\n$1$. For each MM residue, calculate its total interaction energy with the entire QM region, $E_{\\text{QM/res}_k}$.\n$2$. Store these pre-calculated residue-based energies.\n$3$. For each test case, identify the set of residues to be muted, $M$.\n$4$. Compute $\\Delta E$ by summing the pre-calculated energies for the residues in $M$ and taking the negative of the sum.\n$5$. Round the final results to six decimal places as required.\nThis approach avoids recomputing the full interaction sum for each test case, leading to an efficient and direct solution.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the QM/MM electrostatic embedding problem by calculating the energy change\n    upon muting specific MM residues.\n    \"\"\"\n    # Define physical constants as per the problem statement.\n    # Elementary charge in Coulombs.\n    E_CHARGE = 1.602176634e-19  # C\n    # Vacuum permittivity in Farads per meter (C^2 N^-1 m^-2).\n    VACUUM_PERMITTIVITY = 8.8541878128e-12\n    # Avogadro's number in mol^-1.\n    AVOGADRO = 6.02214076e+23\n\n    # Derive the conversion factor to convert from dimensionless energy sum (e^2/nm) to kJ/mol.\n    # The formula is C = (k_e * e^2 * N_A) / (1 J -> kJ). k_e has 1/nm in it after unit conversion.\n    # k_e in standard units is 1/(4*pi*eps0).\n    # Energy [J] = k_e_si * (q1_e*e)*(q2_e*e) / (d_nm*1e-9)\n    # Energy [kJ/mol] = Energy[J] * N_A / 1000\n    # = (1/(4*pi*eps0)) * e^2 * N_A / (1e-9 * 1000) * (q1_e*q2_e/d_nm)\n    # This is the conversion factor for the sum part.\n    CONVERSION_FACTOR = (E_CHARGE**2 * AVOGADRO) / (4 * np.pi * VACUUM_PERMITTIVITY * 1e-9 * 1000)\n    # The resulting factor is approximately 138935.458 kJ·nm / (mol·e^2).\n    # The solution derivation had a typo in the factor value. The formula was correct.\n\n    # Define the QM region as a list of tuples: (charge in elementary charge units, position in nm).\n    qm_charges = [\n        (0.70, np.array([0.000, 0.000, 0.000])),\n        (-0.80, np.array([0.120, 0.000, 0.000])),\n        (0.10, np.array([-0.100, 0.100, 0.000])),\n    ]\n\n    # Define the MM residues as a dictionary mapping residue names to a list of their atoms.\n    # Each atom is a tuple: (charge in elementary charge units, position in nm).\n    mm_residues = {\n        \"ASP25\": [\n            (-0.80, np.array([0.500, 0.000, 0.000])),\n            (-0.80, np.array([0.520, 0.080, 0.000])),\n            (0.60, np.array([0.480, -0.050, 0.000])),\n        ],\n        \"LYS72\": [\n            (-0.30, np.array([0.000, 0.600, 0.100])),\n            (0.4333333333, np.array([0.040, 0.650, 0.120])),\n            (0.4333333333, np.array([-0.040, 0.650, 0.080])),\n            (0.4333333333, np.array([0.000, 0.550, 0.060])),\n        ],\n        \"LEU100\": [\n            (0.10, np.array([0.900, 0.900, 0.900])),\n            (-0.10, np.array([0.950, 0.920, 0.880])),\n        ],\n        \"WAT301\": [\n            (-0.834, np.array([0.300, 0.200, 0.500])),\n            (0.417, np.array([0.240, 0.220, 0.540])),\n            (0.417, np.array([0.340, 0.150, 0.460])),\n        ],\n    }\n\n    def calculate_residue_interaction(res_atoms):\n        \"\"\"\n        Calculates the interaction energy between the entire QM region and a single MM residue.\n        Returns the energy in kJ/mol.\n        \"\"\"\n        energy_sum = 0.0\n        for q_val, q_pos in qm_charges:\n            for Q_val, Q_pos in res_atoms:\n                distance = np.linalg.norm(q_pos - Q_pos)\n                if distance == 0:\n                    # Problem setup guarantees no overlapping atoms, but this is good practice.\n                    raise ValueError(\"QM and MM atoms cannot occupy the same position.\")\n                energy_sum += (q_val * Q_val) / distance\n        return CONVERSION_FACTOR * energy_sum\n\n    # Pre-calculate the interaction energy of each MM residue with the QM region.\n    residue_interaction_energies = {\n        res_name: calculate_residue_interaction(res_atoms)\n        for res_name, res_atoms in mm_residues.items()\n    }\n\n    # Define the test cases as sets of residue names to be muted.\n    test_cases = [\n        {\"ASP25\"},\n        {\"LYS72\", \"WAT301\"},\n        set(),  # Case 3: No residues are muted.\n        {\"ASP25\", \"LYS72\", \"LEU100\", \"WAT301\"},\n        {\"LEU100\"},\n    ]\n\n    results = []\n    # Process each test case.\n    for mute_set in test_cases:\n        # The energy change, Delta E, is the negative of the sum of the interaction\n        # energies of the muted residues.\n        delta_e = -sum(residue_interaction_energies.get(res_name, 0.0) for res_name in mute_set)\n        \n        # Format the result to six decimal places for the final output.\n        results.append(f\"{delta_e:.6f}\")\n\n    # Print the final results in the specified single-line format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}