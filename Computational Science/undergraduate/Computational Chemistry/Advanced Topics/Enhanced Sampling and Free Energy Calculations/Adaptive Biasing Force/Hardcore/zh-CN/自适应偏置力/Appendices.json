{
    "hands_on_practices": [
        {
            "introduction": "自适应偏置力（ABF）方法的核心在于通过对平均力进行积分来重建自由能形貌。因此，最终势能面（PMF）的准确性直接取决于所测量力的准确性。这个思想实验  旨在探讨当力计算中存在系统性偏差时，会对计算出的自由能形貌产生何种影响。通过解决这个问题，你将深入理解力的误差与最终自由能垒和能量差之间的定量关系，这对于诊断模拟中的问题和认识精确力场的重要性至关重要。",
            "id": "2448553",
            "problem": "在自适应偏置力（ABF）分子模拟中，通过累积与所选反应坐标 $\\xi$ 共轭的平均广义力，并沿 $\\xi$ 进行积分，来估计平均力势（PMF）。考虑一个对采样行为良好的系统进行的ABF计算，目标是得到其PMF $A(\\xi)$。由于一个软件错误，在所有构型下，沿 $\\xi$ 的瞬时广义力被系统性地低估了 $10\\%$，并且这个有缺陷的力同时被用于累积平均力和在模拟过程中施加偏置。假设采样时间非常长，以至于统计噪声可以忽略不计，并且计算的所有其他方面都是正确的。\n\n哪个陈述最能描述这 $10\\%$ 的低估对计算出的PMF $\\widehat{A}(\\xi)$ 相对于真实PMF $A(\\xi)$ 的影响？\n\nA. $\\widehat{A}(\\xi)$ 与 $A(\\xi)$ 仅相差一个加性常数；所有的自由能垒和自由能差都保持不变。\n\nB. $\\widehat{A}(\\xi)$ 朝其参考水平被均匀地缩放了 $0.9$ 倍：对于任意两个值 $\\xi_1$ 和 $\\xi_2$，自由能差 $\\widehat{A}(\\xi_2)-\\widehat{A}(\\xi_1)$ 等于 $0.9\\,[A(\\xi_2)-A(\\xi_1)]$；能垒高度被低估了 $10\\%$，而 $\\xi$ 坐标上的极小值和极大值位置保持不变。\n\nC. 相对于 $A(\\xi)$，$\\widehat{A}(\\xi)$ 的所有能垒高度和自由能差都被高估了 $10\\%$。\n\nD. $\\widehat{A}(\\xi)$ 不受影响，因为ABF偏置精确地补偿了力估计量中的任何系统性误差。\n\nE. $\\widehat{A}(\\xi)$ 获得了一个额外的线性倾斜，其恒定斜率等于沿 $\\xi$ 的平均真实力的 $10\\%$，而与 $A(\\xi)$ 的具体形状无关。",
            "solution": "首先必须验证问题陈述的科学性和逻辑完整性。\n\n**步骤1：提取已知条件**\n-   方法：自适应偏置力（ABF）分子模拟。\n-   目标量：沿反应坐标 $\\xi$ 的平均力势（PMF），$A(\\xi)$。\n-   真实关系：PMF的导数是平均广义力的负值，$\\frac{dA(\\xi)}{d\\xi} = -\\langle F(\\xi) \\rangle_\\xi$。\n-   系统性误差：瞬时广义力 $F$ 被系统性地低估了 $10\\%$。测得的力是 $\\widehat{F} = (1 - 0.1)F = 0.9F$。\n-   有缺陷力的用途：有缺陷的力 $\\widehat{F}$ 被用于（1）累积平均力估计值和（2）在模拟过程中施加偏置力。\n-   计算出的PMF：计算出的PMF，记作 $\\widehat{A}(\\xi)$，是通过对累积的有缺陷力的平均值进行积分得到的。\n-   假设：模拟时间非常长，使得统计噪声可以忽略不计。采样“行为良好”。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题在科学上基于统计力学和增强抽样方法的原理。力计算中存在系统性误差的概念是理论分析中一个合理的情景。该问题是适定的，提供了足够的信息来推断误差的后果。问题的核心在于对错误力的双重使用，这是一个关键且明确定义的条件。“非常长的采样”这一假设使我们能够分析收敛后的系统性误差，而忽略随机涨落。“行为良好的采样”意味着尽管偏置不完美，系统仍能探索 $\\xi$ 的整个相关范围，从而使条件平均值得以收敛。这是一个标准的理想化情况。因此，问题陈述是有效的。\n\n**步骤3：求解推导**\n\n真实的平均力势 $A(\\xi)$ 由其与真实平均力 $\\langle F \\rangle_\\xi$ 的关系定义，后者是在给定反应坐标 $\\xi$ 值下瞬时力 $F$ 的条件系综平均：\n$$ \\frac{dA(\\xi)}{d\\xi} = -\\langle F \\rangle_\\xi $$\n\n在所描述的情景中，每一步测量的力都是一个有缺陷的力 $\\widehat{F}$，由下式给出：\n$$ \\widehat{F} = 0.9 F $$\n\nABF算法通过将这些测得的瞬时力累积到沿 $\\xi$ 的各个区间（bin）中来估计平均力。在充分采样的情况下，这个移动平均 $\\overline{\\widehat{F}}(\\xi)$ 会收敛到测得的力的真实条件平均值 $\\langle \\widehat{F} \\rangle_\\xi$。像ABF和伞形抽样这类方法的一个基本原理是，一个仅为 $\\xi$ 函数的偏置势不会改变在固定 $\\xi$ 处可观测量（observables）的条件平均值。该平均是针对所有其他自由度进行的，而这些自由度不受此类偏置的直接影响。因此，收敛后的平均力估计值为：\n$$ \\overline{\\widehat{F}}(\\xi) = \\langle \\widehat{F} \\rangle_\\xi = \\langle 0.9 F \\rangle_\\xi = 0.9 \\langle F \\rangle_\\xi $$\n\n计算出的PMF $\\widehat{A}(\\xi)$ 是通过对这个累积平均力的负值进行积分得到的：\n$$ \\frac{d\\widehat{A}(\\xi)}{d\\xi} = -\\overline{\\widehat{F}}(\\xi) = -0.9 \\langle F \\rangle_\\xi $$\n\n通过代入真实PMF导数的定义 $-\\langle F \\rangle_\\xi = \\frac{dA(\\xi)}{d\\xi}$，我们得到计算出的PMF和真实PMF导数之间的关系：\n$$ \\frac{d\\widehat{A}(\\xi)}{d\\xi} = 0.9 \\frac{dA(\\xi)}{d\\xi} $$\n\n为了理解这对自由能差的影响，我们将此方程从参考点 $\\xi_1$ 积分到另一点 $\\xi_2$：\n$$ \\int_{\\xi_1}^{\\xi_2} \\frac{d\\widehat{A}(\\zeta)}{d\\zeta} d\\zeta = \\int_{\\xi_1}^{\\xi_2} 0.9 \\frac{dA(\\zeta)}{d\\zeta} d\\zeta $$\n$$ \\widehat{A}(\\xi_2) - \\widehat{A}(\\xi_1) = 0.9 \\left( A(\\xi_2) - A(\\xi_1) \\right) $$\n\n这个结果表明，从有缺陷的模拟中计算出的任何自由能差都恰好是真实自由能差的 $90\\%$。因此，作为最大值和最小值之差的自由能垒高度将被低估 $10\\%$。\n\n接下来，我们确定PMF剖面上的驻点（极小值和极大值）的位置。这些点出现在PMF梯度为零的地方。\n-   对于真实PMF $A(\\xi)$，驻点位于 $\\frac{dA(\\xi)}{d\\xi} = 0$ 的 $\\xi$ 处。\n-   对于计算出的PMF $\\widehat{A}(\\xi)$，驻点位于 $\\frac{d\\widehat{A}(\\xi)}{d\\xi} = 0$ 的 $\\xi$ 处。\n\n由于 $\\frac{d\\widehat{A}(\\xi)}{d\\xi} = 0.9 \\frac{dA(\\xi)}{d\\xi}$，当且仅当 $\\frac{dA(\\xi)}{d\\xi} = 0$ 时（因为 $0.9 \\neq 0$），$\\frac{d\\widehat{A}(\\xi)}{d\\xi} = 0$ 的条件才成立。因此，$\\widehat{A}(\\xi)$ 的极小值和极大值的位置与 $A(\\xi)$ 的位置相同。\n\n总而言之，力被系统性地低估 $10\\%$ 导致计算出的PMF剖面 $\\widehat{A}(\\xi)$ 成为真实剖面 $A(\\xi)$ 的一个“扁平化”版本，其中所有自由能差都按比例缩小了 $0.9$ 倍，但特征的位置保持不变。\n\n**逐项分析**\n\nA. $\\widehat{A}(\\xi)$ 与 $A(\\xi)$ 仅相差一个加性常数；所有的自由能垒和自由能差都保持不变。\n该陈述意味着 $\\widehat{A}(\\xi_2) - \\widehat{A}(\\xi_1) = A(\\xi_2) - A(\\xi_1)$。我们的推导表明自由能差被乘以了因子 $0.9$。因此，该选项**不正确**。\n\nB. $\\widehat{A}(\\xi)$ 朝其参考水平被均匀地缩放了 $0.9$ 倍：对于任意两个值 $\\xi_1$ 和 $\\xi_2$，自由能差 $\\widehat{A}(\\xi_2)-\\widehat{A}(\\xi_1)$ 等于 $0.9\\,[A(\\xi_2)-A(\\xi_1)]$；能垒高度被低估了 $10\\%$，而 $\\xi$ 坐标上的极小值和极大值位置保持不变。\n这个陈述完整而准确地描述了我们推导出的结果。关系式 $\\widehat{A}(\\xi_2)-\\widehat{A}(\\xi_1) = 0.9\\,[A(\\xi_2)-A(\\xi_1)]$ 正是我们所推导的。这直接意味着能垒高度被低估了 $10\\%$。我们还证明了极小值和极大值的位置没有改变。因此，该选项**正确**。\n\nC. 相对于 $A(\\xi)$，$\\widehat{A}(\\xi)$ 的所有能垒高度和自由能差都被高估了 $10\\%$。\n这将意味着缩放因子是 $1.1$。我们的推导表明因子是 $0.9$。因此，该选项**不正确**。\n\nD. $\\widehat{A}(\\xi)$ 不受影响，因为ABF偏置精确地补偿了力估计量中的任何系统性误差。\n补偿并不精确。施加的偏置是 $F_{bias}(\\xi) = -\\overline{\\widehat{F}}(\\xi) = -0.9 \\langle F \\rangle_\\xi$。系统上的总平均力是 $\\langle F_{total} \\rangle_\\xi = \\langle F \\rangle_\\xi + F_{bias}(\\xi) = \\langle F \\rangle_\\xi - 0.9 \\langle F \\rangle_\\xi = 0.1 \\langle F \\rangle_\\xi$。由于残余平均力不为零，补偿是不完全的。计算出的PMF是基于有缺陷力的积分，因此它会受到影响。因此，该选项**不正确**。\n\nE. $\\widehat{A}(\\xi)$ 获得了一个额外的线性倾斜，其恒定斜率等于沿 $\\xi$ 的平均真实力的 $10\\%$，而与 $A(\\xi)$ 的具体形状无关。\n这表明误差的形式为 $\\frac{d\\widehat{A}}{d\\xi} = \\frac{dA}{d\\xi} + c$。我们的推导表明 $\\frac{d\\widehat{A}}{d\\xi} = 0.9 \\frac{dA}{d\\xi}$，这是一个对斜率的乘法（缩放）误差，而不是加法误差。斜率的误差 $\\frac{d\\widehat{A}}{d\\xi} - \\frac{dA}{d\\xi} = -0.1 \\frac{dA}{d\\xi}$ 不是恒定的，而是依赖于 $\\xi$。因此，该选项**不正确**。",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "在理想情况下，精确的平均力能够导出精确的自由能。然而，在实际模拟中，一个更常见的挑战是采样不足。这个练习  模拟了一种关键的实践陷阱：当模拟时间不足以让系统在能量势垒两侧进行充分的可逆穿越时会发生什么。通过分析这种非收敛情况的后果，你将学会识别PMF结果中存在的非平衡特征（如过高的能垒），这是评估任何增强采样模拟结果可靠性的关键技能。",
            "id": "2448538",
            "problem": "考虑一个由一维集体变量 (CV) $\\xi$ 描述的分子系统，该系统表现出两个由高峰垒隔开的、深的、不等价的自由能极小值。平均力势 (PMF) $A(\\xi)$ 由沿着 $\\xi$ 的可逆功定义，其导数由下式给出\n$$\n\\frac{\\mathrm{d}A(\\xi)}{\\mathrm{d}\\xi} = - \\left\\langle F_{\\xi} \\right\\rangle_{\\xi},\n$$\n其中 $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$ 是在 $\\xi$ 固定时，瞬时广义力沿着 $\\xi$ 投影的条件平衡平均值。在自适应偏置力 (Adaptive Biasing Force, ABF) 方法中，构建一个偏置势 $V_{\\mathrm{ABF}}(\\xi)$，使得 $\\mathrm{d}V_{\\mathrm{ABF}}/\\mathrm{d}\\xi$ 自适应地逼近 $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$，目的是通过对估计的平均力进行数值积分来改善采样并重构 $A(\\xi)$。\n\n假设一个 ABF 模拟在较低的自由能极小值处初始化，并在系统远未完成足够多次跨越势垒的双向跃迁之前就终止了（即，在每个区间达到局部条件平衡以及沿着 $\\xi$ 的可逆性建立之前）。哪个选项最能描述由此得到的估计 PMF $\\hat{A}(\\xi)$ 的定性外观？\n\nA. $\\hat{A}(\\xi)$ 几乎是平坦的，有两个等深的势阱和一个被严重低估的势垒，因为即使样本很少，自适应偏置也会使轮廓变平。\n\nB. 对初始盆地有明显偏好：$\\hat{A}(\\xi)$ 再现了起始极小值附近的局部曲率，但势垒高度被高估，另一个极小值的自由能显得过高；采样不足的区域是嘈杂或不规则的。\n\nC. 在访问过的区间内是精确的 $A(\\xi)$，其他地方没有估计值，因为局部力平均值强制执行精确的梯度，而不管采样方向性如何。\n\nD. 一个对称的双势阱 $\\hat{A}(\\xi)$，尽管极小值不等价，但它与真实的 $A(\\xi)$ 仅相差一个加性常数。\n\nE. 一个基本上随机且与真实势能面不相关的 PMF $\\hat{A}(\\xi)$，因为施加的偏置从一开始就主导了动力学。",
            "solution": "必须首先对问题陈述进行严格验证。\n\n### 第 1 步：提取已知条件\n- 系统由一维集体变量 (CV) $\\xi$ 描述。\n- 平均力势 (PMF) $A(\\xi)$ 有两个由高峰垒隔开的、深的、不等价的极小值。\n- PMF 的导数定义为 $\\frac{\\mathrm{d}A(\\xi)}{\\mathrm{d}\\xi} = - \\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$，其中 $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$ 是在 $\\xi$ 固定时，瞬时广义力沿着 $\\xi$ 投影的条件平衡平均值。\n- 在自适应偏置力 (ABF) 方法中，构建一个偏置势 $V_{\\mathrm{ABF}}(\\xi)$，使其导数 $\\frac{\\mathrm{d}V_{\\mathrm{ABF}}}{\\mathrm{d}\\xi}$ 自适应地逼近 $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$。\n- ABF 的目标是通过对估计的平均力进行数值积分来改善采样并重构 $A(\\xi)$。\n- 模拟条件为：\n    1.  在较低的自由能极小值处初始化。\n    2.  终止发生在“系统远未完成足够多次跨越势垒的双向跃迁”之前。\n    3.  这意味着“每个区间（bin）未达到局部条件平衡”且“沿着 $\\xi$ 的可逆性未建立”。\n- 问题要求描述由此得到的估计 PMF $\\hat{A}(\\xi)$ 的定性外观。\n\n### 第 2 步：使用提取的已知条件进行验证\n问题陈述描述了在计算统计力学中应用增强采样方法（特别是 ABF）的一个标准场景。\n\n- **科学依据：** PMF $A(\\xi)$ 的定义及其与平均力 $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$ 的关系是统计力学的基本原理。对 ABF 方法的描述与其标准表述一致。未收敛模拟的场景是一个常见且实际的问题。\n- **适定性：** 问题定义明确。它指定了系统（两个不等价的极小值）、方法 (ABF)、初始条件（从较低的极小值开始）和终止条件（跨越势垒的采样不足）。问题要求一个定性但物理上确定的结果。基于该方法的原理，存在一个唯一的概念性答案。\n- **客观性：** 语言精确且技术性强，避免了主观性和模糊性。\n\n### 第 3 步：结论与行动\n问题陈述是有效的。它在科学上合理、适定且客观。我将继续推导解决方案。\n\n自适应偏置力方法的核心原理是通过在集体变量 $\\xi$ 上的离散区间内累积瞬时力 $F_{\\xi}$ 的运行平均值，来估计真实的平均力 $\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$。然后，通过对这个估计的平均力的负值进行积分来获得估计的 PMF $\\hat{A}(\\xi)$：\n$$\n\\hat{A}(\\xi) = \\int_{\\xi_0}^{\\xi} \\frac{\\mathrm{d}A(x)}{\\mathrm{d}x} \\, \\mathrm{d}x \\approx - \\int_{\\xi_0}^{\\xi} \\hat{\\left\\langle F_{x} \\right\\rangle}_{x} \\, \\mathrm{d}x + C\n$$\n其中 $\\hat{\\left\\langle F_{x} \\right\\rangle}_{x}$ 是对应于坐标 $x$ 的区间中的估计平均力，$C$ 是一个积分常数。\n\n问题指明了两个关键条件：模拟在一个盆地中启动，并在收敛前终止。在 ABF 中，收敛需要沿着 $\\xi$ 的每个区间满足两个条件：\n1.  **统计收敛**：必须收集足够多的 $F_{\\xi}$ 样本，以使平均值的统计误差较低。\n2.  **正交自由度的平衡**：系统在某个 $\\xi$ 值上受约束时，必须有时间在所有其他自由度上达到平衡。这就是“条件平衡平均”$\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}$ 所表示的含义。这要求系统从所有相邻区域（例如，从左侧和右侧）多次访问该区间，从而建立可逆性。\n\n问题明确指出，模拟在“足够多次跨越势垒的双向跃迁”发生之前就终止了。这直接违反了收敛的第二个条件，特别是在势垒区域。\n\n让我们分析其后果：\n- **在初始盆地中**：系统在此处初始化，并在越过势垒前花费大量时间探索该区域。因此采样是密集的。力估计值 $\\hat{\\left\\langle F_{\\xi} \\right\\rangle}_{\\xi}$ 将在统计上是可靠的，并且系统处于局部平衡状态。因此，积分得到的 $\\hat{A}(\\xi)$ 将能在这个初始自由能阱内精确地再现 PMF $A(\\xi)$ 的真实形状和局部曲率。\n\n- **在势垒上和第二个盆地中**：随着 ABF 偏置将系统从初始极小值推向并越过自由能势垒，采样变得越来越稀疏。关键的失败在于缺乏可逆性。力 $F_{\\xi}$ 的采样几乎完全来自从第一个盆地“上坡”移动的轨迹。系统被主动驱动进入一个高能量区域，没有时间使其正交自由度弛豫到新的约束条件下。这种现象，被称为滞后或系统延迟，会导致系统误差。测得的恢复力通常被高估；它是拖动一个非平衡系统所需的力，该力大于维持一个平衡系统所需的力。因此，在势垒区域，估计的平均力的大小 $|\\hat{\\left\\langle F_{\\xi} \\right\\rangle}_{\\xi}|$ 将系统性地大于真实的平衡值 $|\\left\\langle F_{\\xi} \\right\\rangle_{\\xi}|$。\n\n- **对 $\\hat{A}(\\xi)$ 的影响**：对一个大小被高估的平均力进行积分，会得到一个过于陡峭的重构 PMF。这意味着极小值和过渡态之间的自由能差——即势垒高度——将被**高估**。在这个被高估的势垒之后，随后进入第二个盆地的下降将从一个人为的高自由能值开始。结果，相对于第一个极小值，第二个极小值将显得处于比实际高得多的自由能上。此外，在样本非常少的区域（势垒顶部和第二个盆地），力估计中的高统计不确定性将在重构的 PMF $\\hat{A}(\\xi)$ 中表现为噪声或不规则的锯齿状特征。\n\n### 逐项分析\n\n**A. $\\hat{A}(\\xi)$ 几乎是平坦的，有两个等深的势阱和一个被严重低估的势垒，因为即使样本很少，自适应偏置也会使轮廓变平。**\n**错误。** ABF 方法展平的是*修改后*的自由能面（物理势加偏置势），而不是重构的 PMF $\\hat{A}(\\xi)$。$\\hat{A}(\\xi)$ 是对原始、未展平的 PMF 的估计。没有理由认为势阱会变得等深，尤其是在有偏采样的情况下。低估势垒也与预期的滞后效应相反。\n\n**B. 对初始盆地有明显偏好：$\\hat{A}(\\xi)$ 再现了起始极小值附近的局部曲率，但势垒高度被高估，另一个极小值的自由能显得过高；采样不足的区域是嘈杂或不规则的。**\n**正确。** 该陈述精确地总结了势垒穿越不足的非收敛 ABF 模拟的后果。初始盆地中的良好采样确保了正确的局部曲率。缺乏可逆采样导致力的过高估计（滞后），从而导致势垒被高估。这反过来又使得随后的盆地在能量上显得人为地偏高。在采样稀疏的区域，差的统计数据会导致噪声。\n\n**C. 在访问过的区间内是精确的 $A(\\xi)$，其他地方没有估计值，因为局部力平均值强制执行精确的梯度，而不管采样方向性如何。**\n**错误。** 这在根本上是错误的。局部力平均值只有在局部平衡和充分采样的条件下才会收敛到精确梯度 $-\\frac{\\mathrm{d}A(\\xi)}{\\mathrm{d}\\xi}$。问题明确指出这些条件未被满足。采样的方向性对于避免系统偏差至关重要。\n\n**D. 一个对称的双势阱 $\\hat{A}(\\xi)$，尽管极小值不等价，但它与真实的 $A(\\xi)$ 仅相差一个加性常数。**\n**错误。** 真实的 PMF 是不对称的（“不等价的极小值”）。没有任何物理或算法上的原因，能让一个不对称启动的非收敛模拟产生一个对称的结果。结果将是真实不对称轮廓的一个扭曲版本，而不是一个完全对称的轮廓。\n\n**E. 一个基本上随机且与真实势能面不相关的 PMF $\\hat{A}(\\xi)$，因为施加的偏置从一开始就主导了动力学。**\n**错误。** 结果不是随机的，而是系统性地有偏。在采样良好的初始区域，与真实势能面的相关性很高。偏置不是从一开始就起主导作用；它是从零的初始值自适应地建立起来的。因此，模拟的初始部分探索的是真实的势。最终结果虽然有缺陷，但远非随机。",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "我们已经探讨了模拟过程中可能出现的系统误差和收敛性问题。但如果我们得到的模拟数据大体上是好的，只是在关键区域（如过渡态附近）存在缺失或损坏，我们该如何处理？这个编码练习  将理论转向了实际的数据分析。你将学习如何使用数值方法，特别是自然三次样条插值，来重建一个平滑且物理上合理的完整平均力曲线，并由此计算出最终的PMF。这项练习将锻炼你处理不完美实验数据并从中提取有价值信息的关键计算技能。",
            "id": "2448511",
            "problem": "您将处理一个以纯数学术语表达的一维自适应偏置力（ABF）数据重构任务。考虑一个无量纲的反应坐标 $z \\in [0,1]$，其具有一个未知的真实平均力 $f_{\\star}(z)$。从一个已完成的模拟中，您在均匀网格 $z_i = \\frac{i}{N-1}$（其中 $i \\in \\{0,1,\\dots,N-1\\}$）上获得了分箱的平均力样本 $\\{(z_i,\\bar{F}_i)\\}_{i=0}^{N-1}$。一个指定子区间内的数据已损坏，必须视作缺失处理。假设对于未损坏网格点对应的索引 $i$，样本是精确的：$\\bar{F}_i = f_{\\star}(z_i)$。\n\n您的任务是重构一个二阶连续可微函数 $f:[0,1]\\to\\mathbb{R}$，使其满足以下条件：\n\n- 对于所有未损坏的索引 $i$，$f(z_i) = \\bar{F}_i$。\n- 在所有此类函数中，$f$ 最小化弯曲能\n$$\n\\int_{0}^{1} \\left(f''(z)\\right)^2 \\, dz\n$$\n并满足自然边界条件 $f''(0)=0$ 和 $f''(1)=0$。\n\n将重构的平均力势（PMF）$W(z)$ 定义为\n$$\nW(z) = -\\int_{0}^{z} f(s)\\, ds,\n$$\n其中 $W(0)=0$。令精确的 PMF 为 $W_{\\star}(z) = -\\int_{0}^{z} f_{\\star}(s)\\, ds$，其中 $W_{\\star}(0)=0$。\n\n对于下述每个测试用例，在一个由 $M$ 个等距点 $z^{(k)}=\\frac{k}{M-1}$（$k \\in \\{0,1,\\dots,M-1\\}$）组成的密集网格上，计算 $W$ 和 $W_{\\star}$ 之间的均方根误差（RMSE）：\n$$\n\\varepsilon = \\sqrt{\\frac{1}{M}\\sum_{k=0}^{M-1} \\left( W\\!\\left(z^{(k)}\\right) - W_{\\star}\\!\\left(z^{(k)}\\right) \\right)^2 }.\n$$\n\n所有物理量均为无量纲。使用 $M = 1001$。\n\n测试套件。对于每个用例，都指定了精确力 $f_{\\star}(z)$、样本数 $N$ 以及损坏区间 $\\mathcal{I}$。构建网格 $z_i=\\frac{i}{N-1}$ 并形成精确样本 $\\bar{F}_i=f_{\\star}(z_i)$。将任何属于 $\\mathcal{I}$ 的 $z_i$ 视作已损坏，并在重构中排除这些约束。在所有用例中，端点 $z=0$ 和 $z=1$ 均未损坏。\n\n- 用例1（理想情况）：$f_{\\star}(z) = \\sin\\!\\left(2\\pi z\\right)$，$N=33$，损坏区间 $\\mathcal{I}=[0.45,\\,0.55]$。\n- 用例2（边界一致性）：$f_{\\star}(z) = 3 z - 1$，$N=21$，损坏区间 $\\mathcal{I}=[0.35,\\,0.50]$。\n- 用例3（宽缺失区域）：$f_{\\star}(z) = e^{z}$，$N=15$，损坏区间 $\\mathcal{I}=[0.30,\\,0.70]$。\n\n您的程序应生成单行输出，其中包含用例1-3的三个RMSE值，格式为逗号分隔的列表并用方括号括起，每个值四舍五入到六位小数（例如，“[0.001234,0.000000,0.012345]”）。",
            "solution": "我们从物理定义出发，在自适应偏置力（ABF）分析中，平均力势（PMF）$W(z)$ 满足 $W'(z) = -f_{\\star}(z)$，其中 $f_{\\star}(z)$ 是沿反应坐标 $z$ 的精确平均力。当我们只有离散点上的力样本，并且某个区域的数据已损坏时，我们必须在缺失区域内插值或推断力，同时保持物理上的一致性，即对于宏观集体变量，力应在 $z$ 上足够平滑。要求在所有通过未损坏样本点并满足 $f''(0)=f''(1)=0$ 的函数中最小化弯曲能 $\\int_{0}^{1} \\left(f''(z)\\right)^2 dz$，这将问题形式化为一个适定的变分问题。\n\n原则1：插值函数的变分表征。考虑函数空间 $\\mathcal{H} = \\{ f \\in C^2([0,1]) : f'' \\in L^2([0,1]) \\}$ 以及对所有未损坏的 $i$ 的线性约束 $f(z_i)=\\bar{F}_i$。泛函\n$$\nJ[f] = \\int_{0}^{1} \\left(f''(z)\\right)^2 \\, dz\n$$\n在 $\\mathcal{H}$ 上是严格凸的，并且由插值约束定义的可行集是仿射且非空的（因为存在穿过这些数据点的分段三次函数）。相关约束最小化问题的欧拉-拉格朗日方程表明，最小化子是一个在插值节点处具有连续一阶和二阶导数的分段三次多项式，并且满足 $f''(0)=f''(1)=0$（自然边界条件）。唯一性源于严格凸性。这个最小化子就是穿过未损坏数据点的自然三次样条插值函数。\n\n原则2：PMF的重构。一旦 $f$ 被重构，PMF 就由下式给出\n$$\nW(z) = -\\int_{0}^{z} f(s)\\, ds,\n$$\n其中 $W(0)=0$。这是微积分基本定理和PMF的ABF定义的直接应用。\n\n原则3：误差量化。为量化重构质量，我们在一个密集网格 $\\{ z^{(k)} \\}_{k=0}^{M-1}$ 上计算均方根误差（RMSE），\n$$\n\\varepsilon = \\sqrt{\\frac{1}{M}\\sum_{k=0}^{M-1}\\left( W\\!\\left(z^{(k)}\\right) - W_{\\star}\\!\\left(z^{(k)}\\right) \\right)^2 }.\n$$\n对于每个测试用例，$W_{\\star}(z)$ 都是从精确力 $f_{\\star}(z)$ 解析推导出来的：\n- 用例1：$f_{\\star}(z) = \\sin\\!\\left(2\\pi z\\right)$。则\n$$\nW_{\\star}(z) = -\\int_{0}^{z} \\sin(2\\pi s)\\, ds = -\\left[-\\frac{\\cos(2\\pi s)}{2\\pi}\\right]_{0}^{z} = \\frac{\\cos(2\\pi z) - 1}{2\\pi}.\n$$\n- 用例2：$f_{\\star}(z) = 3 z - 1$。则\n$$\nW_{\\star}(z) = -\\int_{0}^{z} (3 s - 1)\\, ds = -\\left(\\frac{3}{2} z^2 - z\\right) = -\\frac{3}{2} z^2 + z.\n$$\n- 用例3：$f_{\\star}(z) = e^{z}$。则\n$$\nW_{\\star}(z) = -\\int_{0}^{z} e^{s}\\, ds = -\\left(e^{z} - 1\\right) = 1 - e^{z}.\n$$\n\n算法实现。为了计算最小化子，我们采用穿过未损坏节点 $\\{(z_i,\\bar{F}_i)\\}$ 的自然三次样条插值，其合理性由上述变分表征证明。自然三次样条生成一个分段三次函数 $f$，它具有连续的一阶和二阶导数，并满足 $f''(0)=f''(1)=0$。然后对重构的 $f$ 进行积分以获得 $W$。在数值上，可以通过对三次样条的分段多项式表示进行积分来精确构造其原函数，从而能够对任意 $z$ 精确计算 $W(z)$。然后，我们为每个测试用例在包含 $M=1001$ 个点的密集网格上计算RMSE $\\varepsilon$。\n\n测试套件覆盖范围。这三个用例探测了不同的行为：\n- 用例1测试一个具有中等损坏区间的平滑振荡力。\n- 用例2测试线性力；样条插值能精确再现线性函数，因此RMSE预计接近机器精度。\n- 用例3测试一个具有宽缺失区间的快速变化的单调力，以此来考验跨越间隙的外插行为。\n\n最终的程序构建网格，移除 $z_i$ 位于指定损坏区间 $\\mathcal{I}$ 内的点，对剩余的点进行自然三次样条拟合，构造原函数以计算 $W$，在密集网格上评估 $W$ 和 $W_{\\star}$，计算RMSE，并按要求将三个RMSE值四舍五入到六位小数，以逗号分隔的列表形式用方括号括起来打印。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.interpolate import CubicSpline\n\ndef true_force(case_id, z):\n    if case_id == 1:\n        return np.sin(2*np.pi*z)\n    elif case_id == 2:\n        return 3.0*z - 1.0\n    elif case_id == 3:\n        return np.exp(z)\n    else:\n        raise ValueError(\"Invalid case_id\")\n\ndef true_pmf(case_id, z):\n    # W*(z) with W*(0)=0\n    if case_id == 1:\n        return (np.cos(2*np.pi*z) - 1.0) / (2*np.pi)\n    elif case_id == 2:\n        return -1.5*z*z + z\n    elif case_id == 3:\n        return 1.0 - np.exp(z)\n    else:\n        raise ValueError(\"Invalid case_id\")\n\ndef reconstruct_rmse(case_id, N, corrupt_interval, M=1001):\n    # Build nodes and exact samples\n    z_nodes = np.linspace(0.0, 1.0, N)\n    f_exact = true_force(case_id, z_nodes)\n\n    a, b = corrupt_interval\n    # Keep points not in the corrupted interval [a, b]\n    mask = ~((z_nodes >= a) & (z_nodes <= b))\n    # Ensure endpoints are kept (as stated in problem)\n    mask[0] = True\n    mask[-1] = True\n\n    x = z_nodes[mask]\n    y = f_exact[mask]\n\n    # Fit natural cubic spline interpolant through uncorrupted points\n    spline = CubicSpline(x, y, bc_type='natural')\n\n    # Construct antiderivative to get PMF: W(z) = - integral from 0 to z of f(s)ds\n    # which is -(F(z) - F(0)) where F is the antiderivative of f\n    anti = spline.antiderivative()\n    F0 = anti(0.0)\n\n    # Dense grid for RMSE\n    z_dense = np.linspace(0.0, 1.0, M)\n    W_rec = -(anti(z_dense) - F0)\n    W_true = true_pmf(case_id, z_dense)\n\n    rmse = np.sqrt(np.mean((W_rec - W_true)**2))\n    return rmse\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (case_id, N, (a, b))\n        (1, 33, (0.45, 0.55)),  # Case 1\n        (2, 21, (0.35, 0.50)),  # Case 2\n        (3, 15, (0.30, 0.70)),  # Case 3\n    ]\n\n    results = []\n    for case_id, N, interval in test_cases:\n        rmse = reconstruct_rmse(case_id, N, interval, M=1001)\n        results.append(rmse)\n\n    # Round to six decimals and format\n    results_str = \",\".join(f\"{x:.6f}\" for x in results)\n    print(f\"[{results_str}]\")\n\nsolve()\n```"
        }
    ]
}