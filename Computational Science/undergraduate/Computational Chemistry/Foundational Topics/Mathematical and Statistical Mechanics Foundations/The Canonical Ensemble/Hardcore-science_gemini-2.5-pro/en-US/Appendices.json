{
    "hands_on_practices": [
        {
            "introduction": "The journey to mastering the canonical ensemble begins with its most fundamental building block: the two-level system. This simple model provides the perfect context for practicing the core mathematical workflow of statistical mechanics. In this exercise, you will start from the energy levels of individual particles to construct the total partition function $Z$, and then use this central quantity to derive a key macroscopic thermodynamic property, the heat capacity $C_V$. This practice solidifies the concept of the partition function as a gateway to the thermodynamic behavior of a system, including its properties in the important low-temperature limit .",
            "id": "1996096",
            "problem": "Consider a system composed of $N$ distinguishable, non-interacting particles fixed in a lattice. Each particle can exist in one of two non-degenerate energy states: a ground state with energy $E_0 = 0$ and an excited state with energy $E_1 = \\Delta E$, where $\\Delta E  0$. The entire system is in thermal equilibrium with a heat reservoir at a constant temperature $T$.\n\n(a) Find a symbolic expression for the total heat capacity at constant volume, $C_V$, for this system. Your expression should be a function of $N$, $\\Delta E$, $T$, and the Boltzmann constant $k_B$.\n\n(b) Determine the value of the heat capacity $C_V$ in the limit as the temperature approaches absolute zero, i.e., as $T \\rightarrow 0$.\n\nPresent your answers for (a) and (b), in that order, as a row matrix.",
            "solution": "Let the inverse temperature be $\\beta \\equiv \\frac{1}{k_{B} T}$. For one distinguishable, non-interacting, non-degenerate two-level particle with energies $E_{0}=0$ and $E_{1}=\\Delta E$, the single-particle partition function is\n$$\nz = \\sum_{i} \\exp(-\\beta E_{i}) = 1 + \\exp(-\\beta \\Delta E).\n$$\nFor $N$ distinguishable, non-interacting particles, the total partition function factorizes as\n$$\nZ = z^{N} = \\left(1 + \\exp(-\\beta \\Delta E)\\right)^{N}.\n$$\nThe internal energy in the canonical ensemble is\n$$\nU = - \\frac{\\partial}{\\partial \\beta} \\ln Z = -N \\frac{\\partial}{\\partial \\beta} \\ln z.\n$$\nCompute $\\frac{\\partial}{\\partial \\beta} \\ln z$:\n$$\n\\ln z = \\ln\\left(1 + \\exp(-\\beta \\Delta E)\\right), \\quad \\frac{\\partial}{\\partial \\beta} \\ln z = \\frac{-\\Delta E \\exp(-\\beta \\Delta E)}{1 + \\exp(-\\beta \\Delta E)} = -\\frac{\\Delta E}{1 + \\exp(\\beta \\Delta E)}.\n$$\nTherefore,\n$$\nU = -N \\left(-\\frac{\\Delta E}{1 + \\exp(\\beta \\Delta E)}\\right) = \\frac{N \\Delta E}{1 + \\exp(\\beta \\Delta E)}.\n$$\nThe constant-volume heat capacity is $C_{V} = \\left(\\frac{\\partial U}{\\partial T}\\right)_{V}$. Using the chain rule with $\\beta = \\frac{1}{k_{B} T}$ and $\\frac{\\partial \\beta}{\\partial T} = -\\frac{1}{k_{B} T^{2}}$, we first compute\n$$\n\\frac{\\partial U}{\\partial \\beta} = N \\Delta E \\frac{\\partial}{\\partial \\beta}\\left(1 + \\exp(\\beta \\Delta E)\\right)^{-1} = -N \\Delta E^{2} \\frac{\\exp(\\beta \\Delta E)}{\\left(1 + \\exp(\\beta \\Delta E)\\right)^{2}}.\n$$\nHence,\n$$\nC_{V} = \\frac{\\partial U}{\\partial \\beta} \\frac{\\partial \\beta}{\\partial T} = \\left(-N \\Delta E^{2} \\frac{\\exp(\\beta \\Delta E)}{\\left(1 + \\exp(\\beta \\Delta E)\\right)^{2}}\\right)\\left(-\\frac{1}{k_{B} T^{2}}\\right) = N \\frac{\\Delta E^{2}}{k_{B} T^{2}} \\frac{\\exp(\\beta \\Delta E)}{\\left(1 + \\exp(\\beta \\Delta E)\\right)^{2}}.\n$$\nEquivalently, introducing $x \\equiv \\frac{\\Delta E}{k_{B} T}$ gives\n$$\nC_{V} = N k_{B} x^{2} \\frac{\\exp(x)}{\\left(1 + \\exp(x)\\right)^{2}} = N k_{B} \\left(\\frac{\\Delta E}{k_{B} T}\\right)^{2} \\frac{\\exp\\left(\\frac{\\Delta E}{k_{B} T}\\right)}{\\left(1 + \\exp\\left(\\frac{\\Delta E}{k_{B} T}\\right)\\right)^{2}}.\n$$\nFor the low-temperature limit $T \\rightarrow 0$, we have $\\beta \\rightarrow \\infty$ and thus $\\exp(\\beta \\Delta E) \\rightarrow \\infty$. The factor $\\frac{\\exp(\\beta \\Delta E)}{\\left(1 + \\exp(\\beta \\Delta E)\\right)^{2}} \\sim \\exp(-\\beta \\Delta E)$ vanishes exponentially, which dominates any power of $T$ in the prefactor, so\n$$\n\\lim_{T \\rightarrow 0} C_{V} = 0.\n$$\nThis yields the requested expressions for parts (a) and (b).",
            "answer": "$$\\boxed{\\begin{pmatrix}N k_{B} \\left(\\frac{\\Delta E}{k_{B} T}\\right)^{2} \\frac{\\exp\\left(\\frac{\\Delta E}{k_{B} T}\\right)}{\\left(1 + \\exp\\left(\\frac{\\Delta E}{k_{B} T}\\right)\\right)^{2}}  0\\end{pmatrix}}$$"
        },
        {
            "introduction": "While analytical derivations are powerful for simple models, most systems in chemistry are too complex to be solved with pen and paper, necessitating computational approaches. This practice bridges the gap between abstract theory and practical computation by having you implement the principles of the canonical ensemble in code. You will calculate the conformational probabilities for a simplified model of the alanine dipeptide by discretizing its potential energy surface and numerically evaluating the partition function and Boltzmann-weighted populations . This exercise makes the abstract concept of a probability distribution tangible, showing how it directly translates into the relative populations of different molecular shapes observed in simulations and experiments.",
            "id": "2463736",
            "problem": "You are asked to construct a fully specified canonical ensemble model for the conformational equilibrium of alanine dipeptide projected onto the Ramachandran torsions, and to compute canonical basin populations for two basins (alpha and beta) in vacuum versus water-like conditions. You must implement a complete, runnable program that evaluates the discrete canonical (constant number of particles, constant volume, constant temperature) ensemble over torsion angles and reports basin probabilities. All mathematical definitions are provided below; you must use them exactly as stated and express any physical quantities in the specified units.\n\nModel setup. Consider torsion angles $\\phi$ and $\\psi$ defined on the two-dimensional torus $[-180^{\\circ},180^{\\circ}) \\times [-180^{\\circ},180^{\\circ})$. Define the base potential energy surface $V_{\\text{base}}(\\phi,\\psi)$ in kilojoules per mole as\n$$\nV_{\\text{base}}(\\phi,\\psi) = V_a \\left[1 - \\cos\\!\\left(3(\\phi+60^{\\circ})\\right)\\right] + V_b \\left[1 - \\cos\\!\\left(3(\\psi+45^{\\circ})\\right)\\right] + V_c \\left[1 + \\cos\\!\\left(\\phi - \\psi\\right)\\right],\n$$\nwhere all trigonometric arguments are in degrees, and $V_a$, $V_b$, $V_c$ are constants in kilojoules per mole.\n\nModel the solvent effect as a local stabilization of the alpha basin and a local penalty of the beta basin via torus-Gaussian terms. Let the alpha basin center be $(\\phi_\\alpha,\\psi_\\alpha) = (-60^{\\circ},-45^{\\circ})$ and the beta basin center be $(\\phi_\\beta,\\psi_\\beta) = (-135^{\\circ},135^{\\circ})$. Define the squared toroidal distance between $(\\phi,\\psi)$ and $(\\phi_0,\\psi_0)$ as\n$$\nd^2_{\\mathbb{T}^2}((\\phi,\\psi),(\\phi_0,\\psi_0)) = \\Delta(\\phi,\\phi_0)^2 + \\Delta(\\psi,\\psi_0)^2,\n$$\nwith wrapped angular difference $\\Delta(\\theta,\\theta_0)$ in degrees given by\n$$\n\\Delta(\\theta,\\theta_0) = \\operatorname{wrap}_{(-180^{\\circ},180^{\\circ}]}\\!\\left(\\theta - \\theta_0\\right), \\quad \\text{where } \\operatorname{wrap}_{(-180^{\\circ},180^{\\circ}]}\\!(x) = x - 360^{\\circ}\\,\\left\\lfloor \\frac{x + 180^{\\circ}}{360^{\\circ}} \\right\\rfloor.\n$$\nLet $\\sigma$ be a width in degrees, $s_\\alpha$ a stabilization amplitude in kilojoules per mole for alpha, and $s_\\beta$ a penalty amplitude in kilojoules per mole for beta. The solvent contribution is\n$$\nV_{\\text{solv}}(\\phi,\\psi) = - s_\\alpha \\exp\\!\\left(-\\frac{d^2_{\\mathbb{T}^2}((\\phi,\\psi),(\\phi_\\alpha,\\psi_\\alpha))}{2\\sigma^2}\\right) + s_\\beta \\exp\\!\\left(-\\frac{d^2_{\\mathbb{T}^2}((\\phi,\\psi),(\\phi_\\beta,\\psi_\\beta))}{2\\sigma^2}\\right).\n$$\nThe total potential is $V(\\phi,\\psi) = V_{\\text{base}}(\\phi,\\psi) + V_{\\text{solv}}(\\phi,\\psi)$, in kilojoules per mole.\n\nCanonical ensemble. For a given absolute temperature $T$ in kelvin, with Boltzmann constant $k_{\\mathrm{B}} = 0.008314462618\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$, define $\\beta = 1/(k_{\\mathrm{B}} T)$. The canonical weight at $(\\phi,\\psi)$ is $w(\\phi,\\psi) = \\exp(-\\beta V(\\phi,\\psi))$.\n\nDiscretization. Use a uniform grid of angles with spacing $\\Delta = 2^{\\circ}$ in each dimension over $[-180^{\\circ},180^{\\circ})$. The discrete partition function is\n$$\nZ = \\sum_{\\phi}\\sum_{\\psi} \\exp\\!\\left(-\\beta V(\\phi,\\psi)\\right),\n$$\nwhere the sums run over the grid points, and probabilities are defined by normalization with $Z$. Let the alpha basin window be the toroidal rectangle of half-width $w = 30^{\\circ}$ in each angular dimension around $(\\phi_\\alpha,\\psi_\\alpha)$, that is, the set of $(\\phi,\\psi)$ such that $|\\Delta(\\phi,\\phi_\\alpha)| \\le w$ and $|\\Delta(\\psi,\\psi_\\alpha)| \\le w$. Define the beta basin window analogously around $(\\phi_\\beta,\\psi_\\beta)$ with the same half-width $w$. The canonical probabilities to be reported are\n$$\nP_\\alpha = \\frac{1}{Z}\\sum_{(\\phi,\\psi)\\in \\text{alpha window}} \\exp\\!\\left(-\\beta V(\\phi,\\psi)\\right), \\quad\nP_\\beta = \\frac{1}{Z}\\sum_{(\\phi,\\psi)\\in \\text{beta window}} \\exp\\!\\left(-\\beta V(\\phi,\\psi)\\right).\n$$\nReport probabilities as dimensionless decimal numbers.\n\nConstants. Use $V_a = 4\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}$, $V_b = 3\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}$, $V_c = 1\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}$, $\\sigma = 25^{\\circ}$, $w = 30^{\\circ}$, and $\\Delta = 2^{\\circ}$ exactly as given.\n\nTest suite. Your program must evaluate the following four parameter sets, each specified as $(T,\\ s_\\alpha,\\ s_\\beta)$:\n- Case 1 (vacuum, moderate temperature): $(T=\\ 300,\\ s_\\alpha=\\ 0,\\ s_\\beta=\\ 0)$ with $T$ in kelvin and $s_\\alpha,s_\\beta$ in kilojoules per mole.\n- Case 2 (water-like, moderate temperature): $(T=\\ 300,\\ s_\\alpha=\\ 5,\\ s_\\beta=\\ 2)$.\n- Case 3 (water-like, high temperature): $(T=\\ 600,\\ s_\\alpha=\\ 5,\\ s_\\beta=\\ 2)$.\n- Case 4 (vacuum, low temperature): $(T=\\ 100,\\ s_\\alpha=\\ 0,\\ s_\\beta=\\ 0)$.\n\nRequired outputs. For each test case, compute and return a two-element list $[P_\\alpha, P_\\beta]$ with both entries rounded to exactly six decimal places. Aggregate the four case results in the same order into a single list. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is itself a two-element list, for example, \"[[0.123456,0.234567],[...],...]\" with no extra text.\n\nAngle unit requirement. All angles in the model are in degrees. All trigonometric functions should be interpreted with arguments in degrees as defined above.\n\nPhysical units. Energies must be in kilojoules per mole, temperatures in kelvin, and the Boltzmann constant in kilojoules per mole per kelvin. Express the final probabilities as dimensionless decimal numbers rounded to six decimal places.",
            "solution": "We are asked to compute canonical probabilities in the canonical (constant number of particles, constant volume, constant temperature) ensemble for alanine dipeptide torsions under a specified potential energy function, both in vacuum and with a solvent-like perturbation. The canonical ensemble assigns a weight proportional to the Boltzmann factor $\\exp(-\\beta V)$, where $\\beta = 1/(k_{\\mathrm{B}} T)$ and $V$ is the potential energy.\n\nFirst, we formalize the torsion angle domain as a two-dimensional torus $[-180^{\\circ},180^{\\circ}) \\times [-180^{\\circ},180^{\\circ})$ and use a uniform discrete grid of spacing $\\Delta = 2^{\\circ}$ for both $\\phi$ and $\\psi$. This discretization renders the partition function and probabilities as finite sums, ensuring that numerical evaluation is unambiguous and consistent across implementations.\n\nThe base potential is defined by\n$$\nV_{\\text{base}}(\\phi,\\psi) = V_a \\left[1 - \\cos\\!\\left(3(\\phi+60^{\\circ})\\right)\\right] + V_b \\left[1 - \\cos\\!\\left(3(\\psi+45^{\\circ})\\right)\\right] + V_c \\left[1 + \\cos\\!\\left(\\phi - \\psi\\right)\\right],\n$$\nwith $V_a = 4\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}$, $V_b = 3\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}$, and $V_c = 1\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}$. The trigonometric functions take arguments in degrees; numerically, one can convert degrees to radians when calling standard library functions, but mathematically the definitions are fixed.\n\nThe solvent perturbation is modeled by torus-Gaussian terms that stabilize or destabilize specific regions:\n$$\nV_{\\text{solv}}(\\phi,\\psi) = - s_\\alpha \\exp\\!\\left(-\\frac{d^2_{\\mathbb{T}^2}((\\phi,\\psi),(\\phi_\\alpha,\\psi_\\alpha))}{2\\sigma^2}\\right) + s_\\beta \\exp\\!\\left(-\\frac{d^2_{\\mathbb{T}^2}((\\phi,\\psi),(\\phi_\\beta,\\psi_\\beta))}{2\\sigma^2}\\right),\n$$\nwith $(\\phi_\\alpha,\\psi_\\alpha) = (-60^{\\circ},-45^{\\circ})$, $(\\phi_\\beta,\\psi_\\beta) = (-135^{\\circ},135^{\\circ})$, and $\\sigma = 25^{\\circ}$. The toroidal squared distance is\n$$\nd^2_{\\mathbb{T}^2}((\\phi,\\psi),(\\phi_0,\\psi_0)) = \\Delta(\\phi,\\phi_0)^2 + \\Delta(\\psi,\\psi_0)^2,\n$$\nwhere the wrapped difference $\\Delta(\\theta,\\theta_0)$ produces the minimal angular difference on the circle:\n$$\n\\Delta(\\theta,\\theta_0) = \\operatorname{wrap}_{(-180^{\\circ},180^{\\circ}]}\\!\\left(\\theta - \\theta_0\\right), \\quad \\operatorname{wrap}_{(-180^{\\circ},180^{\\circ}]}\\!(x) = x - 360^{\\circ}\\,\\left\\lfloor \\frac{x + 180^{\\circ}}{360^{\\circ}} \\right\\rfloor.\n$$\nThe total potential is $V = V_{\\text{base}} + V_{\\text{solv}}$.\n\nFor a given absolute temperature $T$ and Boltzmann constant $k_{\\mathrm{B}} = 0.008314462618\\ \\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$, we compute $\\beta = 1/(k_{\\mathrm{B}} T)$. The canonical weight at each grid point is $w = \\exp(-\\beta V)$. The discrete partition function is\n$$\nZ = \\sum_{\\phi}\\sum_{\\psi} w(\\phi,\\psi),\n$$\nand any canonical probability over a subset $\\Omega$ of grid points is\n$$\nP(\\Omega) = \\frac{1}{Z}\\sum_{(\\phi,\\psi)\\in \\Omega} w(\\phi,\\psi).\n$$\n\nWe define the alpha window as the toroidal rectangle centered at $(-60^{\\circ},-45^{\\circ})$ with half-width $w = 30^{\\circ}$ in each dimension:\n$$\n\\Omega_\\alpha = \\left\\{(\\phi,\\psi) : |\\Delta(\\phi,-60^{\\circ})| \\le 30^{\\circ},\\ |\\Delta(\\psi,-45^{\\circ})| \\le 30^{\\circ}\\right\\}.\n$$\nThe beta window is defined analogously around $(-135^{\\circ},135^{\\circ})$:\n$$\n\\Omega_\\beta = \\left\\{(\\phi,\\psi) : |\\Delta(\\phi,-135^{\\circ})| \\le 30^{\\circ},\\ |\\Delta(\\psi,135^{\\circ})| \\le 30^{\\circ}\\right\\}.\n$$\nThe desired outputs are $P_\\alpha = P(\\Omega_\\alpha)$ and $P_\\beta = P(\\Omega_\\beta)$.\n\nWe then evaluate these probabilities for the specified test suite:\n- Case 1: $(T=\\ 300,\\ s_\\alpha=\\ 0,\\ s_\\beta=\\ 0)$ represents vacuum at moderate temperature, where only $V_{\\text{base}}$ shapes the distribution.\n- Case 2: $(T=\\ 300,\\ s_\\alpha=\\ 5,\\ s_\\beta=\\ 2)$ represents water-like conditions at moderate temperature, where the alpha region is stabilized and the beta region is penalized relative to vacuum.\n- Case 3: $(T=\\ 600,\\ s_\\alpha=\\ 5,\\ s_\\beta=\\ 2)$ represents higher temperature, which reduces the influence of energy differences and tends to flatten the distribution, decreasing the contrast between basins.\n- Case 4: $(T=\\ 100,\\ s_\\alpha=\\ 0,\\ s_\\beta=\\ 0)$ represents vacuum at low temperature, emphasizing minima of $V_{\\text{base}}$ and sharpening basin populations.\n\nAlgorithmically, one enumerates the grid points, computes $V(\\phi,\\psi)$ and $w(\\phi,\\psi)$, forms $Z$, constructs indicator masks for $\\Omega_\\alpha$ and $\\Omega_\\beta$ via wrapped angular differences, and computes $P_\\alpha$ and $P_\\beta$ by summation and normalization. The results must be rounded to six decimal places and returned for each case in order. Qualitatively, introducing the solvent-like stabilization ($s_\\alpha  0$ and $s_\\beta  0$) increases $P_\\alpha$ and decreases $P_\\beta$ at fixed temperature, while raising $T$ increases entropic mixing and drives both basin probabilities toward values reflecting the relative geometrical sizes of the windows rather than energetic preferences. At low $T$, $P_\\alpha$ and $P_\\beta$ reflect the energetic minima structure of $V_{\\text{base}}$ with sharper contrasts.\n\nThe final program implements these definitions exactly and prints a single line containing a list of four two-element lists, each $[P_\\alpha, P_\\beta]$ rounded to six decimal places, in the order specified by the test suite.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef wrap_deg(x):\n    \"\"\"\n    Wrap angle(s) in degrees to the interval (-180, 180].\n    This returns a value such that boundaries are consistent on the torus.\n    \"\"\"\n    return x - 360.0 * np.floor((x + 180.0) / 360.0)\n\ndef torus_delta(a, b):\n    \"\"\"\n    Minimal wrapped difference between angles a and b (in degrees).\n    Works with numpy arrays or scalars.\n    \"\"\"\n    return np.abs(wrap_deg(a - b))\n\ndef build_potential(phi_deg, psi_deg, Va, Vb, Vc, s_alpha, s_beta, sigma_deg):\n    \"\"\"\n    Construct the total potential V(phi, psi) in kJ/mol on the 2D grid of angles (in degrees).\n    Trigonometric functions interpret arguments in degrees as per the problem statement.\n    \"\"\"\n    # Base torsional terms: convert degree arguments to radians for numpy trig.\n    # Using identities: cos(deg) - cos(np.deg2rad(deg_argument))\n    term_phi = np.cos(np.deg2rad(3.0 * (phi_deg + 60.0)))\n    term_psi = np.cos(np.deg2rad(3.0 * (psi_deg + 45.0)))\n    term_cross = np.cos(np.deg2rad(phi_deg - psi_deg))\n    V_base = Va * (1.0 - term_phi) + Vb * (1.0 - term_psi) + Vc * (1.0 + term_cross)\n\n    # Solvent-like Gaussian stabilization/penalty on the torus\n    phi_alpha, psi_alpha = -60.0, -45.0\n    phi_beta, psi_beta = -135.0, 135.0\n    dphi_alpha = torus_delta(phi_deg, phi_alpha)\n    dpsi_alpha = torus_delta(psi_deg, psi_alpha)\n    d2_alpha = dphi_alpha**2 + dpsi_alpha**2\n\n    dphi_beta = torus_delta(phi_deg, phi_beta)\n    dpsi_beta = torus_delta(psi_deg, psi_beta)\n    d2_beta = dphi_beta**2 + dpsi_beta**2\n\n    # Gaussian terms\n    ga_alpha = np.exp(-d2_alpha / (2.0 * sigma_deg**2))\n    ga_beta = np.exp(-d2_beta / (2.0 * sigma_deg**2))\n    V_solv = -s_alpha * ga_alpha + s_beta * ga_beta\n\n    return V_base + V_solv\n\ndef basin_masks(phi_deg, psi_deg, w_half_deg):\n    \"\"\"\n    Construct boolean masks for alpha and beta rectangular windows on the torus.\n    \"\"\"\n    phi_alpha, psi_alpha = -60.0, -45.0\n    phi_beta, psi_beta = -135.0, 135.0\n    alpha_mask = (torus_delta(phi_deg, phi_alpha) = w_half_deg)  (torus_delta(psi_deg, psi_alpha) = w_half_deg)\n    beta_mask = (torus_delta(phi_deg, phi_beta) = w_half_deg)  (torus_delta(psi_deg, psi_beta) = w_half_deg)\n    return alpha_mask, beta_mask\n\ndef compute_probabilities(T, s_alpha, s_beta):\n    \"\"\"\n    Compute (P_alpha, P_beta) for given temperature T (K) and solvent parameters s_alpha, s_beta (kJ/mol).\n    \"\"\"\n    # Constants\n    kB = 0.008314462618  # kJ/mol/K\n    Va = 4.0  # kJ/mol\n    Vb = 3.0  # kJ/mol\n    Vc = 1.0  # kJ/mol\n    sigma_deg = 25.0  # degrees\n    w_half_deg = 30.0  # degrees\n    delta = 2.0  # degrees grid spacing\n\n    # Grid\n    angles = np.arange(-180.0, 180.0, delta)  # [-180, 180) degrees\n    phi_grid, psi_grid = np.meshgrid(angles, angles, indexing='ij')\n\n    # Potential and Boltzmann weights\n    V = build_potential(phi_grid, psi_grid, Va, Vb, Vc, s_alpha, s_beta, sigma_deg)\n    beta = 1.0 / (kB * T)\n    # For numerical stability, shift by min(V) before exponentiation; cancels in normalization\n    V_shift = V - np.min(V)\n    weights = np.exp(-beta * V_shift)\n\n    Z = np.sum(weights)\n\n    # Basin masks\n    alpha_mask, beta_mask = basin_masks(phi_grid, psi_grid, w_half_deg)\n\n    P_alpha = float(np.sum(weights[alpha_mask]) / Z)\n    P_beta = float(np.sum(weights[beta_mask]) / Z)\n    return P_alpha, P_beta\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (T in K, s_alpha in kJ/mol, s_beta in kJ/mol)\n    test_cases = [\n        (300.0, 0.0, 0.0),  # Case 1: vacuum, moderate T\n        (300.0, 5.0, 2.0),  # Case 2: water-like, moderate T\n        (600.0, 5.0, 2.0),  # Case 3: water-like, high T\n        (100.0, 0.0, 0.0),  # Case 4: vacuum, low T\n    ]\n\n    results = []\n    for T, s_alpha, s_beta in test_cases:\n        p_alpha, p_beta = compute_probabilities(T, s_alpha, s_beta)\n        # Round to exactly six decimal places per requirements\n        results.append([f\"{p_alpha:.6f}\", f\"{p_beta:.6f}\"])\n\n    # Final print statement in the exact required format: a single line\n    # Convert the inner strings to produce numeric-looking output without quotes\n    # Build the string manually to avoid quotes\n    out_elems = []\n    for pair in results:\n        out_elems.append(f\"[{pair[0]},{pair[1]}]\")\n    print(f\"[{','.join(out_elems)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "Generating a true canonical ensemble in a molecular dynamics simulation is more subtle than simply setting the temperature; it requires a deep understanding of the algorithms that couple the system to a virtual heat bath. This exercise challenges you to think critically about the tools of the trade by analyzing a common simulation artifact associated with the popular but flawed Berendsen thermostat. By diagnosing why a simulated protein folds artificially fast, you will learn that the canonical ensemble is defined not just by an average temperature, but by the specific magnitude of its energy fluctuations . This practice is essential for developing the skill to validate computational methods and to ensure that simulation results are physically meaningful.",
            "id": "2463805",
            "problem": "You perform Molecular Dynamics (MD) of a small protein in explicit water at fixed number of particles, volume, and temperature (canonical ensemble, also called the $NVT$ ensemble) using a Berendsen thermostat with coupling time constant $\\tau_{T}$. The target temperature is $T_{0}$. The average instantaneous temperature equals $T_{0}$, but the protein folds significantly faster than expected from experiment and from previous simulations reported with other thermostatting schemes. You also observe that the histogram of instantaneous kinetic energy appears narrower than what you would expect for a system at $T_{0}$. Which option best proposes a physically consistent mechanism for this artifact and a concrete test of that mechanism within the $NVT$ framework?\n\nA) Mechanism: The Berendsen thermostat deterministically rescales velocities toward $T_{0}$, suppressing the equilibrium kinetic energy fluctuations required by the canonical distribution and thus violating detailed balance in practice. This bias reduces barrier recrossings and artificially accelerates net folding. Test: Replace the Berendsen thermostat with a thermostat known to sample the canonical distribution (for example, a Nosé–Hoover chain or stochastic velocity rescaling) at the same $T_{0}$, and verify that both the kinetic energy distribution matches the canonical prediction and the folding time increases; additionally, vary $\\tau_{T}$ to check whether the folding rate depends strongly on the coupling strength.\n\nB) Mechanism: The Berendsen thermostat increases the effective viscosity of the solvent by overdamping water molecules, and higher viscosity drives faster conformational transitions by enhancing momentum transfer to the protein. Test: Decrease $\\tau_{T}$ to overdamp more strongly and confirm that folding becomes even faster.\n\nC) Mechanism: The Berendsen thermostat induces the “flying ice cube” effect that transfers energy from low-frequency collective motion to high-frequency internal modes, heating the protein’s bond vibrations and thereby promoting barrier crossing and fast folding. Test: Monitor mode-resolved temperatures and confirm that high-frequency modes become hotter than low-frequency modes.\n\nD) Mechanism: Because the Berendsen thermostat enforces equipartition exactly at every step, it generates an exact canonical distribution that maximizes barrier-crossing efficiency. Test: Confirm that the instantaneous temperature is sharply peaked at $T_{0}$ with essentially zero fluctuation over time.",
            "solution": "The problem statement is subjected to validation.\n\n**Step 1: Extract Givens**\n- Simulation Method: Molecular Dynamics (MD)\n- System: A small protein in explicit water.\n- Ensemble: Canonical ensemble, specified as constant number of particles ($N$), volume ($V$), and temperature ($T$).\n- Thermostat: Berendsen thermostat with a coupling time constant $\\tau_{T}$.\n- Target Temperature: $T_{0}$.\n- Observation 1: The average instantaneous temperature is equal to $T_{0}$.\n- Observation 2: The protein folding rate is significantly faster than experimental values and rates from simulations using other thermostats.\n- Observation 3: The histogram of instantaneous kinetic energy is narrower than the theoretical expectation for a canonical ensemble at temperature $T_{0}$.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded:** The problem is firmly grounded in the principles of statistical mechanics and computational molecular dynamics. The artifacts of the Berendsen thermostat, particularly its failure to generate a rigorous canonical distribution and its effect on system kinetics, are a well-documented and standard topic in the field. All concepts are scientifically sound.\n- **Well-Posed:** The problem provides a clear set of observations and asks for a physically consistent mechanism and a corresponding experimental test. The information is sufficient to identify the most appropriate explanation among the given options.\n- **Objective:** The problem is stated in precise, objective language common to the field of computational chemistry. There is no subjectivity or ambiguity.\n\n**Step 3: Verdict and Action**\nThe problem statement is valid. It is scientifically sound, well-posed, and objective. A solution will be derived.\n\n**Derivation of Principles**\nThe canonical ($NVT$) ensemble describes a system in thermal contact with a very large heat bath at a constant temperature $T$. The total energy of the system is not conserved but fluctuates around an average value. The instantaneous kinetic energy, $E_k$, is related to the instantaneous temperature $T(t)$ by the equipartition theorem for a system with $N_{df}$ degrees of freedom:\n$$ E_k(t) = \\frac{1}{2} N_{df} k_B T(t) $$\nwhere $k_B$ is the Boltzmann constant. In a true canonical ensemble, $E_k$ (and thus $T(t)$) exhibits fluctuations. The probability distribution of $E_k$ follows a Gamma distribution (or a chi-squared distribution, which is a special case), and its variance is non-zero. For a system of $N$ particles without constraints, $N_{df} = 3N$, and the variance of the kinetic energy is:\n$$ \\langle (\\delta E_k)^2 \\rangle = \\frac{3N}{2} (k_B T_0)^2 $$\nThe observation that the histogram of kinetic energy is \"narrower than expected\" implies that its variance is smaller than the canonical value: $\\langle (\\delta E_k)^2 \\rangle_{sim}  \\frac{3N}{2} (k_B T_0)^2$. This is a direct indication that the thermostat used does not correctly sample the canonical ensemble.\n\nThe Berendsen thermostat works by rescaling the velocities of all particles at each timestep $\\Delta t$ to gently guide the system's temperature towards the target temperature $T_{0}$. The scaling factor $\\lambda$ is:\n$$ \\lambda = \\sqrt{1 + \\frac{\\Delta t}{\\tau_T} \\left( \\frac{T_0}{T(t)} - 1 \\right)} $$\nThis is a deterministic, first-order kinetic coupling. It does not correspond to any physical heat bath and is known to violate the principle of detailed balance. Consequently, it suppresses the natural kinetic energy fluctuations, producing a distribution that is too narrow. This is precisely the artifact described in Observation 3.\n\nThe consequence of this non-canonical behavior on dynamics (Observation 2) is a known artifact. By deterministically damping fluctuations, the thermostat can interfere with the natural process of barrier crossing. When a system traverses a high-energy transition state, its kinetic energy is typically lower. A proper thermostat would provide stochastic energy exchange, allowing for the possibility of the system recrossing the barrier. The Berendsen thermostat, by consistently pushing the kinetic energy back towards the average, can prevent these recrossing events, leading to a uni-directional flow over energy barriers and an artificial acceleration of kinetic processes like protein folding.\n\nThermostats that are rigorously derived to generate the canonical ensemble, such as the Nosé–Hoover thermostat (and its chain variant to improve ergodicity) or stochastic methods like Andersen, Langevin, or stochastic velocity rescaling (SVR), do produce the correct kinetic energy fluctuations and are therefore expected to yield more physically realistic kinetic rates.\n\n**Option-by-Option Analysis**\n\nA) Mechanism: The Berendsen thermostat deterministically rescales velocities toward $T_{0}$, suppressing the equilibrium kinetic energy fluctuations required by the canonical distribution and thus violating detailed balance in practice. This bias reduces barrier recrossings and artificially accelerates net folding. Test: Replace the Berendsen thermostat with a thermostat known to sample the canonical distribution (for example, a Nosé–Hoover chain or stochastic velocity rescaling) at the same $T_{0}$, and verify that both the kinetic energy distribution matches the canonical prediction and the folding time increases; additionally, vary $\\tau_{T}$ to check whether the folding rate depends strongly on the coupling strength.\n- Analysis: This option provides a perfectly accurate description of the Berendsen thermostat's primary flaw: it does not generate a true canonical ensemble because it suppresses kinetic energy fluctuations. This is consistent with Observation 3 (\"narrower\" histogram). The proposed link to accelerated folding via reduced barrier recrossings is the accepted physical explanation for this kinetic artifact, consistent with Observation 2. The proposed tests are the gold standard for validating this hypothesis. Replacing the thermostat with a rigorous one (like Nosé–Hoover or SVR) should restore canonical fluctuations and correct the folding kinetics. Furthermore, the artifact's magnitude should depend on the coupling strength $\\tau_{T}$, so varying this parameter provides a conclusive secondary test.\n- Verdict: **Correct**.\n\nB) Mechanism: The Berendsen thermostat increases the effective viscosity of the solvent by overdamping water molecules, and higher viscosity drives faster conformational transitions by enhancing momentum transfer to the protein. Test: Decrease $\\tau_{T}$ to overdamp more strongly and confirm that folding becomes even faster.\n- Analysis: The second part of the mechanism is physically unsound. Protein folding is a process that involves large-scale diffusion-like motions. According to theories of reaction rates in the high-friction limit (e.g., Kramers' theory), the rate of such processes is *inversely* proportional to the viscosity of the medium. Higher viscosity would impede motion and *slow down* folding, not accelerate it. This contradicts Observation 2.\n- Verdict: **Incorrect**.\n\nC) Mechanism: The Berendsen thermostat induces the “flying ice cube” effect that transfers energy from low-frequency collective motion to high-frequency internal modes, heating the protein’s bond vibrations and thereby promoting barrier crossing and fast folding. Test: Monitor mode-resolved temperatures and confirm that high-frequency modes become hotter than low-frequency modes.\n- Analysis: The \"flying ice cube\" effect is a real artifact related to the failure of energy equipartition, where energy is systematically drained from translational modes. While the Berendsen thermostat is susceptible to this, it is not the most direct explanation for the primary observation that the *total* kinetic energy distribution is too narrow. The flying ice cube effect is a problem of energy *distribution* among modes, whereas the problem explicitly states the fluctuation of the *total* kinetic energy is suppressed. While related, the mechanism in A is more fundamental and directly explains all observations. The fast folding is more directly explained by the general suppression of fluctuations rather than specifically by the non-equipartition of the flying ice cube artifact.\n- Verdict: **Incorrect**.\n\nD) Mechanism: Because the Berendsen thermostat enforces equipartition exactly at every step, it generates an exact canonical distribution that maximizes barrier-crossing efficiency. Test: Confirm that the instantaneous temperature is sharply peaked at $T_{0}$ with essentially zero fluctuation over time.\n- Analysis: This statement contains multiple factual errors. The Berendsen thermostat does *not* enforce equipartition; in fact, it can lead to severe violations of it (like the \"flying ice cube\"). Most importantly, it does *not* generate a canonical distribution precisely *because* it suppresses fluctuations, which are an integral feature of this ensemble. The test describes the suppression of fluctuations, but the mechanism claims this produces an \"exact canonical distribution,\" which is a direct contradiction of the principles of statistical mechanics.\n- Verdict: **Incorrect**.",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}