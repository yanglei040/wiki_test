## 引言
[凝聚型层次聚类](@entry_id:635670)是一种强大的[无监督学习](@entry_id:160566)技术，它通过迭代地合并最相似的簇来构建数据的层次结构。然而，该算法的核心——“如何衡量两个簇之间的相似性？”——引出了一系列被称为“连锁方法”（linkage methods）的关键决策。不同连锁方法的选择并非细枝末节的技术调整，而是会从根本上改变聚类过程和最终结果的建模选择。对于初学者而言，单一、完全、平均和中心点这几种主流方法之间的差异可能显得微妙而令人困惑，导致在实践中难以做出明智的抉择。本文旨在系统性地阐明这些方法的内在逻辑、优缺点及其在不同场景下的适用性，从而填补理论与实践之间的知识鸿沟。通过阅读本文，您将首先在**“原理与机制”**一章中深入学习四种核心连锁方法的数学定义、几何直觉和关键性质，例如它们如何影响[树状图](@entry_id:266792)的结构。接着，在**“应用与跨学科联系”**一章中，您将看到这些理论知识如何在[计算生物学](@entry_id:146988)、计算机视觉和社会科学等真实世界问题中转化为具体的分析策略和科学见解。最后，**“动手实践”**部分将提供精心设计的编程练习，让您通过实际操作来巩固对不同连锁方法行为差异的理解。

## 原理与机制

在介绍完[凝聚型层次聚类](@entry_id:635670)的基本思想后，本章将深入探讨其核心——连锁方法（linkage methods）。不同的连锁方法定义了衡量簇间“距离”或“相异性”的不同方式，这些定义直接决定了[聚类算法](@entry_id:146720)的行为和最终产生的[树状图](@entry_id:266792)（dendrogram）结构。我们将系统地阐述四种主要的连锁方法：单一连锁（single linkage）、完全连锁（complete linkage）、平均连锁（average linkage）和[中心点](@entry_id:636820)连锁（centroid linkage），并分析它们的数学性质、几何直觉以及在实践中的优缺点。

### 四种核心连锁方法的定义

假设我们有两个非空且不相交的簇 $C_i$ 和 $C_j$。它们之间的相异性 $d(C_i, C_j)$ 可以通过以下四种主要方式定义。

#### 单一连锁 (Single Linkage)

**单一连锁**，又称最小连锁（MIN），将两个簇之间的距离定义为它们各自成员中最接近的两个点之间的距离。

$$
d_{\text{single}}(C_i, C_j) = \min_{x \in C_i, y \in C_j} d(x, y)
$$

这种方法的直觉非常简单：只要两个簇有任何一对点足够接近，这两个簇就被认为是接近的。这使得单一连锁非常擅长识别任意形状的簇，特别是那些细长、蜿蜒的结构。然而，这也导致了它最著名的特性——**链式效应（chaining effect）**。

设想一个场景 ，其中有两个致密的点集，它们各自位于两个不相交的圆盘区域 $\mathcal{A}$ 和 $\mathcal{B}$ 中。它们之间由一个狭长的矩形“走廊” $\mathcal{C}$ 连接，其中稀疏地[分布](@entry_id:182848)着一些数据点。单一连锁会像[连接链](@entry_id:185764)条一样，通过走廊中的这些点将 $\mathcal{A}$ 和 $\mathcal{B}$ 连接起来。只要合并的距离阈值足以跨越走廊中相邻点对之间的最大间隙，两个原本分离的致密簇就会被合并成一个。这个合并高度通常远小于两个致密簇的整体直径。

单一连锁的这种行为与[图论](@entry_id:140799)中的**最小生成树（Minimum Spanning Tree, MST）** 算法有着深刻的联系 。将数据集中的每个点视为图的一个顶点，点之间的距离视为边的权重。那么，对该数据集运行单一连锁[层次聚类](@entry_id:268536)的过程，其合并顺序和合并高度，完全等同于使用Kruskal算法构建MST时边的添加顺序和权重。在每个步骤中，两个簇的合并都对应于连接图中两个不同[连通分量](@entry_id:141881)的最短边。

#### 完全连锁 (Complete Linkage)

与单一[连锁相](@entry_id:201938)对，**完全连锁**，又称最大连锁（MAX），将两个簇之间的距离定义为它们各自成员中距离最远的两个点之间的距离。

$$
d_{\text{complete}}(C_i, C_j) = \max_{x \in C_i, y \in C_j} d(x, y)
$$

完全连锁采取了一种更为“保守”的策略。只有当一个簇中的所有点都与另一个簇中的所有点“足够近”时，这两个簇才会被合并。这种定义有效地避免了链式效应，并倾向于生成结构紧凑、近似球形的簇。

在之前提到的走廊连接圆盘的例子中 ，完全连锁的行为会截然不同。由于其合并高度由最远的跨簇点对（通常是 $\mathcal{A}$ 和 $\mathcal{B}$ 的外缘点）决定，因此即使走廊中的点链已经连接，只要两个圆盘的整体结构相距甚远，它们就不会被合并，直到合并高度达到足以覆盖整个 $\mathcal{A} \cup \mathcal{C} \cup \mathcal{B}$ 区域的直径。

#### 平均连锁 (Average Linkage)

**平均连锁**试图在单一连锁和完全连锁的极端之间找到一个平衡。它将两个簇之间的距离定义为所有跨簇点对之间距离的算术平均值。

$$
d_{\text{avg}}(C_i, C_j) = \frac{1}{|C_i||C_j|} \sum_{x \in C_i} \sum_{y \in C_j} d(x, y)
$$

其中 $|C_i|$ 和 $|C_j|$ 分别是簇 $C_i$ 和 $C_j$ 中点的数量 。这种方法考虑了所有点对的信息，因此比单一连锁对异常值（outliers）更不敏感，同时又不像完全连锁那样严格要求簇的紧凑性。

从概率论的角度看，平均连锁有着非常自然的解释 。如果我们将簇 $A$ 和 $B$ 视为两个[经验分布](@entry_id:274074)，从中分别均匀随机地抽取一个点 $X$ 和 $Y$，那么平均连锁距离恰好是这两个随机点之间距离的[期望值](@entry_id:153208) $\mathbb{E}[d(X, Y)]$。因此，平均连锁的每一步合并，都是在寻找能使合并后簇[间期](@entry_id:157879)望距离最小化的那对簇。根据大数定律，当簇是从某个潜在[分布](@entry_id:182848)中大量采样得到时，样本平均连锁距离会收敛到该潜在[分布](@entry_id:182848)下[随机变量](@entry_id:195330)之间距离的期望 $\mathbb{E}[d(X, Y)]$。

#### [中心点](@entry_id:636820)连锁 (Centroid Linkage)

**[中心点](@entry_id:636820)连锁**的定义在概念上最为直观。它将两个簇之间的距离定义为它们各自**中心点（centroid）** 之间的距离。[中心点](@entry_id:636820)是簇中所有点的[均值向量](@entry_id:266544)。

$$
d_{\text{centroid}}(C_i, C_j) = d(\boldsymbol{\mu}_i, \boldsymbol{\mu}_j), \quad \text{其中} \quad \boldsymbol{\mu}_k = \frac{1}{|C_k|} \sum_{x \in C_k} x
$$

这种方法计算上很高效，因为在每次合并后，只需要计算新簇的中心点，而无需重新遍历所有点对。它的行为可以看作是另一种著名[聚类算法](@entry_id:146720)——**$k$-均值（$k$-means）** 的一种贪心、分步的版本 。然而，与$k$-均值不同，[中心点](@entry_id:636820)连锁是**不可逆的**：一旦两个簇被合并，其中的点就永远不会被重新分配到其他簇。而$k$-均值算法在迭代过程中会不断重新分配数据点，直至收敛。这种根本性的差异可能导致它们在相同的数据集上产生截然不同的[聚类](@entry_id:266727)结果。

### 核心性质与比较分析

理解了四种连锁方法的基本定义后，我们可以从几个关键维度对它们进行更深入的比较，包括[计算效率](@entry_id:270255)、[树状图](@entry_id:266792)的结构特性以及对数据特定模式的敏感性。

#### 计算效率：Lance-Williams 更新公式

在[凝聚型层次聚类](@entry_id:635670)的每一步，我们都需要更新簇间的[距离矩阵](@entry_id:165295)。如果每次都根据原始定义重新计算所有距离，算法的效率将非常低下。幸运的是，许多连锁方法都可以通过一个统一的[递推公式](@entry_id:149465)——**[Lance-Williams公式](@entry_id:635873)**——来高效地更新距离。

假设簇 $C_i$ 和 $C_j$ 被合并为新簇 $C_{ij} = C_i \cup C_j$。新簇 $C_{ij}$ 与任何其他簇 $C_k$ 之间的距离可以通过以下通用形式计算 ：

$$
d(C_{ij}, C_k) = \alpha_i d(C_i, C_k) + \alpha_j d(C_j, C_k) + \beta d(C_i, C_j) + \gamma |d(C_i, C_k) - d(C_j, C_k)|
$$

不同的连锁方法对应不同的系数 $\alpha_i, \alpha_j, \beta, \gamma$：

*   **单一连锁 (Single Linkage)**: $\alpha_i = \frac{1}{2}$, $\alpha_j = \frac{1}{2}$, $\beta = 0$, $\gamma = -\frac{1}{2}$。这等价于 $d(C_{ij}, C_k) = \min(d(C_i, C_k), d(C_j, C_k))$。

*   **完全连锁 (Complete Linkage)**: $\alpha_i = \frac{1}{2}$, $\alpha_j = \frac{1}{2}$, $\beta = 0$, $\gamma = \frac{1}{2}$。这等价于 $d(C_{ij}, C_k) = \max(d(C_i, C_k), d(C_j, C_k))$。

*   **平均连锁 (Average Linkage, [UPGMA](@entry_id:172615))**: $\alpha_i = \frac{|C_i|}{|C_i|+|C_j|}$, $\alpha_j = \frac{|C_j|}{|C_i|+|C_j|}$, $\beta = 0$, $\gamma = 0$。这里的更新是一个加权平均。

*   **中心点连锁 (Centroid Linkage)**: 也有对应的系数，其中 $\beta$ 为负值，这正是其一个特殊性质的根源。

这个统一的公式框架不仅极大地提高了[计算效率](@entry_id:270255)，也为从理论上分析和比较不同连锁方法的性质提供了便利。

#### [树状图](@entry_id:266792)的[单调性](@entry_id:143760)与反转

一个理想的[层次聚类](@entry_id:268536)[树状图](@entry_id:266792)应该具有**[单调性](@entry_id:143760)（monotonicity）**，即后发生的合并，其合并高度（相异性）不应低于先发生的合并。这确保了[树状图](@entry_id:266792)的枝干总是向上延伸，符合“距离越远的簇越晚合并”的直观感觉。

单一连锁、完全连锁和平均连锁都保证了[单调性](@entry_id:143760)。然而，**中心点连锁不具有[单调性](@entry_id:143760)**。在某些情况下，它可能产生**反转（inversion）**，即一次合并发生的高度反而低于前一次合并的高度  。

考虑一个简单的例子：三个点 $x_1 = (-1, 0, 0)$, $x_2 = (1, 0, 0)$, $x_3 = (0, 1.9, 0)$ 。
1.  初始时，点 $x_1$ 和 $x_2$ 之间的距离为 $2$，而它们各自与 $x_3$ 的距离为 $\sqrt{4.61}$。因此，第一次合并发生在 $x_1$ 和 $x_2$ 之间，合并高度 $h_1 = 2$。
2.  新形成的簇 $\{x_1, x_2\}$ 的中心点是原点 $(0, 0, 0)$。
3.  接下来，计算这个新中心点与 $x_3$ 的距离，得到第二次合并的高度 $h_2 = \|(0,0,0) - (0,1.9,0)\| = 1.9$。
我们发现 $h_2 = 1.9  h_1 = 2$，发生了反转。在[树状图](@entry_id:266792)中，这表现为一次横向的合并线低于它下面的合并线，这在解释上会造成困惑。

这种反转现象的根本原因在于簇的几何中心的变化。当两个簇合并时，新簇的中心点可能会“被拉向”某个方向，导致它与第三个簇的距离比原来两个簇之间的距离还要近。这种现象在处理异[方差](@entry_id:200758)（heteroscedastic），即[方差](@entry_id:200758)不等的簇时尤为显著 。当一个紧凑的簇与一个分散的簇合并时，新[中心点](@entry_id:636820)的位置受分散簇的影响更大，可能导致与第三个簇的距离意外减小。

#### 对数据模式的敏感性与鲁棒性

不同的连锁方法对数据中特定模式的敏感度不同，这决定了它们在不同应用场景下的适用性。

*   **链式效应与密度**：如前所述，单一连锁的链式效应使其能识别非凸形状的簇，但也使其容易被噪声点或稀疏的“桥”所误导。将它与基于密度的[聚类方法](@entry_id:747401)（如DBSCAN）比较，可以更清楚地看到这一点 。当DBSCAN的`MinPts`参数设置为$1$时，其结果与在特定高度$\epsilon$切割单一连锁[树状图](@entry_id:266792)的结果完全相同。然而，当`MinPts`大于$1$时，DBSCAN要求一个点的$\epsilon$-邻域内必须有足够多的点才能成为“[核心点](@entry_id:636711)”，从而形成簇。这个密度要求使得DBSCAN能够忽略连接两个高密度区域的低密度“颈部”，而单一连锁则会毫不犹豫地通过这个颈部将它们合并。

*   **簇大小不平衡的影响**：标准平均连锁（也称[UPGMA](@entry_id:172615), Unweighted Pair Group Method with Arithmetic Mean）的更新公式 $d(C_{ij}, C_k) = \frac{|C_i|}{|C_i|+|C_j|}d(C_i,C_k) + \frac{|C_j|}{|C_i|+|C_j|}d(C_j,C_k)$ 表明，新距离是旧距离的加权平均，权重与簇的大小成正比 。这意味着，在确定新簇的位置时，较大的簇拥有更大的“话语权”。在某些应用中，这可能不是我们期望的。为了解决这个问题，可以采用**加权平均连锁**（WPGMA, Weighted Pair Group Method with Arithmetic Mean），其更新公式简单地取算术平均：$d(C_{ij}, C_k) = \frac{1}{2}d(C_i, C_k) + \frac{1}{2}d(C_j, C_k)$。这里“加权”一词指的是它给予了每个**簇**相等的权重，而非每个**点**。

*   **对异常值和[偏态分布](@entry_id:175811)的鲁棒性**：平均连锁由于考虑了所有点对，对单个异常值的敏感度低于单一连锁。然而，这并不意味着它对[偏态分布](@entry_id:175811)或含有“[重尾](@entry_id:274276)”的簇是完全鲁棒的 。在其概率解释 $\mathbb{E}[d(X, Y)]$ 中，即使产生极大距离的“尾部”点对出现的概率很低，它们对[期望值](@entry_id:153208)的贡献也可能非常大，从而扭曲整体的簇间距离。相比之下，[中心点](@entry_id:636820)连锁只关心均值，这使得它对异常值的位置不敏感（但异常值仍会影响均值的计算）。通过**[Jensen不等式](@entry_id:144269)**可以证明，对于任意两个簇，平均连锁距离总是大于或等于中心点连锁距离（$\mathbb{E}[\|X - Y\|] \ge \|\mathbb{E}[X] - \mathbb{E}[Y]\|$），这从数学上揭示了平均连锁对数据[分布](@entry_id:182848)的更全面的考量。

*   **对数据扰动的稳定性**：一个稳健的算法应该在其输入数据受到微小扰动时，其输出结果也只发生微小的变化。我们可以用**[利普希茨常数](@entry_id:146583)（Lipschitz constant）** 来衡量连锁方法对数据点扰动的敏感性 。研究表明，对于点位置的微小扰动，单一连锁和完全连锁的合并高度变化的上界是相同的。它们的[利普希茨常数](@entry_id:146583)均为$2$，这意味着如果数据集中每个点的移动距离最大为 $\epsilon$，那么任意一次合并的高度变化不会超过 $2\epsilon$。这个结果表明，尽管这两种方法在全局行为上截然不同，但它们在[局部稳定性](@entry_id:751408)方面具有可比性。

### 总结与选择指南

| 特性 | 单一连锁 (Single Linkage) | 完全连锁 (Complete Linkage) | 平均连锁 (Average Linkage) | 中心点连锁 (Centroid Linkage) |
| :--- | :--- | :--- | :--- | :--- |
| **定义** | 最小点对距离 | 最大点对距离 | 所有点对距离的平均 | [中心点](@entry_id:636820)之间的距离 |
| **几何偏好** | 任意形状，细长结构 | 紧凑，球形 | 折衷，可处理一定程度的拉伸 | 紧凑，球形（受中心点影响） |
| **链式效应** | 非常敏感 | 不敏感 | 相对不敏感 | 不敏感 |
| **单调性** | 是 | 是 | 是 | **否** (可能出现反转) |
| **计算** | 可用[Lance-Williams公式](@entry_id:635873)高效更新 | 可用[Lance-Williams公式](@entry_id:635873)高效更新 | 可用[Lance-Williams公式](@entry_id:635873)高效更新 | 可用[Lance-Williams公式](@entry_id:635873)高效更新 |
| **主要优点** | 擅长处理非凸簇，与MST有理论联系 | 结果紧凑，[可解释性](@entry_id:637759)强 | 在链式效应和紧凑性之间取得良好平衡 | 计算简单，概念直观 |
| **主要缺点** | 易受噪声和“桥”的影响 | 对异常值敏感，可能切断自然的细长簇 | [UPGMA](@entry_id:172615)受簇大小影响，WPGMA的“加权”可能不直观 | 可能产生费解的[树状图](@entry_id:266792)反转 |

在选择连锁方法时，没有“最好”的通用选择，而应根据数据本身的特性和分析目标来决定：

-   如果怀疑数据中存在非凸形状的簇，并且愿意接受链式效应的风险，**单一连锁**是一个值得尝试的起点。
-   如果期望得到紧凑、易于描述的簇，并且数据相对干净、没有太多异常值，**完全连锁**通常能提供令人满意的结果。
-   在大多数情况下，**平均连锁**提供了一个稳健的折衷方案，它既不像单一连锁那样极端，也不像完全连锁那样严格。
-   由于**[中心点](@entry_id:636820)连锁**可能产生非单调的[树状图](@entry_id:266792)，使得结果难以解释，因此在现代应用中相对较少使用，除非其简单的几何意义对特定问题至关重要。