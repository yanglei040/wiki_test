{
    "hands_on_practices": [
        {
            "introduction": "要掌握Metropolis-Hastings算法，第一步是精通其核心的接受/拒绝机制。本练习提供了一个基于离散型目标分布（泊松分布）的直观场景，旨在帮助你练习计算接受概率，这是该算法决策过程的核心 。通过这个基础计算，我们可以具体地理解马尔可夫链是如何朝着目标分布演化的。",
            "id": "1962612",
            "problem": "一位统计学家正在实现一个马尔可夫链蒙特卡洛 (MCMC) 模拟，以从一个目标概率分布中生成样本。所选的目标分布是泊松分布，它模拟在固定的时间或空间间隔内发生的事件数量 $k$。泊松分布的概率质量函数由下式给出：\n$$ P(k; \\lambda) = \\frac{\\lambda^k e^{-\\lambda}}{k!} $$\n其中 $\\lambda$ 是事件的平均发生率。对于这个特定的模拟，参数设置为 $\\lambda = 5$。\n\n该模拟使用 Metropolis-Hastings 算法和一个对称的提议分布，这意味着从状态 $k_1$ 提议移动到状态 $k_2$ 的概率与从 $k_2$ 提议移动到 $k_1$ 的概率相同。\n\n假设链的当前状态是 $k=5$。算法接着提议移动到一个新状态 $k'=6$。\n\n计算这个从 $k=5$ 到 $k'=6$ 的提议移动的接受概率。将您的答案表示为小数，并四舍五入到三位有效数字。",
            "solution": "在具有对称提议分布的 Metropolis-Hastings 算法中，从状态 $k$ 移动到 $k'$ 的提议移动的接受概率 $\\alpha$ 为\n$$\n\\alpha = \\min\\left(1, \\frac{\\pi(k')}{\\pi(k)}\\right),\n$$\n其中 $\\pi(\\cdot)$ 是目标概率质量函数。对于参数为 $\\lambda$ 的泊松分布，其 PMF 为\n$$\n\\pi(k) = \\frac{\\lambda^{k} \\exp(-\\lambda)}{k!}.\n$$\n因此，该比率可简化为\n$$\n\\frac{\\pi(k')}{\\pi(k)} = \\frac{\\lambda^{k'} \\exp(-\\lambda) / k'!}{\\lambda^{k} \\exp(-\\lambda) / k!} = \\lambda^{k'-k} \\frac{k!}{k'!}.\n$$\n当 $k=5$，$k'=6$ 且 $\\lambda=5$ 时，我们有 $k'-k=1$ 且 $6! = 6 \\cdot 5!$，所以\n$$\n\\frac{\\pi(6)}{\\pi(5)} = \\lambda \\cdot \\frac{5!}{6!} = \\lambda \\cdot \\frac{1}{6} = \\frac{5}{6}.\n$$\n因此，接受概率为\n$$\n\\alpha = \\min\\left(1, \\frac{5}{6}\\right) = \\frac{5}{6}.\n$$\n表示为小数并四舍五入到三位有效数字，结果为 $0.833$。",
            "answer": "$$\\boxed{0.833}$$"
        },
        {
            "introduction": "在掌握了单步计算之后，我们必须考虑算法的长期行为，因为一个不合适的提议分布可能会导致误导性的结论。这个思想实验探讨了当步长很小的采样器遇到双峰分布时会发生什么，这是在真实世界应用（如模型参数估计）中常见的问题 。理解这种采样器“卡住”的现象对于诊断MCMC模拟的收敛性至关重要。",
            "id": "1962668",
            "problem": "一位数据科学家正在分析一个复杂气候模型的参数 $\\theta$ 的后验概率分布。分析表明，该后验分布（记为 $p(\\theta)$）是双峰的，在 $\\theta_A$ 和 $\\theta_B$ 处有两个明显的高概率峰，它们之间被一个宽阔的极低概率区域隔开。为了探索该分布并估计后验均值等性质，该科学家采用了 Metropolis-Hastings (M-H) 算法。\n\nM-H 采样器使用一个位于第一个峰 $\\theta_A$ 附近的高概率区域内的初始值 $\\theta_0$ 进行初始化。采样器使用对称的提议分布 $q(\\theta' | \\theta) = \\mathcal{N}(\\theta' | \\theta, \\sigma^2)$，其中 $\\mathcal{N}$ 是以当前状态 $\\theta$ 为中心、标准差为 $\\sigma$ 的正态分布，$\\sigma$ 代表提议步长。为了追求高接受率，该科学家为 $\\sigma$ 选择了一个相对于两峰间距 $|\\theta_A - \\theta_B|$ 而言非常小的值。\n\n在 M-H 采样器运行了大量迭代之后，下列哪项描述最准确地刻画了这次模拟的预期结果？\n\nA. 采样器将高效地找到后验分布 $p(\\theta)$ 的全局最大值并停留在那里，从而为参数提供一个极好的点估计。\n\nB. 对提议状态的接受率将非常低，导致马尔可夫链停留在初始状态 $\\theta_0$ 附近，几乎无法探索参数空间。\n\nC. 生成的样本链将高度自相关，其直方图将主要反映 $\\theta_A$ 附近峰的形状，而无法发现 $\\theta_B$ 附近的峰。\n\nD. 样本将以系统性的方式在两个峰之间交替，以固定的频率从 $\\theta_A$ 区域跳到 $\\theta_B$ 区域，然后再跳回来。\n\nE. 链的状态将几乎相互独立，表明采样器已成功收敛到真实的双峰后验分布。",
            "solution": "我们来分析一个使用对称提议分布的 Metropolis-Hastings (M-H) 采样器，其提议尺度相对于后验分布 $p(\\theta)$ 在 $\\theta_{A}$ 和 $\\theta_{B}$ 处的两个分离峰之间的距离而言非常小。\n\n对于对称提议分布 $q(\\theta' \\mid \\theta) = \\mathcal{N}(\\theta' \\mid \\theta, \\sigma^{2})$，Metropolis-Hastings 接受概率为\n$$\na(\\theta \\rightarrow \\theta') = \\min\\left\\{1, \\frac{p(\\theta')}{p(\\theta)}\\right\\}.\n$$\n链在 $\\theta_{A}$ 附近的高概率区域中的 $\\theta_{0}$ 处被初始化。因为选择的 $\\sigma$ 相对于分离距离 $|\\theta_{A} - \\theta_{B}|$ 非常小，所以提议的移动满足 $|\\theta' - \\theta| = O(\\sigma)$，因此会保持在离当前状态非常近的位置。在一个峰附近的高概率区域内，对于小的步长，$p(\\theta')$ 的值接近 $p(\\theta)$，所以\n$$\n\\frac{p(\\theta')}{p(\\theta)} \\approx 1,\n$$\n这意味着 $a(\\theta \\rightarrow \\theta') \\approx 1$ 并且局部接受率很高。因此，选项 B（接受率非常低）与这种在峰内部的小步长行为相矛盾。\n\n接下来，我们考虑峰之间的转移。在高斯提议分布下，从一个靠近 $\\theta_{A}$ 的当前状态直接提议一个靠近 $\\theta_{B}$ 的状态的概率为\n$$\nq(\\theta_{B} \\mid \\theta) \\propto \\exp\\left(-\\frac{|\\theta_{B} - \\theta|^{2}}{2 \\sigma^{2}}\\right).\n$$\n由于 $\\sigma \\ll |\\theta_{A} - \\theta_{B}|$，这个提议概率是指数级小的。因此，在实际的时间尺度上，直接跨越低概率谷的跳跃基本上不会被提议出来。另外，通过许多小步来穿过低概率谷，需要反复提议移动到 $p(\\theta') \\ll p(\\theta)$ 的区域，而对于这些移动，\n$$\na(\\theta \\rightarrow \\theta') = \\min\\left\\{1, \\frac{p(\\theta')}{p(\\theta)}\\right\\} \\ll 1,\n$$\n所以这样的步骤绝大多数会被拒绝。因此，马尔可夫链在很长一段时间内实际上被困在 $\\theta_{A}$ 附近，在实践中无法发现 $\\theta_{B}$。\n\n因为移动非常局部，且链停留在同一个峰内，所以连续的样本高度自相关。因此，经验直方图反映了 $\\theta_{A}$ 附近的局部形状，但未能捕捉到 $\\theta_{B}$ 附近的分离峰。这就排除了选项 E（独立性和成功收敛）和选项 D（在峰之间有规律地交替）。选项 A 是不正确的，因为 M-H 是一个以 $p(\\theta)$ 为目标的采样器，而不是一个优化器；此外，在小步长和双峰性的情况下，它既不能高效地找到全局最大值，也不能停留在该处。\n\n因此，最准确的描述是：链表现出高度的自相关性，主要对 $\\theta_{A}$ 的邻域进行采样，并且无法发现第二个峰 $\\theta_{B}$。\n\n正确的选项是 C。",
            "answer": "$$\\boxed{C}$$"
        },
        {
            "introduction": "认识到不当的提议分布会导致采样失败后，下一个自然的问题就是如何设计一个更高效的采样器。本练习通过分析一个相关的二元分布来展示这一点，要求我们比较两种不同提议方案的效率 。通过这个练习，你将领会到为何将提议移动的方向与目标分布的几何结构对齐，对于高效探索参数空间是如此关键。",
            "id": "1962663",
            "problem": "一位统计学家正在使用 Metropolis-Hastings 算法从 $\\mathbb{R}^2$ 上的一个二元目标分布中进行采样，该分布的概率密度函数 (PDF) $\\pi(x, y)$ 正比于\n$$\n\\pi(x, y) \\propto \\exp\\left(-\\frac{x^2 - 2\\rho xy + y^2}{2(1-\\rho^2)}\\right)\n$$\n其中 $\\rho$ 是一个常数相关性参数，满足 $0  \\rho  1$。\n\n马尔可夫链的当前状态是 $(X_t, Y_t) = (c, c)$，其中 $c$ 是一个正常数。考虑两种不同的对称随机游走提议方案来生成一个候选状态 $(X', Y')$。\n\n**方案 1：** 生成一个提议状态 $(X'_1, Y'_1)$，使得所走的步长为 $(X'_1 - X_t, Y'_1 - Y_t) = (\\epsilon, -\\epsilon)$，对于某个小的正常数 $\\epsilon$。因此，提议状态为 $(X'_1, Y'_1) = (c+\\epsilon, c-\\epsilon)$。\n\n**方案 2：** 生成一个提议状态 $(X'_2, Y'_2)$，使得所走的步长为 $(X'_2 - X_t, Y'_2 - Y_t) = (\\epsilon, \\epsilon)$，使用相同的常数 $\\epsilon$。因此，提议状态为 $(X'_2, Y'_2) = (c+\\epsilon, c+\\epsilon)$。\n\n设 $\\alpha_1$ 为方案 1 下提议的 Metropolis-Hastings 接受概率，$\\alpha_2$ 为方案 2 下提议的接受概率。确定比率 $R = \\frac{\\alpha_2}{\\alpha_1}$。将你的答案表示为一个关于 $c$、$\\epsilon$ 和 $\\rho$ 的单一封闭形式解析表达式。",
            "solution": "对于一个对称随机游走 Metropolis-Hastings 提议，接受概率为 $\\alpha=\\min\\{1, \\pi(x',y')/\\pi(x,y)\\}$。由于两种方案中的提议都是对称的，Hastings 比率被消去，因此\n$$\n\\frac{\\pi(x',y')}{\\pi(c,c)}=\\exp\\left(E(x',y')-E(c,c)\\right),\n$$\n其中对数密度为\n$$\nE(x,y)=-\\frac{x^{2}-2\\rho xy+y^{2}}{2(1-\\rho^{2})},\n$$\n我们定义\n$$\nQ(x,y)=x^{2}-2\\rho xy+y^{2},\\quad E(x,y)=-\\frac{Q(x,y)}{2(1-\\rho^{2})}.\n$$\n因此\n$$\n\\ln\\left(\\frac{\\pi(x',y')}{\\pi(c,c)}\\right)=-\\frac{Q(x',y')-Q(c,c)}{2(1-\\rho^{2})}.\n$$\n\n在当前状态 $(c,c)$，\n$$\nQ(c,c)=c^{2}-2\\rho c^{2}+c^{2}=2c^{2}(1-\\rho).\n$$\n\n方案 1：$(x',y')=(c+\\epsilon,c-\\epsilon)$。计算\n$$\nx'^{2}=c^{2}+2c\\epsilon+\\epsilon^{2},\\quad y'^{2}=c^{2}-2c\\epsilon+\\epsilon^{2},\\quad x'y'=c^{2}-\\epsilon^{2}.\n$$\n因此\n$$\nQ_{1}=x'^{2}-2\\rho x'y'+y'^{2}=(2c^{2}+2\\epsilon^{2})-2\\rho(c^{2}-\\epsilon^{2})=2c^{2}(1-\\rho)+2\\epsilon^{2}(1+\\rho).\n$$\n所以\n$$\nQ_{1}-Q(c,c)=2\\epsilon^{2}(1+\\rho),\n$$\n并且\n$$\n\\ln\\left(\\frac{\\pi(x'_{1},y'_{1})}{\\pi(c,c)}\\right)=-\\frac{2\\epsilon^{2}(1+\\rho)}{2(1-\\rho^{2})}=-\\frac{\\epsilon^{2}}{1-\\rho}.\n$$\n由于当 $0  \\rho  1$ 时，该值为负，所以接受概率为\n$$\n\\alpha_{1}=\\exp\\left(-\\frac{\\epsilon^{2}}{1-\\rho}\\right).\n$$\n\n方案 2：$(x',y')=(c+\\epsilon,c+\\epsilon)$。计算\n$$\nx'^{2}=c^{2}+2c\\epsilon+\\epsilon^{2},\\quad y'^{2}=c^{2}+2c\\epsilon+\\epsilon^{2},\\quad x'y'=c^{2}+2c\\epsilon+\\epsilon^{2}.\n$$\n因此\n$$\nQ_{2}=x'^{2}-2\\rho x'y'+y'^{2}=2(1-\\rho)(c^{2}+2c\\epsilon+\\epsilon^{2}),\n$$\n所以\n$$\nQ_{2}-Q(c,c)=2(1-\\rho)(2c\\epsilon+\\epsilon^{2}),\n$$\n并且\n$$\n\\ln\\left(\\frac{\\pi(x'_{2},y'_{2})}{\\pi(c,c)}\\right)=-\\frac{2(1-\\rho)(2c\\epsilon+\\epsilon^{2})}{2(1-\\rho^{2})}=-\\frac{2c\\epsilon+\\epsilon^{2}}{1+\\rho}.\n$$\n当 $c>0$、$\\epsilon>0$、 $0  \\rho  1$ 时，该值也为负，所以\n$$\n\\alpha_{2}=\\exp\\left(-\\frac{2c\\epsilon+\\epsilon^{2}}{1+\\rho}\\right).\n$$\n\n因此，比率 $R=\\alpha_{2}/\\alpha_{1}$ 为\n$$\nR=\\exp\\left(-\\frac{2c\\epsilon+\\epsilon^{2}}{1+\\rho}+\\frac{\\epsilon^{2}}{1-\\rho}\\right)\n=\\exp\\left(-\\frac{2c\\epsilon}{1+\\rho}+\\epsilon^{2}\\left[\\frac{1}{1-\\rho}-\\frac{1}{1+\\rho}\\right]\\right)\n=\\exp\\left(-\\frac{2c\\epsilon}{1+\\rho}+\\frac{2\\rho\\,\\epsilon^{2}}{1-\\rho^{2}}\\right).\n$$",
            "answer": "$$\\boxed{\\exp\\left(\\frac{2\\rho\\,\\epsilon^{2}}{1-\\rho^{2}}-\\frac{2c\\,\\epsilon}{1+\\rho}\\right)}$$"
        }
    ]
}