{
    "hands_on_practices": [
        {
            "introduction": "在应用Vasicek模型为复杂的金融衍生品定价之前，深刻理解其基础的随机过程特性至关重要。本练习  提供了一个新颖的非金融场景——模拟政治支持率的波动，旨在帮助你专注于该过程的核心动态。通过这个练习，你将亲身体验均值回归的效应，并计算过程在不同时间点的相关性，从而为掌握更复杂的金融应用建立坚实的直觉。",
            "id": "2429522",
            "problem": "一位政治领袖的支持率在连续时间内被建模为一个瓦西切克过程，即一个单位区间上的奥恩斯坦-乌伦贝克扩散过程，为建模目的，该支持率被视为实数值。设支持率过程表示为 $A_t$，满足随机微分方程\n$$\n\\mathrm{d}A_t \\;=\\; \\kappa \\left(\\theta - A_t\\right)\\mathrm{d}t \\;+\\; \\sigma \\,\\mathrm{d}W_t,\n$$\n其中 $\\kappa>0$ 是均值回归速度，$\\theta \\in \\mathbb{R}$ 是长期水平，$\\sigma>0$ 是波动率参数，而 $(W_t)_{t\\ge 0}$ 是一个标准布朗运动。假设初始支持率恰好处于长期水平，即 $A_0=\\theta$。在选举前只进行两次民意调查：一次在时间 $t=\\tau$，另一次在选举日 $t=T$。民调时间表由 $\\kappa \\tau = \\tfrac{1}{2}\\ln 3$ 和 $T=2\\tau$ 固定。一位政策分析师定义了一个等于长期水平的临界支持率阈值 $L=\\theta$，并对在选举日或之前的两个民调日期中，支持率至少有一次低于 $L$ 的概率感兴趣。\n\n根据此模型和民调时间表，计算在 $t=\\tau$ 或 $t=T$ 时，$A_t  L$ 至少发生一次的概率。请将您的最终答案表示为最简精确分数。请勿对您的答案进行四舍五入。答案必须是一个实数。",
            "solution": "问题陈述具有科学依据，表述清晰，客观，并包含唯一解所需的所有信息。因此，该问题是有效的。我们着手求解。\n\n问题要求计算在两个民调日期 $t=\\tau$ 和 $t=T$ 中，支持率 $A_t$ 至少有一次低于临界阈值 $L=\\theta$ 的概率。该概率在形式上写作 $P(A_\\tau  \\theta \\text{ or } A_T  \\theta)$。\n\n使用概率的容斥原理，我们有：\n$$\nP(A_\\tau  \\theta \\text{ or } A_T  \\theta) = P(A_\\tau  \\theta) + P(A_T  \\theta) - P(A_\\tau  \\theta \\text{ and } A_T  \\theta)\n$$\n\n支持率过程 $A_t$ 遵循瓦西切克模型，这是一个由以下随机微分方程描述的奥恩斯坦-乌伦贝克过程：\n$$\n\\mathrm{d}A_t = \\kappa (\\theta - A_t)\\mathrm{d}t + \\sigma \\mathrm{d}W_t\n$$\n初始条件为 $A_0 = \\theta$。对于 $t > s$，给定 $A_s$ 时，此随机微分方程的解为：\n$$\nA_t = A_s e^{-\\kappa(t-s)} + \\theta(1 - e^{-\\kappa(t-s)}) + \\sigma \\int_s^t e^{-\\kappa(t-u)} \\mathrm{d}W_u\n$$\n对于固定的时间 $t$，以 $A_s$ 为条件的随机变量 $A_t$ 服从正态分布。其条件均值为：\n$$\nE[A_t | A_s] = A_s e^{-\\kappa(t-s)} + \\theta(1 - e^{-\\kappa(t-s)})\n$$\n其条件方差，使用伊藤等距定理，为：\n$$\nVar(A_t | A_s) = \\sigma^2 \\int_s^t e^{-2\\kappa(t-u)} \\mathrm{d}u = \\frac{\\sigma^2}{2\\kappa}(1 - e^{-2\\kappa(t-s)})\n$$\n\n在初始条件 $A_0 = \\theta$ 下，在任何时间 $t > 0$，$A_t$ 的分布是正态的。\n均值为 $E[A_t] = E[A_t | A_0 = \\theta] = \\theta e^{-\\kappa t} + \\theta(1 - e^{-\\kappa t}) = \\theta$。\n方差为 $Var(A_t) = Var(A_t | A_0 = \\theta) = \\frac{\\sigma^2}{2\\kappa}(1 - e^{-2\\kappa t})$。\n\n首先，我们计算单个概率 $P(A_\\tau  \\theta)$ 和 $P(A_T  \\theta)$。\n对于 $t=\\tau$，$A_\\tau$ 服从均值为 $E[A_\\tau] = \\theta$、方差为 $Var(A_\\tau) = \\frac{\\sigma^2}{2\\kappa}(1 - e^{-2\\kappa\\tau}) > 0$ 的正态分布。由于正态分布关于其均值对称，小于均值的概率恰好是 $\\frac{1}{2}$。\n$$\nP(A_\\tau  \\theta) = \\frac{1}{2}\n$$\n类似地，对于 $t=T$，$A_T$ 服从均值为 $E[A_T] = \\theta$ 的正态分布。因此，\n$$\nP(A_T  \\theta) = \\frac{1}{2}\n$$\n\n接下来，我们必须计算联合概率 $P(A_\\tau  \\theta \\text{ and } A_T  \\theta)$。这需要 $(A_\\tau, A_T)$ 的联合分布。由于该过程是高斯过程，向量 $(A_\\tau, A_T)$ 服从二元正态分布，其均值向量为 $(\\theta, \\theta)$，协方差矩阵需要我们确定。\n方差为：\n$$\nVar(A_\\tau) = \\frac{\\sigma^2}{2\\kappa}(1 - e^{-2\\kappa\\tau}) \\quad \\text{和} \\quad Var(A_T) = \\frac{\\sigma^2}{2\\kappa}(1 - e^{-2\\kappa T})\n$$\n对于 $\\tau  T$ 的协方差 $Cov(A_\\tau, A_T)$ 可以利用该过程的马尔可夫性质求得：\n$$\nCov(A_\\tau, A_T) = Cov(A_\\tau, E[A_T | A_\\tau]) = Cov(A_\\tau, A_\\tau e^{-\\kappa(T-\\tau)} + \\theta(1 - e^{-\\kappa(T-\\tau)}))\n$$\n$$\nCov(A_\\tau, A_T) = e^{-\\kappa(T-\\tau)} Var(A_\\tau)\n$$\n$A_\\tau$ 和 $A_T$ 之间的相关系数 $\\rho$ 是：\n$$\n\\rho = \\frac{Cov(A_\\tau, A_T)}{\\sqrt{Var(A_\\tau)Var(A_T)}} = \\frac{e^{-\\kappa(T-\\tau)} Var(A_\\tau)}{\\sqrt{Var(A_\\tau)Var(A_T)}} = e^{-\\kappa(T-\\tau)} \\sqrt{\\frac{Var(A_\\tau)}{Var(A_T)}}\n$$\n代入方差的表达式（项 $\\frac{\\sigma^2}{2\\kappa}$ 被消去）：\n$$\n\\rho = e^{-\\kappa(T-\\tau)} \\sqrt{\\frac{1 - e^{-2\\kappa\\tau}}{1 - e^{-2\\kappa T}}}\n$$\n给定的民调时间表为：$\\kappa \\tau = \\frac{1}{2}\\ln 3$ 和 $T=2\\tau$。\n由 $\\kappa \\tau = \\frac{1}{2}\\ln 3 = \\ln \\sqrt{3}$，我们有 $e^{\\kappa\\tau} = \\sqrt{3}$，所以 $e^{-\\kappa\\tau} = \\frac{1}{\\sqrt{3}}$。\n这意味着 $e^{-2\\kappa\\tau} = (e^{-\\kappa\\tau})^2 = \\frac{1}{3}$。\n由于 $T=2\\tau$，我们有 $\\kappa T = 2\\kappa\\tau = \\ln 3$，所以 $e^{-\\kappa T} = \\frac{1}{3}$。\n这意味着 $e^{-2\\kappa T} = (e^{-\\kappa T})^2 = \\frac{1}{9}$。\n此外，$T-\\tau = \\tau$，所以 $e^{-\\kappa(T-\\tau)} = e^{-\\kappa\\tau} = \\frac{1}{\\sqrt{3}}$。\n将这些值代入 $\\rho$ 的表达式中：\n$$\n\\rho = \\frac{1}{\\sqrt{3}} \\sqrt{\\frac{1 - \\frac{1}{3}}{1 - \\frac{1}{9}}} = \\frac{1}{\\sqrt{3}} \\sqrt{\\frac{\\frac{2}{3}}{\\frac{8}{9}}} = \\frac{1}{\\sqrt{3}} \\sqrt{\\frac{2}{3} \\cdot \\frac{9}{8}} = \\frac{1}{\\sqrt{3}} \\sqrt{\\frac{18}{24}} = \\frac{1}{\\sqrt{3}} \\sqrt{\\frac{3}{4}} = \\frac{1}{\\sqrt{3}} \\frac{\\sqrt{3}}{2} = \\frac{1}{2}\n$$\n现在我们计算 $P(A_\\tau  \\theta \\text{ and } A_T  \\theta)$。令 $Z_\\tau = \\frac{A_\\tau-\\theta}{\\sqrt{Var(A_\\tau)}}$ 和 $Z_T = \\frac{A_T-\\theta}{\\sqrt{Var(A_T)}}$。向量 $(Z_\\tau, Z_T)$ 服从相关系数为 $\\rho = \\frac{1}{2}$ 的标准二元正态分布。所求概率为 $P(Z_\\tau  0 \\text{ and } Z_T  0)$。对于标准二元正态分布，该概率由谢泼德公式给出：\n$$\nP(Z_\\tau  0, Z_T  0) = \\frac{1}{4} + \\frac{\\arcsin(\\rho)}{2\\pi}\n$$\n代入 $\\rho = \\frac{1}{2}$ 并使用 $\\arcsin(\\frac{1}{2}) = \\frac{\\pi}{6}$ 弧度：\n$$\nP(A_\\tau  \\theta, A_T  \\theta) = \\frac{1}{4} + \\frac{\\frac{\\pi}{6}}{2\\pi} = \\frac{1}{4} + \\frac{1}{12} = \\frac{3}{12} + \\frac{1}{12} = \\frac{4}{12} = \\frac{1}{3}\n$$\n最后，我们将所有分项概率代回到容斥原理公式中：\n$$\nP(A_\\tau  \\theta \\text{ or } A_T  \\theta) = P(A_\\tau  \\theta) + P(A_T  \\theta) - P(A_\\tau  \\theta, A_T  \\theta)\n$$\n$$\nP(A_\\tau  \\theta \\text{ or } A_T  \\theta) = \\frac{1}{2} + \\frac{1}{2} - \\frac{1}{3} = 1 - \\frac{1}{3} = \\frac{2}{3}\n$$\n支持率在两个民调日期至少有一次低于长期水平的概率是 $\\frac{2}{3}$。",
            "answer": "$$\n\\boxed{\\frac{2}{3}}\n$$"
        },
        {
            "introduction": "在掌握了Vasicek过程的基本动态后，我们可以将其应用于一个更复杂的金融定价任务。这个练习  要求你为一种基于零息债券的“幂期权”（power option）定价，这需要你超越基础的定价公式。它为你提供了一个绝佳的机会来实践“测度变换”（change of numeraire）这一现代量化金融的基石技术，以简化复杂的期望值计算。",
            "id": "2429541",
            "problem": "考虑一个无摩擦市场，其中存在连续的无违约零息债券。令 $r_t$ 表示风险中性测度 $\\mathbb{Q}$ 下的瞬时短利率，其由 Vasicek 过程建模\n$$\n\\mathrm{d}r_t = a \\left(\\theta - r_t\\right)\\mathrm{d}t + \\sigma \\mathrm{d}W_t,\n$$\n其中 $a>0$，$\\theta \\in \\mathbb{R}$，$\\sigma>0$，且 $W_t$ 是 $\\mathbb{Q}$ 下的标准布朗运动。对于 $0 \\leq t \\leq T$，令 $P(t,T)$ 表示在时间 $t$ 价格为、在时间 $T$ 到期的零息债券的价格。固定时间 $0  \\tau  T$。一个欧式期权在时间 $\\tau$ 支付 $(P(\\tau,T) - K)^2$，其中 $K$ 是一个正常数。假设 $P(0, \\tau)$ 和 $P(0, T)$ 已知。推导此期权在时间 $t=0$ 的无套利价格。",
            "solution": "该问题要求解一个欧式幂期权在时间 $t=0$ 的无套利价格，该期权在到期时间 $\\tau$ 的支付函数为 $(P(\\tau,T) - K)^2$，其中 $P(\\tau,T)$ 是在 $T$ 时刻到期的零息债券的价格。短利率 $r_t$ 在风险中性测度 $\\mathbb{Q}$ 下遵循 Vasicek 模型：\n$$\n\\mathrm{d}r_t = a(\\theta - r_t)\\mathrm{d}t + \\sigma \\mathrm{d}W_t\n$$\n令 $V_0$ 为期权在时间 $t=0$ 的价格。根据风险中性定价原理，价格是支付的贴现期望值：\n$$\nV_0 = \\mathbb{E}^{\\mathbb{Q}}\\left[ \\exp\\left(-\\int_0^\\tau r_s \\mathrm{d}s\\right) (P(\\tau,T) - K)^2 \\right]\n$$\n为了简化计算，我们进行测度转换，从风险中性测度 $\\mathbb{Q}$（以货币市场账户为计价单位）转换为 $\\tau$-远期测度 $\\mathbb{Q}^\\tau$，在该测度下，计价单位是零息债券 $P(t,\\tau)$。Radon-Nikodym 导数由下式给出：\n$$\n\\frac{\\mathrm{d}\\mathbb{Q}^\\tau}{\\mathrm{d}\\mathbb{Q}}\\bigg|_{\\mathcal{F}_\\tau} = \\frac{\\exp\\left(-\\int_0^\\tau r_s \\mathrm{d}s\\right)}{P(0,\\tau)}\n$$\n价格 $V_0$ 可以重写为：\n$$\nV_0 = P(0,\\tau) \\mathbb{E}^{\\mathbb{Q}^\\tau}\\left[ (P(\\tau,T) - K)^2 \\right]\n$$\n通过展开平方项并利用期望的线性性质，我们得到：\n$$\nV_0 = P(0,\\tau) \\left( \\mathbb{E}^{\\mathbb{Q}^\\tau}[P(\\tau,T)^2] - 2K \\mathbb{E}^{\\mathbb{Q}^\\tau}[P(\\tau,T)] + K^2 \\mathbb{E}^{\\mathbb{Q}^\\tau}[1] \\right)\n$$\n我们在 $\\tau$-远期测度 $\\mathbb{Q}^\\tau$ 下计算每个期望项：\n1.  常数的期望是常数本身：$\\mathbb{E}^{\\mathbb{Q}^\\tau}[1] = 1$。因此第三项是 $K^2$。\n2.  $\\mathbb{E}^{\\mathbb{Q}^\\tau}[P(\\tau,T)]$ 是债券 $P(\\tau,T)$ 在时间 $0$ 的远期价格。一个标准结果是，在 $T_1$ 交割、到期日为 $T_2$ 的债券的远期价格 $F(t; T_1, T_2)$ 由 $P(t,T_2)/P(t,T_1)$ 给出。因此：\n    $$\n    \\mathbb{E}^{\\mathbb{Q}^\\tau}[P(\\tau,T)] = F(0; \\tau, T) = \\frac{P(0,T)}{P(0,\\tau)}\n    $$\n3.  最复杂的项是 $\\mathbb{E}^{\\mathbb{Q}^\\tau}[P(\\tau,T)^2]$。在 Vasicek 模型下，债券价格 $P(t,T)$ 是短利率 $r_t$ 的一个指数仿射函数。远期债券的价格 $F(t;\\tau,T) = P(t,T)/P(t,\\tau)$ 也服从对数正态分布。在到期日 $t=\\tau$，$P(\\tau,T) = F(\\tau;\\tau,T)$，因此 $P(\\tau,T)$ 在测度 $\\mathbb{Q}^\\tau$ 下服从对数正态分布。\n\n令 $\\ln P(\\tau,T)$ 是在 $\\mathbb{Q}^\\tau$ 下服从正态分布的随机变量，其均值为 $\\mu$，方差为 $\\Sigma^2$。其对数的均值与变量本身的均值相关：\n$$\n\\mathbb{E}^{\\mathbb{Q}^\\tau}[P(\\tau,T)] = \\exp\\left(\\mu + \\frac{1}{2}\\Sigma^2\\right) = \\frac{P(0,T)}{P(0,\\tau)}\n$$\n这意味着 $\\mu = \\ln\\left(\\frac{P(0,T)}{P(0,\\tau)}\\right) - \\frac{1}{2}\\Sigma^2$。\n\n我们需要二阶矩 $\\mathbb{E}^{\\mathbb{Q}^\\tau}[P(\\tau,T)^2]$。对于一个对数正态变量，这由下式给出：\n$$\n\\mathbb{E}^{\\mathbb{Q}^\\tau}[P(\\tau,T)^2] = \\exp\\left(2\\mu + \\frac{1}{2}(2\\Sigma)^2\\right) = \\exp(2\\mu + 2\\Sigma^2)\n$$\n代入 $\\mu$ 的表达式：\n$$\n\\mathbb{E}^{\\mathbb{Q}^\\tau}[P(\\tau,T)^2] = \\exp\\left(2\\left(\\ln\\left(\\frac{P(0,T)}{P(0,\\tau)}\\right) - \\frac{1}{2}\\Sigma^2\\right) + 2\\Sigma^2\\right) = \\exp\\left(2\\ln\\left(\\frac{P(0,T)}{P(0,\\tau)}\\right) + \\Sigma^2\\right)\n$$\n$$\n\\mathbb{E}^{\\mathbb{Q}^\\tau}[P(\\tau,T)^2] = \\left(\\frac{P(0,T)}{P(0,\\tau)}\\right)^2 \\exp(\\Sigma^2)\n$$\n必须计算方差 $\\Sigma^2 = \\mathrm{Var}^{\\mathbb{Q}^\\tau}[\\ln P(\\tau,T)]$。对于 Vasicek 模型，远期价格 $F(t;\\tau,T)$ 的波动率为 $\\sigma_F(t) = \\sigma(B(t,T) - B(t,\\tau))$，其中 $B(t,T) = \\frac{1}{a}(1 - \\exp(-a(T-t)))$。方差是瞬时方差平方的积分：\n$$\n\\Sigma^2 = \\int_0^\\tau \\sigma_F(s)^2 \\mathrm{d}s = \\sigma^2 \\int_0^\\tau (B(s,T) - B(s,\\tau))^2 \\mathrm{d}s\n$$\n我们有 $B(s,T) - B(s,\\tau) = \\frac{1}{a}(\\exp(-a(\\tau-s)) - \\exp(-a(T-s))) = \\frac{e^{as}}{a}(e^{-a\\tau} - e^{-aT})$。\n积分变为：\n$$\n \\int_0^\\tau \\frac{e^{2as}}{a^2}(e^{-a\\tau} - e^{-aT})^2 \\mathrm{d}s = \\frac{(e^{-a\\tau} - e^{-aT})^2}{a^2} \\int_0^\\tau e^{2as} \\mathrm{d}s\n$$\n$$\n= \\frac{(e^{-a\\tau} - e^{-aT})^2}{a^2} \\left[\\frac{e^{2as}}{2a}\\right]_0^\\tau = \\frac{(e^{-a\\tau} - e^{-aT})^2}{2a^3} (e^{2a\\tau} - 1)\n$$\n这可以被简化为：\n$$\n\\Sigma^2 = \\frac{ \\sigma^2 }{2a^3} (e^{-a\\tau} - e^{-aT})^2 (e^{2a\\tau} - 1) = \\frac{ \\sigma^2 }{2a^3} e^{-2a\\tau}(1 - e^{-a(T-\\tau)})^2 (e^{2a\\tau} - 1) = \\frac{ \\sigma^2 }{2a^3} (1 - e^{-a(T-\\tau)})^2 (1 - e^{-2a\\tau})\n$$\n方差为 $\\Sigma^2 = \\frac{\\sigma^2}{2a^3}(1-\\exp(-a(T-\\tau)))^2(1-\\exp(-2a\\tau))$。\n\n现在我们组合出最终价格 $V_0$：\n$$\nV_0 = P(0,\\tau) \\left( \\left(\\frac{P(0,T)}{P(0,\\tau)}\\right)^2 \\exp(\\Sigma^2) - 2K\\frac{P(0,T)}{P(0,\\tau)} + K^2 \\right)\n$$\n$$\nV_0 = \\frac{P(0,T)^2}{P(0,\\tau)} \\exp(\\Sigma^2) - 2KP(0,T) + K^2 P(0,\\tau)\n$$\n代入 $\\Sigma^2$ 的表达式，我们得到最终的封闭形式解。",
            "answer": "$$\n\\boxed{\\frac{P(0,T)^2}{P(0,\\tau)} \\exp\\left(\\frac{\\sigma^2}{2a^3}(1 - \\exp(-a(T-\\tau)))^2(1 - \\exp(-2a\\tau))\\right) - 2KP(0,T) + K^2P(0,\\tau)}\n$$"
        },
        {
            "introduction": "理论模型只有在能够准确反映市场价格时才具有实际价值。最后的这个练习  将理论与实践联系起来，解决了模型校准这一核心任务。你将学习如何通过扩展的Vasicek模型，反解出能够使其完美匹配给定收益率曲线的隐含“风险的市场价格”（market price of risk），这是每位量化分析师都必须掌握的基本技能。",
            "id": "2429542",
            "problem": "您必须编写一个完整的程序，在给定一个随时间变化的市场风险价格的情况下，在 Vasicek 短期利率框架内对指定的初始期限结构进行完美定价。在物理测度（用概率测度 $\\mathbb{P}$ 表示）下，Vasicek 模型由随机微分方程 $dr_t = \\kappa (\\mu - r_t) \\, dt + \\sigma \\, dW_t^{\\mathbb{P}}$ 给出，其中 $\\kappa  0$ 是均值回归速度，$\\mu$ 是 $\\mathbb{P}$ 下的长期水平，$\\sigma  0$ 是波动率，而 $W_t^{\\mathbb{P}}$ 是一个标准布朗运动。假设存在一个确定的、随时间变化的市场风险价格 $\\lambda(t)$，它根据 $dr_t = [\\kappa (\\mu - r_t) - \\sigma \\lambda(t)] \\, dt + \\sigma \\, dW_t^{\\mathbb{Q}}$ 改变风险中性测度（用概率测度 $\\mathbb{Q}$ 表示）下的漂移项，其中 $W_t^{\\mathbb{Q}}$ 是 $\\mathbb{Q}$ 下的一个标准布朗运动。要求是，$\\mathbb{Q}$ 下的模型应能完美地对由瞬时远期利率曲线 $f(0,T)$ 指定的给定的初始非仿射期限结构进行定价。\n\n对于到期期限 $T \\ge 0$，初始瞬时远期利率曲线由 $f(0,T) = c_0 + c_1 e^{-b T} + c_2 T e^{-b T}$ 定义，参数为 $c_0 = 0.02$, $c_1 = 0.01$, $c_2 = 0.005$ 和 $b = 0.5$。Vasicek 模型参数为 $\\kappa = 0.7$, $\\mu = 0.03$ 和 $\\sigma = 0.01$。时间以年为单位，所有利率均为年化且连续复利。您的任务是数值计算随时间变化的市场风险价格 $\\lambda(t)$ 的值，该价格能使模型完美地对给定的初始期限结构进行定价。\n\n请使用以下评估时间（以年为单位）的测试集：$t \\in \\{0.0, 0.25, 1.0, 5.0, 20.0\\}$。对于此集合中的每个 $t$，计算对应的 $\\lambda(t)$ 值（实数）。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表顺序与给定的时间顺序完全一致。例如：$[x_1,x_2,x_3,x_4,x_5]$。要求的输出是实数（浮点数）。不应打印任何其他文本。\n\n所有输入均如上所述是固定的；您的程序必须是自包含的，且不得从用户或外部文件读取任何输入。所提供的 $f(0,T)$ 的函数形式和参数值构成了在评估时间点计算 $\\lambda(t)$ 所需的完整规范。最终答案必须以指定的单行格式返回。",
            "solution": "该问题要求确定 Vasicek 短期利率模型中一个随时间变化的市场风险价格 $\\lambda(t)$，使得该模型能完美再现给定的初始利率期限结构。该期限结构由瞬时远期利率曲线 $f(0,T)$ 指定。\n\n在风险中性测度 $\\mathbb{Q}$ 下，短期利率 $r_t$ 的 Vasicek 模型动态由以下随机微分方程（SDE）给出：\n$$dr_t = [\\kappa (\\mu - r_t) - \\sigma \\lambda(t)] \\, dt + \\sigma \\, dW_t^{\\mathbb{Q}}$$\n其中 $\\kappa$ 是均值回归速度，$\\mu$ 是物理测度 $\\mathbb{P}$ 下的长期均值，$\\sigma$ 是波动率，$\\lambda(t)$ 是确定的市场风险价格。这个随机微分方程可以重写为标准的 Hull-White 形式：\n$$dr_t = \\kappa (\\theta(t) - r_t) \\, dt + \\sigma \\, dW_t^{\\mathbb{Q}}$$\n其中 $\\theta(t)$ 是 $\\mathbb{Q}$ 下一个随时间变化的均值回归水平，定义为：\n$$\\theta(t) = \\mu - \\frac{\\sigma}{\\kappa} \\lambda(t)$$\n我们的主要目标是确定 $\\theta(t)$，由此我们可以轻松求出 $\\lambda(t)$。\n\n校准条件是，在时间 $t=0$ 时，模型对于到期期限 $T$ 隐含的瞬时远期利率（记为 $f_{model}(0, T)$）必须与给定的市场瞬时远期利率 $f_{market}(0, T)$ 对所有到期期限 $T \\ge 0$ 都匹配。\n$$f_{model}(0, T) = f_{market}(0, T), \\quad \\forall T \\ge 0$$\n对于 Hull-White 模型，一个在 $T$ 时刻到期的零息债券在时间 $t$ 的价格 $P(t, T)$ 已知具有仿射形式 $P(t, T) = A(t, T) e^{-B(t, T) r_t}$。瞬时远期利率定义为 $f(t, T) = -\\frac{\\partial \\ln P(t, T)}{\\partial T}$。模型远期利率的一般表达式是一个标准结果：\n$$f_{model}(t, T) = e^{-\\kappa(T-t)} r_t + \\int_t^T \\kappa \\theta(s) e^{-\\kappa(T-s)} ds - \\frac{\\sigma^2}{2\\kappa^2} (1 - e^{-\\kappa(T-t)})^2$$\n为了在时间 $t=0$ 进行校准，我们在上述公式中设 $t=0$。初始短期利率 $r_0$ 由初始时刻的远期曲线给出，$r_0 = f_{market}(0, 0)$。\n$$f_{model}(0, T) = e^{-\\kappa T} r_0 + \\int_0^T \\kappa \\theta(s) e^{-\\kappa(T-s)} ds - \\frac{\\sigma^2}{2\\kappa^2} (1 - e^{-\\kappa T})^2$$\n应用校准条件，我们得到关于 $\\theta(s)$ 的一个积分方程：\n$$f_{market}(0, T) = e^{-\\kappa T} r_0 + e^{-\\kappa T}\\int_0^T \\kappa \\theta(s) e^{\\kappa s} ds - \\frac{\\sigma^2}{2\\kappa^2} (1 - e^{-\\kappa T})^2$$\n为简洁起见，我们定义一个函数 $G(T)$：\n$$G(T) = f_{market}(0, T) - e^{-\\kappa T} r_0 + \\frac{\\sigma^2}{2\\kappa^2} (1 - e^{-\\kappa T})^2$$\n积分方程变为：\n$$\\int_0^T \\kappa \\theta(s) e^{\\kappa s} ds = e^{\\kappa T} G(T)$$\n为了求解 $\\theta(t)$，我们对等式两边关于 $T$ 求导，然后用 $t$ 替换 $T$。对左边应用微积分基本定理，对右边应用乘法法则，我们得到：\n$$\\kappa \\theta(T) e^{\\kappa T} = \\frac{d}{dT} \\left[ e^{\\kappa T} G(T) \\right] = \\kappa e^{\\kappa T} G(T) + e^{\\kappa T} G'(T)$$\n解出 $\\theta(T)$ 得：\n$$\\theta(T) = G(T) + \\frac{1}{\\kappa} G'(T)$$\n代入 $G(T)$ 及其导数 $G'(T)$ 的表达式并简化，得到校准后的均值回归水平的著名公式：\n$$\\theta(t) = f_{market}(0, t) + \\frac{1}{\\kappa} \\frac{\\partial f_{market}(0, t)}{\\partial t} + \\frac{\\sigma^2}{2\\kappa^2}(1 - e^{-2\\kappa t})$$\n这里，我们用变量 $t$ 替换了变量 $T$ 来表示时间依赖性。市场远期曲线给出为：\n$$f_{market}(0, t) = c_0 + c_1 e^{-b t} + c_2 t e^{-b t}$$\n其关于时间 $t$ 的导数为：\n$$\\frac{\\partial f_{market}(0, t)}{\\partial t} = -b c_1 e^{-b t} + c_2 e^{-b t} - b c_2 t e^{-b t} = (c_2 - b c_1) e^{-b t} - b c_2 t e^{-b t}$$\n将这些代入 $\\theta(t)$ 的表达式：\n$$\\theta(t) = c_0 + \\left( c_1 + \\frac{c_2 - b c_1}{\\kappa} \\right) e^{-b t} + \\left( c_2 - \\frac{b c_2}{\\kappa} \\right) t e^{-b t} + \\frac{\\sigma^2}{2\\kappa^2}(1 - e^{-2\\kappa t})$$\n这可以简化为：\n$$\\theta(t) = c_0 + \\left( c_1(1-\\frac{b}{\\kappa}) + \\frac{c_2}{\\kappa} \\right) e^{-b t} + c_2(1-\\frac{b}{\\kappa}) t e^{-b t} + \\frac{\\sigma^2}{2\\kappa^2}(1 - e^{-2\\kappa t})$$\n最后，我们通过重新整理其定义来找到市场风险价格 $\\lambda(t)$：\n$$\\lambda(t) = \\frac{\\kappa}{\\sigma} (\\mu - \\theta(t))$$\n我们现在将使用所提供的参数实现这个最终公式，以计算在指定评估时间点的 $\\lambda(t)$。\n\n给定的参数是：\n- 模型参数: $\\kappa = 0.7$, $\\mu = 0.03$, $\\sigma = 0.01$。\n- 远期曲线参数: $c_0 = 0.02$, $c_1 = 0.01$, $c_2 = 0.005$, $b = 0.5$。\n- 评估时间: $t \\in \\{0.0, 0.25, 1.0, 5.0, 20.0\\}$。\n\n程序将为这些时间点中的每一个计算 $\\theta(t)$，然后计算 $\\lambda(t)$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the time-varying market price of risk lambda(t) that makes the\n    Vasicek model perfectly price a given initial term structure.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (kappa, mu, sigma, c0, c1, c2, b, evaluation_times)\n        (0.7, 0.03, 0.01, 0.02, 0.01, 0.005, 0.5, [0.0, 0.25, 1.0, 5.0, 20.0])\n    ]\n\n    results = []\n    # There is only one set of parameters in this problem.\n    kappa, mu, sigma, c0, c1, c2, b, eval_times = test_cases[0]\n\n    for t in eval_times:\n        # This implementation follows the derived formula for theta(t).\n        # theta(t) = f_market(0, t) + (1/kappa) * f_market'(0, t) + (sigma^2 / (2*kappa^2)) * (1 - exp(-2*kappa*t))\n        #\n        # f_market(0, t) = c0 + c1*exp(-b*t) + c2*t*exp(-b*t)\n        # f_market'(0, t) = (c2 - b*c1)*exp(-b*t) - b*c2*t*exp(-b*t)\n        #\n        # Combining these gives a simplified expression for theta(t), which is implemented here.\n\n        # Calculate common terms\n        exp_bt = np.exp(-b * t)\n        exp_2kt = np.exp(-2 * kappa * t)\n        \n        # Term 1: from c0\n        term1 = c0\n        \n        # Term 2: coefficient of exp(-b*t)\n        # This combines c1*exp(-b*t) from f_market and parts of f_market'\n        term2_coeff = c1 * (1 - b / kappa) + c2 / kappa\n        term2 = term2_coeff * exp_bt\n        \n        # Term 3: coefficient of t*exp(-b*t)\n        # This combines c2*t*exp(-b*t) from f_market and parts of f_market'\n        term3_coeff = c2 * (1 - b / kappa)\n        term3 = term3_coeff * t * exp_bt\n        \n        # Term 4: the volatility adjustment term\n        term4 = (sigma**2 / (2 * kappa**2)) * (1 - exp_2kt)\n        \n        # Sum the terms to get theta(t)\n        theta_t = term1 + term2 + term3 + term4\n        \n        # Calculate lambda(t) from theta(t)\n        # lambda(t) = (kappa/sigma) * (mu - theta(t))\n        lambda_t = (kappa / sigma) * (mu - theta_t)\n        \n        results.append(lambda_t)\n\n    # Final print statement in the exact required format.\n    # The format specified is a list of floats, comma-separated, inside square brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}