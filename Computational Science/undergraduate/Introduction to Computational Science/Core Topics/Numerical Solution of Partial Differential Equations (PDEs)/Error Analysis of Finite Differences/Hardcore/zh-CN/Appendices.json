{
    "hands_on_practices": [
        {
            "introduction": "在数值微分中，选择步长 $h$ 是一项精细的平衡工作。一方面，较小的 $h$ 会减小因数学近似而产生的*截断误差*。另一方面，过小的 $h$ 会放大由计算机有限精度引起的*舍入误差*。这个练习  将让你动手实践，通过对这两种相互竞争的误差源进行建模和平衡，找到最小化总误差的“最佳点”——最优步长 $h_{\\mathrm{opt}}$。",
            "id": "2389525",
            "problem": "考虑使用中心差分公式来近似一个足够光滑的标量函数 $f(x)$ 在点 $x_0$ 处的一阶导数\n$$\nD_h f(x_0) \\equiv \\frac{f(x_0+h)-f(x_0-h)}{2h}.\n$$\n假设 $D_h f(x_0)$ 的绝对误差的主阶误差模型如下：\n$$\nE(h) = K_t h^2 + \\frac{K_r u}{h},\n$$\n其中 $K_t = \\frac{\\lvert f^{(3)}(x_0)\\rvert}{6}$，$K_r = \\lvert f(x_0)\\rvert$，$u$ 是用于计算 $f$ 的浮点运算的单位舍入误差。使用以下单位舍入误差值：对于双精度（IEEE 754 binary64），$u_{\\mathrm{double}} = 2^{-53}$；对于四倍精度（IEEE 754 binary128），$u_{\\mathrm{quad}} = 2^{-113}$。角度必须以弧度为单位进行解释。\n\n对于下面列出的每个测试用例，分别针对双精度和四倍精度，计算在所述模型下使 $E(h)$ 最小化的步长 $h_{\\mathrm{opt}}$。你的程序必须以指定格式输出这些值。\n\n测试套件（每个用例指定了 $f$、$x_0$ 以及适用时的角度单位）：\n- 用例 $1$：$f(x) = \\sin(x)$，$x_0 = 1$（弧度）。\n- 用例 $2$：$f(x) = \\sin(x)$，$x_0 = 10^{-12}$（弧度）。\n- 用例 $3$：$f(x) = \\cosh(x)$，$x_0 = 3$。\n\n最终输出格式要求：\n- 生成单行，包含一个用方括号括起来的逗号分隔列表，顺序如下\n$$\n[h_{\\mathrm{double},1},h_{\\mathrm{quad},1},h_{\\mathrm{double},2},h_{\\mathrm{quad},2},h_{\\mathrm{double},3},h_{\\mathrm{quad},3}],\n$$\n其中 $h_{\\mathrm{double},k}$ 和 $h_{\\mathrm{quad},k}$ 分别表示用例 $k$ 在双精度和四倍精度下的最小化步长。\n- 将每个数字以科学记数法表示，并具有恰好 $10$ 位有效数字（例如，$1.234567890\\times 10^{-5}$ 必须打印成类似 $1.2345678900e-05$ 的形式）。",
            "solution": "提交分析的问题陈述经过严格的验证。\n\n**步骤 1：提取已知条件**\n- **近似公式**：一阶导数的中心差分，$D_h f(x_0) \\equiv \\frac{f(x_0+h)-f(x_0-h)}{2h}$。\n- **误差模型**：绝对误差 $E(h) = K_t h^2 + \\frac{K_r u}{h}$。\n- **误差系数**：$K_t = \\frac{\\lvert f^{(3)}(x_0)\\rvert}{6}$ 和 $K_r = \\lvert f(x_0)\\rvert$。\n- **单位舍入误差值**：\n    - 双精度：$u_{\\mathrm{double}} = 2^{-53}$。\n    - 四倍精度：$u_{\\mathrm{quad}} = 2^{-113}$。\n- **角度单位**：角度以弧度为单位。\n- **任务**：对每个测试用例，分别计算双精度和四倍精度下使 $E(h)$ 最小化的步长 $h_{\\mathrm{opt}}$。\n- **测试用例**：\n    1. $f(x) = \\sin(x)$ 于 $x_0 = 1$。\n    2. $f(x) = \\sin(x)$ 于 $x_0 = 10^{-12}$。\n    3. $f(x) = \\cosh(x)$ 于 $x_0 = 3$。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据**：该问题在根本上是合理的。它涉及数值分析中的一个经典主题：数值微分中截断误差和舍入误差之间的权衡。所提供的误差模型 $E(h)$ 是一个标准的一阶近似，其中 $h^2$ 项代表中心差分格式的截断误差，而 $u/h$ 项代表舍入误差。中心差分公式的泰勒级数展开证实了截断误差是 $O(h^2)$ 阶的，且舍入误差模型是一个被广泛接受的简化。\n- **适定性**：存在唯一且有意义的解。对于 $h>0$，函数 $E(h)$ 是两个正项之和，一个随 $h$ 增加而增加，另一个随 $h$ 增加而减少。这种结构保证了在 $h \\in (0, \\infty)$ 上存在唯一的最小值，可以用微积分求出。\n- **客观性**：问题以精确的数学语言陈述，没有任何主观性或歧义。\n\n**步骤 3：结论与行动**\n该问题有科学依据、适定、客观且自洽。这是一个计算物理和数值分析领域的有效问题。因此，我将继续解决此问题。\n\n目标是找到步长，我们记为 $h_{\\mathrm{opt}}$，该步长使得总绝对误差函数 $E(h)$ 最小。误差函数为：\n$$\nE(h) = K_t h^2 + \\frac{K_r u}{h}\n$$\n为了找到最小值，我们必须计算 $E(h)$ 对 $h$ 的导数并令其为零。这会给出函数的临界点。\n$$\n\\frac{dE}{dh} = \\frac{d}{dh} \\left( K_t h^2 + K_r u h^{-1} \\right) = 2 K_t h - K_r u h^{-2}\n$$\n将导数设为零，得到最优步长 $h_{\\mathrm{opt}}$：\n$$\n2 K_t h_{\\mathrm{opt}} - \\frac{K_r u}{h_{\\mathrm{opt}}^2} = 0\n$$\n在 $h_{\\mathrm{opt}} \\neq 0$ 的情况下，我们可以重排该方程：\n$$\n2 K_t h_{\\mathrm{opt}}^3 = K_r u\n$$\n$$\nh_{\\mathrm{opt}}^3 = \\frac{K_r u}{2 K_t}\n$$\n解出 $h_{\\mathrm{opt}}$ 得：\n$$\nh_{\\mathrm{opt}} = \\left( \\frac{K_r u}{2 K_t} \\right)^{1/3}\n$$\n为确认这是一个最小值，我们考察二阶导数：\n$$\n\\frac{d^2E}{dh^2} = 2 K_t + 2 K_r u h^{-3}\n$$\n因为 $K_t = \\frac{\\lvert f^{(3)}(x_0)\\rvert}{6} \\ge 0$，$K_r = \\lvert f(x_0)\\rvert \\ge 0$，$u > 0$ 且 $h > 0$，所以对所有有效的测试用例（其中 $K_t$ 和 $K_r$ 不会同时为零），$\\frac{d^2E}{dh^2} > 0$。因此，该临界点对应一个局部最小值。\n\n现在，我们代入 $K_t$ 和 $K_r$ 的表达式：\n$$\nh_{\\mathrm{opt}} = \\left( \\frac{\\lvert f(x_0)\\rvert u}{2 \\left( \\frac{\\lvert f^{(3)}(x_0)\\rvert}{6} \\right)} \\right)^{1/3} = \\left( \\frac{3 \\lvert f(x_0)\\rvert u}{\\lvert f^{(3)}(x_0)\\rvert} \\right)^{1/3}\n$$\n只要 $f^{(3)}(x_0) \\neq 0$，此公式就有效。我们将此公式应用于每个测试用例。\n\n**用例 1：$f(x) = \\sin(x)$ 于 $x_0 = 1$**\n函数及其三阶导数为 $f(x) = \\sin(x)$ 和 $f^{(3)}(x) = -\\cos(x)$。在 $x_0=1$ 处：\n- $\\lvert f(x_0) \\rvert = \\lvert\\sin(1)\\rvert$\n- $\\lvert f^{(3)}(x_0) \\rvert = \\lvert-\\cos(1)\\rvert = \\lvert\\cos(1)\\rvert$\n由于 1 弧度在第一象限，$\\sin(1)$ 和 $\\cos(1)$ 均为正值。\n$$\nh_{\\mathrm{opt}} = \\left( \\frac{3 \\sin(1) u}{\\cos(1)} \\right)^{1/3} = \\left( 3 u \\tan(1) \\right)^{1/3}\n$$\n针对 $u = u_{\\mathrm{double}} = 2^{-53}$ 和 $u = u_{\\mathrm{quad}} = 2^{-113}$ 计算这些值。\n\n**用例 2：$f(x) = \\sin(x)$ 于 $x_0 = 10^{-12}$**\n导数与用例 1 中相同。在 $x_0=10^{-12}$ 处：\n- $\\lvert f(x_0) \\rvert = \\lvert\\sin(10^{-12})\\rvert \\approx 10^{-12} > 0$\n- $\\lvert f^{(3)}(x_0) \\rvert = \\lvert-\\cos(10^{-12})\\rvert = \\cos(10^{-12}) \\approx 1$\n条件 $f^{(3)}(x_0) \\neq 0$ 得到满足。\n$$\nh_{\\mathrm{opt}} = \\left( \\frac{3 \\sin(10^{-12}) u}{\\cos(10^{-12})} \\right)^{1/3} = \\left( 3 u \\tan(10^{-12}) \\right)^{1/3}\n$$\n针对 $u = u_{\\mathrm{double}}$ 和 $u = u_{\\mathrm{quad}}$ 计算这些值。\n\n**用例 3：$f(x) = \\cosh(x)$ 于 $x_0 = 3$**\n函数及其三阶导数为 $f(x) = \\cosh(x)$ 和 $f^{(3)}(x) = \\sinh(x)$。在 $x_0=3$ 处：\n- $\\lvert f(x_0) \\rvert = \\lvert\\cosh(3)\\rvert = \\cosh(3)$\n- $\\lvert f^{(3)}(x_0) \\rvert = \\lvert\\sinh(3)\\rvert = \\sinh(3)$\n$\\cosh(3)$ 和 $\\sinh(3)$ 均为正值，且 $\\sinh(3) \\neq 0$。\n$$\nh_{\\mathrm{opt}} = \\left( \\frac{3 \\cosh(3) u}{\\sinh(3)} \\right)^{1/3} = \\left( 3 u \\coth(3) \\right)^{1/3}\n$$\n针对 $u = u_{\\mathrm{double}}$ 和 $u = u_{\\mathrm{quad}}$ 计算这些值。\n\n最后一步是编程计算这六个值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the optimal step size h_opt that minimizes the error in the\n    central difference approximation of the first derivative, based on a\n    leading-order error model.\n    \"\"\"\n\n    # Define unit roundoff values for double and quadruple precision\n    u_double = 2**-53\n    u_quad = 2**-113\n\n    # The general formula for the optimal step size is derived as:\n    # h_opt = (3 * |f(x0)| * u / |f'''(x0)|)^(1/3)\n\n    # Test suite: each tuple contains (function_name, function, third_derivative, x0)\n    test_cases = [\n        (\"sin(x) at x=1\", np.sin, lambda x: -np.cos(x), 1.0),\n        (\"sin(x) at x=1e-12\", np.sin, lambda x: -np.cos(x), 1e-12),\n        (\"cosh(x) at x=3\", np.cosh, np.sinh, 3.0),\n    ]\n\n    results = []\n    precisions = [u_double, u_quad]\n\n    for name, f, f3, x0 in test_cases:\n        # Evaluate the absolute values of the function and its third derivative at x0\n        # The problem statement guarantees f'''(x0) is not zero for the given cases.\n        abs_f_x0 = np.abs(f(x0))\n        abs_f3_x0 = np.abs(f3(x0))\n        \n        # Check for division by zero, although not expected for these cases.\n        if abs_f3_x0 == 0:\n            # If f'''(x0) is zero, the error model is inappropriate.\n            # Handle this as an invalid case within the computation.\n            # For this problem, we rely on the problem setter's guarantee.\n            # For a more robust solver, this would raise an error.\n            h_opt_double = np.nan\n            h_opt_quad = np.nan\n        else:\n            # Ratio of function value to third derivative value\n            ratio = abs_f_x0 / abs_f3_x0\n\n            # Calculate h_opt for double precision\n            arg_double = 3 * ratio * u_double\n            h_opt_double = np.cbrt(arg_double)\n\n            # Calculate h_opt for quadruple precision\n            arg_quad = 3 * ratio * u_quad\n            h_opt_quad = np.cbrt(arg_quad)\n        \n        results.append(h_opt_double)\n        results.append(h_opt_quad)\n\n    # Format the output as a comma-separated list in brackets,\n    # with each number in scientific notation with 10 significant digits.\n    # The format specifier \"{:.9e}\" provides 1 digit before the decimal\n    # and 9 digits after, for a total of 10 significant digits.\n    formatted_results = [f\"{val:.9e}\" for val in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "有限差分近似的精度不仅取决于步长 $h$，还取决于被微分函数的特性。截断误差的大小与函数的高阶导数成正比；对于振荡函数，更高的频率意味着更大的导数值，从而导致更大的误差。通过比较低频函数 $\\sin(x)$ 和高频函数 $\\sin(100x)$ 的计算误差 ，你将定量地研究函数的“摆动性”如何影响数值计算的准确性。",
            "id": "2389561",
            "problem": "您需要分析和比较有限差分导数近似在两个不同频率的正弦函数上的数值误差。考虑函数 $f_1(x) = \\sin(x)$ 和 $f_2(x) = \\sin(100x)$。角度必须以弧度为单位。对于一个点 $x$ 和步长 $h$，使用中心有限差分公式来近似导数 $f'(x)$：\n$$\nD_h[f](x) = \\frac{f(x+h) - f(x-h)}{2h}.\n$$\n对于下面列出的每个测试用例，通过将数值近似值与精确导数进行比较，计算每个函数的绝对误差。精确导数为 $f_k'(x) = k \\cos(kx)$，其中 $f_k(x) = \\sin(kx)$ 且 $k \\in \\{1, 100\\}$。将函数 $f_k$ 在 $(x,h)$ 处的绝对误差定义为\n$$\nE_k(x,h) = \\left| D_h[f_k](x) - f_k'(x) \\right|.\n$$\n对于每个测试用例，计算并报告比率\n$$\nR(x,h) = \\frac{E_{100}(x,h)}{E_{1}(x,h)}.\n$$\n使用以下 $(x,h)$ 对的测试集，其中所有的 $x$ 都以弧度为单位，所有的 $h$ 都是无量纲的：\n- 测试 $1$：$x = 0$，$h = 10^{-1}$。\n- 测试 $2$：$x = 0$，$h = 10^{-6}$。\n- 测试 $3$：$x = 1.0$，$h = 10^{-3}$。\n- 测试 $4$：$x = \\frac{\\pi}{3}$，$h = 10^{-5}$。\n- 测试 $5$：$x = 2.0$，$h = 10^{-4}$。\n- 测试 $6$：$x = \\frac{\\pi}{8}$，$h = 10^{-8}$。\n\n您的程序必须按给定顺序计算每个测试用例的 $R(x,h)$，并生成单行输出，其中包含用方括号括起来的、以逗-号分隔的十进制数列表，每个数四舍五入到八位有效数字。例如，输出格式必须为\n$$\n[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4,\\text{result}_5,\\text{result}_6].\n$$\n每个 $\\text{result}_i$ 都必须是实数（浮点数）。不应打印任何其他文本。",
            "solution": "所陈述的问题具有科学依据，是适定的、客观的，并且包含了获得唯一解所需的所有必要信息。这是一个计算物理学中的标准问题，涉及有限差分近似的误差分析。因此，该问题是有效的，我们继续进行求解。\n\n该问题要求使用中心有限差分公式，在近似两个函数 $f_1(x) = \\sin(x)$ 和 $f_{100}(x) = \\sin(100x)$ 的导数时，比较其数值误差：\n$$\nD_h[f](x) = \\frac{f(x+h) - f(x-h)}{2h}\n$$\n分析的核心在于理解这种近似的截断误差。我们通过考虑 $f(x+h)$ 和 $f(x-h)$ 在点 $x$ 附近的 Taylor 级数展开来推导这个误差：\n$$\nf(x+h) = f(x) + hf'(x) + \\frac{h^2}{2!}f''(x) + \\frac{h^3}{3!}f'''(x) + \\frac{h^4}{4!}f^{(4)}(x) + \\frac{h^5}{5!}f^{(5)}(x) + O(h^6)\n$$\n$$\nf(x-h) = f(x) - hf'(x) + \\frac{h^2}{2!}f''(x) - \\frac{h^3}{3!}f'''(x) + \\frac{h^4}{4!}f^{(4)}(x) - \\frac{h^5}{5!}f^{(5)}(x) + O(h^6)\n$$\n用第一个展开式减去第二个展开式可得：\n$$\nf(x+h) - f(x-h) = 2hf'(x) + \\frac{2h^3}{3!}f'''(x) + \\frac{2h^5}{5!}f^{(5)}(x) + O(h^7)\n$$\n除以 $2h$ 得到数值导数的表达式：\n$$\nD_h[f](x) = f'(x) + \\frac{h^2}{6}f'''(x) + \\frac{h^4}{120}f^{(5)}(x) + O(h^6)\n$$\n因此，截断误差 $E(x,h) = |D_h[f](x) - f'(x)|$ 为：\n$$\nE(x,h) = \\left| \\frac{h^2}{6}f'''(x) + \\frac{h^4}{120}f^{(5)}(x) + \\dots \\right|\n$$\n对于足够小的步长 $h$，误差由主导项决定，我们可以将其近似为：\n$$\nE(x,h) \\approx \\left| \\frac{h^2}{6}f'''(x) \\right|\n$$\n这表明中心差分格式的截断误差为 $O(h^2)$ 阶。\n\n让我们将这个一般结果应用于函数 $f_k(x) = \\sin(kx)$，其中 $k \\in \\{1, 100\\}$。\n其导数是：\n- $f_k'(x) = k \\cos(kx)$\n- $f_k''(x) = -k^2 \\sin(kx)$\n- $f_k'''(x) = -k^3 \\cos(kx)$\n将三阶导数代入误差近似公式，得到 $f_k$ 的误差：\n$$\nE_k(x,h) \\approx \\left| \\frac{h^2}{6}(-k^3 \\cos(kx)) \\right| = \\frac{h^2 k^3}{6}|\\cos(kx)|\n$$\n题目要求我们计算比率 $R(x,h) = E_{100}(x,h) / E_1(x,h)$。使用上面的近似：\n$$\nR(x,h) \\approx \\frac{\\frac{h^2 (100^3)}{6}|\\cos(100x)|}{\\frac{h^2 (1^3)}{6}|\\cos(x)|} = 100^3 \\frac{|\\cos(100x)|}{|\\cos(x)|}\n$$\n该近似预测比率 $R(x,h)$ 应在 $100^3 = 1,000,000$ 的数量级，并受三角函数项的调节，前提是 $\\cos(x)$ 不接近于零，并且 $O(h^2)$ 误差项确实占主导地位。后一个条件成立的前提是，总误差不被机器精度（舍入）效应所主导，并且参数 $kh$ 足够小以使 Taylor 级数快速收敛。\n\n无需 Taylor 展开也可以找到误差的精确表达式。对于 $f_k(x) = \\sin(kx)$：\n$$\nD_h[f_k](x) = \\frac{\\sin(k(x+h)) - \\sin(k(x-h))}{2h} = \\frac{\\sin(kx+kh) - \\sin(kx-kh)}{2h}\n$$\n使用恒等式 $\\sin(A) - \\sin(B) = 2\\cos\\left(\\frac{A+B}{2}\\right)\\sin\\left(\\frac{A-B}{2}\\right)$，我们发现：\n$$\nD_h[f_k](x) = \\frac{2\\cos(kx)\\sin(kh)}{2h} = \\cos(kx) \\frac{\\sin(kh)}{h}\n$$\n于是精确误差为：\n$E_k(x,h) = |D_h[f_k](x) - f_k'(x)| = \\left| \\cos(kx) \\frac{\\sin(kh)}{h} - k \\cos(kx) \\right| = |\\cos(kx)| \\left| \\frac{\\sin(kh)}{h} - k \\right|$。\n这个公式对于截断误差是精确的。然而，在计算机上的数值计算会受到有限精度的影响。\n\n这引出了对测试集的两个重要考虑因素：\n1.  **$O(h^2)$ 近似的有效性：** $\\frac{\\sin(y)}{y}$ 的 Taylor 展开式为 $1 - \\frac{y^2}{6} + \\dots$。$E \\propto h^2$ 的近似仅在 $y=kh$ 很小（$kh \\ll 1$）时有效。对于测试 $1$，其中 $k=100$ 且 $h=10^{-1}$，我们有 $kh=10$，这个值并不小。因此，$100^3$ 的简单比率预测将不成立。对于所有其他测试，$kh \\le 0.1$，该近似预计会更准确。\n2.  **舍入误差：** 对于非常小的 $h$，例如测试 $6$ 中的 $h=10^{-8}$，计算 $f(x+h)-f(x-h)$ 会遭受灾难性抵消，因为它是两个几乎相等的数之差。舍入误差的量级为 $\\epsilon_m/h$（其中 $\\epsilon_m$ 是机器 epsilon），它可能变得比截断误差（量级为 $h^2$）更大。\n\n我们来具体分析测试 $6$（$x = \\pi/8$，$h=10^{-8}$）。\n对于 $f_{100}(x)$，截断误差与 $f_{100}'''(x) = -100^3 \\cos(100x)$ 成正比。在 $x=\\pi/8$ 处，$100x = 100\\pi/8 = 25\\pi/2$。由于 $\\cos(25\\pi/2) = \\cos(12\\pi + \\pi/2) = 0$，截断误差的主导项 $O(h^2)$ 为零。事实上，$f_{100}(x)$ 在 $x=\\pi/8$ 处的所有奇数阶导数都为零。这意味着解析截断误差恰好为零。\n因此，计算出的全部误差 $E_{100}(\\pi/8, h)$ 都由舍入误差构成。该误差近似为 $E_{100, RO} \\approx \\frac{\\epsilon_m |\\sin(100\\pi/8)|}{h} = \\frac{\\epsilon_m}{h}$。\n对于 $f_1(x)$，截断误差为 $E_{1, trunc} \\approx \\frac{h^2}{6}|\\cos(\\pi/8)| = \\frac{(10^{-8})^2}{6}|\\cos(\\pi/8)| \\approx O(10^{-17})$。舍入误差为 $E_{1, RO} \\approx \\frac{\\epsilon_m |\\sin(\\pi/8)|}{h} \\approx \\frac{10^{-16} \\times 0.38}{10^{-8}} \\approx O(10^{-9})$。\n对于这两个函数，当 $h=10^{-8}$ 时，舍入误差显然占主导地位。\n因此，该比率可由舍入误差的比率来近似：\n$$\nR(\\pi/8, 10^{-8}) \\approx \\frac{E_{100, RO}}{E_{1, RO}} \\approx \\frac{\\epsilon_m |\\sin(100\\pi/8)|/h}{\\epsilon_m |\\sin(\\pi/8)|/h} = \\frac{|\\sin(25\\pi/2)|}{|\\sin(\\pi/8)|} = \\frac{1}{\\sin(\\pi/8)} \\approx 2.613\n$$\n下面的代码使用标准的双精度浮点运算，对每个测试用例直接计算误差 $E_1(x,h)$ 和 $E_{100}(x,h)$ 以及它们的比率 $R(x,h)$。结果将反映上述理论考量。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Analyzes and compares the numerical error of a finite difference\n    derivative approximation for two sinusoidal functions.\n    \"\"\"\n\n    # Define the two functions as per the problem statement.\n    # f_k(x) = sin(k*x)\n    def f1(x):\n        return np.sin(x)\n\n    def f100(x):\n        return np.sin(100 * x)\n\n    # Define the exact derivatives.\n    # f_k'(x) = k*cos(k*x)\n    def df1_exact(x):\n        return np.cos(x)\n\n    def df100_exact(x):\n        return 100 * np.cos(100 * x)\n\n    # Define the centered finite difference formula.\n    def centered_difference(f, x, h):\n        \"\"\"\n        Computes the numerical derivative of function f at point x with step size h.\n        \"\"\"\n        return (f(x + h) - f(x - h)) / (2 * h)\n\n    # List of test cases (x, h)\n    test_cases = [\n        (0.0, 1e-1),\n        (0.0, 1e-6),\n        (1.0, 1e-3),\n        (np.pi / 3, 1e-5),\n        (2.0, 1e-4),\n        (np.pi / 8, 1e-8),\n    ]\n\n    results = []\n    for x, h in test_cases:\n        # Compute numerical derivatives\n        d1_num = centered_difference(f1, x, h)\n        d100_num = centered_difference(f100, x, h)\n\n        # Compute exact derivatives\n        d1_true = df1_exact(x)\n        d100_true = df100_exact(x)\n        \n        # Compute absolute errors for each function\n        E1 = np.abs(d1_num - d1_true)\n        E100 = np.abs(d100_num - d100_true)\n\n        # Check for division by zero, although analysis suggests it won't occur.\n        if E1 == 0.0:\n            # If E1 is zero, the ratio is ill-defined.\n            # This could happen if the numerical derivative is perfect.\n            # However, with finite h and non-special x, this is unlikely.\n            # If E100 is also zero, ratio is 1, otherwise it is infinity.\n            # We handle this case by appending a placeholder if it ever occurs.\n            if E100 == 0.0:\n                R = 1.0 # Or another sensible value like 0/0 - NaN\n            else:\n                R = np.inf\n        else:\n            # Compute the ratio of the errors\n            R = E100 / E1\n        \n        results.append(R)\n\n    # Format the final output string as a comma-separated list of numbers\n    # rounded to 8 significant digits, enclosed in brackets.\n    output_str = \"[\" + \",\".join(f\"{res:.8g}\" for res in results) + \"]\"\n    \n    # Final print statement in the exact required format.\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "有限差分的经典误差分析依赖于一个核心假设：函数是光滑的（即充分可微），但这在实际应用中并非总是成立。当函数（如 $u(x)=|x|$）在目标点不可微时，基于泰勒级数展开的标准误差分析方法就会失效。这个引人深思的练习  旨在挑战你探索在这种极限情况下会发生什么，分析不同差分格式的行为，并思考如何运用单侧导数和次梯度等替代框架来理解计算结果。",
            "id": "3124978",
            "problem": "在通过有限差分（FD）方法近似导数的研究中，经典的截断误差分析依赖于泰勒展开，这需要假设目标函数在相关点上是可微的。考虑函数 $u(x)=|x|$ 在点 $x=0$ 处，并设网格间距为 $h0$。在 $x=0$ 处，函数 $u$ 是连续和凸的，但不可微，因此，那些用于证明截断误差衰减的、基于可微性的常规假设先验地不成立。仅使用导数作为差商极限的基本定义以及单侧导数的定义，推断当 $h\\to 0^+$ 时，函数 $u$ 在 $x=0$ 处的常用有限差分近似（前向、后向和中心）的行为，并判断在这些条件下截断误差是否会衰减。然后，考虑受凸分析和平滑化启发的补救措施，以恢复有意义的极限行为。\n\n以下哪些陈述是正确的？选择所有适用项。\n\nA. 对于 $h0$，在 $x=0$ 处的前向差分对所有 $h$ 都等于 $1$，并且收敛于右导数 $u'_+(0)=1$；近似 $u'_+(0)$ 的截断误差对于所有足够小的 $h$ 均为 $0$。\n\nB. $x=0$ 处的中心差分当 $h\\to 0^+$ 时收敛到 $0$，因此实现了对 $u'(0)$ 的二阶收敛。\n\nC. 因为 $u$ 在 $x=0$ 处不可微，所以相对于 $u'(0)$ 定义的截断误差无法衰减；如果坚持以 $x=0$ 处的某个单一目标导数值为基准，任何对称格式都会产生 $\\mathcal{O}(1)$ 的误差。\n\nD. 一种补救方法是用光滑近似 $u_\\varepsilon(x)=\\sqrt{x^2+\\varepsilon^2}$（其中 $\\varepsilon0$）来替换 $u$，然后计算有限差分近似；在 $x=0$ 处，这些近似收敛到 $0$，该值位于凸次梯度集 $\\partial u(0)=[-1,1]$ 内。\n\nE. 或者，在广义上解释导数：在 $\\partial u(0)=[-1,1]$ 中选择任何数作为 $x=0$ 处的一个有效次梯度；单侧有限差分极限产生 $-1$ 和 $1$，而中心有限差分极限产生 $0$，所有这些都是有效的次梯度。",
            "solution": "问题陈述在数值分析领域提出了一个有效且富有洞察力的问题，特别是关于对于不够光滑的函数，经典有限差分误差分析失效的问题。我们将验证该问题，然后进行全面分析。\n\n### 问题验证\n\n**第 1 步：提取已知条件**\n- 所考虑的函数：$u(x)=|x|$。\n- 关注点：$x=0$。\n- 网格间距：$h0$。\n- $u(x)$ 在 $x=0$ 处的性质：连续、凸，但不可微。\n- 待分析的方法：前向、后向和中心有限差分（FD）近似。\n- 待考虑的极限：$h\\to 0^+$。\n- 任务：分析 FD 格式的行为、在此背景下的截断误差概念以及潜在的补救措施。\n\n**第 2 步：使用已知条件进行验证**\n- **科学依据：** 该问题使用了微积分和数值分析中的标准定义，包括函数 $u(x)=|x|$（一个不可微函数的典型例子）、有限差分商、单侧导数以及来自凸分析的次梯度概念。所有概念都是公认的且在数学上是严谨的。\n- **适定性：** 问题陈述清晰。它要求分析定义明确的数学表达式（FD 商）的极限，并对结果进行解释。该问题的结构旨在引导学生从经典方法的失败走向更高级、更广义的概念。\n- **客观性：** 语言正式而精确。所涉及的数学对象的定义中没有主观性或模糊性。\n- **完整性与一致性：** 提供了所有必要的信息。函数、点、方法和极限过程都已明确定义。没有内部矛盾。\n\n**第 3 步：结论与行动**\n该问题是有效的。这是一个标准且在概念上很重要的练习，有助于理解数值方法所依赖的假设。我们将继续进行完整的推导和选项评估。\n\n### 推导与分析\n\n设函数为 $u(x) = |x|$。我们关心它在 $x=0$ 处的行为。我们注意到 $u(0)=0$。对于任意网格间距 $h0$，我们有 $u(h) = |h| = h$ 和 $u(-h) = |-h| = h$。\n\n**1. 单侧导数**\n$x=0$ 处的右导数定义为：\n$$ u'_+(0) = \\lim_{h\\to 0^+} \\frac{u(0+h) - u(0)}{h} = \\lim_{h\\to 0^+} \\frac{h-0}{h} = \\lim_{h\\to 0^+} 1 = 1 $$\n$x=0$ 处的左导数定义为：\n$$ u'_-(0) = \\lim_{h\\to 0^-} \\frac{u(0+h) - u(0)}{h} = \\lim_{h\\to 0^+} \\frac{u(0-h) - u(0)}{-h} = \\lim_{h\\to 0^+} \\frac{h-0}{-h} = \\lim_{h\\to 0^+} (-1) = -1 $$\n由于 $u'_+(0) \\neq u'_-(0)$，导数 $u'(0)$ 不存在。\n\n**2. $x=0$ 处的有限差分近似**\n对于任意 $h0$：\n- **前向差分：**\n$$ D_+ u(0) = \\frac{u(0+h) - u(0)}{h} = \\frac{u(h) - 0}{h} = \\frac{h}{h} = 1 $$\n当 $h\\to 0^+$ 时的极限是 $\\lim_{h\\to 0^+} D_+ u(0) = 1$，这等于右导数 $u'_+(0)$。\n\n- **后向差分：**\n$$ D_- u(0) = \\frac{u(0) - u(0-h)}{h} = \\frac{0 - u(-h)}{h} = \\frac{-h}{h} = -1 $$\n当 $h\\to 0^+$ 时的极限是 $\\lim_{h\\to 0^+} D_- u(0) = -1$，这等于左导数 $u'_-(0)$。\n\n- **中心差分：**\n$$ D_0 u(0) = \\frac{u(0+h) - u(0-h)}{2h} = \\frac{u(h) - u(-h)}{2h} = \\frac{h - h}{2h} = \\frac{0}{2h} = 0 $$\n当 $h\\to 0^+$ 时的极限是 $\\lim_{h\\to 0^+} D_0 u(0) = 0$。\n\n**3. 广义概念（凸分析）**\n- **次梯度：** 对于一个凸函数 $u$，在点 $x_0$ 处的次梯度，记作 $\\partial u(x_0)$，是所有穿过点 $(x_0, u(x_0))$ 且位于或低于函数 $u$ 图像的直线的斜率 $g$ 的集合。也就是说，如果对于所有 $x$ 都有 $u(x) \\ge u(x_0) + g(x - x_0)$，则 $g \\in \\partial u(x_0)$。对于 $u(x)=|x|$ 在 $x_0=0$ 处，该条件变为 $|x| \\ge 0 + g(x-0)$，即 $|x| \\ge gx$。这个不等式必须对所有 $x$ 都成立。\n    - 如果 $x>0$, $x \\ge gx \\implies 1 \\ge g$。\n    - 如果 $x0$, $-x \\ge gx \\implies -1 \\le g$。\n    - 为使 $g$ 同时满足这两个条件，我们必须有 $-1 \\le g \\le 1$。因此，次梯度是闭区间 $\\partial u(0) = [-1, 1]$。\n\n- **平滑化（正则化）：** 我们可以用一个光滑函数 $u_\\varepsilon(x) = \\sqrt{x^2 + \\varepsilon^2}$（对于某个小的 $\\varepsilon  0$）来近似 $u(x)=|x|$。该函数的导数是：\n$$ u'_\\varepsilon(x) = \\frac{d}{dx} (x^2 + \\varepsilon^2)^{1/2} = \\frac{1}{2}(x^2 + \\varepsilon^2)^{-1/2} (2x) = \\frac{x}{\\sqrt{x^2 + \\varepsilon^2}} $$\n在 $x=0$ 处，导数为 $u'_\\varepsilon(0) = \\frac{0}{\\sqrt{0 + \\varepsilon^2}} = 0$。由于 $u_\\varepsilon(x)$ 是光滑的，任何用于 $u'_\\varepsilon(0)$ 的相容有限差分近似都将在 $h\\to 0$ 时收敛到 $0$。\n\n### 选项评估\n\n**A. 对于 $h0$，在 $x=0$ 处的前向差分对所有 $h$ 都等于 $1$，并且收敛于右导数 $u'_+(0)=1$；近似 $u'_+(0)$ 的截断误差对于所有足够小的 $h$ 均为 $0$。**\n我们的计算表明，对于任何 $h0$, $D_+ u(0) = 1$。因此，当 $h\\to 0^+$ 时的极限为 $1$，这确实是右导数 $u'_+(0)$。截断误差，当相对于特定目标值定义时，是目标值减去近似值。如果目标值被指定为右导数 $u'_+(0)=1$，那么截断误差为 $T_+ = u'_+(0) - D_+ u(0) = 1 - 1 = 0$。这对所有 $h0$ 都成立，从而不言自明地满足了“对于所有足够小的 $h$”这一条件。该陈述完全正确。\n**结论：正确。**\n\n**B. $x=0$ 处的中心差分当 $h\\to 0^+$ 时收敛到 $0$，因此实现了对 $u'(0)$ 的二阶收敛。**\n我们的计算表明，对于所有 $h0$，$D_0 u(0) = 0$，其极限确实是 $0$。然而，该陈述的第二部分存在致命缺陷。导数 $u'(0)$ 不存在。谈论向一个不存在的量收敛是一个逻辑矛盾。此外，“二阶收敛”意味着误差 $E(h)$ 的行为如同 $E(h) = \\mathcal{O}(h^2)$。误差的概念需要一个明确定义的“精确”值，在此情境下即为 $u'(0)$。由于 $u'(0)$ 未定义，截断误差及其收敛阶数的经典定义不适用。该陈述提出了一个没有依据且在形式上不正确的论断。\n**结论：不正确。**\n\n**C. 因为 $u$ 在 $x=0$ 处不可微，所以相对于 $u'(0)$ 定义的截断误差无法衰减；如果坚持以 $x=0$ 处的某个单一目标导数值为基准，任何对称格式都会产生 $\\mathcal{O}(1)$ 的误差。**\n第一个分句是正确的：定义为 $u'(0) - (\\text{近似值})$ 的截断误差没有明确定义，因为 $u'(0)$ 不存在。第二个分句阐述了实际后果。让我们考虑一个对称格式，例如中心差分 $D_0 u(0) = 0$。如果有人“坚持以某个单一目标导数值为基准”，他可能会选择一个单侧导数，例如 $u'_+(0)=1$。那么误差将是 $1 - D_0 u(0) = 1 - 0 = 1$。这个误差是一个常数，与 $h$ 无关，因此是 $\\mathcal{O}(1)$ 阶的；它不会随着 $h\\to 0^+$ 而衰减。如果选择 $u'_-(0)=-1$ 作为目标，情况也是如此。该陈述正确地抓住了这样一个事实：对于偶函数，对称格式会得出一个值（$0$），这个值与非零的单侧导数在根本上不匹配，从而导致一个不会消失的 $\\mathcal{O}(1)$ 误差。\n**结论：正确。**\n\n**D. 一种补救方法是用光滑近似 $u_\\varepsilon(x)=\\sqrt{x^2+\\varepsilon^2}$（其中 $\\varepsilon0$）来替换 $u$，然后计算有限差分近似；在 $x=0$ 处，这些近似收敛到 $0$，该值位于凸次梯度集 $\\partial u(0)=[-1,1]$ 内。**\n该陈述描述了一种标准的正则化技术。如上所述，函数 $u_\\varepsilon(x)=\\sqrt{x^2+\\varepsilon^2}$ 是 $|x|$ 的一个光滑近似。它在 $x=0$ 处的导数是 $u'_\\varepsilon(0)=0$。对于光滑函数，任何相容的有限差分格式都将收敛到真实导数。因此，对于固定的 $\\varepsilon$，$u_\\varepsilon$ 在 $x=0$ 处的有限差分近似将在 $h\\to 0$ 时收敛到 $0$。我们还推导出 $u(x)=|x|$ 在 $x=0$ 处的次梯度是 $\\partial u(0)=[-1,1]$。数值 $0$ 确实是这个集合中的一个元素。该陈述是对一种有效的分析和计算补救措施的正确描述。\n**结论：正确。**\n\n**E. 或者，在广义上解释导数：在 $\\partial u(0)=[-1,1]$ 中选择任何数作为 $x=0$ 处的一个有效次梯度；单侧有限差分极限产生 $-1$ 和 $1$，而中心有限差分极限产生 $0$，所有这些都是有效的次梯度。**\n该陈述正确地引入了次梯度作为广义导数的概念。正如我们推导的，对于 $u(x)=|x|$ 在 $x=0$ 处，其次梯度是集合 $\\partial u(0) = [-1,1]$。然后它正确地指出了标准有限差分格式的极限：\n- 后向差分极限：$-1$。这在 $[-1,1]$ 内。\n- 前向差分极限：$1$。这在 $[-1,1]$ 内。\n- 中心差分极限：$0$。这在 $[-1,1]$ 内。\n该陈述对这种情况提供了一个连贯且现代的解释：不同的数值格式可以被看作是“探针”，它们收敛到次梯度集合中不同但同样有效的元素。该陈述完全正确。\n**结论：正确。**",
            "answer": "$$\\boxed{ACDE}$$"
        }
    ]
}