{
    "hands_on_practices": [
        {
            "introduction": "在我们深入探讨浮点数的二进制细节之前，让我们通过一个更直观的例子来热身：舍入到最近的整数。这个练习揭示了一个关于舍入的基本事实——$R(x)+R(y)$ 并不总是等于 $R(x+y)$。这个例子完美地展示了关键的“向偶数舍入”规则是如何在出现平局时发挥作用的。",
            "id": "3642547",
            "problem": "一个处理器流水线在各阶段边界处，使用电气和电子工程师协会 (IEEE) 754 标准中一种称为“向最近舍入，平局时向偶数舍入”的舍入模式，将中间结果舍入为目标格式。考虑舍入到整数集的情况，并令 $R:\\mathbb{R}\\to\\mathbb{Z}$ 表示此舍入函数。该模式的正式定义是：对于任意实数 $x$，$R(x)$ 是在所有整数 $k$ 中使 $|x-k|$ 最小化的整数；如果存在两个使距离最小化的整数（即平局），则选择其中的偶数。\n\n仅使用此定义，计算标量\n$$D \\equiv R(x)+R(y)-R(x+y)$$\n在特定输入 $x=0.5$ 和 $y=0.5$ 下的值。请给出 $D$ 的精确值，形式为一个实数。不要对最终结果进行舍入。",
            "solution": "题目要求计算表达式 $D \\equiv R(x)+R(y)-R(x+y)$ 在特定 $x$ 和 $y$ 值下的值，其中 $R:\\mathbb{R}\\to\\mathbb{Z}$ 是对应 IEEE 754 “向最近舍入，平局时向偶数舍入”模式的舍入函数。\n\n舍入函数 $R(x)$ 的定义如下：对于任意实数 $x$，$R(x)$ 是使距离 $|x-k|$ 最小的整数 $k$。如果出现平局，即存在两个与 $x$ 等距的整数，则选择两者中的偶数。平局当且仅当 $x$ 是一个半整数时发生，即 $x$ 的形式为 $n + 0.5$，其中 $n$ 是某个整数。\n\n给定的特定输入为 $x=0.5$ 和 $y=0.5$。我们必须分别计算表达式 $D$ 中的每一项。\n\n首先，我们计算 $R(x) = R(0.5)$。\n输入为 $x=0.5$。这是一个半整数，因为它恰好位于整数 $0$ 和 $1$ 的正中间。我们计算它到这两个最近整数的距离：\n到 $k=0$ 的距离是 $|0.5 - 0| = 0.5$。\n到 $k=1$ 的距离是 $|0.5 - 1| = |-0.5| = 0.5$。\n由于距离相等，这是一个平局情况。使距离最小化的两个整数是 $0$ 和 $1$。根据“平局时取偶数”的规则，我们必须选择偶数。在 $0$ 和 $1$ 之间，整数 $0$ 是偶数。\n因此，$R(0.5) = 0$。\n\n其次，我们计算 $R(y) = R(0.5)$。\n由于 $y=x=0.5$，计算过程与上面完全相同。\n因此，$R(0.5) = 0$。\n\n第三，我们计算 $R(x+y)$。\n首先，我们计算和 $x+y$：\n$$x+y = 0.5 + 0.5 = 1.0$$\n现在我们需要计算 $R(1.0)$。输入是整数 $1$。我们寻找使距离 $|1.0 - k|$ 最小的整数 $k$。\n如果我们选择 $k=1$，距离是 $|1.0 - 1| = 0$。\n对于任何其他整数 $k \\neq 1$，距离 $|1.0 - k|$ 将是一个正整数，严格大于 $0$。例如，对于 $k=0$，距离是 $|1.0 - 0|=1$；对于 $k=2$，距离是 $|1.0 - 2|=1$。\n因此，存在唯一的整数 $k=1$ 使距离最小化。不存在平局情况。\n因此，$R(1.0) = 1$。\n\n最后，我们将这些结果代入 $D$ 的表达式中：\n$$D = R(x) + R(y) - R(x+y)$$\n$$D = R(0.5) + R(0.5) - R(1.0)$$\n$$D = 0 + 0 - 1$$\n$$D = -1$$\n\n标量 $D$ 的精确值是 $-1$。",
            "answer": "$$\\boxed{-1}$$"
        },
        {
            "introduction": "现在，让我们将这些舍入原则应用于标准的 IEEE 754 单精度格式。这个问题要求你计算一个简单加法的结果，其精确和恰好落在两个可表示的浮点数之间。通过对四种标准舍入模式的计算，你将具体理解处理器的浮点单元是如何做出决策的，这对于掌握浮点运算的底层机制至关重要。",
            "id": "3642267",
            "problem": "考虑一个符合电气和电子工程师协会 (IEEE) $754$ 浮点算术标准，并使用单精度二进制格式 (binary $32$) 的系统。一个规格化的 binary $32$ 浮点数由一个符号位、一个偏置值为 $127$ 的 $8$ 位指数场，以及一个构成形式为 $(1.f)$ 的有效数的 $23$ 位小数字段表示，其中 $f$ 是一个 $23$ 位的二进制小数串。在区间 $[1,2)$ 内，连续的可表示数之间的差值为小数部分的最后一位单位。\n\n设 $x=1.0$ 且 $y=2^{-25}$。假设计算出精确的实数值和 $x+y$，然后根据四种 IEEE $754$ 舍入模式中的每一种，将其舍入一次至最接近的可表示 binary $32$ 数：向最近舍入，偶数优先 ($\\text{RN}$)，向零舍入 ($\\text{RZ}$)，向正无穷舍入 ($\\text{RU}$)，以及向负无穷舍入 ($\\text{RD}$)。\n\n仅使用二进制规格化有效数的基本定义以及四种舍入模式的语义，确定 $x+y$ 在 $\\text{RN}$、$\\text{RZ}$、$\\text{RU}$ 和 $\\text{RD}$ 模式下舍入到 binary $32$ 格式的结果。将您的最终答案表示为一个行矩阵，顺序为 $\\text{RN}$、$\\text{RZ}$、$\\text{RU}$、$\\text{RD}$。不需要数值近似；请提供精确值。",
            "solution": "该问题要求在四种指定的舍入模式下，确定两个数 $x=1.0$ 和 $y=2^{-25}$ 的和在 IEEE $754$ 单精度 (binary$32$) 格式下舍入后的结果。\n\n首先，我们必须验证问题陈述。\n\n### 步骤 1：提取已知条件\n- 系统：IEEE $754$ 标准，单精度二进制格式 (binary$32$)。\n- 规格化的 binary$32$ 数表示法：\n  - $1$个符号位。\n  - $8$位指数场，偏置值为 $127$。\n  - $23$位小数字段，记为 $f$。\n- 规格化数的有效数形式：$(1.f)_2$。\n- 在区间 $[1,2)$ 内，连续可表示数之间的差值为小数部分的最后一位单位 (ULP)。\n- 给定值：$x=1.0$ 和 $y=2^{-25}$。\n- 任务：计算精确和 $z=x+y$，并根据四种舍入模式将其舍入到最接近的可表示 binary$32$ 数：\n  - $\\text{RN}$：向最近舍入，偶数优先。\n  - $\\text{RZ}$：向零舍入。\n  - $\\text{RU}$：向正无穷舍入。\n  - $\\text{RD}$：向负无穷舍入。\n- 输出格式：一个行矩阵，按 $\\text{RN}$、$\\text{RZ}$、$\\text{RU}$、$\\text{RD}$ 的顺序包含四个结果。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据，因为它基于定义明确的 IEEE $754$ 浮点算术标准，这是计算机体系结构和数值分析中的一个基本主题。语言精确客观。所有必要信息（数字格式、偏置值、数值、舍入模式）均已提供，使得问题是适定且自洽的。不存在矛盾、歧义或不科学的前提。该问题测试了浮点算术的一个核心概念，并非微不足道。\n\n### 步骤 3：结论与行动\n问题有效。将提供完整解答。\n\n### 解题推导\n\n解题过程首先计算精确的实数值和，然后确定它与最接近的可表示 binary$32$ 浮点数的关系。\n\n1.  **分析输入及其精确和。**\n    给定值为 $x=1.0$ 和 $y=2^{-25}$。\n    数 $x=1.0$ 是一个在 binary$32$ 格式下可以精确表示的数。其表示法如下：\n    - 符号位：$0$ (正数)。\n    - 无偏指数：$0$，因为 $1.0 = (1.0)_2 \\times 2^0$。\n    - 有偏指数：$E = 0 + 127 = 127$。\n    - 小数部分：$f = 0$，因为有效数是 $(1.0)_2$。\n\n    精确的实数值和为 $z = x+y = 1.0 + 2^{-25}$。\n\n2.  **确定包围该和的可表示数。**\n    和 $z$ 的值位于区间 $[1,2)$ 内。对于此区间内的任何值 $v$，其规格化的 binary$32$ 表示形式为 $v = (-1)^S \\times (1.f)_2 \\times 2^0$，其中 $f$ 是 $23$ 位的小数部分。在此范围内，最后一位的单位 (ULP) 是小数部分的最低有效位的值，即 $2^{-23}$。\n    在此范围内，连续的可表示数相差 $2^{-23}$。\n\n    精确和为 $z = 1.0 + 2^{-25}$。这个值不能被精确表示，因为其小数部分 $2^{-25}$ 在二进制小数点后需要超过23位的精度。我们需要找到包围 $z$ 的两个可表示数。\n\n    设 $N_1$ 是小于或等于 $z$ 的最大可表示数。这个数可以通过将 $z$ 的二进制表示截断到23位小数位来获得。\n    $z = 1.0 + 2^{-25} = (1.\\underbrace{00\\dots0}_{24}1)_2 \\times 2^0$。\n    在第 $23$ 个小数位后截断，得到有效数 $(1.\\underbrace{00\\dots0}_{23})_2$。\n    因此，$N_1 = (1.0)_2 \\times 2^0 = 1.0$。\n\n    设 $N_2$ 是大于或等于 $z$ 的最小可表示数。这是 $N_1$ 之后的下一个可表示数。\n    $N_2 = N_1 + \\text{ULP} = 1.0 + 2^{-23}$。\n\n    我们可以确认 $N_1  z  N_2$：\n    $1.0  1.0 + 2^{-25}  1.0 + 2^{-23}$，因为 $0  2^{-25}  2^{-23}$。\n\n3.  **应用舍入模式。**\n    舍入的选择取决于具体的模式，对于 $\\text{RN}$ 模式，还取决于 $z$ 相对于区间 $[N_1, N_2]$ 中点 $M$ 的位置。\n    中点为 $M = \\frac{N_1 + N_2}{2} = \\frac{1.0 + (1.0 + 2^{-23})}{2} = 1.0 + \\frac{2^{-23}}{2} = 1.0 + 2^{-24}$。\n\n    - **向最近舍入，偶数优先 ($\\text{RN}$):**\n      我们将 $z$ 与中点 $M$ 进行比较。\n      $z = 1.0 + 2^{-25}$\n      $M = 1.0 + 2^{-24}$\n      由于 $2^{-25}  2^{-24}$，我们有 $z  M$。这意味着 $z$ 更接近 $N_1$ 而不是 $N_2$。不存在相等的情况。规则要求舍入到最接近的可表示数，即 $N_1$。\n      $\\text{RN}$ 的结果：$1.0$。\n\n    - **向零舍入 ($\\text{RZ}$):**\n      此模式将值向 $0$ 截断。对于像 $z$ 这样的正数，这意味着向下舍入到小于或等于 $z$ 的最大可表示数。即 $N_1$。\n      $\\text{RZ}$ 的结果：$1.0$。\n\n    - **向正无穷舍入 ($\\text{RU}$):**\n      此模式将值向上舍入到大于或等于 $z$ 的最小可表示数。由于 $z$ 不能被精确表示，这个数就是 $N_2$。\n      $\\text{RU}$ 的结果：$1.0 + 2^{-23}$。\n\n    - **向负无穷舍入 ($\\text{RD}$):**\n      此模式将值向下舍入到小于或等于 $z$ 的最大可表示数。对于任何数，这都对应于 $N_1$。\n      $\\text{RD}$ 的结果：$1.0$。\n\n4.  **最终结果。**\n    在四种指定的舍入模式下，和 $x+y$ 的舍入结果如下：\n    - $\\text{RN}(x+y) = 1.0$\n    - $\\text{RZ}(x+y) = 1.0$\n    - $\\text{RU}(x+y) = 1.0 + 2^{-23}$\n    - $\\text{RD}(x+y) = 1.0$",
            "answer": "$$\\boxed{\\begin{pmatrix} 1.0  1.0  1.0 + 2^{-23}  1.0 \\end{pmatrix}}$$"
        },
        {
            "introduction": "浮点运算常常不符合我们在学校学到的简洁代数规则。这个实践问题展示了一个经典的陷阱：一个看似可逆的操作序列，如 $y+2^{-24}-2^{-24}$，却没有返回初始值 $y$。这种由中间步骤的舍入引起的现象，为任何程序员提供了关于浮点数直接相等性测试危险性的重要一课，有助于编写更稳健的数值代码。",
            "id": "3642467",
            "problem": "某个处理器实现了电气和电子工程师协会 (IEEE) 754 标准的 binary32 (单精度) 浮点格式。在 binary32 格式中，一个规格化的浮点数其有效数（significand）包含 $23$ 个显式存储的小数位和一个隐藏的前导 $1$，从而提供了 $p=24$ 位的精度。算术运算会产生一个实数结果，该结果在存回为 binary32 格式之前，会根据当前有效的舍入模式进行舍入。可用的舍入模式包括向最近舍入（偶数优先）、朝向 $+\\infty$ 舍入、朝向 $-\\infty$ 舍入以及朝向 $0$ 舍入。在给定数量级上，最后一位的单位 (ULP) 是该数量级上相邻可表示规格化数之间的间距。\n\n一个程序首先使用向最近舍入（偶数优先）模式，计算精确实数 $1$ 的 binary32 表示，并将其存储在变量 $y$ 中。之后，由于一次运行时变更，所有后续浮点运算的舍入模式被设置为朝向 $+\\infty$ 舍入。在这个变更后的环境中，程序在 binary32 精度下执行了两个连续的操作：\n$$\nt \\leftarrow y + 2^{-24}, \\quad x \\leftarrow t - 2^{-24},\n$$\n其中每个运算的结果在被下一步使用之前，都根据朝向 $+\\infty$ 舍入模式在 binary32 精度下进行了舍入。在计算出 $x$ 之后，程序会基于等式 $x==y$ 进行分支判断。\n\n请仅使用 IEEE 754 二进制浮点表示的核心定义、精度 $p$ 以及舍入模式的语义，推导出 $x - y$ 的精确值的单个封闭形式表达式。请以 $2$ 的幂的精确形式给出最终答案。最终答案无需进行舍入。",
            "solution": "本题将根据 IEEE 754 标准的 binary32 格式以及指定的舍入模式，通过对浮点运算进行分步分析来求解。\n\n首先，我们确定变量 $y$ 的值。题目说明 $y$ 是精确实数 $1$ 的 binary32 表示。数字 $1$ 在 binary32 格式中是精确可表示的。其二进制科学记数法表示为 $1.0 \\times 2^0$。对于 binary32 格式（单精度），有效数的精度为 $p=24$ 位（$1$ 个隐藏的前导位和 $23$ 个显式的小数位）。值 $1$ 的表示方式是，有效数为 $(1.00...0)_2$（小数点后有 $23$ 个零），指数为 $0$。由于该值是精确的，无需进行舍入。因此，$y$ 的值精确为：\n$$y = 1$$\n\n接下来，舍入模式更改为朝向 $+\\infty$ 舍入。我们分析第一个计算：\n$$t \\leftarrow y + 2^{-24}$$\n该加法运算的精确实数值是：\n$$R_t = y + 2^{-24} = 1 + 2^{-24}$$\n这个结果必须经过舍入才能适应 binary32 格式。在范围 $[1, 2)$ 内的规格化 binary32 数的形式为 $(1.f_{1}f_{2}...f_{23})_2 \\times 2^0$。两个这样的数之间的最小增量由小数部分的最后一位 $f_{23}$ 决定，其对应的值为 $2^{-23}$。这便是该范围内数值的最后一位单位 (ULP)。\n让我们找出将精确结果 $R_t$ 夹在中间的两个可表示的 binary32 数。\n数字 $1$ 是可表示的：$N_1 = 1 = (1.00...0)_2 \\times 2^0$。下一个更大的可表示数是 $N_2 = 1 + 2^{-23} = (1.00...1)_2 \\times 2^0$，其中小数部分的最后一位是 $1$。\n\n精确结果 $R_t = 1 + 2^{-24}$ 位于这两个可表示数之间。我们可以确定它相对于这两个数的位置。$N_1$ 和 $N_2$ 之间的中点是：\n$$\\frac{N_1 + N_2}{2} = \\frac{1 + (1 + 2^{-23})}{2} = \\frac{2 + 2^{-23}}{2} = 1 + 2^{-24}$$\n因此，精确结果 $R_t$ 正好是两个连续可表示数的中点。\n\n当前有效的舍入模式是朝向 $+\\infty$ 舍入。该模式规定，任何不能精确表示的结果都必须舍入到大于或等于该精确结果的最小可表示数。由于 $R_t = 1 + 2^{-24}$ 是不可表示的，它必须向上舍入到下一个可表示值，即 $N_2$。\n因此，存储在变量 $t$ 中的值是：\n$$t = 1 + 2^{-23}$$\n\n现在，我们分析第二个计算：\n$$x \\leftarrow t - 2^{-24}$$\n舍入模式仍然是朝向 $+\\infty$ 舍入。我们首先使用刚确定的 $t$ 值，来计算这个减法运算的精确实数值：\n$$R_x = t - 2^{-24} = (1 + 2^{-23}) - 2^{-24}$$\n为了简化这个表达式，我们可以将 $2^{-23}$ 写成 $2 \\times 2^{-24}$：\n$$R_x = 1 + (2 \\times 2^{-24}) - 2^{-24} = 1 + (2-1) \\times 2^{-24} = 1 + 2^{-24}$$\n精确结果 $R_x$ 与上一步的精确结果 $R_t$ 相同。它是可表示数 $1$ 和 $1 + 2^{-23}$ 之间的中点。\n\n我们必须使用朝向 $+\\infty$ 舍入模式来对 $R_x$ 进行舍入。和之前一样，结果被向上舍入到大于或等于 $R_x$ 的最小可表示数。\n因此，存储在变量 $x$ 中的值是：\n$$x = 1 + 2^{-23}$$\n\n最后，题目要求计算差值 $x-y$ 的精确值。使用我们已经推导出的 $x$ 和 $y$ 的值：\n$$x - y = (1 + 2^{-23}) - 1 = 2^{-23}$$\n这个结果是由 $x$ 和 $y$ 的数学值推导出来的，而不是一次浮点减法运算。结果是一个精确的 $2$ 的幂。",
            "answer": "$$\\boxed{2^{-23}}$$"
        }
    ]
}