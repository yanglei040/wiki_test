{
    "hands_on_practices": [
        {
            "introduction": "While a two-flip-flop synchronizer can reliably capture a single asynchronous bit, applying this technique naively to a multi-bit data bus can lead to catastrophic system failures. This exercise demonstrates how independent metastability events across parallel synchronizers can cause variable latencies, leading the system to temporarily observe \"phantom\" data words that are neither the original nor the new value. By constructing a counterexample and deriving the probability of a coherent data transfer, you will gain a fundamental understanding of the data incoherence problem in Clock Domain Crossing (CDC) design .",
            "id": "3658817",
            "problem": "Consider an asynchronous clock-domain crossing in a computer system where a producer in one clock domain updates an $N$-bit data bus synchronously to a new word, and a consumer in another clock domain samples that bus through a per-bit two-stage synchronizer composed of two cascaded Data Flip-Flops (DFFs). There is no handshake, strobe, or encoded protection; the consumer simply samples the outputs of the $N$ independent synchronizers each cycle. Suppose the producer updates the bus from an old word to a new word at a particular edge in the producer’s clock domain such that every one of the $N$ bits transitions (i.e., all $N$ bits change simultaneously at the source). Each bit’s synchronizer exhibits variable latency due to metastability: conditioned on the update occurring close to a consumer sampling edge, a given bit appears at the consumer after one consumer cycle with probability $p$, and after two consumer cycles with probability $1-p$. Assume the latency outcomes across different bits are independent and identically distributed.\n\nTask:\n1. Using only the definitions of metastability in bistable storage elements and the role of two-stage synchronizers in mitigating metastability, construct a concrete counterexample for $N=2$ that demonstrates the consumer can momentarily observe a word that is not equal to either the old word or the new word. Your construction must specify old and new two-bit words and explain how independence of per-bit synchronizer latency can yield a mixed word at the consumer.\n2. Under the same independence model, derive from first principles an analytic expression, as a function of $p$ and $N$, for the probability that the word observed by the consumer at a given sampling epoch is coherent, meaning that all $N$ bits sampled at that epoch are from the same source cycle (either all old or all new). Express your final answer as a single closed-form expression in terms of $p$ and $N$.\n\nNo numerical approximation is required; provide the exact expression. The final answer must be a single analytical expression.",
            "solution": "This problem examines the potential for data-bus incoherence during an asynchronous clock-domain crossing and asks for a quantitative analysis of this effect. The problem statement is valid. It is scientifically grounded in the well-understood phenomenon of metastability in digital circuits, it is well-posed with all necessary parameters and definitions provided, and it is free of contradictions or ambiguities. The model, while a simplification of a complex physical process, is a standard and effective abstraction for analyzing the architectural consequences of synchronizer behavior. We proceed with the two parts of the task.\n\n**Part 1: Counterexample for $N=2$**\n\nThe task is to construct a scenario with a $N=2$ bit bus where the consumer momentarily observes a word that is neither the original (old) word nor the final (new) word.\n\nLet the two bits of the data bus be $B_1$ and $B_0$. The problem states that all bits transition. We can choose the old word to be $W_{\\text{old}} = 01_2$ and the new word to be $W_{\\text{new}} = 10_2$. For this choice, $W_{\\text{old}}$ corresponds to the bit vector $(B_1, B_0) = (0, 1)$ and $W_{\\text{new}}$ corresponds to $(B_1, B_0) = (1, 0)$. Both bits flip, as required.\n\nThe producer updates the bus from $W_{\\text{old}}$ to $W_{\\text{new}}$ at a time that is asynchronous to the consumer's clock. Each bit is passed through an independent two-stage synchronizer. Due to the potential for metastability, the latency for the new value of each bit to appear at the consumer is variable. According to the model provided, for each bit $i \\in \\{0, 1\\}$, its new value is observed by the consumer after $1$ consumer clock cycle with probability $p$, and after $2$ consumer clock cycles with probability $1-p$.\n\nWe analyze the word observed by the consumer at the first sampling epoch following the producer's update. At this instant, a bit $B_i$ will have its new value if its synchronizer had a $1$-cycle latency, or it will retain its old value if its synchronizer has a $2$-cycle latency.\n\nLet's consider a specific outcome for the latencies of the two bits, which are independent events. Suppose the synchronizer for bit $B_1$ has a $1$-cycle latency, and the synchronizer for bit $B_0$ has a $2$-cycle latency.\n\\begin{itemize}\n    \\item For bit $B_1$, a $1$-cycle latency means the consumer samples the new value, $B_{1, \\text{new}} = 1$.\n    \\item For bit $B_0$, a $2$-cycle latency means the consumer samples the old value, $B_{0, \\text{old}} = 1$.\n\\end{itemize}\nIn this case, the composite word observed by the consumer is $(B_1, B_0) = (1, 1)$, or $11_2$. This observed word, $11_2$, is not equal to the old word, $W_{\\text{old}} = 01_2$, nor is it equal to the new word, $W_{\\text{new}} = 10_2$. This constitutes the required counterexample.\n\nThis event occurs with a probability given by the product of the independent probabilities for each bit's latency: $P(B_1 \\text{ has } 1\\text{-cycle latency}) \\times P(B_0 \\text{ has } 2\\text{-cycle latency}) = p \\times (1-p)$. Because $p$ is a probability associated with metastability resolution, it is typically in the range $0 < p < 1$, so this outcome has a non-zero probability of occurring. This transient, invalid word is a direct consequence of the independent, variable latencies of the per-bit synchronizers.\n\n**Part 2: Derivation of Coherency Probability**\n\nThe task is to derive an expression for the probability that the word observed by the consumer is coherent. A coherent word is defined as one where all $N$ bits are from the same source cycle, meaning the observed word is either the complete old word or the complete new word. This analysis focuses on the first consumer sampling epoch after the producer's update, as this is the only time when incoherence is possible under the given model. At all later epochs, all bits will have stabilized to their new values.\n\nLet's consider the state of the $N$ bits at this critical sampling epoch. For each bit $i \\in \\{1, 2, \\ldots, N\\}$, there are two possible outcomes based on its synchronizer's latency:\n\\begin{enumerate}\n    \\item The synchronizer has a $1$-cycle latency: The consumer samples the bit's *new* value. This occurs with probability $p$.\n    \\item The synchronizer has a $2$-cycle latency: The consumer samples the bit's *old* value. This occurs with probability $1-p$.\n\\end{enumerate}\n\nThe latency outcomes for all $N$ bits are independent and identically distributed. The observed $N$-bit word is coherent if one of two mutually exclusive events occurs:\n\n**Event A: All bits have transitioned to their new values.**\nThis means that for every bit $i=1, \\ldots, N$, the synchronizer had a $1$-cycle latency. Since the events are independent, the probability of this is the product of the individual probabilities for each bit:\n$$P(\\text{all bits are new}) = \\prod_{i=1}^{N} P(\\text{bit } i \\text{ is new}) = \\prod_{i=1}^{N} p = p^N$$\nIn this case, the consumer observes the complete new word, $W_{\\text{new}}$.\n\n**Event B: All bits remain at their old values.**\nThis means that for every bit $i=1, \\ldots, N$, the synchronizer had a $2$-cycle latency. The probability of this, again leveraging independence, is the product of the individual probabilities:\n$$P(\\text{all bits are old}) = \\prod_{i=1}^{N} P(\\text{bit } i \\text{ is old}) = \\prod_{i=1}^{N} (1-p) = (1-p)^N$$\nIn this case, the consumer observes the complete old word, $W_{\\text{old}}$.\n\nThe total probability of observing a coherent word, $P(\\text{coherent})$, is the sum of the probabilities of these two mutually exclusive events.\n$$P(\\text{coherent}) = P(\\text{all bits are new}) + P(\\text{all bits are old})$$\nSubstituting the expressions derived above, we get:\n$$P(\\text{coherent}) = p^N + (1-p)^N$$\nThis is the closed-form analytical expression for the probability that the sampled word is coherent as a function of $p$ and $N$. This can also be viewed from the perspective of a binomial distribution. Let $K$ be the number of bits that have settled to their new value. Then $K \\sim \\text{Binomial}(N,p)$. The word is coherent if $K=N$ (all new) or $K=0$ (all old). The probability is $P(K=N) + P(K=0) = \\binom{N}{N}p^N(1-p)^0 + \\binom{N}{0}p^0(1-p)^N = p^N + (1-p)^N$, which confirms the result.",
            "answer": "$$\n\\boxed{p^{N} + (1-p)^{N}}\n$$"
        },
        {
            "introduction": "To move from understanding failure modes to designing robust systems, we must quantify reliability. The Mean Time Between Failures (MTBF) provides this metric, and its value is exponentially dependent on the resolution time, $T_{res}$, available for a metastable state to settle. This practice provides essential experience using the standard MTBF formula to calculate the minimum resolution time required to meet a stringent reliability target, such as a multi-year operational lifetime . You will translate a system requirement into a concrete timing parameter, bridging the gap between abstract theory and practical hardware design.",
            "id": "3658898",
            "problem": "A two-flip-flop synchronizer is used to bring an asynchronous signal into a destination clock domain. The synchronizer’s metastability resolving behavior follows a well-tested exponential model characterized by a device-dependent time constant $\\tau$ and a technology-dependent window constant $T_w$ that captures the effective aperture/window and gain factors associated with metastability. The asynchronous data source toggles with average event frequency $f_{data}$, and the destination domain samples at clock frequency $f_{clk}$. The Mean Time Between Failures (MTBF) is defined as the reciprocal of the average failure rate under the assumptions of stationary statistics and independent trials.\n\nGiven the following parameters:\n- Destination sampling frequency $f_{clk} = 1.0 \\times 10^{9}~\\mathrm{Hz}$,\n- Asynchronous data event frequency $f_{data} = 5.0 \\times 10^{7}~\\mathrm{Hz}$,\n- Metastability window constant $T_w = 1.0 \\times 10^{-10}~\\mathrm{s}$,\n- Metastability time constant $\\tau = 15~\\mathrm{ps} = 15 \\times 10^{-12}~\\mathrm{s}$,\n- Target lifetime $Y = 20~\\mathrm{years}$,\n\nuse the standard metastability resolving model and the definition of Mean Time Between Failures to derive the minimum required resolution time $T_{res}$ such that the MTBF is at least $Y$ years, and compute its numerical value. Express your final answer for $T_{res}$ in $\\mathrm{ns}$ and round your answer to four significant figures.\n\nAdditionally, to plan a safety margin, consider an implementation overhead $T_{\\mathrm{ov}} = 0.25~\\mathrm{ns}$ that must be reserved in each clock cycle for combinational delays, clock-to-output delay, routing, and setup time. Explore feasibility at two candidate destination clock periods $T_{clk,1} = 1.0~\\mathrm{ns}$ and $T_{clk,2} = 0.5~\\mathrm{ns}$ by comparing the available resolution time $T_{\\mathrm{avail}} = T_{clk} - T_{\\mathrm{ov}}$ against the required $T_{res}$. State whether each candidate clock period can meet the MTBF requirement. The feasibility discussion does not alter the requested final numerical answer for $T_{res}$.",
            "solution": "The problem statement has been validated and is deemed valid. It is scientifically grounded, well-posed, and objective, providing all necessary parameters to solve for the required resolution time and assess feasibility under given constraints. The model for Mean Time Between Failures (MTBF) is a standard exponential model used in digital electronics to characterize the reliability of synchronizers.\n\nThe MTBF of a two-flip-flop synchronizer is given by the formula:\n$$\nMTBF = \\frac{\\exp\\left(\\frac{T_{res}}{\\tau}\\right)}{T_w \\cdot f_{clk} \\cdot f_{data}}\n$$\nwhere:\n- $T_{res}$ is the resolution time allowed for the first flip-flop's output to settle.\n- $\\tau$ is the metastability time constant of the flip-flop.\n- $T_w$ is a technology-dependent constant related to the metastability window.\n- $f_{clk}$ is the sampling clock frequency of the destination domain.\n- $f_{data}$ is the average event frequency of the asynchronous data signal.\n\nThe problem requires that the MTBF be at least the target lifetime $Y$. To find the minimum required resolution time $T_{res}$, we set the MTBF equal to $Y$:\n$$\nY = \\frac{\\exp\\left(\\frac{T_{res}}{\\tau}\\right)}{T_w \\cdot f_{clk} \\cdot f_{data}}\n$$\nWe must first ensure all units are consistent. The target lifetime $Y$ is given in years, while all other parameters are in SI units (seconds, hertz). We convert $Y$ to seconds. Using the standard approximation of $365.25$ days per year to account for leap years:\n$$\n1~\\mathrm{year} = 365.25~\\mathrm{days} \\times 24~\\mathrm{hours/day} \\times 3600~\\mathrm{s/hour} = 31,557,600~\\mathrm{s}\n$$\nThe target lifetime in seconds, which we denote as $Y_{s}$, is:\n$$\nY_{s} = 20~\\mathrm{years} \\times 31,557,600~\\mathrm{s/year} = 631,152,000~\\mathrm{s}\n$$\nNow, we solve the MTBF equation for $T_{res}$:\n$$\n\\exp\\left(\\frac{T_{res}}{\\tau}\\right) = Y_{s} \\cdot T_w \\cdot f_{clk} \\cdot f_{data}\n$$\nTaking the natural logarithm of both sides:\n$$\n\\frac{T_{res}}{\\tau} = \\ln\\left(Y_{s} \\cdot T_w \\cdot f_{clk} \\cdot f_{data}\\right)\n$$\n$$\nT_{res} = \\tau \\cdot \\ln\\left(Y_{s} \\cdot T_w \\cdot f_{clk} \\cdot f_{data}\\right)\n$$\nThe given parameters are:\n- $f_{clk} = 1.0 \\times 10^{9}~\\mathrm{Hz}$\n- $f_{data} = 5.0 \\times 10^{7}~\\mathrm{Hz}$\n- $T_w = 1.0 \\times 10^{-10}~\\mathrm{s}$\n- $\\tau = 15 \\times 10^{-12}~\\mathrm{s}$\n- $Y_{s} = 6.31152 \\times 10^{8}~\\mathrm{s}$\n\nFirst, we compute the argument of the logarithm:\n$$\n\\text{Argument} = Y_{s} \\cdot T_w \\cdot f_{clk} \\cdot f_{data}\n$$\n$$\n\\text{Argument} = (6.31152 \\times 10^{8}~\\mathrm{s}) \\cdot (1.0 \\times 10^{-10}~\\mathrm{s}) \\cdot (1.0 \\times 10^{9}~\\mathrm{s}^{-1}) \\cdot (5.0 \\times 10^{7}~\\mathrm{s}^{-1})\n$$\n$$\n\\text{Argument} = (6.31152 \\cdot 1.0 \\cdot 1.0 \\cdot 5.0) \\times 10^{(8 - 10 + 9 + 7)}\n$$\n$$\n\\text{Argument} = 31.5576 \\times 10^{14} = 3.15576 \\times 10^{15}\n$$\nNow, we substitute this into the expression for $T_{res}$:\n$$\nT_{res} = (15 \\times 10^{-12}~\\mathrm{s}) \\cdot \\ln\\left(3.15576 \\times 10^{15}\\right)\n$$\nCalculating the natural logarithm:\n$$\n\\ln\\left(3.15576 \\times 10^{15}\\right) \\approx 35.68804\n$$\nTherefore, the minimum required resolution time is:\n$$\nT_{res} \\approx (15 \\times 10^{-12}~\\mathrm{s}) \\cdot 35.68804 \\approx 5.353206 \\times 10^{-10}~\\mathrm{s}\n$$\nThe problem asks for the answer in nanoseconds ($\\mathrm{ns}$), where $1~\\mathrm{ns} = 10^{-9}~\\mathrm{s}$.\n$$\nT_{res} \\approx 0.5353206~\\mathrm{ns}\n$$\nRounding to four significant figures, we get:\n$$\nT_{res} \\approx 0.5353~\\mathrm{ns}\n$$\nNext, we perform the feasibility analysis for the two candidate clock periods. The available time for metastability resolution, $T_{\\mathrm{avail}}$, in a clock cycle $T_{clk}$ is what remains after accounting for other delays, represented by the overhead $T_{\\mathrm{ov}}$.\n$$\nT_{\\mathrm{avail}} = T_{clk} - T_{\\mathrm{ov}}\n$$\nFor the system to be reliable, the available time must be greater than or equal to the required resolution time: $T_{\\mathrm{avail}} \\ge T_{res}$.\nThe given overhead is $T_{\\mathrm{ov}} = 0.25~\\mathrm{ns}$.\n\nCase 1: Candidate clock period $T_{clk,1} = 1.0~\\mathrm{ns}$.\nThe available resolution time is:\n$$\nT_{\\mathrm{avail},1} = 1.0~\\mathrm{ns} - 0.25~\\mathrm{ns} = 0.75~\\mathrm{ns}\n$$\nComparing with the required resolution time:\n$$\nT_{\\mathrm{avail},1} = 0.75~\\mathrm{ns} > T_{res} \\approx 0.5353~\\mathrm{ns}\n$$\nSince the available time is greater than the required time, the clock period $T_{clk,1} = 1.0~\\mathrm{ns}$ is feasible.\n\nCase 2: Candidate clock period $T_{clk,2} = 0.5~\\mathrm{ns}$.\nThe available resolution time is:\n$$\nT_{\\mathrm{avail},2} = 0.5~\\mathrm{ns} - 0.25~\\mathrm{ns} = 0.25~\\mathrm{ns}\n$$\nComparing with the required resolution time:\n$$\nT_{\\mathrm{avail},2} = 0.25~\\mathrm{ns} < T_{res} \\approx 0.5353~\\mathrm{ns}\n$$\nSince the available time is less than the required time, the clock period $T_{clk,2} = 0.5~\\mathrm{ns}$ is not feasible. The system cannot meet the target MTBF of $20$ years with this clock period and overhead.\n\nThe primary result requested is the numerical value for $T_{res}$.\n$$\nT_{res} \\approx 0.5353~\\mathrm{ns}\n$$",
            "answer": "$$\\boxed{0.5353}$$"
        },
        {
            "introduction": "Modern Systems-on-Chip (SoCs) contain dozens or even hundreds of clock domain crossings, each a potential source of metastability-induced failure. This exercise scales up the analysis from a single component to an entire system, guided by a core principle of reliability engineering: for independent failure sources, the overall system's failure rate is the sum of the individual rates. By calculating the maximum number of synchronizers a system can tolerate while meeting a reliability goal, you will learn how to manage a \"metastability budget\" for a complex design . This reveals the critical, and sometimes counter-intuitive, relationship between system complexity and overall reliability.",
            "id": "3658848",
            "problem": "A system-on-chip integrates $N$ identical clock-domain crossing interfaces, each protected by a two-stage flip-flop synchronizer. Metastability-induced failure events in a single synchronizer are empirically observed to follow a memoryless process with a constant hazard rate, consistent with a Poisson point process model. The measured mean time between failure (MTBF) for a single synchronizer under worst-case operating conditions is $MTBF_{\\text{single}} = 230$ years. Assume synchronizer failures are independent across interfaces.\n\nStarting from the assumptions that (i) each synchronizer’s failure process is memoryless with a constant hazard rate and (ii) independent failure processes combine to produce a total failure process whose hazard rate is the sum of the individual hazard rates, derive the system-level mean time between failure $MTBF_{\\text{sys}}$ as a function of $N$. Then determine the largest integer $N$ such that the system-level mean time between failure satisfies $MTBF_{\\text{sys}} \\ge 10$ years of continuous operation.\n\nExpress the final answer as the integer $N$ with no units. No rounding is required.",
            "solution": "The problem statement is evaluated for validity before proceeding to a solution. The problem is scientifically and mathematically sound, grounded in the standard principles of reliability theory as applied to metastability in digital systems, a core topic in computer organization and architecture. The givens include the number of interfaces $N$, a single-synchronizer mean time between failure $MTBF_{\\text{single}}$ of $230$ years, and a target system-level mean time between failure $MTBF_{\\text{sys}}$ of at least $10$ years. The problem relies on the assumptions that failures follow a memoryless process with a constant hazard rate (a Poisson process) and that the system's hazard rate is the sum of the independent, individual hazard rates. These premises are consistent, complete, and standard for this type of engineering analysis. The problem is well-posed and objective, allowing for a unique, verifiable solution. Therefore, the problem is deemed valid and a solution can be derived.\n\nThe problem states that the failure process for a synchronizer is memoryless with a constant hazard rate. This means the time to failure, $T$, is a random variable that follows an exponential distribution. For such a distribution, the mean time between failure, $MTBF$, is the reciprocal of the constant hazard rate, $\\lambda$.\n$$MTBF = \\frac{1}{\\lambda}$$\nThis relationship allows us to express the hazard rate in terms of the $MTBF$:\n$$\\lambda = \\frac{1}{MTBF}$$\n\nFor a single synchronizer, the hazard rate, which we can denote as $\\lambda_{\\text{single}}$, is calculated from its given mean time between failure, $MTBF_{\\text{single}} = 230$ years.\n$$\\lambda_{\\text{single}} = \\frac{1}{MTBF_{\\text{single}}} = \\frac{1}{230 \\text{ years}}$$\n\nThe system consists of $N$ identical and independent synchronizers. As specified by the problem's assumptions (a standard result in reliability for competing, independent failure modes), the total hazard rate of the system, $\\lambda_{\\text{sys}}$, is the sum of the individual hazard rates. Since all $N$ synchronizers are identical, this sum is:\n$$\\lambda_{\\text{sys}} = \\sum_{i=1}^{N} \\lambda_{\\text{single}} = N \\cdot \\lambda_{\\text{single}}$$\n\nThe overall system failure process is also a Poisson process with a constant hazard rate $\\lambda_{\\text{sys}}$. Therefore, the system-level mean time between failure, $MTBF_{\\text{sys}}$, is the reciprocal of the system-level hazard rate:\n$$MTBF_{\\text{sys}} = \\frac{1}{\\lambda_{\\text{sys}}}$$\nSubstituting the expression for $\\lambda_{\\text{sys}}$ allows us to relate the system MTBF to the single-component MTBF:\n$$MTBF_{\\text{sys}} = \\frac{1}{N \\cdot \\lambda_{\\text{single}}} = \\frac{1}{N} \\left( \\frac{1}{\\lambda_{\\text{single}}} \\right) = \\frac{MTBF_{\\text{single}}}{N}$$\nThis equation provides the system-level mean time between failure as a function of $N$, which was the first part of the required derivation.\n\nThe second part of the problem requires finding the largest integer $N$ such that the system-level MTBF is greater than or equal to $10$ years. The condition is expressed as the following inequality:\n$$MTBF_{\\text{sys}} \\ge 10 \\text{ years}$$\nSubstituting the derived expression for $MTBF_{\\text{sys}}$ and the given value for $MTBF_{\\text{single}}$:\n$$\\frac{230 \\text{ years}}{N} \\ge 10 \\text{ years}$$\nTo solve for $N$, which must be a positive integer, we rearrange the inequality. We can multiply both sides by $N$ (since $N > 0$) and divide by $10$ years without altering the direction of the inequality:\n$$230 \\ge 10 \\cdot N$$\n$$ \\frac{230}{10} \\ge N$$\n$$23 \\ge N$$\nThe inequality $N \\le 23$ shows that the number of interfaces cannot exceed $23$ if the system reliability target is to be met. The problem asks for the largest integer $N$ that satisfies this condition. The largest integer value for $N$ that is less than or equal to $23$ is $23$.",
            "answer": "$$\\boxed{23}$$"
        }
    ]
}