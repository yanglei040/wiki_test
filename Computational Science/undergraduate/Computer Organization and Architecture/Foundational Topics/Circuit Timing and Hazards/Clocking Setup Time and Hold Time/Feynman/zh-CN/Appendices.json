{
    "hands_on_practices": [
        {
            "introduction": "在同步电路设计中，我们不仅要担心数据到达得太晚（建立时间违例），还要担心数据到达得太快（保持时间违例）。本练习模拟了一个常见的“短路径”问题，即旁路逻辑导致数据过早到达捕获寄存器。通过计算修复此问题所需的最小延迟，您将加深对保持时间基本不等式的理解，并掌握处理时序违例的实用方法。",
            "id": "3627777",
            "problem": "一个简单的算术逻辑单元（ALU）中的两级流水线由单个全局时钟网络进行时钟同步。第一级包含一个源寄存器 $R_{0}$，实现为边沿触发的D触发器（DFF），第二级包含一个目标寄存器 $R_{1}$，同样也是一个DFF。在 $R_{0}$ 和 $R_{1}$ 之间有一个ALU模块，带有一个由使能信号控制的旁路。当旁路被使能时，从 $R_{0}.\\mathrm{Q}$ 到 $R_{1}.\\mathrm{D}$ 的数据路径仅通过一个2选1多路复用器（MUX）和一小段局部导线，形成一个非常短的数据路径。\n\n假设此旁路路径在最佳工艺-电压-温度（PVT）条件下的测量或表征参数如下：\n- $R_{0}$ 的最小时钟到Q端延迟为 $t_{cq}^{min} = 35\\,\\mathrm{ps}$。\n- 组合逻辑旁路路径（MUX加导线）的最小传播延迟为 $t_{pd}^{min} = 12\\,\\mathrm{ps}$。\n- 目标DFF $R_{1}$ 的保持时间为 $t_{hold} = 60\\,\\mathrm{ps}$。\n- 最佳情况下的时钟偏斜（定义为在相同的最佳PVT条件下，目标时钟到达时间减去源时钟到达时间）为 $t_{skew}^{best} = +25\\,\\mathrm{ps}$。\n\n允许您在旁路数据路径中插入一个专用的延迟元件，它会在不影响时钟网络的情况下，为最小数据路径延迟增加一个额外的传播延迟 $d_{fix}$。仅使用边沿触发DFF的建立时间和保持时间的基本定义以及相对时钟到达时间（偏斜）的概念，确定最小的非负 $d_{fix}$ 值，以保证在这些最佳条件下启用旁路时，接收寄存器 $R_{1}$ 不会发生保持时间违例。\n\n将最终答案表示为一个以皮秒为单位的实数值。无需四舍五入；报告由给定参数所确定的精确值。",
            "solution": "边沿触发D触发器（DFF）的保持时间要求规定，在有效时钟沿到达目标寄存器后，其输入端的数据必须保持稳定至少 $t_{hold}$ 的时间。由源寄存器在其有效时钟沿上发出的新数据能够到达目标输入端的最早时间，是源寄存器的最小时钟到Q端延迟、组合逻辑数据路径的最小传播延迟以及在该数据路径上插入的任何有意附加延迟的总和。\n\n设源寄存器处的源时钟有效沿定义了时间 $t=0$。设目标时钟的有效沿相对于源时钟沿发生在时间 $t = t_{skew}^{best}$，其中 $t_{skew}^{best}$ 定义为在最佳PVT条件下，目标时钟到达时间减去源时钟到达时间。正的 $t_{skew}^{best}$ 意味着目标时钟沿比源时钟沿晚到达。\n\n根据基本时序定义，为避免保持时间违例，新数据到达目标输入端的最早可能时间不得早于目标保持时间窗口的结束。相对于源时钟沿，目标保持时间窗口的结束发生在时间 $t = t_{skew}^{best} + t_{hold}$。新数据到达的最早时间发生在 $t = t_{cq}^{min} + t_{pd}^{min} + d_{fix}$。因此，保持时间安全条件为\n$$\nt_{cq}^{min} + t_{pd}^{min} + d_{fix} \\ge t_{hold} + t_{skew}^{best}.\n$$\n我们求解所需的最小附加延迟 $d_{fix}$：\n$$\nd_{fix} \\ge \\left(t_{hold} + t_{skew}^{best}\\right) - \\left(t_{cq}^{min} + t_{pd}^{min}\\right).\n$$\n满足此不等式且物理上可实现的最小 $d_{fix}$ 是\n$$\nd_{fix} = \\max\\!\\left\\{0,\\ \\left(t_{hold} + t_{skew}^{best}\\right) - \\left(t_{cq}^{min} + t_{pd}^{min}\\right)\\right\\}.\n$$\n代入给定值，\n$$\n\\left(t_{hold} + t_{skew}^{best}\\right) - \\left(t_{cq}^{min} + t_{pd}^{min}\\right)\n= \\left(60\\,\\mathrm{ps} + 25\\,\\mathrm{ps}\\right) - \\left(35\\,\\mathrm{ps} + 12\\,\\mathrm{ps}\\right)\n= 85\\,\\mathrm{ps} - 47\\,\\mathrm{ps}\n= 38\\,\\mathrm{ps}.\n$$\n由于该值为正，必须添加的最小非负延迟为\n$$\nd_{fix} = 38\\,\\mathrm{ps}.\n$$\n无需四舍五入。",
            "answer": "$$\\boxed{38}$$"
        },
        {
            "introduction": "时钟偏斜通常被视为一个问题，但它也可以成为一种强大的优化工具。通过有意地延迟捕获时钟（即引入“有用偏斜”），我们可以为长逻辑路径“借用”时间，从而提高整个系统的工作频率。本练习将指导您量化建立时间和保持时间之间的权衡，计算在不违反短路径保持约束的前提下可以引入的最大有用偏斜，并最终确定优化后的最小系统时钟周期。",
            "id": "3627844",
            "problem": "微架构中的一个同步流水线使用由锁相环 (PLL) 产生的单一全局时钟驱动的边沿触发触发器 (FF)。考虑从一个发送触发器 $R_{L}$ 到一个捕获触发器 $R_{C}$ 的两条同源组合路径：一条较长的算术逻辑单元 (ALU) 路径和一条较短的旁路路径。目标是应用有意的“有用时钟偏斜”，由偏斜变量 $t_{\\mathrm{skew}}$ 定义（在本问题中，$t_{\\mathrm{skew}}$ 定义为同一周期内的 $t_{\\mathrm{launch}} - t_{\\mathrm{capture}}$），以放宽长 ALU 路径上的建立约束，同时保证短旁路路径上不发生保持违例。\n\n假设在标称工作条件下测得以下符合物理现实的参数：\n- 发送触发器 $R_{L}$ 的时钟到Q端最大延迟 $t_{\\mathrm{cq,max}} = 80\\,\\mathrm{ps}$ 和最小延迟 $t_{\\mathrm{cq,min}} = 60\\,\\mathrm{ps}$。\n- 捕获触发器 $R_{C}$ 的建立时间 $t_{\\mathrm{setup}} = 50\\,\\mathrm{ps}$ 和保持时间 $t_{\\mathrm{hold}} = 30\\,\\mathrm{ps}$。\n- 长 ALU 路径最大组合延迟 $D_{\\mathrm{L,max}} = 760\\,\\mathrm{ps}$。\n- 短旁路路径最小组合延迟 $D_{\\mathrm{S,min}} = 120\\,\\mathrm{ps}$。\n- 基准时钟分布的不确定性可忽略不计，其偏斜可通过 $R_{C}$ 分支上的可编程去偏斜元件进行调整，当 $R_{C}$ 的边沿相对于 $R_{L}$ 延迟时，会使 $t_{\\mathrm{skew}}$ 变得更负。\n\n从边沿触发FF的建立和保持的基本定义以及上面给出的时钟偏斜定义出发，确定在不违反短旁路路径上的保持约束的情况下可以引入的最负的有用偏斜 $t_{\\mathrm{skew}}^{\\mathrm{useful}} \\le 0$。使用该 $t_{\\mathrm{skew}}^{\\mathrm{useful}}$，确定满足长 ALU 路径上建立约束所需的最小主频周期 $T_{\\min}$。\n\n最终答案以皮秒为单位，并按 $\\big(t_{\\mathrm{skew}}^{\\mathrm{useful}},\\,T_{\\min}\\big)$ 的顺序列出。将每个值四舍五入到三位有效数字。",
            "solution": "边沿触发触发器 (FF) 的流水线时序约束源于它们的基本定义：\n\n- 建立时间 $t_{\\mathrm{setup}}$：在捕获FF的下一个有效时钟沿到来之前，捕获FF输入端的数据必须稳定至少 $t_{\\mathrm{setup}}$ 的时间。考虑一个发送沿和一个周期后的下一个捕获沿，捕获FF的最晚数据到达时间不得晚于捕获沿减去 $t_{\\mathrm{setup}}$。\n- 保持时间 $t_{\\mathrm{hold}}$：在捕获FF的同一时钟沿之后，捕获FF输入端的数据必须保持稳定至少 $t_{\\mathrm{hold}}$ 的时间。考虑同一周期的捕获沿，最早数据到达时间不得早于捕获沿加上 $t_{\\mathrm{hold}}$。\n\n我们将同一周期的时钟偏斜定义为 $t_{\\mathrm{skew}} = t_{\\mathrm{launch}} - t_{\\mathrm{capture}}$。负的 $t_{\\mathrm{skew}}$ 意味着捕获沿比发送沿晚到达，这增加了下一个周期中可用于建立的时间，但收紧了同一周期中的保持约束。\n\n长 ALU 路径的建立约束：$R_{C}$ 的最晚数据到达时间是\n$$\nt_{\\mathrm{latest}} = t_{\\mathrm{launch}} + t_{\\mathrm{cq,max}} + D_{\\mathrm{L,max}}.\n$$\n这不得晚于下一个捕获沿减去建立时间：\n$$\nt_{\\mathrm{capture}} + T - t_{\\mathrm{setup}}.\n$$\n因此，\n$$\nt_{\\mathrm{launch}} + t_{\\mathrm{cq,max}} + D_{\\mathrm{L,max}} \\leq t_{\\mathrm{capture}} + T - t_{\\mathrm{setup}}.\n$$\n用 $t_{\\mathrm{skew}} = t_{\\mathrm{launch}} - t_{\\mathrm{capture}}$ 重新整理，得到周期要求\n$$\nT \\geq t_{\\mathrm{skew}} + t_{\\mathrm{cq,max}} + D_{\\mathrm{L,max}} + t_{\\mathrm{setup}}.\n$$\n\n短旁路路径的保持约束：$R_{C}$ 的最早数据到达时间是\n$$\nt_{\\mathrm{earliest}} = t_{\\mathrm{launch}} + t_{\\mathrm{cq,min}} + D_{\\mathrm{S,min}}.\n$$\n这不得早于捕获沿加上保持时间：\n$$\nt_{\\mathrm{capture}} + t_{\\mathrm{hold}}.\n$$\n因此，\n$$\nt_{\\mathrm{launch}} + t_{\\mathrm{cq,min}} + D_{\\mathrm{S,min}} \\geq t_{\\mathrm{capture}} + t_{\\mathrm{hold}},\n$$\n使用 $t_{\\mathrm{skew}} = t_{\\mathrm{launch}} - t_{\\mathrm{capture}}$，上式变为\n$$\nt_{\\mathrm{skew}} + t_{\\mathrm{cq,min}} + D_{\\mathrm{S,min}} - t_{\\mathrm{hold}} \\geq 0.\n$$\n解出 $t_{\\mathrm{skew}}$，\n$$\nt_{\\mathrm{skew}} \\geq t_{\\mathrm{hold}} - t_{\\mathrm{cq,min}} - D_{\\mathrm{S,min}}.\n$$\n\n为了最大化对建立时间的有益效果同时避免保持违例，选择仍满足保持不等式的最负 $t_{\\mathrm{skew}}$，即\n$$\nt_{\\mathrm{skew}}^{\\mathrm{useful}} = t_{\\mathrm{hold}} - t_{\\mathrm{cq,min}} - D_{\\mathrm{S,min}}.\n$$\n代入给定值 $t_{\\mathrm{hold}} = 30\\,\\mathrm{ps}$、$t_{\\mathrm{cq,min}} = 60\\,\\mathrm{ps}$ 和 $D_{\\mathrm{S,min}} = 120\\,\\mathrm{ps}$：\n$$\nt_{\\mathrm{skew}}^{\\mathrm{useful}} = 30\\,\\mathrm{ps} - 60\\,\\mathrm{ps} - 120\\,\\mathrm{ps} = -150\\,\\mathrm{ps}.\n$$\n\n使用此 $t_{\\mathrm{skew}}^{\\mathrm{useful}}$，满足长路径建立约束的最小周期为\n$$\nT_{\\min} = t_{\\mathrm{skew}}^{\\mathrm{useful}} + t_{\\mathrm{cq,max}} + D_{\\mathrm{L,max}} + t_{\\mathrm{setup}}.\n$$\n代入 $t_{\\mathrm{skew}}^{\\mathrm{useful}} = -150\\,\\mathrm{ps}$、$t_{\\mathrm{cq,max}} = 80\\,\\mathrm{ps}$、$D_{\\mathrm{L,max}} = 760\\,\\mathrm{ps}$ 和 $t_{\\mathrm{setup}} = 50\\,\\mathrm{ps}$：\n$$\nT_{\\min} = -150\\,\\mathrm{ps} + 80\\,\\mathrm{ps} + 760\\,\\mathrm{ps} + 50\\,\\mathrm{ps} = 740\\,\\mathrm{ps}.\n$$\n\n将每个值四舍五入到三位有效数字，单位为皮秒。值 $-150\\,\\mathrm{ps}$ 和 $740\\,\\mathrm{ps}$ 分别变为 $-1.50 \\times 10^{2}\\,\\mathrm{ps}$ 和 $7.40 \\times 10^{2}\\,\\mathrm{ps}$。\n\n因此，以皮秒为单位的有序对 $\\big(t_{\\mathrm{skew}}^{\\mathrm{useful}},\\,T_{\\min}\\big)$ 是 $\\big(-1.50 \\times 10^{2},\\,7.40 \\times 10^{2}\\big)$。",
            "answer": "$$\\boxed{\\begin{pmatrix}-1.50 \\times 10^{2} & 7.40 \\times 10^{2}\\end{pmatrix}}$$"
        },
        {
            "introduction": "将单个时序路径的分析扩展到整个流水线设计，是数字系统优化的关键一步。重定时（Retiming）是一种通过重新定位流水线寄存器来平衡各级之间逻辑延迟的技术，以最大限度地提高时钟频率。本练习要求您在一个多级数据通路中探索不同的寄存器布局方案，通过系统性地评估每种方案的建立和保持时间约束，最终找到实现最小时钟周期的最优设计。",
            "id": "3627742",
            "problem": "一个同步数据通路使用三个阶段，由两个基于D型触发器（DFF）构建的流水线寄存器隔开。输入寄存器和输出寄存器之间的数据通路是一个由六个组合子模块组成的严格前馈链，按顺序标记为 $B_1 \\rightarrow B_2 \\rightarrow B_3 \\rightarrow B_4 \\rightarrow B_5 \\rightarrow B_6$。每个子模块 $B_k$ 都有一个最坏情况（最大）传播延迟 $t_{pd,k}^{\\max}$ 和一个最好情况（最小）传播延迟 $t_{pd,k}^{\\min}$，以纳秒为单位，如下所示：\n- $B_1$：$t_{pd,1}^{\\max} = 0.35$， $t_{pd,1}^{\\min} = 0.09$\n- $B_2$：$t_{pd,2}^{\\max} = 0.26$， $t_{pd,2}^{\\min} = 0.07$\n- $B_3$：$t_{pd,3}^{\\max} = 0.41$， $t_{pd,3}^{\\min} = 0.10$\n- $B_4$：$t_{pd,4}^{\\max} = 0.29$， $t_{pd,4}^{\\min} = 0.07$\n- $B_5$：$t_{pd,5}^{\\max} = 0.38$， $t_{pd,5}^{\\min} = 0.09$\n- $B_6$：$t_{pd,6}^{\\max} = 0.31$， $t_{pd,6}^{\\min} = 0.08$\n\n有三个流水线阶段，由两个必须放置在子模块边界处的寄存器隔开。最初，这两个寄存器放置在 $B_1$ 之后和 $B_4$ 之后，因此三个阶段是 $(B_1)$、$(B_2,B_3,B_4)$ 和 $(B_5,B_6)$。\n\nD型触发器具有以下时序参数（单位：纳秒）：\n- 时钟到Q端最坏情况延迟 $t_{clk\\rightarrow Q}^{\\max} = 0.11$\n- 时钟到Q端最好情况延迟 $t_{clk\\rightarrow Q}^{\\min} = 0.07$\n- 建立时间 $t_{setup} = 0.05$\n- 保持时间 $t_{hold} = 0.06$\n\n时钟分配在任何发射寄存器和捕获寄存器之间都表现出有界时钟偏斜。将时钟偏斜定义为 $t_{skew} = t_{clk}^{dst} - t_{clk}^{src}$，其中 $t_{clk}^{dst}$ 是目标寄存器相对于源的时钟到达时间。已知该数据通路中所有寄存器对的偏斜都在 $[s_{\\min}, s_{\\max}] = [-0.03, +0.04]$ 纳秒的范围内。\n\n您只能通过将两个流水线寄存器重新定位到子模块之间的不同边界来进行重定时；您必须精确保留三个流水线阶段，并且不能分割任何子模块。您的目标是最小化每级的关键路径（即三个阶段中相关 $t_{pd,k}^{\\max}$ 之和的最大值），同时确保重定时后，在每个寄存器边界处，当使用相应的每级 $t_{pd,k}^{\\min}$ 之和以及给定的DFF和偏斜参数进行评估时，保持要求得到满足。如果有多种布局方案能实现相同的最小化每级最大 $t_{pd}^{\\max}$，则优先选择能产生相对于保持的更大最小延迟裕度的布局。\n\n根据同步时序的基本原理（由源寄存器发出的数据必须在目标寄存器的下一个有效时钟沿之前至少提前建立时间到达并保持稳定，并且不得在同一时钟沿内早于保持时间到达），确定最佳的寄存器布局，并计算满足所有阶段边界在规定偏斜范围内的建立和保持要求的最小可行时钟周期 $T_{clk,\\min}$（以纳秒为单位）。使用与这些原理一致的最坏情况参数组合。将最终的 $T_{clk,\\min}$ 四舍五入到四位有效数字。以纳秒为单位表示您的答案。在最终的方框答案中不要包含单位。",
            "solution": "首先，我们建立同步时序的基本约束方程，并考虑最坏情况的参数。\n\n**1. 建立时间约束**\n为了满足建立时间，从源寄存器发出的数据必须在捕获时钟沿到达目标寄存器至少 $t_{setup}$ 之前到达。最坏情况发生在数据路径最长（$t_{clk\\rightarrow Q}^{\\max}$, $t_{comb}^{\\max}$）且时钟偏斜最不利于建立时间时。\n$$ T_{clk} \\ge t_{clk\\rightarrow Q}^{\\max} + t_{comb}^{\\max} + t_{setup} - t_{skew} $$\n为了找到最小允许的 $T_{clk}$，我们必须在最坏情况下满足此不等式，即当右侧最大化时。这发生在 $t_{skew}$ 取其最小值 $s_{min} = -0.03$ ns 时。\n$$ T_{clk} \\ge t_{clk\\rightarrow Q}^{\\max} + t_{comb}^{\\max} + t_{setup} - s_{min} $$\n代入数值：\n$$ T_{clk} \\ge 0.11 + t_{comb}^{\\max} + 0.05 - (-0.03) = t_{comb}^{\\max} + 0.19 \\, \\text{ns} $$\n这个方程决定了时钟周期，它直接受限于流水线中最长阶段的组合延迟 $t_{comb}^{\\max}$。\n\n**2. 保持时间约束**\n为了满足保持时间，新到达的数据不能早于当前时钟沿之后 $t_{hold}$ 的时刻，以免破坏正在被捕获的数据。最坏情况发生在数据路径最短（$t_{clk\\rightarrow Q}^{\\min}$, $t_{comb}^{\\min}$）且时钟偏斜最不利于保持时间时。\n$$ t_{clk\\rightarrow Q}^{\\min} + t_{comb}^{\\min} \\ge t_{hold} + t_{skew} $$\n这个不等式必须对所有可能的偏斜值成立，因此我们考虑最坏情况，即右侧最大化时。这发生在 $t_{skew}$ 取其最大值 $s_{max} = +0.04$ ns 时。\n$$ t_{clk\\rightarrow Q}^{\\min} + t_{comb}^{\\min} \\ge t_{hold} + s_{max} $$\n代入数值：\n$$ 0.07 + t_{comb}^{\\min} \\ge 0.06 + 0.04 $$\n$$ t_{comb}^{\\min} \\ge 0.10 - 0.07 = 0.03 \\, \\text{ns} $$\n因此，任何有效的流水线阶段的最小组合延迟 $t_{comb}^{\\min}$ 都必须大于或等于 0.03 ns。\n\n**3. 优化寄存器布局**\n我们的目标是找到两个寄存器的最佳放置位置，以最小化所有三个阶段中最大的组合延迟（即临界路径延迟 $\\max(t_{comb}^{\\max})$），同时确保所有阶段都满足 $t_{comb}^{\\min} \\ge 0.03$ ns 的保持时间要求。我们有5个可能的边界来放置2个寄存器，总共有 $\\binom{5}{2} = 10$ 种布局方案。我们将系统地评估这些方案。设布局 $(i, j)$ 表示寄存器放置在模块 $B_i$ 和 $B_j$ 之后。\n\n| 布局 (i, j) | 阶段1 ($B_1..B_i$)  | 阶段2 ($B_{i+1}..B_j$) | 阶段3 ($B_{j+1}..B_6$) | $\\max(t_{comb}^{\\max})$ | 所有 $t_{comb}^{\\min} \\ge 0.03$? |\n|:---:|:---:|:---:|:---:|:---:|:---:|\n| (1, 2) | {B1} | {B2} | {B3..B6} | $\\max(0.35, 0.26, 1.39) = 1.39$ | 是 (0.09, 0.07, 0.34) |\n| (1, 3) | {B1} | {B2, B3} | {B4..B6} | $\\max(0.35, 0.67, 0.98) = 0.98$ | 是 (0.09, 0.17, 0.24) |\n| (1, 4) | {B1} | {B2..B4} | {B5, B6} | $\\max(0.35, 0.96, 0.69) = 0.96$ | 是 (0.09, 0.24, 0.17) |\n| (1, 5) | {B1} | {B2..B5} | {B6} | $\\max(0.35, 1.34, 0.31) = 1.34$ | 是 (0.09, 0.33, 0.08) |\n| (2, 3) | {B1, B2} | {B3} | {B4..B6} | $\\max(0.61, 0.41, 0.98) = 0.98$ | 是 (0.16, 0.10, 0.24) |\n| **(2, 4)** | **{B1, B2}** | **{B3, B4}** | **{B5, B6}** | **$\\max(0.61, 0.70, 0.69) = 0.70$** | **是 (0.16, 0.17, 0.17)** |\n| (2, 5) | {B1, B2} | {B3..B5} | {B6} | $\\max(0.61, 1.08, 0.31) = 1.08$ | 是 (0.16, 0.26, 0.08) |\n| (3, 4) | {B1..B3} | {B4} | {B5, B6} | $\\max(1.02, 0.29, 0.69) = 1.02$ | 是 (0.26, 0.07, 0.17) |\n| (3, 5) | {B1..B3} | {B4, B5} | {B6} | $\\max(1.02, 0.67, 0.31) = 1.02$ | 是 (0.26, 0.16, 0.08) |\n| (4, 5) | {B1..B4} | {B5} | {B6} | $\\max(1.31, 0.38, 0.31) = 1.31$ | 是 (0.33, 0.09, 0.08) |\n\n通过比较所有布局的临界路径延迟，我们发现布局 (2, 4) — 即寄存器分别放置在 $B_2$ 和 $B_4$ 之后 — 实现了最小的每级最大延迟，其值为 0.70 ns。该布局的各阶段最小延迟均大于 0.03 ns，满足保持时间要求。\n\n**4. 计算最小可行时钟周期**\n使用最优布局的临界路径延迟 $t_{comb}^{\\max} = 0.70$ ns，我们代入建立时间约束方程：\n$$ T_{clk,\\min} = t_{comb}^{\\max} + 0.19 = 0.70 + 0.19 = 0.89 \\, \\text{ns} $$\n将结果四舍五入到四位有效数字，得到 $0.8900$ ns。",
            "answer": "$$\\boxed{0.8900}$$"
        }
    ]
}