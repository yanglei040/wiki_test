{
    "hands_on_practices": [
        {
            "introduction": "现代云服务由许多相互连接的微服务构建而成。要理解和提高这样一个系统的性能，我们必须首先分析其依赖关系图，以找到决定整体性能瓶颈的最长执行路径，即“关键路径”。本练习将指导您计算一个服务图的端到端延迟，并识别出哪些组件在性能优化方面具有最大潜力 。",
            "id": "3688299",
            "problem": "某个在仓库级计算机 (WSC) 中的微服务部署被建模为一个有向无环图 (DAG)，其节点集为 $V = \\{A,B,C,D,E,F\\}$，边集为 $E = \\{(A,B),(A,C),(B,D),(B,E),(C,F)\\}$。每个节点 $i \\in V$ 代表一个微服务，该微服务在被调用时，会执行耗时为 $t_i$ 的本地处理，然后，如果它有出边，则会并发调用其所有直接后继，并等待所有调用完成后才返回。假设各节点的处理时间（单位：毫秒）如下：$t_A = 12$，$t_B = 8$，$t_C = 15$，$t_D = 40$，$t_E = 20$，$t_F = 30$。调用扇出为 $f_A = 2$，$f_B = 2$，$f_C = 1$，以及 $f_D = f_E = f_F = 0$。DAG 的根节点是 $A$，叶节点是 $D$、$E$ 和 $F$。假设网络延迟可忽略不计，且资源充足，因此所有并行调用运行时没有排队干扰。\n\n请仅使用适用于计算机组织与体系结构中并行组合性能建模的第一性原理——即并发发出独立调用并等待所有调用完成，其产生的有效下游等待时间等于各分支完成时间的最大值——来推导从根节点 $A$ 开始到完成的端到端延迟。然后，在存在唯一关键路径且单个 $t_i$ 的无穷小减少不会改变该路径的假设下，确定灵敏度向量 $\\mathbf{s}$，其中分量 $s_i$ 等于 $t_i$ 每减少一个单位时，根节点 $A$ 处端到端延迟的一阶变化量，其中 $i$ 的顺序为 $(A,B,C,D,E,F)$。报告的延迟需四舍五入到四位有效数字，并以毫秒为单位表示。您的最终答案必须是一个单行矩阵，其第一个条目是延迟值，其余条目是 $\\mathbf{s}$ 的六个分量，顺序为 $(A,B,C,D,E,F)$。",
            "solution": "用户要求我解决一个关于仓库级计算机 (WSC) 中微服务部署的性能建模问题。\n\n### 第1步：问题验证\n\n首先，我必须验证问题陈述。\n\n#### 第1.1步：提取已知条件\n- **节点集**：$V = \\{A,B,C,D,E,F\\}$。\n- **边集**：$E = \\{(A,B),(A,C),(B,D),(B,E),(C,F)\\}$，表示一个有向无环图 (DAG)。\n- **执行模型**：节点 $i$ 执行耗时为 $t_i$ 的本地处理。如果它有后继节点，它会并发调用它们，并等待所有调用完成后才返回。节点的总延迟是其本地处理时间加上等待其下游调用的时间。\n- **下游等待原则**：并发调用的等待时间是并行分支完成时间的最大值。\n- **节点处理时间（单位：毫秒）**：$t_A = 12$，$t_B = 8$，$t_C = 15$，$t_D = 40$，$t_E = 20$，$t_F = 30$。\n- **图结构**：根节点为 $A$；叶节点为 $D$、$E$ 和 $F$。\n- **假设**：网络延迟可忽略不计。资源充足，因此没有排队干扰。存在唯一的关键路径，且单个 $t_i$ 的无穷小减少不会改变其标识。\n- **任务**：\n  1. 推导从根节点 $A$ 开始的端到端延迟。\n  2. 确定灵敏度向量 $\\mathbf{s} = (s_A, s_B, s_C, s_D, s_E, s_F)$，其中 $s_i$ 是 $t_i$ 每减少一个单位时，端到端延迟的一阶变化量。\n- **报告格式**：\n  1. 延迟必须四舍五入到四位有效数字，并以毫秒表示。\n  2. 最终答案是一个单行矩阵，包含延迟和 $\\mathbf{s}$ 的六个分量。\n\n#### 第1.2步：使用提取的已知条件进行验证\n- **科学依据**：该问题在并行和分布式系统的性能分析原理中有充分的依据，这是计算机组织与体系结构的核心主题。使用 DAG 建模依赖关系和使用关键路径法寻找延迟是标准技术。\n- **良构性**：该问题是良构的。图、处理时间以及计算规则都已明确给出，可以得到延迟和灵敏度的唯一解。\n- **客观性**：问题陈述是客观、定量的，没有主观或模糊的语言，除了“灵敏度”的措辞略有例外，但这将在解决方案中根据学科惯例通过合理解释来处理。\n- **缺陷分析**：\n  - 问题没有违反科学原理。\n  - 它是可形式化的，并且与指定领域直接相关。\n  - 已知条件是完整和一致的。扇出数据虽然是多余的，但与提供的边集相匹配。\n  - 假设（例如，可忽略的延迟）是一阶建模中的标准简化，不会使问题无效。\n  - 结构确保了唯一、稳定的解。\n\n#### 第1.3步：结论与行动\n问题有效。我现在将进行完整解答。\n\n### 第2步：求解推导\n\n#### 第1部分：端到端延迟计算\n\n服务调用图的端到端延迟由关键路径决定，关键路径是图中从根到叶的、总执行时间最长的路径。设 $L(i)$ 是以节点 $i$ 为根的子图的总延迟。根据问题描述，这可以递归地定义。\n\n对于任何叶节点 $i$（没有后继的节点），其延迟就是它自身的处理时间：\n$$L(i) = t_i$$\n\n对于任何非叶节点 $i$，其延迟是它自身的处理时间加上其后继分支延迟的最大值，因为调用是并发的，并且该节点必须等待所有调用完成：\n$$L(i) = t_i + \\max_{j \\in \\text{succ}(i)} \\{L(j)\\}$$\n其中 $\\text{succ}(i)$ 是节点 $i$ 的直接后继集合。\n\n我们通过从 DAG 的叶节点 $D$、$E$ 和 $F$ 向上回溯来计算延迟。\n\n1.  **叶节点的延迟**：\n    $L(D) = t_D = 40 \\, \\text{ms}$\n    $L(E) = t_E = 20 \\, \\text{ms}$\n    $L(F) = t_F = 30 \\, \\text{ms}$\n\n2.  **内部节点的延迟**：\n    -   节点 $C$ 有一个后继节点 $F$。\n        $$L(C) = t_C + L(F) = 15 + 30 = 45 \\, \\text{ms}$$\n    -   节点 $B$ 有两个后继节点 $D$ 和 $E$。\n        $$L(B) = t_B + \\max\\{L(D), L(E)\\} = 8 + \\max\\{40, 20\\} = 8 + 40 = 48 \\, \\text{ms}$$\n\n3.  **根节点的延迟**：\n    -   节点 $A$ 有两个后继节点 $B$ 和 $C$。端到端延迟为 $L(A)$。\n        $$L(A) = t_A + \\max\\{L(B), L(C)\\} = 12 + \\max\\{48, 45\\} = 12 + 48 = 60 \\, \\text{ms}$$\n\n端到端延迟为 $60 \\, \\text{ms}$。问题要求将此值四舍五入到四位有效数字，即 $60.00 \\, \\text{ms}$。\n\n#### 第2部分：灵敏度向量计算\n\n灵敏度 $s_i$ 被定义为“$t_i$ 每减少一个单位时，根节点 $A$ 处端到端延迟的一阶变化量”。设总延迟为 $L_{total} = L(A)$。由 $t_i$ 的微小变化 $\\Delta t_i$ 引起的一阶变化 $\\Delta L_{total}$ 由 $\\Delta L_{total} \\approx \\frac{\\partial L_{total}}{\\partial t_i} \\Delta t_i$ 给出。对于“$t_i$ 减少一个单位”，我们有 $\\Delta t_i = -1$。因此，变化量为 $-\\frac{\\partial L_{total}}{\\partial t_i}$。\n\n在性能工程中，将灵敏度定义为直接偏导数 $\\frac{\\partial L_{total}}{\\partial t_i}$ 是一种标准惯例，它表示总延迟相对于组件延迟的变化率。该值非负，并表示影响的大小。我们将采用这个标准定义，即 $s_i = \\frac{\\partial L_{total}}{\\partial t_i}$。$s_i=1$ 的值意味着 $t_i$ 的变化会导致 $L_{total}$ 发生相同的变化，而 $s_i=0$ 则意味着 $t_i$ 的变化对 $L_{total}$ 没有一阶效应。\n\n为了计算这些导数，我们首先确定关键路径。关键路径是在每个分叉点决定最大值的节点序列：\n- 在节点 $A$，$B$ 分支被选中，因为 $L(B) = 48 > L(C) = 45$。\n- 在节点 $B$，$D$ 分支被选中，因为 $L(D) = 40 > L(E) = 20$。\n因此，唯一的关键路径是 $A \\rightarrow B \\rightarrow D$。\n\n问题陈述中说明，我们可以假设无穷小的变化不会改变关键路径。这使我们可以将总延迟 $L_{total}$ 表示为这条关键路径上节点处理时间的简单总和：\n$$L_{total}(t_A, t_B, t_C, t_D, t_E, t_F) = t_A + t_B + t_D$$\n\n现在我们可以为每个节点 $i \\in V$ 计算灵敏度分量 $s_i = \\frac{\\partial L_{total}}{\\partial t_i}$：\n\n-   $s_A = \\frac{\\partial}{\\partial t_A}(t_A + t_B + t_D) = 1$\n-   $s_B = \\frac{\\partial}{\\partial t_B}(t_A + t_B + t_D) = 1$\n-   $s_C = \\frac{\\partial}{\\partial t_C}(t_A + t_B + t_D) = 0$ (节点 $C$ 不在关键路径上)\n-   $s_D = \\frac{\\partial}{\\partial t_D}(t_A + t_B + t_D) = 1$\n-   $s_E = \\frac{\\partial}{\\partial t_E}(t_A + t_B + t_D) = 0$ (节点 $E$ 不在关键路径上)\n-   $s_F = \\frac{\\partial}{\\partial t_F}(t_A + t_B + t_D) = 0$ (节点 $F$ 不在关键路径上)\n\n因此，灵敏度向量 $\\mathbf{s}$，其分量按 $(A,B,C,D,E,F)$ 排序为：\n$$\\mathbf{s} = (1, 1, 0, 1, 0, 0)$$\n\n#### 第3部分：最终答案构建\n\n最终答案必须是一个单行矩阵，包含延迟（四舍五入到四位有效数字）以及其后的灵敏度向量 $\\mathbf{s}$ 的六个分量。\n\n-   延迟：$60.00$\n-   灵敏度向量：$(1, 1, 0, 1, 0, 0)$\n\n最终矩阵是 $(60.00, 1, 1, 0, 1, 0, 0)$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n60.00 & 1 & 1 & 0 & 1 & 0 & 0\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在理解了服务依赖关系之后，一个关键任务是配置适量的资源以满足性能目标。排队论为此类容量规划提供了数学基础。在此实践中，您将使用 $\\mathrm{M}/\\mathrm{M}/k}$ 排队模型来确定满足请求等待时间的服务水平目标（SLO）所需的最少 CPU 核心数，并量化使用专用加速器带来的收益 。",
            "id": "3688262",
            "problem": "一个仓库级计算机（WSC）运行一个微服务层，该微服务层接收外部请求，并将其分派给一个由相同的中央处理器（CPU）核心组成的池。为了进行容量规划的推理，使用以下科学标准假设：请求到达形成一个速率为每秒 $\\lambda$ 个请求的泊松过程，任何给定核心上的单个服务时间是独立的，且呈指数分布，平均速率为每秒每个核心 $\\mu$ 个请求，并且核心按先到先服务（FCFS）调度来服务请求。在这些条件下，通用请求通道可以建模为一个 $\\mathrm{M}/\\mathrm{M}/k$ 队列，其中 $k$ 是活动的通用核心数量。\n\nWSC 对预期排队延迟 $W_q$ 强制执行服务水平目标（SLO），$W_q$ 定义为请求在服务开始前在队列中等待的预期时间（不包括服务时间）。SLO 要求 $W_q \\leq W_0$，其中 $W_0$ 是以秒为单位的指定上限。\n\n基准配置：\n- 到达速率为每秒 $\\lambda = 800$ 个请求。\n- 每个通用核心的平均服务速率为每秒 $\\mu = 150$ 个请求。\n- SLO 上限为 $W_0 = 0.040$ 秒。\n\n专用快速通道配置：\n- 一部分比例为 $p = 0.25$ 的到达请求被识别为简单请求，并被路由到一个独立的专用加速器池（快速通道），剩下的 $(1-p)$ 的到达请求留给通用核心处理。\n- 有 $m = 2$ 个相同的加速器，每个加速器的平均服务速率为每秒 $\\mu_s = 500$ 个请求。\n- 通用核心池仍然是一个服务剩余到达请求的 $\\mathrm{M}/\\mathrm{M}/k$ 队列，而快速通道则形成一个服务分流到达请求的 $\\mathrm{M}/\\mathrm{M}/m$ 队列。\n- SLO 要求两个通道都独立满足 $W_q \\leq W_0$。\n\n仅使用上述假设和定义，确定：\n1. 基准配置中所需的通用核心的最小整数数量 $k_{\\mathrm{base}}$，以使预期排队延迟满足 $W_q \\leq W_0$。\n2. 专用快速通道配置中所需的通用核心的最小整数数量 $k_{\\mathrm{spec}}$，以使通用通道和快速通道都独立满足 $W_q \\leq W_0$。\n\n最后，计算由于专用快速通道导致的通用核心减少量，定义为 $\\Delta k = k_{\\mathrm{base}} - k_{\\mathrm{spec}}$。请将您的最终答案表示为单个整数。您推理过程中的所有中间量必须以秒表示时间，以请求/秒表示速率。最终整数无需四舍五入指令。",
            "solution": "问题陈述已经过验证，被认为是科学上合理的、定义明确的且客观的。它使用排队论的既定原则，提出了一个计算机系统架构中的标准性能分析场景。所有必要的参数都已提供，问题没有矛盾或歧义。\n\n该问题需要分析两个基于 $\\mathrm{M}/\\mathrm{M}/k$ 模型的排队系统。一个 $\\mathrm{M}/\\mathrm{M}/k$ 队列模型化了一个具有泊松到达（第一个M）、指数服务时间（第二个M）和 $k$ 个并行服务台的系统。分析此类系统的核心公式是：\n1.  到达负荷 $A$，是到达速率 $\\lambda$ 与单个服务台服务速率 $\\mu$ 的比值：$A = \\frac{\\lambda}{\\mu}$。这表示在有无限多服务台的情况下，预期繁忙服务台的数量。\n2.  系统只有在总服务容量超过到达速率时才稳定，即 $k\\mu > \\lambda$。这等价于流量强度 $\\rho = \\frac{\\lambda}{k\\mu} = \\frac{A}{k}$ 必须小于 1 的条件。\n3.  一个到达的请求必须在队列中等待的概率 $P_q$ 由爱尔朗C公式给出，记为 $C(k, A)$：\n    $$P_q = C(k, A) = \\frac{\\frac{A^k}{k!(1-\\rho)}}{\\sum_{n=0}^{k-1} \\frac{A^n}{n!} + \\frac{A^k}{k!(1-\\rho)}}$$\n4.  预期排队延迟 $W_q$ 可以使用排队概率计算：\n    $$W_q = \\frac{P_q}{k\\mu - \\lambda}$$\n    为了使系统可行，我们必须找到最小的整数 $k$，使得稳定性条件得到满足，并且服务水平目标（SLO）$W_q \\leq W_0$ 也得到满足。\n\n**1. 确定基准配置的最小核心数 $k_{\\mathrm{base}}$**\n\n在基准配置中，我们有：\n-   到达速率：$\\lambda = 800$ 请求/秒。\n-   每个核心的平均服务速率：$\\mu = 150$ 请求/秒。\n-   SLO 上限：$W_0 = 0.040$ 秒。\n\n首先，我们确定稳定性所需的最小核心数：\n$k \\mu > \\lambda \\implies k \\times 150 > 800 \\implies k > \\frac{800}{150} = \\frac{16}{3} \\approx 5.333$。\n确保稳定性的最小整数核心数是 $k=6$。\n\n现在，我们必须验证 $k=6$ 是否满足 SLO，$W_q \\leq 0.040$ 秒。我们为 $k=6$ 计算 $W_q$。\n到达负荷为 $A = \\frac{\\lambda}{\\mu} = \\frac{800}{150} = \\frac{16}{3}$。\n流量强度为 $\\rho = \\frac{A}{k} = \\frac{16/3}{6} = \\frac{16}{18} = \\frac{8}{9}$。\n\n我们计算爱尔朗C公式的各项，$C(6, 16/3)$。\n分母中的和为：\n$$S = \\sum_{n=0}^{k-1} \\frac{A^n}{n!} = \\sum_{n=0}^{5} \\frac{(16/3)^n}{n!} = 1 + \\frac{16}{3} + \\frac{(16/3)^2}{2!} + \\frac{(16/3)^3}{3!} + \\frac{(16/3)^4}{4!} + \\frac{(16/3)^5}{5!}$$\n$$S = 1 + \\frac{16}{3} + \\frac{128}{9} + \\frac{2048}{81} + \\frac{8192}{243} + \\frac{131072}{3645} = \\frac{3645 + 19440 + 51840 + 92160 + 122880 + 131072}{3645} = \\frac{421037}{3645}$$\n公式中的排队项是：\n$$Q = \\frac{A^k}{k!(1-\\rho)} = \\frac{(16/3)^6}{6!(1 - 8/9)} = \\frac{16^6 / 3^6}{720(1/9)} = \\frac{16777216 / 729}{80} = \\frac{16777216}{58320} = \\frac{1048576}{3645}$$\n排队概率是：\n$$P_q = C(6, 16/3) = \\frac{Q}{S+Q} = \\frac{1048576/3645}{421037/3645 + 1048576/3645} = \\frac{1048576}{1469613}$$\n现在我们计算预期排队延迟 $W_q$：\n$$W_q = \\frac{P_q}{k\\mu - \\lambda} = \\frac{1048576 / 1469613}{6 \\times 150 - 800} = \\frac{1048576 / 1469613}{100} = \\frac{1048576}{146961300} \\approx 0.00714 \\text{ s}$$\n由于 $W_q \\approx 0.00714 \\text{ s} \\leq 0.040 \\text{ s}$，对于 $k=6$ 满足 SLO。因为对于稳定系统，$W_q$ 是 $k$ 的单调递减函数，且 $k=6$ 是稳定性的最小整数值，所以它也是满足 SLO 的最小核心数。\n因此，$k_{\\mathrm{base}} = 6$。\n\n**2. 确定专用配置的最小通用核心数 $k_{\\mathrm{spec}}$**\n\n在此配置中，流量被分流。\n\n**快速通道（加速器）：**\n一部分比例为 $p=0.25$ 的到达请求被路由到这里。\n-   到达速率：$\\lambda_s = p \\lambda = 0.25 \\times 800 = 200$ 请求/秒。\n-   服务台数量：$m=2$。\n-   每个服务台的服务速率：$\\mu_s = 500$ 请求/秒。\n-   SLO 为 $W_{q,s} \\leq W_0 = 0.040$ 秒。\n\n首先，检查稳定性：$m \\mu_s = 2 \\times 500 = 1000 > \\lambda_s = 200$。系统是稳定的。\n到达负荷：$A_s = \\lambda_s / \\mu_s = 200 / 500 = 0.4$。\n流量强度：$\\rho_s = A_s / m = 0.4 / 2 = 0.2$。\n对 $m=2$ 使用爱尔朗C公式：\n$$P_{q,s} = C(2, 0.4) = \\frac{\\frac{0.4^2}{2!(1-0.2)}}{ \\frac{0.4^0}{0!} + \\frac{0.4^1}{1!} + \\frac{0.4^2}{2!(1-0.2)}} = \\frac{\\frac{0.16}{1.6}}{1 + 0.4 + \\frac{0.16}{1.6}} = \\frac{0.1}{1.4+0.1} = \\frac{0.1}{1.5} = \\frac{1}{15}$$\n预期排队延迟为：\n$$W_{q,s} = \\frac{P_{q,s}}{m\\mu_s - \\lambda_s} = \\frac{1/15}{1000 - 200} = \\frac{1/15}{800} = \\frac{1}{12000} \\approx 0.000083 \\text{ s}$$\n由于 $W_{q,s} \\ll 0.040$ 秒，快速通道满足 SLO。\n\n**通用通道：**\n剩余比例为 $(1-p) = 0.75$ 的到达请求被路由到这里。\n-   到达速率：$\\lambda_g = (1-p) \\lambda = 0.75 \\times 800 = 600$ 请求/秒。\n-   每个核心的服务速率：$\\mu = 150$ 请求/秒。\n-   核心数量为 $k_{\\mathrm{spec}}$，我们需要求出这个值。\n-   SLO 为 $W_{q,g} \\leq W_0 = 0.040$ 秒。\n\n稳定性要求：$k_{\\mathrm{spec}} \\mu > \\lambda_g \\implies k_{\\mathrm{spec}} \\times 150 > 600 \\implies k_{\\mathrm{spec}} > 4$。\n稳定性所需的最小整数核心数是 $k_{\\mathrm{spec}}=5$。\n\n我们检查 $k_{\\mathrm{spec}}=5$ 是否满足 SLO。\n到达负荷：$A_g = \\lambda_g / \\mu = 600 / 150 = 4$。\n流量强度：$\\rho_g = A_g / k_{\\mathrm{spec}} = 4 / 5 = 0.8$。\n\n我们计算爱尔朗C公式的各项，$C(5, 4)$。\n分母中的和：\n$$S_g = \\sum_{n=0}^{4} \\frac{4^n}{n!} = 1 + 4 + \\frac{4^2}{2} + \\frac{4^3}{6} + \\frac{4^4}{24} = 1 + 4 + 8 + \\frac{32}{3} + \\frac{32}{3} = 13 + \\frac{64}{3} = \\frac{103}{3}$$\n排队项：\n$$Q_g = \\frac{A_g^{k_{\\mathrm{spec}}}}{k_{\\mathrm{spec}}!(1-\\rho_g)} = \\frac{4^5}{5!(1-4/5)} = \\frac{1024}{120(1/5)} = \\frac{1024}{24} = \\frac{128}{3}$$\n排队概率：\n$$P_{q,g} = C(5, 4) = \\frac{Q_g}{S_g+Q_g} = \\frac{128/3}{103/3 + 128/3} = \\frac{128}{231}$$\n预期排队延迟为：\n$$W_{q,g} = \\frac{P_{q,g}}{k_{\\mathrm{spec}}\\mu - \\lambda_g} = \\frac{128/231}{5 \\times 150 - 600} = \\frac{128/231}{150} = \\frac{128}{34650} \\approx 0.00369 \\text{ s}$$\n由于 $W_{q,g} \\approx 0.00369 \\text{ s} \\leq 0.040 \\text{ s}$，对于 $k_{\\mathrm{spec}}=5$ 满足 SLO。这是满足稳定性的最小整数，因此是所需的核心数量。\n因此，$k_{\\mathrm{spec}} = 5$。\n\n**3. 计算通用核心的减少量 $\\Delta k$**\n\n核心的减少量是基准配置要求和专用配置要求之间的差值。\n$$\\Delta k = k_{\\mathrm{base}} - k_{\\mathrm{spec}} = 6 - 5 = 1$$\n引入专用快速通道可以在满足所有 SLO 的同时，减少 1 个通用核心。",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "在仓库规模计算机中，计算只是故事的一半；数据管理同样至关重要。由于数据分布在众多机架上，最小化跨网络的数据移动对于性能和效率至关重要。本问题挑战您分析数据复制策略如何影响跨机架网络流量，从而引导您深入理解数据放置与工作负载特性之间的相互作用 。",
            "id": "3688330",
            "problem": "考虑一个仓库级计算机（WSC），它有 $R$ 个机架和一个包含 $M$ 个数据对象的对象存储。每个对象都在 $r$ 个不同的机架上精确复制，其中 $1 \\leq r \\leq R$。每个对象的副本放置独立于请求来源，并且是在机架上无放回地均匀分布。在一个固定的时间间隔 $\\Delta t$ 内，读请求从客户端均匀地分布在各个机架上产生：每个请求的源机架是从 $R$ 个机架中均匀随机选择的。每个读请求从服务机架向请求机架传输 $B$ 字节的数据，并且每个请求由目标对象的任何可用副本提供服务。\n\n定义跨机架字节数为在时间间隔 $\\Delta t$ 内为服务请求而跨越机架边界传输的总字节数。假设副本放置与请求模式无关，评估在以下两种访问模型下的期望跨机架字节数：\n\n- 均匀访问：在 $\\Delta t$ 期间，每个对象独立地以概率 $p$ 生成一个读请求，因此预期的总读请求数为 $M p$。\n- Zipf偏斜访问：在 $\\Delta t$ 期间，预期的总读请求数也是 $M p$，但一个请求以排名为 $k \\in \\{1,2,\\dots,M\\}$ 的对象为目标的概率遵循参数为 $s > 0$ 的Zipf分布，即 $q_k = \\dfrac{k^{-s}}{H_{M,s}}$，其中 $H_{M,s} = \\sum_{i=1}^{M} i^{-s}$ 是 $s$ 阶广义调和数。\n\n假设一个请求当且仅当请求机架不包含目标对象的任何副本时，才会产生跨机架流量。计算两种访问模型的期望跨机架字节数。将你的最终答案表示为一个 $1 \\times 2$ 的行矩阵，其中第一个条目对应于均匀访问模型，第二个条目对应于Zipf偏斜访问模型。将结果以字节为单位，表示为关于 $R$、$r$、$M$、$p$ 和 $B$ 的闭式解析表达式。",
            "solution": "问题要求计算在一个仓库级计算机（WSC）中，两种不同访问模型下的期望总跨机架字节数。令 $E[C]$ 表示此期望值。\n\n首先，我们建立一个计算期望总跨机架字节数的通用框架。总跨机架字节数 $C$ 是所有跨越机架边界的单个请求的字节数之和。设 $N$ 为时间间隔 $\\Delta t$ 内的总读请求数。对于每个请求 $i \\in \\{1, 2, \\dots, N\\}$，设 $C_i$ 为跨机架传输的字节数。一个请求当且仅当请求机架不包含目标对象的副本时，会产生 $B$ 字节的跨机架流量；否则，跨机架流量为 $0$。\n\n设 $I_i$ 是一个指示随机变量，如果请求 $i$ 是一个跨机架请求，则 $I_i=1$，否则 $I_i=0$。那么 $C_i = B \\cdot I_i$。总跨机架字节数为 $C = \\sum_{i=1}^{N} C_i = \\sum_{i=1}^{N} B \\cdot I_i$。\n\n期望总跨机架字节数为 $E[C] = E\\left[\\sum_{i=1}^{N} B \\cdot I_i\\right]$。由于每次传输的大小 $B$ 是一个常数，我们有 $E[C] = B \\cdot E\\left[\\sum_{i=1}^{N} I_i\\right]$。\n问题陈述，对于两种访问模型，每个请求的来源都是均匀随机选择的，并且副本放置与访问模式无关。这意味着每个请求都可以被视为一个独立的试验，具有相同的成为跨机架请求的概率。设这个概率为 $P_{\\text{cross}}$。随机变量 $I_i$ 是独立同分布的伯努利变量，其均值为 $E[I_i] = P_{\\text{cross}}$。总请求数 $N$ 本身是一个随机变量。根据瓦尔德等式（当一个和式中的项数是随机变量时适用），和的期望是项数的期望与每一项的期望的乘积。\n$$E[C] = B \\cdot E[N] \\cdot E[I_i]$$\n问题明确指出，对于两种模型，预期的总请求数都是 $E[N] = Mp$。这里，$M$ 是对象数量，$p$ 是一个给定的概率参数。因此，方程变为：\n$$E[C] = M p B \\cdot P_{\\text{cross}}$$\n因此，我们的主要任务是确定 $P_{\\text{cross}}$，即一个任意请求是跨机架请求的概率。\n\n如果请求的源机架不包含所请求对象的副本，则该请求是跨机架的。设 $S$ 是请求源机架的随机变量，$O$ 是被请求对象的随机变量。设 $\\mathcal{R}(O)$ 是存储对象 $O$ 的副本的 $r$ 个不同机架的集合。\n跨机架请求的事件是 $S \\notin \\mathcal{R}(O)$。因此，$P_{\\text{cross}} = P(S \\notin \\mathcal{R}(O))$。\n首先计算其互补概率 $P(S \\in \\mathcal{R}(O))$ 会更容易，这是请求在本地（机架内）得到服务的概率。\n$$P_{\\text{cross}} = 1 - P(S \\in \\mathcal{R}(O))$$\n问题陈述：\n1.  源机架 $S$ 是从 $R$ 个可用机架中均匀随机选择的。因此，对于任何特定的机架 $s_j$，$P(S=s_j) = 1/R$。\n2.  对于任何对象 $O$，其 $r$ 个副本被放置在一组机架 $\\mathcal{R}(O)$ 上，该组机架是从 $R$ 个机架中无放回地均匀随机选择的。\n\n让我们通过以对象 $O$ 的一组固定的副本位置为条件来计算 $P(S \\in \\mathcal{R}(O))$。设这个固定的集合为 $\\mathcal{R}_O$。由于 $S$ 是从 $R$ 个机架中均匀选择的，并且 $|\\mathcal{R}_O| = r$，因此 $S$ 落入这个特定集合的概率是：\n$$P(S \\in \\mathcal{R}_O | \\mathcal{R}(O) = \\mathcal{R}_O) = \\frac{|\\mathcal{R}_O|}{R} = \\frac{r}{R}$$\n由于无论副本集 $\\mathcal{R}_O$ 的具体选择如何，这个概率 $\\frac{r}{R}$ 都是相同的，因此无条件概率也是 $\\frac{r}{R}$。\n$$P(S \\in \\mathcal{R}(O)) = \\frac{r}{R}$$\n这个概率是针对一个特定对象 $O$ 的请求。现在我们必须考虑到被请求的对象本身也是一个随机变量。设 $q_k$ 是一个请求以排名为 $k$ 的对象为目标的概率，其中 $k \\in \\{1, 2, \\dots, M\\}$。概率集合 $\\{q_k\\}$ 定义了访问模式。一个机架内请求的总概率是通过对所有可能的对象求和得到的：\n$$P(S \\in \\mathcal{R}(O)) = \\sum_{k=1}^{M} P(S \\in \\mathcal{R}(O_k) | \\text{object is } O_k) \\cdot P(\\text{object is } O_k)$$\n问题陈述，副本放置与请求模式无关。这意味着对象 $O_k$ 的放置策略对所有 $k$ 都是相同的，并且不依赖于其流行度 $q_k$。因此，对于任何特定对象 $O_k$ 的本地命中概率是 $P(S \\in \\mathcal{R}(O_k)) = \\frac{r}{R}$。\n将此代入和式中：\n$$P(S \\in \\mathcal{R}(O)) = \\sum_{k=1}^{M} \\left(\\frac{r}{R}\\right) q_k = \\frac{r}{R} \\sum_{k=1}^{M} q_k$$\n由于 $\\{q_k\\}$ 是 $M$ 个对象上的一个概率分布，所以 $\\sum_{k=1}^{M} q_k = 1$。\n因此，机架内请求的概率是：\n$$P(S \\in \\mathcal{R}(O)) = \\frac{r}{R}$$\n这个关键结果表明，对于任何给定的请求，本地命中的概率与对象访问模式无关（即，与 $\\{q_k\\}$ 的具体分布无关），这是由于副本放置与访问模式无关且均匀分布的假设。\n\n因此，跨机架请求的概率也与访问模式无关：\n$$P_{\\text{cross}} = 1 - P(S \\in \\mathcal{R}(O)) = 1 - \\frac{r}{R} = \\frac{R-r}{R}$$\n现在我们可以计算期望的总跨机架字节数：\n$$E[C] = M p B \\cdot P_{\\text{cross}} = M p B \\frac{R-r}{R}$$\n只要预期的总请求数为 $Mp$ 并且满足放置假设，这个表达式对于任何访问模式都成立。\n\n**情况1：均匀访问模型**\n问题陈述，预期的总读请求数为 $M p$。如上所述，期望的跨机架字节数将是 $M p B \\frac{R-r}{R}$。\n\n**情况2：Zipf偏斜访问模型**\n问题陈述，预期的总读请求数也是 $M p$。尽管请求单个对象的概率 $q_k$ 遵循Zipf分布，我们的推导表明，最终的期望跨机架流量与 $\\{q_k\\}$ 的具体形式无关。因此，在给定的假设下，参数 $s$ 和 $H_{M,s}$ 对于计算是不需要的。期望的跨机架字节数将与均匀访问情况下的相同：$M p B \\frac{R-r}{R}$。\n\n两种模型对期望总跨机架字节数得出了相同的结果。最终答案是一个包含两个相同条目的 $1 \\times 2$ 矩阵。",
            "answer": "$$\\boxed{\\begin{pmatrix} M p B \\frac{R-r}{R} & M p B \\frac{R-r}{R} \\end{pmatrix}}$$"
        }
    ]
}