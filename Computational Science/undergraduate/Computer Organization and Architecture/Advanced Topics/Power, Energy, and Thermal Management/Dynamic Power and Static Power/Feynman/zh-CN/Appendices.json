{
    "hands_on_practices": [
        {
            "introduction": "本练习将探讨一个经典的设计选择：是采用速度快但面积大的组合逻辑乘法器，还是采用速度慢但面积小的迭代式乘法器。这个案例完美地揭示了动态能耗、静态能耗和性能（执行时间）之间的权衡关系。通过求解两种设计能耗相等的“盈亏平衡点”，你将深化对执行时间如何关键性地影响总能耗（尤其是静态泄漏能耗）的理解。",
            "id": "3638046",
            "problem": "一个设计团队正在评估两种用于长度为 $n$ 位操作数的无符号乘法器微架构，它们采用互补金属氧化物半导体（CMOS）技术实现，在电源电压为 $V$、时钟频率为 $f$ 的条件下工作。其中一种是全组合阵列乘法器，在一个时钟周期内完成计算；另一种是位串行迭代乘法器，需要 $n$ 个时钟周期。\n\n基本原理与建模假设：\n- 将电容从 $0$ 充电到 $V$ 会储存能量 $\\frac{1}{2} C V^{2}$，随后的放电会消耗该能量；在许多节点和周期中，每个周期的平均动态能耗可以建模为 $\\alpha \\, C_{\\mathrm{eq}} \\, V^{2}$，其中 $\\alpha$ 是平均活动因子，$C_{\\mathrm{eq}}$ 是聚合了所有翻转节点的等效开关电容。\n- 静态（漏电）功率建模为 $P_{\\mathrm{leak}} = I_{\\mathrm{leak}} \\, V$，因此在时间 $t$ 内的漏电能耗为 $E_{\\mathrm{leak}} = I_{\\mathrm{leak}} \\, V \\, t$。\n\n以下依赖于技术和微架构的参数被认为是经过实验校准并提供的：\n- 电源电压 $V = 0.8\\,\\mathrm{V}$ 和时钟频率 $f = 1.0 \\times 10^{9}\\,\\mathrm{Hz}$。\n- 组合乘法器：\n  - 每个周期的平均活动因子 $\\alpha_{\\mathrm{comb}} = 0.15$。\n  - 等效开关电容缩放 $C_{\\mathrm{comb}}(n) = k_{C} \\, n^{2}$，其中 $k_{C} = 0.4 \\times 10^{-15}\\,\\mathrm{F}$。\n  - 漏电流缩放 $I_{\\mathrm{leak,comb}}(n) = k_{I} \\, n^{2}$，其中 $k_{I} = 0.8 \\times 10^{-9}\\,\\mathrm{A}$。\n- 迭代位串行乘法器：\n  - 每个周期的平均活动因子 $\\alpha_{\\mathrm{iter}} = 0.10$。\n  - 每周期等效开关电容 $C_{0} = 20 \\times 10^{-15}\\,\\mathrm{F}$。\n  - 漏电流 $I_{\\mathrm{leak,iter}}(n) = I_{0} + I_{1} \\, n$，其中 $I_{0} = 5.0 \\times 10^{-9}\\,\\mathrm{A}$ 且 $I_{1} = 0.05 \\times 10^{-9}\\,\\mathrm{A}$。\n\n仅使用上述基本原理，推导每种设计每次乘法运算的总能耗表达式，并确定使迭代设计的每次乘法总能耗与组合设计相等的操作数长度 $n$。将您的最终数值结果四舍五入到三位有效数字，并将其报告为对应于比特的纯数字（不要在最终答案框中包含单位）。",
            "solution": "用户要求对问题陈述进行严格验证，如果问题被认为是有效的，则提供完整的解答。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n\n问题提供了以下数据和模型：\n-   操作数长度为 $n$ 位。\n-   电源电压：$V = 0.8\\,\\mathrm{V}$\n-   时钟频率：$f = 1.0 \\times 10^{9}\\,\\mathrm{Hz}$\n-   每周期平均动态能耗模型：$E_{\\mathrm{dyn,cycle}} = \\alpha \\, C_{\\mathrm{eq}} \\, V^{2}$\n-   静态（漏电）能耗模型：$E_{\\mathrm{leak}} = I_{\\mathrm{leak}} \\, V \\, t$\n\n-   **组合阵列乘法器：**\n    -   执行时间：$1$ 个时钟周期。\n    -   平均活动因子：$\\alpha_{\\mathrm{comb}} = 0.15$\n    -   等效开关电容：$C_{\\mathrm{comb}}(n) = k_{C} \\, n^{2}$，其中 $k_{C} = 0.4 \\times 10^{-15}\\,\\mathrm{F}$。\n    -   漏电流：$I_{\\mathrm{leak,comb}}(n) = k_{I} \\, n^{2}$，其中 $k_{I} = 0.8 \\times 10^{-9}\\,\\mathrm{A}$。\n\n-   **迭代位串行乘法器：**\n    -   执行时间：$n$ 个时钟周期。\n    -   每个周期的平均活动因子：$\\alpha_{\\mathrm{iter}} = 0.10$\n    -   每周期等效开关电容：$C_{0} = 20 \\times 10^{-15}\\,\\mathrm{F}$。\n    -   漏电流：$I_{\\mathrm{leak,iter}}(n) = I_{0} + I_{1} \\, n$，其中 $I_{0} = 5.0 \\times 10^{-9}\\,\\mathrm{A}$ 且 $I_{1} = 0.05 \\times 10^{-9}\\,\\mathrm{A}$。\n\n**步骤2：使用提取的已知条件进行验证**\n\n根据指定标准对问题进行评估：\n-   **科学依据**：所提出的动态和静态能耗模型是数字VLSI电路分析中使用的标准一阶近似。阵列乘法器的电容（$C \\propto n^2$）和漏电（$I_{\\mathrm{leak}} \\propto n^2$）缩放模型正确反映了其面积增长，而迭代设计的线性漏电模型是一个合理的简化。该问题牢固地植根于计算机组成和数字电子学的原理。\n-   **适定性**：问题是适定的。它要求计算单个变量 $n$ 的值，在该值下，两个不同系统的总能耗相等。所有必要的参数和函数依赖关系都已明确提供，从而可以得到一个可解的代数方程。\n-   **客观性**：问题使用精确的技术语言陈述，没有主观性或歧义。\n-   所有其他验证检查均已通过。该问题没有科学缺陷，是可形式化的、完整的，并基于合理的工程模型提出了一个有深度的问题。\n\n**步骤3：结论与行动**\n\n此问题是**有效的**。将提供完整的解答。\n\n### 解题推导\n\n目标是找到操作数长度 $n$，使得组合设计的每次乘法总能耗 $E_{\\mathrm{total,comb}}(n)$ 等于迭代设计的每次乘法总能耗 $E_{\\mathrm{total,iter}}(n)$。\n\n**1. 组合乘法器的总能耗**\n\n总能耗是一次乘法运算中动态能耗和静态（漏电）能耗的总和，该运算需要一个时钟周期。一个时钟周期的持续时间是 $t_{\\mathrm{comb}} = \\frac{1}{f}$。\n\n-   **动态能耗 ($E_{\\mathrm{dyn,comb}}$):**\n    动态能耗在单个周期内消耗。\n    $$E_{\\mathrm{dyn,comb}}(n) = \\alpha_{\\mathrm{comb}} \\, C_{\\mathrm{comb}}(n) \\, V^{2} = \\alpha_{\\mathrm{comb}} (k_{C} n^{2}) V^{2}$$\n\n-   **漏电能耗 ($E_{\\mathrm{leak,comb}}$):**\n    漏电能耗是漏电功率乘以执行时间。\n    $$E_{\\mathrm{leak,comb}}(n) = I_{\\mathrm{leak,comb}}(n) \\, V \\, t_{\\mathrm{comb}} = (k_{I} n^{2}) \\, V \\, \\frac{1}{f}$$\n\n-   **总能耗 ($E_{\\mathrm{total,comb}}$):**\n    $$E_{\\mathrm{total,comb}}(n) = E_{\\mathrm{dyn,comb}}(n) + E_{\\mathrm{leak,comb}}(n) = \\alpha_{\\mathrm{comb}} k_{C} n^{2} V^{2} + \\frac{k_{I} n^{2} V}{f}$$\n    提取公因式 $n^2$：\n    $$E_{\\mathrm{total,comb}}(n) = \\left( \\alpha_{\\mathrm{comb}} k_{C} V^{2} + \\frac{k_{I} V}{f} \\right) n^{2}$$\n\n**2. 迭代乘法器的总能耗**\n\n这次乘法需要 $n$ 个时钟周期。总持续时间为 $t_{\\mathrm{iter}} = n \\times \\frac{1}{f} = \\frac{n}{f}$。\n\n-   **动态能耗 ($E_{\\mathrm{dyn,iter}}$):**\n    每个周期的动态能耗是恒定的，$E_{\\mathrm{dyn,cycle,iter}} = \\alpha_{\\mathrm{iter}} C_{0} V^{2}$。$n$ 个周期内的总动态能耗为：\n    $$E_{\\mathrm{dyn,iter}}(n) = n \\times (\\alpha_{\\mathrm{iter}} C_{0} V^{2})$$\n\n-   **漏电能耗 ($E_{\\mathrm{leak,iter}}$):**\n    漏电能耗是漏电功率乘以总执行时间。\n    $$E_{\\mathrm{leak,iter}}(n) = I_{\\mathrm{leak,iter}}(n) \\, V \\, t_{\\mathrm{iter}} = (I_{0} + I_{1} n) \\, V \\, \\frac{n}{f} = \\frac{I_{0} V n}{f} + \\frac{I_{1} V n^{2}}{f}$$\n\n-   **总能耗 ($E_{\\mathrm{total,iter}}$):**\n    $$E_{\\mathrm{total,iter}}(n) = E_{\\mathrm{dyn,iter}}(n) + E_{\\mathrm{leak,iter}}(n) = n \\alpha_{\\mathrm{iter}} C_{0} V^{2} + \\frac{I_{0} V n}{f} + \\frac{I_{1} V n^{2}}{f}$$\n    按 $n$ 的幂次对项进行分组：\n    $$E_{\\mathrm{total,iter}}(n) = \\left( \\frac{I_{1} V}{f} \\right) n^{2} + \\left( \\alpha_{\\mathrm{iter}} C_{0} V^{2} + \\frac{I_{0} V}{f} \\right) n$$\n\n**3. 令能量相等并求解 n**\n\n我们设 $E_{\\mathrm{total,comb}}(n) = E_{\\mathrm{total,iter}}(n)$:\n$$\\left( \\alpha_{\\mathrm{comb}} k_{C} V^{2} + \\frac{k_{I} V}{f} \\right) n^{2} = \\left( \\frac{I_{1} V}{f} \\right) n^{2} + \\left( \\alpha_{\\mathrm{iter}} C_{0} V^{2} + \\frac{I_{0} V}{f} \\right) n$$\n对于一个有实际意义的乘法器，$n \\neq 0$，所以我们可以将两边同除以 $n$:\n$$\\left( \\alpha_{\\mathrm{comb}} k_{C} V^{2} + \\frac{k_{I} V}{f} \\right) n = \\left( \\frac{I_{1} V}{f} \\right) n + \\left( \\alpha_{\\mathrm{iter}} C_{0} V^{2} + \\frac{I_{0} V}{f} \\right)$$\n重新整理以求解 $n$：\n$$\\left( \\alpha_{\\mathrm{comb}} k_{C} V^{2} + \\frac{k_{I} V}{f} - \\frac{I_{1} V}{f} \\right) n = \\alpha_{\\mathrm{iter}} C_{0} V^{2} + \\frac{I_{0} V}{f}$$\n$$n = \\frac{\\alpha_{\\mathrm{iter}} C_{0} V^{2} + \\frac{I_{0} V}{f}}{\\alpha_{\\mathrm{comb}} k_{C} V^{2} + \\frac{(k_{I} - I_{1}) V}{f}}$$\n为了简化，我们可以将分子和分母同乘以 $\\frac{f}{V}$:\n$$n = \\frac{\\alpha_{\\mathrm{iter}} C_{0} V f + I_{0}}{\\alpha_{\\mathrm{comb}} k_{C} V f + k_{I} - I_{1}}$$\n\n**4. 数值计算**\n\n将给定值代入 $n$ 的表达式中：\n-   $V = 0.8$\n-   $f = 1.0 \\times 10^{9}$\n-   $\\alpha_{\\mathrm{comb}} = 0.15$\n-   $k_{C} = 0.4 \\times 10^{-15}$\n-   $k_{I} = 0.8 \\times 10^{-9}$\n-   $\\alpha_{\\mathrm{iter}} = 0.10$\n-   $C_{0} = 20 \\times 10^{-15}$\n-   $I_{0} = 5.0 \\times 10^{-9}$\n-   $I_{1} = 0.05 \\times 10^{-9}$\n\n分子：\n$$ \\alpha_{\\mathrm{iter}} C_{0} V f + I_{0} = (0.10)(20 \\times 10^{-15})(0.8)(1.0 \\times 10^{9}) + (5.0 \\times 10^{-9}) $$\n$$ = 1.6 \\times 10^{-6} + 5.0 \\times 10^{-9} = 1.6 \\times 10^{-6} + 0.005 \\times 10^{-6} = 1.605 \\times 10^{-6} $$\n\n分母：\n$$ \\alpha_{\\mathrm{comb}} k_{C} V f + k_{I} - I_{1} = (0.15)(0.4 \\times 10^{-15})(0.8)(1.0 \\times 10^{9}) + (0.8 \\times 10^{-9}) - (0.05 \\times 10^{-9}) $$\n$$ = 0.048 \\times 10^{-6} + 0.75 \\times 10^{-9} = 4.8 \\times 10^{-8} + 0.075 \\times 10^{-8} = 4.875 \\times 10^{-8} $$\n\n$n$ 的计算：\n$$ n = \\frac{1.605 \\times 10^{-6}}{4.875 \\times 10^{-8}} = \\frac{160.5 \\times 10^{-8}}{4.875 \\times 10^{-8}} \\approx 32.9230769... $$\n\n四舍五入到三位有效数字，结果是 $32.9$。",
            "answer": "$$ \\boxed{32.9} $$"
        },
        {
            "introduction": "在上一练习的基础上，本题将更深入地探讨动态功耗。通过比较阵列乘法器和布斯（Booth）乘法器，你将分析不同的微架构技术如何影响开关活动因子 $\\alpha$。这项动手计算将证明，功耗优化不仅与电路规模有关，更涉及到数据处理和硬件结构的精细细节。",
            "id": "3638068",
            "problem": "一个处理器数据通路必须支持在互补金属氧化物半导体（CMOS）中进行有符号$N$位乘法。对于 $N = 16$ 的情况，正在考虑两种微架构选项：\n- 一种常规的 $16 \\times 16$ 阵列乘法器，它形成所有简单部分积，并使用一个进位保留加法器（CSA）阵列和一个随后的进位传播加法器（CPA）对其进行归约，以及\n- 一种基$4$ Booth重编码乘法器，它将部分积行的数量减少大约$2$倍，并使用多路复用的部分积生成。\n\n设计团队希望比较在实际工作负载混合下的期望动态功耗。假设以下基本和建模前提：\n- 在有效电容 $C$ 上的每次 $0 \\rightarrow 1$ 逻辑电平充电事件会从电源汲取能量 $E = \\frac{1}{2} C V^{2}$。在具有独立输入的多个周期中，某个节点的逻辑值在任何周期内都是一个 $\\Pr\\{1\\} = p$ 的 Bernoulli 随机变量，该节点发生 $0 \\rightarrow 1$ 事件的概率为 $\\alpha(p) = (1-p)p$。\n- 对于一个具有三个独立 Bernoulli 输入（其为1的概率均为 $p$）的一位全加器，其输出端为1的概率分别为 $p_{\\text{sum}}(p) = 3p - 6p^{2} + 4p^{3}$ 和 $p_{\\text{car}}(p) = 3p^{2} - 2p^{3}$。使用 $\\alpha_{\\text{sum}}(p) = \\alpha(p_{\\text{sum}}(p))$ 和 $\\alpha_{\\text{car}}(p) = \\alpha(p_{\\text{car}}(p))$。\n- 将跨周期的连续操作数对视为独立的。忽略空间相关性，并将每个CSA全加器的输入建模为独立的，其为1的概率等于该工作负载下部分积位为1的概率。对于CPA，将其每位的等效 $0 \\rightarrow 1$ 转换概率近似为 $\\alpha_{\\text{CPA}} = 0.25$，且与工作负载无关。假设两种架构的静态（漏电）功耗相同，在比较中可以忽略。\n\n架构和电路级参数如下：\n- 电源电压 $V = 0.9\\,\\mathrm{V}$，时钟频率 $f = 1.0 \\times 10^{9}\\,\\mathrm{Hz}$。\n- 阵列乘法器：\n  - 部分积生成使用 $16 \\times 16 = 256$ 个独立的一位与门节点，每个节点的每位等效开关电容为 $C_{\\text{pp}} = 1.0 \\times 10^{-15}\\,\\mathrm{F}$。\n  - CSA归约被建模为 $(R-2)$ 层，每层有 $16$ 个一位全加器，其中 $R = 16$ 是部分积行的数量。因此总共有 $224$ 个全加器单元。每个全加器单元的和输出与进位输出的等效电容分别为 $C_{\\text{sum}} = 1.5 \\times 10^{-15}\\,\\mathrm{F}$ 和 $C_{\\text{car}} = 1.5 \\times 10^{-15}\\,\\mathrm{F}$。\n  - 最终的CPA为 $32$ 位宽，每位的等效开关电容为 $C_{\\text{CPA}} = 3.0 \\times 10^{-15}\\,\\mathrm{F}$，该电容包含了其内部节点和输出。\n- 基$4$ Booth乘法器：\n  - 部分积行的有效数量为 $R_{B} = 9$。将部分积生成建模为 $R_{B} \\times 16 = 144$ 个多路复用位节点，每个节点的等效开关电容为 $C_{\\text{pp,B}} = C_{\\text{pp}} + C_{\\text{mux}}$，其中 $C_{\\text{mux}} = 1.0 \\times 10^{-15}\\,\\mathrm{F}$。\n  - CSA归约使用 $(R_{B} - 2) = 7$ 层，每层有 $16$ 个全加器，即 $112$ 个全加器单元，其 $C_{\\text{sum}}$ 和 $C_{\\text{car}}$ 与上述相同。\n  - 最终的CPA与阵列乘法器情况相同（$32$ 位，电容为 $C_{\\text{CPA}}$）。\n- 工作负载：\n  - 随机情况：两个操作数都是独立同分布的，每位为1的概率为 $p_{A} = p_{B} = 0.5$。将任何简单部分积位为1的概率建模为 $p_{\\text{pp}} = p_{A} p_{B}$，并且对于Booth情况，为进行估算，假设生成的部分积行中位为1的概率与简单部分积模型相同。\n  - 结构化情况：一个操作数保持每位为1的概率为 $p_{A} = 0.5$，另一个是稀疏的，每位为1的概率为 $p_{B} = r$，其中 $r = 0.1$，且各位之间独立。使用 $p_{\\text{pp}} = p_{A} p_{B}$，并且对Booth情况使用与上述相同的估算。\n- 混合：一部分比例为 $q = 0.6$ 的周期是随机情况，一部分比例为 $(1-q)$ 的周期是结构化情况。\n\n设一个实现的期望动态功耗通过对所有独立节点求和来计算，求和项为其等效开关电容与 $0 \\rightarrow 1$ 转换概率的乘积，再乘以 $V^{2}$ 和 $f$。\n\n在给定的建模假设下，计算在混合工作负载下平均的Booth乘法器与阵列乘法器的期望动态功耗之比，即 $\\frac{P_{\\text{Booth}}}{P_{\\text{Array}}}$。将您的答案表示为一个无量纲数，并将最终结果四舍五入到四位有效数字。",
            "solution": "目标是计算基$4$ Booth乘法器与常规阵列乘法器的期望动态功耗之比，即 $\\frac{P_{\\text{Booth}}}{P_{\\text{Array}}}$。CMOS电路的动态功耗由对节点电容进行充放电所消耗的功率之和给出。对于一个具有多个节点的电路，总动态功耗 $P$ 可以表示为 $P = f V^2 \\sum_i C_i \\alpha_i$，其中 $f$ 是时钟频率，$V$ 是电源电压，$C_i$ 是节点 $i$ 的电容，$\\alpha_i$ 是节点 $i$ 的活动因子（$0 \\rightarrow 1$ 转换的概率）。\n\n项 $\\sum_i C_i \\alpha_i$ 是电路的总等效开关电容，我们将其表示为 $C'$。由于两种架构的频率 $f$ 和电压 $V$ 相同，它们的功耗之比等于它们在工作负载混合下平均的总等效开关电容之比：\n$$\n\\frac{P_{\\text{Booth}}}{P_{\\text{Array}}} = \\frac{f V^2 C'_{\\text{Booth, avg}}}{f V^2 C'_{\\text{Array, avg}}} = \\frac{C'_{\\text{Booth, avg}}}{C'_{\\text{Array, avg}}}\n$$\n每种架构的总等效开关电容 $C'$ 是其三个主要组成部分贡献的总和：部分积（PP）生成、进位保留加法器（CSA）阵列和最终的进位传播加法器（CPA）。\n$$\nC' = C'_{\\text{PP}} + C'_{\\text{CSA}} + C'_{\\text{CPA}}\n$$\n问题指定了一个工作负载混合：一部分比例为 $q=0.6$ 的周期是“随机”的，一部分比例为 $1-q=0.4$ 的周期是“结构化”的。平均等效开关电容是加权平均值：\n$$\nC'_{\\text{avg}} = q \\cdot C'_{\\text{rand}} + (1-q) \\cdot C'_{\\text{struct}}\n$$\n我们必须首先计算每种工作负载的活动因子。对于一个为1的概率为 $p$ 的节点，其活动因子 $\\alpha(p)$ 为 $\\alpha(p) = p(1-p)$。\n\n**1. 工作负载参数和活动因子计算**\n\n**随机工作负载：**\n输入操作数位为1的概率是 $p_A = 0.5$ 和 $p_B = 0.5$。一个简单部分积位为1的概率是 $p_{\\text{pp,rand}} = p_A p_B = 0.5 \\times 0.5 = 0.25$。\n- 部分积节点活动因子：$\\alpha_{\\text{pp,rand}} = p_{\\text{pp,rand}}(1-p_{\\text{pp,rand}}) = 0.25(1-0.25) = 0.1875$。\n- CSA全加器（FA）节点活动因子（对于 $p = 0.25$）：\n  - 和输出为1的概率：$p_{\\text{sum}}(0.25) = 3(0.25) - 6(0.25)^2 + 4(0.25)^3 = 0.75 - 0.375 + 0.0625 = 0.4375$。\n  - 和输出活动因子：$\\alpha_{\\text{sum,rand}} = 0.4375(1-0.4375) = 0.24609375$。\n  - 进位输出为1的概率：$p_{\\text{car}}(0.25) = 3(0.25)^2 - 2(0.25)^3 = 0.1875 - 0.03125 = 0.15625$。\n  - 进位输出活动因子：$\\alpha_{\\text{car,rand}} = 0.15625(1-0.15625) = 0.1318359375$。\n\n**结构化工作负载：**\n为1的概率是 $p_A = 0.5$ 和 $p_B = 0.1$。一个部分积位为1的概率是 $p_{\\text{pp,struct}} = p_A p_B = 0.5 \\times 0.1 = 0.05$。\n- 部分积节点活动因子：$\\alpha_{\\text{pp,struct}} = 0.05(1-0.05) = 0.0475$。\n- CSA FA节点活动因子（对于 $p = 0.05$）：\n  - 和输出为1的概率：$p_{\\text{sum}}(0.05) = 3(0.05) - 6(0.05)^2 + 4(0.05)^3 = 0.15 - 0.015 + 0.0005 = 0.1355$。\n  - 和输出活动因子：$\\alpha_{\\text{sum,struct}} = 0.1355(1-0.1355) = 0.11712475$。\n  - 进位输出为1的概率：$p_{\\text{car}}(0.05) = 3(0.05)^2 - 2(0.05)^3 = 0.0075 - 0.00025 = 0.00725$。\n  - 进位输出活动因子：$\\alpha_{\\text{car,struct}} = 0.00725(1-0.00725) = 0.0071971875$。\n\n**2. 等效开关电容计算**\n\n首先，我们计算每种工作负载下单个FA单元的开关电容。\n$C'_{\\text{FA}}(p) = C_{\\text{sum}}\\alpha_{\\text{sum}}(p) + C_{\\text{car}}\\alpha_{\\text{car}}(p)$。给定 $C_{\\text{sum}} = C_{\\text{car}} = 1.5 \\times 10^{-15}\\,\\mathrm{F}$：\n- 随机：$C'_{\\text{FA,rand}} = (1.5 \\times 10^{-15})(\\alpha_{\\text{sum,rand}} + \\alpha_{\\text{car,rand}}) = (1.5 \\times 10^{-15})(0.24609375 + 0.1318359375) = 0.56689453125 \\times 10^{-15}\\,\\mathrm{F}$。\n- 结构化：$C'_{\\text{FA,struct}} = (1.5 \\times 10^{-15})(\\alpha_{\\text{sum,struct}} + \\alpha_{\\text{car,struct}}) = (1.5 \\times 10^{-15})(0.11712475 + 0.0071971875) = 0.18648290625 \\times 10^{-15}\\,\\mathrm{F}$。\n\nCPA的贡献在所有情况下都是恒定的：\n$C'_{\\text{CPA}} = N_{\\text{CPA}} C_{\\text{CPA}} \\alpha_{\\text{CPA}} = 32 \\times (3.0 \\times 10^{-15}\\,\\mathrm{F}) \\times 0.25 = 24 \\times 10^{-15}\\,\\mathrm{F}$。\n\n现在我们为每个架构和工作负载计算总的 $C'$。\n\n**阵列乘法器：**\n$N_{\\text{pp,A}} = 256$, $C_{\\text{pp}} = 1.0 \\times 10^{-15}\\,\\mathrm{F}$, $N_{\\text{FA,A}} = 224$。\n- 随机工作负载：\n  $C'_{\\text{Array,rand}} = N_{\\text{pp,A}} C_{\\text{pp}} \\alpha_{\\text{pp,rand}} + N_{\\text{FA,A}} C'_{\\text{FA,rand}} + C'_{\\text{CPA}}$\n  $C'_{\\text{Array,rand}} = [256 \\times (1.0 \\times 10^{-15}) \\times 0.1875] + [224 \\times (0.56689453125 \\times 10^{-15})] + [24 \\times 10^{-15}]$\n  $C'_{\\text{Array,rand}} = [48 + 126.984375 + 24] \\times 10^{-15} = 198.984375 \\times 10^{-15}\\,\\mathrm{F}$。\n- 结构化工作负载：\n  $C'_{\\text{Array,struct}} = N_{\\text{pp,A}} C_{\\text{pp}} \\alpha_{\\text{pp,struct}} + N_{\\text{FA,A}} C'_{\\text{FA,struct}} + C'_{\\text{CPA}}$\n  $C'_{\\text{Array,struct}} = [256 \\times (1.0 \\times 10^{-15}) \\times 0.0475] + [224 \\times (0.18648290625 \\times 10^{-15})] + [24 \\times 10^{-15}]$\n  $C'_{\\text{Array,struct}} = [12.16 + 41.772171 + 24] \\times 10^{-15} = 77.932171 \\times 10^{-15}\\,\\mathrm{F}$。\n\n**基-4 Booth乘法器：**\n$N_{\\text{pp,B}} = 144$, $C_{\\text{pp,B}} = C_{\\text{pp}} + C_{\\text{mux}} = 2.0 \\times 10^{-15}\\,\\mathrm{F}$, $N_{\\text{FA,B}} = 112$。\n- 随机工作负载：\n  $C'_{\\text{Booth,rand}} = N_{\\text{pp,B}} C_{\\text{pp,B}} \\alpha_{\\text{pp,rand}} + N_{\\text{FA,B}} C'_{\\text{FA,rand}} + C'_{\\text{CPA}}$\n  $C'_{\\text{Booth,rand}} = [144 \\times (2.0 \\times 10^{-15}) \\times 0.1875] + [112 \\times (0.56689453125 \\times 10^{-15})] + [24 \\times 10^{-15}]$\n  $C'_{\\text{Booth,rand}} = [54 + 63.4921875 + 24] \\times 10^{-15} = 141.4921875 \\times 10^{-15}\\,\\mathrm{F}$。\n- 结构化工作负载：\n  $C'_{\\text{Booth,struct}} = N_{\\text{pp,B}} C_{\\text{pp,B}} \\alpha_{\\text{pp,struct}} + N_{\\text{FA,B}} C'_{\\text{FA,struct}} + C'_{\\text{CPA}}$\n  $C'_{\\text{Booth,struct}} = [144 \\times (2.0 \\times 10^{-15}) \\times 0.0475] + [112 \\times (0.18648290625 \\times 10^{-15})] + [24 \\times 10^{-15}]$\n  $C'_{\\text{Booth,struct}} = [13.68 + 20.8860855 + 24] \\times 10^{-15} = 58.5660855 \\times 10^{-15}\\,\\mathrm{F}$。\n\n**3. 混合平均计算与最终比率**\n该混合包含 $q=0.6$ 的随机周期和 $1-q=0.4$ 的结构化周期。\n- 阵列乘法器的平均值：\n  $C'_{\\text{Array,avg}} = 0.6 \\times C'_{\\text{Array,rand}} + 0.4 \\times C'_{\\text{Array,struct}}$\n  $C'_{\\text{Array,avg}} = (0.6 \\times 198.984375 + 0.4 \\times 77.932171) \\times 10^{-15}$\n  $C'_{\\text{Array,avg}} = (119.390625 + 31.1728684) \\times 10^{-15} = 150.5634934 \\times 10^{-15}\\,\\mathrm{F}$。\n- Booth乘法器的平均值：\n  $C'_{\\text{Booth,avg}} = 0.6 \\times C'_{\\text{Booth,rand}} + 0.4 \\times C'_{\\text{Booth,struct}}$\n  $C'_{\\text{Booth,avg}} = (0.6 \\times 141.4921875 + 0.4 \\times 58.5660855) \\times 10^{-15}$\n  $C'_{\\text{Booth,avg}} = (84.8953125 + 23.4264342) \\times 10^{-15} = 108.3217467 \\times 10^{-15}\\,\\mathrm{F}$。\n\n最后，所要求的比率为：\n$$\n\\frac{P_{\\text{Booth}}}{P_{\\text{Array}}} = \\frac{C'_{\\text{Booth, avg}}}{C'_{\\text{Array, avg}}} = \\frac{108.3217467 \\times 10^{-15}}{150.5634934 \\times 10^{-15}} \\approx 0.7194358\n$$\n四舍五入到四位有效数字，比率为 $0.7194$。",
            "answer": "$$\\boxed{0.7194}$$"
        },
        {
            "introduction": "最后的这个练习将视角从单个组件提升到完整的系统层面。你将通过整合来自不同功能单元、时钟树和静态泄漏的贡献，来计算CPU执行每条指令的平均能耗。本练习综合了所有核心概念，展示了架构师如何评估整个指令集的能耗影响，并衡量指令集架构（ISA）级别优化的收益。",
            "id": "3638033",
            "problem": "一个中央处理器 (CPU) 在不同的功能单元上执行混合的指令类别。您需要通过动态功耗和静态功耗的基本原理推导出每条引退指令的平均能耗，然后评估一个旨在减少开关活动的指令集架构 (ISA) 扩展的效果。您必须将最终所求的量计算为单个数值。\n\n假设硬件参数如下：\n- 电源电压：$0.9\\,\\mathrm{V}$。\n- 时钟频率：$2.5\\,\\mathrm{GHz}$。\n- 芯片级漏电流（始终开启）：$8\\,\\mathrm{mA}$。\n- 基准时钟树每个周期翻转的有效电容：$5\\,\\mathrm{pF}$。\n\n动态指令流中的指令类别及其概率：\n- 整数算术/逻辑 (IALU)：$p_{\\mathrm{IALU}}=0.50$。\n- 浮点算术 (FPU)：$p_{\\mathrm{FPU}}=0.15$。\n- 加载/存储 (LSU)：$p_{\\mathrm{LSU}}=0.20$。\n- 分支 (BRU)：$p_{\\mathrm{BRU}}=0.10$。\n- 整数乘法 (MUL)：$p_{\\mathrm{MUL}}=0.05$。\n\n当功能单元被该类别指令主动使用时的属性（活动因子指单元被指令占用期间，每个周期信号发生翻转的平均概率）：\n- IALU：有效电容 $8\\,\\mathrm{pF}$，活动因子 $0.18$，被一条 IALU 指令占用 $1$ 个周期。\n- FPU：有效电容 $12\\,\\mathrm{pF}$，活动因子 $0.22$，被一条 FPU 指令占用 $4$ 个周期。\n- LSU：有效电容 $10\\,\\mathrm{pF}$，活动因子 $0.14$，被一条 LSU 指令占用 $2$ 个周期。\n- BRU：有效电容 $5\\,\\mathrm{pF}$，活动因子 $0.10$，被一条 BRU 指令占用 $1$ 个周期。\n- MUL：有效电容 $20\\,\\mathrm{pF}$，活动因子 $0.30$，被一条 MUL 指令占用 $3$ 个周期。\n\n特定类别指令执行时的额外翻转（发生在类别的主要占用窗口内，不增加额外周期）：\n- 每条 LSU 指令在 IALU 上执行一个周期的地址生成，作用于 IALU 的 $8\\,\\mathrm{pF}$ 电容上，活动因子为 $0.08$。\n- 每条 MUL 指令引起一个周期的轻微 IALU 控制翻转，作用于 IALU 的 $8\\,\\mathrm{pF}$ 电容上，活动因子为 $0.05$。\n\n假设：\n- 将能耗视为在功能单元和周期之间可加和；忽略除明确说明之外的重叠效应。\n- 每指令时间由上述各类别主要单元占用周期的加权平均数决定（LSU 和 MUL 的辅助 IALU 翻转发生在这些主要周期内，不增加周期数）。\n- 无论指令类别如何，时钟树每个周期都会翻转。\n\n一个 ISA 扩展引入了操作数值感知的门控提示，按如下方式减少开关活动因子（对给定工作负载的平均效果）：\n- 当 FPU 被占用时，其活动因子乘以 $0.85$。\n- 当 MUL 被占用时，其活动因子乘以 $0.60$。\n- 对于 LSU 指令内部的地址生成 IALU 周期，IALU 的活动因子乘以 $0.50$（LSU 自身的活动因子不变）。\n- 所有其他活动因子均不变。周期数、电源电压、频率或漏电流没有变化。\n\n任务：\n- 从动态功耗和静态（漏电）功耗的定义以及功耗与能量之间的关系出发，推导如何计算该工作负载下每条引退指令的平均能耗，包括来自功能单元、时钟树和漏电的贡献。\n- 应用您的推导来计算 ISA 扩展生效后，每条引退指令的新的平均总能耗。以皮焦耳 (picojoules) 为单位表示最终答案。\n\n将您的最终数值答案四舍五入到四位有效数字，并以皮焦耳 (pJ) 为单位表示。最终答案必须是单个数字。",
            "solution": "该问题具有科学依据，提法明确且客观。它提供了一套完整且一致的参数，用于根据计算机体系结构的标准原理对 CPU 的功耗和能耗进行建模。所使用的物理模型将功耗与动态开关活动 ($P_{\\text{dyn}} = \\alpha C f V_{dd}^2$) 和静态漏电 ($P_{\\text{stat}} = I_{\\text{leak}} V_{dd}$) 联系起来，是数字 CMOS 电子学中的一个基本概念。所有需要的数据都已给出且量纲一致，问题要求一个具体、可计算的量。因此，该问题是有效的，并将提供解答。\n\n主要任务是推导并计算在应用指令集架构 (ISA) 扩展后，每条引退指令的平均能耗 $E_{\\text{inst}}$。每条指令的总平均能耗是三个不同组成部分的总和：静态（漏电）能耗 $E_{\\text{stat}}$，时钟分配网络消耗的动态能耗 $E_{\\text{clk}}$，以及功能单元 (FUs) 消耗的动态能耗 $E_{\\text{FU}}$。\n$$E_{\\text{inst}} = E_{\\text{stat}} + E_{\\text{clk}} + E_{\\text{FU}}$$\n\n首先，我们建立基本关系。总功耗 $P_{\\text{total}}$ 是静态功耗 $P_{\\text{stat}}$ 和动态功耗 $P_{\\text{dyn}}$ 的总和。\n$$P_{\\text{stat}} = I_{\\text{leak}} V_{dd}$$\n$$P_{\\text{dyn}} = \\alpha C f V_{dd}^2$$\n其中 $I_{\\text{leak}}$ 是漏电流，$V_{dd}$ 是电源电压，$\\alpha$ 是活动因子（信号翻转的概率），$C$ 是被开关的有效电容，$f$ 是时钟频率。在时间段 $t$ 内，恒定功耗 $P$ 对应的能量 $E$ 为 $E = P \\times t$。执行单个开关事件（对电容充电和放电）的能量是 $C V_{dd}^2$。因此，每个时钟周期的动态能耗是 $\\alpha C V_{dd}^2$。\n\n为了求出每条指令的平均能耗，我们必须首先确定每条指令的平均时间 $T_{\\text{inst}}$。它由平均每指令周期数 (CPI) 与时钟周期 ($T_{\\text{cycle}} = 1/f$) 的乘积给出。\n$$T_{\\text{inst}} = \\text{CPI} \\times T_{\\text{cycle}} = \\frac{\\text{CPI}}{f}$$\nCPI 是每个指令类别周期数的加权平均值，其中权重是指令概率 $p_i$。\n$$\\text{CPI} = \\sum_{i \\in \\text{classes}} p_i \\times N_{\\text{cycles}, i}$$\n\n现在我们推导每条指令的三个能耗分量的表达式：\n\n1.  **每指令静态能耗 ($E_{\\text{stat}}$):** 这是静态功耗乘以每条指令的平均时间。\n    $$E_{\\text{stat}} = P_{\\text{stat}} \\times T_{\\text{inst}} = (I_{\\text{leak}} V_{dd}) \\frac{\\text{CPI}}{f}$$\n\n2.  **每指令时钟动态能耗 ($E_{\\text{clk}}$):** 时钟树每个周期都翻转，所以其活动因子为 $\\alpha_{\\text{clk}}=1$。平均每条指令消耗的能量是在 CPI 个周期内累积的。\n    $$E_{\\text{clk}} = (\\alpha_{\\text{clk}} C_{\\text{clk}} V_{dd}^2) \\times \\text{CPI} = C_{\\text{clk}} V_{dd}^2 \\times \\text{CPI}$$\n\n3.  **每指令功能单元动态能耗 ($E_{\\text{FU}}$):** 这是每个指令类别中功能单元所消耗动态能耗的概率加权平均值。对于类别 $i$ 的一条指令，其动态能耗是它所占用的所有单元能耗的总和。这可以表示为 $V_{dd}^2$ 乘以该指令的总开关电容。因此，每条指令的平均功能单元能耗是 $V_{dd}^2$ 乘以每条指令的平均开关电容 $\\langle C_{\\text{sw, FU}} \\rangle$。\n    $$\\langle C_{\\text{sw, FU}} \\rangle = \\sum_{i \\in \\text{classes}} p_i \\left( \\sum_{k \\in \\text{units used by i}} \\alpha_{i,k, \\text{new}} C_k N_{\\text{cycles},k} \\right)$$\n    $$E_{\\text{FU}} = \\langle C_{\\text{sw, FU}} \\rangle \\times V_{dd}^2$$\n    这里，$\\alpha_{i,k, \\text{new}}$ 表示 ISA 扩展后的新活动因子。\n\n现在我们使用提供的数据进行计算。\n给定值：$V_{dd} = 0.9\\,\\mathrm{V}$，$f = 2.5\\,\\mathrm{GHz} = 2.5 \\times 10^9\\,\\mathrm{s}^{-1}$，$I_{\\text{leak}} = 8\\,\\mathrm{mA} = 8 \\times 10^{-3}\\,\\mathrm{A}$，$C_{\\text{clk}} = 5\\,\\mathrm{pF} = 5 \\times 10^{-12}\\,\\mathrm{F}$。\n\n**步骤 A：计算 CPI**\n周期数 $N_{\\text{cycles},i}$ 和概率 $p_i$ 不受 ISA 扩展的影响。\n$$\n\\text{CPI} = p_{\\mathrm{IALU}}N_{\\mathrm{IALU}} + p_{\\mathrm{FPU}}N_{\\mathrm{FPU}} + p_{\\mathrm{LSU}}N_{\\mathrm{LSU}} + p_{\\mathrm{BRU}}N_{\\mathrm{BRU}} + p_{\\mathrm{MUL}}N_{\\mathrm{MUL}}\n$$\n$$\n\\text{CPI} = (0.50 \\times 1) + (0.15 \\times 4) + (0.20 \\times 2) + (0.10 \\times 1) + (0.05 \\times 3)\n$$\n$$\n\\text{CPI} = 0.50 + 0.60 + 0.40 + 0.10 + 0.15 = 1.75\n$$\n\n**步骤 B：计算 $E_{\\text{stat}}$**\n$$\nE_{\\text{stat}} = (8 \\times 10^{-3}\\,\\mathrm{A}) \\times (0.9\\,\\mathrm{V}) \\times \\frac{1.75}{2.5 \\times 10^9\\,\\mathrm{s}^{-1}} = (7.2 \\times 10^{-3}\\,\\mathrm{W}) \\times (0.7 \\times 10^{-9}\\,\\mathrm{s})\n$$\n$$\nE_{\\text{stat}} = 5.04 \\times 10^{-12}\\,\\mathrm{J} = 5.04\\,\\mathrm{pJ}\n$$\n\n**步骤 C：计算 $E_{\\text{clk}}$**\n$$\nE_{\\text{clk}} = (5 \\times 10^{-12}\\,\\mathrm{F}) \\times (0.9\\,\\mathrm{V})^2 \\times 1.75 = (5 \\times 10^{-12}\\,\\mathrm{F}) \\times 0.81\\,\\mathrm{V}^2 \\times 1.75\n$$\n$$\nE_{\\text{clk}} = 7.0875 \\times 10^{-12}\\,\\mathrm{J} = 7.0875\\,\\mathrm{pJ}\n$$\n\n**步骤 D：计算 $E_{\\text{FU}}$**\n我们首先使用新的缩放活动因子，计算每个类别的一条指令的总开关电容。设 $C_{\\text{sw}, i}$ 为类别 $i$ 的这个值。\n\n对于一条 IALU 指令：\n$C_{\\text{sw, IALU}} = \\alpha_{\\mathrm{IALU}} C_{\\mathrm{IALU}} N_{\\mathrm{IALU}} = 0.18 \\times (8\\,\\mathrm{pF}) \\times 1 = 1.44\\,\\mathrm{pF}$\n\n对于一条 FPU 指令（新活动因子 $\\alpha'_{\\mathrm{FPU}} = 0.22 \\times 0.85 = 0.187$）：\n$C_{\\text{sw, FPU}} = \\alpha'_{\\mathrm{FPU}} C_{\\mathrm{FPU}} N_{\\mathrm{FPU}} = 0.187 \\times (12\\,\\mathrm{pF}) \\times 4 = 8.976\\,\\mathrm{pF}$\n\n对于一条 LSU 指令（有次级 IALU 使用，此用途的新 IALU 活动因子 $\\alpha'_{\\text{IALU, for LSU}} = 0.08 \\times 0.50 = 0.04$）：\n$C_{\\text{sw, LSU}} = (\\alpha_{\\mathrm{LSU}} C_{\\mathrm{LSU}} N_{\\mathrm{LSU}}) + (\\alpha'_{\\text{IALU, for LSU}} C_{\\mathrm{IALU}} \\times 1\\ \\text{cycle}) = (0.14 \\times 10\\,\\mathrm{pF} \\times 2) + (0.04 \\times 8\\,\\mathrm{pF} \\times 1) = 2.8\\,\\mathrm{pF} + 0.32\\,\\mathrm{pF} = 3.12\\,\\mathrm{pF}$\n\n对于一条 BRU 指令：\n$C_{\\text{sw, BRU}} = \\alpha_{\\mathrm{BRU}} C_{\\mathrm{BRU}} N_{\\mathrm{BRU}} = 0.10 \\times (5\\,\\mathrm{pF}) \\times 1 = 0.5\\,\\mathrm{pF}$\n\n对于一条 MUL 指令（新主活动因子 $\\alpha'_{\\mathrm{MUL}} = 0.30 \\times 0.60 = 0.18$）：\n$C_{\\text{sw, MUL}} = (\\alpha'_{\\mathrm{MUL}} C_{\\mathrm{MUL}} N_{\\mathrm{MUL}}) + (\\alpha_{\\text{IALU, for MUL}} C_{\\mathrm{IALU}} \\times 1\\ \\text{cycle}) = (0.18 \\times 20\\,\\mathrm{pF} \\times 3) + (0.05 \\times 8\\,\\mathrm{pF} \\times 1) = 10.8\\,\\mathrm{pF} + 0.4\\,\\mathrm{pF} = 11.2\\,\\mathrm{pF}$\n\n现在，计算每条指令的平均开关功能单元电容 $\\langle C_{\\text{sw, FU}} \\rangle$：\n$$\n\\langle C_{\\text{sw, FU}} \\rangle = p_{\\mathrm{IALU}}C_{\\text{sw, IALU}} + p_{\\mathrm{FPU}}C_{\\text{sw, FPU}} + p_{\\mathrm{LSU}}C_{\\text{sw, LSU}} + p_{\\mathrm{BRU}}C_{\\text{sw, BRU}} + p_{\\mathrm{MUL}}C_{\\text{sw, MUL}}\n$$\n$$\n\\langle C_{\\text{sw, FU}} \\rangle = (0.50 \\times 1.44) + (0.15 \\times 8.976) + (0.20 \\times 3.12) + (0.10 \\times 0.5) + (0.05 \\times 11.2)\\,\\mathrm{pF}\n$$\n$$\n\\langle C_{\\text{sw, FU}} \\rangle = 0.72 + 1.3464 + 0.624 + 0.05 + 0.56\\,\\mathrm{pF} = 3.3004\\,\\mathrm{pF}\n$$\n最后，计算 $E_{\\text{FU}}$：\n$$\nE_{\\text{FU}} = \\langle C_{\\text{sw, FU}} \\rangle \\times V_{dd}^2 = (3.3004 \\times 10^{-12}\\,\\mathrm{F}) \\times (0.9\\,\\mathrm{V})^2 = (3.3004 \\times 10^{-12}\\,\\mathrm{F}) \\times 0.81\\,\\mathrm{V}^2\n$$\n$$\nE_{\\text{FU}} = 2.673324 \\times 10^{-12}\\,\\mathrm{J} = 2.673324\\,\\mathrm{pJ}\n$$\n\n**步骤 E：计算每条指令的总平均能耗**\n$$\nE_{\\text{inst}} = E_{\\text{stat}} + E_{\\text{clk}} + E_{\\text{FU}} = 5.04\\,\\mathrm{pJ} + 7.0875\\,\\mathrm{pJ} + 2.673324\\,\\mathrm{pJ}\n$$\n$$\nE_{\\text{inst}} = 14.800824\\,\\mathrm{pJ}\n$$\n\n问题要求答案以皮焦耳为单位，并四舍五入到四位有效数字。\n$$\nE_{\\text{inst}} \\approx 14.80\\,\\mathrm{pJ}\n$$",
            "answer": "$$\\boxed{14.80}$$"
        }
    ]
}