{
    "hands_on_practices": [
        {
            "introduction": "处理器性能通常受到其“前端”——即负责获取和解码指令的部分——的限制。RISC和CISC在指令长度上的根本差异直接影响了这一阶段的效率。此练习将指导您在相同的硬件资源（如取指带宽）下，计算两种架构的峰值每周期指令数（$IPC$），从而揭示CISC的可变长指令如何可能成为取指单元的瓶颈，而RISC的定长指令则更容易并行处理。",
            "id": "3674716",
            "problem": "我们正在评估一个超标量微处理器，以在相同的指令缓存约束下，比较精简指令集计算机 (RISC) 和复杂指令集计算机 (CISC) 的前端行为。指令缓存 (I-cache) 每周期可以提供 $B$ 字节的取指宽度，译码器每周期最多可以接受 $W$ 条指令。后端每周期最多可以退役 $R$ 条指令。假设完美的分支预测，没有指令缓存未命中，并且指令对齐不会降低可用的取指带宽。对于 RISC，每条指令的长度固定为 $L_{\\mathrm{RISC}} = 4$ 字节。对于 CISC，指令是可变长度的，平均长度为 $\\bar{\\ell}_{\\mathrm{CISC}}$，并且译码时每条 CISC 指令产生一条体系结构指令（没有微操作展开）。使用以下基本定义：平均速率等于资源带宽除以单位工作的平均消耗，以及可实现的稳态每周期指令数受限于各独立阶段能力的最小值。\n\n给定 $B = 32$ 字节/周期，$W = 6$ 指令/周期，$R = 8$ 指令/周期，$L_{\\mathrm{RISC}} = 4$ 字节，以及 $\\bar{\\ell}_{\\mathrm{CISC}} = \\frac{11}{2}$ 字节，确定：\n1.  对于 RISC 和 CISC 两种情况，仅由 I-cache 取指带宽所隐含的每周期最大可译码指令数。\n2.  将 I-cache 带宽限制与译码器宽度和退役宽度相结合时，RISC 和 CISC 的每周期指令数 (IPC) 上限。\n\n将两个 IPC 上限以 $\\left(\\mathrm{RISC}, \\mathrm{CISC}\\right)$ 的顺序表示为单个行矩阵。如果您的数值是精确分数，请保持其精确形式，不要四舍五入。IPC 是无量纲的，因此最终答案中不需要单位。",
            "solution": "首先对问题陈述进行验证。\n\n**步骤 1：提取给定条件**\n以下数据和约束逐字取自问题陈述：\n- I-cache 取指宽度：$B = 32$ 字节/周期\n- 译码器宽度：$W = 6$ 指令/周期\n- 退役宽度：$R = 8$ 指令/周期\n- RISC 指令长度：$L_{\\mathrm{RISC}} = 4$ 字节\n- CISC 平均指令长度：$\\bar{\\ell}_{\\mathrm{CISC}} = \\frac{11}{2}$ 字节\n- 假设：完美的分支预测\n- 假设：没有指令缓存未命中\n- 假设：指令对齐不会降低可用取指带宽\n- 假设：译码每条 CISC 指令产生一条体系结构指令（没有微操作展开）\n- 原则 1：平均速率等于资源带宽除以单位工作的平均消耗。\n- 原则 2：可实现的稳态每周期指令数受限于各独立阶段能力的最小值。\n\n**步骤 2：使用提取的给定条件进行验证**\n该问题在科学上基于计算机体系结构的基本原理，特别是处理器流水线瓶颈的分析。取指带宽、译码器宽度、退役宽度、指令长度及其对每周期指令数 (IPC) 的影响等概念是该领域的标准内容。所述假设（完美的缓存、完美的预测）是理论性能分析中常用的简化方法，用于隔离特定体系结构参数的影响。该问题提法得当，提供了所有必要的数据和明确的逻辑规则（各阶段能力的最小值），可以得出一个唯一的解。语言客观而精确。该问题不违反任何有效性标准。\n\n**步骤 3：结论与行动**\n问题被判定为 **有效**。现在将展开一个合理的解决方案。\n\n该解决方案通过将处理器建模为具有取指、译码和退役三个阶段的流水线来导出。每个阶段的吞吐量，以每周期指令数 (IPC) 衡量，代表了一个潜在的性能上限。整个系统的 IPC 由这些阶段中的最小吞吐量决定，因为该阶段构成了瓶颈。\n\n**第 1 部分：确定取指阶段吞吐量 ($IPC_{\\mathrm{fetch}}$)**\n\n每周期可以取指的最大指令数由 I-cache 取指带宽 ($B$) 和平均指令长度决定。遵循给定的原则，取指速率等于带宽除以平均消耗（每条指令的字节数）。\n\n对于 RISC 体系结构，指令具有固定长度 $L_{\\mathrm{RISC}} = 4$ 字节。取指阶段支持的最大 IPC，记为 $IPC_{\\mathrm{fetch, RISC}}$，是：\n$$IPC_{\\mathrm{fetch, RISC}} = \\frac{B}{L_{\\mathrm{RISC}}} = \\frac{32 \\text{ bytes/cycle}}{4 \\text{ bytes/instruction}} = 8 \\text{ instructions/cycle}$$\n\n对于 CISC 体系结构，指令具有可变长度，指定的平均值为 $\\bar{\\ell}_{\\mathrm{CISC}} = \\frac{11}{2}$ 字节。取指阶段支持的平均 IPC，记为 $IPC_{\\mathrm{fetch, CISC}}$，是：\n$$IPC_{\\mathrm{fetch, CISC}} = \\frac{B}{\\bar{\\ell}_{\\mathrm{CISC}}} = \\frac{32 \\text{ bytes/cycle}}{\\frac{11}{2} \\text{ bytes/instruction}} = \\frac{32 \\times 2}{11} = \\frac{64}{11} \\text{ instructions/cycle}$$\n数值上，$\\frac{64}{11} \\approx 5.818...$ 指令/周期。\n\n**第 2 部分：确定整体 IPC 上限**\n\n整体稳态 IPC 是取指、译码和退役阶段能力的最小值。各阶段能力如下：\n- 取指能力：$IPC_{\\mathrm{fetch}}$（针对每种体系结构已在上面计算）\n- 译码能力：$W = 6$ 指令/周期\n- 退役能力：$R = 8$ 指令/周期\n\n每种体系结构的整体 IPC，$IPC_{\\mathrm{RISC}}$ 和 $IPC_{\\mathrm{CISC}}$，计算如下：\n$$IPC_{\\text{arch}} = \\min(IPC_{\\mathrm{fetch, arch}}, W, R)$$\n\n对于 RISC 体系结构：\n我们比较这三个阶段的吞吐量：$IPC_{\\mathrm{fetch, RISC}} = 8$，$W = 6$，以及 $R = 8$。\n$$IPC_{\\mathrm{RISC}} = \\min(8, 6, 8) = 6$$\n在 RISC 的情况下，性能受限于译码器宽度。取指单元可以提供比译码器能接受的（$6$ 条）更多的指令（$8$ 条）。\n\n对于 CISC 体系结构：\n我们比较这三个阶段的吞吐量：$IPC_{\\mathrm{fetch, CISC}} = \\frac{64}{11}$，$W = 6$，以及 $R = 8$。\n为了找到最小值，我们将分数值与整数进行比较：$\\frac{64}{11} = 5 + \\frac{9}{11}$。这个值小于 $6$。\n$$IPC_{\\mathrm{CISC}} = \\min\\left(\\frac{64}{11}, 6, 8\\right) = \\frac{64}{11}$$\n在 CISC 的情况下，性能受限于取指带宽。由于平均指令尺寸较大，取指单元无法足够快地提供指令来使 6 路宽的译码器饱和。\n\n问题要求以行矩阵的形式给出 RISC 和 CISC 的最终 IPC 上限。结果值对于 RISC 是 $6$，对于 CISC 是 $\\frac{64}{11}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n6 & \\frac{64}{11}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "现代处理器严重依赖推测执行来获得高性能，但当分支预测错误时，这会带来巨大的代价。指令流的密度在决定这种惩罚的严重程度上扮演着关键角色。本练习通过建模分支预测错误后被刷新的无效微操作数量，比较了单个密集的CISC指令与一系列分散的RISC指令，以此说明CISC指令的紧凑性在推测执行环境中，反而可能导致更大的性能损失。",
            "id": "3674770",
            "problem": "一个超标量乱序核心通过一个公共后端同时实现了精简指令集计算机 (RISC) 和复杂指令集计算机 (CISC) 的指令集。前端每个周期最多获取 $w$ 个微操作，一个条件分支在被获取后需要 $\\ell$ 个周期才能解析。在发生预测错误时，所有在分支指令之后、解析完成之前获取的更新的微操作都将被冲刷掉。\n\n考虑一个操作，在一个预测错误的分支之后，它立即在错误路径上以以下两种形式之一出现：\n- CISC 形式：一个单一的宏指令，解码为 $k$ 个连续的微操作。\n- RISC 形式：$k$ 个宏指令，每个解码为一个微操作，其调度方式为在这 $k$ 个宏指令中的任意两个之间，都精确地插入了 $s$ 个其他单微操作指令。假设这些交错的指令是独立的，并且在错误路径上本可以正确执行。\n\n假设 $w = 6$，$\\ell = 8$，$k = 100$，且 $s = 3$。仅使用关于取指速率、分支解析延迟和预测错误冲刷语义的第一性原理，推导出每种设计中该操作被冲刷的微操作数量的表达式，并计算 CISC 损失与 RISC 损失的比率 $\\rho$。\n\n为 $\\rho$ 提供一个精确的数值；无需四舍五入。最终答案必须是一个实数。",
            "solution": "该问题要求分析在分支预测错误后，两种不同指令流编码（单一复杂指令 (CISC) 和一系列简单指令 (RISC)）下被冲刷的微操作数量。该分析基于处理器前端操作的第一性原理。\n\n给定的参数是：\n- 取指宽度：$w = 6$ 个微操作/周期。\n- 分支解析延迟：$\\ell = 8$ 个周期。\n- CISC 操作大小：$k = 100$ 个微操作。\n- RISC 操作大小：$k = 100$ 个微操作（来自 $k$ 个独立的宏指令）。\n- RISC 的交错距离：目标微操作之间有 $s = 3$ 个其他微操作。\n\n核心原理是，在发生分支预测错误时，处理器前端会继续沿着错误路径取指 $\\ell$ 个周期。当检测到预测错误时，在此时间窗口内获取的所有微操作都将被冲刷。在此窗口期间获取的微操作总数（因此也是可能被冲刷的最大数量）是取指宽度和分支解析延迟的乘积。\n设 $M$ 为在冲刷发生前在错误路径上获取的微操作总数。\n$$M = w \\times \\ell$$\n代入给定值：\n$$M = 6 \\times 8 = 48$$\n因此，总共有 $48$ 个微操作被获取并随后被冲刷。问题要求计算这些被冲刷的微操作中属于特定 CISC 或 RISC 操作的数量，假设该操作在预测错误的分支后的下一个周期立即开始。\n\n我们首先分析 CISC 的情况。\nCISC 操作由一个单一的宏指令组成，解码为 $k=100$ 个连续的微操作。由于这些微操作是连续的，并且它们的获取在错误路径上立即开始，它们将是首先被获取的 $k$ 个微操作。\n来自此 CISC 指令的被冲刷的微操作数量，记为 $N_{CISC}$，是其在 $M=48$ 个可用获取槽内能够被获取的微操作数量。由于该指令提供了 $k=100$ 个微操作，被获取的数量将受到冲刷窗口大小的限制。\n因此，$N_{CISC}$ 是指令中的微操作数量（$k$）和冲刷前获取的微操作总数（$M$）之间的最小值。\n$$N_{CISC} = \\min(k, M) = \\min(k, w\\ell)$$\n代入数值：\n$$N_{CISC} = \\min(100, 48) = 48$$\n所以，来自 CISC 指令的 $48$ 个微操作被冲刷。\n\n接下来，我们分析 RISC 的情况。\nRISC 操作由 $k=100$ 个独立的宏指令组成，每个解码为一个微操作。我们称这些为“目标”微操作。它们的调度方式是，在任意两个连续的目标微操作之间，都恰好有 $s=3$ 个其他微操作。\n获取的微操作模式是：（目标，其他，其他，其他），（目标，其他，其他，其他），...\n这形成了一个包含 $s+1$ 个微操作的重复组，其中目标微操作是每组的第一个。\n第 $i$ 个目标微操作在取指流中的位置 $p_i$ 可以表示为：\n$$p_i = (i-1)(s+1) + 1$$\n我们需要找出在 $M=48$ 个可用获取槽内被获取的目标微操作的数量。这等同于找到满足 $p_i \\le M$ 的最大整数 $i$。\n设 $N_{RISC}$ 为来自 RISC 操作的被冲刷的微操作数量。我们必须求解满足以下条件的 $N_{RISC}$ 的最大整数值：\n$$(N_{RISC} - 1)(s+1) + 1 \\le w\\ell$$\n重新整理不等式以求解 $N_{RISC}$：\n$$(N_{RISC} - 1)(s+1) \\le w\\ell - 1$$\n$$N_{RISC} - 1 \\le \\frac{w\\ell - 1}{s+1}$$\n由于 $N_{RISC}-1$ 必须是整数，我们必须对右侧取底：\n$$N_{RISC} - 1 = \\left\\lfloor \\frac{w\\ell - 1}{s+1} \\right\\rfloor$$\n$$N_{RISC} = \\left\\lfloor \\frac{w\\ell - 1}{s+1} \\right\\rfloor + 1$$\n代入数值 $w=6$，$\\ell=8$ 和 $s=3$：\n$$N_{RISC} = \\left\\lfloor \\frac{(6 \\times 8) - 1}{3+1} \\right\\rfloor + 1$$\n$$N_{RISC} = \\left\\lfloor \\frac{48 - 1}{4} \\right\\rfloor + 1$$\n$$N_{RISC} = \\left\\lfloor \\frac{47}{4} \\right\\rfloor + 1$$\n$$N_{RISC} = \\lfloor 11.75 \\rfloor + 1$$\n$$N_{RISC} = 11 + 1 = 12$$\n可用的目标微操作总数为 $k=100$。由于 $12  100$，被冲刷的 RISC 微操作数量确实是 $12$。\n\n最后，问题要求计算 CISC 损失与 RISC 损失的比率 $\\rho$。\n$$\\rho = \\frac{N_{CISC}}{N_{RISC}}$$\n代入计算出的值：\n$$\\rho = \\frac{48}{12} = 4$$\nCISC 损失与 RISC 损失的比率为 $4$。",
            "answer": "$$\\boxed{4}$$"
        }
    ]
}