{
    "hands_on_practices": [
        {
            "introduction": "首先，我们将分析静态分支预测对一个具体微基准测试的影响。这个练习  将指导你为两种常见预测器计算基本的性能指标——预测准确率 ($A$) 和每指令周期数 ($CPI$)。掌握这种分析是量化控制冒险的性能成本和评估预测策略的第一步。",
            "id": "3680985",
            "problem": "一个简单的微基准测试执行一个循环，每次迭代包含两个条件分支：一个后向循环回边分支和一个前向错误检查分支。考虑两种静态预测器：后向分支预测为跳转，前向分支预测为不跳转（BTFNT）和总是预测为不跳转的预测器。为分析目的，假设以下条件成立，并将基于所述概率的所有期望值视为精确值。\n\n- 循环精确运行 $L$ 次迭代。循环回边是一个后向分支，在前 $L-1$ 次迭代中跳转，在循环退出时有一次不跳转。\n- 在每次迭代中，在回边分支之前，代码执行一个前向错误检查分支，该分支以概率 $p$ 独立跳转，以概率 $1-p$ 不跳转。当此错误检查分支跳转时，该次迭代中会额外执行 $H$ 条指令；当它不跳转时，则不会执行此错误处理块中的任何额外指令。\n- 每次迭代在循环体中精确执行 $B$ 条非分支指令（不包括两条分支指令和任何错误处理指令），外加两条分支指令本身（前向错误检查和后向回边）。\n- 处理器是一个顺序执行流水线，在没有控制冒险的情况下，每条指令的理想基本成本为 $1$ 个周期。在任何分支预测错误时，流水线会产生一个额外的固定预测错误惩罚，为 $M$ 个周期。没有其他停顿或缓存效应。\n\n使用以下基本定义：(i) 预测准确率 $A$ 是正确预测的分支结果数与动态分支总数的比率，以及 (ii) 每指令周期数（CPI）是总周期数除以总退休指令数，其中总周期数等于基本指令周期数加上预测错误惩罚。\n\n给定参数 $L=200$，$p=0.03$，$H=6$，$B=18$ 和 $M=3$：\n\n1. 在 BTFNT 和总是预测为不跳转的预测器下，推导出所有动态分支结果的综合预测准确率 $A$ 的表达式，然后根据给定参数计算它们的值。\n2. 在 BTFNT 和总是预测为不跳转的预测器下，推导出期望 CPI 的表达式，然后根据给定参数计算它们的值。\n3. 最后，以十进制形式报告 CPI 改进量 $\\Delta = \\text{CPI}_{\\text{always-not}} - \\text{CPI}_{\\text{BTFNT}}$，四舍五入到四位有效数字。最终数值答案中不要包含任何单位。",
            "solution": "该问题陈述清晰，科学上基于计算机体系结构的原理，并为分析提供了一套完整且一致的参数。因此，该问题被认为是有效的。我们首先推导出目标量的一般表达式，然后代入给定的数值来求解。\n\n提供的参数是：\n- 循环迭代次数：$L = 200$\n- 前向分支跳转的概率：$p = 0.03$\n- 错误处理指令数：$H = 6$\n- 循环体中的基本指令数：$B = 18$\n- 预测错误惩罚：$M = 3$ 周期\n\n首先，我们确定独立于分支预测策略的通用量。\n循环执行 $L$ 次。每次迭代有两个分支指令：一个前向错误检查分支和一个后向循环回边分支。\n动态分支指令的总数是：\n$$ I_{\\text{branches}} = 2L $$\n\n总退休指令数 $I_{\\text{total}}$ 包括每次循环迭代中执行的基本指令，以及当错误检查分支跳转时执行的额外指令。每次迭代的基本指令是 $B$ 条非分支指令加上 $2$ 条分支指令，总共 $B+2$ 条。错误检查分支以概率 $p$ 跳转，增加 $H$ 条指令。因此，期望的总退休指令数 $E[I_{\\text{total}}]$ 是：\n$$ E[I_{\\text{total}}] = L(B+2) + LpH = L(B+2+pH) $$\n对于给定的参数：\n$$ E[I_{\\text{total}}] = 200(18+2+(0.03)(6)) = 200(20+0.18) = 200(20.18) = 4036 $$\n\n1.  **预测准确率 ($A$)**\n\n准确率是正确预测的分支数与动态分支总数的比率。\n\n**a) BTFNT（后向跳转，前向不跳转）预测器**\n该策略是预测所有后向分支为“跳转”，所有前向分支为“不跳转”。\n-   **前向分支**：有 $L$ 个动态前向分支。它们被预测为“不跳转”。它们实际以概率 $p$ 跳转。期望的正确预测次数是分支不跳转的次数：$L(1-p)$。\n-   **后向分支**：有 $L$ 个动态后向分支。它们被预测为“跳转”。循环回边在前 $L-1$ 次迭代中跳转，在最后退出时不跳转。因此，有 $L-1$ 次正确预测。\n\nBTFNT 方案的期望正确预测总数 $C_{\\text{BTFNT}}$ 是：\n$$ E[C_{\\text{BTFNT}}] = L(1-p) + (L-1) = 2L - Lp - 1 $$\n准确率 $A_{\\text{BTFNT}}$ 为：\n$$ A_{\\text{BTFNT}} = \\frac{E[C_{\\text{BTFNT}}]}{2L} = \\frac{2L - Lp - 1}{2L} $$\n数值上：\n$$ A_{\\text{BTFNT}} = \\frac{2(200) - 200(0.03) - 1}{2(200)} = \\frac{400 - 6 - 1}{400} = \\frac{393}{400} = 0.9825 $$\n\n**b) 总是预测为不跳转的预测器**\n该策略是预测所有分支为“不跳转”。\n-   **前向分支**：有 $L$ 个动态前向分支。它们被预测为“不跳转”。正确预测的次数与 BTFNT 相同：$L(1-p)$。\n-   **后向分支**：有 $L$ 个动态后向分支。它们被预测为“不跳转”。该分支实际上只有在循环退出时一次不跳转。因此，只有 $1$ 次正确预测。\n\n总是预测为不跳转方案的期望正确预测总数 $C_{\\text{always-not}}$ 是：\n$$ E[C_{\\text{always-not}}] = L(1-p) + 1 $$\n准确率 $A_{\\text{always-not}}$ 为：\n$$ A_{\\text{always-not}} = \\frac{E[C_{\\text{always-not}}]}{2L} = \\frac{L(1-p) + 1}{2L} $$\n数值上：\n$$ A_{\\text{always-not}} = \\frac{200(1-0.03) + 1}{2(200)} = \\frac{200(0.97) + 1}{400} = \\frac{194 + 1}{400} = \\frac{195}{400} = 0.4875 $$\n\n2.  **每指令周期数 (CPI)**\n\nCPI 是总周期数与总退休指令数的比率。总周期数是基本周期数（每条指令一个周期）和预测错误惩罚周期数的总和。\n$$ \\text{CPI} = \\frac{E[I_{\\text{total}}] \\times 1 + E[\\text{Mispredictions}] \\times M}{E[I_{\\text{total}}]} = 1 + \\frac{E[\\text{Mispredictions}] \\times M}{E[I_{\\text{total}}]} $$\n首先，我们计算每种策略的期望预测错误次数。一次预测错误是正确预测的补集。$E[\\text{Mispredictions}] = I_{\\text{branches}} - E[\\text{Correct}]$。\n\n**a) BTFNT 的 CPI**\n期望的预测错误次数 $E[\\text{Misc}_{\\text{BTFNT}}]$ 是：\n-   **前向分支**：当跳转时预测错误。期望次数：$Lp$。\n-   **后向分支**：当不跳转时预测错误。次数：$1$（在循环退出时）。\n$$ E[\\text{Misc}_{\\text{BTFNT}}] = Lp + 1 $$\nCPI 表达式为：\n$$ \\text{CPI}_{\\text{BTFNT}} = 1 + \\frac{(Lp + 1)M}{L(B+2+pH)} $$\n数值上：\n$$ E[\\text{Misc}_{\\text{BTFNT}}] = 200(0.03) + 1 = 6 + 1 = 7 $$\n$$ \\text{CPI}_{\\text{BTFNT}} = 1 + \\frac{7 \\times 3}{4036} = 1 + \\frac{21}{4036} = \\frac{4036+21}{4036} = \\frac{4057}{4036} \\approx 1.005203 $$\n\n**b) 总是预测为不跳转的 CPI**\n期望的预测错误次数 $E[\\text{Misc}_{\\text{always-not}}]$ 是：\n-   **前向分支**：当跳转时预测错误。期望次数：$Lp$。\n-   **后向分支**：当跳转时预测错误。次数：$L-1$。\n$$ E[\\text{Misc}_{\\text{always-not}}] = Lp + (L-1) $$\nCPI 表达式为：\n$$ \\text{CPI}_{\\text{always-not}} = 1 + \\frac{(Lp + L - 1)M}{L(B+2+pH)} $$\n数值上：\n$$ E[\\text{Misc}_{\\text{always-not}}] = 200(0.03) + (200 - 1) = 6 + 199 = 205 $$\n$$ \\text{CPI}_{\\text{always-not}} = 1 + \\frac{205 \\times 3}{4036} = 1 + \\frac{615}{4036} = \\frac{4036+615}{4036} = \\frac{4651}{4036} \\approx 1.152379 $$\n\n3.  **CPI 改进量 ($\\Delta$)**\n\nCPI 改进量定义为 $\\Delta = \\text{CPI}_{\\text{always-not}} - \\text{CPI}_{\\text{BTFNT}}$。\n使用推导出的表达式：\n$$ \\Delta = \\left(1 + \\frac{(Lp + L - 1)M}{E[I_{\\text{total}}]}\\right) - \\left(1 + \\frac{(Lp + 1)M}{E[I_{\\text{total}}]}\\right) $$\n$$ \\Delta = \\frac{M}{E[I_{\\text{total}}]} \\left( (Lp + L - 1) - (Lp + 1) \\right) $$\n$$ \\Delta = \\frac{M(L - 2)}{E[I_{\\text{total}}]} = \\frac{M(L - 2)}{L(B+2+pH)} $$\n现在我们代入数值：\n$$ \\Delta = \\frac{3(200 - 2)}{4036} = \\frac{3(198)}{4036} = \\frac{594}{4036} $$\n计算这个分数并四舍五入到四位有效数字：\n$$ \\Delta \\approx 0.14717542... \\approx 0.1472 $$\n这个结果也可以通过减去数值 CPI 值得到：\n$$ \\Delta = \\frac{4651}{4036} - \\frac{4057}{4036} = \\frac{4651 - 4057}{4036} = \\frac{594}{4036} \\approx 0.1472 $$",
            "answer": "$$ \\boxed{0.1472} $$"
        },
        {
            "introduction": "在单个代码片段分析的基础上，本练习  要求你根据程序的统计特征来评估预测器。你将比较四种不同的静态预测策略，以确定对于给定的分支行为集合哪一种最有效。这个练习揭示了一个关键原则：没有一种静态预测器是普适最优的，其性能与应用程序的特性紧密相关。",
            "id": "3681002",
            "problem": "一个综合基准测试生成器产生一个动态指令流，其中有一部分比例为 $f_b$ 的指令是条件分支。每个动态条件分支被独立地分类为后向分支（概率为 $p_{\\text{back}}$）和前向分支（概率为 $1 - p_{\\text{back}}$）。根据分支类别，后向分支的基准真实（ground-truth）跳转概率为 $p_{\\text{take}\\mid\\text{back}}$，前向分支的为 $p_{\\text{take}\\mid\\text{fwd}}$。静态分支预测器在执行前被固定，并且在运行期间不会自适应调整。\n\n考虑以下静态预测器：\n- 始终跳转 (AT)：对每个条件分支都预测为跳转。\n- 始终不跳转 (ANT)：对每个条件分支都预测为不跳转。\n- 后向跳转、前向不跳转 (BTFNT)：对后向分支预测为跳转，对前向分支预测为不跳转。\n- 前向跳转、后向不跳转 (FTBNT)：对前向分支预测为跳转，对后向分支预测为不跳转。\n\n假设综合追踪的参数如下：$f_b = 0.18$，$p_{\\text{back}} = 0.60$，$p_{\\text{take}\\mid\\text{back}} = 0.85$，$p_{\\text{take}\\mid\\text{fwd}} = 0.30$。处理器的基础每指令周期数（CPI）为 $\\text{CPI}_0 = 1.10$（不含分支惩罚），每个错误预测的条件分支会产生 $L = 7$ 个周期的固定惩罚。仅使用预测器准确率的定义、全概率公式和期望的线性性质，推导出每种静态策略的预测准确率 $A$。然后，将每指令的错误预测惩罚定义为 $S = f_b \\left(1 - A\\right) L$，按 $S$ 的升序对策略进行排序，并计算四种策略中的最小总 CPI，即 $\\text{CPI}_{\\min} = \\text{CPI}_0 + \\min S$。\n\n将 $\\text{CPI}_{\\min}$ 的最终数值结果四舍五入到四位有效数字。最终结果以每指令周期数表示。",
            "solution": "问题要求计算在使用四种静态分支预测策略之一的处理器上，最小的总每指令周期数（CPI）。总 CPI 是基础 CPI $\\text{CPI}_0$ 与因分支预测错误导致的每指令惩罚 $S$ 之和。该问题定义明确，并提供了所有必要的参数来为每个预测器的性能建模。\n\n首先，我们建立概率框架。假设一个随机选择的指令是条件分支。我们定义以下事件：\n- $B$：该分支是后向分支。\n- $F$：该分支是前向分支。$F$ 是 $B$ 的补集。\n- $T$：该分支实际发生跳转（基准真实）。\n- $NT$：该分支实际未发生跳转（基准真实）。\n\n问题提供了以下概率：\n- 指令中条件分支的比例为 $f_b = 0.18$。\n- 一个条件分支是后向分支的概率为 $P(B) = p_{\\text{back}} = 0.60$。\n- 一个条件分支是前向分支的概率为 $P(F) = 1 - p_{\\text{back}} = 1 - 0.60 = 0.40$。\n- 一个后向分支发生跳转的概率为 $P(T|B) = p_{\\text{take}\\mid\\text{back}} = 0.85$。\n- 一个前向分支发生跳转的概率为 $P(T|F) = p_{\\text{take}\\mid\\text{fwd}} = 0.30$。\n\n由此，我们可以推导出不发生跳转的概率：\n- $P(NT|B) = 1 - P(T|B) = 1 - 0.85 = 0.15$。\n- $P(NT|F) = 1 - P(T|F) = 1 - 0.30 = 0.70$。\n\n处理器的基础 CPI 为 $\\text{CPI}_0 = 1.10$，预测错误的惩罚为 $L = 7$ 个周期。总 CPI 由 $\\text{CPI} = \\text{CPI}_0 + S$ 给出。每指令的错误预测惩罚 $S$ 定义为 $S = f_b (1 - A) L$，其中 $A$ 是给定策略的预测准确率。这个 $S$ 的公式代表了每条指令的预期惩罚周期数，它是通过对指令流应用期望的线性性质得出的，其中 $f_b$ 是一条指令为分支的概率，而 $(1-A)$ 是该分支被错误预测的概率。我们的目标是计算四种策略中每一种的准确率 $A$，确定相应的惩罚 $S$，找出最小惩罚，并计算最小总 CPI，即 $\\text{CPI}_{\\min}$。\n\n准确率 $A$ 是一个随机选择的条件分支被正确预测的概率。我们将使用全概率公式为每种策略计算这个值。\n\n1.  **始终跳转 (AT) 策略**：该策略总是预测“跳转”。当且仅当分支实际发生跳转时，预测才是正确的。准确率 $A_{\\text{AT}}$ 是一个分支发生跳转的总概率 $P(T)$。\n    $$A_{\\text{AT}} = P(T) = P(T|B)P(B) + P(T|F)P(F)$$\n    代入给定值：\n    $$A_{\\text{AT}} = p_{\\text{take}\\mid\\text{back}} \\cdot p_{\\text{back}} + p_{\\text{take}\\mid\\text{fwd}} \\cdot (1 - p_{\\text{back}})$$\n    $$A_{\\text{AT}} = (0.85)(0.60) + (0.30)(0.40) = 0.51 + 0.12 = 0.63$$\n\n2.  **始终不跳转 (ANT) 策略**：该策略总是预测“不跳转”。当且仅当分支实际未发生跳转时，预测才是正确的。准确率 $A_{\\text{ANT}}$ 是一个分支不发生跳转的总概率 $P(NT)$。\n    $$A_{\\text{ANT}} = P(NT) = 1 - P(T) = 1 - A_{\\text{AT}}$$\n    $$A_{\\text{ANT}} = 1 - 0.63 = 0.37$$\n\n3.  **后向跳转、前向不跳转 (BTFNT) 策略**：该策略的预测取决于分支的方向。设 $C$ 为预测正确的事件。\n    - 如果分支是后向的（事件 $B$），它预测“跳转”。如果分支实际发生跳转，则预测正确。其概率为 $P(T|B)$。\n    - 如果分支是前向的（事件 $F$），它预测“不跳转”。如果分支实际未发生跳转，则预测正确。其概率为 $P(NT|F)$。\n    使用全概率公式，准确率 $A_{\\text{BTFNT}}$ 为：\n    $$A_{\\text{BTFNT}} = P(C|B)P(B) + P(C|F)P(F)$$\n    $$A_{\\text{BTFNT}} = P(T|B)P(B) + P(NT|F)P(F)$$\n    $$A_{\\text{BTFNT}} = p_{\\text{take}\\mid\\text{back}} \\cdot p_{\\text{back}} + (1 - p_{\\text{take}\\mid\\text{fwd}}) \\cdot (1 - p_{\\text{back}})$$\n    $$A_{\\text{BTFNT}} = (0.85)(0.60) + (1 - 0.30)(0.40) = 0.51 + (0.70)(0.40) = 0.51 + 0.28 = 0.79$$\n\n4.  **前向跳转、后向不跳转 (FTBNT) 策略**：\n    - 如果分支是后向的（事件 $B$），它预测“不跳转”。如果分支实际未发生跳转，则预测正确，其概率为 $P(NT|B)$。\n    - 如果分支是前向的（事件 $F$），它预测“跳转”。如果分支实际发生跳转，则预测正确，其概率为 $P(T|F)$。\n    准确率 $A_{\\text{FTBNT}}$ 为：\n    $$A_{\\text{FTBNT}} = P(C|B)P(B) + P(C|F)P(F)$$\n    $$A_{\\text{FTBNT}} = P(NT|B)P(B) + P(T|F)P(F)$$\n    $$A_{\\text{FTBNT}} = (1 - p_{\\text{take}\\mid\\text{back}}) \\cdot p_{\\text{back}} + p_{\\text{take}\\mid\\text{fwd}} \\cdot (1 - p_{\\text{back}})$$\n    $$A_{\\text{FTBNT}} = (1 - 0.85)(0.60) + (0.30)(0.40) = (0.15)(0.60) + 0.12 = 0.09 + 0.12 = 0.21$$\n\n现在，我们使用 $f_b=0.18$ 和 $L=7$ 来计算每种策略的每指令错误预测惩罚 $S = f_b(1-A)L$。\n- 对于 AT：$S_{\\text{AT}} = 0.18 \\times (1 - 0.63) \\times 7 = 0.18 \\times 0.37 \\times 7 = 0.4662$ 周期/指令。\n- 对于 ANT：$S_{\\text{ANT}} = 0.18 \\times (1 - 0.37) \\times 7 = 0.18 \\times 0.63 \\times 7 = 0.7938$ 周期/指令。\n- 对于 BTFNT：$S_{\\text{BTFNT}} = 0.18 \\times (1 - 0.79) \\times 7 = 0.18 \\times 0.21 \\times 7 = 0.2646$ 周期/指令。\n- 对于 FTBNT：$S_{\\text{FTBNT}} = 0.18 \\times (1 - 0.21) \\times 7 = 0.18 \\times 0.79 \\times 7 = 0.9954$ 周期/指令。\n\n按惩罚 $S$ 的升序对策略进行排序：\n1.  BTFNT ($S = 0.2646$)\n2.  AT ($S = 0.4662$)\n3.  ANT ($S = 0.7938$)\n4.  FTBNT ($S = 0.9954$)\n\n最小惩罚由 BTFNT 策略实现：\n$$\\min S = S_{\\text{BTFNT}} = 0.2646 \\text{ 周期/指令}$$\n\n最后，我们使用基础 CPI $\\text{CPI}_0 = 1.10$ 计算最小总 CPI，即 $\\text{CPI}_{\\min}$。\n$$\\text{CPI}_{\\min} = \\text{CPI}_0 + \\min S$$\n$$\\text{CPI}_{\\min} = 1.10 + 0.2646 = 1.3646$$\n\n问题要求将最终答案四舍五入到四位有效数字。数字 $1.3646$ 有五位有效数字。四舍五入到四位有效数字得到 $1.365$。",
            "answer": "$$ \\boxed{1.365} $$"
        },
        {
            "introduction": "我们的最后一个练习  从应用固定的启发式方法转向设计更智能的静态预测器。通过使用来自程序跟踪的经验数据（一种称为性能剖析的技术），你将基于指令特征推导出一个最优的预测规则。这项任务介绍了一种强大的、数据驱动的方法，编译器可以利用它来做出更智能的静态预测，从而提升程序性能。",
            "id": "3681010",
            "problem": "一个具有五级流水线的处理器使用一个静态分支预测器，该预测器根据分支指令的操作码类别和立即数操作数模式，为每个分支特征类分配一个固定的预测。给定一个由程序轨迹组成的训练语料库，从中测量出以下经验量：\n- 对于每个特征类 $C_{i}$，遇到该类中分支的先验概率 $P(C_{i})$。\n- 对于每个特征类 $C_{i}$，该类中分支实际被采纳的条件概率 $P(T \\mid C_{i})$。\n\n这些特征类是根据编译时可识别的操作码类别和操作数线索定义的：\n1) $C_{1}$：操作码为等于零则分支（表示为 $\\mathrm{BEQZ}$），目标为前向跳转，其 $P(C_{1}) = 0.18$ 且 $P(T \\mid C_{1}) = 0.30$。\n2) $C_{2}$：操作码为 $\\mathrm{BEQZ}$，目标为后向跳转，其 $P(C_{2}) = 0.07$ 且 $P(T \\mid C_{2}) = 0.65$。\n3) $C_{3}$：操作码为不等于零则分支（表示为 $\\mathrm{BNEZ}$），目标为前向跳转，其 $P(C_{3}) = 0.22$ 且 $P(T \\mid C_{3}) = 0.62$。\n4) $C_{4}$：操作码为 $\\mathrm{BNEZ}$，目标为后向跳转，其 $P(C_{4}) = 0.09$ 且 $P(T \\mid C_{4}) = 0.85$。\n5) $C_{5}$：操作码将寄存器与一个非零立即数常量进行比较（例如，立即数 $\\neq 0$ 的 $\\mathrm{BEQI}$ 或 $\\mathrm{BNEI}$），其 $P(C_{5}) = 0.44$ 且 $P(T \\mid C_{5}) = 0.45$。\n\n假设以下基本原则：\n- 静态预测器为同一特征类 $C_{i}$ 内的所有分支确定一个单一的预测。\n- 在 0-1 损失模型下，对于给定的特征类 $C_{i}$，二元分类的最优决策是能最大化该类内正确决策概率的决策。\n- 期望预测准确率是预测器的决策与实际分支结果相匹配的概率，该概率是在所有特征类的分布上取平均值得到的。\n\n任务：\n1) 仅从上述基本原则出发，推导一个简单的静态预测规则。该规则利用特征类 $C_{i}$ 在该类中选择一个固定的预测，以最小化该类中的预测错误。表述此规则时不得涉及任何运行时历史。\n2) 使用推导出的规则以及给定的 $P(C_{i})$ 和 $P(T \\mid C_{i})$，计算该静态预测器在所有类别混合下的期望预测准确率 $A$。将 $A$ 表示为单个实数。将你的答案四舍五入到四位有效数字。不要使用百分号；将 $A$ 表示为 $[0,1]$ 范围内无单位的小数。",
            "solution": "该问题陈述清晰，其科学基础植根于计算机体系结构和概率论的原理，并包含了获得唯一解所需的所有数据。我们可以开始推导和计算。\n\n**第1部分：最优静态预测规则的推导**\n\n目标是为给定特征类 $C_{i}$ 中的分支推导出一个静态预测规则，以最小化预测错误。这等同于最大化该类别的正确预测概率。静态预测器必须为类别 $C_{i}$ 内的所有分支分配一个单一的、固定的预测。两种可能的预测是“预测采纳”（$\\hat{T}$）和“预测不采纳”（$\\hat{N}$）。两种可能的实际结果是“采纳”（$T$）和“不采纳”（$N$）。\n\n我们已知类别 $C_{i}$ 中的分支被采纳的条件概率 $P(T \\mid C_{i})$。因此，它不被采纳的概率是 $P(N \\mid C_{i}) = 1 - P(T \\mid C_{i})$。\n\n让我们评估对于类别 $C_{i}$，两种可能的静态规则下，预测正确的概率。\n\n情况1：预测器对类别 $C_{i}$ 的规则是总是“预测采纳”（$\\hat{T}$）。\n如果分支实际被采纳，则预测正确。此事件的概率是在类别为 $C_{i}$ 的条件下，结果为 $T$ 的概率。\n$$ P(\\text{correct} \\mid \\text{prediction}=\\hat{T}, \\text{class}=C_{i}) = P(T \\mid C_{i}) $$\n\n情况2：预测器对类别 $C_{i}$ 的规则是总是“预测不采纳”（$\\hat{N}$）。\n如果分支实际未被采纳，则预测正确。此事件的概率是在类别为 $C_{i}$ 的条件下，结果为 $N$ 的概率。\n$$ P(\\text{correct} \\mid \\text{prediction}=\\hat{N}, \\text{class}=C_{i}) = P(N \\mid C_{i}) = 1 - P(T \\mid C_{i}) $$\n\n为了最大化正确预测的概率，最优规则是选择对应于更高概率的预测（$\\hat{T}$ 或 $\\hat{N}$）。我们比较 $P(T \\mid C_{i})$ 和 $P(N \\mid C_{i})$。\n\n如果 $P(T \\mid C_{i}) > P(N \\mid C_{i})$，我们选择预测 $\\hat{T}$。代入 $P(N \\mid C_{i}) = 1 - P(T \\mid C_{i})$，该条件变为 $P(T \\mid C_{i}) > 1 - P(T \\mid C_{i})$，可简化为 $2 P(T \\mid C_{i}) > 1$，即 $P(T \\mid C_{i}) > 0.5$。\n\n如果 $P(N \\mid C_{i}) > P(T \\mid C_{i})$，我们选择预测 $\\hat{N}$。该条件变为 $1 - P(T \\mid C_{i}) > P(T \\mid C_{i})$，可简化为 $1 > 2 P(T \\mid C_{i})$，即 $P(T \\mid C_{i})  0.5$。\n\n如果 $P(T \\mid C_{i}) = P(N \\mid C_{i}) = 0.5$，两种预测的准确率相同（均为 $0.5$）。按照惯例，我们可以将这种情况归入其中一个规则，例如“预测不采纳”。\n\n因此，最优的静态预测规则是：\n**对于属于特征类 $C_{i}$ 的任何分支，如果 $P(T \\mid C_{i})  0.5$，则预测“采纳”；如果 $P(T \\mid C_{i}) \\leq 0.5$，则预测“不采纳”。**\n这个规则是静态的，因为它仅依赖于编译时可识别的特征类 $C_{i}$ 及其相关的预计算概率，不参考任何运行时历史。\n\n当使用此最优规则时，类别 $C_i$ 的准确率是更可能发生的结果的概率：\n$$ P(\\text{correct} \\mid C_{i}) = \\max(P(T \\mid C_{i}), P(N \\mid C_{i})) = \\max(P(T \\mid C_{i}), 1 - P(T \\mid C_{i})) $$\n\n**第2部分：期望预测准确率的计算**\n\n总体的期望预测准确率 $A$ 是每个类别准确率的加权平均值，其中权重是遇到每个类别的先验概率 $P(C_i)$。\n$A$ 的计算公式为：\n$$ A = \\sum_{i=1}^{5} P(C_{i}) \\cdot P(\\text{correct} \\mid C_{i}) $$\n\n我们现在将推导出的规则应用于每个特征类，以确定该类的最优预测和相应的准确率。\n\n1.  **类别 $C_{1}$**：$P(T \\mid C_{1}) = 0.30$。\n    因为 $0.30 \\leq 0.5$，所以最优预测是**不采纳**。\n    该类别的准确率为 $P(\\text{correct} \\mid C_{1}) = P(N \\mid C_{1}) = 1 - 0.30 = 0.70$。\n\n2.  **类别 $C_{2}$**：$P(T \\mid C_{2}) = 0.65$。\n    因为 $0.65  0.5$，所以最优预测是**采纳**。\n    该类别的准确率为 $P(\\text{correct} \\mid C_{2}) = P(T \\mid C_{2}) = 0.65$。\n\n3.  **类别 $C_{3}$**：$P(T \\mid C_{3}) = 0.62$。\n    因为 $0.62  0.5$，所以最优预测是**采纳**。\n    该类别的准确率为 $P(\\text{correct} \\mid C_{3}) = P(T \\mid C_{3}) = 0.62$。\n\n4.  **类别 $C_{4}$**：$P(T \\mid C_{4}) = 0.85$。\n    因为 $0.85  0.5$，所以最优预测是**采纳**。\n    该类别的准确率为 $P(\\text{correct} \\mid C_{4}) = P(T \\mid C_{4}) = 0.85$。\n\n5.  **类别 $C_{5}$**：$P(T \\mid C_{5}) = 0.45$。\n    因为 $0.45 \\leq 0.5$，所以最优预测是**不采纳**。\n    该类别的准确率为 $P(\\text{correct} \\mid C_{5}) = P(N \\mid C_{5}) = 1 - 0.45 = 0.55$。\n\n现在，我们使用先验概率 $P(C_i)$ 计算总的期望准确率 $A$：\n$$ A = P(C_1) P(\\text{correct} \\mid C_1) + P(C_2) P(\\text{correct} \\mid C_2) + P(C_3) P(\\text{correct} \\mid C_3) + P(C_4) P(\\text{correct} \\mid C_4) + P(C_5) P(\\text{correct} \\mid C_5) $$\n代入给定值和计算值：\n$$ A = (0.18)(0.70) + (0.07)(0.65) + (0.22)(0.62) + (0.09)(0.85) + (0.44)(0.55) $$\n$$ A = 0.126 + 0.0455 + 0.1364 + 0.0765 + 0.242 $$\n将这些乘积相加：\n$$ A = 0.6264 $$\n结果 $0.6264$ 具有四位有效数字，符合要求。",
            "answer": "$$\\boxed{0.6264}$$"
        }
    ]
}