{
    "hands_on_practices": [
        {
            "introduction": "设计控制单元时，需要决定如何表示控制信号。垂直微码通过对互斥信号进行编码，提供了一种节省空间的方法。本练习将提供计算垂直编码控制存储器所需位宽的基础经验，通过计算不同功能单元的需求，你将掌握编码效率的核心原则，这是计算机体系结构中的一个基本权衡。",
            "id": "3630474",
            "problem": "一个微编码处理器使用垂直微指令格式，其中控制存储器将每个功能单元的互斥操作编码为独立的、平铺的字段，每个单元一个字段。假设在单个微周期内，有以下单元及其列举的允许操作。每个单元的字段必须明确包含一个“无操作”选项，并且为给定单元列出的所有操作在该微周期内是互斥的。\n\n- 算术逻辑单元 (ALU): {$A$直通, $B$直通, $A+B$加法, $A-B$减法, 按位与, 按位或, 按位异或, $A$的按位非, $A$自增, $A$自减, 无操作}，共计 $11$ 种选择。\n- 桶形移位器: {无操作, 逻辑左移1位, 逻辑右移1位, 算术右移1位, 循环左移1位, 循环右移1位}，共计 $6$ 种选择。\n- 寄存器文件写目标 (单写端口): {无操作, 写入 $R_0$, 写入 $R_1$, $\\dots$, 写入 $R_{15}$}，共计 $17$ 种选择。\n- 存储器接口: {无操作, 读字, 读字节, 写字, 写字节, 读输入/输出, 写输入/输出}，共计 $7$ 种选择。\n- 内部总线驱动选择: {无操作, $A$输入锁存器, $B$输入锁存器, ALU结果, 移位器结果, 存储器数据寄存器, 立即数字段, 微程序常数生成器, 程序计数器, 零常数}，共计 $10$ 种选择。\n- 条件码更新单元: {无操作, 根据ALU更新$\\mathrm{NZVC}$, 根据移位器更新$\\mathrm{NZ}$, 仅根据ALU更新$C$, 仅根据ALU更新$V$}，共计 $5$ 种选择。\n\n在采用最小化控制存储器宽度同时保持跨单元独热语义（即每个微指令字段中每个单元只有一个编码操作）的垂直编码下，确定每个单元字段所需的最小位数，并计算一个微指令字的级联控制字段的总宽度。将最终答案表示为一个单行矩阵，其中的条目按顺序分别为ALU、桶形移位器、寄存器文件写目标、存储器接口、内部总线驱动选择、条件码更新单元的字段宽度，最后是总宽度。无需取整。最终答案中不要包含任何单位名称。",
            "solution": "问题陈述在科学上是合理的，提法明确，客观且内部一致。它提出了一个计算机组成与体系结构中的标准问题，涉及微编码处理器的控制存储器设计。所有必要的数据都已提供，没有矛盾或含糊之处会妨碍得出唯一正确的解。任务是确定垂直微指令格式中几个控制字段所需的最小位数以及这些字段的总宽度。\n\n确定这一点的基本原理源于信息论。为了唯一地编码 $N$ 个互斥项或操作，所需的最小位数 $b$ 是满足 $2^b \\ge N$ 的最小整数。这可以用上取整函数在数学上表示为：\n$$b = \\lceil \\log_2(N) \\rceil$$\n此公式给出了可以表示所有 $N$ 种可能性的二进制编码字段的宽度。我们将此原理应用于问题中指定的每个功能单元。\n\n1.  **算术逻辑单元 (ALU)**: ALU有 $N_{ALU} = 11$ 种互斥操作。ALU控制字段所需的最小位数 $b_{ALU}$ 为：\n    $$b_{ALU} = \\lceil \\log_2(11) \\rceil$$\n    由于 $2^3 = 8$ 且 $2^4 = 16$，我们有 $8  11 \\le 16$。因此，最小整数位数为 $4$。\n    $$b_{ALU} = 4$$\n\n2.  **桶形移位器**: 桶形移位器有 $N_{shifter} = 6$ 种互斥操作。其控制字段所需的最小位数 $b_{shifter}$ 为：\n    $$b_{shifter} = \\lceil \\log_2(6) \\rceil$$\n    由于 $2^2 = 4$ 且 $2^3 = 8$，我们有 $4  6 \\le 8$。因此，最小位数为 $3$。\n    $$b_{shifter} = 3$$\n\n3.  **寄存器文件写目标**: 寄存器文件有 $16$ 个可能的目标寄存器（$R_0$ 到 $R_{15}$）和一个“无操作”选项，总共有 $N_{reg} = 16 + 1 = 17$ 种互斥选择。该字段的最小位数 $b_{reg}$ 为：\n    $$b_{reg} = \\lceil \\log_2(17) \\rceil$$\n    由于 $2^4 = 16$ 且 $2^5 = 32$，我们有 $16  17 \\le 32$。因此，最小位数为 $5$。\n    $$b_{reg} = 5$$\n\n4.  **存储器接口**: 存储器接口有 $N_{mem} = 7$ 种互斥操作。其控制字段的最小位数 $b_{mem}$ 为：\n    $$b_{mem} = \\lceil \\log_2(7) \\rceil$$\n    由于 $2^2 = 4$ 且 $2^3 = 8$，我们有 $4  7 \\le 8$。因此，最小位数为 $3$。\n    $$b_{mem} = 3$$\n\n5.  **内部总线驱动选择**: 此单元有 $N_{bus} = 10$ 种互斥选项。其控制字段的最小位数 $b_{bus}$ 为：\n    $$b_{bus} = \\lceil \\log_2(10) \\rceil$$\n    由于 $2^3 = 8$ 且 $2^4 = 16$，我们有 $8  10 \\le 16$。因此，最小位数为 $4$。\n    $$b_{bus} = 4$$\n\n6.  **条件码更新单元**: 此单元有 $N_{cc} = 5$ 种互斥操作。其控制字段的最小位数 $b_{cc}$ 为：\n    $$b_{cc} = \\lceil \\log_2(5) \\rceil$$\n    由于 $2^2 = 4$ 且 $2^3 = 8$，我们有 $4  5 \\le 8$。因此，最小位数为 $3$。\n    $$b_{cc} = 3$$\n\n最后，级联控制字段的总宽度 $W_{total}$ 是各个字段宽度之和：\n$$W_{total} = b_{ALU} + b_{shifter} + b_{reg} + b_{mem} + b_{bus} + b_{cc}$$\n代入计算出的值：\n$$W_{total} = 4 + 3 + 5 + 3 + 4 + 3 = 22$$\n微指令字的控制部分总宽度为 $22$ 位。\n\n所需的字段宽度按顺序为：\n- ALU：$4$ 位\n- 桶形移位器：$3$ 位\n- 寄存器文件写目标：$5$ 位\n- 存储器接口：$3$ 位\n- 内部总线驱动选择：$4$ 位\n- 条件码更新单元：$3$ 位\n- 总宽度：$22$ 位",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n4  3  5  3  4  3  22\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "虽然垂直编码可以节省空间，但这并非没有代价。将紧凑编码转换回独立控制信号所需的译码逻辑需要时间，这可能会影响处理器的最高时钟速度。本练习深入探讨了微程序控制单元的关键时序约束，通过分析译码器延迟与微周期时钟周期之间的关系，你将了解物理实现细节如何限制体系结构的选择，并深入理解控制存储器大小与处理器速度之间的权衡。",
            "id": "3630489",
            "problem": "一个微程序中央处理器（CPU）通过包含微指令的只读存储器构成的控制存储器来实现其控制信号。考虑在水平微指令格式和垂直微指令格式之间的设计选择。在水平格式中，每个控制信号由一位直接指定；而在垂直格式中，一个 $b$ 位的字段编码 $2^{b}$ 种可能的微操作之一，这些微操作在使用前必须通过组合逻辑解码成单个控制信号。\n\n假设一个垂直字段是使用一个由2对1多路复用器（MUX）组成的平衡二叉树实现的，其中每一级使用 $b$ 个选择位中的一个，并产生 $t_{d}$ 的传播延迟。控制存储器的访问时间为 $t_{cs}$，微指令被锁存到微指令寄存器中，其建立时间为 $t_{su}$。目标微周期时钟周期为 $T_{clk}$。正确操作的时序约束是：控制存储器访问、寄存器建立和垂直解码的延迟之和必须严格小于时钟周期。\n\n从垂直编码的定义和二叉MUX树的结构出发，推导出确保时序收敛的最大字段宽度 $b$ 的约束条件。然后，对于一个具体设计，其中 $T_{clk} = 3.8$ 纳秒，$t_{cs} = 1.5$ 纳秒，$t_{su} = 0.4$ 纳秒，以及 $t_{d} = 0.22$ 纳秒，计算最大允许的垂直字段宽度 $b_{\\max}$（作为整数）。同时，计算当 $b = b_{\\max}$ 时对应的垂直解码延迟 $t_{v}$，并判断在该设计中 $t_{v}  T_{clk}$ 是否成立。最终答案只报告 $b_{\\max}$ 的值，不带单位。除了确定整数值外，不需要进行其他舍入。",
            "solution": "该问题要求分析微程序控制器中的时序约束，特别关注垂直编码微指令格式的影响。我们必须首先正式建立垂直编码的字段宽度与所产生的传播延迟之间的关系，然后利用这种关系在给定的时钟周期和元件延迟下，求出最大可能的字段宽度。\n\n问题给出了在单个微周期内正确操作的核心时序约束：从控制存储器访问开始到控制信号在其目的地稳定下来的总时间必须小于时钟周期。这可以表示为一个不等式。该路径包含三个顺序延迟：\n1. 读取微指令的控制存储器访问时间，$t_{cs}$。\n2. 垂直解码器的延迟，$t_{v}$，它将编码字段转换为单个控制信号。\n3. 捕获控制信号的最终寄存器的建立时间，$t_{su}$。注意：问题陈述微指令被锁存到建立时间为 $t_{su}$ 的微指令寄存器中。然而，给出的时序约束是访问、*解码*和建立延迟之和小于时钟周期。这意味着解码发生在结果被使用的时钟周期结束之前。一个更标准的路径应该是：时钟沿 $\\rightarrow$ 控制存储器访问 $\\rightarrow$ 微指令寄存器锁存 $\\rightarrow$ 解码器 $\\rightarrow$ 在最终目标寄存器处的建立。问题通过将这些延迟组合成单个路径约束来简化这一点：$t_{cs} + t_{v} + t_{su}  T_{clk}$。我们将严格遵守问题陈述的约束。\n\n总延迟 $t_{path}$ 是这些元件延迟之和：\n$$t_{path} = t_{cs} + t_{v} + t_{su}$$\n\n正确操作的时序约束是该路径延迟必须严格小于微周期时钟周期 $T_{clk}$：\n$$t_{cs} + t_{v} + t_{su}  T_{clk}$$\n\n下一步是确定垂直解码延迟 $t_{v}$ 作为字段宽度 $b$ 的函数。问题陈述一个 $b$ 位字段的解码器是作为一个由2对1多路复用器（MUX）组成的平衡二叉树实现的。一个 $b$ 位字段的解码器必须选择 $2^b$ 个输出中的一个。一个2对1 MUX有一条选择线，可以解码一个 $b=1$ 的字段。一个4对1 MUX，用于解码一个 $b=2$ 的字段，可以由一个两级的2对1 MUX树构成。推广开来，一个由2对1 MUX平衡树构成的 $2^b$对1 MUX将有 $b$ 级的深度。从输入到最终输出的信号传播关键路径在每一级都会经过一个MUX。\n\n鉴于每一级贡献了 $t_{d}$ 的传播延迟，一个 $b$ 位字段的总垂直解码延迟 $t_{v}$ 为：\n$$t_{v} = b \\cdot t_{d}$$\n\n将 $t_{v}$ 的这个表达式代入时序约束不等式，得到关于字段宽度 $b$ 的一般约束：\n$$t_{cs} + t_{su} + b \\cdot t_{d}  T_{clk}$$\n\n为了求得最大允许字段宽度，我们对 $b$ 解这个不等式：\n$$b \\cdot t_{d}  T_{clk} - t_{cs} - t_{su}$$\n$$b  \\frac{T_{clk} - t_{cs} - t_{su}}{t_{d}}$$\n这个表达式代表了从问题的定义中推导出的对 $b$ 的一般约束。\n\n现在，我们将这个一般约束应用于所提供的具体设计参数：\n- $T_{clk} = 3.8$ 纳秒\n- $t_{cs} = 1.5$ 纳秒\n- $t_{su} = 0.4$ 纳秒\n- $t_{d} = 0.22$ 纳秒\n\n将这些值代入不等式：\n$$b  \\frac{3.8 - 1.5 - 0.4}{0.22}$$\n$$b  \\frac{1.9}{0.22}$$\n为了化简这个分数，我们可以将其写为：\n$$b  \\frac{190}{22} = \\frac{95}{11}$$\n进行除法运算得到：\n$$b  8.6363...$$\n\n由于 $b$ 代表字段中的位数，它必须是一个整数。满足这个严格不等式的 $b$ 的最大整数值是 $8$。因此，最大允许的垂直字段宽度是：\n$$b_{\\max} = 8$$\n\n问题还要求计算当 $b = b_{\\max}$ 时的相应垂直解码延迟 $t_{v}$，并验证 $t_v  T_{clk}$。\n对于 $b_{\\max} = 8$，解码延迟是：\n$$t_{v} = b_{\\max} \\cdot t_{d} = 8 \\cdot 0.22 = 1.76 \\text{ 纳秒}$$\n\n最后，我们检查条件 $t_{v}  T_{clk}$：\n$$1.76  3.8$$\n这个不等式成立。我们也可以验证对于 $b_{\\max}=8$，完整的时序约束是满足的：\n$$t_{cs} + t_{su} + t_{v} = 1.5 + 0.4 + 1.76 = 3.66 \\text{ 纳秒}$$\n由于 $3.66  3.8$，时序得到满足。对于下一个整数 $b=9$，总延迟将是 $1.5 + 0.4 + (9 \\cdot 0.22) = 1.9 + 1.98 = 3.88$，这违反了条件 $3.88  3.8$。因此，确认 $b_{\\max}=8$ 是正确的最大整数值。\n\n所要求的最终答案是 $b_{\\max}$ 的值。",
            "answer": "$$\\boxed{8}$$"
        },
        {
            "introduction": "体系结构决策通常涉及硬件成本和性能之间的权衡。像时间复用控制信号这样的技术可以减小控制存储器的尺寸，但其对整体性能的代价是什么？本练习将分析提升到系统层面，将微体系结构的设计选择与处理器的整体性能（以每指令周期数 $CPI$ 衡量）直接联系起来。通过计算由时间复用引起的 $CPI$ 膨胀，你将对设计权衡如何影响实际性能有一个定量的理解。",
            "id": "3630490",
            "problem": "一个微程序中央处理器使用位于只读存储器（ROM）中的全水平控制存储器，其中每个微指令在一个时钟化的微周期内发出大量控制信号。在基准机器中，微周期时间等于处理器时钟周期，因此指令集架构（ISA）层面的每指令周期数（CPI）等于每条ISA指令执行的平均微指令数。ISA指令混合被划分为四个类别，其频率和基准微指令计数如下：类别 $A$（算术和逻辑），频率 $f_A = 0.35$，微指令数 $m_A = 3$；类别 $B$（加载），频率 $f_B = 0.25$，微指令数 $m_B = 6$；类别 $C$（存储），频率 $f_C = 0.25$，微指令数 $m_C = 4$；类别 $D$（分支），频率 $f_D = 0.15$，微指令数 $m_D = 2$。\n\n为了减小控制存储器的宽度，设计者采用了控制信号的时分复用技术：宽的水平控制字被划分为两个不相交的存储体，$A$ 存储体（与算术逻辑单元（ALU）和寄存器读取相关的信号）和 $B$ 存储体（与内存接口和寄存器写回相关的信号）。在任何给定的微周期中，硬件只能发出一个存储体的信号。只需要一个存储体的微指令在一个微周期内完成；需要两个存储体的微指令需要连续两个微周期（每个存储体一个）。微周期时间与基准情况相比保持不变。\n\n对于每个类别 $X \\in \\{A,B,C,D\\}$，假设微指令在存储体使用方面是独立同分布的，其概率为：需要两个存储体的概率 $p_{\\text{both},X}$，只需要 $A$ 存储体的概率 $p_{A,X}$，以及只需要 $B$ 存储体的概率 $p_{B,X}$，其中 $p_{\\text{both},X} + p_{A,X} + p_{B,X} = 1$。设计者的工作负载特性分析得出：\n- 类别 $A$：$p_{\\text{both},A} = 0.25$，$p_{A,A} = 0.60$，$p_{B,A} = 0.15$。\n- 类别 $B$：$p_{\\text{both},B} = 0.50$，$p_{A,B} = 0.20$，$p_{B,B} = 0.30$。\n- 类别 $C$：$p_{\\text{both},C} = 0.40$，$p_{A,C} = 0.30$，$p_{B,C} = 0.30$。\n- 类别 $D$：$p_{\\text{both},D} = 0.10$，$p_{A,D} = 0.70$，$p_{B,D} = 0.20$。\n\n仅使用每指令周期数（CPI）作为每条ISA指令的平均时钟周期数的定义以及所述的时序模型，从基本原理出发，推导仅由双存储体时分复用引起的CPI乘法膨胀因子\n$$\\rho = \\frac{\\text{CPI}_{\\text{new}}}{\\text{CPI}_{\\text{base}}}$$\n将您最终的 $\\rho$ 数值答案四舍五入到四位有效数字。",
            "solution": "问题要求计算每指令周期数（CPI）的乘法膨胀因子 $\\rho$，其定义为新的双存储体系统中的CPI与基准系统中的CPI之比。该比值由以下表达式给出：\n$$\n\\rho = \\frac{\\text{CPI}_{\\text{new}}}{\\text{CPI}_{\\text{base}}}\n$$\n\n首先，我们必须推导基准系统中CPI的表达式，即 $\\text{CPI}_{\\text{base}}$。问题陈述，对于基准机器，指令集架构（ISA）层面的CPI等于每条ISA指令执行的平均微指令数。这个平均值是根据四类指令计算的，并按它们各自的频率加权。设 $X$ 为指令类别的索引，$X \\in \\{A, B, C, D\\}$。设 $f_X$ 是类别 $X$ 指令的频率，$m_X$ 是执行一条类别 $X$ 指令所需的微指令数。那么，基准CPI为：\n$$\n\\text{CPI}_{\\text{base}} = \\sum_{X \\in \\{A,B,C,D\\}} f_X m_X\n$$\n使用所提供的数据：\n- 类别 $A$：$f_A = 0.35$, $m_A = 3$\n- 类别 $B$：$f_B = 0.25$, $m_B = 6$\n- 类别 $C$：$f_C = 0.25$, $m_C = 4$\n- 类别 $D$：$f_D = 0.15$, $m_D = 2$\n\n我们可以计算 $\\text{CPI}_{\\text{base}}$ 的数值：\n$$\n\\text{CPI}_{\\text{base}} = (f_A m_A) + (f_B m_B) + (f_C m_C) + (f_D m_D)\n$$\n$$\n\\text{CPI}_{\\text{base}} = (0.35 \\times 3) + (0.25 \\times 6) + (0.25 \\times 4) + (0.15 \\times 2)\n$$\n$$\n\\text{CPI}_{\\text{base}} = 1.05 + 1.50 + 1.00 + 0.30 = 3.85\n$$\n\n接下来，我们推导新系统中CPI的表达式，即 $\\text{CPI}_{\\text{new}}$。在新的设计中，执行单个微指令所需的微周期数不再统一为 $1$。它取决于所需的控制信号存储体。\n- 如果一条微指令只需要来自一个存储体（$A$ 存储体或 $B$ 存储体）的信号，它在 $1$ 个微周期内完成。\n- 如果一条微指令需要来自两个存储体的信号，它需要 $2$ 个微周期。\n\n问题陈述，微周期时间保持不变，因此CPI等于每条ISA指令的平均微周期数。设 $c_X$ 为类别 $X$ 指令的每条微指令的平均微周期数。这是一个基于存储体使用概率的加权平均值：$p_{A,X}$（仅 $A$ 存储体），$p_{B,X}$（仅 $B$ 存储体），以及 $p_{\\text{both},X}$（两个存储体）。\n$$\nc_X = (p_{A,X} \\times 1) + (p_{B,X} \\times 1) + (p_{\\text{both},X} \\times 2)\n$$\n由于概率之和必须为 $1$，即 $p_{A,X} + p_{B,X} + p_{\\text{both},X} = 1$，我们可以简化 $c_X$ 的表达式：\n$$\nc_X = (1 - p_{\\text{both},X}) + (p_{\\text{both},X} \\times 2) = 1 - p_{\\text{both},X} + 2 p_{\\text{both},X} = 1 + p_{\\text{both},X}\n$$\n现在我们使用提供的概率计算每个指令类别的 $c_X$：\n- 类别 $A$：$p_{\\text{both},A} = 0.25 \\implies c_A = 1 + 0.25 = 1.25$\n- 类别 $B$：$p_{\\text{both},B} = 0.50 \\implies c_B = 1 + 0.50 = 1.50$\n- 类别 $C$：$p_{\\text{both},C} = 0.40 \\implies c_C = 1 + 0.40 = 1.40$\n- 类别 $D$：$p_{\\text{both},D} = 0.10 \\implies c_D = 1 + 0.10 = 1.10$\n\n在新系统中，一条类别 $X$ 的ISA指令的平均微周期数是基准微指令数 $m_X$ 乘以新的每微指令平均微周期数 $c_X$。因此，一条类别 $X$ 指令的总周期数为 $m_X c_X$。\n新系统的总体CPI，即 $\\text{CPI}_{\\text{new}}$，是这些值在所有指令类别上的加权平均值：\n$$\n\\text{CPI}_{\\text{new}} = \\sum_{X \\in \\{A,B,C,D\\}} f_X (m_X c_X)\n$$\n代入已知值：\n$$\n\\text{CPI}_{\\text{new}} = (f_A m_A c_A) + (f_B m_B c_B) + (f_C m_C c_C) + (f_D m_D c_D)\n$$\n$$\n\\text{CPI}_{\\text{new}} = (0.35 \\times 3 \\times 1.25) + (0.25 \\times 6 \\times 1.50) + (0.25 \\times 4 \\times 1.40) + (0.15 \\times 2 \\times 1.10)\n$$\n$$\n\\text{CPI}_{\\text{new}} = (1.05 \\times 1.25) + (1.50 \\times 1.50) + (1.00 \\times 1.40) + (0.30 \\times 1.10)\n$$\n$$\n\\text{CPI}_{\\text{new}} = 1.3125 + 2.25 + 1.40 + 0.33 = 5.2925\n$$\n\n最后，我们计算CPI膨胀因子 $\\rho$：\n$$\n\\rho = \\frac{\\text{CPI}_{\\text{new}}}{\\text{CPI}_{\\text{base}}} = \\frac{5.2925}{3.85}\n$$\n$$\n\\rho \\approx 1.37467532467...\n$$\n问题要求答案四舍五入到四位有效数字。前四位有效数字是 $1$、$3$、$7$ 和 $4$。第五位数字是 $6$，所以我们将第四位数字向上取整。\n$$\n\\rho \\approx 1.375\n$$",
            "answer": "$$\n\\boxed{1.375}\n$$"
        }
    ]
}