{
    "hands_on_practices": [
        {
            "introduction": "多路选择器 (MUX) 是数据通路中的“交通警察”，负责将来自不同来源的数据引导至一个共同的目的地，例如算术逻辑单元 (ALU) 的输入端。随着设计变得日益复杂，数据源的数量也可能随之增加，这对 MUX 的设计提出了挑战。本练习将引导你探索 MUX 的基本控制原理，即如何根据输入数量确定所需的控制信号线数 ，并介绍分层设计这一实用策略如何用于管理复杂性，让你亲身体验硬件设计者所面临的权衡。",
            "id": "3633232",
            "problem": "一位数据通路设计师正在修改算术逻辑单元（ALU）第一个操作数端口的输入选择网络。当前的设计使用一个扁平的 $k$ 输入多路复用器（MUX），用于在 $k$ 个现有源之间进行选择，这些源均与下文描述的计划新增部分不同且不相交。为了支持新的操作，该ALU输入端必须提供五个额外的源选项：程序计数器（PC）、寄存器文件输出 $A$、一个符号扩展的立即数 $imm$、一个硬连线常量 $zero$，以及特殊寄存器 $HI$ 和 $LO$ 作为两个独立的可选源。\n\n你必须确定需要多少控制（选择）线来 (i) 支持一个将所有选项直接复用到单个MUX中的扁平设计，以及 (ii) 通过提出一个两级层次结构来减少扇入，该结构将这些新源组合起来，使得只有一个代表新源的聚合输入被呈现给现有的顶层选择器。具体来说，提出并分析一个具有以下约束的层次结构：\n- 首先，使用一个 $2$-to-$1$ MUX 在 $HI$ 和 $LO$ 之间进行选择。\n- 然后，使用一个 MUX 在五个新源 $\\{PC, A, imm, zero, \\text{以及HI/LO选择的结果}\\}$ 中进行选择。\n- 最后，使用一个顶层 MUX 在聚合的新源输出和 $k$ 个现有源之间进行选择。\n\n假设每个 MUX 都由唯一选择其输入之一所需的最少数量的选择线来控制。使用关于二进制编码和控制信号最小化的基本原理，推导出该层次结构设计中所有多路复用器所需的总选择线数的精确总数，作为 $k$ 的函数。将你的最终答案表示为关于 $k$ 的单一封闭形式解析表达式。不需要四舍五入。",
            "solution": "首先对问题进行验证。\n\n### 步骤1：提取已知条件\n- 存在一个现有的数据通路，其ALU的第一个操作数端口有一个 $k$ 输入多路复用器（MUX）。\n- 存在 $k$ 个现有的、不同的且不相交的源。\n- 需要添加五个额外的源选项，具体为：程序计数器（PC）、寄存器文件输出 $A$、符号扩展的立即数 $imm$、硬连线常量 $zero$，以及特殊寄存器 $HI$ 和 $LO$ 作为两个独立的可选源。\n- 提出了一个具有以下结构的两级层次化设计：\n    1. 一个 $2$-to-$1$ MUX 在 $HI$ 和 $LO$ 之间进行选择。\n    2. 第二个 MUX 在五个源之间进行选择：$\\{PC, A, imm, zero, \\text{以及HI/LO选择的结果}\\}$。\n    3. 一个顶层 MUX 在聚合的新源输出（来自第二个MUX）和 $k$ 个现有源之间进行选择。\n- 假设：每个MUX使用所需的最少数量的选择线。\n- 目标：推导出整个层次结构设计所需选择线总数的精确值，作为 $k$ 的函数。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题在科学上基于数字逻辑设计和计算机体系结构的原理，特别是关于像多路复用器这样的数据通路组件。所用术语（$ALU, PC, MUX, HI, LO$ 等）在该领域是标准的。问题提法清晰，为待分析的层次化MUX结构提供了明确无误的规范。虽然最初描述的“五个额外的源选项”在列出六个信号（$PC, A, imm, zero, HI, LO$）时可能显得模糊不清，但后续关于层次结构的详细约束精确地阐明了该结构。问题是客观的，不包含任何推测性或主观性的论断。问题是完整的，包含了推导出唯一解所需的所有信息。所要求的任务是基本原理的直接应用，并且是可以用数学形式化的。\n\n### 步骤3：结论与行动\n问题被判定为**有效**。将根据所提供的规范推导解决方案。\n\n### 推导过程\n控制多路复用器设计的基本原理是，一个 $N$ 输入的MUX需要至少 $S$ 条选择线，其中 $S$ 是满足不等式 $2^S \\ge N$ 的最小整数。这在数学上使用向上取整函数表示为：\n$$S = \\lceil \\log_2(N) \\rceil$$\n我们将此原理应用于指定的层次结构设计中的每个多路复用器，以确定其所需的选择线数量。总数将是每个MUX选择线数量的总和，因为它们的控制信号是独立的。\n\n该层次结构设计由三个不同的多路复用器组成。我们来逐一分析。\n\n1.  **用于 HI/LO 选择的第一级MUX：**\n    该MUX被指定用于在两个特殊寄存器 $HI$ 和 $LO$ 之间进行选择。\n    - 输入数量为 $N_1 = 2$。\n    - 因此，选择线的数量 $S_1$ 为：\n      $$S_1 = \\lceil \\log_2(N_1) \\rceil = \\lceil \\log_2(2) \\rceil = \\lceil 1 \\rceil = 1$$\n    这个 $2$-to-$1$ MUX 需要 1 条选择线。\n\n2.  **用于新源聚合的第一级MUX：**\n    该MUX聚合了新的源。其输入被指定为集合 $\\{PC, A, imm, zero, \\text{以及HI/LO选择的结果}\\}$。第五个输入是来自第一个 MUX 的输出。\n    - 输入数量为 $N_2 = 5$。\n    - 选择线的数量 $S_2$ 为：\n      $$S_2 = \\lceil \\log_2(N_2) \\rceil = \\lceil \\log_2(5) \\rceil$$\n      由于 $2^2 = 4$ 且 $2^3 = 8$，大于或等于 $5$ 的最小的 $2$ 的整数次幂是 $8$。因此，我们需要 $3$ 条选择线。\n      $$S_2 = 3$$\n    这个 5-to-1 MUX（在实践中实现为一个有 $3$ 个未使用输入的 8-to-1 MUX）需要 3 条选择线。\n\n3.  **用于最终选择的顶层MUX：**\n    该MUX为ALU操作数端口做出最终选择。其输入包括 $k$ 个现有源以及前一步骤中描述的新源聚合MUX的单个聚合输出。\n    - 总输入数量为 $N_3 = k + 1$。\n    - 选择线的数量 $S_3$ 是 $k$ 的函数：\n      $$S_3 = \\lceil \\log_2(N_3) \\rceil = \\lceil \\log_2(k+1) \\rceil$$\n    在不知道 $k$ 的具体值的情况下，此表达式无法进一步简化。\n\n**总选择线数：**\n整个层次结构设计的总选择线数 $S_{total}$ 是三个独立多路复用器选择线数之和。\n$$S_{total} = S_1 + S_2 + S_3$$\n代入推导出的值：\n$$S_{total} = 1 + 3 + \\lceil \\log_2(k+1) \\rceil$$\n$$S_{total} = 4 + \\lceil \\log_2(k+1) \\rceil$$\n这就是为指定的层次化数据通路结构所需的控制线总数的最终封闭形式解析表达式，它以现有源的数量 $k$ 为函数。",
            "answer": "$$\n\\boxed{4 + \\lceil \\log_2(k+1) \\rceil}\n$$"
        },
        {
            "introduction": "在数据通路中，并非所有操作的性能成本都相同。算术运算需要具有显著延迟的复杂逻辑门，而某些操作（如重新排列位）则可以通过简单的布线实现。本练习将聚焦于跳转指令目标地址的计算 ，通过对比加法器等重逻辑组件与位拼接等在硬件上近乎“零成本”的操作之间的延迟差异，揭示不同指令在硬件层面执行速度差异的根源。这种分析对于优化指令集和设计高效的处理器至关重要。",
            "id": "3677861",
            "problem": "一个使用固定格式跳转指令的架构的 $32$ 位单周期数据通路，通过组合程序计数器（PC）的高位比特和指令寄存器（IR）的低位比特来形成跳转目标地址，并进行字对齐。具体来说，目标总线由 $ \\{ PC[31:28],\\, IR[25:0],\\, 00 \\} $ 组合而成，其中 $IR[25:0]$ 左移 $2$ 位（以实现字对齐），最低两位为零，最高四位来自 $PC[31:28]$。该数据通路包含一个计算 $PC+4$ 的 $32$ 位加法器和一个 $32$ 位 $2$-to-$1$ 多路复用器（MUX），该多路复用器选择 $PC+4$ 或形成的跳转目标作为下一个 $PC$ 的输入。\n\n使用同步组合逻辑时序的第一性原理——即串行组合级联的总传播延迟是各级延迟之和——以及固定左移和位拼接可以通过布线（无逻辑门）实现的硬件事实，在总线级别构建位拼接硬件，并将其延迟建模为布线贡献的总和。然后，量化通过拼接形成跳转目标的延迟与 $PC$ 加法器和输出选择 MUX 的组合延迟的比较。\n\n假设以下物理上合理的延迟：\n- $t_{\\text{add}} = 0.36\\,\\text{ns}$，用于产生 $PC+4$ 的 $32$ 位加法器，\n- $t_{\\text{mux}} = 0.11\\,\\text{ns}$，用于 $32$ 位 $2$-to-$1$ MUX，\n- $t_{\\text{shift}} = 0.02\\,\\text{ns}$，用于将 $IR[25:0]$ 布线到总线位置 $[27:2]$（通过布线实现的左移 $2$ 位），\n- $t_{\\text{top}} = 0.01\\,\\text{ns}$，用于将 $PC[31:28]$ 布线到总线位置 $[31:28]$，\n- $t_{\\text{concat}} = 0.03\\,\\text{ns}$，用于将三个子总线 $\\{ PC[31:28] \\}$、$\\{ IR[25:0] \\ll 2 \\}$ 和 $\\{ 00 \\}$ 拼接成一个 $32$ 位目标总线。\n\n将相对延迟 $R$ 定义为仅由位拼接形成跳转目标的延迟与加法器和 MUX 延迟之和的比率。根据所述原理推导出 $R$，并使用上述参数计算其数值。将您的答案四舍五入到四位有效数字。答案是无单位的；提供 $R$ 的最终值，不带单位。",
            "solution": "问题陈述已经过严格验证，被认为是科学上合理的、定义明确的、客观的且内部一致的。它提出了一个计算机数据通路时序分析中的标准问题，包含了所有必要的参数和明确的目标。因此，可以构建一个正式的解决方案。\n\n目标是确定相对延迟 $R$，它被定义为形成跳转目标地址的延迟与程序计数器（$PC$）加法器和输出选择多路复用器（MUX）的组合延迟之比。该问题是在一个 $32$ 位单周期数据通路的背景下提出的。\n\n相对延迟 $R$ 由以下公式给出：\n$$\nR = \\frac{T_{\\text{jump\\_formation}}}{T_{\\text{adder\\_mux}}}\n$$\n其中 $T_{\\text{jump\\_formation}}$ 是仅由形成跳转目标地址产生的延迟，而 $T_{\\text{adder\\_mux}}$ 是加法器和 MUX 延迟的总和。我们将分别计算这两个量。\n\n首先，我们确定形成跳转目标的延迟 $T_{\\text{jump\\_formation}}$。问题指明跳转目标地址是通过拼接三个字段来组装的：$\\{ PC[31:28], IR[25:0] \\ll 2, 00_2 \\}$。问题将此操作的总延迟建模为布线和拼接贡献的总和。给定的延迟是：\n-   $t_{\\text{top}} = 0.01\\,\\text{ns}$：将程序计数器的高位比特 $PC[31:28]$ 布线到目标总线位置 $[31:28]$ 的延迟。\n-   $t_{\\text{shift}} = 0.02\\,\\text{ns}$：将指令寄存器比特 $IR[25:0]$ 通过布线左移到目标总线位置 $[27:2]$ 的延迟。\n-   $t_{\\text{concat}} = 0.03\\,\\text{ns}$：将三个子总线（$PC$ 比特、移位的 $IR$ 比特和硬连线的低位比特 $00_2$）拼接成最终 $32$ 位总线的延迟。\n\n根据问题指导我们应用的串行级延迟求和原理，跳转目标形成的总延迟为：\n$$\nT_{\\text{jump\\_formation}} = t_{\\text{top}} + t_{\\text{shift}} + t_{\\text{concat}}\n$$\n代入给定的数值：\n$$\nT_{\\text{jump\\_formation}} = 0.01\\,\\text{ns} + 0.02\\,\\text{ns} + 0.03\\,\\text{ns} = 0.06\\,\\text{ns}\n$$\n\n接下来，我们计算加法器和 MUX 的组合延迟 $T_{\\text{adder\\_mux}}$。在数据通路的非跳转指令控制流中，此路径涉及两个串行组件：计算 $PC+4$ 的 $32$ 位加法器，以及选择下一个 $PC$ 值的 $2$-to-$1$ MUX。问题要求的是它们各自延迟的总和，而不是通过它们的关键路径时间。给定的延迟是：\n-   $t_{\\text{add}} = 0.36\\,\\text{ns}$：$32$ 位加法器的传播延迟。\n-   $t_{\\text{mux}} = 0.11\\,\\text{ns}$：$32$ 位 $2$-to-$1$ MUX 的传播延迟。\n\n这些延迟的总和是：\n$$\nT_{\\text{adder\\_mux}} = t_{\\text{add}} + t_{\\text{mux}}\n$$\n代入给定的数值：\n$$\nT_{\\text{adder\\_mux}} = 0.36\\,\\text{ns} + 0.11\\,\\text{ns} = 0.47\\,\\text{ns}\n$$\n\n最后，我们通过计算 $T_{\\text{jump\\_formation}}$ 与 $T_{\\text{adder\\_mux}}$ 的比率来计算相对延迟 $R$：\n$$\nR = \\frac{T_{\\text{jump\\_formation}}}{T_{\\text{adder\\_mux}}} = \\frac{0.06\\,\\text{ns}}{0.47\\,\\text{ns}}\n$$\n纳秒（$\\text{ns}$）单位相互抵消，留下一个无量纲的比率。\n$$\nR = \\frac{0.06}{0.47} \\approx 0.12765957...\n$$\n问题要求答案四舍五入到四位有效数字。\n$$\nR \\approx 0.1277\n$$\n这个结果量化地说明了通过布线和拼接形成跳转地址的延迟，大约是加法器和选择 MUX 级组合延迟的 $12.77\\%$。",
            "answer": "$$\n\\boxed{0.1277}\n$$"
        }
    ]
}