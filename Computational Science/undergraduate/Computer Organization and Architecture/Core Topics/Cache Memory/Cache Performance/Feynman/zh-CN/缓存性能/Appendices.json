{
    "hands_on_practices": [
        {
            "introduction": "评估缓存性能的核心指标是平均访存时间（AMAT）。在设计处理器时，工程师常常需要在不同的设计目标之间做出权衡，例如，选择更快的命中时间但可能较高的未命中率，还是接受稍慢的命中时间以换取更低的未命中率。本练习将引导你运用 AMAT 的基本公式，通过代数推导来确定两种缓存设计的性能持平点，从而掌握进行此类量化分析的核心技能。",
            "id": "3626050",
            "problem": "一位处理器设计者正在评估两种一级（L1）缓存方案，分别标记为缓存 A 和缓存 B。每种缓存都服务于相同的指令流和数据流，并使用相同的底层存储层次结构，因此两者都经历相同的未命中惩罚。对于缓存 A，其缓存命中时间为 $t_{hA}$，未命中率为 $MR_{A}$。对于缓存 B，其缓存命中时间为 $t_{hB}$，未命中率为 $MR_{B}$。共同的未命中惩罚（从未命中服务的下一级获取数据所产生的超出缓存命中时间的额外延迟）为 $t_{m}$。所有时间量均为正值，未命中率在 $[0,1]$ 范围内。\n\n假设对于任何单次访问，存在两种互斥的结果：对于缓存 $X \\in \\{\\text{A}, \\text{B}\\}$，以概率 $1 - MR_{X}$ 命中，或以概率 $MR_{X}$ 未命中。如果访问在缓存 $X$ 中命中，则访问时间等于缓存命中时间 $t_{hX}$。如果访问在缓存 $X$ 中未命中，则访问时间等于缓存命中时间加上未命中惩罚，即 $t_{hX} + t_{m}$。请使用全期望定律，用这些量表示每个缓存的平均内存访问时间（AMAT），然后确定缓存 B 的平衡未命中率 $MR_{B}$，使得缓存 A 的 AMAT 等于缓存 B 的 AMAT。\n\n请以单个封闭形式的符号表达式给出 $MR_{B}$ 的最终答案，用 $t_{hA}$、$t_{hB}$、$MR_{A}$ 和 $t_{m}$ 表示。无需进行数值计算或四舍五入。最终表达式中不应包含单位。",
            "solution": "该问题要求确定缓存的平衡未命中率，其依据是使两种不同缓存配置的平均内存访问时间（AMAT）相等的原则。验证过程确认了问题陈述具有科学依据、问题设定良好、客观，并包含得出唯一解所需的所有必要信息。\n\n首先，我们必须推导通用缓存（我们将其表示为缓存 $X$）的平均内存访问时间（AMAT）的表达式。问题提供了一个内存访问的概率模型。对于任何单次访问，都有两种互斥的结果：缓存命中或缓存未命中。\n\n设 $MR_X$ 为缓存 $X$ 的未命中率。未命中的概率为 $P(\\text{miss}) = MR_X$。\n因此，命中的概率为 $P(\\text{hit}) = 1 - MR_X$。\n\n问题指明了每种结果所需的时间：\n-   如果访问命中，访问时间为缓存命中时间 $t_{hX}$。\n-   如果访问未命中，访问时间为缓存命中时间与未命中惩罚之和，$t_{hX} + t_{m}$。\n\n问题指导我们使用全期望定律来求 AMAT。AMAT 是内存访问时间的期望值。设 $T_X$ 为缓存 $X$ 的访问时间的随机变量。\n缓存 $X$ 的 AMAT，记为 $AMAT_X$，由下式给出：\n$$AMAT_X = E[T_X] = (\\text{Time on hit}) \\times P(\\text{hit}) + (\\text{Time on miss}) \\times P(\\text{miss})$$\n代入给定的量：\n$$AMAT_X = t_{hX} \\cdot (1 - MR_X) + (t_{hX} + t_m) \\cdot MR_X$$\n\n我们可以对这个表达式进行代数简化：\n$$AMAT_X = t_{hX} - t_{hX} \\cdot MR_X + t_{hX} \\cdot MR_X + t_m \\cdot MR_X$$\n项 $- t_{hX} \\cdot MR_X$ 和 $+ t_{hX} \\cdot MR_X$ 相互抵消，得到 AMAT 的标准公式：\n$$AMAT_X = t_{hX} + MR_X \\cdot t_m$$\n\n现在，我们将此通用公式应用于两个特定的缓存，即缓存 A 和缓存 B。\n\n对于缓存 A，参数是命中时间 $t_{hA}$ 和未命中率 $MR_A$。其 AMAT 为：\n$$AMAT_A = t_{hA} + MR_A \\cdot t_m$$\n\n对于缓存 B，参数是命中时间 $t_{hB}$ 和未命中率 $MR_B$。其 AMAT 为：\n$$AMAT_B = t_{hB} + MR_B \\cdot t_m$$\n正如问题所述，未命中惩罚 $t_m$ 对两种配置是共同的。\n\n问题要求的是缓存 B 的平衡未命中率 $MR_B$，它是使两个缓存的 AMAT 相等的 $MR_B$ 值。因此，我们令 $AMAT_A = AMAT_B$：\n$$t_{hA} + MR_A \\cdot t_m = t_{hB} + MR_B \\cdot t_m$$\n\n我们的目标是解出这个方程中的 $MR_B$。我们首先分离出包含 $MR_B$ 的项：\n$$MR_B \\cdot t_m = t_{hA} - t_{hB} + MR_A \\cdot t_m$$\n\n问题说明所有时间量均为正值，这意味着 $t_m > 0$。因此，我们可以将方程两边同时除以 $t_m$ 而不会产生歧义：\n$$MR_B = \\frac{t_{hA} - t_{hB} + MR_A \\cdot t_m}{t_m}$$\n\n为了更清晰，这个表达式可以分为两项：\n$$MR_B = \\frac{t_{hA} - t_{hB}}{t_m} + \\frac{MR_A \\cdot t_m}{t_m}$$\n$$MR_B = MR_A + \\frac{t_{hA} - t_{hB}}{t_m}$$\n\n这是最终的封闭形式符号表达式，表示缓存 B 的平衡未命中率 $MR_B$，用给定的量 $t_{hA}$、$t_{hB}$、$MR_A$ 和 $t_{m}$ 表示。",
            "answer": "$$\\boxed{MR_{A} + \\frac{t_{hA} - t_{hB}}{t_{m}}}$$"
        },
        {
            "introduction": "掌握了 AMAT 的计算方法后，我们进一步探讨一个更深层次的问题：缓存性能并非仅由其物理参数决定，它与程序的访存模式之间存在着密切的动态交互。本练习设计了一个经典的“最坏情况”思想实验，要求你构造一个特定的访问序列，导致在组关联缓存中发生持续的冲突未命中——这种现象被称为缓存抖动（thrashing）。通过这个练习，你将深刻理解数据访问模式对缓存效率的决定性影响。",
            "id": "3626035",
            "problem": "处理器使用一个1级（L1）数据高速缓存，该缓存是一个总容量为 $C$ 字节、块大小为 $B$ 字节的2路组相联高速缓存。替换策略是最近最少使用（LRU），且高速缓存初始为空。\n\n考虑三个不同的内存块，其地址分别为 $X$、$Y$ 和 $Z$，它们都映射到该高速缓存中的同一个组索引。每次访问都是读操作。处理器重复地在 $\\{X,Y,Z\\}$ 上发出一个确定性的无限访问序列，该序列在这三个块之间交替进行，以便在LRU策略下最大化冲突未命中。\n\n仅使用缓存命中、缓存未命中、命中率和平均内存访问时间（AMAT）的核心定义，完成以下任务：\n\n- 为这个2路组相联LRU高速缓存设计一个在 $\\{X,Y,Z\\}$ 上交替的、能最大化冲突未命中的显式无限访问序列。\n- 从第一性原理出发，推导该访问序列的稳态命中率 $H$，$H$ 是在任何瞬态预热效应消失后，访问命中在长期运行中所占的比例。\n- 给定命中延迟为 $t_h = 3$ 个周期，未命中惩罚为 $t_m = 120$ 个周期，计算稳态平均内存访问时间（AMAT），以周期为单位。\n\n将 $H$ 表示为小数或分数，并将AMAT表示为周期数。无需四舍五入。最终答案必须是数对 $\\{H,\\text{AMAT}\\}$。",
            "solution": "此问题经评估具有科学依据、问题明确且客观。确定访问序列、命中率和平均内存访问时间（AMAT）所需的所有信息均已提供。所用参数和概念均为计算机体系结构中的标准内容。此问题有效。\n\n解答按要求分为三部分展开：设计访问序列、推导稳态命中率和计算AMAT。\n\n**第一部分：无限访问序列的设计**\n\n该高速缓存是k=2路组相联的，意味着每个组可以精确地容纳 $2$ 个不同的内存块。替换策略是最近最少使用（LRU），该策略規定当一个新块必须被调入一个已满的组时，最长时间未被访问的块将被逐出。\n\n给定 $3$ 个不同的内存块，地址为 $X$、$Y$ 和 $Z$，它们都映射到同一个高速缓存组。任务是设计一个在 $\\{X, Y, Z\\}$ 上确定性的、交替的、无限的访问序列，以最大化冲突未命中。当一个块为了给映射到同一组的另一个块腾出空间而被逐出，并且这个被逐出的块稍后又被访问时，就会发生冲突未命中。\n\n为了最大化未命中，我们应该以一种确保所请求的块永远不在高速缓存中的方式来访问这些块。这种现象被称为颠簸。考虑循环访问序列：$S = (X, Y, Z, X, Y, Z, \\dots)$。让我们追踪这个唯一相关的、初始为空的高速缓存组的状态。元组将表示组中的块，最右边的元素是最近最多使用（MRU）的，最左边的元素是最近最少使用（LRU）的。\n\n1.  访问 $X$：**未命中**（强制性）。高速缓存为空。加载 $X$。\n    - 组状态：$\\{X\\}$\n    - LRU 状态：$X$ 是MRU。\n\n2.  访问 $Y$：**未命中**（强制性）。组未满。加载 $Y$。\n    - 组状态：$\\{X, Y\\}$\n    - LRU 状态：$Y$ 是MRU，$X$ 是LRU。\n\n3.  访问 $Z$：**未命中**（冲突性）。组中已满，内容为 $\\{X, Y\\}$。根据LRU策略，最近最少使用的块 $X$ 被逐出。加载 $Z$。\n    - 组状态：$\\{Y, Z\\}$\n    - LRU 状态：$Z$ 是MRU，$Y$ 是LRU。\n\n4.  访问 $X$：**未命中**（冲突性）。组中已满，内容为 $\\{Y, Z\\}$。LRU块是 $Y$。$Y$ 被逐出，加载 $X$。\n    - 组状态：$\\{Z, X\\}$\n    - LRU 状态：$X$ 是MRU，$Z$ 是LRU。\n\n5.  访问 $Y$：**未命中**（冲突性）。组中已满，内容为 $\\{Z, X\\}$。LRU块是 $Z$。$Z$ 被逐出，加载 $Y$。\n    - 组状态：$\\{X, Y\\}$\n    - LRU 状态：$Y$ 是MRU，$X$ 是LRU。\n\n6.  访问 $Z$：**未命中**（冲突性）。组中已满，内容为 $\\{X, Y\\}$。LRU块是 $X$。$X$ 被逐出，加载 $Z$。\n    - 组状态：$\\{Y, Z\\}$\n    - LRU 状态：$Z$ 是MRU，$Y$ 是LRU。\n\n高速缓存状态的模式 $\\{Y, Z\\} \\to \\{Z, X\\} \\to \\{X, Y\\}$ 重复出现。在这个稳态周期中（从第 $3$ 次访问开始），被请求的块恰好是两步之前被逐出的那一个。例如，在第3步，$Z$ 逐出 $X$，然后在第4步请求 $X$。在第4步，$X$ 逐出 $Y$，然后在第5步请求 $Y$。在第5步，$Y$ 逐出 $Z$，那么对于序列 $X,Y,Z,X,Y,Z...$，$Z$ 就会在第6步被请求。所提供的追踪过程证实了这一点。\n\n此序列导致稳态下的每次访问都是未命中。$0$ 的命中率是可能达到的最低值，这意味着未命中率被最大化了。因此，最大化冲突未命中的显式无限访问序列是重复序列 $(X, Y, Z)^\\infty$，即 $X, Y, Z, X, Y, Z, \\dots$。任何循环置換，例如 $(Y, Z, X)^\\infty$，也满足条件。\n\n**第二部分：稳态命中率（$H$）的推导**\n\n稳态命中率 $H$ 是指在任何初始的瞬态效应（如强制性未命中）发生后，从长远来看，命中访问所占的比例。如上所述，对于序列 $S = (X, Y, Z, X, Y, Z, \\dots)$，从第三次访问开始，每次访问都是一次冲突未命中。\n\n命中率定义为：\n$$ H = \\lim_{N \\to \\infty} \\frac{\\text{Number of Hits in the first } N \\text{ accesses}}{\\text{Total number of accesses } (N)} $$\n在我们的序列中，对于任何 $N \\geq 1$，命中次数始终为 $0$。设 $N_h(N)$ 为前 $N$ 次访问中的命中次数。\n$$ N_h(N) = 0 \\quad \\forall N \\in \\mathbb{Z}^+ $$\n因此，命中率为：\n$$ H = \\lim_{N \\to \\infty} \\frac{0}{N} = 0 $$\n稳态命中率 $H$ 为 $0$。\n\n**第三部分：平均内存访问时间（AMAT）的计算**\n\n平均内存访问时间（AMAT）是命中时间和未命中时间的加权平均值。\n其核心定义是：\n$$ \\text{AMAT} = (\\text{Hit Rate} \\times \\text{Time per Hit}) + (\\text{Miss Rate} \\times \\text{Time per Miss}) $$\n设 $H$ 为命中率，$M$ 为未命中率。根据定义，$M = 1 - H$。\n设 $t_h$ 为命中延迟（每次命中的时间），$t_{miss}$ 为服务一次未命中所需的总时间。\n一次内存访问首先涉及检查高速缓存，这需要时间 $t_h$。如果命中，访问完成。如果未命中，则需要额外的时间，即未命中惩罚（$t_m$），用于从下一级存储器中获取数据。\n因此：\n- 每次命中的时间 $= t_h$\n- 每次未命中的时间 $= t_{miss} = t_h + t_m$\n\n将这些代入AMAT公式中：\n$$ \\text{AMAT} = H \\cdot t_h + (1 - H) \\cdot (t_h + t_m) $$\n该表达式可以简化为：\n$$ \\text{AMAT} = H \\cdot t_h + t_h + t_m - H \\cdot t_h - H \\cdot t_m $$\n$$ \\text{AMAT} = t_h + (1 - H) \\cdot t_m $$\n这是AMAT的标准公式。\n\n我们给定的值如下：\n- 命中延迟，$t_h = 3$ 个周期\n- 未命中惩罰，$t_m = 120$ 个周期\n\n从第二部分，我们推导出稳态命中率：\n- 命中率，$H = 0$\n\n现在，我们将这些值代入AMAT公式：\n$$ \\text{AMAT} = 3 \\text{ cycles} + (1 - 0) \\times 120 \\text{ cycles} $$\n$$ \\text{AMAT} = 3 + 1 \\times 120 $$\n$$ \\text{AMAT} = 3 + 120 $$\n$$ \\text{AMAT} = 123 \\text{ cycles} $$\n\n稳态命中率 $H$ 为 $0$，稳态平均内存访问时间为 $123$ 个周期。最终答案是数对 $\\{H, \\text{AMAT}\\}$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0 & 123 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在理解了缓存抖动的概念后，我们将这一理论应用于一个更具体的工程场景。本练习模拟了两个大数组在内存中的布局恰好导致它们在直接映射缓存中相互竞争，从而引发严重的性能抖动。你的任务是先精确计算这种病态行为造成的性能损失，然后分析一种高级架构设计——偏斜关联缓存——如何通过改进的映射函数来缓解这个问题，并最终量化其带来的性能提升。",
            "id": "3626006",
            "problem": "一个单处理器系统拥有一个一级（L1）数据缓存，该缓存是物理索引、物理标记的，并且最初是直接映射的。L1缓存的总容量为 $C = 64\\,\\mathrm{KiB}$，块大小为 $B = 64\\,\\mathrm{B}$。因此，缓存行的数量为 $C/B$，并且由于初始关联度为1，可索引的组数也等于 $C/B$。考虑两个数组 $\\mathcal{A}$ 和 $\\mathcal{B}$，每个数组的大小恰好为 $C$，存储在连续的内存中，并按 $C$ 字节边界对齐。以等于缓存块大小的空间步长访问这两个数组，因此每次访问都会触及数组内的一个新块。具体来说，将遍历数组的过程定义为以下按块交替序列的无限重复：\n- 对于 $i = 0, 1, 2, \\dots, (C/B) - 1$：访问 $\\mathcal{A}[i \\cdot B]$，然后访问 $\\mathcal{B}[i \\cdot B]$。\n$\\mathcal{A}$ 和 $\\mathcal{B}$ 的基虚拟地址被设置为，对于每个块索引 $i$，块 $\\mathcal{A}[i \\cdot B]$ 和块 $\\mathcal{B}[i \\cdot B]$ 映射到相同的L1缓存索引，但具有不同的标记。例如，取 $\\mathrm{base}(\\mathcal{B}) = \\mathrm{base}(\\mathcal{A}) + C$。假设有一个完美的翻译后备缓冲器（TLB）且没有虚拟别名效应。\n二级（L2）缓存足够大，可以在稳态下同时容纳两个数组，并且是高关联度的，块大小等于 $B$。经过初始预热后，每次L1未命中都会在L2缓存中命中。L1命中时间为 $1.0\\,\\mathrm{ns}$，L2命中时间（当处理在L2中命中的L1未命中时，超出L1命中时间的额外延迟）为 $8.0\\,\\mathrm{ns}$，并且在本实验的稳态下，主存永远不会被访问。\n任务：\n1) 仅使用缓存命中、未命中、未命中率的核心定义以及每次访问时间的期望值（基于命中和未命中）的概念，设计上述访问模式以在直接映射的L1缓存中引发最坏情况的冲突行为，并论证在稳态下（忽略强制性的首次接触），该模式的长期L1未命中率。\n2) 使用第(1)部分得出的未命中率结论和给定的时间参数，对于初始的直接映射L1设计，以符号形式推导并计算稳态下每次访问的长期平均内存访问时间。\n现在假设L1被重新设计为一个2路偏斜关联缓存，具有相同的总容量 $C$ 和块大小 $B$，使用两个独立的索引函数（每路一个），将块均匀地分布到各个组中。假设在这种重新设计和相同的访问模式下，稳态L1未命中率达到了由工作集与缓存大小之比所决定的理想下限，即在稳态下恰好有一半的访问在L1中未命中。由于增加了路和哈希逻辑，L1的命中时间恰好增加了 $10\\%$，而所有其他时间参数保持不变。\n3) 使用与第(2)部分相同的第一性原理推理，推导并计算偏斜关联L1的稳态平均内存访问时间。\n最后，报告你的单一数值结果，即加速比 $S$，定义为初始平均访问时间与重新设计后的平均访问时间之比。将你的最终答案 $S$ 四舍五入到四位有效数字。将 $S$ 表示为一个无单位的纯数。",
            "solution": "首先根据指定标准验证问题。\n\n**步骤1：提取给定条件**\n- L1缓存初始配置：物理索引、物理标记、直接映射（关联度 $k=1$）。\n- L1缓存容量：$C = 64\\,\\mathrm{KiB}$。\n- L1缓存块大小：$B = 64\\,\\mathrm{B}$。\n- L1组数（直接映射）：$N = C/B$。\n- 数组：$\\mathcal{A}$ 和 $\\mathcal{B}$，每个大小为 $C$。\n- 数组内存布局：连续，按 $C$ 字节边界对齐。\n- 访问模式：序列的无限重复：对于 $i = 0, 1, \\dots, (C/B) - 1$，访问 $\\mathcal{A}[i \\cdot B]$，然后访问 $\\mathcal{B}[i \\cdot B]$。\n- 映射约束：对于每个块索引 $i$，$\\mathcal{A}[i \\cdot B]$ 和 $\\mathcal{B}[i \\cdot B]$ 映射到相同的L1缓存索引，但具有不同的标记。\n- 系统假设：完美的翻译后备缓冲器（TLB），无虚拟别名。\n- L2缓存：足够大以容纳两个数组，高关联度，块大小为 $B$。\n- 稳态L2行为：每次L1未命中都是L2命中。不访问主存。\n- 初始设计的时间参数：\n  - L1命中时间：$T_{H1} = 1.0\\,\\mathrm{ns}$。\n  - L2命中时间（L1未命中的额外延迟）：$T_{H2} = 8.0\\,\\mathrm{ns}$。\n- L1缓存重新设计配置：2路偏斜关联，相同的 $C$ 和 $B$。\n- 偏斜关联缓存属性：两个独立的、均匀的索引函数。\n- 重新设计后缓存的稳态L1未命中率：$m_{1, \\text{skewed}} = 1/2$。\n- 重新设计的时间参数：\n  - 新的L1命中时间：$T'_{H1} = T_{H1} \\times (1 + 0.10) = 1.1 \\times T_{H1}$。\n  - 其他时间参数（$T_{H2}$）保持不变。\n- 最终要求结果：加速比 $S = \\frac{\\text{AMAT}_{\\text{initial}}}{\\text{AMAT}_{\\text{redesigned}}}$，四舍五入到四位有效数字。\n\n**步骤2：使用提取的给定条件进行验证**\n- **科学依据**：该问题基于计算机体系结构的基本原理，特别是缓存存储器组织、未命中率和平均内存访问时间（AMAT）等性能指标，以及冲突未命中的概念。所描述的场景是一个标准的教科书示例，用于说明缓存冲突的病态情况。所有参数对于现代处理器都是物理上现实的。\n- **问题定义明确**：问题定义清晰，并提供了计算所需的所有数据。时间参数的定义，例如L2命中时间是“额外延迟”，是精确的，并直接对应于AMAT公式中的未命中惩罚项。\n- **客观性**：问题陈述没有主观性语言，并使用了精确的技术术语。\n- **一致性**：给定条件是自洽的。对于一个具有 $C/B$ 个组的直接映射缓存（其中 $C$ 是2的幂，这是标准情况），$\\mathcal{A}[i \\cdot B]$ 和 $\\mathcal{B}[i \\cdot B]$ 映射到相同L1索引的条件是指定内存布局（例如，$\\mathrm{base}(\\mathcal{B}) = \\mathrm{base}(\\mathcal{A}) + C$）的直接结果。\n\n**步骤3：结论和行动**\n该问题是有效的，因为它科学上合理、定义明确、客观且内部一致。可以从所提供的信息中推导出完整的解决方案。\n\n**解题推导**\n\n问题要求分析两种不同L1缓存设计下的缓存性能。我们将按顺序解决问题的每个部分。\n\n**第1部分：直接映射缓存的L1未命中率**\n\nL1缓存是直接映射的，这意味着每个内存块只能映射到一个特定的缓存行（或组）。组的数量为 $N = C/B = (64 \\times 1024\\,\\mathrm{B}) / (64\\,\\mathrm{B}) = 1024$。访问模式是对数组 $\\mathcal{A}$ 和 $\\mathcal{B}$ 的块进行无限循环。对于每个块索引 $i$，先访问来自 $\\mathcal{A}$ 的块，然后访问来自 $\\mathcal{B}$ 的块。一个关键信息是，对于任何给定的 $i$，包含 $\\mathcal{A}[i \\cdot B]$ 的内存块和包含 $\\mathcal{B}[i \\cdot B]$ 的内存块会映射到同一个L1缓存组。它们有不同的标记，这证实了它们是不同的内存块。\n\n让我们分析单个缓存组（比如说组 $j$，对应于某个块索引 $i$）的事件序列。设来自 $\\mathcal{A}$ 的块表示为 $A_i$，来自 $\\mathcal{B}$ 的块表示为 $B_i$。与该组相关的访问序列是 $\\dots, A_i, B_i, A_i, B_i, \\dots$。我们关心的是稳态，因此忽略初始的冷未命中。\n\n1.  假设在稳态执行的某个时刻，我们访问块 $A_i$。在此次访问之前，缓存组 $j$ 必定包含块 $B_i$，它是在上一次循环迭代中（当访问 $\\mathcal{B}[i \\cdot B]$ 时）加载的。由于组 $j$ 中存放的是 $B_i$，访问 $A_i$ 会导致**未命中**。因为缓存是直接映射的，块 $B_i$ 被替换出去，而块 $A_i$ 被加载到组 $j$ 中。\n\n2.  紧接着对 $A_i$ 的访问，程序访问块 $B_i$。此时缓存组 $j$ 包含块 $A_i$。因此，对 $B_i$ 的访问也是一次**未命中**。块 $A_i$ 被替换出去，而块 $B_i$ 被加载到组 $j$ 中。\n\n对于每一对访问 $(\\mathcal{A}[i \\cdot B], \\mathcal{B}[i \\cdot B])$ 以及每一个块索引 $i$，这种相互替换的循环都会重复。序列中的每一次内存访问都会导致冲突未命中。这种访问模式被完美地设计用来抖动直接映射缓存，从而创造了最坏情况的场景。\n\n因此，稳态L1未命中率 $m_{1, \\text{direct}}$ 是未命中次数与总访问次数之比。由于每次访问都是未命中，所以未命中率为 $1$。\n$$m_{1, \\text{direct}} = 1.0$$\n\n**第2部分：直接映射缓存的平均内存访问时间（AMAT）**\n\n平均内存访问时间（AMAT）是内存访问的期望时间。它使用L1命中时间（$T_{H1}$）、L1未命中率（$m_1$）和L1未命中惩罚（$M_{P1}$）来计算。通用公式为：\n$$AMAT = T_{H1} + m_1 \\times M_{P1}$$\n问题指出，任何L1未命中都由L2缓存服务，并且在稳态下L2缓存总是命中。此服务的额外延迟是 $T_{H2}$。这个额外延迟正是L1的未命中惩罚，即 $M_{P1} = T_{H2}$。\n\n对于初始的直接映射设计，我们将AMAT表示为 $AMAT_{\\text{direct}}$。我们有：\n- L1命中时间：$T_{H1} = 1.0\\,\\mathrm{ns}$\n- L1未命中率：$m_{1, \\text{direct}} = 1.0$（来自第1部分）\n- L1未命中惩罚：$M_{P1} = T_{H2} = 8.0\\,\\mathrm{ns}$\n\n将这些值代入AMAT公式：\n$$AMAT_{\\text{direct}} = T_{H1} + m_{1, \\text{direct}} \\times T_{H2}$$\n$$AMAT_{\\text{direct}} = 1.0\\,\\mathrm{ns} + (1.0) \\times (8.0\\,\\mathrm{ns}) = 1.0\\,\\mathrm{ns} + 8.0\\,\\mathrm{ns} = 9.0\\,\\mathrm{ns}$$\n\n**第3部分：偏斜关联缓存的AMAT**\n\n现在L1缓存被重新设计为2路偏斜关联，具有相同的容量 $C$ 和块大小 $B$。这次重新设计影响了L1的命中时间和L1的未命中率。\n\n新的参数如下：\n- 新的L1命中时间：$T'_{H1} = T_{H1} \\times (1 + 0.10) = 1.0\\,\\mathrm{ns} \\times 1.1 = 1.1\\,\\mathrm{ns}$。\n- 新的L1未命中率：$m_{1, \\text{skewed}} = 1/2 = 0.5$，如问题陈述中所给。\n- L1未命中惩罚保持不变，因为L2缓存系统未被修改：$M'_{P1} = T_{H2} = 8.0\\,\\mathrm{ns}$。\n\n我们可以使用相同的公式计算新的AMAT，表示为 $AMAT_{\\text{skewed}}$：\n$$AMAT_{\\text{skewed}} = T'_{H1} + m_{1, \\text{skewed}} \\times T_{H2}$$\n代入新的值：\n$$AMAT_{\\text{skewed}} = 1.1\\,\\mathrm{ns} + (0.5) \\times (8.0\\,\\mathrm{ns}) = 1.1\\,\\mathrm{ns} + 4.0\\,\\mathrm{ns} = 5.1\\,\\mathrm{ns}$$\n\n**最终计算：加速比S**\n\n加速比 $S$ 定义为初始（较慢的）平均访问时间与重新设计后（较快的）平均访问时间之比。\n$$S = \\frac{AMAT_{\\text{direct}}}{AMAT_{\\text{skewed}}}$$\n使用计算出的值：\n$$S = \\frac{9.0\\,\\mathrm{ns}}{5.1\\,\\mathrm{ns}} = \\frac{9.0}{5.1} = \\frac{90}{51} = \\frac{30}{17}$$\n为了提供最终的数值答案，我们计算这个分数的值，并将其四舍五入到四位有效数字。\n$$S = \\frac{30}{17} \\approx 1.76470588\\dots$$\n四舍五入到四位有效数字得到 $1.765$。",
            "answer": "$$\\boxed{1.765}$$"
        }
    ]
}