{"hands_on_practices": [{"introduction": "The first step in designing a microprogrammed control unit is to determine the size of the control store. This exercise provides foundational practice in calculating the width of a vertical microinstruction, where mutually exclusive operations are encoded to save space. By applying the principles of binary encoding, you will determine the minimum number of bits needed for various functional units, a core skill for balancing hardware cost and capability [@problem_id:3630474].", "problem": "A microcoded processor uses a vertical microinstruction format in which the control store encodes mutually exclusive actions per functional unit as separate, tiled fields, one field per unit. Assume the following units and their enumerated permissible actions for a single microcycle. Each unit’s field must include a “no-action” option explicitly, and all actions listed for a given unit are mutually exclusive in that microcycle.\n\n- Arithmetic Logic Unit (ALU): {pass $A$, pass $B$, add $A+B$, subtract $A-B$, bitwise AND, bitwise OR, bitwise XOR, bitwise NOT of $A$, increment $A$, decrement $A$, none}, totaling $11$ alternatives.\n- Barrel shifter: {none, logical shift left by 1, logical shift right by 1, arithmetic shift right by 1, rotate left by 1, rotate right by 1}, totaling $6$ alternatives.\n- Register file write destination (single write port): {none, write to $R_0$, write to $R_1$, $\\dots$, write to $R_{15}$}, totaling $17$ alternatives.\n- Memory interface: {none, read word, read byte, write word, write byte, read input/output, write input/output}, totaling $7$ alternatives.\n- Internal bus driver select: {none, A-input latch, B-input latch, ALU result, shifter result, memory data register, immediate field, microprogram constant generator, program counter, zero constant}, totaling $10$ alternatives.\n- Condition code update unit: {none, update $\\mathrm{NZVC}$ from ALU, update $\\mathrm{NZ}$ from shifter, update $C$ only from ALU, update $V$ only from ALU}, totaling $5$ alternatives.\n\nUnder a vertical encoding that minimizes the control store width while preserving one-hot semantics across units (that is, exactly one encoded action per unit per microinstruction field), determine the minimal number of bits required for each unit’s field and compute the aggregate width of the concatenated control fields for one microinstruction word. Express your final answer as a single row matrix in which the entries, in order, are the field widths for ALU, barrel shifter, register file write destination, memory interface, internal bus driver select, condition code update unit, followed by the total aggregate width. No rounding is needed. Do not include any units in your final answer.", "solution": "The problem statement is scientifically grounded, well-posed, objective, and internally consistent. It presents a standard problem in computer organization and architecture concerning the design of a control store for a microcoded processor. All necessary data are provided, and there are no contradictions or ambiguities that would preclude a unique, correct solution. The task is to determine the minimum number of bits required for several control fields in a vertical microinstruction format and the total width of these fields.\n\nThe fundamental principle for this determination is derived from information theory. To uniquely encode $N$ mutually exclusive items or actions, the minimum number of bits, $b$, required is the smallest integer such that $2^b \\ge N$. This can be expressed mathematically using the ceiling function:\n$$b = \\lceil \\log_2(N) \\rceil$$\nThis formula provides the width of a binary-encoded field that can represent all $N$ possibilities. We will apply this principle to each functional unit specified in the problem.\n\n1.  **Arithmetic Logic Unit (ALU)**: The ALU has $N_{ALU} = 11$ mutually exclusive actions. The minimum number of bits required for the ALU control field, $b_{ALU}$, is:\n    $$b_{ALU} = \\lceil \\log_2(11) \\rceil$$\n    Since $2^3 = 8$ and $2^4 = 16$, we have $8 < 11 \\le 16$. Therefore, the minimum integer number of bits is $4$.\n    $$b_{ALU} = 4$$\n\n2.  **Barrel Shifter**: The barrel shifter has $N_{shifter} = 6$ mutually exclusive actions. The minimum number of bits required for its control field, $b_{shifter}$, is:\n    $$b_{shifter} = \\lceil \\log_2(6) \\rceil$$\n    Since $2^2 = 4$ and $2^3 = 8$, we have $4 < 6 \\le 8$. Therefore, the minimum number of bits is $3$.\n    $$b_{shifter} = 3$$\n\n3.  **Register File Write Destination**: The register file has $16$ possible destination registers ($R_0$ through $R_{15}$) and a \"none\" option, for a total of $N_{reg} = 16 + 1 = 17$ mutually exclusive alternatives. The minimum number of bits for this field, $b_{reg}$, is:\n    $$b_{reg} = \\lceil \\log_2(17) \\rceil$$\n    Since $2^4 = 16$ and $2^5 = 32$, we have $16 < 17 \\le 32$. Therefore, the minimum number of bits is $5$.\n    $$b_{reg} = 5$$\n\n4.  **Memory Interface**: The memory interface has $N_{mem} = 7$ mutually exclusive actions. The minimum number of bits for its control field, $b_{mem}$, is:\n    $$b_{mem} = \\lceil \\log_2(7) \\rceil$$\n    Since $2^2 = 4$ and $2^3 = 8$, we have $4 < 7 \\le 8$. Therefore, the minimum number of bits is $3$.\n    $$b_{mem} = 3$$\n\n5.  **Internal Bus Driver Select**: This unit has $N_{bus} = 10$ mutually exclusive options. The minimum number of bits for its control field, $b_{bus}$, is:\n    $$b_{bus} = \\lceil \\log_2(10) \\rceil$$\n    Since $2^3 = 8$ and $2^4 = 16$, we have $8 < 10 \\le 16$. Therefore, the minimum number of bits is $4$.\n    $$b_{bus} = 4$$\n\n6.  **Condition Code Update Unit**: This unit has $N_{cc} = 5$ mutually exclusive actions. The minimum number of bits for its control field, $b_{cc}$, is:\n    $$b_{cc} = \\lceil \\log_2(5) \\rceil$$\n    Since $2^2 = 4$ and $2^3 = 8$, we have $4 < 5 \\le 8$. Therefore, the minimum number of bits is $3$.\n    $$b_{cc} = 3$$\n\nFinally, the aggregate width of the concatenated control fields, $W_{total}$, is the sum of the individual field widths:\n$$W_{total} = b_{ALU} + b_{shifter} + b_{reg} + b_{mem} + b_{bus} + b_{cc}$$\nSubstituting the calculated values:\n$$W_{total} = 4 + 3 + 5 + 3 + 4 + 3 = 22$$\nThe total width of the control portion of the microinstruction word is $22$ bits.\n\nThe required field widths, in order, are:\n- ALU: $4$ bits\n- Barrel shifter: $3$ bits\n- Register file write destination: $5$ bits\n- Memory interface: $3$ bits\n- Internal bus driver select: $4$ bits\n- Condition code update unit: $3$ bits\n- Total aggregate width: $22$ bits", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n4 & 3 & 5 & 3 & 4 & 3 & 22\n\\end{pmatrix}\n}\n$$", "id": "3630474"}, {"introduction": "While vertical encoding reduces control store size, it introduces a decoder, which has a propagation delay that can impact performance. This practice explores that critical trade-off by linking the width of a microinstruction field to the processor's minimum clock cycle time. You will analyze a timing path that includes the decoder to determine the maximum possible encoding complexity that a given clock period can support [@problem_id:3630489].", "problem": "A microprogrammed Central Processing Unit (CPU) implements its control signals via a Control Store of read-only memory containing microinstructions. Consider a design choice between horizontal and vertical microinstruction formats. In a horizontal format, each control signal is directly specified by one bit, while in a vertical format, a field of $b$ bits encodes one of $2^{b}$ possible microoperations that must be decoded into individual control signals by combinational logic before use.\n\nAssume a vertical field is implemented using a balanced binary tree of $2{:}1$ Multiplexers (MUX), where each stage uses one of the $b$ selection bits and contributes a propagation delay of $t_{d}$. The Control Store access time is $t_{cs}$, and the microinstruction is captured in a Microinstruction Register with setup time $t_{su}$. The target microcycle clock period is $T_{clk}$. The timing constraint for correct operation is that the sum of the Control Store access, register setup, and vertical decode delays must be strictly less than the clock period.\n\nStarting from the definitions of vertical encoding and the structure of a binary MUX tree, derive the constraint on the maximum field width $b$ that ensures timing closure. Then, for a concrete design with $T_{clk} = 3.8$ nanoseconds, $t_{cs} = 1.5$ nanoseconds, $t_{su} = 0.4$ nanoseconds, and $t_{d} = 0.22$ nanoseconds, compute the maximum allowable vertical field width $b_{\\max}$ as an integer. Also compute the corresponding vertical decode delay $t_{v}$ for $b = b_{\\max}$ and determine whether $t_{v} < T_{clk}$ holds in this design. Report only the value of $b_{\\max}$ as your final answer with no units. No rounding is required beyond the integer determination.", "solution": "The problem requires an analysis of the timing constraints in a microprogrammed control unit, specifically focusing on the impact of a vertically encoded microinstruction format. We must first formally establish the relationship between the field width of the vertical encoding and the resulting propagation delay, and then use this relationship to find the maximum possible field width under a given clock period and component delays.\n\nThe core timing constraint for correct operation within a single microcycle is provided: the total time from the start of the Control Store access to the point where the control signals are stable at their destination must be less than the clock period. This can be expressed as an inequality. The path consists of three sequential delays:\n$1$. The Control Store access time, $t_{cs}$, to read the microinstruction.\n$2$. The delay of the vertical decoder, $t_{v}$, which translates the encoded field into individual control signals.\n$3$. The setup time, $t_{su}$, for the final register that captures the control signals. Note: The problem states the microinstruction is captured in a Microinstruction Register with setup time $t_{su}$. However, the timing constraint is given as the sum of access, *decode*, and setup delays being less than the clock period. This implies the decoding happens *before* the end of the clock cycle where the result is used. A more standard path would be Clock Edge $\\rightarrow$ Control Store Access $\\rightarrow$ Microinstruction Register Capture $\\rightarrow$ Decoder $\\rightarrow$ Setup at final destination register. The problem simplifies this by combining the delays into a single path constraint: $t_{cs} + t_{v} + t_{su} < T_{clk}$. We will strictly adhere to the problem's stated constraint.\n\nThe total delay, $t_{path}$, is the sum of these component delays:\n$$t_{path} = t_{cs} + t_{v} + t_{su}$$\n\nThe timing constraint for correct operation is that this path delay must be strictly less than the microcycle clock period, $T_{clk}$:\n$$t_{cs} + t_{v} + t_{su} < T_{clk}$$\n\nThe next step is to determine the vertical decode delay, $t_{v}$, as a function of the field width, $b$. The problem states that the decoder for a $b$-bit field is implemented as a balanced binary tree of $2{:}1$ multiplexers (MUXes). A decoder for a $b$-bit field must select one of $2^b$ outputs. A single $2{:}1$ MUX has one select line and can decode a $b=1$ field. A $4{:}1$ MUX, which decodes a $b=2$ field, can be constructed from a tree of $2{:}1$ MUXes with two stages. Generalizing, a $2^b{:}1$ MUX constructed from a balanced tree of $2{:}1$ MUXes will have a depth of $b$ stages. The critical path for the signal propagation from an input to the final output passes through one MUX at each stage.\n\nGiven that each stage contributes a propagation delay of $t_{d}$, the total vertical decode delay $t_{v}$ for a $b$-bit field is:\n$$t_{v} = b \\cdot t_{d}$$\n\nSubstituting this expression for $t_{v}$ into the timing constraint inequality gives the general constraint on the field width $b$:\n$$t_{cs} + t_{su} + b \\cdot t_{d} < T_{clk}$$\n\nTo find the maximum allowable field width, we solve this inequality for $b$:\n$$b \\cdot t_{d} < T_{clk} - t_{cs} - t_{su}$$\n$$b < \\frac{T_{clk} - t_{cs} - t_{su}}{t_{d}}$$\nThis expression represents the general constraint on $b$ derived from the problem's definitions.\n\nNow, we apply this general constraint to the specific design parameters provided:\n- $T_{clk} = 3.8$ nanoseconds\n- $t_{cs} = 1.5$ nanoseconds\n- $t_{su} = 0.4$ nanoseconds\n- $t_{d} = 0.22$ nanoseconds\n\nSubstituting these values into the inequality:\n$$b < \\frac{3.8 - 1.5 - 0.4}{0.22}$$\n$$b < \\frac{1.9}{0.22}$$\nTo simplify the fraction, we can write it as:\n$$b < \\frac{190}{22} = \\frac{95}{11}$$\nPerforming the division gives:\n$$b < 8.6363...$$\n\nSince $b$ represents the number of bits in a field, it must be an integer. The maximum integer value of $b$ that satisfies this strict inequality is $8$. Therefore, the maximum allowable vertical field width is:\n$$b_{\\max} = 8$$\n\nThe problem also asks to compute the corresponding vertical decode delay $t_{v}$ for $b = b_{\\max}$ and to verify that $t_v < T_{clk}$.\nFor $b_{\\max} = 8$, the decode delay is:\n$$t_{v} = b_{\\max} \\cdot t_{d} = 8 \\cdot 0.22 = 1.76$$ nanoseconds.\n\nFinally, we check the condition $t_{v} < T_{clk}$:\n$$1.76 < 3.8$$\nThis inequality is true. We can also verify that the full timing constraint is met for $b_{\\max}=8$:\n$$t_{cs} + t_{su} + t_{v} = 1.5 + 0.4 + 1.76 = 3.66$$ nanoseconds.\nSince $3.66  3.8$, the timing is met. For the next integer $b=9$, the total delay would be $1.5 + 0.4 + (9 \\cdot 0.22) = 1.9 + 1.98 = 3.88$, which violates the condition $3.88  3.8$. Thus, $b_{\\max}=8$ is confirmed to be the correct maximum integer value.\n\nThe requested final answer is the value of $b_{\\max}$.", "answer": "$$\\boxed{8}$$", "id": "3630489"}, {"introduction": "Design decisions in microarchitecture have system-wide consequences. This final practice moves beyond single-cycle timing to evaluate the impact of a design choice on a key processor performance metric: Cycles Per Instruction ($CPI$). You will analyze a time-multiplexing scheme—an alternative method for reducing control store width—and quantify its performance penalty, illustrating the complex trade-offs between hardware cost and overall processor throughput [@problem_id:3630490].", "problem": "A microprogrammed central processing unit uses a fully horizontal control store in Read-Only Memory (ROM), where each microinstruction asserts a wide set of control signals in a single clocked microcycle. In the baseline machine, the microcycle time equals the processor clock period, so the Cycles Per Instruction (CPI) at the Instruction Set Architecture (ISA) level equals the average number of microinstructions executed per ISA instruction. The ISA instruction mix is partitioned into four classes with frequencies and baseline microinstruction counts as follows: class $A$ (arithmetic and logic) with frequency $f_A = 0.35$ and $m_A = 3$ microinstructions; class $B$ (load) with $f_B = 0.25$ and $m_B = 6$; class $C$ (store) with $f_C = 0.25$ and $m_C = 4$; class $D$ (branch) with $f_D = 0.15$ and $m_D = 2$.\n\nTo reduce control store width, the designer adopts time-multiplexing of control signals: the wide horizontal control word is partitioned into two disjoint banks, $A$-bank (Arithmetic Logic Unit (ALU) and register-read related signals) and $B$-bank (memory interface and register-writeback related signals). In any given microcycle, hardware can assert only one bank’s signals. A microinstruction that needs only one bank completes in one microcycle; a microinstruction that needs both banks requires two consecutive microcycles (one per bank). The microcycle time is unchanged from the baseline.\n\nFor each class $X \\in \\{A,B,C,D\\}$, assume microinstructions are independent and identically distributed with respect to bank usage, with probabilities: $p_{\\text{both},X}$ that both banks are required, $p_{A,X}$ that only the $A$-bank is required, and $p_{B,X}$ that only the $B$-bank is required, with $p_{\\text{both},X} + p_{A,X} + p_{B,X} = 1$. The designer’s workload characterization yields:\n- Class $A$: $p_{\\text{both},A} = 0.25$, $p_{A,A} = 0.60$, $p_{B,A} = 0.15$.\n- Class $B$: $p_{\\text{both},B} = 0.50$, $p_{A,B} = 0.20$, $p_{B,B} = 0.30$.\n- Class $C$: $p_{\\text{both},C} = 0.40$, $p_{A,C} = 0.30$, $p_{B,C} = 0.30$.\n- Class $D$: $p_{\\text{both},D} = 0.10$, $p_{A,D} = 0.70$, $p_{B,D} = 0.20$.\n\nUsing only the definition of Cycles Per Instruction (CPI) as the average number of clock cycles per ISA instruction and the stated timing model, derive from first principles the multiplicative CPI inflation factor\n$$\\rho = \\frac{\\text{CPI}_{\\text{new}}}{\\text{CPI}_{\\text{base}}}$$\ncaused solely by the two-bank time-multiplexing. Round your final numerical answer for $\\rho$ to four significant figures.", "solution": "The problem requires the calculation of the multiplicative Cycles Per Instruction (CPI) inflation factor, $\\rho$, defined as the ratio of the CPI in the new two-bank system to the CPI in the baseline system. This is given by the expression:\n$$\n\\rho = \\frac{\\text{CPI}_{\\text{new}}}{\\text{CPI}_{\\text{base}}}\n$$\n\nFirst, we must derive the expression for the CPI in the baseline system, $\\text{CPI}_{\\text{base}}$. The problem states that for the baseline machine, the CPI at the Instruction Set Architecture (ISA) level equals the average number of microinstructions executed per ISA instruction. This average is computed over the four classes of instructions, weighted by their respective frequencies. Let $X$ be an index for the instruction class, $X \\in \\{A, B, C, D\\}$. Let $f_X$ be the frequency of class $X$ instructions and $m_X$ be the number of microinstructions required to execute an instruction of class $X$. The baseline CPI is then:\n$$\n\\text{CPI}_{\\text{base}} = \\sum_{X \\in \\{A,B,C,D\\}} f_X m_X\n$$\nUsing the provided data:\n- Class $A$: $f_A = 0.35$, $m_A = 3$\n- Class $B$: $f_B = 0.25$, $m_B = 6$\n- Class $C$: $f_C = 0.25$, $m_C = 4$\n- Class $D$: $f_D = 0.15$, $m_D = 2$\n\nWe can calculate the numerical value of $\\text{CPI}_{\\text{base}}$:\n$$\n\\text{CPI}_{\\text{base}} = (f_A m_A) + (f_B m_B) + (f_C m_C) + (f_D m_D)\n$$\n$$\n\\text{CPI}_{\\text{base}} = (0.35 \\times 3) + (0.25 \\times 6) + (0.25 \\times 4) + (0.15 \\times 2)\n$$\n$$\n\\text{CPI}_{\\text{base}} = 1.05 + 1.50 + 1.00 + 0.30 = 3.85\n$$\n\nNext, we derive the expression for the CPI in the new system, $\\text{CPI}_{\\text{new}}$. In the new design, the number of microcycles required to execute a single microinstruction is no longer uniformly $1$. It depends on the banks of control signals required.\n- If a microinstruction requires signals from only one bank (either $A$-bank or $B$-bank), it completes in $1$ microcycle.\n- If a microinstruction requires signals from both banks, it takes $2$ microcycles.\n\nThe problem states that the microcycle time is unchanged, so the CPI is equal to the average number of microcycles per ISA instruction. Let $c_X$ be the average number of microcycles per microinstruction for an instruction of class $X$. This is a weighted average based on the probabilities of bank usage: $p_{A,X}$ (only $A$-bank), $p_{B,X}$ (only $B$-bank), and $p_{\\text{both},X}$ (both banks).\n$$\nc_X = (p_{A,X} \\times 1) + (p_{B,X} \\times 1) + (p_{\\text{both},X} \\times 2)\n$$\nSince the probabilities must sum to $1$, i.e., $p_{A,X} + p_{B,X} + p_{\\text{both},X} = 1$, we can simplify the expression for $c_X$:\n$$\nc_X = (1 - p_{\\text{both},X}) + (p_{\\text{both},X} \\times 2) = 1 - p_{\\text{both},X} + 2 p_{\\text{both},X} = 1 + p_{\\text{both},X}\n$$\nNow we compute $c_X$ for each instruction class using the provided probabilities:\n- Class $A$: $p_{\\text{both},A} = 0.25 \\implies c_A = 1 + 0.25 = 1.25$\n- Class $B$: $p_{\\text{both},B} = 0.50 \\implies c_B = 1 + 0.50 = 1.50$\n- Class $C$: $p_{\\text{both},C} = 0.40 \\implies c_C = 1 + 0.40 = 1.40$\n- Class $D$: $p_{\\text{both},D} = 0.10 \\implies c_D = 1 + 0.10 = 1.10$\n\nThe average number of microcycles for an ISA instruction of class $X$ in the new system is the baseline number of microinstructions, $m_X$, multiplied by the new average microcycles per microinstruction, $c_X$. Thus, the total number of cycles for an instruction of class $X$ is $m_X c_X$.\nThe overall CPI for the new system, $\\text{CPI}_{\\text{new}}$, is the weighted average of these values over all instruction classes:\n$$\n\\text{CPI}_{\\text{new}} = \\sum_{X \\in \\{A,B,C,D\\}} f_X (m_X c_X)\n$$\nSubstituting the known values:\n$$\n\\text{CPI}_{\\text{new}} = (f_A m_A c_A) + (f_B m_B c_B) + (f_C m_C c_C) + (f_D m_D c_D)\n$$\n$$\n\\text{CPI}_{\\text{new}} = (0.35 \\times 3 \\times 1.25) + (0.25 \\times 6 \\times 1.50) + (0.25 \\times 4 \\times 1.40) + (0.15 \\times 2 \\times 1.10)\n$$\n$$\n\\text{CPI}_{\\text{new}} = (1.05 \\times 1.25) + (1.50 \\times 1.50) + (1.00 \\times 1.40) + (0.30 \\times 1.10)\n$$\n$$\n\\text{CPI}_{\\text{new}} = 1.3125 + 2.25 + 1.40 + 0.33 = 5.2925\n$$\n\nFinally, we compute the CPI inflation factor $\\rho$:\n$$\n\\rho = \\frac{\\text{CPI}_{\\text{new}}}{\\text{CPI}_{\\text{base}}} = \\frac{5.2925}{3.85}\n$$\n$$\n\\rho \\approx 1.37467532467...\n$$\nThe problem requires the answer to be rounded to four significant figures. The first four significant figures are $1$, $3$, $7$, and $4$. The fifth digit is $6$, so we round up the fourth digit.\n$$\n\\rho \\approx 1.375\n$$", "answer": "$$\n\\boxed{1.375}\n$$", "id": "3630490"}]}