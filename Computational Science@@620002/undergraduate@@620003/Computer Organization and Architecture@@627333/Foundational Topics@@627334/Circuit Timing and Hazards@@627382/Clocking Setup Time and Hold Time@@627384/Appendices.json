{"hands_on_practices": [{"introduction": "In digital circuit design, we often focus on long paths that limit the maximum clock frequency. However, paths that are too short can be equally problematic, leading to hold time violations where new data arrives too quickly and corrupts the data being captured. This exercise provides a hands-on look at this \"race condition\" in a realistic processor pipeline and challenges you to calculate the minimum delay needed to fix it, a common technique known as buffer insertion. [@problem_id:3627777]", "problem": "A two-stage pipeline in a simple Arithmetic Logic Unit (ALU) is clocked by a single global clock network. The first stage contains a source register $R_{0}$ implemented as an edge-triggered D flip-flop (DFF), and the second stage contains a destination register $R_{1}$, also a DFF. Between $R_{0}$ and $R_{1}$ there is an ALU block with an enable-controlled bypass. When the bypass is enabled, the datapath from $R_{0}.\\mathrm{Q}$ to $R_{1}.\\mathrm{D}$ traverses only a $2$-to-$1$ multiplexer (MUX) and a short local wire, creating a very short datapath.\n\nAssume the following measured or characterized best-case Process-Voltage-Temperature (PVT) conditions for this bypass path:\n- The minimum clock-to-Q delay of $R_{0}$ is $t_{cq}^{min} = 35\\,\\mathrm{ps}$.\n- The minimum propagation delay of the combinational bypass path (MUX plus wire) is $t_{pd}^{min} = 12\\,\\mathrm{ps}$.\n- The hold time of the destination DFF $R_{1}$ is $t_{hold} = 60\\,\\mathrm{ps}$.\n- The best-case clock skew, defined as destination clock arrival time minus source clock arrival time under the same best-case PVT, is $t_{skew}^{best} = +25\\,\\mathrm{ps}$.\n\nYou are allowed to insert a dedicated delay element in the bypass datapath that contributes an additional propagation delay $d_{fix}$ to the minimum datapath delay without affecting the clock network. Using only fundamental definitions of setup and hold times for edge-triggered DFFs and the notion of relative clock arrival time (skew), determine the smallest nonnegative $d_{fix}$ that guarantees the receiving register $R_{1}$ does not suffer a hold-time violation when the bypass is enabled under these best-case conditions.\n\nExpress your final answer as a single real-valued number in picoseconds. No rounding is necessary; report the exact value implied by the given parameters.", "solution": "The hold-time requirement for an edge-triggered D flip-flop (DFF) states that, after the active clock edge arrives at the destination register, the data at its input must remain stable for at least the hold time $t_{hold}$. The earliest time that new data, launched by the source register on its active clock edge, can arrive at the destination input is the sum of the minimum clock-to-Q delay of the source, the minimum propagation delay of the combinational datapath, and any intentional additional delay inserted on that datapath.\n\nLet the source clock active edge define time $t=0$ at the source register. Let the destination clock active edge occur at time $t = t_{skew}^{best}$ relative to the source edge, where $t_{skew}^{best}$ is defined as destination arrival time minus source arrival time under best-case PVT. A positive $t_{skew}^{best}$ means the destination clock edge arrives later than the source clock edge.\n\nBy fundamental timing definitions, to avoid a hold violation, the earliest possible arrival of the new data at the destination input must be no earlier than the end of the destination’s hold window. The end of the destination’s hold window occurs at time $t = t_{skew}^{best} + t_{hold}$ relative to the source clock edge. The earliest arrival of new data occurs at time $t = t_{cq}^{min} + t_{pd}^{min} + d_{fix}$. Therefore, the hold-time safety condition is\n$$\nt_{cq}^{min} + t_{pd}^{min} + d_{fix} \\ge t_{hold} + t_{skew}^{best}.\n$$\nWe solve for the minimum additional delay $d_{fix}$ required:\n$$\nd_{fix} \\ge \\left(t_{hold} + t_{skew}^{best}\\right) - \\left(t_{cq}^{min} + t_{pd}^{min}\\right).\n$$\nThe least $d_{fix}$ that satisfies this inequality while remaining physically realizable is\n$$\nd_{fix} = \\max\\!\\left\\{0,\\ \\left(t_{hold} + t_{skew}^{best}\\right) - \\left(t_{cq}^{min} + t_{pd}^{min}\\right)\\right\\}.\n$$\nSubstituting the given values,\n$$\n\\left(t_{hold} + t_{skew}^{best}\\right) - \\left(t_{cq}^{min} + t_{pd}^{min}\\right)\n= \\left(60\\,\\mathrm{ps} + 25\\,\\mathrm{ps}\\right) - \\left(35\\,\\mathrm{ps} + 12\\,\\mathrm{ps}\\right)\n= 85\\,\\mathrm{ps} - 47\\,\\mathrm{ps}\n= 38\\,\\mathrm{ps}.\n$$\nSince this value is positive, the minimal nonnegative delay that must be added is\n$$\nd_{fix} = 38\\,\\mathrm{ps}.\n$$\nNo rounding is required.", "answer": "$$\\boxed{38}$$", "id": "3627777"}, {"introduction": "Achieving high performance is a balancing act between setup and hold constraints. One powerful technique is to introduce \"useful skew,\" intentionally delaying the clock signal to a destination register to provide more time for a long computational path. This practice demonstrates this concept of \"time borrowing\" but also reveals the trade-off: easing the setup constraint on a long path simultaneously tightens the hold constraint on any parallel short paths. [@problem_id:3627844]", "problem": "A synchronous pipeline in a microarchitecture uses edge-triggered Flip-Flops (FFs) clocked by a single global clock sourced from a Phase-Locked Loop (PLL). Consider two sibling combinational paths from a launch FF $R_{L}$ to a capture FF $R_{C}$: a longer Arithmetic Logic Unit (ALU) path and a shorter bypass path. The goal is to apply intentional “useful skew,” defined by the skew variable $t_{\\mathrm{skew}}$ (in this problem, $t_{\\mathrm{skew}}$ is defined as $t_{\\mathrm{launch}} - t_{\\mathrm{capture}}$ for the same cycle), to ease the setup constraint on the long ALU path while guaranteeing that no hold violation occurs along the short bypass path.\n\nAssume the following physically realistic parameters measured at nominal operating conditions:\n- Launch FF $R_{L}$ clock-to-$Q$ maximum $t_{\\mathrm{cq,max}} = 80\\,\\mathrm{ps}$ and minimum $t_{\\mathrm{cq,min}} = 60\\,\\mathrm{ps}$.\n- Capture FF $R_{C}$ setup time $t_{\\mathrm{setup}} = 50\\,\\mathrm{ps}$ and hold time $t_{\\mathrm{hold}} = 30\\,\\mathrm{ps}$.\n- Long ALU path maximum combinational delay $D_{\\mathrm{L,max}} = 760\\,\\mathrm{ps}$.\n- Short bypass path minimum combinational delay $D_{\\mathrm{S,min}} = 120\\,\\mathrm{ps}$.\n- The baseline clock distribution has negligible uncertainty and its skew can be tuned by a programmable deskew element on the $R_{C}$ branch, making $t_{\\mathrm{skew}}$ more negative as the $R_{C}$ edge is delayed relative to $R_{L}$.\n\nStarting from the fundamental definitions of setup and hold for edge-triggered FFs and the definition of clock skew given above, determine the most negative useful skew $t_{\\mathrm{skew}}^{\\mathrm{useful}}  0$ that can be introduced without violating the hold constraint on the short bypass path. Using that $t_{\\mathrm{skew}}^{\\mathrm{useful}}$, determine the resulting minimum clock period $T_{\\min}$ required to satisfy the setup constraint on the long ALU path.\n\nExpress your final answers in picoseconds and provide them in the order $\\big(t_{\\mathrm{skew}}^{\\mathrm{useful}},\\,T_{\\min}\\big)$. Round each value to three significant figures.", "solution": "The pipeline timing constraints for edge-triggered Flip-Flops (FFs) follow from their fundamental definitions:\n\n- Setup time $t_{\\mathrm{setup}}$: Data at the capture FF input must be stable for at least $t_{\\mathrm{setup}}$ before the next active clock edge at the capture FF. Considering a launch edge and the next capture edge one period later, the latest data arrival time at the capture FF must be no later than the capture edge minus $t_{\\mathrm{setup}}$.\n- Hold time $t_{\\mathrm{hold}}$: Data at the capture FF input must remain stable for at least $t_{\\mathrm{hold}}$ after the same clock edge at the capture FF. Considering the same-cycle capture edge, the earliest data arrival time must occur no earlier than the capture edge plus $t_{\\mathrm{hold}}$.\n\nWe define the clock skew as $t_{\\mathrm{skew}} = t_{\\mathrm{launch}} - t_{\\mathrm{capture}}$ for the same cycle. A negative $t_{\\mathrm{skew}}$ means the capture edge arrives later than the launch edge, which increases the available time for setup in the next cycle but tightens hold in the same cycle.\n\nSetup constraint for the long ALU path: The latest data arrival time at $R_{C}$ is\n$$\nt_{\\mathrm{latest}} = t_{\\mathrm{launch}} + t_{\\mathrm{cq,max}} + D_{\\mathrm{L,max}}.\n$$\nThis must be no later than the next capture edge minus setup time:\n$$\nt_{\\mathrm{capture}} + T - t_{\\mathrm{setup}}.\n$$\nThus,\n$$\nt_{\\mathrm{launch}} + t_{\\mathrm{cq,max}} + D_{\\mathrm{L,max}} \\leq t_{\\mathrm{capture}} + T - t_{\\mathrm{setup}}.\n$$\nRearranging with $t_{\\mathrm{skew}} = t_{\\mathrm{launch}} - t_{\\mathrm{capture}}$ gives the period requirement\n$$\nT \\geq t_{\\mathrm{skew}} + t_{\\mathrm{cq,max}} + D_{\\mathrm{L,max}} + t_{\\mathrm{setup}}.\n$$\n\nHold constraint for the short bypass path: The earliest data arrival time at $R_{C}$ is\n$$\nt_{\\mathrm{earliest}} = t_{\\mathrm{launch}} + t_{\\mathrm{cq,min}} + D_{\\mathrm{S,min}}.\n$$\nThis must be no earlier than the capture edge plus hold time:\n$$\nt_{\\mathrm{capture}} + t_{\\mathrm{hold}}.\n$$\nThus,\n$$\nt_{\\mathrm{launch}} + t_{\\mathrm{cq,min}} + D_{\\mathrm{S,min}} \\geq t_{\\mathrm{capture}} + t_{\\mathrm{hold}},\n$$\nwhich, using $t_{\\mathrm{skew}} = t_{\\mathrm{launch}} - t_{\\mathrm{capture}}$, becomes\n$$\nt_{\\mathrm{skew}} + t_{\\mathrm{cq,min}} + D_{\\mathrm{S,min}} - t_{\\mathrm{hold}} \\geq 0.\n$$\nSolving for $t_{\\mathrm{skew}}$,\n$$\nt_{\\mathrm{skew}} \\geq t_{\\mathrm{hold}} - t_{\\mathrm{cq,min}} - D_{\\mathrm{S,min}}.\n$$\n\nTo maximize the beneficial effect on setup while avoiding hold violations, choose the most negative $t_{\\mathrm{skew}}$ that still satisfies the hold inequality, i.e.,\n$$\nt_{\\mathrm{skew}}^{\\mathrm{useful}} = t_{\\mathrm{hold}} - t_{\\mathrm{cq,min}} - D_{\\mathrm{S,min}}.\n$$\nSubstitute the given values $t_{\\mathrm{hold}} = 30\\,\\mathrm{ps}$, $t_{\\mathrm{cq,min}} = 60\\,\\mathrm{ps}$, and $D_{\\mathrm{S,min}} = 120\\,\\mathrm{ps}$:\n$$\nt_{\\mathrm{skew}}^{\\mathrm{useful}} = 30\\,\\mathrm{ps} - 60\\,\\mathrm{ps} - 120\\,\\mathrm{ps} = -150\\,\\mathrm{ps}.\n$$\n\nWith this $t_{\\mathrm{skew}}^{\\mathrm{useful}}$, the minimum period that meets the setup constraint on the long path is\n$$\nT_{\\min} = t_{\\mathrm{skew}}^{\\mathrm{useful}} + t_{\\mathrm{cq,max}} + D_{\\mathrm{L,max}} + t_{\\mathrm{setup}}.\n$$\nSubstitute $t_{\\mathrm{skew}}^{\\mathrm{useful}} = -150\\,\\mathrm{ps}$, $t_{\\mathrm{cq,max}} = 80\\,\\mathrm{ps}$, $D_{\\mathrm{L,max}} = 760\\,\\mathrm{ps}$, and $t_{\\mathrm{setup}} = 50\\,\\mathrm{ps}$:\n$$\nT_{\\min} = -150\\,\\mathrm{ps} + 80\\,\\mathrm{ps} + 760\\,\\mathrm{ps} + 50\\,\\mathrm{ps} = 740\\,\\mathrm{ps}.\n$$\n\nRounding each to three significant figures in picoseconds, the values $-150\\,\\mathrm{ps}$ and $740\\,\\mathrm{ps}$ are expressed as $-1.50 \\times 10^{2}\\,\\mathrm{ps}$ and $7.40 \\times 10^{2}\\,\\mathrm{ps}$, respectively.\n\nTherefore, the ordered pair $\\big(t_{\\mathrm{skew}}^{\\mathrm{useful}},\\,T_{\\min}\\big)$ in picoseconds is $\\big(-1.50 \\times 10^{2},\\,7.40 \\times 10^{2}\\big)$.", "answer": "$$\\boxed{\\begin{pmatrix}-1.50 \\times 10^{2}  7.40 \\times 10^{2}\\end{pmatrix}}$$", "id": "3627844"}, {"introduction": "This final practice synthesizes your understanding of setup and hold times in a practical design optimization scenario. You will engage in \"retiming,\" the process of relocating pipeline registers to balance the amount of logic between stages, with the goal of achieving the highest possible clock speed. This exercise requires you to evaluate multiple design choices, optimizing for the critical path delay while meticulously ensuring that no hold violations are created on the newly formed pipeline stages. [@problem_id:3627742]", "problem": "A synchronous datapath uses three stages separated by two pipeline registers built from D-type flip-flops (DFF). The datapath between the input register and the output register is a strictly feed-forward chain of six combinational sub-blocks, labeled in order as $B_1 \\rightarrow B_2 \\rightarrow B_3 \\rightarrow B_4 \\rightarrow B_5 \\rightarrow B_6$. Each sub-block $B_k$ has a worst-case (maximum) propagation delay $t_{pd,k}^{\\max}$ and a best-case (minimum) propagation delay $t_{pd,k}^{\\min}$, given in nanoseconds, as follows:\n- $B_1$: $t_{pd,1}^{\\max} = 0.35$, $t_{pd,1}^{\\min} = 0.09$\n- $B_2$: $t_{pd,2}^{\\max} = 0.26$, $t_{pd,2}^{\\min} = 0.07$\n- $B_3$: $t_{pd,3}^{\\max} = 0.41$, $t_{pd,3}^{\\min} = 0.10$\n- $B_4$: $t_{pd,4}^{\\max} = 0.29$, $t_{pd,4}^{\\min} = 0.07$\n- $B_5$: $t_{pd,5}^{\\max} = 0.38$, $t_{pd,5}^{\\min} = 0.09$\n- $B_6$: $t_{pd,6}^{\\max} = 0.31$, $t_{pd,6}^{\\min} = 0.08$\n\nThere are three pipeline stages separated by two registers that must be placed at sub-block boundaries. Initially, the two registers are placed after $B_1$ and after $B_4$, so the three stages are $(B_1)$, $(B_2,B_3,B_4)$, and $(B_5,B_6)$.\n\nThe D-type flip-flops have the following timing parameters (nanoseconds):\n- clock-to-$Q$ worst-case delay $t_{clk\\rightarrow Q}^{\\max} = 0.11$\n- clock-to-$Q$ best-case delay $t_{clk\\rightarrow Q}^{\\min} = 0.07$\n- setup time $t_{setup} = 0.05$\n- hold time $t_{hold} = 0.06$\n\nThe clock distribution exhibits bounded skew between any launching and capturing registers. Define clock skew as $t_{skew} = t_{clk}^{dst} - t_{clk}^{src}$, where $t_{clk}^{dst}$ is the destination register’s clock arrival time relative to the source. The skew is known to lie within $[s_{\\min}, s_{\\max}] = [-0.03, +0.04]$ nanoseconds for all register pairs in this datapath.\n\nYou may perform only retiming by relocating the two pipeline registers to different boundaries between sub-blocks; you must preserve exactly three pipeline stages and you may not split any sub-block. Your goal is to minimize the per-stage critical path (that is, the maximum over the three stages of the sum of the involved $t_{pd,k}^{\\max}$), while ensuring that, after retiming, the hold requirement is satisfied at each register boundary when evaluated with the corresponding per-stage sum of $t_{pd,k}^{\\min}$ and the given DFF and skew parameters. If multiple placements achieve the same minimized maximum per-stage $t_{pd}^{\\max}$, prefer the placement that yields the larger minimum-delay margin with respect to hold.\n\nFrom first principles of synchronous timing (data launched by a source register must arrive and be stable before the next active clock edge at the destination by at least the setup time, and must not arrive too early within the same clock edge earlier than the hold time), determine the optimal register placement and compute the minimum feasible clock period $T_{clk,\\min}$, in nanoseconds, that meets both setup and hold across all stage boundaries under the stated skew bounds. Use the worst-case combination of parameters consistent with these principles. Round your final $T_{clk,\\min}$ to four significant figures. Express your answer in nanoseconds. Do not include units in your final boxed answer.", "solution": "The goal is to find an optimal placement of two pipeline registers among six combinational blocks to minimize the clock period, subject to setup and hold constraints.\n\nFirst, we establish the worst-case timing constraints for any pipeline stage.\nThe **setup constraint** determines the minimum clock period ($T_{clk}$). The data launched by a source register must arrive at the destination register no later than the setup time ($t_{setup}$) before the next clock edge. The worst case occurs with the longest path delays ($t_{clk\\rightarrow Q}^{\\max}$, $t_{comb}^{\\max}$) and the most unfavorable clock skew (earliest destination clock, $s_{min}$).\n$$T_{clk} \\ge t_{clk\\rightarrow Q}^{\\max} + t_{comb}^{\\max} + t_{setup} - s_{min}$$\nSubstituting the given values (in nanoseconds):\n$$T_{clk} \\ge 0.11 + t_{comb}^{\\max} + 0.05 - (-0.03) = t_{comb}^{\\max} + 0.19$$\nTo minimize $T_{clk}$, we must minimize the maximum combinational path delay across all stages, $t_{comb,crit}^{\\max} = \\max(t_{comb}^{\\max}_{\\text{stage1}}, t_{comb}^{\\max}_{\\text{stage2}}, t_{comb}^{\\max}_{\\text{stage3}})$.\n\nThe **hold constraint** ensures that new data does not arrive too early and corrupt the data currently being latched. The earliest data arrival must be after the hold time ($t_{hold}$) window closes. The worst case for hold occurs with the shortest path delays ($t_{clk\\rightarrow Q}^{\\min}$, $t_{comb}^{\\min}$) and the most unfavorable skew (latest destination clock, $s_{max}$).\n$$t_{clk\\rightarrow Q}^{\\min} + t_{comb}^{\\min} \\ge t_{hold} + s_{max}$$\nSubstituting the given values:\n$$0.07 + t_{comb}^{\\min} \\ge 0.06 + 0.04 \\implies t_{comb}^{\\min} \\ge 0.03 \\, \\text{ns}$$\nAny valid pipeline stage must have a minimum combinational delay of at least $0.03$ ns.\n\nThe task is to retime the pipeline by placing registers after blocks $B_i$ and $B_j$ (where $i  j$) to create three stages: $(B_1, \\dots, B_i)$, $(B_{i+1}, \\dots, B_j)$, and $(B_{j+1}, \\dots, B_6)$. The objective is to find the placement that minimizes $\\max(t_{comb}^{\\max})$ for the three stages, while ensuring $t_{comb}^{\\min} \\ge 0.03$ ns for each.\n\nBy evaluating all $\\binom{5}{2}=10$ possible placements, the optimal configuration is found by placing the registers after blocks $B_2$ and $B_4$. This configuration creates stages with well-balanced maximum delays. Let's analyze this placement:\n-   **Stage 1:** Blocks $(B_1, B_2)$\n    -   $t_{comb,1}^{\\max} = t_{pd,1}^{\\max} + t_{pd,2}^{\\max} = 0.35 + 0.26 = 0.61$ ns\n    -   $t_{comb,1}^{\\min} = t_{pd,1}^{\\min} + t_{pd,2}^{\\min} = 0.09 + 0.07 = 0.16$ ns. (Hold check: $0.16 \\ge 0.03$, OK)\n-   **Stage 2:** Blocks $(B_3, B_4)$\n    -   $t_{comb,2}^{\\max} = t_{pd,3}^{\\max} + t_{pd,4}^{\\max} = 0.41 + 0.29 = 0.70$ ns\n    -   $t_{comb,2}^{\\min} = t_{pd,3}^{\\min} + t_{pd,4}^{\\min} = 0.10 + 0.07 = 0.17$ ns. (Hold check: $0.17 \\ge 0.03$, OK)\n-   **Stage 3:** Blocks $(B_5, B_6)$\n    -   $t_{comb,3}^{\\max} = t_{pd,5}^{\\max} + t_{pd,6}^{\\max} = 0.38 + 0.31 = 0.69$ ns\n    -   $t_{comb,3}^{\\min} = t_{pd,5}^{\\min} + t_{pd,6}^{\\min} = 0.09 + 0.08 = 0.17$ ns. (Hold check: $0.17 \\ge 0.03$, OK)\n\nThis placement satisfies the hold constraint for all stages. The critical path delay for the retimed pipeline is the maximum of the stage delays:\n$$t_{comb,crit}^{\\max} = \\max(0.61, 0.70, 0.69) = 0.70 \\, \\text{ns}$$\nThis is the lowest achievable critical path delay among all valid placements.\n\nNow we can calculate the minimum feasible clock period using the setup constraint for this critical path:\n$$T_{clk,\\min} = t_{comb,crit}^{\\max} + 0.19 = 0.70 + 0.19 = 0.89 \\, \\text{ns}$$\nRounding the result to four significant figures gives $0.8900$ ns.", "answer": "$$\\boxed{0.8900}$$", "id": "3627742"}]}