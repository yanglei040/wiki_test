{"hands_on_practices": [{"introduction": "A model's parameters are not just abstract numbers; they are the drivers of its economic predictions. This first practice challenges you to explore how the Vasicek model's parameters—mean-reversion speed $\\kappa$, long-run mean $\\theta$, and volatility $\\sigma$—directly impact the probability of a yield curve inversion. By translating the inversion condition into a constraint on the future short rate $r_t$ and computing its likelihood, you will develop a concrete intuition for how these parameters shape interest rate dynamics [@problem_id:2429602].", "problem": "Consider the Vasicek short-rate model under the risk-neutral probability measure, where the instantaneous short rate $r_t$ follows the stochastic differential equation\n$$\ndr_t = \\kappa \\left(\\theta - r_t\\right) dt + \\sigma \\, dW_t,\n$$\nwith constant parameters $\\kappa > 0$, $\\theta \\in \\mathbb{R}$, and $\\sigma \\ge 0$, and where $W_t$ is a standard Brownian motion. For any time $t$ and maturity horizon $\\tau > 0$, the time-$t$ price of a zero-coupon bond maturing at time $t+\\tau$ is defined by the risk-neutral expectation\n$$\nP(t,t+\\tau) = \\mathbb{E}^{\\mathbb{Q}} \\left[ \\exp\\left( -\\int_t^{t+\\tau} r_s \\, ds \\right) \\Big| \\mathcal{F}_t \\right],\n$$\nand the continuously-compounded zero-coupon yield $y(t,\\tau)$ is defined by\n$$\ny(t,\\tau) = -\\frac{1}{\\tau} \\ln P(t,t+\\tau).\n$$\n\nFix an initial short rate $r_0$ at time $t=0$. Define the event of a yield curve inversion at time $t=1$ year to be the strict inequality $y(1,10) < y(1,1)$, where $y(1,10)$ is the continuously-compounded yield at time $t=1$ with maturity horizon $\\tau=10$ years, and $y(1,1)$ is the continuously-compounded yield at time $t=1$ with maturity horizon $\\tau=1$ year. All time quantities are in years, and all interest rates and yields are annualized on a continuously-compounded basis as decimals (for example, $0.03$ represents three percent per annum).\n\nFor each test case below, you are given:\n- an initial short rate $r_0$, and\n- a finite list of candidate parameter triples $(\\kappa,\\theta,\\sigma)$ with $\\kappa > 0$ and $\\sigma \\ge 0$,\n\nall of which are to be treated as risk-neutral parameters for both bond pricing and probability calculations. For each test case, determine which candidate parameter triple maximizes the probability (expressed as a decimal in $[0,1]$) of the yield curve inversion event $y(1,10) < y(1,1)$. If two or more candidates achieve probabilities that are equal up to a numerical tolerance of $\\varepsilon = 10^{-12}$, select the candidate with the smallest index in the given ordering.\n\nTest suite (the same candidate list applies to all test cases):\n\nCandidate list (indexed in order $0,1,2,3,4$):\n- Index $0$: $(\\kappa,\\theta,\\sigma) = (0.8,\\, 0.03,\\, 0.01)$\n- Index $1$: $(\\kappa,\\theta,\\sigma) = (0.3,\\, 0.06,\\, 0.015)$\n- Index $2$: $(\\kappa,\\theta,\\sigma) = (1.2,\\, 0.02,\\, 0.005)$\n- Index $3$: $(\\kappa,\\theta,\\sigma) = (0.5,\\, 0.04,\\, 0)$\n- Index $4$: $(\\kappa,\\theta,\\sigma) = (0.1,\\, 0.08,\\, 0.03)$\n\nTest cases:\n- Test case $1$: $r_0 = 0.03$\n- Test case $2$: $r_0 = 0.01$\n- Test case $3$: $r_0 = 0.05$\n\nYour program must, for each test case, compute the probability of inversion at time $t=1$ under each candidate parameter triple, identify the index of the candidate that maximizes the probability (with the tie-breaking rule described above), and output the selected indices for all test cases.\n\nFinal output format: Your program should produce a single line of output containing the results as a comma-separated list of integers enclosed in square brackets (for example, $[2,0,4]$). The $i$-th integer in the list must be the selected candidate index for test case $i$, using zero-based indexing.\n\nAll computations must be consistent with the definitions given above. All times are in years, and all rates are annualized on a continuously-compounded basis as decimals. Probabilities must be computed as decimals, not as percentages.", "solution": "The problem requires a thorough analysis of the Vasicek short-rate model to determine which of a given set of parameters maximizes the probability of a specific yield curve inversion event. The validation of the problem statement confirms its scientific soundness, consistency, and well-posed nature. It is a standard problem in quantitative finance, grounded in established mathematical theory. We may, therefore, proceed with the derivation of the solution.\n\nOur objective is to compute the probability of the yield curve inversion event at time $t=1$, defined by the inequality $y(1,10) < y(1,1)$, for each candidate parameter set $(\\kappa, \\theta, \\sigma)$. The probability is conditioned on the initial short rate $r_0$. The parameter set that yields the highest probability will be selected.\n\nFirst, we must establish the relationship between the continuously-compounded yield $y(t,\\tau)$ and the instantaneous short rate $r_t$. The Vasicek model is an affine term-structure model, for which the price of a zero-coupon bond $P(t, t+\\tau)$ has an exponential-affine form:\n$$\nP(t, t+\\tau) = e^{A(\\tau) - B(\\tau)r_t}\n$$\nwhere $\\tau$ is the time to maturity. The functions $A(\\tau)$ and $B(\\tau)$ depend on the model parameters $(\\kappa, \\theta, \\sigma)$. Standard theory for the Vasicek model provides the following expressions:\n$$\nB(\\tau) = \\frac{1 - e^{-\\kappa\\tau}}{\\kappa}\n$$\n$$\nA(\\tau) = \\left(\\theta - \\frac{\\sigma^2}{2\\kappa^2}\\right) [B(\\tau) - \\tau] - \\frac{\\sigma^2}{4\\kappa} B(\\tau)^2\n$$\nThe continuously-compounded yield is defined as $y(t,\\tau) = -\\frac{1}{\\tau} \\ln P(t,t+\\tau)$. Substituting the bond price formula, we obtain a linear relationship between the yield and the short rate:\n$$\ny(t,\\tau) = -\\frac{1}{\\tau} (A(\\tau) - B(\\tau)r_t) = \\frac{B(\\tau)}{\\tau}r_t - \\frac{A(\\tau)}{\\tau}\n$$\n\nNext, we analyze the yield curve inversion condition $y(1,10) < y(1,1)$. Substituting the expression for the yield, we get:\n$$\n\\frac{B(10)}{10}r_1 - \\frac{A(10)}{10} < \\frac{B(1)}{1}r_1 - \\frac{A(1)}{1}\n$$\nRearranging the terms to isolate $r_1$:\n$$\n\\frac{A(1)}{1} - \\frac{A(10)}{10} < r_1 \\left( \\frac{B(1)}{1} - \\frac{B(10)}{10} \\right)\n$$\nThe coefficient of $r_1$ is $\\frac{B(1)}{\\tau_1} - \\frac{B(10)}{\\tau_2}$ with $\\tau_1=1$ and $\\tau_2=10$. The function $h(\\tau) = B(\\tau)/\\tau = \\frac{1-e^{-\\kappa\\tau}}{\\kappa\\tau}$ is a strictly decreasing function of $\\tau$ for $\\kappa > 0$. Thus, $h(1) > h(10)$, and the coefficient of $r_1$ is positive. We can divide by it without changing the direction of the inequality:\n$$\nr_1 > \\frac{A(1) - A(10)/10}{B(1) - B(10)/10}\n$$\nWe define the right-hand side as the critical short rate, $r_{\\text{crit}}$. The inversion event occurs if and only if the short rate at time $t=1$ exceeds this threshold: $r_1 > r_{\\text{crit}}$. It is computationally advantageous to simplify the expression for $r_{\\text{crit}}$. By substituting the formula for $A(\\tau)$, we find:\n$$\nr_{\\text{crit}} = \\left(\\theta - \\frac{\\sigma^2}{2\\kappa^2}\\right) - \\frac{\\sigma^2}{4\\kappa} \\frac{B(1)^2 - B(10)^2/10}{B(1) - B(10)/10}\n$$\n\nThe next step is to determine the probability of this event, $\\mathbb{P}(r_1 > r_{\\text{crit}} | r_0)$. This requires the conditional distribution of $r_1$ given $r_0$. The stochastic differential equation for the Vasicek model describes an Ornstein-Uhlenbeck process. The solution at time $t=1$ starting from $r_0$ at $t=0$ is:\n$$\nr_1 = r_0 e^{-\\kappa} + \\theta(1-e^{-\\kappa}) + \\sigma \\int_0^1 e^{-\\kappa(1-s)} dW_s\n$$\nFrom this, it follows that $r_1$ is normally distributed with conditional mean $\\mu$ and variance $v^2$:\n$$\n\\mu = \\mathbb{E}[r_1 | r_0] = r_0 e^{-\\kappa} + \\theta(1-e^{-\\kappa})\n$$\n$$\nv^2 = \\text{Var}[r_1 | r_0] = \\frac{\\sigma^2}{2\\kappa}(1-e^{-2\\kappa})\n$$\nThe probability of inversion is therefore the probability that a normally distributed random variable $r_1 \\sim \\mathcal{N}(\\mu, v^2)$ exceeds $r_{\\text{crit}}$. This can be expressed using the standard normal cumulative distribution function $\\Phi(z)$:\n$$\n\\mathbb{P}(r_1 > r_{\\text{crit}}) = \\mathbb{P}\\left(\\frac{r_1 - \\mu}{v} > \\frac{r_{\\text{crit}} - \\mu}{v}\\right) = 1 - \\Phi\\left(\\frac{r_{\\text{crit}} - \\mu}{v}\\right)\n$$\nThis is equivalent to the survival function of the normal distribution, which is numerically more stable to compute.\n\nA special case arises when $\\sigma = 0$. The model becomes deterministic, the variance $v^2$ is zero, and $r_1$ takes the fixed value $r_1 = \\mu = r_0 e^{-\\kappa} + \\theta(1-e^{-\\kappa})$. In this case, the probability $\\mathbb{P}(r_1 > r_{\\text{crit}})$ is either $1$ if $r_1 > r_{\\text{crit}}$, or $0$ otherwise. For $\\sigma=0$, the expression for $r_{\\text{crit}}$ simplifies to $\\theta$.\n\nThe computational procedure is as follows:\n1. For each test case, defined by an initial rate $r_0$.\n2. Iterate through each candidate parameter triple $(\\kappa, \\theta, \\sigma)$.\n3. Calculate the critical rate $r_{\\text{crit}}$ using the derived formula.\n4. Calculate the conditional mean $\\mu$ and variance $v^2$ of $r_1$.\n5. Handle the deterministic case ($\\sigma = 0$) and stochastic case ($\\sigma > 0$) separately to compute the probability $\\mathbb{P}(r_1 > r_{\\text{crit}})$.\n6. Compare the computed probabilities for all candidates and identify the index of the candidate yielding the maximum probability, applying the specified tie-breaking rule (select the smaller index if probabilities are equal within a tolerance of $10^{-12}$).\n7. Collect the winning indices for all test cases.\nThis procedure leads to a unique and correct solution for each test case.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\n# According to the problem specification, the following libraries are permitted:\n# - `name: numpy`, `version: 1.23.5`\n# - `name: scipy`, `version: 1.11.4`\n\ndef solve():\n    \"\"\"\n    Solves the Vasicek model yield curve inversion problem.\n\n    For each test case, it iterates through a list of candidate parameter sets \n    for the Vasicek model. It calculates the probability of a yield curve \n    inversion event (y(1, 10) < y(1, 1)) for each parameter set and determines \n    which set maximizes this probability.\n    \"\"\"\n    \n    # Candidate parameter triples (kappa, theta, sigma)\n    candidate_params = [\n        (0.8, 0.03, 0.01),   # Index 0\n        (0.3, 0.06, 0.015),  # Index 1\n        (1.2, 0.02, 0.005),  # Index 2\n        (0.5, 0.04, 0),      # Index 3\n        (0.1, 0.08, 0.03),   # Index 4\n    ]\n\n    # Test cases defined by the initial short rate r_0\n    test_cases_r0 = [0.03, 0.01, 0.05]\n    \n    # Numerical tolerance for tie-breaking\n    TOLERANCE = 1e-12\n\n    def calculate_inversion_probability(r0, kappa, theta, sigma):\n        \"\"\"\n        Calculates the probability of yield curve inversion P(y(1,10) < y(1,1)).\n\n        Args:\n            r0 (float): Initial short rate at t=0.\n            kappa (float): Mean-reversion speed.\n            theta (float): Long-term mean of the short rate.\n            sigma (float): Volatility of the short rate.\n\n        Returns:\n            float: The probability of the inversion event.\n        \"\"\"\n        \n        # In the Vasicek model, bond prices are P(t, T) = exp(A(T-t) - B(T-t)*r_t).\n        # The yield is y(t, tau) = (B(tau)/tau)*r_t - A(tau)/tau.\n        # The inversion condition y(1,10) < y(1,1) becomes r_1 > r_crit.\n        \n        # Handle the special deterministic case where sigma = 0\n        if np.isclose(sigma, 0.0):\n            # For sigma=0, r_crit simplifies to theta\n            r_crit = theta\n            # The process is deterministic, so r_1 is known\n            r1 = r0 * np.exp(-kappa) + theta * (1 - np.exp(-kappa))\n            return 1.0 if r1 > r_crit else 0.0\n\n        # General stochastic case (sigma > 0)\n        \n        # B(tau) = (1 - exp(-kappa*tau)) / kappa\n        def b_func(tau, k):\n            if np.isclose(k, 0.0):\n                return tau  # Taylor expansion for small kappa\n            return (1.0 - np.exp(-k * tau)) / k\n\n        b1 = b_func(1.0, kappa)\n        b10 = b_func(10.0, kappa)\n\n        # Calculate r_crit using the simplified formula:\n        # r_crit = (theta - sigma^2/(2*k^2)) - (sigma^2/(4*k)) * (B(1)^2 - B(10)^2/10) / (B(1) - B(10)/10)\n        c_theta = theta - (sigma**2) / (2.0 * kappa**2)\n        c_sigma = -(sigma**2) / (4.0 * kappa)\n        \n        num_frac = b1**2 - (b10**2) / 10.0\n        den_frac = b1 - b10 / 10.0\n        \n        r_crit = c_theta + c_sigma * (num_frac / den_frac)\n        \n        # Distribution of r_1 given r_0 is Normal(mu, v^2)\n        mu = r0 * np.exp(-kappa) + theta * (1.0 - np.exp(-kappa))\n        var = (sigma**2 / (2.0 * kappa)) * (1.0 - np.exp(-2.0 * kappa))\n        std_dev = np.sqrt(var)\n\n        # If standard deviation is effectively zero, treat as deterministic\n        if np.isclose(std_dev, 0.0):\n            return 1.0 if mu > r_crit else 0.0\n        \n        # Probability P(r_1 > r_crit) is the survival function (1 - CDF)\n        # of a normal distribution. norm.sf is numerically stable.\n        return norm.sf(r_crit, loc=mu, scale=std_dev)\n\n    # Store the index of the best candidate for each test case\n    best_candidate_indices = []\n\n    for r0 in test_cases_r0:\n        probabilities = []\n        for params in candidate_params:\n            kappa, theta, sigma = params\n            prob = calculate_inversion_probability(r0, kappa, theta, sigma)\n            probabilities.append(prob)\n        \n        # Find the index of the candidate maximizing the probability\n        max_prob = -1.0\n        best_idx = -1\n        for i, p in enumerate(probabilities):\n            # Apply tie-breaking rule: if new prob > max_prob (plus tolerance),\n            # it becomes the new max. Otherwise, the smaller index is kept.\n            if p > max_prob + TOLERANCE:\n                max_prob = p\n                best_idx = i\n        \n        best_candidate_indices.append(best_idx)\n    \n    # Print the final result in the specified format\n    results_str = ','.join(map(str, best_candidate_indices))\n    print(f\"[{results_str}]\")\n\nsolve()\n\n```", "id": "2429602"}, {"introduction": "The practical utility of any short-rate model hinges on its ability to match observed market data. This exercise guides you through the crucial process of calibration by extending the Vasicek model to fit a given term structure of interest rates perfectly. You will determine the time-varying market price of risk, $\\lambda(t)$, that makes the model consistent with the market, a fundamental step for any real-world pricing or hedging application [@problem_id:2429542].", "problem": "You must write a complete program that, given a time-varying market price of risk, enforces perfect pricing of a specified initial term structure within the Vasicek short-rate framework. The Vasicek model under the physical measure (denoted by the probability measure $\\mathbb{P}$) is given by the stochastic differential equation $dr_t = \\kappa (\\mu - r_t) \\, dt + \\sigma \\, dW_t^{\\mathbb{P}}$, where $\\kappa > 0$ is the speed of mean reversion, $\\mu$ is the long-run level under $\\mathbb{P}$, $\\sigma > 0$ is the volatility, and $W_t^{\\mathbb{P}}$ is a standard Brownian motion. Assume a deterministic, time-varying market price of risk $\\lambda(t)$ that changes the drift under the risk-neutral measure (denoted by the probability measure $\\mathbb{Q}$) according to $dr_t = [\\kappa (\\mu - r_t) - \\sigma \\lambda(t)] \\, dt + \\sigma \\, dW_t^{\\mathbb{Q}}$, where $W_t^{\\mathbb{Q}}$ is a standard Brownian motion under $\\mathbb{Q}$. The requirement is that the model under $\\mathbb{Q}$ should perfectly price a given initial, non-affine term structure specified by an instantaneous forward rate curve $f(0,T)$.\n\nThe initial instantaneous forward rate curve $f(0,T)$ for maturity $T \\ge 0$ is defined as $f(0,T) = c_0 + c_1 e^{-b T} + c_2 T e^{-b T}$ with parameters $c_0 = 0.02$, $c_1 = 0.01$, $c_2 = 0.005$, and $b = 0.5$. The Vasicek parameters are $\\kappa = 0.7$, $\\mu = 0.03$, and $\\sigma = 0.01$. Time is measured in years, and all rates are annualized and continuously compounded. Your task is to numerically compute the values of the time-varying market price of risk $\\lambda(t)$ that force the model to perfectly price the given initial term structure.\n\nUse the following test suite of evaluation times (in years): $t \\in \\{0.0, 0.25, 1.0, 5.0, 20.0\\}$. For each $t$ in this set, compute the corresponding value of $\\lambda(t)$ as a real number. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered exactly as the times are given. For example: $[x_1,x_2,x_3,x_4,x_5]$. The required outputs are real numbers (floats). No other text should be printed.\n\nAll inputs are fixed as stated above; your program must be self-contained and must not read any input from the user or from external files. The functional form provided for $f(0,T)$ and the parameter values constitute the complete specification required to compute $\\lambda(t)$ at the evaluation times. The final answers must be returned in the specified single-line format.", "solution": "The problem requires the determination of a time-varying market price of risk, $\\lambda(t)$, for the Vasicek short-rate model such that it perfectly reproduces a given initial term structure of interest rates. The term structure is specified by an instantaneous forward rate curve, $f(0,T)$.\n\nThe Vasicek model dynamics for the short rate $r_t$ under the risk-neutral measure $\\mathbb{Q}$ are given by the stochastic differential equation (SDE):\n$$dr_t = [\\kappa (\\mu - r_t) - \\sigma \\lambda(t)] \\, dt + \\sigma \\, dW_t^{\\mathbb{Q}}$$\nwhere $\\kappa$ is the speed of mean reversion, $\\mu$ is the long-run mean under the physical measure $\\mathbb{P}$, $\\sigma$ is the volatility, and $\\lambda(t)$ is the deterministic market price of risk. This SDE can be rewritten in the standard Hull-White form:\n$$dr_t = \\kappa (\\theta(t) - r_t) \\, dt + \\sigma \\, dW_t^{\\mathbb{Q}}$$\nwhere $\\theta(t)$ is a time-dependent mean-reversion level under $\\mathbb{Q}$, defined as:\n$$\\theta(t) = \\mu - \\frac{\\sigma}{\\kappa} \\lambda(t)$$\nOur primary goal is to determine $\\theta(t)$, from which we can easily find $\\lambda(t)$.\n\nThe calibration condition is that the model-implied instantaneous forward rate at time $t=0$ for maturity $T$, denoted $f_{model}(0, T)$, must match the given market instantaneous forward rate, $f_{market}(0, T)$, for all maturities $T \\ge 0$.\n$$f_{model}(0, T) = f_{market}(0, T), \\quad \\forall T \\ge 0$$\nFor a Hull-White model, the price at time $t$ of a zero-coupon bond maturing at $T$, $P(t, T)$, is known to have an affine form $P(t, T) = A(t, T) e^{-B(t, T) r_t}$. The instantaneous forward rate is defined as $f(t, T) = -\\frac{\\partial \\ln P(t, T)}{\\partial T}$. The general expression for the model's forward rate is a standard result:\n$$f_{model}(t, T) = e^{-\\kappa(T-t)} r_t + \\int_t^T \\kappa \\theta(s) e^{-\\kappa(T-s)} ds - \\frac{\\sigma^2}{2\\kappa^2} (1 - e^{-\\kappa(T-t)})^2$$\nTo calibrate at time $t=0$, we set $t=0$ in the above formula. The initial short rate $r_0$ is given by the initial forward curve at inception, $r_0 = f_{market}(0, 0)$.\n$$f_{model}(0, T) = e^{-\\kappa T} r_0 + \\int_0^T \\kappa \\theta(s) e^{-\\kappa(T-s)} ds - \\frac{\\sigma^2}{2\\kappa^2} (1 - e^{-\\kappa T})^2$$\nApplying the calibration condition, we obtain an integral equation for $\\theta(s)$:\n$$f_{market}(0, T) = e^{-\\kappa T} r_0 + e^{-\\kappa T}\\int_0^T \\kappa \\theta(s) e^{\\kappa s} ds - \\frac{\\sigma^2}{2\\kappa^2} (1 - e^{-\\kappa T})^2$$\nLet's define a function $G(T)$ for brevity:\n$$G(T) = f_{market}(0, T) - e^{-\\kappa T} r_0 + \\frac{\\sigma^2}{2\\kappa^2} (1 - e^{-\\kappa T})^2$$\nThe integral equation becomes:\n$$\\int_0^T \\kappa \\theta(s) e^{\\kappa s} ds = e^{\\kappa T} G(T)$$\nTo solve for $\\theta(t)$, we differentiate both sides with respect to $T$ and then substitute $t$ for $T$. Applying the Fundamental Theorem of Calculus to the left side and the product rule to the right side, we get:\n$$\\kappa \\theta(T) e^{\\kappa T} = \\frac{d}{dT} \\left[ e^{\\kappa T} G(T) \\right] = \\kappa e^{\\kappa T} G(T) + e^{\\kappa T} G'(T)$$\nSolving for $\\theta(T)$ yields:\n$$\\theta(T) = G(T) + \\frac{1}{\\kappa} G'(T)$$\nSubstituting the expression for $G(T)$ and its derivative $G'(T)$ and simplifying leads to the well-known formula for the calibrated mean-reversion level:\n$$\\theta(t) = f_{market}(0, t) + \\frac{1}{\\kappa} \\frac{\\partial f_{market}(0, t)}{\\partial t} + \\frac{\\sigma^2}{2\\kappa^2}(1 - e^{-2\\kappa t})$$\nHere, we have replaced the variable $T$ with $t$ to represent the time-dependency. The market forward curve is given as:\n$$f_{market}(0, t) = c_0 + c_1 e^{-b t} + c_2 t e^{-b t}$$\nIts derivative with respect to time $t$ is:\n$$\\frac{\\partial f_{market}(0, t)}{\\partial t} = -b c_1 e^{-b t} + c_2 e^{-b t} - b c_2 t e^{-b t} = (c_2 - b c_1) e^{-b t} - b c_2 t e^{-b t}$$\nSubstituting these into the expression for $\\theta(t)$:\n$$\\theta(t) = c_0 + \\left( c_1 + \\frac{c_2 - b c_1}{\\kappa} \\right) e^{-b t} + \\left( c_2 - \\frac{b c_2}{\\kappa} \\right) t e^{-b t} + \\frac{\\sigma^2}{2\\kappa^2}(1 - e^{-2\\kappa t})$$\nThis can be simplified to:\n$$\\theta(t) = c_0 + \\left( c_1(1-\\frac{b}{\\kappa}) + \\frac{c_2}{\\kappa} \\right) e^{-b t} + c_2(1-\\frac{b}{\\kappa}) t e^{-b t} + \\frac{\\sigma^2}{2\\kappa^2}(1 - e^{-2\\kappa t})$$\nFinally, we find the market price of risk $\\lambda(t)$ by rearranging its definition:\n$$\\lambda(t) = \\frac{\\kappa}{\\sigma} (\\mu - \\theta(t))$$\nWe will now implement this final formula using the provided parameters to compute $\\lambda(t)$ at the specified evaluation times.\n\nThe given parameters are:\n- Model parameters: $\\kappa = 0.7$, $\\mu = 0.03$, $\\sigma = 0.01$.\n- Forward curve parameters: $c_0 = 0.02$, $c_1 = 0.01$, $c_2 = 0.005$, $b = 0.5$.\n- Evaluation times: $t \\in \\{0.0, 0.25, 1.0, 5.0, 20.0\\}$.\n\nThe program will compute $\\theta(t)$ and then $\\lambda(t)$ for each of these time points.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the time-varying market price of risk lambda(t) that makes the\n    Vasicek model perfectly price a given initial term structure.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (kappa, mu, sigma, c0, c1, c2, b, evaluation_times)\n        (0.7, 0.03, 0.01, 0.02, 0.01, 0.005, 0.5, [0.0, 0.25, 1.0, 5.0, 20.0])\n    ]\n\n    results = []\n    # There is only one set of parameters in this problem.\n    kappa, mu, sigma, c0, c1, c2, b, eval_times = test_cases[0]\n\n    for t in eval_times:\n        # This implementation follows the derived formula for theta(t).\n        # theta(t) = f_market(0, t) + (1/kappa) * f_market'(0, t) + (sigma^2 / (2*kappa^2)) * (1 - exp(-2*kappa*t))\n        #\n        # f_market(0, t) = c0 + c1*exp(-b*t) + c2*t*exp(-b*t)\n        # f_market'(0, t) = (c2 - b*c1)*exp(-b*t) - b*c2*t*exp(-b*t)\n        #\n        # Combining these gives a simplified expression for theta(t), which is implemented here.\n\n        # Calculate common terms\n        exp_bt = np.exp(-b * t)\n        exp_2kt = np.exp(-2 * kappa * t)\n        \n        # Term 1: from c0\n        term1 = c0\n        \n        # Term 2: coefficient of exp(-b*t)\n        # This combines c1*exp(-b*t) from f_market and parts of f_market'\n        term2_coeff = c1 * (1 - b / kappa) + c2 / kappa\n        term2 = term2_coeff * exp_bt\n        \n        # Term 3: coefficient of t*exp(-b*t)\n        # This combines c2*t*exp(-b*t) from f_market and parts of f_market'\n        term3_coeff = c2 * (1 - b / kappa)\n        term3 = term3_coeff * t * exp_bt\n        \n        # Term 4: the volatility adjustment term\n        term4 = (sigma**2 / (2 * kappa**2)) * (1 - exp_2kt)\n        \n        # Sum the terms to get theta(t)\n        theta_t = term1 + term2 + term3 + term4\n        \n        # Calculate lambda(t) from theta(t)\n        # lambda(t) = (kappa/sigma) * (mu - theta(t))\n        lambda_t = (kappa / sigma) * (mu - theta_t)\n        \n        results.append(lambda_t)\n\n    # Final print statement in the exact required format.\n    # The format specified is a list of floats, comma-separated, inside square brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2429542"}, {"introduction": "We now advance to the Cox-Ingersoll-Ross (CIR) model to price a European option on a coupon-bearing bond, a common financial instrument. This problem introduces a powerful and elegant technique known as Jamshidian's decomposition, which simplifies the valuation by transforming an option on a portfolio into a portfolio of simpler options. This method leverages the monotonic relationship between bond prices and the short rate $r_t$, providing a semi-analytic solution that highlights the unique features of the CIR model [@problem_id:2429604].", "problem": "Consider a one-factor short-rate model under the risk-neutral measure where the short rate $r_s$ follows the Cox–Ingersoll–Ross (CIR) stochastic differential equation (SDE)\n$$\n\\mathrm{d}r_s \\;=\\; \\kappa\\big(\\theta - r_s\\big)\\,\\mathrm{d}s \\;+\\; \\sigma \\sqrt{r_s}\\,\\mathrm{d}W_s,\n$$\nwith strictly positive parameters $\\kappa$, $\\theta$, and $\\sigma$, and Brownian motion $W_s$. Let the current time be $t=0$ and the current short rate be $r_0 > 0$. A default-free zero-coupon bond price for maturity $T$ is denoted $P(0,T)$, and in the CIR model it admits an exponential–affine form\n$$\nP(0,T) \\;=\\; A(0,T)\\,\\exp\\big(-B(0,T)\\,r_0\\big),\n$$\nwhere $A(0,T)$ and $B(0,T)$ are the standard CIR affine coefficients. Likewise, for $T \\leq U$, the time-$T$ price $P(T,U)$ is $A(T,U)\\exp(-B(T,U) r_T)$. Assume all standard technical conditions ensuring absence of arbitrage and integrability hold.\n\nYou are given a European call option written on a default-free coupon-bearing bond that pays deterministic cash flows $\\{c_i\\}_{i=1}^{N}$ at times $\\{T_i\\}_{i=1}^{N}$ with $0 < T < T_1 < \\cdots < T_N$. The option expires at time $T$ and has strike $K > 0$. Its time-$T$ payoff is\n$$\n\\Bigg(\\sum_{i=1}^{N} c_i\\,P(T,T_i) \\;-\\; K\\Bigg)^{+}.\n$$\nStarting from the risk-neutral valuation principle and the one-factor structure of the CIR model, and without assuming any option-pricing formula as given, derive an analytic expression for the time-$0$ price of this option by decomposing the coupon bond into a portfolio of zero-coupon bonds. Your derivation should rely on:\n\n- The risk-neutral pricing definition of time-$0$ prices as discounted expectations under the risk-neutral measure.\n- The monotonicity in the one-factor short-rate setting that justifies Jamshidian’s decomposition.\n- The known exponential–affine form of zero-coupon bond prices in the CIR model and the fact that the conditional law of $r_T$ is non-central chi-square, so that expectations of functions of $r_T$ can be expressed via the cumulative distribution function (CDF) of a non-central chi-square random variable.\n\nExpress your final answer as a single closed-form analytic expression in terms of $A(\\cdot,\\cdot)$, $B(\\cdot,\\cdot)$, $\\kappa$, $\\theta$, $\\sigma$, $r_0$, $\\{c_i,T_i\\}_{i=1}^{N}$, $T$, $K$, and the non-central chi-square CDF. Do not evaluate any special functions numerically. No rounding is required. Clearly state any intermediate quantities you introduce, but the final answer must be a single analytic expression.", "solution": "**Derivation**\n\nThe time-$0$ price, $C(0)$, of the European call option is given by the risk-neutral valuation principle. This states that the price is the discounted expectation of the payoff under the risk-neutral measure $Q$.\n$$\nC(0) = E^Q_0 \\left[ \\exp\\left(-\\int_0^T r_s ds\\right) \\left( \\sum_{i=1}^{N} c_i\\,P(T,T_i) - K \\right)^{+} \\right]\n$$\nwhere $E^Q_0[\\cdot]$ denotes the expectation conditional on the information at time $t=0$.\n\nThe price of the underlying coupon-bearing bond at the option's expiration time $T$ is the sum of the prices of the zero-coupon bonds corresponding to each future cash flow:\n$$\nV_B(T) = \\sum_{i=1}^{N} c_i P(T, T_i)\n$$\nIn the CIR model, the price of a zero-coupon bond $P(T, T_i)$ is an exponential-affine function of the short rate $r_T$:\n$$\nP(T, T_i) = A(T, T_i) \\exp(-B(T, T_i) r_T)\n$$\nThe parameters of the CIR model, $\\kappa, \\theta, \\sigma$, are positive. The standard CIR bond pricing functions $A(t,T)$ and $B(t,T)$ are strictly positive for $t < T$. We assume the cash flows $c_i$ are also positive, as is standard for coupon payments.\n\nTo apply Jamshidian's decomposition, we must establish that the price of the coupon bond at time $T$, $V_B(T)$, is a monotonic function of the single state variable, $r_T$. Taking the derivative of $V_B(T)$ with respect to $r_T$:\n$$\n\\frac{\\partial V_B(T)}{\\partial r_T} = \\sum_{i=1}^{N} c_i \\frac{\\partial}{\\partial r_T} \\left[ A(T, T_i) \\exp(-B(T, T_i) r_T) \\right] = \\sum_{i=1}^{N} c_i A(T, T_i) \\exp(-B(T, T_i) r_T) \\left( -B(T, T_i) \\right)\n$$\nSince $c_i > 0$, $A(T,T_i) > 0$, and $B(T,T_i) > 0$, each term in the sum is negative. Therefore, $\\frac{\\partial V_B(T)}{\\partial r_T} < 0$, which means $V_B(T)$ is a strictly decreasing function of $r_T$.\n\nBecause of this strict monotonicity, there exists a unique critical value of the short rate, which we denote $r_T^*$, such that the bond price equals the strike price:\n$$\nV_B(r_T^*) = \\sum_{i=1}^{N} c_i A(T, T_i) \\exp(-B(T, T_i) r_T^*) = K\n$$\nThis equation defines $r_T^*$. While an analytical solution for $r_T^*$ is generally not available, its existence is guaranteed. The option is in-the-money if $V_B(T) > K$, which is equivalent to $r_T < r_T^*$. The payoff can thus be written using an indicator function $\\mathbb{I}(\\cdot)$:\n$$\n\\left( V_B(T) - K \\right)^{+} = \\left( \\sum_{i=1}^{N} c_i\\,P(T,T_i) - K \\right) \\mathbb{I}(r_T < r_T^*)\n$$\nSubstituting this into the pricing formula and using the linearity of expectation:\n$$\nC(0) = E^Q_0 \\left[ \\exp\\left(-\\int_0^T r_s ds\\right) \\left( \\sum_{i=1}^{N} c_i\\,P(T,T_i) - K \\right) \\mathbb{I}(r_T < r_T^*) \\right]\n$$\n$$\nC(0) = \\sum_{i=1}^{N} c_i E^Q_0 \\left[ \\exp\\left(-\\int_0^T r_s ds\\right) P(T,T_i) \\mathbb{I}(r_T < r_T^*) \\right] - K E^Q_0 \\left[ \\exp\\left(-\\int_0^T r_s ds\\right) \\mathbb{I}(r_T < r_T^*) \\right]\n$$\nThis decomposes the option on a portfolio into a portfolio of digital-style options. We now analyze each term using a change of numeraire technique.\n\nFor the $i$-th term in the sum, we use the zero-coupon bond $P(t, T_i)$ as the numeraire. The corresponding forward measure is denoted $Q^{T_i}$. The Radon-Nikodym derivative is $\\frac{dQ^{T_i}}{dQ} |_{\\mathcal{F}_t} = \\frac{\\exp(-\\int_0^t r_s ds) P(t, T_i)}{P(0, T_i)}$. The term becomes:\n$$\nc_i E^Q_0 [ \\exp(-\\int_0^T r_s ds) P(T,T_i) \\mathbb{I}(r_T < r_T^*) ] = c_i P(0, T_i) E^{Q^{T_i}}_0 [ \\mathbb{I}(r_T < r_T^*) ] = c_i P(0, T_i) Q^{T_i}(r_T < r_T^*)\n$$\nFor the second part of the expression involving the strike $K$, we use the zero-coupon bond $P(t, T)$ as the numeraire. The corresponding forward measure is $Q^T$. The term becomes:\n$$\nK E^Q_0 [ \\exp(-\\int_0^T r_s ds) \\mathbb{I}(r_T < r_T^*) ] = K P(0, T) E^{Q^T}_0 [ \\mathbb{I}(r_T < r_T^*) ] = K P(0, T) Q^T(r_T < r_T^*)\n$$\nCombining these results, the option price is:\n$$\nC(0) = \\sum_{i=1}^{N} c_i P(0, T_i) Q^{T_i}(r_T < r_T^*) - K P(0, T) Q^T(r_T < r_T^*)\n$$\nThe problem now reduces to computing the probabilities $Q^S(r_T < r_T^*)$ for $S \\in \\{T_1, \\dots, T_N, T\\}$. It is a known result for the CIR model that such probabilities under any forward measure can be expressed in terms of the non-central chi-square CDF.\n\nLet us define a generic function $\\mathbb{P}(t, T, S, z)$ for the time-$t$ conditional probability that $r_T < z$ under the $S$-forward measure $Q^S$:\n$$\n\\mathbb{P}(t, T, S, z) := Q^S(r_T < z | \\mathcal{F}_t)\n$$\nThis probability is given by the CDF of a non-central chi-square distribution. Let $\\chi^2_{\\text{cdf}}(x; d, \\lambda)$ denote this CDF with $x$ as the variable, $d$ degrees of freedom, and $\\lambda$ the non-centrality parameter. We define the following quantities:\n-   $\\gamma = \\sqrt{\\kappa^2 + 2\\sigma^2}$\n-   $d = \\frac{4\\kappa\\theta}{\\sigma^2}$ (degrees of freedom)\n-   $\\phi(t,T) = \\frac{2\\gamma}{\\sigma^2(\\exp(\\gamma(T-t))-1)}$\n-   $\\psi = \\frac{\\kappa+\\gamma}{\\sigma^2}$\n\nWith these definitions, the probability function is given by:\n$$\n\\mathbb{P}(t, T, S, z) = \\chi^2_{\\text{cdf}}\\left( 2z \\left(\\phi(t,T)+\\psi+B(T,S)\\right); d; \\frac{2(\\phi(t,T))^2 r_t \\exp(\\gamma(T-t))}{\\phi(t,T)+\\psi+B(T,S)} \\right)\n$$\nFor our problem, $t=0$. The option price can be written as:\n$$\nC(0) = \\sum_{i=1}^{N} c_i P(0, T_i) \\mathbb{P}(0, T, T_i, r_T^*) - K P(0, T) \\mathbb{P}(0, T, T, r_T^*)\n$$\nNote that for the last term, the numeraire maturity $S$ is equal to the option expiry $T$. In this case, $B(T,T)=0$. The formula remains valid.\n\nThe final expression is obtained by substituting the explicit form of $\\mathbb{P}$ into the price formula. The critical rate $r_T^*$ is implicitly defined as the unique positive solution to $\\sum_{i=1}^{N} c_i A(T,T_i) \\exp(-B(T,T_i) r_T^*) = K$.", "answer": "$$\n\\boxed{\\sum_{i=1}^{N} c_i P(0, T_i) \\chi^2_{\\text{cdf}}\\left( 2r_T^*\\left(\\phi_T+\\psi+B(T,T_i)\\right); d; \\frac{2\\phi_T^2 r_0 \\exp(\\gamma T)}{\\phi_T+\\psi+B(T,T_i)} \\right) - K P(0, T) \\chi^2_{\\text{cdf}}\\left( 2r_T^*\\left(\\phi_T+\\psi\\right); d; \\frac{2\\phi_T^2 r_0 \\exp(\\gamma T)}{\\phi_T+\\psi} \\right)}\n$$", "id": "2429604"}]}