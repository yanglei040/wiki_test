{"hands_on_practices": [{"introduction": "Allocators like the buddy system simplify memory management by restricting block sizes to powers of two, which makes finding and coalescing blocks very fast. While efficient, this design choice has a direct and quantifiable cost: internal fragmentation. This exercise provides a hands-on opportunity to see this trade-off in action by tracing a specific sequence of memory requests and calculating the exact amount of wasted space that results from rounding up to the next power of two [@problem_id:3628282].", "problem": "A computer system uses contiguous memory allocation within a single region of Random Access Memory (RAM). The allocator is a buddy system that enforces power-of-two block sizes and splits a larger contiguous region into smaller power-of-two blocks. The smallest allocable block is one kibibyte (KiB). Under the buddy system, a request for a block of size $s$ is satisfied by rounding $s$ up to the smallest power of two that is greater than or equal to $s$, then allocating one such block contiguously.\n\nConsider an initially free contiguous region of size $512$ kibibytes (KiB). A process issues a sequence of four allocation requests in order, each requiring a contiguous block: $62$ KiB, $90$ KiB, $35$ KiB, and $10$ KiB. Under contiguous memory allocation with ideal variable-size splitting, each request would be satisfied by carving out exactly the requested size, incurring zero internal fragmentation. Under the buddy system, each request is rounded up to the smallest power-of-two block size before allocation.\n\nUsing only the core definitions of contiguous memory allocation, internal fragmentation, and the buddy systemâ€™s power-of-two rounding rule, determine the internal fragmentation waste induced by the buddy allocator relative to the ideal contiguous splitting baseline. Define the waste fraction as the excess allocated bytes divided by the requested bytes, and compute its exact value for this allocation pattern. Express your final answer as a fraction without units.", "solution": "The problem asks for the internal fragmentation waste fraction for a sequence of memory allocation requests under a buddy system, relative to an ideal allocation scheme. The solution requires a step-by-step analysis of how the buddy system services each request and a calculation of the resulting fragmentation.\n\nFirst, let us formalize the given information and definitions.\nThe sequence of memory requests has sizes $s_1 = 62$ KiB, $s_2 = 90$ KiB, $s_3 = 35$ KiB, and $s_4 = 10$ KiB.\nThe total requested size, denoted as $S_{req}$, is the sum of the individual request sizes:\n$$S_{req} = s_1 + s_2 + s_3 + s_4$$\n\nUnder the buddy system, a request of size $s$ is satisfied by allocating a block of size $a$, where $a$ is the smallest power of two such that $a \\ge s$. Mathematically, this can be expressed as $a = 2^{\\lceil \\log_2(s) \\rceil}$. The smallest allocable block size is $1$ KiB, which is $2^0$ KiB, consistent with the power-of-two rule.\n\nThe problem defines the \"ideal variable-size splitting\" baseline, where the allocated size is exactly the requested size. For this baseline, the total allocated memory would be equal to $S_{req}$, and thus the internal fragmentation would be zero.\n\nInternal fragmentation for a single allocation is the difference between the allocated size and the requested size, i.e., $a - s$. The total internal fragmentation, or the total \"excess allocated bytes\" ($I$), is the sum of the fragmentation for each request.\n$$I = \\sum_{i=1}^{4} (a_i - s_i) = \\left(\\sum_{i=1}^{4} a_i\\right) - \\left(\\sum_{i=1}^{4} s_i\\right) = S_{alloc} - S_{req}$$\nwhere $S_{alloc}$ is the total size allocated by the buddy system.\n\nThe \"waste fraction\", $F_w$, is defined as the excess allocated bytes divided by the requested bytes:\n$$F_w = \\frac{I}{S_{req}} = \\frac{S_{alloc} - S_{req}}{S_{req}}$$\n\nNow, we proceed with the calculation.\n\nStep 1: Calculate the total requested memory size, $S_{req}$.\n$$S_{req} = 62 + 90 + 35 + 10 = 197 \\text{ KiB}$$\n\nStep 2: Calculate the allocated size, $a_i$, for each request $s_i$ under the buddy system's power-of-two rounding rule.\n- For the first request, $s_1 = 62$ KiB:\nThe powers of two are $..., 32, 64, 128, ...$. The smallest power of two greater than or equal to $62$ is $64$. So, $a_1 = 64$ KiB. This corresponds to $2^6$.\n\n- For the second request, $s_2 = 90$ KiB:\nThe smallest power of two greater than or equal to $90$ is $128$. So, $a_2 = 128$ KiB. This corresponds to $2^7$.\n\n- For the third request, $s_3 = 35$ KiB:\nThe smallest power of two greater than or equal to $35$ is $64$. So, $a_3 = 64$ KiB. This corresponds to $2^6$.\n\n- For the fourth request, $s_4 = 10$ KiB:\nThe smallest power of two greater than or equal to $10$ is $16$. So, $a_4 = 16$ KiB. This corresponds to $2^4$.\n\nStep 3: Calculate the total allocated memory size, $S_{alloc}$.\n$$S_{alloc} = a_1 + a_2 + a_3 + a_4 = 64 + 128 + 64 + 16 = 272 \\text{ KiB}$$\nNote that the total allocated size ($272$ KiB) is less than the initial free region ($512$ KiB), so all allocations succeed.\n\nStep 4: Calculate the total excess allocated bytes (internal fragmentation), $I$.\n$$I = S_{alloc} - S_{req} = 272 - 197 = 75 \\text{ KiB}$$\n\nStep 5: Calculate the waste fraction, $F_w$.\n$$F_w = \\frac{I}{S_{req}} = \\frac{75}{197}$$\n\nTo ensure the fraction is in its simplest form, we find the prime factors of the numerator and denominator.\nThe numerator is $75 = 3 \\times 25 = 3 \\times 5^2$.\nFor the denominator, $197$, we check for divisibility by small prime numbers.\n- $197$ is not divisible by $2$ (it is odd).\n- The sum of digits is $1+9+7 = 17$, which is not divisible by $3$.\n- It does not end in $0$ or $5$, so it is not divisible by $5$.\n- We continue checking primes up to $\\sqrt{197} \\approx 14$: $7, 11, 13$.\n  - $197 \\div 7 = 28$ remainder $1$.\n  - $197 \\div 11 = 17$ remainder $10$.\n  - $197 \\div 13 = 15$ remainder $2$.\nSince $197$ is not divisible by any prime number less than or equal to its square root, $197$ is a prime number.\nTherefore, the fraction $\\frac{75}{197}$ is irreducible.", "answer": "$$\\boxed{\\frac{75}{197}}$$", "id": "3628282"}, {"introduction": "To understand an allocator's long-term efficiency, we must analyze its performance over a wide range of requests, not just a single instance. This practice models a sophisticated allocator using segregated free lists with power-of-two bin sizes, similar to many real-world systems [@problem_id:3657360]. By calculating the expected internal fragmentation under a log-uniform distribution, which often reflects realistic request patterns, you will see how mathematical modeling helps predict the average efficiency of an allocation strategy.", "problem": "An operating system memory allocator uses Segregated Free Lists (SFL), where free blocks are organized into bins with sizes that are powers of two. Specifically, the available block sizes are $2^{0}, 2^{1}, 2^{2}, \\dots, 2^{m}$ bytes, for a fixed positive integer $m$. For a request of $s$ bytes, with $1 \\leq s \\leq 2^{m}$, the allocator chooses the smallest block size $b(s)$ such that $b(s) \\geq s$. Assume that per-block metadata and alignment overheads are negligible.\n\nStarting from the core definition that the internal fragmentation ratio is the fraction of the allocated block that remains unused within the block assigned to a request, express the internal fragmentation ratio as a function of $s$ and $b(s)$, and then compute its expected value under the following workload model: request sizes are continuously distributed on $[1, 2^{m}]$ with probability density function\n$$\nf(s) = \\frac{1}{s \\, m \\, \\ln 2} \\quad \\text{for } 1 \\leq s \\leq 2^{m},\n$$\nwhich is the log-uniform distribution normalized over $[1, 2^{m}]$.\n\nDerive the expected internal fragmentation ratio as a single closed-form analytic expression in terms of natural logarithms. Express your final answer as an exact expression; do not round.", "solution": "The problem has been validated and is deemed a valid, well-posed, and scientifically grounded problem in the context of operating systems and applied probability theory. All provided information is consistent, and the premises are sound.\n\nThe first step is to express the internal fragmentation ratio. The internal fragmentation is the unused space within an allocated block. For a memory request of size $s$, the allocated block has size $b(s)$. The amount of unused space is therefore $b(s) - s$. The problem defines the internal fragmentation ratio as the fraction of the allocated block that remains unused. Let this ratio be denoted by $I(s)$.\n\n$$\nI(s) = \\frac{\\text{Unused Space}}{\\text{Allocated Block Size}} = \\frac{b(s) - s}{b(s)} = 1 - \\frac{s}{b(s)}\n$$\n\nNext, we must determine the function $b(s)$. The memory allocator uses block sizes that are powers of two: $2^0, 2^1, \\dots, 2^m$. For a request of size $s$, the allocator chooses the smallest block size $b(s)$ such that $b(s) \\geq s$. This policy implies that if a request size $s$ falls within the interval $(2^{k-1}, 2^k]$, the allocated block size will be $b(s) = 2^k$. This holds for $k = 1, 2, \\dots, m$. For the specific case of $s=1=2^0$, the allocated block is $b(1)=2^0=1$.\n\nThe problem asks for the expected value of the internal fragmentation ratio, $E[I(s)]$, where the request size $s$ is a random variable with the given probability density function (PDF), $f(s)$. The expected value is defined by the integral:\n$$\nE[I(s)] = \\int_{1}^{2^m} I(s) f(s) \\, ds\n$$\nSubstituting the expressions for $I(s)$ and $f(s)$:\n$$\nE[I(s)] = \\int_{1}^{2^m} \\left(1 - \\frac{s}{b(s)}\\right) \\frac{1}{s \\, m \\, \\ln 2} \\, ds\n$$\nWe can rewrite the integrand:\n$$\nE[I(s)] = \\frac{1}{m \\ln 2} \\int_{1}^{2^m} \\left(\\frac{1}{s} - \\frac{1}{b(s)}\\right) \\, ds\n$$\nSince $b(s)$ is a step function that is constant over intervals of the form $(2^{k-1}, 2^k]$, we must partition the domain of integration $[1, 2^m]$ accordingly. The domain can be written as the union of intervals $\\{1\\} \\cup \\bigcup_{k=1}^{m} (2^{k-1}, 2^k]$. As the contribution of the single point $s=1$ to the integral is zero, we can express the integral as a sum over these intervals:\n$$\nE[I(s)] = \\frac{1}{m \\ln 2} \\sum_{k=1}^{m} \\int_{2^{k-1}}^{2^k} \\left(\\frac{1}{s} - \\frac{1}{b(s)}\\right) \\, ds\n$$\nWithin each interval of integration $(2^{k-1}, 2^k]$, the allocated block size is constant: $b(s) = 2^k$.\n$$\nE[I(s)] = \\frac{1}{m \\ln 2} \\sum_{k=1}^{m} \\int_{2^{k-1}}^{2^k} \\left(\\frac{1}{s} - \\frac{1}{2^k}\\right) \\, ds\n$$\nLet's evaluate the integral for a single term in the sum, corresponding to a specific integer $k$ where $1 \\le k \\le m$:\n$$\nJ_k = \\int_{2^{k-1}}^{2^k} \\left(\\frac{1}{s} - \\frac{1}{2^k}\\right) \\, ds\n$$\nThe integral is computed as:\n$$\nJ_k = \\left[ \\ln(s) - \\frac{s}{2^k} \\right]_{s=2^{k-1}}^{s=2^k}\n$$\nEvaluating at the upper limit $s=2^k$:\n$$\n\\ln(2^k) - \\frac{2^k}{2^k} = k \\ln 2 - 1\n$$\nEvaluating at the lower limit $s=2^{k-1}$:\n$$\n\\ln(2^{k-1}) - \\frac{2^{k-1}}{2^k} = (k-1) \\ln 2 - \\frac{1}{2}\n$$\nSubtracting the lower limit evaluation from the upper limit evaluation:\n$$\nJ_k = (k \\ln 2 - 1) - \\left((k-1) \\ln 2 - \\frac{1}{2}\\right) = k \\ln 2 - 1 - (k-1) \\ln 2 + \\frac{1}{2}\n$$\n$$\nJ_k = (k - (k-1))\\ln 2 - 1 + \\frac{1}{2} = \\ln 2 - \\frac{1}{2}\n$$\nNotably, the value of the integral $J_k$ is a constant, independent of $k$.\n\nNow we can substitute this result back into the expression for the expected value:\n$$\nE[I(s)] = \\frac{1}{m \\ln 2} \\sum_{k=1}^{m} J_k = \\frac{1}{m \\ln 2} \\sum_{k=1}^{m} \\left(\\ln 2 - \\frac{1}{2}\\right)\n$$\nThe sum consists of $m$ identical terms:\n$$\n\\sum_{k=1}^{m} \\left(\\ln 2 - \\frac{1}{2}\\right) = m \\left(\\ln 2 - \\frac{1}{2}\\right)\n$$\nFinally, we obtain the expected internal fragmentation ratio:\n$$\nE[I(s)] = \\frac{1}{m \\ln 2} \\left[ m \\left(\\ln 2 - \\frac{1}{2}\\right) \\right] = \\frac{\\ln 2 - \\frac{1}{2}}{\\ln 2}\n$$\nThis expression can be simplified to:\n$$\nE[I(s)] = 1 - \\frac{1/2}{\\ln 2} = 1 - \\frac{1}{2 \\ln 2}\n$$\nThis is the final closed-form expression for the expected internal fragmentation ratio, which is independent of the parameter $m$.", "answer": "$$\n\\boxed{1 - \\frac{1}{2 \\ln(2)}}\n$$", "id": "3657360"}, {"introduction": "Fragmentation isn't just about wasted space inside allocated blocks; it's also about the wasted potential of free space that has become too scattered to be useful. This practice explores external fragmentation through a carefully constructed hypothetical scenario of allocations and deallocations [@problem_id:3657357]. By tracking the state of the heap through this sequence, you will see firsthand how a specific pattern of memory use can lead to a situation where plenty of total memory is free, yet no single large request can be satisfied.", "problem": "A system uses contiguous-region memory allocation for a heap of size $M$, modeled with zero per-block overhead and no alignment constraints, so that an allocation of size $x$ consumes exactly $x$ contiguous bytes. Use mebibytes (MiB) as the unit of memory size. External fragmentation is defined as the fraction $f$ of total free memory that is not contained in the single largest contiguous free block at a given time.\n\nConsider the following sequence on a heap of size $M = 1024 \\, \\text{MiB}$:\n- Step $1$: Allocate one large block of size $H = 512 \\, \\text{MiB}$ at the lowest available address.\n- Step $2$: In the remaining free region above the large block, allocate $n = 192$ small blocks, each of size $s = 2 \\, \\text{MiB}$, using a first-fit policy that splits free regions exactly and places these small blocks contiguously one after another as long as space permits.\n- Step $3$: Free every even-indexed small block (that is, free blocks numbered $2, 4, 6, \\dots$ in their order of allocation), leaving the odd-indexed small blocks still allocated. This produces interleaved free and allocated small-block regions in the area above the large block and leaves the first small block (adjacent to the large block) still allocated.\n- Step $4$: Free the large block of size $H$.\n\nAssume that the allocator does not coalesce non-adjacent free regions and that none of the free regions produced in Steps $3$ and $4$ become adjacent due to these specific frees; in particular, because the first small block remains allocated in Step $3$, the free region created by freeing $H$ in Step $4$ does not become adjacent to any other free region. Under these assumptions, compute the external fragmentation fraction $f$ immediately after Step $4$ in the sense defined above. Express your final answer as a single reduced fraction (unitless). Do not use a percent sign.", "solution": "The problem statement will first be validated against the required criteria.\n\n### Step 1: Extract Givens\n- Total heap size: $M = 1024 \\, \\text{MiB}$\n- Memory allocation policy: Contiguous-region allocation.\n- Overhead: Zero per-block overhead.\n- Alignment: No alignment constraints. An allocation of size $x$ uses exactly $x$ bytes.\n- Definition of external fragmentation: The fraction $f$ of total free memory that is not contained in the single largest contiguous free block. $f = (\\text{Total Free Memory} - \\text{Largest Free Block}) / (\\text{Total Free Memory})$.\n- Step 1: Allocate one block of size $H = 512 \\, \\text{MiB}$ at the lowest available address.\n- Step 2: In the remaining free region, allocate $n = 192$ small blocks, each of size $s = 2 \\, \\text{MiB}$, using a first-fit policy, splitting regions exactly, and placing blocks contiguously.\n- Step 3: Free every even-indexed small block (blocks $2, 4, \\dots, 192$).\n- Step 4: Free the large block of size $H$.\n- Allocator assumption 1: The allocator does not coalesce non-adjacent free regions.\n- Allocator assumption 2: None of the free regions produced in Steps $3$ and $4$ become adjacent.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, as it describes a standard scenario in operating systems coursework concerning memory management. The concepts of contiguous allocation, internal/external fragmentation, and allocation policies (first-fit) are fundamental to the field. All terms are clearly defined (e.g., the specific formula for fragmentation $f$) or are standard within the context. The problem is well-posed; the sequence of operations is unambiguous, and the state of the heap can be determined uniquely at each step. The provided data ($M, H, n, s$) are numerically consistent and do not lead to contradictions. The assumptions about the allocator's behavior (no coalescing) are explicitly stated, removing ambiguity. The problem is objective and formalizable.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\nWe will trace the state of the heap, of total size $M = 1024 \\, \\text{MiB}$, through the specified sequence of operations.\n\nInitially, the entire heap is a single free block of size $1024 \\, \\text{MiB}$.\n\n**Step 1:** A block of size $H = 512 \\, \\text{MiB}$ is allocated at the lowest address.\n- Allocated memory: $[0, 512)$. This block has size $512 \\, \\text{MiB}$.\n- Free memory: A single block at $[512, 1024)$. The size of this free block is $1024 - 512 = 512 \\, \\text{MiB}$.\n\n**Step 2:**\nIn the remaining free region of size $512 \\, \\text{MiB}$, $n = 192$ small blocks, each of size $s = 2 \\, \\text{MiB}$, are allocated contiguously.\n- Total size of small blocks allocated: $S_{alloc} = n \\times s = 192 \\times 2 = 384 \\, \\text{MiB}$.\n- These blocks are placed starting at address $512$. They occupy the region $[512, 512 + 384) = [512, 896)$.\n- After this step, the memory layout is:\n    - Allocated block $H$: $[0, 512)$, size $512 \\, \\text{MiB}$.\n    - $192$ allocated small blocks: $[512, 896)$, total size $384 \\, \\text{MiB}$.\n    - A single remaining free block: $[896, 1024)$, size $1024 - 896 = 128 \\, \\text{MiB}$.\n\n**Step 3:**\nEvery even-indexed small block is freed. The small blocks are indexed $1, 2, 3, \\dots, 192$. We free blocks $2, 4, \\dots, 192$.\n- The number of blocks freed is $\\frac{192}{2} = 96$.\n- The number of blocks remaining allocated is also $\\frac{192}{2} = 96$. These are the odd-indexed blocks $1, 3, \\dots, 191$.\n- This creates $96$ new free blocks, each of size $s = 2 \\, \\text{MiB}$.\n- The allocated odd-indexed blocks and the newly freed even-indexed blocks are interleaved in the region $[512, 896)$. For example, block $1$ (allocated) is at $[512, 514)$, block $2$ is freed creating a free region at $[514, 516)$, block $3$ (allocated) is at $[516, 518)$, and so on.\n- The assumption that the allocator does not coalesce non-adjacent free regions is critical here. These $96$ free blocks of size $2 \\, \\text{MiB}$ remain distinct from each other and from the final free block of size $128 \\, \\text{MiB}$.\n\n**Step 4:**\nThe large block of size $H = 512 \\, \\text{MiB}$ at the beginning of the heap is freed.\n- This creates a new free block of size $512 \\, \\text{MiB}$ at $[0, 512)$.\n- The problem explicitly states that this new free region does not become adjacent to any other free region, because the first small block (block $1$, at $[512, 514)$) remains allocated.\n\nNow, we compute the external fragmentation fraction $f$ based on the final memory state.\nFirst, we identify all free blocks and their sizes:\n1.  One free block from the deallocation of $H$: size $512 \\, \\text{MiB}$.\n2.  $96$ free blocks from the deallocation of even-indexed small blocks: each of size $2 \\, \\text{MiB}$.\n3.  One free block that was the remainder after the small block allocations: size $128 \\, \\text{MiB}$.\n\nThe total amount of free memory, $F_{total}$, is the sum of the sizes of all free blocks:\n$$F_{total} = 512 + (96 \\times 2) + 128$$\n$$F_{total} = 512 + 192 + 128 = 832 \\, \\text{MiB}$$\n\nAlternatively, total allocated memory consists of the $96$ odd-indexed small blocks:\n$A_{total} = 96 \\times 2 = 192 \\, \\text{MiB}$.\nTotal free memory must be $M - A_{total} = 1024 - 192 = 832 \\, \\text{MiB}$. The calculation is consistent.\n\nNext, we identify the size of the single largest contiguous free block, $L$. By comparing the sizes of the free blocks ($512$, $128$, and $2$), we find:\n$$L = 512 \\, \\text{MiB}$$\n\nThe external fragmentation fraction $f$ is defined as the fraction of total free memory that is not in the largest free block.\n$$f = \\frac{F_{total} - L}{F_{total}}$$\nSubstituting the calculated values:\n$$f = \\frac{832 - 512}{832} = \\frac{320}{832}$$\n\nTo simplify this fraction, we find the greatest common divisor of the numerator and the denominator.\n$320 = 32 \\times 10 = (2^5) \\times (2 \\times 5) = 2^6 \\times 5 = 64 \\times 5$.\n$832 = 13 \\times 64$.\nTherefore:\n$$f = \\frac{64 \\times 5}{64 \\times 13} = \\frac{5}{13}$$\nThe external fragmentation fraction is $\\frac{5}{13}$.", "answer": "$$\\boxed{\\frac{5}{13}}$$", "id": "3657357"}]}