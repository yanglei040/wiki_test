{"hands_on_practices": [{"introduction": "Before data can be transmitted across a network in a distributed system, it must be encoded into a suitable format, a process known as serialization. This conversion is not without cost, consuming valuable CPU cycles that can impact the overall throughput of a service. This exercise [@problem_id:3636323] allows you to quantitatively explore the classic trade-off between different serialization formats, such as text-based JSON and binary Protocol Buffers, by modeling their performance and calculating the break-even point where one becomes more efficient than the other.", "problem": "A microservice in a distributed key–value store cluster must serialize and deserialize incoming Remote Procedure Call (RPC) payloads, each containing $n$ scalar fields with simple types. Two alternative encodings are under consideration: JavaScript Object Notation (JSON) and Protocol Buffers (Protobuf). The service runs on a single dedicated core of a Central Processing Unit (CPU) with clock frequency $3.2\\,\\text{GHz}$. Assume the workload is steady-state, the system is CPU-bound (that is, network and storage are not the bottlenecks), and there is no concurrent overlap between computation and I/O for serialization.\n\nModel the CPU work per message as the total number of CPU cycles to serialize and deserialize the payload. Assume the total cycles per message are affine in $n$:\n- For JavaScript Object Notation (JSON): $C_{\\mathrm{J}}(n) = \\alpha_{\\mathrm{J}} + \\gamma_{\\mathrm{J}}\\,n$.\n- For Protocol Buffers (Protobuf): $C_{\\mathrm{P}}(n) = \\alpha_{\\mathrm{P}} + \\gamma_{\\mathrm{P}}\\,n$.\n\nHere, $\\alpha_{\\mathrm{J}}$ and $\\alpha_{\\mathrm{P}}$ are fixed per-message cycle costs (schema handling, allocation overheads, etc.), and $\\gamma_{\\mathrm{J}}$ and $\\gamma_{\\mathrm{P}}$ are per-field cycle costs reflecting encoding and decoding work. Suppose measurements on the target platform yield\n$\\alpha_{\\mathrm{J}} = 1.2 \\times 10^{5}$, $\\gamma_{\\mathrm{J}} = 1.6 \\times 10^{4}$, $\\alpha_{\\mathrm{P}} = 1.8 \\times 10^{5}$, and $\\gamma_{\\mathrm{P}} = 3.2 \\times 10^{3}$, all in units of CPU cycles.\n\nUsing only first principles about throughput as completed work per unit time and the interpretation of a CPU clock rate as available cycles per unit time, derive the per-core steady-state throughputs in messages per second for the two encodings as functions of $n$, and then determine the break-even field count $n^{\\ast}$ at which the two throughputs are equal. Provide your final $n^{\\ast}$ as an exact simplified fraction; no rounding is required. Do not include any units in your final answer.", "solution": "The problem asks for the derivation of throughput for two serialization encodings, JSON and Protobuf, and to find the break-even point $n^{\\ast}$ where their throughputs are equal.\n\n**Step 1: Define Throughput Model**\nThroughput in a CPU-bound system is the rate at which operations can be completed. This is the total number of CPU cycles available per second (the clock frequency, $f$) divided by the number of CPU cycles required per operation (the cost per message, $C(n)$).\n$$\n\\text{Throughput } T(n) = \\frac{f}{C(n)}\n$$\nThe CPU frequency is given as $f = 3.2\\,\\text{GHz}$.\n\n**Step 2: Derive Throughput Functions**\nUsing the given affine cost models, we can write the throughput for each encoding as a function of the number of fields, $n$.\n- For JSON, the cost is $C_{\\mathrm{J}}(n) = \\alpha_{\\mathrm{J}} + \\gamma_{\\mathrm{J}}\\,n$. The throughput is:\n  $$ T_{\\mathrm{J}}(n) = \\frac{f}{\\alpha_{\\mathrm{J}} + \\gamma_{\\mathrm{J}}\\,n} $$\n- For Protobuf, the cost is $C_{\\mathrm{P}}(n) = \\alpha_{\\mathrm{P}} + \\gamma_{\\mathrm{P}}\\,n$. The throughput is:\n  $$ T_{\\mathrm{P}}(n) = \\frac{f}{\\alpha_{\\mathrm{P}} + \\gamma_{\\mathrm{P}}\\,n} $$\n\n**Step 3: Determine the Break-Even Point**\nThe break-even point $n^{\\ast}$ occurs when the throughputs are equal, $T_{\\mathrm{J}}(n^{\\ast}) = T_{\\mathrm{P}}(n^{\\ast})$.\n$$ \\frac{f}{\\alpha_{\\mathrm{J}} + \\gamma_{\\mathrm{J}}\\,n^{\\ast}} = \\frac{f}{\\alpha_{\\mathrm{P}} + \\gamma_{\\mathrm{P}}\\,n^{\\ast}} $$\nSince $f > 0$, we can equate the denominators. This shows that the break-even point depends only on the message costs, not the CPU frequency itself.\n$$ \\alpha_{\\mathrm{J}} + \\gamma_{\\mathrm{J}}\\,n^{\\ast} = \\alpha_{\\mathrm{P}} + \\gamma_{\\mathrm{P}}\\,n^{\\ast} $$\nNow, we solve for $n^{\\ast}$:\n$$ \\gamma_{\\mathrm{J}}\\,n^{\\ast} - \\gamma_{\\mathrm{P}}\\,n^{\\ast} = \\alpha_{\\mathrm{P}} - \\alpha_{\\mathrm{J}} $$\n$$ (\\gamma_{\\mathrm{J}} - \\gamma_{\\mathrm{P}}) n^{\\ast} = \\alpha_{\\mathrm{P}} - \\alpha_{\\mathrm{J}} $$\n$$ n^{\\ast} = \\frac{\\alpha_{\\mathrm{P}} - \\alpha_{\\mathrm{J}}}{\\gamma_{\\mathrm{J}} - \\gamma_{\\mathrm{P}}} $$\n\n**Step 4: Substitute Numerical Values and Calculate**\nWe substitute the given cycle counts into the formula for $n^{\\ast}$:\n- $\\alpha_{\\mathrm{J}} = 1.2 \\times 10^{5}$\n- $\\gamma_{\\mathrm{J}} = 1.6 \\times 10^{4}$\n- $\\alpha_{\\mathrm{P}} = 1.8 \\times 10^{5}$\n- $\\gamma_{\\mathrm{P}} = 3.2 \\times 10^{3}$\n\n$$ n^{\\ast} = \\frac{(1.8 \\times 10^{5}) - (1.2 \\times 10^{5})}{(1.6 \\times 10^{4}) - (3.2 \\times 10^{3})} $$\n$$ n^{\\ast} = \\frac{0.6 \\times 10^{5}}{16 \\times 10^{3} - 3.2 \\times 10^{3}} = \\frac{6 \\times 10^{4}}{12.8 \\times 10^{3}} $$\n$$ n^{\\ast} = \\frac{60}{12.8} $$\nTo get an exact simplified fraction as requested:\n$$ n^{\\ast} = \\frac{600}{128} = \\frac{300}{64} = \\frac{150}{32} = \\frac{75}{16} $$\nThis result indicates that for payloads with more than $75/16 \\approx 4.6875$ fields, Protobuf's lower per-field cost overcomes its higher fixed overhead, making it the more performant choice in terms of throughput.", "answer": "$$\n\\boxed{\\frac{75}{16}}\n$$", "id": "3636323"}, {"introduction": "Making a Remote Procedure Call (RPC) across an unreliable network requires a crucial decision: how long should the client wait for a response before retrying? This practice [@problem_id:3636314] moves beyond static timeouts to explore a dynamic, adaptive approach rooted in statistical estimation. You will apply the Exponentially Weighted Moving Average (EWMA) method, a cornerstone of network protocols like TCP, to calculate an appropriate timeout based on observed Round-Trip Times (RTT), balancing the need for quick failure detection with the cost of unnecessary retransmissions.", "problem": "A service in a distributed cluster uses Remote Procedure Call (RPC) to coordinate tasks. The system retransmits a request if the response does not arrive before a timeout. To avoid both unnecessary retries and excessive waiting, the system sets the timeout adaptively based on the current estimate of the network Round-Trip Time (RTT). The system estimates the RTT mean and variability using the Exponentially Weighted Moving Average (EWMA), and models instantaneous RTT as the sum of many independent delay components arising from queueing, serialization, and propagation. By the Central Limit Theorem, the instantaneous RTT is modeled as approximately normally distributed.\n\nAt discrete time $t$, let the observed RTT sample be $r_t$. The EWMA mean estimate $\\hat{r}_t$ is defined by the core recursive smoothing rule\n$$\n\\hat{r}_t = (1-\\alpha)\\,\\hat{r}_{t-1} + \\alpha\\, r_t,\n$$\nwhere $\\alpha \\in (0,1)$ is the smoothing parameter. To estimate dispersion, define the EWMA of squared deviations $v_t$ by\n$$\nv_t = (1-\\alpha)\\,v_{t-1} + \\alpha\\,\\big(r_t - \\hat{r}_{t-1}\\big)^{2},\n$$\nand take the estimated standard deviation to be $\\hat{\\sigma}_t = \\sqrt{v_t}$.\n\nSuppose at time $t=0$ the system has initial mean estimate $\\hat{r}_0 = 18\\,\\mathrm{ms}$ and initial variance estimate $v_0 = 9\\,\\mathrm{ms}^{2}$, and uses smoothing parameter $\\alpha = 0.3$. Over the next four RPCs, it observes RTT samples\n$$\nr_1 = 21\\,\\mathrm{ms},\\quad r_2 = 15\\,\\mathrm{ms},\\quad r_3 = 24\\,\\mathrm{ms},\\quad r_4 = 18\\,\\mathrm{ms}.\n$$\n\nThe cluster operator requires that, under the normal model with parameters given by the current EWMA estimates, the probability that a single RTT sample exceeds the timeout due solely to random variation (a “false timeout”) must be $\\beta = 0.01$ per attempt. The timeout is set to the smallest value that satisfies this requirement for the current time $t=4$.\n\nUsing only these foundations, compute the numerical value of the timeout at $t=4$. Express your final answer in milliseconds and round your result to four significant figures.", "solution": "The problem requires the calculation of an adaptive timeout for a Remote Procedure Call (RPC) based on statistical estimates of the network's Round-Trip Time (RTT). The problem is well-posed, scientifically grounded, and contains all necessary information for a unique solution. We will proceed by first iteratively computing the Exponentially Weighted Moving Average (EWMA) for the mean and variance of the RTT, and then using these estimates to determine the timeout value that satisfies the specified false timeout probability.\n\nThe given initial conditions at time $t=0$ are:\n- Initial mean estimate: $\\hat{r}_0 = 18\\,\\mathrm{ms}$\n- Initial variance estimate: $v_0 = 9\\,\\mathrm{ms}^{2}$\n- Smoothing parameter: $\\alpha = 0.3$\n\nThe recursive rules for updating the estimates at time $t$ are:\n- Mean estimate: $\\hat{r}_t = (1-\\alpha)\\,\\hat{r}_{t-1} + \\alpha\\, r_t$\n- Variance estimate: $v_t = (1-\\alpha)\\,v_{t-1} + \\alpha\\,\\big(r_t - \\hat{r}_{t-1}\\big)^{2}$\n- Standard deviation estimate: $\\hat{\\sigma}_t = \\sqrt{v_t}$\n\nThe observed RTT samples are $r_1 = 21\\,\\mathrm{ms}$, $r_2 = 15\\,\\mathrm{ms}$, $r_3 = 24\\,\\mathrm{ms}$, and $r_4 = 18\\,\\mathrm{ms}$. We compute the estimates for $t=1, 2, 3, 4$. For clarity, we note that $1-\\alpha = 1 - 0.3 = 0.7$. All units of time are in milliseconds ($\\mathrm{ms}$) and variance in $\\mathrm{ms}^2$.\n\n**Step 1: Compute estimates for $t=1$**\nUsing the sample $r_1 = 21$:\n$$\n\\hat{r}_1 = (1-\\alpha)\\hat{r}_0 + \\alpha r_1 = (0.7)(18) + (0.3)(21) = 12.6 + 6.3 = 18.9\n$$\n$$\nv_1 = (1-\\alpha)v_0 + \\alpha(r_1 - \\hat{r}_0)^2 = (0.7)(9) + (0.3)(21 - 18)^2 = 6.3 + 0.3(3^2) = 6.3 + 2.7 = 9.0\n$$\n\n**Step 2: Compute estimates for $t=2$**\nUsing the sample $r_2 = 15$ and the estimates from $t=1$:\n$$\n\\hat{r}_2 = (1-\\alpha)\\hat{r}_1 + \\alpha r_2 = (0.7)(18.9) + (0.3)(15) = 13.23 + 4.5 = 17.73\n$$\n$$\nv_2 = (1-\\alpha)v_1 + \\alpha(r_2 - \\hat{r}_1)^2 = (0.7)(9.0) + (0.3)(15 - 18.9)^2 = 6.3 + 0.3(-3.9)^2 = 6.3 + 0.3(15.21) = 6.3 + 4.563 = 10.863\n$$\n\n**Step 3: Compute estimates for $t=3$**\nUsing the sample $r_3 = 24$ and the estimates from $t=2$:\n$$\n\\hat{r}_3 = (1-\\alpha)\\hat{r}_2 + \\alpha r_3 = (0.7)(17.73) + (0.3)(24) = 12.411 + 7.2 = 19.611\n$$\n$$\nv_3 = (1-\\alpha)v_2 + \\alpha(r_3 - \\hat{r}_2)^2 = (0.7)(10.863) + (0.3)(24 - 17.73)^2 = 7.6041 + 0.3(6.27)^2 = 7.6041 + 0.3(39.3129) = 7.6041 + 11.79387 = 19.39797\n$$\n\n**Step 4: Compute estimates for $t=4$**\nUsing the sample $r_4 = 18$ and the estimates from $t=3$:\n$$\n\\hat{r}_4 = (1-\\alpha)\\hat{r}_3 + \\alpha r_4 = (0.7)(19.611) + (0.3)(18) = 13.7277 + 5.4 = 19.1277\n$$\n$$\nv_4 = (1-\\alpha)v_3 + \\alpha(r_4 - \\hat{r}_3)^2 = (0.7)(19.39797) + (0.3)(18 - 19.611)^2 = 13.578579 + 0.3(-1.611)^2 = 13.578579 + 0.3(2.595321) = 13.578579 + 0.7785963 = 14.3571753\n$$\nAt time $t=4$, the final estimated mean and variance are:\n$$\n\\hat{r}_4 \\approx 19.1277\\,\\mathrm{ms}\n$$\n$$\nv_4 \\approx 14.3572\\,\\mathrm{ms}^2\n$$\nThe corresponding standard deviation is:\n$$\n\\hat{\\sigma}_4 = \\sqrt{v_4} = \\sqrt{14.3571753} \\approx 3.789086\\,\\mathrm{ms}\n$$\n\n**Step 5: Compute the Timeout**\nThe instantaneous RTT, let's call the random variable $R$, is modeled as a normal distribution with the parameters estimated at $t=4$. Thus, $R \\sim \\mathcal{N}(\\mu, \\sigma^2)$ where $\\mu = \\hat{r}_4$ and $\\sigma = \\hat{\\sigma}_4$.\nThe timeout, $T_o$, must be set such that the probability of a false timeout is $\\beta = 0.01$. This means the probability that an observed RTT $R$ exceeds $T_o$ is $0.01$:\n$$\nP(R > T_o) = \\beta = 0.01\n$$\nTo find $T_o$, we standardize the variable $R$. Let $Z = \\frac{R-\\mu}{\\sigma}$ be a standard normal random variable, $Z \\sim \\mathcal{N}(0, 1)$.\n$$\nP\\left(\\frac{R-\\mu}{\\sigma} > \\frac{T_o-\\mu}{\\sigma}\\right) = P\\left(Z > \\frac{T_o-\\mu}{\\sigma}\\right) = 0.01\n$$\nWe need to find the critical value $z_{0.01}$ from the standard normal distribution such that $P(Z > z_{0.01}) = 0.01$. This value corresponds to the $99^{th}$ percentile of the distribution, as $P(Z \\le z_{0.01}) = 1 - 0.01 = 0.99$. Consulting a standard normal distribution table or using a computational tool, we find:\n$$\nz_{0.01} \\approx 2.3263\n$$\nThe timeout $T_o$ is determined by the equation:\n$$\n\\frac{T_o - \\mu}{\\sigma} = z_{0.01}\n$$\n$$\nT_o = \\mu + z_{0.01} \\sigma = \\hat{r}_4 + z_{0.01} \\hat{\\sigma}_4\n$$\nSubstituting the calculated values for $\\hat{r}_4$ and $\\hat{\\sigma}_4$:\n$$\nT_o \\approx 19.1277 + (2.3263) \\times (3.789086)\n$$\n$$\nT_o \\approx 19.1277 + 8.8150\n$$\n$$\nT_o \\approx 27.9427\\,\\mathrm{ms}\n$$\nThe problem requires the result to be rounded to four significant figures. The value $27.9427$ rounded to four significant figures is $27.94$.", "answer": "$$\\boxed{27.94}$$", "id": "3636314"}, {"introduction": "While the performance of a single remote call is critical, a distributed system's viability often depends on the collective cost of communication among all its nodes. This hands-on problem [@problem_id:3636305] challenges you to analyze the network bandwidth consumption of a gossip-based anti-entropy protocol, a common mechanism for achieving eventual consistency. By applying basic probability theory, you will derive the expected per-node and cluster-wide network load, gaining insight into how such protocols scale with the number of participants.", "problem": "Consider a cluster of $N$ nodes running a gossip anti-entropy protocol. Time is divided into periods of length $P$ seconds. In every period, each node independently initiates exactly one anti-entropy session with a peer chosen uniformly at random from the other $N-1$ nodes (self-selection is disallowed). Each anti-entropy session consists of a bidirectional exchange of a digest of size $g$ bytes: each participant sends exactly one digest of size $g$ bytes and receives exactly one digest of size $g$ bytes from its peer. Assume negligible headers and control traffic beyond the digest payloads, no retries, and that two nodes choosing each other in the same period results in two distinct sessions. Assume sessions complete within the same period in which they are initiated and that initiations across nodes are independent.\n\nUsing only fundamental definitions of bandwidth as bytes per unit time and the linearity of expectation for independent Bernoulli trials, derive from first principles the expected steady-state:\n\n- per-node aggregate bandwidth (sum of transmitted and received bytes per second), and\n- cluster-wide network throughput (total bytes transmitted over network links per second, counting each digest once as it traverses the network),\n\nexpressed in terms of $N$, $g$, and $P$. Express your answers in bytes per second. Provide the final results as a single row vector with the first entry being the per-node aggregate bandwidth and the second entry being the cluster-wide throughput. No numerical substitution is required; express your final answer symbolically.", "solution": "The objective is to compute expected bandwidths based on the rate at which bytes are transferred due to the protocol behavior.\n\nBandwidth is defined as bytes per unit time. Therefore, if an entity transfers an expected number of bytes $B_{\\text{period}}$ in each period of length $P$, its expected bandwidth is $B_{\\text{period}}/P$.\n\nWe analyze two quantities:\n\n1. Expected per-node aggregate bandwidth, which sums bytes transmitted and received by a single node.\n2. Expected cluster-wide throughput, which sums bytes transmitted over the network links (counting each digest once) across all nodes.\n\nWe start with per-node analysis. In each period, each node initiates exactly one session. In addition, other nodes may initiate sessions targeting this node.\n\nLet us fix a node and denote by $X$ the random variable equal to the number of incoming sessions (initiated by other nodes that target this node) in one period. For each other node (there are $N-1$ such nodes), define indicator random variables $I_{i}$ for $i \\in \\{1,2,\\ldots,N-1\\}$, where $I_{i} = 1$ if that node chooses our fixed node as its peer, and $I_{i} = 0$ otherwise. Because each node chooses uniformly from $N-1$ possible peers and choices are independent,\n$$\n\\Pr(I_{i} = 1) = \\frac{1}{N-1}.\n$$\nThus, $X = \\sum_{i=1}^{N-1} I_{i}$ and by linearity of expectation,\n$$\n\\mathbb{E}[X] = \\sum_{i=1}^{N-1} \\mathbb{E}[I_{i}] = \\sum_{i=1}^{N-1} \\frac{1}{N-1} = 1.\n$$\nTherefore, in expectation, a node receives $1$ incoming session per period in addition to the $1$ session it initiates, so it participates in an expected total of $1 + 1 = 2$ sessions per period.\n\nEach session is bidirectional: the node sends a digest of size $g$ bytes and receives a digest of size $g$ bytes. Therefore, the aggregate bytes accounted to the node per session (transmit plus receive) is $2g$. With an expected $2$ sessions per period, the expected per-node aggregate bytes per period is\n$$\nB_{\\text{node, period}} = 2 \\times 2g = 4g.\n$$\nDividing by the period length $P$ to obtain a rate gives the expected per-node aggregate bandwidth:\n$$\nB_{\\text{node}} = \\frac{4g}{P}.\n$$\n\nNext, we compute the cluster-wide network throughput, counting each digest once as it traverses the network. There are exactly $N$ initiated sessions per period because each node initiates one session. Each session produces two digest transmissions over the network, one in each direction, for a total of $2g$ bytes transmitted per session. Therefore, the expected total bytes transmitted over the network in one period is\n$$\nB_{\\text{cluster, period}} = N \\times 2g = 2gN.\n$$\nDividing by $P$ yields the cluster-wide throughput:\n$$\nB_{\\text{cluster}} = \\frac{2gN}{P}.\n$$\n\nCollecting the two expressions, the per-node aggregate bandwidth is $\\frac{4g}{P}$ and the cluster-wide throughput is $\\frac{2gN}{P}$, both in bytes per second.", "answer": "$$\\boxed{\\begin{pmatrix}\\frac{4g}{P} & \\frac{2gN}{P}\\end{pmatrix}}$$", "id": "3636305"}]}