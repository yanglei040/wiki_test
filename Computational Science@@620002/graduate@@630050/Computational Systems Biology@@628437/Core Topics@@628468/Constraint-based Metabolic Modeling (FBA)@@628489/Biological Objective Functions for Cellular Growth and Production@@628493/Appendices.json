{"hands_on_practices": [{"introduction": "Before diving into complex network models, it is essential to understand the fundamental physicochemical constraints that govern any biological transformation. This practice grounds your understanding in first principles by asking you to calculate the theoretical maximum biomass yield based solely on the conservation of atoms and electrons. By applying stoichiometric and redox balancing to a growth reaction, you will determine the hard ceiling on carbon conversion efficiency, providing a crucial benchmark for evaluating real metabolic systems [@problem_id:3292219].", "problem": "A single carbon substrate and the necessity of electron conservation impose strict bounds on the fraction of substrate carbon that can be incorporated into cellular biomass. Consider an aerobic chemotrophic cell growing on glucose with ammonia as the nitrogen source. Assume the following set of exchangeable species: glucose $\\mathrm{C_{6}H_{12}O_{6}}$, ammonia $\\mathrm{NH_{3}}$, dioxygen $\\mathrm{O_{2}}$, water $\\mathrm{H_{2}O}$, and carbon dioxide $\\mathrm{CO_{2}}$. Biomass is represented by the empirical formula $\\mathrm{CH_{1.8}O_{0.5}N_{0.2}}$ per carbon atom. Suppose growth is constrained only by elemental conservation (carbon, hydrogen, oxygen, nitrogen) and electron conservation via redox balance, and ignore adenosine triphosphate (ATP) requirements, maintenance, and kinetics. Assume no organic byproducts other than $\\mathrm{CO_{2}}$. \n\nStarting from the fundamental principles of atom conservation and redox conservation, treat electron conservation using the degree of reduction defined as the sum of atomic contributions: carbon contributes $+4$ per atom, hydrogen contributes $+1$ per atom, oxygen contributes $-2$ per atom, and nitrogen contributes $-3$ per atom. Use this to determine the theoretical upper bound, over all stoichiometrically feasible reactions of the form\n$$\n\\mathrm{C_{6}H_{12}O_{6}} + b\\,\\mathrm{NH_{3}} + c\\,\\mathrm{O_{2}} \\;\\longrightarrow\\; n\\,\\mathrm{CH_{1.8}O_{0.5}N_{0.2}} + m\\,\\mathrm{CO_{2}} + d\\,\\mathrm{H_{2}O},\n$$\non the fraction of glucose carbon that can be incorporated into biomass carbon. That fraction is defined as $f = \\frac{n}{6}$, since one mole of biomass empirical unit contains one carbon atom.\n\nCompute the maximal feasible value of $f$ implied by elemental and redox balance. Express your final answer as a decimal and round to four significant figures. No unit should be attached to the answer.", "solution": "The problem asks for the theoretical upper bound on the fraction of carbon from a glucose substrate that can be incorporated into cellular biomass. This is a problem of stoichiometric analysis, constrained by the conservation of elements and electrons.\n\nThe overall reaction is given as:\n$$\n\\mathrm{C_{6}H_{12}O_{6}} + b\\,\\mathrm{NH_{3}} + c\\,\\mathrm{O_{2}} \\;\\longrightarrow\\; n\\,\\mathrm{CH_{1.8}O_{0.5}N_{0.2}} + m\\,\\mathrm{CO_{2}} + d\\,\\mathrm{H_{2}O}\n$$\nwhere $b, c, n, m, d$ are the stoichiometric coefficients to be determined. The reaction is normalized to $1$ mole of glucose. The objective is to maximize the carbon incorporation fraction, $f = \\frac{n}{6}$.\n\nFirst, we establish the balance equations for each element: Carbon (C), Hydrogen (H), Oxygen (O), and Nitrogen (N).\n1.  **Carbon (C) Balance:** The number of carbon atoms from reactants must equal the number in products.\n    $$\n    6 \\times 1 = n \\times 1 + m \\times 1 \\implies 6 = n + m\n    $$\n2.  **Nitrogen (N) Balance:** Ammonia is the sole nitrogen source.\n    $$\n    b \\times 1 = n \\times 0.2 \\implies b = 0.2n\n    $$\n3.  **Hydrogen (H) Balance:**\n    $$\n    12 \\times 1 + b \\times 3 = n \\times 1.8 + d \\times 2 \\implies 12 + 3b = 1.8n + 2d\n    $$\n4.  **Oxygen (O) Balance:**\n    $$\n    6 \\times 1 + c \\times 2 = n \\times 0.5 + m \\times 2 + d \\times 1 \\implies 6 + 2c = 0.5n + 2m + d\n    $$\n\nThis system has $4$ linear equations and $5$ unknown coefficients ($b, c, n, m, d$), which means there is one degree of freedom.\n\nNext, we incorporate the principle of electron conservation (redox balance). The problem defines the degree of reduction, $\\gamma$, for each atom: C ($+4$), H ($+1$), O ($-2$), and N ($-3$). We calculate $\\gamma$ for each molecule in the reaction:\n-   Glucose ($\\mathrm{C_{6}H_{12}O_{6}}$): $\\gamma_{glc} = 6(+4) + 12(+1) + 6(-2) = 24 + 12 - 12 = 24$\n-   Ammonia ($\\mathrm{NH_{3}}$): $\\gamma_{amm} = 1(-3) + 3(+1) = 0$\n-   Dioxygen ($\\mathrm{O_{2}}$): $\\gamma_{O_2} = 2(-2) = -4$\n-   Biomass ($\\mathrm{CH_{1.8}O_{0.5}N_{0.2}}$): $\\gamma_{bio} = 1(+4) + 1.8(+1) + 0.5(-2) + 0.2(-3) = 4 + 1.8 - 1.0 - 0.6 = 4.2$\n-   Carbon Dioxide ($\\mathrm{CO_{2}}$): $\\gamma_{CO_2} = 1(+4) + 2(-2) = 0$\n-   Water ($\\mathrm{H_{2}O}$): $\\gamma_{H_2O} = 2(+1) + 1(-2) = 0$\n\nThe redox balance equation is obtained by conserving the total degree of reduction:\n$$\n1 \\cdot \\gamma_{glc} + b \\cdot \\gamma_{amm} + c \\cdot \\gamma_{O_2} = n \\cdot \\gamma_{bio} + m \\cdot \\gamma_{CO_2} + d \\cdot \\gamma_{H_2O}\n$$\nSubstituting the calculated values:\n$$\n1(24) + b(0) + c(-4) = n(4.2) + m(0) + d(0) \\implies 24 - 4c = 4.2n\n$$\nThis redox balance equation is not independent of the elemental balances; it is a linear combination of them. However, it provides a convenient relationship between the substrate, oxygen, and biomass.\n\nTo find the maximum value of $n$, we express all other coefficients in terms of $n$ using the balance equations.\nFrom the C balance: $m = 6 - n$.\nFrom the N balance: $b = 0.2n$.\nFrom the redox balance: $4c = 24 - 4.2n \\implies c = 6 - 1.05n$.\nSubstitute $b$ into the H balance to find $d$:\n$12 + 3(0.2n) = 1.8n + 2d$\n$12 + 0.6n = 1.8n + 2d$\n$12 = 1.2n + 2d \\implies d = 6 - 0.6n$.\n\nThe stoichiometric coefficients represent physical quantities and thus must be non-negative. This imposes constraints on the possible values of $n$.\n-   $n \\ge 0$: The amount of biomass produced must be non-negative.\n-   $m = 6 - n \\ge 0 \\implies n \\le 6$.\n-   $b = 0.2n \\ge 0 \\implies n \\ge 0$.\n-   $d = 6 - 0.6n \\ge 0 \\implies 0.6n \\le 6 \\implies n \\le 10$.\n-   $c = 6 - 1.05n \\ge 0 \\implies 1.05n \\le 6 \\implies n \\le \\frac{6}{1.05}$.\n\nLet's evaluate the constraint from $c$:\n$n \\le \\frac{6}{1.05} = \\frac{6}{21/20} = \\frac{6 \\times 20}{21} = \\frac{120}{21} = \\frac{40}{7}$.\nSo, $n \\le \\frac{40}{7} \\approx 5.714$.\n\nCombining all constraints on $n$:\n$0 \\le n \\le 6$\n$n \\le 10$\n$n \\le \\frac{40}{7}$\n\nThe most restrictive upper bound on $n$ is $n \\le \\frac{40}{7}$. Therefore, the maximum feasible value for $n$ is $n_{max} = \\frac{40}{7}$.\nThis maximum biomass yield occurs when $c=0$, which corresponds to the point where no oxygen is consumed. This represents the theoretical limit where carbon and electron fluxes are directed maximally towards biomass synthesis.\n\nThe question asks for the maximum fraction of glucose carbon incorporated into biomass, $f = \\frac{n}{6}$.\nThe maximum value of this fraction is:\n$$\nf_{max} = \\frac{n_{max}}{6} = \\frac{40/7}{6} = \\frac{40}{7 \\times 6} = \\frac{40}{42} = \\frac{20}{21}\n$$\nTo provide the final answer, we calculate the decimal value and round to four significant figures:\n$$\nf_{max} = \\frac{20}{21} \\approx 0.95238095...\n$$\nRounding to four significant figures gives $0.9524$.", "answer": "$$\\boxed{0.9524}$$", "id": "3292219"}, {"introduction": "With an understanding of fundamental stoichiometric limits, we can now move to network-level analysis using Flux Balance Analysis (FBA). This practice guides you through implementing an FBA problem and then introduces the powerful concept of shadow prices, the dual variables of the underlying linear program. By calculating and verifying these shadow prices, you will learn to quantify the marginal value of each nutrient to the cell's objective, translating abstract mathematical duality into a concrete measure of metabolic limitation [@problem_id:3292147].", "problem": "Consider the formulation of Flux Balance Analysis (FBA), defined as a linear optimization problem for a metabolic network under steady-state mass balance. Let there be a set of reactions with fluxes represented by the vector $v \\in \\mathbb{R}^n$, a stoichiometric matrix $S \\in \\mathbb{R}^{m \\times n}$, and a linear biological objective function $c^{\\top} v$ that encodes a growth-related reaction (biomass synthesis). The steady-state assumption implies the mass balance constraint $S v = 0$ for intracellular metabolites, and biophysically plausible constraints imply lower and upper bounds on fluxes $l \\leq v \\leq u$. The primal optimization problem is to maximize the linear objective $c^{\\top} v$ subject to $S v = 0$ and bounds $l \\leq v \\leq u$.\n\nUse the following scientifically consistent minimal network that links uptake of substrates to adenosine triphosphate (ATP) generation and biomass synthesis. The network comprises $5$ reactions and $3$ intracellular metabolites:\n\n- Reactions and fluxes:\n    1. Glucose uptake $v_1$ with bounds $0 \\leq v_1 \\leq U_{\\mathrm{glc}}$.\n    2. Glycolysis $v_2$ with bounds $0 \\leq v_2 \\leq +\\infty$.\n    3. Oxygen uptake $v_3$ with bounds $0 \\leq v_3 \\leq U_{\\mathrm{O_2}}$.\n    4. Respiration $v_4$ with bounds $0 \\leq v_4 \\leq +\\infty$.\n    5. Biomass (ATP sink) $v_5$ with bounds $0 \\leq v_5 \\leq +\\infty$ and coefficient $1$ in the objective $c^{\\top} v$.\n\n- Intracellular metabolites: glucose $G$, oxygen $O$, and adenosine triphosphate $ATP$.\n\n- Stoichiometric matrix $S$ with rows ordered as $\\{G, O, ATP\\}$ and columns ordered as $\\{v_1, v_2, v_3, v_4, v_5\\}$:\n$$\nS \\;=\\;\n\\begin{bmatrix}\n1 & -1 & 0 & -1 & 0 \\\\\n0 & 0 & 1 & -6 & 0 \\\\\n0 & 2 & 0 & 10 & -1\n\\end{bmatrix}.\n$$\n\nThis matrix encodes the following mass balances:\n- Glucose: $v_1 - v_2 - v_4 = 0$.\n- Oxygen: $v_3 - 6 v_4 = 0$.\n- ATP: $2 v_2 + 10 v_4 - v_5 = 0$.\n\nThe biological objective is to maximize the biomass flux $v_5$ under steady-state. All fluxes are expressed in millimoles per gram dry weight per hour, that is $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$. Your program must compute:\n1. The optimal objective value $v_5^\\star$ (biomass flux) in $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$.\n2. The shadow prices (Lagrange multipliers) associated with the upper bounds for glucose uptake $v_1 \\leq U_{\\mathrm{glc}}$ and oxygen uptake $v_3 \\leq U_{\\mathrm{O_2}}$, interpreted as the sensitivity $\\frac{\\partial v_5^\\star}{\\partial U_{\\mathrm{glc}}}$ and $\\frac{\\partial v_5^\\star}{\\partial U_{\\mathrm{O_2}}}$, respectively, in the maximization setting.\n3. A numerical verification of the shadow prices using a small finite difference perturbation of the corresponding upper bounds and recomputation of the optimal objective, to check whether the sensitivity equals the shadow price within a specified tolerance.\n\nBase your reasoning and computation on the following well-tested foundations:\n- The steady-state model $S v = 0$ embodying conservation of mass for intracellular metabolites.\n- The interpretation of Lagrange multipliers (shadow prices) from linear programming duality as objective sensitivities to right-hand side and bound parameters.\n- The envelope theorem for linear programs, which states that under regularity conditions the derivative of the optimal objective with respect to a parameter equals the associated optimal Lagrange multiplier.\n\nImplement a program that formulates and solves the primal linear program using a reliable solver, extracts the dual information (shadow prices) for the upper bounds, converts it appropriately to the maximization convention, and verifies the sensitivities via finite differences.\n\nUse the following test suite of upper bound parameters $\\left(U_{\\mathrm{glc}}, U_{\\mathrm{O_2}}\\right)$, all in $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$:\n- Test case A (balanced, both bounds potentially active): $\\left(10, 15\\right)$.\n- Test case B (oxygen non-limiting): $\\left(10, 60\\right)$.\n- Test case C (strictly anaerobic): $\\left(2, 0\\right)$.\n- Test case D (no carbon): $\\left(0, 100\\right)$.\n\nFor each test case, your program must compute:\n- $v_5^\\star$ as a float in $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$.\n- The shadow price for the glucose upper bound $\\frac{\\partial v_5^\\star}{\\partial U_{\\mathrm{glc}}}$ as a float.\n- The shadow price for the oxygen upper bound $\\frac{\\partial v_5^\\star}{\\partial U_{\\mathrm{O_2}}}$ as a float.\n- A boolean indicating whether the finite difference sensitivity for glucose matches the corresponding shadow price within an absolute tolerance of $\\varepsilon_{\\mathrm{tol}} = 10^{-6}$.\n- A boolean indicating whether the finite difference sensitivity for oxygen matches the corresponding shadow price within an absolute tolerance of $\\varepsilon_{\\mathrm{tol}} = 10^{-6}$.\n\nUse a finite difference step of $\\delta = 10^{-4}$ for the perturbations of $U_{\\mathrm{glc}}$ and $U_{\\mathrm{O_2}}$. The numerical solver should handle the bounds $[0, +\\infty)$ by representing the upper bound as unbounded where appropriate. Explicitly, express all fluxes and sensitivities in $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$.\n\nFinal output format specification:\n- Your program should produce a single line of output containing the results aggregated across the four test cases, flattened into a single comma-separated list enclosed in square brackets. The order per test case must be exactly:\n    1. $v_5^\\star$\n    2. Shadow price for $U_{\\mathrm{glc}}$\n    3. Shadow price for $U_{\\mathrm{O_2}}$\n    4. Finite difference check for glucose (boolean)\n    5. Finite difference check for oxygen (boolean)\n- With four test cases, this yields a list of $20$ entries. For example, the output should have the syntactic form $[r_1,r_2,\\dots,r_{20}]$ with floats and booleans only, no units or additional text.", "solution": "The problem requires the formulation and solution of a Flux Balance Analysis (FBA) problem for a minimal metabolic network, computation of shadow prices for substrate uptake, and their numerical verification. The problem is scientifically and mathematically well-posed, providing all necessary information for a unique solution. We proceed with a step-by-step derivation and computational strategy.\n\n**1. Formulation of the Linear Program**\n\nFlux Balance Analysis (FBA) models metabolic networks at steady state using a linear program. The core of the problem is to optimize a biological objective function, typically biomass production, subject to mass balance and biophysical constraints.\n\nLet the vector of reaction fluxes be $v = [v_1, v_2, v_3, v_4, v_5]^{\\top} \\in \\mathbb{R}^5$. The objective is to maximize the biomass flux, $v_5$. This is equivalent to maximizing the linear function $c^{\\top}v$, where the objective vector is $c = [0, 0, 0, 0, 1]^{\\top}$.\n\nThe constraints are:\na) **Steady-State Mass Balance**: The net production of each intracellular metabolite must be zero. This is expressed as a system of linear equations $S v = 0$, where $S$ is the stoichiometric matrix.\n$$\nS v = \\begin{bmatrix}\n1 & -1 & 0 & -1 & 0 \\\\\n0 & 0 & 1 & -6 & 0 \\\\\n0 & 2 & 0 & 10 & -1\n\\end{bmatrix}\n\\begin{bmatrix}\nv_1 \\\\ v_2 \\\\ v_3 \\\\ v_4 \\\\ v_5\n\\end{bmatrix}\n=\n\\begin{bmatrix}\n0 \\\\ 0 \\\\ 0\n\\end{bmatrix}\n$$\nb) **Flux Bounds**: Each flux $v_i$ is constrained by lower and upper bounds, $l_i \\le v_i \\le u_i$. Based on the problem description, these are:\n- $0 \\le v_1 \\le U_{\\mathrm{glc}}$\n- $0 \\le v_2 \\le +\\infty$\n- $0 \\le v_3 \\le U_{\\mathrm{O_2}}$\n- $0 \\le v_4 \\le +\\infty$\n- $0 \\le v_5 \\le +\\infty$\n\nThe complete primal linear program (LP) is:\n$$\n\\begin{array}{ll}\n\\text{maximize} & v_5 \\\\\n\\text{subject to} & S v = 0 \\\\\n& 0 \\le v_1 \\le U_{\\mathrm{glc}} \\\\\n& 0 \\le v_3 \\le U_{\\mathrm{O_2}} \\\\\n& v_2, v_4, v_5 \\ge 0\n\\end{array}\n$$\n\n**2. Solving the Primal LP using a Numerical Solver**\n\nStandard numerical solvers, such as `scipy.optimize.linprog`, are typically formulated as minimization problems. To maximize $v_5$, we can minimize $-v_5$. The objective function for the solver is thus to minimize $c_{\\text{obj}}^{\\top} v$, with $c_{\\text{obj}} = [0, 0, 0, 0, -1]^{\\top}$.\n\nThe parameters for `scipy.optimize.linprog` are:\n- `c`: The objective vector to be minimized, $c_{\\text{obj}} = [0, 0, 0, 0, -1]^{\\top}$.\n- `A_eq`: The matrix for equality constraints, which is the stoichiometric matrix $S$.\n- `b_eq`: The right-hand side for equality constraints, which is a zero vector of size $m=3$.\n- `bounds`: A sequence of `(min, max)` pairs for each flux variable. For an unbounded upper limit, `None` is used.\n    - $v_1$: $(0, U_{\\mathrm{glc}})$\n    - $v_2$: $(0, \\text{None})$\n    - $v_3$: $(0, U_{\\mathrm{O_2}})$\n    - $v_4$: $(0, \\text{None})$\n    - $v_5$: $(0, \\text{None})$\n\nSolving this LP yields the optimal flux vector $v^\\star$, from which the optimal biomass flux $v_5^\\star$ is obtained. The maximum value of $v_5$ is the negative of the minimum value returned by the solver (i.e., $-(\\text{res.fun}))$.\n\n**3. Duality, Shadow Prices, and Sensitivity Analysis**\n\nIn linear programming, the dual problem provides valuable economic interpretations. The dual variables, also known as Lagrange multipliers or shadow prices, measure the sensitivity of the optimal objective value to changes in the constraints.\n\nWe are interested in the sensitivity of the optimal biomass $v_5^\\star$ with respect to the upper bounds on glucose ($U_{\\mathrm{glc}}$) and oxygen ($U_{\\mathrm{O_2}}$) uptake. These are the shadow prices associated with the constraints $v_1 \\le U_{\\mathrm{glc}}$ and $v_3 \\le U_{\\mathrm{O_2}}$.\n\nLet the optimal value of the minimization problem be $Z_{\\text{min}} = -v_5^\\star$. The shadow price (marginal) for an upper bound constraint $v_i \\le u_i$, as returned by `scipy.optimize.linprog` (e.g., via `res.upper.marginals`), represents the rate of change of the objective function $Z_{\\text{min}}$ with respect to an increase in the bound $u_i$. That is, $\\mu_{u_i} = \\frac{\\partial Z_{\\text{min}}}{\\partial u_i}$.\n\nSince we are interested in the sensitivity of the maximization objective $v_5^\\star$, we have:\n$$\n\\frac{\\partial v_5^\\star}{\\partial u_i} = \\frac{\\partial (-Z_{\\text{min}})}{\\partial u_i} = - \\frac{\\partial Z_{\\text{min}}}{\\partial u_i} = -\\mu_{u_i}\n$$\nTherefore, the shadow price for the glucose upper bound is the negative of the marginal returned by the solver for the upper bound on $v_1$. Similarly for oxygen and $v_3$.\n- $\\frac{\\partial v_5^\\star}{\\partial U_{\\mathrm{glc}}} = -(\\text{res.upper.marginals}[0])$\n- $\\frac{\\partial v_5^\\star}{\\partial U_{\\mathrm{O_2}}} = -(\\text{res.upper.marginals}[2])$\n\nThis relationship is guaranteed by the Envelope Theorem for linear programs under regularity conditions (i.e., when the dual solution is unique).\n\n**4. Numerical Verification via Finite Differences**\n\nTo numerically verify the shadow prices, we can approximate the derivative using a forward finite difference formula. For a small perturbation $\\delta > 0$:\n$$\n\\frac{\\partial v_5^\\star}{\\partial U_{\\mathrm{glc}}} \\approx \\frac{v_5^\\star(U_{\\mathrm{glc}} + \\delta, U_{\\mathrm{O_2}}) - v_5^\\star(U_{\\mathrm{glc}}, U_{\\mathrm{O_2}})}{\\delta}\n$$\n$$\n\\frac{\\partial v_5^\\star}{\\partial U_{\\mathrm{O_2}}} \\approx \\frac{v_5^\\star(U_{\\mathrm{glc}}, U_{\\mathrm{O_2}} + \\delta) - v_5^\\star(U_{\\mathrm{glc}}, U_{\\mathrm{O_2}})}{\\delta}\n$$\nThe computational procedure involves:\n1. Solve the LP for the base parameters $(U_{\\mathrm{glc}}, U_{\\mathrm{O_2}})$ to get $v_5^\\star$ and the shadow prices.\n2. Solve the LP with a perturbed glucose bound $(U_{\\mathrm{glc}} + \\delta, U_{\\mathrm{O_2}})$ to get a new optimal value $v_{5, \\text{pert_glc}}^\\star$.\n3. Solve the LP with a perturbed oxygen bound $(U_{\\mathrm{glc}}, U_{\\mathrm{O_2}} + \\delta)$ to get a new optimal value $v_{5, \\text{pert_o2}}^\\star$.\n4. Calculate the finite difference approximations for the sensitivities.\n5. Compare the calculated shadow prices with their corresponding finite difference approximations within a given tolerance $\\varepsilon_{\\mathrm{tol}}$.\n\nIf the optimal solution is at a point where the objective function's gradient with respect to the parameters is not continuous (a \"kink\"), the shadow price (a dual variable) and the finite difference (a one-sided derivative) might not match. This is not an error but a fundamental property of non-smooth optimization, and our boolean check will correctly capture this discrepancy.\n\nThe following program implements this logic for each of the specified test cases.", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves the FBA problem for a minimal metabolic network across several test cases,\n    computes optimal biomass flux and shadow prices for substrate uptake, and verifies\n    the shadow prices using finite differences.\n    \"\"\"\n\n    # Stoichiometric matrix S (rows: G, O, ATP; cols: v1-v5)\n    S = np.array([\n        [1, -1, 0, -1, 0],\n        [0, 0, 1, -6, 0],\n        [0, 2, 0, 10, -1]\n    ])\n\n    # Objective: maximize v5, which is equivalent to minimizing -v5\n    c_obj = np.array([0, 0, 0, 0, -1])\n\n    # Steady-state constraint Sv = 0\n    b_eq = np.zeros(S.shape[0])\n\n    # Test suite of upper bounds (U_glc, U_O2)\n    test_cases = [\n        (10, 15),    # Case A: Balanced\n        (10, 60),    # Case B: Oxygen non-limiting\n        (2, 0),      # Case C: Strictly anaerobic\n        (0, 100),    # Case D: No carbon\n    ]\n    \n    # Numerical parameters\n    delta = 1e-4  # Finite difference step\n    tol = 1e-6    # Absolute tolerance for verification\n\n    results = []\n\n    def run_fba(U_glc, U_o2):\n        \"\"\"\n        Helper function to set up and solve the LP for given uptake bounds.\n        Returns optimal biomass flux and shadow prices for uptake bounds.\n        \"\"\"\n        bounds = [\n            (0, U_glc),    # v1: Glucose uptake\n            (0, None),     # v2: Glycolysis\n            (0, U_o2),     # v3: Oxygen uptake\n            (0, None),     # v4: Respiration\n            (0, None)      # v5: Biomass (ATP sink)\n        ]\n\n        # Use 'highs' method for robustness and access to duals\n        res = linprog(c=c_obj, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs')\n\n        if not res.success:\n            # Handle cases with no feasible solution, e.g., negative bounds not used here.\n            return 0.0, 0.0, 0.0\n\n        # Optimal objective value (biomass flux)\n        # res.fun is the minimum of -v5, so -res.fun is the maximum of v5\n        v5_star = -res.fun\n\n        # Shadow prices (sensitivities) for the maximization problem\n        # The marginals from scipy are for the minimization problem.\n        # sensitivity = -marginal, as derived in the solution text.\n        sp_glc = -res.upper.marginals[0] if res.upper.marginals is not None else 0.0\n        sp_o2 = -res.upper.marginals[2] if res.upper.marginals is not None else 0.0\n        \n        return v5_star, sp_glc, sp_o2\n\n    for U_glc_base, U_o2_base in test_cases:\n        # 1. Solve for the base case\n        v5_base, sp_glc_base, sp_o2_base = run_fba(U_glc_base, U_o2_base)\n\n        # 2. Solve for perturbed glucose uptake\n        v5_pert_glc, _, _ = run_fba(U_glc_base + delta, U_o2_base)\n        \n        # 3. Solve for perturbed oxygen uptake\n        v5_pert_o2, _, _ = run_fba(U_glc_base, U_o2_base + delta)\n\n        # 4. Calculate finite difference sensitivities\n        fd_sens_glc = (v5_pert_glc - v5_base) / delta\n        fd_sens_o2 = (v5_pert_o2 - v5_base) / delta\n        \n        # 5. Verify shadow prices against finite difference sensitivities\n        check_glc = np.isclose(sp_glc_base, fd_sens_glc, atol=tol)\n        check_o2 = np.isclose(sp_o2_base, fd_sens_o2, atol=tol)\n\n        # Append results for this test case\n        results.extend([\n            v5_base,\n            sp_glc_base,\n            sp_o2_base,\n            bool(check_glc),\n            bool(check_o2)\n        ])\n\n    # Format and print the final aggregated results\n    # Use a custom formatter to handle boolean capitalization\n    def format_item(item):\n        if isinstance(item, bool):\n            return str(item).lower()\n        if isinstance(item, float):\n            return f\"{item:.8f}\" # Use sufficient precision for floats\n        return str(item)\n\n    print(f\"[{','.join(map(format_item, results))}]\")\n\nsolve()\n```", "id": "3292147"}, {"introduction": "Real cellular objectives are not static; they adapt to environmental conditions. This advanced practice demonstrates how the objective function in FBA can be flexibly defined to model these adaptive strategies, moving beyond simple growth maximization. You will implement a series of optimizations to contrast the goals of rapid proliferation in minimal media with resource efficiency and product synthesis in rich media, exploring the fundamental trade-offs that shape cellular metabolism [@problem_id:3292204].", "problem": "Consider a toy, but scientifically consistent, metabolic network used in Flux Balance Analysis (FBA) for a single-cell organism growing in either minimal or rich media. The aim is to compare objective functions appropriate for minimal media (maximize growth) versus rich media (optimize resource usage or production while maintaining growth). Use the following foundational bases: mass conservation at steady state, stoichiometric constraints, and linear programming for computing optimal flux distributions. The steady-state assumption implies that the net production rate of each internal metabolite is zero.\n\nLet the internal metabolites be $C$ (carbon pool), $O$ (oxygen), $N$ (nitrogen), $A$ (adenosine triphosphate, ATP), and $W$ (waste). Define the flux vector $v \\in \\mathbb{R}^8$ with components:\n- $v_1$: carbon uptake,\n- $v_2$: oxygen uptake,\n- $v_3$: nitrogen uptake,\n- $v_4$: aerobic catabolism (respiration),\n- $v_5$: anaerobic catabolism (fermentation),\n- $v_6$: biomass synthesis (biological growth objective flux),\n- $v_7$: product synthesis (production objective flux),\n- $v_8$: waste export.\n\nThe stoichiometric matrix $S \\in \\mathbb{R}^{5 \\times 8}$ enforces $S v = 0$ for steady-state mass balance of internal metabolites, with rows ordered as $(C,O,N,A,W)$ and columns ordered as $(v_1,\\dots,v_8)$:\n$$\nS \\;=\\;\n\\begin{bmatrix}\n+1 & 0 & 0 & -1 & -1 & -1 & -2 & 0 \\\\\n0 & +1 & 0 & -1 & 0 & 0 & 0 & 0 \\\\\n0 & 0 & +1 & 0 & 0 & -1 & 0 & 0 \\\\\n0 & 0 & 0 & +4 & +1 & -2 & -1 & 0 \\\\\n0 & 0 & 0 & +1 & +1 & 0 & 0 & -1 \\\\\n\\end{bmatrix}.\n$$\n\nAll fluxes are constrained to be nonnegative and have upper bounds as follows:\n- Uptake bounds: $0 \\le v_1 \\le C_{\\text{max}}$, $0 \\le v_2 \\le O_{\\text{max}}$, $0 \\le v_3 \\le N_{\\text{max}}$,\n- Internal reaction bounds: $0 \\le v_j \\le 1000$ for $j \\in \\{4,5,6,7,8\\}$.\n\nThis network structure captures the following biophysical statements:\n- Aerobic catabolism consumes $C$ and $O$ to yield $A$ and $W$ (here, $4$ units of $A$ per unit $C$ and $O$), represented by $v_4$ with stoichiometry $-C - O + 4A + W$.\n- Fermentation consumes $C$ to yield $A$ and $W$ (here, $1$ unit of $A$ per unit $C$), represented by $v_5$ with stoichiometry $-C + A + W$.\n- Biomass synthesis consumes $C$, $N$, and $A$ (here, $1C + 1N + 2A$ per unit biomass) and drains these internal pools, represented by $v_6$ with stoichiometry $-C - N - 2A$.\n- Product synthesis consumes $C$ and $A$ (here, $2C + 1A$ per unit product) and drains these internal pools, represented by $v_7$ with stoichiometry $-2C - A$.\n- Waste export drains $W$, represented by $v_8$ with stoichiometry $-W$.\n\nDefine the biological objective functions:\n- Minimal media objective: maximize growth by maximizing $v_6$ subject to $S v = 0$ and flux bounds.\n- Rich media objective variant A (resource optimization): for a target growth level $v_6 \\ge \\alpha \\cdot v_6^{\\max}$, minimize carbon uptake $v_1$ subject to $S v = 0$ and flux bounds.\n- Rich media objective variant B (production with viability): maximize product synthesis $v_7$ subject to $v_6 \\ge \\beta \\cdot v_6^{\\max}$, $S v = 0$, and flux bounds.\n\nHere, $v_6^{\\max}$ denotes the optimal value of $v_6$ in the minimal media objective under the same uptake bounds. All fluxes should be reported in the unit mmol per gram dry weight per hour (mmol/(gDW·h)).\n\nYour task is to implement a program that, for each test case in the suite below, computes and returns a list containing three floats:\n- The maximal growth rate $v_6^{\\max}$,\n- The minimal carbon uptake $v_1$ required to achieve at least $\\alpha \\cdot v_6^{\\max}$ growth,\n- The maximal product formation rate $v_7$ achievable while maintaining $v_6 \\ge \\beta \\cdot v_6^{\\max}$.\n\nTest suite (each case is $(C_{\\text{max}}, O_{\\text{max}}, N_{\\text{max}}, \\alpha, \\beta)$):\n1. $(10, 15, 5, 0.9, 0.2)$: a minimal media case with ample oxygen and nitrogen relative to carbon.\n2. $(100, 100, 100, 0.9, 0.2)$: a rich media case with abundant resources.\n3. $(10, 0, 5, 0.9, 0.2)$: an oxygen-limited case (anaerobic boundary).\n4. $(4, 100, 100, 0.9, 0.2)$: a carbon-limited case under otherwise rich conditions.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to a test case and is itself a list of the three computed floats in the order specified above. For example, the output should look like $[\\,[v_{6,\\text{case1}}^{\\max}, v_{1,\\text{case1}}^{\\min}, v_{7,\\text{case1}}^{\\max}],\\,[v_{6,\\text{case2}}^{\\max}, \\dots],\\,\\dots\\,]$. All reported values must be in mmol/(gDW·h).", "solution": "The problem presented is a valid, well-posed, and scientifically grounded application of Flux Balance Analysis (FBA). It requires the solution of a series of Linear Programming (LP) problems to determine optimal metabolic flux distributions under different biological objectives and environmental conditions. The stoichiometric matrix $S$, flux bounds, and objective functions are clearly defined, and there are no internal contradictions or violations of scientific principles.\n\nThe core of the methodology is to translate biological hypotheses about cellular objectives into mathematical optimization problems. The cell's metabolic network is modeled as a system of linear equations under a steady-state assumption, $S v = 0$, where $S$ is the stoichiometric matrix and $v$ is the vector of metabolic fluxes. The system is typically underdetermined, leading to a space of feasible flux distributions. FBA identifies a single, optimal flux distribution from this space by maximizing or minimizing a given linear objective function, $Z = c^T v$, subject to the steady-state constraint and physicochemical constraints on individual fluxes (e.g., thermodynamic irreversibility and nutrient availability), expressed as bounds $v_{lb} \\le v \\le v_{ub}$.\n\nFor each test case, defined by a tuple of uptake bounds and objective parameters $(C_{\\max}, O_{\\max}, N_{\\max}, \\alpha, \\beta)$, a three-step computational procedure is executed.\n\n1.  **Maximization of Growth Rate ($v_6^{\\max}$)**: The first step is to determine the maximum possible biomass production rate, represented by the flux $v_6$. This is a canonical FBA problem, often used to simulate growth in a minimal medium where the organism's primary objective is to proliferate as fast as possible. This is formulated as the following LP problem:\n    $$\n    \\begin{array}{ll}\n    \\text{maximize} & Z_1 = v_6 \\\\\n    \\text{subject to} & S v = 0 \\\\\n    & 0 \\le v_1 \\le C_{\\max} \\\\\n    & 0 \\le v_2 \\le O_{\\max} \\\\\n    & 0 \\le v_3 \\le N_{\\max} \\\\\n    & 0 \\le v_j \\le 1000 \\quad \\text{for } j \\in \\{4, 5, 6, 7, 8\\}\n    \\end{array}\n    $$\n    This is equivalent to minimizing $-v_6$, so the objective vector $c$ is $[0, 0, 0, 0, 0, -1, 0, 0]^T$. The solution to this problem yields the maximal growth rate, $v_6^{\\max}$.\n\n2.  **Minimization of Carbon Uptake for Sub-Maximal Growth**: The second step models a scenario where the cell aims to be resource-efficient, relevant in rich media. It computes the minimum carbon uptake, $v_1$, required to sustain a growth rate of at least a certain fraction $\\alpha$ of the theoretical maximum. The constraint $v_6 \\ge \\alpha \\cdot v_6^{\\max}$ is added to the model. This is formulated as a new LP problem:\n    $$\n    \\begin{array}{ll}\n    \\text{minimize} & Z_2 = v_1 \\\\\n    \\text{subject to} & S v = 0 \\\\\n    & v_6 \\ge \\alpha \\cdot v_6^{\\max} \\\\\n    & \\text{and all original flux bounds.}\n    \\end{array}\n    $$\n    The objective vector $c$ for this minimization problem is $[1, 0, 0, 0, 0, 0, 0, 0]^T$. The new constraint on $v_6$ is handled by adjusting its lower bound.\n\n3.  **Maximization of Product Synthesis with Guaranteed Viability**: The third step models a bioengineering objective: maximizing the synthesis of a valuable product ($v_7$) while ensuring the cell remains viable. Viability is defined as maintaining a growth rate of at least a fraction $\\beta$ of the maximum, i.e., $v_6 \\ge \\beta \\cdot v_6^{\\max}$. This trade-off between growth and production is a classic problem in metabolic engineering. The LP formulation is:\n    $$\n    \\begin{array}{ll}\n    \\text{maximize} & Z_3 = v_7 \\\\\n    \\text{subject to} & S v = 0 \\\\\n    & v_6 \\ge \\beta \\cdot v_6^{\\max} \\\\\n    & \\text{and all original flux bounds.}\n    \\end{array}\n    $$\n    To solve this maximization problem, we minimize $-v_7$, setting the objective vector $c$ to $[0, 0, 0, 0, 0, 0, -1, 0]^T$.\n\nThis sequence of optimizations is systematically applied to each test case. The implementation uses the `linprog` function from the `scipy.optimize` library, a robust tool for solving linear programming problems. The stoichiometric matrix $S$ is represented as the equality constraint matrix `A_eq`, with the corresponding `b_eq` vector being all zeros. The flux bounds, including the dynamically adjusted bounds for $v_6$, are passed via the `bounds` argument. The results from each of the three steps are collected for each test case and formatted into the specified output structure.", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves a series of Flux Balance Analysis (FBA) problems for a toy metabolic network.\n\n    For each test case, the function performs a three-step optimization:\n    1. Maximizes the biomass flux (v6) to find the theoretical maximum growth rate.\n    2. Minimizes carbon uptake (v1) while maintaining growth at a certain percentage of the maximum.\n    3. Maximizes product synthesis (v7) while maintaining a baseline viability growth rate.\n    \"\"\"\n\n    # The stoichiometric matrix S, where rows correspond to metabolites (C, O, N, A, W)\n    # and columns correspond to fluxes (v1 to v8).\n    S = np.array([\n        [1, 0, 0, -1, -1, -1, -2, 0],  # C: Carbon balance\n        [0, 1, 0, -1,  0,  0,  0, 0],  # O: Oxygen balance\n        [0, 0, 1,  0,  0, -1,  0, 0],  # N: Nitrogen balance\n        [0, 0, 0,  4,  1, -2, -1, 0],  # A: ATP balance\n        [0, 0, 0,  1,  1,  0,  0, -1]   # W: Waste balance\n    ], dtype=float)\n\n    # The steady-state condition Sv = 0 implies the right-hand side is a vector of zeros.\n    b_eq = np.zeros(S.shape[0])\n\n    # Upper bound for internal reaction fluxes.\n    v_internal_max = 1000.0\n\n    # Test suite: (C_max, O_max, N_max, alpha, beta)\n    test_cases = [\n        (10.0, 15.0, 5.0, 0.9, 0.2),   # Minimal media, N-limited\n        (100.0, 100.0, 100.0, 0.9, 0.2), # Rich media\n        (10.0, 0.0, 5.0, 0.9, 0.2),     # Anaerobic, C-limited\n        (4.0, 100.0, 100.0, 0.9, 0.2)      # Carbon-limited\n    ]\n\n    all_results_formatted = []\n\n    for case in test_cases:\n        C_max, O_max, N_max, alpha, beta = case\n\n        # --- Step 1: Maximize growth rate (v6) ---\n        # Objective function to maximize v6 is equivalent to minimizing -v6.\n        c_v6_max = np.array([0, 0, 0, 0, 0, -1, 0, 0], dtype=float)\n        \n        # Base flux bounds for this test case.\n        bounds_base = [\n            (0, C_max), (0, O_max), (0, N_max),\n            (0, v_internal_max), (0, v_internal_max), (0, v_internal_max),\n            (0, v_internal_max), (0, v_internal_max)\n        ]\n        \n        res1 = linprog(c_v6_max, A_eq=S, b_eq=b_eq, bounds=bounds_base, method='highs')\n        \n        v6_max = res1.x[5] if res1.success else 0.0\n\n        # --- Step 2: Minimize carbon uptake (v1) for a target growth rate ---\n        # Objective function to minimize v1.\n        c_v1_min = np.array([1, 0, 0, 0, 0, 0, 0, 0], dtype=float)\n        \n        # New constraint: v6 >= alpha * v6_max\n        v6_min_for_v1_opt = alpha * v6_max\n        bounds_for_v1_opt = list(bounds_base)\n        bounds_for_v1_opt[5] = (v6_min_for_v1_opt, v_internal_max)\n        \n        res2 = linprog(c_v1_min, A_eq=S, b_eq=b_eq, bounds=bounds_for_v1_opt, method='highs')\n        \n        v1_min = res2.x[0] if res2.success else float('nan')\n\n        # --- Step 3: Maximize product synthesis (v7) for a viability growth rate ---\n        # Objective function to maximize v7 is equivalent to minimizing -v7.\n        c_v7_max = np.array([0, 0, 0, 0, 0, 0, -1, 0], dtype=float)\n\n        # New constraint: v6 >= beta * v6_max\n        v6_min_for_v7_opt = beta * v6_max\n        bounds_for_v7_opt = list(bounds_base)\n        bounds_for_v7_opt[5] = (v6_min_for_v7_opt, v_internal_max)\n\n        res3 = linprog(c_v7_max, A_eq=S, b_eq=b_eq, bounds=bounds_for_v7_opt, method='highs')\n        \n        v7_max = res3.x[6] if res3.success else 0.0\n\n        # Collect results for the current case.\n        case_results = [v6_max, v1_min, v7_max]\n        \n        # Format the results for this case into the required string format '[f1,f2,f3]'.\n        # Using map and join avoids extra spaces from `str(list)`.\n        formatted_case_str = f\"[{','.join(map(str, case_results))}]\"\n        all_results_formatted.append(formatted_case_str)\n\n    # Print the final output in the format [[...],[...],...]\n    print(f\"[{','.join(all_results_formatted)}]\")\n\nsolve()\n```", "id": "3292204"}]}