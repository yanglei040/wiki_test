{"hands_on_practices": [{"introduction": "To build a strong foundation, we will start with a small, conceptual metabolic network that allows for a \"pen-and-paper\" solution. This exercise will guide you through analytically deriving the optimal biomass yield and then performing Flux Variability Analysis (FVA) to discover the range of alternative flux values that are all consistent with this maximum yield ([@problem_id:3309703]). This practice is invaluable for developing a first-principles understanding of how mass balance and capacity constraints create a space of equally optimal solutions.", "problem": "You are given a toy metabolic network designed to expose alternative optimal solutions under flux balance analysis (FBA) and to permit an analytical flux variability analysis (FVA). The network contains internal metabolites $S$, $A$, $C$, and $B$, and a biomass sink $X$. Fluxes are measured in millimoles per gram dry weight per hour (mmol gDW$^{-1}$ h$^{-1}$). Assume steady state for all internal metabolites and that all reactions are irreversible.\n\nReactions (all fluxes $v_i \\geq 0$):\n- $v_1$: $\\varnothing \\rightarrow S$, with bound $0 \\leq v_1 \\leq 10$.\n- $v_2$: $S \\rightarrow A$, with bound $0 \\leq v_2$ (no finite upper bound).\n- $v_3$: $A \\rightarrow B$, with bound $0 \\leq v_3 \\leq 8$.\n- $v_4$: $S \\rightarrow C$, with bound $0 \\leq v_4$ (no finite upper bound).\n- $v_5$: $C \\rightarrow B$, with bound $0 \\leq v_5 \\leq 8$.\n- $v_6$: $B \\rightarrow X$ (biomass formation), with bound $0 \\leq v_6$ (no finite upper bound).\n- $v_7$: $A \\rightarrow \\varnothing$ (waste), with bound $0 \\leq v_7$ (no finite upper bound).\n- $v_8$: $C \\rightarrow \\varnothing$ (waste), with bound $0 \\leq v_8$ (no finite upper bound).\n\nAdopt the standard steady-state mass balance for internal metabolites, formalized as $S v = 0$, where $S$ is the stoichiometric matrix and $v$ is the vector of reaction fluxes, together with the given bounds. The FBA problem is to maximize the linear objective $c^\\top v$ with $c$ selecting biomass formation, i.e., $c^\\top v = v_6$.\n\nTask:\n1. Using only the fundamental definitions above (steady state, linear bounds, and linear objective), derive the optimal biomass value $z^{\\star}$ under FBA.\n2. Then, perform analytical flux variability analysis (FVA) for reaction $v_3$ at the optimal biomass level, i.e., minimize $v_3$ subject to the steady-state constraints, the reaction bounds, and the additional optimality constraint $v_6 = z^{\\star}$.\n3. Report the minimum feasible value of $v_3$ at optimal biomass. Provide the numerical value only (do not include units), and do not round; give the exact value.", "solution": "The problem is first subjected to a rigorous validation process.\n\n### Step 1: Extract Givens\n- **Internal Metabolites:** $S, A, C, B$\n- **External Metabolites:** $\\varnothing$ (source/sink), $X$ (biomass)\n- **Reactions and Fluxes ($v_i$):**\n  - $v_1$: $\\varnothing \\rightarrow S$\n  - $v_2$: $S \\rightarrow A$\n  - $v_3$: $A \\rightarrow B$\n  - $v_4$: $S \\rightarrow C$\n  - $v_5$: $C \\rightarrow B$\n  - $v_6$: $B \\rightarrow X$ (biomass formation)\n  - $v_7$: $A \\rightarrow \\varnothing$ (waste)\n  - $v_8$: $C \\rightarrow \\varnothing$ (waste)\n- **Flux Bounds:**\n  - All fluxes are irreversible: $v_i \\geq 0$ for all $i \\in \\{1, ..., 8\\}$.\n  - $0 \\leq v_1 \\leq 10$\n  - $0 \\leq v_3 \\leq 8$\n  - $0 \\leq v_5 \\leq 8$\n  - $v_2, v_4, v_6, v_7, v_8$ have no finite upper bounds, only $v_i \\geq 0$.\n- **Constraint:** Steady state for all internal metabolites, leading to the mass balance equation $S v = 0$.\n- **Objective Function:** Maximize the biomass formation flux, $v_6$.\n- **Task:**\n  1. Find the optimal biomass value, $z^{\\star} = \\max(v_6)$.\n  2. Perform flux variability analysis (FVA) for $v_3$ by finding the minimum feasible value of $v_3$ subject to the additional constraint $v_6 = z^{\\star}$.\n  3. Report the minimum value of $v_3$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded:** The problem is a standard application of flux balance analysis (FBA) and flux variability analysis (FVA), which are core, well-established methods in computational systems biology and metabolic engineering. The Toy network is a common pedagogical tool. The problem is scientifically sound.\n- **Well-Posed:** The problem is formulated as a linear program (LP), which is known to be well-posed. The constraints are linear, and the objective is a linear function of the variables. The feasible region is a convex polytope, and a solution is guaranteed to exist.\n- **Objective:** The problem is stated using precise mathematical and biological terminology. There are no subjective or ambiguous statements. All terms are standard in the field.\n- **Completeness and Consistency:** All necessary information (reactions, bounds, objective) is provided. There are no contradictions in the given data. The problem is self-contained.\n\n### Step 3: Verdict and Action\nThe problem is deemed valid. It is a well-posed, scientifically grounded, and objective problem within the specified domain. I will now proceed with a full, reasoned solution.\n\n### Solution\n\nThe first step is to establish the mathematical formulation of the problem. At steady state, the production rate of each internal metabolite must equal its consumption rate. This gives a system of linear equations, represented as $S v = 0$, where $S$ is the stoichiometric matrix and $v$ is the vector of fluxes.\n\nFor the given network, the mass balance equations for the internal metabolites $S$, $A$, $C$, and $B$ are:\n1. For metabolite $S$: $v_1 - v_2 - v_4 = 0 \\implies v_1 = v_2 + v_4$\n2. For metabolite $A$: $v_2 - v_3 - v_7 = 0 \\implies v_2 = v_3 + v_7$\n3. For metabolite $C$: $v_4 - v_5 - v_8 = 0 \\implies v_4 = v_5 + v_8$\n4. For metabolite $B$: $v_3 + v_5 - v_6 = 0 \\implies v_6 = v_3 + v_5$\n\nThe problem is subject to the irreversibility constraints $v_i \\geq 0$ for all $i$, and the specific bounds: $0 \\leq v_1 \\leq 10$, $0 \\leq v_3 \\leq 8$, and $0 \\leq v_5 \\leq 8$.\n\n**Part 1: Derivation of the Optimal Biomass Value ($z^{\\star}$)**\n\nThe objective of Flux Balance Analysis (FBA) is to maximize the biomass flux, $v_6$.\nFrom equation (4), the objective function is $v_6 = v_3 + v_5$. We need to maximize this sum.\n\nLet's express the objective function in terms of the system's input flux, $v_1$. We can substitute the expressions for $v_2$ and $v_4$ from equations (2) and (3) into equation (1):\n$v_1 = (v_3 + v_7) + (v_5 + v_8)$\n\nRearranging the terms:\n$v_1 = (v_3 + v_5) + (v_7 + v_8)$\n\nNow,substituting $v_6 = v_3 + v_5$:\n$v_1 = v_6 + v_7 + v_8$\n\nThis equation can be rearranged to express the objective $v_6$ in terms of other fluxes:\n$v_6 = v_1 - v_7 - v_8$\n\nTo maximize $v_6$, we must maximize $v_1$ and minimize $v_7$ and $v_8$, subject to their respective bounds.\n- The upper bound for $v_1$ is $10$. To maximize $v_6$, we set $v_1$ to its maximum value: $v_1 = 10$.\n- The lower bound for $v_7$ is $0$ (from $v_7 \\geq 0$). To maximize $v_6$, we set $v_7$ to its minimum value: $v_7 = 0$.\n- The lower bound for $v_8$ is $0$ (from $v_8 \\geq 0$). To maximize $v_6$, we set $v_8$ to its minimum value: $v_8 = 0$.\n\nThis gives a candidate for the maximum value of $v_6$:\n$v_{6, \\text{max}} = 10 - 0 - 0 = 10$\n\nWe must verify if a flux distribution exists that satisfies all constraints for $v_6 = 10$. In other words, is this state feasible?\nIf $v_6 = 10$, then from $v_6 = v_3 + v_5$, we have $v_3 + v_5 = 10$.\nThe problem constraints include $0 \\leq v_3 \\leq 8$ and $0 \\leq v_5 \\leq 8$.\nA solution requires finding $v_3$ and $v_5$ that satisfy all three conditions:\n1. $v_3 + v_5 = 10$\n2. $0 \\leq v_3 \\leq 8$\n3. $0 \\leq v_5 \\leq 8$\n\nFrom $v_3+v_5=10$, we can write $v_5 = 10 - v_3$. Substituting this into the bounds for $v_5$ gives:\n$0 \\leq 10 - v_3 \\leq 8$\nThis yields two inequalities for $v_3$:\n- $10 - v_3 \\geq 0 \\implies v_3 \\leq 10$\n- $10 - v_3 \\leq 8 \\implies 2 \\leq v_3$\nSo, from the constraint on $v_5$, we require $v_3 \\in [2, 10]$.\n\nCombining this with the direct constraint on $v_3$, which is $v_3 \\in [0, 8]$, we find the feasible range for $v_3$ by taking the intersection of the two intervals: $[2, 10] \\cap [0, 8] = [2, 8]$.\nSince this interval is non-empty, feasible solutions exist. For example, if we choose $v_3 = 5$, then $v_5 = 10 - 5 = 5$. This satisfies $0 \\leq 5 \\leq 8$. The complete flux vector would be $(v_1, v_2, v_3, v_4, v_5, v_6, v_7, v_8) = (10, 5, 5, 5, 5, 10, 0, 0)$, which is a valid flux distribution.\n\nTherefore, the maximum achievable biomass flux is $10$.\n$z^{\\star} = 10$\n\n**Part 2: Analytical Flux Variability Analysis (FVA) for $v_3$**\n\nThe task is to find the minimum feasible value of $v_3$ while maintaining the optimal biomass production, i.e., subject to the additional constraint $v_6 = z^{\\star} = 10$. This is formulated as a new linear programming problem:\n\nMinimize: $v_3$\nSubject to:\n1. The steady-state mass balance equations $S v = 0$.\n2. The reaction bounds: $0 \\leq v_1 \\leq 10$, $0 \\leq v_3 \\leq 8$, $0 \\leq v_5 \\leq 8$, and $v_2, v_4, v_6, v_7, v_8 \\geq 0$.\n3. The optimality constraint: $v_6 = 10$.\n\nAs established in the FBA step, the combination of $v_1 = v_6 + v_7 + v_8$, $v_1 \\leq 10$, $v_6=10$, $v_7 \\geq 0$, and $v_8 \\geq 0$ forces $v_7 = 0$ and $v_8 = 0$, which in turn forces $v_1 = 10$.\n\nThe problem is thus reduced to finding the minimum $v_3$ subject to the set of constraints that define the alternative optimal solutions. We already derived this set of constraints in Part 1 when checking for feasibility. The constraints on $v_3$ that ensure a feasible solution with $v_6=10$ are:\n- $v_3 + v_5 = 10$\n- $0 \\leq v_3 \\leq 8$\n- $0 \\leq v_5 \\leq 8$\n\nAs shown previously, combining these constraints leads to the feasible range for $v_3$:\n$2 \\leq v_3 \\leq 8$\n\nThe problem is to minimize $v_3$ over this feasible range. The minimum value in the interval $[2, 8]$ is $2$.\n\n**Part 3: Report the Minimum Value of $v_3$**\n\nThe minimum feasible value of flux $v_3$ at the optimal biomass level $z^{\\star}=10$ is $2$.\nFor this minimum value, $v_3 = 2$, the corresponding value for $v_5$ is $v_5 = 10 - 2 = 8$. This is a valid flux distribution, specifically $(v_1, v_2, v_3, v_4, v_5, v_6, v_7, v_8) = (10, 2, 2, 8, 8, 10, 0, 0)$. All flux bounds are satisfied.", "answer": "$$\n\\boxed{2}\n$$", "id": "3309703"}, {"introduction": "Moving from analytical methods to computational practice, this exercise explores how thermodynamic information, modeled by enforcing reaction irreversibility, shapes the metabolic solution space. By implementing FVA and comparing a network model with reversible reactions to one with strictly irreversible reactions, you will computationally verify the fundamental principle that tighter constraints can only reduce or maintain, but never expand, metabolic flexibility ([@problem_id:3309643]). This task highlights the significant impact of modeling assumptions on predicting network behavior.", "problem": "Consider a steady-state metabolic network modeled by linear constraints on reaction fluxes, where the unknown flux vector is $v \\in \\mathbb{R}^n$ and the stoichiometric matrix is $S \\in \\mathbb{R}^{m \\times n}$. The steady-state assumption imposes the mass-balance constraints $$S\\,v = 0.$$ Under a linear objective function $c^\\top v$ representing the production rate of a pseudo-metabolite \"biomass,\" Flux Balance Analysis (FBA) seeks a flux vector $v$ that maximizes the scalar $c^\\top v$ subject to the mass-balance and bound constraints. Flux Variability Analysis (FVA) then quantifies alternative optimal solutions by computing, for each reaction $i$, the minimum and maximum attainable values of $v_i$ subject to the same constraints and the additional equality constraint that enforces the optimal objective value $$c^\\top v = z^\\star,$$ where $z^\\star$ is the optimal value obtained from FBA.\n\nUse the following small network with $m = 4$ metabolites and $n = 6$ reactions. The metabolites are $A$, $B$, $C$, and Biomass. The reactions are:\n- $R_1$: Uptake of $A$,\n- $R_2$: Conversion $A \\rightarrow B$,\n- $R_3$: Conversion $A \\rightarrow C$,\n- $R_4$: Conversion $B \\rightarrow \\text{Biomass}$,\n- $R_5$: Conversion $C \\rightarrow \\text{Biomass}$,\n- $R_6$: Drain of Biomass (the objective reaction).\n\nThe stoichiometric matrix $S \\in \\mathbb{R}^{4 \\times 6}$ is\n$$\nS = \\begin{bmatrix}\n1 & -1 & -1 & 0 & 0 & 0 \\\\\n0 & 1 & 0 & -1 & 0 & 0 \\\\\n0 & 0 & 1 & 0 & -1 & 0 \\\\\n0 & 0 & 0 & 1 & 1 & -1\n\\end{bmatrix}.\n$$\nThe objective vector $c \\in \\mathbb{R}^6$ is\n$$\nc = \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 0 \\\\ 1 \\end{bmatrix},\n$$\nso that $c^\\top v = v_6$ is maximized in FBA.\n\nYou will compare two bound regimes:\n- Regime $\\mathcal{R}_{\\text{rev}}$ (reversible internal reactions): internal conversions are allowed to be reversible within finite bounds.\n- Regime $\\mathcal{R}_{\\text{irrev}}$ (enforced irreversibility): internal conversions are restricted to be nonnegative.\n\nLet the common upper bound constant for internal reactions be $U_{\\max} = 100$. For each test case, the uptake bound and an internal bypass bound are parameterized. Specifically, the bounds for each regime are defined as follows.\n- In regime $\\mathcal{R}_{\\text{rev}}$:\n  - $R_1$: $0 \\le v_1 \\le U_{\\text{uptake}}$,\n  - $R_2$: $-U_{\\max} \\le v_2 \\le U_{\\max}$,\n  - $R_3$: $-U_{\\max} \\le v_3 \\le U_{\\max}$,\n  - $R_4$: $-U_{\\max} \\le v_4 \\le U_{\\max}$,\n  - $R_5$: $-U_{\\max} \\le v_5 \\le U_{\\max}$,\n  - $R_6$: $0 \\le v_6 \\le U_{\\max}$.\n- In regime $\\mathcal{R}_{\\text{irrev}}$:\n  - $R_1$: $0 \\le v_1 \\le U_{\\text{uptake}}$,\n  - $R_2$: $0 \\le v_2 \\le U_{\\max}$,\n  - $R_3$: $0 \\le v_3 \\le U_{\\max}$,\n  - $R_4$: $0 \\le v_4 \\le U_{\\max}$,\n  - $R_5$: $0 \\le v_5 \\le U_{\\max}$,\n  - $R_6$: $0 \\le v_6 \\le U_{\\max}$.\n\nThe objective is to compute FVA ranges under both regimes. For each regime, perform FBA to obtain the optimal objective value $z^\\star$ and then perform FVA by solving, for each reaction index $i \\in \\{1,2,3,4,5,6\\}$:\n- The minimization problem $$\\min_{v} \\; v_i \\quad \\text{subject to} \\quad S\\,v = 0, \\;\\; c^\\top v = z^\\star, \\;\\; \\text{bounds of the regime},$$\n- The maximization problem $$\\max_{v} \\; v_i \\quad \\text{subject to} \\quad S\\,v = 0, \\;\\; c^\\top v = z^\\star, \\;\\; \\text{bounds of the regime}.$$\n\nDefine the FVA range width for reaction $i$ in a regime as $$w_i = (\\max v_i) - (\\min v_i).$$\n\nTo illustrate the role of directionality, you will run a test suite that varies the uptake bound $U_{\\text{uptake}}$ and, in regime $\\mathcal{R}_{\\text{rev}}$, permits symmetry across internal reactions via reversible bounds, whereas in regime $\\mathcal{R}_{\\text{irrev}}$ enforces nonnegativity. For each test case, check whether enforcing irreversibility does not increase the FVA width for any reaction, that is, verify $$w_i^{(\\mathcal{R}_{\\text{irrev}})} \\le w_i^{(\\mathcal{R}_{\\text{rev}})} \\quad \\text{for all } i.$$ The final answer for each test case should be a boolean indicating whether the inequality holds for all reactions.\n\nUse the following test suite of parameter values, where each case is given by $(U_{\\text{uptake}}, U_7)$, and $U_7$ is the symmetric reversible bound magnitude for internal conversions in regime $\\mathcal{R}_{\\text{rev}}$ and the nonnegative upper bound for the same reactions in regime $\\mathcal{R}_{\\text{irrev}}$:\n- Case $1$: $(10, 100)$,\n- Case $2$: $(10, 0)$,\n- Case $3$: $(0, 100)$,\n- Case $4$: $(5, 1)$.\n\nYour program must:\n- Implement the FBA and FVA computations as described.\n- For each test case, construct bounds for both regimes using the given parameters and $U_{\\max} = 100$.\n- Produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, $$[ \\text{result}_1, \\text{result}_2, \\text{result}_3, \\text{result}_4 ]$$ where each $\\text{result}_k$ is a boolean corresponding to case $k$.\n\nAll optimization problems must be solved exactly as linear programs; angles are not used, and there are no physical unit conversions in the output since the final results are booleans.", "solution": "The problem requires a comparative analysis of Flux Variability Analysis (FVA) results for a small metabolic network under two different sets of reaction bounds: one where internal reactions are reversible ($\\mathcal{R}_{\\text{rev}}$) and one where they are irreversible ($\\mathcal{R}_{\\text{irrev}}$). The core of the task is to implement the Flux Balance Analysis (FBA) and FVA procedures and verify a hypothesis about the resulting flux variability ranges for a given set of test cases.\n\nFirst, we formalize the problem as a sequence of Linear Programs (LPs). The metabolic network is defined by its stoichiometric matrix $S \\in \\mathbb{R}^{m \\times n}$, where $m=4$ is the number of metabolites and $n=6$ is the number of reactions. The vector of reaction fluxes is $v \\in \\mathbb{R}^6$. The steady-state assumption imposes the linear equality constraints $S v = 0$.\n\nThe stoichiometric matrix $S$ is given by:\n$$\nS = \\begin{bmatrix}\n1 & -1 & -1 & 0 & 0 & 0 \\\\\n0 & 1 & 0 & -1 & 0 & 0 \\\\\n0 & 0 & 1 & 0 & -1 & 0 \\\\\n0 & 0 & 0 & 1 & 1 & -1\n\\end{bmatrix}\n$$\nThe rows correspond to metabolites $A$, $B$, $C$, and Biomass, respectively. The columns correspond to reactions $R_1, \\dots, R_6$. An analytical examination of the null space of $S$ (i.e., vectors $v$ for which $S v = 0$) reveals the following dependencies:\n$v_1 = v_2 + v_3$\n$v_2 = v_4$\n$v_3 = v_5$\n$v_6 = v_4 + v_5$\nCombining these yields a key relationship for any steady-state flux vector: $v_1 = v_6$.\n\nThe objective function for FBA is to maximize the biomass production rate, which is the flux through reaction $R_6$. This is defined by the objective vector $c = [0, 0, 0, 0, 0, 1]^\\top$, leading to the objective function $c^\\top v = v_6$.\n\nThe problem specifies parameterized bounds for the flux vector $v$. There is a minor ambiguity in the problem statement regarding the bounds for internal reactions. The problem first states a general upper bound constant $U_{\\max} = 100$, but then introduces a parameter $U_7$ for \"internal conversions\" ($R_2$, $R_3$, $R_4$, $R_5$) in the test cases. The most reasonable interpretation is that $U_7$ overwrites the bound for these specific reactions, while other bounds, like that for $R_6$, remain defined by $U_{\\max}$. For a test case specified by the tuple $(U_{\\text{uptake}}, U_7)$, the bounds for the two regimes are thus defined as follows:\n\nRegime $\\mathcal{R}_{\\text{rev}}$ (reversible):\n$l_b^{(\\text{rev})} = [0, -U_7, -U_7, -U_7, -U_7, 0]^\\top$\n$u_b^{(\\text{rev})} = [U_{\\text{uptake}}, U_7, U_7, U_7, U_7, 100]^\\top$\n\nRegime $\\mathcal{R}_{\\text{irrev}}$ (irreversible):\n$l_b^{(\\text{irrev})} = [0, 0, 0, 0, 0, 0]^\\top$\n$u_b^{(\\text{irrev})} = [U_{\\text{uptake}}, U_7, U_7, U_7, U_7, 100]^\\top$\n\nThe solution process for each test case involves the following steps:\n1.  **FBA**: For each regime, solve the FBA problem to find the optimal objective value $z^\\star$.\n    $$\n    z^\\star = \\max_{v} \\; v_6 \\quad \\text{s.t.} \\quad S v = 0, \\;\\; l_b \\le v \\le u_b\n    $$\n    This is a standard LP. Based on the stoichiometric dependency $v_1 = v_6$ and the bounds $0 \\le v_1 \\le U_{\\text{uptake}}$ and $v_6 = v_2 + v_3 \\le ub_2 + ub_3$, the optimal objective value can be determined analytically as $z^\\star = \\min(U_{\\text{uptake}}, 2U_7)$. This is a crucial finding, as it means the FVA for both regimes is performed subject to the same optimal objective value.\n\n2.  **FVA**: For each regime, and for each reaction $i \\in \\{1, \\dots, 6\\}$, solve two LPs to find the minimum and maximum possible flux $v_i$.\n    $$\n    \\min_{v} / \\max_{v} \\; v_i \\quad \\text{s.t.} \\quad S v = 0, \\;\\; c^\\top v = z^\\star, \\;\\; l_b \\le v \\le u_b\n    $$\n    The additional constraint $c^\\top v = z^\\star$ (i.e., $v_6 = z^\\star$) restricts the solution space to only those flux distributions that achieve the maximum biomass yield.\n\n3.  **Width Calculation**: For each reaction $i$, calculate the FVA range width $w_i = (\\max v_i) - (\\min v_i)$ for both regimes, yielding $w_i^{(\\mathcal{R}_{\\text{rev}})}$ and $w_i^{(\\mathcal{R}_{\\text{irrev}})}$.\n\n4.  **Verification**: Check if the condition $w_i^{(\\mathcal{R}_{\\text{irrev}})} \\le w_i^{(\\mathcal{R}_{\\text{rev}})}$ holds for all $i \\in \\{1, \\dots, 6\\}$. The result for the test case is a single boolean value indicating the outcome of this verification.\n\nTheoretically, the condition $w_i^{(\\mathcal{R}_{\\text{irrev}})} \\le w_i^{(\\mathcal{R}_{\\text{rev}})}$ is expected to be true. The feasible set for the FVA LPs in the irreversible regime, let's call it $V_{\\text{irrev}}$, is a subset of the feasible set in the reversible regime, $V_{\\text{rev}}$, because the irreversibility constraints ($v_i \\ge 0$) are stricter than the reversibility constraints ($v_i \\ge -U_7$) and we have shown $z^\\star$ is identical for both. For any convex set $A$ that is a subset of a convex set $B$ ($A \\subseteq B$), the range of any coordinate projection of $A$ must be contained within or equal to the range of the corresponding projection of $B$. Therefore, the width of the range for $A$ cannot exceed the width of the range for $B$. This ensures that the hypothesis will hold for all test cases. The implementation below computationally verifies this principle.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves the FBA/FVA problem for a series of test cases.\n    For each case, it computes FVA widths for a reversible and an irreversible regime,\n    then verifies if the irreversible widths are less than or equal to the reversible ones.\n    \"\"\"\n    \n    # Stoichiometric matrix S for m=4 metabolites and n=6 reactions.\n    S = np.array([\n        [1., -1., -1., 0., 0., 0.],  # Metabolite A\n        [0., 1., 0., -1., 0., 0.],   # Metabolite B\n        [0., 0., 1., 0., -1., 0.],   # Metabolite C\n        [0., 0., 0., 1., 1., -1.]    # Metabolite Biomass\n    ])\n    \n    # Objective vector c to maximize v_6 (flux of R6).\n    c_obj = np.array([0., 0., 0., 0., 0., 1.])\n    \n    n_reactions = 6\n    n_metabolites = 4\n    \n    # Common upper bound for the biomass drain reaction R6.\n    U_max = 100.\n    \n    # Test suite of parameters (U_uptake, U_7).\n    test_cases = [\n        (10., 100.),\n        (10., 0.),\n        (0., 100.),\n        (5., 1.)\n    ]\n\n    results = []\n    \n    for U_uptake, U_7 in test_cases:\n        # Define bounds for the two regimes based on test case parameters.\n        # Regime R_rev (reversible internal reactions)\n        bounds_rev = [\n            (0., U_uptake),      # R1: Uptake\n            (-U_7, U_7),         # R2: A -> B\n            (-U_7, U_7),         # R3: A -> C\n            (-U_7, U_7),         # R4: B -> Biomass\n            (-U_7, U_7),         # R5: C -> Biomass\n            (0., U_max)         # R6: Biomass drain\n        ]\n\n        # Regime R_irrev (irreversible internal reactions)\n        bounds_irrev = [\n            (0., U_uptake),      # R1\n            (0., U_7),           # R2\n            (0., U_7),           # R3\n            (0., U_7),           # R4\n            (0., U_7),           # R5\n            (0., U_max)          # R6\n        ]\n\n        # Calculate FVA widths for both regimes\n        widths_rev = calculate_fva_widths(S, c_obj, bounds_rev, n_reactions, n_metabolites)\n        widths_irrev = calculate_fva_widths(S, c_obj, bounds_irrev, n_reactions, n_metabolites)\n        \n        # Verify the condition: w_irrev = w_rev for all reactions.\n        # A small tolerance is used for robust floating point comparison.\n        is_le = np.all(widths_irrev = widths_rev + 1e-9)\n        results.append(is_le)\n\n    # Format and print the final output.\n    print(f\"[{','.join(map(str, results))}]\")\n\n\ndef calculate_fva_widths(S, c_obj, bounds, n_reactions, n_metabolites):\n    \"\"\"\n    Performs FBA and FVA to compute the width of the flux range for each reaction.\n    \"\"\"\n    # 1. Flux Balance Analysis (FBA)\n    # We want to maximize c_obj.T @ v, which is equivalent to minimizing -c_obj.T @ v.\n    b_eq_fba = np.zeros(n_metabolites)\n    res_fba = linprog(c=-c_obj, A_eq=S, b_eq=b_eq_fba, bounds=bounds, method='highs')\n\n    # If FBA is infeasible or fails, FVA cannot be performed.\n    # Based on problem analysis, FBA is always feasible for the given cases.\n    if not res_fba.success:\n        # This case suggests an issue (e.g., infeasibility), return zero-widths.\n        return np.zeros(n_reactions)\n        \n    z_star = -res_fba.fun\n    \n    # 2. Flux Variability Analysis (FVA)\n    # Augment constraints with the FBA optimum: c_obj.T @ v = z_star\n    A_eq_fva = np.vstack([S, c_obj])\n    b_eq_fva = np.zeros(n_metabolites + 1)\n    b_eq_fva[-1] = z_star\n    \n    widths = np.zeros(n_reactions)\n    \n    for i in range(n_reactions):\n        # Minimize v_i\n        c_fva_min = np.zeros(n_reactions)\n        c_fva_min[i] = 1.\n        res_min = linprog(c=c_fva_min, A_eq=A_eq_fva, b_eq=b_eq_fva, bounds=bounds, method='highs')\n        \n        # Maximize v_i (by minimizing -v_i)\n        c_fva_max = np.zeros(n_reactions)\n        c_fva_max[i] = -1.\n        res_max = linprog(c=c_fva_max, A_eq=A_eq_fva, b_eq=b_eq_fva, bounds=bounds, method='highs')\n        \n        v_min, v_max = 0., 0.\n        if res_min.success:\n            v_min = res_min.fun\n        if res_max.success:\n            v_max = -res_max.fun\n        \n        # Ensure max is not smaller than min due to numerical issues\n        if v_max  v_min:\n            v_max = v_min\n\n        widths[i] = v_max - v_min\n        \n    return widths\n\nsolve()\n```", "id": "3309643"}, {"introduction": "While FVA is excellent for characterizing the entire space of optimal solutions, we often need to select a single, biologically meaningful flux distribution from this space. This practice introduces lexicographic optimization, a powerful technique that finds the most resource-efficient solution by minimizing the sum of all flux magnitudes (the $L_1$-norm) as a secondary objective. You will implement this method to resolve alternative optima and quantify how it effectively eliminates variability arising from thermodynamically wasteful futile cycles ([@problem_id:3309695]).", "problem": "You are given a steady-state metabolic network formalized as a linear programming model. The fundamental base is that a well-mixed network at steady state obeys linear mass balance and capacity constraints, and flux variability analysis is performed on the face of optimal solutions to a linear objective. Concretely, a metabolic network is specified by a stoichiometric matrix $S \\in \\mathbb{R}^{m \\times n}$, a flux vector $v \\in \\mathbb{R}^n$, lower and upper bounds $l \\in \\mathbb{R}^n$ and $u \\in \\mathbb{R}^n$ with $l \\le u$, and a linear objective coefficient vector $c \\in \\mathbb{R}^n$. The standard steady-state feasible set is\n$$\n\\mathcal{F} = \\left\\{ v \\in \\mathbb{R}^n \\;\\middle|\\; S v = 0,\\; l \\le v \\le u \\right\\}.\n$$\nThe primary biomass maximization problem is the linear program\n$$\n\\text{maximize } c^\\top v \\text{ subject to } v \\in \\mathcal{F}.\n$$\nFlux Variability Analysis (FVA) restricts attention to the optimal objective value $Z^\\star = \\max_{v \\in \\mathcal{F}} c^\\top v$ and computes, for each reaction $j$, the minimum and maximum achievable $v_j$ over the optimal face\n$$\n\\mathcal{F}_{\\text{opt}} = \\left\\{ v \\in \\mathcal{F} \\;\\middle|\\; c^\\top v = Z^\\star \\right\\}.\n$$\nThe width of the FVA range for reaction $j$ is $w_j = \\max\\{v_j : v \\in \\mathcal{F}_{\\text{opt}}\\} - \\min\\{v_j : v \\in \\mathcal{F}_{\\text{opt}}\\}$.\n\nConsider the lexicographic optimization that first maximizes $c^\\top v$ and then, over $\\mathcal{F}_{\\text{opt}}$, minimizes the $L_1$-norm $\\|v\\|_1 = \\sum_{i=1}^n |v_i|$. To make the second step a linear program, introduce auxiliary variables $t_i \\ge 0$ and impose $-t_i \\le v_i \\le t_i$, so that minimizing $\\sum_i t_i$ is equivalent to minimizing $\\|v\\|_1$. The secondary optimization problem is\n$$\n\\text{minimize } \\sum_{i=1}^n t_i \\text{ subject to } S v = 0,\\; l \\le v \\le u,\\; c^\\top v = Z^\\star,\\; -t_i \\le v_i \\le t_i,\\; t_i \\ge 0\\; \\text{for all } i.\n$$\nYou must do the following:\n- Derive from first principles why minimizing $\\|v\\|_1$ over $\\mathcal{F}_{\\text{opt}}$ selects at least one solution that is an extreme point of the optimal face. This derivation must start from the properties of linear programs and convex polytopes, and must not assume any special structure beyond $S v = 0$, $l \\le v \\le u$, and $c^\\top v = Z^\\star$.\n- Quantify, in a mathematically explicit way, how the FVA widths $w_j$ for reactions with symmetric bounds (i.e., reactions $j$ such that $l_j = -u_j$ with $u_j  0$) are reduced when restricting to the set of minimizers of $\\|v\\|_1$ within $\\mathcal{F}_{\\text{opt}}$. Your quantification must connect the reduction to the geometry of the constraints and, when applicable, provide a closed-form characterization in simple cycle scenarios where a reaction $j$ appears only in a linear relation of the form $v_j = \\alpha + x$ with $x$ a free cycle flux and $\\alpha \\ge 0$ fixed on $\\mathcal{F}_{\\text{opt}}$.\n\nImplement a program that, for each of the following test cases, performs:\n$1.$ Computation of $Z^\\star$ and the original FVA widths $w_j$ for all reactions over $\\mathcal{F}_{\\text{opt}}$.\n$2.$ Computation of a minimizer $(v^\\star, t^\\star)$ of $\\sum_i t_i$ over $\\mathcal{F}_{\\text{opt}}$ using the auxiliary variable formulation.\n$3.$ Computation of the FVA widths $w^{\\text{L1}}_j$ for all reactions restricted to the set of minimizers of $\\sum_i t_i$, implemented by adding the equality constraint $\\sum_i t_i = \\sum_i t^\\star_i$ to the linear program for each reaction $j$.\n$4.$ Computation of the total reduction in FVA widths, defined as\n$$\nR = \\sum_{j \\in \\mathcal{J}_{\\text{sym}}} \\left( w_j - w^{\\text{L1}}_j \\right),\n$$\nwhere $\\mathcal{J}_{\\text{sym}} = \\{ j \\mid l_j = -u_j,\\; u_j  0 \\}$ is the set of indices of reactions with symmetric bounds.\n\nTest suite:\n- Case A (alternative optima via a single internal cycle): $m = 3$, $n = 5$, metabolites $\\{A,B,C\\}$, reactions $\\{R_1,\\dots,R_5\\}$ with stoichiometric matrix\n$$\nS = \\begin{bmatrix}\n+1  -1  0  0  +1 \\\\\n0  +1  -1  0  -1 \\\\\n0  0  +1  -1  0\n\\end{bmatrix},\n$$\nobjective $c = [0, 0, 0, 1, 0]^\\top$, bounds $l = [0, -20, 0, 0, -5]^\\top$, $u = [10, 20, 10, 100, 5]^\\top$.\n- Case B (unique optimum, no cycles): $m = 3$, $n = 4$, metabolites $\\{A,B,C\\}$, reactions $\\{R_1,\\dots,R_4\\}$ with stoichiometric matrix\n$$\nS = \\begin{bmatrix}\n+1  -1  0  0 \\\\\n0  +1  -1  0 \\\\\n0  0  +1  -1\n\\end{bmatrix},\n$$\nobjective $c = [0, 0, 0, 1]^\\top$, bounds $l = [0, 0, 0, 0]^\\top$, $u = [10, 10, 10, 100]^\\top$.\n- Case C (two independent cycles, one coupled to uptake and one free): $m = 5$, $n = 7$, metabolites $\\{A,B,C,D,E\\}$, reactions $\\{R_1,\\dots,R_5,R_7,R_8\\}$ with stoichiometric matrix\n$$\nS = \\begin{bmatrix}\n+1  -1  +1  0  0  0  0 \\\\\n0  +1  -1  -1  0  0  0 \\\\\n0  0  0  +1  -1  0  0 \\\\\n0  0  0  0  0  -1  +1 \\\\\n0  0  0  0  0  +1  -1\n\\end{bmatrix},\n$$\nobjective $c = [0, 0, 0, 0, 1, 0, 0]^\\top$, bounds $l = [0, -20, -20, 0, 0, -5, -5]^\\top$, $u = [10, 20, 20, 10, 100, 5, 5]^\\top$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets in the order $[R_A, R_B, R_C]$, where $R_A$, $R_B$, and $R_C$ are the total reductions $R$ for Cases A, B, and C respectively. All reported values must be real numbers without any units. No user input is permitted; all data must be embedded in the program. The solver tolerance must enforce exact equalities as specified, i.e., $c^\\top v = Z^\\star$ and $\\sum_i t_i = \\sum_i t^\\star_i$ are equality constraints in the linear programs you set up. Implement the $L_1$ norm minimization using auxiliary variables $t_i$ as described above, and compute FVA widths with and without the $L_1$-minimization constraint set.", "solution": "The problem statement is assessed to be **valid**. It is scientifically grounded in the established field of constraint-based metabolic modeling, is mathematically well-posed, provides a complete and consistent set of data and definitions, and is formulated objectively. The tasks requested, which involve both theoretical derivation and computational implementation of standard linear programming techniques (Flux Variability Analysis and $L_1$-norm minimization), are clear and feasible.\n\n### Theoretical Derivation\n\n#### 1. Minimization of $\\|v\\|_1$ and Extreme Points of the Optimal Face\n\nThe core of the first directive is to demonstrate that minimizing the $L_1$-norm over the set of optimal solutions to a primary linear program will select a solution that is an extreme point (vertex) of that solution set.\n\nLet the primary optimization problem be $\\max_{v \\in \\mathcal{F}} c^\\top v$, where the feasible set is the convex polytope $\\mathcal{F} = \\{ v \\in \\mathbb{R}^n \\mid S v = 0,\\; l \\le v \\le u \\}$. The optimal objective value is $Z^\\star$. The set of all optimal solutions, often called the optimal face, is given by\n$$\n\\mathcal{F}_{\\text{opt}} = \\left\\{ v \\in \\mathcal{F} \\;\\middle|\\; c^\\top v = Z^\\star \\right\\}.\n$$\n$\\mathcal{F}_{\\text{opt}}$ is the intersection of the polytope $\\mathcal{F}$ with the hyperplane defined by $c^\\top v = Z^\\star$. The intersection of a convex polytope and a hyperplane is also a convex polytope (possibly of lower dimension). Thus, $\\mathcal{F}_{\\text{opt}}$ is a compact convex set with a finite number of extreme points.\n\nThe secondary optimization problem is to minimize the $L_1$-norm of the flux vector $v$ over this optimal face:\n$$\n\\text{minimize } \\|v\\|_1 \\text{ subject to } v \\in \\mathcal{F}_{\\text{opt}}.\n$$\nThe objective function is $f(v) = \\|v\\|_1 = \\sum_{i=1}^n |v_i|$. The absolute value function $|x|$ is convex, and a sum of convex functions is also convex. Therefore, $f(v) = \\|v\\|_1$ is a convex function.\n\nWe are thus faced with the problem of minimizing a convex function $f(v)$ over a compact convex set $\\mathcal{F}_{\\text{opt}}$. A fundamental result in convex analysis, Bauer's maximum principle (and its corollary for minimization), states that a convex function defined on a compact convex set attains its minimum at an extreme point of the set.\n\nLet $v_{\\text{L1}}^*$ be a solution to the $L_1$-minimization problem, i.e., $v_{\\text{L1}}^* \\in \\mathcal{F}_{\\text{opt}}$ and $\\|v_{\\text{L1}}^*\\|_1 \\le \\|v\\|_1$ for all $v \\in \\mathcal{F}_{\\text{opt}}$. According to the principle, the set of such minimizers, let's call it $\\mathcal{F}_{\\text{L1-opt}}$, is non-empty, and there exists at least one point in $\\mathcal{F}_{\\text{L1-opt}}$ which is also an extreme point of $\\mathcal{F}_{\\text{opt}}$.\n\nIf the minimizer $v_{\\text{L1}}^*$ is unique, it must be an extreme point of $\\mathcal{F}_{\\text{opt}}$. If the minimizers are not unique, the set of minimizers $\\mathcal{F}_{\\text{L1-opt}} = \\{ v \\in \\mathcal{F}_{\\text{opt}} \\mid \\|v\\|_1 = \\|v_{\\text{L1}}^*\\|_1 \\}$ is a convex subset of $\\mathcal{F}_{\\text{opt}}$. The extreme points of $\\mathcal{F}_{\\text{L1-opt}}$ must also be extreme points of the larger set $\\mathcal{F}_{\\text{opt}}$.\n\nThis conclusion also follows from formulating the problem as a single linear program. By introducing auxiliary variables $t_i \\ge 0$ such that $-t_i \\le v_i \\le t_i$, minimizing $\\|v\\|_1$ becomes equivalent to minimizing $\\sum_i t_i$, as at the optimum, we will have $t_i = |v_i|$. The full problem is:\n$$\n\\text{minimize } \\sum_{i=1}^n t_i \\text{ subject to } (v,t) \\in P'\n$$\nwhere $P'$ is the polytope in $\\mathbb{R}^{2n}$ defined by $S v = 0$, $l \\le v \\le u$, $c^\\top v = Z^\\star$, $v - t \\le 0$, $-v - t \\le 0$, and $t \\ge 0$. Since the objective is linear and the feasible set $P'$ is a polytope, the fundamental theorem of linear programming guarantees that an optimal solution $(v^*, t^*)$ exists which is an extreme point of $P'$. An extreme point of $P'$ projects onto a flux vector $v^*$ which is an extreme point of $\\mathcal{F}_{\\text{opt}}$. Therefore, this method naturally finds solutions at the vertices of the optimal face. Parsimonious FBA (pFBA) is a method built on this principle to find a single, resource-efficient flux distribution from a potentially large space of alternatives.\n\n#### 2. Quantification of FVA Width Reduction\n\nFlux Variability Analysis (FVA) on the optimal face $\\mathcal{F}_{\\text{opt}}$ determines the full range of every flux $v_j$ consistent with maximal objective yield. This range, $[\\min_{v \\in \\mathcal{F}_{\\text{opt}}} v_j, \\max_{v \\in \\mathcal{F}_{\\text{opt}}} v_j]$, defines the width $w_j$. If this range is non-zero, it signifies metabolic flexibility, often arising from network redundancy such as parallel pathways or cycles.\n\nMinimizing the $L_1$-norm selects a convex subset of $\\mathcal{F}_{\\text{opt}}$, let's call it $\\mathcal{F}_{\\text{L1-opt}}$, where the sum of absolute fluxes is minimal. This acts as a proxy for minimizing the total \"cost\" of flux, penalizing solutions that use unnecessarily large fluxes. Reactions with symmetric bounds, $l_j = -u_j  0$, are reversible and can operate in either direction. They are often involved in \"futile cycles\" where, for example, a substrate is converted to a product and back again with no net benefit, consuming resources. The $L_1$-norm objective specifically targets such cycles, as they contribute to $\\|v\\|_1$ without being essential for the primary objective.\n\nThe restriction to $\\mathcal{F}_{\\text{L1-opt}}$ (operationally defined by adding the constraint $\\sum_i t_i = \\|v^*_{\\text{L1}}\\|_1$ to the LP) means the new FVA is performed on a smaller convex set. Since $\\mathcal{F}_{\\text{L1-opt}} \\subseteq \\mathcal{F}_{\\text{opt}}$, the new flux ranges must be contained within or equal to the original ranges. Thus, the new widths, $w^{\\text{L1}}_j$, are guaranteed to be less than or equal to the original widths: $w^{\\text{L1}}_j \\le w_j$. The reduction is $w_j - w^{\\text{L1}}_j \\ge 0$.\n\nTo provide a closed-form characterization, consider a simple scenario where the optimal face $\\mathcal{F}_{\\text{opt}}$ is one-dimensional. Any flux vector in this set can be described by $v(\\lambda) = v_0 + \\lambda\\delta$ for $\\lambda \\in [\\lambda_{\\min}, \\lambda_{\\max}]$, where $v_0$ is a particular solution in $\\mathcal{F}_{\\text{opt}}$ and $\\delta$ is a vector in the nullspace of both $S$ and $c^\\top$ (i.e., $S\\delta=0$ and $c^\\top\\delta=0$). The interval for $\\lambda$ is determined by the bounds $l \\le v_0 + \\lambda\\delta \\le u$. The FVA width for reaction $j$ is $w_j = |\\delta_j| (\\lambda_{\\max} - \\lambda_{\\min})$.\n\nThe $L_1$ minimization problem becomes minimizing $f(\\lambda)=\\sum_i |v_{0,i} + \\lambda\\delta_i|$ over $\\lambda \\in [\\lambda_{\\min}, \\lambda_{\\max}]$. This is a 1D convex minimization problem. The set of optimal $\\lambda$ values will be a convex interval, $[\\lambda^*_{\\min}, \\lambda^*_{\\max}] \\subseteq [\\lambda_{\\min}, \\lambda_{\\max}]$. This new interval defines the L1-optimal set $\\mathcal{F}_{\\text{L1-opt}}$. The new FVA width for reaction $j$ is $w^{\\text{L1}}_j = |\\delta_j| (\\lambda^*_{\\max} - \\lambda^*_{\\min})$.\n\nThe reduction in width is explicitly\n$$\nw_j - w^{\\text{L1}}_j = |\\delta_j| \\left[ (\\lambda_{\\max} - \\lambda_{\\min}) - (\\lambda^*_{\\max} - \\lambda^*_{\\min}) \\right].\n$$\nThis quantifies how much of the initial flexibility (parameterized by $\\lambda$) is deemed \"inefficient\" by the $L_1$-norm criterion. For a reversible reaction $j$ in a futile cycle, we might have $\\delta_j \\ne 0$. The L1-norm will favor $\\lambda$ values that make $|v_{0,j} + \\lambda\\delta_j|$ as small as possible, thus shrinking the range of $\\lambda$ and reducing the FVA width $w_j$. If the optimal $\\lambda$ is a single point, the refined FVA width becomes zero.", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Main function to define, solve, and print results for all test cases.\n    \"\"\"\n\n    # Define test cases as tuples of (S, c, l, u)\n    # Case A: Alternative optima via a single internal cycle\n    S_A = np.array([\n        [1, -1, 0, 0, 1],\n        [0, 1, -1, 0, -1],\n        [0, 0, 1, -1, 0]\n    ])\n    c_A = np.array([0, 0, 0, 1, 0])\n    l_A = np.array([0, -20, 0, 0, -5])\n    u_A = np.array([10, 20, 10, 100, 5])\n    \n    # Case B: Unique optimum, no cycles\n    S_B = np.array([\n        [1, -1, 0, 0],\n        [0, 1, -1, 0],\n        [0, 0, 1, -1]\n    ])\n    c_B = np.array([0, 0, 0, 1])\n    l_B = np.array([0, 0, 0, 0])\n    u_B = np.array([10, 10, 10, 100])\n\n    # Case C: Two independent cycles\n    S_C = np.array([\n        [1, -1, 1, 0, 0, 0, 0],\n        [0, 1, -1, -1, 0, 0, 0],\n        [0, 0, 0, 1, -1, 0, 0],\n        [0, 0, 0, 0, 0, -1, 1],\n        [0, 0, 0, 0, 0, 1, -1]\n    ])\n    c_C = np.array([0, 0, 0, 0, 1, 0, 0])\n    l_C = np.array([0, -20, -20, 0, 0, -5, -5])\n    u_C = np.array([10, 20, 20, 10, 100, 5, 5])\n\n    test_cases = [\n        (S_A, c_A, l_A, u_A),\n        (S_B, c_B, l_B, u_B),\n        (S_C, c_C, l_C, u_C),\n    ]\n\n    results = []\n    for case in test_cases:\n        S, c, l, u = case\n        total_reduction = run_fva_reduction_analysis(S, c, l, u)\n        results.append(total_reduction)\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.10f}'.rstrip('0').rstrip('.') for r in results)}]\")\n\n\ndef run_fva_reduction_analysis(S, c, l, u):\n    \"\"\"\n    Performs the complete analysis for a single metabolic network case.\n    1. Finds optimal objective value Z*.\n    2. Computes original FVA widths on the optimal face.\n    3. Finds the minimum L1 norm.\n    4. Computes refined FVA widths on the L1-minimal face.\n    5. Calculates total reduction in widths for symmetric-bound reactions.\n    \"\"\"\n    m, n = S.shape\n    bounds = list(zip(l, u))\n    lp_options = {'tol': 1e-9, 'disp': False}\n\n    # 1. Compute Z_star (optimal objective value)\n    res_opt = linprog(-c, A_eq=S, b_eq=np.zeros(m), bounds=bounds, method='highs', options=lp_options)\n    if not res_opt.success:\n        raise RuntimeError(\"Primary optimization failed to find Z_star.\")\n    Z_star = -res_opt.fun\n\n    # Prepare constraints for FVA on the optimal face\n    A_eq_fva = np.vstack([S, c])\n    b_eq_fva = np.concatenate([np.zeros(m), [Z_star]])\n    \n    # 2. Compute original FVA widths (w_j)\n    w = np.zeros(n)\n    for j in range(n):\n        obj_min = np.zeros(n)\n        obj_min[j] = 1\n        res_min = linprog(obj_min, A_eq=A_eq_fva, b_eq=b_eq_fva, bounds=bounds, method='highs', options=lp_options)\n\n        obj_max = np.zeros(n)\n        obj_max[j] = -1\n        res_max = linprog(obj_max, A_eq=A_eq_fva, b_eq=b_eq_fva, bounds=bounds, method='highs', options=lp_options)\n\n        if res_min.success and res_max.success:\n            v_min = res_min.fun\n            v_max = -res_max.fun\n            # Clamp values to bounds to handle solver tolerance issues\n            v_min = max(v_min, l[j])\n            v_max = min(v_max, u[j])\n            w[j] = v_max - v_min\n        else:\n            # If FVA fails, suggests point solution, width is 0\n            w[j] = 0\n\n    # 3. Compute minimum L1 norm\n    # Variables are [v_1..v_n, t_1..t_n]\n    c_l1 = np.concatenate([np.zeros(n), np.ones(n)])\n    \n    A_eq_l1 = np.hstack([A_eq_fva, np.zeros((m + 1, n))])\n    b_eq_l1 = b_eq_fva\n    \n    # Constraints: v_i - t_i = 0 and -v_i - t_i = 0\n    I_n = np.eye(n)\n    A_ub_l1 = np.vstack([np.hstack([I_n, -I_n]), np.hstack([-I_n, -I_n])])\n    b_ub_l1 = np.zeros(2*n)\n\n    bounds_l1 = bounds + [(0, None)] * n\n    \n    res_l1_min = linprog(c_l1, A_eq=A_eq_l1, b_eq=b_eq_l1, A_ub=A_ub_l1, b_ub=b_ub_l1, bounds=bounds_l1, method='highs', options=lp_options)\n    \n    if not res_l1_min.success:\n        # If L1 min fails, likely due to infeasibility from precision, assume no variability\n        return 0.0\n    min_l1_norm = res_l1_min.fun\n\n    # 4. Compute refined FVA widths (w_l1_j)\n    # Add constraint sum(t_i) = min_l1_norm\n    A_eq_fva_l1 = np.vstack([A_eq_l1, c_l1])\n    b_eq_fva_l1 = np.concatenate([b_eq_l1, [min_l1_norm]])\n    \n    w_l1 = np.zeros(n)\n    for j in range(n):\n        obj_vec = np.zeros(2*n)\n        \n        # Minimize v_j\n        obj_vec[j] = 1\n        res_min = linprog(obj_vec, A_eq=A_eq_fva_l1, b_eq=b_eq_fva_l1, A_ub=A_ub_l1, b_ub=b_ub_l1, bounds=bounds_l1, method='highs', options=lp_options)\n        \n        # Maximize v_j\n        obj_vec[j] = -1\n        res_max = linprog(obj_vec, A_eq=A_eq_fva_l1, b_eq=b_eq_fva_l1, A_ub=A_ub_l1, b_ub=b_ub_l1, bounds=bounds_l1, method='highs', options=lp_options)\n\n        if res_min.success and res_max.success:\n            v_min = res_min.fun\n            v_max = -res_max.fun\n            v_min = max(v_min, l[j])\n            v_max = min(v_max, u[j])\n            w_l1[j] = v_max - v_min\n        else:\n            w_l1[j] = 0\n\n    # 5. Compute total reduction R\n    total_reduction = 0.0\n    # Identify indices of reactions with symmetric bounds\n    # using a tolerance for float comparison\n    sym_indices = [j for j in range(n) if u[j] > 0 and abs(l[j] + u[j])  1e-9]\n\n    for j in sym_indices:\n        reduction = w[j] - w_l1[j]\n        # Ensure reduction is non-negative due to potential floating point noise\n        total_reduction += max(0, reduction)\n\n    return total_reduction\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3309695"}]}