{"hands_on_practices": [{"introduction": "Before we can interpret shadow prices as economic indicators, we must first understand their fundamental physical nature. This practice guides you through a dimensional analysis to determine the units of dual variables, grounding these abstract mathematical quantities in a tangible, physical context. By connecting the Lagrangian formulation to base physical units, you will build a crucial foundation for all subsequent interpretations [@problem_id:3303521].", "problem": "Consider a canonical Flux Balance Analysis (FBA) formulation for a genome-scale metabolic model. Let the stoichiometric matrix be $S \\in \\mathbb{R}^{m \\times n}$, the reaction flux vector be $v \\in \\mathbb{R}^{n}$, and assume steady-state mass conservation given by $S v = 0$. The primal optimization problem is to maximize $c^{T} v$ subject to $S v = 0$ and componentwise bounds $\\ell \\le v \\le u$. In this context, assume stoichiometric coefficients in $S$ are dimensionless (production and consumption stoichiometries count molecules without intrinsic units), and bounds $\\ell, u \\in \\mathbb{R}^{n}$ carry the same physical units as $v$. Define three base physical unit symbols: $U_{M}$ for amount of substance, $U_{W}$ for dry biomass weight, and $U_{T}$ for time. Assume each flux component $v_{j}$ has units $U_{M} \\, U_{W}^{-1} \\, U_{T}^{-1}$. The optimization objective $c^{T} v$ is constructed to equal a specific growth rate $\\mu$ with units $U_{T}^{-1}$, implemented by choosing $c \\in \\mathbb{R}^{n}$ so that its nonzero entries convert flux units to growth rate units. In particular, require that $[c] \\cdot [v] = U_{T}^{-1}$, so $[c]$ must have units $U_{W} \\, U_{M}^{-1}$.\n\nConsider the Lagrangian of the primal problem, introducing the dual variables $y \\in \\mathbb{R}^{m}$ associated with the equality constraints $S v = 0$, and $\\alpha, \\beta \\in \\mathbb{R}^{n}$ associated with the upper and lower bound inequalities, respectively. The Karush–Kuhn–Tucker conditions imply the dual feasibility balance\n$$\nS^{T} y + \\alpha - \\beta = c.\n$$\nStarting from the steady-state mass conservation and the requirement of unit consistency across all terms in the Lagrangian, determine the physical units of the dual variables $y$, $\\alpha$, and $\\beta$.\n\nExpress your final answer as a single row matrix listing, in order, the units of $y$, $\\alpha$, and $\\beta$, each written as a product of the base unit symbols $U_{M}$, $U_{W}$, and $U_{T}$ with appropriate integer exponents. Do not include any other text in the final expression.", "solution": "We begin from the foundational setup of Flux Balance Analysis (FBA), which models a metabolic network at steady state. The core steady-state principle is mass conservation for each metabolite pool,\n$$\nS v = 0,\n$$\nwhere $S \\in \\mathbb{R}^{m \\times n}$ is the stoichiometric matrix (dimensionless entries counting molecular participation), and $v \\in \\mathbb{R}^{n}$ is the reaction flux vector. Each flux component $v_{j}$ represents the net turnover rate of metabolites per unit biomass per unit time, and its physical units are given as $[v] = U_{M} \\, U_{W}^{-1} \\, U_{T}^{-1}$.\n\nThe optimization objective is $c^{T} v$, chosen to represent a specific growth rate $\\mu$ with units $U_{T}^{-1}$. Because $c^{T} v$ must have units $U_{T}^{-1}$, and $[v] = U_{M} \\, U_{W}^{-1} \\, U_{T}^{-1}$, we require the units of $c$ to satisfy\n$$\n[c] \\cdot [v] = U_{T}^{-1}.\n$$\nThus,\n$$\n[c] = \\frac{U_{T}^{-1}}{U_{M} \\, U_{W}^{-1} \\, U_{T}^{-1}} = U_{W} \\, U_{M}^{-1}.\n$$\nThis matches the interpretation that $c$ converts a flux from amount-per-biomass-per-time to per-time via a biomass-per-amount factor.\n\nTo analyze the units of dual variables, we consider the Lagrangian of the primal problem:\n$$\nL(v, y, \\alpha, \\beta) = c^{T} v + y^{T} (S v) + \\alpha^{T} (v - u) + \\beta^{T} (\\ell - v)\n$$\nwhere $y \\in \\mathbb{R}^{m}$ corresponds to the equality constraints $S v = 0$, and $\\alpha, \\beta \\in \\mathbb{R}^{n}$ correspond to the inequality constraints $v \\le u$ and $\\ell \\le v$, respectively. Each term in $L$ must have the same physical units as the objective $c^{T} v$, which is $U_{T}^{-1}$.\n\nWe analyze the units of each term:\n1. For $c^{T} v$, we already established $[c^{T} v] = U_{T}^{-1}$ with $[c] = U_{W} \\, U_{M}^{-1}$ and $[v] = U_{M} \\, U_{W}^{-1} \\, U_{T}^{-1}$.\n2. For $y^{T} (S v)$, since $S$ is dimensionless and $[S v] = [v]$, we have\n$$\n[y^{T} (S v)] = [y] \\cdot [v] = [y] \\cdot (U_{M} \\, U_{W}^{-1} \\, U_{T}^{-1}).\n$$\nTo match the units of the objective,\n$$\n[y] \\cdot (U_{M} \\, U_{W}^{-1} \\, U_{T}^{-1}) = U_{T}^{-1}\n\\quad \\Longrightarrow \\quad\n[y] = \\frac{U_{T}^{-1}}{U_{M} \\, U_{W}^{-1} \\, U_{T}^{-1}} = U_{W} \\, U_{M}^{-1}.\n$$\n3. For $\\alpha^{T} (v - u)$, note that $[v - u] = [v]$ because $u$ has the same units as $v$. Then\n$$\n[\\alpha^{T} (v - u)] = [\\alpha] \\cdot [v] = [\\alpha] \\cdot (U_{M} \\, U_{W}^{-1} \\, U_{T}^{-1}) = U_{T}^{-1}\n\\quad \\Longrightarrow \\quad\n[\\alpha] = U_{W} \\, U_{M}^{-1}.\n$$\n4. Similarly, for $\\beta^{T} (\\ell - v)$, with $[\\ell - v] = [v]$,\n$$\n[\\beta^{T} (\\ell - v)] = [\\beta] \\cdot [v] = [\\beta] \\cdot (U_{M} \\, U_{W}^{-1} \\, U_{T}^{-1}) = U_{T}^{-1}\n\\quad \\Longrightarrow \\quad\n[\\beta] = U_{W} \\, U_{M}^{-1}.\n$$\n\nThese Lagrangian-based unit derivations can be cross-checked using the dual feasibility condition\n$$\nS^{T} y + \\alpha - \\beta = c.\n$$\nBecause $S$ is dimensionless, the left-hand side has units $[y]$ for the $S^{T} y$ term, and $[\\alpha]$ and $[\\beta]$ for the respective bound duals. Equating both sides, we find\n$$\n[y] = [\\alpha] = [\\beta] = [c].\n$$\nSince we already established $[c] = U_{W} \\, U_{M}^{-1}$, this confirmation is consistent.\n\nTherefore, the units of the dual variables associated with mass balance and flux bounds are all equal to $U_{W} \\, U_{M}^{-1}$. The requested ordered triple is\n$$\n\\big([y], [\\alpha], [\\beta]\\big) = \\big(U_{W} \\, U_{M}^{-1}, \\, U_{W} \\, U_{M}^{-1}, \\, U_{W} \\, U_{M}^{-1}\\big).\n$$", "answer": "$$\\boxed{\\begin{pmatrix} U_{W}\\,U_{M}^{-1}  U_{W}\\,U_{M}^{-1}  U_{W}\\,U_{M}^{-1} \\end{pmatrix}}$$", "id": "3303521"}, {"introduction": "Shadow prices provide a powerful way to quantify the value of a limited resource to a cell's objective, such as maximizing its growth rate. This exercise provides a hands-on calculation in a simplified metabolic model, demonstrating precisely how the shadow price associated with a nutrient uptake limit predicts the resulting change in the optimal growth rate. Mastering this concept is key to identifying and engineering metabolic bottlenecks [@problem_id:3303544].", "problem": "Consider a minimal Flux Balance Analysis (FBA) model of a microbial cell with internal metabolites glucose (cytosolic) and adenosine triphosphate (ATP). The system consists of four irreversible reactions with flux vector $v = (v_{1}, v_{2}, v_{3}, v_{4})$:\n\n- Glucose uptake: $v_{1}$, with bound $0 \\leq v_{1} \\leq u_{\\text{Glc}}$.\n- Glycolysis: $v_{2}$, converting cytosolic glucose to ATP.\n- Non-growth associated ATP maintenance: $v_{3}$, with bound $v_{3} \\geq m$.\n- Biomass synthesis: $v_{4}$, the objective to be maximized.\n\nAt metabolic steady state, internal mass balance is enforced by the stoichiometric equalities\n$$\nv_{1} - v_{2} = 0, \\quad 2 v_{2} - v_{3} - v_{4} = 0,\n$$\nwhere the second equality reflects that each unit of $v_{2}$ yields $2$ units of ATP, one unit of ATP is consumed per unit of biomass flux $v_{4}$, and ATP maintenance consumes $v_{3}$ units of ATP. All fluxes share the standard FBA units $\\text{mmol}\\,\\text{gDW}^{-1}\\,\\text{h}^{-1}$, and the biomass flux $v_{4}$ is interpreted as a growth rate in $\\text{h}^{-1}$ through the biomass reaction stoichiometry.\n\nThe primal linear program is to maximize the growth rate\n$$\n\\max_{v} \\; v_{4}\n$$\nsubject to the steady-state equalities and bounds\n$$\n0 \\leq v_{1} \\leq u_{\\text{Glc}}, \\quad 0 \\leq v_{2}, \\quad v_{3} \\geq m, \\quad 0 \\leq v_{4}.\n$$\n\nTake $u_{\\text{Glc}} = 10$ and $m = 3$. Using first principles of linear programming duality and the definition of shadow prices (dual variables associated with inequality constraints), derive the optimal shadow price $\\alpha_{\\text{Glc}}^{\\star}$ associated with the upper bound on $v_{1}$ by constructing the Lagrangian and applying the Karush–Kuhn–Tucker (KKT) conditions. Then, for a small increment $\\delta$ in the glucose uptake upper bound with $\\delta = 3.75 \\times 10^{-2}$, compute the first-order change in the optimal growth rate $\\Delta z^{\\star}$ resulting from increasing $u_{\\text{Glc}}$ by $\\delta$. Round your final numerical answer to four significant figures and express the change in growth rate in $\\text{h}^{-1}$.", "solution": "First, we solve the primal linear programming problem to find the optimal flux distribution and objective value. The objective is to maximize $v_{4}$. From the steady-state constraints, we can express $v_{4}$ in terms of other fluxes:\n1.  From $v_{1} - v_{2} = 0$, we have $v_{1} = v_{2}$.\n2.  From $2 v_{2} - v_{3} - v_{4} = 0$, we have $v_{4} = 2 v_{2} - v_{3}$.\n\nThe optimization problem is to maximize $z = v_4 = 2v_2 - v_3$. To achieve this, we must maximize $v_2$ and minimize $v_3$ subject to their constraints. The constraints on $v_2$ and $v_3$ are:\n-   $v_2 = v_1$, so $0 \\leq v_2 \\leq u_{\\text{Glc}}$. With $u_{\\text{Glc}} = 10$, this becomes $0 \\leq v_2 \\leq 10$.\n-   $v_3 \\geq m$. With $m=3$, this becomes $v_3 \\geq 3$.\n\nTo maximize $2v_2 - v_3$, we choose the largest possible value for $v_2$ and the smallest possible value for $v_3$.\n-   Optimal $v_2^\\star = u_{\\text{Glc}} = 10$.\n-   Optimal $v_3^\\star = m = 3$.\n\nThe optimal flux vector is $v^\\star = (v_1^\\star, v_2^\\star, v_3^\\star, v_4^\\star)$, where $v_1^\\star=10$, $v_2^\\star=10$, $v_3^\\star=3$. The optimal growth rate is $z^\\star = v_4^\\star = 2(10) - 3 = 17 \\, \\text{h}^{-1}$. At this optimum, the glucose uptake constraint ($v_1 \\le u_{\\text{Glc}}$) and the maintenance constraint ($v_3 \\ge m$) are both active.\n\nNext, we use the Karush–Kuhn–Tucker (KKT) conditions to find the dual variables (shadow prices). The Lagrangian $\\mathcal{L}$ for this maximization problem is:\n$$\n\\mathcal{L} = v_4 + \\lambda_1(v_1 - v_2) + \\lambda_2(2v_2 - v_3 - v_4) + \\alpha_{\\text{Glc}}(u_{\\text{Glc}} - v_1) + \\alpha_m(v_3 - m) + \\alpha_1 v_1 + \\alpha_2 v_2 + \\alpha_4 v_4\n$$\nwhere $\\lambda_1, \\lambda_2$ are dual variables for equality constraints and $\\alpha_i \\ge 0$ are dual variables for inequality constraints.\n\nThe stationarity conditions ($\\nabla_v \\mathcal{L} = 0$) are:\n1.  $\\frac{\\partial \\mathcal{L}}{\\partial v_1}: \\lambda_1 - \\alpha_{\\text{Glc}} + \\alpha_1 = 0$\n2.  $\\frac{\\partial \\mathcal{L}}{\\partial v_2}: -\\lambda_1 + 2\\lambda_2 + \\alpha_2 = 0$\n3.  $\\frac{\\partial \\mathcal{L}}{\\partial v_3}: -\\lambda_2 + \\alpha_m = 0$\n4.  $\\frac{\\partial \\mathcal{L}}{\\partial v_4}: 1 - \\lambda_2 + \\alpha_4 = 0$\n\nBy complementary slackness, since $v_1^\\star=10 > 0$, $v_2^\\star=10 > 0$, and $v_4^\\star=17 > 0$, their corresponding dual variables must be zero: $\\alpha_1=0$, $\\alpha_2=0$, $\\alpha_4=0$.\nThe stationarity equations simplify to:\n1.  $\\lambda_1 - \\alpha_{\\text{Glc}} = 0 \\implies \\lambda_1 = \\alpha_{\\text{Glc}}$\n2.  $-\\lambda_1 + 2\\lambda_2 = 0 \\implies \\lambda_1 = 2\\lambda_2$\n3.  $-\\lambda_2 + \\alpha_m = 0 \\implies \\lambda_2 = \\alpha_m$\n4.  $1 - \\lambda_2 = 0 \\implies \\lambda_2 = 1$\n\nSolving this system, we find:\n-   From (4), $\\lambda_2 = 1$.\n-   From (2), $\\lambda_1 = 2\\lambda_2 = 2(1) = 2$.\n-   From (1), the shadow price for the glucose uptake constraint is $\\alpha_{\\text{Glc}}^\\star = \\lambda_1 = 2$.\n-   From (3), the shadow price for the maintenance constraint is $\\alpha_m^\\star = \\lambda_2 = 1$.\n\nThe shadow price $\\alpha_{\\text{Glc}}^\\star=2$ represents the rate of change of the optimal objective with respect to the glucose uptake bound, i.e., $\\frac{\\partial z^\\star}{\\partial u_{\\text{Glc}}} = 2$.\nFor a small change $\\delta$ in $u_{\\text{Glc}}$, the first-order change in the optimal growth rate, $\\Delta z^\\star$, is approximated by:\n$$\n\\Delta z^\\star \\approx \\alpha_{\\text{Glc}}^\\star \\cdot \\delta\n$$\nGiven $\\delta = 3.75 \\times 10^{-2}$, we compute:\n$$\n\\Delta z^\\star \\approx 2 \\times (3.75 \\times 10^{-2}) = 0.075\n$$\nThe problem asks for this value rounded to four significant figures.\n$$\n\\Delta z^\\star = 0.07500 \\, \\text{h}^{-1}\n$$", "answer": "$$\n\\boxed{0.07500}\n$$", "id": "3303544"}, {"introduction": "Modern systems biology relies on computational tools to analyze complex models that incorporate realistic constraints, such as the finite capacity of the cellular proteome. In this practice, you will move from analytical derivations to computational implementation by calculating the shadow price of a proteome capacity constraint numerically. This exercise bridges theory and practice, showing how the concepts of dual variables are applied in advanced resource allocation models using standard programming tools [@problem_id:3303571].", "problem": "You are asked to formalize and analyze a Flux Balance Analysis (FBA) model in a linear programming (LP) framework and compute the shadow price of a proteome resource constraint. Flux Balance Analysis (FBA) is a constraint-based modeling approach for steady-state cellular metabolism that optimizes a linear objective subject to mass balance. Let $S \\in \\mathbb{R}^{m \\times n}$ denote the stoichiometric matrix, $v \\in \\mathbb{R}^n$ the vector of reaction fluxes, $c \\in \\mathbb{R}^n$ the objective coefficients, and $l \\in \\mathbb{R}^n$, $u \\in \\mathbb{R}^n$ the lower and upper bounds on fluxes. The steady-state constraint is $S v = 0$. Consider the LP that maximizes $c^\\top v$ subject to $S v = 0$, $l \\le v \\le u$, and a proteome cost constraint $\\sum_{j=1}^n a_j v_j \\le P$ with $a_j \\ge 0$ and $P \\ge 0$.\n\nYour task is to compute, for several test cases, the shadow price $\\lambda_P$, defined as the marginal value of the proteome resource $P$ on the optimal objective value. Concretely, for a given instance, define $\\phi(P)$ as the optimum of the LP objective $c^\\top v$ at resource level $P$. You must compute an approximation of $\\lambda_P$ using a forward finite difference:\n$$\n\\lambda_P \\approx \\frac{\\phi(P + \\Delta P) - \\phi(P)}{\\Delta P},\n$$\nfor a small positive increment $\\Delta P$. This quantity should be interpreted as the increase in optimal objective per unit increase in the proteome resource $P$, consistent with resource allocation models in computational systems biology. The LP must be solved exactly by a linear programming solver; analytical shortcuts are not permitted.\n\nYou must implement a complete, runnable program that:\n- Sets up the primal LP in canonical form by minimizing $-c^\\top v$ (since the solver performs minimization), subject to $S v = 0$, $\\sum_{j=1}^n a_j v_j \\le P$, and bounds $l \\le v \\le u$.\n- Computes $\\phi(P)$ and $\\phi(P + \\Delta P)$ for a prescribed small $\\Delta P$ and returns the forward difference as the numerical value for $\\lambda_P$.\n- Uses a rigorous finite difference with a fixed step $\\Delta P = 10^{-6}$ to ensure consistent numerical behavior across test cases.\n\nAll answers are purely mathematical floats, and no physical units are required. Angles are not involved. Percentages are not involved.\n\nTest Suite:\nUse the following parameter sets that cover typical and edge-case behaviors. In all cases, the equality constraints are $S v = 0$ and the objective is $c^\\top v$.\n\n- Test Case $1$ (binding proteome constraint, single biomass pathway):\n  - $S = \\begin{bmatrix} 1  -1 \\end{bmatrix}$\n  - $c = \\begin{bmatrix} 0 \\\\ 1 \\end{bmatrix}$\n  - $a = \\begin{bmatrix} 0.1 \\\\ 0.2 \\end{bmatrix}$\n  - $P = 1$\n  - Bounds: $v_1 \\in [0, 10]$, $v_2 \\in [0, 100]$\n\n- Test Case $2$ (non-binding proteome constraint due to uptake bound):\n  - $S = \\begin{bmatrix} 1  -1 \\end{bmatrix}$\n  - $c = \\begin{bmatrix} 0 \\\\ 1 \\end{bmatrix}$\n  - $a = \\begin{bmatrix} 0.1 \\\\ 0.2 \\end{bmatrix}$\n  - $P = 100$\n  - Bounds: $v_1 \\in [0, 10]$, $v_2 \\in [0, 100]$\n\n- Test Case $3$ (binding proteome constraint with two isozymes, resource allocation selects lower proteome cost):\n  - $S = \\begin{bmatrix} 1  -1  -1 \\end{bmatrix}$\n  - $c = \\begin{bmatrix} 0 \\\\ 1 \\\\ 1 \\end{bmatrix}$\n  - $a = \\begin{bmatrix} 0.05 \\\\ 0.3 \\\\ 0.1 \\end{bmatrix}$\n  - $P = 1$\n  - Bounds: $v_1 \\in [0, 100]$, $v_2 \\in [0, 100]$, $v_3 \\in [0, 100]$\n\n- Test Case $4$ (degenerate boundary where proteome and uptake constraints coincide; forward sensitivity is zero):\n  - $S = \\begin{bmatrix} 1  -1 \\end{bmatrix}$\n  - $c = \\begin{bmatrix} 0 \\\\ 1 \\end{bmatrix}$\n  - $a = \\begin{bmatrix} 0.2 \\\\ 0.3 \\end{bmatrix}$\n  - $P = 2.5$\n  - Bounds: $v_1 \\in [0, 5]$, $v_2 \\in [0, 100]$\n\nImplementation Requirements:\n- Use a linear programming solver to compute the optimal objective $\\phi(P)$ and $\\phi(P + \\Delta P)$ for each test case.\n- Use $\\Delta P = 10^{-6}$ for all cases.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the test cases $1$ through $4$. For example, the output format must be exactly of the form: `[r_1,r_2,r_3,r_4]`, where each $r_i$ is the computed numerical approximation of $\\lambda_P$ for test case $i$.", "solution": "The core of the task is to numerically evaluate the shadow price $\\lambda_P$ associated with a proteome capacity constraint. The shadow price, in the context of optimization, represents the rate of change of the optimal objective function value with respect to a change in the constraint's right-hand side. We will compute this quantity for several Flux Balance Analysis (FBA) models using a finite difference approximation.\n\n**Linear Programming Formulation**\nThe problem is to find the optimal flux vector $v$ that maximizes a linear objective function $c^\\top v$ subject to a set of linear constraints. This is a canonical Linear Program (LP). The constraints are:\n1.  Steady-state mass balance: $S v = 0$.\n2.  Proteome resource allocation: $a^\\top v \\le P$.\n3.  Flux bounds: $l \\le v \\le u$.\n\nThe problem is stated as a maximization problem. Standard LP solvers, such as `scipy.optimize.linprog`, are typically formulated as minimization problems. We can convert our maximization problem, $\\max(c^\\top v)$, into an equivalent minimization problem, $\\min(-c^\\top v)$. The optimal value of the maximization problem is then the negative of the optimal value of the minimization problem.\n\nFor implementation with `scipy.optimize.linprog`, we will structure the LP in the following standard form:\nMinimize: $c_{obj}^\\top v$\nSubject to:\n$A_{eq} v = b_{eq}$\n$A_{ub} v \\le b_{ub}$\nwith bounds on $v$.\n\nBased on our specific problem, these components are:\n-   Objective vector: $c_{obj} = -c$\n-   Equality constraint matrix: $A_{eq} = S$\n-   Equality constraint vector: $b_{eq} = \\mathbf{0}$\n-   Inequality constraint matrix: $A_{ub} = a^\\top$\n-   Inequality constraint vector: $b_{ub} = [P]$\n-   Bounds: A sequence of $(l_j, u_j)$ pairs for each flux $v_j$.\n\n**Shadow Price Calculation**\nThe shadow price $\\lambda_P$ is formally defined as the partial derivative of the optimal objective function $\\phi(P)$ with respect to the resource $P$:\n$$\n\\lambda_P = \\frac{\\partial \\phi(P)}{\\partial P}\n$$\nThe problem specifies using a forward finite difference approximation for this derivative:\n$$\n\\lambda_P \\approx \\frac{\\phi(P + \\Delta P) - \\phi(P)}{\\Delta P}\n$$\nwhere $\\Delta P$ is a small, positive increment, fixed at $\\Delta P = 10^{-6}$.\n\nThe computational procedure is therefore as follows:\n1. For each test case, define a function that solves the corresponding LP for a given proteome capacity `P_val` and returns the optimal objective value $\\phi(P_{val})$.\n2. Inside this function, set up the LP components with $b_{ub} = [P_{val}]$ and solve it using a numerical LP solver. The function returns the maximized objective value.\n3. Compute $\\phi(P)$ by calling the solver function with the given $P$.\n4. Compute $\\phi(P + \\Delta P)$ by calling the solver function with $P + \\Delta P$.\n5. Calculate the shadow price approximation using the finite difference formula.\n\nThis entire procedure will be executed for each of the four test cases provided, and the results will be collected into a list.", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Computes the shadow price of a proteome resource constraint in several\n    Flux Balance Analysis (FBA) models.\n    \"\"\"\n    \n    # Define the small increment for the finite difference calculation.\n    # Per the problem statement, delta_P is a fixed small positive number.\n    delta_P = 1e-6\n\n    # Test cases defined in the problem statement.\n    # Each tuple contains: (S, c, a, P, bounds)\n    test_cases = [\n        # Test Case 1\n        (\n            np.array([[1, -1]]),\n            np.array([0, 1]),\n            np.array([0.1, 0.2]),\n            1.0,\n            [(0, 10), (0, 100)]\n        ),\n        # Test Case 2\n        (\n            np.array([[1, -1]]),\n            np.array([0, 1]),\n            np.array([0.1, 0.2]),\n            100.0,\n            [(0, 10), (0, 100)]\n        ),\n        # Test Case 3\n        (\n            np.array([[1, -1, -1]]),\n            np.array([0, 1, 1]),\n            np.array([0.05, 0.3, 0.1]),\n            1.0,\n            [(0, 100), (0, 100), (0, 100)]\n        ),\n        # Test Case 4\n        (\n            np.array([[1, -1]]),\n            np.array([0, 1]),\n            np.array([0.2, 0.3]),\n            2.5,\n            [(0, 5), (0, 100)]\n        )\n    ]\n\n    def solve_fba(c_obj, A_eq, b_eq, A_ub, b_ub, bounds):\n        \"\"\"\n        Solves the LP for a given set of parameters.\n        Returns the optimal objective value of the maximization problem.\n        \"\"\"\n        # The solver performs minimization, so we provide -c to maximize c'v.\n        res = linprog(c_obj, A_ub=A_ub, b_ub=b_ub, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n        \n        if res.success:\n            # The minimization returns the minimum of -c'v.\n            # The maximum of c'v is -res.fun.\n            return -res.fun\n        else:\n            # Handle cases where the solver might fail, though not expected for these problems.\n            return np.nan\n\n    def compute_shadow_price(S, c, a, P, bounds, dP):\n        \"\"\"\n        Calculates the shadow price for a single FBA model instance.\n        \"\"\"\n        # Objective function for the minimizer\n        c_obj = -c\n        \n        # Equality constraints (S*v = 0)\n        A_eq = S\n        b_eq = np.zeros(S.shape[0])\n        \n        # Inequality constraint (a'*v = P)\n        A_ub = a.reshape(1, -1)\n        \n        # --- Solve for phi(P) ---\n        b_ub_P = np.array([P])\n        phi_P = solve_fba(c_obj, A_eq, b_eq, A_ub, b_ub_P, bounds)\n\n        # --- Solve for phi(P + dP) ---\n        b_ub_P_plus_dP = np.array([P + dP])\n        phi_P_plus_dP = solve_fba(c_obj, A_eq, b_eq, A_ub, b_ub_P_plus_dP, bounds)\n\n        # --- Compute forward finite difference ---\n        if np.isnan(phi_P) or np.isnan(phi_P_plus_dP):\n            return np.nan\n            \n        shadow_price = (phi_P_plus_dP - phi_P) / dP\n        return shadow_price\n\n    results = []\n    for case in test_cases:\n        S, c, a, P, bounds = case\n        lambda_P = compute_shadow_price(S, c, a, P, bounds, delta_P)\n        results.append(lambda_P)\n    \n    # Format the final output string exactly as required.\n    # The default string representation of floats is sufficient.\n    result_str = f\"[{','.join(map(str, results))}]\"\n    print(result_str)\n\nsolve()\n```", "id": "3303571"}]}