{"hands_on_practices": [{"introduction": "Before performing any complex network-level simulations, a metabolic model must first adhere to fundamental physical laws, most notably the conservation of mass. This practice provides a foundational exercise in translating reaction lists into their mathematical representation, the stoichiometric matrix ($S$). You will then use this matrix and the elemental composition of metabolites to verify the atomic balance of each reaction, a critical first step in model curation that prevents mass inconsistencies in subsequent analyses [@problem_id:3312958].", "problem": "You are curating a draft genome-scale metabolic subnetwork and must verify that its reactions respect the law of conservation of atoms and mass, a prerequisite for gap-filling decisions. Consider the following metabolite list with compartments and empirical formulas, where $[e]$ denotes the extracellular compartment and $[c]$ denotes the cytosolic compartment. Treat the same chemical in different compartments as distinct species.\n\n- $ \\mathrm{glc}[e] $ (glucose, extracellular): formula $ \\mathrm{C}_{6} \\mathrm{H}_{12} \\mathrm{O}_{6} $.\n- $ \\mathrm{glc}[c] $ (glucose, cytosol): formula $ \\mathrm{C}_{6} \\mathrm{H}_{12} \\mathrm{O}_{6} $.\n- $ \\mathrm{pi}[c] $ (inorganic phosphate, cytosol): formula $ \\mathrm{H}_{1} \\mathrm{O}_{4} \\mathrm{P}_{1} $.\n- $ \\mathrm{h2o}[c] $ (water, cytosol): formula $ \\mathrm{H}_{2} \\mathrm{O}_{1} $.\n- $ \\mathrm{g6p}[c] $ (glucose-6-phosphate, cytosol): formula $ \\mathrm{C}_{6} \\mathrm{H}_{11} \\mathrm{O}_{9} \\mathrm{P}_{1} $.\n- $ \\mathrm{h}[c] $ (proton, cytosol): formula $ \\mathrm{H}_{1} $.\n- $ \\mathrm{pyr}[c] $ (pyruvate, cytosol): formula $ \\mathrm{C}_{3} \\mathrm{H}_{3} \\mathrm{O}_{3} $.\n- $ \\mathrm{lac}[c] $ (lactate, cytosol): formula $ \\mathrm{C}_{3} \\mathrm{H}_{5} \\mathrm{O}_{3} $.\n- $ \\mathrm{co2}[c] $ (carbon dioxide, cytosol): formula $ \\mathrm{C}_{1} \\mathrm{O}_{2} $.\n\nThe draft network includes the following reactions, listed with integer stoichiometric coefficients. Production is on the right-hand side and consumption is on the left-hand side.\n\n- $ R_{1}: \\ \\mathrm{glc}[e] \\rightarrow \\mathrm{glc}[c] $.\n- $ R_{2}: \\ \\mathrm{glc}[c] + \\mathrm{pi}[c] \\rightarrow \\mathrm{g6p}[c] + \\mathrm{h2o}[c] $.\n- $ R_{3}: \\ \\mathrm{g6p}[c] + \\mathrm{h2o}[c] \\rightarrow \\mathrm{glc}[c] + \\mathrm{pi}[c] $.\n- $ R_{4}: \\ \\mathrm{pyr}[c] + 2 \\ \\mathrm{h}[c] \\rightarrow \\mathrm{lac}[c] $.\n- $ R_{5}: \\ \\mathrm{pyr}[c] \\rightarrow \\mathrm{lac}[c] + \\mathrm{co2}[c] $.\n- $ R_{6}: \\ \\mathrm{glc}[e] \\rightarrow \\varnothing $ (glucose exchange to a boundary sink).\n\nTasks:\n\n1. Using the sign convention that reactants have negative coefficients and products have positive coefficients, construct the stoichiometric matrix $ S $ with rows ordered as $ [ \\mathrm{glc}[e], \\mathrm{glc}[c], \\mathrm{pi}[c], \\mathrm{h2o}[c], \\mathrm{g6p}[c], \\mathrm{h}[c], \\mathrm{pyr}[c], \\mathrm{lac}[c], \\mathrm{co2}[c] ] $ and columns ordered as $ [ R_{1}, R_{2}, R_{3}, R_{4}, R_{5}, R_{6} ] $.\n\n2. Invoke the law of conservation of atoms and the definition of the stoichiometric matrix to verify elemental balance for each internal reaction, by comparing total counts of $ \\mathrm{C} $, $ \\mathrm{H} $, $ \\mathrm{O} $, and $ \\mathrm{P} $ on the left-hand side versus the right-hand side. Treat $ R_{6} $ as a boundary exchange (do not include it in the internal-balance verification).\n\n3. Let the atomic weights be symbolically denoted by $w_{\\mathrm{C}}$, $w_{\\mathrm{H}}$, $w_{\\mathrm{O}}$, and $w_{\\mathrm{P}}$, with each $w_{\\alpha} > 0$. Using these weights and the elemental counts, justify mass balance for those reactions that are atomically balanced, and detect mass imbalance for any reaction that is not atomically balanced.\n\n4. Let $ k $ be the number of reactions among $ \\{ R_{1}, R_{2}, R_{3}, R_{4}, R_{5} \\} $ that are not atomically balanced. Report the value of $ k $. The final answer must be a single integer. No rounding is necessary, and no units are required.", "solution": "We begin from the definitions used in constraint-based modeling and the law of conservation of mass and atoms.\n\n- The stoichiometric matrix $ S \\in \\mathbb{R}^{m \\times n} $ encodes reaction stoichiometry with $ m $ metabolites as rows and $ n $ reactions as columns. For a reaction $ j $, the stoichiometric coefficient $ S_{ij} $ is negative if metabolite $ i $ is consumed and positive if it is produced.\n\n- Atomic balance for an element $ \\alpha \\in \\{ \\mathrm{C}, \\mathrm{H}, \\mathrm{O}, \\mathrm{P} \\} $ in a reaction requires that the total number of atoms of $ \\alpha $ on the left-hand side equals that on the right-hand side. This follows from the law of conservation of atoms.\n\n- If each element is conserved and atomic weights $ w_{\\alpha} $ are positive constants, then mass is conserved because the total mass is a linear combination of conserved atomic counts with positive weights.\n\nStep 1: Construct the stoichiometric matrix $ S $.\n\nWe adhere to the metabolite order $ [ \\mathrm{glc}[e], \\mathrm{glc}[c], \\mathrm{pi}[c], \\mathrm{h2o}[c], \\mathrm{g6p}[c], \\mathrm{h}[c], \\mathrm{pyr}[c], \\mathrm{lac}[c], \\mathrm{co2}[c] ] $ and the reaction order $ [ R_{1}, R_{2}, R_{3}, R_{4}, R_{5}, R_{6} ] $. We translate each reaction to column entries:\n\n- $ R_{1}: \\ \\mathrm{glc}[e] \\rightarrow \\mathrm{glc}[c] $ gives $ S_{\\mathrm{glc}[e],R_{1}} = -1 $, $ S_{\\mathrm{glc}[c],R_{1}} = +1 $, all others $ 0 $.\n\n- $ R_{2}: \\ \\mathrm{glc}[c] + \\mathrm{pi}[c] \\rightarrow \\mathrm{g6p}[c] + \\mathrm{h2o}[c] $ gives $ S_{\\mathrm{glc}[c],R_{2}} = -1 $, $ S_{\\mathrm{pi}[c],R_{2}} = -1 $, $ S_{\\mathrm{g6p}[c],R_{2}} = +1 $, $ S_{\\mathrm{h2o}[c],R_{2}} = +1 $, all others $ 0 $.\n\n- $ R_{3}: \\ \\mathrm{g6p}[c] + \\mathrm{h2o}[c] \\rightarrow \\mathrm{glc}[c] + \\mathrm{pi}[c] $ gives $ S_{\\mathrm{g6p}[c],R_{3}} = -1 $, $ S_{\\mathrm{h2o}[c],R_{3}} = -1 $, $ S_{\\mathrm{glc}[c],R_{3}} = +1 $, $ S_{\\mathrm{pi}[c],R_{3}} = +1 $, all others $ 0 $.\n\n- $ R_{4}: \\ \\mathrm{pyr}[c] + 2 \\ \\mathrm{h}[c] \\rightarrow \\mathrm{lac}[c] $ gives $ S_{\\mathrm{pyr}[c],R_{4}} = -1 $, $ S_{\\mathrm{h}[c],R_{4}} = -2 $, $ S_{\\mathrm{lac}[c],R_{4}} = +1 $, all others $ 0 $.\n\n- $ R_{5}: \\ \\mathrm{pyr}[c] \\rightarrow \\mathrm{lac}[c] + \\mathrm{co2}[c] $ gives $ S_{\\mathrm{pyr}[c],R_{5}} = -1 $, $ S_{\\mathrm{lac}[c],R_{5}} = +1 $, $ S_{\\mathrm{co2}[c],R_{5}} = +1 $, all others $ 0 $.\n\n- $ R_{6}: \\ \\mathrm{glc}[e] \\rightarrow \\varnothing $ gives $ S_{\\mathrm{glc}[e],R_{6}} = -1 $, all others $ 0 $.\n\nTherefore,\n$$\nS \\ = \\\n\\begin{pmatrix}\n-1 & 0 & 0 & 0 & 0 & -1 \\\\\n+1 & -1 & +1 & 0 & 0 & 0 \\\\\n0 & -1 & +1 & 0 & 0 & 0 \\\\\n0 & +1 & -1 & 0 & 0 & 0 \\\\\n0 & +1 & -1 & 0 & 0 & 0 \\\\\n0 & 0 & 0 & -2 & 0 & 0 \\\\\n0 & 0 & 0 & -1 & -1 & 0 \\\\\n0 & 0 & 0 & +1 & +1 & 0 \\\\\n0 & 0 & 0 & 0 & +1 & 0\n\\end{pmatrix}\n$$\nwhere rows correspond to $ [ \\mathrm{glc}[e], \\mathrm{glc}[c], \\mathrm{pi}[c], \\mathrm{h2o}[c], \\mathrm{g6p}[c], \\mathrm{h}[c], \\mathrm{pyr}[c], \\mathrm{lac}[c], \\mathrm{co2}[c] ] $ and columns to $ [ R_{1}, R_{2}, R_{3}, R_{4}, R_{5}, R_{6} ] $.\n\nStep 2: Verify elemental balance for internal reactions $ R_{1} $ through $ R_{5} $.\n\nWe use the empirical formulas:\n\n- $ \\mathrm{glc} $: $ \\mathrm{C}_{6} \\mathrm{H}_{12} \\mathrm{O}_{6} $.\n- $ \\mathrm{pi} $: $ \\mathrm{H}_{1} \\mathrm{O}_{4} \\mathrm{P}_{1} $.\n- $ \\mathrm{h2o} $: $ \\mathrm{H}_{2} \\mathrm{O}_{1} $.\n- $ \\mathrm{g6p} $: $ \\mathrm{C}_{6} \\mathrm{H}_{11} \\mathrm{O}_{9} \\mathrm{P}_{1} $.\n- $ \\mathrm{h} $: $ \\mathrm{H}_{1} $.\n- $ \\mathrm{pyr} $: $ \\mathrm{C}_{3} \\mathrm{H}_{3} \\mathrm{O}_{3} $.\n- $ \\mathrm{lac} $: $ \\mathrm{C}_{3} \\mathrm{H}_{5} \\mathrm{O}_{3} $.\n- $ \\mathrm{co2} $: $ \\mathrm{C}_{1} \\mathrm{O}_{2} $.\n\nFor each reaction, we compute total elemental counts on left-hand side (LHS) and right-hand side (RHS):\n\n- $ R_{1}: \\ \\mathrm{glc}[e] \\rightarrow \\mathrm{glc}[c] $. LHS elements: $ (\\mathrm{C}, \\mathrm{H}, \\mathrm{O}, \\mathrm{P}) = (6, 12, 6, 0) $. RHS: $ (6, 12, 6, 0) $. Balanced for all listed elements.\n\n- $ R_{2}: \\ \\mathrm{glc}[c] + \\mathrm{pi}[c] \\rightarrow \\mathrm{g6p}[c] + \\mathrm{h2o}[c] $. LHS: $ (6, 12, 6, 0) + (0, 1, 4, 1) = (6, 13, 10, 1) $. RHS: $ (6, 11, 9, 1) + (0, 2, 1, 0) = (6, 13, 10, 1) $. Balanced.\n\n- $ R_{3}: \\ \\mathrm{g6p}[c] + \\mathrm{h2o}[c] \\rightarrow \\mathrm{glc}[c] + \\mathrm{pi}[c] $. LHS: $ (6, 11, 9, 1) + (0, 2, 1, 0) = (6, 13, 10, 1) $. RHS: $ (6, 12, 6, 0) + (0, 1, 4, 1) = (6, 13, 10, 1) $. Balanced.\n\n- $ R_{4}: \\ \\mathrm{pyr}[c] + 2 \\ \\mathrm{h}[c] \\rightarrow \\mathrm{lac}[c] $. LHS: $ (3, 3, 3, 0) + 2 \\times (0, 1, 0, 0) = (3, 5, 3, 0) $. RHS: $ (3, 5, 3, 0) $. Balanced.\n\n- $ R_{5}: \\ \\mathrm{pyr}[c] \\rightarrow \\mathrm{lac}[c] + \\mathrm{co2}[c] $. LHS: $ (3, 3, 3, 0) $. RHS: $ (3, 5, 3, 0) + (1, 0, 2, 0) = (4, 5, 5, 0) $. Not balanced: the differences RHS minus LHS are $ (\\Delta \\mathrm{C}, \\Delta \\mathrm{H}, \\Delta \\mathrm{O}, \\Delta \\mathrm{P}) = (1, 2, 2, 0) \\neq (0, 0, 0, 0) $.\n\nThus, among internal reactions $ R_{1} $ through $ R_{5} $, only $ R_{5} $ is atomically imbalanced.\n\nStep 3: Verify mass balance using atomic weights.\n\nLet $ w_{\\mathrm{C}}, w_{\\mathrm{H}}, w_{\\mathrm{O}}, w_{\\mathrm{P}} > 0 $ be the atomic weights of carbon, hydrogen, oxygen, and phosphorus, respectively. For a reaction, denote by $ \\nu_{\\alpha}^{\\mathrm{LHS}} $ and $ \\nu_{\\alpha}^{\\mathrm{RHS}} $ the total counts of element $ \\alpha $ on the left and right. The mass on each side is\n$$\nM_{\\mathrm{LHS}} \\ = \\ \\sum_{\\alpha \\in \\{\\mathrm{C},\\mathrm{H},\\mathrm{O},\\mathrm{P}\\}} w_{\\alpha} \\, \\nu_{\\alpha}^{\\mathrm{LHS}}, \n\\quad\nM_{\\mathrm{RHS}} \\ = \\ \\sum_{\\alpha \\in \\{\\mathrm{C},\\mathrm{H},\\mathrm{O},\\mathrm{P}\\}} w_{\\alpha} \\, \\nu_{\\alpha}^{\\mathrm{RHS}}.\n$$\nIf a reaction is atomically balanced, then for each $ \\alpha $ we have $ \\nu_{\\alpha}^{\\mathrm{LHS}} = \\nu_{\\alpha}^{\\mathrm{RHS}} $, hence $ M_{\\mathrm{LHS}} = M_{\\mathrm{RHS}} $ by linearity. This applies to $ R_{1}, R_{2}, R_{3}, R_{4} $, confirming mass balance.\n\nFor $ R_{5} $, the net change in elemental counts is $ (\\Delta \\mathrm{C}, \\Delta \\mathrm{H}, \\Delta \\mathrm{O}, \\Delta \\mathrm{P}) = (1, 2, 2, 0) $. The mass difference (RHS minus LHS) is\n$$\n\\Delta M \\ = \\ w_{\\mathrm{C}} \\cdot 1 \\ + \\ w_{\\mathrm{H}} \\cdot 2 \\ + \\ w_{\\mathrm{O}} \\cdot 2 \\ + \\ w_{\\mathrm{P}} \\cdot 0 \\ = \\ w_{\\mathrm{C}} \\ + \\ 2 w_{\\mathrm{H}} \\ + \\ 2 w_{\\mathrm{O}}.\n$$\nSince $ w_{\\mathrm{C}}, w_{\\mathrm{H}}, w_{\\mathrm{O}} > 0 $, it follows that $ \\Delta M > 0 $, so $ R_{5} $ is not mass balanced. This is consistent with the atomic imbalance found above.\n\nStep 4: Report $ k $, the number of atomically imbalanced reactions among $ \\{ R_{1}, R_{2}, R_{3}, R_{4}, R_{5} \\} $.\n\nFrom Step 2, exactly one reaction ($ R_{5} $) is imbalanced, so $ k = 1 $.", "answer": "$$\\boxed{1}$$", "id": "3312958"}, {"introduction": "A common feature of draft metabolic reconstructions is the presence of reactions that cannot carry flux under any steady-state condition, known as 'blocked reactions'. These often arise from missing pathways or dead-end metabolites, and identifying them is a crucial step in model curation to simplify the model and pinpoint potential knowledge gaps. This exercise guides you through the process of using an approach based on Flux Variability Analysis (FVA) to systematically determine the set of blocked reactions in a model [@problem_id:3312933].", "problem": "You are given a set of linear steady-state metabolic network models characterized by a stoichiometric matrix $S \\in \\mathbb{R}^{m \\times n}$, a flux vector $v \\in \\mathbb{R}^{n}$, and lower and upper bounds on each reaction flux given by $l \\in \\mathbb{R}^{n}$ and $u \\in \\mathbb{R}^{n}$. The feasible flux space is defined by the constraints $S v = 0$ and $l \\le v \\le u$. A reaction $i$ is said to be blocked if and only if for all feasible $v$, one has $v_i = 0$. Your task is to determine the set of blocked reactions for each provided test model using individual linear optimization tests per reaction: determine the maximum and minimum achievable flux for each reaction $i$ subject to $S v = 0$ and $l \\le v \\le u$. If both the maximum and minimum are numerically equal to $0$ (within a small numerical tolerance), then reaction $i$ is blocked.\n\nBase assumptions you must use:\n- The steady-state mass balance is encoded by $S v = 0$.\n- The feasible flux set is a convex polyhedron defined by linear equalities and bound constraints.\n- Determining whether a reaction $i$ is blocked can be done by solving two linear programs: maximize $v_i$ and minimize $v_i$ over the feasible set. If both optima are $0$ (within tolerance), then $v_i$ is necessarily $0$ for all feasible flux vectors.\n\nNumerical tolerance:\n- Treat any computed maximum or minimum with absolute value less than $\\epsilon$ as $0$, where $\\epsilon = 10^{-9}$.\n\nInput data (three test cases):\n\nTest case $1$:\n- $S_1 = \\begin{bmatrix} -1 & 1 & -1 \\\\ 1 & -1 & 0 \\end{bmatrix}$\n- $l_1 = \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\end{bmatrix}$, $u_1 = \\begin{bmatrix} 1000 \\\\ 1000 \\\\ 1000 \\end{bmatrix}$\n\nTest case $2$:\n- $S_2 = \\begin{bmatrix} 1 & -1 & 0 & -1 \\\\ 0 & 1 & -1 & 0 \\end{bmatrix}$\n- $l_2 = \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\\\ 0 \\end{bmatrix}$, $u_2 = \\begin{bmatrix} 10 \\\\ 10 \\\\ 10 \\\\ 0 \\end{bmatrix}$\n\nTest case $3$:\n- $S_3 = \\begin{bmatrix} -1 & 0 & 1 \\\\ 1 & -1 & 0 \\\\ 0 & 1 & -1 \\end{bmatrix}$\n- $l_3 = \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\end{bmatrix}$, $u_3 = \\begin{bmatrix} 5 \\\\ 5 \\\\ 0 \\end{bmatrix}$\n\nRequirements:\n- For each test case $k \\in \\{1, 2, 3\\}$, compute the set of indices of blocked reactions using the individual optimization tests described above.\n- Use zero-based indexing for reaction indices in the final reported lists.\n- Use the numerical tolerance $\\epsilon = 10^{-9}$ for deciding if a reaction is blocked.\n- If a linear program is infeasible for a particular objective in a given test, treat the corresponding optimum as $0$ for the purpose of the blocked-reaction test in that model.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of lists, one list per test case, enclosed in square brackets. For example: `[[0,1],[2],[]]`.\n- Each inner list must contain the zero-based indices (integers) of the blocked reactions for that test case, in non-decreasing order.\n\nPhysical units:\n- No physical units are involved; all quantities are dimensionless real numbers.\n\nAngle unit:\n- Not applicable.\n\nPercentages:\n- Not applicable.", "solution": "The problem requires the identification of blocked reactions in several steady-state metabolic network models. A reaction is defined as blocked if its corresponding flux is zero in every possible feasible flux distribution. The determination will be accomplished using an established computational method known as Flux Variability Analysis (FVA).\n\nA metabolic network operating at steady-state is described by the linear system of equations:\n$$ S v = 0 $$\nwhere $S \\in \\mathbb{R}^{m \\times n}$ is the stoichiometric matrix for a system of $m$ metabolites and $n$ reactions, and $v \\in \\mathbb{R}^{n}$ is the vector of reaction fluxes. The fluxes are further constrained by lower and upper bounds, $l \\in \\mathbb{R}^{n}$ and $u \\in \\mathbb{R}^{n}$ respectively, such that for each reaction $i \\in \\{0, 1, \\dots, n-1\\}$:\n$$ l_i \\le v_i \\le u_i $$\nThese constraints collectively define the feasible flux space, $\\mathcal{F}$, which is a convex polyhedron in $\\mathbb{R}^n$:\n$$ \\mathcal{F} = \\{ v \\in \\mathbb{R}^n \\mid S v = 0, \\ l \\le v \\le u \\} $$\nA reaction $i$ is blocked if and only if for every feasible flux vector $v \\in \\mathcal{F}$, the $i$-th component $v_i$ is equal to $0$.\n\nTo determine if a reaction $i$ is blocked, we must find the range of values that $v_i$ can take over the entire feasible set $\\mathcal{F}$. This is achieved by solving two linear programming (LP) problems for each reaction $i$: one to find its minimum possible flux, $v_i^{\\min}$, and one to find its maximum possible flux, $v_i^{\\max}$.\n\nThe minimization problem for reaction $i$ is formulated as:\n$$ v_i^{\\min} = \\min_{v} \\ c^T v $$\nsubject to:\n$$ S v = 0 $$\n$$ l \\le v \\le u $$\nwhere the objective function vector is $c = e_i$, the $i$-th standard basis vector (a vector with $1$ at index $i$ and $0$ elsewhere).\n\nThe maximization problem for reaction $i$ is formulated as:\n$$ v_i^{\\max} = \\max_{v} \\ c^T v $$\nsubject to the same constraints. This is computationally handled as a minimization problem by negating the objective function:\n$$ v_i^{\\max} = - \\min_{v} \\ (-e_i)^T v $$\nA reaction $i$ is blocked if and only if the solution to these two problems yields $v_i^{\\min} = 0$ and $v_i^{\\max} = 0$. Due to the nature of floating-point arithmetic in numerical solvers, this condition is tested against a small tolerance $\\epsilon = 10^{-9}$. A reaction $i$ is thus classified as blocked if:\n$$ |v_i^{\\min}| < \\epsilon \\quad \\text{and} \\quad |v_i^{\\max}| < \\epsilon $$\nThe problem specifies that if any linear program is found to be infeasible (meaning the set $\\mathcal{F}$ is empty), the corresponding optimum should be treated as $0$. This implies that if a model has no feasible steady-state solution, all its reactions will be declared blocked by this procedure.\n\nLet us illustrate with Test Case 1:\n- $S_1 = \\begin{bmatrix} -1 & 1 & -1 \\\\ 1 & -1 & 0 \\end{bmatrix}$\n- $l_1 = \\begin{bmatrix} 0 \\\\ 0 \\\\ 0 \\end{bmatrix}$, $u_1 = \\begin{bmatrix} 1000 \\\\ 1000 \\\\ 1000 \\end{bmatrix}$\n\nThe steady-state constraints $S_1 v = 0$ are:\n1. $-v_0 + v_1 - v_2 = 0$\n2. $v_0 - v_1 = 0$\n\nFrom equation (2), we deduce $v_0 = v_1$. Substituting this into equation (1) gives $-v_0 + v_0 - v_2 = 0$, which simplifies to $-v_2 = 0$, or $v_2 = 0$. This holds for any feasible flux vector $v \\in \\mathcal{F}$. Therefore, the flux through reaction $2$ (with zero-based index) is always zero. Its minimum and maximum achievable fluxes are both $0$, so it is a blocked reaction. For reactions $0$ and $1$, since $v_0 = v_1$ and the bounds are $0 \\le v_0 \\le 1000$ and $0 \\le v_1 \\le 1000$, the feasible flux is of the form $[a, a, 0]^T$ for any $a \\in [0, 1000]$. Thus, the flux ranges for $v_0$ and $v_1$ are $[0, 1000]$, and they are not blocked. The set of blocked reactions for this case is $\\{2\\}$.\n\nA similar analysis is applied to all three test cases. For each case, we iterate through every reaction, solve the corresponding pair of LPs using a numerical solver, and check the resulting optima against the tolerance $\\epsilon$ to identify the complete set of blocked reactions. The final implementation will use the `linprog` function from the `scipy.optimize` library to solve these optimization problems.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves the metabolic network blocked reaction problem for the three test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"S\": np.array([[-1, 1, -1], [1, -1, 0]]),\n            \"l\": np.array([0, 0, 0]),\n            \"u\": np.array([1000, 1000, 1000]),\n        },\n        {\n            \"S\": np.array([[1, -1, 0, -1], [0, 1, -1, 0]]),\n            \"l\": np.array([0, 0, 0, 0]),\n            \"u\": np.array([10, 10, 10, 0]),\n        },\n        {\n            \"S\": np.array([[-1, 0, 1], [1, -1, 0], [0, 1, -1]]),\n            \"l\": np.array([0, 0, 0]),\n            \"u\": np.array([5, 5, 0]),\n        },\n    ]\n\n    epsilon = 1e-9\n    \n    def find_blocked_reactions(S, l, u):\n        \"\"\"\n        Determines the set of blocked reactions for a given metabolic model.\n\n        A reaction i is blocked if its flux v_i must be 0 in any feasible\n        steady-state flux distribution. This is tested by minimizing and\n        maximizing v_i subject to the network constraints. If both the\n        minimum and maximum are 0 (within tolerance), the reaction is blocked.\n        \"\"\"\n        m, n = S.shape\n        b_eq = np.zeros(m)\n        bounds = [(li, ui) for li, ui in zip(l, u)]\n        \n        blocked_indices = []\n\n        for i in range(n):\n            # --- Minimize v_i ---\n            c_min = np.zeros(n)\n            c_min[i] = 1\n            res_min = linprog(c=c_min, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs')\n            \n            # Per problem instructions, if LP is infeasible (status=2), treat optimum as 0.\n            # We generalize this to any non-successful termination, as this typically\n            # indicates an infeasible model for FVA-type problems.\n            if not res_min.success:\n                min_flux = 0.0\n            else:\n                min_flux = res_min.fun\n\n            # --- Maximize v_i (by minimizing -v_i) ---\n            c_max = np.zeros(n)\n            c_max[i] = -1\n            res_max = linprog(c=c_max, A_eq=S, b_eq=b_eq, bounds=bounds, method='highs')\n\n            if not res_max.success:\n                max_flux = 0.0\n            else:\n                max_flux = -res_max.fun\n\n            # --- Check blocking condition ---\n            if abs(min_flux) < epsilon and abs(max_flux) < epsilon:\n                blocked_indices.append(i)\n                \n        return blocked_indices\n\n    all_results = []\n    for case in test_cases:\n        S = case[\"S\"]\n        l = case[\"l\"]\n        u = case[\"u\"]\n        blocked = find_blocked_reactions(S, l, u)\n        all_results.append(blocked)\n\n    # Format the final output string exactly as specified.\n    # e.g., [[0,1],[2],[]]\n    formatted_strings = []\n    for sublist in all_results:\n        s = f\"[{','.join(map(str, sublist))}]\"\n        formatted_strings.append(s)\n    \n    final_output = f\"[{','.join(formatted_strings)}]\"\n    \n    print(final_output)\n\nsolve()\n```", "id": "3312933"}, {"introduction": "One of the most notorious artifacts in draft metabolic models is the presence of spurious energy-generating cycles. These are thermodynamically infeasible loops that can produce energy carriers like ATP from nothing, violating the laws of thermodynamics and leading to biologically unrealistic predictions. This practice demonstrates how to leverage flux balance analysis as a powerful diagnostic tool to detect these cycles and propose targeted curation steps, such as correcting reaction reversibility or stoichiometry, to ensure the model's thermodynamic consistency [@problem_id:3312950].", "problem": "You are given three small draft metabolic networks represented by stoichiometric matrices under the steady-state assumption, where flux balance analysis is applicable. The goal is to detect a spurious adenosine triphosphate (ATP) generating loop by demonstrating growth-independent ATP production at steady state and to propose curation steps to break the loop.\n\nBase principles and definitions:\n- Under steady state, intracellular metabolite concentrations are constant, which implies the mass balance constraint $S \\, v = 0$, where $S$ is the stoichiometric matrix and $v$ is the flux vector.\n- Each reaction $j$ has lower and upper bounds $l_j \\le v_j \\le u_j$ encoding irreversibility and capacity.\n- A reversible reaction has $l_j < 0$ and $u_j > 0$. An irreversible forward reaction has $l_j = 0$ and $u_j > 0$.\n- Exchange reactions are closed, so no net uptake is allowed; the provided networks do not include explicit exchange reactions.\n- The detection criterion for an energy-generating cycle is the existence of a feasible steady-state flux vector $v$ with $S v = 0$, bounds satisfied, and a positive flux through an ATP synthesis reaction (denote it by $v_{\\mathrm{ATPS}}$) in the absence of any substrate uptake. If $\\max v_{\\mathrm{ATPS}} > 0$ at steady state with all exchanges closed, this indicates a spurious ATP-generating loop.\n- The unit for flux values is millimoles per gram dry weight per hour $\\left(\\mathrm{mmol}\\ \\mathrm{gDW}^{-1}\\ \\mathrm{h}^{-1}\\right)$. Report all fluxes in this unit as real numbers.\n\nYour program must:\n- For each test network, solve the linear program that maximizes $v_{\\mathrm{ATPS}}$ subject to $S v = 0$ and $l \\le v \\le u$. Declare that a spurious ATP-generating loop is detected if and only if the optimal objective value is strictly greater than a small nonnegative tolerance $\\epsilon$ where $\\epsilon = 10^{-9}$.\n- Propose a minimal curation step to break the loop by finding the smallest-cardinality set of reactions to block (set $v_j = 0$ for those reactions) such that the maximal $v_{\\mathrm{ATPS}}$ under the same constraints becomes exactly zero (within the tolerance $\\epsilon$). If multiple minimal-cardinality sets exist, choose the lexicographically smallest set of reaction indices (zero-based).\n- For networks where no loop is detected (i.e., the optimal objective is at most $\\epsilon$), the recommended curation set is the empty list.\n\nTest suite:\n- Metabolite ordering for all cases is fixed as $\\left[\\mathrm{ATP}, \\mathrm{ADP}, \\mathrm{Pi}, \\mathrm{H^+}, \\mathrm{H_2O}\\right]$.\n- Reaction ordering is case-specific as listed below. All numerical entries must be treated literally as given.\n\nCase A (spurious ATP-generating loop present):\n- Reactions:\n  - Reaction $0$ (ATP synthase, erroneously reversible): $\\mathrm{ADP} + \\mathrm{Pi} + \\mathrm{H^+} \\leftrightarrow \\mathrm{ATP} + \\mathrm{H_2O}$.\n  - Reaction $1$ (ATP maintenance demand): $\\mathrm{ATP} + \\mathrm{H_2O} \\rightarrow \\mathrm{ADP} + \\mathrm{Pi} + \\mathrm{H^+}$.\n- Stoichiometric matrix $S \\in \\mathbb{R}^{5 \\times 2}$ with column $j$ equal to the stoichiometric coefficients of reaction $j$:\n  - $S_{\\cdot,0} = \\begin{bmatrix} +1 \\\\ -1 \\\\ -1 \\\\ -1 \\\\ +1 \\end{bmatrix}$,\n  - $S_{\\cdot,1} = \\begin{bmatrix} -1 \\\\ +1 \\\\ +1 \\\\ +1 \\\\ -1 \\end{bmatrix}$.\n- Bounds:\n  - $l_0 = -1000$, $u_0 = +1000$,\n  - $l_1 = 0$, $u_1 = +1000$.\n- Objective: maximize $v_0$.\n\nCase B (curated by enforcing irreversibility to prevent ATP generation):\n- Same $S$ as Case A.\n- Bounds:\n  - $l_0 = -1000$, $u_0 = 0$,\n  - $l_1 = 0$, $u_1 = +1000$.\n- Objective: maximize $v_0$.\n\nCase C (curated by correcting proton stoichiometry to prevent proton-balanced loop):\n- Reactions:\n  - Reaction $0$ (ATP synthase without proton as substrate): $\\mathrm{ADP} + \\mathrm{Pi} \\leftrightarrow \\mathrm{ATP} + \\mathrm{H_2O}$.\n  - Reaction $1$ (ATP maintenance demand): $\\mathrm{ATP} + \\mathrm{H_2O} \\rightarrow \\mathrm{ADP} + \\mathrm{Pi} + \\mathrm{H^+}$.\n- Stoichiometric matrix $S \\in \\mathbb{R}^{5 \\times 2}$:\n  - $S_{\\cdot,0} = \\begin{bmatrix} +1 \\\\ -1 \\\\ -1 \\\\ 0 \\\\ +1 \\end{bmatrix}$,\n  - $S_{\\cdot,1} = \\begin{bmatrix} -1 \\\\ +1 \\\\ +1 \\\\ +1 \\\\ -1 \\end{bmatrix}$.\n- Bounds:\n  - $l_0 = -1000$, $u_0 = +1000$,\n  - $l_1 = 0$, $u_1 = +1000$.\n- Objective: maximize $v_0$.\n\nComputational and numerical requirements:\n- Use a linear programming solver to find the optimal objective value for each case.\n- Use a tolerance of $\\epsilon = 10^{-9}$ to decide positivity of the optimal objective and to decide whether the curated network eliminates the loop.\n- The minimal curation step search should consider blocking reactions by setting $v_j = 0$ and should return the smallest set of reaction indices that suffices to reduce the optimal objective to at most $\\epsilon$. If no loop is detected initially, return the empty set.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each case in the order $\\left[\\text{Case A}, \\text{Case B}, \\text{Case C}\\right]$, output a list with three entries: the loop detection boolean, the optimal objective value as a float, and the minimal curation set as a list of integers. For example, an output of the form `[[True, 1000.0, [0]], [False, 0.0, []], [False, 0.0, []]]` would be valid.", "solution": "The problem requires the detection and curation of spurious energy-generating cycles in simplified metabolic networks using flux balance analysis (FBA). The core principle of FBA under the steady-state assumption is the mass balance constraint $S v = 0$, where $S$ is the stoichiometric matrix and $v$ is the vector of reaction fluxes. Each flux $v_j$ is further constrained by lower and upper bounds, $l_j \\le v_j \\le u_j$.\n\nA spurious ATP-generating loop exists if it is possible to produce adenosine triphosphate (ATP) without any net substrate uptake. This corresponds to finding a feasible flux distribution $v$ that satisfies $S v = 0$, respects the flux bounds $l \\le v \\le u$, and achieves a positive flux through the ATP synthesis reaction, denoted $v_{\\mathrm{ATPS}}$. We formalize this detection as a linear programming (LP) problem. For the given cases, the ATP synthesis reaction is reaction $0$, so we maximize $v_0$:\n$$ \\begin{align*} \\text{maximize} \\quad & v_{0} \\\\ \\text{subject to} \\quad & S v = 0 \\\\ & l_j \\le v_j \\le u_j \\quad \\forall j \\end{align*} $$\nA loop is detected if the optimal objective value is strictly greater than a numerical tolerance $\\epsilon = 10^{-9}$.\n\nIf a loop is detected, curation involves identifying a minimal set of reactions to block (by setting their fluxes $v_j$ to $0$) such that the maximal $v_{0}$ in the modified network is reduced to $0$ (i.e., $\\le \\epsilon$). The search for a minimal curation set proceeds by combinatorially testing sets of reactions to block, starting with cardinality $k=1$, then $k=2$, and so on. For a given cardinality, sets are tested in lexicographical order of their reaction indices to ensure a unique solution. The first valid curation set found by this procedure is the desired answer.\n\nWe now analyze each case using this framework.\n\n**Case A:**\nThe stoichiometric matrix is $S_A = \\begin{bmatrix} 1 & -1 \\\\ -1 & 1 \\\\ -1 & 1 \\\\ -1 & 1 \\\\ 1 & -1 \\end{bmatrix}$. The second column is the negative of the first, $S_{\\cdot,1} = -S_{\\cdot,0}$. The mass balance constraint $S v = 0$ expands to $S_{\\cdot,0} v_0 + S_{\\cdot,1} v_1 = 0$, which simplifies to $S_{\\cdot,0} v_0 - S_{\\cdot,0} v_1 = S_{\\cdot,0}(v_0 - v_1) = 0$. Since $S_{\\cdot,0}$ is a non-zero vector, this implies the scalar constraint $v_0 - v_1 = 0$, or $v_0 = v_1$.\n\nThe flux bounds are:\n- Reaction $0$: $-1000 \\le v_0 \\le 1000$\n- Reaction $1$: $0 \\le v_1 \\le 1000$\n\nCombining the constraint $v_0 = v_1$ with the bounds on $v_1$ gives the constraint $0 \\le v_0 \\le 1000$. The feasible region for $v_0$ is the intersection of its own bounds and this derived constraint, which is $[0, 1000]$. The objective is to maximize $v_0$. The optimal value is therefore $\\max v_0 = 1000$.\nSince $1000 > 10^{-9}$, a spurious ATP-generating loop is detected.\n\nFor curation, we search for the smallest set of reactions to block.\n- **Cardinality $k=1$**:\n  - Test blocking reaction $0$: We set $v_0 = 0$. The constraint $v_0 = v_1$ implies $v_1 = 0$. The new LP seeks to maximize $v_0$ under the constraint $v_0=0$, giving an optimal value of $0$. Since $0 \\le \\epsilon$, blocking reaction $0$ is a valid curation. The set of indices is $\\{0\\}$.\n  - Since we found a valid curation set of size $1$, and it is the first one tested in lexicographical order, $\\{0\\}$ is the minimal curation set.\n\nResult for Case A: Loop detected is True, optimal value is $1000.0$, curation set is $[0]$.\n\n**Case B:**\nThe stoichiometric matrix is the same as in Case A, so the constraint $v_0 = v_1$ still holds.\nThe flux bounds are different:\n- Reaction $0$: $-1000 \\le v_0 \\le 0$\n- Reaction $1$: $0 \\le v_1 \\le 1000$\n\nSubstituting $v_0 = v_1$ into the bounds for $v_1$ yields $0 \\le v_0 \\le 1000$. The feasible region for $v_0$ is the intersection of its direct bounds ($-1000 \\le v_0 \\le 0$) and the derived bounds ($0 \\le v_0 \\le 1000$). The only value satisfying both $v_0 \\le 0$ and $v_0 \\ge 0$ is $v_0=0$.\nThe objective is to maximize $v_0$. The only feasible value is $0$, so the optimal value is $\\max v_0 = 0$.\nSince $0 \\le 10^{-9}$, no spurious loop is detected. The curation set is empty.\n\nResult for Case B: Loop detected is False, optimal value is $0.0$, curation set is [].\n\n**Case C:**\nThe stoichiometric matrix is $S_C = \\begin{bmatrix} 1 & -1 \\\\ -1 & 1 \\\\ -1 & 1 \\\\ 0 & 1 \\\\ 1 & -1 \\end{bmatrix}$.\nThe system of linear equations $S_C v = 0$ is:\n$v_0 - v_1 = 0$\n$-v_0 + v_1 = 0$\n$-v_0 + v_1 = 0$\n$0 \\cdot v_0 + 1 \\cdot v_1 = 0 \\implies v_1 = 0$\n$v_0 - v_1 = 0$\n\nFrom a subset of these equations, we find $v_1 = 0$ and $v_0 = v_1$, which forces the unique solution $v_0 = 0$ and $v_1 = 0$. This solution $(0, 0)$ is feasible as it satisfies the given bounds ($-1000 \\le 0 \\le 1000$ and $0 \\le 0 \\le 1000$).\nSince the only feasible flux vector is $(0, 0)$, the objective to maximize $v_0$ has an optimal value of $0$.\nSince $0 \\le 10^{-9}$, no spurious loop is detected. The curation set is empty.\n\nResult for Case C: Loop detected is False, optimal value is $0.0$, curation set is [].", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\nfrom itertools import combinations\n\ndef solve():\n    \"\"\"\n    Solves for spurious ATP loops in three metabolic network test cases,\n    and proposes minimal curation steps.\n    \"\"\"\n    TOLERANCE = 1e-9\n\n    def solve_lp(c, S, bounds):\n        \"\"\"\n        Wrapper function to solve the LP max c^T x, returning the optimal value.\n        linprog solves min problems, so we maximize by minimizing -c^T x.\n        \"\"\"\n        # The 'highs-ds' method is a robust choice for this type of LP.\n        res = linprog(c, A_eq=S, b_eq=np.zeros(S.shape[0]), bounds=bounds, method='highs-ds')\n        if res.success:\n            # res.fun is the minimum of c^T*v. If c=-e_i, this is -max(v_i).\n            return -res.fun\n        # Return a value indicating no feasible solution generating positive objective\n        return -np.inf\n\n    def find_curation(S, bounds, obj_idx, tol):\n        \"\"\"\n        Finds the minimal-cardinality, lexicographically smallest set of reactions\n        to block to eliminate a spurious loop.\n        \"\"\"\n        n_reactions = S.shape[1]\n        c = np.zeros(n_reactions)\n        c[obj_idx] = -1.0\n\n        # Iterate through the cardinality of the blocking set\n        for k in range(1, n_reactions + 1):\n            # Iterate through all combinations of reactions of size k\n            # combinations() generates tuples in lexicographical order\n            for indices_to_block in combinations(range(n_reactions), k):\n                new_bounds = list(bounds)\n                for idx in indices_to_block:\n                    # Block reaction by setting its flux to 0\n                    new_bounds[idx] = (0, 0)\n                \n                max_v_curated = solve_lp(c, S, new_bounds)\n                \n                if max_v_curated is not None and max_v_curated <= tol:\n                    return list(indices_to_block)\n        \n        # This part should not be reached if a loop was detected as\n        # blocking all reactions guarantees an objective of 0.\n        return []\n\n    # Define test cases from the problem statement\n    test_cases = [\n        {\n            # Case A: Spurious loop present due to reversibility\n            \"S\": np.array([[1, -1], [-1, 1], [-1, 1], [-1, 1], [1, -1]], dtype=np.float64),\n            \"bounds\": [(-1000.0, 1000.0), (0.0, 1000.0)],\n        },\n        {\n            # Case B: Loop fixed by enforcing irreversibility\n            \"S\": np.array([[1, -1], [-1, 1], [-1, 1], [-1, 1], [1, -1]], dtype=np.float64),\n            \"bounds\": [(-1000.0, 0.0), (0.0, 1000.0)],\n        },\n        {\n            # Case C: Loop fixed by correcting stoichiometry\n            \"S\": np.array([[1, -1], [-1, 1], [-1, 1], [0, 1], [1, -1]], dtype=np.float64),\n            \"bounds\": [(-1000.0, 1000.0), (0.0, 1000.0)],\n        },\n    ]\n\n    all_case_results = []\n    \n    for case in test_cases:\n        S = case[\"S\"]\n        bounds = case[\"bounds\"]\n        n_reactions = S.shape[1]\n        atp_synthase_idx = 0  # Maximize v_0\n\n        # Create the objective vector for maximization: c = -e_0\n        c = np.zeros(n_reactions)\n        c[atp_synthase_idx] = -1.0\n        \n        # 1. Detect loop\n        max_v = solve_lp(c, S, bounds)\n        if max_v is None or max_v < 0: # Handle solver failures or negative max\n             max_v = 0.0\n\n        detected = max_v > TOLERANCE\n        \n        # 2. Propose curation if necessary\n        curation_set = []\n        if detected:\n            curation_set = find_curation(S, bounds, atp_synthase_idx, TOLERANCE)\n        \n        all_case_results.append([detected, float(max_v), curation_set])\n\n    # Format the final output as a string representation of a list of lists.\n    # The example output format shows spaces after commas. Using str() on the\n    # list of lists achieves this formatting.\n    print(str(all_case_results))\n\nsolve()\n```", "id": "3312950"}]}