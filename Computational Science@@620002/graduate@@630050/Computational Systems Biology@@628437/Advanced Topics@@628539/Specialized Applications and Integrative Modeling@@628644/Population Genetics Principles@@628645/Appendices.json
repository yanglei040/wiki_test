{"hands_on_practices": [{"introduction": "The Hardy-Weinberg Equilibrium (HWE) principle is the cornerstone of population genetics, providing a null model that describes allele and genotype frequencies in a population that is not evolving. Testing for deviations from HWE is a critical first step in quality control for population genomic data and can reveal the action of evolutionary forces like selection, non-random mating, or genetic drift. This practice provides foundational experience in applying the HWE model to observed data and using the chi-square test to statistically evaluate a population's equilibrium state [@problem_id:3338784].", "problem": "A high-throughput variant-calling pipeline in computational systems biology is performing quality control on an autosomal biallelic single-nucleotide polymorphism in a panmictic diploid population. After filtering out low-quality genotype calls, a total of $N = 500$ individuals remain with confident genotypes, with observed genotype counts: $n_{AA} = 210$, $n_{Aa} = 230$, and $n_{aa} = 60$. Assume random mating, large population size, no selection, no mutation, and no migration so that Hardy–Weinberg Equilibrium (HWE) is the appropriate null model.\n\nUsing only foundational definitions from population genetics, compute the allele frequencies for allele $A$ and allele $a$ from these counts, then compute the expected genotype counts under the HWE null model, and finally compute the classical Pearson chi-square test statistic for deviation from HWE using the observed and expected genotype counts, without any continuity correction or small-sample adjustments.\n\nReport the chi-square statistic as a single real-valued number, rounded to four significant figures. Do not report any other quantity. No units are required.", "solution": "The problem statement has been evaluated and is deemed valid. It is scientifically grounded in the principles of population genetics, specifically the Hardy–Weinberg Equilibrium (HWE) model and chi-square goodness-of-fit testing. The problem is well-posed, with all necessary data provided and internally consistent, allowing for the calculation of a unique solution. The language is objective and precise.\n\nThe task is to compute the Pearson chi-square test statistic for deviation from HWE, given observed genotype counts for a biallelic locus in a diploid population. The solution proceeds in three stages: first, calculating the allele frequencies from the observed data; second, calculating the expected genotype counts under the HWE null model; and third, calculating the chi-square statistic based on the observed and expected counts.\n\nThe provided data are the observed genotype counts for a total sample of $N=500$ individuals:\n-   Number of individuals with genotype $AA$: $n_{AA} = 210$\n-   Number of individuals with genotype $Aa$: $n_{Aa} = 230$\n-   Number of individuals with genotype $aa$: $n_{aa} = 60$\n\nThe total number of individuals is confirmed by the sum of the counts: $n_{AA} + n_{Aa} + n_{aa} = 210 + 230 + 60 = 500 = N$.\n\n**1. Calculation of Allele Frequencies**\n\nThe frequencies of the alleles $A$ and $a$, denoted by $p$ and $q$ respectively, are calculated from the observed genotype counts. Since the population is diploid, the total number of alleles in the sample is $2N = 2 \\times 500 = 1000$.\n\nThe number of $A$ alleles is derived from the homozygotes ($AA$) and heterozygotes ($Aa$). Each $AA$ individual carries two $A$ alleles, and each $Aa$ individual carries one $A$ allele.\nThe total count of allele $A$ is:\n$$ \\text{Count}(A) = 2 \\times n_{AA} + 1 \\times n_{Aa} = 2 \\times 210 + 230 = 420 + 230 = 650 $$\nThe frequency of allele $A$, $p$, is the ratio of the count of $A$ alleles to the total number of alleles:\n$$ p = \\frac{2 n_{AA} + n_{Aa}}{2N} = \\frac{650}{1000} = 0.65 $$\n\nSimilarly, the frequency of allele $a$, $q$, is calculated. Each $aa$ individual carries two $a$ alleles, and each $Aa$ individual carries one $a$ allele.\nThe total count of allele $a$ is:\n$$ \\text{Count}(a) = 2 \\times n_{aa} + 1 \\times n_{Aa} = 2 \\times 60 + 230 = 120 + 230 = 350 $$\nThe frequency of allele $a$, $q$, is:\n$$ q = \\frac{2 n_{aa} + n_{Aa}}{2N} = \\frac{350}{1000} = 0.35 $$\nAs a check, the sum of the allele frequencies must be $1$: $p + q = 0.65 + 0.35 = 1.00$.\n\n**2. Calculation of Expected Genotype Counts under HWE**\n\nThe HWE principle states that for a population under the specified assumptions, the expected genotype frequencies are given by the terms of the binomial expansion $(p+q)^2 = p^2 + 2pq + q^2$.\n-   Expected frequency of genotype $AA$: $f_E(AA) = p^2 = (0.65)^2 = 0.4225$\n-   Expected frequency of genotype $Aa$: $f_E(Aa) = 2pq = 2 \\times 0.65 \\times 0.35 = 0.4550$\n-   Expected frequency of genotype $aa$: $f_E(aa) = q^2 = (0.35)^2 = 0.1225$\n\nTo find the expected genotype counts ($E_i$), we multiply these expected frequencies by the total sample size, $N=500$.\n-   Expected count of $AA$: $E_{AA} = N \\times p^2 = 500 \\times 0.4225 = 211.25$\n-   Expected count of $Aa$: $E_{Aa} = N \\times 2pq = 500 \\times 0.4550 = 227.5$\n-   Expected count of $aa$: $E_{aa} = N \\times q^2 = 500 \\times 0.1225 = 61.25$\n\nThe sum of expected counts must equal the total sample size: $211.25 + 227.5 + 61.25 = 500$.\n\n**3. Calculation of the Pearson Chi-Square Statistic**\n\nThe Pearson chi-square ($\\chi^2$) statistic is used to measure the discrepancy between observed ($O_i$) and expected ($E_i$) counts. The formula is:\n$$ \\chi^2 = \\sum_{i} \\frac{(O_i - E_i)^2}{E_i} $$\nThe three categories are the genotypes $AA$, $Aa$, and $aa$. Let $O_{AA}=n_{AA}$, $O_{Aa}=n_{Aa}$, and $O_{aa}=n_{aa}$.\n\nThe calculation proceeds as follows:\n$$ \\chi^2 = \\frac{(O_{AA} - E_{AA})^2}{E_{AA}} + \\frac{(O_{Aa} - E_{Aa})^2}{E_{Aa}} + \\frac{(O_{aa} - E_{aa})^2}{E_{aa}} $$\nSubstituting the observed and expected values:\n$$ \\chi^2 = \\frac{(210 - 211.25)^2}{211.25} + \\frac{(230 - 227.5)^2}{227.5} + \\frac{(60 - 61.25)^2}{61.25} $$\nCalculating the terms:\n$$ \\chi^2 = \\frac{(-1.25)^2}{211.25} + \\frac{(2.5)^2}{227.5} + \\frac{(-1.25)^2}{61.25} $$\n$$ \\chi^2 = \\frac{1.5625}{211.25} + \\frac{6.25}{227.5} + \\frac{1.5625}{61.25} $$\n$$ \\chi^2 \\approx 0.007396213 + 0.027472527 + 0.025510204 $$\n$$ \\chi^2 \\approx 0.060378944 $$\n\nThe problem requires the result to be rounded to four significant figures. The first significant figure is the $6$ in the hundredths place. The four significant figures are $0.06037$. The fifth significant digit is $8$, so we round up the fourth digit.\n$$ \\chi^2 \\approx 0.06038 $$\nThis is the final value for the chi-square statistic.", "answer": "$$\\boxed{0.06038}$$", "id": "3338784"}, {"introduction": "While single-locus models are fundamental, genomes are collections of linked loci that do not always segregate independently. Linkage Disequilibrium (LD) quantifies the non-random association between alleles at different loci, and its breakdown by recombination is a key dynamic process shaping genetic variation. This computational exercise challenges you to model this decay, translating the theoretical relationship between LD, recombination, and time into a practical simulation to test against observed data [@problem_id:3338808].", "problem": "Consider two biallelic loci with alleles denoted by $A/a$ and $B/b$. In a randomly mating population with no selection, migration, or mutation, assume that gamete formation has a recombination fraction $r$ between the loci. For a sample taken at generation $0$ and again at generation $t$, suppose you observe haplotype counts for $AB$, $Ab$, $aB$, and $ab$. Starting from the core definitions of haplotype frequencies and allele frequencies, define the linkage disequilibrium measure $D$ and the squared correlation between loci $r^2$, and derive the generational recursion for $D$ under recombination alone. Then, implement these derivations to compute $D$ and $r^2$ at generation $0$ and generation $t$, and test whether the observed decay of $D$ from generation $0$ to generation $t$ is consistent with the factor $(1 - r)^t$ under random mating.\n\nYour program must:\n- Convert observed haplotype counts at generation $0$ and generation $t$ into haplotype frequencies, and from these, compute $D_0$ and $D_t$ using the definition of linkage disequilibrium based on haplotype and allele frequencies.\n- Compute $r^2$ for generation $0$ and generation $t$ using the definition based on $D$ and the marginal allele frequencies.\n- Using the provided recombination fraction $r$ and number of generations $t$, compute the predicted $D_t$ under recombination alone from the recursion you derive.\n- Compare the observed $D_t$ and the predicted $D_t$ by computing the absolute difference $\\delta = |D_t - D_0 (1 - r)^t|$. Declare a match if $\\delta \\le \\epsilon$, where $\\epsilon$ is a fixed tolerance equal to $10^{-3}$.\n- If either locus is monomorphic so that the variance term in the denominator of $r^2$ is zero, define $r^2$ to be $0$ for that generation for the purpose of the computation.\n\nUse the following test suite. Each test case is a tuple consisting of the generation $0$ haplotype counts $(n_{AB}^{(0)}, n_{Ab}^{(0)}, n_{aB}^{(0)}, n_{ab}^{(0)})$, the generation $t$ haplotype counts $(n_{AB}^{(t)}, n_{Ab}^{(t)}, n_{aB}^{(t)}, n_{ab}^{(t)})$, the number of generations $t$, and the recombination fraction $r$:\n- Test case $1$ (general case with moderate recombination and nonzero $D$): $((3000, 3000, 1000, 3000), (2754, 3246, 1246, 2754), 5, 0.1)$.\n- Test case $2$ (boundary case with $r = 0$, so no decay of $D$): $((700, 300, 300, 700), (700, 300, 300, 700), 7, 0.0)$.\n- Test case $3$ (near maximal recombination with $r \\approx 0.5$, fast decay): $((2080, 3520, 320, 2080), (1705, 3895, 695, 1705), 4, 0.5)$.\n- Test case $4$ (initial $D \\approx 0$ at linkage equilibrium): $((1200, 800, 1800, 1200), (1200, 800, 1800, 1200), 10, 0.2)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each entry corresponds to a test case and is a boolean indicating whether the observed decay of $D$ matches the predicted $(1 - r)^t$ within the tolerance $\\epsilon = 10^{-3}$. The exact output format must be $[b_1,b_2,b_3,b_4]$, where each $b_i$ is either $True$ or $False$ in plain text with no additional characters or whitespace.", "solution": "The problem requires the derivation and application of the fundamental equations of recombination's effect on linkage disequilibrium ($D$) in a simplified population genetics model. We are asked to validate whether observed changes in haplotype frequencies between two time points, generation $0$ and generation $t$, are consistent with the theoretical decay of $D$.\n\nFirst, we establish the necessary definitions. Let the frequencies of the four possible haplotypes for two biallelic loci ($A/a$ and $B/b$) be denoted by $p_{AB}$, $p_{Ab}$, $p_{aB}$, and $p_{ab}$. These are estimated from the sample counts ($n_{AB}$, $n_{Ab}$, $n_{aB}$, $n_{ab}$) by dividing by the total sample size $N = n_{AB} + n_{Ab} + n_{aB} + n_{ab}$. The sum of these frequencies is unity: $p_{AB} + p_{Ab} + p_{aB} + p_{ab} = 1$.\n\nFrom these haplotype frequencies, we can define the marginal allele frequencies for allele $A$ ($p_A$), allele $a$ ($p_a$), allele $B$ ($p_B$), and allele $b$ ($p_b$):\n$$ p_A = p_{AB} + p_{Ab} $$\n$$ p_a = p_{aB} + p_{ab} = 1 - p_A $$\n$$ p_B = p_{AB} + p_{aB} $$\n$$ p_b = p_{Ab} + p_{ab} = 1 - p_B $$\nUnder the specified model (random mating, no selection, mutation, or migration), these allele frequencies remain constant across generations in an infinitely large population.\n\nLinkage disequilibrium, $D$, quantifies the non-random association of alleles at the two loci. It is defined as the deviation of the frequency of a given haplotype (e.g., $AB$) from the frequency expected under random association (linkage equilibrium), which would be the product of the corresponding allele frequencies.\n$$ D = p_{AB} - p_A p_B $$\nUsing the relationships between haplotype and allele frequencies, we can show that this definition leads to equivalent expressions for the other haplotypes:\n$p_{Ab} = p_A(1-p_B) - D = p_A p_b - D$\n$p_{aB} = (1-p_A)p_B - D = p_a p_B - D$\n$p_{ab} = (1-p_A)(1-p_B) + D = p_a p_b + D$\nA symmetric and commonly used form for calculating $D$ is $D = p_{AB}p_{ab} - p_{Ab}p_{aB}$. This can be derived from the primary definition:\n$p_{AB}p_{ab} - p_{Ab}p_{aB} = (p_A p_B + D)(p_a p_b + D) - (p_A p_b - D)(p_a p_B - D)$\n$= (p_A p_B p_a p_b + D(p_A p_B + p_a p_b) + D^2) - (p_A p_b p_a p_B - D(p_A p_b + p_a p_B) + D^2)$\n$= D(p_A p_B + p_a p_b + p_A p_b + p_a p_B) = D(p_A(p_B+p_b) + p_a(p_b+p_B)) = D(p_A + p_a) = D$.\n\nThe squared correlation coefficient, $r^2$, is a normalized measure of $D$ that is less dependent on allele frequencies:\n$$ r^2 = \\frac{D^2}{p_A p_a p_B p_b} $$\nThe denominator, $p_A p_a p_B p_b$, is the product of the variances of the two loci, assuming a binary encoding for the alleles (e.g., $A=1, a=0$). If either locus is monomorphic (e.g., $p_A=1$ or $p_A=0$), this denominator becomes zero, and $r^2$ is defined as $0$.\n\nNext, we derive the recursion for $D$ across generations. In a randomly mating population, the haplotype frequencies in the gamete pool for the next generation are determined by the frequencies in the current generation and the recombination fraction, $r$. A fraction $(1-r)$ of haplotypes are non-recombinant, while a fraction $r$ are recombinant. The frequency of the $AB$ haplotype at generation $t+1$, denoted $p_{AB, t+1}$, is given by:\n$$ p_{AB, t+1} = (1-r) p_{AB, t} + r p_{A,t} p_{B,t} $$\nThe first term represents the $AB$ haplotypes from generation $t$ that did not undergo recombination. The second term represents new $AB$ haplotypes formed by recombination events, which bring together an $A$ allele and a $B$ allele from homologous chromosomes. In a randomly mating pool, the frequency of such recombinant pairings is proportional to the product of the allele frequencies. Since allele frequencies $p_A$ and $p_B$ are constant over time, we can drop the subscript $t$.\n\nNow we can write the recursion for $D_{t+1}$:\n$$ D_{t+1} = p_{AB, t+1} - p_A p_B $$\nSubstituting the expression for $p_{AB, t+1}$:\n$$ D_{t+1} = \\left( (1-r) p_{AB, t} + r p_A p_B \\right) - p_A p_B $$\n$$ D_{t+1} = (1-r) p_{AB, t} - p_A p_B (1-r) $$\n$$ D_{t+1} = (1-r) (p_{AB, t} - p_A p_B) $$\n$$ D_{t+1} = (1-r) D_t $$\nThis simple recurrence relation shows that linkage disequilibrium decays geometrically by a factor of $(1-r)$ each generation. By unrolling the recursion, we obtain the value of $D$ at generation $t$ as a function of its initial value $D_0$:\n$$ D_t = (1-r)^t D_0 $$\n\nThe computational procedure to solve the problem for each test case is as follows:\n1.  For the generation $0$ data $(n_{AB}^{(0)}, n_{Ab}^{(0)}, n_{aB}^{(0)}, n_{ab}^{(0)})$, calculate the total count $N_0$ and the corresponding haplotype frequencies $p_{AB,0}, p_{Ab,0}, p_{aB,0}, p_{ab,0}$.\n2.  From these frequencies, compute the allele frequencies $p_{A,0}$ and $p_{B,0}$.\n3.  Calculate the initial linkage disequilibrium $D_0 = p_{AB,0} - p_{A,0} p_{B,0}$.\n4.  Repeat steps $1$ and $2$ for the generation $t$ data to find the observed haplotype and allele frequencies, and then compute the observed linkage disequilibrium $D_t^{obs} = p_{AB,t} - p_{A,t} p_{B,t}$. The problem setup ensures that allele frequencies are constant between the samples.\n5.  Calculate the predicted linkage disequilibrium at generation $t$ using the derived formula: $D_t^{pred} = D_0 (1-r)^t$.\n6.  Compute the absolute difference $\\delta = |D_t^{obs} - D_t^{pred}|$.\n7.  Compare $\\delta$ to the tolerance $\\epsilon = 10^{-3}$. If $\\delta \\le \\epsilon$, the observed decay is consistent with the model, and the result is `True`; otherwise, it is `False`.\nThe calculation of $r^2$ for both generations is also performed as per the definition, handling the case of monomorphic loci.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the population genetics problem for a suite of test cases.\n    \"\"\"\n\n    # Test suite as defined in the problem description.\n    test_cases = [\n        # ((n_AB0, n_Ab0, n_aB0, n_ab0), (n_ABt, n_Abt, n_aBt, n_abt), t, r)\n        ((3000, 3000, 1000, 3000), (2754, 3246, 1246, 2754), 5, 0.1),\n        ((700, 300, 300, 700), (700, 300, 300, 700), 7, 0.0),\n        ((2080, 3520, 320, 2080), (1705, 3895, 695, 1705), 4, 0.5),\n        ((1200, 800, 1800, 1200), (1200, 800, 1800, 1200), 10, 0.2),\n    ]\n\n    tolerance = 1e-3\n    results = []\n\n    for case in test_cases:\n        counts_0, counts_t, t, r = case\n        \n        # --- Analyze Generation 0 ---\n        # Convert counts to numpy array for vectorized operations\n        counts_0_arr = np.array(counts_0, dtype=float)\n        N_0 = counts_0_arr.sum()\n        \n        if N_0 == 0:\n            # If there's no sample, the state is undefined.\n            # For this problem, we can assume N  0 based on test cases.\n            # Continue to the next case or handle as an error.\n            results.append(False) # Or some other error indicator\n            continue\n            \n        # Haplotype frequencies: p_AB, p_Ab, p_aB, p_ab\n        freqs_0 = counts_0_arr / N_0\n        p_AB_0, p_Ab_0, p_aB_0, p_ab_0 = freqs_0\n\n        # Allele frequencies\n        p_A_0 = p_AB_0 + p_Ab_0\n        p_a_0 = 1.0 - p_A_0\n        p_B_0 = p_AB_0 + p_aB_0\n        p_b_0 = 1.0 - p_B_0\n\n        # Linkage Disequilibrium D_0\n        D_0 = p_AB_0 - p_A_0 * p_B_0\n        \n        # Squared correlation r^2_0\n        r2_denom_0 = p_A_0 * p_a_0 * p_B_0 * p_b_0\n        r_sq_0 = (D_0**2 / r2_denom_0) if r2_denom_0  0 else 0.0\n\n        # --- Analyze Generation t ---\n        counts_t_arr = np.array(counts_t, dtype=float)\n        N_t = counts_t_arr.sum()\n\n        if N_t == 0:\n            results.append(False)\n            continue\n        \n        # Haplotype frequencies: p_AB, p_Ab, p_aB, p_ab\n        freqs_t = counts_t_arr / N_t\n        p_AB_t, p_Ab_t, p_aB_t, p_ab_t = freqs_t\n\n        # Allele frequencies\n        p_A_t = p_AB_t + p_Ab_t\n        p_a_t = 1.0 - p_A_t\n        p_B_t = p_AB_t + p_aB_t\n        p_b_t = 1.0 - p_B_t\n\n        # Observed Linkage Disequilibrium D_t_obs\n        D_t_obs = p_AB_t - p_A_t * p_B_t\n\n        # Squared correlation r^2_t\n        r2_denom_t = p_A_t * p_a_t * p_B_t * p_b_t\n        r_sq_t = (D_t_obs**2 / r2_denom_t) if r2_denom_t  0 else 0.0\n\n        # --- Prediction and Comparison ---\n        # Predicted D at generation t based on theory\n        D_t_pred = D_0 * (1.0 - r)**t\n\n        # Absolute difference between observed and predicted D_t\n        delta = abs(D_t_obs - D_t_pred)\n\n        # Check if the difference is within the specified tolerance\n        match = delta = tolerance\n        results.append(match)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3338808"}, {"introduction": "Evolution often acts on complex traits influenced by many genes, which may themselves be genetically correlated. To understand and predict the evolution of these quantitative traits, we move from single-locus thinking to a multivariate framework. This advanced practice introduces the Lande equation, a powerful tool that predicts the multidimensional response to selection by integrating the genetic architecture of traits ($G$) with the forces of selection ($\\boldsymbol{\\beta}$) [@problem_id:3338787].", "problem": "You are to formalize and implement a multivariate response-to-selection model for quantitative traits in a sexually reproducing population under assumptions standard in quantitative genetics. Begin from fundamental definitions: the Price equation, the definition of additive genetic values and their covariance, and the approximation of relative fitness by a first-order Taylor expansion around the current trait mean. Use these to derive a linear operator that maps the directional selection gradient to the expected change in the mean trait vector in one generation. State any regularity assumptions you require (such as small selection, random mating, negligible epistasis, and linkage equilibrium). Then, design and implement a simulation of correlated adaptation across multiple generations when the additive genetic covariance matrix is constant and the directional selection gradient is constant.\n\nBase your derivation on the following well-tested foundations:\n- The Price equation: the expected change in a population mean of a trait vector $ \\boldsymbol{z} $ over one generation is given by the covariance between additive genetic values and relative fitness, plus a transmission term that is negligible under additivity and random mating.\n- The additive genetic covariance matrix $ G $ is defined as $ G = \\operatorname{Cov}(\\boldsymbol{a}, \\boldsymbol{a}) $, where $ \\boldsymbol{a} $ denotes the additive genetic values for the traits.\n- The phenotypic selection gradient $ \\boldsymbol{\\beta} $ is defined as the gradient of the logarithm of mean fitness with respect to the trait vector $ \\boldsymbol{z} $, evaluated at the current mean, which under a linear approximation of relative fitness implies $ w(\\boldsymbol{z}) \\approx 1 + \\boldsymbol{\\beta}^{\\top}(\\boldsymbol{z} - \\bar{\\boldsymbol{z}}) $.\n\nTasks:\n1. Derive from first principles an explicit matrix-vector expression for the single-generation response of the mean trait vector $ \\Delta \\bar{\\boldsymbol{z}} $ in terms of $ G $ and $ \\boldsymbol{\\beta} $ under the assumptions above.\n2. Implement a discrete-time simulation for $ T $ generations under constant $ G $ and constant $ \\boldsymbol{\\beta} $, starting from an initial mean trait vector $ \\bar{\\boldsymbol{z}}_{0} $. At each generation, update the mean trait vector using your derived single-generation response.\n3. For each test case below, compute the final mean trait vector $ \\bar{\\boldsymbol{z}}_{T} $ after $ T $ generations. Express each entry of $ \\bar{\\boldsymbol{z}}_{T} $ as a decimal rounded to exactly six digits after the decimal point.\n\nAssumptions to adopt for the derivation and simulation:\n- Relative fitness is scaled so that its expectation is $ 1 $ each generation.\n- Selection is weak enough for the linear approximation of relative fitness to be accurate near the current mean.\n- Additive effects dominate, with random mating and negligible epistasis, such that the transmission term in the Price equation can be ignored and $ G $ is constant across the simulated time horizon.\n- Linkage Disequilibrium (LD) is negligible so that $ G $ captures the additive genetic covariance structure.\n\nSimulation model:\n- Let $ \\bar{\\boldsymbol{z}}_{t+1} = \\bar{\\boldsymbol{z}}_{t} + \\Delta \\bar{\\boldsymbol{z}} $, with $ \\Delta \\bar{\\boldsymbol{z}} $ the single-generation response derived in Task 1.\n- Keep $ G $ and $ \\boldsymbol{\\beta} $ constant across $ t = 0, 1, \\dots, T-1 $.\n\nTest suite:\nProvide the final mean trait vectors for the following five test cases. All matrices and vectors are given explicitly.\n\n- Case A (two traits, positive genetic covariance yields correlated response):\n  - $ G = \\begin{bmatrix} 0.5  0.2 \\\\ 0.2  0.3 \\end{bmatrix} $, $ \\boldsymbol{\\beta} = \\begin{bmatrix} 0.1 \\\\ 0.0 \\end{bmatrix} $, $ \\bar{\\boldsymbol{z}}_{0} = \\begin{bmatrix} 0.0 \\\\ 0.0 \\end{bmatrix} $, $ T = 10 $.\n\n- Case B (three traits, negative covariance induces trade-off):\n  - $ G = \\begin{bmatrix} 0.4  -0.1  0.0 \\\\ -0.1  0.2  0.05 \\\\ 0.0  0.05  0.3 \\end{bmatrix} $, $ \\boldsymbol{\\beta} = \\begin{bmatrix} 0.0 \\\\ 0.2 \\\\ 0.0 \\end{bmatrix} $, $ \\bar{\\boldsymbol{z}}_{0} = \\begin{bmatrix} 0.0 \\\\ 0.0 \\\\ 0.0 \\end{bmatrix} $, $ T = 5 $.\n\n- Case C (two traits, singular $ G $ with rank $ 1 $, selection orthogonal to the column space):\n  - $ G = \\begin{bmatrix} 0.3  0.3 \\\\ 0.3  0.3 \\end{bmatrix} $, $ \\boldsymbol{\\beta} = \\begin{bmatrix} 0.1 \\\\ -0.1 \\end{bmatrix} $, $ \\bar{\\boldsymbol{z}}_{0} = \\begin{bmatrix} 1.0 \\\\ -1.0 \\end{bmatrix} $, $ T = 20 $.\n\n- Case D (two traits, zero selection gradient yields no response):\n  - $ G = \\begin{bmatrix} 0.2  0.05 \\\\ 0.05  0.1 \\end{bmatrix} $, $ \\boldsymbol{\\beta} = \\begin{bmatrix} 0.0 \\\\ 0.0 \\end{bmatrix} $, $ \\bar{\\boldsymbol{z}}_{0} = \\begin{bmatrix} 0.3 \\\\ -0.4 \\end{bmatrix} $, $ T = 7 $.\n\n- Case E (three traits, diagonal $ G $ for independent responses):\n  - $ G = \\begin{bmatrix} 0.1  0  0 \\\\ 0  0.2  0 \\\\ 0  0  0.05 \\end{bmatrix} $, $ \\boldsymbol{\\beta} = \\begin{bmatrix} 0.2 \\\\ 0.1 \\\\ -0.2 \\end{bmatrix} $, $ \\bar{\\boldsymbol{z}}_{0} = \\begin{bmatrix} 1.0 \\\\ 2.0 \\\\ -1.0 \\end{bmatrix} $, $ T = 15 $.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of lists, enclosed in a single pair of square brackets, with no spaces. Each inner list must be the final mean trait vector $ \\bar{\\boldsymbol{z}}_{T} $ for one test case, in the same order as specified above, with each entry rounded to exactly six decimal places. For example, a valid output looks like $ [[0.123456,0.000000],[1.000000]] $ for two cases.\n- No additional text should be printed.", "solution": "The problem requires the derivation of the multivariate response-to-selection equation and its application in a simulation. The validation of the problem statement is the mandatory first step.\n\n### Step 1: Extract Givens\n- **Fundamental Theory**:\n  - The Price equation: The expected change in a population mean of a trait vector $ \\boldsymbol{z} $ is given by the covariance between additive genetic values and relative fitness, plus a negligible transmission term.\n  - Additive genetic covariance matrix: $ G = \\operatorname{Cov}(\\boldsymbol{a}, \\boldsymbol{a}) $, where $ \\boldsymbol{a} $ denotes the additive genetic values for the traits.\n  - Phenotypic selection gradient $ \\boldsymbol{\\beta} $: Defined such that the linear approximation of relative fitness $w(\\boldsymbol{z})$ is $ w(\\boldsymbol{z}) \\approx 1 + \\boldsymbol{\\beta}^{\\top}(\\boldsymbol{z} - \\bar{\\boldsymbol{z}}) $.\n- **Assumptions**:\n  - Relative fitness expectation is $1$ each generation.\n  - Selection is weak.\n  - Additive effects dominate, with random mating, negligible epistasis, and the transmission term in the Price equation is ignored.\n  - Linkage Disequilibrium (LD) is negligible.\n  - $ G $ is constant over the simulated time horizon.\n- **Simulation Model**:\n  - $ \\bar{\\boldsymbol{z}}_{t+1} = \\bar{\\boldsymbol{z}}_{t} + \\Delta \\bar{\\boldsymbol{z}} $.\n  - $ G $ and $ \\boldsymbol{\\beta} $ are constant for $ t = 0, 1, \\dots, T-1 $.\n- **Test Cases**:\n  - Case A: $ G = \\begin{bmatrix} 0.5  0.2 \\\\ 0.2  0.3 \\end{bmatrix} $, $ \\boldsymbol{\\beta} = \\begin{bmatrix} 0.1 \\\\ 0.0 \\end{bmatrix} $, $ \\bar{\\boldsymbol{z}}_{0} = \\begin{bmatrix} 0.0 \\\\ 0.0 \\end{bmatrix} $, $ T = 10 $.\n  - Case B: $ G = \\begin{bmatrix} 0.4  -0.1  0.0 \\\\ -0.1  0.2  0.05 \\\\ 0.0  0.05  0.3 \\end{bmatrix} $, $ \\boldsymbol{\\beta} = \\begin{bmatrix} 0.0 \\\\ 0.2 \\\\ 0.0 \\end{bmatrix} $, $ \\bar{\\boldsymbol{z}}_{0} = \\begin{bmatrix} 0.0 \\\\ 0.0 \\\\ 0.0 \\end{bmatrix} $, $ T = 5 $.\n  - Case C: $ G = \\begin{bmatrix} 0.3  0.3 \\\\ 0.3  0.3 \\end{bmatrix} $, $ \\boldsymbol{\\beta} = \\begin{bmatrix} 0.1 \\\\ -0.1 \\end{bmatrix} $, $ \\bar{\\boldsymbol{z}}_{0} = \\begin{bmatrix} 1.0 \\\\ -1.0 \\end{bmatrix} $, $ T = 20 $.\n  - Case D: $ G = \\begin{bmatrix} 0.2  0.05 \\\\ 0.05  0.1 \\end{bmatrix} $, $ \\boldsymbol{\\beta} = \\begin{bmatrix} 0.0 \\\\ 0.0 \\end{bmatrix} $, $ \\bar{\\boldsymbol{z}}_{0} = \\begin{bmatrix} 0.3 \\\\ -0.4 \\end{bmatrix} $, $ T = 7 $.\n  - Case E: $ G = \\begin{bmatrix} 0.1  0  0 \\\\ 0  0.2  0 \\\\ 0  0  0.05 \\end{bmatrix} $, $ \\boldsymbol{\\beta} = \\begin{bmatrix} 0.2 \\\\ 0.1 \\\\ -0.2 \\end{bmatrix} $, $ \\bar{\\boldsymbol{z}}_{0} = \\begin{bmatrix} 1.0 \\\\ 2.0 \\\\ -1.0 \\end{bmatrix} $, $ T = 15 $.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is evaluated against the validation criteria.\n- **Scientifically Grounded**: The problem is based on the Price equation and the breeder's equation, which are foundational principles of evolutionary quantitative genetics. The use of the additive genetic covariance matrix $G$ and the selection gradient $\\boldsymbol{\\beta}$ to predict evolutionary change is a central, well-established paradigm. The assumptions listed (weak selection, additivity, etc.) are standard idealizations used in theoretical models. The problem is scientifically sound.\n- **Well-Posed**: All necessary components for both the derivation and the simulation are provided. The derivation follows logically from the premises. For the simulation, each test case has a complete set of parameters ($G$, $\\boldsymbol{\\beta}$, $\\bar{\\boldsymbol{z}}_0$, $T$), ensuring that a unique, stable, and meaningful solution $\\bar{\\boldsymbol{z}}_T$ exists.\n- **Objective**: The problem is stated in precise, formal mathematical and biological language. There are no subjective or opinion-based elements. The tasks are unambiguous.\n- **Other Flaws**: The problem is self-contained and internally consistent. The assumptions, while simplifying, do not contradict each other. The numerical values in the test cases are plausible for a theoretical exercise. The problem is not trivial; it requires a correct derivation and implementation, and Case C (with a singular $G$ matrix) tests a key aspect of the theory.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Principle-Based Solution\n\n#### Task 1: Derivation of the Single-Generation Response to Selection\n\nThe objective is to derive an expression for $ \\Delta \\bar{\\boldsymbol{z}} $, the change in the mean phenotypic trait vector over one generation. The derivation is rooted in the Price equation and is valid under the assumptions of quantitative genetics provided.\n\n$1$. The evolutionary response, or a change in the heritable component of the traits, is a change in the mean additive genetic value (breeding value) vector, $ \\bar{\\boldsymbol{a}} $. Under the assumption of no transmission bias (e.g., from meiotic drive or gamete competition), the change in the mean phenotype $ \\Delta \\bar{\\boldsymbol{z}} $ is equal to the change in the mean breeding value, $ \\Delta \\bar{\\boldsymbol{a}} $. The Price equation, simplified for this context, gives this change as the covariance between breeding values and relative fitness. The problem specifies that relative fitness $w$ is scaled such that its mean is $1$ and the transmission term is negligible. Thus, we begin with:\n$$\n\\Delta \\bar{\\boldsymbol{z}} = \\Delta \\bar{\\boldsymbol{a}} = \\operatorname{Cov}(\\boldsymbol{a}, w)\n$$\nHere, $ \\boldsymbol{a} $ is the vector of breeding values for the traits in an individual, and $ w $ is that individual's relative fitness.\n\n$2$. The problem provides a linear approximation for the relationship between an individual's phenotypic vector $ \\boldsymbol{z} $ and its relative fitness $ w $:\n$$\nw(\\boldsymbol{z}) \\approx 1 + \\boldsymbol{\\beta}^{\\top}(\\boldsymbol{z} - \\bar{\\boldsymbol{z}})\n$$\nwhere $ \\bar{\\boldsymbol{z}} $ is the current population mean phenotype and $ \\boldsymbol{\\beta} $ is the directional selection gradient. We substitute this approximation into the covariance expression:\n$$\n\\Delta \\bar{\\boldsymbol{z}} \\approx \\operatorname{Cov}(\\boldsymbol{a}, 1 + \\boldsymbol{\\beta}^{\\top}(\\boldsymbol{z} - \\bar{\\boldsymbol{z}}))\n$$\n\n$3$. We use the properties of the covariance operator. The covariance with a constant is zero, so $ \\operatorname{Cov}(\\boldsymbol{a}, 1) = \\boldsymbol{0} $. Also, $ \\boldsymbol{\\beta}^{\\top}\\bar{\\boldsymbol{z}} $ is a constant scalar for the population at a given time. Therefore:\n$$\n\\Delta \\bar{\\boldsymbol{z}} \\approx \\operatorname{Cov}(\\boldsymbol{a}, \\boldsymbol{\\beta}^{\\top}\\boldsymbol{z} - \\boldsymbol{\\beta}^{\\top}\\bar{\\boldsymbol{z}}) = \\operatorname{Cov}(\\boldsymbol{a}, \\boldsymbol{\\beta}^{\\top}\\boldsymbol{z})\n$$\n\n$4$. To evaluate $ \\operatorname{Cov}(\\boldsymbol{a}, \\boldsymbol{\\beta}^{\\top}\\boldsymbol{z}) $, we consider its $ i $-th component, which corresponds to the $ i $-th trait:\n$$\n[\\Delta \\bar{\\boldsymbol{z}}]_i \\approx \\operatorname{Cov}\\left(a_i, \\boldsymbol{\\beta}^{\\top}\\boldsymbol{z}\\right) = \\operatorname{Cov}\\left(a_i, \\sum_{j=1}^{n} \\beta_j z_j\\right)\n$$\nwhere $n$ is the number of traits. By the linearity of covariance in its second argument:\n$$\n[\\Delta \\bar{\\boldsymbol{z}}]_i \\approx \\sum_{j=1}^{n} \\beta_j \\operatorname{Cov}(a_i, z_j)\n$$\n\n$5$. The term $ \\operatorname{Cov}(a_i, z_j) $ is the covariance between the breeding value for trait $ i $ and the phenotypic value for trait $ j $. The phenotype $ \\boldsymbol{z} $ can be decomposed into its additive genetic component $ \\boldsymbol{a} $ and a residual component $ \\boldsymbol{e} $ (non-additive genetic and environmental effects), $ \\boldsymbol{z} = \\boldsymbol{a} + \\boldsymbol{e} $. A central assumption in quantitative genetics is that breeding values are uncorrelated with these residuals, i.e., $ \\operatorname{Cov}(\\boldsymbol{a}, \\boldsymbol{e}) = \\boldsymbol{0} $. Therefore, the covariance matrix between breeding values and phenotypes is:\n$$\n\\operatorname{Cov}(\\boldsymbol{a}, \\boldsymbol{z}) = \\operatorname{Cov}(\\boldsymbol{a}, \\boldsymbol{a} + \\boldsymbol{e}) = \\operatorname{Cov}(\\boldsymbol{a}, \\boldsymbol{a}) + \\operatorname{Cov}(\\boldsymbol{a}, \\boldsymbol{e}) = G + \\boldsymbol{0} = G\n$$\nwhere $ G = \\operatorname{Cov}(\\boldsymbol{a}, \\boldsymbol{a}) $ is the additive genetic covariance matrix by definition. This implies that $ \\operatorname{Cov}(a_i, z_j) = G_{ij} $.\n\n$6$. Substituting $ G_{ij} $ back into the expression for $ [\\Delta \\bar{\\boldsymbol{z}}]_i $:\n$$\n[\\Delta \\bar{\\boldsymbol{z}}]_i \\approx \\sum_{j=1}^{n} G_{ij} \\beta_j\n$$\nThis sum is the definition of the $ i $-th component of the matrix-vector product $ G\\boldsymbol{\\beta} $.\n\n$7$. As this holds for all components $ i=1, \\dots, n $, we arrive at the celebrated multivariate breeder's equation, also known as the Lande equation, which provides the desired explicit matrix-vector expression for the single-generation response:\n$$\n\\Delta \\bar{\\boldsymbol{z}} = G \\boldsymbol{\\beta}\n$$\n\n#### Task 2: Simulation Model Implementation\n\nThe simulation tracks the mean trait vector $ \\bar{\\boldsymbol{z}} $ over $ T $ generations. The update rule is given by:\n$$\n\\bar{\\boldsymbol{z}}_{t+1} = \\bar{\\boldsymbol{z}}_{t} + \\Delta \\bar{\\boldsymbol{z}}\n$$\nAs per the problem statement, both the additive genetic covariance matrix $ G $ and the selection gradient $ \\boldsymbol{\\beta} $ are constant throughout the simulation. Consequently, the single-generation response $ \\Delta \\bar{\\boldsymbol{z}} = G \\boldsymbol{\\beta} $ is also a constant vector.\n\nLet $ \\Delta \\bar{\\boldsymbol{z}}_{\\text{const}} = G \\boldsymbol{\\beta} $. The process is an arithmetic progression:\n$$\n\\bar{\\boldsymbol{z}}_{1} = \\bar{\\boldsymbol{z}}_{0} + \\Delta \\bar{\\boldsymbol{z}}_{\\text{const}}\n$$\n$$\n\\bar{\\boldsymbol{z}}_{2} = \\bar{\\boldsymbol{z}}_{1} + \\Delta \\bar{\\boldsymbol{z}}_{\\text{const}} = (\\bar{\\boldsymbol{z}}_{0} + \\Delta \\bar{\\boldsymbol{z}}_{\\text{const}}) + \\Delta \\bar{\\boldsymbol{z}}_{\\text{const}} = \\bar{\\boldsymbol{z}}_{0} + 2 \\Delta \\bar{\\boldsymbol{z}}_{\\text{const}}\n$$\nAfter $ T $ generations, the final mean trait vector $ \\bar{\\boldsymbol{z}}_{T} $ is:\n$$\n\\bar{\\boldsymbol{z}}_{T} = \\bar{\\boldsymbol{z}}_{0} + T \\cdot \\Delta \\bar{\\boldsymbol{z}}_{\\text{const}} = \\bar{\\boldsymbol{z}}_{0} + T (G \\boldsymbol{\\beta})\n$$\nThis closed-form solution is computationally efficient and avoids an explicit loop over generations. It will be used to compute the results for the test cases.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and simulates the multivariate response to selection.\n    \n    The core of the simulation is the Lande equation, delta_z = G * beta, which gives\n    the change in the mean trait vector in one generation. Since G and beta are constant,\n    the change is constant per generation. The final trait vector z_T after T generations\n    is z_0 + T * (G @ beta).\n    \"\"\"\n\n    test_cases = [\n        {\n            \"name\": \"Case A\",\n            \"G\": np.array([[0.5, 0.2], [0.2, 0.3]]),\n            \"beta\": np.array([0.1, 0.0]),\n            \"z0\": np.array([0.0, 0.0]),\n            \"T\": 10\n        },\n        {\n            \"name\": \"Case B\",\n            \"G\": np.array([[0.4, -0.1, 0.0], [-0.1, 0.2, 0.05], [0.0, 0.05, 0.3]]),\n            \"beta\": np.array([0.0, 0.2, 0.0]),\n            \"z0\": np.array([0.0, 0.0, 0.0]),\n            \"T\": 5\n        },\n        {\n            \"name\": \"Case C\",\n            \"G\": np.array([[0.3, 0.3], [0.3, 0.3]]),\n            \"beta\": np.array([0.1, -0.1]),\n            \"z0\": np.array([1.0, -1.0]),\n            \"T\": 20\n        },\n        { \"name\": \"Case D\",\n            \"G\": np.array([[0.2, 0.05], [0.05, 0.1]]),\n            \"beta\": np.array([0.0, 0.0]),\n            \"z0\": np.array([0.3, -0.4]),\n            \"T\": 7\n        },\n        {\n            \"name\": \"Case E\",\n            \"G\": np.array([[0.1, 0, 0], [0, 0.2, 0], [0, 0, 0.05]]),\n            \"beta\": np.array([0.2, 0.1, -0.2]),\n            \"z0\": np.array([1.0, 2.0, -1.0]),\n            \"T\": 15\n        }\n    ]\n\n    all_results_strings = []\n\n    for case in test_cases:\n        G = case[\"G\"]\n        beta = case[\"beta\"]\n        z0 = case[\"z0\"]\n        T = case[\"T\"]\n\n        # Calculate the single-generation change in the mean trait vector\n        # This is the Lande equation: delta__z = G @ beta\n        delta_z = G @ beta\n        \n        # Calculate the final mean trait vector after T generations\n        # For constant G and beta, this is an arithmetic progression: z_T = z_0 + T * delta_z\n        z_T = z0 + T * delta_z\n        \n        # Format the resulting vector according to the problem specification\n        # Each element is rounded to exactly six decimal places.\n        formatted_vector_parts = [f\"{x:.6f}\" for x in z_T]\n        vector_string = f\"[{','.join(formatted_vector_parts)}]\"\n        all_results_strings.append(vector_string)\n\n    # Join the results for all test cases into a single string\n    final_output = f\"[{','.join(all_results_strings)}]\"\n    \n    print(final_output)\n\nsolve()\n```", "id": "3338787"}]}