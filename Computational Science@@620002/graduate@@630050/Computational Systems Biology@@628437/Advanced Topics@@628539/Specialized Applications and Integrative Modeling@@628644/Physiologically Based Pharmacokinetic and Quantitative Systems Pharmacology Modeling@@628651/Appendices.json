{"hands_on_practices": [{"introduction": "Understanding the long-term behavior of a drug is a cornerstone of pharmacology. This first practice focuses on deriving the steady-state plasma concentration ($C_{p,\\mathrm{ss}}$) from first principles within a minimal physiologically based pharmacokinetic (PBPK) model. By applying mass balance and the well-stirred organ model, this exercise [@problem_id:3338308] solidifies the connection between organ-specific parameters like intrinsic clearance ($CL_{int}$) and whole-body drug exposure, providing a crucial analytical foundation for more complex dynamic simulations.", "problem": "Consider a minimal Physiologically Based Pharmacokinetic (PBPK) model for an intravenously administered drug with four compartments: plasma, liver, kidney, and muscle. Assume perfusion-limited distribution in all tissues, linear kinetics, and that each compartment is well-stirred. The drug is infused into plasma at a constant rate $R_{in}$ and binds reversibly to plasma proteins with fraction unbound $f_u$. The hepatic portal input is neglected (assume only systemic arterial input), and red blood cells do not contribute differentially to distribution (blood-to-plasma ratio equals $1$). Let organ blood flows be $Q_h$ (liver), $Q_k$ (kidney), and $Q_m$ (muscle), and compartment volumes be $V_p$ (plasma), $V_h$ (liver), $V_k$ (kidney), and $V_m$ (muscle), with cardiac output satisfying $Q_h + Q_k + Q_m$ equals the arterial inflow to plasma. Muscle serves only as a distribution compartment (no elimination). Hepatic elimination is characterized by an intrinsic clearance $CL_{int}$ acting on the unbound drug within the liver under the well-stirred organ assumption. Renal elimination occurs via glomerular filtration only, with renal filtration clearance of $f_u \\cdot GFR$, where $GFR$ is the glomerular filtration rate and tubular secretion/reabsorption are absent.\n\nStarting from mass conservation and the well-stirred organ model, and using the assumptions above, derive a closed-form expression for the steady-state plasma concentration $C_{p,\\mathrm{ss}}$ under constant infusion at rate $R_{in}$. Express your final answer in terms of $R_{in}$, $f_u$, $CL_{int}$, $GFR$, and $Q_h$ only. Provide the final expression for $C_{p,\\mathrm{ss}}$ in mass per volume units (e.g., $\\mathrm{mg}/\\mathrm{L}$). No numerical evaluation is required, and no rounding is needed.", "solution": "The problem asks for the steady-state plasma concentration, $C_{p,\\mathrm{ss}}$, of a drug administered via constant intravenous infusion. The derivation is based on the principle of mass conservation within a physiologically based pharmacokinetic (PBPK) model.\n\n**Step 1: Fundamental Principle of Steady State**\n\nAt steady state ($ss$), the rate at which the drug enters the systemic circulation must equal the rate at which it is eliminated from the body.\n$$\n\\text{Rate of Input} = \\text{Rate of Elimination}\n$$\nThe problem states that the drug is infused at a constant rate $R_{in}$. Therefore, the rate of input is $R_{in}$. The total rate of elimination is the product of the total body clearance, $CL_{tot}$, and the steady-state plasma concentration, $C_{p,\\mathrm{ss}}$, assuming clearance is defined with respect to plasma concentration. The assumption that the blood-to-plasma ratio is $1$ allows us to equate blood-based clearance and plasma-based clearance.\n$$\nR_{in} = CL_{tot} \\cdot C_{p,\\mathrm{ss}}\n$$\nSolving for the steady-state plasma concentration gives:\n$$\nC_{p,\\mathrm{ss}} = \\frac{R_{in}}{CL_{tot}}\n$$\nTo find $C_{p,\\mathrm{ss}}$, we must first determine the total body clearance, $CL_{tot}$.\n\n**Step 2: Total Body Clearance ($CL_{tot}$)**\n\nTotal body clearance is the sum of the clearances of all eliminating organs. In this model, the eliminating organs are the liver and the kidneys. The muscle is specified as a distribution-only compartment, so its clearance is zero.\n$$\nCL_{tot} = CL_h + CL_r\n$$\nwhere $CL_h$ is the hepatic (liver) clearance and $CL_r$ is the renal (kidney) clearance. We will derive each of these terms based on the given assumptions.\n\n**Step 3: Hepatic Clearance ($CL_h$)**\n\nThe problem specifies that hepatic elimination follows the \"well-stirred organ\" model. In this model, the concentration of the drug within the liver is assumed to be uniform and equal to the concentration in the venous blood leaving the liver. The clearance for a well-stirred organ is given by the standard formula relating organ blood flow ($Q_h$), the unbound fraction of the drug in plasma ($f_u$), and the intrinsic clearance ($CL_{int}$). The intrinsic clearance is the maximum metabolizing capacity of the liver enzymes, acting on the unbound drug.\nThe formula for hepatic clearance under the well-stirred model is:\n$$\nCL_h = \\frac{Q_h \\cdot f_u \\cdot CL_{int}}{Q_h + f_u \\cdot CL_{int}}\n$$\nThis expression depends on $Q_h$, $f_u$, and $CL_{int}$, which are all variables provided in or permitted for the final answer.\n\n**Step 4: Renal Clearance ($CL_r$)**\n\nRenal elimination is stated to occur exclusively via glomerular filtration. Tubular secretion and reabsorption are absent. The rate of drug elimination via filtration is the product of the glomerular filtration rate ($GFR$) and the concentration of drug that is free to be filtered. Only the unbound drug in the plasma can pass through the glomerulus. The unbound plasma concentration is $C_{u,p} = f_u \\cdot C_p$.\n\nTherefore, the rate of renal elimination is:\n$$\n\\text{Rate}_{elim,r} = GFR \\cdot C_{u,p} = GFR \\cdot f_u \\cdot C_p\n$$\nBy definition, clearance is the rate of elimination divided by the reference concentration (in this case, total plasma concentration $C_p$).\n$$\nCL_r = \\frac{\\text{Rate}_{elim,r}}{C_p} = \\frac{GFR \\cdot f_u \\cdot C_p}{C_p}\n$$\nThis simplifies to:\n$$\nCL_r = f_u \\cdot GFR\n$$\nThis confirms the expression for renal filtration clearance given in the problem statement. This expression depends on $f_u$ and $GFR$, which are permitted variables.\n\n**Step 5: Final Expression for Steady-State Plasma Concentration ($C_{p,\\mathrm{ss}}$)**\n\nNow we combine the expressions for the individual clearances to find the total body clearance.\n$$\nCL_{tot} = CL_h + CL_r = \\frac{Q_h \\cdot f_u \\cdot CL_{int}}{Q_h + f_u \\cdot CL_{int}} + f_u \\cdot GFR\n$$\nFinally, we substitute this expression for $CL_{tot}$ into the equation for the steady-state plasma concentration.\n$$\nC_{p,\\mathrm{ss}} = \\frac{R_{in}}{CL_{tot}} = \\frac{R_{in}}{\\frac{Q_h \\cdot f_u \\cdot CL_{int}}{Q_h + f_u \\cdot CL_{int}} + f_u \\cdot GFR}\n$$\nThis expression for $C_{p,\\mathrm{ss}}$ is in terms of only the specified parameters: $R_{in}$, $f_u$, $CL_{int}$, $GFR$, and $Q_h$. The other parameters provided in the problem statement, such as organ volumes ($V_p$, $V_h$, $V_k$, $V_m$) and other organ blood flows ($Q_k$, $Q_m$), affect the time-course of the drug concentration but do not influence the final steady-state value itself.", "answer": "$$\n\\boxed{\\frac{R_{in}}{\\frac{Q_h \\cdot f_u \\cdot CL_{int}}{Q_h + f_u \\cdot CL_{int}} + f_u \\cdot GFR}}\n$$", "id": "3338308"}, {"introduction": "While steady-state analysis is foundational, the power of quantitative systems pharmacology (QSP) lies in its ability to capture dynamic processes. This practice moves beyond static scenarios to simulate a time-dependent drug-drug interaction (DDI), a critical safety concern in drug development. In this exercise [@problem_id:3338346], you will implement a system of ordinary differential equations (ODEs) to model how an inhibitor's pharmacokinetics leads to the progressive inactivation of a metabolic enzyme, thereby altering the clearance and exposure of a co-administered 'victim' drug.", "problem": "Develop a program that computes the area-under-the-curve ratio (AUC ratio) for a victim drug undergoing hepatic clearance when coadministered with a time-dependent enzyme inhibitor, and assesses sensitivity to the enzyme degradation rate constant and the inhibitor potency parameter. The modeling task must be grounded in first principles of mass balance and clearance definitions appropriate for physiologically based pharmacokinetic (PBPK) and quantitative systems pharmacology (QSP) modeling.\n\nModel the inhibitor with a one-compartment pharmacokinetic model with first-order absorption and linear elimination. Let the inhibitor dose be administered repeatedly at fixed intervals to approach a dynamic steady state. The unbound inhibitor concentration in plasma binds to and inactivates a hepatic enzyme according to a turnover model that includes zero-order synthesis and first-order degradation of the active enzyme pool, together with a saturable inactivation term. The active enzyme fraction scales the victim drug’s hepatic intrinsic clearance over time. The victim drug is administered as a single intravenous bolus after repeated inhibitor dosing, and its plasma concentration follows a one-compartment model with time-varying elimination determined by the well-stirred liver model. The AUC ratio is defined as the ratio of the victim drug AUC in the presence of the inhibitor to its AUC in the absence of the inhibitor. Express the final AUC ratio as a dimensionless decimal number.\n\nUse the following foundational definitions without introducing any shortcut formulas:\n- Let $A_{\\mathrm{gut}}(t)$ be the inhibitor amount in the absorption (gut) compartment, $A_{\\mathrm{c}}(t)$ be the inhibitor amount in the central compartment, and $C_{\\mathrm{inh}}(t) = A_{\\mathrm{c}}(t)/V_{\\mathrm{inh}}$ be the inhibitor plasma concentration, where $V_{\\mathrm{inh}}$ is the inhibitor volume of distribution. The inhibitor has first-order absorption rate constant $k_a$ and linear systemic clearance $\\mathrm{CL}_{\\mathrm{inh}}$.\n- Let $I_u(t) = f_{u,\\mathrm{inh}}\\,C_{\\mathrm{inh}}(t)$ be the unbound inhibitor concentration, where $f_{u,\\mathrm{inh}}$ is the unbound fraction in plasma.\n- Let $E(t)$ be the active enzyme fraction, scaled so that $E(0)=1$ at baseline. The enzyme follows turnover governed by synthesis and degradation, and it is inactivated by the inhibitor following a saturable term parameterized by $k_{\\mathrm{inact}}$ and $K_I$.\n- Let the victim drug amount be $A_{\\mathrm{vic}}(t)$ with plasma concentration $C_{\\mathrm{vic}}(t)=A_{\\mathrm{vic}}(t)/V_{\\mathrm{vic}}$, where $V_{\\mathrm{vic}}$ is the volume of distribution for the victim drug. The victim drug undergoes elimination driven by hepatic clearance under the well-stirred liver model with hepatic blood flow $Q_h$, blood unbound fraction $f_{u,B}$, and time-varying intrinsic clearance $\\mathrm{CL}_{\\mathrm{int}}(t) = \\mathrm{CL}_{\\mathrm{int},0}\\,E(t)$, where $\\mathrm{CL}_{\\mathrm{int},0}$ is the baseline intrinsic clearance.\n- The hepatic clearance under the well-stirred model at time $t$ is $\\mathrm{CL}_h(t) = Q_h\\,\\dfrac{f_{u,B}\\,\\mathrm{CL}_{\\mathrm{int}}(t)}{Q_h + f_{u,B}\\,\\mathrm{CL}_{\\mathrm{int}}(t)}$.\n- The AUC over a horizon $[t_0,t_1]$ equals $\\displaystyle \\int_{t_0}^{t_1} C_{\\mathrm{vic}}(t)\\,dt$ by definition. For the control condition (no inhibitor), the enzyme activity remains at $E(t)\\equiv 1$ and $\\mathrm{CL}_h$ is constant; for the inhibited condition, $E(t)$ evolves dynamically in response to the inhibitor exposure.\n\nDerive the governing ordinary differential equations from the above principles:\n- For the inhibitor between discrete oral doses, $dA_{\\mathrm{gut}}/dt = -k_a\\,A_{\\mathrm{gut}}$, $dA_{\\mathrm{c}}/dt = k_a\\,A_{\\mathrm{gut}} - \\left(\\mathrm{CL}_{\\mathrm{inh}}/V_{\\mathrm{inh}}\\right)A_{\\mathrm{c}}$. At each scheduled oral dose time, instantaneously increase $A_{\\mathrm{gut}}$ by the inhibitor dose amount.\n- For the enzyme, $dE/dt = k_{\\mathrm{deg}}\\,(1 - E) - k_{\\mathrm{inact}}\\,\\dfrac{I_u(t)}{K_I + I_u(t)}\\,E$, where $k_{\\mathrm{deg}}$ is the first-order enzyme degradation rate constant and $k_{\\mathrm{deg}}$ equals the synthesis rate constant under the normalization $E(0)=1$.\n- For the victim drug after its intravenous bolus at the specified time point, $dA_{\\mathrm{vic}}/dt = -\\left(\\mathrm{CL}_h(t)/V_{\\mathrm{vic}}\\right)\\,A_{\\mathrm{vic}}$ with the initial jump in $A_{\\mathrm{vic}}$ equal to the victim drug dose. Define an auxiliary state $AUC(t)$ with $d\\,AUC/dt = C_{\\mathrm{vic}}(t)$ after the victim dose and zero before.\n\nAll times must be in hours, all clearances in liters per hour, all volumes in liters, and all doses in milligrams. The AUC ratio is dimensionless and must be reported as a decimal number. Angles do not appear. Express fractional outputs as decimals.\n\nImplement the following experiment protocol for each test case:\n- Repeatedly dose the inhibitor orally every $24\\,\\mathrm{h}$ starting at $t=0\\,\\mathrm{h}$; continue dosing through at least $72\\,\\mathrm{h}$ after the victim dose. The victim drug is administered as a single intravenous bolus at $t=168\\,\\mathrm{h}$.\n- Numerically integrate the inhibitor and enzyme system from $t=0\\,\\mathrm{h}$ to $t=240\\,\\mathrm{h}$, applying discrete inhibitor doses at their scheduled times. Include the victim drug dynamics and the $AUC$ integrator only from $t=168\\,\\mathrm{h}$ onward.\n- Compute the victim AUC in the inhibited condition as the numerically accumulated $AUC$ from $t=168\\,\\mathrm{h}$ to $t=240\\,\\mathrm{h}$. Compute the control AUC analytically using the time-invariant hepatic clearance at baseline $E(t)\\equiv 1$ as $\\mathrm{AUC}_{\\mathrm{control}} = \\mathrm{Dose}_{\\mathrm{vic}}/\\mathrm{CL}_{h,0}$, where $\\mathrm{CL}_{h,0} = Q_h\\,\\dfrac{f_{u,B}\\,\\mathrm{CL}_{\\mathrm{int},0}}{Q_h + f_{u,B}\\,\\mathrm{CL}_{\\mathrm{int},0}}$. Then compute the AUC ratio as $AUC_{\\mathrm{inhib}}/AUC_{\\mathrm{control}}$.\n\nUse the following parameter values, which constitute the test suite. Each test case is fully specified by the pair $(K_I, k_{\\mathrm{deg}})$; all other parameters are held constant across cases. Where values are not explicitly listed per case, they are constants for all cases.\n\nConstants for all cases:\n- Inhibitor dose and pharmacokinetics: $\\mathrm{Dose}_{\\mathrm{inh}} = 100\\,\\mathrm{mg}$ every $24\\,\\mathrm{h}$, $k_a = 1.0\\,\\mathrm{h}^{-1}$, $\\mathrm{CL}_{\\mathrm{inh}} = 10.0\\,\\mathrm{L/h}$, $V_{\\mathrm{inh}} = 50.0\\,\\mathrm{L}$, $f_{u,\\mathrm{inh}} = 0.1$, $k_{\\mathrm{inact}} = 0.2\\,\\mathrm{h}^{-1}$.\n- Victim drug and liver parameters: $\\mathrm{Dose}_{\\mathrm{vic}} = 10.0\\,\\mathrm{mg}$, $V_{\\mathrm{vic}} = 35.0\\,\\mathrm{L}$, $Q_h = 90.0\\,\\mathrm{L/h}$, $f_{u,B} = 0.6$, $\\mathrm{CL}_{\\mathrm{int},0} = 20.0\\,\\mathrm{L/h}$.\n- Victim dosing time: $t_{\\mathrm{vic}} = 168.0\\,\\mathrm{h}$, final integration time: $t_{\\mathrm{end}} = 240.0\\,\\mathrm{h}$.\n\nTest cases (each as $(K_I, k_{\\mathrm{deg}})$):\n- Case $1$: $(0.5\\,\\mathrm{mg/L},\\,0.03\\,\\mathrm{h}^{-1})$.\n- Case $2$: $(0.5\\,\\mathrm{mg/L},\\,0.005\\,\\mathrm{h}^{-1})$.\n- Case $3$: $(10.0\\,\\mathrm{mg/L},\\,0.03\\,\\mathrm{h}^{-1})$.\n- Case $4$: $(0.1\\,\\mathrm{mg/L},\\,0.03\\,\\mathrm{h}^{-1})$.\n- Case $5$: $(0.5\\,\\mathrm{mg/L},\\,0.10\\,\\mathrm{h}^{-1})$.\n\nYour program must:\n- Implement the ordinary differential equations and dosing schedule described above.\n- For each test case, compute the AUC ratio as a floating-point number rounded to three decimal places.\n- Produce a single line of output containing the results for the five test cases as a comma-separated list enclosed in square brackets, for example, `[result_1,result_2,result_3,result_4,result_5]`.\n\nYour program must be self-contained, require no user input, and adhere strictly to the described numerical scheme and units. The output must be exactly one line in the specified format, with no additional characters or text.", "solution": "The problem requires the development of a computational model to simulate a drug-drug interaction (DDI) involving a time-dependent enzyme inhibitor and a victim drug. The model is based on first principles of pharmacokinetics and enzyme dynamics, typical of physiologically based pharmacokinetic (PBPK) and quantitative systems pharmacology (QSP) approaches. The core of the problem is to solve a system of coupled ordinary differential equations (ODEs) that describe the time evolution of the concentrations of both drugs and the activity level of a key metabolic enzyme.\n\nThe system can be described by a state vector $\\mathbf{y}(t)$ with five components:\n$1$. $A_{\\mathrm{gut}}(t)$: The amount of the inhibitor in the absorption compartment (e.g., gut).\n$2$. $A_{\\mathrm{c}}(t)$: The amount of the inhibitor in the central compartment (representing systemic circulation).\n$3$. $E(t)$: The fraction of active enzyme relative to its baseline level.\n$4$. $A_{\\mathrm{vic}}(t)$: The amount of the victim drug in its central compartment.\n$5$. $\\mathrm{AUC}_{\\mathrm{vic}}(t)$: The cumulative area under the concentration-time curve for the victim drug.\n\nThe time evolution of this state vector $\\mathbf{y}(t) = [A_{\\mathrm{gut}}(t), A_{\\mathrm{c}}(t), E(t), A_{\\mathrm{vic}}(t), \\mathrm{AUC}_{\\mathrm{vic}}(t)]^T$ is governed by the following system of ODEs, derived from mass balance principles:\n\n$1$. Inhibitor absorption:\n$$\n\\frac{dA_{\\mathrm{gut}}}{dt} = -k_a \\, A_{\\mathrm{gut}}(t)\n$$\nwhere $k_a$ is the first-order absorption rate constant.\n\n$2$. Inhibitor disposition:\n$$\n\\frac{dA_{\\mathrm{c}}}{dt} = k_a \\, A_{\\mathrm{gut}}(t) - \\frac{\\mathrm{CL}_{\\mathrm{inh}}}{V_{\\mathrm{inh}}} \\, A_{\\mathrm{c}}(t)\n$$\nwhere $\\mathrm{CL}_{\\mathrm{inh}}$ is the inhibitor's systemic clearance and $V_{\\mathrm{inh}}$ is its volume of distribution. The plasma concentration of the inhibitor is $C_{\\mathrm{inh}}(t) = A_{\\mathrm{c}}(t) / V_{\\mathrm{inh}}$.\n\n$3$. Enzyme dynamics:\n$$\n\\frac{dE}{dt} = k_{\\mathrm{deg}}(1 - E(t)) - k_{\\mathrm{inact}} \\frac{I_u(t)}{K_I + I_u(t)} E(t)\n$$\nThis equation models enzyme turnover with a zero-order synthesis rate (normalized to $k_{\\mathrm{deg}}$ for a baseline steady-state enzyme fraction of $E(0)=1$) and first-order degradation with rate constant $k_{\\mathrm{deg}}$. The second term represents mechanism-based inactivation by the unbound inhibitor, where $I_u(t) = f_{u,\\mathrm{inh}} C_{\\mathrm{inh}}(t)$ is the unbound inhibitor concentration, $k_{\\mathrm{inact}}$ is the maximal inactivation rate constant, and $K_I$ is the inhibitor concentration producing half-maximal inactivation.\n\n$4$. Victim drug elimination:\nThe victim drug dynamics are only active for times $t \\ge t_{\\mathrm{vic}}$, the time of the victim drug's administration. For $t < t_{\\mathrm{vic}}$, $\\frac{dA_{\\mathrm{vic}}}{dt} = 0$. For $t \\ge t_{\\mathrm{vic}}$:\n$$\n\\frac{dA_{\\mathrm{vic}}}{dt} = -\\frac{\\mathrm{CL}_h(t)}{V_{\\mathrm{vic}}} A_{\\mathrm{vic}}(t)\n$$\nHere, $V_{\\mathrm{vic}}$ is the victim drug's volume of distribution. The hepatic clearance, $\\mathrm{CL}_h(t)$, is time-dependent due to the enzyme inactivation. According to the well-stirred liver model, it is given by:\n$$\n\\mathrm{CL}_h(t) = Q_h \\frac{f_{u,B} \\, \\mathrm{CL}_{\\mathrm{int}}(t)}{Q_h + f_{u,B} \\, \\mathrm{CL}_{\\mathrm{int}}(t)}\n$$\nwhere $Q_h$ is the hepatic blood flow, $f_{u,B}$ is the unbound fraction of the victim drug in blood, and $\\mathrm{CL}_{\\mathrm{int}}(t) = \\mathrm{CL}_{\\mathrm{int},0} E(t)$ is the time-varying intrinsic clearance, with $\\mathrm{CL}_{\\mathrm{int},0}$ being the baseline intrinsic clearance.\n\n$5$. Victim drug AUC accumulation:\nAn auxiliary state is used to compute the AUC. For $t < t_{\\mathrm{vic}}$, $\\frac{d\\mathrm{AUC}_{\\mathrm{vic}}}{dt} = 0$. For $t \\ge t_{\\mathrm{vic}}$:\n$$\n\\frac{d\\mathrm{AUC}_{\\mathrm{vic}}}{dt} = C_{\\mathrm{vic}}(t) = \\frac{A_{\\mathrm{vic}}(t)}{V_{\\mathrm{vic}}}\n$$\n\nThe simulation protocol involves discrete dosing events. These are handled by segmenting the total integration interval $[0, 240]\\,\\mathrm{h}$ at the time of each event (inhibitor doses and the single victim drug dose). The system of ODEs is solved numerically over each segment using the final state of the previous segment as the initial condition for the next. At the beginning of each relevant segment, the state variables are instantaneously updated to reflect the dose:\n- At each inhibitor dose time ($t=0, 24, 48, \\ldots, 216\\,\\mathrm{h}$), $A_{\\mathrm{gut}}(t)$ is increased by $\\mathrm{Dose}_{\\mathrm{inh}} = 100\\,\\mathrm{mg}$.\n- At the victim dose time ($t_{\\mathrm{vic}}=168\\,\\mathrm{h}$), $A_{\\mathrm{vic}}(t)$ is increased by $\\mathrm{Dose}_{\\mathrm{vic}} = 10\\,\\mathrm{mg}$.\n\nThe initial conditions at $t=0$ are $A_{\\mathrm{gut}}(0)=0$, $A_{\\mathrm{c}}(0)=0$, $E(0)=1$, $A_{\\mathrm{vic}}(0)=0$, and $\\mathrm{AUC}_{\\mathrm{vic}}(0)=0$. The first inhibitor dose is applied immediately at $t=0$.\n\nFollowing the simulation from $t=0$ to $t=240\\,\\mathrm{h}$, the AUC ratio is computed as specified.\nThe AUC in the inhibited condition, $\\mathrm{AUC}_{\\mathrm{inhib}}$, is the value of the state variable $\\mathrm{AUC}_{\\mathrm{vic}}(t)$ at the end of the simulation, $t=240\\,\\mathrm{h}$. This represents the numerically integrated partial AUC, $\\int_{168\\,\\mathrm{h}}^{240\\,\\mathrm{h}} C_{\\mathrm{vic,inhib}}(t) \\, dt$.\n\nThe AUC in the control condition (no inhibitor), $\\mathrm{AUC}_{\\mathrm{control}}$, is computed analytically for the total exposure from time of dose to infinity. In this case, $E(t) \\equiv 1$, so the hepatic clearance is a constant, $\\mathrm{CL}_{h,0}$:\n$$\n\\mathrm{CL}_{h,0} = Q_h \\frac{f_{u,B} \\, \\mathrm{CL}_{\\mathrm{int},0}}{Q_h + f_{u,B} \\, \\mathrm{CL}_{\\mathrm{int},0}} = 90.0 \\frac{0.6 \\times 20.0}{90.0 + 0.6 \\times 20.0} = \\frac{1080}{102} \\approx 10.588\\,\\mathrm{L/h}\n$$\nThe total AUC for a single intravenous bolus dose is given by:\n$$\n\\mathrm{AUC}_{\\mathrm{control}} = \\frac{\\mathrm{Dose}_{\\mathrm{vic}}}{\\mathrm{CL}_{h,0}} = \\frac{10.0\\,\\mathrm{mg}}{10.588\\,\\mathrm{L/h}} \\approx 0.944\\,\\mathrm{mg \\cdot h/L}\n$$\nThe final AUC ratio is then calculated as $\\mathrm{AUC}_{\\mathrm{ratio}} = \\mathrm{AUC}_{\\mathrm{inhib}} / \\mathrm{AUC}_{\\mathrm{control}}$.\n\nThe implementation utilizes Python's `scipy.integrate.solve_ivp` function to perform the numerical integration for each test case, which is defined by a specific pair of $(K_I, k_{\\mathrm{deg}})$ values while holding all other parameters constant. The result for each case is rounded to three decimal places as required.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Main function to run the PBPK/QSP simulation for all test cases and print results.\n    \"\"\"\n    # Define constant parameters for all cases\n    const_params = {\n        'Dose_inh': 100.0,      # mg\n        'k_a': 1.0,            # h^-1\n        'CL_inh': 10.0,        # L/h\n        'V_inh': 50.0,         # L\n        'f_u_inh': 0.1,        # dimensionless\n        'k_inact': 0.2,        # h^-1\n        'Dose_vic': 10.0,      # mg\n        'V_vic': 35.0,         # L\n        'Q_h': 90.0,           # L/h\n        'f_u_B': 0.6,          # dimensionless\n        'CL_int_0': 20.0,      # L/h\n        't_vic': 168.0,        # h\n        't_end': 240.0,        # h\n        'tau_inh': 24.0,       # h\n    }\n\n    # Test cases defined by (K_I, k_deg)\n    test_cases = [\n        # (K_I in mg/L, k_deg in h^-1)\n        (0.5, 0.03),\n        (0.5, 0.005),\n        (10.0, 0.03),\n        (0.1, 0.03),\n        (0.5, 0.10),\n    ]\n\n    def run_simulation(K_I, k_deg, params):\n        \"\"\"\n        Runs a single simulation for a given set of parameters.\n        \"\"\"\n        # --- System of ODEs ---\n        # y[0]: A_gut (inhibitor amount in gut)\n        # y[1]: A_c (inhibitor amount in central compartment)\n        # y[2]: E (active enzyme fraction)\n        # y[3]: A_vic (victim drug amount)\n        # y[4]: AUC_vic (victim drug AUC)\n        def dydt(t, y, p):\n            A_gut, A_c, E, A_vic, AUC_vic = y\n            \n            # Inhibitor PK\n            dA_gut_dt = -p['k_a'] * A_gut\n            C_inh = A_c / p['V_inh']\n            dA_c_dt = p['k_a'] * A_gut - (p['CL_inh'] / p['V_inh']) * A_c\n            \n            # Enzyme dynamics\n            I_u = p['f_u_inh'] * C_inh\n            # To prevent potential division by zero if K_I is very small, though not in test cases\n            if K_I + I_u > 0:\n                inactivation_term = p['k_inact'] * (I_u / (K_I + I_u)) * E\n            else:\n                inactivation_term = 0.0\n            dE_dt = k_deg * (1 - E) - inactivation_term\n\n            # Victim drug PK (active only after dosing)\n            if t >= p['t_vic']:\n                CL_int_t = p['CL_int_0'] * E\n                # Well-stirred liver model\n                CL_h_t = p['Q_h'] * (p['f_u_B'] * CL_int_t) / (p['Q_h'] + p['f_u_B'] * CL_int_t)\n                dA_vic_dt = -(CL_h_t / p['V_vic']) * A_vic\n                dAUC_vic_dt = A_vic / p['V_vic']\n            else:\n                dA_vic_dt = 0.0\n                dAUC_vic_dt = 0.0\n                \n            return [dA_gut_dt, dA_c_dt, dE_dt, dA_vic_dt, dAUC_vic_dt]\n\n        # --- Simulation setup ---\n        y0 = np.array([0.0, 0.0, 1.0, 0.0, 0.0])\n        \n        # Define simulation time points, including dosing events\n        inhibitor_dose_times = np.arange(0, params['t_end'], params['tau_inh'])\n        event_times = sorted(list(set(inhibitor_dose_times).union({0.0, params['t_vic'], params['t_end']})))\n        \n        current_y = y0.copy()\n        \n        # --- Run simulation segment by segment ---\n        for i in range(len(event_times) - 1):\n            t_start = event_times[i]\n            t_stop = event_times[i+1]\n            \n            # Apply doses at the beginning of the interval\n            if t_start in inhibitor_dose_times:\n                current_y[0] += params['Dose_inh']\n            if t_start == params['t_vic']:\n                current_y[3] += params['Dose_vic']\n\n            # Integrate over the segment\n            sol = solve_ivp(\n                fun=lambda t, y: dydt(t, y, params),\n                t_span=[t_start, t_stop],\n                y0=current_y,\n                method='RK45',\n                dense_output=True,\n                rtol=1e-6,\n                atol=1e-9\n            )\n            current_y = sol.y[:, -1]\n\n        AUC_inhib = current_y[4]\n        \n        # --- Calculate control AUC and ratio ---\n        CL_h_0 = params['Q_h'] * (params['f_u_B'] * params['CL_int_0']) / (params['Q_h'] + params['f_u_B'] * params['CL_int_0'])\n        AUC_control = params['Dose_vic'] / CL_h_0\n        \n        AUC_ratio = AUC_inhib / AUC_control\n        \n        return round(AUC_ratio, 3)\n\n    results = []\n    for ki, kdeg in test_cases:\n        result = run_simulation(ki, kdeg, const_params)\n        results.append(result)\n        \n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3338346"}, {"introduction": "A model is only as credible as its parameters. This final practice addresses the fundamental challenge of parameter estimation by introducing Bayesian inference, a powerful framework for integrating prior knowledge with experimental data. By constructing a posterior probability distribution for key model parameters, this exercise [@problem_id:3338354] provides hands-on experience in finding the most plausible parameter values that explain noisy pharmacokinetic and pharmacodynamic data, a core competency in modern quantitative pharmacology.", "problem": "Consider a parsimonious physiologically based pharmacokinetic and quantitative systems pharmacology model linking a two-compartment intravenous bolus pharmacokinetic system to a downstream inhibitory turnover pharmacodynamic biomarker. The mass-balance ordinary differential equations are grounded in conservation of mass and linear transfer kinetics between compartments. Let the central compartment amount be $A_{c}(t)$ in $\\mathrm{mg}$, the peripheral compartment amount be $A_{p}(t)$ in $\\mathrm{mg}$, and the biomarker level be $R(t)$ in a dimensionless scale normalized to a baseline of $1$. The plasma concentration is $C(t) = A_{c}(t)/V_{c}$ in $\\mathrm{mg/L}$, where $V_{c}$ is the central volume of distribution in $\\mathrm{L}$. The parameters are the clearance $CL$ in $\\mathrm{L/h}$, the inter-compartmental clearance $Q$ in $\\mathrm{L/h}$, the peripheral volume $V_{p}$ in $\\mathrm{L}$, and the half-maximal inhibitory concentration $EC_{50}$ in $\\mathrm{mg/L}$. The inhibitory turnover model has zero-order production rate $k_{\\mathrm{in}}$ in $\\mathrm{h^{-1}}$ and first-order degradation rate $k_{\\mathrm{out}}$ in $\\mathrm{h^{-1}}$, with $k_{\\mathrm{in}} = k_{\\mathrm{out}}$ to ensure a pre-dose baseline $R(0) = 1$. The drug effect is modeled with inhibitory $I(C) = \\frac{C}{EC_{50} + C}$ and maximal effect fixed to $1$. An intravenous bolus dose $D$ in $\\mathrm{mg}$ is given at $t = 0$, so that $A_{c}(0) = D$, $A_{p}(0) = 0$, and $R(0) = 1$. The model is\n$$\n\\frac{dA_{c}}{dt} = -\\left(\\frac{CL}{V_{c}} + \\frac{Q}{V_{c}}\\right) A_{c} + \\frac{Q}{V_{p}} A_{p}, \\quad\n\\frac{dA_{p}}{dt} = \\frac{Q}{V_{c}} A_{c} - \\frac{Q}{V_{p}} A_{p}, \\quad\n\\frac{dR}{dt} = k_{\\mathrm{in}}\\left(1 - \\frac{C}{EC_{50} + C}\\right) - k_{\\mathrm{out}} R.\n$$\nAssume additive independent Gaussian measurement noise for the observed plasma concentrations $y^{C}_{i}$ at times $t^{C}_{i}$ and biomarker levels $y^{R}_{j}$ at times $t^{R}_{j}$, with known standard deviations $\\sigma_{C}$ in $\\mathrm{mg/L}$ and $\\sigma_{R}$ dimensionless:\n$$\ny^{C}_{i} = C(t^{C}_{i}) + \\varepsilon^{C}_{i}, \\quad \\varepsilon^{C}_{i} \\sim \\mathcal{N}(0,\\sigma_{C}^{2}), \\qquad\ny^{R}_{j} = R(t^{R}_{j}) + \\varepsilon^{R}_{j}, \\quad \\varepsilon^{R}_{j} \\sim \\mathcal{N}(0,\\sigma_{R}^{2}).\n$$\nWe seek Bayesian inference for the unknown parameter vector $\\theta = (CL, V_{c}, EC_{50})$ under independent log-normal priors specified as Gaussian priors on the natural logarithms, $\\log \\theta_{k} \\sim \\mathcal{N}(\\mu_{k}, \\tau_{k}^{2})$ with provided $(\\mu_{k},\\tau_{k})$. The inter-compartmental clearance $Q$, peripheral volume $V_{p}$, turnover rates $k_{\\mathrm{in}}$ and $k_{\\mathrm{out}}$, dose $D$, and measurement noise scales $(\\sigma_{C},\\sigma_{R})$ are known constants. Use Bayes’s theorem with the defined likelihood and priors to construct the log-posterior for $\\log\\theta$ and compute the maximum a posteriori estimate by numerical optimization. Then, from the maximum a posteriori estimate, compute the predicted biomarker $R(t)$ at $t = 24\\,\\mathrm{h}$.\n\nYour task is to implement a program that, for each test case below, numerically solves the coupled ordinary differential equations, evaluates the Gaussian log-likelihood, adds the Gaussian log-prior in log-parameter space, and finds the maximizer. The numerical solution must respect the given units and initial conditions. The final outputs must be:\n- The posterior mode (maximum a posteriori) estimate of $CL$ in $\\mathrm{L/h}$.\n- The model-predicted biomarker level $R(24)$ (dimensionless).\n\nExpress $CL$ in $\\mathrm{L/h}$ and $R(24)$ as floats rounded to three decimals. The final program must output a single line containing all results as a comma-separated list enclosed in square brackets, in the order specified in the test suite below.\n\nFundamental assumptions and definitions to use:\n- Mass conservation in well-stirred compartments with linear exchange and clearance.\n- Intravenous bolus dosing at $t = 0$ implies $A_{c}(0) = D$ and $A_{p}(0) = 0$.\n- Plasma concentration is $C(t) = A_{c}(t)/V_{c}$.\n- The inhibitory effect function is $I(C) = \\frac{C}{EC_{50} + C}$ with maximal effect fixed at $1$.\n- The biomarker turnover has baseline $R(0) = \\frac{k_{\\mathrm{in}}}{k_{\\mathrm{out}}} = 1$ enforced by $k_{\\mathrm{in}} = k_{\\mathrm{out}}$.\n- Independent Gaussian measurement errors with known standard deviations.\n- Independent Gaussian priors on $\\log \\theta$.\n\nTest suite parameters, data, and required output order:\nCommon known constants for all cases: $D = 100\\,\\mathrm{mg}$, $Q = 5\\,\\mathrm{L/h}$, $V_{p} = 20\\,\\mathrm{L}$, $k_{\\mathrm{out}} = 0.2\\,\\mathrm{h^{-1}}$, $k_{\\mathrm{in}} = 0.2\\,\\mathrm{h^{-1}}$. Observation times are $t^{C} = [\\,0.25,\\,0.5,\\,1,\\,2,\\,4,\\,8\\,]\\,\\mathrm{h}$ and $t^{R} = [\\,0.5,\\,1,\\,2,\\,4,\\,8,\\,24\\,]\\,\\mathrm{h}$.\n\n- Case $1$ (happy path):\n  - Concentrations $y^{C}$ in $\\mathrm{mg/L}$: $[\\,8.20,\\,6.90,\\,5.00,\\,3.20,\\,1.80,\\,0.80\\,]$.\n  - Biomarker $y^{R}$: $[\\,0.90,\\,0.80,\\,0.65,\\,0.50,\\,0.40,\\,0.95\\,]$.\n  - Noise scales: $\\sigma_{C} = 0.2\\,\\mathrm{mg/L}$, $\\sigma_{R} = 0.05$.\n  - Priors on $\\log \\theta$: $\\mu = [\\,\\log(3),\\,\\log(10),\\,\\log(1)\\,] = [\\,1.098612289,\\,2.302585093,\\,0.0\\,]$, $\\tau = [\\,0.3,\\,0.3,\\,0.5\\,]$.\n\n- Case $2$ (noisier, weaker prior):\n  - Concentrations $y^{C}$ in $\\mathrm{mg/L}$: $[\\,4.60,\\,4.20,\\,3.60,\\,3.00,\\,2.20,\\,1.40\\,]$.\n  - Biomarker $y^{R}$: $[\\,0.93,\\,0.88,\\,0.80,\\,0.70,\\,0.60,\\,0.90\\,]$.\n  - Noise scales: $\\sigma_{C} = 0.5\\,\\mathrm{mg/L}$, $\\sigma_{R} = 0.08$.\n  - Priors on $\\log \\theta$: $\\mu = [\\,\\log(2),\\,\\log(20),\\,\\log(2)\\,] = [\\,0.693147181,\\,2.995732274,\\,0.693147181\\,]$, $\\tau = [\\,0.7,\\,0.7,\\,0.7\\,]$.\n\n- Case $3$ (boundary-leaning, tighter prior):\n  - Concentrations $y^{C}$ in $\\mathrm{mg/L}$: $[\\,15.00,\\,12.00,\\,8.50,\\,5.00,\\,2.50,\\,1.00\\,]$.\n  - Biomarker $y^{R}$: $[\\,0.85,\\,0.75,\\,0.55,\\,0.45,\\,0.35,\\,0.98\\,]$.\n  - Noise scales: $\\sigma_{C} = 0.3\\,\\mathrm{mg/L}$, $\\sigma_{R} = 0.06$.\n  - Priors on $\\log \\theta$: $\\mu = [\\,\\log(1.2),\\,\\log(5),\\,\\log(0.5)\\,] = [\\,0.182321557,\\,1.609437912,\\,-0.693147181\\,]$, $\\tau = [\\,0.25,\\,0.25,\\,0.4\\,]$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets in the following order: `[CL_1,R_1(24),CL_2,R_2(24),CL_3,R_3(24)]`, where $CL_{i}$ is in $\\mathrm{L/h}$ and $R_{i}(24)$ is dimensionless. All numbers must be rounded to three decimals. Angles do not appear in this problem. No percentages are required; all proportions are expressed as decimals.", "solution": "The user has provided a well-defined Bayesian inference problem for a coupled pharmacokinetic-pharmacodynamic (PK-PD) model. The problem is validated as scientifically sound, well-posed, and complete.\n\nThe task is to find the maximum a posteriori (MAP) estimate for a subset of model parameters $\\theta = (CL, V_{c}, EC_{50})$ and then predict a biomarker response at a specific time point using this MAP estimate. This will be performed for three distinct test cases, each with its own dataset and prior specification.\n\nThe solution proceeds as follows:\n\n**1. Model Definition**\nThe model consists of a system of three coupled ordinary differential equations (ODEs):\n$$\n\\frac{dA_{c}}{dt} = -\\left(\\frac{CL}{V_{c}} + \\frac{Q}{V_{c}}\\right) A_{c} + \\frac{Q}{V_{p}} A_{p}\n$$\n$$\n\\frac{dA_{p}}{dt} = \\frac{Q}{V_{c}} A_{c} - \\frac{Q}{V_{p}} A_{p}\n$$\n$$\n\\frac{dR}{dt} = k_{\\mathrm{in}}\\left(1 - \\frac{C}{EC_{50} + C}\\right) - k_{\\mathrm{out}} R\n$$\nwhere the state variables are the amount of drug in the central compartment $A_{c}(t)$, the amount in the peripheral compartment $A_{p}(t)$, and the biomarker response $R(t)$. The plasma concentration is $C(t) = A_{c}(t)/V_{c}$. The initial conditions for an intravenous bolus dose $D$ are $A_{c}(0) = D$, $A_{p}(0) = 0$, and $R(0) = 1$. The parameters to be estimated are the clearance $CL$, the central volume of distribution $V_c$, and the half-maximal inhibitory concentration $EC_{50}$. All other parameters ($Q, V_p, k_{\\mathrm{in}}, k_{\\mathrm{out}}, D$) are known constants.\n\n**2. Bayesian Framework**\nAccording to Bayes's theorem, the posterior probability distribution of the parameters $\\theta$ given the observed data $y = (y^C, y^R)$ is:\n$$\np(\\theta | y) \\propto p(y | \\theta) \\cdot p(\\theta)\n$$\nwhere $p(y | \\theta)$ is the likelihood and $p(\\theta)$ is the prior distribution. The MAP estimate, $\\theta_{\\mathrm{MAP}}$, is the value of $\\theta$ that maximizes this posterior probability. It is computationally more convenient and numerically more stable to work with the logarithm of the posterior:\n$$\n\\log p(\\theta | y) = \\log p(y | \\theta) + \\log p(\\theta) + \\text{constant}\n$$\nMaximizing the log-posterior is equivalent to maximizing the posterior itself.\n\n**3. Log-Likelihood Function**\nThe problem specifies that the measurement errors are independent and follow a Gaussian distribution:\n$y^C_i \\sim \\mathcal{N}(C(t^C_i; \\theta), \\sigma_C^2)$ and $y^R_j \\sim \\mathcal{N}(R(t^R_j; \\theta), \\sigma_R^2)$. The log-likelihood function is the sum of the log-probability densities for all observations:\n$$\n\\log p(y | \\theta) = \\sum_{i} \\left( -\\frac{1}{2} \\left(\\frac{y^C_i - C(t^C_i; \\theta)}{\\sigma_C}\\right)^2 \\right) + \\sum_{j} \\left( -\\frac{1}{2} \\left(\\frac{y^R_j - R(t^R_j; \\theta)}{\\sigma_R}\\right)^2 \\right) + \\text{constant}\n$$\nThe model predictions $C(t; \\theta)$ and $R(t; \\theta)$ are obtained by numerically solving the ODE system with a given parameter set $\\theta$.\n\n**4. Log-Prior Function**\nThe parameters are transformed to a logarithmic scale, $\\hat{\\theta}_k = \\log \\theta_k$. The priors are specified as independent Gaussian distributions on these log-transformed parameters: $\\hat{\\theta}_k \\sim \\mathcal{N}(\\mu_k, \\tau_k^2)$. The joint log-prior is:\n$$\n\\log p(\\theta) = \\log p(\\hat{\\theta}) = \\sum_{k=1}^{3} \\left( -\\frac{1}{2} \\left(\\frac{\\hat{\\theta}_k - \\mu_k}{\\tau_k}\\right)^2 \\right) + \\text{constant}\n$$\n\n**5. Objective Function for Optimization**\nThe MAP estimate is found by maximizing the log-posterior. Standard numerical optimization algorithms are designed to minimize a function. Therefore, we define an objective function $F(\\hat{\\theta})$ as the negative of the log-posterior, dropping all constant terms:\n$$\nF(\\hat{\\theta}) = \\frac{1}{2} \\sum_{i} \\left(\\frac{y^C_i - C(t^C_i; \\theta(\\hat{\\theta}))}{\\sigma_C}\\right)^2 + \\frac{1}{2} \\sum_{j} \\left(\\frac{y^R_j - R(t^R_j; \\theta(\\hat{\\theta}))}{\\sigma_R}\\right)^2 + \\frac{1}{2} \\sum_{k=1}^{3} \\left(\\frac{\\hat{\\theta}_k - \\mu_k}{\\tau_k}\\right)^2\n$$\nThe MAP estimate in log-space, $\\hat{\\theta}_{\\mathrm{MAP}}$, is found by minimizing $F(\\hat{\\theta})$. The MAP estimate in the original parameter space is then $\\theta_{\\mathrm{MAP}} = \\exp(\\hat{\\theta}_{\\mathrm{MAP}})$.\n\n**6. Implementation Strategy**\nThe solution is implemented in Python using the `numpy` and `scipy` libraries.\n- A function `model_rhs` defines the right-hand side of the ODE system.\n- For each test case, an objective function `neg_log_posterior` is constructed. This function takes a vector of log-transformed parameters $\\hat{\\theta}$ as input.\n- Inside `neg_log_posterior`:\n    1. The parameters are transformed back to their original scale: $\\theta = \\exp(\\hat{\\theta})$.\n    2. The ODE system is solved using `scipy.integrate.solve_ivp` with the current parameter values to generate model predictions for $C(t)$ and $R(t)$ at the required observation times. A robust implicit solver (`Radau`) is used to handle potential stiffness.\n    3. The value of the objective function $F(\\hat{\\theta})$ is calculated using the model predictions and observed data.\n- The `scipy.optimize.minimize` function (with the `BFGS` algorithm) is used to find the vector $\\hat{\\theta}_{\\mathrm{MAP}}$ that minimizes `neg_log_posterior`. The prior means $\\mu_k$ are used as the initial guess for the optimization.\n- After finding $\\theta_{\\mathrm{MAP}} = \\exp(\\hat{\\theta}_{\\mathrm{MAP}})$, the ODE system is solved one final time with these optimal parameters to predict the biomarker level $R(t)$ at $t=24\\,\\mathrm{h}$.\n- The resulting MAP estimate for $CL$ and the predicted value $R(24)$ are collected for each test case.\n- Finally, all results are formatted to three decimal places and printed in the specified single-line format.", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\nfrom scipy.optimize import minimize\n\ndef solve():\n    \"\"\"\n    Main function to solve the PK/PD model fitting problem for all test cases.\n    \"\"\"\n\n    # --- Common parameters and data for all cases ---\n    common_params = {\n        'D': 100.0,      # mg\n        'Q': 5.0,        # L/h\n        'Vp': 20.0,      # L\n        'kout': 0.2,     # 1/h\n        'kin': 0.2,      # 1/h\n        't_C': [0.25, 0.5, 1.0, 2.0, 4.0, 8.0],  # h\n        't_R': [0.5, 1.0, 2.0, 4.0, 8.0, 24.0]  # h\n    }\n\n    # --- Test suite definition ---\n    test_cases = [\n        {  # Case 1\n            \"data_C\": (np.array([8.20, 6.90, 5.00, 3.20, 1.80, 0.80]), 0.2), # (y_C, sigma_C)\n            \"data_R\": (np.array([0.90, 0.80, 0.65, 0.50, 0.40, 0.95]), 0.05),# (y_R, sigma_R)\n            \"priors\": (np.log([3.0, 10.0, 1.0]), np.array([0.3, 0.3, 0.5])) # (mu, tau)\n        },\n        {  # Case 2\n            \"data_C\": (np.array([4.60, 4.20, 3.60, 3.00, 2.20, 1.40]), 0.5),\n            \"data_R\": (np.array([0.93, 0.88, 0.80, 0.70, 0.60, 0.90]), 0.08),\n            \"priors\": (np.log([2.0, 20.0, 2.0]), np.array([0.7, 0.7, 0.7]))\n        },\n        {  # Case 3\n            \"data_C\": (np.array([15.00, 12.00, 8.50, 5.00, 2.50, 1.00]), 0.3),\n            \"data_R\": (np.array([0.85, 0.75, 0.55, 0.45, 0.35, 0.98]), 0.06),\n            \"priors\": (np.log([1.2, 5.0, 0.5]), np.array([0.25, 0.25, 0.4]))\n        }\n    ]\n\n    # --- ODE model definition ---\n    def model_rhs(t, y, CL, Vc, EC50, Q, Vp, kin, kout):\n        Ac, Ap, R = y\n        if Vc <= 0: return [np.inf, np.inf, np.inf]\n        \n        C = Ac / Vc\n        inhibition = C / (EC50 + C)\n        \n        dAc_dt = -(CL / Vc + Q / Vc) * Ac + (Q / Vp) * Ap\n        dAp_dt = (Q / Vc) * Ac - (Q / Vp) * Ap\n        dR_dt = kin * (1 - inhibition) - kout * R\n        \n        return [dAc_dt, dAp_dt, dR_dt]\n\n    # --- Core processing function for a single case ---\n    def process_case(case_data):\n        # Unpack data for the case\n        y_C_obs, sigma_C = case_data['data_C']\n        y_R_obs, sigma_R = case_data['data_R']\n        prior_mu, prior_tau = case_data['priors']\n        \n        # Unpack common parameters\n        D, Q, Vp, kin, kout, t_C, t_R = common_params.values()\n        y0 = [D, 0.0, 1.0]\n\n        # Prepare for ODE solving\n        t_eval_unique = sorted(list(set(t_C) | set(t_R)))\n        t_span = (0, max(t_eval_unique))\n        t_map_C = [t_eval_unique.index(t) for t in t_C]\n        t_map_R = [t_eval_unique.index(t) for t in t_R]\n\n        # Objective function: negative log-posterior\n        def neg_log_posterior(log_params):\n            CL, Vc, EC50 = np.exp(log_params)\n\n            if not (CL > 0 and Vc > 0 and EC50 > 0): return np.inf\n\n            sol = solve_ivp(\n                model_rhs, t_span, y0,\n                args=(CL, Vc, EC50, Q, Vp, kin, kout),\n                t_eval=t_eval_unique, method='Radau', dense_output=False\n            )\n            \n            if sol.status != 0: return np.inf\n\n            C_pred_all = sol.y[0] / Vc\n            R_pred_all = sol.y[2]\n            \n            C_pred = C_pred_all[t_map_C]\n            R_pred = R_pred_all[t_map_R]\n            \n            log_lik_term = np.sum(((y_C_obs - C_pred) / sigma_C)**2) + \\\n                           np.sum(((y_R_obs - R_pred) / sigma_R)**2)\n            log_prior_term = np.sum(((log_params - prior_mu) / prior_tau)**2)\n            \n            return 0.5 * (log_lik_term + log_prior_term)\n\n        # Optimization to find MAP\n        opt_result = minimize(neg_log_posterior, prior_mu, method='BFGS')\n        \n        # Extract MAP estimates and predict R(24)\n        CL_map, Vc_map, EC50_map = np.exp(opt_result.x)\n        \n        final_sol = solve_ivp(\n            model_rhs, (0, 24), y0,\n            args=(CL_map, Vc_map, EC50_map, Q, Vp, kin, kout),\n            t_eval=[24], method='Radau', dense_output=False\n        )\n        R_24 = final_sol.y[2, 0]\n        \n        return CL_map, R_24\n\n    # --- Loop through cases and collect results ---\n    all_results = []\n    for case in test_cases:\n        cl_map, r_24 = process_case(case)\n        all_results.append(f\"{cl_map:.3f}\")\n        all_results.append(f\"{r_24:.3f}\")\n\n    # --- Print final output in the required format ---\n    print(f\"[{','.join(all_results)}]\")\n\n# Execute the solver\nsolve()\n```", "id": "3338354"}]}