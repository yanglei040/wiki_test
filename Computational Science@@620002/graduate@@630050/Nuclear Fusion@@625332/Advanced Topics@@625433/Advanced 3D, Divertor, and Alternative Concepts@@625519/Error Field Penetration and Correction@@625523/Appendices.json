{"hands_on_practices": [{"introduction": "Understanding abstract concepts like error fields becomes much clearer when connected to concrete, measurable effects. This first practice explores one of the most direct physical consequences of error field penetration: the distortion of the magnetic separatrix. You will perform a first-principles calculation to quantify how a resonant error field leads to the splitting of divertor strike points, a critical issue for managing heat and particle loads in a tokamak. [@problem_id:3698720]", "problem": "A large-aspect-ratio, single-null tokamak equilibrium is described by an axisymmetric poloidal flux $\\psi(R,Z)$ with a separatrix that terminates at a magnetic X-point. In the absence of non-axisymmetric fields, the stable and unstable manifolds of the X-point coincide and field lines intersect the divertor target at a single strike point. Consider a small, fully penetrated, stationary non-axisymmetric error field with toroidal mode number $n=1$ that produces a normal (to the unperturbed separatrix) magnetic field component at the X-point. Assume the following physically justified idealizations:\n\n- Field lines satisfy the kinematic law $d\\mathbf{x}/ds = \\mathbf{B}/|\\mathbf{B}|$, where $s$ is arc length and $\\mathbf{B}$ is the magnetic field.\n- The non-axisymmetric error field produces a normal field component at the X-point of amplitude $b_{x}$, which is approximately constant along the connection from the X-point to the divertor target, and its spectrum is dominated by $n=1$.\n- The total magnetic field magnitude along the connection is $|\\mathbf{B}| = \\sqrt{B_{\\phi}^{2} + B_{\\theta}^{2}}$, with $B_{\\phi}$ the toroidal field and $B_{\\theta}$ the poloidal field.\n- The connection length from the X-point vicinity to the divertor target along an unperturbed field line is $L_{c}$.\n- The divertor target plate is oriented such that displacements normal to the unperturbed separatrix map one-to-one to separations along the measured footprint coordinate $s$ at the target (i.e., the local geometric projection factor is unity).\n\nUnder these assumptions, resonant field penetration generates a homoclinic tangle of invariant manifolds, and the resulting divertor strike point splitting is set by twice the integrated normal field-line displacement accumulated along the connection. Using first principles, derive the expression for the footprint separation $\\Delta s$ at a fixed toroidal angle, and then compute its value for the following parameters:\n- $B_{\\phi} = 2.9~\\mathrm{T}$,\n- $B_{\\theta} = 0.09~\\mathrm{T}$,\n- $b_{x} = 1.2 \\times 10^{-4}~\\mathrm{T}$,\n- $L_{c} = 28~\\mathrm{m}$.\n\nRound your final numerical answer to three significant figures and express the footprint separation in $\\mathrm{mm}$.", "solution": "The problem asks for the derivation of the footprint separation $\\Delta s$ on the divertor target caused by a non-axisymmetric error field. We begin from the first principles of magnetic field line tracing. The trajectory of a magnetic field line $\\mathbf{x}$ is described by the differential equation:\n$$\n\\frac{d\\mathbf{x}}{ds} = \\frac{\\mathbf{B}}{|\\mathbf{B}|}\n$$\nwhere $s$ is the arc length. Let $\\delta_n$ be the displacement normal to the unperturbed separatrix. Its rate of change along the field line is given by projecting the trajectory equation onto the normal direction:\n$$\n\\frac{d\\delta_n}{ds} = \\frac{\\mathbf{B} \\cdot \\hat{n}}{|\\mathbf{B}|} = \\frac{B_n}{|\\mathbf{B}|}\n$$\nwhere $B_n$ is the component of the magnetic field normal to the unperturbed surface. By assumption, this is just the error field component, $B_n = b_x$.\n\nTo find the total normal displacement $\\Delta_n$ of a field line as it travels from the X-point vicinity to the divertor target, we integrate this expression over the connection length $L_c$.\n$$\n\\Delta_n = \\int_{0}^{L_c} \\frac{b_x(s)}{|\\mathbf{B}(s)|} ds\n$$\nThe problem assumes that $b_x$ and $|\\mathbf{B}|$ are constant along the connection path. The integral simplifies to:\n$$\n\\Delta_n = \\frac{b_x}{|\\mathbf{B}|} \\int_{0}^{L_c} ds = \\frac{b_x L_c}{|\\mathbf{B}|}\n$$\nThis expression represents the normal displacement of a single perturbed manifold (either stable or unstable) from the position of the unperturbed strike point. The error field causes the stable and unstable manifolds of the X-point, which were coincident in the unperturbed case, to split apart. At a toroidal location of maximum perturbation, these two manifolds are displaced by an amount $\\Delta_n$ in opposite directions. Therefore, the total separation between the two new strike points, which is the footprint separation $\\Delta s$, is twice the single-manifold displacement.\n$$\n\\Delta s = 2 \\Delta_n = 2 \\frac{b_x L_c}{|\\mathbf{B}|}\n$$\nWith the assumption of a unity projection factor, this is the measured separation.\n\nWe now compute the numerical value using the provided parameters:\n-   Toroidal field, $B_{\\phi} = 2.9~\\mathrm{T}$\n-   Poloidal field, $B_{\\theta} = 0.09~\\mathrm{T}$\n-   Normal error field, $b_{x} = 1.2 \\times 10^{-4}~\\mathrm{T}$\n-   Connection length, $L_{c} = 28~\\mathrm{m}$\n\nFirst, we calculate the magnitude of the total magnetic field:\n$$\n|\\mathbf{B}| = \\sqrt{B_{\\phi}^{2} + B_{\\theta}^{2}} = \\sqrt{(2.9)^{2} + (0.09)^{2}}~\\mathrm{T} = \\sqrt{8.41 + 0.0081}~\\mathrm{T} = \\sqrt{8.4181}~\\mathrm{T} \\approx 2.901396~\\mathrm{T}\n$$\nNext, we substitute this and the other values into the expression for $\\Delta s$:\n$$\n\\Delta s = 2 \\times \\frac{(1.2 \\times 10^{-4}~\\mathrm{T}) \\times (28~\\mathrm{m})}{2.901396~\\mathrm{T}}\n$$\n$$\n\\Delta s = \\frac{0.00672}{2.901396}~\\mathrm{m} \\approx 0.0023161~\\mathrm{m}\n$$\nThe problem requires the answer to be in millimeters ($\\mathrm{mm}$) and rounded to three significant figures.\n$$\n\\Delta s \\approx 0.0023161~\\mathrm{m} \\times \\frac{1000~\\mathrm{mm}}{1~\\mathrm{m}} \\approx 2.3161~\\mathrm{mm}\n$$\nRounding to three significant figures, we get:\n$$\n\\Delta s \\approx 2.32~\\mathrm{mm}\n$$", "answer": "$$\\boxed{2.32}$$", "id": "3698720"}, {"introduction": "After an error field penetrates the plasma, it doesn't just statically exist; it interacts with the plasma to drive instabilities, most notably magnetic islands. This exercise moves beyond the initial effect to model the dynamic evolution of the resulting island using the modified Rutherford equation. You will explore how the competition between intrinsic plasma stability, destabilizing neoclassical effects from the bootstrap current, and the drive from the external field itself determines the island's final, saturated width. [@problem_id:3698712]", "problem": "Consider a large aspect ratio tokamak with circular cross-section, minor radius $a$, and a single dominant tearing resonant surface at radius $r_s$ where the safety factor $q$ satisfies $q(r_s) = 2$. Assume the late nonlinear evolution is in the Rutherford regime, with a constant-helical-flux (constant-$\\psi$) inner layer. Use resistive Magnetohydrodynamics (MHD), with quasi-static evolution such that the inertia is negligible and the parallel electric field $E_{\\parallel}$ is balanced by resistive dissipation. The free-energy drive for the mode is characterized by the outer-region matching parameter, the tearing stability index $\\Delta'$, defined from the jump in the logarithmic derivative of the perturbed flux across the resistive layer. \n\nStarting from the fundamental laws (Ampère's law $\\nabla \\times \\mathbf{B} = \\mu_0 \\mathbf{j}$, Faraday's law $\\partial \\mathbf{B} / \\partial t = - \\nabla \\times \\mathbf{E}$, and the resistive form of Ohm's law $\\mathbf{E} + \\mathbf{v} \\times \\mathbf{B} = \\eta \\mathbf{j}$), and using asymptotic matching between the outer ideal region and the inner resistive layer, derive how neoclassical effects associated with the bootstrap current modify the effective tearing drive in the Rutherford framework. Specifically, show that pressure flattening inside a magnetic island produces a neoclassical correction to the effective tearing drive that scales inversely with the island half-width $w$ and can be represented as an additive term of the form $\\Delta'_{\\text{bs}}(w) = C_{\\text{bs}}/w$ in the effective tearing stability index. Further, consider an externally applied, static, resonant radial magnetic field of amplitude $b_r$ at the rational surface that penetrates the resistive layer without rotational shielding, and show that it adds an effective constant drive $\\Delta'_{\\text{EF}} = C_{\\text{EF}} \\left(b_r / B_{\\theta}(r_s)\\right)$ to the tearing stability index, where $B_{\\theta}(r_s)$ is the equilibrium poloidal magnetic field at $r_s$.\n\nAssume the following experimentally motivated parameters for a specific discharge:\n- Rational surface radius $r_s = 0.50$ m,\n- Poloidal magnetic field at the rational surface $B_{\\theta}(r_s) = 0.50$ T,\n- Equilibrium tearing stability index without neoclassical or external-field contributions $\\Delta'_0 = -2.50$ m$^{-1}$,\n- Bootstrap coefficient $C_{\\text{bs}} = 0.060$ (dimensionless),\n- External-field coefficient $C_{\\text{EF}} = 0.80$ m$^{-1}$,\n- Applied resonant radial magnetic field $b_r = 1.00 \\times 10^{-4}$ T.\n\nUnder these assumptions, determine the steady-state magnetic island half-width $w_{\\text{ss}}$ implied by the neoclassical Rutherford evolution with both bootstrap current modification and external resonant field drive. Your reasoning must begin from the stated fundamental laws and asymptotic matching concept to justify the form of the neoclassical and external-field contributions to the effective tearing drive. Then, using these contributions, obtain the steady-state condition and compute $w_{\\text{ss}}$ numerically from the given parameters. Round your final numeric answer to four significant figures and express the final island half-width in meters.", "solution": "The evolution of the magnetic island half-width $w$ is governed by the modified Rutherford equation, which sets the growth rate proportional to an effective tearing stability index $\\Delta'_{\\text{eff}}$:\n$$\n\\frac{G}{\\eta} \\frac{dw}{dt} = \\Delta'_{\\text{eff}}(w) = \\Delta'_0 + \\Delta'_{\\text{bs}}(w) + \\Delta'_{\\text{EF}}\n$$\nHere, $\\Delta'_0$ is the classical stability index, $\\Delta'_{\\text{bs}}$ is the drive from the bootstrap current deficit, and $\\Delta'_{\\text{EF}}$ is the drive from the external field. The steady-state island width, $w_{\\text{ss}}$, is found by setting the total effective drive to zero.\n\n**1. Justification of Terms**\n\n-   **Neoclassical Term ($\\Delta'_{\\text{bs}}$)**: Pressure flattening within the island eliminates the local bootstrap current. This current deficit acts as a drive for the island. Standard derivations show this drive scales inversely with the island width, justifying the form $\\Delta'_{\\text{bs}}(w) = C_{\\text{bs}}/w$.\n-   **External Field Term ($\\Delta'_{\\text{EF}}$)**: An external resonant field $b_r$ that penetrates the plasma forces reconnection, adding a constant drive to the tearing mode proportional to its amplitude. This justifies the form $\\Delta'_{\\text{EF}} = C_{\\text{EF}} (b_r / B_{\\theta}(r_s))$.\n\n**2. Steady-State Calculation**\n\nAt steady state ($dw/dt=0$), the condition is $\\Delta'_{\\text{eff}}(w_{\\text{ss}}) = 0$:\n$$\n\\Delta'_0 + \\frac{C_{\\text{bs}}}{w_{\\text{ss}}} + C_{\\text{EF}} \\frac{b_r}{B_{\\theta}(r_s)} = 0\n$$\nFirst, we compute the external field contribution $\\Delta'_{\\text{EF}}$:\n$$\n\\Delta'_{\\text{EF}} = (0.80 \\, \\text{m}^{-1}) \\times \\frac{1.00 \\times 10^{-4} \\, \\text{T}}{0.50 \\, \\text{T}} = 1.60 \\times 10^{-4} \\, \\text{m}^{-1}\n$$\nNow, substitute the known values into the steady-state equation:\n$$\n-2.50 \\, \\text{m}^{-1} + \\frac{0.060}{w_{\\text{ss}}} + 1.60 \\times 10^{-4} \\, \\text{m}^{-1} = 0\n$$\nSolving for $w_{\\text{ss}}$:\n$$\n\\frac{0.060}{w_{\\text{ss}}} = 2.50 \\, \\text{m}^{-1} - 0.00016 \\, \\text{m}^{-1} = 2.49984 \\, \\text{m}^{-1}\n$$\n$$\nw_{\\text{ss}} = \\frac{0.060}{2.49984} \\, \\text{m} \\approx 0.024001216 \\, \\text{m}\n$$\nRounding to four significant figures:\n$$\nw_{\\text{ss}} = 0.02400 \\, \\text{m}\n$$", "answer": "$$\\boxed{0.02400}$$", "id": "3698712"}, {"introduction": "With a physical understanding of how error fields cause harm, the final step is to design an effective mitigation strategy. This culminating practice places you in the role of a tokamak operator, tasked with programming a set of external coils to cancel an intrinsic error field. Using the principles of constrained optimization, you will derive the optimal coil currents that minimize the dangerous resonant field component while respecting real-world hardware limits. [@problem_id:3698726]", "problem": "In a tokamak, slowly varying non-axisymmetric error fields couple to rational magnetic surfaces and can penetrate the plasma, driving magnetic island growth when the resonant normal field exceeds a threshold set by plasma rotation and resistivity. To correct these error fields, a set of external non-axisymmetric coils is used to produce a compensating field that superposes linearly with the intrinsic error field, by the linearity of the Biot–Savart law and the principle of superposition. Let the coil-current-to-field response on a chosen rational surface for two orthogonal Fourier components (for example, cosine and sine components of the dominant toroidal mode) be represented by a real response matrix $M \\in \\mathbb{R}^{2 \\times 2}$ with entries in $\\mathrm{mT}\\,\\mathrm{kA}^{-1}$. Let the coil currents be the vector $I \\in \\mathbb{R}^{2}$ with entries in $\\mathrm{kA}$, and let the target compensating field (equal and opposite to the measured error field on that surface) be $b_{\\mathrm{target}} \\in \\mathbb{R}^{2}$ with entries in $\\mathrm{mT}$. The superposed field from the coils is $b_{\\mathrm{coil}} = M I$.\n\nStarting from the fundamental linearity and superposition principles for magnetostatics and the definition of the Euclidean norm, derive from first principles the optimal coil current vector that minimizes the objective $J(I) = \\lVert M I - b_{\\mathrm{target}} \\rVert_{2}$ subject to hard current limits for each coil. Use the Karush–Kuhn–Tucker optimality conditions to treat the inequality constraints and identify any active constraints at the solution. Then evaluate your expression for the following physically plausible data:\n- $M = \\begin{pmatrix} 1.1  -0.3 \\\\ 0.4  0.8 \\end{pmatrix}$ (entries in $\\mathrm{mT}\\,\\mathrm{kA}^{-1}$),\n- $b_{\\mathrm{target}} = \\begin{pmatrix} 2.5 \\\\ 1.0 \\end{pmatrix}$ (entries in $\\mathrm{mT}$),\n- symmetric coil current bounds $-I_{\\max} \\le I_i \\le I_{\\max}$ with $I_{\\max} = 2$ (in $\\mathrm{kA}$) for both coils.\n\nIn your derivation, begin from the quadratic least-squares objective implied by the Euclidean norm and establish the stationarity and complementary slackness conditions without assuming any particular “shortcut” formula. Identify the active set and solve explicitly for the optimal $I$.\n\nFinally, report the optimal coil current vector $I^{\\star}$ as a row vector in $\\mathrm{kA}$, rounded to four significant figures. Explain briefly how your result provides the error field correction settings that suppress penetration by minimizing the resonant normal field on the rational surface.", "solution": "The goal is to find the optimal coil current vector $I^{\\star}$ that minimizes the objective function $J(I) = \\lVert M I - b_{\\mathrm{target}} \\rVert_{2}$ subject to the current limits. This is a constrained quadratic optimization problem. Minimizing $J(I)$ is equivalent to minimizing its square, $F(I) = \\frac{1}{2} \\lVert M I - b_{\\mathrm{target}} \\rVert_{2}^{2}$. The problem is solved using the Karush–Kuhn–Tucker (KKT) conditions for the box constraints $-I_{\\max} \\le I_i \\le I_{\\max}$.\n\nFirst, we find the unconstrained solution by assuming no constraints are active. This is the standard least-squares solution, found by setting the gradient of $F(I)$ to zero:\n$$\\nabla_I F(I) = M^T M I - M^T b_{\\mathrm{target}} = 0 \\implies I_{\\text{unconstrained}} = (M^T M)^{-1} M^T b_{\\mathrm{target}}$$\nWe substitute the given numerical values:\n$M = \\begin{pmatrix} 1.1  -0.3 \\\\ 0.4  0.8 \\end{pmatrix}$, $b_{\\mathrm{target}} = \\begin{pmatrix} 2.5 \\\\ 1.0 \\end{pmatrix}$, $I_{\\max} = 2$.\n\n$M^T M = \\begin{pmatrix} 1.1  0.4 \\\\ -0.3  0.8 \\end{pmatrix} \\begin{pmatrix} 1.1  -0.3 \\\\ 0.4  0.8 \\end{pmatrix} = \\begin{pmatrix} 1.37  -0.01 \\\\ -0.01  0.73 \\end{pmatrix}$\n$M^T b_{\\mathrm{target}} = \\begin{pmatrix} 1.1  0.4 \\\\ -0.3  0.8 \\end{pmatrix} \\begin{pmatrix} 2.5 \\\\ 1.0 \\end{pmatrix} = \\begin{pmatrix} 3.15 \\\\ 0.05 \\end{pmatrix}$\n\nThe inverse of $M^T M$ is:\n$(M^T M)^{-1} = \\frac{1}{(1.37)(0.73) - (-0.01)^2} \\begin{pmatrix} 0.73  0.01 \\\\ 0.01  1.37 \\end{pmatrix} = \\begin{pmatrix} 0.73  0.01 \\\\ 0.01  1.37 \\end{pmatrix}$\n\nThe unconstrained solution is:\n$$I_{\\text{unconstrained}} = \\begin{pmatrix} 0.73  0.01 \\\\ 0.01  1.37 \\end{pmatrix} \\begin{pmatrix} 3.15 \\\\ 0.05 \\end{pmatrix} = \\begin{pmatrix} (0.73)(3.15) + (0.01)(0.05) \\\\ (0.01)(3.15) + (1.37)(0.05) \\end{pmatrix} = \\begin{pmatrix} 2.3 \\\\ 0.1 \\end{pmatrix}$$\nThis solution is not feasible because $I_1 = 2.3$ kA, which exceeds the limit $I_{\\max} = 2$ kA.\n\nThis indicates that the optimal solution must lie on the boundary of the feasible set. The violated constraint is $I_1 \\le 2$, so we set $I_1^{\\star} = 2$. This constraint is now active. We solve for the remaining unknown, $I_2^{\\star}$, by enforcing the KKT stationarity condition for the second component of the current vector, for which we assume no constraints are active. The second row of the stationarity equation $\\nabla_I \\mathcal{L} = 0$ is simply $(M^T M I - M^T b_{\\mathrm{target}})_2 = 0$:\n$$-0.01 I_1^{\\star} + 0.73 I_2^{\\star} - 0.05 = 0$$\nSubstitute $I_1^{\\star} = 2$:\n$$-0.01(2) + 0.73 I_2^{\\star} - 0.05 = 0$$\n$$0.73 I_2^{\\star} = 0.07 \\implies I_2^{\\star} = \\frac{0.07}{0.73} \\approx 0.0958904 \\, \\text{kA}$$\nThe optimal solution is $I^{\\star} = (2, 0.09589...)^T$. This solution is feasible as both components are within the $[-2, 2]$ kA bounds. A full KKT analysis confirms that the Lagrange multiplier for the active constraint $I_1 \\le 2$ is positive, satisfying all optimality conditions.\n\nThe optimal coil current vector $I^{\\star}$ provides the settings for the external correction coils. By applying these currents, the coils generate a field $M I^{\\star}$ that best cancels the intrinsic error field (represented by $b_{\\text{target}}$) within hardware limits. Minimizing the residual field $\\lVert M I^{\\star} - b_{\\text{target}} \\rVert_2$ is the direct method for suppressing island growth and preventing mode locking. The saturation of one coil at its limit indicates the correction is constrained by hardware capability.\n\nThe final optimal coil current vector, reported as a row vector and rounded to four significant figures, is:\n$I^{\\star} = \\begin{pmatrix} 2.000  0.09589 \\end{pmatrix}$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix} 2.000  0.09589 \\end{pmatrix}\n}\n$$", "id": "3698726"}]}