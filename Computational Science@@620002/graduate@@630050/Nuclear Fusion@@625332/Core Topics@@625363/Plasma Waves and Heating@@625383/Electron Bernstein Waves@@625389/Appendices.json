{"hands_on_practices": [{"introduction": "Electron Bernstein Waves (EBWs) are fundamentally kinetic phenomena, meaning their existence is tied to the finite orbits of particles in a magnetic field. This exercise asks you to quantify this \"kineticness\" by deriving and calculating the dimensionless parameter $b = k_{\\perp}^{2} \\rho_{e}^{2}$, which compares the perpendicular wavelength of the wave to the electron's Larmor radius. Starting from the Lorentz force, this practice reinforces the physical origin of gyro-motion and provides a tangible measure for when a simple fluid plasma description is insufficient and a kinetic treatment is required [@problem_id:3697065].", "problem": "An Electron Bernstein wave (EBW) propagating in a uniform, magnetized plasma is characterized by the finite Larmor radius parameter $b = k_{\\perp}^{2} \\rho_{e}^{2}$, where $k_{\\perp}$ is the perpendicular wavenumber and $\\rho_{e}$ is the electron Larmor radius. Starting only from the Lorentz force law and the definition of the thermal speed for a Maxwellian plasma, derive an expression for $b$ in terms of $k_{\\perp}$, $B$, $T_{e}$, and fundamental constants, and then evaluate it numerically for $k_{\\perp} = 200\\,\\mathrm{m}^{-1}$, $T_{e} = 2\\,\\mathrm{keV}$, and $B = 2\\,\\mathrm{T}$. In plasma physics, temperatures quoted in $\\mathrm{keV}$ denote the thermal energy per particle, i.e., $k_{B} T_{e}$, so that $k_{B} T_{e} = 2\\,\\mathrm{keV}$. Based on the magnitude of $b$, state whether the small-$b$ or large-$b$ limit is appropriate for dispersion analysis of EBWs. Use $e = 1.602176634 \\times 10^{-19}\\,\\mathrm{C}$, $m_{e} = 9.1093837015 \\times 10^{-31}\\,\\mathrm{kg}$, and $1\\,\\mathrm{eV} = 1.602176634 \\times 10^{-19}\\,\\mathrm{J}$. Express the final value of $b$ as a pure number (no units) and round your answer to three significant figures.", "solution": "The problem is found to be valid as it is scientifically grounded in plasma physics, well-posed, and all necessary data for a unique solution are provided.\n\nThe problem asks for the derivation and numerical evaluation of the finite Larmor radius parameter $b = k_{\\perp}^{2} \\rho_{e}^{2}$. The derivation must start from the Lorentz force law and the definition of thermal speed.\n\nFirst, we derive an expression for the electron Larmor radius, $\\rho_{e}$. An electron with charge $-e$ and mass $m_{e}$ moving with velocity $\\vec{v}$ in a uniform magnetic field $\\vec{B}$ experiences a Lorentz force $\\vec{F} = -e(\\vec{v} \\times \\vec{B})$. We decompose the velocity into components parallel ($\\vec{v}_{\\parallel}$) and perpendicular ($\\vec{v}_{\\perp}$) to the magnetic field. The force affects only the perpendicular component, causing the electron to gyrate in a circular path in the plane perpendicular to $\\vec{B}$. The magnitude of this force is $F = e v_{\\perp} B$, assuming $\\vec{v}_{\\perp}$ is orthogonal to $\\vec{B}$. This force provides the necessary centripetal force for circular motion, $F_{c} = \\frac{m_{e} v_{\\perp}^{2}}{\\rho_{e}}$, where $\\rho_{e}$ is the radius of the circle, known as the Larmor radius.\n\nEquating the Lorentz force and the centripetal force:\n$$e v_{\\perp} B = \\frac{m_{e} v_{\\perp}^{2}}{\\rho_{e}}$$\nSolving for the Larmor radius $\\rho_{e}$:\n$$\\rho_{e} = \\frac{m_{e} v_{\\perp}}{e B}$$\nThis expression depends on the perpendicular speed $v_{\\perp}$ of an individual electron.\n\nThe problem specifies a Maxwellian plasma. For such a plasma in thermal equilibrium at a temperature $T_{e}$, the particles have a distribution of velocities. The parameter $b$ represents a thermal average. The definition is $b = k_{\\perp}^{2} \\langle \\rho_{e}^{2} \\rangle$, where $\\langle \\dots \\rangle$ denotes an average over the electron velocity distribution.\n$$b = k_{\\perp}^{2} \\left\\langle \\left( \\frac{m_{e} v_{\\perp}}{e B} \\right)^{2} \\right\\rangle = \\frac{k_{\\perp}^{2} m_{e}^{2}}{(e B)^{2}} \\langle v_{\\perp}^{2} \\rangle$$\nFor a Maxwellian distribution, the average kinetic energy is related to the temperature by the equipartition theorem. In the two dimensions of motion perpendicular to the magnetic field, the average kinetic energy is $\\langle \\frac{1}{2} m_{e} v_{\\perp}^{2} \\rangle = k_{B} T_{e}$, where $k_{B}$ is the Boltzmann constant. From this, we find the mean square perpendicular velocity:\n$$\\langle v_{\\perp}^{2} \\rangle = \\frac{2 k_{B} T_{e}}{m_{e}}$$\nNote that the problem states that the quantity $T_e$ when given in units of energy (like $\\mathrm{keV}$) already represents the thermal energy $k_B T_e$.\n\nSubstituting the expression for $\\langle v_{\\perp}^{2} \\rangle$ into the equation for $b$:\n$$b = \\frac{k_{\\perp}^{2} m_{e}^{2}}{(e B)^{2}} \\left( \\frac{2 k_{B} T_{e}}{m_{e}} \\right)$$\nSimplifying this expression gives the desired relationship for $b$:\n$$b = \\frac{2 m_{e} k_{\\perp}^{2} (k_{B} T_{e})}{e^{2} B^{2}}$$\nThis is the symbolic expression for $b$ in terms of the given parameters.\n\nNext, we evaluate this expression numerically using the provided values:\n- Perpendicular wavenumber, $k_{\\perp} = 200\\,\\mathrm{m}^{-1}$\n- Electron thermal energy, $k_{B} T_{e} = 2\\,\\mathrm{keV}$\n- Magnetic field strength, $B = 2\\,\\mathrm{T}$\n- Electron charge, $e = 1.602176634 \\times 10^{-19}\\,\\mathrm{C}$\n- Electron mass, $m_{e} = 9.1093837015 \\times 10^{-31}\\,\\mathrm{kg}$\n- Energy conversion, $1\\,\\mathrm{eV} = 1.602176634 \\times 10^{-19}\\,\\mathrm{J}$\n\nFirst, we convert the electron thermal energy from $\\mathrm{keV}$ to Joules:\n$$k_{B} T_{e} = 2\\,\\mathrm{keV} = 2 \\times 10^{3}\\,\\mathrm{eV} = 2 \\times 10^{3} \\times (1.602176634 \\times 10^{-19}\\,\\mathrm{J}) = 3.204353268 \\times 10^{-16}\\,\\mathrm{J}$$\n\nNow we substitute all values into the expression for $b$:\n$$b = \\frac{2 \\times (9.1093837015 \\times 10^{-31}\\,\\mathrm{kg}) \\times (200\\,\\mathrm{m}^{-1})^{2} \\times (3.204353268 \\times 10^{-16}\\,\\mathrm{J})}{(1.602176634 \\times 10^{-19}\\,\\mathrm{C})^{2} \\times (2\\,\\mathrm{T})^{2}}$$\n$$b = \\frac{2 \\times (9.1093837015 \\times 10^{-31}) \\times (4 \\times 10^{4}) \\times (3.204353268 \\times 10^{-16})}{(2.56696995 \\times 10^{-38}) \\times 4}$$\n$$b = \\frac{2.335191 \\times 10^{-41}}{1.026788 \\times 10^{-37}}$$\n$$b \\approx 2.2743 \\times 10^{-4}$$\nRounding to three significant figures, we get $b = 2.27 \\times 10^{-4}$.\n\nFinally, we must determine whether the small-$b$ or large-$b$ limit is appropriate. The parameter $b = k_{\\perp}^2 \\rho_e^2$ compares the square of the perpendicular wavelength ($ \\sim 1/k_{\\perp}^2$) to the square of the electron Larmor radius ($\\rho_e^2$).\n- The small-$b$ limit, $b \\ll 1$, corresponds to cases where the wavelength is much larger than the Larmor radius. In this limit, finite Larmor radius (FLR) effects are small corrections.\n- The large-$b$ limit, $b \\gg 1$, corresponds to cases where the wavelength is much smaller than the Larmor radius, and FLR effects dominate the wave dynamics.\n\nOur calculated value is $b \\approx 2.27 \\times 10^{-4}$. Since $b \\ll 1$, the small-$b$ limit is the appropriate regime for analyzing the dispersion of these Electron Bernstein waves under the given conditions.", "answer": "$$\\boxed{2.27 \\times 10^{-4}}$$", "id": "3697065"}, {"introduction": "A key advantage of EBWs is their ability to propagate in and heat \"overdense\" plasmas, where standard electromagnetic waves are cut off. However, since EBWs are electrostatic, they cannot be launched directly from a vacuum. A widely studied method to overcome this is the ordinary-extraordinary-Bernstein (O-X-B) mode conversion scheme. This practice guides you through the critical calculation to determine the optimal launch angle for the initial ordinary (O) wave to maximize its conversion efficiency to an extraordinary (X) wave, which then converts to the desired EBW. This derivation is a cornerstone of EBW heating theory, connecting the abstract cold-plasma dispersion relations to the practical design of fusion experiments [@problem_id:3697060].", "problem": "Consider a cold, magnetized, plane-stratified plasma intended for Electron Bernstein wave (EBW) heating and current drive via the ordinary-to-extraordinary-to-Bernstein (O-X-B) conversion scheme. A uniform background magnetic field is directed along the $z$ axis, $\\mathbf{B}_0 = B_0 \\hat{\\mathbf{z}}$, and the electron density increases linearly along the $x$ axis, $n_e(x) = n_{e0} + \\alpha x$, with $\\alpha > 0$. A monochromatic electromagnetic wave of angular frequency $\\omega$ is launched from vacuum on the low-density side and propagates in the $x$-$z$ plane toward increasing $x$. The vacuum launch angle (relative to $\\mathbf{B}_0$) is $\\theta$, so that the conserved parallel refractive index is $N_{\\parallel} = \\cos\\theta$ (using $N_{\\text{vac}} \\approx 1$). Assume a cold plasma with the standard Stix parameters\n$$\nP = 1 - X, \\quad R = 1 - \\frac{X}{1 + Y}, \\quad L = 1 - \\frac{X}{1 - Y}, \\quad S = \\frac{R + L}{2}, \\quad D = \\frac{R - L}{2},\n$$\nwhere $X(x) \\equiv \\omega_{pe}^2(x)/\\omega^2$ and $Y \\equiv \\omega_{ce}/\\omega$ are spatially varying and constant-in-space dimensionless parameters, respectively, with $\\omega_{pe}^2(x) = n_e(x) e^2/(\\epsilon_0 m_e)$ and $\\omega_{ce} = e B_0/m_e$. The wave frequency $\\omega$ and magnetic field $B_0$ are such that mode conversion from the ordinary (O) mode to the extraordinary (X) mode is possible before the upper-hybrid resonance is reached.\n\nStarting only from the cold plasma wave equation with the dielectric tensor characterized by $(P,S,D)$ and the plane-wave ansatz, and assuming propagation in the $x$-$z$ plane, do the following:\n\n1. Derive the local dispersion conditions governing the ordinary-like branch (the two-dimensional branch with electric field in the $x$-$z$ plane) and identify the $x$-locations (in terms of $X$) of its turning points (cutoffs/resonances) by imposing the condition $N_{x}^2 = 0$. Show that, at any fixed $X$ and $Y$, the turning points satisfy either $P=0$ (the O-mode cutoff) or an extraordinary-like condition that can be written as a quartic in $N_{\\parallel}$,\n$$\nN_{\\parallel}^4 - 2 S N_{\\parallel}^2 + R L = 0.\n$$\n\n2. In a linear density gradient, maximum O-to-X conversion (in the sense of vanishing evanescence gap between the O-mode cutoff and the slow X-mode turning point) occurs when these two turning points coincide at the same $x$. Enforce this coalescence at the O-mode cutoff by setting $X=1$ (so $P=0$) and evaluating $R$, $L$, and $S$ at $X=1$. Solve the resulting algebraic condition for the optimal conserved parallel refractive index $N_{\\parallel,\\mathrm{opt}}$ as a function of $Y$.\n\n3. Using Snellâ€™s law across the vacuum-plasma boundary and $N_{\\text{vac}} \\approx 1$, express the optimal vacuum launch angle $\\theta_{\\mathrm{opt}}$ in closed form as a function of $Y$. Provide your final answer as a single closed-form analytic expression for $\\theta_{\\mathrm{opt}}$ in radians. No numerical substitution is required. Round nothing; give an exact expression.", "solution": "The problem asks for the optimal launch angle for O-X-B mode conversion heating. The solution proceeds in three parts: deriving the general turning point conditions, finding the optimal parallel refractive index for mode conversion, and finally determining the corresponding vacuum launch angle.\n\n### Problem Validation\n**Step 1: Extract Givens**\n-   Plasma model: Cold, magnetized, plane-stratified.\n-   Magnetic field: $\\mathbf{B}_0 = B_0 \\hat{\\mathbf{z}}$ (uniform).\n-   Electron density: $n_e(x) = n_{e0} + \\alpha x$ with $\\alpha > 0$.\n-   Wave properties: Monochromatic, angular frequency $\\omega$, launched from vacuum in the $x$-$z$ plane.\n-   Vacuum launch angle: $\\theta$ relative to $\\mathbf{B}_0$.\n-   Conserved parallel refractive index: $N_{\\parallel} = \\cos\\theta$ (assuming $N_{\\text{vac}} \\approx 1$).\n-   Stix parameters: $P = 1 - X$, $R = 1 - \\frac{X}{1 + Y}$, $L = 1 - \\frac{X}{1 - Y}$, $S = \\frac{R + L}{2}$, $D = \\frac{R - L}{2}$.\n-   Dimensionless parameters: $X(x) \\equiv \\omega_{pe}^2(x)/\\omega^2$ (spatially varying), $Y \\equiv \\omega_{ce}/\\omega$ (constant).\n-   Condition: O-to-X conversion occurs before the upper-hybrid resonance.\n-   Task 1: Derive turning point ($N_x^2=0$) conditions from the cold plasma wave equation.\n-   Task 2: Find optimal $N_{\\parallel, \\mathrm{opt}}$ by making the O-mode cutoff and the \"slow X-mode turning point\" coincide at $X=1$.\n-   Task 3: Find the corresponding optimal launch angle $\\theta_{\\mathrm{opt}}$.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is well-defined within the standard framework of cold plasma wave theory. The physics of O-X-B mode conversion is a well-established topic in nuclear fusion research. The model, variables, and parameters are all standard. The tasks are logically sequential and build upon fundamental principles. There is one point of ambiguity in the phrasing of Task 2 (\"slow X-mode turning point\"), but this appears to be a common imprecision in problem statements on this topic, where the physically intended meaning can be deduced from established theory. The problem is scientifically grounded, objective, and well-posed, contingent on resolving this minor ambiguity through physical reasoning.\n\n**Step 3: Verdict and Action**\nThe problem is deemed valid. A complete solution will be provided.\n\n### Solution\n\n**Part 1: Derivation of Turning Point Conditions**\n\nWe begin with the cold plasma wave equation, $\\mathbf{N} \\times (\\mathbf{N} \\times \\mathbf{E}) + \\boldsymbol{\\epsilon} \\cdot \\mathbf{E} = 0$, where $\\mathbf{N} = \\mathbf{k} c / \\omega$ is the refractive index vector and $\\boldsymbol{\\epsilon}$ is the dielectric tensor. For a cold plasma with $\\mathbf{B}_0 = B_0 \\hat{\\mathbf{z}}$, the dielectric tensor is given by:\n$$\n\\boldsymbol{\\epsilon} = \\begin{pmatrix} S & -iD & 0 \\\\ iD & S & 0 \\\\ 0 & 0 & P \\end{pmatrix}\n$$\nThe wave propagates in the $x$-$z$ plane, so the refractive index vector is $\\mathbf{N} = N_x \\hat{\\mathbf{x}} + N_z \\hat{\\mathbf{z}}$. Due to translational invariance along $z$, the parallel component $N_z = N_\\parallel$ is conserved. The wave equation can be written in matrix form:\n$$\n\\begin{pmatrix} S - N_\\parallel^2 & -iD & N_x N_\\parallel \\\\ iD & S - N_x^2 - N_\\parallel^2 & 0 \\\\ N_x N_\\parallel & 0 & P - N_x^2 \\end{pmatrix}\n\\begin{pmatrix} E_x \\\\ E_y \\\\ E_z \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\nFor a non-trivial solution for the electric field $\\mathbf{E}$, the determinant of the matrix must be zero. This condition yields the local dispersion relation:\n$$\n\\det \\begin{pmatrix} S - N_\\parallel^2 & -iD & N_x N_\\parallel \\\\ iD & S - N_x^2 - N_\\parallel^2 & 0 \\\\ N_x N_\\parallel & 0 & P - N_x^2 \\end{pmatrix} = 0\n$$\nExpanding the determinant, we get:\n$$\n(P - N_x^2) [(S - N_\\parallel^2)(S - N_x^2 - N_\\parallel^2) - D^2] - N_x N_\\parallel [(-N_x N_\\parallel)(S - N_x^2 - N_\\parallel^2)] = 0\n$$\n$$\n(P - N_x^2) [(S - N_\\parallel^2)(S - N_x^2 - N_\\parallel^2) - D^2] + N_x^2 N_\\parallel^2 (S - N_x^2 - N_\\parallel^2) = 0\n$$\nA turning point (cutoff or resonance) is a location where the nature of the wave propagation changes. The problem specifically defines turning points as locations where $N_x^2 = 0$. By setting $N_x^2 = 0$ in the dispersion relation, we find the conditions on the plasma parameters $(X, Y)$ and the conserved parameter $N_\\parallel$ at these points:\n$$\n(P - 0) [(S - N_\\parallel^2)(S - 0 - N_\\parallel^2) - D^2] + 0 = 0\n$$\n$$\nP [(S - N_\\parallel^2)^2 - D^2] = 0\n$$\nThis equation is satisfied if either of the two factors is zero:\n1.  $P = 0$. This is the definition of the ordinary (O-mode) cutoff, which occurs at the plasma density where $X=1$.\n2.  $(S - N_\\parallel^2)^2 - D^2 = 0$. This corresponds to the extraordinary (X-mode) cutoffs. We can rewrite this as $(S - N_\\parallel^2) = \\pm D$, which gives two conditions:\n    -   $S + D = N_\\parallel^2 \\implies R = N_\\parallel^2$ (the R-cutoff or fast X-mode cutoff).\n    -   $S - D = N_\\parallel^2 \\implies L = N_\\parallel^2$ (the L-cutoff or slow X-mode cutoff).\n\nTo show that these extraordinary-like conditions can be written as the specified quartic, we combine them:\n$$\n(N_\\parallel^2 - R)(N_\\parallel^2 - L) = 0\n$$\nExpanding this expression gives:\n$$\nN_\\parallel^4 - (R+L)N_\\parallel^2 + RL = 0\n$$\nUsing the definition $S = (R+L)/2$, we have $R+L=2S$. Substituting this gives the desired form:\n$$\nN_\\parallel^4 - 2S N_\\parallel^2 + RL = 0\n$$\nThus, the turning points where $N_x^2 = 0$ are located at positions $x$ that satisfy either $P(x)=0$ or the condition $N_\\parallel^4 - 2S(x) N_\\parallel^2 + R(x)L(x) = 0$.\n\n**Part 2: Optimal Parallel Refractive Index**\n\nMaximum O-to-X conversion efficiency is achieved when the evanescent barrier between the O-mode and the slow X-mode vanishes. The problem states this occurs when their respective turning points coincide. The O-mode turning point (cutoff) is at $X=1$ (since $P=1-X=0$). We must enforce that an X-mode turning point also occurs at this same location.\n\nThe X-mode turning point conditions are $N_\\parallel^2 = R(x)$ and $N_\\parallel^2 = L(x)$. The problem specifies coalescence with the \"slow X-mode turning point\", which is the L-cutoff, $N_\\parallel^2=L(x)$. Evaluating this at $X=1$:\n$$\nN_\\parallel^2 = L(X=1) = 1 - \\frac{1}{1-Y} = \\frac{1-Y-1}{1-Y} = \\frac{-Y}{1-Y} = \\frac{Y}{Y-1}\n$$\nFor typical EBW heating schemes, the wave frequency is above the cyclotron frequency, so $Y = \\omega_{ce}/\\omega < 1$. In this case, $Y-1 < 0$, which implies $N_\\parallel^2 < 0$. An imaginary $N_\\parallel$ corresponds to an evanescent wave in vacuum, which cannot be launched. If $Y>1$, then $Y/(Y-1) > 1$, which requires $|N_\\parallel| > 1$. This also corresponds to an evanescent wave in vacuum. Hence, a literal interpretation of \"slow X-mode turning point\" leads to an unphysical condition.\n\nThis ambiguity is common. In the established theory of O-X conversion, the optimal condition for creating a \"window\" for the O-wave to access the slow X-wave branch is the coalescence of the O-mode cutoff ($P=0$) and the fast X-mode cutoff ($R=N_\\parallel^2$). We will proceed with this physically correct interpretation.\n\nThe condition is that at the location where $X=1$, the R-cutoff condition is also met. We set $N_{\\parallel, \\text{opt}}$ to satisfy this:\n$$\nN_{\\parallel, \\mathrm{opt}}^2 = R(X=1)\n$$\nWe evaluate $R$ at $X=1$:\n$$\nR(X=1) = 1 - \\frac{X}{1+Y} \\bigg|_{X=1} = 1 - \\frac{1}{1+Y}\n$$\nSimplifying this expression gives the optimal parallel refractive index squared:\n$$\nN_{\\parallel, \\mathrm{opt}}^2 = \\frac{(1+Y) - 1}{1+Y} = \\frac{Y}{1+Y}\n$$\nFor any $Y>0$, this value of $N_{\\parallel, \\mathrm{opt}}^2$ is between $0$ and $1$, corresponding to a real launch angle and a propagating wave in vacuum.\n\n**Part 3: Optimal Vacuum Launch Angle**\n\nThe link between the parallel refractive index $N_\\parallel$ and the vacuum launch angle $\\theta$ is given by Snell's law applied at the vacuum-plasma boundary. As stated in the problem, for propagation in the $x$-$z$ plane, the conserved parallel refractive index is $N_\\parallel = N_{\\text{vac}} \\cos\\theta$. With the given approximation $N_{\\text{vac}} \\approx 1$, we have $N_\\parallel = \\cos\\theta$.\n\nUsing the optimal value $N_{\\parallel, \\mathrm{opt}}$ derived in Part 2, we can find the optimal launch angle $\\theta_{\\mathrm{opt}}$:\n$$\n\\cos^2\\theta_{\\mathrm{opt}} = N_{\\parallel, \\mathrm{opt}}^2 = \\frac{Y}{1+Y}\n$$\nSince the launch angle $\\theta$ is typically defined in the range $[0, \\pi/2]$, we take the positive square root:\n$$\n\\cos\\theta_{\\mathrm{opt}} = \\sqrt{\\frac{Y}{1+Y}}\n$$\nSolving for $\\theta_{\\mathrm{opt}}$ in radians gives the final expression:\n$$\n\\theta_{\\mathrm{opt}} = \\arccos\\left(\\sqrt{\\frac{Y}{1+Y}}\\right)\n$$\nThis is the closed-form analytic expression for the optimal vacuum launch angle.", "answer": "$$\\boxed{\\arccos\\left(\\sqrt{\\frac{Y}{1+Y}}\\right)}$$", "id": "3697060"}, {"introduction": "After successfully launching an EBW, predicting its path and where it deposits its energy is crucial for any heating or current drive application. In the complex, inhomogeneous environment of a fusion plasma with gradients and magnetic shear, the wave's trajectory can become intricate, forming focusing points known as caustics. This advanced computational practice challenges you to develop a ray-tracing code based on Hamiltonian optics to model EBW propagation. By deriving the ray equations from the anisotropic EBW dispersion relation and implementing them numerically, you will gain firsthand insight into how plasma structure sculpts the wave's path, a skill that bridges theoretical plasma physics with modern computational modeling [@problem_id:3697012].", "problem": "You are asked to build, from first principles, a numerical investigation of Electron Bernstein Waves (EBWs) propagating in a two-dimensional, inhomogeneous, magnetized plasma with magnetic shear, and to relate the emergence of caustics and wavefront folding to local anisotropy of the EBW dispersion. The program you produce must implement the ray dynamics implied by the Hamiltonian structure of wave packet optics in stationary media and must detect caustics by the singularity of the wavefront mapping from launch parameters to spatial positions.\n\nThe physical setup is as follows. Consider an electrostatic EBW in a plasma whose properties vary only along the spatial coordinate $y$, with spatial coordinates $(x,y)$. The magnetic field has fixed magnitude and a $y$-dependent direction, and the electron density has a $y$-dependent profile. The wave frequency is constant in time. All quantities are to be treated as functions of $y$ only when they depend on space. You must use the following context, definitions, and parameters, but derive the governing equations from fundamental bases.\n\nContext and definitions to use:\n- Electron Bernstein Wave (EBW) is an electrostatic electron-mode in a magnetized plasma that is strongly dispersive in the direction perpendicular to the magnetic field and weakly dispersive along the field.\n- Use Hamiltonian ray theory for a stationary medium: the ray equations for a wave packet with Hamiltonian $H(\\mathbf{k},\\mathbf{x})$ are\n  $$\\frac{d\\mathbf{x}}{dt} = \\nabla_{\\mathbf{k}} H(\\mathbf{k},\\mathbf{x}), \\quad \\frac{d\\mathbf{k}}{dt} = -\\nabla_{\\mathbf{x}} H(\\mathbf{k},\\mathbf{x}),$$\n  where $\\mathbf{x}=(x,y)$ is position, $\\mathbf{k}=(k_x,k_y)$ is the wave vector, and $t$ is a ray parameter with units of seconds.\n- Model the EBW dispersion locally as a strongly anisotropic function of the wavenumber components relative to the magnetic field direction $\\hat{\\mathbf{b}}(y)$, with a dominant perpendicular quadratic contribution and a weak parallel quadratic contribution around the upper-hybrid frequency. The anisotropy is quantified by speeds $v_\\perp$ and $v_\\parallel$, with $v_\\parallel \\ll v_\\perp$, and the upper-hybrid frequency is $\\omega_{UH}(y)$.\n- The magnetic field unit vector has $y$-dependent direction due to shear:\n  $$\\hat{\\mathbf{b}}(y) = \\left(\\cos \\theta(y), \\sin \\theta(y)\\right), \\quad \\theta(y) = \\theta_0 + s\\,y,$$\n  where $\\theta_0$ is an initial angle and $s$ is the shear rate (in radians per meter).\n- The electron density profile is exponential with scale length $L_n$:\n  $$n_e(y) = n_0 \\,\\exp\\!\\left(\\frac{y}{L_n}\\right).$$\n- The electron plasma frequency is\n  $$\\omega_{pe}(y) = \\sqrt{\\frac{n_e(y)\\,e^2}{m_e \\,\\varepsilon_0}},$$\n  where $e$ is the elementary charge, $m_e$ is the electron mass, and $\\varepsilon_0$ is the vacuum permittivity.\n- The electron cyclotron frequency is\n  $$\\omega_{ce} = \\frac{e\\,B_0}{m_e},$$\n  with $B_0$ the magnetic field magnitude.\n- The upper-hybrid frequency is\n  $$\\omega_{UH}(y) = \\sqrt{\\omega_{pe}(y)^2 + \\omega_{ce}^2}.$$\n- The decomposition of the wave vector into components parallel and perpendicular to the local magnetic field uses\n  $$k_\\parallel(y) = \\mathbf{k}\\cdot \\hat{\\mathbf{b}}(y), \\quad k_\\perp^2(y) = \\mathbf{k}\\cdot \\mathbf{k} - k_\\parallel(y)^2.$$\n\nTasks:\n- Starting from Hamiltonian ray theory and the local anisotropic EBW dispersion model as stated qualitatively above, derive explicit expressions for the ray equations in terms of $(x,y)$, $(k_x,k_y)$, the anisotropy parameters $v_\\perp$, $v_\\parallel$, and the spatial dependence entering through $\\hat{\\mathbf{b}}(y)$ and $\\omega_{UH}(y)$. Your derivation must start from the stated laws and definitions; you must not assume or copy any pre-simplified \"shortcut\" formula, but rather construct the needed expressions by applying vector calculus to the anisotropic dispersion and the given spatial dependences.\n- Implement a numerical ray tracer for a one-parameter family of rays launched from the same point with slightly different initial wave-vector angles. Use the Jacobian-based diagnostic of wavefront folding: for rays parameterized by the initial launch angle $\\alpha_0$, define the mapping $\\alpha_0 \\mapsto \\mathbf{x}(t;\\alpha_0)$ at fixed $t$, and detect a caustic when the norm of $\\partial \\mathbf{x}/\\partial \\alpha_0$ drops to a small fraction of its initial value, indicating the formation of a singular envelope and wavefront folding. Use a finite-difference approximation for $\\partial \\mathbf{x}/\\partial \\alpha_0$ computed from two nearby rays.\n- For a fixed frequency $\\omega_0$, compute the initial wave-number magnitude by imposing that the local dispersion at the launch point equals $\\omega_0$ for the chosen initial direction relative to $\\hat{\\mathbf{b}}(y_0)$. Then integrate the ray equations for three different test cases, and record the $y$-coordinate (in meters) of the first detected caustic along the central ray in the bundle. If no caustic is detected within the domain, output $-1.0$ for that case.\n\nPhysical and numerical units:\n- All angles must be in radians.\n- All frequencies must be in $\\mathrm{rad/s}$.\n- All distances must be in meters.\n- All speeds must be in $\\mathrm{m/s}$.\n- Express the final $y$-coordinate results in meters, rounded to three significant figures.\n\nTest suite:\nUse the following three parameter sets (each set defines one independent test case):\n- Test case $1$ (baseline, no shear):\n  - $B_0 = 2.0\\,\\mathrm{T}$,\n  - $n_0 = 1.0\\times 10^{19}\\,\\mathrm{m^{-3}}$,\n  - $L_n = 0.05\\,\\mathrm{m}$,\n  - $s = 0.0\\,\\mathrm{rad/m}$,\n  - $v_\\perp = 3.0\\times 10^{6}\\,\\mathrm{m/s}$,\n  - anisotropy ratio $r = v_\\parallel/v_\\perp = 0.10$,\n  - $\\omega_0 = 4.30\\times 10^{11}\\,\\mathrm{rad/s}$,\n  - $\\theta_0 = 0.0\\,\\mathrm{rad}$,\n  - launch point $y_0 = -0.01\\,\\mathrm{m}$,\n  - initial central angle $\\alpha_0 = \\theta_0 + \\pi/3$,\n  - small angle offset for the bundle $\\Delta \\alpha = 0.01\\,\\mathrm{rad}$,\n  - integration time window $T = 1.0\\times 10^{-7}\\,\\mathrm{s}$,\n  - spatial domain in $y$: $[-0.05\\,\\mathrm{m},\\,0.05\\,\\mathrm{m}]$.\n- Test case $2$ (moderate shear and stronger anisotropy):\n  - $B_0 = 2.0\\,\\mathrm{T}$,\n  - $n_0 = 1.0\\times 10^{19}\\,\\mathrm{m^{-3}}$,\n  - $L_n = 0.05\\,\\mathrm{m}$,\n  - $s = 30.0\\,\\mathrm{rad/m}$,\n  - $v_\\perp = 3.0\\times 10^{6}\\,\\mathrm{m/s}$,\n  - $r = 0.08$,\n  - $\\omega_0 = 4.30\\times 10^{11}\\,\\mathrm{rad/s}$,\n  - $\\theta_0 = 0.0\\,\\mathrm{rad}$,\n  - $y_0 = -0.01\\,\\mathrm{m}$,\n  - $\\alpha_0 = \\theta_0 + \\pi/3$,\n  - $\\Delta \\alpha = 0.01\\,\\mathrm{rad}$,\n  - $T = 1.0\\times 10^{-7}\\,\\mathrm{s}$,\n  - $y$ domain: $[-0.05\\,\\mathrm{m},\\,0.05\\,\\mathrm{m}]$.\n- Test case $3$ (strong shear and very strong anisotropy):\n  - $B_0 = 2.0\\,\\mathrm{T}$,\n  - $n_0 = 1.0\\times 10^{19}\\,\\mathrm{m^{-3}}$,\n  - $L_n = 0.05\\,\\mathrm{m}$,\n  - $s = 100.0\\,\\mathrm{rad/m}$,\n  - $v_\\perp = 3.0\\times 10^{6}\\,\\mathrm{m/s}$,\n  - $r = 0.03$,\n  - $\\omega_0 = 4.30\\times 10^{11}\\,\\mathrm{rad/s}$,\n  - $\\theta_0 = 0.0\\,\\mathrm{rad}$,\n  - $y_0 = -0.01\\,\\mathrm{m}$,\n  - $\\alpha_0 = \\theta_0 + \\pi/3$,\n  - $\\Delta \\alpha = 0.01\\,\\mathrm{rad}$,\n  - $T = 1.0\\times 10^{-7}\\,\\mathrm{s}$,\n  - $y$ domain: $[-0.05\\,\\mathrm{m},\\,0.05\\,\\mathrm{m}]$.\n\nAlgorithmic requirements:\n- Initialize the central ray and two perturbed rays with initial angles $\\alpha_0 - \\Delta \\alpha$ and $\\alpha_0 + \\Delta \\alpha$. Compute the initial wavenumber magnitude by enforcing $\\omega(\\mathbf{k},y_0) = \\omega_0$ for each initial angle and the given anisotropy parameters, and set the initial position $(x,y)$ identical for all rays while setting $(k_x,k_y)$ according to each launch angle.\n- Integrate the ray equations over the time window or until the ray exits the $y$-domain. At each time step, approximate $\\partial \\mathbf{x}/\\partial \\alpha_0$ by centered finite differences using the two perturbed rays. Detect a caustic when the norm of this derivative drops below a prescribed fraction (e.g., $5.0\\times 10^{-3}$) of its value at the first time step. Record the $y$-coordinate of the central ray at the first detection. If the detection threshold is never met, return $-1.0$.\n- Your program should produce a single line of output containing the $y$-coordinates (in meters, rounded to three significant figures) for the three test cases, as a comma-separated list enclosed in square brackets, for example: $[y_1,y_2,y_3]$.\n\nYour derivation and implementation must be scientifically self-consistent and must not rely on any external data. All constants needed (such as $e$, $m_e$, $\\varepsilon_0$) must be defined in the program. The final numerical answers must be floats that satisfy the unit and formatting requirements stated above.", "solution": "We begin with the Hamiltonian structure for rays in stationary media. For a wave with Hamiltonian $H(\\mathbf{k},\\mathbf{x}) = \\omega(\\mathbf{k},\\mathbf{x})$ (the angular frequency), the ray equations are\n$$\\frac{d\\mathbf{x}}{dt} = \\nabla_{\\mathbf{k}} \\omega(\\mathbf{k},\\mathbf{x}), \\quad \\frac{d\\mathbf{k}}{dt} = -\\nabla_{\\mathbf{x}} \\omega(\\mathbf{k},\\mathbf{x}).$$\nFor a stationary medium, $\\partial \\omega/\\partial t = 0$, and one has $d\\omega/dt = 0$, hence $\\omega$ is conserved along the ray.\n\nElectron Bernstein Waves (EBWs) are electrostatic waves with strong perpendicular dispersion relative to the magnetic field and weak parallel dispersion. In a local, reduced model near the upper-hybrid frequency, we approximate the dispersion as an anisotropic quadratic in the wavenumber relative to the magnetic field direction:\n$$\\omega(\\mathbf{k},y) = \\sqrt{\\omega_{UH}(y)^2 + v_\\perp^2\\,k_\\perp(y)^2 + v_\\parallel^2\\,k_\\parallel(y)^2},$$\nwith $v_\\parallel \\ll v_\\perp$. Here $\\omega_{UH}(y)$ is the upper-hybrid frequency, $k_\\parallel(y) = \\mathbf{k}\\cdot \\hat{\\mathbf{b}}(y)$ and $k_\\perp(y)^2 = \\mathbf{k}\\cdot \\mathbf{k} - k_\\parallel(y)^2$, with $\\hat{\\mathbf{b}}(y) = (\\cos\\theta(y),\\sin\\theta(y))$ and $\\theta(y) = \\theta_0 + s y$ defining the magnetic shear. The electron density is $n_e(y) = n_0 \\exp(y/L_n)$, which yields\n$$\\omega_{pe}(y) = \\sqrt{\\frac{n_e(y) e^2}{m_e \\varepsilon_0}} = \\sqrt{\\frac{n_0 e^2}{m_e \\varepsilon_0}} \\exp\\!\\left(\\frac{y}{2 L_n}\\right), \\quad \\omega_{ce} = \\frac{e B_0}{m_e}, \\quad \\omega_{UH}(y) = \\sqrt{\\omega_{pe}(y)^2 + \\omega_{ce}^2}.$$\n\nWe now derive the ray equations explicitly. Let $\\mathbf{k}=(k_x,k_y)$ and write the parallel and perpendicular components using $\\hat{\\mathbf{b}}(y)$ and its unit perpendicular $\\hat{\\mathbf{b}}_\\perp(y) = (-\\sin\\theta(y),\\cos\\theta(y))$. We have\n$$k_\\parallel(y) = \\mathbf{k}\\cdot \\hat{\\mathbf{b}}(y), \\quad k_\\perp^2(y) = \\mathbf{k}\\cdot \\mathbf{k} - k_\\parallel(y)^2, \\quad k_{\\perp,\\mathrm{signed}}(y) = \\mathbf{k}\\cdot \\hat{\\mathbf{b}}_\\perp(y).$$\nNote that $k_\\perp^2(y) = k_{\\perp,\\mathrm{signed}}(y)^2$ because $\\hat{\\mathbf{b}}$ and $\\hat{\\mathbf{b}}_\\perp$ are orthonormal.\n\nDefine\n$$A(\\mathbf{k},y) \\equiv \\omega_{UH}(y)^2 + v_\\perp^2\\,k_\\perp(y)^2 + v_\\parallel^2\\,k_\\parallel(y)^2,\\quad \\omega(\\mathbf{k},y) = \\sqrt{A(\\mathbf{k},y)}.$$\nThen the group velocity is\n$$\\nabla_{\\mathbf{k}} \\omega = \\frac{1}{2\\omega}\\,\\nabla_{\\mathbf{k}} A.$$\nCompute $\\nabla_{\\mathbf{k}} A$ noting that $\\nabla_{\\mathbf{k}}(\\mathbf{k}\\cdot \\mathbf{k}) = 2\\mathbf{k}$ and $\\nabla_{\\mathbf{k}}(k_\\parallel(y)^2) = 2 k_\\parallel(y)\\,\\hat{\\mathbf{b}}(y)$:\n\\begin{align*}\n\\nabla_{\\mathbf{k}} k_\\perp^2(y) &= \\nabla_{\\mathbf{k}}\\left(\\mathbf{k}\\cdot \\mathbf{k} - k_\\parallel(y)^2\\right) = 2\\mathbf{k} - 2 k_\\parallel(y)\\,\\hat{\\mathbf{b}}(y),\\\\\n\\nabla_{\\mathbf{k}} k_\\parallel^2(y) &= 2 k_\\parallel(y)\\,\\hat{\\mathbf{b}}(y).\n\\end{align*}\nTherefore,\n\\begin{align*}\n\\nabla_{\\mathbf{k}} A &= v_\\perp^2 \\left(2\\mathbf{k} - 2 k_\\parallel \\hat{\\mathbf{b}}\\right) + v_\\parallel^2 \\left(2 k_\\parallel \\hat{\\mathbf{b}}\\right)\\\\\n&= 2\\left[ v_\\perp^2 \\mathbf{k} + (v_\\parallel^2 - v_\\perp^2)\\,k_\\parallel \\hat{\\mathbf{b}} \\right].\n\\end{align*}\nConsequently, the group velocity components are\n$$\\frac{d\\mathbf{x}}{dt} = \\frac{1}{\\omega}\\left[ v_\\perp^2 \\mathbf{k} + (v_\\parallel^2 - v_\\perp^2)\\,k_\\parallel \\hat{\\mathbf{b}}(y) \\right],$$\ni.e.,\n\\begin{align*}\n\\frac{dx}{dt} &= \\frac{1}{\\omega}\\left[ v_\\perp^2 k_x + (v_\\parallel^2 - v_\\perp^2)\\,k_\\parallel\\,\\cos\\theta(y) \\right],\\\\\n\\frac{dy}{dt} &= \\frac{1}{\\omega}\\left[ v_\\perp^2 k_y + (v_\\parallel^2 - v_\\perp^2)\\,k_\\parallel\\,\\sin\\theta(y) \\right].\n\\end{align*}\n\nNext, we compute $-\\nabla_{\\mathbf{x}} \\omega$. Because all spatial dependence is through $y$ (there is no $x$-dependence), $\\partial \\omega/\\partial x = 0$ and hence\n$$\\frac{dk_x}{dt} = -\\frac{\\partial \\omega}{\\partial x} = 0.$$\nTo obtain $\\frac{dk_y}{dt} = -\\frac{\\partial \\omega}{\\partial y}$ we compute\n$$\\frac{\\partial \\omega}{\\partial y} = \\frac{1}{2\\omega}\\,\\frac{\\partial A}{\\partial y}.$$\nThe $y$-dependence enters through $\\omega_{UH}(y)$ and through $\\hat{\\mathbf{b}}(y)$, which affects $k_\\parallel(y)$ and $k_\\perp(y)^2$. We have\n$$\\frac{d\\theta}{dy} = s,\\quad \\frac{d\\hat{\\mathbf{b}}}{dy} = s\\,\\hat{\\mathbf{b}}_\\perp(y),\\quad \\frac{d\\hat{\\mathbf{b}}_\\perp}{dy} = -s\\,\\hat{\\mathbf{b}}(y).$$\nUsing $k_\\parallel(y) = \\mathbf{k}\\cdot \\hat{\\mathbf{b}}(y)$ (with $\\mathbf{k}$ treated as constant when taking the partial derivative with respect to $y$), we obtain\n$$\\frac{\\partial k_\\parallel}{\\partial y} = \\mathbf{k}\\cdot \\frac{\\partial \\hat{\\mathbf{b}}}{\\partial y} = s\\,\\mathbf{k}\\cdot \\hat{\\mathbf{b}}_\\perp(y) = s\\,k_{\\perp,\\mathrm{signed}}(y).$$\nThen\n\\begin{align*}\n\\frac{\\partial k_\\parallel^2}{\\partial y} &= 2 k_\\parallel \\frac{\\partial k_\\parallel}{\\partial y} = 2 s\\,k_\\parallel\\,k_{\\perp,\\mathrm{signed}},\\\\\n\\frac{\\partial k_\\perp^2}{\\partial y} &= - \\frac{\\partial k_\\parallel^2}{\\partial y} = -2 s\\,k_\\parallel\\,k_{\\perp,\\mathrm{signed}}.\n\\end{align*}\nFor the upper-hybrid frequency,\n$$\\omega_{pe}(y) = \\omega_{pe0}\\,\\exp\\!\\left(\\frac{y}{2L_n}\\right), \\quad \\omega_{pe0} = \\sqrt{\\frac{n_0 e^2}{m_e \\varepsilon_0}},$$\nso\n$$\\frac{\\partial \\omega_{pe}}{\\partial y} = \\frac{\\omega_{pe}(y)}{2L_n}, \\quad \\frac{\\partial \\omega_{UH}}{\\partial y} = \\frac{\\omega_{pe}(y)}{\\omega_{UH}(y)}\\,\\frac{\\partial \\omega_{pe}}{\\partial y} = \\frac{\\omega_{pe}(y)^2}{2L_n\\,\\omega_{UH}(y)}.$$\nHence\n\\begin{align*}\n\\frac{\\partial A}{\\partial y} &= 2\\omega_{UH}\\,\\frac{\\partial \\omega_{UH}}{\\partial y} + v_\\perp^2\\,\\frac{\\partial k_\\perp^2}{\\partial y} + v_\\parallel^2\\,\\frac{\\partial k_\\parallel^2}{\\partial y}\\\\\n&= 2\\omega_{UH}\\,\\frac{\\omega_{pe}^2}{2L_n\\,\\omega_{UH}} + (v_\\parallel^2 - v_\\perp^2)\\,2 s\\,k_\\parallel\\,k_{\\perp,\\mathrm{signed}}\\\\\n&= \\frac{\\omega_{pe}(y)^2}{L_n} + 2 (v_\\parallel^2 - v_\\perp^2)\\, s\\,k_\\parallel\\,k_{\\perp,\\mathrm{signed}}.\n\\end{align*}\nTherefore,\n$$\\frac{\\partial \\omega}{\\partial y} = \\frac{1}{2\\omega}\\left[ \\frac{\\omega_{pe}(y)^2}{L_n} + 2 (v_\\parallel^2 - v_\\perp^2)\\, s\\,k_\\parallel\\,k_{\\perp,\\mathrm{signed}} \\right],$$\nand the wavevector evolution is\n\\begin{align*}\n\\frac{dk_x}{dt} &= 0,\\\\\n\\frac{dk_y}{dt} &= -\\frac{1}{2\\omega}\\left[ \\frac{\\omega_{pe}(y)^2}{L_n} + 2 (v_\\parallel^2 - v_\\perp^2)\\, s\\,k_\\parallel\\,k_{\\perp,\\mathrm{signed}} \\right].\n\\end{align*}\nThis explicitly expresses the coupling introduced by magnetic shear (through $s$ and the dependence of $\\hat{\\mathbf{b}}$ on $y$) and the anisotropy (through $v_\\perp$ and $v_\\parallel$), highlighting how local dispersion anisotropy interacts with shear to focus rays and produce caustics.\n\nInitial conditions and frequency constraint:\nFor a fixed launch frequency $\\omega_0$, at the launch point $y_0$ and a chosen initial angle $\\alpha_0$ for $\\mathbf{k}$ relative to the $x$-axis, we set\n$$\\mathbf{k}_0 = k_0(\\cos\\alpha_0,\\,\\sin\\alpha_0),$$\nwith $k_0$ determined by enforcing the dispersion at $y_0$:\n\\begin{align*}\n\\omega_0^2 &= \\omega_{UH}(y_0)^2 + v_\\perp^2\\,k_{\\perp,0}^2 + v_\\parallel^2\\,k_{\\parallel,0}^2,\\\\\nk_{\\parallel,0} &= k_0\\,\\cos\\!\\left(\\alpha_0 - \\theta(y_0)\\right), \\quad k_{\\perp,0}^2 = k_0^2 - k_{\\parallel,0}^2 = k_0^2\\,\\sin^2\\!\\left(\\alpha_0 - \\theta(y_0)\\right).\n\\end{align*}\nSolving for $k_0^2$,\n$$k_0^2 = \\frac{\\omega_0^2 - \\omega_{UH}(y_0)^2}{v_\\perp^2 \\sin^2(\\Delta_0) + v_\\parallel^2 \\cos^2(\\Delta_0)},\\quad \\Delta_0 \\equiv \\alpha_0 - \\theta(y_0),$$\nwhich requires $\\omega_0^2 > \\omega_{UH}(y_0)^2$ for a real launch.\n\nCaustic detection and wavefront folding:\nWe launch a small bundle of rays with initial angles $\\alpha_0 - \\Delta\\alpha$, $\\alpha_0$, and $\\alpha_0 + \\Delta\\alpha$, sharing the same initial position $(x_0,y_0)$ and frequency $\\omega_0$. Let $\\mathbf{x}_-(t)$, $\\mathbf{x}_0(t)$, and $\\mathbf{x}_+(t)$ denote their positions. A caustic is detected when the norm of the finite-difference approximation to the Jacobian of the mapping $\\alpha_0 \\mapsto \\mathbf{x}(t;\\alpha_0)$,\n$$J(t) = \\left\\|\\frac{\\mathbf{x}_+(t) - \\mathbf{x}_-(t)}{2\\Delta\\alpha}\\right\\|,$$\ndrops below a small fraction of its early-time value (we use the first nonzero time step as the reference to avoid the trivial zero at $t=0$). Physically, $J(t)\\to 0$ indicates that neighboring rays fold onto the same location, producing the singular envelope characteristic of a caustic. We record the $y$-coordinate of $\\mathbf{x}_0$ at the first time $t$ where $J(t)$ is below the threshold; if no such time occurs within the integration window or before exiting the spatial domain, we report $-1.0$.\n\nAlgorithmic implementation:\n- Define constants $e$, $m_e$, $\\varepsilon_0$.\n- For each test case, define $B_0$, $n_0$, $L_n$, $s$, $v_\\perp$, $r = v_\\parallel/v_\\perp$, hence $v_\\parallel = r\\,v_\\perp$, $\\omega_0$, $\\theta_0$, $y_0$, $\\alpha_0$, $\\Delta\\alpha$, $T$, and the $y$-domain.\n- Compute $\\omega_{ce}$, $\\omega_{pe}(y)$, and $\\omega_{UH}(y)$. Solve for $k_0$ for each angle in the bundle using the dispersion constraint at $y_0$.\n- Integrate the ray equations using a robust ordinary differential equation solver over $[0,T]$ or until leaving the $y$-domain. At each step, compute $J(t)$, compare with the threshold fraction (e.g., $5.0\\times 10^{-3}$) of $J$ at the first nonzero step, and record the first $y$ satisfying the criterion.\n- Return a list of three floats $[y_1,y_2,y_3]$ (in meters) rounded to three significant figures for the three test cases.\n\nRelation to local dispersion anisotropy:\nThe group velocity depends on $v_\\perp^2 \\mathbf{k}$ plus a correction proportional to $(v_\\parallel^2 - v_\\perp^2)\\,k_\\parallel \\hat{\\mathbf{b}}$, so strong anisotropy ($v_\\parallel \\ll v_\\perp$) tends to confine energy flow perpendicular to the local field. Magnetic shear rotates $\\hat{\\mathbf{b}}(y)$ across $y$, changing the decomposition of $\\mathbf{k}$ and modulating the group velocity field as rays propagate through regions of different $\\theta(y)$ and $\\omega_{UH}(y)$. This coupling can generate focusing where neighboring rays converge, lowering $J(t)$ and producing caustics. With zero shear ($s=0$), the mapping is smoother and caustics are suppressed under monotonic gradients. As shear increases and anisotropy becomes stronger (smaller $r$), the folding becomes more pronounced and caustics occur earlier.\n\nNumerical outputs:\nThe program will print a single line containing the three $y$-coordinates for test cases $1$, $2$, and $3$ respectively, in meters, rounded to three significant figures, as a comma-separated list enclosed in square brackets, e.g., $[y_1,y_2,y_3]$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\n# Physical constants\ne_charge = 1.602176634e-19      # Coulomb\nm_e = 9.1093837015e-31          # kg\neps0 = 8.8541878128e-12         # F/m\n\ndef omega_ce(B0):\n    return e_charge * B0 / m_e\n\ndef omega_pe(n_e):\n    return np.sqrt(n_e * e_charge**2 / (m_e * eps0))\n\ndef n_profile(y, n0, Ln):\n    return n0 * np.exp(y / Ln)\n\ndef omega_UH(y, n0, Ln, B0):\n    wpe = omega_pe(n_profile(y, n0, Ln))\n    wce = omega_ce(B0)\n    return np.sqrt(wpe**2 + wce**2)\n\ndef theta(y, theta0, shear_s):\n    return theta0 + shear_s * y\n\ndef b_vec(y, theta0, shear_s):\n    th = theta(y, theta0, shear_s)\n    return np.array([np.cos(th), np.sin(th)])\n\ndef b_perp_vec(y, theta0, shear_s):\n    th = theta(y, theta0, shear_s)\n    return np.array([-np.sin(th), np.cos(th)])\n\ndef omega_disp(kx, ky, y, params):\n    v_perp = params['v_perp']\n    v_par = params['v_par']\n    n0 = params['n0']\n    Ln = params['Ln']\n    B0 = params['B0']\n    b = b_vec(y, params['theta0'], params['s'])\n    kpar = kx * b[0] + ky * b[1]\n    ksq = kx**2 + ky**2\n    kperp2 = ksq - kpar**2\n    wUH = omega_UH(y, n0, Ln, B0)\n    return np.sqrt(wUH**2 + v_perp**2 * kperp2 + v_par**2 * kpar**2)\n\ndef dstate_dt(t, state, params):\n    # Unpack\n    x, y, kx, ky = state\n    v_perp = params['v_perp']\n    v_par = params['v_par']\n    n0 = params['n0']\n    Ln = params['Ln']\n    B0 = params['B0']\n    theta0 = params['theta0']\n    s = params['s']\n    # Local unit vectors and frequencies\n    b = b_vec(y, theta0, s)\n    bperp = b_perp_vec(y, theta0, s)\n    wUH = omega_UH(y, n0, Ln, B0)\n    # Components\n    kpar = kx * b[0] + ky * b[1]\n    kperp_signed = kx * bperp[0] + ky * bperp[1]\n    w = np.sqrt(wUH**2 + v_perp**2 * (kx**2 + ky**2 - kpar**2) + v_par**2 * kpar**2)\n    # Group velocity: dx/dt\n    vx = (v_perp**2 * kx + (v_par**2 - v_perp**2) * kpar * b[0]) / w\n    vy = (v_perp**2 * ky + (v_par**2 - v_perp**2) * kpar * b[1]) / w\n    # d(k)/dt\n    # Compute d omega/dy\n    # wpe(y) and its derivative via n(y) = n0 exp(y/Ln) => wpe ~ exp(y/(2Ln))\n    wpe = omega_pe(n_profile(y, n0, Ln))\n    d_wUH_dy = (wpe**2) / (2.0 * Ln * wUH)  # d(omega_UH)/dy\n    dA_dy_term1 = 2.0 * wUH * d_wUH_dy\n    dA_dy_term2 = 2.0 * (v_par**2 - v_perp**2) * s * kpar * kperp_signed\n    d_omega_dy = (dA_dy_term1 + dA_dy_term2) / (2.0 * w)\n    dkx_dt = 0.0\n    dky_dt = - d_omega_dy\n    return np.array([vx, vy, dkx_dt, dky_dt])\n\ndef launch_k_magnitude(alpha, y0, params):\n    # Solve for k0 magnitude from omega0^2 = wUH(y0)^2 + v_perp^2 kperp^2 + v_par^2 kpar^2\n    v_perp = params['v_perp']\n    v_par = params['v_par']\n    n0 = params['n0']\n    Ln = params['Ln']\n    B0 = params['B0']\n    theta0 = params['theta0']\n    s = params['s']\n    w0 = params['omega0']\n    wUH0 = omega_UH(y0, n0, Ln, B0)\n    delta = alpha - theta(y0, theta0, s)\n    denom = v_perp**2 * np.sin(delta)**2 + v_par**2 * np.cos(delta)**2\n    num = w0**2 - wUH0**2\n    if num <= 0 or denom <= 0:\n        return None\n    k0_sq = num / denom\n    return np.sqrt(k0_sq)\n\ndef integrate_ray(alpha, y0, params, T, t_eval, y_bounds):\n    # Compute initial k magnitude\n    k0 = launch_k_magnitude(alpha, y0, params)\n    if k0 is None:\n        return None\n    kx0 = k0 * np.cos(alpha)\n    ky0 = k0 * np.sin(alpha)\n    x0 = 0.0\n    y0v = y0\n    state0 = np.array([x0, y0v, kx0, ky0], dtype=float)\n    # Integrate with event to stop when y exits bounds\n    def y_event(t, s):\n        return max(min(s[1] - y_bounds[1], s[1] - y_bounds[0]), min(s[1] - y_bounds[1], s[1] - y_bounds[0]))\n    # Define two events, upper and lower; solve_ivp supports multiple events\n    def y_lower_event(t, s):\n        return s[1] - y_bounds[0]\n    def y_upper_event(t, s):\n        return y_bounds[1] - s[1]\n    y_lower_event.terminal = True\n    y_upper_event.terminal = True\n    y_lower_event.direction = -1\n    y_upper_event.direction = -1\n    sol = solve_ivp(lambda tt, st: dstate_dt(tt, st, params),\n                    (0.0, T), state0, t_eval=t_eval, rtol=1e-7, atol=1e-9,\n                    events=[y_lower_event, y_upper_event])\n    # Extract trajectory\n    return sol.t, sol.y\n\ndef detect_first_caustic(y0, alpha0, dalpha, params, T, y_bounds, n_steps=2000, thresh_frac=5e-3):\n    # Integrate three rays: alpha0-dalpha, alpha0, alpha0+dalpha\n    t_eval = np.linspace(0.0, T, n_steps)\n    res_minus = integrate_ray(alpha0 - dalpha, y0, params, T, t_eval, y_bounds)\n    res_plus = integrate_ray(alpha0 + dalpha, y0, params, T, t_eval, y_bounds)\n    res_cent = integrate_ray(alpha0, y0, params, T, t_eval, y_bounds)\n    if res_minus is None or res_plus is None or res_cent is None:\n        return -1.0\n    t_m, y_m = res_minus\n    t_p, y_p = res_plus\n    t_c, y_c = res_cent\n    # Ensure all have same time grid length; truncate to min common length\n    L = min(t_m.size, t_p.size, t_c.size)\n    xm = y_m[0, :L]; ym = y_m[1, :L]\n    xp = y_p[0, :L]; yp = y_p[1, :L]\n    xc = y_c[0, :L]; yc = y_c[1, :L]\n    # Compute Jacobian norm J(t)\n    dxf = (xp - xm) / (2.0 * dalpha)\n    dyf = (yp - ym) / (2.0 * dalpha)\n    J = np.sqrt(dxf**2 + dyf**2)\n    # Use first nonzero index for baseline (skip t=0 where J=0 due to same initial position)\n    idx0 = 1 if L > 1 else 0\n    if J[idx0] == 0.0:\n        # Find first index where J > 0\n        nz = np.where(J > 0.0)[0]\n        if nz.size == 0:\n            return -1.0\n        idx0 = int(nz[0])\n    baseline = J[idx0]\n    threshold = thresh_frac * baseline\n    # Detect first index where J <= threshold after idx0\n    idxs = np.where(J <= threshold)[0]\n    idxs = idxs[idxs > idx0]\n    if idxs.size == 0:\n        return -1.0\n    first_idx = int(idxs[0])\n    # Return y of central ray at detection\n    return float(yc[first_idx])\n\ndef round_sig(x, sig=3):\n    # Round to 'sig' significant figures; handle -1.0 sentinel without scientific notation\n    if not np.isfinite(x):\n        return -1.0\n    if x == 0.0:\n        return 0.0\n    # For sentinel -1.0, return as is\n    if abs(x + 1.0) < 1e-12:\n        return -1.0\n    from math import log10, floor\n    return float(np.round(x, sig - int(floor(log10(abs(x)))) - 1))\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case 1: baseline, no shear\n        {\n            'B0': 2.0,\n            'n0': 1.0e19,\n            'Ln': 0.05,\n            's': 0.0,\n            'v_perp': 3.0e6,\n            'r': 0.10,\n            'omega0': 4.30e11,\n            'theta0': 0.0,\n            'y0': -0.01,\n            'alpha0': 0.0 + np.pi/3,\n            'dalpha': 0.01,\n            'T': 1.0e-7,\n            'y_bounds': (-0.05, 0.05),\n        },\n        # Test case 2: moderate shear\n        {\n            'B0': 2.0,\n            'n0': 1.0e19,\n            'Ln': 0.05,\n            's': 30.0,\n            'v_perp': 3.0e6,\n            'r': 0.08,\n            'omega0': 4.30e11,\n            'theta0': 0.0,\n            'y0': -0.01,\n            'alpha0': 0.0 + np.pi/3,\n            'dalpha': 0.01,\n            'T': 1.0e-7,\n            'y_bounds': (-0.05, 0.05),\n        },\n        # Test case 3: strong shear\n        {\n            'B0': 2.0,\n            'n0': 1.0e19,\n            'Ln': 0.05,\n            's': 100.0,\n            'v_perp': 3.0e6,\n            'r': 0.03,\n            'omega0': 4.30e11,\n            'theta0': 0.0,\n            'y0': -0.01,\n            'alpha0': 0.0 + np.pi/3,\n            'dalpha': 0.01,\n            'T': 1.0e-7,\n            'y_bounds': (-0.05, 0.05),\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        # Prepare parameters for ODE\n        params = {\n            'B0': case['B0'],\n            'n0': case['n0'],\n            'Ln': case['Ln'],\n            's': case['s'],\n            'v_perp': case['v_perp'],\n            'v_par': case['r'] * case['v_perp'],\n            'theta0': case['theta0'],\n            'omega0': case['omega0'],\n        }\n        y_first = detect_first_caustic(\n            y0=case['y0'],\n            alpha0=case['alpha0'],\n            dalpha=case['dalpha'],\n            params=params,\n            T=case['T'],\n            y_bounds=case['y_bounds'],\n            n_steps=2000,\n            thresh_frac=5e-3\n        )\n        # Round to three significant figures\n        y_rounded = round_sig(y_first, sig=3)\n        results.append(y_rounded)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(lambda v: ('{:.3g}'.format(v) if isinstance(v, float) else str(v)), results))}]\")\n\nsolve()\n```", "id": "3697012"}]}