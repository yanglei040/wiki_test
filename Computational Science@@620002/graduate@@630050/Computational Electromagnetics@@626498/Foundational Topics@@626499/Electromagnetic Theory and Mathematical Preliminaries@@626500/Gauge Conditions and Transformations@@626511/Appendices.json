{"hands_on_practices": [{"introduction": "The non-uniqueness of electromagnetic potentials is a cornerstone of gauge theory. This first exercise provides a concrete, analytical exploration of this principle by constructing different vector potentials for the same uniform magnetic field. By explicitly deriving the gauge function that transforms one potential into another, you will gain a hands-on understanding of how gauge freedom operates and how a specific choice, like the Coulomb gauge, constrains but does not eliminate this freedom [@problem_id:3310127].", "problem": "A static, spatially uniform magnetic field is specified as $\\mathbf{B} = B_{0}\\,\\hat{\\mathbf{z}}$, with $B_{0}$ a constant. In the International System of Units (SI), electromagnetic fields can be represented in terms of scalar and vector potentials $(\\phi,\\mathbf{A})$ satisfying $\\mathbf{B} = \\nabla \\times \\mathbf{A}$ and $\\mathbf{E} = -\\nabla \\phi - \\partial \\mathbf{A}/\\partial t$. Gauge transformations of the potentials are defined by introducing a scalar gauge function $\\chi$ such that $\\mathbf{A}' = \\mathbf{A} + \\nabla \\chi$ and $\\phi' = \\phi - \\partial \\chi/\\partial t$, leaving the physical fields $\\mathbf{E}$ and $\\mathbf{B}$ unchanged.\n\nStarting from these fundamental definitions, carry out the following:\n\n1. Impose the Coulomb gauge $\\nabla \\cdot \\mathbf{A} = 0$ and construct a vector potential $\\mathbf{A}_{\\mathrm{sym}}(\\mathbf{r})$ for $\\mathbf{B} = B_{0}\\,\\hat{\\mathbf{z}}$ that is linear in the spatial coordinates and exhibits rotational symmetry about the $\\hat{\\mathbf{z}}$ axis.\n\n2. Under the same Coulomb gauge, construct a second vector potential $\\mathbf{A}_{\\mathrm{tran}}(\\mathbf{r})$ for $\\mathbf{B} = B_{0}\\,\\hat{\\mathbf{z}}$ that is translationally invariant along the $\\hat{\\mathbf{x}}$ axis, with no dependence on $x$ or $z$ and with components depending only on $y$.\n\n3. Using the gauge transformation relations, determine the scalar gauge function $\\chi(x,y,z)$ that transforms $\\mathbf{A}_{\\mathrm{sym}}$ to $\\mathbf{A}_{\\mathrm{tran}}$, and verify that this gauge function preserves the Coulomb gauge, i.e., $\\nabla \\cdot \\mathbf{A}_{\\mathrm{tran}} = 0$ given $\\nabla \\cdot \\mathbf{A}_{\\mathrm{sym}} = 0$.\n\nAssume time independence throughout (static fields) so that $\\partial \\chi/\\partial t = 0$ and $\\phi$ can be taken constant. Express your final answer as the explicit analytic expression for the scalar gauge function $\\chi(x,y,z)$. No numerical rounding is required, and no units need to be reported in the final expression.", "solution": "The problem requires the construction of two different vector potentials for a uniform magnetic field and the determination of the scalar gauge function that transforms one into the other. The process is divided into three parts as outlined in the problem statement.\n\nThe fundamental relationship between the magnetic field $\\mathbf{B}$ and the magnetic vector potential $\\mathbf{A}$ is given by $\\mathbf{B} = \\nabla \\times \\mathbf{A}$. The fields are assumed to be static, so all time derivatives are zero.\n\nThe given magnetic field is $\\mathbf{B} = B_{0}\\,\\hat{\\mathbf{z}}$, where $B_{0}$ is a constant. In Cartesian coordinates, this means we must find a vector potential $\\mathbf{A}(x,y,z) = A_{x}\\hat{\\mathbf{x}} + A_{y}\\hat{\\mathbf{y}} + A_{z}\\hat{\\mathbf{z}}$ such that its curl is $\\mathbf{B}$:\n$$ \\nabla \\times \\mathbf{A} = \\left(\\frac{\\partial A_z}{\\partial y} - \\frac{\\partial A_y}{\\partial z}\\right)\\hat{\\mathbf{x}} + \\left(\\frac{\\partial A_x}{\\partial z} - \\frac{\\partial A_z}{\\partial x}\\right)\\hat{\\mathbf{y}} + \\left(\\frac{\\partial A_y}{\\partial x} - \\frac{\\partial A_x}{\\partial y}\\right)\\hat{\\mathbf{z}} = B_{0}\\hat{\\mathbf{z}} $$\nThis implies the following component-wise equations:\n$$(1) \\quad \\frac{\\partial A_z}{\\partial y} - \\frac{\\partial A_y}{\\partial z} = 0$$\n$$(2) \\quad \\frac{\\partial A_x}{\\partial z} - \\frac{\\partial A_z}{\\partial x} = 0$$\n$$(3) \\quad \\frac{\\partial A_y}{\\partial x} - \\frac{\\partial A_x}{\\partial y} = B_{0}$$\n\n**Part 1: Construction of the symmetric vector potential $\\mathbf{A}_{\\mathrm{sym}}$**\n\nWe are asked to find a vector potential $\\mathbf{A}_{\\mathrm{sym}}$ that satisfies the Coulomb gauge condition $\\nabla \\cdot \\mathbf{A}_{\\mathrm{sym}} = 0$, is linear in the spatial coordinates $(x,y,z)$, and exhibits rotational symmetry about the $\\hat{\\mathbf{z}}$ axis.\n\nThe condition of rotational symmetry about the $\\hat{\\mathbf{z}}$ axis suggests a form for $\\mathbf{A}$ that is proportional to $\\mathbf{r} \\times \\hat{\\mathbf{z}} = (x\\hat{\\mathbf{x}} + y\\hat{\\mathbf{y}}) \\times \\hat{\\mathbf{z}} = y\\hat{\\mathbf{x}} - x\\hat{\\mathbf{y}}$. Let's propose an ansatz of the form $\\mathbf{A}_{\\mathrm{sym}} = C(y\\hat{\\mathbf{x}} - x\\hat{\\mathbf{y}})$ for some constant $C$. This form is linear in the coordinates.\n\nLet's check the curl of this ansatz:\n$$ \\nabla \\times \\mathbf{A}_{\\mathrm{sym}} = \\nabla \\times (C y\\hat{\\mathbf{x}} - C x\\hat{\\mathbf{y}}) = \\hat{\\mathbf{z}}\\left(\\frac{\\partial(-Cx)}{\\partial x} - \\frac{\\partial(Cy)}{\\partial y}\\right) = \\hat{\\mathbf{z}}(-C - C) = -2C\\hat{\\mathbf{z}} $$\nTo match the given magnetic field $\\mathbf{B} = B_{0}\\hat{\\mathbf{z}}$, we must have $-2C = B_{0}$, which gives $C = -B_{0}/2$.\n\nThus, the vector potential is $\\mathbf{A}_{\\mathrm{sym}} = -\\frac{B_{0}}{2}(y\\hat{\\mathbf{x}} - x\\hat{\\mathbf{y}}) = \\frac{B_{0}}{2}(-y\\hat{\\mathbf{x}} + x\\hat{\\mathbf{y}})$.\nLet's verify that this satisfies the Coulomb gauge condition $\\nabla \\cdot \\mathbf{A}_{\\mathrm{sym}} = 0$:\n$$ \\nabla \\cdot \\mathbf{A}_{\\mathrm{sym}} = \\frac{\\partial}{\\partial x}\\left(-\\frac{B_{0}}{2}y\\right) + \\frac{\\partial}{\\partial y}\\left(\\frac{B_{0}}{2}x\\right) + \\frac{\\partial}{\\partial z}(0) = 0 + 0 + 0 = 0 $$\nThe condition is satisfied. So, the symmetric vector potential is:\n$$ \\mathbf{A}_{\\mathrm{sym}} = \\frac{B_{0}}{2}(-y\\hat{\\mathbf{x}} + x\\hat{\\mathbf{y}}) $$\n\n**Part 2: Construction of the translationally invariant vector potential $\\mathbf{A}_{\\mathrm{tran}}$**\n\nNext, we seek a different vector potential, $\\mathbf{A}_{\\mathrm{tran}}$, which is also in the Coulomb gauge ($\\nabla \\cdot \\mathbf{A}_{\\mathrm{tran}} = 0$) but has different symmetry properties: it must be translationally invariant along the $\\hat{\\mathbf{x}}$ axis and have components that depend only on the coordinate $y$.\n\nThese constraints mean that $\\mathbf{A}_{\\mathrm{tran}} = \\mathbf{A}_{\\mathrm{tran}}(y)$, i.e., $\\partial \\mathbf{A}_{\\mathrm{tran}}/\\partial x = 0$ and $\\partial \\mathbf{A}_{\\mathrm{tran}}/\\partial z = 0$. Let's write $\\mathbf{A}_{\\mathrm{tran}}(y) = A_{x}(y)\\hat{\\mathbf{x}} + A_{y}(y)\\hat{\\mathbf{y}} + A_{z}(y)\\hat{\\mathbf{z}}$.\n\nThe Coulomb gauge condition $\\nabla \\cdot \\mathbf{A}_{\\mathrm{tran}} = 0$ becomes:\n$$ \\frac{\\partial A_x}{\\partial x} + \\frac{\\partial A_y}{\\partial y} + \\frac{\\partial A_z}{\\partial z} = 0 + \\frac{d A_y}{d y} + 0 = 0 $$\nThis implies that $A_y(y)$ is a constant. By a simple additional constant vector potential subtraction (a type of gauge transformation), we can set this constant to zero, so $A_{y} = 0$.\n\nNow we apply the curl condition $\\nabla \\times \\mathbf{A}_{\\mathrm{tran}} = B_{0}\\hat{\\mathbf{z}}$:\nFrom equation (1): $\\frac{d A_z}{d y} - \\frac{\\partial A_y}{\\partial z} = \\frac{d A_z}{d y} - 0 = 0$, which means $A_z(y)$ is also a constant. We can set this constant to zero, so $A_{z} = 0$.\nFrom equation (2): $\\frac{\\partial A_x}{\\partial z} - \\frac{\\partial A_z}{\\partial x} = 0 - 0 = 0$. This is satisfied.\nFrom equation (3): $\\frac{\\partial A_y}{\\partial x} - \\frac{\\partial A_x}{\\partial y} = 0 - \\frac{d A_x}{d y} = B_{0}$. This gives $\\frac{d A_x}{d y} = -B_{0}$.\n\nIntegrating with respect to $y$, we get $A_{x}(y) = -B_{0}y + K$, where $K$ is a constant of integration. The addition of a constant to a potential component does not change the magnetic field, so we can choose $K=0$ for simplicity.\n\nThus, the translationally invariant vector potential is:\n$$ \\mathbf{A}_{\\mathrm{tran}} = -B_{0}y \\hat{\\mathbf{x}} $$\n\n**Part 3: Determination of the scalar gauge function $\\chi$**\n\nThe two vector potentials, $\\mathbf{A}_{\\mathrm{sym}}$ and $\\mathbf{A}_{\\mathrm{tran}}$, describe the same magnetic field and are related by a gauge transformation. This means there exists a scalar function $\\chi(x,y,z)$ such that $\\mathbf{A}_{\\mathrm{tran}} = \\mathbf{A}_{\\mathrm{sym}} + \\nabla\\chi$. We need to find this function $\\chi$.\n\nRearranging the transformation equation, we have $\\nabla\\chi = \\mathbf{A}_{\\mathrm{tran}} - \\mathbf{A}_{\\mathrm{sym}}$.\nLet's compute the difference vector:\n$$ \\mathbf{A}_{\\mathrm{tran}} - \\mathbf{A}_{\\mathrm{sym}} = (-B_{0}y\\hat{\\mathbf{x}}) - \\left(\\frac{B_{0}}{2}(-y\\hat{\\mathbf{x}} + x\\hat{\\mathbf{y}})\\right) $$\n$$ \\mathbf{A}_{\\mathrm{tran}} - \\mathbf{A}_{\\mathrm{sym}} = \\left(-B_{0}y + \\frac{B_{0}}{2}y\\right)\\hat{\\mathbf{x}} + \\left(0 - \\frac{B_{0}}{2}x\\right)\\hat{\\mathbf{y}} = -\\frac{B_{0}}{2}y\\hat{\\mathbf{x}} - \\frac{B_{0}}{2}x\\hat{\\mathbf{y}} $$\nSo, we have $\\nabla\\chi = \\frac{\\partial \\chi}{\\partial x}\\hat{\\mathbf{x}} + \\frac{\\partial \\chi}{\\partial y}\\hat{\\mathbf{y}} + \\frac{\\partial \\chi}{\\partial z}\\hat{\\mathbf{z}} = -\\frac{B_{0}}{2}y\\hat{\\mathbf{x}} - \\frac{B_{0}}{2}x\\hat{\\mathbf{y}}$.\n\nThis gives us the partial derivatives of $\\chi$:\n$$ \\frac{\\partial \\chi}{\\partial x} = -\\frac{B_{0}}{2}y $$\n$$ \\frac{\\partial \\chi}{\\partial y} = -\\frac{B_{0}}{2}x $$\n$$ \\frac{\\partial \\chi}{\\partial z} = 0 $$\nFrom the third equation, $\\chi$ is independent of $z$, so $\\chi = \\chi(x,y)$.\nIntegrating the first equation with respect to $x$:\n$$ \\chi(x,y) = \\int \\left(-\\frac{B_{0}}{2}y\\right) dx = -\\frac{B_{0}}{2}xy + f(y) $$\nwhere $f(y)$ is an integration function that depends only on $y$.\n\nTo find $f(y)$, we differentiate this expression for $\\chi$ with respect to $y$ and equate it to the second partial derivative equation:\n$$ \\frac{\\partial \\chi}{\\partial y} = \\frac{\\partial}{\\partial y}\\left(-\\frac{B_{0}}{2}xy + f(y)\\right) = -\\frac{B_{0}}{2}x + \\frac{df}{dy} $$\nComparing this to $\\frac{\\partial \\chi}{\\partial y} = -\\frac{B_{0}}{2}x$, we see that $\\frac{df}{dy} = 0$. This implies that $f(y)$ is a constant, which we can set to zero as it does not affect the gradient $\\nabla\\chi$.\nTherefore, the desired scalar gauge function is:\n$$ \\chi(x,y,z) = -\\frac{B_{0}}{2}xy $$\n\nFinally, we must verify that this gauge transformation preserves the Coulomb gauge. A gauge transformation from $\\mathbf{A}$ to $\\mathbf{A}' = \\mathbf{A} + \\nabla\\chi$ preserves the Coulomb gauge ($\\nabla \\cdot \\mathbf{A} = 0 \\implies \\nabla \\cdot \\mathbf{A}' = 0$) if and only if the gauge function $\\chi$ satisfies the Laplace equation, $\\nabla^2\\chi=0$.\nLet's compute the Laplacian of our function $\\chi$:\n$$ \\nabla^2\\chi = \\frac{\\partial^2 \\chi}{\\partial x^2} + \\frac{\\partial^2 \\chi}{\\partial y^2} + \\frac{\\partial^2 \\chi}{\\partial z^2} $$\n$$ \\frac{\\partial^2}{\\partial x^2}\\left(-\\frac{B_{0}}{2}xy\\right) = \\frac{\\partial}{\\partial x}\\left(-\\frac{B_{0}}{2}y\\right) = 0 $$\n$$ \\frac{\\partial^2}{\\partial y^2}\\left(-\\frac{B_{0}}{2}xy\\right) = \\frac{\\partial}{\\partial y}\\left(-\\frac{B_{0}}{2}x\\right) = 0 $$\n$$ \\frac{\\partial^2}{\\partial z^2}\\left(-\\frac{B_{0}}{2}xy\\right) = 0 $$\nSo, $\\nabla^2\\chi = 0+0+0 = 0$. The condition is satisfied, confirming that since $\\mathbf{A}_{\\mathrm{sym}}$ is in the Coulomb gauge, $\\mathbf{A}_{\\mathrm{tran}}$ must be as well. This is consistent with our independent verification in Part 2.", "answer": "$$ \\boxed{-\\frac{B_{0}}{2}xy} $$", "id": "3310127"}, {"introduction": "In computational electromagnetics, theoretical concepts have direct, practical consequences for numerical stability and accuracy. This practice bridges the gap between continuous gauge theory and discrete finite element methods (FEM) by analyzing the nullspace of the curl-curl operator. You will see how gauge freedom, combined with the domain's topology, manifests as a singularity in the FEM system matrix and learn how to derive the precise number of constraints needed to ensure a unique solution [@problem_id:3310133].", "problem": "Consider a bounded, connected or disconnected, orientable three-dimensional domain with piecewise smooth boundary, whose topology is characterized by the zero-th Betti number $b_0$ (the number of connected components) and the first Betti number $b_1$ (the rank of the first homology group, equivalently the number of independent one-dimensional holes). Let this domain be discretized by a conforming tetrahedral mesh compatible with the Finite Element Method (FEM) de Rham complex and an edge-element (first family of Nédélec) space. The unknown is a discrete vector potential $\\mathbf{A}_h$ in the edge-element space associated with the magnetostatic or time-harmonic curl-curl operator. Assume tangential boundary conditions are such that the standard discrete exact sequence holds.\n\nStarting from the following fundamental basis:\n- Maxwell’s equations in the static or time-harmonic setting: $\\nabla \\times \\left(\\mu^{-1} \\nabla \\times \\mathbf{A}\\right) = \\mathbf{J}$, with the gauge freedom $\\mathbf{A} \\mapsto \\mathbf{A} + \\nabla \\phi$ for any sufficiently smooth scalar potential $\\phi$.\n- The discrete de Rham complex and exactness up to harmonic fields: the discrete gradient $G$ maps node-based potentials to edge-based fields, the discrete curl $C$ maps edge-based fields to face-based fields, and the kernel of $C$ consists of discrete gradients plus a finite-dimensional harmonic space that reflects topology.\n- The Hodge decomposition principle and Betti numbers: on a domain with topology described by $b_0$ and $b_1$, the harmonic subspace of curl-free and divergence-free fields has dimension equal to $b_1$, and constant scalar fields contribute a $b_0$-dimensional nullspace for the gradient.\n\nYou are asked to:\n1) Derive, from first principles using the above basis, an expression for the dimension of the nullspace of the discrete curl-curl operator acting on the edge-element space, explicitly separating contributions from the gauge degrees of freedom and from the harmonic subspace. Your derivation must identify how the number of nodes $n_0$ (the dimension of the nodal scalar space), the zero-th Betti number $b_0$, and the first Betti number $b_1$ determine the dimension of the gauge-related nullspace and the harmonic nullspace.\n2) Propose a minimal set of linear constraints that eliminates the entire nullspace, clearly distinguishing how many constraints are needed to remove gauge modes and how many are needed to remove harmonic modes. Describe these constraints in a way that is independent of any specific mesh details, and explain why they are sufficient.\n3) Implement a program that, given a set of test cases $(n_0, b_0, b_1)$, computes:\n- The dimension of the gauge-related nullspace as a nonnegative integer.\n- The dimension of the harmonic nullspace as a nonnegative integer.\n- The total nullity (the sum of the previous two).\nYour algorithm must be justified by your derivation in item $1)$ and your constraints in item $2)$.\n\nFor numerical evaluation, use the following test suite of parameters, each corresponding to a different topological situation. For each case, $n_0$ is the number of scalar nodes, $b_0$ is the zero-th Betti number, and $b_1$ is the first Betti number:\n- Case A (single solid torus): $(n_0, b_0, b_1) = (120, 1, 1)$.\n- Case B (degenerate boundary case, single node in a simply connected component): $(n_0, b_0, b_1) = (1, 1, 0)$.\n- Case C (single component of genus two): $(n_0, b_0, b_1) = (80, 1, 2)$.\n- Case D (two disjoint solid tori): $(n_0, b_0, b_1) = (200, 2, 2)$.\n- Case E (simply connected single component): $(n_0, b_0, b_1) = (57, 1, 0)$.\n\nYour program should compute, for each case, a list $[\\text{total\\_nullity}, \\text{gauge\\_nullity}, \\text{harmonic\\_nullity}]$, where each entry is an integer. The final output must be a single line containing a list of these lists in the same order as the cases, for example:\n\"[[x_A,y_A,z_A],[x_B,y_B,z_B],[x_C,y_C,z_C],[x_D,y_D,z_D],[x_E,y_E,z_E]]\"\nwhere each $x_\\cdot$, $y_\\cdot$, and $z_\\cdot$ are integers. No physical units are required in this problem. Angles are not involved. Percentages are not involved.", "solution": "The problem requires a derivation of the dimension of the nullspace of the discrete curl-curl operator in finite element analysis, and the formulation of a minimal set of constraints to eliminate it. The analysis is grounded in the algebraic structure of the discrete de Rham complex on a tetrahedral mesh.\n\nLet the finite-dimensional vector spaces of discrete differential forms be denoted as follows: $S_0$ is the space of scalar functions on the nodes (0-forms), $S_1$ is the space of vector functions integrated along edges (1-forms, i.e., the Nédélec edge element space), and $S_2$ is the space of vector functions integrated over faces (2-forms). The dimensions of these spaces are the number of nodes $n_0$, edges $n_1$, and faces $n_2$, respectively.\n\nThe discrete differential operators are the gradient $G: S_0 \\to S_1$, the curl $C: S_1 \\to S_2$, and the divergence $D: S_2 \\to S_3$. The sequence $S_0 \\xrightarrow{G} S_1 \\xrightarrow{C} S_2 \\xrightarrow{D} S_3$ forms a discrete de Rham complex. A fundamental property of this complex, as stated in the problem, is that it is exact up to homology, which is determined by the topology of the domain.\n\nThe problem concerns the nullspace of the discrete curl-curl operator, which can be written in matrix form as $K = C^T M_{\\mu^{-1}} C$, where $C$ is the matrix representation of the discrete curl, and $M_{\\mu^{-1}}$ is the symmetric positive-definite matrix representing the material property $\\mu^{-1}$. A vector potential $\\mathbf{A}_h \\in S_1$ is in the nullspace of $K$ if and only if $K \\mathbf{A}_h = 0$. Due to the positive-definiteness of $M_{\\mu^{-1}}$, the condition $K \\mathbf{A}_h = 0$ is equivalent to $C \\mathbf{A}_h = 0$. Therefore, the nullspace of the discrete curl-curl operator is precisely the kernel of the discrete curl operator, $\\ker(C)$.\n\n**1. Derivation of the Nullspace Dimension**\n\nAccording to the principles of Hodge theory applied to the discrete de Rham complex, the kernel of the curl operator can be decomposed into a direct sum of two orthogonal subspaces: the image of the gradient operator, $\\text{im}(G)$, and the space of first harmonic fields, $\\mathcal{H}_1$.\n$$\n\\ker(C) = \\text{im}(G) \\oplus \\mathcal{H}_1\n$$\nThe dimension of the total nullspace is the sum of the dimensions of these two subspaces: $\\dim(\\ker(C)) = \\dim(\\text{im}(G)) + \\dim(\\mathcal{H}_1)$.\n\n**Dimension of the Harmonic Nullspace:**\nThe space $\\mathcal{H}_1$ consists of discrete 1-forms (edge fields) that are curl-free ($C\\mathbf{A}_h = 0$) and divergence-free ($G^T M_\\epsilon \\mathbf{A}_h = 0$, where $M_\\epsilon$ is the permittivity matrix, for the appropriate Hodge-star definition of divergence), but are not gradients of any global scalar 0-form (node potential). The dimension of this space is a topological invariant of the domain, given by the first Betti number, $b_1$. This is explicitly stated as a given principle.\n$$\n\\dim(\\mathcal{H}_1) = b_1\n$$\nThese $b_1$ basis vectors of $\\mathcal{H}_1$ correspond to non-trivial circulations of the vector potential around the $b_1$ independent non-contractible loops (\"holes\") in the domain. They are the source of the so-called \"topological\" or \"harmonic\" modes in the nullspace.\n\n**Dimension of the Gauge-Related Nullspace:**\nThe subspace $\\text{im}(G)$ consists of all discrete vector fields that are gradients of some discrete scalar potential $\\phi_h \\in S_0$. That is, for any $\\mathbf{A}_h \\in \\text{im}(G)$, there exists a $\\phi_h \\in S_0$ such that $\\mathbf{A}_h = G \\phi_h$. This subspace corresponds to the gauge freedom $\\mathbf{A} \\mapsto \\mathbf{A} + \\nabla \\phi$ in the continuous theory. Hence, $\\text{im}(G)$ is the gauge-related nullspace.\n\nTo find its dimension, we apply the rank-nullity theorem to the discrete gradient operator $G: S_0 \\to S_1$:\n$$\n\\dim(S_0) = \\dim(\\ker(G)) + \\dim(\\text{im}(G))\n$$\nThe dimension of the domain of $G$, $\\dim(S_0)$, is the number of nodes in the mesh, $n_0$.\n\nThe kernel of the gradient operator, $\\ker(G)$, consists of all scalar potentials $\\phi_h \\in S_0$ such that $G \\phi_h = 0$. This condition means that the potential values at the two nodes of any edge in the mesh are identical. Consequently, the potential must be constant on each connected component of the mesh. The number of connected components is given by the zeroth Betti number, $b_0$. A basis for $\\ker(G)$ can be constructed from $b_0$ indicator functions, where the $i$-th basis function is equal to $1$ on all nodes of the $i$-th connected component and $0$ elsewhere. Thus, the dimension of the kernel of the gradient is:\n$$\n\\dim(\\ker(G)) = b_0\n$$\nSubstituting this into the rank-nullity theorem gives:\n$$\nn_0 = b_0 + \\dim(\\text{im}(G))\n$$\nSolving for the dimension of the gauge-related nullspace, we find:\n$$\n\\dim(\\text{im}(G)) = n_0 - b_0\n$$\n\n**Total Nullity:**\nCombining the dimensions of the two subspaces provides the total dimension of the nullspace of the discrete curl-curl operator:\n$$\n\\text{Total Nullity} = \\dim(\\ker(C)) = \\dim(\\text{im}(G)) + \\dim(\\mathcal{H}_1) = (n_0 - b_0) + b_1\n$$\nIn summary, the dimensions are:\n-   Dimension of the gauge-related nullspace: $n_0 - b_0$\n-   Dimension of the harmonic nullspace: $b_1$\n-   Total nullity: $n_0 - b_0 + b_1$\n\n**2. Minimal Set of Linear Constraints**\n\nTo obtain a unique solution for the curl-curl equation, it is necessary to impose a number of linearly independent constraints equal to the total nullity. These constraints must be chosen to eliminate both gauge and harmonic modes.\n\n**Constraints for Gauge Modes:**\nThere are $n_0 - b_0$ gauge degrees of freedom to eliminate. These correspond to the non-zero fields in $\\text{im}(G)$. A standard and mesh-independent way to describe the constraints is through \"tree gauging.\" For each of the $b_0$ connected components of the mesh, one constructs a spanning tree of the graph formed by the nodes and edges. A spanning tree for a component with $n_{0,i}$ nodes contains $n_{0,i} - 1$ edges. The union of these spanning trees over all components forms a \"maximal forest\" for the entire mesh graph. The total number of edges in this forest is $\\sum_{i=1}^{b_0} (n_{0,i} - 1) = (\\sum_{i=1}^{b_0} n_{0,i}) - (\\sum_{i=1}^{b_0} 1) = n_0 - b_0$.\nThe constraints are then imposed by setting the degrees of freedom associated with the edges of this maximal forest to zero. This is equivalent to enforcing that the line integral of the vector potential $\\mathbf{A}_h$ is zero along each of the $n_0 - b_0$ edges in the forest. This procedure effectively fixes the scalar potential $\\phi_h$ up to a constant on each component, which is sufficient to eliminate all non-trivial gradient fields.\n\n**Constraints for Harmonic Modes:**\nThere are $b_1$ harmonic modes to eliminate. These modes are not gradients and are characterized by non-zero circulations around the non-contractible loops of the domain. To eliminate them, one must constrain these circulations.\nThe constraints are formulated by identifying a set of $b_1$ independent, non-contractible closed paths $\\{\\gamma_1, \\gamma_2, \\ldots, \\gamma_{b_1}\\}$ that form a basis for the first homology group of the domain. Each path $\\gamma_j$ \"wraps around\" one of the topological holes. The $b_1$ constraints consist of prescribing the circulation of the vector potential $\\mathbf{A}_h$ along each of these paths, typically by setting them to zero:\n$$\n\\oint_{\\gamma_j} \\mathbf{A}_h \\cdot d\\mathbf{l} = 0, \\quad \\text{for } j = 1, \\ldots, b_1\n$$\nThese $b_1$ constraints are independent of the aforementioned $n_0 - b_0$ gauge constraints and, together, they form a minimal set of $(n_0 - b_0) + b_1$ constraints that is sufficient to eliminate the entire nullspace of the curl-curl operator, rendering the system matrix non-singular.\n\n**3. Algorithm Justification**\nThe algorithm for the program directly implements the derived formulas:\n-   `gauge_nullity` = $n_0 - b_0$\n-   `harmonic_nullity` = $b_1$\n-   `total_nullity` = `gauge_nullity` + `harmonic_nullity` = $(n_0 - b_0) + b_1$\n\nThese formulas are a direct consequence of the application of the discrete de Rham complex and Hodge decomposition to the finite element space, as derived above. The inputs $(n_0, b_0, b_1)$ are precisely the parameters that determine the dimensions of the relevant spaces and topological features.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the nullity of the discrete curl-curl operator for various\n    domain topologies based on given parameters.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (n_0, b_0, b_1)\n    # n_0: number of scalar nodes\n    # b_0: zero-th Betti number (number of connected components)\n    # b_1: first Betti number (number of independent 1D holes/tunnels)\n    test_cases = [\n        (120, 1, 1),  # Case A: single solid torus\n        (1, 1, 0),    # Case B: degenerate case, single node\n        (80, 1, 2),   # Case C: single component of genus two\n        (200, 2, 2),  # Case D: two disjoint solid tori\n        (57, 1, 0),   # Case E: simply connected single component\n    ]\n\n    results = []\n    for case in test_cases:\n        n0, b0, b1 = case\n        \n        # The derivation shows that the nullspace of the discrete curl-curl\n        # operator is the kernel of the discrete curl operator, C.\n        # This kernel decomposes into a direct sum of two subspaces:\n        # 1. The image of the discrete gradient (gauge modes).\n        # 2. The space of discrete harmonic fields (topological modes).\n        \n        # Dimension of the gauge-related nullspace = dim(im(G))\n        # From the rank-nullity theorem on the gradient operator G,\n        # dim(im(G)) = dim(domain(G)) - dim(ker(G))\n        # dim(domain(G)) is the number of nodes, n_0.\n        # dim(ker(G)) is the number of connected components, b_0.\n        # Therefore, gauge_nullity = n_0 - b_0.\n        if n0 < b0:\n             # This case is physically/topologically inconsistent, but for\n             # robustness, we handle it. The number of nodes cannot be less\n             # than the number of connected components.\n             gauge_nullity = 0\n        else:\n             gauge_nullity = n0 - b0\n        \n        # Dimension of the harmonic nullspace.\n        # This is a topological invariant equal to the first Betti number, b_1.\n        harmonic_nullity = b1\n        \n        # Total nullity is the sum of the two.\n        total_nullity = gauge_nullity + harmonic_nullity\n        \n        results.append([total_nullity, gauge_nullity, harmonic_nullity])\n\n    # Format the output string exactly as required by the problem statement.\n    # Example format: [[x_A,y_A,z_A],[x_B,y_B,z_B],...]\n    # Each inner list is formatted as '[x,y,z]' without spaces.\n    inner_results_str = [f\"[{t},{g},{h}]\" for t, g, h in results]\n    final_output_str = f\"[{','.join(inner_results_str)}]\"\n    \n    print(final_output_str)\n\nsolve()\n```", "id": "3310133"}, {"introduction": "Maintaining a chosen gauge condition throughout a time-domain simulation is critical for obtaining physically correct results. This exercise puts you in the driver's seat of a Finite-Difference Time-Domain (FDTD) simulation to investigate the dynamics of the Lorenz gauge. By implementing a numerical diagnostic, you will uncover the fundamental relationship between the preservation of the discrete gauge condition and the satisfaction of the discrete charge continuity equation, a crucial insight for developing robust simulation codes [@problem_id:3310124].", "problem": "You are given a one-dimensional periodic spatial grid and a second-order explicit time-marching scheme for electromagnetic potentials under the Lorenz gauge. The objective is to design and implement a diagnostic that measures the discrete residual of a chosen gauge condition and relate it to the discrete continuity equation in the scheme. You must implement a complete program that computes the gauge residual and the continuity residual across several test cases and outputs a quantitative diagnostic for each case.\n\nStart from the following physical and mathematical foundations:\n- Maxwell's equations with potentials define the electric field and magnetic field as $E = -\\nabla \\phi - \\partial A / \\partial t$ and $B = \\nabla \\times A$, where $A$ is the magnetic vector potential and $\\phi$ is the electric scalar potential.\n- The Lorenz gauge condition is $\\nabla \\cdot A + \\frac{1}{c^2} \\frac{\\partial \\phi}{\\partial t} = 0$.\n- Imposing the Lorenz gauge leads to decoupled wave equations for the potentials: $\\Box \\phi = -\\rho / \\varepsilon_0$ and $\\Box A = -\\mu_0 J$, where $\\Box = \\frac{1}{c^2} \\frac{\\partial^2}{\\partial t^2} - \\nabla^2$, and where $\\rho$ is the charge density and $J$ is the current density. Using $c^2 = 1 / (\\mu_0 \\varepsilon_0)$ yields $\\frac{\\partial^2 \\phi}{\\partial t^2} - c^2 \\nabla^2 \\phi = - \\frac{c^2}{\\varepsilon_0} \\rho$ and $\\frac{\\partial^2 A}{\\partial t^2} - c^2 \\nabla^2 A = - \\frac{1}{\\varepsilon_0} J$.\n- The continuity equation is $\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot J = 0$.\n\nWork entirely in nondimensionalized units by setting $c = 1$, $\\varepsilon_0 = 1$, and $\\mu_0 = 1$. In these units, all quantities are dimensionless, and your outputs must be dimensionless floating-point numbers.\n\nDiscretize the one-dimensional spatial domain of length $L$ using $N$ equally spaced points with grid spacing $\\Delta x = L/N$ and periodic boundary conditions. Use a second-order central finite-difference scheme in space and time. Let $t_n = n \\Delta t$ denote the discrete times. Let $f_i^n$ denote the value of a field $f$ at grid point $x_i$ and time $t_n$. Define the following discrete operators:\n- Discrete central spatial derivative (discrete divergence in one dimension) for a field $u$:\n$$\n\\left(\\nabla_h \\cdot u\\right)_i^n = \\frac{u_{i+1}^n - u_{i-1}^n}{2 \\Delta x}.\n$$\n- Discrete Laplacian:\n$$\n\\left(\\nabla_h^2 f\\right)_i^n = \\frac{f_{i+1}^n - 2 f_i^n + f_{i-1}^n}{\\Delta x^2}.\n$$\n- Discrete centered time derivative:\n$$\n\\left(\\delta_t f\\right)_i^n = \\frac{f_i^{n+1} - f_i^{n-1}}{2 \\Delta t}.\n$$\n- Discrete second-order time difference:\n$$\n\\left(\\delta_{tt} f\\right)_i^n = \\frac{f_i^{n+1} - 2 f_i^n + f_i^{n-1}}{\\Delta t^2}.\n$$\n\nImplement the explicit time-marching updates for the potentials under the Lorenz gauge in nondimensional units:\n$$\n\\phi_i^{n+1} = 2 \\phi_i^n - \\phi_i^{n-1} + \\Delta t^2 \\left( \\left(\\nabla_h^2 \\phi\\right)_i^n - \\rho_i^n \\right),\n$$\n$$\nA_i^{n+1} = 2 A_i^n - A_i^{n-1} + \\Delta t^2 \\left( \\left(\\nabla_h^2 A\\right)_i^n - J_i^n \\right).\n$$\nInitialize $\\phi_i^0 = 0$, $\\phi_i^1 = 0$, $A_i^0 = 0$, and $A_i^1 = 0$ for all $i$.\n\nDesign and implement the following discrete diagnostics:\n- The discrete gauge residual at time $n$:\n$$\ng_i^n = \\left(\\nabla_h \\cdot A\\right)_i^n + \\left(\\delta_t \\phi \\right)_i^n.\n$$\n- The discrete continuity residual at time $n$:\n$$\nr_i^n = \\left(\\delta_t \\rho \\right)_i^n + \\left(\\nabla_h \\cdot J\\right)_i^n.\n$$\nDefine the spatial discrete $L^2$ norm at time $n$ for a field $q$ as\n$$\n\\| q^n \\|_{2,h} = \\sqrt{ \\Delta x \\sum_{i=0}^{N-1} \\left(q_i^n\\right)^2 }.\n$$\n\nThe relationship to be examined is that the discrete Lorenz gauge residual $g_i^n$ is driven by the discrete continuity residual $r_i^n$ under the wave-equation updates for $\\phi$ and $A$. Your program should compute the $L^2$ norm of the gauge residual at the final diagnostic time and report it for each test case. To focus the diagnostic on centered differences, evaluate the residual using the definition of $\\left(\\delta_t \\cdot \\right)^n$ at time index $n = T - 2$, where $T$ is the total number of time steps, so that all required time levels exist.\n\nTo construct source terms in cases intended to satisfy the discrete continuity equation, compute $J_i^n$ from a given $\\rho_i^n$ by enforcing\n$$\n\\left(\\nabla_h \\cdot J\\right)_i^n = - \\left(\\delta_t \\rho \\right)_i^n\n$$\nusing a periodic discrete Fourier transform and the discrete central derivative symbol. Let $k_m = \\frac{2\\pi m}{L}$ for $m = 0, 1, \\dots, N-1$ denote the discrete wavenumbers, and let the central difference derivative symbol be $\\sigma(k_m) = \\frac{\\sin(k_m \\Delta x)}{\\Delta x}$. In Fourier space, set $\\widehat{J}(k_m)^n = - \\widehat{s}(k_m)^n / (i \\, \\sigma(k_m))$ for modes with $\\sigma(k_m) \\neq 0$, and set $\\widehat{J}(k_m)^n = 0$ for modes with $\\sigma(k_m) = 0$, where $s_i^n = \\left(\\delta_t \\rho \\right)_i^n$ and hats denote the discrete Fourier transform. Transform back to real space to obtain $J_i^n$.\n\nImplement the following test suite, where $N$ is the number of grid points, $L$ is the domain length, $\\Delta t$ is the time step, $T$ is the total number of time steps, $k$ is the spatial frequency, and $\\Omega$ is the temporal angular frequency in the charge density. All quantities are dimensionless. For all cases, use periodic boundary conditions, and report the discrete $L^2$ norm of the gauge residual at time $n = T - 2$.\n\n- Case 1 (consistency, stable Courant number): $N = 128$, $L = 1.0$, $\\Delta t = 0.8 \\Delta x$, $T = 50$, $k = 2 \\pi$ (one spatial period over the domain), $\\Omega = 1.5$. Define $\\rho_i^n = \\sin(k x_i) \\cos(\\Omega t_n)$ and compute $J_i^n$ by enforcing the discrete continuity equation using the spectral method described above.\n- Case 2 (violate continuity): Same parameters as Case 1, but set $J_i^n = 0$ for all $i,n$ while keeping $\\rho_i^n$ unchanged.\n- Case 3 (zero sources): $N = 128$, $L = 1.0$, $\\Delta t = 0.8 \\Delta x$, $T = 50$. Set $\\rho_i^n = 0$ and $J_i^n = 0$ for all $i,n$.\n- Case 4 (near Courant limit, consistency): $N = 128$, $L = 1.0$, $\\Delta t = 0.99 \\Delta x$, $T = 50$, $k = 4 \\pi$ (two spatial periods over the domain), $\\Omega = 2.0$. Define $\\rho_i^n = \\sin(k x_i) \\cos(\\Omega t_n)$ and compute $J_i^n$ by enforcing the discrete continuity equation using the spectral method described above.\n\nYour program must:\n- Implement the updates for $\\phi$ and $A$ over $n = 1, 2, \\dots, T-2$ and compute the gauge residual $g_i^{T-2}$ at the end.\n- Compute and report the spatial discrete $L^2$ norm $\\| g^{T-2} \\|_{2,h}$ for each case.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, \"[result1,result2,result3,result4]\". Each result must be a floating-point number representing the discrete $L^2$ norm of the gauge residual at time $n = T - 2$ for the corresponding test case. All outputs must be dimensionless real numbers. You must not print any additional text.\n\nYou must implement your solution using the Finite-Difference Time-Domain (FDTD) method in nondimensional units, adhering strictly to the specified discretizations and test suite.", "solution": "The problem requires the design and implementation of a numerical diagnostic to investigate the relationship between the Lorenz gauge condition and the charge continuity equation within a second-order finite-difference time-domain (FDTD) scheme. The problem is set in one spatial dimension with periodic boundary conditions and uses nondimensionalized units where the speed of light $c=1$, the vacuum permittivity $\\varepsilon_0=1$, and the vacuum permeability $\\mu_0=1$.\n\nThe fundamental physical laws governing the system are Maxwell's equations. In terms of the magnetic vector potential $A$ and the electric scalar potential $\\phi$, the electric and magnetic fields are $E = -\\nabla \\phi - \\partial A / \\partial t$ and $B = \\nabla \\times A$, respectively. The dynamics of the potentials are governed by the inhomogeneous wave equations that arise when the Lorenz gauge condition, $\\nabla \\cdot A + \\frac{1}{c^2} \\frac{\\partial \\phi}{\\partial t} = 0$, is imposed. In the specified nondimensional units, these equations are:\n$$\n\\frac{\\partial^2 \\phi}{\\partial t^2} - \\nabla^2 \\phi = -\\rho\n$$\n$$\n\\frac{\\partial^2 A}{\\partial t^2} - \\nabla^2 A = -J\n$$\nwhere $\\rho$ is the charge density and $J$ is the current density. These sources must satisfy the continuity equation, $\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot J = 0$.\n\nThe numerical solution is constructed on a uniform one-dimensional grid of $N$ points over a domain of length $L$, with spatial step $\\Delta x = L/N$ and time step $\\Delta t$. A function $f(x,t)$ is discretized as $f_i^n = f(x_i, t_n)$, where $x_i = i \\Delta x$ and $t_n = n \\Delta t$. The problem specifies second-order central finite-difference operators for spatial and temporal derivatives:\n- Discrete divergence: $\\left(\\nabla_h \\cdot u\\right)_i^n = \\frac{u_{i+1}^n - u_{i-1}^n}{2 \\Delta x}$\n- Discrete Laplacian: $\\left(\\nabla_h^2 f\\right)_i^n = \\frac{f_{i+1}^n - 2 f_i^n + f_{i-1}^n}{\\Delta x^2}$\n- Discrete time derivative: $\\left(\\delta_t f\\right)_i^n = \\frac{f_i^{n+1} - f_i^{n-1}}{2 \\Delta t}$\n- Discrete second-order time derivative: $\\left(\\delta_{tt} f\\right)_i^n = \\frac{f_i^{n+1} - 2 f_i^n + f_i^{n-1}}{\\Delta t^2}$\n\nUsing these operators, the continuous wave equations are discretized to yield explicit time-marching update rules (a leapfrog scheme):\n$$\n\\phi_i^{n+1} = 2 \\phi_i^n - \\phi_i^{n-1} + \\Delta t^2 \\left( \\left(\\nabla_h^2 \\phi\\right)_i^n - \\rho_i^n \\right)\n$$\n$$\nA_i^{n+1} = 2 A_i^n - A_i^{n-1} + \\Delta t^2 \\left( \\left(\\nabla_h^2 A\\right)_i^n - J_i^n \\right)\n$$\nThese updates, which form the core of the FDTD simulation, are applied for time steps $n=1, 2, \\dots, T-2$, starting from the initial conditions $\\phi_i^0 = \\phi_i^1 = 0$ and $A_i^0 = A_i^1 = 0$.\n\nThe central task is to analyze the discrete Lorenz gauge condition. The discrete gauge residual is defined as $g_i^n = \\left(\\nabla_h \\cdot A\\right)_i^n + \\left(\\delta_t \\phi \\right)_i^n$. Similarly, the discrete continuity residual is $r_i^n = \\left(\\delta_t \\rho \\right)_i^n + \\left(\\nabla_h \\cdot J\\right)_i^n$. A key property of this numerical scheme is that the gauge residual is driven by the continuity residual. To see this, we can apply the discrete wave operator $(\\delta_{tt} - \\nabla_h^2)$ to the gauge residual $g^n$, assuming the discrete operators commute:\n$$\n(\\delta_{tt} - \\nabla_h^2) g^n = (\\delta_{tt} - \\nabla_h^2) (\\nabla_h \\cdot A^n + \\delta_t \\phi^n)\n= \\nabla_h \\cdot ((\\delta_{tt} - \\nabla_h^2) A^n) + \\delta_t ((\\delta_{tt} - \\nabla_h^2) \\phi^n)\n$$\nSubstituting the FDTD update rules, which can be written as $(\\delta_{tt} - \\nabla_h^2) \\phi^n = -\\rho^n$ and $(\\delta_{tt} - \\nabla_h^2) A^n = -J^n$, we get:\n$$\n(\\delta_{tt} - \\nabla_h^2) g^n = \\nabla_h \\cdot (-J^n) + \\delta_t (-\\rho^n) = -(\\nabla_h \\cdot J^n + \\delta_t \\rho^n) = -r^n\n$$\nThis result, $(\\delta_{tt} - \\nabla_h^2) g^n = -r^n$, is a discrete wave equation for the gauge residual $g^n$, sourced by the continuity residual $-r^n$. This implies that if the discrete continuity equation is satisfied (i.e., $r^n=0$), the gauge residual will satisfy the homogeneous wave equation. With appropriate initial conditions, it should remain small (ideally zero, up to floating-point precision). If the discrete continuity equation is violated ($r^n \\neq 0$), the gauge residual is expected to grow.\n\nThe implementation will test this relationship. For test cases requiring the discrete continuity equation to be satisfied, the current density $J_i^n$ is constructed from the given charge density $\\rho_i^n$. The condition to enforce is $(\\nabla_h \\cdot J)_i^n = - (\\delta_t \\rho)_i^n$. This is achieved algorithmically using the discrete Fourier transform (DFT). Let $s_i^n = (\\delta_t \\rho)_i^n$. The equation in Fourier space becomes $i \\sigma(k_m) \\widehat{J}(k_m)^n = -\\widehat{s}(k_m)^n$, where $\\widehat{\\cdot}$ denotes the DFT, $k_m$ are the discrete wavenumbers, and $\\sigma(k_m) = \\frac{\\sin(k_m \\Delta x)}{\\Delta x}$ is the spectral symbol for the central difference operator $\\nabla_h$. Solving for $\\widehat{J}(k_m)^n$ gives:\n$$\n\\widehat{J}(k_m)^n = - \\frac{\\widehat{s}(k_m)^n}{i \\sigma(k_m)}\n$$\nThis division is performed for all modes where $\\sigma(k_m) \\neq 0$. For the modes where $\\sigma(k_m) = 0$ (the DC mode $m=0$ and the Nyquist mode $m=N/2$ if $N$ is even), $\\widehat{J}(k_m)^n$ is set to $0$. The current density $J_i^n$ in real space is then recovered via an inverse DFT.\n\nThe overall algorithm is as follows:\n1. For each test case, set up the spatial grid, time step, and source terms $\\rho_i^n$ for all required times.\n2. If required by the test case, compute the current density $J_i^n$ for $n \\in [1, T-2]$ using the spectral method described above to ensure the discrete continuity equation $r_i^n=0$ is satisfied. Otherwise, set $J_i^n$ as specified (e.g., to zero).\n3. Initialize the potential fields $\\phi$ and $A$ to zero for time steps $n=0$ and $n=1$.\n4. Execute the FDTD time-marching loop from $n=1$ to $n=T-2$, updating $\\phi_i^{n+1}$ and $A_i^{n+1}$ using the leapfrog scheme. Periodic boundary conditions are handled by using circular shifts for spatial Laplacians.\n5. After the loop, at the final diagnostic time $n_{diag} = T-2$, compute the gauge residual $g_i^{n_{diag}} = (\\nabla_h \\cdot A)_i^{n_{diag}} + (\\delta_t \\phi)_i^{n_{diag}}$. This requires field values at times $T-1$, $T-2$, and $T-3$, all of which are available.\n6. Compute the final diagnostic quantity, the discrete spatial $L^2$ norm of the gauge residual, $\\| g^{T-2} \\|_{2,h} = \\sqrt{ \\Delta x \\sum_{i=0}^{N-1} (g_i^{T-2})^2 }$.\n\nThis procedure is applied to each of the four test cases, and the resulting $L^2$ norms are reported. Case 3, with zero sources and zero initial conditions, will result in zero potentials and thus a zero gauge residual, serving as a baseline. Cases 1 and 4 enforce continuity, so they are expected to yield very small residuals. Case 2 explicitly violates continuity, which should lead to a significantly larger, non-zero gauge residual.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_simulation(N, L, cfl_factor, T, k, Omega, use_spectral_J):\n    \"\"\"\n    Runs a single FDTD simulation for the given parameters.\n    \"\"\"\n    # 1. Grid and parameter setup\n    dx = L / N\n    dt = cfl_factor * dx\n    x = np.arange(N) * dx\n    t = np.arange(T) * dt\n\n    # 2. Source term generation\n    xx, tt = np.meshgrid(x, t)\n    rho = np.zeros((T, N))\n    J = np.zeros((T, N))\n\n    if k is not None and Omega is not None:\n        rho = np.sin(k * xx) * np.cos(Omega * tt)\n\n    if use_spectral_J:\n        # Enforce discrete continuity equation r=0 using spectral method\n        s = np.zeros_like(rho)\n        # Compute s = delta_t(rho) for n=1,...,T-2\n        for n in range(1, T - 1):\n            s[n, :] = (rho[n + 1, :] - rho[n - 1, :]) / (2 * dt)\n\n        # Wavenumbers and discrete derivative symbol\n        k_m = 2 * np.pi * np.fft.fftfreq(N, d=dx)\n        sigma = np.sin(k_m * dx) / dx\n        \n        # Denominator for Fourier-space division\n        den = 1j * sigma\n        zero_modes = np.abs(sigma) < 1e-15\n        # Avoid division by zero warning, these modes are handled separately\n        den[zero_modes] = 1.0 \n\n        for n in range(1, T - 1):\n            s_hat = np.fft.fft(s[n, :])\n            # J_hat = - s_hat / (i * sigma)\n            J_hat = -s_hat / den\n            J_hat[zero_modes] = 0.0\n            J[n, :] = np.fft.ifft(J_hat).real\n\n    # 3. Initialization of potentials\n    # phi^0 = 0, phi^1 = 0. A^0 = 0, A^1 = 0\n    phi = np.zeros((T, N))\n    A = np.zeros((T, N))\n\n    # 4. FDTD time-marching loop\n    for n in range(1, T - 1):\n        # Get fields at time n\n        phi_n = phi[n, :]\n        A_n = A[n, :]\n\n        # Compute discrete Laplacians with periodic boundaries\n        phi_lap = (np.roll(phi_n, -1) - 2 * phi_n + np.roll(phi_n, 1)) / dx**2\n        A_lap = (np.roll(A_n, -1) - 2 * A_n + np.roll(A_n, 1)) / dx**2\n\n        # Update fields to time n+1\n        phi[n + 1, :] = 2 * phi_n - phi[n - 1, :] + dt**2 * (phi_lap - rho[n, :])\n        A[n + 1, :] = 2 * A_n - A[n - 1, :] + dt**2 * (A_lap - J[n, :])\n\n    # 5. Diagnostic calculation at n = T-2\n    n_diag = T - 2\n    \n    # Discrete divergence of A\n    div_A_diag = (np.roll(A[n_diag, :], -1) - np.roll(A[n_diag, :], 1)) / (2 * dx)\n    \n    # Discrete time derivative of phi\n    dt_phi_diag = (phi[n_diag + 1, :] - phi[n_diag - 1, :]) / (2 * dt)\n\n    # Gauge residual g = div(A) + dt(phi)\n    g = div_A_diag + dt_phi_diag\n\n    # 6. Compute L2 norm of the gauge residual\n    g_norm = np.sqrt(dx * np.sum(g**2))\n    \n    return g_norm\n\ndef solve():\n    \"\"\"\n    Defines and runs the test suite, then prints the results.\n    \"\"\"\n    test_cases = [\n        # Case 1 (consistency, stable Courant number)\n        {'N': 128, 'L': 1.0, 'cfl_factor': 0.8, 'T': 50, 'k': 2 * np.pi, 'Omega': 1.5, 'use_spectral_J': True},\n        # Case 2 (violate continuity)\n        {'N': 128, 'L': 1.0, 'cfl_factor': 0.8, 'T': 50, 'k': 2 * np.pi, 'Omega': 1.5, 'use_spectral_J': False},\n        # Case 3 (zero sources)\n        {'N': 128, 'L': 1.0, 'cfl_factor': 0.8, 'T': 50, 'k': None, 'Omega': None, 'use_spectral_J': False},\n        # Case 4 (near Courant limit, consistency)\n        {'N': 128, 'L': 1.0, 'cfl_factor': 0.99, 'T': 50, 'k': 4 * np.pi, 'Omega': 2.0, 'use_spectral_J': True},\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_simulation(\n            N=case['N'],\n            L=case['L'],\n            cfl_factor=case['cfl_factor'],\n            T=case['T'],\n            k=case['k'],\n            Omega=case['Omega'],\n            use_spectral_J=case['use_spectral_J']\n        )\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3310124"}]}