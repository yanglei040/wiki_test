{"hands_on_practices": [{"introduction": "The Ampère-Maxwell law is a cornerstone of electrodynamics, unifying electricity, magnetism, and wave propagation. This exercise challenges you to retrace the logical steps that led to its final form by exploring the crucial role of displacement current [@problem_id:3329572]. By analyzing two different surfaces bounded by the same path, you will demonstrate from first principles why the term $\\frac{\\partial\\mathbf{D}}{\\partial t}$ is not merely a mathematical convenience, but a physical necessity for a consistent and universal law.", "problem": "An infinitely long, straight, perfectly conducting cylindrical wire oriented along the $z$-axis in free space carries a time-harmonic current $I(t)=I_{0}\\exp(j \\omega t)$, where $I_{0}$ is a real, positive constant and $j$ denotes the unit imaginary number with $j^{2}=-1$. Consider the closed circular path $C$ of radius $r$ centered on and coaxial with the wire. You will evaluate the circulation of the magnetic field intensity around this path and examine surface-choice consistency when a capacitor is present.\n\nUsing only the fundamental laws of classical electromagnetism, including Maxwell’s equations in both differential and integral forms, and standard vector calculus theorems, do the following: derive from first principles an expression for the contour integral $\\oint_{C}\\mathbf{H}\\cdot d\\mathbf{l}$ at time $t$. Then, consider that the wire is part of a series circuit containing a parallel-plate capacitor with plate area $A$, plate separation $d$, and homogeneous permittivity $\\varepsilon$ located elsewhere in the circuit. By choosing two different open surfaces that share the same boundary $C$—one as a flat disk intersecting the wire and another that bulges to pass through the capacitor gap—use first principles to explain why the value of $\\oint_{C}\\mathbf{H}\\cdot d\\mathbf{l}$ is independent of the chosen surface and identify the physical mechanism that ensures this consistency.\n\nYour final result must be a single analytic expression in terms of $I_{0}$, $\\omega$, and $t$. Express the result in amperes. Do not include units in your final boxed expression.", "solution": "The goal is to determine the circulation of the magnetic field intensity, $\\oint_{C}\\mathbf{H}\\cdot d\\mathbf{l}$, around a circular path $C$ encircling an infinitely long straight conductor carrying a time-harmonic current, and to explain the role of the displacement current in maintaining surface independence when the spanning surface intersects a capacitor.\n\nThe appropriate starting point is the integral form of the Ampère–Maxwell law, which is one of Maxwell’s equations. For any open surface $S$ with boundary $C=\\partial S$, the integral law states\n$$\n\\oint_{C}\\mathbf{H}\\cdot d\\mathbf{l}\n=\n\\iint_{S}\\left(\\mathbf{J}+\\frac{\\partial \\mathbf{D}}{\\partial t}\\right)\\cdot d\\mathbf{S},\n$$\nwhere $\\mathbf{J}$ is the free (conduction) current density and $\\mathbf{D}$ is the electric flux density. By Stokes’ theorem, the above is equivalent to the differential form\n$$\n\\nabla\\times \\mathbf{H}=\\mathbf{J}+\\frac{\\partial \\mathbf{D}}{\\partial t}.\n$$\nThe integral depends only on the boundary $C$, not on the choice of spanning surface $S$, provided the total current density $\\mathbf{J}+\\partial \\mathbf{D}/\\partial t$ is divergence-free:\n$$\n\\nabla\\cdot\\left(\\mathbf{J}+\\frac{\\partial \\mathbf{D}}{\\partial t}\\right)\n=\n\\nabla\\cdot \\mathbf{J}+\\frac{\\partial}{\\partial t}\\left(\\nabla\\cdot \\mathbf{D}\\right)\n=\n-\\frac{\\partial \\rho_{\\text{free}}}{\\partial t}+\\frac{\\partial \\rho_{\\text{free}}}{\\partial t}=0,\n$$\nwhere we used the charge continuity equation $\\nabla\\cdot \\mathbf{J}=-\\partial \\rho_{\\text{free}}/\\partial t$ and Gauss’s law for electricity $\\nabla\\cdot \\mathbf{D}=\\rho_{\\text{free}}$.\n\nWe now evaluate the circulation for two different surfaces that share the same circular boundary $C$.\n\nCase 1: $S_{1}$ is a flat disk whose plane is orthogonal to the wire and which intersects the wire’s cross-section. For an ideal, perfectly conducting wire, the interior electric field is zero, so $\\partial \\mathbf{D}/\\partial t=\\mathbf{0}$ inside the conductor. We also choose $S_{1}$ to be confined to a small neighborhood of the wire cross-section such that the only non-negligible contribution to the surface integral comes from the conduction current passing through the wire. Then\n$$\n\\oint_{C}\\mathbf{H}\\cdot d\\mathbf{l}\n=\n\\iint_{S_{1}}\\mathbf{J}\\cdot d\\mathbf{S}\n=\nI(t)\n=\nI_{0}\\exp(j\\omega t).\n$$\nThis result is independent of the radius $r$, as expected from symmetry and the $1/r$ tangential decay of $\\mathbf{H}$ around a straight filamentary current.\n\nFor completeness, symmetry can be used to infer the local field as follows. By cylindrical symmetry, $\\mathbf{H}$ is azimuthal with magnitude depending only on $r$, i.e., $\\mathbf{H}(r,t)=\\hat{\\boldsymbol{\\phi}}\\,H_{\\phi}(r,t)$. The line integral around $C$ of radius $r$ is then\n$$\n\\oint_{C}\\mathbf{H}\\cdot d\\mathbf{l}\n=\nH_{\\phi}(r,t)\\,(2\\pi r)\n=\nI_{0}\\exp(j\\omega t),\n$$\nwhich implies\n$$\nH_{\\phi}(r,t)=\\frac{I_{0}\\exp(j\\omega t)}{2\\pi r}.\n$$\nWhile this local field expression is not requested, it is consistent with the circulation computed above.\n\nCase 2: $S_{2}$ is a surface that bulges out to pass between the plates of a parallel-plate capacitor that is in series with the wire elsewhere in the circuit but still has the same closed boundary $C$. In the gap between the plates (a dielectric region), there is no free (conduction) current crossing $S_{2}$, so\n$$\n\\iint_{S_{2}}\\mathbf{J}\\cdot d\\mathbf{S}=0.\n$$\nHowever, there is generally a nonzero displacement current contribution,\n$$\n\\iint_{S_{2}}\\frac{\\partial \\mathbf{D}}{\\partial t}\\cdot d\\mathbf{S}\n=\n\\frac{\\partial}{\\partial t}\n\\left(\n\\iint_{S_{2}} \\mathbf{D}\\cdot d\\mathbf{S}\n\\right).\n$$\nTo relate this to the source current, invoke Gauss’s law in integral form over a pillbox enclosing one capacitor plate with its flat faces parallel to the plate. The electric flux through the dielectric equals the free charge on the plate:\n$$\n\\iint_{S_{\\text{gap}}} \\mathbf{D}\\cdot d\\mathbf{S}=Q_{\\text{free}}(t).\n$$\nDifferentiating with respect to time and using charge conservation for the series circuit yields\n$$\n\\frac{\\partial}{\\partial t}\n\\left(\n\\iint_{S_{\\text{gap}}} \\mathbf{D}\\cdot d\\mathbf{S}\n\\right)\n=\n\\frac{d Q_{\\text{free}}(t)}{dt}\n=\nI(t)\n=\nI_{0}\\exp(j\\omega t).\n$$\nTherefore, for surface $S_{2}$,\n$$\n\\oint_{C}\\mathbf{H}\\cdot d\\mathbf{l}\n=\n\\iint_{S_{2}}\\left(\\mathbf{J}+\\frac{\\partial \\mathbf{D}}{\\partial t}\\right)\\cdot d\\mathbf{S}\n=\n0\n+\nI_{0}\\exp(j\\omega t)\n=\nI_{0}\\exp(j\\omega t).\n$$\nThis matches the result from $S_{1}$, demonstrating the surface independence mandated by Maxwell’s equations and resolving the apparent paradox by identifying the displacement current as the physical mechanism that ensures continuity of the total current $\\mathbf{J}+\\partial \\mathbf{D}/\\partial t$.\n\nAs an explicit check for a parallel-plate capacitor with plate area $A$, separation $d$, and permittivity $\\varepsilon$, the field in the gap is approximately uniform and normal to the plates, with $D_{n}(t)=\\varepsilon E_{n}(t)=\\varepsilon V(t)/d$. The flux is $\\iint_{S_{\\text{gap}}}\\mathbf{D}\\cdot d\\mathbf{S}=\\varepsilon A\\,V(t)/d$, so\n$$\n\\iint_{S_{2}}\\frac{\\partial \\mathbf{D}}{\\partial t}\\cdot d\\mathbf{S}\n=\n\\frac{\\varepsilon A}{d}\\,\\frac{d V(t)}{dt}.\n$$\nIn a series circuit the current through the capacitor satisfies $I(t)=(\\varepsilon A/d)\\,dV(t)/dt$, thus reproducing the same value $I_{0}\\exp(j\\omega t)$ for the circulation. Hence, regardless of whether the spanning surface cuts through the wire or the capacitor gap, one obtains the same circulation:\n$$\n\\oint_{C}\\mathbf{H}\\cdot d\\mathbf{l}=I_{0}\\exp(j\\omega t).\n$$\nAs requested, this expression is in amperes and is the unique value consistent with Maxwell’s equations and current continuity.", "answer": "$$\\boxed{I_{0}\\,\\exp(j\\omega t)}$$", "id": "3329572"}, {"introduction": "Moving from continuous theory to computational practice is a fundamental skill in modern physics and engineering. This practice guides you through the process of developing a Finite-Difference Time-Domain (FDTD) scheme directly from the integral form of Maxwell's equations, mirroring the celebrated Yee algorithm [@problem_id:3329563]. You will not only build a numerical tool but also analyze its limitations by deriving the numerical dispersion relation, providing a concrete example of how the discrete world of a computer introduces artifacts like numerical anisotropy and birefringence.", "problem": "Consider a two-dimensional Finite-Difference Time-Domain (FDTD) scheme on a uniform Yee lattice for electromagnetic waves in a homogeneous, source-free, uniaxial anisotropic dielectric. The optic axis is aligned with the $z$-axis. The permittivity tensor is $\\boldsymbol{\\varepsilon}=\\mathrm{diag}(\\varepsilon_{\\perp},\\varepsilon_{\\perp},\\varepsilon_{\\parallel})$ and the permeability is isotropic $\\mu=\\mu_{0}$. The Yee grid spacings are $\\Delta x$ and $\\Delta y$ in meters. The time step is $\\Delta t$ in seconds. Assume zero conductivity and no free charge.\n\nStarting from the integral form of Maxwell's equations,\n$$\\oint_{\\partial S} \\mathbf{E}\\cdot d\\boldsymbol{\\ell} = -\\frac{d}{dt}\\int_{S}\\mathbf{B}\\cdot \\mathbf{\\hat{n}}\\, dS,$$\n$$\\oint_{\\partial S} \\mathbf{H}\\cdot d\\boldsymbol{\\ell} = \\frac{d}{dt}\\int_{S}\\mathbf{D}\\cdot \\mathbf{\\hat{n}}\\, dS,$$\napply these laws over one rectangular Yee cell loop and the associated staggered dual loops/volumes to derive the discrete update equations for the two decoupled polarizations in two dimensions:\n- Transverse Electric (TE), where $E_{z}$ is nonzero and $H_{x},H_{y}$ are nonzero, with $\\varepsilon_{zz}=\\varepsilon_{\\parallel}$ controlling the constitutive relation $D_{z}=\\varepsilon_{\\parallel} E_{z}$.\n- Transverse Magnetic (TM), where $H_{z}$ is nonzero and $E_{x},E_{y}$ are nonzero, with $\\varepsilon_{xx}=\\varepsilon_{yy}=\\varepsilon_{\\perp}$ controlling $D_{x}=\\varepsilon_{\\perp} E_{x}$ and $D_{y}=\\varepsilon_{\\perp} E_{y}$.\n\nImpose a discrete plane-wave ansatz with spatial frequency components $k_{x}$ and $k_{y}$ in inverse meters and angular frequency $\\omega$ in radians per second, consistent with the discrete staggering, and obtain the numerical dispersion relations for the TE and TM polarizations. Then obtain the continuous plane-wave dispersion relations in the same medium from the differential-form Maxwell equations for homogeneous, source-free media.\n\nDefine the numerical birefringence metric as the difference between the normalized discrete phase velocities of the TE and TM modes,\n$$\\mathrm{NB} = \\frac{v_{\\mathrm{TE,num}}}{v_{\\mathrm{TE,cont}}} - \\frac{v_{\\mathrm{TM,num}}}{v_{\\mathrm{TM,cont}}},$$\nwhere $v_{\\mathrm{TE,num}}=\\omega_{\\mathrm{TE}}/|\\mathbf{k}|$ and $v_{\\mathrm{TM,num}}=\\omega_{\\mathrm{TM}}/|\\mathbf{k}|$ are the discrete phase velocities obtained from the FDTD dispersion relations, $|\\mathbf{k}|=\\sqrt{k_{x}^{2}+k_{y}^{2}}$ in inverse meters, and $v_{\\mathrm{TE,cont}}$ and $v_{\\mathrm{TM,cont}}$ are the corresponding continuous phase velocities from the analytical dispersion of the anisotropic medium. The metric $\\mathrm{NB}$ is dimensionless.\n\nYour program must implement these derivations to compute $\\mathrm{NB}$ for a specified test suite. Use a Courant stability factor $s_{\\mathrm{CFL}}=0.90$ and set the time step to\n$$\\Delta t=\\frac{s_{\\mathrm{CFL}}}{c_{\\max}\\,\\sqrt{\\left(\\frac{1}{\\Delta x}\\right)^{2}+\\left(\\frac{1}{\\Delta y}\\right)^{2}}},$$\nwhere $c_{\\max}=\\max\\left(\\frac{1}{\\sqrt{\\mu_{0}\\varepsilon_{\\perp}}},\\frac{1}{\\sqrt{\\mu_{0}\\varepsilon_{\\parallel}}}\\right)$ is the largest phase velocity in the medium.\n\nAngles must be specified in radians. All lengths must be expressed in meters, time in seconds, permittivity in farads per meter, permeability in henries per meter, and wavenumbers in inverse meters.\n\nImplement the computation for the following four test cases, each provided as a tuple $(\\Delta x,\\Delta y,\\varepsilon_{\\perp},\\varepsilon_{\\parallel},|\\mathbf{k}|,\\theta,s_{\\mathrm{CFL}})$, where $\\theta$ is the propagation angle of $\\mathbf{k}$ relative to the $x$-axis:\n- Case 1 (general happy path): $(\\Delta x=$1.0 \\times 10^{-2}$,\\,\\Delta y=$1.0 \\times 10^{-2}$,\\,\\varepsilon_{\\perp}=$2\\varepsilon_{0}$,\\,\\varepsilon_{\\parallel}=$3\\varepsilon_{0}$,\\,|\\mathbf{k}|=200,\\,\\theta=$\\pi/4$,\\,s_{\\mathrm{CFL}}=0.90)$.\n- Case 2 (near-Nyquist boundary): $(\\Delta x=$1.0 \\times 10^{-2}$,\\,\\Delta y=$1.0 \\times 10^{-2}$,\\,\\varepsilon_{\\perp}=$2\\varepsilon_{0}$,\\,\\varepsilon_{\\parallel}=$3\\varepsilon_{0}$,\\,|\\mathbf{k}|=$0.95\\pi/\\Delta x$,\\,\\theta=0,\\,s_{\\mathrm{CFL}}=0.90)$.\n- Case 3 (isotropic edge case): $(\\Delta x=$1.0 \\times 10^{-2}$,\\,\\Delta y=$1.0 \\times 10^{-2}$,\\,\\varepsilon_{\\perp}=$2.5\\varepsilon_{0}$,\\,\\varepsilon_{\\parallel}=$2.5\\varepsilon_{0}$,\\,|\\mathbf{k}|=150,\\,\\theta=$\\pi/3$,\\,s_{\\mathrm{CFL}}=0.90)$.\n- Case 4 (weak anisotropy): $(\\Delta x=$1.0 \\times 10^{-2}$,\\,\\Delta y=$1.0 \\times 10^{-2}$,\\,\\varepsilon_{\\perp}=2.0\\varepsilon_{0},\\,\\varepsilon_{\\parallel}=2.1\\varepsilon_{0},\\,|\\mathbf{k}|=250,\\,\\theta=$\\pi/6$,\\,s_{\\mathrm{CFL}}=0.90)$.\n\nFor each case, compute $k_{x}=|\\mathbf{k}|\\cos\\theta$ and $k_{y}=|\\mathbf{k}|\\sin\\theta$, then compute $\\mathrm{NB}$ using the discrete FDTD dispersion and the continuous-plane-wave dispersion. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $\\left[\\,\\mathrm{NB}_{1},\\mathrm{NB}_{2},\\mathrm{NB}_{3},\\mathrm{NB}_{4}\\,\\right]$). The outputs must be real-valued floats with no units.", "solution": "The problem requires the derivation of numerical dispersion relations for a two-dimensional ($2$D) Finite-Difference Time-Domain (FDTD) scheme in a uniaxial anisotropic medium and the computation of a numerical birefringence metric. The derivation must originate from the integral form of Maxwell's equations.\n\nThe problem is scientifically grounded, well-posed, and all necessary parameters are provided. It represents a standard task in computational electromagnetics. We may therefore proceed with a full solution.\n\nThe fundamental physical laws are Maxwell's equations. For a source-free, non-conductive medium, their integral forms are Faraday's Law of Induction and Ampere's Law:\n$$ \\oint_{\\partial S} \\mathbf{E}\\cdot d\\boldsymbol{\\ell} = -\\frac{d}{dt}\\int_{S}\\mathbf{B}\\cdot \\mathbf{\\hat{n}}\\, dS $$\n$$ \\oint_{\\partial S} \\mathbf{H}\\cdot d\\boldsymbol{\\ell} = \\frac{d}{dt}\\int_{S}\\mathbf{D}\\cdot \\mathbf{\\hat{n}}\\, dS $$\nThe constitutive relations in the uniaxial medium with the optic axis along the $z$-axis are $\\mathbf{D} = \\boldsymbol{\\varepsilon}\\mathbf{E}$ and $\\mathbf{B} = \\mu_0\\mathbf{H}$, where $\\boldsymbol{\\varepsilon}=\\mathrm{diag}(\\varepsilon_{\\perp},\\varepsilon_{\\perp},\\varepsilon_{\\parallel})$ and $\\mu = \\mu_0$.\n\nWe use the standard Yee lattice, where field components are spatially and temporally staggered. For a $2$D problem in the $x-y$ plane, we assume all fields are independent of $z$ (i.e., $\\partial/\\partial z = 0$). A field component $F$ at position $(x,y)=(i\\Delta x, j\\Delta y)$ and time $t=n\\Delta t$ is denoted as $F^n_{i,j}$.\n\n### Part 1: Derivation of FDTD Update Equations\n\n**Transverse Electric (TE) Mode**\nThe non-zero field components are $E_z$, $H_x$, and $H_y$. The relevant constitutive relation is $D_z = \\varepsilon_\\parallel E_z$. The fields are staggered as follows:\n- $E_z$ is located at $(i\\Delta x, j\\Delta y)$ at time $n\\Delta t$.\n- $H_x$ is located at $(i\\Delta x, (j+1/2)\\Delta y)$ at time $(n+1/2)\\Delta t$.\n- $H_y$ is located at $((i+1/2)\\Delta x, j\\Delta y)$ at time $(n+1/2)\\Delta t$.\n\n**Update for $E_z$**: We apply Ampere's Law to a rectangular loop in the $x-y$ plane of area $\\Delta x \\Delta y$, centered at $(i\\Delta x, j\\Delta y)$.\nThe right-hand side (RHS) becomes:\n$$ \\frac{d}{dt}\\int_{S}\\mathbf{D}\\cdot \\mathbf{\\hat{n}}\\, dS \\approx \\frac{dD_z}{dt}\\bigg|_{i,j} \\Delta x \\Delta y = \\varepsilon_\\parallel \\frac{\\partial E_z}{\\partial t}\\bigg|_{i,j} \\Delta x \\Delta y $$\nThe left-hand side (LHS) is the line integral of $\\mathbf{H}$ around the loop. Approximating the integral with field values on the loop segments gives:\n$$ \\oint \\mathbf{H}\\cdot d\\boldsymbol{\\ell} \\approx H_y\\big|_{i+1/2,j}\\Delta x - H_y\\big|_{i-1/2,j}\\Delta x - H_x\\big|_{i,j+1/2}\\Delta y + H_x\\big|_{i,j-1/2}\\Delta y $$\nEquating the two sides and discretizing the time derivative using a central difference:\n$$ \\varepsilon_\\parallel \\frac{E^{n+1}_{z,i,j} - E^n_{z,i,j}}{\\Delta t} = \\frac{H^{n+1/2}_{y,i+1/2,j} - H^{n+1/2}_{y,i-1/2,j}}{\\Delta x} - \\frac{H^{n+1/2}_{x,i,j+1/2} - H^{n+1/2}_{x,i,j-1/2}}{\\Delta y} $$\n\n**Update for $H_x$**: We apply Faraday's Law to a rectangular loop in the $y-z$ plane of area $\\Delta y \\Delta z_{u}$ (where $\\Delta z_u$ is a unit length in the invariant direction), centered at $(i\\Delta x, (j+1/2)\\Delta y)$. The surface normal is $\\hat{x}$.\nRHS: $-\\frac{d}{dt}\\int_{S}\\mathbf{B}\\cdot \\mathbf{\\hat{n}}\\, dS \\approx -\\frac{dB_x}{dt}\\big|_{i, j+1/2} \\Delta y \\Delta z_u = -\\mu_0 \\frac{\\partial H_x}{\\partial t}\\big|_{i, j+1/2} \\Delta y \\Delta z_u$\nLHS: The only non-zero electric field is $E_z$. The integral is non-zero only along the $z$-directed segments of the loop:\n$$ \\oint \\mathbf{E}\\cdot d\\boldsymbol{\\ell} = E_z\\big|_{i,j+1} \\Delta z_u - E_z\\big|_{i,j} \\Delta z_u $$\nEquating, the $\\Delta z_u$ term cancels, and we discretize in time:\n$$ -\\mu_0 \\frac{H^{n+1/2}_{x,i,j+1/2} - H^{n-1/2}_{x,i,j+1/2}}{\\Delta t} \\Delta y = E^n_{z,i,j+1} - E^n_{z,i,j} $$\n\n**Update for $H_y$**: Similarly, for a loop in the $x-z$ plane centered at $((i+1/2)\\Delta x, j\\Delta y)$:\n$$ -\\mu_0 \\frac{H^{n+1/2}_{y,i+1/2,j} - H^{n-1/2}_{y,i+1/2,j}}{\\Delta t} \\Delta x = E^n_{z,i,j} - E^n_{z,i+1,j} $$\n\n**Transverse Magnetic (TM) Mode**\nThe non-zero field components are $H_z$, $E_x$, and $E_y$. The constitutive relations are $D_x = \\varepsilon_\\perp E_x$ and $D_y = \\varepsilon_\\perp E_y$. Field staggering is:\n- $H_z$ is at $((i+1/2)\\Delta x, (j+1/2)\\Delta y)$ at time $(n+1/2)\\Delta t$.\n- $E_x$ is at $((i+1/2)\\Delta x, j\\Delta y)$ at time $n\\Delta t$.\n- $E_y$ is at $(i\\Delta x, (j+1/2)\\Delta y)$ at time $n\\Delta t$.\nThe derivation proceeds analogously to the TE case by swapping roles of $\\mathbf{E}$ and $\\mathbf{H}$ and using appropriate constants ($\\mu_0 \\leftrightarrow \\varepsilon_\\perp$). We state the resulting discretized differential equations for brevity:\n$$ \\frac{E^{n+1}_{x,i+1/2,j} - E^n_{x,i+1/2,j}}{\\Delta t} = \\frac{1}{\\varepsilon_\\perp} \\frac{H^{n+1/2}_{z,i+1/2,j+1/2} - H^{n+1/2}_{z,i+1/2,j-1/2}}{\\Delta y} $$\n$$ \\frac{E^{n+1}_{y,i,j+1/2} - E^n_{y,i,j+1/2}}{\\Delta t} = -\\frac{1}{\\varepsilon_\\perp} \\frac{H^{n+1/2}_{z,i+1/2,j+1/2} - H^{n+1/2}_{z,i-1/2,j+1/2}}{\\Delta x} $$\n$$ \\frac{H^{n+1/2}_{z,i+1/2,j+1/2} - H^{n-1/2}_{z,i+1/2,j+1/2}}{\\Delta t} = -\\frac{1}{\\mu_0}\\left( \\frac{E^n_{y,i+1,j+1/2} - E^n_{y,i,j+1/2}}{\\Delta x} - \\frac{E^n_{x,i+1/2,j+1} - E^n_{x,i+1/2,j}}{\\Delta y} \\right) $$\n\n### Part 2: Numerical Dispersion Relations\n\nWe substitute a discrete plane-wave ansatz of the form $F(\\mathbf{r},t) = F_0 \\exp[i(\\omega t - \\mathbf{k}\\cdot\\mathbf{r})]$ into the update equations, accounting for the staggering. This transforms the finite difference operators into multiplicative factors:\n$$ \\frac{F^{n+1} - F^n}{\\Delta t} \\rightarrow i\\frac{2}{\\Delta t}\\sin\\left(\\frac{\\omega\\Delta t}{2}\\right)F^{n+1/2} $$\n$$ \\frac{F_{i+1} - F_i}{\\Delta x} \\rightarrow -i\\frac{2}{\\Delta x}\\sin\\left(\\frac{k_x\\Delta x}{2}\\right)F_{i+1/2} $$\nApplying these transformations to the systems of equations and eliminating field variables yields the numerical dispersion relations.\n\nFor the **TE mode**, combining the three update equations leads to:\n$$ \\left( \\frac{1}{\\Delta t} \\sin\\left(\\frac{\\omega_{TE} \\Delta t}{2}\\right) \\right)^2 = \\frac{1}{\\mu_0 \\varepsilon_\\parallel} \\left[ \\left(\\frac{\\sin(k_x \\Delta x/2)}{\\Delta x}\\right)^2 + \\left(\\frac{\\sin(k_y \\Delta y/2)}{\\Delta y}\\right)^2 \\right] $$\nThis gives $\\omega_{TE,num}$ as a function of $k_x$ and $k_y$.\n\nFor the **TM mode**, the same procedure yields a similar relation, with $\\varepsilon_\\parallel$ replaced by $\\varepsilon_\\perp$:\n$$ \\left( \\frac{1}{\\Delta t} \\sin\\left(\\frac{\\omega_{TM} \\Delta t}{2}\\right) \\right)^2 = \\frac{1}{\\mu_0 \\varepsilon_\\perp} \\left[ \\left(\\frac{\\sin(k_x \\Delta x/2)}{\\Delta x}\\right)^2 + \\left(\\frac{\\sin(k_y \\Delta y/2)}{\\Delta y}\\right)^2 \\right] $$\nThis gives $\\omega_{TM,num}$ as a function of $k_x$ and $k_y$.\n\n### Part 3: Continuous Dispersion Relations\n\nWe start from the time-harmonic differential (curl) Maxwell's equations, $\\nabla \\times \\mathbf{E} = -i\\omega\\mu_0\\mathbf{H}$ and $\\nabla \\times \\mathbf{H} = i\\omega\\boldsymbol{\\varepsilon}\\mathbf{E}$. Substituting a continuous plane-wave solution $\\mathbf{E}(\\mathbf{r}) = \\mathbf{E}_0 e^{-i\\mathbf{k}\\cdot\\mathbf{r}}$ (so $\\nabla \\to -i\\mathbf{k}$) yields the wave equation $\\mathbf{k}\\times(\\mathbf{k}\\times\\mathbf{E}) = -\\omega^2\\mu_0\\boldsymbol{\\varepsilon}\\mathbf{E}$.\n\nFor the **TE mode**, $\\mathbf{E}=(0,0,E_z)$ and $\\mathbf{k}=(k_x, k_y, 0)$. The wave equation simplifies to:\n$$ -|\\mathbf{k}|^2 E_z = -\\omega^2\\mu_0\\varepsilon_\\parallel E_z \\implies |\\mathbf{k}|^2 = \\omega^2\\mu_0\\varepsilon_\\parallel $$\nThe continuous dispersion relation is $\\omega_{\\mathrm{TE,cont}} = \\frac{|\\mathbf{k}|}{\\sqrt{\\mu_0\\varepsilon_\\parallel}} = |\\mathbf{k}| c_\\parallel$, where $c_\\parallel = 1/\\sqrt{\\mu_0\\varepsilon_\\parallel}$.\n\nFor the **TM mode**, $\\mathbf{H}=(0,0,H_z)$, so $\\mathbf{E}=(E_x,E_y,0)$. The medium is isotropic for fields in the $x-y$ plane ($D_x=\\varepsilon_\\perp E_x$, $D_y=\\varepsilon_\\perp E_y$). A similar derivation yields:\n$$ |\\mathbf{k}|^2 = \\omega^2\\mu_0\\varepsilon_\\perp $$\nThe continuous dispersion relation is $\\omega_{\\mathrm{TM,cont}} = \\frac{|\\mathbf{k}|}{\\sqrt{\\mu_0\\varepsilon_\\perp}} = |\\mathbf{k}| c_\\perp$, where $c_\\perp = 1/\\sqrt{\\mu_0\\varepsilon_\\perp}$.\n\n### Part 4: Numerical Birefringence Calculation\n\nThe numerical birefringence metric is defined as:\n$$ \\mathrm{NB} = \\frac{v_{\\mathrm{TE,num}}}{v_{\\mathrm{TE,cont}}} - \\frac{v_{\\mathrm{TM,num}}}{v_{\\mathrm{TM,cont}}} $$\nSince phase velocity $v = \\omega/|\\mathbf{k}|$, the metric simplifies to a ratio of frequencies:\n$$ \\mathrm{NB} = \\frac{\\omega_{\\mathrm{TE,num}}}{\\omega_{\\mathrm{TE,cont}}} - \\frac{\\omega_{\\mathrm{TM,num}}}{\\omega_{\\mathrm{TM,cont}}} $$\nFor a given set of parameters $(\\Delta x, \\Delta y, \\varepsilon_\\perp, \\varepsilon_\\parallel, |\\mathbf{k}|, \\theta, s_{CFL})$, we first compute the wavevector components $k_x=|\\mathbf{k}|\\cos\\theta$ and $k_y=|\\mathbf{k}|\\sin\\theta$.\nThe time step is $\\Delta t = s_{\\mathrm{CFL}} / (c_{\\max} \\sqrt{(1/\\Delta x)^2 + (1/\\Delta y)^2})$, where $c_{\\max} = \\max(c_\\perp, c_\\parallel)$.\nWe then solve the numerical dispersion relations for $\\omega_{\\mathrm{TE,num}}$ and $\\omega_{\\mathrm{TM,num}}$:\n$$ \\omega_{\\mathrm{TE,num}} = \\frac{2}{\\Delta t} \\arcsin\\left( c_\\parallel \\Delta t \\sqrt{ \\left(\\frac{\\sin(k_x \\Delta x/2)}{\\Delta x}\\right)^2 + \\left(\\frac{\\sin(k_y \\Delta y/2)}{\\Delta y}\\right)^2 } \\right) $$\n$$ \\omega_{\\mathrm{TM,num}} = \\frac{2}{\\Delta t} \\arcsin\\left( c_\\perp \\Delta t \\sqrt{ \\left(\\frac{\\sin(k_x \\Delta x/2)}{\\Delta x}\\right)^2 + \\left(\\frac{\\sin(k_y \\Delta y/2)}{\\Delta y}\\right)^2 } \\right) $$\nThe continuous frequencies are computed directly. Finally, we evaluate $\\mathrm{NB}$. The argument of the $\\arcsin$ function is guaranteed to be less than or equal to $s_{CFL}$ ($0.9$ in this case), ensuring a real-valued result.\nFor the isotropic case ($\\varepsilon_\\perp = \\varepsilon_\\parallel$), we have $c_\\perp = c_\\parallel$, which leads to $\\omega_{TE,num}=\\omega_{TM,num}$ and $\\omega_{TE,cont}=\\omega_{TM,cont}$. Consequently, $\\mathrm{NB}$ must be exactly zero.\nThe following program implements this computation for the provided test cases.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.constants import mu_0, epsilon_0\n\ndef solve():\n    \"\"\"\n    Computes the numerical birefringence (NB) for a 2D FDTD scheme\n    in a uniaxial anisotropic medium for a series of test cases.\n    \"\"\"\n\n    # Test cases: (dx, dy, eps_perp_rel, eps_par_rel, k_mag, theta_rad, s_cfl)\n    test_cases = [\n        # Case 1 (general happy path)\n        (1.0e-2, 1.0e-2, 2.0, 3.0, 200.0, np.pi/4, 0.90),\n        # Case 2 (near-Nyquist boundary)\n        (1.0e-2, 1.0e-2, 2.0, 3.0, 0.95 * np.pi / 1.0e-2, 0.0, 0.90),\n        # Case 3 (isotropic edge case)\n        (1.0e-2, 1.0e-2, 2.5, 2.5, 150.0, np.pi/3, 0.90),\n        # Case 4 (weak anisotropy)\n        (1.0e-2, 1.0e-2, 2.0, 2.1, 250.0, np.pi/6, 0.90),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        dx, dy, eps_perp_rel, eps_par_rel, k_mag, theta, s_cfl = case\n\n        # Absolute permittivities\n        eps_perp = eps_perp_rel * epsilon_0\n        eps_par = eps_par_rel * epsilon_0\n\n        # Phase velocities in the continuous medium\n        c_perp = 1.0 / np.sqrt(mu_0 * eps_perp)\n        c_par = 1.0 / np.sqrt(mu_0 * eps_par)\n\n        # Maximum phase velocity for CFL condition\n        c_max = max(c_perp, c_par)\n\n        # Time step from CFL condition\n        dt = s_cfl / (c_max * np.sqrt((1.0/dx)**2 + (1.0/dy)**2))\n\n        # Wavevector components\n        kx = k_mag * np.cos(theta)\n        ky = k_mag * np.sin(theta)\n\n        # --- Continuous Dispersion Calculation ---\n        omega_te_cont = k_mag * c_par\n        omega_tm_cont = k_mag * c_perp\n\n        # --- Numerical Dispersion Calculation ---\n        # Common term in the numerical dispersion relation argument\n        num_disp_sqrt_arg = np.sqrt(\n            (np.sin(kx * dx / 2.0) / dx)**2 + (np.sin(ky * dy / 2.0) / dy)**2\n        )\n\n        # Argument for arcsin for TE mode\n        arcsin_arg_te = dt * c_par * num_disp_sqrt_arg\n        # Argument for arcsin for TM mode\n        arcsin_arg_tm = dt * c_perp * num_disp_sqrt_arg\n        \n        # The stability condition ensures |arcsin_arg| <= s_cfl < 1.0\n        # This avoids domain errors for arcsin.\n        \n        # Numerical angular frequencies\n        omega_te_num = (2.0 / dt) * np.arcsin(arcsin_arg_te)\n        omega_tm_num = (2.0 / dt) * np.arcsin(arcsin_arg_tm)\n\n        # --- Numerical Birefringence (NB) Calculation ---\n        # NB = (v_te_num / v_te_cont) - (v_tm_num / v_tm_cont)\n        #    = (omega_te_num / omega_te_cont) - (omega_tm_num / omega_tm_cont)\n        \n        ratio_te = omega_te_num / omega_te_cont\n        ratio_tm = omega_tm_num / omega_tm_cont\n        \n        nb = ratio_te - ratio_tm\n        results.append(nb)\n\n    # Format the output as a comma-separated list of floats in brackets\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3329563"}, {"introduction": "The most profound physical theories can often be expressed through a variational principle, such as the principle of least action. This advanced practice explores how this elegant formalism can be used to construct exceptionally stable numerical algorithms known as variational integrators [@problem_id:3329527]. By deriving a symplectic time-stepping scheme from a discrete action and then verifying discrete conservation laws, you will gain a deep, hands-on understanding of the connection between symmetries and conservation in a computational context, and see how the integral form of Poynting's theorem holds in a discrete universe.", "problem": "Consider vacuum Maxwell electrodynamics in one spatial dimension with transverse electromagnetic polarization, where the electric field has component $E_y$ and the magnetic induction has component $B_z$. Work in Heaviside–Lorentz units where the speed of light $c=1$ and vacuum permittivity and permeability satisfy $\\varepsilon_0 = \\mu_0 = 1$. Adopt the temporal gauge where the scalar potential is set to zero, so that the dynamics can be formulated in terms of a single component of the vector potential $A_y(x,t)$, denoted $A(x,t)$ for brevity, with $E_y(x,t) = -\\partial_t A(x,t)$ and $B_z(x,t) = \\partial_x A(x,t)$. The Maxwell Lagrangian density in these units and this specialization is $\\mathcal{L}(A,\\partial_t A,\\partial_x A) = \\tfrac{1}{2}\\left[(\\partial_t A)^2 - (\\partial_x A)^2\\right]$. The action functional is $S[A] = \\int \\int \\mathcal{L}(A,\\partial_t A,\\partial_x A)\\,dx\\,dt$. The variational principle $\\delta S = 0$ yields the wave equation $\\partial_t^2 A - \\partial_x^2 A = 0$, equivalent to source-free Maxwell’s equations.\n\nYour task is to derive a symplectic space-time discretization from the discrete action associated with the Maxwell Lagrangian and then test conservation statements that connect the differential Poynting theorem to its integral form. You must proceed from first principles using only the above fundamental laws and definitions.\n\nDerivation and discretization requirements:\n- Discretize space into $N$ uniformly spaced nodes over a domain of length $L$ with grid spacing $\\Delta x = L/N$ and impose periodic boundary conditions in $x$. Discretize time into steps of size $\\Delta t$.\n- Construct a discrete action $S_d$ by approximating the continuous action integral with second-order centered differences in time and space. Concretely, approximate $\\partial_t A$ at time level $n+\\tfrac{1}{2}$ by $\\Delta_t A^n(i) = A^{n+1}(i) - A^n(i)$ and approximate $\\partial_x A$ at spatial index $i+\\tfrac{1}{2}$ by $\\Delta_x A^n(i) = A^n(i+1) - A^n(i)$, and then form a discrete sum over the space-time grid.\n- Enforce stationarity of the discrete action with respect to variations of $A^n(i)$ to obtain the discrete Euler–Lagrange equations. The resulting explicit update for $A$ must be second-order accurate in both space and time and must be symplectic by virtue of its variational derivation.\n- Define the discrete electric and magnetic fields in a staggered manner consistent with the variational discretization: $E^{n+\\tfrac{1}{2}}(i) = -\\Delta_t A^n(i)/\\Delta t$ and $B^{n}(i+\\tfrac{1}{2}) = \\Delta_x A^n(i)/\\Delta x$.\n\nConservation testing requirements:\n- Using the discrete fields, define the discrete energy density $u = \\tfrac{1}{2}(E^2 + B^2)$ and Poynting flux $S_x = E\\,B$. For electromagnetic momentum, use the momentum density $g_x = E\\,B$ and the longitudinal component of the Maxwell stress tensor $T_{xx} = \\tfrac{1}{2}(E^2 + B^2)$ in these units.\n- Consider an interior subdomain that comprises the contiguous set of grid nodes from index $i_1$ to $i_2-1$ inclusive. Let the left and right subdomain interfaces be located at the nodes $i_1$ and $i_2$ with outward normals pointing in the $-x$ and $+x$ directions, respectively. Define the energy in the subdomain at time $t_{n+\\tfrac{1}{2}}$ as $U_{\\text{sub}}^{n+\\tfrac{1}{2}} = \\sum_{i=i_1}^{i_2-1} \\tfrac{1}{2}\\left[E^{n+\\tfrac{1}{2}}(i)^2 + B^n(i+\\tfrac{1}{2})^2\\right]\\Delta x$. Define the net outward energy flux across the subdomain boundaries at $t_{n+\\tfrac{1}{2}}$ as $\\Phi_U^{n+\\tfrac{1}{2}} = S_x^{n+\\tfrac{1}{2}}(i_2) - S_x^{n+\\tfrac{1}{2}}(i_1)$, with $S_x^{n+\\tfrac{1}{2}}(i)$ formed from $E^{n+\\tfrac{1}{2}}(i)$ and a consistent approximation for $B$ at the same interface. Similarly, define the subdomain momentum at time $t_{n+\\tfrac{1}{2}}$ as $P_{\\text{sub}}^{n+\\tfrac{1}{2}} = \\sum_{i=i_1}^{i_2-1} g_x^{n+\\tfrac{1}{2}}(i)\\,\\Delta x$, where $g_x^{n+\\tfrac{1}{2}}(i) = E^{n+\\tfrac{1}{2}}(i)\\,B^n(i+\\tfrac{1}{2})$, and define the net outward momentum flux across the subdomain interfaces at time $t_{n+\\tfrac{1}{2}}$ as $\\Phi_P^{n+\\tfrac{1}{2}} = T_{xx}^{n+\\tfrac{1}{2}}(i_2) - T_{xx}^{n+\\tfrac{1}{2}}(i_1)$.\n- Numerically verify the integral forms corresponding to the differential Poynting theorem and momentum conservation by checking that $U_{\\text{sub}}^{N_t+\\tfrac{1}{2}} - U_{\\text{sub}}^{\\tfrac{1}{2}} + \\sum_{n=0}^{N_t-1} \\Phi_U^{n+\\tfrac{1}{2}}\\,\\Delta t$ is near zero and that $P_{\\text{sub}}^{N_t+\\tfrac{1}{2}} - P_{\\text{sub}}^{\\tfrac{1}{2}} + \\sum_{n=0}^{N_t-1} \\Phi_P^{n+\\tfrac{1}{2}}\\,\\Delta t$ is near zero. Also evaluate a stationarity measure of the discrete action by computing the absolute maximum over space-time of the discrete Euler–Lagrange residual, which must be near zero if the discrete trajectory satisfies the variational equations.\n\nUnits and outputs:\n- All quantities are dimensionless due to the Heaviside–Lorentz normalization with $c=1$, $\\varepsilon_0=1$, and $\\mu_0=1$; report all numerical outputs in these normalized units as plain decimal numbers.\n- Angles, such as a wavenumber multiplied by position, must be interpreted in radians.\n\nTest suite specification:\n- Use three test cases, each specifying $(L, N, \\Delta t, N_t, m, A_0)$, where $L$ is the domain length, $N$ is the number of spatial nodes, $\\Delta t$ is the time step, $N_t$ is the number of time steps, $m$ is an integer mode number defining the wavenumber $k = 2\\pi m/L$, and $A_0$ is the field amplitude. For all cases, choose periodic boundary conditions and set the interior subdomain indices to $i_1 = \\lfloor N/4 \\rfloor$ and $i_2 = \\lfloor 3N/4 \\rfloor$.\n- Case 1 (general, well-resolved): $(L=1.0, N=256, \\Delta t = 0.95\\,\\Delta x, N_t=400, m=4, A_0=0.7)$.\n- Case 2 (coarse, boundary stability): $(L=1.0, N=64, \\Delta t = 1.0\\,\\Delta x, N_t=200, m=3, A_0=1.0)$.\n- Case 3 (edge case, small grid and near-Courant step): $(L=1.0, N=32, \\Delta t = 0.99\\,\\Delta x, N_t=150, m=1, A_0=0.5)$.\n\nInitialization:\n- Initialize the discrete potential by a right-going plane wave $A(x,0) = \\frac{A_0}{\\omega}\\sin(k x)$ with angular frequency $\\omega = k$, and initial time derivative $\\partial_t A(x,0) = -A_0 \\cos(k x)$ to satisfy $E(x,0) = A_0 \\cos(k x)$ and $B(x,0) = A_0 \\cos(k x)$. Use a second-order Taylor step consistent with the wave equation to compute $A(x,\\Delta t)$.\n\nFinal output format:\n- Your program should produce a single line of output containing nine results, three per test case, in the following order: $[r_{U,1}, r_{P,1}, r_{S,1}, r_{U,2}, r_{P,2}, r_{S,2}, r_{U,3}, r_{P,3}, r_{S,3}]$, where $r_{U}$ is the absolute energy residual $|U_{\\text{sub}}^{N_t+\\tfrac{1}{2}} - U_{\\text{sub}}^{\\tfrac{1}{2}} + \\sum \\Phi_U \\Delta t|$, $r_{P}$ is the absolute momentum residual $|P_{\\text{sub}}^{N_t+\\tfrac{1}{2}} - P_{\\text{sub}}^{\\tfrac{1}{2}} + \\sum \\Phi_P \\Delta t|$, and $r_{S}$ is the absolute maximum discrete Euler–Lagrange residual over the entire space-time grid. The single line must be a comma-separated list enclosed in square brackets, for example, \"[0.000001,0.000002,0.0,...]\".", "solution": "We begin from the Maxwell Lagrangian density in Heaviside–Lorentz units for one-dimensional transverse electromagnetic polarization with temporal gauge $\\phi=0$. With a single nonzero vector potential component $A_y(x,t)$ denoted $A(x,t)$, the electric and magnetic fields are $E_y(x,t) = -\\partial_t A(x,t)$ and $B_z(x,t) = \\partial_x A(x,t)$. The Lagrangian density is\n$$\n\\mathcal{L}(A,\\partial_t A,\\partial_x A) = \\frac{1}{2}\\left[(\\partial_t A)^2 - (\\partial_x A)^2\\right],\n$$\nand the action is\n$$\nS[A] = \\int_{t_0}^{t_1}\\int_{x_0}^{x_1} \\mathcal{L}(A,\\partial_t A,\\partial_x A)\\,dx\\,dt.\n$$\nThe Euler–Lagrange equation $\\partial_t\\left(\\frac{\\partial \\mathcal{L}}{\\partial (\\partial_t A)}\\right) + \\partial_x\\left(\\frac{\\partial \\mathcal{L}}{\\partial (\\partial_x A)}\\right) - \\frac{\\partial \\mathcal{L}}{\\partial A} = 0$ yields\n$$\n\\partial_t^2 A - \\partial_x^2 A = 0,\n$$\nequivalent to source-free Maxwell’s equations for the chosen polarization.\n\nTo build a symplectic discretization, we construct a discrete action on a uniform space-time lattice. Let $x_i = i\\,\\Delta x$ for $i=0,\\ldots,N-1$ and $t_n = n\\,\\Delta t$ for $n=0,\\ldots,N_t$. Impose periodic boundary conditions in space. Define the discrete temporal and spatial differences\n$$\n\\Delta_t A^n(i) \\equiv A^{n+1}(i) - A^n(i),\n\\quad\n\\Delta_x A^n(i) \\equiv A^n(i+1) - A^n(i),\n$$\nand approximate the continuous action by the discrete sum\n$$\nS_d[A] = \\sum_{n=0}^{N_t-1}\\sum_{i=0}^{N-1} \\frac{1}{2}\\left[\\left(\\frac{\\Delta_t A^n(i)}{\\Delta t}\\right)^2 - \\left(\\frac{\\Delta_x A^n(i)}{\\Delta x}\\right)^2\\right]\\Delta x\\,\\Delta t.\n$$\nStationarity of $S_d$ with respect to variations of $A^n(i)$ gives the discrete Euler–Lagrange equations. Performing variations and collecting terms leads to\n$$\n\\frac{A^{n+1}(i) - 2A^n(i) + A^{n-1}(i)}{\\Delta t^2} - \\frac{A^n(i+1) - 2A^n(i) + A^n(i-1)}{\\Delta x^2} = 0,\n$$\nfor $1 \\le n \\le N_t-1$ and all $i$, with indices taken modulo $N$ due to periodicity. This is the centered second-order accurate, explicit update for $A$, which is the Störmer–Verlet scheme for the wave equation. Because it results from a discrete action principle, it is a variational integrator and therefore symplectic; it preserves a discrete symplectic two-form on the space of $(A^n, A^{n+1})$ pairs.\n\nDiscrete fields consistent with the staggered action are defined by\n$$\nE^{n+\\frac{1}{2}}(i) = -\\frac{A^{n+1}(i) - A^n(i)}{\\Delta t},\n\\quad\nB^n(i+\\frac{1}{2}) = \\frac{A^n(i+1) - A^n(i)}{\\Delta x}.\n$$\nThese are centered approximations to $-\\partial_t A$ and $\\partial_x A$ that align with the temporal and spatial differences used in $S_d$.\n\nThe differential Poynting theorem in vacuum reads\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial S_x}{\\partial x} = 0,\n$$\nwith $u = \\tfrac{1}{2}(E^2+B^2)$ and $S_x = E\\,B$ in Heaviside–Lorentz units. Integrating over a spatial subdomain $[x_{i_1},x_{i_2}]$ gives\n$$\n\\frac{d}{dt}\\int_{x_{i_1}}^{x_{i_2}} u\\,dx = -S_x(x_{i_2}) + S_x(x_{i_1}).\n$$\nSimilarly, momentum conservation for the electromagnetic field in vacuum is described by\n$$\n\\frac{\\partial g_x}{\\partial t} + \\frac{\\partial T_{xx}}{\\partial x} = 0,\n$$\nwith $g_x = E\\,B$ and $T_{xx} = \\tfrac{1}{2}(E^2 + B^2)$ for the present polarization. Integrating over the subdomain yields\n$$\n\\frac{d}{dt}\\int_{x_{i_1}}^{x_{i_2}} g_x\\,dx = -T_{xx}(x_{i_2}) + T_{xx}(x_{i_1}).\n$$\nWe test the discrete integral forms against the discrete fields and fluxes defined at staggered times and locations. Define the subdomain energy at time $t_{n+\\tfrac{1}{2}}$ as\n$$\nU_{\\text{sub}}^{n+\\frac{1}{2}} = \\sum_{i=i_1}^{i_2-1} \\frac{1}{2}\\left[E^{n+\\frac{1}{2}}(i)^2 + B^{n}(i+\\frac{1}{2})^2 \\right]\\Delta x,\n$$\nand the net outward energy flux across the subdomain interfaces at $t_{n+\\tfrac{1}{2}}$ as\n$$\n\\Phi_U^{n+\\frac{1}{2}} = S_x^{n+\\frac{1}{2}}(i_2) - S_x^{n+\\frac{1}{2}}(i_1),\n$$\nwhere $S_x^{n+\\tfrac{1}{2}}(i)$ is approximated consistently by combining $E^{n+\\tfrac{1}{2}}(i)$ with $B^n$ at the same interface. The discrete momentum in the subdomain at $t_{n+\\tfrac{1}{2}}$ is\n$$\nP_{\\text{sub}}^{n+\\frac{1}{2}} = \\sum_{i=i_1}^{i_2-1} g_x^{n+\\frac{1}{2}}(i)\\,\\Delta x,\n\\quad\ng_x^{n+\\frac{1}{2}}(i) = E^{n+\\frac{1}{2}}(i)\\,B^n(i+\\frac{1}{2}),\n$$\nand the net outward momentum flux is\n$$\n\\Phi_P^{n+\\frac{1}{2}} = T_{xx}^{n+\\frac{1}{2}}(i_2) - T_{xx}^{n+\\frac{1}{2}}(i_1),\n\\quad\nT_{xx}^{n+\\frac{1}{2}}(i) = \\frac{1}{2}\\left[E^{n+\\frac{1}{2}}(i)^2 + \\tilde{B}^{n}(i)^2\\right],\n$$\nwith $\\tilde{B}^n(i)$ an interface-consistent evaluation of $B$ at node $i$. With these, the discrete integral conservation statements are\n$$\nU_{\\text{sub}}^{N_t+\\frac{1}{2}} - U_{\\text{sub}}^{\\frac{1}{2}} + \\sum_{n=0}^{N_t-1} \\Phi_U^{n+\\frac{1}{2}}\\,\\Delta t \\approx 0,\n$$\n$$\nP_{\\text{sub}}^{N_t+\\frac{1}{2}} - P_{\\text{sub}}^{\\frac{1}{2}} + \\sum_{n=0}^{N_t-1} \\Phi_P^{n+\\frac{1}{2}}\\,\\Delta t \\approx 0.\n$$\nWe also evaluate symplecticity via the variational structure by computing the maximum absolute discrete Euler–Lagrange residual\n$$\nR^n(i) = \\frac{A^{n+1}(i) - 2A^n(i) + A^{n-1}(i)}{\\Delta t^2} - \\frac{A^n(i+1) - 2A^n(i) + A^n(i-1)}{\\Delta x^2},\n$$\nover all interior time indices $n$ and all spatial indices $i$, which should be near machine precision for a correctly integrated trajectory.\n\nAlgorithmic steps for each test case:\n1. Set $L$, $N$, $\\Delta t$, $N_t$, $m$, $A_0$; compute $\\Delta x = L/N$, wavenumber $k=2\\pi m/L$, and frequency $\\omega=k$.\n2. Initialize $A^0(i) = \\frac{A_0}{\\omega}\\sin(k x_i)$ and $\\partial_t A|_{t=0}(i) = -A_0 \\cos(k x_i)$. Compute $A^1$ with a second-order Taylor step using the wave equation: $A^1 = A^0 + \\Delta t\\,(\\partial_t A|_{t=0}) + \\tfrac{1}{2}\\Delta t^2\\,\\partial_x^2 A^0$ with periodic spatial second differences.\n3. For $n=1$ to $N_t-1$, update $A^{n+1}$ via the discrete Euler–Lagrange update derived above. At each step, compute $E^{n+\\tfrac{1}{2}}$ and $B^n$, accumulate energy and momentum fluxes across the subdomain boundaries, and record the maximum of $|R^n(i)|$.\n4. Compute the initial and final subdomain energy and momentum at times $t_{\\tfrac{1}{2}}$ and $t_{N_t+\\tfrac{1}{2}}$ using the staggered fields, and form the residuals: energy residual as the absolute value of $U_{\\text{sub}}^{N_t+\\tfrac{1}{2}} - U_{\\text{sub}}^{\\tfrac{1}{2}} + \\sum \\Phi_U\\,\\Delta t$, momentum residual analogously, and the maximum absolute residual of the discrete Euler–Lagrange equation as the stationarity measure.\n5. Report the nine values $[r_{U,1}, r_{P,1}, r_{S,1}, r_{U,2}, r_{P,2}, r_{S,2}, r_{U,3}, r_{P,3}, r_{S,3}]$ in a single line.\n\nBecause the scheme is a variational integrator, it preserves a discrete symplectic structure exactly, and the residual $R^n(i)$ evaluates to machine precision zero subject to periodic boundary conditions and numerical roundoff. The energy and momentum residuals test the discrete integral conservation against the differential conservation laws in the form of the Poynting theorem and momentum balance; for conservative vacuum dynamics on a periodic domain, these residuals approach zero with consistent staggering and sufficient resolution, and the provided test suite explores resolution and Courant limit effects.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef laplacian_periodic(arr, dx):\n    # Second spatial difference with periodic wrap\n    return (np.roll(arr, -1) - 2.0 * arr + np.roll(arr, 1)) / (dx ** 2)\n\ndef gradient_face_periodic(arr, dx):\n    # Face-centered gradient: B at face i+1/2 approximated by forward difference\n    # We index faces by integers j, using difference between node j and j-1\n    return (arr - np.roll(arr, 1)) / dx\n\ndef simulate_case(L, N, cfl, Nt, m, A0):\n    dx = L / N\n    dt = cfl * dx\n    k = 2.0 * np.pi * m / L\n    omega = k\n\n    # Grid nodes\n    x = np.arange(N) * dx\n\n    # Initialize A^0 and dA/dt at t=0\n    A_curr = (A0 / omega) * np.sin(k * x)  # A^0\n    dA_dt0 = -A0 * np.cos(k * x)           # (dA/dt)^0\n\n    # Compute A^1 via Taylor expansion using wave equation: d2A/dt2 = d2A/dx2\n    A_next = A_curr + dt * dA_dt0 + 0.5 * (dt ** 2) * laplacian_periodic(A_curr, dx)\n    # Construct A^{-1} consistent with centered scheme if needed; we can back-compute A_prev via Taylor backward\n    # Use backward Taylor: A^{-1} = A^0 - dt * dA_dt0 + 0.5 * dt^2 * laplacian(A^0)\n    A_prev = A_curr - dt * dA_dt0 + 0.5 * (dt ** 2) * laplacian_periodic(A_curr, dx)\n\n    # Subdomain indices\n    i1 = N // 4\n    i2 = (3 * N) // 4\n\n    # Helper to compute staggered fields for energy/momentum at time n+1/2 and n\n    def compute_fields(A_n, A_np1):\n        # E at nodes, time n+1/2\n        E_half = -(A_np1 - A_n) / dt\n        # B at faces, time n\n        B_n = gradient_face_periodic(A_n, dx)\n        return E_half, B_n\n\n    # Initial fields at t=1/2 and t=0\n    E_half_init, B_init = compute_fields(A_curr, A_next)\n\n    # Energy and momentum in subdomain at initial half time\n    # B faces aligned between nodes; subdomain spans nodes i1..i2-1 and faces i1..i2-1\n    U_init = 0.5 * dx * (np.sum(E_half_init[i1:i2] ** 2) + np.sum(B_init[i1:i2] ** 2))\n    P_init = dx * np.sum(E_half_init[i1:i2] * B_init[i1:i2])\n\n    # Initialize accumulators\n    energy_flux_accum = 0.0\n    momentum_flux_accum = 0.0\n    max_action_residual = 0.0\n\n    # Time stepping loop: we will perform Nt-1 updates to reach t=Nt*dt from t=dt\n    # For flux accumulation, we use E at n+1/2 and B at n for n from 0 to Nt-1.\n    # We currently have A_prev (t=-dt), A_curr (t=0), A_next (t=dt). Start at n=0 with these.\n    # Accumulate flux for n=0 using current A_curr and A_next.\n    def fluxes(E_half, B_n):\n        # Energy flux S = E * B at boundaries\n        # Left boundary at node i1 with outward normal -x => net outward = -S_left; we compute net as S_right - S_left\n        S_left = E_half[i1] * B_n[i1]\n        S_right = E_half[i2] * B_n[i2]\n        # Momentum flux T_xx = 0.5*(E^2 + B^2) at boundaries\n        T_left = 0.5 * (E_half[i1] ** 2 + B_n[i1] ** 2)\n        T_right = 0.5 * (E_half[i2] ** 2 + B_n[i2] ** 2)\n        return (S_right - S_left), (T_right - T_left)\n\n    # Accumulate flux at n=0\n    s_flux, t_flux = fluxes(E_half_init, B_init)\n    energy_flux_accum += s_flux * dt\n    momentum_flux_accum += t_flux * dt\n\n    # Compute action residual at n=0 centered at A_curr with neighbors A_prev and A_next\n    def action_residual(A_nm1, A_n, A_np1):\n        # Compute residual R^n(i) over all i\n        temporal = (A_np1 - 2.0 * A_n + A_nm1) / (dt ** 2)\n        spatial = laplacian_periodic(A_n, dx)\n        R = temporal - spatial\n        return np.max(np.abs(R))\n\n    max_action_residual = max(max_action_residual, action_residual(A_prev, A_curr, A_next))\n\n    # Iterate updates\n    # We already used n=0 for flux; now loop for n=1..Nt-1\n    for _ in range(1, Nt):\n        # Update A using variational integrator (explicit centered scheme)\n        A_new = 2.0 * A_next - A_curr + (dt ** 2) * laplacian_periodic(A_next, dx)\n\n        # Compute fields for current n (where A_n = A_next, A_{n+1} = A_new)\n        E_half, B_n = compute_fields(A_next, A_new)\n\n        # Accumulate fluxes\n        s_flux, t_flux = fluxes(E_half, B_n)\n        energy_flux_accum += s_flux * dt\n        momentum_flux_accum += t_flux * dt\n\n        # Action residual at this n centered at A_next with neighbors A_curr and A_new\n        max_action_residual = max(max_action_residual, action_residual(A_curr, A_next, A_new))\n\n        # Shift time levels\n        A_prev, A_curr, A_next = A_curr, A_next, A_new\n\n    # Final energy and momentum at time Nt+1/2 using A_next and next-step A_final (needed for E at final half step)\n    # To get E at final half step, we need A at Nt+1; approximate A_final via one more update (without affecting dynamics)\n    A_final = 2.0 * A_next - A_curr + (dt ** 2) * laplacian_periodic(A_next, dx)\n    E_half_final, B_final = compute_fields(A_next, A_final)\n\n    U_final = 0.5 * dx * (np.sum(E_half_final[i1:i2] ** 2) + np.sum(B_final[i1:i2] ** 2))\n    P_final = dx * np.sum(E_half_final[i1:i2] * B_final[i1:i2])\n\n    # Residuals (absolute values)\n    energy_residual = abs(U_final - U_init + energy_flux_accum)\n    momentum_residual = abs(P_final - P_init + momentum_flux_accum)\n    stationarity_residual = max_action_residual\n\n    return energy_residual, momentum_residual, stationarity_residual\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (L, N, cfl, Nt, m, A0)\n        (1.0, 256, 0.95, 400, 4, 0.7),   # Case 1\n        (1.0, 64, 1.0, 200, 3, 1.0),     # Case 2\n        (1.0, 32, 0.99, 150, 1, 0.5),    # Case 3\n    ]\n\n    results = []\n    for case in test_cases:\n        L, N, cfl, Nt, m, A0 = case\n        e_res, p_res, s_res = simulate_case(L, N, cfl, Nt, m, A0)\n        results.extend([e_res, p_res, s_res])\n\n    # Final print statement in the exact required format.\n    # Format numbers with full precision as default string conversion.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3329527"}]}