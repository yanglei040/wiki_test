{"hands_on_practices": [{"introduction": "Understanding the origin of discrete modes and their cutoff frequencies is fundamental to all of waveguide analysis. This practice guides you through the first-principles derivation of TE and TM modes in a circular waveguide, starting from Maxwell's equations. By applying boundary conditions to the general solutions of the Helmholtz equation, you will derive the characteristic equations and identify the fundamental mode, culminating in a numerical calculation of its cutoff frequency [@problem_id:3360771].", "problem": "A perfectly electrically conducting (PEC) circular waveguide of radius $a=1.50\\,\\mathrm{cm}$ is completely filled with a homogeneous, isotropic, lossless medium of relative permittivity $\\varepsilon_{r}=2.25$ and relative permeability $\\mu_{r}=1$. Assume time-harmonic fields with angular frequency $\\omega$ and an $e^{-j\\beta z}$ longitudinal dependence along the guide axis. Starting from the source-free Maxwell equations and the PEC boundary condition that the tangential electric field vanishes at the wall, perform the following steps without invoking any pre-quoted dispersion or cutoff formulas:\n\n- Formulate the eigenvalue problem for the longitudinal field components in cylindrical coordinates, identify the governing differential equation, and impose regularity at the axis to select admissible radial solutions.\n- Enforce the PEC boundary condition at $\\rho=a$ to obtain the characteristic equations that determine the admissible transverse wavenumbers for the transverse-magnetic (TM) and transverse-electric (TE) families.\n- From these characteristic equations, determine which family and azimuthal index correspond to the fundamental (lowest-cutoff) mode in a circular waveguide, and then numerically evaluate the cutoff frequency of that fundamental mode for the given $a$, $\\varepsilon_{r}$, and $\\mu_{r}$.\n\nUse $c=2.99792458\\times 10^{8}\\,\\mathrm{m/s}$ for the speed of light in vacuum. Round your final numerical answer to four significant figures and express it in $\\mathrm{GHz}$. Your final answer must be only the numerical value.", "solution": "The analysis begins with the source-free, time-harmonic Maxwell's equations in a linear, isotropic, homogeneous medium characterized by permittivity $\\varepsilon = \\varepsilon_0\\varepsilon_r$ and permeability $\\mu = \\mu_0\\mu_r$. Assuming a time dependence of $e^{j\\omega t}$, these equations are:\n$$ \\nabla \\times \\mathbf{E} = -j\\omega\\mu\\mathbf{H} $$\n$$ \\nabla \\times \\mathbf{H} = j\\omega\\varepsilon\\mathbf{E} $$\nThe problem specifies a longitudinal field dependence of $e^{-j\\beta z}$ along the waveguide axis, which implies that the operator $\\frac{\\partial}{\\partial z}$ can be replaced by $-j\\beta$. The fields can be decomposed into transverse ($\\mathbf{E}_t, \\mathbf{H}_t$) and longitudinal ($E_z, H_z$) components: $\\mathbf{E} = \\mathbf{E}_t + E_z\\hat{\\mathbf{z}}$ and $\\mathbf{H} = \\mathbf{H}_t + H_z\\hat{\\mathbf{z}}$. The curl operator is likewise decomposed as $\\nabla = \\nabla_t - j\\beta\\hat{\\mathbf{z}}$.\n\nSubstituting these into Maxwell's equations and separating the transverse and longitudinal components allows the transverse fields to be expressed in terms of the longitudinal fields:\n$$ \\mathbf{E}_t = -\\frac{j}{k_c^2} \\left( \\beta \\nabla_t E_z - \\omega\\mu (\\hat{\\mathbf{z}} \\times \\nabla_t H_z) \\right) $$\n$$ \\mathbf{H}_t = -\\frac{j}{k_c^2} \\left( \\beta \\nabla_t H_z + \\omega\\varepsilon (\\hat{\\mathbf{z}} \\times \\nabla_t E_z) \\right) $$\nwhere $k_c^2 = \\omega^2\\mu\\varepsilon - \\beta^2$ is the square of the transverse wavenumber. The longitudinal components $E_z$ and $H_z$ are found to satisfy the two-dimensional scalar Helmholtz equation:\n$$ (\\nabla_t^2 + k_c^2)E_z = 0 $$\n$$ (\\nabla_t^2 + k_c^2)H_z = 0 $$\nThis constitutes the eigenvalue problem for the longitudinal field components, where $k_c^2$ is the eigenvalue and the longitudinal fields are the eigenfunctions. In cylindrical coordinates $(\\rho, \\phi, z)$, the transverse Laplacian is $\\nabla_t^2 = \\frac{1}{\\rho}\\frac{\\partial}{\\partial\\rho}(\\rho\\frac{\\partial}{\\partial\\rho}) + \\frac{1}{\\rho^2}\\frac{\\partial^2}{\\partial\\phi^2}$. For a general longitudinal field component $\\Psi(\\rho, \\phi)$, the governing differential equation is:\n$$ \\frac{1}{\\rho}\\frac{\\partial}{\\partial\\rho}\\left(\\rho\\frac{\\partial \\Psi}{\\partial\\rho}\\right) + \\frac{1}{\\rho^2}\\frac{\\partial^2 \\Psi}{\\partial\\phi^2} + k_c^2\\Psi = 0 $$\nUsing the method of separation of variables, we let $\\Psi(\\rho, \\phi) = R(\\rho)\\Phi(\\phi)$. This leads to two ordinary differential equations:\n$$ \\frac{d^2\\Phi}{d\\phi^2} + n^2\\Phi = 0 $$\n$$ \\rho^2\\frac{d^2 R}{d\\rho^2} + \\rho\\frac{dR}{d\\rho} + (k_c^2\\rho^2 - n^2)R = 0 $$\nThe constant $n^2$ arises from the separation. For the fields to be single-valued in $\\phi$, $n$ must be an integer, $n=0, 1, 2, \\dots$. The solution for $\\Phi(\\phi)$ is a linear combination of $\\cos(n\\phi)$ and $\\sin(n\\phi)$. The radial equation is Bessel's equation. Its general solution is a linear combination of the Bessel function of the first kind, $J_n(k_c\\rho)$, and the Bessel function of the second kind, $Y_n(k_c\\rho)$.\nTo impose regularity at the axis ($\\rho=0$), we must ensure the fields are finite. Since $Y_n(k_c\\rho)$ diverges as $\\rho \\to 0$, its coefficient must be zero. Thus, the admissible radial solutions are of the form $J_n(k_c\\rho)$.\nThe general solution for the longitudinal components is a superposition of modes of the form:\n$E_z(\\rho, \\phi) = A_{n} J_n(k_c\\rho) \\cos(n\\phi+\\phi_0)$\n$H_z(\\rho, \\phi) = B_{n} J_n(k_c\\rho) \\cos(n\\phi+\\psi_0)$\n\nNext, we enforce the boundary conditions for a perfectly electrically conducting (PEC) wall at $\\rho=a$. The tangential component of the electric field must vanish at the conductor surface. The tangential components are $E_z$ and $E_\\phi$.\n$$ E_z(\\rho=a, \\phi) = 0 $$\n$$ E_\\phi(\\rho=a, \\phi) = 0 $$\nWaveguide modes are classified into two families: Transverse-Magnetic (TM) and Transverse-Electric (TE).\n\nFor Transverse-Magnetic (TM) modes, $H_z=0$ by definition. The boundary condition $E_z(a, \\phi) = 0$ implies:\n$$ A_n J_n(k_c a) \\cos(n\\phi+\\phi_0) = 0 $$\nFor a non-trivial solution ($A_n \\neq 0$), this must hold for all $\\phi$, which requires $J_n(k_c a) = 0$. The other boundary condition on $E_\\phi$ is automatically satisfied because $E_\\phi = -\\frac{j\\beta}{k_c^2\\rho}\\frac{\\partial E_z}{\\partial \\phi}$ and $E_z(a, \\phi)=0$ for all $\\phi$. The characteristic equation for TM$_{nm}$ modes is therefore:\n$$ J_n(k_c a) = 0 $$\nThe allowed values for $k_c$ are given by $k_c = p_{nm}/a$, where $p_{nm}$ is the $m$-th root of the Bessel function $J_n(x)$.\n\nFor Transverse-Electric (TE) modes, $E_z=0$ by definition. The boundary condition $E_z(a, \\phi)=0$ is thus trivially satisfied. We must apply the condition $E_\\phi(a, \\phi)=0$. For TE modes, the expression for $E_\\phi$ simplifies to:\n$$ E_\\phi = -\\frac{j\\omega\\mu}{k_c^2} \\frac{\\partial H_z}{\\partial \\rho} $$\nSubstituting the solution for $H_z$:\n$$ E_\\phi(\\rho,\\phi) = -\\frac{j\\omega\\mu}{k_c^2} B_n \\frac{d}{d\\rho}[J_n(k_c\\rho)] \\cos(n\\phi+\\psi_0) = -\\frac{j\\omega\\mu}{k_c} B_n J_n'(k_c\\rho) \\cos(n\\phi+\\psi_0) $$\nwhere $J_n'(x)$ is the derivative of $J_n(x)$ with respect to its argument $x$. The boundary condition $E_\\phi(a, \\phi)=0$ requires:\n$$ J_n'(k_c a) = 0 $$\nThis is the characteristic equation for TE$_{nm}$ modes. The allowed values for $k_c$ are $k_c = p'_{nm}/a$, where $p'_{nm}$ is the $m$-th root of the derivative $J_n'(x)$.\n\nThe fundamental mode is the mode with the lowest cutoff frequency. The cutoff frequency $f_c$ occurs when the propagation constant $\\beta=0$. From the dispersion relation $k_c^2 = \\omega^2\\mu\\varepsilon - \\beta^2$, we get $\\omega_c = k_c/\\sqrt{\\mu\\varepsilon}$. The cutoff frequency is $f_c = \\omega_c/(2\\pi) = k_c / (2\\pi\\sqrt{\\mu\\varepsilon})$. The lowest $f_c$ corresponds to the smallest possible value of $k_c$, which in turn corresponds to the smallest root of either $J_n(k_ca)=0$ or $J_n'(k_ca)=0$. We examine the first few roots ($m=1$) for small $n$:\nRoots of $J_n(x)=0$ (for TM modes):\n$p_{01} \\approx 2.405$ (TM$_{01}$ mode)\n$p_{11} \\approx 3.832$ (TM$_{11}$ mode)\n$p_{21} \\approx 5.136$ (TM$_{21}$ mode)\n\nRoots of $J_n'(x)=0$ (for TE modes):\n$J_0'(x) = -J_1(x)$, so $p'_{01}=p_{11} \\approx 3.832$ (TE$_{01}$ mode)\n$p'_{11} \\approx 1.841$ (TE$_{11}$ mode)\n$p'_{21} \\approx 3.054$ (TE$_{21}$ mode)\n(Note: $p'_{n0}=0$ for $n \\ge 1$ and $J_0'(0)=0$ are trivial roots corresponding to $k_c=0$, which are not propagating modes in this type of waveguide.)\n\nComparing the listed non-zero roots, the smallest value is $p'_{11} \\approx 1.841$. Therefore, the fundamental mode is the TE$_{11}$ mode, which belongs to the TE family with azimuthal index $n=1$.\n\nThe cutoff frequency of the fundamental mode is given by:\n$$ f_c = \\frac{p'_{11} c}{2\\pi a \\sqrt{\\mu_r \\varepsilon_r}} $$\nwhere $c=1/\\sqrt{\\mu_0\\varepsilon_0}$ is the speed of light in vacuum. The given parameters are:\n$a = 1.50\\,\\mathrm{cm} = 1.50 \\times 10^{-2}\\,\\mathrm{m}$\n$\\varepsilon_r = 2.25$\n$\\mu_r = 1$\n$c = 2.99792458 \\times 10^8\\,\\mathrm{m/s}$\nThe value of the root is $p'_{11} \\approx 1.84118378$.\n\nSubstituting these values into the formula:\n$$ f_c = \\frac{1.84118378 \\times (2.99792458 \\times 10^8\\,\\mathrm{m/s})}{2\\pi (1.50 \\times 10^{-2}\\,\\mathrm{m}) \\sqrt{1 \\times 2.25}} $$\n$$ f_c = \\frac{1.84118378 \\times 2.99792458 \\times 10^8}{2\\pi \\times 1.50 \\times 10^{-2} \\times 1.5} $$\n$$ f_c = \\frac{5.519780 \\times 10^8}{0.14137167} \\approx 3.904481 \\times 10^9\\,\\mathrm{Hz} $$\nConverting to GHz and rounding to four significant figures:\n$$ f_c \\approx 3.904\\,\\mathrm{GHz} $$", "answer": "$$\\boxed{3.904}$$", "id": "3360771"}, {"introduction": "Real-world waveguide systems consist of interconnected components with varying material properties, leading to wave scattering at interfaces. This exercise introduces the mode-matching technique, a cornerstone method for analyzing such discontinuities, by considering a planar dielectric interface inside a rectangular waveguide. You will derive the reflection and transmission coefficients from the continuity of tangential fields and implement a program to compute power balance, providing concrete insights into impedance mismatch and total reflection from evanescent modes [@problem_id:3360782].", "problem": "Consider two semi-infinite, perfectly conducting rectangular waveguides that share the same cross-section but are filled with different, homogeneous, isotropic, lossless media. The interface between the media is the plane at $z=0$. The cross-section is a rectangle of width $a$ along $x$ and height $b$ along $y$, with perfectly electrically conducting (PEC) walls. In region $1$ ($z0$) the medium has permittivity $\\epsilon_1$ and permeability $\\mu_1$, and in region $2$ ($z0$) the medium has permittivity $\\epsilon_2$ and permeability $\\mu_2$. The waveguide is excited from $z=-\\infty$ by a single forward-propagating mode of unit amplitude. Assume time-harmonic fields with an $e^{j \\omega t}$ convention and an angular frequency $\\omega$.\n\nYour task is to derive, from first principles, the scattering at the dielectric discontinuity by mode matching in the sense of waveguide mode theory. The derivation and the resulting algorithm must start from Maxwell’s equations in the frequency domain and the boundary conditions at PEC walls and at the material interface. Use only facts and definitions that constitute the fundamental base for computational electromagnetics and waveguide mode theory. Do not introduce shortcut formulas in the problem statement.\n\nRequirements to include in the derivation and algorithm design:\n- Begin from the frequency-domain Maxwell’s equations, $\\nabla \\times \\mathbf{E} = -j \\omega \\mu \\mathbf{H}$ and $\\nabla \\times \\mathbf{H} = j \\omega \\epsilon \\mathbf{E}$, together with PEC boundary conditions on the metallic walls and continuity of the tangential fields at $z=0$ across the interface.\n- Obtain the transverse field eigenfunctions for Transverse Electric (TE) and Transverse Magnetic (TM) modes in a rectangular PEC waveguide by separation of variables, and define the mode indices $(m,n)$, the cutoff wavenumber $k_c$, and the axial propagation constant $\\beta$, distinguishing between propagating ($\\beta$ real) and evanescent ($\\beta$ imaginary) regimes.\n- Define the modal characteristic impedance for TE and TM modes from field relations and power flow, consistent with the normalization implied by the orthogonality integrals over the cross-section.\n- Set up and solve the mode-matching at the interface $z=0$ by enforcing the continuity of the tangential electric and magnetic fields. In the special case where the cross-sections are identical in regions $1$ and $2$, argue that the orthogonality and completeness of the eigenfunctions yield a diagonal coupling (no cross-mode conversion), so each incident mode scatters only into the same mode index $(m,n)$ across the interface.\n- From the continuity relations, deduce the reflection and transmission amplitudes for the single excited mode in terms of the modal impedances on the two sides.\n- Translate the amplitudes into power fractions carried by the forward-propagating transmitted mode and the backward-propagating reflected mode. Clarify how to treat the case where the transmitted mode is evanescent (no net power transport), and state the conditions under which energy conservation implies that the reflected power fraction is unity.\n\nImplementation task:\n- Write a complete, runnable program that, for a given set of parameters $(a,b,\\epsilon_1,\\mu_1,\\epsilon_2,\\mu_2,\\omega,\\text{mode type},m,n)$, computes the reflected power fraction $\\mathcal{R}$ and the transmitted power fraction $\\mathcal{T}$ for the unique mode $(m,n)$ impinging from $z=-\\infty$ in region $1$.\n- Use the vacuum permittivity $\\epsilon_0$ and vacuum permeability $\\mu_0$ where appropriate, with $\\epsilon_0$ and $\\mu_0$ given constants. If a relative permittivity $\\epsilon_r$ is specified, take $\\epsilon=\\epsilon_r \\epsilon_0$. Assume $\\mu_1=\\mu_2=\\mu_0$ for all test cases below.\n- Express all geometric lengths in meters and all frequencies in hertz, and produce dimensionless power fractions as decimal numbers. The angle unit is not used.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order specified by the test suite.\n\nDefinitions needed for the algorithm (to be derived and used in the solution, not as given shortcuts in the problem statement):\n- The rectangular waveguide eigenvalue problem yields $k_c$ as a function of $(m,n,a,b)$, the axial propagation constant $\\beta$ as a function of $(\\omega,\\epsilon,\\mu,k_c)$, and the modal impedances for TE and TM modes as functions of $(\\omega,\\epsilon,\\mu,\\beta)$. Use these derived relations to compute $\\mathcal{R}$ and $\\mathcal{T}$.\n\nTest suite:\nFor each test case, compute the reflected and transmitted power fractions for the specified single incident mode. Report the results as floats in the single output line in the order $[\\mathcal{R}_1,\\mathcal{T}_1,\\mathcal{R}_2,\\mathcal{T}_2,\\mathcal{R}_3,\\mathcal{T}_3]$.\n\n- Test case $1$ (general propagating case):\n  - Geometry: $a = 0.02286\\,\\mathrm{m}$, $b = 0.01016\\,\\mathrm{m}$.\n  - Materials: $\\epsilon_1 = \\epsilon_0$, $\\mu_1 = \\mu_0$; $\\epsilon_2 = 2.25\\,\\epsilon_0$, $\\mu_2 = \\mu_0$.\n  - Frequency: $f = 10\\times 10^9\\,\\mathrm{Hz}$ (so $\\omega = 2\\pi f$).\n  - Incident mode: TE with $(m,n)=(1,0)$.\n  - Both sides are above cutoff for this mode. Output $\\mathcal{R}_1$ and $\\mathcal{T}_1$ as decimal fractions.\n\n- Test case $2$ (transmission into evanescent case):\n  - Geometry: $a = 0.02286\\,\\mathrm{m}$, $b = 0.01016\\,\\mathrm{m}$.\n  - Materials: $\\epsilon_1 = 2.25\\,\\epsilon_0$, $\\mu_1 = \\mu_0$; $\\epsilon_2 = \\epsilon_0$, $\\mu_2 = \\mu_0$.\n  - Frequency: $f = 5.5\\times 10^9\\,\\mathrm{Hz}$ (so $\\omega = 2\\pi f$).\n  - Incident mode: TE with $(m,n)=(1,0)$.\n  - Region $1$ is above cutoff; region $2$ is below cutoff. Output $\\mathcal{R}_2$ and $\\mathcal{T}_2$ as decimal fractions, with $\\mathcal{T}_2$ equal to $0$ due to no net transmitted power.\n\n- Test case $3$ (identical media, boundary condition case):\n  - Geometry: $a = 0.02286\\,\\mathrm{m}$, $b = 0.01016\\,\\mathrm{m}$.\n  - Materials: $\\epsilon_1 = \\epsilon_0$, $\\mu_1 = \\mu_0$; $\\epsilon_2 = \\epsilon_0$, $\\mu_2 = \\mu_0$.\n  - Frequency: $f = 14\\times 10^9\\,\\mathrm{Hz}$ (so $\\omega = 2\\pi f$).\n  - Incident mode: TE with $(m,n)=(2,0)$.\n  - Both sides are above cutoff and identical; output $\\mathcal{R}_3$ and $\\mathcal{T}_3$ as decimal fractions, which in the ideal case should be $\\mathcal{R}_3=0$ and $\\mathcal{T}_3=1$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order $[\\mathcal{R}_1,\\mathcal{T}_1,\\mathcal{R}_2,\\mathcal{T}_2,\\mathcal{R}_3,\\mathcal{T}_3]$. For example, a valid output line looks like $[0.1,0.9,1.0,0.0,0.0,1.0]$.", "solution": "The problem is to analyze the scattering of a single waveguide mode at a planar dielectric interface within a uniform rectangular waveguide. The analysis shall begin from first principles, namely Maxwell's equations.\n\nWe begin with the time-harmonic form of Maxwell's equations in a source-free, homogeneous, isotropic, and linear medium, assuming an $e^{j \\omega t}$ time dependence:\n$$ \\nabla \\times \\mathbf{E} = -j \\omega \\mu \\mathbf{H} $$\n$$ \\nabla \\times \\mathbf{H} = j \\omega \\epsilon \\mathbf{E} $$\nwhere $\\mathbf{E}$ and $\\mathbf{H}$ are the complex phasors for the electric and magnetic fields, $\\omega$ is the angular frequency, and $\\epsilon$ and $\\mu$ are the permittivity and permeability of the medium, respectively.\n\nTaking the curl of the first equation and substituting the second yields the vector wave equation for $\\mathbf{E}$:\n$$ \\nabla \\times (\\nabla \\times \\mathbf{E}) = -j \\omega \\mu (\\nabla \\times \\mathbf{H}) = -j \\omega \\mu (j \\omega \\epsilon \\mathbf{E}) = \\omega^2 \\mu \\epsilon \\mathbf{E} $$\nUsing the vector identity $\\nabla \\times (\\nabla \\times \\mathbf{E}) = \\nabla(\\nabla \\cdot \\mathbf{E}) - \\nabla^2 \\mathbf{E}$ and the fact that $\\nabla \\cdot \\mathbf{D} = \\epsilon \\nabla \\cdot \\mathbf{E} = 0$ in a source-free region, we arrive at the vector Helmholtz equation:\n$$ \\nabla^2 \\mathbf{E} + k^2 \\mathbf{E} = 0 $$\nwhere $k^2 = \\omega^2 \\mu \\epsilon$ is the square of the wavenumber in the medium. A similar equation holds for $\\mathbf{H}$.\n\nFor a waveguide oriented along the $z$-axis, we seek modal solutions of the form $\\mathbf{E}(x,y,z) = \\mathbf{e}(x,y) e^{-j\\beta z}$, where $\\mathbf{e}(x,y)$ is the transverse mode profile and $\\beta$ is the longitudinal propagation constant. The operator $\\nabla^2$ can be separated into transverse and longitudinal parts: $\\nabla^2 = \\nabla_t^2 + \\frac{\\partial^2}{\\partial z^2}$. Substituting the modal form into the Helmholtz equation gives:\n$$ (\\nabla_t^2 - \\beta^2 + k^2) \\mathbf{e}(x,y) = 0 $$\nThis is an eigenvalue equation for the transverse operator $\\nabla_t^2$. We define the cutoff wavenumber $k_c$ such that $k_c^2 = k^2 - \\beta^2$. This yields the dispersion relation for the propagation constant:\n$$ \\beta = \\sqrt{k^2 - k_c^2} = \\sqrt{\\omega^2 \\mu \\epsilon - k_c^2} $$\nIf $k > k_c$, $\\beta$ is real and positive, corresponding to a propagating mode. If $k  k_c$, $\\beta$ is purely imaginary. We choose $\\beta = -j\\alpha$ with $\\alpha = \\sqrt{k_c^2 - k^2}$ being a real positive value, which corresponds to an evanescent mode that decays in the $+z$ direction.\n\nThe fields within the waveguide are classified into Transverse Electric (TE) modes, where $E_z=0$, and Transverse Magnetic (TM) modes, where $H_z=0$. The transverse field components $(\\mathbf{E}_t, \\mathbf{H}_t)$ can be expressed in terms of the longitudinal components $(E_z, H_z)$, leading to two independent sets of solutions.\n\nFor a rectangular waveguide with perfectly electrically conducting (PEC) walls at $x=0,a$ and $y=0,b$, the boundary conditions require the tangential electric field to be zero at the walls.\n\nFor TM modes ($H_z=0$), we solve $\\nabla_t^2 E_z + k_c^2 E_z = 0$ with the boundary condition $E_z=0$ on all four walls. Separation of variables yields the eigenfunctions:\n$$ E_z(x,y) = E_{mn} \\sin\\left(\\frac{m\\pi x}{a}\\right) \\sin\\left(\\frac{n\\pi y}{b}\\right), \\quad m,n = 1,2,3,... $$\nThe corresponding cutoff wavenumber is $k_{c,mn}^2 = \\left(\\frac{m\\pi}{a}\\right)^2 + \\left(\\frac{n\\pi}{b}\\right)^2$.\n\nFor TE modes ($E_z=0$), we solve $\\nabla_t^2 H_z + k_c^2 H_z = 0$. The boundary condition on the tangential electric field implies that the normal derivative of $H_z$ is zero at the walls, i.e., $\\partial H_z / \\partial n = 0$. This gives the eigenfunctions:\n$$ H_z(x,y) = H_{mn} \\cos\\left(\\frac{m\\pi x}{a}\\right) \\cos\\left(\\frac{n\\pi y}{b}\\right), \\quad m,n = 0,1,2,... \\text{ (not both zero)} $$\nThe cutoff wavenumber $k_{c,mn}$ is given by the same expression as for TM modes.\n\nThe transverse fields are related by the modal characteristic impedance, defined as $Z_{\\text{mode}} = |\\mathbf{E}_t|/|\\mathbf{H}_t|$ for a forward propagating wave. This ratio is constant across the waveguide cross-section for a given mode. For forward-propagating waves, the relationship is $\\mathbf{H}_t = (1/Z_{\\text{mode}})(\\hat{\\mathbf{z}} \\times \\mathbf{E}_t)$. The expressions derived from Maxwell's equations are:\n$$ Z_{TE} = \\frac{\\omega\\mu}{\\beta} $$\n$$ Z_{TM} = \\frac{\\beta}{\\omega\\epsilon} $$\nFor propagating modes ($\\beta$ real), these impedances are real. For evanescent modes ($\\beta = -j\\alpha$), $Z_{TE}$ is inductive (positive imaginary) and $Z_{TM}$ is capacitive (negative imaginary).\n\nNow, consider the interface at $z=0$. Region 1 ($z0$) has properties $(\\epsilon_1, \\mu_1)$ and Region 2 ($z0$) has properties $(\\epsilon_2, \\mu_2)$. An incident mode of type $(m,n)$ with unit amplitude propagates from $z=-\\infty$ toward the interface. The total transverse fields in both regions can be expressed as a superposition of all possible modes.\nIn Region 1 ($z0$):\n$$ \\mathbf{E}_{t,1}(x,y,z) = \\mathbf{e}_{inc}(x,y)e^{-j\\beta_{inc,1}z} + \\sum_p R_p \\mathbf{e}_{p,1}(x,y)e^{+j\\beta_{p,1}z} $$\n$$ \\mathbf{H}_{t,1}(x,y,z) = \\frac{1}{Z_{inc,1}}\\hat{\\mathbf{z}}\\times\\mathbf{e}_{inc}e^{-j\\beta_{inc,1}z} - \\sum_p \\frac{R_p}{Z_{p,1}}\\hat{\\mathbf{z}}\\times\\mathbf{e}_{p,1}e^{+j\\beta_{p,1}z} $$\nIn Region 2 ($z0$):\n$$ \\mathbf{E}_{t,2}(x,y,z) = \\sum_p T_p \\mathbf{e}_{p,2}(x,y)e^{-j\\beta_{p,2}z} $$\n$$ \\mathbf{H}_{t,2}(x,y,z) = \\sum_p \\frac{T_p}{Z_{p,2}}\\hat{\\mathbf{z}}\\times\\mathbf{e}_{p,2}e^{-j\\beta_{p,2}z} $$\nHere, $R_p$ and $T_p$ are the reflection and transmission amplitudes for mode $p$. The negative sign in the reflected magnetic field term accounts for the backward power flow.\n\nAt the interface $z=0$, the tangential field components must be continuous:\n1. $\\mathbf{E}_{t,1}(x,y,0) = \\mathbf{E}_{t,2}(x,y,0)$\n2. $\\mathbf{H}_{t,1}(x,y,0) = \\mathbf{H}_{t,2}(x,y,0)$\n\nSince the waveguide cross-section is identical on both sides, the transverse modal eigenfunctions $\\mathbf{e}_p(x,y)$ are the same for Region 1 and 2, i.e., $\\mathbf{e}_{p,1} = \\mathbf{e}_{p,2} = \\mathbf{e}_p$. These functions form a complete orthogonal set over the cross-section.\nContinuity of $\\mathbf{E}_t$ at $z=0$ gives:\n$$ (\\mathbf{e}_{inc} + R_{inc}\\mathbf{e}_{inc}) + \\sum_{p \\neq inc} R_p \\mathbf{e}_p = T_{inc}\\mathbf{e}_{inc} + \\sum_{p \\neq inc} T_p \\mathbf{e}_p $$\nBy projecting this equation onto each basis function $\\mathbf{e}_q$ (i.e., taking the inner product $\\int_S (\\cdot) \\cdot \\mathbf{e}_q^* dA$) and using orthogonality ($\\int_S \\mathbf{e}_p \\cdot \\mathbf{e}_q^* dA = N_p \\delta_{pq}$), we obtain equations for each mode independently:\n$$ (1+R_{inc})\\delta_{q,inc} + R_q(1-\\delta_{q,inc}) = T_q $$\nThis implies:\nFor the incident mode ($q=inc$): $1 + R_{inc} = T_{inc}$.\nFor all other modes ($q \\neq inc$): $R_q = T_q$.\n\nContinuity of $\\mathbf{H}_t$ at $z=0$ gives:\n$$ \\left(\\frac{1}{Z_{inc,1}}\\hat{\\mathbf{z}}\\times\\mathbf{e}_{inc} - \\frac{R_{inc}}{Z_{inc,1}}\\hat{\\mathbf{z}}\\times\\mathbf{e}_{inc}\\right) - \\sum_{p \\neq inc} \\frac{R_p}{Z_{p,1}}\\hat{\\mathbf{z}}\\times\\mathbf{e}_p = \\sum_p \\frac{T_p}{Z_{p,2}}\\hat{\\mathbf{z}}\\times\\mathbf{e}_p $$\nAgain, invoking orthogonality:\nFor the incident mode ($q=inc$): $\\frac{1}{Z_{inc,1}}(1 - R_{inc}) = \\frac{T_{inc}}{Z_{inc,2}}$.\nFor all other modes ($q \\neq inc$): $-\\frac{R_q}{Z_{q,1}} = \\frac{T_q}{Z_{q,2}}$.\nSubstituting $R_q = T_q$ into the second equation yields $T_q(-\\frac{1}{Z_{q,1}} - \\frac{1}{Z_{q,2}}) = 0$, which implies $T_q=R_q=0$ for all $q \\neq inc$. This proves that there is no mode conversion at the planar interface in a uniform waveguide. The incident mode only scatters into the same mode type.\n\nLet $R=R_{inc}$ and $T=T_{inc}$, and let the impedances for this mode be $Z_1$ and $Z_2$. We have a system of two equations:\n$$ 1 + R = T $$\n$$ \\frac{1}{Z_1}(1 - R) = \\frac{T}{Z_2} $$\nSolving this system yields the reflection and transmission amplitudes:\n$$ R = \\frac{Z_2 - Z_1}{Z_2 + Z_1} $$\n$$ T = \\frac{2Z_2}{Z_2 + Z_1} $$\n\nThe time-averaged power conveyed by a mode is proportional to $\\text{Re}(1/Z^*)$. The reflected power fraction $\\mathcal{R}$ and transmitted power fraction $\\mathcal{T}$ are given by:\n$$ \\mathcal{R} = \\frac{P_{\\text{refl}}}{P_{\\text{inc}}} = |R|^2 = \\left| \\frac{Z_2 - Z_1}{Z_2 + Z_1} \\right|^2 $$\n$$ \\mathcal{T} = \\frac{P_{\\text{trans}}}{P_{\\text{inc}}} = |T|^2 \\frac{\\text{Re}(1/Z_2^*)}{\\text{Re}(1/Z_1^*)} $$\n\nIf the transmitted mode is propagating, $Z_1$ and $Z_2$ are real. The expressions simplify to:\n$$ \\mathcal{R} = \\left(\\frac{Z_2 - Z_1}{Z_2 + Z_1}\\right)^2 $$\n$$ \\mathcal{T} = \\left(\\frac{2Z_2}{Z_2 + Z_1}\\right)^2 \\frac{1/Z_2}{1/Z_1} = \\frac{4 Z_2^2}{(Z_2 + Z_1)^2} \\frac{Z_1}{Z_2} = \\frac{4Z_1 Z_2}{(Z_1 + Z_2)^2} $$\nIt is straightforward to verify that $\\mathcal{R} + \\mathcal{T} = 1$, satisfying energy conservation.\n\nIf the transmitted mode in region 2 is evanescent ($k_2  k_{c}$), its impedance $Z_2$ is purely imaginary. Consequently, $\\text{Re}(1/Z_2^*) = 0$, meaning no net power is transmitted. Thus, $\\mathcal{T} = 0$. For the reflection coefficient, let $Z_1$ be real and $Z_2 = jX$. Then\n$$ \\mathcal{R} = |R|^2 = \\left| \\frac{jX - Z_1}{jX + Z_1} \\right|^2 = \\frac{|jX - Z_1|^2}{|jX + Z_1|^2} = \\frac{X^2 + (-Z_1)^2}{X^2 + Z_1^2} = 1 $$\nThis signifies total reflection, as expected for energy conservation when the transmitted wave is non-propagating.\n\nThe algorithm is therefore:\n1. For the given mode $(m,n)$, calculate the cutoff wavenumber $k_c$.\n2. For region 1 and region 2, calculate the medium wavenumber $k_i = \\omega \\sqrt{\\mu_i \\epsilon_i}$.\n3. For each region, determine if the mode is propagating ($k_i > k_c$) or evanescent ($k_i  k_c$). The incident mode is given to be propagating.\n4. Calculate the modal impedances $Z_1$ and $Z_2$.\n5. If the mode in region 2 is evanescent, $\\mathcal{R}=1$ and $\\mathcal{T}=0$.\n6. If the mode in region 2 is propagating, $Z_1$ and $Z_2$ are real. Calculate $\\mathcal{R}$ and $\\mathcal{T}$ using the derived formulas for real impedances.", "answer": "```python\nimport numpy as np\n\n# Define physical constants using exact relations for precision.\nMU_0 = 4 * np.pi * 1e-7\nC_0 = 299792458.0\nEPSILON_0 = 1 / (MU_0 * C_0**2)\n\ndef calculate_mode_properties(a, b, epsilon, mu, omega, m, n, mode_type):\n    \"\"\"\n    Calculates the modal impedance and propagation status for a given mode.\n\n    Args:\n        a (float): Waveguide width (x-dimension).\n        b (float): Waveguide height (y-dimension).\n        epsilon (float): Permittivity of the medium.\n        mu (float): Permeability of the medium.\n        omega (float): Angular frequency.\n        m (int): Mode index for x-dimension.\n        n (int): Mode index for y-dimension.\n        mode_type (str): 'TE' or 'TM'.\n\n    Returns:\n        tuple: (impedance, is_propagating)\n               impedance (complex): The modal characteristic impedance.\n               is_propagating (bool): True if the mode is propagating, False if evanescent.\n    \"\"\"\n    if (mode_type == 'TM' and (m == 0 or n == 0)) or \\\n       (mode_type == 'TE' and m == 0 and n == 0):\n        raise ValueError(f\"Invalid mode indices ({m},{n}) for {mode_type} mode.\")\n\n    k_c_sq = (m * np.pi / a)**2 + (n * np.pi / b)**2\n    k_sq = omega**2 * mu * epsilon\n\n    if k_sq > k_c_sq:\n        # Propagating mode\n        is_propagating = True\n        beta = np.sqrt(k_sq - k_c_sq)\n        if mode_type == 'TE':\n            impedance = (omega * mu) / beta\n        else:  # TM\n            impedance = beta / (omega * epsilon)\n    else:\n        # Evanescent mode\n        is_propagating = False\n        alpha = np.sqrt(k_c_sq - k_sq)\n        if mode_type == 'TE':\n            # Z_TE = omega*mu / (-j*alpha) = j * (omega*mu/alpha)\n            impedance = 1j * (omega * mu) / alpha\n        else:  # TM\n            # Z_TM = (-j*alpha) / (omega*epsilon)\n            impedance = -1j * alpha / (omega * epsilon)\n\n    return impedance, is_propagating\n\ndef solve():\n    \"\"\"\n    Solves the reflection and transmission problem for the given test cases.\n    \"\"\"\n    test_cases = [\n        # Test case 1\n        {'a': 0.02286, 'b': 0.01016, 'eps_r1': 1.0, 'eps_r2': 2.25, \n         'f': 10e9, 'mode_type': 'TE', 'm': 1, 'n': 0},\n        # Test case 2\n        {'a': 0.02286, 'b': 0.01016, 'eps_r1': 2.25, 'eps_r2': 1.0, \n         'f': 5.5e9, 'mode_type': 'TE', 'm': 1, 'n': 0},\n        # Test case 3\n        {'a': 0.02286, 'b': 0.01016, 'eps_r1': 1.0, 'eps_r2': 1.0, \n         'f': 14e9, 'mode_type': 'TE', 'm': 2, 'n': 0},\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        a, b = case['a'], case['b']\n        eps1, eps2 = case['eps_r1'] * EPSILON_0, case['eps_r2'] * EPSILON_0\n        mu1, mu2 = MU_0, MU_0  # As per problem statement mu_1=mu_2=mu_0\n        omega = 2 * np.pi * case['f']\n        mode_type, m, n = case['mode_type'], case['m'], case['n']\n\n        # Calculate properties for Region 1 (z0)\n        Z1, is_prop_1 = calculate_mode_properties(a, b, eps1, mu1, omega, m, n, mode_type)\n        \n        # Calculate properties for Region 2 (z>0)\n        Z2, is_prop_2 = calculate_mode_properties(a, b, eps2, mu2, omega, m, n, mode_type)\n\n        # Incident mode must be propagating\n        if not is_prop_1:\n            raise ValueError(\"Incident mode is evanescent, which contradicts the problem setup.\")\n\n        if not is_prop_2:\n            # Total reflection as transmitted mode is evanescent\n            R_power = 1.0\n            T_power = 0.0\n        else:\n            # Both modes are propagating, impedances are real.\n            Z1_real = np.real(Z1)\n            Z2_real = np.real(Z2)\n            \n            # Reflection power fraction\n            R_power = ((Z2_real - Z1_real) / (Z2_real + Z1_real))**2\n            \n            # Transmission power fraction from energy conservation\n            T_power = 1.0 - R_power\n\n        results.extend([R_power, T_power])\n\n    # Format the output as specified\n    print(f\"[{','.join(f'{r:.12f}' for r in results)}]\")\n\nsolve()\n\n```", "id": "3360782"}, {"introduction": "For waveguides with arbitrary cross-sections or inhomogeneous materials, analytical solutions are often intractable, necessitating numerical methods. This advanced practice introduces the powerful Rayleigh-Ritz method, which is based on a variational principle for the waveguide eigenvalue problem. You will derive the scalar Rayleigh quotient for TM modes and use it to formulate a matrix eigenvalue problem, which you will then implement to compute cutoff frequencies for both homogeneous and inhomogeneous waveguides [@problem_id:3360822].", "problem": "Consider a two-dimensional cross-section of an infinitely long, straight, uniform waveguide with perfectly electrically conducting walls. Let the cross-section domain be denoted by $\\Omega \\subset \\mathbb{R}^2$ with boundary $\\partial \\Omega$. The material inside the waveguide is linear, isotropic, and possibly inhomogeneous, with spatially varying permittivity $\\epsilon(x,y) > 0$ and constant permeability $\\mu > 0$. Assume time-harmonic fields with angular frequency $\\omega$ governed by Maxwell's equations under the $e^{j\\omega t}$ convention. The goal is to derive and utilize a variational principle to approximate waveguide cutoff frequencies for transverse magnetic modes using the Rayleigh–Ritz method.\n\nStarting from the source-free Maxwell curl equations and the perfect electric conductor boundary condition that enforces vanishing tangential electric field on $\\partial \\Omega$, derive a variational characterization of the cutoff angular frequency $\\omega_c$ for waveguide eigenmodes by showing that stationary values of the functional\n$$\n\\mathcal{R}(\\mathbf{E}) \\;=\\; \\frac{\\int_{\\Omega} \\mu^{-1} \\left\\lvert \\nabla \\times \\mathbf{E} \\right\\rvert^2 \\, dA}{\\int_{\\Omega} \\epsilon \\left\\lvert \\mathbf{E} \\right\\rvert^2 \\, dA}\n$$\nover an admissible function space correspond to eigenvalues of the curl-curl operator, and specialize this to the transverse magnetic case where $\\mathbf{E}(x,y) = \\hat{\\mathbf{z}}\\, E_z(x,y)$ and $E_z(x,y)$ vanishes on $\\partial \\Omega$. Show that in this specialization the variational problem reduces to the scalar Rayleigh quotient\n$$\n\\mathcal{R}(E_z) \\;=\\; \\frac{\\int_{\\Omega} \\mu^{-1} \\left\\lvert \\nabla E_z \\right\\rvert^2 \\, dA}{\\int_{\\Omega} \\epsilon \\left\\lvert E_z \\right\\rvert^2 \\, dA}\n$$\nwhose stationary values give $\\omega_c^2$ and whose minimizer satisfies a scalar eigenvalue problem with Dirichlet boundary conditions.\n\nImplement the Rayleigh–Ritz method to approximate the smallest cutoff angular frequency for the transverse magnetic spectrum on a rectangular domain $\\Omega = [0,a] \\times [0,b]$ by using a finite-dimensional subspace spanned by a set of basis functions that satisfy the Dirichlet boundary condition, for example $\\phi_{mn}(x,y) = \\sin\\!\\big(\\frac{m\\pi x}{a}\\big)\\sin\\!\\big(\\frac{n\\pi y}{b}\\big)$ for integers $m,n \\geq 1$. Form the generalized eigenvalue problem\n$$\n\\mathbf{A}\\mathbf{c} \\;=\\; \\omega^2 \\,\\mathbf{B}\\mathbf{c},\n$$\nwhere\n$$\nA_{ij} \\;=\\; \\int_{\\Omega} \\mu^{-1} \\nabla \\phi_i \\cdot \\nabla \\phi_j \\, dA, \\qquad\nB_{ij} \\;=\\; \\int_{\\Omega} \\epsilon \\, \\phi_i \\phi_j \\, dA,\n$$\nand determine the smallest eigenvalue $\\omega_c^2$ to obtain the cutoff frequency $f_c = \\omega_c / (2\\pi)$ in hertz (Hz). For spatially constant permittivity and permeability, these integrals admit closed forms; for spatially varying permittivity $\\epsilon(x,y)$, approximate the integrals by uniform tensor-product quadrature on a rectangular grid using midpoint sampling.\n\nUse the following test suite of parameter values to compute the lowest transverse magnetic cutoff frequency $f_c$ for each case. All frequencies must be expressed in hertz (Hz) and rounded to six significant figures. For each case, use the Rayleigh–Ritz subspace spanned by $\\phi_{mn}$ with $1 \\leq m \\leq M$ and $1 \\leq n \\leq N$ as specified.\n\n- Case 1 (homogeneous vacuum rectangular waveguide): $a = 0.02286\\,\\text{m}$, $b = 0.01016\\,\\text{m}$, $\\epsilon_r = 1.0$, $\\mu_r = 1.0$, $M = 3$, $N = 3$.\n- Case 2 (homogeneous dielectric-filled rectangular waveguide): $a = 0.02286\\,\\text{m}$, $b = 0.01016\\,\\text{m}$, $\\epsilon_r = 2.25$, $\\mu_r = 1.0$, $M = 3$, $N = 3$.\n- Case 3 (homogeneous vacuum square waveguide): $a = 0.030\\,\\text{m}$, $b = 0.030\\,\\text{m}$, $\\epsilon_r = 1.0$, $\\mu_r = 1.0$, $M = 4$, $N = 4$.\n- Case 4 (homogeneous vacuum, narrow height): $a = 0.020\\,\\text{m}$, $b = 0.0020\\,\\text{m}$, $\\epsilon_r = 1.0$, $\\mu_r = 1.0$, $M = 3$, $N = 3$.\n- Case 5 (inhomogeneous vacuum background with centered circular inclusion): $a = 0.040\\,\\text{m}$, $b = 0.040\\,\\text{m}$, background $\\epsilon_r = 1.0$ with a centered circular inclusion of radius $r = 0.010\\,\\text{m}$ and inclusion permittivity $\\epsilon_r = 2.25$, $\\mu_r = 1.0$, $M = 4$, $N = 4$. Use midpoint quadrature on a uniform $201 \\times 201$ grid for the inhomogeneous integrals.\n\nYour program must compute the lowest cutoff frequency $f_c$ in hertz for each case, rounded to six significant figures. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4,result5]\").", "solution": "The problem asks for the derivation and application of a variational method, specifically the Rayleigh-Ritz method, to compute the cutoff frequencies of transverse magnetic (TM) modes in a uniform waveguide.\n\n### Variational Principle Derivation\n\nWe begin with the time-harmonic, source-free Maxwell's curl equations, assuming an $e^{j\\omega t}$ time dependence:\n$$\n\\nabla \\times \\mathbf{E} \\;=\\; -j\\omega\\mu\\mathbf{H} \\quad (1)\n$$\n$$\n\\nabla \\times \\mathbf{H} \\;=\\; j\\omega\\epsilon\\mathbf{E} \\quad (2)\n$$\nHere, $\\mathbf{E}$ is the electric field phasor, $\\mathbf{H}$ is the magnetic field phasor, $\\omega$ is the angular frequency, $\\mu$ is the magnetic permeability (constant), and $\\epsilon(x,y)$ is the electric permittivity (possibly spatially varying).\n\nTo derive a wave equation for the electric field, we take the curl of Equation (1), multiplied by $\\mu^{-1}$, and substitute Equation (2):\n$$\n\\nabla \\times (\\mu^{-1} \\nabla \\times \\mathbf{E}) \\;=\\; -j\\omega \\nabla \\times \\mathbf{H} \\;=\\; -j\\omega(j\\omega\\epsilon\\mathbf{E})\n$$\nThis yields the vector wave equation for $\\mathbf{E}$:\n$$\n\\nabla \\times (\\mu^{-1} \\nabla \\times \\mathbf{E}) - \\omega^2 \\epsilon \\mathbf{E} \\;=\\; 0 \\quad (3)\n$$\nThis is an eigenvalue problem where the operator is $\\mathbf{L} = \\epsilon^{-1}\\nabla \\times (\\mu^{-1} \\nabla \\times \\cdot)$ and the eigenvalue is $\\omega^2$. The fields must satisfy the boundary condition for a perfect electric conductor (PEC), which states that the tangential component of the electric field vanishes on the boundary $\\partial\\Omega$: $\\hat{\\mathbf{n}} \\times \\mathbf{E}|_{\\partial\\Omega} = \\mathbf{0}$, where $\\hat{\\mathbf{n}}$ is the outward normal vector on the boundary.\n\nNow, consider the Rayleigh quotient functional $\\mathcal{R}(\\mathbf{E})$:\n$$\n\\mathcal{R}(\\mathbf{E}) \\;=\\; \\frac{\\int_{\\Omega} \\mu^{-1} \\left\\lvert \\nabla \\times \\mathbf{E} \\right\\rvert^2 \\, dA}{\\int_{\\Omega} \\epsilon \\left\\lvert \\mathbf{E} \\right\\rvert^2 \\, dA}\n$$\nThe stationary points of this functional correspond to the solutions of the eigenvalue problem in Equation (3). To show this, we find the first variation of $\\mathcal{R}$ by considering a trial function $\\mathbf{E} + \\delta \\mathbf{F}$, where $\\delta$ is a small parameter and $\\mathbf{F}$ is an arbitrary but admissible test function that satisfies the same boundary conditions as $\\mathbf{E}$. Setting the first variation $\\delta\\mathcal{R}$ to zero leads to the Euler-Lagrange equation for the functional. A well-known result from calculus of variations is that the stationary conditions of a Rayleigh quotient of the form $\\frac{\\langle \\mathbf{L_A}u, u \\rangle}{\\langle \\mathbf{L_B}u, u \\rangle}$ yield the generalized eigenvalue problem $\\mathbf{L_A}u = \\lambda \\mathbf{L_B}u$. In our case, this procedure yields exactly Equation (3) with $\\omega^2 = \\mathcal{R}(\\mathbf{E})$, confirming that the stationary values of the functional are the squared cutoff angular frequencies.\n\n### Specialization to Transverse Magnetic (TM) Modes\n\nFor TM modes, the magnetic field is purely transverse to the direction of propagation (the $z$-axis), meaning $H_z = 0$. At the cutoff frequency, the mode ceases to propagate, and the fields become independent of $z$. The electric field for a TM mode takes the form $\\mathbf{E}(x,y) = \\hat{\\mathbf{z}}\\, E_z(x,y)$. The PEC boundary condition $\\mathbf{E}_{tan}|_{\\partial\\Omega} = \\mathbf{0}$ directly implies that $E_z$ must vanish on the boundary: $E_z|_{\\partial\\Omega} = 0$.\n\nWe now specialize the vector functional $\\mathcal{R}(\\mathbf{E})$ for this form of $\\mathbf{E}$:\nThe curl of $\\mathbf{E}$ is:\n$$\n\\nabla \\times \\mathbf{E} \\;=\\; \\nabla \\times (\\hat{\\mathbf{z}} E_z(x,y)) \\;=\\; \\frac{\\partial E_z}{\\partial y}\\hat{\\mathbf{x}} - \\frac{\\partial E_z}{\\partial x}\\hat{\\mathbf{y}} \\;=\\; \\nabla E_z \\times \\hat{\\mathbf{z}}\n$$\nThe squared magnitude of the curl is:\n$$\n\\left\\lvert \\nabla \\times \\mathbf{E} \\right\\rvert^2 \\;=\\; \\left(\\frac{\\partial E_z}{\\partial x}\\right)^2 + \\left(\\frac{\\partial E_z}{\\partial y}\\right)^2 \\;=\\; \\left\\lvert \\nabla E_z \\right\\rvert^2\n$$\nThe squared magnitude of the electric field is:\n$$\n\\left\\lvert \\mathbf{E} \\right\\rvert^2 \\;=\\; \\left\\lvert \\hat{\\mathbf{z}} E_z \\right\\rvert^2 \\;=\\; \\left\\lvert E_z \\right\\rvert^2\n$$\nSubstituting these expressions into the vector Rayleigh quotient gives the scalar Rayleigh quotient for $E_z$:\n$$\n\\mathcal{R}(E_z) \\;=\\; \\frac{\\int_{\\Omega} \\mu^{-1} \\left\\lvert \\nabla E_z \\right\\rvert^2 \\, dA}{\\int_{\\Omega} \\epsilon \\left\\lvert E_z \\right\\rvert^2 \\, dA}\n$$\nThe stationary values of this functional are the squared cutoff angular frequencies $\\omega_c^2$. The function $E_z$ that minimizes this quotient is the ground state eigenfunction, corresponding to the lowest cutoff frequency. This minimizer satisfies the Euler-Lagrange equation, which is the scalar elliptic eigenvalue problem $\\nabla \\cdot (\\mu^{-1} \\nabla E_z) + \\omega^2 \\epsilon E_z = 0$ with Dirichlet boundary conditions $E_z|_{\\partial\\Omega} = 0$.\n\n### Rayleigh–Ritz Method Implementation\n\nThe Rayleigh-Ritz method approximates the solution $E_z$ by a finite linear combination of basis functions $\\phi_j(x,y)$:\n$$\nE_z(x,y) \\approx \\sum_{j=1}^{K} c_j \\phi_j(x,y)\n$$\nwhere $c_j$ are unknown coefficients. The basis functions must be chosen to satisfy the Dirichlet boundary condition $\\phi_j|_{\\partial\\Omega} = 0$. For the rectangular domain $\\Omega = [0,a] \\times [0,b]$, the functions $\\phi_{mn}(x,y) = \\sin(\\frac{m\\pi x}{a})\\sin(\\frac{n\\pi y}{b})$ for integers $m,n \\ge 1$ form a suitable basis. We use a set of these functions indexed by a single index $j=1, \\dots, K$, where each $j$ corresponds to a pair $(m,n)$ for $1 \\le m \\le M$ and $1 \\le n \\le N$.\n\nSubstituting the expansion for $E_z$ into the scalar Rayleigh quotient gives:\n$$\n\\omega^2 \\;=\\; \\frac{\\int_{\\Omega} \\mu^{-1} \\left\\lvert \\sum_{i} c_i \\nabla\\phi_i \\right\\rvert^2 \\, dA}{\\int_{\\Omega} \\epsilon \\left\\lvert \\sum_{j} c_j \\phi_j \\right\\rvert^2 \\, dA} \\;=\\; \\frac{\\sum_{i,j} c_i c_j \\int_{\\Omega} \\mu^{-1} (\\nabla\\phi_i \\cdot \\nabla\\phi_j) \\, dA}{\\sum_{i,j} c_i c_j \\int_{\\Omega} \\epsilon (\\phi_i \\phi_j) \\, dA}\n$$\nThis can be written in matrix form as:\n$$\n\\omega^2 \\;=\\; \\frac{\\mathbf{c}^T \\mathbf{A} \\mathbf{c}}{\\mathbf{c}^T \\mathbf{B} \\mathbf{c}}\n$$\nwhere $\\mathbf{c}$ is the vector of coefficients $[c_1, \\dots, c_K]^T$, and the matrices $\\mathbf{A}$ and $\\mathbf{B}$ have elements:\n$$\nA_{ij} \\;=\\; \\int_{\\Omega} \\mu^{-1} \\nabla \\phi_i \\cdot \\nabla \\phi_j \\, dA, \\qquad\nB_{ij} \\;=\\; \\int_{\\Omega} \\epsilon \\, \\phi_i \\phi_j \\, dA\n$$\nTo find the stationary values of this expression, we differentiate with respect to each coefficient $c_k$ and set the result to zero. This procedure leads to the generalized eigenvalue problem:\n$$\n\\mathbf{A}\\mathbf{c} \\;=\\; \\omega^2 \\mathbf{B}\\mathbf{c}\n$$\nThe eigenvalues $\\omega^2$ of this system are the Ritz approximations of the squared cutoff angular frequencies. The smallest eigenvalue corresponds to the smallest cutoff frequency.\n\n#### Calculation of Matrix Elements\n\n**Homogeneous Case (Cases 1, 2, 3, 4):**\nFor constant $\\epsilon = \\epsilon_r\\epsilon_0$ and $\\mu = \\mu_r\\mu_0$, the integrals for $A_{ij}$ and $B_{ij}$ can be solved analytically. Let $\\phi_i = \\sin(\\frac{m_i\\pi x}{a})\\sin(\\frac{n_i\\pi y}{b})$ and $\\phi_j = \\sin(\\frac{m_j\\pi x}{a})\\sin(\\frac{n_j\\pi y}{b})$. Due to the orthogonality of the sine and cosine functions over the interval, the matrices $\\mathbf{A}$ and $\\mathbf{B}$ become diagonal. A non-zero element occurs only when $i=j$ (i.e., $m_i=m_j$ and $n_i=n_j$). The diagonal elements are:\n$$\nA_{ii} \\;=\\; \\mu^{-1} \\frac{ab}{4} \\left[ \\left(\\frac{m_i\\pi}{a}\\right)^2 + \\left(\\frac{n_i\\pi}{b}\\right)^2 \\right]\n$$\n$$\nB_{ii} \\;=\\; \\epsilon \\frac{ab}{4}\n$$\nThe eigenvalues are simply the ratio $A_{ii}/B_{ii}$, which gives the exact known analytical result:\n$$\n\\omega_{m_i,n_i}^2 = \\frac{1}{\\mu\\epsilon} \\left[ \\left(\\frac{m_i\\pi}{a}\\right)^2 + \\left(\\frac{n_i\\pi}{b}\\right)^2 \\right]\n$$\nThe lowest cutoff angular frequency $\\omega_c$ corresponds to the minimum of these values, which occurs for $(m,n)=(1,1)$. Thus, $f_c = \\frac{\\omega_{1,1}}{2\\pi} = \\frac{1}{2\\sqrt{\\mu\\epsilon}}\\sqrt{(\\frac{1}{a})^2 + (\\frac{1}{b})^2}$.\n\n**Inhomogeneous Case (Case 5):**\nFor spatially varying $\\epsilon(x,y)$, the matrices $\\mathbf{A}$ and $\\mathbf{B}$ are generally not diagonal and the integrals must be computed numerically. As specified, we use a uniform tensor-product grid with midpoint sampling. The integrals are approximated by a sum over grid points $(x_k, y_l)$:\n$$\nA_{ij} \\approx \\mu^{-1} \\sum_{k,l} (\\nabla \\phi_i \\cdot \\nabla \\phi_j)|_{(x_k,y_l)} \\Delta x \\Delta y\n$$\n$$\nB_{ij} \\approx \\sum_{k,l} \\epsilon(x_k,y_l) (\\phi_i \\phi_j)|_{(x_k,y_l)} \\Delta x \\Delta y\n$$\nwhere $\\Delta x=a/N_{grid_x}$ and $\\Delta y=b/N_{grid_y}$ are the grid spacings. These dense, symmetric matrices are then used in a numerical generalized eigenvalue solver to find the eigenvalues $\\omega^2$. The smallest eigenvalue gives the approximation for $\\omega_c^2$, from which the lowest cutoff frequency $f_c = \\sqrt{\\omega_c^2}/(2\\pi)$ is calculated.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh\nfrom scipy.constants import c, epsilon_0, mu_0\n\ndef solve():\n    \"\"\"\n    Main function to compute and print waveguide cutoff frequencies for all test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1 (homogeneous vacuum rectangular waveguide)\n        {'a': 0.02286, 'b': 0.01016, 'er': 1.0, 'mur': 1.0, 'M': 3, 'N': 3},\n        # Case 2 (homogeneous dielectric-filled rectangular waveguide)\n        {'a': 0.02286, 'b': 0.01016, 'er': 2.25, 'mur': 1.0, 'M': 3, 'N': 3},\n        # Case 3 (homogeneous vacuum square waveguide)\n        {'a': 0.030, 'b': 0.030, 'er': 1.0, 'mur': 1.0, 'M': 4, 'N': 4},\n        # Case 4 (homogeneous vacuum, narrow height)\n        {'a': 0.020, 'b': 0.0020, 'er': 1.0, 'mur': 1.0, 'M': 3, 'N': 3},\n        # Case 5 (inhomogeneous)\n        {'a': 0.040, 'b': 0.040, 'er': {'bg': 1.0, 'inc': 2.25, 'r': 0.010}, 'mur': 1.0, 'M': 4, 'N': 4, 'grid': 201},\n    ]\n\n    results = []\n    for case in test_cases:\n        if isinstance(case['er'], (int, float)):\n            fc = compute_homogeneous_fc(case)\n        else:\n            fc = compute_inhomogeneous_fc(case)\n        results.append(f\"{fc:.6g}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef compute_homogeneous_fc(params):\n    \"\"\"\n    Computes the lowest TM cutoff frequency for a homogeneous rectangular waveguide.\n    The Rayleigh-Ritz method with the chosen basis functions yields the exact analytical\n    result, so the generalized eigenvalue problem is diagonal. The lowest eigenvalue\n    corresponds to the TM11 mode.\n    \"\"\"\n    a, b, er, mur = params['a'], params['b'], params['er'], params['mur']\n    \n    # Speed of light in the medium\n    v = c / np.sqrt(er * mur)\n    \n    # Lowest TM mode is TM11\n    m, n = 1, 1\n    \n    # Cutoff frequency formula\n    fc = (v / 2.0) * np.sqrt((m / a)**2 + (n / b)**2)\n    \n    return fc\n\ndef compute_inhomogeneous_fc(params):\n    \"\"\"\n    Computes the lowest TM cutoff frequency for an inhomogeneous rectangular waveguide\n    using the Rayleigh-Ritz method with numerical quadrature.\n    \"\"\"\n    a, b, mur, M, N = params['a'], params['b'], params['mur'], params['M'], params['N']\n    er_params = params['er']\n    grid_res = params['grid']\n    \n    mu = mur * mu_0\n    basis_size = M * N\n    \n    # Create grid for numerical integration (midpoint rule)\n    nx, ny = grid_res, grid_res\n    dx = a / nx\n    dy = b / ny\n    x_pts = (np.arange(nx) + 0.5) * dx\n    y_pts = (np.arange(ny) + 0.5) * dy\n\n    # Matrix construction\n    A = np.zeros((basis_size, basis_size))\n    B = np.zeros((basis_size, basis_size))\n\n    # Single-index to (m, n) mapping\n    m_indices = np.array([(i // N) + 1 for i in range(basis_size)])\n    n_indices = np.array([(i % N) + 1 for i in range(basis_size)])\n\n    # Permittivity function over the grid\n    X, Y = np.meshgrid(x_pts, y_pts)\n    is_inclusion = ((X - a / 2)**2 + (Y - b / 2)**2) = er_params['r']**2\n    eps_grid = np.full_like(X, er_params['bg'] * epsilon_0)\n    eps_grid[is_inclusion] = er_params['inc'] * epsilon_0\n\n    # Basis function args\n    mx_a = m_indices[:, np.newaxis, np.newaxis] * np.pi * x_pts[np.newaxis, np.newaxis, :] / a\n    ny_b = n_indices[:, np.newaxis, np.newaxis] * np.pi * y_pts[np.newaxis, :, np.newaxis] / b\n    \n    # Precompute sin and cos values on the grid for all basis functions\n    sin_mx = np.sin(mx_a)\n    cos_mx = np.cos(mx_a)\n    sin_ny = np.sin(ny_b)\n    cos_ny = np.cos(ny_b)\n    \n    # Iterate over grid points to build matrices A and B\n    for k in range(nx):\n        for l in range(ny):\n            # Values of basis functions and their gradients at (x_k, y_l)\n            # phi_i = sin(m_i*pi*x/a) * sin(n_i*pi*y/b)\n            phi_vals = sin_mx[:, 0, k] * sin_ny[:, l, 0]\n            \n            # grad_phi_i = [ m_i*pi/a * cos(...)sin(...), n_i*pi/b * sin(...)cos(...) ]\n            grad_x = (m_indices * np.pi / a) * cos_mx[:, 0, k] * sin_ny[:, l, 0]\n            grad_y = (n_indices * np.pi / b) * sin_mx[:, 0, k] * cos_ny[:, l, 0]\n            \n            # Update A and B using outer products for efficiency\n            grad_dot_prod_matrix = np.outer(grad_x, grad_x) + np.outer(grad_y, grad_y)\n            phi_prod_matrix = np.outer(phi_vals, phi_vals)\n            \n            A += grad_dot_prod_matrix\n            B += eps_grid[l, k] * phi_prod_matrix\n            \n    # Final scaling of matrices with constants and area element\n    area_element = dx * dy\n    A *= (1 / mu) * area_element\n    B *= area_element\n    \n    # Solve the generalized eigenvalue problem A*c = omega^2 * B*c\n    # eigh returns sorted eigenvalues\n    eigenvalues_sq, _ = eigh(A, B)\n    \n    # Smallest eigenvalue is omega_c^2\n    omega_c_sq = eigenvalues_sq[0]\n    \n    # Check for non-physical results\n    if omega_c_sq  0:\n        # If numerically unstable, take abs, as omega^2 must be positive\n        omega_c = np.sqrt(np.abs(omega_c_sq))\n    else:\n        omega_c = np.sqrt(omega_c_sq)\n        \n    fc = omega_c / (2 * np.pi)\n    \n    return fc\n\nif __name__ == '__main__':\n    solve()\n\n```", "id": "3360822"}]}