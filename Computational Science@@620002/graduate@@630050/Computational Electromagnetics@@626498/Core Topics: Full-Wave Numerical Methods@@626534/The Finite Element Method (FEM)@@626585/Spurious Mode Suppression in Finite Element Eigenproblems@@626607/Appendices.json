{"hands_on_practices": [{"introduction": "To effectively suppress spurious modes, we must first understand their origin. This practice builds intuition by dissecting a simplified one-dimensional analogue of the Maxwell eigenproblem, revealing how an inappropriate choice of finite elements—specifically standard nodal elements—fails to correctly represent the nullspace of the curl operator. By working through this \"toy model,\" you will gain a foundational understanding of the mechanism that pollutes the spectrum and appreciate why specialized $H(\\mathrm{curl})$-conforming elements are essential for accurate simulations. [@problem_id:3350389]", "problem": "Consider the time-harmonic, source-free Maxwell eigenproblem in a perfectly electrically conducting (PEC) cavity, written in variational form: find an electric field $\\mathbf{E} \\in H(\\mathrm{curl},\\Omega)$ and a wavenumber $\\kappa^{2} \\in \\mathbb{R}$ such that\n$$\n\\int_{\\Omega} \\mu^{-1} \\, (\\nabla \\times \\mathbf{E}) \\cdot (\\nabla \\times \\mathbf{v}) \\, \\mathrm{d}\\mathbf{x} \\;=\\; \\kappa^{2} \\int_{\\Omega} \\epsilon \\, \\mathbf{E}\\cdot \\mathbf{v} \\, \\mathrm{d}\\mathbf{x}\n\\quad \\text{for all } \\mathbf{v} \\in H(\\mathrm{curl},\\Omega),\n$$\nwith PEC boundary condition $\\mathbf{n}\\times \\mathbf{E} = \\mathbf{0}$ on $\\partial \\Omega$. It is a fundamental fact that the kernel of the curl operator contains all gradients $\\,\\nabla \\phi\\,$ with $\\phi \\in H^{1}_{0}(\\Omega)$, because $\\,\\nabla \\times \\nabla \\phi = \\mathbf{0}$. This nullspace is the root cause of spurious modes when inappropriate finite element spaces are used.\n\nTo expose the mechanism in the simplest setting, construct a one-dimensional ($1$D) toy model on the interval $(0,L)$ that mimics the separation between Transverse Electric (TE) and Transverse Magnetic (TM) families. Model TE with a scalar field $u \\in H^{1}_{0}(0,L)$ and the eigenproblem\n$$\n\\int_{0}^{L} u'(x) \\, v'(x) \\, \\mathrm{d}x \\;=\\; \\lambda \\int_{0}^{L} u(x) \\, v(x) \\, \\mathrm{d}x \\quad \\text{for all } v \\in H^{1}_{0}(0,L),\n$$\nand model the TM gradient subspace by a surrogate scalar field $w \\in H^{1}(0,L)$ that is intended to represent the (illegally) nodal approximation of a field in $H(\\mathrm{curl},\\Omega)$, together with the bilinear form\n$$\na(w,v) \\;=\\; \\int_{0}^{L} \\big(\\mathrm{curl}\\, w\\big)\\,\\big(\\mathrm{curl}\\, v\\big)\\,\\mathrm{d}x,\n$$\nwhere in $1$D we set $\\mathrm{curl}\\, w \\equiv 0$ to mimic the exact vanishing of $\\nabla \\times \\nabla \\phi$ for all scalar potentials $\\phi$ in higher dimensions. Let $V_{h}$ be the space of continuous, piecewise-linear (linear Lagrange) functions on a uniform partition of $(0,L)$ into $n$ subintervals, with no essential boundary conditions imposed, so that $\\dim V_{h} = n+1$.\n\nYou will:\n- Derive, from the above variational bases and from Maxwell’s equations, why the discrete TM surrogate bilinear form vanishes identically on $V_{h}$, turning the generalized eigenproblem into a pure mass-matrix pencil.\n- Show that adding a single mean-zero gauge constraint $\\int_{0}^{L} w_{h}(x)\\,\\mathrm{d}x = 0$ removes exactly one dimension from $V_{h}$ but does not change the fact that all remaining discrete eigenpairs satisfy $\\lambda = 0$, thereby explicitly characterizing the spurious eigenspace.\n- Explain, at a conceptual level, how in higher dimensions the use of edge elements (for example, first-kind Nédélec elements) satisfies a discrete compactness property that prevents gradient fields from polluting the positive spectrum, while nodal elements do not.\n- Propose at least two simple, scientifically sound test fixtures that a practitioner could implement to detect and quantify spurious modes in computational electromagnetics using the Finite Element Method (FEM). Your proposals should be consistent with the above derivation and should isolate the mechanism of spurious mode generation or suppression.\n\nFinally, take $n = 5$ and compute the exact number of spurious zero-eigenvalue modes produced by the mis-discretized TM surrogate on $V_{h}$ after enforcing the single mean-zero gauge constraint. Provide your final answer as a single integer. No rounding is required and no physical units are needed.", "solution": "The problem statement is a valid exercise in computational electromagnetics, specifically concerning the numerical pathology of spurious modes in finite element eigenvalue analysis. It is scientifically grounded, well-posed, objective, and internally consistent. It uses a standard pedagogical one-dimensional ($1$D) model to illustrate a complex phenomenon that occurs in higher dimensions. All terms are defined adequately for the successful completion of the task. We may therefore proceed with a full solution.\n\nThe analysis is structured into four parts as requested, followed by the final numerical calculation.\n\n### Part 1: Vanishing Bilinear Form and Consequent Eigenproblem\n\nThe problem defines a surrogate model for Transverse Magnetic (TM) modes using a scalar field $w$ and a bilinear form $a(w,v)$. The finite element space for this model is $V_{h}$, the space of continuous, piecewise-linear Lagrange functions on a partition of the interval $(0,L)$ into $n$ subintervals, with no essential boundary conditions imposed. The dimension of this space, corresponding to the number of nodes, is $\\dim V_{h} = n+1$.\n\nThe crucial definition for this $1$D toy model is the action of the `curl` operator on a scalar field $w$, which is given as:\n$$\n\\mathrm{curl}\\, w \\equiv 0\n$$\nThis definition is a direct analogue to the vector calculus identity $\\nabla \\times (\\nabla \\phi) = \\mathbf{0}$, where the scalar field $w$ in the $1$D model plays the role of the scalar potential $\\phi$ in three dimensions. The nodal basis functions in $V_h$ are intended to mimic an invalid choice of nodal elements for a vector field in $H(\\mathrm{curl},\\Omega)$, which inadvertently contains this gradient subspace.\n\nThe bilinear form for the TM surrogate is:\n$$\na(w,v) = \\int_{0}^{L} \\big(\\mathrm{curl}\\, w\\big)\\,\\big(\\mathrm{curl}\\, v\\big)\\,\\mathrm{d}x\n$$\nFor any two functions $w_h, v_h \\in V_h$, according to the given definition, we have $\\mathrm{curl}\\, w_h = 0$ and $\\mathrm{curl}\\, v_h = 0$. Consequently, the integrand is identically zero:\n$$\n\\big(\\mathrm{curl}\\, w_h(x)\\big)\\,\\big(\\mathrm{curl}\\, v_h(x)\\big) = 0 \\cdot 0 = 0 \\quad \\text{for all } x \\in (0,L)\n$$\nTherefore, the bilinear form vanishes for all functions in the chosen discrete space:\n$$\na(w_h, v_h) = \\int_{0}^{L} 0 \\,\\mathrm{d}x = 0 \\quad \\text{for all } w_h, v_h \\in V_h\n$$\nThe corresponding generalized eigenvalue problem is to find $(\\lambda, w_h) \\in (\\mathbb{R}, V_h)$ such that for all $v_h \\in V_h$:\n$$\na(w_h, v_h) = \\lambda \\int_{0}^{L} w_h(x) v_h(x) \\,\\mathrm{d}x\n$$\nSubstituting the result that $a(w_h, v_h)=0$, the equation becomes:\n$$\n0 = \\lambda \\int_{0}^{L} w_h(x) v_h(x) \\,\\mathrm{d}x\n$$\nIn a finite element context, this is written as a matrix eigenproblem $\\mathbf{K}\\mathbf{c} = \\lambda \\mathbf{M}\\mathbf{c}$. The stiffness matrix $\\mathbf{K}$ has entries $K_{ij} = a(\\phi_i, \\phi_j)$, where $\\{\\phi_i\\}$ is the basis for $V_h$. From our derivation, $\\mathbf{K}$ is the zero matrix. The mass matrix $\\mathbf{M}$ has entries $M_{ij} = \\int_{0}^{L} \\phi_i \\phi_j \\,\\mathrm{d}x$. Since the basis functions $\\{\\phi_i\\}$ are linearly independent, the mass matrix $\\mathbf{M}$ is symmetric positive definite.\n\nThe eigenproblem $0 = \\lambda \\mathbf{M}\\mathbf{c}$ implies that for any non-zero eigenvector $\\mathbf{c}$, we must have $\\lambda = 0$. Since this holds for any vector in the $(n+1)$-dimensional space, the entire space $V_h$ is an eigenspace corresponding to the eigenvalue $\\lambda=0$. This means the discretization produces $\\dim(V_h) = n+1$ spurious modes, all with eigenvalue zero.\n\n### Part 2: Effect of the Mean-Zero Gauge Constraint\n\nA gauge constraint is introduced:\n$$\n\\int_{0}^{L} w_{h}(x)\\,\\mathrm{d}x = 0\n$$\nLet us define a new space $V_h^0 = \\{w_h \\in V_h \\mid \\int_{0}^{L} w_{h}(x)\\,\\mathrm{d}x = 0\\}$. Any function $w_h \\in V_h$ can be expressed as a linear combination of the basis functions $\\phi_i$ for $i=0, 1, \\dots, n$: $w_h(x) = \\sum_{i=0}^{n} c_i \\phi_i(x)$. The constraint becomes a single linear equation on the coefficients $c_i$:\n$$\n\\sum_{i=0}^{n} c_i \\left( \\int_{0}^{L} \\phi_i(x)\\,\\mathrm{d}x \\right) = 0\n$$\nSince the standard Lagrange \"hat\" basis functions are non-negative and not identically zero, their integrals are positive. This is a non-trivial linear constraint on the $(n+1)$-dimensional space of coefficients. A single linear constraint reduces the dimension of a vector space by exactly one. Therefore, the dimension of the constrained space is:\n$$\n\\dim(V_h^0) = \\dim(V_h) - 1 = (n+1) - 1 = n\n$$\nThe eigenvalue problem is now posed on this smaller space: find $(\\lambda, w_h) \\in (\\mathbb{R}, V_h^0)$ such that $a(w_h, v_h) = \\lambda \\int_0^L w_h v_h \\,dx$ for all $v_h \\in V_h^0$.\nThe fundamental property that $a(w_h, v_h) = 0$ is unaffected by the integral constraint on the functions. It remains true for all functions in $V_h^0 \\subset V_h$. Thus, the eigenproblem on the constrained space is still\n$$\n0 = \\lambda \\int_{0}^{L} w_h(x) v_h(x) \\,\\mathrm{d}x\n$$\nfor all $v_h \\in V_h^0$. For any non-zero eigenfunction $w_h \\in V_h^0$, the eigenvalue $\\lambda$ must be zero. The entire $n$-dimensional space $V_h^0$ is the eigenspace for $\\lambda=0$. The constraint removes one spurious mode, but $n$ spurious modes remain. This explicitly characterizes the spurious eigenspace as the space of mean-zero, continuous, piecewise-linear functions, which has dimension $n$.\n\n### Part 3: Spurious Mode Suppression by Edge Elements\n\nIn higher dimensions ($2$D and $3$D), the root of the problem is the failure of certain finite element spaces to correctly represent the nullspace of the curl operator. The space of square-integrable vector fields with square-integrable curls is denoted $H(\\mathrm{curl},\\Omega)$. The nullspace of the curl operator in the continuous setting is precisely the set of gradient fields: $\\{\\mathbf{u} \\in L^2(\\Omega) \\mid \\nabla \\times \\mathbf{u} = \\mathbf{0}\\} = \\{\\nabla \\phi \\mid \\phi \\in H^1(\\Omega)\\}$.\n\nWhen **nodal elements** are used to discretize a vector field $\\mathbf{E}$, one typically assigns vector-valued degrees of freedom to the nodes of the mesh. The resulting finite element space, let's call it $\\mathbf{V}_h^{\\text{nodal}}$, contains a large subspace of discrete gradients, i.e., fields of the form $\\nabla \\phi_h$ where $\\phi_h$ is a standard scalar (e.g., Lagrange) finite element function. However, for a general $\\mathbf{v}_h \\in \\mathbf{V}_h^{\\text{nodal}}$, the property $\\nabla \\times (\\nabla \\phi_h) = \\mathbf{0}$ is not preserved at the discrete level, meaning the discrete curl of a discrete gradient is not necessarily zero. The stiffness matrix $\\mathbf{K}$ with entries $K_{ij} = \\int_{\\Omega} (\\nabla \\times \\mathbf{v}_i) \\cdot (\\nabla \\times \\mathbf{v}_j) \\,d\\mathbf{x}$ acquires a large, numerically-approximated nullspace that does not accurately correspond to the true analytical nullspace. This mismatch pollutes the computed spectrum with non-physical, spurious modes.\n\n**Edge elements** (e.g., first-kind Nédélec elements) are specifically designed to avoid this problem. Their degrees of freedom are not nodal values, but rather the tangential components of the vector field along the edges of the mesh elements. This construction ensures that the tangential component of the field is continuous across element interfaces, which is exactly the continuity requirement for fields in $H(\\mathrm{curl},\\Omega)$. The resulting finite element space, let's call it $\\mathbf{V}_h^{\\text{edge}}$, possesses a critical property, often represented by a commuting diagram. This property, fundamental to Finite Element Exterior Calculus (FEEC), ensures that the discrete curl of a discrete gradient is exactly zero. That is, if one takes a scalar Lagrange space $S_h$ and the Nédélec edge space $\\mathbf{V}_h^{\\text{edge}}$, then:\n$$\n\\nabla \\times (\\nabla \\phi_h) = \\mathbf{0} \\quad \\text{for all } \\phi_h \\in S_h\n$$\nThis means that the discrete curl nullspace within $\\mathbf{V}_h^{\\text{edge}}$ is precisely the space of discrete gradients $\\{\\nabla\\phi_h \\mid \\phi_h \\in S_h\\}$. This property, often referred to as constructing a stable and conforming cochain complex, ensures that the kernel of the discrete stiffness operator is cleanly separated from the rest of the operator's spectrum. The \"discrete compactness property\" associated with these elements guarantees that the approximation of the non-zero part of the spectrum is convergent and free of spurious modes. The zero-eigenvalue modes corresponding to the gradient fields are correctly captured and do not contaminate the physically meaningful, positive eigenvalues.\n\n### Part 4: Proposed Test Fixtures\n\nHere are two scientifically sound test fixtures to detect and quantify spurious modes in a finite element code for computational electromagnetics.\n\n**1. The Canonical Cavity Resonance Test**\n- **Principle**: This test compares numerical results against a known analytical solution. The rectangular (or cuboid) cavity with Perfectly Electrically Conducting (PEC) walls is an ideal candidate as its resonant frequencies and mode structures (TE and TM) are known exactly.\n- **Implementation**:\n    1.  Model a 2D rectangular cavity of size $a \\times b$ or a 3D cuboid cavity of size $a \\times b \\times c$. Apply PEC boundary conditions ($\\mathbf{n} \\times \\mathbf{E} = \\mathbf{0}$) on all walls.\n    2.  Use the FEM code to compute the lowest, e.g., $20-50$, eigenpairs $(\\kappa_i^2, \\mathbf{E}_i)$.\n    3.  Analytically, the eigenvalues are given by $\\kappa^2_{mnp} = (\\frac{m\\pi}{a})^2 + (\\frac{n\\pi}{b})^2 + (\\frac{p\\pi}{c})^2$, where $m,n,p$ are integers defining the mode order (with appropriate restrictions for TE/TM families).\n- **Detection and Quantification**: Spurious modes are identified in two ways:\n    a.  **Spectrum Pollution**: The computed list of eigenvalues will contain values that do not match any of the analytical $\\kappa^2_{mnp}$ values. These are spurious.\n    b.  **Nullspace Dimension**: A well-behaved discretization (like with edge elements) will produce a cluster of zero eigenvalues corresponding to the gradient fields, cleanly separated from the positive physical eigenvalues. An improper discretization (like with nodal elements) will produce a much larger number of zero or near-zero eigenvalues. The number of such modes can be counted and compared against the theoretical dimension of the discrete gradient space, which for nodal elements is roughly the number of interior mesh nodes.\n\n**2. The Divergence-Check Test**\n- **Principle**: This test leverages a physical property of the eigenmodes. In a source-free region ($\\rho=0$), Maxwell's equations require physical electric field modes to be divergence-free: $\\nabla \\cdot (\\epsilon \\mathbf{E}) = 0$. Spurious modes arising from the incorrect handling of the gradient nullspace often violate this condition significantly.\n- **Implementation**:\n    1.  Solve the eigenproblem for any reasonable cavity geometry (the canonical cavity from Test 1 is suitable).\n    2.  For each computed eigenmode $\\mathbf{E}_i$, calculate the $L^2$-norm of its divergence: $D_i = ||\\nabla \\cdot \\mathbf{E}_i||_{L^2} = (\\int_{\\Omega} |\\nabla \\cdot \\mathbf{E}_i|^2 \\,d\\mathbf{x})^{1/2}$. Note that the divergence should be calculated element-wise, as fields in $H(\\mathrm{curl})$ do not necessarily have globally defined, square-integrable divergence.\n    3.  Plot the computed eigenvalues $\\kappa_i^2$ versus their corresponding divergence norm $D_i$.\n- **Detection and Quantification**: The resulting scatter plot will typically show two distinct populations:\n    a.  **Physical Modes**: These will appear as points with positive eigenvalues $(\\kappa_i^2 > 0)$ and very small divergence norms $(D_i \\approx 0)$.\n    b.  **Spurious Modes**: These will appear as points with large divergence norms $(D_i \\gg 0)$. Their corresponding eigenvalues may be zero or non-zero, polluting the entire spectrum.\n    A practitioner can set a divergence threshold to programmatically identify and count spurious modes, thereby quantifying the quality of the solver and discretization choice.\n\n### Final Calculation\n\nThe problem asks for the number of spurious, zero-eigenvalue modes produced by the mis-discretized TM surrogate on the space $V_h$ after enforcing the single mean-zero gauge constraint, for the specific case where the mesh consists of $n=5$ subintervals.\n\nAs established in Part 2:\n1.  The initial space $V_h$ of continuous, piecewise-linear functions without boundary conditions on a mesh of $n$ elements has a dimension of $n+1$.\n2.  The bilinear form $a(w_h, v_h)$ is identically zero for all functions in this space, meaning every non-zero function is an eigenvector with eigenvalue $\\lambda=0$. The number of spurious modes is initially $n+1$.\n3.  The single gauge constraint $\\int_0^L w_h(x) dx = 0$ is a non-trivial linear constraint that reduces the dimension of the space by $1$.\n4.  The number of remaining spurious modes is the dimension of the constrained space, which is $(n+1) - 1 = n$.\n\nGiven the parameter $n = 5$:\nThe number of spurious zero-eigenvalue modes is $n=5$.", "answer": "$$\\boxed{5}$$", "id": "3350389"}, {"introduction": "A powerful strategy for eliminating spurious modes is to directly enforce the physical constraint they violate: Gauss's law, which dictates that the electric field must be divergence-free ($\\nabla \\cdot (\\epsilon \\mathbf{E}) = 0$) in source-free regions. This exercise challenges you to derive the correct variational problem for a discrete solenoidal projector, a rigorous technique used to \"clean\" a computed field by projecting it onto the subspace of discretely divergence-free fields. Mastering this formulation is a key step toward developing robust and physically accurate finite element solvers for electromagnetics. [@problem_id:3350420]", "problem": "Consider a source-free time-harmonic Maxwell eigenproblem for the electric field in a bounded Lipschitz domain $\\Omega \\subset \\mathbb{R}^3$ with perfectly electric conductor (PEC) boundary condition, where $\\mathbf{n} \\times \\mathbf{E} = \\mathbf{0}$ on $\\partial \\Omega$. The material tensors are assumed isotropic and piecewise smooth, with scalar permittivity $\\varepsilon(\\mathbf{x}) > 0$ and scalar permeability $\\mu(\\mathbf{x}) > 0$.\n\nThe continuous eigenproblem seeks nontrivial $\\mathbf{E} \\in \\mathbf{H}_0(\\mathrm{curl}, \\Omega)$ and $\\omega^2 \\in \\mathbb{R}_+$ such that\n$$\n\\nabla \\times \\left(\\mu^{-1} \\nabla \\times \\mathbf{E}\\right) = \\omega^2 \\varepsilon \\mathbf{E},\n$$\nand, in the source-free case, modes satisfy Gauss's law\n$$\n\\nabla \\cdot (\\varepsilon \\mathbf{E}) = 0 \\quad \\text{in } \\Omega.\n$$\nIn practical finite element computations with Nédélec (edge) elements for $\\mathbf{E}$, spurious gradient modes can pollute the spectrum because $\\nabla \\times (\\nabla \\phi) = \\mathbf{0}$ for any scalar $\\phi$. A common remedy is to construct a discrete solenoidal projector $P_s$ that removes the gradient component from a given discrete field $\\mathbf{E}_h \\in \\mathbf{W}_h \\subset \\mathbf{H}_0(\\mathrm{curl}, \\Omega)$ and produces $P_s \\mathbf{E}_h$ that is orthogonal to all discrete gradients in an appropriate inner product and compatible with the boundary condition.\n\nLet $\\mathbf{W}_h$ be a conforming Nédélec first-kind space enforcing the PEC tangential condition, and let $V_h \\subset H^1_0(\\Omega)$ be a conforming Lagrange nodal space with homogeneous Dirichlet boundary conditions. The goal is to define $\\phi_h \\in V_h$ via a well-posed variational problem so that the projector $P_s \\mathbf{E}_h = \\mathbf{E}_h - \\nabla \\phi_h$ produces a field that is orthogonal to the discrete gradient subspace in a physically meaningful inner product and preserves the PEC tangential boundary condition.\n\nWhich option correctly specifies the variational problem for $\\phi_h$ and the boundary conditions needed to compute the discrete solenoidal projector $P_s \\mathbf{E}_h = \\mathbf{E}_h - \\nabla \\phi_h$ that enforces the source-free constraint $\\nabla \\cdot (\\varepsilon \\, P_s \\mathbf{E}_h) = 0$ and maintains $\\mathbf{n} \\times P_s \\mathbf{E}_h = \\mathbf{0}$ on $\\partial \\Omega$ for heterogeneous $\\varepsilon(\\mathbf{x})$?\n\nA. Solve the weighted Poisson problem: find $\\phi_h \\in V_h$ with $\\phi_h = 0$ on $\\partial \\Omega$ such that for all $v_h \\in V_h$,\n$$\n\\int_{\\Omega} \\varepsilon \\, \\nabla \\phi_h \\cdot \\nabla v_h \\, \\mathrm{d}\\mathbf{x} = \\int_{\\Omega} \\varepsilon \\, \\mathbf{E}_h \\cdot \\nabla v_h \\, \\mathrm{d}\\mathbf{x},\n$$\nand set $P_s \\mathbf{E}_h = \\mathbf{E}_h - \\nabla \\phi_h$.\n\nB. Enforce homogeneous Neumann boundary conditions for $\\phi_h$ to avoid altering normal components at the boundary: find $\\phi_h \\in H^1(\\Omega)$ with $\\partial \\phi_h / \\partial n = 0$ on $\\partial \\Omega$ such that for all $v_h \\in H^1(\\Omega)$,\n$$\n\\int_{\\Omega} \\nabla \\phi_h \\cdot \\nabla v_h \\, \\mathrm{d}\\mathbf{x} = \\int_{\\Omega} \\mathbf{E}_h \\cdot \\nabla v_h \\, \\mathrm{d}\\mathbf{x},\n$$\nand set $P_s \\mathbf{E}_h = \\mathbf{E}_h - \\nabla \\phi_h$.\n\nC. Solve the unweighted Poisson problem regardless of $\\varepsilon$: find $\\phi_h \\in V_h$ with $\\phi_h = 0$ on $\\partial \\Omega$ such that for all $v_h \\in V_h$,\n$$\n\\int_{\\Omega} \\nabla \\phi_h \\cdot \\nabla v_h \\, \\mathrm{d}\\mathbf{x} = \\int_{\\Omega} \\mathbf{E}_h \\cdot \\nabla v_h \\, \\mathrm{d}\\mathbf{x},\n$$\nand set $P_s \\mathbf{E}_h = \\mathbf{E}_h - \\nabla \\phi_h$.\n\nD. Use a curl-curl weighted projection to eliminate irrotational components: find $\\phi_h \\in V_h$ such that for all $v_h \\in V_h$,\n$$\n\\int_{\\Omega} \\mu^{-1} \\, \\left(\\nabla \\times \\nabla \\phi_h\\right) \\cdot \\left(\\nabla \\times \\nabla v_h\\right) \\, \\mathrm{d}\\mathbf{x} = \\int_{\\Omega} \\mu^{-1} \\, \\left(\\nabla \\times \\mathbf{E}_h\\right) \\cdot \\left(\\nabla \\times \\nabla v_h\\right) \\, \\mathrm{d}\\mathbf{x},\n$$\nand set $P_s \\mathbf{E}_h = \\mathbf{E}_h - \\nabla \\phi_h$.\n\nE. Project the charge density and solve a scalar mass equation: find $\\phi_h \\in V_h$ with $\\phi_h = 0$ on $\\partial \\Omega$ such that for all $v_h \\in V_h$,\n$$\n\\int_{\\Omega} \\varepsilon \\, \\phi_h \\, v_h \\, \\mathrm{d}\\mathbf{x} = \\int_{\\Omega} \\nabla \\cdot (\\varepsilon \\mathbf{E}_h) \\, v_h \\, \\mathrm{d}\\mathbf{x},\n$$\nand set $P_s \\mathbf{E}_h = \\mathbf{E}_h - \\nabla \\phi_h$.\n\nSelect the single best option.", "solution": "### Step 1: Extract Givens\n-   **Problem Domain**: A source-free time-harmonic Maxwell eigenproblem in a bounded Lipschitz domain $\\Omega \\subset \\mathbb{R}^3$.\n-   **Boundary Condition**: Perfectly electric conductor (PEC), $\\mathbf{n} \\times \\mathbf{E} = \\mathbf{0}$ on $\\partial \\Omega$.\n-   **Material Properties**: Isotropic, piecewise smooth, scalar permittivity $\\varepsilon(\\mathbf{x}) > 0$ and permeability $\\mu(\\mathbf{x}) > 0$.\n-   **Continuous Eigenproblem**: Find nontrivial $\\mathbf{E} \\in \\mathbf{H}_0(\\mathrm{curl}, \\Omega)$ and $\\omega^2 \\in \\mathbb{R}_+$ such that $\\nabla \\times \\left(\\mu^{-1} \\nabla \\times \\mathbf{E}\\right) = \\omega^2 \\varepsilon \\mathbf{E}$.\n-   **Continuous Constraint**: For source-free modes, $\\nabla \\cdot (\\varepsilon \\mathbf{E}) = 0$ in $\\Omega$.\n-   **Discretization**: Finite element method using Nédélec (edge) elements for $\\mathbf{E}$.\n-   **Discrete Spaces**:\n    -   $\\mathbf{W}_h \\subset \\mathbf{H}_0(\\mathrm{curl}, \\Omega)$: Conforming Nédélec first-kind space for the electric field $\\mathbf{E}_h$. The inclusion in $\\mathbf{H}_0(\\mathrm{curl}, \\Omega)$ implies that $\\mathbf{n} \\times \\mathbf{E}_h = \\mathbf{0}$ on $\\partial \\Omega$ is enforced.\n    -   $V_h \\subset H^1_0(\\Omega)$: Conforming Lagrange nodal space for a scalar potential $\\phi_h$. The inclusion in $H^1_0(\\Omega)$ implies $\\phi_h = 0$ on $\\partial \\Omega$.\n-   **Goal**: Define a discrete solenoidal projector $P_s$ via $P_s \\mathbf{E}_h = \\mathbf{E}_h - \\nabla \\phi_h$.\n-   **Required Properties for Projected Field**:\n    1.  $P_s \\mathbf{E}_h$ is orthogonal to the discrete gradient subspace in a physically meaningful inner product.\n    2.  $\\nabla \\cdot (\\varepsilon \\, P_s \\mathbf{E}_h) = 0$ (in a discrete/weak sense).\n    3.  $\\mathbf{n} \\times P_s \\mathbf{E}_h = \\mathbf{0}$ on $\\partial \\Omega$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem statement describes a standard and well-known issue in the finite element analysis of Maxwell's eigenproblems: the appearance of spurious, non-physical modes. These modes correspond to the infinite-dimensional kernel of the curl operator, which consists of gradient fields. The proposed remedy—projecting the discrete solution onto a discretely divergence-free subspace—is a common and rigorous technique known as divergence cleaning or gauge fixing.\n\n-   **Scientifically Grounded**: The formulation is based on Maxwell's equations and uses standard function spaces from functional analysis ($\\mathbf{H}(\\mathrm{curl}, \\Omega)$, $H^1(\\Omega)$) and discretization schemes (Nédélec and Lagrange elements) that are fundamental to computational electromagnetics. The problem is firmly grounded in established scientific and mathematical principles.\n-   **Well-Posed**: The problem is well-posed. It asks for the specific variational formulation of a Helmholtz-Hodge-type decomposition in a discrete setting. All necessary information (function spaces, desired properties, physical context) is provided to derive a unique, correct formulation.\n-   **Objective**: The language is precise, technical, and free of ambiguity or subjective claims.\n\nThe problem statement is valid. It is a standard question in advanced computational electromagnetics.\n\n### Step 3: Derivation of the Solution\nThe objective is to find a variational problem for a scalar potential $\\phi_h \\in V_h$ such that the projected field $P_s \\mathbf{E}_h = \\mathbf{E}_h - \\nabla \\phi_h$ satisfies the required properties.\n\n**1. Boundary Condition Preservation**\nWe must ensure that the PEC boundary condition is maintained after projection.\nThe initial field $\\mathbf{E}_h$ is in $\\mathbf{W}_h \\subset \\mathbf{H}_0(\\mathrm{curl}, \\Omega)$, so it already satisfies $\\mathbf{n} \\times \\mathbf{E}_h = \\mathbf{0}$ on $\\partial \\Omega$.\nThe projected field must also satisfy this:\n$$ \\mathbf{n} \\times P_s \\mathbf{E}_h = \\mathbf{n} \\times (\\mathbf{E}_h - \\nabla \\phi_h) = \\mathbf{n} \\times \\mathbf{E}_h - \\mathbf{n} \\times \\nabla \\phi_h = \\mathbf{0} $$\nSince $\\mathbf{n} \\times \\mathbf{E}_h = \\mathbf{0}$, this condition simplifies to:\n$$ \\mathbf{n} \\times \\nabla \\phi_h = \\mathbf{0} \\quad \\text{on } \\partial \\Omega $$\nThe term $\\mathbf{n} \\times \\nabla \\phi_h$ represents the surface gradient of $\\phi_h$ on the boundary $\\partial \\Omega$. The condition $\\mathbf{n} \\times \\nabla \\phi_h = \\mathbf{0}$ implies that $\\phi_h$ must be constant on each connected component of the boundary $\\partial \\Omega$.\nThe problem specifies that the space for the potential is $V_h \\subset H^1_0(\\Omega)$. Functions in $H^1_0(\\Omega)$ have a trace of zero on the boundary, i.e., $\\phi_h = 0$ on $\\partial \\Omega$. A function that is zero on the boundary is necessarily constant (with constant value $0$) on the boundary. Therefore, this choice of space $V_h$ correctly enforces the preservation of the PEC boundary condition.\n\n**2. Enforcement of the Source-Free Constraint**\nThe physical source-free condition is Gauss's law for electricity: $\\nabla \\cdot \\mathbf{D} = 0$, where $\\mathbf{D} = \\varepsilon \\mathbf{E}$ is the electric displacement field. Thus, we must enforce $\\nabla \\cdot (\\varepsilon \\mathbf{E}) = 0$.\nFor the projected field, this translates to the condition $\\nabla \\cdot (\\varepsilon \\, P_s \\mathbf{E}_h) = 0$.\nSubstituting the definition of the projector, we get:\n$$ \\nabla \\cdot (\\varepsilon (\\mathbf{E}_h - \\nabla \\phi_h)) = 0 $$\nTo obtain the variational (or weak) form, we multiply by a test function $v_h \\in V_h$ and integrate over the domain $\\Omega$:\n$$ \\int_{\\Omega} v_h \\left[ \\nabla \\cdot (\\varepsilon (\\mathbf{E}_h - \\nabla \\phi_h)) \\right] \\, \\mathrm{d}\\mathbf{x} = 0 \\quad \\forall v_h \\in V_h $$\nWe apply integration by parts (Green's first identity), which states $\\int_\\Omega u (\\nabla \\cdot \\mathbf{F}) \\, \\mathrm{d}\\mathbf{x} = \\int_{\\partial\\Omega} u (\\mathbf{F} \\cdot \\mathbf{n}) \\, \\mathrm{d}S - \\int_\\Omega \\nabla u \\cdot \\mathbf{F} \\, \\mathrm{d}\\mathbf{x}$.\nLet $u = v_h$ and $\\mathbf{F} = \\varepsilon (\\mathbf{E}_h - \\nabla \\phi_h)$. The boundary integral term $\\int_{\\partial\\Omega} v_h (\\dots) \\, \\mathrm{d}S$ vanishes because $v_h \\in V_h \\subset H^1_0(\\Omega)$, which means $v_h = 0$ on $\\partial \\Omega$.\nThe weak form therefore becomes:\n$$ - \\int_{\\Omega} \\nabla v_h \\cdot \\left[ \\varepsilon (\\mathbf{E}_h - \\nabla \\phi_h) \\right] \\, \\mathrm{d}\\mathbf{x} = 0 $$\nDropping the minus sign and distributing the dot product:\n$$ \\int_{\\Omega} \\varepsilon \\, \\nabla v_h \\cdot \\mathbf{E}_h \\ - \\ \\varepsilon \\, \\nabla v_h \\cdot \\nabla \\phi_h \\, \\mathrm{d}\\mathbf{x} = 0 $$\nRearranging to isolate the unknown $\\phi_h$ on the left-hand side, we get the final variational problem: Find $\\phi_h \\in V_h$ such that for all $v_h \\in V_h$:\n$$ \\int_{\\Omega} \\varepsilon \\, \\nabla \\phi_h \\cdot \\nabla v_h \\, \\mathrm{d}\\mathbf{x} = \\int_{\\Omega} \\varepsilon \\, \\mathbf{E}_h \\cdot \\nabla v_h \\, \\mathrm{d}\\mathbf{x} $$\nThis is a standard weighted Poisson problem for $\\phi_h$ with homogeneous Dirichlet boundary conditions inherited from the space $V_h$. The bilinear form on the left is coercive on $H^1_0(\\Omega)$ since $\\varepsilon(\\mathbf{x}) > 0$, guaranteeing a unique solution by the Lax-Milgram theorem. This procedure constitutes an orthogonal projection with respect to the $\\varepsilon$-weighted inner product for gradients.\n\n### Evaluation of Options\n\n**A. Solve the weighted Poisson problem: find $\\phi_h \\in V_h$ with $\\phi_h = 0$ on $\\partial \\Omega$ such that for all $v_h \\in V_h$, $\\int_{\\Omega} \\varepsilon \\, \\nabla \\phi_h \\cdot \\nabla v_h \\, \\mathrm{d}\\mathbf{x} = \\int_{\\Omega} \\varepsilon \\, \\mathbf{E}_h \\cdot \\nabla v_h \\, \\mathrm{d}\\mathbf{x}$, and set $P_s \\mathbf{E}_h = \\mathbf{E}_h - \\nabla \\phi_h$.**\nThis formulation exactly matches our derivation. It uses the correct function space $V_h \\subset H^1_0(\\Omega)$ which preserves the PEC boundary condition. It uses the $\\varepsilon$-weighted inner product, which correctly enforces the weak form of $\\nabla \\cdot (\\varepsilon \\mathbf{E}) = 0$.\n**Verdict: Correct.**\n\n**B. Enforce homogeneous Neumann boundary conditions for $\\phi_h$ to avoid altering normal components at the boundary: find $\\phi_h \\in H^1(\\Omega)$ with $\\partial \\phi_h / \\partial n = 0$ on $\\partial \\Omega$ such that for all $v_h \\in H^1(\\Omega)$, $\\int_{\\Omega} \\nabla \\phi_h \\cdot \\nabla v_h \\, \\mathrm{d}\\mathbf{x} = \\int_{\\Omega} \\mathbf{E}_h \\cdot \\nabla v_h \\, \\mathrm{d}\\mathbf{x}$, and set $P_s \\mathbf{E}_h = \\mathbf{E}_h - \\nabla \\phi_h$.**\nThis option is incorrect for two reasons. First, the homogeneous Neumann condition $\\partial \\phi_h / \\partial n = 0$ does not guarantee that $\\mathbf{n} \\times \\nabla \\phi_h = \\mathbf{0}$, so it fails to preserve the PEC boundary condition. Second, it uses an unweighted inner product ($\\varepsilon$ is missing), which would enforce $\\nabla \\cdot \\mathbf{E} = 0$ instead of the physically correct $\\nabla \\cdot (\\varepsilon \\mathbf{E}) = 0$ for heterogeneous media.\n**Verdict: Incorrect.**\n\n**C. Solve the unweighted Poisson problem regardless of $\\varepsilon$: find $\\phi_h \\in V_h$ with $\\phi_h = 0$ on $\\partial \\Omega$ such that for all $v_h \\in V_h$, $\\int_{\\Omega} \\nabla \\phi_h \\cdot \\nabla v_h \\, \\mathrm{d}\\mathbf{x} = \\int_{\\Omega} \\mathbf{E}_h \\cdot \\nabla v_h \\, \\mathrm{d}\\mathbf{x}$, and set $P_s \\mathbf{E}_h = \\mathbf{E}_h - \\nabla \\phi_h$.**\nThis option uses the correct function space $V_h$ for $\\phi_h$, so the boundary condition is preserved. However, like option B, it uses an unweighted inner product. This corresponds to weakly enforcing $\\nabla \\cdot (\\mathbf{E}_h - \\nabla \\phi_h) = 0$, not $\\nabla \\cdot (\\varepsilon (\\mathbf{E}_h - \\nabla \\phi_h)) = 0$. This is only valid if $\\varepsilon$ is a constant, but the problem deals with heterogeneous $\\varepsilon(\\mathbf{x})$.\n**Verdict: Incorrect.**\n\n**D. Use a curl-curl weighted projection to eliminate irrotational components: find $\\phi_h \\in V_h$ such that for all $v_h \\in V_h$, $\\int_{\\Omega} \\mu^{-1} \\, \\left(\\nabla \\times \\nabla \\phi_h\\right) \\cdot \\left(\\nabla \\times \\nabla v_h\\right) \\, \\mathrm{d}\\mathbf{x} = \\int_{\\Omega} \\mu^{-1} \\, \\left(\\nabla \\times \\mathbf{E}_h\\right) \\cdot \\left(\\nabla \\times \\nabla v_h\\right) \\, \\mathrm{d}\\mathbf{x}$, and set $P_s \\mathbf{E}_h = \\mathbf{E}_h - \\nabla \\phi_h$.**\nThis formulation is nonsensical. By the vector calculus identity $\\nabla \\times (\\nabla \\phi) = \\mathbf{0}$ for any sufficiently regular scalar field $\\phi$, both integrands on the left and right sides of the equation are identically zero. The equation reduces to $0 = 0$ and does not define any problem for $\\phi_h$.\n**Verdict: Incorrect.**\n\n**E. Project the charge density and solve a scalar mass equation: find $\\phi_h \\in V_h$ with $\\phi_h = 0$ on $\\partial \\Omega$ such that for all $v_h \\in V_h$, $\\int_{\\Omega} \\varepsilon \\, \\phi_h \\, v_h \\, \\mathrm{d}\\mathbf{x} = \\int_{\\Omega} \\nabla \\cdot (\\varepsilon \\mathbf{E}_h) \\, v_h \\, \\mathrm{d}\\mathbf{x}$, and set $P_s \\mathbf{E}_h = \\mathbf{E}_h - \\nabla \\phi_h$.**\nThis option proposes a weak form of the algebraic equation $\\varepsilon \\phi_h = \\nabla \\cdot (\\varepsilon \\mathbf{E}_h)$. The correct procedure arises from the Poisson-type equation $\\nabla \\cdot (\\varepsilon \\nabla \\phi_h) = \\nabla \\cdot (\\varepsilon \\mathbf{E}_h)$. As shown in the derivation, the weak form of the correct Poisson equation involves a stiffness matrix (integrals of products of gradients), not a mass matrix (integrals of products of functions). This formulation is incorrect. Furthermore, computing $\\nabla \\cdot (\\varepsilon \\mathbf{E}_h)$ directly is undesirable; the formulation in option A avoids this by using integration by parts.\n**Verdict: Incorrect.**", "answer": "$$\\boxed{A}$$", "id": "3350420"}, {"introduction": "An alternative to the exact projection of fields is the popular penalty method, where the divergence-free constraint is enforced approximately by adding a penalty term to the system's weak form. This computational problem explores the practical trade-offs of this technique, using a simplified block-matrix model to quantify the relationship between the penalty strength $\\alpha$, the suppression of spurious modes, and the unwanted perturbation of physical eigenvalues. Through this hands-on coding exercise, you will investigate how to choose an optimal penalty parameter, a critical skill for the practical application of many finite element methods. [@problem_id:3350403]", "problem": "Consider the source-free frequency-domain Maxwell eigenproblem in a bounded domain with perfectly conducting boundary conditions, stated in terms of the electric field as follows: find the nontrivial field $\\mathbf{E}$ and frequency $\\omega$ such that\n$$\n\\nabla \\times \\left(\\mu^{-1} \\nabla \\times \\mathbf{E}\\right) = \\omega^2 \\, \\epsilon \\, \\mathbf{E}, \\quad \\text{with} \\quad \\nabla \\cdot (\\epsilon \\mathbf{E}) = 0,\n$$\nwhere $\\epsilon$ is the permittivity and $\\mu$ is the permeability. In finite element discretizations that do not exactly enforce the divergence-free constraint $\\nabla \\cdot (\\epsilon \\mathbf{E})=0$, spurious modes contaminate the spectrum unless the constraint is either enforced exactly (e.g., via Lagrange multipliers or projection onto the divergence-free subspace) or weakly enforced via a penalty term added to the bilinear form:\n$$\na_{\\alpha}(\\mathbf{E}_h, \\mathbf{v}_h) = \\int_{\\Omega} \\mu^{-1} \\left(\\nabla \\times \\mathbf{E}_h\\right)\\cdot\\left(\\nabla \\times \\mathbf{v}_h\\right) \\, d\\Omega + \\alpha \\int_{\\Omega} \\left(\\nabla \\cdot (\\epsilon \\mathbf{E}_h)\\right)\\left(\\nabla \\cdot (\\epsilon \\mathbf{v}_h)\\right) \\, d\\Omega,\n$$\nwhere $\\alpha > 0$ is the penalty strength and $\\mathbf{E}_h, \\mathbf{v}_h$ are finite element trial and test fields. The penalty modifies the discrete operator and perturbs the true eigenvalues. A central advanced question is to quantify the perturbation of the true eigenvalues as a function of $\\alpha$, mesh size $h$, and polynomial degree $p$, and to propose and test an $h$–$p$ scaling law for $\\alpha$ that asymptotically suppresses spurious modes while minimizing perturbation of physical eigenvalues.\n\nTo make this question computationally concrete and universally implementable, consider the following principled block-structured discrete model that captures the interaction between the physical (divergence-free) subspace and the spurious (gradient) subspace. Let the discrete field space be decomposed into the direct sum of a physical subspace of dimension $n_{\\mathrm{phys}}$ and a gradient subspace of dimension $n_{\\mathrm{grad}}$. Define the symmetric block operator\n$$\n\\mathbf{A}_{\\alpha}(h,p) = \n\\begin{bmatrix}\n\\mathbf{\\Lambda} & \\beta(h,p)\\,\\mathbf{C} \\\\\n\\beta(h,p)\\,\\mathbf{C}^{\\top} & \\alpha \\mathbf{I}_{n_{\\mathrm{grad}}}\n\\end{bmatrix},\n$$\nwhere:\n- $\\mathbf{\\Lambda} \\in \\mathbb{R}^{n_{\\mathrm{phys}} \\times n_{\\mathrm{phys}}}$ is diagonal with the true physical eigenvalues $\\lambda_1, \\ldots, \\lambda_{n_{\\mathrm{phys}}}$,\n- $\\mathbf{C} \\in \\mathbb{R}^{n_{\\mathrm{phys}} \\times n_{\\mathrm{grad}}}$ models the coupling between physical and spurious components induced by discretization,\n- $\\beta(h,p)$ encodes the magnitude of the physical–spurious coupling as a function of mesh size $h$ and polynomial degree $p$,\n- $\\alpha > 0$ is the penalty strength, and $\\mathbf{I}_{n_{\\mathrm{grad}}}$ is the identity in the gradient subspace.\n\nIn the case of exact constraint enforcement, the operator reduces to the restriction onto the physical subspace,\n$$\n\\mathbf{A}_{\\mathrm{exact}} = \\mathbf{\\Lambda},\n$$\nand the eigenvalues are exactly $\\lambda_1,\\ldots,\\lambda_{n_{\\mathrm{phys}}}$. Under penalty enforcement with finite $\\alpha$, the physical eigenvalues are perturbed by the off-diagonal coupling $\\beta(h,p)\\,\\mathbf{C}$.\n\nFor the purposes of this problem, take:\n- $n_{\\mathrm{phys}}=6$ and $n_{\\mathrm{grad}}=4$,\n- $\\mathbf{\\Lambda} = \\mathrm{diag}\\left(\\lambda_1,\\ldots,\\lambda_6\\right)$ with $\\lambda_k = \\pi^2 \\cdot s_k$ and $(s_1,\\ldots,s_6) = (2,5,8,10,13,17)$,\n- $\\mathbf{C}$ equal to the $6\\times 4$ matrix with ones on its first four diagonal entries and zeros elsewhere (i.e., $C_{ii}=1$ for $i=1,2,3,4$, and $0$ otherwise),\n- $\\beta(h,p) = \\dfrac{h^p}{p}$.\n\nLet $\\lambda_k^{\\alpha}(h,p)$ denote the first $n_{\\mathrm{phys}}$ eigenvalues of $\\mathbf{A}_{\\alpha}(h,p)$ sorted in nondecreasing order, and define the relative perturbation of the true physical eigenvalues due to penalty enforcement by\n$$\n\\delta(h,p,\\alpha) = \\max_{1\\le k\\le n_{\\mathrm{phys}}} \\left| \\frac{\\lambda_k^{\\alpha}(h,p) - \\lambda_k}{\\lambda_k} \\right|.\n$$\n\nTasks:\n1. Implement the above block-structured model operator and compute the perturbed eigenvalues for given $(h,p,\\alpha)$.\n2. Quantify the maximum relative perturbation $\\delta(h,p,\\alpha)$ for each case in the test suite below.\n3. Propose an optimal scaling law $\\alpha_{\\mathrm{opt}}(h,p)$ that suppresses spurious coupling while controlling eigenvalue perturbation. Justify your proposal using first-principles reasoning involving approximation properties and inverse inequalities. Implement your proposed law as $\\alpha_{\\mathrm{opt}}(h,p) = c \\, \\dfrac{p^2}{h^2}$ with $c=1$ and, for each test case, also compute $\\delta\\big(h,p,\\alpha_{\\mathrm{opt}}(h,p)\\big)$.\n\nUse the following test suite of parameter values, which covers representative, boundary, and edge scenarios:\n- Case 1 (happy path, mild mesh, low order, weak penalty): $(h,p,\\alpha) = (0.5,\\,1,\\,0.1)$,\n- Case 2 (moderately refined mesh, moderate order, moderate penalty not following the proposed scaling): $(h,p,\\alpha) = (0.25,\\,2,\\,1.0)$,\n- Case 3 (refined mesh, higher order, strong penalty): $(h,p,\\alpha) = (0.125,\\,3,\\,100.0)$.\n\nYour program should, for each case, compute two floats:\n- the maximum relative perturbation $\\delta(h,p,\\alpha)$ at the given $\\alpha$,\n- the maximum relative perturbation at the proposed scaling $\\delta\\big(h,p,\\alpha_{\\mathrm{opt}}(h,p)\\big)$,\n\nand produce a single line of output containing these six results aggregated in a comma-separated list enclosed in square brackets in the order\n$$\n\\big[\\delta(h_1,p_1,\\alpha_1), \\delta(h_1,p_1,\\alpha_{\\mathrm{opt},1}), \\delta(h_2,p_2,\\alpha_2), \\delta(h_2,p_2,\\alpha_{\\mathrm{opt},2}), \\delta(h_3,p_3,\\alpha_3), \\delta(h_3,p_3,\\alpha_{\\mathrm{opt},3})\\big],\n$$\nwhere $\\alpha_{\\mathrm{opt},i} = \\alpha_{\\mathrm{opt}}(h_i,p_i)$. The final numeric outputs are dimensionless floats. No physical units are required, and no angles or percentages are involved. The program must be complete and runnable as-is, without any external input or files, and must follow the specified output format exactly.", "solution": "The problem presented is a well-posed and scientifically sound inquiry into a fundamental technique used in computational electromagnetics for finite element analysis. It concerns the suppression of non-physical, or \"spurious,\" solutions that arise from the discretization of Maxwell's eigenproblem when the divergence-free constraint on the electric field is not strictly enforced. The proposed penalty method, which adds a term proportional to the squared divergence of the field, is a standard approach to mitigate this issue. The problem provides a simplified but conceptually correct block-matrix model, $\\mathbf{A}_{\\alpha}(h,p)$, which captures the essential interaction between the physical (divergence-free) and spurious (gradient) subspaces. This model allows for a focused analysis of the effects of the penalty parameter $\\alpha$ on the computed eigenvalues. All parameters and definitions required for a unique numerical solution are provided, and the problem is free of contradictions or ambiguities. It represents a valid and insightful computational exercise.\n\nThe core of the problem is to understand the trade-off in choosing the penalty parameter $\\alpha$. If $\\alpha$ is too small, the spurious modes are not sufficiently penalized and their corresponding eigenvalues may appear within the range of the physical spectrum, corrupting the solution. If $\\alpha$ is too large, the penalty term can excessively perturb the physical modes, leading to inaccurate physical eigenvalues. The goal is to find a scaling for $\\alpha$ with respect to the discretization parameters—mesh size $h$ and polynomial degree $p$—that optimally balances these competing effects.\n\nThe problem asks for the proposal and justification of a scaling law for $\\alpha$. A principled choice can be derived from the properties of the finite element discretization. The penalized weak form is:\n$$\na_{\\alpha}(\\mathbf{E}_h, \\mathbf{v}_h) = \\int_{\\Omega} \\mu^{-1} \\left(\\nabla \\times \\mathbf{E}_h\\right)\\cdot\\left(\\nabla \\times \\mathbf{v}_h\\right) \\, d\\Omega + \\alpha \\int_{\\Omega} \\left(\\nabla \\cdot (\\epsilon \\mathbf{E}_h)\\right)\\left(\\nabla \\cdot (\\epsilon \\mathbf{v}_h)\\right) \\, d\\Omega\n$$\nThe first term, the curl-curl term, corresponds to a second-order differential operator. In a discrete setting, the eigenvalues of the corresponding matrix scale roughly as $(p/h)^2$. The penalty term, $\\alpha \\int_{\\Omega} (\\nabla\\cdot\\mathbf{E}_h)^2 \\, d\\Omega$, is intended to enforce $\\nabla\\cdot\\mathbf{E}_h \\approx 0$. A common heuristic for setting penalty parameters is to balance the operator norms. An \"inverse inequality\" from finite element theory states that for a function $\\mathbf{v}_h$ in the discrete space, the norm of its derivative is bounded by the function's own norm multiplied by a factor dependent on $h$ and $p$, e.g., $\\|\\nabla \\cdot \\mathbf{v}_h\\|_{L^2} \\le C \\frac{p}{h} \\|\\mathbf{v}_h\\|_{L^2}$. The penalty term's contribution to the stiffness matrix involves this derivative, and to ensure it is effective relative to the mass matrix (from the right-hand side of the eigenproblem), a strong penalty is needed. Choosing $\\alpha$ to scale as $(p/h)^2$ is a particularly aggressive scaling strategy. This choice, $\\alpha_{\\mathrm{opt}}(h,p) = c \\, (p/h)^2$, aims to make the penalty term's discrete operator norm comparable to that of the curl-curl operator. This ensures that for any combination of $h$ and $p$, the penalty is strong enough to push the spurious eigenvalues to values significantly larger than the physical eigenvalues of interest. The perturbation of a physical eigenvalue $\\lambda_k$ by a spurious mode with eigenvalue $\\lambda_s \\approx \\alpha$ is approximately proportional to $\\beta^2 / |\\lambda_k - \\alpha|$. By making $\\alpha$ very large via the proposed scaling, the denominator grows, thus minimizing the perturbation. The specific law to be tested is $\\alpha_{\\mathrm{opt}}(h,p) = p^2/h^2$ (i.e., with $c=1$).\n\nThe computational procedure is as follows. For each test case defined by a tuple $(h, p, \\alpha)$, we perform two calculations.\n\nFirst, using the given $\\alpha$:\n1.  The model parameters are set: $n_{\\mathrm{phys}}=6$, $n_{\\mathrm{grad}}=4$. The true physical eigenvalues are $\\lambda_k = \\pi^2 s_k$ for $k=1,\\ldots,6$, with $\\mathbf{s}=(2,5,8,10,13,17)$.\n2.  The $10 \\times 10$ symmetric block matrix $\\mathbf{A}_{\\alpha}(h,p)$ is constructed. The blocks are:\n    -   Top-left ($6 \\times 6$): $\\mathbf{\\Lambda} = \\mathrm{diag}(\\lambda_1, \\ldots, \\lambda_6)$.\n    -   Top-right ($6 \\times 4$) and bottom-left ($4 \\times 6$): The coupling is given by $\\beta(h,p)\\mathbf{C}$ and its transpose, where $\\beta(h,p) = h^p/p$ and $\\mathbf{C}$ is a matrix with $C_{ii}=1$ for $i=1,2,3,4$ and zeros elsewhere.\n    -   Bottom-right ($4 \\times 4$): The penalty is $\\alpha \\mathbf{I}_{4}$.\n3.  The eigenvalues of $\\mathbf{A}_{\\alpha}$ are computed. As the matrix is real and symmetric, all eigenvalues are real. They are sorted in non-decreasing order.\n4.  The first $n_{\\mathrm{phys}}=6$ of these sorted eigenvalues, $\\lambda_k^{\\alpha}$, are the perturbed physical eigenvalues.\n5.  The maximum relative perturbation is calculated as $\\delta(h,p,\\alpha) = \\max_{1\\le k\\le 6} |\\lambda_k^{\\alpha} - \\lambda_k|/\\lambda_k$.\n\nSecond, this entire procedure is repeated using the proposed optimal penalty parameter, $\\alpha_{\\mathrm{opt}}(h,p) = p^2/h^2$, to compute $\\delta(h,p,\\alpha_{\\mathrm{opt}})$.\n\nThis process is applied to all three test cases, and the six resulting $\\delta$ values are collected for the final output.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the eigenvalue perturbation problem for the given test cases.\n    \n    This function implements the block-structured model for a penalized finite\n    element eigenproblem, computes the perturbed eigenvalues for different\n    parameter sets, and quantifies the maximum relative perturbation.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (h, p, alpha_given)\n        (0.5, 1, 0.1),\n        (0.25, 2, 1.0),\n        (0.125, 3, 100.0),\n    ]\n\n    # --- Fixed parameters of the model ---\n    n_phys = 6\n    n_grad = 4\n    \n    # True physical eigenvalues\n    s_k = np.array([2.0, 5.0, 8.0, 10.0, 13.0, 17.0])\n    lambda_true = np.pi**2 * s_k\n    \n    # Coupling matrix C\n    # C is a 6x4 matrix with C_ii=1 for i=1,2,3,4, and 0 otherwise.\n    C = np.zeros((n_phys, n_grad))\n    np.fill_diagonal(C, 1.0)\n    \n    # Diagonal block Lambda\n    Lambda = np.diag(lambda_true)\n\n    results = []\n\n    for h, p, alpha_given in test_cases:\n        # --- Common calculation for both alpha values ---\n        # Coupling magnitude beta\n        beta = (h**p) / p\n        \n        # Off-diagonal blocks\n        coupling_block = beta * C\n        \n        # Upper part of the matrix A is the same for both calculations\n        A_upper = np.hstack([Lambda, coupling_block])\n\n        # --- 1. Calculation for the given alpha ---\n        \n        # Assemble the full matrix A_alpha\n        A_lower_given = np.hstack([coupling_block.T, alpha_given * np.identity(n_grad)])\n        A_alpha_given = np.vstack([A_upper, A_lower_given])\n        \n        # Compute eigenvalues. eigvalsh is for symmetric matrices and is efficient.\n        # The eigenvalues are not guaranteed to be sorted.\n        eigenvalues_given = np.sort(np.linalg.eigvalsh(A_alpha_given))\n        \n        # The first n_phys eigenvalues are the perturbed physical ones.\n        lambda_perturbed_given = eigenvalues_given[:n_phys]\n        \n        # Calculate maximum relative perturbation\n        delta_given = np.max(np.abs((lambda_perturbed_given - lambda_true) / lambda_true))\n        results.append(delta_given)\n\n        # --- 2. Calculation for the proposed optimal alpha ---\n        \n        # Proposed optimal penalty strength\n        alpha_opt = (p**2) / (h**2)\n        \n        # Assemble the full matrix A_alpha_opt\n        A_lower_opt = np.hstack([coupling_block.T, alpha_opt * np.identity(n_grad)])\n        A_alpha_opt = np.vstack([A_upper, A_lower_opt])\n        \n        # Compute eigenvalues\n        eigenvalues_opt = np.sort(np.linalg.eigvalsh(A_alpha_opt))\n        \n        # The first n_phys eigenvalues are the perturbed physical ones.\n        lambda_perturbed_opt = eigenvalues_opt[:n_phys]\n        \n        # Calculate maximum relative perturbation\n        delta_opt = np.max(np.abs((lambda_perturbed_opt - lambda_true) / lambda_true))\n        results.append(delta_opt)\n\n    # Final print statement in the exact required format.\n    # The use of map(str, ...) allows for default float formatting.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3350403"}]}