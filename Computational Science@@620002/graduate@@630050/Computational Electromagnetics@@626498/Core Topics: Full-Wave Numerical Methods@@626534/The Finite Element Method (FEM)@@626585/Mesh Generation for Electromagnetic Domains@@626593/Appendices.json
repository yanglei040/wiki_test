{"hands_on_practices": [{"introduction": "This practice goes to the heart of the finite element method for electromagnetics by focusing on the construction of the fundamental building block: the $H(\\text{curl})$-conforming vector basis function. By deriving the first-order Nédélec basis functions on a reference tetrahedron from first principles, you will gain a concrete understanding of how they ensure tangential field continuity, a critical property for avoiding spurious solutions in electromagnetic simulations [@problem_id:3329964]. This exercise solidifies the theoretical underpinnings of edge elements and their role in discretizing Maxwell's equations.", "problem": "Consider a single tetrahedral element used in the Finite Element Method (FEM) for Computational Electromagnetics (CEM). Let the reference tetrahedron have vertices at $v_{1} = (0,0,0)$, $v_{2} = (1,0,0)$, $v_{3} = (0,1,0)$, and $v_{4} = (0,0,1)$, with the six oriented edges taken as $(1,2)$, $(1,3)$, $(1,4)$, $(2,3)$, $(2,4)$, and $(3,4)$, each oriented from the lower-index vertex to the higher-index vertex. Let the barycentric coordinates be $\\lambda_{1} = 1 - x - y - z$, $\\lambda_{2} = x$, $\\lambda_{3} = y$, and $\\lambda_{4} = z$, with corresponding constant gradients $\\nabla \\lambda_{1}$, $\\nabla \\lambda_{2}$, $\\nabla \\lambda_{3}$, and $\\nabla \\lambda_{4}$.\n\nThe first-kind Nédélec edge-based $H(\\mathrm{curl})$-conforming basis of order $1$ on a tetrahedron is characterized by vector shape functions associated to edges, each possessing a unit tangential line integral along its associated oriented edge and vanishing tangential line integrals on all other edges. Using only these defining properties and the structure provided by barycentric coordinates, perform the following:\n\n1. Construct the explicit local edge-based vector shape functions for the six oriented edges of the reference tetrahedron. Your construction must be derived from first principles based on barycentric coordinates and their gradients, and must satisfy the defining tangential integral properties of first-kind Nédélec functions.\n\n2. For each constructed shape function, compute its tangential trace on every oriented edge and show that the line integrals of the tangential component produce the Kronecker delta property across all six edges.\n\n3. Let the linear vector field be\n$$\n\\mathbf{E}(x,y,z) = \\begin{pmatrix}\nx + 2y + 3z + 1 \\\\\n2x + 3y + z + 2 \\\\\n3x + y + 2z + 3\n\\end{pmatrix}.\n$$\nCompute its first-kind Nédélec interpolation on the reference tetrahedron by evaluating the six edge degrees of freedom (DoF), namely the oriented tangential line integrals $\\int_{e_{ij}} \\mathbf{E} \\cdot \\hat{\\mathbf{t}}_{ij} \\, \\mathrm{d}s$ for the edges $(i,j) \\in \\{(1,2),(1,3),(1,4),(2,3),(2,4),(3,4)\\}$, where $\\hat{\\mathbf{t}}_{ij}$ denotes the unit tangent vector along the edge from $v_{i}$ to $v_{j}$. Then express the interpolant as a linear combination of your six edge shape functions with these coefficients.\n\nReport as your final answer the ordered row matrix of the six interpolation coefficients $(c_{12}, c_{13}, c_{14}, c_{23}, c_{24}, c_{34})$, with exact values and no rounding. There are no physical units in this problem.", "solution": "The user has provided a valid, well-posed problem from the field of computational electromagnetics. The problem requires the construction and verification of first-kind Nédélec basis functions on a reference tetrahedron and the subsequent interpolation of a given vector field. The solution will proceed in three parts as requested.\n\nThe reference tetrahedron has vertices $v_{1} = (0,0,0)$, $v_{2} = (1,0,0)$, $v_{3} = (0,1,0)$, and $v_{4} = (0,0,1)$. The barycentric coordinates are given as $\\lambda_{1} = 1 - x - y - z$, $\\lambda_{2} = x$, $\\lambda_{3} = y$, and $\\lambda_{4} = z$. A position vector in the tetrahedron is $\\mathbf{r} = (x,y,z)$.\n\n### Part 1: Construction of Edge-Based Vector Shape Functions\n\nThe first-kind Nédélec vector basis functions of order $1$ for an edge $e_{ij}$ connecting vertices $v_i$ and $v_j$ are constructed using the barycentric coordinates $\\lambda_i, \\lambda_j$ and their gradients. The general form is:\n$$\n\\mathbf{N}_{ij}(\\mathbf{r}) = \\lambda_i(\\mathbf{r}) \\nabla \\lambda_j(\\mathbf{r}) - \\lambda_j(\\mathbf{r}) \\nabla \\lambda_i(\\mathbf{r})\n$$\nThis form ensures that the tangential component of $\\mathbf{N}_{ij}$ is continuous across element faces and that $\\mathrm{curl}(\\mathbf{N}_{ij})$ is a constant vector, which are key properties for $H(\\mathrm{curl})$-conforming elements.\n\nFirst, we compute the gradients of the barycentric coordinates:\n$$\n\\nabla\\lambda_{1} = \\nabla(1 - x - y - z) = \\begin{pmatrix} -1 \\\\ -1 \\\\ -1 \\end{pmatrix}\n$$\n$$\n\\nabla\\lambda_{2} = \\nabla(x) = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n$$\n\\nabla\\lambda_{3} = \\nabla(y) = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix}\n$$\n$$\n\\nabla\\lambda_{4} = \\nabla(z) = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix}\n$$\nNow, we construct the $6$ basis functions for the oriented edges $(i,j)$ with $i<j$:\n\n1.  **Edge $e_{12}$:** From $v_1$ to $v_2$.\n    $$\n    \\mathbf{N}_{12} = \\lambda_1 \\nabla \\lambda_2 - \\lambda_2 \\nabla \\lambda_1 = (1-x-y-z)\\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} - x\\begin{pmatrix} -1 \\\\ -1 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} 1-y-z \\\\ x \\\\ x \\end{pmatrix}\n    $$\n2.  **Edge $e_{13}$:** From $v_1$ to $v_3$.\n    $$\n    \\mathbf{N}_{13} = \\lambda_1 \\nabla \\lambda_3 - \\lambda_3 \\nabla \\lambda_1 = (1-x-y-z)\\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} - y\\begin{pmatrix} -1 \\\\ -1 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} y \\\\ 1-x-z \\\\ y \\end{pmatrix}\n    $$\n3.  **Edge $e_{14}$:** From $v_1$ to $v_4$.\n    $$\n    \\mathbf{N}_{14} = \\lambda_1 \\nabla \\lambda_4 - \\lambda_4 \\nabla \\lambda_1 = (1-x-y-z)\\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix} - z\\begin{pmatrix} -1 \\\\ -1 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} z \\\\ z \\\\ 1-x-y \\end{pmatrix}\n    $$\n4.  **Edge $e_{23}$:** From $v_2$ to $v_3$.\n    $$\n    \\mathbf{N}_{23} = \\lambda_2 \\nabla \\lambda_3 - \\lambda_3 \\nabla \\lambda_2 = x\\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} - y\\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} -y \\\\ x \\\\ 0 \\end{pmatrix}\n    $$\n5.  **Edge $e_{24}$:** From $v_2$ to $v_4$.\n    $$\n    \\mathbf{N}_{24} = \\lambda_2 \\nabla \\lambda_4 - \\lambda_4 \\nabla \\lambda_2 = x\\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix} - z\\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} -z \\\\ 0 \\\\ x \\end{pmatrix}\n    $$\n6.  **Edge $e_{34}$:** From $v_3$ to $v_4$.\n    $$\n    \\mathbf{N}_{34} = \\lambda_3 \\nabla \\lambda_4 - \\lambda_4 \\nabla \\lambda_3 = y\\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix} - z\\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ -z \\\\ y \\end{pmatrix}\n    $$\n\n### Part 2: Verification of the Kronecker Delta Property\n\nThe defining property of these basis functions is that the line integral of the tangential component of $\\mathbf{N}_{ij}$ along any edge $e_{kl}$ is equal to the Kronecker delta $\\delta_{ij,kl}$:\n$$\n\\int_{e_{kl}} \\mathbf{N}_{ij} \\cdot \\hat{\\mathbf{t}}_{kl} \\, \\mathrm{d}s = 1 \\text{ if } e_{kl} = e_{ij}, \\text{ and } 0 \\text{ otherwise.}\n$$\nLet $\\mathbf{e}_{kl} = v_l - v_k$ be the vector for edge $e_{kl}$. Since barycentric coordinates are linear functions of position, the directional derivative of $\\lambda_m$ along $\\mathbf{e}_{kl}$ is constant and given by $\\nabla\\lambda_m \\cdot \\mathbf{e}_{kl}$. This value is also equal to $\\lambda_m(v_l) - \\lambda_m(v_k)$, which by definition is $\\delta_{ml} - \\delta_{mk}$.\n\nThe tangential component of $\\mathbf{N}_{ij}$ along the direction of $\\mathbf{e}_{kl}$ is:\n$$\n\\mathbf{N}_{ij} \\cdot \\mathbf{e}_{kl} = (\\lambda_i \\nabla \\lambda_j - \\lambda_j \\nabla \\lambda_i) \\cdot \\mathbf{e}_{kl} = \\lambda_i (\\nabla \\lambda_j \\cdot \\mathbf{e}_{kl}) - \\lambda_j (\\nabla \\lambda_i \\cdot \\mathbf{e}_{kl})\n$$\n$$\n\\mathbf{N}_{ij} \\cdot \\mathbf{e}_{kl} = \\lambda_i (\\delta_{jl} - \\delta_{jk}) - \\lambda_j (\\delta_{il} - \\delta_{ik})\n$$\nWe analyze this expression on the edge $e_{kl}$. On this edge, only $\\lambda_k$ and $\\lambda_l$ are non-zero, and they satisfy $\\lambda_k + \\lambda_l = 1$. All other barycentric coordinates $\\lambda_m$ (for $m \\neq k,l$) are zero.\n\nCase 1: The edges are disjoint, i.e., $\\{i,j\\} \\cap \\{k,l\\} = \\emptyset$.\nOn edge $e_{kl}$, both $\\lambda_i$ and $\\lambda_j$ are zero. Thus, $\\mathbf{N}_{ij} \\cdot \\mathbf{e}_{kl} = 0$, and the integral is $0$.\n\nCase 2: The edges share one vertex. Let $k=i$, so the edge is $e_{il}$ with $j \\neq l$.\nOn edge $e_{il}$, $\\lambda_j=0$. The expression becomes $\\mathbf{N}_{ij} \\cdot \\mathbf{e}_{il} = \\lambda_i (\\delta_{jl} - \\delta_{ji})$. Since $j \\neq l$ and $j \\neq i$, both Kronecker deltas are zero. So $\\mathbf{N}_{ij} \\cdot \\mathbf{e}_{il} = 0$, and the integral is $0$.\n\nCase 3: The edges are the same, i.e., $k=i$ and $l=j$.\nWe evaluate $\\mathbf{N}_{ij} \\cdot \\mathbf{e}_{ij}$:\n$$\n\\mathbf{N}_{ij} \\cdot \\mathbf{e}_{ij} = \\lambda_i (\\delta_{jj} - \\delta_{ji}) - \\lambda_j (\\delta_{ij} - \\delta_{ii}) = \\lambda_i(1 - 0) - \\lambda_j(0 - 1) = \\lambda_i + \\lambda_j\n$$\nOn edge $e_{ij}$, we have $\\lambda_i + \\lambda_j = 1$. Therefore, $\\mathbf{N}_{ij} \\cdot \\mathbf{e}_{ij} = 1$. The line integral is:\n$$\n\\int_{e_{ij}} \\mathbf{N}_{ij} \\cdot \\hat{\\mathbf{t}}_{ij} \\, \\mathrm{d}s = \\int_{e_{ij}} \\frac{\\mathbf{N}_{ij} \\cdot \\mathbf{e}_{ij}}{|\\mathbf{e}_{ij}|} \\, \\mathrm{d}s = \\int_{e_{ij}} \\frac{1}{|\\mathbf{e}_{ij}|} \\, \\mathrm{d}s = \\frac{1}{|\\mathbf{e}_{ij}|} \\int_0^{|\\mathbf{e}_{ij}|} \\, \\mathrm{d}s = 1\n$$\nThis demonstrates that $\\int_{e_{kl}} \\mathbf{N}_{ij} \\cdot d\\mathbf{l} = \\delta_{ij,kl}$, satisfying the Kronecker delta property.\n\n### Part 3: Interpolation of the Vector Field\n\nGiven the linear vector field:\n$$\n\\mathbf{E}(x,y,z) = \\begin{pmatrix}\nx + 2y + 3z + 1 \\\\\n2x + 3y + z + 2 \\\\\n3x + y + 2z + 3\n\\end{pmatrix}\n$$\nThe first-kind Nédélec interpolant $\\mathbf{E}_h$ is given by:\n$$\n\\mathbf{E}_h = \\sum_{(i,j)} c_{ij} \\mathbf{N}_{ij}\n$$\nwhere the coefficients (degrees of freedom) $c_{ij}$ are the line integrals of $\\mathbf{E}$ along the corresponding edges:\n$$\nc_{ij} = \\int_{e_{ij}} \\mathbf{E} \\cdot d\\mathbf{l} = \\int_{e_{ij}} \\mathbf{E} \\cdot \\hat{\\mathbf{t}}_{ij} \\, \\mathrm{d}s\n$$\nWe compute these $6$ coefficients:\n\n1.  **$c_{12}$ on $e_{12}$:** $\\mathbf{r}(t) = (t,0,0)$, $d\\mathbf{l}=(1,0,0)dt$, $t \\in [0,1]$.\n    $\\mathbf{E}(t,0,0) = (t+1, 2t+2, 3t+3)^T$.\n    $c_{12} = \\int_0^1 (t+1) dt = \\left[\\frac{1}{2}t^2+t\\right]_0^1 = \\frac{1}{2}+1 = \\frac{3}{2}$.\n\n2.  **$c_{13}$ on $e_{13}$:** $\\mathbf{r}(t) = (0,t,0)$, $d\\mathbf{l}=(0,1,0)dt$, $t \\in [0,1]$.\n    $\\mathbf{E}(0,t,0) = (2t+1, 3t+2, t+3)^T$.\n    $c_{13} = \\int_0^1 (3t+2) dt = \\left[\\frac{3}{2}t^2+2t\\right]_0^1 = \\frac{3}{2}+2 = \\frac{7}{2}$.\n\n3.  **$c_{14}$ on $e_{14}$:** $\\mathbf{r}(t) = (0,0,t)$, $d\\mathbf{l}=(0,0,1)dt$, $t \\in [0,1]$.\n    $\\mathbf{E}(0,0,t) = (3t+1, t+2, 2t+3)^T$.\n    $c_{14} = \\int_0^1 (2t+3) dt = \\left[t^2+3t\\right]_0^1 = 1+3 = 4$.\n\n4.  **$c_{23}$ on $e_{23}$:** $\\mathbf{r}(t) = v_2 + t(v_3-v_2) = (1-t, t, 0)$, $d\\mathbf{l}=(-1,1,0)dt$, $t \\in [0,1]$.\n    $\\mathbf{E}(\\mathbf{r}(t)) = ((1-t)+2t+1, 2(1-t)+3t+2, 3(1-t)+t+3)^T = (t+2, t+4, 6-2t)^T$.\n    $c_{23} = \\int_0^1 \\begin{pmatrix} t+2 \\\\ t+4 \\\\ 6-2t \\end{pmatrix} \\cdot \\begin{pmatrix} -1 \\\\ 1 \\\\ 0 \\end{pmatrix} dt = \\int_0^1 (-(t+2) + (t+4)) dt = \\int_0^1 2 \\, dt = 2$.\n\n5.  **$c_{24}$ on $e_{24}$:** $\\mathbf{r}(t) = v_2 + t(v_4-v_2) = (1-t, 0, t)$, $d\\mathbf{l}=(-1,0,1)dt$, $t \\in [0,1]$.\n    $\\mathbf{E}(\\mathbf{r}(t)) = ((1-t)+3t+1, 2(1-t)+t+2, 3(1-t)+2t+3)^T = (2t+2, 4-t, 6-t)^T$.\n    $c_{24} = \\int_0^1 \\begin{pmatrix} 2t+2 \\\\ 4-t \\\\ 6-t \\end{pmatrix} \\cdot \\begin{pmatrix} -1 \\\\ 0 \\\\ 1 \\end{pmatrix} dt = \\int_0^1 (-(2t+2) + (6-t)) dt = \\int_0^1 (-3t+4) dt = \\left[-\\frac{3}{2}t^2+4t\\right]_0^1 = -\\frac{3}{2}+4 = \\frac{5}{2}$.\n\n6.  **$c_{34}$ on $e_{34}$:** $\\mathbf{r}(t) = v_3 + t(v_4-v_3) = (0, 1-t, t)$, $d\\mathbf{l}=(0,-1,1)dt$, $t \\in [0,1]$.\n    $\\mathbf{E}(\\mathbf{r}(t)) = (2(1-t)+3t+1, 3(1-t)+t+2, (1-t)+2t+3)^T = (t+3, 5-2t, t+4)^T$.\n    $c_{34} = \\int_0^1 \\begin{pmatrix} t+3 \\\\ 5-2t \\\\ t+4 \\end{pmatrix} \\cdot \\begin{pmatrix} 0 \\\\ -1 \\\\ 1 \\end{pmatrix} dt = \\int_0^1 (-(5-2t) + (t+4)) dt = \\int_0^1 (3t-1) dt = \\left[\\frac{3}{2}t^2-t\\right]_0^1 = \\frac{3}{2}-1 = \\frac{1}{2}$.\n\nThe six interpolation coefficients are $(c_{12}, c_{13}, c_{14}, c_{23}, c_{24}, c_{34}) = (\\frac{3}{2}, \\frac{7}{2}, 4, 2, \\frac{5}{2}, \\frac{1}{2})$.\nThe Nédélec interpolant of $\\mathbf{E}$ is:\n$$\n\\mathbf{E}_h(\\mathbf{r}) = \\frac{3}{2}\\mathbf{N}_{12}(\\mathbf{r}) + \\frac{7}{2}\\mathbf{N}_{13}(\\mathbf{r}) + 4\\mathbf{N}_{14}(\\mathbf{r}) + 2\\mathbf{N}_{23}(\\mathbf{r}) + \\frac{5}{2}\\mathbf{N}_{24}(\\mathbf{r}) + \\frac{1}{2}\\mathbf{N}_{34}(\\mathbf{r})\n$$\nThe problem requests the ordered row matrix of these six coefficients as the final answer.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{3}{2} & \\frac{7}{2} & 4 & 2 & \\frac{5}{2} & \\frac{1}{2}\n\\end{pmatrix}\n}\n$$", "id": "3329964"}, {"introduction": "Moving from a single element to a larger computational domain often involves handling periodic structures, such as phased arrays or metamaterials. This practice explores how the physical principle of Bloch-Floquet periodicity is translated into numerical constraints within an edge-based finite element framework [@problem_id:3329993]. You will derive the mapping between degrees of freedom on periodic boundaries and see how this directly modifies the global system matrix, a fundamental technique in the analysis of periodic devices.", "problem": "Consider a periodic electromagnetic unit cell in the $x$-direction with lattice vector $\\mathbf{L} = a\\,\\hat{\\mathbf{x}}$, where $a > 0$. A conforming edge-based mesh employing first-order Nédélec edge elements is generated so that each edge on the left periodic boundary $\\Gamma_{L}$ is paired with a corresponding edge on the right periodic boundary $\\Gamma_{R}$ via translation by $\\mathbf{L}$. The mesh generator provides the pairing and an orientation flag $s \\in \\{-1, +1\\}$ for each paired edge, where $s = +1$ indicates that the oriented tangent of the right edge after translation coincides with the oriented tangent of the left edge, and $s = -1$ indicates a reversal.\n\nIn the time-harmonic setting with angular frequency $\\omega$, the electric field $\\mathbf{E}(\\mathbf{x})$ satisfies Bloch-Floquet periodicity with Bloch vector $\\mathbf{k}$, namely\n$$\n\\mathbf{E}(\\mathbf{x} + \\mathbf{L}) = \\mathbf{E}(\\mathbf{x}) \\exp\\!\\big(i\\,\\mathbf{k}\\cdot \\mathbf{L}\\big).\n$$\nAn edge-based degree of freedom (DOF) associated to a mesh edge $e$ is defined as \n$$\nu_e = \\int_{e} \\mathbf{E}(\\mathbf{x}) \\cdot \\hat{\\mathbf{t}}_e \\, \\mathrm{d}s,\n$$\nwhere $\\hat{\\mathbf{t}}_e$ is the unit tangent oriented consistently with the global edge orientation.\n\n1. Starting from the Bloch-Floquet condition and the definition of the edge-based DOF, derive the mapping relation for a paired edge DOF between $\\Gamma_{L}$ and $\\Gamma_{R}$, i.e., express $u_{R}$ in terms of $u_{L}$, the orientation sign $s$, and the phase $\\phi = \\mathbf{k}\\cdot \\mathbf{L}$.\n\n2. Consider the $2 \\times 2$ local boundary coupling submatrix contributed by the curl-curl and mass terms in a homogeneous isotropic material, restricted to a single paired boundary edge DOF $(p \\leftrightarrow q)$, where $p$ indexes the left edge DOF and $q$ indexes its right-periodic pair. Assume the local submatrix is real-symmetric,\n$$\n\\begin{pmatrix}\nA_{pp} & A_{pq} \\\\\nA_{qp} & A_{qq}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\alpha & \\beta \\\\\n\\beta & \\alpha\n\\end{pmatrix},\n$$\nwith $\\alpha > 0$ and $\\beta > 0$. Use the mapping relation from part 1 and a congruence reduction based on the substitution $u_q = s \\exp(i \\phi)\\,u_p$ to derive the reduced single-DOF effective contribution to the global matrix entry associated with the retained DOF $p$, denoted $A^{\\mathrm{eff}}_{pp}$, in closed form as a function of $\\alpha$, $\\beta$, $s$, and $\\phi$.\n\n3. For a unit cell with $a = 5\\,\\mathrm{mm}$ and a Bloch vector $\\mathbf{k} = k_x \\hat{\\mathbf{x}}$ with $k_x = \\pi/(3 a)$, take the orientation flag to be $s = -1$. Let $\\alpha = 1.8$ and $\\beta = 0.6$ (dimensionless, as the matrix has been non-dimensionalized by appropriate scaling of material parameters and frequency). Compute the numerical value of $A^{\\mathrm{eff}}_{pp}$. Express your answer as a dimensionless real number. No rounding is required. Angles must be treated in radians.", "solution": "The problem is assessed to be valid as it is scientifically grounded in the principles of computational electromagnetics and Bloch-Floquet theory, is well-posed with a clear and complete setup, and is expressed in objective, formal language. We may proceed with the solution.\n\nThe solution is presented in three parts, corresponding to the three tasks in the problem statement.\n\n1. Derivation of the DOF mapping relation.\n\nLet $e_L$ be an edge on the left periodic boundary $\\Gamma_L$ and $e_R$ be its corresponding paired edge on the right periodic boundary $\\Gamma_R$. The DOFs associated with these edges are given by:\n$$u_L = \\int_{e_L} \\mathbf{E}(\\mathbf{x}) \\cdot \\hat{\\mathbf{t}}_L \\, \\mathrm{d}s$$\n$$u_R = \\int_{e_R} \\mathbf{E}(\\mathbf{x}') \\cdot \\hat{\\mathbf{t}}_R \\, \\mathrm{d}s'$$\nwhere $\\hat{\\mathbf{t}}_L$ and $\\hat{\\mathbf{t}}_R$ are the unit tangents defining the orientation of edges $e_L$ and $e_R$, respectively.\n\nThe points on the right edge $e_R$ are related to the points on the left edge $e_L$ by the lattice vector translation $\\mathbf{L} = a\\,\\hat{\\mathbf{x}}$, such that for every point $\\mathbf{x} \\in e_L$, there is a corresponding point $\\mathbf{x}' = \\mathbf{x} + \\mathbf{L}$ on $e_R$. We can re-parameterize the integral for $u_R$ over the path $e_L$. The differential arc length element is invariant under translation, so $\\mathrm{d}s' = \\mathrm{d}s$. The integral becomes:\n$$u_R = \\int_{e_L} \\mathbf{E}(\\mathbf{x} + \\mathbf{L}) \\cdot \\hat{\\mathbf{t}}_R \\, \\mathrm{d}s$$\nWe apply the Bloch-Floquet periodicity condition, $\\mathbf{E}(\\mathbf{x} + \\mathbf{L}) = \\mathbf{E}(\\mathbf{x}) \\exp(i\\,\\mathbf{k}\\cdot \\mathbf{L})$. Substituting this into the integral for $u_R$:\n$$u_R = \\int_{e_L} \\left[ \\mathbf{E}(\\mathbf{x}) \\exp(i\\,\\mathbf{k}\\cdot \\mathbf{L}) \\right] \\cdot \\hat{\\mathbf{t}}_R \\, \\mathrm{d}s$$\nThe term $\\exp(i\\,\\mathbf{k}\\cdot \\mathbf{L})$ is a constant scalar with respect to the integration variable $\\mathbf{x}$ and can be factored out of the integral. Letting $\\phi = \\mathbf{k}\\cdot \\mathbf{L}$:\n$$u_R = \\exp(i\\phi) \\int_{e_L} \\mathbf{E}(\\mathbf{x}) \\cdot \\hat{\\mathbf{t}}_R \\, \\mathrm{d}s$$\nNext, we relate the tangent vectors. The edge $e_R$ is a translation of $e_L$. The tangent vector field of a curve is invariant under translation. The orientation of the edge, however, is a convention set by the mesh generator. The orientation flag $s \\in \\{-1, +1\\}$ is defined to relate the oriented tangent of the right edge, $\\hat{\\mathbf{t}}_R$, to that of the left edge, $\\hat{\\mathbf{t}}_L$. This relationship is $\\hat{\\mathbf{t}}_R = s\\,\\hat{\\mathbf{t}}_L$.\nSubstituting this into the expression for $u_R$:\n$$u_R = \\exp(i\\phi) \\int_{e_L} \\mathbf{E}(\\mathbf{x}) \\cdot (s\\,\\hat{\\mathbf{t}}_L) \\, \\mathrm{d}s$$\nThe scalar $s$ can also be factored out:\n$$u_R = s \\exp(i\\phi) \\int_{e_L} \\mathbf{E}(\\mathbf{x}) \\cdot \\hat{\\mathbf{t}}_L \\, \\mathrm{d}s$$\nThe remaining integral is precisely the definition of the DOF for the left edge, $u_L$. Therefore, the mapping relation is:\n$$u_R = s \\exp(i\\phi) u_L$$\nTo match the notation for Part 2 with $p$ for the left DOF and $q$ for the right DOF, this is written as $u_q = s \\exp(i\\phi) u_p$.\n\n2. Derivation of the effective matrix entry $A^{\\mathrm{eff}}_{pp}$.\n\nThe quadratic form associated with the local $2 \\times 2$ submatrix for the paired DOFs $(u_p, u_q)$ is given by:\n$$Q = \\begin{pmatrix} u_p^* & u_q^* \\end{pmatrix} \\begin{pmatrix} A_{pp} & A_{pq} \\\\ A_{qp} & A_{qq} \\end{pmatrix} \\begin{pmatrix} u_p \\\\ u_q \\end{pmatrix}$$\nwhere $*$ denotes the complex conjugate. Substituting the given matrix values:\n$$Q = \\begin{pmatrix} u_p^* & u_q^* \\end{pmatrix} \\begin{pmatrix} \\alpha & \\beta \\\\ \\beta & \\alpha \\end{pmatrix} \\begin{pmatrix} u_p \\\\ u_q \\end{pmatrix} = \\alpha u_p^* u_p + \\beta u_p^* u_q + \\beta u_q^* u_p + \\alpha u_q^* u_q$$\n$$Q = \\alpha |u_p|^2 + \\beta (u_p^* u_q + u_q^* u_p) + \\alpha |u_q|^2$$\nThe DOF $u_q$ is not independent but is constrained by the relation derived in Part 1: $u_q = s \\exp(i\\phi) u_p$. The complex conjugate is $u_q^* = s \\exp(-i\\phi) u_p^*$, since $s$ is real.\n\nWe substitute these into the quadratic form to eliminate $u_q$ and $u_q^*$:\n$$Q = \\alpha|u_p|^2 + \\beta \\left( u_p^* (s \\exp(i\\phi) u_p) + (s \\exp(-i\\phi) u_p^*) u_p \\right) + \\alpha |s \\exp(i\\phi) u_p|^2$$\nLet's simplify the terms. Note that $|s \\exp(i\\phi) u_p|^2 = |s|^2 |\\exp(i\\phi)|^2 |u_p|^2 = (s^2)(1)|u_p|^2 = |u_p|^2$ since $s^2=1$.\n$$Q = \\alpha|u_p|^2 + \\beta s \\left( \\exp(i\\phi) u_p^* u_p + \\exp(-i\\phi) u_p^* u_p \\right) + \\alpha |u_p|^2$$\n$$Q = \\alpha|u_p|^2 + \\beta s |u_p|^2 (\\exp(i\\phi) + \\exp(-i\\phi)) + \\alpha |u_p|^2$$\nUsing Euler's formula, $\\exp(i\\phi) + \\exp(-i\\phi) = 2\\cos(\\phi)$.\n$$Q = (2\\alpha + 2 s \\beta \\cos(\\phi)) |u_p|^2$$\nThis reduced quadratic form is $Q = A^{\\mathrm{eff}}_{pp} |u_p|^2$. By comparing the two expressions, we identify the effective matrix entry for the retained DOF $p$ as:\n$$A^{\\mathrm{eff}}_{pp} = 2\\alpha + 2s\\beta\\cos(\\phi)$$\n\n3. Numerical computation of $A^{\\mathrm{eff}}_{pp}$.\n\nWe are given the following values:\n-   Unit cell size parameter $a = 5\\,\\mathrm{mm}$.\n-   Bloch vector component $k_x = \\frac{\\pi}{3 a}$.\n-   Orientation flag $s = -1$.\n-   Matrix parameters $\\alpha = 1.8$ and $\\beta = 0.6$.\n\nFirst, we compute the phase $\\phi = \\mathbf{k} \\cdot \\mathbf{L}$. With $\\mathbf{k} = k_x \\hat{\\mathbf{x}}$ and $\\mathbf{L} = a \\hat{\\mathbf{x}}$, the dot product is:\n$$\\phi = (k_x \\hat{\\mathbf{x}}) \\cdot (a \\hat{\\mathbf{x}}) = k_x a$$\nSubstituting the given expression for $k_x$:\n$$\\phi = \\left(\\frac{\\pi}{3 a}\\right) a = \\frac{\\pi}{3}$$\nThe angle must be treated in radians, which it is. Now we compute $\\cos(\\phi)$:\n$$\\cos(\\phi) = \\cos\\left(\\frac{\\pi}{3}\\right) = \\frac{1}{2}$$\nFinally, we substitute all numerical values into the expression for $A^{\\mathrm{eff}}_{pp}$ derived in Part 2:\n$$A^{\\mathrm{eff}}_{pp} = 2\\alpha + 2s\\beta\\cos(\\phi)$$\n$$A^{\\mathrm{eff}}_{pp} = 2(1.8) + 2(-1)(0.6)\\left(\\frac{1}{2}\\right)$$\n$$A^{\\mathrm{eff}}_{pp} = 3.6 - 2(0.6)\\left(\\frac{1}{2}\\right)$$\n$$A^{\\mathrm{eff}}_{pp} = 3.6 - (1.2)\\left(\\frac{1}{2}\\right)$$\n$$A^{\\mathrm{eff}}_{pp} = 3.6 - 0.6$$\n$$A^{\\mathrm{eff}}_{pp} = 3.0$$\nThe resulting effective matrix entry is a dimensionless real number, as required.", "answer": "$$\\boxed{3.0}$$", "id": "3329993"}, {"introduction": "The quality of a mesh is not just about its topology, but also how well it represents the underlying physics, especially in challenging high-frequency scenarios. This practice investigates the interplay between geometric accuracy and the numerical solution by comparing straight-edged and curvilinear elements for a high-frequency scattering problem [@problem_id:3330003]. By implementing a curvature-adaptive meshing strategy, you will learn how to intelligently distribute mesh elements to resolve rapid phase oscillations, thereby enhancing both the accuracy and efficiency of the simulation.", "problem": "A two-dimensional scattering problem in computational electromagnetics is considered for a Perfect Electric Conductor (PEC) cylinder of radius $a$ centered at the origin and invariant along the $z$-axis. Under a Transverse Magnetic to $z$ ($\\text{TM}_z$) plane-wave incidence, the fields reduce to a scalar Helmholtz equation for the $z$-component of the electric field. In the high-frequency regime where $ka \\gg 1$, a Huygens-type boundary integral for a far-field quantity can be modeled as a highly oscillatory integral over the smooth boundary. To isolate the impact of geometric discretization order on far-field error, consider the canonical oscillatory boundary integral\n$$\nI(\\theta; k, a, \\alpha) = \\int_{0}^{2\\pi} \\exp\\left\\{ i k \\left(\\boldsymbol{e}_i - \\boldsymbol{d}(\\theta) \\right) \\cdot \\boldsymbol{x}(\\psi) \\right\\} \\, \\mathrm{d}s(\\psi),\n$$\nwhere $\\boldsymbol{e}_i = [\\cos\\alpha, \\sin\\alpha]^\\top$ is the incident direction, $\\boldsymbol{d}(\\theta) = [\\cos\\theta, \\sin\\theta]^\\top$ is the observation direction, $\\boldsymbol{x}(\\psi) = a[\\cos\\psi, \\sin\\psi]^\\top$ parametrizes the exact boundary by polar angle $\\psi$, and $\\mathrm{d}s(\\psi)$ is the differential arc length along the boundary. This integral is representative of far-field synthesis based on Huygens sources and captures the essential oscillatory nature of high-$ka$ scattering. The illuminated-region restriction is not imposed to keep the analysis purely geometric.\n\nMesh generation for the boundary integral is performed elementwise over $\\psi \\in [0, 2\\pi)$ using an isoparametric mapping of polynomial order $p$. On each element, local coordinates $\\xi \\in [-1,1]$ are used, and the boundary is represented as\n$$\n\\boldsymbol{x}_h(\\xi) = \\sum_{j=0}^{p} N_j(\\xi) \\, \\boldsymbol{x}(\\psi_j),\n$$\nwhere $N_j(\\xi)$ are the Lagrange shape functions associated with nodes $\\xi_j \\in [-1,1]$ mapped to $\\psi_j \\in [\\psi_0, \\psi_1]$ via uniform spacing, and $\\boldsymbol{x}(\\psi_j)$ are the exact boundary points used as geometry nodes. The differential arc length in the numerical integral is given by\n$$\n\\mathrm{d}s_h(\\xi) = \\left\\| \\frac{\\mathrm{d}\\boldsymbol{x}_h}{\\mathrm{d}\\xi}(\\xi) \\right\\| \\mathrm{d}\\xi.\n$$\n\nCurvature-adaptive meshing is employed to resolve caustic-like concentrations of oscillatory phase. Let the phase function be\n$$\n\\Phi(\\psi; \\theta, \\alpha) = \\left(\\boldsymbol{e}_i - \\boldsymbol{d}(\\theta)\\right) \\cdot \\boldsymbol{x}(\\psi),\n$$\nand note that the local phase curvature is $ \\Phi''(\\psi; \\theta, \\alpha) = \\left(\\boldsymbol{e}_i - \\boldsymbol{d}(\\theta)\\right) \\cdot \\boldsymbol{x}''(\\psi) $. For the exact circle, $\\boldsymbol{x}''(\\psi) = -\\boldsymbol{x}(\\psi)$, so\n$$\n\\Phi''(\\psi; \\theta, \\alpha) = -\\left(\\boldsymbol{e}_i - \\boldsymbol{d}(\\theta)\\right) \\cdot \\boldsymbol{x}(\\psi) = -a \\left[ \\cos(\\psi - \\alpha) - \\cos(\\psi - \\theta) \\right].\n$$\nTo control phase variation within each element, we enforce the heuristic bound\n$$\n\\Delta \\phi \\approx \\frac{1}{2} k \\left|\\Phi''(\\psi_c; \\theta, \\alpha)\\right| \\Delta\\psi^2 \\le \\tau,\n$$\nwhere $\\psi_c$ is the element center, $\\Delta\\psi$ is the element angular size, and $\\tau$ is a fixed tolerance. This yields a curvature-adaptive local element size\n$$\n\\Delta\\psi(\\psi_c) = \\sqrt{\\frac{2\\tau}{k \\left|\\Phi''(\\psi_c; \\theta, \\alpha)\\right| + \\varepsilon}},\n$$\nwith $\\varepsilon > 0$ a small regularization to avoid division by zero. The element size is clamped to $[\\Delta\\psi_{\\min}, \\Delta\\psi_{\\max}]$ for robustness.\n\nThe reference far-field integral $I_{\\text{ref}}(\\theta)$ is computed using the exact geometry with a very fine uniform partition of $\\psi$ and high-order Gaussian quadrature, while the approximated far-field $I_p(\\theta)$ is computed using the isoparametric geometry of order $p$ on either a uniform mesh or the curvature-adaptive mesh described above. The far-field error metric for a set of observation angles $\\Theta$ is defined as\n$$\nE = \\max_{\\theta \\in \\Theta} \\frac{\\left| I_p(\\theta) - I_{\\text{ref}}(\\theta) \\right|}{\\left| I_{\\text{ref}}(\\theta) \\right|}.\n$$\n\nStarting from the scalar Helmholtz equation and Huygens’ principle for smooth boundaries, justify the use of the above oscillatory integral as a canonical proxy for far-field synthesis. Derive how geometric representation order $p$ and curvature-adaptive meshing influence the numerical approximation of $I(\\theta)$ via control of phase error and Jacobian accuracy. Implement a program that:\n- Constructs the reference integral $I_{\\text{ref}}(\\theta)$ using the exact circle geometry with a fine uniform mesh.\n- Constructs $I_p(\\theta)$ using isoparametric geometry of order $p$ on either a uniform mesh or a curvature-adaptive mesh with the element size rule given above.\n- Computes the error metric $E$ for specified test cases.\n\nUse $a = 1\\,\\text{m}$, angles in radians, and let the incident angle be $\\alpha = 0$. The wavenumber $k$ is chosen to achieve specified values of $ka$. The final output must be dimensionless floats.\n\nTest suite:\n1. $ka = 30$, $p = 1$ (straight-edged), uniform mesh (no adaptation), $\\Theta = \\{0, \\pi/36, \\pi/12, \\pi/6\\}$.\n2. $ka = 100$, $p = 1$ (straight-edged), curvature-adaptive mesh (adaptation enabled), $\\Theta = \\{0, \\pi/72, \\pi/36, \\pi/9\\}$.\n3. $ka = 100$, $p = 3$ (curvilinear), uniform mesh (no adaptation), $\\Theta = \\{0, \\pi/72, \\pi/36, \\pi/9\\}$.\n4. $ka = 300$, $p = 2$ (curvilinear), curvature-adaptive mesh (adaptation enabled), $\\Theta = \\{0, \\pi/180, \\pi/60, \\pi/18\\}$.\n\nNumerical and algorithmic parameters:\n- Use Gaussian quadrature with at least $8$ points per element for all integrals.\n- For the reference integral, use a uniform partition with at least $2048$ elements over $\\psi \\in [0,2\\pi)$.\n- For uniform meshes in approximate integrals, use $64$ elements over $\\psi \\in [0,2\\pi)$.\n- For curvature-adaptive meshes, use $\\tau = \\pi/2$, $\\Delta\\psi_{\\min} = 2\\pi/1024$, $\\Delta\\psi_{\\max} = 2\\pi/32$, and $\\varepsilon = 10^{-12}$.\n\nYour program should produce a single line of output containing the four error metrics $E$ for the four test cases as a comma-separated list enclosed in square brackets (e.g., \"[e1,e2,e3,e4]\").", "solution": "The problem statement has been validated and is determined to be scientifically sound, well-posed, and objective. It presents a canonical and well-defined problem in computational electromagnetics, providing all necessary parameters and definitions for a unique numerical solution.\n\n### Justification of the Canonical Integral\n\nThe problem originates from the two-dimensional scalar Helmholtz equation, $(\\nabla^2 + k^2)E_z = 0$, which governs the $z$-component of the electric field for Transverse Magnetic to $z$ ($\\text{TM}_z$) scattering. According to Huygens' principle, or more formally the Kirchhoff-Helmholtz integral theorem, the scattered field $E_z^s$ at an observation point $\\boldsymbol{r}$ can be represented by an integral over the boundary $\\partial\\Omega$ of the scatterer:\n$$\nE_z^s(\\boldsymbol{r}) = \\int_{\\partial\\Omega} \\left( E_z(\\boldsymbol{r}') \\frac{\\partial G(\\boldsymbol{r}, \\boldsymbol{r}')}{\\partial n'} - G(\\boldsymbol{r}, \\boldsymbol{r}') \\frac{\\partial E_z(\\boldsymbol{r}')}{\\partial n'} \\right) \\, \\mathrm{d}s(\\boldsymbol{r}'),\n$$\nwhere $G$ is the 2D free-space Green's function, $H_0^{(1)}(k|\\boldsymbol{r}-\\boldsymbol{r}'|)$, and $\\partial/\\partial n'$ is the normal derivative. For a Perfect Electric Conductor (PEC), the total tangential electric field vanishes, so $E_z(\\boldsymbol{r}') = 0$ on $\\partial\\Omega$. The surface current density is related to the normal derivative of the field, $J_z \\propto \\partial E_z / \\partial n'$. The integral simplifies to a radiation integral involving the surface current multiplied by the Green's function.\n\nIn the far-field, where $|\\boldsymbol{r}| \\to \\infty$, the Hankel function (Green's function) has the asymptotic form $G(\\boldsymbol{r}, \\boldsymbol{r}') \\propto \\frac{e^{ik|\\boldsymbol{r}|}}{\\sqrt{k|\\boldsymbol{r}|}} e^{-ik \\boldsymbol{d}(\\theta) \\cdot \\boldsymbol{r}'}$, where $\\boldsymbol{d}(\\theta) = \\boldsymbol{r}/|\\boldsymbol{r}|$ is the observation direction. The far-field pattern is thus proportional to an integral of the form $\\int_{\\partial\\Omega} J_z(\\boldsymbol{r}') e^{-ik \\boldsymbol{d}(\\theta) \\cdot \\boldsymbol{r}'} \\, \\mathrm{d}s(\\boldsymbol{r}')$.\n\nIn the high-frequency regime ($ka \\gg 1$), the Physical Optics (PO) approximation is often used for the surface current $J_z$. It approximates the current on the illuminated portion of the scatterer by twice the incident tangential magnetic field and assumes zero current in the shadow region. For a plane wave incidence with direction $\\boldsymbol{e}_i$, the incident field at a point $\\boldsymbol{x}(\\psi)$ on the boundary has a phase dependence of $e^{ik \\boldsymbol{e}_i \\cdot \\boldsymbol{x}(\\psi)}$. The induced PO current therefore carries this phase factor.\n\nCombining these elements, the far-field integral involves an integrand of the form $e^{ik \\boldsymbol{e}_i \\cdot \\boldsymbol{x}(\\psi)} e^{-ik \\boldsymbol{d}(\\theta) \\cdot \\boldsymbol{x}(\\psi)} = e^{ik(\\boldsymbol{e}_i - \\boldsymbol{d}(\\theta)) \\cdot \\boldsymbol{x}(\\psi)}$. The problem provides the canonical integral:\n$$\nI(\\theta; k, a, \\alpha) = \\int_{0}^{2\\pi} \\exp\\left\\{ i k \\left(\\boldsymbol{e}_i - \\boldsymbol{d}(\\theta) \\right) \\cdot \\boldsymbol{x}(\\psi) \\right\\} \\, \\mathrm{d}s(\\psi),\n$$\nThis integral serves as an excellent proxy for the far-field synthesis problem because it isolates the core numerical challenge: the accurate evaluation of a highly oscillatory integral over a curved boundary. By omitting the amplitude factors and the illuminated/shadow boundary logic of the PO approximation, it allows for a focused analysis of the errors arising purely from the discretization of the geometry $\\boldsymbol{x}(\\psi)$ and the phase function $\\Phi(\\psi) = (\\boldsymbol{e}_i - \\boldsymbol{d}(\\theta)) \\cdot \\boldsymbol{x}(\\psi)$.\n\n### Influence of Geometric Order and Adaptive Meshing\n\nThe numerical approximation of $I(\\theta)$ replaces the exact integral with a sum of integrals over discrete elements, each evaluated using numerical quadrature. The error arises from two primary sources related to the geometry representation: phase error and Jacobian error.\n\n**1. Geometric Representation Order ($p$):**\n\n- **Phase Error:** The accuracy of the integral is critically dependent on how well the numerical phase function $\\Phi_h(\\xi) = (\\boldsymbol{e}_i - \\boldsymbol{d}(\\theta)) \\cdot \\boldsymbol{x}_h(\\xi)$ approximates the exact phase $\\Phi(\\psi)$. The geometric error, $\\|\\boldsymbol{x}(\\psi) - \\boldsymbol{x}_h(\\xi(\\psi))\\|$, directly translates into a phase error, $k |(\\boldsymbol{e}_i - \\boldsymbol{d}(\\theta)) \\cdot (\\boldsymbol{x}(\\psi) - \\boldsymbol{x}_h(\\xi(\\psi)))|$.\n    - For $p=1$ (linear elements), the circular boundary is approximated by an inscribed polygon. This results in a systematic underestimation of the radial position, leading to a significant geometric and phase error, particularly for coarse meshes.\n    - For higher orders ($p > 1$), the isoparametric elements can curve, providing a much better fit to the circular boundary. For instance, a quadratic element ($p=2$) can match the position and tangent at its ends and midpoint, leading to a much smaller geometric error. The representation error for a smooth curve using a polynomial of order $p$ is proportional to $h^{p+1}$, where $h$ is the element size. This higher-order accuracy in geometry translates to higher-order accuracy in the phase, drastically reducing the numerical error for a given number of elements.\n\n- **Jacobian Accuracy:** The differential arc length on the exact circle is $\\mathrm{d}s = a \\, \\mathrm{d}\\psi$. The numerical counterpart is $\\mathrm{d}s_h = \\|\\frac{\\mathrm{d}\\boldsymbol{x}_h}{\\mathrm{d}\\xi}\\| \\mathrm{d}\\xi$. The accuracy of the Jacobian, $\\|\\frac{\\mathrm{d}\\boldsymbol{x}_h}{\\mathrm{d}\\xi}\\|$, which represents the local stretching of the mapping from the reference element to the physical element, is also dependent on $p$. For $p=1$, the arc length of the polygonal segment is always less than the arc length of the circular arc it subtends. Higher-order elements provide a more accurate approximation of the arc length, reducing this source of error.\n\n**2. Curvature-Adaptive Meshing:**\n\nThe integrand is highly oscillatory, with the local frequency of oscillation determined by the derivative of the phase, $\\Phi'(\\psi)$. The stationary phase principle indicates that the main contributions to the integral come from neighborhoods of stationary points, where $\\Phi'(\\psi)=0$, and from boundary endpoints. The rate of phase variation away from these points is governed by the phase curvature, $\\Phi''(\\psi)$.\n\n- **Efficiency:** A uniform mesh is inefficient. It uses the same element size in regions of slow phase variation (where a large element would suffice) and rapid phase variation (where a small element is required).\n- **Targeted Refinement:** The curvature-adaptive meshing strategy is designed to overcome this. The rule $\\Delta\\psi \\propto 1/\\sqrt{k|\\Phi''|}$ places smaller elements where the phase curvature is large and larger elements where it is small. This ensures that the total phase change within any given element, $\\Delta\\phi \\approx \\frac{1}{2} k \\left|\\Phi''(\\psi_c)\\right| \\Delta\\psi^2$, is kept below a fixed tolerance $\\tau$. By concentrating computational effort in regions where the integrand is most challenging to resolve, this approach achieves a desired accuracy with significantly fewer elements than a uniform mesh, especially in the high-frequency ($k \\gg 1$) regime. This makes the numerical integration both more accurate and more efficient. The stationary points have $\\Phi'(\\psi)=0$, but the curvature $\\Phi''$ can still be large nearby, necessitating refinement. The points where $\\Phi''=0$ are inflection points of the phase function, and the rule correctly allows for larger elements there.", "answer": "```python\nimport numpy as np\nfrom scipy.special import roots_legendre\n\n# Problem-defined constants and parameters\nA_RADIUS = 1.0\nALPHA_INCIDENCE = 0.0\n\n# Numerical parameters\nGQ_POINTS = 8\nN_REF_ELEMENTS = 2048\nN_UNIF_ELEMENTS = 64\nTAU_ADAPT = np.pi / 2\nD_PSI_MIN = 2 * np.pi / 1024\nD_PSI_MAX = 2 * np.pi / 32\nEPSILON_ADAPT = 1e-12\nEPSILON_ERROR_DENOM = 1e-15\n\ndef lagrange_poly_and_deriv(p, xis):\n    \"\"\"\n    Computes Lagrange polynomial basis functions and their derivatives.\n    Nodes are uniformly spaced in [-1, 1].\n    \n    Args:\n        p (int): Polynomial order.\n        xis (np.ndarray): Points in [-1, 1] to evaluate the functions at.\n        \n    Returns:\n        tuple[np.ndarray, np.ndarray]: (N, N_prime) matrices of shape (len(xis), p + 1).\n    \"\"\"\n    nodes = np.linspace(-1, 1, p + 1)\n    num_pts = len(xis)\n    N = np.ones((num_pts, p + 1))\n    N_prime = np.zeros((num_pts, p + 1))\n    \n    for j in range(p + 1):\n        # Denominator for N_j and N_j'\n        denom = np.prod(nodes[j] - nodes[np.arange(p + 1) != j])\n        \n        # Calculate N_j(xi)\n        for k in range(p + 1):\n            if j == k: continue\n            N[:, j] *= (xis - nodes[k])\n        N[:, j] /= denom\n        \n        # Calculate N_j'(xi)\n        for m in range(p + 1):\n            if m == j: continue\n            term = np.ones(num_pts)\n            for k in range(p + 1):\n                if k == j or k == m: continue\n                term *= (xis - nodes[k])\n            N_prime[:, j] += term\n        N_prime[:, j] /= denom\n            \n    return N, N_prime\n\ndef create_uniform_mesh(num_elements):\n    \"\"\"Creates a uniform mesh over [0, 2*pi].\"\"\"\n    psi_vals = np.linspace(0, 2 * np.pi, num_elements + 1)\n    return list(zip(psi_vals[:-1], psi_vals[1:]))\n\ndef create_adaptive_mesh(k, theta):\n    \"\"\"Creates a curvature-adaptive mesh over [0, 2*pi].\"\"\"\n    mesh = []\n    psi_current = 0.0\n    \n    while psi_current  2 * np.pi:\n        psi_c_est = psi_current + 1e-6 # Estimate at start of element\n        phi_double_prime = -A_RADIUS * (np.cos(psi_c_est - ALPHA_INCIDENCE) - np.cos(psi_c_est - theta))\n        \n        delta_psi = np.sqrt(2 * TAU_ADAPT / (k * abs(phi_double_prime) + EPSILON_ADAPT))\n        delta_psi = np.clip(delta_psi, D_PSI_MIN, D_PSI_MAX)\n        \n        psi_next = psi_current + delta_psi\n        if psi_next > 2 * np.pi:\n            psi_next = 2 * np.pi\n            \n        mesh.append((psi_current, psi_next))\n        psi_current = psi_next\n        \n    return mesh\n\ndef calculate_integral(k, theta, p, mesh, use_exact_geom):\n    \"\"\"\n    Calculates the boundary integral for a given mesh and geometry representation.\n    \"\"\"\n    total_integral = 0.0j\n    gq_nodes, gq_weights = roots_legendre(GQ_POINTS)\n    \n    e_i = np.array([np.cos(ALPHA_INCIDENCE), np.sin(ALPHA_INCIDENCE)])\n    d_theta = np.array([np.cos(theta), np.sin(theta)])\n    k_vec = k * (e_i - d_theta)\n\n    if not use_exact_geom:\n        N, N_prime = lagrange_poly_and_deriv(p, gq_nodes)\n\n    for psi0, psi1 in mesh:\n        delta_psi = psi1 - psi0\n        psi_c = (psi0 + psi1) / 2.0\n\n        if use_exact_geom:\n            psi_gq = psi_c + (delta_psi / 2.0) * gq_nodes\n            \n            x_gq = A_RADIUS * np.array([np.cos(psi_gq), np.sin(psi_gq)]).T\n            phase = x_gq @ k_vec\n            integrand = np.exp(1j * phase)\n            \n            ds_dpsi = A_RADIUS\n            jac_psi_to_xi = delta_psi / 2.0\n            \n            elem_integral = np.sum(gq_weights * integrand * ds_dpsi * jac_psi_to_xi)\n        else:\n            psi_nodes_geom = np.linspace(psi0, psi1, p + 1)\n            x_nodes = A_RADIUS * np.array([np.cos(psi_nodes_geom), np.sin(psi_nodes_geom)]).T\n            \n            # Interpolated positions and derivatives at GQ points\n            x_h_gq = N @ x_nodes\n            dxh_dxi_gq = N_prime @ x_nodes\n            \n            jacobian_ds_dxi = np.linalg.norm(dxh_dxi_gq, axis=1)\n            \n            phase = x_h_gq @ k_vec\n            integrand = np.exp(1j * phase)\n            \n            elem_integral = np.sum(gq_weights * integrand * jacobian_ds_dxi)\n            \n        total_integral += elem_integral\n        \n    return total_integral\n\ndef solve():\n    test_cases = [\n        {'ka': 30, 'p': 1, 'mesh_type': 'uniform', 'Theta': [0, np.pi/36, np.pi/12, np.pi/6]},\n        {'ka': 100, 'p': 1, 'mesh_type': 'adaptive', 'Theta': [0, np.pi/72, np.pi/36, np.pi/9]},\n        {'ka': 100, 'p': 3, 'mesh_type': 'uniform', 'Theta': [0, np.pi/72, np.pi/36, np.pi/9]},\n        {'ka': 300, 'p': 2, 'mesh_type': 'adaptive', 'Theta': [0, np.pi/180, np.pi/60, np.pi/18]},\n    ]\n    \n    results = []\n    \n    mesh_ref = create_uniform_mesh(N_REF_ELEMENTS)\n    \n    for case in test_cases:\n        ka = case['ka']\n        p = case['p']\n        mesh_type = case['mesh_type']\n        Theta = case['Theta']\n        \n        k = ka / A_RADIUS\n        max_error = 0.0\n        \n        for theta in Theta:\n            # Compute reference integral\n            i_ref = calculate_integral(k, theta, p, mesh_ref, use_exact_geom=True)\n            \n            # Create mesh for approximation\n            if mesh_type == 'uniform':\n                mesh_approx = create_uniform_mesh(N_UNIF_ELEMENTS)\n            else: # adaptive\n                mesh_approx = create_adaptive_mesh(k, theta)\n            \n            # Compute approximate integral\n            i_p = calculate_integral(k, theta, p, mesh_approx, use_exact_geom=False)\n            \n            # Compute relative error\n            error = np.abs(i_p - i_ref) / (np.abs(i_ref) + EPSILON_ERROR_DENOM)\n            if error > max_error:\n                max_error = error\n                \n        results.append(max_error)\n        \n    print(f\"[{','.join(f'{r:.6e}' for r in results)}]\")\n\nsolve()\n\n```", "id": "3330003"}]}