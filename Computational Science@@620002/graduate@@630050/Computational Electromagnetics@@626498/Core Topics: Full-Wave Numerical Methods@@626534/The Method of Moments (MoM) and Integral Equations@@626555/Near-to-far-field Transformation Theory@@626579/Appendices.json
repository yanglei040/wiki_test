{"hands_on_practices": [{"introduction": "The near-to-far-field transformation is rooted in the powerful field equivalence principle, which states that the fields in a source-free region can be reproduced by equivalent electric and magnetic currents on a closed surface enclosing the sources. This exercise provides a foundational proof-of-concept by deriving the far-field radiation pattern of an elementary electric dipole using two distinct methods: direct radiation from the source and a near-to-far-field transformation from equivalent currents on a hypothetical Huygens surface [@problem_id:3333713]. Successfully completing this demonstrates the theoretical consistency that underpins all practical NTFF algorithms.", "problem": "Consider a time-harmonic elementary electric source embedded in a homogeneous, isotropic, and source-free medium characterized by permittivity $\\epsilon$, permeability $\\mu$, wavenumber $k = \\omega \\sqrt{\\mu \\epsilon}$, and intrinsic impedance $\\eta = \\sqrt{\\mu/\\epsilon}$, with the $\\exp(i\\omega t)$ time convention. The source is a point electric dipole with moment $\\mathbf{p} = p_0 \\,\\hat{\\mathbf{z}}$ located at the origin, represented in the frequency domain by the polarization current density $\\mathbf{J}(\\mathbf{r}') = -i\\omega \\mathbf{p}\\,\\delta(\\mathbf{r}')$.\n\nStarting from Maxwell’s equations in the frequency domain and the dyadic Green’s function representation of the radiated electric field in an unbounded homogeneous medium, derive the leading-order far-zone expression for the radiated electric field $\\mathbf{E}^{\\text{ff}}(\\mathbf{r})$ and identify its angular dependence. Then, using Love’s equivalence principle, surround the dipole with a spherical Huygens surface $S$ of radius $a$ and construct equivalent surface currents $\\mathbf{J}_s = \\hat{\\mathbf{n}} \\times \\mathbf{H}$ and $\\mathbf{M}_s = -\\hat{\\mathbf{n}} \\times \\mathbf{E}$ on $S$ that reproduce the exterior field. Using the standard radiation integrals for these equivalent currents, perform a near-to-far-field transformation to obtain the far-zone angular dependence of the radiated field.\n\nConfirm that the angular dependence obtained from the dyadic Green’s function approach matches that obtained from the Huygens surface near-to-far transformation. Express your final result as the normalized angular dependence $f(\\theta,\\phi)$ of the electric far field magnitude (normalized by its maximum over all angles), with the polar angle $\\theta$ measured in radians and the azimuthal angle $\\phi$ measured in radians. Your final answer must be a single closed-form expression for $f(\\theta,\\phi)$, without any units and without any radial dependence.", "solution": "The problem is assessed to be valid. It is a standard, well-posed problem in electromagnetic theory, grounded in fundamental principles (Maxwell's equations, equivalence principle) and free of ambiguity or factual incorrectness. While there is a minor inconsistency between the stated time convention $\\exp(i\\omega t)$ and the conventional sign of the frequency-domain current density for a physical dipole, this only affects the overall phase of the resulting fields and has no impact on the magnitude or its normalized angular dependence, which is the quantity of interest.\n\nThe problem requires deriving the far-field angular dependence of an elementary electric dipole using two different methods and confirming their agreement. The final result is the normalized angular pattern function $f(\\theta, \\phi)$.\n\nLet the spherical coordinate system be $(\\mathbf{r}, \\mathbf{\\theta}, \\mathbf{\\phi})$. The dipole moment is along the z-axis, $\\mathbf{p} = p_0 \\hat{\\mathbf{z}}$. The observation point is $\\mathbf{r} = r\\hat{\\mathbf{r}}$, with $\\hat{\\mathbf{r}} = \\sin\\theta\\cos\\phi\\,\\hat{\\mathbf{x}} + \\sin\\theta\\sin\\phi\\,\\hat{\\mathbf{y}} + \\cos\\theta\\,\\hat{\\mathbf{z}}$.\n\n**Method 1: Direct Radiation from Source Current**\n\nWe begin with the vector potential $\\mathbf{A}(\\mathbf{r})$ generated by the current density $\\mathbf{J}(\\mathbf{r}')$. For the specified $\\exp(i\\omega t)$ time convention, the Helmholtz equation for $\\mathbf{A}$ in the Lorentz gauge is $(\\nabla^2 + k^2)\\mathbf{A} = -\\mu\\mathbf{J}$. The solution is given by the integral:\n$$\n\\mathbf{A}(\\mathbf{r}) = \\mu \\int_V \\mathbf{J}(\\mathbf{r}') \\frac{\\exp(-ik|\\mathbf{r}-\\mathbf{r}'|)}{4\\pi|\\mathbf{r}-\\mathbf{r}'|} dV'\n$$\nThe Green's function $\\exp(-ikR)/(4\\pi R)$ ensures an outgoing wave. The source is a point dipole at the origin, $\\mathbf{r}'=0$, with current density $\\mathbf{J}(\\mathbf{r}') = -i\\omega \\mathbf{p}\\,\\delta(\\mathbf{r}')$. Substituting this into the integral yields:\n$$\n\\mathbf{A}(\\mathbf{r}) = \\mu \\int_V (-i\\omega \\mathbf{p}\\,\\delta(\\mathbf{r}')) \\frac{\\exp(-ik|\\mathbf{r}-\\mathbf{r}'|)}{4\\pi|\\mathbf{r}-\\mathbf{r}'|} dV' = -\\frac{i\\omega\\mu \\mathbf{p}}{4\\pi} \\frac{\\exp(-ikr)}{r}\n$$\nWith $\\mathbf{p} = p_0 \\hat{\\mathbf{z}}$, the vector potential is:\n$$\n\\mathbf{A}(\\mathbf{r}) = -\\frac{i\\omega\\mu p_0}{4\\pi} \\frac{\\exp(-ikr)}{r} \\hat{\\mathbf{z}}\n$$\nIn the far-field zone ($kr \\gg 1$), the radiated electric field $\\mathbf{E}^{\\text{ff}}$ is transverse to the direction of propagation $\\hat{\\mathbf{r}}$ and is related to the transverse component of the vector potential, $\\mathbf{A}_\\perp = \\mathbf{A} - (\\mathbf{A} \\cdot \\hat{\\mathbf{r}})\\hat{\\mathbf{r}}$, by:\n$$\n\\mathbf{E}^{\\text{ff}}(\\mathbf{r}) \\approx -i\\omega \\mathbf{A}_\\perp\n$$\nWe express $\\hat{\\mathbf{z}}$ in spherical coordinates: $\\hat{\\mathbf{z}} = \\cos\\theta\\,\\hat{\\mathbf{r}} - \\sin\\theta\\,\\hat{\\mathbf{\\theta}}$. The transverse component of $\\hat{\\mathbf{z}}$ is $\\hat{\\mathbf{z}}_\\perp = \\hat{\\mathbf{z}} - (\\hat{\\mathbf{z}}\\cdot\\hat{\\mathbf{r}})\\hat{\\mathbf{r}} = (\\cos\\theta\\,\\hat{\\mathbf{r}} - \\sin\\theta\\,\\hat{\\mathbf{\\theta}}) - \\cos\\theta\\,\\hat{\\mathbf{r}} = -\\sin\\theta\\,\\hat{\\mathbf{\\theta}}$. Therefore, the transverse vector potential is:\n$$\n\\mathbf{A}_\\perp(\\mathbf{r}) = -\\frac{i\\omega\\mu p_0}{4\\pi} \\frac{\\exp(-ikr)}{r} (-\\sin\\theta\\,\\hat{\\mathbf{\\theta}}) = \\frac{i\\omega\\mu p_0}{4\\pi} \\frac{\\exp(-ikr)}{r} \\sin\\theta\\,\\hat{\\mathbf{\\theta}}\n$$\nThe far-zone electric field is then:\n$$\n\\mathbf{E}^{\\text{ff}}(\\mathbf{r}) = -i\\omega \\left( \\frac{i\\omega\\mu p_0}{4\\pi} \\frac{\\exp(-ikr)}{r} \\sin\\theta\\,\\hat{\\mathbf{\\theta}} \\right) = \\frac{\\omega^2\\mu p_0}{4\\pi} \\frac{\\exp(-ikr)}{r} \\sin\\theta\\,\\hat{\\mathbf{\\theta}}\n$$\nUsing $k^2 = \\omega^2\\mu\\epsilon$, we can write this as $\\mathbf{E}^{\\text{ff}}(\\mathbf{r}) = \\frac{k^2 p_0}{4\\pi\\epsilon} \\frac{\\exp(-ikr)}{r} \\sin\\theta\\,\\hat{\\mathbf{\\theta}}$.\nThe magnitude of the far-zone electric field is:\n$$\n|\\mathbf{E}^{\\text{ff}}(\\mathbf{r})| = \\left| \\frac{\\omega^2\\mu p_0}{4\\pi} \\right| \\frac{1}{r} |\\sin\\theta|\n$$\nThe angular dependence of the magnitude is given by the function $g(\\theta, \\phi) = |\\sin\\theta|$. Since the polar angle $\\theta$ ranges from $0$ to $\\pi$, $\\sin\\theta \\ge 0$, so we can write this as $g(\\theta, \\phi) = \\sin\\theta$.\n\n**Method 2: Near-to-Far-Field Transformation via Huygens' Principle**\n\nThis method involves two steps: first, determining the exact electric field $\\mathbf{E}$ and magnetic field $\\mathbf{H}$ on a closed surface $S$ enclosing the source (the \"near field\"); second, using these fields to define equivalent surface currents that radiate into the exterior region, and calculating the far field from these currents.\n\nLet $S$ be a sphere of radius $a$ centered at the origin. According to Love's Equivalence Principle, the fields outside $S$ are produced by equivalent electric and magnetic surface currents on $S$:\n$$\n\\mathbf{J}_s = \\hat{\\mathbf{n}} \\times \\mathbf{H} \\quad \\text{and} \\quad \\mathbf{M}_s = -\\hat{\\mathbf{n}} \\times \\mathbf{E}\n$$\nwhere $\\hat{\\mathbf{n}} = \\hat{\\mathbf{r}}$ is the outward normal from $S$, and $\\mathbf{E}$ and $\\mathbf{H}$ are the exact fields produced by the dipole on the surface $S$. The far-zone electric field produced by these equivalent currents is given by the radiation integrals, which represent a near-to-far-field transformation (NTFF).\n\nInstead of a brute-force calculation of the radiation integrals, we use a more elegant argument based on spherical wave expansions.\n1.  The field radiated by an elementary electric dipole located at the origin and oriented along the $\\hat{\\mathbf{z}}$-axis is a pure transverse magnetic (TM) mode with respect to the $z$-axis. In terms of vector spherical harmonics (VSH), this corresponds to the $\\mathbf{N}_{e10}^{(2)}$ mode. The subscript '$e$' denotes even $\\phi$ dependence ($\\cos(m\\phi)$), '$1$' is the mode order $n$, '$0$' is the azimuthal index $m$, and the superscript '(2)' denotes an outgoing wave described by the spherical Hankel function of the second kind, $h_n^{(2)}(kr)$.\n\n2.  The exact fields on the spherical surface $S$ (at $r=a$) are therefore described solely by this $\\mathbf{N}_{e10}^{(2)}$ mode. The fields have the form:\n    $$\n    \\mathbf{E}(\\mathbf{r}') = C_E \\mathbf{N}_{e10}^{(2)}(k\\mathbf{r}') \\quad \\text{and} \\quad \\mathbf{H}(\\mathbf{r}') = C_H \\mathbf{M}_{o10}^{(2)}(k\\mathbf{r}') \\quad \\text{for } |\\mathbf{r}'|=a\n    $$\n    where the relationship between the fields means that a single electric dipole mode excites both TM ($\\mathbf{N}$) and TE ($\\mathbf{M}$) modes. For a pure electric dipole source, the expansion is purely in $\\mathbf{N}$ modes, derived from the vector potential, and the resulting magnetic field is then found via curl. The key insight is that the source has a definite modal signature.\n\n3.  The NTFF calculation, which uses the radiation integrals, is a linear transformation that maps the tangential fields on $S$ to the fields in the far zone. A fundamental property of VSHs is that they are eigenfunctions of this transformation. This means that if the field on the spherical surface $S$ is a pure VSH mode, the field radiated by the equivalent currents for all $r>a$ will be that same VSH mode.\n\n4.  Therefore, since the fields on $S$ are purely of the $\\mathbf{N}_{e10}^{(2)}$ type, the far-zone field calculated via the NTFF procedure must also be purely of the $\\mathbf{N}_{e10}^{(2)}$ type.\n\n5.  We now only need the far-field asymptotic form of the $\\mathbf{N}_{e10}^{(2)}$ mode. The VSHs have the following asymptotic behavior for $kr \\to \\infty$:\n    $$\n    \\mathbf{N}_{enm}^{(2)}(k\\mathbf{r}) \\sim \\frac{(-i)^{n+1}}{kr} e^{-ikr} \\left[ -\\frac{\\partial P_n^m(\\cos\\theta)}{\\partial\\theta} \\cos(m\\phi) \\hat{\\mathbf{\\theta}} - \\frac{m}{\\sin\\theta} P_n^m(\\cos\\theta) \\sin(m\\phi) \\hat{\\mathbf{\\phi}} \\right]\n    $$\n    For our mode ($n=1, m=0$), we have $P_1^0(\\cos\\theta) = \\cos\\theta$. The expression simplifies to:\n    $$\n    \\mathbf{N}_{e10}^{(2)}(k\\mathbf{r}) \\sim \\frac{(-i)^2}{kr} e^{-ikr} \\left[ -\\frac{\\partial (\\cos\\theta)}{\\partial\\theta} \\hat{\\mathbf{\\theta}} \\right] = -\\frac{e^{-ikr}}{kr} [-(-\\sin\\theta)\\hat{\\mathbf{\\theta}}] = -\\frac{e^{-ikr}}{kr} \\sin\\theta\\,\\hat{\\mathbf{\\theta}}\n    $$\n    The magnitude of the far-zone electric field obtained via the NTFF method is thus proportional to $|\\sin\\theta|$. For $\\theta \\in [0, \\pi]$, this is $\\sin\\theta$.\n\n**Conclusion and Final Answer**\n\nBoth the direct radiation calculation (Method 1) and the near-to-far-field transformation based on Huygens' principle (Method 2) yield a far-zone electric field whose magnitude has an angular dependence of $\\sin\\theta$. This confirms the consistency of the two approaches.\n\nThe problem asks for the normalized angular dependence $f(\\theta,\\phi)$. The derived angular function is $g(\\theta, \\phi) = \\sin\\theta$. To normalize it, we divide by its maximum value over all angles $(\\theta, \\phi)$.\n$$\n\\max_{\\theta, \\phi} g(\\theta, \\phi) = \\max_{\\theta \\in [0,\\pi]} \\sin\\theta = 1 \\quad (\\text{at } \\theta = \\pi/2)\n$$\nThe normalized angular dependence is therefore:\n$$\nf(\\theta, \\phi) = \\frac{g(\\theta, \\phi)}{\\max g(\\theta, \\phi)} = \\frac{\\sin\\theta}{1} = \\sin\\theta\n$$\nThis function is independent of the azimuthal angle $\\phi$, as expected from the rotational symmetry of the source about the $z$-axis.", "answer": "$$\n\\boxed{\\sin(\\theta)}\n$$", "id": "3333713"}, {"introduction": "While theoretically exact, the NTFF is almost always performed numerically in practice, transforming discrete near-field data into a far-field pattern. This exercise transitions from pure theory to computational practice, focusing on the crucial relationship between a one-dimensional aperture field and its far-field angular spectrum, which is governed by the Fourier transform [@problem_id:3333760]. By experimenting with different aperture window functions and sampling schemes, you will gain hands-on experience with the fundamental engineering trade-offs between main-beam shaping and side-lobe suppression, a cornerstone of antenna design and analysis.", "problem": "You are tasked with constructing and analyzing a nonuniform near-field sampling scheme on a one-dimensional measurement curve $\\Gamma$ for a two-dimensional transverse electric polarization scenario and transforming it into the far field using the angular spectrum representation. The objective is to design a nonuniform sampling distribution that minimizes aliasing while preserving the fidelity of the main beam in the far field, and to quantify the impact of continuous window functions $w(x)$ applied to the near-field aperture on the side-lobe levels of the normalized far-field magnitude pattern.\n\nStarting from a mathematically valid base consisting of the free-space scalar Green’s function, the Huygens equivalence principle, and the plane-wave (angular spectrum) expansion, derive the form of the far-field angular spectrum for the aperture field restricted to a straight line segment $\\Gamma = \\{(x,0): x \\in [-L/2, L/2]\\}$ at $z=0$, under the assumption that the tangential electric field distribution on $\\Gamma$ is a scalar aperture function $E(x)$ that is square-integrable and compactly supported on the aperture. Without assuming any shortcut formulas, reason from these bases to justify that the far-field magnitude pattern along an observation circle at large radius is proportional to the continuous Fourier transform of the aperture distribution, specifically an integral of the form\n$$\nF(\\theta) \\propto \\int_{-L/2}^{L/2} E(x)\\,w(x)\\,e^{-i k\\,x\\,\\sin\\theta}\\,dx,\n$$\nwhere $k$ is the free-space wavenumber and $\\theta$ is the observation angle relative to the boresight. Explain the role of $w(x)$ as an apodization that trades main-lobe width for reduced side-lobe levels by attenuating edge discontinuities introduced by finite truncation on $\\Gamma$.\n\nThen, design a nonuniform sampling scheme on $\\Gamma$ that concentrates samples near the aperture edges to mitigate high-spatial-frequency content induced by discontinuities, while maintaining adequate sampling density to avoid spatial aliasing up to grazing angles. Use a cosine-clustered node distribution motivated by Chebyshev node placement, and justify the choice by discussing how edge clustering reduces spectral leakage. The numerical far-field is to be approximated by a nonuniform quadrature that is consistent with the Riemann integral and accurately integrates the oscillatory kernel. Specifically, implement a quadrature based on node-dependent local spacings $\\Delta x_n$ computed from nearest-neighbor distances. The numerical approximation must be of the form\n$$\n\\widehat{F}(\\theta) \\approx \\sum_{n=1}^{N} E(x_n)\\,w(x_n)\\,\\Delta x_n\\,e^{-i k\\,x_n\\,\\sin\\theta},\n$$\nwith $x_n$ the sample nodes on $\\Gamma$ and $\\Delta x_n$ consistent with the composite trapezoid on nonuniform meshes.\n\nFor the purposes of quantitative evaluation, impose the following modeling and numerical conditions, which you must adhere to precisely:\n\n- Free-space propagation with speed of light $c = 2.99792458\\times 10^8\\,\\mathrm{m/s}$.\n- Frequency $f = 3\\,\\mathrm{GHz}$, so that wavelength $\\lambda = c/f$ and wavenumber $k = 2\\pi/\\lambda$ in $\\mathrm{rad/m}$.\n- Aperture length $L = 1.0\\,\\mathrm{m}$.\n- Aperture field $E(x) = 1$ for $x \\in [-L/2, L/2]$ and $E(x) = 0$ otherwise.\n- Angular observation grid $\\theta \\in [-90, 90]$ degrees, sampled uniformly with a step of $0.05$ degrees. All angles must be handled in degrees for input/output and converted to radians internally for trigonometric functions.\n- The far-field magnitude pattern must be normalized to a peak value of $1$ before side-lobe evaluation.\n\nDefine the main-lobe exclusion half-width using the diffraction-limited aperture estimate\n$$\n\\theta_{\\mathrm{ml}} = 1.5\\,\\arcsin\\!\\big(\\lambda/L\\big),\n$$\nexpressed in degrees, and define the side-lobe level as the maximum value of the normalized magnitude pattern outside the main-lobe exclusion region $|\\theta| \\le \\theta_{\\mathrm{ml}}$. Report side-lobe level in decibels via $20\\log_{10}(\\cdot)$.\n\nYou must evaluate and report the side-lobe levels for the following four test cases, which constitute the test suite:\n\n- Case A (Uniform, rectangular): $N=128$ uniformly spaced samples on $[-L/2, L/2]$ with a rectangular window $w(x)=1$ on the aperture.\n- Case B (Uniform, Hann): $N=128$ uniformly spaced samples with the continuous Hann window $w(x) = \\tfrac{1}{2}\\left(1+\\cos\\left(2\\pi x/L\\right)\\right)$ for $|x|\\le L/2$ and $w(x)=0$ otherwise.\n- Case C (Nonuniform cosine-clustered, rectangular): $N=128$ nodes defined by $x_n = \\tfrac{L}{2}\\cos\\!\\big(\\pi n/(N-1)\\big)$ for $n=0,\\dots,N-1$, sorted into ascending order, with $w(x)=1$ on the aperture.\n- Case D (Nonuniform cosine-clustered, Kaiser): same nodes as Case C with the continuous Kaiser window $w(x) = I_0\\!\\Big(\\beta \\sqrt{1-(2x/L)^2}\\Big)\\big/I_0(\\beta)$ for $|x|\\le L/2$ and $w(x)=0$ otherwise, using $\\beta = 6$.\n\nIn all cases, use a nonuniform composite trapezoid quadrature to determine $\\Delta x_n$ such that each interior node uses half the distance to its immediate neighbors and each endpoint uses half the distance to its sole neighbor.\n\nYour program must output the side-lobe level for each case as a single line containing a comma-separated Python list of four floats in decibels, rounded to two decimals, in the order $[\\mathrm{Case\\ A},\\mathrm{Case\\ B},\\mathrm{Case\\ C},\\mathrm{Case\\ D}]$. Express the angle in degrees internally and externally as specified, and side-lobe levels in decibels. No other text should be printed.\n\nYour implementation must be a complete, runnable program that does not require any external input.", "solution": "The problem posed is a well-defined exercise in computational electromagnetics, specifically concerning the near-to-far-field transformation (NFFT) for a one-dimensional aperture under transverse electric (TE) polarization conditions. It is scientifically grounded, logically consistent, and all necessary parameters for a unique numerical solution are provided. The problem is therefore deemed valid.\n\nThe core of the problem is to compute the far-field radiation pattern originating from a known electric field distribution on a finite aperture. This is founded upon the Huygens-Fresnel principle, which posits that every point on a wavefront can be considered a source of secondary spherical wavelets. In the context of electromagnetics, this is more rigorously formulated through the Kirchhoff-Helmholtz integral theorem or the Stratton-Chu formulation, which uses vector Green's identities.\n\nFor a two-dimensional problem with TE polarization, the electric field has only one component, say $E_z$, which satisfies the scalar Helmholtz equation $(\\nabla^2 + k^2)E_z = 0$. The field $E_z(\\mathbf{r})$ at an observation point $\\mathbf{r}$ in a source-free region can be determined from the tangential fields on a closed surface surrounding the sources. If we consider the aperture to be a segment $\\Gamma = \\{(x, 0) : x \\in [-L/2, L/2]\\}$ on the $z=0$ plane, the field in the half-space $z>0$ is given by an integral over the aperture field distribution. A simplified form of the radiation integral is:\n$$\nE_z(\\mathbf{r}) \\approx \\int_{\\Gamma} E(x') \\frac{\\partial G(\\mathbf{r}, \\mathbf{r}')}{\\partial n'} dS'\n$$\nwhere $E(x')$ is the specified aperture field, $G(\\mathbf{r}, \\mathbf{r}')$ is the two-dimensional free-space Green's function, and $\\partial/\\partial n'$ is the normal derivative. The 2D Green's function is $G(\\mathbf{r}, \\mathbf{r}') = -\\frac{i}{4} H_0^{(2)}(k|\\mathbf{r} - \\mathbf{r}'|)$, where $H_0^{(2)}$ is the Hankel function of the second kind of order zero and $k = 2\\pi/\\lambda$ is the free-space wavenumber.\n\nIn the far-field zone, where the distance to the observation point $r = |\\mathbf{r}|$ is much larger than the aperture size $L$ and the wavelength $\\lambda$ (i.e., $r \\gg L^2/\\lambda$), we can employ asymptotic approximations. The distance from a source point $\\mathbf{r}' = (x', 0)$ on the aperture to the observation point $\\mathbf{r} = (r\\sin\\theta, r\\cos\\theta)$ is approximated as $|\\mathbf{r} - \\mathbf{r}'| \\approx r - x'\\sin\\theta$. Here, $\\theta$ is the angle measured from the boresight direction (the $z$-axis). The Hankel function has the asymptotic form $H_0^{(2)}(\\rho) \\sim \\sqrt{2/(\\pi\\rho)} e^{-i(\\rho - \\pi/4)}$ for large $\\rho$. Substituting these approximations into the radiation integral, the distance-dependent terms $1/\\sqrt{r}$ can be factored out, and the dominant angular dependence arises from the phase term in the exponential. The integral simplifies to a direct proportionality with the Fourier transform of the aperture distribution:\n$$\nF(\\theta) \\propto \\int_{-L/2}^{L/2} E(x') e^{-i k x' \\sin\\theta} dx'\n$$\nThis establishes the fundamental relationship that the far-field angular pattern $F(\\theta)$ is the Fourier transform of the spatial aperture field distribution $E(x')$.\n\nThe problem introduces a window function, or apodization function, $w(x)$. The effective aperture distribution becomes the product $E(x)w(x)$. The far-field integral is then:\n$$\nF(\\theta) \\propto \\int_{-L/2}^{L/2} E(x) w(x) e^{-i k x \\sin\\theta} dx\n$$\nThe role of $w(x)$ is to mitigate the effects of the abrupt truncation of the field at the aperture edges $x = \\pm L/2$. For a uniform aperture where $E(x)=1$, the function is a rectangular pulse. Its Fourier transform is a sinc function, $\\text{sinc}(u) = \\sin(u)/u$, which is characterized by a narrow main lobe but relatively high side-lobes that decay slowly (as $1/u$). These side-lobes are a mathematical artifact of the discontinuity at the edges. By applying a window function that smoothly tapers the field to zero at the edges (e.g., Hann or Kaiser window), the discontinuity is removed. A smoother function in the spatial domain results in a faster-decaying function in the frequency (angular) domain. This reduces the side-lobe levels, but at the cost of broadening the main beam, a fundamental trade-off in signal processing and antenna theory.\n\nTo solve this integral numerically, we must discretize it. The problem specifies a numerical quadrature of the form:\n$$\n\\widehat{F}(\\theta) \\approx \\sum_{n=1}^{N} E(x_n) w(x_n) \\Delta x_n e^{-i k x_n \\sin\\theta}\n$$\nHere, $\\{x_n\\}$ are the sampling points on the aperture and $\\{\\Delta x_n\\}$ are the quadrature weights. The problem mandates a composite trapezoidal rule for a nonuniform mesh. For a set of sorted nodes $x_0, x_1, \\ldots, x_{N-1}$, the weights are given by:\n$$\n\\Delta x_n = \\begin{cases} \\frac{1}{2}(x_1 - x_0) & n=0 \\\\ \\frac{1}{2}(x_{n+1} - x_{n-1}) & 0 < n < N-1 \\\\ \\frac{1}{2}(x_{N-1} - x_{N-2}) & n=N-1 \\end{cases}\n$$\nThis choice of weights arises from regrouping terms in the standard composite trapezoid sum $\\sum \\frac{1}{2}(f_i+f_{i+1})(x_{i+1}-x_i)$ by function value $f_n$.\n\nFinally, the problem investigates two sampling schemes. Uniform sampling is the most straightforward but can be suboptimal. Nonuniform cosine-clustered sampling, defined by $x_n = \\frac{L}{2}\\cos(\\pi n/(N-1))$ (and then sorted), places nodes more densely near the aperture edges. These are Chebyshev nodes of the second kind. This strategy is motivated by the understanding that the sharpest variations in the (unwindowed) aperture field occur at the edges. By concentrating sample points in these regions, the numerical integration can more accurately capture the high-spatial-frequency content generated by these discontinuities, leading to a more accurate far-field prediction and reduced spatial aliasing for a fixed number of samples $N$.\n\nThe specified four cases allow for a quantitative comparison of these effects: uniform versus nonuniform sampling, and no window (rectangular) versus smooth windows (Hann, Kaiser). The side-lobe level, calculated as the maximum of the normalized far-field magnitude outside a defined main-lobe region, serves as the metric for this comparison. The main-lobe half-width $\\theta_{\\text{ml}} = 1.5 \\arcsin(\\lambda/L)$ is a reasonable estimate based on the diffraction limit $\\sin\\theta \\approx \\lambda/L$, with a factor of $1.5$ to ensure exclusion of the entire main beam. The analysis will proceed by implementing this numerical model precisely as specified.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import i0\n\ndef solve():\n    \"\"\"\n    Solves the near-to-far-field transformation problem for four specified test cases.\n    \"\"\"\n\n    # --- Define constants and physical parameters ---\n    C = 2.99792458e8  # Speed of light in m/s\n    F = 3e9           # Frequency in Hz\n    L = 1.0           # Aperture length in m\n    N = 128           # Number of sample points\n    BETA_KAISER = 6.0 # Kaiser window parameter\n\n    # --- Derived physical parameters ---\n    WAVELENGTH = C / F\n    WAVENUMBER = 2 * np.pi / WAVELENGTH\n\n    # --- Define numerical parameters ---\n    # Angular grid: -90 to +90 degrees with 0.05 degree step\n    THETA_DEG = np.arange(-90.0, 90.0 + 0.05, 0.05)\n    THETA_RAD = np.deg2rad(THETA_DEG)\n\n    # Main-lobe exclusion half-width in degrees\n    theta_ml_deg = 1.5 * np.rad2deg(np.arcsin(WAVELENGTH / L))\n\n    # --- Define test cases ---\n    test_cases = [\n        {'name': 'A', 'sampling': 'uniform', 'window': 'rectangular'},\n        {'name': 'B', 'sampling': 'uniform', 'window': 'hann'},\n        {'name': 'C', 'sampling': 'cosine', 'window': 'rectangular'},\n        {'name': 'D', 'sampling': 'cosine', 'window': 'kaiser'},\n    ]\n\n    results_db = []\n\n    # --- Helper function for quadrature weights ---\n    def get_quadrature_weights(x_nodes):\n        \"\"\"\n        Calculates weights for nonuniform composite trapezoid rule.\n        \"\"\"\n        n_pts = len(x_nodes)\n        dx = np.zeros(n_pts)\n        dx[0] = 0.5 * (x_nodes[1] - x_nodes[0])\n        dx[1:-1] = 0.5 * (x_nodes[2:] - x_nodes[:-2])\n        dx[-1] = 0.5 * (x_nodes[-1] - x_nodes[-2])\n        return dx\n\n    # --- Process each test case ---\n    for case in test_cases:\n        # 1. Generate sample nodes (x_n)\n        if case['sampling'] == 'uniform':\n            x_nodes = np.linspace(-L / 2.0, L / 2.0, N)\n        else:  # cosine-clustered\n            # Generate points in descending order as per formula\n            nodes_desc = (L / 2.0) * np.cos(np.pi * np.arange(N) / (N - 1))\n            # Sort into ascending order\n            x_nodes = np.sort(nodes_desc)\n\n        # 2. Define aperture field E(x) = 1\n        e_values = np.ones(N)\n\n        # 3. Generate window function values (w(x_n))\n        if case['window'] == 'rectangular':\n            w_values = np.ones(N)\n        elif case['window'] == 'hann':\n            w_values = 0.5 * (1.0 + np.cos(2.0 * np.pi * x_nodes / L))\n        else:  # kaiser\n            arg = BETA_KAISER * np.sqrt(1.0 - (2.0 * x_nodes / L)**2)\n            w_values = i0(arg) / i0(BETA_KAISER)\n\n        # 4. Calculate quadrature weights (Δx_n)\n        dx_weights = get_quadrature_weights(x_nodes)\n\n        # 5. Form the terms for the summation\n        sum_terms = e_values * w_values * dx_weights\n\n        # 6. Calculate the far-field pattern F(θ)\n        # Using broadcasting via np.outer for efficiency\n        # Kernel: exp(-i * k * sin(theta) * x)\n        kernel = np.exp(-1j * WAVENUMBER * np.outer(np.sin(THETA_RAD), x_nodes))\n        f_theta = kernel @ sum_terms\n\n        # 7. Normalize the magnitude pattern\n        f_mag = np.abs(f_theta)\n        f_norm = f_mag / np.max(f_mag)\n\n        # 8. Find the side-lobe level\n        # A mask to select angles outside the main-lobe region\n        sidelobe_mask = np.abs(THETA_DEG) > theta_ml_deg\n        \n        # Max of the normalized pattern in the sidelobe region\n        max_sidelobe = np.max(f_norm[sidelobe_mask])\n        \n        # Convert to decibels\n        sll_db = 20.0 * np.log10(max_sidelobe)\n        \n        results_db.append(round(sll_db, 2))\n\n    # --- Final print statement in the exact required format ---\n    print(f\"[{','.join(map(str, results_db))}]\")\n\nsolve()\n```", "id": "3333760"}, {"introduction": "Beyond direct integration, NTFF can be elegantly formulated using modal expansions, which are particularly efficient for geometries possessing certain symmetries. This advanced practice explores such a method using Debye potentials for a spherically symmetric scatterer, recasting the NTFF problem as one of determining modal coefficients [@problem_id:3333743]. Furthermore, it addresses a common challenge in computational electromagnetics: the contamination of near-field data by spurious reflections from simulation boundaries like Perfectly Matched Layers (PMLs), demonstrating a powerful two-surface method to filter these artifacts and reconstruct the true scattered field.", "problem": "You are given a frequency-domain scattering scenario in computational electromagnetics for a spherically symmetric scatterer embedded within a perfectly matched layer (PML). The task is to use Debye potentials to reconstruct the far-field scattering information from near-field measurements taken on concentric spherical surfaces inside the PML, while accounting for contamination from PML reflections. The reconstruction must be derived from first principles and implemented as a complete, runnable program that outputs quantitative metrics.\n\nThe fundamental base for the derivation is:\n\n- Maxwell’s equations in the frequency domain for time-harmonic fields with angular frequency $\\omega$ and wavenumber $k$ in free space:\n$$\n\\nabla \\times \\mathbf{E} = i \\omega \\mu_0 \\mathbf{H}, \\quad \\nabla \\times \\mathbf{H} = -i \\omega \\varepsilon_0 \\mathbf{E}, \\quad \\nabla \\cdot \\mathbf{E} = 0, \\quad \\nabla \\cdot \\mathbf{H} = 0,\n$$\nwhere $\\varepsilon_0$ is the vacuum permittivity and $\\mu_0$ is the vacuum permeability.\n\n- Debye potentials for spherically symmetric scatterers: the electric-type Debye potential $\\Pi_e$ and the magnetic-type Debye potential $\\Pi_m$ each satisfy the scalar Helmholtz equation in source-free regions:\n$$\n\\nabla^2 \\Pi + k^2 \\Pi = 0.\n$$\nIn a spherically symmetric setting with axisymmetry, each potential may be expanded in Legendre polynomials:\n$$\n\\Pi_e(r,\\theta) = \\sum_{\\ell=1}^{L_{\\max}} A_\\ell f_\\ell(r) P_\\ell(\\cos\\theta), \\quad \\Pi_m(r,\\theta) = \\sum_{\\ell=1}^{L_{\\max}} C_\\ell f_\\ell(r) P_\\ell(\\cos\\theta),\n$$\nwhere $P_\\ell$ is the Legendre polynomial of degree $\\ell$, and $f_\\ell(r)$ is a radial solution of the scalar Helmholtz equation that is either outgoing or regular. The two fundamental radial solutions are the spherical Bessel function of the first kind $j_\\ell(kr)$ (regular at the origin) and the spherical Hankel function of the first kind $h_\\ell^{(1)}(kr)$ (outgoing at infinity).\n\n- Orthogonality of Legendre polynomials:\n$$\n\\int_{-1}^{1} P_\\ell(x) P_{\\ell'}(x) \\, dx = \\frac{2}{2\\ell + 1} \\delta_{\\ell \\ell'}.\n$$\n\nNear-field measurements inside a PML are contaminated by reflections. In this problem, you will adopt a physically plausible contamination model: the measured near-field Debye potentials on a spherical surface of radius $r$ are linear combinations of outgoing and regular contributions with complex coefficients. For the electric-type potential,\n$$\n\\Pi_e(r,\\theta) = \\sum_{\\ell=1}^{L_{\\max}} \\left(A_\\ell h_\\ell^{(1)}(kr) + B_\\ell j_\\ell(kr)\\right) P_\\ell(\\cos\\theta),\n$$\nand for the magnetic-type potential,\n$$\n\\Pi_m(r,\\theta) = \\sum_{\\ell=1}^{L_{\\max}} \\left(C_\\ell h_\\ell^{(1)}(kr) + D_\\ell j_\\ell(kr)\\right) P_\\ell(\\cos\\theta).\n$$\nThe unknown outgoing multipole coefficients $\\{A_\\ell\\}$ and $\\{C_\\ell\\}$ determine the far-field scattering behavior, while $\\{B_\\ell\\}$ and $\\{D_\\ell\\}$ represent contamination induced by PML reflections. In the synthetic data used for testing, the contamination is modeled as proportional to the outgoing coefficients with a complex factor:\n$$\nB_\\ell = R_e e^{i \\phi_e} A_\\ell, \\quad D_\\ell = R_m e^{i \\phi_m} C_\\ell,\n$$\nwhere $R_e$ and $R_m$ are reflection magnitudes and $\\phi_e$, $\\phi_m$ are reflection phases.\n\nYour task is to:\n\n1. Derive, from the above base, a method to reconstruct the outgoing multipole coefficients $\\{A_\\ell\\}$ and $\\{C_\\ell\\}$ from near-field measurements of $\\Pi_e$ and $\\Pi_m$ on two concentric spheres of radii $r_0$ and $r_1$ inside the PML. Use only the provided fundamental facts, and do not assume or use any pre-derived near-to-far-field transformation shortcuts. You must explicitly state the projection step that isolates each angular momentum channel $\\ell$.\n\n2. Devise and apply a contamination subtraction strategy that uses the two radii to separate outgoing and regular contributions channel-by-channel. Justify its correctness from the properties of $h_\\ell^{(1)}$ and $j_\\ell$.\n\n3. Implement the reconstruction algorithm as a Python program that:\n   - Generates synthetic near-field Debye potentials on $r_0$ and $r_1$ using the test suite parameters below.\n   - Performs Legendre projections to obtain the channel coefficients at both radii.\n   - Solves, for each $\\ell$, a $2 \\times 2$ complex linear system that yields estimates of $A_\\ell$ and $C_\\ell$ independently from $\\Pi_e$ and $\\Pi_m$.\n   - Computes, for each test case, the maximum absolute reconstruction error over all $\\ell$ across both potentials, i.e.,\n     $$\n     \\max\\left\\{\\max_{\\ell} \\left| \\hat{A}_\\ell - A_\\ell \\right|, \\ \\max_{\\ell} \\left| \\hat{C}_\\ell - C_\\ell \\right| \\right\\}.\n     $$\n     This metric is dimensionless and must be output as a floating-point number.\n\nPhysical and numerical units: use $k$ in $\\mathrm{m}^{-1}$ and radii $r_0$, $r_1$ in $\\mathrm{m}$. The Debye potentials and multipole coefficients are dimensionless complex quantities. Angles are not required in the final output. The final output format must be a single line containing the results as a comma-separated list enclosed in square brackets.\n\nTest suite:\n\n- Case $1$ (happy path):\n  - $k = 20 \\ \\mathrm{m}^{-1}$, $r_0 = 0.35 \\ \\mathrm{m}$, $r_1 = 0.42 \\ \\mathrm{m}$, $L_{\\max} = 4$.\n  - Electric-type outgoing coefficients $A_\\ell$ for $\\ell=1,2,3,4$: $[0.9 + 0.1 i, \\ -0.4 + 0.2 i, \\ 0.1 - 0.05 i, \\ 0.02 + 0.03 i]$.\n  - Magnetic-type outgoing coefficients $C_\\ell$ for $\\ell=1,2,3,4$: $[0.08 - 0.10 i, \\ 0.03 + 0.02 i, \\ -0.02 + 0.01 i, \\ 0.00 + 0.005 i]$.\n  - PML reflection parameters: $R_e = 0.06$, $\\phi_e = 0.8$ (radians); $R_m = 0.04$, $\\phi_m = -0.5$ (radians).\n\n- Case $2$ (no contamination boundary):\n  - $k = 35 \\ \\mathrm{m}^{-1}$, $r_0 = 0.25 \\ \\mathrm{m}$, $r_1 = 0.31 \\ \\mathrm{m}$, $L_{\\max} = 3$.\n  - Electric-type outgoing coefficients $A_\\ell$ for $\\ell=1,2,3$: $[0.6 - 0.3 i, \\ -0.2 + 0.1 i, \\ 0.05 + 0.02 i]$.\n  - Magnetic-type outgoing coefficients $C_\\ell$ for $\\ell=1,2,3$: $[0.10 + 0.05 i, \\ 0.02 - 0.01 i, \\ -0.01 + 0.005 i]$.\n  - PML reflection parameters: $R_e = 0.0$, $\\phi_e = 0.0$; $R_m = 0.0$, $\\phi_m = 0.0$.\n\n- Case $3$ (near-singular geometry in the two-radius separation):\n  - $k = 50 \\ \\mathrm{m}^{-1}$, $r_0 = 0.40 \\ \\mathrm{m}$, $r_1 = 0.405 \\ \\mathrm{m}$, $L_{\\max} = 4$.\n  - Electric-type outgoing coefficients $A_\\ell$ for $\\ell=1,2,3,4$: $[0.7 + 0.2 i, \\ -0.3 + 0.15 i, \\ 0.08 - 0.04 i, \\ 0.015 + 0.02 i]$.\n  - Magnetic-type outgoing coefficients $C_\\ell$ for $\\ell=1,2,3,4$: $[0.06 - 0.08 i, \\ 0.025 + 0.015 i, \\ -0.015 + 0.008 i, \\ 0.0 + 0.004 i]$.\n  - PML reflection parameters: $R_e = 0.12$, $\\phi_e = 1.2$; $R_m = 0.08$, $\\phi_m = -1.0$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[result1,result2,result3]$), where each $resulti$ is the maximum absolute error for case $i$ as defined above and must be a floating-point number (dimensionless). No other text should be printed. The program must be self-contained and not require any user input.", "solution": "The problem requires the derivation and implementation of a method to reconstruct far-field scattering information, encapsulated by outgoing multipole coefficients $\\{A_\\ell\\}$ and $\\{C_\\ell\\}$, from near-field data contaminated by reflections. The data is provided on two concentric spheres. The derivation proceeds from first principles as laid out in the problem statement.\n\nThe starting point is the modal expansion of the Debye potentials within a region containing both scattered (outgoing) and reflected (regular-at-the-origin, but physically incoming from the outer boundary) waves. For the electric-type potential $\\Pi_e$, this is given for a specific radius $r$ and angle $\\theta$ as:\n$$\n\\Pi_e(r,\\theta) = \\sum_{\\ell=1}^{L_{\\max}} \\left(A_\\ell h_\\ell^{(1)}(kr) + B_\\ell j_\\ell(kr)\\right) P_\\ell(\\cos\\theta)\n$$\nHere, $A_\\ell$ are the desired outgoing-wave coefficients, $B_\\ell$ are the contamination coefficients representing incoming waves, $h_\\ell^{(1)}(kr)$ is the spherical Hankel function of the first kind describing outgoing waves, $j_\\ell(kr)$ is the spherical Bessel function of the first kind describing waves regular at the origin, and $P_\\ell(\\cos\\theta)$ is the Legendre polynomial of degree $\\ell$. A completely analogous expression holds for the magnetic-type potential $\\Pi_m$ with coefficients $C_\\ell$ and $D_\\ell$.\n\nThe first step is to isolate the contribution of each angular momentum channel $\\ell$. This is achieved by exploiting the orthogonality of the Legendre polynomials. The orthogonality relation is:\n$$\n\\int_{-1}^{1} P_\\ell(x) P_{\\ell'}(x) \\, dx = \\frac{2}{2\\ell + 1} \\delta_{\\ell\\ell'}\n$$\nwhere $x = \\cos\\theta$ and $\\delta_{\\ell\\ell'}$ is the Kronecker delta. We can define a projection operation. Let us multiply the expansion for $\\Pi_e(r,\\theta)$ by $P_{\\ell'}(\\cos\\theta)$ and integrate over the solid angle, which for an axisymmetric function simplifies to an integral over $\\theta$ from $0$ to $\\pi$ with weighting $\\sin\\theta$. With the substitution $x = \\cos\\theta$, this is equivalent to integrating over $x$ from $-1$ to $1$.\n$$\n\\int_{-1}^{1} \\Pi_e(r, \\arccos x) P_{\\ell'}(x) dx = \\int_{-1}^{1} \\sum_{\\ell=1}^{L_{\\max}} \\left(A_\\ell h_\\ell^{(1)}(kr) + B_\\ell j_\\ell(kr)\\right) P_\\ell(x) P_{\\ell'}(x) dx\n$$\nDue to orthogonality, all terms in the sum vanish except for the one where $\\ell = \\ell'$.\n$$\n\\int_{-1}^{1} \\Pi_e(r, \\arccos x) P_{\\ell'}(x) dx = \\left(A_{\\ell'} h_{\\ell'}^{(1)}(kr) + B_{\\ell'} j_{\\ell'}(kr)\\right) \\frac{2}{2\\ell' + 1}\n$$\nThis allows us to define the projected radial coefficient for each mode $\\ell$ at a radius $r$ as $\\pi_{e,\\ell}(r)$:\n$$\n\\pi_{e,\\ell}(r) \\equiv \\frac{2\\ell+1}{2} \\int_{-1}^{1} \\Pi_e(r, \\arccos x) P_\\ell(x) dx = A_\\ell h_\\ell^{(1)}(kr) + B_\\ell j_\\ell(kr)\n$$\nIn a practical implementation, these projected coefficients would be computed via numerical quadrature. For this problem, where we generate synthetic data, we can compute $\\pi_{e,\\ell}(r)$ directly from the true coefficients $\\{A_\\ell, B_\\ell\\}$ without simulating the full field $\\Pi_e(r,\\theta)$.\n\nThe core of the problem is to determine the $2 L_{\\max}$ unknowns, $\\{A_\\ell\\}$ and $\\{B_\\ell\\}$, from near-field data. Having only one measurement surface at radius $r$ yields one equation, $\\pi_{e,\\ell}(r) = A_\\ell h_\\ell^{(1)}(kr) + B_\\ell j_\\ell(kr)$, per mode $\\ell$. This is insufficient to solve for both $A_\\ell$ and $B_\\ell$. The problem provides a crucial second piece of information: measurements on a second concentric sphere at radius $r_1$. This provides a second, independent equation for each mode $\\ell$.\n\nLet the two measurement radii be $r_0$ and $r_1$. For each electric-type mode $\\ell$, we have the following system of two linear equations with two unknowns, $A_\\ell$ and $B_\\ell$:\n$$\n\\begin{cases}\n\\pi_{e,\\ell}(r_0) = A_\\ell h_\\ell^{(1)}(kr_0) + B_\\ell j_\\ell(kr_0) \\\\\n\\pi_{e,\\ell}(r_1) = A_\\ell h_\\ell^{(1)}(kr_1) + B_\\ell j_\\ell(kr_1)\n\\end{cases}\n$$\nThis can be expressed in matrix form:\n$$\n\\begin{pmatrix}\nh_\\ell^{(1)}(kr_0) & j_\\ell(kr_0) \\\\\nh_\\ell^{(1)}(kr_1) & j_\\ell(kr_1)\n\\end{pmatrix}\n\\begin{pmatrix}\nA_\\ell \\\\\nB_\\ell\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\pi_{e,\\ell}(r_0) \\\\\n\\pi_{e,\\ell}(r_1)\n\\end{pmatrix}\n$$\nThis is the contamination subtraction strategy. The two radial functions, $h_\\ell^{(1)}(kr)$ and $j_\\ell(kr)$, are linearly independent solutions to the spherical Bessel differential equation. Their distinct radial dependencies ensure that the system matrix is invertible as long as $k \\neq 0$ and $r_0 \\neq r_1$, allowing for the unique separation of the outgoing ($A_\\ell$) and incoming/contaminating ($B_\\ell$) wave coefficients.\n\nTo find the desired outgoing coefficient $A_\\ell$, we can solve this system. The determinant of the system matrix is:\n$$\n\\det(\\mathbf{M}_\\ell) = h_\\ell^{(1)}(kr_0) j_\\ell(kr_1) - j_\\ell(kr_0) h_\\ell^{(1)}(kr_1)\n$$\nUsing Cramer's rule or explicit matrix inversion, the solution for the reconstructed coefficient $\\hat{A}_\\ell$ is:\n$$\n\\hat{A}_\\ell = \\frac{\\det \\begin{pmatrix} \\pi_{e,\\ell}(r_0) & j_\\ell(kr_0) \\\\ \\pi_{e,\\ell}(r_1) & j_\\ell(kr_1) \\end{pmatrix}}{\\det(\\mathbf{M}_\\ell)} = \\frac{\\pi_{e,\\ell}(r_0) j_\\ell(kr_1) - \\pi_{e,\\ell}(r_1) j_\\ell(kr_0)}{h_\\ell^{(1)}(kr_0) j_\\ell(kr_1) - j_\\ell(kr_0) h_\\ell^{(1)}(kr_1)}\n$$\nAn identical procedure is followed for the magnetic-type potential $\\Pi_m$ to find the reconstructed coefficient $\\hat{C}_\\ell$:\n$$\n\\hat{C}_\\ell = \\frac{\\pi_{m,\\ell}(r_0) j_\\ell(kr_1) - \\pi_{m,\\ell}(r_1) j_\\ell(kr_0)}{h_\\ell^{(1)}(kr_0) j_\\ell(kr_1) - j_\\ell(kr_0) h_\\ell^{(1)}(kr_1)}\n$$\nThe denominator, related to the Wronskian of the spherical Bessel functions, becomes small when $k(r_1 - r_0)$ is small, indicating that the system becomes ill-conditioned if the measurement spheres are too close. This is explored in Case $3$.\n\nThe overall algorithm is as follows:\n$1$. For each test case, define the physical parameters $k$, $r_0$, $r_1$, $L_{\\max}$, the true outgoing coefficients $\\{A_\\ell, C_\\ell\\}$, and the PML reflection parameters $R_e, \\phi_e, R_m, \\phi_m$.\n$2$. For each mode $\\ell \\in [1, L_{\\max}]$, calculate the synthetic contamination coefficients $B_\\ell = R_e e^{i\\phi_e} A_\\ell$ and $D_\\ell = R_m e^{i\\phi_m} C_\\ell$.\n$3$. For each mode $\\ell$, generate the \"measured\" projected near-field coefficients at both radii, $\\pi_{e,\\ell}(r_0)$, $\\pi_{e,\\ell}(r_1)$, $\\pi_{m,\\ell}(r_0)$, and $\\pi_{m,\\ell}(r_1)$, using their definitions. For instance, $\\pi_{e,\\ell}(r_0) = A_\\ell h_\\ell^{(1)}(kr_0) + B_\\ell j_\\ell(kr_0)$.\n$4$. For each mode $\\ell$, solve the two $2 \\times 2$ linear systems (one for electric, one for magnetic) to find the reconstructed coefficients $\\hat{A}_\\ell$ and $\\hat{C}_\\ell$ using the derived formulae. This requires computing values of $j_\\ell(z)$ and $h_\\ell^{(1)}(z) = j_\\ell(z) + i y_\\ell(z)$, where $y_\\ell(z)$ is the spherical Bessel function of the second kind.\n$5$. Compute the absolute errors $|\\hat{A}_\\ell - A_\\ell|$ and $|\\hat{C}_\\ell - C_\\ell|$ for all $\\ell$.\n$6$. Determine the maximum error for the test case, $\\max\\{\\max_{\\ell} |\\hat{A}_\\ell - A_\\ell|, \\max_{\\ell} |\\hat{C}_\\ell - C_\\ell|\\}$.\n$7$. Repeat for all test cases and report the results.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import spherical_jn, spherical_yn\n\ndef solve():\n    \"\"\"\n    Solves the near-to-far-field reconstruction problem for three test cases.\n    \"\"\"\n    \n    # Test suite as defined in the problem statement\n    test_cases = [\n        {\n            \"k\": 20.0, \"r0\": 0.35, \"r1\": 0.42, \"L_max\": 4,\n            \"A_coeffs\": np.array([0.9 + 0.1j, -0.4 + 0.2j, 0.1 - 0.05j, 0.02 + 0.03j], dtype=np.complex128),\n            \"C_coeffs\": np.array([0.08 - 0.10j, 0.03 + 0.02j, -0.02 + 0.01j, 0.00 + 0.005j], dtype=np.complex128),\n            \"R_e\": 0.06, \"phi_e\": 0.8, \"R_m\": 0.04, \"phi_m\": -0.5\n        },\n        {\n            \"k\": 35.0, \"r0\": 0.25, \"r1\": 0.31, \"L_max\": 3,\n            \"A_coeffs\": np.array([0.6 - 0.3j, -0.2 + 0.1j, 0.05 + 0.02j], dtype=np.complex128),\n            \"C_coeffs\": np.array([0.10 + 0.05j, 0.02 - 0.01j, -0.01 + 0.005j], dtype=np.complex128),\n            \"R_e\": 0.0, \"phi_e\": 0.0, \"R_m\": 0.0, \"phi_m\": 0.0\n        },\n        {\n            \"k\": 50.0, \"r0\": 0.40, \"r1\": 0.405, \"L_max\": 4,\n            \"A_coeffs\": np.array([0.7 + 0.2j, -0.3 + 0.15j, 0.08 - 0.04j, 0.015 + 0.02j], dtype=np.complex128),\n            \"C_coeffs\": np.array([0.06 - 0.08j, 0.025 + 0.015j, -0.015 + 0.008j, 0.0 + 0.004j], dtype=np.complex128),\n            \"R_e\": 0.12, \"phi_e\": 1.2, \"R_m\": 0.08, \"phi_m\": -1.0\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        k = case[\"k\"]\n        r0 = case[\"r0\"]\n        r1 = case[\"r1\"]\n        L_max = case[\"L_max\"]\n        \n        A_true = case[\"A_coeffs\"]\n        C_true = case[\"C_coeffs\"]\n        \n        R_e, phi_e = case[\"R_e\"], case[\"phi_e\"]\n        R_m, phi_m = case[\"R_m\"], case[\"phi_m\"]\n        \n        # Array of orders ell = 1, 2, ..., L_max\n        ells = np.arange(1, L_max + 1)\n        \n        # Wavenumber-radius products\n        kr0 = k * r0\n        kr1 = k * r1\n        \n        # Step 1: Calculate contamination coefficients B_ell and D_ell\n        B_coeffs = R_e * np.exp(1j * phi_e) * A_true\n        D_coeffs = R_m * np.exp(1j * phi_m) * C_true\n\n        # Step 2: Evaluate spherical basis functions at r0 and r1 for all ell\n        j_r0 = spherical_jn(ells, kr0)\n        y_r0 = spherical_yn(ells, kr0)\n        h1_r0 = j_r0 + 1j * y_r0\n\n        j_r1 = spherical_jn(ells, kr1)\n        y_r1 = spherical_yn(ells, kr1)\n        h1_r1 = j_r1 + 1j * y_r1\n\n        # Step 3: Generate synthetic projected near-field data\n        pi_e_r0 = A_true * h1_r0 + B_coeffs * j_r0\n        pi_e_r1 = A_true * h1_r1 + B_coeffs * j_r1\n        \n        pi_m_r0 = C_true * h1_r0 + D_coeffs * j_r0\n        pi_m_r1 = C_true * h1_r1 + D_coeffs * j_r1\n\n        # Step 4: Solve the 2x2 system for each ell to reconstruct A_hat and C_hat\n        # The denominator is the determinant of the system matrix M_ell\n        denominator = h1_r0 * j_r1 - j_r0 * h1_r1\n        \n        # Numerators from Cramer's rule\n        num_A = pi_e_r0 * j_r1 - pi_e_r1 * j_r0\n        num_C = pi_m_r0 * j_r1 - pi_m_r1 * j_r0\n        \n        A_hat = num_A / denominator\n        C_hat = num_C / denominator\n\n        # Step 5: Compute the maximum absolute reconstruction error\n        error_A = np.max(np.abs(A_hat - A_true))\n        error_C = np.max(np.abs(C_hat - C_true))\n        \n        max_error = max(error_A, error_C)\n        results.append(max_error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3333743"}]}