{"hands_on_practices": [{"introduction": "The \"perfectly matched\" property of a PML is its defining feature, ensuring it is non-reflective in the ideal case. This theoretical foundation is crucial to understanding why PMLs are so effective as absorbing boundary conditions. This practice guides you through the fundamental derivation of the reflection coefficient at a vacuum-PML interface, proving that it is identically zero in the continuous model [@problem_id:3293614].", "problem": "A plane wave of angular frequency $\\omega$ is incident from vacuum ($x<0$) onto a semi-infinite Complex-Frequency-Shifted Perfectly Matched Layer (CFS-PML) occupying $x>0$. The CFS-PML is defined by a spatially uniform complex stretch factor along $x$,\n$$\ns_{x}(\\omega)=\\kappa_{x}+\\frac{\\sigma_{x}}{\\alpha_{x}+\\mathrm{j}\\,\\omega},\n$$\nwith $\\kappa_{x}>0$, $\\sigma_{x}\\geq 0$, and $\\alpha_{x}\\geq 0$, and is implemented by the replacement $\\partial/\\partial x\\mapsto (1/s_{x})\\,\\partial/\\partial x$ in the frequency-domain Maxwell equations. Consider a two-dimensional transverse-electric (TE) polarization with nonzero $E_{z}$ and incidence in the $x$-$y$ plane at angle $\\theta$ with respect to the $x$-axis (the interface normal). The vacuum wavenumber is $k_{0}=\\omega\\sqrt{\\mu_{0}\\epsilon_{0}}$, with vacuum permeability $\\mu_{0}$ and permittivity $\\epsilon_{0}$. The tangential wavenumber is $k_{y}=k_{0}\\sin\\theta$, and the normal wavenumber in vacuum is $k_{x}=k_{0}\\cos\\theta$.\n\nStarting from the frequency-domain Maxwell curl equations and using only physically valid transformations consistent with the coordinate stretching implementation, derive the boundary relations at $x=0$ for the TE fields. Then, compute the plane-wave reflection coefficient $R(\\theta,\\omega)$ at the vacuumâ€“PML interface in terms of $s_{x}$, and prove that in the continuous setting with spatially uniform $s_{x}$ the result is identically zero for all $\\theta$ and $\\omega$. Express your final answer as a single closed-form expression for $R(\\theta,\\omega)$. No numerical rounding is required, and no units should be included in the final answer.", "solution": "The problem asks for the derivation of the reflection coefficient, $R(\\theta, \\omega)$, for a transverse-electric (TE) plane wave incident from vacuum ($x<0$) onto a semi-infinite Complex-Frequency-Shifted Perfectly Matched Layer (CFS-PML) for $x>0$, and to prove that it is identically zero.\n\nLet us adopt the time-harmonic convention $e^{-\\mathrm{j}\\omega t}$, where $\\omega$ is the angular frequency. The frequency-domain Maxwell's curl equations in a source-free, linear, and isotropic medium are:\n$$\n\\nabla\\times\\vec{E} = \\mathrm{j}\\omega\\mu\\vec{H}\n$$\n$$\n\\nabla\\times\\vec{H} = -\\mathrm{j}\\omega\\epsilon\\vec{E}\n$$\n\nFor the specified two-dimensional TE polarization, the electric field has only a $z$-component, $\\vec{E} = E_z(x,y)\\hat{z}$, and the magnetic field lies in the $x-y$ plane, $\\vec{H} = H_x(x,y)\\hat{x} + H_y(x,y)\\hat{y}$. The curl equations simplify to:\n$$\n\\frac{\\partial E_z}{\\partial y} = \\mathrm{j}\\omega\\mu H_x \\quad(1)\n$$\n$$\n-\\frac{\\partial E_z}{\\partial x} = \\mathrm{j}\\omega\\mu H_y \\quad(2)\n$$\n$$\n\\frac{\\partial H_y}{\\partial x} - \\frac{\\partial H_x}{\\partial y} = -\\mathrm{j}\\omega\\epsilon E_z \\quad(3)\n$$\n\nFirst, we derive the boundary conditions at the interface $x=0$. The PML is a volumetric effective medium, not a boundary sheet with surface currents or charges. Therefore, the standard boundary conditions derived from the integral form of Maxwell's equations apply. Integrating $\\nabla\\times\\vec{E} = \\mathrm{j}\\omega\\vec{B}$ over a small rectangular loop in the $y-z$ plane straddling the interface at $x=0$ and shrinking its width in $x$ to zero demonstrates the continuity of the tangential component of $\\vec{E}$. For this TE case, this implies the continuity of $E_z$.\n$$\nE_z(x=0^-, y) = E_z(x=0^+, y)\n$$\nSimilarly, integrating $\\nabla\\times\\vec{H} = -\\mathrm{j}\\omega\\vec{D}$ over a small rectangular loop in the $x-z$ plane straddling the interface at $x=0$ and shrinking its width shows the continuity of the tangential component of $\\vec{H}$. For this interface, the tangential component is $H_y$.\n$$\nH_y(x=0^-, y) = H_y(x=0^+, y)\n$$\n\nThe incident plane wave has a spatial dependence of $e^{\\mathrm{j}(k_x x + k_y y)}$, where $k_x = k_0\\cos\\theta$ and $k_y = k_0\\sin\\theta$ are the wavevector components in vacuum, and $k_0=\\omega\\sqrt{\\mu_0\\epsilon_0}$. The fields in the vacuum region ($x<0$) are a superposition of the incident (I) and reflected (R) waves:\n$$\nE_z^{(1)}(x,y) = (E_I e^{\\mathrm{j}k_x x} + E_R e^{-\\mathrmj k_x x}) e^{\\mathrmj k_y y}\n$$\nThe corresponding tangential magnetic field $H_y^{(1)}$ is found from (2) with $\\mu=\\mu_0$:\n$$\n-\\frac{\\partial E_z^{(1)}}{\\partial x} = \\mathrmj\\omega\\mu_0 H_y^{(1)} \\implies H_y^{(1)} = \\frac{-1}{\\mathrmj\\omega\\mu_0} \\frac{\\partial E_z^{(1)}}{\\partial x} = \\frac{-1}{\\mathrmj\\omega\\mu_0} \\mathrmj(k_x E_I e^{\\mathrmj k_x x} - k_x E_R e^{-\\mathrmj k_x x}) e^{\\mathrmj k_y y}\n$$\n$$\nH_y^{(1)}(x,y) = -\\frac{k_x}{\\omega\\mu_0} (E_I e^{\\mathrmj k_x x} - E_R e^{-\\mathrmj k_x x}) e^{\\mathrmj k_y y}\n$$\nThe reflection coefficient is defined as $R(\\theta, \\omega) = E_R/E_I$.\n\nThe reflection is zero if and only if the wave impedance is continuous across the boundary. The transverse wave impedance for a TE wave propagating in the $+x$ direction is $Z_{TE} = E_z / (-H_y)$.\nIn vacuum ($x<0$), for the incident wave component:\n$$\nZ_{vac} = \\frac{E_I e^{\\mathrmj k_x x}}{-H_{y,I}} = \\frac{E_I e^{\\mathrmj k_x x}}{-(-\\frac{k_x}{\\omega\\mu_0} E_I e^{\\mathrmj k_x x})} = \\frac{\\omega\\mu_0}{k_x}\n$$\nFor there to be no reflection, the wave impedance of the PML medium, $Z_{PML}$, must be equal to $Z_{vac}$. We now calculate $Z_{PML}$.\n\nThe problem states that the PML is implemented by the replacement $\\partial/\\partial x \\mapsto (1/s_x)\\partial/\\partial x$. This is a statement about a coordinate stretching transformation. The rigorous application of this transformation to Maxwell's equations is known to be equivalent to modeling the medium with anisotropic permittivity and permeability tensors. For a PML implemented along the $x$-axis, these tensors are:\n$$\n\\underline{\\underline{\\varepsilon}} = \\epsilon_0 \\Lambda, \\quad \\underline{\\underline{\\mu}} = \\mu_0 \\Lambda, \\quad \\text{with} \\quad \\Lambda = \\begin{pmatrix} 1/s_x & 0 & 0 \\\\ 0 & s_x & 0 \\\\ 0 & 0 & s_x \\end{pmatrix}\n$$\nMaxwell's equations in the PML medium ($x>0$) are:\n$$\n\\nabla\\times\\vec{E} = \\mathrm{j}\\omega\\underline{\\underline{\\mu}}\\vec{H}\n$$\n$$\n\\nabla\\times\\vec{H} = -\\mathrm{j}\\omega\\underline{\\underline{\\varepsilon}}\\vec{E}\n$$\nFor the TE case, the component-wise equations in the PML are:\n$$\n\\frac{\\partial E_z}{\\partial y} = \\mathrmj\\omega\\mu_x H_x = \\mathrmj\\omega(\\mu_0/s_x) H_x \\quad(1')\n$$\n$$\n-\\frac{\\partial E_z}{\\partial x} = \\mathrmj\\omega\\mu_y H_y = \\mathrmj\\omega(\\mu_0 s_x) H_y \\quad(2')\n$$\n$$\n\\frac{\\partial H_y}{\\partial x} - \\frac{\\partial H_x}{\\partial y} = -\\mathrmj\\omega\\epsilon_z E_z = -\\mathrmj\\omega(\\epsilon_0 s_x) E_z \\quad(3')\n$$\nTo find the wave impedance, we first need the dispersion relation. We combine these three equations to find a wave equation for $E_z$. From (1') and (2'):\n$$\nH_x = \\frac{s_x}{\\mathrmj\\omega\\mu_0} \\frac{\\partial E_z}{\\partial y}, \\qquad H_y = \\frac{-1}{\\mathrmj\\omega\\mu_0 s_x} \\frac{\\partial E_z}{\\partial x}\n$$\nSubstituting these into (3'):\n$$\n\\frac{\\partial}{\\partial x}\\left(\\frac{-1}{\\mathrmj\\omega\\mu_0 s_x} \\frac{\\partial E_z}{\\partial x}\\right) - \\frac{\\partial}{\\partial y}\\left(\\frac{s_x}{\\mathrmj\\omega\\mu_0} \\frac{\\partial E_z}{\\partial y}\\right) = -\\mathrmj\\omega\\epsilon_0 s_x E_z\n$$\nAssuming $s_x$ is uniform in space:\n$$\n\\frac{-1}{s_x} \\frac{\\partial^2 E_z}{\\partial x^2} - s_x \\frac{\\partial^2 E_z}{\\partial y^2} = (\\mathrmj\\omega)^2\\mu_0\\epsilon_0 s_x E_z = -\\omega^2\\mu_0\\epsilon_0 s_x E_z = -k_0^2 s_x E_z\n$$\nDividing by $-s_x$:\n$$\n\\frac{1}{s_x^2} \\frac{\\partial^2 E_z}{\\partial x^2} + \\frac{\\partial^2 E_z}{\\partial y^2} + k_0^2 E_z = 0\n$$\nNow, we assume a transmitted plane-wave solution of the form $E_z^{(2)}(x,y) = E_T e^{\\mathrmj k_{px} x} e^{\\mathrmj k_y y}$. Substituting into the wave equation gives the dispersion relation:\n$$\n\\frac{1}{s_x^2} (\\mathrmj k_{px})^2 + (\\mathrmj k_y)^2 + k_0^2 = 0 \\implies -\\frac{k_{px}^2}{s_x^2} - k_y^2 + k_0^2 = 0\n$$\n$$\nk_{px}^2 = s_x^2 (k_0^2 - k_y^2) = s_x^2 (k_0^2 - k_0^2 \\sin^2\\theta) = s_x^2 (k_0^2 \\cos^2\\theta) = (s_x k_x)^2\n$$\nSo, the normal component of the wavevector in the PML is $k_{px} = s_x k_x$. We choose the positive sign for the forward-propagating wave. The transmitted wave is $E_z^{(2)} = E_T e^{\\mathrmj s_x k_x x} e^{\\mathrmj k_y y}$. Note that for attenuation, we require $\\mathrm{Im}(s_x k_x)>0$. The given $s_x = \\kappa_x + \\frac{\\sigma_x}{\\alpha_x+\\mathrm{j}\\omega}$ has $\\mathrm{Im}(s_x) = \\frac{-\\sigma_x\\omega}{\\alpha_x^2+\\omega^2} \\le 0$ for $\\omega>0$. Thus, $e^{\\mathrmj s_x k_x x}$ has a growing amplitude. The convention used in the problem statement for $s_x$ is for $e^{\\mathrm{j}\\omega t}$, whereas we used $e^{-\\mathrm{j}\\omega t}$. Let's switch to the $e^{\\mathrm{j}\\omega t}$ convention. Maxwell's equations become $\\nabla\\times\\vec{E} = -\\mathrmj\\omega\\underline{\\underline{\\mu}}\\vec{H}$ and $\\nabla\\times\\vec{H} = \\mathrmj\\omega\\underline{\\underline{\\varepsilon}}\\vec{E}$. The result is that all $\\mathrmj$s flip signs. The wave equation and dispersion relation are unchanged. The forward wave is $e^{\\mathrmj s_x k_x x}$. For this to be attenuated, we need $\\mathrm{Im}(s_x) > 0$. The given $s_x$ has $\\mathrm{Im}(s_x) \\le 0$. A physically realizable decaying wave must be chosen. The wave $e^{-\\mathrm{j}s_x k_x x}$ has amplitude $\\exp(\\mathrm{Im}(s_x k_x)x)$ which decays as $\\mathrm{Im}(s_x)<0$. Let's proceed, the impedance calculation is independent of this choice.\n\nNow, we calculate the wave impedance of the PML medium for a forward-propagating wave. Using equation (2') with the $e^{-\\mathrm{j}\\omega t}$ convention:\n$$\n-\\frac{\\partial E_z^{(2)}}{\\partial x} = \\mathrmj\\omega(\\mu_0 s_x) H_y^{(2)}\n$$\nFor the forward wave $E_z^{(2)} \\propto e^{\\mathrmj s_x k_x x}$:\n$$\n-(\\mathrmj s_x k_x) E_z^{(2)} = \\mathrmj\\omega\\mu_0 s_x H_y^{(2)}\n$$\n$$\n-k_x E_z^{(2)} = \\omega\\mu_0 H_y^{(2)} \\implies H_y^{(2)} = -\\frac{k_x}{\\omega\\mu_0} E_z^{(2)}\n$$\nThe transverse wave impedance of the PML is:\n$$\nZ_{PML} = \\frac{E_z^{(2)}}{-H_y^{(2)}} = \\frac{E_z^{(2)}}{-(-\\frac{k_x}{\\omega\\mu_0} E_z^{(2)})} = \\frac{\\omega\\mu_0}{k_x}\n$$\nWe see that $Z_{PML}$ is purely real and identical to the vacuum wave impedance $Z_{vac}$:\n$$\nZ_{PML} = Z_{vac} = \\frac{\\omega\\mu_0}{k_x}\n$$\nThe reflection coefficient $R$ at the interface between two media is given by the standard formula:\n$$\nR = \\frac{Z_{PML} - Z_{vac}}{Z_{PML} + Z_{vac}}\n$$\nSince the impedances are perfectly matched, we have:\n$$\nR(\\theta, \\omega) = \\frac{\\frac{\\omega\\mu_0}{k_x} - \\frac{\\omega\\mu_0}{k_x}}{\\frac{\\omega\\mu_0}{k_x} + \\frac{\\omega\\mu_0}{k_x}} = \\frac{0}{2\\frac{\\omega\\mu_0}{k_x}} = 0\n$$\nThis holds for all $\\theta$ (such that $k_x \\neq 0$) and all $\\omega$. For grazing incidence $\\theta=\\pi/2$, $k_x=0$ and the impedance is infinite, but the concept of reflection is ill-defined. For all other angles, the reflection is zero.\n\nThe reflection coefficient is identically zero because the CFS-PML, by design, has a wave impedance that is independent of its absorbing parameter $s_x$ and is perfectly matched to the impedance of the surrounding medium (vacuum in this case) for all angles of incidence and all frequencies.", "answer": "$$\n\\boxed{0}\n$$", "id": "3293614"}, {"introduction": "Moving from the ideal continuous model to a practical discrete simulation introduces new challenges, particularly regarding numerical stability. While the underlying continuous PML equations are inherently passive, a naive time-stepping scheme can introduce non-physical oscillations or even cause the simulation to diverge. This exercise [@problem_id:3293628] explores how to analyze the stability of a discretized auxiliary equation and derive the corrected, unconditionally stable update coefficients that are essential for any robust time-domain code.", "problem": "Consider the one-dimensional Maxwell curl equations discretized in time by a Finite-Difference Time-Domain (FDTD) scheme and terminated by a Complex-Frequency-Shifted Perfectly Matched Layer (CFS-PML). In the standard split-field formulation, the auxiliary polarization-like state variable $\\psi$ obeys a first-order linear differential equation driven by the primary field (take it here as $E$) of the form\n$$\n\\frac{d \\psi(t)}{d t} \\;=\\; -\\left(\\frac{\\sigma}{\\kappa} + \\alpha\\right)\\,\\psi(t) \\;+\\; \\frac{\\sigma}{\\kappa}\\,E(t),\n$$\nwhere $\\sigma > 0$ is the conductivity profile of the Perfectly Matched Layer (PML), $\\kappa \\ge 1$ is the PML scaling factor, and $\\alpha \\ge 0$ is the complex-frequency shift parameter (a real shift of the complex frequency that improves low-frequency attenuation). This ordinary differential equation represents the local relaxation dynamics embedded in the CFS-PML constitutive relation and, in the continuous-time sense, defines a passive and stable subsystem for $\\sigma > 0$ and $\\alpha \\ge 0$.\n\nA common time discretization employs the explicit forward rectangular rule (explicit Euler) with time step $\\Delta t > 0$, resulting in the recursion\n$$\n\\psi^{n+1} \\;=\\; \\psi^{n} \\;+\\; \\Delta t\\left[-\\left(\\frac{\\sigma}{\\kappa} + \\alpha\\right)\\psi^{n} \\;+\\; \\frac{\\sigma}{\\kappa}\\,E^{n}\\right],\n$$\nwhere superscripts denote discrete time indices. Focus on the homogeneous part of the recursion (set the input $E^{n}=0$) to analyze stability and passivity properties inferred by the pole of the discrete-time subsystem. Let $a \\equiv \\frac{\\sigma}{\\kappa} + \\alpha$.\n\nStarting from first principles and standard properties of passive linear time-invariant systems:\n- Derive the homogeneous-update coefficient of this explicit rectangular-rule discretization and identify parameter regimes in terms of $a\\Delta t$ where passivity is violated even though the recursion remains asymptotically stable, and where it becomes unstable with poles outside the unit circle in the complex $z$-plane.\n- For the unstable regime, explicitly locate the discrete-time pole and state the condition on $a\\Delta t$ under which its magnitude exceeds unity.\n- Propose corrected homogeneous-update coefficients obtained by an exact integration of the continuous-time relaxation over one time step $\\Delta t$, so that the resulting discrete-time subsystem is both stable and passive for all $\\sigma > 0$, $\\kappa \\ge 1$, and $\\alpha \\ge 0$.\n\nExpress your final answer as a single closed-form analytic expression for the corrected homogeneous-update coefficient in terms of $\\sigma$, $\\kappa$, $\\alpha$, and $\\Delta t$. No numerical evaluation is required.", "solution": "The problem asks for an analysis of the stability and passivity of a discretized auxiliary equation from a Complex-Frequency-Shifted Perfectly Matched Layer (CFS-PML) and for the derivation of a corrected, unconditionally stable and passive update coefficient.\n\nThe continuous-time ordinary differential equation is given by:\n$$\n\\frac{d \\psi(t)}{d t} \\;=\\; -\\left(\\frac{\\sigma}{\\kappa} + \\alpha\\right)\\,\\psi(t) \\;+\\; \\frac{\\sigma}{\\kappa}\\,E(t)\n$$\nThe parameter constraints are $\\sigma > 0$, $\\kappa \\ge 1$, $\\alpha \\ge 0$, and the time step $\\Delta t > 0$.\nWe define the constant $a \\equiv \\frac{\\sigma}{\\kappa} + \\alpha$. From the given constraints, it is clear that $a > 0$.\nThe homogeneous version of the continuous-time equation is:\n$$\n\\frac{d \\psi(t)}{d t} = -a\\,\\psi(t)\n$$\nThis is a simple first-order linear homogeneous ODE. For any initial condition $\\psi(0) > 0$, the solution $\\psi(t) = \\psi(0)\\exp(-at)$ is a positive, monotonically decaying function. This system is inherently passive and stable, meaning it only dissipates energy and does not generate it or oscillate.\n\nNow, we analyze the provided explicit forward rectangular rule (explicit Euler) discretization. The full recursion is:\n$$\n\\psi^{n+1} = \\psi^{n} + \\Delta t\\left[-a\\,\\psi^{n} + \\frac{\\sigma}{\\kappa}\\,E^{n}\\right]\n$$\nTo analyze stability, we consider the homogeneous part of the recursion by setting the external driving term $E^n$ to $0$:\n$$\n\\psi^{n+1} = \\psi^{n} + \\Delta t(-a\\,\\psi^{n})\n$$\n$$\n\\psi^{n+1} = (1 - a\\Delta t)\\,\\psi^{n}\n$$\nThis is a geometric progression. The term $(1 - a\\Delta t)$ is the homogeneous-update coefficient, which corresponds to the pole of the discrete-time system's transfer function in the $z$-plane. Let this pole be denoted by $p_{Euler} = 1 - a\\Delta t$.\n\n**Stability and Passivity Analysis of the Explicit Euler Discretization**\n\nA linear time-invariant (LTI) discrete-time system is asymptotically stable if all its poles lie strictly inside the unit circle in the complex $z$-plane, i.e., $|p| < 1$.\nFor our system, the stability condition is:\n$$\n|p_{Euler}| < 1 \\implies |1 - a\\Delta t| < 1\n$$\nThis inequality can be expanded as:\n$$\n-1 < 1 - a\\Delta t < 1\n$$\nSubtracting $1$ from all parts gives:\n$$\n-2 < -a\\Delta t < 0\n$$\nMultiplying by $-1$ and reversing the inequalities yields:\n$$\n0 < a\\Delta t < 2\n$$\nSo, the explicit Euler discretization is stable only if $a\\Delta t < 2$.\n\nPassivity of the discrete system requires that it does not introduce non-physical behaviors, such as oscillations, which are absent in the original continuous-time relaxation process. For a first-order relaxation, this means the pole must be real and non-negative, i.e., $p \\ge 0$. For a system that must also be stable, the pole must be in the range $0 \\le p < 1$. A negative pole implies that the sign of $\\psi^n$ flips at each time step, an unphysical numerical oscillation.\n\nWe can identify three distinct regimes for the behavior of the discrete system based on the value of $a\\Delta t$:\n\n1.  **Stable and Passive Regime:** $0 \\le p_{Euler} < 1$.\n    The condition $p_{Euler} \\ge 0$ implies $1 - a\\Delta t \\ge 0$, which means $a\\Delta t \\le 1$.\n    The condition $p_{Euler} < 1$ implies $1 - a\\Delta t < 1$, which means $-a\\Delta t < 0$, or $a\\Delta t > 0$. This is always true given the parameter constraints.\n    Therefore, the system is stable and passive for $0 < a\\Delta t \\le 1$.\n\n2.  **Stable but Not Passive Regime:** $-1 < p_{Euler} < 0$.\n    This occurs when $1 < a\\Delta t < 2$. In this regime, the system is still asymptotically stable because the magnitude of the pole is less than $1$. However, the pole is negative, which causes the solution to oscillate with a decaying envelope ($\\psi^n = (p_{Euler})^n \\psi^0$). This violates the passive nature of the underlying continuous-time system. Passivity is violated even though stability is maintained.\n\n3.  **Unstable Regime:** $|p_{Euler}| \\ge 1$.\n    Since $a\\Delta t > 0$, $p_{Euler} = 1 - a\\Delta t$ is always less than $1$. Thus, instability can only occur when $p_{Euler} \\le -1$.\n    $1 - a\\Delta t \\le -1 \\implies 2 \\le a\\Delta t$.\n    In this regime, the magnitude of the solution, $|\\psi^n|$, grows without bound, leading to numerical instability. The explicit condition for the magnitude of the pole to exceed unity, $|p_{Euler}| > 1$, is $a\\Delta t > 2$. The pole is located at $p_{Euler} = 1 - a\\Delta t$ on the negative real axis.\n\n**Derivation of the Corrected Homogeneous-Update Coefficient**\n\nTo ensure the discrete-time system is always stable and passive, mirroring the properties of the continuous-time system, we can derive the update coefficient by exactly integrating the homogeneous ODE over a single time step $\\Delta t$. Starting from the continuous homogeneous equation:\n$$\n\\frac{d\\psi}{dt} = -a\\,\\psi\n$$\nWe separate variables and integrate from time $t_n$ to $t_{n+1} = t_n + \\Delta t$, with corresponding values $\\psi(t_n) = \\psi^n$ and $\\psi(t_{n+1}) = \\psi^{n+1}$:\n$$\n\\int_{\\psi^n}^{\\psi^{n+1}} \\frac{d\\psi}{\\psi} = \\int_{t_n}^{t_{n+1}} -a\\,dt\n$$\n$$\n\\left[ \\ln|\\psi| \\right]_{\\psi^n}^{\\psi^{n+1}} = -a [t]_{t_n}^{t_{n+1}}\n$$\n$$\n\\ln(\\psi^{n+1}) - \\ln(\\psi^n) = -a(t_{n+1} - t_n) = -a\\Delta t\n$$\n$$\n\\ln\\left(\\frac{\\psi^{n+1}}{\\psi^n}\\right) = -a\\Delta t\n$$\nExponentiating both sides gives the exact update rule:\n$$\n\\frac{\\psi^{n+1}}{\\psi^n} = \\exp(-a\\Delta t) \\implies \\psi^{n+1} = \\exp(-a\\Delta t)\\,\\psi^n\n$$\nThe corrected homogeneous-update coefficient is therefore $C_{exact} = \\exp(-a\\Delta t)$.\n\nLet's check the properties of this corrected coefficient. Given the constraints $\\sigma > 0$, $\\kappa \\ge 1$, $\\alpha \\ge 0$, and $\\Delta t > 0$, the term $a = \\frac{\\sigma}{\\kappa} + \\alpha$ is strictly positive. Consequently, the exponent $-a\\Delta t$ is strictly negative.\nFor any strictly positive value $x = a\\Delta t$, the coefficient is $\\exp(-x)$. The exponential function has the property that for $x > 0$, $0 < \\exp(-x) < 1$.\nThis means the pole of the corrected discrete-time system is always in the interval $(0, 1)$.\n-   **Stability:** Since $|C_{exact}| < 1$, the system is unconditionally stable for all $\\Delta t > 0$.\n-   **Passivity:** Since $0 < C_{exact} < 1$, the pole is always positive, and no unphysical oscillations are introduced. The system is unconditionally passive.\n\nSubstituting the definition of $a$ back into the expression for the corrected coefficient, we obtain the final answer in terms of the original PML parameters.\nThe corrected homogeneous-update coefficient is $\\exp\\left(-\\left(\\frac{\\sigma}{\\kappa} + \\alpha\\right)\\Delta t\\right)$.\nThis coefficient replaces the term $(1 - a\\Delta t)$ in the homogeneous part of the update equation, leading to a discretely passive and stable implementation.", "answer": "$$\\boxed{\\exp\\left(-\\left(\\frac{\\sigma}{\\kappa} + \\alpha\\right)\\Delta t\\right)}$$", "id": "3293628"}, {"introduction": "The theoretical advantage of the Complex-Frequency-Shifted (CFS) PML lies in its ability to absorb waves that are poorly handled by classical PMLs, such as evanescent fields and waves at grazing incidence. This final practice challenges you to quantify this performance difference in a tangible way. By implementing a simulation [@problem_id:3293635], you will directly compare the reflection from a classical PML (where the shift parameter $\\alpha = 0$) with a CFS-PML (where $\\alpha > 0$) for a challenging grazing-incidence scenario.", "problem": "Consider a two-dimensional plane wave in vacuum impinging on a homogeneous Perfectly Matched Layer (PML) that occupies the half-space $x \\ge 0$ with constant parameters. The PML is modeled via complex coordinate stretching along the $x$-direction. Let the free-space wave speed be $c = 299\\,792\\,458 \\, \\text{m/s}$. The incident wave has angular frequency $\\omega$ and incidence angle $\\theta$ measured from the surface normal (so that $\\theta = 0$ corresponds to normal incidence and $\\theta \\to \\frac{\\pi}{2}$ corresponds to grazing incidence). The PML employs the complex-frequency-shifted coordinate-stretching function\n$$\ns_x(\\omega) = \\kappa + \\frac{\\sigma}{\\alpha + j \\omega},\n$$\nwhere $\\kappa \\ge 1$ is dimensionless, $\\sigma \\ge 0$ has units of $\\text{s}^{-1}$, and $\\alpha \\ge 0$ has units of $\\text{s}^{-1}$. The case $\\alpha = 0$ corresponds to the classical PML, while $\\alpha > 0$ corresponds to the complex-frequency-shifted PML.\n\nA time-harmonic plane wave in vacuum satisfies the dispersion relation $k_0 = \\omega/c$ and has $x$-directed wavenumber component $k_x = k_0 \\cos \\theta$. Under complex coordinate stretching, the plane-wave solution in the PML takes the form $\\exp\\!\\left(j k_x \\int_0^x \\frac{dx'}{s_x(\\omega)}\\right)$, so that the amplitude attenuation per unit length along $x$ is governed by the imaginary part of $1/s_x(\\omega)$. Define\n$$\nb(\\omega) = \\operatorname{Im}\\!\\left(\\frac{1}{s_x(\\omega)}\\right),\n\\quad\n\\gamma(\\omega,\\theta) = k_x \\, b(\\omega) = \\frac{\\omega}{c}\\cos\\theta \\; b(\\omega),\n$$\nso that a single pass through a PML slab of thickness $d$ produces an amplitude factor $\\exp(-\\gamma(\\omega,\\theta) d)$. If a perfect electric conductor terminates the PML at $x=d$, the energy reflection back into vacuum from this termination (double pass) for the monochromatic component at $\\omega$ is approximated by\n$$\n\\mathcal{R}(\\omega,\\theta) \\approx \\exp\\left(-4 \\, \\gamma(\\omega,\\theta) \\, d\\right).\n$$\n\nNow consider a causal Gaussian-bandlimited pulse with spectral energy density\n$$\nS(\\omega) = \\exp\\!\\left(-\\frac{(\\omega - \\omega_0)^2}{2 \\sigma_\\omega^2}\\right), \\quad \\omega \\ge 0,\n$$\nwhere $\\omega_0 > 0$ is the center angular frequency and $\\sigma_\\omega > 0$ is the spectral standard deviation. The total energy-normalized reflection for the pulse is estimated by\n$$\n\\mathcal{E}(\\theta; \\kappa,\\sigma,\\alpha,d,\\omega_0,\\sigma_\\omega) = \\frac{\\int_0^\\infty S(\\omega) \\, \\exp\\!\\left(-4 \\gamma(\\omega,\\theta) d \\right) \\, d\\omega}{\\int_0^\\infty S(\\omega) \\, d\\omega}.\n$$\n\nYour task is to write a program that, for each test case described below, computes the scalar quantity $\\mathcal{E}$ as a floating-point number (dimensionless, since it is an energy ratio). All angles must be interpreted in degrees in the input parameters, and all distances must be in meters. Frequencies must be in radians per second inside the formulas, so if center frequency and bandwidth are given in hertz, they must be converted to radians per second via multiplication by $2\\pi$.\n\nUse the following test suite. Each test case is a tuple $(\\alpha,\\kappa,\\sigma,d,\\theta_{\\text{deg}},f_0,\\Delta f)$ with units specified as follows:\n- $\\alpha$ in $\\text{s}^{-1}$,\n- $\\kappa$ unitless,\n- $\\sigma$ in $\\text{s}^{-1}$,\n- $d$ in $\\text{m}$,\n- $\\theta_{\\text{deg}}$ in degrees,\n- $f_0$ in $\\text{Hz}$,\n- $\\Delta f$ in $\\text{Hz}$,\nand with $\\omega_0 = 2\\pi f_0$ and $\\sigma_\\omega = 2\\pi \\Delta f$.\n\nTest cases:\n1. $(0.0, \\, 1.0, \\, 5.0\\times 10^9, \\, 0.2, \\, 89.0, \\, 1.0\\times 10^9, \\, 0.5\\times 10^9)$\n2. $(2\\pi \\times 0.2\\times 10^9, \\, 1.0, \\, 5.0\\times 10^9, \\, 0.2, \\, 89.0, \\, 1.0\\times 10^9, \\, 0.5\\times 10^9)$\n3. $(0.0, \\, 1.0, \\, 5.0\\times 10^9, \\, 0.2, \\, 89.9, \\, 1.0\\times 10^9, \\, 0.5\\times 10^9)$\n4. $(0.0, \\, 1.0, \\, 5.0\\times 10^9, \\, 0.0, \\, 85.0, \\, 1.0\\times 10^9, \\, 0.5\\times 10^9)$\n5. $(0.0, \\, 1.0, \\, 5.0\\times 10^9, \\, 0.4, \\, 85.0, \\, 2.0\\times 10^9, \\, 0.5\\times 10^9)$\n\nImplementation requirements and numerical guidance:\n- Evaluate the integrals over $\\omega$ on a finite interval $[\\omega_{\\min},\\omega_{\\max}]$ chosen to capture the Gaussian spectrum effectively. A reasonable choice is $\\omega_{\\min} = \\max\\{0, \\omega_0 - L \\sigma_\\omega\\}$ and $\\omega_{\\max} = \\omega_0 + L \\sigma_\\omega$ with $L=8$.\n- Use consistent units: express $\\theta$ in radians inside trigonometric functions and all angular frequencies in radians per second.\n- For each test case, compute $\\mathcal{E}$ to a reasonable numerical accuracy.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[r1,r2,r3,r4,r5]\"), where each $r_i$ is the computed value of $\\mathcal{E}$ for the $i$-th test case.\n\nExpress all distances in meters, all angles in degrees as specified, and produce the final outputs as dimensionless floats on a single line in the specified format. No other units are required in the output, since $\\mathcal{E}$ is dimensionless by definition.", "solution": "The user-provided problem has been analyzed and validated against the specified criteria.\n\n### Step 1: Extract Givens\n- **Physical System**: 2D plane wave in vacuum incident on a PML half-space $x \\ge 0$.\n- **Constant**: Speed of light in vacuum, $c = 299\\,792\\,458 \\, \\text{m/s}$.\n- **Incident Wave Parameters**: Angular frequency $\\omega$, incidence angle $\\theta$ from the surface normal.\n- **PML Model**: Complex coordinate stretching function $s_x(\\omega) = \\kappa + \\frac{\\sigma}{\\alpha + j \\omega}$.\n- **PML Parameters**: $\\kappa \\ge 1$ (dimensionless), $\\sigma \\ge 0$ ($\\text{s}^{-1}$), $\\alpha \\ge 0$ ($\\text{s}^{-1}$).\n- **Key Functions**:\n    - Vacuum wave number: $k_0 = \\omega/c$.\n    - Wavenumber component: $k_x = k_0 \\cos \\theta$.\n    - Attenuation function: $b(\\omega) = \\operatorname{Im}(1/s_x(\\omega))$.\n    - Attenuation rate: $\\gamma(\\omega,\\theta) = k_x b(\\omega) = \\frac{\\omega}{c}\\cos\\theta \\, b(\\omega)$.\n- **Reflection Model**: Double-pass energy reflection for a PML of thickness $d$ terminated by a perfect electric conductor is $\\mathcal{R}(\\omega,\\theta) \\approx \\exp\\left(-4 \\, \\gamma(\\omega,\\theta) \\, d\\right)$.\n- **Pulse Model**: Gaussian-bandlimited pulse with spectral energy density $S(\\omega) = \\exp(-\\frac{(\\omega - \\omega_0)^2}{2 \\sigma_\\omega^2})$ for $\\omega \\ge 0$.\n- **Quantity to Compute**: Total energy-normalized reflection $\\mathcal{E} = \\frac{\\int_0^\\infty S(\\omega) \\, \\exp\\left(-4 \\gamma(\\omega,\\theta) d \\right) \\, d\\omega}{\\int_0^\\infty S(\\omega) \\, d\\omega}$.\n- **Input Parameters & Test Cases**: Five test cases are provided as tuples $(\\alpha,\\kappa,\\sigma,d,\\theta_{\\text{deg}},f_0,\\Delta f)$, with specified units requiring conversion: $\\omega_0 = 2\\pi f_0$ and $\\sigma_\\omega = 2\\pi \\Delta f$.\n- **Numerical Guidance**: Integrate over $[\\omega_{\\min},\\omega_{\\max}] = [\\max\\{0, \\omega_0 - L \\sigma_\\omega\\}, \\omega_0 + L \\sigma_\\omega]$ with $L=8$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in the established theory of Perfectly Matched Layers in computational electromagnetics. The formulation of the complex stretching function, the resulting wave attenuation, and the energy reflection integral are standard. The problem is well-posed, providing all necessary definitions, constants, and parameters to compute a unique numerical result. The parameters in the test cases are physically realistic, designed to test the performance of classical ($\\alpha=0$) versus complex-frequency-shifted ($\\alpha>0$) PMLs, particularly at challenging grazing incidence angles. The special case $d=0$ provides a trivial sanity check where the reflection $\\mathcal{E}$ must equal $1$. The problem statement is self-contained, objective, and mathematically consistent. No flaws were identified.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be provided.\n\n### Principle-Based Design of the Solution\nThe task is to compute the total energy-normalized reflection $\\mathcal{E}$ for a Gaussian pulse. This quantity is defined as a ratio of two integrals over the angular frequency $\\omega$:\n$$\n\\mathcal{E} = \\frac{\\mathcal{N}}{\\mathcal{D}} = \\frac{\\int_0^\\infty S(\\omega) \\, \\exp\\!\\left(-4 \\, \\gamma(\\omega,\\theta) \\, d \\right) \\, d\\omega}{\\int_0^\\infty S(\\omega) \\, d\\omega}\n$$\nThe denominator $\\mathcal{D}$ is the total energy of the incident pulse, while the numerator $\\mathcal{N}$ is the total reflected energy after a double pass through the PML of thickness $d$. The solution involves the numerical evaluation of these integrals.\n\nThe core of the problem lies in the function $\\gamma(\\omega, \\theta)$, which dictates the attenuation. It is defined as:\n$$\n\\gamma(\\omega,\\theta) = \\frac{\\omega}{c}\\cos\\theta \\; \\operatorname{Im}\\!\\left(\\frac{1}{s_x(\\omega)}\\right)\n$$\nwhere $s_x(\\omega) = \\kappa + \\frac{\\sigma}{\\alpha + j \\omega}$. The implementation details for $\\gamma(\\omega, \\theta)$ must be handled carefully to maintain numerical stability, particularly for the classical PML case where $\\alpha=0$.\n\nFor the classical PML case ($\\alpha=0$), the stretching function is $s_x(\\omega) = \\kappa + \\frac{\\sigma}{j\\omega} = \\kappa - j\\frac{\\sigma}{\\omega}$. The imaginary part of its reciprocal, $b(\\omega)$, can be found analytically to avoid numerical issues near $\\omega=0$:\n$$\n\\frac{1}{s_x(\\omega)} = \\frac{1}{\\kappa - j\\frac{\\sigma}{\\omega}} = \\frac{\\kappa + j\\frac{\\sigma}{\\omega}}{\\kappa^2 + (\\sigma/\\omega)^2} = \\frac{\\omega^2\\kappa + j\\omega\\sigma}{\\omega^2\\kappa^2 + \\sigma^2}\n$$\n$$\nb(\\omega) = \\operatorname{Im}\\!\\left(\\frac{1}{s_x(\\omega)}\\right) = \\frac{\\omega\\sigma}{\\omega^2\\kappa^2 + \\sigma^2}\n$$\nThus, for $\\alpha=0$, the attenuation rate is given by the numerically stable form:\n$$\n\\gamma(\\omega,\\theta) = \\frac{\\omega}{c}\\cos\\theta \\left( \\frac{\\omega\\sigma}{\\omega^2\\kappa^2 + \\sigma^2} \\right) = \\frac{\\sigma \\omega^2 \\cos\\theta}{c (\\kappa^2\\omega^2 + \\sigma^2)}\n$$\nThis expression is well-behaved for all $\\omega \\ge 0$.\n\nFor the complex-frequency-shifted (CFS) PML case ($\\alpha > 0$), the denominator $\\alpha + j\\omega$ is never zero for $\\omega \\ge 0$. Thus, $s_x(\\omega)$ is well-defined, and its reciprocal can be computed directly using complex arithmetic. The attenuation rate $\\gamma(\\omega,\\theta)$ can be implemented as:\n$$\n\\gamma(\\omega,\\theta) = \\frac{\\omega}{c}\\cos\\theta \\; \\operatorname{Im}\\!\\left(\\frac{1}{\\kappa + \\frac{\\sigma}{\\alpha + j \\omega}}\\right)\n$$\n\nThe numerical implementation proceeds as follows:\n1.  For each test case, convert input parameters to SI units and radians: $\\theta_{\\text{deg}} \\to \\theta$ (radians), $f_0 \\to \\omega_0$ (rad/s), and $\\Delta f \\to \\sigma_\\omega$ (rad/s).\n2.  Handle the trivial case where the PML thickness $d=0$. In this case, the reflection factor $\\exp(-4\\gamma d)$ is $\\exp(0)=1$, making $\\mathcal{E}=1$.\n3.  Define the integration range $[\\omega_{\\min}, \\omega_{\\max}]$ as specified, with $\\omega_{\\min} = \\max\\{0, \\omega_0 - 8 \\sigma_\\omega\\}$ and $\\omega_{\\max} = \\omega_0 + 8 \\sigma_\\omega$. This range is wide enough to capture virtually all the energy of the Gaussian pulse.\n4.  Implement the functions for the integrands. A function `gamma_func(w)` is defined that branches based on the value of $\\alpha$ to use the appropriate stable formula. The numerator integrand is then $S(\\omega) \\exp(-4\\gamma(\\omega, \\theta)d)$ and the denominator integrand is $S(\\omega)$.\n5.  Use a high-quality numerical quadrature routine, such as `scipy.integrate.quad`, to compute the numerator integral $\\mathcal{N}$ and the denominator integral $\\mathcal{D}$ over the determined range $[\\omega_{\\min}, \\omega_{\\max}]$.\n6.  The final result for the test case is the ratio $\\mathcal{E} = \\mathcal{N}/\\mathcal{D}$.\nThis procedure is repeated for all test cases, and the results are formatted into the required output string.", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Solves the PML reflection problem for the given test cases.\n    \"\"\"\n    # Define the constant for the speed of light in vacuum.\n    C_LIGHT = 299792458.0\n\n    # Define the test cases from the problem statement.\n    # Each tuple: (alpha, kappa, sigma, d, theta_deg, f0, delta_f)\n    # Units: alpha (s^-1), kappa (unitless), sigma (s^-1), d (m),\n    #        theta_deg (degrees), f0 (Hz), delta_f (Hz).\n    test_cases = [\n        (0.0, 1.0, 5.0e9, 0.2, 89.0, 1.0e9, 0.5e9),\n        (2 * np.pi * 0.2e9, 1.0, 5.0e9, 0.2, 89.0, 1.0e9, 0.5e9),\n        (0.0, 1.0, 5.0e9, 0.2, 89.9, 1.0e9, 0.5e9),\n        (0.0, 1.0, 5.0e9, 0.0, 85.0, 1.0e9, 0.5e9),\n        (0.0, 1.0, 5.0e9, 0.4, 85.0, 2.0e9, 0.5e9),\n    ]\n\n    def calculate_reflection(params):\n        \"\"\"\n        Computes the energy-normalized reflection E for a single test case.\n        \"\"\"\n        alpha, kappa, sigma, d, theta_deg, f0, df = params\n\n        # Trivial case: If PML thickness is zero, reflection is total (E=1).\n        if d == 0.0:\n            return 1.0\n\n        # Convert input parameters to standard units for calculation (rad, rad/s).\n        theta_rad = np.deg2rad(theta_deg)\n        w0 = 2.0 * np.pi * f0\n        sigma_w = 2.0 * np.pi * df\n\n        cos_theta = np.cos(theta_rad)\n\n        # Define the numerical integration range based on the Gaussian spectrum.\n        L = 8.0\n        w_min = max(0.0, w0 - L * sigma_w)\n        w_max = w0 + L * sigma_w\n\n        # Spectral energy density function S(w)\n        def S(w):\n            return np.exp(-((w - w0)**2) / (2.0 * sigma_w**2))\n\n        # Numerically stable function for the attenuation rate gamma(w, theta).\n        # We branch based on alpha to ensure stability at w=0 for the classical PML.\n        if alpha == 0.0:\n            def gamma_func(w):\n                # Analytical form for alpha=0 case, stable for all w >= 0.\n                numerator = sigma * w**2 * cos_theta\n                denominator = C_LIGHT * (kappa**2 * w**2 + sigma**2)\n                if denominator == 0: return 0.0\n                return numerator / denominator\n        else:  # alpha > 0\n            def gamma_func(w):\n                # Direct computation using complex numbers for CFS-PML (alpha > 0).\n                # This is stable for w >= 0 since alpha > 0.\n                if w == 0.0: return 0.0\n                s_x = kappa + sigma / (alpha + 1j * w)\n                b_w = np.imag(1.0 / s_x)\n                return (w / C_LIGHT) * cos_theta * b_w\n\n        # Integrand for the numerator of E\n        def numerator_integrand(w):\n            gamma = gamma_func(w)\n            attenuation_factor = np.exp(-4.0 * gamma * d)\n            return S(w) * attenuation_factor\n\n        # Integrand for the denominator of E is just S(w)\n        denominator_integrand = S\n\n        # Perform numerical integration using scipy.integrate.quad\n        # Set tolerance for higher accuracy\n        quad_opts = {'epsabs': 1e-12, 'epsrel': 1e-12}\n        num_integral, _ = quad(numerator_integrand, w_min, w_max, **quad_opts)\n        den_integral, _ = quad(denominator_integrand, w_min, w_max, **quad_opts)\n\n        # The result is the ratio of the two integrals.\n        if den_integral == 0.0:\n            return 0.0  # Should not happen for valid pulse parameters\n        \n        return num_integral / den_integral\n\n    # Calculate reflection for each test case\n    results = [calculate_reflection(case) for case in test_cases]\n\n    # Print the results in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3293635"}]}