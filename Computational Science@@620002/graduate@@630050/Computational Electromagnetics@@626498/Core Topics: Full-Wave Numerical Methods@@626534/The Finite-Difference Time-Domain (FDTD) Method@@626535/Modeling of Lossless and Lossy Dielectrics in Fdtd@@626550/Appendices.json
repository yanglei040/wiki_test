{"hands_on_practices": [{"introduction": "To effectively simulate wave propagation in realistic materials, we must translate the continuous laws of physics into discrete algorithms. This first practice guides you through the fundamental derivation of the Finite-Difference Time-Domain (FDTD) update equations for a dispersive Debye material, incorporating both dielectric relaxation and conductive losses [@problem_id:3331618]. Mastering this derivation builds a crucial foundation for understanding and implementing advanced material models in FDTD.", "problem": "Consider a nonmagnetic linear isotropic dielectric modeled by a single-pole Debye relaxation, simulated with the Finite-Difference Time-Domain (FDTD) method on a staggered Yee time grid. Let the electric field be updated at integer times $t^{n} = n \\,\\Delta t$ and the magnetic field at half-integer times $t^{n+\\frac{1}{2}} = \\left(n+\\tfrac{1}{2}\\right)\\Delta t$. The constitutive relation is $ \\mathbf{D}(t) = \\epsilon_{\\infty} \\mathbf{E}(t) + \\mathbf{P}(t) $, where $\\epsilon_{\\infty}$ is the high-frequency permittivity and $\\mathbf{P}(t)$ is the polarization density obeying the Debye ordinary differential equation\n$$\n\\frac{d \\mathbf{P}}{dt} = \\frac{\\Delta \\epsilon}{\\tau} \\,\\mathbf{E}(t) - \\frac{1}{\\tau}\\,\\mathbf{P}(t),\n$$\nwith $\\Delta \\epsilon = \\epsilon_{s} - \\epsilon_{\\infty} \\ge 0$ the static increment of permittivity and $\\tau  0$ the relaxation time. The medium may be lossy with uniform electric conductivity $\\sigma \\ge 0$, producing a conduction current density $\\mathbf{J}_{\\mathrm{c}}(t) = \\sigma \\mathbf{E}(t)$. Neglect any impressed sources.\n\nStarting from Maxwell–Ampère’s law in the time domain,\n$$\n\\frac{\\partial \\mathbf{D}}{\\partial t} = \\nabla \\times \\mathbf{H} - \\mathbf{J}_{\\mathrm{c}},\n$$\nderive a fully explicit update for the electric field $\\mathbf{E}^{n+1}$ at time $t^{n+1}$ in terms of known quantities at time levels $t^{n}$ and $t^{n+\\frac{1}{2}}$ under the following modeling and discretization assumptions, all of which must be used and justified in your derivation:\n\n- Treat the polarization dynamics by exact time integration over the interval $[t^{n}, t^{n+1}]$ under the assumption that the electric field is piecewise constant in time over this interval at its staggered update level $t^{n}$.\n- Discretize Maxwell–Ampère’s law in time over $[t^{n}, t^{n+1}]$ in a form consistent with the Yee grid staggering, such that the discrete curl of $\\mathbf{H}$ is evaluated at $t^{n+\\frac{1}{2}}$ and the remaining terms are expressed at integer times.\n- To maintain second-order accuracy in the presence of conduction, approximate the conduction current over the interval by the trapezoidal rule in time, i.e., use the average of $\\mathbf{E}^{n}$ and $\\mathbf{E}^{n+1}$.\n\nYour final update must have the affine form\n$$\n\\mathbf{E}^{n+1} = C_{E}\\,\\mathbf{E}^{n} + C_{H}\\,\\left(\\nabla \\times \\mathbf{H}\\right)^{n+\\frac{1}{2}} + C_{P}\\,\\mathbf{P}^{n},\n$$\nwith scalar coefficients $C_{E}$, $C_{H}$, and $C_{P}$ expressed in closed form as functions of $\\epsilon_{\\infty}$, $\\Delta \\epsilon$, $\\tau$, $\\sigma$, and $\\Delta t$. Report the three coefficients as a single row vector. No numerical values are to be substituted; provide exact analytical expressions only. The answer must be unitless and must be expressed exactly, with no rounding. In your derivation, start from the laws and definitions stated above and do not invoke any pre-derived update shortcuts not obtained from these first principles.", "solution": "The problem requires the derivation of an explicit finite-difference time-domain (FDTD) update equation for the electric field $\\mathbf{E}$ in a lossy, dispersive dielectric medium characterized by a single-pole Debye relaxation. The derivation must start from Maxwell's equations and adhere to specific discretization assumptions.\n\nThe validation steps confirm that the problem is scientifically grounded, well-posed, objective, and complete. It presents a standard, non-trivial task in computational electromagnetics. Therefore, we proceed with the solution.\n\nThe derivation begins with Maxwell–Ampère’s law, given as:\n$$\n\\frac{\\partial \\mathbf{D}}{\\partial t} = \\nabla \\times \\mathbf{H} - \\mathbf{J}_{\\mathrm{c}}\n$$\nHere, $\\mathbf{D}$ is the electric displacement field, $\\mathbf{H}$ is the magnetic field, and $\\mathbf{J}_{\\mathrm{c}}$ is the conduction current density. To discretize this equation in time, we integrate it over the time interval $[t^{n}, t^{n+1}]$, where $t^n = n \\Delta t$.\n$$\n\\int_{t^{n}}^{t^{n+1}} \\frac{\\partial \\mathbf{D}}{\\partial t} dt = \\int_{t^{n}}^{t^{n+1}} (\\nabla \\times \\mathbf{H}) dt - \\int_{t^{n}}^{t^{n+1}} \\mathbf{J}_{\\mathrm{c}} dt\n$$\nThe left-hand side is evaluated exactly by the fundamental theorem of calculus:\n$$\n\\mathbf{D}(t^{n+1}) - \\mathbf{D}(t^{n}) = \\mathbf{D}^{n+1} - \\mathbf{D}^{n}\n$$\nFor the terms on the right-hand side, we apply the specified discretization rules.\nFirst, the magnetic field term is discretized consistently with the Yee grid, where $\\mathbf{H}$ is evaluated at half-integer time steps. The integral is approximated using the midpoint rule, which is second-order accurate in $\\Delta t$, by assuming the integrand is constant at its value at the midpoint of the interval, $t^{n+\\frac{1}{2}}$:\n$$\n\\int_{t^{n}}^{t^{n+1}} (\\nabla \\times \\mathbf{H}) dt \\approx (\\nabla \\times \\mathbf{H})^{n+\\frac{1}{2}} \\, \\Delta t\n$$\nSecond, the conduction current term integral is approximated using the trapezoidal rule, as specified in the problem statement. This is also second-order accurate. Given $\\mathbf{J}_{\\mathrm{c}}(t) = \\sigma \\mathbf{E}(t)$, we have:\n$$\n\\int_{t^{n}}^{t^{n+1}} \\mathbf{J}_{\\mathrm{c}}(t) dt \\approx \\frac{\\Delta t}{2} \\left(\\mathbf{J}_{\\mathrm{c}}^{n} + \\mathbf{J}_{\\mathrm{c}}^{n+1}\\right) = \\frac{\\sigma \\Delta t}{2} \\left(\\mathbf{E}^{n} + \\mathbf{E}^{n+1}\\right)\n$$\nSubstituting these approximations into the integrated Maxwell-Ampère law yields:\n$$\n\\mathbf{D}^{n+1} - \\mathbf{D}^{n} = (\\nabla \\times \\mathbf{H})^{n+\\frac{1}{2}} \\, \\Delta t - \\frac{\\sigma \\Delta t}{2} \\left(\\mathbf{E}^{n} + \\mathbf{E}^{n+1}\\right)\n$$\nNext, we introduce the constitutive relation for the Debye medium: $\\mathbf{D}(t) = \\epsilon_{\\infty} \\mathbf{E}(t) + \\mathbf{P}(t)$. Applying this at time steps $n$ and $n+1$:\n$$\n\\mathbf{D}^n = \\epsilon_{\\infty} \\mathbf{E}^n + \\mathbf{P}^n\n$$\n$$\n\\mathbf{D}^{n+1} = \\epsilon_{\\infty} \\mathbf{E}^{n+1} + \\mathbf{P}^{n+1}\n$$\nSubstituting these into the discretized Maxwell's equation gives:\n$$\n(\\epsilon_{\\infty} \\mathbf{E}^{n+1} + \\mathbf{P}^{n+1}) - (\\epsilon_{\\infty} \\mathbf{E}^{n} + \\mathbf{P}^{n}) = (\\nabla \\times \\mathbf{H})^{n+\\frac{1}{2}} \\, \\Delta t - \\frac{\\sigma \\Delta t}{2} (\\mathbf{E}^{n} + \\mathbf{E}^{n+1})\n$$\nThis equation involves the unknown polarization $\\mathbf{P}^{n+1}$. To find an expression for it, we must solve the Debye ordinary differential equation for the polarization density $\\mathbf{P}(t)$:\n$$\n\\frac{d \\mathbf{P}}{dt} = \\frac{\\Delta \\epsilon}{\\tau} \\mathbf{E}(t) - \\frac{1}{\\tau}\\mathbf{P}(t) \\implies \\frac{d \\mathbf{P}}{dt} + \\frac{1}{\\tau}\\mathbf{P}(t) = \\frac{\\Delta \\epsilon}{\\tau} \\mathbf{E}(t)\n$$\nThe problem requires an exact integration of this ODE over $[t^n, t^{n+1}]$ under the assumption that the electric field $\\mathbf{E}(t)$ is piecewise constant over this interval, taking its value at the beginning of the interval, i.e., $\\mathbf{E}(t) = \\mathbf{E}^n$ for $t \\in [t^n, t^{n+1}]$. With this assumption, the ODE becomes a first-order linear differential equation with a constant forcing term:\n$$\n\\frac{d \\mathbf{P}}{dt} + \\frac{1}{\\tau}\\mathbf{P}(t) = \\frac{\\Delta \\epsilon}{\\tau} \\mathbf{E}^n\n$$\nThe general solution for an ODE of the form $y'(t) + a y(t) = C$ with initial condition $y(t_0) = y_0$ is $y(t) = (y_0 - C/a) \\exp(-a(t-t_0)) + C/a$. Here, $y(t) = \\mathbf{P}(t)$, $a = 1/\\tau$, $C = (\\Delta \\epsilon / \\tau) \\mathbf{E}^n$, and the initial condition is $\\mathbf{P}(t^n) = \\mathbf{P}^n$. The term $C/a$ is $\\Delta \\epsilon \\mathbf{E}^n$.\nThe solution for $\\mathbf{P}(t)$ in the interval is:\n$$\n\\mathbf{P}(t) = \\left(\\mathbf{P}^n - \\Delta \\epsilon \\mathbf{E}^n\\right) \\exp\\left(-\\frac{t-t^n}{\\tau}\\right) + \\Delta \\epsilon \\mathbf{E}^n\n$$\nWe need $\\mathbf{P}^{n+1} = \\mathbf{P}(t^{n+1})$, which is found by setting $t = t^{n+1} = t^n + \\Delta t$:\n$$\n\\mathbf{P}^{n+1} = \\left(\\mathbf{P}^n - \\Delta \\epsilon \\mathbf{E}^n\\right) \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right) + \\Delta \\epsilon \\mathbf{E}^n\n$$\nRearranging this gives an update equation for the polarization:\n$$\n\\mathbf{P}^{n+1} = \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right) \\mathbf{P}^n + \\Delta \\epsilon \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\mathbf{E}^n\n$$\nNow we substitute this expression for $\\mathbf{P}^{n+1}$ back into the main discretized equation. First, we rearrange the main equation to isolate terms containing $\\mathbf{E}^{n+1}$:\n$$\n\\epsilon_{\\infty} \\mathbf{E}^{n+1} + \\frac{\\sigma \\Delta t}{2} \\mathbf{E}^{n+1} = \\epsilon_{\\infty} \\mathbf{E}^{n} - \\frac{\\sigma \\Delta t}{2} \\mathbf{E}^{n} + (\\nabla \\times \\mathbf{H})^{n+\\frac{1}{2}} \\, \\Delta t + \\mathbf{P}^n - \\mathbf{P}^{n+1}\n$$\nLet's compute the term $\\mathbf{P}^n - \\mathbf{P}^{n+1}$:\n$$\n\\mathbf{P}^n - \\mathbf{P}^{n+1} = \\mathbf{P}^n - \\left[ \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right) \\mathbf{P}^n + \\Delta \\epsilon \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\mathbf{E}^n \\right]\n$$\n$$\n\\mathbf{P}^n - \\mathbf{P}^{n+1} = \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\mathbf{P}^n - \\Delta \\epsilon \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\mathbf{E}^n\n$$\nSubstituting this into the equation for $\\mathbf{E}^{n+1}$:\n$$\n\\left(\\epsilon_{\\infty} + \\frac{\\sigma \\Delta t}{2}\\right) \\mathbf{E}^{n+1} = \\left(\\epsilon_{\\infty} - \\frac{\\sigma \\Delta t}{2}\\right) \\mathbf{E}^{n} + (\\nabla \\times \\mathbf{H})^{n+\\frac{1}{2}} \\, \\Delta t + \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\mathbf{P}^n - \\Delta \\epsilon \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\mathbf{E}^n\n$$\nNow, we group the coefficients of $\\mathbf{E}^n$ on the right-hand side:\n$$\n\\left(\\epsilon_{\\infty} + \\frac{\\sigma \\Delta t}{2}\\right) \\mathbf{E}^{n+1} = \\left[ \\left(\\epsilon_{\\infty} - \\frac{\\sigma \\Delta t}{2}\\right) - \\Delta \\epsilon \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\right] \\mathbf{E}^{n} + \\Delta t (\\nabla \\times \\mathbf{H})^{n+\\frac{1}{2}} + \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\mathbf{P}^n\n$$\nFinally, we solve for $\\mathbf{E}^{n+1}$ by dividing by the factor on the left-hand side to obtain the desired affine form $\\mathbf{E}^{n+1} = C_{E}\\,\\mathbf{E}^{n} + C_{H}\\,\\left(\\nabla \\times \\mathbf{H}\\right)^{n+\\frac{1}{2}} + C_{P}\\,\\mathbf{P}^{n}$.\nThe coefficients are identified as:\n$$\nC_{E} = \\frac{\\left(\\epsilon_{\\infty} - \\frac{\\sigma \\Delta t}{2}\\right) - \\Delta \\epsilon \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right)}{\\epsilon_{\\infty} + \\frac{\\sigma \\Delta t}{2}}\n$$\n$$\nC_{H} = \\frac{\\Delta t}{\\epsilon_{\\infty} + \\frac{\\sigma \\Delta t}{2}}\n$$\n$$\nC_{P} = \\frac{1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)}{\\epsilon_{\\infty} + \\frac{\\sigma \\Delta t}{2}}\n$$\nThese are the three scalar coefficients for the explicit update equation for $\\mathbf{E}^{n+1}$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{\\epsilon_{\\infty} - \\frac{\\sigma \\Delta t}{2} - \\Delta \\epsilon \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right)}{\\epsilon_{\\infty} + \\frac{\\sigma \\Delta t}{2}}  \\frac{\\Delta t}{\\epsilon_{\\infty} + \\frac{\\sigma \\Delta t}{2}}  \\frac{1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)}{\\epsilon_{\\infty} + \\frac{\\sigma \\Delta t}{2}}\n\\end{pmatrix}\n}\n$$", "id": "3331618"}, {"introduction": "Beyond the direct time-stepping of an auxiliary differential equation, dispersive effects can also be modeled by treating the material's response as a convolution in time. This exercise explores the powerful Piecewise-Linear Recursive Convolution (PLRC) technique, which avoids storing the entire field history by using a clever recursive update [@problem_id:3331560]. You will also analyze the trade-off between memory savings and accuracy by quantifying the error introduced by truncating the convolution history.", "problem": "Consider a single-pole Debye dielectric modeled in the Finite-Difference Time-Domain (FDTD) method without static conductivity. The constitutive relation for the displacement field is\n$$\n\\mathbf{D}(t) = \\varepsilon_0 \\varepsilon_{\\infty} \\mathbf{E}(t) + \\varepsilon_0 \\Delta \\varepsilon \\int_{0}^{t} \\frac{1}{\\tau} \\exp\\!\\left(-\\frac{t-t'}{\\tau}\\right) \\mathbf{E}(t')\\, dt',\n$$\nwhere $\\varepsilon_0$ is the permittivity of free space, $\\varepsilon_{\\infty}$ is the optical-limit relative permittivity, $\\Delta \\varepsilon = \\varepsilon_s - \\varepsilon_{\\infty}$ is the Debye strength, and $\\tau$ is the relaxation time. Define the normalized Debye convolution integral\n$$\nI(t) = \\int_{0}^{t} \\frac{1}{\\tau} \\exp\\!\\left(-\\frac{t-t'}{\\tau}\\right) E(t')\\, dt',\n$$\nso that $\\mathbf{D}(t) = \\varepsilon_0 \\varepsilon_{\\infty} \\mathbf{E}(t) + \\varepsilon_0 \\Delta \\varepsilon\\, I(t)\\, \\hat{\\mathbf{e}}$, where $E(t)$ is a single Cartesian component of the electric field and $\\hat{\\mathbf{e}}$ is the corresponding unit vector.\n\nLet $t_n = n \\Delta t$ with constant time step $\\Delta t$. In the piecewise-linear recursive convolution (PLRC) approach, $E(t)$ is approximated as linear over each interval $[t_{n-1}, t_n]$. Using only this linear approximation and the exponential Debye kernel above, derive from first principles a one-step recursion for the discrete samples $I^n \\equiv I(t_n)$ of the form\n$$\nI^n = \\kappa\\, I^{n-1} + w_0 E^n + w_1 E^{n-1},\n$$\nwhere the weights $w_0$ and $w_1$ depend only on $\\Delta t$ and $\\tau$, and $\\kappa$ is the exponential decay factor. Then:\n\n1) For $\\tau = 0.5\\ \\mathrm{ns}$ and $\\Delta t = 10\\ \\mathrm{ps}$, compute the numerical values of the PLRC weights $w_0$ and $w_1$. Report $w_0$ and $w_1$ as dimensionless numbers and round each to six significant figures.\n\n2) Suppose the full PLRC history is truncated after retaining only the most recent $M$ terms of the recursion, i.e., contributions older than $M$ steps are discarded. Assume the discrete electric field samples satisfy $|E^n| \\le E_{\\max}$ for all $n$, where $E_{\\max}$ is a known bound with units of volts per meter. Derive an analytic upper bound on the magnitude of the truncation error in $I^n$ as a function of $M$, $\\Delta t$, $\\tau$, and $E_{\\max}$. Express your bound as a closed-form expression and do not include units in the final bound.\n\nUse the shorthands $\\alpha \\equiv \\Delta t/\\tau$ and $\\kappa \\equiv \\exp(-\\alpha)$ in your derivation. Your final answer must consist of a single row matrix containing, in order, the rounded numerical values of $w_0$ and $w_1$, followed by your closed-form analytic bound in terms of $M$, $\\Delta t$, $\\tau$, and $E_{\\max}$.", "solution": "The problem asks for two main results concerning the Piecewise-Linear Recursive Convolution (PLRC) implementation of a single-pole Debye dielectric model in FDTD. First, the derivation and numerical calculation of the recursive update coefficients. Second, an analytic upper bound on the truncation error of the recursive convolution.\n\nPart 1: Derivation of the PLRC Recursion and Coefficients\n\nThe normalized Debye convolution integral is given by\n$$ I(t) = \\int_{0}^{t} \\frac{1}{\\tau} \\exp\\left(-\\frac{t-t'}{\\tau}\\right) E(t')\\, dt' $$\nWe wish to find a recursive relation for the discrete samples $I^n \\equiv I(t_n)$, where $t_n = n\\Delta t$.\nWe can write $I(t_n)$ by splitting the integral at $t' = t_{n-1}$:\n$$ I^n = \\int_{0}^{t_{n-1}} \\frac{1}{\\tau} \\exp\\left(-\\frac{t_n-t'}{\\tau}\\right) E(t')\\, dt' + \\int_{t_{n-1}}^{t_n} \\frac{1}{\\tau} \\exp\\left(-\\frac{t_n-t'}{\\tau}\\right) E(t')\\, dt' $$\nLet's analyze the first integral term. By factoring out the term corresponding to one time step, we get:\n$$ \\int_{0}^{t_{n-1}} \\frac{1}{\\tau} \\exp\\left(-\\frac{t_n-t_{n-1}}{\\tau}\\right) \\exp\\left(-\\frac{t_{n-1}-t'}{\\tau}\\right) E(t')\\, dt' $$\n$$ = \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right) \\int_{0}^{t_{n-1}} \\frac{1}{\\tau} \\exp\\left(-\\frac{t_{n-1}-t'}{\\tau}\\right) E(t')\\, dt' $$\nThis expression is exactly $\\exp(-\\Delta t/\\tau) I(t_{n-1})$. Using the provided shorthand $\\kappa \\equiv \\exp(-\\Delta t/\\tau)$, this term is $\\kappa I^{n-1}$.\nSo, the recursion begins as:\n$$ I^n = \\kappa I^{n-1} + \\int_{t_{n-1}}^{t_n} \\frac{1}{\\tau} \\exp\\left(-\\frac{t_n-t'}{\\tau}\\right) E(t')\\, dt' $$\nThe remaining task is to evaluate the integral over the most recent time interval $[t_{n-1}, t_n]$. The PLRC method approximates the electric field $E(t')$ as a linear function over this interval:\n$$ E(t') \\approx E^{n-1} + \\frac{E^n - E^{n-1}}{\\Delta t} (t' - t_{n-1}) \\quad \\text{for } t_{n-1} \\le t' \\le t_n $$\nLet us substitute this into the integral. For convenience, we perform a change of variable $s = t_n - t'$, which implies $t' = t_n - s$ and $dt' = -ds$. The integration limits change from $t' \\in [t_{n-1}, t_n]$ to $s \\in [\\Delta t, 0]$.\nThe integral becomes:\n$$ \\Delta I^n = \\frac{1}{\\tau} \\int_{\\Delta t}^{0} \\exp\\left(-\\frac{s}{\\tau}\\right) \\left[ E^{n-1} + \\frac{E^n - E^{n-1}}{\\Delta t} (t_n - s - t_{n-1}) \\right] (-ds) $$\n$$ \\Delta I^n = \\frac{1}{\\tau} \\int_{0}^{\\Delta t} \\exp\\left(-\\frac{s}{\\tau}\\right) \\left[ E^{n-1} + \\frac{E^n - E^{n-1}}{\\Delta t} (\\Delta t - s) \\right] ds $$\nRearranging the term in the square brackets to group by $E^n$ and $E^{n-1}$:\n$$ E^{n-1} + (E^n - E^{n-1}) - \\frac{E^n - E^{n-1}}{\\Delta t}s = E^n - \\frac{E^n - E^{n-1}}{\\Delta t}s $$\nSo the integral is:\n$$ \\Delta I^n = \\frac{1}{\\tau} \\int_{0}^{\\Delta t} \\exp\\left(-\\frac{s}{\\tau}\\right) \\left[ E^n - \\frac{E^n - E^{n-1}}{\\Delta t}s \\right] ds $$\n$$ \\Delta I^n = \\frac{E^n}{\\tau} \\int_{0}^{\\Delta t} \\exp\\left(-\\frac{s}{\\tau}\\right) ds - \\frac{E^n - E^{n-1}}{\\tau \\Delta t} \\int_{0}^{\\Delta t} s \\exp\\left(-\\frac{s}{\\tau}\\right) ds $$\nWe evaluate the two definite integrals.\nThe first integral is:\n$$ \\int_{0}^{\\Delta t} \\exp\\left(-\\frac{s}{\\tau}\\right) ds = \\left[-\\tau \\exp\\left(-\\frac{s}{\\tau}\\right)\\right]_{0}^{\\Delta t} = \\tau\\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) $$\nThe second integral is evaluated using integration by parts, $\\int u dv = uv - \\int v du$, with $u=s$ and $dv = \\exp(-s/\\tau)ds$:\n$$ \\int_{0}^{\\Delta t} s \\exp\\left(-\\frac{s}{\\tau}\\right) ds = \\left[-s\\tau \\exp\\left(-\\frac{s}{\\tau}\\right)\\right]_{0}^{\\Delta t} + \\int_{0}^{\\Delta t} \\tau \\exp\\left(-\\frac{s}{\\tau}\\right)ds $$\n$$ = -\\Delta t \\tau \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right) + \\tau \\left[ \\tau\\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) \\right] $$\n$$ = \\tau^2 \\left(1 - \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right)\\right) - \\Delta t \\tau \\exp\\left(-\\frac{\\Delta t}{\\tau}\\right) $$\nSubstituting these results into the expression for $\\Delta I^n$:\n$$ \\Delta I^n = \\frac{E^n}{\\tau} \\left[\\tau(1-\\kappa)\\right] - \\frac{E^n - E^{n-1}}{\\tau \\Delta t} \\left[ \\tau^2(1-\\kappa) - \\Delta t \\tau \\kappa \\right] $$\n$$ \\Delta I^n = E^n (1-\\kappa) - \\left(E^n - E^{n-1}\\right) \\left[ \\frac{\\tau}{\\Delta t}(1-\\kappa) - \\kappa \\right] $$\nUsing $\\alpha \\equiv \\Delta t/\\tau$, this simplifies to:\n$$ \\Delta I^n = E^n (1-\\kappa) - \\left(E^n - E^{n-1}\\right) \\left[ \\frac{1-\\kappa}{\\alpha} - \\kappa \\right] $$\nWe can now identify the coefficients of $E^n$ and $E^{n-1}$ to find $w_0$ and $w_1$:\n$$ \\Delta I^n = E^n \\left( (1-\\kappa) - \\left(\\frac{1-\\kappa}{\\alpha} - \\kappa\\right) \\right) + E^{n-1} \\left( \\frac{1-\\kappa}{\\alpha} - \\kappa \\right) $$\nThe coefficients are:\n$$ w_0 = 1 - \\kappa - \\frac{1-\\kappa}{\\alpha} + \\kappa = 1 - \\frac{1-\\kappa}{\\alpha} = 1 - \\frac{1-\\exp(-\\Delta t/\\tau)}{\\Delta t/\\tau} $$\n$$ w_1 = \\frac{1-\\kappa}{\\alpha} - \\kappa = \\frac{1-\\exp(-\\Delta t/\\tau)}{\\Delta t/\\tau} - \\exp(-\\Delta t/\\tau) $$\nThe full recursion is $I^n = \\kappa I^{n-1} + w_0 E^n + w_1 E^{n-1}$.\n\nFor the numerical calculation, we have $\\tau = 0.5\\ \\mathrm{ns} = 0.5 \\times 10^{-9}\\ \\mathrm{s}$ and $\\Delta t = 10\\ \\mathrm{ps} = 10 \\times 10^{-12}\\ \\mathrm{s}$.\nThe dimensionless parameter $\\alpha$ is:\n$$ \\alpha = \\frac{\\Delta t}{\\tau} = \\frac{10 \\times 10^{-12}\\ \\mathrm{s}}{0.5 \\times 10^{-9}\\ \\mathrm{s}} = \\frac{10}{500} = 0.02 $$\nThe exponential decay factor $\\kappa$ is:\n$$ \\kappa = \\exp(-\\alpha) = \\exp(-0.02) \\approx 0.98019867 $$\nNow we compute the weights $w_0$ and $w_1$:\n$$ w_0 = 1 - \\frac{1 - \\exp(-0.02)}{0.02} \\approx 1 - \\frac{1 - 0.98019867}{0.02} \\approx 1 - 0.99006634 = 0.00993366 $$\n$$ w_1 = \\frac{1 - \\exp(-0.02)}{0.02} - \\exp(-0.02) \\approx 0.99006634 - 0.98019867 = 0.00986767 $$\nUsing higher precision and rounding to six significant figures:\n$w_0 \\approx 0.00993367$\n$w_1 \\approx 0.00986766$\n\nPart 2: Truncation Error Bound\n\nThe full recursion is $I^n = \\kappa I^{n-1} + \\Delta I^n$, where $\\Delta I^n = w_0 E^n + w_1 E^{n-1}$.\nBy repeatedly applying the recursion, we can express $I^n$ in terms of $I^{n-M}$:\n$$ I^n = \\kappa^M I^{n-M} + \\sum_{j=0}^{M-1} \\kappa^j \\Delta I^{n-j} $$\nTruncating the recursion after $M$ terms means we neglect contributions from times earlier than $t_{n-M}$. This is equivalent to setting $I^{n-M}=0$ in the above formula, yielding the truncated value $I^n_{\\text{trunc}}$.\n$$ I^n_{\\text{trunc}} = \\sum_{j=0}^{M-1} \\kappa^j \\Delta I^{n-j} $$\nThe truncation error $\\mathcal{E}^n$ is the difference between the exact and truncated values:\n$$ \\mathcal{E}^n = I^n - I^n_{\\text{trunc}} = \\kappa^M I^{n-M} $$\nTo find an upper bound on the magnitude of this error, $|\\mathcal{E}^n| = \\kappa^M |I^{n-M}|$, we need an upper bound for $|I^{n-M}|$.\nFrom the definition of the convolution integral:\n$$ I^{n-M} = I(t_{n-M}) = \\int_{0}^{t_{n-M}} \\frac{1}{\\tau} \\exp\\left(-\\frac{t_{n-M}-t'}{\\tau}\\right) E(t')\\, dt' $$\nWe are given that the electric field magnitude is bounded, $|E^k| \\le E_{\\max}$ for all $k$. Since $E(t')$ in the PLRC scheme is a linear interpolation between discrete values, its magnitude is also bounded by $E_{\\max}$: $|E(t')| \\le E_{\\max}$ for all $t' \\ge 0$.\nTaking the magnitude of the integral:\n$$ |I^{n-M}| \\le \\int_{0}^{t_{n-M}} \\frac{1}{\\tau} \\left|\\exp\\left(-\\frac{t_{n-M}-t'}{\\tau}\\right) E(t')\\right|\\, dt' \\le \\frac{E_{\\max}}{\\tau} \\int_{0}^{t_{n-M}} \\exp\\left(-\\frac{t_{n-M}-t'}{\\tau}\\right) dt' $$\nThe integral evaluates to:\n$$ \\int_{0}^{t_{n-M}} \\exp\\left(-\\frac{t_{n-M}-t'}{\\tau}\\right) dt' = \\left[\\tau \\exp\\left(-\\frac{t_{n-M}-t'}{\\tau}\\right)\\right]_{0}^{t_{n-M}} = \\tau (1 - \\exp(-t_{n-M}/\\tau)) $$\nThus, we have the bound:\n$$ |I^{n-M}| \\le E_{\\max} \\left(1 - \\exp(-t_{n-M}/\\tau)\\right) $$\nFor a long-running simulation, $t_{n-M} \\to \\infty$, and the exponential term vanishes. The worst-case magnitude of $I^{n-M}$ is approached in the steady-state DC limit ($E(t)=E_{\\text{const}}$), where $I(t) \\to E_{\\text{const}}$. So the upper bound is $|I^{n-M}| \\le E_{\\max}$.\nSubstituting this into the error expression:\n$$ |\\mathcal{E}^n| \\le \\kappa^M E_{\\max} = \\exp(-M \\Delta t/\\tau) E_{\\max} $$\nThis is the desired analytic upper bound on the truncation error magnitude. It is a closed-form expression depending on $M$, $\\Delta t$, $\\tau$, and $E_{\\max}$.\nThe final answer requires the two numerical weights and this error bound expression.\n\nNumerical values rounded to six significant figures:\n$w_0 = 1 - (1 - \\exp(-0.02))/0.02 \\approx 0.00993367$\n$w_1 = (1 - \\exp(-0.02))/0.02 - \\exp(-0.02) \\approx 0.00986766$\n\nAnalytic error bound: $E_{\\max} \\exp(-M \\Delta t / \\tau)$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.00993367  0.00986766  E_{\\max} \\exp\\left(-\\frac{M \\Delta t}{\\tau}\\right)\n\\end{pmatrix}\n}\n$$", "id": "3331560"}, {"introduction": "Real-world simulations often involve material interfaces that do not align perfectly with the FDTD grid, leading to so-called \"staircasing\" errors. This practical exercise delves into the critical topic of sub-cellular interface modeling by comparing two common averaging schemes for assigning material properties to a cut cell [@problem_id:3331577]. By quantifying how well each scheme enforces the physical boundary conditions, you will gain insight into methods for improving simulation accuracy in complex geometries.", "problem": "Consider a single two-dimensional Yee cell used in the Finite-Difference Time-Domain (FDTD) method, which is a staggered-grid algorithm for solving Maxwell’s equations in time domain. The square cell has side length $\\Delta$ with corners at $(\\pm \\Delta/2, \\pm \\Delta/2)$ in the $(x,y)$-plane. A planar material interface cuts the cell along the straight line $\\hat{\\mathbf{n}}\\cdot \\mathbf{r} = 0$ that passes through the cell center, where the unit normal is $\\hat{\\mathbf{n}} = (\\cos \\theta, \\sin \\theta)$ and $\\theta$ is the angle (in radians) of the normal with respect to the $x$-axis. The medium on the side where $\\hat{\\mathbf{n}}\\cdot \\mathbf{r}  0$ has permittivity $\\epsilon_1$ and conductivity $\\sigma_1$, and the medium where $\\hat{\\mathbf{n}}\\cdot \\mathbf{r}  0$ has permittivity $\\epsilon_2$ and conductivity $\\sigma_2$. Assume a time-harmonic field at angular frequency $\\omega = 2\\pi f$ with frequency $f$ in $\\mathrm{Hz}$, and define the complex permittivity $\\epsilon_c = \\epsilon - i \\sigma/\\omega$ to unify lossless and lossy materials.\n\nIn the Yee cell for two-dimensional transverse-magnetic configuration with out-of-plane magnetic field, the in-plane electric field is represented by components located on the centers of the four edges of the square: the top edge at $y = \\Delta/2$, the bottom edge at $y = -\\Delta/2$, the left edge at $x = -\\Delta/2$, and the right edge at $x = \\Delta/2$. When an interface cuts a cell, assigning material properties for the edge-centered electric field updates requires an interpolation strategy. Two strategies are considered:\n\n1. Volume-weighted interpolation: assign a single effective complex permittivity for all edges by weighting $\\epsilon_{c,1}$ and $\\epsilon_{c,2}$ according to the area fractions of the two media inside the cell. For a straight interface passing through the center of the square, the area fraction of each medium is $1/2$, so the effective complex permittivity is $\\epsilon_{c,\\mathrm{vol}} = \\frac{1}{2}\\epsilon_{c,1} + \\frac{1}{2}\\epsilon_{c,2}$.\n\n2. Edge-weighted interpolation: assign an effective complex permittivity for each edge by weighting $\\epsilon_{c,1}$ and $\\epsilon_{c,2}$ according to the edge-length fraction of that edge lying in each medium. For a given edge $e$ with endpoints $\\mathbf{r}_1$ and $\\mathbf{r}_2$, define the signed values $s_1 = \\hat{\\mathbf{n}}\\cdot \\mathbf{r}_1$ and $s_2 = \\hat{\\mathbf{n}}\\cdot \\mathbf{r}_2$. The fraction of the edge length lying in the $\\hat{\\mathbf{n}}\\cdot \\mathbf{r}  0$ medium, denoted $f_e$, is $f_e = 1$ if $s_1  0$ and $s_2  0$, $f_e = 0$ if $s_1  0$ and $s_2  0$, and if $s_1$ and $s_2$ have opposite signs then $f_e$ equals the fraction of the segment for which $\\hat{\\mathbf{n}}\\cdot \\mathbf{r}  0$, namely $f_e = s_2/(s_2 - s_1)$ if $s_2  0$ and $f_e = -s_1/(s_2 - s_1)$ if $s_1  0$. If $s_1 = s_2 = 0$, set $f_e = 1/2$. The edge-weighted effective complex permittivity for edge $e$ is then $\\epsilon_{c,\\mathrm{edge}}(e) = (1 - f_e)\\epsilon_{c,1} + f_e \\epsilon_{c,2}$.\n\nEnforcement of boundary conditions at oblique angles is quantified via the normal-flux continuity condition with no free surface charge, namely the continuity of the generalized normal flux $\\epsilon_c E_n$ across the interface, where $E_n$ is the normal component of the electric field with respect to $\\hat{\\mathbf{n}}$. If the true fields in the two media are $\\mathbf{E}_1 = E_t \\hat{\\mathbf{t}} + E_{n,1} \\hat{\\mathbf{n}}$ and $\\mathbf{E}_2 = E_t \\hat{\\mathbf{t}} + E_{n,2} \\hat{\\mathbf{n}}$, with $\\hat{\\mathbf{t}} = (-\\sin \\theta, \\cos \\theta)$ the unit tangent, the exact continuity yields $E_{n,2} = (\\epsilon_{c,1}/\\epsilon_{c,2}) E_{n,1}$ while the tangential component $E_t$ is continuous. A discrete Yee edge variable on an edge $e$ crossing both media cannot represent a jump in the normal component; instead, a single edge value implicitly represents the weighted average across the edge: $E_{n,\\mathrm{edge}}(e) = (1 - f_e) E_{n,1} + f_e E_{n,2}$. Define the reference normal flux $D_{n,0} = \\epsilon_{c,1} E_{n,1}$, which equals $\\epsilon_{c,2} E_{n,2}$ by continuity. Under a chosen interpolation strategy that assigns $\\epsilon_{c,\\mathrm{eff}}$ to the edge, the discretized normal flux on edge $e$ is $\\epsilon_{c,\\mathrm{eff}}(e) E_{n,\\mathrm{edge}}(e)$. The normalized residual on edge $e$ is\n$$\nr_e = \\left| \\frac{\\epsilon_{c,\\mathrm{eff}}(e) E_{n,\\mathrm{edge}}(e)}{D_{n,0}} - 1 \\right|,\n$$\nwhere $|\\cdot|$ denotes magnitude of a complex number. Aggregate the enforcement error across all four edges by the root-mean-square value\n$$\nR = \\sqrt{ \\frac{1}{4} \\sum_{e \\in \\{\\mathrm{top}, \\mathrm{bottom}, \\mathrm{left}, \\mathrm{right}\\}} r_e^2 }.\n$$\nCompute $R_{\\mathrm{vol}}$ for the volume-weighted strategy and $R_{\\mathrm{edge}}$ for the edge-weighted strategy, using $\\epsilon_{c,\\mathrm{eff}}(e) = \\epsilon_{c,\\mathrm{vol}}$ for all edges in the former and the per-edge $\\epsilon_{c,\\mathrm{edge}}(e)$ in the latter. Use $E_{n,1} = 1$ in $\\mathrm{V}/\\mathrm{m}$ so that $D_{n,0} = \\epsilon_{c,1}$.\n\nDesign a program that, for a given set of parameters $(\\Delta,\\theta,\\epsilon_1,\\sigma_1,\\epsilon_2,\\sigma_2,f)$, computes $R_{\\mathrm{vol}}$ and $R_{\\mathrm{edge}}$ as dimensionless floats. Angles must be provided in radians, permittivities in $\\mathrm{F}/\\mathrm{m}$, conductivities in $\\mathrm{S}/\\mathrm{m}$, frequency in $\\mathrm{Hz}$, and $\\Delta$ in $\\mathrm{m}$.\n\nTest Suite:\nUse the vacuum permittivity $\\epsilon_0 = 8.854187817\\times 10^{-12}\\,\\mathrm{F}/\\mathrm{m}$. Let $\\Delta = 1\\,\\mathrm{m}$ in all cases. Evaluate the following four test cases:\n\n1. Oblique, moderate contrast, weak loss: $\\theta = \\pi/4$, $\\epsilon_1 = 2.5 \\epsilon_0$, $\\sigma_1 = 0$, $\\epsilon_2 = 6 \\epsilon_0$, $\\sigma_2 = 0.01$, $f = 1\\times 10^{9}$.\n\n2. Interface normal along $x$-axis, lossless: $\\theta = 0$, $\\epsilon_1 = 1 \\epsilon_0$, $\\sigma_1 = 0$, $\\epsilon_2 = 4 \\epsilon_0$, $\\sigma_2 = 0$, $f = 5\\times 10^{9}$.\n\n3. Interface normal along $y$-axis, asymmetric loss: $\\theta = \\pi/2$, $\\epsilon_1 = 2 \\epsilon_0$, $\\sigma_1 = 0.1$, $\\epsilon_2 = 10 \\epsilon_0$, $\\sigma_2 = 0$, $f = 1\\times 10^{8}$.\n\n4. Highly oblique ($80^\\circ$), high contrast and loss: $\\theta = 80\\pi/180$, $\\epsilon_1 = 1.5 \\epsilon_0$, $\\sigma_1 = 0$, $\\epsilon_2 = 12 \\epsilon_0$, $\\sigma_2 = 0.5$, $f = 2\\times 10^{9}$.\n\nFinal Output Format:\nYour program should produce a single line of output containing a list of four elements, one per test case, where each element is a two-element list $[R_{\\mathrm{vol}}, R_{\\mathrm{edge}}]$ in that order. For example, the printed output must have the form $[[r_{1,\\mathrm{vol}},r_{1,\\mathrm{edge}}],[r_{2,\\mathrm{vol}},r_{2,\\mathrm{edge}}],[r_{3,\\mathrm{vol}},r_{3,\\mathrm{edge}}],[r_{4,\\mathrm{vol}},r_{4,\\mathrm{edge}}]]$, with all values dimensionless floats.", "solution": "The problem requires an analysis and comparison of two different material parameter interpolation schemes used in the Finite-Difference Time-Domain (FDTD) method for computational electromagnetics. The comparison is based on a metric that quantifies the violation of the electromagnetic boundary condition for the normal component of the electric field at a planar dielectric interface that cuts through a single Yee cell.\n\n### Fundamental Principle: Boundary Conditions\n\nAt a planar interface between two media with no free surface charge, Maxwell's equations impose continuity conditions on the electric field $\\mathbf{E}$ and the electric displacement field $\\mathbf{D} = \\epsilon \\mathbf{E}$. The component of the electric field tangential to the interface, $E_t$, is continuous. The component of the electric displacement field normal to the interface, $D_n$, is also continuous. For time-harmonic fields with angular frequency $\\omega$, in a lossy medium with permittivity $\\epsilon$ and conductivity $\\sigma$, these properties are conveniently described using the complex permittivity $\\epsilon_c = \\epsilon - i \\sigma/\\omega$. The electric displacement field becomes $\\mathbf{D} = \\epsilon_c \\mathbf{E}$.\n\nThe continuity of the normal component of $\\mathbf{D}$ across the interface between medium $1$ and medium $2$ is expressed as $D_{n,1} = D_{n,2}$, which implies:\n$$\n\\epsilon_{c,1} E_{n,1} = \\epsilon_{c,2} E_{n,2}\n$$\nHere, $E_{n,1}$ and $E_{n,2}$ are the normal components of the electric field on either side of the interface. This relation shows that the normal electric field component $E_n$ is generally discontinuous. The reference value for the normal displacement flux is taken as $D_{n,0} = \\epsilon_{c,1} E_{n,1}$. The problem sets $E_{n,1} = 1\\,\\mathrm{V/m}$, so $D_{n,0} = \\epsilon_{c,1}$.\n\n### Numerical Discretization and Averaging\n\nThe FDTD method discretizes space on a staggered grid (the Yee grid). In a $2$D Transverse-Magnetic (TM) simulation, electric field components ($E_x$, $E_y$) are located at the centers of the cell edges. When an interface cuts through a cell, a single discrete field value on an edge must represent the field behavior in two different media. This necessitates an effective material parameter for the FDTD update equation at that location.\n\nThe problem defines two strategies to determine the effective complex permittivity, $\\epsilon_{c,\\mathrm{eff}}$, for the electric field components on the four edges of a square Yee cell of side length $\\Delta$. The interface passes through the cell center $(0,0)$ and is defined by $\\hat{\\mathbf n} \\cdot \\mathbf r = 0$, where $\\hat{\\mathbf n} = (\\cos\\theta, \\sin\\theta)$.\n\n### Interpolation Strategies\n\n1.  **Volume-weighted average:** A single effective permittivity is computed based on the area fractions of the two media within the cell. Since the interface passes through the center, the areas are equal.\n    $$\n    \\epsilon_{c,\\mathrm{vol}} = \\frac{1}{2}\\epsilon_{c,1} + \\frac{1}{2}\\epsilon_{c,2}\n    $$\n    This value is used for all four edges, regardless of how they are cut by the interface.\n\n2.  **Edge-weighted average:** A separate effective permittivity is computed for each edge, based on the fraction of the edge's length that lies in each medium. For an edge $e$, let $f_e$ be the fraction of its length in medium $2$ (where $\\hat{\\mathbf{n}}\\cdot \\mathbf{r}  0$). The effective permittivity for that edge is:\n    $$\n    \\epsilon_{c,\\mathrm{edge}}(e) = (1 - f_e)\\epsilon_{c,1} + f_e \\epsilon_{c,2}\n    $$\n    The fraction $f_e$ is determined by evaluating $s = \\hat{\\mathbf{n}}\\cdot\\mathbf{r}$ at the edge's endpoints, $\\mathbf{r}_1$ and $\\mathbf{r}_2$. Let $s_1 = \\hat{\\mathbf{n}}\\cdot\\mathbf{r}_1$ and $s_2 = \\hat{\\mathbf{n}}\\cdot\\mathbf{r}_2$. If the edge is cut, the intersection point divides it into segments. The fraction $f_e$ is the ratio of the length of the segment in medium $2$ to the total edge length. This can be calculated using linear interpolation.\n\n### Error Metric Formulation\n\nA discrete field variable on an edge that crosses the interface cannot represent the discontinuous jump in the normal field component $E_n$. The problem models the effective normal field on the edge as a weighted average:\n$$\nE_{n,\\mathrm{edge}}(e) = (1 - f_e) E_{n,1} + f_e E_{n,2}\n$$\nUsing the continuity condition $E_{n,2} = (\\epsilon_{c,1}/\\epsilon_{c,2}) E_{n,1}$ and setting $E_{n,1}=1$, this becomes:\n$$\nE_{n,\\mathrm{edge}}(e) = (1 - f_e) + f_e \\frac{\\epsilon_{c,1}}{\\epsilon_{c,2}}\n$$\nThe discretized normal flux on the edge is then $D_{n,\\mathrm{discr}}(e) = \\epsilon_{c,\\mathrm{eff}}(e) E_{n,\\mathrm{edge}}(e)$. The quality of an interpolation scheme is measured by how well this discretized flux approximates the true, continuous flux $D_{n,0} = \\epsilon_{c,1}$. The normalized residual for an edge $e$ is defined as:\n$$\nr_e = \\left| \\frac{D_{n,\\mathrm{discr}}(e)}{D_{n,0}} - 1 \\right| = \\left| \\frac{\\epsilon_{c,\\mathrm{eff}}(e) E_{n,\\mathrm{edge}}(e)}{\\epsilon_{c,1}} - 1 \\right|\n$$\nSubstituting the expression for $E_{n,\\mathrm{edge}}(e)$:\n$$\nr_e = \\left| \\frac{\\epsilon_{c,\\mathrm{eff}}(e)}{\\epsilon_{c,1}} \\left( (1 - f_e) + f_e \\frac{\\epsilon_{c,1}}{\\epsilon_{c,2}} \\right) - 1 \\right|\n$$\n\nFor the **volume-weighted** scheme, $\\epsilon_{c,\\mathrm{eff}}(e) = \\epsilon_{c,\\mathrm{vol}}$ for all edges, and the residual $r_{e,\\mathrm{vol}}$ is calculated per edge using the corresponding $f_e$.\n\nFor the **edge-weighted** scheme, $\\epsilon_{c,\\mathrm{eff}}(e) = \\epsilon_{c,\\mathrm{edge}}(e)$. The term for the residual becomes:\n$$\nr_{e,\\mathrm{edge}} = \\left| \\frac{(1 - f_e)\\epsilon_{c,1} + f_e \\epsilon_{c,2}}{\\epsilon_{c,1}} \\left( (1 - f_e) + f_e \\frac{\\epsilon_{c,1}}{\\epsilon_{c,2}} \\right) - 1 \\right|\n$$\nLetting $\\eta = \\epsilon_{c,2}/\\epsilon_{c,1}$, the expression simplifies:\n$$\n\\frac{D_{n,\\mathrm{discr}}(e)}{D_{n,0}} = \\left( (1 - f_e) + f_e \\eta \\right) \\left( (1 - f_e) + f_e \\frac{1}{\\eta} \\right)\n$$\nExpanding this product gives:\n$$\n(1 - f_e)^2 + f_e(1 - f_e)\\frac{1}{\\eta} + f_e(1 - f_e)\\eta + f_e^2 = 1 - 2f_e + 2f_e^2 + f_e(1 - f_e)\\left(\\eta + \\frac{1}{\\eta}\\right)\n$$\nThe residual is the magnitude of the difference from $1$:\n$$\nr_{e,\\mathrm{edge}} = \\left| -2f_e + 2f_e^2 + f_e(1 - f_e)\\left(\\eta + \\frac{1}{\\eta}\\right) \\right| = \\left| f_e(1 - f_e) \\left( -2 + \\eta + \\frac{1}{\\eta} \\right) \\right|\n$$\nThis leads to the more insightful form:\n$$\nr_{e,\\mathrm{edge}} = \\left| f_e(1 - f_e) \\frac{(\\eta - 1)^2}{\\eta} \\right|\n$$\nThis shows that the error for the edge-weighted scheme is zero if the edge is not cut ($f_e=0$ or $f_e=1$) or if there is no material contrast ($\\eta=1$), and is maximized for edges bisected by the interface ($f_e=0.5$).\n\n### Computational Algorithm\n\nThe overall error for each scheme is the root-mean-square (RMS) of the residuals over the four cell edges:\n$$\nR = \\sqrt{ \\frac{1}{4} \\sum_{e \\in \\{\\mathrm{top}, \\mathrm{bottom}, \\mathrm{left}, \\mathrm{right}\\}} r_e^2 }\n$$\n\nThe algorithm proceeds as follows for each test case:\n1.  Calculate the angular frequency $\\omega = 2\\pi f$ and the complex permittivities $\\epsilon_{c,1}$ and $\\epsilon_{c,2}$.\n2.  Define the geometry: the normal vector $\\hat{\\mathbf n}$ and the endpoints of the four cell edges.\n3.  For each edge $e$:\n    a. Compute the signed distances $s_1$ and $s_2$ of the endpoints from the interface.\n    b. Calculate the fraction $f_e$ based on the signs and values of $s_1$ and $s_2$.\n    c. Calculate the residual $r_{e,\\mathrm{vol}}$ using $\\epsilon_{c,\\mathrm{vol}} = (\\epsilon_{c,1}+\\epsilon_{c,2})/2$.\n    d. Calculate the residual $r_{e,\\mathrm{edge}}$ using the derived formula based on $\\eta = \\epsilon_{c,2}/\\epsilon_{c,1}$ and $f_e$.\n4.  Compute the RMS errors $R_{\\mathrm{vol}}$ and $R_{\\mathrm{edge}}$ by taking the square root of the average of the squared residuals.\n5.  Return the pair $[R_{\\mathrm{vol}}, R_{\\mathrm{edge}}]$.\n\nThis procedure is implemented for each of the provided test cases.", "answer": "[[0.22230006764516335,0.09117621184976722],[0.375,0.0],[0.8039864228919137,0.0],[0.9312152865910398,0.1154381014164478]]", "id": "3331577"}]}