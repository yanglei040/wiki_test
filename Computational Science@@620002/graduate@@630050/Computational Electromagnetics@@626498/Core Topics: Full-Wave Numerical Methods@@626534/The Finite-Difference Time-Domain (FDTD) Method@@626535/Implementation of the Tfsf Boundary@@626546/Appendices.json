{"hands_on_practices": [{"introduction": "The implementation of a Total-Field/Scattered-Field (TFSF) boundary hinges on the field equivalence principle, which allows us to replace the incident wave source with a set of equivalent surface electric and magnetic currents, $\\mathbf{J}_{s}$ and $\\mathbf{M}_{s}$. This first practice establishes the theoretical foundation by guiding you through the derivation of the sign conventions for these currents on the faces of a cubic TFSF box. Mastering these sign conventions is a critical first step to ensure the injected field has the correct behavior across the boundary [@problem_id:3318213].", "problem": "A cubic Total-Field/Scattered-Field (TFSF) boundary separates a total-field region from a scattered-field region in a three-dimensional Finite-Difference Time-Domain (FDTD) simulation of a homogeneous, isotropic, source-free medium with permittivity $\\varepsilon$, permeability $\\mu$, wave impedance $\\eta=\\sqrt{\\mu/\\varepsilon}$, and phase velocity $v=\\frac{1}{\\sqrt{\\mu \\varepsilon}}$. The cube is aligned with the Cartesian axes and has faces at $x=x_{\\min}$, $x=x_{\\max}$, $y=y_{\\min}$, $y=y_{\\max}$, $z=z_{\\min}$, and $z=z_{\\max}$. The unit normal $\\hat{\\mathbf{n}}$ on each face points outward from the total-field region into the scattered-field region.\n\nAn incident plane wave in this medium is specified by a wavevector $\\mathbf{k}=k\\,\\hat{\\mathbf{k}}$ with $k=\\omega/v$, a unit polarization vector $\\hat{\\mathbf{p}}$ satisfying $\\hat{\\mathbf{p}}\\cdot \\hat{\\mathbf{k}}=0$, and a scalar waveform $g(\\cdot)$ with amplitude $E_{0}$. The time-domain fields are\n$$\n\\mathbf{E}^{\\mathrm{inc}}(\\mathbf{r},t)=E_{0}\\,\\hat{\\mathbf{p}}\\,g\\!\\left(t-\\frac{\\hat{\\mathbf{k}}\\cdot \\mathbf{r}}{v}\\right), \\qquad\n\\mathbf{H}^{\\mathrm{inc}}(\\mathbf{r},t)=\\frac{1}{\\eta}\\,\\hat{\\mathbf{k}}\\times \\mathbf{E}^{\\mathrm{inc}}(\\mathbf{r},t).\n$$\n\nStarting from Maxwell’s equations and the field equivalence principle, derive the equivalent surface electric and magnetic current densities on the TFSF interface required to produce the total field inside and only the scattered field outside. Then, for each of the $6$ faces, write the correction expressions to be applied on that face in terms of $\\mathbf{E}^{\\mathrm{inc}}$ and $\\mathbf{H}^{\\mathrm{inc}}$ evaluated on the face. Adopt the convention that the equivalent surface currents on a face with outward normal $\\hat{\\mathbf{n}}$ are\n$$\n\\mathbf{J}_{s}(\\mathbf{r},t)=\\hat{\\mathbf{n}} \\times \\mathbf{H}^{\\mathrm{inc}}(\\mathbf{r},t), \\qquad\n\\mathbf{M}_{s}(\\mathbf{r},t)=-\\hat{\\mathbf{n}} \\times \\mathbf{E}^{\\mathrm{inc}}(\\mathbf{r},t).\n$$\nFor the six axis-aligned faces, let $\\hat{\\mathbf{a}}_{x}=\\hat{\\mathbf{x}}$, $\\hat{\\mathbf{a}}_{y}=\\hat{\\mathbf{y}}$, and $\\hat{\\mathbf{a}}_{z}=\\hat{\\mathbf{z}}$. Define the sign $s_{i}\\in\\{-1,+1\\}$ for face $i$ by $\\hat{\\mathbf{n}}_{i}=s_{i}\\,\\hat{\\mathbf{a}}_{\\alpha(i)}$, where $\\alpha(i)\\in\\{x,y,z\\}$ selects the axis normal to face $i$ and $s_{i}=-1$ for the $x_{\\min}$, $y_{\\min}$, $z_{\\min}$ faces and $s_{i}=+1$ for the $x_{\\max}$, $y_{\\max}$, $z_{\\max}$ faces. Express each face’s corrections in the form\n$$\n\\mathbf{J}_{s}^{(i)}=s_{i}\\,\\hat{\\mathbf{a}}_{\\alpha(i)}\\times \\mathbf{H}^{\\mathrm{inc}}, \\qquad\n\\mathbf{M}_{s}^{(i)}=-s_{i}\\,\\hat{\\mathbf{a}}_{\\alpha(i)}\\times \\mathbf{E}^{\\mathrm{inc}}.\n$$\n\nFinally, compute the $12$-entry sign pattern for the pair $\\left(s_{J}^{(i)},s_{M}^{(i)}\\right)$ on the ordered list of faces $\\left[x_{\\min},x_{\\max},y_{\\min},y_{\\max},z_{\\min},z_{\\max}\\right]$, where $s_{J}^{(i)}$ and $s_{M}^{(i)}$ are defined by\n$$\n\\mathbf{J}_{s}^{(i)}=s_{J}^{(i)}\\,\\hat{\\mathbf{a}}_{\\alpha(i)}\\times \\mathbf{H}^{\\mathrm{inc}}, \\qquad\n\\mathbf{M}_{s}^{(i)}=s_{M}^{(i)}\\,\\hat{\\mathbf{a}}_{\\alpha(i)}\\times \\mathbf{E}^{\\mathrm{inc}}.\n$$\nReport the final sign pattern as a single $1\\times 12$ row matrix in the order $\\left[s_{J}^{(x_{\\min})},s_{M}^{(x_{\\min})},s_{J}^{(x_{\\max})},s_{M}^{(x_{\\max})},s_{J}^{(y_{\\min})},s_{M}^{(y_{\\min})},s_{J}^{(y_{\\max})},s_{M}^{(y_{\\max})},s_{J}^{(z_{\\min})},s_{M}^{(z_{\\min})},s_{J}^{(z_{\\max})},s_{M}^{(z_{\\max})}\\right]$. No numerical rounding is required. Do not include units in the final answer.", "solution": "The problem statement has been meticulously validated and is determined to be a well-posed, scientifically sound, and internally consistent problem in computational electromagnetics. It requires the application of the field equivalence principle to the Total-Field/Scattered-Field (TFSF) method in the context of the Finite-Difference Time-Domain (FDTD) algorithm.\n\nThe TFSF formulation divides the computational domain into two regions separated by a closed boundary, $\\mathcal{S}$. Inside $\\mathcal{S}$ is the total-field region, where the fields are the sum of incident and scattered components: $\\mathbf{E}^{\\mathrm{tot}} = \\mathbf{E}^{\\mathrm{inc}} + \\mathbf{E}^{\\mathrm{scat}}$ and $\\mathbf{H}^{\\mathrm{tot}} = \\mathbf{H}^{\\mathrm{inc}} + \\mathbf{H}^{\\mathrm{scat}}$. Outside $\\mathcal{S}$ is the scattered-field region, where only the scattered fields $(\\mathbf{E}^{\\mathrm{scat}}, \\mathbf{H}^{\\mathrm{scat}})$ are computed.\n\nThis partitioning is achieved by introducing equivalent surface currents on $\\mathcal{S}$ that act as sources. These sources are designed to produce the incident field $(\\mathbf{E}^{\\mathrm{inc}}, \\mathbf{H}^{\\mathrm{inc}})$ inside the total-field region and a null field outside. When these generated fields are superimposed onto the scattered-field simulation (which, by linearity, extends over the entire domain), the result is the total field inside $\\mathcal{S}$ and the scattered field outside, as desired.\n\nAccording to the field equivalence principle, the surface electric current density $\\mathbf{J}_s$ and magnetic current density $\\mathbf{M}_s$ on a closed surface $\\mathcal{S}$ that generate a field $(\\mathbf{E}, \\mathbf{H})$ inside $\\mathcal{S}$ and zero field outside are given by:\n$$\n\\mathbf{J}_{s}(\\mathbf{r},t) = \\hat{\\mathbf{n}} \\times \\mathbf{H}(\\mathbf{r},t)\n$$\n$$\n\\mathbf{M}_{s}(\\mathbf{r},t) = -\\hat{\\mathbf{n}} \\times \\mathbf{E}(\\mathbf{r},t)\n$$\nwhere $\\hat{\\mathbf{n}}$ is the unit normal vector pointing outward from the volume enclosed by $\\mathcal{S}$. In our case, the fields to be generated are the incident fields $(\\mathbf{E}^{\\mathrm{inc}}, \\mathbf{H}^{\\mathrm{inc}})$, and the volume is the total-field region. The problem statement provides these exact definitions, which we adopt for our derivation.\n\nThe problem asks for a sign pattern for correction terms related to these currents on the six faces of a cubic TFSF boundary. Let face $i$ be one of the six faces. The outward unit normal for this face is denoted by $\\hat{\\mathbf{n}}_i$. The problem defines the relationship $\\hat{\\mathbf{n}}_{i}=s_{i}\\,\\hat{\\mathbf{a}}_{\\alpha(i)}$, where $\\hat{\\mathbf{a}}_{\\alpha(i)}$ is the Cartesian unit vector along the axis normal to the face ($\\hat{\\mathbf{x}}$, $\\hat{\\mathbf{y}}$, or $\\hat{\\mathbf{z}}$), and $s_i$ is a sign. For faces at the minimum coordinates ($x_{\\min}$, $y_{\\min}$, $z_{\\min}$), the outward normal points in the negative axis direction, so $s_i = -1$. For faces at the maximum coordinates ($x_{\\max}$, $y_{\\max}$, $z_{\\max}$), the outward normal points in the positive axis direction, so $s_i = +1$.\n\nOur task is to determine the signs $s_J^{(i)}$ and $s_M^{(i)}$ by comparing the fundamental definitions of the currents with the target forms given in the problem.\n\nFirst, let's analyze the electric surface current, $\\mathbf{J}_s^{(i)}$.\nThe fundamental definition applied to face $i$ is:\n$$\n\\mathbf{J}_{s}^{(i)} = \\hat{\\mathbf{n}}_i \\times \\mathbf{H}^{\\mathrm{inc}}\n$$\nSubstituting $\\hat{\\mathbf{n}}_i = s_i \\hat{\\mathbf{a}}_{\\alpha(i)}$:\n$$\n\\mathbf{J}_{s}^{(i)} = (s_i \\hat{\\mathbf{a}}_{\\alpha(i)}) \\times \\mathbf{H}^{\\mathrm{inc}} = s_i (\\hat{\\mathbf{a}}_{\\alpha(i)} \\times \\mathbf{H}^{\\mathrm{inc}})\n$$\nThe problem specifies the target form:\n$$\n\\mathbf{J}_{s}^{(i)} = s_{J}^{(i)} \\hat{\\mathbf{a}}_{\\alpha(i)} \\times \\mathbf{H}^{\\mathrm{inc}}\n$$\nBy direct comparison of these two expressions, we deduce that:\n$$\ns_{J}^{(i)} = s_i\n$$\n\nNext, we analyze the magnetic surface current, $\\mathbf{M}_s^{(i)}$.\nThe fundamental definition applied to face $i$ is:\n$$\n\\mathbf{M}_{s}^{(i)} = -\\hat{\\mathbf{n}}_i \\times \\mathbf{E}^{\\mathrm{inc}}\n$$\nSubstituting $\\hat{\\mathbf{n}}_i = s_i \\hat{\\mathbf{a}}_{\\alpha(i)}$:\n$$\n\\mathbf{M}_{s}^{(i)} = -(s_i \\hat{\\mathbf{a}}_{\\alpha(i)}) \\times \\mathbf{E}^{\\mathrm{inc}} = -s_i (\\hat{\\mathbf{a}}_{\\alpha(i)} \\times \\mathbf{E}^{\\mathrm{inc}})\n$$\nThe problem specifies the target form:\n$$\n\\mathbf{M}_{s}^{(i)} = s_{M}^{(i)} \\hat{\\mathbf{a}}_{\\alpha(i)} \\times \\mathbf{E}^{\\mathrm{inc}}\n$$\nBy comparing these two expressions, we deduce that:\n$$\ns_{M}^{(i)} = -s_i\n$$\n\nWe now have the general relationship for the sign pair on any face $i$: $(s_{J}^{(i)}, s_{M}^{(i)}) = (s_i, -s_i)$. We can now apply this to each of the six faces in the specified order.\n\n1.  Face $x_{\\min}$: The normal is $\\hat{\\mathbf{n}}_{x_{\\min}} = -\\hat{\\mathbf{x}}$. Thus, $\\alpha(i)=x$ and $s_{x_{\\min}} = -1$.\n    The sign pair is $(s_{J}^{(x_{\\min})}, s_{M}^{(x_{\\min})}) = (s_{x_{\\min}}, -s_{x_{\\min}}) = (-1, -(-1)) = (-1, 1)$.\n\n2.  Face $x_{\\max}$: The normal is $\\hat{\\mathbf{n}}_{x_{\\max}} = +\\hat{\\mathbf{x}}$. Thus, $\\alpha(i)=x$ and $s_{x_{\\max}} = +1$.\n    The sign pair is $(s_{J}^{(x_{\\max})}, s_{M}^{(x_{\\max})}) = (s_{x_{\\max}}, -s_{x_{\\max}}) = (1, -1)$.\n\n3.  Face $y_{\\min}$: The normal is $\\hat{\\mathbf{n}}_{y_{\\min}} = -\\hat{\\mathbf{y}}$. Thus, $\\alpha(i)=y$ and $s_{y_{\\min}} = -1$.\n    The sign pair is $(s_{J}^{(y_{\\min})}, s_{M}^{(y_{\\min})}) = (s_{y_{\\min}}, -s_{y_{\\min}}) = (-1, -(-1)) = (-1, 1)$.\n\n4.  Face $y_{\\max}$: The normal is $\\hat{\\mathbf{n}}_{y_{\\max}} = +\\hat{\\mathbf{y}}$. Thus, $\\alpha(i)=y$ and $s_{y_{\\max}} = +1$.\n    The sign pair is $(s_{J}^{(y_{\\max})}, s_{M}^{(y_{\\max})}) = (s_{y_{\\max}}, -s_{y_{\\max}}) = (1, -1)$.\n\n5.  Face $z_{\\min}$: The normal is $\\hat{\\mathbf{n}}_{z_{\\min}} = -\\hat{\\mathbf{z}}$. Thus, $\\alpha(i)=z$ and $s_{z_{\\min}} = -1$.\n    The sign pair is $(s_{J}^{(z_{\\min})}, s_{M}^{(z_{\\min})}) = (s_{z_{\\min}}, -s_{z_{\\min}}) = (-1, -(-1)) = (-1, 1)$.\n\n6.  Face $z_{\\max}$: The normal is $\\hat{\\mathbf{n}}_{z_{\\max}} = +\\hat{\\mathbf{z}}$. Thus, $\\alpha(i)=z$ and $s_{z_{\\max}} = +1$.\n    The sign pair is $(s_{J}^{(z_{\\max})}, s_{M}^{(z_{\\max})}) = (s_{z_{\\max}}, -s_{z_{\\max}}) = (1, -1)$.\n\nFinally, we assemble the $12$-entry sign pattern by concatenating these pairs in the specified order:\n$\\left[s_{J}^{(x_{\\min})},s_{M}^{(x_{\\min})},s_{J}^{(x_{\\max})},s_{M}^{(x_{\\max})},s_{J}^{(y_{\\min})},s_{M}^{(y_{\\min})},s_{J}^{(y_{\\max})},s_{M}^{(y_{\\max})},s_{J}^{(z_{\\min})},s_{M}^{(z_{\\min})},s_{J}^{(z_{\\max})},s_{M}^{(z_{\\max})}\\right]$\nSubstituting the values we computed:\n$\\left[-1, 1, 1, -1, -1, 1, 1, -1, -1, 1, 1, -1\\right]$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-1 & 1 & 1 & -1 & -1 & 1 & 1 & -1 & -1 & 1 & 1 & -1\n\\end{pmatrix}\n}\n$$", "id": "3318213"}, {"introduction": "With the theoretical framework for the boundary currents established, we now confront the practical challenge of implementing them within the discrete Finite-Difference Time-Domain (FDTD) grid. This exercise bridges the gap between the continuous mathematical form of a plane wave and its discrete representation on the staggered Yee lattice [@problem_id:3318287]. By calculating the precise phase of the incident wave at specific field component locations, you will develop the meticulous attention to detail required for a correct and stable TFSF source implementation.", "problem": "A three-dimensional Finite-Difference Time-Domain (FDTD) simulation employs a Total-Field/Scattered-Field (TFSF) boundary to inject a monochromatic plane wave into a homogeneous, isotropic, source-free, non-dispersive medium (free space). The TFSF boundary separates the total-field region from the scattered-field region and requires correction terms on its faces to ensure that only the incident plane wave exists in the total-field domain while only the scattered field exists in the scattered-field domain. The plane wave is characterized by its wave vector $\\mathbf{k}$, polarization unit vector $\\hat{p}$, and angular frequency $\\omega$. The discretization uses the staggered Yee lattice for the electromagnetic field components and leapfrog time stepping.\n\nThe physical setting is free space with speed of light $c$, permittivity $\\epsilon_{0}$, and permeability $\\mu_{0}$, obeying Maxwell's equations. The incident plane wave is a solution to these equations in the form of a transverse electromagnetic wave with electric field\n$$\\mathbf{E}_{\\mathrm{inc}}(\\mathbf{r},t)=\\Re\\left\\{E_{0}\\,\\hat{p}\\,\\exp\\!\\left(i\\big(\\mathbf{k}\\cdot\\mathbf{r}-\\omega t\\big)\\right)\\right\\},$$\nand magnetic field\n$$\\mathbf{H}_{\\mathrm{inc}}(\\mathbf{r},t)=\\Re\\left\\{H_{0}\\,\\hat{h}\\,\\exp\\!\\left(i\\big(\\mathbf{k}\\cdot\\mathbf{r}-\\omega t\\big)\\right)\\right\\},$$\nwhere $E_{0}$ and $H_{0}$ are real amplitudes satisfying the plane-wave relations in free space, $\\hat{h}=\\hat{k}\\times\\hat{p}$, with $\\hat{k}=\\mathbf{k}/|\\mathbf{k}|$ and $\\eta_{0}=\\sqrt{\\mu_{0}/\\epsilon_{0}}$, and the phase of $\\mathbf{E}_{\\mathrm{inc}}$ and $\\mathbf{H}_{\\mathrm{inc}}$ is identical. The numerical grid uses spatial steps $\\Delta x$, $\\Delta y$, $\\Delta z$ and time step $\\Delta t$. On the Yee lattice, the field component sampling locations are staggered within each cell and the electric field is sampled at integer time indices $n$ while the magnetic field is sampled at half-integer time indices $n+\\tfrac{1}{2}$.\n\nConsider the $+x$ TFSF face located at the plane $x=x_{b}$ defined by the index $i=i_{b}$ in the Yee grid. The correction terms required for this face involve the incident field phase factors evaluated at the following component locations:\n- For the electric field at time index $n$: $E_{y}$ at $\\big(i_{b},\\,j+\\tfrac{1}{2},\\,k\\big)$ and $E_{z}$ at $\\big(i_{b},\\,j,\\,k+\\tfrac{1}{2}\\big)$.\n- For the magnetic field at time index $n+\\tfrac{1}{2}$: $H_{y}$ at $\\big(i_{b}-\\tfrac{1}{2},\\,j,\\,k+\\tfrac{1}{2}\\big)$ and $H_{z}$ at $\\big(i_{b}-\\tfrac{1}{2},\\,j+\\tfrac{1}{2},\\,k\\big)$.\n\nAll positions correspond to physical coordinates $\\mathbf{r}=\\big(x,\\,y,\\,z\\big)$ given by $x=i\\Delta x$, $y=j\\Delta y$, and $z=k\\Delta z$, with half-index offsets interpreted accordingly. The phase factor for the incident field at a field-sampling location $\\mathbf{r}$ and time $t$ is the complex quantity\n$$\\Phi(\\mathbf{r},t)=\\exp\\!\\left(i\\big(\\mathbf{k}\\cdot\\mathbf{r}-\\omega t\\big)\\right).$$\n\nGiven the following parameters:\n- Free-space speed of light $c=3.0\\times 10^{8}\\,\\mathrm{m/s}$.\n- Frequency $f=3.0\\times 10^{9}\\,\\mathrm{Hz}$ and angular frequency $\\omega=2\\pi f$.\n- Wavelength $\\lambda=c/f$, and uniform spatial step sizes $\\Delta x=\\Delta y=\\Delta z=\\lambda/10$.\n- Time step $\\Delta t=\\Delta x/(c\\sqrt{3})=1/(10 f\\sqrt{3})$, consistent with the Courant–Friedrichs–Lewy stability limit in three dimensions.\n- Wave vector $\\mathbf{k}=k_{0}\\,\\hat{k}$ with $k_{0}=\\omega/c$, and propagation direction unit vector $\\hat{k}=\\frac{1}{\\sqrt{3}}\\big(1,\\,1,\\,1\\big)$.\n- Polarization unit vector $\\hat{p}=\\frac{1}{\\sqrt{2}}\\big(1,\\,-1,\\,0\\big)$.\n- TFSF face index and correction indices: $i_{b}=12$, $j=5$, $k=8$.\n- Time index $n=30$.\n\nUsing the Yee lattice sampling conventions described above and the given parameters, compute the four complex phase factors for the incident fields at the correction nodes on the $+x$ TFSF face:\n$$\\Phi_{E_{y}}=\\Phi\\!\\left(\\mathbf{r}_{E_{y}},\\,t_{E}\\right),\\quad \\Phi_{E_{z}}=\\Phi\\!\\left(\\mathbf{r}_{E_{z}},\\,t_{E}\\right),\\quad \\Phi_{H_{y}}=\\Phi\\!\\left(\\mathbf{r}_{H_{y}},\\,t_{H}\\right),\\quad \\Phi_{H_{z}}=\\Phi\\!\\left(\\mathbf{r}_{H_{z}},\\,t_{H}\\right),$$\nwhere $\\mathbf{r}_{E_{y}}=\\big(i_{b}\\Delta x,\\,(j+\\tfrac{1}{2})\\Delta y,\\,k\\Delta z\\big)$, $\\mathbf{r}_{E_{z}}=\\big(i_{b}\\Delta x,\\,j\\Delta y,\\,(k+\\tfrac{1}{2})\\Delta z\\big)$, $\\mathbf{r}_{H_{y}}=\\big((i_{b}-\\tfrac{1}{2})\\Delta x,\\,j\\Delta y,\\,(k+\\tfrac{1}{2})\\Delta z\\big)$, $\\mathbf{r}_{H_{z}}=\\big((i_{b}-\\tfrac{1}{2})\\Delta x,\\,(j+\\tfrac{1}{2})\\Delta y,\\,k\\Delta z\\big)$, and $t_{E}=n\\Delta t$, $t_{H}=(n+\\tfrac{1}{2})\\Delta t$.\n\nExpress your final answer as exact analytic expressions in radian measure, without numerical rounding, and present the four phase factors in a single row matrix using the prescribed format.", "solution": "The problem requires the computation of four complex phase factors, $\\Phi_{E_{y}}$, $\\Phi_{E_{z}}$, $\\Phi_{H_{y}}$, and $\\Phi_{H_{z}}$, for an incident plane wave at specific locations and times on a Yee lattice. These factors are essential for the implementation of the Total-Field/Scattered-Field (TFSF) boundary condition in a Finite-Difference Time-Domain (FDTD) simulation.\n\nThe complex phase factor is defined as $\\Phi(\\mathbf{r},t)=\\exp\\!\\left(i\\big(\\mathbf{k}\\cdot\\mathbf{r}-\\omega t\\big)\\right)$. The argument of the exponential, $\\phi(\\mathbf{r},t) = \\mathbf{k}\\cdot\\mathbf{r}-\\omega t$, is the phase of the wave. Our primary task is to evaluate this phase for each of the four specified field components.\n\nFirst, let's establish the key numerical parameters based on the given information.\nThe frequency is $f=3.0\\times 10^{9}\\,\\mathrm{Hz}$.\nThe angular frequency is $\\omega=2\\pi f$.\nThe speed of light is $c=3.0\\times 10^{8}\\,\\mathrm{m/s}$.\nThe wavelength is $\\lambda=c/f$.\nThe spatial discretization steps are uniform: $\\Delta x=\\Delta y=\\Delta z=\\frac{\\lambda}{10} = \\frac{c}{10f}$.\nThe time step is $\\Delta t=\\frac{\\Delta x}{c\\sqrt{3}} = \\frac{c/(10f)}{c\\sqrt{3}} = \\frac{1}{10f\\sqrt{3}}$.\n\nThe wave vector is $\\mathbf{k} = k_0 \\hat{k}$, where the wave number is $k_0 = \\frac{\\omega}{c} = \\frac{2\\pi f}{c} = \\frac{2\\pi}{\\lambda}$.\nThe direction of propagation is $\\hat{k}=\\frac{1}{\\sqrt{3}}\\big(1,\\,1,\\,1\\big)$.\nThus, the components of the wave vector are $k_x = k_y = k_z = k_0 \\frac{1}{\\sqrt{3}} = \\frac{2\\pi}{\\lambda\\sqrt{3}}$.\n\nWe can now find the numerical phase shifts per grid step and per time step.\nThe phase shift per spatial step in each direction is:\n$$k_x \\Delta x = k_y \\Delta y = k_z \\Delta z = \\left(\\frac{2\\pi}{\\lambda\\sqrt{3}}\\right)\\left(\\frac{\\lambda}{10}\\right) = \\frac{2\\pi}{10\\sqrt{3}} = \\frac{\\pi}{5\\sqrt{3}}$$\nThe phase shift per time step is:\n$$\\omega \\Delta t = (2\\pi f)\\left(\\frac{1}{10f\\sqrt{3}}\\right) = \\frac{2\\pi}{10\\sqrt{3}} = \\frac{\\pi}{5\\sqrt{3}}$$\nNotably, these values are identical. Let's denote this common phase increment by $\\alpha$:\n$$\\alpha = \\frac{\\pi}{5\\sqrt{3}}$$\nRationalizing the denominator gives $\\alpha = \\frac{\\pi\\sqrt{3}}{15}$. However, we will proceed with the first form.\n\nThe phase at a general grid point $(i\\Delta x, j\\Delta y, k\\Delta z)$ at time $n\\Delta t$ can be expressed as:\n$\\phi = k_x(i\\Delta x) + k_y(j\\Delta y) + k_z(k\\Delta z) - \\omega(n\\Delta t) = i(k_x\\Delta x) + j(k_y\\Delta y) + k(k_z\\Delta z) - n(\\omega\\Delta t) = \\alpha(i+j+k-n)$.\nWe will use this simplified structure, accounting for the half-step offsets in space and time for each component. The given indices are $i_b=12$, $j=5$, $k=8$, and $n=30$.\n\n1.  **Phase factor for $E_y$ component ($\\Phi_{E_{y}}$):**\n    The $E_y$ component is located at $\\mathbf{r}_{E_{y}}=\\big(i_{b}\\Delta x,\\,(j+\\tfrac{1}{2})\\Delta y,\\,k\\Delta z\\big)$ and sampled at time $t_{E}=n\\Delta t$.\n    The phase is:\n    $$\\phi_{E_{y}} = \\mathbf{k}\\cdot\\mathbf{r}_{E_{y}} - \\omega t_{E} = k_x(i_b\\Delta x) + k_y\\left(\\left(j+\\tfrac{1}{2}\\right)\\Delta y\\right) + k_z(k\\Delta z) - \\omega(n\\Delta t)$$\n    $$\\phi_{E_{y}} = i_b(k_x\\Delta x) + \\left(j+\\tfrac{1}{2}\\right)(k_y\\Delta y) + k(k_z\\Delta z) - n(\\omega\\Delta t)$$\n    $$\\phi_{E_{y}} = \\alpha\\left(i_b + j + \\tfrac{1}{2} + k - n\\right)$$\n    Substituting the given index values:\n    $$\\phi_{E_{y}} = \\alpha\\left(12 + 5 + \\tfrac{1}{2} + 8 - 30\\right) = \\alpha\\left(25 + \\tfrac{1}{2} - 30\\right) = \\alpha\\left(-5 + \\tfrac{1}{2}\\right) = -\\frac{9}{2}\\alpha$$\n    $$\\phi_{E_{y}} = -\\frac{9}{2} \\left(\\frac{\\pi}{5\\sqrt{3}}\\right) = -\\frac{9\\pi}{10\\sqrt{3}} = -\\frac{9\\pi\\sqrt{3}}{30} = -\\frac{3\\pi\\sqrt{3}}{10}$$\n    So, the phase factor is $\\Phi_{E_{y}} = \\exp\\left(-i\\frac{3\\pi\\sqrt{3}}{10}\\right)$.\n\n2.  **Phase factor for $E_z$ component ($\\Phi_{E_{z}}$):**\n    The $E_z$ component is at $\\mathbf{r}_{E_{z}}=\\big(i_{b}\\Delta x,\\,j\\Delta y,\\,(k+\\tfrac{1}{2})\\Delta z\\big)$ and sampled at time $t_{E}=n\\Delta t$.\n    The phase is:\n    $$\\phi_{E_{z}} = \\mathbf{k}\\cdot\\mathbf{r}_{E_{z}} - \\omega t_{E} = k_x(i_b\\Delta x) + k_y(j\\Delta y) + k_z\\left(\\left(k+\\tfrac{1}{2}\\right)\\Delta z\\right) - \\omega(n\\Delta t)$$\n    $$\\phi_{E_{z}} = \\alpha\\left(i_b + j + k + \\tfrac{1}{2} - n\\right)$$\n    This is identical to the phase expression for $E_y$.\n    $$\\phi_{E_{z}} = \\alpha\\left(12 + 5 + 8 + \\tfrac{1}{2} - 30\\right) = -\\frac{9}{2}\\alpha = -\\frac{3\\pi\\sqrt{3}}{10}$$\n    Thus, the phase factor is also identical: $\\Phi_{E_{z}} = \\exp\\left(-i\\frac{3\\pi\\sqrt{3}}{10}\\right)$.\n\n3.  **Phase factor for $H_y$ component ($\\Phi_{H_{y}}$):**\n    The $H_y$ component is at $\\mathbf{r}_{H_{y}}=\\big((i_{b}-\\tfrac{1}{2})\\Delta x,\\,j\\Delta y,\\,(k+\\tfrac{1}{2})\\Delta z\\big)$ and sampled at time $t_{H}=(n+\\tfrac{1}{2})\\Delta t$.\n    The phase is:\n    $$\\phi_{H_{y}} = \\mathbf{k}\\cdot\\mathbf{r}_{H_{y}} - \\omega t_{H} = k_x\\left(\\left(i_b-\\tfrac{1}{2}\\right)\\Delta x\\right) + k_y(j\\Delta y) + k_z\\left(\\left(k+\\tfrac{1}{2}\\right)\\Delta z\\right) - \\omega\\left(\\left(n+\\tfrac{1}{2}\\right)\\Delta t\\right)$$\n    $$\\phi_{H_{y}} = \\alpha\\left(\\left(i_b-\\tfrac{1}{2}\\right) + j + \\left(k+\\tfrac{1}{2}\\right) - \\left(n+\\tfrac{1}{2}\\right)\\right)$$\n    $$\\phi_{H_{y}} = \\alpha\\left(i_b + j + k - n - \\tfrac{1}{2}\\right)$$\n    Substituting the index values:\n    $$\\phi_{H_{y}} = \\alpha\\left(12 + 5 + 8 - 30 - \\tfrac{1}{2}\\right) = \\alpha\\left(25 - 30 - \\tfrac{1}{2}\\right) = \\alpha\\left(-5 - \\tfrac{1}{2}\\right) = -\\frac{11}{2}\\alpha$$\n    $$\\phi_{H_{y}} = -\\frac{11}{2}\\left(\\frac{\\pi}{5\\sqrt{3}}\\right) = -\\frac{11\\pi}{10\\sqrt{3}} = -\\frac{11\\pi\\sqrt{3}}{30}$$\n    The corresponding phase factor is $\\Phi_{H_{y}} = \\exp\\left(-i\\frac{11\\pi\\sqrt{3}}{30}\\right)$.\n\n4.  **Phase factor for $H_z$ component ($\\Phi_{H_{z}}$):**\n    The $H_z$ component is at $\\mathbf{r}_{H_{z}}=\\big((i_{b}-\\tfrac{1}{2})\\Delta x,\\,(j+\\tfrac{1}{2})\\Delta y,\\,k\\Delta z\\big)$ and sampled at time $t_{H}=(n+\\tfrac{1}{2})\\Delta t$.\n    The phase is:\n    $$\\phi_{H_{z}} = \\mathbf{k}\\cdot\\mathbf{r}_{H_{z}} - \\omega t_{H} = k_x\\left(\\left(i_b-\\tfrac{1}{2}\\right)\\Delta x\\right) + k_y\\left(\\left(j+\\tfrac{1}{2}\\right)\\Delta y\\right) + k_z(k\\Delta z) - \\omega\\left(\\left(n+\\tfrac{1}{2}\\right)\\Delta t\\right)$$\n    $$\\phi_{H_{z}} = \\alpha\\left(\\left(i_b-\\tfrac{1}{2}\\right) + \\left(j+\\tfrac{1}{2}\\right) + k - \\left(n+\\tfrac{1}{2}\\right)\\right)$$\n    $$\\phi_{H_{z}} = \\alpha\\left(i_b + j + k - n - \\tfrac{1}{2}\\right)$$\n    This expression is identical to the phase for $H_y$.\n    $$\\phi_{H_{z}} = \\alpha\\left(12 + 5 + 8 - 30 - \\tfrac{1}{2}\\right) = -\\frac{11}{2}\\alpha = -\\frac{11\\pi\\sqrt{3}}{30}$$\n    Therefore, the phase factor is $\\Phi_{H_{z}} = \\exp\\left(-i\\frac{11\\pi\\sqrt{3}}{30}\\right)$.\n\nThe four required complex phase factors are:\n$\\Phi_{E_{y}} = \\exp\\left(-i\\frac{3\\pi\\sqrt{3}}{10}\\right)$\n$\\Phi_{E_{z}} = \\exp\\left(-i\\frac{3\\pi\\sqrt{3}}{10}\\right)$\n$\\Phi_{H_{y}} = \\exp\\left(-i\\frac{11\\pi\\sqrt{3}}{30}\\right)$\n$\\Phi_{H_{z}} = \\exp\\left(-i\\frac{11\\pi\\sqrt{3}}{30}\\right)$\n\nThese results are to be presented in a single row matrix.", "answer": "$$\n\\boxed{\n\\begin{pmatrix} \\exp\\left(-i\\frac{3\\pi\\sqrt{3}}{10}\\right) & \\exp\\left(-i\\frac{3\\pi\\sqrt{3}}{10}\\right) & \\exp\\left(-i\\frac{11\\pi\\sqrt{3}}{30}\\right) & \\exp\\left(-i\\frac{11\\pi\\sqrt{3}}{30}\\right) \\end{pmatrix}\n}\n$$", "id": "3318287"}, {"introduction": "Real-world electromagnetic analysis often requires understanding a system's response over a wide range of frequencies, a task poorly suited for single-frequency simulations. This advanced practice moves beyond monochromatic sources to the design of a custom broadband waveform, a vital tool for efficient spectral analysis using a single FDTD run [@problem_id:3318239]. This coding exercise will walk you through the practical steps of signal synthesis, from Fourier theory to the application of windowing functions, enabling you to create tailored incident fields for sophisticated simulation objectives.", "problem": "You are implementing the Total-Field/Scattered-Field (TFSF) boundary injection for a Finite-Difference Time-Domain (FDTD) method in computational electromagnetics. In order to inject a broadband plane wave with controlled spectrum into the total-field region, you need a time-domain incident electric field waveform whose continuous angular-frequency spectrum magnitude is flat within a prescribed band and negligible elsewhere. Your task is to derive, discretize, window, and assess such a waveform starting strictly from first principles, and to implement it in code.\n\nStart from the definition of the Fourier transform pair consistent with Hermitian symmetry for real-valued time-domain signals. Use the following convention, where the angular frequency is denoted by $\\omega$:\n$$\nF(\\omega) = \\int_{-\\infty}^{+\\infty} f(t)\\, e^{-\\mathrm{i}\\omega t}\\, dt, \\quad\nf(t) = \\frac{1}{2\\pi}\\int_{-\\infty}^{+\\infty} F(\\omega)\\, e^{+\\mathrm{i}\\omega t}\\, d\\omega.\n$$\nConstruct a real-valued time-domain waveform $f(t)$ whose continuous spectrum magnitude equals a constant target amplitude within the band $[\\omega_1,\\omega_2]$ and is negligible outside this band, under the requirement of Hermitian symmetry $F(-\\omega)=F(\\omega)^\\ast$ to ensure a real $f(t)$. Impose the physical scaling of the waveform such that the incident electric field satisfies $f(0)=E_0$ with $E_0$ in volts per meter (V/m). To make $f(t)$ suitable for time stepping and TFSF injection, enforce finite duration by multiplying $f(t)$ by a smooth, even window $w(t)$ supported on a finite interval; the effect of windowing on spectral leakage and in-band ripple must be included in the assessment.\n\nDiscretize $f(t)$ on a uniform grid $t_n=(n-n_0)\\,\\Delta t$ for $n=0,1,\\dots,N-1$ with $\\Delta t$ in seconds and $n_0=(N-1)/2$ so that $t_{n_0}=0$. Use a Tukey window with parameter $\\alpha\\in[0,1]$ (where $\\alpha=0$ is rectangular and $\\alpha=1$ is Hann) to define $w[n]=w(t_n)$. Implement a numerically robust evaluation of $f[n]=f(t_n)\\,w[n]$, including the limit at $t=0$ dictated by the Fourier transform construction. Compute the discrete spectrum via a zero-padded real Fast Fourier Transform (FFT) to approximate the continuous transform $F_{\\Delta t}(\\omega)\\approx \\Delta t\\sum_n f[n]e^{-\\mathrm{i}\\omega t_n}$.\n\nDefine and compute the following quantitative metrics for each case:\n- The normalized in-band mean magnitude:\n$$\nm_1=\\frac{\\langle |F_{\\Delta t}(\\omega)|\\rangle_{\\omega\\in[\\omega_1,\\omega_2]}}{K},\n$$\n- The normalized in-band root-mean-square ripple:\n$$\nm_2=\\frac{\\sqrt{\\langle\\left(|F_{\\Delta t}(\\omega)|-\\langle |F_{\\Delta t}(\\omega)|\\rangle\\right)^2\\rangle_{\\omega\\in[\\omega_1,\\omega_2]}}}{K},\n$$\n- The normalized maximum out-of-band leakage:\n$$\nm_3=\\frac{\\max_{\\omega\\notin[\\omega_1,\\omega_2]} |F_{\\Delta t}(\\omega)|}{K},\n$$\nwhere $K$ is the constant target spectrum magnitude implied by the construction and normalization $f(0)=E_0$ under the stated transform convention. All $\\omega$ are in radians per second, $\\Delta t$ is in seconds, and $E_0$ is in volts per meter. Angles must be in radians. The metrics $m_1$, $m_2$, and $m_3$ are dimensionless. Use only the positive-frequency branch for computing these metrics.\n\nImplement the algorithm and compute the metrics for the following test suite. Each parameter set is given as $(\\omega_1,\\omega_2,E_0,\\Delta t,N,\\alpha)$, with units and numerical values specified:\n- Case A (happy path broadband): $\\omega_1=2\\pi\\cdot 1.0\\times 10^9\\ \\mathrm{rad/s}$, $\\omega_2=2\\pi\\cdot 3.0\\times 10^9\\ \\mathrm{rad/s}$, $E_0=1.0\\ \\mathrm{V/m}$, $\\Delta t=2.0\\times 10^{-11}\\ \\mathrm{s}$, $N=4096$, $\\alpha=0.5$.\n- Case B (narrow band): $\\omega_1=2\\pi\\cdot 0.5\\times 10^9\\ \\mathrm{rad/s}$, $\\omega_2=2\\pi\\cdot 0.55\\times 10^9\\ \\mathrm{rad/s}$, $E_0=0.5\\ \\mathrm{V/m}$, $\\Delta t=5.0\\times 10^{-10}\\ \\mathrm{s}$, $N=8192$, $\\alpha=0.2$.\n- Case C (includes low frequency near zero): $\\omega_1=0\\ \\mathrm{rad/s}$, $\\omega_2=2\\pi\\cdot 0.5\\times 10^9\\ \\mathrm{rad/s}$, $E_0=1.0\\ \\mathrm{V/m}$, $\\Delta t=5.0\\times 10^{-10}\\ \\mathrm{s}$, $N=4096$, $\\alpha=1.0$.\n- Case D (high band near Nyquist): $\\omega_1=2\\pi\\cdot 18.0\\times 10^9\\ \\mathrm{rad/s}$, $\\omega_2=2\\pi\\cdot 22.0\\times 10^9\\ \\mathrm{rad/s}$, $E_0=1.0\\ \\mathrm{V/m}$, $\\Delta t=2.0\\times 10^{-11}\\ \\mathrm{s}$, $N=4096$, $\\alpha=0.7$.\n\nYour program must, for each case, compute $(m_1,m_2,m_3)$ in the order given above, and aggregate all the scalar results across the four cases into a single list. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order\n$$\n[m_1^{(A)},m_2^{(A)},m_3^{(A)},m_1^{(B)},m_2^{(B)},m_3^{(B)},m_1^{(C)},m_2^{(C)},m_3^{(C)},m_1^{(D)},m_2^{(D)},m_3^{(D)}].\n$$\nAll computed quantities must respect the units specified above; the output values are dimensionless floats.", "solution": "The problem requires the derivation and implementation of a time-domain waveform suitable for injecting a broadband plane wave into a Finite-Difference Time-Domain (FDTD) simulation via a Total-Field/Scattered-Field (TFSF) boundary. The waveform must possess a frequency spectrum that is approximately flat within a specified band and is normalized to a given peak electric field value at time $t=0$.\n\nThe derivation proceeds from first principles, beginning with the construction of an ideal frequency spectrum $F(\\omega)$ that satisfies the problem's constraints. We then obtain the corresponding time-domain signal $f(t)$ via the inverse Fourier transform. Subsequently, this ideal signal is discretized, windowed for finite duration, and its spectral properties are analyzed numerically.\n\n**1. Ideal Spectrum Construction**\n\nThe goal is a real-valued time-domain signal $f(t)$ whose spectrum magnitude $|F(\\omega)|$ is constant for angular frequencies $\\omega$ in the band $[\\omega_1, \\omega_2]$. For $f(t)$ to be real, its Fourier transform $F(\\omega)$ must exhibit Hermitian symmetry, $F(-\\omega) = F(\\omega)^*$, where the asterisk denotes complex conjugation. This implies that the magnitude is an even function, $|F(-\\omega)|=|F(\\omega)|$, and the phase is an odd function, $\\arg(F(-\\omega)) = -\\arg(F(\\omega))$.\n\nThe simplest way to satisfy these conditions is to define a spectrum that is real and even. We postulate an ideal spectrum $F_{ideal}(\\omega)$ with a constant amplitude, which we will call $S_0$, in the positive frequency band $[\\omega_1, \\omega_2]$ and the corresponding negative frequency band $[-\\omega_2, -\\omega_1]$:\n$$\nF_{ideal}(\\omega) =\n\\begin{cases}\nS_0 & \\text{if } \\omega \\in [-\\omega_2, -\\omega_1] \\cup [\\omega_1, \\omega_2] \\\\\n0   & \\text{otherwise}\n\\end{cases}\n$$\nHere, $S_0$ is a real constant representing the spectral amplitude. This construction ensures $F_{ideal}(\\omega)$ is real and even, satisfying Hermitian symmetry trivially.\n\n**2. Time-Domain Waveform Derivation**\n\nThe time-domain waveform $f(t)$ is obtained by applying the inverse Fourier transform as defined in the problem statement:\n$$\nf(t) = \\frac{1}{2\\pi}\\int_{-\\infty}^{+\\infty} F(\\omega)\\, e^{+\\mathrm{i}\\omega t}\\, d\\omega\n$$\nSubstituting our $F_{ideal}(\\omega)$:\n$$\nf(t) = \\frac{1}{2\\pi} \\int_{[-\\omega_2, -\\omega_1] \\cup [\\omega_1, \\omega_2]} S_0\\, e^{\\mathrm{i}\\omega t}\\, d\\omega = \\frac{S_0}{2\\pi} \\left( \\int_{-\\omega_2}^{-\\omega_1} e^{\\mathrm{i}\\omega t}\\, d\\omega + \\int_{\\omega_1}^{\\omega_2} e^{\\mathrm{i}\\omega t}\\, d\\omega \\right)\n$$\nFor the case where $t \\neq 0$, the integral of the exponential is $\\frac{e^{\\mathrm{i}\\omega t}}{\\mathrm{i}t}$. Evaluating the definite integrals:\n$$\nf(t) = \\frac{S_0}{2\\pi\\mathrm{i}t} \\left( \\left[ e^{\\mathrm{i}\\omega t} \\right]_{-\\omega_2}^{-\\omega_1} + \\left[ e^{\\mathrm{i}\\omega t} \\right]_{\\omega_1}^{\\omega_2} \\right)\n= \\frac{S_0}{2\\pi\\mathrm{i}t} \\left( (e^{-\\mathrm{i}\\omega_1 t} - e^{-\\mathrm{i}\\omega_2 t}) + (e^{\\mathrm{i}\\omega_2 t} - e^{\\mathrm{i}\\omega_1 t}) \\right)\n$$\nRearranging terms and using Euler's identity $2\\mathrm{i}\\sin(x) = e^{\\mathrm{i}x} - e^{-\\mathrm{i}x}$:\n$$\nf(t) = \\frac{S_0}{2\\pi\\mathrm{i}t} \\left( (e^{\\mathrm{i}\\omega_2 t} - e^{-\\mathrm{i}\\omega_2 t}) - (e^{\\mathrm{i}\\omega_1 t} - e^{-\\mathrm{i}\\omega_1 t}) \\right) = \\frac{S_0}{2\\pi\\mathrm{i}t} \\left( 2\\mathrm{i}\\sin(\\omega_2 t) - 2\\mathrm{i}\\sin(\\omega_1 t) \\right)\n$$\nThis simplifies to the analytical expression for the time-domain waveform:\n$$\nf(t) = \\frac{S_0}{\\pi t} \\left( \\sin(\\omega_2 t) - \\sin(\\omega_1 t) \\right) \\quad \\text{for } t \\neq 0\n$$\nFor the specific point $t=0$, the integrand becomes $1$. The integral gives the total area of the spectral blocks:\n$$\nf(0) = \\frac{S_0}{2\\pi} \\left( (\\omega_2 - \\omega_1) + (\\omega_2 - \\omega_1) \\right) = \\frac{S_0(\\omega_2 - \\omega_1)}{\\pi}\n$$\nThis result is consistent with the limit of $f(t)$ as $t \\to 0$, which can be verified using L'Hôpital's rule or by recognizing the form of the sinc function: $\\lim_{x\\to 0} \\frac{\\sin(ax)}{x} = a$.\n\n**3. Normalization and Target Spectrum Magnitude $K$**\n\nThe problem requires the waveform to be normalized such that $f(0) = E_0$. Using our expression for $f(0)$:\n$$\nE_0 = \\frac{S_0(\\omega_2 - \\omega_1)}{\\pi}\n$$\nThis allows us to solve for the spectral amplitude $S_0$. The problem defines the target spectrum magnitude as $K$, so we have $K = S_0$:\n$$\nK = \\frac{\\pi E_0}{\\omega_2 - \\omega_1}\n$$\nThis relationship holds for all cases where $\\omega_2 > \\omega_1$, including the low-pass case where $\\omega_1 = 0$. Substituting this back into the expression for $f(t)$, we obtain the final normalized continuous waveform:\n$$\nf(t) = \\frac{E_0}{\\omega_2 - \\omega_1} \\frac{\\sin(\\omega_2 t) - \\sin(\\omega_1 t)}{t}\n$$\nThe value at $t=0$ is defined to be $f(0)=E_0$.\n\n**4. Discretization, Windowing, and Spectral Analysis**\n\nThe continuous signal $f(t)$ is infinite in duration and must be truncated for use in a time-stepping simulation. This is accomplished by sampling and windowing. The signal is discretized on a uniform time grid $t_n = (n-n_0)\\Delta t$ for $n=0, 1, \\dots, N-1$, where $n_0 = (N-1)/2$. This places $t=0$ at the center of the time window. For the even values of $N$ used in the test cases, $n_0$ is a half-integer, meaning no sample point falls exactly on $t=0$, which conveniently avoids the need to handle the removable singularity in the formula for $f(t_n)$ with special logic.\n\nThe discrete signal $f[n] = f(t_n)$ is multiplied by a Tukey window $w[n]$ of length $N$ and parameter $\\alpha$. The Tukey window provides a flat central region and smooth cosine tapers at the ends, which helps to reduce spectral leakage compared to an abrupt rectangular window. The resulting finite-duration signal for analysis is $f_{win}[n] = f[n] \\cdot w[n]$.\n\nThe spectrum of $f_{win}[n]$ is computed using a zero-padded Fast Fourier Transform (FFT) to approximate the continuous spectrum $F_{\\Delta t}(\\omega) \\approx \\Delta t \\sum_n f_{win}[n] e^{-\\mathrm{i}\\omega t_n}$. Specifically, we employ the real FFT (`rfft`) for efficiency, as the input signal is real. The magnitude of the approximated spectrum is $|F_{\\Delta t}(\\omega_k)| = \\Delta t |F_{RFFT}[k]|$, where $F_{RFFT}[k]$ are the coefficients from the `rfft` algorithm and $\\omega_k$ are the corresponding discrete angular frequencies. A significant zero-padding factor (e.g., $16N$) is used to obtain a finely resolved spectrum for accurate metric calculation.\n\n**5. Quantitative Metrics**\n\nThe three metrics assess the quality of the generated spectrum against the ideal one. They are computed from the discrete spectral magnitudes $|F_{\\Delta t}(\\omega_k)|$, which we denote as $S_k$. The averaging operator $\\langle\\cdot\\rangle_{\\omega\\in[\\omega_1,\\omega_2]}$ is interpreted as the arithmetic mean over all discrete frequency bins $\\omega_k$ that fall within the band $[\\omega_1, \\omega_2]$.\n\n-   $m_1$ (Normalized in-band mean magnitude): This measures how well the average spectral amplitude matches the target $K$.\n    $$ m_1 = \\frac{\\mathrm{mean}(\\{S_k \\mid \\omega_1 \\le \\omega_k \\le \\omega_2\\})}{K} $$\n-   $m_2$ (Normalized in-band RMS ripple): This quantifies the flatness of the spectrum within the band. It is the standard deviation of the in-band spectral magnitudes, normalized by $K$.\n    $$ m_2 = \\frac{\\mathrm{std}(\\{S_k \\mid \\omega_1 \\le \\omega_k \\le \\omega_2\\})}{K} $$\n-   $m_3$ (Normalized maximum out-of-band leakage): This measures the spectral purity, indicating the peak level of energy that has leaked outside the target band due to windowing and discretization.\n    $$ m_3 = \\frac{\\max(\\{S_k \\mid \\omega_k < \\omega_1 \\text{ or } \\omega_k > \\omega_2\\})}{K} $$\n\nThe implementation will now apply this complete procedure to each test case.", "answer": "```python\nimport numpy as np\nfrom scipy.signal.windows import tukey\n\ndef solve():\n    \"\"\"\n    Derives, implements, and assesses a broadband waveform for FDTD TFSF injection.\n    \"\"\"\n    # Each tuple contains: (w1, w2, E0, dt, N, alpha)\n    # w1, w2 in rad/s; E0 in V/m; dt in s; N is dimensionless; alpha is dimensionless.\n    test_cases = [\n        # Case A: Happy path broadband\n        (2 * np.pi * 1.0e9, 2 * np.pi * 3.0e9, 1.0, 2.0e-11, 4096, 0.5),\n        # Case B: Narrow band\n        (2 * np.pi * 0.5e9, 2 * np.pi * 0.55e9, 0.5, 5.0e-10, 8192, 0.2),\n        # Case C: Low pass (includes DC)\n        (0.0, 2 * np.pi * 0.5e9, 1.0, 5.0e-10, 4096, 1.0),\n        # Case D: High band near Nyquist\n        (2 * np.pi * 18.0e9, 2 * np.pi * 22.0e9, 1.0, 2.0e-11, 4096, 0.7),\n    ]\n\n    all_results = []\n    \n    for w1, w2, E0, dt, N, alpha in test_cases:\n        # Step 1: Calculate the target spectral magnitude K\n        # K = (pi * E0) / (w2 - w1)\n        # This formula is valid for w2 > w1.\n        if w2 > w1:\n            K = (np.pi * E0) / (w2 - w1)\n        else:\n            # For w1=w2, an ideal spectrum would be a Dirac delta,\n            # which is not the case here. The problem has w2>w1 for all cases.\n            all_results.extend([np.nan, np.nan, np.nan])\n            continue\n            \n        # Step 2: Create the ideal continuous-time signal f(t) and discretize it\n        n0 = (N - 1) / 2.0\n        n_indices = np.arange(N)\n        t = (n_indices - n0) * dt\n        \n        # Calculate f(t) = E0/(w2-w1) * (sin(w2*t) - sin(w1*t))/t\n        # For even N, t never equals 0, so no division by zero occurs.\n        # The formula is implemented directly.\n        f_t = (E0 / (w2 - w1)) * (np.sin(w2 * t) - np.sin(w1 * t)) / t\n\n        # Step 3: Apply the Tukey window\n        # The window is symmetric and centered by default.\n        window = tukey(N, alpha=alpha, sym=True)\n        f_win = f_t * window\n        \n        # Step 4: Compute the spectrum using a zero-padded real FFT\n        # A large padding factor provides a finely sampled spectrum for accurate metrics.\n        M_fft = 16 * N\n        \n        # Compute the one-sided real FFT\n        F_rfft = np.fft.rfft(f_win, n=M_fft)\n        \n        # Calculate the spectrum magnitude, scaled by dt to approximate the continuous Fourier Transform\n        S_k = dt * np.abs(F_rfft)\n\n        # Step 5: Get the corresponding frequency bins\n        # rfftfreq gives frequencies in cycles/unit-time, convert to rad/s\n        omega_k = 2 * np.pi * np.fft.rfftfreq(M_fft, d=dt)\n        \n        # Step 6: Calculate the metrics m1, m2, m3\n        # Create boolean masks for in-band and out-of-band frequencies\n        in_band_mask = (omega_k >= w1) & (omega_k <= w2)\n        out_of_band_mask = (omega_k < w1) | (omega_k > w2)\n        \n        S_in = S_k[in_band_mask]\n        S_out = S_k[out_of_band_mask]\n        \n        # m1: Normalized in-band mean magnitude\n        if S_in.size > 0:\n            mean_S_in = np.mean(S_in)\n            m1 = mean_S_in / K\n        else:\n            m1 = 0.0 # No points in band\n\n        # m2: Normalized in-band RMS ripple (std dev)\n        if S_in.size > 1:\n            m2 = np.std(S_in) / K\n        else:\n            m2 = 0.0 # Not enough points to calculate standard deviation\n\n        # m3: Normalized maximum out-of-band leakage\n        if S_out.size > 0:\n            m3 = np.max(S_out) / K\n        else:\n            m3 = 0.0 # No points out of band\n\n        all_results.extend([m1, m2, m3])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{x:.6f}' for x in all_results)}]\")\n\nsolve()\n```", "id": "3318239"}]}