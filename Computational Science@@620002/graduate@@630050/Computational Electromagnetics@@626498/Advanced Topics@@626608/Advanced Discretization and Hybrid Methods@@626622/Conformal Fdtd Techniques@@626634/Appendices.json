{"hands_on_practices": [{"introduction": "A fundamental test for any numerical method intended for lossless systems is the conservation of energy. This practice provides a direct way to verify that a conformal FDTD scheme correctly handles curved Perfect Electric Conductor (PEC) boundaries without introducing artificial numerical dissipation. By implementing a basic conformal update rule for a circular resonant cavity [@problem_id:3294784], you will monitor the discrete electromagnetic energy over time to confirm its stability, a crucial first step in validating a custom FDTD solver.", "problem": "Consider a two-dimensional Transverse Electric in the out-of-plane direction (TE$_z$) configuration of Maxwell’s equations in a simply-connected vacuum region bounded by a smooth Perfect Electric Conductor (PEC). Let the PEC boundary be a circle of radius $R$ centered at the origin. The vacuum domain is the open disk $\\{(x,y): x^2 + y^2 < R^2\\}$. The fields are $\\mathbf{E} = (E_x, E_y, 0)$ and $\\mathbf{H} = (0, 0, H_z)$, with vacuum permittivity $\\varepsilon_0$ and vacuum permeability $\\mu_0$. The speed of light is $c = 1/\\sqrt{\\varepsilon_0 \\mu_0}$. The continuous integral forms of Maxwell’s equations for this polarization are\n$$\n\\frac{\\partial}{\\partial t}\\left(\\mu_0 H_z \\right) = -\\left(\\nabla \\times \\mathbf{E}\\right)_z,\\quad\n\\frac{\\partial}{\\partial t}\\left(\\varepsilon_0 E_x\\right) = \\left(\\nabla \\times \\mathbf{H}\\right)_x,\\quad\n\\frac{\\partial}{\\partial t}\\left(\\varepsilon_0 E_y\\right) = \\left(\\nabla \\times \\mathbf{H}\\right)_y,\n$$\ntogether with the PEC boundary condition that the tangential electric field vanishes on the circular boundary. \n\nYour task is to implement a conformal finite-difference time-domain (FDTD) scheme that respects the geometry of the circular PEC by modifying the update of the magnetic field using geometric fractions, while leaving the electric field updates in the standard Yee form but enforcing zero fields on edges that are completely outside the vacuum region. Specifically, use a uniform Cartesian Yee grid covering a square domain $[-L_x/2,L_x/2]\\times[-L_y/2,L_y/2]$ with $N_x$ cells in $x$ and $N_y$ cells in $y$, spacings $\\Delta x = L_x/N_x$, $\\Delta y = L_y/N_y$, and time step $\\Delta t$ chosen via the Courant–Friedrichs–Lewy (CFL) condition \n$$\n\\Delta t = \\alpha \\left( c \\sqrt{\\Delta x^{-2} + \\Delta y^{-2}} \\right)^{-1},\n$$\nfor a specified factor $\\alpha \\in (0,1)$. Place the PEC circular boundary of radius $R$ at the center $(0,0)$.\n\nConformal update for $H_z$: For each primal cell, let $A_{\\text{eff}}$ be the area of the intersection of the cell and the disk $x^2+y^2<R^2$. For the four edges of the cell (top, bottom, right, left), let $\\ell_{\\text{top}}$, $\\ell_{\\text{bot}}$, $\\ell_{\\text{right}}$, $\\ell_{\\text{left}}$ be the lengths of those edge segments lying strictly within the disk. Then the discrete update for $H_z$ at cell $(i,j)$ is\n$$\nH_z^{n+\\frac{1}{2}} = H_z^{n-\\frac{1}{2}} - \\frac{\\Delta t}{\\mu_0 A_{\\text{eff}}} \\left[ E_x^{n}\\big|_{\\text{top}} \\, \\ell_{\\text{top}} - E_x^{n}\\big|_{\\text{bot}} \\, \\ell_{\\text{bot}} + E_y^{n}\\big|_{\\text{right}} \\, \\ell_{\\text{right}} - E_y^{n}\\big|_{\\text{left}} \\, \\ell_{\\text{left}} \\right],\n$$\nwith the convention that if $A_{\\text{eff}}=0$ then $H_z$ is identically zero and not updated.\n\nElectric field updates: Use the standard Yee updates without geometric scaling,\n$$\nE_x^{n+1} = E_x^n + \\frac{\\Delta t}{\\varepsilon_0} \\frac{ H_z^{n+\\frac{1}{2}}(i,j) - H_z^{n+\\frac{1}{2}}(i,j-1)}{\\Delta y},\\quad\nE_y^{n+1} = E_y^n - \\frac{\\Delta t}{\\varepsilon_0} \\frac{ H_z^{n+\\frac{1}{2}}(i,j) - H_z^{n+\\frac{1}{2}}(i-1,j)}{\\Delta x},\n$$\napplied wherever the edge is at least partially inside the disk. For any Yee edge that lies completely outside the disk, enforce $E_x=0$ or $E_y=0$ at all times. This realizes the PEC boundary condition conformally while keeping the explicit time stepping.\n\nDiscrete electromagnetic energy: Define the discrete total energy per unit out-of-plane length at time step $n$ by\n$$\n\\mathcal{W}^n = \\frac{1}{2}\\mu_0 \\sum_{\\text{cells}} \\left(H_z^n\\right)^2 A_{\\text{eff}} \\; + \\; \\frac{1}{2}\\varepsilon_0 \\sum_{\\text{$E_x$ edges}} \\left(E_x^n\\right)^2 \\, \\Delta x \\, \\ell^\\star_{x} \\; + \\; \\frac{1}{2}\\varepsilon_0 \\sum_{\\text{$E_y$ edges}} \\left(E_y^n\\right)^2 \\, \\Delta y \\, \\ell^\\star_{y},\n$$\nwhere $\\ell^\\star_{x}$ is the length of the dual vertical segment of size $\\Delta y$ associated to an $E_x$ edge that lies within the disk, and $\\ell^\\star_{y}$ is the length of the dual horizontal segment of size $\\Delta x$ associated to an $E_y$ edge that lies within the disk. For edges entirely outside the disk, the contribution is zero.\n\nGeometry computation requirements:\n- For each horizontal edge at constant $y=y_0$ and spanning $x \\in [x_0,x_1]$ with $x_1-x_0=\\Delta x$, compute the segment length inside the circle exactly by overlapping the interval $[x_0,x_1]$ with the circle chord $[-\\sqrt{R^2-y_0^2},+\\sqrt{R^2-y_0^2}]$ if $|y_0|<R$, and zero otherwise. Set $\\ell = \\max\\{0,\\min(x_1,\\sqrt{R^2-y_0^2}) - \\max(x_0,-\\sqrt{R^2-y_0^2})\\}$.\n- For each vertical edge at constant $x=x_0$ and spanning $y \\in [y_0,y_1]$ with $y_1-y_0=\\Delta y$, compute the segment length inside the circle exactly by overlapping $[y_0,y_1]$ with $[-\\sqrt{R^2-x_0^2},+\\sqrt{R^2-x_0^2}]$ if $|x_0|<R$, and zero otherwise. Set $\\ell = \\max\\{0,\\min(y_1,\\sqrt{R^2-x_0^2}) - \\max(y_0,-\\sqrt{R^2-x_0^2})\\}$.\n- For each magnetic cell, approximate $A_{\\text{eff}}$ by uniform subsampling at $p\\times p$ quadrature points per cell and taking the fraction of samples inside the disk times the full area $\\Delta x \\Delta y$, with $p \\ge 4$ fixed for all tests.\n\nInitial condition: At $t=0$, set $E_x=0$ and $E_y=0$ everywhere. Initialize $H_z$ to a smooth, localized distribution centered at the origin to avoid exciting spurious boundary currents, for example $H_z(x,y,0)=H_0 \\exp\\left(-\\frac{x^2+y^2}{2\\sigma^2}\\right)$ with $H_0=1$ and $\\sigma=0.2R$. Since the cavity is closed and the medium is lossless, the discrete energy $\\mathcal{W}^n$ should remain constant in time, up to numerical dispersion and quadrature errors, if the conformal updates do not introduce artificial loss.\n\nVerification metric: For each simulation, compute the minimal fractional energy drop over the run,\n$$\n\\delta_{\\min} = \\frac{\\mathcal{W}^0 - \\min_{0 \\le n \\le N_t} \\mathcal{W}^n}{\\mathcal{W}^0},\n$$\nwhere $N_t$ is the number of time steps. Report $\\delta_{\\min}$ as a decimal (not a percentage). A small value indicates that no artificial loss was introduced by the conformal boundary treatment.\n\nTest suite and required output:\n- Use vacuum parameters $\\varepsilon_0 = 8.854187817\\times 10^{-12}$ (in $\\text{F/m}$) and $\\mu_0 = 4\\pi\\times 10^{-7}$ (in $\\text{H/m}$). The cavity and domain dimensions $L_x$ and $L_y$ are in meters; express $R$, $\\Delta x$, $\\Delta y$, and $\\Delta t$ in meters and seconds as usual in the implementation, but the output metric $\\delta_{\\min}$ is dimensionless.\n- Use subsampling resolution $p=8$ for $A_{\\text{eff}}$ in all tests.\n- Simulate the following cases, each starting from rest as described and run for the specified number of steps $N_t$:\n    1. Case A (happy path): $L_x=L_y=1$, $N_x=N_y=80$, $R=0.4$, $\\alpha=0.90$, $N_t=1000$.\n    2. Case B (geometry edge case): $L_x=L_y=1$, $N_x=N_y=64$, $R=0.2$, $\\alpha=0.90$, $N_t=800$.\n    3. Case C (near-CFL stress): $L_x=L_y=1$, $N_x=N_y=96$, $R=0.45$, $\\alpha=0.98$, $N_t=1200$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order [Case A, Case B, Case C], for example $[\\delta_{\\min,A},\\delta_{\\min,B},\\delta_{\\min,C}]$.\n\nAll angles, where applicable, are in radians. The output must be real numbers printed as decimals. The numerical values must be computed by your program; do not hard-code the answers.", "solution": "The user-provided problem is assessed to be valid. It is scientifically grounded in the principles of computational electromagnetics, specifically the Finite-Difference Time-Domain (FDTD) method. The problem is well-posed, providing a complete set of partial differential equations, boundary conditions, initial conditions, and numerical parameters. The language is objective and the requirements are formalizable into a concrete numerical algorithm. The task is to implement a specific conformal FDTD scheme for a 2D TE$_z$ problem inside a circular Perfect Electric Conductor (PEC) and to verify its energy conservation properties.\n\nThe solution will be developed by following these steps:\n1.  Discretization of the computational domain using a standard Yee grid.\n2.  Pre-computation of all necessary geometric factors that encode the circular boundary into the Cartesian grid.\n3.  Implementation of the time-stepping loop using the leapfrog algorithm with the specified conformal updates.\n4.  Calculation of the discrete electromagnetic energy at each time step.\n5.  Evaluation of the energy conservation metric for the specified test cases.\n\n### 1. Discretization and Grid Setup\nThe continuous 2D domain is discretized using a uniform Cartesian grid as specified. The problem uses the Transverse Electric (TE$_z$) polarization, where the electric field $\\mathbf{E} = (E_x, E_y, 0)$ lies in the $xy$-plane and the magnetic field $\\mathbf{H} = (0, 0, H_z)$ is perpendicular to it. In the standard Yee FDTD scheme, the field components are spatially and temporally staggered.\n- The scalar magnetic field component $H_z$ is sampled at the center of each grid cell $(i, j)$ and at half-integer time steps $n+1/2$. A cell $(i,j)$ covers the area $[x_i, x_{i+1}] \\times [y_j, y_{j+1}]$.\n- The electric field component $E_x$ is sampled at the center of the horizontal edges of each cell and at integer time steps $n$.\n- The electric field component $E_y$ is sampled at the center of the vertical edges of each cell and at integer time steps $n$.\n\nThe simulation domain is a square $[-L_x/2, L_x/2] \\times [-L_y/2, L_y/2]$ with $N_x \\times N_y$ cells. The spatial and temporal step sizes are given by:\n$$ \\Delta x = \\frac{L_x}{N_x}, \\quad \\Delta y = \\frac{L_y}{N_y} $$\n$$ \\Delta t = \\alpha \\left( c \\sqrt{\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2}} \\right)^{-1} $$\nwhere $c = 1/\\sqrt{\\varepsilon_0 \\mu_0}$ is the speed of light in vacuum and $\\alpha$ is the Courant factor.\n\n### 2. Geometric Pre-computation\nTo incorporate the circular PEC boundary of radius $R$ into the Cartesian grid, several geometric factors must be computed for each cell and edge before the time-stepping simulation begins.\n\n- **Effective Area ($A_{\\text{eff}}$)**: For each $H_z$ cell, $A_{\\text{eff}}$ is the area of the cell that lies inside the circle $x^2 + y^2 < R^2$. As specified, this is approximated by creating a uniform $p \\times p$ grid of sub-points within each cell and calculating the fraction of points that fall inside the circle, multiplied by the cell area $\\Delta x \\Delta y$.\n\n- **Effective Edge Lengths for H-update ($\\ell_{\\text{edge}}$)**: For each cell, the lengths of its four edges (top, bottom, left, right) that lie within the circle are computed. These are denoted $\\ell_{\\text{top}}$, $\\ell_{\\text{bot}}$, $\\ell_{\\text{right}}$, and $\\ell_{\\text{left}}$. The calculation uses the provided exact formula for the intersection length of a line segment with a circular chord. For a horizontal edge at height $y_0$ spanning $[x_0, x_1]$, the length inside the circle is $\\ell = \\max\\{0, \\min(x_1, \\sqrt{R^2-y_0^2}) - \\max(x_0, -\\sqrt{R^2-y_0^2})\\}$ for $|y_0|<R$, and zero otherwise. An analogous formula applies to vertical edges.\n\n- **Effective Dual-Edge Lengths for Energy Calculation ($\\ell^\\star$)**: The energy calculation requires lengths of *dual* grid segments that lie within the circle. For an $E_x$ component located on a horizontal primary edge, its associated dual segment is a vertical line of length $\\Delta y$ passing through its location. $\\ell^\\star_x$ is the length of this dual segment inside the circle. Similarly, $\\ell^\\star_y$ is the length of the dual horizontal segment for an $E_y$ component. These are computed using the same intersection logic as for the primary edges.\n\n### 3. FDTD Time-Stepping Algorithm\nThe simulation evolves the fields in time using a leapfrog scheme.\n\n- **Initialization**: At time $t=0$, the electric fields $E_x$ and $E_y$ are zero everywhere. The magnetic field $H_z$ is initialized with a smooth Gaussian pulse, $H_z(x,y,0) = H_0 \\exp\\left(-\\frac{x^2+y^2}{2\\sigma^2}\\right)$. For the leapfrog scheme, this initial condition at $t=0$ is used to represent the state at $t=-\\Delta t/2$, i.e., $H_z^{n=-1/2}$.\n\n- **H-Field Update**: At each step, $H_z$ is advanced from time $n-1/2$ to $n+1/2$ using the provided conformal update rule, which is a discrete version of Faraday's law of induction, $\\oint \\mathbf{E} \\cdot d\\mathbf{l} = - \\frac{\\partial}{\\partial t} \\int_S \\mu_0 H_z dS$:\n$$ H_z^{n+\\frac{1}{2}}(i,j) = H_z^{n-\\frac{1}{2}}(i,j) - \\frac{\\Delta t}{\\mu_0 A_{\\text{eff}}(i,j)} \\left[ E_x^{n}(i, j+1) \\ell_{\\text{top}} - E_x^{n}(i,j) \\ell_{\\text{bot}} + E_y^{n}(i+1,j) \\ell_{\\text{right}} - E_y^{n}(i,j) \\ell_{\\text{left}} \\right] $$\nThis update is only performed for cells where $A_{\\text{eff}} > 0$. For cells entirely outside the circle ($A_{\\text{eff}} = 0$), $H_z$ remains zero.\n\n- **E-Field Update**: The electric field components are advanced from time $n$ to $n+1$ using the standard, non-conformal Yee updates, which are discrete forms of Ampère's law:\n$$ E_x^{n+1}(i,j) = E_x^n(i,j) + \\frac{\\Delta t}{\\varepsilon_0} \\frac{ H_z^{n+\\frac{1}{2}}(i,j) - H_z^{n+\\frac{1}{2}}(i,j-1)}{\\Delta y} $$\n$$ E_y^{n+1}(i,j) = E_y^n(i,j) - \\frac{\\Delta t}{\\varepsilon_0} \\frac{ H_z^{n+\\frac{1}{2}}(i,j) - H_z^{n+\\frac{1}{2}}(i-1,j)}{\\Delta x} $$\nFollowing this update, the PEC boundary condition is enforced. Any electric field component whose corresponding edge lies completely outside the circular domain (i.e., its effective edge length is zero) is explicitly set to zero.\n\n### 4. Energy Conservation and Verification\nThe discrete electromagnetic energy per unit length, $\\mathcal{W}^n$, is a measure of the total energy stored in the fields within the circular cavity. It is computed at each integer time step $n$. Since the TE$_z$ fields are defined at different time instances, a time-averaging step is required for the magnetic field to co-locate it with the electric field:\n$$ H_z^n = \\frac{1}{2} \\left( H_z^{n-\\frac{1}{2}} + H_z^{n+\\frac{1}{2}} \\right) $$\nThe total energy is then the sum of the magnetic and electric energy contributions:\n$$ \\mathcal{W}^n = \\frac{1}{2}\\mu_0 \\sum_{i,j} \\left(H_z^n(i,j)\\right)^2 A_{\\text{eff}}(i,j) + \\frac{1}{2}\\varepsilon_0 \\sum_{i,j} \\left(E_x^n(i,j)\\right)^2 \\, \\Delta x \\, \\ell^\\star_{x}(i,j) + \\frac{1}{2}\\varepsilon_0 \\sum_{i,j} \\left(E_y^n(i,j)\\right)^2 \\, \\Delta y \\, \\ell^\\star_{y}(i,j) $$\nFor a lossless system, this quantity should be conserved. The verification metric $\\delta_{\\min}$ quantifies the maximum fractional deviation from the initial energy $\\mathcal{W}^0$ throughout the simulation:\n$$ \\delta_{\\min} = \\frac{\\mathcal{W}^0 - \\min_{0 \\le n \\le N_t} \\mathcal{W}^n}{\\mathcal{W}^0} $$\nA small value of $\\delta_{\\min}$ indicates that the numerical scheme is not artificially dissipative and correctly models the lossless nature of the PEC cavity. The algorithm is implemented to calculate this metric for the three specified test cases.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the FDTD simulations for all test cases and print the results.\n    \"\"\"\n\n    class ConformalFDTDSim:\n        \"\"\"\n        Encapsulates the logic for a 2D TEz conformal FDTD simulation.\n        \"\"\"\n        def __init__(self, Lx, Ly, Nx, Ny, R, alpha, Nt, p):\n            # Physical constants\n            self.EPS0 = 8.854187817e-12\n            self.MU0 = 4 * np.pi * 1e-7\n            self.C = 1 / np.sqrt(self.EPS0 * self.MU0)\n\n            # Simulation parameters\n            self.Lx, self.Ly = Lx, Ly\n            self.Nx, self.Ny = Nx, Ny\n            self.R = R\n            self.alpha = alpha\n            self.Nt = Nt\n            self.p = p\n\n            # Discretization\n            self.dx = self.Lx / self.Nx\n            self.dy = self.Ly / self.Ny\n            self.dt = self.alpha / (self.C * np.sqrt(1/self.dx**2 + 1/self.dy**2))\n\n            # Precompute geometric factors\n            self._precompute_geometry()\n\n        def _compute_len(self, p0, p1, R, orth_coord):\n            \"\"\"Computes intersection length of a segment with a circle's chord.\"\"\"\n            if np.abs(orth_coord) >= R:\n                return 0.0\n            chord_half_len = np.sqrt(R**2 - orth_coord**2)\n            overlap_min = max(p0, -chord_half_len)\n            overlap_max = min(p1, chord_half_len)\n            return max(0.0, overlap_max - overlap_min)\n\n        def _precompute_geometry(self):\n            \"\"\"Precomputes all geometric factors for the conformal FDTD scheme.\"\"\"\n            # Grid coordinates\n            x_h = -self.Lx/2 + (np.arange(self.Nx) + 0.5) * self.dx\n            y_h = -self.Ly/2 + (np.arange(self.Ny) + 0.5) * self.dy\n            x_ey = -self.Lx/2 + np.arange(self.Nx + 1) * self.dx\n            y_ex = -self.Ly/2 + np.arange(self.Ny + 1) * self.dy\n            \n            # --- Geometry for H_z update ---\n            self.A_eff = np.zeros((self.Nx, self.Ny))\n            self.l_top = np.zeros((self.Nx, self.Ny))\n            self.l_bot = np.zeros((self.Nx, self.Ny))\n            self.l_left = np.zeros((self.Nx, self.Ny))\n            self.l_right = np.zeros((self.Nx, self.Ny))\n\n            for i in range(self.Nx):\n                for j in range(self.Ny):\n                    x_min, x_max = x_ey[i], x_ey[i+1]\n                    y_min, y_max = y_ex[j], y_ex[j+1]\n\n                    # A_eff via subsampling\n                    sub_dx = self.dx / self.p\n                    sub_dy = self.dy / self.p\n                    sub_x = x_min + (np.arange(self.p) + 0.5) * sub_dx\n                    sub_y = y_min + (np.arange(self.p) + 0.5) * sub_dy\n                    sub_X, sub_Y = np.meshgrid(sub_x, sub_y)\n                    inside_mask = sub_X**2 + sub_Y**2 < self.R**2\n                    self.A_eff[i, j] = np.sum(inside_mask) / self.p**2 * self.dx * self.dy\n                    \n                    # Effective edge lengths\n                    self.l_bot[i, j] = self._compute_len(x_min, x_max, self.R, y_min)\n                    self.l_top[i, j] = self._compute_len(x_min, x_max, self.R, y_max)\n                    self.l_left[i, j] = self._compute_len(y_min, y_max, self.R, x_min)\n                    self.l_right[i, j] = self._compute_len(y_min, y_max, self.R, x_max)\n            \n            self.inv_mu0_A_eff = np.zeros((self.Nx, self.Ny))\n            mask = self.A_eff > 0\n            self.inv_mu0_A_eff[mask] = 1.0 / (self.MU0 * self.A_eff[mask])\n\n            # --- Geometry for E-field zeroing and Energy ---\n            ex_loc_x = -self.Lx/2 + (np.arange(self.Nx) + 0.5) * self.dx\n            ex_loc_y = -self.Ly/2 + np.arange(self.Ny + 1) * self.dy\n            ey_loc_x = -self.Lx/2 + np.arange(self.Nx + 1) * self.dx\n            ey_loc_y = -self.Ly/2 + (np.arange(self.Ny) + 0.5) * self.dy\n\n            self.l_x_edges = np.zeros((self.Nx, self.Ny + 1))\n            self.l_star_x = np.zeros((self.Nx, self.Ny + 1))\n            for i in range(self.Nx):\n                for j in range(self.Ny + 1):\n                    x, y = ex_loc_x[i], ex_loc_y[j]\n                    self.l_x_edges[i, j] = self._compute_len(x - self.dx/2, x + self.dx/2, self.R, y)\n                    self.l_star_x[i, j] = self._compute_len(y - self.dy/2, y + self.dy/2, self.R, x)\n\n            self.l_y_edges = np.zeros((self.Nx + 1, self.Ny))\n            self.l_star_y = np.zeros((self.Nx + 1, self.Ny))\n            for i in range(self.Nx + 1):\n                for j in range(self.Ny):\n                    x, y = ey_loc_x[i], ey_loc_y[j]\n                    self.l_y_edges[i, j] = self._compute_len(y - self.dy/2, y + self.dy/2, self.R, x)\n                    self.l_star_y[i, j] = self._compute_len(x - self.dx/2, x + self.dx/2, self.R, y)\n\n        def run(self):\n            \"\"\"Executes the FDTD time-stepping loop and returns the metric.\"\"\"\n            # Field arrays\n            ex = np.zeros((self.Nx, self.Ny + 1))\n            ey = np.zeros((self.Nx + 1, self.Ny))\n            hz = np.zeros((self.Nx, self.Ny))\n\n            # Initial condition for H_z at t=0 (used as t=-dt/2)\n            H0 = 1.0\n            sigma = 0.2 * self.R\n            x_h = -self.Lx/2 + (np.arange(self.Nx) + 0.5) * self.dx\n            y_h = -self.Ly/2 + (np.arange(self.Ny) + 0.5) * self.dy\n            X_h, Y_h = np.meshgrid(x_h, y_h, indexing='ij')\n            hz = H0 * np.exp(-(X_h**2 + Y_h**2) / (2 * sigma**2))\n            hz[self.A_eff == 0] = 0.0 # Enforce H=0 outside the physical domain\n\n            C_ex = self.dt / (self.EPS0 * self.dy)\n            C_ey = -self.dt / (self.EPS0 * self.dx)\n\n            W_history = []\n\n            for n in range(self.Nt):\n                hz_old = hz.copy() # H at n-1/2\n\n                # Update H_z to n+1/2\n                curl_E_x_term = ex[:, 1:] * self.l_top - ex[:, :-1] * self.l_bot\n                curl_E_y_term = ey[1:, :] * self.l_right - ey[:-1, :] * self.l_left\n                hz -= self.dt * self.inv_mu0_A_eff * (curl_E_y_term + curl_E_x_term)\n\n                # Time average H_z to get H at time n\n                hz_avg = 0.5 * (hz_old + hz)\n                \n                # Calculate energy at time n\n                W_H = 0.5 * self.MU0 * np.sum(hz_avg**2 * self.A_eff)\n                W_Ex = 0.5 * self.EPS0 * np.sum(ex**2 * self.dx * self.l_star_x)\n                W_Ey = 0.5 * self.EPS0 * np.sum(ey**2 * self.dy * self.l_star_y)\n                W_total = W_H + W_Ex + W_Ey\n                W_history.append(W_total)\n\n                # Update E_x to n+1\n                ex[:, 1:-1] += C_ex * (hz[:, 1:] - hz[:, :-1])\n                \n                # Update E_y to n+1\n                ey[1:-1, :] += C_ey * (hz[1:, :] - hz[:-1, :])\n\n                # Enforce PEC by zeroing E fields on edges outside the circle\n                ex[self.l_x_edges == 0] = 0.0\n                ey[self.l_y_edges == 0] = 0.0\n\n            W0 = W_history[0]\n            if W0 == 0:\n                return 0.0 \n            min_W = min(W_history)\n            delta_min = (W0 - min_W) / W0\n            return delta_min\n\n    # Test suite parameters\n    test_cases = [\n        # (Lx, Ly, Nx, Ny, R, alpha, Nt)\n        (1.0, 1.0, 80, 80, 0.4, 0.90, 1000),  # Case A\n        (1.0, 1.0, 64, 64, 0.2, 0.90, 800),   # Case B\n        (1.0, 1.0, 96, 96, 0.45, 0.98, 1200), # Case C\n    ]\n    p_subsampling = 8\n\n    results = []\n    for params in test_cases:\n        sim = ConformalFDTDSim(*params, p=p_subsampling)\n        result = sim.run()\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3294784"}, {"introduction": "While conformal methods improve geometric accuracy, they introduce a significant practical challenge known as the \"small-cell problem,\" where tiny cut-cells can drastically reduce the maximum stable time step, $\\Delta t$. This exercise moves beyond simple implementation to the critical engineering trade-offs inherent in robust solver design [@problem_id:3298059]. You will derive an error-stability model from first principles to determine optimal thresholds for collapsing pathologically small cells, balancing the competing demands of numerical stability and geometric accuracy.", "problem": "A conformal Finite-Difference Time-Domain (FDTD) scheme based on the Dey–Mittra method is used to model a smooth Perfect Electric Conductor (PEC) boundary that cuts a uniform Cartesian Yee mesh with spacing $\\Delta$. In the Dey–Mittra method, the edge-based electric unknowns and face-based magnetic unknowns are scaled by edge-length fractions $f_{\\ell} \\in (0,1]$ and face-area fractions $f_{a} \\in (0,1]$, respectively, induced by the intersection of the PEC with the grid. To avoid the small-cell stability and conditioning problems, a common engineering practice is to “collapse” any electric edge or magnetic face whose fraction falls below design thresholds $\\tau_{\\ell}$ and $\\tau_{a}$, respectively, by setting that degree of freedom to zero and enforcing the PEC constraint on that sub-entity.\n\nYou are asked to propose practical thresholds $(\\tau_{\\ell},\\tau_{a})$ that balance stability and accuracy, and to justify them by deriving an error–stability model from first principles. Assume the following setting:\n\n- The computational domain is vacuum with permittivity $\\epsilon$ and permeability $\\mu$, and the PEC surface is smooth with principal radii of curvature resolved by at least $10$ cells.\n- The leapfrog explicit time integrator is used. Let $\\Delta t_{0}$ denote the standard Courant time-step limit for the uncut Yee grid.\n- Only a thin layer of cells is cut by the PEC; the fraction of cut edges and faces among all edges and faces in the mesh is $p_{c} = 0.02$.\n- You will use the discrete energy of the semi-discrete Maxwell system and the Dey–Mittra mass matrices to obtain conservative bounds that relate:\n  (i) the maximum stable time step $\\Delta t_{\\max}$ to the minimum retained fractions $f_{\\ell,\\min} \\ge \\tau_{\\ell}$ and $f_{a,\\min} \\ge \\tau_{a}$, and\n  (ii) the relative perturbation of the discrete electromagnetic energy budget caused by collapsing sub-entities with fractions below $(\\tau_{\\ell},\\tau_{a})$ to $(\\tau_{\\ell},\\tau_{a})$, as a function of $p_{c}$, $\\tau_{\\ell}$, and $\\tau_{a}$.\n\nTargets for design:\n\n- Stability target: choose $(\\tau_{\\ell},\\tau_{a})$ such that $\\Delta t_{\\max} \\ge 0.20\\,\\Delta t_{0}$.\n- Accuracy target: the relative change in the discrete electromagnetic energy caused by the collapse operation should be no more than $1\\%$ under the assumption that fields are not preferentially concentrated in the cut layer.\n\nUsing Maxwell’s equations in integral form, the structure of the Dey–Mittra modification to the discrete mass matrices, and an energy-based estimate of the spectral radius, derive a conservative pair of inequalities that the thresholds $(\\tau_{\\ell},\\tau_{a})$ must satisfy to meet both targets. Then, among the following candidate threshold pairs, select the one that satisfies both derived inequalities while minimizing the total amount of collapse $\\tau_{\\ell}+\\tau_{a}$.\n\nA. $\\tau_{\\ell} = 0.10,\\ \\tau_{a} = 0.40$\n\nB. $\\tau_{\\ell} = 0.20,\\ \\tau_{a} = 0.20$\n\nC. $\\tau_{\\ell} = 0.15,\\ \\tau_{a} = 0.30$\n\nD. $\\tau_{\\ell} = 0.10,\\ \\tau_{a} = 0.10$", "solution": "The problem statement is evaluated as valid. It is scientifically grounded in the principles of computational electromagnetics, specifically the Finite-Difference Time-Domain (FDTD) method with Dey-Mittra conformal modeling. The problem is well-posed, providing sufficient quantitative data and clear, objective targets to derive a unique solution. It requires a non-trivial application of numerical analysis principles to derive design constraints, which is a standard and meaningful task in this engineering discipline.\n\nWe now proceed to derive the inequalities for the thresholds $(\\tau_{\\ell}, \\tau_{a})$ based on the provided stability and accuracy targets.\n\n### 1. Stability Analysis\n\nThe stability of the explicit leapfrog time-stepping scheme for Maxwell's equations is limited by the Courant-Friedrichs-Lewy (CFL) condition. The maximum stable time step, $\\Delta t_{\\max}$, is inversely proportional to the maximum frequency, $\\omega_{\\max}$, supported by the discrete system.\nFor the standard Yee scheme on a uniform grid, the Courant limit is $\\Delta t_{0}$.\n$$ \\Delta t_{0} \\propto \\frac{1}{\\omega_{\\max, 0}} $$\nThe semi-discrete Maxwell's equations in matrix form are:\n$$ \\frac{d\\mathbf{e}}{dt} = \\mathbf{M}_{\\epsilon}^{-1} \\mathbf{C} \\mathbf{h} $$\n$$ \\frac{d\\mathbf{h}}{dt} = -\\mathbf{M}_{\\mu}^{-1} \\mathbf{C}^T \\mathbf{e} $$\nHere, $\\mathbf{e}$ and $\\mathbf{h}$ are vectors of the electric and magnetic field degrees of freedom, $\\mathbf{C}$ is the discrete curl operator, and $\\mathbf{M}_{\\epsilon}$ and $\\mathbf{M}_{\\mu}$ are the mass matrices. In the Dey-Mittra method, these mass matrices are diagonal and incorporate the length fractions $f_{\\ell}$ and area fractions $f_{a}$. The entries of $\\mathbf{M}_{\\epsilon}^{-1}$ are proportional to $1/f_{\\ell}$ and the entries of $\\mathbf{M}_{\\mu}^{-1}$ are proportional to $1/f_{a}$. For uncut cells, $f_{\\ell}=1$ and $f_{a}=1$.\n\nThe system's squared frequencies $\\omega^2$ are the eigenvalues of the operator $\\mathbf{L} = \\mathbf{M}_{\\epsilon}^{-1} \\mathbf{C} \\mathbf{M}_{\\mu}^{-1} \\mathbf{C}^T$. The maximum frequency is governed by the spectral radius $\\rho(\\mathbf{L})$. A conservative bound can be obtained using matrix norms:\n$$ \\omega_{\\max}^2 \\propto \\rho(\\mathbf{L}) \\le ||\\mathbf{M}_{\\epsilon}^{-1}||_2 \\cdot ||\\mathbf{M}_{\\mu}^{-1}||_2 \\cdot ||\\mathbf{C} \\mathbf{C}^T||_2 $$\nFor the uncut grid, $\\mathbf{M}_{\\epsilon}$ and $\\mathbf{M}_{\\mu}$ are identity matrices (up to scaling constants), so $\\omega_{\\max, 0}^2 \\propto ||\\mathbf{C} \\mathbf{C}^T||_2$.\nFor the cut grid, the norms of the inverse diagonal mass matrices are determined by the smallest fractions:\n$$ ||\\mathbf{M}_{\\epsilon}^{-1}||_2 \\propto \\frac{1}{f_{\\ell, \\min}} \\quad \\text{and} \\quad ||\\mathbf{M}_{\\mu}^{-1}||_2 \\propto \\frac{1}{f_{a, \\min}} $$\nThus, the maximum frequency of the cut-cell system is bounded as:\n$$ \\omega_{\\max}^2 \\le \\frac{1}{f_{\\ell, \\min} f_{a, \\min}} \\omega_{\\max, 0}^2 \\implies \\omega_{\\max} \\le \\frac{1}{\\sqrt{f_{\\ell, \\min} f_{a, \\min}}} \\omega_{\\max, 0} $$\nThe maximum stable time step is then:\n$$ \\Delta t_{\\max} \\ge \\sqrt{f_{\\ell, \\min} f_{a, \\min}} \\, \\Delta t_{0} $$\nThe practice of collapsing sub-entities with fractions below the thresholds $(\\tau_{\\ell}, \\tau_{a})$ means that the minimum retained fractions are $f_{\\ell, \\min} = \\tau_{\\ell}$ and $f_{a, \\min} = \\tau_{a}$. Therefore, the time step for the collapsed grid is:\n$$ \\Delta t_{\\max} \\approx \\sqrt{\\tau_{\\ell} \\tau_{a}} \\, \\Delta t_{0} $$\nThe stability target is $\\Delta t_{\\max} \\ge 0.20 \\, \\Delta t_{0}$. This leads to our first inequality:\n$$ \\sqrt{\\tau_{\\ell} \\tau_{a}} \\ge 0.20 \\implies \\tau_{\\ell} \\tau_{a} \\ge 0.04 $$\n\n### 2. Accuracy Analysis\n\nThe accuracy is measured by the relative perturbation of the discrete electromagnetic energy caused by collapsing small-fraction entities. The total discrete energy is $W = W_e + W_m$, where:\n$$ W_e = \\frac{1}{2} \\mathbf{e}^T \\mathbf{M}_{\\epsilon} \\mathbf{e} \\propto \\sum_{i} f_{\\ell,i} e_i^2 $$\n$$ W_m = \\frac{1}{2} \\mathbf{h}^T \\mathbf{M}_{\\mu} \\mathbf{h} \\propto \\sum_{j} f_{a,j} h_j^2 $$\nThe energy lost, $\\Delta W$, is the energy associated with the collapsed degrees of freedom (where we set $e_i=0$ or $h_j=0$).\n$$ \\Delta W = \\Delta W_e + \\Delta W_m \\propto \\left( \\sum_{i, f_{\\ell,i} < \\tau_{\\ell}} f_{\\ell,i} e_i^2 \\right) + \\left( \\sum_{j, f_{a,j} < \\tau_{a}} f_{a,j} h_j^2 \\right) $$\nTo estimate the ratio $\\Delta W / W$, we use the problem's assumptions. The assumption that \"fields are not preferentially concentrated in the cut layer\" implies that the squared field values ($e_i^2, h_j^2$) are not correlated with the fractions ($f_{\\ell,i}, f_{a,j}$). We also assume energy equipartition on average, so that the total electric and magnetic energies are roughly equal, $W_e \\approx W_m$.\n\nThe relative loss in electric energy is $\\frac{\\Delta W_e}{W_e}$. Assuming $e_i^2$ is statistically independent of $f_{\\ell,i}$, we have:\n$$ \\frac{\\Delta W_e}{W_e} \\approx \\frac{\\sum_{i, f_{\\ell,i} < \\tau_{\\ell}} f_{\\ell,i}}{\\sum_{i, \\text{all}} f_{\\ell,i}} $$\nLet $N_e$ be the total number of electric edges. A fraction $p_c=0.02$ are cut. For the cut edges, we assume the fractions $f_{\\ell}$ are uniformly distributed in $(0, 1)$, a common model for a randomly placed smooth surface.\nThe numerator is the sum over collapsed edges:\n$$ \\sum_{f_{\\ell,i} < \\tau_{\\ell}} f_{\\ell,i} \\approx (p_c N_e) \\int_0^{\\tau_{\\ell}} f \\, df = p_c N_e \\frac{\\tau_{\\ell}^2}{2} $$\nThe denominator is the sum over all edges:\n$$ \\sum_{\\text{all}} f_{\\ell,i} = (1-p_c)N_e \\cdot 1 + (p_c N_e) \\int_0^1 f \\, df = (1-p_c)N_e + \\frac{p_c N_e}{2} = (1 - p_c/2)N_e $$\nSo, the relative electric energy loss is:\n$$ \\frac{\\Delta W_e}{W_e} \\approx \\frac{p_c N_e \\tau_{\\ell}^2/2}{(1 - p_c/2)N_e} = \\frac{p_c \\tau_{\\ell}^2}{2(1 - p_c/2)} $$\nA similar expression holds for the magnetic energy. With $W_e \\approx W_m$, the total relative energy loss is:\n$$ \\frac{\\Delta W}{W} = \\frac{\\Delta W_e + \\Delta W_m}{W_e + W_m} \\approx \\frac{1}{2}\\left(\\frac{\\Delta W_e}{W_e} + \\frac{\\Delta W_m}{W_m}\\right) \\approx \\frac{1}{2} \\left( \\frac{p_c \\tau_{\\ell}^2}{2(1 - p_c/2)} + \\frac{p_c \\tau_{a}^2}{2(1 - p_c/2)} \\right) = \\frac{p_c (\\tau_{\\ell}^2 + \\tau_{a}^2)}{4(1 - p_c/2)} $$\nThe accuracy target is $\\Delta W / W \\le 0.01$. Substituting $p_c=0.02$:\n$$ \\frac{0.02 (\\tau_{\\ell}^2 + \\tau_{a}^2)}{4(1 - 0.01)} \\le 0.01 \\implies \\frac{0.005 (\\tau_{\\ell}^2 + \\tau_{a}^2)}{0.99} \\le 0.01 $$\n$$ \\tau_{\\ell}^2 + \\tau_{a}^2 \\le \\frac{0.01 \\times 0.99}{0.005} = 2 \\times 0.99 = 1.98 $$\nThis gives our second inequality: $\\tau_{\\ell}^2 + \\tau_{a}^2 \\le 1.98$.\n\n### 3. Evaluation of Candidate Thresholds\n\nWe must select the pair $(\\tau_{\\ell}, \\tau_{a})$ from the options that satisfies both inequalities and minimizes the sum $\\tau_{\\ell} + \\tau_{a}$.\nThe two inequalities are:\n1. Stability: $\\tau_{\\ell} \\tau_{a} \\ge 0.04$\n2. Accuracy: $\\tau_{\\ell}^2 + \\tau_{a}^2 \\le 1.98$\n\nLet's evaluate each option.\n\n**A. $\\tau_{\\ell} = 0.10, \\tau_{a} = 0.40$**\n- Stability: $\\tau_{\\ell} \\tau_{a} = 0.10 \\times 0.40 = 0.04$. This satisfies $\\ge 0.04$.\n- Accuracy: $\\tau_{\\ell}^2 + \\tau_{a}^2 = (0.10)^2 + (0.40)^2 = 0.01 + 0.16 = 0.17$. This satisfies $\\le 1.98$.\n- Sum: $\\tau_{\\ell} + \\tau_{a} = 0.10 + 0.40 = 0.50$.\n- Verdict: **Valid**\n\n**B. $\\tau_{\\ell} = 0.20, \\tau_{a} = 0.20$**\n- Stability: $\\tau_{\\ell} \\tau_{a} = 0.20 \\times 0.20 = 0.04$. This satisfies $\\ge 0.04$.\n- Accuracy: $\\tau_{\\ell}^2 + \\tau_{a}^2 = (0.20)^2 + (0.20)^2 = 0.04 + 0.04 = 0.08$. This satisfies $\\le 1.98$.\n- Sum: $\\tau_{\\ell} + \\tau_{a} = 0.20 + 0.20 = 0.40$.\n- Verdict: **Valid**\n\n**C. $\\tau_{\\ell} = 0.15, \\tau_{a} = 0.30$**\n- Stability: $\\tau_{\\ell} \\tau_{a} = 0.15 \\times 0.30 = 0.045$. This satisfies $\\ge 0.04$.\n- Accuracy: $\\tau_{\\ell}^2 + \\tau_{a}^2 = (0.15)^2 + (0.30)^2 = 0.0225 + 0.09 = 0.1125$. This satisfies $\\le 1.98$.\n- Sum: $\\tau_{\\ell} + \\tau_{a} = 0.15 + 0.30 = 0.45$.\n- Verdict: **Valid**\n\n**D. $\\tau_{\\ell} = 0.10, \\tau_{a} = 0.10$**\n- Stability: $\\tau_{\\ell} \\tau_{a} = 0.10 \\times 0.10 = 0.01$. This does not satisfy $\\ge 0.04$.\n- Verdict: **Incorrect**\n\nComparing the valid options (A, B, C), we seek the one that minimizes the sum $\\tau_{\\ell} + \\tau_{a}$:\n- Option A sum: $0.50$\n- Option B sum: $0.40$\n- Option C sum: $0.45$\n\nThe minimum sum is $0.40$, which corresponds to option B. According to the arithmetic-geometric mean inequality, for a fixed product $\\tau_{\\ell} \\tau_{a} = P$, the sum $\\tau_{\\ell} + \\tau_{a}$ is minimized when $\\tau_{\\ell} = \\tau_{a} = \\sqrt{P}$. For the boundary case $P=0.04$, the minimum sum is achieved at $\\tau_{\\ell} = \\tau_{a} = 0.2$, confirming that pair (B) is optimal among all pairs on the stability boundary.\n\nTherefore, the pair $(\\tau_{\\ell}=0.20, \\tau_{a}=0.20)$ satisfies both the stability and accuracy criteria while minimizing the total amount of collapse $\\tau_{\\ell}+\\tau_{a}$.\n\nAnswering based on the analysis:\nOption A is incorrect because while it satisfies the derived inequalities, its sum $\\tau_{\\ell} + \\tau_{a} = 0.50$ is not minimal among the valid options.\nOption B is correct because it satisfies both inequalities ($\\tau_{\\ell}\\tau_{a} = 0.04 \\ge 0.04$ and $\\tau_{\\ell}^2+\\tau_{a}^2 = 0.08 \\le 1.98$) and provides the minimum sum $\\tau_{\\ell} + \\tau_{a} = 0.40$ among the valid choices.\nOption C is incorrect because while it satisfies the derived inequalities, its sum $\\tau_{\\ell} + \\tau_{a} = 0.45$ is not minimal among the valid options.\nOption D is incorrect because it fails to meet the stability criterion $\\tau_{\\ell} \\tau_{a} \\ge 0.04$.", "answer": "$$\\boxed{B}$$", "id": "3298059"}, {"introduction": "An elegant and powerful alternative to modifying the discrete curl operators is to use local coordinate transformations, a concept borrowed from transformation optics. This practice explores how a simple affine shear transformation within a cut-cell can be used to conform the grid to a boundary [@problem_id:3294846]. You will derive the equivalent anisotropic permittivity and permeability tensors that must be used in the standard Cartesian FDTD update, and then determine the new stability condition for this locally non-orthogonal scheme.", "problem": "Consider a two-dimensional electromagnetic region discretized by the Finite-Difference Time-Domain (FDTD) method, and suppose that within a single grid cell intersected by a curved material boundary (a \"cut cell\"), a local non-orthogonal affine coordinate transformation is applied to achieve geometric conformity. The transformation is given by $x' = x + \\alpha y$ and $y' = y$, where $\\alpha$ is a dimensionless shear parameter and $(x,y)$ denote the original Cartesian coordinates while $(x',y')$ denote the locally conformal coordinates inside the cut cell. The grid remains orthogonal in $(x,y)$, but the material is replaced by an equivalent anisotropic medium inside the cut cell so that Maxwell's equations in $(x,y)$ reproduce the physics in $(x',y')$. Assume the transformation extends trivially in the $z$ direction via $z' = z$.\n\nStarting from Maxwell's equations in differential form, namely $\\nabla \\times \\mathbf{E} = -\\partial \\mathbf{B}/\\partial t$, $\\nabla \\times \\mathbf{H} = \\partial \\mathbf{D}/\\partial t$, and the constitutive relations $\\mathbf{D} = \\boldsymbol{\\varepsilon}\\,\\mathbf{E}$, $\\mathbf{B} = \\boldsymbol{\\mu}\\,\\mathbf{H}$, together with the coordinate invariance of Maxwell's equations under differentiable mappings, derive the equivalent anisotropic material tensors in the original $(x,y,z)$ coordinates that reproduce the physics of an isotropic medium in the $(x',y',z')$ coordinates under the given affine shear inside the cut cell. Let the isotropic medium have scalar permittivity $\\varepsilon = \\varepsilon_0 \\varepsilon_r$ and scalar permeability $\\mu = \\mu_0 \\mu_r$, where $\\varepsilon_0$ is the vacuum permittivity and $\\mu_0$ is the vacuum permeability; specify the anisotropic tensors $\\boldsymbol{\\varepsilon}$ and $\\boldsymbol{\\mu}$ in $(x,y,z)$ explicitly in terms of $\\alpha$, $\\varepsilon_0$, $\\mu_0$, $\\varepsilon_r$, and $\\mu_r$.\n\nThen, for the two canonical two-dimensional polarizations used in FDTD—Transverse Electric to $z$ (TEz), with nonzero fields $E_z$, $H_x$, and $H_y$, and Transverse Magnetic to $z$ (TMz), with nonzero fields $H_z$, $E_x$, and $E_y$—derive a sufficient explicit stability bound on the time step $\\Delta t$ for the standard leapfrog FDTD update when the equivalent anisotropic tensors are used inside the cut cell. Your bound must be expressed in terms of the grid spacings $\\Delta x$ and $\\Delta y$, the speed of light in vacuum $c = 1/\\sqrt{\\varepsilon_0 \\mu_0}$, and the shear parameter $\\alpha$, and it must reduce to the usual Cartesian two-dimensional bound when $\\alpha = 0$. Provide a single explicit formula for $\\Delta t_{\\text{max}}$ that applies to both TEz and TMz under the shear mapping inside the cut cell.\n\nImplement a program that, for each provided test case, computes:\n- The in-plane components of the equivalent anisotropic permittivity tensor $\\boldsymbol{\\varepsilon}$: $(\\varepsilon_{xx}, \\varepsilon_{xy}, \\varepsilon_{yx}, \\varepsilon_{yy})$ in farads per meter (F/m).\n- The in-plane components of the equivalent anisotropic permeability tensor $\\boldsymbol{\\mu}$: $(\\mu_{xx}, \\mu_{xy}, \\mu_{yx}, \\mu_{yy})$ in henries per meter (H/m).\n- The maximum stable time step $\\Delta t_{\\text{max}}$ in seconds (s) for TEz and TMz, reported as $(\\Delta t_{\\text{TEz}}, \\Delta t_{\\text{TMz}})$.\n\nUnits must be strictly:\n- $\\boldsymbol{\\varepsilon}$ in F/m,\n- $\\boldsymbol{\\mu}$ in H/m,\n- $\\Delta t$ in s.\n\nAngles do not appear; no angle unit is required. All final answers must be real numbers.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output a nested list containing $[\\varepsilon_{xx}, \\varepsilon_{xy}, \\varepsilon_{yx}, \\varepsilon_{yy}, \\mu_{xx}, \\mu_{xy}, \\mu_{yx}, \\mu_{yy}, \\Delta t_{\\text{TEz}}, \\Delta t_{\\text{TMz}}]$.\n\nUse the following test suite, each specified as $(\\alpha, \\Delta x, \\Delta y, \\varepsilon_r, \\mu_r)$ with $\\Delta x$ and $\\Delta y$ in meters:\n- Test $1$: $(\\alpha = 0.0, \\Delta x = 10^{-3}, \\Delta y = 10^{-3}, \\varepsilon_r = 1.0, \\mu_r = 1.0)$.\n- Test $2$: $(\\alpha = 0.5, \\Delta x = 10^{-3}, \\Delta y = 2\\times 10^{-3}, \\varepsilon_r = 2.5, \\mu_r = 1.0)$.\n- Test $3$: $(\\alpha = -0.9, \\Delta x = 5\\times 10^{-4}, \\Delta y = 10^{-3}, \\varepsilon_r = 1.0, \\mu_r = 1.0)$.\n- Test $4$: $(\\alpha = 3.0, \\Delta x = 10^{-3}, \\Delta y = 10^{-3}, \\varepsilon_r = 1.0, \\mu_r = 1.0)$.\n- Test $5$: $(\\alpha = 1.0, \\Delta x = 10^{-3}, \\Delta y = 5\\times 10^{-4}, \\varepsilon_r = 1.0, \\mu_r = 2.0)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[result1,result2,result3]$), where each $resultk$ is the nested list for test $k$ in the ordered format given above. No additional text should be printed.", "solution": "The problem is valid as it is scientifically grounded in the principles of computational electromagnetics and transformation optics, well-posed, and provides all necessary information for a unique solution.\n\nThe solution requires two main derivations: first, the equivalent anisotropic material tensors ($\\boldsymbol{\\varepsilon}$ and $\\boldsymbol{\\mu}$) in a Cartesian coordinate system $(x,y,z)$ that mimic an isotropic medium in a sheared coordinate system $(x',y',z')$; and second, the FDTD stability condition for this equivalent anisotropic medium.\n\n### Part 1: Derivation of Equivalent Anisotropic Tensors\n\nThe transformation from the computational Cartesian coordinates $(x,y,z)$ to the locally conformal (sheared) coordinates $(x',y',z')$ is given by the affine mapping:\n$$ x' = x + \\alpha y $$\n$$ y' = y $$\n$$ z' = z $$\nwhere $\\alpha$ is a dimensionless shear parameter. This transformation is applied within a single \"cut cell\" of an FDTD grid.\n\nThe principle of coordinate invariance of Maxwell's equations states that the constitutive relations for an equivalent medium in the original coordinates can be found using the Jacobian matrix of the coordinate transformation. The Jacobian matrix $\\mathbf{J}$ of the transformation $\\mathbf{x}'(\\mathbf{x})$ is:\n$$ \\mathbf{J} = \\frac{\\partial(x', y', z')}{\\partial(x, y, z)} = \\begin{pmatrix} \\frac{\\partial x'}{\\partial x} & \\frac{\\partial x'}{\\partial y} & \\frac{\\partial x'}{\\partial z} \\\\ \\frac{\\partial y'}{\\partial x} & \\frac{\\partial y'}{\\partial y} & \\frac{\\partial y'}{\\partial z} \\\\ \\frac{\\partial z'}{\\partial x} & \\frac{\\partial z'}{\\partial y} & \\frac{\\partial z'}{\\partial z} \\end{pmatrix} = \\begin{pmatrix} 1 & \\alpha & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} $$\nThe determinant of the Jacobian is $\\det(\\mathbf{J}) = 1$.\n\nIn the primed coordinate system $(x',y',z')$, the medium is isotropic and homogeneous with scalar permittivity $\\varepsilon' = \\varepsilon_0 \\varepsilon_r$ and permeability $\\mu' = \\mu_0 \\mu_r$. In tensor form, this is $\\boldsymbol{\\varepsilon}' = \\varepsilon' \\mathbf{I}$ and $\\boldsymbol{\\mu}' = \\mu' \\mathbf{I}$, where $\\mathbf{I}$ is the $3 \\times 3$ identity matrix.\n\nThe transformation law for the permittivity and permeability tensors from the primed system to the unprimed system is given by:\n$$ \\boldsymbol{\\varepsilon} = \\frac{\\mathbf{J} \\boldsymbol{\\varepsilon}' \\mathbf{J}^T}{|\\det(\\mathbf{J})|} \\quad \\text{and} \\quad \\boldsymbol{\\mu} = \\frac{\\mathbf{J} \\boldsymbol{\\mu}' \\mathbf{J}^T}{|\\det(\\mathbf{J})|} $$\nSince $\\det(\\mathbf{J})=1$ and the primed tensors are scalar multiples of the identity matrix, this simplifies to:\n$$ \\boldsymbol{\\varepsilon} = \\varepsilon' (\\mathbf{J} \\mathbf{J}^T) \\quad \\text{and} \\quad \\boldsymbol{\\mu} = \\mu' (\\mathbf{J} \\mathbf{J}^T) $$\nWe compute the matrix product $\\mathbf{J} \\mathbf{J}^T$:\n$$ \\mathbf{J} \\mathbf{J}^T = \\begin{pmatrix} 1 & \\alpha & 0 \\\\ 0 & 1 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} \\begin{pmatrix} 1 & 0 & 0 \\\\ \\alpha & 1 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} = \\begin{pmatrix} 1 + \\alpha^2 & \\alpha & 0 \\\\ \\alpha & 1 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} $$\nTherefore, the equivalent anisotropic material tensors in the $(x,y,z)$ coordinate system are:\n$$ \\boldsymbol{\\varepsilon} = (\\varepsilon_0 \\varepsilon_r) \\begin{pmatrix} 1 + \\alpha^2 & \\alpha & 0 \\\\ \\alpha & 1 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} \\quad \\text{and} \\quad \\boldsymbol{\\mu} = (\\mu_0 \\mu_r) \\begin{pmatrix} 1 + \\alpha^2 & \\alpha & 0 \\\\ \\alpha & 1 & 0 \\\\ 0 & 0 & 1 \\end{pmatrix} $$\nThe in-plane components required for the calculation are:\n$\\varepsilon_{xx} = \\varepsilon_0 \\varepsilon_r (1 + \\alpha^2)$, $\\varepsilon_{xy} = \\varepsilon_{yx} = \\varepsilon_0 \\varepsilon_r \\alpha$, $\\varepsilon_{yy} = \\varepsilon_0 \\varepsilon_r$.\n$\\mu_{xx} = \\mu_0 \\mu_r (1 + \\alpha^2)$, $\\mu_{xy} = \\mu_{yx} = \\mu_0 \\mu_r \\alpha$, $\\mu_{yy} = \\mu_0 \\mu_r$.\n\n### Part 2: FDTD Stability Condition Derivation\n\nThe stability of the FDTD algorithm is governed by the Courant-Friedrichs-Lewy (CFL) condition, which depends on the maximum wave propagation speed in the grid. For the given anisotropic medium, the wave propagation characteristics for Transverse Electric (TEz) and Transverse Magnetic (TMz) polarizations are identical, as both are governed by the same scalar wave equation. This is because the anisotropy is confined to the $xy$-plane, and the tensors $\\boldsymbol{\\varepsilon}$ and $\\boldsymbol{\\mu}$ have the same tensorial structure.\n\nThe stability limit for an FDTD simulation using an equivalent anisotropic medium on an orthogonal grid $(\\Delta x, \\Delta y)$ is the same as that for an isotropic medium on a skewed grid. The skewed grid is obtained by applying the inverse coordinate transformation to an orthogonal grid in the primed space. However, the problem states the grid is orthogonal in $(x,y)$, and we are finding the stability limit of that simulation. This is equivalent to simulating an isotropic medium in a space where the orthogonal grid vectors of the $(x,y)$ space, $\\mathbf{v}_1 = (\\Delta x, 0)$ and $\\mathbf{v}_2 = (0, \\Delta y)$, are mapped to skewed vectors in the $(x',y')$ space.\n\nThe transformation maps these basis vectors to:\n$\\mathbf{v}'_1 = \\mathbf{J} \\mathbf{v}_1 = (\\Delta x, 0)$\n$\\mathbf{v}'_2 = \\mathbf{J} \\mathbf{v}_2 = (\\alpha \\Delta y, \\Delta y)$\n\nThe FDTD simulation in the $(x',y')$ space occurs on a grid defined by these two skewed vectors. The stability of such a scheme is known. Let $\\phi$ be the angle between $\\mathbf{v}'_1$ and $\\mathbf{v}'_2$.\n$|\\mathbf{v}'_1| = \\Delta x$\n$|\\mathbf{v}'_2| = \\sqrt{(\\alpha \\Delta y)^2 + (\\Delta y)^2} = \\Delta y \\sqrt{1+\\alpha^2}$\n$\\cos(\\phi) = \\frac{\\mathbf{v}'_1 \\cdot \\mathbf{v}'_2}{|\\mathbf{v}'_1| |\\mathbf{v}'_2|} = \\frac{\\alpha \\Delta x \\Delta y}{\\Delta x (\\Delta y \\sqrt{1+\\alpha^2})} = \\frac{\\alpha}{\\sqrt{1+\\alpha^2}}$\n$\\sin^2(\\phi) = 1 - \\cos^2(\\phi) = 1 - \\frac{\\alpha^2}{1+\\alpha^2} = \\frac{1}{1+\\alpha^2}$\n\nThe stability condition for a 2D FDTD leapfrog scheme on a non-orthogonal grid with spacings $|\\mathbf{v}'_1|$, $|\\mathbf{v}'_2|$ and angle $\\phi$ is:\n$$ \\Delta t^2 \\le \\frac{\\sin^2(\\phi)}{v^2 \\left( \\frac{1}{|\\mathbf{v}'_1|^2} + \\frac{1}{|\\mathbf{v}'_2|^2} - \\frac{2 \\cos(\\phi)}{|\\mathbf{v}'_1| |\\mathbf{v}'_2|} \\right)} $$\nwhere $v = c/\\sqrt{\\varepsilon_r \\mu_r}$ is the speed of light in the isotropic medium. Substituting our derived geometric quantities:\n$$ \\Delta t^2 \\le \\frac{1/(1+\\alpha^2)}{v^2 \\left( \\frac{1}{(\\Delta x)^2} + \\frac{1}{(\\Delta y)^2(1+\\alpha^2)} - \\frac{2 \\alpha/\\sqrt{1+\\alpha^2}}{\\Delta x \\Delta y \\sqrt{1+\\alpha^2}} \\right)} $$\n$$ \\Delta t^2 \\le \\frac{1/(1+\\alpha^2)}{v^2 \\left( \\frac{1}{(\\Delta x)^2} + \\frac{1}{(\\Delta y)^2(1+\\alpha^2)} - \\frac{2\\alpha}{\\Delta x \\Delta y (1+\\alpha^2)} \\right)} $$\nMultiplying the numerator and denominator by $(1+\\alpha^2)$:\n$$ \\Delta t^2 \\le \\frac{1}{v^2 \\left( \\frac{1+\\alpha^2}{(\\Delta x)^2} + \\frac{1}{(\\Delta y)^2} - \\frac{2\\alpha}{\\Delta x \\Delta y} \\right)} $$\nThis leads to the maximum stable time step:\n$$ \\Delta t_{\\text{max}} = \\frac{1}{v\\sqrt{\\frac{1+\\alpha^2}{(\\Delta x)^2} - \\frac{2\\alpha}{\\Delta x \\Delta y} + \\frac{1}{(\\Delta y)^2}}} $$\nSubstituting $v = c/\\sqrt{\\varepsilon_r \\mu_r}$:\n$$ \\Delta t_{\\text{max}} = \\frac{\\sqrt{\\varepsilon_r \\mu_r}}{c\\sqrt{\\frac{1+\\alpha^2}{(\\Delta x)^2} - \\frac{2\\alpha}{\\Delta x \\Delta y} + \\frac{1}{(\\Delta y)^2}}} $$\nThis single formula is valid for both TEz and TMz polarizations. For the case $\\alpha = 0$, the formula correctly reduces to the standard 2D Cartesian CFL condition:\n$$ \\Delta t_{\\text{max}} (\\alpha=0) = \\frac{\\sqrt{\\varepsilon_r \\mu_r}}{c\\sqrt{\\frac{1}{(\\Delta x)^2} + \\frac{1}{(\\Delta y)^2}}} $$\nThe term inside the square root is always positive, ensuring a real-valued time step.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import constants\n\ndef solve():\n    \"\"\"\n    Solves the conformal FDTD problem for a series of test cases.\n    It calculates the equivalent anisotropic material tensors and the FDTD\n    stability limit for a given affine shear transformation.\n    \"\"\"\n    # Define physical constants from scipy\n    eps0 = constants.epsilon_0  # Vacuum permittivity in F/m\n    mu0 = constants.mu_0        # Vacuum permeability in H/m\n    c = constants.c             # Speed of light in vacuum in m/s\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (alpha, delta_x, delta_y, eps_r, mu_r)\n    test_cases = [\n        (0.0, 1e-3, 1e-3, 1.0, 1.0),\n        (0.5, 1e-3, 2e-3, 2.5, 1.0),\n        (-0.9, 5e-4, 1e-3, 1.0, 1.0),\n        (3.0, 1e-3, 1e-3, 1.0, 1.0),\n        (1.0, 1e-3, 5e-4, 1.0, 2.0)\n    ]\n\n    results = []\n    for case in test_cases:\n        alpha, dx, dy, eps_r, mu_r = case\n\n        # Part 1: Calculate equivalent anisotropic tensor components\n        # Permittivity in the isotropic (primed) coordinate system\n        eps_prime = eps0 * eps_r\n        # Permeability in the isotropic (primed) coordinate system\n        mu_prime = mu0 * mu_r\n\n        # Anisotropic permittivity tensor components in the (x,y) system\n        eps_xx = eps_prime * (1 + alpha**2)\n        eps_xy = eps_prime * alpha\n        eps_yx = eps_prime * alpha\n        eps_yy = eps_prime\n\n        # Anisotropic permeability tensor components in the (x,y) system\n        mu_xx = mu_prime * (1 + alpha**2)\n        mu_xy = mu_prime * alpha\n        mu_yx = mu_prime * alpha\n        mu_yy = mu_prime\n\n        # Part 2: Calculate the maximum stable time step\n        # The stability condition is derived from the CFL condition for a \n        # non-orthogonal grid, resulting in the following expression.\n        # This single formula applies to both TEz and TMz polarizations.\n        \n        # Calculate the term inside the square root of the stability condition's denominator\n        dt_denom_sq_term = (1 + alpha**2) / dx**2 - 2 * alpha / (dx * dy) + 1 / dy**2\n        \n        # Calculate the maximum stable time step\n        # dt_max = (sqrt(eps_r * mu_r) / c) / sqrt(dt_denom_sq_term)\n        dt_max = np.sqrt(eps_r * mu_r) / (c * np.sqrt(dt_denom_sq_term))\n        \n        # The stability bound is the same for TEz and TMz modes\n        dt_tez = dt_max\n        dt_tmz = dt_max\n\n        # Collect results for the current test case in the specified order\n        case_results = [\n            eps_xx, eps_xy, eps_yx, eps_yy,\n            mu_xx, mu_xy, mu_yx, mu_yy,\n            dt_tez, dt_tmz\n        ]\n        results.append(case_results)\n\n    # Final print statement in the exact required format.\n    # The map(str, ...) converts each inner list to its string representation.\n    # The ','.join(...) creates a comma-separated string of these list strings.\n    # The f-string adds the outer brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3294846"}]}