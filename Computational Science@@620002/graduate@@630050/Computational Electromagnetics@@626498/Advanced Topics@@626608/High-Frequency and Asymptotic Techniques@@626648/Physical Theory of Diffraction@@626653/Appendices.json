{"hands_on_practices": [{"introduction": "The Physical Theory of Diffraction (PTD), like many high-frequency asymptotic methods, relies on simplifying assumptions to achieve computational efficiency. One of the most fundamental is the far-field approximation, where the complex spherical wave propagation is simplified. This practice provides a crucial, hands-on analytical exercise to understand the consequences of this approximation by deriving the leading-order error incurred when replacing an exact near-field radiation integral with its far-field counterpart [@problem_id:3340614]. Mastering this derivation solidifies your understanding of the PTD model's domain of validity and the trade-offs between accuracy and computational cost.", "problem": "A perfectly electrically conducting wedge illuminated by a time-harmonic plane wave produces an equivalent edge current along a straight edge segment of length $L$ in the Physical Theory of Diffraction (PTD). Consider one such straight edge segment oriented along the $z$-axis, extending from $z=-L/2$ to $z=L/2$. At frequency $f$ in free space, with wavenumber $k=2\\pi f/c$ where $c$ is the speed of light, suppose the equivalent edge current density along the edge is uniform so that its unknown amplitude factor cancels in any relative error measure. An observation point is located on the $x$-axis at $(R,0,0)$ with $R>0$, and the polarization is such that a scalar Green’s function description suffices for the edge contribution.\n\nThe exact scalar edge-radiation integral for the field at the observation point may be written as an integral of the free-space Green’s function over the edge length. The far-field PTD expression replaces the exact distance factor in the Green’s function by its far-zone approximation, specifically $\\left| \\mathbf{r} - \\mathbf{r}' \\right| \\mapsto R$ in the amplitude and $\\exp\\!\\left(-j k \\left| \\mathbf{r}-\\mathbf{r}' \\right|\\right) \\mapsto \\exp(-j k R)$ in the phase for this broadside observation geometry. Define the complex fractional error incurred by using the far-field PTD expression instead of the exact near-field integral as\n$$\n\\varepsilon \\equiv \\frac{E_{\\text{exact}} - E_{\\text{ff}}}{E_{\\text{ff}}},\n$$\nwhere $E_{\\text{exact}}$ is the field from the exact near-field integral and $E_{\\text{ff}}$ is the field from the far-field PTD approximation, both evaluated for the same uniform edge-current amplitude so that it cancels in $\\varepsilon$.\n\nStarting from the radiation integral based on the free-space Green’s function and using only well-tested expansions valid in the regime $k R \\gg 1$ and $L/R \\ll 1$, derive a leading-order asymptotic estimate of $\\varepsilon$ that retains all terms up to and including order $L^{2}/R^{2}$ and $k L^{2}/R$. Express your final result as a single simplified analytic expression in terms of $L$, $R$, and $k$. No numerical evaluation is required. State your final expression for $\\varepsilon$ explicitly. The answer must be given as a closed-form analytic expression with no units.", "solution": "The problem asks for the leading-order asymptotic estimate of the complex fractional error, $\\varepsilon$, incurred by using a far-field approximation for the radiation from a uniform line source. The source is an equivalent edge current of length $L$ along the $z$-axis, centered at the origin. The observation point is at $(R, 0, 0)$ on the $x$-axis.\n\nFirst, we formulate the expressions for the exact field, $E_{\\text{exact}}$, and the far-field approximate field, $E_{\\text{ff}}$. The problem is treated using a scalar Green's function. The source is located at $\\mathbf{r}' = (0, 0, z')$ where $z' \\in [-L/2, L/2]$. The observation point is $\\mathbf{r} = (R, 0, 0)$. The distance between a source point and the observation point is $|\\mathbf{r} - \\mathbf{r}'| = \\sqrt{R^2 + z'^2}$.\n\nThe field is proportional to the integral of the source density multiplied by the free-space Green's function, $G(\\mathbf{r}, \\mathbf{r}') = \\frac{\\exp(-j k |\\mathbf{r}-\\mathbf{r}'|)}{4\\pi |\\mathbf{r}-\\mathbf{r}'|}$. Since the edge current density is assumed to be uniform, its constant amplitude factor $I_0$ can be incorporated into a proportionality constant $C$ that will cancel in the final ratio.\n\nThe exact field is given by the radiation integral:\n$$\nE_{\\text{exact}} = C \\int_{-L/2}^{L/2} \\frac{\\exp(-j k \\sqrt{R^2 + z'^2})}{\\sqrt{R^2 + z'^2}} dz'\n$$\n\nThe problem states that the far-field expression, $E_{\\text{ff}}$, is obtained by replacing the distance factor $|\\mathbf{r} - \\mathbf{r}'|$ with $R$ in both the amplitude and the phase term of the Green's function. This means the integrand becomes a constant with respect to the integration variable $z'$.\n$$\nE_{\\text{ff}} = C \\int_{-L/2}^{L/2} \\frac{\\exp(-j k R)}{R} dz' = C \\frac{\\exp(-j k R)}{R} \\left[ z' \\right]_{-L/2}^{L/2} = C \\frac{L \\exp(-j k R)}{R}\n$$\n\nThe complex fractional error $\\varepsilon$ is defined as:\n$$\n\\varepsilon = \\frac{E_{\\text{exact}} - E_{\\text{ff}}}{E_{\\text{ff}}} = \\frac{E_{\\text{exact}}}{E_{\\text{ff}}} - 1\n$$\nSubstituting the expressions for the fields, the constant $C$ cancels:\n$$\n\\varepsilon = \\frac{R}{L \\exp(-j k R)} \\int_{-L/2}^{L/2} \\frac{\\exp(-j k \\sqrt{R^2 + z'^2})}{\\sqrt{R^2 + z'^2}} dz' - 1\n$$\nTo evaluate this, we need to find an asymptotic approximation for the integral. We are given the conditions $k R \\gg 1$ and $L/R \\ll 1$. The latter condition implies that for any $z'$ in the integration domain, $|z'/R| \\le L/(2R) \\ll 1$. This allows us to perform a Taylor series expansion of the integrand for small $z'/R$.\n\nLet's expand the terms in the integrand. The distance is $d(z') = \\sqrt{R^2 + z'^2} = R\\sqrt{1 + (z'/R)^2}$.\nUsing the binomial expansion $(1+x)^a \\approx 1 + ax + \\dots$, we expand $d(z')$ and $1/d(z')$.\n$$\nd(z') = R \\left(1 + \\frac{z'^2}{R^2}\\right)^{1/2} \\approx R \\left(1 + \\frac{1}{2} \\frac{z'^2}{R^2}\\right) = R + \\frac{z'^2}{2R}\n$$\nThis approximation is for the phase term. For the amplitude term, we have:\n$$\n\\frac{1}{d(z')} = \\frac{1}{R} \\left(1 + \\frac{z'^2}{R^2}\\right)^{-1/2} \\approx \\frac{1}{R} \\left(1 - \\frac{1}{2} \\frac{z'^2}{R^2}\\right) = \\frac{1}{R} - \\frac{z'^2}{2R^3}\n$$\nThe phase factor is $\\exp(-j k d(z')) \\approx \\exp\\left(-j k \\left(R + \\frac{z'^2}{2R}\\right)\\right) = \\exp(-j k R) \\exp\\left(-j k \\frac{z'^2}{2R}\\right)$.\nFor small arguments, $\\exp(x) \\approx 1+x$. The argument of the second exponential, $-j k z'^2/(2R)$, is small under the given conditions. Thus, we expand it:\n$$\n\\exp\\left(-j k \\frac{z'^2}{2R}\\right) \\approx 1 - j k \\frac{z'^2}{2R}\n$$\nThe problem requires retaining terms up to order $L^2/R^2$ and $k L^2/R$. After integration, a term in the integrand of order $(z')^n$ will produce a term of order $L^{n+1}$. The error $\\varepsilon$ involves dividing by $L$, so an integrand term of order $(z')^n$ contributes to $\\varepsilon$ with order $L^n$. We therefore need to keep integrand terms up to order $(z')^2$.\n\nLet's combine the expansions for the integrand:\n$$\n\\frac{\\exp(-j k \\sqrt{R^2 + z'^2})}{\\sqrt{R^2 + z'^2}} \\approx \\left(\\frac{1}{R} - \\frac{z'^2}{2R^3}\\right) \\exp(-j k R) \\left(1 - j k \\frac{z'^2}{2R}\\right)\n$$\n$$\n\\approx \\frac{\\exp(-j k R)}{R} \\left(1 - \\frac{z'^2}{2R^2}\\right) \\left(1 - j k \\frac{z'^2}{2R}\\right)\n$$\nExpanding the product and keeping terms up to order $(z')^2$:\n$$\n\\approx \\frac{\\exp(-j k R)}{R} \\left(1 - j k \\frac{z'^2}{2R} - \\frac{z'^2}{2R^2} + O\\left(\\frac{z'^4}{R^4}\\right)\\right)\n$$\n$$\n\\approx \\frac{\\exp(-j k R)}{R} \\left(1 - z'^2 \\left(\\frac{j k}{2R} + \\frac{1}{2R^2}\\right)\\right)\n$$\nNow, we integrate this approximate integrand from $z'=-L/2$ to $z'=L/2$:\n$$\n\\int_{-L/2}^{L/2} \\dots dz' \\approx \\int_{-L/2}^{L/2} \\frac{\\exp(-j k R)}{R} \\left(1 - z'^2 \\left(\\frac{j k}{2R} + \\frac{1}{2R^2}\\right)\\right) dz'\n$$\n$$\n= \\frac{\\exp(-j k R)}{R} \\left[ \\int_{-L/2}^{L/2} dz' - \\left(\\frac{j k}{2R} + \\frac{1}{2R^2}\\right) \\int_{-L/2}^{L/2} z'^2 dz' \\right]\n$$\nThe integrals are elementary:\n$$\n\\int_{-L/2}^{L/2} dz' = L\n$$\n$$\n\\int_{-L/2}^{L/2} z'^2 dz' = \\left[\\frac{z'^3}{3}\\right]_{-L/2}^{L/2} = \\frac{1}{3} \\left(\\left(\\frac{L}{2}\\right)^3 - \\left(-\\frac{L}{2}\\right)^3\\right) = \\frac{1}{3} \\left(\\frac{L^3}{8} + \\frac{L^3}{8}\\right) = \\frac{L^3}{12}\n$$\nSubstituting these back, the approximation for the integral is:\n$$\n\\int_{-L/2}^{L/2} \\dots dz' \\approx \\frac{\\exp(-j k R)}{R} \\left(L - \\frac{L^3}{12} \\left(\\frac{j k}{2R} + \\frac{1}{2R^2}\\right)\\right)\n$$\nNow we can compute the ratio $E_{\\text{exact}}/E_{\\text{ff}}$:\n$$\n\\frac{E_{\\text{exact}}}{E_{\\text{ff}}} \\approx \\frac{C \\frac{\\exp(-j k R)}{R} \\left(L - \\frac{L^3}{12} \\left(\\frac{j k}{2R} + \\frac{1}{2R^2}\\right)\\right)}{C \\frac{L \\exp(-j k R)}{R}} = 1 - \\frac{L^2}{12} \\left(\\frac{j k}{2R} + \\frac{1}{2R^2}\\right)\n$$\nFinally, we find the error $\\varepsilon$:\n$$\n\\varepsilon = \\frac{E_{\\text{exact}}}{E_{\\text{ff}}} - 1 \\approx - \\frac{L^2}{12} \\left(\\frac{j k}{2R} + \\frac{1}{2R^2}\\right)\n$$\nDistributing the terms, we get:\n$$\n\\varepsilon \\approx - \\frac{j k L^2}{24R} - \\frac{L^2}{24R^2}\n$$\nThis expression contains terms of order $kL^2/R$ and $L^2/R^2$, as required. It can be written more compactly by factoring out common terms:\n$$\n\\varepsilon \\approx -\\frac{L^2}{24R^2} (1 + j k R)\n$$\nThis is the desired leading-order asymptotic estimate of the fractional error.", "answer": "$$\n\\boxed{-\\frac{L^2}{24R^2} - j\\frac{kL^2}{24R}}\n$$", "id": "3340614"}, {"introduction": "While PTD provides a powerful correction to Physical Optics by including edge diffraction, its practical implementation often involves different levels of fidelity. A common simplification is to consider only singly-diffracted rays, neglecting more complex phenomena like multiple diffractions between different edges of a structure. This computational exercise allows you to directly quantify the error introduced by this simplification by comparing a \"single-interaction\" PTD model against a more accurate reference solution for a finite plate [@problem_id:3340625]. By modeling the discrepancy in the deep shadow region, you will gain insight into the physical importance of higher-order diffraction mechanisms.", "problem": "You are to implement a program that quantitatively compares the Physical Theory of Diffraction (PTD) and the Method of Moments (MoM) predictions for the field in the deep shadow region behind a perfectly electrically conducting (PEC) finite plate at high frequency. The comparison must be based on a scalar high-frequency surrogate model consistent with the physical theory of diffraction in computational electromagnetics. In this problem, the PEC plate is a thin, flat, rectangular obstacle of size $2a \\times 2b$ centered at the origin in the plane $z=0$, illuminated by a unit-amplitude, time-harmonic plane wave at wavenumber $k$ propagating in the positive $z$-direction. The task is to compute, at selected observation points $\\mathbf{r} = (X,Y,Z)$ in the deep shadow region ($Z>0$ and $|X|<a$, $|Y|<b$), the discrepancy between:\n- a PTD single-interaction model that neglects multiple scattering and edge–edge coupling, and\n- a numerically exact scalar reference solution that serves as a high-frequency surrogate for the Method of Moments (MoM) benchmark by evaluating the Rayleigh–Sommerfeld diffraction integral for the rectangular aperture and invoking Babinet’s principle.\n\nAll quantities must be derived from first principles starting from the scalar Huygens–Fresnel principle and Babinet’s principle, without introducing any ad hoc formulas beyond standard Fresnel integrals.\n\nFundamental setup (all variables are in International System of Units (SI), and angles are not used):\n- The incident field is a unit-amplitude plane wave $u^{\\text{inc}}(\\mathbf{r}) = e^{j k Z}$, where $j$ denotes the imaginary unit and $k$ is the free-space wavenumber.\n- The wavelength is $\\lambda = \\frac{2\\pi}{k}$.\n- The rectangular PEC plate blocks the region $\\{|x|\\le a, |y|\\le b\\}$ on the plane $z=0$. The observation point is $\\mathbf{r}=(X,Y,Z)$ with $Z>0$.\n\nReference solution (MoM surrogate) using Babinet’s principle plus the Rayleigh–Sommerfeld Fresnel diffraction integral:\n- By Babinet’s principle in scalar theory, the field behind the opaque plate is $u^{\\text{plate}}(\\mathbf{r}) = u^{\\text{inc}}(\\mathbf{r}) - u^{\\text{ap}}(\\mathbf{r})$, where $u^{\\text{ap}}$ is the field produced by an aperture equal to the complementary rectangle $\\{|x|\\le a, |y|\\le b\\}$ in an infinite screen under the same illumination.\n- Under the Fresnel approximation, the aperture field at $\\mathbf{r}$ is\n$$\nu^{\\text{ap}}(X,Y,Z) = \\frac{e^{j k Z}}{j \\lambda Z} \\int_{-a}^{a}\\int_{-b}^{b} \\exp\\!\\left\\{ j\\frac{k}{2Z}\\big[(X-x')^{2} + (Y-y')^{2}\\big]\\right\\} \\, dx'\\, dy'.\n$$\n- Define the normalization factor $\\alpha = \\sqrt{\\frac{2}{\\lambda Z}}$ and the Fresnel integral\n$$\nF(u) = C(u) + j S(u), \\quad C(u) = \\int_{0}^{u}\\cos\\!\\left(\\frac{\\pi t^{2}}{2}\\right)\\, dt,\\quad S(u) = \\int_{0}^{u}\\sin\\!\\left(\\frac{\\pi t^{2}}{2}\\right)\\, dt.\n$$\nThen the aperture integral separates, and with\n$$\nu_{x}^{\\pm} = \\alpha(\\pm a - X),\\qquad u_{y}^{\\pm} = \\alpha(\\pm b - Y),\n$$\none obtains\n$$\nu^{\\text{ap}}(X,Y,Z) = \\frac{e^{j k Z}}{j 2}\\,\\big[ F(u_{x}^{+}) - F(u_{x}^{-}) \\big]\\;\\big[ F(u_{y}^{+}) - F(u_{y}^{-}) \\big].\n$$\nTherefore, the reference shadow field is\n$$\nu^{\\text{ref}}(X,Y,Z) = u^{\\text{plate}}(X,Y,Z) = e^{j k Z} - \\frac{e^{j k Z}}{j 2}\\,\\big[ F(u_{x}^{+}) - F(u_{x}^{-}) \\big]\\;\\big[ F(u_{y}^{+}) - F(u_{y}^{-}) \\big].\n$$\n\nPTD single-interaction model (neglecting multiple scattering and edge–edge coupling):\n- In PTD, the dominant contribution in the deep shadow arises from singly diffracted fields. To model the neglect of multiple scattering and edge–edge coupling, approximate the complementary rectangular aperture by a separable product of two independent half-plane aperture transmissions, one in $x$ and one in $y$, each retaining only the contribution from the nearest edge to the line-of-sight to the observation point.\n- For a half-plane aperture with edge at $x=x_{0}$, the Fresnel transmission factor is\n$$\nT(u) = \\tfrac{1}{2} + C(u) + j\\big(\\tfrac{1}{2} + S(u)\\big), \\qquad u = \\alpha(x_{0}-X).\n$$\n- For the rectangle, choose the nearest edge in $x$,\n$$\nu_{x}^{\\text{near}} = \\arg\\min_{u \\in \\{u_{x}^{+},\\,u_{x}^{-}\\}} \\big|u\\big|,\n$$\nand the nearest edge in $y$,\n$$\nu_{y}^{\\text{near}} = \\arg\\min_{u \\in \\{u_{y}^{+},\\,u_{y}^{-}\\}} \\big|u\\big|.\n$$\n- The PTD single-interaction approximation to the aperture field is then modeled as\n$$\nu^{\\text{ap}}_{\\text{PTD}}(X,Y,Z) = \\frac{e^{j k Z}}{j 2}\\, T\\!\\big(u_{x}^{\\text{near}}\\big)\\, T\\!\\big(u_{y}^{\\text{near}}\\big),\n$$\nand the corresponding shadow field is\n$$\nu^{\\text{PTD}}(X,Y,Z) = e^{j k Z} - u^{\\text{ap}}_{\\text{PTD}}(X,Y,Z).\n$$\n\nDiscrepancy metric:\n- For each observation point, define the relative complex-field discrepancy as\n$$\n\\delta = \\frac{\\big|u^{\\text{ref}} - u^{\\text{PTD}}\\big|}{\\big|u^{\\text{ref}}\\big|}.\n$$\nThis is a dimensionless real number.\n\nHigh-frequency parameter:\n- Enforce $ka = 200$ with $a$ in meters and $k$ in reciprocal meters. Use $a=b=1.0$ so that $k=200$ and $\\lambda = \\frac{2\\pi}{k}$.\n\nTest suite:\nUse the following four test cases (all distances in meters). All cases maintain $a=b=1.0$ and $k=200$:\n1. $Z=30 a = 30$, $(X,Y) = (0,0)$.\n2. $Z=30 a = 30$, $(X,Y) = (0.8 a, 0) = (0.8, 0)$.\n3. $Z=30 a = 30$, $(X,Y) = (0.8 a, 0.8 a) = (0.8, 0.8)$.\n4. $Z=10 a = 10$, $(X,Y) = (0.5 a, 0.5 a) = (0.5, 0.5)$.\n\nFor each case, compute the discrepancy $\\delta$ as defined above. The final program output should be a single line containing a list of four floating-point numbers representing the discrepancies for the four cases, in the same order, each rounded to six significant figures. The output format must be exactly a single Python list literal like:\n\"[d1,d2,d3,d4]\"\nwhere each di is a float with six significant figures (for example, 0.012345 or 1.23456).\n\nYour program must be entirely self-contained and must not read any input. It must use the specified runtime environment only.", "solution": "The problem requires a quantitative comparison between two models for high-frequency scalar diffraction by a perfectly electrically conducting (PEC) rectangular plate. The first model is a numerically exact reference solution (serving as a surrogate for the Method of Moments, MoM) based on the Fresnel-approximated Rayleigh-Sommerfeld diffraction integral and Babinet's principle. The second is a simplified Physical Theory of Diffraction (PTD) model that considers only single-interaction effects from the nearest edges. The objective is to compute the relative discrepancy, $\\delta$, between the fields predicted by these two models in the deep shadow region behind the plate.\n\nThe physical setup consists of a square plate of size $2a \\times 2b$ with $a=b=1.0$ meter, centered at the origin in the $z=0$ plane. It is illuminated by a unit-amplitude plane wave, $u^{\\text{inc}}(\\mathbf{r}) = e^{j k Z}$, propagating along the positive $z$-axis. The wavenumber is $k=200 \\text{ m}^{-1}$, which sets the high-frequency parameter $ka=200$ and the wavelength $\\lambda = 2\\pi/k = \\pi/100$ meters. The imaginary unit is denoted by $j$.\n\nThe solution proceeds by calculating the total field at specified observation points $\\mathbf{r}=(X,Y,Z)$ for both models and then computing their relative difference.\n\nFirst, we define a complex function for the Fresnel integral, $F(u)$, as specified:\n$$ F(u) = C(u) + j S(u) $$\nwhere $C(u) = \\int_{0}^{u}\\cos(\\frac{\\pi t^{2}}{2})\\, dt$ and $S(u) = \\int_{0}^{u}\\sin(\\frac{\\pi t^{2}}{2})\\, dt$ are the standard Fresnel cosine and sine integrals. These are implemented using the `scipy.special.fresnel` library function.\n\n**1. Reference Solution ($u^{\\text{ref}}$)**\n\nThe reference solution models the field behind the opaque plate by invoking Babinet's principle: the field is the incident field minus the field that would be diffracted by a complementary aperture of the same size.\n$$ u^{\\text{ref}}(X,Y,Z) = u^{\\text{inc}}(X,Y,Z) - u^{\\text{ap}}(X,Y,Z) $$\nThe aperture field, $u^{\\text{ap}}$, under the Fresnel approximation, is given by a separable integral which evaluates to:\n$$ u^{\\text{ap}}(X,Y,Z) = \\frac{e^{j k Z}}{j 2}\\,\\big[ F(u_{x}^{+}) - F(u_{x}^{-}) \\big]\\;\\big[ F(u_{y}^{+}) - F(u_{y}^{-}) \\big] $$\nThe arguments to the Fresnel integrals depend on the observation point $(X,Y,Z)$ and plate dimensions ($a, b$) through a normalization factor $\\alpha = \\sqrt{2/(\\lambda Z)}$:\n$$ u_{x}^{\\pm} = \\alpha(\\pm a - X) $$\n$$ u_{y}^{\\pm} = \\alpha(\\pm b - Y) $$\nFor each test case, we compute $\\alpha$, then $u_{x}^{\\pm}$ and $u_{y}^{\\pm}$. Subsequently, we evaluate the complex values of $F(u)$ for these arguments, assemble $u^{\\text{ap}}$, and finally obtain $u^{\\text{ref}}$.\n\n**2. PTD Single-Interaction Model ($u^{\\text{PTD}}$)**\n\nThe PTD model provides an approximation to the aperture field, $u^{\\text{ap}}_{\\text{PTD}}$, by considering only the diffraction contribution from the nearest edge in each dimension, thereby neglecting interactions with farther edges. This is formulated as a product of two independent half-plane transmission factors.\n$$ u^{\\text{PTD}}(X,Y,Z) = u^{\\text{inc}}(X,Y,Z) - u^{\\text{ap}}_{\\text{PTD}}(X,Y,Z) $$\nThe PTD aperture field is modeled as:\n$$ u^{\\text{ap}}_{\\text{PTD}}(X,Y,Z) = \\frac{e^{j k Z}}{j 2}\\, T(u_{x}^{\\text{near}})\\, T(u_{y}^{\\text{near}}) $$\nThe transmission factor for a single half-plane, $T(u)$, is defined in terms of Fresnel integrals:\n$$ T(u) = \\tfrac{1}{2} + C(u) + j\\big(\\tfrac{1}{2} + S(u)\\big) $$\nThe arguments $u_{x}^{\\text{near}}$ and $u_{y}^{\\text{near}}$ are chosen from the pairs $\\{u_{x}^{+}, u_{x}^{-}\\}$ and $\\{u_{y}^{+}, u_{y}^{-}\\}$ respectively, by selecting the one with the minimum absolute value. This corresponds to the edge closest to the projection of the observation point.\n$$ u_{x}^{\\text{near}} = \\arg\\min_{u \\in \\{u_{x}^{+},\\,u_{x}^{-}\\}} |u| $$\n$$ u_{y}^{\\text{near}} = \\arg\\min_{u \\in \\{u_{y}^{+},\\,u_{y}^{-}\\}} |u| $$\nFor a given observation point, we determine $u_{x}^{\\text{near}}$ and $u_{y}^{\\text{near}}$, calculate the corresponding transmission factors $T(u_{x}^{\\text{near}})$ and $T(u_{y}^{\\text{near}})$, and then compute $u^{\\text{ap}}_{\\text{PTD}}$ and $u^{\\text{PTD}}$.\n\n**3. Discrepancy Calculation ($\\delta$)**\n\nFinally, for each test case, the relative discrepancy $\\delta$ between the two models is computed as the magnitude of their difference, normalized by the magnitude of the reference solution:\n$$ \\delta = \\frac{|u^{\\text{ref}} - u^{\\text{PTD}}|}{|u^{\\text{ref}}|} = \\frac{|u^{\\text{ap}}_{\\text{PTD}} - u^{\\text{ap}}|}{|u^{\\text{inc}} - u^{\\text{ap}}|} $$\nThis dimensionless quantity measures the fractional error of the PTD approximation relative to the more accurate reference model. The calculation is performed for all four specified test cases, and the results are formatted to six significant figures.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import fresnel\n\ndef solve():\n    \"\"\"\n    Computes the discrepancy between a reference diffraction model and a PTD model\n    for a PEC plate, as specified in the problem statement.\n    \"\"\"\n    # Define the constants from the problem statement.\n    a = 1.0  # meters\n    b = 1.0  # meters\n    k = 200.0  # rad/m\n    lambda_ = 2 * np.pi / k\n    j = 1j\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (0.0, 0.0, 30.0),  # Case 1: Z=30a, (X,Y)=(0,0)\n        (0.8, 0.0, 30.0),  # Case 2: Z=30a, (X,Y)=(0.8a,0)\n        (0.8, 0.8, 30.0),  # Case 3: Z=30a, (X,Y)=(0.8a,0.8a)\n        (0.5, 0.5, 10.0),  # Case 4: Z=10a, (X,Y)=(0.5a,0.5a)\n    ]\n\n    results = []\n\n    # Helper function for the complex Fresnel integral F(u)\n    def F(u):\n        \"\"\"Computes F(u) = C(u) + j*S(u).\"\"\"\n        S_u, C_u = fresnel(u)\n        return C_u + j * S_u\n\n    # Helper function for the half-plane transmission factor T(u)\n    def T(u):\n        \"\"\"Computes T(u) = 1/2 + C(u) + j*(1/2 + S(u)).\"\"\"\n        S_u, C_u = fresnel(u)\n        return (0.5 + C_u) + j * (0.5 + S_u)\n\n    for X, Y, Z in test_cases:\n        # Calculate intermediate parameters for the current case\n        alpha = np.sqrt(2 / (lambda_ * Z))\n        u_inc = np.exp(j * k * Z)\n\n        # Arguments for Fresnel integrals\n        ux_p = alpha * (a - X)\n        ux_n = alpha * (-a - X)\n        uy_p = alpha * (b - Y)\n        uy_n = alpha * (-b - Y)\n\n        # 1. Calculate the Reference Solution (u_ref)\n        F_diff_x = F(ux_p) - F(ux_n)\n        F_diff_y = F(uy_p) - F(uy_n)\n        u_ap = (u_inc / (2 * j)) * F_diff_x * F_diff_y\n        u_ref = u_inc - u_ap\n\n        # 2. Calculate the PTD Solution (u_ptd)\n        # Determine nearest edge arguments\n        u_vals_x = [ux_p, ux_n]\n        idx_min_x = np.argmin(np.abs(u_vals_x))\n        ux_near = u_vals_x[idx_min_x]\n\n        u_vals_y = [uy_p, uy_n]\n        idx_min_y = np.argmin(np.abs(u_vals_y))\n        uy_near = u_vals_y[idx_min_y]\n\n        # Calculate PTD aperture field\n        Tx = T(ux_near)\n        Ty = T(uy_near)\n        u_ap_ptd = (u_inc / (2 * j)) * Tx * Ty\n        u_ptd = u_inc - u_ap_ptd\n\n        # 3. Calculate the Discrepancy (delta)\n        #\n        # np.abs(u_ref) can be very small in the deep shadow, but should not be zero\n        # for the given non-pathological points.\n        delta = np.abs(u_ref - u_ptd) / np.abs(u_ref)\n        results.append(delta)\n\n    # Format results to six significant figures and print\n    formatted_results = [f\"{res:.6g}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3340625"}, {"introduction": "Beyond its use in analyzing scattering, the analytical nature of PTD makes it an exceptionally powerful tool for engineering design and optimization. Because PTD provides a direct, differentiable relationship between an object's geometry and its scattered field, we can efficiently compute shape derivatives for use in gradient-based optimization algorithms. This advanced practice guides you through the process of deriving and implementing shape derivatives for an edge with a micro-chamfer, and then using them to perform a gradient descent step to optimize the edge's shape [@problem_id:3340641]. This exercise bridges the gap between electromagnetic theory and practical, automated design.", "problem": "Consider the high-frequency scattering of a monochromatic plane wave by a perfectly electrically conducting (PEC) finite straight edge segment. The Physical Theory of Diffraction (PTD) models the diffracted field by introducing equivalent edge currents obtained from asymptotic analysis of Maxwell’s equations subject to PEC boundary conditions, combined with the Huygens–Fresnel principle and Geometrical Optics (GO). In the far-field, the dominant contribution of a straight edge to the scattered field along a fixed observation direction can be represented by a one-dimensional edge integral over the edge’s tangential coordinate. In this problem, a micro-chamfer is applied at the center of the edge, removing a symmetric segment of half-length that depends on two parameters, a chamfer radius and a chamfer angle. You will derive shape derivatives of the diffracted field with respect to the micro-chamfer parameters and embed them in a gradient-based edge-shape optimization.\n\nThe setup is as follows. A PEC edge of finite length is aligned with the Cartesian axis corresponding to the tangential coordinate, denoted by the scalar variable $s$. The edge occupies $s \\in [-L,L]$ in meters. A plane wave of wavenumber $k$ in inverse meters propagates along a unit direction vector with $z$-component denoted $u_{i,z}$, and the observation (far-field) direction has unit vector with $z$-component $u_{o,z}$, both dimensionless. In a standard PTD far-field reduction for a straight edge, the leading dependence of the edge-integrand phase on the tangential coordinate can be modeled by an exponential factor controlled by the scalar $\\alpha = u_{i,z} + u_{o,z}$. The micro-chamfer is represented by removing the central segment $|s| < c$, where the effective half-length $c$ is parameterized by the chamfer radius $r$ and chamfer angle $\\beta$ through $c(r,\\beta) = r \\beta$, with $r$ in meters and $\\beta$ in radians. This representation is an engineering micro-chamfer surrogate consistent with small-angle, small-radius offsets along the edge centerline. Under these assumptions, the far-field diffracted field is modeled by an edge integral of the form\n$$\nE(c) = \\int_{-L}^{-c} f(s)\\,\\mathrm{d}s + \\int_{c}^{L} f(s)\\,\\mathrm{d}s,\n$$\nwhere $f(s)$ captures the local equivalent edge current’s phase variation in the far-field under plane-wave incidence. In this problem, you will adopt the canonical far-field phase model\n$$\nf(s) = \\exp\\!\\left(-j\\,k\\,\\alpha\\,s\\right),\n$$\nwith $j^2 = -1$, $k = \\frac{2\\pi}{\\lambda}$, and wavelength $\\lambda$ in meters. When $\\alpha = 0$, the phase factor is constant and $f(s) = 1$.\n\nYour tasks are:\n- Starting from Maxwell’s equations, PEC boundary conditions, the Huygens–Fresnel principle, and Geometrical Optics (GO), justify the reduction to the above one-dimensional edge integral model with the given far-field phase dependence, and invoke the Leibniz integral rule to obtain shape derivatives with respect to the chamfer half-length $c$.\n- Use the chain rule to express the shape derivatives with respect to the chamfer parameters $r$ and $\\beta$, given $c(r,\\beta) = r \\beta$.\n- Define the scalar objective function $J(c) = |E(c)|^2$, where $|\\cdot|$ denotes complex modulus, and derive its gradient components with respect to $r$ and $\\beta$.\n- Implement a single gradient-descent step that updates $r$ and $\\beta$ using a learning rate $\\eta$ in dimensionless units, with constraints $r \\ge 0$, $0 \\le \\beta \\le \\frac{\\pi}{2}$, and $c(r,\\beta) \\le L$. Use clipping to enforce these constraints.\n\nImportant modeling and units:\n- All lengths, including $L$ and $r$, must be expressed in meters.\n- All angles, including $\\beta$, $\\chi_i$, and $\\chi_o$, must be expressed in radians. The incidence and observation $z$-direction cosines are $u_{i,z} = \\cos(\\chi_i)$ and $u_{o,z} = \\cos(\\chi_o)$, respectively.\n- The wavenumber is $k = \\frac{2\\pi}{\\lambda}$ in inverse meters.\n- When needed, use the limit forms for $\\alpha = 0$ to avoid division by zero in closed-form integrals.\n\nTest suite:\nYou must implement and evaluate the following three test cases, which cover a general case, a near-degenerate phase case, and a near-boundary geometry case. For each case, compute and return:\n- The real and imaginary parts of $E(c)$,\n- The real and imaginary parts of $\\frac{\\partial E}{\\partial r}$ and $\\frac{\\partial E}{\\partial \\beta}$,\n- The real-valued gradients $\\frac{\\partial J}{\\partial r}$ and $\\frac{\\partial J}{\\partial \\beta}$,\n- The updated parameters $r_{\\text{new}}$ and $\\beta_{\\text{new}}$ after one gradient step.\n\nUse the following parameters for each case:\n1. Case $1$ (general): $\\lambda = 0.3\\ \\mathrm{m}$, $L = 1.0\\ \\mathrm{m}$, $r = 0.01\\ \\mathrm{m}$, $\\beta = 0.2\\ \\mathrm{rad}$, $\\chi_i = 0.3\\ \\mathrm{rad}$, $\\chi_o = 1.0\\ \\mathrm{rad}$, $\\eta = 0.05$.\n2. Case $2$ (near $\\alpha \\approx 0$): $\\lambda = 0.5\\ \\mathrm{m}$, $L = 0.5\\ \\mathrm{m}$, $r = 0.02\\ \\mathrm{m}$, $\\beta = 0.1\\ \\mathrm{rad}$, $\\chi_i = 0.8\\ \\mathrm{rad}$, $\\chi_o = (\\pi - 0.8)\\ \\mathrm{rad}$, $\\eta = 0.1$.\n3. Case $3$ (near $c \\to L$): $\\lambda = 0.25\\ \\mathrm{m}$, $L = 0.4\\ \\mathrm{m}$, $r = 0.39\\ \\mathrm{m}$, $\\beta = 0.99\\ \\mathrm{rad}$, $\\chi_i = 0.5\\ \\mathrm{rad}$, $\\chi_o = 0.6\\ \\mathrm{rad}$, $\\eta = 0.02$.\n\nFinal output format:\nYour program should produce a single line of output containing the results for all three test cases as a comma-separated list enclosed in square brackets. Each test case’s result must itself be a list containing ten floats in the order $[\\Re\\{E\\},\\Im\\{E\\},\\Re\\{\\partial E/\\partial r\\},\\Im\\{\\partial E/\\partial r\\},\\Re\\{\\partial E/\\partial \\beta\\},\\Im\\{\\partial E/\\partial \\beta\\},\\partial J/\\partial r,\\partial J/\\partial \\beta,r_{\\text{new}},\\beta_{\\text{new}}]$. Thus, the program prints a list of three lists, one per case, for example\n$$\n\\big[ [\\dots],[\\dots],[\\dots] \\big].\n$$", "solution": "The problem requires a series of derivations followed by a numerical implementation to perform a single step of gradient-based shape optimization for a diffractive edge.\n\n### Derivation and Methodology\n\n**1. PTD Edge Integral Model Justification**\n\nThe problem's integral model for the diffracted field $E(c)$ is a standard simplification in the Physical Theory of Diffraction (PTD).\n- In the high-frequency limit, the total scattered field is decomposed into a Geometrical Optics (GO) component and a diffracted component. PTD models the diffracted component as radiation from equivalent \"fringe\" currents localized on the scatterer's edges.\n- For a straight edge illuminated by a plane wave $\\vec{E}^i(\\vec{r}) = \\vec{E}_0 \\exp(-j k \\hat{u}_i \\cdot \\vec{r})$, the induced PTD edge current takes the form $\\vec{I}(s) \\propto \\exp(-j k u_{i,z} s)$, where $s$ is the coordinate along the edge.\n- According to the Huygens-Fresnel principle, each point on the edge radiates a spherical wave. In the far-field, the path length from a point $s$ on the edge to a distant observer adds a phase factor of $\\exp(-j k u_{o,z} s)$.\n- The combined phase variation in the far-field radiation integral is the product of these two exponential terms: $\\exp(-j k u_{i,z} s) \\exp(-j k u_{o,z} s) = \\exp(-j k (u_{i,z} + u_{o,z}) s) = \\exp(-j k \\alpha s)$.\n- The given integral, $E(c) = \\int_{-L}^{-c} f(s)\\,\\mathrm{d}s + \\int_{c}^{L} f(s)\\,\\mathrm{d}s$, correctly represents the total field from the two edge segments that remain after the central portion $|s|<c$ has been removed by the chamfer.\n\n**2. Analytical Evaluation of $E(c)$**\n\nThe integrand is $f(s) = \\exp(-j k \\alpha s)$. By exploiting the symmetry of the integration domain (substituting $s' = -s$ in the first integral), $E(c)$ can be simplified:\n$$\nE(c) = \\int_{c}^{L} \\exp(j k \\alpha s)\\,\\mathrm{d}s + \\int_{c}^{L} \\exp(-j k \\alpha s)\\,\\mathrm{d}s = \\int_{c}^{L} 2\\cos(k \\alpha s)\\,\\mathrm{d}s\n$$\n- For the general case where $\\alpha \\neq 0$, the integral evaluates to:\n$$\nE(c) = \\left[ \\frac{2\\sin(k \\alpha s)}{k \\alpha} \\right]_{c}^{L} = \\frac{2}{k \\alpha} \\left( \\sin(k \\alpha L) - \\sin(k \\alpha c) \\right)\n$$\nThis result is purely real, so $\\Re\\{E(c)\\} = E(c)$ and $\\Im\\{E(c)\\} = 0$.\n- For the special case where $\\alpha = 0$, the integrand is $f(s) = 1$, and the integral simplifies to:\n$$\nE(c) = \\int_{-L}^{-c} 1\\,\\mathrm{d}s + \\int_{c}^{L} 1\\,\\mathrm{d}s = (L-c) + (L-c) = 2(L-c)\n$$\n\n**3. Shape Derivatives of the Field $E(c)$**\n\nUsing the Leibniz integral rule on the definition of $E(c)$:\n$$\n\\frac{\\mathrm{d}E}{\\mathrm{d}c} = \\frac{\\mathrm{d}}{\\mathrm{d}c}\\left(\\int_{-L}^{-c} f(s)\\,\\mathrm{d}s + \\int_{c}^{L} f(s)\\,\\mathrm{d}s\\right) = f(-c) \\cdot (-1) - f(c) \\cdot 1 = -f(-c) - f(c)\n$$\nSubstituting $f(s) = \\exp(-j k \\alpha s)$:\n$$\n\\frac{\\mathrm{d}E}{\\mathrm{d}c} = -\\exp(j k \\alpha c) - \\exp(-j k \\alpha c) = -2\\cos(k \\alpha c)\n$$\nThis derivative is also purely real. Using the chain rule with $c(r, \\beta) = r\\beta$:\n$$\n\\frac{\\partial E}{\\partial r} = \\frac{\\mathrm{d}E}{\\mathrm{d}c} \\frac{\\partial c}{\\partial r} = (-2\\cos(k \\alpha c)) \\beta\n$$\n$$\n\\frac{\\partial E}{\\partial \\beta} = \\frac{\\mathrm{d}E}{\\mathrm{d}c} \\frac{\\partial c}{\\partial \\beta} = (-2\\cos(k \\alpha c)) r\n$$\n\n**4. Gradient of the Objective Function $J(c)$**\n\nThe objective function is $J(c) = |E(c)|^2$. Since $E(c)$ is purely real, $J(c) = (E(c))^2$. Its gradient components are:\n$$\n\\frac{\\partial J}{\\partial r} = 2E \\frac{\\partial E}{\\partial r}\n$$\n$$\n\\frac{\\partial J}{\\partial \\beta} = 2E \\frac{\\partial E}{\\partial \\beta}\n$$\n\n**5. Gradient Descent Step and Clipping**\n\nThe parameters $(r, \\beta)$ are updated via one step of gradient descent:\n$$\nr_{\\text{new}}' = r - \\eta \\frac{\\partial J}{\\partial r} \\quad \\text{and} \\quad \\beta_{\\text{new}}' = \\beta - \\eta \\frac{\\partial J}{\\partial \\beta}\n$$\nThese updated values are then clipped to enforce the given constraints:\n1. $r_{\\text{new}} = \\max(0, r_{\\text{new}}')$\n2. $\\beta_{\\text{new}} = \\max(0, \\min(\\frac{\\pi}{2}, \\beta_{\\text{new}}'))$\n3. If $r_{\\text{new}} > 0$ and $r_{\\text{new}} \\beta_{\\text{new}} > L$, then update $\\beta_{\\text{new}} = L / r_{\\text{new}}$.\n\nThis framework provides all the necessary formulas for the implementation.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the PTD shape optimization problem for the given test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (general)\n        {'lambda_': 0.3, 'L': 1.0, 'r': 0.01, 'beta': 0.2, 'chi_i': 0.3, 'chi_o': 1.0, 'eta': 0.05},\n        # Case 2 (near alpha = 0)\n        {'lambda_': 0.5, 'L': 0.5, 'r': 0.02, 'beta': 0.1, 'chi_i': 0.8, 'chi_o': np.pi - 0.8, 'eta': 0.1},\n        # Case 3 (near c -> L)\n        {'lambda_': 0.25, 'L': 0.4, 'r': 0.39, 'beta': 0.99, 'chi_i': 0.5, 'chi_o': 0.6, 'eta': 0.02}\n    ]\n\n    results = []\n    \n    for params in test_cases:\n        # Unpack parameters\n        lambda_ = params['lambda_']\n        L = params['L']\n        r = params['r']\n        beta = params['beta']\n        chi_i = params['chi_i']\n        chi_o = params['chi_o']\n        eta = params['eta']\n\n        # 1. Calculate constants\n        k = 2 * np.pi / lambda_\n        u_i_z = np.cos(chi_i)\n        u_o_z = np.cos(chi_o)\n        alpha = u_i_z + u_o_z\n        c = r * beta\n\n        # 2. Calculate E(c)\n        # Handle the case alpha = 0 numerically safely\n        if np.abs(alpha) < 1e-9:\n            E_re = 2 * (L - c)\n        else:\n            E_re = (2 / (k * alpha)) * (np.sin(k * alpha * L) - np.sin(k * alpha * c))\n        E_im = 0.0\n\n        # 3. Calculate derivatives of E\n        # Handle the case alpha = 0 numerically safely\n        if np.abs(alpha) < 1e-9:\n            dE_dc = -2.0\n        else:\n            dE_dc = -2 * np.cos(k * alpha * c)\n            \n        dE_dr_re = dE_dc * beta\n        dE_dr_im = 0.0\n        \n        dE_dbeta_re = dE_dc * r\n        dE_dbeta_im = 0.0\n\n        # 4. Calculate gradient of J\n        # Since E is real, J = E^2, so grad_J = 2*E*grad_E\n        # Note: E is complex in Numpy, so we use E.real\n        dJ_dr = 2 * E_re * dE_dr_re\n        dJ_dbeta = 2 * E_re * dE_dbeta_re\n\n        # 5. Perform gradient descent step\n        r_new_prime = r - eta * dJ_dr\n        beta_new_prime = beta - eta * dJ_dbeta\n\n        # 6. Apply clipping for constraints\n        # r >= 0\n        r_new = max(0.0, r_new_prime)\n        \n        # 0 <= beta <= pi/2\n        beta_new = max(0.0, min(np.pi / 2, beta_new_prime))\n        \n        # c(r, beta) <= L\n        # This is enforced by further clipping one of the parameters.\n        # We clip beta based on the new r.\n        # This handles the case r_new=0 correctly (c_new=0 <= L).\n        if r_new > 0 and r_new * beta_new > L:\n            beta_new = L / r_new\n\n        # 7. Collect and store results\n        case_result = [\n            E_re, E_im,\n            dE_dr_re, dE_dr_im,\n            dE_dbeta_re, dE_dbeta_im,\n            dJ_dr, dJ_dbeta,\n            r_new, beta_new\n        ]\n        results.append(case_result)\n\n    # Format the final output as a string representing a list of lists.\n    # Ex: [[v1, v2,...], [v1, v2,...]]\n    outer_list = []\n    for res_list in results:\n        inner_list = \",\".join(f\"{v:.15g}\" for v in res_list)\n        outer_list.append(f\"[{inner_list}]\")\n    final_output = f\"[{','.join(outer_list)}]\"\n    \n    print(final_output)\n\nsolve()\n```", "id": "3340641"}]}