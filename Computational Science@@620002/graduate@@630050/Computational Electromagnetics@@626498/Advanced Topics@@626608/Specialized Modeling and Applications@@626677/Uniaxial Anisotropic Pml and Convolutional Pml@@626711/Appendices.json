{"hands_on_practices": [{"introduction": "Before implementing any numerical scheme, it is critical to understand its stability limits. This practice guides you through an analytical derivation of the Courant–Friedrichs–Lewy (CFL) condition for a Uniaxial Perfectly Matched Layer (UPML), connecting the abstract PML parameters to the concrete and critical choice of the simulation time step, $\\Delta t$. By performing this analysis, you will gain insight into how the effective wave speed within the PML governs the maximum stable time step, a fundamental constraint in FDTD simulations [@problem_id:3358766].", "problem": "Consider a three-dimensional Finite-Difference Time-Domain (FDTD) scheme on a uniform Yee grid with spacings $\\Delta x$, $\\Delta y$, and $\\Delta z$, implementing a Uniaxial Perfectly Matched Layer (UPML) that is described by complex coordinate stretching. The underlying physics is governed by Maxwell’s equations in linear media, namely $\\nabla \\times \\mathbf{E} = -\\partial \\mathbf{B}/\\partial t$, $\\nabla \\times \\mathbf{H} = \\partial \\mathbf{D}/\\partial t$, and the constitutive relations $\\mathbf{D} = \\overline{\\overline{\\epsilon}}\\,\\mathbf{E}$, $\\mathbf{B} = \\overline{\\overline{\\mu}}\\,\\mathbf{H}$, with the speed of light in vacuum $c = 1/\\sqrt{\\epsilon_{0}\\mu_{0}}$. In the UPML, the material tensors $\\overline{\\overline{\\epsilon}}$ and $\\overline{\\overline{\\mu}}$ are induced by a diagonal complex-stretching operator $\\overline{\\overline{s}} = \\mathrm{diag}(s_{x}, s_{y}, s_{z})$ according to\n$$\n\\overline{\\overline{\\epsilon}} = \\epsilon_{0}\\,\\epsilon_{r}\\,\\mathrm{diag}\\!\\left(\\frac{s_{y}s_{z}}{s_{x}},\\,\\frac{s_{x}s_{z}}{s_{y}},\\,\\frac{s_{x}s_{y}}{s_{z}}\\right), \\quad\n\\overline{\\overline{\\mu}} = \\mu_{0}\\,\\mu_{r}\\,\\mathrm{diag}\\!\\left(\\frac{s_{y}s_{z}}{s_{x}},\\,\\frac{s_{x}s_{z}}{s_{y}},\\,\\frac{s_{x}s_{y}}{s_{z}}\\right).\n$$\nAssume a homogeneous UPML region with constant diagonal stretching factors modeled in the Convolutional Perfectly Matched Layer (CPML) form\n$$\ns_{i}(\\omega) = \\kappa_{i} + \\frac{\\sigma_{i}}{j\\omega\\epsilon_{0}} + j\\frac{\\alpha_{i}}{\\omega}, \\quad i \\in \\{x,y,z\\},\n$$\nwhere $\\kappa_{i} \\geq 1$, $\\sigma_{i} \\geq 0$, and $\\alpha_{i} \\geq 0$ are constants. Using a discrete plane-wave (von Neumann) analysis of the Yee scheme and the above anisotropic constitutive relations, derive the Courant–Friedrichs–Lewy (CFL) stability bound on the time step $\\Delta t$ that guarantees absolute stability for all resolvable discrete spatial frequencies in the homogeneous UPML. Explicitly show how the diagonal stretching magnitudes $|s_{i}(\\omega)|$ enter the bound through effective wave speeds, and argue how the loss terms $\\sigma_{i}$ and $\\alpha_{i}$ influence the final constraint on $\\Delta t$.\n\nProvide the final closed-form expression for the maximum stable time step $\\Delta t_{\\max}$ in terms of $c$, $\\Delta x$, $\\Delta y$, $\\Delta z$, and the $\\kappa_{i}$ that is guaranteed uniformly over frequency in this homogeneous UPML. Express the time-step limit in seconds. No rounding is required.", "solution": "The problem requires the derivation of the Courant–Friedrichs–Lewy (CFL) stability bound for a three-dimensional Finite-Difference Time-Domain (FDTD) scheme in a Uniaxial Perfectly Matched Layer (UPML) described by complex coordinate stretching. The analysis will be performed using a discrete plane-wave (von Neumann) stability analysis.\n\nThe governing equations in the frequency domain, after applying the stretched-coordinate transformation implicitly defined by the given anisotropic tensors, lead to the dispersion relation for a continuous plane wave $\\mathbf{E} = \\mathbf{E}_{0} \\exp(j\\omega t - j\\mathbf{k} \\cdot \\mathbf{r})$:\n$$\n\\frac{k_{x}^{2}}{s_{x}(\\omega)^{2}} + \\frac{k_{y}^{2}}{s_{y}(\\omega)^{2}} + \\frac{k_{z}^{2}}{s_{z}(\\omega)^{2}} = \\omega^{2}\\mu_{0}\\mu_{r}\\epsilon_{0}\\epsilon_{r} = \\frac{\\omega^{2}}{v_{m}^{2}}\n$$\nwhere $k_{x}$, $k_{y}$, $k_{z}$ are the components of the wave vector $\\mathbf{k}$, $\\omega$ is the angular frequency, and $v_{m} = 1/\\sqrt{\\mu_{0}\\mu_{r}\\epsilon_{0}\\epsilon_{r}} = c/\\sqrt{\\mu_{r}\\epsilon_{r}}$ is the speed of light in the background medium. The problem asks for the final expression in terms of $c$, which implies the background medium is a vacuum, so $\\epsilon_{r}=1$, $\\mu_{r}=1$, and $v_{m}=c$.\n\nThe FDTD method discretizes both space and time. In a von Neumann analysis, we examine the behavior of a single discrete plane-wave mode on the Yee grid. This analysis leads to a numerical dispersion relation by replacing the continuous derivative operators with their finite-difference counterparts. For a central-difference scheme on a uniform grid, these replacements are:\n$$\n\\frac{\\partial}{\\partial t} \\rightarrow \\frac{Z^{1/2} - Z^{-1/2}}{\\Delta t} \\quad \\text{or} \\quad \\omega \\rightarrow \\tilde{\\omega} = \\frac{2}{\\Delta t} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right)\n$$\n$$\n\\frac{\\partial}{\\partial i} \\rightarrow \\frac{e^{-j k_{i} \\Delta i/2} - e^{j k_{i} \\Delta i/2}}{\\Delta i} \\quad \\text{or} \\quad k_{i} \\rightarrow \\tilde{k}_{i} = \\frac{2}{\\Delta i} \\sin\\left(\\frac{k_{i} \\Delta i}{2}\\right) \\quad \\text{for } i \\in \\{x, y, z\\}\n$$\nwhere $Z = \\exp(j\\omega\\Delta t)$ is the amplification factor and $\\Delta t, \\Delta x, \\Delta y, \\Delta z$ are the temporal and spatial step sizes.\n\nThe stability of a numerical scheme for a dispersive medium, such as the CPML, is determined by the high-frequency response of the medium. The CFL condition is a constraint on the maximum speed of information propagation on the grid. This speed is governed by the properties of the medium in the limit of infinite frequency ($\\omega \\rightarrow \\infty$), which corresponds to the instantaneous response. Causal material models, including valid PML formulations, must have their dispersive characteristics vanish at infinite frequency.\n\nWe are given the complex stretching factor:\n$$\ns_{i}(\\omega) = \\kappa_{i} + \\frac{\\sigma_{i}}{j\\omega\\epsilon_{0}} + j\\frac{\\alpha_{i}}{\\omega}\n$$\nIn the high-frequency limit, we have:\n$$\n\\lim_{\\omega\\to\\infty} s_{i}(\\omega) = \\lim_{\\omega\\to\\infty} \\left( \\kappa_{i} + \\frac{\\sigma_{i}}{j\\omega\\epsilon_{0}} + j\\frac{\\alpha_{i}}{\\omega} \\right) = \\kappa_{i}\n$$\nsince the terms containing $\\omega$ in the denominator vanish. Thus, for the purpose of determining the CFL stability bound, the UPML behaves as a simple non-dispersive anisotropic medium with real stretching factors $s_{i} = \\kappa_{i}$.\n\nThe influence of the loss parameters $\\sigma_{i}$ and $\\alpha_{i}$ must be considered. These parameters control the absorption properties of the PML. The stretching factor can be written as $s_{i}(\\omega) = \\kappa_{i} + j\\frac{1}{\\omega}(\\alpha_{i} - \\frac{\\sigma_{i}}{\\epsilon_{0}})$. For a plane wave $\\exp(j(k_0 s_i x - \\omega t))$ propagating in the positive $i$-direction to be attenuated, the imaginary part of its exponent must be negative. This means $\\Im(j k_0 s_i x)  0$, which for real $k_0, x$ implies $\\Re(s_i) > 0$ and $\\Im(s_i)>0$. The imaginary part of $s_i$ is $\\Im(s_i) = \\frac{1}{\\omega}(\\alpha_{i} - \\frac{\\sigma_{i}}{\\epsilon_0})$. For attenuation (assuming $\\omega > 0$), this requires $\\alpha_{i} > \\sigma_{i}/\\epsilon_{0}$. If this passivity condition is violated, the PML could act as a gain medium, leading to an unconditional instability regardless of the choice of $\\Delta t$. Assuming the PML is properly designed to be passive, the loss terms introduce damping into the system. Damping can only make the FDTD scheme more stable (i.e., reduce the magnitude of the amplification factor $|Z|$); it cannot make the stability condition on $\\Delta t$ more restrictive. Therefore, the stability bound is determined by the worst-case, lossless scenario, which corresponds to the high-frequency limit where $s_{i}=\\kappa_{i}$.\n\nSubstituting the high-frequency stretching factors $s_{i} = \\kappa_{i}$ and the FDTD numerical operators into the continuous dispersion relation, we obtain the numerical dispersion relation for the system:\n$$\n\\frac{1}{c^{2}} \\left( \\frac{2}{\\Delta t} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) \\right)^{2} = \\frac{1}{\\kappa_{x}^{2}} \\left( \\frac{2}{\\Delta x} \\sin\\left(\\frac{k_{x} \\Delta x}{2}\\right) \\right)^{2} + \\frac{1}{\\kappa_{y}^{2}} \\left( \\frac{2}{\\Delta y} \\sin\\left(\\frac{k_{y} \\Delta y}{2}\\right) \\right)^{2} + \\frac{1}{\\kappa_{z}^{2}} \\left( \\frac{2}{\\Delta z} \\sin\\left(\\frac{k_{z} \\Delta z}{2}\\right) \\right)^{2}\n$$\nSolving for $\\sin^{2}(\\omega \\Delta t/2)$:\n$$\n\\sin^{2}\\left(\\frac{\\omega \\Delta t}{2}\\right) = (c \\Delta t)^{2} \\left[ \\frac{\\sin^{2}\\left(\\frac{k_{x} \\Delta x}{2}\\right)}{(\\kappa_{x}\\Delta x)^{2}} + \\frac{\\sin^{2}\\left(\\frac{k_{y} \\Delta y}{2}\\right)}{(\\kappa_{y}\\Delta y)^{2}} + \\frac{\\sin^{2}\\left(\\frac{k_{z} \\Delta z}{2}\\right)}{(\\kappa_{z}\\Delta z)^{2}} \\right]\n$$\nFor a stable scheme, any solution for $\\omega$ corresponding to real-valued spatial frequencies ($k_{x}, k_{y}, k_{z}$) must have a non-positive imaginary part, $\\Im(\\omega) \\le 0$. This ensures that the amplification factor $|Z| = |\\exp(j\\omega\\Delta t)| = \\exp(-\\Im(\\omega)\\Delta t) \\le 1$. A sufficient condition for this is to demand that for any real values of $k_{x}, k_{y}, k_{z}$, the computed $\\omega$ is real. This requires that the right-hand side of the equation for $\\sin^{2}(\\omega \\Delta t/2)$ must be less than or equal to $1$.\n\nTo find the most restrictive condition on $\\Delta t$, we must maximize the right-hand side with respect to the spatial wave numbers. The sine terms are maximized when their argument is an odd multiple of $\\pi/2$, which makes $\\sin^{2}(\\cdot) = 1$. This corresponds to the highest spatial frequencies resolvable by the grid (the Nyquist frequency).\n$$\n\\max_{k_x, k_y, k_z} \\left[ \\dots \\right] = \\frac{1}{(\\kappa_{x}\\Delta x)^{2}} + \\frac{1}{(\\kappa_{y}\\Delta y)^{2}} + \\frac{1}{(\\kappa_{z}\\Delta z)^{2}}\n$$\nSubstituting this maximum value into the stability inequality:\n$$\n1 \\ge (c \\Delta t)^{2} \\left[ \\frac{1}{(\\kappa_{x}\\Delta x)^{2}} + \\frac{1}{(\\kappa_{y}\\Delta y)^{2}} + \\frac{1}{(\\kappa_{z}\\Delta z)^{2}} \\right]\n$$\nSolving for $\\Delta t$ gives the stability limit:\n$$\n(\\Delta t)^{2} \\le \\frac{1}{c^{2} \\left[ \\left(\\frac{1}{\\kappa_{x} \\Delta x}\\right)^{2} + \\left(\\frac{1}{\\kappa_{y} \\Delta y}\\right)^{2} + \\left(\\frac{1}{\\kappa_{z} \\Delta z}\\right)^{2} \\right]}\n$$\nThe maximum stable time step, $\\Delta t_{\\max}$, is thus:\n$$\n\\Delta t_{\\max} = \\frac{1}{c \\sqrt{\\left(\\frac{1}{\\kappa_{x} \\Delta x}\\right)^{2} + \\left(\\frac{1}{\\kappa_{y} \\Delta y}\\right)^{2} + \\left(\\frac{1}{\\kappa_{z} \\Delta z}\\right)^{2}}}\n$$\nThis expression provides the CFL stability bound uniformly over all frequencies and for all resolvable wave propagation angles within the homogeneous UPML, given the parameters are chosen such that the medium is passive. The final unit for $\\Delta t$ is seconds, assuming $c$ is in meters per second and $\\Delta x, \\Delta y, \\Delta z$ are in meters.", "answer": "$$\\boxed{\\frac{1}{c \\sqrt{\\left(\\frac{1}{\\kappa_{x} \\Delta x}\\right)^{2} + \\left(\\frac{1}{\\kappa_{y} \\Delta y}\\right)^{2} + \\left(\\frac{1}{\\kappa_{z} \\Delta z}\\right)^{2}}}}$$", "id": "3358766"}, {"introduction": "Building on theoretical stability analysis, this practice transitions to the direct numerical verification of a Convolutional PML (CPML) implementation. You will construct the system's one-step update matrix and analyze its eigenvalues, a cornerstone of numerical stability analysis. This hands-on coding exercise provides a definitive method to confirm that your time-stepping algorithm is stable and that the PML acts as a passive, energy-absorbing medium [@problem_id:3358782].", "problem": "Consider the one-dimensional Finite-Difference Time-Domain (FDTD) scheme for Maxwell’s equations with a Convolutional Perfectly Matched Layer (CPML), which is the time-domain equivalent of the Uniaxial Anisotropic Perfectly Matched Layer (UA-PML). The electromagnetic fields are updated on a staggered time grid: the electric field $E$ at integer time indices $n$ and the magnetic field $H$ at half-integer time indices $n+\\tfrac{1}{2}$. Assume an $x$-directed CPML with unsplit-field formulation implemented via memory variables. For a single spatial Fourier harmonic with angular wavenumber $k$ (in radians per meter), the discrete spatial derivative can be represented as multiplication by the complex factor $J$, where $J = \\mathrm{i} S$ and $S = \\tfrac{2}{\\Delta x} \\sin\\!\\big(\\tfrac{k \\Delta x}{2}\\big)$.\n\nLet $\\epsilon$ be the permittivity (in farads per meter), $\\mu$ be the permeability (in henries per meter), and define the speed of light $c = \\tfrac{1}{\\sqrt{\\mu \\epsilon}}$. Let the time step be $\\Delta t$ and the spatial step be $\\Delta x$, with the Courant condition $\\Delta t = 0.99 \\,\\tfrac{\\Delta x}{c}$ enforced. The CPML uses parameters $\\sigma$ (in reciprocal seconds), $\\kappa$ (dimensionless), and $\\alpha$ (in reciprocal seconds) to define the coordinate-stretching operator. The associated memory-variable recursion coefficients are\n$$\nb = \\exp\\!\\Big(-\\big(\\tfrac{\\sigma}{\\kappa} + \\alpha\\big) \\Delta t\\Big), \\quad\nc = \\frac{\\sigma}{\\sigma \\kappa + \\kappa^2 \\alpha} \\, (b - 1).\n$$\n\nIn one dimension, the CPML modifies the effective discrete flux through auxiliary memory variables $\\psi_E$ and $\\psi_H$ corresponding to the $x$-derivative contributions. Using the Fourier representation for the spatial derivative, the update equations for a single harmonic are linear and given by\n$$\nH^{n+\\frac{1}{2}} = H^{n-\\frac{1}{2}} - \\frac{\\Delta t}{\\mu} \\left( \\frac{1}{\\kappa} J E^n + \\psi_E^n \\right),\n$$\n$$\n\\psi_H^{n+\\frac{1}{2}} = b \\, \\psi_H^{n-\\frac{1}{2}} + c \\, J \\, H^{n+\\frac{1}{2}},\n$$\n$$\nE^{n+1} = E^n - \\frac{\\Delta t}{\\epsilon} \\left( \\frac{1}{\\kappa} J H^{n+\\frac{1}{2}} + \\psi_H^{n+\\frac{1}{2}} \\right),\n$$\n$$\n\\psi_E^{n+1} = b \\, \\psi_E^n + c \\, J \\, E^{n+1}.\n$$\nThese relations define a linear update map from the state vector at time $n$,\n$$\n\\mathbf{x}^n = \\begin{bmatrix} E^n \\\\ H^{n-\\frac{1}{2}} \\\\ \\psi_E^n \\\\ \\psi_H^{n-\\frac{1}{2}} \\end{bmatrix},\n$$\nto the state vector at time $n+1$,\n$$\n\\mathbf{x}^{n+1} = \\begin{bmatrix} E^{n+1} \\\\ H^{n+\\frac{1}{2}} \\\\ \\psi_E^{n+1} \\\\ \\psi_H^{n+\\frac{1}{2}} \\end{bmatrix} = \\mathbf{A} \\, \\mathbf{x}^n,\n$$\nfor some $4 \\times 4$ complex matrix $\\mathbf{A}$ determined by $\\epsilon$, $\\mu$, $\\Delta x$, $\\Delta t$, $k$, $\\sigma$, $\\kappa$, and $\\alpha$. The goal is to construct $\\mathbf{A}$ explicitly and compute its eigenvalues for selected parameter sets.\n\nStarting from Maxwell’s equations and the UA-PML complex coordinate stretching, derive the above discrete update in the Fourier-harmonic setting and assemble the explicit linear update matrix $\\mathbf{A}$. Then, for a set of scientifically plausible parameter values, compute the eigenvalues of $\\mathbf{A}$ and verify that they lie strictly inside the unit circle in the complex plane.\n\nAll quantities must be interpreted in the International System of Units (SI): distances in meters, times in seconds, permittivity in farads per meter, permeability in henries per meter, and angular wavenumber $k$ in radians per meter. Angles, if any, must be in radians. The verification for each test case must return a boolean indicating whether all eigenvalues satisfy $|\\lambda|  1$.\n\nUse the following test suite of parameter values:\n1. Case 1 (happy path, moderate damping, near-Nyquist spatial harmonic): $\\epsilon = \\epsilon_0$, $\\mu = \\mu_0$, $\\Delta x = 1.0 \\times 10^{-3}$, $\\Delta t = 0.99 \\,\\tfrac{\\Delta x}{c}$, $k = 0.9 \\,\\tfrac{\\pi}{\\Delta x}$, $\\sigma = 5.0 \\times 10^{10}$, $\\kappa = 3.0$, $\\alpha = 2.0 \\times 10^{9}$.\n2. Case 2 (strong damping, worst-case Nyquist harmonic): $\\epsilon = \\epsilon_0$, $\\mu = \\mu_0$, $\\Delta x = 1.0 \\times 10^{-3}$, $\\Delta t = 0.99 \\,\\tfrac{\\Delta x}{c}$, $k = \\tfrac{\\pi}{\\Delta x}$, $\\sigma = 1.0 \\times 10^{10}$, $\\kappa = 1.5$, $\\alpha = 1.0 \\times 10^{9}$.\n3. Case 3 (smaller spatial step, high damping, mid-band harmonic): $\\epsilon = \\epsilon_0$, $\\mu = \\mu_0$, $\\Delta x = 5.0 \\times 10^{-4}$, $\\Delta t = 0.99 \\,\\tfrac{\\Delta x}{c}$, $k = \\tfrac{\\pi}{2 \\Delta x}$, $\\sigma = 3.0 \\times 10^{10}$, $\\kappa = 2.5$, $\\alpha = 5.0 \\times 10^{9}$.\n4. Case 4 (larger $\\kappa$ with moderate damping, low-frequency harmonic): $\\epsilon = \\epsilon_0$, $\\mu = \\mu_0$, $\\Delta x = 2.0 \\times 10^{-3}$, $\\Delta t = 0.99 \\,\\tfrac{\\Delta x}{c}$, $k = 0.2 \\,\\tfrac{\\pi}{\\Delta x}$, $\\sigma = 8.0 \\times 10^{10}$, $\\kappa = 4.0$, $\\alpha = 1.0 \\times 10^{9}$.\n\nHere $\\epsilon_0$ and $\\mu_0$ denote the vacuum permittivity and vacuum permeability, respectively, and $c = \\tfrac{1}{\\sqrt{\\mu_0 \\epsilon_0}}$.\n\nYour program must:\n- Construct the matrix $\\mathbf{A}$ for each case,\n- Compute its eigenvalues,\n- Determine whether all eigenvalues satisfy $|\\lambda|  1$,\n- Produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, `[result1,result2,result3,result4]`, where each result is a boolean.\n\nNo external input is allowed. The output must be exactly one line in the specified format.", "solution": "The user-provided problem is assessed to be valid. It is scientifically grounded in the principles of computational electromagnetics, specifically the Finite-Difference Time-Domain (FDTD) method with Convolutional Perfectly Matched Layer (CPML) absorbers. The problem is well-posed, providing a complete set of equations and parameters to construct a linear system and analyze its stability, which is a standard procedure in numerical analysis of partial differential equations. The parameters and constants are physically realistic and dimensionally consistent.\n\nThe core of the problem is to determine the stability of the given FDTD-CPML scheme for a single spatial Fourier harmonic. Stability is governed by the eigenvalues of the linear update matrix $\\mathbf{A}$, which maps the state of the system from one time step to the next. For the numerical solution to remain bounded, all eigenvalues $\\lambda$ of $\\mathbf{A}$ must satisfy $|\\lambda| \\le 1$. For a dissipative system like a PML, which is designed to absorb outgoing waves, we expect the eigenvalues to lie strictly inside the unit circle, i.e., $|\\lambda|  1$.\n\nThe derivation of the update matrix $\\mathbf{A}$ is as follows. The state of the system is defined by the vector:\n$$\n\\mathbf{x}^n = \\begin{bmatrix} E^n \\\\ H^{n-\\frac{1}{2}} \\\\ \\psi_E^n \\\\ \\psi_H^{n-\\frac{1}{2}} \\end{bmatrix}\n$$\nThe state at the next time step is given by:\n$$\n\\mathbf{x}^{n+1} = \\begin{bmatrix} E^{n+1} \\\\ H^{n+\\frac{1}{2}} \\\\ \\psi_E^{n+1} \\\\ \\psi_H^{n+\\frac{1}{2}} \\end{bmatrix} = \\mathbf{A} \\, \\mathbf{x}^n\n$$\nOur goal is to find the $4 \\times 4$ complex matrix $\\mathbf{A}$ by expressing each component of $\\mathbf{x}^{n+1}$ as a linear combination of the components of $\\mathbf{x}^n$. We use the four update equations provided:\n1.  $H^{n+\\frac{1}{2}} = H^{n-\\frac{1}{2}} - \\frac{\\Delta t}{\\mu} \\left( \\frac{1}{\\kappa} J E^n + \\psi_E^n \\right)$\n2.  $\\psi_H^{n+\\frac{1}{2}} = b \\, \\psi_H^{n-\\frac{1}{2}} + c \\, J \\, H^{n+\\frac{1}{2}}$\n3.  $E^{n+1} = E^n - \\frac{\\Delta t}{\\epsilon} \\left( \\frac{1}{\\kappa} J H^{n+\\frac{1}{2}} + \\psi_H^{n+\\frac{1}{2}} \\right)$\n4.  $\\psi_E^{n+1} = b \\, \\psi_E^n + c \\, J \\, E^{n+1}$\n\nThe discrete spatial derivative operator for a single Fourier harmonic with wavenumber $k$ is $J = \\mathrm{i} S$, where $S = \\frac{2}{\\Delta x} \\sin(\\frac{k \\Delta x}{2})$. The CPML coefficients are $b = \\exp(-\\left(\\frac{\\sigma}{\\kappa} + \\alpha\\right) \\Delta t)$ and $c = \\frac{\\sigma}{\\sigma \\kappa + \\kappa^2 \\alpha} (b - 1)$.\n\nLet's derive the rows of $\\mathbf{A}$ corresponding to the components of $\\mathbf{x}^{n+1}$.\n\nFirst, we find the expression for $H^{n+\\frac{1}{2}}$, which corresponds to the second component of $\\mathbf{x}^{n+1}$. Equation (1) is already in the required form:\n$$\nH^{n+\\frac{1}{2}} = \\left(-\\frac{\\Delta t J}{\\mu \\kappa}\\right) E^n + (1) H^{n-\\frac{1}{2}} + \\left(-\\frac{\\Delta t}{\\mu}\\right) \\psi_E^n + (0) \\psi_H^{n-\\frac{1}{2}}\n$$\nThis gives the second row of the matrix $\\mathbf{A}$ (using 1-based indexing for matrix rows/columns):\n$$\n\\mathbf{A}_{2,1} = -\\frac{\\Delta t J}{\\mu \\kappa}, \\quad \\mathbf{A}_{2,2} = 1, \\quad \\mathbf{A}_{2,3} = -\\frac{\\Delta t}{\\mu}, \\quad \\mathbf{A}_{2,4} = 0\n$$\n\nNext, we find the expression for $\\psi_H^{n+\\frac{1}{2}}$ (fourth component of $\\mathbf{x}^{n+1}$). We substitute the expression for $H^{n+\\frac{1}{2}}$ into Equation (2):\n$$\n\\psi_H^{n+\\frac{1}{2}} = b \\, \\psi_H^{n-\\frac{1}{2}} + c \\, J \\, \\left[ \\left(-\\frac{\\Delta t J}{\\mu \\kappa}\\right) E^n + H^{n-\\frac{1}{2}} - \\left(\\frac{\\Delta t}{\\mu}\\right) \\psi_E^n \\right]\n$$\n$$\n\\psi_H^{n+\\frac{1}{2}} = \\left(-\\frac{c \\Delta t J^2}{\\mu \\kappa}\\right) E^n + (c J) H^{n-\\frac{1}{2}} - \\left(\\frac{c \\Delta t J}{\\mu}\\right) \\psi_E^n + (b) \\psi_H^{n-\\frac{1}{2}}\n$$\nThis gives the fourth row of $\\mathbf{A}$:\n$$\n\\mathbf{A}_{4,1} = -\\frac{c \\Delta t J^2}{\\mu \\kappa}, \\quad \\mathbf{A}_{4,2} = c J, \\quad \\mathbf{A}_{4,3} = -\\frac{c \\Delta t J}{\\mu}, \\quad \\mathbf{A}_{4,4} = b\n$$\n\nNow, we find the expression for $E^{n+1}$ (first component of $\\mathbf{x}^{n+1}$). We substitute the expressions for $H^{n+\\frac{1}{2}}$ and $\\psi_H^{n+\\frac{1}{2}}$ (which are rows 2 and 4 of $\\mathbf{A}$ applied to $\\mathbf{x}^n$) into Equation (3):\n$$\nE^{n+1} = E^n - \\frac{\\Delta t}{\\epsilon} \\left( \\frac{1}{\\kappa} J H^{n+\\frac{1}{2}} + \\psi_H^{n+\\frac{1}{2}} \\right)\n= E^n - \\frac{\\Delta t J}{\\epsilon \\kappa} \\left(\\sum_{j=1}^4 \\mathbf{A}_{2,j} x_j^n\\right) - \\frac{\\Delta t}{\\epsilon} \\left(\\sum_{j=1}^4 \\mathbf{A}_{4,j} x_j^n\\right)\n$$\nwhere $x_j^n$ are the components of $\\mathbf{x}^n$. Collecting coefficients of $x_j^n$:\n$$\nE^{n+1} = \\sum_{j=1}^4 \\mathbf{A}_{1,j} x_j^n \\implies \\mathbf{A}_{1,j} = \\delta_{1,j} - \\frac{\\Delta t J}{\\epsilon \\kappa} \\mathbf{A}_{2,j} - \\frac{\\Delta t}{\\epsilon} \\mathbf{A}_{4,j}\n$$\nwhere $\\delta_{1,j}$ is the Kronecker delta. This defines the first row of $\\mathbf{A}$.\n\nFinally, we find the expression for $\\psi_E^{n+1}$ (third component of $\\mathbf{x}^{n+1}$). We substitute the expression for $E^{n+1}$ (row 1 of $\\mathbf{A}$ applied to $\\mathbf{x}^n$) into Equation (4):\n$$\n\\psi_E^{n+1} = b \\, \\psi_E^n + c \\, J \\, E^{n+1} = b \\, \\psi_E^n + c \\, J \\, \\left(\\sum_{j=1}^4 \\mathbf{A}_{1,j} x_j^n\\right)\n$$\nCollecting coefficients of $x_j^n$:\n$$\n\\psi_E^{n+1} = \\sum_{j=1}^4 \\mathbf{A}_{3,j} x_j^n \\implies \\mathbf{A}_{3,j} = b \\delta_{3,j} + c J \\mathbf{A}_{1,j}\n$$\nThis defines the third row of $\\mathbf{A}$.\n\nWith these steps, the complete matrix $\\mathbf{A}$ is constructed. For each test case, we substitute the given parameter values, calculate the numerical entries of $\\mathbf{A}$, compute its four complex eigenvalues $\\lambda_i$, and verify if $|\\lambda_i|  1$ for all $i=1, 2, 3, 4$. The result is a boolean value indicating whether this stability condition is met. The program below implements this procedure for the provided test suite.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Constructs the FDTD-CPML update matrix and checks its stability.\n    \"\"\"\n    # Define physical constants in SI units\n    EPSILON_0 = 8.8541878128e-12  # Vacuum permittivity (F/m)\n    MU_0 = 4 * np.pi * 1e-7      # Vacuum permeability (H/m)\n    C_LIGHT = 1 / np.sqrt(EPSILON_0 * MU_0)  # Speed of light in vacuum (m/s)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: happy path, moderate damping, near-Nyquist\n        {\"dx\": 1.0e-3, \"k_factor\": 0.9, \"sigma\": 5.0e10, \"kappa\": 3.0, \"alpha\": 2.0e9},\n        # Case 2: strong damping, worst-case Nyquist\n        {\"dx\": 1.0e-3, \"k_factor\": 1.0, \"sigma\": 1.0e10, \"kappa\": 1.5, \"alpha\": 1.0e9},\n        # Case 3: smaller spatial step, high damping, mid-band\n        {\"dx\": 5.0e-4, \"k_factor\": 0.5, \"sigma\": 3.0e10, \"kappa\": 2.5, \"alpha\": 5.0e9},\n        # Case 4: larger kappa, moderate damping, low-frequency\n        {\"dx\": 2.0e-3, \"k_factor\": 0.2, \"sigma\": 8.0e10, \"kappa\": 4.0, \"alpha\": 1.0e9},\n    ]\n\n    results = []\n    for case in test_cases:\n        # Material properties (vacuum)\n        eps = EPSILON_0\n        mu = MU_0\n\n        # Discretization parameters\n        dx = case[\"dx\"]\n        dt = 0.99 * dx / C_LIGHT\n        \n        # Spatial Fourier harmonic parameter\n        k = case[\"k_factor\"] * np.pi / dx\n        S = (2 / dx) * np.sin(k * dx / 2)\n        J = 1j * S\n\n        # CPML parameters\n        sigma = case[\"sigma\"]\n        kappa = case[\"kappa\"]\n        alpha = case[\"alpha\"]\n\n        # CPML recursion coefficients\n        b = np.exp(-(sigma / kappa + alpha) * dt)\n        denom_c = sigma * kappa + kappa**2 * alpha\n        c_pml = (sigma / denom_c) * (b - 1) if denom_c != 0 else 0\n\n        # Construct the 4x4 update matrix A\n        # A maps [E^n, H^{n-1/2}, psi_E^n, psi_H^{n-1/2}]^T\n        # to    [E^{n+1}, H^{n+1/2}, psi_E^{n+1}, psi_H^{n+1/2}]^T\n        A = np.zeros((4, 4), dtype=complex)\n\n        # Row 2 (index 1): Update for H^{n+1/2}\n        # H^{n+1/2} = H^{n-1/2} - (dt/mu) * ( (1/kappa)*J*E^n + psi_E^n )\n        A[1, 0] = -dt * J / (mu * kappa) # Coeff of E^n\n        A[1, 1] = 1.0                    # Coeff of H^{n-1/2}\n        A[1, 2] = -dt / mu               # Coeff of psi_E^n\n        A[1, 3] = 0.0                    # Coeff of psi_H^{n-1/2}\n\n        # Row 4 (index 3): Update for psi_H^{n+1/2}\n        # psi_H^{n+1/2} = b*psi_H^{n-1/2} + c_pml*J*H^{n+1/2}\n        # Substitute H^{n+1/2} using the coefficients from row 1\n        A[3, 0] = c_pml * J * A[1, 0]\n        A[3, 1] = c_pml * J * A[1, 1]\n        A[3, 2] = c_pml * J * A[1, 2]\n        A[3, 3] = b + c_pml * J * A[1, 3]\n\n        # Row 1 (index 0): Update for E^{n+1}\n        # E^{n+1} = E^n - (dt/eps) * ( (1/kappa)*J*H^{n+1/2} + psi_H^{n+1/2} )\n        # Substitute H^{n+1/2} and psi_H^{n+1/2} using their coefficients\n        E_coeffs_from_H = -(dt * J / (eps * kappa)) * A[1, :]\n        E_coeffs_from_psiH = -(dt / eps) * A[3, :]\n        A[0, :] = E_coeffs_from_H + E_coeffs_from_psiH\n        A[0, 0] += 1.0 # Add the E^n term\n\n        # Row 3 (index 2): Update for psi_E^{n+1}\n        # psi_E^{n+1} = b*psi_E^n + c_pml*J*E^{n+1}\n        # Substitute E^{n+1} using its coefficients from row 0\n        psiE_coeffs_from_E = c_pml * J * A[0, :]\n        A[2, :] = psiE_coeffs_from_E\n        A[2, 2] += b # Add the b*psi_E^n term\n\n        # Compute eigenvalues of A\n        eigvals = np.linalg.eigvals(A)\n\n        # Check if all eigenvalues are strictly inside the unit circle\n        is_stable = np.all(np.abs(eigvals)  1.0)\n        results.append(is_stable)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(str(r).lower() for r in results)}]\")\n\nsolve()\n```", "id": "3358782"}, {"introduction": "A stable simulation is not necessarily a correct one; it may stably converge to the wrong solution. This final practice introduces the Method of Manufactured Solutions (MMS), a powerful and systematic technique for verifying that your code correctly solves the intended equations. By measuring the residual of a known, exact solution substituted into your discretized equations, you will learn to quantitatively distinguish between expected discretization error and subtle implementation bugs [@problem_id:3358794].", "problem": "Consider one-dimensional transverse electromagnetic propagation in free space along the $x$-axis with electric field $E_y(x,t)$ and magnetic field $H_z(x,t)$. The fundamental base is Maxwell’s curl equations in one spatial dimension for harmonic time dependence $e^{j\\omega t}$, written in the frequency domain as $-\\frac{dH_z}{dx} = j\\omega\\epsilon_0 E_y$ and $\\frac{dE_y}{dx} = -j\\omega\\mu_0 H_z$. A Perfectly Matched Layer (PML) can be modeled by a complex coordinate stretching. In a uniaxial anisotropic Perfectly Matched Layer (UAPML), a uniform complex stretch $s_x$ throughout the domain modifies spatial derivatives by $d/dx \\mapsto \\frac{1}{s_x} d/dx$ while $\\epsilon_0$ and $\\mu_0$ remain unchanged. In a convolutional Perfectly Matched Layer (CPML), the same uniform stretch can be represented for a single frequency by decomposing the stretch into the rational form $s_x = \\kappa_x + \\frac{\\sigma_x}{j\\omega\\epsilon_0} + \\frac{\\alpha_x}{j\\omega}$ where $\\kappa_x$, $\\sigma_x$, and $\\alpha_x$ are real, nonnegative parameters.\n\nYour task is to validate PML implementations by the method of manufactured solutions using a uniform complex stretch throughout the domain and to compute discrete residuals that diagnose discretization versus implementation errors. Proceed as follows:\n\n1. Starting from the fundamental one-dimensional Maxwell curl equations and the replacement $d/dx \\mapsto \\frac{1}{s_x} d/dx$ for a uniform stretch $s_x$, derive a second-order scalar equation for $E_y(x)$ in the stretched medium and identify the wavenumber implied by free-space dispersion. Use only the stated base laws and definitions.\n\n2. Choose a manufactured monochromatic solution that is consistent with the stretched medium and is nontrivial, spatially varying, and smooth. Let the free-space wavenumber be $k_0 = \\omega \\sqrt{\\mu_0 \\epsilon_0}$ and the manufactured electric field be $E_y(x) = E_0 \\exp(-j k_0 s_x x)$ with a real amplitude $E_0 \\neq 0$. Let $H_z(x)$ be the corresponding magnetic field implied by the curl equations in the stretched medium. There is no need to specify $E_0$ since the residual will be normalized.\n\n3. Discretize the second-order equation for $E_y(x)$ on a uniform grid of $N$ points covering a length $L$ with spacing $\\Delta x = L/(N-1)$ using the standard second-order central-difference approximation for $d^2E_y/dx^2$ at interior points. Define the residual at each interior grid point $x_i$ as the left-hand side of the discretized equation evaluated by substituting the manufactured field values. Define the normalized residual as the ratio of the discrete $\\ell_2$ norm of the residual vector to the discrete $\\ell_2$ norm of the manufactured field sampled at interior points. This normalized residual is dimensionless.\n\n4. For UAPML, compute the normalized residual using the correct stretched equation. To emulate an implementation error, compute the normalized residual for a solver that incorrectly scales only one constitutive parameter (equivalently, using $s_x$ to the first power where the correct equation requires $s_x^2$). Compare the magnitudes of the residuals.\n\n5. For CPML, express the same uniform stretch $s_x$ via parameters $\\kappa_x$, $\\sigma_x$, and $\\alpha_x$ at a single frequency. Compute the normalized residual using the correctly assembled $s_x$. To emulate an implementation error in CPML, compute the normalized residual using an incorrect stretch in which the conductivity term is missing the factor $\\epsilon_0$, that is, $s_x^{\\text{wrong}} = \\kappa_x + \\frac{\\sigma_x}{j\\omega}$.\n\nAll physical constants and parameters must be explicitly specified, and the manufactured solution must be evaluated with these values. Use the following test suite, expressed in International System of Units (SI):\n\n- Free-space parameters: $\\mu_0 = 4\\pi \\times 10^{-7}\\ \\mathrm{H/m}$, $\\epsilon_0 = 8.854187817 \\times 10^{-12}\\ \\mathrm{F/m}$.\n- Speed of light: $c_0 = 1/\\sqrt{\\mu_0 \\epsilon_0}$, for verification only if needed.\n- Frequency: $f = 1.0 \\times 10^9\\ \\mathrm{Hz}$, angular frequency $\\omega = 2\\pi f$ in $\\mathrm{rad/s}$.\n- Domain length: $L = 1.0\\ \\mathrm{m}$.\n- Manufactured stretch target: $s_x = 1 - 0.2 j$ (dimensionless).\n- CPML parameters for the correct case: $\\kappa_x = 1.0$, $\\alpha_x = 0.0$, and $\\sigma_x$ chosen such that $\\frac{\\sigma_x}{\\omega \\epsilon_0} = 0.2$, that is, $\\sigma_x = 0.2\\,\\omega\\,\\epsilon_0$ in $\\mathrm{S/m}$.\n\nUse the following five test cases to compute normalized residuals:\n\n- Test 1 (UAPML, correct, fine grid): $N = 201$, $s_x = 1 - 0.2 j$, correct second-order equation.\n- Test 2 (UAPML, correct, coarse grid): $N = 21$, $s_x = 1 - 0.2 j$, correct second-order equation.\n- Test 3 (UAPML, implementation error): $N = 201$, $s_x = 1 - 0.2 j$, but use $s_x$ to the first power in the source term where $s_x^2$ is required.\n- Test 4 (CPML, correct assembly): $N = 201$, compute $s_x$ from $\\kappa_x$, $\\sigma_x$, $\\alpha_x$ via $s_x = \\kappa_x + \\frac{\\sigma_x}{j\\omega\\epsilon_0} + \\frac{\\alpha_x}{j\\omega}$, and use the correct second-order equation.\n- Test 5 (CPML, parameter scaling error): $N = 201$, compute $s_x^{\\text{wrong}} = \\kappa_x + \\frac{\\sigma_x}{j\\omega}$ (missing $\\epsilon_0$) and use it in the second-order equation in place of $s_x$.\n\nThe program must compute the normalized residual for each test case as a real-valued float. All computations must be performed in SI units. Angles are implied by complex exponentials, so no separate angle unit is required.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[r1,r2,r3,r4,r5]\"), where $r_1$ through $r_5$ are the normalized residuals for Tests 1 through 5, respectively.", "solution": "The problem statement has been validated and found to be self-contained, scientifically grounded, and well-posed. It presents a standard verification task in computational electromagnetics using the method of manufactured solutions to test implementations of Perfectly Matched Layers (PMLs). All parameters and test cases are defined unambiguously.\n\nThe solution proceeds in four stages: 1) derivation of the continuous governing equation for the electric field in a UAPML medium, 2) formulation of the discretization and the residual, 3) analysis of the specific test cases, and 4) implementation of the numerical computation.\n\n**1. Derivation of the Governing Equation**\n\nWe begin with the one-dimensional, time-harmonic Maxwell's curl equations in the frequency domain, assuming a time dependence of $e^{j\\omega t}$:\n$$\n-\\frac{dH_z}{dx} = j\\omega\\epsilon_0 E_y\n$$\n$$\n\\frac{dE_y}{dx} = -j\\omega\\mu_0 H_z\n$$\nA uniaxial anisotropic PML (UAPML) is modeled by introducing a complex coordinate stretching factor, $s_x$, which is uniform throughout the domain. This modifies the spatial derivative operator as $d/dx \\rightarrow \\frac{1}{s_x} d/dx$. Applying this transformation to Maxwell's equations yields:\n$$\n\\frac{1}{s_x} \\left(-\\frac{dH_z}{dx}\\right) = j\\omega\\epsilon_0 E_y \\quad \\implies \\quad \\frac{dH_z}{dx} = -j\\omega\\epsilon_0 s_x E_y \\quad (1)\n$$\n$$\n\\frac{1}{s_x} \\frac{dE_y}{dx} = -j\\omega\\mu_0 H_z \\quad \\implies \\quad \\frac{dE_y}{dx} = -j\\omega\\mu_0 s_x H_z \\quad (2)\n$$\nTo obtain a second-order equation for $E_y(x)$, we differentiate equation (2) with respect to $x$ and substitute equation (1). Since $s_x$ is a constant, we proceed as follows. First, isolate $H_z$ from equation (2):\n$$\nH_z = -\\frac{1}{j\\omega\\mu_0 s_x} \\frac{dE_y}{dx}\n$$\nNext, differentiate this expression for $H_z$ with respect to $x$:\n$$\n\\frac{dH_z}{dx} = -\\frac{1}{j\\omega\\mu_0 s_x} \\frac{d^2E_y}{dx^2}\n$$\nSubstituting this into equation (1) gives:\n$$\n-\\frac{1}{j\\omega\\mu_0 s_x} \\frac{d^2E_y}{dx^2} = -j\\omega\\epsilon_0 s_x E_y\n$$\nRearranging the terms, we arrive at the Helmholtz-type equation for $E_y(x)$:\n$$\n\\frac{d^2E_y}{dx^2} = (j\\omega s_x)^2 \\mu_0 \\epsilon_0 E_y = -\\omega^2 \\mu_0 \\epsilon_0 s_x^2 E_y\n$$\nDefining the free-space wavenumber as $k_0 = \\omega \\sqrt{\\mu_0 \\epsilon_0}$, we have $k_0^2 = \\omega^2 \\mu_0 \\epsilon_0$. The final second-order scalar equation is:\n$$\n\\frac{d^2E_y}{dx^2} + k_0^2 s_x^2 E_y = 0\n$$\nThis equation shows that the effective wavenumber in the stretched medium is $k_s = k_0 s_x$.\n\nThe provided manufactured solution is $E_y(x) = E_0 \\exp(-j k_0 s_x x)$. This is a plane wave propagating with the complex wavenumber $k_s$, which is an exact solution to the derived continuous equation.\n\n**2. Discretization and Residual Definition**\n\nThe domain of length $L$ is discretized into a uniform grid of $N$ points, $\\{x_i\\}_{i=0}^{N-1}$, with spacing $\\Delta x = L/(N-1)$. The second derivative of $E_y$ at an interior grid point $x_i$ ($1 \\le i \\le N-2$) is approximated using a second-order central finite difference:\n$$\n\\frac{d^2E_y}{dx^2}\\bigg|_{x_i} \\approx \\frac{E_y(x_{i+1}) - 2E_y(x_i) + E_y(x_{i-1})}{\\Delta x^2}\n$$\nSubstituting this into the governing equation gives the discretized equation. The residual, $R_i$, at each interior point $x_i$ is defined as the value of the discretized equation when the exact manufactured solution, $E_{y,i}^{\\text{manuf}} = E_y(x_i)$, is substituted. For the correct governing equation, the residual is:\n$$\nR_i = \\frac{E_{y,i+1}^{\\text{manuf}} - 2E_{y,i}^{\\text{manuf}} + E_{y,i-1}^{\\text{manuf}}}{\\Delta x^2} + k_0^2 s_x^2 E_{y,i}^{\\text{manuf}}\n$$\nThis residual is non-zero solely due to the truncation error of the finite difference approximation. For an implementation error, the residual expression will be based on the erroneously implemented equation, leading to a much larger value.\n\nThe normalized residual, $r$, is the ratio of the discrete $\\ell_2$-norm of the residual vector $\\vec{R} = (R_1, ..., R_{N-2})$ to the discrete $\\ell_2$-norm of the manufactured field vector evaluated at the interior points, $\\vec{E}^{\\text{manuf}} = (E_{y,1}^{\\text{manuf}}, ..., E_{y,N-2}^{\\text{manuf}})$:\n$$\nr = \\frac{\\|\\vec{R}\\|_{\\ell_2}}{\\|\\vec{E}^{\\text{manuf}}\\|_{\\ell_2}} = \\frac{\\sqrt{\\sum_{i=1}^{N-2} |R_i|^2}}{\\sqrt{\\sum_{i=1}^{N-2} |E_{y,i}^{\\text{manuf}}|^2}}\n$$\n\n**3. Analysis of Test Cases**\n\nLet $s_x^{\\text{target}} = 1 - 0.2j$. The manufactured solution is always $E_y(x) = E_0\\exp(-j k_0 s_x^{\\text{target}} x)$. We set $E_0=1$ without loss of generality.\n\n- **Test 1  2 (UAPML, correct):** The residual is calculated using the correct discretized equation with $N=201$ and $N=21$. The residual reflects only the discretization error. Since the central difference scheme is second-order accurate, the error is proportional to $\\Delta x^2$. The grid for $N=21$ ($\\Delta x = 1/20$) is 10 times coarser than for $N=201$ ($\\Delta x = 1/200$), so we expect the residual for Test 2 to be approximately $10^2=100$ times larger than for Test 1.\n\n- **Test 3 (UAPML, error):** The residual is calculated for a mistake in the implementation, where the governing equation is assumed to be $\\frac{d^2E_y}{dx^2} + k_0^2 s_x E_y = 0$. The manufactured solution (which solves the correct equation) is substituted into this incorrect discrete form. The resulting residual is dominated by the modeling error term $k_0^2(s_x-s_x^2)E_y$, which does not vanish as $\\Delta x \\to 0$. This residual should be orders of magnitude larger than the discretization error in Test 1.\n\n- **Test 4 (CPML, correct):** The stretch factor is assembled from its CPML parameters: $s_x = \\kappa_x + \\frac{\\sigma_x}{j\\omega\\epsilon_0} + \\frac{\\alpha_x}{j\\omega}$. With $\\kappa_x=1.0$, $\\alpha_x=0.0$, and $\\sigma_x = 0.2\\omega\\epsilon_0$, we get $s_x = 1.0 + \\frac{0.2\\omega\\epsilon_0}{j\\omega\\epsilon_0} = 1.0 - 0.2j = s_x^{\\text{target}}$. Since this is identical to the UAPML case and the same correct governing equation is used on the same grid, the result must be identical to that of Test 1.\n\n- **Test 5 (CPML, error):** An incorrect stretch factor $s_x^{\\text{wrong}} = \\kappa_x + \\frac{\\sigma_x}{j\\omega} = 1 - j(0.2\\epsilon_0)$ is assembled due to a missing $\\epsilon_0$ in the denominator of the conductivity term. The manufactured solution, based on $s_x^{\\text{target}}$, is substituted into the discretized equation that uses $(s_x^{\\text{wrong}})^2$. The mismatch between $s_x^{\\text{wrong}}$ and $s_x^{\\text{target}}$ will produce a large residual, dominated by the implementation error term $k_0^2((s_x^{\\text{wrong}})^2 - (s_x^{\\text{target}})^2)E_y$. This residual will be significantly larger than the discretization error.\n\n**4. Numerical Implementation**\n\nThe computation is performed for each test case by implementing the residual calculation as described. Physical constants are used in SI units as specified. The final values of the normalized residual for the five test cases are calculated and reported.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes normalized residuals for five test cases related to PML implementations.\n    \"\"\"\n    # Define physical and numerical constants in SI units\n    MU_0 = 4 * np.pi * 1e-7\n    EPS_0 = 8.854187817e-12\n    FREQ = 1.0e9\n    OMEGA = 2 * np.pi * FREQ\n    K0 = OMEGA * np.sqrt(MU_0 * EPS_0)\n    L = 1.0\n\n    # The target stretch factor for the manufactured solution\n    S_X_TARGET = 1.0 - 0.2j\n\n    def compute_normalized_residual(N, s_x_manuf, s_x_pde, pde_s_power):\n        \"\"\"\n        Computes the normalized residual for a given set of parameters.\n        \n        Args:\n            N (int): Number of grid points.\n            s_x_manuf (complex): Stretch factor for the manufactured solution.\n            s_x_pde (complex): Stretch factor in the discretized PDE.\n            pde_s_power (int): Power of s_x_pde in the PDE.\n        \"\"\"\n        # 1. Define the grid\n        delta_x = L / (N - 1)\n        x = np.linspace(0, L, N, dtype=np.float64)\n\n        # 2. Generate manufactured solution on the grid: E_y(x) = exp(-j*k0*s_x_manuf*x)\n        E_manuf = np.exp(-1j * K0 * s_x_manuf * x)\n\n        # 3. Discretize the PDE to calculate the residual at interior points\n        # The PDE is: d^2(E)/dx^2 + k0^2 * (s_x_pde)^pde_s_power * E = 0\n        \n        # Interior points (indices 1 to N-2)\n        interior_indices = slice(1, -1)\n        E_manuf_interior = E_manuf[interior_indices]\n\n        # Central difference approximation of d^2(E)/dx^2\n        D2_E_manuf = (E_manuf[2:] - 2 * E_manuf[interior_indices] + E_manuf[:-2]) / (delta_x**2)\n        \n        # Residual vector\n        residual_vector = D2_E_manuf + (K0**2) * (s_x_pde**pde_s_power) * E_manuf_interior\n        \n        # 4. Compute the normalized l2-norm of the residual\n        norm_residual = np.linalg.norm(residual_vector)\n        norm_field = np.linalg.norm(E_manuf_interior)\n        \n        if norm_field == 0:\n            return 0.0\n        \n        return norm_residual / norm_field\n\n    results = []\n\n    # Test 1: UAPML, correct, fine grid (N=201)\n    r1 = compute_normalized_residual(N=201, s_x_manuf=S_X_TARGET, s_x_pde=S_X_TARGET, pde_s_power=2)\n    results.append(r1)\n\n    # Test 2: UAPML, correct, coarse grid (N=21)\n    r2 = compute_normalized_residual(N=21, s_x_manuf=S_X_TARGET, s_x_pde=S_X_TARGET, pde_s_power=2)\n    results.append(r2)\n\n    # Test 3: UAPML, implementation error (N=201)\n    r3 = compute_normalized_residual(N=201, s_x_manuf=S_X_TARGET, s_x_pde=S_X_TARGET, pde_s_power=1)\n    results.append(r3)\n    \n    # Test 4: CPML, correct assembly (N=201)\n    kappa_x = 1.0\n    alpha_x = 0.0\n    sigma_x = 0.2 * OMEGA * EPS_0\n    s_x_cpml = kappa_x + sigma_x / (1j * OMEGA * EPS_0) + alpha_x / (1j * OMEGA)\n    # This calculation is identical to Test 1, as s_x_cpml equals S_X_TARGET\n    r4 = compute_normalized_residual(N=201, s_x_manuf=s_x_cpml, s_x_pde=s_x_cpml, pde_s_power=2)\n    results.append(r4)\n\n    # Test 5: CPML, parameter scaling error (N=201)\n    # The PDE uses an incorrectly assembled s_x_wrong\n    s_x_wrong_cpml = kappa_x + sigma_x / (1j * OMEGA) # Missing EPS_0\n    r5 = compute_normalized_residual(N=201, s_x_manuf=S_X_TARGET, s_x_pde=s_x_wrong_cpml, pde_s_power=2)\n    results.append(r5)\n    \n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3358794"}]}