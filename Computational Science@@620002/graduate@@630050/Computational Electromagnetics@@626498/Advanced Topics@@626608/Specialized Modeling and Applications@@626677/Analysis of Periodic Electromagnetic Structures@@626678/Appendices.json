{"hands_on_practices": [{"introduction": "The analysis of any periodic structure, from crystalline solids to photonic crystals, begins with a transition from real space to reciprocal space. This mathematical transformation simplifies the treatment of wave propagation by mapping the lattice's periodicity onto a new grid of points known as the reciprocal lattice. This exercise provides foundational practice in this essential step, guiding you through the derivation of reciprocal lattice vectors and the calculation of the first Brillouin zone area for a general two-dimensional lattice [@problem_id:3289412].", "problem": "A two-dimensional photonic crystal with spatially periodic permittivity $\\,\\epsilon(\\mathbf{r})\\,$ is defined on an oblique Bravais lattice with primitive real-space vectors $\\,\\mathbf{a}_{1} = a\\,\\hat{\\mathbf{x}}\\,$ and $\\,\\mathbf{a}_{2} = a\\big(\\cos\\theta\\,\\hat{\\mathbf{x}} + \\sin\\theta\\,\\hat{\\mathbf{y}}\\big)\\,$, where $\\,a > 0\\,$ is the lattice constant and $\\,\\theta \\in (0,\\pi)\\,$ is the lattice angle measured in radians. In frequency domain, the source-free macroscopic Maxwell equations yield the vector wave equation $\\,\\nabla \\times \\mu^{-1}(\\mathbf{r})\\,\\nabla \\times \\mathbf{E}(\\mathbf{r}) = \\omega^{2}\\,\\epsilon(\\mathbf{r})\\,\\mathbf{E}(\\mathbf{r})\\,$, and the periodicity implies that the electromagnetic field modes satisfy Bloch’s theorem: for any Bloch wavevector $\\,\\mathbf{k}\\,$, $\\,\\mathbf{E}_{\\mathbf{k}}(\\mathbf{r}+\\mathbf{a}_{i}) = \\mathbf{E}_{\\mathbf{k}}(\\mathbf{r})\\,\\exp\\!\\big(i\\,\\mathbf{k}\\cdot\\mathbf{a}_{i}\\big)\\,$ for $\\,i=1,2\\,$. To formulate a spectral-domain computational approach based on plane-wave expansions, one introduces the reciprocal lattice vectors $\\,\\mathbf{G}\\,$ such that the Fourier harmonics $\\,\\exp\\!\\big(i(\\mathbf{k}+\\mathbf{G})\\cdot\\mathbf{r}\\big)\\,$ respect the lattice periodicity.\n\nStarting from these foundations and the Bloch-phase compatibility condition for plane-wave harmonics under primitive translations, derive the primitive reciprocal lattice vectors $\\,\\mathbf{b}_{1}\\,$ and $\\,\\mathbf{b}_{2}\\,$ for the given oblique lattice, and then compute the area of the first Brillouin Zone (defined as the Wigner–Seitz cell of the reciprocal lattice) by taking the magnitude of the cross product $\\,|\\mathbf{b}_{1}\\times\\mathbf{b}_{2}|\\,$. Express your final answer as a single closed-form analytic expression in terms of $\\,a\\,$ and $\\,\\theta\\,$. The angle $\\,\\theta\\,$ is in radians. Express the area in $\\,\\mathrm{m}^{-2}\\,$. No numerical substitution is required; provide an exact expression as your final answer.", "solution": "The problem is valid as it is scientifically grounded in the principles of solid-state physics and computational electromagnetics, is well-posed, and is expressed in objective, precise language. All necessary information is provided.\n\nThe objective is to derive the primitive reciprocal lattice vectors $\\mathbf{b}_{1}$ and $\\mathbf{b}_{2}$ for a given two-dimensional oblique lattice and then compute the area of its first Brillouin Zone.\n\nThe primitive real-space lattice vectors are given as:\n$$ \\mathbf{a}_{1} = a\\,\\hat{\\mathbf{x}} $$\n$$ \\mathbf{a}_{2} = a\\big(\\cos\\theta\\,\\hat{\\mathbf{x}} + \\sin\\theta\\,\\hat{\\mathbf{y}}\\big) $$\nwhere $a > 0$ is the lattice constant and $\\theta \\in (0, \\pi)$ is the lattice angle. In a Cartesian coordinate system, these vectors are represented as:\n$$ \\mathbf{a}_{1} = \\begin{pmatrix} a \\\\ 0 \\end{pmatrix} $$\n$$ \\mathbf{a}_{2} = \\begin{pmatrix} a\\cos\\theta \\\\ a\\sin\\theta \\end{pmatrix} $$\nThe condition $\\theta \\in (0, \\pi)$ ensures that $\\sin\\theta > 0$, guaranteeing that the vectors $\\mathbf{a}_{1}$ and $\\mathbf{a}_{2}$ are not collinear and thus form a valid basis for a two-dimensional lattice.\n\nThe primitive reciprocal lattice vectors, $\\mathbf{b}_{1}$ and $\\mathbf{b}_{2}$, are defined by the duality condition:\n$$ \\mathbf{a}_{i} \\cdot \\mathbf{b}_{j} = 2\\pi \\delta_{ij} $$\nwhere $i,j \\in \\{1, 2\\}$ and $\\delta_{ij}$ is the Kronecker delta. This condition ensures that the plane-wave basis functions used in a Fourier expansion are compatible with the periodicity of the lattice, as mentioned in the problem statement.\n\nWe can express the unknown reciprocal vectors in the same Cartesian basis:\n$$ \\mathbf{b}_{1} = \\begin{pmatrix} b_{1x} \\\\ b_{1y} \\end{pmatrix} $$\n$$ \\mathbf{b}_{2} = \\begin{pmatrix} b_{2x} \\\\ b_{2y} \\end{pmatrix} $$\n\nWe now solve for the components of $\\mathbf{b}_{1}$ and $\\mathbf{b}_{2}$ by applying the four equations derived from the duality condition:\n\n1.  $\\mathbf{a}_{1} \\cdot \\mathbf{b}_{1} = 2\\pi$:\n    $\\begin{pmatrix} a & 0 \\end{pmatrix} \\begin{pmatrix} b_{1x} \\\\ b_{1y} \\end{pmatrix} = a b_{1x} = 2\\pi \\implies b_{1x} = \\frac{2\\pi}{a}$\n\n2.  $\\mathbf{a}_{1} \\cdot \\mathbf{b}_{2} = 0$:\n    $\\begin{pmatrix} a & 0 \\end{pmatrix} \\begin{pmatrix} b_{2x} \\\\ b_{2y} \\end{pmatrix} = a b_{2x} = 0 \\implies b_{2x} = 0$\n\n3.  $\\mathbf{a}_{2} \\cdot \\mathbf{b}_{1} = 0$:\n    $\\begin{pmatrix} a\\cos\\theta & a\\sin\\theta \\end{pmatrix} \\begin{pmatrix} b_{1x} \\\\ b_{1y} \\end{pmatrix} = (a\\cos\\theta)b_{1x} + (a\\sin\\theta)b_{1y} = 0$\n    Substituting $b_{1x} = \\frac{2\\pi}{a}$:\n    $(a\\cos\\theta)\\left(\\frac{2\\pi}{a}\\right) + (a\\sin\\theta)b_{1y} = 0$\n    $2\\pi\\cos\\theta + a\\sin\\theta b_{1y} = 0$\n    $b_{1y} = -\\frac{2\\pi\\cos\\theta}{a\\sin\\theta} = -\\frac{2\\pi}{a}\\cot\\theta$\n\n4.  $\\mathbf{a}_{2} \\cdot \\mathbf{b}_{2} = 2\\pi$:\n    $\\begin{pmatrix} a\\cos\\theta & a\\sin\\theta \\end{pmatrix} \\begin{pmatrix} b_{2x} \\\\ b_{2y} \\end{pmatrix} = (a\\cos\\theta)b_{2x} + (a\\sin\\theta)b_{2y} = 2\\pi$\n    Substituting $b_{2x} = 0$:\n    $(a\\cos\\theta)(0) + (a\\sin\\theta)b_{2y} = 2\\pi$\n    $a\\sin\\theta b_{2y} = 2\\pi \\implies b_{2y} = \\frac{2\\pi}{a\\sin\\theta}$\n\nHaving found the components, we can write the primitive reciprocal lattice vectors as:\n$$ \\mathbf{b}_{1} = \\frac{2\\pi}{a}\\hat{\\mathbf{x}} - \\frac{2\\pi\\cot\\theta}{a}\\hat{\\mathbf{y}} $$\n$$ \\mathbf{b}_{2} = \\frac{2\\pi}{a\\sin\\theta}\\hat{\\mathbf{y}} $$\n\nThe first Brillouin Zone is the Wigner–Seitz cell of the reciprocal lattice. The area of any primitive cell of the reciprocal lattice, including the first Brillouin Zone, is given by the magnitude of the cross product of the primitive reciprocal vectors. To compute the cross product, we embed the two-dimensional vectors into three-dimensional space by adding a zero z-component:\n$$ \\mathbf{b}_{1} = \\left( \\frac{2\\pi}{a}, -\\frac{2\\pi\\cot\\theta}{a}, 0 \\right) = \\left( \\frac{2\\pi}{a}, -\\frac{2\\pi\\cos\\theta}{a\\sin\\theta}, 0 \\right) $$\n$$ \\mathbf{b}_{2} = \\left( 0, \\frac{2\\pi}{a\\sin\\theta}, 0 \\right) $$\n\nThe cross product $\\mathbf{b}_{1} \\times \\mathbf{b}_{2}$ is calculated using the determinant formula:\n$$ \\mathbf{b}_{1} \\times \\mathbf{b}_{2} = \\det \\begin{pmatrix} \\hat{\\mathbf{x}} & \\hat{\\mathbf{y}} & \\hat{\\mathbf{z}} \\\\ \\frac{2\\pi}{a} & -\\frac{2\\pi\\cos\\theta}{a\\sin\\theta} & 0 \\\\ 0 & \\frac{2\\pi}{a\\sin\\theta} & 0 \\end{pmatrix} $$\nExpanding the determinant, we find that the $\\hat{\\mathbf{x}}$ and $\\hat{\\mathbf{y}}$ components are zero. The $\\hat{\\mathbf{z}}$ component is:\n$$ \\mathbf{b}_{1} \\times \\mathbf{b}_{2} = \\hat{\\mathbf{z}} \\left[ \\left( \\frac{2\\pi}{a} \\right) \\left( \\frac{2\\pi}{a\\sin\\theta} \\right) - \\left( -\\frac{2\\pi\\cos\\theta}{a\\sin\\theta} \\right)(0) \\right] = \\hat{\\mathbf{z}} \\frac{4\\pi^2}{a^2\\sin\\theta} $$\nThe area of the first Brillouin Zone, $A_{BZ}$, is the magnitude of this vector:\n$$ A_{BZ} = |\\mathbf{b}_{1} \\times \\mathbf{b}_{2}| = \\left| \\hat{\\mathbf{z}} \\frac{4\\pi^2}{a^2\\sin\\theta} \\right| = \\frac{4\\pi^2}{a^2|\\sin\\theta|} $$\nAs established earlier, the angle $\\theta$ lies in the interval $(0, \\pi)$, which implies $\\sin\\theta > 0$. Therefore, $|\\sin\\theta| = \\sin\\theta$.\n\nThe final expression for the area of the first Brillouin Zone is:\n$$ A_{BZ} = \\frac{4\\pi^2}{a^2\\sin\\theta} $$\nGiven that the lattice constant $a$ has units of length (e.g., meters), the area has units of inverse length squared ($\\mathrm{m}^{-2}$), which is appropriate for reciprocal space.", "answer": "$$\\boxed{\\frac{4\\pi^2}{a^2\\sin\\theta}}$$", "id": "3289412"}, {"introduction": "While frequency-domain methods like PWE directly solve for eigenmodes, time-domain techniques such as the Finite-Difference Time-Domain (FDTD) method simulate the evolution of fields over time. When applying FDTD to periodic systems using Floquet boundary conditions, the discretization of space and time introduces numerical artifacts, most notably numerical dispersion, where the simulated wave speed depends on frequency and propagation direction relative to the grid. This exercise is crucial for any computational scientist, as it involves deriving and quantifying this numerical error, allowing you to assess the accuracy of your FDTD simulations and make informed choices about grid resolution and time stepping [@problem_id:3289443].", "problem": "You are to derive, implement, and validate the numerical dispersion relation of the two-dimensional Finite-Difference Time-Domain (FDTD) method with Bloch–Floquet periodic boundary conditions under oblique plane-wave incidence in vacuum. Start from the macroscopic Maxwell curl equations in vacuum, the constitutive relations, a standard staggered Yee discretization in space and time, and the Bloch–Floquet theorem. Use these to obtain a relation between the discrete angular frequency $\\,\\omega_{\\mathrm{num}}\\,$, the wavevector components $\\,k_x\\,$ and $\\,k_y\\,$, the grid spacings $\\,\\Delta x\\,$ and $\\,\\Delta y\\,$, and the time step $\\,\\Delta t\\,$. The Bloch–Floquet periodic boundary conditions imply that a plane-wave solution of the form $\\,\\mathrm{e}^{\\mathrm{j}(k_x x + k_y y - \\omega t)}\\,$ is consistent with translation by any lattice vector up to a phase, and for a given oblique incidence angle $\\,\\theta\\,$ in radians the continuous-space components satisfy $\\,k_x = k_0 \\cos\\theta\\,$ and $\\,k_y = k_0 \\sin\\theta\\,$, where $\\,k_0 = \\omega/c\\,$ and $\\,c\\,$ is the speed of light in vacuum. Avoid any use of undocumented or black-box formulas; the derivation must proceed from these fundamental bases.\n\nDefine the Courant number $\\,S\\,$ for the two-dimensional Yee scheme as $\\,S = c\\,\\Delta t\\,\\sqrt{\\Delta x^{-2} + \\Delta y^{-2}}\\,,$ with the explicit stability requirement $\\,0 < S \\leq 1\\,$. For each test case, you will be given the frequency $\\,f\\,$ in hertz, the incidence angle $\\,\\theta\\,$ in radians, the number of grid points per free-space wavelength along $\\,x\\,$ denoted $\\,N_x\\,$ (so that $\\,\\Delta x = \\lambda_0 / N_x\\,$, where $\\,\\lambda_0 = c/f\\,$), the grid anisotropy ratio $\\,r = \\Delta x / \\Delta y\\,$ (so that $\\,\\Delta y = \\Delta x / r\\,$), and the Courant number $\\,S\\,$. From these, compute $\\,\\Delta x\\,$, $\\,\\Delta y\\,$, and $\\,\\Delta t\\,$, then determine the numerical angular frequency $\\,\\omega_{\\mathrm{num}}\\,$ implied by the FDTD discrete dispersion in vacuum with Bloch–Floquet periodicity for the given $\\,k_x\\,$ and $\\,k_y\\,$. Compare $\\,\\omega_{\\mathrm{num}}\\,$ against the continuous-space angular frequency $\\,\\omega = 2\\pi f\\,$ and report the signed relative phase-velocity error $\\,\\varepsilon = \\omega_{\\mathrm{num}}/\\omega - 1\\,$, which is dimensionless. All angles are to be treated in radians, all lengths in meters, all times in seconds, and all frequencies in hertz. The final answers must be dimensionless numbers.\n\nYour program must implement the above logic and produce the errors for the following test suite of parameter values:\n\n- Case $\\,1\\,$ (happy path, square grid): $\\,f = 10\\times 10^9\\,\\mathrm{Hz}\\,$, $\\,\\theta = 0.35\\,\\mathrm{rad}\\,$, $\\,N_x = 20\\,$, $\\,r = 1.0\\,$, $\\,S = 0.8\\,$.\n- Case $\\,2\\,$ (anisotropic grid, same wave and $\\,S$): $\\,f = 10\\times 10^9\\,\\mathrm{Hz}\\,$, $\\,\\theta = 0.35\\,\\mathrm{rad}\\,$, $\\,N_x = 20\\,$, $\\,r = 2.0\\,$, $\\,S = 0.8\\,$.\n- Case $\\,3\\,$ (near-Courant limit, square grid): $\\,f = 10\\times 10^9\\,\\mathrm{Hz}\\,$, $\\,\\theta = 0.35\\,\\mathrm{rad}\\,$, $\\,N_x = 20\\,$, $\\,r = 1.0\\,$, $\\,S = 0.99\\,$.\n- Case $\\,4\\,$ (grazing-like incidence with strong anisotropy): $\\,f = 10\\times 10^9\\,\\mathrm{Hz}\\,$, $\\,\\theta = 1.4\\,\\mathrm{rad}\\,$, $\\,N_x = 20\\,$, $\\,r = 0.5\\,$, $\\,S = 0.6\\,$.\n- Case $\\,5\\,$ (axis-aligned propagation, square grid): $\\,f = 10\\times 10^9\\,\\mathrm{Hz}\\,$, $\\,\\theta = 0.0\\,\\mathrm{rad}\\,$, $\\,N_x = 20\\,$, $\\,r = 1.0\\,$, $\\,S = 0.8\\,$.\n- Case $\\,6\\,$ (coarse grid resolution and low Courant, oblique): $\\,f = 10\\times 10^9\\,\\mathrm{Hz}\\,$, $\\,\\theta = \\pi/4\\,\\mathrm{rad}\\,$, $\\,N_x = 8\\,$, $\\,r = 1.5\\,$, $\\,S = 0.2\\,$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each number must be the signed relative error $\\,\\varepsilon\\,$ for the corresponding case, rounded to exactly $\\,8\\,$ decimal places, for example $\\,[-0.00123456,0.00000078,\\dots]\\,$.", "solution": "The problem requires the derivation and implementation of the numerical dispersion relation for the two-dimensional Finite-Difference Time-Domain (FDTD) method under Bloch–Floquet periodicity. This analysis allows us to quantify the phase error inherent in the FDTD algorithm as a function of grid parameters and wave propagation direction. The derivation begins with Maxwell's equations in vacuum and proceeds by applying a finite-difference approximation on a staggered Yee grid.\n\nWe consider a Transverse Magnetic ($TM_z$) wave polarization, where the electric field has only a $z$-component ($E_z$) and the magnetic field lies in the $x-y$ plane ($\\vec{H} = H_x \\hat{x} + H_y \\hat{y}$). The analysis for the Transverse Electric ($TE_z$) case yields an identical dispersion relation, so this choice is made without loss of generality. In a source-free vacuum ($\\vec{J}=0$, $\\rho=0$), Maxwell's curl equations are:\n$$ \\nabla \\times \\vec{E} = -\\mu_0 \\frac{\\partial \\vec{H}}{\\partial t} $$\n$$ \\nabla \\times \\vec{H} = \\epsilon_0 \\frac{\\partial \\vec{E}}{\\partial t} $$\nFor the $TM_z$ mode, these vector equations decompose into three scalar equations:\n$$ \\frac{\\partial E_z}{\\partial y} = -\\mu_0 \\frac{\\partial H_x}{\\partial t} \\quad (1) $$\n$$ \\frac{\\partial E_z}{\\partial x} = \\mu_0 \\frac{\\partial H_y}{\\partial t} \\quad (2) $$\n$$ \\frac{\\partial H_y}{\\partial x} - \\frac{\\partial H_x}{\\partial y} = \\epsilon_0 \\frac{\\partial E_z}{\\partial t} \\quad (3) $$\n\nIn the FDTD method, space and time are discretized as $x = i\\Delta x$, $y = j\\Delta y$, and $t = n\\Delta t$, where $i, j, n$ are integers. A field component $F$ at a discrete point is denoted $F(i, j, n)$. The fields are arranged on a staggered Yee cell: $E_z$ is evaluated at integer grid points $(i, j, n)$, $H_x$ at $(i, j+1/2, n+1/2)$, and $H_y$ at $(i+1/2, j, n+1/2)$. Applying central finite differences to equations (1-3) yields the FDTD update equations:\n\n$$ \\epsilon_0 \\frac{E_z(i,j,n+1) - E_z(i,j,n)}{\\Delta t} = \\frac{H_y(i+1/2,j,n+1/2) - H_y(i-1/2,j,n+1/2)}{\\Delta x} - \\frac{H_x(i,j+1/2,n+1/2) - H_x(i,j-1/2,n+1/2)}{\\Delta y} $$\n$$ \\mu_0 \\frac{H_x(i,j+1/2,n+1/2) - H_x(i,j+1/2,n-1/2)}{\\Delta t} = -\\frac{E_z(i,j+1,n) - E_z(i,j,n)}{\\Delta y} $$\n$$ \\mu_0 \\frac{H_y(i+1/2,j,n+1/2) - H_y(i+1/2,j,n-1/2)}{\\Delta t} = \\frac{E_z(i+1,j,n) - E_z(i,j,n)}{\\Delta x} $$\n\nTo derive the numerical dispersion relation, we substitute a discrete plane-wave solution (an eigenmode of the discrete system) into these equations. This is consistent with the Bloch–Floquet theorem for a periodic system (the grid itself). A generic field component $F$ is assumed to have the form:\n$$ F(i\\Delta x, j\\Delta y, n\\Delta t) = F_0 e^{j(k_x i\\Delta x + k_y j\\Delta y - \\omega_{\\mathrm{num}} n\\Delta t)} $$\nwhere $F_0$ is the complex amplitude, $k_x$ and $k_y$ are the wavevector components, and $\\omega_{\\mathrm{num}}$ is the numerical angular frequency that we seek to determine.\n\nApplying this ansatz, a finite difference such as $F(i+1/2) - F(i-1/2)$ becomes:\n$$ F_0 e^{j(k_x(i+1/2)\\Delta x)} - F_0 e^{j(k_x(i-1/2)\\Delta x)} = F_0 e^{j k_x i \\Delta x} (e^{j k_x \\Delta x/2} - e^{-j k_x \\Delta x/2}) = 2j \\sin\\left(\\frac{k_x \\Delta x}{2}\\right) F_0 e^{j k_x i \\Delta x} $$\nApplying this principle to all spatial and temporal differences, the FDTD equations transform into a system of algebraic equations for the complex amplitudes $E_{z0}$, $H_{x0}$, $H_{y0}$:\n\n$$ \\epsilon_0 \\frac{-2j\\sin(\\frac{\\omega_{\\mathrm{num}}\\Delta t}{2})}{\\Delta t} E_{z0} = \\frac{2j\\sin(\\frac{k_x\\Delta x}{2})}{\\Delta x} H_{y0} - \\frac{2j\\sin(\\frac{k_y\\Delta y}{2})}{\\Delta y} H_{x0} $$\n$$ \\mu_0 \\frac{-2j\\sin(\\frac{\\omega_{\\mathrm{num}}\\Delta t}{2})}{\\Delta t} H_{x0} = -\\frac{2j\\sin(\\frac{k_y\\Delta y}{2})}{\\Delta y} E_{z0} $$\n$$ \\mu_0 \\frac{-2j\\sin(\\frac{\\omega_{\\mathrm{num}}\\Delta t}{2})}{\\Delta t} H_{y0} = \\frac{2j\\sin(\\frac{k_x\\Delta x}{2})}{\\Delta x} E_{z0} $$\n\nAfter canceling the common factor of $2j$ and simplifying, we can express $H_{x0}$ and $H_{y0}$ in terms of $E_{z0}$ from the second and third equations:\n$$ H_{x0} = \\frac{\\Delta t \\sin(\\frac{k_y\\Delta y}{2})}{\\mu_0 \\Delta y \\sin(\\frac{\\omega_{\\mathrm{num}}\\Delta t}{2})} E_{z0} $$\n$$ H_{y0} = -\\frac{\\Delta t \\sin(\\frac{k_x\\Delta x}{2})}{\\mu_0 \\Delta x \\sin(\\frac{\\omega_{\\mathrm{num}}\\Delta t}{2})} E_{z0} $$\n\nSubstituting these expressions back into the first equation and canceling the non-zero amplitude $E_{z0}$ gives:\n$$ -\\frac{\\epsilon_0}{\\Delta t}\\sin\\left(\\frac{\\omega_{\\mathrm{num}}\\Delta t}{2}\\right) = -\\frac{\\Delta t}{\\mu_0 \\sin(\\frac{\\omega_{\\mathrm{num}}\\Delta t}{2})} \\left[ \\left(\\frac{\\sin(\\frac{k_x\\Delta x}{2})}{\\Delta x}\\right)^2 + \\left(\\frac{\\sin(\\frac{k_y\\Delta y}{2})}{\\Delta y}\\right)^2 \\right] $$\n\nRearranging and using the vacuum wave speed relation $c = 1/\\sqrt{\\epsilon_0\\mu_0}$, we arrive at the numerical dispersion relation for the 2D FDTD method:\n$$ \\left[\\frac{1}{c\\Delta t}\\sin\\left(\\frac{\\omega_{\\mathrm{num}}\\Delta t}{2}\\right)\\right]^2 = \\left[\\frac{\\sin\\left(\\frac{k_x\\Delta x}{2}\\right)}{\\Delta x}\\right]^2 + \\left[\\frac{\\sin\\left(\\frac{k_y\\Delta y}{2}\\right)}{\\Delta y}\\right]^2 $$\n\nTo compute the numerical angular frequency $\\omega_{\\mathrm{num}}$, we solve this equation for it:\n$$ \\omega_{\\mathrm{num}} = \\frac{2}{\\Delta t} \\arcsin\\left( c\\Delta t \\sqrt{\\left[\\frac{\\sin\\left(\\frac{k_x\\Delta x}{2}\\right)}{\\Delta x}\\right]^2 + \\left[\\frac{\\sin\\left(\\frac{k_y\\Delta y}{2}\\right)}{\\Delta y}\\right]^2} \\right) $$\n\nThe argument of the $\\arcsin$ function is related to the Courant number $S$. The Courant stability condition, $S \\leq 1$, ensures that the argument does not exceed $1$, guaranteeing a real solution for $\\omega_{\\mathrm{num}}$.\n\nThe computational procedure for each test case is as follows:\n1.  Given $f, \\theta, N_x, r, S$, first calculate the continuous-space parameters: $\\omega = 2\\pi f$, $\\lambda_0 = c/f$, $k_0 = \\omega/c$, $k_x = k_0\\cos\\theta$, and $k_y = k_0\\sin\\theta$.\n2.  Next, determine the grid parameters: $\\Delta x = \\lambda_0/N_x$, $\\Delta y = \\Delta x / r$.\n3.  The time step $\\Delta t$ is calculated by rearranging the definition of the Courant number $S = c\\Delta t\\sqrt{\\Delta x^{-2} + \\Delta y^{-2}}$:\n    $$ \\Delta t = \\frac{S}{c\\sqrt{\\Delta x^{-2} + \\Delta y^{-2}}} $$\n4.  Substitute these values into the derived equation for $\\omega_{\\mathrm{num}}$.\n5.  Finally, calculate the signed relative phase-velocity error $\\varepsilon = \\omega_{\\mathrm{num}}/\\omega - 1$. This value quantifies the numerical dispersion, with negative values indicating that the numerical wave speed is lower than the physical speed of light for the given wavevector.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy import constants\n\ndef solve():\n    \"\"\"\n    Derives and validates the numerical dispersion relation of the 2D FDTD method\n    with Bloch-Floquet PBCs for oblique plane-wave incidence in vacuum.\n    \"\"\"\n    # Use the speed of light from scipy.constants for precision\n    c = constants.c\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (f, theta, N_x, r, S)\n    test_cases = [\n        (10e9, 0.35, 20, 1.0, 0.8),         # Case 1\n        (10e9, 0.35, 20, 2.0, 0.8),         # Case 2\n        (10e9, 0.35, 20, 1.0, 0.99),        # Case 3\n        (10e9, 1.4, 20, 0.5, 0.6),          # Case 4\n        (10e9, 0.0, 20, 1.0, 0.8),          # Case 5\n        (10e9, np.pi/4, 8, 1.5, 0.2),       # Case 6\n    ]\n\n    results = []\n    for case in test_cases:\n        f, theta_rad, Nx, r, S = case\n\n        # Step 1: Calculate continuous-space parameters\n        omega = 2 * np.pi * f\n        lambda0 = c / f\n        k0 = omega / c\n        kx = k0 * np.cos(theta_rad)\n        ky = k0 * np.sin(theta_rad)\n\n        # Step 2: Calculate grid parameters\n        dx = lambda0 / Nx\n        dy = dx / r\n        \n        # Step 3: Calculate time step from the Courant number definition\n        dt = S / (c * np.sqrt(dx**-2 + dy**-2))\n\n        # Step 4: Calculate the numerical angular frequency (omega_num)\n        # using the derived dispersion relation.\n        term_x_sq = (np.sin(kx * dx / 2.0) / dx)**2\n        term_y_sq = (np.sin(ky * dy / 2.0) / dy)**2\n\n        arg_arcsin = c * dt * np.sqrt(term_x_sq + term_y_sq)\n        \n        # The stability condition S = 1 should ensure arg_arcsin = 1.\n        # Floating point inaccuracies might cause it to be slightly > 1.\n        # We clamp it to 1.0 to prevent a domain error in np.arcsin.\n        if arg_arcsin > 1.0:\n            arg_arcsin = 1.0\n\n        omega_num = (2.0 / dt) * np.arcsin(arg_arcsin)\n\n        # Step 5: Calculate the signed relative phase-velocity error\n        relative_error = (omega_num / omega) - 1.0\n        results.append(relative_error)\n\n    # Final print statement in the exact required format.\n    # Each result is formatted to 8 decimal places.\n    formatted_results = [f\"{res:.8f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3289485"}, {"introduction": "With the reciprocal lattice as our framework, we can solve Maxwell's equations in periodic media by representing both the fields and the material properties as a series of plane waves. The Plane-Wave Expansion (PWE) method operationalizes this concept, converting the wave equation into a standard matrix eigenvalue problem whose solutions reveal the photonic band structure. This practice offers a comprehensive, hands-on experience in deriving the PWE formulation from first principles and implementing it computationally to calculate the allowed frequencies (or bands) in a photonic crystal [@problem_id:3289485].", "problem": "Consider a two-dimensional square-lattice photonic crystal formed by a periodic arrangement of circular dielectric rods of radius $R$ and relative permittivity $\\varepsilon_r$ embedded in a homogeneous background of relative permittivity $\\varepsilon_b$. The lattice constant is $a$ and the structure is invariant in the out-of-plane $z$ direction. The analysis is to be performed for Transverse Electric (TE) polarization, where the magnetic field has only the out-of-plane component $H_z$. The task is to derive, implement, and evaluate the Plane-Wave Expansion (PWE) method to compute the band structure as $H_z$ eigenfrequencies for given Bloch wave vectors.\n\nStarting from the source-free Maxwell's equations in a linear, lossless, nonmagnetic, periodic medium with spatially varying permittivity $\\varepsilon(\\mathbf{r})$, and using Bloch's theorem for fields in periodic structures, you must derive the TE-mode scalar wave equation for $H_z(\\mathbf{r})$ in the lattice and then obtain the corresponding matrix eigenvalue problem in a truncated plane-wave basis. The reduction must start from first principles and must not assume any pre-derived band-structure formulas. You must explicitly use the periodicity of $\\varepsilon(\\mathbf{r})$, the completeness of plane waves on a unit cell, and the Fourier convolution structure that links the operator and the field expansion coefficients. Crucially, express the operator in terms of the Fourier coefficients of the inverse permittivity $1/\\varepsilon(\\mathbf{r})$ for the geometry consisting of a circular disk of radius $R$ (with $\\varepsilon_r$) centered within a square unit cell of area $A = a^2$ in a background of $\\varepsilon_b$. Do not introduce any ad hoc or shortcut expressions; all steps must follow from the stated fundamental base.\n\nYour program must implement the derived PWE eigenproblem for TE modes using a square lattice and a truncated plane-wave basis consisting of reciprocal lattice vectors $\\mathbf{G} = m \\mathbf{b}_1 + n \\mathbf{b}_2$ where $\\mathbf{b}_1 = \\frac{2\\pi}{a} \\hat{\\mathbf{x}}$ and $\\mathbf{b}_2 = \\frac{2\\pi}{a} \\hat{\\mathbf{y}}$, for integer indices $m,n \\in \\{-N, \\ldots, N\\}$. Use the truncation parameter $N$ provided in each test case. For each test case, assemble the Hermitian matrix representing the TE operator in the plane-wave basis for a specified Bloch wave vector $\\mathbf{k}$ within the first Brillouin zone, solve the eigenvalue problem to obtain the eigenvalues corresponding to $\\omega^2/c^2$, and then compute the dimensionless normalized frequencies $\\Omega = \\frac{\\omega a}{2\\pi c}$. For each test case, return the $3$ smallest nonnegative normalized frequencies, sorted in ascending order, and rounded to $6$ decimal places. All quantities in the final output must be dimensionless numbers, so no physical units should be attached to the outputs.\n\nUse the following test suite, each specified as $\\{a, R, \\varepsilon_r, \\varepsilon_b, N, \\mathbf{k}\\}$ where $\\mathbf{k} = (k_x, k_y)$ and each component is given as a multiple of $\\pi/a$ to ensure coverage of high-symmetry and interior points of the Brillouin zone:\n\n- Test case $1$ (happy path interior point): $a = 1.0$, $R = 0.2 a$, $\\varepsilon_r = 12.0$, $\\varepsilon_b = 1.0$, $N = 1$, $\\mathbf{k} = \\left(0.35 \\cdot \\frac{\\pi}{a}, 0.0\\right)$.\n- Test case $2$ (high-symmetry $X$ point): $a = 1.0$, $R = 0.2 a$, $\\varepsilon_r = 12.0$, $\\varepsilon_b = 1.0$, $N = 1$, $\\mathbf{k} = \\left(1.0 \\cdot \\frac{\\pi}{a}, 0.0\\right)$.\n- Test case $3$ (high-symmetry $M$ point): $a = 1.0$, $R = 0.2 a$, $\\varepsilon_r = 12.0$, $\\varepsilon_b = 1.0$, $N = 1$, $\\mathbf{k} = \\left(1.0 \\cdot \\frac{\\pi}{a}, 1.0 \\cdot \\frac{\\pi}{a}\\right)$.\n- Test case $4$ (edge case: very low dielectric contrast): $a = 1.0$, $R = 0.2 a$, $\\varepsilon_r = 1.05$, $\\varepsilon_b = 1.0$, $N = 1$, $\\mathbf{k} = \\left(0.3 \\cdot \\frac{\\pi}{a}, 0.3 \\cdot \\frac{\\pi}{a}\\right)$.\n- Test case $5$ (edge case: zero-radius rods, uniform medium with index $n = \\sqrt{\\varepsilon_b}$): $a = 1.0$, $R = 0.0$, $\\varepsilon_r = 12.0$ (unused in this case), $\\varepsilon_b = 2.25$, $N = 1$, $\\mathbf{k} = \\left(0.6 \\cdot \\frac{\\pi}{a}, 0.0\\right)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each test case result itself being a list of three floats rounded to $6$ decimal places (e.g., $[\\,[0.123456,0.234567,0.345678],\\ldots\\,]$). The results must be computed by constructing and solving the TE-mode PWE eigenproblem derived from first principles for the specified parameters. No external input should be required; the program must be fully self-contained.", "solution": "The problem is scientifically grounded, well-posed, objective, and contains all necessary information for a unique solution. It is a canonical problem in computational photonics. Therefore, it is valid and a solution will be provided.\n\nThe derivation of the Plane-Wave Expansion (PWE) method for Transverse Electric (TE) modes begins with the source-free, time-harmonic Maxwell's equations in a linear, non-magnetic medium:\n$$ \\nabla \\times \\mathbf{E} = i\\omega\\mu_0 \\mathbf{H} \\quad (1) $$\n$$ \\nabla \\times \\mathbf{H} = -i\\omega\\varepsilon_0 \\varepsilon(\\mathbf{r}) \\mathbf{E} \\quad (2) $$\nHere, $\\mathbf{E}$ and $\\mathbf{H}$ are the complex phasors of the electric and magnetic fields, $\\omega$ is the angular frequency, $\\varepsilon_0$ and $\\mu_0$ are the vacuum permittivity and permeability, and $\\varepsilon(\\mathbf{r})$ is the position-dependent relative permittivity of the medium.\n\nTo obtain a wave equation solely in terms of the magnetic field $\\mathbf{H}$, we solve equation $(2)$ for $\\mathbf{E}$:\n$$ \\mathbf{E} = \\frac{i}{\\omega\\varepsilon_0 \\varepsilon(\\mathbf{r})} \\nabla \\times \\mathbf{H} $$\nSubstituting this expression for $\\mathbf{E}$ into equation $(1)$ yields:\n$$ \\nabla \\times \\left( \\frac{i}{\\omega\\varepsilon_0 \\varepsilon(\\mathbf{r})} \\nabla \\times \\mathbf{H} \\right) = i\\omega\\mu_0 \\mathbf{H} $$\nDefining the inverse relative permittivity $\\eta(\\mathbf{r}) = 1/\\varepsilon(\\mathbf{r})$ and using the vacuum speed of light $c = 1/\\sqrt{\\varepsilon_0\\mu_0}$, we simplify the equation to the master wave equation for $\\mathbf{H}$:\n$$ \\nabla \\times \\left( \\eta(\\mathbf{r}) \\nabla \\times \\mathbf{H} \\right) = \\frac{\\omega^2}{c^2} \\mathbf{H} \\quad (3) $$\n\nFor a two-dimensional structure invariant in the $z$-direction, and for TE-polarized modes, the magnetic field is confined to the out-of-plane direction, $\\mathbf{H}(\\mathbf{r}) = H_z(x, y)\\hat{\\mathbf{z}}$, while the electric field lies in the $xy$-plane. The operator $\\nabla$ is now taken as the in-plane gradient, $\\nabla = \\hat{\\mathbf{x}}\\frac{\\partial}{\\partial x} + \\hat{\\mathbf{y}}\\frac{\\partial}{\\partial y}$. The curl of $\\mathbf{H}$ is:\n$$ \\nabla \\times \\mathbf{H} = \\nabla \\times (H_z \\hat{\\mathbf{z}}) = (\\nabla H_z) \\times \\hat{\\mathbf{z}} = \\frac{\\partial H_z}{\\partial y}\\hat{\\mathbf{x}} - \\frac{\\partial H_z}{\\partial x}\\hat{\\mathbf{y}} $$\nThe term $\\eta(\\mathbf{r}) \\nabla \\times \\mathbf{H}$ is an in-plane vector field. Taking its curl results in a vector purely in the $\\hat{\\mathbf{z}}$ direction:\n$$ \\nabla \\times (\\eta \\nabla \\times \\mathbf{H}) = \\hat{\\mathbf{z}} \\left( \\frac{\\partial}{\\partial x} \\left(-\\eta \\frac{\\partial H_z}{\\partial x} \\right) - \\frac{\\partial}{\\partial y} \\left(\\eta \\frac{\\partial H_z}{\\partial y} \\right) \\right) = - \\hat{\\mathbf{z}} \\left( \\nabla \\cdot (\\eta(\\mathbf{r}) \\nabla H_z) \\right) $$\nSubstituting this back into equation $(3)$ and cancelling the $\\hat{\\mathbf{z}}$ unit vector from both sides, we obtain the scalar wave equation for $H_z(x,y)$:\n$$ - \\nabla \\cdot \\left( \\eta(\\mathbf{r}) \\nabla H_z(\\mathbf{r}) \\right) = \\frac{\\omega^2}{c^2} H_z(\\mathbf{r}) \\quad (4) $$\n\nThe photonic crystal is periodic, so its inverse permittivity $\\eta(\\mathbf{r})$ can be expanded in a Fourier series over the reciprocal lattice vectors $\\mathbf{G}$:\n$$ \\eta(\\mathbf{r}) = \\sum_{\\mathbf{G}} \\eta_{\\mathbf{G}} e^{i\\mathbf{G}\\cdot\\mathbf{r}} $$\nwhere the Fourier coefficients are given by $\\eta_{\\mathbf{G}} = \\frac{1}{A} \\int_{\\text{cell}} \\eta(\\mathbf{r}) e^{-i\\mathbf{G}\\cdot\\mathbf{r}} d\\mathbf{r}$, with $A$ being the area of the unit cell.\n\nAccording to Bloch's theorem, the solution $H_z$ for a given Bloch wave vector $\\mathbf{k}$ can be written as a plane-wave expansion:\n$$ H_z(\\mathbf{r}) = \\sum_{\\mathbf{G}'} h_{\\mathbf{G}'} e^{i(\\mathbf{k}+\\mathbf{G}')\\cdot\\mathbf{r}} $$\nwhere $h_{\\mathbf{G}'}$ are the expansion coefficients.\n\nWe now substitute these two expansions into the scalar wave equation $(4)$. The gradient of a single plane-wave component is $\\nabla e^{i(\\mathbf{k}+\\mathbf{G}')\\cdot\\mathbf{r}} = i(\\mathbf{k}+\\mathbf{G}')e^{i(\\mathbf{k}+\\mathbf{G}')\\cdot\\mathbf{r}}$.\nThe left side of $(4)$ becomes:\n$$ \\text{LHS} = - \\nabla \\cdot \\left( \\left(\\sum_{\\mathbf{G}''} \\eta_{\\mathbf{G}''} e^{i\\mathbf{G}''\\cdot\\mathbf{r}}\\right) \\nabla \\left( \\sum_{\\mathbf{G}'} h_{\\mathbf{G}'} e^{i(\\mathbf{k}+\\mathbf{G}')\\cdot\\mathbf{r}} \\right) \\right) $$\n$$ = - \\nabla \\cdot \\left( \\sum_{\\mathbf{G}'' , \\mathbf{G}'} \\eta_{\\mathbf{G}''} i(\\mathbf{k}+\\mathbf{G}') h_{\\mathbf{G}'} e^{i(\\mathbf{k}+\\mathbf{G}'+\\mathbf{G}'')\\cdot\\mathbf{r}} \\right) $$\nApplying the divergence operator yields another factor of $i(\\mathbf{k}+\\mathbf{G}'+\\mathbf{G}'')$:\n$$ = \\sum_{\\mathbf{G}'' , \\mathbf{G}'} (\\mathbf{k}+\\mathbf{G}'+\\mathbf{G}'') \\cdot (\\mathbf{k}+\\mathbf{G}') \\eta_{\\mathbf{G}''} h_{\\mathbf{G}'} e^{i(\\mathbf{k}+\\mathbf{G}'+\\mathbf{G}'')\\cdot\\mathbf{r}} $$\nTo convert this double summation into a matrix-vector equation, we project it onto a single basis function $e^{i(\\mathbf{k}+\\mathbf{G})\\cdot\\mathbf{r}}$ by integrating over the unit cell and invoking orthogonality. This is equivalent to equating the coefficients of $e^{i\\mathbf{G}\\cdot\\mathbf{r}}$ in the cell-periodic part. Let the total wave vector be $\\mathbf{K} = \\mathbf{k}+\\mathbf{G}$, which means we set $\\mathbf{G} = \\mathbf{G}'+\\mathbf{G}''$. Substituting $\\mathbf{G}'' = \\mathbf{G}-\\mathbf{G}'$:\n$$ \\text{LHS coefficient for } e^{i(\\mathbf{k}+\\mathbf{G})\\cdot\\mathbf{r}} = \\sum_{\\mathbf{G}'} (\\mathbf{k}+\\mathbf{G}) \\cdot (\\mathbf{k}+\\mathbf{G}') \\eta_{\\mathbf{G}-\\mathbf{G}'} h_{\\mathbf{G}'} $$\nThe right side of $(4)$ is $\\frac{\\omega^2}{c^2} \\sum_{\\mathbf{G}'} h_{\\mathbf{G}'} e^{i(\\mathbf{k}+\\mathbf{G}')\\cdot\\mathbf{r}}$. Its coefficient for $e^{i(\\mathbf{k}+\\mathbf{G})\\cdot\\mathbf{r}}$ is simply $\\frac{\\omega^2}{c^2} h_{\\mathbf{G}}$.\nEquating the coefficients gives the eigenvalue equation for each reciprocal vector $\\mathbf{G}$:\n$$ \\sum_{\\mathbf{G}'} (\\mathbf{k}+\\mathbf{G}) \\cdot (\\mathbf{k}+\\mathbf{G}') \\eta_{\\mathbf{G}-\\mathbf{G}'} h_{\\mathbf{G}'} = \\frac{\\omega^2}{c^2} h_{\\mathbf{G}} $$\nThis is a standard matrix eigenvalue problem, $M\\mathbf{h} = \\lambda \\mathbf{h}$, where the vector $\\mathbf{h}$ contains the coefficients $h_{\\mathbf{G}}$, the eigenvalues are $\\lambda = \\omega^2/c^2$, and the matrix elements are:\n$$ M_{\\mathbf{G},\\mathbf{G}'} = |\\mathbf{k}+\\mathbf{G}| |\\mathbf{k}+\\mathbf{G}'| \\cos(\\theta_{\\mathbf{G},\\mathbf{G}'}) \\eta_{\\mathbf{G}-\\mathbf{G}'} = (\\mathbf{k}+\\mathbf{G}) \\cdot (\\mathbf{k}+\\mathbf{G}') \\eta_{\\mathbf{G}-\\mathbf{G}'} $$\n\nFor the specified geometry (circular rods of radius $R$ and permittivity $\\varepsilon_r$ in a background of $\\varepsilon_b$ on a square lattice of constant $a$), $\\eta(\\mathbf{r})$ is $1/\\varepsilon_r$ inside the rod and $1/\\varepsilon_b$ outside. The area of the unit cell is $A = a^2$. The Fourier coefficients $\\eta_{\\mathbf{G}}$ are calculated as follows.\nFor $\\mathbf{G} = \\mathbf{0}$:\n$$ \\eta_{\\mathbf{0}} = \\frac{1}{A} \\left( \\frac{1}{\\varepsilon_r} (\\pi R^2) + \\frac{1}{\\varepsilon_b} (a^2 - \\pi R^2) \\right) = f \\frac{1}{\\varepsilon_r} + (1-f) \\frac{1}{\\varepsilon_b} $$\nwhere $f = \\pi R^2/a^2$ is the filling fraction.\nFor $\\mathbf{G} \\ne \\mathbf{0}$, with $G = |\\mathbf{G}|$:\n$$ \\eta_{\\mathbf{G}} = \\frac{1}{A} \\left( \\frac{1}{\\varepsilon_r} - \\frac{1}{\\varepsilon_b} \\right) \\int_{|\\mathbf{r}| \\le R} e^{-i\\mathbf{G}\\cdot\\mathbf{r}} d\\mathbf{r} = \\left( \\frac{1}{\\varepsilon_r} - \\frac{1}{\\varepsilon_b} \\right) f \\frac{2J_1(GR)}{GR} $$\nwhere $J_1$ is the Bessel function of the first kind of order one.\n\nThe computational procedure is to:\n1. Define the reciprocal lattice vectors $\\mathbf{G} = m \\mathbf{b}_1 + n \\mathbf{b}_2$ for the chosen truncation $m, n \\in \\{-N, \\dots, N\\}$.\n2. Calculate the matrix of Fourier coefficients $\\eta_{\\mathbf{G}-\\mathbf{G}'}$.\n3. Assemble the Hermitian matrix $M_{\\mathbf{G},\\mathbf{G}'}$.\n4. Solve the eigenvalue problem to find the eigenvalues $\\lambda_i = (\\omega_i/c)^2$.\n5. Compute the normalized frequencies $\\Omega_i = \\frac{\\omega_i a}{2\\pi c} = \\frac{a\\sqrt{\\lambda_i}}{2\\pi}$.\n\nThis procedure is implemented in the following code for the specified test cases.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import j1\nfrom scipy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Main function to solve the PWE problem for all test cases.\n    \"\"\"\n    test_cases = [\n        # a, R_factor, eps_r, eps_b, N, kx_factor, ky_factor\n        (1.0, 0.2, 12.0, 1.0, 1, 0.35, 0.0), # case 1\n        (1.0, 0.2, 12.0, 1.0, 1, 1.0, 0.0),  # case 2\n        (1.0, 0.2, 12.0, 1.0, 1, 1.0, 1.0),  # case 3\n        (1.0, 0.2, 1.05, 1.0, 1, 0.3, 0.3),  # case 4\n        (1.0, 0.0, 12.0, 2.25, 1, 0.6, 0.0), # case 5\n    ]\n\n    all_results = []\n    for case in test_cases:\n        a, R_factor, eps_r, eps_b, N, kx_factor, ky_factor = case\n        R = R_factor * a\n        # k vector components are given as multiples of pi/a\n        kx = kx_factor * np.pi / a\n        ky = ky_factor * np.pi / a\n        \n        frequencies = calculate_bands(a, R, eps_r, eps_b, N, kx, ky)\n        rounded_frequencies = [round(f, 6) for f in frequencies]\n        all_results.append(rounded_frequencies)\n\n    # Final print statement in the exact required format.\n    # The str() on a list gives a representation with spaces, e.g., '[0.1, 0.2]'.\n    # This is fine as the problem example also shows this.\n    # Using repr() could be an alternative for more compact string. But str() is more standard.\n    # To be extremely precise with formatting and remove spaces:\n    formatted_results = []\n    for res_list in all_results:\n        res_str = '[' + ','.join([f\"{x:.6f}\" for x in res_list]) + ']'\n        formatted_results.append(res_str)\n    print(f\"[{','.join(formatted_results)}]\")\n\ndef calculate_bands(a, R, eps_r, eps_b, N, kx, ky):\n    \"\"\"\n    Calculates the band structure for a 2D photonic crystal using PWE.\n\n    Args:\n        a (float): Lattice constant.\n        R (float): Radius of the dielectric rods.\n        eps_r (float): Relative permittivity of the rods.\n        eps_b (float): Relative permittivity of the background.\n        N (int): Truncation parameter for the plane-wave basis.\n        kx (float): x-component of the Bloch wave vector.\n        ky (float): y-component of the Bloch wave vector.\n\n    Returns:\n        list: The 3 smallest non-negative normalized frequencies.\n    \"\"\"\n    # 1. Generate reciprocal lattice vectors for the basis\n    basis_indices = []\n    for m in range(-N, N + 1):\n        for n in range(-N, N + 1):\n            basis_indices.append((m, n))\n    \n    num_plane_waves = len(basis_indices)\n\n    # 2. Compute Fourier coefficients of the inverse permittivity eta(r) = 1/eps(r)\n    # The matrix M requires eta(G-G'), so we need G-G' where G, G' are basis vectors.\n    # The maximum indices for m and n in G-G' are +/- 2N.\n    max_idx = 2 * N\n    eta_coeffs = np.zeros((2 * max_idx + 1, 2 * max_idx + 1), dtype=float)\n\n    f = np.pi * (R/a)**2\n    inv_eps_r = 1.0 / eps_r\n    inv_eps_b = 1.0 / eps_b\n    delta_inv_eps = inv_eps_r - inv_eps_b\n\n    for m_diff in range(-max_idx, max_idx + 1):\n        for n_diff in range(-max_idx, max_idx + 1):\n            if m_diff == 0 and n_diff == 0:\n                eta = f * inv_eps_r + (1 - f) * inv_eps_b\n            else:\n                G_mag = (2 * np.pi / a) * np.sqrt(m_diff**2 + n_diff**2)\n                arg = G_mag * R\n                # The limit of 2*j1(x)/x as x -> 0 is 1. j1(0)=0 so handle explicitly.\n                if np.isclose(arg, 0.0):\n                    bessel_term = 1.0\n                else:\n                    bessel_term = 2 * j1(arg) / arg\n                \n                eta = delta_inv_eps * f * bessel_term\n            \n            eta_coeffs[m_diff + max_idx, n_diff + max_idx] = eta\n\n    # 3. Assemble the Hermitian matrix M\n    M = np.zeros((num_plane_waves, num_plane_waves), dtype=np.float64)\n    k_vec = np.array([kx, ky])\n    \n    # Pre-compute G and K=k+G vectors\n    b1 = np.array([2 * np.pi / a, 0.0])\n    b2 = np.array([0.0, 2 * np.pi / a])\n    G_vectors = [m * b1 + n * b2 for m, n in basis_indices]\n    K_vectors = [k_vec + G for G in G_vectors]\n\n    for i, (m_i, n_i) in enumerate(basis_indices):\n        for j, (m_j, n_j) in enumerate(basis_indices):\n            m_diff = m_i - m_j\n            n_diff = n_i - n_j\n            \n            eta_val = eta_coeffs[m_diff + max_idx, n_diff + max_idx]\n            \n            K_i = K_vectors[i]\n            K_j = K_vectors[j]\n            \n            dot_product = np.dot(K_i, K_j)\n            M[i, j] = dot_product * eta_val\n\n    # 4. Solve the eigenvalue problem\n    # eigh is for Hermitian matrices and returns sorted eigenvalues\n    eigenvalues = eigh(M, eigvals_only=True)\n\n    # 5. Calculate normalized frequencies\n    # Omega = (omega * a) / (2 * pi * c)\n    # Eigenvalues are lambda = (omega/c)^2\n    # So Omega = (a / (2*pi)) * sqrt(lambda)\n    \n    # Filter for non-negative eigenvalues and calculate frequencies\n    omegas = []\n    for eig in eigenvalues:\n        if eig >= -1e-9: # Use a small tolerance for numerical noise\n            freq = (a / (2.0 * np.pi)) * np.sqrt(max(0, eig))\n            omegas.append(freq)\n\n    # Return the 3 smallest frequencies, which will be the first 3 due to sorting by eigh\n    return omegas[:3]\n\n\nsolve()\n\n```", "id": "3289443"}]}