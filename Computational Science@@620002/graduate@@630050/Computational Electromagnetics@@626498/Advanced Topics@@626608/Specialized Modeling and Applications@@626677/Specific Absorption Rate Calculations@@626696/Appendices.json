{"hands_on_practices": [{"introduction": "Before tackling complex, anatomically-detailed models, mastering the fundamental physics of electromagnetic absorption is essential. This exercise [@problem_id:3349686] explores the canonical problem of a conducting sphere in a uniform electric field, a foundational scenario in bioelectromagnetics. By analytically deriving the internal electric field and the resulting absorbed power from first principles, you will reinforce your understanding of quasi-static theory and boundary value problems, and establish a vital benchmark for validating numerical simulation tools.", "problem": "Consider a homogeneous, isotropic, electrically conducting sphere of radius $a$ and material parameters conductivity $\\sigma_{s}$ and real permittivity $\\epsilon_{s}$, embedded in a lossless, homogeneous, isotropic background medium of real permittivity $\\epsilon_{m}$ and permeability $\\mu_{m}$ with negligible conductivity. The sphere is illuminated by a uniform time-harmonic electric field $\\mathbf{E}_{0}$ of angular frequency $\\omega$ oriented along the $z$-axis. Assume the quasi-static limit $\\omega a \\sqrt{\\mu_{m}\\epsilon_{m}} \\ll 1$, so that field variation across the sphere is negligible compared to the electromagnetic wavelength and magnetoquasistatic effects can be ignored. Define the complex permittivity of the sphere as $\\tilde{\\epsilon}_{s} = \\epsilon_{s} - j \\frac{\\sigma_{s}}{\\omega}$ and that of the background medium as $\\tilde{\\epsilon}_{m} = \\epsilon_{m}$.\n\nStarting from Maxwell’s equations in the frequency domain and the appropriate interface conditions at $r=a$, derive the scalar potential everywhere, and from it obtain the spatial distribution of the electric field magnitude $|\\mathbf{E}(r,\\theta)|$ inside and outside the sphere. Then, using the time-average dissipated power density due to electrical conduction, compute the integrated absorbed power within the sphere by exact analytical integration over its volume. Your derivation should explicitly show how the quasi-static assumption leads to a Laplace equation for the potential and how the interface conditions determine the internal field amplitude.\n\nExpress your final answer as a single closed-form analytical expression for the total absorbed power in the sphere in terms of $a$, $\\sigma_{s}$, $\\epsilon_{s}$, $\\epsilon_{m}$, $\\omega$, and $|\\mathbf{E}_{0}|$. Express the absorbed power in watts. No numerical substitution is required, and no approximations beyond the stated quasi-static limit are permitted. The final expression must be a single analytical formula; do not present intermediate equations as your final answer.", "solution": "The problem as stated is scientifically grounded, well-posed, and objective. It represents a canonical problem in quasi-static electromagnetic theory. All necessary parameters and conditions are provided, and there are no internal contradictions or violations of physical principles. Therefore, the problem is valid, and a solution will be provided.\n\nThe problem asks for the total power absorbed by a conducting sphere illuminated by a uniform time-harmonic electric field in the quasi-static limit. We begin with Maxwell's equations in the frequency domain for a source-free region:\n$$\n\\nabla \\times \\mathbf{E} = -j\\omega \\mathbf{B}\n$$\n$$\n\\nabla \\cdot \\mathbf{D} = 0\n$$\n$$\n\\nabla \\times \\mathbf{H} = j\\omega \\mathbf{D} + \\mathbf{J}\n$$\n$$\n\\nabla \\cdot \\mathbf{B} = 0\n$$\nThe constitutive relations are $\\mathbf{D} = \\tilde{\\epsilon} \\mathbf{E}$, $\\mathbf{B} = \\mu \\mathbf{H}$, and $\\mathbf{J} = \\sigma \\mathbf{E}$. The problem specifies the quasi-static approximation, $\\omega a \\sqrt{\\mu_m \\epsilon_m} \\ll 1$, where the spatial scale of the object ($a$) is much smaller than the wavelength in the medium. In this limit, the time variation of the magnetic field is slow enough that its induced electric field is negligible compared to the electrostatic field. Thus, we can approximate the electric field as being curl-free: $\\nabla \\times \\mathbf{E} \\approx 0$.\n\nThis approximation allows us to define a scalar potential $\\Phi$ such that $\\mathbf{E} = -\\nabla \\Phi$. Substituting this into the divergence equation, $\\nabla \\cdot \\mathbf{D} = 0$, and using the complex permittivity $\\tilde{\\epsilon}$ to account for both dielectric and conductive properties ($\\mathbf{D} + \\frac{\\mathbf{J}}{j\\omega} = (\\epsilon - j\\frac{\\sigma}{\\omega})\\mathbf{E} = \\tilde{\\epsilon}\\mathbf{E}$), we have:\n$$\n\\nabla \\cdot (\\tilde{\\epsilon} \\mathbf{E}) = \\nabla \\cdot (-\\tilde{\\epsilon} \\nabla \\Phi) = 0\n$$\nWithin each homogeneous region (inside and outside the sphere), $\\tilde{\\epsilon}$ is constant, so the equation simplifies to Laplace's equation for the potential:\n$$\n\\nabla^2 \\Phi = 0\n$$\nWe solve this equation in spherical coordinates $(r, \\theta, \\phi)$ for the potential inside the sphere, $\\Phi_{in}$ for $r < a$, and outside the sphere, $\\Phi_{out}$ for $r > a$. Due to the orientation of the incident field $\\mathbf{E}_0 = |\\mathbf{E}_0|\\hat{\\mathbf{z}}$, the problem has azimuthal symmetry, and the potential will be independent of $\\phi$. The general solution to Laplace's equation with azimuthal symmetry is a series of Legendre polynomials:\n$$\n\\Phi(r, \\theta) = \\sum_{n=0}^{\\infty} (A_n r^n + B_n r^{-n-1}) P_n(\\cos\\theta)\n$$\nOutside the sphere ($r > a$), the potential must approach the potential of the incident uniform field as $r \\to \\infty$. The incident potential is $\\Phi_{inc} = -|\\mathbf{E}_0| z = -|\\mathbf{E}_0| r \\cos\\theta = -|\\mathbf{E}_0| r P_1(\\cos\\theta)$. The total external potential is the sum of the incident potential and a scattered potential, which must vanish at infinity. Thus, the $A_n r^n$ terms for $n>1$ must be zero, and the $A_1$ term is fixed by the incident field.\n$$\n\\Phi_{out}(r, \\theta) = -|\\mathbf{E}_0| r \\cos\\theta + \\sum_{n=0}^{\\infty} B_n r^{-n-1} P_n(\\cos\\theta)\n$$\nInside the sphere ($r < a$), the potential must remain finite at the origin ($r=0$). This requires all $B_n$ coefficients to be zero.\n$$\n\\Phi_{in}(r, \\theta) = \\sum_{n=0}^{\\infty} A_n r^n P_n(\\cos\\theta)\n$$\nThe unknown coefficients $A_n$ and $B_n$ are determined by applying the boundary conditions at the spherical interface $r=a$:\n1.  Continuity of the tangential electric field, which implies continuity of the potential: $\\Phi_{in}(a, \\theta) = \\Phi_{out}(a, \\theta)$.\n2.  Continuity of the normal component of the electric displacement field: $\\tilde{\\epsilon}_s \\frac{\\partial \\Phi_{in}}{\\partial r} \\Big|_{r=a} = \\tilde{\\epsilon}_m \\frac{\\partial \\Phi_{out}}{\\partial r} \\Big|_{r=a}$.\n\nApplying the first boundary condition:\n$$\n\\sum_{n=0}^{\\infty} A_n a^n P_n(\\cos\\theta) = -|\\mathbf{E}_0| a \\cos\\theta + \\sum_{n=0}^{\\infty} B_n a^{-n-1} P_n(\\cos\\theta)\n$$\nUsing $P_1(\\cos\\theta) = \\cos\\theta$ and matching coefficients of $P_n(\\cos\\theta)$ due to their orthogonality, for $n=1$:\n$$\nA_1 a = -|\\mathbf{E}_0| a + B_1 a^{-2} \\quad (1)\n$$\nAnd for $n \\neq 1$:\n$$\nA_n a^n = B_n a^{-n-1} \\quad (2)\n$$\nApplying the second boundary condition, we first find the radial derivatives:\n$$\n\\frac{\\partial \\Phi_{in}}{\\partial r} = \\sum_{n=0}^{\\infty} n A_n r^{n-1} P_n(\\cos\\theta)\n$$\n$$\n\\frac{\\partial \\Phi_{out}}{\\partial r} = -|\\mathbf{E}_0| \\cos\\theta - \\sum_{n=0}^{\\infty} (n+1) B_n r^{-n-2} P_n(\\cos\\theta)\n$$\nAt $r=a$, we have:\n$$\n\\tilde{\\epsilon}_s \\sum_{n=0}^{\\infty} n A_n a^{n-1} P_n(\\cos\\theta) = \\tilde{\\epsilon}_m \\left( -|\\mathbf{E}_0| \\cos\\theta - \\sum_{n=0}^{\\infty} (n+1) B_n a^{-n-2} P_n(\\cos\\theta) \\right)\n$$\nMatching coefficients for $n=1$:\n$$\n\\tilde{\\epsilon}_s A_1 = \\tilde{\\epsilon}_m ( -|\\mathbf{E}_0| - 2 B_1 a^{-3} ) \\quad (3)\n$$\nAnd for $n \\neq 1$:\n$$\nn \\tilde{\\epsilon}_s A_n a^{n-1} = -(n+1) \\tilde{\\epsilon}_m B_n a^{-n-2} \\quad (4)\n$$\nFor $n \\neq 1$, substituting Eq. $(2)$ into Eq. $(4)$ gives $n \\tilde{\\epsilon}_s (B_n a^{-2n-1}) a^{n-1} = -(n+1) \\tilde{\\epsilon}_m B_n a^{-n-2}$, which simplifies to $(n \\tilde{\\epsilon}_s + (n+1) \\tilde{\\epsilon}_m) B_n = 0$. Since $\\tilde{\\epsilon}_s$ and $\\tilde{\\epsilon}_m$ are positive or have positive real parts, the term in parentheses is non-zero for $n \\ge 0, n \\neq 1$. Therefore, $B_n=0$ and from Eq. $(2)$, $A_n=0$ for all $n \\neq 1$. The trivial $n=0$ case corresponds to a constant potential offset, which we set to zero.\n\nNow we solve the system for $n=1$. From Eq. $(1)$, $B_1 = a^3(A_1 + |\\mathbf{E}_0|)$. Substituting this into Eq. $(3)$:\n$$\n\\tilde{\\epsilon}_s A_1 = -\\tilde{\\epsilon}_m |\\mathbf{E}_0| - 2 \\tilde{\\epsilon}_m a^{-3} [a^3(A_1 + |\\mathbf{E}_0|)]\n$$\n$$\n\\tilde{\\epsilon}_s A_1 = -\\tilde{\\epsilon}_m |\\mathbf{E}_0| - 2 \\tilde{\\epsilon}_m (A_1 + |\\mathbf{E}_0|) = -3\\tilde{\\epsilon}_m |\\mathbf{E}_0| - 2\\tilde{\\epsilon}_m A_1\n$$\n$$\n(\\tilde{\\epsilon}_s + 2\\tilde{\\epsilon}_m) A_1 = -3\\tilde{\\epsilon}_m |\\mathbf{E}_0|\n$$\n$$\nA_1 = - \\frac{3\\tilde{\\epsilon}_m}{\\tilde{\\epsilon}_s + 2\\tilde{\\epsilon}_m} |\\mathbf{E}_0|\n$$\nThe potential inside the sphere is then $\\Phi_{in}(r, \\theta) = A_1 r \\cos\\theta$. The electric field inside the sphere is obtained from $\\mathbf{E}_{in} = -\\nabla \\Phi_{in}$:\n$$\n\\mathbf{E}_{in} = -\\nabla(A_1 r \\cos\\theta) = -\\nabla(A_1 z) = -A_1 \\hat{\\mathbf{z}} = \\frac{3\\tilde{\\epsilon}_m}{\\tilde{\\epsilon}_s + 2\\tilde{\\epsilon}_m} |\\mathbf{E}_0| \\hat{\\mathbf{z}}\n$$\nWe find that the electric field inside the sphere is uniform. Substituting the complex permittivities $\\tilde{\\epsilon}_{s} = \\epsilon_{s} - j \\frac{\\sigma_{s}}{\\omega}$ and $\\tilde{\\epsilon}_{m} = \\epsilon_{m}$:\n$$\n\\mathbf{E}_{in} = \\frac{3 \\epsilon_m}{(\\epsilon_s - j\\sigma_s/\\omega) + 2\\epsilon_m} \\mathbf{E}_{0} = \\frac{3 \\epsilon_m}{(\\epsilon_s + 2\\epsilon_m) - j(\\sigma_s/\\omega)} \\mathbf{E}_{0}\n$$\nThe time-average power density dissipated due to conduction is given by $P_d = \\frac{1}{2} \\sigma_s |\\mathbf{E}_{in}|^2 = \\frac{1}{2} \\sigma_s (\\mathbf{E}_{in} \\cdot \\mathbf{E}_{in}^*)$. The squared magnitude of the internal field is:\n$$\n|\\mathbf{E}_{in}|^2 = \\left| \\frac{3 \\epsilon_m}{(\\epsilon_s + 2\\epsilon_m) - j(\\sigma_s/\\omega)} \\right|^2 |\\mathbf{E}_0|^2 = \\frac{9 \\epsilon_m^2}{(\\epsilon_s + 2\\epsilon_m)^2 + (\\sigma_s/\\omega)^2} |\\mathbf{E}_0|^2\n$$\nThe power density is therefore:\n$$\nP_d = \\frac{1}{2} \\sigma_s \\frac{9 \\epsilon_m^2}{(\\epsilon_s + 2\\epsilon_m)^2 + (\\sigma_s/\\omega)^2} |\\mathbf{E}_0|^2\n$$\nSince $\\mathbf{E}_{in}$ is uniform inside the sphere, $P_d$ is also constant throughout the sphere's volume. The total absorbed power, $P_{abs}$, is found by integrating $P_d$ over the volume of the sphere, $V = \\frac{4}{3}\\pi a^3$.\n$$\nP_{abs} = \\iiint_V P_d dV = P_d \\cdot V\n$$\n$$\nP_{abs} = \\left( \\frac{1}{2} \\sigma_s \\frac{9 \\epsilon_m^2}{(\\epsilon_s + 2\\epsilon_m)^2 + (\\sigma_s/\\omega)^2} |\\mathbf{E}_0|^2 \\right) \\left( \\frac{4}{3}\\pi a^3 \\right)\n$$\n$$\nP_{abs} = \\frac{9 \\times 4}{2 \\times 3} \\pi a^3 \\sigma_s \\epsilon_m^2 \\frac{|\\mathbf{E}_0|^2}{(\\epsilon_s + 2\\epsilon_m)^2 + (\\sigma_s/\\omega)^2}\n$$\n$$\nP_{abs} = 6 \\pi a^3 \\sigma_s \\epsilon_m^2 \\frac{|\\mathbf{E}_0|^2}{(\\epsilon_s + 2\\epsilon_m)^2 + (\\sigma_s/\\omega)^2}\n$$\nTo obtain a form without a fraction in the denominator, we can multiply the numerator and denominator by $\\omega^2$:\n$$\nP_{abs} = \\frac{6 \\pi a^3 \\sigma_s \\omega^2 \\epsilon_m^2 |\\mathbf{E}_0|^2}{\\omega^2(\\epsilon_s + 2\\epsilon_m)^2 + \\sigma_s^2}\n$$\nThis is the final closed-form expression for the total absorbed power in the sphere. The electric field outside the sphere can be found from $\\mathbf{E}_{out}=-\\nabla\\Phi_{out}$ but is not necessary for this calculation.", "answer": "$$\\boxed{\\frac{6 \\pi a^3 \\sigma_{s} \\omega^2 \\epsilon_{m}^2 |\\mathbf{E}_{0}|^2}{\\omega^2(\\epsilon_{s} + 2\\epsilon_{m})^2 + \\sigma_{s}^2}}$$", "id": "3349686"}, {"introduction": "Moving from local power absorption to regulatory compliance requires a detailed understanding of standardized averaging procedures. This practice [@problem_id:3349634] explores the real-world implications of mass-averaging Specific Absorption Rate (SAR) over $1$-gram versus $10$-gram volumes, a key distinction in international safety guidelines. Through a thought experiment based on physically plausible tissue properties, you will discover how anatomical heterogeneity and field localization can cause the reported 'hotspot' to shift, illustrating a critical and non-intuitive challenge in compliance engineering.", "problem": "Consider a numerical compliance verification for localized Specific Absorption Rate (SAR) under two regional protocols that differ only in the averaging mass: Protocol-$1\\,\\mathrm{g}$ and Protocol-$10\\,\\mathrm{g}$. Specific Absorption Rate (SAR) is defined from first principles by Joule heating and mass-normalization: for time-harmonic fields, the time-averaged dissipated power density is $p(\\mathbf{r})=\\sigma(\\mathbf{r})\\,\\lvert E_{\\mathrm{rms}}(\\mathbf{r})\\rvert^{2}$, and the local SAR is $\\mathrm{SAR}(\\mathbf{r})=p(\\mathbf{r})/\\rho(\\mathbf{r})$, where $\\sigma$ is the electrical conductivity, $\\rho$ is the mass density, and $E_{\\mathrm{rms}}$ is the root-mean-square electric field intensity. In protocol-specific compliance evaluation, the reported hotspot is the spatially contiguous region whose mass-averaged SAR over a kernel of fixed mass $m$ (either $m=1\\,\\mathrm{g}$ or $m=10\\,\\mathrm{g}$) attains the maximum value.\n\nA head model is illuminated by a handheld transmitter at a carrier frequency at which ohmic conduction dominates tissue heating. Two candidate hotspot neighborhoods are identified:\n\n- Location $A$ (superficial cortical rim near bone and cerebrospinal fluid), where the field is highly localized in a thin gray-matter layer and decays rapidly into adjacent tissues. Due to anatomical adjacency, any large mass kernel centered at $A$ inevitably includes substantial cortical bone and scalp fat.\n- Location $B$ (deep periventricular white-matter tract), where anisotropic conductivity aligns with major fiber bundles, producing an elongated region of moderately elevated field that persists over several grams of contiguous white matter.\n\nAssume the following tissue properties, densities, and representative root-mean-square field magnitudes within the relevant subregions at the two locations:\n- Gray matter (GM): $\\sigma_{\\mathrm{GM}}=0.80\\,\\mathrm{S/m}$, $\\rho_{\\mathrm{GM}}=1.04\\times10^{3}\\,\\mathrm{kg/m^{3}}$.\n- White matter (WM): $\\sigma_{\\mathrm{WM}}=0.60\\,\\mathrm{S/m}$, $\\rho_{\\mathrm{WM}}=1.03\\times10^{3}\\,\\mathrm{kg/m^{3}}$.\n- Cerebrospinal fluid (CSF): $\\sigma_{\\mathrm{CSF}}=2.00\\,\\mathrm{S/m}$, $\\rho_{\\mathrm{CSF}}=1.00\\times10^{3}\\,\\mathrm{kg/m^{3}}$.\n- Cortical bone: $\\sigma_{\\mathrm{bone}}=0.04\\,\\mathrm{S/m}$, $\\rho_{\\mathrm{bone}}=1.85\\times10^{3}\\,\\mathrm{kg/m^{3}}$.\n- Subcutaneous fat: $\\sigma_{\\mathrm{fat}}=0.10\\,\\mathrm{S/m}$, $\\rho_{\\mathrm{fat}}=0.92\\times10^{3}\\,\\mathrm{kg/m^{3}}$.\n\nRepresentative local field magnitudes:\n- At $A$: GM core $E_{\\mathrm{rms}}=100\\,\\mathrm{V/m}$, adjacent CSF $E_{\\mathrm{rms}}=40\\,\\mathrm{V/m}$, bone $E_{\\mathrm{rms}}=20\\,\\mathrm{V/m}$, fat $E_{\\mathrm{rms}}=30\\,\\mathrm{V/m}$.\n- At $B$: anisotropic WM tract $E_{\\mathrm{rms}}=70\\,\\mathrm{V/m}$, surrounding GM $E_{\\mathrm{rms}}=50\\,\\mathrm{V/m}$.\n\nTo mimic practical mass-averaging with contiguous kernels that expand until they accumulate the target mass, suppose that near each candidate hotspot the maximizing kernels have the following mass compositions:\n\n- Protocol-$1\\,\\mathrm{g}$ at $A$: GM mass $0.60\\,\\mathrm{g}$ and CSF mass $0.40\\,\\mathrm{g}$.\n- Protocol-$1\\,\\mathrm{g}$ at $B$: WM mass $1.00\\,\\mathrm{g}$.\n- Protocol-$10\\,\\mathrm{g}$ at $A$: GM mass $1.00\\,\\mathrm{g}$, CSF mass $1.00\\,\\mathrm{g}$, bone mass $5.00\\,\\mathrm{g}$, fat mass $3.00\\,\\mathrm{g}$.\n- Protocol-$10\\,\\mathrm{g}$ at $B$: WM mass $8.00\\,\\mathrm{g}$, GM mass $2.00\\,\\mathrm{g}$.\n\nUse only the definitions above (Joule heating and mass-normalized SAR) together with mass conservation to compute the mass-averaged SAR at each location for each protocol. Then determine which of the following statements is correct.\n\nA. Under Protocol-$1\\,\\mathrm{g}$, the higher hotspot is at $A$ with approximately $5.9\\,\\mathrm{W/kg}$; under Protocol-$10\\,\\mathrm{g}$, the higher hotspot is at $B$ with approximately $2.7\\,\\mathrm{W/kg}$. The ordering reverses because the $10\\,\\mathrm{g}$ kernel at $A$ is diluted by low-field, low-conductivity tissues (bone and fat), whereas anisotropy at $B$ sustains elevated fields over a larger contiguous mass.\n\nB. Under Protocol-$1\\,\\mathrm{g}$, the higher hotspot is at $B$ with approximately $2.9\\,\\mathrm{W/kg}$; under Protocol-$10\\,\\mathrm{g}$, the higher hotspot is at $A$ with approximately $1.1\\,\\mathrm{W/kg}$. The ordering reverses because including CSF near $A$ boosts the average at larger masses.\n\nC. No reversal occurs: $A$ is the worst-case for both Protocol-$1\\,\\mathrm{g}$ and Protocol-$10\\,\\mathrm{g}$ since adding high-conductivity CSF increases averaged SAR as the kernel grows.\n\nD. No reversal occurs: $B$ is the worst-case for both Protocol-$1\\,\\mathrm{g}$ and Protocol-$10\\,\\mathrm{g}$ because anisotropy reduces the Joule heating rate along the tract when the averaging kernel expands.", "solution": "We begin from the governing definitions. For time-harmonic fields, the time-averaged dissipated power density in a conductive medium is $p(\\mathbf{r})=\\sigma(\\mathbf{r})\\,\\lvert E_{\\mathrm{rms}}(\\mathbf{r})\\rvert^{2}$. The local Specific Absorption Rate (SAR) is $\\mathrm{SAR}(\\mathbf{r})=p(\\mathbf{r})/\\rho(\\mathbf{r})$. The mass-averaged SAR over a contiguous kernel $V$ of fixed mass $m=\\int_{V}\\rho(\\mathbf{r})\\,\\mathrm{d}V$ is\n\n$$\n\\mathrm{SAR}_{\\mathrm{avg}} = \\frac{1}{m}\\int_{V}\\rho(\\mathbf{r})\\,\\mathrm{SAR}(\\mathbf{r})\\,\\mathrm{d}V = \\frac{1}{m}\\int_{V}\\sigma(\\mathbf{r})\\,\\lvert E_{\\mathrm{rms}}(\\mathbf{r})\\rvert^{2}\\,\\mathrm{d}V.\n$$\n\nThus, for a kernel composed of subregions $i$ with approximately uniform $\\sigma_{i}$, $\\lvert E_{\\mathrm{rms},i}\\rvert$, and volume $V_{i}$, the mass-averaged SAR reduces to\n\n$$\n\\mathrm{SAR}_{\\mathrm{avg}} = \\frac{1}{m}\\sum_{i}\\sigma_{i}\\,\\lvert E_{\\mathrm{rms},i}\\rvert^{2}\\,V_{i},\n$$\n\nwith the constraint that $\\sum_{i}\\rho_{i}V_{i}=m$. We now compute for each location and protocol using the given compositions.\n\nUnit conversions and helper relations:\n- $1\\,\\mathrm{g} = 0.001\\,\\mathrm{kg}$, $10\\,\\mathrm{g}=0.010\\,\\mathrm{kg}$.\n- $1\\,\\mathrm{cm^{3}} = 1.0\\times 10^{-6}\\,\\mathrm{m^{3}}$.\n- For a subregion of mass $m_{i}$ and density $\\rho_{i}$, the volume is $V_{i}=m_{i}/\\rho_{i}$, with $m_{i}$ in $\\mathrm{kg}$ and $\\rho_{i}$ in $\\mathrm{kg/m^{3}}$. Equivalently, using $\\mathrm{g}$ and $\\mathrm{g/cm^{3}}$ yields $V_{i}$ in $\\mathrm{cm^{3}}$.\n\nProtocol-$1\\,\\mathrm{g}$, location $A$:\n- GM mass $0.60\\,\\mathrm{g}$: $V_{\\mathrm{GM}}=0.60/1.04=0.576923\\,\\mathrm{cm^{3}}=5.76923\\times 10^{-7}\\,\\mathrm{m^{3}}$. $\\sigma_{\\mathrm{GM}}\\lvert E\\rvert^{2}=0.80\\times (100)^{2}=8000\\,\\mathrm{W/m^{3}}$. Contribution to numerator $I_{\\mathrm{GM}}=8000\\times 5.76923\\times 10^{-7}=4.61538\\times 10^{-3}\\,\\mathrm{W}$.\n- CSF mass $0.40\\,\\mathrm{g}$: $V_{\\mathrm{CSF}}=0.40/1.00=0.40\\,\\mathrm{cm^{3}}=4.0\\times 10^{-7}\\,\\mathrm{m^{3}}$. $\\sigma_{\\mathrm{CSF}}\\lvert E\\rvert^{2}=2.00\\times (40)^{2}=3200\\,\\mathrm{W/m^{3}}$. $I_{\\mathrm{CSF}}=3200\\times 4.0\\times 10^{-7}=1.28\\times 10^{-3}\\,\\mathrm{W}$.\n- Total numerator $I_{A,1\\mathrm{g}}=4.61538\\times 10^{-3}+1.28\\times 10^{-3}=5.89538\\times 10^{-3}\\,\\mathrm{W}$.\n- Mass $m=0.001\\,\\mathrm{kg}$. Therefore $\\mathrm{SAR}_{A,1\\mathrm{g}}=I/m=5.89538\\,\\mathrm{W/kg}$ (approximately $5.9\\,\\mathrm{W/kg}$).\n\nProtocol-$1\\,\\mathrm{g}$, location $B$:\n- WM mass $1.00\\,\\mathrm{g}$: $V_{\\mathrm{WM}}=1.00/1.03=0.970874\\,\\mathrm{cm^{3}}=9.70874\\times 10^{-7}\\,\\mathrm{m^{3}}$. $\\sigma_{\\mathrm{WM}}\\lvert E\\rvert^{2}=0.60\\times (70)^{2}=0.60\\times 4900=2940\\,\\mathrm{W/m^{3}}$. Contribution $I_{\\mathrm{WM}}=2940\\times 9.70874\\times 10^{-7}=2.853\\!\\times 10^{-3}\\,\\mathrm{W}$ (more precisely $2.853\\text{--}2.854\\times 10^{-3}\\,\\mathrm{W}$).\n- Mass $m=0.001\\,\\mathrm{kg}$. Therefore $\\mathrm{SAR}_{B,1\\mathrm{g}}\\approx 2.854\\,\\mathrm{W/kg}$.\n\nThus, under Protocol-$1\\,\\mathrm{g}$, location $A$ has the higher mass-averaged SAR.\n\nProtocol-$10\\,\\mathrm{g}$, location $A$:\n- GM mass $1.00\\,\\mathrm{g}$: $V_{\\mathrm{GM}}=1.00/1.04=0.961538\\,\\mathrm{cm^{3}}=9.61538\\times 10^{-7}\\,\\mathrm{m^{3}}$. $\\sigma_{\\mathrm{GM}}\\lvert E\\rvert^{2}=8000\\,\\mathrm{W/m^{3}}$. $I_{\\mathrm{GM}}=8000\\times 9.61538\\times 10^{-7}=7.69230\\times 10^{-3}\\,\\mathrm{W}$.\n- CSF mass $1.00\\,\\mathrm{g}$: $V_{\\mathrm{CSF}}=1.00\\,\\mathrm{cm^{3}}=1.0\\times 10^{-6}\\,\\mathrm{m^{3}}$. $\\sigma_{\\mathrm{CSF}}\\lvert E\\rvert^{2}=3200\\,\\mathrm{W/m^{3}}$. $I_{\\mathrm{CSF}}=3200\\times 1.0\\times 10^{-6}=3.20000\\times 10^{-3}\\,\\mathrm{W}$.\n- Bone mass $5.00\\,\\mathrm{g}$: $V_{\\mathrm{bone}}=5.00/1.85=2.70270\\,\\mathrm{cm^{3}}=2.70270\\times 10^{-6}\\,\\mathrm{m^{3}}$. $\\sigma_{\\mathrm{bone}}\\lvert E\\rvert^{2}=0.04\\times (20)^{2}=16\\,\\mathrm{W/m^{3}}$. $I_{\\mathrm{bone}}=16\\times 2.70270\\times 10^{-6}=4.32432\\times 10^{-5}\\,\\mathrm{W}$.\n- Fat mass $3.00\\,\\mathrm{g}$: $V_{\\mathrm{fat}}=3.00/0.92=3.26087\\,\\mathrm{cm^{3}}=3.26087\\times 10^{-6}\\,\\mathrm{m^{3}}$. $\\sigma_{\\mathrm{fat}}\\lvert E\\rvert^{2}=0.10\\times (30)^{2}=90\\,\\mathrm{W/m^{3}}$. $I_{\\mathrm{fat}}=90\\times 3.26087\\times 10^{-6}=2.93478\\times 10^{-4}\\,\\mathrm{W}$.\n- Total numerator $I_{A,10\\mathrm{g}}=7.69230\\times 10^{-3}+3.20000\\times 10^{-3}+4.32432\\times 10^{-5}+2.93478\\times 10^{-4}=1.12287\\times 10^{-2}\\,\\mathrm{W}$.\n- Mass $m=0.010\\,\\mathrm{kg}$. Therefore $\\mathrm{SAR}_{A,10\\mathrm{g}}=1.12287\\,\\mathrm{W/kg}$ (approximately $1.12\\,\\mathrm{W/kg}$).\n\nProtocol-$10\\,\\mathrm{g}$, location $B$:\n- WM mass $8.00\\,\\mathrm{g}$: $V_{\\mathrm{WM}}=8.00/1.03=7.76796\\,\\mathrm{cm^{3}}=7.76796\\times 10^{-6}\\,\\mathrm{m^{3}}$. $\\sigma_{\\mathrm{WM}}\\lvert E\\rvert^{2}=2940\\,\\mathrm{W/m^{3}}$. $I_{\\mathrm{WM}}=2940\\times 7.76796\\times 10^{-6}=2.28377\\times 10^{-2}\\,\\mathrm{W}$.\n- GM mass $2.00\\,\\mathrm{g}$: $V_{\\mathrm{GM}}=2.00/1.04=1.92308\\,\\mathrm{cm^{3}}=1.92308\\times 10^{-6}\\,\\mathrm{m^{3}}$. $\\sigma_{\\mathrm{GM}}\\lvert E\\rvert^{2}=0.80\\times (50)^{2}=2000\\,\\mathrm{W/m^{3}}$. $I_{\\mathrm{GM}}=2000\\times 1.92308\\times 10^{-6}=3.84615\\times 10^{-3}\\,\\mathrm{W}$.\n- Total numerator $I_{B,10\\mathrm{g}}=2.28377\\times 10^{-2}+3.84615\\times 10^{-3}=2.66839\\times 10^{-2}\\,\\mathrm{W}$.\n- Mass $m=0.010\\,\\mathrm{kg}$. Therefore $\\mathrm{SAR}_{B,10\\mathrm{g}}=2.66839\\,\\mathrm{W/kg}$ (approximately $2.67\\,\\mathrm{W/kg}$).\n\nComparison and interpretation:\n- Protocol-$1\\,\\mathrm{g}$: $\\mathrm{SAR}_{A,1\\mathrm{g}}\\approx 5.90\\,\\mathrm{W/kg} > \\mathrm{SAR}_{B,1\\mathrm{g}}\\approx 2.85\\,\\mathrm{W/kg}$. Location $A$ is worse.\n- Protocol-$10\\,\\mathrm{g}$: $\\mathrm{SAR}_{B,10\\mathrm{g}}\\approx 2.67\\,\\mathrm{W/kg} > \\mathrm{SAR}_{A,10\\mathrm{g}}\\approx 1.12\\,\\mathrm{W/kg}$. Location $B$ is worse.\n\nThus, the ordering of hotspots reverses when changing from $1\\,\\mathrm{g}$ to $10\\,\\mathrm{g}$. The mechanism is twofold: at $A$, the kernel must include substantial low-field, low-conductivity bone and relatively low-field fat to reach $10\\,\\mathrm{g}$ (a partial-volume dilution exacerbated by differing densities that enlarge the geometric kernel into low-heating media), whereas at $B$, the anisotropic white-matter tract sustains an extended region of elevated $\\sigma \\lvert E\\rvert^{2}$ that continues to dominate even as the kernel expands to $10\\,\\mathrm{g}$.\n\nOption-by-option analysis:\n- Option A: Reports $\\approx 5.9\\,\\mathrm{W/kg}$ at $A$ for $1\\,\\mathrm{g}$ and $\\approx 2.7\\,\\mathrm{W/kg}$ at $B$ for $10\\,\\mathrm{g}$, and explains reversal by dilution at $A$ and anisotropy-supported extension at $B$. This matches our calculations and physical rationale. Correct.\n- Option B: Claims the opposite ordering for $1\\,\\mathrm{g}$ (higher at $B$), which contradicts $\\mathrm{SAR}_{A,1\\mathrm{g}}>\\mathrm{SAR}_{B,1\\mathrm{g}}$. Incorrect, despite quoting plausible magnitudes individually.\n- Option C: Asserts no reversal and that $A$ remains worst at $10\\,\\mathrm{g}$, attributing it to CSF dominance. Our calculation shows $\\mathrm{SAR}_{B,10\\mathrm{g}}>\\mathrm{SAR}_{A,10\\mathrm{g}}$; moreover, the $10\\,\\mathrm{g}$ kernel at $A$ is dominated by bone and fat contributions that dilute the average. Incorrect.\n- Option D: Asserts no reversal with $B$ worst for both and claims anisotropy reduces heating upon kernel expansion, which is physically backwards in this scenario; the elongated anisotropic tract maintains elevated $\\sigma \\lvert E\\rvert^{2}$ over larger mass. Incorrect.\n\nTherefore, only Option A is correct.", "answer": "$$\\boxed{A}$$", "id": "3349634"}, {"introduction": "The final step in mastering Specific Absorption Rate (SAR) analysis is translating continuous-domain theory into robust computational algorithms. This hands-on coding problem [@problem_id:3349655] challenges you to implement the mass-averaging procedure for a heterogeneous medium, a core function in any SAR post-processing software. By calculating the exact mass-averaged SAR for a simplified geometry and comparing it against a voxel-based numerical approximation, you will gain direct insight into numerical quadrature errors and the principles of convergence analysis, which are vital skills for developing and validating computational tools.", "problem": "You are asked to formalize and analyze mass-averaged Specific Absorption Rate (SAR) in heterogeneous tissue using a principled approach grounded in computational electromagnetics. Begin from first principles: the Poynting theorem and Joule heating for time-harmonic fields and well-established electromagnetic interface conditions. Concretely, assume time-harmonic electromagnetic fields in a conductive medium with negligible magnetic losses, so that the instantaneous resistive heating density obeys a time-average form proportional to the electric field intensity in a conductor; this leads to the standard pointwise SAR definition. Your first task is to derive the mass-averaged SAR appropriate for standards-compliant sliding-window averaging. Then, using a model heterogeneous domain with a planar interface and a piecewise constant electric field consistent with current continuity, compute exact and approximate mass-averaged SAR values, and quantify volumetric averaging error as a function of the spatial discretization size.\n\nFundamental base assumptions and definitions:\n- Let the electric field be denoted by $\\mathbf{E}$ and the electrical conductivity by $\\sigma$. Assume time-harmonic steady state with Joule heating density given by a time-average proportional to $\\sigma |\\mathbf{E}|^2$, consistent with the Poynting theorem. The local Specific Absorption Rate (SAR) at a point with mass density $\\rho$ is defined by the well-tested formula $SAR = \\dfrac{\\sigma |\\mathbf{E}|^2}{2 \\rho}$ in units of $\\mathrm{W/kg}$.\n- For an averaging region of mass $m_g$ (an $m$-gram window), the mass-averaged SAR over a volume $W$ must be defined via the power absorbed per unit mass, consistent with energy conservation, using the mass measure in the denominator.\n- Across material interfaces, assume standard electromagnetic conditions: continuity of tangential $\\mathbf{E}$ and continuity of normal conduction current density $\\mathbf{J} \\cdot \\mathbf{n}$ where $\\mathbf{J} = \\sigma \\mathbf{E}$. You will use these to justify the piecewise constant field used in the numerical model below.\n\nFinite Element Method (FEM) context:\n- Consider the functional corresponding to mass-averaged SAR and its numerical approximation when the electric field is approximated by $H(\\mathrm{curl})$-conforming edge elements (Nédélec elements). Your analysis should connect the discretization error for the electric field $E_h$ to the error in the averaged SAR functional over a fixed averaging window as the mesh size $h \\to 0$.\n\nModel problem setup for testable computation:\n- Domain: a cube $\\Omega = [0, L]^3$ with $L = 0.1 \\ \\mathrm{m}$ and a planar interface at $x = L/2$ separating two homogeneous subdomains.\n- Material parameters:\n  - Left subdomain ($x < L/2$): conductivity $\\sigma_1 = 0.5 \\ \\mathrm{S/m}$, density $\\rho_1 = 1000 \\ \\mathrm{kg/m^{3}}$.\n  - Right subdomain ($x \\ge L/2$): conductivity $\\sigma_2 = 1.2 \\ \\mathrm{S/m}$, density $\\rho_2 = 1100 \\ \\mathrm{kg/m^{3}}$.\n- Electric field model: Let $\\mathbf{E}$ be constant and purely normal to the interface, $\\mathbf{E} = (E_x, 0, 0)$, with magnitudes $E_L$ on the left and $E_R$ on the right chosen to satisfy conduction current continuity across the interface, that is $\\sigma_1 E_L = \\sigma_2 E_R$. Set $E_L = 10 \\ \\mathrm{V/m}$ and solve for $E_R$.\n- Averaging windows: Use cubic $m$-gram windows $W$ centered at specified positions. The side length $s$ of the cube is defined implicitly by the mass constraint $\\int_{W} \\rho \\, dV = m_g$. Because $\\rho$ is heterogeneous and $W$ may straddle the interface, $s$ must be solved consistently with the position of $W$ relative to the interface. You may solve for $s$ numerically.\n\nDerivations required:\n1. Starting from the local SAR definition and energy conservation, derive the expression for the mass-averaged SAR over a region $W$ with total mass $m_g$. Your derivation must explicitly show how the density $\\rho$ interacts with the averaging operation and how the expression depends on $\\sigma$ and $|\\mathbf{E}|^2$ in a heterogeneous medium with discontinuities at interfaces.\n2. Justify why, under the FEM with $H(\\mathrm{curl})$-conforming edge elements, the volumetric averaging error for the mass-averaged SAR over a fixed window $W$ can be bounded in terms of the $L^2$-error of the electric field and the regularity of the exact field across interfaces. State the expected order of convergence with respect to $h$ when the exact field is piecewise smooth with a planar interface and no geometric singularities.\n\nNumerical evaluation and test suite:\n- Use the model setup above to produce the following three test cases. All lengths are in $\\mathrm{m}$, fields in $\\mathrm{V/m}$, conductivities in $\\mathrm{S/m}$, densities in $\\mathrm{kg/m^{3}}$, masses in $\\mathrm{kg}$, and SAR in $\\mathrm{W/kg}$. Angles are not used in this problem.\n  - Test case $1$ (happy path, homogeneous window): $m_g = 0.01$ (i.e., $10$ grams), window center at $(0.25 L, 0.5 L, 0.5 L) = (0.025, 0.05, 0.05)$; the window lies entirely in the left subdomain. Compute the exact mass-averaged SAR for this window. Express the answer in $\\mathrm{W/kg}$, rounded to six decimal places.\n  - Test case $2$ (interface-straddling window and convergence study): $m_g = 0.01$, window center at $(0.5 L, 0.5 L, 0.5 L) = (0.05, 0.05, 0.05)$; the window is symmetrically split by the interface. Compute the exact mass-averaged SAR. Then, approximate the mass-averaged SAR using a uniform Cartesian voxelization of $\\Omega$ with $N \\in \\{16, 32, 64, 128\\}$ cells per side (grid spacing $h = L/N$). In each approximation, include all voxel centers that lie within the cubic window and approximate the volumetric integral by Riemann sums. Use the exact window mass $m_g$ in the denominator. Estimate the observed order of convergence $p$ by fitting a line to $(\\log h, \\log \\text{error})$ and reporting the slope. Express the exact mass-averaged SAR in $\\mathrm{W/kg}$ rounded to six decimal places and $p$ rounded to two decimal places.\n  - Test case $3$ (edge case near interface): $m_g = 0.001$ (i.e., $1$ gram), window center at $(0.505 L, 0.5 L, 0.5 L) = (0.0505, 0.05, 0.05)$. Compute the exact mass-averaged SAR and a voxelized approximation with $N = 256$. Report whether the absolute error is less than $0.0001$ in $\\mathrm{W/kg}$ as a boolean value.\n- Exact evaluation: For the exact mass-averaged SAR, rely on your derived averaging expression and the geometric overlap of the cubic window with the two half-spaces. Because the field and conductivity are piecewise constant, the exact value can be computed from volumes of intersection. For windows that are entirely in one subdomain, the exact mass-averaged SAR can be computed without numerical quadrature. For interface-straddling windows, compute the side length $s$ from the mass constraint and use the planar interface geometry to compute the partitioned volumes.\n- Voxelized approximation: On a grid with $N$ cells per side, use voxel centers at coordinates $((i + 0.5) h, (j + 0.5) h, (k + 0.5) h)$ for integers $i,j,k \\in \\{0, \\dots, N-1\\}$. Include the voxel in the Riemann sum if its center lies within the cubic window. Evaluate the integrand using the piecewise constant values implied by the half-spaces. Use the exact $m_g$ in the denominator.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets in the order `[`SAR1`, `SAR2`, `p2`, `ok3`]`, where:\n  - `SAR1` is the exact mass-averaged SAR for test case $1$ in $\\mathrm{W/kg}$, rounded to six decimal places.\n  - `SAR2` is the exact mass-averaged SAR for test case $2$ in $\\mathrm{W/kg}$, rounded to six decimal places.\n  - `p2` is the observed order of convergence for test case $2$, rounded to two decimal places.\n  - `ok3` is a boolean for test case $3$ that is `True` if the absolute error at $N=256$ is less than $0.0001$ in $\\mathrm{W/kg}$ and `False` otherwise.\n\nYour program must be a complete, runnable script that performs all computations with no external inputs and adheres to the specified output format.", "solution": "This problem requires a multi-part analysis of the Specific Absorption Rate (SAR), starting from fundamental principles, progressing through theoretical justifications for numerical methods, and culminating in concrete numerical computations for a defined model problem.\n\n**1. Derivation of Mass-Averaged SAR**\n\nThe local Specific Absorption Rate, denoted $SAR(\\mathbf{r})$, at a point $\\mathbf{r}$ in a biological medium is defined as the time-averaged power absorbed per unit mass. For time-harmonic electromagnetic fields with complex electric field phasor $\\mathbf{E}$, the time-averaged power density $P_d$ (in $\\mathrm{W/m^3}$) in a conductive medium with electrical conductivity $\\sigma$ and negligible magnetic losses is given by the resistive (Joule) heating term from the Poynting theorem:\n$$P_d(\\mathbf{r}) = \\frac{1}{2}\\sigma(\\mathbf{r}) |\\mathbf{E}(\\mathbf{r})|^2$$\nThe problem statement simplifies this by considering the magnitude of a purely real electric field, which is equivalent to the amplitude of the phasor, hence the local SAR at a point with mass density $\\rho(\\mathbf{r})$ is given as:\n$$SAR(\\mathbf{r}) = \\frac{P_d(\\mathbf{r})}{\\rho(\\mathbf{r})} = \\frac{\\sigma(\\mathbf{r}) |\\mathbf{E}(\\mathbf{r})|^2}{2\\rho(\\mathbf{r})}$$\nTo comply with safety standards, SAR is typically averaged over a region containing a specific mass of tissue, e.g., $1$ gram or $10$ grams. Let $W$ be a volume containing a total mass $m_g$. The total mass in this volume is the integral of the density function over $W$:\n$$m_W = \\int_W \\rho(\\mathbf{r}) \\, dV$$\nFor standards compliance, the averaging volume $W$ is typically a simply shaped region (e.g., a cube) whose size is adjusted such that $m_W = m_g$. The total power absorbed within this volume $W$ is the integral of the power density:\n$$P_W = \\int_W P_d(\\mathbf{r}) \\, dV = \\int_W \\frac{1}{2}\\sigma(\\mathbf{r}) |\\mathbf{E}(\\mathbf{r})|^2 \\, dV$$\nThe mass-averaged SAR, denoted $SAR_{m_g}$, is defined as the total absorbed power $P_W$ divided by the total mass $m_g$ over which it is averaged. Therefore, combining the above definitions, we arrive at the formal expression for mass-averaged SAR:\n$$SAR_{m_g} = \\frac{P_W}{m_g} = \\frac{1}{m_g} \\int_W \\frac{1}{2}\\sigma(\\mathbf{r}) |\\mathbf{E}(\\mathbf{r})|^2 \\, dV$$\nThis expression is fundamental. It correctly normalizes the total absorbed power by the specified mass $m_g$. Note that if the denominator were the integral expression for mass, $\\int_W \\rho(\\mathbf{r}) \\, dV$, the result would be identical since the volume $W$ is defined such that this integral equals $m_g$. This form explicitly shows that the averaging of SAR is a power-based calculation. In a heterogeneous medium, $\\sigma$, $\\rho$, and $\\mathbf{E}$ are all functions of position. The value of $SAR_{m_g}$ thus depends on the spatial distributions of all three quantities within the averaging volume $W$.\n\n**2. FEM Discretization Error and Convergence**\n\nThe mass-averaged SAR is a functional of the electric field, $F(E) = SAR_{m_g}$. When the electric field is approximated using a Finite Element Method (FEM), we obtain a discrete field $E_h$, leading to an approximate SAR value, $F(E_h)$. We are asked to justify the expected convergence order of the error $|F(E) - F(E_h)|$ as the mesh size $h \\to 0$.\n\nThe error in the functional is:\n$$|F(E) - F(E_h)| = \\left| \\frac{1}{2m_g} \\int_W \\sigma |E|^2 \\, dV - \\frac{1}{2m_g} \\int_W \\sigma |E_h|^2 \\, dV \\right|$$\n$$|F(E) - F(E_h)| = \\frac{1}{2m_g} \\left| \\int_W \\sigma ( |E|^2 - |E_h|^2 ) \\, dV \\right|$$\nLet the error field be $e_E = E - E_h$. Then $E_h = E - e_E$, and $|E_h|^2 = |E|^2 - 2 E \\cdot e_E + |e_E|^2$. Substituting this into the expression gives:\n$$|F(E) - F(E_h)| = \\frac{1}{2m_g} \\left| \\int_W \\sigma ( 2 E \\cdot e_E - |e_E|^2 ) \\, dV \\right|$$\nApplying the triangle inequality and then the Cauchy-Schwarz inequality to the integral term:\n$$|F(E) - F(E_h)| \\le \\frac{1}{2m_g} \\left( \\left| \\int_W 2 \\sigma E \\cdot e_E \\, dV \\right| + \\left| \\int_W \\sigma |e_E|^2 \\, dV \\right| \\right)$$\n$$\\le \\frac{\\|\\sigma\\|_{L^\\infty(W)}}{2m_g} \\left( 2 \\|E\\|_{L^2(W)} \\|e_E\\|_{L^2(W)} + \\|e_E\\|_{L^2(W)}^2 \\right)$$\nThis inequality shows that the error in the mass-averaged SAR is bounded by the $L^2$-norm of the electric field error, $\\|e_E\\|_{L^2(W)} = \\|E-E_h\\|_{L^2(W)}$. For a solution $E$ that is sufficiently regular, standard FEM theory for lowest-order ($p=1$) Nédélec (edge) elements, which are $H(\\mathrm{curl})$-conforming, predicts an $L^2$ error convergence rate of $O(h^p) = O(h)$. That is, $\\|E - E_h\\|_{L^2(\\Omega)} \\le C h$ for some constant $C$ independent of $h$. The regularity is limited at the material interface, where $E$ is piecewise smooth, which is consistent with this convergence rate. Since the error in the SAR functional is dominated by the term linear in $\\|e_E\\|_{L^2(W)}$ for small $h$, the expected order of convergence for the SAR value is also linear:\n$$|F(E) - F(E_h)| = O(h)$$\n\nThe numerical evaluation part of the problem does not involve a full FEM simulation. Instead, it concerns the error of a numerical quadrature (a voxel-based Riemann sum) for the exact integral of a simplified, piecewise-constant field. The integrand has jump discontinuities along the boundary of the averaging window and the material interface. For a midpoint-rule-based numerical integration of a function with such jump discontinuities across planar surfaces, the error is dominated by the voxels that are cut by these surfaces. The number of such voxels is $O(h^{-2})$ in three dimensions for a grid spacing $h$, and the integration error within each such voxel is $O(h^4)$. However, a more direct analysis based on the theory of numerical quadrature for functions of bounded variation (such as functions with jump discontinuities) shows that the convergence rate of the error is $O(h)$. Therefore, for the numerical experiment in Test Case 2, we expect to observe a linear order of convergence, $p \\approx 1$.\n\n**3. Model Problem Computation**\n\nWe are given the following parameters:\n- Domain: $\\Omega = [0, L]^3$ with $L = 0.1 \\ \\mathrm{m}$. Interface at $x_{int} = L/2 = 0.05 \\ \\mathrm{m}$.\n- Region 1 ($x < 0.05 \\ \\mathrm{m}$): $\\sigma_1 = 0.5 \\ \\mathrm{S/m}$, $\\rho_1 = 1000 \\ \\mathrm{kg/m^3}$.\n- Region 2 ($x \\ge 0.05 \\ \\mathrm{m}$): $\\sigma_2 = 1.2 \\ \\mathrm{S/m}$, $\\rho_2 = 1100 \\ \\mathrm{kg/m^3}$.\n- Electric field: $E = (E_x, 0, 0)$. In Region 1, $E_L = 10 \\ \\mathrm{V/m}$. In Region 2, $E_R$ is found from current continuity: $\\sigma_1 E_L = \\sigma_2 E_R \\Rightarrow 0.5 \\times 10 = 1.2 \\times E_R \\Rightarrow E_R = 5/1.2 = 25/6 \\ \\mathrm{V/m}$.\n\nFirst, we compute the piecewise constant local power densities $P_d = \\frac{1}{2}\\sigma |E|^2$ and local SAR values $SAR = P_d/\\rho$:\n- Region 1: $P_{d1} = \\frac{1}{2} \\sigma_1 E_L^2 = \\frac{1}{2}(0.5)(10^2) = 25 \\ \\mathrm{W/m^3}$. $SAR_1 = \\frac{P_{d1}}{\\rho_1} = \\frac{25}{1000} = 0.025 \\ \\mathrm{W/kg}$.\n- Region 2: $P_{d2} = \\frac{1}{2} \\sigma_2 E_R^2 = \\frac{1}{2}(1.2)(\\frac{25}{6})^2 = \\frac{0.6 \\times 625}{36} = \\frac{62.5}{6} = \\frac{125}{12} \\ \\mathrm{W/m^3}$. $SAR_2 = \\frac{P_{d2}}{\\rho_2} = \\frac{125/12}{1100} = \\frac{125}{13200} = \\frac{5}{528} \\ \\mathrm{W/kg}$.\n\n**Test Case 1**: Homogeneous window.\n- $m_g = 0.01 \\ \\mathrm{kg}$, center $C = (0.025, 0.05, 0.05)$.\nThe averaging window is a cube of side $s$. To be entirely in Region 1, its boundary must satisfy $0.025 + s/2 \\le 0.05$, which implies $s \\le 0.05$. The mass constraint is $m_g = \\rho_1 s^3 \\Rightarrow 0.01 = 1000 s^3 \\Rightarrow s^3 = 10^{-5} \\Rightarrow s = 10^{-5/3} \\approx 0.02154 \\ \\mathrm{m}$. Since $s < 0.05$, the window is indeed fully in Region 1. Inside this homogeneous window, the local SAR is constant. Thus, the mass-averaged SAR is equal to the local SAR.\n$$SAR_{10g} = SAR_1 = 0.025 \\ \\mathrm{W/kg}$$\n\n**Test Case 2**: Interface-straddling window.\n- $m_g = 0.01 \\ \\mathrm{kg}$, center $C = (0.05, 0.05, 0.05)$.\nThe window is centered on the interface. Half of its volume along the $x$-axis lies in Region 1 and half in Region 2. The mass is $m_g = V_1 \\rho_1 + V_2 \\rho_2 = (s^3/2)\\rho_1 + (s^3/2)\\rho_2$.\n$$0.01 = \\frac{s^3}{2} (1000 + 1100) \\Rightarrow s^3 = \\frac{0.02}{2100} = \\frac{1}{105000}$$\nThe total power is $P_W = V_1 P_{d1} + V_2 P_{d2} = (s^3/2)P_{d1} + (s^3/2)P_{d2}$.\nThe mass-averaged SAR is $SAR_{10g} = P_W / m_g$.\n$$SAR_{10g} = \\frac{(s^3/2)(P_{d1} + P_{d2})}{(s^3/2)(\\rho_1 + \\rho_2)} = \\frac{P_{d1} + P_{d2}}{\\rho_1 + \\rho_2} = \\frac{25 + 125/12}{1000 + 1100} = \\frac{425/12}{2100} = \\frac{425}{25200} = \\frac{17}{1008}$$\n$$SAR_{10g} \\approx 0.016865079 \\ \\mathrm{W/kg}$$\nThe numerical part involves computing this integral via a Riemann sum for various grid sizes $N$ and finding the convergence order $p$ from the slope of $\\log(\\text{error})$ vs. $\\log(h)$.\n\n**Test Case 3**: Asymmetric interface-straddling window.\n- $m_g = 0.001 \\ \\mathrm{kg}$, center $C = (0.0505, 0.05, 0.05)$.\nThe window center is slightly in Region 2. The window of side $s$ extends from $x = 0.0505 - s/2$ to $x = 0.0505 + s/2$. It will straddle the interface at $x_i = 0.05$ if $0.0505 - s/2 < 0.05$, i.e., $s > 0.001$. The mass constraint is $m_g = s^2 [ \\rho_1 (0.05 - (0.0505-s/2)) + \\rho_2 ((0.0505+s/2) - 0.05) ]$ for a straddling window.\n$$0.001 = s^2 [ 1000(s/2 - 0.0005) + 1100(s/2 + 0.0005) ]$$\n$$0.001 = s^2 [ 500s - 0.5 + 550s + 0.55 ] = s^2 [ 1050s + 0.05]$$\n$$1050s^3 + 0.05s^2 - 0.001 = 0$$\nThis cubic equation for $s$ must be solved numerically. Once $s$ is found, the exact power is:\n$$P_W = s^2 [ P_{d1}(s/2 - 0.0005) + P_{d2}(s/2 + 0.0005) ]$$\nAnd the exact SAR is $SAR_{1g} = P_W / 0.001$.\nThis exact value is then compared to a voxelized approximation with $N=256$ to check if the absolute error is less than $10^{-4}$. The detailed calculations are implemented in the provided code.", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Solves the SAR calculation problem according to the specifications.\n    \n    The solution involves:\n    1. Deriving and implementing the formula for mass-averaged SAR.\n    2. Handling homogeneous and heterogeneous averaging windows by numerically\n       solving for the window size that satisfies the mass constraint.\n    3. Computing exact SAR values for three test cases using the derived formulas.\n    4. Implementing a voxel-based Riemann sum to approximate SAR and estimate\n       the order of convergence for the numerical quadrature.\n    \"\"\"\n\n    # --- Model Parameters ---\n    L = 0.1  # m\n    X_INTERFACE = L / 2.0\n    \n    # Material properties\n    SIGMA1, RHO1 = 0.5, 1000.0  # S/m, kg/m^3 (Region 1: x < L/2)\n    SIGMA2, RHO2 = 1.2, 1100.0  # S/m, kg/m^3 (Region 2: x >= L/2)\n    \n    # Electric field\n    E_L = 10.0  # V/m\n    E_R = (SIGMA1 * E_L) / SIGMA2 # V/m, from continuity of normal current density\n\n    # Pre-computed power densities (W/m^3)\n    PD1 = 0.5 * SIGMA1 * E_L**2\n    PD2 = 0.5 * SIGMA2 * E_R**2\n\n    # --- Helper Functions ---\n\n    def get_window_side_length(mg, center_x):\n        \"\"\"\n        Calculates the side length 's' of a cubic window for a given mass mg\n        and center coordinate cx.\n        \"\"\"\n        def mass_error(s):\n            if s <= 0:\n                return -mg\n            \n            x_min_win = center_x - s / 2.0\n            x_max_win = center_x + s / 2.0\n\n            # Length of intersection of the window's x-interval with Region 1\n            len1 = max(0.0, min(x_max_win, X_INTERFACE) - x_min_win)\n            # Length of intersection with Region 2\n            len2 = max(0.0, x_max_win - max(x_min_win, X_INTERFACE))\n            \n            mass = s**2 * (RHO1 * len1 + RHO2 * len2)\n            return mass - mg\n\n        # Find the root of mass_error(s) = 0. Bracket [1e-9, L] is safe.\n        try:\n            s = brentq(mass_error, 1e-9, L)\n        except ValueError:\n            # This may happen if the mass_error does not cross zero in the interval,\n            # which would indicate an issue with the problem setup or logic.\n            # For this problem, a root is guaranteed.\n            return None\n        return s\n\n    def compute_exact_sar(mg, center, s):\n        \"\"\"\n        Computes the exact mass-averaged SAR for a cubic window of side s.\n        \"\"\"\n        center_x = center[0]\n        x_min_win = center_x - s / 2.0\n        x_max_win = center_x + s / 2.0\n\n        len1 = max(0.0, min(x_max_win, X_INTERFACE) - x_min_win)\n        len2 = max(0.0, x_max_win - max(x_min_win, X_INTERFACE))\n        \n        power_total = s**2 * (PD1 * len1 + PD2 * len2)\n        \n        return power_total / mg\n\n    def compute_approx_sar(mg, center, s, N):\n        \"\"\"\n        Computes the approximate mass-averaged SAR using a voxel-based Riemann sum.\n        \"\"\"\n        h = L / N\n        voxel_vol = h**3\n        power_total_approx = 0.0\n\n        window_min = np.array(center) - s / 2.0\n        window_max = np.array(center) + s / 2.0\n\n        # Create arrays of voxel center coordinates\n        i_coords = (np.arange(N) + 0.5) * h\n        \n        # We only need to iterate over x, as y and z are symmetric\n        # and the problem is 1D in properties.\n        n_voxels_y = np.sum((i_coords >= window_min[1]) & (i_coords < window_max[1]))\n        n_voxels_z = np.sum((i_coords >= window_min[2]) & (i_coords < window_max[2]))\n\n        for i in range(N):\n            vx = (i + 0.5) * h\n            if window_min[0] <= vx < window_max[0]:\n                pd_val = PD1 if vx < X_INTERFACE else PD2\n                power_total_approx += pd_val\n        \n        power_total_approx *= (h * n_voxels_y * h * n_voxels_z * h)\n\n        return power_total_approx / mg\n\n    # --- Test Case 1: Homogeneous window ---\n    mg1 = 0.01\n    center1 = (0.025, 0.05, 0.05)\n    \n    # In this homogeneous case, SAR is constant throughout the window.\n    sar1 = PD1 / RHO1\n    \n    # --- Test Case 2: Symmetric interface-straddling window ---\n    mg2 = 0.01\n    center2 = (0.05, 0.05, 0.05)\n\n    s2 = get_window_side_length(mg2, center2[0])\n    sar2_exact = compute_exact_sar(mg2, center2, s2)\n    \n    # Convergence analysis\n    N_values = [16, 32, 64, 128]\n    log_h = []\n    log_err = []\n    for N_val in N_values:\n        sar_approx = compute_approx_sar(mg2, center2, s2, N_val)\n        error = abs(sar_approx - sar2_exact)\n        if error > 1e-12: # Avoid log(0)\n            log_h.append(np.log(L / N_val))\n            log_err.append(np.log(error))\n    \n    # Linear fit: log(error) = p * log(h) + const\n    # Using numpy's polyfit to find the slope p\n    if len(log_h) > 1:\n        p2, _ = np.polyfit(log_h, log_err, 1)\n    else:\n        p2 = 0.0\n\n    # --- Test Case 3: Asymmetric interface-straddling window ---\n    mg3 = 0.001\n    center3 = (0.0505, 0.05, 0.05)\n    N3 = 256\n    \n    s3 = get_window_side_length(mg3, center3[0])\n    sar3_exact = compute_exact_sar(mg3, center3, s3)\n    sar3_approx = compute_approx_sar(mg3, center3, s3, N3)\n    \n    err3 = abs(sar3_approx - sar3_exact)\n    ok3 = err3 < 0.0001\n    \n    # --- Final Output ---\n    results = [\n        round(sar1, 6),\n        round(sar2_exact, 6),\n        round(p2, 2),\n        ok3\n    ]\n    \n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3349655"}]}