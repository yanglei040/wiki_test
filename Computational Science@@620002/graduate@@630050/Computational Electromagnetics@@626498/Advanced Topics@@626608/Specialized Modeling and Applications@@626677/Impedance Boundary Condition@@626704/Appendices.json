{"hands_on_practices": [{"introduction": "To truly understand how the impedance boundary condition is applied in computational electromagnetics, we must see how it alters the governing integral equations. This practice [@problem_id:3355297] challenges you to go back to first principles, starting with the Electric Field Integral Equation (EFIE) for a thin wire. Your task is to derive the modification to the Pocklington integral kernel that accounts for a finite surface impedance, revealing how a local boundary condition translates into a \"diagonal\" term in the operator.", "problem": "A straight, thin, circular cylindrical wire of radius $a$ and length $2L$ is centered on the $z$-axis in a homogeneous, isotropic medium with permittivity $\\epsilon$ and permeability $\\mu$. Time-harmonic fields with the phasor convention $\\exp(j \\omega t)$ are assumed, so that the free-space wavenumber is $k = \\omega \\sqrt{\\mu \\epsilon}$. The wire is illuminated by an incident electric field whose axial component on the wire surface is $E_{\\mathrm{inc},z}(a,z)$ for $-L \\le z \\le L$. The unknown axial conduction current is $I(z)$, assumed to be uniformly distributed in $\\phi$ around the circumference (thin-wire assumption).\n\nStart from the Electric Field Integral Equation (EFIE) written with the electromagnetic potentials: the scattered electric field is $E_{\\mathrm{sc}} = -j \\omega A - \\nabla \\Phi$, where the vector potential $A$ and scalar potential $\\Phi$ are generated by the current density $J$ and charge density $\\rho$, respectively. Use the Lorenz gauge and the continuity equation to eliminate $\\rho$ in favor of $I(z)$ and express the axial scattered field on the wire surface, $E_{\\mathrm{sc},z}(a,z)$, as a linear integral operator acting on $I(z')$ that involves the scalar Green’s function $g(R) = \\exp(-j k R)/(4 \\pi R)$. For a thin, axisymmetric current, employ the circumferential average of the Green’s function,\n$$\n\\bar{g}(z,z') \\equiv \\frac{1}{2\\pi} \\int_{0}^{2\\pi} g\\!\\left(\\sqrt{2 a^{2}\\bigl(1-\\cos \\phi\\bigr) + (z-z')^{2}}\\right)\\, d\\phi,\n$$\nso that all $\\phi$-dependence is removed.\n\nFor a perfect electric conductor, the EFIE enforces $E_{\\mathrm{inc},z}(a,z) + E_{\\mathrm{sc},z}(a,z) = 0$ on the surface. Now consider a wire of finite conductivity modeled by a Surface Impedance Boundary Condition (SIBC), which prescribes the tangential electric field on the surface as $E_{t} = Z_{s} J_{t}$, where $Z_{s}$ is the surface impedance and $J_{t}$ is the surface current density. Under the thin-wire uniformity assumption, relate $J_{t}$ to $I(z)$ via $K_{z}(z) = I(z)/(2 \\pi a)$ and enforce the boundary condition\n$$\nE_{\\mathrm{inc},z}(a,z) + E_{\\mathrm{sc},z}(a,z) = Z_{s} \\frac{I(z)}{2 \\pi a}, \\quad -L \\le z \\le L.\n$$\n\nBy combining these elements, derive the modified Pocklington-type integral equation for $I(z)$ that results from the SIBC, and identify it as the original perfect-conductor Pocklington operator plus an additive “diagonal” term acting locally on $I(z)$. Represent this local modification as an additive change $\\Delta K(z,z')$ to the kernel of the integral operator, defined by\n$$\n\\int_{-L}^{L} \\bigl[K_{\\mathrm{P}}(z,z') + \\Delta K(z,z')\\bigr]\\, I(z')\\, dz' = - j \\omega \\epsilon\\, E_{\\mathrm{inc},z}(a,z),\n$$\nwhere $K_{\\mathrm{P}}(z,z')$ denotes the perfect-conductor Pocklington kernel based on $\\bar{g}(z,z')$. Your task is to determine the explicit analytic expression for $\\Delta K(z,z')$ in terms of $Z_{s}$, $\\omega$, $\\epsilon$, $a$, and the Dirac delta function $\\delta(\\cdot)$.\n\nExpress your final answer as a single closed-form analytic expression for $\\Delta K(z,z')$. No numerical evaluation is required.", "solution": "The user wants to find the modification to the Pocklington integral equation kernel, denoted as $\\Delta K(z,z')$, which accounts for a finite-conductivity wire modeled by a Surface Impedance Boundary Condition (SIBC).\n\n### Step 1: Extract Givens\n-   **Wire Geometry**: Straight, circular cylinder of radius $a$ and length $2L$, centered on the $z$-axis.\n-   **Medium**: Homogeneous, isotropic with permittivity $\\epsilon$ and permeability $\\mu$.\n-   **Time Convention**: Phasor notation $\\exp(j \\omega t)$.\n-   **Wavenumber**: $k = \\omega \\sqrt{\\mu \\epsilon}$.\n-   **Incident Field**: Axial component on the wire surface is $E_{\\mathrm{inc},z}(a,z)$ for $-L \\le z \\le L$.\n-   **Unknown Current**: Axial current $I(z)$, uniform in $\\phi$.\n-   **Scattered Field**: $E_{\\mathrm{sc}} = -j \\omega A - \\nabla \\Phi$.\n-   **Potentials**: Vector potential $A$ and scalar potential $\\Phi$. Lorenz gauge is used.\n-   **Averaged Green's Function**: $\\bar{g}(z,z') \\equiv \\frac{1}{2\\pi} \\int_{0}^{2\\pi} g\\!\\left(\\sqrt{2 a^{2}\\bigl(1-\\cos \\phi\\bigr) + (z-z')^{2}}\\right)\\, d\\phi$.\n-   **SIBC**: $E_{\\mathrm{inc},z}(a,z) + E_{\\mathrm{sc},z}(a,z) = Z_{s} \\frac{I(z)}{2 \\pi a}$ for $-L \\le z \\le L$, where $Z_s$ is the surface impedance.\n-   **Target Equation**: $\\int_{-L}^{L} \\bigl[K_{\\mathrm{P}}(z,z') + \\Delta K(z,z')\\bigr]\\, I(z')\\, dz' = - j \\omega \\epsilon\\, E_{\\mathrm{inc},z}(a,z)$.\n-   **Definition of $K_{\\mathrm{P}}(z,z')$**: The kernel for the perfect-conductor case, related to the operator acting on $I(z')$ to produce $- j \\omega \\epsilon\\, E_{\\mathrm{inc},z}(a,z)$ when $Z_s=0$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem statement is scientifically sound, well-posed, and objective.\n-   **Scientifically Grounded**: The problem is based on fundamental principles of computational electromagnetics, specifically the formulation of integral equations for thin-wire antennas. The use of the Electric Field Integral Equation (EFIE), vector and scalar potentials, the Lorenz gauge, the thin-wire approximation with an averaged Green's function, and the Surface Impedance Boundary Condition are all standard and well-established concepts.\n-   **Well-Posed**: The problem asks for the derivation of a specific analytical term, $\\Delta K(z,z')$, which is uniquely determined by the provided equations and boundary conditions.\n-   **Objective**: The problem is stated in precise, quantitative, and unbiased scientific language.\n-   **Completeness and Consistency**: All necessary definitions, equations, and boundary conditions are provided. The problem is self-contained and free of contradictions. The relation between total current $I(z)$ and surface current density $K_z(z)$ is correctly given for the thin-wire model. The target form of the equation is clearly specified, providing a definite goal for the derivation.\n\n### Step 3: Verdict and Action\nThe problem is valid. A detailed derivation will be provided.\n\n### Derivation of the Solution\nThe derivation proceeds by establishing a relationship between the scattered electric field operator and the Pocklington integral operator, and then substituting this relationship into the Surface Impedance Boundary Condition (SIBC) to isolate the modification term.\n\nFirst, let us define an operator $L_E$ that maps the axial current $I(z')$ to the axial scattered electric field $E_{\\mathrm{sc},z}(z)$ on the wire surface:\n$$ E_{\\mathrm{sc},z}(z) = L_E[I(z')] $$\nThe problem asks to start from $E_{\\mathrm{sc}} = -j \\omega A - \\nabla \\Phi$. The axial component is $E_{\\mathrm{sc},z} = -j \\omega A_z - \\frac{\\partial \\Phi}{\\partial z}$. Using the Lorenz gauge condition $\\nabla \\cdot A + j \\omega \\mu \\epsilon \\Phi = 0$, which for a $z$-directed current simplifies to $\\frac{\\partial A_z}{\\partial z} + j \\omega \\mu \\epsilon \\Phi = 0$, we can express the scalar potential as $\\Phi = \\frac{1}{-j \\omega \\mu \\epsilon} \\frac{\\partial A_z}{\\partial z}$.\nSubstituting this into the expression for $E_{\\mathrm{sc},z}$:\n$$ E_{\\mathrm{sc},z} = -j \\omega A_z - \\frac{\\partial}{\\partial z} \\left( \\frac{j}{\\omega \\mu \\epsilon} \\frac{\\partial A_z}{\\partial z} \\right) = -j \\omega A_z + \\frac{j}{\\omega \\mu \\epsilon} \\frac{\\partial^2 A_z}{\\partial z^2} $$\nUsing the wavenumber $k^2 = \\omega^2 \\mu \\epsilon$:\n$$ E_{\\mathrm{sc},z} = \\frac{j \\omega}{k^2} \\left( \\frac{\\partial^2}{\\partial z^2} + k^2 \\right) A_z $$\nThe axial vector potential $A_z$ at an observation point $(a,z)$ produced by the current $I(z')$ is given by the integral over the source, using the circumferentially averaged Green's function $\\bar{g}(z,z')$:\n$$ A_z(z) = \\mu \\int_{-L}^{L} I(z') \\bar{g}(z,z') dz' $$\nSo, the scattered field operator is:\n$$ L_E[I(z')] = \\frac{j \\omega \\mu}{k^2} \\left( \\frac{\\partial^2}{\\partial z^2} + k^2 \\right) \\int_{-L}^{L} I(z') \\bar{g}(z,z') dz' = \\frac{j}{\\omega \\epsilon} \\left( \\frac{\\partial^2}{\\partial z^2} + k^2 \\right) \\int_{-L}^{L} I(z') \\bar{g}(z,z') dz' $$\nNow, let's consider the Pocklington operator for the perfect electric conductor (PEC) case, defined by the problem as $\\int K_{\\mathrm{P}}(z,z') I(z') dz'$. The PEC boundary condition is $E_{\\mathrm{inc},z} + E_{\\mathrm{sc},z} = 0$. The Pocklington equation is given as:\n$$ \\int_{-L}^{L} K_{\\mathrm{P}}(z,z') I(z')\\, dz' = - j \\omega \\epsilon\\, E_{\\mathrm{inc},z}(z) $$\nSubstituting $E_{\\mathrm{inc},z} = -E_{\\mathrm{sc},z} = -L_E[I(z')]$ into this equation:\n$$ \\int_{-L}^{L} K_{\\mathrm{P}}(z,z') I(z')\\, dz' = - j \\omega \\epsilon (-L_E[I(z')]) = j \\omega \\epsilon L_E[I(z')] $$\nThis provides a direct relationship between the Pocklington operator and the scattered field operator:\n$$ L_E[I(z')] = \\frac{1}{j \\omega \\epsilon} \\int_{-L}^{L} K_{\\mathrm{P}}(z,z') I(z')\\, dz' $$\nNext, we use the provided SIBC:\n$$ E_{\\mathrm{inc},z}(z) + E_{\\mathrm{sc},z}(z) = Z_{s} \\frac{I(z)}{2 \\pi a} $$\nSubstitute $E_{\\mathrm{sc},z} = L_E[I(z')]$:\n$$ E_{\\mathrm{inc},z}(z) + L_E[I(z')] = Z_{s} \\frac{I(z)}{2 \\pi a} $$\nThe goal is to bring this into the target form $\\int \\bigl[K_{\\mathrm{P}} + \\Delta K\\bigr]\\, I'\\, dz' = - j \\omega \\epsilon\\, E_{\\mathrm{inc},z}$. To do this, we first solve for $E_{\\mathrm{inc},z}$:\n$$ E_{\\mathrm{inc},z}(z) = Z_{s} \\frac{I(z)}{2 \\pi a} - L_E[I(z')] $$\nNow multiply the entire equation by $-j \\omega \\epsilon$:\n$$ -j \\omega \\epsilon E_{\\mathrm{inc},z}(z) = -j \\omega \\epsilon \\left( Z_{s} \\frac{I(z)}{2 \\pi a} - L_E[I(z')] \\right) = -j \\omega \\epsilon Z_{s} \\frac{I(z)}{2 \\pi a} + j \\omega \\epsilon L_E[I(z')] $$\nWe can now substitute the relationship $j \\omega \\epsilon L_E[I(z')] = \\int K_{\\mathrm{P}}(z,z') I(z') dz'$:\n$$ -j \\omega \\epsilon E_{\\mathrm{inc},z}(z) = \\int_{-L}^{L} K_{\\mathrm{P}}(z,z') I(z') dz' -j \\omega \\epsilon Z_{s} \\frac{I(z)}{2 \\pi a} $$\nThe left side of this equation is the right side of the target integral equation. Therefore, the right side must be equal to the left side of the target integral equation:\n$$ \\int_{-L}^{L} \\bigl[K_{\\mathrm{P}}(z,z') + \\Delta K(z,z')\\bigr]\\, I(z')\\, dz' = \\int_{-L}^{L} K_{\\mathrm{P}}(z,z') I(z') dz' - j \\omega \\epsilon Z_{s} \\frac{I(z)}{2 \\pi a} $$\nThe term $\\int K_{\\mathrm{P}}(z,z') I(z') dz'$ cancels from both sides, leaving:\n$$ \\int_{-L}^{L} \\Delta K(z,z') I(z')\\, dz' = -j \\omega \\epsilon Z_{s} \\frac{I(z)}{2 \\pi a} $$\nTo find the kernel $\\Delta K(z,z')$, we express the right-hand side as an integral over $z'$. This is achieved by using the sifting property of the Dirac delta function, $\\delta(z-z')$:\n$$ I(z) = \\int_{-L}^{L} I(z') \\delta(z-z') dz' $$\nSubstituting this into our equation:\n$$ \\int_{-L}^{L} \\Delta K(z,z') I(z')\\, dz' = \\int_{-L}^{L} \\left( -j \\omega \\epsilon \\frac{Z_{s}}{2 \\pi a} \\delta(z-z') \\right) I(z')\\, dz' $$\nFor this equality to hold for any arbitrary current distribution $I(z')$, the integrands must be equal. Therefore, the explicit expression for the additive kernel is:\n$$ \\Delta K(z,z') = -j \\omega \\epsilon \\frac{Z_{s}}{2 \\pi a} \\delta(z-z') $$\nThis result represents a local, or \"diagonal\", modification to the integral operator, as correctly characterized in the problem statement. The impedance term adds a contribution that depends on the current at the same point $z$, which is mathematically modeled by the Dirac delta function in the kernel.", "answer": "$$\\boxed{-j \\omega \\epsilon \\frac{Z_{s}}{2 \\pi a} \\delta(z-z')}$$", "id": "3355297"}, {"introduction": "This practice [@problem_id:3316832] moves from analytical formulation to computational simulation, a core workflow in engineering design. You will implement a simulation to calculate the broadband reflection from a surface described by an impedance boundary condition, exploring how different physical models for the surface impedance—from a simple resistive sheet to a dispersive Drude conductor—affect the material's interaction with electromagnetic waves. This exercise provides direct, hands-on experience in modeling material properties and predicting their frequency-dependent performance.", "problem": "You are to design and implement a multi-frequency and broadband computational strategy for determining plane-wave reflection from a planar boundary modeled by the Leontovich Impedance Boundary Condition (IBC). The work must proceed from first principles and fundamental laws. Begin with frequency-domain Maxwell equations, the constitutive relations for linear, homogeneous, isotropic media, and the Leontovich boundary relation between tangential electric field and tangential magnetic field at the surface. Your target is a single interface located at $z=0$ separating free space ($z>0$) from a semi-infinite passive material ($z<0$), where the surface is modeled by a frequency-dependent surface impedance. Assume normal incidence of a uniform plane wave from $z>0$.\n\nUse the following foundations:\n- Maxwell-Faraday law and Maxwell-Ampère law in the frequency domain, together with $\\mathbf{D}=\\epsilon \\mathbf{E}$ and $\\mathbf{B}=\\mu \\mathbf{H}$ for linear, homogeneous, isotropic media.\n- For free space use $\\epsilon_0$ and $\\mu_0$ and define the free-space intrinsic impedance $\\eta_0=\\sqrt{\\mu_0/\\epsilon_0}$.\n- For the boundary at $z=0$ use the Leontovich Impedance Boundary Condition (IBC): the tangential fields satisfy a proportionality relation determined by a surface impedance $Z_s(\\omega)$, where $\\omega$ is angular frequency in radians per second.\n\nYour tasks are:\n1. Starting from the above fundamental laws, derive the reflection coefficient at normal incidence in terms of the free-space intrinsic impedance and the surface impedance implied by the Leontovich IBC. Do not assume any pre-derived reflection formulas. Your derivation must use field continuity conditions, the IBC, and plane-wave relations.\n2. Derive expressions for the frequency-dependent surface impedance $Z_s(\\omega)$ for three passive models:\n   - Model A (Resistive sheet): a thin resistive sheet with constant, real-valued sheet resistance $R_s$; set $Z_s(\\omega)=R_s$.\n   - Model B (Good conductor with constant conductivity): a semi-infinite homogeneous conductor with constant conductivity $\\sigma$ and permeability $\\mu_0$, permittivity $\\epsilon_0$, yielding a frequency-dependent intrinsic impedance that determines $Z_s(\\omega)$.\n   - Model C (Drude conductor): a dispersive conductor modeled by the Drude conductivity with static conductivity $\\sigma_0$ and relaxation time $\\tau$, giving a complex conductivity $\\sigma(\\omega)$ and an intrinsic impedance that determines $Z_s(\\omega)$.\n   Your derivation must start from Maxwell equations and constitutive relations and arrive at each $Z_s(\\omega)$ without assuming shortcut formulas.\n\n3. Implement a multi-frequency simulation that, for each model, evaluates the reflection coefficient over a frequency grid and computes a broadband absorbed power fraction by weighting with a normalized Gaussian spectrum in frequency. The absorbed power fraction at each frequency is one minus the squared magnitude of the reflection coefficient. The Gaussian spectrum $S(f)$ must be centered at a specified center frequency $f_c$ with standard deviation $\\sigma_f$, and your broadband absorbed fraction must be the weighted average over the given frequency grid. Normalize $S(f)$ over the discrete grid so that its sum equals $1$.\n4. Verify passivity numerically for each model across the specified frequency grid by confirming that the real part of $Z_s(\\omega)$ is nonnegative at every frequency.\n5. For each model, compute the difference between the broadband absorbed fraction and the absorbed fraction computed at only the single center frequency $f_c$ (this quantifies the error of single-frequency surrogates in broadband scenarios).\n\nUnits and conventions:\n- All input frequencies $f$ must be specified in hertz (Hz).\n- Angular frequency is $\\omega=2\\pi f$ in radians per second.\n- The absorbed power fraction is dimensionless and must be expressed as a decimal in the interval $[0,1]$.\n- No angles are required; if any angular quantity appears in your derivation, it must be in radians.\n\nTest suite:\nImplement your program for the following three test cases. Use the given parameter values exactly.\n\n- Test Case $1$ (Model A: Resistive sheet):\n  - Sheet resistance $R_s = 50~\\Omega$.\n  - Discrete sample frequencies $f \\in \\{1.0\\times 10^9, 3.0\\times 10^9, 1.0\\times 10^{10}\\}$ Hz.\n  - Gaussian spectrum center $f_c = 5.0\\times 10^9$ Hz with standard deviation $\\sigma_f = 1.0\\times 10^9$ Hz.\n  - Frequency grid for broadband computation: $f_{\\min} = 0.5\\times 10^9$ Hz, $f_{\\max} = 1.0\\times 10^{10}$ Hz, with $N = 501$ uniformly spaced points.\n\n- Test Case $2$ (Model B: Good conductor):\n  - Conductivity $\\sigma = 5.8\\times 10^7$ S/m.\n  - Discrete sample frequencies $f \\in \\{1.0\\times 10^6, 5.0\\times 10^6, 1.0\\times 10^7\\}$ Hz.\n  - Gaussian spectrum center $f_c = 5.0\\times 10^6$ Hz with standard deviation $\\sigma_f = 2.0\\times 10^6$ Hz.\n  - Frequency grid for broadband computation: $f_{\\min} = 1.0\\times 10^6$ Hz, $f_{\\max} = 1.0\\times 10^8$ Hz, with $N = 1001$ uniformly spaced points.\n\n- Test Case $3$ (Model C: Drude conductor):\n  - Static conductivity $\\sigma_0 = 1.0\\times 10^8$ S/m and relaxation time $\\tau = 2.0\\times 10^{-14}$ s.\n  - Discrete sample frequencies $f \\in \\{1.0\\times 10^{12}, 2.0\\times 10^{13}, 5.0\\times 10^{13}\\}$ Hz.\n  - Gaussian spectrum center $f_c = 1.0\\times 10^{13}$ Hz with standard deviation $\\sigma_f = 2.0\\times 10^{12}$ Hz.\n  - Frequency grid for broadband computation: $f_{\\min} = 1.0\\times 10^{12}$ Hz, $f_{\\max} = 1.0\\times 10^{14}$ Hz, with $N = 2001$ uniformly spaced points.\n\nFinal output specification:\n- For each test case, compute:\n  - The broadband absorbed fraction $A_{\\text{broad}}$ (dimensionless decimal).\n  - The difference $D = A_{\\text{broad}} - A(f_c)$, where $A(f_c)$ is the absorbed fraction at the single center frequency $f_c$.\n  - A passivity boolean $P$ indicating whether $\\Re\\{Z_s(\\omega)\\}\\ge 0$ for all frequencies on the grid.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order:\n  $[A_{\\text{broad}}^{(1)}, D^{(1)}, P^{(1)}, A_{\\text{broad}}^{(2)}, D^{(2)}, P^{(2)}, A_{\\text{broad}}^{(3)}, D^{(3)}, P^{(3)}]$.\n\nExpress all broadband absorbed fractions and differences as decimals. The booleans must be literal boolean values. No additional text should be printed.", "solution": "The problem requires the derivation and implementation of a computational strategy to analyze plane-wave reflection from a surface characterized by a Leontovich Impedance Boundary Condition (IBC). The analysis must be performed for three different physical models of the surface impedance over specified frequency bands. The work will proceed from first principles.\n\n### Step 1: Derivation of the Reflection Coefficient\n\nWe begin with the frequency-domain Maxwell's equations for time-harmonic fields varying as $e^{j\\omega t}$ in a linear, homogeneous, isotropic medium:\n$$ \\nabla \\times \\mathbf{E} = -j\\omega\\mathbf{B} $$\n$$ \\nabla \\times \\mathbf{H} = \\mathbf{J} + j\\omega\\mathbf{D} $$\nThe constitutive relations are $\\mathbf{D} = \\epsilon \\mathbf{E}$ and $\\mathbf{B} = \\mu \\mathbf{H}$. For a region with conductivity $\\sigma$, the current density is $\\mathbf{J} = \\sigma\\mathbf{E}$. The Maxwell-Ampère law can then be written as $\\nabla \\times \\mathbf{H} = (\\sigma + j\\omega\\epsilon)\\mathbf{E} = j\\omega\\epsilon_c \\mathbf{E}$, where $\\epsilon_c = \\epsilon - j\\sigma/\\omega$ is the complex permittivity.\n\nThe physical arrangement consists of a planar interface at $z=0$. The region $z>0$ is free space with permittivity $\\epsilon_0$ and permeability $\\mu_0$. The region $z<0$ is a passive material whose boundary at $z=0$ is described by the surface impedance $Z_s(\\omega)$. The intrinsic impedance of free space is $\\eta_0 = \\sqrt{\\mu_0/\\epsilon_0}$.\n\nA uniform plane wave is normally incident from $z>0$ upon the boundary. Let the incident electric field be polarized along the $\\hat{x}$-axis:\n$$ \\mathbf{E}_i(z) = \\hat{x} E_0 e^{-jk_0 z} $$\nwhere $E_0$ is the complex amplitude and $k_0=\\omega\\sqrt{\\mu_0\\epsilon_0}$ is the free-space wavenumber. The corresponding incident magnetic field is found from Maxwell-Faraday law:\n$$ \\mathbf{H}_i(z) = -\\frac{1}{j\\omega\\mu_0} \\nabla \\times \\mathbf{E}_i = -\\frac{1}{j\\omega\\mu_0} \\left( \\hat{y} \\frac{\\partial E_{ix}}{\\partial z} \\right) = \\hat{y} \\frac{k_0}{\\omega\\mu_0} E_0 e^{-jk_0 z} = \\hat{y} \\frac{E_0}{\\eta_0} e^{-jk_0 z} $$\n\nThe reflected wave propagates in the $+z$ direction:\n$$ \\mathbf{E}_r(z) = \\hat{x} E_r e^{+jk_0 z} = \\hat{x} \\Gamma E_0 e^{+jk_0 z} $$\nwhere $\\Gamma = E_r/E_0$ is the reflection coefficient. The corresponding reflected magnetic field is:\n$$ \\mathbf{H}_r(z) = -\\frac{1}{j\\omega\\mu_0} \\nabla \\times \\mathbf{E}_r = -\\frac{1}{j\\omega\\mu_0} \\left( \\hat{y} \\frac{\\partial E_{rx}}{\\partial z} \\right) = \\hat{y} \\frac{-k_0}{\\omega\\mu_0} \\Gamma E_0 e^{+jk_0 z} = -\\hat{y} \\frac{\\Gamma E_0}{\\eta_0} e^{+jk_0 z} $$\nThe negative sign arises from the propagation direction $(-\\hat{z}) \\times (\\hat{x}) = -\\hat{y}$ for the Poynting vector of the reflected wave.\n\nThe total electric and magnetic fields in the region $z>0$ are the superposition of the incident and reflected fields:\n$$ \\mathbf{E}_{\\text{tot}}(z) = \\mathbf{E}_i(z) + \\mathbf{E}_r(z) = \\hat{x} E_0 (e^{-jk_0 z} + \\Gamma e^{+jk_0 z}) $$\n$$ \\mathbf{H}_{\\text{tot}}(z) = \\mathbf{H}_i(z) + \\mathbf{H}_r(z) = \\hat{y} \\frac{E_0}{\\eta_0} (e^{-jk_0 z} - \\Gamma e^{+jk_0 z}) $$\n\nAt the boundary $z=0$, the tangential components of these fields are:\n$$ \\mathbf{E}_{\\text{tan}}(z=0) = \\hat{x} E_0 (1 + \\Gamma) $$\n$$ \\mathbf{H}_{\\text{tan}}(z=0) = \\hat{y} \\frac{E_0}{\\eta_0} (1 - \\Gamma) $$\n\nThe Leontovich Impedance Boundary Condition relates the tangential electric and magnetic fields at the surface of a lossy material:\n$$ \\mathbf{E}_{\\text{tan}} = Z_s (\\hat{n} \\times \\mathbf{H}_{\\text{tan}}) $$\nHere, $\\hat{n}$ is the unit normal vector pointing into the material. In our coordinate system, the material is in the region $z<0$, so $\\hat{n} = -\\hat{z}$. Applying this to our fields at $z=0$:\n$$ \\hat{x} E_0 (1 + \\Gamma) = Z_s(\\omega) \\left( (-\\hat{z}) \\times \\left( \\hat{y} \\frac{E_0}{\\eta_0} (1 - \\Gamma) \\right) \\right) $$\n$$ \\hat{x} E_0 (1 + \\Gamma) = Z_s(\\omega) \\left( \\hat{x} \\frac{E_0}{\\eta_0} (1 - \\Gamma) \\right) $$\nEquating the scalar components and canceling the common factor $E_0$:\n$$ 1 + \\Gamma = \\frac{Z_s(\\omega)}{\\eta_0} (1 - \\Gamma) $$\nSolving for $\\Gamma$:\n$$ \\eta_0 (1 + \\Gamma) = Z_s(\\omega) (1 - \\Gamma) $$\n$$ \\eta_0 + \\eta_0 \\Gamma = Z_s(\\omega) - Z_s(\\omega) \\Gamma $$\n$$ \\Gamma (\\eta_0 + Z_s(\\omega)) = Z_s(\\omega) - \\eta_0 $$\n$$ \\Gamma(\\omega) = \\frac{Z_s(\\omega) - \\eta_0}{Z_s(\\omega) + \\eta_0} $$\nThis expression defines the reflection coefficient at normal incidence in terms of the surface impedance $Z_s(\\omega)$ and the free-space intrinsic impedance $\\eta_0$.\n\n### Step 2: Derivation of Surface Impedance Models\n\nThe surface impedance $Z_s(\\omega)$ for a semi-infinite material is equivalent to its intrinsic impedance $\\eta(\\omega)$. We derive this impedance from the wave equation. For a plane wave propagating in a material with properties $\\mu, \\epsilon, \\sigma$, the wave equation is $\\nabla^2 \\mathbf{E} + k^2 \\mathbf{E} = 0$, where the complex wavenumber is $k = \\omega\\sqrt{\\mu\\epsilon_c} = \\omega\\sqrt{\\mu(\\epsilon - j\\sigma/\\omega)}$. The intrinsic impedance is $\\eta = \\sqrt{\\mu/\\epsilon_c}$.\n\n**Model A: Resistive Sheet**\nThis is a phenomenological model where the boundary is an infinitesimally thin sheet with sheet resistance $R_s$. The impedance is defined directly as a constant, real value independent of frequency:\n$$ Z_s(\\omega) = R_s $$\n\n**Model B: Good Conductor**\nFor a semi-infinite good conductor with constant conductivity $\\sigma$, permeability $\\mu_0$, and permittivity $\\epsilon_0$, the intrinsic impedance is:\n$$ Z_s(\\omega) = \\eta(\\omega) = \\sqrt{\\frac{\\mu_0}{\\epsilon_0 - j\\sigma/\\omega}} $$\nThe \"good conductor\" approximation assumes the conduction current is much larger than the displacement current, i.e., $\\sigma \\gg \\omega\\epsilon_0$. Under this condition, the $\\epsilon_0$ term in the denominator can be neglected:\n$$ Z_s(\\omega) \\approx \\sqrt{\\frac{\\mu_0}{-j\\sigma/\\omega}} = \\sqrt{\\frac{j\\omega\\mu_0}{\\sigma}} $$\nUsing the identity $\\sqrt{j} = \\sqrt{e^{j\\pi/2}} = e^{j\\pi/4} = \\cos(\\pi/4) + j\\sin(\\pi/4) = \\frac{1+j}{\\sqrt{2}}$, we obtain:\n$$ Z_s(\\omega) = \\sqrt{\\frac{\\omega\\mu_0}{\\sigma}} \\frac{1+j}{\\sqrt{2}} = (1+j)\\sqrt{\\frac{\\omega\\mu_0}{2\\sigma}} $$\nThe real part of the impedance, $\\Re\\{Z_s(\\omega)\\} = \\sqrt{\\omega\\mu_0/(2\\sigma)}$, is the surface resistance, which increases with the square root of frequency.\n\n**Model C: Drude Conductor**\nThe Drude model describes the frequency dispersion of conductivity in a metal. The complex conductivity is given by:\n$$ \\sigma(\\omega) = \\frac{\\sigma_0}{1 + j\\omega\\tau} $$\nwhere $\\sigma_0$ is the DC conductivity and $\\tau$ is the mean free time between collisions (relaxation time). The surface impedance is the intrinsic impedance of a medium with this conductivity, permeability $\\mu_0$, and permittivity $\\epsilon_0$. The complex permittivity is:\n$$ \\epsilon_c(\\omega) = \\epsilon_0 - j\\frac{\\sigma(\\omega)}{\\omega} = \\epsilon_0 - j \\frac{\\sigma_0}{\\omega(1 + j\\omega\\tau)} $$\nThe surface impedance is therefore:\n$$ Z_s(\\omega) = \\eta(\\omega) = \\sqrt{\\frac{\\mu_0}{\\epsilon_c(\\omega)}} = \\sqrt{\\frac{\\mu_0}{\\epsilon_0 - \\frac{j\\sigma_0}{\\omega(1 + j\\omega\\tau)}}} $$\n\n### Step 3: Computational Strategy\n\nThe simulation proceeds as follows for each test case:\n1.  **Frequency Grid**: A uniform frequency grid $\\{f_i\\}$ is established from $f_{\\min}$ to $f_{\\max}$ with $N$ points. The angular frequencies are $\\omega_i = 2\\pi f_i$.\n2.  **Surface Impedance**: For each $\\omega_i$ in the grid, the complex surface impedance $Z_s(\\omega_i)$ is computed using the formula for the specified model (A, B, or C).\n3.  **Passivity Verification**: A material is passive if it does not generate energy. For the IBC, this is guaranteed if the real part of the surface impedance is non-negative, $\\Re\\{Z_s(\\omega)\\} \\ge 0$, for all $\\omega > 0$. This condition is checked numerically across the entire frequency grid.\n4.  **Reflection and Absorption**: For each $\\omega_i$, the reflection coefficient $\\Gamma(\\omega_i)$ is calculated. The fraction of incident power absorbed at that frequency is $A(f_i) = 1 - |\\Gamma(\\omega_i)|^2$.\n5.  **Broadband Absorption**: The incident power is assumed to have a Gaussian spectral density $S(f) \\propto \\exp(-\\frac{1}{2}(\\frac{f-f_c}{\\sigma_f})^2)$. This spectrum is evaluated at each grid frequency $f_i$ to obtain weights $S(f_i)$. These weights are then normalized such that their sum over the grid is unity: $S_N(f_i) = S(f_i) / \\sum_j S(f_j)$. The broadband absorbed power fraction $A_{\\text{broad}}$ is the weighted average of the frequency-dependent absorption:\n    $$ A_{\\text{broad}} = \\sum_{i=1}^{N} A(f_i) S_N(f_i) $$\n6.  **Comparison Metric**: To quantify the effect of broadband analysis, the difference $D$ is computed between the broadband absorption $A_{\\text{broad}}$ and the absorption calculated at only the center frequency, $A(f_c)$:\n    $$ D = A_{\\text{broad}} - A(f_c) $$\n    where $A(f_c) = 1 - |\\Gamma(\\omega_c)|^2$ with $\\omega_c = 2\\pi f_c$.\n\nThe final output compiles the key results ($A_{\\text{broad}}$, $D$, and the passivity boolean $P$) for each of the three test cases into a single list.", "answer": "```python\nimport numpy as np\nimport scipy.constants as const\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the three test cases.\n    It derives and computes reflection from a planar boundary modeled by\n    the Leontovich Impedance Boundary Condition (IBC) for different material models.\n    \"\"\"\n\n    # Physical constants\n    mu_0 = const.mu_0\n    epsilon_0 = const.epsilon_0\n    eta_0 = np.sqrt(mu_0 / epsilon_0)\n\n    # --- Model-specific Z_s calculation functions ---\n    def get_zs_model_a(omega, R_s):\n        \"\"\"Computes Z_s for Model A (Resistive Sheet).\"\"\"\n        return np.full_like(omega, R_s, dtype=complex)\n\n    def get_zs_model_b(omega, sigma):\n        \"\"\"Computes Z_s for Model B (Good Conductor).\"\"\"\n        # To avoid division by zero or sqrt of zero if omega contains 0\n        safe_omega = np.maximum(omega, 1e-12) # Use a small floor for omega\n        zs = (1 + 1j) * np.sqrt(safe_omega * mu_0 / (2 * sigma))\n        return zs\n\n    def get_zs_model_c(omega, sigma_0, tau):\n        \"\"\"Computes Z_s for Model C (Drude Conductor).\"\"\"\n        # To avoid division by zero if omega contains 0\n        safe_omega = np.maximum(omega, 1e-12) # Use a small floor for omega\n        sigma_complex = sigma_0 / (1 + 1j * safe_omega * tau)\n        epsilon_complex = epsilon_0 - 1j * sigma_complex / safe_omega\n        # The principal square root is chosen by numpy, which ensures Re(sqrt(z)) >= 0.\n        # This corresponds to a physically decaying wave.\n        zs = np.sqrt(mu_0 / epsilon_complex)\n        return zs\n\n    test_cases = [\n        {\n            \"model\": \"A\",\n            \"params\": {\"R_s\": 50.0},\n            \"grid\": {\"f_min\": 0.5e9, \"f_max\": 10e9, \"N\": 501},\n            \"spectrum\": {\"f_c\": 5.0e9, \"sigma_f\": 1.0e9},\n        },\n        {\n            \"model\": \"B\",\n            \"params\": {\"sigma\": 5.8e7},\n            \"grid\": {\"f_min\": 1.0e6, \"f_max\": 1.0e8, \"N\": 1001},\n            \"spectrum\": {\"f_c\": 5.0e6, \"sigma_f\": 2.0e6},\n        },\n        {\n            \"model\": \"C\",\n            \"params\": {\"sigma_0\": 1.0e8, \"tau\": 2.0e-14},\n            \"grid\": {\"f_min\": 1.0e12, \"f_max\": 1.0e14, \"N\": 2001},\n            \"spectrum\": {\"f_c\": 1.0e13, \"sigma_f\": 2.0e12},\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        model = case[\"model\"]\n        params = case[\"params\"]\n        grid_params = case[\"grid\"]\n        spectrum_params = case[\"spectrum\"]\n\n        # 1. Create frequency grid\n        f_grid = np.linspace(grid_params[\"f_min\"], grid_params[\"f_max\"], grid_params[\"N\"])\n        omega_grid = 2 * np.pi * f_grid\n\n        # 2. Compute Z_s(omega) for the specified model\n        if model == \"A\":\n            zs_grid = get_zs_model_a(omega_grid, **params)\n        elif model == \"B\":\n            zs_grid = get_zs_model_b(omega_grid, **params)\n        elif model == \"C\":\n            zs_grid = get_zs_model_c(omega_grid, **params)\n        \n        # 3. Verify passivity: Re{Z_s} >= 0\n        passivity = np.all(zs_grid.real >= -1e-15) # Use a small tolerance for floating point errors\n\n        # 4. Compute reflection coefficient Gamma and absorbed power fraction A(f)\n        gamma_grid = (zs_grid - eta_0) / (zs_grid + eta_0)\n        A_f_grid = 1 - np.abs(gamma_grid)**2\n\n        # 5. Compute broadband absorbed fraction\n        f_c = spectrum_params[\"f_c\"]\n        sigma_f = spectrum_params[\"sigma_f\"]\n        \n        # Gaussian spectrum weights (unnormalized)\n        gaussian_spectrum = np.exp(-0.5 * ((f_grid - f_c) / sigma_f)**2)\n        \n        # Normalized weights\n        S_norm = gaussian_spectrum / np.sum(gaussian_spectrum)\n        \n        A_broad = np.sum(A_f_grid * S_norm)\n\n        # 6. Compute absorbed fraction at center frequency f_c\n        omega_c = 2 * np.pi * f_c\n        if model == \"A\":\n            zs_c = get_zs_model_a(omega_c, **params)\n        elif model == \"B\":\n            zs_c = get_zs_model_b(omega_c, **params)\n        elif model == \"C\":\n            zs_c = get_zs_model_c(omega_c, **params)\n            \n        gamma_c = (zs_c - eta_0) / (zs_c + eta_0)\n        A_fc = 1 - np.abs(gamma_c)**2\n        \n        # 7. Compute the difference D\n        D = A_broad - A_fc\n\n        results.extend([A_broad, D, bool(passivity)])\n\n    # Format the final output string\n    output_str = \"[\" + \",\".join(map(str, results)) + \"]\"\n    print(output_str)\n\nsolve()\n```", "id": "3316832"}, {"introduction": "The elegance of the impedance boundary condition on a continuous surface meets the reality of a discrete grid in this advanced practice [@problem_id:3316879]. You will investigate the geometric error that arises when implementing the IBC on a curved interface within a standard staggered Cartesian grid, a common scenario in Finite-Difference Time-Domain (FDTD) methods. By deriving and applying a curvature-aware correction, you will gain firsthand experience with the sophisticated techniques required to maintain accuracy in modern numerical solvers.", "problem": "You are given a two-dimensional transverse electric ($\\mathrm{TE}_z$) scenario where a time-harmonic field with the $z$-directed electric field component $E_z$ interacts with a curved interface that represents the surface of a cylindrical conductor. The interface is modeled by a level set function. The conductor surface is characterized by a local impedance boundary condition (Leontovich) that applies on the interface. Your goal is to implement a curvature-aware discrete enforcement of the impedance boundary condition in a Finite-Difference Time-Domain (FDTD)-style staggered grid using level sets, analyze the geometric aliasing error, and apply a correction derived from curvature.\n\nStarting point and definitions:\n- Maxwell’s equations in the frequency domain for time-harmonic fields with angular frequency $\\omega$ are given by $\\nabla \\times \\mathbf{E} = -j \\omega \\mu \\mathbf{H}$ and $\\nabla \\times \\mathbf{H} = j \\omega \\epsilon \\mathbf{E}$, where $\\mathbf{E}$ is the electric field, $\\mathbf{H}$ is the magnetic field, $\\mu$ is the magnetic permeability, $\\epsilon$ is the electric permittivity, and $j$ is the imaginary unit.\n- The Leontovich impedance boundary condition relates the tangential components on a surface with unit normal $\\hat{\\mathbf{n}}$ via $\\hat{\\mathbf{n}} \\times \\mathbf{E} = Z_s \\mathbf{H}_t$, where $Z_s$ is the surface impedance and $\\mathbf{H}_t$ is the tangential magnetic field on the surface.\n- In the two-dimensional $\\mathrm{TE}_z$ configuration for a cylinder aligned with the $z$-axis, the tangential direction at polar angle $\\theta$ is $\\hat{\\mathbf{t}}(\\theta) = \\hat{\\mathbf{n}}(\\theta) \\times \\hat{\\mathbf{z}} = \\left[-\\sin \\theta, \\cos \\theta\\right]$. The scalar impedance boundary relation simplifies to $E_z = Z_s H_t$, where $H_t = \\hat{\\mathbf{t}} \\cdot \\mathbf{H}$.\n- The curved interface is represented by the level set $\\phi(x,y) = \\sqrt{(x-x_0)^2 + (y-y_0)^2} - R$, which defines a circle of radius $R$ centered at $(x_0, y_0)$. The interface is the zero level $\\phi(x,y) = 0$, and the unit normal is $\\hat{\\mathbf{n}} = \\nabla \\phi / \\|\\nabla \\phi\\|$.\n- The Yee staggered grid arrangement for $\\mathrm{TE}_z$ uses $E_z$ at cell centers, $H_x$ at centers of horizontal edges, and $H_y$ at centers of vertical edges.\n\nDiscrete enforcement model and geometric aliasing:\n- Consider an interface-adjacent $E_z$ cell center at position $(x,y)$ with angle $\\theta = \\arctan2(y - y_0, x - x_0)$ relative to the circle’s center. Assume a manufactured, exact tangential magnetic field $\\mathbf{H}$ that lies along $\\hat{\\mathbf{t}}(\\theta)$ with magnitude $H_{\\mathrm{mag}} = E_0 / Z_s$, where $E_0$ is the exact $E_z$ value at the interface (treated as a complex phasor) and $Z_s$ is the complex surface impedance.\n- The staggered discretization approximates the tangential magnetic field at the $E_z$ cell by averaging magnetic samples:\n  - $H_x$ is sampled from positions $(x, y \\pm \\Delta/2)$, with $\\Delta$ the grid spacing. These samples align with the $x$-component of the tangent at angles $\\theta_{y\\pm} = \\arctan2(y \\pm \\Delta/2 - y_0, x - x_0)$.\n  - $H_y$ is sampled from positions $(x \\pm \\Delta/2, y)$, aligning with the $y$-component of the tangent at angles $\\theta_{x\\pm} = \\arctan2(y - y_0, x \\pm \\Delta/2 - x_0)$.\n  - The averaged discrete magnetic field at the $E_z$ cell is then $\\mathbf{H}_{\\mathrm{disc}} = \\left[H_x^{\\mathrm{avg}}, H_y^{\\mathrm{avg}}\\right]$, and its projection on the local tangent direction yields $H_t^{\\mathrm{disc}} = \\hat{\\mathbf{t}}(\\theta) \\cdot \\mathbf{H}_{\\mathrm{disc}}$.\n- The uncorrected discrete enforcement uses $E_z^{\\mathrm{disc}} = Z_s H_t^{\\mathrm{disc}}$. This deviates from $E_0$ due to geometric aliasing caused by curvature-dependent sampling at staggered positions.\n\nCurvature-aware correction:\n- Derive a second-order curvature-aware correction that compensates the bias induced by sampling at $(x \\pm \\Delta/2, y)$ and $(x, y \\pm \\Delta/2)$ on a circle of radius $R$. Use local curvature $\\kappa = 1/R$. The correction must be expressed explicitly as a local multiplicative factor applied to $Z_s$, yielding a corrected impedance $Z_s^{\\mathrm{corr}}(\\theta)$ that reduces the geometric aliasing error to higher order in $\\Delta/R$.\n- The derivation should start from the level set geometry, the definition of the tangent vector $\\hat{\\mathbf{t}}(\\theta)$, and the staggered sampling of $\\mathbf{H}$ as the average of tangent components at angles offset by $\\delta_x$ and $\\delta_y$. Express $\\delta_x$ and $\\delta_y$ as functions of $\\Delta$, $R$, and $\\theta$. Conclude with a correction factor $g(\\theta,\\Delta,R)$ such that $Z_s^{\\mathrm{corr}} = Z_s / g(\\theta,\\Delta,R)$.\n\nAlgorithmic task:\n- Implement a program that:\n  1. Constructs a Cartesian grid of $N \\times N$ cells with spacing $\\Delta$ (in meters) and centers the circular interface $\\phi(x,y) = 0$ at $(x_0,y_0) = (0,0)$ with radius $R$ (in meters).\n  2. Identifies interface-adjacent cells using the criterion $|\\phi(x,y)| \\le \\Delta/4$.\n  3. Manufactures the exact field with $E_0$ (in volts per meter) and $H_{\\mathrm{mag}} = E_0 / Z_s$ (in amperes per meter) as phasors, and computes the uncorrected discrete enforcement $E_z^{\\mathrm{disc}} = Z_s H_t^{\\mathrm{disc}}$ at those cells.\n  4. Computes the curvature-aware corrected enforcement $E_z^{\\mathrm{corr}} = Z_s^{\\mathrm{corr}} H_t^{\\mathrm{disc}}$ using your derived $Z_s^{\\mathrm{corr}}$.\n  5. Returns the mean absolute relative error for both uncorrected and corrected enforcement over interface-adjacent cells, defined as $\\mathrm{err} = \\frac{|E_z - E_0|}{|E_0|}$, where $|\\cdot|$ denotes complex magnitude.\n\nUnits and angle specification:\n- All lengths ($\\Delta$, $R$) must be in meters.\n- Electric field $E_0$ must be in volts per meter.\n- Surface impedance $Z_s$ must be in ohms.\n- Angles must be in radians.\n\nTest suite:\n- Use the following test cases, each specifying $(N, \\Delta, R, Z_s, E_0)$:\n  1. $(128, 1.0 \\times 10^{-3}, 2.0 \\times 10^{-2}, 10(1 + j), 1.0)$\n  2. $(128, 1.0 \\times 10^{-3}, 4.0 \\times 10^{-3}, 50 + 0j, 1.0)$\n  3. $(64, 2.0 \\times 10^{-3}, 4.0 \\times 10^{-3}, 200 + 100j, 1.0)$\n  4. $(128, 1.0 \\times 10^{-3}, 5.0 \\times 10^{-2}, 5 + 20j, 1.0)$\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case contributes a pair of floating-point numbers $\\left[\\mathrm{err}_{\\mathrm{uncorr}}, \\mathrm{err}_{\\mathrm{corr}}\\right]$. For example, the output should look like $\\left[[e_{1,\\mathrm{uncorr}},e_{1,\\mathrm{corr}}],[e_{2,\\mathrm{uncorr}},e_{2,\\mathrm{corr}}],\\dots\\right]$ with numerical values in place of the symbols.", "solution": "The problem statement has been validated and is deemed sound, well-posed, and scientifically grounded. It presents a clear task in computational electromagnetics, rooted in established principles of Maxwell's equations and numerical methods. We will proceed with the derivation of the curvature correction factor, followed by the algorithmic implementation.\n\nThe primary objective is to derive a correction factor for the surface impedance $Z_s$ that mitigates the geometric aliasing error introduced by a standard staggered-grid approximation of a tangential magnetic field on a curved surface. This error arises because the magnetic field components ($H_x$, $H_y$) are sampled at locations that are spatially offset from the electric field component ($E_z$) location where the impedance boundary condition (IBC) is enforced. On a curved surface, these offsets lead to sampling the field at points with slightly different tangent orientations, causing a systematic bias.\n\n**Derivation of the Curvature-Aware Correction Factor**\n\nLet the interface be a circle of radius $R$ centered at the origin, described by the level set function $\\phi(x,y) = \\sqrt{x^2+y^2} - R = 0$. An interface-adjacent $E_z$ cell center is located at $(x,y)$, which we represent in polar coordinates as $(r, \\theta)$, where $x=r\\cos\\theta$ and $y=r\\sin\\theta$. Since the cell is adjacent to the interface, we have $r \\approx R$. The local unit normal to the circle at angle $\\theta$ is $\\hat{\\mathbf{n}}(\\theta) = [\\cos\\theta, \\sin\\theta]$, and the corresponding unit tangent is $\\hat{\\mathbf{t}}(\\theta) = [-\\sin\\theta, \\cos\\theta]$.\n\nThe problem specifies a manufactured solution where the exact magnetic field $\\mathbf{H}$ at any point is tangential to the circle passing through that point. The magnitude of this field on the circular interface is $H_{\\mathrm{mag}} = E_0/Z_s$. Thus, at any point $(x', y')$ with polar angle $\\theta' = \\arctan2(y',x')$, the exact magnetic field is given by:\n$$ \\mathbf{H}_{\\mathrm{exact}}(x', y') = H_{\\mathrm{mag}} \\hat{\\mathbf{t}}(\\theta') = H_{\\mathrm{mag}} [-\\sin\\theta', \\cos\\theta'] $$\n\nOn the staggered grid, the magnetic field at the $E_z$ cell center $(x,y)$ is estimated by averaging the field components from four neighboring half-grid-step locations:\n$H_x$ is sampled at $(x, y \\pm \\Delta/2)$, and $H_y$ is sampled at $(x \\pm \\Delta/2, y)$, where $\\Delta$ is the grid spacing.\n\nThe averaged discrete magnetic field components are:\n$$ H_x^{\\mathrm{avg}}(x,y) = \\frac{1}{2} \\left[ H_x(x, y - \\Delta/2) + H_x(x, y + \\Delta/2) \\right] $$\n$$ H_y^{\\mathrm{avg}}(x,y) = \\frac{1}{2} \\left[ H_y(x - \\Delta/2, y) + H_y(x + \\Delta/2, y) \\right] $$\n\nTo evaluate these expressions, we must find the angles corresponding to the sampling points. For a small displacement $(\\delta x, \\delta y)$ from a point $(x,y)$ at radius $r$ and angle $\\theta$, the new angle $\\theta'$ can be approximated using a first-order Taylor expansion. The change in angle $\\delta\\theta = \\theta' - \\theta$ is:\n$$ \\delta\\theta \\approx \\frac{\\delta y \\cos\\theta - \\delta x \\sin\\theta}{r} $$\n\nFor the $H_x$ sampling points $(x, y \\pm \\Delta/2)$, we have $\\delta x = 0$ and $\\delta y = \\pm \\Delta/2$. The angular shifts are:\n$$ \\delta\\theta_{y\\pm} = \\pm \\frac{\\Delta \\cos\\theta}{2r} $$\nFor the $H_y$ sampling points $(x \\pm \\Delta/2, y)$, we have $\\delta x = \\pm \\Delta/2$ and $\\delta y = 0$. The angular shifts are:\n$$ \\delta\\theta_{x\\pm} = \\mp \\frac{\\Delta \\sin\\theta}{2r} $$\n\nNow, we find the averaged field components by substituting the manufactured field definitions at these shifted angles. Let's start with $H_x^{\\mathrm{avg}}$. The angles are $\\theta_{y\\pm} = \\theta + \\delta\\theta_{y\\pm}$.\n$$ H_x^{\\mathrm{avg}} = \\frac{1}{2} \\left[ -H_{\\mathrm{mag}}\\sin(\\theta_{y-}) - H_{\\mathrm{mag}}\\sin(\\theta_{y+}) \\right] = -\\frac{H_{\\mathrm{mag}}}{2} \\left[ \\sin(\\theta - \\delta\\theta_{y+}) + \\sin(\\theta + \\delta\\theta_{y+}) \\right] $$\nUsing the identity $\\sin(A-B) + \\sin(A+B) = 2\\sin A \\cos B$:\n$$ H_x^{\\mathrm{avg}} = -H_{\\mathrm{mag}} \\sin\\theta \\cos(\\delta\\theta_{y+}) = -H_{\\mathrm{mag}} \\sin\\theta \\cos\\left(\\frac{\\Delta \\cos\\theta}{2r}\\right) $$\nExpanding the cosine to second order, $\\cos(z) \\approx 1 - z^2/2$:\n$$ H_x^{\\mathrm{avg}} \\approx -H_{\\mathrm{mag}} \\sin\\theta \\left( 1 - \\frac{1}{2}\\left(\\frac{\\Delta \\cos\\theta}{2r}\\right)^2 \\right) = -H_{\\mathrm{mag}} \\sin\\theta \\left( 1 - \\frac{\\Delta^2 \\cos^2\\theta}{8r^2} \\right) $$\n\nSimilarly for $H_y^{\\mathrm{avg}}$, the angles are $\\theta_{x\\pm} = \\theta + \\delta\\theta_{x\\pm}$:\n$$ H_y^{\\mathrm{avg}} = \\frac{1}{2} \\left[ H_{\\mathrm{mag}}\\cos(\\theta_{x-}) + H_{\\mathrm{mag}}\\cos(\\theta_{x+}) \\right] = \\frac{H_{\\mathrm{mag}}}{2} \\left[ \\cos(\\theta + \\delta\\theta_{x+}) + \\cos(\\theta - \\delta\\theta_{x+}) \\right] $$\nUsing $\\cos(A+B) + \\cos(A-B) = 2\\cos A \\cos B$:\n$$ H_y^{\\mathrm{avg}} = H_{\\mathrm{mag}} \\cos\\theta \\cos(\\delta\\theta_{x+}) = H_{\\mathrm{mag}} \\cos\\theta \\cos\\left(\\frac{\\Delta \\sin\\theta}{2r}\\right) $$\nExpanding the cosine to second order:\n$$ H_y^{\\mathrm{avg}} \\approx H_{\\mathrm{mag}} \\cos\\theta \\left( 1 - \\frac{1}{2}\\left(\\frac{\\Delta \\sin\\theta}{2r}\\right)^2 \\right) = H_{\\mathrm{mag}} \\cos\\theta \\left( 1 - \\frac{\\Delta^2 \\sin^2\\theta}{8r^2} \\right) $$\n\nThe discrete tangential magnetic field, $H_t^{\\mathrm{disc}}$, is the projection of the averaged field vector $\\mathbf{H}_{\\mathrm{disc}} = [H_x^{\\mathrm{avg}}, H_y^{\\mathrm{avg}}]$ onto the local tangent $\\hat{\\mathbf{t}}(\\theta) = [-\\sin\\theta, \\cos\\theta]$:\n$$ H_t^{\\mathrm{disc}} = \\mathbf{H}_{\\mathrm{disc}} \\cdot \\hat{\\mathbf{t}}(\\theta) = -H_x^{\\mathrm{avg}}\\sin\\theta + H_y^{\\mathrm{avg}}\\cos\\theta $$\nSubstituting the expressions for $H_x^{\\mathrm{avg}}$ and $H_y^{\\mathrm{avg}}$:\n$$ H_t^{\\mathrm{disc}} \\approx H_{\\mathrm{mag}} \\sin^2\\theta \\left( 1 - \\frac{\\Delta^2 \\cos^2\\theta}{8r^2} \\right) + H_{\\mathrm{mag}} \\cos^2\\theta \\left( 1 - \\frac{\\Delta^2 \\sin^2\\theta}{8r^2} \\right) $$\n$$ H_t^{\\mathrm{disc}} \\approx H_{\\mathrm{mag}} \\left[ (\\sin^2\\theta + \\cos^2\\theta) - \\frac{\\Delta^2}{8r^2}(\\sin^2\\theta\\cos^2\\theta + \\cos^2\\theta\\sin^2\\theta) \\right] $$\n$$ H_t^{\\mathrm{disc}} \\approx H_{\\mathrm{mag}} \\left[ 1 - \\frac{2\\Delta^2 \\sin^2\\theta \\cos^2\\theta}{8r^2} \\right] = H_{\\mathrm{mag}} \\left( 1 - \\frac{\\Delta^2 \\sin^2\\theta \\cos^2\\theta}{4r^2} \\right) $$\nFor interface-adjacent cells, $r \\approx R$. The error committed by this approximation is of higher order than $(\\Delta/R)^2$.\n$$ H_t^{\\mathrm{disc}} \\approx H_{\\mathrm{mag}} \\left( 1 - \\frac{\\Delta^2}{4R^2} \\sin^2\\theta \\cos^2\\theta \\right) $$\nThis expression reveals that the discrete tangential field is systematically smaller in magnitude than the true value $H_{\\mathrm{mag}}$. The uncorrected enforcement, $E_z^{\\mathrm{disc}} = Z_s H_t^{\\mathrm{disc}}$, will therefore be biased.\n\nTo correct this, we define a correction factor $g(\\theta, \\Delta, R)$ such that the corrected IBC enforcement yields the exact field value $E_0$. The problem specifies the corrected impedance as $Z_s^{\\mathrm{corr}} = Z_s / g$.\nThe corrected field is $E_z^{\\mathrm{corr}} = Z_s^{\\mathrm{corr}} H_t^{\\mathrm{disc}} = (Z_s/g) H_t^{\\mathrm{disc}}$. We require $E_z^{\\mathrm{corr}} \\approx E_0 = Z_s H_{\\mathrm{mag}}$.\nThis implies we must choose $g$ such that $(Z_s/g) H_t^{\\mathrm{disc}} = Z_s H_{\\mathrm{mag}}$, which gives:\n$$ g(\\theta, \\Delta, R) = \\frac{H_t^{\\mathrm{disc}}}{H_{\\mathrm{mag}}} $$\nFrom our derivation, the correction factor is:\n$$ g(\\theta, \\Delta, R) = 1 - \\frac{\\Delta^2}{4R^2} \\sin^2\\theta \\cos^2\\theta $$\nThis factor depends on the angular position $\\theta$ and the ratio of grid spacing to radius $\\Delta/R$, which is related to the discrete curvature. The curvature is $\\kappa = 1/R$, so the correction term is proportional to $(\\Delta\\kappa)^2$. Applying this correction, $Z_s^{\\mathrm{corr}} = Z_s / g$, compensates for the geometric aliasing error up to second order in $\\Delta/R$.\n\nThe algorithm will now be implemented based on this derived correction.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the curvature-aware impedance boundary condition problem\n    for a set of test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each case is (N, Delta, R, Zs, E0)\n    test_cases = [\n        (128, 1.0e-3, 2.0e-2, 10 * (1 + 1j), 1.0 + 0j),\n        (128, 1.0e-3, 4.0e-3, 50 + 0j, 1.0 + 0j),\n        (64, 2.0e-3, 4.0e-3, 200 + 100j, 1.0 + 0j),\n        (128, 1.0e-3, 5.0e-2, 5 + 20j, 1.0 + 0j),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, D, R, Zs, E0 = case\n\n        # 1. Construct the grid\n        # Grid coordinates for cell centers\n        coords = D * (np.arange(N) - (N - 1) / 2.0)\n        X, Y = np.meshgrid(coords, coords)\n\n        # 2. Identify interface-adjacent cells\n        # Level set function phi(x,y)\n        phi = np.sqrt(X**2 + Y**2) - R\n        # Find indices of cells where |phi| <= Delta / 4\n        interface_indices = np.argwhere(np.abs(phi) = D / 4.0)\n\n        uncorrected_errors = []\n        corrected_errors = []\n\n        # Pre-calculate magnitude of E0 for error calculation\n        E0_mag = np.abs(E0)\n        # Handle E0=0 case to avoid division by zero, though not in test cases.\n        if E0_mag == 0:\n            E0_mag = 1.0\n\n        H_mag = E0 / Zs\n\n        def get_H_components(xp, yp):\n            \"\"\"\n            Computes the manufactured H-field components at a given point (xp, yp).\n            \"\"\"\n            theta_p = np.arctan2(yp, xp)\n            Hx = -H_mag * np.sin(theta_p)\n            Hy = H_mag * np.cos(theta_p)\n            return Hx, Hy\n\n        # 3.  4. Loop over interface cells to compute errors\n        for idx in interface_indices:\n            i, j = idx\n            x, y = X[i, j], Y[i, j]\n            \n            # Local geometry at the cell center\n            theta = np.arctan2(y, x)\n            sin_t, cos_t = np.sin(theta), np.cos(theta)\n            \n            # Sample H-fields at staggered locations\n            # Hx samples for Hx_avg\n            Hx_at_ym = get_H_components(x, y - D/2.0)[0]\n            Hx_at_yp = get_H_components(x, y + D/2.0)[0]\n            Hx_avg = 0.5 * (Hx_at_ym + Hx_at_yp)\n            \n            # Hy samples for Hy_avg\n            Hy_at_xm = get_H_components(x - D/2.0, y)[1]\n            Hy_at_xp = get_H_components(x + D/2.0, y)[1]\n            Hy_avg = 0.5 * (Hy_at_xm + Hy_at_xp)\n            \n            # Discrete tangential H-field\n            Ht_disc = -Hx_avg * sin_t + Hy_avg * cos_t\n            \n            # Uncorrected enforcement\n            Ez_uncorr = Zs * Ht_disc\n            \n            # Curvature-aware corrected enforcement\n            # Correction factor g(theta, Delta, R)\n            g = 1.0 - (D**2 / (4.0 * R**2)) * (sin_t**2 * cos_t**2)\n            Zs_corr = Zs / g\n            Ez_corr = Zs_corr * Ht_disc\n            \n            # 5. Calculate and store relative errors\n            err_uncorr = np.abs(Ez_uncorr - E0) / E0_mag\n            err_corr = np.abs(Ez_corr - E0) / E0_mag\n            \n            uncorrected_errors.append(err_uncorr)\n            corrected_errors.append(err_corr)\n\n        # Compute mean absolute relative errors for the case\n        mean_err_uncorr = np.mean(uncorrected_errors)\n        mean_err_corr = np.mean(corrected_errors)\n        \n        results.append([mean_err_uncorr, mean_err_corr])\n    \n    # Format the final output string as specified: [[err1_u,err1_c],[err2_u,err2_c],...]\n    formatted_results = [f\"[{r[0]},{r[1]}]\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3316879"}]}