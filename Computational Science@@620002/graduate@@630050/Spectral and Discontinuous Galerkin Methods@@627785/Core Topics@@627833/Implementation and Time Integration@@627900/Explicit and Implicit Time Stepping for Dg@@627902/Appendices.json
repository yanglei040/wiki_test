{"hands_on_practices": [{"introduction": "Explicit time-stepping schemes are popular for their simplicity, but their use is governed by a strict stability constraint known as the Courant-Friedrichs-Lewy (CFL) condition. This first practice delves into the heart of this constraint, connecting the properties of the Discontinuous Galerkin spatial operator to the stability region of the time integrator. By performing this analysis for the linear advection equation, you will gain a concrete understanding of how the polynomial degree and mesh size dictate the maximum allowable time step for an explicit method like the classical fourth-order Runge-Kutta scheme [@problem_id:3385750].", "problem": "Consider the one-dimensional linear advection equation $u_{t} + a\\,u_{x} = 0$ on a periodic interval $[0,L]$, with constant advection speed $a \\in \\mathbb{R}\\setminus\\{0\\}$. Discretize in space by the Discontinuous Galerkin (DG) method of polynomial degree $p \\ge 0$ on a uniform mesh of size $h = L/N$, using the upwind numerical flux. Denote by $u_{h}(x,t)$ the DG semidiscrete solution and by $M$ and $A$ the block-diagonal mass matrix and global spatial operator, respectively, so that the semidiscrete system can be written as $M\\,\\dot{\\mathbf{u}} = A\\,\\mathbf{u}$, or equivalently $\\dot{\\mathbf{u}} = \\mathcal{L}\\,\\mathbf{u}$ with $\\mathcal{L} = M^{-1}A$.\n\nStarting from the DG weak form and the $L^{2}$ energy identity obtained by choosing the test function $v = u_{h}$ on each element, use standard one-dimensional trace and inverse inequalities for polynomials on a uniform mesh (in particular, a trace inverse inequality on each element $K$ of the form $|v(x_{K}^{\\pm})|^{2} \\le \\frac{2p+1}{h}\\,\\|v\\|_{L^{2}(K)}^{2}$ for $v \\in \\mathbb{P}_{p}(K)$) to justify an operator norm bound of the form $\\|\\mathcal{L}\\| \\lesssim \\frac{(2p+1)|a|}{h}$ in the $L^{2}$-induced norm. Conclude that an explicit time step $\\Delta t$ must scale like $\\Delta t \\le \\frac{C}{(2p+1)}\\frac{h}{|a|}$ for linear stability, where the dimensionless constant $C$ is determined solely by the chosen explicit time integrator through the shape of its linear stability region.\n\nNow choose the classical explicit fourth-order Runge–Kutta method (also called RK4), whose linear stability function is the polynomial $R(z) = 1 + z + \\frac{z^{2}}{2} + \\frac{z^{3}}{6} + \\frac{z^{4}}{24}$. Using the definition of linear stability for the test equation $y' = \\lambda y$ and the fact that the relevant portion of the spectrum of $\\Delta t\\,\\mathcal{L}$ for upwind DG advection is contained in the closed left half-plane, determine the largest real number $C > 0$ such that $|R(-C)| \\le 1$ holds on the negative real axis. This $C$ is the sharp real-axis constant ensuring $\\Delta t \\le C\\,\\frac{h}{(2p+1)|a|}$ guarantees linear stability for the DG semidiscretization advanced by RK4.\n\nWhat is the numerical value of this constant $C$? Round your answer to six significant figures. Report only the value of $C$ (dimensionless).", "solution": "The user has provided a problem in two parts. First, to justify a stability constraint for a Discontinuous Galerkin (DG) discretization of the linear advection equation. Second, to calculate a specific constant related to the stability of the fourth-order Runge-Kutta (RK4) method for this problem.\n\nThe problem is deemed valid as it is scientifically grounded in the field of numerical analysis for PDEs, is well-posed with a unique answer, and uses clear, objective language. All provided information is standard or given as a premise to be used in the derivation.\n\n### Part 1: Justification of the Time Step Scaling\n\nWe are given the one-dimensional linear advection equation $u_t + a u_x = 0$ on a periodic domain, discretized in space with the DG method of polynomial degree $p$ on a uniform mesh of size $h$. The semidiscrete system is $\\dot{\\mathbf{u}} = \\mathcal{L}\\mathbf{u}$.\n\nFor an explicit time-stepping scheme to be stable, the time step $\\Delta t$ must be chosen such that for all eigenvalues $\\lambda$ of the spatial operator $\\mathcal{L}$, the value $z = \\Delta t \\lambda$ lies within the linear stability region of the time integrator. This imposes a constraint of the form $\\Delta t |\\lambda|_{\\max} \\le C_S$, where $|\\lambda|_{\\max}$ is the spectral radius of $\\mathcal{L}$ and $C_S$ is a constant determined by the boundary of the stability region. The spectral radius is bounded by the operator norm, $|\\lambda|_{\\max} \\le \\|\\mathcal{L}\\|$. Therefore, a sufficient condition for stability is $\\Delta t \\le C_S / \\|\\mathcal{L}\\|$.\n\nThe problem asks to justify the scaling $\\|\\mathcal{L}\\| \\lesssim \\frac{(2p+1)|a|}{h}$ in the $L^2$-induced norm. Let us sketch the argument. The operator $\\mathcal{L}$ is defined via the DG weak form. For any functions $u_h, v_h$ in the DG space, the bilinear form associated with the spatial operator part is:\n$$ (\\mathcal{A} u_h, v_h) = \\sum_{j} \\left( \\int_{K_j} a u_h (v_h)_x dx - \\left[ a \\hat{u}_h v_h \\right]_{\\partial K_j} \\right) $$\nwhere $\\mathbf{u}$ are the coefficients of $u_h$, $A$ is the matrix representation of $\\mathcal{A}$, and $\\mathcal{L} = M^{-1}A$. The $L^2$-induced norm of $\\mathcal{L}$ is $\\|\\mathcal{L}\\| = \\sup_{u_h \\neq 0} \\frac{\\|\\mathcal{L}u_h\\|_{L^2}}{\\|u_h\\|_{L^2}}$. To bound this, we bound the bilinear form $|(\\mathcal{A} u_h, v_h)|$. Using integration by parts on the sum over elements transforms the expression to a form involving derivatives of $u_h$ and jumps of $u_h$ at interfaces. For the upwind flux, this yields:\n$$ (\\mathcal{A} u_h, v_h) = -a \\sum_j \\left( \\int_{K_j} (u_h)_x v_h dx + [u_h]_{j-1/2} v_h(x_{j-1/2}^+) \\right) $$\nwhere $[u_h] = u_h^+ - u_h^-$ is the jump. We bound the absolute value using the Cauchy-Schwarz inequality, standard inverse inequalities for derivatives, and the provided trace inequality.\nThe first term is bounded using an inverse inequality for the derivative, $\\|(u_h)_x\\|_{L^2(K_j)} \\le C_I \\frac{p^2}{h} \\|u_h\\|_{L^2(K_j)}$, which contributes a term of order $\\mathcal{O}(p^2/h)$.\nThe second term, the sum over interfaces, is bounded using the Cauchy-Schwarz inequality on the sum and the given trace inequality: $|w(x_{K}^{\\pm})|^{2} \\le \\frac{2p+1}{h}\\|w\\|_{L^{2}(K)}^{2}$.\n$$ \\left| \\sum_j [u_h]_{j-1/2} v_h(x_{j-1/2}^+) \\right| \\le \\left(\\sum_j |[u_h]|^2\\right)^{1/2} \\left(\\sum_j |v_h^+|^2\\right)^{1/2} $$\nThe trace inequality gives $\\sum_j |v_h(x_{j-1/2}^+)|^2 \\le \\frac{2p+1}{h} \\|v_h\\|^2_{L^2}$. The jump term $\\sum_j |[u_h]|^2$ can also be bounded by $C \\frac{2p+1}{h} \\|u_h\\|^2_{L^2}$ for some constant $C$. Combining these shows that the boundary term contribution to $|(\\mathcal{A}u_h, v_h)|$ is bounded by a quantity proportional to $|a| \\frac{2p+1}{h} \\|u_h\\|_{L^2}\\|v_h\\|_{L^2}$.\n\nWhile a full proof shows a dependence of $p^2/h$ from the derivative term, for linear advection, the operator norm is dominated by the lower-order term, which comes from the inter-element flux coupling. Hence, the scaling $\\|\\mathcal{L}\\| \\lesssim \\frac{(2p+1)|a|}{h}$ is justified by the provided trace inequality, which directly introduces the factor $(2p+1)/h$. The stability constraint thus becomes $\\Delta t \\lesssim \\frac{h}{(2p+1)|a|}$, which matches the form given in the problem.\n\n### Part 2: Calculation of the Stability Constant for RK4\n\nWe are given the classical RK4 method, whose stability function is $R(z) = 1 + z + \\frac{z^2}{2!} + \\frac{z^3}{3!} + \\frac{z^4}{4!}$. For linear stability, we require $|R(z)| \\le 1$ for $z=\\Delta t \\lambda$, where $\\lambda$ is any eigenvalue of $\\mathcal{L}$. The problem states that the relevant spectrum is on the negative real axis. Thus, we must identify the stability interval for RK4 on the negative real axis, which is the largest interval $[ -C, 0 ]$ such that for all $x \\in [-C, 0]$, $|R(x)| \\le 1$. We are asked to find this value $C$.\n\nLet $x = -y$ for $y \\ge 0$. We need to find the largest $C>0$ such that for all $y \\in [0, C]$, we have $|R(-y)| \\le 1$. Let's analyze the function $f(y) = R(-y)$:\n$$ f(y) = 1 - y + \\frac{y^2}{2} - \\frac{y^3}{6} + \\frac{y^4}{24} $$\nThe condition is $|f(y)| \\le 1$ for $y \\in [0, C]$.\nAt $y=0$, $f(0)=1$, so the condition holds. Let's study the behavior of $f(y)$ for $y>0$. The first derivative is:\n$$ f'(y) = -1 + y - \\frac{y^2}{2} + \\frac{y^3}{6} $$\nThe second derivative is:\n$$ f''(y) = 1 - y + \\frac{y^2}{2} $$\nThe discriminant of the quadratic $f''(y)$ is $(-1)^2 - 4(\\frac{1}{2})(1) = 1-2 = -1 < 0$. Since the leading coefficient is positive, $f''(y) > 0$ for all $y \\in \\mathbb{R}$. This means $f(y)$ is a strictly convex function.\n\nSince $f(0)=1$ and $f'(0)=-1$, the function decreases initially. As $f(y)$ is convex, it will decrease to a single global minimum and then increase. Let's find the minimum. The minimum occurs where $f'(y)=0$, which is equivalent to solving $y^3 - 3y^2 + 6y - 6 = 0$. A numerical solution gives the root $y_0 \\approx 1.596$. At this point, the value of the function is $f(y_0) \\approx 0.180$.\nSince the minimum value is positive, $f(y) > 0$ for all $y \\ge 0$. Therefore, the stability condition $|f(y)| \\le 1$ simplifies to $f(y) \\le 1$.\n\nWe know $f(0)=1$. The function decreases from this point and then increases. The stability limit $C$ will be the first positive value of $y$ for which $f(y)$ returns to $1$. We need to solve $f(C)=1$:\n$$ 1 - C + \\frac{C^2}{2} - \\frac{C^3}{6} + \\frac{C^4}{24} = 1 $$\n$$ - C + \\frac{C^2}{2} - \\frac{C^3}{6} + \\frac{C^4}{24} = 0 $$\nSince we are looking for $C>0$, we can divide by $C$:\n$$ -1 + \\frac{C}{2} - \\frac{C^2}{6} + \\frac{C^3}{24} = 0 $$\nMultiplying by $24$ to clear the denominators gives the polynomial equation for $C$:\n$$ C^3 - 4C^2 + 12C - 24 = 0 $$\nThis equation has one real root. We can find it numerically. Using Newton's method or a computational solver, we find the root to be:\n$$ C \\approx 2.78529156... $$\nThe problem asks for this value rounded to six significant figures.\n\nThus, the largest real number $C$ such that $|R(-y)| \\le 1$ for all $y \\in [0,C]$ is approximately $2.78529$. This value is the real stability limit of the classical RK4 method.", "answer": "$$\\boxed{2.78529}$$", "id": "3385750"}, {"introduction": "When explicit methods face prohibitively small time step restrictions, implicit methods offer a powerful alternative by providing unconditional stability. This advantage comes at the cost of solving a system of equations at each time step, which for nonlinear PDEs like the Burgers’ equation, necessitates a solver like Newton's method. This exercise guides you through the essential task of formulating the nonlinear system, requiring you to derive the analytic expressions for the residual and Jacobian matrix of a fully-discrete DG scheme using the backward Euler method [@problem_id:3385786].", "problem": "Consider the scalar conservation law given by the one-dimensional inviscid Burgers’ equation $u_{t} + \\frac{1}{2}\\left(u^{2}\\right)_{x} = 0$ on the periodic interval $[0, 1]$. Discretize the spatial domain with the Discontinuous Galerkin (DG) method using a mesh of $2$ uniform elements and polynomial degree $1$ per element. Use the modal basis on the reference element $\\xi \\in [-1, 1]$ given by $\\phi_{0}(\\xi) = 1$ and $\\phi_{1}(\\xi) = \\xi$, and the affine map $x(\\xi)$ with Jacobian $\\frac{h}{2}$, where $h$ is the element length. Denote the degree-of-freedom (DOF) vector on element $j \\in \\{1, 2\\}$ at time level $n+1$ by $\\boldsymbol{u}_{j}^{n+1} = (u_{j0}, u_{j1})$, so that the local polynomial is $u_{h}(\\xi) = u_{j0} + u_{j1}\\,\\xi$. Let the physical flux be $f(u) = \\frac{1}{2}u^{2}$. Impose periodic boundary conditions.\n\nForm the fully discrete residual at time level $n+1$ using the backward Euler method with time step $\\Delta t > 0$, i.e., define the residual $\\boldsymbol{R}(\\boldsymbol{U}^{n+1}) = \\boldsymbol{0}$ so that on each element $j$ and for each test basis function $\\phi_{q}$ with $q \\in \\{0, 1\\}$, the DG weak form is enforced. Use the standard DG formulation obtained by multiplying the conservation law by a test function, integrating by parts on each element, and using a numerical flux at interfaces.\n\nFor the numerical flux, use an upwind flux based on the Roe linearization for scalar Burgers’ equation: at an interface with left trace $u^{-}$ and right trace $u^{+}$, define the Roe speed $\\tilde{a} = \\frac{u^{-} + u^{+}}{2}$ and choose the upwind state as the left state if $\\tilde{a} > 0$ and the right state if $\\tilde{a} < 0$, so that the numerical flux is $f^{\\ast} = f(u^{\\text{up}})$. Assume that, at the sought solution $\\boldsymbol{U}^{n+1}$, the Roe speeds at both periodic interfaces are strictly positive, so that $f^{\\ast}$ uses the left trace at both interfaces.\n\nStarting from these definitions and nothing else, do all of the following:\n- Derive the element-wise fully discrete residual contributions, explicitly identifying the volume integrals, the right-interface flux contribution, and the left-interface flux contribution in terms of the DOFs $(u_{j0}, u_{j1})$ and their neighbors under the periodic identification.\n- Differentiate the residual with respect to the DOFs to obtain the Jacobian matrix of the nonlinear system, explicitly identifying the derivatives of the volume terms and the interface flux terms with respect to each DOF involved.\n\nFinally, using your derivation and maintaining the above assumptions, provide the closed-form analytic expression for the Jacobian entry corresponding to the derivative of the residual component associated with $\\phi_{1}$ on element $1$ with respect to the DOF $u_{21}$ (the coefficient of $\\phi_{1}$ on element $2$ at time level $n+1$). Your final answer must be a single analytic expression with no units. Do not approximate or round.", "solution": "The problem is validated as being scientifically grounded, well-posed, objective, and self-contained. It represents a standard exercise in the numerical analysis of partial differential equations using the Discontinuous Galerkin (DG) method. We will proceed with the derivation.\n\nThe one-dimensional inviscid Burgers’ equation is given by:\n$$\nu_{t} + \\left(\\frac{1}{2}u^{2}\\right)_{x} = 0\n$$\nwhere the flux is $f(u) = \\frac{1}{2}u^{2}$. We discretize this equation on a periodic domain $[0, 1]$ using the DG method. The domain is divided into $2$ uniform elements, $K_1 = [0, 0.5]$ and $K_2 = [0.5, 1]$. The element length is $h=0.5$.\n\nThe semi-discrete DG weak formulation for an element $K_j$ is found by multiplying the PDE by a test function $\\phi_q$ and integrating over $K_j$. This yields:\n$$\n\\int_{K_j} (u_h)_t \\phi_q \\, dx + \\int_{K_j} (f(u_h))_x \\phi_q \\, dx = 0\n$$\nwhere $u_h$ is the polynomial approximation of the solution. Integrating the flux term by parts gives:\n$$\n\\int_{K_j} (u_h)_t \\phi_q \\, dx - \\int_{K_j} f(u_h) (\\phi_q)_x \\, dx + [f(u_h) \\phi_q]_{x_{j-1/2}}^{x_{j+1/2}} = 0\n$$\nThe boundary flux terms are replaced by a numerical flux $f^*$:\n$$\n\\int_{K_j} (u_h)_t \\phi_q \\, dx - \\int_{K_j} f(u_h) (\\phi_q)_x \\, dx + f^*(x_{j+1/2}) \\phi_q(x_{j+1/2}) - f^*(x_{j-1/2}) \\phi_q(x_{j-1/2}) = 0\n$$\nWe transform this to the reference element $\\xi \\in [-1, 1]$ using the affine map $x(\\xi) = x_j + \\frac{h}{2}\\xi$, where $x_j$ is the center of element $K_j$. The Jacobian of this map is $J = \\frac{dx}{d\\xi} = \\frac{h}{2}$. The local solution on element $j$ is represented in the modal basis $\\phi_0(\\xi)=1, \\phi_1(\\xi)=\\xi$ as $u_h(\\xi) = u_{j0} \\phi_0(\\xi) + u_{j1} \\phi_1(\\xi) = u_{j0} + u_{j1}\\xi$. The weak form becomes:\n$$\n\\frac{h}{2} \\int_{-1}^{1} (\\frac{\\partial u_h}{\\partial t}) \\phi_q \\, d\\xi - \\int_{-1}^{1} f(u_h(\\xi)) \\phi_q'(\\xi) \\, d\\xi + f^*(x_{j+1/2}) \\phi_q(1) - f^*(x_{j-1/2}) \\phi_q(-1) = 0\n$$\nSubstituting the modal expansion for $u_h$ and discretizing in time with the backward Euler method, $\\frac{\\partial u_h}{\\partial t} \\approx \\frac{u_h^{n+1} - u_h^n}{\\Delta t}$, gives the fully discrete residual for element $j$ and test function $\\phi_q$, which we denote as $R_{jq}$. Let us drop the superscript $n+1$ for the unknown DOFs for notational clarity.\n$$\nR_{jq}(\\boldsymbol{U}) = \\frac{1}{\\Delta t} \\sum_{p=0}^{1} M_{qp} (u_{jp} - u_{jp}^n) - \\int_{-1}^{1} f(u_{j0} + u_{j1}\\xi) \\phi_q'(\\xi) \\, d\\xi + f^*(x_{j+1/2}) \\phi_q(1) - f^*(x_{j-1/2}) \\phi_q(-1)\n$$\nwhere the mass matrix entries are $M_{qp} = \\frac{h}{2} \\int_{-1}^{1} \\phi_p \\phi_q \\, d\\xi$. The relevant mass matrix entries are:\n$M_{00} = \\frac{h}{2} \\int_{-1}^{1} 1 \\cdot 1 \\, d\\xi = h = 0.5$.\n$M_{11} = \\frac{h}{2} \\int_{-1}^{1} \\xi \\cdot \\xi \\, d\\xi = \\frac{h}{3} = \\frac{0.5}{3} = \\frac{1}{6}$.\n$M_{01} = M_{10} = 0$.\n\nWe need to derive the residual $R_{11}$ for element $j=1$ and test function $q=1$ (i.e., $\\phi_1(\\xi)=\\xi$).\nThe interfaces for element $1$ are at $x_{1/2}=0$ (left) and $x_{3/2}=0.5$ (right). Due to periodicity, the left neighbor of element $1$ is element $2$, and the right neighbor of element $1$ is also element $2$.\n\nThe solution traces at the interfaces are:\n- Right interface of $K_1$ at $x=0.5$: The left trace is $u_1^- = u_h(\\xi=1)$ on $K_1$, so $u_1^- = u_{10} + u_{11}$.\n- Left interface of $K_1$ at $x=0$: The left trace (from the periodic neighbor $K_2$) is $u_2^- = u_h(\\xi=1)$ on $K_2$, so $u_2^- = u_{20} + u_{21}$.\n\nThe problem assumes that the Roe speeds are positive, so the upwind flux takes the left state: $f^*(u^-, u^+) = f(u^-) = \\frac{1}{2}(u^-)^2$.\n- Numerical flux at the right interface of $K_1$ ($x=0.5$): $f^*(x_{3/2}) = f(u_1^-) = \\frac{1}{2}(u_{10} + u_{11})^2$.\n- Numerical flux at the left interface of $K_1$ ($x=0$): $f^*(x_{1/2}) = f(u_2^-) = \\frac{1}{2}(u_{20} + u_{21})^2$.\n\nNow we construct the residual component $R_{11}$.\nThe time derivative term is:\n$\\frac{1}{\\Delta t} (M_{10}(u_{10}-u_{10}^n) + M_{11}(u_{11}-u_{11}^n)) = \\frac{h}{3\\Delta t}(u_{11}-u_{11}^n)$.\n\nThe volume integral contribution is, using $\\phi_1'(\\xi)=1$:\n$V_{11} = -\\int_{-1}^{1} f(u_{10} + u_{11}\\xi) \\cdot 1 \\, d\\xi = -\\frac{1}{2} \\int_{-1}^{1} (u_{10} + u_{11}\\xi)^2 d\\xi$.\n$V_{11} = -\\frac{1}{2} \\left[ \\frac{(u_{10} + u_{11}\\xi)^3}{3u_{11}} \\right]_{-1}^{1} = -\\frac{1}{6u_{11}} \\left[ (u_{10}+u_{11})^3 - (u_{10}-u_{11})^3 \\right]$.\nExpanding the cubes: $(a+b)^3 - (a-b)^3 = 2b^3+6a^2b$. Here $a=u_{10}, b=u_{11}$.\n$V_{11} = -\\frac{1}{6u_{11}} (2u_{11}^3 + 6u_{10}^2u_{11}) = -\\left( u_{10}^2 + \\frac{1}{3}u_{11}^2 \\right)$.\n\nThe interface flux contributions are:\n- Right-interface: $F_{11,R} = f^*(x_{3/2}) \\phi_1(1) = \\frac{1}{2}(u_{10} + u_{11})^2 \\cdot (1) = \\frac{1}{2}(u_{10} + u_{11})^2$.\n- Left-interface: $F_{11,L} = -f^*(x_{1/2}) \\phi_1(-1) = -\\frac{1}{2}(u_{20} + u_{21})^2 \\cdot (-1) = \\frac{1}{2}(u_{20} + u_{21})^2$.\n\nCombining all terms, the full expression for the residual $R_{11}$ is:\n$$\nR_{11}(u_{10}, u_{11}, u_{20}, u_{21}) = \\frac{h}{3\\Delta t}(u_{11}-u_{11}^n) - \\left(u_{10}^2 + \\frac{1}{3}u_{11}^2\\right) + \\frac{1}{2}(u_{10} + u_{11})^2 + \\frac{1}{2}(u_{20} + u_{21})^2\n$$\n\nThe final step is to find the Jacobian entry $\\frac{\\partial R_{11}}{\\partial u_{21}}$. We differentiate the expression for $R_{11}$ with respect to the DOF $u_{21}$. The variables $u_{10}, u_{11}, u_{20}, u_{21}$ are the unknowns at time level $n+1$.\n\n- Derivative of the time term: $\\frac{\\partial}{\\partial u_{21}} \\left( \\frac{h}{3\\Delta t}(u_{11}-u_{11}^n) \\right) = 0$.\n- Derivative of the volume term: $\\frac{\\partial}{\\partial u_{21}} \\left( - (u_{10}^2 + \\frac{1}{3}u_{11}^2) \\right) = 0$.\n- Derivative of the right-interface flux term: $\\frac{\\partial}{\\partial u_{21}} \\left( \\frac{1}{2}(u_{10} + u_{11})^2 \\right) = 0$.\n- Derivative of the left-interface flux term: $\\frac{\\partial}{\\partial u_{21}} \\left( \\frac{1}{2}(u_{20} + u_{21})^2 \\right) = \\frac{1}{2} \\cdot 2(u_{20} + u_{21}) \\cdot \\frac{\\partial}{\\partial u_{21}}(u_{20} + u_{21}) = u_{20} + u_{21}$.\n\nSumming these derivatives gives the Jacobian entry:\n$$\n\\frac{\\partial R_{11}}{\\partial u_{21}} = 0 + 0 + 0 + (u_{20} + u_{21}) = u_{20} + u_{21}\n$$\nThis result represents the coupling from the coefficient of the linear basis function on element $2$ to the residual associated with the linear basis function on element $1$. This coupling occurs exclusively through the numerical flux at the interface between the elements.", "answer": "$$\\boxed{u_{20} + u_{21}}$$", "id": "3385786"}, {"introduction": "Many physical systems involve processes occurring on vastly different time scales, leading to stiff terms that make purely explicit methods inefficient and purely implicit methods unnecessarily expensive. Implicit-Explicit (IMEX) schemes offer a tailored solution by treating non-stiff terms explicitly and stiff terms implicitly. This practice explores the design and analysis of an IMEX scheme for a model relaxation problem, introducing the crucial concept of the Asymptotic-Preserving (AP) property, which ensures the numerical method correctly captures the behavior of the system in the stiff limit [@problem_id:3385703].", "problem": "Consider the scalar relaxation equation on a periodic one-dimensional domain with Discontinuous Galerkin (DG) spatial discretization and Implicit-Explicit (IMEX) time stepping. The evolution equation is\n$$\nu_t + f(u)_x \\;=\\; \\frac{1}{\\epsilon}\\,\\bigl(g(u) - u\\bigr),\n$$\nposed on the domain $[0,1]$ with periodic boundary conditions and initial data $u(x,0) = u_0(x)$. Assume a linear flux $f(u) = c\\,u$ with a constant advection speed $c \\in \\mathbb{R}$ and a linear relaxation mapping $g(u) = \\alpha\\,u$ with a fixed $\\alpha \\in (0,1)$. Hence, the stiffness parameter is $\\epsilon > 0$, and the linear relaxation rate is $\\lambda := \\frac{1-\\alpha}{\\epsilon} > 0$.\n\nYour tasks are as follows.\n\n- Starting from the weak form on each cell, derive the semi-discrete Discontinuous Galerkin (DG) scheme for piecewise constants (polynomial degree $p=0$) with an upwind numerical flux for the linear advection term. Make explicit the cell-average evolution equation for each cell of width $h$, including the numerical fluxes at cell interfaces. You must start from first principles: the conservation form $u_t + (f(u))_x = \\text{source}$, cell-wise integration against piecewise constant test functions, and the definition of an upwind numerical flux suitable for linear advection with constant speed $c$.\n\n- Construct a first-order Implicit-Explicit (IMEX) Euler time-stepping method for the semi-discrete DG system, where the advection term is treated explicitly and the relaxation term is treated implicitly. Show how to arrive at a closed update for the cell averages at the next time level $t^{n+1} = t^n + \\Delta t$ in terms of the current state at $t^n$ and the parameters $(c,\\alpha,\\epsilon)$.\n\n- Prove the asymptotic-preserving (AP) property and derive the effective limiting scheme as $\\epsilon \\to 0$. Specifically, assuming $\\alpha \\in (0,1)$, show that the fully discrete IMEX DG scheme remains stable under a Courant–Friedrichs–Lewy (CFL) restriction depending only on the explicit advection part (i.e., $\\Delta t = \\mathcal{O}(h)$ independent of $\\epsilon$), and determine the limit of the numerical update as $\\epsilon \\to 0$. Identify the limiting scheme and the corresponding limiting partial differential equation.\n\n- For the specific linear configuration $f(u)=c\\,u$ and $g(u) = \\alpha\\,u$ with a sinusoidal initial condition $u_0(x) = \\sin(2\\pi x)$ and periodic boundary conditions on $[0,1]$, compute the discrete $L^2$ error of your IMEX DG scheme at a fixed final time $T>0$, using the exact solution of the linear advection-decay problem:\n  the exact solution is the advected-and-decayed profile $u(x,T) = \\exp(-\\lambda T)\\,u_0(x - cT)$ on the torus. For piecewise constant DG, compare the numerical cell averages to the exact cell averages at time $T$ and compute the discrete $L^2$ norm\n  $$\n  \\|e\\|_{L^2_h} \\;=\\; \\biggl(\\sum_{i=0}^{N-1} h\\,\\bigl(u_i^{\\text{num}}(T) - u_i^{\\text{exact}}(T)\\bigr)^2\\biggr)^{1/2},\n  $$\n  where $N$ is the number of uniform cells and $h = 1/N$.\n\n- Implement a complete, runnable program that:\n  - Uses a piecewise constant Discontinuous Galerkin (DG) spatial discretization with an upwind numerical flux and a first-order Implicit-Explicit (IMEX) Euler time step as derived.\n  - Initializes with $u_0(x) = \\sin(2\\pi x)$ on $[0,1]$ with periodic boundary conditions.\n  - Advances to time $T$ using a time step $\\Delta t$ chosen according to a Courant–Friedrichs–Lewy (CFL) number for advection, i.e., $\\Delta t = \\mathrm{CFL}\\,\\frac{h}{|c|}$ when $|c|>0$, and a fixed number of steps when $c=0$.\n  - Computes the discrete $L^2$ error defined above using accurate per-cell quadrature for exact cell averages.\n\n- Provide results for the following test suite to demonstrate uniform accuracy with respect to the stiffness parameter $\\epsilon$:\n  - Case $1$ (happy path): $N=100$, $c=1.0$, $\\alpha=0.5$, $\\epsilon=1.0$, $T=0.5$, $\\mathrm{CFL}=0.4$.\n  - Case $2$ (stiff): $N=100$, $c=1.0$, $\\alpha=0.5$, $\\epsilon=10^{-3}$, $T=0.5$, $\\mathrm{CFL}=0.4$.\n  - Case $3$ (very stiff): $N=100$, $c=1.0$, $\\alpha=0.5$, $\\epsilon=10^{-6}$, $T=0.5$, $\\mathrm{CFL}=0.4$.\n  - Case $4$ (boundary, no advection): $N=100$, $c=0.0$, $\\alpha=0.5$, $\\epsilon=10^{-3}$, $T=0.5$, choose $\\Delta t$ as $T$ divided by a fixed integer number of steps.\n\n- Your program should produce a single line of output containing the $L^2$ errors for Cases $1$–$4$ as a comma-separated list enclosed in square brackets, in that order, e.g., $[e_1,e_2,e_3,e_4]$, where each $e_k$ is a floating-point number.\n\nNo physical units are used in this dimensionless setup. Angles, where they appear in trigonometric functions, are in radians by convention. The final numerical outputs must be real numbers.", "solution": "The problem requires the derivation, analysis, and implementation of a first-order Implicit-Explicit (IMEX) Discontinuous Galerkin (DG) method for a scalar linear relaxation equation. The process is broken down into four main theoretical parts followed by a numerical implementation.\n\n### Part 1: Semi-Discrete Discontinuous Galerkin (DG) Scheme\n\nThe governing partial differential equation (PDE) is a scalar relaxation equation on a periodic domain $[0,1]$:\n$$\nu_t + f(u)_x \\;=\\; \\frac{1}{\\epsilon}\\,\\bigl(g(u) - u\\bigr)\n$$\nGiven the linear flux $f(u) = c\\,u$ and linear relaxation $g(u) = \\alpha\\,u$, the equation becomes:\n$$\nu_t + (c\\,u)_x = \\frac{\\alpha - 1}{\\epsilon} u = -\\lambda u, \\quad \\text{where } \\lambda = \\frac{1-\\alpha}{\\epsilon} > 0.\n$$\nWe discretize the spatial domain $[0,1]$ into $N$ uniform cells $I_i = [x_{i-1/2}, x_{i+1/2}]$ for $i=0, \\dots, N-1$. Each cell has width $h = 1/N$. The cell interfaces are at $x_{i+1/2} = (i+1)h$. For a piecewise constant ($p=0$) DG approximation, the solution $u_h(x,t)$ is represented as a constant value $u_i(t)$ within each cell $I_i$.\n$$\nu_h(x,t) = \\sum_{i=0}^{N-1} u_i(t) \\phi_i(x),\n$$\nwhere $\\phi_i(x)$ is the characteristic function of cell $I_i$.\n\nThe weak formulation is obtained by multiplying the PDE by a test function $v_h(x)$ from the same approximation space (i.e., piecewise constants) and integrating over a cell $I_i$. For cell $i$, we choose the test function to be $\\phi_i(x)$.\n$$\n\\int_{I_i} (u_h)_t \\phi_i(x) \\,dx + \\int_{I_i} (c u_h)_x \\phi_i(x) \\,dx = \\int_{I_i} (-\\lambda u_h) \\phi_i(x) \\,dx\n$$\nWe evaluate each term:\n1.  **Time derivative term**: Since $u_h(x,t) = u_i(t)$ and $\\phi_i(x)=1$ on $I_i$, this becomes:\n    $$\n    \\int_{I_i} \\frac{d u_i}{dt} \\cdot 1 \\,dx = h \\frac{d u_i}{dt}\n    $$\n2.  **Advection term**: We integrate by parts:\n    $$\n    \\int_{I_i} (c u_h)_x \\,dx = [c u_h(x,t)]_{x_{i-1/2}}^{x_{i+1/2}} = c u_h(x_{i+1/2}^-, t) - c u_h(x_{i-1/2}^+, t)\n    $$\n    The discontinuous nature of $u_h$ requires replacing the pointwise values at interfaces with a numerical flux, denoted $\\hat{f}(u_L, u_R)$. The term becomes:\n    $$\n    \\hat{f}(u_i, u_{i+1}) - \\hat{f}(u_{i-1}, u_i)\n    $$\n    where the indices are handled periodically. For linear advection $f(u) = cu$, the upwind flux is:\n    $$\n    \\hat{f}(u_L, u_R) = \\begin{cases} c u_L & \\text{if } c \\geq 0 \\\\ c u_R & \\text{if } c < 0 \\end{cases}\n    $$\n    - If $c \\geq 0$: The flux difference is $c u_i - c u_{i-1} = c(u_i - u_{i-1})$.\n    - If $c < 0$: The flux difference is $c u_{i+1} - c u_i = c(u_{i+1} - u_i)$.\n\n3.  **Relaxation term**:\n    $$\n    \\int_{I_i} (-\\lambda u_h) \\,dx = \\int_{I_i} (-\\lambda u_i) \\,dx = -h \\lambda u_i\n    $$\n\nCombining these terms and dividing by the cell width $h$, we get the semi-discrete ordinary differential equation (ODE) for each cell average $u_i$:\n$$\n\\frac{d u_i}{dt} + \\frac{1}{h} \\left( \\hat{f}_{i+1/2} - \\hat{f}_{i-1/2} \\right) = -\\lambda u_i,\n$$\nwhere $\\hat{f}_{i+1/2} = \\hat{f}(u_i, u_{i+1})$. Explicitly:\n- For $c \\geq 0$:\n$$\n\\frac{d u_i}{dt} + \\frac{c}{h}(u_i - u_{i-1}) = -\\lambda u_i\n$$\n- For $c < 0$:\n$$\n\\frac{d u_i}{dt} + \\frac{c}{h}(u_{i+1} - u_i) = -\\lambda u_i\n$$\n\n### Part 2: First-Order Implicit-Explicit (IMEX) Euler Scheme\n\nThe semi-discrete system is an ODE system of the form $\\frac{d\\mathbf{u}}{dt} = \\mathcal{L}(\\mathbf{u}) + \\mathcal{S}(\\mathbf{u})$, where $\\mathcal{L}$ represents the DG spatial operator for advection and $\\mathcal{S}$ is the relaxation operator.\n$$\n\\mathcal{L}_i(\\mathbf{u}) = -\\frac{1}{h} (\\hat{f}_{i+1/2} - \\hat{f}_{i-1/2}), \\quad \\mathcal{S}_i(\\mathbf{u}) = -\\lambda u_i\n$$\nWe construct a first-order IMEX scheme by treating the advection term $\\mathcal{L}$ explicitly (Forward Euler) and the stiff relaxation term $\\mathcal{S}$ implicitly (Backward Euler). For a time step $\\Delta t = t^{n+1} - t^n$:\n$$\n\\frac{u_i^{n+1} - u_i^n}{\\Delta t} = \\mathcal{L}_i(\\mathbf{u}^n) + \\mathcal{S}_i(\\mathbf{u}^{n+1})\n$$\nSubstituting the operators:\n$$\n\\frac{u_i^{n+1} - u_i^n}{\\Delta t} = -\\frac{1}{h} (\\hat{f}_{i+1/2}^n - \\hat{f}_{i-1/2}^n) - \\lambda u_i^{n+1}\n$$\nwhere $\\hat{f}^n$ are computed from the solution $\\mathbf{u}^n$ at time $t^n$. We can solve for $u_i^{n+1}$:\n$$\nu_i^{n+1} + \\Delta t \\lambda u_i^{n+1} = u_i^n - \\frac{\\Delta t}{h} (\\hat{f}_{i+1/2}^n - \\hat{f}_{i-1/2}^n)\n$$\n$$\nu_i^{n+1} (1 + \\Delta t \\lambda) = u_i^n - \\frac{\\Delta t}{h} (\\hat{f}_{i+1/2}^n - \\hat{f}_{i-1/2}^n)\n$$\nThis yields the final update formula:\n$$\nu_i^{n+1} = \\frac{1}{1 + \\Delta t \\lambda} \\left[ u_i^n - \\frac{\\Delta t}{h} (\\hat{f}_{i+1/2}^n - \\hat{f}_{i-1/2}^n) \\right]\n$$\nwhere $\\lambda = (1-\\alpha)/\\epsilon$.\n\n### Part 3: Asymptotic-Preserving (AP) Property and Limiting Scheme\n\nAn IMEX scheme is Asymptotic-Preserving (AP) if:\n1.  It is stable for a time-step $\\Delta t$ selected based on the explicit part, independent of the stiff parameter $\\epsilon$.\n2.  As $\\epsilon \\to 0$, the numerical scheme becomes a consistent and stable discretization of the limiting PDE.\n\n**Stability**: The explicit part of the scheme is a standard upwind method for advection, which is stable under the Courant-Friedrichs-Lewy (CFL) condition $|c| \\frac{\\Delta t}{h} \\le 1$. The implicit part involves the operator $(I + \\Delta t \\lambda)^{-1}$, which has a norm of $(1+\\Delta t \\lambda)^{-1}$. Since $\\Delta t > 0$ and $\\lambda > 0$, this is a damping factor with magnitude less than $1$. The overall stability is thus determined by the CFL condition of the explicit advection part, so $\\Delta t = \\mathcal{O}(h)$ is independent of $\\epsilon$. This fulfills the first AP requirement.\n\n**Limiting Scheme**: We examine the behavior of the scheme as $\\epsilon \\to 0$.\nThe original PDE is $u_t + c u_x = -\\lambda u$. As $\\epsilon \\to 0$, the relaxation rate $\\lambda = (1-\\alpha)/\\epsilon \\to \\infty$ (since $\\alpha \\in (0,1)$). The exact solution is $u(x,t) = e^{-\\lambda t} u_0(x-ct)$. For any $t > 0$, $u(x,t) \\to 0$. Thus, the limiting PDE is simply $u(x,t) = 0$ for $t > 0$.\n\nNow consider the numerical scheme in the limit $\\epsilon \\to 0$:\n$$\nu_i^{n+1} = \\frac{1}{1 + \\Delta t \\frac{1-\\alpha}{\\epsilon}} \\left[ u_i^n - \\frac{\\Delta t}{h} (\\hat{f}_{i+1/2}^n - \\hat{f}_{i-1/2}^n) \\right]\n$$\nAs $\\epsilon \\to 0$, the denominator $1 + \\Delta t \\frac{1-\\alpha}{\\epsilon} \\to \\infty$. The term in the square brackets remains bounded (as it corresponds to one step of an explicit advection scheme under a stable CFL). Therefore, the pre-factor $\\frac{1}{1 + \\Delta t \\lambda} \\to 0$.\nThis gives the limit of the numerical update:\n$$\n\\lim_{\\epsilon \\to 0} u_i^{n+1} = 0\n$$\nThe limiting scheme is $u_i^{n+1} = 0$, which is a consistent (and trivially stable) discretization of the limiting PDE $u=0$. The IMEX scheme is therefore Asymptotic-Preserving.\n\n### Part 4: Discrete $L^2$ Error Computation\n\nThe problem requires computing the discrete $L^2$ error between the numerical solution and the exact solution at a final time $T$.\n- **Numerical Solution**: The cell averages $u_i^{\\text{num}}(T)$ are obtained by evolving the initial condition averages using the derived IMEX scheme until time $T$.\n- **Exact Solution**: For the linear PDE $u_t+cu_x=-\\lambda u$, the solution is $u(x,T) = e^{-\\lambda T} u_0(x-cT)$. With $u_0(x) = \\sin(2\\pi x)$, this is:\n  $$\n  u(x,T) = e^{-\\lambda T} \\sin(2\\pi(x-cT))\n  $$\n- **Exact Cell Averages**: For comparison with the numerical cell averages, we must compute the exact cell averages at time $T$:\n  $$\n  u_i^{\\text{exact}}(T) = \\frac{1}{h} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,T) dx = \\frac{1}{h} \\int_{ih}^{(i+1)h} e^{-\\lambda T} \\sin(2\\pi(x-cT)) dx\n  $$\n  This integral can be computed accurately using numerical quadrature for each cell.\n- **Initial Condition**: The initial cell averages $u_i(0)$ are similarly computed by averaging $u_0(x)$ over each cell:\n  $$\n  u_i(0) = \\frac{1}{h} \\int_{ih}^{(i+1)h} \\sin(2\\pi x) dx\n  $$\n- **Error Norm**: The discrete $L^2$ error is then calculated as:\n  $$\n  \\|e\\|_{L^2_h} = \\biggl(\\sum_{i=0}^{N-1} h\\,\\bigl(u_i^{\\text{num}}(T) - u_i^{\\text{exact}}(T)\\bigr)^2\\biggr)^{1/2}\n  $$\n\nThe implementation will follow these derivations to compute the numerical solution and the corresponding error for the specified test cases.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef run_simulation(N, c, alpha, epsilon, T, CFL, num_steps_c0=125):\n    \"\"\"\n    Runs a single simulation of the DG-IMEX scheme.\n\n    Args:\n        N (int): Number of cells.\n        c (float): Advection speed.\n        alpha (float): Relaxation parameter.\n        epsilon (float): Stiffness parameter.\n        T (float): Final time.\n        CFL (float): CFL number for time step selection.\n        num_steps_c0 (int): Number of time steps for the c=0 case.\n\n    Returns:\n        float: The discrete L2 error at the final time T.\n    \"\"\"\n    h = 1.0 / N\n    lambda_val = (1.0 - alpha) / epsilon\n\n    # 1. Initialize cell averages u_i(0)\n    # u_i(0) = (1/h) * integral_{I_i} sin(2*pi*x) dx\n    u0_func = lambda x: np.sin(2.0 * np.pi * x)\n    u = np.zeros(N)\n    for i in range(N):\n        x_left, x_right = i * h, (i + 1) * h\n        # quad returns a tuple (integral, error_estimate)\n        integral_val, _ = quad(u0_func, x_left, x_right)\n        u[i] = integral_val / h\n\n    # 2. Set up time stepping\n    if abs(c) > 1e-15:\n        dt = CFL * h / abs(c)\n        num_steps = int(np.ceil(T / dt))\n        # Adjust dt to hit T exactly\n        dt = T / num_steps\n    else:\n        num_steps = num_steps_c0\n        dt = T / num_steps\n\n    # 3. Time integration loop\n    for _ in range(num_steps):\n        # Explicit step for advection (L(u^n))\n        # Note: np.roll(u, 1) shifts to right, u_i -> u_{i-1}\n        #       np.roll(u, -1) shifts to left, u_i -> u_{i+1}\n        if c >= 0:\n            # Upwind flux yields L_i = -(c/h) * (u_i - u_{i-1})\n            explicit_part = -(c / h) * (u - np.roll(u, 1))\n        else: # c < 0\n            # Upwind flux yields L_i = -(c/h) * (u_{i+1} - u_i)\n            explicit_part = -(c / h) * (np.roll(u, -1) - u)\n\n        # Forward Euler for explicit part\n        u_star = u + dt * explicit_part\n        \n        # Backward Euler for implicit part\n        u = u_star / (1.0 + dt * lambda_val)\n\n    u_num = u\n\n    # 4. Compute exact cell averages at time T\n    # u_exact(x,T) = exp(-lambda*T) * sin(2*pi*(x-c*T))\n    exact_sol_func = lambda x: np.exp(-lambda_val * T) * np.sin(2.0 * np.pi * (x - c * T))\n    u_exact = np.zeros(N)\n    for i in range(N):\n        x_left, x_right = i * h, (i + 1) * h\n        integral_val, _ = quad(exact_sol_func, x_left, x_right)\n        u_exact[i] = integral_val / h\n\n    # 5. Compute discrete L2 error\n    error = np.sqrt(h * np.sum((u_num - u_exact)**2))\n    \n    return error\n\ndef solve():\n    \"\"\"\n    Defines test cases, runs simulations, and prints the results.\n    \"\"\"\n    test_cases = [\n        # Case 1 (happy path)\n        {'N': 100, 'c': 1.0, 'alpha': 0.5, 'epsilon': 1.0, 'T': 0.5, 'CFL': 0.4},\n        # Case 2 (stiff)\n        {'N': 100, 'c': 1.0, 'alpha': 0.5, 'epsilon': 1e-3, 'T': 0.5, 'CFL': 0.4},\n        # Case 3 (very stiff)\n        {'N': 100, 'c': 1.0, 'alpha': 0.5, 'epsilon': 1e-6, 'T': 0.5, 'CFL': 0.4},\n        # Case 4 (boundary, no advection)\n        {'N': 100, 'c': 0.0, 'alpha': 0.5, 'epsilon': 1e-3, 'T': 0.5, 'CFL': 0.4}\n    ]\n\n    results = []\n    \n    # Determine num_steps for c=0 case based on a representative c=1 case\n    c1_h = 1.0 / test_cases[0]['N']\n    c1_dt = test_cases[0]['CFL'] * c1_h / abs(test_cases[0]['c'])\n    num_steps_for_c0 = int(np.ceil(test_cases[0]['T'] / c1_dt))\n\n    for case in test_cases:\n        error = run_simulation(\n            case['N'],\n            case['c'],\n            case['alpha'],\n            case['epsilon'],\n            case['T'],\n            case['CFL'],\n            num_steps_c0=num_steps_for_c0\n        )\n        results.append(error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n\n```", "id": "3385703"}]}