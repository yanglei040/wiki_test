{"hands_on_practices": [{"introduction": "Nitsche's method is a popular technique for weakly imposing Dirichlet boundary conditions in finite element analysis, but its stability is not automatic. This foundational exercise guides you through implementing the method for a simple 1D Poisson problem, demonstrating firsthand how the system's stability critically depends on the choice of a penalty parameter $\\gamma$. By examining the eigenvalues of the resulting stiffness matrix, you will gain a concrete understanding of why this parameter must be sufficiently large to ensure a well-posed numerical scheme [@problem_id:3134550].", "problem": "Consider the one-dimensional Poisson Partial Differential Equation (PDE) $-u''(x) = f(x)$ on the interval $\\Omega = (0,1)$ with Dirichlet boundary conditions $u(0) = 0$ and $u(1) = 0$. To fit weak imposition of Dirichlet boundary conditions into the Galerkin framework, use Nitsche’s method in the following symmetric form. Let the trial and test spaces be $V = H^1(\\Omega)$, where $H^1$ denotes the Sobolev space of functions with square-integrable derivatives. The symmetric Nitsche bilinear form $a(u,v)$ and linear form $\\ell(v)$ are given by\n$$\na(u,v) = \\int_0^1 u'(x)\\,v'(x)\\,dx \\;-\\; \\big(n(0)u'(0)\\,v(0) + n(1)u'(1)\\,v(1)\\big) \\;-\\; \\big(n(0)v'(0)\\,u(0) + n(1)v'(1)\\,u(1)\\big) \\;+\\; \\frac{\\gamma}{h}\\big(u(0)\\,v(0) + u(1)\\,v(1)\\big),\n$$\n$$\n\\ell(v) = \\int_0^1 f(x)\\,v(x)\\,dx \\;-\\; \\big(n(0)g(0)\\,v(0) + n(1)g(1)\\,v(1)\\big) \\;+\\; \\frac{\\gamma}{h}\\big(g(0)\\,v(0) + g(1)\\,v(1)\\big),\n$$\nwhere $n(0) = -1$ and $n(1) = +1$ are the outward unit normals at $x=0$ and $x=1$ respectively, $g$ is the prescribed Dirichlet data, $\\gamma$ is the penalty parameter, and $h$ is the mesh size. In this problem, set $g(x) = 0$ so that the boundary data is homogeneous. The aim is to investigate the stability effects of the penalty parameter $\\gamma$ when enforcing the Dirichlet condition weakly.\n\nDiscretize using the Finite Element Method (FEM) with continuous, piecewise linear basis functions on a uniform mesh with $N$ elements, so the mesh size is $h = 1/N$. Assemble the global stiffness matrix and load vector consistent with the symmetric Nitsche bilinear form above. Use the forcing $f(x) = \\pi^2 \\sin(\\pi x)$ so that the exact solution is $u(x) = \\sin(\\pi x)$, which respects the boundary conditions $u(0)=0$ and $u(1)=0$. Although $u(x)$ is known, your program should focus on stability assessment through the spectrum of the discrete operator.\n\nYour task is to:\n- Assemble the discrete stiffness matrix implementing the symmetric Nitsche method for the one-dimensional setting described above.\n- For each test case, compute the smallest eigenvalue of the assembled stiffness matrix. Classify stability by a boolean that is $\\text{True}$ if the smallest eigenvalue is greater than a small tolerance (e.g., larger than $10^{-12}$), and $\\text{False}$ otherwise.\n\nDesign the computation so that the choice of the penalty parameter $\\gamma$ critically affects stability, and demonstrate this by evaluating the following test suite of $(N,\\gamma)$ values:\n- Test case $1$: $N = 10$, $\\gamma = 2.0$.\n- Test case $2$: $N = 10$, $\\gamma = 0.5$.\n- Test case $3$: $N = 2$, $\\gamma = 1.0$.\n- Test case $4$: $N = 50$, $\\gamma = 1.2$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output first the smallest eigenvalue of the stiffness matrix (as a float), and second the stability classification (as a boolean). Aggregate all test cases in order, so the final output has the format\n$[ \\lambda_{\\min}^{(1)}, \\text{SPD}^{(1)}, \\lambda_{\\min}^{(2)}, \\text{SPD}^{(2)}, \\lambda_{\\min}^{(3)}, \\text{SPD}^{(3)}, \\lambda_{\\min}^{(4)}, \\text{SPD}^{(4)} ]$,\nwhere $\\lambda_{\\min}^{(k)}$ denotes the smallest eigenvalue for test case $k$, and $\\text{SPD}^{(k)}$ is the corresponding boolean indicating whether the matrix is symmetric positive definite (SPD) according to the tolerance.", "solution": "The user wants to analyze the stability of the symmetric Nitsche method for a one-dimensional Poisson problem by examining the eigenvalues of the resulting stiffness matrix.\n\n### Step 1: Problem Validation\n\nThe provided problem is a well-defined task in the field of computational science and engineering, specifically concerning the Finite Element Method (FEM).\n\n-   **Givens**:\n    -   PDE: $-u''(x) = f(x)$ on $\\Omega = (0,1)$.\n    -   Boundary Conditions (BCs): $u(0)=0, u(1)=0$. Imposed weakly using Nitsche's method.\n    -   Bilinear Form: $a(u,v) = \\int_0^1 u'(x)\\,v'(x)\\,dx - \\big(n(0)u'(0)\\,v(0) + n(1)u'(1)\\,v(1)\\big) - \\big(n(0)v'(0)\\,u(0) + n(1)v'(1)\\,u(1)\\big) + \\frac{\\gamma}{h}\\big(u(0)\\,v(0) + u(1)\\,v(1)\\big)$.\n    -   Auxiliary Definitions: Outward normal $n(0) = -1$, $n(1) = +1$. Boundary data $g(x)=0$. $\\gamma$ is a penalty parameter.\n    -   Discretization: Continuous, piecewise linear basis functions on a uniform mesh of $N$ elements, with mesh size $h=1/N$.\n    -   Task: For given pairs of $(N, \\gamma)$, assemble the stiffness matrix $A$ corresponding to $a(u,v)$, find its smallest eigenvalue $\\lambda_{\\min}$, and determine if $\\lambda_{\\min} > 10^{-12}$.\n    -   Test Cases: $(N, \\gamma) = \\{(10, 2.0), (10, 0.5), (2, 1.0), (50, 1.2)\\}$.\n\n-   **Validation Verdict**:\n    -   The problem is scientifically grounded, using the established Nitsche's method for a standard benchmark PDE.\n    -   It is well-posed, providing all necessary definitions, equations, and parameters to construct the discrete system.\n    -   The language is objective and precise.\n    -   The problem is complete, consistent, and feasible to solve computationally.\n\nThe problem is **valid**.\n\n### Step 2: Solution Derivation\n\nThe core of the task is to derive the entries of the global stiffness matrix $A$, defined by $A_{ij} = a(\\phi_j, \\phi_i)$, where $\\{\\phi_i\\}_{i=0}^N$ are the continuous, piecewise linear (\"hat\") basis functions. The domain $\\Omega=(0,1)$ is discretized into $N$ elements by nodes $x_i = i \\cdot h$ for $i=0, \\dots, N$, where $h=1/N$.\n\nThe basis function $\\phi_i(x)$ is defined such that $\\phi_i(x_j) = \\delta_{ij}$. On an interval $[x_{k}, x_{k+1}]$, its derivative $\\phi_i'(x)$ is constant. Of particular importance are the values of the basis functions and their one-sided derivatives at the boundary points $x=0$ and $x=1$.\n-   At $x=0$: $\\phi_i(0)=\\delta_{i0}$. The only non-zero derivatives are $\\phi_0'(0^+) = -1/h$ and $\\phi_1'(0^+) = 1/h$.\n-   At $x=1$: $\\phi_i(1)=\\delta_{iN}$. The only non-zero derivatives are $\\phi_{N-1}'(1^-) = -1/h$ and $\\phi_{N}'(1^-) = 1/h$.\n\nThe bilinear form $a(u,v)$ can be split into the standard interior stiffness part and the boundary contribution from the Nitsche terms:\n$a(u,v) = \\int_0^1 u'v'\\,dx + B(u,v)$, where\n$B(u,v) = -\\sum_{x \\in \\{0,1\\}} \\left( n(x)u'(x)v(x) + n(x)v'(x)u(x) - \\frac{\\gamma}{h} u(x)v(x) \\right)$.\nSubstituting $n(0)=-1$ and $n(1)=1$:\n$B(u,v) = \\left( u'(0)v(0) + v'(0)u(0) + \\frac{\\gamma}{h}u(0)v(0) \\right) - \\left( u'(1)v(1) + v'(1)u(1) - \\frac{\\gamma}{h}u(1)v(1) \\right)$.\nLet's re-check the problem statement: $a(u,v) = \\int u'v' - (n(0)u'(0)v(0) + \\dots)$.\n$a(u,v) = \\int_0^1 u'v'dx + u'(0)v(0) - u'(1)v(1) + v'(0)u(0) - v'(1)u(1) + \\frac{\\gamma}{h}(u(0)v(0) + u(1)v(1))$. Let's use this form.\n\nThe stiffness matrix $A$ is the sum of the standard stiffness matrix $A_{std}$ from the $\\int u'v'dx$ term and a modification matrix $\\Delta A$ from the Nitsche boundary terms.\n\n1.  **Standard Stiffness Matrix ($A_{std}$)**: Assembling the element stiffness matrices $K^e = \\frac{1}{h}\\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix}$ results in the $(N+1) \\times (N+1)$ matrix:\n    $$\n    A_{std} = \\frac{1}{h} \\begin{pmatrix}\n    1 & -1 & & & \\\\\n    -1 & 2 & -1 & & \\\\\n    & \\ddots & \\ddots & \\ddots & \\\\\n    & & -1 & 2 & -1 \\\\\n    & & & -1 & 1\n    \\end{pmatrix}\n    $$\n\n2.  **Nitsche Modification Matrix ($\\Delta A$)**: The entries are given by $\\Delta A_{ij} = B(\\phi_j, \\phi_i)$. These are non-zero only for basis functions $\\phi_i, \\phi_j$ that have non-zero values or derivatives at the boundaries, i.e., $i,j \\in \\{0, 1, N-1, N\\}$.\n\n    -   **At $x=0$**: Terms involve $i,j \\in \\{0,1\\}$.\n        -   $\\Delta A_{00} = 2\\phi'_0(0)\\phi_0(0) + \\frac{\\gamma}{h}\\phi_0(0)^2 = 2(-1/h)(1) + \\frac{\\gamma}{h}(1)^2 = \\frac{\\gamma-2}{h}$.\n        -   $\\Delta A_{01} = \\phi'_1(0)\\phi_0(0) + \\phi'_0(0)\\phi_1(0) = (1/h)(1) + (-1/h)(0) = \\frac{1}{h}$. By symmetry, $\\Delta A_{10} = \\frac{1}{h}$.\n        -   $\\Delta A_{11} = 0$, as $\\phi_1(0)=0$.\n\n    -   **At $x=1$**: Terms involve $i,j \\in \\{N-1,N\\}$.\n        -   $\\Delta A_{NN} = -2\\phi'_N(1)\\phi_N(1) + \\frac{\\gamma}{h}\\phi_N(1)^2 = -2(1/h)(1) + \\frac{\\gamma}{h}(1)^2 = \\frac{\\gamma-2}{h}$.\n        -   $\\Delta A_{N,N-1} = -\\phi'_{N-1}(1)\\phi_N(1) - \\phi'_N(1)\\phi_{N-1}(1) = -(-1/h)(1) - (1/h)(0) = \\frac{1}{h}$. By symmetry, $\\Delta A_{N-1,N} = \\frac{1}{h}$.\n        -   $\\Delta A_{N-1,N-1} = 0$, as $\\phi_{N-1}(1)=0$.\n\n3.  **Final Stiffness Matrix ($A = A_{std} + \\Delta A$)**:\n    We add the modifications to $A_{std}$.\n    -   $A_{00} = A_{std,00} + \\Delta A_{00} = \\frac{1}{h} + \\frac{\\gamma-2}{h} = \\frac{\\gamma-1}{h}$.\n    -   $A_{01} = A_{std,01} + \\Delta A_{01} = -\\frac{1}{h} + \\frac{1}{h} = 0$.\n    -   $A_{N,N} = A_{std,NN} + \\Delta A_{NN} = \\frac{1}{h} + \\frac{\\gamma-2}{h} = \\frac{\\gamma-1}{h}$.\n    -   $A_{N,N-1} = A_{std,N,N-1} + \\Delta A_{N,N-1} = -\\frac{1}{h} + \\frac{1}{h} = 0$.\n\n    All other entries of $A_{std}$ remain unchanged. The resulting matrix is block-diagonal:\n    $$\n    A = \\frac{1}{h}\n    \\begin{pmatrix}\n    \\gamma-1 & 0 & 0 & \\cdots & 0 \\\\\n    0 & 2 & -1 & & \\\\\n    0 & -1 & 2 & \\ddots & \\\\\n    \\vdots & & \\ddots & \\ddots & 0 \\\\\n    0 & \\cdots & & 0 & \\gamma-1\n    \\end{pmatrix}\n    $$\n    The matrix consists of three independent blocks: two $1 \\times 1$ blocks $[(\\gamma-1)/h]$ for the boundary nodes $0$ and $N$, and one $(N-1) \\times (N-1)$ tridiagonal block for the interior nodes $1, \\dots, N-1$.\n\n4.  **Eigenvalue Analysis**:\n    The eigenvalues of $A$ are the union of the eigenvalues of its blocks.\n    -   The eigenvalues of the boundary blocks are trivially $\\lambda_{bnd} = (\\gamma-1)/h$.\n    -   The eigenvalues of the interior $(N-1) \\times (N-1)$ tridiagonal matrix $\\frac{1}{h}\\mathrm{tridiag}(-1, 2, -1)$ are known:\n        $\\lambda_{int, k} = \\frac{1}{h} \\left(2 - 2\\cos\\left(\\frac{k\\pi}{N}\\right)\\right) = \\frac{2}{h} \\left(1 - \\cos\\left(\\frac{k\\pi}{N}\\right)\\right)$ for $k=1, \\dots, N-1$.\n    All $\\lambda_{int, k}$ are strictly positive for $N \\ge 2$. The smallest is $\\lambda_{int, 1}$.\n    The smallest eigenvalue of the entire matrix $A$ is therefore:\n    $$\n    \\lambda_{\\min}(A) = \\min(\\lambda_{bnd}, \\lambda_{int, 1}) = \\min\\left(\\frac{\\gamma-1}{h}, \\frac{2}{h}\\left(1 - \\cos\\left(\\frac{\\pi}{N}\\right)\\right)\\right)\n    $$\n    The matrix $A$ is symmetric positive definite (SPD) if and only if $\\lambda_{\\min}(A) > 0$. Since the interior eigenvalues are always positive, the stability condition rests entirely on the boundary eigenvalue:\n    $\\frac{\\gamma-1}{h} > 0 \\implies \\gamma > 1$.\n    This analysis confirms that the stability of the method is critically dependent on the penalty parameter $\\gamma$ being sufficiently large. For this specific problem formulation, the critical value is $\\gamma=1$.\n\nThe program will assemble the matrix $A$ according to the derived block-diagonal structure, compute its eigenvalues numerically, find the minimum, and compare it against the tolerance to determine if the matrix is SPD.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of finding the smallest eigenvalue of the stiffness matrix\n    for the 1D Poisson equation with symmetric Nitsche boundary conditions.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (10, 2.0),\n        (10, 0.5),\n        (2, 1.0),\n        (50, 1.2),\n    ]\n\n    results = []\n    tolerance = 1e-12\n\n    for case in test_cases:\n        N, gamma = case\n        h = 1.0 / N\n        size = N + 1\n\n        # Assemble the stiffness matrix A based on the derived structure.\n        # The matrix is block-diagonal with two 1x1 blocks for the boundary\n        # nodes and one (N-1)x(N-1) block for the interior nodes.\n        A = np.zeros((size, size))\n\n        # 1. Fill the interior block: h^{-1} * tridiag(-1, 2, -1)\n        # This corresponds to the standard stiffness matrix for a problem\n        # with strongly enforced homogeneous Dirichlet BCs.\n        if N > 1: # The interior block exists only if N > 1\n            diag_val = 2.0 / h\n            off_diag_val = -1.0 / h\n            \n            # Main diagonal for interior nodes\n            for i in range(1, size - 1):\n                A[i, i] = diag_val\n            \n            # Off-diagonals for interior nodes\n            for i in range(1, size - 2):\n                A[i, i+1] = off_diag_val\n                A[i+1, i] = off_diag_val\n\n        # 2. Fill the boundary blocks: (gamma - 1)/h\n        # These are decoupled from the interior due to the Nitsche formulation.\n        boundary_val = (gamma - 1.0) / h\n        A[0, 0] = boundary_val\n        A[size - 1, size - 1] = boundary_val\n        \n        # Compute eigenvalues. Use eigvalsh as the matrix is symmetric.\n        eigenvalues = np.linalg.eigvalsh(A)\n\n        # Find the smallest eigenvalue.\n        min_eig = np.min(eigenvalues)\n\n        # Classify stability (Symmetric Positive Definite).\n        is_spd = min_eig > tolerance\n\n        results.append(str(min_eig))\n        results.append(str(is_spd) if is_spd else str(False))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3134550"}, {"introduction": "After seeing that a penalty parameter can enforce a boundary condition, a natural question arises: how does this \"weak\" enforcement relate to a \"strong\" (exact) one? This practice uses a simplified graph Laplacian model as a powerful analogy for the continuous operators in DG methods, allowing for a clear spectral analysis. By comparing the eigenvalues of the weakly and strongly constrained systems, you will discover how the penalty method approximates the strong condition and gain insight into the convergence of the spectrum as the penalty parameter $\\gamma$ increases [@problem_id:3428093].", "problem": "Consider a one-dimensional path graph with $N$ nodes labeled $0,1,\\dots,N-1$. Let $u\\in\\mathbb{R}^N$ denote nodal values. The graph Laplacian $L\\in\\mathbb{R}^{N\\times N}$ is defined by the well-known quadratic energy\n$$\n\\mathcal{E}(u)=\\sum_{(i,j)\\in E}(u_i-u_j)^2,\n$$\nwhere $E$ are the edges of the path graph, and the corresponding symmetric positive semidefinite matrix $L$ satisfies $u^\\top L u=\\mathcal{E}(u)$. For the path graph, $L$ has diagonal entries equal to the node degrees (one at the endpoints $0$ and $N-1$, two in the interior), and entries of $-1$ for adjacent nodes.\n\nIn spectral and Discontinuous Galerkin (DG) methods, weak imposition of boundary conditions can be modeled via a penalty on boundary degrees of freedom. Define the penalty-augmented energy\n$$\n\\mathcal{E}_\\gamma(u)=u^\\top L u + \\gamma\\sum_{i\\in\\partial\\Omega}(u_i-g_i)^2,\n$$\nwhere $\\partial\\Omega=\\{0,N-1\\}$ denotes the boundary nodes, $g\\in\\mathbb{R}^N$ prescribes boundary values, and $\\gamma\\ge 0$ is the penalty parameter. The case $g\\equiv 0$ corresponds to homogeneous target boundary values. Weak boundary conditions then lead to the symmetric positive semidefinite matrix\n$$\nA_\\gamma=L+\\gamma P,\n$$\nwhere $P\\in\\mathbb{R}^{N\\times N}$ is the diagonal projector with ones at indices $0$ and $N-1$ and zeros elsewhere.\n\nStrong clamping (strong Dirichlet enforcement) amounts to restricting $u$ to the subspace $\\{u\\in\\mathbb{R}^N\\mid u_0=u_{N-1}=0\\}$, i.e., removing boundary degrees of freedom. Denote by $A_D\\in\\mathbb{R}^{(N-2)\\times(N-2)}$ the interior block of $L$ obtained by eliminating rows and columns corresponding to the boundary nodes; for the path graph this is the tridiagonal matrix with $2$ on the diagonal and $-1$ on the immediate off-diagonals.\n\nStarting from the Rayleigh–Ritz variational characterization of eigenvalues and the above definitions, derive how the penalty modifies the spectrum compared to strong clamping. In particular, reason about the behavior of the smallest $(N-2)$ eigenvalues of $A_\\gamma$ as $\\gamma\\to\\infty$ and how they relate to the eigenvalues of $A_D$. Then, implement a program that computes a quantifiable measure of the spectral shift induced by weak boundary conditions relative to strong clamping, for a given $(N,\\gamma)$.\n\nYour program must:\n- Construct $L$ for the path graph on $N$ nodes.\n- Construct $A_D$ by removing boundary rows and columns from $L$ (equivalently, the $(N-2)\\times(N-2)$ tridiagonal matrix with $2$ on the diagonal and $-1$ on the immediate off-diagonals).\n- Construct $A_\\gamma=L+\\gamma P$ with $g\\equiv 0$.\n- Compute the eigenvalues of $A_D$ and $A_\\gamma$, sort them in nondecreasing order, and compare the first $K$ eigenvalues, where $K=\\min(N-2,k_{\\text{target}})$ for a prescribed target $k_{\\text{target}}$ per test case.\n- Report, for each test case, the maximum relative error over the first $K$ eigenvalues,\n$$\n\\max_{1\\le k\\le K}\\frac{\\left|\\lambda_k^{(\\text{weak})}-\\lambda_k^{(\\text{strong})}\\right|}{\\lambda_k^{(\\text{strong})}},\n$$\nwhere $\\lambda_k^{(\\text{weak})}$ denotes the $k$-th smallest eigenvalue of $A_\\gamma$ and $\\lambda_k^{(\\text{strong})}$ denotes the $k$-th smallest eigenvalue of $A_D$. This quantity is dimensionless and must be output as a floating-point number.\n\nTo ensure coverage, use the following test suite of $(N,\\gamma,k_{\\text{target}})$:\n- General case with large penalty: $(N,\\gamma,k_{\\text{target}})=(21,100.0,10)$.\n- Edge case with no penalty (free boundary): $(N,\\gamma,k_{\\text{target}})=(21,0.0,10)$.\n- Small system size: $(N,\\gamma,k_{\\text{target}})=(4,10.0,2)$.\n- Moderate penalty on a larger system: $(N,\\gamma,k_{\\text{target}})=(50,1.0,10)$.\n- Near-strong clamping in minimal interior dimension: $(N,\\gamma,k_{\\text{target}})=(3,10^6,1)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4,result5]\"). Each result must be the maximum relative error for the corresponding test case, expressed as a floating-point number. No external input should be read; all parameters are to be hard-coded as given above. No angles or physical units are involved in this problem.", "solution": "The present problem concerns the spectral analysis of the one-dimensional graph Laplacian under two different forms of homogeneous Dirichlet boundary conditions: strong enforcement and weak (penalty-based) enforcement. The objective is to derive the relationship between the spectra of the resulting operators and to numerically quantify their difference.\n\nThe analysis is grounded in the variational characterization of eigenvalues for symmetric matrices, as provided by the Courant-Fischer minimax theorem. For an $n \\times n$ symmetric matrix $M$, its $k$-th smallest eigenvalue $\\lambda_k(M)$ is given by the Rayleigh-Ritz principle:\n$$\n\\lambda_k(M) = \\min_{\\substack{S \\subset \\mathbb{R}^n \\\\ \\dim(S)=k}} \\max_{0 \\neq u \\in S} \\frac{u^\\top M u}{u^\\top u}\n$$\n\nLet us define the operators associated with each boundary condition type.\nThe strong clamping condition, $u_0=u_{N-1}=0$, effectively removes the boundary degrees of freedom from the system. The relevant vector space is the $(N-2)$-dimensional space of interior node values, $u_{\\text{int}} = (u_1, \\dots, u_{N-2})^\\top$. The system's energy is quadratic in these variables, defined by the matrix $A_D \\in \\mathbb{R}^{(N-2)\\times(N-2)}$, which is the submatrix of the graph Laplacian $L$ corresponding to the interior nodes. The eigenvalues of this system, which we denote $\\lambda_k^{(\\text{strong})}$, are the eigenvalues of $A_D$. For $k=1, \\dots, N-2$:\n$$\n\\lambda_k^{(\\text{strong})} = \\lambda_k(A_D) = \\min_{\\substack{S_{\\text{int}} \\subset \\mathbb{R}^{N-2} \\\\ \\dim(S_{\\text{int}})=k}} \\max_{0 \\neq u_{\\text{int}} \\in S_{\\text{int}}} \\frac{u_{\\text{int}}^\\top A_D u_{\\text{int}}}{u_{\\text{int}}^\\top u_{\\text{int}}}\n$$\nThe matrix $A_D$ is symmetric and positive definite, ensuring its eigenvalues are real and strictly positive.\n\nThe weak boundary condition is imposed via a penalty term in the energy functional, leading to the matrix $A_\\gamma = L + \\gamma P$, where $P$ is the diagonal projector onto the boundary nodes $\\{0, N-1\\}$. This operator acts on the full $N$-dimensional space $\\mathbb{R}^N$. Its eigenvalues, denoted $\\lambda_k^{(\\text{weak})}$, are given by:\n$$\n\\lambda_k^{(\\text{weak})} = \\lambda_k(A_\\gamma) = \\min_{\\substack{S \\subset \\mathbb{R}^N \\\\ \\dim(S)=k}} \\max_{0 \\neq u \\in S} \\frac{u^\\top A_\\gamma u}{u^\\top u} = \\min_{\\substack{S \\subset \\mathbb{R}^N \\\\ \\dim(S)=k}} \\max_{0 \\neq u \\in S} \\frac{u^\\top L u + \\gamma (u_0^2 + u_{N-1}^2)}{u^\\top u}\n$$\nfor $k=1, \\dots, N$.\n\nTo compare the spectra, we relate both variational problems to the full space $\\mathbb{R}^N$. The strong condition can be viewed as restricting the energy functional $u^\\top L u$ to the subspace $V_0 = \\{u \\in \\mathbb{R}^N \\mid u_0 = u_{N-1} = 0\\}$. The dimension of $V_0$ is $N-2$. The eigenvalues $\\lambda_k^{(\\text{strong})}$ are precisely the eigenvalues of the operator $L$ restricted to this subspace.\n\nWe can establish an inequality between the eigenvalues. Let $S_k^{\\text{(strong)}}$ be the $k$-dimensional subspace of $\\mathbb{R}^{N-2}$ spanned by the first $k$ eigenvectors of $A_D$. We can embed this into $\\mathbb{R}^N$ as a subspace $\\tilde{S}_k \\subset V_0$. For any vector $u \\in \\tilde{S}_k$, its boundary values are zero, so $u_0 = u_{N-1} = 0$. Consequently, the penalty term in the Rayleigh quotient for $A_\\gamma$ vanishes for any $u \\in \\tilde{S}_k$. The minimax principle for $\\lambda_k^{(\\text{weak})}$ allows us to use $\\tilde{S}_k$ as a test subspace:\n$$\n\\lambda_k^{(\\text{weak})} \\le \\max_{0 \\neq u \\in \\tilde{S}_k} \\frac{u^\\top L u + \\gamma (u_0^2 + u_{N-1}^2)}{u^\\top u} = \\max_{0 \\neq u \\in \\tilde{S}_k} \\frac{u^\\top L u}{u^\\top u} = \\lambda_k^{(\\text{strong})}\n$$\nThis inequality holds for $k=1, \\dots, N-2$. It demonstrates that the penalty method introduces a \"softer\" constraint than strong enforcement, resulting in smaller (or equal) eigenvalues for the corresponding modes.\n\nAs the penalty parameter $\\gamma$ approaches infinity, the term $\\gamma (u_0^2 + u_{N-1}^2)$ in the numerator of the Rayleigh quotient dominates. For an eigenvalue $\\lambda_k^{(\\text{weak})}$ to remain bounded as $\\gamma \\to \\infty$, its corresponding eigenvector $v_k$ must have boundary components that approach zero, i.e., $(v_k)_0 \\to 0$ and $(v_k)_{N-1} \\to 0$. This implies that the eigenvectors for the bounded modes must converge to vectors within the subspace $V_0$. This is the principle of penalty methods: the penalized problem's solution converges to the solution of the constrained problem.\n\nMore formally, perturbation theory for eigenvalues shows that for $k=1, \\dots, N-2$, the eigenvalues $\\lambda_k^{(\\text{weak})}$ of $A_\\gamma$ converge to the eigenvalues $\\lambda_k^{(\\text{strong})}$ of $A_D$ as $\\gamma \\to \\infty$. The convergence rate is typically $|\\lambda_k^{(\\text{weak})} - \\lambda_k^{(\\text{strong})}| = O(\\gamma^{-1})$. The remaining two eigenvalues of $A_\\gamma$, i.e., $\\lambda_{N-1}^{(\\text{weak})}$ and $\\lambda_N^{(\\text{weak})}$, diverge to infinity, corresponding to eigenmodes that are localized at the boundary nodes.\n\nThe algorithm to quantify this spectral shift is implemented as follows:\n1.  For a given $N$, construct the $N \\times N$ graph Laplacian matrix $L$ for the path graph. The diagonal entries are $L_{0,0}=L_{N-1,N-1}=1$ and $L_{i,i}=2$ for $i=1,\\dots,N-2$. The non-zero off-diagonal entries are $L_{i,i+1} = L_{i+1,i} = -1$.\n2.  Construct the $(N-2) \\times (N-2)$ strong-clamping matrix $A_D$. This corresponds to the interior block of $L$, or can be constructed directly as the tridiagonal matrix with $2$s on the diagonal and $-1$s on the super/sub-diagonals.\n3.  Construct the $N \\times N$ weak-clamping matrix $A_\\gamma = L + \\gamma P$, where $P$ is the diagonal matrix with $P_{0,0}=P_{N-1,N-1}=1$ and all other entries zero.\n4.  Compute the eigenvalues of the symmetric matrices $A_D$ and $A_\\gamma$. A stable numerical eigensolver, such as one based on the QR algorithm for symmetric matrices, is used. The eigenvalues are sorted in non-decreasing order. Let these be $\\{\\lambda_k^{(\\text{strong})}\\}_{k=1}^{N-2}$ and $\\{\\lambda_k^{(\\text{weak})}\\}_{k=1}^{N}$.\n5.  Determine the number of eigenvalues to compare, $K = \\min(N-2, k_{\\text{target}})$. A non-vacuous comparison requires $K \\ge 1$, which is true for all test cases.\n6.  The measure of spectral shift is the maximum relative error over the first $K$ eigenvalues:\n    $$\n    \\max_{1 \\le k \\le K} \\frac{\\left|\\lambda_k^{(\\text{weak})} - \\lambda_k^{(\\text{strong})}\\right|}{\\lambda_k^{(\\text{strong})}}\n    $$\n    Since $A_D$ is positive definite, $\\lambda_k^{(\\text{strong})} > 0$, making this measure well-defined.\nThis procedure is systematically applied to each test case specified in the problem statement.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the spectral shift induced by weak vs. strong boundary conditions\n    for the 1D graph Laplacian.\n    \"\"\"\n    # Test suite of (N, gamma, k_target) parameters.\n    test_cases = [\n        (21, 100.0, 10),\n        (21, 0.0, 10),\n        (4, 10.0, 2),\n        (50, 1.0, 10),\n        (3, 10**6, 1),\n    ]\n\n    results = []\n    for N, gamma, k_target in test_cases:\n        # Step 1: Construct the N x N graph Laplacian L for the path graph.\n        # It has degree-based diagonal and -1 on adjacencies.\n        # Diagonal is [1, 2, ..., 2, 1], off-diagonals are -1.\n        L = np.diag(2 * np.ones(N)) - np.diag(np.ones(N - 1), 1) - np.diag(np.ones(N - 1), -1)\n        L[0, 0] = 1\n        L[N - 1, N - 1] = 1\n\n        # Step 2: Construct the (N-2) x (N-2) strong-clamping matrix A_D.\n        # This is the interior block of L.\n        # A_D is only meaningful for N > 2.\n        dim_D = N - 2\n        A_D = None\n        if dim_D > 0:\n            # Direct construction of the tridiagonal matrix with 2 on diagonal, -1 on off-diagonals.\n            A_D = np.diag(2 * np.ones(dim_D))\n            if dim_D > 1:\n                A_D -= np.diag(np.ones(dim_D - 1), 1)\n                A_D -= np.diag(np.ones(dim_D - 1), -1)\n\n        # Step 3: Construct the N x N weak-clamping matrix A_gamma.\n        # A_gamma = L + gamma * P\n        P = np.zeros((N, N))\n        P[0, 0] = 1\n        P[N - 1, N - 1] = 1\n        A_gamma = L + gamma * P\n\n        # Step 4: Compute the eigenvalues.\n        # np.linalg.eigvalsh is used for symmetric matrices and returns sorted eigenvalues.\n        \n        # Eigenvalues for the weak (penalty) system\n        lambda_weak = np.linalg.eigvalsh(A_gamma)\n\n        # Eigenvalues for the strong (clamped) system\n        lambda_strong = np.array([])\n        if A_D is not None and dim_D > 0:\n            lambda_strong = np.linalg.eigvalsh(A_D)\n\n        # Step 5: Determine the number of eigenvalues to compare.\n        # K cannot exceed the number of eigenvalues available for the strong case.\n        if dim_D = 0:\n            # No interior nodes, so no eigenvalues to compare.\n            # This case does not occur in the provided test suite.\n            results.append(0.0)\n            continue\n            \n        K = min(dim_D, k_target)\n\n        # Select the first K eigenvalues for comparison.\n        # The first dim_D eigenvalues of A_gamma correspond to the dim_D eigenvalues of A_D.\n        lambda_weak_K = lambda_weak[:K]\n        lambda_strong_K = lambda_strong[:K]\n\n        # Step 6: Compute the maximum relative error.\n        # The eigenvalues of A_D are strictly positive, so no division by zero.\n        relative_errors = np.abs(lambda_weak_K - lambda_strong_K) / lambda_strong_K\n        max_relative_error = np.max(relative_errors)\n        \n        results.append(max_relative_error)\n\n    # Print the final results in the specified format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3428093"}, {"introduction": "Weak boundary conditions are not limited to penalty-based methods for elliptic equations. For hyperbolic problems like advection, the approach must respect the direction of information flow, leading to the concept of upwinding. This practical coding exercise challenges you to implement the core logic of an upwind numerical flux within a Discontinuous Galerkin (DG) framework, where the choice between exterior data and the interior solution at the boundary is determined locally by the sign of $\\boldsymbol{\\beta} \\cdot \\boldsymbol{n}$ [@problem_id:3428124].", "problem": "Consider the conservative linear advection equation in two spatial dimensions on a bounded Lipschitz domain $\\Omega \\subset \\mathbb{R}^2$,\n$$\n\\partial_t u + \\nabla \\cdot (\\boldsymbol{\\beta} u) = 0 \\quad \\text{in } \\Omega,\n$$\nwith outward unit normal $\\boldsymbol{n}$ on the boundary $\\partial \\Omega$, and a spatially varying advection field $\\boldsymbol{\\beta}(\\boldsymbol{x})$. In the Discontinuous Galerkin (DG) method, the weak formulation introduces boundary terms through integration by parts, and the boundary data is imposed weakly via a numerical flux that depends on the sign of $\\boldsymbol{\\beta} \\cdot \\boldsymbol{n}$ evaluated at boundary quadrature points. The correct boundary state selected at each quadrature point must reflect the characteristic direction induced by $\\boldsymbol{\\beta} \\cdot \\boldsymbol{n}$: at inflow points, the exterior trace should equal the prescribed boundary data, while at outflow points, the exterior trace should equal the interior trace.\n\nStarting from the standard DG weak form for the conservative advection equation and the definition of the outward normal, implement an elementwise procedure to:\n- evaluate $\\boldsymbol{\\beta}(\\boldsymbol{x}) \\cdot \\boldsymbol{n}$ at boundary quadrature points of each boundary face of each element, and\n- select the boundary state $u^{\\text{ext}}$ to be used in the boundary numerical flux, consistent with characteristic upwinding.\n\nUse the following scientifically consistent and self-contained configuration, which provides a concrete test suite:\n\n1. Domain and mesh:\n   - The domain is the square $\\Omega = [0,1]^2$.\n   - There are two rectangular elements:\n     - Element $E_1$ has corners $(0,0)$, $(0.5,0)$, $(0.5,1)$, $(0,1)$.\n     - Element $E_2$ has corners $(0.5,0)$, $(1,0)$, $(1,1)$, $(0.5,1)$.\n   - The outward unit normal $\\boldsymbol{n}$ is constant on each boundary edge:\n     - Left boundary ($x=0$): $\\boldsymbol{n} = (-1,0)$.\n     - Right boundary ($x=1$): $\\boldsymbol{n} = (1,0)$.\n     - Bottom boundary ($y=0$): $\\boldsymbol{n} = (0,-1)$.\n     - Top boundary ($y=1$): $\\boldsymbol{n} = (0,1)$.\n\n2. Velocity field and boundary data:\n   - The advection field is $\\boldsymbol{\\beta}(x,y) = \\big(1 + x^2, \\sin(\\pi y)\\big)$.\n   - Prescribed Dirichlet boundary data is $g(x,y) = \\cos(\\pi x) + y$.\n\n3. Elementwise interior traces:\n   - The polynomial trace (the interior value restricted to the boundary) of the DG solution is given per element by:\n     - On $E_1$: $u_h^{E_1}(x,y) = 1 + x + 2y$.\n     - On $E_2$: $u_h^{E_2}(x,y) = 2 - x + y$.\n\n4. Boundary quadrature:\n   - On each boundary edge of an element, use two-point Gauss–Legendre quadrature on the edge parameter $s \\in [0,1]$, obtained by mapping the reference nodes $\\xi_1 = -1/\\sqrt{3}$, $\\xi_2 = 1/\\sqrt{3}$ to $s_j = (\\xi_j + 1)/2$.\n   - For vertical edges at $x = \\text{const}$, the quadrature points are $(x, y(s_j))$ with $y(s) = y_{\\min} + s(y_{\\max} - y_{\\min})$.\n   - For horizontal edges at $y = \\text{const}$, the quadrature points are $(x(s_j), y)$ with $x(s) = x_{\\min} + s(x_{\\max} - x_{\\min})$.\n\n5. Upwind boundary state selection:\n   - At each boundary quadrature point of an element, compute $b_n = \\boldsymbol{\\beta}(\\boldsymbol{x}) \\cdot \\boldsymbol{n}$ and set\n     $$\n     u^{\\text{ext}}(\\boldsymbol{x}) =\n     \\begin{cases}\n       g(\\boldsymbol{x}),  \\text{if } b_n  0 \\text{ (inflow)}, \\\\\n       u_h^E(\\boldsymbol{x}),  \\text{if } b_n \\ge 0 \\text{ (outflow or neutral)}.\n     \\end{cases}\n     $$\n   - Here $u_h^E$ denotes the elementwise interior trace polynomial on the boundary of element $E$.\n\n6. Required output and ordering:\n   - Enumerate elements in the order $E_1$, $E_2$.\n   - For each element, enumerate boundary faces in the order: left, bottom, right, top; include only those faces that lie on the physical boundary $\\partial \\Omega$.\n   - Within each included face, list the two quadrature points in ascending order of $s$ (i.e., $s_1$ then $s_2$).\n   - For each enumerated quadrature point, compute $u^{\\text{ext}}$ by the upwind rule above and collect these values.\n\nYour program must produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[r1,r2,...,r12]\"), where each entry is the floating-point value of $u^{\\text{ext}}$ at a boundary quadrature point, ordered exactly as specified.\n\nTest suite coverage:\n- $E_1$ left edge ($x=0$) produces inflow ($\\boldsymbol{\\beta}\\cdot\\boldsymbol{n}  0$) and must select $g(x,y)$.\n- $E_2$ right edge ($x=1$) produces outflow ($\\boldsymbol{\\beta}\\cdot\\boldsymbol{n}  0$) and must select $u_h^{E_2}(x,y)$.\n- Bottom ($y=0$) and top ($y=1$) edges have $\\boldsymbol{\\beta}\\cdot\\boldsymbol{n} = 0$ and must select the interior trace by the rule $b_n \\ge 0 \\Rightarrow u^{\\text{ext}} = u_h^E$.\n\nNo physical units are involved, and no angles are used. All outputs are real numbers without units. The final output must strictly follow the specified single-line format.", "solution": "The problem is valid as it is scientifically grounded in the theory of Discontinuous Galerkin (DG) methods, is well-posed with a complete and consistent set of data and rules, and is expressed in objective, formal language. The task is to determine the exterior state function $u^{\\text{ext}}$ at specific boundary quadrature points for a given DG discretization of the linear advection equation. This involves applying the principle of upwinding, which is fundamental to a stable DG scheme. The exterior state is chosen based on the direction of information flow, indicated by the sign of $\\boldsymbol{\\beta} \\cdot \\boldsymbol{n}$, where $\\boldsymbol{\\beta}$ is the advection velocity and $\\boldsymbol{n}$ is the outward unit normal vector to the boundary.\n\nThe provided data for the computation are:\n-   Advection field: $\\boldsymbol{\\beta}(x,y) = \\left(1 + x^2, \\sin(\\pi y)\\right)$.\n-   Prescribed boundary data: $g(x,y) = \\cos(\\pi x) + y$.\n-   Interior solution trace on element $E_1$: $u_h^{E_1}(x,y) = 1 + x + 2y$.\n-   Interior solution trace on element $E_2$: $u_h^{E_2}(x,y) = 2 - x + y$.\n-   Upwind selection rule at a point $\\boldsymbol{x}$ on the boundary $\\partial\\Omega$:\n    $$\n    u^{\\text{ext}}(\\boldsymbol{x}) =\n    \\begin{cases}\n      g(\\boldsymbol{x}),  \\text{if } \\boldsymbol{\\beta}(\\boldsymbol{x}) \\cdot \\boldsymbol{n}  0 \\text{ (inflow)}, \\\\\n      u_h^E(\\boldsymbol{x}),  \\text{if } \\boldsymbol{\\beta}(\\boldsymbol{x}) \\cdot \\boldsymbol{n} \\ge 0 \\text{ (outflow or neutral)}.\n    \\end{cases}\n    $$\nThe quadrature points on each boundary face are determined by mapping the two-point Gauss-Legendre nodes $\\xi_1 = -1/\\sqrt{3}$ and $\\xi_2 = 1/\\sqrt{3}$ from the reference interval $[-1, 1]$ to the parameter space $s \\in [0, 1]$ using the transformation $s_j = (\\xi_j + 1)/2$. This yields two points per face, ordered by their parametric value $s$:\n$s_1 = (1 - 1/\\sqrt{3})/2 \\approx 0.211325$\n$s_2 = (1 + 1/\\sqrt{3})/2 \\approx 0.788675$\n\nThe calculation proceeds by iterating through the elements and their physical boundary faces in the specified order.\n\n**Element $E_1$: Domain $[0, 0.5] \\times [0, 1]$**\nThe boundary faces of $E_1$ on $\\partial\\Omega$ are its left, bottom, and top edges.\n\n1.  **Left face of $E_1$ ($x=0, y \\in [0,1]$):**\n    -   Outward normal: $\\boldsymbol{n} = (-1, 0)$.\n    -   Parametrization: $y(s) = s$ for $s \\in [0,1]$.\n    -   Quadrature points: $\\boldsymbol{x}_1 = (0, s_1)$ and $\\boldsymbol{x}_2 = (0, s_2)$.\n    -   At these points, $\\boldsymbol{\\beta}(\\boldsymbol{x}) = (1+0^2, \\sin(\\pi y)) = (1, \\sin(\\pi y))$.\n    -   The characteristic direction is $b_n = \\boldsymbol{\\beta} \\cdot \\boldsymbol{n} = (1, \\sin(\\pi y)) \\cdot (-1, 0) = -1$.\n    -   Since $b_n  0$, this is an inflow boundary. We select $u^{\\text{ext}} = g(\\boldsymbol{x})$.\n        -   At $\\boldsymbol{x}_1 = (0, s_1)$: $u^{\\text{ext}}_1 = g(0, s_1) = \\cos(0) + s_1 = 1 + s_1 = 1.5 - 1/(2\\sqrt{3}) \\approx 1.211325$.\n        -   At $\\boldsymbol{x}_2 = (0, s_2)$: $u^{\\text{ext}}_2 = g(0, s_2) = \\cos(0) + s_2 = 1 + s_2 = 1.5 + 1/(2\\sqrt{3}) \\approx 1.788675$.\n\n2.  **Bottom face of $E_1$ ($y=0, x \\in [0,0.5]$):**\n    -   Outward normal: $\\boldsymbol{n} = (0, -1)$.\n    -   Parametrization: $x(s) = 0.5s$ for $s \\in [0,1]$.\n    -   Quadrature points: $\\boldsymbol{x}_3 = (0.5s_1, 0)$ and $\\boldsymbol{x}_4 = (0.5s_2, 0)$.\n    -   At these points, $\\boldsymbol{\\beta}(\\boldsymbol{x}) = (1+x^2, \\sin(0)) = (1+x^2, 0)$.\n    -   The characteristic direction is $b_n = \\boldsymbol{\\beta} \\cdot \\boldsymbol{n} = (1+x^2, 0) \\cdot (0, -1) = 0$.\n    -   Since $b_n \\ge 0$, this is a neutral boundary. We select $u^{\\text{ext}} = u_h^{E_1}(\\boldsymbol{x})$.\n        -   At $\\boldsymbol{x}_3 = (0.5s_1, 0)$: $u^{\\text{ext}}_3 = u_h^{E_1}(\\boldsymbol{x}_3) = 1 + (0.5s_1) + 2(0) = 1 + 0.25(1-1/\\sqrt{3}) \\approx 1.105662$.\n        -   At $\\boldsymbol{x}_4 = (0.5s_2, 0)$: $u^{\\text{ext}}_4 = u_h^{E_1}(\\boldsymbol{x}_4) = 1 + (0.5s_2) + 2(0) = 1 + 0.25(1+1/\\sqrt{3}) \\approx 1.394338$.\n\n3.  **Top face of $E_1$ ($y=1, x \\in [0,0.5]$):**\n    -   Outward normal: $\\boldsymbol{n} = (0, 1)$.\n    -   Parametrization: $x(s) = 0.5s$ for $s \\in [0,1]$.\n    -   Quadrature points: $\\boldsymbol{x}_5 = (0.5s_1, 1)$ and $\\boldsymbol{x}_6 = (0.5s_2, 1)$.\n    -   At these points, $\\boldsymbol{\\beta}(\\boldsymbol{x}) = (1+x^2, \\sin(\\pi)) = (1+x^2, 0)$.\n    -   The characteristic direction is $b_n = \\boldsymbol{\\beta} \\cdot \\boldsymbol{n} = (1+x^2, 0) \\cdot (0, 1) = 0$.\n    -   Since $b_n \\ge 0$, this is a neutral boundary. We select $u^{\\text{ext}} = u_h^{E_1}(\\boldsymbol{x})$.\n        -   At $\\boldsymbol{x}_5 = (0.5s_1, 1)$: $u^{\\text{ext}}_5 = u_h^{E_1}(\\boldsymbol{x}_5) = 1 + (0.5s_1) + 2(1) = 3 + 0.25(1-1/\\sqrt{3}) \\approx 3.105662$.\n        -   At $\\boldsymbol{x}_6 = (0.5s_2, 1)$: $u^{\\text{ext}}_6 = u_h^{E_1}(\\boldsymbol{x}_6) = 1 + (0.5s_2) + 2(1) = 3 + 0.25(1+1/\\sqrt{3}) \\approx 3.394338$.\n\n**Element $E_2$: Domain $[0.5, 1] \\times [0, 1]$**\nThe boundary faces of $E_2$ on $\\partial\\Omega$ are its bottom, right, and top edges.\n\n1.  **Bottom face of $E_2$ ($y=0, x \\in [0.5,1]$):**\n    -   Outward normal: $\\boldsymbol{n} = (0, -1)$.\n    -   Parametrization: $x(s) = 0.5 + 0.5s$ for $s \\in [0,1]$.\n    -   Quadrature points: $\\boldsymbol{x}_7 = (0.5+0.5s_1, 0)$ and $\\boldsymbol{x}_8 = (0.5+0.5s_2, 0)$.\n    -   At these points, $\\boldsymbol{\\beta}(\\boldsymbol{x}) = (1+x^2, 0)$.\n    -   The characteristic direction is $b_n = \\boldsymbol{\\beta} \\cdot \\boldsymbol{n} = 0$.\n    -   Since $b_n \\ge 0$, we select $u^{\\text{ext}} = u_h^{E_2}(\\boldsymbol{x})$.\n        -   At $\\boldsymbol{x}_7 = (0.5+0.5s_1, 0)$: $u^{\\text{ext}}_7 = u_h^{E_2}(\\boldsymbol{x}_7) = 2 - (0.5+0.5s_1) + 0 = 1.5 - 0.25(1-1/\\sqrt{3}) \\approx 1.394338$.\n        -   At $\\boldsymbol{x}_8 = (0.5+0.5s_2, 0)$: $u^{\\text{ext}}_8 = u_h^{E_2}(\\boldsymbol{x}_8) = 2 - (0.5+0.5s_2) + 0 = 1.5 - 0.25(1+1/\\sqrt{3}) \\approx 1.105662$.\n\n2.  **Right face of $E_2$ ($x=1, y \\in [0,1]$):**\n    -   Outward normal: $\\boldsymbol{n} = (1, 0)$.\n    -   Parametrization: $y(s) = s$ for $s \\in [0,1]$.\n    -   Quadrature points: $\\boldsymbol{x}_9 = (1, s_1)$ and $\\boldsymbol{x}_{10} = (1, s_2)$.\n    -   At these points, $\\boldsymbol{\\beta}(\\boldsymbol{x}) = (1+1^2, \\sin(\\pi y)) = (2, \\sin(\\pi y))$.\n    -   The characteristic direction is $b_n = \\boldsymbol{\\beta} \\cdot \\boldsymbol{n} = (2, \\sin(\\pi y)) \\cdot (1, 0) = 2$.\n    -   Since $b_n  0$, this is an outflow boundary. We select $u^{\\text{ext}} = u_h^{E_2}(\\boldsymbol{x})$.\n        -   At $\\boldsymbol{x}_9 = (1, s_1)$: $u^{\\text{ext}}_9 = u_h^{E_2}(\\boldsymbol{x}_9) = 2 - 1 + s_1 = 1 + s_1 = 1.5 - 1/(2\\sqrt{3}) \\approx 1.211325$.\n        -   At $\\boldsymbol{x}_{10} = (1, s_2)$: $u^{\\text{ext}}_{10} = u_h^{E_2}(\\boldsymbol{x}_{10}) = 2 - 1 + s_2 = 1 + s_2 = 1.5 + 1/(2\\sqrt{3}) \\approx 1.788675$.\n\n3.  **Top face of $E_2$ ($y=1, x \\in [0.5,1]$):**\n    -   Outward normal: $\\boldsymbol{n} = (0, 1)$.\n    -   Parametrization: $x(s) = 0.5 + 0.5s$ for $s \\in [0,1]$.\n    -   Quadrature points: $\\boldsymbol{x}_{11} = (0.5+0.5s_1, 1)$ and $\\boldsymbol{x}_{12} = (0.5+0.5s_2, 1)$.\n    -   At these points, $\\boldsymbol{\\beta}(\\boldsymbol{x}) = (1+x^2, 0)$.\n    -   The characteristic direction is $b_n = \\boldsymbol{\\beta} \\cdot \\boldsymbol{n} = 0$.\n    -   Since $b_n \\ge 0$, we select $u^{\\text{ext}} = u_h^{E_2}(\\boldsymbol{x})$.\n        -   At $\\boldsymbol{x}_{11} = (0.5+0.5s_1, 1)$: $u^{\\text{ext}}_{11} = u_h^{E_2}(\\boldsymbol{x}_{11}) = 2 - (0.5+0.5s_1) + 1 = 2.5 - 0.25(1-1/\\sqrt{3}) \\approx 2.394338$.\n        -   At $\\boldsymbol{x}_{12} = (0.5+0.5s_2, 1)$: $u^{\\text{ext}}_{12} = u_h^{E_2}(\\boldsymbol{x}_{12}) = 2 - (0.5+0.5s_2) + 1 = 2.5 - 0.25(1+1/\\sqrt{3}) \\approx 2.105662$.\n\nThe final sequence of computed values for $u^{\\text{ext}}$, ordered as required, is assembled below.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the exterior state u^ext at boundary quadrature points\n    for a Discontinuous Galerkin discretization of the linear advection equation.\n    \"\"\"\n\n    # --- Define problem-specific functions ---\n\n    def beta_field(x, y):\n        \"\"\"Advection field beta(x,y) = (1+x^2, sin(pi*y)).\"\"\"\n        return np.array([1 + x**2, np.sin(np.pi * y)])\n\n    def g_data(x, y):\n        \"\"\"Prescribed Dirichlet boundary data g(x,y) = cos(pi*x) + y.\"\"\"\n        return np.cos(np.pi * x) + y\n\n    def u_trace_e1(x, y):\n        \"\"\"Interior trace on element E1: u_h^E1(x,y) = 1 + x + 2y.\"\"\"\n        return 1 + x + 2 * y\n\n    def u_trace_e2(x, y):\n        \"\"\"Interior trace on element E2: u_h^E2(x,y) = 2 - x + y.\"\"\"\n        return 2 - x + y\n\n    # --- Define quadrature and mesh data ---\n\n    # 2-point Gauss-Legendre nodes on reference interval [-1, 1]\n    xi_nodes = np.array([-1/np.sqrt(3), 1/np.sqrt(3)])\n\n    # Map nodes to s in [0, 1]\n    s_points = (xi_nodes + 1) / 2\n\n    # Define elements and their boundary faces on the physical domain boundary.\n    # The order of elements and faces within elements is specified by the problem.\n    problem_setup = [\n        # Element E1\n        {\n            'elem_id': 1, 'u_trace': u_trace_e1,\n            'faces': [\n                {'type': 'left', 'axis': 'x', 'const_coord': 0.0, 'var_range': (0.0, 1.0), 'normal': np.array([-1.0, 0.0])},\n                {'type': 'bottom', 'axis': 'y', 'const_coord': 0.0, 'var_range': (0.0, 0.5), 'normal': np.array([0.0, -1.0])},\n                {'type': 'top', 'axis': 'y', 'const_coord': 1.0, 'var_range': (0.0, 0.5), 'normal': np.array([0.0, 1.0])},\n            ]\n        },\n        # Element E2\n        {\n            'elem_id': 2, 'u_trace': u_trace_e2,\n            'faces': [\n                {'type': 'bottom', 'axis': 'y', 'const_coord': 0.0, 'var_range': (0.5, 1.0), 'normal': np.array([0.0, -1.0])},\n                {'type': 'right', 'axis': 'x', 'const_coord': 1.0, 'var_range': (0.0, 1.0), 'normal': np.array([1.0, 0.0])},\n                {'type': 'top', 'axis': 'y', 'const_coord': 1.0, 'var_range': (0.5, 1.0), 'normal': np.array([0.0, 1.0])},\n            ]\n        }\n    ]\n    \n    # List to store the results in the required order\n    results = []\n\n    # --- Main calculation loop ---\n\n    for element in problem_setup:\n        for face in element['faces']:\n            u_h_E = element['u_trace']\n            var_min, var_max = face['var_range']\n            \n            for s in s_points:\n                # Calculate physical coordinates (x, y) of the quadrature point\n                var_coord = var_min + s * (var_max - var_min)\n                if face['axis'] == 'x':  # Vertical face\n                    x, y = face['const_coord'], var_coord\n                else:  # Horizontal face\n                    x, y = var_coord, face['const_coord']\n\n                # Compute beta . n\n                beta_val = beta_field(x, y)\n                b_n = np.dot(beta_val, face['normal'])\n\n                # Apply upwind rule to select and compute u_ext\n                if b_n  0:\n                    u_ext = g_data(x, y)\n                else:  # b_n >= 0\n                    u_ext = u_h_E(x, y)\n                \n                results.append(u_ext)\n\n    # Format and print the final output as a single-line string\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3428124"}]}