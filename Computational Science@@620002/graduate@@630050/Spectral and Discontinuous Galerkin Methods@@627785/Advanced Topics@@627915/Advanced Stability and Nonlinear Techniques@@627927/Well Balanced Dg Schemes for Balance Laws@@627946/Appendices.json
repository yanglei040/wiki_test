{"hands_on_practices": [{"introduction": "A fundamental step in constructing a well-balanced scheme is ensuring that the discrete operators for the flux divergence and the source term cancel each other out exactly for a target steady state. This exercise [@problem_id:3428768] provides direct, hands-on practice in this core requirement by asking you to determine the minimum numerical quadrature accuracy needed to preserve the 'lake-at-rest' state in a Discontinuous Galerkin framework. By analyzing the polynomial degrees of the integrands, you will connect the abstract property of well-balancing to the concrete choice of implementation parameters.", "problem": "Consider the one-dimensional shallow water balance law on a domain partitioned into elements with straight interfaces,\n$$\n\\partial_{t}\\begin{pmatrix} h \\\\ hu \\end{pmatrix}\n+ \\partial_{x}\\begin{pmatrix} hu \\\\ \\displaystyle \\frac{(hu)^{2}}{h} + \\frac{g}{2}h^{2} \\end{pmatrix}\n= \\begin{pmatrix} 0 \\\\ -g\\,h\\,\\partial_{x}b(x) \\end{pmatrix},\n$$\nwhere $h(x,t)$ is the water height, $u(x,t)$ is the velocity, $g$ is the gravitational acceleration (constant), and $b(x)$ is the bottom topography. The lake-at-rest steady state is given by $u(x,t)=0$ and $h(x,t)+b(x)=H$ with $H$ a constant.\n\nA Discontinuous Galerkin (DG) method of polynomial degree $p=1$ is used on each element, with test functions $\\varphi(x)$ that are polynomials of degree at most $1$. Assume the bottom $b(x)$ is piecewise linear per element, so that $\\partial_{x}b$ is constant within each element and may jump across interfaces. The DG formulation applies the standard integration by parts to the flux term within each element (yielding a volume integral involving $f(q)$ and the gradient of the test function, and a boundary flux term at interfaces), and discretizes the source term in the volume. To achieve exact well-balancing of the lake-at-rest state, one follows a path-conservative interpretation at interfaces for the nonconservative coupling induced by the topography: the interface contribution that enforces exact cancellation can be written as a one-dimensional path integral in an abstract path variable $s\\in[0,1]$ traversing a straight segment in state space between left and right traces, of the form\n$$\n\\int_{0}^{1} B\\big(q(s)\\big)\\,\\partial_{s}b(s)\\,ds,\n$$\nwith $B(q)=g\\,h$ and $b(s)$ linear along the path. In the lake-at-rest configuration, $h(s)=H-b(s)$ along the path.\n\nYou are to determine the minimal Gauss–Legendre quadrature orders required to exactly integrate:\n- the element interior (volume) integrals needed by the DG scheme to preserve the lake-at-rest equilibrium, and\n- the interface path integrals needed to ensure exact well-balancing at interfaces.\n\nUse the following fundamental bases:\n- The lake-at-rest state satisfies $u=0$ and $h+b=H$, so $h$ is piecewise linear if $b$ is piecewise linear.\n- Within each element for $p=1$, the gradient of any test function $\\varphi$ is constant.\n- The momentum flux reduces to the hydrostatic term $\\frac{g}{2}h^{2}$ when $u=0$.\n- Gauss–Legendre quadrature with $N$ points integrates exactly any polynomial of degree at most $2N-1$ on its interval of application.\n\nAssume each element mapping is affine so that polynomial degrees are preserved under the mapping and that the interface path $b(s)$ is linear. Express your final answer as a pair giving the minimal number of Gauss–Legendre points for volume integrals per element and for interface path integrals per interface, respectively. Provide the pair as a row matrix using integers. No rounding is needed and no units are involved.", "solution": "The problem requires determining the minimal number of Gauss-Legendre quadrature points necessary to achieve exact integration for two types of integrals in a Discontinuous Galerkin (DG) method for the shallow water equations, specifically to preserve the lake-at-rest steady state. The polynomial degree of the approximation space is $p=1$.\n\nThe lake-at-rest steady state is defined by a fluid velocity of zero, $u(x,t)=0$, and a constant total water surface level, $h(x,t)+b(x)=H$, where $h$ is the water height, $b$ is the bottom topography, and $H$ is a constant.\n\nA Gauss-Legendre quadrature rule with $N$ points integrates a polynomial of degree at most $2N-1$ exactly. To find the minimal $N$, we must find the maximal polynomial degree $d$ of the integrands and solve the inequality $2N-1 \\ge d$ for the smallest integer $N$.\n\n### Part 1: Element Interior (Volume) Integrals\n\nTo preserve the steady state, the numerical scheme must exactly balance the discretized flux gradient and source terms within each element. At the lake-at-rest state ($u=0$), the momentum equation simplifies. The terms that must be integrated over an element volume $K$ are derived from the weak formulation of the momentum equation:\n$$\n\\int_K \\partial_x \\left( \\frac{g}{2}h^2 \\right) \\varphi \\, dx = \\int_K -g h (\\partial_x b) \\varphi \\, dx\n$$\nAfter integration by parts, the relevant volume integrals that require numerical quadrature are:\n1.  The flux integral: $\\int_K \\frac{g}{2}h(x)^2 (\\partial_x \\varphi(x)) \\, dx$\n2.  The source term integral: $\\int_K g h(x) (\\partial_x b(x)) \\varphi(x) \\, dx$\n\nWe must determine the polynomial degree of the integrands on a given element $K$.\n-   The DG method uses polynomial basis and test functions of degree at most $p=1$. Thus, the test function $\\varphi(x)$ is a polynomial of degree at most $1$. Consequently, its derivative, $\\partial_x \\varphi(x)$, is a polynomial of degree at most $0$ (a constant).\n-   The numerical solution for the water height, $h(x)$, is also represented by a polynomial of degree at most $p=1$.\n-   The bottom topography $b(x)$ is given as piecewise linear. This means that on any single element $K$, $b(x)$ is a polynomial of degree at most $1$, and its derivative, $\\partial_x b(x)$, is a polynomial of degree at most $0$ (a constant).\n\nNow, let's analyze the degree of each integrand:\n1.  **Flux integrand**: The term is $\\frac{g}{2}h(x)^2 (\\partial_x \\varphi(x))$.\n    -   The degree of $h(x)^2$ is $2 \\times (\\text{degree of } h) = 2 \\times 1 = 2$.\n    -   The degree of $\\partial_x \\varphi(x)$ is $0$.\n    -   The degree of the product is $2+0=2$. So, the first integrand is a polynomial of degree at most $2$.\n\n2.  **Source integrand**: The term is $g h(x) (\\partial_x b(x)) \\varphi(x)$.\n    -   The degree of $h(x)$ is at most $1$.\n    -   The degree of $\\partial_x b(x)$ is at most $0$.\n    -   The degree of $\\varphi(x)$ is at most $1$.\n    -   The degree of the product is $1+0+1=2$. So, the second integrand is a polynomial of degree at most $2$.\n\nBoth integrands are polynomials of degree at most $d=2$. To integrate them exactly, we need a Gauss-Legendre rule with $N$ points such that:\n$$\n2N-1 \\ge 2 \\implies 2N \\ge 3 \\implies N \\ge 1.5\n$$\nSince $N$ must be an integer, the minimal number of points required is $N_{vol} = 2$.\n\n### Part 2: Interface Path Integrals\n\nThe problem specifies an interface contribution in the form of a path integral, which is essential for achieving a well-balanced scheme for the nonconservative system:\n$$\nI = \\int_{0}^{1} B\\big(q(s)\\big)\\,\\partial_{s}b(s)\\,ds\n$$\nwhere $s \\in [0,1]$ is the path parameter. We need to find the polynomial degree of the integrand with respect to $s$.\n\n-   The function $B(q)$ is given as $B(q) = g\\,h$.\n-   The path in state space, $q(s)$, is a straight segment connecting the left state $q_L$ and the right state $q_R$. This means each component of $q(s)$ is a linear function of $s$. In particular, for the water height $h$, we have $h(s) = (1-s)h_L + s h_R$, which is a polynomial of degree at most $1$ in $s$.\n-   The problem states that the path for the bottom topography, $b(s)$, is linear in $s$. This means $b(s) = (1-s)b_L + s b_R$ for some values $b_L$ and $b_R$.\n-   Consequently, the derivative $\\partial_s b(s) = b_R - b_L$ is a constant, i.e., a polynomial of degree $0$ in $s$.\n-   The integrand is $B(q(s)) \\partial_s b(s) = g h(s) \\partial_s b(s)$.\n    -   $g$ is a constant.\n    -   $h(s)$ is a polynomial of degree at most $1$.\n    -   $\\partial_s b(s)$ is a polynomial of degree $0$.\n    -   The product is a polynomial of degree at most $1+0=1$.\n\nThe problem also provides a consistency condition for the lake-at-rest state: $h(s) = H - b(s)$ along the path. This confirms the relationship between the paths and doesn't alter the degree calculation. If $h(s)$ is linear, then $b(s)=H-h(s)$ must also be linear, which is consistent with the problem statement.\n\nThe integrand is therefore a polynomial of degree at most $d=1$ in the integration variable $s$. To integrate it exactly, we need a Gauss-Legendre rule with $N$ points such that:\n$$\n2N-1 \\ge 1 \\implies 2N \\ge 2 \\implies N \\ge 1\n$$\nThe minimal number of points required is $N_{int} = 1$.\n\nThe minimal number of Gauss-Legendre points are $2$ for the volume integrals and $1$ for the interface path integrals.", "answer": "$$\n\\boxed{\n\\begin{pmatrix} 2 & 1 \\end{pmatrix}\n}\n$$", "id": "3428768"}, {"introduction": "Beyond preserving a static equilibrium, a crucial feature of a good numerical scheme is its ability to accurately propagate physical waves. This exercise [@problem_id:3428747] explores the dynamic behavior of a well-balanced scheme by analyzing its response to small perturbations around a steady state. You will use Fourier analysis to derive the scheme's numerical dispersion and dissipation, gaining insight into how the design choices affect the accuracy of wave modeling.", "problem": "Consider the one-dimensional scalar balance law\n$$\nu_{t} + f(u)_{x} = s(x),\n$$\nposed on a periodic domain with uniform mesh of cells of width $h$. Assume a smooth steady state $u_{0}(x)$ is exactly preserved by the discretization and satisfies the balance relation\n$$\n\\frac{d}{dx} f(u_{0}(x)) = s(x).\n$$\nA Discontinuous Galerkin (DG) method is said to be well balanced if the semi-discrete residual vanishes when $u = u_{0}$ for any mesh resolution.\n\nLet $f(u) = a u$ with constant advection speed $a > 0$, and let the numerical flux at cell interfaces be the upwind flux $F^{*} = a u^{-}$, where $u^{-}$ denotes the left trace. Assume the source term is discretized in a path-conservative manner so that the semi-discrete operator is exactly zero for the discrete representation of $u_{0}$. Consider the DG scheme with polynomial degree $p=0$ (piecewise constant within each cell). Linearize the semi-discrete scheme around the preserved steady state, by writing $u = u_{0} + v$ and neglecting $O(|v|^{2})$ terms. Treat $v$ as a small-amplitude perturbation evolving under the linearized semi-discrete operator.\n\nUsing a spatial Fourier mode $v_{j}(t) = \\hat{v} \\exp(i \\theta j + \\lambda(\\theta) t)$ on the uniform mesh (cell index $j \\in \\mathbb{Z}$ and nondimensional wavenumber $\\theta \\in \\mathbb{R}$), derive the exact semi-discrete Fourier symbol $\\lambda(\\theta)$ for the perturbation evolution. Then, for small $|\\theta|$, expand $\\lambda(\\theta)$ and identify the leading-order dispersion and dissipation errors by defining the dimensionless coefficients $C_{\\mathrm{disp}}$ and $C_{\\mathrm{diss}}$ through the asymptotic relations\n$$\n\\operatorname{Im}(\\lambda(\\theta)) = -\\frac{a}{h}\\,\\theta + C_{\\mathrm{disp}}\\,\\frac{a}{h}\\,\\theta^{3} + o(\\theta^{3}),\n\\qquad\n-\\operatorname{Re}(\\lambda(\\theta)) = C_{\\mathrm{diss}}\\,\\frac{a}{h}\\,\\theta^{2} + o(\\theta^{2}).\n$$\nReport the pair of leading-order coefficients $\\big(C_{\\mathrm{disp}},\\,C_{\\mathrm{diss}}\\big)$ as your final answer. The coefficients are dimensionless, so no units are required. Express your final answer exactly; no rounding is needed.", "solution": "The user wants to analyze a Discontinuous Galerkin (DG) scheme.\n\n### Step 1: Problem Validation\n\n**1.1. Extract Givens**\n\n*   **Governing Equation:** The one-dimensional scalar balance law is $u_{t} + f(u)_{x} = s(x)$.\n*   **Flux Function:** The flux is linear, $f(u) = a u$, where $a > 0$ is a constant advection speed.\n*   **Domain and Mesh:** The problem is posed on a periodic domain with a uniform mesh of cells $I_j = [x_{j-1/2}, x_{j+1/2}]$ of width $h = x_{j+1/2} - x_{j-1/2}$.\n*   **Steady State:** A smooth steady state $u_{0}(x)$ is exactly preserved, satisfying the balance relation $\\frac{d}{dx} f(u_{0}(x)) = s(x)$, which for the given flux becomes $a \\frac{du_0}{dx} = s(x)$.\n*   **Numerical Method:** A Discontinuous Galerkin (DG) method with polynomial degree $p=0$. This implies the solution is approximated as a piecewise constant function, $u_h(x,t) = u_j(t)$ for $x \\in I_j$.\n*   **Numerical Flux:** The interfacial flux is the upwind flux. Since $a > 0$, the flux at an interface is determined by the state on the left, so $F^{*}(u_L, u_R) = f(u_L) = a u_L$. In the context of cell $I_j$, the flux at $x_{j-1/2}$ is $F^*(u_{j-1}, u_j) = a u_{j-1}$ and at $x_{j+1/2}$ is $F^*(u_j, u_{j+1}) = a u_j$.\n*   **Well-Balanced Property:** The scheme is well-balanced, meaning \"the semi-discrete residual vanishes when $u = u_0$ for any mesh resolution\". It is also stated that \"the source term is discretized in a path-conservative manner so that the semi-discrete operator is exactly zero for the discrete representation of $u_0$\".\n*   **Linearization:** A perturbation analysis is to be performed by setting $u = u_{0} + v$ and neglecting terms of order $O(|v|^2)$.\n*   **Fourier Analysis:** A spatial Fourier mode $v_{j}(t) = \\hat{v} \\exp(i \\theta j + \\lambda(\\theta) t)$ is used for the perturbation $v$, where $j$ is the cell index and $\\theta$ is the non-dimensional wavenumber.\n*   **Objective:** Derive the semi-discrete Fourier symbol $\\lambda(\\theta)$ and find the leading-order dispersion coefficient $C_{\\mathrm{disp}}$ and dissipation coefficient $C_{\\mathrm{diss}}$ from the small-$\\theta$ expansion:\n    $$ \\operatorname{Im}(\\lambda(\\theta)) = -\\frac{a}{h}\\,\\theta + C_{\\mathrm{disp}}\\,\\frac{a}{h}\\,\\theta^{3} + o(\\theta^{3}) $$\n    $$ -\\operatorname{Re}(\\lambda(\\theta)) = C_{\\mathrm{diss}}\\,\\frac{a}{h}\\,\\theta^{2} + o(\\theta^{2}) $$\n\n**1.2. Validate Using Extracted Givens**\n\n*   **Scientific Grounding:** The problem is firmly rooted in the field of numerical analysis for partial differential equations, a core topic in applied mathematics and computational science. The concepts of DG methods, well-balancing, linearization, and Fourier stability analysis are standard and scientifically rigorous. There is no pseudoscience or factual unsoundness.\n*   **Well-Posedness:** The problem is well-posed. It provides a clear setup and a specific, calculable objective. All necessary information is provided. The assumption about the well-balanced source term discretization, while not specifying the exact form of the discrete source term, provides its crucial property, which is sufficient for the subsequent linearization.\n*   **Objectivity:** The problem is stated in precise, objective mathematical language.\n*   **Overall Verdict:** The problem is a standard, valid exercise in the numerical analysis of conservation laws.\n\n**1.3. Verdict and Action**\n\nThe problem is valid. The solution will proceed.\n\n### Step 2: Derivation of the Linearized Scheme\n\nThe Discontinuous Galerkin (DG) method with polynomial degree $p=0$ is formulated by multiplying the PDE by a test function $\\phi(x)$ (which is constant, $\\phi=1$, on each cell $I_j$) and integrating over the cell:\n$$\n\\int_{x_{j-1/2}}^{x_{j+1/2}} u_t \\,dx + \\int_{x_{j-1/2}}^{x_{j+1/2}} f(u)_x \\,dx = \\int_{x_{j-1/2}}^{x_{j+1/2}} s(x) \\,dx\n$$\nFor a piecewise constant approximation $u_h(x,t) = u_j(t)$ on cell $I_j$, the first term becomes $h \\frac{du_j}{dt}$. Integrating the flux term by parts and introducing the numerical flux $F^*$ gives:\n$$\nh \\frac{du_j}{dt} + F^*(u_h(x_{j+1/2}^-), u_h(x_{j+1/2}^+)) - F^*(u_h(x_{j-1/2}^-), u_h(x_{j-1/2}^+)) = \\int_{x_{j-1/2}}^{x_{j+1/2}} s(x) \\,dx\n$$\nWith $u_h(x_{j+1/2}^-) = u_j$, $u_h(x_{j+1/2}^+) = u_{j+1}$, and the upwind flux $F^*(u_L, u_R) = a u_L$ for $a>0$, the flux contributions are $F^*(u_j, u_{j+1}) = a u_j$ and $F^*(u_{j-1}, u_j) = a u_{j-1}$. The semi-discrete scheme is:\n$$\nh \\frac{du_j}{dt} + a u_j - a u_{j-1} = \\int_{x_{j-1/2}}^{x_{j+1/2}} s(x) \\,dx\n$$\nLet's denote the discrete source term as $S_j = \\frac{1}{h} \\int_{x_{j-1/2}}^{x_{j+1/2}} s(x) \\,dx$. The scheme is:\n$$\n\\frac{du_j}{dt} = -\\frac{a}{h}(u_j - u_{j-1}) + S_j\n$$\nThe problem states that the scheme is well-balanced for a discrete representation of the steady state, which we denote as $u_{0,j}$. This means that when $u_j = u_{0,j}$, the time derivative is zero:\n$$\n0 = -\\frac{a}{h}(u_{0,j} - u_{0,j-1}) + S_j\n$$\nThis is the discrete steady-state condition.\n\nNow, we linearize the scheme around this steady state by substituting $u_j(t) = u_{0,j} + v_j(t)$, where $v_j$ is a small perturbation. Since the problem is linear, this is an exact decomposition, not an approximation.\n$$\n\\frac{d}{dt}(u_{0,j} + v_j(t)) = -\\frac{a}{h}((u_{0,j} + v_j(t)) - (u_{0,j-1} + v_{j-1}(t))) + S_j\n$$\nSince $u_{0,j}$ is time-independent, $\\frac{du_{0,j}}{dt}=0$. Expanding the right-hand side:\n$$\n\\frac{dv_j}{dt} = \\left[ -\\frac{a}{h}(u_{0,j} - u_{0,j-1}) + S_j \\right] - \\frac{a}{h}(v_j - v_{j-1})\n$$\nThe term in the square brackets is exactly zero due to the well-balanced property of the scheme. Thus, the evolution equation for the perturbation $v_j$ is independent of the steady state $u_0$ and the source term $s(x)$:\n$$\n\\frac{dv_j}{dt} = -\\frac{a}{h}(v_j - v_{j-1})\n$$\n\n### Step 3: Fourier Analysis\n\nWe now analyze the evolution of the perturbation by substituting the Fourier mode $v_j(t) = \\hat{v} \\exp(i \\theta j + \\lambda(\\theta) t)$ into the linearized equation.\nThe left-hand side becomes:\n$$\n\\frac{dv_j}{dt} = \\lambda(\\theta) v_j\n$$\nThe right-hand side terms are:\n$$\nv_j = \\hat{v} \\exp(i \\theta j + \\lambda(\\theta) t)\n$$\n$$\nv_{j-1} = \\hat{v} \\exp(i \\theta (j-1) + \\lambda(\\theta) t) = \\exp(-i\\theta) v_j\n$$\nSubstituting these into the perturbation equation gives:\n$$\n\\lambda(\\theta) v_j = -\\frac{a}{h}(v_j - \\exp(-i\\theta) v_j)\n$$\nDividing by $v_j$ (which is non-zero) yields the exact semi-discrete Fourier symbol $\\lambda(\\theta)$:\n$$\n\\lambda(\\theta) = -\\frac{a}{h}(1 - \\exp(-i\\theta))\n$$\n\n### Step 4: Asymptotic Expansion and Coefficient Identification\n\nTo find the dispersion and dissipation coefficients, we perform a Taylor series expansion of $\\lambda(\\theta)$ for small $|\\theta|$. We use the expansion of the exponential function:\n$$\n\\exp(-i\\theta) = 1 - i\\theta + \\frac{(-i\\theta)^2}{2!} + \\frac{(-i\\theta)^3}{3!} + O(\\theta^4) = 1 - i\\theta - \\frac{\\theta^2}{2} + i\\frac{\\theta^3}{6} + O(\\theta^4)\n$$\nSubstituting this into the expression for $\\lambda(\\theta)$:\n$$\n\\lambda(\\theta) = -\\frac{a}{h} \\left[ 1 - \\left(1 - i\\theta - \\frac{\\theta^2}{2} + i\\frac{\\theta^3}{6} + O(\\theta^4)\\right) \\right]\n$$\n$$\n\\lambda(\\theta) = -\\frac{a}{h} \\left( i\\theta + \\frac{\\theta^2}{2} - i\\frac{\\theta^3}{6} + O(\\theta^4) \\right)\n$$\n$$\n\\lambda(\\theta) = -\\frac{a}{h}\\frac{\\theta^2}{2} - i\\frac{a}{h}\\theta + i\\frac{a}{h}\\frac{\\theta^3}{6} + O(\\theta^4)\n$$\nWe now separate the real and imaginary parts of $\\lambda(\\theta)$:\n$$\n\\operatorname{Re}(\\lambda(\\theta)) = -\\frac{a}{2h}\\theta^2 + O(\\theta^4)\n$$\n$$\n\\operatorname{Im}(\\lambda(\\theta)) = -\\frac{a}{h}\\theta + \\frac{a}{6h}\\theta^3 + O(\\theta^5)\n$$\nThe problem defines the dissipation and dispersion coefficients through the following asymptotic relations.\n\n**Dissipation Coefficient ($C_{\\mathrm{diss}}$):**\nThe relation for dissipation is given by:\n$$\n-\\operatorname{Re}(\\lambda(\\theta)) = C_{\\mathrm{diss}}\\frac{a}{h}\\theta^{2} + o(\\theta^{2})\n$$\nFrom our expansion, we have:\n$$\n-\\operatorname{Re}(\\lambda(\\theta)) = - \\left(-\\frac{a}{2h}\\theta^2\\right) = \\frac{1}{2}\\frac{a}{h}\\theta^2\n$$\nComparing the leading-order terms, we find:\n$$\nC_{\\mathrm{diss}}\\frac{a}{h}\\theta^{2} = \\frac{1}{2}\\frac{a}{h}\\theta^2 \\implies C_{\\mathrm{diss}} = \\frac{1}{2}\n$$\n\n**Dispersion Coefficient ($C_{\\mathrm{disp}}$):**\nThe relation for dispersion is given by:\n$$\n\\operatorname{Im}(\\lambda(\\theta)) = -\\frac{a}{h}\\theta + C_{\\mathrm{disp}}\\frac{a}{h}\\theta^{3} + o(\\theta^{3})\n$$\nFrom our expansion, we have:\n$$\n\\operatorname{Im}(\\lambda(\\theta)) = -\\frac{a}{h}\\theta + \\frac{1}{6}\\frac{a}{h}\\theta^3 + O(\\theta^5)\n$$\nComparing the $\\theta^3$ terms, we find:\n$$\nC_{\\mathrm{disp}}\\frac{a}{h}\\theta^{3} = \\frac{1}{6}\\frac{a}{h}\\theta^3 \\implies C_{\\mathrm{disp}} = \\frac{1}{6}\n$$\n\nThe pair of leading-order coefficients is $(C_{\\mathrm{disp}}, C_{\\mathrm{diss}}) = (\\frac{1}{6}, \\frac{1}{2})$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{6} & \\frac{1}{2}\n\\end{pmatrix}\n}\n$$", "id": "3428747"}, {"introduction": "Well-balanced schemes can be difficult to design when the equilibrium solution is not a member of the polynomial approximation space. This exercise [@problem_id:3428792] introduces a powerful theoretical tool—the commutator between the discrete differentiation and projection operators—to analyze and quantify the source of this imbalance. By calculating this commutator in a specific case, you will gain a deeper understanding of the subtle errors that can arise and disrupt the well-balanced property.", "problem": "Consider the one-dimensional balance law on a reference element $K=[-1,1]$ with a stationary equilibrium $q_{\\text{eq}}(x)$ satisfying $\\frac{\\mathrm{d}}{\\mathrm{d}x} f\\!\\left(q_{\\text{eq}}(x)\\right) = S(x)$, where $f$ is a smooth flux and $S$ is a smooth source. A Discontinuous Galerkin (DG) scheme is said to be well balanced if it exactly preserves such equilibria in the discrete sense. One mechanism that affects well-balancedness is the commutator between the discrete derivative and the projection onto polynomial spaces. Define the following operators on functions $q \\in L^{2}(K)$:\n- The $L^{2}$-projection onto the polynomial space of degree at most $p$, $V_{p}=\\mathbb{P}_{p}(K)$, denoted by $\\Pi_{p}:L^{2}(K)\\to V_{p}$, which satisfies $\\int_{-1}^{1}\\left(q - \\Pi_{p} q\\right) v \\,\\mathrm{d}x = 0$ for all $v \\in V_{p}$.\n- The discrete derivative operator $D_{h}:L^{2}(K)\\to V_{p-1}$ defined in strong form by $D_{h} q = \\frac{\\mathrm{d}}{\\mathrm{d}x}\\left(\\Pi_{p} q\\right)$.\n\nFor a given equilibrium $q_{\\text{eq}}$, define the commutator acting on $q_{\\text{eq}}$ by\n$$\n\\left[D_{h},\\Pi_{p}\\right] q_{\\text{eq}} \\;=\\; D_{h}\\!\\left(\\Pi_{p} q_{\\text{eq}}\\right) \\;-\\; \\Pi_{p}\\!\\left(\\frac{\\mathrm{d}}{\\mathrm{d}x} q_{\\text{eq}}\\right).\n$$\nStarting from the definitions above and standard properties of $L^{2}$-projection and polynomial differentiation, derive conditions on $q_{\\text{eq}}$ and the choice of approximation space $V_{p}$ under which the commutator vanishes, $\\left[D_{h},\\Pi_{p}\\right] q_{\\text{eq}} = 0$, thereby ensuring discrete balance preservation for the stationary solution. Then, in the specific case $p=1$ and the equilibrium profile\n$$\nq_{\\text{eq}}(x) \\;=\\; x^{2} + 1 \\quad \\text{on} \\quad K=[-1,1],\n$$\ncompute the explicit analytic expression for $\\left[D_{h},\\Pi_{1}\\right] q_{\\text{eq}}(x)$ as a function of $x$. Express your final answer as a single closed-form analytic expression. No rounding is required.", "solution": "The solution is structured in two parts. First, we derive general conditions under which the commutator vanishes. Second, we compute the explicit form of the commutator for the specific case provided.\n\n**Part 1: General Condition for a Vanishing Commutator**\n\nThe commutator is defined as:\n$$\n\\left[D_{h},\\Pi_{p}\\right] q_{\\text{eq}} = D_{h}(\\Pi_{p} q_{\\text{eq}}) - \\Pi_{p}\\left(\\frac{\\mathrm{d}}{\\mathrm{d}x} q_{\\text{eq}}\\right)\n$$\nBy substituting the definition of the discrete derivative operator $D_{h}q = \\frac{\\mathrm{d}}{\\mathrm{d}x}(\\Pi_p q)$ and noting the idempotency of the projection operator ($\\Pi_p(\\Pi_p q) = \\Pi_p q$), we can rewrite the commutator as:\n$$\n\\left[D_{h},\\Pi_{p}\\right] q_{\\text{eq}} = \\frac{\\mathrm{d}}{\\mathrm{d}x}(\\Pi_{p} q_{\\text{eq}}) - \\Pi_{p}\\left(\\frac{\\mathrm{d}}{\\mathrm{d}x} q_{\\text{eq}}\\right)\n$$\nThe commutator vanishes if and only if:\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}x}(\\Pi_{p} q_{\\text{eq}}) = \\Pi_{p}\\left(\\frac{\\mathrm{d}}{\\mathrm{d}x} q_{\\text{eq}}\\right)\n$$\nBoth sides of this equation are polynomials in the space $V_p = \\mathbb{P}_p(K)$. Two elements of $V_p$ are identical if and only if their $L^2$-inner product with every element of a basis for $V_p$ is identical. Therefore, the condition for the commutator to vanish is that for all test functions $v \\in V_p$:\n$$\n\\int_{-1}^{1} \\left( \\frac{\\mathrm{d}}{\\mathrm{d}x}(\\Pi_{p} q_{\\text{eq}}) \\right) v(x) \\, \\mathrm{d}x = \\int_{-1}^{1} \\left( \\Pi_{p}\\left(\\frac{\\mathrm{d}}{\\mathrm{d}x} q_{\\text{eq}}\\right) \\right) v(x) \\, \\mathrm{d}x\n$$\nBy the definition of the $L^2$-projection $\\Pi_p$, for any function $g \\in L^2(K)$, we have $\\int_{-1}^{1} (\\Pi_p g) v \\, \\mathrm{d}x = \\int_{-1}^{1} g v \\, \\mathrm{d}x$ for all $v \\in V_p$. Applying this to the right-hand side (RHS) of our equation with $g = \\frac{\\mathrm{d}}{\\mathrm{d}x} q_{\\text{eq}}$:\n$$\n\\int_{-1}^{1} \\left( \\frac{\\mathrm{d}}{\\mathrm{d}x}(\\Pi_{p} q_{\\text{eq}}) \\right) v(x) \\, \\mathrm{d}x = \\int_{-1}^{1} \\left( \\frac{\\mathrm{d}}{\\mathrm{d}x} q_{\\text{eq}} \\right) v(x) \\, \\mathrm{d}x\n$$\nWe now apply integration by parts to both sides.\nFor the left-hand side (LHS):\n$$\n\\int_{-1}^{1} \\left( \\frac{\\mathrm{d}}{\\mathrm{d}x}(\\Pi_{p} q_{\\text{eq}}) \\right) v(x) \\, \\mathrm{d}x = \\left[ (\\Pi_{p} q_{\\text{eq}})(x) v(x) \\right]_{-1}^{1} - \\int_{-1}^{1} (\\Pi_{p} q_{\\text{eq}})(x) \\frac{\\mathrm{d}v}{\\mathrm{d}x} \\, \\mathrm{d}x\n$$\nFor the RHS:\n$$\n\\int_{-1}^{1} \\left( \\frac{\\mathrm{d}}{\\mathrm{d}x} q_{\\text{eq}} \\right) v(x) \\, \\mathrm{d}x = \\left[ q_{\\text{eq}}(x) v(x) \\right]_{-1}^{1} - \\int_{-1}^{1} q_{\\text{eq}}(x) \\frac{\\mathrm{d}v}{\\mathrm{d}x} \\, \\mathrm{d}x\n$$\nSince $v \\in V_p = \\mathbb{P}_p(K)$, its derivative $\\frac{\\mathrm{d}v}{\\mathrm{d}x}$ is a polynomial of degree at most $p-1$. Consequently, $\\frac{\\mathrm{d}v}{\\mathrm{d}x} \\in V_{p-1} \\subset V_p$. Again, by the property of $L^2$-projection, we have $\\int_{-1}^{1} (\\Pi_p q_{\\text{eq}}) \\frac{\\mathrm{d}v}{\\mathrm{d}x} \\, \\mathrm{d}x = \\int_{-1}^{1} q_{\\text{eq}} \\frac{\\mathrm{d}v}{\\mathrm{d}x} \\, \\mathrm{d}x$. Therefore, the integral terms in the expressions from integration by parts cancel each other out.\n\nWe are left with equality of the boundary terms:\n$$\n\\left[ (\\Pi_{p} q_{\\text{eq}})(x) v(x) \\right]_{-1}^{1} = \\left[ q_{\\text{eq}}(x) v(x) \\right]_{-1}^{1}\n$$\n$$\n(\\Pi_{p} q_{\\text{eq}})(1) v(1) - (\\Pi_{p} q_{\\text{eq}})(-1) v(-1) = q_{\\text{eq}}(1) v(1) - q_{\\text{eq}}(-1) v(-1)\n$$\nThis must hold for all $v \\in V_p$. For $p \\ge 1$, we can construct Lagrange interpolating polynomials in $V_p$. We can choose $v_1 \\in V_p$ such that $v_1(1)=1$ and $v_1(-1)=0$ (e.g., $v_1(x) = \\frac{x+1}{2}$). Substituting $v_1$ yields $(\\Pi_{p} q_{\\text{eq}})(1) = q_{\\text{eq}}(1)$. Similarly, choosing $v_2 \\in V_p$ with $v_2(1)=0$ and $v_2(-1)=1$ (e.g., $v_2(x) = \\frac{1-x}{2}$) yields $(\\Pi_{p} q_{\\text{eq}})(-1) = q_{\\text{eq}}(-1)$.\n\nThus, the general condition for the commutator to vanish is that the $L^2$-projection of $q_{\\text{eq}}$ must interpolate $q_{\\text{eq}}$ at the boundaries of the element $K=[-1,1]$:\n$$\n(\\Pi_{p} q_{\\text{eq}})(1) = q_{\\text{eq}}(1) \\quad \\text{and} \\quad (\\Pi_{p} q_{\\text{eq}})(-1) = q_{\\text{eq}}(-1)\n$$\nA special case where this holds is when $q_{\\text{eq}}(x)$ is itself a polynomial of degree at most $p$, i.e., $q_{\\text{eq}} \\in V_p$. In this case, $\\Pi_p q_{\\text{eq}} = q_{\\text{eq}}$, and the condition is trivially satisfied.\n\n**Part 2: Explicit Computation for $p=1$ and $q_{\\text{eq}}(x) = x^2 + 1$**\n\nWe need to compute $\\left[D_{h},\\Pi_{1}\\right] q_{\\text{eq}}(x) = \\frac{\\mathrm{d}}{\\mathrm{d}x}(\\Pi_{1} q_{\\text{eq}}) - \\Pi_{1}(\\frac{\\mathrm{d}}{\\mathrm{d}x} q_{\\text{eq}})$ for $p=1$ and $q_{\\text{eq}}(x) = x^2 + 1$.\n\n1.  **Compute $\\Pi_{1} q_{\\text{eq}}(x)$:**\n    The space $V_1$ is the space of linear polynomials on $[-1,1]$. We find the $L^2$-projection of $q_{\\text{eq}}(x) = x^2+1$ onto $V_1$. Let $\\Pi_1 q_{\\text{eq}}(x) = ax+b$. The coefficients $a$ and $b$ are determined by the orthogonality condition: $\\int_{-1}^{1} (q_{\\text{eq}}(x) - (ax+b)) v(x) \\, \\mathrm{d}x = 0$ for all $v(x) \\in V_1$. We use the basis $\\{1, x\\}$ for $V_1$.\n\n    For $v(x) = 1$:\n    $$\n    \\int_{-1}^{1} ((x^2+1) - (ax+b)) \\, \\mathrm{d}x = 0 \\\\\n    \\left[ \\frac{x^3}{3} + x - a\\frac{x^2}{2} - bx \\right]_{-1}^{1} = 0 \\\\\n    \\left( \\frac{1}{3} + 1 - \\frac{a}{2} - b \\right) - \\left( -\\frac{1}{3} - 1 - \\frac{a}{2} + b \\right) = 0 \\\\\n    \\frac{8}{3} - 2b = 0 \\implies b = \\frac{4}{3}\n    $$\n    For $v(x) = x$:\n    $$\n    \\int_{-1}^{1} ((x^2+1) - (ax+b)) x \\, \\mathrm{d}x = 0 \\\\\n    \\int_{-1}^{1} (x^3+x - ax^2 - bx) \\, \\mathrm{d}x = 0 \\\\\n    \\left[ \\frac{x^4}{4} + \\frac{x^2}{2} - a\\frac{x^3}{3} - b\\frac{x^2}{2} \\right]_{-1}^{1} = 0 \\\\\n    \\left( \\frac{1}{4} + \\frac{1}{2} - \\frac{a}{3} - \\frac{b}{2} \\right) - \\left( \\frac{1}{4} + \\frac{1}{2} + \\frac{a}{3} - \\frac{b}{2} \\right) = 0 \\\\\n    -\\frac{2a}{3} = 0 \\implies a = 0\n    $$\n    Thus, the projection is $\\Pi_1 q_{\\text{eq}}(x) = \\frac{4}{3}$.\n\n2.  **Compute the first term of the commutator:**\n    The first term is $\\frac{\\mathrm{d}}{\\mathrm{d}x}(\\Pi_{1} q_{\\text{eq}})$.\n    $$\n    \\frac{\\mathrm{d}}{\\mathrm{d}x}\\left(\\frac{4}{3}\\right) = 0\n    $$\n\n3.  **Compute the second term of the commutator:**\n    The second term is $\\Pi_{1}(\\frac{\\mathrm{d}}{\\mathrm{d}x} q_{\\text{eq}})$. First, we compute the derivative of $q_{\\text{eq}}$:\n    $$\n    \\frac{\\mathrm{d}}{\\mathrm{d}x} q_{\\text{eq}}(x) = \\frac{\\mathrm{d}}{\\mathrm{d}x}(x^2+1) = 2x\n    $$\n    Next, we project this result onto $V_1$. The function $2x$ is already a linear polynomial, so it is an element of $V_1 = \\mathbb{P}_1(K)$. The projection of an element that is already in the space is the element itself.\n    $$\n    \\Pi_{1}(2x) = 2x\n    $$\n\n4.  **Assemble the final expression for the commutator:**\n    $$\n    \\left[D_{h},\\Pi_{1}\\right] q_{\\text{eq}}(x) = \\frac{\\mathrm{d}}{\\mathrm{d}x}(\\Pi_{1} q_{\\text{eq}}) - \\Pi_{1}\\left(\\frac{\\mathrm{d}}{\\mathrm{d}x} q_{\\text{eq}}\\right) = 0 - 2x = -2x\n    $$\nThe resulting expression for the commutator is $-2x$.", "answer": "$$\\boxed{-2x}$$", "id": "3428792"}]}