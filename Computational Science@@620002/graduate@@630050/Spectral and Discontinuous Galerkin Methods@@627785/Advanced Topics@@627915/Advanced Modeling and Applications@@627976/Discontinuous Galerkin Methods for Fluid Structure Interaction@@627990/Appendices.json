{"hands_on_practices": [{"introduction": "In modal Discontinuous Galerkin (DG) methods, the choice of basis functions within each element is fundamental to the efficiency of the entire scheme. An ideal choice leads to a diagonal mass matrix, which allows the local system of equations to be inverted trivially, avoiding costly matrix factorization. This exercise guides you through the process of deriving the scaling required to make a standard Legendre polynomial basis orthonormal, thereby achieving this crucial diagonal structure [@problem_id:3379597].", "problem": "In a one-dimensional monolithic Fluid–Structure Interaction (FSI) formulation using the Discontinuous Galerkin (DG) method, consider the reference interface element $K_{\\text{ref}} = [-1,1]$ with the standard Legendre polynomial modal basis $\\{P_{n}(x)\\}_{n=0}^{N}$ on $K_{\\text{ref}}$, where $P_{n}$ denotes the $n$-th Legendre polynomial normalized by $P_{n}(1)=1$. Define the element-wise $L^{2}$ inner product on the reference element by\n$$\n(u,v)_{K_{\\text{ref}}} \\equiv \\int_{-1}^{1} u(x)\\,v(x)\\,dx,\n$$\nand the corresponding modal mass matrix entries by\n$$\nM_{ij} \\equiv \\left(P_{i},P_{j}\\right)_{K_{\\text{ref}}} = \\int_{-1}^{1} P_{i}(x)\\,P_{j}(x)\\,dx,\\quad 0\\leq i,j\\leq N.\n$$\nStarting from fundamental properties of Legendre polynomials and the definition of the $L^{2}$ inner product, derive a closed-form expression for the entries $M_{ij}$ on $K_{\\text{ref}}$ and use it to determine a degree-dependent scaling $s(n)>0$ such that the rescaled modal basis\n$$\n\\phi_{n}(x) \\equiv s(n)\\,P_{n}(x)\n$$\nis orthonormal on $K_{\\text{ref}}$ with respect to $(\\cdot,\\cdot)_{K_{\\text{ref}}}$, i.e.,\n$$\n\\left(\\phi_{n},\\phi_{m}\\right)_{K_{\\text{ref}}} = \\delta_{nm}\n$$\nfor all integers $0\\leq n,m\\leq N$, where $\\delta_{nm}$ is the Kronecker delta. Explicitly show how the diagonal structure of the mass matrix arises for the Legendre basis and how the choice of $s(n)$ yields a diagonal mass matrix with unit diagonal. Conclude by giving the closed-form analytic expression for $s(n)$ as a function of $n$.\n\nProvide your final answer as a single closed-form analytic expression for $s(n)$ in terms of $n$. Do not include units. If you introduce any angles, express them in radians. No rounding is required.", "solution": "The objective is to find a scaling factor $s(n)$ such that the basis functions $\\phi_{n}(x) = s(n)P_{n}(x)$ are orthonormal on the reference element $K_{\\text{ref}} = [-1,1]$ with respect to the inner product $(u,v)_{K_{\\text{ref}}} = \\int_{-1}^{1} u(x)v(x)dx$.\n\nFirst, we analyze the mass matrix $M_{ij}$ for the original basis $\\{P_{n}(x)\\}$. The entries are defined as:\n$$\nM_{ij} = (P_{i}, P_{j})_{K_{\\text{ref}}} = \\int_{-1}^{1} P_{i}(x)P_{j}(x)dx\n$$\nA fundamental property of Legendre polynomials is their orthogonality with respect to the $L^2$ inner product on the interval $[-1,1]$. This property states that:\n$$\n\\int_{-1}^{1} P_{i}(x)P_{j}(x)dx = 0 \\quad \\text{for } i \\neq j\n$$\nThis directly implies that the off-diagonal entries of the mass matrix are zero:\n$$\nM_{ij} = 0 \\quad \\text{for } i \\neq j\n$$\nThis is the reason the mass matrix for a Legendre polynomial basis is diagonal. This property is a cornerstone of using such bases in spectral and DG methods as it decouples the equations for the different modes, simplifying computations significantly.\n\nNext, we evaluate the diagonal entries, $M_{nn}$, which are the squared $L^2$-norms of the basis functions. For Legendre polynomials $P_n(x)$ with the standard normalization $P_n(1)=1$, the value of this integral is a well-known result:\n$$\nM_{nn} = (P_{n}, P_{n})_{K_{\\text{ref}}} = \\int_{-1}^{1} [P_{n}(x)]^2 dx = \\frac{2}{2n+1}\n$$\nCombining these two results, we can write a single closed-form expression for the mass matrix entries:\n$$\nM_{ij} = \\frac{2}{2i+1}\\delta_{ij}\n$$\nwhere $\\delta_{ij}$ is the Kronecker delta.\n\nNow, we enforce the orthonormality condition on the rescaled basis $\\{\\phi_{n}(x)\\}$. The condition is:\n$$\n(\\phi_{n}, \\phi_{m})_{K_{\\text{ref}}} = \\delta_{nm}\n$$\nLet's expand the left-hand side using the definition $\\phi_{n}(x) = s(n)P_{n}(x)$:\n$$\n(\\phi_{n}, \\phi_{m})_{K_{\\text{ref}}} = \\int_{-1}^{1} \\phi_{n}(x)\\phi_{m}(x)dx = \\int_{-1}^{1} [s(n)P_{n}(x)][s(m)P_{m}(x)]dx\n$$\nSince $s(n)$ and $s(m)$ are constants with respect to the integration variable $x$, we can factor them out:\n$$\n(\\phi_{n}, \\phi_{m})_{K_{\\text{ref}}} = s(n)s(m) \\int_{-1}^{1} P_{n}(x)P_{m}(x)dx = s(n)s(m) M_{nm}\n$$\nWe now equate this to the Kronecker delta, $\\delta_{nm}$.\n\nFor the case $n \\neq m$:\n$$\ns(n)s(m)M_{nm} = s(n)s(m) \\cdot 0 = 0\n$$\nThe condition $(\\phi_{n}, \\phi_{m})_{K_{\\text{ref}}} = \\delta_{nm} = 0$ for $n \\neq m$ is thus automatically satisfied due to the inherent orthogonality of the Legendre polynomials, regardless of the choice of scaling factors $s(n)$.\n\nFor the case $n = m$:\nThe condition is $(\\phi_{n}, \\phi_{n})_{K_{\\text{ref}}} = \\delta_{nn} = 1$. The expansion gives:\n$$\ns(n)s(n)M_{nn} = [s(n)]^2 M_{nn} = 1\n$$\nWe substitute the previously established expression for $M_{nn}$:\n$$\n[s(n)]^2 \\left(\\frac{2}{2n+1}\\right) = 1\n$$\nNow, we solve for $s(n)$. Rearranging the equation gives:\n$$\n[s(n)]^2 = \\frac{2n+1}{2}\n$$\nThe problem specifies that $s(n) > 0$. Therefore, we must take the positive square root:\n$$\ns(n) = \\sqrt{\\frac{2n+1}{2}}\n$$\nThis is the closed-form analytic expression for the scaling factor $s(n)$ that transforms the Legendre basis $\\{P_n(x)\\}$ (with $P_n(1)=1$) into an orthonormal basis $\\{\\phi_n(x)\\}$ on $K_{\\text{ref}} = [-1,1]$. With this scaling, the mass matrix for the basis $\\{\\phi_n(x)\\}$ becomes the identity matrix, since $(\\phi_n, \\phi_m) = \\delta_{nm}$.", "answer": "$$\n\\boxed{\\sqrt{\\frac{2n+1}{2}}}\n$$", "id": "3379597"}, {"introduction": "Successfully coupling fluid and structure solvers requires navigating numerical stability challenges unique to Fluid-Structure Interaction (FSI). A classic pitfall arises in partitioned explicit schemes, where the fluid's inertial effect—the \"added mass\"—can destabilize the computation if not handled carefully. This analytical exercise asks you to perform a linear stability analysis on a simplified FSI system to uncover the source of this \"artificial added-mass instability\" and derive the resulting time-step restriction [@problem_id:3379632].", "problem": "Consider a one-dimensional ($1$D) inviscid, incompressible fluid column of length $L$ and cross-sectional area $A$, density $\\rho$, confined within a rigid tube on $x \\in [0,L]$. The tube end at $x=0$ is fixed, while the end at $x=L$ is a piston attached to a linear spring-mass structural model with mass $m_{s}$ and stiffness $k_{s}$, whose displacement is $x_{s}(t)$. The fluid and structure satisfy kinematic continuity at the interface, so the piston velocity equals the fluid velocity at $x=L$. The fluid is discretized in space by the Discontinuous Galerkin (DG) method with upwind numerical fluxes on a single element, and the structure is modeled as a lumped degree of freedom.\n\nStarting from the conservation of momentum and Newton’s second law, regard the fluid as an added mass $m_{a}$ attached to the structure in the incompressible limit, and take the reaction force on the structure from the fluid to be $F_{f}(t) = - m_{a}\\,\\ddot{x}_{s}(t)$. Show that for the $1$D column described, $m_{a} = \\rho A L$.\n\nNow consider a partitioned explicit time coupling in which:\n- the structure is advanced by the second-order central-difference method, and\n- the fluid reaction force is evaluated with a one-step lag using a central-difference approximation to $\\ddot{x}_{s}$ at the previous time level.\n\nSpecifically, let $\\Delta t$ be the constant time step and denote $x^{n} \\approx x_{s}(t^{n})$ with $t^{n} = n \\Delta t$. The explicit coupling advances the structure by\n$$\nm_{s}\\,\\frac{x^{n+1} - 2 x^{n} + x^{n-1}}{\\Delta t^{2}} + k_{s}\\,x^{n} \\;=\\; F_{f}^{n},\n$$\nwith the fluid reaction force evaluated as\n$$\nF_{f}^{n} \\;=\\; - m_{a}\\,\\frac{x^{n} - 2 x^{n-1} + x^{n-2}}{\\Delta t^{2}}.\n$$\n\nPerform a linear stability analysis of this recurrence by seeking solutions of the form $x^{n} = r^{n}$, and determine the largest stable time step $\\Delta t_{\\max}$ as a closed-form analytic expression in terms of $m_{s}$, $k_{s}$, and $m_{a}$.\n\nFinally, compare this explicit coupling restriction to the stability of a monolithic fully implicit scheme applied to the coupled mass-spring-plus-added-mass system, but do not produce a numerical value for this comparison.\n\nProvide your final answer as a single analytic expression for $\\Delta t_{\\max}$ in seconds, with no rounding and no numerical substitution.", "solution": "The problem consists of three parts. First, we must derive the expression for the added mass $m_a$. Second, we need to perform a linear stability analysis of the given partitioned explicit time-coupling scheme to find the maximum stable time step $\\Delta t_{\\max}$. Third, we are asked to compare this stability restriction to that of a monolithic fully implicit scheme.\n\nPart 1: Derivation of the Added Mass $m_{a}$\n\nThe problem asks to show that for the one-dimensional fluid column, the added mass is $m_a = \\rho A L$. We are instructed to start from the conservation of momentum and Newton's second law, and to regard the fluid as an added mass in the incompressible limit.\n\nThere is a subtle physical inconsistency in the problem statement. For a 1D incompressible fluid, the continuity equation $\\frac{\\partial u}{\\partial x} = 0$ implies that the fluid velocity $u$ can only be a function of time, $u(t)$. This conflicts with the given boundary conditions of a fixed wall at one end, $u(0, t) = 0$, and a moving piston at the other, $u(L, t) = \\dot{x}_s(t)$, unless the piston is stationary.\n\nHowever, the problem instructs us to \"regard the fluid as an added mass,\" which suggests adopting a simplified, lumped-parameter model. In this context, the most direct interpretation is the \"rigid slug\" model, where the entire fluid column of mass $M_{\\text{fluid}} = \\rho A L$ is assumed to a have a single, uniform acceleration equal to that of the piston, $\\ddot{x}_s(t)$. This simplification effectively ignores the internal velocity distribution and the boundary condition at $x=0$, focusing only on the total inertia of the fluid that the piston must move.\n\nFollowing this interpretation, we apply Newton's second law to the fluid column. The total mass of the fluid is $M_{\\text{fluid}} = \\rho A L$. Assuming it accelerates as a rigid body with the piston, its acceleration is $a_{\\text{fluid}} = \\ddot{x}_s(t)$. The net force required to produce this acceleration is:\n$$ F_{\\text{net on fluid}} = M_{\\text{fluid}} \\, a_{\\text{fluid}} = (\\rho A L) \\ddot{x}_s(t) $$\nThe problem defines the reaction force from the fluid onto the structure (the piston) as $F_f(t) = -m_a \\ddot{x}_s(t)$. By Newton's third law, the force exerted by the piston on the fluid is $F_{\\text{piston on fluid}} = -F_f(t) = m_a \\ddot{x}_s(t)$. If we assume this is the sole force responsible for accelerating the fluid slug (i.e., it represents the net force), we can equate the two expressions:\n$$ F_{\\text{net on fluid}} = F_{\\text{piston on fluid}} $$\n$$ (\\rho A L) \\ddot{x}_s(t) = m_a \\ddot{x}_s(t) $$\nThis directly implies:\n$$ m_a = \\rho A L $$\nThis completes the requested derivation under the specified lumped-parameter interpretation.\n\nPart 2: Linear Stability Analysis\n\nThe coupled numerical scheme is defined by two equations:\nThe structural equation of motion:\n$$ m_{s}\\,\\frac{x^{n+1} - 2 x^{n} + x^{n-1}}{\\Delta t^{2}} + k_{s}\\,x^{n} \\;=\\; F_{f}^{n} $$\nThe fluid reaction force with a one-step lag:\n$$ F_{f}^{n} \\;=\\; - m_{a}\\,\\frac{x^{n} - 2 x^{n-1} + x^{n-2}}{\\Delta t^{2}} $$\nSubstituting the expression for $F_{f}^{n}$ into the structural equation, we obtain a single recurrence relation for the structural displacement $x^n$:\n$$ m_{s}\\,\\frac{x^{n+1} - 2 x^{n} + x^{n-1}}{\\Delta t^{2}} + k_{s}\\,x^{n} \\;=\\; - m_{a}\\,\\frac{x^{n} - 2 x^{n-1} + x^{n-2}}{\\Delta t^{2}} $$\nTo simplify, we multiply the entire equation by $\\Delta t^2$ and move all terms to the left-hand side:\n$$ m_{s}(x^{n+1} - 2 x^{n} + x^{n-1}) + k_{s}\\Delta t^{2} x^{n} + m_{a}(x^{n} - 2 x^{n-1} + x^{n-2}) = 0 $$\nGrouping terms by their time level ($n+1, n, n-1, n-2$):\n$$ m_{s}x^{n+1} + (m_{a} - 2m_{s} + k_{s}\\Delta t^{2})x^{n} + (m_{s} - 2m_{a})x^{n-1} + m_{a}x^{n-2} = 0 $$\nTo perform the linear stability analysis, we seek solutions of the form $x^{n} = r^{n}$, where $r$ is the amplification factor. Substituting this into the recurrence relation gives:\n$$ m_{s}r^{n+1} + (m_{a} - 2m_{s} + k_{s}\\Delta t^{2})r^{n} + (m_{s} - 2m_{a})r^{n-1} + m_{a}r^{n-2} = 0 $$\nDividing by $r^{n-2}$ (for $r \\neq 0$), we obtain the characteristic polynomial $P(r)$:\n$$ P(r) = m_{s}r^{3} + (m_{a} - 2m_{s} + k_{s}\\Delta t^{2})r^{2} + (m_{s} - 2m_{a})r + m_{a} = 0 $$\nFor the numerical scheme to be stable, all roots $r_i$ of this cubic polynomial must satisfy the root condition: $|r_i| \\le 1$. Any roots on the unit circle ($|r_i| = 1$) must be simple. The stability boundary is found by determining when a root lies on the unit circle. A necessary condition for stability, derived from the Jury stability criterion, is that for a root at $r=-1$, $P(-1)=0$. Let's evaluate the polynomial at $r=-1$:\n$$ P(-1) = m_{s}(-1)^{3} + (m_{a} - 2m_{s} + k_{s}\\Delta t^{2})(-1)^{2} + (m_{s} - 2m_{a})(-1) + m_{a} $$\n$$ P(-1) = -m_{s} + (m_{a} - 2m_{s} + k_{s}\\Delta t^{2}) - (m_{s} - 2m_{a}) + m_{a} $$\n$$ P(-1) = -m_{s} + m_{a} - 2m_{s} + k_{s}\\Delta t^{2} - m_{s} + 2m_{a} + m_{a} $$\n$$ P(-1) = -4m_{s} + 4m_{a} + k_{s}\\Delta t^{2} $$\nAt the stability limit, a root transitions to outside the unit circle, often passing through $r=-1$. Setting $P(-1)=0$ gives a condition on the time step:\n$$ -4m_{s} + 4m_{a} + k_{s}\\Delta t^{2} = 0 $$\n$$ k_{s}\\Delta t^{2} = 4(m_{s} - m_{a}) $$\n$$ \\Delta t^{2} = \\frac{4(m_{s} - m_{a})}{k_{s}} $$\nThis relation defines a critical time step. For a stable scheme where $\\Delta t$ can be real and positive, we must have $m_s > m_a$. If $m_s \\le m_a$, the scheme is unconditionally unstable for any $\\Delta t > 0$. This is a well-known phenomenon called artificial added mass instability. The Jury criterion requires $P(-1) < 0$ for a stable cubic polynomial (assuming $m_s>0$), which gives the stability condition:\n$$ -4m_{s} + 4m_{a} + k_{s}\\Delta t^{2} < 0 \\quad \\implies \\quad k_{s}\\Delta t^{2} < 4(m_{s} - m_{a}) $$\n$$ \\Delta t < 2\\sqrt{\\frac{m_{s} - m_{a}}{k_{s}}} $$\nWhile the full Jury criterion involves more inequalities, this condition, arising from the $r=-1$ root crossing, is typically the limiting factor for this type of explicit coupling scheme. The other conditions can be shown to yield less restrictive bounds on $\\Delta t$ provided that $m_s > m_a$. Therefore, the largest stable time step is given by the equality:\n$$ \\Delta t_{\\max} = 2\\sqrt{\\frac{m_{s} - m_{a}}{k_{s}}} $$\n\nPart 3: Comparison with a Monolithic Implicit Scheme\n\nA monolithic fully implicit scheme treats the coupled fluid-structure system as a single entity and solves the governing equations simultaneously. The governing equation for the coupled system is:\n$$ m_{s}\\ddot{x}_{s}(t) + k_{s}x_{s}(t) = F_{f}(t) $$\nUsing the added mass model $F_{f}(t) = -m_{a}\\ddot{x}_{s}(t)$, we get:\n$$ m_{s}\\ddot{x}_{s}(t) + k_{s}x_{s}(t) = -m_{a}\\ddot{x}_{s}(t) $$\n$$ (m_{s} + m_{a})\\ddot{x}_{s}(t) + k_{s}x_{s}(t) = 0 $$\nThis is the equation of a simple harmonic oscillator with a total effective mass $M_{\\text{total}} = m_{s} + m_{a}$.\nWhen a \"fully implicit\" scheme, such as the trapezoidal rule (also known as the Newmark method with $\\gamma=1/2$, $\\beta=1/4$), is used to integrate this second-order ordinary differential equation, the resulting numerical method is unconditionally stable. This means that the scheme is stable for any choice of time step $\\Delta t > 0$, regardless of the system parameters $m_s$, $m_a$, and $k_s$.\n\nIn conclusion, the comparison is as follows:\n- The partitioned explicit scheme is conditionally stable. It requires the physical mass to be greater than the added mass ($m_s > m_a$) and the time step to be smaller than a critical value, $\\Delta t \\le \\Delta t_{\\max}$.\n- The monolithic fully implicit scheme is unconditionally stable. It imposes no upper limit on the time step for stability, although accuracy considerations may still dictate the choice of $\\Delta t$.", "answer": "$$\\boxed{2\\sqrt{\\frac{m_{s} - m_{a}}{k_{s}}}}$$", "id": "3379632"}, {"introduction": "Theory and analysis come to life through implementation. This practice moves from the component-level concepts of bases and stability to the system-level task of building a complete 1D fluid-structure interaction solver using the discontinuous Galerkin method. You will implement the spatial discretization with upwind fluxes, enforce the FSI coupling at the boundary, and compare the results of a stable monolithic time-integration scheme against a partitioned predictor-corrector method [@problem_id:3379655].", "problem": "Consider the one-dimensional linear acoustics model for a compressible, inviscid fluid coupled at the left boundary to a lumped structural mass. The fluid occupies the interval $[0,L]$ with uniform density $\\rho$ and sound speed $c$, and cross-sectional area $A$. The fluid state is the pressure $p(x,t)$ and the axial velocity $u(x,t)$, evolving under the conservation laws\n$$\n\\frac{\\partial p}{\\partial t} + \\rho c^2 \\frac{\\partial u}{\\partial x} = 0, \\quad\n\\frac{\\partial u}{\\partial t} + \\frac{1}{\\rho} \\frac{\\partial p}{\\partial x} = 0,\n$$\nwhich can be written compactly as\n$$\n\\frac{\\partial}{\\partial t}\\begin{bmatrix} p \\\\ u \\end{bmatrix} + A \\frac{\\partial}{\\partial x}\\begin{bmatrix} p \\\\ u \\end{bmatrix} = 0,\n\\quad\nA = \\begin{bmatrix} 0 & \\rho c^2 \\\\ \\frac{1}{\\rho} & 0 \\end{bmatrix}.\n$$\nLet $Z = \\rho c$ denote the acoustic impedance.\n\nAt $x=0$, the fluid couples to a point mass $m$ via the traction and velocity compatibility conditions:\n- The structure velocity satisfies $v_s(t) = u(0^+,t)$.\n- The structure’s equation of motion is $m \\,\\mathrm{d}v_s/\\mathrm{d}t = -A\\,p(0^+,t)$ (force equals cross-sectional area times pressure acting on the mass).\n\nAt $x=L$, impose an absorbing boundary condition that sets the incoming characteristic to zero.\n\nDiscretize the fluid domain with a uniform mesh of $N$ discontinuous elements and piecewise-constant (polynomial degree zero) basis functions per element, resulting in a semi-discrete discontinuous Galerkin method that coincides with a first-order finite volume scheme. Denote cell width $\\Delta x = L/N$, and cell-centered states $(p_i(t),u_i(t))$ for $i=0,1,\\dots,N-1$. Use a linear upwind (Godunov) numerical flux at interfaces based on the eigensplitting of $A$:\n$$\nA = R \\Lambda R^{-1}, \\quad \\Lambda = \\mathrm{diag}(c,-c),\n$$\nand define the positive and negative parts\n$$\nA^+ = R\\,\\mathrm{diag}(c,0)\\,R^{-1}, \\quad A^- = R\\,\\mathrm{diag}(0,-c)\\,R^{-1},\n$$\nso that $A = A^+ + A^-$. At an interior interface with left state $w_L = [p_L,u_L]^T$ and right state $w_R = [p_R,u_R]^T$, the numerical flux is\n$$\nf^* = A^+ w_L + A^- w_R,\n$$\nand the semi-discrete update for cell $i$ is\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}\\begin{bmatrix} p_i \\\\ u_i \\end{bmatrix}\n= -\\frac{1}{\\Delta x}\\left(f^*_{i+\\frac{1}{2}} - f^*_{i-\\frac{1}{2}}\\right).\n$$\n\nAt the left boundary $x=0$, enforce the coupling by constructing an exterior ghost state from interior characteristics and the structure velocity $v_s(t)$:\n$$\na_-^{\\mathrm{in}} = p_0 - Z u_0, \\quad a_+^{\\mathrm{b}} = 2 Z v_s + a_-^{\\mathrm{in}},\n$$\nand set the ghost state $w_{\\mathrm{ext},L}$ so that\n$$\np_b = \\frac{a_+^{\\mathrm{b}} + a_-^{\\mathrm{in}}}{2} = Z v_s + a_-^{\\mathrm{in}}, \\quad\nu_b = \\frac{a_+^{\\mathrm{b}} - a_-^{\\mathrm{in}}}{2Z} = v_s.\n$$\nThen use $f^*_{-\\frac{1}{2}} = A^+ w_{\\mathrm{ext},L} + A^- w_0$ for the left boundary flux. The structure obeys\n$$\n\\frac{\\mathrm{d}v_s}{\\mathrm{d}t} = -\\frac{A}{m}\\,p_b = -\\frac{A}{m}\\left(Z v_s + p_0 - Z u_0\\right).\n$$\n\nAt the right boundary $x=L$, enforce absorbing condition by setting the incoming characteristic to zero, $a_-^{\\mathrm{b}} = 0$. With interior outgoing characteristic $a_+^{\\mathrm{in}} = p_{N-1} + Z u_{N-1}$, construct the right ghost state\n$$\np_{\\mathrm{ext},R} = \\frac{a_+^{\\mathrm{in}}}{2}, \\quad\nu_{\\mathrm{ext},R} = \\frac{a_+^{\\mathrm{in}}}{2Z},\n$$\nand use $f^*_{N-\\frac{1}{2}} = A^+ w_{N-1} + A^- w_{\\mathrm{ext},R}$.\n\nCollect the semi-discrete fluid and structure equations into a linear ordinary differential equation for the combined state vector\n$$\ny(t) = \\left[p_0,\\dots,p_{N-1},u_0,\\dots,u_{N-1},v_s\\right]^T \\in \\mathbb{R}^{2N+1},\n$$\nof the form\n$$\n\\frac{\\mathrm{d}y}{\\mathrm{d}t} = F y,\n$$\nwhere the matrix $F \\in \\mathbb{R}^{(2N+1)\\times(2N+1)}$ is determined by the flux differences (including boundary contributions) and the structure coupling.\n\nTime integration over one time step $\\Delta t$ must be performed by:\n1) A monolithic implicit second-order Crank–Nicolson method applied to the full coupled system:\n$$\n\\left(I - \\frac{\\Delta t}{2} F\\right) y^{n+1} = \\left(I + \\frac{\\Delta t}{2} F\\right) y^n.\n$$\n2) A partitioned predictor–corrector scheme of the same formal order, using:\n   - Predictor fluid step: Treat $v_s$ as a frozen parameter at $t^n$. Form the fluid-only operator $B \\in \\mathbb{R}^{(2N)\\times(2N)}$ and source vector $s \\in \\mathbb{R}^{2N}$ such that the fluid semi-discrete system is $\\mathrm{d}y_f/\\mathrm{d}t = B y_f + s\\,v_s$, with $y_f = [p_0,\\dots,p_{N-1},u_0,\\dots,u_{N-1}]^T$. Advance $y_f$ by Crank–Nicolson with $v_s^n$ treated as constant:\n   $$\n   \\left(I - \\frac{\\Delta t}{2} B\\right) y_f^* = \\left(I + \\frac{\\Delta t}{2} B\\right) y_f^n + \\Delta t\\,s\\,v_s^n.\n   $$\n   - Corrector structure step: Advance $v_s$ by Crank–Nicolson using $b(y_f) = -\\frac{A}{m} p_0 + \\frac{A Z}{m} u_0$ evaluated at $y_f^n$ and at the predicted fluid $y_f^*$, and the linear coefficient $\\alpha = \\frac{A Z}{m}$:\n   $$\n   \\left(1 + \\frac{\\Delta t}{2}\\alpha\\right) v_s^{n+1} = \\left(1 - \\frac{\\Delta t}{2}\\alpha\\right) v_s^n + \\frac{\\Delta t}{2}\\left[b(y_f^n) + b(y_f^*)\\right].\n   $$\n   - Corrector fluid step: Re-advance the fluid from $y_f^n$ to $y_f^{n+1}$ by Crank–Nicolson using the average structure velocity $v_s^{\\mathrm{avg}} = \\frac{1}{2}(v_s^n + v_s^{n+1})$:\n   $$\n   \\left(I - \\frac{\\Delta t}{2} B\\right) y_f^{n+1} = \\left(I + \\frac{\\Delta t}{2} B\\right) y_f^n + \\Delta t\\,s\\,v_s^{\\mathrm{avg}}.\n   $$\n\nInitialize the fluid with a smooth sinusoidal pressure and zero velocity,\n$$\np(x,0) = p_{\\mathrm{amp}} \\sin\\left(k x\\right), \\quad u(x,0) = 0, \\quad v_s(0) = 0,\n$$\nusing cell-centered values for the discontinuous Galerkin piecewise-constant state (that is, $p_i(0) = p(x_i,0)$, $u_i(0) = u(x_i,0)$ with $x_i = (i+0.5)\\Delta x$). Use $k = 2\\pi/L$. The physical units are the International System of Units (SI): $p$ in pascals (Pa), $u$ and $v_s$ in meters per second (m/s), $\\rho$ in kilograms per cubic meter (kg/m$^3$), $c$ in meters per second (m/s), $A$ in square meters (m$^2$), $m$ in kilograms (kg), $L$ in meters (m), and time in seconds (s).\n\nDefine the dimensionless scaled state by\n$$\n\\widehat{p} = \\frac{p}{\\rho c^2}, \\quad \\widehat{u} = \\frac{u}{c}, \\quad \\widehat{v}_s = \\frac{v_s}{c}.\n$$\nAfter one time step, compute the error between the partitioned predictor–corrector result and the monolithic Crank–Nicolson result as the Euclidean norm of the difference of scaled states:\n$$\n\\varepsilon = \\left\\| \\begin{bmatrix} \\widehat{p}^{n+1}_{\\mathrm{part}} \\\\ \\widehat{u}^{n+1}_{\\mathrm{part}} \\\\ \\widehat{v}_s^{n+1}_{\\mathrm{part}} \\end{bmatrix}\n-\n\\begin{bmatrix} \\widehat{p}^{n+1}_{\\mathrm{mono}} \\\\ \\widehat{u}^{n+1}_{\\mathrm{mono}} \\\\ \\widehat{v}_s^{n+1}_{\\mathrm{mono}} \\end{bmatrix} \\right\\|_2.\n$$\nExpress the error $\\varepsilon$ as a floating-point number with no units (dimensionless).\n\nImplement a complete, runnable program that constructs $A^+,A^-$, assembles the semi-discrete operators $F$ and $B,s$, advances the two time integrators from the same initial condition by one time step, and outputs $\\varepsilon$ for each of the following test cases (all quantities in SI units):\n- Test case $1$ (happy path): $N=20$, $L=1.0$, $\\rho=1.0$, $c=1.0$, $A=1.0$, $m=1.0$, $\\Delta t=0.001$, $p_{\\mathrm{amp}}=0.1$.\n- Test case $2$ (larger time step): $N=20$, $L=1.0$, $\\rho=1.0$, $c=1.0$, $A=1.0$, $m=1.0$, $\\Delta t=0.01$, $p_{\\mathrm{amp}}=0.1$.\n- Test case $3$ (light mass): $N=20$, $L=1.0$, $\\rho=1.0$, $c=1.0$, $A=1.0$, $m=0.1$, $\\Delta t=0.005$, $p_{\\mathrm{amp}}=0.1$.\n- Test case $4$ (coarse grid): $N=4$, $L=1.0$, $\\rho=1.0$, $c=1.0$, $A=1.0$, $m=1.0$, $\\Delta t=0.02$, $p_{\\mathrm{amp}}=0.1$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4]\").", "solution": "### 1. Mathematical Formulation\n\nThe problem describes a one-dimensional fluid-structure interaction system. The fluid dynamics are governed by the linear acoustics equations, and the structure is a simple point mass. The task is to discretize this system using a first-order discontinuous Galerkin (finite volume) method and compare two time integration schemes: a monolithic Crank-Nicolson method and a partitioned predictor-corrector method of the same order.\n\nThe governing partial differential equation for the fluid state vector $w(x,t) = [p(x,t), u(x,t)]^T$ is:\n$$\n\\frac{\\partial w}{\\partial t} + \\mathbf{A} \\frac{\\partial w}{\\partial x} = 0, \\quad \\text{where} \\quad \\mathbf{A} = \\begin{bmatrix} 0 & \\rho c^2 \\\\ 1/\\rho & 0 \\end{bmatrix}\n$$\nHere, $p$ is pressure, $u$ is velocity, $\\rho$ is density, and $c$ is the sound speed.\n\n### 2. Discretization and Numerical Flux\n\nThe numerical flux is based on the eigensplitting of the matrix $\\mathbf{A}$. The eigenvalues of $\\mathbf{A}$ are $\\lambda_{1,2} = \\pm c$. The corresponding right eigenvector matrix $R$ and its inverse $R^{-1}$ are:\n$$\nR = \\begin{bmatrix} Z & -Z \\\\ 1 & 1 \\end{bmatrix}, \\quad R^{-1} = \\frac{1}{2Z} \\begin{bmatrix} 1 & Z \\\\ -1 & Z \\end{bmatrix}\n$$\nwhere $Z = \\rho c$ is the acoustic impedance.\n\nThe matrices $\\mathbf{A}^+$ and $\\mathbf{A}^-$ corresponding to the positive and negative eigenvalues are:\n$$\n\\mathbf{A}^+ = R \\begin{bmatrix} c & 0 \\\\ 0 & 0 \\end{bmatrix} R^{-1} = \\frac{c}{2} \\begin{bmatrix} 1 & Z \\\\ 1/Z & 1 \\end{bmatrix}\n$$\n$$\n\\mathbf{A}^- = R \\begin{bmatrix} 0 & 0 \\\\ 0 & -c \\end{bmatrix} R^{-1} = \\frac{c}{2} \\begin{bmatrix} -1 & Z \\\\ 1/Z & -1 \\end{bmatrix}\n$$\nThe Godunov flux between a left state $w_L$ and a right state $w_R$ is $f^* = \\mathbf{A}^+ w_L + \\mathbf{A}^- w_R$.\n\n### 3. Semi-Discrete System Assembly\n\nThe fluid domain is discretized into $N$ cells of width $\\Delta x = L/N$. The state in cell $i$ is $w_i = [p_i, u_i]^T$. The semi-discrete update for cell $i$ is:\n$$\n\\frac{d w_i}{dt} = -\\frac{1}{\\Delta x}(f^*_{i+1/2} - f^*_{i-1/2})\n$$\n\n**Interior Cells ($0 < i < N-1$):**\nThe fluxes are $f^*_{i-1/2} = \\mathbf{A}^+ w_{i-1} + \\mathbf{A}^- w_i$ and $f^*_{i+1/2} = \\mathbf{A}^+ w_i + \\mathbf{A}^- w_{i+1}$. The update becomes:\n$$\n\\frac{d w_i}{dt} = -\\frac{1}{\\Delta x} [(\\mathbf{A}^+ w_i + \\mathbf{A}^- w_{i+1}) - (\\mathbf{A}^+ w_{i-1} + \\mathbf{A}^- w_i)] = \\frac{1}{\\Delta x}[\\mathbf{A}^+ w_{i-1} - (\\mathbf{A}^+ - \\mathbf{A}^-)w_i - \\mathbf{A}^- w_{i+1}]\n$$\nUsing the identity $\\mathbf{A}^+ - \\mathbf{A}^- = cI$, this simplifies to:\n$$\n\\frac{d w_i}{dt} = \\frac{1}{\\Delta x}[\\mathbf{A}^+ w_{i-1} - c w_i - \\mathbf{A}^- w_{i+1}]\n$$\n\n**Left Boundary (Cell $i=0$):**\nThe flux at the left face $f^*_{-1/2}$ uses a ghost state $w_{\\mathrm{ext},L} = [p_b, u_b]^T$ constructed from the structure velocity $v_s$ and the interior state $w_0$.\n$p_b = Z v_s + p_0 - Z u_0$ and $u_b = v_s$. So, $w_{\\mathrm{ext},L} = [p_0 - Z u_0, 0]^T + [Z v_s, v_s]^T$.\nThe update for cell $0$ is:\n$$\n\\frac{d w_0}{dt} = -\\frac{1}{\\Delta x} [f^*_{1/2} - f^*_{-1/2}] = -\\frac{1}{\\Delta x} [(\\mathbf{A}^+ w_0 + \\mathbf{A}^- w_1) - (\\mathbf{A}^+ w_{\\mathrm{ext},L} + \\mathbf{A}^- w_0)]\n$$\n$$\n\\frac{d w_0}{dt} = \\frac{1}{\\Delta x}[ -c w_0 - \\mathbf{A}^- w_1 + \\mathbf{A}^+ w_{\\mathrm{ext},L} ]\n$$\nSubstituting $w_{\\mathrm{ext},L}$ and simplifying gives the fluid equation dependence on the other states, including $v_s$.\n\n**Right Boundary (Cell $i=N-1$):**\nThe flux at the right face $f^*_{N-1/2}$ uses a ghost state $w_{\\mathrm{ext},R}$ based on a zero incoming characteristic. This results in $w_{\\mathrm{ext},R} = \\frac{1}{2}[I_p + Z I_u, (1/Z) I_p + I_u]w_{N-1}$, where $I_p = [1,0]^T, I_u=[0,1]^T$. A key property is that $\\mathbf{A}^- w_{\\mathrm{ext},R} = 0$.\nThe update for cell $N-1$ is:\n$$\n\\frac{d w_{N-1}}{dt} = -\\frac{1}{\\Delta x} [f^*_{N-1/2} - f^*_{N-3/2}] = -\\frac{1}{\\Delta x} [(\\mathbf{A}^+ w_{N-1} + \\mathbf{A}^- w_{\\mathrm{ext},R}) - (\\mathbf{A}^+ w_{N-2} + \\mathbf{A}^- w_{N-1})]\n$$\n$$\n\\frac{d w_{N-1}}{dt} = \\frac{1}{\\Delta x}[\\mathbf{A}^+ w_{N-2} - c w_{N-1}]\n$$\n\n**Structure Equation:**\nThe structure velocity $v_s$ evolves according to:\n$$\n\\frac{d v_s}{dt} = -\\frac{A}{m}p_b = -\\frac{A}{m}(Z v_s + p_0 - Z u_0) = -\\frac{A}{m} p_0 + \\frac{AZ}{m} u_0 - \\frac{AZ}{m} v_s\n$$\n\n**System Matrix $F$:**\nThese equations are collected into a single linear system of ordinary differential equations $\\frac{dy}{dt} = F y$, where $y = [p_0, \\dots, p_{N-1}, u_0, \\dots, u_{N-1}, v_s]^T$. The $(2N+1) \\times (2N+1)$ matrix $F$ is assembled by placing the coefficients from the derived update equations into the appropriate rows and columns corresponding to the state vector ordering.\n\n### 4. Time Integration Schemes\n\n**Monolithic Crank-Nicolson:** The full coupled system is advanced in a single step by solving the linear system:\n$$\n\\left(I - \\frac{\\Delta t}{2} F\\right) y^{n+1} = \\left(I + \\frac{\\Delta t}{2} F\\right) y^n\n$$\n\n**Partitioned Predictor-Corrector:** This scheme splits the fluid and structure solves.\n1.  **Partition System:** The fluid equations are written as $\\frac{dy_f}{dt} = B y_f + s v_s$, where $B$ is the fluid-only dynamics matrix (the upper-left $2N \\times 2N$ block of $F$) and $s$ is the coupling vector (the upper $2N$ elements of the last column of $F$).\n2.  **Fluid Predictor:** An intermediate fluid state $y_f^*$ is computed using Crank-Nicolson, treating the structure velocity as frozen at the old time step, $v_s^n$.\n3.  **Structure Corrector:** The structure velocity is updated to $v_s^{n+1}$ using Crank-Nicolson, with the structure force term averaged using the old state $y_f^n$ and the predicted state $y_f^*$.\n4.  **Fluid Corrector:** The fluid state is re-computed to its final value $y_f^{n+1}$ using Crank-Nicolson, but this time with the coupling term evaluated using the time-averaged structure velocity $\\frac{1}{2}(v_s^n + v_s^{n+1})$.\n\n### 5. Error Calculation\n\nThe final result is the Euclidean norm of the difference between the scaled state vectors obtained from the two methods. The scaling normalizes pressure by $\\rho c^2$ and velocities by $c$ to make them dimensionless. This provides a measure of the splitting error introduced by the partitioned scheme for a single time step.\n\nThe implementation will now proceed by constructing the matrix $F$, implementing both time-stepping schemes, and calculating the specified error for each test case.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function to run test cases and print results.\n    \"\"\"\n    test_cases = [\n        # N, L, rho, c, A, m, dt, p_amp\n        (20, 1.0, 1.0, 1.0, 1.0, 1.0, 0.001, 0.1),  # Test case 1\n        (20, 1.0, 1.0, 1.0, 1.0, 1.0, 0.01, 0.1),   # Test case 2\n        (20, 1.0, 1.0, 1.0, 1.0, 0.1, 0.005, 0.1),   # Test case 3\n        (4, 1.0, 1.0, 1.0, 1.0, 1.0, 0.02, 0.1),    # Test case 4\n    ]\n\n    results = []\n    for case_params in test_cases:\n        error = run_case(*case_params)\n        results.append(f\"{error:.7e}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef run_case(N, L, rho, c, A_area, m, dt, p_amp):\n    \"\"\"\n    Runs a single fluid-structure interaction simulation case.\n    \n    Args:\n        N: Number of elements\n        L: Length of the domain\n        rho: Fluid density\n        c: Speed of sound\n        A_area: Cross-sectional area\n        m: Structure mass\n        dt: Time step size\n        p_amp: Initial pressure amplitude\n        \n    Returns:\n        The computed error between monolithic and partitioned schemes.\n    \"\"\"\n    # 1. Derived constants and parameters\n    Z = rho * c\n    dx = L / N\n    k_wave = 2 * np.pi / L\n\n    # 2. Eigensplitting matrices A+ and A-\n    A_plus = (c / 2) * np.array([[1, Z], [1 / Z, 1]])\n    A_minus = (c / 2) * np.array([[-1, Z], [1 / Z, -1]])\n\n    # 3. Assemble the semi-discrete operator F\n    F = np.zeros((2 * N + 1, 2 * N + 1))\n\n    # Left boundary (i=0)\n    F0_mat = (c / 2) * np.array([[-1, -Z], [1/Z, -3]])\n    F[0, 0] = F0_mat[0, 0] / dx      # p0_dot from p0\n    F[0, N] = F0_mat[0, 1] / dx      # p0_dot from u0\n    F[N, 0] = F0_mat[1, 0] / dx      # u0_dot from p0\n    F[N, N] = F0_mat[1, 1] / dx      # u0_dot from u0\n    if N > 1:\n        F[0, 1] = -A_minus[0, 0] / dx     # p0_dot from p1\n        F[0, N+1] = -A_minus[0, 1] / dx   # p0_dot from u1\n        F[N, 1] = -A_minus[1, 0] / dx     # u0_dot from p1\n        F[N, N+1] = -A_minus[1, 1] / dx   # u0_dot from u1\n    \n    F[0, 2*N] = (c * Z) / dx         # p0_dot from v_s\n    F[N, 2*N] = c / dx               # u0_dot from v_s\n\n    # Interior cells (i = 1 to N-2)\n    for i in range(1, N - 1):\n        # Contribution to dpi/dt\n        F[i, i-1] = A_plus[0, 0] / dx\n        F[i, N+i-1] = A_plus[0, 1] / dx\n        F[i, i] = -c / dx\n        F[i, i+1] = -A_minus[0, 0] / dx\n        F[i, N+i+1] = -A_minus[0, 1] / dx\n        # Contribution to dui/dt\n        F[N+i, i-1] = A_plus[1, 0] / dx\n        F[N+i, N+i-1] = A_plus[1, 1] / dx\n        F[N+i, N+i] = -c / dx\n        F[N+i, i+1] = -A_minus[1, 0] / dx\n        F[N+i, N+i+1] = -A_minus[1, 1] / dx\n\n    # Right boundary (i=N-1)\n    if N > 1:\n        i = N - 1\n        # Contribution to dp_{N-1}/dt\n        F[i, i-1] = A_plus[0, 0] / dx\n        F[i, N+i-1] = A_plus[0, 1] / dx\n        F[i, i] = -c / dx\n        # Contribution to du_{N-1}/dt\n        F[N+i, i-1] = A_plus[1, 0] / dx\n        F[N+i, N+i-1] = A_plus[1, 1] / dx\n        F[N+i, N+i] = -c / dx\n    \n    # Structure equation\n    F[2*N, 0] = -A_area / m\n    F[2*N, N] = A_area * Z / m\n    F[2*N, 2*N] = -A_area * Z / m\n\n    # 4. Initial Condition\n    y0 = np.zeros(2 * N + 1)\n    x_centers = (np.arange(N) + 0.5) * dx\n    y0[:N] = p_amp * np.sin(k_wave * x_centers)  # p_i(0)\n\n    # 5. Monolithic Crank-Nicolson Solver\n    I_F = np.identity(2 * N + 1)\n    ML_F = I_F - (dt / 2) * F\n    MR_F = I_F + (dt / 2) * F\n    rhs_mono = MR_F @ y0\n    y_mono = np.linalg.solve(ML_F, rhs_mono)\n\n    # 6. Partitioned Predictor-Corrector Solver\n    B = F[:2*N, :2*N]\n    s_vec = F[:2*N, 2*N]\n    y_f_n = y0[:2*N]\n    v_s_n = y0[2*N]\n\n    I_B = np.identity(2*N)\n    ML_B = I_B - (dt / 2) * B\n    MR_B = I_B + (dt / 2) * B\n\n    # Fluid Predictor\n    rhs_pred = MR_B @ y_f_n + dt * s_vec * v_s_n\n    y_f_star = np.linalg.solve(ML_B, rhs_pred)\n\n    # Structure Corrector\n    alpha = (A_area * Z) / m\n    b_n = (-A_area / m) * y_f_n[0] + (A_area * Z / m) * y_f_n[N]\n    b_star = (-A_area / m) * y_f_star[0] + (A_area * Z / m) * y_f_star[N]\n    \n    num = (1 - (dt / 2) * alpha) * v_s_n + (dt / 2) * (b_n + b_star)\n    den = 1 + (dt / 2) * alpha\n    v_s_np1 = num / den\n\n    # Fluid Corrector\n    v_s_avg = 0.5 * (v_s_n + v_s_np1)\n    rhs_corr = MR_B @ y_f_n + dt * s_vec * v_s_avg\n    y_f_part = np.linalg.solve(ML_B, rhs_corr)\n    \n    y_part = np.concatenate((y_f_part, [v_s_np1]))\n\n    # 7. Error calculation\n    scaling_vec = np.zeros(2 * N + 1)\n    scaling_vec[:N] = 1 / (rho * c**2)\n    scaling_vec[N:] = 1 / c\n    \n    y_mono_scaled = y_mono * scaling_vec\n    y_part_scaled = y_part * scaling_vec\n\n    error = np.linalg.norm(y_part_scaled - y_mono_scaled)\n    \n    return error\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3379655"}]}