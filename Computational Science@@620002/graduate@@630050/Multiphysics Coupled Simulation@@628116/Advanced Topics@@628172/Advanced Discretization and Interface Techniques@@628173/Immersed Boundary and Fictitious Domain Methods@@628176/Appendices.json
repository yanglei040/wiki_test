{"hands_on_practices": [{"introduction": "At the heart of any fluid-structure interaction simulation lies a robust physical model for the structure's internal forces. This first practice grounds our computational method in fundamental continuum mechanics by deriving the elastic force exerted by a membrane directly from its potential energy. By applying the calculus of variations, you will see how the abstract concept of an energy functional translates into a concrete force expression that can be coupled to a fluid solver. [@problem_id:3510183]", "problem": "Consider a slender, closed elastic membrane represented by a continuously differentiable mapping $X : \\Gamma \\to \\mathbb{R}^{d}$, where $\\Gamma$ is a one-dimensional manifold parameterized by a Lagrangian material coordinate $s \\in [0,L)$ with periodic identification, and $d \\in \\{2,3\\}$. In the Immersed Boundary (IB) method and the Fictitious Domain (FD) method for multiphysics coupled simulation, the elastic force exerted by the membrane on the surrounding fluid is obtained as the negative variational derivative of a membrane energy with respect to the configuration $X(s)$. Suppose the membrane has a constitutive surface energy\n$$\nW[X] \\;=\\; \\int_{\\Gamma} \\frac{k_s}{2}\\,\\big(|\\partial_s X(s)| - 1\\big)^{2}\\, ds,\n$$\nwhere $k_s>0$ is a constant material stiffness, $|\\partial_s X|$ denotes the Euclidean norm of the tangent vector $\\partial_s X$, and the reference configuration corresponds to unit stretch. Using only first principles from calculus of variations and continuum mechanics, derive the elastic tension and compute the elastic force per unit reference length $F(s)$ defined by $F(s) = - \\delta W/\\delta X(s)$ explicitly in terms of $X(s)$ and its derivatives. Assume the membrane is closed and sufficiently smooth so that boundary terms vanish under integration by parts due to periodicity. Express your final answer as a single closed-form analytic expression involving $X$ and $s$. No numerical approximation is required; do not include physical units in the final expression.", "solution": "The problem statement is assessed to be valid. It is scientifically grounded in continuum mechanics and the calculus of variations, well-posed, objective, and contains all necessary information for a unique solution. We may therefore proceed with the derivation.\n\nThe elastic force per unit reference length, $F(s)$, is defined as the negative variational derivative of the potential energy functional $W[X]$ with respect to the membrane configuration $X(s)$:\n$$\nF(s) = -\\frac{\\delta W}{\\delta X(s)}\n$$\nThe variational derivative $\\frac{\\delta W}{\\delta X(s)}$ is defined by the first variation $\\delta W$ for an arbitrary virtual displacement $\\phi(s)$, which is a smooth, periodic vector field on $\\Gamma$:\n$$\n\\delta W = \\int_{\\Gamma} \\frac{\\delta W}{\\delta X(s)} \\cdot \\phi(s) \\, ds\n$$\nOur goal is to compute $\\delta W$ from the given energy functional and then use integration by parts to isolate the term corresponding to $\\frac{\\delta W}{\\delta X(s)}$.\n\nThe energy functional is given by:\n$$\nW[X] = \\int_{\\Gamma} \\frac{k_s}{2}\\,\\big(|\\partial_s X(s)| - 1\\big)^{2}\\, ds\n$$\nThe first variation is the Gâteaux derivative of $W$ in the direction of $\\phi(s)$:\n$$\n\\delta W = \\left. \\frac{d}{d\\epsilon} W[X + \\epsilon \\phi] \\right|_{\\epsilon=0}\n$$\nwhere $\\epsilon$ is a small scalar parameter. We substitute $X + \\epsilon \\phi$ into the energy functional:\n$$\nW[X + \\epsilon \\phi] = \\int_{\\Gamma} \\frac{k_s}{2} \\left( |\\partial_s (X(s) + \\epsilon \\phi(s))| - 1 \\right)^2 \\, ds = \\int_{\\Gamma} \\frac{k_s}{2} \\left( |\\partial_s X + \\epsilon \\partial_s \\phi| - 1 \\right)^2 \\, ds\n$$\nTo proceed, we perform a Taylor expansion of the term $|\\partial_s X + \\epsilon \\partial_s \\phi|$ for small $\\epsilon$. The squared norm is:\n$$\n|\\partial_s X + \\epsilon \\partial_s \\phi|^2 = (\\partial_s X + \\epsilon \\partial_s \\phi) \\cdot (\\partial_s X + \\epsilon \\partial_s \\phi) = |\\partial_s X|^2 + 2\\epsilon (\\partial_s X \\cdot \\partial_s \\phi) + O(\\epsilon^2)\n$$\nTaking the square root and using the expansion $\\sqrt{1+z} \\approx 1 + z/2$ for small $z$:\n$$\n|\\partial_s X + \\epsilon \\partial_s \\phi| = \\left( |\\partial_s X|^2 + 2\\epsilon (\\partial_s X \\cdot \\partial_s \\phi) + O(\\epsilon^2) \\right)^{1/2}\n$$\n$$\n= |\\partial_s X| \\left( 1 + 2\\epsilon \\frac{\\partial_s X \\cdot \\partial_s \\phi}{|\\partial_s X|^2} + O(\\epsilon^2) \\right)^{1/2} \\approx |\\partial_s X| \\left( 1 + \\epsilon \\frac{\\partial_s X \\cdot \\partial_s \\phi}{|\\partial_s X|^2} \\right)\n$$\n$$\n= |\\partial_s X| + \\epsilon \\frac{\\partial_s X}{|\\partial_s X|} \\cdot \\partial_s \\phi\n$$\nLet us define the local stretch ratio $\\lambda(s) = |\\partial_s X(s)|$ and the unit tangent vector $\\tau(s) = \\frac{\\partial_s X(s)}{|\\partial_s X(s)|}$. The expansion becomes:\n$$\n|\\partial_s X + \\epsilon \\partial_s \\phi| \\approx \\lambda(s) + \\epsilon (\\tau(s) \\cdot \\partial_s \\phi(s))\n$$\nSubstituting this back into the integrand for $W[X+\\epsilon\\phi]$:\n$$\n\\frac{k_s}{2} \\left( (\\lambda(s) + \\epsilon (\\tau(s) \\cdot \\partial_s \\phi(s))) - 1 \\right)^2 = \\frac{k_s}{2} \\left( (\\lambda(s) - 1) + \\epsilon(\\tau(s) \\cdot \\partial_s \\phi(s)) \\right)^2\n$$\nExpanding this and keeping only terms up to first order in $\\epsilon$:\n$$\n= \\frac{k_s}{2} \\left( (\\lambda(s) - 1)^2 + 2\\epsilon(\\lambda(s) - 1)(\\tau(s) \\cdot \\partial_s \\phi(s)) + O(\\epsilon^2) \\right)\n$$\nIntegrating this expression gives $W[X+\\epsilon\\phi]$. The first variation $\\delta W$ is the integral of the term proportional to $\\epsilon$:\n$$\n\\delta W = \\int_{\\Gamma} k_s (\\lambda(s) - 1) (\\tau(s) \\cdot \\partial_s \\phi(s)) \\, ds\n$$\nThe term $T(s) = k_s(\\lambda(s) - 1) = k_s(|\\partial_s X(s)| - 1)$ is the scalar magnitude of the elastic tension in the membrane. It is positive for stretching ($\\lambda > 1$) and negative for compression ($\\lambda < 1$). The tension vector is given by $\\mathbf{T}(s) = T(s)\\tau(s)$. Using this, the variation can be written as:\n$$\n\\delta W = \\int_{\\Gamma} \\mathbf{T}(s) \\cdot \\partial_s \\phi(s) \\, ds\n$$\nTo identify the variational derivative, we must move the derivative $\\partial_s$ from the test function $\\phi(s)$ onto the other term $\\mathbf{T}(s)$ using integration by parts. For a closed curve where all functions are periodic, the boundary terms vanish:\n$$\n\\int_{\\Gamma} \\mathbf{T}(s) \\cdot (\\partial_s \\phi(s)) \\, ds = \\left[ \\mathbf{T}(s) \\cdot \\phi(s) \\right]_0^L - \\int_{\\Gamma} (\\partial_s \\mathbf{T}(s)) \\cdot \\phi(s) \\, ds = - \\int_{\\Gamma} (\\partial_s \\mathbf{T}(s)) \\cdot \\phi(s) \\, ds\n$$\nThus, we have:\n$$\n\\delta W = - \\int_{\\Gamma} (\\partial_s \\mathbf{T}(s)) \\cdot \\phi(s) \\, ds\n$$\nBy comparing this to the definition $\\delta W = \\int_{\\Gamma} \\frac{\\delta W}{\\delta X(s)} \\cdot \\phi(s) \\, ds$, we identify the variational derivative:\n$$\n\\frac{\\delta W}{\\delta X(s)} = -\\partial_s \\mathbf{T}(s) = -\\frac{\\partial}{\\partial s} \\left( T(s) \\tau(s) \\right)\n$$\nThe elastic force density exerted by the membrane is therefore:\n$$\nF(s) = - \\frac{\\delta W}{\\delta X(s)} = - \\left(-\\partial_s \\mathbf{T}(s) \\right) = \\partial_s \\mathbf{T}(s)\n$$\nThis result is consistent with continuum mechanics, where the net internal force on a material element is the divergence of the stress tensor. In this one-dimensional case, this reduces to the derivative of the tension vector.\n\nSubstituting the explicit expressions for the tension magnitude $T(s)$ and the tangent vector $\\tau(s)$, we obtain the final expression for the force per unit reference length:\n$$\nF(s) = \\frac{\\partial}{\\partial s} \\left( k_s \\left( |\\partial_s X(s)| - 1 \\right) \\frac{\\partial_s X(s)}{|\\partial_s X(s)|} \\right)\n$$\nThis expression can also be written as:\n$$\nF(s) = \\frac{\\partial}{\\partial s} \\left( k_s \\left( 1 - \\frac{1}{|\\partial_s X(s)|} \\right) \\partial_s X(s) \\right)\n$$\nThis is the complete analytical expression for the elastic force density in terms of the membrane configuration $X(s)$ and its derivatives.", "answer": "$$\n\\boxed{\\frac{\\partial}{\\partial s} \\left( k_s \\left( |\\partial_s X(s)| - 1 \\right) \\frac{\\partial_s X(s)}{|\\partial_s X(s)|} \\right)}\n$$", "id": "3510183"}, {"introduction": "Moving from the continuous to the discrete world is a fundamental step in computational science. This exercise builds on the previous principles by showing how to calculate forces on a discretized structure, in this case, a flexible beam model represented by a chain of points. You will derive the force at each point from a discrete bending energy, revealing how local interactions between nodes give rise to global structural behavior and highlighting the connection between discrete operators and their continuum counterparts. [@problem_id:3510125]", "problem": "Consider an elastic beam represented by a one-dimensional chain of Lagrangian material points with positions $\\{X_i\\}_{i\\in \\mathbb{Z}}$, where each $X_i \\in \\mathbb{R}^d$ with $d \\in \\{2,3\\}$. The structure is coupled to a surrounding fluid via the Immersed Boundary (IB) method, wherein the structural force density is obtained from an elastic energy functional. Assume the bending energy of the discretized beam is given by\n$$\nW = \\sum_{i} \\frac{\\kappa}{2} \\left\\|X_{i+1}-2X_i+X_{i-1}\\right\\|^{2},\n$$\nwith bending stiffness $\\kappa>0$. Assume an infinite or periodic chain so that interior stencils apply without boundary corrections.\n\nStarting from the principle of virtual work, namely that the Lagrangian force at node $i$ is the negative variational derivative of the energy with respect to $X_i$, i.e., $F_i = -\\frac{\\partial W}{\\partial X_i}$, derive a closed-form expression for the assembled discrete force $F_i$ written only in terms of the positions $X_{i-2}, X_{i-1}, X_i, X_{i+1}, X_{i+2}$ and the parameter $\\kappa$. Your final answer must be a single analytic expression for $F_i$. Do not include any boundary terms. Provide the expression suitable for use in Immersed Boundary coupling as the Lagrangian force to be spread to the fluid.", "solution": "The problem statement has been validated and is found to be scientifically grounded, well-posed, objective, and self-contained. It represents a standard problem in the formulation of discrete elastic forces from a potential energy functional, commonly used in computational methods like the Immersed Boundary (IB) framework. The derivation proceeds as follows.\n\nThe problem requires the derivation of the Lagrangian force $F_i$ on the $i$-th material point from the given bending energy functional $W$. The relationship between the conservative force and the potential energy is given by the principle of virtual work, which states that the force is the negative gradient of the potential energy with respect to the position coordinate. For the material point $i$, this is expressed as:\n$$\nF_i = -\\frac{\\partial W}{\\partial X_i}\n$$\nwhere $X_i \\in \\mathbb{R}^d$ is the position vector of the $i$-th point and $\\frac{\\partial}{\\partial X_i}$ denotes the gradient operator with respect to the components of $X_i$.\n\nThe bending energy $W$ is given by the summation:\n$$\nW = \\sum_{j} \\frac{\\kappa}{2} \\left\\|X_{j+1}-2X_j+X_{j-1}\\right\\|^{2}\n$$\nHere, the summation index $j$ runs over all material points in the chain. Since the chain is specified as infinite or periodic, we do not need to consider boundary effects.\n\nTo compute the force $F_i$, we must differentiate $W$ with respect to $X_i$. The gradient operator $\\frac{\\partial}{\\partial X_i}$ can be moved inside the summation:\n$$\n\\frac{\\partial W}{\\partial X_i} = \\sum_{j} \\frac{\\partial}{\\partial X_i} \\left( \\frac{\\kappa}{2} \\left\\|X_{j+1}-2X_j+X_{j-1}\\right\\|^{2} \\right)\n$$\nA specific term in this sum is non-zero only if its argument depends on $X_i$. An examination of the expression $X_{j+1}-2X_j+X_{j-1}$ reveals that it depends on $X_i$ in three cases:\n1. When $j = i+1$, the term involves $X_{i+2}-2X_{i+1}+X_i$.\n2. When $j = i$, the term involves $X_{i+1}-2X_i+X_{i-1}$.\n3. When $j = i-1$, the term involves $X_{i}-2X_{i-1}+X_{i-2}$.\n\nFor all other values of $j$, the derivative of the summand with respect to $X_i$ is zero. Therefore, we only need to consider the sum of the derivatives of these three terms.\n\nLet us define a discrete curvature vector at node $j$ as $K_j = X_{j+1}-2X_j+X_{j-1}$. The energy functional can be written as $W = \\sum_j \\frac{\\kappa}{2} (K_j \\cdot K_j)$. We compute the gradient of each of the three relevant terms with respect to $X_i$. We use the vector calculus identity $\\frac{\\partial}{\\partial V} (\\mathbf{u} \\cdot \\mathbf{u}) = 2 \\left(\\frac{\\partial \\mathbf{u}}{\\partial V}\\right)^T \\mathbf{u}$, where $\\left(\\frac{\\partial \\mathbf{u}}{\\partial V}\\right)$ is the Jacobian matrix of the vector $\\mathbf{u}$ with respect to the vector $V$.\n\nTerm 1: Contribution from $j = i+1$.\nThe relevant energy term is $W_{i+1} = \\frac{\\kappa}{2} \\|K_{i+1}\\|^2 = \\frac{\\kappa}{2} \\|X_{i+2} - 2X_{i+1} + X_i\\|^2$.\nThe Jacobian of $K_{i+1}$ with respect to $X_i$ is $\\frac{\\partial K_{i+1}}{\\partial X_i} = \\frac{\\partial}{\\partial X_i}(X_{i+2} - 2X_{i+1} + X_i) = I$, where $I$ is the $d \\times d$ identity matrix.\nThe gradient is:\n$$\n\\frac{\\partial W_{i+1}}{\\partial X_i} = \\frac{\\kappa}{2} \\cdot 2 \\left(\\frac{\\partial K_{i+1}}{\\partial X_i}\\right)^T K_{i+1} = \\kappa I^T K_{i+1} = \\kappa K_{i+1} = \\kappa(X_{i+2} - 2X_{i+1} + X_i)\n$$\n\nTerm 2: Contribution from $j = i$.\nThe relevant energy term is $W_i = \\frac{\\kappa}{2} \\|K_i\\|^2 = \\frac{\\kappa}{2} \\|X_{i+1} - 2X_i + X_{i-1}\\|^2$.\nThe Jacobian of $K_i$ with respect to $X_i$ is $\\frac{\\partial K_i}{\\partial X_i} = \\frac{\\partial}{\\partial X_i}(X_{i+1} - 2X_i + X_{i-1}) = -2I$.\nThe gradient is:\n$$\n\\frac{\\partial W_i}{\\partial X_i} = \\frac{\\kappa}{2} \\cdot 2 \\left(\\frac{\\partial K_i}{\\partial X_i}\\right)^T K_i = \\kappa (-2I)^T K_i = -2\\kappa K_i = -2\\kappa(X_{i+1} - 2X_i + X_{i-1})\n$$\n\nTerm 3: Contribution from $j = i-1$.\nThe relevant energy term is $W_{i-1} = \\frac{\\kappa}{2} \\|K_{i-1}\\|^2 = \\frac{\\kappa}{2} \\|X_i - 2X_{i-1} + X_{i-2}\\|^2$.\nThe Jacobian of $K_{i-1}$ with respect to $X_i$ is $\\frac{\\partial K_{i-1}}{\\partial X_i} = \\frac{\\partial}{\\partial X_i}(X_i - 2X_{i-1} + X_{i-2}) = I$.\nThe gradient is:\n$$\n\\frac{\\partial W_{i-1}}{\\partial X_i} = \\frac{\\kappa}{2} \\cdot 2 \\left(\\frac{\\partial K_{i-1}}{\\partial X_i}\\right)^T K_{i-1} = \\kappa I^T K_{i-1} = \\kappa K_{i-1} = \\kappa(X_i - 2X_{i-1} + X_{i-2})\n$$\n\nThe total gradient $\\frac{\\partial W}{\\partial X_i}$ is the sum of these three contributions:\n$$\n\\frac{\\partial W}{\\partial X_i} = \\frac{\\partial W_{i+1}}{\\partial X_i} + \\frac{\\partial W_i}{\\partial X_i} + \\frac{\\partial W_{i-1}}{\\partial X_i}\n$$\n$$\n\\frac{\\partial W}{\\partial X_i} = \\kappa(X_{i+2} - 2X_{i+1} + X_i) - 2\\kappa(X_{i+1} - 2X_i + X_{i-1}) + \\kappa(X_i - 2X_{i-1} + X_{i-2})\n$$\nNow, we collect terms based on the position vectors $X_k$:\n- Coefficient of $X_{i+2}$: $\\kappa$\n- Coefficient of $X_{i+1}$: $-2\\kappa - 2\\kappa = -4\\kappa$\n- Coefficient of $X_{i}$: $\\kappa + 4\\kappa + \\kappa = 6\\kappa$\n- Coefficient of $X_{i-1}$: $-2\\kappa - 2\\kappa = -4\\kappa$\n- Coefficient of $X_{i-2}$: $\\kappa$\n\nAssembling these terms gives the expression for the gradient:\n$$\n\\frac{\\partial W}{\\partial X_i} = \\kappa (X_{i+2} - 4X_{i+1} + 6X_i - 4X_{i-1} + X_{i-2})\n$$\nThis structure is recognizable as a discrete analogue of the fourth derivative operator (biharmonic operator), which is consistent with the physics of an Euler-Bernoulli beam where the restoring force is proportional to the fourth derivative of the displacement.\n\nFinally, the force $F_i$ is the negative of this gradient:\n$$\nF_i = -\\frac{\\partial W}{\\partial X_i} = -\\kappa (X_{i+2} - 4X_{i+1} + 6X_i - 4X_{i-1} + X_{i-2})\n$$\nThis is the closed-form expression for the force on particle $i$ as a function of the positions of its neighbors.", "answer": "$$\n\\boxed{-\\kappa (X_{i+2} - 4X_{i+1} + 6X_i - 4X_{i-1} + X_{i-2})}\n$$", "id": "3510125"}, {"introduction": "This final practice transitions from theoretical derivation to a full-scale numerical experiment, addressing a crucial challenge in the Immersed Boundary Method: numerical 'leakage'. You will implement the complete IB coupling cycle—spreading forces to a fluid grid, solving the fluid equations, and interpolating velocities back to the structure—to quantify the spurious volume change that can arise from discretization. This exercise highlights the practical importance of choosing appropriate numerical parameters, such as the kernel function and grid spacing, to ensure the physical fidelity of your simulation. [@problem_id:3510140]", "problem": "Consider a two-dimensional, periodic square domain described by the interval $[0,1]\\times[0,1]$ discretized on a uniform Cartesian grid with $N$ points per direction and grid spacing $h=1/N$. A closed elastic boundary is represented by a circular membrane of radius $R$ centered at $(0.5,0.5)$, discretized by $N_{\\mathrm{L}}$ equally spaced Lagrangian points with angular parametrization $\\theta_i = 2\\pi i/N_{\\mathrm{L}}$ (angles specified in radians). Assume a uniform pressure jump $\\Delta p$ across the membrane, causing a normal traction per unit length equal to $\\Delta p\\,\\mathbf{n}$ on the membrane, where $\\mathbf{n}$ is the outward unit normal.\n\nIn the Immersed Boundary Method (IBM), Lagrangian-to-Eulerian coupling uses a regularized Dirac delta to spread the membrane traction from Lagrangian points $(X_i)$ to the Eulerian grid, and to interpolate the Eulerian velocity back to the Lagrangian points. Specifically, define the regularized delta as\n$$\n\\delta_h(\\mathbf{x})=\\frac{1}{h^2}\\,\\phi\\left(\\frac{x}{h}\\right)\\,\\phi\\left(\\frac{y}{h}\\right),\n$$\nwith a compactly supported one-dimensional kernel $\\phi(\\cdot)$ chosen from a set of candidates. The Eulerian force density is then\n$$\n\\mathbf{F}(\\mathbf{x})=\\sum_{i=0}^{N_{\\mathrm{L}}-1} \\Delta p\\,\\mathbf{n}_i\\,\\delta_h(\\mathbf{x}-\\mathbf{X}_i)\\,ds,\n$$\nwhere $ds = 2\\pi R/N_{\\mathrm{L}}$ is the segment length. The Eulerian velocity $\\mathbf{u}$ is governed by the steady Stokes equations in the absence of inertial effects,\n$$\n-\\nabla p + \\mu \\Delta \\mathbf{u} + \\mathbf{F} = \\mathbf{0},\\qquad \\nabla\\cdot\\mathbf{u} = 0,\n$$\nwith dynamic viscosity $\\mu$ and periodic boundary conditions. The unique solenoidal solution for $\\mathbf{u}$ on this periodic domain can be expressed spectrally using the Fast Fourier Transform (FFT), projecting the forcing onto the divergence-free subspace and dividing by the Laplacian eigenvalue, for all nonzero wavenumbers.\n\nThe Lagrangian velocity $\\mathbf{U}_i$ is obtained by interpolation,\n$$\n\\mathbf{U}_i = \\sum_{\\text{grid }\\mathbf{x}} \\mathbf{u}(\\mathbf{x}) \\,\\delta_h(\\mathbf{X}_i - \\mathbf{x})\\,h^2,\n$$\nand the area flux across the membrane (which, in two dimensions, corresponds to the volumetric rate of change per unit depth) is computed by the line integral of the normal velocity,\n$$\n\\frac{dA}{dt} = \\oint_{\\Gamma} \\mathbf{u}\\cdot\\mathbf{n}\\,ds \\approx \\sum_{i=0}^{N_{\\mathrm{L}}-1} \\mathbf{U}_i\\cdot\\mathbf{n}_i\\,ds.\n$$\nIn the continuum, for an incompressible flow ($\\nabla\\cdot\\mathbf{u}=0$) enclosing a material volume, the area change rate $dA/dt$ would be identically zero by the divergence theorem. However, in the discrete Immersed Boundary Method, $dA/dt$ may be nonzero due to the mismatch between spreading and interpolation induced by the choice of kernel $\\phi(\\cdot)$ and the Lagrangian spacing relative to the Eulerian grid. This spurious nonzero $dA/dt$ is known as leakage.\n\nYour task is to implement a program that:\n- Discretizes the membrane as described.\n- Spreads the uniform pressure traction using a selected regularized delta kernel.\n- Solves the steady Stokes equations on the periodic domain using spectral projection.\n- Interpolates velocities back to the membrane.\n- Computes the area change rate $dA/dt$ as described.\n\nYou must treat all quantities in dimensionless form. Angles must be in radians. For kernel $\\phi(\\cdot)$, you must support at least the following choices:\n- Peskin four-point kernel (Immersed Boundary Method kernel):\n$$\n\\phi(r)=\\begin{cases}\n\\frac{1}{8}\\left(3-2|r|+\\sqrt{1+4|r|-4r^2}\\right), & |r|<1,\\\\[6pt]\n\\frac{1}{8}\\left(5-2|r|-\\sqrt{-7+12|r|-4r^2}\\right), & 1\\le |r|<2,\\\\[6pt]\n0, & \\text{otherwise,}\n\\end{cases}\n$$\n- Cardinal cubic B-spline:\n$$\n\\phi(r)=\\begin{cases}\n\\frac{1}{6}\\left(4-6|r|^2+3|r|^3\\right), & |r|<1,\\\\[6pt]\n\\frac{1}{6}\\left(2-|r|\\right)^3, & 1\\le |r|<2,\\\\[6pt]\n0, & \\text{otherwise.}\n\\end{cases}\n$$\n\nFor all computations, set $N=64$, $h=1/N$, $R=0.25$, $\\mu=1$. Define the Lagrangian spacing ratio $s=ds/h$ and determine $N_{\\mathrm{L}}$ from $s$ via $N_{\\mathrm{L}} = \\left\\lfloor \\frac{2\\pi R}{s\\,h} \\right\\rfloor$, with the constraint $N_{\\mathrm{L}}\\ge 8$. Use the outward normal $\\mathbf{n}_i=[\\cos\\theta_i,\\sin\\theta_i]$. The wavenumbers for FFT-based differentiation must be $k_x=2\\pi\\,\\mathrm{freq}_x$ and $k_y=2\\pi\\,\\mathrm{freq}_y$, where $\\mathrm{freq}$ are the standard discrete Fourier frequencies for spacing $h$.\n\nDesign your code to compute $dA/dt$ for the following test suite of parameter sets, each specified by the pair $(\\text{kernel},s)$ and the pressure jump $\\Delta p$:\n- Case $1$: $(\\text{peskin4},\\,s=1.0)$ with $\\Delta p=1$.\n- Case $2$: $(\\text{peskin4},\\,s=0.5)$ with $\\Delta p=1$.\n- Case $3$: $(\\text{peskin4},\\,s=2.0)$ with $\\Delta p=1$.\n- Case $4$: $(\\text{bspline3},\\,s=1.0)$ with $\\Delta p=1$.\n- Case $5$: $(\\text{bspline3},\\,s=0.5)$ with $\\Delta p=1$.\n- Case $6$: $(\\text{bspline3},\\,s=2.0)$ with $\\Delta p=1$.\n- Case $7$ (edge case): $(\\text{peskin4},\\,s=1.0)$ with $\\Delta p=0$.\n\nYour program must produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the cases $1$ through $7$, where each result is the computed $dA/dt$ as a float. Because all quantities are dimensionless, do not attach any physical units to the outputs. The angle unit is radians; all outputs must be decimal floats. The output format must be exactly\n$$\n[\\text{result}_1,\\text{result}_2,\\ldots,\\text{result}_7],\n$$\nwith each $\\text{result}_i$ a float value.", "solution": "The problem is deemed valid as it is scientifically grounded in the principles of computational fluid dynamics, specifically the Immersed Boundary Method (IBM), and is a well-posed numerical problem with a complete and consistent set of givens. The task involves simulating fluid-structure interaction to quantify a known numerical artifact, \"leakage,\" which arises from the discretization and choice of coupling kernels.\n\nThe solution proceeds by implementing the described numerical method step-by-step for each test case.\n\n**1. Discretization of Domain and Boundary**\n\nThe physical setup consists of a two-dimensional periodic domain $\\Omega = [0,1] \\times [0,1]$ and a circular membrane $\\Gamma$ of radius $R=0.25$ centered at $(0.5, 0.5)$.\n\n- **Eulerian Grid**: The domain $\\Omega$ is discretized into a uniform Cartesian grid of $N \\times N$ points, with $N=64$. The grid spacing is $h = 1/N = 1/64$. The grid points are located at $\\mathbf{x}_{j,k} = (j h, k h)$ for $j,k \\in \\{0, 1, \\dots, N-1\\}$.\n\n- **Lagrangian Grid**: The membrane $\\Gamma$ is discretized into $N_{\\mathrm{L}}$ Lagrangian points. The number of points, $N_{\\mathrm{L}}$, is determined by the Lagrangian spacing ratio $s = ds/h$, where $ds$ is the arc length between adjacent Lagrangian points. The formula is $N_{\\mathrm{L}} = \\lfloor \\frac{2\\pi R}{s h} \\rfloor$. The arc length is then re-calculated as $ds = 2\\pi R/N_{\\mathrm{L}}$ to ensure the discretized loop is closed. The positions of the Lagrangian points are given by a parametrization in terms of angle $\\theta_i = 2\\pi i/N_{\\mathrm{L}}$ for $i \\in \\{0, 1, \\dots, N_{\\mathrm{L}}-1\\}$:\n$$\n\\mathbf{X}_i = (0.5 + R\\cos\\theta_i, 0.5 + R\\sin\\theta_i)\n$$\nThe outward unit normal vector at each point $\\mathbf{X}_i$ is $\\mathbf{n}_i = (\\cos\\theta_i, \\sin\\theta_i)$.\n\n**2. Kernels and Regularized Delta Function**\n\nThe interaction between the fluid (Eulerian) and the structure (Lagrangian) is mediated by a regularized Dirac delta function, $\\delta_h(\\mathbf{x})$, constructed from a one-dimensional kernel $\\phi(r)$. Two specified kernels, the Peskin 4-point kernel and the cubic B-spline, are implemented according to their piecewise definitions. Both kernels have a compact support of $4h$, meaning $\\phi(r)=0$ for $|r| \\ge 2$.\n\n**3. Spreading: From Lagrangian Force to Eulerian Force Density**\n\nA uniform pressure jump $\\Delta p$ across the membrane generates a normal force per unit length (traction) equal to $\\Delta p \\, \\mathbf{n}$. The discrete force at each Lagrangian point $\\mathbf{X}_i$ is $\\mathbf{f}_i = \\Delta p \\, \\mathbf{n}_i \\, ds$.\n\nThis Lagrangian force is \"spread\" onto the surrounding Eulerian grid points to obtain the Eulerian force density field, $\\mathbf{F}(\\mathbf{x})$. The formula for this spreading operation is:\n$$\n\\mathbf{F}(\\mathbf{x}) = \\sum_{i=0}^{N_{\\mathrm{L}}-1} \\mathbf{f}_i \\, \\delta_h(\\mathbf{x} - \\mathbf{X}_i) = \\frac{1}{h^2} \\sum_{i=0}^{N_{\\mathrm{L}}-1} (\\Delta p \\, \\mathbf{n}_i \\, ds) \\, \\phi\\left(\\frac{x-X_{i,x}}{h}\\right) \\phi\\left(\\frac{y-X_{i,y}}{h}\\right)\n$$\nNumerically, for each Lagrangian point $\\mathbf{X}_i$, we identify the nearby Eulerian grid points $\\mathbf{x}_{j,k}$ that fall within the kernel's support. The force contribution is then calculated and added to the corresponding elements of the Eulerian force arrays, `Fx` and `Fy`. Due to the periodic domain, distances are computed considering the wrap-around nature of the grid.\n\n**4. Solving the Steady Stokes Equations**\n\nThe fluid velocity $\\mathbf{u}$ and pressure $p$ are governed by the steady Stokes equations with periodic boundary conditions:\n$$\n-\\nabla p + \\mu \\Delta \\mathbf{u} + \\mathbf{F} = \\mathbf{0}, \\qquad \\nabla\\cdot\\mathbf{u} = 0\n$$\nGiven the periodicity, these equations are efficiently solved in Fourier space. Applying the Fast Fourier Transform (FFT) to the equations yields:\n$$\n-i\\mathbf{k}\\hat{p} - \\mu |\\mathbf{k}|^2 \\hat{\\mathbf{u}} + \\hat{\\mathbf{F}} = \\mathbf{0}, \\qquad i\\mathbf{k}\\cdot\\hat{\\mathbf{u}} = 0\n$$\nwhere $\\hat{\\cdot}$ denotes the Fourier transform, $\\mathbf{k}=(k_x, k_y)$ is the wavevector, and $|\\mathbf{k}|^2=k_x^2+k_y^2$. The wavenumbers are determined by $k = 2\\pi f$, where $f$ are the discrete frequencies from `scipy.fft.fftfreq`.\n\nThe incompressibility condition ($i\\mathbf{k}\\cdot\\hat{\\mathbf{u}} = 0$) implies that the velocity vector $\\hat{\\mathbf{u}}$ is orthogonal to the wavevector $\\mathbf{k}$. By projecting the momentum equation onto the divergence-free subspace, we can solve for $\\hat{\\mathbf{u}}$ directly:\n$$\n\\hat{\\mathbf{u}}(\\mathbf{k}) = \\frac{1}{\\mu |\\mathbf{k}|^2} \\left( \\hat{\\mathbf{F}} - \\frac{(\\mathbf{k} \\cdot \\hat{\\mathbf{F}})\\mathbf{k}}{|\\mathbf{k}|^2} \\right) \\quad \\text{for } \\mathbf{k} \\neq \\mathbf{0}\n$$\nFor the zero-wavenumber mode ($\\mathbf{k}=\\mathbf{0}$), $\\hat{\\mathbf{u}}(\\mathbf{0})$ is set to zero, corresponding to zero mean velocity. The resulting velocity field in Fourier space, $(\\hat{u}_x, \\hat{u}_y)$, is transformed back to real space using the inverse FFT to obtain the Eulerian velocity field $(u_x, u_y)$.\n\n**5. Interpolation: From Eulerian Velocity to Lagrangian Velocity**\n\nThe velocity of the membrane points, $\\mathbf{U}_i$, is obtained by interpolating the Eulerian velocity field $\\mathbf{u}(\\mathbf{x})$ at the Lagrangian locations $\\mathbf{X}_i$. This operation is the adjoint of the spreading operation:\n$$\n\\mathbf{U}_i = \\sum_{\\text{grid }\\mathbf{x}} \\mathbf{u}(\\mathbf{x}) \\, \\delta_h(\\mathbf{X}_i - \\mathbf{x}) \\, h^2 = \\sum_{\\text{grid }\\mathbf{x}} \\mathbf{u}(\\mathbf{x}) \\, \\phi\\left(\\frac{X_{i,x}-x}{h}\\right) \\phi\\left(\\frac{Y_{i,y}-y}{h}\\right)\n$$\nNumerically, for each Lagrangian point $\\mathbf{X}_i$, we again identify the nearby Eulerian grid points and compute a weighted sum of their velocities to find $\\mathbf{U}_i$.\n\n**6. Computation of Area Change Rate ($dA/dt$)**\n\nFinally, the rate of change of the area enclosed by the membrane, a measure of numerical leakage, is computed by approximating the line integral of the normal velocity along the boundary:\n$$\n\\frac{dA}{dt} = \\oint_{\\Gamma} \\mathbf{u}\\cdot\\mathbf{n}\\,ds \\approx \\sum_{i=0}^{N_{\\mathrm{L}}-1} \\mathbf{U}_i\\cdot\\mathbf{n}_i\\,ds\n$$\nThis value is computed for each test case specified in the problem. The case with $\\Delta p = 0$ serves as a null test, as it should yield zero force, zero velocity, and therefore zero leakage, confirming the linearity and correctness of the base implementation.", "answer": "```python\nimport numpy as np\nimport scipy.fft\n\ndef peskin4_kernel(r):\n    \"\"\"\n    Computes the Peskin 4-point regularized delta function kernel.\n    \"\"\"\n    r_abs = np.abs(r)\n    val = np.zeros_like(r_abs)\n    \n    # |r| < 1\n    mask1 = r_abs < 1\n    r1 = r_abs[mask1]\n    val[mask1] = (1/8) * (3 - 2*r1 + np.sqrt(1 + 4*r1 - 4*r1**2))\n    \n    # 1 <= |r| < 2\n    mask2 = (r_abs >= 1) & (r_abs < 2)\n    r2 = r_abs[mask2]\n    # Ensure argument of sqrt is non-negative due to float precision issues\n    sqrt_arg = -7 + 12*r2 - 4*r2**2\n    sqrt_arg[sqrt_arg < 0] = 0.0\n    val[mask2] = (1/8) * (5 - 2*r2 - np.sqrt(sqrt_arg))\n\n    return val\n\ndef bspline3_kernel(r):\n    \"\"\"\n    Computes the cardinal cubic B-spline kernel.\n    \"\"\"\n    r_abs = np.abs(r)\n    val = np.zeros_like(r_abs)\n    \n    # |r| < 1\n    mask1 = r_abs < 1\n    r1 = r_abs[mask1]\n    val[mask1] = (1/6) * (4 - 6*r1**2 + 3*r1**3)\n\n    # 1 <= |r| < 2\n    mask2 = (r_abs >= 1) & (r_abs < 2)\n    r2 = r_abs[mask2]\n    val[mask2] = (1/6) * (2 - r2)**3\n    \n    return val\n\ndef compute_leakage(kernel_name, s, dp):\n    \"\"\"\n    Computes the area change rate (dA/dt) for the given parameters.\n    \"\"\"\n    # System parameters\n    N = 64\n    R = 0.25\n    mu = 1.0\n    h = 1.0 / N\n\n    # Select the kernel function\n    kernels = {'peskin4': peskin4_kernel, 'bspline3': bspline3_kernel}\n    kernel_func = kernels[kernel_name]\n\n    # Lagrangian boundary discretization\n    N_L = int(np.floor(2 * np.pi * R / (s * h)))\n    ds = 2 * np.pi * R / N_L\n    theta = 2 * np.pi * np.arange(N_L) / N_L\n    \n    X_lag = 0.5 + R * np.cos(theta)\n    Y_lag = 0.5 + R * np.sin(theta)\n    nx = np.cos(theta)\n    ny = np.sin(theta)\n\n    # Sanity check: if pressure jump is zero, leakage must be zero\n    if dp == 0:\n        return 0.0\n\n    # --- Step 1: Spreading (Lagrangian force to Eulerian grid) ---\n    Fx = np.zeros((N, N))\n    Fy = np.zeros((N, N))\n    \n    for i in range(N_L):\n        lag_force_x = dp * nx[i] * ds\n        lag_force_y = dp * ny[i] * ds\n        \n        sx = X_lag[i] / h\n        sy = Y_lag[i] / h\n        \n        j_base = int(np.floor(sx))\n        k_base = int(np.floor(sy))\n\n        for dj in range(-1, 3):\n            for dk in range(-1, 3):\n                j = j_base + dj\n                k = k_base + dk\n                \n                rx = sx - j\n                ry = sy - k\n                \n                j_idx, k_idx = j % N, k % N\n                \n                weight = kernel_func(rx) * kernel_func(ry) / h**2\n                \n                Fx[k_idx, j_idx] += lag_force_x * weight\n                Fy[k_idx, j_idx] += lag_force_y * weight\n\n    # --- Step 2: Solve steady Stokes equations in Fourier space ---\n    Fx_hat = scipy.fft.fft2(Fx)\n    Fy_hat = scipy.fft.fft2(Fy)\n\n    freq = scipy.fft.fftfreq(N, h)\n    kx = 2 * np.pi * freq\n    Ky, Kx = np.meshgrid(kx, kx, indexing='ij')\n\n    Ksq = Kx**2 + Ky**2\n    \n    inv_Ksq = np.zeros_like(Ksq)\n    nonzero_mask = Ksq != 0\n    inv_Ksq[nonzero_mask] = 1.0 / Ksq[nonzero_mask]\n    \n    k_dot_Fhat = Kx * Fx_hat + Ky * Fy_hat\n    \n    Fx_hat_solenoidal = Fx_hat - Kx * k_dot_Fhat * inv_Ksq\n    Fy_hat_solenoidal = Fy_hat - Ky * k_dot_Fhat * inv_Ksq\n    \n    ux_hat = Fx_hat_solenoidal * inv_Ksq / mu\n    uy_hat = Fy_hat_solenoidal * inv_Ksq / mu\n\n    ux = np.real(scipy.fft.ifft2(ux_hat))\n    uy = np.real(scipy.fft.ifft2(uy_hat))\n\n    # --- Step 3: Interpolation (Eulerian velocity to Lagrangian points) ---\n    Ux = np.zeros(N_L)\n    Uy = np.zeros(N_L)\n\n    for i in range(N_L):\n        sx = X_lag[i] / h\n        sy = Y_lag[i] / h\n        \n        j_base = int(np.floor(sx))\n        k_base = int(np.floor(sy))\n\n        for dj in range(-1, 3):\n            for dk in range(-1, 3):\n                j = j_base + dj\n                k = k_base + dk\n                \n                rx = sx - j\n                ry = sy - k\n                \n                j_idx, k_idx = j % N, k % N\n                \n                weight = kernel_func(rx) * kernel_func(ry)\n                \n                Ux[i] += ux[k_idx, j_idx] * weight\n                Uy[i] += uy[k_idx, j_idx] * weight\n                \n    # --- Step 4: Calculate Area Change Rate (Leakage) ---\n    dAdt = np.sum((Ux * nx + Uy * ny)) * ds\n    \n    return dAdt\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # (kernel_name, spacing_ratio_s, pressure_jump_dp)\n        ('peskin4', 1.0, 1.0),\n        ('peskin4', 0.5, 1.0),\n        ('peskin4', 2.0, 1.0),\n        ('bspline3', 1.0, 1.0),\n        ('bspline3', 0.5, 1.0),\n        ('bspline3', 2.0, 1.0),\n        ('peskin4', 1.0, 0.0), # Edge case\n    ]\n\n    results = []\n    for kernel_name, s, dp in test_cases:\n        result = compute_leakage(kernel_name, s, dp)\n        results.append(result)\n\n    # Format output as a comma-separated list of floats in brackets\n    print(f\"[{','.join(f'{r:.12e}' for r in results)}]\")\n\nsolve()\n```", "id": "3510140"}]}