{"hands_on_practices": [{"introduction": "A crucial challenge in simulating plasmas is the wide range of time scales involved. This practice explores how certain physical phenomena, like the whistler waves governed by the Hall effect, can impose severe restrictions on the time step size for explicit numerical methods [@problem_id:3522825]. By deriving the whistler dispersion relation and analyzing the stability of an explicit Runge-Kutta scheme, you will discover the infamous $\\Delta t \\propto (\\Delta x)^2$ scaling and appreciate why implicit-explicit (IMEX) methods are essential for efficiently modeling such multi-scale problems.", "problem": "Consider the single-fluid magnetohydrodynamic system with the Hall effect included through the generalized Ohm’s law. Work in a non-relativistic, quasi-neutral, magnetized plasma with constant ion number density $n$ and ion mass $m_i$. Let $\\mathbf{B}$ denote the magnetic field, $\\mathbf{u}$ the bulk ion velocity, $\\mathbf{J}$ the current density, $\\mu_0$ the vacuum permeability, and $e$ the elementary charge. The governing relations are the following fundamental laws and standard constitutive relations: Faraday’s law $\\partial_t \\mathbf{B} = -\\nabla \\times \\mathbf{E}$, Ampère’s law without displacement current $\\mathbf{J} = \\nabla \\times \\mathbf{B}/\\mu_0$, and the generalized Ohm’s law (neglecting electron pressure and resistivity) $\\mathbf{E} + \\mathbf{u} \\times \\mathbf{B} = \\left(\\mathbf{J} \\times \\mathbf{B}\\right)/(n e)$. Combining these gives the induction equation\n$$\n\\partial_t \\mathbf{B} = \\nabla \\times \\left( \\mathbf{u} \\times \\mathbf{B} \\right) - \\nabla \\times \\left( \\frac{\\mathbf{J} \\times \\mathbf{B}}{n e} \\right),\n$$\nwhere $\\mathbf{J} = \\nabla \\times \\mathbf{B}/\\mu_0$. Define the Alfvén speed $v_A = B_0/\\sqrt{\\mu_0 n m_i}$ for a uniform background magnetic field of magnitude $B_0 = \\|\\mathbf{B}_0\\|$, and the ion skin depth $d_i = \\sqrt{m_i/(\\mu_0 n e^2)}$. Consider small-amplitude, one-dimensional perturbations with wavevector parallel to the uniform background field and study the linear whistler mode governed by the Hall term in the induction equation. Using only the above fundamental laws and definitions, and making a linear, plane-wave ansatz, you must:\n1) Derive the whistler-mode dispersion relation in physical (SI) units for the Hall-magnetohydrodynamic limit described above, in the form $\\omega = C \\, k^2$ where $C$ must be expressed in terms of $B_0$, $n$, $e$, and $\\mu_0$ (and show how it also equals $v_A d_i$).\n2) Consider time advancement of a linear oscillatory mode $\\partial_t q = i \\omega q$ using the classical fourth-order explicit Runge–Kutta method. Derive the scalar amplification factor and determine, in terms of the dimensionless parameter $z = i \\omega \\Delta t$, the largest positive value $\\alpha_\\star$ such that the scheme is power-bounded for purely imaginary $z = i \\alpha$ with $0 \\le \\alpha \\le \\alpha_\\star$. Your derivation must be from first principles starting from the Runge–Kutta update. Then write the explicit stability constraint for the time step $\\Delta t_{\\mathrm{exp}}$ imposed by the whistler dispersion at a given maximum resolved wavenumber $k_{\\max}$ on a uniform grid of spacing $\\Delta x$.\n3) Propose an implicit–explicit (IMEX) time discretization for the induction equation in which the Hall term $\\nabla \\times \\left((\\mathbf{J} \\times \\mathbf{B})/(n e)\\right)$ is treated implicitly while the advection term $\\nabla \\times (\\mathbf{u} \\times \\mathbf{B})$ is treated explicitly. Your IMEX scheme must be second-order accurate in time for the Hall term and first-order accurate for the explicit advection. Present the discrete update for $\\mathbf{B}^{n+1}$ from $\\mathbf{B}^n$ under the assumption that $\\mathbf{u}$ is a given, time-independent field. In the linear, constant-coefficient limit around $\\mathbf{B}_0$, analyze the unconditional energy stability of the implicit Hall substep and show which remaining constraint limits the IMEX time step.\n4) On a periodic, one-dimensional domain of length $L$ resolved by $N$ uniformly spaced cells, use $k_{\\max} = \\pi/\\Delta x$ with $\\Delta x = L/N$ for the maximum resolvable wavenumber. For the explicit scheme in item $2$, the most restrictive whistler time step is $\\Delta t_{\\mathrm{exp}}$ set by the highest wavenumber. For the IMEX scheme in item $3$, assume the Hall contribution is treated by a Crank–Nicolson implicit step and is energy stable, so the remaining time step constraint comes from the explicit advection term with a Courant–Friedrichs–Lewy (CFL) number $\\mathrm{CFL}_{\\mathrm{adv}}$, namely\n$$\n\\Delta t_{\\mathrm{IMEX}} = \\mathrm{CFL}_{\\mathrm{adv}} \\frac{\\Delta x}{U},\n$$\nwhere $U = \\|\\mathbf{u}\\|$ is a given constant advection speed. Express all time steps in seconds, rounded by your program as floating-point numbers.\nYour program must compute, for each test case, the pair $[\\Delta t_{\\mathrm{exp}}, \\Delta t_{\\mathrm{IMEX}}]$ using the derivations you provide, with all quantities in SI units. Use the following physical constants in SI units inside your program: $\\mu_0 = 4 \\pi \\times 10^{-7}$, $e = 1.602176634 \\times 10^{-19}$. Use proton mass $m_p = 1.67262192369 \\times 10^{-27}$ as a reference when needed.\n\nTest suite (each case is $(L, N, B_0, n, m_i, U, \\mathrm{CFL}_{\\mathrm{adv}})$):\n- Case A (general regime): $L = 1.0$, $N = 256$, $B_0 = 0.1$, $n = 10^{19}$, $m_i = m_p$, $U = 10^{4}$, $\\mathrm{CFL}_{\\mathrm{adv}} = 0.5$.\n- Case B (grid-refined boundary): $L = 1.0$, $N = 4096$, $B_0 = 0.1$, $n = 10^{19}$, $m_i = m_p$, $U = 10^{4}$, $\\mathrm{CFL}_{\\mathrm{adv}} = 0.5$.\n- Case C (ion-mass variation): $L = 1.0$, $N = 256$, $B_0 = 0.1$, $n = 10^{19}$, $m_i = 4 m_p$, $U = 10^{4}$, $\\mathrm{CFL}_{\\mathrm{adv}} = 0.5$.\n- Case D (low density edge): $L = 1.0$, $N = 256$, $B_0 = 0.1$, $n = 10^{17}$, $m_i = m_p$, $U = 10^{4}$, $\\mathrm{CFL}_{\\mathrm{adv}} = 0.5$.\n\nRequired final output format: Your program should produce a single line of output containing the results as a list of lists in scientific notation with twelve significant digits per number, in the exact form\n$[\\,[\\Delta t_{\\mathrm{exp}}^{(A)},\\Delta t_{\\mathrm{IMEX}}^{(A)}],\\,[\\Delta t_{\\mathrm{exp}}^{(B)},\\Delta t_{\\mathrm{IMEX}}^{(B)}],\\,[\\Delta t_{\\mathrm{exp}}^{(C)},\\Delta t_{\\mathrm{IMEX}}^{(C)}],\\,[\\Delta t_{\\mathrm{exp}}^{(D)},\\Delta t_{\\mathrm{IMEX}}^{(D)}]\\,]$,\nwith no spaces. All time steps must be in seconds.", "solution": "The problem is validated as scientifically grounded, well-posed, and objective. All necessary information is provided, and the tasks are logically structured, non-trivial, and pertain directly to computational plasma physics. We proceed with the solution.\n\n### Part 1: Whistler-Mode Dispersion Relation\n\nThe problem asks for the dispersion relation of the whistler mode, which arises from the Hall term in the induction equation. The governing equation, neglecting the fluid advection term $(\\mathbf{u} \\times \\mathbf{B})$ as is standard for studying these electron-MHD waves, is:\n$$\n\\partial_t \\mathbf{B} = - \\nabla \\times \\left( \\frac{\\mathbf{J} \\times \\mathbf{B}}{n e} \\right)\n$$\nWe substitute Ampère's law, $\\mathbf{J} = (\\nabla \\times \\mathbf{B}) / \\mu_0$, into this equation:\n$$\n\\partial_t \\mathbf{B} = - \\frac{1}{n e \\mu_0} \\nabla \\times \\left( (\\nabla \\times \\mathbf{B}) \\times \\mathbf{B} \\right)\n$$\nWe linearize this equation for small-amplitude perturbations $\\delta\\mathbf{B}$ around a uniform, static background magnetic field $\\mathbf{B}_0$. Let $\\mathbf{B} = \\mathbf{B}_0 + \\delta\\mathbf{B}$. Since $\\mathbf{B}_0$ is constant, $\\nabla \\times \\mathbf{B}_0 = 0$. The linearized equation is:\n$$\n\\partial_t \\delta\\mathbf{B} = - \\frac{1}{n e \\mu_0} \\nabla \\times \\left( (\\nabla \\times \\delta\\mathbf{B}) \\times \\mathbf{B}_0 \\right)\n$$\nWe adopt a plane-wave ansatz for the perturbation, $\\delta\\mathbf{B} \\propto \\exp(i(\\mathbf{k} \\cdot \\mathbf{r} - \\omega t))$. With this form, the operators $\\partial_t$ and $\\nabla$ transform to algebraic multipliers: $\\partial_t \\rightarrow -i\\omega$ and $\\nabla \\rightarrow i\\mathbf{k}$. The linearized equation becomes:\n$$\n-i\\omega \\delta\\mathbf{B} = - \\frac{1}{n e \\mu_0} (i\\mathbf{k}) \\times \\left( (i\\mathbf{k} \\times \\delta\\mathbf{B}) \\times \\mathbf{B}_0 \\right)\n$$\nThe problem specifies that the wavevector $\\mathbf{k}$ is parallel to the background field $\\mathbf{B}_0$. Let us align our coordinate system such that $\\mathbf{B}_0 = B_0 \\hat{z}$ and $\\mathbf{k} = k \\hat{z}$. The equation simplifies to:\n$$\n-i\\omega \\delta\\mathbf{B} = - \\frac{i k}{n e \\mu_0} \\hat{z} \\times \\left( (i k \\hat{z} \\times \\delta\\mathbf{B}) \\times (B_0 \\hat{z}) \\right)\n$$\nUsing the vector triple product identity $\\mathbf{A} \\times (\\mathbf{B} \\times \\mathbf{C}) = \\mathbf{B}(\\mathbf{A} \\cdot \\mathbf{C}) - \\mathbf{C}(\\mathbf{A} \\cdot \\mathbf{B})$, we expand the term in the parentheses:\n$$\n(i k \\hat{z} \\times \\delta\\mathbf{B}) \\times (B_0 \\hat{z}) = (i k \\hat{z}) \\left( (\\hat{z} \\times \\delta\\mathbf{B}) \\cdot (B_0 \\hat{z}) \\right) - (B_0 \\hat{z}) \\left( (\\hat{z} \\times \\delta\\mathbf{B}) \\cdot (i k \\hat{z}) \\right)\n$$\nThe second term is zero because $(\\hat{z} \\times \\delta\\mathbf{B})$ is perpendicular to $\\hat{z}$. Therefore, the expression is zero. This indicates an error in the expansion. Let's re-group the terms:\n$$\n\\omega \\delta\\mathbf{B} = - \\frac{k}{n e \\mu_0} \\hat{z} \\times \\left( (i k \\hat{z} \\times \\delta\\mathbf{B}) \\times B_0 \\hat{z} \\right) = - \\frac{i k^2 B_0}{n e \\mu_0} \\hat{z} \\times \\left( (\\hat{z} \\times \\delta\\mathbf{B}) \\times \\hat{z} \\right)\n$$\nUsing the identity again on $(\\hat{z} \\times \\delta\\mathbf{B}) \\times \\hat{z}$:\n$$\n(\\hat{z} \\times \\delta\\mathbf{B}) \\times \\hat{z} = \\delta\\mathbf{B}(\\hat{z} \\cdot \\hat{z}) - \\hat{z}(\\hat{z} \\cdot \\delta\\mathbf{B}) = \\delta\\mathbf{B} - \\hat{z}(\\hat{z} \\cdot \\delta\\mathbf{B})\n$$\nThe term $\\delta\\mathbf{B}_\\perp = \\delta\\mathbf{B} - \\hat{z}(\\hat{z} \\cdot \\delta\\mathbf{B})$ is the component of $\\delta\\mathbf{B}$ perpendicular to $\\hat{z}$. The divergence-free condition $\\nabla \\cdot \\delta\\mathbf{B} = 0$ implies $i \\mathbf{k} \\cdot \\delta\\mathbf{B} = ik \\delta B_z = 0$, so $\\delta B_z = 0$. Thus, $\\delta\\mathbf{B}$ is purely transverse, $\\delta\\mathbf{B} = \\delta\\mathbf{B}_\\perp$.\nThe equation becomes:\n$$\n\\omega \\delta\\mathbf{B} = - \\frac{i k^2 B_0}{n e \\mu_0} \\hat{z} \\times \\delta\\mathbf{B}\n$$\nLet's express this in components. Let $\\delta\\mathbf{B} = \\delta B_x \\hat{x} + \\delta B_y \\hat{y}$. Then $\\hat{z} \\times \\delta\\mathbf{B} = \\delta B_x \\hat{y} - \\delta B_y \\hat{x}$.\n$$\n\\omega (\\delta B_x \\hat{x} + \\delta B_y \\hat{y}) = - \\frac{i k^2 B_0}{n e \\mu_0} (\\delta B_y \\hat{x} - \\delta B_x \\hat{y})\n$$\nThis vector equation yields a system of two linear equations:\n$$\n\\omega \\delta B_x = -i \\frac{k^2 B_0}{n e \\mu_0} \\delta B_y\n$$\n$$\n\\omega \\delta B_y = i \\frac{k^2 B_0}{n e \\mu_0} \\delta B_x\n$$\nThis system has non-trivial solutions for $(\\delta B_x, \\delta B_y)$ only if the determinant of the coefficient matrix is zero:\n$$\n\\det \\begin{pmatrix} \\omega & i \\frac{k^2 B_0}{n e \\mu_0} \\\\ -i \\frac{k^2 B_0}{n e \\mu_0} & \\omega \\end{pmatrix} = \\omega^2 - \\left( \\frac{k^2 B_0}{n e \\mu_0} \\right)^2 = 0\n$$\nThis gives the dispersion relation $\\omega = \\pm \\frac{B_0}{n e \\mu_0} k^2$. The two signs correspond to right- and left-hand circularly polarized waves. We take the positive root for the constant $C$.\n$$\nC = \\frac{B_0}{n e \\mu_0}\n$$\nNext, we show that $C = v_A d_i$. Using the provided definitions:\n$$\nv_A d_i = \\left( \\frac{B_0}{\\sqrt{\\mu_0 n m_i}} \\right) \\left( \\sqrt{\\frac{m_i}{\\mu_0 n e^2}} \\right) = \\frac{B_0 \\sqrt{m_i}}{\\sqrt{\\mu_0 n m_i} \\sqrt{\\mu_0 n e^2}} = \\frac{B_0}{\\sqrt{\\mu_0 n} \\sqrt{\\mu_0 n e^2}} = \\frac{B_0}{\\mu_0 n e}\n$$\nThis confirms that $C = v_A d_i$.\n\n### Part 2: RK4 Stability Analysis\n\nWe analyze the stability of the classical fourth-order Runge-Kutta (RK4) method for the linear test equation $\\partial_t q = i\\omega q$. The amplification factor $g(z)$ for a single step, where $q^{n+1} = g(z) q^n$ and $z = i\\omega \\Delta t$, is given by the Taylor series expansion of the exponential function up to the fourth order:\n$$\ng(z) = 1 + z + \\frac{z^2}{2!} + \\frac{z^3}{3!} + \\frac{z^4}{4!}\n$$\nThe scheme is numerically stable if the magnitude of the amplification factor is less than or equal to one, $|g(z)| \\le 1$. For the whistler mode, the frequency $\\omega$ is real, so we consider purely imaginary $z = i\\alpha$, where $\\alpha = \\omega \\Delta t$ is a real, dimensionless parameter.\n$$\ng(i\\alpha) = 1 + (i\\alpha) + \\frac{(i\\alpha)^2}{2} + \\frac{(i\\alpha)^3}{6} + \\frac{(i\\alpha)^4}{24} = 1 + i\\alpha - \\frac{\\alpha^2}{2} - i\\frac{\\alpha^3}{6} + \\frac{\\alpha^4}{24}\n$$\nGrouping real and imaginary parts:\n$$\ng(i\\alpha) = \\left(1 - \\frac{\\alpha^2}{2} + \\frac{\\alpha^4}{24}\\right) + i\\left(\\alpha - \\frac{\\alpha^3}{6}\\right)\n$$\nThe stability condition is $|g(i\\alpha)|^2 \\le 1$:\n$$\n\\left(1 - \\frac{\\alpha^2}{2} + \\frac{\\alpha^4}{24}\\right)^2 + \\left(\\alpha - \\frac{\\alpha^3}{6}\\right)^2 \\le 1\n$$\nExpanding the terms:\n$$\n\\left(1 - \\alpha^2 + \\frac{\\alpha^4}{4} + \\frac{\\alpha^4}{12} - \\frac{\\alpha^6}{24} + \\frac{\\alpha^8}{576}\\right) + \\left(\\alpha^2 - \\frac{\\alpha^4}{3} + \\frac{\\alpha^6}{36}\\right) \\le 1\n$$\n$$\n1 - \\alpha^2 + \\frac{\\alpha^4}{3} - \\frac{\\alpha^6}{24} + \\frac{\\alpha^8}{576} + \\alpha^2 - \\frac{\\alpha^4}{3} + \\frac{\\alpha^6}{36} \\le 1\n$$\nThe terms $\\alpha^2$ and $\\alpha^4/3$ cancel.\n$$\n-\\frac{\\alpha^6}{24} + \\frac{\\alpha^6}{36} + \\frac{\\alpha^8}{576} \\le 0\n$$\n$$\n\\alpha^6 \\left( \\frac{-3+2}{72} \\right) + \\frac{\\alpha^8}{576} \\le 0 \\implies -\\frac{\\alpha^6}{72} + \\frac{\\alpha^8}{576} \\le 0\n$$\nSince $\\alpha \\ge 0$, we consider $\\alpha^2 > 0$ and divide by $\\alpha^6$:\n$$\n-\\frac{1}{72} + \\frac{\\alpha^2}{576} \\le 0 \\implies \\alpha^2 \\le \\frac{576}{72} = 8\n$$\nThe stability boundary is $\\alpha^2 = 8$, which means the largest positive value for which the scheme is stable is $\\alpha_\\star = \\sqrt{8} = 2\\sqrt{2}$.\n\nThe explicit stability constraint for a time step $\\Delta t$ is $|\\omega \\Delta t| \\le \\alpha_\\star$. To ensure stability for all modes resolved on a grid, we must use the maximum frequency $\\omega_{\\max}$, which corresponds to the maximum wavenumber $k_{\\max}$. The condition is:\n$$\n\\Delta t_{\\mathrm{exp}} \\le \\frac{\\alpha_\\star}{|\\omega_{\\max}|} = \\frac{2\\sqrt{2}}{|\\omega_{\\max}|}\n$$\nFrom Part 1, $|\\omega| = \\frac{B_0}{\\mu_0 n e} k^2$. Using the given maximum resolved wavenumber $k_{\\max} = \\pi/\\Delta x$:\n$$\n\\omega_{\\max} = \\frac{B_0}{\\mu_0 n e} k_{\\max}^2 = \\frac{B_0}{\\mu_0 n e} \\left(\\frac{\\pi}{\\Delta x}\\right)^2\n$$\nSubstituting this into the stability constraint gives the expression for the maximum allowed explicit time step:\n$$\n\\Delta t_{\\mathrm{exp}} = \\frac{2\\sqrt{2} \\mu_0 n e}{B_0 (\\pi/\\Delta x)^2} = \\frac{2\\sqrt{2} \\mu_0 n e \\Delta x^2}{B_0 \\pi^2}\n$$\n\n### Part 3: IMEX Scheme and Stability\n\nThe induction equation is $\\partial_t \\mathbf{B} = \\nabla \\times (\\mathbf{u} \\times \\mathbf{B}) - \\nabla \\times \\left( \\frac{\\mathbf{J} \\times \\mathbf{B}}{n e} \\right)$. We split this into an explicit advection part $\\mathcal{F}(\\mathbf{B}) = \\nabla \\times (\\mathbf{u} \\times \\mathbf{B})$ and an implicit Hall part $\\mathcal{G}(\\mathbf{B}) = - \\nabla \\times ((\\mathbf{J} \\times \\mathbf{B})/(ne))$.\nThe requested IMEX scheme is first-order in time for the explicit part and second-order for the implicit part. A suitable choice is the Forward Euler / Crank-Nicolson scheme:\n$$\n\\frac{\\mathbf{B}^{n+1} - \\mathbf{B}^n}{\\Delta t} = \\mathcal{F}(\\mathbf{B}^n) + \\frac{1}{2}\\left(\\mathcal{G}(\\mathbf{B}^{n+1}) + \\mathcal{G}(\\mathbf{B}^n)\\right)\n$$\nThe Hall term $\\mathcal{G}(\\mathbf{B})$ is nonlinear. For analysis and practical implementation, it is often linearized. In the \"linear, constant-coefficient limit\" around a strong, uniform field $\\mathbf{B}_0$, we have $\\mathbf{J} \\times \\mathbf{B} \\approx (\\nabla \\times \\mathbf{B}/\\mu_0) \\times \\mathbf{B}_0$. This gives a linear operator $\\mathcal{L}_{\\text{Hall}}[\\mathbf{B}] = - \\frac{1}{\\mu_0 n e} \\nabla \\times ((\\nabla \\times \\mathbf{B}) \\times \\mathbf{B}_0)$. The discrete update for $\\mathbf{B}^{n+1}$ can be written as:\n$$\n\\left(I - \\frac{\\Delta t}{2}\\mathcal{L}_{\\text{Hall}}\\right)\\mathbf{B}^{n+1} = \\left(I + \\frac{\\Delta t}{2}\\mathcal{L}_{\\text{Hall}}\\right)\\mathbf{B}^n + \\Delta t \\, \\nabla \\times (\\mathbf{u} \\times \\mathbf{B}^n)\n$$\nThis is a linear system to be solved for $\\mathbf{B}^{n+1}$ at each step.\n\nTo analyze the energy stability of the implicit Hall substep, we consider the equation $\\partial_t \\mathbf{B} = \\mathcal{L}_{\\text{Hall}}[\\mathbf{B}]$ discretized with Crank-Nicolson: $\\frac{\\mathbf{B}^{n+1} - \\mathbf{B}^n}{\\Delta t} = \\frac{1}{2}(\\mathcal{L}_{\\text{Hall}}[\\mathbf{B}^{n+1}] + \\mathcal{L}_{\\text{Hall}}[\\mathbf{B}^n])$.\nThe operator $\\mathcal{L}_{\\text{Hall}}$ is skew-Hermitian, meaning its adjoint is its negative: $\\mathcal{L}_{\\text{Hall}}^\\dagger = -\\mathcal{L}_{\\text{Hall}}$. This can be shown by integration by parts over a periodic domain:\n$$\n\\langle \\mathbf{A}, \\mathcal{L}_{\\text{Hall}}[\\mathbf{B}] \\rangle = \\int \\mathbf{A}^* \\cdot \\mathcal{L}_{\\text{Hall}}[\\mathbf{B}] dV = \\int \\mathbf{A}^* \\cdot \\left[ - C_H \\nabla \\times ((\\nabla \\times \\mathbf{B}) \\times \\mathbf{B}_0) \\right] dV\n$$\nwhere $C_H = 1/(\\mu_0 n e)$. After integration by parts, one can show $\\langle \\mathbf{A}, \\mathcal{L}_{\\text{Hall}}[\\mathbf{B}] \\rangle = \\langle -\\mathcal{L}_{\\text{Hall}}[\\mathbf{A}], \\mathbf{B} \\rangle$.\nThe Crank-Nicolson amplification operator for a skew-Hermitian operator $S$ is $G = (I - \\frac{\\Delta t}{2} S)^{-1} (I + \\frac{\\Delta t}{2} S)$. This operator is unitary:\n$$\nG^\\dagger G = \\left( (I + \\frac{\\Delta t}{2} S)^\\dagger \\left((I - \\frac{\\Delta t}{2} S)^{-1}\\right)^\\dagger \\right) \\left( (I - \\frac{\\Delta t}{2} S)^{-1} (I + \\frac{\\Delta t}{2} S) \\right)\n$$\nUsing $S^\\dagger = -S$ and $(A^{-1})^\\dagger = (A^\\dagger)^{-1}$:\n$$\nG^\\dagger G = \\left( (I - \\frac{\\Delta t}{2} S) (I + \\frac{\\Delta t}{2} S)^{-1} \\right) \\left( (I - \\frac{\\Delta t}{2} S)^{-1} (I + \\frac{\\Delta t}{2} S) \\right)\n$$\nSince the operators commute, $G^\\dagger G = (I - \\frac{\\Delta t}{2} S)(I - \\frac{\\Delta t}{2} S)^{-1}(I + \\frac{\\Delta t}{2} S)^{-1}(I + \\frac{\\Delta t}{2} S) = I$.\nA unitary amplification operator means $\\| \\mathbf{B}^{n+1} \\| = \\| G \\mathbf{B}^n \\| = \\| \\mathbf{B}^n \\|$, preserving the L2-norm (energy). This demonstrates that the Crank-Nicolson treatment of the Hall term is unconditionally energy-stable for any $\\Delta t$.\n\nWith the stiff Hall term treated implicitly and stably, the time step of the overall IMEX scheme is limited by the stability constraint of the explicit advection part. This is the CFL condition:\n$$\n\\Delta t_{\\mathrm{IMEX}} \\le \\mathrm{CFL}_{\\mathrm{adv}} \\frac{\\Delta x}{U}\n$$\nwhere $U$ is the characteristic advection speed. This is the remaining constraint that limits the IMEX time step.\n\n### Part 4: Formulas for Computation\n\nThe required computations are based on the formulas derived and given.\n1.  The maximum explicit time step from the RK4 stability analysis of the whistler mode is:\n    $$\n    \\Delta t_{\\mathrm{exp}} = \\frac{2\\sqrt{2} \\mu_0 n e (\\Delta x)^2}{B_0 \\pi^2} = \\frac{2\\sqrt{2} \\mu_0 n e (L/N)^2}{B_0 \\pi^2}\n    $$\n2.  The maximum IMEX time step, limited by the explicit advection CFL condition, is given as:\n    $$\n    \\Delta t_{\\mathrm{IMEX}} = \\mathrm{CFL}_{\\mathrm{adv}} \\frac{\\Delta x}{U} = \\mathrm{CFL}_{\\mathrm{adv}} \\frac{L/N}{U}\n    $$\nThese formulas will be implemented for the test cases provided.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by calculating explicit and IMEX time step limits\n    for several test cases in Hall-MHD.\n    \"\"\"\n    \n    # Physical constants in SI units\n    MU_0 = 4 * np.pi * 1e-7  # Vacuum permeability (H/m or T*m/A)\n    E_CHARGE = 1.602176634e-19  # Elementary charge (C)\n    M_PROTON = 1.67262192369e-27  # Proton mass (kg)\n\n    # Test suite: (L, N, B0, n, mi, U, CFL_adv)\n    test_cases = [\n        # Case A (general regime)\n        (1.0, 256, 0.1, 1e19, M_PROTON, 1e4, 0.5),\n        # Case B (grid-refined boundary)\n        (1.0, 4096, 0.1, 1e19, M_PROTON, 1e4, 0.5),\n        # Case C (ion-mass variation)\n        (1.0, 256, 0.1, 1e19, 4 * M_PROTON, 1e4, 0.5),\n        # Case D (low density edge)\n        (1.0, 256, 0.1, 1e17, M_PROTON, 1e4, 0.5),\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        L, N, B0, n, mi, U, CFL_adv = case\n\n        # Grid spacing\n        delta_x = L / N\n\n        # Part 1: Whistler dispersion constant and explicit time step calculation\n        # The whistler dispersion relation is omega = C * k^2 where C = B0 / (mu0 * n * e)\n        # The RK4 stability limit for this purely oscillatory system is omega_max * dt = 2*sqrt(2).\n        # omega_max corresponds to k_max = pi / delta_x.\n        # dt_exp = (2*sqrt(2)) / omega_max = (2*sqrt(2)) / (C * k_max^2)\n        # dt_exp = (2*sqrt(2) * mu0 * n * e) / (B0 * (pi/delta_x)^2)\n        #        = (2*sqrt(2) * mu0 * n * e * delta_x^2) / (B0 * pi^2)\n        \n        numerator_exp = 2 * np.sqrt(2) * MU_0 * n * E_CHARGE * (delta_x**2)\n        denominator_exp = B0 * (np.pi**2)\n        dt_exp = numerator_exp / denominator_exp\n\n        # Part 2: IMEX time step calculation\n        # The IMEX time step is limited by the advective CFL condition.\n        # dt_imex = CFL_adv * delta_x / U\n        \n        dt_imex = CFL_adv * delta_x / U\n        \n        results.append([dt_exp, dt_imex])\n\n    # Format the output as specified: [[...],[...],...] with 12 significant digits.\n    # The format string \"{:.12e}\" produces scientific notation with 12 digits after the decimal.\n    # Total significant digits is 1 + 12 = 13.\n    # The problem asks for \"twelve significant digits\".\n    # A format like \"{:.11e}\" should be used for 12 total significant digits.\n    \n    # Example: np.format_float_scientific(1.23456789012345e-10, precision=11)\n    # -> '1.23456789012e-10' (12 significant digits)\n    \n    result_strings = []\n    for res_pair in results:\n        s1 = np.format_float_scientific(res_pair[0], precision=11, unique=False)\n        s2 = np.format_float_scientific(res_pair[1], precision=11, unique=False)\n        result_strings.append(f\"[{s1},{s2}]\")\n        \n    print(f\"[{','.join(result_strings)}]\")\n\nsolve()\n\n```", "id": "3522825"}, {"introduction": "After understanding the challenges of temporal discretization, we turn to the spatial arrangement of variables, which has profound consequences for the quality of a numerical scheme. A cornerstone of robust electromagnetic simulation is the exact preservation of charge at the discrete level, which prevents the unphysical accumulation of numerical charge over long simulations. This exercise guides you through designing a charge-conserving scheme on a staggered Yee-type grid, demonstrating how a careful co-location of field and current variables ensures the discrete continuity equation is satisfied to machine precision [@problem_id:3522863].", "problem": "Design a two-dimensional, periodic, uniform Cartesian time-domain scheme for a coupled plasma-fluid-electromagnetic system that guarantees exact discrete charge continuity at machine precision. The goal is to decide the staggered spatial placement and the time staggering of the unknowns, together with an update sequence, so that the discrete continuity equation is satisfied to round-off error. Use the following fundamental starting point and assumptions.\n\n1. Fundamental base:\n   - Maxwell’s equations in vacuum with source current density: $\\nabla \\times \\mathbf{E}=-\\partial_t \\mathbf{B}$ and $\\nabla \\times \\mathbf{H}=\\partial_t \\mathbf{D}+\\mathbf{J}$, with $\\mathbf{D}=\\varepsilon_0 \\mathbf{E}$ and $\\mathbf{B}=\\mu_0 \\mathbf{H}$. The charge continuity equation is $\\partial_t \\rho_e + \\nabla \\cdot \\mathbf{J}=0$ and Gauss’s law is $\\nabla \\cdot \\mathbf{D}=\\rho_e$.\n   - A fluid (Drude) model for the conduction current density: $\\partial_t \\mathbf{J} + \\nu \\mathbf{J} = \\varepsilon_0 \\omega_p^2 \\mathbf{E}$, where $\\nu$ is the effective collision frequency and $\\omega_p$ is the (possibly space-dependent) plasma frequency.\n   - Two-dimensional Transverse Magnetic with out-of-plane magnetic field (TM$_z$) polarization: in-plane electric field $\\mathbf{E}=(E_x,E_y,0)$, out-of-plane magnetic field $\\mathbf{H}=(0,0,H_z)$, and in-plane current density $\\mathbf{J}=(J_x,J_y,0)$.\n\n2. Staggered-grid design requirement:\n   - Adopt a Yee-type staggered spatial layout on a rectangular grid to ensure that discrete curl and divergence operators satisfy the necessary identities for conservation. Place $E_x$ on vertical faces, $E_y$ on horizontal faces, $H_z$ at cell centers, $J_x$ collocated with $E_x$, $J_y$ collocated with $E_y$, and $\\rho_e$ at cell centers. Choose a time staggering such that the discrete Ampère–Maxwell update for $\\mathbf{E}$ uses $\\mathbf{J}$ collocated in both space and time, and the resulting discrete continuity $\\frac{\\rho_e^{n+1}-\\rho_e^n}{\\Delta t}+\\nabla_h\\cdot \\mathbf{J}^{n+1/2}=0$ holds at machine precision. Here $\\nabla_h \\cdot$ denotes the face-to-center discrete divergence.\n\n3. Discretization constraints:\n   - Use a uniform grid with $N_x$ by $N_y$ cells, periodic boundary conditions in both directions, cell sizes $\\Delta x=L_x/N_x$ and $\\Delta y=L_y/N_y$, and a time step $\\Delta t$. Use the discrete operators consistent with the staggered placement to construct a scheme where the discrete identity $\\nabla_h \\cdot (\\nabla_h \\times \\cdot)=0$ holds exactly under periodicity.\n   - Use a leapfrog staggering in time for the electromagnetic field consistent with Finite-Difference Time-Domain (FDTD) and a centered-in-time discretization of the Drude model that yields $\\mathbf{J}^{n+1/2}$ from $\\mathbf{J}^{n-1/2}$ and $\\mathbf{E}^n$ without violating the continuity identity. Initial conditions must satisfy discrete Gauss’s law $\\rho_e^0=\\varepsilon_0 \\nabla_h \\cdot \\mathbf{E}^0$.\n\n4. Manufactured initial conditions and parameters:\n   - Physical constants: $\\varepsilon_0=8.8541878128\\times 10^{-12}$ in farads per meter, $\\mu_0=4\\pi\\times 10^{-7}$ in henries per meter, and $c=1/\\sqrt{\\varepsilon_0 \\mu_0}$ in meters per second.\n   - Domain: $L_x=0.1$ in meters and $L_y=0.1$ in meters. Use periodic boundary conditions in both directions.\n   - Initial fields are given by analytic functions evaluated at the appropriate staggered locations,\n     $$\n     E_x(x,y)=\\cos\\left(\\frac{2\\pi x}{L_x}\\right)+\\frac{1}{2}\\sin\\left(\\frac{4\\pi y}{L_y}\\right),\\quad\n     E_y(x,y)=0.7\\cos\\left(\\frac{2\\pi y}{L_y}\\right)-0.3\\sin\\left(\\frac{2\\pi x}{L_x}\\right),\\quad\n     H_z(x,y)=\\sin\\left(\\frac{2\\pi x}{L_x}\\right)\\sin\\left(\\frac{2\\pi y}{L_y}\\right).\n     $$\n   - The conduction current is governed by the Drude model. For spatially varying plasma frequency, use\n     $$\n     \\omega_p(x,y)=\\omega_0\\left[1+0.5\\sin\\left(\\frac{2\\pi x}{L_x}\\right)\\cos\\left(\\frac{2\\pi y}{L_y}\\right)\\right].\n     $$\n     The collision frequency $\\nu$ is spatially uniform within each test case.\n\n5. Time step:\n   - Set $\\Delta t=\\theta \\,\\Delta t_{\\mathrm{CFL}}$ with $\\Delta t_{\\mathrm{CFL}}=\\left(c\\sqrt{(\\Delta x)^{-2}+(\\Delta y)^{-2}}\\right)^{-1}$ and a given factor $\\theta\\in(0,1]$ for each test case. Angles inside trigonometric functions are in radians.\n\n6. What to compute and how to report results:\n   - At every time step $n\\to n+1$, define the discrete charge density $\\rho_e^n=\\varepsilon_0 \\,\\nabla_h\\cdot \\mathbf{E}^n$ using the face-to-center divergence consistent with the spatial staggering. Let $\\mathbf{J}^{n+1/2}$ be the current at the half time step collocated with $\\mathbf{E}$ in space. Define the discrete continuity residual field\n     $$\n     \\mathcal{R}^{n+1/2}=\\frac{\\rho_e^{n+1}-\\rho_e^n}{\\Delta t}+\\nabla_h\\cdot \\mathbf{J}^{n+1/2}.\n     $$\n     For each test case, run the scheme for the specified number of time steps and report the maximum absolute value of $\\mathcal{R}^{n+1/2}$ over all grid cells and over all steps. Express this maximum as a floating-point number in the unit Coulombs per cubic meter per second ($\\mathrm{C}\\,\\mathrm{m}^{-3}\\,\\mathrm{s}^{-1}$).\n\n7. Test suite:\n   For all cases, use the same domain and initial conditions described above. Each test case is specified by the tuple $(N_x,N_y,\\theta,\\text{steps},\\omega_0,\\nu,\\text{profile})$, where profile is one of “vacuum”, “uniform”, or “varying” and determines $\\omega_p(x,y)$ as follows:\n   - “vacuum”: $\\omega_p(x,y)\\equiv 0$.\n   - “uniform”: $\\omega_p(x,y)\\equiv \\omega_0$.\n   - “varying”: $\\omega_p(x,y)$ given by the above formula with the specified $\\omega_0$.\n\n   Use the following four cases:\n   - Case 1 (happy path, vacuum): $(16,16,0.9,10,0.0,0.0,\\text{vacuum})$.\n   - Case 2 (uniform plasma, moderate collisions): $(8,8,0.95,20,2.0\\times 10^{11},1.0\\times 10^{10},\\text{uniform})$.\n   - Case 3 (spatially varying plasma, low collisions): $(10,6,0.8,15,1.5\\times 10^{11},5.0\\times 10^{9},\\text{varying})$.\n   - Case 4 (edge case, tiny grid, collisionless): $(2,2,0.5,5,1.0\\times 10^{11},0.0,\\text{uniform})$.\n\n8. Required final output format:\n   - Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets in the order of the above cases, for example: “[r1,r2,r3,r4]”, where each $r_k$ is the maximum absolute residual in $\\mathrm{C}\\,\\mathrm{m}^{-3}\\,\\mathrm{s}^{-1}$ for case $k$.\n\nYour task is to:\n- Decide a concrete staggered spatial placement and time staggering for $E_x$, $E_y$, $H_z$, $J_x$, $J_y$, and $\\rho_e$ consistent with the above, derive a second-order accurate update that enforces the discrete continuity identity, and implement it.\n- The discrete operators must be chosen so that the divergence of the curl term entering Ampère’s law is identically zero under periodic boundary conditions, thus making the discrete continuity equation hold at machine precision provided $\\rho_e^0=\\varepsilon_0 \\nabla_h \\cdot \\mathbf{E}^0$.\n- Implement the scheme for the test suite and report the requested results in the exact output format. All vector calculus and algebra must be expressed and reasoned about within the discretization; do not assume any continuous identities hold discretely unless you can justify them from your discrete operators.", "solution": "The user has provided a valid, well-posed problem in computational plasma physics. The task is to design and implement a numerical scheme for a coupled plasma-fluid-electromagnetic system that discretely preserves charge continuity to machine precision.\n\n### 1. Verification of the Problem Statement\nThe problem is scientifically grounded, based on Maxwell's equations and the Drude model for plasma conductivity. The constraints on the numerical scheme (staggered grid, leapfrog time-stepping, specific form of the discrete continuity equation) are standard in the field of Finite-Difference Time-Domain (FDTD) methods. All required parameters, initial conditions, and test cases are provided, making the problem self-contained and objective. The goal of designing a scheme to satisfy a discrete conservation law is a non-trivial but well-understood task in computational physics, confirming the problem's validity.\n\n### 2. Design of the Charge-Conserving Scheme\n\n#### 2.1. Spatial and Temporal Staggering\nTo satisfy the problem's constraints, including the discrete vector identity $\\nabla_h \\cdot (\\nabla_h \\times \\cdot) = 0$, we adopt the standard Yee staggered grid for a 2D TM$_z$ problem, with a node-centered charge density. Let the grid indices be $(i,j)$.\n- The electric field components $E_x$ and collocated current density $J_x$ are located at $x=(i+1/2)\\Delta x, y=j\\Delta y$.\n- The electric field components $E_y$ and collocated current density $J_y$ are located at $x=i\\Delta x, y=(j+1/2)\\Delta y$.\n- The magnetic field component $H_z$ is located at the cell centers, $x=(i+1/2)\\Delta x, y=(j+1/2)\\Delta y$.\n- The charge density $\\rho_e$ is located at the grid nodes, $x=i\\Delta x, y=j\\Delta y$.\n\nFor temporal staggering, we use a leapfrog scheme:\n- Electric field $\\mathbf{E}$ is evaluated at integer time steps: $t=n\\Delta t$.\n- Magnetic field $\\mathbf{H}$ and current density $\\mathbf{J}$ are evaluated at half-integer time steps: $t=(n+1/2)\\Delta t$.\n\n#### 2.2. Derivation of the Discrete Equations\nThe governing equations are discretized as follows, ensuring second-order accuracy in space and time.\n\n**Faraday's Law:** $\\mu_0 \\partial_t \\mathbf{H} = -\\nabla \\times \\mathbf{E}$.\nThis is used to update $H_z$ from step $n-1/2$ to $n+1/2$, centered at time $n$:\n$$\n\\mu_0 \\frac{H_z^{n+1/2} - H_z^{n-1/2}}{\\Delta t} = -(\\nabla_h \\times \\mathbf{E}^n)_z\n$$\nThe discrete curl operator, evaluated at the $H_z$ location $(i+1/2, j+1/2)$, is:\n$$\n(\\nabla_h \\times \\mathbf{E}^n)_{i+1/2, j+1/2} = \\frac{E_{y, i+1, j+1/2}^n - E_{y, i, j+1/2}^n}{\\Delta x} - \\frac{E_{x, i+1/2, j+1}^n - E_{x, i+1/2, j}^n}{\\Delta y}\n$$\n\n**Ampère-Maxwell Law:** $\\varepsilon_0 \\partial_t \\mathbf{E} + \\mathbf{J} = \\nabla \\times \\mathbf{H}$.\nThis is used to update $\\mathbf{E}$ from step $n$ to $n+1$, centered at time $n+1/2$:\n$$\n\\varepsilon_0 \\frac{\\mathbf{E}^{n+1} - \\mathbf{E}^n}{\\Delta t} + \\mathbf{J}^{n+1/2} = (\\nabla_h \\times \\mathbf{H})^{n+1/2}\n$$\nThe discrete curl operators, evaluated at the $\\mathbf{E}$ component locations, are:\n$$\n(\\nabla_h \\times \\mathbf{H})_{x, i+1/2, j} = \\frac{H_{z, i+1/2, j+1/2} - H_{z, i+1/2, j-1/2}}{\\Delta y}\n$$\n$$\n(\\nabla_h \\times \\mathbf{H})_{y, i, j+1/2} = -\\frac{H_{z, i+1/2, j+1/2} - H_{z, i-1/2, j+1/2}}{\\Delta x}\n$$\n\n**Drude Model:** $\\partial_t \\mathbf{J} + \\nu \\mathbf{J} = \\varepsilon_0 \\omega_p^2 \\mathbf{E}$.\nThis is used to update $\\mathbf{J}$ from step $n-1/2$ to $n+1/2$, centered at time $n$:\n$$\n\\frac{\\mathbf{J}^{n+1/2} - \\mathbf{J}^{n-1/2}}{\\Delta t} + \\nu \\frac{\\mathbf{J}^{n+1/2} + \\mathbf{J}^{n-1/2}}{2} = \\varepsilon_0 \\omega_p^2 \\mathbf{E}^n\n$$\nSolving for $\\mathbf{J}^{n+1/2}$ gives an explicit update:\n$$\n\\mathbf{J}^{n+1/2} = \\left(\\frac{1/\\Delta t - \\nu/2}{1/\\Delta t + \\nu/2}\\right) \\mathbf{J}^{n-1/2} + \\left(\\frac{\\varepsilon_0 \\omega_p^2}{1/\\Delta t + \\nu/2}\\right) \\mathbf{E}^n\n$$\n\n#### 2.3. Proof of Discrete Charge Conservation\nThe problem requires checking the residual of the discrete continuity equation $\\mathcal{R}^{n+1/2} = \\frac{\\rho_e^{n+1} - \\rho_e^n}{\\Delta t} + \\nabla_h \\cdot \\mathbf{J}^{n+1/2}$. The charge density is defined from Gauss's Law: $\\rho_e^n = \\varepsilon_0 \\nabla_h \\cdot \\mathbf{E}^n$. Substituting this into the residual expression:\n$$\n\\mathcal{R}^{n+1/2} = \\frac{\\varepsilon_0 \\nabla_h \\cdot \\mathbf{E}^{n+1} - \\varepsilon_0 \\nabla_h \\cdot \\mathbf{E}^n}{\\Delta t} + \\nabla_h \\cdot \\mathbf{J}^{n+1/2}\n$$\nUsing the linearity of the discrete divergence operator $\\nabla_h \\cdot$:\n$$\n\\mathcal{R}^{n+1/2} = \\nabla_h \\cdot \\left( \\varepsilon_0 \\frac{\\mathbf{E}^{n+1} - \\mathbf{E}^n}{\\Delta t} + \\mathbf{J}^{n+1/2} \\right)\n$$\nFrom our discretized Ampère-Maxwell law, the term in the parentheses is equal to $(\\nabla_h \\times \\mathbf{H})^{n+1/2}$. Therefore,\n$$\n\\mathcal{R}^{n+1/2} = \\nabla_h \\cdot ((\\nabla_h \\times \\mathbf{H})^{n+1/2})\n$$\nThe chosen staggered grid and centered-difference operators ensure that the discrete divergence of a discrete curl is identically zero ($\\nabla_h \\cdot (\\nabla_h \\times \\cdot) \\equiv 0$) for any field defined on the grid with periodic boundary conditions. Thus, the residual $\\mathcal{R}^{n+1/2}$ is mathematically zero at every time step. The implementation will yield a value on the order of machine floating-point precision.\n\n### 3. Implementation Algorithm\nThe simulation proceeds as follows:\n\n1.  **Initialization:**\n    - Define grid parameters $(\\Delta x, \\Delta y, \\Delta t)$.\n    - Set up coordinate arrays for all staggered field components.\n    - Initialize electric fields $\\mathbf{E}^0 = (E_x^0, E_y^0)$ at $t=0$ using the given analytic functions.\n    - Initialize magnetic field $H_z^{-1/2}$ at $t=-\\Delta t/2$. We assume the provided function for $H_z$ is to be evaluated for this time step, a standard FDTD convention for convenience when $t=0$ initial conditions are specified for all fields.\n    - Initialize current density $\\mathbf{J}^{-1/2} = (J_x^{-1/2}, J_y^{-1/2})$ to zero, assuming the system is quiescent for $t \\le 0$.\n    - Pre-compute the coefficients for the Drude model update, which depend on the plasma profile ($\\omega_p$) and collision frequency ($\\nu$).\n\n2.  **Time-stepping Loop:** For each time step $n$ from $0$ to `steps-1`:\n    a. Update the magnetic field $H_z^{n-1/2} \\to H_z^{n+1/2}$ using $\\mathbf{E}^n$.\n    b. Update the current density $\\mathbf{J}^{n-1/2} \\to \\mathbf{J}^{n+1/2}$ using $\\mathbf{E}^n$.\n    c. Update the electric field $\\mathbf{E}^n \\to \\mathbf{E}^{n+1}$ using $H_z^{n+1/2}$ and $\\mathbf{J}^{n+1/2}$.\n    d. Calculate the residual field $\\mathcal{R}^{n+1/2}$ at the grid nodes using $\\mathbf{E}^{n+1}$, $\\mathbf{E}^n$, and $\\mathbf{J}^{n+1/2}$. The discrete divergence operator for this is $(\\nabla_h \\cdot \\mathbf{F})_{i,j} = \\frac{F_{x,i+1/2,j} - F_{x,i-1/2,j}}{\\Delta x} + \\frac{F_{y,i,j+1/2} - F_{y,i,j-1/2}}{\\Delta y}$.\n    e. Record the maximum absolute value of the residual field over the grid and update the overall maximum found so far.\n    f. Advance the fields for the next iteration.\n\n3.  **Result:** After the loop finishes, the maximum absolute residual found across all steps and all grid points is reported for the test case. Periodic boundary conditions are handled using `numpy.roll` for efficient and correct implementation of the finite-difference operators.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Physical constants in SI units\n    EPS0 = 8.8541878128e-12  # F/m\n    MU0 = 4 * np.pi * 1e-7   # H/m\n    C0 = 1 / np.sqrt(EPS0 * MU0) # m/s\n\n    def _solve_case(Nx, Ny, theta, steps, omega0, nu, profile):\n        \"\"\"\n        Solves one case of the coupled plasma-fluid-electromagnetic system.\n        The numerical scheme is designed to guarantee exact discrete charge continuity.\n        \"\"\"\n        # --- 1. Setup Grid, Time Step, and Domain ---\n        Lx = 0.1  # m\n        Ly = 0.1  # m\n        dx = Lx / Nx\n        dy = Ly / Ny\n        dt_cfl = 1 / (C0 * np.sqrt(1/dx**2 + 1/dy**2))\n        dt = theta * dt_cfl\n\n        # --- 2. Staggered Grid Coordinates ---\n        # Ex/Jx components are at face centers (i+1/2, j)\n        x_Ex = (np.arange(Nx) + 0.5) * dx\n        y_Ex = np.arange(Ny) * dy\n        X_Ex, Y_Ex = np.meshgrid(x_Ex, y_Ex, indexing='ij')\n        \n        # Ey/Jy components are at face centers (i, j+1/2)\n        x_Ey = np.arange(Nx) * dx\n        y_Ey = (np.arange(Ny) + 0.5) * dy\n        X_Ey, Y_Ey = np.meshgrid(x_Ey, y_Ey, indexing='ij')\n\n        # Hz components are at cell centers (i+1/2, j+1/2)\n        x_Hz = (np.arange(Nx) + 0.5) * dx\n        y_Hz = (np.arange(Ny) + 0.5) * dy\n        X_Hz, Y_Hz = np.meshgrid(x_Hz, y_Hz, indexing='ij')\n        \n        # --- 3. Initial Field Conditions ---\n        # E-field components are at t=0\n        Ex = np.cos(2 * np.pi * X_Ex / Lx) + 0.5 * np.sin(4 * np.pi * Y_Ex / Ly)\n        Ey = 0.7 * np.cos(2 * np.pi * Y_Ey / Ly) - 0.3 * np.sin(2 * np.pi * X_Ey / Lx)\n        \n        # H and J fields are staggered in time (leapfrog), initialized at t=-dt/2\n        # As is conventional, we use the t=0 analytic function for H at t=-dt/2\n        Hz_prev = np.sin(2 * np.pi * X_Hz / Lx) * np.sin(2 * np.pi * Y_Hz / Ly)\n        \n        # Current is assumed to be zero for t = 0\n        Jx_prev = np.zeros((Nx, Ny), dtype=float)\n        Jy_prev = np.zeros((Nx, Ny), dtype=float)\n        \n        # --- 4. Plasma Parameters and Update Coefficients ---\n        if profile == \"vacuum\":\n            omega_p_sq_x = np.zeros((Nx, Ny), dtype=float)\n            omega_p_sq_y = np.zeros((Nx, Ny), dtype=float)\n        elif profile == \"uniform\":\n            omega_p_sq_x = np.full((Nx, Ny), omega0**2, dtype=float)\n            omega_p_sq_y = np.full((Nx, Ny), omega0**2, dtype=float)\n        elif profile == \"varying\":\n            omega_p_x = omega0 * (1 + 0.5 * np.sin(2*np.pi*X_Ex/Lx) * np.cos(2*np.pi*Y_Ex/Ly))\n            omega_p_sq_x = omega_p_x**2\n            omega_p_y = omega0 * (1 + 0.5 * np.sin(2*np.pi*X_Ey/Lx) * np.cos(2*np.pi*Y_Ey/Ly))\n            omega_p_sq_y = omega_p_y**2\n        \n        # Drude model update coefficients for J^{n+1/2} = C1*J^{n-1/2} + C2*E^n\n        if nu == 0.0:\n            C1 = 1.0\n            C2_x = EPS0 * omega_p_sq_x * dt\n            C2_y = EPS0 * omega_p_sq_y * dt\n        else:\n            den = 1.0 / dt + nu / 2.0\n            C1 = (1.0 / dt - nu / 2.0) / den\n            C2x_num = EPS0 * omega_p_sq_x\n            C2_x = C2x_num / den\n            C2y_num = EPS0 * omega_p_sq_y\n            C2_y = C2y_num / den\n\n        max_abs_residual = 0.0\n\n        # --- 5. FDTD Time-stepping Loop ---\n        for _ in range(steps):\n            # Current state: Ex, Ey at time n; Hz_prev, Jx_prev, Jy_prev at n-1/2\n            \n            # --- Update H-field from n-1/2 to n+1/2 ---\n            curl_E_z = (np.roll(Ey, -1, axis=0) - Ey) / dx - \\\n                       (np.roll(Ex, -1, axis=1) - Ex) / dy\n            Hz = Hz_prev - (dt / MU0) * curl_E_z\n            \n            # --- Update J-field from n-1/2 to n+1/2 ---\n            Jx = C1 * Jx_prev + C2_x * Ex\n            Jy = C1 * Jy_prev + C2_y * Ey\n            \n            # --- Update E-field from n to n+1 ---\n            curl_H_x = (Hz - np.roll(Hz, 1, axis=1)) / dy\n            curl_H_y = -(Hz - np.roll(Hz, 1, axis=0)) / dx\n            Ex_next = Ex + (dt / EPS0) * (curl_H_x - Jx)\n            Ey_next = Ey + (dt / EPS0) * (curl_H_y - Jy)\n            \n            # --- Calculate Charge Continuity Residual at t=n+1/2 ---\n            # rho^n = eps0 * div(E^n) at nodes (i, j)\n            div_E_n = (Ex - np.roll(Ex, 1, axis=0)) / dx + \\\n                      (Ey - np.roll(Ey, 1, axis=1)) / dy\n            rho_n = EPS0 * div_E_n\n            \n            # rho^{n+1} = eps0 * div(E^{n+1}) at nodes (i, j)\n            div_E_n_plus_1 = (Ex_next - np.roll(Ex_next, 1, axis=0)) / dx + \\\n                             (Ey_next - np.roll(Ey_next, 1, axis=1)) / dy\n            rho_n_plus_1 = EPS0 * div_E_n_plus_1\n            \n            # div(J^{n+1/2}) at nodes (i, j)\n            div_J_n_half = (Jx - np.roll(Jx, 1, axis=0)) / dx + \\\n                           (Jy - np.roll(Jy, 1, axis=1)) / dy\n            \n            # Residual R^{n+1/2} = (rho^{n+1} - rho^n)/dt + div(J^{n+1/2})\n            residual = (rho_n_plus_1 - rho_n) / dt + div_J_n_half\n            \n            # Update the maximum absolute residual found so far\n            current_max_abs_res = np.max(np.abs(residual))\n            if current_max_abs_res > max_abs_residual:\n                max_abs_residual = current_max_abs_res\n\n            # --- Advance fields for the next iteration ---\n            Ex, Ey = Ex_next, Ey_next\n            Hz_prev = Hz\n            Jx_prev, Jy_prev = Jx, Jy\n            \n        return max_abs_residual\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (Nx, Ny, theta, steps, omega0, nu, profile)\n        (16, 16, 0.9, 10, 0.0, 0.0, \"vacuum\"),\n        (8, 8, 0.95, 20, 2.0e11, 1.0e10, \"uniform\"),\n        (10, 6, 0.8, 15, 1.5e11, 5.0e9, \"varying\"),\n        (2, 2, 0.5, 5, 1.0e11, 0.0, \"uniform\"),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = _solve_case(*case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.18e}' for r in results)}]\")\n\nsolve()\n\n```", "id": "3522863"}, {"introduction": "Beyond charge, the conservation of energy is a fundamental principle that robust numerical schemes should respect. While some schemes are designed to conserve energy exactly, many widely-used methods only do so approximately. This practice focuses on verification, a critical skill in computational science, by tasking you with quantifying the energy conservation error of a finite-difference scheme for the coupled MHD-Maxwell system [@problem_id:3522867]. You will implement the discretization and measure the degree to which it satisfies a discrete version of the Poynting theorem, gaining insight into the concept of numerical dissipation and fidelity.", "problem": "Consider a one-dimensional ($x$) periodic domain of length $L$ discretized into $N$ uniform cells of width $\\Delta x = L/N$. The plasma is modeled by fluid variables and electromagnetic fields. The fluid is an ideal gas with mass density $\\rho$, velocity $u$, pressure $p$, and ratio of specific heats $\\gamma$. The electromagnetic fields are the transverse electric field component $E_z$ and the transverse magnetic field component $B_y$, with electric permittivity $\\epsilon_0$ and magnetic permeability $\\mu_0$, satisfying $c^2 = 1/(\\mu_0 \\epsilon_0)$ where $c$ is the speed of light.\n\nStart from the following fundamental laws and core definitions:\n- Maxwell–Faraday law: $\\partial_t \\mathbf{B} = -\\nabla \\times \\mathbf{E}$.\n- Ampère–Maxwell law with conduction current: $\\partial_t \\mathbf{E} = c^2 \\nabla \\times \\mathbf{B} - \\mathbf{J}/\\epsilon_0$.\n- Ohm’s law (resistive model in the laboratory frame): $\\mathbf{J} = \\sigma \\left(\\mathbf{E} + \\mathbf{u} \\times \\mathbf{B} \\right)$ where $\\sigma$ is the electrical conductivity.\n- Ideal-gas internal energy density: $e = p/(\\gamma-1)$ and fluid kinetic energy density: $\\rho u^2/2$.\n- Electromagnetic energy density: $U_{\\mathrm{em}} = \\epsilon_0 E^2/2 + B^2/(2\\mu_0)$ and Poynting vector: $\\mathbf{S} = (1/\\mu_0)\\mathbf{E} \\times \\mathbf{B}$.\n- Poynting theorem (electromagnetic energy balance): $\\partial_t U_{\\mathrm{em}} + \\nabla \\cdot \\mathbf{S} = -\\mathbf{J} \\cdot \\mathbf{E}$.\n\nIn the one-dimensional configuration, take $\\mathbf{u} = (u,0,0)$, $\\mathbf{E} = (0,0,E_z)$, and $\\mathbf{B} = (0,B_y,0)$. Derive the combined energy density $U = \\rho u^2/2 + p/(\\gamma-1) + B_y^2/(2\\mu_0) + \\epsilon_0 E_z^2/2$ and its continuous balance from the above laws, showing how the electromagnetic coupling term $-\\mathbf{J}\\cdot\\mathbf{E}$ appears in the field energy and how mechanical work couples to the fluid energy. Then, construct a discrete energy balance for the electromagnetic part using a finite-volume scheme on the uniform grid:\n\n- Discrete spatial derivatives use second-order central differences with periodic boundary conditions:\n  - $\\left(\\partial_x f\\right)_i \\approx \\left(f_{i+1} - f_{i-1}\\right)/(2\\Delta x)$.\n- Time stepping is explicit forward Euler:\n  - $E_i^{n+1} = E_i^n + \\Delta t \\left(c^2 \\left(\\partial_x B\\right)_i^n - J_i^n/\\epsilon_0\\right)$,\n  - $B_i^{n+1} = B_i^n + \\Delta t \\left(\\partial_x E\\right)_i^n$.\n- The discrete electromagnetic energy density at time level $n$ is $U_{\\mathrm{em},i}^n = \\epsilon_0 \\left(E_i^n\\right)^2/2 + \\left(B_i^n\\right)^2/(2\\mu_0)$.\n- The discrete Poynting flux at cell interfaces uses arithmetic averaging:\n  - $S_{x,i+1/2}^n = -\\left(1/\\mu_0\\right)\\left(\\frac{E_i^n + E_{i+1}^n}{2}\\right)\\left(\\frac{B_i^n + B_{i+1}^n}{2}\\right)$,\n  - $\\left(\\nabla \\cdot \\mathbf{S}\\right)_i^n \\approx \\left(S_{x,i+1/2}^n - S_{x,i-1/2}^n\\right)/\\Delta x$.\n- The discrete current density is $J_i^n = \\sigma \\left(E_i^n + u B_i^n\\right)$.\n\nDefine the discrete residual of the electromagnetic Poynting theorem per cell after one time step:\n$$\nR_i = \\frac{U_{\\mathrm{em},i}^{n+1} - U_{\\mathrm{em},i}^n}{\\Delta t} + \\left(\\nabla \\cdot \\mathbf{S}\\right)_i^n + J_i^n E_i^n.\n$$\n\nMeasure the scalar residual using the root-mean-square (RMS) norm and normalize by the sum of RMS magnitudes of the three terms:\n$$\n\\mathrm{rms}(X) = \\sqrt{\\frac{1}{N}\\sum_{i=0}^{N-1} X_i^2}, \\quad\n\\mathcal{R} = \\frac{\\mathrm{rms}(R)}{\\mathrm{rms}\\left(\\frac{U_{\\mathrm{em}}^{n+1} - U_{\\mathrm{em}}^n}{\\Delta t}\\right) + \\mathrm{rms}\\left(\\nabla \\cdot \\mathbf{S}\\right) + \\mathrm{rms}\\left(J E\\right) + \\varepsilon},\n$$\nwith a small stabilization $\\varepsilon = 10^{-30}$.\n\nYour program must implement the above discrete scheme for one explicit time step and compute $\\mathcal{R}$ for each test case. The output for each test case must be a boolean that is true if $\\mathcal{R}  \\tau$, where $\\tau$ is a specified tolerance. Use the following constants and test suite, all in International System of Units (SI):\n\n- Constants:\n  - $L = 1.0$,\n  - $c = 299792458.0$,\n  - $\\mu_0 = 4\\pi\\times 10^{-7}$,\n  - $\\epsilon_0 = 1/\\left(\\mu_0 c^2\\right)$,\n  - $\\gamma = 5/3$,\n  - $\\tau = 10^{-3}$,\n  - $\\mathrm{CFL} = 0.1$.\n\n- Test suite cases:\n  1. Resistive relaxation (happy path): $N = 256$, $u = 0.0$, $\\sigma = 1000.0$, $E_z(x) = E_0 \\sin(2\\pi x/L)$ with $E_0 = 10^3$, $B_y(x) = 0.0$.\n  2. Vacuum constant fields (edge case with zero derivatives): $N = 64$, $u = 0.0$, $\\sigma = 0.0$, $E_z(x) = E_0$ with $E_0 = 10^2$, $B_y(x) = B_0$ with $B_0 = 10^{-4}$.\n  3. Vacuum standing wave (coverage of wave propagation): $N = 256$, $u = 0.0$, $\\sigma = 0.0$, $E_z(x) = E_0 \\sin(2\\pi x/L)$ with $E_0 = 10^3$, $B_y(x) = \\left(E_0/c\\right) \\sin(2\\pi x/L)$.\n\nFor each case, use $\\Delta t = \\mathrm{CFL}\\times \\Delta x / c$ and periodic boundaries implemented via index wrapping. Although the combined energy $U = \\rho u^2/2 + p/(\\gamma-1) + B_y^2/(2\\mu_0) + \\epsilon_0 E_z^2/2$ is defined, for this test you only need the electromagnetic part. The program must produce a single line of output containing the results for the three test cases as a comma-separated list enclosed in square brackets, for example, $\\left[\\mathrm{true},\\mathrm{false},\\mathrm{true}\\right]$. The booleans must be lowercase Python literals without units.", "solution": "The problem is validated as scientifically grounded, well-posed, and self-contained. The provided equations and discretization methods are standard in computational physics. The task is a well-defined numerical experiment to assess the local energy conservation properties of a specific finite-difference time-domain scheme.\n\n### Part 1: Continuous Energy Balance Derivation\n\nThe problem asks for a derivation of the combined energy balance, showing the coupling between the fluid and electromagnetic components. The total energy density is the sum of the fluid energy density (kinetic plus internal) and the electromagnetic energy density:\n$$\nU = \\underbrace{\\frac{1}{2}\\rho u^2 + \\frac{p}{\\gamma-1}}_{\\mathcal{E}_{\\mathrm{fluid}}} + \\underbrace{\\frac{1}{2}\\epsilon_0 E^2 + \\frac{1}{2\\mu_0} B^2}_{U_{\\mathrm{em}}}\n$$\nWe will analyze the time evolution of each component.\n\nThe evolution of the electromagnetic energy density, $U_{\\mathrm{em}}$, is governed by the Poynting theorem, which is provided:\n$$\n\\frac{\\partial U_{\\mathrm{em}}}{\\partial t} + \\nabla \\cdot \\mathbf{S} = -\\mathbf{J} \\cdot \\mathbf{E}\n$$\nHere, $\\mathbf{S} = (\\mathbf{E} \\times \\mathbf{B})/\\mu_0$ is the Poynting vector, representing the directional energy flux of the electromagnetic field. The term $-\\mathbf{J} \\cdot \\mathbf{E}$ on the right-hand side represents a sink of electromagnetic energy. This energy is transferred from the fields to the charge carriers, which in this model constitute the fluid.\n\nThe evolution of the fluid energy density, $\\mathcal{E}_{\\mathrm{fluid}}$, is governed by the energy equation from fluid dynamics, augmented with a source term representing the work done by the electromagnetic fields on the fluid. This source term is precisely the energy lost by the fields, so the fluid energy balance equation is:\n$$\n\\frac{\\partial \\mathcal{E}_{\\mathrm{fluid}}}{\\partial t} + \\nabla \\cdot \\mathbf{F}_{\\mathrm{fluid}} = \\mathbf{J} \\cdot \\mathbf{E}\n$$\nwhere $\\mathbf{F}_{\\mathrm{fluid}} = \\left(\\mathcal{E}_{\\mathrm{fluid}} + p\\right)\\mathbf{u}$ is the fluid energy flux (enthalpy flux plus kinetic energy flux). This equation shows that the term $\\mathbf{J} \\cdot \\mathbf{E}$ acts as an energy source for the fluid.\n\nAdding the two balance equations together, the coupling term $\\mathbf{J} \\cdot \\mathbf{E}$ cancels out:\n$$\n\\frac{\\partial (U_{\\mathrm{em}} + \\mathcal{E}_{\\mathrm{fluid}})}{\\partial t} + \\nabla \\cdot (\\mathbf{S} + \\mathbf{F}_{\\mathrm{fluid}}) = 0\n$$\nThis is the conservation law for the total combined energy, where the total energy density is $U$ and the total energy flux is the sum of the Poynting vector and the fluid energy flux.\n\nThe problem further asks to elaborate on how mechanical work couples to the fluid. The energy source term for the fluid, $\\mathbf{J} \\cdot \\mathbf{E}$, can be partitioned. The rate of mechanical work done on the fluid by the Lorentz force, $\\mathbf{f}_{\\mathrm{L}} = \\mathbf{J} \\times \\mathbf{B}$, changes the fluid's kinetic energy density, $\\frac{1}{2}\\rho u^2$, at a rate of $\\mathbf{u} \\cdot (\\mathbf{J} \\times \\mathbf{B})$. The remainder of the energy input goes into the fluid's internal energy, $p/(\\gamma-1)$. This change in internal energy is due to Joule heating, given by the rate $Q_{\\mathrm{Joule}} = (\\mathbf{J} \\cdot \\mathbf{E}) - \\mathbf{u} \\cdot (\\mathbf{J} \\times \\mathbf{B})$. Using vector identities and the given Ohm's law, $\\mathbf{J} = \\sigma(\\mathbf{E} + \\mathbf{u} \\times \\mathbf{B})$, this heating term simplifies to:\n$$\nQ_{\\mathrm{Joule}} = \\mathbf{J} \\cdot (\\mathbf{E} + \\mathbf{u} \\times \\mathbf{B}) = \\frac{1}{\\sigma} |\\mathbf{J}|^2 \\geq 0\n$$\nThus, the coupling term $\\mathbf{J} \\cdot \\mathbf{E}$ transfers energy from the electromagnetic field to the fluid, where it is partitioned into kinetic energy via mechanical work and internal energy via resistive heating.\n\n### Part 2: Discrete Energy Balance and Residual Calculation\n\nThe computational task is to evaluate the degree to which a specific numerical scheme satisfies a discrete version of the Poynting theorem. A perfect numerical scheme would exactly preserve the energy balance, resulting in a zero residual. The chosen scheme, employing forward Euler time stepping and second-order central differences, is not designed for exact energy conservation, so a non-zero residual is expected due to truncation errors. The goal is to quantify this residual.\n\nThe algorithm proceeds as follows for each test case:\n1.  **Setup**: The physical domain of length $L=1.0$ is discretized into $N$ cells of width $\\Delta x = L/N$. Constants $c$, $\\mu_0$, $\\epsilon_0$, and the Courant-Friedrichs-Lewy number $\\mathrm{CFL}=0.1$ are defined. The time step $\\Delta t$ is calculated as $\\Delta t = \\mathrm{CFL} \\cdot \\Delta x / c$.\n2.  **Initialization**: At time $t=0$ (or discrete level $n$), the fields $E_z$ and $B_y$ are initialized on the grid nodes $x_i = i \\Delta x$ according to the functions specified in each test case.\n3.  **Compute Terms at Level n**: Using the field values $E_i^n$ and $B_i^n$:\n    - The current density $J_i^n = \\sigma (E_i^n + u B_i^n)$ is calculated.\n    - The spatial derivatives $(\\partial_x E)_i^n$ and $(\\partial_x B)_i^n$ are computed using second-order central differences with periodic boundary conditions.\n    - The Poynting flux at cell interfaces, $S_{x, i\\pm 1/2}^n$, is computed by averaging field values.\n    - The divergence of the Poynting vector, $(\\nabla \\cdot \\mathbf{S})_i^n$, is computed using a central difference of the interface fluxes.\n    - The initial electromagnetic energy density $U_{\\mathrm{em},i}^n$ is calculated.\n4.  **Time Advancement**: The fields are advanced by one step to level $n+1$ using the explicit forward Euler method:\n    $$\n    E_i^{n+1} = E_i^n + \\Delta t \\left(c^2 (\\partial_x B)_i^n - J_i^n/\\epsilon_0\\right)\n    $$\n    $$\n    B_i^{n+1} = B_i^n + \\Delta t (\\partial_x E)_i^n\n    $$\n5.  **Compute Terms at Level n+1**: The final electromagnetic energy density $U_{\\mathrm{em},i}^{n+1}$ is calculated from the updated fields $E_i^{n+1}$ and $B_i^{n+1}$.\n6.  **Residual Calculation**: The discrete residual of the Poynting theorem, $R_i$, is computed for each cell:\n    $$\n    R_i = \\frac{U_{\\mathrm{em},i}^{n+1} - U_{\\mathrm{em},i}^n}{\\Delta t} + (\\nabla \\cdot \\mathbf{S})_i^n + J_i^n E_i^n\n    $$\n    This $R_i$ measures the local imbalance in the discrete energy equation.\n7.  **Normalization and Evaluation**: The root-mean-square (RMS) norm of the residual array $R$ is computed. This is normalized by the sum of the RMS norms of the individual terms in the balance equation to get a relative error metric $\\mathcal{R}$.\n    $$\n    \\mathcal{R} = \\frac{\\mathrm{rms}(R)}{\\mathrm{rms}\\left(\\frac{U_{\\mathrm{em}}^{n+1} - U_{\\mathrm{em}}^n}{\\Delta t}\\right) + \\mathrm{rms}\\left(\\nabla \\cdot \\mathbf{S}\\right) + \\mathrm{rms}\\left(J E\\right) + \\varepsilon}\n    $$\n    Finally, this normalized residual $\\mathcal{R}$ is compared against the tolerance $\\tau=10^{-3}$. The result is `true` if $\\mathcal{R}  \\tau$ and `false` otherwise. This procedure is repeated for all three test cases.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem for the three specified test cases.\n    \"\"\"\n    \n    # Constants\n    L = 1.0\n    C_LIGHT = 299792458.0\n    MU_0 = 4.0 * np.pi * 1.0e-7\n    EPSILON_0 = 1.0 / (MU_0 * C_LIGHT**2)\n    TOLERANCE = 1.0e-3\n    CFL = 0.1\n    EPSILON_STAB = 1.0e-30\n\n    # Test suite cases\n    # (N, u, sigma, E0, B0_factor, wave_type)\n    # B0_factor is a multiplier for B_y initializer. If wave_type is 'const', B0 is absolute.\n    test_cases = [\n        # 1. Resistive relaxation\n        {'N': 256, 'u': 0.0, 'sigma': 1000.0, 'E0': 1000.0, 'B0': 0.0, 'wave_type': 'sin', 'B_is_absolute': True},\n        # 2. Vacuum constant fields\n        {'N': 64, 'u': 0.0, 'sigma': 0.0, 'E0': 100.0, 'B0': 1.0e-4, 'wave_type': 'const', 'B_is_absolute': True},\n        # 3. Vacuum standing wave\n        {'N': 256, 'u': 0.0, 'sigma': 0.0, 'E0': 1000.0, 'B0': 1.0 / C_LIGHT, 'wave_type': 'sin', 'B_is_absolute': False}\n    ]\n\n    results = []\n\n    for case in test_cases:\n        N = case['N']\n        u = case['u']\n        sigma = case['sigma']\n        E0 = case['E0']\n        B0 = case['B0']\n        wave_type = case['wave_type']\n        B_is_absolute = case['B_is_absolute']\n\n        # Discretization\n        dx = L / N\n        dt = CFL * dx / C_LIGHT\n        x = np.linspace(0, L, N, endpoint=False)\n\n        # Initial conditions at time n\n        if wave_type == 'sin':\n            E_n = E0 * np.sin(2.0 * np.pi * x / L)\n            if B_is_absolute:\n                B_n = B0 * np.ones(N) # Case 1 has B0=0, so this works\n            else: # Case 3\n                B_n = E0 * B0 * np.sin(2.0 * np.pi * x / L) \n        elif wave_type == 'const': # Case 2\n            E_n = E0 * np.ones(N)\n            B_n = B0 * np.ones(N)\n\n        # --- Calculations at time n ---\n\n        # Current density J_z\n        J_n = sigma * (E_n + u * B_n)\n\n        # Spatial derivatives using 2nd-order central differences with periodic BCs\n        # np.roll(a, -1) is i+1, np.roll(a, 1) is i-1\n        dEdx_n = (np.roll(E_n, -1) - np.roll(E_n, 1)) / (2.0 * dx)\n        dBdx_n = (np.roll(B_n, -1) - np.roll(B_n, 1)) / (2.0 * dx)\n\n        # Poynting flux S_x = -E_z*B_y/mu_0\n        # Flux at cell interfaces i+1/2\n        E_plus_half = (E_n + np.roll(E_n, -1)) / 2.0\n        B_plus_half = (B_n + np.roll(B_n, -1)) / 2.0\n        S_plus_half = -(1.0 / MU_0) * E_plus_half * B_plus_half\n        \n        # Flux at cell interfaces i-1/2\n        S_minus_half = np.roll(S_plus_half, 1)\n\n        # Divergence of Poynting vector\n        divS_n = (S_plus_half - S_minus_half) / dx\n\n        # JE term\n        JE_n = J_n * E_n\n\n        # EM energy density at time n\n        U_em_n = 0.5 * EPSILON_0 * E_n**2 + 0.5 * (1.0 / MU_0) * B_n**2\n\n        # --- Time step to n+1 using Forward Euler ---\n        E_n1 = E_n + dt * (C_LIGHT**2 * dBdx_n - J_n / EPSILON_0)\n        B_n1 = B_n + dt * dEdx_n\n\n        # --- Calculations at time n+1 ---\n        # EM energy density at time n+1\n        U_em_n1 = 0.5 * EPSILON_0 * E_n1**2 + 0.5 * (1.0 / MU_0) * B_n1**2\n\n        # --- Residual Calculation ---\n        # Time derivative of energy\n        dUdt = (U_em_n1 - U_em_n) / dt\n\n        # Residual R_i\n        R = dUdt + divS_n + JE_n\n        \n        # RMS norm function\n        def rms(X):\n            return np.sqrt(np.mean(X**2))\n\n        # Calculate normalized residual R\n        rms_R = rms(R)\n        rms_dUdt = rms(dUdt)\n        rms_divS = rms(divS_n)\n        rms_JE = rms(JE_n)\n\n        denominator = rms_dUdt + rms_divS + rms_JE + EPSILON_STAB\n        \n        # Avoid division by zero if all terms are zero (e.g. Case 2)\n        if denominator == EPSILON_STAB:\n            # If numerator is also zero, residual is 0. Otherwise, it is large.\n            # In this problem setup, for Case 2, numerator is also 0.\n            R_norm = 0.0\n        else:\n            R_norm = rms_R / denominator\n        \n        results.append(R_norm  TOLERANCE)\n\n    # Format output as a list of lowercase boolean strings\n    result_str = ','.join(str(res).lower() for res in results)\n    print(f\"[{result_str}]\")\n\nsolve()\n\n```", "id": "3522867"}]}