{"hands_on_practices": [{"introduction": "To truly understand higher-order solvers, we must go beyond simply applying formulas and dissect their construction. This first practice provides a foundational analysis of the Milstein scheme by applying it to the ubiquitous Geometric Brownian Motion model, for which an exact analytical solution is known. By deriving the scheme from the Itô-Taylor expansion and meticulously comparing it to the exact solution, you will gain a concrete understanding of how the Milstein method achieves its strong order of convergence and learn to quantify its local error. [@problem_id:3311886]", "problem": "Consider the one-dimensional stochastic differential equation (SDE) for geometric Brownian motion,\n$$\ndX_{t}=\\mu X_{t}\\,dt+\\sigma X_{t}\\,dW_{t},\n$$\nwhere $W_{t}$ is a standard Brownian motion, $\\mu\\in\\mathbb{R}$ and $\\sigma>0$ are constants, and $X_{t}>0$. Using Itô calculus and the Itô–Taylor expansion as the context-appropriate fundamental base, do the following for a single time step of size $h>0$:\n- Starting from Itô's formula applied to $\\ln X_{t}$, derive the one-step exact solution representation for $X_{t+h}$ in terms of $X_{t}$ and the Brownian increment $\\Delta W:=W_{t+h}-W_{t}$.\n- From the Itô–Taylor expansion of the SDE, formulate the one-step Milstein discretization specialized to this SDE and compare it to the exact one-step solution via a systematic series expansion in powers of $h$ and $\\Delta W$.\n- Show that the Milstein update matches the exact exponential solution up to terms that are of order $h^{3/2}$ in the strong sense (that is, in $L^{2}$ with respect to the Brownian increment).\n- Compute the leading strong local mean-square error constant $C(\\mu,\\sigma)$ defined by the asymptotic expansion\n$$\n\\mathbb{E}\\!\\left[\\left(X_{t+h}-X_{t+h}^{\\mathrm{Mil}}\\right)^{2}\\,\\big|\\,X_{t}\\right]=C(\\mu,\\sigma)\\,X_{t}^{2}\\,h^{3}+o(h^{3})\\quad\\text{as }h\\to 0,\n$$\nwhere $X_{t+h}^{\\mathrm{Mil}}$ denotes the one-step Milstein update.\n\nExpress your final answer as a single closed-form analytic expression for $C(\\mu,\\sigma)$. No numerical approximation is required.", "solution": "The user wants to solve a problem related to the numerical analysis of stochastic differential equations (SDEs), specifically for geometric Brownian motion (GBM).\n\n**Problem Validation**\n\n**Step 1: Extract Givens**\n- The SDE for geometric Brownian motion is $dX_{t}=\\mu X_{t}\\,dt+\\sigma X_{t}\\,dW_{t}$.\n- $W_{t}$ is a standard Brownian motion.\n- $\\mu\\in\\mathbb{R}$ and $\\sigma>0$ are constants.\n- The state is positive, $X_{t}>0$.\n- The time step size is $h>0$.\n- The Brownian increment is $\\Delta W:=W_{t+h}-W_{t}$.\n- The tasks are:\n    1. Derive the one-step exact solution for $X_{t+h}$ using Itô's formula for $\\ln X_{t}$.\n    2. Formulate the one-step Milstein discretization for this SDE.\n    3. Compare the Milstein scheme to the exact solution via series expansion.\n    4. Show that the Milstein update matches the exact solution up to terms of strong order $h^{3/2}$.\n    5. Compute the leading strong local mean-square error constant $C(\\mu,\\sigma)$ from the asymptotic relation:\n       $\\mathbb{E}\\!\\left[\\left(X_{t+h}-X_{t+h}^{\\mathrm{Mil}}\\right)^{2}\\,\\big|\\,X_{t}\\right]=C(\\mu,\\sigma)\\,X_{t}^{2}\\,h^{3}+o(h^{3})$ as $h\\to 0$.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded:** The problem is firmly rooted in the established mathematical theory of stochastic calculus and the numerical analysis of SDEs. The GBM, Itô's formula, Itô-Taylor expansions, and the Milstein scheme are standard and fundamental concepts in this field.\n- **Well-Posed:** The problem is well-posed, providing a clearly defined SDE and a sequence of tasks that lead to a unique, determinable constant $C(\\mu,\\sigma)$. All necessary parameters and definitions are provided.\n- **Objective:** The problem is stated using precise, unambiguous mathematical language and notation. There are no subjective or opinion-based components.\n- **Flaw Checklist:**\n    1.  No scientific or factual unsoundness.\n    2.  The problem is a formal mathematical exercise directly on topic.\n    3.  The setup is complete and consistent.\n    4.  The problem is theoretical and does not involve unrealistic physical conditions.\n    5.  The problem is well-structured and leads to a unique solution.\n    6.  The problem is a standard, non-trivial exercise that tests core concepts.\n    7.  The results are mathematically verifiable.\n\n**Step 3: Verdict and Action**\nThe problem is deemed **valid**. The solution will be derived following the specified tasks.\n\n**Step-by-Step Solution**\n\nThe objective is to compute the constant $C(\\mu,\\sigma)$ that characterizes the leading term of the local mean-square error of the Milstein scheme applied to the geometric Brownian motion SDE. This will be accomplished in four stages as requested.\n\n**1. Derivation of the Exact Solution**\n\nWe consider the SDE $dX_{t}=\\mu X_{t}\\,dt+\\sigma X_{t}\\,dW_{t}$. Let the function be $f(x) = \\ln x$. The derivatives are $f'(x) = 1/x$ and $f''(x) = -1/x^2$. We apply Itô's formula to $Y_t = f(X_t) = \\ln X_t$:\n$$\ndY_{t} = f'(X_{t})\\,dX_{t} + \\frac{1}{2}f''(X_{t})\\,(dX_{t})^{2}\n$$\nThe quadratic variation term $(dX_{t})^2$ is given by $(\\sigma X_{t}\\,dW_{t})^2 = \\sigma^2 X_{t}^2\\,dt$. Substituting the SDE and the quadratic variation into Itô's formula yields:\n$$\nd(\\ln X_{t}) = \\frac{1}{X_{t}}(\\mu X_{t}\\,dt + \\sigma X_{t}\\,dW_{t}) + \\frac{1}{2}\\left(-\\frac{1}{X_{t}^{2}}\\right)(\\sigma^{2}X_{t}^{2}\\,dt)\n$$\n$$\nd(\\ln X_{t}) = (\\mu\\,dt + \\sigma\\,dW_{t}) - \\frac{1}{2}\\sigma^{2}\\,dt\n$$\n$$\nd(\\ln X_{t}) = \\left(\\mu - \\frac{1}{2}\\sigma^{2}\\right)dt + \\sigma\\,dW_{t}\n$$\nIntegrating this from $t$ to $t+h$:\n$$\n\\int_{t}^{t+h} d(\\ln X_{s}) = \\int_{t}^{t+h} \\left(\\mu - \\frac{1}{2}\\sigma^{2}\\right)ds + \\int_{t}^{t+h} \\sigma\\,dW_{s}\n$$\n$$\n\\ln X_{t+h} - \\ln X_{t} = \\left(\\mu - \\frac{1}{2}\\sigma^{2}\\right)h + \\sigma(W_{t+h} - W_{t})\n$$\nUsing the definition $\\Delta W = W_{t+h} - W_{t}$, we get:\n$$\n\\ln\\left(\\frac{X_{t+h}}{X_{t}}\\right) = \\left(\\mu - \\frac{1}{2}\\sigma^{2}\\right)h + \\sigma \\Delta W\n$$\nExponentiating both sides provides the exact solution for $X_{t+h}$:\n$$\nX_{t+h} = X_{t} \\exp\\left(\\left(\\mu - \\frac{1}{2}\\sigma^{2}\\right)h + \\sigma \\Delta W\\right)\n$$\n\n**2. Formulation of the Milstein Discretization**\n\nThe general one-step Milstein discretization for an SDE $dX_t = a(X_t)dt + b(X_t)dW_t$ is given by the Itô-Taylor expansion:\n$$\nX_{t+h}^{\\mathrm{Mil}} = X_{t} + a(X_{t})h + b(X_{t})\\Delta W + \\frac{1}{2}b(X_{t})b'(X_{t})\\left((\\Delta W)^{2} - h\\right)\n$$\nFor the GBM SDE, we have the drift $a(x) = \\mu x$ and the diffusion $b(x) = \\sigma x$. The derivative of the diffusion coefficient with respect to $x$ is $b'(x) = \\sigma$.\nThus, the term $b(X_{t})b'(X_{t}) = (\\sigma X_{t})(\\sigma) = \\sigma^{2}X_{t}$.\nSubstituting these into the general Milstein formula gives:\n$$\nX_{t+h}^{\\mathrm{Mil}} = X_{t} + (\\mu X_{t})h + (\\sigma X_{t})\\Delta W + \\frac{1}{2}(\\sigma^{2}X_{t})\\left((\\Delta W)^{2} - h\\right)\n$$\nFactoring out $X_{t}$:\n$$\nX_{t+h}^{\\mathrm{Mil}} = X_{t}\\left[1 + \\mu h + \\sigma \\Delta W + \\frac{1}{2}\\sigma^{2}\\left((\\Delta W)^{2} - h\\right)\\right]\n$$\n\n**3. Comparison and Strong Error Order**\n\nTo compare the Milstein approximation with the exact solution, we expand the exact solution in a Taylor series. Let $K = \\mu - \\frac{1}{2}\\sigma^{2}$. The exact solution is $X_{t+h} = X_{t}\\exp(Kh + \\sigma \\Delta W)$.\nThe expansion of the exponential function is $\\exp(z) = 1 + z + \\frac{z^2}{2!} + \\frac{z^3}{3!} + \\dots$.\nLet $z = Kh + \\sigma\\Delta W$.\n$$\n\\frac{X_{t+h}}{X_{t}} = 1 + (Kh + \\sigma \\Delta W) + \\frac{1}{2}(Kh + \\sigma \\Delta W)^{2} + \\frac{1}{6}(Kh + \\sigma \\Delta W)^{3} + O(h^{2})\n$$\nThe Milstein scheme can be rewritten as:\n$$\n\\frac{X_{t+h}^{\\mathrm{Mil}}}{X_{t}} = 1 + (\\mu - \\frac{1}{2}\\sigma^{2})h + \\frac{1}{2}\\sigma^{2}h + \\sigma \\Delta W + \\frac{1}{2}\\sigma^{2}(\\Delta W)^{2} - \\frac{1}{2}\\sigma^{2}h = 1 + Kh + \\sigma\\Delta W + \\frac{1}{2}\\sigma^{2}(\\Delta W)^{2}\n$$\nThe local error is $E_{t+h} = X_{t+h} - X_{t+h}^{\\mathrm{Mil}}$. Dividing by $X_t$:\n$$\n\\frac{E_{t+h}}{X_{t}} = \\left(\\frac{X_{t+h}}{X_{t}}\\right) - \\left(\\frac{X_{t+h}^{\\mathrm{Mil}}}{X_{t}}\\right)\n$$\n$$\n\\frac{E_{t+h}}{X_{t}} = \\left[1 + (Kh + \\sigma \\Delta W) + \\frac{1}{2}(Kh + \\sigma \\Delta W)^{2} + \\dots\\right] - \\left[1 + Kh + \\sigma\\Delta W + \\frac{1}{2}\\sigma^{2}(\\Delta W)^{2}\\right]\n$$\nThe terms $1$, $Kh$, and $\\sigma\\Delta W$ cancel.\n$$\n\\frac{E_{t+h}}{X_{t}} = \\frac{1}{2}\\left[(Kh + \\sigma \\Delta W)^{2} - \\sigma^{2}(\\Delta W)^{2}\\right] + \\frac{1}{6}(Kh + \\sigma \\Delta W)^{3} + \\dots\n$$\nExpanding the squared and cubed terms:\n$$\n\\frac{E_{t+h}}{X_{t}} = \\frac{1}{2}\\left[K^{2}h^{2} + 2K\\sigma h \\Delta W + \\sigma^{2}(\\Delta W)^{2} - \\sigma^{2}(\\Delta W)^{2}\\right] + \\frac{1}{6}\\left[\\sigma^{3}(\\Delta W)^{3} + 3K\\sigma^{2}h(\\Delta W)^{2} + \\dots\\right] + \\dots\n$$\n$$\n\\frac{E_{t+h}}{X_{t}} = K\\sigma h \\Delta W + \\frac{1}{2}K^{2}h^{2} + \\frac{1}{6}\\sigma^{3}(\\Delta W)^{3} + \\frac{1}{2}K\\sigma^{2}h(\\Delta W)^{2} + \\dots\n$$\nThe strong order of a term is determined by its $L^{2}$ norm. We have $\\|\\Delta W\\|_{L^2} \\propto h^{1/2}$.\nThe leading terms in the error are $K\\sigma h \\Delta W$ and $\\frac{1}{6}\\sigma^{3}(\\Delta W)^{3}$.\nThe $L^2$-norm of the first term is $\\|K\\sigma h \\Delta W\\|_{L^2} = |K\\sigma| h \\|\\Delta W\\|_{L^2} = |K\\sigma| h^{3/2}$, which is of order $h^{3/2}$.\nThe $L^2$-norm of the second term is $\\|\\frac{1}{6}\\sigma^{3}(\\Delta W)^{3}\\|_{L^2} = \\frac{1}{6}|\\sigma^{3}| (\\mathbb{E}[(\\Delta W)^{6}])^{1/2} = \\frac{1}{6}|\\sigma^{3}| (15h^{3})^{1/2} \\propto h^{3/2}$.\nSince the lowest order error terms have a strong order of $h^{3/2}$, the Milstein scheme matches the exact solution up to this order.\n\n**4. Computation of the Error Constant $C(\\mu, \\sigma)$**\n\nWe need to compute $\\mathbb{E}[E_{t+h}^{2} | X_{t}]$, which is $X_{t}^{2} \\mathbb{E}[ (E_{t+h}/X_{t})^{2} ]$. We need to find the coefficient of $h^3$ in this expectation. The leading error terms found above are sufficient. Let $R_{h} = E_{t+h}/X_{t}$.\nThe part of $R_h$ that will contribute to the $h^3$ term in $\\mathbb{E}[R_h^2]$ consists of terms with strong order $h^{3/2}$.\n$$\nR_{h}^{(1.5)} = K\\sigma h \\Delta W + \\frac{1}{6}\\sigma^{3}(\\Delta W)^{3}\n$$\nHigher order terms in $R_h$ involve terms like $h^2$, $h(\\Delta W)^2$, etc., which are of strong order $h^2$. When squared, these will contribute terms of order $h^4$ or higher to the mean-square error. Cross-terms between $R_{h}^{(1.5)}$ and higher-order terms with even powers of $\\Delta W$ will have zero expectation due to the odd moments of $\\Delta W$ being zero. Therefore, we only need to compute $\\mathbb{E}[(R_h^{(1.5)})^2]$.\n$$\n\\mathbb{E}\\left[\\left(K\\sigma h \\Delta W + \\frac{1}{6}\\sigma^{3}(\\Delta W)^{3}\\right)^{2}\\right] = \\mathbb{E}\\left[ (K\\sigma h \\Delta W)^{2} + 2(K\\sigma h \\Delta W)\\left(\\frac{1}{6}\\sigma^{3}(\\Delta W)^{3}\\right) + \\left(\\frac{1}{6}\\sigma^{3}(\\Delta W)^{3}\\right)^{2} \\right]\n$$\n$$\n= K^{2}\\sigma^{2}h^{2}\\mathbb{E}[(\\Delta W)^{2}] + \\frac{1}{3}K\\sigma^{4}h\\,\\mathbb{E}[(\\Delta W)^{4}] + \\frac{1}{36}\\sigma^{6}\\mathbb{E}[(\\Delta W)^{6}]\n$$\nThe moments of the Brownian increment $\\Delta W \\sim N(0,h)$ are $\\mathbb{E}[(\\Delta W)^{2}] = h$, $\\mathbb{E}[(\\Delta W)^{4}] = 3h^{2}$, and $\\mathbb{E}[(\\Delta W)^{6}] = 15h^{3}$. Substituting these in:\n$$\n= K^{2}\\sigma^{2}h^{2}(h) + \\frac{1}{3}K\\sigma^{4}h(3h^{2}) + \\frac{1}{36}\\sigma^{6}(15h^{3})\n$$\n$$\n= \\left(K^{2}\\sigma^{2} + K\\sigma^{4} + \\frac{15}{36}\\sigma^{6}\\right)h^{3} = \\left(K^{2}\\sigma^{2} + K\\sigma^{4} + \\frac{5}{12}\\sigma^{6}\\right)h^{3}\n$$\nThus, $\\mathbb{E}[E_{t+h}^2 | X_t] = X_t^2 \\left(K^{2}\\sigma^{2} + K\\sigma^{4} + \\frac{5}{12}\\sigma^{6}\\right)h^{3} + o(h^3)$.\nThe constant is $C(\\mu,\\sigma) = K^{2}\\sigma^{2} + K\\sigma^{4} + \\frac{5}{12}\\sigma^{6}$.\nNow substitute back $K = \\mu - \\frac{1}{2}\\sigma^{2}$:\n$$\nC(\\mu,\\sigma) = \\left(\\mu - \\frac{1}{2}\\sigma^{2}\\right)^{2}\\sigma^{2} + \\left(\\mu - \\frac{1}{2}\\sigma^{2}\\right)\\sigma^{4} + \\frac{5}{12}\\sigma^{6}\n$$\nExpanding the terms:\n$$\n= \\left(\\mu^{2} - \\mu\\sigma^{2} + \\frac{1}{4}\\sigma^{4}\\right)\\sigma^{2} + \\left(\\mu\\sigma^{4} - \\frac{1}{2}\\sigma^{6}\\right) + \\frac{5}{12}\\sigma^{6}\n$$\n$$\n= \\mu^{2}\\sigma^{2} - \\mu\\sigma^{4} + \\frac{1}{4}\\sigma^{6} + \\mu\\sigma^{4} - \\frac{1}{2}\\sigma^{6} + \\frac{5}{12}\\sigma^{6}\n$$\nThe terms $-\\mu\\sigma^4$ and $+\\mu\\sigma^4$ cancel out. We combine the coefficients of $\\sigma^6$:\n$$\n= \\mu^{2}\\sigma^{2} + \\sigma^{6}\\left(\\frac{1}{4} - \\frac{1}{2} + \\frac{5}{12}\\right)\n$$\n$$\n= \\mu^{2}\\sigma^{2} + \\sigma^{6}\\left(\\frac{3}{12} - \\frac{6}{12} + \\frac{5}{12}\\right)\n$$\n$$\n= \\mu^{2}\\sigma^{2} + \\sigma^{6}\\left(\\frac{2}{12}\\right)\n$$\n$$\nC(\\mu,\\sigma) = \\mu^{2}\\sigma^{2} + \\frac{1}{6}\\sigma^{6}\n$$\nThis is the final expression for the leading strong local mean-square error constant.", "answer": "$$\\boxed{\\mu^{2}\\sigma^{2}+\\frac{1}{6}\\sigma^{6}}$$", "id": "3311886"}, {"introduction": "The elegant simplicity of the scalar Milstein scheme can be deceptive; new challenges emerge when we move to multiple dimensions. This practice explores the critical complication that arises when an SDE is driven by multiple, non-commuting noise sources, a common scenario in complex systems. You will investigate why the straightforward extension of the Milstein scheme fails to achieve a strong order of $1.0$ and discover the crucial role of the Lévy area, a term capturing the interaction between different Brownian motions, in restoring higher-order accuracy. [@problem_id:3311879]", "problem": "Consider the Itō stochastic differential equation (SDE) in the scalar case\n$$\ndX_{t} \\;=\\; a\\!\\left(X_{t}\\right) \\, dt \\;+\\; b\\!\\left(X_{t}\\right) \\, dW_{t}, \\qquad X_{0} \\in \\mathbb{R},\n$$\nwhere $a:\\mathbb{R}\\to\\mathbb{R}$ and $b:\\mathbb{R}\\to\\mathbb{R}$ are sufficiently smooth with bounded derivatives up to the order needed for the arguments below, and $W_{t}$ is a standard Brownian motion. Use the Itō–Taylor expansion and the theory of colored rooted trees for strong approximations to address the following.\n\nFirst, starting from the Itō formula and the definition of elementary differentials associated with colored rooted trees, verify that a one-step scheme that augments the Euler–Maruyama increment by the unique order-$1$ stochastic correction available in one dimension satisfies all tree-based strong order conditions up to order $1$ in the scalar case. Your derivation must explicitly match coefficients of the Itō–Taylor expansion with the scheme’s elementary weights for all trees of grade at most $1$, without relying on any pre-stated discretization formula.\n\nNext, consider the multidimensional Itō SDE without drift\n$$\ndX_{t} \\;=\\; b_{1}\\!\\left(X_{t}\\right) \\, dW^{1}_{t} \\;+\\; b_{2}\\!\\left(X_{t}\\right) \\, dW^{2}_{t}, \\qquad X_{t}\\in\\mathbb{R}^{2},\n$$\nwith independent standard Brownian motions $W^{1}_{t}$ and $W^{2}_{t}$, and diffusion vector fields\n$$\nb_{1}(x) \\;=\\; \\begin{pmatrix} x_{2} \\\\ 0 \\end{pmatrix}, \n\\qquad \nb_{2}(x) \\;=\\; \\begin{pmatrix} 0 \\\\ x_{1} \\end{pmatrix},\n\\qquad x \\;=\\; \\begin{pmatrix} x_{1} \\\\ x_{2} \\end{pmatrix} \\in \\mathbb{R}^{2}.\n$$\nStarting from the Stratonovich–Taylor expansion and the relation between symmetric and antisymmetric iterated stochastic integrals, identify which tree-based order-$1$ conditions necessarily involve the Lévy area. Explain why, in the presence of noncommuting diffusion vector fields, omitting Lévy area simulation in a Milstein-type method causes those conditions to fail.\n\nFinally, assume a one-step method that incorporates all symmetric iterated stochastic integral contributions expressible via products of Brownian increments but does not simulate the Lévy area. For a single time step of length $h>0$ starting from deterministic $X_{t}=x$, define the local strong error $e_{h} \\coloneqq X_{t+h} - X_{t+h}^{\\text{num}}$. Compute the leading-order mean-square local error coefficient arising solely from the missing Lévy area by evaluating the limit\n$$\nC(x) \\;=\\; \\lim_{h \\to 0} \\; \\frac{12}{h^{2}} \\, \\mathbb{E}\\!\\left[ \\, \\| e_{h} \\|^{2} \\, \\big| \\, X_{t}=x \\right],\n$$\nwhere $\\| \\cdot \\|$ is the Euclidean norm on $\\mathbb{R}^{2}$. Express your final answer as a simplified analytic expression in terms of $x_{1}$ and $x_{2}$. No numerical approximation is required. The final answer must be given as a single closed-form analytical expression with no units.", "solution": "The user wants me to solve a three-part problem on higher-order numerical methods for stochastic differential equations (SDEs).\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n**Part 1:**\n- Scalar Itō SDE: $dX_{t} = a(X_{t}) dt + b(X_{t}) dW_{t}$, with $X_{0} \\in \\mathbb{R}$.\n- $a:\\mathbb{R}\\to\\mathbb{R}$ and $b:\\mathbb{R}\\to\\mathbb{R}$ are sufficiently smooth with bounded derivatives.\n- $W_{t}$ is a standard Brownian motion.\n- Task: Verify that a one-step scheme, consisting of the Euler–Maruyama increment plus the unique order-$1$ stochastic correction, satisfies all tree-based strong order conditions up to order $1$ in the scalar case.\n- Method: Use Itō–Taylor expansion and colored rooted trees. The derivation must match coefficients for all trees of grade at most $1$.\n\n**Part 2:**\n- Multidimensional Itō SDE: $dX_{t} = b_{1}(X_{t}) dW^{1}_{t} + b_{2}(X_{t}) dW^{2}_{t}$, with $X_{t}\\in\\mathbb{R}^{2}$.\n- $W^{1}_{t}$ and $W^{2}_{t}$ are independent standard Brownian motions.\n- Diffusion vector fields: $b_{1}(x) = \\begin{pmatrix} x_{2} \\\\ 0 \\end{pmatrix}$, $b_{2}(x) = \\begin{pmatrix} 0 \\\\ x_{1} \\end{pmatrix}$ for $x = \\begin{pmatrix} x_{1} \\\\ x_{2} \\end{pmatrix} \\in \\mathbb{R}^{2}$.\n- Task: Identify which tree-based order-$1$ conditions involve the Lévy area, starting from the Stratonovich–Taylor expansion. Explain why omitting Lévy area simulation causes these conditions to fail for noncommuting diffusion fields.\n\n**Part 3:**\n- Scheme: A one-step method incorporating all symmetric iterated stochastic integral contributions but not simulating the Lévy area.\n- Time step $h > 0$, starting from deterministic $X_{t}=x$.\n- Local strong error: $e_{h} \\coloneqq X_{t+h} - X_{t+h}^{\\text{num}}$.\n- Task: Compute the leading-order mean-square local error coefficient: $C(x) = \\lim_{h \\to 0} \\frac{12}{h^{2}} \\mathbb{E}[ \\| e_{h} \\|^{2} | X_{t}=x ]$.\n- Norm $\\| \\cdot \\|$ is the Euclidean norm on $\\mathbb{R}^{2}$.\n- The answer must be an analytical expression in $x_1$ and $x_2$.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded:** The problem is firmly rooted in the theory of numerical analysis for SDEs, a well-established field of mathematics. It uses standard concepts like Itō-Taylor expansions, rooted tree theory (B-series for SDEs), Lévy area, and Lie brackets. All concepts are standard and mathematically rigorous. The given SDEs are standard examples.\n- **Well-Posed:** Each part of the problem is well-defined. Part 1 asks for a verification, Part 2 for an explanation, and Part 3 for a computation. The setup provides all necessary information (SDEs, definitions, and the quantity to be computed), leading to a unique and meaningful solution.\n- **Objective:** The problem is stated in precise mathematical language, free from any subjectivity or bias.\n\n**Step 3: Verdict and Action**\nThe problem is valid. It is a standard, challenging problem in stochastic numerical analysis. I will proceed with the solution.\n\n### Part 1: Scalar SDE and Order-1 Scheme Verification\n\nThe strong order conditions for a numerical scheme relate to its ability to reproduce the terms in the Itō–Taylor expansion of the true solution. This matching is formalized using colored rooted trees. A scheme has a strong order of convergence $p$ if the elementary weights of the scheme match the elementary random variables of the true solution for all trees with a grade less than or equal to $p$.\n\nFor the scalar SDE $dX_{t} = a(X_{t}) dt + b(X_{t}) dW_{t}$, the Itō–Taylor expansion of the solution $X_{t+h}$ around $X_t$ is given by a series involving iterated Itō integrals. The terms can be associated with colored rooted trees. We are interested in trees with grade at most $1$.\n\nThe relevant trees are:\n1.  The empty tree, $\\emptyset$, of grade $0$. It corresponds to the solution value $X_t$ itself.\n2.  The tree $\\tau_1 = \\bullet_1$ (a single white root, index $1$ for the Wiener process), of grade $0.5$. It corresponds to the elementary differential $F(\\tau_1) = b$ and the elementary random variable $\\alpha_h(\\tau_1) = I_{(1)} = \\int_t^{t+h} dW_s = \\Delta W_h$.\n3.  The tree $\\tau_0 = \\bullet_0$ (a single black root, index $0$ for time), of grade $1$. It corresponds to the elementary differential $F(\\tau_0) = a$ and the elementary random variable $\\alpha_h(\\tau_0) = I_{(0)} = \\int_t^{t+h} ds = h$.\n4.  The tree $\\tau_{11} = [\\bullet_1]_1$ (a white root with a single white child), of grade $g(\\bullet_1)+g(\\bullet_1) = 0.5+0.5=1$. It corresponds to the elementary differential $F(\\tau_{11}) = b'b$ (where $b'=\\frac{db}{dx}$) and the elementary random variable $\\alpha_h(\\tau_{11}) = I_{(1,1)} = \\int_t^{t+h}\\int_t^s dW_{s'}dW_s = \\frac{1}{2}((\\Delta W_h)^2 - h)$.\n\nTrees of higher grade, such as $\\tau_{01}$ ($g=1.5$) and $\\tau_{10}$ ($g=1.5$), are not relevant for order $1$ conditions.\n\nThe Itō–Taylor expansion of the true solution up to terms of grade $1$ is:\n$$\nX_{t+h} = X_t + F(\\tau_0)(X_t) \\alpha_h(\\tau_0) + F(\\tau_1)(X_t) \\alpha_h(\\tau_1) + F(\\tau_{11})(X_t) \\alpha_h(\\tau_{11}) + O(h^{3/2})\n$$\n$$\nX_{t+h} = X_t + a(X_t) h + b(X_t) \\Delta W_h + b(X_t)b'(X_t) \\frac{1}{2}((\\Delta W_h)^2 - h) + O(h^{3/2})\n$$\n\nThe problem describes a scheme that augments the Euler–Maruyama increment with \"the unique order-$1$ stochastic correction\". The Euler–Maruyama scheme is $X_{n+1}^{\\text{EM}} = X_n + a(X_n)h + b(X_n)\\Delta W_h$. The only missing term of order $1$ is the one corresponding to the tree $\\tau_{11}$. The \"stochastic correction\" is therefore the term that correctly approximates the $I_{(1,1)}$ integral contribution. This leads to the Milstein scheme.\n\nThe scheme is:\n$$\nX_{t+h}^{\\text{num}} = X_t + \\underbrace{a(X_t)h + b(X_t)\\Delta W_h}_{\\text{Euler-Maruyama increment}} + \\underbrace{\\frac{1}{2}b(X_t)b'(X_t) ((\\Delta W_h)^2 - h)}_{\\text{order-1 stochastic correction}}\n$$\n\nTo verify the order conditions, we must identify the elementary weights $\\phi(\\tau)$ of the scheme by matching its terms to the form $\\sum_{\\tau} F(\\tau)(X_t) \\phi(\\tau)$.\nBy direct comparison:\n- For $\\tau_0$: The coefficient of $F(\\tau_0)=a$ is $h$. So, $\\phi(\\tau_0) = h$.\n- For $\\tau_1$: The coefficient of $F(\\tau_1)=b$ is $\\Delta W_h$. So, $\\phi(\\tau_1) = \\Delta W_h$.\n- For $\\tau_{11}$: The coefficient of $F(\\tau_{11})=b'b$ is $\\frac{1}{2}((\\Delta W_h)^2 - h)$. So, $\\phi(\\tau_{11}) = \\frac{1}{2}((\\Delta W_h)^2 - h)$.\n\nNow we check if these weights match the elementary random variables for all trees of grade $\\le 1$:\n- Grade $0.5$: $\\phi(\\tau_1) = \\Delta W_h = \\alpha_h(\\tau_1)$. Condition satisfied.\n- Grade $1$: $\\phi(\\tau_0) = h = \\alpha_h(\\tau_0)$. Condition satisfied.\n- Grade $1$: $\\phi(\\tau_{11}) = \\frac{1}{2}((\\Delta W_h)^2 - h) = \\alpha_h(\\tau_{11})$. Condition satisfied.\n\nSince all tree-based strong order conditions up to order $1$ are satisfied, the verification is complete.\n\n### Part 2: Multidimensional SDE and Lévy Area\n\nWe consider the SDE $dX_{t} = b_{1}(X_{t}) dW^{1}_{t} + b_{2}(X_{t}) dW^{2}_{t}$. A strong order $1$ scheme must correctly approximate the Itō-Taylor expansion up to terms of order $h$. The expansion for a driftless SDE is:\n$$\nX_{t+h} = X_t + \\sum_{j=1,2} b_j(X_t) I_{(j)} + \\sum_{j,k=1,2} (L^k b_j)(X_t) I_{(k,j)} + O(h^{3/2})\n$$\nwhere $I_{(j)} = \\Delta W^j_h$, $I_{(k,j)} = \\int_t^{t+h} \\int_t^s dW^k_{s'} dW^j_s$, and $L^k$ is the differential operator $L^k = \\sum_{i=1,2} b_k^i \\frac{\\partial}{\\partial x_i}$.\n\nThe order $1$ conditions correspond to trees of grade $1$, which are $\\tau_{jk}$ for $j,k \\in \\{1,2\\}$. The condition for tree $\\tau_{kj}$ is that the scheme must correctly represent the term $(L^k b_j) I_{(k,j)}$.\n\nThe multiple stochastic integrals $I_{(k,j)}$ can be decomposed. For $j \\ne k$, we have the identities:\n1.  Symmetric part: $I_{(k,j)} + I_{(j,k)} = \\Delta W^j_h \\Delta W^k_h$\n2.  Antisymmetric part (Lévy Area): $A_{jk} = \\frac{1}{2} (I_{(j,k)} - I_{(k,j)})$\n\nFrom these, we can express the integral $I_{(k,j)}$ as:\n$I_{(k,j)} = \\frac{1}{2}\\Delta W^j_h \\Delta W^k_h - A_{jk} = \\frac{1}{2}\\Delta W^j_h \\Delta W^k_h + A_{kj}$.\n\nLet's examine the sum of cross-terms ($j \\neq k$) in the expansion:\n$$\n(L^2 b_1) I_{(2,1)} + (L^1 b_2) I_{(1,2)} = (L^2 b_1) \\left(\\frac{1}{2}\\Delta W^1_h \\Delta W^2_h + A_{21}\\right) + (L^1 b_2) \\left(\\frac{1}{2}\\Delta W^1_h \\Delta W^2_h + A_{12}\\right)\n$$\nUsing $A_{21} = -A_{12}$, the expression becomes:\n$$\n\\frac{1}{2} (L^1 b_2 + L^2 b_1) \\Delta W^1_h \\Delta W^2_h + (L^1 b_2 - L^2 b_1) A_{12}\n$$\nThe term $L^1 b_2 - L^2 b_1$ is the Lie bracket $[b_1, b_2]$. A Milstein-type method that does not simulate the Lévy area only includes the symmetric part, which can be expressed using products of Brownian increments $\\Delta W^j_h$. Such a scheme approximates $I_{(k,j)}$ with $\\frac{1}{2}\\Delta W^j_h \\Delta W^k_h$.\n\nThe order condition for tree $\\tau_{kj}$ (where $k \\neq j$), which has elementary differential $F(\\tau_{kj}) = L^k b_j$, fails if the scheme uses the weight $\\tilde{\\phi}(\\tau_{kj}) = \\frac{1}{2}\\Delta W^k_h \\Delta W^j_h$ instead of the true random variable $\\alpha_h(\\tau_{kj}) = I_{(k,j)}$. The difference is:\n$$\n\\alpha_h(\\tau_{kj}) - \\tilde{\\phi}(\\tau_{kj}) = I_{(k,j)} - \\frac{1}{2}\\Delta W^k_h \\Delta W^j_h = A_{kj}\n$$\nThe error introduced by this mis-approximation is proportional to $(L^k b_j - L^j b_k) A_{kj} = [b_k,b_j] A_{kj}$. This term is non-zero if the Lie bracket $[b_k, b_j]$ is non-zero. For the given vector fields:\n$L^1 = x_2 \\frac{\\partial}{\\partial x_1}$, $L^2 = x_1 \\frac{\\partial}{\\partial x_2}$.\n$$\n[b_1, b_2] = L^1 b_2 - L^2 b_1 = x_2 \\frac{\\partial}{\\partial x_1} \\begin{pmatrix} 0 \\\\ x_1 \\end{pmatrix} - x_1 \\frac{\\partial}{\\partial x_2} \\begin{pmatrix} x_2 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ x_2 \\end{pmatrix} - \\begin{pmatrix} x_1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} -x_1 \\\\ x_2 \\end{pmatrix}\n$$\nSince $[b_1, b_2] \\neq 0$, the diffusion vector fields do not commute. Therefore, the tree-based order-$1$ conditions corresponding to the trees $\\tau_{12}$ and $\\tau_{21}$ necessarily involve the Lévy area $A_{12}$. Omitting its simulation causes these conditions to fail, leading to a reduction in the strong order of convergence from $1.0$ to $0.5$.\n\n### Part 3: Mean-Square Local Error Calculation\n\nThe local strong error is $e_h = X_{t+h} - X_{t+h}^{\\text{num}}$. The scheme under consideration incorporates symmetric contributions but omits the Lévy area term. The Itō-Taylor expansion of the true solution is:\n$$\nX_{t+h} = X_t + \\sum_{j} b_j I_{(j)} + \\sum_{j} L^j b_j I_{(j,j)} + \\sum_{j<k} \\left[ \\frac{1}{2}(L^j b_k + L^k b_j)\\Delta W^j_h \\Delta W^k_h + [b_j, b_k] A_{jk} \\right] + \\dots\n$$\nThe numerical scheme is:\n$$\nX_{t+h}^{\\text{num}} = X_t + \\sum_{j} b_j \\Delta W^j_h + \\sum_{j} L^j b_j I_{(j,j)} + \\sum_{j<k} \\frac{1}{2}(L^j b_k + L^k b_j)\\Delta W^j_h \\Delta W^k_h\n$$\nNote that we use the exact value for $I_{(j,j)}$ since it can be expressed in terms of $\\Delta W^j_h$. For our specific SDE, $L^j b_j(x)=0$ for $j=1,2$. The leading-order error is the difference between these two expansions, which is precisely the omitted Lévy area term:\n$$\ne_{h} \\approx [b_1, b_2](x) A_{12}\n$$\nwhere $x=X_t$ is deterministic. The square of the Euclidean norm of the error is:\n$$\n\\| e_{h} \\|^{2} \\approx \\| [b_1, b_2](x) A_{12} \\|^{2} = \\| [b_1, b_2](x) \\|^{2} A_{12}^2\n$$\nWe need to compute the expectation $\\mathbb{E}[\\| e_{h} \\|^{2} | X_t=x]$.\n$$\n\\mathbb{E}[\\| e_{h} \\|^{2} | X_t=x] \\approx \\| [b_1, b_2](x) \\|^{2} \\mathbb{E}[A_{12}^2]\n$$\nThe Lévy area $A_{12} = \\frac{1}{2} \\int_t^{t+h} ( (W_s^1-W_t^1)dW_s^2 - (W_s^2-W_t^2)dW_s^1 )$ is a random variable with mean zero. Its variance is a standard result in stochastic calculus:\n$$\n\\mathbb{E}[A_{12}^2] = \\frac{h^2}{12}\n$$\nSubstituting this into the expression for the expected squared error gives:\n$$\n\\mathbb{E}[\\| e_{h} \\|^{2} | X_t=x] \\approx \\| [b_1, b_2](x) \\|^{2} \\frac{h^2}{12}\n$$\nNow we can compute the coefficient $C(x)$:\n$$\nC(x) = \\lim_{h \\to 0} \\frac{12}{h^{2}} \\mathbb{E}[ \\| e_{h} \\|^{2} | X_{t}=x ] = \\lim_{h \\to 0} \\frac{12}{h^{2}} \\left( \\| [b_1, b_2](x) \\|^{2} \\frac{h^2}{12} + o(h^2) \\right)\n$$\n$$\nC(x) = \\| [b_1, b_2](x) \\|^{2}\n$$\nFrom Part 2, we have the Lie bracket $[b_1, b_2](x) = \\begin{pmatrix} -x_1 \\\\ x_2 \\end{pmatrix}$. Its squared norm is:\n$$\nC(x) = \\left\\| \\begin{pmatrix} -x_1 \\\\ x_2 \\end{pmatrix} \\right\\|^2 = (-x_1)^2 + (x_2)^2 = x_1^2 + x_2^2\n$$\nThe final result is the sum of the squares of the components of the initial state $x$.", "answer": "$$\\boxed{x_{1}^{2} + x_{2}^{2}}$$", "id": "3311879"}, {"introduction": "Many physical systems, from spacecraft attitude dynamics to molecular simulations, evolve on curved geometric manifolds rather than simple Euclidean space. This advanced practice confronts the challenge of simulating such systems, focusing on dynamics on the special orthogonal group $SO(3)$. You will implement and compare standard ambient-space methods with a specialized Lie-group integrator, providing a powerful, hands-on demonstration of why structure-preserving numerical schemes are essential for obtaining physically meaningful and stable long-term simulations. [@problem_id:3311871]", "problem": "Construct a complete, runnable program that compares three numerical integrators for a left-invariant stochastic differential equation on the special orthogonal group $SO(3)$ with multiplicative noise. The stochastic model is given in Stratonovich form by\n$$\n\\mathrm{d}R(t)=R(t)\\circ\\left(A\\,\\mathrm{d}t+B\\,\\mathrm{d}W(t)\\right),\\qquad R(0)=I_{3},\n$$\nwhere $R(t)\\in SO(3)$ is a rotation matrix, $I_{3}$ is the $3\\times 3$ identity matrix, $W(t)$ is a standard one-dimensional Brownian motion, and $A,B\\in\\mathfrak{so}(3)$ are constant skew-symmetric matrices that generate rotations about the same fixed axis. Specifically, use\n$$\nK_{z}=\\begin{bmatrix}0  -1  0 \\\\ 1  0  0 \\\\ 0  0  0\\end{bmatrix},\\qquad A=\\omega K_{z},\\qquad B=\\sigma K_{z},\n$$\nwith scalar parameters $\\omega$ and $\\sigma$. The Brownian increments must be simulated using independent normal random variables with variance $\\Delta t$.\n\nYou must implement and compare the following three schemes:\n\n- A Milstein method in the Itō sense applied to the converted Itō form of the above Stratonovich system, run in the ambient Euclidean space of matrices. Evaluate it in two modes: without any correction and with a projection onto $SO(3)$ after every step.\n- A Stochastic Runge-Kutta (SRK) method for Stratonovich equations, specifically the stochastic Heun scheme, run in the ambient Euclidean space of matrices. Evaluate it in two modes: without any correction and with a projection onto $SO(3)$ after every step.\n- A Lie-group exponential integrator that updates via right multiplication by the matrix exponential of the Lie algebra increment per time step to preserve $SO(3)$ structure by construction.\n\nThe fundamental definitions you may rely on are:\n- The Stratonovich to Itō conversion for matrix-valued stochastic differential equations, where for a left-invariant vector field $V(R)=R B$ with constant $B$, the correction term is $\\tfrac{1}{2}R B^{2}\\,\\mathrm{d}t$.\n- A Milstein method is the next-order strong scheme beyond Euler-Maruyama that incorporates iterated stochastic integrals through a first-order correction driven by the Jacobian of the diffusion.\n- A Stochastic Runge-Kutta (SRK) Heun method for Stratonovich equations is a predictor-corrector scheme that is strong order one for sufficiently smooth coefficients.\n- The nearest $SO(3)$ projection of a real $3\\times 3$ matrix $M$ in the Frobenius norm is obtained via the polar decomposition using the singular value decomposition $M=U\\Sigma V^{\\top}$ and taking $Q=U\\operatorname{diag}(1,1,\\det(UV^{\\top}))V^{\\top}$ to enforce $\\det(Q)=+1$.\n- The geodesic rotation-angle distance between $R_{1},R_{2}\\in SO(3)$ is computed by\n$$\n\\theta(R_{1},R_{2})=\\arccos\\!\\left(\\frac{\\operatorname{tr}(R_{1}^{\\top}R_{2})-1}{2}\\right),\n$$\nwhich must be evaluated in radians, with the argument of $\\arccos$ numerically clamped to the interval $\\left[-1,1\\right]$.\n\nBecause $A$ and $B$ commute in this setup, the exact Stratonovich solution at time $T$ for a given Brownian path is\n$$\nR_{\\text{exact}}(T)=R(0)\\,\\exp\\!\\big(A\\,T+B\\,W(T)\\big),\n$$\nwhere $W(T)$ is the terminal Brownian value accumulated from the same increments used in the numerical schemes.\n\nYour program must:\n- Generate a fixed sequence of Brownian increments for each test case using a specified seed, and use the same increments for all three methods within that test case to enable pathwise comparison.\n- Implement both the unprojected and projected variants for the ambient-space Milstein and SRK-Heun methods, where the projection onto $SO(3)$ is performed after every step in the projected variants.\n- Implement the Lie-group exponential method as a stepwise update $R_{n+1}=R_{n}\\exp\\!\\left(A\\,\\Delta t+B\\,\\Delta W_{n}\\right)$.\n\nFor each test case, compute and report the following eight quantities:\n1. The Frobenius-norm orthogonality defect $||R^{\\top}R-I_{3}||_{F}$ at final time for the Milstein method without projection.\n2. The Frobenius-norm orthogonality defect $||R^{\\top}R-I_{3}||_{F}$ at final time for the SRK-Heun method without projection.\n3. The absolute determinant error $\\left|\\det(R)-1\\right|$ at final time for the Milstein method without projection.\n4. The absolute determinant error $\\left|\\det(R)-1\\right|$ at final time for the SRK-Heun method without projection.\n5. The geodesic rotation-angle error in radians between the projected Milstein solution at final time and the exact solution.\n6. The geodesic rotation-angle error in radians between the projected SRK-Heun solution at final time and the exact solution.\n7. The Frobenius-norm orthogonality defect $||R^{\\top}R-I_{3}||_{F}$ at final time for the Lie-group exponential method.\n8. The geodesic rotation-angle error in radians between the Lie-group exponential solution at final time and the exact solution.\n\nUse the following test suite, where the total time $T$ is measured in the same unit as $t$, the time step is $\\Delta t$, and angles must be reported in radians:\n- Case A (happy path): $T=1.0$, $\\Delta t=0.02$, $\\omega=1.3$, $\\sigma=0.7$, seed $=1234$.\n- Case B (coarse step and stronger noise): $T=1.0$, $\\Delta t=0.2$, $\\omega=1.3$, $\\sigma=1.5$, seed $=5678$.\n- Case C (deterministic boundary): $T=1.0$, $\\Delta t=0.05$, $\\omega=1.3$, $\\sigma=0.0$, seed $=42$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must concatenate the eight results in the exact order listed above for Case A, then the eight results for Case B, then the eight results for Case C. All angles must be in radians. No units other than radians are required.", "solution": "The problem presented is a well-posed and scientifically sound task in the field of geometric numerical integration for stochastic differential equations on Lie groups. All necessary parameters, definitions, and evaluation metrics are provided, and the underlying mathematical framework is standard. The problem is therefore deemed valid and a full solution follows.\n\nThe core of the problem is to compare numerical methods for the left-invariant stochastic differential equation (SDE) on the special orthogonal group $SO(3)$, given in Stratonovich form as:\n$$\n\\mathrm{d}R(t) = R(t) \\circ (A\\,\\mathrm{d}t + B\\,\\mathrm{d}W(t)), \\quad R(0) = I_3\n$$\nwhere $R(t) \\in SO(3)$ is a $3 \\times 3$ rotation matrix, $I_3$ is the identity matrix, and $W(t)$ is a $1$-dimensional standard Brownian motion. The matrices $A, B \\in \\mathfrak{so}(3)$ are constant skew-symmetric generators defined by $A = \\omega K_z$ and $B = \\sigma K_z$, with $\\omega, \\sigma$ being scalar parameters and\n$$\nK_z = \\begin{bmatrix} 0  -1  0 \\\\ 1  0  0 \\\\ 0  0  0 \\end{bmatrix}.\n$$\nSince $A$ and $B$ are scalar multiples of the same matrix $K_z$, they commute: $[A, B] = AB - BA = 0$. This property is crucial as it yields a closed-form expression for the exact solution, which can serve as a benchmark for the numerical schemes. Given a realization of the Brownian path with terminal value $W(T) = \\int_0^T \\mathrm{d}W(t)$, the exact solution at time $T$ is:\n$$\nR_{\\text{exact}}(T) = R(0) \\exp(A\\,T + B\\,W(T)) = \\exp(A\\,T + B\\,W(T))\n$$\nThe matrix exponential is computed for the skew-symmetric matrix $A\\,T + B\\,W(T)$, guaranteeing that $R_{\\text{exact}}(T) \\in SO(3)$.\n\nWe will implement and compare three distinct numerical integration schemes. Two of these operate in the ambient Euclidean space $\\mathbb{R}^{3 \\times 3}$, while the third is a geometric integrator designed to preserve the $SO(3)$ group structure by construction.\n\nFor the ambient-space methods, we must distinguish between the Stratonovich and Itō forms of the SDE. The given equation is in Stratonovich form. To apply an Itō-based solver like the Milstein method, we must first convert the SDE. For a left-invariant SDE with noise term $R(t) B$, the Itō correction term is $\\frac{1}{2} R(t) B^2 \\mathrm{d}t$. Applying this to our SDE gives the equivalent Itō form:\n$$\n\\mathrm{d}R(t) = R(t) (A + \\tfrac{1}{2}B^2)\\,\\mathrm{d}t + R(t) B\\,\\mathrm{d}W(t)\n$$\n\nThe numerical schemes are implemented as follows:\n\n1.  **Itō-Milstein Method**: This is a strong order $1.0$ scheme for Itō SDEs. For a general matrix SDE $\\mathrm{d}X_t = f(X_t)\\mathrm{d}t + g(X_t)\\mathrm{d}W_t$, the scheme is $X_{n+1} = X_n + f(X_n)\\Delta t + g(X_n)\\Delta W_n + \\frac{1}{2}(Dg(X_n)[g(X_n)])((\\Delta W_n)^2 - \\Delta t)$, where $D g[v]$ is the directional derivative. For our Itō SDE, we have $f(R) = R(A + \\frac{1}{2}B^2)$ and $g(R) = RB$. The directional derivative is $Dg(R)[V] = VB$. Thus, $Dg(R_n)[g(R_n)] = g(R_n)B = R_n B^2$. The update rule for $R_{n+1} = R(t_n + \\Delta t)$ becomes:\n    $$\n    R_{n+1} = R_n + R_n(A + \\tfrac{1}{2}B^2)\\Delta t + R_n B \\Delta W_n + \\tfrac{1}{2} R_n B^2 ((\\Delta W_n)^2 - \\Delta t)\n    $$\n    where $\\Delta W_n \\sim N(0, \\Delta t)$. This can be factorized as:\n    $$\n    R_{n+1} = R_n \\left(I_3 + A\\Delta t + B\\Delta W_n + \\tfrac{1}{2}B^2(\\Delta W_n)^2\\right)\n    $$\n    This scheme is implemented in the ambient space of matrices. Its solution will generally not remain in $SO(3)$. We evaluate it both without correction and with a projection onto $SO(3)$ after each step.\n\n2.  **Stochastic Runge-Kutta (SRK) Method (Heun Scheme)**: This is a strong order $1.0$ predictor-corrector scheme for Stratonovich SDEs. For $\\mathrm{d}R = R A\\,\\mathrm{d}t + R B \\circ \\mathrm{d}W$, the steps are:\n    - Predictor: $\\hat{R}_{n+1} = R_n + R_n A \\Delta t + R_n B \\Delta W_n$\n    - Corrector: $R_{n+1} = R_n + \\frac{1}{2}(R_n A + \\hat{R}_{n+1} A)\\Delta t + \\frac{1}{2}(R_n B + \\hat{R}_{n+1} B)\\Delta W_n$\n    Like the Milstein method, this is implemented in $\\mathbb{R}^{3 \\times 3}$ and evaluated both with and without per-step projection onto $SO(3)$.\n\n3.  **Lie-Group Exponential Integrator**: This method leverages the Lie group structure directly. The update is performed by right-multiplying the current state by the exponential of the Lie algebra increment. This intrinsically preserves the group structure, ensuring $R_n \\in SO(3)$ for all $n$ (up to machine precision). The update rule is:\n    $$\n    R_{n+1} = R_n \\exp(A \\Delta t + B \\Delta W_n)\n    $$\n    The matrix exponential of a skew-symmetric matrix is always a special orthogonal matrix.\n\nThe evaluation metrics are:\n- **Orthogonality Defect**: For a numerical solution $R_{final}$, the deviation from orthogonality is measured by the Frobenius norm $||R_{final}^\\top R_{final} - I_3||_F$. This should be zero for a true orthogonal matrix.\n- **Determinant Error**: The deviation from the special orthogonal group constraint $\\det(R)=+1$ is measured by $|\\det(R_{final}) - 1|$.\n- **Geodesic Error**: The strong error for methods producing results in $SO(3)$ (i.e., projected and Lie-group methods) is measured against the exact solution using the natural distance on the manifold, the geodesic rotation-angle distance:\n$$\n\\theta(R_1, R_2) = \\arccos\\left(\\frac{\\operatorname{tr}(R_1^\\top R_2) - 1}{2}\\right)\n$$\nThe argument of the $\\arccos$ function is clamped to the interval $[-1, 1]$ to handle potential floating-point inaccuracies.\n\nThe implementation proceeds by first generating a single sequence of Brownian increments $\\Delta W_n$ for a given test case. This same sequence is then used for all implemented methods to ensure a fair, pathwise comparison. The required eight metrics are then computed at the final time $T$ for each of the three test cases.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import expm, svd, det, norm\n\ndef project_so3(M):\n    \"\"\"Projects a 3x3 matrix M onto SO(3) using SVD.\"\"\"\n    U, _, Vt = svd(M)\n    d = det(U @ Vt)\n    # Ensure the determinant is +1\n    diag = np.array([1.0, 1.0, d])\n    Q = U @ np.diag(diag) @ Vt\n    return Q\n\ndef geodesic_dist(R1, R2):\n    \"\"\"Computes the geodesic rotation-angle distance between R1, R2 in SO(3).\"\"\"\n    # Angle is arccos((tr(R1^T R2) - 1)/2)\n    arg = (np.trace(R1.T @ R2) - 1.0) / 2.0\n    # Clamp argument to [-1, 1] to avoid domain errors from floating point inaccuracies\n    clamped_arg = np.clip(arg, -1.0, 1.0)\n    return np.arccos(clamped_arg)\n\ndef run_simulation(T, dt, omega, sigma, seed):\n    \"\"\"\n    Runs the simulation for a single test case and returns the 8 required metrics.\n    \"\"\"\n    # --- Setup ---\n    I_3 = np.identity(3)\n    Kz = np.array([[0., -1., 0.], [1., 0., 0.], [0., 0., 0.]])\n    A = omega * Kz\n    B = sigma * Kz\n    B_sq = B @ B\n\n    # Number of steps\n    if dt = 0:\n        raise ValueError(\"Time step dt must be positive.\")\n    N = int(T / dt)\n    # Re-adjust dt to exactly fit T\n    dt = T / N\n\n    # Generate the single path of Wiener increments for all methods\n    rng = np.random.default_rng(seed)\n    dZ = rng.normal(0, 1, N)\n    dW = np.sqrt(dt) * dZ\n    W_T = np.sum(dW)\n\n    # --- Initial states ---\n    R_mil_u = I_3.copy()\n    R_mil_p = I_3.copy()\n    R_srk_u = I_3.copy()\n    R_srk_p = I_3.copy()\n    R_lie = I_3.copy()\n\n    # --- Time-stepping loop ---\n    for n in range(N):\n        dW_n = dW[n]\n\n        # 1. Itō-Milstein method (unprojected and projected)\n        # R_{n+1} = R_n (I + A*dt + B*dW + 0.5*B^2*(dW^2))\n        mil_update_factor = I_3 + A*dt + B*dW_n + 0.5*B_sq*(dW_n**2)\n        R_mil_u_next = R_mil_u @ mil_update_factor\n        R_mil_u = R_mil_u_next\n        R_mil_p_next = R_mil_p @ mil_update_factor\n        R_mil_p = project_so3(R_mil_p_next)\n\n        # 2. SRK-Heun method (unprojected and projected)\n        # Predictor: \\hat{R} = R_n (I + A*dt + B*dW)\n        # Corrector: R_{n+1} = R_n + 0.5*(RA + \\hat{R}A)dt + 0.5*(RB + \\hat{R}B)dW\n        \n        # Unprojected SRK-Heun\n        R_hat_srk_u = R_srk_u @ (I_3 + A*dt + B*dW_n)\n        update_u = 0.5 * (R_srk_u @ A + R_hat_srk_u @ A) * dt + \\\n                   0.5 * (R_srk_u @ B + R_hat_srk_u @ B) * dW_n\n        R_srk_u = R_srk_u + update_u\n        \n        # Projected SRK-Heun\n        R_hat_srk_p = R_srk_p @ (I_3 + A*dt + B*dW_n)\n        update_p = 0.5 * (R_srk_p @ A + R_hat_srk_p @ A) * dt + \\\n                   0.5 * (R_srk_p @ B + R_hat_srk_p @ B) * dW_n\n        R_srk_p_next = R_srk_p + update_p\n        R_srk_p = project_so3(R_srk_p_next)\n\n        # 3. Lie-group exponential method\n        # R_{n+1} = R_n exp(A*dt + B*dW)\n        lie_increment = A*dt + B*dW_n\n        R_lie = R_lie @ expm(lie_increment)\n\n    # --- Post-simulation calculations ---\n    # Exact solution\n    exact_increment = A*T + B*W_T\n    R_exact = expm(exact_increment)\n\n    # Calculate 8 required metrics\n    # 1. Milstein unprojected orthogonality defect\n    mil_u_defect = norm(R_mil_u.T @ R_mil_u - I_3, 'fro')\n    # 2. SRK-Heun unprojected orthogonality defect\n    srk_u_defect = norm(R_srk_u.T @ R_srk_u - I_3, 'fro')\n    # 3. Milstein unprojected determinant error\n    mil_u_det_err = abs(det(R_mil_u) - 1.0)\n    # 4. SRK-Heun unprojected determinant error\n    srk_u_det_err = abs(det(R_srk_u) - 1.0)\n    # 5. Milstein projected geodesic error\n    mil_p_geo_err = geodesic_dist(R_mil_p, R_exact)\n    # 6. SRK-Heun projected geodesic error\n    srk_p_geo_err = geodesic_dist(R_srk_p, R_exact)\n    # 7. Lie-group orthogonality defect\n    lie_defect = norm(R_lie.T @ R_lie - I_3, 'fro')\n    # 8. Lie-group geodesic error\n    lie_geo_err = geodesic_dist(R_lie, R_exact)\n    \n    return (mil_u_defect, srk_u_defect, mil_u_det_err, srk_u_det_err,\n            mil_p_geo_err, srk_p_geo_err, lie_defect, lie_geo_err)\n\ndef solve():\n    \"\"\"Main function to run test cases and print results.\"\"\"\n    test_cases = [\n        # (T, dt, omega, sigma, seed)\n        (1.0, 0.02, 1.3, 0.7, 1234),  # Case A\n        (1.0, 0.2, 1.3, 1.5, 5678),  # Case B\n        (1.0, 0.05, 1.3, 0.0, 42),    # Case C\n    ]\n\n    results = []\n    for case in test_cases:\n        case_results = run_simulation(*case)\n        results.extend(case_results)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3311871"}]}