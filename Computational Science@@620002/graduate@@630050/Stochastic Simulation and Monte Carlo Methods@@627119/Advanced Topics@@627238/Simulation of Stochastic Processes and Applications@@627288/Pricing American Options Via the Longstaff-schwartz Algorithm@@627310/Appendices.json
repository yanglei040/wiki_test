{"hands_on_practices": [{"introduction": "Before tackling the complexities of Monte Carlo simulation, it is essential to solidify your understanding of the core dynamic programming principle behind American option pricing. This exercise guides you through an explicit, step-by-step calculation in a simple binomial tree, revealing the structure of the Snell envelope and the optimal stopping decision at each node [@problem_id:3330861]. This foundational practice provides the concrete intuition for what the Longstaff-Schwartz algorithm aims to approximate in a more general, high-dimensional setting.", "problem": "Consider a discrete-time, $2$-period binomial model for a single risky asset with time-step length $\\Delta t = 0.5$ years. The asset price at time $t = 0$ is $S_0 = 100$. Over each time step, the price either moves up by a multiplicative factor $u = 1.2$ or down by a factor $d = 0.85$, independently of the past. The continuously compounded risk-free rate is $r = 0.05$ per year, so the per-step gross discount factor is $R = \\exp(r \\Delta t)$. Let $\\mathbb{Q}$ denote the unique risk-neutral probability measure consistent with no-arbitrage.\n\nLet $Z_t$ denote the payoff process of an American put option with strike $K = 100$, so the immediate exercise payoff at time $t$ is $Z_t = (K - S_t)_{+}$, where $(x)_{+} = \\max\\{x, 0\\}$. Define the Snell envelope $Y_t$ to be the smallest $\\mathbb{Q}$-supermartingale that dominates the discounted payoff process and characterizes the optimal stopping problem for the American option over $t \\in \\{0, \\Delta t, 2 \\Delta t\\}$.\n\nStarting from fundamental principles of risk-neutral valuation and optimal stopping in discrete time:\n- Derive the dynamic programming recursion that characterizes the Snell envelope for this American put.\n- Compute the Snell envelope explicitly at each node of the $2$-period binomial tree.\n- Identify the optimal stopping region at each time step.\n- Finally, compute the time-$0$ value of the American put.\n\nExpress the final time-$0$ option value as a plain number, and round your answer to four significant figures. Do not include any currency symbol or units in your final numerical answer.", "solution": "The pricing of an American option in a discrete-time setting is an optimal stopping problem. The value of the option can be found using risk-neutral valuation and dynamic programming. We first construct the underlying asset price tree, then determine the risk-neutral probabilities, and finally work backward from the final time period to find the option value at each node.\n\n**1. Model Parameters and Risk-Neutral Probability**\n\nThe given parameters are:\n- Initial stock price $S_0 = 100$.\n- Up factor $u = 1.2$.\n- Down factor $d = 0.85$.\n- Risk-free rate $r = 0.05$ per annum.\n- Time step $\\Delta t = 0.5$ years.\n- Strike price $K = 100$.\n- Number of periods $N=2$. The time points are $t_0=0$, $t_1=\\Delta t = 0.5$, and $t_2=2\\Delta t = 1.0$.\n\nThe risk-neutral probability $q$ of an upward movement in the stock price is determined by the no-arbitrage condition, which states that the expected future price of the asset, discounted by the risk-free rate, must equal its current price.\n$$S_t = \\exp(-r \\Delta t) \\left( q S_t u + (1-q) S_t d \\right)$$\nDividing by $S_t$ gives:\n$$1 = \\exp(-r \\Delta t) \\left( q u + (1-q) d \\right)$$\nSolving for $q$:\n$$q = \\frac{\\exp(r \\Delta t) - d}{u - d}$$\nLet's compute the numerical values for the per-step discount factor and the risk-neutral probability.\nThe per-step interest rate is $r \\Delta t = 0.05 \\times 0.5 = 0.025$.\nThe per-step discount factor is $\\exp(-r \\Delta t) = \\exp(-0.025) \\approx 0.97530991$.\nThe gross return factor is $\\exp(r \\Delta t) = \\exp(0.025) \\approx 1.02531512$.\n$$q = \\frac{1.02531512 - 0.85}{1.2 - 0.85} = \\frac{0.17531512}{0.35} \\approx 0.50089949$$\nThe risk-neutral probability of a downward movement is $1-q \\approx 1 - 0.50089949 = 0.49910051$.\n\n**2. Stock Price Tree**\n\nThe stock price tree evolves as follows:\n- Time $t=0$: $S_0 = 100$.\n- Time $t=1 (\\Delta t = 0.5)$:\n    - $S_1^u = S_0 u = 100 \\times 1.2 = 120$.\n    - $S_1^d = S_0 d = 100 \\times 0.85 = 85$.\n- Time $t=2 (2\\Delta t = 1.0)$:\n    - $S_2^{uu} = S_1^u u = 120 \\times 1.2 = 144$.\n    - $S_2^{ud} = S_1^u d = 120 \\times 0.85 = 102$.\n    - $S_2^{dd} = S_1^d d = 85 \\times 0.85 = 72.25$.\n\n**3. Dynamic Programming Recursion and the Snell Envelope**\n\nLet $V_t$ be the value of the American put option at time $t$. The payoff upon immediate exercise is $Z_t = (K - S_t)_{+}$. The problem's definition of the Snell envelope $Y_t$ on the discounted payoff process implies the standard dynamic programming recursion for the undiscounted option price $V_t$:\n$$V_t = \\max\\left\\{ Z_t, \\exp(-r\\Delta t)\\mathbb{E}^{\\mathbb{Q}}[V_{t+\\Delta t} | \\mathcal{F}_t] \\right\\}$$\nThis is the standard recursive formula for the price of an American option. The term $\\exp(-r\\Delta t)\\mathbb{E}^{\\mathbb{Q}}[V_{t+\\Delta t} | \\mathcal{F}_t]$ is the continuation value. We will compute the values of $V_t$ at each node by working backward from time $t=2\\Delta t$.\n\n**4. Backward Induction for Option Value ($V_t$)**\n\n- **Time $t=2 (2\\Delta t = 1.0)$**: At expiration, the option value is its intrinsic value.\n    - $V_2^{uu} = (K - S_2^{uu})_{+} = (100 - 144)_{+} = 0$.\n    - $V_2^{ud} = (K - S_2^{ud})_{+} = (100 - 102)_{+} = 0$.\n    - $V_2^{dd} = (K - S_2^{dd})_{+} = (100 - 72.25)_{+} = 27.75$.\n\n- **Time $t=1 (\\Delta t = 0.5)$**: At each node, we compare the immediate exercise value with the continuation value.\n    - **Node u ($S_1^u = 120$)**:\n        - Immediate Exercise Value: $E_1^u = (100 - 120)_{+} = 0$.\n        - Continuation Value: $C_1^u = \\exp(-r\\Delta t)[q V_2^{uu} + (1-q) V_2^{ud}] = \\exp(-0.025)[q \\cdot 0 + (1-q) \\cdot 0] = 0$.\n        - Option Value: $V_1^u = \\max\\{E_1^u, C_1^u\\} = \\max\\{0, 0\\} = 0$.\n    - **Node d ($S_1^d = 85$)**:\n        - Immediate Exercise Value: $E_1^d = (100 - 85)_{+} = 15$.\n        - Continuation Value: $C_1^d = \\exp(-r\\Delta t)[q V_2^{ud} + (1-q) V_2^{dd}] = \\exp(-0.025)[q \\cdot 0 + (1-q) \\cdot 27.75]$.\n        - $C_1^d \\approx 0.97530991 \\times [0.49910051 \\times 27.75] \\approx 0.97530991 \\times 13.849989 \\approx 13.50722$.\n        - Option Value: $V_1^d = \\max\\{E_1^d, C_1^d\\} = \\max\\{15, 13.50722\\} = 15$.\n\n- **Time $t=0 (S_0 = 100)$**:\n    - Immediate Exercise Value: $E_0 = (100 - 100)_{+} = 0$.\n    - Continuation Value: $C_0 = \\exp(-r\\Delta t)[q V_1^u + (1-q) V_1^d] = \\exp(-0.025)[q \\cdot 0 + (1-q) \\cdot 15]$.\n    - $C_0 \\approx 0.97530991 \\times [0.49910051 \\times 15] \\approx 0.97530991 \\times 7.48650765 \\approx 7.30155$.\n    - Option Value: $V_0 = \\max\\{E_0, C_0\\} = \\max\\{0, 7.30155\\} = 7.30155$.\n\nThe time-0 value of the American put is $V_0 \\approx 7.30155$.\n\n**5. Optimal Stopping Region**\n\nThe optimal stopping (exercise) region is the set of states $(t, S_t)$ where the immediate exercise value is greater than or equal to the continuation value.\n- At $t=1 (\\Delta t = 0.5)$: At node d ($S_1^d=85$), the immediate exercise value ($15$) is greater than the continuation value ($\\approx 13.51$). It is optimal to exercise.\n- At $t=2 (2\\Delta t = 1.0)$: It is always optimal to exercise if the option is in-the-money. At node dd ($S_2^{dd}=72.25$), the option is in-the-money, so it is optimal to exercise.\n\nThe optimal stopping region consists of the nodes $\\{(\\Delta t, S_t=85), (2\\Delta t, S_t=72.25)\\}$.\n\n**6. Final Answer**\n\nThe time-$0$ value of the American put is $V_0 \\approx 7.30155$. Rounding to four significant figures gives $7.302$.", "answer": "$$\\boxed{7.302}$$", "id": "3330861"}, {"introduction": "The heart of the Longstaff-Schwartz algorithm is a series of least-squares regressions used to estimate continuation values. A critical, practical question is whether this regression is well-posed, which mathematically depends on the invertibility of the Gram matrix, $G=\\Phi^{\\top}\\Phi$. This practice challenges you to connect the abstract choice of basis functions and the statistical distribution of simulated paths to the concrete numerical stability of the algorithm [@problem_id:3330800]. Understanding these conditions is crucial for designing a robust implementation and diagnosing common failures.", "problem": "Consider pricing an American option by the Longstaff-Schwartz algorithm (LSM), where one performs a cross-sectional regression at exercise time $t$ of discounted continuation values against a set of $K$ basis functions evaluated on simulated paths that are in the money. Let $\\{\\varphi_{j}\\}_{j=1}^{K}$ be deterministic basis functions mapping the state to $\\mathbb{R}$, let $\\{S_{t}^{(i)}\\}_{i=1}^{N}$ be simulated states at time $t$ under the risk-neutral measure, and let $I_{t}\\subset\\{1,\\dots,N\\}$ be the index set of paths that are in the money at time $t$. Define the design matrix $\\Phi\\in\\mathbb{R}^{|I_{t}|\\times K}$ by $\\Phi_{ij}=\\varphi_{j}(S_{t}^{(i)})$ for $i\\in I_{t}$, and the Gram matrix $G=\\Phi^{\\top}\\Phi\\in\\mathbb{R}^{K\\times K}$. Assume the simulated paths are independent and identically distributed (i.i.d.) conditional on the filtration at time $t$, and that the underlying state $S_{t}$ has a distribution with a nondegenerate continuous component on a set where the in-the-money event has positive probability.\n\nFrom first principles, recall the law of large numbers and the definition of positive definiteness: if $\\{X^{(i)}\\}_{i=1}^{m}$ are i.i.d. $\\mathbb{R}^{K}$-valued random vectors with finite second moments, then $\\frac{1}{m}\\sum_{i=1}^{m}X^{(i)}X^{(i)\\top}\\to \\mathbb{E}[XX^{\\top}]$ entrywise as $m\\to\\infty$, and a symmetric matrix is invertible if and only if it is positive definite (all eigenvalues strictly positive).\n\nWhich statement correctly characterizes conditions under which $G=\\Phi^{\\top}\\Phi$ is invertible with high probability as $N$ grows, and clearly relates these conditions to both basis function design and the path distribution?\n\nA. If, conditional on being in the money at time $t$, the random vector $\\varphi(S_{t})=(\\varphi_{1}(S_{t}),\\dots,\\varphi_{K}(S_{t}))^{\\top}$ has a positive definite second-moment matrix $\\mathbb{E}[\\varphi(S_{t})\\varphi(S_{t})^{\\top}\\mid \\text{ITM}]$, and if $|I_{t}|\\geq K$ with $|I_{t}|\\to\\infty$ as $N\\to\\infty$ (i.e., the in-the-money probability is strictly positive), then $G$ is invertible with high probability for large $N$. This requires that the basis functions be linearly independent in $L^{2}$ under the conditional path distribution and that the path distribution not concentrate on sets inducing almost-sure linear relations among $\\{\\varphi_{j}\\}$. Orthonormality is not necessary, but poorly chosen redundant bases or degenerate path distributions can make $G$ singular.\n\nB. $G$ is invertible with high probability as $N$ grows if and only if the basis functions satisfy $\\varphi_{i}(s)\\varphi_{j}(s)=0$ for all $s$ and all $i\\neq j$, i.e., the basis is pointwise orthogonal; otherwise, $G$ is asymptotically singular.\n\nC. In the case where the underlying follows geometric Brownian motion, $G$ is always invertible for any fixed set of continuous basis functions and any $N\\geq K$, because geometric Brownian motion has a continuous distribution.\n\nD. If the path distribution of $S_{t}$ has a continuous density on an interval and the basis functions are polynomials, then $G$ is invertible with high probability for large $N$ even when $K$ grows faster than $|I_{t}|$, since polynomials on an interval are linearly independent as functions; therefore the sample Gram matrix cannot be singular asymptotically regardless of the relative growth rates of $K$ and $|I_{t}|$.", "solution": "The problem asks for the conditions under which the Gram matrix $G = \\Phi^{\\top}\\Phi$ is invertible with high probability for a large number of simulated paths $N$. A symmetric matrix like $G$ is invertible if and only if it is positive definite.\n\n1.  **The Role of the Law of Large Numbers**: The Gram matrix is constructed from the design matrix $\\Phi$, whose rows correspond to the $|I_t|$ in-the-money simulated paths. The $(j,k)$-th entry of $G$ is $G_{jk} = \\sum_{i \\in I_t} \\varphi_j(S_t^{(i)}) \\varphi_k(S_t^{(i)})$. By the Law of Large Numbers, as the number of in-the-money paths $|I_t|$ approaches infinity, the scaled Gram matrix converges to the matrix of conditional second moments:\n    $$ \\frac{1}{|I_t|} G \\xrightarrow[|I_t| \\to \\infty]{} M \\quad \\text{where} \\quad M = \\mathbb{E}[\\varphi(S_{t})\\varphi(S_{t})^{\\top} \\mid \\text{ITM}] $$\n    For $G$ to be invertible with high probability for large $|I_t|$, its limit $M$ must be invertible (i.e., positive definite).\n\n2.  **Condition for Positive Definiteness**: The matrix $M$ is positive definite if and only if for any non-zero vector $v \\in \\mathbb{R}^K$, the quadratic form $v^{\\top}Mv$ is strictly positive.\n    $$ v^{\\top}Mv = \\mathbb{E}\\left[ \\left(\\sum_{j=1}^K v_j \\varphi_j(S_t)\\right)^2 \\mid \\text{ITM} \\right] > 0 $$\n    This condition is precisely the definition of the basis functions $\\{\\varphi_j\\}_{j=1}^K$ being linearly independent in the Hilbert space $L^2$ with respect to the risk-neutral probability measure of $S_t$, conditioned on the option being in-the-money.\n\n3.  **Evaluating the Options**:\n    -   **A**: This option correctly identifies that the asymptotic invertibility of $G$ depends on the positive definiteness of the conditional second-moment matrix, which is equivalent to the $L^2$ linear independence of the basis functions under the conditional path distribution. It also correctly notes that poor basis choice (redundancy) or a degenerate path distribution can cause singularity. This statement is entirely correct.\n    -   **B**: This states that pointwise orthogonality is a necessary (\"if and only if\") condition. This is false. Orthogonality is a *sufficient* condition for the limiting matrix $M$ to be diagonal and thus easily invertible, but it is not necessary. Many sets of non-orthogonal basis functions (like standard monomials $\\{1, s, s^2\\}$) yield a positive definite, invertible matrix $M$.\n    -   **C**: This is incorrect. If the basis functions are chosen to be linearly dependent (e.g., $\\varphi_1(s) = s$ and $\\varphi_2(s) = 2s$), $G$ will be singular regardless of the distribution of $S_t$ or the sample size $N$.\n    -   **D**: This makes a critical error. For the $|I_t| \\times K$ design matrix $\\Phi$ to have full column rank, a necessary condition is that the number of rows is at least the number of columns, i.e., $|I_t| \\ge K$. If $K > |I_t|$, the columns of $\\Phi$ are necessarily linearly dependent, and $G = \\Phi^{\\top}\\Phi$ is singular. Therefore, the claim that $G$ can be invertible when $K$ grows faster than $|I_t|$ is false.\n\nBased on this analysis, statement A is the only one that correctly and fully characterizes the conditions.", "answer": "$$\\boxed{A}$$", "id": "3330800"}, {"introduction": "In practice, many implementations of the Longstaff-Schwartz algorithm use a seemingly sensible shortcut: restricting the regression to only those paths that are currently in-the-money. This exercise prompts a deep analysis of this common heuristic, exploring both its theoretical justification and the subtle biases it can introduce, particularly near the optimal exercise boundary [@problem_id:3330849]. Mastering this topic develops the critical thinking skills needed to evaluate and refine computational finance algorithms for practical use.", "problem": "Consider a Bermudan put option with strike $K$ written on a single risky asset with price process $\\{S_t\\}_{t \\ge 0}$ evolving under the risk-neutral measure $\\mathbb{Q}$ according to the stochastic differential equation $dS_t = r S_t \\, dt + \\sigma S_t \\, dW_t$, where $r > 0$ is the constant short rate, $\\sigma > 0$ is the constant volatility, and $\\{W_t\\}_{t \\ge 0}$ is a standard Brownian motion. The option can be exercised at discrete dates $0 < t_1 < t_2 < \\cdots < t_m = T$, with discounted payoff process $B_t h(S_t)$, where $B_t = e^{-r t}$ and $h(s) = (K - s)_+$. Let $\\mathcal{F}_t$ denote the filtration generated by $\\{S_u\\}_{u \\le t}$. The Bermudan value process $\\{V_{t_i}\\}$ is the Snell envelope under $\\mathbb{Q}$, given by $V_{t_i} = \\operatorname{ess\\,sup}_{\\tau \\in \\mathcal{T}_{t_i}} \\mathbb{E}^{\\mathbb{Q}}\\!\\left[ e^{-r(\\tau - t_i)} h(S_\\tau) \\mid \\mathcal{F}_{t_i} \\right]$, where $\\mathcal{T}_{t_i}$ is the set of stopping times taking values in $\\{t_i, \\ldots, t_m\\}$.\n\nA widely used simulation-based method for pricing such American-style claims is the Longstaff–Schwartz (LS) algorithm, which estimates the conditional continuation value at each exercise date by regressing simulated discounted future cashflows on a set of basis functions of the current state. A common practical choice is to restrict the regression at date $t_i$ to those simulated paths that are in-the-money at $t_i$, i.e., those with $h(S_{t_i}) > 0$.\n\nSelect all statements that are correct regarding the practice of restricting the regression to in-the-money paths in the Longstaff–Schwartz algorithm, providing a formal justification for admissibility and identifying scenarios under which this practice may introduce bias.\n\nA. For any date $t_i$ and any state with $h(S_{t_i}) = 0$, the optimal policy is to continue because the continuation value is almost surely nonnegative; therefore the exercise decision at such states is trivial and does not require estimating the continuation value there. Under this nonnegativity and the Markov property of $\\{S_t\\}$, restricting the regression to the in-the-money region $\\mathcal{I}_{t_i} = \\{ s : h(s) > 0 \\}$ is admissible in the sense that it does not affect the stopping decision at out-of-the-money states.\n\nB. Suppose at date $t_i$ we regress the discounted future cashflow $Y_{t_i}$ (defined by backward induction from $t_{i+1}, \\ldots, t_m$) on basis functions $\\{\\phi_j\\}_{j=1}^p$ using only simulated paths with $S_{t_i} \\in \\mathcal{I}_{t_i}$. If the state is Markov under $\\mathbb{Q}$, $Y_{t_i}$ is square integrable, and the span of $\\{\\phi_j\\}$ is dense in $L^2(\\mu_{t_i})$ where $\\mu_{t_i}$ is the law of $S_{t_i}$ conditioned on $S_{t_i} \\in \\mathcal{I}_{t_i}$, then as the number of paths $N \\to \\infty$ and the basis dimension $p \\to \\infty$ suitably, the least squares estimator restricted to $\\mathcal{I}_{t_i}$ is consistent for the continuation value $\\mathbb{E}^{\\mathbb{Q}}[Y_{t_i} \\mid S_{t_i} = s]$ for $s \\in \\mathcal{I}_{t_i}$.\n\nC. Restricting the regression to in-the-money paths cannot introduce bias in the estimated Bermudan price because the Longstaff–Schwartz estimator is an unbiased estimator of the true price regardless of the regression design.\n\nD. Restricting to in-the-money paths can introduce bias if the conditional design places very little probability mass near the optimal exercise boundary at $t_i$, so that the regression trained on deep in-the-money states extrapolates to the boundary. With global polynomial bases, this can induce systematic misclassification of the exercise/continue decision near the boundary, tending to a downward-biased price due to premature exercise.\n\nE. In multi-dimensional Markov settings (e.g., with stochastic volatility where the state is $(S_{t_i}, V_{t_i})$), restricting to in-the-money paths at $t_i$ changes the joint design distribution of the regressors. If basis functions were selected to be orthogonal under the unconditional law of $(S_{t_i}, V_{t_i})$, such orthogonality is lost under the conditional law given $h(S_{t_i}) > 0$, which can worsen numerical conditioning and increase finite-sample projection error, thereby introducing bias in the price estimate.\n\nChoose all that apply.", "solution": "This problem analyzes the consequences of a common heuristic in the Longstaff-Schwartz (LS) algorithm: restricting the regression for the continuation value to only those paths that are currently in-the-money (ITM).\n\n**A. Correct.** The immediate exercise payoff for an out-of-the-money (OTM) put option is zero ($h(S_{t_i}) = 0$ for $S_{t_i} \\ge K$). The continuation value—the expected value of holding the option—is strictly positive as long as there is some probability of the option finishing in-the-money in the future ($\\sigma > 0$). Therefore, for any OTM state, the optimal decision is always to continue, as the immediate payoff (0) is less than the continuation value ($>0$). The exercise decision is trivial in this region, so focusing the regression effort on the ITM region, where the decision is non-trivial, is a valid and common optimization.\n\n**B. Correct.** This statement provides the formal justification for the regression on the restricted ITM domain. Standard results from non-parametric statistics show that a least-squares estimator is consistent for the true conditional expectation function, provided the basis functions are dense in the appropriate function space ($L^2$ of the *conditional* distribution on the ITM domain). The statement correctly lists the necessary theoretical conditions for the estimated continuation value to converge to the true continuation value on the ITM domain.\n\n**C. Incorrect.** A fundamental property of the LS algorithm is that it produces a low-biased estimator of the true option price, not an unbiased one. The exercise strategy is based on an *estimated* continuation value, making it sub-optimal. The value derived from any sub-optimal strategy is, in expectation, a lower bound on the true value from the optimal strategy. Thus, $\\mathbb{E}[\\hat{V}] \\le V_{\\text{true}}$. The statement that the estimator is unbiased is false.\n\n**D. Correct.** This describes a significant practical source of bias. The most critical region for estimation is near the optimal exercise boundary, where the immediate exercise value is close to the continuation value. If the regression is performed only on ITM paths, and the simulation happens to generate few paths near this boundary, the regression model (especially with global bases like polynomials) may extrapolate poorly to this sparse-data region. This can lead to systematic errors in the estimated continuation value, often an underestimation, which in turn causes premature exercise and a downward bias in the final price estimate.\n\n**E. Correct.** In multi-dimensional problems (e.g., state is $(S_t, v_t)$), one might choose basis functions that are orthogonal with respect to the *unconditional* joint distribution of the state variables to ensure numerical stability. The ITM restriction ($S_t  K$) performs a conditioning on a subset of the state space. This conditioning changes the underlying probability measure, and orthogonality is generally lost. The resulting correlation between regressors can lead to an ill-conditioned Gram matrix, increasing estimation variance and introducing additional finite-sample bias.\n\nTherefore, statements A, B, D, and E are correct.", "answer": "$$\\boxed{ABDE}$$", "id": "3330849"}]}