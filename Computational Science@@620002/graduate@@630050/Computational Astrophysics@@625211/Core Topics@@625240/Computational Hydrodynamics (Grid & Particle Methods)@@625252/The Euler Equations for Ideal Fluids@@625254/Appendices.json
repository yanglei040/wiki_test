{"hands_on_practices": [{"introduction": "Before developing numerical solvers for the Euler equations, it is essential to master their fundamental mathematical structure. Finite-volume methods operate on a state vector $U$ of conserved quantities, but the physics is often expressed through the flux vector $F$, which depends on primitive variables like pressure and velocity. This foundational exercise, [@problem_id:3539810], challenges you to derive the explicit form of the flux vector $F(U)$ purely in terms of the conserved variables, a crucial algebraic skill required to translate the physics of fluid flow into a computable form.", "problem": "In compressible, inviscid, non-relativistic astrophysical hydrodynamics without external body forces, the dynamics of an ideal fluid are governed by local conservation of mass, momentum, and total energy. Consider a one-dimensional Cartesian domain along the spatial coordinate $x$, with fluid density $\\rho(x,t)$, velocity $u(x,t)$, pressure $p(x,t)$, and total energy density $E(x,t)$. The total energy density is defined by $E = \\rho e + \\tfrac{1}{2}\\rho u^{2}$, where $e$ is the specific internal energy. Assume an ideal-gas Equation of State (EOS) with constant adiabatic index $\\gamma$, so that $p = (\\gamma - 1)\\rho e$.\n\nStarting solely from the integral forms of conservation for mass, momentum, and energy over a control volume in one-dimensional Cartesian geometry, derive the conservative, flux-divergence form $\\partial_{t} U + \\partial_{x} F(U) = 0$ for the conserved state vector $U = (\\rho, \\rho u, E)$. Eliminate $e$ and $p$ using the given relations so that the resulting flux vector $F(U)$ is expressed entirely in terms of the conserved variables $(\\rho, \\rho u, E)$ and the parameter $\\gamma$, with no appearance of primitive variables other than through these conserved variables.\n\nProvide your final result as a single, closed-form analytic expression for the flux vector $F(U)$ written as a row vector with three entries, containing only $\\rho$, $\\rho u$, $E$, and $\\gamma$. Do not introduce any additional variables in the final expression. No numerical values are required.", "solution": "The problem as stated is scientifically grounded, self-contained, and well-posed. It requests the derivation of the flux vector for the one-dimensional Euler equations of gas dynamics, a standard and fundamental exercise in computational fluid dynamics and astrophysics. All necessary definitions and physical relations are provided, and there are no internal contradictions, ambiguities, or factual inaccuracies. The problem is therefore valid, and we may proceed with the derivation.\n\nThe objective is to derive the flux vector $F(U)$ for the system of conservation laws $\\partial_{t} U + \\partial_{x} F(U) = 0$, where the state vector of conserved variables is $U = (\\rho, \\rho u, E)$. The derivation will begin from the integral form of the conservation laws for mass, momentum, and energy for an ideal, inviscid fluid in a one-dimensional Cartesian domain, absent any external forces.\n\nConsider a fixed spatial control volume (CV) defined by the interval $[x_1, x_2]$. The integral form of a generic conservation law for a conserved quantity density $q$ with a corresponding flux $f_q$ is:\n$$\n\\frac{d}{dt} \\int_{x_1}^{x_2} q \\, dx = f_q(x_1) - f_q(x_2)\n$$\nThe right-hand side represents the net rate at which the quantity enters the control volume. By the Fundamental Theorem of Calculus, $f_q(x_1) - f_q(x_2) = -\\int_{x_1}^{x_2} \\frac{\\partial f_q}{\\partial x} dx$. Substituting this and bringing the time derivative inside the integral (as the domain is fixed) yields:\n$$\n\\int_{x_1}^{x_2} \\left[ \\frac{\\partial q}{\\partial t} + \\frac{\\partial f_q}{\\partial x} \\right] dx = 0\n$$\nSince this relation must hold for any arbitrary control volume $[x_1, x_2]$, the integrand must be identically zero. This gives the differential, or \"flux-divergence,\" form of the conservation law:\n$$\n\\frac{\\partial q}{\\partial t} + \\frac{\\partial f_q}{\\partial x} = 0\n$$\nWe now apply this general principle to mass, momentum, and total energy.\n\n1.  **Conservation of Mass**\n    The conserved quantity is mass density, $q = \\rho$. The mass flux, or the rate of mass trasport per unit area, is $f_{\\rho} = \\rho u$. Applying the principle above gives the continuity equation:\n    $$\n    \\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial}{\\partial x}(\\rho u) = 0\n    $$\n    This is the first component of our vector equation. The first component of the state vector is $U_1 = \\rho$, and the first component of the flux vector is $F_1 = \\rho u$.\n\n2.  **Conservation of Momentum**\n    The conserved quantity is momentum density, $q = \\rho u$. The flux of momentum has two contributions: the advective transport of momentum, $\\rho u^2$, and the force per unit area exerted by pressure, $p$. Thus, the momentum flux is $f_{\\rho u} = \\rho u^2 + p$. This gives the momentum equation:\n    $$\n    \\frac{\\partial (\\rho u)}{\\partial t} + \\frac{\\partial}{\\partial x}(\\rho u^2 + p) = 0\n    $$\n    The second component of the state vector is $U_2 = \\rho u$, and the second component of the flux vector is $F_2 = \\rho u^2 + p$.\n\n3.  **Conservation of Energy**\n    The conserved quantity is the total energy density, $q = E = \\rho e + \\tfrac{1}{2}\\rho u^{2}$. The flux of energy, $f_E$, is the sum of the advective transport of total energy, $E u$, and the rate of work done by pressure forces on the fluid at the boundary, $p u$. Therefore, the energy flux is $f_E = E u + p u = (E+p)u$. This gives the energy equation:\n    $$\n    \\frac{\\partial E}{\\partial t} + \\frac{\\partial}{\\partial x}((E+p)u) = 0\n    $$\n    The third component of the state vector is $U_3 = E$, and the third component of the flux vector is $F_3 = (E+p)u$.\n\nCombining these results, the system of equations is $\\partial_t U + \\partial_x F = 0$ with $U = (\\rho, \\rho u, E)$ and $F = (\\rho u, \\rho u^2 + p, (E+p)u)$. The problem requires that the flux vector $F$ be expressed solely in terms of the components of $U$, which are $\\rho$, $\\rho u$, and $E$, and the constant $\\gamma$. To achieve this, we must eliminate the primitive variables $p$ and $u$ from the expression for $F$.\n\nThe velocity $u$ can be expressed as the ratio of momentum density to mass density:\n$$\nu = \\frac{\\rho u}{\\rho}\n$$\nNext, we express the pressure $p$ in terms of the conserved variables. We are given the ideal-gas Equation of State (EOS), $p = (\\gamma-1)\\rho e$, and the definition of total energy density, $E = \\rho e + \\frac{1}{2}\\rho u^2$. From the definition of $E$, we can isolate the internal energy density $\\rho e$:\n$$\n\\rho e = E - \\frac{1}{2}\\rho u^2\n$$\nSubstituting the expression for $u$:\n$$\n\\rho e = E - \\frac{1}{2}\\rho \\left(\\frac{\\rho u}{\\rho}\\right)^2 = E - \\frac{1}{2}\\frac{(\\rho u)^2}{\\rho}\n$$\nNow, we substitute this expression for $\\rho e$ into the EOS to find $p$:\n$$\np = (\\gamma - 1) (\\rho e) = (\\gamma-1)\\left(E - \\frac{1}{2}\\frac{(\\rho u)^2}{\\rho}\\right)\n$$\nWe have now successfully expressed both $u$ and $p$ in terms of $\\rho$, $\\rho u$, and $E$. The final step is to substitute these into the components of the flux vector $F$.\n\n-   **Flux component $F_1$:**\n    $F_1 = \\rho u$. This is already a conserved variable.\n\n-   **Flux component $F_2$:**\n    $F_2 = \\rho u^2 + p$. We substitute the expressions for $u$ and $p$:\n    $$\n    F_2 = \\rho \\left(\\frac{\\rho u}{\\rho}\\right)^2 + (\\gamma-1)\\left(E - \\frac{1}{2}\\frac{(\\rho u)^2}{\\rho}\\right)\n    $$\n    $$\n    F_2 = \\frac{(\\rho u)^2}{\\rho} + (\\gamma-1)E - \\frac{\\gamma-1}{2}\\frac{(\\rho u)^2}{\\rho}\n    $$\n    Combining the terms proportional to $(\\rho u)^2/\\rho$:\n    $$\n    F_2 = \\left(1 - \\frac{\\gamma-1}{2}\\right)\\frac{(\\rho u)^2}{\\rho} + (\\gamma-1)E = \\left(\\frac{2 - \\gamma + 1}{2}\\right)\\frac{(\\rho u)^2}{\\rho} + (\\gamma-1)E\n    $$\n    $$\n    F_2 = \\frac{3-\\gamma}{2}\\frac{(\\rho u)^2}{\\rho} + (\\gamma-1)E\n    $$\n\n-   **Flux component $F_3$:**\n    $F_3 = (E+p)u$. We substitute the expressions for $p$ and $u$:\n    $$\n    F_3 = \\left[ E + (\\gamma-1)\\left(E - \\frac{1}{2}\\frac{(\\rho u)^2}{\\rho}\\right) \\right] \\left( \\frac{\\rho u}{\\rho} \\right)\n    $$\n    First, simplify the term in the square brackets:\n    $$\n    E + p = E + (\\gamma-1)E - \\frac{\\gamma-1}{2}\\frac{(\\rho u)^2}{\\rho} = \\gamma E - \\frac{\\gamma-1}{2}\\frac{(\\rho u)^2}{\\rho}\n    $$\n    Now, multiply by $u = \\frac{\\rho u}{\\rho}$:\n    $$\n    F_3 = \\left( \\gamma E - \\frac{\\gamma-1}{2}\\frac{(\\rho u)^2}{\\rho} \\right) \\frac{\\rho u}{\\rho} = \\gamma \\frac{E(\\rho u)}{\\rho} - \\frac{\\gamma-1}{2}\\frac{(\\rho u)^3}{\\rho^2}\n    $$\n\nSo, the flux vector $F(U)$ expressed entirely in terms of the conserved variables $(\\rho, \\rho u, E)$ is:\n$$\nF(U) = \\left( \\rho u, \\quad \\frac{3-\\gamma}{2}\\frac{(\\rho u)^2}{\\rho} + (\\gamma-1)E, \\quad \\gamma \\frac{E(\\rho u)}{\\rho} - \\frac{\\gamma-1}{2}\\frac{(\\rho u)^3}{\\rho^2} \\right)\n$$\nThis result is in the required form.", "answer": "$$\n\\boxed{\\begin{pmatrix} \\rho u & \\frac{3-\\gamma}{2}\\frac{(\\rho u)^2}{\\rho} + (\\gamma-1)E & \\gamma \\frac{E(\\rho u)}{\\rho} - \\frac{\\gamma-1}{2}\\frac{(\\rho u)^3}{\\rho^2} \\end{pmatrix}}\n$$", "id": "3539810"}, {"introduction": "The solutions to the Euler equations can exhibit a rich structure of waves, including shocks, rarefactions, and contact discontinuities. The Riemann problem, which describes the evolution of an initial discontinuity, serves as a cornerstone for both theoretical understanding and the verification of numerical codes. This practice [@problem_id:3539807] asks you to identify the correct analytical structure of the classic Sod shock tube problem, a standard benchmark that encapsulates all three fundamental wave types, providing a conceptual roadmap for what a robust Euler solver must be able to capture.", "problem": "Consider the one-dimensional Euler equations for an ideal compressible fluid,\n$$\n\\partial_t \\rho + \\partial_x (\\rho u) = 0,\\quad\n\\partial_t (\\rho u) + \\partial_x (\\rho u^2 + p) = 0,\\quad\n\\partial_t E + \\partial_x \\big(u(E+p)\\big) = 0,\n$$\nwith the ideal-gas equation of state\n$$\np = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right),\n$$\nwhere $\\rho$ is the mass density, $u$ is the fluid velocity, $p$ is the pressure, $E$ is the total energy density, and $\\gamma$ is the adiabatic index. The Riemann problem formed by a diaphragm initially separating two uniform states produces a self-similar solution depending on $\\xi = (x-x_0)/t$ composed of elementary waves of the Euler system.\n\nAs a verification test for Computational Fluid Dynamics (CFD) Euler solvers, the classic Sod shock tube is commonly used. Choose the option that correctly specifies the initial conditions and outlines the analytical solution structure, including wave types, continuity conditions at the contact discontinuity, and approximate star-state values and wave speeds for the standard Sod setup.\n\nA. \n- Initialize on $x \\in [0,1]$ with diaphragm at $x_0 = 0.5$. Left state $(\\rho_L,u_L,p_L) = (1,\\,0,\\,1)$, right state $(\\rho_R,u_R,p_R) = (0.125,\\,0,\\,0.1)$, adiabatic index $\\gamma = 1.4$.\n- The solution is a three-wave self-similar pattern: a left-going $1$-rarefaction, a $2$-contact discontinuity, and a right-going $3$-shock.\n- Across the contact discontinuity, velocity and pressure are continuous, so $u_L^* = u_R^* = u_*$ and $p_L^* = p_R^* = p_*$, while density generally has a jump $\\rho_L^* \\neq \\rho_R^*$.\n- Approximate star-state values and wave speeds: $p_* \\approx 0.303$, $u_* \\approx 0.927$, $\\rho_L^* \\approx 0.426$, $\\rho_R^* \\approx 0.266$; left rarefaction head speed $S_{L,h} \\approx -1.183$, tail speed $S_{L,t} \\approx -0.070$, contact speed $S_C = u_* \\approx 0.927$, right shock speed $S_R \\approx 1.75$.\n\nB.\n- Initialize on $x \\in [0,1]$ with diaphragm at $x_0 = 0.5$. Left state $(\\rho_L,u_L,p_L) = (0.125,\\,0,\\,0.1)$, right state $(\\rho_R,u_R,p_R) = (1,\\,0,\\,1)$, adiabatic index $\\gamma = 1.4$.\n- The solution consists of a left-going $1$-shock, a $2$-contact discontinuity with continuous density $\\rho_L^* = \\rho_R^*$, and a right-going $3$-rarefaction.\n- Star-state values taken as arithmetic means: $p_* = \\tfrac{1}{2}(p_L + p_R) = 0.55$, $u_* = \\tfrac{1}{2}(u_L + u_R) = 0$, with wave speeds $S_{L,h} = u_L - a_L$, $S_{L,t} = u_* - a_*$, and $S_R = u_R + a_R$ evaluated using the left/right sound speeds $a_{L,R} = \\sqrt{\\gamma p_{L,R}/\\rho_{L,R}}$.\n\nC.\n- Initialize on $x \\in [0,1]$ with diaphragm at $x_0 = 0.5$. Left state $(\\rho_L,u_L,p_L) = (1,\\,0,\\,1)$, right state $(\\rho_R,u_R,p_R) = (0.125,\\,0,\\,0.1)$, adiabatic index $\\gamma = 1.4$.\n- The solution consists of two rarefaction fans separated by a contact discontinuity; since the contact is an entropy wave, pressure may jump while density remains continuous.\n- Star-state estimates: $p_* \\approx 0.55$, $u_* \\approx 0$, with rarefaction head and tail speeds symmetric about $0$.\n\nD.\n- Initialize on $x \\in [0,1]$ with diaphragm at $x_0 = 0.5$. Left state $(\\rho_L,u_L,p_L) = (1,\\,0,\\,1)$, right state $(\\rho_R,u_R,p_R) = (0.125,\\,0,\\,0.1)$, adiabatic index $\\gamma = \\tfrac{5}{3}$.\n- The solution is a left-going $1$-shock, a $2$-contact discontinuity where velocity is discontinuous $u_L^* \\neq u_R^*$, and a right-going $3$-shock.\n- Star-state values set by equalizing total enthalpy: $p_* \\approx 1$, $u_* \\approx 0$, with shock speeds $S_{L,R}$ given by $u \\pm a$ based on pre-shock sound speeds $a_{L,R} = \\sqrt{\\gamma p_{L,R}/\\rho_{L,R}}$.\n\nWhich option is correct for the Sod shock tube verification test description and analytical solution structure under the stated Euler equations and ideal-gas model?", "solution": "The problem statement is a valid, well-posed problem in computational fluid dynamics and the theory of hyperbolic conservation laws. It asks to identify the correct description of the classic Sod shock tube problem, which is a standard verification test for numerical solvers of the Euler equations. The governing equations and the equation of state provided are standard for an ideal compressible fluid.\n\nThe Sod shock tube problem is a specific instance of a Riemann problem, which is an initial value problem with piecewise constant data separated by a single discontinuity. The initial conditions for the standard Sod problem are given by two states, a left state ($L$) and a right state ($R$), separated by a diaphragm at a position $x_0$. At time $t=0$, the diaphragm is removed, and waves propagate into the two regions. The solution is self-similar and depends only on the variable $\\xi = (x-x_0)/t$.\n\nThe one-dimensional Euler equations,\n$$\n\\partial_t \\rho + \\partial_x (\\rho u) = 0\n$$\n$$\n\\partial_t (\\rho u) + \\partial_x (\\rho u^2 + p) = 0\n$$\n$$\n\\partial_t E + \\partial_x \\big(u(E+p)\\big) = 0\n$$\nconstitute a hyperbolic system of conservation laws. The eigenvalues of the system's Jacobian matrix are $\\lambda_1 = u-a$, $\\lambda_2 = u$, and $\\lambda_3 = u+a$, where $a = \\sqrt{\\gamma p / \\rho}$ is the local sound speed. These eigenvalues correspond to the characteristic speeds of wave propagation. The characteristic fields associated with $\\lambda_1$ and $\\lambda_3$ are genuinely nonlinear, meaning their corresponding waves can be either shocks or rarefaction waves. The field associated with $\\lambda_2$ is linearly degenerate, and its corresponding wave is a contact discontinuity.\n\nThe solution to the Riemann problem consists of three waves separating four constant states: the initial left state ($L$), an intermediate \"star\" state to the left of the contact ($L*$), another intermediate \"star\" state to the right of the contact ($R*$), and the initial right state ($R$). Across the contact discontinuity (the middle wave, moving with speed $S_C = u_*$), pressure and velocity are continuous. Therefore, $u_{L*} = u_{R*} = u_*$ and $p_{L*} = p_{R*} = p_*$. However, density and internal energy (and thus entropy) are generally discontinuous, so $\\rho_{L*} \\neq \\rho_{R*}$. The space between the leftmost and rightmost waves is called the star region, characterized by the constant pressure $p_*$ and velocity $u_*$.\n\nLet us analyze the specific initial conditions for the standard Sod problem.\n- Left state: $(\\rho_L, u_L, p_L) = (1, 0, 1)$.\n- Right state: $(\\rho_R, u_R, p_R) = (0.125, 0, 0.1)$.\n- Adiabatic index: $\\gamma = 1.4$.\n- The fluid is initially at rest ($u_L = u_R = 0$). The pressure on the left is much higher than on the right ($p_L > p_R$).\n\nWhen the diaphragm is removed, the high-pressure gas on the left expands into the low-pressure region on the right. This expansion results in a flow moving to the right, so we expect $u_* > 0$.\n- The wave connecting the left state ($L$) to the star region ($L*$) is associated with the eigenvalue $\\lambda_1 = u-a$. Since the fluid is expanding, this wave must be a rarefaction fan. This rarefaction wave travels to the left relative to the fluid flow. The head of the rarefaction moves at speed $S_{L,h} = u_L - a_L$ and the tail at speed $S_{L,t} = u_* - a_*$, where $a_* = \\sqrt{\\gamma p_* / \\rho_{L*}}$.\n- The wave connecting the right state ($R$) to the star region ($R*$) is associated with the eigenvalue $\\lambda_3 = u+a$. The gas in the right state is being compressed by the expanding gas from the left. This compression wave steepens to form a shock wave. This shock travels to the right with speed $S_R > u_R + a_R$.\n- The central wave is the contact discontinuity, separating the fluid that was originally on the left from the fluid originally on the right. It moves with the fluid velocity $u_*$.\n\nTherefore, the wave structure of the Sod shock tube solution is: a left-going rarefaction, a contact discontinuity, and a right-going shock.\n\nNow we evaluate each option based on this analysis.\n\n**A. Evaluation:**\n- **Initial Conditions**: Specifies $(\\rho_L,u_L,p_L) = (1,\\,0,\\,1)$, $(\\rho_R,u_R,p_R) = (0.125,\\,0,\\,0.1)$, and $\\gamma = 1.4$. This is the correct setup for the standard Sod shock tube problem.\n- **Solution Structure**: States \"a left-going $1$-rarefaction, a $2$-contact discontinuity, and a right-going $3$-shock\". This matches our derived wave pattern perfectly.\n- **Continuity Conditions**: States \"$u_L^* = u_R^* = u_*$ and $p_L^* = p_R^* = p_*$, while density generally has a jump $\\rho_L^* \\neq \\rho_R^*$\". This is the correct description of the physical conditions across a contact discontinuity in the Euler equations.\n- **Numerical Values**: Lists approximate values: $p_* \\approx 0.303$, $u_* \\approx 0.927$, $\\rho_L^* \\approx 0.426$, $\\rho_R^* \\approx 0.266$; and wave speeds: $S_{L,h} \\approx -1.183$, $S_{L,t} \\approx -0.070$, $S_C = u_* \\approx 0.927$, $S_R \\approx 1.75$. These are the well-known and correct numerical values for the analytical solution of the Sod problem. They can be found by simultaneously solving the algebraic equations derived from the rarefaction wave relations and the Rankine-Hugoniot shock jump conditions.\nVerdict: **Correct**.\n\n**B. Evaluation:**\n- **Initial Conditions**: Swaps the left and right states. This describes a different Riemann problem, sometimes called the \"inverse\" Sod problem.\n- **Solution Structure**: Claims \"a left-going $1$-shock ... and a right-going $3$-rarefaction\". For the standard Sod problem, this is incorrect. For the initial conditions it lists ($p_L < p_R$), the flow would be to the left ($u_* < 0$), and the wave pattern would be a left-going rarefaction and a right-going shock, which is the reverse of what it says. The proposed wave structure is fundamentally flawed.\n- **Continuity Conditions**: Claims \"continuous density $\\rho_L^* = \\rho_R^*$\". This is incorrect. Density is discontinuous across a contact discontinuity.\n- **Star-state values**: Uses arithmetic means. This is a naive and incorrect approximation. For example, it implies $u_*=0$, which contradicts the physics that a pressure gradient must induce a flow.\nVerdict: **Incorrect**.\n\n**C. Evaluation:**\n- **Initial Conditions**: Correctly states the initial conditions for the Sod problem.\n- **Solution Structure**: Claims \"two rarefaction fans\". This is incorrect. The compressive wave on the right must form a shock.\n- **Continuity Conditions**: Claims that across a contact \"pressure may jump while density remains continuous\". This is the exact opposite of the correct conditions.\n- **Star-state estimates**: Estimates $u_* \\approx 0$, which is physically incorrect as a pressure difference must drive a flow.\nVerdict: **Incorrect**.\n\n**D. Evaluation:**\n- **Initial Conditions**: Uses an adiabatic index of $\\gamma = \\tfrac{5}{3}$ instead of the standard $\\gamma=1.4$. While a valid physical problem, this is not the classic Sod test case.\n- **Solution Structure**: Claims \"a left-going $1$-shock\". This is incorrect; the left wave is a rarefaction.\n- **Continuity Conditions**: Claims velocity is discontinuous across the contact, $u_L^* \\neq u_R^*$. This is a fundamental error; velocity must be continuous across a contact discontinuity. A velocity jump would imply an infinite acceleration, which is unphysical.\n- **Star-state values**: Suggests a determination based on \"equalizing total enthalpy\", which is not the correct physical principle for solving the Riemann problem.\nVerdict: **Incorrect**.\n\nBased on the detailed analysis, only option A provides a fully correct description of the initial conditions, wave structure, physical principles, and numerical results for the standard Sod shock tube problem.", "answer": "$$\\boxed{A}$$", "id": "3539807"}, {"introduction": "The true test of understanding is implementation. The accuracy of a finite-volume scheme for the Euler equations hinges on the choice of its numerical flux function, or approximate Riemann solver. This advanced practice [@problem_id:3539851] challenges you to build a solver from the ground up and compare two popular schemes, HLLE and HLLC, in a test designed to highlight their differing abilities to resolve contact discontinuities. By completing this exercise, you will gain firsthand experience with the practical consequences of numerical algorithm design and see why sophisticated solvers are vital for accurately modeling astrophysical phenomena.", "problem": "Consider the one-dimensional Euler equations for an ideal gas fluid with ratio of specific heats $\\gamma$, written in conservation-law form for mass, momentum, and total energy. Let the conserved variables be $U = [\\rho, \\rho u, E]$ and the physical flux be $F(U) = [\\rho u, \\rho u^2 + p, u(E + p)]$, with equation of state $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$. The domain is periodic on the interval $[0,1]$ in dimensionless units. You are to perform a finite-volume simulation that advects a square-wave contact discontinuity at constant velocity and pressure, and compare two approximate Riemann solvers: the Harten–Lax–van Leer–Einfeldt (HLLE) solver and the Harten–Lax–van Leer–Contact (HLLC) solver, in terms of their ability to capture contact discontinuities. The comparison metric is the numerical thickness of the contact after one domain-crossing time.\n\nStarting from the foundational principles below, derive and implement a first-order accurate, explicit, finite-volume method with periodic boundary conditions for the Euler system:\n- Conservation of mass: $\\partial_t \\rho + \\partial_x(\\rho u) = 0$.\n- Conservation of momentum: $\\partial_t (\\rho u) + \\partial_x(\\rho u^2 + p) = 0$.\n- Conservation of energy: $\\partial_t E + \\partial_x(u(E + p)) = 0$.\n- Ideal gas equation of state: $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$.\n\nYour initial condition should represent a square-wave contact at uniform pressure and velocity, which is an entropy/contact wave. Specifically, set $\\gamma = 1.4$, $u_0 = 1$, $p_0 = 1$, and define two density states $\\rho_{\\mathrm{low}} = 1$ and $\\rho_{\\mathrm{high}} = 2$. The total energy density is $E = \\tfrac{p_0}{\\gamma - 1} + \\tfrac{1}{2}\\rho u_0^2$ in each region. Initialize the domain with $\\rho(x) = \\rho_{\\mathrm{high}}$ for $x \\in [0, \\tfrac{1}{2})$ and $\\rho(x) = \\rho_{\\mathrm{low}}$ for $x \\in [\\tfrac{1}{2}, 1)$, with $u(x) \\equiv u_0$ and $p(x) \\equiv p_0$, and periodic boundary conditions. Advance the solution to final time $t_{\\mathrm{end}} = 1$, corresponding to one advection of the square wave across the domain.\n\nImplement two finite-volume solvers that differ only in their numerical flux function at interfaces:\n- The Harten–Lax–van Leer–Einfeldt (HLLE) flux.\n- The Harten–Lax–van Leer–Contact (HLLC) flux.\n\nUse a Courant–Friedrichs–Lewy (CFL) number of $0.4$ to determine the time step $\\Delta t = \\mathrm{CFL}\\,\\Delta x / \\max_i(|u_i| + a_i)$, where the local sound speed is $a_i = \\sqrt{\\gamma p_i / \\rho_i}$ and $\\Delta x$ is the uniform grid spacing.\n\nDefine the contact thickness at final time as follows. Let the reference low and high densities be $\\rho_{\\mathrm{low}}$ and $\\rho_{\\mathrm{high}}$. Compute the normalized density $q_i = \\mathrm{clip}\\left((\\rho_i - \\rho_{\\mathrm{low}})/(\\rho_{\\mathrm{high}} - \\rho_{\\mathrm{low}}), 0, 1\\right)$ for each cell index $i$. Identify the sets of indices where $q_i \\in (0.1, 0.9)$; these indices mark transitional regions near contacts. The contact thickness is the number of grid cells in each contiguous transitional segment. Since the square wave has two contact interfaces in the periodic domain, report the aversage thickness across all transitional segments present at $t_{\\mathrm{end}}$. Express thickness as an integer number of cells.\n\nDesign a program that, for each grid resolution in the test suite, runs the simulation twice (once with HLLE and once with HLLC) and reports the measured average contact thickness for each solver.\n\nTest suite and coverage:\n- Case $1$: $N = 64$ cells (a coarse resolution to test strong numerical diffusion).\n- Case $2$: $N = 128$ cells (a moderate resolution to test convergence).\n- Case $3$: $N = 256$ cells (a finer resolution to test sharper capturing and stability).\n\nAnswer specification:\n- For each case, produce the pair $[\\text{thickness}_{\\mathrm{HLLE}}, \\text{thickness}_{\\mathrm{HLLC}}]$ of integer thicknesses in number of cells.\n- Your program should produce a single line of output containing the three pairs for the three cases as a comma-separated list of lists enclosed in square brackets, for example: $[[a,b],[c,d],[e,f]]$.\n\nAll quantities are dimensionless, and the required outputs are integers in number of grid cells. No other units are involved. The implementation must be self-contained, require no input, and adhere to the specified environment constraints.", "solution": "The problem requires the implementation and comparison of two approximate Riemann solvers, Harten–Lax–van Leer–Einfeldt (HLLE) and Harten–Lax–van Leer–Contact (HLLC), for the one-dimensional Euler equations of gas dynamics. The comparison is based on their ability to resolve a contact discontinuity. The solution is developed using a first-order, explicit finite-volume method.\n\nThe one-dimensional Euler equations in conservation form are given by:\n$$\n\\frac{\\partial U}{\\partial t} + \\frac{\\partial F(U)}{\\partial x} = 0\n$$\nwhere $U$ is the vector of conserved variables and $F(U)$ is the vector of corresponding fluxes. For an ideal gas with a ratio of specific heats $\\gamma$, these are:\n$$\nU = \\begin{bmatrix} \\rho \\\\ \\rho u \\\\ E \\end{bmatrix}, \\quad F(U) = \\begin{bmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E + p) \\end{bmatrix}\n$$\nHere, $\\rho$ is the fluid density, $u$ is the velocity, $E$ is the total energy density per unit volume, and $p$ is the pressure. The system is closed by the ideal gas equation of state, which connects pressure to the conserved quantities:\n$$\np = (\\gamma - 1)\\left(E - \\frac{1}{2}\\rho u^2\\right)\n$$\n\nThe numerical solution is constructed using a finite-volume method on a uniform grid over the periodic domain $[0,1]$. The domain is discretized into $N$ cells of width $\\Delta x = 1/N$. Let $U_i(t)$ be the spatial average of the conserved variables over the $i$-th cell, $[x_{i-1/2}, x_{i+1/2}]$, at time $t$. Integrating the conservation law over cell $i$ yields the semi-discrete update equation:\n$$\n\\frac{dU_i}{dt} = -\\frac{1}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right)\n$$\nwhere $F_{i+1/2}$ is the numerical flux at the interface between cell $i$ and cell $i+1$. For a first-order accurate scheme, this flux is a function of the constant states in the adjacent cells, $U_i$ and $U_{i+1}$: $F_{i+1/2} = F_{\\text{num}}(U_i, U_{i+1})$. The time integration is performed using an explicit forward Euler method:\n$$\nU_i^{n+1} = U_i^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{i+1/2}^n - F_{i-1/2}^n \\right)\n$$\nThe time step $\\Delta t$ is determined by the Courant–Friedrichs–Lewy (CFL) condition to ensure numerical stability:\n$$\n\\Delta t = \\text{CFL} \\frac{\\Delta x}{\\max_i(|u_i| + a_i)}\n$$\nwhere $a_i = \\sqrt{\\gamma p_i / \\rho_i}$ is the local sound speed in cell $i$, and we use a CFL number of $0.4$.\n\nThe core of the method lies in the choice of the numerical flux function, $F_{\\text{num}}$. We implement and compare two such functions.\n\n**1. The Harten–Lax–van Leer–Einfeldt (HLLE) Solver**\nThe HLLE solver is based on a two-wave model of the Riemann problem, assuming the solution consists of the original left and right states separated by a single contact region bounded by the fastest left-going and right-going waves. The signal speeds are estimated as:\n$$\nS_L = \\min(u_L - a_L, u_R - a_R) \\quad \\text{and} \\quad S_R = \\max(u_L + a_L, u_R + a_R)\n$$\nwhere the subscripts $L$ and $R$ denote the states to the left and right of the interface, respectively. The HLLE flux is then given by a piecewise function:\n$$\nF_{\\text{HLLE}}(U_L, U_R) = \\begin{cases} \nF(U_L) & \\text{if } S_L \\geq 0 \\\\\n\\frac{S_R F(U_L) - S_L F(U_R) + S_L S_R (U_R - U_L)}{S_R - S_L} & \\text{if } S_L < 0 < S_R \\\\\nF(U_R) & \\text{if } S_R \\leq 0\n\\end{cases}\n$$\nThis solver is very robust but is known to be diffusive, as it smears out intermediate waves like contact discontinuities and shear waves.\n\n**2. The Harten–Lax–van Leer–Contact (HLLC) Solver**\nThe HLLC solver improves upon HLLE by reintroducing the contact wave into the model, resulting in a three-wave structure ($S_L$, $S_*$, $S_R$). The contact wave speed $S_*$ is estimated as:\n$$\nS_* = \\frac{p_R - p_L + \\rho_L u_L (S_L - u_L) - \\rho_R u_R (S_R - u_R)}{\\rho_L (S_L - u_L) - \\rho_R (S_R - u_R)}\n$$\nThis addition allows the HLLC solver to exactly resolve isolated contact discontinuities. The flux is again a piecewise function, but now with four regions defined by the wave speeds:\n$$\nF_{\\text{HLLC}}(U_L, U_R) = \\begin{cases} \nF_L & \\text{if } 0 \\le S_L \\\\\nF_L + S_L(U_*^L - U_L) & \\text{if } S_L < 0 \\le S_* \\\\\nF_R + S_R(U_*^R - U_R) & \\text{if } S_* < 0 < S_R \\\\\nF_R & \\text{if } S_R \\le 0\n\\end{cases}\n$$\nwhere $F_L = F(U_L)$, $F_R = F(U_R)$, and $U_*^K$ ($K \\in \\{L, R\\}$) are the states in the \"star\" region between the acoustic waves and the contact wave. These are given by:\n$$\nU_*^K = \\rho_K \\left( \\frac{S_K - u_K}{S_K - S_*} \\right) \\begin{bmatrix} 1 \\\\ S_* \\\\ E_K/\\rho_K + (S_* - u_K)(S_* + p_K/(\\rho_K(S_K-u_K))) \\end{bmatrix}\n$$\n\n**Simulation Setup and Measurement**\nThe simulation is initialized with a contact discontinuity. The parameters are $\\gamma = 1.4$, uniform velocity $u_0 = 1$, and uniform pressure $p_0 = 1$. The density profile is a square wave: $\\rho = \\rho_{\\mathrm{high}} = 2$ for $x \\in [0, 0.5)$ and $\\rho = \\rho_{\\mathrm{low}} = 1$ for $x \\in [0.5, 1)$. This setup is an exact solution to the Euler equations, representing a contact wave advecting with speed $u_0=1$. The simulation runs until $t_{\\mathrm{end}}=1$, which corresponds to one full period of the wave crossing the domain.\n\nThe performance of each solver is quantified by the numerical thickness of the contact discontinuity at the final time. The density $\\rho_i$ in each cell is normalized:\n$$\nq_i = \\text{clip}\\left(\\frac{\\rho_i - \\rho_{\\mathrm{low}}}{\\rho_{\\mathrm{high}} - \\rho_{\\mathrm{low}}}, 0, 1\\right)\n$$\nCells where $q_i \\in (0.1, 0.9)$ are considered part of a transitional region. Due to periodicity, the initial condition has two such transitions. The thickness is defined as the number of cells in a contiguous transitional segment. The final reported value is the average thickness over the two segments present at $t_{\\mathrm{end}}$, rounded to the nearest integer.\n\nThe algorithm proceeds by initializing the grid with the square-wave initial condition, then entering a time loop. In each step, $\\Delta t$ is computed, numerical fluxes are calculated at all cell interfaces using either the HLLE or HLLC solver, and the conserved variables in all cells are updated. Periodic boundary conditions are enforced by treating the grid as a circular array. After reaching $t_{\\mathrm{end}}$, the final density profile is analyzed to compute the average contact thickness. This process is repeated for each solver and each specified grid resolution $N$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Global constants\nGAMMA = 1.4\n\ndef cons_to_prim(U):\n    \"\"\"Converts a conserved state vector U to primitive variables rho, u, p.\"\"\"\n    rho = U[..., 0]\n    # To avoid division by zero in vacuum states (not in this problem, but good practice)\n    u = U[..., 1] / (rho + 1e-12)\n    E = U[..., 2]\n    # Prevent negative pressure from numerical errors\n    p = np.maximum((GAMMA - 1.0) * (E - 0.5 * rho * u**2), 1e-9)\n    return rho, u, p\n\ndef prim_to_cons(rho, u, p):\n    \"\"\"Converts primitive variables rho, u, p to a conserved state vector U.\"\"\"\n    shape = rho.shape + (3,) if rho.ndim > 0 else (3,)\n    U = np.zeros(shape)\n    U[..., 0] = rho\n    U[..., 1] = rho * u\n    U[..., 2] = p / (GAMMA - 1.0) + 0.5 * rho * u**2\n    return U\n\ndef get_physical_flux_from_cons(U):\n    \"\"\"Computes the physical flux F from a conserved state vector U.\"\"\"\n    rho, u, p = cons_to_prim(U)\n    F = np.zeros_like(U)\n    F[..., 0] = rho * u\n    F[..., 1] = rho * u**2 + p\n    F[..., 2] = u * (U[..., 2] + p)\n    return F\n\ndef hlle_flux(U_L, U_R):\n    \"\"\"Computes the HLLE flux at interfaces.\"\"\"\n    rho_L, u_L, p_L = cons_to_prim(U_L)\n    rho_R, u_R, p_R = cons_to_prim(U_R)\n\n    a_L = np.sqrt(GAMMA * p_L / rho_L)\n    a_R = np.sqrt(GAMMA * p_R / rho_R)\n\n    S_L = np.minimum(u_L - a_L, u_R - a_R)\n    S_R = np.maximum(u_L + a_L, u_R + a_R)\n\n    F_L = get_physical_flux_from_cons(U_L)\n    F_R = get_physical_flux_from_cons(U_R)\n    \n    # Numerator of the intermediate HLLE flux state\n    F_hlle_num = (S_R[:, None] * F_L - S_L[:, None] * F_R +\n                  S_L[:, None] * S_R[:, None] * (U_R - U_L))\n    F_hlle_den = S_R - S_L\n    \n    F_hlle = F_hlle_num / (F_hlle_den[:, None] + 1e-12)\n\n    flux = np.zeros_like(U_L)\n    \n    cond_L_region = S_L >= 0\n    cond_R_region = S_R = 0\n    cond_HLL_region = ~(cond_L_region | cond_R_region)\n    \n    flux = np.where(cond_L_region[:, None], F_L, flux)\n    flux = np.where(cond_R_region[:, None], F_R, flux)\n    flux = np.where(cond_HLL_region[:, None], F_hlle, flux)\n    \n    return flux\n\ndef hllc_flux(U_L, U_R):\n    \"\"\"Computes the HLLC flux at interfaces.\"\"\"\n    rho_L, u_L, p_L = cons_to_prim(U_L)\n    rho_R, u_R, p_R = cons_to_prim(U_R)\n\n    a_L = np.sqrt(GAMMA * p_L / rho_L)\n    a_R = np.sqrt(GAMMA * p_R / rho_R)\n\n    S_L = np.minimum(u_L - a_L, u_R - a_R)\n    S_R = np.maximum(u_L + a_L, u_R + a_R)\n\n    S_star_num = (p_R - p_L + rho_L * u_L * (S_L - u_L) - rho_R * u_R * (S_R - u_R))\n    S_star_den = (rho_L * (S_L - u_L) - rho_R * (S_R - u_R))\n    S_star = S_star_num / (S_star_den + 1e-12)\n\n    F_L = get_physical_flux_from_cons(U_L)\n    F_R = get_physical_flux_from_cons(U_R)\n    \n    flux = np.zeros_like(U_L)\n\n    # Conditions based on interface location relative to waves\n    cond_L_region = S_L >= 0\n    cond_R_region = S_R = 0\n    cond_L_star_region = (S_L  0)  (S_star >= 0)\n    cond_R_star_region = (S_R > 0)  (S_star  0)\n\n    # Flux in L region\n    flux = np.where(cond_L_region[:, None], F_L, flux)\n    # Flux in R region\n    flux = np.where(cond_R_region[:, None], F_R, flux)\n\n    if np.any(cond_L_star_region):\n        fact = rho_L * (S_L - u_L) / (S_L - S_star)\n        U_star_L = np.zeros_like(U_L)\n        U_star_L[:, 0] = fact\n        U_star_L[:, 1] = fact * S_star\n        E_L = U_L[:, 2]\n        term_E = (S_star - u_L) * (S_star + p_L / (rho_L * (S_L - u_L) + 1e-12))\n        U_star_L[:, 2] = fact * (E_L / rho_L + term_E)\n        F_star_L = F_L + S_L[:, None] * (U_star_L - U_L)\n        flux = np.where(cond_L_star_region[:, None], F_star_L, flux)\n        \n    if np.any(cond_R_star_region):\n        fact = rho_R * (S_R - u_R) / (S_R - S_star)\n        U_star_R = np.zeros_like(U_R)\n        U_star_R[:, 0] = fact\n        U_star_R[:, 1] = fact * S_star\n        E_R = U_R[:, 2]\n        term_E = (S_star - u_R) * (S_star + p_R / (rho_R * (S_R - u_R) + 1e-12))\n        U_star_R[:, 2] = fact * (E_R / rho_R + term_E)\n        F_star_R = F_R + S_R[:, None] * (U_star_R - U_R)\n        flux = np.where(cond_R_star_region[:, None], F_star_R, flux)\n\n    return flux\n\ndef run_simulation(N, solver_type, CFL, t_end):\n    \"\"\"Main simulation driver.\"\"\"\n    dx = 1.0 / N\n    x = np.linspace(0.5 * dx, 1.0 - 0.5 * dx, N)\n    \n    rho_low, rho_high = 1.0, 2.0\n    p0, u0 = 1.0, 1.0\n\n    rho = np.full(N, rho_low)\n    rho[x  0.5] = rho_high\n    u = np.full(N, u0)\n    p = np.full(N, p0)\n\n    U = prim_to_cons(rho, u, p)\n\n    flux_func = hlle_flux if solver_type == 'HLLE' else hllc_flux\n\n    t = 0.0\n    while t  t_end:\n        rho_n, u_n, p_n = cons_to_prim(U)\n        a_n = np.sqrt(GAMMA * p_n / rho_n)\n        max_speed = np.max(np.abs(u_n) + a_n)\n        dt = CFL * dx / max_speed\n        if t + dt > t_end:\n            dt = t_end - t\n\n        U_L = U\n        U_R = np.roll(U, -1, axis=0)\n        \n        fluxes = flux_func(U_L, U_R)\n        fluxes_L = np.roll(fluxes, 1, axis=0)\n        \n        U = U - (dt / dx) * (fluxes - fluxes_L)\n        \n        t += dt\n\n    final_rho = U[:, 0]\n    return calculate_thickness(final_rho, rho_low, rho_high)\n\ndef calculate_thickness(rho, rho_low, rho_high):\n    \"\"\"Calculates the average thickness of contact discontinuities.\"\"\"\n    q = (rho - rho_low) / (rho_high - rho_low)\n    q = np.clip(q, 0, 1)\n    \n    is_transitional = (q > 0.1)  (q  0.9)\n    total_cells = np.sum(is_transitional)\n    \n    if total_cells == 0:\n        return 0\n\n    is_transitional_shifted = np.roll(is_transitional, 1)\n    num_segments = np.sum(is_transitional  ~is_transitional_shifted)\n\n    if num_segments == 0:\n        return total_cells if total_cells > 0 else 0\n\n    avg_thickness = total_cells / num_segments\n    return int(round(avg_thickness))\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [64, 128, 256]\n    CFL = 0.4\n    t_end = 1.0\n\n    results = []\n    for N in test_cases:\n        thickness_hlle = run_simulation(N, 'HLLE', CFL, t_end)\n        thickness_hllc = run_simulation(N, 'HLLC', CFL, t_end)\n        results.append([thickness_hlle, thickness_hllc])\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"[{r[0]},{r[1]}]\" for r in results]\n    print(f\"[[{results[0][0]},{results[0][1]}],[{results[1][0]},{results[1][1]}],[{results[2][0]},{results[2][1]}]]\")\n\nsolve()\n```", "id": "3539851"}]}