{"hands_on_practices": [{"introduction": "In the simplest model, material in an accretion disk orbits a central object at the Keplerian speed, determined solely by gravity. However, a real disk is a fluid with internal pressure that creates an outward radial force. This practice explores how this pressure support partially counteracts gravity, causing the gas to orbit at a sub-Keplerian velocity, a fundamental property of gaseous disks. By numerically calculating this deviation, you will gain hands-on experience with the force balance that governs the disk's rotational structure [@problem_id:3517571].", "problem": "You are tasked with writing a complete, runnable program that models the azimuthal velocity profile of a thin, axisymmetric gas disk orbiting a central point mass in a Newtonian gravitational potential, including the effect of a radial gas pressure gradient. The goal is to compute the pressure gradient from a specified radial temperature profile $T(R)$ and surface density profile $\\Sigma(R)$, determine the resulting azimuthal speed $v_{\\phi}(R)$, and compare it to the Keplerian speed. All physics must be expressed and computed in the International System of Units (SI), and all answers must be unitless floats as specified below.\n\nStarting point and assumptions:\n- The gravitational potential of a point mass $M$ is $\\Phi(R) = - G M / R$, where $G$ is the gravitational constant and $R$ is the cylindrical radius.\n- Assume a steady, axisymmetric, geometrically thin disk with negligible radial velocity and negligible self-gravity.\n- Use the radial component of the Euler equation for circular motion under a Newtonian potential and include the radial pressure gradient term.\n- Use an isothermal vertical structure at each radius so that $P = \\rho c_{s}^{2}$, where $P$ is thermal pressure, $\\rho$ is density, and $c_{s}$ is the isothermal sound speed. Adopt $c_{s}^{2}(R) = k_{\\mathrm{B}} T(R) / (\\mu m_{p})$, where $k_{\\mathrm{B}}$ is the Boltzmann constant, $m_{p}$ is the proton mass, and $\\mu$ is the mean molecular weight.\n- Use the vertically integrated pressure $\\Pi(R) \\equiv \\int_{-\\infty}^{+\\infty} P \\, dz$ and the surface density $\\Sigma(R) \\equiv \\int_{-\\infty}^{+\\infty} \\rho \\, dz$, and assume vertical isothermality so that $\\Pi(R) = \\Sigma(R) c_{s}^{2}(R)$.\n- Define the Keplerian speed as $v_{K}(R) = \\sqrt{G M / R}$.\n\nRequired derivations and computations:\n1. Starting from the above fundamental relations, derive the expression that determines $v_{\\phi}(R)$ in terms of $M$, $\\Sigma(R)$, and the radial gradient of the vertically integrated pressure $\\Pi(R)$ under a Newtonian potential.\n2. Implement a numerical method to compute the radial derivative $d\\Pi/dR$ from $\\Pi(R)$ using a second-order accurate finite-difference scheme in the interior and a one-sided first-order scheme at the boundaries.\n3. Compute $v_{\\phi}(R)$ and compare to $v_{K}(R)$ by evaluating the absolute fractional deviation $\\delta(R) \\equiv \\lvert v_{\\phi}(R)/v_{K}(R) - 1 \\rvert$.\n4. For each test case specified below, return the maximum value of $\\delta(R)$ over the provided radial grid as a single float.\n\nPhysical constants and units to be used:\n- Use $G = 6.67430 \\times 10^{-11} \\ \\mathrm{m^{3} \\ kg^{-1} \\ s^{-2}}$.\n- Use $M_{\\odot} = 1.98847 \\times 10^{30} \\ \\mathrm{kg}$.\n- Use $k_{\\mathrm{B}} = 1.380649 \\times 10^{-23} \\ \\mathrm{J \\ K^{-1}}$.\n- Use $m_{p} = 1.67262192369 \\times 10^{-27} \\ \\mathrm{kg}$.\n- Use $\\mu = 2.34$ (dimensionless).\n- Use $1$ Astronomical Unit as $1 \\ \\mathrm{AU} = 1.495978707 \\times 10^{11} \\ \\mathrm{m}$.\n- All radial distances $R$ must be in $\\mathrm{m}$, temperatures in $\\mathrm{K}$, surface densities $\\Sigma$ in $\\mathrm{kg \\ m^{-2}}$, speeds in $\\mathrm{m \\ s^{-1}}$, and the final reported deviations must be unitless floats.\n\nProfiles to be used:\n- Temperature: $T(R) = T_{0} \\left( R / R_{0} \\right)^{-q}$.\n- Surface density: $\\Sigma(R) = \\Sigma_{0} \\left( R / R_{0} \\right)^{-p} \\times \\exp\\left( - R / R_{c} \\right)$ if a taper radius $R_{c}$ is provided; otherwise the exponential factor is omitted.\n\nNumerical differentiation requirement:\n- For a radius grid $\\{ R_{i} \\}_{i=0}^{N-1}$ with uniform spacing $\\Delta R$, approximate $d\\Pi/dR$ using\n  - Interior points $i \\in \\{1,2,\\dots,N-2\\}$: $ \\left( d\\Pi/dR \\right)_{i} \\approx \\left( \\Pi_{i+1} - \\Pi_{i-1} \\right) / \\left( 2 \\Delta R \\right)$.\n  - Boundaries: $ \\left( d\\Pi/dR \\right)_{0} \\approx \\left( \\Pi_{1} - \\Pi_{0} \\right) / \\Delta R$ and $ \\left( d\\Pi/dR \\right)_{N-1} \\approx \\left( \\Pi_{N-1} - \\Pi_{N-2} \\right) / \\Delta R$.\n\nTest suite:\nFor each of the following test cases, construct the radius grid $\\{R_{i}\\}$ as a linearly spaced array between the stated bounds (inclusive) with the stated number of points, compute $\\delta(R)$, and return the maximum over the grid. In all cases, set $M = M_{\\star} \\equiv 1 \\ M_{\\odot}$ and $\\mu = 2.34$.\n\n- Test case $1$ (happy path, power laws without taper):\n  - $R \\in [0.1 \\ \\mathrm{AU}, \\ 100 \\ \\mathrm{AU}]$, number of points $N = 256$.\n  - $T_{0} = 280 \\ \\mathrm{K}$ at $R_{0} = 1 \\ \\mathrm{AU}$, exponent $q = 0.5$.\n  - $\\Sigma_{0} = 17000 \\ \\mathrm{kg \\ m^{-2}}$ at $R_{0} = 1 \\ \\mathrm{AU}$, exponent $p = 1.0$.\n  - No exponential taper (omit the exponential factor).\n- Test case $2$ (boundary case, constant profiles):\n  - $R \\in [1 \\ \\mathrm{AU}, \\ 10 \\ \\mathrm{AU}]$, number of points $N = 256$.\n  - $T_{0} = 100 \\ \\mathrm{K}$ at $R_{0} = 1 \\ \\mathrm{AU}$, exponent $q = 0.0$.\n  - $\\Sigma_{0} = 100 \\ \\mathrm{kg \\ m^{-2}}$ at $R_{0} = 1 \\ \\mathrm{AU}$, exponent $p = 0.0$.\n  - No exponential taper.\n- Test case $3$ (tapered outer disk):\n  - $R \\in [1 \\ \\mathrm{AU}, \\ 200 \\ \\mathrm{AU}]$, number of points $N = 512$.\n  - $T_{0} = 150 \\ \\mathrm{K}$ at $R_{0} = 1 \\ \\mathrm{AU}$, exponent $q = 0.4$.\n  - $\\Sigma_{0} = 1000 \\ \\mathrm{kg \\ m^{-2}}$ at $R_{0} = 1 \\ \\mathrm{AU}$, exponent $p = 1.0$.\n  - Exponential taper with $R_{c} = 30 \\ \\mathrm{AU}$.\n- Test case $4$ (hot inner disk, steeper gradients):\n  - $R \\in [0.1 \\ \\mathrm{AU}, \\ 10 \\ \\mathrm{AU}]$, number of points $N = 384$.\n  - $T_{0} = 1000 \\ \\mathrm{K}$ at $R_{0} = 0.1 \\ \\mathrm{AU}$, exponent $q = 0.75$.\n  - $\\Sigma_{0} = 10000 \\ \\mathrm{kg \\ m^{-2}}$ at $R_{0} = 0.1 \\ \\mathrm{AU}$, exponent $p = 1.5$.\n  - No exponential taper.\n\nWhat to output:\n- For each test case, compute the maximum absolute fractional deviation $\\max_{i} \\delta(R_{i})$.\n- Your program should produce a single line of output containing the results as a comma-separated list of four floats, enclosed in square brackets, with each float rounded to exactly six digits after the decimal point. For example, output of the form $[x_{1},x_{2},x_{3},x_{4}]$ where each $x_{j}$ is a float with six digits after the decimal point and no units.\n\nAngle units: No angles are used.\n\nPercentages: Do not use a percentage sign; the deviation is a fraction and must be reported as a unitless float.\n\nScientific realism constraints:\n- Ensure that the computed $v_{\\phi}^{2}(R)$ never becomes negative. If numerical differentiation leads to a slightly negative value due to round-off, you must treat it as zero before taking a square root.\n\nFinal requirement:\n- The final code must be self-contained, require no input, and print only the specified single-line list on standard output. The implementation language and library constraints are specified separately in the execution environment.", "solution": "The user has requested a solution to a computational astrophysics problem involving the calculation of the azimuthal velocity profile in a gaseous accretion disk. The first step is to validate the problem statement. The problem is found to be scientifically grounded, well-posed, objective, and internally consistent. It represents a standard exercise in accretion disk theory. Therefore, I will proceed with a full solution.\n\nThe solution involves two main stages: first, the derivation of the governing equation for the azimuthal velocity, and second, the implementation of a numerical algorithm to solve this equation for the given physical parameters and profiles.\n\n### I. Derivation of the Azimuthal Velocity Equation\n\nThe fundamental relationship governing the motion of a fluid in a gravitational potential is the Euler equation. For a steady-state ($\\partial/\\partial t = 0$), axisymmetric ($\\partial/\\partial\\phi = 0$), and inviscid fluid in circular motion ($v_R = v_z = 0$, $v_\\phi \\neq 0$) within a potential $\\Phi$, the radial component of the Euler equation in cylindrical coordinates $(R, \\phi, z)$ balances the forces per unit mass:\n$$\n\\text{Centripetal Acceleration} = \\text{Gravitational Force} + \\text{Pressure Force}\n$$\n$$\n-\\frac{v_{\\phi}^2(R)}{R} = -\\frac{\\partial\\Phi}{\\partial R} - \\frac{1}{\\rho}\\frac{\\partial P}{\\partial R}\n$$\nHere, $\\rho$ is the volume density, and $P$ is the thermal pressure. For a central point mass $M$, the Newtonian potential is $\\Phi(R) = -G M / R$, so its radial derivative is $\\partial\\Phi/\\partial R = GM/R^2$. The equation becomes:\n$$\n-\\frac{v_{\\phi}^2}{R} = -\\frac{GM}{R^2} - \\frac{1}{\\rho}\\frac{\\partial P}{\\partial R}\n$$\nMultiplying by $-R$ to solve for $v_\\phi^2$ gives:\n$$\nv_\\phi^2(R) = \\frac{GM}{R} + \\frac{R}{\\rho} \\frac{\\partial P}{\\partial R}\n$$\nThis equation correctly shows that a negative pressure gradient ($\\partial P/\\partial R  0$, i.e., pressure decreasing outwards) provides a radial force that helps support the disk against gravity, thus reducing the required orbital speed below the Keplerian value.\n\nThe problem requires a formulation in terms of vertically integrated quantities. We assume $v_{\\phi}$ and $\\Phi$ are independent of the vertical coordinate $z$ and integrate the equation of motion (multiplied by $\\rho$) over $z$:\n$$\n\\int_{-\\infty}^{+\\infty} \\rho(R,z) \\frac{v_{\\phi}^2(R)}{R} dz = \\int_{-\\infty}^{+\\infty} \\rho(R,z) \\frac{G M}{R^2} dz + \\int_{-\\infty}^{+\\infty} \\frac{\\partial P(R,z)}{\\partial R} dz\n$$\nUsing the definitions of surface density $\\Sigma(R) = \\int \\rho dz$ and vertically integrated pressure $\\Pi(R) = \\int P dz$, and applying the Leibniz integral rule to the pressure term, we get:\n$$\n\\Sigma(R) \\frac{v_{\\phi}^2(R)}{R} = \\Sigma(R) \\frac{G M}{R^2} + \\frac{d\\Pi(R)}{dR}\n$$\nDividing by $\\Sigma(R)$ and multiplying by $R$ gives the desired expression for $v_{\\phi}^2(R)$:\n$$\nv_{\\phi}^2(R) = \\frac{G M}{R} + \\frac{R}{\\Sigma(R)}\\frac{d\\Pi(R)}{dR}\n$$\nRecognizing the Keplerian velocity $v_K(R) = \\sqrt{G M/R}$, we arrive at the final governing equation:\n$$\nv_{\\phi}^2(R) = v_K^2(R) + \\frac{R}{\\Sigma(R)}\\frac{d\\Pi}{dR}\n$$\n\n### II. Numerical Implementation\n\nThe algorithm proceeds as follows for each test case:\n1.  **Setup**: All physical constants and parameters from the test case are defined in SI units. The radial grid $R$ is constructed as a linearly spaced array from $R_{\\min}$ to $R_{\\max}$ with $N$ points, with all distances converted from AU to meters.\n2.  **Profile Calculation**: The radial profiles for temperature $T(R)$ and surface density $\\Sigma(R)$ are calculated for each point on the radial grid using the provided power-law and optional exponential taper forms:\n    $$\n    T(R) = T_{0} \\left( \\frac{R}{R_{0}} \\right)^{-q}\n    $$\n    $$\n    \\Sigma(R) = \\Sigma_{0} \\left( \\frac{R}{R_{0}} \\right)^{-p} \\times \\exp\\left( - \\frac{R}{R_{c}} \\right)\n    $$\n3.  **Integrated Pressure**: The isothermal sound speed squared, $c_s^2(R) = \\frac{k_{\\mathrm{B}} T(R)}{\\mu m_{p}}$, is computed. Subsequently, the vertically integrated pressure is determined using the given relation $\\Pi(R) = \\Sigma(R) c_s^2(R)$.\n4.  **Numerical Differentiation**: The radial gradient of the integrated pressure, $d\\Pi/dR$, is computed numerically. As specified, a second-order central difference scheme is used for the interior points of the grid, and first-order one-sided (forward/backward) schemes are used at the two boundary points.\n    $$\n    \\left( \\frac{d\\Pi}{dR} \\right)_{i} = \\begin{cases}\n        (\\Pi_{1} - \\Pi_{0}) / \\Delta R  \\text{if } i=0 \\\\\n        (\\Pi_{i+1} - \\Pi_{i-1}) / (2\\Delta R)  \\text{if } 1 \\le i \\le N-2 \\\\\n        (\\Pi_{N-1} - \\Pi_{N-2}) / \\Delta R  \\text{if } i=N-1\n    \\end{cases}\n    $$\n    where $\\Delta R$ is the uniform grid spacing.\n5.  **Velocity Calculation**: The Keplerian velocity squared, $v_K^2(R) = G M / R$, is computed. The pressure gradient term, $\\frac{R}{\\Sigma(R)} \\frac{d\\Pi}{dR}$, is then added to $v_K^2(R)$ to obtain $v_{\\phi}^2(R)$. A check is performed to ensure $v_{\\phi}^2(R)$ is non-negative, setting any small negative values resulting from numerical inaccuracies to zero. Finally, $v_{\\phi}(R)$ and $v_K(R)$ are found by taking the square root.\n6.  **Deviation Analysis**: The absolute fractional deviation, $\\delta(R) = |v_{\\phi}(R)/v_K(R) - 1|$, is calculated across the grid. The maximum value of this deviation, $\\max(\\delta(R))$, is identified.\n7.  **Output**: The maximum deviation for each test case is collected, and the final results are formatted and printed as a single comma-separated list.\n\nThis procedure is systematically applied to all four test cases provided in the problem statement.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the maximum fractional deviation from Keplerian velocity in a\n    pressure-supported accretion disk for a series of test cases.\n    \"\"\"\n    \n    # Physical constants in SI units\n    G = 6.67430e-11  # m^3 kg^-1 s^-2\n    M_SOLAR = 1.98847e30  # kg\n    KB = 1.380649e-23  # J K^-1\n    MP = 1.67262192369e-27  # kg\n    AU = 1.495978707e11  # m\n    \n    # Fixed parameters for all test cases\n    M_STAR = 1.0 * M_SOLAR\n    MU = 2.34\n\n    # Test cases defined in the problem statement\n    test_cases = [\n        {\n            \"R_range_au\": (0.1, 100), \"N\": 256,\n            \"T0\": 280, \"R0_T_au\": 1.0, \"q\": 0.5,\n            \"Sigma0\": 17000, \"R0_Sigma_au\": 1.0, \"p\": 1.0,\n            \"Rc_au\": None\n        },\n        {\n            \"R_range_au\": (1, 10), \"N\": 256,\n            \"T0\": 100, \"R0_T_au\": 1.0, \"q\": 0.0,\n            \"Sigma0\": 100, \"R0_Sigma_au\": 1.0, \"p\": 0.0,\n            \"Rc_au\": None\n        },\n        {\n            \"R_range_au\": (1, 200), \"N\": 512,\n            \"T0\": 150, \"R0_T_au\": 1.0, \"q\": 0.4,\n            \"Sigma0\": 1000, \"R0_Sigma_au\": 1.0, \"p\": 1.0,\n            \"Rc_au\": 30.0\n        },\n        {\n            \"R_range_au\": (0.1, 10), \"N\": 384,\n            \"T0\": 1000, \"R0_T_au\": 0.1, \"q\": 0.75,\n            \"Sigma0\": 10000, \"R0_Sigma_au\": 0.1, \"p\": 1.5,\n            \"Rc_au\": None\n        }\n    ]\n\n    results = []\n\n    for case in test_cases:\n        # 1. Setup: Construct radial grid and convert units to SI\n        r_min_au, r_max_au = case[\"R_range_au\"]\n        N = case[\"N\"]\n        R = np.linspace(r_min_au * AU, r_max_au * AU, N)\n        \n        R0_T = case[\"R0_T_au\"] * AU\n        R0_Sigma = case[\"R0_Sigma_au\"] * AU\n        \n        # 2. Profile Calculation\n        # Temperature profile T(R)\n        T = case[\"T0\"] * (R / R0_T)**(-case[\"q\"])\n\n        # Surface density profile Sigma(R)\n        Sigma = case[\"Sigma0\"] * (R / R0_Sigma)**(-case[\"p\"])\n        if case[\"Rc_au\"] is not None:\n            Rc = case[\"Rc_au\"] * AU\n            Sigma *= np.exp(-R / Rc)\n            \n        # 3. Integrated Pressure Calculation\n        # Isothermal sound speed squared c_s^2(R)\n        cs2 = (KB * T) / (MU * MP)\n        \n        # Vertically integrated pressure Pi(R)\n        Pi = Sigma * cs2\n        \n        # 4. Numerical Differentiation of Pi\n        dPi_dR = np.zeros_like(R)\n        dR = R[1] - R[0]\n        \n        # Central difference for interior points\n        dPi_dR[1:-1] = (Pi[2:] - Pi[0:-2]) / (2 * dR)\n        \n        # One-sided difference for boundaries\n        dPi_dR[0] = (Pi[1] - Pi[0]) / dR  # Forward difference\n        dPi_dR[-1] = (Pi[-1] - Pi[-2]) / dR # Backward difference\n        \n        # 5. Velocity Calculation\n        # Keplerian velocity squared\n        vk2 = G * M_STAR / R\n        \n        # Pressure support term\n        pressure_term = (R / Sigma) * dPi_dR\n        \n        # Azimuthal velocity squared\n        v_phi_sq = vk2 + pressure_term\n        \n        # Ensure v_phi_sq is non-negative\n        v_phi_sq = np.maximum(v_phi_sq, 0)\n        \n        # Calculate velocities\n        v_phi = np.sqrt(v_phi_sq)\n        vk = np.sqrt(vk2)\n        \n        # 6. Deviation Analysis\n        # Handle potential division by zero at R=0, though not possible with given ranges\n        with np.errstate(divide='ignore', invalid='ignore'):\n            delta = np.abs(v_phi / vk - 1)\n        \n        # The result for the case is the maximum deviation\n        max_delta = np.nanmax(delta)\n        results.append(max_delta)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join([f'{r:.6f}' for r in results])}]\")\n\nsolve()\n```", "id": "3517571"}, {"introduction": "While pressure and rotation work to stabilize a disk, the disk's own self-gravity can act as a powerful destabilizing agent, potentially causing it to fragment into clumps or form spiral structures. This balance is quantified by the Toomre stability parameter, $Q$. This exercise provides practical experience in deriving and computing $Q(R)$ for a protostellar disk model, allowing you to identify gravitationally unstable regions where star or planet formation might be triggered [@problem_id:3517596].", "problem": "You are tasked with modeling axisymmetric gravitational stability in a thin, rotating protostellar accretion disk using a local, Newtonian framework and an ideal gas equation of state. Starting only from fundamental principles, derive the expressions needed to compute the Toomre stability parameter $Q(R)$ and the most unstable wavelength $\\lambda_\\ast(R)$ in terms of the surface density $\\Sigma(R)$ and the temperature $T(R)$, for a Keplerian disk around a point-mass star of mass $M_\\star$. Use these results to implement a computational algorithm that, for given parameterized profiles $\\Sigma(R)$ and $T(R)$, evaluates $Q(R)$ over a radial interval, identifies the radial regions where $Q(R)  1$, and estimates the corresponding scale of the most unstable mode.\n\nThe base on which your derivation must rely is restricted to the following:\n- Newtonian gravity for a point mass: the angular frequency satisfies $\\Omega(R) = \\sqrt{G M_\\star / R^3}$, where $G$ is the gravitational constant and $R$ is the cylindrical radius.\n- Ideal gas thermodynamics: the isothermal sound speed is defined by $c_s(R) = \\sqrt{k_{\\mathrm{B}} T(R) / \\mu m_{\\mathrm{p}}}$, where $k_{\\mathrm{B}}$ is the Boltzmann constant, $m_{\\mathrm{p}}$ is the proton mass, and $\\mu$ is the mean molecular weight.\n- Thin disk, axisymmetric perturbations using the local (shearing sheet) approximation.\n\nThe disk model is specified by power-law profiles\n$$\n\\Sigma(R) = \\Sigma_0 \\left(\\frac{R}{R_0}\\right)^{-p}, \\qquad T(R) = T_0 \\left(\\frac{R}{R_0}\\right)^{-q},\n$$\nwhere $\\Sigma_0$, $T_0$, $p$, $q$, and $R_0$ are constants.\n\nYour program must implement the following:\n- Construct a radial grid of $N$ points linearly spaced between $R_{\\mathrm{in}}$ and $R_{\\mathrm{out}}$.\n- Compute $Q(R)$ across the grid from the derived formulae.\n- Identify radial locations where $Q(R)  1$ and determine how many contiguous unstable regions (segments) exist.\n- Estimate the most unstable wavelength $\\lambda_\\ast(R)$ at each radius from the derived dispersion relation and compute the mean value over all unstable grid points. If there are no unstable points, report a mean $\\lambda_\\ast$ of $0.0$.\n\nAll internal computations must be performed in the International System of Units (SI). Use the following unit conversions when constructing the model:\n- $1\\,\\mathrm{g\\,cm^{-2}} = 10\\,\\mathrm{kg\\,m^{-2}}$,\n- $1\\,\\mathrm{AU} = 1.495978707\\times 10^{11}\\,\\mathrm{m}$,\n- $M_\\odot = 1.98847\\times 10^{30}\\,\\mathrm{kg}$.\n\nReport the mean most unstable wavelength in astronomical units (AU). The Toomre parameter $Q$ is dimensionless, and the fraction of the domain that is unstable must be expressed as a decimal.\n\nTest suite:\nFor each case below, adopt $R_0 = 1\\,\\mathrm{AU}$, $\\mu = 2.34$, and $N = 1024$.\n- Case $1$: $M_\\star = 1.0\\,M_\\odot$, $\\Sigma_0 = 3000\\,\\mathrm{g\\,cm^{-2}}$, $T_0 = 200\\,\\mathrm{K}$, $p = 1.0$, $q = 0.5$, $R_{\\mathrm{in}} = 10\\,\\mathrm{AU}$, $R_{\\mathrm{out}} = 200\\,\\mathrm{AU}$.\n- Case $2$: $M_\\star = 0.5\\,M_\\odot$, $\\Sigma_0 = 1500\\,\\mathrm{g\\,cm^{-2}}$, $T_0 = 150\\,\\mathrm{K}$, $p = 0.5$, $q = 0.5$, $R_{\\mathrm{in}} = 5\\,\\mathrm{AU}$, $R_{\\mathrm{out}} = 300\\,\\mathrm{AU}$.\n- Case $3$: $M_\\star = 1.0\\,M_\\odot$, $\\Sigma_0 = 500\\,\\mathrm{g\\,cm^{-2}}$, $T_0 = 800\\,\\mathrm{K}$, $p = 1.5$, $q = 0.5$, $R_{\\mathrm{in}} = 30\\,\\mathrm{AU}$, $R_{\\mathrm{out}} = 300\\,\\mathrm{AU}$.\n\nFinal output format:\nYour program should produce a single line of output containing a list of results for all cases. For each case, output a list with four entries: the minimum $Q$ over the grid, the integer number of contiguous unstable regions, the decimal fraction of grid points that are unstable, and the mean most unstable wavelength in astronomical units (AU) over unstable points (or $0.0$ if none). The final line must be a comma-separated list of these per-case lists enclosed in square brackets, for example, $[[q_{\\min},n_{\\mathrm{seg}},f_{\\mathrm{unstable}},\\overline{\\lambda_\\ast_{\\mathrm{AU}}}],\\dots]$.", "solution": "The user-provided problem is assessed to be valid. It is a scientifically grounded, well-posed, and objective problem in the field of computational astrophysics. It is based on established fundamental principles of fluid dynamics and gravity, provides a complete and consistent set of data and definitions, and asks for a verifiable, quantitative result. The task is to derive key stability metrics for an accretion disk and implement a numerical algorithm to evaluate them for specific disk models.\n\n### Part 1: Derivation of Stability Criteria\n\nThe stability of a thin, differentially rotating, gaseous disk to local axisymmetric perturbations is governed by a dispersion relation. We begin from this relation and derive the expressions for the Toomre parameter $Q(R)$ and the most unstable wavelength $\\lambda_\\ast(R)$.\n\nThe general linear dispersion relation for axisymmetric ($m=0$) perturbations with a radial wavenumber $k$ in a thin gas disk is:\n$$\n\\omega^2 = \\kappa^2 - 2\\pi G \\Sigma |k| + c_s^2 k^2\n$$\nHere, $\\omega$ is the perturbation frequency, $\\kappa$ is the epicyclic frequency, $G$ is the gravitational constant, $\\Sigma$ is the unperturbed gas surface density, and $c_s$ is the sound speed. Gravitational instability occurs for modes where $\\omega^2  0$, as perturbations then grow exponentially in time.\n\nThe problem specifies the context for each term in the dispersion relation:\n1.  **Sound Speed $c_s(R)$**: The disk follows an ideal gas equation of state. The isothermal sound speed is given as:\n    $$\n    c_s(R) = \\sqrt{\\frac{k_{\\mathrm{B}} T(R)}{\\mu m_{\\mathrm{p}}}}\n    $$\n    where $k_{\\mathrm{B}}$ is the Boltzmann constant, $T(R)$ is the temperature profile, $\\mu$ is the mean molecular weight, and $m_{\\mathrm{p}}$ is the proton mass.\n\n2.  **Epicyclic Frequency $\\kappa(R)$**: The epicyclic frequency measures the restoring force for small radial excursions of a gas parcel from its circular orbit. It is defined in terms of the angular frequency $\\Omega(R)$ as:\n    $$\n    \\kappa^2(R) = R \\frac{d\\Omega^2}{dR} + 4\\Omega^2(R)\n    $$\n    The problem specifies a Keplerian disk around a central star of mass $M_\\star$, for which the angular frequency is given by Newtonian gravity:\n    $$\n    \\Omega(R) = \\sqrt{\\frac{G M_\\star}{R^3}}\n    $$\n    Squaring this gives $\\Omega^2(R) = G M_\\star R^{-3}$. Differentiating with respect to $R$:\n    $$\n    \\frac{d\\Omega^2}{dR} = -3 G M_\\star R^{-4} = -\\frac{3}{R} \\left( G M_\\star R^{-3} \\right) = -\\frac{3\\Omega^2(R)}{R}\n    $$\n    Substituting this back into the expression for $\\kappa^2$:\n    $$\n    \\kappa^2(R) = R \\left( -\\frac{3\\Omega^2(R)}{R} \\right) + 4\\Omega^2(R) = -3\\Omega^2(R) + 4\\Omega^2(R) = \\Omega^2(R)\n    $$\n    Thus, for a Keplerian disk, the epicyclic frequency is equal to the angular frequency: $\\kappa(R) = \\Omega(R)$.\n\nSubstituting $\\kappa = \\Omega$ and taking the wavenumber $k$ to be positive, the dispersion relation becomes:\n$$\n\\omega^2(k) = \\Omega^2 - 2\\pi G \\Sigma k + c_s^2 k^2\n$$\nThis equation reveals the competing effects: rotation ($\\Omega^2$) and pressure ($c_s^2 k^2$) are stabilizing terms (positive contribution to $\\omega^2$), while self-gravity ($-2\\pi G \\Sigma k$) is a destabilizing term. Instability is most likely to occur for the wavenumber $k$ that minimizes $\\omega^2(k)$. To find this, we differentiate with respect to $k$ and set the result to zero:\n$$\n\\frac{d(\\omega^2)}{dk} = -2\\pi G \\Sigma + 2 c_s^2 k = 0\n$$\nSolving for the most unstable wavenumber, $k_\\ast$:\n$$\nk_\\ast = \\frac{\\pi G \\Sigma}{c_s^2}\n$$\nThe corresponding wavelength, $\\lambda_\\ast = 2\\pi/k_\\ast$, is the characteristic size of the most unstable gravitational mode:\n$$\n\\lambda_\\ast(R) = \\frac{2\\pi}{k_\\ast} = \\frac{2\\pi c_s^2(R)}{\\pi G \\Sigma(R)} = \\frac{2 c_s^2(R)}{G \\Sigma(R)}\n$$\nThis is the expression for the most unstable wavelength.\n\nNow, we evaluate the dispersion relation at this most unstable wavenumber, $k_\\ast$, to find the minimum value of $\\omega^2$:\n$$\n\\omega_{\\min}^2 = \\Omega^2 - 2\\pi G \\Sigma \\left(\\frac{\\pi G \\Sigma}{c_s^2}\\right) + c_s^2 \\left(\\frac{\\pi G \\Sigma}{c_s^2}\\right)^2\n$$\n$$\n\\omega_{\\min}^2 = \\Omega^2 - \\frac{2\\pi^2 G^2 \\Sigma^2}{c_s^2} + \\frac{\\pi^2 G^2 \\Sigma^2}{c_s^2} = \\Omega^2 - \\frac{\\pi^2 G^2 \\Sigma^2}{c_s^2}\n$$\nThe disk becomes unstable when $\\omega_{\\min}^2  0$. This condition is:\n$$\n\\Omega^2  \\frac{\\pi^2 G^2 \\Sigma^2}{c_s^2} \\implies \\Omega  \\frac{\\pi G \\Sigma}{c_s}\n$$\nRearranging this inequality defines the stability criterion. The Toomre stability parameter, $Q$, is defined as the ratio of stabilizing to destabilizing effects:\n$$\nQ(R) \\equiv \\frac{c_s(R) \\kappa(R)}{\\pi G \\Sigma(R)}\n$$\nFor our Keplerian disk, where $\\kappa = \\Omega$:\n$$\nQ(R) = \\frac{c_s(R) \\Omega(R)}{\\pi G \\Sigma(R)}\n$$\nThe disk is gravitationally stable to axisymmetric perturbations if $Q  1$ and unstable if $Q  1$.\n\n### Part 2: Computational Algorithm\n\nThe derived expressions for $Q(R)$ and $\\lambda_\\ast(R)$ are implemented computationally as follows.\n\n1.  ** Constants and Units**: All physical constants ($G, k_{\\mathrm{B}}, m_{\\mathrm{p}}$) and conversion factors ($M_\\odot \\to \\mathrm{kg}$, $\\mathrm{AU} \\to \\mathrm{m}$, $\\mathrm{g\\,cm^{-2}} \\to \\mathrm{kg\\,m^{-2}}$) are defined in SI units. Input parameters from the test cases are converted to SI units at the outset.\n\n2.  **Radial Grid**: A radial grid $R$ is constructed with $N = 1024$ points, linearly spaced from $R_{\\mathrm{in}}$ to $R_{\\mathrm{out}}$ (both in SI units).\n    $$ R = \\text{linspace}(R_{\\mathrm{in, SI}}, R_{\\mathrm{out, SI}}, N) $$\n\n3.  **Physical Profiles**: The disk properties are computed at each point on the radial grid $R$ using the specified power-law models and fundamental definitions:\n    *   Surface Density: $\\Sigma(R) = \\Sigma_{0, \\mathrm{SI}} (R / R_{0, \\mathrm{SI}})^{-p}$\n    *   Temperature: $T(R) = T_0 (R / R_{0, \\mathrm{SI}})^{-q}$\n    *   Sound Speed: $c_s(R) = \\sqrt{k_{\\mathrm{B}} T(R) / (\\mu m_{\\mathrm{p}})}$\n    *   Angular Frequency: $\\Omega(R) = \\sqrt{G M_{\\star, \\mathrm{SI}} / R^3}$\n\n4.  **Stability Analysis**: With the physical profiles computed, the primary derived quantities are calculated across the grid:\n    *   Toomre Parameter: $Q(R) = \\frac{c_s(R) \\Omega(R)}{\\pi G \\Sigma(R)}$\n    *   Most Unstable Wavelength: $\\lambda_\\ast(R) = \\frac{2 c_s(R)^2}{G \\Sigma(R)}$\n\n5.  **Output Metrics Calculation**: The final required metrics are computed from the gridded data:\n    *   **Minimum $Q$**: The minimum value of the computed $Q(R)$ array is found using `numpy.min`.\n    *   **Unstable Regions**:\n        *   A boolean array `is_unstable` is created where `is_unstable[i]` is true if $Q(R_i)  1$.\n        *   The number of contiguous unstable regions, $n_{\\mathrm{seg}}$, is found by identifying the number of transitions from a stable to an unstable state. This is done by taking the difference of the boolean array (cast to integer, `0` or `1`) padded with zeros at both ends. The number of times the difference is $1$ equals the number of regions.\n    *   **Fraction of Unstable Domain**: The fraction of unstable grid points, $f_{\\mathrm{unstable}}$, is the sum of `True` values in `is_unstable` divided by the total number of grid points, $N$.\n    *   **Mean Unstable Wavelength**:\n        *   If no grid points are unstable (i.e., `is_unstable` is all `False`), the mean wavelength is $0.0$.\n        *   Otherwise, the values of $\\lambda_\\ast(R)$ are extracted for only the unstable grid points. The mean of these values is computed. This result, in meters, is then converted to astronomical units (AU) for the final output.\n\nThis step-by-step procedure, directly translating the derived physical principles into a numerical recipe, is implemented in the provided Python code.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes Toomre stability parameters for protostellar disks.\n    \"\"\"\n    \n    # Physical constants in SI units\n    G = 6.67430e-11  # m^3 kg^-1 s^-2\n    K_B = 1.380649e-23  # J K^-1\n    M_P = 1.67262192e-27  # kg (proton mass)\n\n    # Unit conversion factors\n    AU_M = 1.495978707e11  # meters per AU\n    MSOL_KG = 1.98847e30  # kg per solar mass\n    GCM2_TO_KGM2 = 10.0  # kg m^-2 per g cm^-2\n\n    # Problem parameters\n    R0_AU = 1.0\n    MU = 2.34\n    N_GRID = 1024\n\n    test_cases = [\n        # (M_star [M_sol], Sigma0 [g cm^-2], T0 [K], p, q, R_in [AU], R_out [AU])\n        (1.0, 3000.0, 200.0, 1.0, 0.5, 10.0, 200.0),\n        (0.5, 1500.0, 150.0, 0.5, 0.5, 5.0, 300.0),\n        (1.0, 500.0, 800.0, 1.5, 0.5, 30.0, 300.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        m_star_msol, sigma0_gcm2, t0_k, p, q, r_in_au, r_out_au = case\n\n        # Convert parameters to SI units\n        m_star_si = m_star_msol * MSOL_KG\n        sigma0_si = sigma0_gcm2 * GCM2_TO_KGM2\n        r0_si = R0_AU * AU_M\n        r_in_si = r_in_au * AU_M\n        r_out_si = r_out_au * AU_M\n\n        # 1. Construct a radial grid\n        r_grid = np.linspace(r_in_si, r_out_si, N_GRID)\n\n        # 2. Compute physical profiles on the grid\n        sigma_r = sigma0_si * (r_grid / r0_si)**(-p)\n        temp_r = t0_k * (r_grid / r0_si)**(-q)\n        \n        cs_r = np.sqrt(K_B * temp_r / (MU * M_P))\n        omega_r = np.sqrt(G * m_star_si / r_grid**3)\n\n        # 3. Compute Q(R)\n        q_r = (cs_r * omega_r) / (np.pi * G * sigma_r)\n        \n        # 4. Calculate output metrics\n        \n        # a. Minimum Q\n        q_min = np.min(q_r)\n\n        # b. Unstable regions and fraction\n        is_unstable = q_r  1.0\n        num_unstable_points = np.sum(is_unstable)\n        f_unstable = num_unstable_points / N_GRID\n\n        # c. Number of contiguous unstable regions\n        padded_unstable = np.concatenate(([0], is_unstable.astype(int), [0]))\n        diff_unstable = np.diff(padded_unstable)\n        n_seg = np.sum(diff_unstable == 1)\n\n        # d. Mean most unstable wavelength\n        mean_lambda_au = 0.0\n        if num_unstable_points  0:\n            unstable_indices = np.where(is_unstable)[0]\n            cs_unstable = cs_r[unstable_indices]\n            sigma_unstable = sigma_r[unstable_indices]\n            \n            lambda_star_unstable_si = (2.0 * cs_unstable**2) / (G * sigma_unstable)\n            \n            mean_lambda_si = np.mean(lambda_star_unstable_si)\n            mean_lambda_au = mean_lambda_si / AU_M\n        \n        results.append(f\"[{q_min},{n_seg},{f_unstable},{mean_lambda_au}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3517596"}, {"introduction": "For material to accrete onto the central object, it must lose angular momentum. In the standard paradigm, this is achieved through viscous stresses that transport angular momentum outward while allowing mass to flow inward. This practice guides you through the foundational Shakura-Sunyaev $\\alpha$-disk model to derive and implement the steady-state radial structure that results from this viscous evolution. You will verify your analytical solution numerically, reinforcing the crucial link between conservation laws and the resulting physical state of the disk [@problem_id:3517540].", "problem": "Consider a steady, axisymmetric, geometrically thin accretion disk orbiting a central point mass. The disk is modeled using the Shakura–Sunyaev prescription for viscosity and is assumed to be vertically isothermal. Your task is to derive, implement, and verify the steady-state radial profiles of the surface density and radial velocity under these assumptions, starting from first principles that are appropriate for computational astrophysics.\n\nAssumptions and foundational base:\n- The disk is steady and axisymmetric, so all quantities are independent of azimuth and time.\n- The gravitational potential is Newtonian and Keplerian rotation applies. The Keplerian angular frequency is $\\Omega_{\\mathrm{K}}(R)=\\sqrt{G M / R^{3}}$, where $G$ is the gravitational constant and $M$ is the central mass.\n- Vertical hydrostatic balance with an isothermal vertical structure gives the pressure scale height $H(R)=c_{s}(R)/\\Omega_{\\mathrm{K}}(R)$, where $c_{s}(R)$ is the isothermal sound speed.\n- The Shakura–Sunyaev $\\alpha$ prescription for viscosity is used: $\\nu(R)=\\alpha\\,c_{s}(R)\\,H(R)$, where $\\alpha$ is a dimensionless constant.\n- The equation of state is locally isothermal with a prescribed radial profile $c_{s}(R)=c_{s0}\\,[R/R_{0}]^{-q}$, where $c_{s0}$ is a constant speed at reference radius $R_{0}$ and $q$ is a dimensionless exponent.\n- The inner boundary of the disk is at $R_{\\mathrm{in}}=6 G M / c^{2}$, where $c$ is the speed of light. Adopt the zero-torque boundary condition at $R_{\\mathrm{in}}$.\n- The advective mass flux and the total radial angular momentum flux are constant in steady state.\n\nStarting from conservation laws and the definitions above, derive expressions for the steady-state radial profiles:\n- the surface density $\\Sigma(R)$,\n- the radial velocity $v_{R}(R)$,\nin terms of the parameters $M$, $\\dot{M}$, $\\alpha$, $c_{s}(R)$, and $R_{\\mathrm{in}}$.\n\nThen, implement a program that:\n- Constructs a logarithmically spaced radius array $R$ from $R_{\\mathrm{min}}=(1+\\epsilon)\\,R_{\\mathrm{in}}$ to $R_{\\mathrm{out}}$, where $\\epsilon=0.01$ and the number of points is $N=256$.\n- Uses the derived expressions to compute $\\Sigma(R)$ and $v_{R}(R)$.\n- Verifies mass flux conservation by computing $F_{M}(R)=-2\\pi R \\Sigma(R) v_{R}(R)$ and comparing it to the specified $\\dot{M}$.\n- Verifies angular momentum flux conservation under the zero-torque inner boundary condition by computing\n$$\nF_{J}(R)=\\dot{M}\\,l(R)-2\\pi R^{3}\\,\\nu(R)\\,\\Sigma(R)\\,\\frac{d\\Omega_{\\mathrm{K}}}{dR},\n$$\nand comparing it to the constant $F_{J,\\mathrm{in}}=\\dot{M}\\,l(R_{\\mathrm{in}})$, where $l(R)=R^{2}\\Omega_{\\mathrm{K}}(R)$.\n\nReport, for each test case, the following two numbers:\n- the maximum relative deviation of the mass flux from the specified $\\dot{M}$ over the radial grid, defined as $\\max_{R}\\left|\\frac{F_{M}(R)}{\\dot{M}}-1\\right|$,\n- the maximum relative deviation of the angular momentum flux from $F_{J,\\mathrm{in}}$ over the radial grid, defined as $\\max_{R}\\left|\\frac{F_{J}(R)}{F_{J,\\mathrm{in}}}-1\\right|$.\n\nUse the following constants: $G=6.67430\\times 10^{-11}\\,\\mathrm{m^{3}\\,kg^{-1}\\,s^{-2}}$, $c=2.99792458\\times 10^{8}\\,\\mathrm{m\\,s^{-1}}$, and $M_{\\odot}=1.98847\\times 10^{30}\\,\\mathrm{kg}$.\n\nPhysical units:\n- Mass $M$ in $\\mathrm{kg}$,\n- Mass accretion rate $\\dot{M}$ in $\\mathrm{kg\\,s^{-1}}$,\n- Radius $R$ in $\\mathrm{m}$,\n- Sound speed $c_{s0}$ in $\\mathrm{m\\,s^{-1}}$,\n- Radial velocity $v_{R}$ in $\\mathrm{m\\,s^{-1}}$,\n- Surface density $\\Sigma$ in $\\mathrm{kg\\,m^{-2}}$.\n\nAngle units are not used. All outputs of the program must be dimensionless floats as defined below.\n\nTest suite:\nImplement your program to compute the required quantities for the following parameter sets. In each case, set $R_{0}=f_{0}\\,R_{\\mathrm{in}}$ and $R_{\\mathrm{out}}=f_{\\mathrm{out}}\\,R_{\\mathrm{in}}$, and use $N=256$ and $\\epsilon=0.01$.\n\n- Case $1$ (happy path):\n  - $M=10\\,M_{\\odot}$,\n  - $\\dot{M}=10^{17}\\,\\mathrm{kg\\,s^{-1}}$,\n  - $\\alpha=0.1$,\n  - $c_{s0}=10^{5}\\,\\mathrm{m\\,s^{-1}}$,\n  - $q=0.5$,\n  - $f_{0}=10$,\n  - $f_{\\mathrm{out}}=500$.\n\n- Case $2$ (lower viscosity, constant sound speed):\n  - $M=1\\,M_{\\odot}$,\n  - $\\dot{M}=3\\times 10^{16}\\,\\mathrm{kg\\,s^{-1}}$,\n  - $\\alpha=0.01$,\n  - $c_{s0}=5\\times 10^{4}\\,\\mathrm{m\\,s^{-1}}$,\n  - $q=0$,\n  - $f_{0}=1$,\n  - $f_{\\mathrm{out}}=300$.\n\n- Case $3$ (higher accretion rate and moderate sound speed gradient):\n  - $M=5\\,M_{\\odot}$,\n  - $\\dot{M}=5\\times 10^{18}\\,\\mathrm{kg\\,s^{-1}}$,\n  - $\\alpha=0.2$,\n  - $c_{s0}=2\\times 10^{5}\\,\\mathrm{m\\,s^{-1}}$,\n  - $q=0.25$,\n  - $f_{0}=3$,\n  - $f_{\\mathrm{out}}=1000$.\n\n- Case $4$ (edge case: small $\\alpha$ and cooler disk):\n  - $M=30\\,M_{\\odot}$,\n  - $\\dot{M}=10^{18}\\,\\mathrm{kg\\,s^{-1}}$,\n  - $\\alpha=0.005$,\n  - $c_{s0}=10^{4}\\,\\mathrm{m\\,s^{-1}}$,\n  - $q=0.75$,\n  - $f_{0}=1$,\n  - $f_{\\mathrm{out}}=200$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each element of this list corresponds to one test case and must itself be a two-element list containing the two floats described above, in that order, i.e., $\\left[\\left[\\mathrm{mass\\_rel\\_err\\_max}_{1},\\mathrm{angmom\\_rel\\_err\\_max}_{1}\\right],\\ldots,\\left[\\mathrm{mass\\_rel\\_err\\_max}_{4},\\mathrm{angmom\\_rel\\_err\\_max}_{4}\\right]\\right]$. For example: $[[a_{1},b_{1}],[a_{2},b_{2}],[a_{3},b_{3}],[a_{4},b_{4}]]$.", "solution": "The problem statement is a well-posed and scientifically grounded exercise in computational astrophysics, rooted in the standard Shakura-Sunyaev model for accretion disks. All assumptions, constants, and boundary conditions are explicitly provided and are self-consistent. The problem is valid.\n\nThe derivation of the steady-state profiles for surface density $\\Sigma(R)$ and radial velocity $v_R(R)$ proceeds from the fundamental conservation laws of mass and angular momentum.\n\n**1. Mass Conservation**\nFor a steady-state ($ \\partial/\\partial t = 0 $), axisymmetric ($ \\partial/\\partial \\phi = 0 $) disk, the vertically integrated continuity equation is:\n$$ \\frac{1}{R} \\frac{d}{dR} \\left( R \\Sigma(R) v_R(R) \\right) = 0 $$\nIntegrating this equation shows that the quantity $R \\Sigma v_R$ is constant. The mass accretion rate, $\\dot{M}$, is defined as the total mass flowing radially inward per unit time across a cylinder of radius $R$. By convention, $\\dot{M}  0$ for inflow, which implies $v_R(R)  0$.\n$$ \\dot{M} = -2\\pi R \\Sigma(R) v_R(R) $$\nThis equation is a statement of constant mass flux through the disk. It provides a relationship between $\\Sigma(R)$ and $v_R(R)$:\n$$ v_R(R) = -\\frac{\\dot{M}}{2\\pi R \\Sigma(R)} \\quad (*) $$\n\n**2. Angular Momentum Conservation**\nThe conservation of angular momentum requires the net flux of angular momentum across any radius to be constant in a steady state. This flux consists of two components: advective transport by the accreting gas and viscous transport due to shear. The problem defines the total radial angular momentum flux as:\n$$ F_J(R) = \\dot{M} l(R) - 2\\pi R^3 \\nu(R) \\Sigma(R) \\frac{d\\Omega_{\\mathrm{K}}}{dR} $$\nwhere $l(R) = R^2 \\Omega_K(R)$ is the specific angular momentum at radius $R$, and the second term represents the viscous torque. In steady state, this flux is constant. The constant is determined by the inner boundary condition. The problem specifies a zero-torque condition at the inner boundary, $R_{\\mathrm{in}}$. This implies that the viscous torque term vanishes at $R=R_{\\mathrm{in}}$. Therefore, the constant flux is equal to the purely advective flux at the inner edge:\n$$ F_J(R) = F_{J, \\mathrm{in}} = \\dot{M} l(R_{\\mathrm{in}}) $$\nEquating the two expressions for $F_J(R)$ gives the governing equation for the disk structure:\n$$ \\dot{M} l(R) - 2\\pi R^3 \\nu(R) \\Sigma(R) \\frac{d\\Omega_{\\mathrm{K}}}{dR} = \\dot{M} l(R_{\\mathrm{in}}) $$\nWe can now solve for the surface density $\\Sigma(R)$:\n$$ -2\\pi R^3 \\nu(R) \\Sigma(R) \\frac{d\\Omega_{\\mathrm{K}}}{dR} = \\dot{M} \\left( l(R_{\\mathrm{in}}) - l(R) \\right) $$\n$$ \\Sigma(R) = \\frac{\\dot{M} \\left( l(R) - l(R_{\\mathrm{in}}) \\right)}{-2\\pi R^3 \\nu(R) \\frac{d\\Omega_{\\mathrm{K}}}{dR}} $$\nTo simplify this expression, we use the Keplerian angular velocity profile $\\Omega_{\\mathrm{K}}(R) = \\sqrt{GM/R^3}$. Its derivative is:\n$$ \\frac{d\\Omega_{\\mathrm{K}}}{dR} = -\\frac{3}{2} \\sqrt{GM} R^{-5/2} = -\\frac{3}{2} \\frac{\\Omega_{\\mathrm{K}}(R)}{R} $$\nSubstituting this into the denominator of the expression for $\\Sigma(R)$:\n$$ -2\\pi R^3 \\nu(R) \\left( -\\frac{3}{2} \\frac{\\Omega_{\\mathrm{K}}(R)}{R} \\right) = 3\\pi \\nu(R) R^2 \\Omega_{\\mathrm{K}}(R) $$\nSo, the surface density is:\n$$ \\Sigma(R) = \\frac{\\dot{M} \\left( l(R) - l(R_{\\mathrm{in}}) \\right)}{3\\pi \\nu(R) R^2 \\Omega_{\\mathrm{K}}(R)} $$\nNext, we substitute the specific angular momentum, $l(R) = \\sqrt{GMR}$:\n$$ \\Sigma(R) = \\frac{\\dot{M} \\left( \\sqrt{GMR} - \\sqrt{GMR_{\\mathrm{in}}} \\right)}{3\\pi \\nu(R) R^2 \\sqrt{GM/R^3}} = \\frac{\\dot{M}\\sqrt{GM}\\left( \\sqrt{R} - \\sqrt{R_{\\mathrm{in}}} \\right)}{3\\pi \\nu(R) \\sqrt{GM}\\sqrt{R}} $$\nThis simplifies to the canonical expression for the surface density in a Shakura-Sunyaev disk with a zero-torque inner boundary condition:\n$$ \\Sigma(R) = \\frac{\\dot{M}}{3\\pi\\nu(R)} \\left[ 1 - \\sqrt{\\frac{R_{\\mathrm{in}}}{R}} \\right] \\quad (1) $$\nThe kinematic viscosity $\\nu(R)$ is given by the $\\alpha$-prescription, $\\nu(R) = \\alpha c_s(R) H(R)$. With the vertical scale height $H(R) = c_s(R)/\\Omega_K(R)$, this becomes:\n$$ \\nu(R) = \\alpha \\frac{c_s(R)^2}{\\Omega_K(R)} $$\nwhere the sound speed profile is $c_s(R) = c_{s0} (R/R_0)^{-q}$.\n\n**3. Derived Expressions for Profiles**\nWith the expression for $\\Sigma(R)$ established, we can find the radial velocity $v_R(R)$ by substituting equation $(1)$ into equation $(*)$:\n$$ v_R(R) = -\\frac{\\dot{M}}{2\\pi R \\left( \\frac{\\dot{M}}{3\\pi\\nu(R)} \\left[ 1 - \\sqrt{\\frac{R_{\\mathrm{in}}}{R}} \\right] \\right)} $$\nSimplifying this expression yields:\n$$ v_R(R) = - \\frac{3}{2} \\frac{\\nu(R)}{R} \\left( \\frac{1}{1 - \\sqrt{\\frac{R_{\\mathrm{in}}}{R}}} \\right) \\quad (2) $$\nEquations $(1)$ and $(2)$ are the final derived expressions for the steady-state surface density and radial velocity profiles.\n\n**4. Implementation and Verification**\nThe program will implement these derived analytical solutions. The verification steps required by the problem are checks of algebraic self-consistency.\n- **Mass Flux Conservation**: Substituting the derived expressions for $\\Sigma(R)$ and $v_R(R)$ into the mass flux definition $F_M(R)=-2\\pi R \\Sigma(R) v_R(R)$ yields:\n$$ F_M(R) = -2\\pi R \\left(\\frac{\\dot{M}}{3\\pi\\nu(R)} \\left[ 1 - \\sqrt{\\frac{R_{\\mathrm{in}}}{R}} \\right]\\right) \\left(- \\frac{3}{2} \\frac{\\nu(R)}{R} \\frac{1}{1 - \\sqrt{\\frac{R_{\\mathrm{in}}}{R}}}\\right) = \\dot{M} $$\nThis is an identity. The numerical calculation will test the fidelity of the floating-point implementation. The maximum relative deviation, $\\max_{R}\\left|\\frac{F_{M}(R)}{\\dot{M}}-1\\right|$, should be on the order of machine precision.\n- **Angular Momentum Flux Conservation**: The expression for $\\Sigma(R)$ was derived directly from the condition $F_J(R) = F_{J,\\mathrm{in}}$. Therefore, computing $F_J(R)$ using the derived $\\Sigma(R)$ must analytically return $F_{J,\\mathrm{in}}$.\n$$ F_J(R) = \\dot{M}l(R) - 2\\pi R^3 \\nu \\frac{d\\Omega_K}{dR} \\left( \\frac{\\dot{M}(l(R)-l(R_{in}))}{-2\\pi R^3 \\nu \\frac{d\\Omega_K}{dR}} \\right) = \\dot{M}l(R) + \\dot{M}(l(R_{in})-l(R))=\\dot{M}l(R_{in}) $$\nThis is also an identity. The numerical check, $\\max_{R}\\left|\\frac{F_{J}(R)}{F_{J,\\mathrm{in}}}-1\\right|$, will similarly test the implementation's numerical accuracy.\nThe code will compute these maximum relative deviations for each test case.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Shakura-Sunyaev disk problem for multiple test cases and\n    prints the verification results in the specified format.\n    \"\"\"\n    \n    # Physical and mathematical constants\n    G = 6.67430e-11  # Gravitational constant in m^3 kg^-1 s^-2\n    c = 2.99792458e8  # Speed of light in m s^-1\n    M_sun = 1.98847e30 # Solar mass in kg\n\n    test_cases = [\n        # Case 1: M(Msun), Mdot(kg/s), alpha, cs0(m/s), q, f0, fout\n        (10, 1e17, 0.1, 1e5, 0.5, 10, 500),\n        # Case 2\n        (1, 3e16, 0.01, 5e4, 0, 1, 300),\n        # Case 3\n        (5, 5e18, 0.2, 2e5, 0.25, 3, 1000),\n        # Case 4\n        (30, 1e18, 0.005, 1e4, 0.75, 1, 200)\n    ]\n    \n    results = []\n    for params in test_cases:\n        results.append(solve_case(params, G, c, M_sun))\n\n    # Format the final output string exactly as required, without extra spaces.\n    results_str = \",\".join([f\"[{r[0]},{r[1]}]\" for r in results])\n    print(f\"[{results_str}]\")\n\n\ndef solve_case(params, G, c, M_sun):\n    \"\"\"\n    Computes the verification metrics for a single test case.\n    \"\"\"\n    # Unpack parameters for the current test case\n    M_in_Msun, dot_M, alpha, c_s0, q, f0, fout = params\n    N = 256\n    epsilon = 0.01\n\n    # 1. Preliminary calculations\n    M = M_in_Msun * M_sun\n    # Inner boundary radius (Innermost Stable Circular Orbit for a non-rotating black hole is at 3Rs where Rs=2GM/c^2)\n    R_in = 6 * G * M / c**2\n    # Reference radius and outer radius\n    R0 = f0 * R_in\n    R_out = fout * R_in\n    # Innermost grid point, slightly outside R_in to avoid singularity\n    R_min = (1 + epsilon) * R_in\n    \n    # Construct the logarithmically spaced radial grid\n    R = np.logspace(np.log10(R_min), np.log10(R_out), N, dtype=np.float64)\n\n    # 2. Define physical quantities as functions of radius R\n    \n    # Keplerian angular velocity\n    omega_k_R = np.sqrt(G * M / R**3)\n    \n    # Isothermal sound speed\n    cs_R = c_s0 * (R / R0)**(-q)\n    \n    # Shakura-Sunyaev kinematic viscosity\n    nu_R = alpha * cs_R**2 / omega_k_R\n\n    # 3. Compute derived profiles for Sigma(R) and v_R(R)\n    \n    # Common factor in the standard solution for a zero-torque inner boundary\n    f_boundary = 1 - np.sqrt(R_in / R)\n    \n    # Surface density profile\n    Sigma_R = (dot_M / (3 * np.pi * nu_R)) * f_boundary\n    \n    # Radial velocity profile\n    v_R = - (3 / 2) * (nu_R / R) / f_boundary\n\n    # 4. Verification checks\n    \n    # 4.1. Mass Flux Conservation\n    # Analytically, F_M(R) = -2*pi*R*Sigma(R)*v_R(R) should be exactly M_dot.\n    F_M_R = -2 * np.pi * R * Sigma_R * v_R\n    mass_rel_err_max = np.max(np.abs(F_M_R / dot_M - 1))\n\n    # 4.2. Angular Momentum Flux Conservation\n    \n    # Specific angular momentum\n    l_R = np.sqrt(G * M * R)\n    \n    # Analytical derivative of Keplerian angular velocity\n    d_omega_k_dr_R = -1.5 * omega_k_R / R\n    \n    # Constant angular momentum flux at the inner boundary\n    F_J_in = dot_M * np.sqrt(G * M * R_in)\n    \n    # Angular momentum flux at each radius R, as defined in the problem\n    # F_J(R) = M_dot*l(R) - 2*pi*R^3*nu(R)*Sigma(R)*dOmega_k/dR\n    F_J_R = dot_M * l_R - 2 * np.pi * R**3 * nu_R * Sigma_R * d_omega_k_dr_R\n\n    # The maximum relative deviation from the constant value F_J_in.\n    # Note: F_J_in can be zero if M=0 or Rin=0, handle division by zero.\n    if F_J_in == 0:\n        # If F_J_in is zero, the absolute error is more appropriate.\n        # But for this problem, M > 0 and R_in > 0, so F_J_in is never zero.\n        ang_mom_rel_err_max = np.max(np.abs(F_J_R))\n    else:\n        ang_mom_rel_err_max = np.max(np.abs(F_J_R / F_J_in - 1))\n        \n    return [mass_rel_err_max, ang_mom_rel_err_max]\n\n\nif __name__ == \"__main__\":\n    solve()\n\n```", "id": "3517540"}]}