{"hands_on_practices": [{"introduction": "To effectively combat numerical locking, we must first diagnose its root cause. This practice delves into the mathematical heart of volumetric locking by analyzing the material's constitutive behavior in the nearly incompressible limit [@problem_id:3522660]. By deriving the conditioning of the plane-strain stiffness operator from first principles. You will quantify how the stiffness associated with volumetric deformation diverges from that of shear deformation, providing a clear, analytical explanation for the element's pathologically stiff response.", "problem": "Consider a unit square domain $\\Omega=[0,1]\\times[0,1]$ in plane strain, occupied by a homogeneous, isotropic, linear elastic material with Young's modulus $E$ and Poisson's ratio $\\nu$. The boundary $\\partial\\Omega$ is subjected to a uniform hydrostatic traction $\\mathbf{t}=-p\\,\\mathbf{n}$, where $p>0$ is constant and $\\mathbf{n}$ is the outward unit normal. Discretize $\\Omega$ with a single bilinear four-node quadrilateral element (Q4) with full $2\\times 2$ Gauss integration. The Four-Node Quadrilateral (Q4) element with full integration exactly reproduces constant strain fields.\n\nStarting from the fundamental constitutive law of isotropic linear elasticity in plane strain and the definition of the Lamé parameters, analyze the stiffness operator associated with the constant-strain subspace that the Q4 element reproduces exactly under uniform hydrostatic loading. Let the material stiffness matrix in Voigt form be denoted by $\\mathbf{D}$, and let the element stiffness be $\\mathbf{K}_e=\\int_{\\Omega}\\mathbf{B}^{\\top}\\mathbf{D}\\mathbf{B}\\,\\mathrm{d}\\Omega$, where $\\mathbf{B}$ is the strain-displacement matrix. Focus on the restriction of $\\mathbf{K}_e$ to the three-dimensional constant-strain subspace spanned by the uniform volumetric and deviatoric strain modes and the uniform shear mode.\n\nDerive, from first principles, the eigenstructure of the isotropic plane-strain material stiffness $\\mathbf{D}$ on this constant-strain subspace and deduce the conditioning of $\\mathbf{K}_e$ in terms of $\\nu$ by taking the ratio of its largest to its smallest positive eigenvalue. Use the relations between $E$, $\\nu$ and the Lamé parameters $\\lambda$ and $\\mu$ appropriate for plane strain. Your final answer must be a single closed-form analytic expression in $\\nu$ that captures the conditioning as $\\nu\\to 0.5$, thus quantifying the increase in apparent bulk stiffness associated with volumetric locking under hydrostatic loading. No numerical evaluation is required.", "solution": "The problem requires an analysis of the conditioning of the stiffness operator for a single four-node quadrilateral (Q4) element under plane strain conditions, as the material approaches the incompressible limit ($\\nu \\to 0.5$). The analysis is restricted to the constant-strain subspace, which the problem states is exactly reproduced by the Q4 element with full integration. This key fact implies that the element's stiffness behavior for these modes is a direct reflection of the underlying material's constitutive response. Therefore, the problem reduces to analyzing the eigenstructure of the plane-strain material stiffness matrix, $\\mathbf{D}$. The conditioning is defined as the ratio of the largest to the smallest positive eigenvalue of this operator.\n\nFirst, we establish the material stiffness matrix $\\mathbf{D}$ for a homogeneous, isotropic, linear elastic material under plane strain conditions. The general three-dimensional constitutive law (Hooke's Law) is given by:\n$$ \\boldsymbol{\\sigma} = \\lambda \\text{tr}(\\boldsymbol{\\varepsilon}) \\mathbf{I} + 2\\mu \\boldsymbol{\\varepsilon} $$\nwhere $\\boldsymbol{\\sigma}$ is the stress tensor, $\\boldsymbol{\\varepsilon}$ is the strain tensor, $\\mathbf{I}$ is the second-order identity tensor, and $\\lambda$ and $\\mu$ are the Lamé parameters. The parameter $\\mu$ is the shear modulus, also denoted by $G$.\n\nIn plane strain, the strain components normal to the plane are zero: $\\varepsilon_{zz} = \\varepsilon_{xz} = \\varepsilon_{yz} = 0$. The strain tensor trace (volumetric strain) simplifies to $\\text{tr}(\\boldsymbol{\\varepsilon}) = \\varepsilon_{xx} + \\varepsilon_{yy}$. The in-plane stress components are:\n$$ \\sigma_{xx} = \\lambda(\\varepsilon_{xx} + \\varepsilon_{yy}) + 2\\mu \\varepsilon_{xx} = (\\lambda + 2\\mu)\\varepsilon_{xx} + \\lambda\\varepsilon_{yy} $$\n$$ \\sigma_{yy} = \\lambda(\\varepsilon_{xx} + \\varepsilon_{yy}) + 2\\mu \\varepsilon_{yy} = \\lambda\\varepsilon_{xx} + (\\lambda + 2\\mu)\\varepsilon_{yy} $$\n$$ \\sigma_{xy} = 2\\mu \\varepsilon_{xy} $$\nUsing Voigt notation with engineering shear strain $\\gamma_{xy} = 2\\varepsilon_{xy}$, the stress and strain vectors are $\\boldsymbol{\\sigma} = [\\sigma_{xx}, \\sigma_{yy}, \\tau_{xy}]^\\top$ and $\\boldsymbol{\\varepsilon} = [\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}]^\\top$. The stress-strain relationship $\\boldsymbol{\\sigma} = \\mathbf{D}\\boldsymbol{\\varepsilon}$ is given by:\n$$ \\begin{pmatrix} \\sigma_{xx} \\\\ \\sigma_{yy} \\\\ \\tau_{xy} \\end{pmatrix} = \\begin{pmatrix} \\lambda + 2\\mu  \\lambda  0 \\\\ \\lambda  \\lambda + 2\\mu  0 \\\\ 0  0  \\mu \\end{pmatrix} \\begin{pmatrix} \\varepsilon_{xx} \\\\ \\varepsilon_{yy} \\\\ \\gamma_{xy} \\end{pmatrix} $$\nThe material stiffness matrix is thus:\n$$ \\mathbf{D} = \\begin{pmatrix} \\lambda + 2\\mu  \\lambda  0 \\\\ \\lambda  \\lambda + 2\\mu  0 \\\\ 0  0  \\mu \\end{pmatrix} $$\nThe Lamé parameters are related to Young's modulus $E$ and Poisson's ratio $\\nu$ by:\n$$ \\mu = \\frac{E}{2(1+\\nu)} $$\n$$ \\lambda = \\frac{\\nu E}{(1+\\nu)(1-2\\nu)} $$\nNext, we find the eigenvalues of $\\mathbf{D}$ to understand its stiffness characteristics along its principal strain directions. The matrix $\\mathbf{D}$ is block-diagonal. One eigenvalue can be read directly from the shear component:\n$$ k_1 = \\mu $$\nThe corresponding eigenvector is $[0, 0, 1]^\\top$, which represents a pure shear strain mode.\n\nThe other two eigenvalues are found from the upper-left $2 \\times 2$ block:\n$$ \\mathbf{D}_{11,22} = \\begin{pmatrix} \\lambda + 2\\mu  \\lambda \\\\ \\lambda  \\lambda + 2\\mu \\end{pmatrix} $$\nThe characteristic equation is $\\det(\\mathbf{D}_{11,22} - k\\mathbf{I}) = 0$:\n$$ (\\lambda + 2\\mu - k)^2 - \\lambda^2 = 0 $$\nSolving for $k$:\n$$ \\lambda + 2\\mu - k = \\pm \\lambda $$\nThis yields two eigenvalues:\n$$ k_2 = (\\lambda + 2\\mu) - \\lambda = 2\\mu $$\n$$ k_3 = (\\lambda + 2\\mu) + \\lambda = 2\\lambda + 2\\mu $$\nThe eigenvector corresponding to $k_2=2\\mu$ is proportional to $[1, -1, 0]^\\top$, representing a pure deviatoric (volume-preserving) strain mode. The eigenvector for $k_3=2\\lambda+2\\mu$ is proportional to $[1, 1, 0]^\\top$, representing a pure volumetric (dilatational) strain mode.\nTherefore, the complete set of eigenvalues for the plane-strain stiffness matrix $\\mathbf{D}$ is $\\{ \\mu, 2\\mu, 2\\lambda+2\\mu \\}$.\n\nThe problem states that the hydrostatic loading excites the volumetric mode. This corresponds to the eigenvalue $k_{\\text{vol}} = 2\\lambda + 2\\mu$, which governs the material's stiffness against volumetric deformation. The other eigenvalues, $k_{\\text{dev}} = 2\\mu$ and $k_{\\text{shear}} = \\mu$, relate to shear deformations.\n\nFor a physically realistic material, $E>0$ and $\\nu \\in [0, 0.5)$, which implies $\\lambda>0$ and $\\mu>0$. Thus, the eigenvalues are ordered as:\n$k_{\\text{max}} = 2\\lambda + 2\\mu$\n$k_{\\min} = \\mu$\n\nThe condition number, $\\kappa$, of the stiffness operator $\\mathbf{D}$ is the ratio of its largest to smallest positive eigenvalue:\n$$ \\kappa(\\mathbf{D}) = \\frac{k_{\\text{max}}}{k_{\\text{min}}} = \\frac{2\\lambda + 2\\mu}{\\mu} = 2\\frac{\\lambda}{\\mu} + 2 $$\nTo analyze the behavior as $\\nu \\to 0.5$, we express this ratio in terms of $\\nu$. The ratio of the Lamé parameters is:\n$$ \\frac{\\lambda}{\\mu} = \\frac{\\frac{\\nu E}{(1+\\nu)(1-2\\nu)}}{\\frac{E}{2(1+\\nu)}} = \\frac{\\nu E}{(1+\\nu)(1-2\\nu)} \\cdot \\frac{2(1+\\nu)}{E} = \\frac{2\\nu}{1-2\\nu} $$\nSubstituting this into the expression for the condition number:\n$$ \\kappa = 2\\left(\\frac{2\\nu}{1-2\\nu}\\right) + 2 = \\frac{4\\nu + 2(1-2\\nu)}{1-2\\nu} = \\frac{4\\nu + 2 - 4\\nu}{1-2\\nu} = \\frac{2}{1-2\\nu} $$\nThis expression quantifies the conditioning of the material stiffness. As Poisson's ratio $\\nu$ approaches the incompressible limit of $0.5$, the denominator $(1-2\\nu)$ approaches $0$, and the condition number $\\kappa$ diverges to infinity.\n$$ \\lim_{\\nu \\to 0.5} \\kappa = \\lim_{\\nu \\to 0.5} \\frac{2}{1-2\\nu} = \\infty $$\nThis ill-conditioning is the root cause of volumetric locking in low-order finite elements with full integration. The stiffness associated with the volumetric strain mode ($k_{\\text{vol}} \\propto \\lambda$) becomes infinitely large compared to the stiffness of the shear modes ($k_{\\text{shear}} = \\mu$, which remains finite). An element formulation that cannot kinematically accommodate the near-zero volumetric strain constraint will exhibit an artificially stiff, or \"locked\", response. The derived expression precisely captures this pathological increase in stiffness disparity.\nThe conditioning of the element stiffness matrix $\\mathbf{K}_e$ on the constant-strain subspace is directly governed by the conditioning of $\\mathbf{D}$, as the element kinematics exactly represent these constant strain fields. Therefore, the conditioning of the restricted $\\mathbf{K}_e$ also behaves as $\\frac{2}{1-2\\nu}$.", "answer": "$$\\boxed{\\frac{2}{1-2\\nu}}$$", "id": "3522660"}, {"introduction": "Having identified ill-conditioning as the source of locking, we now explore a common remedy: reduced integration. However, solutions in numerical methods often involve trade-offs. This exercise demonstrates how alleviating volumetric locking can unfortunately introduce non-physical, zero-energy deformations known as 'hourglassing'. You will be challenged to engineer a solution by designing and implementing a stabilization term that suppresses these spurious modes, a crucial skill in developing robust finite element formulations.", "problem": "Consider small-strain, quasi-static linear elasticity for a saturated clay modeled as a nearly incompressible material under plane strain, discretized by bilinear four-node quadrilateral elements in the Finite Element Method (FEM). The constitutive response is governed by Hooke’s law with Lamé parameters $\\lambda$ and $\\mu$ derived from Young’s modulus $E$ and Poisson’s ratio $\\nu$ through $\\mu = \\dfrac{E}{2(1+\\nu)}$ and $\\lambda = \\dfrac{E \\nu}{(1+\\nu)(1-2\\nu)}$, and the 3D bulk modulus is $K = \\lambda + \\dfrac{2}{3}\\mu$. As $\\nu \\to \\dfrac{1}{2}$, $K \\to \\infty$, which induces volumetric locking when using standard fully integrated low-order continuous elements. Reduced integration is a common remedy for volumetric locking, but it is known to trigger hourglassing (zero-energy spurious modes) when the rank of the element stiffness is insufficient.\n\nYou are asked to reason from first principles and design a consistent stabilization for the reduced-integration formulation by augmenting the bilinear form with a term of the form\n$$\nS_h(\\mathbf{u},\\mathbf{v}) \\equiv \\alpha(h) \\int_{\\Omega} \\nabla \\mathbf{u} : \\nabla \\mathbf{v} \\, \\mathrm{d}\\mathbf{x},\n$$\nwhere $\\mathbf{u}$ and $\\mathbf{v}$ are kinematically admissible test and trial fields, $h$ is the characteristic element size (the side length of a square element), and $\\alpha(h)$ is a nonnegative scalar stabilization parameter. Your design must satisfy all of the following requirements:\n\n- Dimensional consistency of $S_h$ with the elastic energy density, so that adding $S_h$ yields a bilinear form with correct physical units.\n- Consistency in the limit $h \\to 0$: the added stabilization must vanish at least at order $\\mathcal{O}(h^2)$ in the energy norm for smooth exact solutions, so that the method converges to the correct continuum solution without pollution.\n- Immunity to volumetric locking: the stabilization must not couple to the bulk modulus $K$ and must remain bounded as $\\nu \\to \\dfrac{1}{2}$; in particular, it must scale with the shear modulus $\\mu$ and not with $\\lambda$ or $K$.\n\nFrom the above, derive a scaling law for $\\alpha(h,\\nu)$ in terms of $h$, $E$, and $\\nu$. Assume a characteristic domain length $D$ with units of length that is used to render $\\alpha(h,\\nu)$ dimensionally consistent, and take $D = 1 \\ \\mathrm{m}$ for all numerical evaluations in this problem. For the consistency check, consider the pure shear affine displacement field on a square element $K \\subset \\mathbb{R}^2$ of side length $h$:\n$$\n\\mathbf{u}(x,y) = \\begin{bmatrix} y \\\\ 0 \\end{bmatrix},\n$$\nfor which $\\nabla \\mathbf{u}$ and the symmetric strain tensor $\\boldsymbol{\\varepsilon}(\\mathbf{u})$ are constant over $K$. Define the dimensionless ratio\n$$\n\\rho(h,\\nu) \\equiv \\frac{\\alpha(h,\\nu) \\displaystyle \\int_{K} \\nabla \\mathbf{u} : \\nabla \\mathbf{u} \\, \\mathrm{d}\\mathbf{x}}{\\mu(\\nu,E) \\displaystyle \\int_{K} \\boldsymbol{\\varepsilon}(\\mathbf{u}) : \\boldsymbol{\\varepsilon}(\\mathbf{u}) \\, \\mathrm{d}\\mathbf{x}},\n$$\nas a measure of the relative size of the stabilization energy to the reference shear energy. Your derivation should predict the $h$-scaling of $\\rho(h,\\nu)$ and its independence from $\\nu$ for the chosen pure shear mode.\n\nTasks:\n1. Using only fundamental laws and core definitions for small-strain linear elasticity and dimensional analysis, derive a suitable form of $\\alpha(h,\\nu)$ that satisfies the three requirements above. Express your final formula as a function $\\alpha(h,\\nu,E,D)$ with $D = 1 \\ \\mathrm{m}$, and identify precisely how it depends on $h$ and $\\nu$ through $\\mu$.\n2. For the pure shear field $\\mathbf{u}(x,y) = [y,0]^\\top$, derive a closed-form expression for $\\rho(h,\\nu)$ in terms of $h$, $D$, and any dimensionless constants inherent to your derived $\\alpha(h,\\nu)$.\n3. Implement a program that computes, for the test suite below, the pair $[\\alpha,\\rho]$ for each case. Report $\\alpha$ in Pascals and $\\rho$ as a dimensionless float.\n\nPhysical units and conventions:\n- Use the International System of Units (SI): $E$ in $\\mathrm{Pa}$, $h$ and $D$ in $\\mathrm{m}$, and $\\alpha$ in $\\mathrm{Pa}$.\n- Angles do not appear.\n- Express all outputs as decimal floats.\n\nTest suite (each case is a tuple $(E,\\nu,h)$):\n- Case A: $(5.0 \\times 10^{7} \\ \\mathrm{Pa}, \\ 0.499, \\ 1.0 \\ \\mathrm{m})$.\n- Case B: $(5.0 \\times 10^{7} \\ \\mathrm{Pa}, \\ 0.300, \\ 1.0 \\ \\mathrm{m})$.\n- Case C: $(5.0 \\times 10^{7} \\ \\mathrm{Pa}, \\ 0.499, \\ 0.1 \\ \\mathrm{m})$.\n- Case D: $(5.0 \\times 10^{7} \\ \\mathrm{Pa}, \\ 0.4999, \\ 0.1 \\ \\mathrm{m})$.\n- Case E: $(5.0 \\times 10^{7} \\ \\mathrm{Pa}, \\ 0.499999, \\ 0.01 \\ \\mathrm{m})$.\n\nFinal output format:\n- Your program should produce a single line of output containing a list of results, one per test case, where each result is the list $[\\alpha,\\rho]$. For example, the output must look like\n$[ [\\alpha_A,\\rho_A],[\\alpha_B,\\rho_B],[\\alpha_C,\\rho_C],[\\alpha_D,\\rho_D],[\\alpha_E,\\rho_E] ]$\nwith no extra spaces beyond those required by commas and brackets.", "solution": "The problem requires the derivation of a stabilization parameter $\\alpha(h,\\nu,E,D)$ for a reduced-integration bilinear finite element formulation in linear elasticity. The derivation must satisfy three key requirements: dimensional consistency, consistency of the numerical method, and immunity to volumetric locking. We will address each requirement systematically to determine the functional form of $\\alpha$.\n\nThe context is small-strain linear elasticity, where the elastic energy bilinear form is given by $a(\\mathbf{u}, \\mathbf{v}) = \\int_{\\Omega} \\boldsymbol{\\sigma}(\\mathbf{u}) : \\boldsymbol{\\varepsilon}(\\mathbf{v}) \\, \\mathrm{d}\\mathbf{x}$. The constitutive relation is $\\boldsymbol{\\sigma} = \\mathbf{C} : \\boldsymbol{\\varepsilon}$, where for plane strain, the stress tensor $\\boldsymbol{\\sigma}$ and strain tensor $\\boldsymbol{\\varepsilon}$ are related by the elasticity tensor $\\mathbf{C}$, whose components are functions of the Lamé parameters $\\lambda$ and $\\mu$. The total weak form of the stabilized problem is $a(\\mathbf{u}, \\mathbf{v}) + S_h(\\mathbf{u}, \\mathbf{v}) = L(\\mathbf{v})$, where $S_h(\\mathbf{u},\\mathbf{v}) = \\alpha(h) \\int_{\\Omega} \\nabla \\mathbf{u} : \\nabla \\mathbf{v} \\, \\mathrm{d}\\mathbf{x}$.\n\n**1. Derivation of the Stabilization Parameter $\\alpha(h,\\nu,E,D)$**\n\nWe analyze the three requirements imposed on $\\alpha$.\n\n**Requirement 1: Dimensional Consistency**\nThe stabilization term $S_h$ must be added to the elastic energy term $a(\\mathbf{u}, \\mathbf{v})$, so they must share the same physical units. The term $a(\\mathbf{u}, \\mathbf{v})$ represents work, or energy. In a 2D plane strain setting, this is work per unit thickness, with units of Force ($[\\mathrm{F}]$). Let's verify the units of its integrand: the stress tensor $\\boldsymbol{\\sigma}$ has units of pressure, $[\\boldsymbol{\\sigma}] = \\mathrm{F}/\\mathrm{L}^2$, and the strain tensor $\\boldsymbol{\\varepsilon}$ is dimensionless. The integral is over an area $\\Omega \\subset \\mathbb{R}^2$, so it has units of area ($[\\mathrm{L}^2]$). Therefore, the units of $a(\\mathbf{u}, \\mathbf{v})$ are $[\\int_{\\Omega} \\boldsymbol{\\sigma} : \\boldsymbol{\\varepsilon} \\, \\mathrm{d}\\mathbf{x}] = (\\mathrm{F}/\\mathrm{L}^2) \\cdot \\mathrm{L}^2 = \\mathrm{F}$.\n\nNow we analyze the stabilization term $S_h(\\mathbf{u},\\mathbf{v}) = \\alpha \\int_{\\Omega} \\nabla \\mathbf{u} : \\nabla \\mathbf{v} \\, \\mathrm{d}\\mathbf{x}$. The displacement vector $\\mathbf{u}$ has units of length ($[\\mathrm{L}]$). Its gradient, $\\nabla \\mathbf{u}$, is a tensor whose components $\\partial u_i / \\partial x_j$ are dimensionless. Consequently, the term $\\nabla \\mathbf{u} : \\nabla \\mathbf{v}$ is dimensionless. The integral over the area $\\Omega$ has units of $\\mathrm{L}^2$. Thus, the units of $S_h$ are $[S_h] = [\\alpha] \\cdot \\mathrm{L}^2$.\n\nFor dimensional consistency, we must equate the units of $a(\\mathbf{u}, \\mathbf{v})$ and $S_h(\\mathbf{u}, \\mathbf{v})$:\n$$[\\alpha] \\cdot \\mathrm{L}^2 = \\mathrm{F} \\implies [\\alpha] = \\frac{\\mathrm{F}}{\\mathrm{L}^2}$$\nThis means $\\alpha$ must have units of stress, or Pascals ($\\mathrm{Pa}$) in SI units, which is consistent with the problem statement. The available physical parameters with these units are the Young's modulus $E$ and the Lamé parameters $\\lambda$ and $\\mu$.\n\n**Requirement 3: Immunity to Volumetric Locking**\nThis requirement states that the stabilization must not couple to the bulk modulus $K = \\lambda + \\frac{2}{3}\\mu$ and must remain bounded as the Poisson's ratio $\\nu \\to 1/2$. As $\\nu \\to 1/2$, both $\\lambda$ and $K$ approach infinity, which is the source of volumetric locking. To avoid reintroducing this pathology, the stabilization parameter $\\alpha$ must not depend on $\\lambda$ or $K$. Instead, it must scale with the shear modulus $\\mu = \\frac{E}{2(1+\\nu)}$. As $\\nu \\to 1/2$, $\\mu$ remains bounded, approaching $E/3$.\n\nCombining this with the dimensional analysis, we infer that $\\alpha$ must be proportional to $\\mu$:\n$$\\alpha \\propto \\mu(\\nu, E)$$\nSince $[\\mu]$ is stress, this is dimensionally sound. Any other dependencies must come from a dimensionless combination of other parameters.\n\n**Requirement 2: Consistency**\nThe stabilization must vanish for smooth exact solutions as the element size $h \\to 0$ at a rate of at least $\\mathcal{O}(h^2)$ in the energy norm. This is a standard consistency requirement for stabilization methods, ensuring that the modification does not pollute the solution and that the method converges to the correct continuum solution. While a formal proof is complex, a common approach in designing such parameters is to make the stabilization parameter itself dependent on the mesh size. The simplest way to satisfy the condition that the added energy $S_h(\\mathbf{u},\\mathbf{u})$ scales as $\\mathcal{O}(h^2)$ compared to a reference energy (which is $\\mathcal{O}(1)$ over the whole domain) is to make $\\alpha$ itself scale with $h^2$.\n\nLet's propose a scaling law:\n$$\\alpha \\propto h^2$$\n\n**Synthesis and Final Form of $\\alpha$**\nCombining all three requirements, we propose the following form for $\\alpha$:\n1. Scales with $\\mu$ (locking immunity).\n2. Scales with $h^2$ (consistency).\n3. Has units of stress (dimensional consistency).\n\nTo make the expression dimensionally correct, we use the provided characteristic length $D$ to form a dimensionless ratio $h/D$. This leads to the following formulation:\n$$\\alpha(h, \\nu, E, D) = C_{stab} \\cdot \\mu(\\nu, E) \\cdot \\left(\\frac{h}{D}\\right)^2$$\nwhere $C_{stab}$ is a dimensionless constant of order one. As no further information is provided to determine $C_{stab}$, we select the simplest and most direct choice, $C_{stab}=1$.\nSubstituting $\\mu = \\frac{E}{2(1+\\nu)}$ and $D = 1 \\ \\mathrm{m}$, the final derived form is:\n$$\\alpha(h, \\nu, E) = \\frac{E}{2(1+\\nu)} \\left(\\frac{h}{1 \\ \\mathrm{m}}\\right)^2$$\n\n**2. Derivation of the Ratio $\\rho(h,\\nu)$**\n\nWe are asked to compute the dimensionless ratio $\\rho(h,\\nu)$ for the pure shear displacement field $\\mathbf{u}(x,y) = [y, 0]^\\top$ on a square element $K$ of side length $h$. The ratio is defined as:\n$$\\rho(h,\\nu) \\equiv \\frac{\\alpha(h,\\nu) \\displaystyle \\int_{K} \\nabla \\mathbf{u} : \\nabla \\mathbf{u} \\, \\mathrm{d}\\mathbf{x}}{\\mu(\\nu,E) \\displaystyle \\int_{K} \\boldsymbol{\\varepsilon}(\\mathbf{u}) : \\boldsymbol{\\varepsilon}(\\mathbf{u}) \\, \\mathrm{d}\\mathbf{x}}$$\nFirst, we compute the necessary kinematic quantities for $\\mathbf{u} = \\begin{pmatrix} y \\\\ 0 \\end{pmatrix}$:\n\nThe gradient of the displacement field is:\n$$\\nabla \\mathbf{u} = \\begin{pmatrix} \\frac{\\partial u_x}{\\partial x}  \\frac{\\partial u_x}{\\partial y} \\\\ \\frac{\\partial u_y}{\\partial x}  \\frac{\\partial u_y}{\\partial y} \\end{pmatrix} = \\begin{pmatrix} 0  1 \\\\ 0  0 \\end{pmatrix}$$\nThis tensor is constant over the element $K$. Its Frobenius inner product is:\n$$\\nabla \\mathbf{u} : \\nabla \\mathbf{u} = (0)^2 + (1)^2 + (0)^2 + (0)^2 = 1$$\nThe integral in the numerator is then:\n$$\\int_{K} \\nabla \\mathbf{u} : \\nabla \\mathbf{u} \\, \\mathrm{d}\\mathbf{x} = \\int_{K} 1 \\, \\mathrm{d}A = \\mathrm{Area}(K) = h^2$$\n\nNext, we compute the symmetric strain tensor $\\boldsymbol{\\varepsilon}(\\mathbf{u}) = \\frac{1}{2}(\\nabla \\mathbf{u} + (\\nabla \\mathbf{u})^\\top)$:\n$$\\boldsymbol{\\varepsilon}(\\mathbf{u}) = \\frac{1}{2}\\left( \\begin{pmatrix} 0  1 \\\\ 0  0 \\end{pmatrix} + \\begin{pmatrix} 0  0 \\\\ 1  0 \\end{pmatrix} \\right) = \\begin{pmatrix} 0  1/2 \\\\ 1/2  0 \\end{pmatrix}$$\nThis is also constant over $K$. Its Frobenius inner product is:\n$$\\boldsymbol{\\varepsilon}(\\mathbf{u}) : \\boldsymbol{\\varepsilon}(\\mathbf{u}) = (0)^2 + (1/2)^2 + (1/2)^2 + (0)^2 = \\frac{1}{4} + \\frac{1}{4} = \\frac{1}{2}$$\nThe integral in the denominator is:\n$$\\int_{K} \\boldsymbol{\\varepsilon}(\\mathbf{u}) : \\boldsymbol{\\varepsilon}(\\mathbf{u}) \\, \\mathrm{d}\\mathbf{x} = \\int_{K} \\frac{1}{2} \\, \\mathrm{d}A = \\frac{1}{2} \\mathrm{Area}(K) = \\frac{h^2}{2}$$\n\nFinally, we substitute these results and the derived expression for $\\alpha$ into the definition of $\\rho$:\n$$\\rho(h,\\nu) = \\frac{\\left( \\mu(\\nu,E) \\left(\\frac{h}{D}\\right)^2 \\right) \\cdot (h^2)}{\\mu(\\nu,E) \\cdot (h^2/2)}$$\nThe shear modulus $\\mu(\\nu,E)$ and the term $h^2$ from the integrals cancel out, leaving:\n$$\\rho(h) = \\frac{(h/D)^2}{1/2} = 2 \\left(\\frac{h}{D}\\right)^2$$\nWith the given characteristic length $D=1 \\ \\mathrm{m}$, the final expression for $\\rho$ is simply:\n$$\\rho(h) = 2h^2$$\nThis result confirms the desired properties: $\\rho$ is independent of Poisson's ratio $\\nu$ (and Young's modulus $E$) for this pure shear mode, and its scaling with the element size is $\\mathcal{O}(h^2)$. These two derived formulae, for $\\alpha$ and $\\rho$, will now be implemented to compute the values for the specified test cases.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the stabilization parameter alpha and the dimensionless ratio rho\n    for a series of test cases in linear elasticity.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple (E, nu, h) where:\n    # E is Young's modulus in Pascals (Pa)\n    # nu is Poisson's ratio (dimensionless)\n    # h is the characteristic element size in meters (m)\n    test_cases = [\n        (5.0e7, 0.499, 1.0),      # Case A\n        (5.0e7, 0.300, 1.0),      # Case B\n        (5.0e7, 0.499, 0.1),      # Case C\n        (5.0e7, 0.4999, 0.1),     # Case D\n        (5.0e7, 0.499999, 0.01),  # Case E\n    ]\n\n    # Characteristic domain length D in meters, as specified.\n    D = 1.0\n\n    results = []\n    for E, nu, h in test_cases:\n        # Calculate the stabilization parameter alpha in Pascals.\n        # Derived formula: alpha = mu * (h/D)^2\n        # where mu = E / (2 * (1 + nu))\n        # Since D = 1.0, this simplifies to alpha = E * h**2 / (2 * (1 + nu))\n        alpha = E * h**2 / (2.0 * (1.0 + nu))\n        \n        # Calculate the dimensionless ratio rho.\n        # Derived formula: rho = 2 * (h/D)^2\n        # Since D = 1.0, this simplifies to rho = 2 * h**2\n        rho = 2.0 * h**2\n\n        results.append([alpha, rho])\n\n    # Format the final output string according to the problem specification.\n    # Example: [[alpha_A,rho_A],[alpha_B,rho_B],...]\n    # No extra spaces are used within the lists or between list elements.\n    result_str = \",\".join([f\"[{a},{r}]\" for a, r in results])\n    print(f\"[{result_str}]\")\n\nsolve()\n\n```", "id": "3522682"}, {"introduction": "Theory provides the foundation, but practical computational geomechanics requires robust tools for verification. This final practice moves from analytical derivations to computational diagnostics, guiding you to build a numerical 'undrained patch test' [@problem_id:3522635]. By implementing a test based on the Ladyzhenskaya-Babuška-Brezzi (LBB) stability condition, you will be able to probe for and identify spurious pressure modes that cause locking, empowering you to validate the stability and reliability of various mixed element technologies for simulating undrained conditions.", "problem": "Design a three-dimensional undrained patch test that detects element locking phenomena associated with volumetric incompressibility in computational geomechanics. Start from the mixed small-strain incompressible elasticity formulation, which is the undrained limit of linear poroelasticity where the pore water pressure acts as a Lagrange multiplier enforcing zero volumetric strain. The fundamental base is the principle of virtual work and the definition of deviatoric and volumetric strain. In the undrained regime, the kinematic constraint is $\\Delta \\varepsilon_v = 0$, and the pore water pressure $p_{\\mathrm{w}}$ enforces this constraint. Consider the weak form: find displacement $\\boldsymbol{u}$ and pore water pressure $p_{\\mathrm{w}}$ such that, for all kinematically admissible virtual displacements $\\boldsymbol{v}$ and virtual pressures $q$, \n$$\n\\int_{\\Omega} 2\\mu\\,\\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{u}) : \\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{v}) \\, \\mathrm{d}\\Omega\n\\;+\\;\n\\int_{\\Omega} p_{\\mathrm{w}}\\,\\nabla\\cdot \\boldsymbol{v}\\, \\mathrm{d}\\Omega\n\\;+\\;\n\\int_{\\Omega} q\\,\\nabla\\cdot \\boldsymbol{u}\\, \\mathrm{d}\\Omega\n\\;=\\; 0,\n$$\nwith $\\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{u}) = \\boldsymbol{\\varepsilon}(\\boldsymbol{u}) - \\tfrac{1}{3}\\operatorname{tr}(\\boldsymbol{\\varepsilon}(\\boldsymbol{u}))\\mathbf{I}$ and $\\boldsymbol{\\varepsilon}(\\boldsymbol{u}) = \\tfrac{1}{2}(\\nabla \\boldsymbol{u} + \\nabla \\boldsymbol{u}^{\\mathsf{T}})$. The shear modulus is $\\mu>0$. The undrained constraint is enforced by $p_{\\mathrm{w}}$; there is no separate volumetric penalty in the deviatoric stiffness term.\n\nTo expose discrete volumetric locking and spurious pressure modes, your task is to develop a computable, finite element (FE) patch test on a simple mesh of the unit cube $\\Omega = [0,1]^3$ partitioned into a regular grid of $2\\times 2\\times 2$ trilinear hexahedra. Use the following discrete mixed formulation: let $V_h$ be the conforming trilinear displacement space ($Q_1$) with three components, and let $Q_h$ be one of the following pressure spaces:\n- $Q_h = P_0$ (piecewise constant per element), denoted `Q1-P0`.\n- $Q_h = Q_1$ (continuous trilinear per node), denoted `Q1-Q1`.\n\nDefine the discrete matrices:\n- The deviatoric stiffness $\\mathbf{K} \\in \\mathbb{R}^{n_u \\times n_u}$ with entries\n$$\nK_{ij} \\;=\\; \\int_{\\Omega} 2\\mu\\,\\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{\\phi}_j) : \\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{\\phi}_i) \\,\\mathrm{d}\\Omega,\n$$\nwhere $\\boldsymbol{\\phi}_j$ is the $j$-th vector-valued displacement basis function in $V_h$.\n- The discrete divergence coupling $\\mathbf{G} \\in \\mathbb{R}^{n_p \\times n_u}$ with entries\n$$\nG_{\\alpha j} \\;=\\; \\int_{\\Omega} \\psi_\\alpha \\,\\nabla\\cdot \\boldsymbol{\\phi}_j \\,\\mathrm{d}\\Omega,\n$$\nwhere $\\psi_\\alpha$ is the $\\alpha$-th scalar pressure basis function in $Q_h$.\n\nIn the undrained mixed saddle-point system, the Schur complement on the pressure space is $\\mathbf{S} = \\mathbf{G} \\mathbf{K}^{-1} \\mathbf{G}^{\\mathsf{T}}$. The discrete Ladyzhenskaya–Babuška–Brezzi (LBB) inf-sup stability for incompressibility requires that $\\mathbf{S}$ be positive semidefinite with a one-dimensional nullspace spanned by the constant pressure field. Any additional near-zero eigenvalues correspond to spurious pressure modes that manifest as volumetric locking or pressure checkerboarding under $p_{\\mathrm{w}}$ constraints.\n\nYour program must:\n1. Assemble $\\mathbf{K}$ using only the deviatoric part of the strain energy (no volumetric bulk penalty in $\\mathbf{K}$), with $Q_1$ hexahedral elements and exact $2{\\times}2{\\times}2$ Gauss integration.\n2. Assemble $\\mathbf{G}$ for both `Q1-P0` and `Q1-Q1` pairs using the same quadrature. \n3. Regularize $\\mathbf{K}$ minimally to compute $\\mathbf{K}^{-1}$ numerically (e.g., add a tiny multiple of the identity) while ensuring the deviatoric nature is preserved in the limit.\n4. Compute the symmetric Schur complement $\\mathbf{S} = \\mathbf{G} \\mathbf{K}^{-1} \\mathbf{G}^{\\mathsf{T}}$ and its eigenvalues.\n5. Declare “pass” if and only if $\\mathbf{S}$ has exactly one near-zero eigenvalue (the constant pressure mode) and all others are strictly positive relative to the spectral radius; otherwise “fail.”\n\nTo test mesh sensitivity representative of practical geomechanics meshes, also include a smooth interior distortion of the coordinates that preserves the boundary but warps the interior nodes. Use the smooth bubble distortion\n$$\n\\mathbf{x}' \\;=\\; \\mathbf{x} \\;+\\; s\\,\\beta(\\mathbf{x})\\,\\mathbf{1}, \n\\quad\n\\beta(\\mathbf{x}) \\;=\\; x(1{-}x)\\,y(1{-}y)\\,z(1{-}z),\n$$\nwhere $s$ is a dimensionless amplitude and $\\mathbf{1}$ is the vector with all components equal to $1$. This distortion leaves the boundary fixed and perturbs only interior nodes.\n\nTest Suite and Output:\n- Use three test cases:\n  1. `Q1-P0` on the regular mesh ($s=0$).\n  2. `Q1-Q1` on the regular mesh ($s=0$).\n  3. `Q1-P0` on the distorted mesh with $s=0.3$.\n- For each case, compute the number of near-zero eigenvalues of $\\mathbf{S}$. Define “near-zero” as eigenvalues less than $\\tau = \\max(10^{-8}\\lambda_{\\max}, 10^{-12})$, where $\\lambda_{\\max}$ is the largest eigenvalue of $\\mathbf{S}$.\n- Report a boolean for each case: $\\mathrm{True}$ if exactly one near-zero eigenvalue is found, $\\mathrm{False}$ otherwise.\n\nFinal Output Format:\n- Your program should produce a single line of output containing the results as a comma-separated list of booleans enclosed in square brackets (e.g., “[True,False,True]”). No additional text should be printed.\n\nAll quantities are non-dimensional; no physical units are required. Angles are not involved. Percentages are not involved. The required output types are booleans. The computation must be self-contained and reproducible with the specified quadrature and element definitions.", "solution": "The user wants to design a numerical patch test to detect volumetric locking in 3D finite element analysis. This is a standard procedure in computational mechanics for validating mixed finite element formulations. The problem is scientifically sound, well-posed, and all necessary details for implementation are provided.\n\n### Principle-Based Design\n\nThe patch test is based on the mixed formulation of incompressible elasticity and the Ladyzhenskaya–Babuška–Brezzi (LBB) stability condition.\n\n#### 1. Mixed Formulation for Incompressibility\nThe governing equations are derived from the principle of virtual work for a nearly incompressible material, taken to the limit of perfect incompressibility. In this limit, the material cannot undergo volumetric strain ($\\varepsilon_v = \\nabla \\cdot \\boldsymbol{u} = 0$), and the pressure field ($p$) acts as a Lagrange multiplier to enforce this kinematic constraint. The weak form of the equilibrium equations is a saddle-point problem: find the displacement $\\boldsymbol{u}$ and pressure $p$ that satisfy the given variational equation for all kinematically admissible virtual fields.\n\nThe problem statement provides the weak form specific to the deviatoric part of the strain energy, which is appropriate for the incompressible limit:\n$$\n\\int_{\\Omega} 2\\mu\\,\\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{u}) : \\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{v}) \\, \\mathrm{d}\\Omega\n\\;+\\;\n\\int_{\\Omega} p\\,\\nabla\\cdot \\boldsymbol{v}\\, \\mathrm{d}\\Omega\n\\;+\\;\n\\int_{\\Omega} q\\,\\nabla\\cdot \\boldsymbol{u}\\, \\mathrm{d}\\Omega\n\\;=\\; 0\n$$\nwhere $\\boldsymbol{v}$ is the virtual displacement and $q$ is the virtual pressure.\n\n#### 2. Finite Element Discretization\nWe discretize the continuous fields $\\boldsymbol{u}$ and $p$ using finite element basis functions. The displacement field $\\boldsymbol{u}$ is approximated using trilinear ($Q_1$) vector basis functions ($\\boldsymbol{\\phi}_i$), and the pressure field $p$ is approximated using either piecewise constant ($P_0$) or continuous trilinear ($Q_1$) scalar basis functions ($\\psi_\\alpha$). This leads to a linear system of equations:\n$$\n\\begin{pmatrix} \\mathbf{K}  \\mathbf{G}^{\\mathsf{T}} \\\\ \\mathbf{G}  \\mathbf{0} \\end{pmatrix}\n\\begin{pmatrix} \\mathbf{d} \\\\ \\mathbf{p} \\end{pmatrix}\n=\n\\begin{pmatrix} \\mathbf{f} \\\\ \\mathbf{0} \\end{pmatrix}\n$$\nwhere $\\mathbf{d}$ and $\\mathbf{p}$ are vectors of unknown displacement and pressure degrees of freedom (DOFs). The matrices are:\n- $\\mathbf{K}$: The deviatoric stiffness matrix, $K_{ij} = \\int_{\\Omega} 2\\mu\\,\\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{\\phi}_j) : \\boldsymbol{\\varepsilon}^{\\mathrm{dev}}(\\boldsymbol{\\phi}_i) \\,\\mathrm{d}\\Omega$. This matrix is derived strictly from the deviatoric strain energy and is singular due to unconstrained rigid body motions.\n- $\\mathbf{G}$: The discrete divergence (or coupling) matrix, $G_{\\alpha j} = \\int_{\\Omega} \\psi_\\alpha \\,\\nabla\\cdot \\boldsymbol{\\phi}_j \\,\\mathrm{d}\\Omega$.\n\n#### 3. LBB Stability and the Schur Complement\nThe stability and well-posedness of the discrete system depend on the choice of finite element spaces for displacement and pressure, encapsulated by the LBB (or inf-sup) condition. An unstable element pair can lead to numerical artifacts like volumetric locking (an overly stiff response) or spurious pressure oscillations (checkerboarding).\n\nA standard method to analyze LBB stability is to examine the spectrum of the pressure-space Schur complement matrix, $\\mathbf{S} = \\mathbf{G} \\mathbf{K}^{-1} \\mathbf{G}^{\\mathsf{T}}$.\n- The matrix $\\mathbf{K}$ on its own is singular because the problem formulation does not include boundary conditions to prevent rigid body motions. To compute its inverse for the Schur complement, $\\mathbf{K}$ must be regularized. A common technique is to add a small diagonal perturbation, $\\mathbf{K}_{\\text{reg}} = \\mathbf{K} + \\alpha \\mathbf{I}$, which physically corresponds to weakly grounding the body, thereby removing the nullity due to rigid body modes.\n- For a stable element, the Schur complement matrix $\\mathbf{S}$ should be positive semidefinite and have a nullspace of dimension one. This single zero eigenvalue corresponds to the physically meaningful constant pressure mode, which does no work.\n- Any additional zero or near-zero eigenvalues indicate the presence of spurious, non-physical pressure modes. These modes are artifacts of the discretization and are the cause of locking and instability.\n\n#### 4. Algorithmic Implementation of the Patch Test\nThe patch test is implemented as follows:\n1.  **Mesh Generation**: A $2 \\times 2 \\times 2$ grid of trilinear hexahedral elements is defined over the unit cube $\\Omega = [0,1]^3$. To test robustness, a coordinate distortion is applied for one test case, which perturbs interior nodes while keeping the boundary fixed.\n2.  **Matrix Assembly**: The matrices $\\mathbf{K}$ and $\\mathbf{G}$ are assembled element by element using $2 \\times 2 \\times 2$ Gauss quadrature.\n    - For element stiffness $\\mathbf{K}^e$, the integrand is computed using the strain-displacement matrix $\\mathbf{B}$ and the deviatoric constitutive matrix $\\mathbf{D}_{\\text{dev}}$. $k^e = \\int_{V^e} \\mathbf{B}^{\\mathsf{T}} \\mathbf{D}_{\\text{dev}} \\mathbf{B} \\, \\mathrm{d}V$.\n    - For the coupling matrix $\\mathbf{G}^e$, the integrand is $\\psi_\\alpha (\\nabla \\cdot \\boldsymbol{\\phi}_j)$.\n3.  **Schur Complement and Eigen-analysis**: The global matrix $\\mathbf{K}$ is regularized. The Schur complement $\\mathbf{S} = \\mathbf{G} \\mathbf{K}_{\\text{reg}}^{-1} \\mathbf{G}^{\\mathsf{T}}$ is formed. Its eigenvalues are then computed.\n4.  **Verdict**: The number of eigenvalues that are \"near-zero\" (relative to the largest eigenvalue and an absolute tolerance) is counted. If this count is exactly one, the element passes the patch test; otherwise, it fails.\n\nThis procedure is performed for the three specified cases: stable (`Q1-P0`) and unstable (`Q1-Q1`) elements on a regular mesh, and the stable element on a distorted mesh. The expected results are `pass`, `fail`, `pass`, respectively, demonstrating the method's ability to detect instability and confirm the robustness of the stable formulation.", "answer": "```python\n# The final runnable code for the volumetric locking patch test.\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef get_q1_hex_shape_functions_and_derivs(xi, eta, zeta):\n    \"\"\"\n    Computes Q1 (trilinear) shape functions and their derivatives in the reference element.\n    The reference element is the cube [-1, 1]^3.\n\n    Args:\n        xi, eta, zeta (float): Coordinates of a point within the reference element.\n\n    Returns:\n        tuple[np.ndarray, np.ndarray]:\n            - N: An array of 8 shape function values.\n            - dN_dxi: A (8, 3) array of shape function derivatives w.r.t. (xi, eta, zeta).\n    \"\"\"\n    N = np.zeros(8)\n    dN_dxi = np.zeros((8, 3))\n\n    # Nodal coordinates in the reference element [-1, 1]^3\n    # Ordered CCW from bottom-left-front for bottom face, then top face.\n    xi_coords = np.array([-1, 1, 1, -1, -1, 1, 1, -1])\n    eta_coords = np.array([-1, -1, 1, 1, -1, -1, 1, 1])\n    zeta_coords = np.array([-1, -1, -1, -1, 1, 1, 1, 1])\n\n    for i in range(8):\n        xi_i, eta_i, zeta_i = xi_coords[i], eta_coords[i], zeta_coords[i]\n        \n        term_xi = (1 + xi_i * xi)\n        term_eta = (1 + eta_i * eta)\n        term_zeta = (1 + zeta_i * zeta)\n        \n        N[i] = 0.125 * term_xi * term_eta * term_zeta\n        \n        dN_dxi[i, 0] = 0.125 * xi_i * term_eta * term_zeta\n        dN_dxi[i, 1] = 0.125 * term_xi * eta_i * term_zeta\n        dN_dxi[i, 2] = 0.125 * term_xi * term_eta * zeta_i\n\n    return N, dN_dxi\n\ndef run_patch_test(pressure_space, distortion_s):\n    \"\"\"\n    Performs the 3D undrained patch test for a given element formulation.\n    \"\"\"\n    mu = 1.0  # Shear modulus, can be 1.0 without loss of generality\n\n    # 1. Mesh Generation: 2x2x2 grid on the unit cube [0,1]^3\n    nx, ny, nz = 3, 3, 3  # Number of nodes in each direction\n    num_nodes = nx * ny * nz\n    elem_nx, elem_ny, elem_nz = nx - 1, ny - 1, nz - 1\n    num_elements = elem_nx * elem_ny * elem_nz\n    \n    # Generate node coordinates\n    node_coords = np.mgrid[0:1:nx*1j, 0:1:ny*1j, 0:1:nz*1j].reshape(3, -1).T\n    \n    # Apply smooth interior distortion if specified\n    if distortion_s > 0:\n        s = distortion_s\n        x, y, z = node_coords[:, 0], node_coords[:, 1], node_coords[:, 2]\n        beta = x * (1 - x) * y * (1 - y) * z * (1 - z)\n        node_coords += s * beta[:, np.newaxis] * np.array([1.0, 1.0, 1.0])\n\n    # Define element connectivity\n    elements = []\n    for k in range(elem_nz):\n        for j in range(elem_ny):\n            for i in range(elem_nx):\n                n0 = k * (nx * ny) + j * nx + i\n                elements.append([\n                    n0, n0 + 1, n0 + 1 + nx, n0 + nx,\n                    n0 + nx * ny, n0 + nx * ny + 1, n0 + nx * ny + 1 + nx, n0 + nx * ny + nx\n                ])\n    elements = np.array(elements)\n\n    # 2. Quadrature: 2x2x2 Gaussian quadrature for hexahedra\n    gp_loc, gp_w = np.polynomial.legendre.leggauss(2)\n    \n    # 3. Matrix Assembly\n    num_disp_dofs = num_nodes * 3\n    if pressure_space == 'P0':\n        num_pressure_dofs = num_elements\n    else:  # 'Q1'\n        num_pressure_dofs = num_nodes\n\n    K = np.zeros((num_disp_dofs, num_disp_dofs))\n    G = np.zeros((num_pressure_dofs, num_disp_dofs))\n\n    # Deviatoric constitutive matrix in Voigt notation for engineering strain\n    D_dev = 2 * mu * np.array([\n        [2./3., -1./3., -1./3., 0, 0, 0],\n        [-1./3., 2./3., -1./3., 0, 0, 0],\n        [-1./3., -1./3., 2./3., 0, 0, 0],\n        [0, 0, 0, 0.5, 0, 0],\n        [0, 0, 0, 0, 0.5, 0],\n        [0, 0, 0, 0, 0, 0.5]\n    ])\n\n    for elem_idx, el_nodes in enumerate(elements):\n        coords_el = node_coords[el_nodes]\n        K_el = np.zeros((24, 24))\n        \n        G_el_size = (1, 24) if pressure_space == 'P0' else (8, 24)\n        G_el = np.zeros(G_el_size)\n\n        for z_loc, z_w in zip(gp_loc, gp_w):\n            for y_loc, y_w in zip(gp_loc, gp_w):\n                for x_loc, x_w in zip(gp_loc, gp_w):\n                    w = x_w * y_w * z_w\n                    \n                    N, dN_dxi = get_q1_hex_shape_functions_and_derivs(x_loc, y_loc, z_loc)\n                    J = dN_dxi.T @ coords_el\n                    detJ = np.linalg.det(J)\n                    \n                    if detJ = 1e-12: continue  # Skip distorted elements with zero/negative volume\n                    J_inv = np.linalg.inv(J)\n                    dN_dX = dN_dxi @ J_inv\n\n                    # Strain-displacement matrix B(6x24) for the element\n                    B = np.zeros((6, 24))\n                    for i in range(8):\n                        dN_dx, dN_dy, dN_dz = dN_dX[i]\n                        B[0, i*3] = dN_dx\n                        B[1, i*3+1] = dN_dy\n                        B[2, i*3+2] = dN_dz\n                        B[3, i*3] = dN_dy; B[3, i*3+1] = dN_dx\n                        B[4, i*3+1] = dN_dz; B[4, i*3+2] = dN_dy\n                        B[5, i*3] = dN_dz; B[5, i*3+2] = dN_dx\n                    \n                    K_el += B.T @ D_dev @ B * detJ * w\n                    \n                    # Divergence of vector basis functions\n                    div_phi = np.zeros(24)\n                    for i in range(8):\n                        div_phi[i*3] = dN_dX[i,0]\n                        div_phi[i*3+1] = dN_dX[i,1]\n                        div_phi[i*3+2] = dN_dX[i,2]\n                        \n                    if pressure_space == 'P0':\n                        psi = 1.0  # Piecewise-constant basis function\n                        G_el[0, :] += psi * div_phi * detJ * w\n                    else:  # Q1\n                        psi = N  # Trilinear basis functions\n                        G_el += np.outer(psi, div_phi) * detJ * w\n\n        # Assemble element matrices into global matrices\n        dof_map = np.array([[3*n, 3*n+1, 3*n+2] for n in el_nodes]).flatten()\n        K[np.ix_(dof_map, dof_map)] += K_el\n\n        if pressure_space == 'P0':\n            G[elem_idx, dof_map] += G_el[0,:]\n        else:  # Q1\n            pressure_dof_map = el_nodes\n            G[np.ix_(pressure_dof_map, dof_map)] += G_el\n\n    # 4. Schur Complement Computation\n    # Regularize K to handle rigid body modes, making it invertible\n    trace_K = np.trace(K)\n    reg_alpha = 1e-10 * trace_K / num_disp_dofs if trace_K > 0 else 1e-10\n    K_reg = K + reg_alpha * np.identity(num_disp_dofs)\n    \n    try:\n        K_inv = np.linalg.inv(K_reg)\n    except np.linalg.LinAlgError:\n        return False  # Singular K, should not occur with regularization\n\n    S = G @ K_inv @ G.T\n    \n    # 5. Eigenvalue Analysis of Schur Complement\n    try:\n        # Use eigh for symmetric matrices\n        eigenvalues = eigh(S, eigvals_only=True)\n    except np.linalg.LinAlgError:\n        return False\n        \n    eigenvalues = np.sort(np.abs(eigenvalues))\n    \n    if len(eigenvalues) == 0 or eigenvalues[-1]  1e-15:\n        return False  # All eigenvalues are zero, indicates a problem\n\n    lambda_max = eigenvalues[-1]\n    tau = max(1e-8 * lambda_max, 1e-12)\n    near_zero_count = np.sum(eigenvalues  tau)\n    \n    return near_zero_count == 1\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        ('P0', 0.0),    # Case 1: Q1-P0 on a regular mesh\n        ('Q1', 0.0),    # Case 2: Q1-Q1 on a regular mesh\n        ('P0', 0.3),    # Case 3: Q1-P0 on a distorted mesh\n    ]\n\n    results = []\n    for p_space, s_distort in test_cases:\n        result = run_patch_test(pressure_space=p_space, distortion_s=s_distort)\n        results.append(result)\n        \n    # Format the output as specified: a list of booleans\n    # str(True) -> \"True\", str(False) -> \"False\"\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3522635"}]}