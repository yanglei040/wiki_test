{"hands_on_practices": [{"introduction": "To truly appreciate the necessity of methods like the $\\bar{B}$ formulation, it is essential to first quantify the problem they are designed to solve: volumetric locking. This exercise guides you through an analytical derivation to reveal how locking manifests as numerical ill-conditioning in a standard Q4 element. By calculating the condition number of the element's stiffness response as a function of the material's incompressibility, you will gain a concrete understanding of why standard elements fail in the nearly incompressible limit [@problem_id:3502468].", "problem": "Consider an isotropic, homogeneous, linear-elastic, plane strain, four-node bilinear quadrilateral element (Q4) occupying a square domain of side length $h$ and unit thickness. The element is integrated with a $2 \\times 2$ Gauss rule. Let the material be characterized by bulk modulus $\\kappa$ and shear modulus $G$, with Lamé parameters defined by $\\mu = G$ and $\\lambda = \\kappa - \\frac{2}{3}G$. The element stiffness is defined by the fundamental finite element law $K_{e} = \\int_{\\Omega_{e}} B^{\\top} D B \\,\\mathrm{d}\\Omega$, where $B$ is the compatible strain-displacement matrix and $D$ is the material stiffness in Voigt notation corresponding to plane strain, acting on the strain vector $[\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}]^{\\top}$, with engineering shear strain $\\gamma_{xy} = 2 \\varepsilon_{xy}$.\n\nRigid-body motions render the full element stiffness singular. To define a meaningful condition number, restrict the action of $K_{e}$ to the compatible constant-strain subspace that a bilinear Q4 exactly reproduces, namely uniform $\\varepsilon_{xx}$, uniform $\\varepsilon_{yy}$, and uniform $\\gamma_{xy}$. In this subspace, the energetic contribution of $K_{e}$ is governed by the material stiffness $D$ alone up to a positive scaling by the element area.\n\nDerive from first principles the condition number (ratio of the largest to the smallest eigenvalue) of the element stiffness in this constant-strain subspace as a closed-form analytic expression in terms of the dimensionless ratio $\\kappa/G$. Then, briefly interpret the growth rate of this condition number with respect to $\\kappa/G$ as quantitative evidence of volumetric locking in the standard fully integrated Q4 element. Your final answer must be the exact analytic expression for the condition number as a function of $\\kappa/G$; no rounding is required, and the answer is dimensionless.", "solution": "The problem requires the derivation of the condition number of the stiffness matrix of a four-node bilinear quadrilateral element (Q4) under plane strain conditions, restricted to the subspace of constant strain. The condition number is to be expressed in terms of the ratio of the bulk modulus $\\kappa$ to the shear modulus $G$.\n\nThe problem states that for a constant strain state, the element's energetic response is governed by the material stiffness matrix $D$, scaled by the element's area. The element stiffness matrix is given by $K_{e} = \\int_{\\Omega_{e}} B^{\\top} D B \\,\\mathrm{d}\\Omega$. For a constant strain field $\\boldsymbol{\\varepsilon}$, the strain-displacement matrix $B$ becomes a constant matrix relating the nodal displacements to this strain state, and the integral simply yields the element area $A_e = h^2$ (for unit thickness). The strain energy is $U_e = \\frac{1}{2} A_e \\boldsymbol{\\varepsilon}^{\\top} D \\boldsymbol{\\varepsilon}$. The stiffness properties in this subspace are therefore directly proportional to the material matrix $D$. The condition number of the stiffness operator in this subspace is identical to the condition number of the matrix $D$, as any scalar pre-factor like the area $A_e$ cancels out in the ratio of eigenvalues. The condition number of a symmetric positive definite matrix is the ratio of its largest eigenvalue to its smallest eigenvalue, $\\text{cond}(D) = \\lambda_{\\max}(D) / \\lambda_{\\min}(D)$. Our task thus reduces to finding the eigenvalues of the plane strain material stiffness matrix $D$.\n\nFor an isotropic linear-elastic material, the constitutive relation in Voigt notation for plane strain connects the stress vector $\\boldsymbol{\\sigma} = [\\sigma_{xx}, \\sigma_{yy}, \\sigma_{xy}]^{\\top}$ to the engineering strain vector $\\boldsymbol{\\varepsilon} = [\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}]^{\\top}$ via $\\boldsymbol{\\sigma} = D \\boldsymbol{\\varepsilon}$. The matrix $D$ is given by:\n$$\nD = \\begin{pmatrix} \\lambda + 2\\mu & \\lambda & 0 \\\\ \\lambda & \\lambda + 2\\mu & 0 \\\\ 0 & 0 & \\mu \\end{pmatrix}\n$$\nThe problem provides the Lamé parameters in terms of bulk modulus $\\kappa$ and shear modulus $G$:\n$$ \\mu = G $$\n$$ \\lambda = \\kappa - \\frac{2}{3}G $$\nSubstituting these into the matrix $D$:\n$$ \\lambda + 2\\mu = \\left(\\kappa - \\frac{2}{3}G\\right) + 2G = \\kappa + \\frac{4}{3}G $$\nThus, the material stiffness matrix becomes:\n$$\nD = \\begin{pmatrix} \\kappa + \\frac{4}{3}G & \\kappa - \\frac{2}{3}G & 0 \\\\ \\kappa - \\frac{2}{3}G & \\kappa + \\frac{4}{3}G & 0 \\\\ 0 & 0 & G \\end{pmatrix}\n$$\nTo find the eigenvalues of $D$, we can exploit its block-diagonal structure. One eigenvalue is immediately evident from the $1 \\times 1$ block at the bottom right:\n$$ \\lambda_1 = G $$\nThis eigenvalue corresponds to the pure shear deformation mode associated with $\\gamma_{xy}$.\n\nThe other two eigenvalues are found from the upper-left $2 \\times 2$ submatrix, which we denote as $D_{sub}$:\n$$\nD_{sub} = \\begin{pmatrix} \\kappa + \\frac{4}{3}G & \\kappa - \\frac{2}{3}G \\\\ \\kappa - \\frac{2}{3}G & \\kappa + \\frac{4}{3}G \\end{pmatrix}\n$$\nThe eigenvalues $\\eta$ of $D_{sub}$ are the roots of the characteristic equation $\\det(D_{sub} - \\eta I) = 0$:\n$$\n\\det \\begin{pmatrix} \\kappa + \\frac{4}{3}G - \\eta & \\kappa - \\frac{2}{3}G \\\\ \\kappa - \\frac{2}{3}G & \\kappa + \\frac{4}{3}G - \\eta \\end{pmatrix} = 0\n$$\n$$\n\\left(\\kappa + \\frac{4}{3}G - \\eta\\right)^2 - \\left(\\kappa - \\frac{2}{3}G\\right)^2 = 0\n$$\nThis gives two possibilities:\n$1.$ $\\kappa + \\frac{4}{3}G - \\eta = \\kappa - \\frac{2}{3}G$\n$$ \\eta = \\left(\\kappa + \\frac{4}{3}G\\right) - \\left(\\kappa - \\frac{2}{3}G\\right) = \\frac{4}{3}G + \\frac{2}{3}G = 2G $$\nLet this be $\\lambda_2 = 2G$. This eigenvalue corresponds to a deviatoric (volume-preserving) strain state, specifically where $\\varepsilon_{xx} = -\\varepsilon_{yy}$.\n\n$2.$ $\\kappa + \\frac{4}{3}G - \\eta = -\\left(\\kappa - \\frac{2}{3}G\\right)$\n$$ \\eta = \\left(\\kappa + \\frac{4}{3}G\\right) + \\left(\\kappa - \\frac{2}{3}G\\right) = 2\\kappa + \\frac{2}{3}G $$\nLet this be $\\lambda_3 = 2\\kappa + \\frac{2}{3}G$. This eigenvalue corresponds to a pure volumetric strain state where $\\varepsilon_{xx} = \\varepsilon_{yy}$.\n\nThe three eigenvalues of the material matrix $D$ are therefore:\n$$ \\{ \\lambda_1, \\lambda_2, \\lambda_3 \\} = \\left\\{ G, 2G, 2\\kappa + \\frac{2}{3}G \\right\\} $$\nFor a physically stable material, both $\\kappa$ and $G$ are positive. Hence, all three eigenvalues are positive.\n\nThe condition number is the ratio of the largest to the smallest eigenvalue:\n$$ \\text{cond}(D) = \\frac{\\lambda_{\\max}}{\\lambda_{\\min}} $$\nThe smallest eigenvalue is clearly $\\lambda_{\\min} = G$.\nThe largest eigenvalue is $\\lambda_{\\max} = \\max\\left(2G, 2\\kappa + \\frac{2}{3}G\\right)$.\n\nThe phenomenon of volumetric locking occurs in the nearly incompressible limit, where the Poisson's ratio $\\nu \\to 0.5$. This limit corresponds to the bulk modulus becoming much larger than the shear modulus, i.e., $\\kappa/G \\to \\infty$. For any material with $\\nu > 0$, we have $\\kappa > \\frac{2}{3}G$, which implies $2\\kappa + \\frac{2}{3}G > 2\\kappa > \\frac{4}{3}G$. We must compare $2\\kappa + \\frac{2}{3}G$ with $2G$. The inequality $2\\kappa + \\frac{2}{3}G > 2G$ simplifies to $2\\kappa > \\frac{4}{3}G$, or $\\kappa/G > 2/3$. This is true for any material with a positive Poisson's ratio. Since the context is volumetric locking, we are interested in this regime. Therefore, the largest eigenvalue is:\n$$ \\lambda_{\\max} = 2\\kappa + \\frac{2}{3}G $$\nThe condition number is then:\n$$ \\text{cond}(D) = \\frac{2\\kappa + \\frac{2}{3}G}{G} = 2\\frac{\\kappa}{G} + \\frac{2}{3} $$\nThis is the required closed-form expression.\n\nFor the interpretation, we analyze the growth rate of this condition number with respect to the ratio $R = \\kappa/G$. The condition number is $\\text{cond}(D) = 2R + 2/3$. The growth rate is $\\frac{\\mathrm{d}}{\\mathrm{d}R}(\\text{cond}(D)) = 2$. This linear growth signifies that the matrix $D$ (and consequently the element stiffness in the constant-strain mode) becomes increasingly ill-conditioned as the material approaches incompressibility ($\\kappa/G \\to \\infty$). Volumetric locking is a numerical artifact where an element exhibits an excessively stiff response to volumetric deformation. The condition number quantifies this disparity: the element's stiffness in the volumetric mode (proportional to $2\\kappa + \\frac{2}{3}G$) grows unboundedly large compared to its stiffness in shear modes (proportional to $G$ and $2G$). This vast separation in eigenvalues leads to poor numerical performance and an artificial stiffening of the global system, which is the hallmark of volumetric locking. The linear growth rate provides a precise quantitative measure of how this numerical pathology worsens with material incompressibility.", "answer": "$$\n\\boxed{2\\frac{\\kappa}{G} + \\frac{2}{3}}\n$$", "id": "3502468"}, {"introduction": "Having diagnosed the issue of volumetric locking, we now turn to constructing the solution. The essence of the $\\bar{B}$ method lies in replacing the problematic pointwise volumetric strain with its average value across the element. This practice provides a foundational derivation of the constant volumetric projection vector, $\\bar{b}_v$, for a simple rectangular element, which forms the core of the modified formulation [@problem_id:3502521]. Mastering this step is crucial for understanding how the local kinematics are projected to a more stable, element-level representation.", "problem": "Consider a four-node bilinear quadrilateral element (Q4) in a small-strain, two-dimensional setting, used in the Finite Element Method (FEM) for computational geomechanics. The element occupies a rectangular physical domain $\\Omega_e$ of side lengths $L_x$ and $L_y$, aligned with the Cartesian axes, with nodes numbered counterclockwise starting at the lower-left corner. Let the isoparametric mapping from the natural coordinates $(\\xi, \\eta) \\in [-1,1] \\times [-1,1]$ to the physical coordinates $(x,y)$ be affine, given by $x = x_c + \\frac{L_x}{2}\\,\\xi$ and $y = y_c + \\frac{L_y}{2}\\,\\eta$, where $(x_c,y_c)$ is the rectangle center. The bilinear shape functions are\n$$\nN_1(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta),\\quad\nN_2(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1-\\eta),\\quad\nN_3(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1+\\eta),\\quad\nN_4(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1+\\eta).\n$$\nLet the nodal displacement vector be $d = [u_1, v_1, u_2, v_2, u_3, v_3, u_4, v_4]^{\\top}$, and the interpolated displacement field be $u(x,y) = \\sum_{i=1}^{4} N_i(\\xi,\\eta)\\,u_i$, $v(x,y) = \\sum_{i=1}^{4} N_i(\\xi,\\eta)\\,v_i$. Under small-strain kinematics, the volumetric strain is defined as $\\epsilon_v(x,y) = \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}$.\n\nThe so-called $B$-bar method (also written as $\\bar{B}$ method), which replaces the volumetric strain by its element-wise constant projection to mitigate volumetric locking in nearly incompressible materials, uses the constant volumetric projection vector $\\bar{b}_v$ such that the projected volumetric strain is $\\bar{\\epsilon}_v = \\bar{b}_v\\,d$ with\n$$\n\\bar{b}_v = \\frac{1}{\\Omega_e}\\int_{\\Omega_e} b_v(\\mathbf{x})\\,d\\Omega,\\quad \\Omega_e = L_x L_y,\n$$\nwhere $b_v(\\mathbf{x})$ is the volumetric strain-displacement operator satisfying $\\epsilon_v(\\mathbf{x}) = b_v(\\mathbf{x})\\,d$.\n\nStarting from small-strain kinematics and the above isoparametric interpolation, derive the explicit closed-form expression for the constant volumetric projection vector $\\bar{b}_v$ for this rectangular Q4 element, expressed solely in terms of $L_x$ and $L_y$ and ordered as $[u_1, v_1, u_2, v_2, u_3, v_3, u_4, v_4]$. Then, write the projected volumetric strain in the form $\\bar{\\epsilon}_v = \\bar{b}_v\\,d$. Your final answer must be a single closed-form analytical expression for $\\bar{b}_v$. No numerical approximation is required, and no units should be included in the final boxed expression.", "solution": "The objective is to compute the constant volumetric projection vector $\\bar{b}_v$, which is defined as the element-wise average of the standard volumetric strain-displacement operator $b_v(\\mathbf{x})$:\n$$\n\\bar{b}_v = \\frac{1}{\\Omega_e}\\int_{\\Omega_e} b_v(\\mathbf{x})\\,d\\Omega\n$$\nFirst, we determine the operator $b_v(\\mathbf{x})$. The volumetric strain is given by $\\epsilon_v = \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}$. By substituting the interpolated displacement fields, we get:\n$$\n\\epsilon_v = \\sum_{i=1}^{4} \\left(\\frac{\\partial N_i}{\\partial x} u_i + \\frac{\\partial N_i}{\\partial y} v_i\\right)\n$$\nThis can be written in matrix form as $\\epsilon_v = b_v d$, where $d$ is the nodal displacement vector and $b_v$ is the row vector operator:\n$$\nb_v = \\begin{bmatrix} \\frac{\\partial N_1}{\\partial x} & \\frac{\\partial N_1}{\\partial y} & \\frac{\\partial N_2}{\\partial x} & \\frac{\\partial N_2}{\\partial y} & \\frac{\\partial N_3}{\\partial x} & \\frac{\\partial N_3}{\\partial y} & \\frac{\\partial N_4}{\\partial x} & \\frac{\\partial N_4}{\\partial y} \\end{bmatrix}\n$$\nTo find the spatial derivatives of the shape functions, we use the chain rule. For the given rectangular element, the Jacobian matrix of the transformation from natural $(\\xi, \\eta)$ to physical $(x,y)$ coordinates is constant and diagonal:\n$$\nJ = \\begin{bmatrix} \\frac{\\partial x}{\\partial \\xi} & \\frac{\\partial y}{\\partial \\xi} \\\\ \\frac{\\partial x}{\\partial \\eta} & \\frac{\\partial y}{\\partial \\eta} \\end{bmatrix} = \\begin{bmatrix} \\frac{L_x}{2} & 0 \\\\ 0 & \\frac{L_y}{2} \\end{bmatrix}\n$$\nThe spatial derivatives are related to the natural coordinate derivatives by $J^{-1}$, so $\\frac{\\partial N_i}{\\partial x} = \\frac{2}{L_x} \\frac{\\partial N_i}{\\partial \\xi}$ and $\\frac{\\partial N_i}{\\partial y} = \\frac{2}{L_y} \\frac{\\partial N_i}{\\partial \\eta}$.\n\nNext, we compute the integral for $\\bar{b}_v$. The differential area element is $d\\Omega = |J|\\,d\\xi d\\eta = \\frac{L_x L_y}{4}\\,d\\xi d\\eta = \\frac{\\Omega_e}{4}\\,d\\xi d\\eta$. Substituting this into the definition of $\\bar{b}_v$:\n$$\n\\bar{b}_v = \\frac{1}{\\Omega_e} \\int_{-1}^1 \\int_{-1}^1 b_v(\\xi, \\eta) \\frac{\\Omega_e}{4} \\,d\\xi d\\eta = \\frac{1}{4} \\int_{-1}^1 \\int_{-1}^1 b_v(\\xi, \\eta) \\,d\\xi d\\eta\n$$\nThis shows that each component of $\\bar{b}_v$ is the average value of the corresponding component of $b_v$ over the parent element domain. The derivatives of the shape functions with respect to natural coordinates are linear functions of $\\xi$ and $\\eta$. The integral over the symmetric domain $[-1,1]^2$ isolates the constant term of the integrand.\nFor example, for the first component related to $u_1$:\n$$\n(\\bar{b}_v)_1 = \\frac{1}{4} \\int_{-1}^1 \\int_{-1}^1 \\frac{\\partial N_1}{\\partial x} \\,d\\xi d\\eta = \\frac{1}{4} \\int_{-1}^1 \\int_{-1}^1 \\left(\\frac{2}{L_x}\\right) \\left(-\\frac{1}{4}(1-\\eta)\\right) \\,d\\xi d\\eta = -\\frac{1}{2L_x}\n$$\nPerforming this integration for all eight components yields their constant (average) values:\n-   Avg($\\frac{\\partial N_1}{\\partial x}$) = $-\\frac{1}{2L_x}$, Avg($\\frac{\\partial N_1}{\\partial y}$) = $-\\frac{1}{2L_y}$\n-   Avg($\\frac{\\partial N_2}{\\partial x}$) = $\\frac{1}{2L_x}$, Avg($\\frac{\\partial N_2}{\\partial y}$) = $-\\frac{1}{2L_y}$\n-   Avg($\\frac{\\partial N_3}{\\partial x}$) = $\\frac{1}{2L_x}$, Avg($\\frac{\\partial N_3}{\\partial y}$) = $\\frac{1}{2L_y}$\n-   Avg($\\frac{\\partial N_4}{\\partial x}$) = $-\\frac{1}{2L_x}$, Avg($\\frac{\\partial N_4}{\\partial y}$) = $\\frac{1}{2L_y}$\n\nAssembling these average values into the row vector $\\bar{b}_v$:\n$$\n\\bar{b}_v = \\begin{bmatrix} -\\frac{1}{2L_x} & -\\frac{1}{2L_y} & \\frac{1}{2L_x} & -\\frac{1}{2L_y} & \\frac{1}{2L_x} & \\frac{1}{2L_y} & -\\frac{1}{2L_x} & \\frac{1}{2L_y} \\end{bmatrix}\n$$\nFactoring out a common term $\\frac{1}{2L_x L_y}$ gives the final expression:\n$$\n\\bar{b}_v = \\frac{1}{2L_x L_y} \\begin{bmatrix} -L_y & -L_x & L_y & -L_x & L_y & L_x & -L_y & L_x \\end{bmatrix}\n$$\nThe projected volumetric strain is then calculated as the constant value $\\bar{\\epsilon}_v = \\bar{b}_v d$.", "answer": "$$\n\\boxed{\\frac{1}{2L_x L_y} \\begin{bmatrix} -L_y & -L_x & L_y & -L_x & L_y & L_x & -L_y & L_x \\end{bmatrix}}\n$$", "id": "3502521"}, {"introduction": "Whenever a finite element formulation is modified, a critical question arises: does the fix introduce any unintended side effects, such as a loss of stability? This final computational practice addresses this concern for the $\\bar{B}$ method by investigating the potential for spurious zero-energy modes. Through an eigenanalysis of the modified stiffness matrix, you will verify that the $\\bar{B}$ formulation successfully mitigates locking while preserving the correct number of rigid-body modes, thus ensuring the element remains numerically stable and reliable [@problem_id:3502461].", "problem": "You are to analyze whether the B-bar (denoted $\\bar{B}$) modification introduces any spurious zero-energy modes in a four-node bilinear quadrilateral element (Quadrilateral four-node (Q4)) under small-strain linear elasticity in plane strain. Your analysis must start from first principles and produce a program that constructs the element stiffness matrix, performs eigenanalysis, and quantitatively compares the nullspace properties of the standard and $\\bar{B}$-modified formulations.\n\nFundamental base and modeling assumptions:\n- Kinematics: small strain, so the symmetric infinitesimal strain tensor $\\boldsymbol{\\varepsilon}$ is defined by $\\varepsilon_{ij} = \\tfrac{1}{2}\\left(u_{i,j} + u_{j,i}\\right)$.\n- Discretization: isoparametric Q4 element with bilinear shape functions on a convex quadrilateral. The displacement field is interpolated as $\\mathbf{u}(\\mathbf{x}) = \\sum_{a=1}^{4} N_a(\\xi,\\eta)\\,\\mathbf{u}_a$, where $(\\xi,\\eta)\\in[-1,1]^2$ are natural coordinates.\n- Numerical integration: standard Gauss quadrature with $2\\times 2$ points.\n- Material: homogeneous, isotropic, linear elastic in plane strain with Young’s modulus $E$ (in Pascals) and Poisson’s ratio $\\nu$. Let the Lamé parameters be $\\lambda = \\dfrac{E\\nu}{(1+\\nu)(1-2\\nu)}$ and $\\mu = \\dfrac{E}{2(1+\\nu)}$. The constitutive matrix in the $(\\sigma_{xx},\\sigma_{yy},\\tau_{xy})$–$(\\varepsilon_{xx},\\varepsilon_{yy},\\gamma_{xy})$ representation is\n$$\n\\mathbf{D} \\;=\\;\n\\begin{bmatrix}\n\\lambda + 2\\mu & \\lambda & 0 \\\\\n\\lambda & \\lambda + 2\\mu & 0 \\\\\n0 & 0 & \\mu\n\\end{bmatrix}.\n$$\n- Standard element stiffness: for each Gauss point $i$ with weight $w_i$ and Jacobian determinant $J_i$, assemble $\\mathbf{K} = \\sum_i w_i\\, J_i\\, \\mathbf{B}_i^\\mathsf{T}\\,\\mathbf{D}\\,\\mathbf{B}_i$, where $\\mathbf{B}_i$ maps nodal displacements to strains $\\boldsymbol{\\varepsilon}_i = \\mathbf{B}_i \\mathbf{u}_e$ with the engineering shear $\\gamma_{xy}$.\n- $\\bar{B}$-modified element stiffness: decompose the in-plane strain into volumetric and deviatoric parts using the in-plane dilatation $e_{\\mathrm{vol}} = \\varepsilon_{xx} + \\varepsilon_{yy}$. Replace the pointwise $e_{\\mathrm{vol}}$ at any Gauss point by its element-wise area-average $\\bar{e}_{\\mathrm{vol}}$ (the $L^2$-projection onto the space of constants over the element), while keeping the deviatoric strain part unchanged. Then assemble the stiffness using the modified strain-displacement operator.\n\nYour program must:\n1. Construct the standard Q4 element stiffness matrix $\\mathbf{K}$ for three separate test cases.\n2. Construct the $\\bar{B}$-modified element stiffness matrix $\\mathbf{K}_{\\bar{B}}$ for the same three test cases by projecting the in-plane volumetric strain $e_{\\mathrm{vol}} = \\varepsilon_{xx} + \\varepsilon_{yy}$ to its element-wise average.\n3. Perform an eigenanalysis of each matrix and determine:\n   - The number of numerically near-zero eigenvalues (interpreted as zero-energy modes). Use a relative threshold defined as follows: let $\\lambda_{\\max}$ be the largest eigenvalue; classify any eigenvalue $\\lambda$ as near-zero if $\\lambda \\le \\max\\left(10^{-8}\\,\\lambda_{\\max},\\,10^{-12}\\right)$.\n   - The largest principal angle (in radians) between the subspace spanned by the three eigenvectors corresponding to the smallest eigenvalues and the rigid body subspace generated by the two translations and one in-plane rotation. The rigid body subspace basis vectors are to be constructed from the nodal coordinates $(x_a,y_a)$ as follows:\n     - Rigid translation in $x$: $\\mathbf{r}_1 = [1,0,1,0,1,0,1,0]^\\mathsf{T}$,\n     - Rigid translation in $y$: $\\mathbf{r}_2 = [0,1,0,1,0,1,0,1]^\\mathsf{T}$,\n     - Rigid rotation about the origin with unit rotation: $\\mathbf{r}_3 = [-y_1,x_1,-y_2,x_2,-y_3,x_3,-y_4,x_4]^\\mathsf{T}$.\n   Compute the largest principal angle between the span of $\\{\\mathbf{r}_1,\\mathbf{r}_2,\\mathbf{r}_3\\}$ and the span of the three smallest-eigenvalue eigenvectors, using the standard Euclidean inner product. Express this angle in radians as a floating-point number.\n\nTest suite:\nProvide results for the following three test cases. In all cases, use plane strain and units of Pascals for $E$.\n- Case A (nominal compressible, undistorted): Node coordinates in meters\n  $$\n  (x_1,y_1)=(0,0),\\quad (x_2,y_2)=(1,0),\\quad (x_3,y_3)=(1,1),\\quad (x_4,y_4)=(0,1),\n  $$\n  with $E = 3.0\\times 10^{7}$ and $\\nu = 0.25$.\n- Case B (nearly incompressible, undistorted): Same coordinates as Case A, with $E = 3.0\\times 10^{7}$ and $\\nu = 0.499999$.\n- Case C (compressible, distorted convex quadrilateral): Node coordinates in meters\n  $$\n  (x_1,y_1)=(0.0,0.0),\\;\n  (x_2,y_2)=(2.0,0.2),\\;\n  (x_3,y_3)=(1.8,1.2),\\;\n  (x_4,y_4)=(-0.1,1.0),\n  $$\n  with $E = 3.0\\times 10^{7}$ and $\\nu = 0.25$.\n\nFor each case, your program must output a list with four entries:\n- The integer number of near-zero eigenvalues for the standard formulation,\n- The integer number of near-zero eigenvalues for the $\\bar{B}$ formulation,\n- The largest principal angle in radians (as a floating-point number) for the standard formulation,\n- The largest principal angle in radians (as a floating-point number) for the $\\bar{B}$ formulation.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of three lists (one per case) enclosed in square brackets. Each inner list must have the form\n  $[n_{\\mathrm{std}},n_{\\bar{B}},\\theta_{\\mathrm{std}},\\theta_{\\bar{B}}]$,\n  where $n_{\\mathrm{std}}$ and $n_{\\bar{B}}$ are integers and $\\theta_{\\mathrm{std}}$ and $\\theta_{\\bar{B}}$ are floating-point numbers in radians, each formatted in scientific notation with six digits after the decimal (for example, $1.234567\\mathrm{e}{-08}$). For instance:\n  $[[3,3,1.000000\\mathrm{e}{-12},1.000000\\mathrm{e}{-12}],[\\dots],[\\dots]]$.\n\nScientific realism and expectations:\n- The standard Q4 stiffness matrix is symmetric positive semidefinite with exactly three rigid body modes in two dimensions, so its rank is expected to be $5$ for a single unconstrained element. The $\\bar{B}$ modification should not introduce additional spurious zero-energy modes. Your numerical evidence should confirm that both the standard and $\\bar{B}$-modified stiffness matrices possess the same number of near-zero eigenvalues and that the subspace of the three smallest-eigenvalue eigenvectors aligns with the rigid body subspace (small largest principal angle).", "solution": "The problem requires an analysis of the B-bar ($\\bar{B}$) method's effect on the stability of a four-node bilinear quadrilateral (Q4) element in plane strain linear elasticity. Specifically, we must determine if this modification introduces non-physical, or \"spurious,\" zero-energy modes. The analysis involves constructing the standard stiffness matrix $\\mathbf{K}$ and the $\\bar{B}$-modified stiffness matrix $\\mathbf{K}_{\\bar{B}}$, performing an eigenvalue analysis on both, and comparing their nullspaces to the subspace of rigid-body motions.\n\n### 1. Isoparametric Q4 Element Formulation\n\nThe foundation of the analysis is the isoparametric Q4 element. The geometry and displacement field within the element are interpolated from the nodal values using the same set of bilinear shape functions, $N_a(\\xi, \\eta)$, where $(\\xi, \\eta)$ are the natural coordinates in the reference square domain $[-1,1]^2$.\n\nThe displacement field $\\mathbf{u}$ at a point $(x,y)$ within the element is given by:\n$$ \\mathbf{u}(x,y) = \\sum_{a=1}^{4} N_a(\\xi,\\eta) \\mathbf{u}_a $$\nwhere $\\mathbf{u}_a = \\{u_{xa}, u_{ya}\\}^T$ is the displacement vector at node $a$. The vector of all $8$ nodal degrees of freedom is denoted by $\\mathbf{u}_e$.\n\nUnder the assumption of small strains, the engineering strain vector $\\boldsymbol{\\varepsilon} = \\{\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}\\}^T$ is related to the nodal displacements by the strain-displacement matrix $\\mathbf{B}$:\n$$ \\boldsymbol{\\varepsilon} = \\mathbf{B} \\mathbf{u}_e $$\nThe matrix $\\mathbf{B}$ is composed of nodal blocks $\\mathbf{B}_a$:\n$$ \\mathbf{B} = [\\mathbf{B}_1, \\mathbf{B}_2, \\mathbf{B}_3, \\mathbf{B}_4], \\quad \\text{with} \\quad \\mathbf{B}_a = \\begin{bmatrix} \\frac{\\partial N_a}{\\partial x} & 0 \\\\ 0 & \\frac{\\partial N_a}{\\partial y} \\\\ \\frac{\\partial N_a}{\\partial y} & \\frac{\\partial N_a}{\\partial x} \\end{bmatrix} $$\nThe derivatives of the shape functions with respect to the physical coordinates $(x,y)$ are obtained from their derivatives with respect to the natural coordinates $(\\xi, \\eta)$ via the inverse of the Jacobian matrix $\\mathbf{J}$.\n\n### 2. Standard Element Stiffness Matrix $\\mathbf{K}$\n\nThe element stiffness matrix $\\mathbf{K}$ relates the nodal forces to the nodal displacements. It is derived from the element's strain energy and is computed by integrating over the element's area $A$:\n$$ \\mathbf{K} = \\int_A \\mathbf{B}^T \\mathbf{D} \\mathbf{B} \\, dA $$\nHere, $\\mathbf{D}$ is the constitutive matrix for plane strain, which relates stresses to strains: $\\boldsymbol{\\sigma} = \\mathbf{D}\\boldsymbol{\\varepsilon}$. The problem provides the matrix for an isotropic material:\n$$ \\mathbf{D} = \\begin{bmatrix} \\lambda + 2\\mu & \\lambda & 0 \\\\ \\lambda & \\lambda + 2\\mu & 0 \\\\ 0 & 0 & \\mu \\end{bmatrix} $$\nwhere $\\lambda$ and $\\mu$ are the Lamé parameters. The integral is evaluated numerically using $2 \\times 2$ Gauss quadrature:\n$$ \\mathbf{K} \\approx \\sum_{i=1}^{4} w_i \\mathbf{B}_i^T \\mathbf{D} \\mathbf{B}_i \\det(\\mathbf{J}_i) $$\nwhere the index $i$ runs over the four Gauss points, $w_i=1$ are the weights, and $\\mathbf{B}_i$ and $\\det(\\mathbf{J}_i)$ are the B-matrix and Jacobian determinant evaluated at the $i$-th Gauss point.\n\n### 3. The $\\bar{B}$ Method for Volumetric Locking\n\nStandard Q4 elements with full ($2 \\times 2$) integration exhibit \"volumetric locking\" when modeling nearly incompressible materials (i.e., Poisson's ratio $\\nu \\to 0.5$). The limited kinematic modes of the bilinear approximation cannot satisfy the constant-volume constraint at every point, leading to a spuriously stiff response.\n\nThe $\\bar{B}$ method alleviates this by modifying how the volumetric part of the strain is computed. The strain tensor is decomposed into a deviatoric (shape-changing) part and a volumetric (volume-changing) part. In 2D, the volumetric strain, or in-plane dilatation, is $e_{\\mathrm{vol}} = \\varepsilon_{xx} + \\varepsilon_{yy}$.\n\nThe core idea is to enforce a weaker, averaged volumetric constraint. Instead of requiring the volumetric strain to be correctly represented at every Gauss point, its element-averaged value $\\bar{e}_{\\mathrm{vol}}$ is used:\n$$ \\bar{e}_{\\mathrm{vol}} = \\frac{1}{A} \\int_A e_{\\mathrm{vol}} \\, dA $$\nThis projection of the volumetric strain onto the space of constant functions over the element is sufficient to capture the dominant volumetric behavior without over-constraining the element. This leads to a modified strain-displacement relationship and, consequently, a modified stiffness matrix $\\mathbf{K}_{\\bar{B}}$.\n\nA computationally efficient way to construct $\\mathbf{K}_{\\bar{B}}$ is by decomposing the constitutive matrix $\\mathbf{D}$ into volumetric and deviatoric parts, $\\mathbf{D} = \\mathbf{D}_{\\mathrm{vol}} + \\mathbf{D}_{\\mathrm{dev}}$. For plane strain, the bulk modulus is $K = \\lambda+\\mu$. The decomposition is:\n$$ \\mathbf{D}_{\\mathrm{vol}} = K \\begin{bmatrix} 1 & 1 & 0 \\\\ 1 & 1 & 0 \\\\ 0 & 0 & 0 \\end{bmatrix}, \\quad \\mathbf{D}_{\\mathrm{dev}} = \\mu \\begin{bmatrix} 1 & -1 & 0 \\\\ -1 & 1 & 0 \\\\ 0 & 0 & 1 \\end{bmatrix} $$\nThe deviatoric part of the stiffness matrix is computed using full integration:\n$$ \\mathbf{K}_{\\mathrm{dev}} = \\int_A \\mathbf{B}^T \\mathbf{D}_{\\mathrm{dev}} \\mathbf{B} \\, dA \\approx \\sum_{i=1}^{4} w_i \\mathbf{B}_i^T \\mathbf{D}_{\\mathrm{dev}} \\mathbf{B}_i \\det(\\mathbf{J}_i) $$\nThe volumetric part is based on the averaged kinematics. Let $\\mathbf{m} = \\{1, 1, 0\\}^T$. The average volumetric strain operator is a column vector $\\bar{\\mathbf{b}}$:\n$$ \\bar{\\mathbf{b}} = \\frac{1}{A} \\int_A \\mathbf{B}^T \\mathbf{m} \\, dA \\approx \\frac{1}{\\sum_j w_j \\det(\\mathbf{J}_j)} \\sum_i w_i (\\mathbf{B}_i^T \\mathbf{m}) \\det(\\mathbf{J}_i) $$\nThe volumetric stiffness is then constructed as:\n$$ \\mathbf{K}_{\\bar{\\mathrm{vol}}} = A \\, K \\, \\bar{\\mathbf{b}} \\bar{\\mathbf{b}}^T $$\nThe total modified stiffness matrix is the sum of these two components:\n$$ \\mathbf{K}_{\\bar{B}} = \\mathbf{K}_{\\mathrm{dev}} + \\mathbf{K}_{\\bar{\\mathrm{vol}}} $$\nThis formulation correctly handles the nearly incompressible case while retaining the correct behavior for compressible materials.\n\n### 4. Stability Analysis: Zero-Energy Modes\n\nThe stability of an element formulation is assessed by examining the eigenvalues of its stiffness matrix. Eigenvectors with zero eigenvalues correspond to \"zero-energy modes\"—patterns of nodal displacement that produce no strain energy. For any unconstrained element in 2D, there must be exactly three such modes, corresponding to rigid-body motions (two translations and one in-plane rotation).\n\nThe presence of more than three zero-energy modes indicates that the element is unstable, as it can deform without resisting, a phenomenon known as \"spurious modes\" or \"mechanisms.\" A crucial test for any new formulation, such as the $\\bar{B}$ method, is to verify that it does not introduce such spurious modes. We perform this test by computing the eigenvalues of $\\mathbf{K}$ and $\\mathbf{K}_{\\bar{B}}$ and counting how many are numerically close to zero.\n\n### 5. Subspace Comparison via Principal Angles\n\nTo confirm that the computed zero-energy modes are indeed the correct rigid-body modes (RBMs), we compare the eigenspace corresponding to the three smallest eigenvalues with the analytically defined RBM subspace. The principal angles between two subspaces provide a measure of their alignment. If the largest principal angle is close to zero, the two subspaces are nearly identical.\n\nThe RBM subspace is spanned by the vectors for x-translation ($\\mathbf{r}_1$), y-translation ($\\mathbf{r}_2$), and rotation about the origin ($\\mathbf{r}_3$). We form an orthonormal basis $\\mathbf{Q}_R$ for this subspace. The eigenvectors corresponding to the three smallest eigenvalues of the stiffness matrix form another orthonormal basis $\\mathbf{Q}_U$. The cosines of the principal angles are the singular values of the matrix product $\\mathbf{Q}_R^T \\mathbf{Q}_U$. The largest principal angle is the arccosine of the smallest singular value. A small value for this angle confirms that the element's nullspace correctly represents the rigid-body motions.\n\nThe following program implements this entire procedure to provide quantitative evidence regarding the stability of the $\\bar{B}$ formulation. Both the standard and modified elements are expected to have exactly three zero-energy modes, which correspond to the RBMs.", "answer": "```python\nimport numpy as np\nfrom scipy.linalg import eigh, svd, qr\n\ndef solve():\n    \"\"\"\n    Main function to run the analysis for all test cases.\n    \"\"\"\n    \n    # Test Cases: (node_coords, E, nu)\n    test_cases = [\n        # Case A: Square, compressible\n        (np.array([[0.0, 0.0], [1.0, 0.0], [1.0, 1.0], [0.0, 1.0]]), \n         3.0e7, 0.25),\n        # Case B: Square, nearly incompressible\n        (np.array([[0.0, 0.0], [1.0, 0.0], [1.0, 1.0], [0.0, 1.0]]), \n         3.0e7, 0.499999),\n        # Case C: Distorted, compressible\n        (np.array([[0.0, 0.0], [2.0, 0.2], [1.8, 1.2], [-0.1, 1.0]]), \n         3.0e7, 0.25)\n    ]\n\n    results = []\n    for nodes, E, nu in test_cases:\n        case_results = []\n        \n        # Standard formulation\n        n_std, theta_std = analyze_element(nodes, E, nu, use_b_bar=False)\n        \n        # B-bar formulation\n        n_bbar, theta_bbar = analyze_element(nodes, E, nu, use_b_bar=True)\n        \n        case_results.extend([n_std, n_bbar, theta_std, theta_bbar])\n        results.append(case_results)\n\n    # Format output\n    output_str = \"[\"\n    for i, res in enumerate(results):\n        n_s, n_b, t_s, t_b = res\n        output_str += f\"[{n_s},{n_b},{t_s:.6e},{t_b:.6e}]\"\n        if i < len(results) - 1:\n            output_str += \",\"\n    output_str += \"]\"\n    \n    print(output_str)\n\ndef analyze_element(nodes, E, nu, use_b_bar):\n    \"\"\"\n    Analyzes a single element configuration.\n    \n    Args:\n        nodes: Nodal coordinates (4x2 array).\n        E: Young's modulus.\n        nu: Poisson's ratio.\n        use_b_bar: Boolean flag to use the B-bar method.\n        \n    Returns:\n        A tuple containing:\n        - The number of near-zero eigenvalues.\n        - The largest principal angle with the RBM subspace in radians.\n    \"\"\"\n    K = build_stiffness_matrix(nodes, E, nu, use_b_bar)\n    \n    # Eigenanalysis\n    evals, evecs = eigh(K)\n    \n    # Count near-zero eigenvalues\n    lambda_max = evals[-1]\n    threshold = max(1e-8 * lambda_max, 1e-12)\n    num_zero_modes = np.sum(evals <= threshold)\n    \n    # Principal angle calculation\n    # Subspace from 3 smallest eigenvalues\n    Q_U = evecs[:, :3]\n    \n    # Rigid Body Mode (RBM) subspace\n    r1 = np.array([1, 0, 1, 0, 1, 0, 1, 0], dtype=float)\n    r2 = np.array([0, 1, 0, 1, 0, 1, 0, 1], dtype=float)\n    x, y = nodes.flatten(order='C')[::2], nodes.flatten(order='C')[1::2]\n    r3 = np.ravel(np.vstack([-y, x]).T)\n    \n    RBM_matrix = np.vstack([r1, r2, r3]).T\n    Q_R, _ = qr(RBM_matrix) # Orthonormal basis for RBM subspace\n    \n    # Singular values of the correlation matrix\n    M = Q_U.T @ Q_R\n    s = svd(M, compute_uv=False)\n    \n    # Smallest singular value corresponds to the largest principal angle\n    s_min = s[-1]\n    # np.clip for numerical stability with arccos\n    largest_principal_angle = np.arccos(np.clip(s_min, -1.0, 1.0))\n    \n    return num_zero_modes, largest_principal_angle\n\ndef get_shape_functions_and_derivs(xi, eta):\n    \"\"\"Returns shape functions and their derivatives w.r.t. natural coords.\"\"\"\n    N = 0.25 * np.array([(1-xi)*(1-eta), (1+xi)*(1-eta), (1+xi)*(1+eta), (1-xi)*(1+eta)])\n    \n    dN_dxi = 0.25 * np.array([-(1-eta), (1-eta), (1+eta), -(1+eta)])\n    dN_deta = 0.25 * np.array([-(1-xi), -(1+xi), (1+xi), (1-xi)])\n    \n    return N, np.vstack([dN_dxi, dN_deta])\n\ndef build_stiffness_matrix(nodes, E, nu, use_b_bar):\n    \"\"\"\n    Constructs the 8x8 element stiffness matrix for a Q4 element.\n    \"\"\"\n    # Material properties for plane strain\n    lame_lambda = (E * nu) / ((1 + nu) * (1 - 2 * nu))\n    lame_mu = E / (2 * (1 + nu))\n    \n    if not use_b_bar:\n        D = np.array([\n            [lame_lambda + 2 * lame_mu, lame_lambda, 0],\n            [lame_lambda, lame_lambda + 2 * lame_mu, 0],\n            [0, 0, lame_mu]\n        ])\n    else:\n        # For B-bar, we need D_dev and bulk modulus K\n        K_bulk = lame_lambda + lame_mu\n        D_dev = lame_mu * np.array([[1, -1, 0], [-1, 1, 0], [0, 0, 1]])\n\n    # 2x2 Gauss quadrature\n    gauss_points = 1.0 / np.sqrt(3) * np.array([[-1, -1], [1, -1], [1, 1], [-1, 1]])\n    gauss_weights = np.array([1, 1, 1, 1])\n\n    K = np.zeros((8, 8))\n    \n    # Pre-compute B matrices and Jacobians at all Gauss points\n    B_matrices = []\n    J_dets = []\n    for xi, eta in gauss_points:\n        _, dN_dnat = get_shape_functions_and_derivs(xi, eta)\n        \n        J = dN_dnat @ nodes\n        det_J = np.linalg.det(J)\n        if det_J <= 0:\n            raise ValueError(\"Jacobian is non-positive. Element may be distorted or incorrectly numbered.\")\n        \n        J_inv = np.linalg.inv(J)\n        dN_dxy = J_inv @ dN_dnat\n        \n        B = np.zeros((3, 8))\n        for i in range(4):\n            B[0, 2*i] = dN_dxy[0, i]\n            B[1, 2*i+1] = dN_dxy[1, i]\n            B[2, 2*i] = dN_dxy[1, i]\n            B[2, 2*i+1] = dN_dxy[0, i]\n        \n        B_matrices.append(B)\n        J_dets.append(det_J)\n\n    if not use_b_bar:\n        # Standard formulation\n        for B_i, det_J_i, w_i in zip(B_matrices, J_dets, gauss_weights):\n            K += B_i.T @ D @ B_i * det_J_i * w_i\n    else:\n        # B-bar formulation\n        # K_bbar = K_dev + K_vol_bar\n        # K_dev = sum(w_i * J_i * B_i.T @ D_dev @ B_i)\n        K_dev = np.zeros((8, 8))\n        for B_i, det_J_i, w_i in zip(B_matrices, J_dets, gauss_weights):\n            K_dev += B_i.T @ D_dev @ B_i * det_J_i * w_i\n        \n        # K_vol_bar = A * K * b_bar @ b_bar.T\n        m = np.array([1, 1, 0])\n        element_area = sum(w * J for w, J in zip(gauss_weights, J_dets))\n        \n        b_bar_sum = np.zeros(8)\n        for B_i, det_J_i, w_i in zip(B_matrices, J_dets, gauss_weights):\n            b_bar_sum += m @ B_i * det_J_i * w_i\n        \n        b_bar = (1.0 / element_area) * b_bar_sum\n        \n        K_vol_bar = element_area * K_bulk * np.outer(b_bar, b_bar)\n        \n        K = K_dev + K_vol_bar\n\n    return K\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3502461"}]}