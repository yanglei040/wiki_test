{"hands_on_practices": [{"introduction": "To effectively sample from a target probability distribution like the Boltzmann distribution, Markov Chain Monte Carlo methods must satisfy the principle of detailed balance. This foundational exercise ([@problem_id:3425834]) guides you through the derivation of the famous Metropolis acceptance criterion, starting directly from the detailed balance condition for a symmetric proposal kernel. By connecting the abstract principle to a concrete formula and a numerical calculation, you will build a robust understanding of how and why the algorithm works.", "problem": "A canonical-ensemble Monte Carlo move is embedded within a molecular dynamics workflow to sample from the Boltzmann distribution at inverse temperature $\\beta$. Consider a system with potential energy function $U(x)$, where $x$ denotes the configuration in a continuous state space. The desired stationary distribution is the canonical distribution $\\pi(x) \\propto \\exp\\!\\left(-\\beta U(x)\\right)$, where $\\beta = 1/(k_{B} T)$, $k_{B}$ is the Boltzmann constant, and $T$ is the absolute temperature. Suppose a proposal mechanism generates trial configurations according to a symmetric kernel $q(x \\to x')$, meaning $q(x \\to x') = q(x' \\to x)$ for all pairs $(x,x')$ in the state space. \n\nStarting from the detailed balance condition for a Markov chain with transition probability density $T(x \\to x') = q(x \\to x')\\,a(x \\to x')$ for $x' \\neq x$ and using only that the target distribution is $\\pi(x) \\propto \\exp\\!\\left(-\\beta U(x)\\right)$, derive an acceptance probability $a(x \\to x')$ that ensures detailed balance under the constraints $0 \\leq a(x \\to x') \\leq 1$ and $0 \\leq a(x' \\to x) \\leq 1$, and that is maximal in the sense of accepting energetically favorable moves with the greatest possible probability. Then evaluate this acceptance probability for a single proposed move with inverse temperature $\\beta = 2.5\\,\\mathrm{mol/kcal}$ and energy change $\\Delta U = U(x') - U(x) = 0.8\\,\\mathrm{kcal/mol}$. \n\nReport the acceptance probability as a dimensionless decimal rounded to $4$ significant figures.", "solution": "The problem requires the derivation of the Metropolis acceptance probability from the principle of detailed balance for a Markov chain designed to sample from the canonical distribution, followed by a numerical evaluation for a specific case.\n\nFirst, we establish the theoretical foundation. The system is intended to reach a stationary state described by the canonical distribution, $\\pi(x)$, where the probability of observing a configuration $x$ is proportional to the Boltzmann factor.\n$$\n\\pi(x) = \\frac{1}{Z} \\exp(-\\beta U(x))\n$$\nHere, $U(x)$ is the potential energy of configuration $x$, $\\beta = 1/(k_B T)$ is the inverse temperature (with $k_B$ being the Boltzmann constant and $T$ the absolute temperature), and $Z$ is the partition function, which a normalization constant. The problem statement gives the proportionality $\\pi(x) \\propto \\exp(-\\beta U(x))$, which is sufficient.\n\nA sufficient condition for a Markov chain to converge to a stationary distribution $\\pi(x)$ is the satisfaction of the detailed balance condition. This condition equates the probability flux from state $x$ to state $x'$ with the flux from $x'$ to $x$.\n$$\n\\pi(x) T(x \\to x') = \\pi(x') T(x' \\to x)\n$$\nwhere $T(x \\to x')$ is the transition probability density from configuration $x$ to $x'$.\n\nThe problem specifies that the transition is a two-step process: proposing a new configuration $x'$ from $x$ according to a proposal distribution $q(x \\to x')$, and then accepting this new configuration with a probability $a(x \\to x')$. Thus, the overall transition probability density is given by $T(x \\to x') = q(x \\to x') a(x \\to x')$.\n\nSubstituting the expressions for $\\pi(x)$ and $T(x \\to x')$ into the detailed balance equation, we get:\n$$\n\\left( C \\exp(-\\beta U(x)) \\right) \\left( q(x \\to x') a(x \\to x') \\right) = \\left( C \\exp(-\\beta U(x')) \\right) \\left( q(x' \\to x) a(x' \\to x) \\right)\n$$\nwhere $C$ is the constant of proportionality ($1/Z$). This constant cancels from both sides.\n$$\n\\exp(-\\beta U(x)) q(x \\to x') a(x \\to x') = \\exp(-\\beta U(x')) q(x' \\to x) a(x' \\to x)\n$$\nThe problem states that the proposal kernel $q$ is symmetric, meaning $q(x \\to x') = q(x' \\to x)$. This allows us to cancel the proposal kernel terms as well, greatly simplifying the equation:\n$$\n\\exp(-\\beta U(x)) a(x \\to x') = \\exp(-\\beta U(x')) a(x' \\to x)\n$$\nWe can rearrange this equation to find the ratio of the acceptance probabilities for the forward move ($x \\to x'$) and the reverse move ($x' \\to x$):\n$$\n\\frac{a(x \\to x')}{a(x' \\to x)} = \\frac{\\exp(-\\beta U(x'))}{\\exp(-\\beta U(x))} = \\exp(-\\beta (U(x') - U(x)))\n$$\nLet's define the change in energy as $\\Delta U = U(x') - U(x)$. The ratio becomes:\n$$\n\\frac{a(x \\to x')}{a(x' \\to x)} = \\exp(-\\beta \\Delta U)\n$$\nThis single equation relates the two unknown acceptance probabilities $a(x \\to x')$ and $a(x' \\to x)$. To obtain a specific form for the acceptance probability, we must apply the additional constraints. The probabilities must lie in the interval $[0, 1]$, i.e., $0 \\leq a(x \\to x') \\leq 1$ and $0 \\leq a(x' \\to x) \\leq 1$. Furthermore, the problem asks for an acceptance probability that is maximal. This means we should choose the probabilities to be as large as possible to improve the efficiency of sampling, while still satisfying the ratio condition and the upper bound of $1$.\n\nTo maximize both probabilities, we set the larger of the two to its maximum possible value, which is $1$. Let's analyze two cases for the ratio $R = \\exp(-\\beta \\Delta U)$.\n\nCase 1: The proposed move is energetically favorable or neutral ($\\Delta U \\leq 0$).\nIn this case, $-\\beta \\Delta U \\geq 0$, which implies that the ratio $\\exp(-\\beta \\Delta U) \\geq 1$.\nSo, $\\frac{a(x \\to x')}{a(x' \\to x)} \\geq 1$, which means $a(x \\to x') \\geq a(x' \\to x)$.\nTo maximize both probabilities, we set the larger one, $a(x \\to x')$, to its maximum value, $1$.\n$$\na(x \\to x') = 1\n$$\nThis choice is consistent with the goal of accepting all energetically favorable moves. Substituting this into the ratio equation gives $a(x' \\to x) = \\exp(\\beta \\Delta U)$, which is less than or equal to $1$, satisfying the constraint.\n\nCase 2: The proposed move is energetically unfavorable ($\\Delta U  0$).\nIn this case, $-\\beta \\Delta U  0$, which implies that the ratio $\\exp(-\\beta \\Delta U)  1$.\nSo, $\\frac{a(x \\to x')}{a(x' \\to x)}  1$, which means $a(x \\to x')  a(x' \\to x)$.\nTo maximize both probabilities, we set the larger one, $a(x' \\to x)$, to its maximum value, $1$.\n$$\na(x' \\to x) = 1\n$$\nSubstituting this into the ratio equation gives:\n$$\na(x \\to x') = \\exp(-\\beta \\Delta U)\n$$\nThis choice is valid because $\\exp(-\\beta \\Delta U)  1$.\n\nCombining these two cases into a single expression, we find that the acceptance probability for the move $x \\to x'$ is:\n$$\na(x \\to x') =\n\\begin{cases}\n\\exp(-\\beta \\Delta U)  \\text{if } \\Delta U  0 \\\\\n1  \\text{if } \\Delta U \\leq 0\n\\end{cases}\n$$\nThis can be written more compactly using the minimum function:\n$$\na(x \\to x') = \\min\\left(1, \\exp(-\\beta \\Delta U)\\right)\n$$\nThis is the Metropolis acceptance criterion, which satisfies detailed balance and maximizes the acceptance rate.\n\nNow we evaluate this for the given numerical values:\nInverse temperature: $\\beta = 2.5\\,\\mathrm{mol/kcal}$\nEnergy change: $\\Delta U = U(x') - U(x) = 0.8\\,\\mathrm{kcal/mol}$\n\nFirst, we calculate the dimensionless product $\\beta \\Delta U$:\n$$\n\\beta \\Delta U = (2.5\\,\\mathrm{mol/kcal}) \\times (0.8\\,\\mathrm{kcal/mol}) = 2.0\n$$\nSince $\\Delta U = 0.8  0$, the move is energetically unfavorable, and we are in the second case of our derivation. The acceptance probability is:\n$$\na(x \\to x') = \\exp(-\\beta \\Delta U) = \\exp(-2.0)\n$$\nThe numerical value is:\n$$\na(x \\to x') \\approx 0.13533528...\n$$\nThe problem requires this value to be rounded to $4$ significant figures.\n$$\na(x \\to x') \\approx 0.1353\n$$\nThis is the final probability of accepting the proposed move in the Monte Carlo step.", "answer": "$$\\boxed{0.1353}$$", "id": "3425834"}, {"introduction": "The mathematical form of the Metropolis criterion, $a = \\min\\{1, \\exp(-\\beta\\Delta U)\\}$, clearly separates moves that lower energy from those that raise it. However, in code, this logic can be implemented in a more compact and elegant way. This practice problem ([@problem_id:1964945]) challenges you to analyze a common single-line implementation and understand why it correctly and implicitly handles both cases, reinforcing the connection between the algorithm's logic and its computational form.", "problem": "A student, Alex, is writing a Metropolis Monte Carlo simulation for a simple 2D lattice gas model. In this model, particles occupy sites on a grid, and the total energy $E$ of the system is calculated based on the interactions between neighboring particles. The goal of the simulation is to sample configurations from the canonical ensemble at a given temperature $T$.\n\nAlex's simulation proceeds in steps. At each step, a trial move is proposed (e.g., moving a single particle to a random adjacent empty site). Let the energy of the current configuration be $E_{old}$ and the energy of the proposed new configuration be $E_{new}$. The change in energy is $\\Delta E = E_{new} - E_{old}$.\n\nAlex implements the core acceptance/rejection logic with the following line of pseudo-code, where `rand()` is a function that returns a uniformly distributed random floating-point number from the interval $[0, 1)$. The move is accepted if the condition is true.\n\n`if rand()  exp(-ΔE / (k_B * T))`\n\nHere, $k_B$ is the Boltzmann constant. Alex runs the simulation and finds that the system seems to be reaching a reasonable equilibrium state. However, they are concerned because their code does not contain an explicit `if/else` structure to distinguish between moves that increase energy ($\\Delta E  0$) and moves that decrease energy ($\\Delta E \\le 0$), which is how the algorithm was presented in their textbook.\n\nWhich of the following statements provides the most accurate analysis of Alex's implementation?\n\nA. The code is fundamentally flawed because it will never accept moves that lower the system's energy ($\\Delta E \\le 0$).\n\nB. The code is fundamentally flawed because it accepts all proposed moves, regardless of the energy change, preventing the system from reaching thermal equilibrium.\n\nC. The code functions correctly because for any move that lowers the energy ($\\Delta E \\le 0$), the term $\\exp(-\\Delta E / (k_B T))$ evaluates to a value greater than or equal to 1, ensuring the acceptance condition is always met.\n\nD. The code is only correct in the high-temperature limit ($k_B T \\gg |\\Delta E|$), where the exponential term can be approximated as 1, but it fails at low temperatures.\n\nE. The code is fundamentally flawed because it violates the principle of detailed balance by not explicitly handling the case where $\\Delta E \\le 0$ with an acceptance probability of 1.", "solution": "Let $\\beta$ denote the inverse temperature, $\\beta = \\frac{1}{k_{B}T}$. In the Metropolis algorithm with a symmetric proposal distribution, the acceptance probability that ensures sampling from the canonical ensemble and satisfies detailed balance is\n$$\nA(\\Delta E) = \\min\\!\\left(1,\\exp(-\\beta \\Delta E)\\right).\n$$\nAlex’s code accepts the move if a uniform random variate $r \\sim \\text{Uniform}[0,1)$ satisfies\n$$\nr  \\exp(-\\beta \\Delta E).\n$$\nThe acceptance probability realized by this rule is the probability, with respect to $r$, that the event $\\{r  \\exp(-\\beta \\Delta E)\\}$ occurs. Since $r$ is uniform on $[0,1)$,\n$$\nP(\\text{accept}) = \\int_{0}^{1} \\mathbf{1}\\{r  \\exp(-\\beta \\Delta E)\\} \\, dr.\n$$\nThis integral evaluates piecewise, depending on the value of $\\exp(-\\beta \\Delta E)$ relative to $1$:\n\n1) If $\\Delta E \\le 0$, then $-\\beta \\Delta E \\ge 0$, hence\n$$\n\\exp(-\\beta \\Delta E) \\ge 1.\n$$\nBecause $r \\in [0,1)$ and $\\exp(-\\beta \\Delta E) \\ge 1$, the inequality $r  \\exp(-\\beta \\Delta E)$ holds for all $r$ in $[0,1)$. Therefore,\n$$\nP(\\text{accept}) = 1 = \\min\\!\\left(1,\\exp(-\\beta \\Delta E)\\right).\n$$\nIn particular, when $\\Delta E = 0$, $\\exp(0) = 1$ and, since $r  1$ almost surely for $r \\in [0,1)$, acceptance occurs with probability $1$, as required.\n\n2) If $\\Delta E  0$, then $-\\beta \\Delta E  0$, hence\n$$\n\\exp(-\\beta \\Delta E)  1,\n$$\nand the event $\\{r  \\exp(-\\beta \\Delta E)\\}$ occurs with probability exactly $\\exp(-\\beta \\Delta E)$, because the length of the interval $\\{r \\in [0,1) : r  \\exp(-\\beta \\Delta E)\\}$ is $\\exp(-\\beta \\Delta E)$. Thus,\n$$\nP(\\text{accept}) = \\exp(-\\beta \\Delta E) = \\min\\!\\left(1,\\exp(-\\beta \\Delta E)\\right).\n$$\n\nCombining these cases,\n$$\nP(\\text{accept}) = \\min\\!\\left(1,\\exp(-\\beta \\Delta E)\\right),\n$$\nwhich is precisely the Metropolis acceptance rule that enforces detailed balance for a symmetric proposal. Therefore, Alex’s single-line condition implicitly implements the $\\min$ operation because $r$ is restricted to $[0,1)$. It accepts all energy-lowering or equal-energy moves with probability $1$ and accepts energy-increasing moves with probability $\\exp(-\\beta \\Delta E)$. Consequently:\n- It is not the case that energy-lowering moves are rejected (rejects A).\n- It does not accept all moves (rejects B).\n- It is not limited to the high-temperature regime (rejects D).\n- It does not violate detailed balance; the correct acceptance probability is realized (rejects E).\n\nHence, the most accurate statement is that the code functions correctly for all temperatures because $\\exp(-\\Delta E/(k_{B}T)) \\ge 1$ when $\\Delta E \\le 0$, ensuring acceptance, and yields the correct probabilistic acceptance when $\\Delta E  0$.", "answer": "$$\\boxed{C}$$", "id": "1964945"}, {"introduction": "In real-world molecular dynamics simulations, the total potential energy $U$ is often defined with practical approximations like potential truncation and is calculated efficiently using neighbor lists. The Metropolis algorithm's correctness hinges on the exact energy difference $\\Delta U$ being used, and any discrepancy between the calculated $\\Delta U$ and the true change in the target energy function can break detailed balance. This practice problem ([@problem_id:3425828]) delves into these advanced implementation details, forcing you to critically assess how choices like potential shifting and the use of stale neighbor lists can impact the validity of the simulation.", "problem": "Consider a canonical ensemble at temperature $T$ for a $N$-particle system interacting via a radially symmetric pair potential $V(r)$ that is truncated at a finite cutoff $r_{c}$ and shifted to ensure continuity at $r=r_{c}$. Denote the shifted pair potential by $u_{s}(r)$, defined piecewise in terms of $V(r)$ and $r_{c}$, and the total potential energy of a microstate $\\mathbf{x}$ by $U(\\mathbf{x})=\\sum_{ij}u_{s}(r_{ij})$, where $r_{ij}$ is the separation between particles $i$ and $j$. Trial moves are single-particle displacements drawn from a symmetric proposal kernel, and acceptance is determined using a Metropolis-type rule in which the energy difference $\\Delta U=U(\\mathbf{x}')-U(\\mathbf{x})$ is evaluated from local pair interactions collected via a Verlet neighbor list. The neighbor list is updated intermittently and may be stale: when proposing $\\mathbf{x}\\to\\mathbf{x}'$, pairs that were not neighbors in $\\mathbf{x}$ but become neighbors in $\\mathbf{x}'$ might be omitted from the computed $\\Delta U$.\n\nStarting from the principle that the target equilibrium probability density for $\\mathbf{x}$ is proportional to $\\exp\\left(-\\beta U(\\mathbf{x})\\right)$ with $\\beta=1/\\left(k_{\\mathrm{B}}T\\right)$, and the definition of detailed balance for a Markov Chain Monte Carlo (MCMC) transition with proposal density $q(\\mathbf{x}'\\mid \\mathbf{x})$, determine which of the following statements are correct about how the acceptance step should be implemented with truncated and shifted pair potentials and how stale neighbor lists can influence $\\Delta U$ and acceptance.\n\nA. For symmetric proposals, correctness (sampling the intended equilibrium distribution) requires computing the acceptance using the energy difference $\\Delta U$ derived from the same truncated-and-shifted $u_{s}(r)$ and the same cutoff $r_{c}$ that define $U(\\mathbf{x})$; otherwise, the chain targets a different distribution and detailed balance with respect to the intended $U(\\mathbf{x})$ fails.\n\nB. Because the shift at $r_{c}$ is a constant, it cancels from energy differences, so acceptance can be computed with an unshifted truncated potential $u_{t}(r)$ in place of $u_{s}(r)$ without affecting correctness, even when pairs cross the cutoff as a result of a trial move.\n\nC. If the neighbor list is stale and the trial move causes a pair to cross into $rr_{c}$, omitting that interaction in computing $\\Delta U$ produces a systematic bias in the acceptance that violates detailed balance unless compensated; this bias is directional because moves that create previously unlisted neighbors have their $\\Delta U$ underestimated.\n\nD. Using a larger cutoff in acceptance than in the target energy is benign because it merely adds a constant offset to the energy that cancels in $\\Delta U$.\n\nE. In Metropolis–Hastings, it is sufficient that the ratio $q(\\mathbf{x}\\mid \\mathbf{x}')/q(\\mathbf{x}'\\mid \\mathbf{x})$ be included in the acceptance; the energy model used for $\\Delta U$ may differ from the target model $U$ as long as it is applied consistently across moves.\n\nSelect all statements that are correct.", "solution": "The problem asks to evaluate several statements concerning the implementation of the Metropolis acceptance algorithm in a canonical ensemble simulation with specific potential energy features and computational approximations. The correctness of the algorithm hinges on satisfying the detailed balance condition.\n\nThe target equilibrium probability density for a microstate $\\mathbf{x}$ is given as $P_{eq}(\\mathbf{x}) \\propto \\exp(-\\beta U(\\mathbf{x}))$, where $\\beta = 1/(k_{\\mathrm{B}}T)$ and $U(\\mathbf{x})$ is the total potential energy of the system. The detailed balance condition for a Markov chain with proposal probability density $q(\\mathbf{x}' \\mid \\mathbf{x})$ and acceptance probability $\\alpha(\\mathbf{x} \\to \\mathbf{x}')$ is:\n$$ P_{eq}(\\mathbf{x}) q(\\mathbf{x}' \\mid \\mathbf{x}) \\alpha(\\mathbf{x} \\to \\mathbf{x}') = P_{eq}(\\mathbf{x}') q(\\mathbf{x} \\mid \\mathbf{x}') \\alpha(\\mathbf{x}' \\to \\mathbf{x}) $$\nSubstituting the form of $P_{eq}(\\mathbf{x})$ yields:\n$$ \\exp(-\\beta U(\\mathbf{x})) q(\\mathbf{x}' \\mid \\mathbf{x}) \\alpha(\\mathbf{x} \\to \\mathbf{x}') = \\exp(-\\beta U(\\mathbf{x}')) q(\\mathbf{x} \\mid \\mathbf{x}') \\alpha(\\mathbf{x}' \\to \\mathbf{x}) $$\nThis can be rearranged into a condition on the ratio of acceptance probabilities:\n$$ \\frac{\\alpha(\\mathbf{x} \\to \\mathbf{x}')}{\\alpha(\\mathbf{x}' \\to \\mathbf{x})} = \\frac{\\exp(-\\beta U(\\mathbf{x}'))}{\\exp(-\\beta U(\\mathbf{x}))} \\frac{q(\\mathbf{x} \\mid \\mathbf{x}')}{q(\\mathbf{x}' \\mid \\mathbf{x})} = \\exp(-\\beta [U(\\mathbf{x}') - U(\\mathbf{x})]) \\frac{q(\\mathbf{x} \\mid \\mathbf{x}')}{q(\\mathbf{x}' \\mid \\mathbf{x})} $$\nThe problem specifies a symmetric proposal kernel, which means $q(\\mathbf{x}' \\mid \\mathbf{x}) = q(\\mathbf{x} \\mid \\mathbf{x}')$. This simplifies the condition to that of the original Metropolis algorithm:\n$$ \\frac{\\alpha(\\mathbf{x} \\to \\mathbf{x}')}{\\alpha(\\mathbf{x}' \\to \\mathbf{x})} = \\exp(-\\beta \\Delta U) $$\nwhere $\\Delta U = U(\\mathbf{x}') - U(\\mathbf{x})$. The standard choice for the acceptance probability that satisfies this condition and maximizes an efficient exploration of the phase space is:\n$$ \\alpha(\\mathbf{x} \\to \\mathbf{x}') = \\min\\left(1, \\exp(-\\beta \\Delta U)\\right) $$\nA critical and incontrovertible point is that for the Markov chain to converge to the target distribution defined by $P_{eq}(\\mathbf{x}) \\propto \\exp(-\\beta U(\\mathbf{x}))$, the energy difference $\\Delta U$ used in the acceptance probability must be the exact difference $U(\\mathbf{x}') - U(\\mathbf{x})$ calculated using the same energy function $U(\\mathbf{x})$ that defines the target distribution.\n\nNow, we evaluate each statement.\n\n**A. For symmetric proposals, correctness (sampling the intended equilibrium distribution) requires computing the acceptance using the energy difference $\\Delta U$ derived from the same truncated-and-shifted $u_{s}(r)$ and the same cutoff $r_{c}$ that define $U(\\mathbf{x})$; otherwise, the chain targets a different distribution and detailed balance with respect to the intended $U(\\mathbf{x})$ fails.**\n\nThis statement is a direct and precise consequence of the detailed balance principle. The target probability distribution is defined by the energy function $U(\\mathbf{x})$. To satisfy detailed balance with respect to this target distribution, the acceptance probability $\\alpha(\\mathbf{x} \\to \\mathbf{x}')$ must depend on the ratio $P_{eq}(\\mathbf{x}') / P_{eq}(\\mathbf{x}) = \\exp(-\\beta [U(\\mathbf{x}') - U(\\mathbf{x})])$. If any other energy function, say $U'(\\mathbf{x})$, is used to compute the energy difference $\\Delta U' = U'(\\mathbf{x}') - U'(\\mathbf{x})$ for the acceptance step, the resulting Markov chain will satisfy detailed balance with respect to a different distribution, $P'_{eq}(\\mathbf{x}) \\propto \\exp(-\\beta U'(\\mathbf{x}))$, and will therefore sample from this different distribution. To sample correctly from the distribution defined by $U(\\mathbf{x})$, one must use that specific $U(\\mathbf{x})$—which is built from $u_s(r)$ and $r_c$—in the acceptance calculation.\n\n**Verdict: Correct.**\n\n**B. Because the shift at $r_{c}$ is a constant, it cancels from energy differences, so acceptance can be computed with an unshifted truncated potential $u_{t}(r)$ in place of $u_{s}(r)$ without affecting correctness, even when pairs cross the cutoff as a result of a trial move.**\n\nLet's define the potentials explicitly. The truncated potential is $u_t(r) = V(r)$ for $r \\le r_c$ and $u_t(r)=0$ for $r  r_c$. The truncated-and-shifted potential is $u_s(r) = u_t(r) - V(r_c)$ for $r \\le r_c$ and $u_s(r)=0$ for $r  r_c$.\nThe total energies are:\n$U_s(\\mathbf{x}) = \\sum_{ij} u_s(r_{ij}) = \\sum_{ij, r_{ij} \\le r_c} (V(r_{ij}) - V(r_c)) = \\left(\\sum_{ij, r_{ij} \\le r_c} V(r_{ij})\\right) - N_c(\\mathbf{x})V(r_c)$\n$U_t(\\mathbf{x}) = \\sum_{ij} u_t(r_{ij}) = \\sum_{ij, r_{ij} \\le r_c} V(r_{ij})$\nHere, $N_c(\\mathbf{x})$ is the number of particle pairs in configuration $\\mathbf{x}$ with separation $r_{ij} \\le r_c$.\nThe correct energy difference is $\\Delta U_s = U_s(\\mathbf{x}') - U_s(\\mathbf{x})$.\nThe energy difference from the unshifted potential is $\\Delta U_t = U_t(\\mathbf{x}') - U_t(\\mathbf{x})$.\nFrom the definitions, $\\Delta U_s = \\Delta U_t - [N_c(\\mathbf{x}')-N_c(\\mathbf{x})]V(r_c)$.\nThe statement claims that $\\Delta U_s = \\Delta U_t$, which would require the term $[N_c(\\mathbf{x}')-N_c(\\mathbf{x})]V(r_c)$ to be zero. This is only true if $N_c(\\mathbf{x}') = N_c(\\mathbf{x})$, i.e., if the number of pairs within the cutoff radius does not change. However, the statement explicitly considers the case \"when pairs cross the cutoff\", where $N_c$ necessarily changes. In this case, the shift term $V(r_c)$ does not cancel from the energy difference. Using $\\Delta U_t$ instead of $\\Delta U_s$ would mean sampling from a different target distribution defined by $U_t(\\mathbf{x})$.\n\n**Verdict: Incorrect.**\n\n**C. If the neighbor list is stale and the trial move causes a pair to cross into $rr_{c}$, omitting that interaction in computing $\\Delta U$ produces a systematic bias in the acceptance that violates detailed balance unless compensated; this bias is directional because moves that create previously unlisted neighbors have their $\\Delta U$ underestimated.**\n\nA stale neighbor list means that the set of neighbors for a particle is based on an old configuration $\\mathbf{x}_{\\text{old}}$, not the current one $\\mathbf{x}$. When a particle is moved to create state $\\mathbf{x}'$, the energy change is approximated by considering only pairs that were on the neighbor list. A move might bring a new pair of particles $(i,j)$ to a separation $r'_{ij}  r_c$ when their original separation was $r_{ij}  r_{\\text{list}}$, where $r_{\\text{list}}$ is the neighbor list cutoff (typically $r_{\\text{list}}  r_c$).\nThe exact energy change is $\\Delta U_{\\text{exact}} = U(\\mathbf{x}') - U(\\mathbf{x})$. The approximate change, $\\Delta U_{\\text{approx}}$, computed with the stale list, omits the contribution from this new pair. Let this single new pair be $(k,l)$.\n$\\Delta U_{\\text{approx}} = \\Delta U_{\\text{exact}} - (u_s(r'_{kl}) - u_s(r_{kl}))$. Since $r_{kl}  r_c$, $u_s(r_{kl})=0$. So, the error is $\\Delta U_{\\text{exact}} - \\Delta U_{\\text{approx}} = u_s(r'_{kl})$.\nThe use of an approximate energy $\\Delta U_{\\text{approx}} \\ne \\Delta U_{\\text{exact}}$ in the acceptance probability $\\min(1, \\exp(-\\beta\\Delta U_{\\text{approx}}))$ inherently violates the detailed balance condition with respect to the true energy $U(\\mathbf{x})$. This creates a systematic bias, and compensation schemes are indeed required to restore correctness. The first part of the statement is therefore correct.\nThe bias is \"directional\" because the error depends on the direction of the move. A forward move $\\mathbf{x} \\to \\mathbf{x}'$ that creates a new neighbor has its energy change miscalculated. The reverse move $\\mathbf{x}' \\to \\mathbf{x}$ would, in a naive implementation, use the same stale list (based on $\\mathbf{x}$) or, in a slightly better but still flawed implementation, an updated list for $\\mathbf{x}'$. In either case, the error is not symmetric: $\\Delta U_{\\text{approx}}(\\mathbf{x}\\to\\mathbf{x}') \\ne -\\Delta U_{\\text{approx}}(\\mathbf{x}'\\to\\mathbf{x})$. This asymmetry breaks detailed balance.\nThe final clause claims \"$\\Delta U$ is underestimated,\" meaning $\\Delta U_{\\text{approx}}  \\Delta U_{\\text{exact}}$. This is equivalent to the error term $u_s(r'_{kl})$ being positive. For typical potentials like Lennard-Jones, $u_s(r)$ is positive (repulsive) at very short distances and negative (attractive) at intermediate distances. Thus, whether the energy change is underestimated or overestimated depends on the final separation $r'_{kl}$. For moves into the strongly repulsive core, the statement holds. For moves into the attractive well, the energy change is overestimated ($\\Delta U_{\\text{approx}}  \\Delta U_{\\text{exact}}$). While this explanatory clause is not universally true for all possible moves, the primary assertion of the statement is critically important and correct: using a stale neighbor list without compensation introduces a directional bias that violates detailed balance. In the context of typical simulations where avoiding particle overlap is a dominant factor, moves creating new neighbors are often into repulsive regions, making \"underestimation\" a common outcome. Given the fundamental correctness of the main point, the statement is valid.\n\n**Verdict: Correct.**\n\n**D. Using a larger cutoff in acceptance than in the target energy is benign because it merely adds a constant offset to the energy that cancels in $\\Delta U$.**\n\nThis statement suggests we can have a target distribution based on $U(\\mathbf{x})$ with cutoff $r_c$, but use an energy function $U'(\\mathbf{x})$ with cutoff $r'_c  r_c$ for the acceptance step. The justification is that the difference is a constant offset. This is false. The energy contribution from the shell of particles with separations $r_c  r_{ij} \\le r'_c$ is dependent on the configuration $\\mathbf{x}$. It is not a constant.\n$U'(\\mathbf{x}) - U(\\mathbf{x})$ depends on the positions of all particles, so it is not a constant. Therefore, $\\Delta U' - \\Delta U = (U'(\\mathbf{x}') - U(\\mathbf{x}')) - (U'(\\mathbf{x}) - U(\\mathbf{x}))$ is generally non-zero. Using $\\Delta U'$ in the acceptance step is equivalent to targeting a different distribution defined by $U'(\\mathbf{x})$. This fundamentally violates the principle outlined in the analysis of option A.\n\n**Verdict: Incorrect.**\n\n**E. In Metropolis–Hastings, it is sufficient that the ratio $q(\\mathbf{x}\\mid \\mathbf{x}')/q(\\mathbf{x}'\\mid \\mathbf{x})$ be included in the acceptance; the energy model used for $\\Delta U$ may differ from the target model $U$ as long as it is applied consistently across moves.**\n\nThis statement misrepresents the Metropolis-Hastings criterion. The acceptance probability is:\n$$ \\alpha(\\mathbf{x} \\to \\mathbf{x}') = \\min\\left(1, \\frac{P_{eq}(\\mathbf{x}')}{P_{eq}(\\mathbf{x})} \\frac{q(\\mathbf{x}|\\mathbf{x}')}{q(\\mathbf{x}'|\\mathbf{x})}\\right) $$\nThe term $P_{eq}(\\mathbf{x}')/P_{eq}(\\mathbf{x}) = \\exp(-\\beta[U(\\mathbf{x}')-U(\\mathbf{x})])$ explicitly contains the energy function $U(\\mathbf{x})$ that defines the target distribution. The statement suggests we can replace this $U(\\mathbf{x})$ with some other $U'(\\mathbf{x})$. If we do so, the algorithm will indeed be \"consistent\" in the sense that it follows well-defined transition rules. However, it will be consistently sampling from the wrong distribution, $P'_{eq}(\\mathbf{x}) \\propto \\exp(-\\beta U'(\\mathbf{x}))$, not the intended target distribution. To sample a specific target distribution, the energy model used for $\\Delta U$ must be the one defining that target.\n\n**Verdict: Incorrect.**", "answer": "$$\\boxed{AC}$$", "id": "3425828"}]}