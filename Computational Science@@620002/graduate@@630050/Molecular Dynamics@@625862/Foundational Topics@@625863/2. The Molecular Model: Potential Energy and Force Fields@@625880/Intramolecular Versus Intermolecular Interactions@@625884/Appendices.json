{"hands_on_practices": [{"introduction": "The Potential of Mean Force (PMF), $W(q)$, is a central concept in understanding the energetics of complex processes described by a reaction coordinate $q$. The effective force driving the system along this coordinate, the mean force $\\langle F_q \\rangle = - \\mathrm{d}W/\\mathrm{d}q$, includes not only direct forces from the potential energy but also entropic forces arising from the available phase space volume. This exercise provides foundational practice by guiding you through a first-principles derivation of the mean force for both a purely intramolecular coordinate (a dihedral) and a purely intermolecular one (a contact distance), revealing how the PMF differs from the bare potential energy in each case [@problem_id:3418858].", "problem": "Consider a classical canonical ensemble at temperature $T$ with configuration vector $x$ and potential energy $U(x)$. The probability density is $p(x) \\propto \\exp(-\\beta U(x))$ with $\\beta = 1/(k_\\mathrm{B} T)$, where $k_\\mathrm{B}$ is the Boltzmann constant. For a reaction coordinate $q(x)$, the potential of mean force (PMF) $W(q)$ is defined by the constrained partition function $Z(q) = \\int \\mathrm{d}x \\, \\exp(-\\beta U(x)) \\, \\delta(q - q(x))$, via $W(q) = -k_\\mathrm{B} T \\ln Z(q) + C$, where $C$ is an additive constant independent of $q$. The mean force along $q$ is defined by $\\langle F_q \\rangle = - \\mathrm{d}W/\\mathrm{d}q$.\n\nYou will compare intramolecular versus intermolecular contributions by evaluating $\\langle F_q \\rangle$ along two reaction coordinates that are physically decoupled in the following model:\n\n- Intramolecular dihedral coordinate $q_\\mathrm{dihedral} = \\theta \\in [0, 2\\pi)$ with an intramolecular torsion potential $U_\\mathrm{intra}(\\theta) = k_t \\left(1 - \\cos(n \\theta)\\right)$, where $k_t > 0$ and $n \\in \\mathbb{N}$.\n- Intermolecular contact coordinate $q_\\mathrm{contact} = r > 0$ equal to the separation between two point particles interacting via a Lennard–Jones potential $U_\\mathrm{inter}(r) = 4 \\varepsilon \\left[(\\sigma/r)^{12} - (\\sigma/r)^6\\right]$.\n\nAssume the full potential energy is separable as $U(x) = U_\\mathrm{intra}(\\theta) + U_\\mathrm{inter}(r) + U_\\mathrm{other}(\\text{all other independent degrees of freedom})$, and that the remaining degrees of freedom do not couple to $\\theta$ or $r$ beyond the usual metric factors implied by the choice of coordinates. Angles must be expressed in radians. Work in reduced Lennard–Jones units where the unit of length is $\\sigma$, the unit of energy is $\\varepsilon$, and the unit of force is $\\varepsilon/\\sigma$. Set $k_\\mathrm{B} = 1$ in these reduced units.\n\nYour task is to, from first principles, derive expressions that allow computation of the mean force $\\langle F_{q} \\rangle$ along $q_\\mathrm{dihedral}$ and $q_\\mathrm{contact}$ using only the definitions above and standard coordinate-measure considerations. Then, implement a program that evaluates the mean force for each of the following independent test cases:\n\nDihedral-based reaction coordinate cases (intramolecular):\n1. $k_t = 4.0$, $n = 3$, $\\theta = \\pi/6$.\n2. $k_t = 4.0$, $n = 3$, $\\theta = \\pi/3$.\n3. $k_t = 4.0$, $n = 3$, $\\theta = \\pi/2$.\n4. $k_t = 2.5$, $n = 2$, $\\theta = \\pi/4$.\n\nContact-based reaction coordinate cases (intermolecular):\n5. $\\varepsilon = 1.0$, $\\sigma = 1.0$, $T = 1.0$, $r = 2^{1/6} \\, \\sigma$.\n6. $\\varepsilon = 1.0$, $\\sigma = 1.0$, $T = 1.0$, $r = 0.9 \\, \\sigma$.\n7. $\\varepsilon = 1.0$, $\\sigma = 1.0$, $T = 1.0$, $r = 3.0 \\, \\sigma$.\n8. $\\varepsilon = 1.0$, $\\sigma = 1.0$, $T = 0.1$, $r = 3.0 \\, \\sigma$.\n9. $\\varepsilon = 1.0$, $\\sigma = 1.0$, $T = 0.01$, $r = 1.5 \\, \\sigma$.\n\nAll answers must be expressed in reduced Lennard–Jones force units $\\varepsilon/\\sigma$. Your program should produce a single line of output containing the results for the $9$ test cases as a comma-separated list of floats, rounded to six decimal places, enclosed in square brackets (for example, $[a_1,a_2,\\dots,a_9]$). No additional text may be printed.\n\nDesign considerations:\n- Begin from $p(x) \\propto \\exp(-\\beta U(x))$ and the definition of $W(q)$. Do not assume any specialized or black-box formulas not derivable from these bases. Carefully account for the coordinate-space measure when forming $Z(q)$ for the contact coordinate $r$.\n- Ensure your expressions are valid within the stated separability assumptions and that the units are consistent.\n- The program must be self-contained and require no input. It must compute and print the nine results in the exact format specified.", "solution": "The objective is to derive expressions for the mean force, $\\langle F_q \\rangle$, along an intramolecular dihedral coordinate, $q=\\theta$, and an intermolecular contact coordinate, $q=r$, and then to compute these forces for a series of test cases. The derivation will start from the first principles of statistical mechanics as laid out in the problem statement. We will work in reduced Lennard-Jones units, where the characteristic energy $\\varepsilon$, length $\\sigma$, and the Boltzmann constant $k_\\mathrm{B}$ are all set to unity. Consequently, temperature $T$ is in units of $\\varepsilon$, and the parameter $\\beta = 1/(k_\\mathrm{B}T)$ becomes $\\beta=1/T$.\n\nThe mean force along a reaction coordinate $q$ is defined as the negative derivative of the Potential of Mean Force (PMF), $W(q)$:\n$$\n\\langle F_q \\rangle = - \\frac{\\mathrm{d}W}{\\mathrm{d}q}\n$$\nThe PMF is defined via the constrained partition function, $Z(q)$, as:\n$$\nW(q) = -k_\\mathrm{B} T \\ln Z(q) + C = -T \\ln Z(q) + C\n$$\nwhere $C$ is a constant and $Z(q) = \\int \\mathrm{d}x \\, \\exp(-\\beta U(x)) \\, \\delta(q - q(x))$. The integral is over the entire configuration space $x$. The key to solving the problem is to evaluate $Z(q)$ for each coordinate type by properly accounting for the potential energy separability and the integration measure.\n\n### Case 1: Intramolecular Dihedral Coordinate ($q_\\mathrm{dihedral} = \\theta$)\n\nFor the intramolecular case, the reaction coordinate is the dihedral angle $\\theta$. The potential energy is given as separable:\n$$\nU(x) = U_\\mathrm{intra}(\\theta) + U_\\mathrm{rest}(y)\n$$\nwhere $y$ represents all other degrees of freedom (including the intermolecular distance $r$ and others), and $U_\\mathrm{rest}(y) = U_\\mathrm{inter}(r) + U_\\mathrm{other}(\\dots)$. The problem states that other degrees of freedom are independent, which implies that the integration measure (the Jacobian determinant) is also separable. For a dihedral angle as a generalized coordinate, the corresponding metric tensor component is typically constant. Thus, the volume element can be written as $\\mathrm{d}x = c \\cdot \\mathrm{d}\\theta \\mathrm{d}y$, where $c$ is a constant.\n\nThe constrained partition function $Z(\\theta')$ for a specific value of the dihedral angle $\\theta'$ is:\n$$\nZ(\\theta') = \\int c_1 \\mathrm{d}\\theta \\mathrm{d}y \\, e^{-\\beta (U_\\mathrm{intra}(\\theta) + U_\\mathrm{rest}(y))} \\, \\delta(\\theta'-\\theta)\n$$\nPerforming the integration over $\\theta$ using the property of the Dirac delta function, we get:\n$$\nZ(\\theta') = c_1 \\int \\mathrm{d}y \\, e^{-\\beta (U_\\mathrm{intra}(\\theta') + U_\\mathrm{rest}(y))} = c_1 e^{-\\beta U_\\mathrm{intra}(\\theta')} \\int \\mathrm{d}y \\, e^{-\\beta U_\\mathrm{rest}(y)}\n$$\nThe remaining integral, $Z_\\mathrm{rest} = \\int \\mathrm{d}y \\, e^{-\\beta U_\\mathrm{rest}(y)}$, is a constant with respect to $\\theta'$. Therefore, $Z(\\theta')$ is proportional to the Boltzmann factor of the intramolecular potential itself:\n$$\nZ(\\theta') = C_1 e^{-\\beta U_\\mathrm{intra}(\\theta')}\n$$\nwhere $C_1$ is a constant. The PMF is then:\n$$\nW(\\theta') = -T \\ln(C_1 e^{-\\beta U_\\mathrm{intra}(\\theta')}) + C = -T \\ln(C_1) -T(-\\beta U_\\mathrm{intra}(\\theta')) + C = U_\\mathrm{intra}(\\theta') + C_2\n$$\nwhere $C_2$ is another constant. This shows that when a degree of freedom is fully decoupled, its PMF is identical to its potential energy, up to an additive constant.\n\nThe mean force (in this case, a mean torque) is:\n$$\n\\langle F_\\theta \\rangle = -\\frac{\\mathrm{d}W}{\\mathrm{d}\\theta} = -\\frac{\\mathrm{d}}{\\mathrm{d}\\theta} (U_\\mathrm{intra}(\\theta) + C_2) = -\\frac{\\mathrm{d}U_\\mathrm{intra}}{\\mathrm{d}\\theta}\n$$\nGiven the form of the dihedral potential, $U_\\mathrm{intra}(\\theta) = k_t (1 - \\cos(n \\theta))$, the derivative is:\n$$\n\\frac{\\mathrm{d}U_\\mathrm{intra}}{\\mathrm{d}\\theta} = k_t (n \\sin(n \\theta))\n$$\nThus, the expression for the mean torque is:\n$$\n\\langle F_\\theta \\rangle = -n k_t \\sin(n \\theta)\n$$\nThis quantity has units of energy. The problem requests the answer in units of force, $\\varepsilon/\\sigma$. In reduced units where $\\sigma=1$, the unit of force becomes numerically equal to the unit of energy. Therefore, we report the numerical value of the torque calculated in reduced energy units.\n\n### Case 2: Intermolecular Contact Coordinate ($q_\\mathrm{contact} = r$)\n\nFor the intermolecular case, the reaction coordinate $q$ is the separation distance $r$ between two particles. The potential energy is separable: $U(x) = U_\\mathrm{inter}(r) + U_\\mathrm{rest}(y)$, where $y$ now includes the dihedral angle $\\theta$ and other degrees of freedom.\nThe constrained partition function for a specific distance $r'$ is:\n$$\nZ(r') = \\int \\mathrm{d}x \\, e^{-\\beta (U_\\mathrm{inter}(r(x)) + U_\\mathrm{rest}(y))} \\, \\delta(r' - r(x))\n$$\nFactoring out the integral over the rest coordinates, we get:\n$$\nZ(r') = C_3 \\int_{\\text{pair}} e^{-\\beta U_\\mathrm{inter}(r)} \\, \\delta(r' - r)\n$$\nwhere the integral is over the degrees of freedom of the interacting pair. Let their positions be $\\mathbf{r}_1$ and $\\mathbf{r}_2$. The configuration element is $\\mathrm{d}\\mathbf{r}_1 \\mathrm{d}\\mathbf{r}_2$. We change to center-of-mass $\\mathbf{R} = (\\mathbf{r}_1 + \\mathbf{r}_2)/2$ and relative $\\mathbf{r} = \\mathbf{r}_1 - \\mathbf{r}_2$ coordinates. The integration element becomes $\\mathrm{d}\\mathbf{R} \\mathrm{d}\\mathbf{r}$. The potential $U_\\mathrm{inter}$ only depends on the magnitude $r = |\\mathbf{r}|$. The integral over $\\mathbf{R}$ gives the system volume $V$, another constant. We are left with the integral over the relative coordinate $\\mathbf{r}$:\n$$\nZ(r') \\propto \\int \\mathrm{d}\\mathbf{r} \\, e^{-\\beta U_\\mathrm{inter}(r)} \\, \\delta(r' - r)\n$$\nTo evaluate this, we switch to spherical coordinates for $\\mathbf{r}$. The volume element is $\\mathrm{d}\\mathbf{r} = r^2 \\sin\\phi \\, \\mathrm{d}r \\mathrm{d}\\phi \\mathrm{d}\\psi$. This Jacobian factor $r^2$ is the crucial \"coordinate-space measure\" referenced in the problem.\n$$\nZ(r') \\propto \\int_0^{2\\pi} \\mathrm{d}\\psi \\int_0^\\pi \\mathrm{d}\\phi \\, \\sin\\phi \\int_0^\\infty \\mathrm{d}r \\, r^2 e^{-\\beta U_\\mathrm{inter}(r)} \\, \\delta(r' - r)\n$$\nThe angular integrals yield $4\\pi$. The radial integral is solved by the delta function:\n$$\nZ(r') \\propto 4\\pi (r')^2 e^{-\\beta U_\\mathrm{inter}(r')}\n$$\nThe PMF $W(r')$ is then:\n$$\nW(r') = -T \\ln(Z(r')) + C = -T \\ln(C_4 (r')^2 e^{-\\beta U_\\mathrm{inter}(r')}) + C = U_\\mathrm{inter}(r') - 2T \\ln(r') + C_5\n$$\nThe PMF is the sum of the direct potential energy $U_\\mathrm{inter}(r')$ and an entropic term $-2T\\ln(r')$, which arises because the volume of phase space available in a spherical shell of radius $r'$ and thickness $\\mathrm{d}r$ is proportional to $4\\pi (r')^2 \\mathrm{d}r$.\n\nThe mean force is the negative derivative of the PMF with respect to $r$:\n$$\n\\langle F_r \\rangle = -\\frac{\\mathrm{d}W}{\\mathrm{d}r} = -\\frac{\\mathrm{d}U_\\mathrm{inter}}{\\mathrm{d}r} - \\frac{\\mathrm{d}}{\\mathrm{d}r}(-2T\\ln(r)) = -\\frac{\\mathrm{d}U_\\mathrm{inter}}{\\mathrm{d}r} + \\frac{2T}{r}\n$$\nThe first term is the direct force from the Lennard-Jones potential. For $U_\\mathrm{inter}(r) = 4\\varepsilon [(\\sigma/r)^{12} - (\\sigma/r)^6]$, its negative derivative in reduced units ($\\varepsilon=1, \\sigma=1$) is $F_\\mathrm{direct} = 24(2r^{-13} - r^{-7})$. The total mean force is:\n$$\n\\langle F_r \\rangle = 24(2r^{-13} - r^{-7}) + \\frac{2T}{r}\n$$\nThis expression is in the correct units of force, $\\varepsilon/\\sigma$.\n\n### Implementation\nThe provided Python code implements these two derived formulas. For the intramolecular cases (1-4), it computes $\\langle F_\\theta \\rangle = -n k_t \\sin(n\\theta)$. For the intermolecular cases (5-9), it computes $\\langle F_r \\rangle = 24(2r^{-13} - r^{-7}) + 2T/r$ using the given parameters in reduced units. The results for all nine cases are collected and printed in the specified format, rounded to six decimal places.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates the mean force for 9 test cases, based on derived formulas for\n    intramolecular (dihedral) and intermolecular (contact) reaction coordinates.\n    \"\"\"\n\n    # Test cases are defined as tuples. The first element is a string identifier.\n    # For 'dihedral': (kt, n, theta_rad)\n    # For 'contact': (T, r)\n    test_cases = [\n        ('dihedral', (4.0, 3, np.pi/6)),\n        ('dihedral', (4.0, 3, np.pi/3)),\n        ('dihedral', (4.0, 3, np.pi/2)),\n        ('dihedral', (2.5, 2, np.pi/4)),\n        ('contact', (1.0, 2**(1/6))),\n        ('contact', (1.0, 0.9)),\n        ('contact', (1.0, 3.0)),\n        ('contact', (0.1, 3.0)),\n        ('contact', (0.01, 1.5)),\n    ]\n\n    results = []\n    \n    for case_type, params in test_cases:\n        if case_type == 'dihedral':\n            # Mean force (torque) for a dihedral potential U = kt * (1 - cos(n*theta))\n            # <F_theta> = -dU/dtheta = -n * kt * sin(n*theta)\n            # The result is a torque (energy units), but in reduced units with sigma=1,\n            # the numerical value is the same as for force units (energy/sigma).\n            kt, n, theta = params\n            mean_force = -n * kt * np.sin(n * theta)\n            results.append(mean_force)\n        \n        elif case_type == 'contact':\n            # Mean force for a Lennard-Jones contact distance r.\n            # W(r) = U_LJ(r) - 2*T*ln(r) + const.\n            # <F_r> = -dW/dr = -dU_LJ/dr + 2*T/r\n            # In reduced units (epsilon=1, sigma=1):\n            # U_LJ(r) = 4 * (r**-12 - r**-6)\n            # -dU_LJ/dr = 24 * (2*r**-13 - r**-7)\n            T, r = params\n            direct_force = 24.0 * (2.0 * r**-13 - r**-7)\n            entropic_force = 2.0 * T / r\n            mean_force = direct_force + entropic_force\n            results.append(mean_force)\n\n    # Format the output string as a list of floats with 6 decimal places.\n    # The f-string formatting {x:.6f} handles rounding correctly.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3418858"}, {"introduction": "While mean forces provide a local picture of a reaction pathway, computing the overall free energy difference, $\\Delta G$, between two states offers a global thermodynamic perspective. Thermodynamic integration (TI) is a powerful and widely used method to compute such free energy differences by integrating the ensemble-averaged force along an alchemical path that connects the states. This practice offers a hands-on implementation of the TI method for a simplified model, allowing you to calculate how the free energy of a system changes in response to the alchemical scaling of an intramolecular torsional potential, thereby connecting microscopic interactions to macroscopic thermodynamics [@problem_id:3418890].", "problem": "Consider a one-dimensional coarse-grained model of a solvated molecule with a single torsional degree of freedom represented by an angle $\\phi \\in [0,2\\pi)$ (in radians). The total potential energy consists of an intramolecular torsional term and an intermolecular solvent-coupling term. For an alchemical coupling parameter $\\lambda \\in [0,1]$, the total potential energy is\n$$\nU(\\phi;\\lambda) \\;=\\; U_{\\mathrm{intra}}(\\phi;\\lambda) \\;+\\; U_{\\mathrm{inter}}(\\phi),\n$$\nwhere\n$$\nU_{\\mathrm{intra}}(\\phi;\\lambda) \\;=\\; \\lambda\\,K\\,\\big(1-\\cos(p\\,\\phi)\\big), \\quad\nU_{\\mathrm{inter}}(\\phi) \\;=\\; B\\,\\big(1-\\cos(q\\,\\phi - \\phi_0)\\big).\n$$\nHere $K$ and $B$ are amplitudes in kilojoules per mole, $p$ and $q$ are positive integers (torsional periodicities), and $\\phi_0$ is a phase offset in radians. The system is sampled in the canonical ensemble at absolute temperature $T$ (in kelvin). Using the canonical distribution as the fundamental base, the ensemble average at fixed $\\lambda$ of any integrable function $g(\\phi)$ is defined by\n$$\n\\langle g \\rangle_{\\lambda} \\;=\\; \\frac{\\displaystyle \\int_{0}^{2\\pi} g(\\phi) \\exp\\!\\big(-\\beta\\,U(\\phi;\\lambda)\\big)\\,d\\phi}{\\displaystyle \\int_{0}^{2\\pi} \\exp\\!\\big(-\\beta\\,U(\\phi;\\lambda)\\big)\\,d\\phi},\n$$\nwith $\\beta = 1/(R\\,T)$, where $R$ is the molar gas constant in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$. The sensitivity of the solvation free energy with respect to the scaling of the single intramolecular term is given by the thermodynamic integration identity\n$$\n\\Delta G \\;=\\; \\int_{0}^{1} \\Big\\langle \\frac{\\partial U(\\phi;\\lambda)}{\\partial \\lambda} \\Big\\rangle_{\\lambda}\\, d\\lambda.\n$$\nIn this model, $\\partial U/\\partial \\lambda = K\\,(1-\\cos(p\\,\\phi))$.\n\nYour task is to write a complete program that, for each test case below, computes the value of $\\Delta G$ in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$ by evaluating the ensemble average over $\\phi$ at fixed $\\lambda$ and then integrating over $\\lambda$ from $0$ to $1$. Angles must be treated in radians. You must not assume any closed-form expressions; evaluate the angular integral and the $\\lambda$-integral numerically with sufficient accuracy to produce stable results. You must use the canonical ensemble definition above with $\\beta = 1/(R\\,T)$ and $R = 0.00831446261815324$ in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}\\,\\mathrm{K}^{-1}$. To maintain numerical stability, you may apply mathematically neutral transformations such as adding and subtracting a $\\lambda$-dependent constant in the exponential, provided that ensemble averages remain unchanged.\n\nTest suite (each case is a tuple $\\big(K, p, B, q, \\phi_0, T\\big)$ with $K$ and $B$ in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$, $\\phi_0$ in radians, $T$ in $\\mathrm{K}$):\n- Case $\\mathrm{A}$: $\\big(5.0,\\,3,\\,2.0,\\,1,\\,0.0,\\,300.0\\big)$.\n- Case $\\mathrm{B}$: $\\big(8.0,\\,3,\\,0.0,\\,1,\\,0.0,\\,300.0\\big)$.\n- Case $\\mathrm{C}$: $\\big(3.0,\\,1,\\,6.0,\\,2,\\,1.0471975511965976,\\,600.0\\big)$, where $\\phi_0 = \\pi/3$.\n- Case $\\mathrm{D}$: $\\big(10.0,\\,2,\\,4.0,\\,3,\\,1.5707963267948966,\\,5000.0\\big)$, where $\\phi_0 = \\pi/2$.\n\nRequirements:\n- Compute $\\Delta G$ in $\\mathrm{kJ}\\,\\mathrm{mol}^{-1}$ and report each result as a floating-point number.\n- Use radians for all angular quantities.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $\\big[\\text{result}_{\\mathrm{A}},\\text{result}_{\\mathrm{B}},\\text{result}_{\\mathrm{C}},\\text{result}_{\\mathrm{D}}\\big]$).\n- The numerical method you implement must be accurate enough that refining quadrature resolutions further would not change any printed value in its first $6$ decimal places for these test cases.\n\nYour program must not read any input. It must compute and print the results for the four test cases above in the exact output format specified.", "solution": "The problem is valid as it is scientifically grounded in the principles of statistical mechanics, well-posed, objective, and contains all necessary information for a numerical solution. We proceed to solve it.\n\nThe objective is to compute the free energy difference, $\\Delta G$, associated with scaling an intramolecular potential term. This is given by the thermodynamic integration (TI) formula:\n$$\n\\Delta G \\;=\\; \\int_{0}^{1} \\Big\\langle \\frac{\\partial U(\\phi;\\lambda)}{\\partial \\lambda} \\Big\\rangle_{\\lambda}\\, d\\lambda\n$$\nwhere the ensemble average $\\langle \\cdot \\rangle_{\\lambda}$ is taken in the canonical ensemble at a fixed alchemical coupling parameter $\\lambda$. The calculation involves a nested integration. The outer integral is over $\\lambda \\in [0, 1]$, and its integrand is the ensemble average $\\langle \\frac{\\partial U}{\\partial \\lambda} \\rangle_{\\lambda}$.\n\nThe ensemble average of a function $g(\\phi)$ is defined as:\n$$\n\\langle g \\rangle_{\\lambda} \\;=\\; \\frac{\\displaystyle \\int_{0}^{2\\pi} g(\\phi) \\exp\\!\\big(-\\beta\\,U(\\phi;\\lambda)\\big)\\,d\\phi}{\\displaystyle \\int_{0}^{2\\pi} \\exp\\!\\big(-\\beta\\,U(\\phi;\\lambda)\\big)\\,d\\phi}\n$$\nIn our case, the function to be averaged is $g(\\phi) = \\frac{\\partial U}{\\partial \\lambda} = K\\,\\big(1-\\cos(p\\,\\phi)\\big)$. The potential energy is $U(\\phi;\\lambda) = \\lambda\\,K\\,\\big(1-\\cos(p\\,\\phi)\\big) + B\\,\\big(1-\\cos(q\\,\\phi - \\phi_0)\\big)$, and $\\beta = 1/(R\\,T)$.\n\nThe calculation of $\\Delta G$ is thus a two-level numerical quadrature problem.\n1.  **Inner Integration (Ensemble Average):** For any given value of $\\lambda$ provided by the outer integration routine, we must compute the ensemble average $\\langle \\frac{\\partial U}{\\partial \\lambda} \\rangle_{\\lambda}$. This itself requires computing two definite integrals over the torsional angle $\\phi$ from $0$ to $2\\pi$:\n    $$\n    \\text{Numerator}(\\lambda) \\;=\\; \\int_{0}^{2\\pi} K\\,\\big(1-\\cos(p\\,\\phi)\\big) \\exp\\!\\big(-\\beta\\,U(\\phi;\\lambda)\\big)\\,d\\phi\n    $$\n    $$\n    \\text{Denominator}(\\lambda) \\;=\\; \\int_{0}^{2\\pi} \\exp\\!\\big(-\\beta\\,U(\\phi;\\lambda)\\big)\\,d\\phi\n    $$\n    The average is then the ratio $\\text{Numerator}(\\lambda) / \\text{Denominator}(\\lambda)$.\n\n2.  **Outer Integration (Thermodynamic Integral):** The resulting ensemble average, which is a function of $\\lambda$, is then integrated over the interval $\\lambda \\in [0, 1]$ to obtain $\\Delta G$.\n\nA significant numerical challenge in this calculation is the presence of the Boltzmann factor, $\\exp(-\\beta U)$. If the energy barrier $\\beta U$ is large and positive, this term can lead to numerical underflow (becoming zero to machine precision). Conversely, if $\\beta U$ is large and negative, it can cause overflow. To ensure numerical stability, we exploit the property that an ensemble average is invariant to shifting the potential energy by a constant value $C$.\n$$\n\\langle g \\rangle_{\\lambda} \\;=\\; \\frac{\\displaystyle \\int g(\\phi) \\exp(-\\beta(U(\\phi;\\lambda) - C))\\,d\\phi}{\\displaystyle \\int \\exp(-\\beta(U(\\phi;\\lambda) - C))\\,d\\phi}\n$$\nThe factor $\\exp(\\beta C)$ added to both the numerator and denominator integrals cancels out. We strategically choose $C$ for each $\\lambda$ to be the minimum value of a given potential energy surface, $C = U_{\\min}(\\lambda) = \\min_{\\phi \\in [0,2\\pi)} U(\\phi;\\lambda)$. This transforms the argument of the exponential to $-\\beta(U(\\phi;\\lambda) - U_{\\min}(\\lambda))$, which is always non-positive. The maximum value of the exponential term is thereby clamped at $1$, preventing overflow and improving the numerical conditioning of the integrals by mitigating underflow. For each evaluation of the ensemble average at a fixed $\\lambda$, $U_{\\min}(\\lambda)$ is determined by sampling $U(\\phi;\\lambda)$ over a fine grid of $\\phi$ values.\n\nThe numerical integrations are performed using the `scipy.integrate.quad` function, a robust adaptive quadrature routine based on the QUADPACK library. To meet the stringent accuracy requirement specified in the problem, we set conservative error tolerances for the quadrature calls. The overall algorithm is implemented in a Python program that defines a primary function to manage the calculation for each test case. This function orchestrates the nested integration by defining helper functions that represent the integrands at each level, using lexical closures to manage the state (parameters and the value of $\\lambda$) for each computation.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Computes and prints the free energy difference Delta G for the specified test cases.\n    \"\"\"\n    # Molar gas constant in kJ mol^-1 K^-1\n    R_KJ_MOL_K = 0.00831446261815324\n\n    # The high-precision quadrature settings required to meet the problem's stability criteria.\n    QUAD_TOL_ABS = 1e-12\n    QUAD_TOL_REL = 1e-12\n\n    def calculate_delta_g(K, p, B, q, phi0, T):\n        \"\"\"\n        Calculates Delta G for a single set of parameters via thermodynamic integration.\n\n        This involves a nested numerical integration: an outer integral over lambda\n        and inner integrals over phi to compute the ensemble average.\n        \"\"\"\n        beta = 1.0 / (R_KJ_MOL_K * T)\n        p, q = int(p), int(q)  # Ensure periodicities are integers\n\n        def average_du_dlambda(lam):\n            \"\"\"\n            Computes the ensemble average <dU/dlambda> for a fixed lambda.\n            This function serves as the integrand for the outer integral over lambda.\n            \"\"\"\n            \n            # Define the total potential energy for the current fixed lambda.\n            def u_total(phi):\n                u_intra = lam * K * (1.0 - np.cos(p * phi))\n                u_inter = B * (1.0 - np.cos(q * phi - phi0))\n                return u_intra + u_inter\n\n            # For numerical stability, find the minimum of the potential energy.\n            # Subtracting this minimum inside the Boltzmann factor exponential\n            # prevents overflow and mitigates underflow.\n            # A dense grid is used to find a good approximation of the minimum.\n            phi_grid = np.linspace(0, 2 * np.pi, 4096, endpoint=False)\n            u_min = np.min(u_total(phi_grid))\n\n            # Define the integrands for the integrals over phi.\n            def numerator_integrand(phi):\n                # Integrand is (dU/dlambda) * exp(-beta * U)\n                dU_dlam = K * (1.0 - np.cos(p * phi))\n                energy_term = u_total(phi)\n                return dU_dlam * np.exp(-beta * (energy_term - u_min))\n\n            def denominator_integrand(phi):\n                # Integrand is exp(-beta * U)\n                energy_term = u_total(phi)\n                return np.exp(-beta * (energy_term - u_min))\n\n            # Compute the numerator and denominator integrals over phi.\n            num_integral, _ = quad(\n                numerator_integrand, 0, 2 * np.pi, \n                epsabs=QUAD_TOL_ABS, epsrel=QUAD_TOL_REL\n            )\n            den_integral, _ = quad(\n                denominator_integrand, 0, 2 * np.pi, \n                epsabs=QUAD_TOL_ABS, epsrel=QUAD_TOL_REL\n            )\n            \n            # The denominator should always be positive. A zero value implies\n            # numerical failure, likely underflow across the whole domain.\n            if den_integral == 0.0:\n                # In the limit of extreme potentials (beta -> inf), the average\n                # collapses to the value of the function at the potential minimum.\n                phi_at_min = phi_grid[np.argmin(u_total(phi_grid))]\n                return K * (1.0 - np.cos(p * phi_at_min))\n            \n            return num_integral / den_integral\n\n        # Perform the outer integration over lambda from 0 to 1.\n        delta_g, _ = quad(\n            average_du_dlambda, 0, 1, \n            epsabs=QUAD_TOL_ABS, epsrel=QUAD_TOL_REL\n        )\n        return delta_g\n\n    # Test suite from the problem statement.\n    # Each case is a tuple (K, p, B, q, phi0, T).\n    test_cases = [\n        (5.0, 3, 2.0, 1, 0.0, 300.0),                               # Case A\n        (8.0, 3, 0.0, 1, 0.0, 300.0),                               # Case B\n        (3.0, 1, 6.0, 2, 1.0471975511965976, 600.0),                # Case C (phi0=pi/3)\n        (10.0, 2, 4.0, 3, 1.5707963267948966, 5000.0)               # Case D (phi0=pi/2)\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_delta_g(*case)\n        results.append(result)\n\n    # Print the results in the specified single-line format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3418890"}, {"introduction": "According to the fluctuation-dissipation theorem, macroscopic thermodynamic response functions are directly related to the statistical fluctuations of microscopic quantities at equilibrium. For example, the constant-volume heat capacity, $C_V$, is proportional to the variance of the total energy. This exercise delves into the statistical analysis of these fluctuations by using a surrogate model to decompose the total heat capacity into distinct intramolecular, intermolecular, and cross-correlation components. This practice develops essential skills for analyzing real simulation data to understand how different parts of a system contribute to its overall thermodynamic properties [@problem_id:3418835].", "problem": "Consider a canonical-ensemble Molecular Dynamics (MD) experiment in the constant Number, Volume, and Temperature (NVT) ensemble, where the total potential energy is decomposed as $U = U_{\\mathrm{intra}} + U_{\\mathrm{inter}}$. The configurational contribution to the heat capacity at constant volume is obtained from potential energy fluctuations via the widely accepted canonical fluctuation relation $C_V^{\\mathrm{conf}} = \\left(\\langle U^2 \\rangle - \\langle U \\rangle^2\\right) / \\left(k_B T^2\\right)$, where $k_B$ is the Boltzmann constant and $T$ is the absolute temperature. Your task is to design a computational experiment that, using a statistically grounded surrogate for MD fluctuations, attributes $C_V^{\\mathrm{conf}}$ to intramolecular and intermolecular components, and explores how a solvent polarity parameter shifts this partition.\n\nYou must implement a program that constructs a Gaussian surrogate for the joint fluctuations of $U_{\\mathrm{intra}}$ and $U_{\\mathrm{inter}}$, motivated by the Central Limit Theorem and the near-harmonic character of small-amplitude fluctuations near equilibrium. Specifically, assume:\n- $U_{\\mathrm{intra}}$ arises from $N_{\\mathrm{intra}}$ independent quadratic (harmonic) intramolecular modes at temperature $T$. This implies a variance scaling consistent with quadratic degrees of freedom.\n- $U_{\\mathrm{inter}}$ arises from $N_{\\mathrm{inter}}$ effective intermolecular modes whose fluctuation amplitude depends on a dimensionless solvent polarity parameter $p$, capturing the strengthening of polar interactions. Introduce a dimensionless amplitude factor $\\beta(p)$ and a dimensionless cross-coupling $\\gamma(p)$ that modulates the covariance between $U_{\\mathrm{intra}}$ and $U_{\\mathrm{inter}}$.\n\nDefine the following for the surrogate:\n- The Boltzmann constant is $k_B = 1.380649 \\times 10^{-23}\\ \\mathrm{J}\\ \\mathrm{K}^{-1}$.\n- The variance of intramolecular fluctuations is $\\mathrm{Var}\\!\\left(U_{\\mathrm{intra}}\\right) = N_{\\mathrm{intra}} \\left(k_B^2 T^2\\right) / 2$.\n- The variance of intermolecular fluctuations is $\\mathrm{Var}\\!\\left(U_{\\mathrm{inter}}\\right) = \\beta(p)\\, N_{\\mathrm{inter}} \\left(k_B^2 T^2\\right) / 2$, where $\\beta(p) = 1 + b_1 p$ with $b_1 = 0.5$.\n- The covariance is $\\mathrm{Cov}\\!\\left(U_{\\mathrm{intra}}, U_{\\mathrm{inter}}\\right) = \\gamma(p)\\, \\sqrt{\\mathrm{Var}\\!\\left(U_{\\mathrm{intra}}\\right)\\, \\mathrm{Var}\\!\\left(U_{\\mathrm{inter}}\\right)}$, where $\\gamma(p) = c_0 \\tanh(p)$ with $c_0 = 0.5$. This choice ensures a positive semidefinite covariance matrix for all $p \\ge 0$.\n\nGenerate $N$ samples of the bivariate fluctuation vector $\\left(U_{\\mathrm{intra}}, U_{\\mathrm{inter}}\\right)$ from a zero-mean multivariate normal distribution with covariance matrix determined by the above variances and covariance, where $N = 100000$. For any case where $\\mathrm{Var}\\!\\left(U_{\\mathrm{inter}}\\right) = 0$, treat $U_{\\mathrm{inter}}$ as identically zero and sample $U_{\\mathrm{intra}}$ from a univariate normal distribution with the specified variance.\n\nFor each test case, compute and report the following quantities, all expressed in joules per kelvin ($\\mathrm{J}\\ \\mathrm{K}^{-1}$):\n- $C_{\\mathrm{intra}} = \\mathrm{Var}\\!\\left(U_{\\mathrm{intra}}\\right) / \\left(k_B T^2\\right)$,\n- $C_{\\mathrm{inter}} = \\mathrm{Var}\\!\\left(U_{\\mathrm{inter}}\\right) / \\left(k_B T^2\\right)$,\n- $C_{\\mathrm{cross}} = 2\\, \\mathrm{Cov}\\!\\left(U_{\\mathrm{intra}}, U_{\\mathrm{inter}}\\right) / \\left(k_B T^2\\right)$,\n- $C_{\\mathrm{total}} = \\left(\\langle U^2 \\rangle - \\langle U \\rangle^2\\right) / \\left(k_B T^2\\right)$, with $U = U_{\\mathrm{intra}} + U_{\\mathrm{inter}}$.\n\nYour program must implement the above construction and compute the four quantities using empirical moments from the generated samples, not closed-form expressions. Use a fixed random seed for reproducibility. Express all outputs in scientific notation with $6$ significant digits.\n\nTest Suite:\n- Case $1$: $T = 300\\ \\mathrm{K}$, $N_{\\mathrm{intra}} = 9$, $N_{\\mathrm{inter}} = 12$, $p = 0.2$.\n- Case $2$: $T = 300\\ \\mathrm{K}$, $N_{\\mathrm{intra}} = 9$, $N_{\\mathrm{inter}} = 12$, $p = 1.0$.\n- Case $3$: $T = 300\\ \\mathrm{K}$, $N_{\\mathrm{intra}} = 9$, $N_{\\mathrm{inter}} = 0$, $p = 0.5$.\n- Case $4$: $T = 600\\ \\mathrm{K}$, $N_{\\mathrm{intra}} = 9$, $N_{\\mathrm{inter}} = 12$, $p = 0.2$.\n- Case $5$: $T = 300\\ \\mathrm{K}$, $N_{\\mathrm{intra}} = 9$, $N_{\\mathrm{inter}} = 12$, $p = 5.0$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is an inner list $[C_{\\mathrm{intra}}, C_{\\mathrm{inter}}, C_{\\mathrm{cross}}, C_{\\mathrm{total}}]$ for the corresponding test case, expressed in $\\mathrm{J}\\ \\mathrm{K}^{-1}$ in scientific notation with $6$ significant digits. For example, the outer list should look like $[[\\cdots],[\\cdots],\\ldots]$ with no additional text before or after.", "solution": "The problem requires the design and implementation of a computational experiment to partition the configurational heat capacity at constant volume, $C_V^{\\mathrm{conf}}$, into components arising from intramolecular and intermolecular potential energy fluctuations. The core of the problem lies in statistical mechanics, specifically the fluctuation-dissipation theorem, which relates thermodynamic response functions (like heat capacity) to the statistical fluctuations of microscopic quantities (like energy) in thermal equilibrium.\n\nThe fundamental relationship in the canonical ($NVT$) ensemble is:\n$$\nC_V^{\\mathrm{conf}} = \\frac{\\langle U^2 \\rangle - \\langle U \\rangle^2}{k_B T^2} = \\frac{\\mathrm{Var}(U)}{k_B T^2}\n$$\nwhere $U$ is the total potential energy, $k_B$ is the Boltzmann constant ($1.380649 \\times 10^{-23}\\ \\mathrm{J}\\ \\mathrm{K}^{-1}$), $T$ is the absolute temperature, and $\\mathrm{Var}(U)$ is the variance of the potential energy.\n\nThe total potential energy is decomposed into intramolecular and intermolecular contributions, $U = U_{\\mathrm{intra}} + U_{\\mathrm{inter}}$. Using the properties of variance, the variance of the total energy can be expanded as:\n$$\n\\mathrm{Var}(U) = \\mathrm{Var}(U_{\\mathrm{intra}} + U_{\\mathrm{inter}}) = \\mathrm{Var}(U_{\\mathrm{intra}}) + \\mathrm{Var}(U_{\\mathrm{inter}}) + 2 \\mathrm{Cov}(U_{\\mathrm{intra}}, U_{\\mathrm{inter}})\n$$\nSubstituting this decomposition into the expression for $C_V^{\\mathrm{conf}}$ yields a partition of the heat capacity:\n$$\nC_V^{\\mathrm{conf}} = \\frac{\\mathrm{Var}(U_{\\mathrm{intra}})}{k_B T^2} + \\frac{\\mathrm{Var}(U_{\\mathrm{inter}})}{k_B T^2} + \\frac{2 \\mathrm{Cov}(U_{\\mathrm{intra}}, U_{\\mathrm{inter}})}{k_B T^2}\n$$\nThis naturally defines the three components we are asked to compute:\n1.  The intramolecular contribution: $C_{\\mathrm{intra}} = \\mathrm{Var}(U_{\\mathrm{intra}}) / (k_B T^2)$\n2.  The intermolecular contribution: $C_{\\mathrm{inter}} = \\mathrm{Var}(U_{\\mathrm{inter}}) / (k_B T^2)$\n3.  The cross-correlation contribution: $C_{\\mathrm{cross}} = 2 \\mathrm{Cov}(U_{\\mathrm{intra}}, U_{\\mathrm{inter}}) / (k_B T^2)$\n\nThe total configurational heat capacity is the sum of these three terms: $C_{\\mathrm{total}} = C_{\\mathrm{intra}} + C_{\\mathrm{inter}} + C_{\\mathrm{cross}}$.\n\nThe problem instructs us to use a surrogate model for the energy fluctuations, motivated by the Central Limit Theorem, which suggests that the sum of many independent random variables tends toward a normal distribution. We model the joint fluctuations of $(U_{\\mathrm{intra}}, U_{\\mathrm{inter}})$ as a bivariate normal distribution. Since we are interested in fluctuations around the mean energy, we can model them with a zero-mean distribution, $\\mathcal{N}(\\mathbf{0}, \\Sigma)$, where $\\mathbf{0}$ is the zero vector and $\\Sigma$ is the $2 \\times 2$ covariance matrix.\n\nThe elements of the covariance matrix $\\Sigma$ are defined by the problem statement as follows:\n- The variance of intramolecular energy, $\\sigma_{11} = \\mathrm{Var}(U_{\\mathrm{intra}})$, is given by a model of $N_{\\mathrm{intra}}$ independent harmonic modes. For a classical harmonic oscillator, the variance of its potential energy is $(k_B T)^2/2$. Thus, for $N_{\\mathrm{intra}}$ modes:\n  $$\n  \\sigma_{11} = \\mathrm{Var}(U_{\\mathrm{intra}}) = N_{\\mathrm{intra}} \\frac{(k_B T)^2}{2} = N_{\\mathrm{intra}} \\frac{k_B^2 T^2}{2}\n  $$\n- The variance of intermolecular energy, $\\sigma_{22} = \\mathrm{Var}(U_{\\mathrm{inter}})$, is modeled similarly but modulated by a solvent polarity parameter $p$:\n  $$\n  \\sigma_{22} = \\mathrm{Var}(U_{\\mathrm{inter}}) = \\beta(p) N_{\\mathrm{inter}} \\frac{k_B^2 T^2}{2}\n  $$\n  where the amplitude factor is $\\beta(p) = 1 + b_1 p$, with $b_1 = 0.5$.\n\n- The covariance between the two energy components, $\\sigma_{12} = \\mathrm{Cov}(U_{\\mathrm{intra}}, U_{\\mathrm{inter}})$, is determined by a dimensionless cross-coupling function $\\gamma(p)$:\n  $$\n  \\sigma_{12} = \\mathrm{Cov}(U_{\\mathrm{intra}}, U_{\\mathrm{inter}}) = \\gamma(p) \\sqrt{\\mathrm{Var}(U_{\\mathrm{intra}}) \\mathrm{Var}(U_{\\mathrm{inter}})} = \\gamma(p) \\sqrt{\\sigma_{11} \\sigma_{22}}\n  $$\n  where $\\gamma(p) = c_0 \\tanh(p)$, with $c_0 = 0.5$. This form ensures that the correlation coefficient $\\rho = \\gamma(p)$ is bounded, $|\\rho| \\le 0.5$, which guarantees the covariance matrix is positive semidefinite.\n\nThe computational procedure is as follows:\n1.  For each test case, specified by ($T, N_{\\mathrm{intra}}, N_{\\mathrm{inter}}, p$), first calculate the theoretical values of the covariance matrix elements, $\\sigma_{11}$, $\\sigma_{22}$, and $\\sigma_{12}$. If $N_{\\mathrm{inter}} = 0$, then $\\sigma_{22} = 0$ and $\\sigma_{12} = 0$.\n2.  Construct the $2 \\times 2$ covariance matrix $\\Sigma = \\begin{pmatrix} \\sigma_{11} & \\sigma_{12} \\\\ \\sigma_{12} & \\sigma_{22} \\end{pmatrix}$.\n3.  Generate a large number of samples, $N = 100000$, from the bivariate normal distribution $\\mathcal{N}(\\mathbf{0}, \\Sigma)$. Each sample is a vector $(\\delta U_{\\mathrm{intra}}^{(i)}, \\delta U_{\\mathrm{inter}}^{(i)})$.\n4.  Crucially, as per the problem, we do not use the theoretical variances and covariance to compute the heat capacities. Instead, we compute the *empirical* moments from the generated samples. For a set of $N$ samples, the unbiased empirical covariance matrix is calculated. Let the generated samples be $\\mathbf{u}_i = (U_{\\mathrm{intra}}^{(i)}, U_{\\mathrm{inter}}^{(i)})$. The empirical variances and covariance are:\n    $$\n    \\widehat{\\mathrm{Var}}(U_{\\mathrm{intra}}) = \\frac{1}{N-1} \\sum_{i=1}^{N} (U_{\\mathrm{intra}}^{(i)} - \\bar{U}_{\\mathrm{intra}})^2\n    $$\n    $$\n    \\widehat{\\mathrm{Var}}(U_{\\mathrm{inter}}) = \\frac{1}{N-1} \\sum_{i=1}^{N} (U_{\\mathrm{inter}}^{(i)} - \\bar{U}_{\\mathrm{inter}})^2\n    $$\n    $$\n    \\widehat{\\mathrm{Cov}}(U_{\\mathrm{intra}}, U_{\\mathrm{inter}}) = \\frac{1}{N-1} \\sum_{i=1}^{N} (U_{\\mathrm{intra}}^{(i)} - \\bar{U}_{\\mathrm{intra}})(U_{\\mathrm{inter}}^{(i)} - \\bar{U}_{\\mathrm{inter}})\n    $$\n    where $\\bar{U}$ denotes the sample mean.\n5.  The total energy fluctuation for each sample is $U^{(i)} = U_{\\mathrm{intra}}^{(i)} + U_{\\mathrm{inter}}^{(i)}$. The empirical variance of the total energy, $\\widehat{\\mathrm{Var}}(U)$, is also computed from the sample set $\\{U^{(i)}\\}$.\n6.  Finally, the four heat capacity quantities are calculated by substituting these empirical moments into the defining equations:\n    - $C_{\\mathrm{intra}} = \\widehat{\\mathrm{Var}}(U_{\\mathrm{intra}}) / (k_B T^2)$\n    - $C_{\\mathrm{inter}} = \\widehat{\\mathrm{Var}}(U_{\\mathrm{inter}}) / (k_B T^2)$\n    - $C_{\\mathrm{cross}} = 2 \\widehat{\\mathrm{Cov}}(U_{\\mathrm{intra}}, U_{\\mathrm{inter}}) / (k_B T^2)$\n    - $C_{\\mathrm{total}} = \\widehat{\\mathrm{Var}}(U) / (k_B T^2)$\n\nThis process simulates a computational experiment, distinguishing the underlying theoretical model (used to generate data) from the statistical analysis of the resulting data (used to compute the observables). A fixed random seed is used to ensure the reproducibility of the pseudo-randomly generated samples.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the computational problem of partitioning heat capacity\n    based on a surrogate model for molecular energy fluctuations.\n    \"\"\"\n    # Define constants\n    k_B = 1.380649e-23  # Boltzmann constant in J/K\n    b_1 = 0.5\n    c_0 = 0.5\n    N_samples = 100000\n\n    # Test suite from the problem statement\n    test_cases = [\n        # (T in K, N_intra, N_inter, p)\n        (300.0, 9, 12, 0.2),\n        (300.0, 9, 12, 1.0),\n        (300.0, 9, 0, 0.5),\n        (600.0, 9, 12, 0.2),\n        (300.0, 9, 12, 5.0),\n    ]\n\n    # Set a fixed random seed for reproducibility\n    np.random.seed(42)\n\n    all_case_results = []\n\n    for T, N_intra, N_inter, p in test_cases:\n        # Step 1: Calculate the theoretical covariance matrix elements\n        k_B_T_sq = (k_B * T)**2\n        \n        # Variance of intramolecular energy\n        var_intra = N_intra * k_B_T_sq / 2.0\n        \n        # Variance of intermolecular energy\n        if N_inter > 0:\n            beta_p = 1.0 + b_1 * p\n            var_inter = beta_p * N_inter * k_B_T_sq / 2.0\n        else:\n            var_inter = 0.0\n\n        # Covariance\n        if var_intra > 0 and var_inter > 0:\n            gamma_p = c_0 * np.tanh(p)\n            covar = gamma_p * np.sqrt(var_intra * var_inter)\n        else:\n            covar = 0.0\n\n        # Step 2: Construct the covariance matrix\n        cov_matrix = np.array([[var_intra, covar], [covar, var_inter]])\n        \n        # Step 3: Generate samples from the bivariate normal distribution\n        # The mean vector is zero, representing fluctuations\n        mean_vec = [0.0, 0.0]\n        samples = np.random.multivariate_normal(mean_vec, cov_matrix, size=N_samples)\n        \n        u_intra_samples = samples[:, 0]\n        u_inter_samples = samples[:, 1]\n        \n        # Step 4: Compute empirical moments from the samples\n        # We use ddof=1 for the unbiased sample variance/covariance\n        \n        # Calculate empirical individual variances and covariance\n        # np.cov returns the covariance matrix of the samples\n        emp_cov_matrix = np.cov(samples, rowvar=False, ddof=1)\n        emp_var_intra = emp_cov_matrix[0, 0]\n        emp_var_inter = emp_cov_matrix[1, 1]\n        emp_covar = emp_cov_matrix[0, 1]\n\n        # Step 5: Compute empirical total energy variance\n        u_total_samples = u_intra_samples + u_inter_samples\n        emp_var_total = np.var(u_total_samples, ddof=1)\n\n        # Step 6: Calculate heat capacity components\n        denom = k_B * T**2\n        \n        C_intra = emp_var_intra / denom\n        C_inter = emp_var_inter / denom\n        C_cross = 2.0 * emp_covar / denom\n        C_total = emp_var_total / denom\n\n        # Store results for this case\n        current_results = [C_intra, C_inter, C_cross, C_total]\n        all_case_results.append(current_results)\n\n    # Final print statement in the exact required format.\n    # Format each number to scientific notation with 6 significant digits (1.dddddde+xx)\n    formatted_results = []\n    for res_list in all_case_results:\n        formatted_list = [f\"{val:.5e}\" for val in res_list]\n        formatted_results.append(f\"[{','.join(formatted_list)}]\")\n    \n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3418835"}]}