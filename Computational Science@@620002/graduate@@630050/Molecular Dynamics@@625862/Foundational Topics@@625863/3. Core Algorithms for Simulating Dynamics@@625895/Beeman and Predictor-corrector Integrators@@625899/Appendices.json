{"hands_on_practices": [{"introduction": "The first step in evaluating any numerical integrator is to assess its local accuracy—how well it approximates the true trajectory over a small time step $h$. This is quantified by the local truncation error, which we can derive by comparing the integrator's formula against a Taylor series expansion of the exact solution. This exercise provides fundamental practice in this essential technique, allowing you to determine the order of accuracy for both the position and velocity components of the Beeman algorithm [@problem_id:3396862].", "problem": "Consider a single classical particle in one spatial dimension of mass $m$ evolving under a smooth force $F(x,t)$ so that Newton’s second law gives $m\\,\\ddot{x}(t)=F(x(t),t)$. Define the acceleration $a(t)=\\ddot{x}(t)$, the jerk $j(t)=\\dot{a}(t)$, and the snap $s(t)=\\ddot{a}(t)$. Assume $a(t)$ is sufficiently smooth so that all time derivatives up to the required order exist and are bounded. The Beeman integrator used in molecular dynamics is a two-step predictor-corrector scheme. In its commonly used corrector form, the position and velocity updates over a constant time step $h>0$ are given by\n$$\nx_{\\mathrm{B}}(t+h)=x(t)+v(t)\\,h+\\left(\\frac{2}{3}\\,a(t)-\\frac{1}{6}\\,a(t-h)\\right)h^{2},\n$$\n$$\nv_{\\mathrm{B}}(t+h)=v(t)+\\frac{h}{6}\\left(2\\,a(t+h)+5\\,a(t)-a(t-h)\\right),\n$$\nwhere $v(t)=\\dot{x}(t)$ and $a(\\cdot)$ is evaluated from the force at the indicated time. For the purposes of local truncation error analysis, interpret $a(t\\pm h)$ as the exact acceleration along the exact trajectory at times $t\\pm h$.\n\nUsing only Newton’s second law, the definitions $v=\\dot{x}$, $a=\\ddot{x}$, $j=\\dot{a}$, $s=\\ddot{a}$, and Taylor expansions about time $t$, derive the leading-order local truncation errors for the position and velocity updates, defined respectively by\n$$\n\\Delta x_{\\mathrm{loc}}=x(t+h)-x_{\\mathrm{B}}(t+h),\\qquad \\Delta v_{\\mathrm{loc}}=v(t+h)-v_{\\mathrm{B}}(t+h),\n$$\nexpressed in terms of the snap $s(t)$, up to and including the first nonzero term in powers of $h$. Then, extract the corresponding dimensionless error constants $C_{x}$ and $C_{v}$ defined by\n$$\n\\Delta x_{\\mathrm{loc}}=C_{x}\\,s(t)\\,h^{4}+O\\!\\left(h^{5}\\right),\\qquad \\Delta v_{\\mathrm{loc}}=C_{v}\\,s(t)\\,h^{3}+O\\!\\left(h^{4}\\right).\n$$\nReport your final answer as the ordered pair $\\left(C_{x},\\,C_{v}\\right)$. No numerical evaluation is required. Express your final answer as a single composite expression as specified. If you introduce any intermediate truncated series, keep constants symbolic and do not substitute numerical values beyond those already present in the scheme. The final answer must be given as a pair of exact rational numbers. Units are not required for the error constants.", "solution": "The objective is to determine the local truncation errors for the position and velocity as given by the Beeman integrator. This is achieved by comparing the Taylor series expansion of the exact solution with the expansion of the numerical scheme.\n\nLet us begin by writing the Taylor series expansions for the exact position $x(t+h)$ and velocity $v(t+h)$ around time $t$. Using the provided definitions, we have:\n$\\dot{x}(t) = v(t)$\n$\\ddot{x}(t) = a(t)$\n$\\dddot{x}(t) = \\dot{a}(t) = j(t)$\n$x^{(4)}(t) = \\ddot{a}(t) = s(t)$\n\nThe expansion for the exact position is:\n$$x(t+h) = x(t) + h\\dot{x}(t) + \\frac{h^2}{2!}\\ddot{x}(t) + \\frac{h^3}{3!}\\dddot{x}(t) + \\frac{h^4}{4!}x^{(4)}(t) + O(h^5)$$\n$$x(t+h) = x(t) + v(t)h + \\frac{1}{2}a(t)h^2 + \\frac{1}{6}j(t)h^3 + \\frac{1}{24}s(t)h^4 + O(h^5)$$\n\nSimilarly, for the exact velocity:\n$\\dot{v}(t) = a(t)$\n$\\ddot{v}(t) = \\dot{a}(t) = j(t)$\n$\\dddot{v}(t) = \\ddot{a}(t) = s(t)$\n\nThe expansion for the exact velocity is:\n$$v(t+h) = v(t) + h\\dot{v}(t) + \\frac{h^2}{2!}\\ddot{v}(t) + \\frac{h^3}{3!}\\dddot{v}(t) + O(h^4)$$\n$$v(t+h) = v(t) + a(t)h + \\frac{1}{2}j(t)h^2 + \\frac{1}{6}s(t)h^3 + O(h^4)$$\n\nNext, we expand the terms in the Beeman integrator updates.\n\n**Position Error Analysis**\nThe Beeman position update is:\n$$x_{\\mathrm{B}}(t+h) = x(t)+v(t)\\,h+\\left(\\frac{2}{3}\\,a(t)-\\frac{1}{6}\\,a(t-h)\\right)h^{2}$$\nTo analyze this, we need the Taylor expansion of $a(t-h)$ around $t$:\n$$a(t-h) = a(t) - j(t)h + \\frac{1}{2}s(t)h^2 + O(h^3)$$\nSubstituting this into the term in the parenthesis of the $x_{\\mathrm{B}}(t+h)$ expression:\n$$\\left(\\frac{2}{3}\\,a(t)-\\frac{1}{6}\\,a(t-h)\\right) = \\frac{2}{3}a(t) - \\frac{1}{6}\\left(a(t) - j(t)h + \\frac{1}{2}s(t)h^2 + O(h^3)\\right)$$\n$$= \\frac{2}{3}a(t) - \\frac{1}{6}a(t) + \\frac{1}{6}j(t)h - \\frac{1}{12}s(t)h^2 + O(h^3)$$\n$$= \\left(\\frac{4-1}{6}\\right)a(t) + \\frac{1}{6}j(t)h - \\frac{1}{12}s(t)h^2 + O(h^3)$$\n$$= \\frac{1}{2}a(t) + \\frac{1}{6}j(t)h - \\frac{1}{12}s(t)h^2 + O(h^3)$$\nNow, we multiply this by $h^2$ and substitute back into the expression for $x_{\\mathrm{B}}(t+h)$:\n$$x_{\\mathrm{B}}(t+h) = x(t) + v(t)h + \\left(\\frac{1}{2}a(t) + \\frac{1}{6}j(t)h - \\frac{1}{12}s(t)h^2 + O(h^3)\\right)h^2$$\n$$x_{\\mathrm{B}}(t+h) = x(t) + v(t)h + \\frac{1}{2}a(t)h^2 + \\frac{1}{6}j(t)h^3 - \\frac{1}{12}s(t)h^4 + O(h^5)$$\nThe local truncation error for the position is $\\Delta x_{\\mathrm{loc}} = x(t+h) - x_{\\mathrm{B}}(t+h)$.\n$$\\Delta x_{\\mathrm{loc}} = \\left(x(t) + v(t)h + \\frac{1}{2}a(t)h^2 + \\frac{1}{6}j(t)h^3 + \\frac{1}{24}s(t)h^4 + O(h^5)\\right) - \\left(x(t) + v(t)h + \\frac{1}{2}a(t)h^2 + \\frac{1}{6}j(t)h^3 - \\frac{1}{12}s(t)h^4 + O(h^5)\\right)$$\nSubtracting term by term, we find that terms up to order $h^3$ cancel.\n$$\\Delta x_{\\mathrm{loc}} = \\left(\\frac{1}{24}s(t)h^4\\right) - \\left(-\\frac{1}{12}s(t)h^4\\right) + O(h^5)$$\n$$\\Delta x_{\\mathrm{loc}} = \\left(\\frac{1}{24} + \\frac{2}{24}\\right)s(t)h^4 + O(h^5) = \\frac{3}{24}s(t)h^4 + O(h^5)$$\n$$\\Delta x_{\\mathrm{loc}} = \\frac{1}{8}s(t)h^4 + O(h^5)$$\nBy comparing with the required form $\\Delta x_{\\mathrm{loc}}=C_{x}\\,s(t)\\,h^{4}+O(h^{5})$, we identify the constant $C_x$ as:\n$$C_x = \\frac{1}{8}$$\n\n**Velocity Error Analysis**\nThe Beeman velocity update is:\n$$v_{\\mathrm{B}}(t+h) = v(t)+\\frac{h}{6}\\left(2\\,a(t+h)+5\\,a(t)-a(t-h)\\right)$$\nTo analyze this, we need the Taylor expansions of $a(t+h)$ and $a(t-h)$ around $t$:\n$$a(t+h) = a(t) + j(t)h + \\frac{1}{2}s(t)h^2 + O(h^3)$$\n$$a(t-h) = a(t) - j(t)h + \\frac{1}{2}s(t)h^2 + O(h^3)$$\nSubstituting these into the term in the parenthesis of the $v_{\\mathrm{B}}(t+h)$ expression:\n$$2a(t+h)+5a(t)-a(t-h) = 2\\left(a(t) + j(t)h + \\frac{1}{2}s(t)h^2\\right) + 5a(t) - \\left(a(t) - j(t)h + \\frac{1}{2}s(t)h^2\\right) + O(h^3)$$\nWe group terms by derivatives of $a(t)$:\nCoefficient of $a(t)$: $2+5-1 = 6$\nCoefficient of $j(t)h$: $2 - (-1) = 3$\nCoefficient of $s(t)h^2$: $2 \\cdot \\frac{1}{2} - \\frac{1}{2} = 1 - \\frac{1}{2} = \\frac{1}{2}$\nSo the expression becomes:\n$$6a(t) + 3j(t)h + \\frac{1}{2}s(t)h^2 + O(h^3)$$\nNow, we substitute this back into the formula for $v_{\\mathrm{B}}(t+h)$:\n$$v_{\\mathrm{B}}(t+h) = v(t) + \\frac{h}{6}\\left(6a(t) + 3j(t)h + \\frac{1}{2}s(t)h^2 + O(h^3)\\right)$$\n$$v_{\\mathrm{B}}(t+h) = v(t) + a(t)h + \\frac{3}{6}j(t)h^2 + \\frac{1}{12}s(t)h^3 + O(h^4)$$\n$$v_{\\mathrm{B}}(t+h) = v(t) + a(t)h + \\frac{1}{2}j(t)h^2 + \\frac{1}{12}s(t)h^3 + O(h^4)$$\nThe local truncation error for the velocity is $\\Delta v_{\\mathrm{loc}} = v(t+h) - v_{\\mathrm{B}}(t+h)$.\n$$\\Delta v_{\\mathrm{loc}} = \\left(v(t) + a(t)h + \\frac{1}{2}j(t)h^2 + \\frac{1}{6}s(t)h^3 + O(h^4)\\right) - \\left(v(t) + a(t)h + \\frac{1}{2}j(t)h^2 + \\frac{1}{12}s(t)h^3 + O(h^4)\\right)$$\nSubtracting term by term, we find that terms up to order $h^2$ cancel.\n$$\\Delta v_{\\mathrm{loc}} = \\left(\\frac{1}{6}s(t)h^3\\right) - \\left(\\frac{1}{12}s(t)h^3\\right) + O(h^4)$$\n$$\\Delta v_{\\mathrm{loc}} = \\left(\\frac{2}{12} - \\frac{1}{12}\\right)s(t)h^3 + O(h^4)$$\n$$\\Delta v_{\\mathrm{loc}} = \\frac{1}{12}s(t)h^3 + O(h^4)$$\nBy comparing with the required form $\\Delta v_{\\mathrm{loc}}=C_{v}\\,s(t)\\,h^{3}+O(h^{4})$, we identify the constant $C_v$ as:\n$$C_v = \\frac{1}{12}$$\n\nThe ordered pair of dimensionless error constants is $\\left(C_{x},\\,C_{v}\\right) = \\left(\\frac{1}{8},\\,\\frac{1}{12}\\right)$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{8} & \\frac{1}{12}\n\\end{pmatrix}\n}\n$$", "id": "3396862"}, {"introduction": "Beyond local accuracy, a robust integrator should respect the fundamental symmetries of the physical system it models. For Hamiltonian dynamics, time-reversibility is a crucial symmetry, ensuring that running a trajectory backward in time is physically equivalent to running it forward. This practice [@problem_id:3396867] challenges you to first diagnose the lack of time-reversibility in a common form of the Beeman algorithm and then to actively engage in integrator design by constructing a corrected, time-reversible update that maintains a high order of accuracy.", "problem": "Consider a one-dimensional Molecular Dynamics (MD) system with mass $m$ obeying Newton's second law, $m\\,\\ddot{x}(t)=F(x(t))$, where $F(x)$ is sufficiently smooth so that all derivatives up to the third time derivative of the acceleration exist and are continuous. Define the acceleration as $a(t)=\\frac{F(x(t))}{m}$, its time derivative (the jerk) as $j(t)=\\frac{d a(t)}{d t}$, and its second time derivative (the snap) as $s(t)=\\frac{d^{2} a(t)}{d t^{2}}$. Let $x_{n}=x(t_{n})$, $v_{n}=\\dot{x}(t_{n})$, $a_{n}=a(t_{n})$, and $\\Delta t=t_{n+1}-t_{n}$.\n\nStarting from Newton’s law and Taylor expansions around $t_{n}$, derive the third-order accurate position-update formula that uses $a_{n}$ and $a_{n-1}$ only (this is the form associated with Beeman’s predictor for position). Then, test its invariance under the transformation $\\Delta t\\to -\\Delta t$ by writing the corresponding backward step from $(x_{n+1},v_{n+1},a_{n+1})$ to $(x_{n},v_{n},a_{n})$ and deciding whether the forward and backward maps are identical as algebraic expressions in $\\Delta t$ and the accelerations at adjacent steps. Conclude whether the uncorrected Beeman position update is time-reversible.\n\nNext, design a minimal predictor-corrector position update that restores time-reversibility while retaining third-order accuracy in $x$. To that end, consider a corrected position update of the form\n$$\nx_{n+1}^{(\\mathrm{corr})}=x_{n}+v_{n}\\,\\Delta t+C\\,a_{n}\\,\\Delta t^{2}+E\\left(a_{n+1}^{(\\mathrm{pred})}-a_{n-1}\\right)\\Delta t^{2},\n$$\nwhere $a_{n+1}^{(\\mathrm{pred})}$ is the predicted acceleration obtained from a third-order position predictor (you may use your derived Beeman-type predictor to obtain $x_{n+1}^{(\\mathrm{pred})}$ and then compute $a_{n+1}^{(\\mathrm{pred})}=a(x_{n+1}^{(\\mathrm{pred})})$). Impose the following design requirements:\n\n- The corrected update is invariant under $\\Delta t\\to -\\Delta t$ in the sense that the algebraic form of the update is unchanged when indexes are reversed ($n+1\\leftrightarrow n-1$) and $\\Delta t$ changes sign.\n- The corrected update reproduces the exact Taylor expansion of $x(t_{n+1})$ through order $\\Delta t^{3}$ for general smooth $F(x)$.\n\nDetermine the unique values of the coefficients $C$ and $E$ that meet these requirements for the given minimal form, and report them as exact rational numbers. Express your final answer as a row matrix using the LaTeX pmatrix environment, with entries $C$ and $E$ in that order. No rounding is required, and no units are necessary in the final answer.", "solution": "The solution is structured in three parts as requested by the problem statement.\n\n**Part 1: Derivation of the Beeman predictor for position**\n\nWe start with the Taylor series expansion for the position $x(t)$ around time $t_{n}$ to predict $x_{n+1}=x(t_{n}+\\Delta t)$:\n$$x_{n+1} = x_n + v_n \\Delta t + \\frac{1}{2} a_n \\Delta t^2 + \\frac{1}{6} j_n \\Delta t^3 + O(\\Delta t^4)$$\nThe goal is to find a third-order accurate formula that uses only $a_n$ and $a_{n-1}$. This means we need to approximate the jerk, $j_n$, using information available at times $t_n$ and $t_{n-1}$. We can use a first-order backward finite difference for the jerk, derived from the Taylor expansion of the acceleration $a(t)$ around $t_n$:\n$$a_{n-1} = a(t_n - \\Delta t) = a_n - j_n \\Delta t + O(\\Delta t^2)$$\nSolving for $j_n$ gives:\n$$j_n = \\frac{a_n - a_{n-1}}{\\Delta t} + O(\\Delta t)$$\nSubstituting this approximation for $j_n$ into the expansion for $x_{n+1}$:\n$$x_{n+1} \\approx x_n + v_n \\Delta t + \\frac{1}{2} a_n \\Delta t^2 + \\frac{1}{6} \\left(\\frac{a_n - a_{n-1}}{\\Delta t}\\right) \\Delta t^3$$\n$$x_{n+1} = x_n + v_n \\Delta t + \\frac{1}{2} a_n \\Delta t^2 + \\frac{1}{6} a_n \\Delta t^2 - \\frac{1}{6} a_{n-1} \\Delta t^2$$\nCombining the terms with $a_n$:\n$$x_{n+1} = x_n + v_n \\Delta t + \\left(\\frac{1}{2} + \\frac{1}{6}\\right) a_n \\Delta t^2 - \\frac{1}{6} a_{n-1} \\Delta t^2$$\n$$x_{n+1} = x_n + v_n \\Delta t + \\frac{2}{3} a_n \\Delta t^2 - \\frac{1}{6} a_{n-1} \\Delta t^2$$\nThis is the position-update formula for Beeman's predictor. To confirm its accuracy, we note that the error in the approximation of $j_n$ is $O(\\Delta t)$. When multiplied by $\\Delta t^3$ in the Taylor expansion, this introduces a local truncation error of $O(\\Delta t^4)$ in the position, making the formula third-order accurate.\n\n**Part 2: Time-reversibility test of the Beeman predictor**\n\nAn integrator is time-reversible if applying the algorithm for a time step $\\Delta t$ and then for a time step $-\\Delta t$ returns the system to its initial state. Algebraically, this can be tested by comparing the forward map with the rearranged backward map.\n\nThe forward map from step $n$ to $n+1$ is:\n$$x_{n+1} = x_n + v_n \\Delta t + \\frac{2}{3} a_n \\Delta t^2 - \\frac{1}{6} a_{n-1} \\Delta t^2$$\nTo obtain the backward map from step $n+1$ to $n$, we apply the same algorithm starting from state $(x_{n+1}, v_{n+1})$ with a time step of $-\\Delta t$. The \"current\" acceleration is $a_{n+1}$ and the \"previous\" acceleration is $a_n$.\n$$x_n = x_{n+1} + v_{n+1} (-\\Delta t) + \\frac{2}{3} a_{n+1} (-\\Delta t)^2 - \\frac{1}{6} a_n (-\\Delta t)^2$$\n$$x_n = x_{n+1} - v_{n+1} \\Delta t + \\frac{2}{3} a_{n+1} \\Delta t^2 - \\frac{1}{6} a_n \\Delta t^2$$\nNow, we can rearrange the forward map to solve for $x_n$:\n$$x_n = x_{n+1} - v_n \\Delta t - \\frac{2}{3} a_n \\Delta t^2 + \\frac{1}{6} a_{n-1} \\Delta t^2$$\nComparing the algebraic form of the backward map with the rearranged forward map, we see they are not identical. For instance, the terms involving accelerations are different:\n$$ \\text{Backward map:} \\quad \\left(\\frac{2}{3} a_{n+1} - \\frac{1}{6} a_n\\right)\\Delta t^2 $$\n$$ \\text{Rearranged forward map:} \\quad \\left(-\\frac{2}{3} a_n + \\frac{1}{6} a_{n-1}\\right)\\Delta t^2 $$\nThese expressions are clearly different. The asymmetric dependence on past ($a_{n-1}$) and present ($a_n$) accelerations, without involving future information ($a_{n+1}$), breaks the time symmetry. Therefore, the uncorrected Beeman position update is not time-reversible.\n\n**Part 3: Design of a time-reversible, third-order accurate corrector**\n\nWe are tasked with finding the coefficients $C$ and $E$ for the corrected position update:\n$$x_{n+1}^{(\\mathrm{corr})}=x_{n}+v_{n}\\,\\Delta t+C\\,a_{n}\\,\\Delta t^{2}+E\\left(a_{n+1}^{(\\mathrm{pred})}-a_{n-1}\\right)\\Delta t^{2}$$\nsuch that it is third-order accurate and time-reversible. We will determine the coefficients by enforcing third-order accuracy and then confirm that the resulting scheme meets the reversibility requirement.\n\nTo check for third-order accuracy, we compare the formula with the exact Taylor expansion of $x(t_{n+1})$ around $t_n$:\n$$x(t_{n+1}) = x_n + v_n \\Delta t + \\frac{1}{2} a_n \\Delta t^2 + \\frac{1}{6} j_n \\Delta t^3 + O(\\Delta t^4)$$\nWe need to expand the term $(a_{n+1}^{(\\mathrm{pred})}-a_{n-1})$ in the corrector formula in powers of $\\Delta t$.\nThe predicted acceleration $a_{n+1}^{(\\mathrm{pred})}$ is calculated as $a(x_{n+1}^{(\\mathrm{pred})})$. As shown in Part 1, the predictor for position is third-order accurate, i.e., $x_{n+1}^{(\\mathrm{pred})} = x(t_{n+1}) + O(\\Delta t^4)$.\nThus, $a_{n+1}^{(\\mathrm{pred})} = a(x(t_{n+1}) + O(\\Delta t^4)) = a(x(t_{n+1})) + a'(x(t_{n+1})) O(\\Delta t^4) = a_{n+1}^{\\text{exact}} + O(\\Delta t^4)$. The error in the predicted acceleration is of order $O(\\Delta t^4)$. When this is multiplied by $\\Delta t^2$ in the corrector, the contribution to the position error is $O(\\Delta t^6)$, which is a higher order than we need to consider for a third-order scheme. Therefore, we can replace $a_{n+1}^{(\\mathrm{pred})}$ with the exact acceleration $a_{n+1}$ in our analysis.\n\nWe use Taylor expansions for $a_{n+1}$ and $a_{n-1}$ around $t_n$:\n$$a_{n+1} = a_n + j_n \\Delta t + \\frac{1}{2} s_n \\Delta t^2 + O(\\Delta t^3)$$\n$$a_{n-1} = a_n - j_n \\Delta t + \\frac{1}{2} s_n \\Delta t^2 - O(\\Delta t^3)$$\nSubtracting these gives the central difference approximation for the jerk:\n$$a_{n+1} - a_{n-1} = 2 j_n \\Delta t + O(\\Delta t^3)$$\nSubstituting this into the corrector equation:\n$$x_{n+1}^{(\\mathrm{corr})} = x_n + v_n \\Delta t + C a_n \\Delta t^2 + E(2 j_n \\Delta t + O(\\Delta t^3))\\Delta t^2$$\n$$x_{n+1}^{(\\mathrm{corr})} = x_n + v_n \\Delta t + C a_n \\Delta t^2 + 2E j_n \\Delta t^3 + O(\\Delta t^5)$$\nTo achieve third-order accuracy, this expansion must match the exact Taylor expansion of $x(t_{n+1})$ up to the $\\Delta t^3$ term.\n$$x(t_{n+1}) = x_n + v_n \\Delta t + \\frac{1}{2} a_n \\Delta t^2 + \\frac{1}{6} j_n \\Delta t^3 + O(\\Delta t^4)$$\nBy comparing the coefficients of the powers of $\\Delta t$:\n- For the $\\Delta t^2$ term: $C a_n \\Delta t^2 = \\frac{1}{2} a_n \\Delta t^2 \\implies C = \\frac{1}{2}$.\n- For the $\\Delta t^3$ term: $2E j_n \\Delta t^3 = \\frac{1}{6} j_n \\Delta t^3 \\implies 2E = \\frac{1}{6} \\implies E = \\frac{1}{12}$.\n\nThe unique values for the coefficients are $C = 1/2$ and $E = 1/12$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{2} & \\frac{1}{12}\n\\end{pmatrix}\n}\n$$", "id": "3396867"}, {"introduction": "For simulations in the microcanonical (NVE) ensemble, long-term energy conservation is paramount, a property deeply linked to an integrator's ability to preserve phase-space volume, a feature known as symplecticity. In this final practice, you will use the Jacobian of the discrete time-evolution map to rigorously investigate whether the Beeman algorithm is symplectic [@problem_id:3396840]. The result provides a definitive explanation for the observed energy drift in Beeman simulations and clarifies its suitability for different statistical ensembles.", "problem": "Consider the one-dimensional ($1$D) harmonic oscillator with mass $m$ and spring constant $k$, obeying Newton’s second law $m \\ddot{x}(t) = -k x(t)$. Let $\\omega \\equiv \\sqrt{k/m}$ and $a(t) \\equiv \\ddot{x}(t)$ so that $a(t) = -\\omega^{2} x(t)$. In a Molecular Dynamics (MD) time discretization with fixed time step $\\Delta t$, apply the standard Beeman predictor-corrector scheme, which updates position and velocity using the acceleration history according to\n$$\nx_{n+1} = x_{n} + v_{n} \\Delta t + \\frac{2}{3} a_{n} \\Delta t^{2} - \\frac{1}{6} a_{n-1} \\Delta t^{2},\n$$\n$$\nv_{n+1} = v_{n} + \\frac{1}{3} a_{n+1} \\Delta t + \\frac{5}{6} a_{n} \\Delta t - \\frac{1}{6} a_{n-1} \\Delta t,\n$$\nwith $a_{n} = -\\omega^{2} x_{n}$ and $a_{n+1} = -\\omega^{2} x_{n+1}$. To make the one-step map Markovian, introduce the augmented state vector $y_{n} \\equiv (x_{n}, v_{n}, x_{n-1})^{\\top}$ so that $y_{n+1} = \\Phi(y_{n})$ is a linear update.\n\nStarting only from Newton’s second law and the stated Beeman scheme, derive the Jacobian matrix $J \\equiv \\partial y_{n+1} / \\partial y_{n}$ of this one-step map for the harmonic oscillator and compute its determinant $\\det J$ as an explicit function of $\\Delta t$ and $\\omega$. Then, based on your result, discuss the implication for phase-space volume change per step and the suitability of the scheme for microcanonical (constant number of particles, volume, and energy; NVE) sampling in Molecular Dynamics.\n\nProvide as your final answer the closed-form expression for $\\det J$. No discussion is needed in the final answer. The determinant is dimensionless, so no units are required. No rounding is needed.", "solution": "To derive the Jacobian matrix, we first express the components of the state vector $y_{n+1} = (x_{n+1}, v_{n+1}, x_{n})^{\\top}$ as linear functions of the components of $y_{n} = (x_{n}, v_{n}, x_{n-1})^{\\top}$.\n\n**First component of $y_{n+1}$: $x_{n+1}$**\nThe position update is given as:\n$$\nx_{n+1} = x_{n} + v_{n} \\Delta t + \\frac{2}{3} a_{n} \\Delta t^{2} - \\frac{1}{6} a_{n-1} \\Delta t^{2}\n$$\nSubstitute $a_{n} = -\\omega^{2} x_{n}$ and $a_{n-1} = -\\omega^{2} x_{n-1}$:\n$$\nx_{n+1} = x_{n} + v_{n} \\Delta t - \\frac{2}{3} \\omega^{2} x_{n} \\Delta t^{2} + \\frac{1}{6} \\omega^{2} x_{n-1} \\Delta t^{2}\n$$\nGrouping terms by the components of $y_n$:\n$$\nx_{n+1} = \\left(1 - \\frac{2}{3} \\omega^{2} \\Delta t^{2}\\right) x_{n} + (\\Delta t) v_{n} + \\left(\\frac{1}{6} \\omega^{2} \\Delta t^{2}\\right) x_{n-1}\n$$\n\n**Second component of $y_{n+1}$: $v_{n+1}$**\nThe velocity update is given as:\n$$\nv_{n+1} = v_{n} + \\frac{1}{3} a_{n+1} \\Delta t + \\frac{5}{6} a_{n} \\Delta t - \\frac{1}{6} a_{n-1} \\Delta t\n$$\nSubstitute $a_{n+1} = -\\omega^{2} x_{n+1}$, $a_{n} = -\\omega^{2} x_{n}$, and $a_{n-1} = -\\omega^{2} x_{n-1}$:\n$$\nv_{n+1} = v_{n} - \\frac{1}{3} \\omega^{2} x_{n+1} \\Delta t - \\frac{5}{6} \\omega^{2} x_{n} \\Delta t + \\frac{1}{6} \\omega^{2} x_{n-1} \\Delta t\n$$\nTo make this an explicit function of $y_n$, we substitute the expression for $x_{n+1}$ we derived above:\n$$\nv_{n+1} = v_{n} - \\frac{1}{3} \\omega^{2} \\Delta t \\left[ \\left(1 - \\frac{2}{3} \\omega^{2} \\Delta t^{2}\\right) x_{n} + (\\Delta t) v_{n} + \\left(\\frac{1}{6} \\omega^{2} \\Delta t^{2}\\right) x_{n-1} \\right] - \\frac{5}{6} \\omega^{2} x_{n} \\Delta t + \\frac{1}{6} \\omega^{2} x_{n-1} \\Delta t\n$$\nNow we group terms by $x_n$, $v_n$, and $x_{n-1}$:\n*   Coefficient of $x_n$:\n$$\n-\\frac{1}{3} \\omega^{2} \\Delta t \\left(1 - \\frac{2}{3} \\omega^{2} \\Delta t^{2}\\right) - \\frac{5}{6} \\omega^{2} \\Delta t = -\\frac{1}{3} \\omega^{2} \\Delta t + \\frac{2}{9} \\omega^{4} \\Delta t^{3} - \\frac{5}{6} \\omega^{2} \\Delta t = \\left(-\\frac{2}{6} - \\frac{5}{6}\\right)\\omega^{2} \\Delta t + \\frac{2}{9} \\omega^{4} \\Delta t^{3} = -\\frac{7}{6} \\omega^{2} \\Delta t + \\frac{2}{9} \\omega^{4} \\Delta t^{3}\n$$\n*   Coefficient of $v_n$:\n$$\n1 - \\frac{1}{3} \\omega^{2} \\Delta t (\\Delta t) = 1 - \\frac{1}{3} \\omega^{2} \\Delta t^{2}\n$$\n*   Coefficient of $x_{n-1}$:\n$$\n-\\frac{1}{3} \\omega^{2} \\Delta t \\left(\\frac{1}{6} \\omega^{2} \\Delta t^{2}\\right) + \\frac{1}{6} \\omega^{2} \\Delta t = \\frac{1}{6} \\omega^{2} \\Delta t - \\frac{1}{18} \\omega^{4} \\Delta t^{3}\n$$\nSo, the expression for $v_{n+1}$ is:\n$$\nv_{n+1} = \\left(-\\frac{7}{6} \\omega^{2} \\Delta t + \\frac{2}{9} \\omega^{4} \\Delta t^{3}\\right) x_{n} + \\left(1 - \\frac{1}{3} \\omega^{2} \\Delta t^{2}\\right) v_{n} + \\left(\\frac{1}{6} \\omega^{2} \\Delta t - \\frac{1}{18} \\omega^{4} \\Delta t^{3}\\right) x_{n-1}\n$$\n\n**Third component of $y_{n+1}$: $x_{n}$**\nThe third component is trivially $x_n = 1 \\cdot x_n + 0 \\cdot v_n + 0 \\cdot x_{n-1}$.\n\n**Constructing the Jacobian matrix $J$**\nThe update has the linear form $y_{n+1} = J y_{n}$. The Jacobian matrix $J = \\partial y_{n+1} / \\partial y_{n}$ is the matrix of the coefficients we just derived.\n$$\nJ = \\begin{pmatrix}\n1 - \\frac{2}{3} \\omega^{2} \\Delta t^{2} & \\Delta t & \\frac{1}{6} \\omega^{2} \\Delta t^{2} \\\\\n-\\frac{7}{6} \\omega^{2} \\Delta t + \\frac{2}{9} \\omega^{4} \\Delta t^{3} & 1 - \\frac{1}{3} \\omega^{2} \\Delta t^{2} & \\frac{1}{6} \\omega^{2} \\Delta t - \\frac{1}{18} \\omega^{4} \\Delta t^{3} \\\\\n1 & 0 & 0\n\\end{pmatrix}\n$$\n\n**Compute the determinant of $J$**\nWe compute the determinant of $J$ using cofactor expansion along the third row.\n$$\n\\det J = (1) \\cdot \\det \\begin{pmatrix} \\Delta t & \\frac{1}{6} \\omega^{2} \\Delta t^{2} \\\\ 1 - \\frac{1}{3} \\omega^{2} \\Delta t^{2} & \\frac{1}{6} \\omega^{2} \\Delta t - \\frac{1}{18} \\omega^{4} \\Delta t^{3} \\end{pmatrix} - (0) \\cdot (...) + (0) \\cdot (...)\n$$\n$$\n\\det J = (\\Delta t) \\left( \\frac{1}{6} \\omega^{2} \\Delta t - \\frac{1}{18} \\omega^{4} \\Delta t^{3} \\right) - \\left( \\frac{1}{6} \\omega^{2} \\Delta t^{2} \\right) \\left( 1 - \\frac{1}{3} \\omega^{2} \\Delta t^{2} \\right)\n$$\nExpanding both terms:\n$$\n\\det J = \\left(\\frac{1}{6} \\omega^{2} \\Delta t^{2} - \\frac{1}{18} \\omega^{4} \\Delta t^{4}\\right) - \\left(\\frac{1}{6} \\omega^{2} \\Delta t^{2} - \\frac{1}{18} \\omega^{4} \\Delta t^{4}\\right) = 0\n$$\n\n**Discussion**\nThe Jacobian determinant $\\det J$ describes how an infinitesimal volume element in the state space transforms under the map. In this case, the state space is the augmented $3$D space with coordinates $(x, v, x_{prev})$. An infinitesimal volume element $dV_n = dx_n \\, dv_n \\, dx_{n-1}$ transforms to $dV_{n+1} = |\\det J| \\, dV_n$.\nOur result, $\\det J = 0$, implies that $dV_{n+1} = 0$. This means the Beeman algorithm, when viewed as a one-step map in this augmented phase space, is a singular transformation that collapses the entire $3$D state space onto a lower-dimensional manifold.\n\nFor microcanonical (NVE) simulations, the numerical integrator should ideally generate trajectories that stay on the constant-energy surface. According to Liouville's theorem, time evolution under a true Hamiltonian preserves the phase-space volume element $dx \\, dp$. Numerical integrators that share this property are known as **symplectic integrators**. A necessary condition for a map to be symplectic is that the determinant of its Jacobian must be exactly $1$.\n\nOur finding that $\\det J = 0$ for the Beeman algorithm's augmented map starkly shows that it is **not symplectic**. This non-conservation of the augmented phase-space volume is a definitive indicator that the algorithm does not respect the geometric structure of Hamiltonian dynamics. Consequently, the Beeman algorithm will not conserve energy over long simulation times; it typically exhibits a secular drift in the total energy. Therefore, despite its higher-order local accuracy, the Beeman integrator's lack of symplecticity makes it unsuitable for long NVE molecular dynamics simulations where energy conservation is a primary requirement.", "answer": "$$\n\\boxed{0}\n$$", "id": "3396840"}]}