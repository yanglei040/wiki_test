{"hands_on_practices": [{"introduction": "The choice of coordinates in a simulation is more than a matter of convenience; it fundamentally affects how we describe the system's phase space. This exercise explores the transformation from Cartesian to internal coordinates for a diatomic molecule, requiring the derivation of the Jacobian determinant [@problem_id:3426902]. Understanding this essential metric factor is key to correctly sampling the canonical ensemble and interpreting kinetic energy in terms of temperature.", "problem": "Consider a free, isolated diatomic molecule consisting of two point masses $m_{1}$ and $m_{2}$ in three-dimensional space with Cartesian position vectors $\\mathbf{r}_{1}$ and $\\mathbf{r}_{2}$. Introduce the center-of-mass (COM) coordinate $\\mathbf{R}_{\\mathrm{cm}}$ and the internal separation vector $\\mathbf{s} = \\mathbf{r}_{2} - \\mathbf{r}_{1}$. Represent the internal vector $\\mathbf{s}$ in spherical coordinates $(R,\\theta,\\phi)$, defined by the standard relations $s_{x} = R \\sin\\theta \\cos\\phi$, $s_{y} = R \\sin\\theta \\sin\\phi$, and $s_{z} = R \\cos\\theta$, where $R \\ge 0$, $\\theta \\in [0,\\pi]$, and $\\phi \\in [0,2\\pi)$.\n\nUsing only fundamental definitions of coordinate transformations and phase-space measures, and starting from the Newtonian kinetic energy $T = \\frac{1}{2} m v^{2}$ together with the reduced mass $\\mu = \\frac{m_{1} m_{2}}{m_{1} + m_{2}}$, do the following:\n\n(a) Derive the Jacobian determinant $J(R,\\theta)$ for the transformation from the Cartesian components $(s_{x},s_{y},s_{z})$ to the internal spherical coordinates $(R,\\theta,\\phi)$, defined implicitly by $\\mathrm{d}^{3}\\mathbf{s} = J(R,\\theta)\\,\\mathrm{d}R\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$.\n\n(b) Explain how $J(R,\\theta)$ enters the canonical configurational probability density $p(R,\\theta,\\phi)$ (up to a normalization constant) for Molecular Dynamics (MD) sampling in the canonical ensemble, assuming an isotropic potential energy $U(R)$ that depends only on $R$. Then, from the kinetic energy of the relative motion expressed in $(R,\\theta,\\phi)$ and their time derivatives $(\\dot{R},\\dot{\\theta},\\dot{\\phi})$, discuss how to construct a temperature estimator from internal velocities that is consistent with the Maxwell–Boltzmann (MB) distribution and the principle of equipartition of energy.\n\nProvide your final answer as a single closed-form analytic expression for $J(R,\\theta)$. No numerical rounding is required. Do not include units in your final expression.", "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It is a standard exercise in classical and statistical mechanics relevant to molecular dynamics.\n\n**(a) Derivation of the Jacobian Determinant $J(R,\\theta)$**\n\nThe problem asks for the Jacobian determinant $J(R,\\theta)$ for the transformation from Cartesian coordinates $(s_x, s_y, s_z)$ of the internal separation vector $\\mathbf{s}$ to spherical coordinates $(R, \\theta, \\phi)$. The volume element in Cartesian coordinates is $\\mathrm{d}^3\\mathbf{s} = \\mathrm{d}s_x \\mathrm{d}s_y \\mathrm{d}s_z$. The transformation to spherical coordinates introduces a Jacobian factor such that the volume element becomes $\\mathrm{d}^3\\mathbf{s} = |J_{\\det}| \\, \\mathrm{d}R \\, \\mathrm{d}\\theta \\, \\mathrm{d}\\phi$, where $J_{\\det}$ is the determinant of the Jacobian matrix. The problem defines $J(R,\\theta)$ as this factor, so $J(R,\\theta) = |J_{\\det}|$.\n\nThe transformation equations are given as:\n$$s_x = R \\sin\\theta \\cos\\phi$$\n$$s_y = R \\sin\\theta \\sin\\phi$$\n$$s_z = R \\cos\\theta$$\n\nThe Jacobian determinant, $J_{\\det}$, is the determinant of the matrix of partial derivatives $\\frac{\\partial(s_x, s_y, s_z)}{\\partial(R, \\theta, \\phi)}$:\n$$\nJ_{\\det} = \\det \\begin{pmatrix} \\frac{\\partial s_x}{\\partial R} & \\frac{\\partial s_x}{\\partial \\theta} & \\frac{\\partial s_x}{\\partial \\phi} \\\\ \\frac{\\partial s_y}{\\partial R} & \\frac{\\partial s_y}{\\partial \\theta} & \\frac{\\partial s_y}{\\partial \\phi} \\\\ \\frac{\\partial s_z}{\\partial R} & \\frac{\\partial s_z}{\\partial \\theta} & \\frac{\\partial s_z}{\\partial \\phi} \\end{pmatrix}\n$$\nFirst, we compute the required partial derivatives:\n$$\n\\begin{matrix}\n\\frac{\\partial s_x}{\\partial R} = \\sin\\theta \\cos\\phi & \\quad & \\frac{\\partial s_x}{\\partial \\theta} = R \\cos\\theta \\cos\\phi & \\quad & \\frac{\\partial s_x}{\\partial \\phi} = -R \\sin\\theta \\sin\\phi \\\\\n\\frac{\\partial s_y}{\\partial R} = \\sin\\theta \\sin\\phi & \\quad & \\frac{\\partial s_y}{\\partial \\theta} = R \\cos\\theta \\sin\\phi & \\quad & \\frac{\\partial s_y}{\\partial \\phi} = R \\sin\\theta \\cos\\phi \\\\\n\\frac{\\partial s_z}{\\partial R} = \\cos\\theta & \\quad & \\frac{\\partial s_z}{\\partial \\theta} = -R \\sin\\theta & \\quad & \\frac{\\partial s_z}{\\partial \\phi} = 0\n\\end{matrix}\n$$\nNow, we construct the Jacobian matrix and compute its determinant.\n$$\nJ_{\\det} = \\begin{vmatrix}\n\\sin\\theta \\cos\\phi & R \\cos\\theta \\cos\\phi & -R \\sin\\theta \\sin\\phi \\\\\n\\sin\\theta \\sin\\phi & R \\cos\\theta \\sin\\phi & R \\sin\\theta \\cos\\phi \\\\\n\\cos\\theta & -R \\sin\\theta & 0\n\\end{vmatrix}\n$$\nExpanding the determinant along the third row:\n$$\nJ_{\\det} = \\cos\\theta \\begin{vmatrix} R \\cos\\theta \\cos\\phi & -R \\sin\\theta \\sin\\phi \\\\ R \\cos\\theta \\sin\\phi & R \\sin\\theta \\cos\\phi \\end{vmatrix} - (-R \\sin\\theta) \\begin{vmatrix} \\sin\\theta \\cos\\phi & -R \\sin\\theta \\sin\\phi \\\\ \\sin\\theta \\sin\\phi & R \\sin\\theta \\cos\\phi \\end{vmatrix} + 0\n$$\nWe evaluate the two $2 \\times 2$ determinants:\n$$\n\\det_1 = (R \\cos\\theta \\cos\\phi)(R \\sin\\theta \\cos\\phi) - (-R \\sin\\theta \\sin\\phi)(R \\cos\\theta \\sin\\phi) \\\\\n= R^2 \\sin\\theta \\cos\\theta \\cos^2\\phi + R^2 \\sin\\theta \\cos\\theta \\sin^2\\phi \\\\\n= R^2 \\sin\\theta \\cos\\theta (\\cos^2\\phi + \\sin^2\\phi) = R^2 \\sin\\theta \\cos\\theta\n$$\n$$\n\\det_2 = (\\sin\\theta \\cos\\phi)(R \\sin\\theta \\cos\\phi) - (-R \\sin\\theta \\sin\\phi)(\\sin\\theta \\sin\\phi) \\\\\n= R \\sin^2\\theta \\cos^2\\phi + R \\sin^2\\theta \\sin^2\\phi \\\\\n= R \\sin^2\\theta (\\cos^2\\phi + \\sin^2\\phi) = R \\sin^2\\theta\n$$\nSubstituting these back into the expression for $J_{\\det}$:\n$$\nJ_{\\det} = \\cos\\theta (R^2 \\sin\\theta \\cos\\theta) + R \\sin\\theta (R \\sin^2\\theta) \\\\\n= R^2 \\sin\\theta \\cos^2\\theta + R^2 \\sin^3\\theta \\\\\n= R^2 \\sin\\theta (\\cos^2\\theta + \\sin^2\\theta) = R^2 \\sin\\theta\n$$\nThe Jacobian determinant is $J_{\\det} = R^2 \\sin\\theta$. The problem defines $J(R, \\theta)$ through the volume element $\\mathrm{d}^3\\mathbf{s} = J(R,\\theta)\\,\\mathrm{d}R\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$. This requires the absolute value of the determinant. For the given coordinate ranges $R \\ge 0$ and $\\theta \\in [0,\\pi]$, the term $\\sin\\theta$ is non-negative, so $|J_{\\det}| = R^2 \\sin\\theta$.\nTherefore, the Jacobian is $J(R, \\theta) = R^{2}\\sin\\theta$.\n\n**(b) Implications for Statistical Mechanics and Temperature Estimation**\n\nThe Jacobian $J(R,\\theta)$ plays a crucial role in formulating statistical mechanical averages in the internal coordinates.\n\n**Canonical Configurational Probability Density:**\nIn the canonical ensemble (constant number of particles $N$, volume $V$, and temperature $T$), the probability of observing a system in a specific microscopic configuration is proportional to the Boltzmann factor, $\\exp(-U / (k_B T))$, where $U$ is the potential energy of that configuration and $k_B$ is the Boltzmann constant.\nFor MD sampling, we are interested in the probability density function over the chosen coordinate space. The coordinates for the internal degrees of freedom are $(R, \\theta, \\phi)$. The probability $\\mathrm{d}P$ of finding the system's configuration within an infinitesimal volume element of configuration space is given by:\n$$ \\mathrm{d}P \\propto \\exp\\left(-\\frac{U(\\text{config})}{k_B T}\\right) \\mathrm{d}V_{\\text{config}} $$\nThe potential energy is given as an isotropic function $U(R)$. The volume element in the $3$D space inhabited by the vector $\\mathbf{s}$ is $\\mathrm{d}^3\\mathbf{s}$. As shown in part (a), when expressed in spherical coordinates, this volume element is not simply $\\mathrm{d}R\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$, but $\\mathrm{d}^3\\mathbf{s} = R^2 \\sin\\theta \\, \\mathrm{d}R\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi = J(R, \\theta) \\, \\mathrm{d}R\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$.\nThe probability of finding the internal configuration in the range $[R, R+\\mathrm{d}R]$, $[\\theta, \\theta+\\mathrm{d}\\theta]$, and $[\\phi, \\phi+\\mathrm{d}\\phi]$ is:\n$$ \\mathrm{d}P(R, \\theta, \\phi) \\propto \\exp\\left(-\\frac{U(R)}{k_B T}\\right) J(R, \\theta) \\, \\mathrm{d}R\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi $$\nThe canonical configurational probability density $p(R, \\theta, \\phi)$ is defined by $\\mathrm{d}P = p(R, \\theta, \\phi) \\, \\mathrm{d}R\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$. Thus, up to a normalization constant $C$:\n$$ p(R, \\theta, \\phi) = C \\exp\\left(-\\frac{U(R)}{k_B T}\\right) R^2 \\sin\\theta $$\nThe Jacobian $J(R, \\theta) = R^2 \\sin\\theta$ acts as a metric factor or a phase-space volume factor. It ensures that configurations are sampled with the correct statistical weight. For example, states with $\\theta$ close to $\\pi/2$ occupy more \"volume\" in the Cartesian space than states with $\\theta$ close to $0$ or $\\pi$. This factor must be included in MD simulations that use these internal coordinates to sample the canonical ensemble correctly.\n\n**Temperature Estimator from Internal Velocities:**\nThe total kinetic energy of the diatomic molecule is $T_{total} = \\frac{1}{2}m_1|\\dot{\\mathbf{r}}_1|^2 + \\frac{1}{2}m_2|\\dot{\\mathbf{r}}_2|^2$. By transforming to center-of-mass $\\mathbf{R}_{\\mathrm{cm}}$ and relative coordinates $\\mathbf{s}$, the kinetic energy separates into two independent terms:\n$$ T_{total} = T_{\\mathrm{cm}} + T_{\\mathrm{rel}} = \\frac{1}{2}(m_1+m_2)|\\dot{\\mathbf{R}}_{\\mathrm{cm}}|^2 + \\frac{1}{2}\\mu|\\dot{\\mathbf{s}}|^2 $$\nwhere $\\mu = \\frac{m_1 m_2}{m_1+m_2}$ is the reduced mass. We are concerned with the internal motion, which is described by the relative kinetic energy $T_{\\mathrm{rel}} = \\frac{1}{2}\\mu|\\dot{\\mathbf{s}}|^2$.\n\nTo express $T_{\\mathrm{rel}}$ in spherical coordinates, we find the expression for $|\\dot{\\mathbf{s}}|^2$. The velocity vector $\\dot{\\mathbf{s}}$ in the orthonormal spherical basis $(\\mathbf{\\hat{r}}, \\mathbf{\\hat{\\theta}}, \\mathbf{\\hat{\\phi}})$ is:\n$$ \\dot{\\mathbf{s}} = \\dot{R}\\mathbf{\\hat{r}} + R\\dot{\\theta}\\mathbf{\\hat{\\theta}} + R\\sin\\theta\\dot{\\phi}\\mathbf{\\hat{\\phi}} $$\nThe squared magnitude is:\n$$ |\\dot{\\mathbf{s}}|^2 = \\dot{R}^2 + (R\\dot{\\theta})^2 + (R\\sin\\theta\\dot{\\phi})^2 = \\dot{R}^2 + R^2\\dot{\\theta}^2 + R^2\\sin^2\\theta\\dot{\\phi}^2 $$\nSubstituting this into the expression for $T_{\\mathrm{rel}}$:\n$$ T_{\\mathrm{rel}} = \\frac{1}{2}\\mu \\left(\\dot{R}^2 + R^2\\dot{\\theta}^2 + R^2\\sin^2\\theta\\dot{\\phi}^2\\right) $$\nTo apply the principle of equipartition of energy, we must identify the quadratic degrees of freedom in the Hamiltonian. The Hamiltonian for the relative motion is $H_{\\mathrm{rel}} = T_{\\mathrm{rel}} + U(R)$. The conjugate momenta are:\n$$ p_R = \\frac{\\partial T_{\\mathrm{rel}}}{\\partial \\dot{R}} = \\mu \\dot{R} $$\n$$ p_\\theta = \\frac{\\partial T_{\\mathrm{rel}}}{\\partial \\dot{\\theta}} = \\mu R^2 \\dot{\\theta} $$\n$$ p_\\phi = \\frac{\\partial T_{\\mathrm{rel}}}{\\partial \\dot{\\phi}} = \\mu R^2 \\sin^2\\theta \\dot{\\phi} $$\nExpressing $T_{\\mathrm{rel}}$ in terms of these momenta:\n$$ T_{\\mathrm{rel}} = \\frac{p_R^2}{2\\mu} + \\frac{p_\\theta^2}{2\\mu R^2} + \\frac{p_\\phi^2}{2\\mu R^2 \\sin^2\\theta} $$\nThe Hamiltonian for the relative motion has $3$ kinetic terms, each quadratic in one of the momentum components. The Maxwell-Boltzmann distribution for these momenta in the canonical ensemble implies that the average energy of each of these terms is $\\frac{1}{2}k_B T$. This is the principle of equipartition.\n$$ \\left\\langle \\frac{p_R^2}{2\\mu} \\right\\rangle = \\frac{1}{2}k_B T, \\quad \\left\\langle \\frac{p_\\theta^2}{2\\mu R^2} \\right\\rangle = \\frac{1}{2}k_B T, \\quad \\left\\langle \\frac{p_\\phi^2}{2\\mu R^2 \\sin^2\\theta} \\right\\rangle = \\frac{1}{2}k_B T $$\nThe total average kinetic energy for the relative motion is the sum of these averages:\n$$ \\langle T_{\\mathrm{rel}} \\rangle = \\frac{3}{2}k_B T $$\nIn an MD simulation, the instantaneous kinetic energy $T_{\\mathrm{rel}}$ can be computed at each timestep from the coordinates $(R, \\theta, \\phi)$ and their time derivatives $(\\dot{R}, \\dot{\\theta}, \\dot{\\phi})$. The time average of this instantaneous kinetic energy, denoted $\\langle T_{\\mathrm{rel}} \\rangle_{MD}$, is an estimator for the ensemble average $\\langle T_{\\mathrm{rel}} \\rangle$. Therefore, a consistent temperature estimator is found by equating the MD average to the theoretical ensemble average:\n$$ \\frac{3}{2}k_B T = \\langle T_{\\mathrm{rel}} \\rangle_{MD} = \\left\\langle \\frac{1}{2}\\mu \\left(\\dot{R}^2 + R^2\\dot{\\theta}^2 + R^2\\sin^2\\theta\\dot{\\phi}^2\\right) \\right\\rangle_{MD} $$\nSolving for $T$ gives the temperature estimator:\n$$ T = \\frac{2}{3k_B} \\langle T_{\\mathrm{rel}} \\rangle_{MD} = \\frac{\\mu}{3k_B} \\left\\langle \\dot{R}^2 + R^2\\dot{\\theta}^2 + R^2\\sin^2\\theta\\dot{\\phi}^2 \\right\\rangle_{MD} $$\nThis estimator is consistent with the Maxwell-Boltzmann distribution because the derivation of the equipartition theorem relies on integrating over the MB distribution of momenta, which is proportional to $\\exp(-H_{kin}/(k_B T))$.", "answer": "$$\n\\boxed{R^{2}\\sin\\theta}\n$$", "id": "3426902"}, {"introduction": "As molecular complexity increases, the kinetic energy expression in internal coordinates often reveals non-trivial couplings between different motions. This practice moves from a diatomic to a triatomic molecule to demonstrate this effect by explicitly constructing the mass-metric tensor, or G-matrix [@problem_id:3426928]. You will uncover how the molecule's geometry, specifically the bond angle, creates a kinetic link between the two bond-stretching motions.", "problem": "Consider a non-linear triatomic molecule composed of atoms $A$, $B$, and $C$ with masses $m_A$, $m_B$, and $m_C$, respectively. Let the internal coordinates be $q = (r_1, r_2, \\theta)$, where $r_1$ is the bond length $A$–$B$, $r_2$ is the bond length $B$–$C$, and $\\theta$ is the bond angle at $B$. Adopt the following physically motivated representation to eliminate overall translations and rotations:\n\n- Constrain the molecular plane to be the $x$–$y$ plane.\n- Fix the orientation by requiring the vector from $B$ to $A$ to lie along the positive $x$-axis.\n- Impose the center-of-mass constraint so that the center of mass is at the origin.\n\nWith these conventions, define the position vectors relative to atom $B$ as $r_A = (r_1, 0, 0)$ and $r_C = (r_2 \\cos\\theta, r_2 \\sin\\theta, 0)$, and write the absolute Cartesian positions $R_A(q)$, $R_B(q)$, $R_C(q)$ that satisfy the center-of-mass constraint. Using the fundamental definition of kinetic energy $T = \\frac{1}{2} \\sum_{i \\in \\{A,B,C\\}} m_i \\left|\\dot{R}_i\\right|^2$ and the kinematic relation $\\dot{R} = J(q)\\,\\dot{q}$, where $J(q)$ is the Jacobian of the Cartesian embedding with respect to $q$, it follows that $T = \\frac{1}{2}\\,\\dot{q}^{\\mathsf{T}} G(q)\\, \\dot{q}$ with the mass-metric $G(q) = J(q)^{\\mathsf{T}} M J(q)$ and $M = \\mathrm{diag}(m_A I_3, m_B I_3, m_C I_3)$. \n\nTasks:\n- Explicitly construct the Jacobian $J(q)$ by differentiating $R_A(q)$, $R_B(q)$, $R_C(q)$ with respect to $r_1$, $r_2$, and $\\theta$.\n- Compute the mass-metric $G(q)$ and identify which off-diagonal entries encode couplings between $\\dot{r}_1$, $\\dot{r}_2$, and $\\dot{\\theta}$ in the kinetic energy.\n\nAnswer specification:\n- Let $M = m_A + m_B + m_C$.\n- Your final answer must be the single, closed-form analytic expression for the coupling coefficient $g_{r_1 r_2}(q)$ appearing in $G(q)$.\n- No numerical evaluation is required and no rounding is needed. Express your final answer symbolically in terms of $m_A$, $m_B$, $m_C$, $M$, and $\\theta$.", "solution": "### Step 1: Extract Givens\n- A non-linear triatomic molecule with atoms $A$, $B$, $C$ and masses $m_A$, $m_B$, $m_C$.\n- Total mass $M = m_A + m_B + m_C$.\n- Internal coordinates are $q = (r_1, r_2, \\theta)$, where $r_1$ is the bond length $A$–$B$, $r_2$ is the bond length $B$–$C$, and $\\theta$ is the bond angle at $B$.\n- The molecular plane is the $x$–$y$ plane.\n- The vector from $B$ to $A$ lies along the positive $x$-axis.\n- The center of mass is at the origin: $\\sum_{i \\in \\{A,B,C\\}} m_i R_i = 0$.\n- Position vectors relative to atom $B$ are $r_A = (r_1, 0, 0)$ and $r_C = (r_2 \\cos\\theta, r_2 \\sin\\theta, 0)$.\n- The kinetic energy is $T = \\frac{1}{2} \\sum_{i} m_i |\\dot{R}_i|^2 = \\frac{1}{2}\\,\\dot{q}^{\\mathsf{T}} G(q)\\, \\dot{q}$.\n- The mass-metric tensor is $G(q) = J(q)^{\\mathsf{T}} M J(q)$, where $M = \\mathrm{diag}(m_A I_3, m_B I_3, m_C I_3)$.\n- An element of the $G$ matrix is given by $G_{ij}(q) = \\sum_{k \\in \\{A,B,C\\}} m_k \\frac{\\partial R_k}{\\partial q_i} \\cdot \\frac{\\partial R_k}{\\partial q_j}$.\n- The task is to compute the coupling coefficient $g_{r_1 r_2}(q)$, which is the element $G_{12}(q)$ of the mass-metric tensor.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded:** The problem describes a standard formulation of molecular kinetic energy in internal coordinates, a fundamental concept in chemical physics and molecular dynamics. The use of a mass-metric tensor (or G-matrix in Wilson's formalism) is a well-established method. The constraints are physically realistic ways to separate internal motion from overall translation and rotation. The problem is scientifically sound.\n- **Well-Posed:** The problem provides all necessary definitions and constraints to uniquely determine the Cartesian coordinates as a function of the internal coordinates, and subsequently the Jacobian and the G-matrix. The goal is to find a specific, well-defined mathematical quantity. The problem is well-posed.\n- **Objective:** The problem is stated in precise mathematical and physical terms, free from any subjective or biased language.\n\n### Step 3: Verdict and Action\nThe problem is valid as it is scientifically grounded, well-posed, objective, and complete. I will proceed with the solution.\n\n### Solution Derivation\nThe first step is to determine the absolute Cartesian position vectors $R_A$, $R_B$, and $R_C$ as functions of the internal coordinates $q = (r_1, r_2, \\theta)$. The position vectors relative to atom $B$ are given as $r_A$ and $r_C$. We can write the absolute positions as:\n$R_A = R_B + r_A$\n$R_C = R_B + r_C$\n\nThe center-of-mass (COM) constraint is given by:\n$$m_A R_A + m_B R_B + m_C R_C = 0$$\nSubstituting the relative positions into the COM constraint equation:\n$$m_A (R_B + r_A) + m_B R_B + m_C (R_B + r_C) = 0$$\n$$(m_A + m_B + m_C) R_B + m_A r_A + m_C r_C = 0$$\nUsing the definition $M = m_A + m_B + m_C$, we solve for $R_B$:\n$$R_B = -\\frac{1}{M} (m_A r_A + m_C r_C)$$\nNow we can express $R_A$ and $R_C$ in terms of $r_A$ and $r_C$:\n$$R_A = R_B + r_A = r_A - \\frac{1}{M} (m_A r_A + m_C r_C) = \\left(1 - \\frac{m_A}{M}\\right) r_A - \\frac{m_C}{M} r_C = \\frac{m_B+m_C}{M} r_A - \\frac{m_C}{M} r_C$$\n$$R_C = R_B + r_C = r_C - \\frac{1}{M} (m_A r_A + m_C r_C) = -\\frac{m_A}{M} r_A + \\left(1 - \\frac{m_C}{M}\\right) r_C = -\\frac{m_A}{M} r_A + \\frac{m_A+m_B}{M} r_C$$\n\nThe problem asks for the coupling coefficient $g_{r_1 r_2}(q)$, which is the element $G_{12}$ of the mass-metric tensor $G$. The internal coordinates are $q_1=r_1$, $q_2=r_2$, and $q_3=\\theta$. The element $G_{r_1 r_2}$ is given by:\n$$g_{r_1 r_2}(q) = G_{r_1 r_2} = \\sum_{k \\in \\{A,B,C\\}} m_k \\left( \\frac{\\partial R_k}{\\partial r_1} \\cdot \\frac{\\partial R_k}{\\partial r_2} \\right)$$\nWe need to calculate the partial derivatives of the Cartesian position vectors with respect to $r_1$ and $r_2$. The vectors $r_A$ and $r_C$ depend on the internal coordinates as:\n$r_A(q) = (r_1, 0, 0)$\n$r_C(q) = (r_2 \\cos\\theta, r_2 \\sin\\theta, 0)$\nTheir partial derivatives are:\n$\\frac{\\partial r_A}{\\partial r_1} = (1, 0, 0)$; $\\frac{\\partial r_A}{\\partial r_2} = (0, 0, 0)$\n$\\frac{\\partial r_C}{\\partial r_1} = (0, 0, 0)$; $\\frac{\\partial r_C}{\\partial r_2} = (\\cos\\theta, \\sin\\theta, 0)$\n\nNow, we compute the derivatives of the absolute positions $R_A, R_B, R_C$:\nFor $r_1$:\n$$\\frac{\\partial R_A}{\\partial r_1} = \\frac{m_B+m_C}{M} \\frac{\\partial r_A}{\\partial r_1} = \\frac{m_B+m_C}{M} (1, 0, 0)$$\n$$\\frac{\\partial R_B}{\\partial r_1} = -\\frac{m_A}{M} \\frac{\\partial r_A}{\\partial r_1} = -\\frac{m_A}{M} (1, 0, 0)$$\n$$\\frac{\\partial R_C}{\\partial r_1} = -\\frac{m_A}{M} \\frac{\\partial r_A}{\\partial r_1} = -\\frac{m_A}{M} (1, 0, 0)$$\n\nFor $r_2$:\n$$\\frac{\\partial R_A}{\\partial r_2} = -\\frac{m_C}{M} \\frac{\\partial r_C}{\\partial r_2} = -\\frac{m_C}{M} (\\cos\\theta, \\sin\\theta, 0)$$\n$$\\frac{\\partial R_B}{\\partial r_2} = -\\frac{m_C}{M} \\frac{\\partial r_C}{\\partial r_2} = -\\frac{m_C}{M} (\\cos\\theta, \\sin\\theta, 0)$$\n$$\\frac{\\partial R_C}{\\partial r_2} = \\frac{m_A+m_B}{M} \\frac{\\partial r_C}{\\partial r_2} = \\frac{m_A+m_B}{M} (\\cos\\theta, \\sin\\theta, 0)$$\n\nNext, we compute the dot products for each atom:\n$$\\frac{\\partial R_A}{\\partial r_1} \\cdot \\frac{\\partial R_A}{\\partial r_2} = \\left(\\frac{m_B+m_C}{M}\\right)\\left(-\\frac{m_C}{M}\\right) (1,0,0) \\cdot (\\cos\\theta, \\sin\\theta, 0) = -\\frac{m_C(m_B+m_C)}{M^2} \\cos\\theta$$\n$$\\frac{\\partial R_B}{\\partial r_1} \\cdot \\frac{\\partial R_B}{\\partial r_2} = \\left(-\\frac{m_A}{M}\\right)\\left(-\\frac{m_C}{M}\\right) (1,0,0) \\cdot (\\cos\\theta, \\sin\\theta, 0) = \\frac{m_A m_C}{M^2} \\cos\\theta$$\n$$\\frac{\\partial R_C}{\\partial r_1} \\cdot \\frac{\\partial R_C}{\\partial r_2} = \\left(-\\frac{m_A}{M}\\right)\\left(\\frac{m_A+m_B}{M}\\right) (1,0,0) \\cdot (\\cos\\theta, \\sin\\theta, 0) = -\\frac{m_A(m_A+m_B)}{M^2} \\cos\\theta$$\n\nFinally, we assemble the expression for $g_{r_1 r_2}$ by summing these terms weighted by their respective masses:\n$$g_{r_1 r_2} = m_A \\left(-\\frac{m_C(m_B+m_C)}{M^2} \\cos\\theta\\right) + m_B \\left(\\frac{m_A m_C}{M^2} \\cos\\theta\\right) + m_C \\left(-\\frac{m_A(m_A+m_B)}{M^2} \\cos\\theta\\right)$$\nFactoring out the common term $\\frac{\\cos\\theta}{M^2}$:\n$$g_{r_1 r_2} = \\frac\n{\\cos\\theta}{M^2} \\left[ -m_A m_C(m_B+m_C) + m_A m_B m_C - m_A m_C(m_A+m_B) \\right]$$\nExpanding the terms inside the brackets:\n$$g_{r_1 r_2} = \\frac{\\cos\\theta}{M^2} \\left[ -m_A m_B m_C - m_A m_C^2 + m_A m_B m_C - m_A^2 m_C - m_A m_B m_C \\right]$$\nThe terms $+m_A m_B m_C$ and one $-m_A m_B m_C$ cancel out:\n$$g_{r_1 r_2} = \\frac{\\cos\\theta}{M^2} \\left[ -m_A m_C^2 - m_A^2 m_C - m_A m_B m_C \\right]$$\nFactoring out $-m_A m_C$:\n$$g_{r_1 r_2} = \\frac{\\cos\\theta}{M^2} \\left[ -m_A m_C (m_C + m_A + m_B) \\right]$$\nRecognizing that $m_A+m_B+m_C = M$:\n$$g_{r_1 r_2} = \\frac{\\cos\\theta}{M^2} \\left[ -m_A m_C M \\right]$$\nSimplifying the expression by canceling one factor of $M$:\n$$g_{r_1 r_2}(q) = - \\frac{m_A m_C}{M} \\cos\\theta$$\nThis is the coupling coefficient between the two bond stretching coordinates, $r_1$ and $r_2$.", "answer": "$$\\boxed{- \\frac{m_A m_C}{M} \\cos(\\theta)}$$", "id": "3426928"}, {"introduction": "In practical molecular modeling, it is often easier to define a chemically intuitive but redundant set of internal coordinates than a minimal, non-redundant one. This computational practice addresses how to diagnose and resolve such redundancies using the powerful tools of linear algebra [@problem_id:3426888]. By numerically constructing the Wilson B-matrix and analyzing its singular values, you will learn a robust, algorithmic approach to regularizing a coordinate system, a vital skill for advanced simulations.", "problem": "You are given a triatomic molecule with atoms labeled $O$, $H_1$, and $H_2$ and a redundant set of internal coordinates consisting of the following four scalar functions: $q_1 =$ the bond length $r(O,H_1)$ in $\\mathrm{\\AA}$, $q_2 =$ the bond length $r(O,H_2)$ in $\\mathrm{\\AA}$, $q_3 =$ the bond angle $\\angle(H_1\\text{--}O\\text{--}H_2)$ in radians, and $q_4 =$ the nonbonded distance $r(H_1,H_2)$ in $\\mathrm{\\AA}$. Let the Cartesian coordinates of the three atoms be stacked as a single vector $x \\in \\mathbb{R}^{9}$ ordered by atom $(O, H_1, H_2)$ and by component $(x,y,z)$ per atom.\n\nDefine the Wilson $B$-matrix as the Jacobian of internal coordinates with respect to Cartesian coordinates, whose entries are\n$$\nB_{k,\\alpha i} \\equiv \\frac{\\partial q_k}{\\partial r_{i\\alpha}},\n$$\nwhere $k \\in \\{1,2,3,4\\}$ indexes internal coordinates, $i \\in \\{O,H_1,H_2\\}$ indexes atoms, and $\\alpha \\in \\{x,y,z\\}$ indexes Cartesian components. Thus, $B \\in \\mathbb{R}^{4 \\times 9}$.\n\nTask:\n- Starting from the definition of the internal coordinates as geometric functions of the Cartesian coordinates and the definition of $B$ as a Jacobian, construct a numerical approximation of $B$ using central finite differences. Use a symmetric perturbation of size $h$ applied to each Cartesian component, and approximate each partial derivative by\n$$\n\\frac{\\partial q_k}{\\partial r_{i\\alpha}} \\approx \\frac{q_k(x + h e_{i\\alpha}) - q_k(x - h e_{i\\alpha})}{2h},\n$$\nwhere $e_{i\\alpha}$ is the unit vector in $\\mathbb{R}^{9}$ that perturbs the corresponding Cartesian component. Choose $h$ in $\\mathrm{\\AA}$.\n- Compute the singular values of $B$ via Singular Value Decomposition (SVD). Report the singular values in descending order. Use the singular values to identify near-linear dependencies among the internal coordinates by comparing the smallest singular values to the largest one. A near-linear dependency is defined here as any singular value $s$ for which $s / s_{\\max} < \\tau$, using a relative threshold $\\tau$.\n- Propose an algorithmic regularization that reduces the redundancy by selecting one internal coordinate to drop. One principled approach is to form the symmetric internal-coordinate metric\n$$\nG \\equiv B B^{\\top} \\in \\mathbb{R}^{4 \\times 4},\n$$\nwhose eigenvalues are the squares of the singular values of $B$, and whose eigenvectors identify linear combinations of internal coordinates. Let $u_{\\min}$ be a unit-norm eigenvector associated with the smallest eigenvalue of $G$. As a concrete, deterministic rule, choose the coordinate index $j^\\star \\in \\{0,1,2,3\\}$ (zero-based indexing of $\\{q_1,q_2,q_3,q_4\\}$) to drop as the index corresponding to the largest component magnitude of $u_{\\min}$, i.e.,\n$$\nj^\\star = \\arg\\max_{j \\in \\{0,1,2,3\\}} |(u_{\\min})_j|.\n$$\n\nUse the following test suite of Cartesian geometries (all coordinates are in $\\mathrm{\\AA}$, angles are in radians):\n\n- Test case $1$ (bent reference geometry): $O=(0,0,0)$, $H_1=(0.9572,0,0)$, $H_2=(-0.2399872,0.927297,0)$.\n- Test case $2$ (rigid-body rotation about the $z$-axis by $\\phi = 47^\\circ$ applied to Test case $1$): $R_z(\\phi)$ is the rotation about $z$, compute new coordinates by $R_z(\\phi)\\,r$ for each atom $r$, using $\\phi$ in radians.\n- Test case $3$ (near-linear angle $\\angle(H_1\\text{--}O\\text{--}H_2) \\approx 179.9^\\circ$): $O=(0,0,0)$, $H_1=(1,0,0)$, $H_2=(-\\cos\\delta,\\sin\\delta,0)$ with $\\delta = 0.1^\\circ$ expressed in radians.\n- Test case $4$ (symmetric bent, wide angle): $O=(0,0,0)$, $H_1=(1,0,0)$, $H_2=(\\cos(120^\\circ),\\sin(120^\\circ),0)$, with trigonometric arguments converted to radians.\n\nRequirements:\n- Construct $B$ by central finite differences with a uniform scalar step $h$ in $\\mathrm{\\AA}$. Use a robust angle definition based on `atan2` so that the angle $\\angle(H_1\\text{--}O\\text{--}H_2)$ lies in $[0,\\pi]$ radians.\n- Compute the singular values of $B$ in descending order for each test case.\n- For each test case, compute $G = B B^{\\top}$, its smallest-eigenvalue unit eigenvector $u_{\\min}$, and the recommended drop index $j^\\star$ according to the rule above.\n- Use the following constants in every test: $h = 10^{-6}\\ \\mathrm{\\AA}$, $\\tau = 10^{-8}$.\n- Units: input Cartesian coordinates are in $\\mathrm{\\AA}$, and the angle internal coordinate must be computed in radians. Singular values are dimensionless. Report singular values rounded to six decimal places.\n\nFinal output specification:\n- For each test case, produce a result of the form $[svals,drop]$ where $svals$ is the list of the four singular values of $B$ in descending order, each rounded to six decimal places, and $drop$ is the integer index $j^\\star$ to drop (zero-based).\n- Aggregate the four results into a single line: a comma-separated list enclosed in square brackets, for example $[[\\dots],[\\dots],[\\dots],[\\dots]]$ without any whitespace.", "solution": "The user's request is a valid scientific problem. It is well-posed, grounded in the principles of molecular mechanics and linear algebra, and provides all necessary data and definitions for a unique, verifiable solution.\n\n### Principle-Based Design\n\nThe problem requires constructing and analyzing the Wilson B-matrix for a triatomic molecule using a redundant set of internal coordinates. The solution involves numerical differentiation, linear algebra, and an algorithmic approach to identifying and resolving coordinate redundancy.\n\n#### 1. Internal Coordinates ($q_k$) and their Geometric Definitions\n\nThe problem defines a set of four internal coordinates $\\{q_1, q_2, q_3, q_4\\}$ for a triatomic molecule with atoms $O$, $H_1$, and $H_2$. Their definitions depend on the Cartesian coordinate vector $x \\in \\mathbb{R}^9$, where $x = (\\mathbf{r}_O, \\mathbf{r}_{H_1}, \\mathbf{r}_{H_2})$ and $\\mathbf{r}_i = (r_{ix}, r_{iy}, r_{iz})$.\n\n-   **Bond Length $q_1$**: The distance between atoms $O$ and $H_1$.\n    $$q_1(x) = \\|\\mathbf{r}_{H_1} - \\mathbf{r}_O\\|$$\n-   **Bond Length $q_2$**: The distance between atoms $O$ and $H_2$.\n    $$q_2(x) = \\|\\mathbf{r}_{H_2} - \\mathbf{r}_O\\|$$\n-   **Bond Angle $q_3$**: The angle $\\angle(H_1\\text{--}O\\text{--}H_2)$. To ensure numerical stability, especially for angles near $0$ and $\\pi$, this is computed using a two-argument arctangent function. Let $\\mathbf{v}_1 = \\mathbf{r}_{H_1} - \\mathbf{r}_O$ and $\\mathbf{v}_2 = \\mathbf{r}_{H_2} - \\mathbf{r}_O$. The angle $q_3$ is given by:\n    $$q_3(x) = \\mathrm{atan2}(\\|\\mathbf{v}_1 \\times \\mathbf{v}_2\\|, \\mathbf{v}_1 \\cdot \\mathbf{v}_2)$$\n    This definition correctly yields an angle in the range $[0, \\pi]$ radians.\n-   **Nonbonded Distance $q_4$**: The distance between atoms $H_1$ and $H_2$.\n    $$q_4(x) = \\|\\mathbf{r}_{H_1} - \\mathbf{r}_{H_2}\\|$$\n\nThese four coordinates are geometrically related by the Law of Cosines, $q_4^2 = q_1^2 + q_2^2 - 2q_1q_2 \\cos(q_3)$, which introduces a single redundancy into the coordinate set. A non-linear triatomic molecule has only $3N-6=3$ internal degrees of freedom.\n\n#### 2. Wilson B-matrix Construction via Finite Differences\n\nThe Wilson B-matrix is the Jacobian of the internal coordinates with respect to the Cartesian coordinates. Its elements are the partial derivatives $B_{k,j} = \\partial q_k / \\partial x_j$, where $k$ indexes the internal coordinates and $j$ indexes the $9$ Cartesian components. The problem specifies a numerical approximation of these derivatives using the central finite difference method with a step size $h$:\n$$\nB_{k,j} = \\frac{\\partial q_k}{\\partial x_j} \\approx \\frac{q_k(x + h e_j) - q_k(x - h e_j)}{2h}\n$$\nHere, $e_j$ is a unit vector in $\\mathbb{R}^9$ with a $1$ at the $j$-th position and zeros elsewhere. The B-matrix is constructed by iterating through each of the $9$ Cartesian coordinates, applying the symmetric perturbation, calculating the change in the four internal coordinates, and filling the corresponding column of the $4 \\times 9$ B-matrix.\n\n#### 3. Redundancy Analysis using SVD and the G-matrix\n\nThe geometric redundancy among the internal coordinates results in the rows of the B-matrix being linearly dependent. This dependency can be analyzed using Singular Value Decomposition (SVD) of $B$ or, equivalently, by analyzing the eigensystem of the internal-coordinate metric matrix $G$.\n\n-   **Singular Value Decomposition (SVD)**: The SVD of $B$ is $B = U S V^\\top$. The singular values, which form the diagonal of $S$, quantify the \"stretching\" effect of the linear transformation represented by $B$. A singular value of zero (or numerically close to zero, i.e., $s/s_{\\max} < \\tau$) indicates that there is a direction in the input (Cartesian) space that gets mapped to zero in the output (internal) space, corresponding to a rank deficiency. The rank of $B$ reveals the number of independent internal coordinates. For a non-linear triatomic, we expect three significant singular values and one near-zero singular value corresponding to the single redundancy.\n\n-   **Metric Matrix ($G$)**: The matrix $G = BB^\\top$ is a $4 \\times 4$ symmetric matrix. Its eigenvalues are the squares of the singular values of $B$. Therefore, a near-zero singular value of $B$ corresponds to a near-zero eigenvalue of $G$. The eigenvector $u_{\\min}$ associated with the smallest eigenvalue of $G$ is particularly important. It satisfies $G u_{\\min} = (BB^\\top) u_{\\min} \\approx 0$. This implies that the vector $B^\\top u_{\\min}$ is approximately zero, meaning the linear combination of the rows of $B$ (the gradients $\\nabla_x q_k$) weighted by the components of $u_{\\min}$ vanishes:\n    $$ \\sum_{k=1}^4 (u_{\\min})_k \\frac{\\partial q_k}{\\partial x_j} \\approx 0 \\quad \\text{for all } j=1, \\dots, 9 $$\n    Thus, $u_{\\min}$ directly describes the linear combination of internal coordinate gradients that represents the redundancy.\n\n#### 4. Algorithmic Regularization\n\nTo resolve the redundancy, one coordinate must be removed. A principled way to select which coordinate to drop is to identify the one that contributes most significantly to the redundancy. The problem specifies the rule:\n$$\nj^\\star = \\arg\\max_{j \\in \\{0,1,2,3\\}} |(u_{\\min})_j|\n$$\nThis rule identifies the index of the coordinate whose gradient has the largest coefficient in the linear combination that defines the redundancy. This coordinate is considered the most \"dependent\" and is the primary candidate for removal.\n\n### Algorithmic Implementation\n\nThe solution is implemented in Python using the `numpy` library.\n1.  **Test Cases**: The four Cartesian geometries are defined as `numpy` arrays. For Test Cases 2, 3, and 4, angles are converted from degrees to radians as required. Coordinates for Test Case 2 are generated by applying the specified $z$-axis rotation matrix.\n2.  **Internal Coordinate Function**: A helper function `get_internal_coords(x)` is created to compute the four internal coordinates from a 9-element Cartesian vector `x`. This function utilizes `numpy` for vector operations like `linalg.norm`, `cross`, `dot`, and `arctan2`.\n3.  **Main Loop**: The program iterates through each test case.\n    a.  A $4 \\times 9$ B-matrix is initialized.\n    b.  It is populated column-by-column using a loop from $j=0$ to $8$, applying the central difference formula with $h=10^{-6}$.\n    c.  `numpy.linalg.svd` is called on $B$ to obtain the singular values.\n    d.  The G-matrix is computed as $G = B @ B.T$.\n    e.  `numpy.linalg.eigh` is used to find the eigenvalues and eigenvectors of the symmetric matrix $G$. `eigh` conveniently returns eigenvalues in ascending order, so the smallest eigenvalue is the first element, and its corresponding eigenvector is the first column of the returned eigenvector matrix.\n    f.  The drop index $j^\\star$ is found using `numpy.argmax` on the absolute values of the components of this eigenvector $u_{\\min}$.\n4.  **Output Formatting**: The results for each test case—a list of four singular values rounded to six decimal places and the integer drop index—are formatted into a string `[[svals],drop]`. These strings are then aggregated into a final comma-separated list enclosed in square brackets, with no whitespace, to match the problem specification. The calculation for Case 2 serves as a validation, as its results for singular values and the drop index must be identical to Case 1, since the B-matrix is invariant to rigid-body rotations.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the molecular representation problem for four test cases.\n    Constructs the Wilson B-matrix, computes its singular values,\n    and identifies a redundant internal coordinate to drop.\n    \"\"\"\n\n    # --- Test Case Definitions ---\n    # Case 1: Bent reference geometry\n    rO1 = np.array([0.0, 0.0, 0.0])\n    rH1_1 = np.array([0.9572, 0.0, 0.0])\n    rH2_1 = np.array([-0.2399872, 0.927297, 0.0])\n    case1_coords = np.concatenate([rO1, rH1_1, rH2_1])\n\n    # Case 2: Rigid-body rotation of Case 1\n    phi = np.deg2rad(47)\n    Rz = np.array([\n        [np.cos(phi), -np.sin(phi), 0.0],\n        [np.sin(phi),  np.cos(phi), 0.0],\n        [0.0,          0.0,         1.0]\n    ])\n    rO2 = rO1 @ Rz.T  # Origin is invariant\n    rH1_2 = rH1_1 @ Rz.T\n    rH2_2 = rH2_1 @ Rz.T\n    case2_coords = np.concatenate([rO2, rH1_2, rH2_2])\n\n    # Case 3: Near-linear geometry\n    delta = np.deg2rad(0.1)\n    rO3 = np.array([0.0, 0.0, 0.0])\n    rH1_3 = np.array([1.0, 0.0, 0.0])\n    rH2_3 = np.array([-np.cos(delta), np.sin(delta), 0.0])\n    case3_coords = np.concatenate([rO3, rH1_3, rH2_3])\n\n    # Case 4: Symmetric bent, wide angle\n    angle_120 = np.deg2rad(120)\n    rO4 = np.array([0.0, 0.0, 0.0])\n    rH1_4 = np.array([1.0, 0.0, 0.0])\n    rH2_4 = np.array([np.cos(angle_120), np.sin(angle_120), 0.0])\n    case4_coords = np.concatenate([rO4, rH1_4, rH2_4])\n\n    test_cases = [\n        case1_coords,\n        case2_coords,\n        case3_coords,\n        case4_coords\n    ]\n\n    # --- Constants ---\n    h = 1e-6\n\n    def get_internal_coords(x_cart):\n        \"\"\"\n        Computes the four internal coordinates from a 9-vector of Cartesian coords.\n        x_cart: [rOx, rOy, rOz, rH1x, rH1y, rH1z, rH2x, rH2y, rH2z]\n        Returns: [q1, q2, q3, q4]\n        \"\"\"\n        r_o = x_cart[0:3]\n        r_h1 = x_cart[3:6]\n        r_h2 = x_cart[6:9]\n\n        # q1: bond length r(O,H1)\n        q1 = np.linalg.norm(r_h1 - r_o)\n        \n        # q2: bond length r(O,H2)\n        q2 = np.linalg.norm(r_h2 - r_o)\n        \n        # q3: bond angle angle(H1-O-H2)\n        v1 = r_h1 - r_o\n        v2 = r_h2 - r_o\n        \n        cross_prod_norm = np.linalg.norm(np.cross(v1, v2))\n        dot_prod = np.dot(v1, v2)\n        \n        # Use numerically stable arctan2 for the angle in [0, pi]\n        q3 = np.arctan2(cross_prod_norm, dot_prod)\n        \n        # q4: nonbonded distance r(H1,H2)\n        q4 = np.linalg.norm(r_h1 - r_h2)\n        \n        return np.array([q1, q2, q3, q4])\n\n    # --- Main Calculation Loop ---\n    results_data = []\n    \n    for x_ref in test_cases:\n        # Construct B-matrix using central finite differences\n        B = np.zeros((4, 9))\n        for i in range(9):\n            x_plus = x_ref.copy()\n            x_plus[i] += h\n            x_minus = x_ref.copy()\n            x_minus[i] -= h\n            \n            q_plus = get_internal_coords(x_plus)\n            q_minus = get_internal_coords(x_minus)\n            \n            B[:, i] = (q_plus - q_minus) / (2 * h)\n            \n        # Compute singular values of B\n        _, s, _ = np.linalg.svd(B)\n        \n        # Compute G matrix and its eigensystem\n        G = B @ B.T\n        eigenvalues, eigenvectors = np.linalg.eigh(G)\n        \n        # Eigenvector for the smallest eigenvalue (eigh sorts ascendingly)\n        u_min = eigenvectors[:, 0]\n        \n        # Determine coordinate to drop based on the largest component of u_min\n        j_star = np.argmax(np.abs(u_min))\n        \n        results_data.append((s, j_star))\n\n    # --- Final Output Formatting ---\n    result_strings = []\n    for svals, drop_idx in results_data:\n        svals_str = f\"[{','.join(f'{val:.6f}' for val in svals)}]\"\n        result_strings.append(f\"[{svals_str},{drop_idx}]\")\n\n    final_output_str = f\"[{','.join(result_strings)}]\"\n    print(final_output_str)\n\nsolve()\n```", "id": "3426888"}]}