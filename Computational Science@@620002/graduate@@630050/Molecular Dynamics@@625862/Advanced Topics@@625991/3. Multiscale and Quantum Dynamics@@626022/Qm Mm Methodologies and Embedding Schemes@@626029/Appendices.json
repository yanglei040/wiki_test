{"hands_on_practices": [{"introduction": "The cornerstone of any QM/MM simulation is the formulation of the total system energy. This practice focuses on the subtractive scheme, a fundamental approach that combines the accuracy of quantum mechanics for a critical region with the efficiency of molecular mechanics for the broader environment. By working through this problem [@problem_id:3439662], you will master the essential energy expression, ensuring you understand how to avoid the common pitfall of double-counting interactions and correctly assemble the total energy from its constituent parts.", "problem": "A triatomic molecular system is partitioned into two regions for a Quantum Mechanics/Molecular Mechanics (QM/MM) treatment: a Quantum Mechanics (QM) region and a Molecular Mechanics (MM) environment. The goal is to obtain a consistent total energy that replaces the MM description of the QM region with a QM description while retaining the MM description of the entire system, avoiding double counting of the QM region. Consider the following energies, each computed under a distinct model:\n\n- $E_{\\mathrm{QM}}(\\mathrm{QM})=-100.0\\,\\mathrm{kcal/mol}$, the energy of the QM region computed at the Quantum Mechanics level.\n- $E_{\\mathrm{MM}}(\\mathrm{QM}+\\mathrm{MM})=-250.0\\,\\mathrm{kcal/mol}$, the energy of the entire system computed at the Molecular Mechanics level.\n- $E_{\\mathrm{MM}}(\\mathrm{QM})=-120.0\\,\\mathrm{kcal/mol}$, the energy of the QM region computed at the Molecular Mechanics level.\n\nStarting from the conceptual principle that the desired composite energy should reflect the MM description of the entire system with the MM energy of the QM region replaced by its QM energy, derive a suitable subtractive mechanical-embedding expression for the composite energy $E_{\\mathrm{sub}}$ and evaluate it numerically. Then, explain what $E_{\\mathrm{sub}}$ represents physically in the context of subtractive QM/MM embedding and what its value implies about the relative stabilization of the QM region under QM versus MM descriptions. Express the final energy in $\\mathrm{kcal/mol}$. No rounding is required.", "solution": "The problem is first subjected to a rigorous validation process.\n\n### Step 1: Extract Givens\nThe following data and definitions are provided:\n- The energy of the Quantum Mechanics (QM) region computed at the QM level of theory: $E_{\\mathrm{QM}}(\\mathrm{QM}) = -100.0\\,\\mathrm{kcal/mol}$.\n- The energy of the entire system (QM region + Molecular Mechanics (MM) region) computed at the MM level of theory: $E_{\\mathrm{MM}}(\\mathrm{QM}+\\mathrm{MM}) = -250.0\\,\\mathrm{kcal/mol}$.\n- The energy of the QM region computed at the MM level of theory: $E_{\\mathrm{MM}}(\\mathrm{QM}) = -120.0\\,\\mathrm{kcal/mol}$.\n- The task is to derive the subtractive mechanical-embedding expression for the composite energy $E_{\\mathrm{sub}}$, evaluate it, and interpret its physical meaning.\n\n### Step 2: Validate Using Extracted Givens\nThe problem statement is evaluated against the required criteria.\n- **Scientifically Grounded**: The problem describes the subtractive scheme for QM/MM calculations, a cornerstone of multiscale modeling in computational chemistry. The formulation and the concept of avoiding double-counting are standard and scientifically sound.\n- **Well-Posed**: The problem provides all necessary energy terms to construct and evaluate the standard two-layer subtractive QM/MM energy. The objective is to calculate a single, uniquely defined value, $E_{\\mathrm{sub}}$, and provide a standard physical interpretation. A unique, stable, and meaningful solution exists.\n- **Objective**: The problem is expressed using precise, standard terminology from the field of computational chemistry ($E_{\\mathrm{QM}}$, $E_{\\mathrm{MM}}$, QM/MM, etc.) and is free from subjective or ambiguous language.\n\n### Step 3: Verdict and Action\nThe problem is scientifically sound, well-posed, and objective. It is deemed **valid**. Therefore, a full solution will be provided.\n\n### Solution Derivation\nThe objective of a QM/MM calculation is to describe a chemically active region (the QM region) with high-level quantum mechanical theory while treating the rest of the system (the MM environment) with a computationally cheaper molecular mechanics force field. The subtractive scheme is one of the simplest and most common ways to combine these descriptions.\n\nThe core principle, as stated in the problem, is to start with the energy of the entire system calculated at the low level (MM) and then apply a correction. This correction replaces the inaccurate low-level description of the QM region with its accurate high-level description.\n\nLet the entire system be denoted as $\\mathrm{S} = \\mathrm{QM} + \\mathrm{MM}$.\nThe energy of the full system, as calculated by the MM force field, is given as $E_{\\mathrm{MM}}(\\mathrm{S})$, which is equivalent to $E_{\\mathrm{MM}}(\\mathrm{QM}+\\mathrm{MM})$. This term incorrectly describes the QM region.\n\nTo correct this, we must first subtract the contribution of the QM region as calculated at the MM level. This contribution is given as $E_{\\mathrm{MM}}(\\mathrm{QM})$. Removing this term from the total MM energy eliminates the incorrect description of the QM part.\n\nNext, we must add the energy of the QM region as calculated correctly at the QM level of theory. This term is given as $E_{\\mathrm{QM}}(\\mathrm{QM})$.\n\nCombining these steps yields the general expression for the subtractive QM/MM energy, $E_{\\mathrm{sub}}$:\n$$E_{\\mathrm{sub}} = E_{\\mathrm{MM}}(\\mathrm{QM}+\\mathrm{MM}) - E_{\\mathrm{MM}}(\\mathrm{QM}) + E_{\\mathrm{QM}}(\\mathrm{QM})$$\nThis expression avoids the double-counting of the QM region's energy. It represents a model where the QM region's internal energy is determined quantum mechanically, while its interaction with the MM environment, and the MM environment's internal energy, are determined classically. This specific formulation corresponds to a mechanical embedding scheme, as the coupling between the QM and MM regions is contained entirely within the $E_{\\mathrm{MM}}(\\mathrm{QM}+\\mathrm{MM})$ term and is thus described at the MM level only.\n\nNow, we substitute the given numerical values into this expression:\n- $E_{\\mathrm{QM}}(\\mathrm{QM}) = -100.0\\,\\mathrm{kcal/mol}$\n- $E_{\\mathrm{MM}}(\\mathrm{QM}+\\mathrm{MM}) = -250.0\\,\\mathrm{kcal/mol}$\n- $E_{\\mathrm{MM}}(\\mathrm{QM}) = -120.0\\,\\mathrm{kcal/mol}$\n\n$$E_{\\mathrm{sub}} = (-250.0\\,\\mathrm{kcal/mol}) - (-120.0\\,\\mathrm{kcal/mol}) + (-100.0\\,\\mathrm{kcal/mol})$$\n$$E_{\\mathrm{sub}} = -250.0 + 120.0 - 100.0\\,\\mathrm{kcal/mol}$$\n$$E_{\\mathrm{sub}} = -130.0 - 100.0\\,\\mathrm{kcal/mol}$$\n$$E_{\\mathrm{sub}} = -230.0\\,\\mathrm{kcal/mol}$$\n\n### Physical Interpretation\nThe calculated energy, $E_{\\mathrm{sub}} = -230.0\\,\\mathrm{kcal/mol}$, is the estimated total energy of the system within the subtractive QM/MM framework. It represents an approximation of the system's energy where the QM region is described quantum mechanically, and the MM region and QM-MM interactions are described with a classical force field.\n\nThe formula for $E_{\\mathrm{sub}}$ can be rearranged to highlight the correction term:\n$$E_{\\mathrm{sub}} = E_{\\mathrm{MM}}(\\mathrm{QM}+\\mathrm{MM}) + \\left[ E_{\\mathrm{QM}}(\\mathrm{QM}) - E_{\\mathrm{MM}}(\\mathrm{QM}) \\right]$$\nThe term in brackets, $E_{\\mathrm{QM}}(\\mathrm{QM}) - E_{\\mathrm{MM}}(\\mathrm{QM})$, represents the energy correction that arises from switching from an MM description of the QM region to a QM description.\nIn this case, the correction is:\n$$\\Delta E_{\\mathrm{correction}} = (-100.0\\,\\mathrm{kcal/mol}) - (-120.0\\,\\mathrm{kcal/mol}) = +20.0\\,\\mathrm{kcal/mol}$$\nThis positive value implies that the MM force field overstabilizes the isolated QM region by $20.0\\,\\mathrm{kcal/mol}$ compared to the more accurate QM calculation. The QM-level calculation finds the QM-region to be intrinsically less stable (higher in energy) than the MM force field predicts. The subtractive QM/MM energy $E_{\\mathrm{sub}}$ incorporates this correction, resulting in a total energy ($ -230.0\\,\\mathrm{kcal/mol}$) that is higher (less stable) than the purely classical calculation of the entire system ($E_{\\mathrm{MM}}(\\mathrm{QM}+\\mathrm{MM}) = -250.0\\,\\mathrm{kcal/mol}$). This adjustment is crucial for obtaining a more physically realistic energy for the composite system.", "answer": "$$\n\\boxed{-230.0}\n$$", "id": "3439662"}, {"introduction": "Moving beyond the basic energy formula, the next critical concept is the nature of the QM-MM coupling, known as the embedding scheme. This exercise provides a direct comparison between mechanical embedding, where interactions are purely classical, and electrostatic embedding, where the QM region's electronic structure is polarized by the MM charges. By quantifying the energetic difference between these schemes in a clear, hypothetical scenario [@problem_id:3439712], you will develop a tangible intuition for why electrostatic embedding is crucial for accurately describing systems with significant charge interactions.", "problem": "A Quantum Mechanics/Molecular Mechanics (QM/MM) coupling scenario is considered in which a Quantum Mechanics (QM) water molecule is approximated as a fixed point dipole of magnitude $\\mu = 1.85\\,\\mathrm{D}$ located at a center-of-mass position at a separation $r = 3.0\\,\\mathrm{\\AA}$ from a Molecular Mechanics (MM) sodium ion carrying a point charge $q = +1\\,e$. Two QM/MM embedding schemes are examined:\n\n- Mechanical embedding: the QM/MM interaction includes only a Lennard–Jones potential with parameters $\\epsilon = 0.1\\,\\mathrm{kcal/mol}$ and $\\sigma = 3.4\\,\\mathrm{\\AA}$.\n- Electrostatic embedding: in addition to the same Lennard-Jones potential, the MM point charge produces an electric field that interacts with the QM dipole, approximated by the classical point charge–dipole energy.\n\nAssume the dipole moment vector is aligned parallel to the ion–dipole axis with its negative end facing the cation, so that the dipole is aligned with the local electric field of the positive charge and the orientation factor is $\\cos\\theta = 1$ in the classical expression $-\\boldsymbol{\\mu}\\cdot\\mathbf{E}$. Neglect polarization of the dipole magnitude and higher multipole contributions. Use vacuum permittivity implicitly in the classical electrostatics and standard unit conversions. Take $1\\,\\mathrm{D} = 3.33564\\times 10^{-30}\\,\\mathrm{C\\cdot m}$ and $1\\,e\\cdot\\mathrm{\\AA} = 1.602176634\\times 10^{-29}\\,\\mathrm{C\\cdot m}$. Define the energy difference as\n$$\n\\Delta E \\equiv E_{\\mathrm{elec\\;embed}} - E_{\\mathrm{mech\\;embed}}.\n$$\nCompute $\\Delta E$ and express your final numerical answer in $\\mathrm{kcal/mol}$. Round your answer to four significant figures. The angle $\\theta$ is measured in radians, but it is fixed by the alignment specified so that $\\cos\\theta = 1$.", "solution": "The problem statement has been validated and is deemed scientifically grounded, well-posed, and objective. It presents a standard calculation in the field of computational chemistry, specifically concerning Quantum Mechanics/Molecular Mechanics (QM/MM) methodologies. All necessary data and definitions are provided.\n\nThe problem requires the calculation of the energy difference, $\\Delta E$, between two different QM/MM embedding schemes: electrostatic embedding and mechanical embedding. The system consists of a QM water molecule, treated as a point dipole, and an MM sodium ion, treated as a point charge.\n\nFirst, let us define the interaction energy for each scheme as described in the problem.\nThe interaction energy in the mechanical embedding scheme, $E_{\\mathrm{mech\\;embed}}$, includes only the non-bonded Lennard-Jones (LJ) potential:\n$$\nE_{\\mathrm{mech\\;embed}} = E_{\\mathrm{LJ}}\n$$\nThe Lennard-Jones potential is a function of the separation distance $r$. While its parameters ($\\epsilon$ and $\\sigma$) are provided, its explicit form is not necessary for this problem.\n\nThe interaction energy in the electrostatic embedding scheme, $E_{\\mathrm{elec\\;embed}}$, includes both the Lennard-Jones potential and the electrostatic interaction energy, $E_{\\mathrm{elec}}$, between the MM point charge and the QM electron density (approximated here as a point dipole).\n$$\nE_{\\mathrm{elec\\;embed}} = E_{\\mathrm{LJ}} + E_{\\mathrm{elec}}\n$$\nThe problem asks for the energy difference $\\Delta E$:\n$$\n\\Delta E = E_{\\mathrm{elec\\;embed}} - E_{\\mathrm{mech\\;embed}}\n$$\nSubstituting the expressions for the energies of the two schemes, we find that the Lennard-Jones term cancels out:\n$$\n\\Delta E = (E_{\\mathrm{LJ}} + E_{\\mathrm{elec}}) - E_{\\mathrm{LJ}} = E_{\\mathrm{elec}}\n$$\nTherefore, the task reduces to calculating the electrostatic interaction energy between the point charge of the sodium ion and the point dipole of the water molecule.\n\nThe classical electrostatic interaction energy between a point charge $q$ and a point dipole $\\boldsymbol{\\mu}$ is given by the formula:\n$$\nE_{\\mathrm{elec}} = - \\boldsymbol{\\mu} \\cdot \\mathbf{E}\n$$\nwhere $\\mathbf{E}$ is the electric field generated by the point charge $q$ at the location of the dipole. The magnitude of the electric field is $E = \\frac{1}{4\\pi\\epsilon_0} \\frac{|q|}{r^2}$, where $r$ is the distance between the charge and the dipole, and $\\epsilon_0$ is the vacuum permittivity. The energy expression can be written as:\n$$\nE_{\\mathrm{elec}} = - \\frac{1}{4\\pi\\epsilon_0} \\frac{q \\mu \\cos\\theta}{r^2}\n$$\nwhere $\\mu = |\\boldsymbol{\\mu}|$ and $\\theta$ is the angle between the dipole moment vector and the electric field vector. The problem statement specifies that the dipole is aligned with the local electric field such that the orientation factor is $\\cos\\theta = 1$. The charge of a sodium ion is positive, $q = +1\\,e$. The dipole moment vector points from the negative to the positive pole. For the interaction to be most favorable ($\\cos\\theta=1$), the dipole vector must be parallel to the electric field vector, which points away from the positive charge. This means the negative end of the dipole is closer to the cation, as stated in the problem.\n\nWith $\\cos\\theta = 1$, the expression for the energy simplifies to:\n$$\n\\Delta E = E_{\\mathrm{elec}} = - \\frac{1}{4\\pi\\epsilon_0} \\frac{q \\mu}{r^2}\n$$\nTo facilitate the calculation, we will work in a system of units common in computational chemistry, where energy is in $\\mathrm{kcal/mol}$, distance is in Ångstroms ($\\mathrm{\\AA}$), and charge is in units of the elementary charge ($e$). The Coulomb constant, $\\frac{1}{4\\pi\\epsilon_0}$, is replaced by a conversion factor $C = 332.0637\\,\\mathrm{kcal\\cdot\\AA\\cdot mol^{-1}\\cdot e^{-2}}$. This factor converts the potential energy $q_1 q_2 / r$ (with $q_i$ in $e$ and $r$ in $\\mathrm{\\AA}$) directly to $\\mathrm{kcal/mol}$.\n\nFor a charge-dipole interaction, the energy formula in these units becomes:\n$$\n\\Delta E (\\mathrm{kcal/mol}) = -C \\frac{q[e] \\cdot \\mu'[e\\cdot\\mathrm{\\AA}]}{(r[\\mathrm{\\AA}])^2}\n$$\nwhere $\\mu'$ is the dipole moment in units of $e\\cdot\\mathrm{\\AA}$.\n\nWe are given the dipole moment $\\mu = 1.85\\,\\mathrm{D}$. We must convert this to units of $e\\cdot\\mathrm{\\AA}$ using the provided constants:\n$1\\,\\mathrm{D} = 3.33564\\times 10^{-30}\\,\\mathrm{C\\cdot m}$\n$1\\,e\\cdot\\mathrm{\\AA} = 1.602176634\\times 10^{-29}\\,\\mathrm{C\\cdot m}$\n\nThe conversion factor is:\n$$\n\\frac{1\\,\\mathrm{D}}{1\\,e\\cdot\\mathrm{\\AA}} = \\frac{3.33564\\times 10^{-30}\\,\\mathrm{C\\cdot m}}{1.602176634\\times 10^{-29}\\,\\mathrm{C\\cdot m}} \\approx 0.208194\n$$\nSo, $1\\,\\mathrm{D} \\approx 0.208194\\,e\\cdot\\mathrm{\\AA}$.\nNow, we convert the given dipole moment:\n$$\n\\mu' = 1.85\\,\\mathrm{D} \\times 0.208194\\,\\frac{e\\cdot\\mathrm{\\AA}}{\\mathrm{D}} \\approx 0.385159\\,e\\cdot\\mathrm{\\AA}\n$$\nWe are given the following values:\n$q_s = +1\\,e$\n$\\mu' \\approx 0.385159\\,e\\cdot\\mathrm{\\AA}$\n$r = 3.0\\,\\mathrm{\\AA}$\n\nNow we can calculate $\\Delta E$:\n$$\n\\Delta E = -(332.0637\\,\\mathrm{kcal\\cdot\\AA\\cdot mol^{-1}\\cdot e^{-2}}) \\frac{(1\\,e) \\cdot (0.385159\\,e\\cdot\\mathrm{\\AA})}{(3.0\\,\\mathrm{\\AA})^2}\n$$\n$$\n\\Delta E = -332.0637 \\times \\frac{0.385159}{9.0} \\, \\mathrm{kcal/mol}\n$$\n$$\n\\Delta E = -332.0637 \\times 0.04279544 \\, \\mathrm{kcal/mol}\n$$\n$$\n\\Delta E \\approx -14.2059\\,\\mathrm{kcal/mol}\n$$\nThe problem requires the answer to be rounded to four significant figures.\n$$\n\\Delta E \\approx -14.21\\,\\mathrm{kcal/mol}\n$$", "answer": "$$\n\\boxed{-14.21}\n$$", "id": "3439712"}, {"introduction": "Electrostatic embedding provides a more physically realistic model, but it introduces its own challenges, most notably the risk of unphysical over-polarization when MM point charges approach the QM region too closely. This advanced practice addresses this issue by introducing charge smearing, a sophisticated technique where point charges are replaced by smooth Gaussian distributions to prevent electrostatic catastrophes. Through a combination of analytical derivation and numerical implementation [@problem_id:3439684], you will learn how to diagnose and resolve a key practical artifact in QM/MM simulations, bridging the gap between theoretical models and robust computational implementation.", "problem": "You are to implement and analyze a minimal Quantum Mechanics/Molecular Mechanics (QM/MM) embedding model where the Quantum Mechanics (QM) subsystem is represented by an isotropic, linear polarizable point at the origin with polarizability $\\,\\alpha\\,$ (in atomic units), and the Molecular Mechanics (MM) environment consists of a single charge $\\,q\\,$ located at position vector $\\,\\mathbf{R}\\,$. To mitigate overpolarization at short range, the MM charge is optionally replaced by a normalized, spherically symmetric Gaussian charge density of width $\\,\\sigma\\,$ centered at $\\,\\mathbf{R}\\,$. Work in atomic units so that $\\,4\\pi\\varepsilon_0 = 1\\,$ and $\\,e=1\\,$, and treat all distances in bohr and energies in hartree.\n\nFundamental base to use:\n- The electrostatic potential of a normalized spherical Gaussian with total charge $\\,q\\,$ and width $\\,\\sigma\\,$ is\n$$\n\\phi(\\mathbf{r}) \\;=\\; \\frac{q}{|\\mathbf{r}-\\mathbf{R}|}\\,\\mathrm{erf}\\!\\Big(\\frac{|\\mathbf{r}-\\mathbf{R}|}{\\sqrt{2}\\,\\sigma}\\Big).\n$$\n- The electric field is $\\,\\mathbf{E}(\\mathbf{r}) = -\\nabla \\phi(\\mathbf{r})\\,$.\n- The induced dipole of the polarizable QM center is $\\,\\boldsymbol{\\mu} = \\alpha\\,\\mathbf{E}(\\mathbf{0})\\,$.\n- The QM polarization energy in linear response is $\\,E_{\\mathrm{QM}} = -\\tfrac{1}{2}\\,\\boldsymbol{\\mu}\\cdot\\mathbf{E}(\\mathbf{0}) = -\\tfrac{1}{2}\\,\\alpha\\,\\|\\mathbf{E}(\\mathbf{0})\\|^2\\,$.\n- The force on the MM charge due to the QM polarization is $\\,\\mathbf{F}_{\\mathrm{MM}} = -\\nabla_{\\mathbf{R}} E_{\\mathrm{QM}}\\,$.\n\nTasks:\n1. Starting from the potential $\\,\\phi(\\mathbf{r})\\,$ given above, derive the closed-form expression for the electric field at the QM center $\\,\\mathbf{r}=\\mathbf{0}\\,$ due to the Gaussian-smeared MM charge. Express it as a vector aligned with $\\,\\mathbf{R}\\,$ and identify a scalar function $\\,f(R,\\sigma)\\,$, with $\\,R=\\|\\mathbf{R}\\|\\,$, such that\n$$\n\\mathbf{E}(\\mathbf{0}) \\;=\\; q\\,f(R,\\sigma)\\,(-\\hat{\\mathbf{R}}),\n$$\nwhere $\\,\\hat{\\mathbf{R}}=\\mathbf{R}/R\\,$.\n2. Using the linear response energy definition, derive an exact analytic formula for the radial component of the QM/MM force on the MM charge, $\\,F_R\\,$, defined as the projection of $\\,\\mathbf{F}_{\\mathrm{MM}}\\,$ along $\\,\\hat{\\mathbf{R}}\\,$. Your derivation must be explicit in terms of $\\,f(R,\\sigma)\\,$ and $\\,\\partial f/\\partial R\\,$, and it must correctly reduce to the point-charge limit as $\\,\\sigma\\to 0\\,$.\n3. Implement a program that:\n   - Computes $\\,\\mathbf{E}(\\mathbf{0})\\,$, the induced dipole magnitude $\\,\\mu(\\sigma)=\\|\\boldsymbol{\\mu}\\|\\,$, and the analytic radial force $\\,F_R\\,$ for given $\\,q\\,$, $\\,\\alpha\\,$, $\\,R\\,$, and $\\,\\sigma\\,$.\n   - Quantifies the mitigation of overpolarization by evaluating the normalized induced dipole magnitude\n   $$\n   \\rho(R,\\sigma) \\;=\\; \\frac{\\mu(\\sigma)}{\\mu(0)} \\;=\\; \\frac{\\|\\alpha\\,\\mathbf{E}(\\mathbf{0};\\sigma)\\|}{\\|\\alpha\\,\\mathbf{E}(\\mathbf{0};0)\\|},\n   $$\n   where $\\,\\mu(0)\\,$ corresponds to the point-charge limit. Report $\\,\\rho\\,$ as a dimensionless float.\n   - Verifies the analytic force by comparing $\\,F_R\\,$ to a symmetric finite-difference estimate of $-\\partial E_{\\mathrm{QM}}/\\partial R\\,$ with a step size $\\,h = 10^{-6}\\,$ bohr. Report whether the relative error\n   $$\n   \\varepsilon \\;=\\; \\frac{|F_R^{\\mathrm{analytic}} - F_R^{\\mathrm{FD}}|}{\\max(|F_R^{\\mathrm{FD}}|,\\,10^{-12})}\n   $$\n   is less than $\\,10^{-8}\\,$ as a boolean.\n4. Use the following test suite, with fixed $\\,\\alpha = 10.0\\,$ (atomic units) and the listed tuples $\\,\\big(R,\\,\\sigma,\\,q\\big)\\,$ (all in atomic units):\n   - Case $\\,1\\,$: $\\,\\big(2.0,\\,0.0,\\, +1.0\\big)\\,$.\n   - Case $\\,2\\,$: $\\,\\big(0.5,\\,0.2,\\, +1.0\\big)\\,$.\n   - Case $\\,3\\,$: $\\,\\big(0.5,\\,1.0,\\, +1.0\\big)\\,$.\n   - Case $\\,4\\,$: $\\,\\big(5.0,\\,1.0,\\, +1.0\\big)\\,$.\n   - Case $\\,5\\,$: $\\,\\big(1.0,\\,0.5,\\, -1.0\\big)\\,$.\n   For each case, your program must compute and return a two-element list containing:\n   - The float $\\,\\rho\\,$ defined above.\n   - The boolean indicating whether the analytic force passes the finite-difference check with the stated tolerance.\n5. Final output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is the two-element list for one test case, in the order of Cases $\\,1\\,$ through $\\,5\\,$. For example, a syntactically valid shape is\n   $$\n   \\big[\\,[\\rho_1,\\mathrm{ok}_1],\\,[\\rho_2,\\mathrm{ok}_2],\\,[\\rho_3,\\mathrm{ok}_3],\\,[\\rho_4,\\mathrm{ok}_4],\\,[\\rho_5,\\mathrm{ok}_5]\\,\\big].\n   $$\nAll quantities are to be computed and reported in atomic units; $\\,\\rho\\,$ is dimensionless. Angles do not appear. No percentages are used. The answer must be a complete, runnable program as specified in the final answer section.", "solution": "The problem statement has been meticulously validated and is determined to be scientifically grounded, well-posed, objective, and self-contained. It presents a standard, simplified model of electrostatic embedding in a QM/MM framework, with all definitions and parameters clearly specified. The tasks are logically structured, involving standard analytical derivations in vector calculus and a subsequent numerical implementation. Therefore, a complete solution is provided below.\n\n### Part 1: Derivation of the Electric Field at the QM Center\n\nThe QM center is at the origin, $\\mathbf{r}=\\mathbf{0}$. The MM charge $q$ is described by a Gaussian charge density centered at $\\mathbf{R}$, generating an electrostatic potential:\n$$\n\\phi(\\mathbf{r}) = \\frac{q}{|\\mathbf{r}-\\mathbf{R}|}\\,\\mathrm{erf}\\!\\Big(\\frac{|\\mathbf{r}-\\mathbf{R}|}{\\sqrt{2}\\,\\sigma}\\Big)\n$$\nThe electric field is given by $\\mathbf{E}(\\mathbf{r}) = -\\nabla \\phi(\\mathbf{r})$. Let's define $\\mathbf{u} = \\mathbf{r}-\\mathbf{R}$ and its magnitude $u = |\\mathbf{u}|$. The potential can be written as a function of $u$ only: $\\phi(u) = \\frac{q}{u}\\mathrm{erf}\\big(\\frac{u}{\\sqrt{2}\\,\\sigma}\\big)$.\nUsing the chain rule, the gradient is $\\nabla_{\\mathbf{r}} \\phi(\\mathbf{r}) = \\nabla_{\\mathbf{u}} \\phi(u) = \\frac{d\\phi}{du}\\frac{\\mathbf{u}}{u} = \\frac{d\\phi}{du}\\hat{\\mathbf{u}}$.\n\nFirst, we compute the derivative of $\\phi$ with respect to $u$:\n$$\n\\frac{d\\phi}{du} = q \\frac{d}{du}\\left[ \\frac{1}{u}\\,\\mathrm{erf}\\!\\Big(\\frac{u}{\\sqrt{2}\\,\\sigma}\\Big) \\right]\n$$\nUsing the product rule and the derivative of the error function, $\\frac{d}{dx}\\mathrm{erf}(x) = \\frac{2}{\\sqrt{\\pi}}e^{-x^2}$:\n$$\n\\begin{align*}\n\\frac{d\\phi}{du} &= q \\left[ -\\frac{1}{u^2}\\,\\mathrm{erf}\\!\\Big(\\frac{u}{\\sqrt{2}\\,\\sigma}\\Big) + \\frac{1}{u} \\cdot \\frac{2}{\\sqrt{\\pi}} e^{-\\left(\\frac{u}{\\sqrt{2}\\,\\sigma}\\right)^2} \\cdot \\frac{1}{\\sqrt{2}\\,\\sigma} \\right] \\\\\n&= q \\left[ -\\frac{1}{u^2}\\,\\mathrm{erf}\\!\\Big(\\frac{u}{\\sqrt{2}\\,\\sigma}\\Big) + \\frac{\\sqrt{2}}{u\\sqrt{\\pi}\\,\\sigma} e^{-u^2/(2\\sigma^2)} \\right]\n\\end{align*}\n$$\nWe need to evaluate the field at $\\mathbf{r}=\\mathbf{0}$. At this point, $\\mathbf{u} = -\\mathbf{R}$, so $u=|\\mathbf{R}|=R$ and $\\hat{\\mathbf{u}} = -\\hat{\\mathbf{R}}$.\nThe gradient at the origin is:\n$$\n\\nabla_{\\mathbf{r}} \\phi(\\mathbf{r}) \\Big|_{\\mathbf{r}=\\mathbf{0}} = \\left. \\frac{d\\phi}{du} \\right|_{u=R} \\hat{\\mathbf{u}} = q \\left[ -\\frac{1}{R^2}\\,\\mathrm{erf}\\!\\Big(\\frac{R}{\\sqrt{2}\\,\\sigma}\\Big) + \\frac{\\sqrt{2}}{R\\sqrt{\\pi}\\,\\sigma} e^{-R^2/(2\\sigma^2)} \\right] (-\\hat{\\mathbf{R}})\n$$\nThe electric field is $\\mathbf{E}(\\mathbf{0}) = -\\nabla_{\\mathbf{r}} \\phi(\\mathbf{r})|_{\\mathbf{r}=\\mathbf{0}}$:\n$$\n\\mathbf{E}(\\mathbf{0}) = q \\left[ \\frac{1}{R^2}\\,\\mathrm{erf}\\!\\Big(\\frac{R}{\\sqrt{2}\\,\\sigma}\\Big) - \\frac{\\sqrt{2}}{R\\sqrt{\\pi}\\,\\sigma} e^{-R^2/(2\\sigma^2)} \\right] (-\\hat{\\mathbf{R}})\n$$\nComparing this to the requested form $\\mathbf{E}(\\mathbf{0}) = q\\,f(R,\\sigma)\\,(-\\hat{\\mathbf{R}})$, we can identify the scalar function $f(R,\\sigma)$ as:\n$$\nf(R,\\sigma) = \\frac{1}{R^2}\\,\\mathrm{erf}\\!\\Big(\\frac{R}{\\sqrt{2}\\,\\sigma}\\Big) - \\frac{\\sqrt{2}}{R\\sqrt{\\pi}\\,\\sigma} e^{-R^2/(2\\sigma^2)}\n$$\nFor the point-charge case ($\\sigma \\to 0$), we analyze the limits. Let $x = R/(\\sqrt{2}\\,\\sigma)$. As $\\sigma \\to 0$, $x \\to \\infty$. In this limit, $\\mathrm{erf}(x) \\to 1$ and the term proportional to $x e^{-x^2}$ vanishes. Thus:\n$$\n\\lim_{\\sigma \\to 0} f(R,\\sigma) = \\frac{1}{R^2} (1) - 0 = \\frac{1}{R^2}\n$$\nThis correctly reproduces the field magnitude factor for a point charge.\n\n### Part 2: Derivation of the Radial Force $F_R$\n\nThe polarization energy of the QM center is $E_{\\mathrm{QM}} = -\\frac{1}{2}\\alpha\\|\\mathbf{E}(\\mathbf{0})\\|^2$. The magnitude of the electric field is $\\|\\mathbf{E}(\\mathbf{0})\\| = |q|f(R,\\sigma)$, since $f(R,\\sigma)$ can be shown to be non-negative.\nTherefore, the energy is:\n$$\nE_{\\mathrm{QM}} = -\\frac{1}{2}\\alpha \\left( |q|f(R,\\sigma) \\right)^2 = -\\frac{1}{2}\\alpha q^2 f(R,\\sigma)^2\n$$\nThe force on the MM charge is given by $\\mathbf{F}_{\\mathrm{MM}} = -\\nabla_{\\mathbf{R}}E_{\\mathrm{QM}}$. Since $E_{\\mathrm{QM}}$ depends only on the magnitude $R = \\|\\mathbf{R}\\|$, its gradient is:\n$$\n\\mathbf{F}_{\\mathrm{MM}} = -\\frac{\\partial E_{\\mathrm{QM}}}{\\partial R}\\hat{\\mathbf{R}} = -\\frac{\\partial}{\\partial R}\\left(-\\frac{1}{2}\\alpha q^2 f(R, \\sigma)^2\\right)\\hat{\\mathbf{R}}\n$$\nUsing the chain rule:\n$$\n\\mathbf{F}_{\\mathrm{MM}} = \\frac{1}{2}\\alpha q^2 \\left( 2 f(R,\\sigma) \\frac{\\partial f(R,\\sigma)}{\\partial R} \\right) \\hat{\\mathbf{R}} = \\alpha q^2 f(R,\\sigma)\\frac{\\partial f(R,\\sigma)}{\\partial R} \\hat{\\mathbf{R}}\n$$\nThe radial component of the force, $F_R$, is the projection of $\\mathbf{F}_{\\mathrm{MM}}$ along $\\hat{\\mathbf{R}}$:\n$$\nF_R = \\mathbf{F}_{\\mathrm{MM}} \\cdot \\hat{\\mathbf{R}} = \\alpha q^2 f(R,\\sigma)\\frac{\\partial f(R,\\sigma)}{\\partial R}\n$$\nTo evaluate this, we need the partial derivative of $f(R,\\sigma)$ with respect to $R$:\n$$\n\\frac{\\partial f}{\\partial R} = \\frac{\\partial}{\\partial R}\\left[ \\frac{1}{R^2}\\,\\mathrm{erf}\\!\\Big(\\frac{R}{\\sqrt{2}\\,\\sigma}\\Big) - \\frac{\\sqrt{2}}{R\\sqrt{\\pi}\\,\\sigma} e^{-R^2/(2\\sigma^2)} \\right]\n$$\nAfter applying the product rule to both terms and simplifying, we obtain:\n$$\n\\frac{\\partial f}{\\partial R} = -\\frac{2}{R^3}\\mathrm{erf}\\!\\Big(\\frac{R}{\\sqrt{2}\\,\\sigma}\\Big) + \\frac{2\\sqrt{2}}{R^2\\sqrt{\\pi}\\,\\sigma}e^{-R^2/(2\\sigma^2)} + \\frac{\\sqrt{2}}{\\sqrt{\\pi}\\,\\sigma^3}e^{-R^2/(2\\sigma^2)}\n$$\nIn the point-charge limit ($\\sigma \\to 0$):\n$$\nf(R,0) = \\frac{1}{R^2} \\quad \\text{and} \\quad \\frac{\\partial f}{\\partial R}(R,0) = \\frac{\\partial}{\\partial R}(R^{-2}) = -2R^{-3}\n$$\nThe force in this limit becomes:\n$$\nF_R(R,0) = \\alpha q^2 \\left(\\frac{1}{R^2}\\right)(-2R^{-3}) = -\\frac{2\\alpha q^2}{R^5}\n$$\nThis result correctly matches the force between a charge $q$ and a dipole it induces ($\\boldsymbol{\\mu} = -\\alpha q \\hat{\\mathbf{R}}/R^2$) at the origin.\n\n### Part 3: Quantities for Implementation\n\nThe program must compute several quantities based on these derivations.\n\n**Normalized Induced Dipole Magnitude $\\rho$**:\nThe induced dipole magnitude is $\\mu(\\sigma) = \\|\\boldsymbol{\\mu}\\| = \\alpha \\|\\mathbf{E}(\\mathbf{0};\\sigma)\\| = \\alpha |q| f(R,\\sigma)$.\nThe normalization factor is the dipole magnitude in the point-charge limit, $\\mu(0) = \\alpha|q|f(R,0) = \\alpha|q|/R^2$.\nThe normalized ratio is:\n$$\n\\rho(R,\\sigma) = \\frac{\\mu(\\sigma)}{\\mu(0)} = \\frac{\\alpha|q|f(R,\\sigma)}{\\alpha|q|/R^2} = R^2 f(R,\\sigma)\n$$\nSubstituting the expression for $f(R,\\sigma)$:\n$$\n\\rho(R,\\sigma) = \\mathrm{erf}\\!\\Big(\\frac{R}{\\sqrt{2}\\,\\sigma}\\Big) - \\frac{\\sqrt{2}\\,R}{\\sqrt{\\pi}\\,\\sigma}e^{-R^2/(2\\sigma^2)}\n$$\nFor the point-charge case $\\sigma=0$, we have $\\rho(R,0) = 1$.\n\n**Analytic vs. Finite-Difference Force**:\nThe analytic force $F_R^{\\mathrm{analytic}}$ is computed using the derived formula $F_R = \\alpha q^2 f \\frac{\\partial f}{\\partial R}$. The finite-difference force $F_R^{\\mathrm{FD}}$ is a numerical approximation of the derivative $F_R = -\\partial E_{\\mathrm{QM}}/\\partial R$ using a central difference formula:\n$$\nF_R^{\\mathrm{FD}} = -\\frac{E_{\\mathrm{QM}}(R+h) - E_{\\mathrm{QM}}(R-h)}{2h}\n$$\nwhere $E_{\\mathrm{QM}}(r) = -\\frac{1}{2}\\alpha q^2 [f(r,\\sigma)]^2$ and $h=10^{-6}$~bohr. The implementation will compute both and verify their agreement.\n\nThe program will implement functions for $f(R,\\sigma)$ and $\\frac{\\partial f}{\\partial R}(R,\\sigma)$ that handle the special case $\\sigma=0$ separately from the general case $\\sigma>0$ using the expressions derived above.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import erf\n\ndef solve():\n    \"\"\"\n    Implements and analyzes a minimal QM/MM embedding model.\n\n    This function calculates properties for a system comprising a polarizable QM center\n    and a Gaussian-smeared MM charge. It derives the normalized induced dipole and\n    verifies an analytical force expression against a numerical finite-difference\n    approximation for a suite of test cases.\n    \"\"\"\n\n    # --- Fixed parameters for the simulation ---\n    alpha = 10.0  # Polarizability of the QM center (a.u.)\n    h = 1.0e-6    # Finite-difference step size (bohr)\n    error_tol = 1.0e-8 # Relative error tolerance for force verification\n\n    # --- Test suite cases: (R, sigma, q) in atomic units ---\n    test_cases = [\n        (2.0, 0.0, +1.0),  # Case 1: Point-charge limit\n        (0.5, 0.2, +1.0),  # Case 2: Short-range, small smearing\n        (0.5, 1.0, +1.0),  # Case 3: Short-range, large smearing\n        (5.0, 1.0, +1.0),  # Case 4: Long-range\n        (1.0, 0.5, -1.0)   # Case 5: Negative charge\n    ]\n\n    results = []\n    \n    # --- Helper functions for physical quantities ---\n    def get_f(R, sigma):\n        \"\"\"\n        Computes the scalar function f(R, sigma) that determines the E-field magnitude.\n        Handles the point-charge limit (sigma = 0) separately.\n        \"\"\"\n        if R = 0:\n            return np.inf\n        if sigma == 0.0:\n            return 1.0 / R**2\n        \n        term1 = erf(R / (np.sqrt(2.0) * sigma)) / R**2\n        term2 = (np.sqrt(2.0) / (R * np.sqrt(np.pi) * sigma)) * np.exp(-R**2 / (2.0 * sigma**2))\n        return term1 - term2\n\n    def get_df_dR(R, sigma):\n        \"\"\"\n        Computes the analytical derivative of f(R, sigma) with respect to R.\n        Handles the point-charge limit (sigma = 0) separately.\n        \"\"\"\n        if R = 0:\n            return np.inf\n        if sigma == 0.0:\n            return -2.0 / R**3\n\n        erf_term_val = erf(R / (np.sqrt(2.0) * sigma))\n        exp_term_val = np.exp(-R**2 / (2.0 * sigma**2))\n        \n        term1 = -2.0 * erf_term_val / R**3\n        term2 = (2.0 * np.sqrt(2.0) / (R**2 * np.sqrt(np.pi) * sigma)) * exp_term_val\n        term3 = (np.sqrt(2.0) / (np.sqrt(np.pi) * sigma**3)) * exp_term_val\n        \n        return term1 + term2 + term3\n\n    def get_polarization_energy(R, sigma, q, alpha_val):\n        \"\"\"Computes the QM polarization energy E_QM.\"\"\"\n        f_val = get_f(R, sigma)\n        return -0.5 * alpha_val * q**2 * f_val**2\n\n    # --- Main loop over test cases ---\n    for case in test_cases:\n        R, sigma, q = case\n        \n        # 1. Compute the normalized induced dipole magnitude, rho\n        if sigma == 0.0:\n            rho = 1.0\n        else:\n            # rho = R^2 * f(R, sigma)\n            x = R / (np.sqrt(2.0) * sigma)\n            rho = erf(x) - (np.sqrt(2.0) * R / (np.sqrt(np.pi) * sigma)) * np.exp(-x**2)\n\n        # 2. Compute the analytic radial force\n        f_val = get_f(R, sigma)\n        df_dR_val = get_df_dR(R, sigma)\n        F_R_analytic = alpha * q**2 * f_val * df_dR_val\n\n        # 3. Compute the finite-difference force for verification\n        E_plus = get_polarization_energy(R + h, sigma, q, alpha)\n        E_minus = get_polarization_energy(R - h, sigma, q, alpha)\n        F_R_FD = -(E_plus - E_minus) / (2.0 * h)\n        \n        # 4. Calculate the relative error and check against tolerance\n        denominator = max(abs(F_R_FD), 1.0e-12)\n        relative_error = abs(F_R_analytic - F_R_FD) / denominator\n        force_check_ok = relative_error  error_tol\n\n        # 5. Store the results for this case\n        results.append([rho, force_check_ok])\n\n    # Final print statement in the exact required format.\n    # The string conversion of booleans to 'True'/'False' matches the problem's example format.\n    print(f\"{results}\")\n\nsolve()\n```", "id": "3439684"}]}