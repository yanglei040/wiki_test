{"hands_on_practices": [{"introduction": "The foundation of *ab initio* molecular dynamics is the accurate calculation of forces acting on the nuclei, which are derived from the electronic ground-state potential energy surface. While the Hellmann-Feynman theorem provides a direct route to these forces, its application depends critically on the choice of basis set. This practice builds a deep, first-principles understanding of why basis sets that are independent of nuclear positions (like plane waves) yield zero Pulay force, whereas atom-centered basis sets (like Gaussians) give rise to this important correction, which must be included to obtain the true Born-Oppenheimer force [@problem_id:3431498].", "problem": "Consider the Born–Oppenheimer approximation, in which the nuclei are treated as classical particles moving on the electronic ground-state potential energy surface while the electrons are treated quantum mechanically. The force on a nucleus with coordinate $R$ is the negative gradient of the electronic ground-state energy $E(R)$ with respect to $R$. In a basis set that depends on the nuclear coordinates, there can be additional force contributions beyond the Hellmann–Feynman term due to the parametric dependence of the basis, commonly called Pulay forces. \n\nPart A (conceptual comparison): Explain, from first principles, why Pulay forces vanish in a plane-wave basis and arise in a localized Gaussian basis. You must tie your reasoning to the dependence (or independence) of the basis functions on the nuclear coordinates $R$ and to the stationarity of the variational energy with respect to the electronic degrees of freedom under the Born–Oppenheimer approximation. Do not use any pre-quoted force formulae; reason from the variational principle and the Hellmann–Feynman theorem.\n\nPart B (analytical calculation of a Pulay term in a simple model): Consider a one-dimensional, one-electron symmetric diatomic model with nuclear coordinates located at $\\pm R$. Work in atomic units with $\\hbar = 1$ and electron mass $m = 1$. The electronic Hamiltonian is\n$$\n\\hat{H}(R) = -\\frac{1}{2}\\frac{d^2}{dx^2} + \\frac{1}{2}k\\left[(x - R)^{2} + (x + R)^{2}\\right],\n$$\nwhere $k>0$ is a constant representing the curvature of two identical harmonic wells centered at $\\pm R$. Use a localized Gaussian basis consisting of two normalized functions centered on the nuclei,\n$$\n\\phi_{A}(x;R) = \\left(\\frac{2\\alpha}{\\pi}\\right)^{\\frac{1}{4}} \\exp\\!\\left[-\\alpha(x - R)^{2}\\right], \\quad \\phi_{B}(x;R) = \\left(\\frac{2\\alpha}{\\pi}\\right)^{\\frac{1}{4}} \\exp\\!\\left[-\\alpha(x + R)^{2}\\right],\n$$\nwith a fixed exponent parameter $\\alpha>0$. Consider the symmetric variational ansatz for the electronic ground state,\n$$\n\\psi(x;R) = \\mathcal{N}(R)\\left[\\phi_{A}(x;R) + \\phi_{B}(x;R)\\right],\n$$\nwhere the normalization factor $\\mathcal{N}(R)$ is determined by the overlap $S(R) = \\langle \\phi_{A}|\\phi_{B}\\rangle$ via $\\mathcal{N}(R) = [2 + 2 S(R)]^{-1/2}$.\n\n1. Starting from the variational principle applied to $\\psi(x;R)$, compute the electronic energy $E(R) = \\langle \\psi|\\hat{H}(R)|\\psi\\rangle$ in terms of $R$, $k$, and $\\alpha$, without using any shortcut formulas. You may freely use Gaussian integral identities that you derive from first principles.\n\n2. Differentiate $E(R)$ with respect to $R$ to obtain $-dE/dR$, the total Born–Oppenheimer force on the nuclear coordinate $R$. Separately, compute the Hellmann–Feynman force by taking the expectation value of $-\\partial \\hat{H}/\\partial R$ with the state $\\psi(x;R)$. Use these to define the Pulay force contribution as the difference between the total force and the Hellmann–Feynman force. \n\n3. Provide the Pulay force $F_{\\mathrm{P}}(R)$ as a single closed-form analytic expression in terms of $\\alpha$, $k$, and $R$. Express your final answer in symbolic form; do not provide a numerical value. No rounding is required. The final answer must be the Pulay force expression only.", "solution": "### Part A: Conceptual Comparison\n\nThe total energy of the electronic subsystem for a fixed nuclear configuration $R$ is given by the expectation value of the electronic Hamiltonian $\\hat{H}(R)$:\n$$\nE(R) = \\frac{\\langle \\psi(R) | \\hat{H}(R) | \\psi(R) \\rangle}{\\langle \\psi(R) | \\psi(R) \\rangle}\n$$\nThe electronic wavefunction $\\psi(R)$ is obtained by solving the time-independent Schrödinger equation, typically approximated by expanding it in a set of basis functions $\\{\\phi_i(R)\\}$ as $\\psi(R) = \\sum_i c_i(R) \\phi_i(R)$. The variational principle states that the ground-state energy is obtained by minimizing this expectation value with respect to the electronic degrees of freedom, which are the expansion coefficients $\\{c_i\\}$. This leads to the condition $\\frac{\\partial E}{\\partial c_i} = 0$ for all $i$.\n\nThe Born-Oppenheimer force on a nucleus is the negative gradient of the electronic potential energy surface, $F_{tot} = - \\frac{dE(R)}{dR}$. Applying the chain rule to the expression for $E(R)$ (assuming a normalized wavefunction for simplicity, $\\langle\\psi|\\psi\\rangle=1$):\n$$\n\\frac{dE}{dR} = \\left\\langle \\frac{\\partial \\psi}{\\partial R} \\middle| \\hat{H} \\middle| \\psi \\right\\rangle + \\left\\langle \\psi \\middle| \\hat{H} \\middle| \\frac{\\partial \\psi}{\\partial R} \\right\\rangle + \\left\\langle \\psi \\middle| \\frac{\\partial \\hat{H}}{\\partial R} \\middle| \\psi \\right\\rangle\n$$\nThe third term is the expectation value of the derivative of the Hamiltonian. The force associated with it, $F_{HF} = -\\langle \\psi | \\frac{\\partial \\hat{H}}{\\partial R} | \\psi \\rangle$, is the Hellmann-Feynman force.\n\nThe remaining terms, $2 \\text{Re} \\left\\langle \\frac{\\partial \\psi}{\\partial R} \\middle| \\hat{H} \\middle| \\psi \\right\\rangle$, depend on the derivative of the wavefunction with respect to the nuclear coordinate. The wavefunction $\\psi(R) = \\sum_i c_i(R) \\phi_i(R)$ depends on $R$ both through the coefficients $c_i(R)$ and potentially through the basis functions $\\phi_i(R)$ themselves:\n$$\n\\frac{\\partial \\psi}{\\partial R} = \\sum_i \\frac{\\partial c_i}{\\partial R} \\phi_i(R) + \\sum_i c_i \\frac{\\partial \\phi_i(R)}{\\partial R}\n$$\nIf the basis set were complete, the variational solution $\\psi$ would be an exact eigenfunction of $\\hat{H}$, so $(\\hat{H}-E)\\psi = 0$. The Hellmann-Feynman theorem would hold exactly. However, practical calculations use finite, incomplete basis sets. For such a basis, the variational condition $\\frac{\\partial E}{\\partial c_i}=0$ ensures that terms involving $\\frac{\\partial c_i}{\\partial R}$ do not contribute to the force. The remaining force contribution, arising from the explicit dependence of the basis functions on $R$, is the Pulay force. It is given by $F_P = -2 \\text{Re} \\sum_{i,j} c_i^* c_j \\left\\langle \\frac{\\partial \\phi_i}{\\partial R} \\middle| \\hat{H} \\middle| \\phi_j \\right\\rangle$. This force is a correction for the fact that as the nuclei move, the basis set itself \"moves\" and deforms, and this change must be accounted for in the total energy derivative.\n\n1.  **Plane-Wave Basis**: A plane-wave basis set consists of functions of the form $\\phi_{\\mathbf{G}}(\\mathbf{r}) = \\frac{1}{\\sqrt{V}} \\exp(i(\\mathbf{k}+\\mathbf{G})\\cdot\\mathbf{r})$. These functions are eigenfunctions of the kinetic energy operator and span the entire simulation cell. Crucially, their definition does not depend on the positions of the nuclei, $\\mathbf{R}$. Thus, the derivative of a basis function with respect to a nuclear coordinate is identically zero: $\\frac{\\partial \\phi_{\\mathbf{G}}}{\\partial \\mathbf{R}} = 0$. Consequently, the Pulay force contribution vanishes entirely. The total force is exactly the Hellmann-Feynman force.\n\n2.  **Localized Gaussian Basis**: A localized basis, such as a Gaussian-type orbital (GTO) basis, consists of functions centered on the nuclei. For example, a Gaussian function centered on nucleus $A$ at position $R_A$ is of the form $\\phi_A(\\mathbf{r}; R_A) \\propto \\exp(-\\alpha |\\mathbf{r} - R_A|^2)$. These functions have a clear and explicit dependence on the nuclear coordinates. As a nucleus moves, the center of its associated basis function moves with it. Therefore, the derivative of the basis function with respect to the nuclear coordinate is non-zero: $\\frac{\\partial \\phi_A}{\\partial R_A} \\neq 0$. This non-zero derivative leads to a non-vanishing Pulay force, which must be added to the Hellmann-Feynman force to obtain the correct total Born-Oppenheimer force.\n\n### Part B: Analytical Calculation\n\nFirst, we simplify the Hamiltonian:\n$$\n\\hat{H}(R) = -\\frac{1}{2}\\frac{d^2}{dx^2} + \\frac{1}{2}k\\left(x^2 - 2xR + R^2 + x^2 + 2xR + R^2\\right) = -\\frac{1}{2}\\frac{d^2}{dx^2} + kx^2 + kR^2\n$$\nLet $\\hat{T} = -\\frac{1}{2}\\frac{d^2}{dx^2}$ and $\\hat{V}(R) = kx^2 + kR^2$.\n\n**1. Electronic Energy $E(R)$**\n\nThe energy for the ansatz $\\psi = \\mathcal{N}(\\phi_A+\\phi_B)$ is:\n$$\nE(R) = \\langle\\psi|\\hat{H}|\\psi\\rangle = \\mathcal{N}^2 \\langle\\phi_A+\\phi_B|\\hat{H}|\\phi_A+\\phi_B\\rangle = \\frac{2H_{AA} + 2H_{AB}}{2+2S} = \\frac{H_{AA} + H_{AB}}{1+S}\n$$\nwhere $H_{ij} = \\langle\\phi_i|\\hat{H}|\\phi_j\\rangle$ and $S = \\langle\\phi_A|\\phi_B\\rangle$. We must compute the matrix elements. Let $N_0 = (2\\alpha/\\pi)^{1/4}$.\n\n-   **Overlap $S(R)$**:\n    $S(R) = \\langle\\phi_A|\\phi_B\\rangle = N_0^2 \\int_{-\\infty}^{\\infty} \\exp[-\\alpha(x-R)^2] \\exp[-\\alpha(x+R)^2] dx = N_0^2 e^{-2\\alpha R^2} \\int_{-\\infty}^{\\infty} e^{-2\\alpha x^2} dx$.\n    Using the Gaussian integral identity $\\int e^{-ax^2}dx=\\sqrt{\\pi/a}$, we get:\n    $S(R) = \\left(\\frac{2\\alpha}{\\pi}\\right)^{1/2} e^{-2\\alpha R^2} \\sqrt{\\frac{\\pi}{2\\alpha}} = \\exp(-2\\alpha R^2)$.\n\n-   **Diagonal element $H_{AA}$**:\n    $H_{AA} = \\langle\\phi_A|\\hat{T}|\\phi_A\\rangle + \\langle\\phi_A|\\hat{V}|\\phi_A\\rangle$.\n    $T_{AA} = \\langle\\phi_A| \\frac{\\alpha}{2} - 2\\alpha^2(x-R)^2 | \\phi_A \\rangle = \\frac{\\alpha}{2} - 2\\alpha^2\\langle(x-R)^2\\rangle_A$. Using $\\langle(x-R)^{2n}\\rangle_A = \\frac{(2n-1)!!}{(4\\alpha)^n}$, we find $\\langle(x-R)^2\\rangle_A = \\frac{1}{4\\alpha}$.\n    $T_{AA} = \\frac{\\alpha}{2} - 2\\alpha^2(\\frac{1}{4\\alpha}) = \\frac{\\alpha}{2}$.\n    $V_{AA} = \\langle\\phi_A|kx^2+kR^2|\\phi_A\\rangle = k\\langle x^2 \\rangle_A + kR^2$. With $x=y+R$ for $y=x-R$, $\\langle x^2 \\rangle_A = \\langle(y+R)^2\\rangle_A = \\langle y^2 \\rangle_A + R^2 = \\frac{1}{4\\alpha} + R^2$.\n    $V_{AA} = k(\\frac{1}{4\\alpha} + R^2) + kR^2 = \\frac{k}{4\\alpha} + 2kR^2$.\n    $H_{AA} = \\frac{\\alpha}{2} + \\frac{k}{4\\alpha} + 2kR^2$.\n\n-   **Off-diagonal element $H_{AB}$**:\n    $H_{AB} = \\langle\\phi_A|\\hat{T}|\\phi_B\\rangle + \\langle\\phi_A|\\hat{V}|\\phi_B\\rangle$.\n    Using $T\\phi_B = [\\alpha - 2\\alpha^2(x+R)^2]\\phi_B$, we get $T_{AB} = \\alpha S - 2\\alpha^2 \\langle\\phi_A|(x+R)^2|\\phi_B\\rangle$. The integral is $(\\frac{1}{4\\alpha}+R^2)S$.\n    $T_{AB} = (\\alpha - 2\\alpha^2(\\frac{1}{4\\alpha}+R^2))S = (\\frac{\\alpha}{2} - 2\\alpha^2 R^2)S$.\n    $V_{AB} = \\langle\\phi_A|kx^2+kR^2|\\phi_B\\rangle = k\\langle\\phi_A|x^2|\\phi_B\\rangle + kR^2 S$. The integral is $\\frac{S}{4\\alpha}$.\n    $V_{AB} = (\\frac{k}{4\\alpha} + kR^2)S$.\n    $H_{AB} = \\left( \\frac{\\alpha}{2} + \\frac{k}{4\\alpha} + kR^2 - 2\\alpha^2 R^2 \\right)S$.\n\n-   **Total energy $E(R)$**:\n    Let $C = \\frac{\\alpha}{2} + \\frac{k}{4\\alpha}$.\n    $E(R) = \\frac{(C+2kR^2) + (C+kR^2-2\\alpha^2R^2)S}{1+S} = \\frac{C(1+S) + 2kR^2 + (k-2\\alpha^2)R^2 S}{1+S}$.\n    $E(R) = \\frac{\\alpha}{2} + \\frac{k}{4\\alpha} + \\frac{2kR^2 + (k - 2\\alpha^2)R^2 \\exp(-2\\alpha R^2)}{1+\\exp(-2\\alpha R^2)}$.\n\n**2. Forces and Definition of Pulay Force**\n\n-   **Total Force ($F_{\\mathrm{tot}}$)**: This is $-dE/dR$. Let $E(R) = C + R^2 f(S(R))$, where $f(S)=\\frac{2k+(k-2\\alpha^2)S}{1+S}$.\n    $$\n    F_{\\mathrm{tot}}(R) = -\\frac{dE}{dR} = -2R f(S) - R^2 \\frac{df}{dS}\\frac{dS}{dR}\n    $$\n    We have $\\frac{dS}{dR} = -4\\alpha R S$.\n    $\\frac{df}{dS} = \\frac{(k-2\\alpha^2)(1+S) - (2k+(k-2\\alpha^2)S)}{(1+S)^2} = \\frac{-k-2\\alpha^2}{(1+S)^2}$.\n    $$\n    F_{\\mathrm{tot}}(R) = -2R \\frac{2k+(k-2\\alpha^2)S}{1+S} - R^2 \\frac{-k-2\\alpha^2}{(1+S)^2} (-4\\alpha R S)\n    $$\n    $$\n    F_{\\mathrm{tot}}(R) = -\\frac{2R(1+S)(2k+(k-2\\alpha^2)S) + 4\\alpha R^3 S(k+2\\alpha^2)}{(1+S)^2}\n    $$\n\n-   **Hellmann-Feynman Force ($F_{\\mathrm{HF}}$)**:\n    $F_{\\mathrm{HF}} = -\\left\\langle \\psi \\middle| \\frac{\\partial \\hat{H}}{\\partial R} \\middle| \\psi \\right\\rangle$.\n    From $\\hat{H}(R) = -\\frac{1}{2}\\frac{d^2}{dx^2} + kx^2 + kR^2$, we have $\\frac{\\partial \\hat{H}}{\\partial R} = 2kR$.\n    $$\n    F_{\\mathrm{HF}} = -\\langle \\psi | 2kR | \\psi \\rangle = -2kR \\langle \\psi | \\psi \\rangle = -2kR\n    $$\n\n-   **Pulay Force ($F_{\\mathrm{P}}$)**: Defined as the difference:\n    $F_{\\mathrm{P}}(R) = F_{\\mathrm{tot}}(R) - F_{\\mathrm{HF}}(R) = F_{\\mathrm{tot}}(R) - (-2kR) = F_{\\mathrm{tot}}(R) + 2kR$.\n\n**3. Analytic Expression for Pulay Force $F_{\\mathrm{P}}(R)$**\n\nSubstituting the expressions for $F_{\\mathrm{tot}}$ and $F_{\\mathrm{HF}}$:\n$$\nF_{\\mathrm{P}}(R) = -\\frac{2R(1+S)(2k+(k-2\\alpha^2)S) + 4\\alpha R^3 S(k+2\\alpha^2)}{(1+S)^2} + 2kR\n$$\n$$\nF_{\\mathrm{P}}(R) = \\frac{-2R(1+S)(2k+(k-2\\alpha^2)S) - 4\\alpha R^3 S(k+2\\alpha^2) + 2kR(1+S)^2}{(1+S)^2}\n$$\nLet's expand the numerator and collect terms. Let $S = e^{-2\\alpha R^2}$.\nNumerator $= -2R(2k + (3k-2\\alpha^2)S + (k-2\\alpha^2)S^2) - (4\\alpha k R^3 + 8\\alpha^3 R^3)S + 2kR(1+2S+S^2)$\n$= (-4kR - (6k-4\\alpha^2)RS - (2k-4\\alpha^2)RS^2) - (4\\alpha k R^3 + 8\\alpha^3 R^3)S + (2kR+4kRS+2kRS^2)$\n$= (-4kR+2kR) + (-6k+4\\alpha^2+4k)RS + (-2k+4\\alpha^2+2k)RS^2 - (4\\alpha k R^3 + 8\\alpha^3 R^3)S$\n$= -2kR + (-2k+4\\alpha^2)RS + 4\\alpha^2 RS^2 - (4\\alpha k R^3 + 8\\alpha^3 R^3)S$\n$= -2kR - R(2k - 4\\alpha^2 + 4\\alpha k R^2 + 8\\alpha^3 R^2)S + 4\\alpha^2 R S^2$\nThus, the Pulay force is:\n$$\nF_{\\mathrm{P}}(R) = \\frac{-2kR - R(2k - 4\\alpha^2 + 4\\alpha k R^2 + 8\\alpha^3 R^2)e^{-2\\alpha R^2} + 4\\alpha^2 R (e^{-2\\alpha R^2})^2 + 2kR(1+e^{-2\\alpha R^2})^2}{(1+e^{-2\\alpha R^2})^2}\n$$\nA simpler form comes from $F_P(R) = F_{tot}(R) + 2kR$.\n$F_{\\mathrm{P}}(R) = -2R \\frac{2k+(k-2\\alpha^2)S}{1+S} + \\frac{4\\alpha R^3 S(k+2\\alpha^2)}{(1+S)^2} + 2kR$\n$= 2kR\\left(1 - \\frac{1+S}{1+S}\\right) - 2R \\frac{2k+(k-2\\alpha^2)S}{1+S} + ...$\n$= \\frac{2kR(1+S) - 2R(2k+(k-2\\alpha^2)S)}{1+S} + \\frac{4\\alpha R^3 S(k+2\\alpha^2)}{(1+S)^2}$\n$= \\frac{2kR+2kRS - 4kR-2(k-2\\alpha^2)RS}{1+S} + \\dots$\n$= \\frac{-2kR - (2k-4\\alpha^2-2k)RS}{1+S} + \\dots = \\frac{-2kR + 4\\alpha^2 RS}{1+S} + \\frac{4\\alpha R^3 S(k+2\\alpha^2)}{(1+S)^2}$\nThe full expression is:\n$$\nF_{\\mathrm{P}}(R) = \\frac{-R \\left[ 2k + (2k - 4\\alpha^2 + 4\\alpha k R^2 + 8\\alpha^3 R^2) e^{-2\\alpha R^2} - 4\\alpha^2 e^{-4\\alpha R^2} \\right]}{(1+e^{-2\\alpha R^2})^2}\n$$", "answer": "$$\n\\boxed{\\frac{-R \\left[ 2k + (2k - 4\\alpha^2 + 4\\alpha k R^2 + 8\\alpha^3 R^2) \\exp(-2\\alpha R^2) - 4\\alpha^2 \\exp(-4\\alpha R^2) \\right]}{(1+\\exp(-2\\alpha R^2))^2}}\n$$", "id": "3431498"}, {"introduction": "Once the theoretical origin of forces is understood, the next practical step is to ensure their numerical accuracy for a given computational setup. In plane-wave calculations, the primary convergence parameter is the kinetic energy cutoff, $E_{\\mathrm{cut}}$, which determines the size of the basis set. This exercise guides you through a realistic and essential workflow: performing convergence tests to determine an adequate $E_{\\mathrm{cut}}$ by balancing the required force accuracy against the escalating computational cost, a fundamental trade-off in all large-scale simulations [@problem_id:3431500].", "problem": "You are tasked with designing a program that, in the context of Born-Oppenheimer Molecular Dynamics (BOMD), determines the minimum plane-wave kinetic energy cutoff $E_{\\mathrm{cut}}$ required to achieve a specified force convergence target and estimates computational cost scaling with system size. In BOMD, the ionic forces are obtained by solving the electronic ground state at each time step. Plane-wave basis sets are truncated by a kinetic energy cutoff $E_{\\mathrm{cut}}$; the discretization error in the forces decreases with increasing $E_{\\mathrm{cut}}$. Your program must use a simple, physically motivated model to predict the required $E_{\\mathrm{cut}}$, then use a cost model to estimate total floating-point operations (FLOPs) for several system sizes.\n\nAssume the following foundations:\n- Born-Oppenheimer Molecular Dynamics (BOMD): at each time step, the electronic ground state is solved self-consistently and forces are computed from the ground-state electron density.\n- For a plane-wave basis, the number of plane waves scales as $N_{\\mathrm{pw}} \\propto E_{\\mathrm{cut}}^{3/2}$ for fixed cell volume per atom.\n- The force discretization error for silicon with a given pseudopotential can be modeled as a power law, $\\epsilon(E_{\\mathrm{cut}}) = A\\,E_{\\mathrm{cut}}^{-\\beta}$, where $A$ and $\\beta$ are positive, material- and pseudopotential-dependent constants to be determined by fitting to measured data.\n\nProcedure to implement:\n1. Given measured pairs $\\{(E_{\\mathrm{cut},i}, \\epsilon_i)\\}$, fit the model $\\epsilon(E_{\\mathrm{cut}}) = A\\,E_{\\mathrm{cut}}^{-\\beta}$ by performing a least-squares regression in logarithmic space. Specifically, fit $y = \\ln \\epsilon$ versus $x = \\ln E_{\\mathrm{cut}}$ to obtain $y = \\ln A - \\beta x$, and recover $A = e^{\\ln A}$ and $\\beta = -(\\text{slope})$.\n2. For a target force tolerance $\\epsilon_{\\mathrm{target}}$, compute the predicted minimum cutoff\n$$\nE_{\\mathrm{cut,min}} = \\left(\\frac{A}{\\epsilon_{\\mathrm{target}}}\\right)^{1/\\beta}.\n$$\n3. To avoid extrapolation outside the measured range, clip the predicted $E_{\\mathrm{cut,min}}$ to the closed interval $[E_{\\min}, E_{\\max}]$ where $E_{\\min} = \\min_i E_{\\mathrm{cut},i}$ and $E_{\\max} = \\max_i E_{\\mathrm{cut},i}$. Define a boolean $b$ that is $\\mathrm{True}$ if the predicted error at the clipped $E_{\\mathrm{cut,min}}$ satisfies $\\epsilon(E_{\\mathrm{cut,min}}) \\le \\epsilon_{\\mathrm{target}}$, and $\\mathrm{False}$ otherwise.\n4. Estimate the total computational cost over $M$ time steps using the following model:\n   - Number of plane waves:\n   $$\n   N_{\\mathrm{pw}}(E_{\\mathrm{cut}}, N) = K\\,N\\,E_{\\mathrm{cut}}^{3/2},\n   $$\n   where $N$ is the number of atoms and $K$ is determined from a baseline reference.\n   - Number of occupied Kohn-Sham states for silicon (with spin degeneracy and $4$ valence electrons per atom):\n   $$\n   N_{\\mathrm{states}}(N) = 2 N.\n   $$\n   - Per-step cost in floating-point operations (FLOPs), assuming a mixture of Fast Fourier Transform (FFT) and linear algebra operations:\n   $$\n   C_{\\mathrm{step}}(E_{\\mathrm{cut}}, N) = c_{\\mathrm{fft}}\\,N_{\\mathrm{pw}}\\,\\ln N_{\\mathrm{pw}} + c_{\\mathrm{ops}}\\,N_{\\mathrm{states}}\\,N_{\\mathrm{pw}}.\n   $$\n   - Total cost over $M$ steps:\n   $$\n   C_{\\mathrm{total}}(E_{\\mathrm{cut}}, N, M) = M \\times C_{\\mathrm{step}}(E_{\\mathrm{cut}}, N).\n   $$\n   Use the following baseline calibration constants:\n   - $E_0 = 400\\,\\mathrm{eV}$, $N_0 = 8$, $N_{\\mathrm{pw},0} = 20000$, so that\n   $$\n   K = \\frac{N_{\\mathrm{pw},0}}{N_0\\,E_0^{3/2}}.\n   $$\n   - $c_{\\mathrm{fft}} = 5\\times 10^{2}$, $c_{\\mathrm{ops}} = 1\\times 10^{2}$.\n   Report $C_{\\mathrm{total}}$ in FLOPs, rounded to the nearest integer.\n\nImplement the above for the following test suite. In all cases, energies must be expressed in $\\mathrm{eV}$ and force errors in $\\mathrm{eV/\\AA}$:\n- Test Case $1$ (norm-conserving pseudopotential, silicon):\n  - Measured data: $E_{\\mathrm{cut}} = [200,\\,300,\\,400,\\,600]\\,\\mathrm{eV}$, $\\epsilon = [5.0\\times 10^{-3},\\,2.5\\times 10^{-3},\\,1.6\\times 10^{-3},\\,0.9\\times 10^{-3}]\\,\\mathrm{eV/\\AA}$.\n  - Target: $\\epsilon_{\\mathrm{target}} = 1.0\\times 10^{-3}\\,\\mathrm{eV/\\AA}$.\n  - Sizes and steps: $N = [8,\\,64,\\,512]$, $M = 100$.\n- Test Case $2$ (projector augmented-wave-like behavior, silicon):\n  - Measured data: $E_{\\mathrm{cut}} = [150,\\,250,\\,350,\\,450]\\,\\mathrm{eV}$, $\\epsilon = [3.0\\times 10^{-3},\\,1.5\\times 10^{-3},\\,1.0\\times 10^{-3},\\,0.7\\times 10^{-3}]\\,\\mathrm{eV/\\AA}$.\n  - Target: $\\epsilon_{\\mathrm{target}} = 1.0\\times 10^{-3}\\,\\mathrm{eV/\\AA}$.\n  - Sizes and steps: $N = [8,\\,216]$, $M = 50$.\n- Test Case $3$ (boundary case, silicon):\n  - Measured data: $E_{\\mathrm{cut}} = [300,\\,400,\\,500]\\,\\mathrm{eV}$, $\\epsilon = [2.2\\times 10^{-3},\\,1.6\\times 10^{-3},\\,1.3\\times 10^{-3}]\\,\\mathrm{eV/\\AA}$.\n  - Target: $\\epsilon_{\\mathrm{target}} = 2.0\\times 10^{-3}\\,\\mathrm{eV/\\AA}$.\n  - Sizes and steps: $N = [8]$, $M = 10$.\n\nYour program must perform, for each test case, the following outputs in order:\n- The clipped $E_{\\mathrm{cut,min}}$ in $\\mathrm{eV}$ as a floating-point number.\n- The boolean $b$ indicating whether the target is satisfied at the clipped $E_{\\mathrm{cut,min}}$.\n- The total costs $C_{\\mathrm{total}}$ for each specified $N$ as integers, in the order the sizes are listed.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For example, for three test cases, the output should be of the form $[\\text{E1},\\text{b1},\\text{C1}_1,\\dots,\\text{E2},\\text{b2},\\text{C2}_1,\\dots,\\text{E3},\\text{b3},\\text{C3}_1,\\dots]$, where $\\text{E}$ are floating-point numbers in $\\mathrm{eV}$, $\\text{b}$ are boolean values, and $\\text{C}$ are integers in FLOPs.", "solution": "The problem requires the design of a computational procedure to determine an adequate plane-wave kinetic energy cutoff ($E_{\\mathrm{cut}}$) for a Born-Oppenheimer Molecular Dynamics (BOMD) simulation and to estimate the resulting computational cost. This task is a standard component of computational resource planning in materials simulations. The solution proceeds in three stages: first, fitting an empirical model for force convergence; second, using the model to predict the required $E_{\\mathrm{cut}}$ and validating it; and third, applying a scaling model to estimate the total computational cost in floating-point operations (FLOPs).\n\n### 1. Force Error Model and Parameter Fitting\n\nIn plane-wave based electronic structure calculations, the basis set is truncated by including only plane waves with a kinetic energy below a specified cutoff, $E_{\\mathrm{cut}}$. This introduces a discretization error that systematically decreases as $E_{\\mathrm{cut}}$ increases. For the forces on the ions, this convergence behavior can be effectively modeled by a power law:\n$$\n\\epsilon(E_{\\mathrm{cut}}) = A\\,E_{\\mathrm{cut}}^{-\\beta}\n$$\nHere, $\\epsilon$ represents the error in the forces (e.g., the root-mean-square difference from the converged value), while $A$ and $\\beta$ are positive constants that depend on the element (silicon in this case) and the specifics of the pseudopotential used.\n\nTo determine the parameters $A$ and $\\beta$ from a set of measured data points $\\{(E_{\\mathrm{cut},i}, \\epsilon_i)\\}$, we linearize the model by taking the natural logarithm of both sides:\n$$\n\\ln(\\epsilon) = \\ln(A\\,E_{\\mathrm{cut}}^{-\\beta}) = \\ln(A) + \\ln(E_{\\mathrm{cut}}^{-\\beta}) = \\ln(A) - \\beta \\ln(E_{\\mathrm{cut}})\n$$\nThis equation has the form of a straight line, $y = c + mx$, where $y = \\ln(\\epsilon)$, $x = \\ln(E_{\\mathrm{cut}})$, the intercept is $c = \\ln(A)$, and the slope is $m = -\\beta$. We can therefore perform a linear least-squares regression on the log-transformed data $(\\ln E_{\\mathrm{cut},i}, \\ln \\epsilon_i)$ to find the best-fit values for the slope and intercept. The model parameters are then recovered as $\\beta = -m$ and $A = e^c$.\n\n### 2. Determination and Validation of Energy Cutoff\n\nOnce the error model is parameterized, it can be used to predict the minimum energy cutoff required to achieve a desired force tolerance, $\\epsilon_{\\mathrm{target}}$. By rearranging the model equation, we solve for $E_{\\mathrm{cut}}$:\n$$\nE_{\\mathrm{cut,min}} = \\left(\\frac{A}{\\epsilon_{\\mathrm{target}}}\\right)^{1/\\beta}\n$$\nA critical aspect of using empirical models is avoiding extrapolation far beyond the domain of the data used for fitting. Therefore, the predicted cutoff, $E_{\\mathrm{cut,pred}}$, is clipped to the range of the measured cutoffs, $[E_{\\min}, E_{\\max}]$, where $E_{\\min} = \\min_i(E_{\\mathrm{cut},i})$ and $E_{\\max} = \\max_i(E_{\\mathrm{cut},i})$. The final, operational cutoff is thus $E_{\\mathrm{cut,min}} = \\mathrm{clip}(E_{\\mathrm{cut,pred}}, E_{\\min}, E_{\\max})$.\n\nThis clipping necessitates a verification step. It is possible that the target tolerance $\\epsilon_{\\mathrm{target}}$ is too stringent and cannot be achieved even at the highest measured cutoff, $E_{\\max}$. In this scenario, the clipped cutoff would be $E_{\\max}$, but the error at this cutoff, $\\epsilon(E_{\\max})$, would still be greater than $\\epsilon_{\\mathrm{target}}$. We must therefore compute the error at the clipped cutoff, $\\epsilon(E_{\\mathrm{cut,min}})$, and explicitly check if it satisfies the condition $\\epsilon(E_{\\mathrm{cut,min}}) \\le \\epsilon_{\\mathrm{target}}$. The outcome of this check is stored in a boolean variable, $b$.\n\n### 3. Computational Cost Estimation\n\nThe total computational cost of a BOMD simulation is estimated based on the cost per time step and the total number of steps. The per-step cost is a function of the system size (number of atoms, $N$) and the basis set size (number of plane waves, $N_{\\mathrm{pw}}$).\n\nThe number of plane waves, $N_{\\mathrm{pw}}$, scales with the volume of the sphere in reciprocal space defined by $E_{\\mathrm{cut}}$, and also with the number of atoms, $N$, for a fixed-density system. This is modeled as:\n$$\nN_{\\mathrm{pw}}(E_{\\mathrm{cut}}, N) = K\\,N\\,E_{\\mathrm{cut}}^{3/2}\n$$\nThe proportionality constant $K$ is calibrated from a single reference calculation with known $N_0$, $E_0$, and $N_{\\mathrm{pw},0}$, yielding $K = N_{\\mathrm{pw},0} / (N_0\\,E_0^{3/2})$.\n\nFor silicon, which has $4$ valence electrons per atom, the number of occupied Kohn-Sham states (or bands) is half the number of valence electrons, assuming spin-degeneracy. Thus, $N_{\\mathrm{states}}(N) = 2N$.\n\nThe computational cost per time step, $C_{\\mathrm{step}}$, is modeled as a sum of two dominant contributions:\n$$\nC_{\\mathrm{step}}(E_{\\mathrm{cut}}, N) = c_{\\mathrm{fft}}\\,N_{\\mathrm{pw}}\\,\\ln N_{\\mathrm{pw}} + c_{\\mathrm{ops}}\\,N_{\\mathrm{states}}\\,N_{\\mathrm{pw}}\n$$\nThe first term, scaling as $O(N_{\\mathrm{pw}} \\log N_{\\mathrm{pw}})$, represents the cost of Fast Fourier Transforms (FFTs) used to switch between real and reciprocal space representations of wavefunctions and densities. The second term, scaling as $O(N_{\\mathrm{states}} N_{\\mathrm{pw}})$, represents the cost of linear algebra operations such as the orthogonalization of the electronic wavefunctions. The coefficients $c_{\\mathrm{fft}}$ and $c_{\\mathrm{ops}}$ are empirically determined constants.\n\nThe total cost over a simulation of $M$ steps for a system of $N$ atoms using the determined cutoff $E_{\\mathrm{cut,min}}$ is then:\n$$\nC_{\\mathrm{total}} = M \\times C_{\\mathrm{step}}(E_{\\mathrm{cut,min}}, N)\n$$\nThis value is reported as the nearest integer. This entire procedure is applied to each test case provided.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Main function to process all test cases and print the final output.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"E_cut_data\": [200., 300., 400., 600.],\n            \"epsilon_data\": [5.0e-3, 2.5e-3, 1.6e-3, 0.9e-3],\n            \"epsilon_target\": 1.0e-3,\n            \"N_values\": [8, 64, 512],\n            \"M\": 100\n        },\n        {\n            \"E_cut_data\": [150., 250., 350., 450.],\n            \"epsilon_data\": [3.0e-3, 1.5e-3, 1.0e-3, 0.7e-3],\n            \"epsilon_target\": 1.0e-3,\n            \"N_values\": [8, 216],\n            \"M\": 50\n        },\n        {\n            \"E_cut_data\": [300., 400., 500.],\n            \"epsilon_data\": [2.2e-3, 1.6e-3, 1.3e-3],\n            \"epsilon_target\": 2.0e-3,\n            \"N_values\": [8],\n            \"M\": 10\n        }\n    ]\n\n    # Baseline calibration constants\n    E0 = 400.0\n    N0 = 8\n    N_pw0 = 20000\n    \n    # Cost model coefficients\n    c_fft = 5e2\n    c_ops = 1e2\n\n    # Calculate the plane-wave scaling constant K\n    K = N_pw0 / (N0 * E0**(1.5))\n\n    results = []\n\n    for case in test_cases:\n        # Step 1: Fit the error model epsilon = A * E_cut^(-beta)\n        # We fit ln(epsilon) = ln(A) - beta * ln(E_cut)\n        log_E = np.log(case[\"E_cut_data\"])\n        log_eps = np.log(case[\"epsilon_data\"])\n        \n        # polyfit(x, y, 1) returns [slope, intercept] for y = slope*x + intercept\n        slope, intercept = np.polyfit(log_E, log_eps, 1)\n        \n        beta = -slope\n        A = np.exp(intercept)\n\n        # Step 2: For a target, compute the predicted minimum cutoff\n        E_cut_pred = (A / case[\"epsilon_target\"])**(1.0 / beta)\n        \n        # Step 3: Clip the predicted E_cut_min and validate\n        E_min_data = min(case[\"E_cut_data\"])\n        E_max_data = max(case[\"E_cut_data\"])\n        E_cut_clipped = np.clip(E_cut_pred, E_min_data, E_max_data)\n        \n        # Calculate the error at the clipped cutoff to validate\n        epsilon_at_clipped = A * E_cut_clipped**(-beta)\n        b = epsilon_at_clipped <= case[\"epsilon_target\"]\n        \n        results.append(E_cut_clipped)\n        results.append(b)\n\n        # Step 4: Estimate the total computational cost\n        M = case[\"M\"]\n        for N in case[\"N_values\"]:\n            # Number of plane waves, using the clipped E_cut\n            N_pw = K * N * E_cut_clipped**(1.5)\n            \n            # Number of occupied Kohn-Sham states for silicon\n            N_states = 2 * N\n            \n            # Per-step cost in FLOPs\n            C_step = c_fft * N_pw * np.log(N_pw) + c_ops * N_states * N_pw\n            \n            # Total cost over M steps\n            C_total = M * C_step\n            \n            # Append the cost, rounded to the nearest integer\n            results.append(round(C_total))\n\n    # Final print statement in the exact required format.\n    # Convert booleans to their string representation \"True\" or \"False\"\n    # Convert numbers to their standard string representation\n    str_results = [str(r) for r in results]\n    print(f\"[{','.join(str_results)}]\")\n\nsolve()\n```", "id": "3431500"}, {"introduction": "With a protocol for calculating accurate forces, the final core task is to use them to propagate the nuclear dynamics in time. The choice of the integration time step, $\\Delta t$, is paramount for both the numerical stability and the physical fidelity of the simulation. This exercise delves into the analysis of the velocity Verlet algorithm, demonstrating how to choose a time step that simultaneously satisfies the mathematical stability condition of the integrator and the physical requirement of accurately resolving the fastest vibrational modes in the system [@problem_id:3393482].", "problem": "In Born–Oppenheimer molecular dynamics (BOMD), the nuclei evolve on the instantaneous ground-state electronic potential energy surface and are integrated with a symplectic second-order scheme such as the velocity Verlet algorithm. Near a local minimum, each nuclear normal mode is well approximated as an independent harmonic oscillator of angular frequency $\\omega$. For numerical stability and accuracy, the time step $\\Delta t$ must be chosen with respect to the highest normal-mode angular frequency $\\omega_{\\max}$.\n\nAssume the following:\n- The nuclei are integrated with velocity Verlet.\n- The highest angular frequency is $\\omega_{\\max} = 7.5 \\times 10^{14}\\ \\mathrm{s}^{-1}$.\n- You define the “relative integration error” for the stiffest mode as the relative error in the angular frequency induced by time discretization, that is, $|\\tilde{\\omega} - \\omega|/\\omega$, where $\\tilde{\\omega}$ is the numerical angular frequency produced by the integrator for a harmonic oscillator.\n- You require that, for the stiffest mode, the relative integration error satisfy $|\\tilde{\\omega} - \\omega|/\\omega \\le \\varepsilon$ with $\\varepsilon = 2.0 \\times 10^{-3}$.\n\nStarting from Newton’s second law for a harmonic oscillator and the position–velocity form of the velocity Verlet scheme, derive a bound on $\\Delta t$ that simultaneously ensures linear stability of the scheme and enforces the above relative integration error requirement for the mode with frequency $\\omega_{\\max}$. Then, taking the more restrictive bound, choose a single time step.\n\nRound your final time step to $3$ significant figures. Express the final time step in femtoseconds (fs).", "solution": "We begin from Newton’s second law applied to a single harmonic normal mode,\n$$\nm \\ddot{q}(t) = - m \\omega^{2} q(t),\n$$\nwhich can be written as\n$$\n\\ddot{q}(t) + \\omega^{2} q(t) = 0.\n$$\nThe velocity Verlet algorithm advances the position $q$ and velocity $v$ via\n$$\nq_{n+1} = q_{n} + \\Delta t\\, v_{n} + \\tfrac{1}{2} \\Delta t^{2} a_{n}, \\quad a_{n} = -\\omega^{2} q_{n},\n$$\n$$\nv_{n+1} = v_{n} + \\tfrac{1}{2} \\Delta t \\left(a_{n} + a_{n+1}\\right).\n$$\nEliminating velocities yields a position-only recurrence. Using $a_{n} = -\\omega^{2} q_{n}$ and the same for $n+1$, subtract the update for $q_{n}$ from that for $q_{n+1}$ shifted by one step to obtain\n$$\nq_{n+1} - 2 q_{n} + q_{n-1} = - \\omega^{2} \\Delta t^{2} q_{n}.\n$$\nSeeking harmonic solutions $q_{n} = A \\exp(i n \\theta)$ gives the dispersion relation\n$$\n\\exp(i\\theta) - 2 + \\exp(-i\\theta) + \\omega^{2} \\Delta t^{2} = 0 \\;\\;\\Longrightarrow\\;\\; 2(\\cos \\theta - 1) + \\omega^{2} \\Delta t^{2} = 0,\n$$\nor\n$$\n\\cos \\theta = 1 - \\tfrac{1}{2} \\omega^{2} \\Delta t^{2}.\n$$\nIdentifying $\\theta = \\tilde{\\omega} \\Delta t$ defines the numerical angular frequency $\\tilde{\\omega}$ through\n$$\n\\cos(\\tilde{\\omega} \\Delta t) = 1 - \\tfrac{1}{2} \\omega^{2} \\Delta t^{2}.\n$$\nFor small $\\Delta t$, expand $\\cos(\\tilde{\\omega} \\Delta t)$ and solve perturbatively. Write $\\tilde{\\omega} \\Delta t = \\theta$ and expand $\\cos \\theta = 1 - \\theta^{2}/2 + \\theta^{4}/24 + \\mathcal{O}(\\theta^{6})$. Equating to $1 - \\tfrac{1}{2} \\omega^{2} \\Delta t^{2}$ yields\n$$\n1 - \\frac{\\theta^{2}}{2} + \\frac{\\theta^{4}}{24} + \\cdots = 1 - \\frac{\\omega^{2} \\Delta t^{2}}{2}.\n$$\nCanceling $1$ and multiplying by $-2$,\n$$\n\\theta^{2} - \\frac{\\theta^{4}}{12} + \\cdots = \\omega^{2} \\Delta t^{2}.\n$$\nSolving for $\\theta$ to leading nontrivial order via a perturbation ansatz $\\theta = \\omega \\Delta t \\left(1 + c\\, \\omega^{2} \\Delta t^{2} + \\cdots \\right)$ gives\n$$\n\\theta^{2} = \\omega^{2} \\Delta t^{2} \\left(1 + 2 c\\, \\omega^{2} \\Delta t^{2} + \\cdots \\right), \\quad\n\\theta^{4} = \\omega^{4} \\Delta t^{4} \\left(1 + \\cdots \\right).\n$$\nSubstituting into the previous relation,\n$$\n\\omega^{2} \\Delta t^{2} \\left(1 + 2 c\\, \\omega^{2} \\Delta t^{2}\\right) - \\frac{1}{12} \\omega^{4} \\Delta t^{4} = \\omega^{2} \\Delta t^{2} + \\mathcal{O}(\\Delta t^{6}),\n$$\nwhich implies\n$$\n2 c\\, \\omega^{4} \\Delta t^{4} - \\frac{1}{12} \\omega^{4} \\Delta t^{4} = 0 \\;\\;\\Longrightarrow\\;\\; c = \\frac{1}{24}.\n$$\nHence\n$$\n\\tilde{\\omega} \\Delta t = \\theta = \\omega \\Delta t \\left(1 + \\frac{(\\omega \\Delta t)^{2}}{24} + \\mathcal{O}(\\Delta t^{4}) \\right),\n$$\nor, dividing by $\\Delta t$,\n$$\n\\tilde{\\omega} = \\omega \\left(1 + \\frac{(\\omega \\Delta t)^{2}}{24} + \\mathcal{O}(\\Delta t^{4}) \\right).\n$$\nTherefore, the relative integration error in angular frequency is, to leading order,\n$$\n\\frac{|\\tilde{\\omega} - \\omega|}{\\omega} \\approx \\frac{(\\omega \\Delta t)^{2}}{24}.\n$$\nImposing the requirement for the stiffest mode with $\\omega = \\omega_{\\max}$,\n$$\n\\frac{(\\omega_{\\max} \\Delta t)^{2}}{24} \\le \\varepsilon \\;\\;\\Longrightarrow\\;\\; \\Delta t \\le \\frac{\\sqrt{24\\, \\varepsilon}}{\\omega_{\\max}}.\n$$\nIn addition to accuracy, linear stability requires that the amplification factor remain bounded. From $\\cos(\\tilde{\\omega} \\Delta t) = 1 - \\tfrac{1}{2} \\omega^{2} \\Delta t^{2}$, a necessary and sufficient condition for real $\\tilde{\\omega}$ (and thus non-growing oscillations) is $|1 - \\tfrac{1}{2} \\omega^{2} \\Delta t^{2}| \\le 1$, which yields\n$$\n0 \\le \\omega^{2} \\Delta t^{2} \\le 4 \\;\\;\\Longrightarrow\\;\\; \\Delta t \\le \\frac{2}{\\omega}.\n$$\nApplying this to the stiffest mode gives the stability bound $\\Delta t \\le 2 / \\omega_{\\max}$.\n\nThe admissible time step is thus\n$$\n\\Delta t \\le \\min\\!\\left(\\frac{\\sqrt{24\\, \\varepsilon}}{\\omega_{\\max}},\\ \\frac{2}{\\omega_{\\max}}\\right).\n$$\nNumerically, with $\\omega_{\\max} = 7.5 \\times 10^{14}\\ \\mathrm{s}^{-1}$ and $\\varepsilon = 2.0 \\times 10^{-3}$,\n$$\n\\sqrt{24\\, \\varepsilon} = \\sqrt{24 \\times 2.0 \\times 10^{-3}} = \\sqrt{4.8 \\times 10^{-2}} \\approx 2.19089 \\times 10^{-1},\n$$\nso the accuracy-limited step is\n$$\n\\Delta t_{\\mathrm{acc}} = \\frac{2.19089 \\times 10^{-1}}{7.5 \\times 10^{14}}\\ \\mathrm{s} \\approx 2.92119 \\times 10^{-16}\\ \\mathrm{s}.\n$$\nThe stability-limited step is\n$$\n\\Delta t_{\\mathrm{stab}} = \\frac{2}{7.5 \\times 10^{14}}\\ \\mathrm{s} \\approx 2.66667 \\times 10^{-15}\\ \\mathrm{s}.\n$$\nThe more restrictive constraint is the accuracy requirement, so the chosen time step is $\\Delta t \\approx 2.92119 \\times 10^{-16}\\ \\mathrm{s}$.\n\nConverting to femtoseconds using $1\\ \\mathrm{fs} = 10^{-15}\\ \\mathrm{s}$,\n$$\n\\Delta t \\approx 0.292119\\ \\mathrm{fs}.\n$$\nRounded to $3$ significant figures,\n$$\n\\Delta t \\approx 0.292\\ \\mathrm{fs}.\n$$", "answer": "$$\\boxed{0.292}$$", "id": "3393482"}]}