{"hands_on_practices": [{"introduction": "The shape of a peak in an NMR spectrum holds crucial information about the underlying physics of the spin system. This practice delves into the fundamental relationship between the decay of the time-domain signal, the free induction decay (FID), and the width of the corresponding frequency-domain peak. By working through the Fourier transform of an exponentially decaying sinusoid [@problem_id:3720181], you will quantitatively see how the effective transverse relaxation time, $T_2^*$, dictates the spectral linewidth and how this knowledge is practically applied to assess improvements in resolution from magnet shimming.", "problem": "In pulsed Fourier transform nuclear magnetic resonance (NMR) spectroscopy used for spectrometric identification of organic compounds, magnetic field inhomogeneity and microscopic dephasing contribute to the effective transverse relaxation time, denoted $T_2^*$ (effective transverse relaxation time). Consider a single isolated resonance whose free induction decay (FID) is well approximated by an exponentially damped sinusoid,\n$$s(t) = s_0 \\exp\\!\\left(-\\frac{t}{T_2^*}\\right) \\cos\\!\\left(2\\pi \\nu_0 t\\right) u(t),$$\nwhere $u(t)$ is the unit step function enforcing $t \\ge 0$, $s_0$ is a real constant, and $\\nu_0$ is the resonance frequency. The one-sided Fourier transform is defined by\n$$S(\\nu) = \\int_{0}^{\\infty} s(t) \\exp\\!\\left(-i 2\\pi \\nu t\\right)\\, dt.$$\nUsing only the above definitions and standard Fourier analysis, derive the absorption-mode spectral line shape and determine its full width at half maximum (FWHM), $\\Delta \\nu_{1/2}$, in terms of $T_2^*$. Then, for a sample before shimming with $T_2^* = 50\\,\\mathrm{ms}$ and after shimming with $T_2^* = 200\\,\\mathrm{ms}$, compute the corresponding FWHM linewidths in $\\mathrm{Hz}$.\n\nFinally, assess the gain in resolving closely spaced peaks by adopting the following operational resolution criterion: two equal-intensity Lorentzian lines of equal width are deemed “just resolved” when their center-to-center separation equals the FWHM of a single line. Define the resolution gain factor\n$$G \\equiv \\frac{\\Delta \\nu_{\\min,\\mathrm{before}}}{\\Delta \\nu_{\\min,\\mathrm{after}}},$$\nwhere $\\Delta \\nu_{\\min}$ is the minimal just-resolvable separation under the above criterion. Report $G$ as a single, dimensionless number. No rounding is necessary. Express any intermediate linewidths in $\\mathrm{Hz}$.", "solution": "The problem statement is scientifically grounded, well-posed, and contains all necessary information to derive a unique solution. The given physical model and parameters are standard in the field of nuclear magnetic resonance (NMR) spectroscopy.\n\nThe first step is to compute the Fourier transform of the free induction decay (FID) signal, $s(t)$, to obtain the frequency-domain spectrum, $S(\\nu)$. The FID is given as:\n$$s(t) = s_0 \\exp\\!\\left(-\\frac{t}{T_2^*}\\right) \\cos\\!\\left(2\\pi \\nu_0 t\\right) u(t)$$\nwhere $s_0$ is a real constant, $T_2^*$ is the effective transverse relaxation time, $\\nu_0$ is the resonance frequency, and $u(t)$ is the unit step function. The one-sided Fourier transform is defined as:\n$$S(\\nu) = \\int_{0}^{\\infty} s(t) \\exp\\!\\left(-i 2\\pi \\nu t\\right)\\, dt$$\nTo facilitate the integration, we express the cosine term using Euler's formula, $\\cos(x) = \\frac{1}{2}(\\exp(ix) + \\exp(-ix))$:\n$$s(t) = s_0 \\exp\\!\\left(-\\frac{t}{T_2^*}\\right) \\frac{1}{2} \\left[ \\exp(i 2\\pi \\nu_0 t) + \\exp(-i 2\\pi \\nu_0 t) \\right]$$\nSubstituting this into the Fourier transform integral, and since $u(t)$ restricts the integral to $t \\ge 0$, we have:\n$$S(\\nu) = \\frac{s_0}{2} \\int_{0}^{\\infty} \\left[ \\exp\\!\\left(-\\frac{t}{T_2^*} + i 2\\pi \\nu_0 t\\right) + \\exp\\!\\left(-\\frac{t}{T_2^*} - i 2\\pi \\nu_0 t\\right) \\right] \\exp(-i 2\\pi \\nu t)\\, dt$$\nWe can separate this into two integrals by combining the exponents:\n$$S(\\nu) = \\frac{s_0}{2} \\left[ \\int_{0}^{\\infty} \\exp\\!\\left(-t\\left(\\frac{1}{T_2^*} - i 2\\pi (\\nu_0 - \\nu)\\right)\\right) dt + \\int_{0}^{\\infty} \\exp\\!\\left(-t\\left(\\frac{1}{T_2^*} + i 2\\pi (\\nu_0 + \\nu)\\right)\\right) dt \\right]$$\nEach integral is of the form $\\int_{0}^{\\infty} \\exp(-at) dt = \\frac{1}{a}$, provided $\\mathrm{Re}(a) > 0$. In our case, $\\mathrm{Re}(a) = 1/T_2^* > 0$. Evaluating the integrals gives:\n$$S(\\nu) = \\frac{s_0}{2} \\left[ \\frac{1}{\\frac{1}{T_2^*} - i 2\\pi (\\nu_0 - \\nu)} + \\frac{1}{\\frac{1}{T_2^*} + i 2\\pi (\\nu_0 + \\nu)} \\right]$$\nThe problem requires the absorption-mode spectral line shape, which is the real part of the complex spectrum $S(\\nu)$. For typical NMR experiments, the detected frequency $\\nu$ is close to the resonance frequency $\\nu_0$, and both are positive and large. The second term, centered at $\\nu = -\\nu_0$, is far from the region of interest and its contribution to the lineshape around $\\nu_0$ is negligible. We can therefore approximate the spectrum near resonance by considering only the first term:\n$$S(\\nu) \\approx \\frac{s_0}{2} \\frac{1}{\\frac{1}{T_2^*} + i 2\\pi (\\nu - \\nu_0)}$$\nTo find the real part, we multiply the numerator and denominator by the complex conjugate of the denominator:\n$$S(\\nu) \\approx \\frac{s_0}{2} \\frac{\\frac{1}{T_2^*} - i 2\\pi (\\nu - \\nu_0)}{\\left(\\frac{1}{T_2^*}\\right)^2 + \\left(2\\pi (\\nu - \\nu_0)\\right)^2}$$\nThe absorption-mode spectrum, $A(\\nu)$, is the real part of $S(\\nu)$:\n$$A(\\nu) = \\mathrm{Re}[S(\\nu)] = \\frac{s_0}{2} \\frac{\\frac{1}{T_2^*}}{\\left(\\frac{1}{T_2^*}\\right)^2 + 4\\pi^2 (\\nu - \\nu_0)^2}$$\nThis is the equation for a Lorentzian lineshape centered at $\\nu_0$.\n\nNext, we determine the full width at half maximum (FWHM), denoted $\\Delta \\nu_{1/2}$. The maximum amplitude of the line, $A_{\\max}$, occurs at the resonance frequency $\\nu = \\nu_0$:\n$$A_{\\max} = A(\\nu_0) = \\frac{s_0}{2} \\frac{\\frac{1}{T_2^*}}{\\left(\\frac{1}{T_2^*}\\right)^2} = \\frac{s_0 T_2^*}{2}$$\nWe find the frequencies $\\nu$ for which the amplitude is half of its maximum value, i.e., $A(\\nu) = \\frac{1}{2}A_{\\max}$.\n$$\\frac{s_0}{2} \\frac{\\frac{1}{T_2^*}}{\\left(\\frac{1}{T_2^*}\\right)^2 + 4\\pi^2 (\\nu - \\nu_0)^2} = \\frac{1}{2} \\left( \\frac{s_0 T_2^*}{2} \\right) = \\frac{s_0 T_2^*}{4}$$\nCanceling terms and rearranging, we get:\n$$\\frac{2}{T_2^*} \\frac{1}{\\left(\\frac{1}{T_2^*}\\right)^2 + 4\\pi^2 (\\nu - \\nu_0)^2} = T_2^*$$\n$$2 = (T_2^*)^2 \\left[ \\left(\\frac{1}{T_2^*}\\right)^2 + 4\\pi^2 (\\nu - \\nu_0)^2 \\right]$$\n$$2 = 1 + 4\\pi^2 (T_2^*)^2 (\\nu - \\nu_0)^2$$\n$$1 = 4\\pi^2 (T_2^*)^2 (\\nu - \\nu_0)^2$$\nTaking the square root of both sides gives:\n$$\\pm 1 = 2\\pi T_2^* (\\nu - \\nu_0)$$\nThe two frequencies corresponding to the half-maximum points, $\\nu_{1/2,\\pm}$, are:\n$$\\nu_{1/2,\\pm} = \\nu_0 \\pm \\frac{1}{2\\pi T_2^*}$$\nThe FWHM is the difference between these two frequencies:\n$$\\Delta \\nu_{1/2} = \\nu_{1/2,+} - \\nu_{1/2,-} = \\left(\\nu_0 + \\frac{1}{2\\pi T_2^*}\\right) - \\left(\\nu_0 - \\frac{1}{2\\pi T_2^*}\\right) = \\frac{1}{\\pi T_2^*}$$\nThis is the analytical relationship between the FWHM and $T_2^*$.\n\nNow we compute the numerical FWHM values before and after shimming.\nBefore shimming: $T_{2,\\text{before}}^* = 50\\,\\mathrm{ms} = 5 \\times 10^{-2}\\,\\mathrm{s}$.\n$$\\Delta \\nu_{1/2, \\text{before}} = \\frac{1}{\\pi (5 \\times 10^{-2}\\,\\mathrm{s})} = \\frac{20}{\\pi}\\,\\mathrm{Hz}$$\nAfter shimming: $T_{2,\\text{after}}^* = 200\\,\\mathrm{ms} = 2 \\times 10^{-1}\\,\\mathrm{s}$.\n$$\\Delta \\nu_{1/2, \\text{after}} = \\frac{1}{\\pi (2 \\times 10^{-1}\\,\\mathrm{s})} = \\frac{5}{\\pi}\\,\\mathrm{Hz}$$\n\nFinally, we assess the resolution gain. The criterion for two lines being \"just resolved\" is that their separation equals the FWHM. Thus, the minimal resolvable separation $\\Delta \\nu_{\\min}$ is equal to the FWHM, $\\Delta \\nu_{1/2}$.\n$$\\Delta \\nu_{\\min, \\text{before}} = \\Delta \\nu_{1/2, \\text{before}} = \\frac{20}{\\pi}\\,\\mathrm{Hz}$$\n$$\\Delta \\nu_{\\min, \\text{after}} = \\Delta \\nu_{1/2, \\text{after}} = \\frac{5}{\\pi}\\,\\mathrm{Hz}$$\nThe resolution gain factor $G$ is defined as the ratio of these minimal separations:\n$$G = \\frac{\\Delta \\nu_{\\min, \\text{before}}}{\\Delta \\nu_{\\min, \\text{after}}} = \\frac{20/\\pi}{5/\\pi} = \\frac{20}{5} = 4$$\nThe resolution gain factor is $4$, which is a dimensionless number. This indicates that shimming the magnet to increase $T_2^*$ by a factor of $4$ improves the ability to resolve closely spaced peaks by the same factor of $4$.", "answer": "$$\\boxed{4}$$", "id": "3720181"}, {"introduction": "A continuous analog signal, the FID, must be converted into digital data before the Fourier transform can be applied. The choices made during this sampling process fundamentally define the limits of what can be observed in the resulting spectrum. In this exercise [@problem_id:3720211], you will derive from first principles how the dwell time, $\\Delta t$, sets the observable spectral width and how the total acquisition time, $T_{acq}$, dictates the digital resolution, or the spacing between points in your spectrum. This practice is essential for learning how to design an experiment capable of resolving fine spectral details, such as small $J$-couplings.", "problem": "In a pulsed Fourier transform (FT) Nuclear Magnetic Resonance (NMR) experiment used for spectrometric identification of an organic compound, the free induction decay (FID) is sampled uniformly in time with a constant dwell time $\\Delta t$ and a total number of points $N$. A small homonuclear scalar coupling $J$ is expected and you seek to assess whether the sampling configuration provides sufficient frequency-domain granularity to resolve it.\n\nStarting from first principles of uniform time-domain sampling in pulsed FT experiments and the Fourier transform relationship between total acquisition time and frequency-domain point spacing, derive expressions for the spectral width and the digital resolution. Then, for the specific configuration $\\Delta t = 120\\,\\mu\\mathrm{s}$ and $N = 16384$, compute:\n1. The spectral width in $\\mathrm{Hz}$.\n2. The digital resolution in $\\mathrm{Hz}$.\n\nFinally, to evaluate the trade-off for resolving a small coupling, define the dimensionless figure-of-merit $R$ as the ratio of the coupling to the digital resolution, $R = J / \\delta f$, using $J = 2.0\\,\\mathrm{Hz}$. Compute $R$ and round your final answer to three significant figures. Express the spectral width and the digital resolution in $\\mathrm{Hz}$ during your derivation, but report only the final value of $R$ as your answer.", "solution": "The problem statement is evaluated for validity.\n\n### Step 1: Extract Givens\n- The experiment is a pulsed Fourier transform (FT) Nuclear Magnetic Resonance (NMR) experiment.\n- The signal is a free induction decay (FID).\n- The FID is sampled uniformly in time.\n- The constant dwell time is $\\Delta t$.\n- The total number of points is $N$.\n- A small homonuclear scalar coupling is denoted by $J$.\n- The specific configuration is $\\Delta t = 120\\,\\mu\\mathrm{s}$.\n- The specific configuration is $N = 16384$.\n- The goal is to derive expressions for the spectral width and the digital resolution.\n- The goal is to compute the spectral width in $\\mathrm{Hz}$.\n- The goal is to compute the digital resolution in $\\mathrm{Hz}$.\n- A dimensionless figure-of-merit is defined as $R = J / \\delta f$.\n- The value for the coupling is $J = 2.0\\,\\mathrm{Hz}$.\n- The goal is to compute $R$ and round the final answer to three significant figures.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientific or Factual Unsoundness**: The problem is scientifically sound. It is based on the fundamental principles of pulsed FT-NMR spectroscopy and digital signal processing, specifically the relationship between time-domain sampling parameters and frequency-domain characteristics established by the Fourier transform. The concepts of dwell time, number of points, spectral width, digital resolution, and scalar coupling are all standard in the field.\n2.  **Non-Formalizable or Irrelevant**: The problem is entirely formalizable using standard mathematical and physical relationships relevant to FT spectroscopy.\n3.  **Incomplete or Contradictory Setup**: The problem is self-contained. The values for $\\Delta t$ and $N$ are provided, which is sufficient to calculate the acquisition time, spectral width, and digital resolution. The value of $J$ is provided for the final calculation. There are no contradictions.\n4.  **Unrealistic or Infeasible**: The given values are realistic. A dwell time of $120\\,\\mu\\mathrm{s}$ and $16384$ ($=2^{14}$) points are common parameters in high-resolution NMR experiments. A coupling constant of $2.0\\,\\mathrm{Hz}$ is typical for vicinal proton-proton couplings.\n5.  **Ill-Posed or Poorly Structured**: The problem is well-posed and clearly structured, leading to a unique and meaningful solution.\n6.  **Pseudo-Profound, Trivial, or Tautological**: The problem requires a standard but non-trivial application of core FT-NMR principles. It is a valid exercise in understanding experimental parameterization.\n7.  **Outside Scientific Verifiability**: All calculations and principles are scientifically verifiable.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Derivation and Solution\n\nThe problem requires the derivation of the spectral width and digital resolution from first principles of uniform time-domain sampling in a pulsed FT experiment, followed by a calculation of a figure-of-merit.\n\n**1. Spectral Width ($\\text{SW}$)**\n\nIn digital signal processing, a time-domain signal is sampled at a constant rate, $f_s$. The time interval between successive samples is the dwell time, $\\Delta t$. The sampling rate is therefore the reciprocal of the dwell time:\n$$f_s = \\frac{1}{\\Delta t}$$\nAccording to the Nyquist-Shannon sampling theorem, to avoid aliasing (the misidentification of frequencies), the sampling rate must be at least twice the highest frequency component present in the signal. In modern NMR spectroscopy, quadrature detection is employed. This technique samples two orthogonal components of the precessing magnetization, which allows for the discrimination of positive and negative frequencies relative to the transmitter's reference frequency. For a system with quadrature detection, the spectral width ($\\text{SW}$) that can be observed without aliasing is equal to the sampling rate.\nTherefore, the spectral width is given by:\n$$\\text{SW} = f_s = \\frac{1}{\\Delta t}$$\n\n**2. Digital Resolution ($\\delta f$)**\n\nThe FID is sampled for a total duration known as the acquisition time, $T_{acq}$. This duration is the product of the number of sampled points, $N$, and the time interval between them, $\\Delta t$:\n$$T_{acq} = N \\cdot \\Delta t$$\nThe transformation from the time domain to the frequency domain is accomplished via a Discrete Fourier Transform (DFT), typically implemented as a Fast Fourier Transform (FFT) algorithm. A fundamental property of the Fourier transform is that the resolution in the frequency domain is inversely proportional to the total observation time in the time domain. The minimum frequency difference that can be distinguished, known as the digital resolution ($\\delta f$), is the spacing between adjacent points in the resulting frequency spectrum. This spacing is given by the reciprocal of the total acquisition time.\nTherefore, the digital resolution is:\n$$\\delta f = \\frac{1}{T_{acq}} = \\frac{1}{N \\Delta t}$$\n\n**3. Numerical Calculations**\n\nWe are given the specific instrumental parameters:\n- Dwell time: $\\Delta t = 120\\,\\mu\\mathrm{s} = 120 \\times 10^{-6}\\,\\mathrm{s}$\n- Number of points: $N = 16384$\n\nFirst, we calculate the spectral width in $\\mathrm{Hz}$:\n$$\\text{SW} = \\frac{1}{\\Delta t} = \\frac{1}{120 \\times 10^{-6}\\,\\mathrm{s}} = 8333.\\overline{3}\\,\\mathrm{Hz}$$\n\nNext, we calculate the digital resolution in $\\mathrm{Hz}$. We can do this by first finding the acquisition time:\n$$T_{acq} = N \\Delta t = 16384 \\times (120 \\times 10^{-6}\\,\\mathrm{s}) = 1.96608\\,\\mathrm{s}$$\nThen, the digital resolution is:\n$$\\delta f = \\frac{1}{T_{acq}} = \\frac{1}{1.96608\\,\\mathrm{s}} \\approx 0.508626\\,\\mathrm{Hz}$$\n\n**4. Figure-of-Merit ($R$)**\n\nThe problem defines a dimensionless figure-of-merit, $R$, to assess whether the sampling configuration is sufficient to resolve a scalar coupling, $J$. The definition is:\n$$R = \\frac{J}{\\delta f}$$\nThis ratio quantifies how many digital points span the frequency separation of the coupling. A value of $R > 1$ is necessary, and typically a value of $R \\geq 3$ is desired for accurate determination of the splitting.\n\nWe are given $J = 2.0\\,\\mathrm{Hz}$. Using the derived expression for $\\delta f$, we can write $R$ as:\n$$R = \\frac{J}{1/(N \\Delta t)} = J \\cdot N \\cdot \\Delta t = J \\cdot T_{acq}$$\nSubstituting the numerical values:\n$$R = (2.0\\,\\mathrm{Hz}) \\cdot (1.96608\\,\\mathrm{s}) = 3.93216$$\nThe problem requires the final answer to be rounded to three significant figures.\n$$R \\approx 3.93$$\nThis value indicates that the coupling of $2.0\\,\\mathrm{Hz}$ is spanned by nearly $4$ points in the frequency-domain spectrum, suggesting that the digital resolution is sufficient to resolve this feature.", "answer": "$$\\boxed{3.93}$$", "id": "3720211"}, {"introduction": "The rich patterns of multiplets seen in NMR spectra arise from the superposition of simpler signals in the time domain. This computational practice offers a constructive approach to understanding this principle: you will build a complex FID from the ground up. By combining individual decaying sinusoids corresponding to each allowed transition of a first-order triplet [@problem_id:3720138], you will directly model how chemical shifts and scalar couplings manifest in the time-domain signal. This exercise provides a powerful, tangible link between the abstract spin-system parameters and the physical signal measured by the spectrometer.", "problem": "You are asked to formalize, implement, and verify an analytic construction of a Free Induction Decay (FID) signal for a first-order three-line aromatic proton pattern in Nuclear Magnetic Resonance (NMR), and to predict the corresponding Fourier Transform (FT) spectrum. The physical setting is a single observed aromatic proton coupled to two equivalent neighboring protons of spin-$\\tfrac{1}{2}$, producing a triplet in the weak-coupling limit. Your derivation and implementation must start from the following foundational base:\n\n- The linear Bloch equation description for transverse magnetization in the rotating frame, where a single isochromat at angular frequency offset $\\omega$ evolves as $M_{xy}(t) = M_{xy}(0)\\,\\mathrm{e}^{-t/T_2^\\ast}\\,\\mathrm{e}^{\\mathrm{i}\\,\\omega t}$ for $t \\ge 0$.\n- Linearity of detection, so the measured signal is the linear superposition of contributions from all allowed transitions.\n- In the weak-coupling first-order limit for one proton coupled to $n$ equivalent neighbors with scalar coupling constant $J$ (in $\\mathrm{Hz}$), there are $n+1$ allowed transitions, symmetrically distributed in frequency around the chemical shift offset, with binomial intensities.\n\nFrom this base, you must derive that the analytic real FID for a triplet pattern can be written as a finite sum of exponentially decaying cosines with frequencies determined by the chemical shift and the scalar coupling constant. You must specify all quantities, units, and conventions used. The Fourier Transform (FT) magnitude spectrum must correspondingly exhibit three absorption lines at those frequencies.\n\nProgram requirements:\n\n- For each test case, construct the analytic time-domain FID $s(t)$ as a real signal of the form\n  $$\n  s(t) \\;=\\; \\mathrm{e}^{-t/T_2^\\ast}\\,\\sum_{k=1}^{3} A_k \\cos\\!\\big(2\\pi\\,\\nu_k\\,t + \\phi\\big),\n  $$\n  where $A_k$ are nonnegative real amplitudes, $\\nu_k$ are the transition frequencies in $\\mathrm{Hz}$ relative to the transmitter in the rotating frame, $T_2^\\ast$ is the apparent transverse relaxation time in $\\mathrm{s}$, and $\\phi$ is a constant initial phase in $\\mathrm{radians}$. You must assume $\\phi = 0$ and $A_k$ given by the binomial weights for a triplet, $A \\propto [1,2,1]$, with any overall scale absorbed into a global amplitude.\n- Use the following well-tested fact from first-order NMR for one proton coupled to two equivalent neighbors ($n=2$): there are $3$ transition frequencies separated by the scalar coupling constant $J$ and centered at the chemical shift offset frequency. With a spectrometer observing protons at frequency $\\nu_0$ in $\\mathrm{Hz}$, a chemical shift $\\delta$ in $\\mathrm{ppm}$ corresponds to an offset $\\nu_{\\text{cs}} = \\delta \\times \\nu_0 \\times 10^{-6}$ in $\\mathrm{Hz}$. Therefore, the three transition frequencies are $\\nu_{\\text{cs}} - J$, $\\nu_{\\text{cs}}$, and $\\nu_{\\text{cs}} + J$, in $\\mathrm{Hz}$.\n- For each test case, you must numerically generate the discrete FID using $N$ points sampled with dwell time $\\Delta t$ in $\\mathrm{s}$, i.e., at times $t_n = n\\,\\Delta t$ for $n = 0,1,\\dots,N-1$. Compute the discrete Fourier transform using a standard algorithm and form the magnitude spectrum $\\lvert S(\\nu)\\rvert$ against the corresponding frequency axis in $\\mathrm{Hz}$.\n- Your program must output the predicted triplet peak positions (in $\\mathrm{Hz}$, relative to the transmitter) for each test case, concatenated across test cases into a single flat list, sorted within each test case from lowest to highest frequency. The program may use the analytic positions derived above rather than peak-picking the discrete spectrum, but it must still construct the FID and perform the discrete Fourier transform internally to verify consistency. All angles must be in radians. All frequencies must be expressed in $\\mathrm{Hz}$.\n- Express the final numerical answers in $\\mathrm{Hz}$ as floating-point numbers rounded to three decimal places.\n\nTest suite:\n\nFor all cases, use the amplitude weights $[1,2,1]$, initial phase $\\phi = 0$, and the same sampling parameters $N$ and $\\Delta t$ as specified per case. The spectrometer frequency $\\nu_0$ is the proton Larmor frequency in $\\mathrm{Hz}$ given by the stated $\\mathrm{MHz}$ value times $10^6$.\n\n- Case $1$ (happy path):\n  - Chemical shift $\\delta = 7.250\\,\\mathrm{ppm}$,\n  - Scalar coupling $J = 7.200\\,\\mathrm{Hz}$,\n  - Spectrometer frequency $\\nu_0 = 400\\,\\mathrm{MHz}$,\n  - Apparent transverse relaxation $T_2^\\ast = 0.500\\,\\mathrm{s}$,\n  - Number of points $N = 65536$,\n  - Dwell time $\\Delta t = 0.000050\\,\\mathrm{s}$.\n- Case $2$ (boundary: coalesced lines):\n  - Chemical shift $\\delta = 7.000\\,\\mathrm{ppm}$,\n  - Scalar coupling $J = 0.000\\,\\mathrm{Hz}$,\n  - Spectrometer frequency $\\nu_0 = 500\\,\\mathrm{MHz}$,\n  - Apparent transverse relaxation $T_2^\\ast = 1.000\\,\\mathrm{s}$,\n  - Number of points $N = 65536$,\n  - Dwell time $\\Delta t = 0.000050\\,\\mathrm{s}$.\n- Case $3$ (edge: small splitting on higher field):\n  - Chemical shift $\\delta = 6.800\\,\\mathrm{ppm}$,\n  - Scalar coupling $J = 1.000\\,\\mathrm{Hz}$,\n  - Spectrometer frequency $\\nu_0 = 600\\,\\mathrm{MHz}$,\n  - Apparent transverse relaxation $T_2^\\ast = 0.300\\,\\mathrm{s}$,\n  - Number of points $N = 65536$,\n  - Dwell time $\\Delta t = 0.000050\\,\\mathrm{s}$.\n\nRequired final output format:\n\n- Your program should produce a single line of output containing the concatenated predicted peak positions (in $\\mathrm{Hz}$) for all test cases, sorted within each case from lowest to highest frequency, rounded to three decimal places, as a comma-separated list enclosed in square brackets. For example, the format is $[\\text{case}_1\\_\\nu_1,\\text{case}_1\\_\\nu_2,\\text{case}_1\\_\\nu_3,\\text{case}_2\\_\\nu_1,\\dots]$.", "solution": "The problem statement has been meticulously validated and is determined to be valid. It is scientifically grounded in the principles of Nuclear Magnetic Resonance (NMR) spectroscopy, specifically using the Bloch equations and first-order spin coupling rules. The problem is well-posed, providing all necessary parameters and a clear, objective set of tasks. The provided values are physically realistic and computationally feasible. Therefore, a complete solution will be presented.\n\nThe primary task is to formalize the construction of a Free Induction Decay (FID) signal for a first-order aromatic proton triplet and predict its spectral peak positions.\n\n**1. Theoretical Derivation of the FID Signal**\n\nThe foundation of pulsed Fourier Transform (FT) NMR is the time-domain response of nuclear spins to a radio-frequency pulse, which can be described by the Bloch equations. In the rotating frame of reference, which precesses at the transmitter frequency, the transverse magnetization $M_{xy}(t) = M_x(t) + \\mathrm{i} M_y(t)$ for a single group of equivalent spins (an isochromat) with an angular frequency offset $\\omega$ evolves according to the equation provided:\n$$\nM_{xy}(t) = M_{xy}(0)\\,\\mathrm{e}^{-t/T_2^\\ast}\\,\\mathrm{e}^{\\mathrm{i}\\,\\omega t} \\quad \\text{for } t \\ge 0\n$$\nHere, $M_{xy}(0)$ is the complex transverse magnetization immediately after the excitation pulse, and $T_2^\\ast$ is the apparent transverse relaxation time constant, which accounts for both intrinsic spin-spin relaxation ($T_2$) and magnetic field inhomogeneity effects. The term $\\mathrm{e}^{\\mathrm{i}\\,\\omega t}$ describes the precession of the magnetization vector in the rotating frame due to its frequency offset, and $\\mathrm{e}^{-t/T_2^\\ast}$ describes the decay of this signal.\n\nThe problem specifies a spin system consisting of a single proton coupled to two equivalent neighboring spin-$\\tfrac{1}{2}$ protons. In the weak-coupling (first-order) limit, this scalar coupling, characterized by the coupling constant $J$ (in $\\mathrm{Hz}$), splits the resonance of the observed proton into a multiplet. According to the $n+1$ rule, for $n=2$ equivalent neighbors, the signal is a triplet. This means there are three distinct allowed transitions, resulting in three groups of isochromats with different resonance frequencies.\n\nThe principle of linear superposition states that the total detected signal is the sum of the signals from each of these non-interacting groups. Let the three transition frequencies in the rotating frame be $\\nu_1$, $\\nu_2$, and $\\nu_3$ (in $\\mathrm{Hz}$). The corresponding angular frequencies are $\\omega_k = 2\\pi\\nu_k$. The total complex FID signal, $S_{complex}(t)$, is:\n$$\nS_{complex}(t) = \\sum_{k=1}^{3} M_{xy,k}(0)\\,\\mathrm{e}^{-t/T_2^\\ast}\\,\\mathrm{e}^{\\mathrm{i}\\,2\\pi\\nu_k t}\n$$\nIt is a good approximation to assume a common $T_2^\\ast$ for all lines within a multiplet.\n\nThe problem provides the specific frequencies and intensities for a first-order triplet:\n- **Frequencies**: The three lines are centered at the chemical shift offset frequency, $\\nu_{\\text{cs}}$, and are separated by the coupling constant $J$. The frequencies are:\n  $$\n  \\nu_1 = \\nu_{\\text{cs}} - J, \\quad \\nu_2 = \\nu_{\\text{cs}}, \\quad \\nu_3 = \\nu_{\\text{cs}} + J\n  $$\n  The chemical shift offset $\\nu_{\\text{cs}}$ is related to the chemical shift $\\delta$ (in ppm) and the spectrometer's Larmor frequency $\\nu_0$ (in Hz) by $\\nu_{\\text{cs}} = \\delta \\times \\nu_0 \\times 10^{-6}$.\n- **Intensities**: The relative intensities (and thus the spectral peak areas) follow the pattern of Pascal's triangle for $n=2$, which gives the binomial coefficients $\\binom{2}{0}, \\binom{2}{1}, \\binom{2}{2}$, resulting in a ratio of $1:2:1$. The initial magnetization for each component, $M_{xy,k}(0)$, is proportional to these intensities.\n\nWe can write $M_{xy,k}(0) = C \\cdot A_k \\cdot \\mathrm{e}^{\\mathrm{i}\\phi}$, where $A_k = [1, 2, 1]$ are the relative amplitudes, $C$ is a real-valued global amplitude factor, and $\\phi$ is the initial phase of the signal. The problem specifies that $\\phi = 0$. Therefore, $M_{xy,k}(0)$ can be taken as real and proportional to $A_k$. We can set the proportionality constant to $1$ without loss of generality, as it only scales the overall signal. The complex FID is then:\n$$\nS_{complex}(t) = \\mathrm{e}^{-t/T_2^\\ast} \\left( 1 \\cdot \\mathrm{e}^{\\mathrm{i}\\,2\\pi(\\nu_{\\text{cs}}-J)t} + 2 \\cdot \\mathrm{e}^{\\mathrm{i}\\,2\\pi\\nu_{\\text{cs}}t} + 1 \\cdot \\mathrm{e}^{\\mathrm{i}\\,2\\pi(\\nu_{\\text{cs}}+J)t} \\right)\n$$\nIn a standard NMR experiment, the hardware detects a single phase of the signal, which corresponds to taking the real part (or imaginary part, depending on the phase correction) of the complex signal. The real-valued FID, $s(t)$, is:\n$$\ns(t) = \\mathrm{Re}[S_{complex}(t)] = \\mathrm{e}^{-t/T_2^\\ast} \\cdot \\mathrm{Re}\\left[ \\sum_{k=1}^{3} A_k \\mathrm{e}^{\\mathrm{i}\\,2\\pi\\nu_k t} \\right]\n$$\nUsing Euler's identity, $\\mathrm{Re}[\\mathrm{e}^{\\mathrm{i}\\theta}] = \\cos(\\theta)$, we arrive at the analytical form given in the problem statement:\n$$\ns(t) = \\mathrm{e}^{-t/T_2^\\ast} \\sum_{k=1}^{3} A_k \\cos(2\\pi\\nu_k t)\n$$\nwhere $A_1=1, A_2=2, A_3=1$, and the frequencies $\\nu_k$ are $\\nu_{\\text{cs}}-J, \\nu_{\\text{cs}}, \\nu_{\\text{cs}}+J$. This confirms the theoretical basis of the required signal construction.\n\n**2. Frequency Domain Spectrum and Algorithmic Strategy**\n\nThe frequency-domain spectrum, $S(\\nu)$, is obtained by applying the Fourier Transform (FT) to the time-domain signal $s(t)$. The FT of an exponentially decaying cosine, $A_k \\mathrm{e}^{-t/T_2^\\ast} \\cos(2\\pi\\nu_k t)$, yields a pair of Lorentzian functions centered at frequencies $\\pm\\nu_k$. For the sum of three such terms, the magnitude spectrum $|\\!S(\\nu)\\!|$ will exhibit three distinct peaks at the positive frequencies $\\nu_1, \\nu_2, \\nu_3$, with peak heights that are approximately proportional to the amplitudes $A_k$. The problem asks for these analytical peak positions.\n\nThe computational procedure for each test case is as follows:\n1.  **Calculate Analytical Peak Positions**:\n    - The spectrometer frequency $\\nu_0$ is calculated from the given value in $\\mathrm{MHz}$.\n    - The chemical shift offset frequency $\\nu_{\\text{cs}}$ is computed using the formula $\\nu_{\\text{cs}} = \\delta \\times \\nu_0 \\times 10^{-6}$.\n    - The three transition frequencies, $\\nu_k$, are calculated as $\\nu_{\\text{cs}}-J$, $\\nu_{\\text{cs}}$, and $\\nu_{\\text{cs}}+J$. These are the required output values.\n2.  **Internal Verification via Numerical Simulation**:\n    - A discrete time axis $t_n = n \\Delta t$ is generated for $n = 0, \\dots, N-1$.\n    - The analytical FID signal $s(t_n)$ is generated using the derived formula, the calculated frequencies $\\nu_k$, the given amplitudes $A_k = [1,2,1]$, and the relaxation time $T_2^\\ast$.\n    - The Discrete Fourier Transform (DFT) of the numerical FID $s(t_n)$ is computed using a standard FFT algorithm. This step serves to verify that the derived model and parameters correctly produce a spectrum with peaks at the analytically predicted frequencies.\n3.  **Format Output**: The analytically calculated peak positions for all test cases are collected, sorted within each case, rounded to three decimal places, and formatted into a single string as specified.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.fft import fft\n\ndef solve():\n    \"\"\"\n    Calculates the analytical peak positions for a first-order NMR triplet,\n    and internally verifies the result by simulating the FID and its FFT.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: happy path\n        {\n            \"delta\": 7.250,      # ppm\n            \"J\": 7.200,          # Hz\n            \"nu0_MHz\": 400.0,    # MHz\n            \"T2_star\": 0.500,    # s\n            \"N\": 65536,\n            \"dt\": 0.000050,      # s\n        },\n        # Case 2: boundary: coalesced lines\n        {\n            \"delta\": 7.000,\n            \"J\": 0.000,\n            \"nu0_MHz\": 500.0,\n            \"T2_star\": 1.000,\n            \"N\": 65536,\n            \"dt\": 0.000050,\n        },\n        # Case 3: edge: small splitting on higher field\n        {\n            \"delta\": 6.800,\n            \"J\": 1.000,\n            \"nu0_MHz\": 600.0,\n            \"T2_star\": 0.300,\n            \"N\": 65536,\n            \"dt\": 0.000050,\n        },\n    ]\n\n    all_peak_positions = []\n    \n    # Amplitudes for a triplet are based on binomial coefficients (1:2:1)\n    amplitudes = np.array([1.0, 2.0, 1.0])\n\n    for case in test_cases:\n        # Unpack parameters for the current case\n        delta = case[\"delta\"]\n        J = case[\"J\"]\n        nu0_MHz = case[\"nu0_MHz\"]\n        T2_star = case[\"T2_star\"]\n        N = case[\"N\"]\n        dt = case[\"dt\"]\n\n        # 1. Calculate analytical peak positions\n        # Convert spectrometer frequency from MHz to Hz\n        nu0 = nu0_MHz * 1e6\n        # Calculate chemical shift offset frequency in Hz\n        nu_cs = delta * nu0 * 1e-6\n\n        # Calculate the three transition frequencies for the triplet\n        nu1 = nu_cs - J\n        nu2 = nu_cs\n        nu3 = nu_cs + J\n        \n        # Store the analytically calculated frequencies\n        frequencies = np.array([nu1, nu2, nu3])\n        \n        # Add the sorted list of frequencies to the final results\n        all_peak_positions.extend(sorted(frequencies))\n\n        # 2. Internal verification: Construct FID and compute FFT\n        # This part is required by the problem for consistency check, but its\n        # results are not part of the final printed output.\n        \n        # Create the time axis for the discrete signal\n        t = np.arange(N) * dt\n        \n        # Construct the FID signal using broadcasting for efficiency\n        # s(t) = exp(-t/T2*) * sum_k(A_k * cos(2*pi*nu_k*t))\n        # shape of frequencies: (3,); shape of t: (N,)\n        # shape of frequencies[:, np.newaxis]: (3,1); shape of t: (N,) -> broadcasting to (3,N)\n        cos_waves = np.cos(2 * np.pi * frequencies[:, np.newaxis] * t)\n        \n        # Perform weighted sum of the cosine waves\n        # np.dot with shapes (3,) and (3,N) results in shape (N,)\n        weighted_sum_cos = np.dot(amplitudes, cos_waves)\n        \n        # Apply the exponential decay\n        fid = np.exp(-t / T2_star) * weighted_sum_cos\n        \n        # Compute the Discrete Fourier Transform. This is for verification as per instructions.\n        # The result 'spectrum' is not used further, but its computation is mandatory.\n        spectrum = fft(fid)\n\n    # Final print statement in the exact required format.\n    # Format each peak position to three decimal places.\n    formatted_results = [f\"{peak:.3f}\" for peak in all_peak_positions]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3720138"}]}