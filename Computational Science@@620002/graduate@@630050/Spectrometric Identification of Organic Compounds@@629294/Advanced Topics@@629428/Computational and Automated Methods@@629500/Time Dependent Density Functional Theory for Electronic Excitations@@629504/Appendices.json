{"hands_on_practices": [{"introduction": "Predicting how a molecule's color changes in different solvents, a phenomenon known as solvatochromism, is a critical application of computational chemistry. This practice guides you through deriving and implementing a model that combines TDDFT with the Polarizable Continuum Model (PCM) to calculate these solvent-induced shifts in excitation energies [@problem_id:3727847]. By mastering this technique, you will gain hands-on experience in modeling the complex interplay between a quantum mechanical solute and its classical dielectric environment.", "problem": "You are asked to construct a principled quantitative model, derive the governing expressions, and implement an algorithm to evaluate solvent stabilization of a charge-transfer excitation energy for a push-pull organic dye, as relevant to Ultra-Violet Visible (UV-Vis) spectrometric identification. The modeling framework is the combination of Time-Dependent Density Functional Theory (TDDFT) and the Polarizable Continuum Model (PCM) under vertical (non-equilibrium) excitation conditions. Your task is to start from a valid foundational base and produce a computational method that yields solvent-dependent excitation energy shifts.\n\nBegin from the following well-tested foundational bases and core definitions:\n- Linear-response Time-Dependent Density Functional Theory (TDDFT): electronic excitation energies in vacuum are obtained from the linear response of the electron density to time-dependent perturbations, with excitation energies defined as eigenvalues of the response kernel in the adiabatic approximation.\n- Continuum electrostatics for a dipole in a dielectric: a molecular dipole embedded in a spherical cavity of radius $R$ within a homogeneous, isotropic dielectric medium experiences a reaction field that is linearly proportional to the dipole moment, with coefficients determined by the medium's dielectric properties and boundary conditions from Maxwell’s equations for linear dielectrics.\n- Non-equilibrium solvation concept under vertical excitation: upon a sudden electronic excitation, only the solvent's fast electronic polarization (characterized by the optical dielectric constant) responds instantaneously; slower nuclear-orientational polarization remains frozen on the timescale of the transition.\n\nWithin this framework, define a push-pull dye that undergoes a charge-transfer (CT) excitation from a ground state $g$ to an excited state $e$. The TDDFT vacuum excitation energy $E_0$ is provided. The dye’s dipole moments in the ground and excited states, $\\mu_g$ and $\\mu_e$, are modeled as colinear and are given. The solvent is represented by a Polarizable Continuum Model (PCM) spherical cavity of radius $R$.\n\nDerive a physically consistent expression, based on the above principles, for the solvent stabilization energy shift $\\Delta E$ of the vertical excitation, expressed in electronvolts (eV), as a function of:\n- The ground- and excited-state dipole moments $\\mu_g$ and $\\mu_e$ (expressed in Debye),\n- The cavity radius $R$ (expressed in angstroms),\n- The solvent’s static dielectric constant $\\varepsilon_s$ and optical dielectric constant $\\varepsilon_\\infty$ (with $\\varepsilon_\\infty = n^2$ where $n$ is the refractive index at optical frequencies),\n- The vacuum permittivity $\\varepsilon_0$.\n\nYour derivation must:\n- Clearly identify which polarization components contribute instantaneously and which remain frozen at the moment of excitation.\n- Justify the energy accounting for fast and slow polarization components and produce a final expression for the vertical excitation energy shift $\\Delta E$ relative to vacuum.\n- Specify unit conversions that ensure $\\Delta E$ is computed in eV when $\\mu$ is given in Debye and $R$ in angstroms.\n\nAlgorithmic implementation requirements:\n- Implement the derived expression to compute $\\Delta E$ for a set of solvents with varying polarity.\n- Compute the solvent-dependent excitation energy $E = E_0 + \\Delta E$ for each solvent.\n\nTest suite and parameters:\nUse the following set of four dye cases and five solvents. For each dye case, compute the solvent stabilization $\\Delta E$ and the solvent-shifted excitation energy $E$ across all five solvents.\n\nDye cases (all excitation energies $E_0$ in eV, dipole moments in Debye, cavity radii in angstroms):\n1. $E_0 = 2.40$, $\\mu_g = 5.0$, $\\mu_e = 18.0$, $R = 6.0$.\n2. $E_0 = 3.10$, $\\mu_g = 4.0$, $\\mu_e = 10.0$, $R = 5.0$.\n3. $E_0 = 2.80$, $\\mu_g = 8.0$, $\\mu_e = 8.0$, $R = 6.0$.\n4. $E_0 = 2.10$, $\\mu_g = 3.0$, $\\mu_e = 22.0$, $R = 4.5$.\n\nSolvents (static dielectric $\\varepsilon_s$ dimensionless, refractive index $n$ dimensionless; the optical dielectric is $\\varepsilon_\\infty = n^2$):\n- n-Hexane: $\\varepsilon_s = 1.89$, $n = 1.375$.\n- Toluene: $\\varepsilon_s = 2.38$, $n = 1.496$.\n- Dichloromethane: $\\varepsilon_s = 8.93$, $n = 1.424$.\n- Acetonitrile: $\\varepsilon_s = 35.94$, $n = 1.344$.\n- Water: $\\varepsilon_s = 78.30$, $n = 1.333$.\n\nConstants and unit conversions to use:\n- Vacuum permittivity: $\\varepsilon_0 = 8.854187817 \\times 10^{-12}\\ \\mathrm{F/m}$.\n- Debye to Coulomb meter: $1\\ \\mathrm{D} = 3.33564 \\times 10^{-30}\\ \\mathrm{C \\cdot m}$.\n- Angstrom to meter: $1\\ \\mathrm{\\AA} = 1.0 \\times 10^{-10}\\ \\mathrm{m}$.\n- Joule to electronvolt: $1\\ \\mathrm{eV} = 1.602176634 \\times 10^{-19}\\ \\mathrm{J}$.\n\nFinal output specification:\n- For each dye case, return a list containing two lists: the first is the solvent stabilization values $\\Delta E$ in eV for the five solvents, and the second is the corresponding solvent-shifted excitation energies $E$ in eV for the five solvents.\n- Round every floating-point result to six decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where the overall structure is a list of per-case results: for case $i$ the element is $[\\,[\\Delta E_1,\\Delta E_2,\\Delta E_3,\\Delta E_4,\\Delta E_5],\\,[E_1,E_2,E_3,E_4,E_5]\\,]$; the top-level output is $[\\,\\text{case}_1,\\text{case}_2,\\text{case}_3,\\text{case}_4\\,]$ and must be printed on one line. All energies must be reported in eV.\n\nEdge cases to be covered by the test suite:\n- Case 3 has $\\mu_e = \\mu_g$ and should yield $\\Delta E = 0$ for all solvents.\n- Case 4 has a small cavity radius and a large dipole change, testing enhanced stabilization.\n- The set of solvents covers a range of low to high static dielectric constants, testing sensitivity to polarity.\n\nNo angles are involved in this task. Express all energies in eV. The solution must be implemented as a complete, runnable program that adheres to the given runtime environment.", "solution": "The problem statement has been critically evaluated and is determined to be valid. It is scientifically grounded in established principles of computational chemistry, specifically time-dependent density functional theory (TDDFT) and the polarizable continuum model (PCM). The problem is well-posed, objective, self-contained, and provides all necessary data and constants for a unique and meaningful solution. The underlying physical model is a standard and verifiable approach for calculating solvatochromic shifts in electronic spectra.\n\nThe task is to derive an expression for the solvent-induced shift, $\\Delta E$, of a vertical electronic excitation energy and to implement a program to compute this shift for several test cases. The derivation will be based on continuum electrostatics within the framework of non-equilibrium solvation.\n\n**1. Theoretical Framework**\n\nThe model treats the solute (a dye molecule) as a point dipole located at the center of a spherical cavity of radius $R$. The solvent is a continuous, homogeneous, and isotropic dielectric medium characterized by its static dielectric constant, $\\varepsilon_s$, and its optical dielectric constant, $\\varepsilon_\\infty$. The optical dielectric constant is related to the solvent's refractive index, $n$, by $\\varepsilon_\\infty = n^2$.\n\nThe interaction energy between a dipole $\\vec{\\mu}$ and the reaction field $\\vec{\\mathcal{R}}$ it induces in the surrounding dielectric gives rise to the solvation energy. For a spherical cavity, the Onsager reaction field is given by:\n$$\n\\vec{\\mathcal{R}}(\\vec{\\mu}) = \\frac{2}{4\\pi\\varepsilon_0 R^3} \\left( \\frac{\\varepsilon - 1}{2\\varepsilon + 1} \\right) \\vec{\\mu}\n$$\nwhere $\\varepsilon$ is the dielectric constant of the medium. We define the dielectric function $f(\\varepsilon)$ as:\n$$\nf(\\varepsilon) = \\frac{\\varepsilon - 1}{2\\varepsilon + 1}\n$$\nThe total free energy of solvation, which includes the work done polarizing the medium, is $G_{solv} = -\\frac{1}{2} \\vec{\\mu} \\cdot \\vec{\\mathcal{R}}(\\vec{\\mu})$. Since the ground and excited state dipoles, $\\vec{\\mu}_g$ and $\\vec{\\mu}_e$, are stated to be colinear, we can use their scalar magnitudes $\\mu_g$ and $\\mu_e$. The equilibrium solvation energy of a state with dipole $\\mu$ is:\n$$\nG_{solv}^{eq}(\\mu) = -\\frac{1}{4\\pi\\varepsilon_0 R^3} f(\\varepsilon_s) \\mu^2\n$$\n\n**2. Non-Equilibrium Solvation for Vertical Excitation**\n\nA vertical electronic excitation is an essentially instantaneous process (on the order of femtoseconds). The solvent's response is partitioned into two components:\n- **Fast polarization**: The electronic polarization of the solvent, which responds instantaneously to the change in the solute's electron density. This response is governed by $\\varepsilon_\\infty$.\n- **Slow polarization**: The orientational and nuclear polarization of the solvent, which is too slow to change during the electronic transition. It remains \"frozen\" in the configuration corresponding to the initial (ground) state.\n\nWe can partition the reaction field and solvation energy into fast and slow components. The fast component is associated with the dielectric function $f(\\varepsilon_\\infty)$, and the slow component is associated with the difference $\\Delta f = f(\\varepsilon_s) - f(\\varepsilon_\\infty)$.\n\n**3. Derivation of the Excitation Energy Shift $\\Delta E$**\n\nThe total energy of the solute-solvent system in the ground state ($g$) and the non-equilibrium excited state ($e$) determines the excitation energy in solution.\n\n**Ground State Energy ($U_g$)**: The system is in full equilibrium. The solvent is fully polarized in response to the ground state dipole $\\mu_g$. The total energy is the sum of the vacuum energy, $E_g^{vac}$, and the equilibrium solvation free energy, $G_{solv}^{eq}(\\mu_g)$.\n$$\nU_g = E_g^{vac} + G_{solv}^{eq}(\\mu_g) = E_g^{vac} - \\frac{\\mu_g^2}{4\\pi\\varepsilon_0 R^3} f(\\varepsilon_s)\n$$\n\n**Non-Equilibrium Excited State Energy ($U_e$)**: Immediately following the vertical transition, the solute has the excited state dipole $\\mu_e$. The fast component of the solvent polarization has equilibrated to $\\mu_e$, but the slow component is still polarized according to the ground state dipole $\\mu_g$. The total energy, $U_e$, is the sum of the vacuum energy of the excited state, $E_e^{vac}$, and the non-equilibrium solvation free energy, $G_{solv}^{neq}(e)$. $G_{solv}^{neq}(e)$ is composed of three terms:\n1. The equilibrium free energy of the fast polarization responding to $\\mu_e$: $G_{fast,eq}(\\mu_e) = -\\frac{1}{2} \\mu_e \\mathcal{R}_{fast}(\\mu_e) = -\\frac{\\mu_e^2}{4\\pi\\varepsilon_0 R^3} f(\\varepsilon_\\infty)$.\n2. The interaction energy of the dipole $\\mu_e$ with the slow component of the reaction field, which is frozen in equilibrium with $\\mu_g$: $V_{int} = -\\mu_e \\mathcal{R}_{slow}(\\mu_g) = -\\frac{2\\mu_e\\mu_g}{4\\pi\\varepsilon_0 R^3} \\Delta f$.\n3. The self-energy (reorganization energy) of the slow polarization field, which is still that for $\\mu_g$: $G_{slow,reorg} = \\frac{1}{2} \\mu_g \\mathcal{R}_{slow}(\\mu_g) = \\frac{\\mu_g^2}{4\\pi\\varepsilon_0 R^3} \\Delta f$.\n\nSumming these contributions gives the non-equilibrium solvation energy:\n$$\nG_{solv}^{neq}(e) = -\\frac{1}{4\\pi\\varepsilon_0 R^3} \\left[ f(\\varepsilon_\\infty)\\mu_e^2 + 2\\mu_e\\mu_g\\Delta f - \\mu_g^2\\Delta f \\right]\n$$\nThe total energy of the non-equilibrium excited state is:\n$$\nU_e = E_e^{vac} + G_{solv}^{neq}(e)\n$$\nThe excitation energy in solution, $E$, is the difference between these total energies:\n$$\nE = U_e - U_g = (E_e^{vac} - E_g^{vac}) + (G_{solv}^{neq}(e) - G_{solv}^{eq}(\\mu_g))\n$$\nThe vacuum excitation energy is $E_0 = E_e^{vac} - E_g^{vac}$. The shift, $\\Delta E$, is therefore:\n$$\n\\Delta E = E - E_0 = G_{solv}^{neq}(e) - G_{solv}^{eq}(\\mu_g)\n$$\nSubstituting the derived expressions:\n$$\n\\Delta E = -\\frac{1}{4\\pi\\varepsilon_0 R^3} \\left[ f(\\varepsilon_\\infty)\\mu_e^2 + 2\\mu_e\\mu_g\\Delta f - \\mu_g^2\\Delta f \\right] - \\left( -\\frac{\\mu_g^2}{4\\pi\\varepsilon_0 R^3} f(\\varepsilon_s) \\right)\n$$\nUsing $f(\\varepsilon_s) = f(\\varepsilon_\\infty) + \\Delta f$:\n$$\n\\Delta E = \\frac{1}{4\\pi\\varepsilon_0 R^3} \\left[ -f(\\varepsilon_\\infty)\\mu_e^2 - 2\\mu_e\\mu_g\\Delta f + \\mu_g^2\\Delta f + \\mu_g^2(f(\\varepsilon_\\infty) + \\Delta f) \\right]\n$$\n$$\n\\Delta E = \\frac{1}{4\\pi\\varepsilon_0 R^3} \\left[ -f(\\varepsilon_\\infty)\\mu_e^2 - 2\\mu_e\\mu_g\\Delta f + 2\\mu_g^2\\Delta f + \\mu_g^2 f(\\varepsilon_\\infty) \\right]\n$$\n$$\n\\Delta E = -\\frac{1}{4\\pi\\varepsilon_0 R^3} \\left[ f(\\varepsilon_\\infty)(\\mu_e^2 - \\mu_g^2) + 2\\Delta f (\\mu_e\\mu_g - \\mu_g^2) \\right]\n$$\nThis simplifies to the final, physically transparent expression:\n$$\n\\Delta E = - \\frac{1}{4\\pi\\varepsilon_0 R^3} \\left[ f(\\varepsilon_\\infty)(\\mu_e^2 - \\mu_g^2) + \\left(f(\\varepsilon_s) - f(\\varepsilon_\\infty)\\right) \\cdot 2\\mu_g(\\mu_e - \\mu_g) \\right]\n$$\n\n**4. Unit Conversion and Implementation**\n\nTo implement this formula, we need a conversion factor to compute $\\Delta E$ in electronvolts (eV) when dipoles $\\mu$ are given in Debye (D) and radius $R$ is in angstroms ($\\mathrm{\\AA}$). The energy scales as $\\mu^2/R^3$. We calculate the prefactor, $C_{\\text{factor}}$, for converting from the atomic unit system of $(\\mathrm{D}^2/\\mathrm{\\AA}^3)$ to $\\mathrm{eV}$.\n\nThe term $\\frac{1}{4\\pi\\varepsilon_0}$ in SI units is approximately $8.98755 \\times 10^9 \\ \\mathrm{N \\cdot m^2 \\cdot C^{-2}}$. The full prefactor in Joules is:\n$$\n\\frac{(1\\ \\mathrm{D})^2}{(1\\ \\mathrm{\\AA})^3} \\frac{1}{4\\pi\\varepsilon_0} = \\frac{(3.33564 \\times 10^{-30}\\ \\mathrm{C \\cdot m})^2}{(1.0 \\times 10^{-10}\\ \\mathrm{m})^3} \\frac{1}{4\\pi (8.854187817 \\times 10^{-12}\\ \\mathrm{F/m})}\n$$\nThis calculation yields $0.999999 \\times 10^{-19}\\ \\mathrm{J}$. Converting Joules to electronvolts:\n$$\nC_{\\text{factor}} = \\frac{0.999999 \\times 10^{-19}\\ \\mathrm{J}}{1.602176634 \\times 10^{-19}\\ \\mathrm{J/eV}} \\approx 0.6241509\\ \\mathrm{eV \\cdot \\AA^3 \\cdot D^{-2}}\n$$\nThe final computable expression for $\\Delta E$ in $\\mathrm{eV}$ is:\n$$\n\\Delta E = -C_{\\text{factor}} \\frac{1}{R^3} \\left[ f(\\varepsilon_\\infty)(\\mu_e^2 - \\mu_g^2) + \\left(f(\\varepsilon_s) - f(\\varepsilon_\\infty)\\right) \\cdot 2\\mu_g(\\mu_e - \\mu_g) \\right]\n$$\nwhere $\\mu_g, \\mu_e$ are in Debye and $R$ is in Angstroms. The algorithm will apply this formula to each dye-solvent pair, compute $\\Delta E$, and subsequently the solvent-shifted excitation energy $E = E_0 + \\Delta E$.", "answer": "```python\nimport numpy as np\nimport json\n\ndef solve():\n    \"\"\"\n    Calculates the solvent stabilization energy shift for charge-transfer excitations\n    based on the non-equilibrium Polarizable Continuum Model (PCM).\n    \"\"\"\n\n    # Constants and Unit Conversions\n    EPSILON_0 = 8.854187817e-12  # Vacuum permittivity in F/m\n    DEBYE_TO_CM = 3.33564e-30      # 1 Debye in Coulomb-meters\n    ANGSTROM_TO_M = 1.0e-10        # 1 Angstrom in meters\n    JOULE_TO_EV = 1.602176634e-19  # 1 eV in Joules\n\n    # Pre-calculate the conversion factor from D^2/A^3 to eV\n    # Factor = (1/(4*pi*eps0)) * (D_to_Cm^2 / A_to_m^3) / J_to_eV\n    joules_per_unit = (1 / (4 * np.pi * EPSILON_0)) * (DEBYE_TO_CM**2 / ANGSTROM_TO_M**3)\n    EV_FACTOR = joules_per_unit / JOULE_TO_EV\n    \n    # Test cases for dyes\n    # (E0 in eV, mu_g in Debye, mu_e in Debye, R in Angstroms)\n    dye_cases = [\n        (2.40, 5.0, 18.0, 6.0),\n        (3.10, 4.0, 10.0, 5.0),\n        (2.80, 8.0, 8.0, 6.0),\n        (2.10, 3.0, 22.0, 4.5),\n    ]\n\n    # Solvent parameters\n    # (name, static dielectric eps_s, refractive index n)\n    solvents = [\n        ('n-Hexane', 1.89, 1.375),\n        ('Toluene', 2.38, 1.496),\n        ('Dichloromethane', 8.93, 1.424),\n        ('Acetonitrile', 35.94, 1.344),\n        ('Water', 78.30, 1.333),\n    ]\n\n    def dielectric_func(epsilon):\n        \"\"\"Calculates the Onsager dielectric function f(epsilon).\"\"\"\n        if epsilon == -0.5:\n             # Avoid division by zero, though physically unlikely\n             return np.inf\n        return (epsilon - 1) / (2 * epsilon + 1)\n\n    all_results = []\n    \n    for case_params in dye_cases:\n        e0, mu_g, mu_e, R = case_params\n        \n        delta_e_list = []\n        final_e_list = []\n        \n        for solvent_params in solvents:\n            _, eps_s, n = solvent_params\n            \n            eps_inf = n**2\n            \n            f_eps_s = dielectric_func(eps_s)\n            f_eps_inf = dielectric_func(eps_inf)\n            \n            # The derived expression for the energy shift in eV\n            # Delta_E = -C_factor * (1/R^3) * [f(eps_inf)*(mu_e^2 - mu_g^2) + (f(eps_s) - f(eps_inf))*2*mu_g*(mu_e - mu_g)]\n            \n            term1 = f_eps_inf * (mu_e**2 - mu_g**2)\n            term2 = (f_eps_s - f_eps_inf) * 2 * mu_g * (mu_e - mu_g)\n            \n            delta_e = -EV_FACTOR * (1 / R**3) * (term1 + term2)\n            final_e = e0 + delta_e\n            \n            delta_e_list.append(round(delta_e, 6))\n            final_e_list.append(round(final_e, 6))\n            \n        all_results.append([delta_e_list, final_e_list])\n\n    # Custom JSON-like string formatting to match the output specification exactly.\n    # json.dumps adds spaces which might not be desired. This gives full control.\n    def format_list(lst):\n        if isinstance(lst, list):\n            return f\"[{','.join(map(format_list, lst))}]\"\n        return str(lst)\n\n    print(format_list(all_results))\n\nsolve()\n\n```", "id": "3727847"}, {"introduction": "While TDDFT provides the energies of electronic transitions, real absorption spectra exhibit a rich fine structure due to simultaneous vibrational excitations. This exercise will teach you how to construct a full vibronic spectrum from parameters obtained in a TDDFT calculation, such as vibrational frequencies and geometric displacements upon excitation [@problem_id:3727865]. Applying the Franck-Condon principle within the harmonic approximation, you will simulate the spectral lineshape, including temperature effects, bridging the gap between a simple stick spectrum and an experimentally observable profile.", "problem": "You are tasked with constructing a computational pipeline to assemble a vibronic absorption spectrum for an organic chromophore using the harmonic approximation with parallel normal modes based on parameters derivable from Time Dependent Density Functional Theory (TDDFT) gradients. You must formalize the mathematics and implement a program that, given a set of vibrational mode frequencies and dimensionless displacements encoded as Huang–Rhys factors, computes Franck–Condon factors, assembles a stick spectrum with thermal initial-state populations, and produces a Gaussian-broadened spectrum. You must then report a small set of summary quantities for each test case.\n\nYour derivation must start from the following fundamental bases:\n- The harmonic oscillator Hamiltonian for each normal mode in the ground and excited electronic states. The harmonic energy levels are $E_{n} = \\hbar \\omega \\left(n + \\tfrac{1}{2}\\right)$ for $n \\in \\{0,1,2,\\dots\\}$.\n- Under the parallel-mode approximation (negligible Duschinsky rotation), the normal mode coordinates of the excited state are displaced relative to those of the ground state by a dimensionless displacement along each mode encoded by the Huang–Rhys factor $S_k \\ge 0$, where $k$ indexes modes.\n- The Franck–Condon factor is the squared modulus of the vibrational overlap between initial and final number states along each mode, multiplied across modes when modes are independent and harmonic.\n- The canonical Boltzmann distribution for initial vibrational occupation in the ground electronic state at temperature $T$ in kelvin: for a single mode $k$, the probability of occupying quantum number $m_k$ is $p_{k}(m_k) = (1 - q_k)\\, q_k^{m_k}$ with $q_k = \\exp(-\\beta \\hbar \\omega_k)$ and $\\beta = 1/(k_{\\mathrm{B}} T)$ where $k_{\\mathrm{B}}$ is the Boltzmann constant.\n- The photon energy for a vibronic absorption transition from an initial vibrational state $\\mathbf{m} = (m_1,\\dots,m_{N})$ in the ground electronic state to a final vibrational state $\\mathbf{n} = (n_1,\\dots,n_{N})$ in the excited electronic state is $E_{\\mathrm{ph}} = E_{00} + \\sum_{k=1}^{N} \\hbar \\omega_k \\left(n_k - m_k\\right)$ where $E_{00}$ is the adiabatic $0\\text{–}0$ electronic transition energy. All $\\omega_k$ are assumed identical between electronic states under the harmonic parallel-mode approximation.\n\nYou must implement the following requirements:\n- Use the independent-mode harmonic approximation with the parallel-mode assumption. Use the exact displaced harmonic oscillator overlaps for equal frequencies to compute the Franck–Condon factors for $m_k \\to n_k$ along each mode, and multiply across modes to obtain the total Franck–Condon factor for the multidimensional transition $(\\mathbf{m} \\to \\mathbf{n})$. Include thermal initial-state populations via the Boltzmann distribution and assemble the stick spectrum with intensities given by the thermally averaged Franck–Condon factors. Normalize the stick intensities so that their total sum equals $1$.\n- Apply Gaussian broadening to the stick spectrum to obtain a continuous vibronic profile on a specified energy grid. The Gaussian kernel for a stick at energy $E_i$ with unit area and width $\\sigma$ is $g(E;E_i,\\sigma) = \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\!\\left(-\\frac{(E-E_i)^2}{2\\sigma^2}\\right)$. Use $\\sigma$ in electronvolts as given in the test parameters.\n- Units and constants:\n  - Convert wavenumbers to energy using $1~\\mathrm{cm}^{-1} = 1/8065.544005~\\mathrm{eV}$, i.e., $\\hbar \\omega~[\\mathrm{eV}] = \\omega~[\\mathrm{cm}^{-1}] \\times (1/8065.544005)$.\n  - Use $k_{\\mathrm{B}} = 8.617333262145\\times 10^{-5}~\\mathrm{eV/K}$.\n  - All energies must be computed and handled in electronvolts, and all frequencies will be specified in $\\mathrm{cm}^{-1}$ and must be converted as above.\n- Truncation and grids:\n  - For each test case, enumerate all initial-state quantum numbers $m_k \\in \\{0,\\dots,m_{\\max}\\}$ and final-state quantum numbers $n_k \\in \\{0,\\dots,n_{\\max}\\}$ per mode and include all combinations in the stick spectrum, then renormalize the stick intensities to sum to $1$.\n  - Use the provided energy grid parameters $[E_{\\min}, E_{\\max}, \\Delta E]$ in electronvolts for the Gaussian-broadened spectrum.\n- Quantities to report for each test case:\n  1. The energy at which the broadened spectrum attains its maximum, $E_{\\max}$, in electronvolts, rounded to six decimal places.\n  2. The corresponding maximum intensity $I_{\\max}$ of the broadened spectrum, rounded to six decimal places.\n  3. The total $0\\text{–}0$ Franck–Condon factor $S_{00} = \\prod_{k=1}^{N} \\exp(-S_k)$, rounded to six decimal places.\n- Angle units do not apply. If any probability is requested, express it as a decimal number.\n- Numerical stability requirements: When $T = 0$ K, treat the Boltzmann factor so that only the ground vibrational state is populated.\n\nYour program must implement the above and use the following fixed test suite. For each test case, produce the triple $[E_{\\max}, I_{\\max}, S_{00}]$ and aggregate the results for all cases into a single Python-style list of lists. The final printout must be a single line containing that list.\n\nTest suite (each bullet gives one case):\n- Case 1 (edge case: no displacement):\n  - Number of modes $N = 1$.\n  - Ground-state and excited-state mode frequencies $\\boldsymbol{\\omega} = [1500]~\\mathrm{cm}^{-1}$.\n  - Huang–Rhys factors $\\mathbf{S} = [0.0]$.\n  - Adiabatic $0\\text{–}0$ energy $E_{00} = 3.000~\\mathrm{eV}$.\n  - Temperature $T = 0.0~\\mathrm{K}$.\n  - Gaussian width $\\sigma = 0.050~\\mathrm{eV}$.\n  - Truncation parameters $m_{\\max} = 0$, $n_{\\max} = 4$.\n  - Energy grid $[E_{\\min}, E_{\\max}, \\Delta E] = [2.5, 3.5, 0.002]~\\mathrm{eV}$.\n- Case 2 (single mode with moderate displacement):\n  - $N = 1$, $\\boldsymbol{\\omega} = [1400]~\\mathrm{cm}^{-1}$, $\\mathbf{S} = [1.0]$, $E_{00} = 2.500~\\mathrm{eV}$, $T = 0.0~\\mathrm{K}$, $\\sigma = 0.030~\\mathrm{eV}$, $m_{\\max} = 0$, $n_{\\max} = 6$, grid $[2.0, 3.0, 0.002]~\\mathrm{eV}$.\n- Case 3 (two modes with finite temperature):\n  - $N = 2$, $\\boldsymbol{\\omega} = [1200, 1600]~\\mathrm{cm}^{-1}$, $\\mathbf{S} = [0.5, 0.8]$, $E_{00} = 2.200~\\mathrm{eV}$, $T = 300.0~\\mathrm{K}$, $\\sigma = 0.040~\\mathrm{eV}$, $m_{\\max} = 2$, $n_{\\max} = 3$, grid $[1.8, 3.0, 0.002]~\\mathrm{eV}$.\n- Case 4 (low-frequency mode to probe hot-band contributions):\n  - $N = 1$, $\\boldsymbol{\\omega} = [200]~\\mathrm{cm}^{-1}$, $\\mathbf{S} = [0.3]$, $E_{00} = 1.800~\\mathrm{eV}$, $T = 300.0~\\mathrm{K}$, $\\sigma = 0.020~\\mathrm{eV}$, $m_{\\max} = 5$, $n_{\\max} = 6$, grid $[1.6, 2.2, 0.001]~\\mathrm{eV}$.\n- Case 5 (two modes, one with zero displacement):\n  - $N = 2$, $\\boldsymbol{\\omega} = [1000, 1800]~\\mathrm{cm}^{-1}$, $\\mathbf{S} = [0.0, 1.2]$, $E_{00} = 3.400~\\mathrm{eV}$, $T = 0.0~\\mathrm{K}$, $\\sigma = 0.050~\\mathrm{eV}$, $m_{\\max} = 0$, $n_{\\max} = 5$, grid $[2.8, 4.2, 0.002]~\\mathrm{eV}$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list of triples, enclosed in square brackets, for example, $[[E_{\\max}^{(1)},I_{\\max}^{(1)},S_{00}^{(1)}],\\dots]$. Each floating-point number must be rounded to six decimal places in the printed output.", "solution": "The problem requires the construction of a computational pipeline to simulate the vibronic absorption spectrum of a molecule based on the harmonic, parallel-mode approximation. The solution involves several steps: calculating Franck-Condon factors (FCFs) for individual vibrational transitions, weighting them by the thermal population of initial states, assembling a stick spectrum, and applying Gaussian broadening to obtain a continuous spectrum.\n\nFirst, we establish the theoretical framework. The model assumes that each vibrational mode $k$ is an independent harmonic oscillator. The potential energy surfaces of the ground and excited electronic states are assumed to be harmonic and parallel, meaning they have the same vibrational frequencies $\\omega_k$ but the excited state's potential minimum is displaced along the normal mode coordinates. This displacement is quantified by the dimensionless Huang-Rhys factor, $S_k \\ge 0$.\n\nThe intensity of a vibronic transition is governed by the Franck-Condon principle, which states that the transition probability is proportional to the square of the overlap integral between the initial and final vibrational wavefunctions. This squared overlap is the Franck-Condon factor (FCF). For a single mode $k$, the FCF for a transition from vibrational state $m_k$ to state $n_k$ is given by the exact formula for displaced harmonic oscillators with equal frequencies:\n$$\nFC_k(m_k \\to n_k) = e^{-S_k} \\frac{\\min(m_k, n_k)!}{\\max(m_k, n_k)!} S_k^{|n_k - m_k|} \\left[ L_{\\min(m_k, n_k)}^{|n_k - m_k|}(S_k) \\right]^2\n$$\nHere, $L_p^q(x)$ is the generalized Laguerre polynomial. This formula will be implemented using numerical libraries. For the special case where $S_k=0$, the FCF simplifies to the Kronecker delta, $\\delta_{m_k, n_k}$, as the harmonic oscillator wavefunctions form an orthonormal set.\n\nThe total FCF for a multi-mode transition from state $\\mathbf{m} = (m_1, \\dots, m_N)$ to $\\mathbf{n} = (n_1, \\dots, n_N)$ is the product of the individual mode FCFs, a consequence of the independent mode approximation:\n$$\nFC(\\mathbf{m} \\to \\mathbf{n}) = \\prod_{k=1}^{N} FC_k(m_k \\to n_k)\n$$\n\nAt a finite temperature $T$, the initial vibrational levels of the ground electronic state are populated according to the canonical Boltzmann distribution. The probability of mode $k$ being in state $m_k$ is:\n$$\np_k(m_k; T) = (1 - q_k) q_k^{m_k}\n$$\nwhere $q_k = \\exp(-\\hbar \\omega_k / (k_{\\mathrm{B}} T))$ and $k_{\\mathrm{B}}$ is the Boltzmann constant. For $T=0~\\mathrm{K}$, only the ground vibrational state ($m_k=0$) is populated, so $p_k(0) = 1$ and $p_k(m_k>0) = 0$. The total initial state population is $P(\\mathbf{m}; T) = \\prod_{k=1}^N p_k(m_k; T)$.\n\nThe intensity of a single vibronic transition (a \"stick\" in the spectrum) is proportional to the product of the initial state population and the total FCF:\n$$\nI_{\\mathbf{m} \\to \\mathbf{n}} \\propto P(\\mathbf{m}; T) \\times FC(\\mathbf{m} \\to \\mathbf{n})\n$$\nThe energy of this transition is given by:\n$$\nE_{\\mathbf{m} \\to \\mathbf{n}} = E_{00} + \\sum_{k=1}^{N} \\hbar \\omega_k (n_k - m_k)\n$$\nwhere $E_{00}$ is the adiabatic $0\\text{–}0$ electronic transition energy. All frequencies $\\omega_k$ are provided in wavenumbers ($\\mathrm{cm}^{-1}$) and must be converted to energy in electronvolts ($\\mathrm{eV}$) using the given conversion factor $1~\\mathrm{cm}^{-1} = 1/8065.544005~\\mathrm{eV}$.\n\nThe computational algorithm proceeds as follows:\n$1$.  For each test case, parse the input parameters: number of modes $N$, frequencies $\\boldsymbol{\\omega}$, Huang-Rhys factors $\\mathbf{S}$, $E_{00}$, temperature $T$, Gaussian broadening width $\\sigma$, and quantum number truncation limits $m_{\\max}$ and $n_{\\max}$.\n$2$.  Pre-compute constants, such as the wavenumber-to-eV conversion factor and the Boltzmann constant in $\\mathrm{eV/K}$.\n$3$.  For each mode $k$ from $1$ to $N$:\n    a. Convert $\\omega_k$ to $\\mathrm{eV}$.\n    b. Calculate and store the Boltzmann populations $p_k(m_k)$ for all $m_k \\in \\{0, \\dots, m_{\\max}\\}$.\n    c. Calculate and store the FCFs, $FC_k(m_k \\to n_k)$, in a $2$D array for all $m_k \\in \\{0, \\dots, m_{\\max}\\}$ and $n_k \\in \\{0, \\dots, n_{\\max}\\}$ using the Laguerre polynomial formula. This can be implemented efficiently using `scipy.special.genlaguerre` and `math.factorial`.\n$4$.  Generate all possible combinations of initial state quantum numbers $\\mathbf{m} = (m_1, \\dots, m_N)$ and final state quantum numbers $\\mathbf{n} = (n_1, \\dots, n_N)$ within the specified truncation limits.\n$5$.  Iterate through all these transitions $(\\mathbf{m} \\to \\mathbf{n})$. For each one, calculate the transition energy $E_{\\mathbf{m} \\to \\mathbf{n}}$ and the unnormalized intensity $I_{\\mathbf{m} \\to \\mathbf{n}}$. Store these as a list of (energy, intensity) pairs. To handle degenerate transitions, a dictionary mapping energy to total intensity is used to sum the intensities of transitions occurring at the same energy.\n$6$.  After calculating all stick intensities, normalize them such that their sum equals $1$. This accounts for the truncation of the vibrational basis sets.\n$7$.  Construct the broadened spectrum by convolving the normalized stick spectrum with a Gaussian kernel. For each stick at energy $E_i$ with normalized intensity $I_i$, its contribution to the final spectrum at an energy $E$ on a discrete grid is $I_i \\times g(E; E_i, \\sigma)$, where $g(E; E_i, \\sigma) = \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\!\\left(-\\frac{(E-E_i)^2}{2\\sigma^2}\\right)$. The final spectrum is the sum of these contributions over all sticks, evaluated on the specified energy grid $[E_{\\min}, E_{\\max}]$ with spacing $\\Delta E$.\n$8$.  From the final broadened spectrum, identify the maximum intensity $I_{\\max}$ and the corresponding energy $E_{\\max}$.\n$9$.  Calculate the total $0\\text{–}0$ Franck-Condon factor, which is the product of the individual mode $0\\to 0$ FCFs: $S_{00} = \\prod_{k=1}^N FC_k(0 \\to 0) = \\prod_{k=1}^N e^{-S_k} = \\exp(-\\sum_{k} S_k)$.\n$10$. Format the results $[E_{\\max}, I_{\\max}, S_{00}]$ for each test case as specified and aggregate them into a final list for output.\n\nThis procedure rigorously implements the physical model described in the problem statement, from first principles to a final numerical result, adhering to all specified constraints and formats.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import genlaguerre\nfrom math import exp, sqrt, pi, factorial\nfrom itertools import product\n\ndef solve():\n    \"\"\"\n    Main function to compute and print vibronic spectra simulation results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (edge case: no displacement)\n        (1, [1500], [0.0], 3.000, 0.0, 0.050, 0, 4, [2.5, 3.5, 0.002]),\n        # Case 2 (single mode with moderate displacement)\n        (1, [1400], [1.0], 2.500, 0.0, 0.030, 0, 6, [2.0, 3.0, 0.002]),\n        # Case 3 (two modes with finite temperature)\n        (2, [1200, 1600], [0.5, 0.8], 2.200, 300.0, 0.040, 2, 3, [1.8, 3.0, 0.002]),\n        # Case 4 (low-frequency mode to probe hot-band contributions)\n        (1, [200], [0.3], 1.800, 300.0, 0.020, 5, 6, [1.6, 2.2, 0.001]),\n        # Case 5 (two modes, one with zero displacement)\n        (2, [1000, 1800], [0.0, 1.2], 3.400, 0.0, 0.050, 0, 5, [2.8, 4.2, 0.002]),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = _solve_one_case(case)\n        results.append(result)\n\n    # Format output string as a list of lists with 6 decimal places.\n    sublist_strs = [f\"[{item[0]:.6f},{item[1]:.6f},{item[2]:.6f}]\" for item in results]\n    final_str = f\"[{','.join(sublist_strs)}]\"\n    print(final_str)\n\ndef _solve_one_case(case_params):\n    \"\"\"\n    Solves a single test case for vibronic spectrum simulation.\n    \"\"\"\n    N, omegas_cm, S_factors, E00, T, sigma, m_max, n_max, grid_params = case_params\n\n    # Constants and conversions\n    CM_TO_EV = 1 / 8065.544005\n    KB_EV_K = 8.617333262145e-5\n    \n    # Pre-compute factorials for efficiency\n    max_qn = max(m_max, n_max)\n    fact_table = [factorial(i) for i in range(max_qn + 1)]\n    \n    def compute_fcf_1d(m, n, S):\n        if S  1e-12:\n            return 1.0 if m == n else 0.0\n        p, q = min(m, n), max(m, n)\n        d = q - p\n        fact_ratio = fact_table[p] / fact_table[q]\n        laguerre_poly = genlaguerre(p, d)\n        laguerre_val = laguerre_poly(S)\n        return exp(-S) * fact_ratio * (S**d) * (laguerre_val**2)\n\n    omegas_ev = [w * CM_TO_EV for w in omegas_cm]\n\n    # Pre-compute FCFs and Boltzmann populations for each mode\n    all_fcfs = []\n    all_pops = []\n    \n    for k in range(N):\n        # Boltzmann populations\n        pops_k = np.zeros(m_max + 1)\n        if T == 0.0:\n            pops_k[0] = 1.0\n        else:\n            beta_hbar_omega = omegas_ev[k] / (KB_EV_K * T)\n            q = np.exp(-beta_hbar_omega) if beta_hbar_omega  700 else 0.0\n            norm = 1.0 - q\n            for m in range(m_max + 1):\n                pops_k[m] = norm * (q**m)\n        all_pops.append(pops_k)\n\n        # Franck-Condon factors\n        S_k = S_factors[k]\n        fcfs_k = np.zeros((m_max + 1, n_max + 1))\n        for m in range(m_max + 1):\n            for n in range(n_max + 1):\n                fcfs_k[m, n] = compute_fcf_1d(m, n, S_k)\n        all_fcfs.append(fcfs_k)\n\n    # Assemble stick spectrum\n    stick_spectrum = {}  # {energy: intensity} to group degenerate transitions\n    \n    for m_tuple in product(range(m_max + 1), repeat=N):\n        pop = np.prod([all_pops[k][m_tuple[k]] for k in range(N)])\n        if pop  1e-15: continue\n\n        for n_tuple in product(range(n_max + 1), repeat=N):\n            fcf = np.prod([all_fcfs[k][m_tuple[k], n_tuple[k]] for k in range(N)])\n            if fcf  1e-15: continue\n            \n            intensity = pop * fcf\n            energy_shift = sum(omegas_ev[k] * (n_tuple[k] - m_tuple[k]) for k in range(N))\n            energy = E00 + energy_shift\n            stick_spectrum[energy] = stick_spectrum.get(energy, 0.0) + intensity\n    \n    max_E, max_I = 0.0, 0.0\n    if not stick_spectrum:\n        max_E, max_I = E00, 0.0\n    else:\n        energies, intensities = zip(*stick_spectrum.items())\n        energies = np.array(energies)\n        intensities = np.array(intensities)\n\n        # Normalize stick spectrum\n        total_intensity = np.sum(intensities)\n        if total_intensity > 1e-15:\n            intensities /= total_intensity\n        \n        # Broaden spectrum\n        E_min_grid, E_max_grid, dE = grid_params\n        E_grid = np.arange(E_min_grid, E_max_grid, dE)\n        broadened_spectrum = np.zeros_like(E_grid, dtype=float)\n        \n        prefactor = 1 / (sigma * sqrt(2 * pi))\n        variance_term = 2 * sigma**2\n\n        for E_i, I_i in zip(energies, intensities):\n            if I_i > 0:\n                gaussian = I_i * prefactor * np.exp(-((E_grid - E_i)**2) / variance_term)\n                broadened_spectrum += gaussian\n            \n        max_idx = np.argmax(broadened_spectrum)\n        max_I = broadened_spectrum[max_idx]\n        max_E = E_grid[max_idx]\n\n    # Calculate total 0-0 FCF (S_00)\n    S00 = exp(-sum(S_factors))\n\n    return [max_E, max_I, S00]\n\nsolve()\n```", "id": "3727865"}, {"introduction": "A crucial step in computational spectroscopy is the quantitative validation of theoretical predictions against experimental measurements. This practice moves beyond simple visual inspection by introducing a rigorous method to align a calculated TDDFT spectrum with experimental data and quantify their agreement [@problem_id:3727877]. You will implement a weighted least-squares alignment and calculate the Root-Mean-Square Error (RMSE), providing you with a powerful and objective tool for assessing the accuracy of your theoretical models.", "problem": "You are given discrete electronic excitation energies and oscillator strengths from Time-Dependent Density Functional Theory (TDDFT) for a neutral organic chromophore, and an idealized experimental spectrum characterized by peak energies and peak weight amplitudes. From first principles, model the computed TDDFT stick spectrum as a sum of Dirac delta distributions, apply homogeneous Gaussian broadening to obtain a continuous spectrum on a prescribed energy grid, align the computed peak positions to the experimental peak positions using a single optimal energy shift determined by a weighted least-squares criterion, and quantify the mismatch between the aligned, broadened TDDFT spectrum and the experimental spectrum by the root-mean-square (RMS) error of intensities across the energy grid.\n\nStart from the following fundamental base:\n- Linear-response Time-Dependent Density Functional Theory (TDDFT) produces a set of electronic excitation energies $\\{\\omega_k\\}$ and oscillator strengths $\\{f_k\\}$, which define a stick spectrum $S(E) = \\sum_{k} f_k \\,\\delta(E - \\omega_k)$, where $\\delta(\\cdot)$ is the Dirac delta distribution and $E$ is the photon energy.\n- Homogeneous broadening converts $\\delta(\\cdot)$ into a smooth lineshape; for Gaussian broadening with standard deviation $\\sigma$, the broadened line for a single transition at energy $\\mu$ is $G_\\sigma(E;\\mu) = \\dfrac{1}{\\sigma\\sqrt{2\\pi}} \\exp\\!\\left(-\\dfrac{(E - \\mu)^2}{2\\sigma^2}\\right)$.\n- The experimental spectrum is idealized as $I_{\\mathrm{exp}}(E) = \\sum_{j} a_j \\, G_{\\sigma_{\\mathrm{exp}}}(E; E^{\\mathrm{exp}}_j)$, where $\\{E^{\\mathrm{exp}}_j\\}$ are experimental peak energies and $\\{a_j\\}$ are peak weight amplitudes.\n- To align peak positions, determine a scalar energy shift $\\Delta$ that minimizes the weighted least-squares objective $\\Phi(\\Delta) = \\sum_{k} w_k \\left( (\\omega_k + \\Delta) - E^{\\mathrm{exp}}_k \\right)^2$, where $\\{w_k\\}$ are nonnegative weights. The unique minimizer is $\\Delta^\\ast = \\dfrac{\\sum_{k} w_k \\left(E^{\\mathrm{exp}}_k - \\omega_k\\right)}{\\sum_{k} w_k}$, assuming $\\sum_k w_k \\neq 0$ and the peaks are index-aligned.\n- The aligned, broadened computed spectrum is $I_{\\mathrm{calc}}(E) = \\sum_{k} f_k \\, G_{\\sigma_{\\mathrm{calc}}}\\!\\left(E; \\omega_k + \\Delta^\\ast\\right)$.\n- The Root-Mean-Square (RMS) error across a discrete energy grid $\\{E_n\\}_{n=1}^N$ is $\\mathrm{RMSE} = \\sqrt{\\dfrac{1}{N} \\sum_{n=1}^{N} \\left( I_{\\mathrm{calc}}(E_n) - I_{\\mathrm{exp}}(E_n) \\right)^2 }$.\n\nImplement the above using the specified test suite. Energies must be treated in electronvolts, and all Gaussian widths must be treated as electronvolts. Intensities are dimensionless in this idealization. Your program should produce a single line of output containing the RMSE values for the test cases as a comma-separated list enclosed in square brackets. Each RMSE must be rounded to six decimals.\n\nUse the following test suite, which spans a typical case, a narrow-line boundary case, and a broad-line case:\n\n- Test Case $1$ (typical organic chromophore in ultraviolet-visible regime):\n  - Computed TDDFT excitations: $\\omega_{\\mathrm{calc}} = [\\,3.40,\\,4.75,\\,5.60\\,]$ $\\mathrm{eV}$.\n  - Computed oscillator strengths: $f_{\\mathrm{calc}} = [\\,0.80,\\,0.30,\\,0.25\\,]$.\n  - Experimental peaks: $E^{\\mathrm{exp}} = [\\,3.30,\\,4.62,\\,5.50\\,]$ $\\mathrm{eV}$.\n  - Experimental peak weights: $a_{\\mathrm{exp}} = [\\,0.85,\\,0.28,\\,0.27\\,]$.\n  - Experimental Gaussian width: $\\sigma_{\\mathrm{exp}} = 0.08$ $\\mathrm{eV}$.\n  - Computed Gaussian width: $\\sigma_{\\mathrm{calc}} = 0.10$ $\\mathrm{eV}$.\n  - Alignment weights: $w_k = f_{\\mathrm{calc},k}$.\n  - Energy grid: start $E_{\\min} = 2.80$ $\\mathrm{eV}$, end $E_{\\max} = 6.20$ $\\mathrm{eV}$, step $\\Delta E = 0.01$ $\\mathrm{eV}$.\n\n- Test Case $2$ (narrow homogeneous broadening and a weak transition):\n  - Computed TDDFT excitations: $\\omega_{\\mathrm{calc}} = [\\,3.00,\\,4.20,\\,5.00\\,]$ $\\mathrm{eV}$.\n  - Computed oscillator strengths: $f_{\\mathrm{calc}} = [\\,0.05,\\,0.60,\\,0.00\\,]$.\n  - Experimental peaks: $E^{\\mathrm{exp}} = [\\,2.95,\\,4.10,\\,4.95\\,]$ $\\mathrm{eV}$.\n  - Experimental peak weights: $a_{\\mathrm{exp}} = [\\,0.06,\\,0.58,\\,0.02\\,]$.\n  - Experimental Gaussian width: $\\sigma_{\\mathrm{exp}} = 0.02$ $\\mathrm{eV}$.\n  - Computed Gaussian width: $\\sigma_{\\mathrm{calc}} = 0.02$ $\\mathrm{eV}$.\n  - Alignment weights: $w_k = f_{\\mathrm{calc},k}$.\n  - Energy grid: start $E_{\\min} = 2.50$ $\\mathrm{eV}$, end $E_{\\max} = 5.50$ $\\mathrm{eV}$, step $\\Delta E = 0.005$ $\\mathrm{eV}$.\n\n- Test Case $3$ (broad homogeneous effect mimicking condensed-phase environment):\n  - Computed TDDFT excitations: $\\omega_{\\mathrm{calc}} = [\\,2.80,\\,3.80,\\,5.80\\,]$ $\\mathrm{eV}$.\n  - Computed oscillator strengths: $f_{\\mathrm{calc}} = [\\,0.40,\\,0.35,\\,0.20\\,]$.\n  - Experimental peaks: $E^{\\mathrm{exp}} = [\\,2.70,\\,3.65,\\,5.65\\,]$ $\\mathrm{eV}$.\n  - Experimental peak weights: $a_{\\mathrm{exp}} = [\\,0.42,\\,0.33,\\,0.22\\,]$.\n  - Experimental Gaussian width: $\\sigma_{\\mathrm{exp}} = 0.25$ $\\mathrm{eV}$.\n  - Computed Gaussian width: $\\sigma_{\\mathrm{calc}} = 0.25$ $\\mathrm{eV}$.\n  - Alignment weights: $w_k = f_{\\mathrm{calc},k}$.\n  - Energy grid: start $E_{\\min} = 2.00$ $\\mathrm{eV}$, end $E_{\\max} = 6.50$ $\\mathrm{eV}$, step $\\Delta E = 0.02$ $\\mathrm{eV}$.\n\nProgram requirements:\n- Construct $I_{\\mathrm{exp}}(E)$ for each test case from the provided experimental peak energies, weights, and $\\sigma_{\\mathrm{exp}}$.\n- Compute $\\Delta^\\ast$ using $w_k = f_{\\mathrm{calc},k}$ and index-aligned peaks.\n- Construct $I_{\\mathrm{calc}}(E)$ using $\\omega_{\\mathrm{calc}} + \\Delta^\\ast$, $f_{\\mathrm{calc}}$, and $\\sigma_{\\mathrm{calc}}$.\n- Compute $\\mathrm{RMSE}$ across the specified energy grid for each test case.\n- Output the three $\\mathrm{RMSE}$ values as a single line in the format $[r_1,r_2,r_3]$, where each $r_i$ is rounded to six decimals.\n\nAll energies must be expressed and handled in $\\mathrm{eV}$, and the final intensities are dimensionless. Angles are not involved in this problem. No percentages are used.", "solution": "The user has provided a problem that requires the comparison of a theoretical electronic spectrum, computed using Time-Dependent Density Functional Theory (TDDFT), with an idealized experimental spectrum. The task is to align the theoretical spectrum to the experimental one via an optimal energy shift and then quantify the discrepancy using the Root-Mean-Square Error (RMSE).\n\n### Step 1: Extract Givens\n\nThe problem provides the following data and definitions:\n- Theoretical (TDDFT) stick spectrum: $S(E) = \\sum_{k} f_k \\,\\delta(E - \\omega_k)$, where $\\{\\omega_k\\}$ are excitation energies, $\\{f_k\\}$ are oscillator strengths, and $\\delta(\\cdot)$ is the Dirac delta distribution.\n- Gaussian broadening lineshape: $G_\\sigma(E;\\mu) = \\dfrac{1}{\\sigma\\sqrt{2\\pi}} \\exp\\!\\left(-\\dfrac{(E - \\mu)^2}{2\\sigma^2}\\right)$, with standard deviation $\\sigma$.\n- Idealized experimental spectrum: $I_{\\mathrm{exp}}(E) = \\sum_{j} a_j \\, G_{\\sigma_{\\mathrm{exp}}}(E; E^{\\mathrm{exp}}_j)$, where $\\{E^{\\mathrm{exp}}_j\\}$ are peak energies and $\\{a_j\\}$ are peak weight amplitudes.\n- Weighted least-squares objective for alignment: $\\Phi(\\Delta) = \\sum_{k} w_k \\left( (\\omega_k + \\Delta) - E^{\\mathrm{exp}}_k \\right)^2$, with nonnegative weights $\\{w_k\\}$.\n- Unique minimizer (optimal energy shift): $\\Delta^\\ast = \\dfrac{\\sum_{k} w_k \\left(E^{\\mathrm{exp}}_k - \\omega_k\\right)}{\\sum_{k} w_k}$, assuming index-aligned peaks and $\\sum_k w_k \\neq 0$.\n- Aligned, broadened computed spectrum: $I_{\\mathrm{calc}}(E) = \\sum_{k} f_k \\, G_{\\sigma_{\\mathrm{calc}}}\\!\\left(E; \\omega_k + \\Delta^\\ast\\right)$.\n- Root-Mean-Square Error: $\\mathrm{RMSE} = \\sqrt{\\dfrac{1}{N} \\sum_{n=1}^{N} \\left( I_{\\mathrm{calc}}(E_n) - I_{\\mathrm{exp}}(E_n) \\right)^2 }$, over a discrete energy grid $\\{E_n\\}_{n=1}^N$.\n- The alignment weights are specified as $w_k = f_{\\mathrm{calc},k}$.\n\nTest Case $1$:\n- $\\omega_{\\mathrm{calc}} = [\\,3.40,\\,4.75,\\,5.60\\,]$ $\\mathrm{eV}$\n- $f_{\\mathrm{calc}} = [\\,0.80,\\,0.30,\\,0.25\\,]$\n- $E^{\\mathrm{exp}} = [\\,3.30,\\,4.62,\\,5.50\\,]$ $\\mathrm{eV}$\n- $a_{\\mathrm{exp}} = [\\,0.85,\\,0.28,\\,0.27\\,]$\n- $\\sigma_{\\mathrm{exp}} = 0.08$ $\\mathrm{eV}$\n- $\\sigma_{\\mathrm{calc}} = 0.10$ $\\mathrm{eV}$\n- Energy grid: $E_{\\min} = 2.80$ $\\mathrm{eV}$, $E_{\\max} = 6.20$ $\\mathrm{eV}$, $\\Delta E = 0.01$ $\\mathrm{eV}$\n\nTest Case $2$:\n- $\\omega_{\\mathrm{calc}} = [\\,3.00,\\,4.20,\\,5.00\\,]$ $\\mathrm{eV}$\n- $f_{\\mathrm{calc}} = [\\,0.05,\\,0.60,\\,0.00\\,]$\n- $E^{\\mathrm{exp}} = [\\,2.95,\\,4.10,\\,4.95\\,]$ $\\mathrm{eV}$\n- $a_{\\mathrm{exp}} = [\\,0.06,\\,0.58,\\,0.02\\,]$\n- $\\sigma_{\\mathrm{exp}} = 0.02$ $\\mathrm{eV}$\n- $\\sigma_{\\mathrm{calc}} = 0.02$ $\\mathrm{eV}$\n- Energy grid: $E_{\\min} = 2.50$ $\\mathrm{eV}$, $E_{\\max} = 5.50$ $\\mathrm{eV}$, $\\Delta E = 0.005$ $\\mathrm{eV}$\n\nTest Case $3$:\n- $\\omega_{\\mathrm{calc}} = [\\,2.80,\\,3.80,\\,5.80\\,]$ $\\mathrm{eV}$\n- $f_{\\mathrm{calc}} = [\\,0.40,\\,0.35,\\,0.20\\,]$\n- $E^{\\mathrm{exp}} = [\\,2.70,\\,3.65,\\,5.65\\,]$ $\\mathrm{eV}$\n- $a_{\\mathrm{exp}} = [\\,0.42,\\,0.33,\\,0.22\\,]$\n- $\\sigma_{\\mathrm{exp}} = 0.25$ $\\mathrm{eV}$\n- $\\sigma_{\\mathrm{calc}} = 0.25$ $\\mathrm{eV}$\n- Energy grid: $E_{\\min} = 2.00$ $\\mathrm{eV}$, $E_{\\max} = 6.50$ $\\mathrm{eV}$, $\\Delta E = 0.02$ $\\mathrm{eV}$\n\n### Step 2: Validate Using Extracted Givens\n\nThe problem is subjected to validation.\n1.  **Scientifically Grounded**: The problem is based on standard principles of computational spectroscopy, namely TDDFT for electronic excitations and Gaussian broadening to simulate experimental lineshapes. The mathematical formalisms for spectral alignment and error quantification are standard in data analysis. All premises are scientifically sound.\n2.  **Well-Posed**: The problem is well-posed. It provides all necessary data and a clear, deterministic algorithm to follow. The formula for the optimal shift $\\Delta^\\ast$ ensures a unique solution, as the denominator $\\sum_k w_k = \\sum_k f_{\\mathrm{calc},k}$ is a sum of non-negative oscillator strengths and is non-zero for all test cases. The existence of a unique RMSE value is guaranteed.\n3.  **Objective**: The problem is stated in precise, quantitative, and unbiased language.\n4.  **Completeness and Consistency**: The problem is self-contained. All variables, constants, and procedural steps are explicitly defined. The data for each test case is complete and nothing is contradictory.\n5.  **Realism**: The energy values, oscillator strengths, and broadening parameters are physically realistic for typical organic molecules.\n\nThe problem is free of any invalidating flaws.\n\n### Step 3: Verdict and Action\n\nThe problem is valid. A complete, reasoned solution will be provided.\n\n### Solution Walkthrough\n\nThe solution is found by implementing a four-step computational procedure for each test case.\n\n**Step 1: Determine the Optimal Energy Shift ($\\Delta^\\ast$)**\nThe optimal energy shift $\\Delta^\\ast$ minimizes the weighted squared difference between the computed and experimental peak positions. It is calculated using the provided formula:\n$$\n\\Delta^\\ast = \\frac{\\sum_{k} w_k (E^{\\mathrm{exp}}_k - \\omega_k)}{\\sum_{k} w_k}\n$$\nwhere the weights $w_k$ are the computed oscillator strengths $f_{\\mathrm{calc},k}$.\n\n**Step 2: Define Discrete Energy Grid**\nFor each case, a discrete energy grid $\\{E_n\\}$ is constructed from $E_{\\min}$ to $E_{\\max}$ with a step size of $\\Delta E$. The total number of points, $N$, is given by $N = \\text{round}((E_{\\max} - E_{\\min}) / \\Delta E) + 1$.\n\n**Step 3: Generate the Spectra on the Grid**\nThe intensity of the idealized experimental spectrum, $I_{\\mathrm{exp}}(E_n)$, and the aligned, broadened theoretical spectrum, $I_{\\mathrm{calc}}(E_n)$, must be computed at each point $E_n$ on the energy grid.\nThe Gaussian lineshape function is:\n$$\nG_\\sigma(E; \\mu) = \\frac{1}{\\sigma\\sqrt{2\\pi}} \\exp\\left(-\\frac{(E - \\mu)^2}{2\\sigma^2}\\right)\n$$\nThe experimental spectrum is the weighted sum of Gaussian functions centered at the experimental peak energies:\n$$\nI_{\\mathrm{exp}}(E_n) = \\sum_{j} a_{\\mathrm{exp},j} \\, G_{\\sigma_{\\mathrm{exp}}}(E_n; E^{\\mathrm{exp}}_j)\n$$\nThe theoretical spectrum is a similar sum, but using the computed oscillator strengths as weights and centered at the optimally shifted energies $\\omega'_k = \\omega_k + \\Delta^\\ast$:\n$$\nI_{\\mathrm{calc}}(E_n) = \\sum_{k} f_{\\mathrm{calc},k} \\, G_{\\sigma_{\\mathrm{calc}}}(E_n; \\omega_k + \\Delta^\\ast)\n$$\n\n**Step 4: Calculate the Root-Mean-Square Error (RMSE)**\nThe final step is to compute the RMSE, which measures the average difference between the two spectra across the entire energy grid:\n$$\n\\mathrm{RMSE} = \\sqrt{\\frac{1}{N} \\sum_{n=1}^{N} \\left( I_{\\mathrm{calc}}(E_n) - I_{\\mathrm{exp}}(E_n) \\right)^2}\n$$\n\n**Application to Test Cases**\n\n**Test Case 1:**\n- Numerator for $\\Delta^\\ast$: $0.80(3.30-3.40) + 0.30(4.62-4.75) + 0.25(5.50-5.60) = -0.08 - 0.039 - 0.025 = -0.144$.\n- Denominator for $\\Delta^\\ast$: $0.80 + 0.30 + 0.25 = 1.35$.\n- $\\Delta^\\ast = -0.144 / 1.35 \\approx -0.106667$ $\\mathrm{eV}$.\n- Energy grid: $N = (6.20 - 2.80)/0.01 + 1 = 341$ points.\n- The spectra $I_{\\mathrm{exp}}(E)$ and $I_{\\mathrm{calc}}(E)$ are generated on this grid using their respective parameters and the calculated $\\Delta^\\ast$.\n- The RMSE is computed, yielding approximately $0.187321$.\n\n**Test Case 2:**\n- Numerator for $\\Delta^\\ast$: $0.05(2.95-3.00) + 0.60(4.10-4.20) + 0.00(4.95-5.00) = -0.0025 - 0.06 = -0.0625$.\n- Denominator for $\\Delta^\\ast$: $0.05 + 0.60 + 0.00 = 0.65$.\n- $\\Delta^\\ast = -0.0625 / 0.65 \\approx -0.096154$ $\\mathrm{eV}$.\n- Energy grid: $N = (5.50 - 2.50)/0.005 + 1 = 601$ points.\n- The spectra are generated on this fine grid. The small broadening parameter $\\sigma = 0.02$ $\\mathrm{eV}$ results in very sharp peaks. The zero oscillator strength for the third transition means it does not contribute to the alignment or to the computed spectrum $I_{\\mathrm{calc}}(E)$.\n- The RMSE is computed, yielding approximately $0.207604$.\n\n**Test Case 3:**\n- Numerator for $\\Delta^\\ast$: $0.40(2.70-2.80) + 0.35(3.65-3.80) + 0.20(5.65-5.80) = -0.04 - 0.0525 - 0.03 = -0.1225$.\n- Denominator for $\\Delta^\\ast$: $0.40 + 0.35 + 0.20 = 0.95$.\n- $\\Delta^\\^\\ast = -0.1225 / 0.95 \\approx -0.128947$ $\\mathrm{eV}$.\n- Energy grid: $N = (6.50 - 2.00)/0.02 + 1 = 226$ points.\n- The spectra are generated on this grid. The large broadening $\\sigma=0.25$ $\\mathrm{eV}$ leads to very broad, overlapping spectral features.\n- The RMSE is computed, yielding approximately $0.016335$.\n\nThe final results are obtained by executing this procedure for each test case and rounding the final RMSE to six decimal places.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of calculating the RMSE between aligned TDDFT and\n    idealized experimental spectra for a series of test cases.\n    \"\"\"\n\n    test_cases = [\n        # Test Case 1 (typical organic chromophore in ultraviolet-visible regime)\n        {\n            \"omega_calc\": np.array([3.40, 4.75, 5.60]),\n            \"f_calc\": np.array([0.80, 0.30, 0.25]),\n            \"E_exp\": np.array([3.30, 4.62, 5.50]),\n            \"a_exp\": np.array([0.85, 0.28, 0.27]),\n            \"sigma_exp\": 0.08,\n            \"sigma_calc\": 0.10,\n            \"grid_params\": {\"start\": 2.80, \"end\": 6.20, \"step\": 0.01},\n        },\n        # Test Case 2 (narrow homogeneous broadening and a weak transition)\n        {\n            \"omega_calc\": np.array([3.00, 4.20, 5.00]),\n            \"f_calc\": np.array([0.05, 0.60, 0.00]),\n            \"E_exp\": np.array([2.95, 4.10, 4.95]),\n            \"a_exp\": np.array([0.06, 0.58, 0.02]),\n            \"sigma_exp\": 0.02,\n            \"sigma_calc\": 0.02,\n            \"grid_params\": {\"start\": 2.50, \"end\": 5.50, \"step\": 0.005},\n        },\n        # Test Case 3 (broad homogeneous effect mimicking condensed-phase environment)\n        {\n            \"omega_calc\": np.array([2.80, 3.80, 5.80]),\n            \"f_calc\": np.array([0.40, 0.35, 0.20]),\n            \"E_exp\": np.array([2.70, 3.65, 5.65]),\n            \"a_exp\": np.array([0.42, 0.33, 0.22]),\n            \"sigma_exp\": 0.25,\n            \"sigma_calc\": 0.25,\n            \"grid_params\": {\"start\": 2.00, \"end\": 6.50, \"step\": 0.02},\n        }\n    ]\n\n    results = []\n\n    def gaussian(E, mu, sigma):\n        \"\"\"\n        Calculates the Gaussian lineshape function.\n        G_sigma(E; mu) = (1 / (sigma * sqrt(2*pi))) * exp(-(E - mu)^2 / (2 * sigma^2))\n        \"\"\"\n        if sigma = 0:\n            # Avoid division by zero and handle as a delta function if sigma is 0\n            # For this problem, sigma is always positive, but this is good practice.\n            return np.zeros_like(E)\n        prefactor = 1.0 / (sigma * np.sqrt(2 * np.pi))\n        exponent = -((E - mu)**2) / (2 * sigma**2)\n        return prefactor * np.exp(exponent)\n\n    for case in test_cases:\n        # Step 1: Determine the Optimal Energy Shift (Delta*)\n        # Weights for alignment are the oscillator strengths\n        weights = case[\"f_calc\"]\n        energy_diffs = case[\"E_exp\"] - case[\"omega_calc\"]\n        \n        numerator = np.sum(weights * energy_diffs)\n        denominator = np.sum(weights)\n        \n        # Handle case where sum of weights is zero to avoid division by zero\n        if denominator == 0:\n            delta_shift = 0.0\n        else:\n            delta_shift = numerator / denominator\n\n        # Step 2: Define Discrete Energy Grid\n        grid_p = case[\"grid_params\"]\n        start, end, step = grid_p[\"start\"], grid_p[\"end\"], grid_p[\"step\"]\n        # Use linspace for robust handling of floating point endpoints\n        num_points = int(round((end - start) / step)) + 1\n        energy_grid = np.linspace(start, end, num_points)\n\n        # Step 3: Generate the Spectra on the Grid\n        # Experimental Spectrum\n        I_exp = np.zeros_like(energy_grid)\n        for j in range(len(case[\"E_exp\"])):\n            I_exp += case[\"a_exp\"][j] * gaussian(energy_grid, case[\"E_exp\"][j], case[\"sigma_exp\"])\n        \n        # Aligned, Broadened Computed Spectrum\n        aligned_omega = case[\"omega_calc\"] + delta_shift\n        I_calc = np.zeros_like(energy_grid)\n        for k in range(len(case[\"omega_calc\"])):\n            I_calc += case[\"f_calc\"][k] * gaussian(energy_grid, aligned_omega[k], case[\"sigma_calc\"])\n\n        # Step 4: Calculate the Root-Mean-Square Error (RMSE)\n        squared_errors = (I_calc - I_exp)**2\n        mean_squared_error = np.mean(squared_errors)\n        rmse = np.sqrt(mean_squared_error)\n\n        results.append(round(rmse, 6))\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3727877"}]}