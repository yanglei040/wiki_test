{"hands_on_practices": [{"introduction": "The isotopic pattern of a halogenated compound contains a wealth of structural information. This exercise guides you through deriving a general mathematical expression for the $M+4$ isotopic peak intensity, which arises from the presence of two heavy halogen isotopes. By analyzing how this intensity changes with molecular composition, you will learn to establish a rigorous upper bound on the total number of halogen atoms possible in an unknown molecule, a powerful technique for constraining a molecular formula from mass spectral data alone [@problem_id:3709363].", "problem": "An unknown organic radical cation analyzed by high-resolution Mass Spectrometry (MS) exhibits a resolved halogen isotope cluster in which the ratio of the $M\\!+\\!4$ peak intensity to the monoisotopic $M$ peak intensity is measured as $R = 0.420$. Instrumental deconvolution has quantitatively removed contributions to $M\\!+\\!4$ arising from non-halogen isotopes (for example, combinations of heavy oxygen and sulfur), so $M\\!+\\!4$ here exclusively reflects halogen heavy-isotope substitutions. The halogen content is comprised solely of chlorine and bromine. Assume:\n- Isotopic selections for each halogen atom are independent.\n- Natural abundance of chlorine is $^{35}\\text{Cl}$ with probability $q_{\\text{Cl}} = 0.7578$ and $^{37}\\text{Cl}$ with probability $p_{\\text{Cl}} = 0.2422$.\n- Natural abundance of bromine is $^{79}\\text{Br}$ with probability $q_{\\text{Br}} = 0.5069$ and $^{81}\\text{Br}$ with probability $p_{\\text{Br}} = 0.4931$.\n\nA heavy halogen isotope substitution raises the mass by $+2$ relative to its light counterpart. Therefore, the $M$ peak corresponds to zero heavy halogens and the $M\\!+\\!4$ peak corresponds to exactly two heavy halogens among the halogen atoms present.\n\nLet $N$ denote the total number of halogen atoms in the ion, with an unknown composition split between chlorine and bromine. Using only the independence of isotopic selections and the listed natural abundances as fundamental base, derive from first principles the expression for the minimal possible $M\\!+\\!4/M$ ratio, $R_{\\min}(N)$, over all chlorine/bromine compositions with a fixed total $N$, and then determine the tightest upper bound on $N$ implied by the measurement, defined as the largest integer $N$ for which $R_{\\min}(N) \\le R$. Provide your final answer as a single integer with no units.", "solution": "The problem requires the derivation of the minimal possible $M\\!+\\!4/M$ intensity ratio for a molecule containing $N$ halogen atoms (chlorine and bromine), and then to use this to find the tightest upper bound on $N$ given an experimental ratio.\n\nFirst, we formalize the problem statement. Let $n_{\\text{Cl}}$ be the number of chlorine atoms and $n_{\\text{Br}}$ be the number of bromine atoms, such that the total number of halogen atoms is $N = n_{\\text{Cl}} + n_{\\text{Br}}$. The isotopic abundances are given as probabilities:\n- For chlorine: $q_{\\text{Cl}} = P(^{35}\\text{Cl}) = 0.7578$ (light isotope) and $p_{\\text{Cl}} = P(^{37}\\text{Cl}) = 0.2422$ (heavy isotope).\n- For bromine: $q_{\\text{Br}} = P(^{79}\\text{Br}) = 0.5069$ (light isotope) and $p_{\\text{Br}} = P(^{81}\\text{Br}) = 0.4931$ (heavy isotope).\n\nThe intensity of a mass spectral peak is proportional to the total probability of all isotopic combinations that result in that mass. The monoisotopic peak, $M$, corresponds to the molecule containing only the lightest isotopes of all atoms. For the halogen atoms, this means all are $^{35}\\text{Cl}$ and $^{79}\\text{Br}$. Assuming isotopic selections are independent events, the probability corresponding to the $M$ peak is:\n$$ P(M) = q_{\\text{Cl}}^{n_{\\text{Cl}}} q_{\\text{Br}}^{n_{\\text{Br}}} $$\n\nThe $M\\!+\\!4$ peak corresponds to the presence of exactly two heavy halogen isotopes. A heavy halogen isotope ($^{37}\\text{Cl}$ or $^{81}\\text{Br}$) has a mass of $+2$ relative to its light counterpart. Thus, an $M\\!+\\!4$ mass shift requires two such substitutions. There are three mutually exclusive ways to achieve this:\n1.  Two heavy chlorine atoms ($^{37}\\text{Cl}$) and no heavy bromine atoms. The number of ways to choose $2$ Cl atoms out of $n_{\\text{Cl}}$ is $\\binom{n_{\\text{Cl}}}{2}$. The probability is $\\binom{n_{\\text{Cl}}}{2} p_{\\text{Cl}}^2 q_{\\text{Cl}}^{n_{\\text{Cl}}-2} \\cdot q_{\\text{Br}}^{n_{\\text{Br}}}$.\n2.  One heavy chlorine atom and one heavy bromine atom. The number of ways is $\\binom{n_{\\text{Cl}}}{1} \\binom{n_{\\text{Br}}}{1} = n_{\\text{Cl}} n_{\\text{Br}}$. The probability is $n_{\\text{Cl}} p_{\\text{Cl}} q_{\\text{Cl}}^{n_{\\text{Cl}}-1} \\cdot n_{\\text{Br}} p_{\\text{Br}} q_{\\text{Br}}^{n_{\\text{Br}}-1}$.\n3.  Two heavy bromine atoms ($^{81}\\text{Br}$) and no heavy chlorine atoms. The number of ways is $\\binom{n_{\\text{Br}}}{2}$. The probability is $q_{\\text{Cl}}^{n_{\\text{Cl}}} \\cdot \\binom{n_{\\text{Br}}}{2} p_{\\text{Br}}^2 q_{\\text{Br}}^{n_{\\text{Br}}-2}$.\n\nThe total probability for the $M\\!+\\!4$ peak is the sum of these probabilities:\n$$ P(M\\!+\\!4) = \\binom{n_{\\text{Cl}}}{2} p_{\\text{Cl}}^2 q_{\\text{Cl}}^{n_{\\text{Cl}}-2} q_{\\text{Br}}^{n_{\\text{Br}}} + n_{\\text{Cl}} n_{\\text{Br}} p_{\\text{Cl}} p_{\\text{Br}} q_{\\text{Cl}}^{n_{\\text{Cl}}-1} q_{\\text{Br}}^{n_{\\text{Br}}-1} + \\binom{n_{\\text{Br}}}{2} p_{\\text{Br}}^2 q_{\\text{Br}}^{n_{\\text{Br}}-2} q_{\\text{Cl}}^{n_{\\text{Cl}}} $$\n\nThe ratio $R$ of the peak intensities is the ratio of their probabilities:\n$$ R(n_{\\text{Cl}}, n_{\\text{Br}}) = \\frac{P(M\\!+\\!4)}{P(M)} = \\frac{\\binom{n_{\\text{Cl}}}{2} p_{\\text{Cl}}^2 q_{\\text{Cl}}^{n_{\\text{Cl}}-2} q_{\\text{Br}}^{n_{\\text{Br}}} + n_{\\text{Cl}} n_{\\text{Br}} p_{\\text{Cl}} p_{\\text{Br}} q_{\\text{Cl}}^{n_{\\text{Cl}}-1} q_{\\text{Br}}^{n_{\\text{Br}}-1} + \\binom{n_{\\text{Br}}}{2} p_{\\text{Br}}^2 q_{\\text{Br}}^{n_{\\text{Br}}-2} q_{\\text{Cl}}^{n_{\\text{Cl}}}}{q_{\\text{Cl}}^{n_{\\text{Cl}}} q_{\\text{Br}}^{n_{\\text{Br}}}} $$\nDividing the numerator by the denominator term-by-term yields:\n$$ R(n_{\\text{Cl}}, n_{\\text{Br}}) = \\binom{n_{\\text{Cl}}}{2} \\left(\\frac{p_{\\text{Cl}}}{q_{\\text{Cl}}}\\right)^2 + n_{\\text{Cl}} n_{\\text{Br}} \\left(\\frac{p_{\\text{Cl}}}{q_{\\text{Cl}}}\\right) \\left(\\frac{p_{\\text{Br}}}{q_{\\text{Br}}}\\right) + \\binom{n_{\\text{Br}}}{2} \\left(\\frac{p_{\\text{Br}}}{q_{\\text{Br}}}\\right)^2 $$\nLet us define the heavy-to-light isotope ratios $\\rho_i = p_i/q_i$:\n$$ \\rho_{\\text{Cl}} = \\frac{p_{\\text{Cl}}}{q_{\\text{Cl}}} = \\frac{0.2422}{0.7578} \\quad \\text{and} \\quad \\rho_{\\text{Br}} = \\frac{p_{\\text{Br}}}{q_{\\text{Br}}} = \\frac{0.4931}{0.5069} $$\nThe expression for the ratio becomes:\n$$ R(n_{\\text{Cl}}, n_{\\text{Br}}) = \\binom{n_{\\text{Cl}}}{2} \\rho_{\\text{Cl}}^2 + n_{\\text{Cl}} n_{\\text{Br}} \\rho_{\\text{Cl}} \\rho_{\\text{Br}} + \\binom{n_{\\text{Br}}}{2} \\rho_{\\text{Br}}^2 $$\nThis expression is equivalent to the second elementary symmetric polynomial $e_2$ of a set of $N$ variables, where $n_{\\text{Cl}}$ of them are $\\rho_{\\text{Cl}}$ and $n_{\\text{Br}}$ are $\\rho_{\\text{Br}}$.\n\nThe next step is to find the composition $(n_{\\text{Cl}}, n_{\\text{Br}})$ that minimizes this ratio $R$ for a fixed total number of halogens $N$. We have $\\rho_{\\text{Cl}} \\approx 0.3196$ and $\\rho_{\\text{Br}} \\approx 0.9728$. Since $\\rho_{\\text{Cl}} < \\rho_{\\text{Br}}$, it seems intuitive that the ratio will be minimized by maximizing the number of chlorine atoms, which have the smaller isotope ratio.\nTo prove this rigorously, consider the change in $R$ when one bromine atom is replaced by one chlorine atom. This corresponds to a transition from state $(n_{\\text{Cl}}, n_{\\text{Br}})$ to $(n_{\\text{Cl}}+1, n_{\\text{Br}}-1)$, where $n_{\\text{Br}} \\ge 1$. The change, $\\Delta R$, is:\n$$ \\Delta R = R(n_{\\text{Cl}}+1, n_{\\text{Br}}-1) - R(n_{\\text{Cl}}, n_{\\text{Br}}) $$\nUsing the formula for $R$, we can compute this difference. A more elegant way is to consider the change in the sum of pairwise products $\\sum_{1 \\le i < j \\le N} \\rho_i \\rho_j$. When changing atom $k$ from Br to Cl, every term $\\rho_k \\rho_j = \\rho_{\\text{Br}}\\rho_j$ in the sum (for $j \\ne k$) is replaced by $\\rho_{\\text{Cl}}\\rho_j$. The change is:\n$$ \\Delta R = \\sum_{j \\ne k} (\\rho_{\\text{Cl}}\\rho_j - \\rho_{\\text{Br}}\\rho_j) = (\\rho_{\\text{Cl}} - \\rho_{\\text{Br}}) \\sum_{j \\ne k} \\rho_j $$\nThe original set of ratios for the sum $\\sum_{j \\ne k} \\rho_j$ consists of $n_{\\text{Cl}}$ values of $\\rho_{\\text{Cl}}$ and $(n_{\\text{Br}}-1)$ values of $\\rho_{\\text{Br}}$.\n$$ \\sum_{j \\ne k} \\rho_j = n_{\\text{Cl}}\\rho_{\\text{Cl}} + (n_{\\text{Br}}-1)\\rho_{\\text{Br}} $$\nSo the change in the ratio is:\n$$ \\Delta R = (\\rho_{\\text{Cl}} - \\rho_{\\text{Br}}) (n_{\\text{Cl}}\\rho_{\\text{Cl}} + (n_{\\text{Br}}-1)\\rho_{\\text{Br}}) $$\nGiven the numerical values, $\\rho_{\\text{Cl}} - \\rho_{\\text{Br}} < 0$. The second term, $(n_{\\text{Cl}}\\rho_{\\text{Cl}} + (n_{\\text{Br}}-1)\\rho_{\\text{Br}})$, is a sum of non-negative terms. For the change to be possible, we must have $n_{\\text{Br}} \\ge 1$. The problem is non-trivial for $N \\ge 2$. If $n_{\\text{Br}} \\ge 2$, then $n_{\\text{Br}}-1 \\ge 1$ and the term is clearly positive. If $n_{\\text{Br}} = 1$, then $n_{\\text{Cl}} = N-1 \\ge 1$, and the term is $(N-1)\\rho_{\\text{Cl}} > 0$. In all relevant cases, the second factor is positive.\nTherefore, $\\Delta R < 0$. This proves that replacing a bromine atom with a chlorine atom always decreases the ratio $R$. Consequently, for a fixed total number of halogens $N$, the ratio $R$ is minimized when the number of chlorine atoms is maximized. This occurs for the composition $n_{\\text{Cl}} = N$ and $n_{\\text{Br}} = 0$.\n\nThe minimal ratio for a given $N$, denoted $R_{\\min}(N)$, is thus:\n$$ R_{\\min}(N) = R(N, 0) = \\binom{N}{2} \\rho_{\\text{Cl}}^2 = \\frac{N(N-1)}{2} \\left(\\frac{p_{\\text{Cl}}}{q_{\\text{Cl}}}\\right)^2 $$\n\nThe problem states a measured ratio $R = 0.420$. We need to find the largest integer $N$ such that $R_{\\min}(N) \\le R$. This implies solving the inequality:\n$$ \\frac{N(N-1)}{2} \\left(\\frac{0.2422}{0.7578}\\right)^2 \\le 0.420 $$\nFirst, we calculate the value of the constant term:\n$$ \\rho_{\\text{Cl}}^2 = \\left(\\frac{0.2422}{0.7578}\\right)^2 \\approx (0.319609)^2 \\approx 0.102150 $$\nSubstituting this into the inequality:\n$$ \\frac{N(N-1)}{2} \\times 0.102150 \\le 0.420 $$\n$$ N(N-1) \\le \\frac{2 \\times 0.420}{0.102150} $$\n$$ N(N-1) \\le \\frac{0.840}{0.102150} \\approx 8.2232 $$\nWe must find the largest integer $N \\ge 2$ (since for $N<2$, the $M\\!+\\!4$ peak for a pure chlorine compound is zero) that satisfies this condition. We can test small integer values of $N$:\n- For $N=2$: $N(N-1) = 2(1) = 2$. $2 \\le 8.2232$, which is true.\n- For $N=3$: $N(N-1) = 3(2) = 6$. $6 \\le 8.2232$, which is true.\n- For $N=4$: $N(N-1) = 4(3) = 12$. $12 \\le 8.2232$, which is false.\n\nThe inequality holds for $N=3$ but fails for $N=4$. Therefore, the largest integer $N$ for which $R_{\\min}(N) \\le R$ is $3$. This is the tightest upper bound on the total number of halogen atoms consistent with the experimental observation.", "answer": "$$\n\\boxed{3}\n$$", "id": "3709363"}, {"introduction": "In practical analytical chemistry, theoretical predictions must contend with the reality of measurement uncertainty and decision-making errors. This problem simulates a realistic automated screening process for identifying halogenated compounds, where a fixed threshold is applied to an isotopic ratio [@problem_id:3709425]. By modeling measurement noise and considering contributions from non-halogenated molecules that can mimic a halogen signature, you will calculate the probabilities of false positives and false negatives, thereby learning to critically evaluate the performance and reliability of an analytical method.", "problem": "A laboratory uses mass spectrometry (MS) to screen unknown organic molecules for the presence of a single halogen atom (either chlorine or bromine) by examining the isotopic pattern around the monoisotopic peak. The decision variable is the normalized isotopic ratio defined as $r = I_{M+2}/(I_{M} + I_{M+2})$, where $I_{M}$ and $I_{M+2}$ are the intensities at the monoisotopic mass and the mass incremented by two units, respectively. The screening rule is: declare “halogen present” if $r_{\\text{obs}} \\geq T$, where $T = 0.30$. The instrument reports $r_{\\text{obs}}$ subject to additive measurement error modeled as a Gaussian random variable with zero mean and standard deviation $\\sigma = 0.015$.\n\nAssume the following:\n- Natural isotopic abundances (atomic fractional abundances) are: $^{13}\\text{C}$ has $p_{13} = 0.0109$, $^{17}\\text{O}$ has $p_{17} = 0.00038$, $^{18}\\text{O}$ has $p_{18} = 0.00205$, $^{33}\\text{S}$ has $p_{33} = 0.0075$, $^{34}\\text{S}$ has $p_{34} = 0.0421$, $^{37}\\text{Cl}$ has $p_{37} = 0.2423$ (so $^{35}\\text{Cl}$ is $1 - p_{37}$), and $^{81}\\text{Br}$ has $p_{81} = 0.4931$ (so $^{79}\\text{Br}$ is $1 - p_{81}$).\n- The population prior probabilities are: $\\mathbb{P}(\\text{no halogen}) = 0.60$ and $\\mathbb{P}(\\text{one halogen}) = 0.40$.\n- Conditional on “no halogen,” the composition is $90\\%$ $\\text{C}_{20}\\text{H}_{24}\\text{O}_{2}$ and $10\\%$ $\\text{C}_{14}\\text{H}_{10}\\text{S}$. Conditional on “one halogen,” the composition is $70\\%$ $\\text{C}_{20}\\text{H}_{24}\\text{O}_{2}\\text{Cl}$ (one chlorine) and $30\\%$ $\\text{C}_{14}\\text{H}_{10}\\text{Br}$ (one bromine).\n\nUse first-principles isotopic combinatorics and the binomial model for independent isotope substitutions to determine the expected true value $r_{\\text{true}}$ for each composition as follows:\n- For $\\text{C}_{20}\\text{H}_{24}\\text{O}_{2}$, include $M+2$ contributions from two $^{13}\\text{C}$ substitutions, one $^{18}\\text{O}$ substitution, two $^{17}\\text{O}$ substitutions, and the cross term of one $^{13}\\text{C}$ plus one $^{17}\\text{O}$. Neglect deuterium ($^{2}\\text{H}$) contributions.\n- For $\\text{C}_{14}\\text{H}_{10}\\text{S}$, include $M+2$ contributions from one $^{34}\\text{S}$ substitution, two $^{13}\\text{C}$ substitutions, and the cross term of one $^{13}\\text{C}$ plus one $^{33}\\text{S}$. Neglect deuterium contributions.\n- For molecules with one halogen atom, approximate $r_{\\text{true}}$ by the heavy halogen fraction alone: $r_{\\text{true}} \\approx p_{37}$ for one chlorine and $r_{\\text{true}} \\approx p_{81}$ for one bromine.\n\nAssume $r_{\\text{obs}} \\sim \\mathcal{N}(r_{\\text{true}}, \\sigma^{2})$. With the threshold rule $r_{\\text{obs}} \\geq 0.30$ for declaring halogen presence, compute the overall probability of decision error (the sum of the false positive probability weighted by the prior for “no halogen” and the false negative probability weighted by the prior for “one halogen”). Express your final answer as a single decimal number and round your answer to four significant figures.", "solution": "The objective is to compute the overall probability of a decision error, $P_E$. The total error is the sum of the probabilities of the two types of errors, weighted by their respective prior probabilities. The two types of errors are false positives (FP) and false negatives (FN).\n\nThe formula for the total probability of error is:\n$$P_E = \\mathbb{P}(\\text{FP}) \\cdot \\mathbb{P}(\\text{no halogen}) + \\mathbb{P}(\\text{FN}) \\cdot \\mathbb{P}(\\text{one halogen})$$\nFrom the problem statement, we have the prior probabilities: $\\mathbb{P}(\\text{no halogen}) = 0.60$ and $\\mathbb{P}(\\text{one halogen}) = 0.40$. The decision threshold is $T = 0.30$. An observation $r_{\\text{obs}}$ is modeled as a Gaussian random variable with mean equal to the true value $r_{\\text{true}}$ and standard deviation $\\sigma = 0.015$, i.e., $r_{\\text{obs}} \\sim \\mathcal{N}(r_{\\text{true}}, \\sigma^2)$.\n\nThe solution proceeds in three main steps:\n1.  Calculate the probability of a false positive, $\\mathbb{P}(\\text{FP})$.\n2.  Calculate the probability of a false negative, $\\mathbb{P}(\\text{FN})$.\n3.  Combine these results to determine the total error probability $P_E$.\n\n**1. False Positive Probability, $\\mathbb{P}(\\text{FP})$**\n\nA false positive occurs when the instrument declares a halogen is present for a molecule that contains no halogen. This corresponds to observing $r_{\\text{obs}} \\geq T$ when the sample is from the \"no halogen\" population. By the law of total probability, we consider the two compositions in the \"no halogen\" class:\n$$ \\mathbb{P}(\\text{FP}) = \\mathbb{P}(r_{\\text{obs}} \\geq T | \\text{no halogen}) = \\sum_{i \\in \\{\\text{no hal}\\}} \\mathbb{P}(r_{\\text{obs}} \\geq T | \\text{comp}_i) \\cdot \\mathbb{P}(\\text{comp}_i | \\text{no halogen}) $$\nThe \"no halogen\" population consists of $\\text{C}_{20}\\text{H}_{24}\\text{O}_{2}$ (with conditional probability $0.90$) and $\\text{C}_{14}\\text{H}_{10}\\text{S}$ (with conditional probability $0.10$). We first need to determine $r_{\\text{true}}$ for each of these molecules. The ratio $r_{\\text{true}}$ is defined as $r_{\\text{true}} = I_{M+2} / (I_M + I_{M+2})$. This can be calculated from the ratio of peak intensities $A_{M+2} = I_{M+2} / I_M$ as $r_{\\text{true}} = A_{M+2} / (1 + A_{M+2})$. The ratio $A_{M+2}$ is the sum of the relative probabilities of all isotopologue configurations that contribute to the $M+2$ peak.\n\nFor $\\text{C}_{20}\\text{H}_{24}\\text{O}_{2}$ ($N_C=20, N_O=2$):\nThe problem specifies the contributions to $A_{M+2}$. We use isotopic abundances $p_{13} = 0.0109$, $p_{17} = 0.00038$, $p_{18} = 0.00205$.\n$$ A_{M+2,1} = \\binom{20}{2}\\left(\\frac{p_{13}}{1-p_{13}}\\right)^2 + \\binom{2}{1}\\frac{p_{18}}{1-p_{\\text{O,heavy}}} + \\binom{2}{2}\\left(\\frac{p_{17}}{1-p_{\\text{O,heavy}}}\\right)^2 + \\binom{20}{1}\\frac{p_{13}}{1-p_{13}}\\binom{2}{1}\\frac{p_{17}}{1-p_{\\text{O,heavy}}} $$\nwhere $1-p_{\\text{O,heavy}} = 1 - p_{17} - p_{18} = 1 - 0.00038 - 0.00205 = 0.99757$.\n$$ A_{M+2,1} \\approx 0.023074 + 0.004110 + 1.45 \\times 10^{-7} + 0.000168 \\approx 0.027352 $$\nThus, $r_{\\text{true},1} = \\frac{0.027352}{1+0.027352} \\approx 0.026622$.\n\nFor $\\text{C}_{14}\\text{H}_{10}\\text{S}$ ($N_C=14, N_S=1$):\nWe use $p_{33}=0.0075$ and $p_{34}=0.0421$. $1-p_{\\text{S,heavy}} = 1-p_{33}-p_{34}=0.9504$.\n$$ A_{M+2,2} = \\binom{1}{1}\\frac{p_{34}}{1-p_{\\text{S,heavy}}} + \\binom{14}{2}\\left(\\frac{p_{13}}{1-p_{13}}\\right)^2 + \\binom{14}{1}\\frac{p_{13}}{1-p_{13}}\\binom{1}{1}\\frac{p_{33}}{1-p_{\\text{S,heavy}}} $$\n$$ A_{M+2,2} \\approx 0.044297 + 0.011051 + 0.001217 \\approx 0.056565 $$\nThus, $r_{\\text{true},2} = \\frac{0.056565}{1+0.056565} \\approx 0.053535$.\n\nNow we calculate the probability of a false positive for each compound. Let $\\Phi(z)$ be the CDF of the standard normal distribution.\n$$ \\mathbb{P}(r_{\\text{obs}} \\geq T | r_{\\text{true}}) = \\mathbb{P}\\left(Z \\geq \\frac{T-r_{\\text{true}}}{\\sigma}\\right) = 1 - \\Phi\\left(\\frac{T-r_{\\text{true}}}{\\sigma}\\right) $$\nwhere $Z \\sim \\mathcal{N}(0,1)$.\nFor $\\text{C}_{20}\\text{H}_{24}\\text{O}_{2}$: $z_1 = \\frac{0.30 - 0.026622}{0.015} \\approx 18.23$. $\\mathbb{P}(\\text{FP}_1) = 1 - \\Phi(18.23) \\approx 0$.\nFor $\\text{C}_{14}\\text{H}_{10}\\text{S}$: $z_2 = \\frac{0.30 - 0.053535}{0.015} \\approx 16.43$. $\\mathbb{P}(\\text{FP}_2) = 1 - \\Phi(16.43) \\approx 0$.\nThe probabilities of false positives are negligible for both non-halogenated compounds.\n$$ \\mathbb{P}(\\text{FP}) = (0.90) \\cdot \\mathbb{P}(\\text{FP}_1) + (0.10) \\cdot \\mathbb{P}(\\text{FP}_2) \\approx 0 $$\n\n**2. False Negative Probability, $\\mathbb{P}(\\text{FN})$**\n\nA false negative occurs when the instrument fails to declare a halogen is present for a molecule that contains one. This corresponds to observing $r_{\\text{obs}} < T$.\n$$ \\mathbb{P}(\\text{FN}) = \\mathbb{P}(r_{\\text{obs}} < T | \\text{one halogen}) = \\sum_{j \\in \\{\\text{one hal}\\}} \\mathbb{P}(r_{\\text{obs}} < T | \\text{comp}_j) \\cdot \\mathbb{P}(\\text{comp}_j | \\text{one halogen}) $$\nThe \"one halogen\" population consists of $\\text{C}_{20}\\text{H}_{24}\\text{O}_{2}\\text{Cl}$ ($70\\%$) and $\\text{C}_{14}\\text{H}_{10}\\text{Br}$ ($30\\%$). The problem instructs to approximate the true ratios $r_{\\text{true}}$ as the fractional abundance of the heavy halogen isotope.\nFor the chlorine compound: $r_{\\text{true},Cl} \\approx p_{37} = 0.2423$.\nFor the bromine compound: $r_{\\text{true},Br} \\approx p_{81} = 0.4931$.\n\nThe probability of a false negative for each halogenated compound is:\n$$ \\mathbb{P}(r_{\\text{obs}} < T | r_{\\text{true}}) = \\mathbb{P}\\left(Z < \\frac{T-r_{\\text{true}}}{\\sigma}\\right) = \\Phi\\left(\\frac{T-r_{\\text{true}}}{\\sigma}\\right) $$\nFor the chlorine compound:\n$z_{Cl} = \\frac{0.30 - 0.2423}{0.015} = \\frac{0.0577}{0.015} \\approx 3.8467$.\n$\\mathbb{P}(\\text{FN}_{Cl}) = \\Phi(3.8467) \\approx 0.9999403$.\nThe high probability is because the true ratio for chlorine ($0.2423$) is significantly below the detection threshold ($0.30$).\n\nFor the bromine compound:\n$z_{Br} = \\frac{0.30 - 0.4931}{0.015} = \\frac{-0.1931}{0.015} \\approx -12.873$.\n$\\mathbb{P}(\\text{FN}_{Br}) = \\Phi(-12.873) \\approx 0$.\nThe true ratio for bromine ($0.4931$) is far above the threshold, so a false negative is extremely unlikely.\n\nThe total false negative probability is the weighted sum:\n$$ \\mathbb{P}(\\text{FN}) = (0.70) \\cdot \\mathbb{P}(\\text{FN}_{Cl}) + (0.30) \\cdot \\mathbb{P}(\\text{FN}_{Br}) \\approx (0.70)(0.9999403) + (0.30)(0) = 0.69995821 $$\n\n**3. Total Error Probability, $P_E$**\n\nWe combine the results using the priors:\n$$P_E = \\mathbb{P}(\\text{FP}) \\cdot \\mathbb{P}(\\text{no halogen}) + \\mathbb{P}(\\text{FN}) \\cdot \\mathbb{P}(\\text{one halogen})$$\n$$P_E \\approx (0) \\cdot (0.60) + (0.69995821) \\cdot (0.40)$$\n$$P_E \\approx 0.279983284$$\nRounding the result to four significant figures gives $0.2800$.", "answer": "$$\\boxed{0.2800}$$", "id": "3709425"}, {"introduction": "Modern mass spectrometry often involves analyzing complex mixtures where the signals from different components overlap. This final hands-on practice transitions from theoretical calculation to computational modeling, tasking you with resolving a composite spectrum into its constituent parts [@problem_id:3709432]. You will construct a mathematical model based on the theoretical isotopic patterns of several candidate species and use a numerical optimization technique—non-negative least squares—to estimate the relative contribution of each species to an observed spectrum, a core skill in quantitative spectrometry and chemometrics.", "problem": "You are tasked with constructing a computational model for the isotopic pattern of halogenated organic compounds and estimating mixture compositions from overlapping peaks in High-Resolution Mass Spectrometry (HRMS). The scenario concerns isotopic pattern analysis of chlorine and bromine within the spectrometric identification of organic compounds. The key physical basis is that an experimental mass spectrum near the molecular ion consists of discrete peaks at mass-to-charge ratio (m/z) positions separated by $2$ unified atomic mass unit increments, corresponding to the presence of heavy isotopes $^{37}\\text{Cl}$ and $^{81}\\text{Br}$, and that intensities are additive across coexisting species.\n\nStart from the following fundamental and widely accepted facts:\n- Natural isotopic abundances of chlorine are $p^{\\text{Cl}}_{35} = 0.7578$ for $^{35}\\text{Cl}$ and $p^{\\text{Cl}}_{37} = 0.2422$ for $^{37}\\text{Cl}$.\n- Natural isotopic abundances of bromine are $p^{\\text{Br}}_{79} = 0.5069$ for $^{79}\\text{Br}$ and $p^{\\text{Br}}_{81} = 0.4931$ for $^{81}\\text{Br}$.\n- For a compound with $n$ chlorine atoms, the distribution over $k$ heavy $^{37}\\text{Cl}$ atoms at peak position $M+2k$ follows the binomial law with probability mass $\\binom{n}{k} \\left(p^{\\text{Cl}}_{37}\\right)^k \\left(p^{\\text{Cl}}_{35}\\right)^{n-k}$, and similarly for bromine.\n- For mixed halogen content, the pattern is given by discrete convolution of independent binomial distributions for chlorine and bromine counts, yielding peak probabilities that sum to $1$.\n\nConsider the following candidate species that can contribute to the spectrum, each with a maximum of $2$ halogen atoms:\n- Species $1$: monochloro, with $1$ chlorine and $0$ bromine.\n- Species $2$: monobromo, with $0$ chlorine and $1$ bromine.\n- Species $3$: dichloro, with $2$ chlorine and $0$ bromine.\n- Species $4$: dibromo, with $0$ chlorine and $2$ bromine.\n- Species $5$: chlorobromo, with $1$ chlorine and $1$ bromine.\n\nAssume a discrete spectrum represented by an intensity vector $\\mathbf{y}$ with $3$ bins corresponding to peaks at $M$, $M+2$, and $M+4$, and that each candidate species has a theoretical $3$-bin probability vector $\\mathbf{s}_i$ constructed from the above isotopic laws. Let the unknown nonnegative mixture weights be $\\mathbf{w} = [w_1,w_2,w_3,w_4,w_5]^\\top$, representing the contribution of the five candidate species, and assume additive superposition, i.e., the observed intensity vector satisfies $\\mathbf{y} \\approx \\sum_{i=1}^{5} w_i \\mathbf{s}_i$.\n\nYour task is to write a program that:\n- Builds the $3 \\times 5$ design matrix $\\mathbf{A}$ whose columns are the theoretical patterns $\\mathbf{s}_i$ for the five species in the order given above.\n- For each provided test case, solves the nonnegative least squares problem to estimate $\\mathbf{w}$:\n  $$\\min_{\\mathbf{w} \\ge 0} \\left\\| \\mathbf{A}\\mathbf{w} - \\mathbf{y} \\right\\|_2^2,$$\n  then normalizes the solution to obtain mixture fractions:\n  $$\\tilde{\\mathbf{w}} = \\frac{\\mathbf{w}}{\\sum_{i=1}^{5} w_i},$$\n  with the convention that if $\\sum_{i=1}^{5} w_i = 0$ then $\\tilde{\\mathbf{w}}$ is the zero vector.\n- Returns the estimated mixture fractions $\\tilde{\\mathbf{w}}$ rounded to $6$ decimal places.\n\nAll intensity values are unitless decimal fractions and must be treated and reported as such. Angles do not appear in this problem; no angle units are needed. The isotopic patterns must be derived from the stated natural abundances and the independence of isotopic substitutions. Do not use any shortcut formulas beyond the fundamental binomial and convolution principles.\n\nTest suite:\n- Test case $1$ (happy path; overlapping monochloro and monobromo):\n  $$\\mathbf{y}_1 = [\\,0.65744,\\,0.34256,\\,0\\,].$$\n- Test case $2$ (boundary; pure dibromo):\n  $$\\mathbf{y}_2 = [\\,0.25694761,\\,0.49990478,\\,0.24314761\\,].$$\n- Test case $3$ (identifiability stress; equal mixture of dichloro and chlorobromo):\n  $$\\mathbf{y}_3 = [\\,0.47919483,\\,0.43176034,\\,0.08904483\\,].$$\n- Test case $4$ (edge; pure monochloro):\n  $$\\mathbf{y}_4 = [\\,0.7578,\\,0.2422,\\,0\\,].$$\n\nAnswer specification:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the test cases, where each result is itself a list of $5$ floats representing the estimated mixture fractions $\\tilde{\\mathbf{w}}$ for species $[\\,\\text{monochloro},\\,\\text{monobromo},\\,\\text{dichloro},\\,\\text{dibromo},\\,\\text{chlorobromo}\\,]$, rounded to $6$ decimal places. For example, an output could look like:\n  $$[\\, [\\,a_1,a_2,a_3,a_4,a_5\\,], [\\,b_1,b_2,b_3,b_4,b_5\\,], [\\,c_1,c_2,c_3,c_4,c_5\\,], [\\,d_1,d_2,d_3,d_4,d_5\\,] \\,],$$\n  where $a_i$, $b_i$, $c_i$, and $d_i$ are decimal fractions.", "solution": "The problem requires the estimation of mixture fractions for five halogenated organic species from a given low-dimensional mass spectrum. The solution involves constructing a linear model based on theoretical isotopic patterns and then solving a constrained optimization problem.\n\nThe fundamental scientific principles are the binomial distributions of isotopes in molecules containing multiple atoms of the same halogen, and the convolution of these distributions for molecules containing different halogens. Let $p^{\\text{Cl}}_{37} = 0.2422$ be the natural abundance of the heavy chlorine isotope $^{37}\\text{Cl}$, and $p^{\\text{Br}}_{81} = 0.4931$ be the abundance of the heavy bromine isotope $^{81}\\text{Br}$. The corresponding light isotope abundances are $p^{\\text{Cl}}_{35} = 1 - p^{\\text{Cl}}_{37} = 0.7578$ and $p^{\\text{Br}}_{79} = 1 - p^{\\text{Br}}_{81} = 0.5069$.\n\nA molecule with $n_{\\text{Cl}}$ chlorine atoms and $n_{\\text{Br}}$ bromine atoms will exhibit a cluster of isotopic peaks. The experimental spectrum is simplified to 3 intensity bins corresponding to the molecular ion ($M$), $M+2$, and $M+4$. These correspond to having $k=0$, $k=1$, and $k=2$ heavy isotopes ($^{37}\\text{Cl}$ or $^{81}\\text{Br}$), respectively. For each species $i$, we must compute its theoretical $3$-element probability vector $\\mathbf{s}_i = [P(k=0), P(k=1), P(k=2)]^\\top$.\n\nThe probability of having $k_{\\text{Cl}}$ heavy $^{37}\\text{Cl}$ isotopes among $n_{\\text{Cl}}$ total chlorine atoms follows the binomial law:\n$$P(k_{\\text{Cl}}; n_{\\text{Cl}}) = \\binom{n_{\\text{Cl}}}{k_{\\text{Cl}}} (p^{\\text{Cl}}_{37})^{k_{\\text{Cl}}} (p^{\\text{Cl}}_{35})^{n_{\\text{Cl}}-k_{\\text{Cl}}}$$\nA similar formula applies for bromine. For a mixed-halogen species, the probability of a total of $k$ heavy isotopes is given by the discrete convolution of the individual binomial distributions:\n$$P(k; n_{\\text{Cl}}, n_{\\text{Br}}) = \\sum_{j=0}^{k} P(j; n_{\\text{Cl}}) \\cdot P(k-j; n_{\\text{Br}})$$\n\nWe now compute the pattern vector $\\mathbf{s}_i$ for each of the five candidate species.\n\n1.  **Species 1: monochloro** ($n_{\\text{Cl}}=1, n_{\\text{Br}}=0$)\n    $P(k=0) = \\binom{1}{0}(p^{\\text{Cl}}_{37})^0(p^{\\text{Cl}}_{35})^1 = 0.7578$\n    $P(k=1) = \\binom{1}{1}(p^{\\text{Cl}}_{37})^1(p^{\\text{Cl}}_{35})^0 = 0.2422$\n    $P(k=2) = 0$\n    $\\mathbf{s}_1 = [0.7578, 0.2422, 0]^\\top$\n\n2.  **Species 2: monobromo** ($n_{\\text{Cl}}=0, n_{\\text{Br}}=1$)\n    $P(k=0) = \\binom{1}{0}(p^{\\text{Br}}_{81})^0(p^{\\text{Br}}_{79})^1 = 0.5069$\n    $P(k=1) = \\binom{1}{1}(p^{\\text{Br}}_{81})^1(p^{\\text{Br}}_{79})^0 = 0.4931$\n    $P(k=2) = 0$\n    $\\mathbf{s}_2 = [0.5069, 0.4931, 0]^\\top$\n\n3.  **Species 3: dichloro** ($n_{\\text{Cl}}=2, n_{\\text{Br}}=0$)\n    $P(k=0) = \\binom{2}{0}(p^{\\text{Cl}}_{37})^0(p^{\\text{Cl}}_{35})^2 = (0.7578)^2 = 0.57426084$\n    $P(k=1) = \\binom{2}{1}(p^{\\text{Cl}}_{37})^1(p^{\\text{Cl}}_{35})^1 = 2(0.2422)(0.7578) = 0.36706752$\n    $P(k=2) = \\binom{2}{2}(p^{\\text{Cl}}_{37})^2(p^{\\text{Cl}}_{35})^0 = (0.2422)^2 = 0.05866084$\n    $\\mathbf{s}_3 = [0.57426084, 0.36706752, 0.05866084]^\\top$\n\n4.  **Species 4: dibromo** ($n_{\\text{Cl}}=0, n_{\\text{Br}}=2$)\n    $P(k=0) = \\binom{2}{0}(p^{\\text{Br}}_{81})^0(p^{\\text{Br}}_{79})^2 = (0.5069)^2 = 0.25694761$\n    $P(k=1) = \\binom{2}{1}(p^{\\text{Br}}_{81})^1(p^{\\text{Br}}_{79})^1 = 2(0.4931)(0.5069) = 0.49990478$\n    $P(k=2) = \\binom{2}{2}(p^{\\text{Br}}_{81})^2(p^{\\text{Br}}_{79})^0 = (0.4931)^2 = 0.24314761$\n    $\\mathbf{s}_4 = [0.25694761, 0.49990478, 0.24314761]^\\top$\n\n5.  **Species 5: chlorobromo** ($n_{\\text{Cl}}=1, n_{\\text{Br}}=1$)\n    We apply the convolution formula:\n    $P(k=0) = P(0; n_{\\text{Cl}}=1)P(0; n_{\\text{Br}}=1) = p^{\\text{Cl}}_{35} \\cdot p^{\\text{Br}}_{79} = 0.7578 \\cdot 0.5069 = 0.38416302$\n    $P(k=1) = P(1; n_{\\text{Cl}}=1)P(0; n_{\\text{Br}}=1) + P(0; n_{\\text{Cl}}=1)P(1; n_{\\text{Br}}=1) = p^{\\text{Cl}}_{37} \\cdot p^{\\text{Br}}_{79} + p^{\\text{Cl}}_{35} \\cdot p^{\\text{Br}}_{81} = 0.2422 \\cdot 0.5069 + 0.7578 \\cdot 0.4931 = 0.49645656$\n    $P(k=2) = P(1; n_{\\text{Cl}}=1)P(1; n_{\\text{Br}}=1) = p^{\\text{Cl}}_{37} \\cdot p^{\\text{Br}}_{81} = 0.2422 \\cdot 0.4931 = 0.11943622$\n    $\\mathbf{s}_5 = [0.38416302, 0.49645656, 0.11943622]^\\top$\n\nThese five vectors form the columns of the $3 \\times 5$ design matrix $\\mathbf{A} = [\\mathbf{s}_1, \\mathbf{s}_2, \\mathbf{s}_3, \\mathbf{s}_4, \\mathbf{s}_5]$. The observed intensity vector $\\mathbf{y}$ is modeled as a linear combination of these patterns: $\\mathbf{y} \\approx \\mathbf{A}\\mathbf{w}$, where $\\mathbf{w} = [w_1, w_2, w_3, w_4, w_5]^\\top$ is the vector of nonnegative weights.\n\nTo estimate $\\mathbf{w}$ from a given $\\mathbf{y}$, we solve the nonnegative least squares (NNLS) problem:\n$$\\min_{\\mathbf{w} \\ge 0} \\left\\| \\mathbf{A}\\mathbf{w} - \\mathbf{y} \\right\\|_2^2$$\nThis is a standard convex optimization problem, and its solution provides the estimated absolute contributions $w_i$.\n\nFinally, the weights are normalized to obtain the relative mixture fractions $\\tilde{\\mathbf{w}}$:\n$$\\tilde{\\mathbf{w}} = \\frac{\\mathbf{w}}{\\sum_{i=1}^{5} w_i}$$\nIf the sum of weights is zero (i.e., $\\mathbf{w}=\\mathbf{0}$), the normalized vector $\\tilde{\\mathbf{w}}$ is the zero vector. The components of the resulting vector are then rounded to $6$ decimal places. This entire procedure is implemented computationally for each provided test case.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import nnls\n\ndef solve():\n    \"\"\"\n    Constructs the theoretical isotopic patterns for halogenated compounds,\n    and solves for mixture compositions from test spectra using non-negative\n    least squares.\n    \"\"\"\n\n    # Define the natural isotopic abundances as per the problem statement.\n    p_cl35 = 0.7578\n    p_cl37 = 0.2422\n    p_br79 = 0.5069\n    p_br81 = 0.4931\n\n    # --- Step 1: Build the design matrix A ---\n\n    # Each column s_i of A is the theoretical 3-bin isotopic pattern for a species.\n    # The bins correspond to M, M+2, M+4 (0, 1, or 2 heavy isotopes).\n\n    # s_1: monochloro (1 Cl, 0 Br)\n    s1 = np.array([\n        p_cl35,  # k=0: 35Cl\n        p_cl37,  # k=1: 37Cl\n        0.0      # k=2\n    ])\n\n    # s_2: monobromo (0 Cl, 1 Br)\n    s2 = np.array([\n        p_br79,  # k=0: 79Br\n        p_br81,  # k=1: 81Br\n        0.0      # k=2\n    ])\n\n    # s_3: dichloro (2 Cl, 0 Br)\n    s3 = np.array([\n        p_cl35**2,                    # k=0: 35Cl, 35Cl\n        2 * p_cl35 * p_cl37,          # k=1: 35Cl, 37Cl\n        p_cl37**2                     # k=2: 37Cl, 37Cl\n    ])\n\n    # s_4: dibromo (0 Cl, 2 Br)\n    s4 = np.array([\n        p_br79**2,                    # k=0: 79Br, 79Br\n        2 * p_br79 * p_br81,          # k=1: 79Br, 81Br\n        p_br81**2                     # k=2: 81Br, 81Br\n    ])\n\n    # s_5: chlorobromo (1 Cl, 1 Br) - discrete convolution\n    s5 = np.array([\n        p_cl35 * p_br79,              # k=0: (35Cl, 79Br)\n        p_cl37 * p_br79 + p_cl35 * p_br81,  # k=1: (37Cl, 79Br) or (35Cl, 81Br)\n        p_cl37 * p_br81               # k=2: (37Cl, 81Br)\n    ])\n\n    # The 3x5 design matrix A\n    A = np.stack([s1, s2, s3, s4, s5], axis=1)\n\n    # --- Step 2: Define test cases ---\n    test_cases = [\n        np.array([0.65744, 0.34256, 0]),\n        np.array([0.25694761, 0.49990478, 0.24314761]),\n        np.array([0.47919483, 0.43176034, 0.08904483]),\n        np.array([0.7578, 0.2422, 0])\n    ]\n\n    results = []\n    # --- Step 3: Solve for each test case ---\n    for y in test_cases:\n        # Solve the nonnegative least squares problem: min ||Ax - y||_2^2 for x >= 0\n        w, _ = nnls(A, y)\n\n        # Normalize the weights to get mixture fractions\n        w_sum = np.sum(w)\n        if w_sum > 0:\n            w_tilde = w / w_sum\n        else:\n            w_tilde = np.zeros_like(w)\n\n        # Round to 6 decimal places and store as a list\n        w_rounded = np.round(w_tilde, 6)\n        results.append(list(w_rounded))\n\n    # Final print statement in the exact required format.\n    # str() of a list of lists matches the desired output style.\n    print(str(results).replace(\"],\", \"], \"))\n\nsolve()\n```", "id": "3709432"}]}