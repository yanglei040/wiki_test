{"hands_on_practices": [{"introduction": "To appreciate the innovation of the dynamic procedure, we must first understand the limitations of its predecessor. This practice explores a classic scenario—laminar shear flow—where the standard Smagorinsky model with a constant coefficient incorrectly predicts subgrid-scale turbulence. By working through this example [@problem_id:3373067], you will see firsthand why the dynamic procedure is essential for creating a model that can automatically \"turn off\" in non-turbulent regions.", "problem": "Consider a Large-Eddy Simulation (LES) of an incompressible, laminar simple shear flow with filtered velocity field given by $\\bar{\\mathbf{u}}(x,y,z) = (G y,\\, 0,\\, 0)$, where $G$ is a constant shear rate. The LES applies a spatial filter of width $\\Delta$ and models the deviatoric subgrid-scale (SGS) stress via an eddy-viscosity closure. \n\nStarting from the definitions and laws below, perform the following:\n1. Using the kinematic definition of the filtered strain-rate tensor $S_{ij}$ for an incompressible flow, compute the scalar magnitude $|\\bar{S}|$ in terms of $G$ only, where the magnitude is defined by $|\\bar{S}| = \\left(2\\,\\bar{S}_{ij}\\,\\bar{S}_{ij}\\right)^{1/2}$.\n2. Using the eddy-viscosity closure $\\tau^{\\mathrm{SGS}}_{ij} - \\frac{1}{3}\\,\\tau^{\\mathrm{SGS}}_{kk}\\,\\delta_{ij} = -2\\,\\nu_{t}\\,\\bar{S}_{ij}$ and the Smagorinsky hypothesis $\\nu_{t} = \\left(C_{S}\\,\\Delta\\right)^{2}\\,|\\bar{S}|$ with constant model coefficient $C_{S}$, reason from first principles why this constant-$C_{S}$ closure predicts nonzero SGS dissipation even as the grid is refined (i.e., as $\\Delta \\to 0$), despite the flow being exactly laminar and fully resolved. Then, starting from the Germano identity central to the dynamic Smagorinsky procedure, explain why the dynamically computed $C_{S}^{2}$ vanishes for this flow.\n\nUse only the following foundational elements as your starting point:\n- The incompressible filtered continuity equation $\\partial \\bar{u}_{i}/\\partial x_{i} = 0$.\n- The filtered strain-rate definition $\\bar{S}_{ij} = \\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_{i}}{\\partial x_{j}} + \\frac{\\partial \\bar{u}_{j}}{\\partial x_{i}}\\right)$.\n- The deviatoric SGS closure $\\tau^{\\mathrm{SGS}}_{ij} - \\frac{1}{3}\\,\\tau^{\\mathrm{SGS}}_{kk}\\,\\delta_{ij} = -2\\,\\nu_{t}\\,\\bar{S}_{ij}$ with $\\nu_{t} = \\left(C_{S}\\,\\Delta\\right)^{2}\\,|\\bar{S}|$.\n- The Germano identity, which states $L_{ij} = T_{ij} - \\tilde{\\tau}_{ij}$, where $L_{ij} = \\widetilde{\\bar{u}_i \\bar{u}_j} - \\tilde{\\bar{u}}_i \\tilde{\\bar{u}}_j$ is the computable Leonard stress, and $\\tau_{ij}$ and $T_{ij}$ are the subgrid-scale stresses at the grid and test filter levels, respectively.\n\nReport the value of $|\\bar{S}|$ as a single algebraic expression in terms of $G$ only. No numerical evaluation is required. If you introduce any physical units in your reasoning, state them explicitly in standard International System of Units (SI), but the final reported expression must be unitless as written in terms of $G$ alone.", "solution": "The problem requires a two-part analysis of the Smagorinsky subgrid-scale (SGS) model for a given incompressible, laminar simple shear flow. First, we compute the magnitude of the filtered strain-rate tensor. Second, we analyze the behavior of the constant-coefficient and dynamic Smagorinsky models for this flow.\n\n**Part 1: Computation of the Filtered Strain-Rate Magnitude $|\\bar{S}|$**\n\nThe problem provides the filtered velocity field $\\bar{\\mathbf{u}}$ with components in a Cartesian coordinate system $(x_1, x_2, x_3) = (x, y, z)$ as:\n$$\n\\bar{u}_1 = G y = G x_2 \\\\\n\\bar{u}_2 = 0 \\\\\n\\bar{u}_3 = 0\n$$\nwhere $G$ is the constant shear rate.\n\nThe filtered strain-rate tensor $\\bar{S}_{ij}$ is defined as:\n$$\n\\bar{S}_{ij} = \\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_{i}}{\\partial x_{j}} + \\frac{\\partial \\bar{u}_{j}}{\\partial x_{i}}\\right)\n$$\nWe compute the components of this tensor. The only non-zero partial derivative of the velocity components is $\\frac{\\partial \\bar{u}_1}{\\partial x_2} = G$. All other derivatives, such as $\\frac{\\partial \\bar{u}_1}{\\partial x_1}$, $\\frac{\\partial \\bar{u}_1}{\\partial x_3}$, $\\frac{\\partial \\bar{u}_2}{\\partial x_j}$, and $\\frac{\\partial \\bar{u}_3}{\\partial x_j}$, are zero.\n\nThe diagonal components of $\\bar{S}_{ij}$ are:\n$$\n\\bar{S}_{11} = \\frac{\\partial \\bar{u}_1}{\\partial x_1} = 0 \\\\\n\\bar{S}_{22} = \\frac{\\partial \\bar{u}_2}{\\partial x_2} = 0 \\\\\n\\bar{S}_{33} = \\frac{\\partial \\bar{u}_3}{\\partial x_3} = 0\n$$\nThe off-diagonal components are:\n$$\n\\bar{S}_{12} = \\bar{S}_{21} = \\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_1}{\\partial x_2} + \\frac{\\partial \\bar{u}_2}{\\partial x_1}\\right) = \\frac{1}{2}(G + 0) = \\frac{G}{2} \\\\\n\\bar{S}_{13} = \\bar{S}_{31} = \\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_1}{\\partial x_3} + \\frac{\\partial \\bar{u}_3}{\\partial x_1}\\right) = \\frac{1}{2}(0 + 0) = 0 \\\\\n\\bar{S}_{23} = \\bar{S}_{32} = \\frac{1}{2}\\left(\\frac{\\partial \\bar{u}_2}{\\partial x_3} + \\frac{\\partial \\bar{u}_3}{\\partial x_2}\\right) = \\frac{1}{2}(0 + 0) = 0\n$$\nThus, the filtered strain-rate tensor in matrix form is:\n$$\n\\bar{S}_{ij} =\n\\begin{pmatrix}\n0 & \\frac{G}{2} & 0 \\\\\n\\frac{G}{2} & 0 & 0 \\\\\n0 & 0 & 0\n\\end{pmatrix}\n$$\nThe magnitude of the filtered strain-rate tensor is defined as $|\\bar{S}| = (2\\,\\bar{S}_{ij}\\,\\bar{S}_{ij})^{1/2}$, where summation over repeated indices is implied.\nFirst, we compute the product $\\bar{S}_{ij}\\,\\bar{S}_{ij}$:\n$$\n\\bar{S}_{ij}\\,\\bar{S}_{ij} = \\sum_{i=1}^3 \\sum_{j=1}^3 (\\bar{S}_{ij})^2 = (\\bar{S}_{12})^2 + (\\bar{S}_{21})^2 = \\left(\\frac{G}{2}\\right)^2 + \\left(\\frac{G}{2}\\right)^2 = \\frac{G^2}{4} + \\frac{G^2}{4} = \\frac{G^2}{2}\n$$\nNow, we substitute this result into the definition of $|\\bar{S}|$:\n$$\n|\\bar{S}| = \\left(2 \\cdot \\frac{G^2}{2}\\right)^{1/2} = \\left(G^2\\right)^{1/2} = |G|\n$$\nSince the problem asks for the expression in terms of $G$ only, and shear rate is a scalar that can be positive or negative, the most accurate form is $|G|$.\n\n**Part 2: Analysis of the Smagorinsky Closure**\n\n**Failure of the Constant-Coefficient Smagorinsky Model:**\nThe standard Smagorinsky model proposes an eddy viscosity $\\nu_t$ given by:\n$$\n\\nu_t = (C_S \\Delta)^2 |\\bar{S}|\n$$\nwhere $C_S$ is a constant and $\\Delta$ is the filter width. The deviatoric SGS stress is then modeled as:\n$$\n\\tau^{\\mathrm{SGS}}_{ij} - \\frac{1}{3}\\tau^{\\mathrm{SGS}}_{kk}\\delta_{ij} = -2 \\nu_t \\bar{S}_{ij}\n$$\nThe rate of SGS dissipation of kinetic energy is $\\epsilon_{\\mathrm{SGS}} = -(\\tau^{\\mathrm{SGS}}_{ij} - \\frac{1}{3}\\tau^{\\mathrm{SGS}}_{kk}\\delta_{ij})\\bar{S}_{ij} = 2 \\nu_t \\bar{S}_{ij}\\bar{S}_{ij}$.\nFor the given flow, we found $|\\bar{S}| = |G|$. Substituting this into the model for $\\nu_t$:\n$$\n\\nu_t = (C_S \\Delta)^2 |G|\n$$\nSince $C_S$ is a non-zero constant in this formulation, $\\Delta > 0$, and we assume a non-trivial shear flow ($G \\neq 0$), the model predicts a non-zero eddy viscosity $\\nu_t \\neq 0$. This, in turn, leads to a non-zero deviatoric SGS stress and a non-zero SGS dissipation rate:\n$$\n\\epsilon_{\\mathrm{SGS}} = 2 \\left((C_S \\Delta)^2 |G|\\right) \\left(\\frac{G^2}{2}\\right) = (C_S \\Delta)^2 |G| G^2 = C_S^2 \\Delta^2 |G|^3\n$$\nThe fundamental flaw is that the original flow is specified as *laminar*. In a laminar flow, there are no turbulent fluctuations, and therefore the SGS stress tensor MUST be zero. The constant-coefficient Smagorinsky model is solely dependent on the magnitude of the *resolved* strain rate, $|\\bar{S}|$. Since a simple shear flow has a non-zero mean strain rate, the model incorrectly predicts the existence of subgrid-scale turbulence and spuriously removes energy from the resolved flow field. The model cannot distinguish between a turbulent flow with mean shear and a simple laminar shear. Even as the grid is refined ($\\Delta \\to 0$), for any finite $\\Delta$, the model predicts spurious dissipation, although this dissipation does correctly tend to zero in the limit.\n\n**Success of the Dynamic Smagorinsky Procedure:**\nThe dynamic procedure remedies this flaw by computing $C_S$ based on the flow information available at two different filter scales: the grid filter (width $\\Delta$, denoted by $\\bar{\\cdot}$) and a test filter (width $\\tilde{\\Delta} > \\Delta$, denoted by $\\tilde{\\cdot}$). The procedure is derived from the Germano identity, which relates the stresses at these two scales:\n$$\nL_{ij} = T_{ij} - \\widetilde{\\tau_{ij}}\n$$\nwhere $L_{ij} = \\widetilde{\\bar{u}_i \\bar{u}_j} - \\tilde{\\bar{u}}_i \\tilde{\\bar{u}}_j$ is the Leonard stress (computable from the resolved field $\\bar{u}_i$), $T_{ij} = \\widetilde{\\overline{u_i u_j}} - \\tilde{\\bar{u}}_i \\tilde{\\bar{u}}_j$ is the sub-test-scale stress, and $\\tau_{ij} = \\overline{u_i u_j} - \\bar{u}_i \\bar{u}_j$ is the sub-grid scale stress.\n\nBy modeling the deviatoric parts of $\\tau_{ij}$ and $T_{ij}$ with the Smagorinsky closure and assuming $C_S$ is constant between the filter levels, one arrives at the relation $L_{ij}^{\\text{dev}} = C_S^2 M_{ij}$, where $L_{ij}^{\\text{dev}}$ is the deviatoric part of the Leonard stress tensor and $M_{ij}$ is a tensor also computable from the filtered velocity field:\n$$\nM_{ij} = 2\\Delta^2 \\widetilde{|\\bar{S}|\\bar{S}_{ij}} - 2\\tilde{\\Delta}^2 |\\tilde{\\bar{S}}|\\tilde{\\bar{S}}_{ij}\n$$\n$C_S^2$ is then found by minimizing the error in this relation, typically via least squares: $C_S^2 = \\frac{L_{ij}^{\\text{dev}} M_{ij}}{M_{kl} M_{kl}}$.\n\nLet's analyze $L_{ij}$ and $M_{ij}$ for the given flow $\\bar{u}_1 = Gx_2$. We assume standard filters that do not alter functions linear in the coordinates, so $\\tilde{\\bar{u}}_1 = \\widetilde{Gx_2} = Gx_2 = \\bar{u}_1$. However, filtering does affect non-linear terms.\nThe only non-zero term in the product $\\bar{u}_i \\bar{u}_j$ is $\\bar{u}_1\\bar{u}_1 = (Gx_2)^2$. Applying the test filter to this quadratic term gives $\\widetilde{(Gx_2)^2} = (Gx_2)^2 + C$ for some constant $C$ that depends on the filter shape and width $\\tilde{\\Delta}$ (e.g., $C = G^2\\tilde{\\Delta}^2/12$ for a 1D box filter).\nThe Leonard stress components are:\n$$\nL_{11} = \\widetilde{\\bar{u}_1 \\bar{u}_1} - \\tilde{\\bar{u}}_1 \\tilde{\\bar{u}}_1 = ((Gx_2)^2 + C) - (Gx_2)^2 = C\n$$\nAll other components $L_{ij}$ are zero, as they involve products like $\\bar{u}_1\\bar{u}_2=0$. Therefore, $L_{ij}$ is a diagonal tensor. Consequently, its deviatoric part, $L_{ij}^{\\text{dev}} = L_{ij} - \\frac{1}{3}L_{kk}\\delta_{ij}$, is also a diagonal tensor.\n\nNow, let's analyze $M_{ij}$. Since $\\tilde{\\bar{u}}_i = \\bar{u}_i$, the strain-rate tensors are also identical: $\\tilde{\\bar{S}}_{ij} = \\bar{S}_{ij}$, and so are their magnitudes: $|\\tilde{\\bar{S}}| = |\\bar{S}| = |G|$. The term $|\\bar{S}|\\bar{S}_{ij}$ is a constant tensor field. Filtering a constant field yields the constant itself, so $\\widetilde{|\\bar{S}|\\bar{S}_{ij}} = |\\bar{S}|\\bar{S}_{ij}$.\nSubstituting these into the expression for $M_{ij}$:\n$$\nM_{ij} = (2\\Delta^2 - 2\\tilde{\\Delta}^2)|\\bar{S}|\\bar{S}_{ij}\n$$\nThis shows that $M_{ij}$ is directly proportional to $\\bar{S}_{ij}$. As we found in Part 1, $\\bar{S}_{ij}$ is a purely off-diagonal tensor.\n\nFinally, we compute $C_S^2$ from the numerator $L_{ij}^{\\text{dev}} M_{ij}$. This is the contracted product (inner product) of a diagonal tensor ($L_{ij}^{\\text{dev}}$) and a purely off-diagonal tensor ($M_{ij}$). Such a product is identically zero:\n$$\nL_{ij}^{\\text{dev}} M_{ij} = \\sum_{i,j} L_{ij}^{\\text{dev}} M_{ij} = 0\n$$\nThe denominator $M_{kl}M_{kl}$ is proportional to $\\bar{S}_{kl}\\bar{S}_{kl} = G^2/2$, which is non-zero.\nTherefore, the dynamically computed coefficient is:\n$$\nC_S^2 = \\frac{0}{\\text{non-zero}} = 0\n$$\nThe dynamic procedure correctly determines that for this laminar flow, the model coefficient must be zero, which in turn means $\\nu_t = 0$ and the spurious SGS dissipation is eliminated. The model correctly \"turns itself off.\"", "answer": "$$\n\\boxed{|G|}\n$$", "id": "3373067"}, {"introduction": "The elegance of the Germano identity rests on the assumption that filtering and differentiation are interchangeable operations. In the continuous world this holds, but in the discrete world of computational fluid dynamics, it can fail. This practice [@problem_id:3373076] challenges you to compute the \"commutation error\" for a specific set of discrete operators near a solid boundary, revealing a subtle but significant source of inaccuracy in the dynamic procedure.", "problem": "Consider a one-dimensional, incompressible Large-Eddy Simulation (LES) on a uniform grid of spacing $h$, with grid points $x_j = j h$ for integer $j \\geq 0$, and a no-penetration wall at $x_0 = 0$. Let the resolved velocity component be $u(x,t)$, and consider the filtered incompressible Navier–Stokes equations as the fundamental base, in which the resolved field arises from application of a grid filter and the Subgrid-Scale (SGS) stress results from the interaction of unresolved scales. The dynamic Smagorinsky procedure constructs a test-filtered system to infer a local model coefficient using the Germano identity, which assumes that the test filter commutes with spatial differentiation.\n\nIn this problem, you will provide and analyze a concrete counterexample on a uniform grid showing non-commutation between a discrete box test filter and the underlying discrete differentiation operator near a solid boundary. Specifically, define the discrete test filter $\\mathcal{F}$ acting on a grid function $v_j = v(x_j)$ by\n- interior filter for $j \\geq 1$: $\\mathcal{F}[v]_j = \\frac{1}{3}\\left(v_{j-1} + v_j + v_{j+1}\\right)$,\n- boundary filter at $j = 0$: $\\mathcal{F}[v]_0 = \\frac{1}{2}\\left(v_0 + v_1\\right)$,\nand define the discrete differentiation operator $D$ acting on $v_j$ by\n- interior second-order central difference for $j \\geq 1$: $D[v]_j = \\frac{v_{j+1} - v_{j-1}}{2 h}$,\n- boundary second-order one-sided forward difference at $j = 0$: $D[v]_0 = \\frac{-3 v_0 + 4 v_1 - v_2}{2 h}$.\n\nLet the resolved field be the exact analytic function $u(x) = \\exp(\\lambda x)$ with constant $\\lambda > 0$. Using the above operators, compute the commutator of the test filter and the differentiation operator at the first interior node $x_1$, namely\n$$\n\\left[\\mathcal{F}, D\\right]u\\,\\big|_{x_1} \\equiv \\mathcal{F}\\!\\left[D[u]\\right]_1 - D\\!\\left[\\mathcal{F}[u]\\right]_1,\n$$\nand express your final result as a closed-form analytic expression in terms of $h$ and $\\lambda$. Then, explain how the nonzero value of this commutator impacts the exactness of the Germano identity used in the dynamic Smagorinsky procedure, with particular emphasis on why non-commutation introduces an additional term in the identity near boundaries.\n\nExpress the final commutator value as a single closed-form analytic expression. No rounding is required.", "solution": "The core of the problem is to compute the commutator of a discrete test filter $\\mathcal{F}$ and a discrete differentiation operator $D$ at the first interior grid point $x_1$. The commutator is defined as $[\\mathcal{F}, D]u\\,\\big|_{x_1} = \\mathcal{F}[D[u]]_1 - D[\\mathcal{F}[u]]_1$.\n\nThe grid points are given by $x_j = j h$ for $j \\geq 0$. The velocity field is given by the function $u(x) = \\exp(\\lambda x)$, so its value on the discrete grid is $u_j = u(x_j) = \\exp(\\lambda j h)$.\n\nThe computation is performed in two parts.\n\nFirst, we compute the term $\\mathcal{F}[D[u]]_1$.\nThe filter operator at the first interior node, $j=1$, is $\\mathcal{F}[v]_1 = \\frac{1}{3}(v_0 + v_1 + v_2)$. To evaluate this for the field $v = D[u]$, we need to compute $D[u]_0$, $D[u]_1$, and $D[u]_2$.\n\nThe differentiation operator $D$ is defined differently at the boundary ($j=0$) and in the interior ($j \\geq 1$).\nAt the boundary ($j=0$):\n$$\nD[u]_0 = \\frac{-3 u_0 + 4 u_1 - u_2}{2 h} = \\frac{-3 \\exp(0) + 4 \\exp(\\lambda h) - \\exp(2\\lambda h)}{2 h} = \\frac{-3 + 4 \\exp(\\lambda h) - \\exp(2\\lambda h)}{2 h}\n$$\nAt the first interior point ($j=1$):\n$$\nD[u]_1 = \\frac{u_2 - u_0}{2 h} = \\frac{\\exp(2\\lambda h) - \\exp(0)}{2 h} = \\frac{\\exp(2\\lambda h) - 1}{2 h}\n$$\nAt the second interior point ($j=2$):\n$$\nD[u]_2 = \\frac{u_3 - u_1}{2 h} = \\frac{\\exp(3\\lambda h) - \\exp(\\lambda h)}{2 h}\n$$\nNow, we apply the filter $\\mathcal{F}$ at $j=1$:\n$$\n\\mathcal{F}[D[u]]_1 = \\frac{1}{3}\\left(D[u]_0 + D[u]_1 + D[u]_2\\right)\n$$\n$$\n\\mathcal{F}[D[u]]_1 = \\frac{1}{3} \\left[ \\frac{-3 + 4 \\exp(\\lambda h) - \\exp(2\\lambda h)}{2 h} + \\frac{\\exp(2\\lambda h) - 1}{2 h} + \\frac{\\exp(3\\lambda h) - \\exp(\\lambda h)}{2 h} \\right]\n$$\nCombining the terms over the common denominator $6h$:\n$$\n\\mathcal{F}[D[u]]_1 = \\frac{1}{6h} \\left[ (-3 + 4 \\exp(\\lambda h) - \\exp(2\\lambda h)) + (\\exp(2\\lambda h) - 1) + (\\exp(3\\lambda h) - \\exp(\\lambda h)) \\right]\n$$\n$$\n\\mathcal{F}[D[u]]_1 = \\frac{1}{6h} \\left[ (-3 - 1) + (4 - 1)\\exp(\\lambda h) + (-1 + 1)\\exp(2\\lambda h) + \\exp(3\\lambda h) \\right]\n$$\n$$\n\\mathcal{F}[D[u]]_1 = \\frac{1}{6h} \\left[ -4 + 3 \\exp(\\lambda h) + \\exp(3\\lambda h) \\right]\n$$\n\nSecond, we compute the term $D[\\mathcal{F}[u]]_1$.\nThe differentiation operator at $j=1$ is $D[v]_1 = \\frac{v_2 - v_0}{2h}$. To evaluate this for the field $v = \\mathcal{F}[u]$, we need to compute $\\mathcal{F}[u]_0$ and $\\mathcal{F}[u]_2$.\n\nThe filter operator $\\mathcal{F}$ is defined differently at the boundary ($j=0$) and in the interior ($j \\geq 1$).\nAt the boundary ($j=0$):\n$$\n\\mathcal{F}[u]_0 = \\frac{1}{2}(u_0 + u_1) = \\frac{1}{2}(1 + \\exp(\\lambda h))\n$$\nAt the second interior point ($j=2$):\n$$\n\\mathcal{F}[u]_2 = \\frac{1}{3}(u_1 + u_2 + u_3) = \\frac{1}{3}(\\exp(\\lambda h) + \\exp(2\\lambda h) + \\exp(3\\lambda h))\n$$\nNow, we apply the differentiation operator $D$ at $j=1$:\n$$\nD[\\mathcal{F}[u]]_1 = \\frac{\\mathcal{F}[u]_2 - \\mathcal{F}[u]_0}{2h}\n$$\n$$\nD[\\mathcal{F}[u]]_1 = \\frac{1}{2h} \\left[ \\frac{1}{3}(\\exp(\\lambda h) + \\exp(2\\lambda h) + \\exp(3\\lambda h)) - \\frac{1}{2}(1 + \\exp(\\lambda h)) \\right]\n$$\nCombining the terms over the common denominator $12h$:\n$$\nD[\\mathcal{F}[u]]_1 = \\frac{1}{12h} \\left[ 2(\\exp(\\lambda h) + \\exp(2\\lambda h) + \\exp(3\\lambda h)) - 3(1 + \\exp(\\lambda h)) \\right]\n$$\n$$\nD[\\mathcal{F}[u]]_1 = \\frac{1}{12h} \\left[ 2\\exp(\\lambda h) + 2\\exp(2\\lambda h) + 2\\exp(3\\lambda h) - 3 - 3\\exp(\\lambda h) \\right]\n$$\n$$\nD[\\mathcal{F}[u]]_1 = \\frac{1}{12h} \\left[ -3 - \\exp(\\lambda h) + 2\\exp(2\\lambda h) + 2\\exp(3\\lambda h) \\right]\n$$\n\nFinally, we compute the commutator $[\\mathcal{F}, D]u\\,\\big|_{x_1} = \\mathcal{F}[D[u]]_1 - D[\\mathcal{F}[u]]_1$:\n$$\n[\\mathcal{F}, D]u\\,\\big|_{x_1} = \\frac{1}{6h} \\left[ -4 + 3 \\exp(\\lambda h) + \\exp(3\\lambda h) \\right] - \\frac{1}{12h} \\left[ -3 - \\exp(\\lambda h) + 2\\exp(2\\lambda h) + 2\\exp(3\\lambda h) \\right]\n$$\nPutting everything over the denominator $12h$:\n$$\n[\\mathcal{F}, D]u\\,\\big|_{x_1} = \\frac{1}{12h} \\left\\{ 2\\left( -4 + 3 \\exp(\\lambda h) + \\exp(3\\lambda h) \\right) - \\left( -3 - \\exp(\\lambda h) + 2\\exp(2\\lambda h) + 2\\exp(3\\lambda h) \\right) \\right\\}\n$$\n$$\n[\\mathcal{F}, D]u\\,\\big|_{x_1} = \\frac{1}{12h} \\left\\{ (-8 + 6 \\exp(\\lambda h) + 2\\exp(3\\lambda h)) - (-3 - \\exp(\\lambda h) + 2\\exp(2\\lambda h) + 2\\exp(3\\lambda h)) \\right\\}\n$$\n$$\n[\\mathcal{F}, D]u\\,\\big|_{x_1} = \\frac{1}{12h} \\left[ -8 + 6 \\exp(\\lambda h) + 2\\exp(3\\lambda h) + 3 + \\exp(\\lambda h) - 2\\exp(2\\lambda h) - 2\\exp(3\\lambda h) \\right]\n$$\nGrouping terms by powers of $\\exp(\\lambda h)$:\n$$\n[\\mathcal{F}, D]u\\,\\big|_{x_1} = \\frac{1}{12h} \\left[ (-8 + 3) + (6 + 1)\\exp(\\lambda h) - 2\\exp(2\\lambda h) + (2 - 2)\\exp(3\\lambda h) \\right]\n$$\n$$\n[\\mathcal{F}, D]u\\,\\big|_{x_1} = \\frac{-5 + 7\\exp(\\lambda h) - 2\\exp(2\\lambda h)}{12h}\n$$\nThis is the closed-form analytic expression for the commutator at $x_1$. This result is generally non-zero, demonstrating that the discrete filter and differentiation operators do not commute near the boundary.\n\nThe impact of this non-zero commutator on the dynamic Smagorinsky procedure is significant. The procedure relies on the Germano identity, which relates the subgrid-scale (SGS) stress $\\tau_{ij}$ at the grid filter level, the SGS stress $T_{ij}$ at the test filter level, and the resolved (Leonard) stress $L_{ij} = \\widetilde{\\overline{u_i u_j}} - \\tilde{\\bar{u}}_i \\tilde{\\bar{u}}_j$. The algebraic form of the identity, $L_{ij} = T_{ij} - \\tilde{\\tau}_{ij}$, is always exact by definition.\n\nHowever, the dynamic procedure determines the model coefficient by relating these stresses through the filtered equations of motion. When the test filter operator $\\mathcal{F}$ (the tilde notation) is applied to the filtered momentum equation, terms of the form $\\mathcal{F}[\\partial_j(\\phi)]$ appear, where $\\phi$ may be the resolved momentum flux or the SGS stress tensor. If the filter and derivative operators commuted, we would have $\\mathcal{F}[\\partial_j(\\phi)] = \\partial_j(\\mathcal{F}[\\phi])$. The resulting system of equations for the dynamic coefficient would be consistent with the continuous formulation.\n\nWhen the operators do not commute, as demonstrated by the calculation above, an error term arises:\n$$\n\\mathcal{F}[\\partial_j(\\phi)] = \\partial_j(\\mathcal{F}[\\phi]) + [\\mathcal{F}, \\partial_j](\\phi)\n$$\nThis commutator, $[\\mathcal{F}, \\partial_j](\\phi)$, acts as an additional, unmodeled source term in the governing equations from which the Smagorinsky coefficient is derived. This contaminates the relationship between the Leonard stress and the modeled SGS stresses. The assumption of scale similarity, which posits that the SGS stress model has the same functional form at both the grid and test filter scales, is violated at the discrete level because the effective derivative acting on the test-filtered field, $D[\\mathcal{F}[\\bar{u}]]$, is not the same as the filtered derivative of the grid-filtered field, $\\mathcal{F}[D[\\bar{u}]]$.\n\nThis non-commutation is particularly problematic near solid boundaries. Far from the boundary, in the interior of the domain, both the filter and differentiation operators are typically symmetric and translationally invariant on a uniform grid, which causes them to commute. However, near a boundary, the stencils for these operators must change (e.g., to one-sided schemes), breaking the symmetry. As shown by the specific operators in this problem, these different stencils lead to a non-zero commutator. This introduces a significant modeling error in the near-wall region, compromising the accuracy of the dynamic procedure precisely where SGS stresses are often most important.", "answer": "$$\n\\boxed{\\frac{-5 + 7\\exp(\\lambda h) - 2\\exp(2\\lambda h)}{12h}}\n$$", "id": "3373076"}, {"introduction": "With the theoretical foundations in place, we turn to the practical challenge of computing the dynamic coefficient $C$ robustly. This exercise [@problem_id:3373015] guides you through deriving the standard least-squares estimate from the Germano identity and confronting a critical issue: numerical instability caused by \"backscatter.\" You will implement a constrained estimator to ensure the model remains physically dissipative, providing a crucial tool for stable and accurate simulations.", "problem": "Consider a two-dimensional, incompressible, Large-Eddy Simulation (LES) setting with a spatially local dynamic eddy-viscosity model for the subgrid-scale (SGS) stress. Let the resolved velocity gradient at a point define the resolved rate-of-strain tensor as $S_{ij} = \\tfrac{1}{2} \\left( \\partial \\bar{u}_i/\\partial x_j + \\partial \\bar{u}_j/\\partial x_i \\right)$, which for incompressible flow satisfies $S_{11} + S_{22} = 0$. The Smagorinsky ansatz models the deviatoric part of the SGS stress as $\\tau_{ij}^{\\mathrm{sgs}} - \\tfrac{1}{3}\\tau_{kk}^{\\mathrm{sgs}}\\delta_{ij} = -2 \\nu_t S_{ij}$ with eddy viscosity $\\nu_t = C \\Delta^2 \\lvert S \\rvert$. Here $C$ is a dimensionless coefficient to be dynamically estimated, $\\Delta$ is the filter width at the resolved scale, and $\\lvert S \\rvert$ is the resolved strain magnitude defined by $\\lvert S \\rvert = \\sqrt{2 S_{ij} S_{ij}}$ where the implied sum is the full double contraction over all indices.\n\nThe dynamic Smagorinsky procedure uses a test filter (denoted by a tilde) and the Germano identity to relate a measured Leonard stress tensor to a modeled term that depends linearly on $C$. In two dimensions, the Germano identity can be written symbolically as $L_{ij} \\approx 2 C M_{ij}$, where $L_{ij}$ is the Leonard tensor obtained through test and grid filtering, and $M_{ij}$ is a known symmetric tensor assembled from the filtered fields and the model forms. The local dynamic coefficient $C$ is determined by the least-squares minimizer of the residual between $L_{ij}$ and $2 C M_{ij}$, based on the Euclidean (Frobenius) norm induced by the double contraction $A:B \\equiv \\sum_{i,j} A_{ij} B_{ij}$.\n\nYour tasks are:\n- Starting only from the above definitions, derive the normal equation that yields the local least-squares estimate of $C$ as a function of $L_{ij}$ and $M_{ij}$, using the standard double contraction $A:B = \\sum_{i=1}^{2}\\sum_{j=1}^{2} A_{ij} B_{ij}$.\n- Implement two local estimators of $C$:\n  1. The unconstrained least-squares estimator $C_{\\mathrm{LS}}$.\n  2. The constrained least-squares estimator $C_{\\mathrm{CLS}}$ that enforces the pointwise inequality constraint $C \\ge C_{\\min}$, where $C_{\\min}$ is a given nonnegative lower bound. If the least-squares normal equation is ill-conditioned due to an identically zero denominator at a point, treat it by adding a small Tikhonov regularization $\\varepsilon$ in the denominator with $\\varepsilon = 10^{-12}$, and then apply the constraint.\n- For each point, compute the resolved-to-subgrid-scale energy transfer density appearing in the resolved kinetic energy budget, $\\Pi = -\\tau_{ij}^{\\mathrm{sgs}} S_{ij}$, using the model form and your local $C$ estimates. Express $\\Pi$ entirely in terms of $C$, $\\Delta$, and the resolved rate-of-strain tensor. Assume incompressibility so that the isotropic stress does not contribute to $\\Pi$.\n- For each test case below, compute the spatial average over all points of $C_{\\mathrm{LS}}$, the spatial average of $C_{\\mathrm{CLS}}$, and the spatial averages of the corresponding $\\Pi$ fields, denoted $\\overline{C_{\\mathrm{LS}}}$, $\\overline{C_{\\mathrm{CLS}}}$, $\\overline{\\Pi}_{\\mathrm{LS}}$, and $\\overline{\\Pi}_{\\mathrm{CLS}}$.\n\nUse the following test suite. Every test case is two-dimensional, and all quantities are dimensionless. The resolved filter width is constant with $\\Delta = 1.0$ at all points within a test case. At each point, only the unique components of the symmetric tensors are listed in the order $(\\cdot)_{11}$, $(\\cdot)_{12}$, $(\\cdot)_{22}$. For each test, compute the means over all listed points.\n\nTest case A (happy path, unconstrained and constrained coincide):\n- $C_{\\min} = 0.0$.\n- Points with resolved strain $S_{ij}$:\n  - $\\left( S_{11}, S_{12}, S_{22} \\right)$ across points: $\\left( (0.5, 0.3, -0.5), (0.4, 0.2, -0.4), (0.6, 0.1, -0.6), (0.1, 0.05, -0.1), (0.3, 0.25, -0.3) \\right)$.\n- Leonard tensor $L_{ij}$ across points:\n  - $\\left( (0.0048, 0.0024, 0.0072), (0.006, 0.003, 0.005), (0.007, 0.00224, 0.0056), (0.0032, 0.0008, 0.0024), (0.00396, 0.00198, 0.00484) \\right)$.\n- Model tensor $M_{ij}$ across points:\n  - $\\left( (0.02, 0.01, 0.03), (0.03, 0.015, 0.025), (0.025, 0.008, 0.02), (0.02, 0.005, 0.015), (0.018, 0.009, 0.022) \\right)$.\n\nTest case B (backscatter, unconstrained negative $C$ clipped by the constraint):\n- $C_{\\min} = 0.0$.\n- $S_{ij}$ across points:\n  - $\\left( (0.5, 0.4, -0.5), (0.7, 0.2, -0.7), (0.2, 0.3, -0.2), (0.4, 0.1, -0.4), (0.6, 0.25, -0.6) \\right)$.\n- $L_{ij}$ across points:\n  - $\\left( (-0.0024, -0.0012, -0.0036), (-0.0048, -0.0024, -0.0032), (-0.0015, -0.0006, -0.0017), (-0.00308, -0.0014, -0.00266), (-0.00216, -0.00108, -0.00252) \\right)$.\n- $M_{ij}$ across points:\n  - $\\left( (0.02, 0.01, 0.03), (0.03, 0.015, 0.02), (0.015, 0.006, 0.017), (0.022, 0.01, 0.019), (0.018, 0.009, 0.021) \\right)$.\n\nTest case C (near-singular normal equation, regularization plus strictly positive constraint):\n- $C_{\\min} = 0.02$.\n- $S_{ij}$ across points:\n  - $\\left( (0.5, 0.2, -0.5), (0.3, 0.4, -0.3), (0.7, 0.1, -0.7) \\right)$.\n- $L_{ij}$ across points:\n  - $\\left( (0.0001, 0.00005, 0.00012), (0.00005, 0.00002, 0.00006), (0.00008, 0.00003, 0.00007) \\right)$.\n- $M_{ij}$ across points:\n  - $\\left( (0.0, 0.0, 0.0), (0.0, 0.0, 0.0), (0.0, 0.0, 0.0) \\right)$.\n\nTest case D (threshold raises small positive coefficients):\n- $C_{\\min} = 0.09$.\n- $S_{ij}$ across points:\n  - $\\left( (0.35, 0.25, -0.35), (0.45, 0.15, -0.45), (0.55, 0.2, -0.55), (0.4, 0.1, -0.4) \\right)$.\n- $L_{ij}$ across points:\n  - $\\left( (0.0024, 0.0012, 0.00216), (0.0035, 0.00168, 0.00308), (0.0048, 0.0024, 0.00384), (0.0018, 0.0009, 0.002) \\right)$.\n- $M_{ij}$ across points:\n  - $\\left( (0.02, 0.01, 0.018), (0.025, 0.012, 0.022), (0.03, 0.015, 0.024), (0.018, 0.009, 0.02) \\right)$.\n\nAlgorithmic and numerical requirements:\n- Use the definition of the full double contraction for symmetric two-dimensional tensors so that for any symmetric $A_{ij}$ and $B_{ij}$ represented by their unique components $(A_{11}, A_{12}, A_{22})$ and $(B_{11}, B_{12}, B_{22})$, the double contraction is $A:B = A_{11}B_{11} + A_{22}B_{22} + 2 A_{12} B_{12}$, and the squared Frobenius norm is $A:A$.\n- With the least-squares estimate of $C$ at each point in hand, compute the resolved-to-subgrid-scale energy transfer density $\\Pi$ entering the resolved kinetic energy budget at that point, and then average over the listed points in each test case.\n- All quantities are dimensionless, so no physical units are required.\n\nFinal output format:\n- Your program should produce a single line of output containing, for the test cases A, B, C, D in order, a list of lists. Each inner list must be of the form $[\\overline{C_{\\mathrm{LS}}}, \\overline{C_{\\mathrm{CLS}}}, \\overline{\\Pi}_{\\mathrm{LS}}, \\overline{\\Pi}_{\\mathrm{CLS}}]$ with each entry rounded to six decimal places. For example, a valid overall format is $[[a_1,b_1,c_1,d_1],[a_2,b_2,c_2,d_2],[a_3,b_3,c_3,d_3],[a_4,b_4,c_4,d_4]]$ where each $a_k,b_k,c_k,d_k$ is a decimal numeral with six digits after the decimal point.", "solution": "The solution proceeds in three parts: first, the derivation of the local dynamic coefficient $C$; second, the derivation of the SGS energy transfer density $\\Pi$; and third, the application of these formulas to the provided test cases.\n\n### Derivation of the Dynamic Coefficient $C$\n\nThe dynamic procedure estimates the Smagorinsky coefficient $C$ by minimizing the residual between the Leonard tensor $L_{ij}$ and its model $2 C M_{ij}$. The objective is to find the value of $C$ that minimizes the squared Frobenius norm of the residual tensor $R_{ij} = L_{ij} - 2 C M_{ij}$. The cost function $J(C)$ is:\n$$ J(C) = R_{ij} : R_{ij} = (L_{ij} - 2 C M_{ij}) : (L_{ij} - 2 C M_{ij}) $$\nwhere the double contraction $A:B$ is defined as $\\sum_{i,j} A_{ij} B_{ij}$. Expanding the cost function using the properties of the double contraction yields:\n$$ J(C) = (L:L) - 2C(L:M) - 2C(M:L) + 4C^2(M:M) $$\nSince the double contraction is commutative ($L:M = M:L$), this simplifies to:\n$$ J(C) = (L:L) - 4C(L:M) + 4C^2(M:M) $$\nTo find the minimum, we compute the derivative of $J(C)$ with respect to $C$ and set it to zero. This gives the normal equation:\n$$ \\frac{dJ}{dC} = -4(L:M) + 8C(M:M) = 0 $$\nSolving for $C$ provides the unconstrained least-squares estimate, $C_{\\mathrm{LS}}$:\n$$ C_{\\mathrm{LS}} = \\frac{4(L:M)}{8(M:M)} = \\frac{L:M}{2(M:M)} $$\nFor symmetric $2$-D tensors given by their unique components $(A_{11}, A_{12}, A_{22})$ and $(B_{11}, B_{12}, B_{22})$, the required double contractions are computed as:\n$$ L:M = L_{11}M_{11} + L_{22}M_{22} + 2L_{12}M_{12} $$\n$$ M:M = M_{11}^2 + M_{22}^2 + 2M_{12}^2 $$\n\nThe problem specifies two estimators for $C$:\n\n1.  **Unconstrained Estimator $C_{\\mathrm{LS}}$**: This is directly given by the derived formula. For cases where the denominator $2(M:M)$ is identically zero (i.e., $M_{ij}$ is the zero tensor), the equation is ill-conditioned. The problem prescribes Tikhonov regularization by adding a small parameter $\\varepsilon = 10^{-12}$ to the denominator. The formula thus becomes:\n    $$ C_{\\mathrm{LS}} = \\frac{L:M}{2(M:M) + \\varepsilon'} $$\n    where $\\varepsilon' = \\varepsilon$ if $M:M=0$, and $\\varepsilon'=0$ otherwise. If $M_{ij}=0$, then $L:M=0$, resulting in $C_{\\mathrm{LS}} = 0$.\n\n2.  **Constrained Estimator $C_{\\mathrm{CLS}}$**: This estimator enforces physical realizability, typically ensuring the SGS model is dissipative. It is obtained by clipping the unconstrained estimate $C_{\\mathrm{LS}}$ at a specified non-negative lower bound $C_{\\min}$:\n    $$ C_{\\mathrm{CLS}} = \\max(C_{\\mathrm{LS}}, C_{\\min}) $$\n\n### Derivation of the SGS Energy Transfer Density $\\Pi$\n\nThe SGS energy transfer density, $\\Pi$, represents the rate of energy transfer from resolved scales to subgrid scales. It is defined as:\n$$ \\Pi = -\\tau_{ij}^{\\mathrm{sgs}} S_{ij} $$\nThe SGS stress tensor $\\tau_{ij}^{\\mathrm{sgs}}$ can be decomposed into its deviatoric (traceless) part, $\\tau_{ij}^{\\mathrm{sgs, dev}}$, and its isotropic part: $\\tau_{ij}^{\\mathrm{sgs}} = \\tau_{ij}^{\\mathrm{sgs, dev}} + \\frac{1}{3}\\tau_{kk}^{\\mathrm{sgs}}\\delta_{ij}$. Substituting this into the expression for $\\Pi$:\n$$ \\Pi = -\\left(\\tau_{ij}^{\\mathrm{sgs, dev}} + \\frac{1}{3}\\tau_{kk}^{\\mathrm{sgs}}\\delta_{ij}\\right) S_{ij} = -\\tau_{ij}^{\\mathrm{sgs, dev}} S_{ij} - \\frac{1}{3}\\tau_{kk}^{\\mathrm{sgs}} S_{ii} $$\nFor an incompressible flow, the continuity equation implies that the resolved strain-rate tensor is traceless, i.e., $S_{ii} = S_{11} + S_{22} = 0$. Consequently, the isotropic part of the SGS stress does not contribute to the energy transfer, and the expression simplifies to:\n$$ \\Pi = -\\tau_{ij}^{\\mathrm{sgs, dev}} S_{ij} $$\nThe Smagorinsky model provides a constitutive relation for the deviatoric SGS stress:\n$$ \\tau_{ij}^{\\mathrm{sgs, dev}} = -2 \\nu_t S_{ij} $$\nwhere the eddy viscosity is $\\nu_t = C \\Delta^2 |S|$. Substituting this into the expression for $\\Pi$:\n$$ \\Pi = -(-2 \\nu_t S_{ij}) S_{ij} = 2 \\nu_t (S_{ij} S_{ij}) = 2(C \\Delta^2 |S|) (S_{ij} S_{ij}) $$\nThe magnitude of the strain-rate tensor is defined as $|S| = \\sqrt{2 S_{ij} S_{ij}}$. From this, we have $|S|^2 = 2 S_{ij} S_{ij}$, which implies $S_{ij} S_{ij} = \\frac{1}{2}|S|^2$. Substituting this final relation into the expression for $\\Pi$:\n$$ \\Pi = 2(C \\Delta^2 |S|) \\left(\\frac{1}{2}|S|^2\\right) = C \\Delta^2 |S|^3 $$\nThis is the desired expression for the energy transfer density. For the specified problem, the filter width $\\Delta = 1.0$. The magnitude $|S|$ is computed from the given components of $S_{ij}$. For a $2$-D incompressible flow, $S_{22}=-S_{11}$, so the double contraction $S:S$ is:\n$$ S:S = S_{11}^2 + S_{22}^2 + 2S_{12}^2 = S_{11}^2 + (-S_{11})^2 + 2S_{12}^2 = 2S_{11}^2 + 2S_{12}^2 $$\nTherefore, the magnitude $|S|$ is:\n$$ |S| = \\sqrt{2(S:S)} = \\sqrt{2(2S_{11}^2 + 2S_{12}^2)} = 2\\sqrt{S_{11}^2 + S_{12}^2} $$\n\n### Computational Procedure\n\nFor each test case, we perform the following calculations for every data point:\n1.  Compute the double contractions $L:M$ and $M:M$.\n2.  Calculate $C_{\\mathrm{LS}}$ using the derived formula, applying regularization if $M:M=0$.\n3.  Calculate $C_{\\mathrm{CLS}}$ by applying the lower bound $C_{\\min}$.\n4.  Calculate the strain-rate magnitude $|S|$.\n5.  Calculate the energy transfer densities $\\Pi_{\\mathrm{LS}} = C_{\\mathrm{LS}} \\Delta^2 |S|^3$ and $\\Pi_{\\mathrm{CLS}} = C_{\\mathrm{CLS}} \\Delta^2 |S|^3$ (with $\\Delta=1.0$).\nFinally, the spatial averages of $C_{\\mathrm{LS}}$, $C_{\\mathrm{CLS}}$, $\\Pi_{\\mathrm{LS}}$, and $\\Pi_{\\mathrm{CLS}}$ are computed over all points within each test case.", "answer": "[[0.060000,0.060000,0.015233,0.015233],[-0.060000,0.000000,-0.021008,0.000000],[0.000000,0.020000,0.000000,0.003112],[0.060000,0.090000,0.006859,0.010288]]", "id": "3373015"}]}