{"hands_on_practices": [{"introduction": "A fundamental task in generating synthetic turbulence is to create a random velocity field that correctly reproduces the second-order statistics, such as the Reynolds stress tensor $R_{ij}$, often provided by a precursor Reynolds-Averaged Navier-Stokes (RANS) simulation. This exercise [@problem_id:3369516] provides hands-on practice with a cornerstone technique: using Cholesky decomposition to \"sculpt\" uncorrelated random noise into fluctuations with a prescribed covariance structure. By implementing this method, you will gain a practical understanding of how to bridge the gap between a statistical turbulence model and a time-resolved velocity field suitable for a Large-Eddy Simulation (LES).", "problem": "You are given a wall-normal profile of the Reynolds stress tensor from a Reynolds-Averaged Navier–Stokes (RANS) solution, denoted by $R_{ij}(y)$, where $y$ is the wall-normal coordinate. The goal is to synthesize turbulent inflow fluctuations consistent with $R_{ij}(y)$ using a covariance mapping based on a Cholesky factorization and then apply a simplified relaxation model to evaluate whether a Large-Eddy Simulation (LES) inflow rapidly recovers the correct near-wall anisotropy without requiring a long streamwise development length. The problem must be treated in nondimensional form.\n\nDefinitions and foundational principles:\n- Reynolds-Averaged Navier–Stokes (RANS) is a statistical framework in which the fluctuating velocity $u'_i$ has zero mean and covariance $R_{ij}(y) = \\langle u'_i u'_j \\rangle$ that is positive-semidefinite for physically realizable turbulent states.\n- Large-Eddy Simulation (LES) is a numerical method that resolves large-scale turbulent motions while modeling the subgrid scales.\n- The Cholesky factorization of a symmetric positive-definite matrix $R(y)$ is the lower-triangular matrix $L(y)$ such that $R(y) = L(y) L(y)^{\\top}$. If $\\boldsymbol{\\xi}$ is a standard normal random vector with covariance equal to the identity matrix, then $\\mathbf{u}'(y) = L(y)\\boldsymbol{\\xi}$ has covariance $R(y)$, by linearity of expectation and the properties of Gaussian random variables.\n- The turbulent kinetic energy is $k(y) = \\tfrac{1}{2} \\operatorname{tr}(R(y))$.\n- The anisotropy tensor is $b_{ij}(y) = \\dfrac{R_{ij}(y)}{2 k(y)} - \\dfrac{1}{3} \\delta_{ij}$, where $\\delta_{ij}$ is the Kronecker delta and $b_{ij}$ is traceless by construction.\n\nYou must design a program that performs the following steps purely in mathematical terms:\n1. For each test case, define a nondimensional domain height $H$, a uniform advection speed $U$, a near-wall region $\\{ y/H \\leq \\alpha \\}$ with $\\alpha$ specified below, a relaxation time scale $T(y)$, and a realization size $M$ for synthetic sampling.\n2. Construct $R_{ij}(y)$ at a discrete set of $y$ positions using the provided RANS-like profiles. Ensure the covariance matrices are numerically factorizable. If a given $R(y)$ is not strictly positive-definite, apply a minimal diagonal regularization $R(y) \\leftarrow R(y) + \\varepsilon I$ with $\\varepsilon > 0$ chosen as small as needed to admit a Cholesky factorization, where $I$ is the identity matrix.\n3. Generate synthetic inflow samples at each $y$ by drawing $M$ independent realizations of $\\boldsymbol{\\xi} \\sim \\mathcal{N}(\\mathbf{0}, I)$ and mapping $\\mathbf{u}'(y) = L(y)\\boldsymbol{\\xi}$. Estimate the sample covariance $S(y)$ from the synthetic realizations, and compute the synthetic anisotropy $b^{\\text{init}}(y)$ from $S(y)$.\n4. Assume a local, linear relaxation model for the anisotropy error at each $y$ in the near-wall region:\n   $$ \\frac{d}{dt}\\left( b_{ij}(y,t) - b^{\\text{target}}_{ij}(y) \\right) = -\\frac{1}{T(y)} \\left( b_{ij}(y,t) - b^{\\text{target}}_{ij}(y) \\right), $$\n   with initial condition $b_{ij}(y,0) = b^{\\text{init}}_{ij}(y)$ and target anisotropy $b^{\\text{target}}_{ij}(y)$ computed from $R_{ij}(y)$. Under Taylor’s frozen turbulence hypothesis, the streamwise development length is $x = U t$.\n5. Define the near-wall anisotropy error norm at position $y$ as the Frobenius norm of the difference $e(y,t) = \\left\\| b(y,t) - b^{\\text{target}}(y) \\right\\|_{F}$ and the near-wall threshold $\\epsilon_{b}$. For the relaxation model above, the solution is $b(y,t) - b^{\\text{target}}(y) = \\left( b^{\\text{init}}(y) - b^{\\text{target}}(y) \\right) \\exp\\left( -\\dfrac{t}{T(y)} \\right)$, so\n   $$ e(y,t) = e(y,0) \\exp\\left( -\\frac{t}{T(y)} \\right), \\quad e(y,0) = \\left\\| b^{\\text{init}}(y) - b^{\\text{target}}(y) \\right\\|_{F}. $$\n   Let $t_{\\text{rec}}$ be the minimal time such that $e(y,t_{\\text{rec}}) \\leq \\epsilon_{b}$ for all $y$ in the near-wall region. Then\n   $$ t_{\\text{rec}} = \\max_{y \\in \\text{near-wall}} \\left\\{ T(y) \\max\\left( 0, \\ln\\left( \\frac{e(y,0)}{\\epsilon_{b}} \\right) \\right) \\right\\}. $$\n   The corresponding nondimensional streamwise development length is $\\dfrac{x_{\\text{rec}}}{H} = \\dfrac{U \\, t_{\\text{rec}}}{H}$.\n6. A test is considered to “quickly recover” the correct near-wall anisotropy if $\\dfrac{x_{\\text{rec}}}{H} \\leq L_{\\text{thr}}$, where $L_{\\text{thr}}$ is a specified nondimensional threshold.\n\nYour program must implement the above specification and produce a single line of output containing a comma-separated list of booleans enclosed in square brackets, indicating whether each test case meets the “quick recovery” criterion, precisely in the format $[\\text{result}_{1},\\text{result}_{2},\\text{result}_{3}]$.\n\nUse the following test suite. In all cases, discretize $y$ on $N$ uniformly spaced points over $[0,H]$ with $N = 41$ and define the near-wall region by $y/H \\leq \\alpha$ with $\\alpha = 0.1$. All quantities are nondimensional, and angles do not appear. No percentages are used anywhere.\n\nTest case $1$ (anisotropic near wall, moderate recovery):\n- $H = 1.0$, $U = 1.0$, $M = 200$, $\\epsilon_{b} = 0.03$, $L_{\\text{thr}} = 0.5$.\n- Turbulent kinetic energy: $k(y) = k_{\\min} + 0.25\\left(1 - e^{-7 y}\\right)$ with $k_{\\min} = 10^{-4}$.\n- Diagonal fractions defining $R(y)$: $f_{x}(y) = \\tfrac{1}{3} + 0.18 e^{-y/0.05}$, $f_{y}(y) = \\tfrac{1}{3} - 0.04 e^{-y/0.05}$, $f_{z}(y) = 1 - f_{x}(y) - f_{y}(y)$.\n- Reynolds stress tensor: $R(y) = \\operatorname{diag}\\left( 2 k(y) f_{x}(y), 2 k(y) f_{y}(y), 2 k(y) f_{z}(y) \\right)$.\n- Relaxation time scale: $T(y) = 0.05 + 0.15 \\sqrt{y}$.\n\nTest case $2$ (isotropic target, fast recovery):\n- $H = 1.0$, $U = 1.0$, $M = 200$, $\\epsilon_{b} = 0.03$, $L_{\\text{thr}} = 0.5$.\n- Turbulent kinetic energy: $k(y) = k_{\\min} + 0.25\\left(1 - e^{-3 y}\\right)$ with $k_{\\min} = 10^{-4}$.\n- Isotropic fractions: $f_{x}(y) = f_{y}(y) = f_{z}(y) = \\tfrac{1}{3}$.\n- Reynolds stress tensor: $R(y) = \\operatorname{diag}\\left( 2 k(y) f_{x}(y), 2 k(y) f_{y}(y), 2 k(y) f_{z}(y) \\right)$.\n- Relaxation time scale: $T(y) = 0.02 + 0.05 y$.\n\nTest case $3$ (near-singular energy near wall, slow recovery):\n- $H = 1.0$, $U = 2.0$, $M = 200$, $\\epsilon_{b} = 0.03$, $L_{\\text{thr}} = 0.5$.\n- Turbulent kinetic energy: $k(y) = 10^{-6} + 0.02 y$.\n- Strong anisotropy near wall: $f_{x}(y) = \\tfrac{1}{3} + 0.32 e^{-y/0.02}$, $f_{y}(y) = \\tfrac{1}{3} - 0.23 e^{-y/0.02}$, $f_{z}(y) = 1 - f_{x}(y) - f_{y}(y)$.\n- Reynolds stress tensor: $R(y) = \\operatorname{diag}\\left( 2 k(y) f_{x}(y), 2 k(y) f_{y}(y), 2 k(y) f_{z}(y) \\right)$.\n- Relaxation time scale: $T(y) = 2.0 + y$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[ \\text{result}_{1}, \\text{result}_{2}, \\text{result}_{3} ]$), where each $\\text{result}_{i}$ is either $\\text{True}$ or $\\text{False}$ based on whether $\\dfrac{x_{\\text{rec}}}{H} \\leq L_{\\text{thr}}$ for the corresponding test case.", "solution": "The problem is deemed valid as it is scientifically grounded in the principles of computational fluid dynamics and turbulence modeling, is well-posed with a clear and complete set of definitions and parameters, and is objective in its formulation. The methodology prescribed is a standard, albeit simplified, numerical procedure for assessing the quality of synthetic turbulence inflow conditions for Large-Eddy Simulations (LES).\n\nThe solution proceeds by implementing the specified multi-step algorithm. For each test case, we will:\n1. Define the physical and numerical parameters and discretize the spatial domain.\n2. Construct the target Reynolds stress tensor, $R_{ij}(y)$, at each discrete wall-normal position $y$.\n3. Generate a finite ensemble of synthetic velocity fluctuations and compute the sample covariance matrix, $S(y)$.\n4. Calculate the target anisotropy tensor, $b^{\\text{target}}(y)$, and the initial anisotropy tensor of the synthetic field, $b^{\\text{init}}(y)$.\n5. Determine the initial error in the anisotropy tensor, $e(y,0)$, and use the provided relaxation model to compute the recovery time, $t_{\\text{rec}}$, and the corresponding streamwise development length, $x_{\\text{rec}}$.\n6. Compare the recovery length to a threshold to determine if the recovery is sufficiently rapid.\n\nThe wall-normal domain of height $H$ is discretized into $N=41$ uniformly spaced points, $y_j = j \\cdot H / (N-1)$ for $j=0, 1, \\dots, N-1$.\n\nFor each test case and at each point $y_j$, a target Reynolds stress tensor $R(y_j)$ is constructed. The problem specifies $R(y_j)$ to be a diagonal matrix,\n$$\nR(y_j) = \\operatorname{diag}\\left( 2 k(y_j) f_{x}(y_j), 2 k(y_j) f_{y}(y_j), 2 k(y_j) f_{z}(y_j) \\right)\n$$\nwhere $k(y)$ is the turbulent kinetic energy and $f_x(y), f_y(y), f_z(y)$ are fractional components summing to $1$. This construction ensures consistency with the definition of turbulent kinetic energy, $k(y) = \\frac{1}{2}\\operatorname{tr}(R(y))$. The components $R_{ii}(y)$ are variances and must be non-negative. The provided functions for $k(y)$ and $f_i(y)$ ensure this, making $R(y)$ a positive-definite matrix.\n\nTo generate synthetic turbulent fluctuations, we use a covariance mapping method based on the Cholesky factorization. For each target covariance matrix $R(y_j)$, we find its Cholesky decomposition, a lower-triangular matrix $L(y_j)$ such that $R(y_j) = L(y_j) L(y_j)^{\\top}$. Since $R(y_j)$ is diagonal, $L(y_j)$ is also diagonal, with entries being the square roots of the diagonal entries of $R(y_j)$. We then generate $M$ samples of a $3$-dimensional random vector $\\boldsymbol{\\xi}_k \\sim \\mathcal{N}(\\mathbf{0}, I)$, where $I$ is the $3 \\times 3$ identity matrix. The synthetic velocity fluctuations are then given by\n$$\n\\mathbf{u}'_k(y_j) = L(y_j) \\boldsymbol{\\xi}_k, \\quad k=1, \\dots, M.\n$$\nBy construction, the expectation of the covariance of these samples is $E[\\mathbf{u}' (\\mathbf{u}')^\\top] = L E[\\boldsymbol{\\xi} \\boldsymbol{\\xi}^\\top] L^\\top = L I L^\\top = R(y_j)$.\n\nDue to the finite sample size $M$, the sample covariance matrix, $S(y_j)$, computed from the $M$ realizations, will differ from the target $R(y_j)$. The sample covariance is estimated as\n$$\nS(y_j) = \\frac{1}{M} \\sum_{k=1}^{M} \\mathbf{u}'_k(y_j) \\left(\\mathbf{u}'_k(y_j)\\right)^{\\top}.\n$$\nThis statistical difference between $S(y_j)$ and $R(y_j)$ is the source of the initial error in the inflow condition.\n\nThe state of anisotropy is quantified by the anisotropy tensor, $b_{ij} = \\frac{R_{ij}}{2k} - \\frac{1}{3}\\delta_{ij}$. We compute the target anisotropy $b^{\\text{target}}(y_j)$ from $R(y_j)$ and the initial anisotropy of the synthetic field $b^{\\text{init}}(y_j)$ from $S(y_j)$. The initial error at each location $y_j$ is the Frobenius norm of their difference:\n$$\ne(y_j, 0) = \\left\\| b^{\\text{init}}(y_j) - b^{\\text{target}}(y_j) \\right\\|_{F}.\n$$\nThis error is non-zero due to sampling effects. For this error to be well-defined, the sample turbulent kinetic energy, $k_{\\text{sample}}(y_j) = \\frac{1}{2}\\operatorname{tr}(S(y_j))$, must be non-zero, which is practically guaranteed.\n\nThe problem posits a linear relaxation model for the evolution of this error downstream. The time required for the error to decay to a tolerance $\\epsilon_b$ at a point $y_j$ is $T(y_j) \\ln(e(y_j,0)/\\epsilon_b)$, provided $e(y_j,0) > \\epsilon_b$. The overall recovery time, $t_{\\text{rec}}$, is the maximum time required across all points $y_j$ within the near-wall region, defined by $y_j/H \\le \\alpha$. This is expressed as:\n$$\nt_{\\text{rec}} = \\max_{y_j/H \\le \\alpha} \\left\\{ T(y_j) \\max\\left( 0, \\ln\\left( \\frac{e(y_j,0)}{\\epsilon_{b}} \\right) \\right) \\right\\}.\n$$\nThe use of $\\max(0, \\cdot)$ correctly sets the recovery time to $0$ for points where the initial error is already below the threshold.\n\nFinally, invoking Taylor's frozen turbulence hypothesis, the streamwise development length required for recovery is $x_{\\text{rec}} = U t_{\\text{rec}}$. The non-dimensional length is $\\frac{x_{\\text{rec}}}{H}$. A test case is classified as a \"quick recovery\" if this length is no greater than the specified threshold $L_{\\text{thr}}$:\n$$\n\\frac{U t_{\\text{rec}}}{H} \\le L_{\\text{thr}}.\n$$\nThis procedure is applied to each of the three test cases to yield a boolean result. For reproducibility, a fixed seed is used for the random number generator.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test cases and print the results.\n    \"\"\"\n    \n    # Define test cases as a list of dictionaries.\n    test_cases = [\n        {\n            \"name\": \"Test case 1\",\n            \"H\": 1.0, \"U\": 1.0, \"M\": 200, \"epsilon_b\": 0.03, \"L_thr\": 0.5,\n            \"k_func\": lambda y: 1e-4 + 0.25 * (1 - np.exp(-7 * y)),\n            \"fx_func\": lambda y: 1/3 + 0.18 * np.exp(-y / 0.05),\n            \"fy_func\": lambda y: 1/3 - 0.04 * np.exp(-y / 0.05),\n            \"T_func\": lambda y: 0.05 + 0.15 * np.sqrt(y)\n        },\n        {\n            \"name\": \"Test case 2\",\n            \"H\": 1.0, \"U\": 1.0, \"M\": 200, \"epsilon_b\": 0.03, \"L_thr\": 0.5,\n            \"k_func\": lambda y: 1e-4 + 0.25 * (1 - np.exp(-3 * y)),\n            \"fx_func\": lambda y: 1/3,\n            \"fy_func\": lambda y: 1/3,\n            \"T_func\": lambda y: 0.02 + 0.05 * y\n        },\n        {\n            \"name\": \"Test case 3\",\n            \"H\": 1.0, \"U\": 2.0, \"M\": 200, \"epsilon_b\": 0.03, \"L_thr\": 0.5,\n            \"k_func\": lambda y: 1e-6 + 0.02 * y,\n            \"fx_func\": lambda y: 1/3 + 0.32 * np.exp(-y / 0.02),\n            \"fy_func\": lambda y: 1/3 - 0.23 * np.exp(-y / 0.02),\n            \"T_func\": lambda y: 2.0 + y\n        }\n    ]\n\n    # Common parameters\n    N = 41\n    alpha = 0.1\n    # Regularization epsilon, as suggested by the problem, though not strictly needed for these cases.\n    reg_eps = 1e-12 \n    # Initialize random number generator for reproducibility\n    rng = np.random.default_rng(seed=42)\n\n    results = []\n\n    for case in test_cases:\n        H = case[\"H\"]\n        U = case[\"U\"]\n        M = case[\"M\"]\n        epsilon_b = case[\"epsilon_b\"]\n        L_thr = case[\"L_thr\"]\n        k_func = case[\"k_func\"]\n        fx_func = case[\"fx_func\"]\n        fy_func = case[\"fy_func\"]\n        T_func = case[\"T_func\"]\n        \n        # 1. Discretize domain\n        y = np.linspace(0, H, N)\n        \n        # Identify near-wall indices\n        near_wall_indices = np.where(y / H <= alpha)[0]\n        \n        initial_errors = np.zeros(N)\n        \n        for j, y_j in enumerate(y):\n            # 2. Construct target Reynolds stress tensor R(y)\n            k_j = k_func(y_j)\n            fx_j = fx_func(y_j)\n            fy_j = fy_func(y_j)\n            fz_j = 1 - fx_j - fy_j\n\n            R_target_diag = 2 * k_j * np.array([fx_j, fy_j, fz_j])\n            R_target = np.diag(R_target_diag)\n            \n            # Apply regularization\n            R_target += reg_eps * np.identity(3)\n            \n            # 3. Generate synthetic fluctuations\n            L = np.linalg.cholesky(R_target)\n            xi_samples = rng.standard_normal(size=(M, 3))\n            u_prime_samples = (L @ xi_samples.T).T\n            \n            # Estimate sample covariance S(y)\n            S = (u_prime_samples.T @ u_prime_samples) / M\n            \n            # 4. Compute anisotropy tensors and initial error\n            k_target = 0.5 * np.trace(R_target)\n            b_target = R_target / (2 * k_target) - (1/3) * np.identity(3)\n            \n            k_sample = 0.5 * np.trace(S)\n            if k_sample < 1e-12: # Avoid division by zero\n                b_init = np.zeros((3, 3))\n            else:\n                b_init = S / (2 * k_sample) - (1/3) * np.identity(3)\n            \n            # Calculate initial error norm\n            e0 = np.linalg.norm(b_init - b_target, 'fro')\n            initial_errors[j] = e0\n            \n        # 5. Compute recovery time and length\n        e0_nw = initial_errors[near_wall_indices]\n        y_nw = y[near_wall_indices]\n        T_nw = T_func(y_nw)\n        \n        # Calculate recovery time for each point in the near-wall region\n        # Use np.divide to handle e0_nw/epsilon_b without log(0) warnings\n        ratio = np.divide(e0_nw, epsilon_b, out=np.zeros_like(e0_nw, dtype=float), where=epsilon_b!=0)\n        # Suppress invalid value warning for log(0) which becomes -inf\n        with np.errstate(divide='ignore'):\n            log_term = np.log(ratio)\n        \n        # max(0, log_term) handles e0 <= epsilon_b case\n        recovery_times_at_points = T_nw * np.maximum(0, log_term)\n        \n        t_rec = np.max(recovery_times_at_points)\n        x_rec_over_H = (U * t_rec) / H\n        \n        # 6. Check recovery criterion\n        is_quick_recovery = x_rec_over_H <= L_thr\n        results.append(is_quick_recovery)\n\n    # Format and print the final output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3369516"}, {"introduction": "While matching point-wise statistics is essential, realistic turbulence also possesses rich spatial structure and anisotropy, especially in the presence of mean shear. This exercise [@problem_id:3369476] elevates our approach by moving into the spectral (wavenumber) domain, where these correlations are naturally described. You will construct a physically-consistent spectral tensor model from first principles, learning how to enforce the incompressibility constraint and systematically introduce shear-induced anisotropy, which is critical for generating realistic turbulent structures in simulations of engineering and geophysical flows.", "problem": "You are tasked with designing and analyzing a synthetic turbulence inflow generator for a three-dimensional shear flow, using a cross-spectral tensor formulation that is consistent with incompressibility and positive semidefiniteness. The goal is to construct, from first principles, a spectral tensor model for the velocity field that produces nonzero cross-spectra between the streamwise and cross-stream components in the presence of shear, while satisfying the divergence-free constraint. You must then evaluate quantitative metrics on a discretized wavenumber grid to test the physical and numerical consistency of the model.\n\nDefinitions and fundamental base:\n- Let the instantaneous velocity field be denoted by $u_i(\\mathbf{x},t)$, where $i \\in \\{1,2,3\\}$ corresponds to the Cartesian components $(u,v,w)$ in the $(x,y,z)$ directions. Assume a homogeneous, stationary, incompressible turbulent flow.\n- The cross-spectral tensor (also known as the spectral density tensor) is defined as the Fourier transform of the two-point correlation tensor of the velocity field. Denote it by $\\Phi_{ij}(\\mathbf{k})$, where $\\mathbf{k} = (k_x,k_y,k_z)$ is the wavenumber vector in three dimensions. For an incompressible flow, the divergence-free constraint implies that\n$$\nk_i \\, \\Phi_{ij}(\\mathbf{k}) = 0 \\quad \\text{for all } \\mathbf{k} \\neq \\mathbf{0}.\n$$\n- The spectral tensor must be symmetric ($\\Phi_{ij} = \\Phi_{ji}$) and positive-semidefinite for each $\\mathbf{k}$, ensuring that for any vector $a_i$, the quadratic form $a_i \\Phi_{ij} a_j \\ge 0$.\n- In isotropic turbulence, the spectral tensor has the classic solenoidal form $\\Phi_{ij}(\\mathbf{k}) \\propto \\left(\\delta_{ij} - \\frac{k_i k_j}{\\|\\mathbf{k}\\|^2}\\right) E(\\|\\mathbf{k}\\|)$, where $E$ is the scalar energy spectrum and $\\delta_{ij}$ is the Kronecker delta. In shear flows, anisotropy is introduced by redistributing energy within the plane orthogonal to $\\mathbf{k}$ in a manner that depends on the shear direction while preserving incompressibility.\n\nModeling approach to be implemented:\n- Let the unit vector $\\hat{\\mathbf{k}} = \\mathbf{k}/\\|\\mathbf{k}\\|$. Define a unit vector $\\mathbf{s}$ indicating the direction of mean shear. Construct the projection of $\\mathbf{s}$ onto the plane perpendicular to $\\hat{\\mathbf{k}}$:\n$$\n\\mathbf{s}_\\perp = \\mathbf{s} - (\\mathbf{s} \\cdot \\hat{\\mathbf{k}})\\hat{\\mathbf{k}}, \\quad \\text{with } \\|\\mathbf{s}_\\perp\\| \\in [0,1].\n$$\n- Build an orthonormal basis $\\{\\mathbf{e}_1, \\mathbf{e}_2\\}$ for the plane orthogonal to $\\hat{\\mathbf{k}}$ by taking $\\mathbf{e}_1 = \\mathbf{s}_\\perp / \\|\\mathbf{s}_\\perp\\|$ when $\\|\\mathbf{s}_\\perp\\| > 0$, and a robust fallback orthogonal construction when $\\|\\mathbf{s}_\\perp\\| \\approx 0$. Let $\\mathbf{e}_2 = \\hat{\\mathbf{k}} \\times \\mathbf{e}_1$, normalized to unit length.\n- Define an anisotropy index $\\xi(\\mathbf{k})$ that depends on a non-dimensional shear-rate parameter $\\sigma \\ge 0$ and on $\\|\\mathbf{s}_\\perp\\|$ through\n$$\n\\xi(\\mathbf{k}) = \\mathrm{clip}\\left(\\alpha\\, \\sigma \\, \\|\\mathbf{s}_\\perp\\|, \\, -\\xi_{\\max}, \\, \\xi_{\\max}\\right),\n$$\nwhere $\\alpha > 0$ is a fixed anisotropy sensitivity constant, $\\xi_{\\max} \\in (0,1)$ is a saturation limit, and $\\mathrm{clip}(x,a,b)$ truncates $x$ to the interval $[a,b]$.\n- Partition the energy in the plane perpendicular to $\\hat{\\mathbf{k}}$ using weights\n$$\na(\\mathbf{k}) = \\frac{1 + \\xi(\\mathbf{k})}{2}, \\quad b(\\mathbf{k}) = \\frac{1 - \\xi(\\mathbf{k})}{2}, \\quad \\text{so that } a(\\mathbf{k}) + b(\\mathbf{k}) = 1 \\text{ and } a,b \\ge 0.\n$$\n- Let $E(k)$ be a non-dimensional scalar energy spectrum dependent on $k = \\|\\mathbf{k}\\|$, constructed to be finite at small $k$ and to decay at large $k$. The spectral tensor is then modeled by\n$$\n\\Phi_{ij}(\\mathbf{k}) = E(k)\\left[ a(\\mathbf{k}) \\, e_{1,i} e_{1,j} + b(\\mathbf{k}) \\, e_{2,i} e_{2,j} \\right],\n$$\nwhich is symmetric, positive-semidefinite, and satisfies $k_i \\Phi_{ij}(\\mathbf{k}) = 0$ by construction, since $\\mathbf{e}_1$ and $\\mathbf{e}_2$ are orthogonal to $\\hat{\\mathbf{k}}$.\n\nQuantities to compute:\n- The streamwise component is $u$ (index $i=1$), the cross-stream component is $v$ (index $i=2$). For each $\\mathbf{k}$, extract the auto-spectra $\\Phi_{11}(\\mathbf{k})$ and $\\Phi_{22}(\\mathbf{k})$, and the cross-spectrum $\\Phi_{12}(\\mathbf{k})$. Define the magnitude of the coherence for a given $\\mathbf{k}$ as\n$$\nC_{uv}(\\mathbf{k}) = \\frac{|\\Phi_{12}(\\mathbf{k})|}{\\sqrt{\\Phi_{11}(\\mathbf{k}) \\, \\Phi_{22}(\\mathbf{k})}},\n$$\nwhich is mathematically bounded by $0 \\le C_{uv}(\\mathbf{k}) \\le 1$ for positive-semidefinite matrices.\n- Define the normalized mean cross-spectrum over a grid $\\mathcal{K}$ of wavenumbers by\n$$\n\\overline{C}_{12} = \\frac{\\sum_{\\mathbf{k}\\in \\mathcal{K}} \\Phi_{12}(\\mathbf{k})}{\\sum_{\\mathbf{k}\\in \\mathcal{K}} \\left(\\Phi_{11}(\\mathbf{k}) + \\Phi_{22}(\\mathbf{k})\\right)}.\n$$\n- Define the minimum eigenvalue across the grid\n$$\n\\lambda_{\\min} = \\min_{\\mathbf{k}\\in \\mathcal{K}} \\min \\, \\mathrm{eig}\\left(\\Phi(\\mathbf{k})\\right),\n$$\nwhere $\\Phi(\\mathbf{k})$ is the $3 \\times 3$ matrix with entries $\\Phi_{ij}(\\mathbf{k})$.\n- Define the maximum normalized divergence defect across the grid to assess numerical enforcement of incompressibility:\n$$\nD_{\\max} = \\max_{\\mathbf{k}\\in \\mathcal{K}} \\max_{j\\in\\{1,2,3\\}} \\frac{\\left| \\sum_{i=1}^3 k_i \\Phi_{ij}(\\mathbf{k}) \\right|}{E(k) \\, \\|\\mathbf{k}\\|}.\n$$\n\nEnergy spectrum specification:\n- Use a non-dimensional scalar spectrum\n$$\nE(k) = \\frac{k^4}{k_0^4 + k^4} \\, k^{-5/3} \\, \\exp\\!\\left(-\\left(\\frac{k}{k_c}\\right)^4\\right),\n$$\nwith fixed positive parameters $k_0$ and $k_c$, ensuring finite energy at small $k$ and rapid decay at large $k$.\n\nNumerical grid:\n- Construct a uniform three-dimensional grid $\\mathcal{K}$ of wavenumbers with $k_x, k_y, k_z \\in \\{-k_{\\max}, \\ldots, +k_{\\max}\\}$ using an odd number of points per axis, and exclude $\\mathbf{k}=\\mathbf{0}$.\n\nAngle unit:\n- Any angle used to define the shear direction must be specified in radians.\n\nAll quantities are non-dimensional, so no physical units are required.\n\nTest suite:\n- Use the following fixed parameters in your program.\n  1. Grid: $k_{\\max} = 4$, with $N_k = 9$ points per axis uniformly spaced from $-k_{\\max}$ to $+k_{\\max}$, excluding $\\mathbf{k} = \\mathbf{0}$; $k_0 = 0.5$; $k_c = 6.0$.\n  2. Anisotropy sensitivity and saturation: $\\alpha = 2.0$, $\\xi_{\\max} = 0.999999$.\n- Evaluate the four metrics under the following three shear configurations:\n  1. Case A (isotropic baseline): $\\sigma = 0$, $\\mathbf{s} = (1,0,0)$.\n     - Compute $\\overline{C}_{12}$ over the grid.\n  2. Case B (strong shear at $45^\\circ$ in the $x$–$y$ plane): $\\sigma = 200$ and $\\mathbf{s} = (\\cos\\varphi, \\sin\\varphi, 0)$ with $\\varphi = \\pi/4$ radians.\n     - Compute $\\max_{\\mathbf{k}\\in \\mathcal{K}} C_{uv}(\\mathbf{k})$.\n  3. Case C (moderate shear, general orientation): $\\sigma = 0.5$ and $\\mathbf{s} = (1, 0.5, 0)$ normalized to unit length.\n     - Compute $\\lambda_{\\min}$ over the grid.\n     - Compute $D_{\\max}$ over the grid.\n\nFinal output format:\n- Your program should produce a single line of output containing the four results as a comma-separated list enclosed in square brackets, in the order $[\\overline{C}_{12}, \\max C_{uv}, \\lambda_{\\min}, D_{\\max}]$, for Cases A, B, and C respectively, i.e., $[\\text{Case A result}, \\text{Case B result}, \\text{Case C } \\lambda_{\\min}, \\text{Case C } D_{\\max}]$. The values must be printed as floating-point numbers.\n\nYour implementation must be a complete, runnable program. It must not read any input, and it must not access any external files or networks. It must use only the Python standard library plus the following libraries: NumPy and SciPy. All angles must be in radians. All quantities are non-dimensional.", "solution": "The problem statement is assessed to be valid. It is scientifically grounded in the principles of computational fluid dynamics and turbulence theory, specifically concerning synthetic turbulence generation. It is well-posed, with all necessary definitions, parameters, and constraints provided to construct a unique, computable solution. The language is objective and the task is computationally feasible.\n\nThe solution proceeds as follows: First, we construct the discrete wavenumber grid. Then, for each wavenumber vector $\\mathbf{k}$ on this grid, we compute the spectral tensor $\\mathbf{\\Phi}(\\mathbf{k})$. This involves several steps: calculating the scalar energy spectrum $E(k)$, constructing a local orthonormal basis $\\{\\mathbf{e}_1, \\mathbf{e}_2\\}$ that encodes the shear-induced anisotropy, determining the anisotropy weights, and finally assembling the tensor. Once the tensor is known for every $\\mathbf{k}$ in the grid, we compute the four specified quantitative metrics by iterating over the grid and applying the provided formulas.\n\n### 1. Discretization and Grid Generation\nThe analysis is performed on a discrete, three-dimensional Cartesian grid of wavenumbers, denoted $\\mathcal{K}$.\n- The grid is defined by $N_k = 9$ points along each of the $k_x$, $k_y$, and $k_z$ axes, spaced uniformly from $-k_{\\max}=-4$ to $+k_{\\max}=4$. The resulting grid points are $k_i \\in \\{-4, -3, -2, -1, 0, 1, 2, 3, 4\\}$.\n- The grid $\\mathcal{K}$ consists of all possible vectors $\\mathbf{k} = (k_x, k_y, k_z)$ formed from these points, with the single point $\\mathbf{k}=(0,0,0)$ excluded. This results in $N_k^3 - 1 = 9^3 - 1 = 728$ wavenumber vectors.\n\n### 2. Spectral Tensor Construction for a single $\\mathbf{k}$\nFor each non-zero wavenumber vector $\\mathbf{k} \\in \\mathcal{K}$, the spectral tensor $\\Phi_{ij}(\\mathbf{k})$ is constructed following the specified model.\n\n#### 2.1. Scalar Energy Spectrum\nThe model assumes that the total turbulent kinetic energy at a given wavenumber magnitude $k = \\|\\mathbf{k}\\|$ is distributed according to a scalar energy spectrum $E(k)$. The specified non-dimensional form is:\n$$\nE(k) = \\frac{k^4}{k_0^4 + k^4} \\, k^{-5/3} \\, \\exp\\!\\left(-\\left(\\frac{k}{k_c}\\right)^4\\right)\n$$\nwith fixed parameters $k_0 = 0.5$ and $k_c = 6.0$. The term $\\frac{k^4}{k_0^4 + k^4}$ ensures that energy goes to zero for $k \\to 0$ (finiteness of integral scales), the $k^{-5/3}$ term represents the inertial subrange following Kolmogorov's theory, and the exponential term provides a rapid viscous cutoff at high wavenumbers.\n\n#### 2.2. Anisotropic Basis Construction\nAnisotropy is introduced by orienting the distribution of energy in the plane perpendicular to $\\mathbf{k}$ relative to the mean shear direction $\\mathbf{s}$. This requires an orthonormal basis $\\{\\mathbf{e}_1, \\mathbf{e}_2\\}$ for this plane.\n1.  The unit wavenumber vector is $\\hat{\\mathbf{k}} = \\mathbf{k} / \\|\\mathbf{k}\\|$.\n2.  The projection of the shear vector $\\mathbf{s}$ onto the plane perpendicular to $\\hat{\\mathbf{k}}$ is calculated: $\\mathbf{s}_\\perp = \\mathbf{s} - (\\mathbf{s} \\cdot \\hat{\\mathbf{k}})\\hat{\\mathbf{k}}$. The magnitude $\\|\\mathbf{s}_\\perp\\|$ quantifies how much the shear direction \"tilts\" out of the direction of the wave vector.\n3.  The first basis vector $\\mathbf{e}_1$ is aligned with this projected shear direction: $\\mathbf{e}_1 = \\mathbf{s}_\\perp / \\|\\mathbf{s}_\\perp\\|$. This defines the primary direction of anisotropy.\n4.  A robust fallback is required for the case where $\\|\\mathbf{s}_\\perp\\|$ is close to zero (i.e., $\\mathbf{s}$ is nearly parallel to $\\hat{\\mathbf{k}}$). In this situation, the shear does not induce a preferred orientation in the plane, and any orthonormal basis will suffice. A numerically stable method is to construct the basis from $\\hat{\\mathbf{k}}$ and a fixed reference vector. We choose a reference vector $\\mathbf{v}_{\\text{ref}}$ that is not parallel to $\\hat{\\mathbf{k}}$ (e.g., by selecting the Cartesian axis least aligned with $\\hat{\\mathbf{k}}$). We then construct $\\mathbf{e}_2 = (\\hat{\\mathbf{k}} \\times \\mathbf{v}_{\\text{ref}}) / \\|\\hat{\\mathbf{k}} \\times \\mathbf{v}_{\\text{ref}}\\|$ and subsequently $\\mathbf{e}_1 = \\mathbf{e}_2 \\times \\hat{\\mathbf{k}}$. This ensures a valid basis.\n5.  The second basis vector is then defined to complete a right-handed system with $\\mathbf{e}_1$ and $\\hat{\\mathbf{k}}$: $\\mathbf{e}_2 = \\hat{\\mathbf{k}} \\times \\mathbf{e}_1$. Since $\\mathbf{e}_1$ and $\\hat{\\mathbf{k}}$ are orthogonal unit vectors, $\\mathbf{e}_2$ is automatically a unit vector orthogonal to both.\n\n#### 2.3. Anisotropy Formulation\nThe degree of energy redistribution is controlled by the anisotropy index $\\xi(\\mathbf{k})$:\n$$\n\\xi(\\mathbf{k}) = \\mathrm{clip}\\left(\\alpha\\, \\sigma \\, \\|\\mathbf{s}_\\perp\\|, \\, -\\xi_{\\max}, \\, \\xi_{\\max}\\right)\n$$\nHere, $\\sigma$ is the shear rate, $\\alpha=2.0$ is the sensitivity, and $\\xi_{\\max}=0.999999$ is a saturation limit preventing full collapse onto one direction.\nThe energy is partitioned between the basis vectors $\\mathbf{e}_1$ and $\\mathbf{e}_2$ using weights:\n$$\na(\\mathbf{k}) = \\frac{1 + \\xi(\\mathbf{k})}{2}, \\quad b(\\mathbf{k}) = \\frac{1 - \\xi(\\mathbf{k})}{2}\n$$\nBy construction, $a(\\mathbf{k}) + b(\\mathbf{k}) = 1$ and $a,b \\in [0,1]$.\n\n#### 2.4. Final Spectral Tensor\nThe spectral tensor is assembled as a weighted sum of the dyadic products of the basis vectors:\n$$\n\\Phi_{ij}(\\mathbf{k}) = E(k)\\left[ a(\\mathbf{k}) \\, e_{1,i} e_{1,j} + b(\\mathbf{k}) \\, e_{2,i} e_{2,j} \\right]\n$$\nThis form guarantees that $\\Phi_{ij}$ is symmetric ($\\Phi_{ij}=\\Phi_{ji}$) and positive-semidefinite. The incompressibility condition, $k_i \\Phi_{ij}(\\mathbf{k}) = 0$, is satisfied analytically because both $\\mathbf{e}_1$ and $\\mathbf{e}_2$ are orthogonal to $\\mathbf{k}$.\n\n### 3. Metric Evaluation\nThe physical and numerical properties of the model are assessed by computing four metrics over the grid $\\mathcal{K}$.\n\n1.  **Normalized Mean Cross-Spectrum ($\\overline{C}_{12}$)**: This metric measures the average correlation between streamwise ($u$, $i=1$) and cross-stream ($v$, $i=2$) velocity components.\n    $$\n    \\overline{C}_{12} = \\frac{\\sum_{\\mathbf{k}\\in \\mathcal{K}} \\Phi_{12}(\\mathbf{k})}{\\sum_{\\mathbf{k}\\in \\mathcal{K}} \\left(\\Phi_{11}(\\mathbf{k}) + \\Phi_{22}(\\mathbf{k})\\right)}\n    $$\n    For Case A (isotropic, $\\sigma=0$), $\\xi=0$ and $a=b=1/2$. The tensor simplifies to the isotropic form $\\Phi_{ij} \\propto (\\delta_{ij} - \\hat{k}_i \\hat{k}_j)$. The term $\\Phi_{12}(\\mathbf{k}) \\propto -k_x k_y$ is anti-symmetric with respect to reflections of the $k_x$ or $k_y$ axes. Due to the symmetry of the grid $\\mathcal{K}$, the sum in the numerator is analytically zero.\n\n2.  **Maximum Coherence ($\\max C_{uv}$)**: Coherence at a single wavenumber $\\mathbf{k}$ measures the strength of linear correlation.\n    $$\n    C_{uv}(\\mathbf{k}) = \\frac{|\\Phi_{12}(\\mathbf{k})|}{\\sqrt{\\Phi_{11}(\\mathbf{k}) \\, \\Phi_{22}(\\mathbf{k})}}\n    $$\n    This value is maximized over the entire grid $\\mathcal{K}$. When anisotropy is strong ($\\xi \\to \\pm 1$), the energy becomes concentrated along one basis vector, leading to coherence values close to $1$.\n\n3.  **Minimum Eigenvalue ($\\lambda_{\\min}$)**: Positive semidefiniteness requires all eigenvalues of $\\Phi(\\mathbf{k})$ to be non-negative. By construction, the matrix $a \\, \\mathbf{e}_1 \\otimes \\mathbf{e}_1 + b \\, \\mathbf{e}_2 \\otimes \\mathbf{e}_2$ has eigenvalues $a$, $b$, and $0$ (with eigenvectors $\\mathbf{e}_1$, $\\mathbf{e}_2$, and $\\hat{\\mathbf{k}}$ respectively). Thus, the eigenvalues of $\\Phi(\\mathbf{k})$ are $E(k)a(\\mathbf{k})$, $E(k)b(\\mathbf{k})$, and $0$. The minimum eigenvalue for a given $\\mathbf{k}$ is $E(k)\\min(a,b) = E(k)\\frac{1-|\\xi(\\mathbf{k})|}{2}$. The global minimum is then:\n    $$\n    \\lambda_{\\min} = \\min_{\\mathbf{k}\\in \\mathcal{K}} \\left( E(\\|\\mathbf{k}\\|) \\frac{1-|\\xi(\\mathbf{k})|}{2} \\right)\n    $$\n\n4.  **Maximum Normalized Divergence Defect ($D_{\\max}$)**: This metric assesses the numerical enforcement of the incompressibility constraint.\n    $$\n    D_{\\max} = \\max_{\\mathbf{k}\\in \\mathcal{K}} \\max_{j\\in\\{1,2,3\\}} \\frac{\\left| \\sum_{i=1}^3 k_i \\Phi_{ij}(\\mathbf{k}) \\right|}{E(k) \\, \\|\\mathbf{k}\\|}\n    $$\n    Analytically, the numerator $\\sum_i k_i \\Phi_{ij}$ is zero. Any non-zero result is due to floating-point representation and arithmetic errors in constructing the orthogonal basis vectors. This value is expected to be on the order of machine epsilon.\n\n### 4. Test Case Execution\nThe above methodology is implemented in a Python script. A main function iterates through all $\\mathbf{k} \\in \\mathcal{K}$, computes $\\Phi(\\mathbf{k})$, and updates the running values for each of the four metrics. The appropriate parameters for Cases A, B, and C are supplied to this function, and the required final metrics are collected and printed.\n- **Case A**: $\\sigma=0$, $\\mathbf{s}=(1,0,0)$. Compute $\\overline{C}_{12}$.\n- **Case B**: $\\sigma=200$, $\\mathbf{s}=(\\cos(\\pi/4), \\sin(\\pi/4), 0)$. Compute $\\max_{\\mathbf{k}} C_{uv}(\\mathbf{k})$.\n- **Case C**: $\\sigma=0.5$, $\\mathbf{s}=\\text{normalized}(1,0.5,0)$. Compute $\\lambda_{\\min}$ and $D_{\\max}$.\nThe final output is an array of these four computed values.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Although scipy is listed as available, it is not required for this problem\n# as all necessary functionality is provided by numpy.\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the computation for all test cases and print the final result.\n    \"\"\"\n\n    # --- Fixed Parameters ---\n    # Grid parameters\n    k_max = 4.0\n    N_k = 9\n    # Energy spectrum parameters\n    k0 = 0.5\n    kc = 6.0\n    # Anisotropy parameters\n    alpha = 2.0\n    xi_max = 0.999999\n\n    # --- Test Case Definitions ---\n    # Case A: Isotropic baseline\n    sigma_A = 0.0\n    s_A = np.array([1.0, 0.0, 0.0])\n\n    # Case B: Strong shear\n    sigma_B = 200.0\n    phi_B = np.pi / 4.0\n    s_B = np.array([np.cos(phi_B), np.sin(phi_B), 0.0])\n\n    # Case C: Moderate shear\n    sigma_C = 0.5\n    s_unnorm_C = np.array([1.0, 0.5, 0.0])\n    s_C = s_unnorm_C / np.linalg.norm(s_unnorm_C)\n    \n    # --- Generate Wavenumber Grid ---\n    k_vals = np.linspace(-k_max, k_max, N_k)\n    kx, ky, kz = np.meshgrid(k_vals, k_vals, k_vals, indexing='ij')\n    k_grid = np.stack([kx, ky, kz], axis=-1)\n    k_vectors = k_grid.reshape(-1, 3)\n    k_vectors = k_vectors[np.any(k_vectors != 0, axis=1)] # Exclude k = (0,0,0)\n\n    # --- Compute Metrics for each Case ---\n    C12_bar_A, _, _, _ = compute_metrics(k_vectors, sigma_A, s_A, k0, kc, alpha, xi_max)\n    _, max_Cuv_B, _, _ = compute_metrics(k_vectors, sigma_B, s_B, k0, kc, alpha, xi_max)\n    _, _, lambda_min_C, D_max_C = compute_metrics(k_vectors, sigma_C, s_C, k0, kc, alpha, xi_max)\n    \n    results = [C12_bar_A, max_Cuv_B, lambda_min_C, D_max_C]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef compute_metrics(k_vectors, sigma, s, k0, kc, alpha, xi_max):\n    \"\"\"\n    Computes all four metrics for a given shear configuration across the wavenumber grid.\n    \"\"\"\n    \n    # Initialize metric accumulators\n    sum_phi12 = 0.0\n    sum_phi11_phi22 = 0.0\n    max_C_uv = 0.0\n    min_lambda = float('inf')\n    max_D = 0.0\n    \n    for k in k_vectors:\n        k_norm = np.linalg.norm(k)\n        if k_norm == 0: continue\n        k_hat = k / k_norm\n\n        # 1. Scalar Energy Spectrum\n        k_over_k0_4 = (k_norm / k0)**4\n        k_over_kc_4 = (k_norm / kc)**4\n        E_k = (k_over_k0_4 / (1.0 + k_over_k0_4)) * k_norm**(-5.0/3.0) * np.exp(-k_over_kc_4)\n        \n        # 2. Anisotropic Basis Construction {e1, e2}\n        s_dot_k_hat = np.dot(s, k_hat)\n        s_perp = s - s_dot_k_hat * k_hat\n        s_perp_norm = np.linalg.norm(s_perp)\n\n        # A small tolerance for floating point comparisons\n        tol = 1e-9\n\n        if s_perp_norm > tol:\n            e1 = s_perp / s_perp_norm\n        else: # Robust fallback when s is nearly parallel to k_hat\n            # Find axis least aligned with k_hat\n            min_axis = np.argmin(np.abs(k_hat))\n            v_ref = np.zeros(3)\n            v_ref[min_axis] = 1.0\n            # Construct e2 first, then e1, ensuring e2 = k_hat x e1\n            e2_unnorm = np.cross(k_hat, v_ref)\n            e2 = e2_unnorm / np.linalg.norm(e2_unnorm)\n            e1 = np.cross(e2, k_hat)\n\n        e2 = np.cross(k_hat, e1)\n\n        # 3. Anisotropy Formulation\n        xi = alpha * sigma * s_perp_norm\n        xi = np.clip(xi, -xi_max, xi_max)\n        \n        a_k = (1.0 + xi) / 2.0\n        b_k = (1.0 - xi) / 2.0\n        \n        # 4. Spectral Tensor Assembly\n        e1_outer = np.outer(e1, e1)\n        e2_outer = np.outer(e2, e2)\n        Phi = E_k * (a_k * e1_outer + b_k * e2_outer)\n        \n        Phi11, Phi22, Phi12 = Phi[0, 0], Phi[1, 1], Phi[0, 1]\n\n        # 5. Update Metrics\n        # Metric: Normalized Mean Cross-Spectrum\n        sum_phi12 += Phi12\n        sum_phi11_phi22 += Phi11 + Phi22\n        \n        # Metric: Max Coherence\n        denom_C_uv = np.sqrt(Phi11 * Phi22)\n        if denom_C_uv > tol:\n            C_uv_k = np.abs(Phi12) / denom_C_uv\n            max_C_uv = max(max_C_uv, C_uv_k)\n            \n        # Metric: Min Eigenvalue\n        lambda_k = E_k * min(a_k, b_k)\n        min_lambda = min(min_lambda, lambda_k)\n        \n        # Metric: Max Divergence Defect\n        divergence_vector = np.dot(k, Phi) # This is sum_i k_i Phi_ij for j=0,1,2\n        norm_factor = E_k * k_norm\n        if norm_factor > tol:\n            D_k_vec = np.abs(divergence_vector) / norm_factor\n            max_D = max(max_D, np.max(D_k_vec))\n\n    # Finalize mean cross-spectrum calculation\n    C12_bar = sum_phi12 / sum_phi11_phi22 if abs(sum_phi11_phi22) > tol else 0.0\n    \n    return C12_bar, max_C_uv, min_lambda, max_D\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3369476"}, {"introduction": "The ultimate test of a synthetic turbulence method is its performance within a larger simulation—does it generate turbulence that behaves correctly as it evolves downstream, without introducing unphysical artifacts? This practice [@problem_id:3369522] places you in the role of a CFD practitioner comparing two popular techniques, the Synthetic Eddy Method (SEM) and the Digital Filter Method (DFM), in a challenging scenario. By analyzing a simplified evolution model for a boundary layer under an adverse pressure gradient, you will learn to quantitatively assess how well different inflow methods preserve crucial transport properties like the Reynolds shear stress, a key factor in predicting phenomena like flow separation.", "problem": "Consider a three-dimensional turbulent boundary layer subject to an adverse pressure gradient characterized by the Clauser pressure-gradient parameter $\\beta$. The objective is to assess, in a controlled and universal mathematical setting, whether synthetic inflow turbulence generated by the Synthetic Eddy Method (SEM) or the Digital Filter Method (DFM) better preserves the near-wall turbulent transport represented by the Reynolds shear stress $-u'v'$ as the flow evolves a short streamwise distance toward separation onset. The assessment must be constructed from first principles and well-tested facts, translated into an algorithm whose output is a quantifiable boolean for each test case, and implemented as a complete runnable program.\n\nYou must start from the following foundational base:\n- Reynolds decomposition and Reynolds-averaged Navier–Stokes (RANS) concepts: $u_i = \\overline{u}_i + u'_i$, $\\overline{u'_i} = 0$, and the Reynolds stress tensor $R_{ij} = \\overline{u'_i u'_j}$, with near-wall momentum transport dominated by $-R_{12} = -\\overline{u' v'}$.\n- The Reynolds stress transport equation and production terms in a boundary layer with mean shear, together with accepted modeling practice to reduce unclosed terms to tractable, time-scale-based relaxations. Specifically, use the idea that the streamwise evolution of $R_{12}$ over a short inflow development length can be approximated by a one-dimensional ordinary differential equation in the streamwise coordinate $x$ with a production term driven by the local mean shear $\\partial \\overline{U}/\\partial y$ and an effective relaxation toward an equilibrium set by the local eddy turnover time.\n\nConstruct an inflow generation and short-streamwise evolution model as follows, ensuring scientific plausibility and internal consistency while avoiding any reliance on external data:\n\n$1.$ Geometry and kinematics:\n- Let the wall-normal coordinate be $y \\in [0,\\delta]$ for boundary-layer thickness $\\delta$ (in meters).\n- Let the streamwise coordinate be $x \\in [0,L_{\\text{onset}}]$ (in meters), representing a short development length toward separation onset.\n- Let the spanwise variability enter through a crossflow factor that modulates anisotropy at inflow, emulating a three-dimensional boundary layer without resolving spanwise mean dynamics explicitly.\n\n$2.$ Mean quantities and pressure gradient:\n- Use a mean streamwise velocity magnitude $U_{\\infty}$ (in meters per second) and a wall-normal shear proxy $S(y)$ (in inverse seconds) that monotonically decays with $y$ and with increasing $\\beta$ according to $S(y) = S_0 \\exp(-\\beta)\\exp(-y/\\delta)$ where $S_0 = U_{\\infty}/\\delta$.\n- Define a convective speed for turbulence advection $U_c(y)$ as a strictly increasing function of $y$, with $U_c(y) = U_{\\infty}\\left(\\dfrac{y}{\\delta}\\right)^{1/3}$ (in meters per second), ensuring $U_c(0)=0$ and $U_c(\\delta) = U_{\\infty}$.\n\n$3.$ Inflow turbulence statistics:\n- Let the turbulent kinetic energy profile be $k(y) = k_0\\left(\\dfrac{y}{\\delta}\\right)\\exp\\left(-\\dfrac{y}{\\delta}\\right)$ (in square meters per square second).\n- Decompose $k$ into normal stress components using anisotropy fractions $c_u$, $c_v$, and $c_w$ with $c_u + c_v + c_w = 1$ and $c_u = 0.5$, $c_v = 0.2$, $c_w = 0.3$, giving $R_{11}(y) = c_u k(y)$, $R_{22}(y) = c_v k(y)$, $R_{33}(y) = c_w k(y)$.\n- Impose a cross-correlation coefficient profile for inflow $\\rho_{12}(y)$ that captures three-dimensional amplification through a crossflow factor via $\\rho_{12}(y) = -C_{\\rho}\\left[1 + \\gamma \\dfrac{S_{\\text{cf}}}{S_0}\\right]\\left(\\dfrac{y}{\\delta}\\right)\\exp\\left(-\\dfrac{y}{\\delta}\\right)$, where $C_{\\rho}$ and $\\gamma$ are positive coefficients and $S_{\\text{cf}}$ is a spanwise shear proxy (in inverse seconds). The inflow Reynolds shear stress is then $R_{12}^{0}(y) = \\rho_{12}(y)\\sqrt{R_{11}(y)R_{22}(y)}$.\n\n$4.$ Synthetic inflow methods:\n- Synthetic Eddy Method (SEM): Model near-wall wall-normal attenuation through a wall-blocking function $f_{\\text{SEM}}(y) = 1 - \\exp\\left(-\\dfrac{y}{L_s}\\right)$, where $L_s$ is the SEM eddy size (in meters). The effective eddy length governing relaxation is $L_{e,\\text{SEM}}(y) = L_s$.\n- Digital Filter Method (DFM): Model attenuation using a filter-based function $f_{\\text{DFM}}(y) = 1 - \\exp\\left(-\\dfrac{y}{\\tfrac{1}{2}L_f}\\right)$, where $L_f$ is the DFM correlation length (in meters). The effective eddy length is $L_{e,\\text{DFM}}(y) = L_f$.\n- For each method $\\mathcal{M} \\in \\{\\text{SEM},\\text{DFM}\\}$, define an effective wall-normal normal stress entering production as $R_{22,\\mathcal{M}}^{\\text{eff}}(y) = f_{\\mathcal{M}}(y)R_{22}(y)$.\n\n$5.$ Short-streamwise evolution model:\n- Derive, from the Reynolds stress transport equation with mean shear production and a single-time-scale relaxation assumption, a reduced ordinary differential equation for the streamwise evolution of $R_{12}(y;x)$ over $x \\in [0,L_{\\text{onset}}]$ of the form\n  $\\dfrac{\\mathrm{d}R_{12}(y;x)}{\\mathrm{d}x} = \\mathcal{P}_{12}(y) - \\dfrac{R_{12}(y;x)}{\\ell_{\\mathcal{M}}(y)}$,\n  where the production $\\mathcal{P}_{12}(y)$ depends on the local shear and the effective wall-normal stress, and the relaxation length $\\ell_{\\mathcal{M}}(y)$ scales with a local eddy turnover distance for method $\\mathcal{M}$, constructed from $L_{e,\\mathcal{M}}(y)$ and $U_c(y)$. Use physically consistent sign conventions ensuring that positive $-R_{12}$ corresponds to outward momentum flux from the wall.\n- Begin the evolution at $x=0$ with $R_{12}(y;0) = R_{12}^{0}(y)$.\n\n$6.$ Near-separation metric and decision rule:\n- Define the near-wall region as $y \\in [0,0.2\\delta]$.\n- For each method, compute the average of $-R_{12}(y;L_{\\text{onset}})$ over the near-wall region, denoted $\\overline{-R_{12}}^{\\mathcal{M}}$ (in square meters per square second). Compute the inflow near-wall average $\\overline{-R_{12}^{0}}$ similarly.\n- Define the preservation ratio for method $\\mathcal{M}$ as $\\Pi_{\\mathcal{M}} = \\dfrac{\\overline{-R_{12}}^{\\mathcal{M}}}{\\overline{-R_{12}^{0}}}$ (dimensionless). A method with $\\Pi_{\\mathcal{M}}$ closer to $1$ indicates better preservation of the inflow turbulent transport over $[0,L_{\\text{onset}}]$.\n- The decision for each test case is a boolean: return $\\text{True}$ if SEM has smaller absolute deviation $|\\Pi_{\\text{SEM}} - 1|$ than DFM, otherwise return $\\text{False}$.\n\n$7.$ Numerical and unit requirements:\n- Perform all computations in the International System of Units (SI): meters, seconds, and meters per second.\n- Use a uniform $y$-grid with sufficient resolution to evaluate the averages accurately.\n- All angle measures, if any arise, must be in radians, but no angles are explicitly required in this problem.\n\n$8.$ Test suite:\nImplement the program for the following parameter sets, which together test a typical case, a stronger adverse pressure gradient condition, and a three-dimensional boundary layer with enhanced crossflow influence near separation onset. All quantities are in SI units.\n\n- Case A (general case):\n  - $\\delta = 0.05$,\n  - $U_{\\infty} = 20$,\n  - $\\beta = 0$,\n  - $k_0 = 0.4$,\n  - $C_{\\rho} = 0.3$,\n  - $\\gamma = 0.3$,\n  - $S_{\\text{cf}} = 0$,\n  - $L_s = 0.002$,\n  - $L_f = 0.02$,\n  - $L_{\\text{onset}} = 0.0001$.\n\n- Case B (adverse pressure gradient, near-separation trends):\n  - $\\delta = 0.05$,\n  - $U_{\\infty} = 15$,\n  - $\\beta = 3$,\n  - $k_0 = 0.5$,\n  - $C_{\\rho} = 0.35$,\n  - $\\gamma = 0.25$,\n  - $S_{\\text{cf}} = 0$,\n  - $L_s = 0.003$,\n  - $L_f = 0.0015$,\n  - $L_{\\text{onset}} = 0.0001$.\n\n- Case C (three-dimensional boundary layer with stronger crossflow and high adverse pressure gradient):\n  - $\\delta = 0.05$,\n  - $U_{\\infty} = 12$,\n  - $\\beta = 5$,\n  - $k_0 = 0.6$,\n  - $C_{\\rho} = 0.32$,\n  - $\\gamma = 0.4$,\n  - $S_{\\text{cf}} = 40$,\n  - $L_s = 0.001$,\n  - $L_f = 0.003$,\n  - $L_{\\text{onset}} = 0.0001$.\n\n$9.$ Final output specification:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for the three test cases in the order A, B, C. Each entry must be a boolean as defined above, for example, $\\texttt{[True,False,True]}$.\n\nNo user input is permitted. The code must be completely self-contained and runnable in any standard environment that provides numerical arrays and basic scientific computation tools.", "solution": "The problem requires a comparative assessment of the Synthetic Eddy Method (SEM) and the Digital Filter Method (DFM) for generating synthetic turbulence inflow. The assessment criterion is the preservation of the near-wall Reynolds shear stress, $-R_{12} = -\\overline{u'v'}$, over a short streamwise development length, $L_{\\text{onset}}$, in a three-dimensional turbulent boundary layer subjected to an adverse pressure gradient. The solution is formulated by constructing a simplified, one-dimensional transport model for the Reynolds shear stress $R_{12}$ and solving it for each method.\n\n**1. Formulation of the Streamwise Evolution Model**\n\nThe problem specifies that the streamwise evolution of the Reynolds shear stress, $R_{12}(y;x)$, for a fixed wall-normal position $y$ and varying streamwise coordinate $x$, is governed by a first-order ordinary differential equation (ODE). This ODE is derived from the full Reynolds stress transport equation by retaining only the mean shear production and a single-time-scale relaxation term, and then converting the temporal evolution to a spatial one using a convection velocity $U_c(y)$.\n\nThe time-based transport equation for $R_{12}$ is approximated as:\n$$\n\\frac{\\mathrm{D} R_{12}}{\\mathrm{D} t} \\approx \\mathcal{P}_{12}^{\\text{time}} - \\frac{R_{12}}{\\tau}\n$$\nwhere $\\mathcal{P}_{12}^{\\text{time}}$ is the production rate and $\\tau$ is the relaxation time scale. For a 2D mean flow $(\\overline{U}(y), 0, 0)$, the dominant production term is $\\mathcal{P}_{12}^{\\text{time}} = - \\overline{v'^2} \\frac{\\partial \\overline{U}}{\\partial y} = -R_{22} S(y)$, where $S(y)$ is the mean shear. For a stationary flow, the material derivative $\\frac{\\mathrm{D}}{\\mathrm{D}t}$ is approximated by $U_c(y)\\frac{\\mathrm{d}}{\\mathrm{d}x}$, where $U_c(y)$ is the local turbulence convection velocity. This yields:\n$$\nU_c(y) \\frac{\\mathrm{d}R_{12}}{\\mathrm{d}x} = -R_{22,\\mathcal{M}}^{\\text{eff}}(y) S(y) - \\frac{R_{12}}{\\tau_{\\mathcal{M}}(y)}\n$$\nHere, $R_{22,\\mathcal{M}}^{\\text{eff}}(y)$ is the effective wall-normal stress for method $\\mathcal{M} \\in \\{\\text{SEM}, \\text{DFM}\\}$. Rearranging to match the form specified in the problem statement, $\\frac{\\mathrm{d}R_{12}}{\\mathrm{d}x} = \\mathcal{P}_{12} - \\frac{R_{12}}{\\ell_{\\mathcal{M}}}$, we identify the production and relaxation terms:\n$$\n\\mathcal{P}_{12}(y) = -\\frac{R_{22,\\mathcal{M}}^{\\text{eff}}(y)S(y)}{U_c(y)}\n$$\n$$\n\\ell_{\\mathcal{M}}(y) = U_c(y)\\tau_{\\mathcal{M}}(y)\n$$\nThe problem states that the relaxation length $\\ell_{\\mathcal{M}}(y)$ is constructed from the effective eddy length $L_{e,\\mathcal{M}}(y)$ and the convection velocity $U_c(y)$. The simplest physically consistent time scale $\\tau_{\\mathcal{M}}$ that can be formed from these is $\\tau_{\\mathcal{M}}(y) = L_{e,\\mathcal{M}}(y)/U_c(y)$. This implies that an eddy is \"refreshed\" or decorrelated over a time it takes to convect one eddy length. Substituting this into the equation for $\\ell_{\\mathcal{M}}(y)$:\n$$\n\\ell_{\\mathcal{M}}(y) = U_c(y) \\left( \\frac{L_{e,\\mathcal{M}}(y)}{U_c(y)} \\right) = L_{e,\\mathcal{M}}(y)\n$$\nThus, the relaxation length is simply the method-dependent effective eddy length, which is given as a constant for each method: $\\ell_{\\text{SEM}}(y) = L_s$ and $\\ell_{\\text{DFM}}(y) = L_f$.\n\nThe final ODE is:\n$$\n\\frac{\\mathrm{d}R_{12}(y;x)}{\\mathrm{d}x} = -\\frac{R_{22,\\mathcal{M}}^{\\text{eff}}(y)S(y)}{U_c(y)} - \\frac{R_{12}(y;x)}{L_{e,\\mathcal{M}}}\n$$\nThis is a first-order linear non-homogeneous ODE of the form $y' + p(x)y = q(x)$, where $p(x)$ and $q(x)$ are constant with respect to $x$.\n\n**2. Analytical Solution of the ODE**\n\nFor a fixed $y$, let $R_{12}^{\\text{eq},\\mathcal{M}}(y)$ be the equilibrium value of the shear stress, which is the value attained as $x \\to \\infty$. It is found by setting $\\frac{\\mathrm{d}R_{12}}{\\mathrm{d}x}=0$:\n$$\nR_{12}^{\\text{eq},\\mathcal{M}}(y) = - \\frac{R_{22,\\mathcal{M}}^{\\text{eff}}(y)S(y)L_{e,\\mathcal{M}}}{U_c(y)}\n$$\nThe ODE can be written as:\n$$\n\\frac{\\mathrm{d}R_{12}}{\\mathrm{d}x} = -\\frac{1}{L_{e,\\mathcal{M}}} \\left( R_{12} - R_{12}^{\\text{eq},\\mathcal{M}}(y) \\right)\n$$\nWith the initial condition $R_{12}(y;0) = R_{12}^0(y)$, the solution is:\n$$\nR_{12}^{\\mathcal{M}}(y;x) = R_{12}^{\\text{eq},\\mathcal{M}}(y) + \\left( R_{12}^0(y) - R_{12}^{\\text{eq},\\mathcal{M}}(y) \\right) \\exp\\left(-\\frac{x}{L_{e,\\mathcal{M}}}\\right)\n$$\nThis equation describes the streamwise evolution of the Reynolds shear stress profile from its initial state at the inflow plane ($x=0$) toward a local equilibrium state.\n\n**3. Model Component Profiles**\n\nThe model is fully specified by the following functions of the wall-normal coordinate $y \\in [0, \\delta]$:\n- Shear proxy: $S(y) = S_0 \\exp(-\\beta)\\exp(-y/\\delta)$, with $S_0 = U_{\\infty}/\\delta$.\n- Convection velocity: $U_c(y) = U_{\\infty}\\left(\\frac{y}{\\delta}\\right)^{1/3}$.\n- Turbulent kinetic energy: $k(y) = k_0\\left(\\frac{y}{\\delta}\\right)\\exp\\left(-\\frac{y}{\\delta}\\right)$.\n- Normal Reynolds stresses: $R_{11}(y) = c_u k(y) = 0.5 k(y)$ and $R_{22}(y) = c_v k(y) = 0.2 k(y)$.\n- Inflow cross-correlation coefficient: $\\rho_{12}(y) = -C_{\\rho}\\left[1 + \\gamma \\frac{S_{\\text{cf}}}{S_0}\\right]\\left(\\frac{y}{\\delta}\\right)\\exp\\left(-\\frac{y}{\\delta}\\right)$.\n- Inflow Reynolds shear stress: $R_{12}^0(y) = \\rho_{12}(y)\\sqrt{R_{11}(y)R_{22}(y)}$.\n- Method-dependent wall-blocking/attenuation functions:\n  - SEM: $f_{\\text{SEM}}(y) = 1 - \\exp\\left(-\\frac{y}{L_s}\\right)$.\n  - DFM: $f_{\\text{DFM}}(y) = 1 - \\exp\\left(-\\frac{y}{\\frac{1}{2}L_f}\\right) = 1 - \\exp\\left(-\\frac{2y}{L_f}\\right)$.\n- Method-dependent effective normal stress: $R_{22,\\mathcal{M}}^{\\text{eff}}(y) = f_{\\mathcal{M}}(y)R_{22}(y)$.\n- Method-dependent effective eddy lengths: $L_{e,\\text{SEM}} = L_s$ and $L_{e,\\text{DFM}} = L_f$.\n\nAt $y=0$, quantities like $k(y)$, $R_{ij}(y)$, and $U_c(y)$ are zero. The equilibrium stress $R_{12}^{\\text{eq},\\mathcal{M}}(y)$ involves a ratio of terms that both go to zero. A careful analysis shows that $R_{22,\\mathcal{M}}^{\\text{eff}}(y) \\propto y^2$ and $U_c(y) \\propto y^{1/3}$ near the wall, so $R_{12}^{\\text{eq},\\mathcal{M}}(y) \\propto y^{5/3}$ and is well-defined as $0$ at $y=0$.\n\n**4. Assessment Metric and Computational Algorithm**\n\nThe assessment is based on the preservation of the near-wall Reynolds shear stress $-R_{12}$.\n1.  A uniform grid of $N_y$ points is established for $y \\in [0, \\delta]$.\n2.  The near-wall region is defined as $y \\in [0, 0.2\\delta]$.\n3.  The average near-wall shear stress at a given streamwise location $x$ is computed via numerical integration (trapezoidal rule):\n    $$\n    \\overline{-R_{12}}(x) = \\frac{1}{0.2\\delta} \\int_{0}^{0.2\\delta} -R_{12}(y;x) \\, \\mathrm{d}y\n    $$\n4.  The initial average stress, $\\overline{-R_{12}^{0}} = \\overline{-R_{12}}(0)$, is computed.\n5.  For each method $\\mathcal{M}$, the average stress at the end of the development length, $\\overline{-R_{12}^{\\mathcal{M}}} = \\overline{-R_{12}^{\\mathcal{M}}}(L_{\\text{onset}})$, is computed using the analytical solution for $R_{12}^{\\mathcal{M}}(y; L_{\\text{onset}})$.\n6.  The preservation ratio for each method is calculated:\n    $$\n    \\Pi_{\\mathcal{M}} = \\frac{\\overline{-R_{12}^{\\mathcal{M}}}}{\\overline{-R_{12}^{0}}}\n    $$\n7.  A method is considered better if its preservation ratio $\\Pi_{\\mathcal{M}}$ is closer to $1$. The decision rule is to return `True` if SEM performs better, and `False` otherwise:\n    $$\n    \\text{Result} = \\left( |\\Pi_{\\text{SEM}} - 1| < |\\Pi_{\\text{DFM}} - 1| \\right)\n    $$\nThis procedure is applied to each of the three test cases provided.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the synthetic turbulence inflow comparison problem for the given test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case A (general case)\n        {\n            \"delta\": 0.05, \"U_inf\": 20.0, \"beta\": 0.0, \"k0\": 0.4,\n            \"C_rho\": 0.3, \"gamma\": 0.3, \"S_cf\": 0.0,\n            \"Ls\": 0.002, \"Lf\": 0.02, \"L_onset\": 0.0001\n        },\n        # Case B (adverse pressure gradient)\n        {\n            \"delta\": 0.05, \"U_inf\": 15.0, \"beta\": 3.0, \"k0\": 0.5,\n            \"C_rho\": 0.35, \"gamma\": 0.25, \"S_cf\": 0.0,\n            \"Ls\": 0.003, \"Lf\": 0.0015, \"L_onset\": 0.0001\n        },\n        # Case C (3D boundary layer with high APG)\n        {\n            \"delta\": 0.05, \"U_inf\": 12.0, \"beta\": 5.0, \"k0\": 0.6,\n            \"C_rho\": 0.32, \"gamma\": 0.4, \"S_cf\": 40.0,\n            \"Ls\": 0.001, \"Lf\": 0.003, \"L_onset\": 0.0001\n        }\n    ]\n\n    results = []\n    for params in test_cases:\n        result = run_case(params)\n        results.append(result)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_case(params):\n    \"\"\"\n    Computes the result for a single test case.\n    \"\"\"\n    # Unpack parameters\n    delta = params[\"delta\"]\n    U_inf = params[\"U_inf\"]\n    beta = params[\"beta\"]\n    k0 = params[\"k0\"]\n    C_rho = params[\"C_rho\"]\n    gamma = params[\"gamma\"]\n    S_cf = params[\"S_cf\"]\n    Ls = params[\"Ls\"]\n    Lf = params[\"Lf\"]\n    L_onset = params[\"L_onset\"]\n\n    # Constants\n    c_u = 0.5\n    c_v = 0.2\n    \n    # Numerical grid\n    Ny = 2001  # Sufficient resolution for y-grid\n    y = np.linspace(0, delta, Ny)\n    y_norm = y / delta\n\n    # --- 1. Compute y-dependent profiles ---\n\n    S0 = U_inf / delta\n    S = S0 * np.exp(-beta) * np.exp(-y_norm)\n\n    # Convective velocity U_c(y)\n    U_c = U_inf * (y_norm)**(1/3)\n\n    # Turbulent kinetic energy k(y)\n    k = k0 * y_norm * np.exp(-y_norm)\n\n    # Reynolds stress components at inflow\n    R11 = c_u * k\n    R22 = c_v * k\n    \n    # Inflow cross-correlation coefficient rho_12(y)\n    rho12 = -C_rho * (1 + gamma * S_cf / S0) * y_norm * np.exp(-y_norm)\n\n    # Inflow Reynolds shear stress R12_0(y)\n    R12_0 = rho12 * np.sqrt(R11 * R22)\n    \n    # Handle the behavior at y=0 where U_c is zero\n    # The term R12_eq involves division by U_c.\n    # At y=0, R22_eff is 0, so the expression is 0/0.\n    # We evaluate the limit, which is 0, by setting the value at y=0 explicitly.\n    with np.errstate(divide='ignore', invalid='ignore'):\n        # For SEM\n        f_sem = 1.0 - np.exp(-y / Ls)\n        R22_eff_sem = f_sem * R22\n        Le_sem = Ls\n        R12_eq_sem = - (R22_eff_sem * S * Le_sem) / U_c\n\n        # For DFM\n        f_dfm = 1.0 - np.exp(-2.0 * y / Lf)\n        R22_eff_dfm = f_dfm * R22\n        Le_dfm = Lf\n        R12_eq_dfm = - (R22_eff_dfm * S * Le_dfm) / U_c\n\n    R12_eq_sem[0] = 0.0\n    R12_eq_dfm[0] = 0.0\n    \n    # --- 2. Compute evolved stress profiles at L_onset ---\n\n    # For SEM\n    R12_sem_L = R12_eq_sem + (R12_0 - R12_eq_sem) * np.exp(-L_onset / Le_sem)\n\n    # For DFM\n    R12_dfm_L = R12_eq_dfm + (R12_0 - R12_eq_dfm) * np.exp(-L_onset / Le_dfm)\n    \n    # --- 3. Compute near-wall averages and preservation ratios ---\n    \n    # Define near-wall region for integration: y in [0, 0.2*delta]\n    integration_limit_y = 0.2 * delta\n    integration_idx = np.where(y <= integration_limit_y)[0]\n    y_integrate = y[integration_idx]\n    \n    # Quantities to integrate (note the sign for -R12)\n    neg_R12_0_integrate = -R12_0[integration_idx]\n    neg_R12_sem_integrate = -R12_sem_L[integration_idx]\n    neg_R12_dfm_integrate = -R12_dfm_L[integration_idx]\n    \n    # Compute integrals using trapezoidal rule\n    integral_neg_R12_0 = np.trapz(neg_R12_0_integrate, y_integrate)\n    integral_neg_R12_sem = np.trapz(neg_R12_sem_integrate, y_integrate)\n    integral_neg_R12_dfm = np.trapz(neg_R12_dfm_integrate, y_integrate)\n    \n    # Compute averages\n    avg_neg_R12_0 = integral_neg_R12_0 / integration_limit_y\n    avg_neg_R12_sem = integral_neg_R12_sem / integration_limit_y\n    avg_neg_R12_dfm = integral_neg_R12_dfm / integration_limit_y\n    \n    # Compute preservation ratios\n    pi_sem = avg_neg_R12_sem / avg_neg_R12_0\n    pi_dfm = avg_neg_R12_dfm / avg_neg_R12_0\n    \n    # --- 4. Decision ---\n    \n    # Return True if SEM has smaller deviation from 1.0, False otherwise.\n    return abs(pi_sem - 1.0) < abs(pi_dfm - 1.0)\n\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3369522"}]}