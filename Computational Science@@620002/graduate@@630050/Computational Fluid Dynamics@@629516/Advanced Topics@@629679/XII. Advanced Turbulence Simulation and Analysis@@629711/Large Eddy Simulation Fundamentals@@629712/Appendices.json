{"hands_on_practices": [{"introduction": "To begin our hands-on exploration of Large Eddy Simulation (LES), we first need to build a concrete intuition for its most fundamental operation: spatial filtering. This exercise demystifies the mathematical concept of convolution by applying a simple top-hat filter to a single Fourier mode—a sine wave. By working through this calculation [@problem_id:3338942], you will derive the filter's transfer function and see precisely how it attenuates small-scale information, establishing the concept of a spectral cutoff wavenumber that is central to the LES method.", "problem": "In Large Eddy Simulation (LES), spatial filtering is defined by convolution of a field with a filter kernel. Consider a one-dimensional, spatially homogeneous filter with kernel $G(x;\\Delta)$ of compact support of width $\\Delta$, and define the filtered field $\\bar{\\phi}(x)$ by the convolution $\\bar{\\phi}(x) = \\int_{-\\infty}^{\\infty} G(r;\\Delta)\\,\\phi(x-r)\\,dr$. Take the top-hat kernel $G(x;\\Delta) = \\Delta^{-1}\\,\\mathbb{1}_{|x|\\Delta/2}$ and the scalar field $\\phi(x) = \\sin(k x)$, where $k$ is a real wavenumber. Starting only from the definition of convolution and basic trigonometric identities, derive a closed-form expression for $\\bar{\\phi}(x)$ as a function of $k$, $\\Delta$, and $x$. Then, define the effective spectral cutoff wavenumber $k_c$ as the smallest positive $k$ for which the magnitude of the filter’s one-dimensional transfer function vanishes, and express the corresponding nondimensional product $k_c \\Delta$. Provide your final answer as a single row vector whose first entry is the exact expression for $\\bar{\\phi}(x)$ and whose second entry is the exact value of $k_c \\Delta$. No rounding is required, and no units should be included in the final answer.", "solution": "The problem statement is critically validated before attempting a solution.\n\n### Step 1: Extract Givens\n- **Definition of spatial filtering:** The filtered field $\\bar{\\phi}(x)$ is the convolution of the field $\\phi(x)$ with a filter kernel $G(x;\\Delta)$: $\\bar{\\phi}(x) = \\int_{-\\infty}^{\\infty} G(r;\\Delta)\\,\\phi(x-r)\\,dr$.\n- **Filter kernel:** One-dimensional top-hat filter kernel, $G(x;\\Delta) = \\Delta^{-1}\\,\\mathbb{1}_{|x|\\Delta/2}$, where $\\mathbb{1}$ is the indicator function and $\\Delta$ is the filter width.\n- **Scalar field:** A single-wavenumber sinusoidal field, $\\phi(x) = \\sin(k x)$, where $k$ is a real wavenumber.\n- **Definition of cutoff wavenumber:** The effective spectral cutoff wavenumber $k_c$ is the smallest positive value of $k$ for which the magnitude of the filter’s one-dimensional transfer function vanishes.\n- **Task:** Derive a closed-form expression for $\\bar{\\phi}(x)$ and find the value of the nondimensional product $k_c \\Delta$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed against the validation criteria.\n- **Scientifically Grounded:** The problem is a standard exercise in the mathematical foundations of Large Eddy Simulation (LES), a major topic in computational fluid dynamics. The concepts of convolution, filter kernels, and transfer functions are fundamental principles in signal processing and turbulence theory.\n- **Well-Posed:** All necessary functions ($G$, $\\phi$), definitions (convolution, $k_c$), and constraints are provided. The problem is self-contained and structured to yield a unique solution.\n- **Objective:** The language is formal and precise, with no subjective or ambiguous statements.\n- **No other flaws are detected:** The problem is not unsound, incomplete, contradictory, unrealistic, or ill-posed.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A complete, reasoned solution will be provided.\n\n### Solution Derivation\nThe first step is to derive the expression for the filtered field $\\bar{\\phi}(x)$ by evaluating the convolution integral.\nThe definition of the filtered field is:\n$$\n\\bar{\\phi}(x) = \\int_{-\\infty}^{\\infty} G(r;\\Delta)\\,\\phi(x-r)\\,dr\n$$\nSubstituting the given expressions for the filter kernel $G(r;\\Delta)$ and the scalar field $\\phi(x)$:\n$$\n\\bar{\\phi}(x) = \\int_{-\\infty}^{\\infty} \\left(\\frac{1}{\\Delta}\\,\\mathbb{1}_{|r|\\Delta/2}\\right) \\sin(k(x-r))\\,dr\n$$\nThe indicator function $\\mathbb{1}_{|r|\\Delta/2}$ is equal to $1$ for $-\\Delta/2  r  \\Delta/2$ and $0$ otherwise. This property restricts the limits of integration:\n$$\n\\bar{\\phi}(x) = \\frac{1}{\\Delta} \\int_{-\\Delta/2}^{\\Delta/2} \\sin(k(x-r))\\,dr\n$$\nTo evaluate this integral, we use the trigonometric identity for the sine of a difference: $\\sin(A-B) = \\sin(A)\\cos(B) - \\cos(A)\\sin(B)$. Let $A = kx$ and $B = kr$.\n$$\n\\sin(k(x-r)) = \\sin(kx)\\cos(kr) - \\cos(kx)\\sin(kr)\n$$\nSubstituting this into the integral:\n$$\n\\bar{\\phi}(x) = \\frac{1}{\\Delta} \\int_{-\\Delta/2}^{\\Delta/2} \\left[ \\sin(kx)\\cos(kr) - \\cos(kx)\\sin(kr) \\right]\\,dr\n$$\nSince $\\sin(kx)$ and $\\cos(kx)$ do not depend on the integration variable $r$, they can be factored out of the integral:\n$$\n\\bar{\\phi}(x) = \\frac{\\sin(kx)}{\\Delta} \\int_{-\\Delta/2}^{\\Delta/2} \\cos(kr)\\,dr - \\frac{\\cos(kx)}{\\Delta} \\int_{-\\Delta/2}^{\\Delta/2} \\sin(kr)\\,dr\n$$\nWe now evaluate the two integrals separately.\nThe first integral involves an even function, $\\cos(kr)$, integrated over a symmetric interval:\n$$\n\\int_{-\\Delta/2}^{\\Delta/2} \\cos(kr)\\,dr = \\left[ \\frac{\\sin(kr)}{k} \\right]_{-\\Delta/2}^{\\Delta/2} = \\frac{\\sin(k\\Delta/2)}{k} - \\frac{\\sin(-k\\Delta/2)}{k}\n$$\nSince $\\sin(-z) = -\\sin(z)$, this simplifies to:\n$$\n\\frac{\\sin(k\\Delta/2)}{k} + \\frac{\\sin(k\\Delta/2)}{k} = \\frac{2}{k} \\sin\\left(\\frac{k\\Delta}{2}\\right)\n$$\nThe second integral involves an odd function, $\\sin(kr)$, integrated over a symmetric interval. Such an integral is always zero. We can verify this explicitly:\n$$\n\\int_{-\\Delta/2}^{\\Delta/2} \\sin(kr)\\,dr = \\left[ -\\frac{\\cos(kr)}{k} \\right]_{-\\Delta/2}^{\\Delta/2} = -\\frac{\\cos(k\\Delta/2)}{k} - \\left(-\\frac{\\cos(-k\\Delta/2)}{k}\\right)\n$$\nSince $\\cos(-z) = \\cos(z)$, this simplifies to:\n$$\n-\\frac{\\cos(k\\Delta/2)}{k} + \\frac{\\cos(k\\Delta/2)}{k} = 0\n$$\nSubstituting these results back into the expression for $\\bar{\\phi}(x)$:\n$$\n\\bar{\\phi}(x) = \\frac{\\sin(kx)}{\\Delta} \\left( \\frac{2}{k} \\sin\\left(\\frac{k\\Delta}{2}\\right) \\right) - \\frac{\\cos(kx)}{\\Delta} (0)\n$$\n$$\n\\bar{\\phi}(x) = \\frac{2}{k\\Delta} \\sin\\left(\\frac{k\\Delta}{2}\\right) \\sin(kx)\n$$\nThis expression can be conveniently rewritten to highlight the filter's transfer function. By rearranging the terms, we get the first part of the required answer:\n$$\n\\bar{\\phi}(x) = \\frac{\\sin(k\\Delta/2)}{k\\Delta/2} \\sin(kx)\n$$\n\nThe second step is to determine the nondimensional product $k_c \\Delta$.\nThe application of a filter to a single Fourier mode $\\exp(ikx)$ results in the mode being multiplied by the filter's transfer function, $\\hat{G}(k)$. For a real-valued field like $\\phi(x) = \\sin(kx)$, the filtered field is $\\bar{\\phi}(x) = \\hat{G}(k)\\phi(x)$, assuming the kernel $G(x)$ is real and even, which is true for the top-hat kernel.\nBy comparing our derived expression for $\\bar{\\phi}(x)$ with the form $\\hat{G}(k)\\phi(x) = \\hat{G}(k)\\sin(kx)$, we can identify the transfer function:\n$$\n\\hat{G}(k) = \\frac{\\sin(k\\Delta/2)}{k\\Delta/2}\n$$\nThis is the normalized sinc function, $\\text{sinc}(k\\Delta/2)$.\nAccording to the problem definition, $k_c$ is the smallest positive wavenumber $k$ for which the magnitude of the transfer function, $|\\hat{G}(k)|$, is zero. Since $\\hat{G}(k)$ is real, this is equivalent to finding the smallest positive $k$ for which $\\hat{G}(k) = 0$.\n$$\n\\frac{\\sin(k_c\\Delta/2)}{k_c\\Delta/2} = 0\n$$\nFor this expression to be zero, the numerator must be zero, while the denominator is non-zero (the case $k_c=0$ is excluded as we seek a positive wavenumber, and in the limit $k\\to 0$, $\\hat{G}(k) \\to 1$).\nThe condition is therefore:\n$$\n\\sin\\left(\\frac{k_c\\Delta}{2}\\right) = 0\n$$\nThe general solution for $\\sin(\\theta) = 0$ is $\\theta = n\\pi$ for any integer $n$. Thus:\n$$\n\\frac{k_c\\Delta}{2} = n\\pi, \\quad n \\in \\mathbb{Z}\n$$\nWe seek the smallest positive wavenumber $k_c$. Since the filter width $\\Delta$ is positive, we must have $n  0$. The smallest positive integer is $n=1$.\n$$\n\\frac{k_c\\Delta}{2} = \\pi\n$$\nSolving for the nondimensional product $k_c \\Delta$ gives the second part of the required answer:\n$$\nk_c \\Delta = 2\\pi\n$$\nThe physical interpretation is that the top-hat filter completely removes waves whose wavelength $\\lambda = 2\\pi/k_c$ is equal to the filter width $\\Delta$, i.e., $\\lambda_c = \\Delta$.\n\nThe final answer consists of the expression for $\\bar{\\phi}(x)$ and the value of $k_c \\Delta$.", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{\\sin(k\\Delta/2)}{k\\Delta/2} \\sin(kx)  2\\pi \\end{pmatrix}}\n$$", "id": "3338942"}, {"introduction": "Having established how a filter selectively removes small scales, we now turn to the physical motivation for this procedure in the context of turbulence. LES is fundamentally an approach to resolving the most energetic eddies in a flow while modeling the smaller, more universal scales. This practice [@problem_id:3338969] connects the abstract filter cutoff, $k_c$, to the physical reality of the turbulent energy cascade. Using cornerstone principles from Kolmogorov's theory, you will estimate the fraction of the total energy flux that is explicitly resolved by an LES, providing a quantitative understanding of what is captured and what must be modeled.", "problem": "A cubic, triply periodic domain of side length $L$ contains statistically stationary, homogeneous and isotropic, incompressible turbulence forced at the box scale. The large (integral) wavenumber is $k_0 = 2\\pi/L$. In the inertial range between $k_0$ and the Kolmogorov wavenumber $k_{\\eta} = 1/\\eta$, the one-dimensional energy spectrum follows the Kolmogorov form $E(k) \\propto \\varepsilon^{2/3} k^{-5/3}$, where $\\varepsilon$ is the mean energy dissipation rate per unit mass. A Large Eddy Simulation (LES) filter of width $\\Delta$ imposes a sharp spectral cutoff at $k_c \\approx \\pi/\\Delta$.\n\nUsing only dimensional reasoning and core definitions from turbulence theory, do the following:\n\n1) Starting from the inertial-range form of $E(k)$ and the definition of a scale-local eddy turnover time $\\tau(k)$, derive an expression for the cumulative forward energy transfer rate from wavenumbers in $[k_0, K]$ estimated as $\\Pi(K) \\sim \\int_{k_0}^{K} E(k)/\\tau(k)\\, \\mathrm{d}k$, and show that the ratio of the LES-resolved cumulative transfer to the total cumulative transfer across the inertial range,\n$$\nf \\equiv \\frac{\\Pi(k_c)}{\\Pi(k_{\\eta})},\n$$\ncan be written entirely in terms of the large-scale, cutoff, and Kolmogorov wavenumbers.\n\n2) Adopt the following modeling assumptions to close the problem:\n- The eddy turnover time at scale $k$ scales as $\\tau(k) \\sim \\alpha\\, \\varepsilon^{-1/3} k^{-2/3}$, with $\\alpha$ an $\\mathcal{O}(1)$ constant.\n- The large-scale dissipation coefficient is $C_{\\varepsilon} = \\mathcal{O}(1)$ and may be taken as $C_{\\varepsilon} = 1$ so that $\\eta/L \\approx \\mathrm{Re}_L^{-3/4}$, where $\\mathrm{Re}_L \\equiv U L/\\nu$ is the large-scale Reynolds number with characteristic velocity $U$ and kinematic viscosity $\\nu$.\n\nGiven $L/\\Delta = 64$ and $\\mathrm{Re}_L = 10^{4}$, evaluate the fraction\n$$\nf = \\frac{\\Pi(k_c)}{\\Pi(k_{\\eta})}\n$$\nas a unitless decimal, rounded to four significant figures. Use $k_c \\approx \\pi/\\Delta$, $k_0 = 2\\pi/L$, and $k_{\\eta} = 1/\\eta$ with $\\eta/L \\approx \\mathrm{Re}_L^{-3/4}$ under $C_{\\varepsilon} = 1$.\n\nExpress the final answer as a single real number without units, rounded to four significant figures.", "solution": "The problem will be addressed in two parts as specified. First, a symbolic derivation of the fraction $f$ will be performed based on the provided definitions. Second, this fraction will be evaluated numerically using the given parameters.\n\n### Part 1: Symbolic Derivation of the Resolved Energy Transfer Fraction\n\nThe problem states that in the inertial range of turbulence, defined by wavenumbers $k$ such that $k_0 \\le k \\le k_{\\eta}$, the one-dimensional energy spectrum follows the Kolmogorov form:\n$$\nE(k) = C_K \\varepsilon^{2/3} k^{-5/3}\n$$\nwhere $C_K$ is the dimensionless Kolmogorov constant, which is of order unity, and $\\varepsilon$ is the mean energy dissipation rate per unit mass.\n\nThe problem also provides a scaling for the scale-local eddy turnover time $\\tau(k)$:\n$$\n\\tau(k) = \\alpha \\varepsilon^{-1/3} k^{-2/3}\n$$\nwhere $\\alpha$ is another dimensionless constant of order unity. This scaling is consistent with dimensional analysis based on Kolmogorov's theory.\n\nThe cumulative forward energy transfer rate from large scales (corresponding to wavenumber $k_0$) up to a wavenumber $K$ is estimated by the integral:\n$$\n\\Pi(K) \\sim \\int_{k_0}^{K} \\frac{E(k)}{\\tau(k)} \\, \\mathrm{d}k\n$$\nWe first evaluate the integrand by substituting the expressions for $E(k)$ and $\\tau(k)$:\n$$\n\\frac{E(k)}{\\tau(k)} = \\frac{C_K \\varepsilon^{2/3} k^{-5/3}}{\\alpha \\varepsilon^{-1/3} k^{-2/3}} = \\frac{C_K}{\\alpha} \\varepsilon^{(2/3 - (-1/3))} k^{(-5/3 - (-2/3))} = \\frac{C_K}{\\alpha} \\varepsilon^{1} k^{-1}\n$$\nThe quantity $\\frac{C_K}{\\alpha}$ is a dimensionless constant. Let us denote it by $C_{\\Pi} = \\frac{C_K}{\\alpha}$. The integrand simplifies to $C_{\\Pi} \\varepsilon k^{-1}$.\n\nNow we can compute the integral to find the cumulative energy transfer rate $\\Pi(K)$:\n$$\n\\Pi(K) = \\int_{k_0}^{K} C_{\\Pi} \\varepsilon k^{-1} \\, \\mathrm{d}k = C_{\\Pi} \\varepsilon \\int_{k_0}^{K} \\frac{1}{k} \\, \\mathrm{d}k\n$$\nPerforming the integration yields:\n$$\n\\Pi(K) = C_{\\Pi} \\varepsilon \\left[ \\ln(k) \\right]_{k_0}^{K} = C_{\\Pi} \\varepsilon (\\ln(K) - \\ln(k_0)) = C_{\\Pi} \\varepsilon \\ln\\left(\\frac{K}{k_0}\\right)\n$$\nThe problem defines the fraction $f$ as the ratio of the LES-resolved cumulative transfer, $\\Pi(k_c)$, to the total cumulative transfer across the entire inertial range, $\\Pi(k_{\\eta})$. The LES cutoff wavenumber is $k_c$, and the end of the inertial range is marked by the Kolmogorov wavenumber $k_{\\eta}$.\n$$\nf = \\frac{\\Pi(k_c)}{\\Pi(k_{\\eta})}\n$$\nSubstituting our expression for $\\Pi(K)$:\n$$\nf = \\frac{C_{\\Pi} \\varepsilon \\ln\\left(\\frac{k_c}{k_0}\\right)}{C_{\\Pi} \\varepsilon \\ln\\left(\\frac{k_{\\eta}}{k_0}\\right)}\n$$\nThe pre-factors $C_{\\Pi} \\varepsilon$ cancel out, leaving an expression that depends solely on the characteristic wavenumbers of the problem: the large-eddy scale $k_0$, the LES filter cutoff scale $k_c$, and the Kolmogorov dissipation scale $k_{\\eta}$.\n$$\nf = \\frac{\\ln\\left(\\frac{k_c}{k_0}\\right)}{\\ln\\left(\\frac{k_{\\eta}}{k_0}\\right)}\n$$\nThis completes the first part of the problem.\n\n### Part 2: Numerical Evaluation\n\nWe are asked to evaluate $f$ for the given parameters:\n-   Ratio of box size to filter width: $L/\\Delta = 64$.\n-   Large-scale Reynolds number: $\\mathrm{Re}_L = 10^4$.\n\nWe use the provided definitions for the wavenumbers:\n-   Large wavenumber: $k_0 = 2\\pi/L$.\n-   LES cutoff wavenumber: $k_c \\approx \\pi/\\Delta$.\n-   Kolmogorov wavenumber: $k_{\\eta} = 1/\\eta$.\n\nFirst, we calculate the ratio $k_c/k_0$:\n$$\n\\frac{k_c}{k_0} \\approx \\frac{\\pi/\\Delta}{2\\pi/L} = \\frac{\\pi}{\\Delta} \\frac{L}{2\\pi} = \\frac{1}{2} \\left(\\frac{L}{\\Delta}\\right)\n$$\nUsing the given value $L/\\Delta = 64$:\n$$\n\\frac{k_c}{k_0} \\approx \\frac{1}{2}(64) = 32\n$$\n\nNext, we calculate the ratio $k_{\\eta}/k_0$.\n$$\n\\frac{k_{\\eta}}{k_0} = \\frac{1/\\eta}{2\\pi/L} = \\frac{L}{2\\pi\\eta} = \\frac{1}{2\\pi} \\left(\\frac{L}{\\eta}\\right)\n$$\nWe are given the relation for the ratio of the Kolmogorov length scale $\\eta$ to the integral length scale $L$, which for $C_{\\varepsilon} = 1$ is $\\eta/L \\approx \\mathrm{Re}_L^{-3/4}$. This implies that the inverse ratio is:\n$$\n\\frac{L}{\\eta} \\approx (\\mathrm{Re}_L^{-3/4})^{-1} = \\mathrm{Re}_L^{3/4}\n$$\nSubstituting the given Reynolds number $\\mathrm{Re}_L = 10^4$:\n$$\n\\frac{L}{\\eta} \\approx (10^4)^{3/4} = 10^{(4 \\times 3/4)} = 10^3 = 1000\n$$\nNow we can compute the wavenumber ratio $k_{\\eta}/k_0$:\n$$\n\\frac{k_{\\eta}}{k_0} \\approx \\frac{1}{2\\pi} (1000) = \\frac{500}{\\pi}\n$$\n\nFinally, we substitute these numerical ratios into the expression for $f$:\n$$\nf = \\frac{\\ln(32)}{\\ln\\left(\\frac{500}{\\pi}\\right)}\n$$\nWe calculate the values of the numerator and the denominator:\n$$\n\\ln(32) = \\ln(2^5) = 5\\ln(2) \\approx 5 \\times 0.69314718 = 3.4657359\n$$\n$$\n\\frac{500}{\\pi} \\approx \\frac{500}{3.14159265} \\approx 159.154943\n$$\n$$\n\\ln\\left(\\frac{500}{\\pi}\\right) \\approx \\ln(159.154943) \\approx 5.0698003\n$$\nNow we compute the fraction $f$:\n$$\nf \\approx \\frac{3.4657359}{5.0698003} \\approx 0.68361304\n$$\nRounding the result to four significant figures as requested:\n$$\nf \\approx 0.6836\n$$\nThis result indicates that for the given parameters, the LES resolves approximately $68.36\\%$ of the cumulative energy transfer that occurs across the inertial range, with the remaining part being subgrid-scale and requiring a model.", "answer": "$$\n\\boxed{0.6836}\n$$", "id": "3338969"}, {"introduction": "The act of filtering separates the resolved scales from the subgrid scales (SGS), but it leaves us with the famous closure problem: we must now model the effects of these unresolved scales back on the resolved flow. This coding exercise [@problem_id:3339012] transitions from theory to computational practice, tasking you with implementing and testing a foundational SGS model. By comparing the predictions of the scale-similarity model against the exact SGS stress derived from synthetic DNS data, you will gain practical insight into a model's performance, assessing both its structural correlation and its ability to dissipate energy, thereby revealing why more sophisticated mixed models are often necessary.", "problem": "Consider an incompressible flow in two spatial dimensions and the framework of Large Eddy Simulation (LES). Starting from filtered equations, the Subgrid-Scale (SGS) stress tensor is defined by the exact relation based on Direct Numerical Simulation (DNS) data as $$\\tau_{ij}^{\\mathrm{exact}} = \\overline{u_i u_j} - \\overline{u}_i \\,\\overline{u}_j,$$ where $\\overline{\\cdot}$ denotes a spatial filter at the LES filter scale. The Scale Similarity (SS) model (also known as the Bardina model) defines a model stress using only resolved filtered fields and a test filter as $$\\tau_{ij}^{\\mathrm{SS}} = \\widehat{\\overline{u}_i \\,\\overline{u}_j} - \\widehat{\\overline{u}}_i \\,\\widehat{\\overline{u}}_j,$$ where the hat denotes a second filter (the test filter) at a larger scale. In mixed models, an eddy viscosity contribution is added to repair the mean energy transfer, defined by the Boussinesq hypothesis $$\\tau_{ij}^{\\mathrm{EV}} = -2 \\nu_t S_{ij},\\quad \\nu_t = \\left(C_s \\,\\Delta\\right)^2 \\,\\lvert S \\rvert,$$ with the resolved-rate-of-strain $$S_{ij} = \\frac{1}{2}\\left(\\frac{\\partial \\overline{u}_i}{\\partial x_j} + \\frac{\\partial \\overline{u}_j}{\\partial x_i}\\right),\\quad \\lvert S \\rvert = \\sqrt{2\\,S_{ij} S_{ij}},$$ and model constant $C_s$ and filter width $\\Delta$. The mixed stress is $$\\tau_{ij}^{\\mathrm{mix}} = \\tau_{ij}^{\\mathrm{SS}} - 2 \\nu_t S_{ij}.$$\n\nYou will implement these definitions on a discrete, periodic, two-dimensional grid with non-dimensional spacing $h = 1$ and use radians for any trigonometric evaluation. Let the domain be an $N \\times N$ grid with indices $(m,n)$, $m,n \\in \\{0,1,\\ldots,N-1\\}$. Define the DNS velocity components deterministically as functions of the grid indices:\n$$u(m,n) = \\sin\\!\\left(\\frac{2\\pi f_x}{N}\\,m\\right)\\cos\\!\\left(\\frac{2\\pi f_y}{N}\\,n\\right) + 0.3\\,\\sin\\!\\left(\\frac{4\\pi f_x}{N}\\,m\\right)\\sin\\!\\left(\\frac{6\\pi f_y}{N}\\,n\\right),$$\n$$v(m,n) = -\\cos\\!\\left(\\frac{2\\pi f_x}{N}\\,m\\right)\\sin\\!\\left(\\frac{2\\pi f_y}{N}\\,n\\right) + 0.25\\,\\cos\\!\\left(\\frac{4\\pi f_x}{N}\\,m\\right)\\cos\\!\\left(\\frac{4\\pi f_y}{N}\\,n\\right).$$\nAll trigonometric arguments are in radians.\n\nUse a discrete, separable, top-hat (box) filter with periodic boundary conditions. Let the LES filter have radius $r_f \\in \\mathbb{N}$, giving a window size $N_f = 2 r_f + 1$. The filtered field $\\overline{\\phi}$ of a scalar field $\\phi$ is the average over the $(2r_f+1)\\times(2r_f+1)$ neighborhood centered at each grid point, using periodic wrap-around. The test filter radius is $r_t = \\alpha\\,r_f$ for an integer $\\alpha \\ge 1$, giving window size $N_t = 2 r_t + 1$. Use the same discrete averaging rule for the hat filter.\n\nCompute the exact SGS stress components at the LES filter scale by filtering the DNS products and velocities as specified, and compute the SS model components by applying the test filter to products of LES-filtered velocities. Compute the resolved-rate-of-strain $S_{ij}$ from the LES-filtered velocities using second-order central differences with periodic boundary conditions and grid spacing $h=1$.\n\nDefine the non-dimensional instantaneous energy flux from resolved to subgrid scales at each grid point as\n$$\\Pi = -\\sum_{i,j=1}^{2} \\tau_{ij} S_{ij}.$$\nIn two dimensions with symmetric tensors, this can be implemented as\n$$\\Pi = -\\left(\\tau_{11} S_{11} + \\tau_{22} S_{22} + 2\\,\\tau_{12} S_{12}\\right).$$\nCompute the domain mean $\\langle \\Pi \\rangle$ by averaging $\\Pi$ over all grid points.\n\nYour tasks:\n- For each test case, compute the Pearson correlation coefficient $r$ between the flattened arrays of the exact shear stress component $\\tau_{12}^{\\mathrm{exact}}$ and the SS model prediction $\\tau_{12}^{\\mathrm{SS}}$.\n- Compute the domain mean energy flux $\\langle \\Pi \\rangle$ for the exact stress, the SS model stress, and the mixed model stress with eddy viscosity.\n\nExpress all energy fluxes in non-dimensional units and angles in radians. The outputs must be floats.\n\nTest suite:\n- Case $1$: $N = 64$, $f_x = 2$, $f_y = 3$, $r_f = 1$ (so $N_f = 3$), $\\alpha = 2$, $C_s = 0.0$.\n- Case $2$: $N = 64$, $f_x = 2$, $f_y = 3$, $r_f = 1$ (so $N_f = 3$), $\\alpha = 2$, $C_s = 0.18$.\n- Case $3$: $N = 64$, $f_x = 8$, $f_y = 9$, $r_f = 2$ (so $N_f = 5$), $\\alpha = 2$, $C_s = 0.18$.\n- Case $4$: $N = 64$, $f_x = 4$, $f_y = 5$, $r_f = 4$ (so $N_f = 9$), $\\alpha = 2$, $C_s = 0.18$.\n\nDefinitions to use in your program:\n- The LES filter width is $\\Delta = N_f \\, h$ with $h = 1$.\n- The central differences for derivatives use periodic wrap-around: for a field $\\phi$, $$\\frac{\\partial \\phi}{\\partial x} \\approx \\frac{\\phi(m,n+1) - \\phi(m,n-1)}{2h},\\quad \\frac{\\partial \\phi}{\\partial y} \\approx \\frac{\\phi(m+1,n) - \\phi(m-1,n)}{2h},$$ where indices are modulo $N$ and $h=1$.\n- The correlation coefficient $r$ uses the standard Pearson formula between two flattened arrays.\n\nYour program should produce a single line of output containing the aggregated results of all test cases as a comma-separated list enclosed in square brackets. For each test case, append in order the four floats $[r,\\langle \\Pi \\rangle_{\\mathrm{exact}},\\langle \\Pi \\rangle_{\\mathrm{SS}},\\langle \\Pi \\rangle_{\\mathrm{mix}}]$ to this single list, yielding a flat list of length $16$ for the four cases. The angles must be in radians, and energy fluxes must be non-dimensional floats.", "solution": "The user-provided problem is a well-posed computational exercise in the field of computational fluid dynamics, specifically focusing on the fundamentals of Large Eddy Simulation (LES). The problem is scientifically grounded, with all definitions conforming to standard LES literature, although with some non-standard notational choices for didactic purposes. All required data and parameters are provided, enabling a unique, deterministic solution. The problem's validity is confirmed.\n\nThe solution proceeds by implementing the specified models and numerical methods step-by-step.\n\n### 1. Grid and Velocity Field Generation\nA two-dimensional periodic domain of size $N \\times N$ is established. The grid indices are $(m,n)$, where $m, n \\in \\{0, 1, \\dots, N-1\\}$. The problem defines the velocity components of a synthetic Direct Numerical Simulation (DNS) field, $u_1$ and $u_2$ (denoted as $u$ and $v$ in the problem), as deterministic functions of these grid indices.\nThe velocity vector is $\\mathbf{u} = (u_1, u_2)$, where:\n$$u_1(m,n) = \\sin\\left(\\frac{2\\pi f_x}{N}m\\right)\\cos\\left(\\frac{2\\pi f_y}{N}n\\right) + 0.3\\sin\\left(\\frac{4\\pi f_x}{N}m\\right)\\sin\\left(\\frac{6\\pi f_y}{N}n\\right)$$\n$$u_2(m,n) = -\\cos\\left(\\frac{2\\pi f_x}{N}m\\right)\\sin\\left(\\frac{2\\pi f_y}{N}n\\right) + 0.25\\cos\\left(\\frac{4\\pi f_x}{N}m\\right)\\cos\\left(\\frac{4\\pi f_y}{N}n\\right)$$\nThese fields serve as the high-resolution \"truth\" data for the LES model analysis.\n\n### 2. Discretization of Operators\nTwo key operators are required: a spatial filter and a differentiation operator.\n\n**Spatial Filtering:** A discrete, separable, top-hat (box) filter is defined. For a given field $\\phi$, the LES-filtered field $\\overline{\\phi}$ at a grid point is the average over a square neighborhood of size $N_f \\times N_f$, where $N_f = 2r_f+1$ and $r_f$ is the filter radius. The same filtering operation, denoted by a hat ($\\widehat{\\cdot}$), is used for the test filter, but with a larger radius $r_t = \\alpha r_f$. This operation is implemented numerically by applying a 1D moving average along each axis sequentially, respecting the periodic boundary conditions.\n\n**Spatial Differentiation:** The problem defines second-order central difference schemes for the partial derivatives with respect to coordinates $x$ and $y$. A non-standard mapping is used: the derivative $\\partial/\\partial x$ is computed along the grid's second index ($n$), and $\\partial/\\partial y$ along the first index ($m$):\n$$\\frac{\\partial\\phi}{\\partial x}(m,n) \\approx \\frac{\\phi(m,n+1) - \\phi(m,n-1)}{2h}$$\n$$\\frac{\\partial\\phi}{\\partial y}(m,n) \\approx \\frac{\\phi(m+1,n) - \\phi(m-1,n)}{2h}$$\nwhere $h=1$ is the grid spacing and indices are taken modulo $N$ to enforce periodicity. When relating to the tensor index notation $\\partial/\\partial x_j$, we map $\\partial/\\partial x_1 \\to \\partial/\\partial x$ and $\\partial/\\partial x_2 \\to \\partial/\\partial y$.\n\n### 3. Subgrid-Scale (SGS) Stress Tensors\nWith the operators defined, we compute the various SGS stress tensors.\n\n**Exact SGS Stress ($\\tau_{ij}^{\\mathrm{exact}}$):** This is calculated from the DNS data. First, the DNS velocity field $\\mathbf{u}$ is filtered to obtain the resolved LES velocity field $\\overline{\\mathbf{u}}$. The tensor products of the DNS velocity components ($u_i u_j$) are also computed and then filtered. The exact SGS stress is defined as:\n$$\\tau_{ij}^{\\mathrm{exact}} = \\overline{u_i u_j} - \\overline{u}_i \\overline{u}_j$$\n\n**Scale Similarity (SS) Model Stress ($\\tau_{ij}^{\\mathrm{SS}}$):** This model, also known as the Bardina model, approximates the SGS stress using only the resolved fields. It applies a second, wider \"test\" filter to the LES fields.\n$$\\tau_{ij}^{\\mathrm{SS}} = \\widehat{\\overline{u}_i \\overline{u}_j} - \\widehat{\\overline{u}}_i \\widehat{\\overline{u}}_j$$\nFor computation, this requires applying the test filter (radius $r_t$) to the already LES-filtered fields ($\\overline{u}_i$) and their products ($\\overline{u}_i \\overline{u}_j$).\n\n### 4. Correlation Analysis\nA primary objective of LES modeling is to produce a modeled stress that is well-correlated with the exact stress. The Pearson correlation coefficient, $r$, is computed between the exact shear stress component $\\tau_{12}^{\\mathrm{exact}}$ and its SS model counterpart $\\tau_{12}^{\\mathrm{SS}}$.\n$$r(\\tau_{12}^{\\mathrm{exact}}, \\tau_{12}^{\\mathrm{SS}}) = \\frac{\\mathrm{cov}(\\tau_{12}^{\\mathrm{exact}}, \\tau_{12}^{\\mathrm{SS}})}{\\sigma_{\\tau_{12}^{\\mathrm{exact}}} \\sigma_{\\tau_{12}^{\\mathrm{SS}}}}$$\nThis is calculated on the arrays of stress values flattened into 1D vectors.\n\n### 5. SGS Energy Flux ($\\Pi$)\nAnother critical aspect of an LES model is its ability to correctly predict the energy transfer between resolved and subgrid scales. This is quantified by the SGS energy flux, $\\Pi = -\\tau_{ij} S_{ij}$, where $S_{ij}$ is the resolved-scale rate-of-strain tensor.\n\n**Resolved-Scale Rate-of-Strain ($S_{ij}$):** This tensor is computed from the LES-filtered velocity field $\\overline{\\mathbf{u}}$:\n$$S_{ij} = \\frac{1}{2}\\left(\\frac{\\partial \\overline{u}_i}{\\partial x_j} + \\frac{\\partial \\overline{u}_j}{\\partial x_i}\\right)$$\nThe specified discrete differentiation rules are used to compute the velocity gradients. Its components are:\n$$S_{11} = \\frac{\\partial \\overline{u}_1}{\\partial x_1}, \\quad S_{22} = \\frac{\\partial \\overline{u}_2}{\\partial x_2}, \\quad S_{12} = \\frac{1}{2}\\left(\\frac{\\partial \\overline{u}_1}{\\partial x_2} + \\frac{\\partial \\overline{u}_2}{\\partial x_1}\\right)$$\n\n**Mixed Model Stress ($\\tau_{ij}^{\\mathrm{mix}}$):** The SS model is known to be poorly dissipative. To correct this, an eddy-viscosity term is added, forming a mixed model.\n$$\\tau_{ij}^{\\mathrm{mix}} = \\tau_{ij}^{\\mathrm{SS}} - 2 \\nu_t S_{ij}$$\nThe eddy viscosity $\\nu_t$ is modeled using the Smagorinsky formulation:\n$$\\nu_t = (C_s \\Delta)^2 |\\overline{S}|, \\quad \\text{where} \\quad |\\overline{S}| = \\sqrt{2 S_{ij} S_{ij}}$$\nHere, $C_s$ is the Smagorinsky constant and $\\Delta = N_f h$ is the LES filter width.\n\n**Energy Flux Calculation:** The SGS energy flux is computed for each model and averaged over the domain. In 2D, the flux is:\n$$\\Pi = -(\\tau_{11}S_{11} + \\tau_{22}S_{22} + 2\\tau_{12}S_{12})$$\nWe compute the domain-averaged values $\\langle \\Pi_{\\mathrm{exact}} \\rangle$, $\\langle \\Pi_{\\mathrm{SS}} \\rangle$, and $\\langle \\Pi_{\\mathrm{mix}} \\rangle$ for each test case. For the mixed model, the flux is conveniently calculated as:\n$$\\Pi_{\\mathrm{mix}} = \\Pi_{\\mathrm{SS}} + 2 \\nu_t S_{ij}S_{ij} = \\Pi_{\\mathrm{SS}} + \\nu_t |\\overline{S}|^2 = \\Pi_{\\mathrm{SS}} + (C_s \\Delta)^2 |\\overline{S}|^3$$\n\nThe implementation proceeds by creating functions for the filtering and differentiation operations and then processing each test case to compute the four required quantities: the correlation $r$ and the three mean energy fluxes.", "answer": "```python\nimport numpy as np\n\ndef box_filter_2d(phi, r):\n    \"\"\"\n    Applies a 2D separable box filter with periodic boundary conditions.\n    \n    Args:\n        phi (np.ndarray): The 2D input field.\n        r (int): The filter radius (window size will be 2*r+1).\n        \n    Returns:\n        np.ndarray: The filtered field.\n    \"\"\"\n    if r == 0:\n        return phi\n        \n    window_size = 2 * r + 1\n    \n    # Filter along axis 0 (m-index)\n    phi_temp = np.zeros_like(phi, dtype=np.float64)\n    for i in range(-r, r + 1):\n        phi_temp += np.roll(phi, i, axis=0)\n    \n    # Filter along axis 1 (n-index)\n    phi_filtered = np.zeros_like(phi_temp, dtype=np.float64)\n    for i in range(-r, r + 1):\n        phi_filtered += np.roll(phi_temp, i, axis=1)\n    \n    # Normalize by total window area\n    phi_filtered /= (window_size * window_size)\n    \n    return phi_filtered\n\ndef calculate_derivatives(phi):\n    \"\"\"\n    Calculates spatial derivatives using second-order central differences\n    with periodic boundaries, following the problem's unconventional definitions.\n    \n    h=1 is assumed.\n    - d/dx is defined as difference along axis 1 (n-index).\n    - d/dy is defined as difference along axis 0 (m-index).\n    \n    Args:\n        phi (np.ndarray): The 2D input field.\n        \n    Returns:\n        tuple[np.ndarray, np.ndarray]: (d(phi)/dx, d(phi)/dy)\n    \"\"\"\n    h = 1.0\n    # d/dx is defined as difference along axis 1 (n-index)\n    d_dx = (np.roll(phi, -1, axis=1) - np.roll(phi, 1, axis=1)) / (2 * h)\n    \n    # d/dy is defined as difference along axis 0 (m-index)\n    d_dy = (np.roll(phi, -1, axis=0) - np.roll(phi, 1, axis=0)) / (2 * h)\n    \n    return d_dx, d_dy\n    \ndef process_case(N, fx, fy, rf, alpha, Cs):\n    \"\"\"\n    Processes a single test case and returns the required metrics.\n    \n    Returns:\n        tuple[float, float, float, float]: \n            (r, Pi_exact, Pi_ss, Pi_mix)\n    \"\"\"\n    # 1. Grid and Velocity Field Generation\n    m = np.arange(N)\n    n = np.arange(N)\n    mm, nn = np.meshgrid(m, n, indexing='ij')\n\n    u1 = (np.sin(2 * np.pi * fx / N * mm) * np.cos(2 * np.pi * fy / N * nn) +\n          0.3 * np.sin(4 * np.pi * fx / N * mm) * np.sin(6 * np.pi * fy / N * nn))\n    \n    u2 = (-np.cos(2 * np.pi * fx / N * mm) * np.sin(2 * np.pi * fy / N * nn) +\n          0.25 * np.cos(4 * np.pi * fx / N * mm) * np.cos(4 * np.pi * fy / N * nn))\n\n    # 2. LES Filtering (filter radius rf)\n    u1_bar = box_filter_2d(u1, rf)\n    u2_bar = box_filter_2d(u2, rf)\n    \n    u1u1_bar = box_filter_2d(u1 * u1, rf)\n    u2u2_bar = box_filter_2d(u2 * u2, rf)\n    u1u2_bar = box_filter_2d(u1 * u2, rf)\n\n    # 3. Exact SGS Stresses\n    tau11_exact = u1u1_bar - u1_bar * u1_bar\n    tau22_exact = u2u2_bar - u2_bar * u2_bar\n    tau12_exact = u1u2_bar - u1_bar * u2_bar\n\n    # 4. Test Filtering (filter radius rt)\n    rt = alpha * rf\n    u1_bar_hat = box_filter_2d(u1_bar, rt)\n    u2_bar_hat = box_filter_2d(u2_bar, rt)\n    \n    u1u1_bar_prod = u1_bar * u1_bar\n    u2u2_bar_prod = u2_bar * u2_bar\n    u1u2_bar_prod = u1_bar * u2_bar\n    \n    u1u1_bar_prod_hat = box_filter_2d(u1u1_bar_prod, rt)\n    u2u2_bar_prod_hat = box_filter_2d(u2u2_bar_prod, rt)\n    u1u2_bar_prod_hat = box_filter_2d(u1u2_bar_prod, rt)\n\n    # 5. Scale Similarity Model Stresses\n    tau11_ss = u1u1_bar_prod_hat - u1_bar_hat * u1_bar_hat\n    tau22_ss = u2u2_bar_prod_hat - u2_bar_hat * u2_bar_hat\n    tau12_ss = u1u2_bar_prod_hat - u1_bar_hat * u2_bar_hat\n\n    # 6. Task 1: Correlation coefficient r(tau_12^exact, tau_12^SS)\n    corr_matrix = np.corrcoef(tau12_exact.flatten(), tau12_ss.flatten())\n    r = corr_matrix[0, 1]\n\n    # 7. Resolved rate-of-strain tensor S_ij\n    du1_dx, du1_dy = calculate_derivatives(u1_bar)\n    du2_dx, du2_dy = calculate_derivatives(u2_bar)\n    \n    S11 = du1_dx\n    S22 = du2_dy\n    S12 = 0.5 * (du1_dy + du2_dx)\n\n    # 8. Task 2: Mean energy fluxes\n    # Exact SGS flux\n    Pi_exact = -(tau11_exact * S11 + tau22_exact * S22 + 2 * tau12_exact * S12)\n    mean_Pi_exact = np.mean(Pi_exact)\n\n    # SS model flux\n    Pi_ss = -(tau11_ss * S11 + tau22_ss * S22 + 2 * tau12_ss * S12)\n    mean_Pi_ss = np.mean(Pi_ss)\n    \n    # Mixed model flux\n    if Cs == 0.0:\n        mean_Pi_mix = mean_Pi_ss\n    else:\n        h = 1.0\n        Nf = 2 * rf + 1\n        Delta = Nf * h\n        \n        S_mag_sq = 2 * (S11**2 + S22**2 + 2 * S12**2)\n        S_mag = np.sqrt(S_mag_sq)\n        \n        nu_t = (Cs * Delta)**2 * S_mag\n        \n        Pi_diss_ev = nu_t * S_mag_sq\n        Pi_mix = Pi_ss + Pi_diss_ev\n        mean_Pi_mix = np.mean(Pi_mix)\n\n    return r, mean_Pi_exact, mean_Pi_ss, mean_Pi_mix\n\ndef solve():\n    \"\"\"\n    Main solver function to run all test cases and print results.\n    \"\"\"\n    test_cases = [\n        # (N, fx, fy, rf, alpha, Cs)\n        (64, 2, 3, 1, 2, 0.0),\n        (64, 2, 3, 1, 2, 0.18),\n        (64, 8, 9, 2, 2, 0.18),\n        (64, 4, 5, 4, 2, 0.18),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, fx, fy, rf, alpha, Cs = case\n        r, p_exact, p_ss, p_mix = process_case(N, fx, fy, rf, alpha, Cs)\n        results.extend([r, p_exact, p_ss, p_mix])\n\n    print(f\"[{','.join(f'{x:.6f}' for x in results)}]\")\n\nsolve()\n```", "id": "3339012"}]}