{"hands_on_practices": [{"introduction": "Before diving into the full Weighted Essentially Non-Oscillatory (WENO) scheme, it is crucial to understand its predecessor, the Essentially Non-Oscillatory (ENO) scheme. ENO's core idea is to adaptively select the single \"smoothest\" stencil from a set of candidates, thereby avoiding interpolations across discontinuities that would otherwise cause spurious oscillations. This foundational exercise [@problem_id:3391790] provides a hands-on look at this stencil-selection mechanism, challenging you to determine which stencil is chosen near a jump and why, based on the behavior of divided differences.", "problem": "Consider a one-dimensional uniform grid with nodes $x_j = x_0 + j\\,\\Delta x$ for integer $j$ and constant grid spacing $\\Delta x > 0$. Let $u(x)$ be piecewise smooth, specifically $u \\in C^2$ on each open interval not containing a discontinuity, and suppose $u(x)$ has a single jump discontinuity of nonzero magnitude strictly inside the cell $[x_i, x_{i+1}]$. Denote the pointwise data by $u_j := u(x_j)$ for all integers $j$. In the framework underlying Weighted Essentially Non-Oscillatory (WENO) schemes, the original Essentially Non-Oscillatory (ENO) reconstruction at the interface $x_{i+1/2} := x_i + \\tfrac{1}{2}\\Delta x$ for second order accuracy considers the two candidate stencils $S_L = \\{x_{i-1}, x_i\\}$ and $S_R = \\{x_i, x_{i+1}\\}$ to build a degree-$1$ polynomial interpolant. The ENO stencil-selection principle is to choose, at each decision step, the candidate whose relevant local divided difference has the smaller magnitude, thereby avoiding stencils that cross discontinuities.\n\nAssuming only the foundational facts that (i) on intervals where $u \\in C^2$, its first derivative is bounded in magnitude by some finite constant, and (ii) the first divided difference over an interval containing a jump discontinuity scales in magnitude like the jump divided by the interval length, determine which of the two candidate stencils $S_L$ or $S_R$ the ENO procedure selects for reconstructing the left-biased value $u(x_{i+1/2}^-)$ at $x_{i+1/2}$. Then, using that selected stencil, derive the resulting second-order ENO left-biased reconstructed value at $x_{i+1/2}$ as a closed-form linear combination of the nodal values $u_{i-1}$ and $u_i$ or $u_i$ and $u_{i+1}$, as appropriate. Express your final answer as that linear combination (an analytic expression).", "solution": "The problem is valid. It is a well-posed question based on an established principle in the numerical analysis of partial differential equations, specifically regarding the stencil selection mechanism in Essentially Non-Oscillatory (ENO) schemes. All terms are defined, the premises are scientifically sound, and the objective is clear.\n\nThe task is to determine which of two candidate stencils, $S_L$ or $S_R$, is selected by the second-order ENO procedure to reconstruct the value $u(x_{i+1/2}^-)$ at the cell interface $x_{i+1/2} := x_i + \\frac{1}{2}\\Delta x$, given a jump discontinuity in $u(x)$ strictly within the cell $[x_i, x_{i+1}]$. Subsequently, we must derive the reconstructed value using the selected stencil.\n\nThe two candidate stencils for a second-order (degree-$1$ polynomial) reconstruction centered around the interface $x_{i+1/2}$ are $S_L = \\{x_{i-1}, x_i\\}$ and $S_R = \\{x_i, x_{i+1}\\}$. The ENO selection principle dictates choosing the stencil associated with the divided difference of smallest magnitude. For a second-order scheme, we examine the first-order divided differences.\n\nThe first divided difference for the left stencil, $S_L$, is:\n$$\nu[x_{i-1}, x_i] = \\frac{u_i - u_{i-1}}{x_i - x_{i-1}} = \\frac{u_i - u_{i-1}}{\\Delta x}\n$$\nThe first divided difference for the right stencil, $S_R$, is:\n$$\nu[x_i, x_{i+1}] = \\frac{u_{i+1} - u_i}{x_{i+1} - x_i} = \\frac{u_{i+1} - u_i}{\\Delta x}\n$$\nThe core of the ENO procedure lies in comparing the absolute values of these two quantities: $|u[x_{i-1}, x_i]|$ and $|u[x_i, x_{i+1}]|$.\n\nWe are given that the function $u(x)$ has a single jump discontinuity located strictly inside the interval $[x_i, x_{i+1}]$. This implies that the function $u(x)$ is smooth (at least $C^2$) on the interval $[x_{i-1}, x_i]$, which corresponds to the stencil $S_L$.\n\nOn the smooth interval $[x_{i-1}, x_i]$, the Mean Value Theorem states that there exists a point $\\xi \\in (x_{i-1}, x_i)$ such that the divided difference is equal to the derivative at that point:\n$$\nu[x_{i-1}, x_i] = u'(\\xi)\n$$\nAs per the problem statement (assumption i), the derivative is bounded in magnitude, $|u'(x)| \\le C_1$ for some finite constant $C_1$, in regions of smoothness. Therefore, the magnitude of the divided difference on the smooth stencil behaves as:\n$$\n|u[x_{i-1}, x_i]| = |u'(\\xi)| = O(1)\n$$\nThis means its magnitude is bounded and does not grow as the grid spacing $\\Delta x$ decreases.\n\nFor the stencil $S_R$, the interval $[x_i, x_{i+1}]$ contains the jump discontinuity. According to the problem statement (assumption ii), the magnitude of the first divided difference across a jump discontinuity of magnitude $[u]$ scales as the jump magnitude divided by the interval length. Thus, for a nonzero jump $[u] \\neq 0$:\n$$\n|u[x_i, x_{i+1}]| = \\left| \\frac{u_{i+1} - u_i}{\\Delta x} \\right| \\approx \\frac{|[u]|}{\\Delta x} = O(\\Delta x^{-1})\n$$\nAs the grid is refined, i.e., as $\\Delta x \\to 0$, this term grows without bound.\n\nNow, we apply the ENO selection criterion: choose the stencil corresponding to the smaller magnitude divided difference. We compare the magnitudes:\n$$\n|u[x_{i-1}, x_i]| = O(1) \\quad \\text{vs.} \\quad |u[x_i, x_{i+1}]| = O(\\Delta x^{-1})\n$$\nFor a sufficiently small grid spacing $\\Delta x > 0$, it is unequivocally true that:\n$$\nO(1) \\ll O(\\Delta x^{-1})\n$$\nTherefore, $|u[x_{i-1}, x_i]| \\ll |u[x_i, x_{i+1}]|$. The ENO algorithm selects the stencil that avoids the discontinuity, which is $S_L = \\{x_{i-1}, x_i\\}$.\n\nHaving selected the stencil $S_L$, we construct the unique linear interpolating polynomial, $p(x)$, that passes through the points $(x_{i-1}, u_{i-1})$ and $(x_i, u_i)$. Using the Newton form of the interpolating polynomial centered at $x_i$:\n$$\np(x) = u_i + (x - x_i) u[x_{i-1}, x_i] = u_i + (x - x_i) \\frac{u_i - u_{i-1}}{\\Delta x}\n$$\nThe second-order ENO left-biased reconstructed value at the interface, $u_{i+1/2}^-$, is obtained by evaluating this polynomial at $x = x_{i+1/2} = x_i + \\frac{1}{2}\\Delta x$.\n$$\nu_{i+1/2}^- = p(x_{i+1/2}) = u_i + (x_{i+1/2} - x_i) \\frac{u_i - u_{i-1}}{\\Delta x}\n$$\nSubstituting $x_{i+1/2} - x_i = \\frac{1}{2}\\Delta x$:\n$$\nu_{i+1/2}^- = u_i + \\left(\\frac{1}{2}\\Delta x\\right) \\frac{u_i - u_{i-1}}{\\Delta x}\n$$\nThe $\\Delta x$ terms cancel out, yielding:\n$$\nu_{i+1/2}^- = u_i + \\frac{1}{2}(u_i - u_{i-1})\n$$\nSimplifying this expression gives the final linear combination of nodal values:\n$$\nu_{i+1/2}^- = u_i + \\frac{1}{2}u_i - \\frac{1}{2}u_{i-1} = \\frac{3}{2}u_i - \\frac{1}{2}u_{i-1}\n$$\nThis is the second-order ENO reconstructed value at $x_{i+1/2}$ from the left, derived from the stencil chosen to avoid the known discontinuity.", "answer": "$$\n\\boxed{\\frac{3}{2}u_i - \\frac{1}{2}u_{i-1}}\n$$", "id": "3391790"}, {"introduction": "WENO schemes improve upon ENO by not just selecting one stencil, but by creating a weighted average of all candidate stencils. The key lies in the nonlinear weights, which automatically assign near-zero influence to stencils crossing sharp gradients. This practice [@problem_id:3391791] demonstrates this adaptive weighting in a classic scenario: a sharp jump in the data perfectly aligned with a grid interface. By calculating the smoothness indicators and resulting weights, you will see firsthand how the scheme effectively \"turns off\" the non-smooth stencils to produce a stable, non-oscillatory reconstruction.", "problem": "Consider the scalar conservation law $u_{t} + f(u)_{x} = 0$ on a uniform one-dimensional mesh with cells $\\mathcal{C}_{i} = [x_{i-1/2}, x_{i+1/2}]$, cell centers $x_{i}$, and spacing $\\Delta x$. The finite volume (FV) approximation evolves the cell averages $\\bar{u}_{i}(t)$ through intercell fluxes that depend on reconstructed left and right states at interfaces. Assume piecewise constant cell averages with a single jump precisely aligned at the interface $x_{1/2}$:\n$$\n\\bar{u}_{i} = \\begin{cases}\n1.8, & i \\leq 0, \\\\\n-0.6, & i \\geq 1.\n\\end{cases}\n$$\nUsing the standard fifth-order Weighted Essentially Non-Oscillatory (WENO) FV reconstruction with Jiang–Shu smoothness indicators and linear weights on a uniform grid, reconstruct the left state $u_{1/2}^{-}$ from the left cell and the right state $u_{1/2}^{+}$ from the right cell at the discontinuity interface $x_{1/2}$. Take the nonlinearity parameter to be $\\epsilon = 1.0 \\times 10^{-6}$. Starting from the definitions of FV reconstruction from cell averages and the concept of nonlinear convex weights based on smoothness indicators, determine the two reconstructed interface states and provide a brief derivation grounded in these principles to explain why the WENO FV scheme maintains non-oscillatory behavior at this aligned jump and preserves conservation in the FV update. Express your final answer as the two reconstructed interface states in exact values, with no rounding, and write them as a two-entry row using the specified format.", "solution": "The problem statement is evaluated as valid. It presents a well-posed, scientifically grounded problem within the field of computational fluid dynamics, specifically concerning the behavior of Weighted Essentially Non-Oscillatory (WENO) schemes. All necessary data and parameters are provided for a unique solution.\n\nThe problem asks for the reconstructed states at the left ($u_{1/2}^{-}$) and right ($u_{1/2}^{+}$) of the interface $x_{1/2}$ for a scalar conservation law being solved with a fifth-order finite volume (FV) WENO scheme. The initial condition consists of piecewise constant cell averages:\n$$\n\\bar{u}_{i} = \\begin{cases}\n1.8, & i \\leq 0, \\\\\n-0.6, & i \\geq 1.\n\\end{cases}\n$$\nThe discontinuity is perfectly aligned with the cell interface $x_{1/2}$.\n\n**1. Reconstruction of the Left State, $u_{1/2}^{-}$**\n\nThe left-reconstructed state $u_{1/2}^{-}$ is computed using a stencil biased to the left of the interface $x_{1/2}$. For a fifth-order method, this involves a combination of three 3-cell candidate stencils, centered around cell $\\mathcal{C}_0$. The relevant cell averages are $\\bar{u}_{-2} = 1.8$, $\\bar{u}_{-1} = 1.8$, $\\bar{u}_0 = 1.8$, $\\bar{u}_1 = -0.6$, and $\\bar{u}_2 = -0.6$.\n\nThe three candidate stencils $S_k$ for the reconstruction at interface $x_{i+1/2}$ (with $i=0$ for our case) are:\n- $S_0 = \\{ \\mathcal{C}_{-2}, \\mathcal{C}_{-1}, \\mathcal{C}_{0} \\}$, with averages $\\{1.8, 1.8, 1.8\\}$.\n- $S_1 = \\{ \\mathcal{C}_{-1}, \\mathcal{C}_{0}, \\mathcal{C}_{1} \\}$, with averages $\\{1.8, 1.8, -0.6\\}$.\n- $S_2 = \\{ \\mathcal{C}_{0}, \\mathcal{C}_{1}, \\mathcal{C}_{2} \\}$, with averages $\\{1.8, -0.6, -0.6\\}$.\n\nEach stencil $S_k$ yields a third-order candidate reconstruction $u_{1/2}^{(k)}$ at the interface:\n- $u_{1/2}^{(0)} = \\frac{2}{6}\\bar{u}_{-2} - \\frac{7}{6}\\bar{u}_{-1} + \\frac{11}{6}\\bar{u}_0 = (\\frac{2}{6} - \\frac{7}{6} + \\frac{11}{6}) \\times 1.8 = \\frac{6}{6} \\times 1.8 = 1.8$.\n- $u_{1/2}^{(1)} = -\\frac{1}{6}\\bar{u}_{-1} + \\frac{5}{6}\\bar{u}_0 + \\frac{2}{6}\\bar{u}_1 = -\\frac{1}{6}(1.8) + \\frac{5}{6}(1.8) + \\frac{2}{6}(-0.6) = \\frac{4}{6}(1.8) - 0.2 = 1.2 - 0.2 = 1.0$.\n- $u_{1/2}^{(2)} = \\frac{2}{6}\\bar{u}_0 + \\frac{5}{6}\\bar{u}_1 - \\frac{1}{6}\\bar{u}_2 = \\frac{2}{6}(1.8) + \\frac{5}{6}(-0.6) - \\frac{1}{6}(-0.6) = 0.6 - 0.5 + 0.1 = 0.2$.\n\nNext, we compute the Jiang-Shu smoothness indicators $\\beta_k$ for each stencil:\n- Stencil $S_0$ contains constant data, so its derivatives are zero. Thus, $\\beta_0 = 0$.\n- For $S_1$: $\\beta_1 = \\frac{13}{12}(\\bar{u}_{-1} - 2\\bar{u}_0 + \\bar{u}_1)^2 + \\frac{1}{4}(\\bar{u}_{-1} - \\bar{u}_1)^2 = \\frac{13}{12}(1.8 - 2(1.8) - 0.6)^2 + \\frac{1}{4}(1.8 - (-0.6))^2 = \\frac{13}{12}(-2.4)^2 + \\frac{1}{4}(2.4)^2 = (\\frac{13}{12} + \\frac{3}{12})(5.76) = \\frac{4}{3}(5.76) = 7.68$.\n- For $S_2$: $\\beta_2 = \\frac{13}{12}(\\bar{u}_0 - 2\\bar{u}_1 + \\bar{u}_2)^2 + \\frac{1}{4}(3\\bar{u}_0 - 4\\bar{u}_1 + \\bar{u}_2)^2 = \\frac{13}{12}(1.8 - 2(-0.6) - 0.6)^2 + \\frac{1}{4}(3(1.8) - 4(-0.6) - 0.6)^2 = \\frac{13}{12}(2.4)^2 + \\frac{1}{4}(7.2)^2 = 6.24 + 12.96 = 19.2$.\n\nThe nonlinear weights $\\omega_k$ are given by $\\omega_k = \\alpha_k / \\sum_j \\alpha_j$, where $\\alpha_k = d_k / (\\epsilon + \\beta_k)^2$. For a left-biased reconstruction, the ideal linear weights are $d_0=0.1$, $d_1=0.6$, $d_2=0.3$. The parameter $\\epsilon = 1.0 \\times 10^{-6}$ is a small number to avoid division by zero.\n- $\\alpha_0 = \\frac{0.1}{(\\epsilon + 0)^2} = \\frac{0.1}{\\epsilon^2} = 0.1 \\times 10^{12}$.\n- $\\alpha_1 = \\frac{0.6}{(\\epsilon + 7.68)^2} \\approx \\frac{0.6}{7.68^2} \\approx 0.0102$.\n- $\\alpha_2 = \\frac{0.3}{(\\epsilon + 19.2)^2} \\approx \\frac{0.3}{19.2^2} \\approx 0.0008$.\n\nThe value of $\\alpha_0$ is orders of magnitude larger than $\\alpha_1$ and $\\alpha_2$. Therefore, the nonlinear weight $\\omega_0 = \\alpha_0 / (\\alpha_0 + \\alpha_1 + \\alpha_2)$ approaches $1$, while $\\omega_1$ and $\\omega_2$ approach $0$.\nThe final reconstructed state is a convex combination of the candidate values:\n$u_{1/2}^{-} = \\omega_0 u_{1/2}^{(0)} + \\omega_1 u_{1/2}^{(1)} + \\omega_2 u_{1/2}^{(2)} \\approx 1 \\times 1.8 + 0 \\times 1.0 + 0 \\times 0.2 = 1.8$.\n\n**2. Reconstruction of the Right State, $u_{1/2}^{+}$**\n\nThe right-reconstructed state $u_{1/2}^{+}$ is computed using a stencil biased to the right of the interface. This can be analyzed by considering the symmetry of the WENO reconstruction. The right reconstruction $u_{1/2}^{+}(\\{\\bar{u}_k\\})$ is equivalent to the left reconstruction $u_{-1/2}^{-}(\\{\\bar{v}_k\\})$ where the data is spatially reflected, i.e., $\\bar{v}_k = \\bar{u}_{-k}$.\nThe reflected data is:\n$$\n\\bar{v}_{k} = \\begin{cases}\n-0.6, & k \\leq -1, \\\\\n1.8, & k \\geq 0.\n\\end{cases}\n$$\nWe compute the left-reconstructed state $u_{-1/2}^{-}$ for this new data $\\{\\bar{v}_k\\}$. This requires stencils centered around cell $\\mathcal{C}_{-1}$.\n- $S_0 = \\{ \\mathcal{C}_{-3}, \\mathcal{C}_{-2}, \\mathcal{C}_{-1} \\}$, with averages $\\{-0.6, -0.6, -0.6\\}$.\n- $S_1 = \\{ \\mathcal{C}_{-2}, \\mathcal{C}_{-1}, \\mathcal{C}_{0} \\}$, with averages $\\{-0.6, -0.6, 1.8\\}$.\n- $S_2 = \\{ \\mathcal{C}_{-1}, \\mathcal{C}_{0}, \\mathcal{C}_{1} \\}$, with averages $\\{-0.6, 1.8, 1.8\\}$.\n\nThe candidate values at $x_{-1/2}$ (for $i=-1$) are:\n- $v_{-1/2}^{(0)} = \\frac{2}{6}\\bar{v}_{-3} - \\frac{7}{6}\\bar{v}_{-2} + \\frac{11}{6}\\bar{v}_{-1} = (\\frac{2-7+11}{6})(-0.6) = -0.6$.\nThe smoothness indicator for this stencil is $\\beta_0=0$ since the data is constant.\nThe other two stencils $S_1$ and $S_2$ cross the discontinuity, so their smoothness indicators $\\beta_1$ and $\\beta_2$ will be large. Following the same logic as for $u_{1/2}^{-}$, the nonlinear weight $\\omega_0$ will approach $1$, and the scheme will select the value from the smoothest stencil.\nTherefore, $u_{-1/2}^{-}(\\{\\bar{v}_k\\}) \\approx v_{-1/2}^{(0)} = -0.6$.\nBy symmetry, the right-reconstructed state for the original problem is $u_{1/2}^{+} = -0.6$.\n\n**3. Non-Oscillatory Behavior and Conservation**\n\nThe WENO scheme is non-oscillatory precisely because of the nonlinear weighting mechanism demonstrated above. The smoothness indicators, $\\beta_k$, act as detectors for discontinuities. When a stencil crosses a shock, its $\\beta_k$ value becomes large, which drastically reduces its corresponding weight $\\omega_k$ in the final reconstruction. The scheme adaptively assigns most of the weight to the smoothest candidate stencil, which effectively means it avoids performing a high-order polynomial interpolation across a jump. This prevents the Gibbs phenomenon and maintains sharp, non-oscillatory profiles. In this case, the scheme degenerates to a reconstruction based only on the smooth data to the left (for $u_{1/2}^{-}$) or to the right (for $u_{1/2}^{+}$) of the discontinuity.\n\nConservation is a fundamental property of the finite volume formulation itself, not the reconstruction step. The FV scheme updates discrete cell averages $\\bar{u}_i$ via a flux-difference formula:\n$$\n\\frac{d \\bar{u}_i}{dt} + \\frac{1}{\\Delta x} (F_{i+1/2} - F_{i-1/2}) = 0\n$$\nHere, $F_{i+1/2}$ is a numerical flux at the interface, which is a function of the reconstructed states $u_{i+1/2}^{-}$ and $u_{i+1/2}^{+}$. The WENO reconstruction is a method to obtain these states. When the update equation is summed over the entire domain, the flux terms form a telescoping series: $\\sum_i (F_{i+1/2} - F_{i-1/2})$. For domains with periodic or transmitting boundary conditions, this sum cancels to zero, ensuring that the total mass, $\\sum_i \\bar{u}_i \\Delta x$, is conserved over time. The WENO procedure determines the accuracy and stability of the scheme but does not alter its inherent conservative nature.\n\nThe final reconstructed states are therefore the exact values from the smooth sides of the jump.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.8 & -0.6\n\\end{pmatrix}\n}\n$$", "id": "3391791"}, {"introduction": "A key motivation for WENO is achieving high-order accuracy in smooth regions of the flow while remaining non-oscillatory at shocks. This high-order accuracy can be sensitive to implementation details, particularly the choice of a small parameter, $\\epsilon$, used to avoid division by zero in the nonlinear weights. This coding exercise [@problem_id:3391768] guides you through a numerical investigation of this sensitivity. By implementing a WENO reconstruction for a smooth function and testing different strategies for $\\epsilon$, you will explore how this parameter impacts the scheme's convergence rate and gain practical insight into achieving the desired accuracy in simulations.", "problem": "Consider one-dimensional scalar conservation laws discretized by a finite-volume method on a uniform periodic grid. The goal is to study the influence of the small positive parameter in the nonlinear weights of the Jiang–Shu formulation of the Weighted Essentially Non-Oscillatory (WENO) reconstruction on accuracy for a smooth target function. You will implement the fifth-order Weighted Essentially Non-Oscillatory (WENO) scheme with Jiang–Shu (JS) nonlinear weights, using power $p=2$ in the weight definition, and compare the error and observed convergence rate across three strategies for the small parameter.\n\nBase setting and core definitions:\n- Work on the periodic domain $[0,1]$.\n- Use a uniform mesh with $N$ control volumes and spacing $\\Delta x = 1/N$. Cell centers are at $x_i = \\left(i+\\tfrac{1}{2}\\right)\\Delta x$ for $i=0,\\dots,N-1$, and cell interfaces are at $x_{i+\\frac{1}{2}} = (i+1)\\Delta x$.\n- Let the smooth test function be $\\phi(x) = \\sin(2\\pi x)$, where the argument is in radians.\n- Let $\\bar{\\phi}_i$ denote the exact cell average of $\\phi$ in cell $i$, namely $\\bar{\\phi}_i = \\frac{1}{\\Delta x}\\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}}\\phi(x)\\,dx$. For numerical fairness and to avoid quadrature effects, compute $\\bar{\\phi}_i$ analytically from the integral definition (i.e., do not approximate the integral numerically).\n- Reconstruct the left-biased interface value at each interface $x_{i+\\frac{1}{2}}$ from the set of cell averages $\\{\\bar{\\phi}_{i-2},\\bar{\\phi}_{i-1},\\bar{\\phi}_{i},\\bar{\\phi}_{i+1},\\bar{\\phi}_{i+2}\\}$ using the fifth-order WENO reconstruction with Jiang–Shu nonlinear weights and power $p=2$. Assume periodicity wherever indices go out of range.\n- Define the error at an interface as the difference between the reconstructed left-biased value and the exact pointwise value $\\phi(x_{i+\\frac{1}{2}})$. Define the global error measure as the $\\ell^1$ norm\n$$\nE_1(N) = \\Delta x \\sum_{i=0}^{N-1} \\left| \\phi^{-}_{i+\\frac{1}{2}} - \\phi(x_{i+\\frac{1}{2}}) \\right|.\n$$\n- For two successive refinements $N$ and $2N$, define the observed order of accuracy as\n$$\nr(N \\to 2N) = \\frac{\\log\\left(E_1(N)/E_1(2N)\\right)}{\\log(2)}.\n$$\n\nSmall-parameter strategies for the Jiang–Shu nonlinear weights:\n- Strategy A: constant $\\epsilon = 10^{-6}$.\n- Strategy B: constant $\\epsilon = 10^{-12}$.\n- Strategy C: grid-dependent $\\epsilon = c\\,\\Delta x^2$ with $c=1$.\n\nTasks:\n1. Implement the fifth-order WENO reconstruction with Jiang–Shu nonlinear weights using power $p=2$ for the nonlinear weights. The fundamental base for your implementation must be the finite-volume framework: reconstruct the left-biased interface values from cell averages using three quadratic candidate polynomials defined on three adjacent three-point stencils and Jiang–Shu smoothness indicators to form nonlinear convex weights, then combine the candidates using those weights.\n2. Use the exact cell averages $\\bar{\\phi}_i$ obtained by analytically integrating $\\phi(x)$ over each cell.\n3. For each $\\epsilon$ strategy among A, B, and C, and for each mesh size $N$ in the set $\\{40,80,160,320\\}$, compute $E_1(N)$.\n4. For each $\\epsilon$ strategy, compute the observed orders $r(40\\to 80)$, $r(80\\to 160)$, and $r(160\\to 320)$ from the corresponding $E_1(N)$ values.\n\nTest suite and coverage:\n- Use the four mesh sizes $N \\in \\{40,80,160,320\\}$ to cover pre-asymptotic and asymptotic regimes.\n- Use all three small-parameter strategies A, B, and C described above, which test sensitivity to constant $\\epsilon$ at two scales and to $\\epsilon$ scaled with $\\Delta x^2$.\n- Angles must be in radians for all trigonometric evaluations.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the following order:\n  - First, for Strategy A ($\\epsilon=10^{-6}$): $E_1(40)$, $E_1(80)$, $E_1(160)$, $E_1(320)$, $r(40\\to 80)$, $r(80\\to 160)$, $r(160\\to 320)$.\n  - Second, for Strategy B ($\\epsilon=10^{-12}$): $E_1(40)$, $E_1(80)$, $E_1(160)$, $E_1(320)$, $r(40\\to 80)$, $r(80\\to 160)$, $r(160\\to 320)$.\n  - Third, for Strategy C ($\\epsilon=c\\,\\Delta x^2$ with $c=1$): $E_1(40)$, $E_1(80)$, $E_1(160)$, $E_1(320)$, $r(40\\to 80)$, $r(80\\to 160)$, $r(160\\to 320)$.\n- All entries must be floating-point numbers. The line must contain exactly $3\\times(4+3)=21$ comma-separated numbers within a single pair of square brackets, with no additional text.", "solution": "The user-provided problem is assessed as **valid** following a rigorous validation process. It is scientifically grounded in the established theory of Weighted Essentially Non-Oscillatory (WENO) schemes, well-posed with a complete and consistent set of definitions, and entirely objective. The task is to implement the fifth-order WENO scheme with Jiang-Shu (JS) weights to investigate the effect of the small parameter $\\epsilon$ on the numerical accuracy for a smooth function.\n\nThe solution is developed based on the principles of the finite-volume WENO method.\n\n**1. Discretization and Cell Averages**\n\nThe problem is defined on a one-dimensional periodic domain $[0,1]$ with a uniform mesh of $N$ cells. The cell width is $\\Delta x = 1/N$. The cell centers are located at $x_i = (i+\\frac{1}{2})\\Delta x$ for $i=0, \\dots, N-1$, and interfaces are at $x_{i+\\frac{1}{2}} = (i+1)\\Delta x$.\n\nThe core of a finite-volume method is the use of cell averages. The test function is $\\phi(x) = \\sin(2\\pi x)$. Its exact cell average in cell $i$, denoted $\\bar{\\phi}_i$, is computed analytically to avoid introducing numerical quadrature errors into the analysis.\n$$\n\\bar{\\phi}_i = \\frac{1}{\\Delta x}\\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} \\phi(x)\\,dx = \\frac{1}{\\Delta x}\\int_{i\\Delta x}^{(i+1)\\Delta x} \\sin(2\\pi x)\\,dx\n$$\nEvaluating the integral:\n$$\n\\bar{\\phi}_i = \\frac{1}{\\Delta x} \\left[ -\\frac{\\cos(2\\pi x)}{2\\pi} \\right]_{i\\Delta x}^{(i+1)\\Delta x} = -\\frac{1}{2\\pi\\Delta x} \\left( \\cos(2\\pi(i+1)\\Delta x) - \\cos(2\\pi i\\Delta x) \\right)\n$$\nUsing the trigonometric identity $\\cos(A) - \\cos(B) = -2\\sin\\left(\\frac{A+B}{2}\\right)\\sin\\left(\\frac{A-B}{2}\\right)$, this simplifies to:\n$$\n\\bar{\\phi}_i = \\frac{\\sin(\\pi\\Delta x)}{\\pi\\Delta x} \\sin(2\\pi x_i)\n$$\nThis formula provides the exact cell averages required for the reconstruction.\n\n**2. Fifth-Order WENO-JS Reconstruction**\n\nThe objective is to reconstruct the value of the function at the cell interface $x_{i+\\frac{1}{2}}$ from the cell averages of the neighboring cells. Specifically, we compute the left-biased value, denoted $\\phi^{-}_{i+1/2}$, using a $5$-point stencil of cell averages: $\\{\\bar{\\phi}_{i-2}, \\bar{\\phi}_{i-1}, \\bar{\\phi}_{i}, \\bar{\\phi}_{i+1}, \\bar{\\phi}_{i+2}\\}$.\n\nThe WENO-5-JS procedure consists of the following steps:\n\n**a. Candidate Reconstructions:** The $5$-point stencil is divided into three overlapping $3$-point substencils, each used to define a quadratic polynomial. Evaluating these polynomials at the interface $x_{i+1/2}$ yields three candidate reconstructions:\n\\begin{align*}\n\\hat{\\phi}^{(0)}_{i+\\frac{1}{2}} &= \\frac{2}{6}\\bar{\\phi}_{i-2} - \\frac{7}{6}\\bar{\\phi}_{i-1} + \\frac{11}{6}\\bar{\\phi}_{i} \\\\\n\\hat{\\phi}^{(1)}_{i+\\frac{1}{2}} &= -\\frac{1}{6}\\bar{\\phi}_{i-1} + \\frac{5}{6}\\bar{\\phi}_{i} + \\frac{2}{6}\\bar{\\phi}_{i+1} \\\\\n\\hat{\\phi}^{(2)}_{i+\\frac{1}{2}} &= \\frac{2}{6}\\bar{\\phi}_{i} + \\frac{5}{6}\\bar{\\phi}_{i+1} - \\frac{1}{6}\\bar{\\phi}_{i+2}\n\\end{align*}\n\n**b. Smoothness Indicators:** The smoothness of the data on each substencil is measured by a smoothness indicator, $\\beta_k$. For the WENO-5-JS scheme, these are:\n\\begin{align*}\n\\beta_0 &= \\frac{13}{12}(\\bar{\\phi}_{i-2} - 2\\bar{\\phi}_{i-1} + \\bar{\\phi}_{i})^2 + \\frac{1}{4}(\\bar{\\phi}_{i-2} - 4\\bar{\\phi}_{i-1} + 3\\bar{\\phi}_{i})^2 \\\\\n\\beta_1 &= \\frac{13}{12}(\\bar{\\phi}_{i-1} - 2\\bar{\\phi}_{i} + \\bar{\\phi}_{i+1})^2 + \\frac{1}{4}(\\bar{\\phi}_{i-1} - \\bar{\\phi}_{i+1})^2 \\\\\n\\beta_2 &= \\frac{13}{12}(\\bar{\\phi}_{i} - 2\\bar{\\phi}_{i+1} + \\bar{\\phi}_{i+2})^2 + \\frac{1}{4}(3\\bar{\\phi}_{i} - 4\\bar{\\phi}_{i+1} + \\bar{\\phi}_{i+2})^2\n\\end{align*}\nNote: Some sources define $\\beta_0$ and $\\beta_2$ with swapped coefficients for the right-biased reconstruction. The forms above are correct for the left-biased value $\\phi^{-}_{i+1/2}$.\n\n**c. Nonlinear Weights:** The final reconstruction is a convex combination of the candidate reconstructions. The weights depend nonlinearly on the smoothness indicators. First, ideal (or linear) weights are defined, which yield the optimal $5$th-order accuracy for smooth functions:\n$$\nd_0 = \\frac{1}{10}, \\quad d_1 = \\frac{6}{10}, \\quad d_2 = \\frac{3}{10}\n$$\nThe unnormalized nonlinear weights, $\\alpha_k$, are calculated as:\n$$\n\\alpha_k = \\frac{d_k}{(\\epsilon + \\beta_k)^p}, \\quad k=0,1,2\n$$\nThe problem specifies the power $p=2$. The parameter $\\epsilon$ is a small positive number to prevent division by zero when a stencil is perfectly smooth ($\\beta_k=0$). The choice of $\\epsilon$ is the subject of this study.\n\nThe final nonlinear weights, $\\omega_k$, are obtained by normalizing the $\\alpha_k$:\n$$\n\\omega_k = \\frac{\\alpha_k}{\\alpha_0 + \\alpha_1 + \\alpha_2}\n$$\n\n**d. Final Reconstructed Value:** The left-biased interface value is the weighted average of the candidates:\n$$\n\\phi^{-}_{i+1/2} = \\omega_0 \\hat{\\phi}^{(0)}_{i+\\frac{1}{2}} + \\omega_1 \\hat{\\phi}^{(1)}_{i+\\frac{1}{2}} + \\omega_2 \\hat{\\phi}^{(2)}_{i+\\frac{1}{2}}\n$$\n\n**3. Error and Convergence Rate Calculation**\n\nThe accuracy of the reconstruction is measured by the $\\ell^1$ norm of the error between the reconstructed interface values and the exact point values $\\phi(x_{i+\\frac{1}{2}})$.\n$$\nE_1(N) = \\Delta x \\sum_{i=0}^{N-1} \\left| \\phi^{-}_{i+\\frac{1}{2}} - \\phi(x_{i+\\frac{1}{2}}) \\right|\n$$\nThe observed order of accuracy, $r$, is computed from the errors on two successively refined meshes, $N$ and $2N$:\n$$\nr(N \\to 2N) = \\frac{\\log\\left(E_1(N)/E_1(2N)\\right)}{\\log(2)}\n$$\n\n**4. Epsilon Strategies and Implementation**\n\nThe analysis is performed for three different strategies for choosing $\\epsilon$:\n- Strategy A: A constant $\\epsilon = 10^{-6}$.\n- Strategy B: A smaller constant $\\epsilon = 10^{-12}$.\n- Strategy C: A grid-dependent $\\epsilon = c\\,\\Delta x^2$ with $c=1$.\n\nThe implementation is performed in Python using the `numpy` library for efficient, vectorized calculations. The periodic boundary conditions are handled by using `np.roll` to create shifted versions of the cell-average array, allowing all interface values to be computed simultaneously. The process is repeated for each mesh size $N \\in \\{40, 80, 160, 320\\}$ and each $\\epsilon$ strategy. Finally, the errors and convergence rates are computed and reported as specified.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements the 5th-order WENO-JS reconstruction to study the influence\n    of the epsilon parameter on accuracy for a smooth function.\n    \"\"\"\n    # Define mesh sizes and epsilon strategies\n    N_vals = [40, 80, 160, 320]\n    strategies = {\n        'A': lambda dx: 1e-6,\n        'B': lambda dx: 1e-12,\n        'C': lambda dx: dx**2,\n    }\n    \n    # WENO-5-JS constants\n    d0, d1, d2 = 0.1, 0.6, 0.3\n    p = 2.0\n\n    all_results = []\n\n    # Iterate over the three specified strategies for epsilon\n    for strategy_name in ['A', 'B', 'C']:\n        epsilon_func = strategies[strategy_name]\n        errors = []\n        \n        # Iterate over the specified mesh resolutions\n        for N in N_vals:\n            dx = 1.0 / N\n            epsilon = epsilon_func(dx)\n\n            # Grid setup\n            # Cell centers x_i = (i + 0.5)*dx\n            x_i = (np.arange(N, dtype=float) + 0.5) * dx\n            # Cell interfaces x_{i+1/2} = (i + 1)*dx\n            x_iph = (np.arange(N, dtype=float) + 1.0) * dx\n\n            # Exact values\n            # Pointwise value of phi(x) = sin(2*pi*x) at interfaces\n            phi_exact_interface = np.sin(2.0 * np.pi * x_iph)\n\n            # Analytical cell averages of phi(x)\n            # The formula is (sin(pi*dx)/(pi*dx)) * sin(2*pi*x_i)\n            sinc_val = np.sin(np.pi * dx) / (np.pi * dx)\n            phi_bar = sinc_val * np.sin(2.0 * np.pi * x_i)\n\n            # Vectorized WENO-5 reconstruction\n            # The stencil for interface i+1/2 uses phi_bar at indices\n            # {i-2, i-1, i, i+1, i+2}. We use np.roll for periodic boundaries.\n            v_m2 = np.roll(phi_bar, 2)\n            v_m1 = np.roll(phi_bar, 1)\n            v_0 = phi_bar\n            v_p1 = np.roll(phi_bar, -1)\n            v_p2 = np.roll(phi_bar, -2)\n\n            # Smoothness indicators (beta_k)\n            beta0 = (13.0/12.0) * (v_m2 - 2.0*v_m1 + v_0)**2 + (1.0/4.0) * (v_m2 - 4.0*v_m1 + 3.0*v_0)**2\n            beta1 = (13.0/12.0) * (v_m1 - 2.0*v_0 + v_p1)**2 + (1.0/4.0) * (v_m1 - v_p1)**2\n            beta2 = (13.0/12.0) * (v_0 - 2.0*v_p1 + v_p2)**2 + (1.0/4.0) * (3.0*v_0 - 4.0*v_p1 + v_p2)**2\n\n            # Nonlinear weights (omega_k)\n            alpha0 = d0 / (epsilon + beta0)**p\n            alpha1 = d1 / (epsilon + beta1)**p\n            alpha2 = d2 / (epsilon + beta2)**p\n            alpha_sum = alpha0 + alpha1 + alpha2\n\n            w0 = alpha0 / alpha_sum\n            w1 = alpha1 / alpha_sum\n            w2 = alpha2 / alpha_sum\n\n            # Candidate reconstructions (phi_hat_k)\n            phi_hat0 = (2.0/6.0)*v_m2 - (7.0/6.0)*v_m1 + (11.0/6.0)*v_0\n            phi_hat1 = (-1.0/6.0)*v_m1 + (5.0/6.0)*v_0 + (2.0/6.0)*v_p1\n            phi_hat2 = (2.0/6.0)*v_0 + (5.0/6.0)*v_p1 - (1.0/6.0)*v_p2\n\n            # Reconstructed values at interfaces (phi_minus_{i+1/2})\n            phi_recon = w0 * phi_hat0 + w1 * phi_hat1 + w2 * phi_hat2\n\n            # L1 Error\n            l1_error = dx * np.sum(np.abs(phi_recon - phi_exact_interface))\n            errors.append(l1_error)\n\n        # Observed order of accuracy\n        rates = []\n        for i in range(len(N_vals) - 1):\n            # rate = log(E1(N)/E1(2N)) / log(2)\n            rate = np.log(errors[i] / errors[i+1]) / np.log(2.0)\n            rates.append(rate)\n        \n        all_results.extend(errors)\n        all_results.extend(rates)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```", "id": "3391768"}]}