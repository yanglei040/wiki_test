{"hands_on_practices": [{"introduction": "This first exercise provides a foundational check on the behavior of slope limiters under ideal conditions. By applying the `minmod` and `van Leer` limiters to a perfectly linear data profile, we can verify their design property of preserving second-order accuracy in smooth regions. This hands-on calculation is crucial for building intuition about how limiters distinguish between smooth gradients and potential oscillations. [@problem_id:3347626]", "problem": "Consider the one-dimensional scalar conservation law $u_t + f(u)_x = 0$ on a uniform mesh of cell centers $x_i$ and cell interfaces $x_{i \\pm 1/2}$ with constant spacing $\\Delta x > 0$. In a finite-volume method, the piecewise-linear Monotonic Upstream-centered Schemes for Conservation Laws (MUSCL) reconstruction in cell $i$ is \n$$\nu_i(x) = \\bar u_i + \\sigma_i (x - x_i), \\quad x \\in [x_{i-1/2}, x_{i+1/2}],\n$$\nwhere $\\bar u_i$ is the cell average and $\\sigma_i$ is a limited slope constructed from the one-sided divided differences\n$$\ns_L = \\frac{\\bar u_i - \\bar u_{i-1}}{\\Delta x}, \\qquad s_R = \\frac{\\bar u_{i+1} - \\bar u_i}{\\Delta x}.\n$$\nThe left and right interface states reconstructed from cell $i$ are\n$$\nu_{i-1/2}^R = \\bar u_i - \\frac{1}{2}\\Delta x\\, \\sigma_i, \\qquad u_{i+1/2}^L = \\bar u_i + \\frac{1}{2}\\Delta x\\, \\sigma_i.\n$$\nTwo slope limiters are considered:\n1. The minmod limiter defined by\n$$\n\\operatorname{minmod}(a,b) = \n\\begin{cases}\n\\phantom{-}\\min(|a|,|b|)\\,\\operatorname{sign}(a), & \\text{if } a b > 0,\\\\\n0, & \\text{otherwise},\n\\end{cases}\n$$\nand $\\sigma_i^{\\mathrm{mm}} = \\operatorname{minmod}(s_L, s_R)$.\n2. The van Leer harmonic-mean limiter defined by\n$$\n\\phi_{\\mathrm{VL}}(a,b) = \n\\begin{cases}\n\\dfrac{2 a b}{a + b}, & \\text{if } a b > 0,\\\\\n0, & \\text{otherwise},\n\\end{cases}\n$$\nand $\\sigma_i^{\\mathrm{vl}} = \\phi_{\\mathrm{VL}}(s_L, s_R)$.\n\nGiven data $\\bar u_{i-1} = 1$, $\\bar u_i = 2$, $\\bar u_{i+1} = 3$, compute the limited slopes $\\sigma_i^{\\mathrm{mm}}$ and $\\sigma_i^{\\mathrm{vl}}$, and the corresponding interface values $u_{i-1/2}^R$ and $u_{i+1/2}^L$ for each limiter. Compare the results and state whether they coincide. Report your final answer as the row vector $(\\sigma_i^{\\mathrm{mm}}, \\sigma_i^{\\mathrm{vl}}, u_{i-1/2}^{R,\\mathrm{mm}}, u_{i+1/2}^{L,\\mathrm{mm}}, u_{i-1/2}^{R,\\mathrm{vl}}, u_{i+1/2}^{L,\\mathrm{vl}})$, in that order. No rounding is required.", "solution": "The problem statement is first validated against the required criteria.\n\n### Step 1: Extract Givens\n- **Conservation Law**: $u_t + f(u)_x = 0$.\n- **Mesh**: Uniform mesh of cell centers $x_i$ and interfaces $x_{i \\pm 1/2}$ with constant spacing $\\Delta x > 0$.\n- **MUSCL Reconstruction in cell $i$**: $u_i(x) = \\bar u_i + \\sigma_i (x - x_i)$ for $x \\in [x_{i-1/2}, x_{i+1/2}]$.\n- **One-sided divided differences**: $s_L = \\frac{\\bar u_i - \\bar u_{i-1}}{\\Delta x}$ and $s_R = \\frac{\\bar u_{i+1} - \\bar u_i}{\\Delta x}$.\n- **Reconstructed interface states from cell $i$**: $u_{i-1/2}^R = \\bar u_i - \\frac{1}{2}\\Delta x\\, \\sigma_i$ and $u_{i+1/2}^L = \\bar u_i + \\frac{1}{2}\\Delta x\\, \\sigma_i$.\n- **Minmod limiter**: $\\sigma_i^{\\mathrm{mm}} = \\operatorname{minmod}(s_L, s_R)$, where $\\operatorname{minmod}(a,b) = \\begin{cases} \\min(|a|,|b|)\\,\\operatorname{sign}(a), & \\text{if } a b > 0,\\\\ 0, & \\text{otherwise}. \\end{cases}$\n- **Van Leer limiter**: $\\sigma_i^{\\mathrm{vl}} = \\phi_{\\mathrm{VL}}(s_L, s_R)$, where $\\phi_{\\mathrm{VL}}(a,b) = \\begin{cases} \\dfrac{2 a b}{a + b}, & \\text{if } a b > 0,\\\\ 0, & \\text{otherwise}. \\end{cases}$\n- **Data**: Cell-average values are given as $\\bar u_{i-1} = 1$, $\\bar u_i = 2$, and $\\bar u_{i+1} = 3$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is a standard exercise in the field of numerical methods for partial differential equations, specifically for computational fluid dynamics.\n- **Scientifically Grounded**: The problem describes the Monotonic Upstream-centered Schemes for Conservation Laws (MUSCL), a well-established, second-order accurate finite volume method. The definitions of the linear reconstruction, one-sided differences, and the minmod and van Leer slope limiters are all standard and correct within this context.\n- **Well-Posed**: The problem is well-posed. It provides all necessary data and definitions to uniquely compute the requested quantities. The task is a direct application of the provided formulas.\n- **Objective**: The language is precise and mathematical, free of any subjective or ambiguous statements.\n- **Completeness and Consistency**: The problem is self-contained. The data provided is consistent and sufficient for the calculation. There are no contradictions.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Solution Derivation\nThe goal is to compute the limited slopes $\\sigma_i^{\\mathrm{mm}}$ and $\\sigma_i^{\\mathrm{vl}}$, and the corresponding interface values $u_{i-1/2}^R$ and $u_{i+1/2}^L$ for each limiter, given the cell-average data $\\bar u_{i-1} = 1$, $\\bar u_i = 2$, and $\\bar u_{i+1} = 3$.\n\nFirst, we compute the one-sided divided differences, $s_L$ and $s_R$. The mesh spacing $\\Delta x$ is a positive constant.\n$$\ns_L = \\frac{\\bar u_i - \\bar u_{i-1}}{\\Delta x} = \\frac{2 - 1}{\\Delta x} = \\frac{1}{\\Delta x}\n$$\n$$\ns_R = \\frac{\\bar u_{i+1} - \\bar u_i}{\\Delta x} = \\frac{3 - 2}{\\Delta x} = \\frac{1}{\\Delta x}\n$$\nWe observe that the flow-field data is linear across the three cells, resulting in $s_L = s_R$.\n\nNext, we compute the limited slope using the minmod limiter, $\\sigma_i^{\\mathrm{mm}}$. The inputs to the limiter are $a = s_L = \\frac{1}{\\Delta x}$ and $b = s_R = \\frac{1}{\\Delta x}$. Since $\\Delta x > 0$, we have $s_L > 0$ and $s_R > 0$, so their product $s_L s_R = \\frac{1}{(\\Delta x)^2} > 0$.\nApplying the definition of the minmod limiter:\n$$\n\\sigma_i^{\\mathrm{mm}} = \\operatorname{minmod}(s_L, s_R) = \\min(|s_L|, |s_R|)\\,\\operatorname{sign}(s_L)\n$$\nSince $s_L = s_R = \\frac{1}{\\Delta x}$, this simplifies to:\n$$\n\\sigma_i^{\\mathrm{mm}} = \\min\\left(\\left|\\frac{1}{\\Delta x}\\right|, \\left|\\frac{1}{\\Delta x}\\right|\\right)\\,\\operatorname{sign}\\left(\\frac{1}{\\Delta x}\\right) = \\frac{1}{\\Delta x} \\cdot 1 = \\frac{1}{\\Delta x}\n$$\n\nNow, we compute the limited slope using the van Leer limiter, $\\sigma_i^{\\mathrm{vl}}$. The inputs $s_L$ and $s_R$ are the same. Since $s_L s_R > 0$, we use the corresponding case for the van Leer limiter definition:\n$$\n\\sigma_i^{\\mathrm{vl}} = \\phi_{\\mathrm{VL}}(s_L, s_R) = \\frac{2 s_L s_R}{s_L + s_R}\n$$\nSubstituting $s_L = s_R = \\frac{1}{\\Delta x}$:\n$$\n\\sigma_i^{\\mathrm{vl}} = \\frac{2 \\left(\\frac{1}{\\Delta x}\\right) \\left(\\frac{1}{\\Delta x}\\right)}{\\frac{1}{\\Delta x} + \\frac{1}{\\Delta x}} = \\frac{\\frac{2}{(\\Delta x)^2}}{\\frac{2}{\\Delta x}} = \\frac{2}{(\\Delta x)^2} \\cdot \\frac{\\Delta x}{2} = \\frac{1}{\\Delta x}\n$$\nAs expected for linear data where $s_L = s_R$, both limiters return the same slope: $\\sigma_i^{\\mathrm{mm}} = \\sigma_i^{\\mathrm{vl}} = \\frac{1}{\\Delta x}$. This indicates that for this particular linear data, the reconstruction is not limited and retains its second-order accuracy.\n\nWith the limited slopes determined, we can find the interface values.\nFor the minmod limiter, the limited slope is $\\sigma_i^{\\mathrm{mm}} = \\frac{1}{\\Delta x}$. The reconstructed interface values from cell $i$ are:\n$$\nu_{i-1/2}^{R,\\mathrm{mm}} = \\bar u_i - \\frac{1}{2}\\Delta x\\, \\sigma_i^{\\mathrm{mm}} = 2 - \\frac{1}{2}\\Delta x \\left(\\frac{1}{\\Delta x}\\right) = 2 - \\frac{1}{2} = \\frac{3}{2}\n$$\n$$\nu_{i+1/2}^{L,\\mathrm{mm}} = \\bar u_i + \\frac{1}{2}\\Delta x\\, \\sigma_i^{\\mathrm{mm}} = 2 + \\frac{1}{2}\\Delta x \\left(\\frac{1}{\\Delta x}\\right) = 2 + \\frac{1}{2} = \\frac{5}{2}\n$$\n\nFor the van Leer limiter, the limited slope is $\\sigma_i^{\\mathrm{vl}} = \\frac{1}{\\Delta x}$. The reconstructed interface values from cell $i$ are:\n$$\nu_{i-1/2}^{R,\\mathrm{vl}} = \\bar u_i - \\frac{1}{2}\\Delta x\\, \\sigma_i^{\\mathrm{vl}} = 2 - \\frac{1}{2}\\Delta x \\left(\\frac{1}{\\Delta x}\\right) = 2 - \\frac{1}{2} = \\frac{3}{2}\n$$\n$$\nu_{i+1/2}^{L,\\mathrm{vl}} = \\bar u_i + \\frac{1}{2}\\Delta x\\, \\sigma_i^{\\mathrm{vl}} = 2 + \\frac{1}{2}\\Delta x \\left(\\frac{1}{\\Delta x}\\right) = 2 + \\frac{1}{2} = \\frac{5}{2}\n$$\n\nThe results for both limiters coincide. This is because the input data profile is perfectly linear, and both limiters are designed to be second-order accurate (i.e., not apply any limiting) for such profiles.\n\nThe final answer is the row vector $(\\sigma_i^{\\mathrm{mm}}, \\sigma_i^{\\mathrm{vl}}, u_{i-1/2}^{R,\\mathrm{mm}}, u_{i+1/2}^{L,\\mathrm{mm}}, u_{i-1/2}^{R,\\mathrm{vl}}, u_{i+1/2}^{L,\\mathrm{vl}})$.\nSubstituting the computed values:\n$$\n\\left(\\frac{1}{\\Delta x}, \\frac{1}{\\Delta x}, \\frac{3}{2}, \\frac{5}{2}, \\frac{3}{2}, \\frac{5}{2}\\right)\n$$", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1}{\\Delta x} & \\frac{1}{\\Delta x} & \\frac{3}{2} & \\frac{5}{2} & \\frac{3}{2} & \\frac{5}{2} \\end{pmatrix}}\n$$", "id": "3347626"}, {"introduction": "Building on the fundamentals, this practice introduces a common real-world complexity: non-uniform grids. It highlights the critical importance of correctly defining gradients by comparing a naive approach with a proper, metric-aware formulation that accounts for varying cell sizes. This exercise demonstrates how seemingly small implementation details can significantly impact the accuracy of a numerical scheme. [@problem_id:3347585]", "problem": "Consider the one-dimensional scalar conservation law $u_{t} + f(u)_{x} = 0$ discretized by a finite-volume method on a nonuniform grid with cell centers located at $x_{i-1}$, $x_{i}$, $x_{i+1}$. Let the center-to-center spacings be $\\Delta x_{i-1/2} = x_{i} - x_{i-1} = 1$ and $\\Delta x_{i+1/2} = x_{i+1} - x_{i} = 2$. The cell-average data are $\\bar{u}_{i-1} = 0$, $\\bar{u}_{i} = 1$, and $\\bar{u}_{i+1} = 1.5$. Use a Monotonic Upstream-centered Scheme for Conservation Laws (MUSCL) reconstruction to form the right-interface left state at $x_{i+1/2}$ via a limited linear increment defined by\n$$\n\\delta = \\frac{1}{2}\\,\\phi(r)\\,(\\bar{u}_{i+1} - \\bar{u}_{i}),\n$$\nwhere $\\phi(r)$ is the van Leer flux limiter given by\n$$\n\\phi(r) = \\frac{r + |r|}{1 + |r|}.\n$$\nDefine the naive ratio $r_{\\mathrm{n}}$ using undivided differences by\n$$\nr_{\\mathrm{n}} = \\frac{\\bar{u}_{i} - \\bar{u}_{i-1}}{\\bar{u}_{i+1} - \\bar{u}_{i}},\n$$\nand define the metric-aware ratio $r_{\\mathrm{m}}$ using gradient estimates by\n$$\nr_{\\mathrm{m}} = \\frac{(\\bar{u}_{i} - \\bar{u}_{i-1})/\\Delta x_{i-1/2}}{(\\bar{u}_{i+1} - \\bar{u}_{i})/\\Delta x_{i+1/2}}.\n$$\nCompute the ratio $R$ of the naive-limited increment to the metric-aware-limited increment,\n$$\nR = \\frac{\\delta_{\\mathrm{n}}}{\\delta_{\\mathrm{m}}},\n$$\nas an exact value. No rounding is required and no units are needed.", "solution": "The problem is valid. It is a well-posed problem in the field of computational fluid dynamics, specifically concerning numerical schemes for conservation laws. All data, definitions, and conditions are provided, and they are scientifically and mathematically consistent.\n\nThe objective is to compute the ratio $R = \\frac{\\delta_{\\mathrm{n}}}{\\delta_{\\mathrm{m}}}$, where $\\delta_{\\mathrm{n}}$ and $\\delta_{\\mathrm{m}}$ are limited linear increments calculated using two different definitions for the ratio of successive gradients, $r$.\n\nThe limited linear increment is defined as:\n$$\n\\delta = \\frac{1}{2}\\,\\phi(r)\\,(\\bar{u}_{i+1} - \\bar{u}_{i})\n$$\nThe increments $\\delta_{\\mathrm{n}}$ and $\\delta_{\\mathrm{m}}$ are therefore given by:\n$$\n\\delta_{\\mathrm{n}} = \\frac{1}{2}\\,\\phi(r_{\\mathrm{n}})\\,(\\bar{u}_{i+1} - \\bar{u}_{i})\n$$\n$$\n\\delta_{\\mathrm{m}} = \\frac{1}{2}\\,\\phi(r_{\\mathrm{m}})\\,(\\bar{u}_{i+1} - \\bar{u}_{i})\n$$\nThe ratio $R$ can be expressed as:\n$$\nR = \\frac{\\delta_{\\mathrm{n}}}{\\delta_{\\mathrm{m}}} = \\frac{\\frac{1}{2}\\,\\phi(r_{\\mathrm{n}})\\,(\\bar{u}_{i+1} - \\bar{u}_{i})}{\\frac{1}{2}\\,\\phi(r_{\\mathrm{m}})\\,(\\bar{u}_{i+1} - \\bar{u}_{i})}\n$$\nThe given cell-average data are $\\bar{u}_{i} = 1$ and $\\bar{u}_{i+1} = 1.5$. Since $\\bar{u}_{i+1} - \\bar{u}_{i} = 1.5 - 1 = 0.5 \\neq 0$, the term $\\frac{1}{2}(\\bar{u}_{i+1} - \\bar{u}_{i})$ cancels out from the numerator and denominator. The ratio simplifies to:\n$$\nR = \\frac{\\phi(r_{\\mathrm{n}})}{\\phi(r_{\\mathrm{m}})}\n$$\nTo compute $R$, we first need to compute the values of $r_{\\mathrm{n}}$ and $r_{\\mathrm{m}}$ using the provided data:\n$\\bar{u}_{i-1} = 0$, $\\bar{u}_{i} = 1$, $\\bar{u}_{i+1} = 1.5$.\nThe center-to-center spacings are $\\Delta x_{i-1/2} = 1$ and $\\Delta x_{i+1/2} = 2$.\n\nFirst, we calculate the undivided differences of the cell averages:\n$$\n\\bar{u}_{i} - \\bar{u}_{i-1} = 1 - 0 = 1\n$$\n$$\n\\bar{u}_{i+1} - \\bar{u}_{i} = 1.5 - 1 = 0.5\n$$\nNow, we compute the naive ratio $r_{\\mathrm{n}}$:\n$$\nr_{\\mathrm{n}} = \\frac{\\bar{u}_{i} - \\bar{u}_{i-1}}{\\bar{u}_{i+1} - \\bar{u}_{i}} = \\frac{1}{0.5} = 2\n$$\nNext, we compute the metric-aware ratio $r_{\\mathrm{m}}$. This requires calculating the gradient estimates first:\nThe upstream gradient estimate is:\n$$\n\\frac{\\bar{u}_{i} - \\bar{u}_{i-1}}{\\Delta x_{i-1/2}} = \\frac{1}{1} = 1\n$$\nThe downstream gradient estimate is:\n$$\n\\frac{\\bar{u}_{i+1} - \\bar{u}_{i}}{\\Delta x_{i+1/2}} = \\frac{0.5}{2} = 0.25\n$$\nNow, we can compute $r_{\\mathrm{m}}$:\n$$\nr_{\\mathrm{m}} = \\frac{(\\bar{u}_{i} - \\bar{u}_{i-1})/\\Delta x_{i-1/2}}{(\\bar{u}_{i+1} - \\bar{u}_{i})/\\Delta x_{i+1/2}} = \\frac{1}{0.25} = 4\n$$\nWith the values of $r_{\\mathrm{n}}=2$ and $r_{\\mathrm{m}}=4$, we can evaluate the van Leer flux limiter $\\phi(r) = \\frac{r + |r|}{1 + |r|}$ for each.\nSince both $r_{\\mathrm{n}}$ and $r_{\\mathrm{m}}$ are positive, $|r| = r$, and the limiter function simplifies to:\n$$\n\\phi(r) = \\frac{r + r}{1 + r} = \\frac{2r}{1+r} \\quad \\text{for } r > 0\n$$\nFor the naive ratio $r_{\\mathrm{n}} = 2$:\n$$\n\\phi(r_{\\mathrm{n}}) = \\phi(2) = \\frac{2 \\times 2}{1 + 2} = \\frac{4}{3}\n$$\nFor the metric-aware ratio $r_{\\mathrm{m}} = 4$:\n$$\n\\phi(r_{\\mathrm{m}}) = \\phi(4) = \\frac{2 \\times 4}{1 + 4} = \\frac{8}{5}\n$$\nFinally, we compute the ratio $R$:\n$$\nR = \\frac{\\phi(r_{\\mathrm{n}})}{\\phi(r_{\\mathrm{m}})} = \\frac{4/3}{8/5} = \\frac{4}{3} \\times \\frac{5}{8} = \\frac{20}{24}\n$$\nSimplifying the fraction gives the exact value:\n$$\nR = \\frac{5}{6}\n$$", "answer": "$$\\boxed{\\frac{5}{6}}$$", "id": "3347585"}, {"introduction": "This final practice synthesizes the concepts of reconstruction and limiting into a complete numerical experiment. You will implement a full finite-volume solver using a MUSCL reconstruction, perform a grid refinement study, and analyze the results to uncover a key theoretical property of TVD schemes. This exercise reveals the fundamental trade-off between maintaining stability by preventing oscillations and the resulting impact on the scheme's formal order of accuracy, especially at smooth extrema. [@problem_id:3347636]", "problem": "Consider the scalar conservation law $u_t + f(u)_x = 0$ on the periodic domain $x \\in [0,1]$ with flux $f(u) = a u$, constant advection speed $a$, and smooth initial condition $u(x,0) = \\sin(2\\pi x)$. The exact solution is $u(x,t) = \\sin(2\\pi (x - a t))$ for all $t \\ge 0$. Use a finite-volume discretization on a uniform mesh with $N$ cells of width $\\Delta x = 1/N$, cell averages $U_i(t) \\approx \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t)\\,dx$, and periodic boundary conditions. Employ Monotonic Upstream-centered Schemes for Conservation Laws (MUSCL) reconstruction with the van Leer limiter, and advance in time using the two-stage Total Variation Diminishing (TVD) Runge–Kutta method with a fixed Courant–Friedrichs–Lewy (CFL) number.\n\nStarting from the fundamental finite-volume balance for a conservation law, design and implement a second-order accurate numerical method as follows:\n- Use a uniform mesh with $N$ cells, $\\Delta x = 1/N$, and periodic indexing for fluxes across interfaces.\n- For each cell, reconstruct left states at interfaces using MUSCL with the van Leer slope limiter $\\phi(r) = \\frac{r + |r|}{1 + |r|}$, where $r$ is the ratio of successive limited differences.\n- For $a > 0$, evaluate numerical fluxes using upwind selection, i.e., $F_{i+1/2} = a \\, U_{i+1/2}^{-}$, where $U_{i+1/2}^{-}$ is the left state at interface $x_{i+1/2}$.\n- Advance the solution with the two-stage TVD Runge–Kutta method with time step $\\Delta t$ determined from a constant CFL number $C$ by $\\Delta t = C \\, \\Delta x / a$, adjusted so that the final time $T$ is matched exactly by an integer number of steps.\n\nInitialize the scheme with the exact cell averages of $u(x,0) = \\sin(2\\pi x)$ in each cell $i$, namely\n$$\nU_i(0) = \\frac{1}{\\Delta x} \\int_{x_{i-1/2}}^{x_{i+1/2}} \\sin(2\\pi x)\\,dx = \\frac{\\cos(2\\pi x_{i-1/2}) - \\cos(2\\pi x_{i+1/2})}{2\\pi \\Delta x}.\n$$\nFor the error study at time $T = 1$ with $a = 1$ and $C = 0.4$, the exact solution returns to the initial condition on the periodic domain, hence the exact cell averages at $t = T$ coincide with $U_i(0)$.\n\nDefine the discrete $L_2$ error at time $T$ by\n$$\nE_{L_2}(N) = \\left( \\Delta x \\sum_{i=0}^{N-1} \\left( U_i(T) - U_i(0) \\right)^2 \\right)^{1/2}.\n$$\nThe observed convergence rate between two successive refinements $N_1$ and $N_2$ is\n$$\np(N_1,N_2) = \\frac{\\ln\\left( E_{L_2}(N_1) / E_{L_2}(N_2) \\right)}{\\ln\\left( \\Delta x_1 / \\Delta x_2 \\right)} = \\frac{\\ln\\left( E_{L_2}(N_1) / E_{L_2}(N_2) \\right)}{\\ln\\left( N_2 / N_1 \\right)}.\n$$\n\nYour task is to:\n- Starting from the finite-volume update and the MUSCL van Leer reconstruction, implement the described method to compute numerical solutions.\n- Compute the discrete $L_2$ error $E_{L_2}(N)$ at $t=T$ for a set of refinements.\n- Compute the observed rates $p(N_1,N_2)$ between successive refinements.\n- Given the smoothness of $u(x,t)$ and the limiter’s behavior on smooth profiles, derive the expected asymptotic scaling of $E_{L_2}(N)$ with respect to $\\Delta x$ and justify the rate from the structure of the method.\n\nUse the following test suite of grid resolutions:\n- $N \\in \\{20,40,80,160\\}$.\n\nSet $a = 1$, $C = 0.4$, and $T = 1$, all dimensionless. The outputs must be numerical values without physical units.\n\nFinal output format: your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain the four $L_2$ errors followed by the three observed rates in the order\n$[E_{L_2}(20),E_{L_2}(40),E_{L_2}(80),E_{L_2}(160),p(20,40),p(40,80),p(80,160)]$.", "solution": "The problem is a well-posed computational exercise to analyze the convergence properties of a standard numerical method for hyperbolic conservation laws. All parameters, equations, and procedures are clearly defined and scientifically sound.\n\n### 1. Finite-Volume Discretization\n\nThe scalar conservation law is $u_t + f(u)_x = 0$, with flux $f(u)=au$. We discretize this equation on a uniform grid of $N$ cells, each of width $\\Delta x = 1/N$. The cell centers are $x_i = (i+1/2)\\Delta x$ for $i=0, ..., N-1$. The cell average in cell $i$ is $U_i(t)$. The semi-discrete finite-volume formulation for cell $i$ is:\n$$\n\\frac{dU_i}{dt} = L(U)_i = -\\frac{1}{\\Delta x} (F_{i+1/2} - F_{i-1/2})\n$$\nwhere $L(U)_i$ is the spatial discretization operator and $F_{i\\pm 1/2}$ are the numerical fluxes at the cell interfaces $x_{i\\pm 1/2}$.\n\n### 2. MUSCL Reconstruction and Numerical Flux\n\nTo achieve second-order spatial accuracy, we use MUSCL (Monotonic Upstream-centered Schemes for Conservation Laws) to reconstruct a piecewise linear representation of the solution within each cell. The value of the solution at a point $x$ within cell $i$ is approximated as:\n$$\nu(x) = U_i + s_i(x - x_i)\n$$\nwhere $s_i$ is a limited slope in cell $i$ to prevent spurious oscillations and ensure the Total Variation Diminishing (TVD) property.\n\nFor the linear advection equation with constant speed $a>0$, the information propagates from left to right. Thus, an upwind flux is appropriate. The numerical flux at the interface $x_{i+1/2}$ is determined by the state reconstructed from the upwind cell, which is cell $i$:\n$$\nF_{i+1/2} = f(U_{i+1/2}^{-}) = a U_{i+1/2}^{-}\n$$\nThe state $U_{i+1/2}^{-}$ is the value of the reconstructed solution from cell $i$ at its right boundary, $x_{i+1/2} = x_i + \\Delta x/2$:\n$$\nU_{i+1/2}^{-} = U_i + s_i \\frac{\\Delta x}{2}\n$$\nThe limited slope $s_i$ is written as $s_i = \\sigma_i / \\Delta x$, where $\\sigma_i$ is the limited difference for cell $i$. The state is then:\n$$\nU_{i+1/2}^{-} = U_i + \\frac{1}{2}\\sigma_i\n$$\nThe limited difference $\\sigma_i$ is computed using the van Leer slope limiter. This limiter acts on the ratio of successive differences to blend between first-order and second-order schemes. We define the backward difference $\\Delta_i^- = U_i - U_{i-1}$ and the forward difference $\\Delta_i^+ = U_{i+1} - U_i$. The ratio of successive differences for cell $i$ is $r_i = \\Delta_i^+ / \\Delta_i^-$. The limited difference $\\sigma_i$ is then calculated as:\n$$\n\\sigma_i = \\phi(r_i) \\Delta_i^-\n$$\nwith the van Leer limiter function given as $\\phi(r) = \\frac{r + |r|}{1 + |r|}$. This function can be simplified: it is $0$ for $r \\le 0$ and $\\frac{2r}{1+r}$ for $r > 0$. The condition $r \\le 0$ occurs at local extrema or in their vicinity, where the limiter correctly sets the slope to zero to avoid creating new extrema, reverting to a first-order upwind scheme locally. For smooth, monotonic regions, $r > 0$, and the limiter allows for a higher-order slope.\n\nCombining these elements, the full expression for the numerical flux at interface $i+1/2$ is:\n$$\nF_{i+1/2} = a \\left( U_i + \\frac{1}{2} \\phi\\left(\\frac{U_{i+1}-U_i}{U_i-U_{i-1}}\\right) (U_i-U_{i-1}) \\right)\n$$\nPeriodic boundary conditions are used to evaluate differences at the domain boundaries. For example, to compute $\\sigma_0$, we need $U_{-1}$, which is set to $U_{N-1}$.\n\n### 3. Time Advancement\n\nWe use the two-stage TVD Runge-Kutta method (TVD-RK2) to advance the solution from time $t^n$ to $t^{n+1} = t^n + \\Delta t$. This method is second-order accurate in time and preserves the TVD property of the spatial discretization. The two stages are:\n$$\n\\begin{align*}\nU^{(1)} &= U^n + \\Delta t L(U^n) \\\\\nU^{n+1} &= \\frac{1}{2} U^n + \\frac{1}{2} \\left( U^{(1)} + \\Delta t L(U^{(1)}) \\right)\n\\end{align*}\n$$\nwhere $U^n$ is the vector of all cell averages $U_i$ at time $t^n$. The time step $\\Delta t$ is determined from the CFL condition. A provisional time step $\\Delta t_{prov} = C \\Delta x / a$ is calculated. To ensure the final time $T$ is reached in an integer number of steps, we compute the number of steps $N_{steps} = \\lceil T / \\Delta t_{prov} \\rceil$ and use an adjusted time step $\\Delta t = T / N_{steps}$.\n\n### 4. Error Analysis and Expected Convergence Rate\n\nThe problem requires calculating the discrete $L_2$ error at $T=1$. For $a=1$, the exact solution $u(x,1)=\\sin(2\\pi(x-1))=\\sin(2\\pi x)$ returns to its initial state. The exact cell averages at $T=1$ are therefore identical to the initial ones, $U_i(0)$. The error is computed by:\n$$\nE_{L_2}(N) = \\left( \\Delta x \\sum_{i=0}^{N-1} \\left( U_i(T) - U_i(0) \\right)^2 \\right)^{1/2}\n$$\nThe observed convergence rate $p$ between two grids, $N_1$ and $N_2$, is:\n$$\np(N_1,N_2) = \\frac{\\ln\\left( E_{L_2}(N_1) / E_{L_2}(N_2) \\right)}{\\ln\\left( N_2 / N_1 \\right)}\n$$\nThe constructed scheme is formally second-order accurate. However, TVD-compliant slope limiters, including van Leer's, are known to reduce the local accuracy to first order at smooth extrema (Harten's theorem). Since the initial condition $u(x,0)=\\sin(2\\pi x)$ has a maximum and a minimum, there are two cells per period where the local truncation error (LTE) is $O(\\Delta x)$ instead of the $O(\\Delta x^2)$ achieved elsewhere.\n\nThe global error in the $L_p$ norm, $E_{L_p}$, can be analyzed by considering its dependence on the LTE. The error after $N_{steps} = T/\\Delta t \\sim O(1/\\Delta x)$ steps scales as:\n$$\nE_{L_p}^p \\approx \\Delta x \\left( \\sum_{\\text{2nd-order cells}} |e_{i}|^p + \\sum_{\\text{1st-order cells}} |e_{i}|^p \\right)\n$$\nAssuming the local cell error $e_i$ scales with the LTE, the errors are $O(\\Delta x^2)$ in the $N-k$ second-order cells and $O(\\Delta x)$ in the $k=O(1)$ first-order cells.\n$$\nE_{L_p}^p \\approx \\Delta x \\left( (N-k) \\cdot (O(\\Delta x^2))^p + k \\cdot (O(\\Delta x))^p \\right)\n$$\nSubstituting $N = 1/\\Delta x$:\n$$\nE_{L_p}^p \\approx \\Delta x \\left( O(\\Delta x^{-1}) \\cdot O(\\Delta x^{2p}) + O(1) \\cdot O(\\Delta x^p) \\right) = O(\\Delta x^{2p}) + O(\\Delta x^{p+1})\n$$\nFor $p \\geq 1$, we have $2p \\ge p+1$, so the $O(\\Delta x^{p+1})$ term is dominant (or equal for $p=1$). The global error thus scales as:\n$$\nE_{L_p} \\sim \\left( O(\\Delta x^{p+1}) \\right)^{1/p} = O(\\Delta x^{(p+1)/p})\n$$\nFor the $L_2$ norm, we have $p=2$. The expected asymptotic convergence rate is therefore $(2+1)/2 = 1.5$. The numerical results should show a convergence rate approaching this value as the grid is refined.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef van_leer_limiter(r: np.ndarray) -> np.ndarray:\n    \"\"\"\n    Computes the van Leer limiter function phi(r).\n    phi(r) = (r + |r|) / (1 + |r|)\n    Numerically, this is 0 for r <= 0 and 2r / (1+r) for r > 0.\n    \"\"\"\n    phi = np.zeros_like(r, dtype=float)\n    mask = r > 0\n    r_masked = r[mask]\n    phi[mask] = (2 * r_masked) / (1 + r_masked)\n    return phi\n\ndef calculate_rhs(U: np.ndarray, dx: float, a: float) -> np.ndarray:\n    \"\"\"\n    Calculates the right-hand side of the finite-volume semi-discretization\n    using MUSCL reconstruction with a van Leer limiter.\n    L(U)_i = - (F_{i+1/2} - F_{i-1/2}) / dx\n    \"\"\"\n    # Periodic boundary conditions are handled by np.roll\n    U_m1 = np.roll(U, 1)  # Stencil for U_{i-1}\n    U_p1 = np.roll(U, -1) # Stencil for U_{i+1}\n\n    # Differences centered on cell i\n    delta_b = U - U_m1      # U_i - U_{i-1}\n    delta_f = U_p1 - U      # U_{i+1} - U_i\n\n    # Ratio of successive differences, r_i = delta_f_i / delta_b_i\n    # Use a small tolerance to avoid division by zero.\n    # Where denominator is zero, ratio is zero, leading to zero slope correction.\n    r = np.zeros_like(U, dtype=float)\n    denom_is_nonzero = np.abs(delta_b) > 1e-12\n    np.divide(delta_f, delta_b, out=r, where=denom_is_nonzero)\n\n    # Calculate limited difference sigma_i for each cell i\n    phi = van_leer_limiter(r)\n    sigma = phi * delta_b\n\n    # Reconstruct the state U at the right-hand interface of each cell i (x_{i+1/2})\n    # U_{i+1/2}^- = U_i + 0.5 * sigma_i\n    U_left_at_interface = U + 0.5 * sigma\n\n    # Numerical flux at interface i+1/2 (upwind for a > 0)\n    # F_{i+1/2} = a * U_{i+1/2}^-\n    F = a * U_left_at_interface\n\n    # Flux at interface i-1/2\n    F_m1 = np.roll(F, 1)\n\n    # Compute the RHS of the semi-discrete equation\n    rhs = -(F - F_m1) / dx\n    return rhs\n\ndef solve():\n    \"\"\"\n    Main solver function to run the simulation and compute errors and rates.\n    \"\"\"\n    # Problem parameters\n    a = 1.0\n    C = 0.4\n    T = 1.0\n    N_list = [20, 40, 80, 160]\n\n    errors_l2 = []\n    \n    for N in N_list:\n        # Grid setup\n        dx = 1.0 / N\n        x_interfaces = np.linspace(0.0, 1.0, N + 1)\n        \n        # Initial condition (exact cell averages)\n        U_initial = (np.cos(2 * np.pi * x_interfaces[:-1]) - np.cos(2 * np.pi * x_interfaces[1:])) / (2 * np.pi * dx)\n        U = U_initial.copy()\n\n        # Time step adjustment to hit T exactly\n        dt_provisional = C * dx / a\n        num_steps = int(np.ceil(T / dt_provisional))\n        dt = T / num_steps\n\n        # Time integration using two-stage TVD Runge-Kutta method\n        for _ in range(num_steps):\n            # Stage 1\n            rhs1 = calculate_rhs(U, dx, a)\n            U1 = U + dt * rhs1\n            \n            # Stage 2\n            rhs2 = calculate_rhs(U1, dx, a)\n            U = 0.5 * U + 0.5 * (U1 + dt * rhs2)\n\n        # Compute discrete L2 error at T=1\n        # The exact solution at T=1 is the same as the initial condition\n        error_l2 = np.sqrt(dx * np.sum((U - U_initial)**2))\n        errors_l2.append(error_l2)\n\n    # Compute observed convergence rates\n    rates = []\n    for i in range(len(N_list) - 1):\n        N1 = N_list[i]\n        N2 = N_list[i+1]\n        E1 = errors_l2[i]\n        E2 = errors_l2[i+1]\n        # p = ln(E1/E2) / ln(N2/N1)\n        rate = np.log(E1 / E2) / np.log(N2 / N1)\n        rates.append(rate)\n\n    # Format the final output\n    results = errors_l2 + rates\n    # The print statement must produce only the required output line.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3347636"}]}