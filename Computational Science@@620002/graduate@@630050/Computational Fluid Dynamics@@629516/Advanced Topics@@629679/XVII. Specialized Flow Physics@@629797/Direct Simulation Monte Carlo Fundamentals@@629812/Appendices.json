{"hands_on_practices": [{"introduction": "The Direct Simulation Monte Carlo method's power lies in its ability to model vast numbers of real molecules using a manageable number of computational 'simulator' particles. The crucial link between the physical world and the simulation is the particle 'weight', $W$, which defines how many real molecules each simulator particle represents. This first exercise provides foundational practice in relating macroscopic gas properties, like number density, to the core parameters of a DSMC simulation [@problem_id:3309131].", "problem": "A cubic domain of side length $L=1\\,\\mathrm{mm}$ is filled with a dilute gas of uniform number density $n=10^{20}\\,\\mathrm{m^{-3}}$. The gas is simulated using the Direct Simulation Monte Carlo (DSMC) method with $N_{\\mathrm{sim}}=10^{6}$ simulator particles under a uniform-weighting scheme, where each simulator particle represents the same number of physical molecules. Starting only from the definition of number density as physical number per unit volume and the DSMC representational premise that the total physical number equals the sum of simulator-particle weights, derive an expression for the simulator particle weight $W$ in terms of $n$, $L$, and $N_{\\mathrm{sim}}$, and compute its numerical value. Then, for a uniform Cartesian grid of $100^{3}$ equal-sized cells covering the domain, estimate the expected average number of simulator particles per cell under the stated uniformity assumptions and compute its numerical value. Express your final answer as a row matrix containing first $W$ and then the average number of simulator particles per cell. Provide exact values with no rounding and do not include units in the final answer.", "solution": "The user wants to solve a problem related to the Direct Simulation Monte Carlo (DSMC) method. I will validate the problem statement and, if valid, provide a reasoned solution.\n\n### Step 1: Extract Givens\n-   Domain Geometry: Cubic\n-   Domain Side Length: $L=1\\,\\mathrm{mm}$\n-   Gas Number Density: $n=10^{20}\\,\\mathrm{m^{-3}}$ (uniform)\n-   Number of Simulator Particles: $N_{\\mathrm{sim}}=10^{6}$\n-   Weighting Scheme: Uniform, with particle weight $W$\n-   DSMC Premise: Total physical number of molecules = Sum of simulator-particle weights\n-   Computational Grid: Uniform Cartesian grid of $100^{3}$ cells\n-   Objective 1: Derive an expression for $W$ and compute its numerical value.\n-   Objective 2: Estimate the expected average number of simulator particles per cell and compute its numerical value.\n-   Final Answer Format: A row matrix containing the numerical values of $W$ and the average number of simulator particles per cell.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is evaluated against the validation criteria.\n-   **Scientifically Grounded**: The problem is based on the fundamental principles of the Direct Simulation Monte Carlo method, a standard technique in computational fluid dynamics for rarefied gas flows. The concepts of number density, simulator particles, and particle weight are core to DSMC. The numerical values provided are physically plausible for a micro-scale rarefied gas simulation.\n-   **Well-Posed**: The problem is clearly stated, providing all necessary information to derive the requested quantities. The objectives are specific, and a unique solution can be determined.\n-   **Objective**: The language is precise and quantitative, with no subjective or ambiguous terms.\n-   **Incompleteness/Contradiction**: The problem is self-contained. The provided data are sufficient and not contradictory. The unit mismatch between $L$ in millimeters and $n$ in inverse cubic meters is a standard conversion task, not a flaw.\n-   **Unrealistic/Infeasible**: The conditions are scientifically plausible. A number density of $10^{20}\\,\\mathrm{m^{-3}}$ corresponds to a pressure of approximately $0.4\\,\\mathrm{Pa}$ at standard temperature, which is a high-vacuum condition where DSMC is applicable.\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Solution Derivation\nThe problem requires the derivation and calculation of two quantities: the simulator particle weight, $W$, and the expected average number of simulator particles per cell.\n\n**Part 1: Simulator Particle Weight $W$**\n\nThe solution begins from the definition of number density, $n$. The total number of physical gas molecules, $N_{\\mathrm{phys}}$, in a given volume $V$ is defined as:\n$$N_{\\mathrm{phys}} = n V$$\nThe simulation domain is a cube with side length $L$. Its volume $V$ is:\n$$V = L^3$$\nTherefore, the total number of physical molecules in the domain is:\n$$N_{\\mathrm{phys}} = n L^3$$\nBefore calculating the numerical value, we must ensure unit consistency. The side length is given as $L=1\\,\\mathrm{mm}$, which must be converted to meters to match the units of the number density $n$.\n$$L = 1\\,\\mathrm{mm} = 10^{-3}\\,\\mathrm{m}$$\nNow, we can compute the volume in SI units:\n$$V = (10^{-3}\\,\\mathrm{m})^3 = 10^{-9}\\,\\mathrm{m}^3$$\nUsing the given number density $n=10^{20}\\,\\mathrm{m^{-3}}$, the total number of physical molecules is:\n$$N_{\\mathrm{phys}} = (10^{20}\\,\\mathrm{m^{-3}}) \\times (10^{-9}\\,\\mathrm{m}^3) = 10^{11}$$\nThe problem states that the total number of physical molecules is also represented by the sum of the weights of all simulator particles. Since the weighting scheme is uniform, each of the $N_{\\mathrm{sim}}$ simulator particles has the same weight $W$. Thus, the total number of physical molecules can also be expressed as:\n$$N_{\\mathrm{phys}} = W \\times N_{\\mathrm{sim}}$$\nBy equating the two expressions for $N_{\\mathrm{phys}}$, we can derive an expression for the weight $W$:\n$$W N_{\\mathrm{sim}} = n L^3$$\nSolving for $W$ gives the desired symbolic expression:\n$$W = \\frac{n L^3}{N_{\\mathrm{sim}}}$$\nNow, we substitute the given numerical values to compute $W$. We have $n=10^{20}\\,\\mathrm{m^{-3}}$, $L=10^{-3}\\,\\mathrm{m}$, and $N_{\\mathrm{sim}}=10^{6}$.\n$$W = \\frac{10^{20} \\times (10^{-3})^3}{10^{6}} = \\frac{10^{20} \\times 10^{-9}}{10^{6}} = \\frac{10^{11}}{10^{6}} = 10^{5}$$\nThe weight $W=10^{5}$ is a dimensionless quantity representing the number of real gas molecules represented by a single simulator particle.\n\n**Part 2: Average Number of Simulator Particles per Cell**\n\nThe problem asks for the expected average number of simulator particles per cell. Let this quantity be denoted as $\\langle N_{p/c} \\rangle$.\nThe simulation domain is divided into a uniform Cartesian grid of $N_{\\mathrm{cells}}$ cells. The total number of cells is given as:\n$$N_{\\mathrm{cells}} = 100^{3} = (10^2)^3 = 10^6$$\nThe problem states that the gas has a uniform number density and is simulated using a uniform weighting scheme. This implies that the distribution of simulator particles is, on average, spatially uniform throughout the domain.\nTherefore, the expected average number of simulator particles per cell is simply the total number of simulator particles, $N_{\\mathrm{sim}}$, divided by the total number of cells, $N_{\\mathrm{cells}}$.\n$$\\langle N_{p/c} \\rangle = \\frac{N_{\\mathrm{sim}}}{N_{\\mathrm{cells}}}$$\nWe are given $N_{\\mathrm{sim}} = 10^{6}$ and we have calculated $N_{\\mathrm{cells}} = 10^{6}$. Substituting these values:\n$$\\langle N_{p/c} \\rangle = \\frac{10^{6}}{10^{6}} = 1$$\nThe expected average number of simulator particles per cell is $1$.\n\nThe final answer requires a row matrix containing the numerical value of $W$ followed by the numerical value of $\\langle N_{p/c} \\rangle$.\nThe first value is $W = 10^5$.\nThe second value is $\\langle N_{p/c} \\rangle = 1$.", "answer": "$$\\boxed{\\begin{pmatrix} 10^{5} & 1 \\end{pmatrix}}$$", "id": "3309131"}, {"introduction": "Once we have established how to represent a physical gas with simulator particles, the next critical step is to correctly resolve the physics in space and time. A valid DSMC simulation requires that the computational cell size, $\\Delta x$, is smaller than the average distance a molecule travels between collisions (the mean free path, $\\lambda$), and the time step, $\\Delta t$, is shorter than the average time between collisions. This practice will guide you through the essential process of calculating these fundamental kinetic scales from thermodynamic properties and using them to define a valid simulation mesh and time step [@problem_id:3309134].", "problem": "A monatomic gas of argon is simulated using the Direct Simulation Monte Carlo (DSMC) method under uniform conditions of temperature and pressure. Assume argon can be modeled as hard-sphere molecules with a constant collision diameter. The gas state is specified by $T=300\\,\\mathrm{K}$ and $p=100\\,\\mathrm{Pa}$. Use the following constants: Boltzmann constant $k_B=1.380649\\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}$, Avogadro constant $N_A=6.02214076\\times 10^{23}\\,\\mathrm{mol^{-1}}$, argon molar mass $M_{\\mathrm{Ar}}=39.948\\,\\mathrm{g\\,mol^{-1}}$, and hard-sphere diameter $d=3.66\\times 10^{-10}\\,\\mathrm{m}$. Treat argon as an ideal gas and use classical kinetic theory for hard spheres. Start from the ideal gas relation and kinetic-theory definitions to derive the number density, collisional cross section, mean free path, and mean molecular speed. For the DSMC resolution constraints, adopt the following physically motivated requirements: the computational cell size $\\Delta x$ must be a small fraction of the local mean free path, and the time step $\\Delta t$ must be a small fraction of the minimum of the mean collision time and the cell-crossing time at the mean molecular speed. Specifically, use a safety factor $f=0.2$ so that $\\Delta x=f\\,\\lambda$ and $\\Delta t=f\\,\\min\\{\\tau_c,\\ \\Delta x/\\bar{c}\\}$, where $\\lambda$ is the mean free path, $\\bar{c}$ is the mean molecular speed, and $\\tau_c$ is the mean collision time. \n\nCompute the following in this order: the mean free path $\\lambda$, the mean molecular speed $\\bar{c}$, a suitable cell size $\\Delta x$, and a suitable time step $\\Delta t$ that satisfy the above DSMC constraints with the safety factor $f=0.2$. Express $\\lambda$ and $\\Delta x$ in micrometers, express $\\bar{c}$ in meters per second, and express $\\Delta t$ in nanoseconds. Round each of the four reported values to three significant figures. Report your final answer as a row vector in the order $(\\lambda,\\ \\bar{c},\\ \\Delta x,\\ \\Delta t)$.", "solution": "The problem is to compute four key parameters for a Direct Simulation Monte Carlo (DSMC) simulation of argon gas: the mean free path $\\lambda$, the mean molecular speed $\\bar{c}$, the computational cell size $\\Delta x$, and the time step $\\Delta t$. The problem is well-posed and scientifically sound, providing all necessary physical constants and state variables. We will proceed with a step-by-step derivation and calculation.\n\nThe thermodynamic state of the argon gas is given by its temperature $T=300\\,\\mathrm{K}$ and pressure $p=100\\,\\mathrm{Pa}$. Argon is modeled as an ideal gas composed of hard-sphere molecules.\n\nFirst, we establish the necessary intermediate physical quantities. The number density $n$ of the gas is derived from the ideal gas law:\n$$p = n k_B T \\implies n = \\frac{p}{k_B T}$$\nwhere $k_B = 1.380649\\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}$ is the Boltzmann constant.\n\nThe mass $m$ of a single argon atom is calculated from its molar mass $M_{\\mathrm{Ar}} = 39.948\\,\\mathrm{g\\,mol^{-1}}$ and the Avogadro constant $N_A = 6.02214076\\times 10^{23}\\,\\mathrm{mol^{-1}}$. We must convert the molar mass to SI units ($kg\\,mol^{-1}$):\n$$m = \\frac{M_{\\mathrm{Ar}}}{N_A} = \\frac{0.039948\\,\\mathrm{kg\\,mol^{-1}}}{N_A}$$\n\nWith these fundamental quantities, we proceed to compute the required parameters in the specified order.\n\n**1. Mean Free Path ($\\lambda$)**\nThe mean free path for a gas of hard-sphere molecules is given by kinetic theory as:\n$$\\lambda = \\frac{1}{\\sqrt{2} n \\sigma}$$\nwhere $\\sigma$ is the total collisional cross-section. For a hard sphere with diameter $d = 3.66\\times 10^{-10}\\,\\mathrm{m}$, the cross-section is $\\sigma = \\pi d^2$. Substituting the expression for the number density $n$, we obtain:\n$$\\lambda = \\frac{1}{\\sqrt{2} \\left(\\frac{p}{k_B T}\\right) (\\pi d^2)} = \\frac{k_B T}{\\sqrt{2} \\pi d^2 p}$$\nPlugging in the given numerical values:\n$$\\lambda = \\frac{(1.380649 \\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}) (300\\,\\mathrm{K})}{\\sqrt{2} \\pi (3.66 \\times 10^{-10}\\,\\mathrm{m})^2 (100\\,\\mathrm{Pa})} \\approx 6.95973 \\times 10^{-5}\\,\\mathrm{m}$$\nThe problem requires the result in micrometers ($1\\,\\mathrm{\\mu m} = 10^{-6}\\,\\mathrm{m}$).\n$$\\lambda \\approx (6.95973 \\times 10^{-5}) \\times 10^6\\,\\mathrm{\\mu m} = 69.5973\\,\\mathrm{\\mu m}$$\nRounding to three significant figures, we get $\\lambda \\approx 69.6\\,\\mathrm{\\mu m}$.\n\n**2. Mean Molecular Speed ($\\bar{c}$)**\nThe mean molecular speed of gas atoms in thermal equilibrium is derived from the Maxwell-Boltzmann distribution:\n$$\\bar{c} = \\sqrt{\\frac{8 k_B T}{\\pi m}}$$\nFirst, we compute the mass $m$ of a single argon atom:\n$$m = \\frac{0.039948\\,\\mathrm{kg\\,mol^{-1}}}{6.02214076 \\times 10^{23}\\,\\mathrm{mol^{-1}}} \\approx 6.633522 \\times 10^{-26}\\,\\mathrm{kg}$$\nNow, we substitute the values into the expression for $\\bar{c}$:\n$$\\bar{c} = \\sqrt{\\frac{8 (1.380649 \\times 10^{-23}\\,\\mathrm{J\\,K^{-1}}) (300\\,\\mathrm{K})}{\\pi (6.633522 \\times 10^{-26}\\,\\mathrm{kg})}} \\approx 398.750\\,\\mathrm{m\\,s^{-1}}$$\nRounding to three significant figures, we get $\\bar{c} \\approx 399\\,\\mathrm{m\\,s^{-1}}$.\n\n**3. Cell Size ($\\Delta x$)**\nThe DSMC cell size $\\Delta x$ is constrained to be a fraction of the mean free path, defined by the safety factor $f=0.2$:\n$$\\Delta x = f \\lambda$$\nUsing the unrounded value of $\\lambda$ for higher precision in this intermediate step:\n$$\\Delta x = 0.2 \\times (6.95973 \\times 10^{-5}\\,\\mathrm{m}) \\approx 1.39195 \\times 10^{-5}\\,\\mathrm{m}$$\nConverting to micrometers:\n$$\\Delta x \\approx (1.39195 \\times 10^{-5}) \\times 10^6\\,\\mathrm{\\mu m} = 13.9195\\,\\mathrm{\\mu m}$$\nRounding to three significant figures, we get $\\Delta x \\approx 13.9\\,\\mathrm{\\mu m}$.\n\n**4. Time Step ($\\Delta t$)**\nThe DSMC time step $\\Delta t$ is constrained by both the mean collision time $\\tau_c$ and the cell-crossing time $\\tau_{cross} = \\Delta x / \\bar{c}$. The problem states this constraint as:\n$$\\Delta t = f \\min\\{\\tau_c, \\Delta x/\\bar{c}\\}$$\nWe must first compute and compare $\\tau_c$ and $\\tau_{cross}$. The mean collision time is defined as:\n$$\\tau_c = \\frac{\\lambda}{\\bar{c}} \\approx \\frac{6.95973 \\times 10^{-5}\\,\\mathrm{m}}{398.750\\,\\mathrm{m\\,s^{-1}}} \\approx 1.74585 \\times 10^{-7}\\,\\mathrm{s}$$\nThe cell-crossing time is given by:\n$$\\tau_{cross} = \\frac{\\Delta x}{\\bar{c}} = \\frac{f \\lambda}{\\bar{c}} = f \\tau_c$$\nSince $f=0.2 < 1$, it is clear that $\\tau_{cross} < \\tau_c$. Thus, the minimum of the two is $\\tau_{cross}$:\n$$\\min\\{\\tau_c, \\Delta x/\\bar{c}\\} = \\Delta x/\\bar{c} \\approx \\frac{1.39195 \\times 10^{-5}\\,\\mathrm{m}}{398.750\\,\\mathrm{m\\,s^{-1}}} \\approx 3.49170 \\times 10^{-8}\\,\\mathrm{s}$$\nNow we can compute the time step $\\Delta t$:\n$$\\Delta t = f \\times (\\Delta x/\\bar{c}) = 0.2 \\times (3.49170 \\times 10^{-8}\\,\\mathrm{s}) \\approx 6.98341 \\times 10^{-9}\\,\\mathrm{s}$$\nThe problem requires the result in nanoseconds ($1\\,\\mathrm{ns} = 10^{-9}\\,\\mathrm{s}$).\n$$\\Delta t \\approx 6.98341\\,\\mathrm{ns}$$\nRounding to three significant figures, we get $\\Delta t \\approx 6.98\\,\\mathrm{ns}$.\n\nIn summary, the computed values rounded to three significant figures are:\n- Mean free path $\\lambda = 69.6\\,\\mathrm{\\mu m}$\n- Mean molecular speed $\\bar{c} = 399\\,\\mathrm{m\\,s^{-1}}$\n- Cell size $\\Delta x = 13.9\\,\\mathrm{\\mu m}$\n- Time step $\\Delta t = 6.98\\,\\mathrm{ns}$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n69.6 & 399 & 13.9 & 6.98\n\\end{pmatrix}\n}\n$$", "id": "3309134"}, {"introduction": "The engine of any DSMC simulation is the collision algorithm, which stochastically models the interactions between particles to solve the Boltzmann equation's collision term. While the process is probabilistic, it must rigorously adhere to the fundamental laws of physics for each individual collision. This final practice provides a hands-on opportunity to implement a standard DSMC collision routine and numerically verify that it correctly conserves mass, momentum, and energy—a critical validation step for any physics-based simulation [@problem_id:3309089].", "problem": "Implement a single collision step of the Direct Simulation Monte Carlo (DSMC) method in a single, spatially uniform cell for a monatomic gas with equal-mass particles and hard-sphere collisions. Use nondimensional variables throughout, so no physical units are required. Your implementation must adhere to the following abstract specification and produce a numerical verification of the collisional moment properties.\n\nLet there be $N$ particles in a uniform cell of volume $V$ with equal mass $m$. Denote particle velocities by $\\{\\mathbf{v}_i\\}_{i=1}^{N}$ in three dimensions. Consider a single DSMC collision sub-step over a time step $\\Delta t$ in which only interparticle collisions are processed (no advection). Use an isotropic hard-sphere collision model with a constant total cross-section $\\sigma_T$.\n\nAlgorithmic specification for the collision step:\n- Define the center-of-mass velocity for a pair $(i,j)$ by $\\mathbf{V}_{\\mathrm{cm}} = \\frac{1}{2}(\\mathbf{v}_i + \\mathbf{v}_j)$ and the relative velocity by $\\mathbf{g} = \\mathbf{v}_i - \\mathbf{v}_j$ with magnitude $g = \\|\\mathbf{g}\\|$.\n- Compute the majorant relative speed $g_{\\max}$ as the maximum of $g$ over all unordered pairs in the cell. If $g_{\\max} = 0$, no collisions occur.\n- Define the expected number of collision trials by\n$$\n\\overline{M} = \\frac{N(N-1)}{2}\\,\\frac{\\sigma_T\\,g_{\\max}\\,\\Delta t}{V}.\n$$\nDraw $U \\sim \\mathrm{Uniform}(0,1)$ and set $M = \\lfloor \\overline{M} + U \\rfloor$.\n- Repeat $M$ times: select a pair of distinct indices $(i,j)$ uniformly at random from all ordered pairs with $i \\neq j$, compute $g$ for the selected pair, and accept the trial as a real collision with probability $\\min\\left(1, \\frac{g}{g_{\\max}}\\right)$. For an accepted collision, perform isotropic post-collisional scattering by replacing the relative velocity direction with a new independent direction $\\widehat{\\mathbf{n}}$ sampled uniformly on the unit sphere, holding its magnitude fixed, and update the velocities by\n$$\n\\mathbf{v}_i' = \\mathbf{V}_{\\mathrm{cm}} + \\frac{1}{2}\\,g\\,\\widehat{\\mathbf{n}},\\qquad\n\\mathbf{v}_j' = \\mathbf{V}_{\\mathrm{cm}} - \\frac{1}{2}\\,g\\,\\widehat{\\mathbf{n}}.\n$$\nIf a trial is rejected, leave $\\mathbf{v}_i,\\mathbf{v}_j$ unchanged.\n\nDefine the collision invariants over the cell:\n- Total mass $M_{\\text{tot}} = m \\sum_{i=1}^{N} 1$,\n- Total momentum $\\mathbf{P} = m \\sum_{i=1}^{N} \\mathbf{v}_i$,\n- Total kinetic energy $E = \\frac{m}{2} \\sum_{i=1}^{N} \\|\\mathbf{v}_i\\|^2$.\n\nYour task:\n- Implement the above DSMC collision step for a single uniform cell.\n- Initialize particle velocities from a three-dimensional normal distribution with independent components of zero mean and unit variance, then add a prescribed constant drift vector $\\mathbf{u}$ to all velocities. Use the same mass for all particles and set $m = 1$.\n- For each specified test case below, compute the absolute changes in the invariants after one collision step,\n$$\n\\Delta M_{\\text{tot}} = \\left|M_{\\text{tot}}^{\\text{after}} - M_{\\text{tot}}^{\\text{before}}\\right|,\\quad\n\\|\\Delta \\mathbf{P}\\| = \\left\\| \\mathbf{P}^{\\text{after}} - \\mathbf{P}^{\\text{before}} \\right\\|,\\quad\n\\Delta E = \\left|E^{\\text{after}} - E^{\\text{before}}\\right|,\n$$\nand output, for each case, the single scalar result equal to\n$$\nR = \\max\\left\\{\\Delta M_{\\text{tot}}, \\|\\Delta \\mathbf{P}\\|, \\Delta E\\right\\}.\n$$\nThis $R$ should numerically demonstrate that the expected change in any collision invariant is zero by yielding values very close to zero.\n\nAll computations must be in nondimensional units. No angular inputs are required. Random sampling must be made reproducible by using the specified seed $s$ for each test case.\n\nTest suite:\n- Case A (happy path): $N = 160$, $V = 1.0$, $m = 1$, $\\Delta t = 0.02$, $\\sigma_T = 0.1$, drift $\\mathbf{u} = (0,0,0)$, seed $s = 1$.\n- Case B (nonzero drift): $N = 160$, $V = 1.0$, $m = 1$, $\\Delta t = 0.02$, $\\sigma_T = 0.1$, drift $\\mathbf{u} = (0.5,-0.3,0.2)$, seed $s = 2$.\n- Case C (no collisions boundary): $N = 160$, $V = 1.0$, $m = 1$, $\\Delta t = 0.02$, $\\sigma_T = 0$, drift $\\mathbf{u} = (0.1,0.1,0.1)$, seed $s = 3$.\n- Case D (small population edge case): $N = 2$, $V = 1.0$, $m = 1$, $\\Delta t = 1.0$, $\\sigma_T = 0.5$, drift $\\mathbf{u} = (0,0,0)$, seed $s = 4$.\n\nFinal output format:\nYour program should produce a single line of output containing the four results $R$ for Cases A–D, as a comma-separated list enclosed in square brackets (for example, $[r_A,r_B,r_C,r_D]$). Each $r_\\cdot$ must be a floating-point number.", "solution": "The user requires an implementation of a single Direct Simulation Monte Carlo (DSMC) collision step for a spatially uniform system. The objective is to numerically verify the conservation of mass, momentum, and energy during the collision process. The algorithm follows the No-Time-Counter (NTC) majorant frequency scheme.\n\nThe process is as follows:\nFirst, we initialize the system state according to the provided parameters. For $N$ particles, we generate their initial velocities $\\{\\mathbf{v}_i\\}_{i=1}^{N}$. Each velocity vector is drawn from a $3$-dimensional standard normal distribution, to which a constant drift velocity $\\mathbf{u}$ is added. The particle mass $m$ is set to $1$.\n\nBefore executing the collision step, we compute the initial values of the collision invariants:\n- Total mass: $M_{\\text{tot}}^{\\text{before}} = m \\sum_{i=1}^{N} 1 = mN$. Since $m$ and $N$ are constant, mass is trivially conserved.\n- Total momentum: $\\mathbf{P}^{\\text{before}} = m \\sum_{i=1}^{N} \\mathbf{v}_i$.\n- Total kinetic energy: $E^{\\text{before}} = \\frac{m}{2} \\sum_{i=1}^{N} \\|\\mathbf{v}_i\\|^2$.\n\nThe collision algorithm begins by determining the majorant relative speed, $g_{\\max} = \\max_{i<j} \\|\\mathbf{v}_i - \\mathbf{v}_j\\|$, across all pairs of particles. To do this efficiently, we can use vectorized operations to compute all pairwise differences, their squared magnitudes, and find the maximum. If $g_{\\max}=0$, all particles have the same velocity, and no collisions can occur.\n\nThe expected number of collision trials, $\\overline{M}$, is then calculated using the provided formula:\n$$\n\\overline{M} = \\frac{N(N-1)}{2}\\,\\frac{\\sigma_T\\,g_{\\max}\\,\\Delta t}{V}\n$$\nThe actual number of trials, $M$, is a stochastic integer value determined by $M = \\lfloor \\overline{M} + U \\rfloor$, where $U$ is a random number drawn from a uniform distribution $\\mathrm{Uniform}(0,1)$. This method ensures that the expected value of $M$ is $\\overline{M}$.\n\nA loop is then executed $M$ times. In each iteration, a potential collision is simulated:\n1.  A random ordered pair of distinct particle indices, $(i, j)$, is selected uniformly from the $N(N-1)$ possibilities.\n2.  The current relative velocity $\\mathbf{g} = \\mathbf{v}_i - \\mathbf{v}_j$ and its magnitude $g = \\|\\mathbf{g}\\|$ are computed for this pair.\n3.  The trial is accepted as a real collision with probability $\\min(1, g/g_{\\max})$. This is the core of the majorant frequency method, which corrects for using a constant majorant collision frequency based on $g_{\\max}$ instead of the pair-specific frequency based on $g$.\n4.  If the collision is accepted, the post-collision velocities, $\\mathbf{v}_i'$ and $\\mathbf{v}_j'$, are calculated. For an isotropic hard-sphere model, this involves rotating the relative velocity vector $\\mathbf{g}$ to a new random direction $\\widehat{\\mathbf{n}}$ sampled uniformly from the unit sphere, while conserving the pair's center-of-mass velocity $\\mathbf{V}_{\\mathrm{cm}}$ and kinetic energy. The update formulas are:\n    $$\n    \\mathbf{v}_i' = \\mathbf{V}_{\\mathrm{cm}} + \\frac{1}{2}\\,g\\,\\widehat{\\mathbf{n}},\\qquad\n    \\mathbf{v}_j' = \\mathbf{V}_{\\mathrm{cm}} - \\frac{1}{2}\\,g\\,\\widehat{\\mathbf{n}}\n    $$\n    where $\\mathbf{V}_{\\mathrm{cm}} = \\frac{1}{2}(\\mathbf{v}_i + \\mathbf{v}_j)$. These new velocities replace the old ones in the system's state. If the trial is rejected, the velocities remain unchanged.\n\nAfter the loop completes, the final values of the total momentum $\\mathbf{P}^{\\text{after}}$ and total kinetic energy $E^{\\text{after}}$ are computed. Analytically, binary elastic collisions conserve momentum and energy. Thus, any deviation from the initial values, aside from being zero for cases with no collisions, must be attributable to floating-point representation errors.\n\nFinally, we compute the maximum absolute deviation among the invariants:\n$$\nR = \\max\\left\\{\\Delta M_{\\text{tot}}, \\|\\Delta \\mathbf{P}\\|, \\Delta E\\right\\}\n$$\nwhere $\\Delta M_{\\text{tot}} = |M_{\\text{tot}}^{\\text{after}} - M_{\\text{tot}}^{\\text{before}}| = 0$ (by definition), $\\|\\Delta \\mathbf{P}\\| = \\|\\mathbf{P}^{\\text{after}} - \\mathbf{P}^{\\text{before}}\\|$, and $\\Delta E = |E^{\\text{after}} - E^{\\text{before}}|$. The value of $R$ should be numerically very close to zero, confirming the conservation properties of the implemented algorithm. The implementation will be executed for each test case using its specified parameters and random seed.", "answer": "```python\nimport numpy as np\n\ndef run_dsmc_step(N, V, m, dt, sigma_T, u_drift, seed):\n    \"\"\"\n    Performs a single DSMC collision step for a uniform cell.\n    \n    Args:\n        N (int): Number of particles.\n        V (float): Volume of the cell.\n        m (float): Mass of each particle.\n        dt (float): Time step.\n        sigma_T (float): Total collision cross-section.\n        u_drift (np.ndarray): Drift velocity vector (shape (3,)).\n        seed (int): Seed for the random number generator.\n\n    Returns:\n        float: The maximum deviation R among collision invariants.\n    \"\"\"\n    # Use a dedicated generator for reproducibility for each test case.\n    rng = np.random.default_rng(seed)\n\n    # 1. Initialize particle velocities from N(0,I) + drift.\n    velocities = rng.normal(loc=0.0, scale=1.0, size=(N, 3)) + u_drift\n    \n    # 2. Compute \"before\" collision invariants.\n    # Total mass is constant, so its change is always zero.\n    delta_M_tot = 0.0\n    P_before = m * np.sum(velocities, axis=0)\n    E_before = (m / 2.0) * np.sum(velocities**2)\n    \n    # 3. Perform the collision step.\n    # 3a. Compute the majorant relative speed g_max.\n    g_max = 0.0\n    if N >= 2:\n        # A vectorized approach to find the max relative speed.\n        # This creates an (N, N, 3) array of v_i - v_j.\n        diffs = velocities[:, np.newaxis, :] - velocities[np.newaxis, :, :]\n        # This gives an (N, N) matrix of squared relative speeds.\n        g_sq_matrix = np.sum(diffs**2, axis=-1)\n        # The maximum of this matrix is g_max^2.\n        g_max_sq = np.max(g_sq_matrix)\n        if g_max_sq > 0:\n            g_max = np.sqrt(g_max_sq)\n            \n    # If g_max is 0, all particles have the same velocity, so M_bar is 0, M is 0.\n    # The collision loop will not run.\n    if g_max > 0.0:\n        # 3b. Calculate the number of collision trials, M.\n        M_bar = (N * (N - 1) / 2.0) * (sigma_T * g_max * dt) / V\n        U = rng.uniform(0.0, 1.0)\n        M = int(M_bar + U)\n        \n        # 3c. Main collision loop.\n        for _ in range(M):\n            # Select a random ordered pair of distinct indices (i, j).\n            i = rng.integers(0, N)\n            j = rng.integers(0, N - 1)\n            if j >= i:\n                j += 1\n            \n            # Compute relative velocity for the selected pair.\n            g_vec = velocities[i] - velocities[j]\n            g = np.linalg.norm(g_vec)\n\n            # 3d. Acceptance-rejection step.\n            if rng.uniform(0.0, 1.0)  g / g_max:\n                # Collision accepted.\n                # Compute center-of-mass velocity.\n                V_cm = 0.5 * (velocities[i] + velocities[j])\n                \n                # Sample a new relative velocity direction uniformly on the unit sphere.\n                z = rng.normal(loc=0.0, scale=1.0, size=3)\n                norm_z = np.linalg.norm(z)\n                if norm_z == 0.0: # Highly unlikely but good practice.\n                    n_hat = np.array([1.0, 0.0, 0.0])\n                else:\n                    n_hat = z / norm_z\n                    \n                # Update particle velocities.\n                velocities[i] = V_cm + 0.5 * g * n_hat\n                velocities[j] = V_cm - 0.5 * g * n_hat\n    \n    # 4. Compute \"after\" collision invariants.\n    P_after = m * np.sum(velocities, axis=0)\n    E_after = (m / 2.0) * np.sum(velocities**2)\n    \n    # 5. Calculate deviations and the final result R.\n    delta_P_norm = np.linalg.norm(P_after - P_before)\n    delta_E = abs(E_after - E_before)\n    \n    R = max(delta_M_tot, delta_P_norm, delta_E)\n    \n    return R\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: (N, V, m, dt, sigma_T, u_drift, seed)\n        (160, 1.0, 1.0, 0.02, 0.1, np.array([0.0, 0.0, 0.0]), 1),\n        # Case B:\n        (160, 1.0, 1.0, 0.02, 0.1, np.array([0.5, -0.3, 0.2]), 2),\n        # Case C:\n        (160, 1.0, 1.0, 0.02, 0.0, np.array([0.1, 0.1, 0.1]), 3),\n        # Case D:\n        (2, 1.0, 1.0, 1.0, 0.5, np.array([0.0, 0.0, 0.0]), 4),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_dsmc_step(*case)\n        results.append(result)\n\n    # Print the results in the specified format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3309089"}]}