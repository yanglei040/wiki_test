{"hands_on_practices": [{"introduction": "Before we delve into complex numerical implementations, it's essential to ground our understanding in the fundamental principles of thermodynamics. This first practice is a foundational derivation that illuminates the intricate coupling between fluid dynamics, heat release, and chemical kinetics in a reacting mixture. By deriving the material derivative of pressure for a Lagrangian parcel, you will establish a direct analytical link between the evolution of pressure ($dp/dt$), temperature ($\\dot{T}$), and species composition ($\\dot{Y}_k$), providing a crucial piece of the governing equations for reacting flow simulations. [@problem_id:3356521]", "problem": "Consider a spatially uniform, adiabatic, inviscid, non-conducting Lagrangian parcel of an ideal-gas mixture composed of $N$ chemical species indexed by $k=1,\\dots,N$. Let the species mass fractions be $Y_k$ with $\\sum_{k=1}^{N} Y_k = 1$, the mixture density be $\\rho$, the pressure be $p$, and the temperature be $T$. Each species $k$ has molecular weight $W_k$, individual gas constant $R_k = R_u/W_k$ where $R_u$ is the universal gas constant, temperature-dependent constant-pressure and constant-volume specific heats $c_{p,k}(T)$ and $c_{v,k}(T)$, and thermochemical functions of temperature $h_k(T)$ and $e_k(T)$ obeying the ideal-gas caloric relation $h_k(T) = e_k(T) + R_k T$. Define the mixture properties by mass-weighted sums:\n$$\nc_p(T,\\mathbf{Y}) = \\sum_{k=1}^{N} Y_k\\,c_{p,k}(T),\\quad\nc_v(T,\\mathbf{Y}) = \\sum_{k=1}^{N} Y_k\\,c_{v,k}(T),\\quad\nR(\\mathbf{Y}) = \\sum_{k=1}^{N} Y_k\\,R_k,\n$$\nand the mixture ratio of specific heats\n$$\n\\gamma(T,\\mathbf{Y}) = \\frac{c_p(T,\\mathbf{Y})}{c_v(T,\\mathbf{Y})}.\n$$\nAssume the mixture obeys the ideal-gas equation of state $p = \\rho\\,R(\\mathbf{Y})\\,T$, and that the parcel experiences composition changes $\\dot{Y}_k = dY_k/dt$ due to finite-rate chemistry, with a temperature rate $\\dot{T} = dT/dt$. Using only the ideal-gas mixture assumptions and first principles (the first law of thermodynamics for a moving parcel and mass conservation), perform the following:\n\n- Explain how the mixture $c_p$, $c_v$, and $\\gamma$ depend on $Y_k$ and $T$.\n- Derive a closed-form expression for the material time derivative of the pressure, $\\frac{dp}{dt}$, for the Lagrangian reacting parcel, expressed entirely in terms of $\\dot{T}$, $\\dot{Y}_k$, and thermochemical functions of $T$.\n\nYour final expression for $\\frac{dp}{dt}$ must be written as a single analytic formula in terms of $\\rho$, $c_p(T,\\mathbf{Y})$, $h_k(T)$, $\\dot{T}$, and $\\dot{Y}_k$. No numerical evaluation is required, and no rounding is needed. Express the final answer as the single analytic expression requested.", "solution": "The problem is subjected to validation before proceeding to a solution.\n\n### Step 1: Extract Givens\n- **System:** A spatially uniform, adiabatic, inviscid, non-conducting Lagrangian parcel of an ideal-gas mixture.\n- **Species:** $N$ chemical species, indexed by $k=1,\\dots,N$.\n- **State variables:** Species mass fractions $Y_k$ with $\\sum_{k=1}^{N} Y_k = 1$, mixture density $\\rho$, pressure $p$, and temperature $T$.\n- **Species properties:** Molecular weight $W_k$, individual gas constant $R_k = R_u/W_k$, temperature-dependent constant-pressure specific heat $c_{p,k}(T)$, temperature-dependent constant-volume specific heat $c_{v,k}(T)$, specific enthalpy $h_k(T)$, and specific internal energy $e_k(T)$.\n- **Constitutive relations:** Ideal-gas caloric relation $h_k(T) = e_k(T) + R_k T$.\n- **Mixture properties:**\n  - $c_p(T,\\mathbf{Y}) = \\sum_{k=1}^{N} Y_k\\,c_{p,k}(T)$\n  - $c_v(T,\\mathbf{Y}) = \\sum_{k=1}^{N} Y_k\\,c_{v,k}(T)$\n  - $R(\\mathbf{Y}) = \\sum_{k=1}^{N} Y_k\\,R_k$\n  - $\\gamma(T,\\mathbf{Y}) = \\frac{c_p(T,\\mathbf{Y})}{c_v(T,\\mathbf{Y})}$\n- **Governing equations:** Mixture ideal-gas equation of state $p = \\rho\\,R(\\mathbf{Y})\\,T$.\n- **Process information:** Finite-rate chemistry leads to composition changes $\\dot{Y}_k = dY_k/dt$ and a temperature rate $\\dot{T} = dT/dt$.\n- **Objective:**\n  1. Explain how the mixture properties $c_p$, $c_v$, and $\\gamma$ depend on $Y_k$ and $T$.\n  2. Derive a closed-form expression for the material time derivative of the pressure, $dp/dt$, in terms of $\\rho$, $c_p(T,\\mathbf{Y})$, $h_k(T)$, $\\dot{T}$, and $\\dot{Y}_k$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is examined for validity:\n- **Scientific Grounding:** The problem is based on the fundamental principles of thermodynamics and chemical kinetics as applied to ideal gas mixtures. All definitions and equations (e.g., ideal gas law, definitions of mixture properties) are standard in the field of reacting flows and combustion. The setup is scientifically sound.\n- **Well-Posedness:** The problem asks for a derivation based on a given set of principles and definitions. All necessary information appears to be provided. The objective is clear and a unique analytical result is expected.\n- **Objectivity:** The problem is stated in precise, objective language, free of subjective claims or ambiguity.\n- **Completeness and Consistency:** The problem provides a self-contained set of assumptions (adiabatic, inviscid, ideal gas, etc.) and definitions. There are no apparent contradictions. The concept of a spatially uniform Lagrangian parcel is a standard simplification in chemical kinetics modeling (e.g., a zero-dimensional reactor model).\n- **Feasibility:** The scenario is physically plausible within the context of theoretical and computational modeling of reacting flows.\n- **Structure:** The problem is well-structured and does not contain any trivialities or circular reasoning. The derivation requires a multi-step application of first principles.\n\n### Step 3: Verdict and Action\nThe problem is deemed **valid**. It is a standard, well-posed problem in theoretical reacting-flow physics. A solution will be provided.\n\n### Solution\n\nThe solution is presented in two parts as requested by the problem statement.\n\n**Part 1: Dependence of Thermochemical Properties**\n\nThe mixture's thermochemical properties are defined as mass-weighted averages of the individual species' properties.\n\n- The mixture's constant-pressure specific heat, $c_p(T,\\mathbf{Y})$, is defined as $c_p(T,\\mathbf{Y}) = \\sum_{k=1}^{N} Y_k c_{p,k}(T)$. The individual species specific heats, $c_{p,k}$, are functions of temperature $T$. The mixture property $c_p$ is a linear combination of these functions, with the coefficients being the mass fractions $Y_k$. Therefore, $c_p$ depends on both the temperature $T$ and the composition vector $\\mathbf{Y} = (Y_1, \\dots, Y_N)$.\n\n- Similarly, the mixture's constant-volume specific heat, $c_v(T,\\mathbf{Y})$, is defined as $c_v(T,\\mathbf{Y}) = \\sum_{k=1}^{N} Y_k c_{v,k}(T)$. For the same reason as with $c_p$, the mixture property $c_v$ depends on both temperature $T$ (via $c_{v,k}(T)$) and composition $\\mathbf{Y}$ (via the weights $Y_k$).\n\n- The ratio of specific heats, $\\gamma(T,\\mathbf{Y})$, is defined as $\\gamma(T,\\mathbf{Y}) = \\frac{c_p(T,\\mathbf{Y})}{c_v(T,\\mathbf{Y})}$. Since both its numerator and denominator depend on $T$ and $\\mathbf{Y}$, the ratio $\\gamma$ is also a function of both temperature and composition.\n\n**Part 2: Derivation of the Pressure Derivative**\n\nThe objective is to derive an expression for the material time derivative of pressure, $dp/dt$. The most direct path is to relate the pressure evolution to the evolution of the specific enthalpy of the mixture.\n\nFirst, we derive a fundamental thermodynamic relation for the specified system. The first law of thermodynamics for a closed Lagrangian parcel of constant mass $m$ is:\n$$ dE = \\delta Q - \\delta W $$\nwhere $E$ is the total internal energy, $\\delta Q$ is the heat added to the system, and $\\delta W$ is the work done by the system. The problem states the parcel is adiabatic, so $\\delta Q=0$. The work done by expansion is $\\delta W = p dV$, where $V$ is the volume of the parcel.\nThus, the first law simplifies to $dE = -p dV$.\nIn terms of specific quantities, $E = m e$ and $V = m v = m/\\rho$, where $e$ is the specific internal energy, $v$ is the specific volume, and $\\rho$ is the density. Since mass $m$ is constant:\n$$ m \\, de = -p \\, d(m/\\rho) = -pm \\, d(\\rho^{-1}) = -pm (-\\rho^{-2} d\\rho) = \\frac{mp}{\\rho^2} d\\rho $$\nDividing by $m$, we obtain the specific energy equation for the parcel:\n$$ de = \\frac{p}{\\rho^2} d\\rho $$\nThe specific enthalpy of the mixture, $h$, is defined as $h = e + p/\\rho$. Its differential is:\n$$ dh = de + d(p/\\rho) = de + \\frac{1}{\\rho}dp - \\frac{p}{\\rho^2}d\\rho $$\nSubstituting the expression for $de$:\n$$ dh = \\left(\\frac{p}{\\rho^2} d\\rho\\right) + \\frac{1}{\\rho}dp - \\frac{p}{\\rho^2}d\\rho = \\frac{1}{\\rho}dp $$\nThis yields the elegant and powerful relation $dp = \\rho dh$. For a Lagrangian parcel, this implies that the material time derivatives are related by:\n$$ \\frac{dp}{dt} = \\rho \\frac{dh}{dt} $$\nNow we must find an expression for $dh/dt$. The mixture specific enthalpy is a mass-weighted sum of the species specific enthalpies:\n$$ h(T, \\mathbf{Y}) = \\sum_{k=1}^{N} Y_k h_k(T) $$\nWe take the material time derivative, applying the product rule:\n$$ \\frac{dh}{dt} = \\frac{d}{dt} \\left( \\sum_{k=1}^{N} Y_k h_k(T) \\right) = \\sum_{k=1}^{N} \\left( \\frac{dY_k}{dt} h_k(T) + Y_k \\frac{dh_k(T)}{dt} \\right) $$\nThe term $dY_k/dt$ is the species production rate, denoted $\\dot{Y}_k$. For the derivative of $h_k(T)$, we use the chain rule: $dh_k(T)/dt = (dh_k/dT)(dT/dt)$.\nBy definition, the constant-pressure specific heat of species $k$ is $c_{p,k}(T) = dh_k/dT$. The rate of change of temperature is given as $\\dot{T} = dT/dt$.\nSubstituting these into the expression for $dh/dt$:\n$$ \\frac{dh}{dt} = \\sum_{k=1}^{N} \\dot{Y}_k h_k(T) + \\sum_{k=1}^{N} Y_k c_{p,k}(T) \\frac{dT}{dt} $$\nFactoring out $dT/dt$:\n$$ \\frac{dh}{dt} = \\sum_{k=1}^{N} \\dot{Y}_k h_k(T) + \\left( \\sum_{k=1}^{N} Y_k c_{p,k}(T) \\right) \\dot{T} $$\nThe term in parentheses is the definition of the mixture's constant-pressure specific heat, $c_p(T, \\mathbf{Y})$.\n$$ \\frac{dh}{dt} = \\sum_{k=1}^{N} \\dot{Y}_k h_k(T) + c_p(T, \\mathbf{Y}) \\dot{T} $$\nFinally, we substitute this result back into the pressure evolution equation, $\\frac{dp}{dt} = \\rho \\frac{dh}{dt}$:\n$$ \\frac{dp}{dt} = \\rho \\left( c_p(T, \\mathbf{Y}) \\dot{T} + \\sum_{k=1}^{N} \\dot{Y}_k h_k(T) \\right) $$\nRearranging gives the final expression for the material derivative of pressure, showing its dependence on the rate of change of temperature and the rate of change of composition due to chemical reactions:\n$$ \\frac{dp}{dt} = \\rho c_p(T, \\mathbf{Y}) \\dot{T} + \\rho \\sum_{k=1}^{N} \\dot{Y}_k h_k(T) $$\nThis expression is in the required form, fully defined by the specified variables and thermochemical functions.", "answer": "$$\n\\boxed{\\rho c_p(T, \\mathbf{Y}) \\dot{T} + \\rho \\sum_{k=1}^{N} \\dot{Y}_k h_k(T)}\n$$", "id": "3356521"}, {"introduction": "Moving from theory to robust implementation, we confront the practical choices in representing the thermodynamic state of a system. A model can be formulated using either specific enthalpy ($h$) or specific internal energy ($e$) as a primary variable, which are algebraically equivalent for an ideal gas but lead to different numerical schemes. This hands-on coding exercise challenges you to implement and test both an enthalpy-based ($h$-$T$) and an internal energy-based ($e$-$T$) formulation for a simple reactor, verifying through a controlled restart simulation that both paths yield the same physical result to within numerical precision. [@problem_id:3356511]", "problem": "Consider a homogeneous, zero-dimensional adiabatic reacting ideal-gas mixture evolving under finite-rate chemistry, where the governing framework may store and advance either the sensible enthalpy–temperature pair ($h$–$T$) or the sensible internal energy–temperature pair ($e$–$T$). The physical model must be consistent regardless of the stored thermodynamic variable set, and any differences should arise only from the algebraic form of the thermodynamic relations used, not from a change in physics. The task is to test consistency and conservation when switching mid-simulation between the $h$–$T$ and $e$–$T$ formulations via a controlled restart.\n\nFundamental base for derivation and modeling:\n- The mixture is an ideal gas at constant pressure, homogeneous, and adiabatic.\n- Species reaction follows Finite-Rate Chemistry (FRC) with a single irreversible reaction $A \\rightarrow B$ and Arrhenius kinetics $k(T) = A \\exp\\left(-\\frac{E}{R_u T}\\right)$.\n- Species mass fractions $Y_A$ and $Y_B$ satisfy conservation with $dY_A/dt = -\\omega$ and $dY_B/dt = +\\omega$ where $\\omega = k(T) Y_A$.\n- The sensible thermodynamic functions use constant species-specific heat capacities at constant pressure $c_{p,A}$ and $c_{p,B}$ (units $\\mathrm{J}/(\\mathrm{kg}\\cdot\\mathrm{K})$). The sensible enthalpy is $h_\\text{sensible}(T,Y) = \\sum_k Y_k c_{p,k} T$ and the sensible internal energy is $e_\\text{sensible}(T,Y) = \\sum_k Y_k c_{v,k} T$ with $c_{v,k} = c_{p,k} - R_k$ and $R_k = \\frac{R_u}{W_k}$, where $W_k$ is the molecular weight (units $\\mathrm{kg}/\\mathrm{mol}$) and $R_u$ is the universal gas constant (units $\\mathrm{J}/(\\mathrm{mol}\\cdot\\mathrm{K})$).\n- The heat release per unit mass of species $A$ consumed is a constant $Q$ (units $\\mathrm{J}/\\mathrm{kg}$). Under adiabatic constant-pressure conditions, the physically conserved quantity is the sum of sensible enthalpy and the remaining chemical energy reservoir of $A$ expressed as $H_\\text{total}(t) = h_\\text{sensible}(t) + Q Y_A(t)$.\n\nYou must:\n1. Derive from the fundamental base a consistent temperature evolution equation usable in both the $h$–$T$ and $e$–$T$ formulations that preserves the same physics for an ideal-gas, constant-pressure, adiabatic reactor. Ensure that the formulations are algebraically equivalent for an ideal gas and differ only in the variable set representation.\n2. Implement a program that, for each test case, performs two simulations:\n   - A reference run using the $h$–$T$ formulation from $t=0$ to $t=t_f$.\n   - A controlled-restart run: integrate from $t=0$ to $t=t_\\text{switch}$ using the $h$–$T$ formulation, then restart at $t=t_\\text{switch}$ and continue to $t=t_f$ using the $e$–$T$ formulation.\n3. Compute two metrics per test case:\n   - A consistency metric defined as the maximum relative difference between the final state of the reference run and the final state of the controlled-restart run, taken over $T$, $Y_A$, and $Y_B$. For temperature, use $\\frac{|T_\\text{ref} - T_\\text{restart}|}{\\max(1, |T_\\text{ref}|)}$; for species mass fractions, use absolute differences since they are dimensionless. Aggregate the three by taking the maximum to yield a single dimensionless float.\n   - A conservation metric defined as the maximum relative deviation of $H_\\text{total}(t)$ from its initial value $H_\\text{total}(0)$ over the entire controlled-restart trajectory (both segments), i.e., $\\max_t \\frac{|H_\\text{total}(t) - H_\\text{total}(0)|}{|H_\\text{total}(0)|}$, a dimensionless float.\n\nPhysical constants and units:\n- Use $R_u = 8.314462618$ $\\mathrm{J}/(\\mathrm{mol}\\cdot\\mathrm{K})$.\n- All temperatures must be in Kelvin.\n- All heat capacities $c_{p,k}$ must be in $\\mathrm{J}/(\\mathrm{kg}\\cdot\\mathrm{K})$.\n- All molecular weights $W_k$ must be in $\\mathrm{kg}/\\mathrm{mol}$.\n- All rate prefactors $A$ must be in $\\mathrm{s}^{-1}$, activation energies $E$ in $\\mathrm{J}/\\mathrm{mol}$, and heat release $Q$ in $\\mathrm{J}/\\mathrm{kg}$.\n- Time must be in seconds.\n\nTest suite:\nProvide the following five test cases. Each case specifies $(W_A, W_B, c_{p,A}, c_{p,B}, A, E, Q, Y_A(0), Y_B(0), T(0), t_f, t_\\text{switch})$ with units and values:\n- Case 1 (happy path, pronounced heat release and mixing effects):\n  - $W_A = 2.8 \\times 10^{-2}$ $\\mathrm{kg}/\\mathrm{mol}$, $W_B = 3.2 \\times 10^{-2}$ $\\mathrm{kg}/\\mathrm{mol}$,\n  - $c_{p,A} = 1000$ $\\mathrm{J}/(\\mathrm{kg}\\cdot\\mathrm{K})$, $c_{p,B} = 1400$ $\\mathrm{J}/(\\mathrm{kg}\\cdot\\mathrm{K})$,\n  - $A = 1.0 \\times 10^{7}$ $\\mathrm{s}^{-1}$, $E = 1.2 \\times 10^{5}$ $\\mathrm{J}/\\mathrm{mol}$, $Q = 8.0 \\times 10^{5}$ $\\mathrm{J}/\\mathrm{kg}$,\n  - $Y_A(0) = 0.7$, $Y_B(0) = 0.3$, $T(0) = 1100$ $\\mathrm{K}$,\n  - $t_f = 5.0 \\times 10^{-2}$ $\\mathrm{s}$, $t_\\text{switch} = 2.5 \\times 10^{-2}$ $\\mathrm{s}$.\n- Case 2 (edge case, zero heat release):\n  - Same as Case 1 except $Q = 0$ $\\mathrm{J}/\\mathrm{kg}$.\n- Case 3 (edge case, negligible reaction due to very high activation barrier):\n  - $W_A = 2.8 \\times 10^{-2}$ $\\mathrm{kg}/\\mathrm{mol}$, $W_B = 3.2 \\times 10^{-2}$ $\\mathrm{kg}/\\mathrm{mol}$,\n  - $c_{p,A} = 900$ $\\mathrm{J}/(\\mathrm{kg}\\cdot\\mathrm{K})$, $c_{p,B} = 1500$ $\\mathrm{J}/(\\mathrm{kg}\\cdot\\mathrm{K})$,\n  - $A = 1.0 \\times 10^{12}$ $\\mathrm{s}^{-1}$, $E = 3.0 \\times 10^{5}$ $\\mathrm{J}/\\mathrm{mol}$, $Q = 5.0 \\times 10^{5}$ $\\mathrm{J}/\\mathrm{kg}$,\n  - $Y_A(0) = 0.6$, $Y_B(0) = 0.4$, $T(0) = 900$ $\\mathrm{K}$,\n  - $t_f = 1.0 \\times 10^{-1}$ $\\mathrm{s}$, $t_\\text{switch} = 5.0 \\times 10^{-2}$ $\\mathrm{s}$.\n- Case 4 (boundary case, equal heat capacities and late switch):\n  - $W_A = 2.8 \\times 10^{-2}$ $\\mathrm{kg}/\\mathrm{mol}$, $W_B = 3.2 \\times 10^{-2}$ $\\mathrm{kg}/\\mathrm{mol}$,\n  - $c_{p,A} = 1200$ $\\mathrm{J}/(\\mathrm{kg}\\cdot\\mathrm{K})$, $c_{p,B} = 1200$ $\\mathrm{J}/(\\mathrm{kg}\\cdot\\mathrm{K})$,\n  - $A = 5.0 \\times 10^{6}$ $\\mathrm{s}^{-1}$, $E = 1.0 \\times 10^{5}$ $\\mathrm{J}/\\mathrm{mol}$, $Q = 6.0 \\times 10^{5}$ $\\mathrm{J}/\\mathrm{kg}$,\n  - $Y_A(0) = 0.9$, $Y_B(0) = 0.1$, $T(0) = 1000$ $\\mathrm{K}$,\n  - $t_f = 2.0 \\times 10^{-2}$ $\\mathrm{s}$, $t_\\text{switch} = 1.9 \\times 10^{-2}$ $\\mathrm{s}$.\n- Case 5 (boundary case, immediate switch and fast reaction):\n  - $W_A = 2.8 \\times 10^{-2}$ $\\mathrm{kg}/\\mathrm{mol}$, $W_B = 3.2 \\times 10^{-2}$ $\\mathrm{kg}/\\mathrm{mol}$,\n  - $c_{p,A} = 1300$ $\\mathrm{J}/(\\mathrm{kg}\\cdot\\mathrm{K})$, $c_{p,B} = 1000$ $\\mathrm{J}/(\\mathrm{kg}\\cdot\\mathrm{K})$,\n  - $A = 1.0 \\times 10^{8}$ $\\mathrm{s}^{-1}$, $E = 9.0 \\times 10^{4}$ $\\mathrm{J}/\\mathrm{mol}$, $Q = 1.0 \\times 10^{6}$ $\\mathrm{J}/\\mathrm{kg}$,\n  - $Y_A(0) = 0.95$, $Y_B(0) = 0.05$, $T(0) = 1200$ $\\mathrm{K}$,\n  - $t_f = 1.0 \\times 10^{-4}$ $\\mathrm{s}$, $t_\\text{switch} = 0$ $\\mathrm{s}$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list of five elements, each element being a two-float list $[d_i, c_i]$ where $d_i$ is the consistency metric and $c_i$ is the conservation metric for test case $i$ from $1$ to $5$. For example: [[d1,c1],[d2,c2],[d3,c3],[d4,c4],[d5,c5]]. All reported values must be dimensionless floats.", "solution": "The user-provided problem statement has been analyzed and is determined to be **valid**. It is scientifically sound, well-posed, objective, and self-contained, presenting a standard problem in computational chemical kinetics and thermodynamics. All necessary data and conditions for a unique solution are provided.\n\n### 1. Derivation of the Temperature Evolution Equation\n\nThe fundamental physical principle governing a homogeneous, adiabatic, constant-pressure reacting system is the conservation of total specific enthalpy, $H_\\text{total}$. The problem defines this conserved quantity as the sum of the sensible enthalpy, $h_\\text{sensible}$, and the chemical energy associated with the reactant $A$:\n$$H_\\text{total}(t) = h_\\text{sensible}(t) + Q Y_A(t) = \\text{constant}$$\nwhere $Q$ is the heat release per unit mass of $A$ reacted and $Y_A(t)$ is the mass fraction of species $A$.\n\nDifferentiating this conservation law with respect to time, $t$, yields:\n$$\\frac{d H_\\text{total}}{dt} = \\frac{d h_\\text{sensible}}{dt} + Q \\frac{d Y_A}{dt} = 0$$\nThe rate of change of the mass fraction of species $A$ is given by $dY_A/dt = -\\omega$, where $\\omega$ is the reaction rate. Substituting this into the equation gives the evolution of sensible enthalpy:\n$$\\frac{d h_\\text{sensible}}{dt} = -Q(-\\omega) = Q\\omega$$\nThis equation is a direct consequence of the first law of thermodynamics for this system.\n\nThe sensible enthalpy of the ideal-gas mixture is defined as $h_\\text{sensible} = \\sum_k Y_k c_{p,k} T$, where $Y_k$ is the mass fraction of species $k$, $c_{p,k}$ is its specific heat at constant pressure, and $T$ is the temperature. For the two-species system $A \\rightarrow B$, this is:\n$$h_\\text{sensible} = (Y_A c_{p,A} + Y_B c_{p,B})T = c_p(Y)T$$\nwhere $c_p(Y)$ is the mixture-averaged specific heat.\n\nDifferentiating $h_\\text{sensible}$ with respect to time using the product rule:\n$$\\frac{d h_\\text{sensible}}{dt} = c_p(Y) \\frac{dT}{dt} + T \\frac{d c_p(Y)}{dt}$$\nThe derivative of the mixture heat capacity is:\n$$\\frac{d c_p(Y)}{dt} = c_{p,A} \\frac{dY_A}{dt} + c_{p,B} \\frac{dY_B}{dt} = c_{p,A}(-\\omega) + c_{p,B}(\\omega) = \\omega(c_{p,B} - c_{p,A})$$\nSubstituting this back gives:\n$$\\frac{d h_\\text{sensible}}{dt} = c_p(Y) \\frac{dT}{dt} + T\\omega(c_{p,B} - c_{p,A})$$\nBy equating the two expressions for $d h_\\text{sensible}/dt$, we find:\n$$Q\\omega = c_p(Y) \\frac{dT}{dt} + T\\omega(c_{p,B} - c_{p,A})$$\nSolving for $dT/dt$, we obtain the governing equation for temperature evolution:\n$$\\frac{dT}{dt} = \\frac{\\omega [Q - T(c_{p,B} - c_{p,A})]}{c_p(Y)} = \\frac{\\omega [Q - T(c_{p,B} - c_{p,A})]}{Y_A c_{p,A} + Y_B c_{p,B}}$$\nThis equation is derived from an enthalpy-based ($h$-$T$) perspective.\n\nTo demonstrate consistency, we now derive the same equation from an internal energy-based ($e$-$T$) perspective. The sensible internal energy is $e_\\text{sensible} = \\sum_k Y_k c_{v,k} T = c_v(Y)T$, where $c_{v,k} = c_{p,k} - R_k$ is the specific heat at constant volume and $R_k = R_u/W_k$ is the specific gas constant.\n\nThe relationship between sensible enthalpy and internal energy for an ideal-gas mixture is $h_\\text{sensible} = e_\\text{sensible} + RT$, where $R = \\sum_k Y_k R_k$.\nDifferentiating this relation:\n$$\\frac{de_\\text{sensible}}{dt} = \\frac{dh_\\text{sensible}}{dt} - \\frac{d(RT)}{dt}$$\nWe already know $dh_\\text{sensible}/dt = Q\\omega$. We expand the second term on the right-hand side:\n$$\\frac{d(RT)}{dt} = R(Y)\\frac{dT}{dt} + T\\frac{dR(Y)}{dt} = R(Y)\\frac{dT}{dt} + T\\omega(R_B - R_A)$$\nThus, we have an expression for the rate of change of sensible internal energy:\n$$\\frac{de_\\text{sensible}}{dt} = Q\\omega - \\left[ R(Y)\\frac{dT}{dt} + T\\omega(R_B - R_A) \\right]$$\nNow, we differentiate $e_\\text{sensible} = c_v(Y)T$ directly:\n$$\\frac{de_\\text{sensible}}{dt} = c_v(Y)\\frac{dT}{dt} + T\\frac{dc_v(Y)}{dt} = c_v(Y)\\frac{dT}{dt} + T\\omega(c_{v,B} - c_{v,A})$$\nEquating the two expressions for $de_\\text{sensible}/dt$:\n$$c_v(Y)\\frac{dT}{dt} + T\\omega(c_{v,B} - c_{v,A}) = Q\\omega - R(Y)\\frac{dT}{dt} - T\\omega(R_B - R_A)$$\nGrouping the $dT/dt$ terms:\n$$(c_v(Y) + R(Y))\\frac{dT}{dt} = Q\\omega - T\\omega[(c_{v,B} - c_{v,A}) + (R_B - R_A)]$$\nUsing the ideal gas relations $c_p(Y) = c_v(Y) + R(Y)$ and $c_{p,k} = c_{v,k} + R_k$, the equation simplifies to:\n$$c_p(Y)\\frac{dT}{dt} = Q\\omega - T\\omega(c_{p,B} - c_{p,A})$$\nThis yields the identical temperature evolution equation as derived from the $h$-$T$ formulation. This confirms that the underlying physics is independent of the choice of thermodynamic variable, and a consistent implementation of either formulation must lead to the same result for the primitive variables $(Y_k, T)$.\n\n### 2. Numerical Implementation and Simulation Strategy\n\nBased on the derivation, we can construct two distinct but physically equivalent numerical schemes. The difference lies in the state variables that are integrated in time.\n\n**h-T Formulation:**\nThe state vector is $\\vec{u}_h = [Y_A, h_\\text{sensible}]$. The system of Ordinary Differential Equations (ODEs) is:\n$$\\frac{dY_A}{dt} = -\\omega$$\n$$\\frac{dh_\\text{sensible}}{dt} = Q\\omega$$\nAt each step of the integration, the temperature $T$ required to evaluate the reaction rate $\\omega = A \\exp(-E/R_u T) Y_A$ is recovered algebraically:\n$$T = \\frac{h_\\text{sensible}}{Y_A c_{p,A} + (1-Y_A)c_{p,B}}$$\n\n**e-T Formulation:**\nThe state vector is $\\vec{u}_e = [Y_A, e_\\text{sensible}]$. The ODE for $Y_A$ is the same. The ODE for $e_\\text{sensible}$ is derived from its definition $e_\\text{sensible} = c_v(Y)T$:\n$$\\frac{de_\\text{sensible}}{dt} = c_v(Y)\\frac{dT}{dt} + T\\frac{dc_v(Y)}{dt} = c_v(Y)\\frac{dT}{dt} + T\\omega(c_{v,B} - c_{v,A})$$\nHere, $dT/dt$ is the unique, physically-correct evolution equation derived previously. The temperature $T$ is recovered from:\n$$T = \\frac{e_\\text{sensible}}{Y_A c_{v,A} + (1-Y_A)c_{v,B}}$$\n\n**Simulation Procedure:**\nFor each test case, two simulations are performed using a numerical ODE solver (`scipy.integrate.solve_ivp`):\n1.  **Reference Run:** The $h$-$T$ formulation is used to integrate the state $\\vec{u}_h$ from $t=0$ to $t=t_f$.\n2.  **Controlled-Restart Run:**\n    - From $t=0$ to $t=t_\\text{switch}$, the $h$-$T$ formulation is used to integrate $\\vec{u}_h$.\n    - At $t=t_\\text{switch}$, the state is converted. From the final state $[Y_A(t_\\text{switch}), h_\\text{sensible}(t_\\text{switch})]$, the temperature $T(t_\\text{switch})$ is calculated. Then, the corresponding sensible internal energy $e_\\text{sensible}(t_\\text{switch})$ is computed.\n    - From $t=t_\\text{switch}$ to $t=t_f$, the $e$-$T$ formulation is used to integrate the state $\\vec{u}_e = [Y_A, e_\\text{sensible}]$, starting from the converted state.\n\n### 3. Metric Calculation\n\n-   **Consistency Metric ($d$):** After both runs complete at $t=t_f$, the final primitive variables ($T$, $Y_A$, $Y_B$) are compared. The metric $d$ is the maximum of the relative error in temperature and the absolute errors in mass fractions. Small, non-zero values reflect the accumulation of floating-point and integration errors, which may differ slightly between the two formulations.\n-   **Conservation Metric ($c$):** For the controlled-restart run, the total enthalpy $H_\\text{total}(t) = h_\\text{sensible}(t) + Q Y_A(t)$ is computed at numerous points along the entire trajectory $[0, t_f]$. For the second leg of the simulation ($t > t_\\text{switch}$), this requires converting the integrated state variable $e_\\text{sensible}(t)$ back to $h_\\text{sensible}(t)$ for each point. The metric $c$ is the maximum relative deviation of $H_\\text{total}(t)$ from its initial value $H_\\text{total}(0)$. This measures how well the numerical schemes preserve the fundamental conserved quantity.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    R_u = 8.314462618  # J/(mol.K)\n\n    test_cases = [\n        # Case 1: happy path\n        (2.8e-2, 3.2e-2, 1000.0, 1400.0, 1.0e7, 1.2e5, 8.0e5, 0.7, 0.3, 1100.0, 5.0e-2, 2.5e-2),\n        # Case 2: zero heat release\n        (2.8e-2, 3.2e-2, 1000.0, 1400.0, 1.0e7, 1.2e5, 0.0, 0.7, 0.3, 1100.0, 5.0e-2, 2.5e-2),\n        # Case 3: negligible reaction\n        (2.8e-2, 3.2e-2, 900.0, 1500.0, 1.0e12, 3.0e5, 5.0e5, 0.6, 0.4, 900.0, 1.0e-1, 5.0e-2),\n        # Case 4: equal heat capacities\n        (2.8e-2, 3.2e-2, 1200.0, 1200.0, 5.0e6, 1.0e5, 6.0e5, 0.9, 0.1, 1000.0, 2.0e-2, 1.9e-2),\n        # Case 5: immediate switch\n        (2.8e-2, 3.2e-2, 1300.0, 1000.0, 1.0e8, 9.0e4, 1.0e6, 0.95, 0.05, 1200.0, 1.0e-4, 0.0),\n    ]\n\n    results = []\n    for params in test_cases:\n        metrics = _run_one_case(params, R_u)\n        results.append(metrics)\n    \n    # Format the final output string as specified.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef _run_one_case(params, R_u):\n    \"\"\"\n    Runs a single test case with both reference and restart simulations and computes metrics.\n    \"\"\"\n    Wa, Wb, cpa, cpb, A, E, Q, Ya0, Yb0, T0, tf, t_switch = params\n\n    Ra = R_u / Wa\n    Rb = R_u / Wb\n    cva = cpa - Ra\n    cvb = cpb - Rb\n    \n    # Pack parameters for ODE functions\n    ode_params = (A, E, Q, R_u, cpa, cpb, cva, cvb)\n\n    # --- ODE System Definitions ---\n\n    def ode_h_form(t, y, p):\n        A, E, Q, R_u, cpa, cpb, _,_ = p\n        Ya, h_sens = y\n        Yb = 1.0 - Ya\n        \n        cp_mix = Ya * cpa + Yb * cpb\n        if cp_mix == 0: return [0.0, 0.0]\n        T = h_sens / cp_mix\n        \n        # Avoid underflow/overflow with temperature bounds\n        if T  250: return [0.0, 0.0]\n        \n        k = A * np.exp(-E / (R_u * T))\n        omega = k * Ya\n        \n        dYa_dt = -omega\n        dh_dt = Q * omega\n        return [dYa_dt, dh_dt]\n\n    def ode_e_form(t, y, p):\n        A, E, Q, R_u, cpa, cpb, cva, cvb = p\n        Ya, e_sens = y\n        Yb = 1.0 - Ya\n\n        cv_mix = Ya * cva + Yb * cvb\n        if cv_mix == 0: return [0.0, 0.0]\n        T = e_sens / cv_mix\n        \n        if T  250: return [0.0, 0.0]\n\n        k = A * np.exp(-E / (R_u * T))\n        omega = k * Ya\n        dYa_dt = -omega\n        \n        # Calculate dT/dt from the consistent physical model\n        cp_mix = Ya * cpa + Yb * cpb\n        if cp_mix == 0:\n            dT_dt = 0.0\n        else:\n            dT_dt = (omega * (Q - T * (cpb - cpa))) / cp_mix\n        \n        # Calculate de/dt using chain rule: de/dt = d(cv*T)/dt\n        de_dt = cv_mix * dT_dt + T * omega * (cvb - cva)\n        \n        return [dYa_dt, de_dt]\n\n    # --- Simulation Runs ---\n    rtol, atol = 1e-12, 1e-15 # Use tight tolerances for high precision\n\n    # 1. Reference Run (h-formulation for the whole duration)\n    h_sens0 = (Ya0 * cpa + Yb0 * cpb) * T0\n    y0_h = [Ya0, h_sens0]\n    \n    sol_ref = solve_ivp(ode_h_form, [0, tf], y0_h, args=(ode_params,), dense_output=True, rtol=rtol, atol=atol)\n    \n    Ya_ref_f, h_sens_ref_f = sol_ref.y[:, -1]\n    Yb_ref_f = 1.0 - Ya_ref_f\n    cp_mix_ref_f = Ya_ref_f * cpa + Yb_ref_f * cpb\n    T_ref_f = h_sens_ref_f / cp_mix_ref_f\n\n    # 2. Controlled-Restart Run (h-form then e-form)\n    all_t_samples = []\n    all_H_total = []\n    H_total_0 = h_sens0 + Q * Ya0\n\n    # Part 1: Integrate with h-formulation until t_switch\n    if t_switch > 0:\n        sol1 = solve_ivp(ode_h_form, [0, t_switch], y0_h, args=(ode_params,), dense_output=True, rtol=rtol, atol=atol)\n        Ya_sw, h_sens_sw = sol1.y[:, -1]\n\n        # Sample for conservation check\n        t_samples1 = np.linspace(0, t_switch, 100, endpoint=False)\n        y_samples1 = sol1.sol(t_samples1)\n        H_total1 = y_samples1[1] + Q * y_samples1[0]\n        all_t_samples.append(t_samples1)\n        all_H_total.append(H_total1)\n    else: # Immediate switch\n        Ya_sw, h_sens_sw = Ya0, h_sens0\n\n    # State conversion for restart\n    Yb_sw = 1.0 - Ya_sw\n    cp_mix_sw = Ya_sw * cpa + Yb_sw * cpb\n    T_sw = h_sens_sw / cp_mix_sw\n    e_sens_sw = (Ya_sw * cva + Yb_sw * cvb) * T_sw\n    y0_e_restart = [Ya_sw, e_sens_sw]\n\n    # Part 2: Integrate with e-formulation from t_switch to tf\n    if t_switch  tf:\n        sol2 = solve_ivp(ode_e_form, [t_switch, tf], y0_e_restart, args=(ode_params,), dense_output=True, rtol=rtol, atol=atol)\n        Ya_res_f, e_sens_res_f = sol2.y[:, -1]\n        \n        # Sample for conservation check\n        t_samples2 = np.linspace(t_switch, tf, 101)\n        y_samples2 = sol2.sol(t_samples2)\n        Ya_at_t = y_samples2[0]\n        e_sens_at_t = y_samples2[1]\n        Yb_at_t = 1.0 - Ya_at_t\n        \n        T_at_t = e_sens_at_t / (Ya_at_t * cva + Yb_at_t * cvb)\n        h_sens_at_t = (Ya_at_t * cpa + Yb_at_t * cpb) * T_at_t\n        H_total2 = h_sens_at_t + Q * Ya_at_t\n        all_t_samples.append(t_samples2)\n        all_H_total.append(H_total2)\n\n    else: # Switch is at the end, final state is from Part 1\n        Ya_res_f, h_sens_res_f = Ya_sw, h_sens_sw\n        # Convert to e-framework variables to get T_res_f\n        cv_mix_res_f = Ya_res_f * cva + (1.0 - Ya_res_f) * cvb\n        T_res_f = e_sens_sw / cv_mix_res_f # This is T_sw\n        # This path might have a slight discrepancy, let's calculate from h for correct final T\n        Yb_res_f = 1.0 - Ya_res_f\n        cp_mix_res_f = Ya_res_f * cpa + Yb_res_f * cpb\n        T_res_f = h_sens_res_f / cp_mix_res_f\n    \n    # Final state of restart run in primitive variables\n    Yb_res_f = 1.0 - Ya_res_f\n    cv_mix_res_f = Ya_res_f * cva + Yb_res_f * cvb\n    if t_switch  tf:\n        T_res_f = e_sens_res_f / cv_mix_res_f\n    \n    # --- Metric Calculation ---\n\n    # 1. Consistency Metric\n    temp_err = np.abs(T_ref_f - T_res_f) / np.maximum(1.0, np.abs(T_ref_f))\n    ya_err = np.abs(Ya_ref_f - Ya_res_f)\n    yb_err = np.abs(Yb_ref_f - Yb_res_f)\n    consistency_metric = np.max([temp_err, ya_err, yb_err])\n\n    # 2. Conservation Metric\n    if not all_H_total:\n         conservation_metric = 0.0\n    else:\n        H_total_trajectory = np.concatenate(all_H_total)\n        if H_total_0 == 0:\n            if np.all(H_total_trajectory == 0):\n                conservation_metric = 0.0\n            else:\n                conservation_metric = np.inf\n        else:\n            conservation_metric = np.max(np.abs(H_total_trajectory - H_total_0) / np.abs(H_total_0))\n            \n    return [float(consistency_metric), float(conservation_metric)]\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3356511"}, {"introduction": "The primary computational hurdle in finite-rate chemistry simulations is the extreme stiffness of the governing ordinary differential equations, which necessitates implicit time integration and the solution of large linear systems involving the Jacobian matrix. This advanced practice addresses this performance bottleneck by merging concepts from chemical kinetics, numerical analysis, and graph theory. You will analyze the inherent sparsity of the chemical Jacobian and implement a graph-coloring algorithm to dramatically reduce the number of function evaluations needed to compute a finite-difference approximation, a powerful technique used to accelerate modern Jacobian-Free Newton-Krylov (JFNK) solvers. [@problem_id:3356523]", "problem": "Consider a reacting flow framework with finite-rate chemistry for a homogeneous, isothermal mixture of $n_s$ chemical species undergoing $n_r$ elementary, irreversible reactions. Let the molar concentration vector be $\\mathbf{c} \\in \\mathbb{R}^{n_s}$ with components $c_j$ for species $j$, and let the reaction rate vector be $\\mathbf{R}(\\mathbf{c}) \\in \\mathbb{R}^{n_r}$. Each reaction $k$ has an Arrhenius rate constant $A_k \\exp(-E_k/(R T))$ and follows the law of mass action with reactant stoichiometric exponents $\\alpha_{jk} \\in \\{0,1,2,\\dots\\}$, so that\n$$\nR_k(\\mathbf{c}) = A_k \\exp\\left(-\\frac{E_k}{R T}\\right) \\prod_{j=1}^{n_s} c_j^{\\alpha_{jk}}.\n$$\nThe net production rate of species $i$ is given by the species source term\n$$\nf_i(\\mathbf{c}) = \\sum_{k=1}^{n_r} S_{ik} R_k(\\mathbf{c}),\n$$\nwhere $S \\in \\mathbb{R}^{n_s \\times n_r}$ is the stoichiometric matrix with entries $S_{ik}$ equal to the net stoichiometric change of species $i$ in reaction $k$ (negative for reactants, positive for products, and zero otherwise). The Jacobian matrix of the source term is\n$$\nJ(\\mathbf{c}) = \\frac{\\partial \\mathbf{f}}{\\partial \\mathbf{c}} \\in \\mathbb{R}^{n_s \\times n_s}, \\quad J_{ij}(\\mathbf{c}) = \\sum_{k=1}^{n_r} S_{ik} \\frac{\\partial R_k(\\mathbf{c})}{\\partial c_j}.\n$$\nStarting from these fundamental definitions, perform the following tasks:\n\n1. Derive, in terms of $S_{ik}$ and $\\alpha_{jk}$, a necessary and sufficient condition for the sparsity pattern of $J$, that is, characterize when $J_{ij}(\\mathbf{c})$ can be nonzero without evaluating any rates numerically.\n\n2. Construct the column-interference graph for $J$ whose vertices correspond to columns $j \\in \\{1,\\dots,n_s\\}$ and where an undirected edge connects vertices $p$ and $q$ if and only if columns $p$ and $q$ of $J$ share at least one common row index $i$ for which both $J_{ip}$ and $J_{iq}$ can be nonzero. Explain how a proper graph coloring of this interference graph enables simultaneous finite-difference perturbations that do not alias in any row, thereby reducing the number of function evaluations required to build a sparse Jacobian approximation for use in a Jacobian-Free Newton-Krylov (JFNK) method preconditioner.\n\n3. Define the speedup factor\n$$\n\\sigma = \\frac{m}{q},\n$$\nwhere $m$ is the number of species columns with at least one structurally nonzero Jacobian entry (equivalently, the number of species $j$ that appear as reactants in at least one reaction, i.e., at least one $k$ with $\\alpha_{jk} > 0$), and $q$ is the number of colors produced by a greedy largest-degree-first coloring of the interference graph. The speedup $\\sigma$ quantifies the reduction in function evaluations needed to construct a sparse Jacobian approximation using graph coloring relative to a naive dense approach that perturbs each structurally nonzero column separately. Express $\\sigma$ as a dimensionless float.\n\n4. Implement a complete, runnable program that:\n   - Encodes each reaction mechanism using $n_s$, the matrix $\\alpha \\in \\mathbb{N}_0^{n_s \\times n_r}$, and the stoichiometric matrix $S \\in \\mathbb{Z}^{n_s \\times n_r}$.\n   - Builds the Jacobian sparsity pattern using only $(\\alpha, S)$ according to the condition from part 1.\n   - Constructs the interference graph and computes $q$ via a greedy largest-degree-first coloring.\n   - Computes $m$ and $\\sigma$ for each mechanism in the test suite.\n   - Produces a single line of output with the list of speedup values for all test cases, formatted as a comma-separated list enclosed in square brackets, with each float rounded to three decimal places (e.g., $[1.500,1.000,3.000]$).\n\nUse the following test suite of mechanisms with $n_s = 7$ species labeled $A,B,C,D,E,F,G$ mapped to indices $0,1,2,3,4,5,6$:\n\n- Case 1 (chain of bimolecular reactions; moderate coupling):\n  - Reaction $1$: $A + B \\rightarrow C$ with $\\alpha_{\\cdot,1} = [1,1,0,0,0,0,0]$ and $S_{\\cdot,1} = [-1,-1,+1,0,0,0,0]$.\n  - Reaction $2$: $C + D \\rightarrow E$ with $\\alpha_{\\cdot,2} = [0,0,1,1,0,0,0]$ and $S_{\\cdot,2} = [0,0,-1,-1,+1,0,0]$.\n  - Reaction $3$: $E + F \\rightarrow G$ with $\\alpha_{\\cdot,3} = [0,0,0,0,1,1,0]$ and $S_{\\cdot,3} = [0,0,0,0,-1,-1,+1]$.\n\n- Case 2 (tri-molecular and cross-coupled reactions; near-complete coupling):\n  - Reaction $1$: $A + B + C \\rightarrow D$ with $\\alpha_{\\cdot,1} = [1,1,1,0,0,0,0]$ and $S_{\\cdot,1} = [-1,-1,-1,+1,0,0,0]$.\n  - Reaction $2$: $A + D + E \\rightarrow F$ with $\\alpha_{\\cdot,2} = [1,0,0,1,1,0,0]$ and $S_{\\cdot,2} = [ -1,0,0,-1,-1,+1,0]$.\n  - Reaction $3$: $B + F + G \\rightarrow C$ with $\\alpha_{\\cdot,3} = [0,1,0,0,0,1,1]$ and $S_{\\cdot,3} = [0,-1,+1,0,0,-1,-1]$.\n\n- Case 3 (three parallel unimolecular reactions; minimal coupling):\n  - Reaction $1$: $A \\rightarrow B$ with $\\alpha_{\\cdot,1} = [1,0,0,0,0,0,0]$ and $S_{\\cdot,1} = [-1,+1,0,0,0,0,0]$.\n  - Reaction $2$: $C \\rightarrow D$ with $\\alpha_{\\cdot,2} = [0,0,1,0,0,0,0]$ and $S_{\\cdot,2} = [0,0,-1,+1,0,0,0]$.\n  - Reaction $3$: $E \\rightarrow F$ with $\\alpha_{\\cdot,3} = [0,0,0,0,1,0,0]$ and $S_{\\cdot,3} = [0,0,0,0,-1,+1,0]$.\n\nAll quantities in this problem are dimensionless for the purposes of algorithmic derivation and counting, and no physical units are required. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each float rounded to three decimal places (e.g., $[1.500,1.000,3.000]$).", "solution": "The problem requires a four-part analysis of the Jacobian matrix associated with species source terms in a finite-rate chemistry model, culminating in a computational implementation to calculate a performance metric based on graph coloring. The problem is assessed to be valid as it is scientifically grounded in chemical kinetics and numerical analysis, is well-posed with a complete and consistent setup, and is expressed in objective, formal language.\n\n### Part 1: Jacobian Sparsity Condition\n\nThe Jacobian of the species source term vector $\\mathbf{f}(\\mathbf{c})$ is defined by its components $J_{ij}(\\mathbf{c}) = \\frac{\\partial f_i}{\\partial c_j}$. The source term for species $i$, $f_i(\\mathbf{c})$, is given by:\n$$\nf_i(\\mathbf{c}) = \\sum_{k=1}^{n_r} S_{ik} R_k(\\mathbf{c})\n$$\nwhere $S_{ik}$ is the stoichiometric coefficient of species $i$ in reaction $k$, and $R_k(\\mathbf{c})$ is the rate of reaction $k$. Differentiating with respect to the concentration of species $j$, $c_j$, we get:\n$$\nJ_{ij}(\\mathbf{c}) = \\frac{\\partial}{\\partial c_j} \\left( \\sum_{k=1}^{n_r} S_{ik} R_k(\\mathbf{c}) \\right) = \\sum_{k=1}^{n_r} S_{ik} \\frac{\\partial R_k(\\mathbf{c})}{\\partial c_j}\n$$\nThe rate of reaction $k$, following the law of mass action, is:\n$$\nR_k(\\mathbf{c}) = K_k \\prod_{l=1}^{n_s} c_l^{\\alpha_{lk}}\n$$\nwhere $K_k = A_k \\exp(-E_k/(RT))$ is the rate constant, and $\\alpha_{lk}$ is the reactant stoichiometric exponent for species $l$ in reaction $k$.\n\nTo find the sparsity pattern, we need a condition for when $J_{ij}$ can be structurally non-zero, meaning it is not identically zero for all possible positive concentrations $\\mathbf{c}$. This depends on the partial derivative $\\frac{\\partial R_k}{\\partial c_j}$. Using the product rule, this derivative is non-zero only if species $j$ is a reactant in reaction $k$, i.e., $\\alpha_{jk} > 0$. If we assume all reactant concentrations are positive, the derivative can be written as:\n$$\n\\frac{\\partial R_k(\\mathbf{c})}{\\partial c_j} = \\frac{\\alpha_{jk}}{c_j} R_k(\\mathbf{c})\n$$\nThis term is structurally non-zero if and only if $\\alpha_{jk} > 0$ (assuming a valid reaction with $K_k > 0$ and non-zero reactant concentrations).\n\nA specific term $S_{ik} \\frac{\\partial R_k}{\\partial c_j}$ in the summation for $J_{ij}$ is thus structurally non-zero if and only if two conditions are met simultaneously:\n1.  Species $i$ participates in reaction $k$, which means its net stoichiometric change is non-zero ($S_{ik} \\neq 0$).\n2.  Species $j$ is a reactant in reaction $k$, which means its stoichiometric exponent is positive ($\\alpha_{jk} > 0$).\n\nThe entire Jacobian entry $J_{ij}$ is a sum over all reactions. It is structurally non-zero if at least one term in the summation is structurally non-zero. Therefore, the necessary and sufficient condition for $J_{ij}(\\mathbf{c})$ to be structurally non-zero is:\n\n**There exists at least one reaction $k \\in \\{1, \\dots, n_r\\}$ such that $S_{ik} \\neq 0$ and $\\alpha_{jk} > 0$.**\n\nThis condition depends only on the stoichiometric matrix $S$ and the reactant exponent matrix $\\alpha$, allowing the determination of the Jacobian's sparsity pattern without numerical evaluation.\n\n### Part 2: Column-Interference Graph and Finite Differences\n\nThe column-interference graph $G = (V, E)$ for the Jacobian matrix $J$ is defined as follows:\n- The set of vertices $V$ corresponds to the columns of $J$, so $V = \\{1, \\dots, n_s\\}$, representing each chemical species.\n- An undirected edge $(p, q)$ connects vertices $p$ and $q$ ($p \\neq q$) if their corresponding columns in $J$ share at least one row index $i$ where both entries can be non-zero. Formally, $(p, q) \\in E$ if and only if there exists a row $i \\in \\{1, \\dots, n_s\\}$ such that $J_{ip} \\not\\equiv 0$ and $J_{iq} \\not\\equiv 0$ structurally.\n\nA proper coloring of this graph assigns a color to each vertex such that no two adjacent vertices have the same color. The utility of this coloring lies in optimizing the computation of a sparse Jacobian matrix using finite differences. To approximate the columns of $J$, one can perturb the concentration vector $\\mathbf{c}$ and evaluate the change in the source term vector $\\mathbf{f}$. A naive method perturbs each column $j$ separately:\n$$ J_{\\cdot, j} \\approx \\frac{\\mathbf{f}(\\mathbf{c} + \\epsilon \\mathbf{e}_j) - \\mathbf{f}(\\mathbf{c})}{\\epsilon} $$\nThis requires one function evaluation of $\\mathbf{f}$ per column being approximated.\n\nGraph coloring allows for simultaneous perturbations. All columns (vertices) assigned the same color are, by definition of a proper coloring, mutually non-adjacent. This means that for any pair of columns $p$ and $q$ in the same color group, there is no row $i$ where $J_{ip}$ and $J_{iq}$ are both structurally non-zero.\n\nWe can form a single perturbation vector $\\mathbf{d}$ by summing the individual perturbations for all columns $\\{j_1, j_2, \\dots, j_l\\}$ in a given color group: $\\mathbf{d} = \\sum_{k=1}^l \\epsilon_{j_k} \\mathbf{e}_{j_k}$. When we compute the finite difference $\\Delta\\mathbf{f} = \\mathbf{f}(\\mathbf{c} + \\mathbf{d}) - \\mathbf{f}(\\mathbf{c})$, the $i$-th component is, by first-order Taylor expansion, approximately:\n$$ \\Delta f_i \\approx \\sum_{k=1}^l J_{ij_k} \\epsilon_{j_k} $$\nDue to the non-interference property of the color group, for any given row $i$, at most one term $J_{ij_k}$ in this summation can be non-zero. Thus, the sum collapses to a single term, $\\Delta f_i \\approx J_{ip} \\epsilon_p$, where $p$ is the unique column in the group for which $J_{ip}$ is non-zero. This allows us to recover the value $J_{ip} \\approx \\Delta f_i / \\epsilon_p$ without aliasing from other simultaneous perturbations.\n\nIf the interference graph can be colored with $q$ colors, the entire sparse Jacobian can be constructed with only $q$ evaluations of the source term function $\\mathbf{f}$ (plus one for the unperturbed state), one for each color group.\n\n### Part 3: Speedup Factor\n\nThe speedup factor $\\sigma$ is defined as:\n$$\n\\sigma = \\frac{m}{q}\n$$\n- $m$: The number of columns of $J$ that are not structurally zero. As stated in the problem and confirmed by the analysis in Part 1, this is equivalent to the number of species that act as a reactant in at least one reaction ($\\exists k \\text{ such that } \\alpha_{jk} > 0$). This represents the number of function evaluations required by a direct finite-difference approach that intelligently skips all-zero columns.\n- $q$: The number of colors used by a greedy largest-degree-first coloring heuristic for the column-interference graph. This is an approximation of the graph's chromatic number and represents the number of function evaluations needed by the sparse coloring-based approach.\n\nThe factor $\\sigma$ thus measures the computational savings of the graph coloring method over a more straightforward (but still sparse-aware) finite-difference scheme.\n\n### Part 4: Algorithm Implementation\n\nThe implementation proceeds as follows:\n1.  For each test case, the matrices $\\alpha$ and $S$ are constructed.\n2.  The Jacobian sparsity pattern, an $n_s \\times n_s$ boolean matrix, is determined using the condition from Part 1.\n3.  The value of $m$ is calculated by counting the number of species $j$ for which the $j$-th row of the $\\alpha$ matrix contains at least one positive entry.\n4.  The adjacency matrix of the $n_s$-vertex column-interference graph is built by checking for row-wise overlaps in the Jacobian sparsity pattern for every pair of columns.\n5.  The degrees of all vertices in the interference graph are computed.\n6.  A greedy largest-degree-first coloring algorithm is applied:\n    a. Vertices are sorted in descending order of their degree.\n    b. Iterating through the sorted vertices, each vertex is assigned the smallest integer color not used by any of its already-colored neighbors.\n7.  The number of colors used, $q$, is determined from the result of the coloring.\n8.  The speedup $\\sigma = m/q$ is computed and stored.\n9.  Finally, the list of speedup values for all test cases is formatted and printed.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function that processes all test cases and prints the results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: chain of bimolecular reactions\n        {\n            \"ns\": 7,\n            \"alpha_cols\": [\n                [1, 1, 0, 0, 0, 0, 0],\n                [0, 0, 1, 1, 0, 0, 0],\n                [0, 0, 0, 0, 1, 1, 0]\n            ],\n            \"S_cols\": [\n                [-1, -1, 1, 0, 0, 0, 0],\n                [0, 0, -1, -1, 1, 0, 0],\n                [0, 0, 0, 0, -1, -1, 1]\n            ]\n        },\n        # Case 2: tri-molecular and cross-coupled reactions\n        {\n            \"ns\": 7,\n            \"alpha_cols\": [\n                [1, 1, 1, 0, 0, 0, 0],\n                [1, 0, 0, 1, 1, 0, 0],\n                [0, 1, 0, 0, 0, 1, 1]\n            ],\n            \"S_cols\": [\n                [-1, -1, -1, 1, 0, 0, 0],\n                [-1, 0, 0, -1, -1, 1, 0],\n                [0, -1, 1, 0, 0, -1, -1]\n            ]\n        },\n        # Case 3: three parallel unimolecular reactions\n        {\n            \"ns\": 7,\n            \"alpha_cols\": [\n                [1, 0, 0, 0, 0, 0, 0],\n                [0, 0, 1, 0, 0, 0, 0],\n                [0, 0, 0, 0, 1, 0, 0]\n            ],\n            \"S_cols\": [\n                [-1, 1, 0, 0, 0, 0, 0],\n                [0, 0, -1, 1, 0, 0, 0],\n                [0, 0, 0, 0, -1, 1, 0]\n            ]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        ns = case[\"ns\"]\n        # The problem provides data as columns of the matrices alpha and S.\n        # We transpose them to get ns x nr matrices.\n        alpha = np.array(case[\"alpha_cols\"]).T\n        S = np.array(case[\"S_cols\"]).T\n        \n        result = calculate_speedup(ns, alpha, S)\n        results.append(f\"{result:.3f}\")\n\n    print(f\"[{','.join(results)}]\")\n\ndef calculate_speedup(ns, alpha, S):\n    \"\"\"\n    Calculates the speedup factor sigma for a single reaction mechanism.\n    \n    Args:\n        ns (int): Number of species.\n        alpha (np.ndarray): Reactant exponent matrix (ns x nr).\n        S (np.ndarray): Stoichiometric matrix (ns x nr).\n        \n    Returns:\n        float: The computed speedup factor sigma.\n    \"\"\"\n    if ns == 0:\n        return 0.0\n        \n    nr = S.shape[1]\n\n    # Part 1: Build Jacobian sparsity pattern based on derived condition\n    J_sparsity = np.zeros((ns, ns), dtype=bool)\n    for i in range(ns):\n        for j in range(ns):\n            # Condition: exists k s.t. S[i,k] != 0 AND alpha[j,k] > 0\n            for k in range(nr):\n                if S[i, k] != 0 and alpha[j, k] > 0:\n                    J_sparsity[i, j] = True\n                    break # Break inner loop once non-zero entry is confirmed\n\n    # Part 3: Compute m\n    # m is the number of species j that are reactants in at least one reaction\n    m = np.sum(np.any(alpha > 0, axis=1))\n\n    if m == 0:\n        return 0.0\n\n    # Part 2: Build the column-interference graph\n    adj_matrix = np.zeros((ns, ns), dtype=bool)\n    for p in range(ns):\n        for q in range(p + 1, ns):\n            # An edge (p,q) exists if columns p and q share a non-zero row\n            if np.any(np.logical_and(J_sparsity[:, p], J_sparsity[:, q])):\n                adj_matrix[p, q] = True\n                adj_matrix[q, p] = True\n\n    # Part 3/4: Greedy largest-degree-first coloring to find q\n    degrees = np.sum(adj_matrix, axis=1)\n    # Sort all ns vertices by degree, descending\n    sorted_vertices = np.argsort(degrees)[::-1]\n\n    colors = -np.ones(ns, dtype=int)\n    max_color = -1\n    \n    for u in sorted_vertices:\n        neighbor_colors = set()\n        # Find neighbors of u that are already colored\n        for v in range(ns):\n            if adj_matrix[u, v] and colors[v] != -1:\n                neighbor_colors.add(colors[v])\n        \n        # Find the smallest non-negative integer color not in neighbor_colors\n        c = 0\n        while c in neighbor_colors:\n            c += 1\n        colors[u] = c\n        if c > max_color:\n            max_color = c\n            \n    # The number of colors used is max_color + 1\n    q = max_color + 1\n\n    # Final calculation of speedup sigma\n    sigma = m / q\n    return sigma\n\nsolve()\n```", "id": "3356523"}]}