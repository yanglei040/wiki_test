{"hands_on_practices": [{"introduction": "Before building a surrogate model, it is crucial to understand its size and complexity, as the number of terms in a Polynomial Chaos Expansion (PCE) can grow rapidly with the number of uncertain variables and the chosen polynomial degree. This exercise provides a fundamental calculation of the PCE basis size for a standard total-degree truncation scheme. Mastering this combinatorial problem is the first step in appreciating the \"curse of dimensionality\" and understanding the motivation behind more advanced techniques like sparse grids and tensor-train decompositions. [@problem_id:3348379]", "problem": "Consider a non-intrusive uncertainty quantification (UQ) strategy for a Computational Fluid Dynamics (CFD) simulation of a compressible viscous flow over a lifting surface. The scalar quantity of interest is the drag coefficient, denoted $C_{D}$, which depends on $d$ independent, standardized uncertain inputs $\\boldsymbol{\\xi}=(\\xi_{1},\\dots,\\xi_{d})$. To build a surrogate for $C_{D}(\\boldsymbol{\\xi})$, you adopt a Polynomial Chaos Expansion (PCE) with a total-degree truncation at order $p$, and determine the expansion coefficients using Stochastic Collocation (SC) with a design that yields an exactly determined linear system (i.e., the number of independent CFD samples equals the number of basis functions in the truncated PCE).\n\nStarting from the definition of the total-degree multi-index set\n$$\n\\mathcal{A}=\\left\\{\\boldsymbol{\\alpha}\\in\\mathbb{N}_{0}^{d}:\\ |\\boldsymbol{\\alpha}|_{1}=\\sum_{i=1}^{d}\\alpha_{i}\\le p\\right\\},\n$$\nderive, from first principles of combinatorial counting, an explicit closed-form expression for the cardinality $\\lvert\\mathcal{A}\\rvert$ in terms of $d$ and $p$. Then, for the CFD design with $d=6$ uncertain inputs and total-degree $p=3$, compute the minimal number of non-intrusive CFD samples required to construct the exactly determined SC system. Express your final answer as an exact integer with no units.", "solution": "The problem is deemed valid as it is scientifically grounded, well-posed, objective, and contains all necessary information for a unique solution. The question addresses a standard and fundamental concept in the theory of Polynomial Chaos Expansions (PCE) for uncertainty quantification.\n\nThe problem is divided into two parts. First, we must derive a closed-form expression for the cardinality of the total-degree multi-index set $\\mathcal{A}$. Second, we must apply this formula to a specific case.\n\nThe total-degree multi-index set for a PCE of total degree $p$ in $d$ variables is defined as:\n$$\n\\mathcal{A}=\\left\\{\\boldsymbol{\\alpha}\\in\\mathbb{N}_{0}^{d}:\\ |\\boldsymbol{\\alpha}|_{1}=\\sum_{i=1}^{d}\\alpha_{i}\\le p\\right\\}\n$$\nwhere $\\boldsymbol{\\alpha} = (\\alpha_1, \\alpha_2, \\dots, \\alpha_d)$ is a multi-index of non-negative integers. The cardinality of this set, $|\\mathcal{A}|$, corresponds to the number of basis functions in the truncated PCE. We are tasked with finding a formula for $|\\mathcal{A}|$ in terms of $d$ and $p$.\n\nThis is a problem of combinatorial counting. We need to find the number of non-negative integer solutions $(\\alpha_1, \\alpha_2, \\dots, \\alpha_d)$ to the inequality:\n$$\n\\alpha_{1} + \\alpha_{2} + \\dots + \\alpha_{d} \\le p\n$$\nTo transform this inequality into an equality, which is more amenable to standard counting techniques, we introduce a non-negative integer \"slack\" variable, $\\alpha_{d+1} \\ge 0$. The inequality can be rewritten as the equation:\n$$\n\\alpha_{1} + \\alpha_{2} + \\dots + \\alpha_{d} + \\alpha_{d+1} = p\n$$\nwhere $\\alpha_i \\in \\mathbb{N}_0$ for $i=1, \\dots, d+1$. For any solution to the original inequality where the sum is less than $p$, say $\\sum_{i=1}^{d}\\alpha_{i} = k < p$, we can uniquely define $\\alpha_{d+1} = p-k > 0$. If the sum is exactly $p$, we have $\\alpha_{d+1} = 0$. This establishes a one-to-one correspondence between the set of solutions to the inequality and the set of non-negative integer solutions to the new equation.\n\nThe problem is now reduced to finding the number of ways to write the integer $p$ as a sum of $d+1$ non-negative integers. This is a classic combinatorial problem that can be solved using the \"stars and bars\" method. We can imagine having $p$ identical items (the \"stars\", representing the units of the sum) to be distributed into $d+1$ distinct bins (representing the variables $\\alpha_1, \\dots, \\alpha_{d+1}$). To separate the contents of the $d+1$ bins, we need $(d+1)-1 = d$ dividers (the \"bars\").\n\nThe total number of solutions is therefore equivalent to the number of ways to arrange a sequence of $p$ stars and $d$ bars. The total number of positions in this sequence is $p+d$. The number of arrangements is determined by choosing the positions for the $d$ bars from the total of $p+d$ available positions. The remaining $p$ positions will be filled by the stars. The number of ways to do this is given by the binomial coefficient:\n$$\n|\\mathcal{A}| = \\binom{p+d}{d}\n$$\nEquivalently, one could choose the positions for the $p$ stars, which gives the same result:\n$$\n|\\mathcal{A}| = \\binom{p+d}{p}\n$$\nSince $\\binom{n}{k} = \\binom{n}{n-k}$, we have $\\binom{p+d}{d} = \\binom{p+d}{(p+d)-d} = \\binom{p+d}{p}$. This is the explicit closed-form expression for the cardinality of the total-degree multi-index set.\n\nFor the second part of the problem, we are given a specific scenario with $d=6$ uncertain inputs and a total-degree PCE of order $p=3$. The problem states that the Stochastic Collocation (SC) scheme is designed to yield an exactly determined system. This means the number of required CFD samples is equal to the number of unknown PCE coefficients, which is precisely the number of basis functions, $|\\mathcal{A}|$.\n\nWe use the derived formula with $d=6$ and $p=3$:\n$$\n|\\mathcal{A}| = \\binom{p+d}{d} = \\binom{3+6}{6} = \\binom{9}{6}\n$$\nTo compute the value of this binomial coefficient, we can use the identity $\\binom{n}{k} = \\binom{n}{n-k}$:\n$$\n\\binom{9}{6} = \\binom{9}{9-6} = \\binom{9}{3}\n$$\nNow, we expand the binomial coefficient:\n$$\n\\binom{9}{3} = \\frac{9!}{3!(9-3)!} = \\frac{9!}{3!6!} = \\frac{9 \\times 8 \\times 7 \\times 6!}{ (3 \\times 2 \\times 1) \\times 6!}\n$$\nCanceling the $6!$ term, we are left with:\n$$\n\\binom{9}{3} = \\frac{9 \\times 8 \\times 7}{3 \\times 2 \\times 1} = \\frac{504}{6}\n$$\nPerforming the division:\n$$\n\\binom{9}{3} = 84\n$$\nThus, the minimal number of non-intrusive CFD samples required to construct the exactly determined SC system is $84$.", "answer": "$$\n\\boxed{84}\n$$", "id": "3348379"}, {"introduction": "A key benefit of constructing a PCE surrogate is the ability to perform post-processing tasks, such as global sensitivity analysis, at virtually no additional computational cost. Sobol' indices, which quantify the contribution of each input variable to the output variance, can be derived directly from the PCE coefficients. This practice guides you through the analytical relationship between PCE coefficients and Sobol' indices and critically examines how the practical necessity of truncating the expansion introduces a quantifiable bias in the sensitivity estimates. [@problem_id:3348380]", "problem": "Consider a non-intrusive stochastic collocation approximation built for a two-parameter Computational Fluid Dynamics (CFD) model with independent uncertain inputs. Let the quantity of interest be denoted by $Q(x_{1},x_{2})$, where $x_{1}$ and $x_{2}$ are independent and identically distributed random variables, each uniform on $[-1,1]$. Using tensor-product Gauss–Legendre nodes, a generalized Polynomial Chaos (gPC) surrogate has been constructed in the tensor-product orthonormal Legendre basis on $[-1,1]$, i.e., $\\Psi_{i,j}(x_{1},x_{2}) = L_{i}(x_{1})L_{j}(x_{2})$ with $L_{0}(x)=1$ and $L_{n}(x)$ the degree-$n$ Legendre polynomial normalized so that $\\int_{-1}^{1}L_{n}(x)L_{m}(x)\\,\\frac{1}{2}\\,dx = \\delta_{nm}$ for all $n,m \\geq 0$. The expansion of $Q$ in this orthonormal basis is\n$$\nQ(x_{1},x_{2}) = \\sum_{i=0}^{\\infty}\\sum_{j=0}^{\\infty} a_{i,j}\\,\\Psi_{i,j}(x_{1},x_{2}),\n$$\nwith real coefficients $\\{a_{i,j}\\}$. Denote by $S_{1}$ the first-order Sobol index of $x_{1}$, defined from first principles via variance decomposition as $S_{1} = \\frac{\\mathrm{Var}\\big(\\mathbb{E}[Q\\mid x_{1}]\\big)}{\\mathrm{Var}(Q)}$.\n\nA truncated collocation-based surrogate is used in practice to estimate $S_{1}$ without additional CFD evaluations. Specifically, consider the truncation that retains only basis functions with total polynomial degree at most $2$, i.e., all $\\Psi_{i,j}$ such that $i+j \\leq 2$. Let $\\widehat{S}_{1}$ be the estimator of $S_{1}$ obtained from this truncated surrogate.\n\nStarting strictly from the definitions of variance and conditional expectation together with the orthonormality of the basis, derive an estimator for $S_{1}$ that uses only the surrogate coefficients and requires no additional CFD model evaluations. Then, analyze the bias introduced by the truncation by deriving a closed-form analytic expression for $\\widehat{S}_{1} - S_{1}$ in terms of the included and omitted expansion coefficients under the total-degree $\\leq 2$ truncation. Finally, evaluate the bias for the following scientifically consistent gPC coefficient set (units are omitted because the Sobol index is dimensionless):\n$$\na_{0,0}=2,\\quad a_{1,0}=0.7,\\quad a_{2,0}=-0.2,\\quad a_{3,0}=0.15,\\quad a_{0,1}=0.5,\\quad a_{0,2}=0.3,\\quad a_{0,3}=-0.25,\\quad a_{1,1}=0.4,\\quad a_{2,1}=-0.1,\\quad a_{2,2}=0.05,\n$$\nwith all other $a_{i,j}$ equal to zero. Express the final bias $\\widehat{S}_{1} - S_{1}$ as a single exact number. No rounding is required and no unit should be included in the final answer.", "solution": "The problem requires the derivation of an estimator for the first-order Sobol index, $S_{1}$, from a generalized Polynomial Chaos (gPC) expansion, and an analysis of the bias introduced by a specific truncation of this expansion.\n\nFirst, we establish the mathematical framework. The uncertain inputs $x_{1}$ and $x_{2}$ are independent and identically distributed uniform random variables on the interval $[-1, 1]$. The probability density function is $p(x) = \\frac{1}{2}$ for $x \\in [-1, 1]$. The expectation of a function $g(x_{1}, x_{2})$ is $\\mathbb{E}[g] = \\int_{-1}^{1}\\int_{-1}^{1} g(x_{1}, x_{2}) \\frac{1}{2}dx_{1} \\frac{1}{2}dx_{2}$.\nThe gPC basis functions are $\\Psi_{i,j}(x_{1},x_{2}) = L_{i}(x_{1})L_{j}(x_{2})$, where $L_{n}(x)$ are Legendre polynomials normalized to be orthonormal with respect to the weight function $p(x) = \\frac{1}{2}$. This orthonormality is formally expressed as:\n$$\n\\mathbb{E}[L_{n}(x)L_{m}(x)] = \\int_{-1}^{1} L_{n}(x)L_{m}(x) \\frac{1}{2}dx = \\delta_{nm}\n$$\nwhere $\\delta_{nm}$ is the Kronecker delta. Since $x_{1}$ and $x_{2}$ are independent, the tensor-product basis functions are also orthonormal:\n$$\n\\mathbb{E}[\\Psi_{i,j}\\Psi_{k,l}] = \\mathbb{E}[L_{i}(x_{1})L_{k}(x_{1})] \\mathbb{E}[L_{j}(x_{2})L_{l}(x_{2})] = \\delta_{ik}\\delta_{jl}\n$$\nThe quantity of interest $Q(x_{1},x_{2})$ has the expansion $Q = \\sum_{i=0}^{\\infty}\\sum_{j=0}^{\\infty} a_{i,j}\\Psi_{i,j}$. The coefficients are given by $a_{i,j} = \\mathbb{E}[Q\\Psi_{i,j}]$.\n\nA crucial property derived from orthonormality is $\\mathbb{E}[L_{i}(x)] = \\mathbb{E}[L_{i}(x)L_{0}(x)] = \\delta_{i0}$, since $L_{0}(x)=1$ is given.\n\nThe mean of $Q$ is:\n$$\n\\mathbb{E}[Q] = \\mathbb{E}\\left[\\sum_{i,j} a_{i,j}\\Psi_{i,j}\\right] = \\sum_{i,j} a_{i,j}\\mathbb{E}[L_{i}(x_{1})]\\mathbb{E}[L_{j}(x_{2})] = \\sum_{i,j} a_{i,j}\\delta_{i0}\\delta_{j0} = a_{0,0}\n$$\nThe variance of $Q$ is $\\mathrm{Var}(Q) = \\mathbb{E}[Q^2] - (\\mathbb{E}[Q])^{2}$. We compute $\\mathbb{E}[Q^2]$:\n$$\n\\mathbb{E}[Q^2] = \\mathbb{E}\\left[\\left(\\sum_{i,j} a_{i,j}\\Psi_{i,j}\\right)\\left(\\sum_{k,l} a_{k,l}\\Psi_{k,l}\\right)\\right] = \\sum_{i,j,k,l} a_{i,j}a_{k,l}\\mathbb{E}[\\Psi_{i,j}\\Psi_{k,l}] = \\sum_{i,j,k,l} a_{i,j}a_{k,l}\\delta_{ik}\\delta_{jl} = \\sum_{i,j} a_{i,j}^2\n$$\nThus, the total variance is:\n$$\n\\mathrm{Var}(Q) = \\sum_{i,j} a_{i,j}^2 - a_{0,0}^2 = \\sum_{i,j \\neq (0,0)} a_{i,j}^2\n$$\n\nNext, we compute the components of the Sobol index $S_{1} = \\frac{\\mathrm{Var}(\\mathbb{E}[Q\\mid x_{1}])}{\\mathrm{Var}(Q)}$. We need the conditional expectation $\\mathbb{E}[Q\\mid x_{1}]$, which involves integrating out $x_{2}$:\n$$\n\\mathbb{E}[Q\\mid x_{1}] = \\mathbb{E}_{x_{2}}[Q(x_{1},x_{2})] = \\int_{-1}^{1} \\sum_{i,j} a_{i,j}L_{i}(x_{1})L_{j}(x_{2}) \\frac{1}{2}dx_{2}\n$$\n$$\n\\mathbb{E}[Q\\mid x_{1}] = \\sum_{i,j} a_{i,j}L_{i}(x_{1}) \\int_{-1}^{1} L_{j}(x_{2}) \\frac{1}{2}dx_{2} = \\sum_{i,j} a_{i,j}L_{i}(x_{1})\\mathbb{E}[L_{j}(x_{2})] = \\sum_{i,j} a_{i,j}L_{i}(x_{1})\\delta_{j0}\n$$\n$$\n\\mathbb{E}[Q\\mid x_{1}] = \\sum_{i=0}^{\\infty} a_{i,0}L_{i}(x_{1})\n$$\nThe variance of this conditional expectation, $\\mathrm{Var}(\\mathbb{E}[Q\\mid x_{1}])$, is computed with respect to $x_{1}$. Following the same logic as for $\\mathrm{Var}(Q)$, we find:\n$$\n\\mathrm{Var}(\\mathbb{E}[Q\\mid x_{1}]) = \\sum_{i=1}^{\\infty} a_{i,0}^2\n$$\nCombining these results, the exact first-order Sobol index for $x_{1}$ is:\n$$\nS_{1} = \\frac{\\sum_{i=1}^{\\infty} a_{i,0}^2}{\\sum_{i,j \\neq (0,0)} a_{i,j}^2}\n$$\nThis formula provides a way to calculate $S_{1}$ directly from the gPC coefficients.\n\nThe problem defines a truncated surrogate $\\widehat{Q}$ that retains only basis functions with total polynomial degree at most $2$, i.e., $i+j \\le 2$. The estimator $\\widehat{S}_{1}$ is the Sobol index computed for this surrogate model.\n$$\n\\widehat{Q}(x_{1},x_{2}) = \\sum_{i+j \\leq 2} a_{i,j}\\,\\Psi_{i,j}(x_{1},x_{2})\n$$\nApplying the derived formula for the Sobol index to the coefficients of $\\widehat{Q}$ (where coefficients for $i+j>2$ are treated as zero) yields the estimator $\\widehat{S}_{1}$. This estimator, which uses only the surrogate coefficients, is the answer to the first task.\nThe numerator is the variance of the main effect of $x_{1}$ within the surrogate:\n$$\n\\mathrm{Var}(\\mathbb{E}[\\widehat{Q}\\mid x_{1}]) = \\sum_{i=1, i+0\\leq 2} a_{i,0}^2 = a_{1,0}^2 + a_{2,0}^2\n$$\nThe denominator is the total variance of the surrogate:\n$$\n\\mathrm{Var}(\\widehat{Q}) = \\sum_{0 < i+j \\leq 2} a_{i,j}^2 = a_{1,0}^2+a_{0,1}^2+a_{2,0}^2+a_{1,1}^2+a_{0,2}^2\n$$\nSo, the estimator is:\n$$\n\\widehat{S}_{1} = \\frac{a_{1,0}^2 + a_{2,0}^2}{a_{1,0}^2 + a_{0,1}^2 + a_{2,0}^2 + a_{1,1}^2 + a_{0,2}^2}\n$$\nThe bias introduced by the truncation is $\\widehat{S}_{1} - S_{1}$. The expression for $S_{1}$ must use all given non-zero coefficients, as they define the \"true\" model in this context. The set of non-zero coefficients define the full model $Q$. The bias is then the difference between the estimate from the truncated model and the true value from the full model. This provides the closed-form expression for the bias in terms of the coefficients, addressing the second task.\n\nFinally, we evaluate this bias for the given set of coefficients.\nThe non-zero coefficients are:\n$a_{0,0}=2$, $a_{1,0}=0.7$, $a_{2,0}=-0.2$, $a_{3,0}=0.15$, $a_{0,1}=0.5$, $a_{0,2}=0.3$, $a_{0,3}=-0.25$, $a_{1,1}=0.4$, $a_{2,1}=-0.1$, $a_{2,2}=0.05$.\n\nFirst, we calculate the components for the estimator $\\widehat{S}_{1}$, using coefficients where $i+j \\leq 2$:\nNumerator of $\\widehat{S}_{1}$: $a_{1,0}^2 + a_{2,0}^2 = (0.7)^2 + (-0.2)^2 = 0.49 + 0.04 = 0.53$.\nDenominator of $\\widehat{S}_{1}$: $a_{1,0}^2+a_{2,0}^2+a_{0,1}^2+a_{0,2}^2+a_{1,1}^2 = (0.7)^2+(-0.2)^2+(0.5)^2+(0.3)^2+(0.4)^2 = 0.49+0.04+0.25+0.09+0.16 = 1.03$.\nSo, $\\widehat{S}_{1} = \\frac{0.53}{1.03} = \\frac{53}{103}$.\n\nNext, we calculate the components for the true value $S_{1}$, using all non-zero coefficients:\nNumerator of $S_{1}$: $\\sum_{i=1}^{\\infty} a_{i,0}^2 = a_{1,0}^2+a_{2,0}^2+a_{3,0}^2 = (0.7)^2+(-0.2)^2+(0.15)^2 = 0.49+0.04+0.0225 = 0.5525$.\nDenominator of $S_{1}$: $\\sum_{i,j \\neq (0,0)} a_{i,j}^2 = (a_{1,0}^2+a_{2,0}^2+a_{0,1}^2+a_{0,2}^2+a_{1,1}^2) + (a_{3,0}^2+a_{0,3}^2+a_{2,1}^2+a_{2,2}^2)$.\nThis is the sum of squares of all non-zero coefficients except $a_{0,0}$.\nDenominator $= 1.03 + ((0.15)^2 + (-0.25)^2 + (-0.1)^2 + (0.05)^2) = 1.03 + (0.0225 + 0.0625 + 0.01 + 0.0025) = 1.03 + 0.0975 = 1.1275$.\nSo, $S_{1} = \\frac{0.5525}{1.1275} = \\frac{5525}{11275} = \\frac{221}{451}$.\n\nThe bias is $\\widehat{S}_{1} - S_{1}$:\n$$\n\\text{Bias} = \\frac{53}{103} - \\frac{221}{451}\n$$\nTo compute this as a single exact number, we find a common denominator, which is $103 \\times 451 = 46453$.\n$$\n\\text{Bias} = \\frac{53 \\times 451 - 221 \\times 103}{46453} = \\frac{23903 - 22763}{46453} = \\frac{1140}{46453}\n$$\nThe prime factorization of the numerator is $1140 = 2^2 \\times 3 \\times 5 \\times 19$. The prime factors of the denominator are $103$, $11$, and $41$ (since $451 = 11 \\times 41$). As there are no common factors, the fraction is irreducible.", "answer": "$$\\boxed{\\frac{1140}{46453}}$$", "id": "3348380"}, {"introduction": "We now move from foundational derivations to a complete computational workflow, simulating a task common for engineers and scientists applying uncertainty quantification. This problem involves analyzing a realistic, albeit simplified, model for a turbulent mixing layer with multiple uncertain physical parameters. This comprehensive coding exercise integrates several core concepts: building a sparse collocation grid to efficiently sample the parameter space, using least-squares regression to fit a PCE surrogate, and calculating Sobol' indices to assess parameter importance. [@problem_id:3348319]", "problem": "You are given a three-parameter model of a planar turbulent mixing layer whose scalar quantity of interest is defined by a deterministic mapping from three independent random inputs that represent uncertain physical parameters. The goal is to estimate the first-order Sobol' indices using a sparse Polynomial Chaos Expansion (PCE) constructed by non-intrusive sampling via stochastic collocation on nested sparse grids and to assess convergence of the indices when the PCE index set is increased from total degree $1$ to total degree $3$. All random variables are dimensionless, and all outputs you report must be dimensionless real numbers.\n\nThe model is defined as follows. Let the independent standard random variables be $\\boldsymbol{\\xi} = (\\xi_1,\\xi_2,\\xi_3)$ with each $\\xi_i$ uniformly distributed on $[-1,1]$. These are mapped to the physical parameters $(a,b,c)$ by an affine transformation that reflects plausible ranges found in turbulent shear-layer studies:\n$$\na = \\frac{a_{\\min}+a_{\\max}}{2} + \\frac{a_{\\max}-a_{\\min}}{2}\\,\\xi_1,\\quad a_{\\min} = 0.2,\\ a_{\\max} = 0.6,\n$$\n$$\nb = \\frac{b_{\\min}+b_{\\max}}{2} + \\frac{b_{\\max}-b_{\\min}}{2}\\,\\xi_2,\\quad b_{\\min} = 0.5,\\ b_{\\max} = 2.0,\n$$\n$$\nc = \\frac{c_{\\min}+c_{\\max}}{2} + \\frac{c_{\\max}-c_{\\min}}{2}\\,\\xi_3,\\quad c_{\\min} = 0.0,\\ c_{\\max} = 1.0.\n$$\nHere $a$ is a dimensionless eddy-viscosity coefficient, $b$ is a dimensionless initial momentum thickness, and $c$ is the dimensionless convective Mach number. The scalar quantity of interest $Q$ is a dimensionless surrogate of downstream integrated growth that captures compressibility suppression, eddy-viscosity amplification, and thickness scaling:\n$$\nQ(a,b,c) = \\sqrt{b}\\,\\frac{1 - 0.35\\,c^2}{1 + 0.2\\,c}\\,\\Big(0.8 + 0.5\\,a + 0.1\\,a^2\\Big)\\ +\\ 0.05\\,a\\,b\\,c\\ +\\ 0.02\\,b^2.\n$$\n\nYou must estimate the first-order Sobol' indices for $(\\xi_1,\\xi_2,\\xi_3)$ using a sparse Polynomial Chaos Expansion (PCE) of $Q$ with a multivariate basis formed by products of univariate Legendre polynomials that are orthonormal under the uniform distribution on $[-1,1]$. Specifically, use univariate basis functions $\\phi_n(x) = \\sqrt{2n+1}\\,P_n(x)$, where $P_n(x)$ is the $n$th Legendre polynomial, and form multivariate basis functions by tensor products $\\Phi_{\\boldsymbol{\\alpha}}(\\boldsymbol{\\xi}) = \\prod_{i=1}^3 \\phi_{\\alpha_i}(\\xi_i)$ for multi-indices $\\boldsymbol{\\alpha} \\in \\mathbb{N}_0^3$. Construct sparse PCEs using index sets of increasing total degree $p \\in \\{1,2,3\\}$, where the index set for degree $p$ is $\\mathcal{A}_p = \\{\\boldsymbol{\\alpha} \\in \\mathbb{N}_0^3:\\ \\alpha_1+\\alpha_2+\\alpha_3 \\le p\\}$.\n\nTo determine the expansion coefficients non-intrusively, perform stochastic collocation by evaluating $Q$ at nodes from a three-dimensional nested Clenshaw–Curtis sparse grid built via the Smolyak construction. For dimension $d=3$ and sparse-grid level $L$, use all multi-index level triples $(\\ell_1,\\ell_2,\\ell_3)$ with $\\ell_i \\in \\mathbb{N}$ and $\\ell_1+\\ell_2+\\ell_3 \\le L + d - 1$, and for each $\\ell_i$ use the nested one-dimensional Clenshaw–Curtis rule with $N(\\ell_i) = 2^{\\ell_i} + 1$ points $x_k = \\cos\\left(\\frac{\\pi k}{N(\\ell_i)-1}\\right)$ for $k=0,1,\\dots,N(\\ell_i)-1$. Take the union of all tensor-product node sets to obtain the sparse-grid collocation nodes. Use linear least-squares regression to estimate the PCE coefficients from the collocation data for each index set $\\mathcal{A}_p$.\n\nFrom the fitted PCE coefficients for each $\\mathcal{A}_p$, compute the first-order Sobol' index $S_i^{(p)}$ for each input $\\xi_i$ by isolating the contribution of basis terms that depend only on $\\xi_i$ and no other variables, and normalize by the total variance implied by the PCE. You must then assess convergence by comparing the indices across the increasing index sets: compute\n$$\n\\Delta_{1\\to 2}(L) = \\max_{i \\in \\{1,2,3\\}} \\left|\\, S_i^{(2)}(L) - S_i^{(1)}(L)\\,\\right|,\\quad\n\\Delta_{2\\to 3}(L) = \\max_{i \\in \\{1,2,3\\}} \\left|\\, S_i^{(3)}(L) - S_i^{(2)}(L)\\,\\right|.\n$$\nHere the dependence on $L$ indicates that the PCE coefficients are estimated using collocation data from the sparse grid with level $L$.\n\nYour program must implement the above procedure and produce the convergence metrics for the following test suite of sparse-grid levels:\n- Test case $1$: $L=3$ (minimal level expected to be near the threshold for stable regression at total degree $3$),\n- Test case $2$: $L=4$ (moderate refinement),\n- Test case $3$: $L=5$ (higher refinement).\n\nAll computed outputs are dimensionless real numbers. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to a test case and is itself a list of the two floats $[\\Delta_{1\\to 2}(L), \\Delta_{2\\to 3}(L)]$ rounded to $6$ decimal places. For example, your output must have the form $[[x_{1},y_{1}],[x_{2},y_{2}],[x_{3},y_{3}]]$ where $x_{k}$ and $y_{k}$ are the rounded convergence metrics for the $k$th test case.\n\nDerivations and implementation must start from the following fundamental bases: the definition of independence for random variables, orthogonality and orthonormality of Legendre polynomials under the uniform measure on $[-1,1]$, the definition of Polynomial Chaos Expansion (PCE) as an $L^2$ expansion in an orthonormal basis, and the definition of first-order Sobol' indices as variance-normalized contributions from terms that depend on a single variable. Do not use any shortcut formulas beyond those derivable from these bases; derive and implement any needed steps explicitly from first principles. No physical units are required in the output because all quantities are dimensionless.", "solution": "The problem requires the estimation of first-order Sobol' indices for a three-parameter model using Polynomial Chaos Expansions (PCE) of increasing total degree. The PCE coefficients are to be computed non-intrusively via stochastic collocation on sparse grids. The convergence of the Sobol' indices is then assessed as the PCE is refined.\n\n### Step 1: Theoretical Framework\n\n**1.1. Uncertainty Propagation and Polynomial Chaos Expansion (PCE)**\nThe problem involves a model $Q = \\mathcal{M}(\\boldsymbol{\\xi})$ where the input parameters $\\boldsymbol{\\xi} = (\\xi_1, \\xi_2, \\xi_3)$ are independent random variables, each uniformly distributed on $[-1, 1]$. The goal is to analyze the propagation of uncertainty from $\\boldsymbol{\\xi}$ to the output $Q$. PCE is a spectral method that represents the model output as an expansion in a basis of polynomials that are orthogonal with respect to the probability measure of the inputs.\n\nFor independent inputs $\\xi_i \\sim U[-1,1]$, the appropriate orthogonal polynomials are the Legendre polynomials, $P_n(x)$. The univariate basis functions must be orthonormal. The inner product for functions of $\\xi_i$ is $\\langle f, g \\rangle = \\int_{-1}^{1} f(x)g(x) \\frac{1}{2} dx$. The Legendre polynomials satisfy the orthogonality condition $\\int_{-1}^{1} P_m(x) P_n(x) dx = \\frac{2}{2n+1} \\delta_{mn}$. To create an orthonormal basis, we define $\\phi_n(x) = \\sqrt{\\frac{2n+1}{2}} P_n(x)$. The problem specifies using the standard unweighted inner product, implying a probability density function of $1$ on $[-1,1]$, which is incorrect for a uniform distribution on this interval. However, it also defines the orthonormal basis as $\\phi_n(x) = \\sqrt{2n+1} P_n(x)$, which corresponds to the unweighted inner product $\\int_{-1}^{1} f(x)g(x) dx$. This is a common convention in PCE literature where the density function is absorbed into the measure, so we will proceed with the basis as defined: $\\phi_n(x) = \\sqrt{2n+1} P_n(x)$, orthonormal with respect to the standard Lebesgue measure on $[-1,1]$.\n\nThe multivariate orthonormal basis is formed by tensor products: $\\Phi_{\\boldsymbol{\\alpha}}(\\boldsymbol{\\xi}) = \\prod_{i=1}^{3} \\phi_{\\alpha_i}(\\xi_i)$, where $\\boldsymbol{\\alpha} = (\\alpha_1, \\alpha_2, \\alpha_3)$ is a multi-index of non-negative integers. The PCE of the model output $Q$ is then:\n$$\nQ(\\boldsymbol{\\xi}) = \\sum_{\\boldsymbol{\\alpha} \\in \\mathbb{N}_0^3} c_{\\boldsymbol{\\alpha}} \\Phi_{\\boldsymbol{\\alpha}}(\\boldsymbol{\\xi})\n$$\nwhere $c_{\\boldsymbol{\\alpha}} = \\mathbb{E}[Q(\\boldsymbol{\\xi}) \\Phi_{\\boldsymbol{\\alpha}}(\\boldsymbol{\\xi})]$ due to the orthonormality of the basis. For practical computation, the expansion is truncated to a finite set of multi-indices $\\mathcal{A}$. The problem specifies using total-degree index sets: $\\mathcal{A}_p = \\{\\boldsymbol{\\alpha} \\in \\mathbb{N}_0^3 \\mid \\sum_{i=1}^3 \\alpha_i \\le p\\}$ for $p=1, 2, 3$. The truncated PCE is $Q_p(\\boldsymbol{\\xi}) = \\sum_{\\boldsymbol{\\alpha} \\in \\mathcal{A}_p} c_{\\boldsymbol{\\alpha}} \\Phi_{\\boldsymbol{\\alpha}}(\\boldsymbol{\\xi})$.\n\n**1.2. Non-Intrusive Stochastic Collocation**\nThe coefficients $c_{\\boldsymbol{\\alpha}}$ can be computed without modifying the model code ($\\mathcal{M}$) by evaluating it at a set of chosen points (collocation nodes) and solving a resulting system of equations. The problem specifies using a sparse grid for this purpose.\n\nA sparse grid is a specific choice of points in a multi-dimensional space that allows for accurate high-dimensional integration and interpolation with significantly fewer points than a full tensor-product grid. The problem defines a specific construction: for a given level $L$ and dimension $d=3$, the set of contributing tensor-product grids is indexed by multi-indices $\\boldsymbol{\\ell} = (\\ell_1, \\ell_2, \\ell_3)$ such that $\\ell_i \\in \\mathbb{N}$ and $\\sum_{i=1}^3 \\ell_i \\le L + d - 1$. The one-dimensional node set for each level $\\ell_i$ is the Clenshaw-Curtis rule with $N(\\ell_i) = 2^{\\ell_i} + 1$ points, given by $X_{\\ell_i} = \\{x_k = \\cos(\\frac{\\pi k}{2^{\\ell_i}}) \\mid k = 0, \\dots, 2^{\\ell_i}\\}$. The final set of collocation nodes $\\boldsymbol{\\Xi}_L$ is the union of all points from these tensor-product grids:\n$$\n\\boldsymbol{\\Xi}_L = \\bigcup_{\\substack{\\boldsymbol{\\ell} \\in \\mathbb{N}^3 \\\\ |\\boldsymbol{\\ell}|_1 \\le L+2}} \\left( X_{\\ell_1} \\times X_{\\ell_2} \\times X_{\\ell_3} \\right)\n$$\nwhere duplicates are removed.\n\n**1.3. Coefficient Estimation by Least-Squares Regression**\nGiven the set of $N_{pts}$ collocation nodes $\\{\\boldsymbol{\\xi}^{(j)}\\}_{j=1}^{N_{pts}}$ and the corresponding model evaluations $\\{Q^{(j)} = \\mathcal{M}(\\boldsymbol{\\xi}^{(j)})\\}_{j=1}^{N_{pts}}$, we enforce the PCE approximation at these points:\n$$\nQ^{(j)} \\approx \\sum_{\\boldsymbol{\\alpha} \\in \\mathcal{A}_p} c_{\\boldsymbol{\\alpha}} \\Phi_{\\boldsymbol{\\alpha}}(\\boldsymbol{\\xi}^{(j)})\n$$\nThis forms a linear system $\\mathbf{\\Psi} \\mathbf{c} = \\mathbf{Q}$, where $\\mathbf{\\Psi}$ is the Vandermonde-like matrix of basis function evaluations with entries $\\Psi_{j,\\boldsymbol{\\alpha}} = \\Phi_{\\boldsymbol{\\alpha}}(\\boldsymbol{\\xi}^{(j)})$, $\\mathbf{c}$ is the vector of unknown coefficients, and $\\mathbf{Q}$ is the vector of model outputs. When $N_{pts}$ is greater than the number of coefficients $|\\mathcal{A}_p|$, this overdetermined system is solved in a least-squares sense:\n$$\n\\min_{\\mathbf{c}} \\| \\mathbf{\\Psi} \\mathbf{c} - \\mathbf{Q} \\|_2^2\n$$\nThe solution yields the estimated PCE coefficients for the index set $\\mathcal{A}_p$.\n\n**1.4. Sobol' Indices from PCE Coefficients**\nSobol' indices quantify the contribution of each input variable to the total variance of the output. The total variance of the truncated PCE model $Q_p$ is derived from its coefficients. The mean is $\\mathbb{E}[Q_p] = c_{\\boldsymbol{0}}$, as $\\mathbb{E}[\\Phi_{\\boldsymbol{\\alpha}}] = 0$ for $\\boldsymbol{\\alpha} \\ne \\boldsymbol{0}$ and $\\Phi_{\\boldsymbol{0}}=1$. The total variance is:\n$$\nD_p = \\text{Var}[Q_p] = \\mathbb{E}[Q_p^2] - (\\mathbb{E}[Q_p])^2 = \\left(\\sum_{\\boldsymbol{\\alpha} \\in \\mathcal{A}_p} c_{\\boldsymbol{\\alpha}}^2\\right) - c_{\\boldsymbol{0}}^2 = \\sum_{\\boldsymbol{\\alpha} \\in \\mathcal{A}_p, \\boldsymbol{\\alpha} \\ne \\boldsymbol{0}} c_{\\boldsymbol{\\alpha}}^2\n$$\nThe first-order Sobol' index $S_i$ for input $\\xi_i$ is the fraction of total variance explained by functions depending solely on $\\xi_i$. The part of the variance attributable only to $\\xi_i$ is $D_i^{(p)} = \\sum_{\\boldsymbol{\\alpha} \\in \\mathcal{A}_p^{(i)}} c_{\\boldsymbol{\\alpha}}^2$, where $\\mathcal{A}_p^{(i)} = \\{\\boldsymbol{\\alpha} \\in \\mathcal{A}_p \\mid \\alpha_i > 0 \\text{ and } \\alpha_j = 0 \\text{ for } j \\ne i\\}$. The first-order Sobol' index is then:\n$$\nS_i^{(p)} = \\frac{D_i^{(p)}}{D_p} = \\frac{\\sum_{\\boldsymbol{\\alpha} \\in \\mathcal{A}_p^{(i)}} c_{\\boldsymbol{\\alpha}}^2}{\\sum_{\\boldsymbol{\\alpha} \\in \\mathcal{A}_p, \\boldsymbol{\\alpha} \\ne \\boldsymbol{0}} c_{\\boldsymbol{\\alpha}}^2}\n$$\n\n### Step 2: Algorithmic Implementation\n\nThe overall algorithm proceeds by looping through the specified sparse-grid levels $L \\in \\{3, 4, 5\\}$. For each level, a single set of collocation points is generated and the model is evaluated. Then, for this fixed dataset, three separate PCEs are constructed (for $p=1, 2, 3$) and their respective Sobol' indices are computed, finally yielding the convergence metrics.\n\n**For each level $L \\in \\{3, 4, 5\\}$:**\n1.  **Generate Sparse Grid Nodes:**\n    *   Determine the maximum level sum: $S_{max} = L + d - 1 = L+2$.\n    *   Generate all multi-index triples $\\boldsymbol{\\ell} = (\\ell_1, \\ell_2, \\ell_3)$ where $\\ell_i \\ge 1$ and $\\ell_1+\\ell_2+\\ell_3 \\le S_{max}$.\n    *   For each $\\ell_i$ that appears, pre-compute the 1D Clenshaw-Curtis node set $X_{\\ell_i}$.\n    *   Construct the full set of collocation nodes $\\boldsymbol{\\Xi}_L$ by taking the union of the points in all tensor-product grids $X_{\\ell_1} \\times X_{\\ell_2} \\times X_{\\ell_3}$. A `set` data structure is ideal for handling the union and removing duplicates.\n\n2.  **Evaluate Model:**\n    *   For each unique node $\\boldsymbol{\\xi}^{(j)} = (\\xi_1^{(j)}, \\xi_2^{(j)}, \\xi_3^{(j)}) \\in \\boldsymbol{\\Xi}_L$:\n        *   Apply the affine transformations to map $\\boldsymbol{\\xi}^{(j)}$ to physical parameters $(a^{(j)}, b^{(j)}, c^{(j)})$.\n        *   Compute the model output $Q^{(j)} = Q(a^{(j)}, b^{(j)}, c^{(j)})$.\n\n3.  **Compute Sobol' Indices for $p=1, 2, 3$:**\n    *   Initialize an empty dictionary to store Sobol' indices for each $p$.\n    *   **Loop for $p \\in \\{1, 2, 3\\}$:**\n        *   Generate the total-degree index set $\\mathcal{A}_p$.\n        *   Construct the regression matrix $\\mathbf{\\Psi}$ of size $N_{pts} \\times |\\mathcal{A}_p|$, where $\\Psi_{j,\\boldsymbol{\\alpha}} = \\Phi_{\\boldsymbol{\\alpha}}(\\boldsymbol{\\xi}^{(j)})$. This requires evaluating the orthonormal Legendre polynomials at the node coordinates.\n        *   Solve the least-squares problem $\\mathbf{\\Psi} \\mathbf{c}_p = \\mathbf{Q}$ to find the coefficient vector $\\mathbf{c}_p$.\n        *   Calculate the total variance $D_p$ from $\\mathbf{c}_p$.\n        *   For each input $i \\in \\{1, 2, 3\\}$, calculate the partial variance $D_i^{(p)}$ by summing the squares of coefficients corresponding to basis functions that depend only on $\\xi_i$.\n        *   Compute the first-order Sobol' indices $S_i^{(p)} = D_i^{(p)} / D_p$ and store the vector $\\mathbf{S}^{(p)}$.\n\n4.  **Calculate Convergence Metrics:**\n    *   Retrieve the Sobol' index vectors $\\mathbf{S}^{(1)}, \\mathbf{S}^{(2)}, \\mathbf{S}^{(3)}$.\n    *   Compute $\\Delta_{1\\to 2}(L) = \\max_i |S_i^{(2)} - S_i^{(1)}|$.\n    *   Compute $\\Delta_{2\\to 3}(L) = \\max_i |S_i^{(3)} - S_i^{(2)}|$.\n    *   Store the pair $[\\Delta_{1\\to 2}(L), \\Delta_{2\\to 3}(L)]$.\n\nAfter iterating through all levels $L$, the collected pairs of metrics are formatted into the required final output string.", "answer": "```python\nimport numpy as np\nfrom scipy.special import eval_legendre\nfrom itertools import product\n\ndef solve():\n    \"\"\"\n    Implements the full uncertainty quantification pipeline as described in the problem.\n    \"\"\"\n    test_cases = [3, 4, 5]  # Sparse-grid levels L\n    final_results = []\n    d = 3  # Dimension\n\n    for L in test_cases:\n        # Step 1: Construct the Sparse Grid Collocation Points\n        max_level_sum = L + d - 1\n        \n        # Generate multi-index level triples\n        level_indices = set()\n        for l_tuple in product(range(1, max_level_sum + 1), repeat=d):\n            if sum(l_tuple) <= max_level_sum:\n                level_indices.add(l_tuple)\n\n        # Generate unique 1D node sets needed\n        all_1d_levels = sorted(list(set(l for l_tuple in level_indices for l in l_tuple)))\n        one_d_nodes = {}\n        for level in all_1d_levels:\n            num_points = 2**level + 1\n            # np.cos is robust to the dtype of its argument.\n            one_d_nodes[level] = np.cos(np.pi * np.arange(num_points) / (num_points - 1))\n\n        # Take the union of all tensor-product node sets\n        all_points_set = set()\n        for l1, l2, l3 in level_indices:\n            nodes1 = one_d_nodes[l1]\n            nodes2 = one_d_nodes[l2]\n            nodes3 = one_d_nodes[l3]\n            for p in product(nodes1, nodes2, nodes3):\n                all_points_set.add(p)\n        \n        collocation_nodes = np.array(list(all_points_set))\n        num_collocation_points = collocation_nodes.shape[0]\n\n        # Step 2: Evaluate the model at collocation points\n        a_min, a_max = 0.2, 0.6\n        b_min, b_max = 0.5, 2.0\n        c_min, c_max = 0.0, 1.0\n\n        xi = collocation_nodes\n        a = (a_min + a_max) / 2.0 + (a_max - a_min) / 2.0 * xi[:, 0]\n        b = (b_min + b_max) / 2.0 + (b_max - b_min) / 2.0 * xi[:, 1]\n        c = (c_min + c_max) / 2.0 + (c_max - c_min) / 2.0 * xi[:, 2]\n\n        model_evals = (np.sqrt(b) * (1.0 - 0.35 * c**2) / (1.0 + 0.2 * c) *\n                       (0.8 + 0.5 * a + 0.1 * a**2) +\n                       0.05 * a * b * c + 0.02 * b**2)\n        \n        sobol_indices_by_p = {}\n\n        # Function for orthonormal Legendre polynomial values\n        def phi(n, x):\n            return np.sqrt(2 * n + 1) * eval_legendre(n, x)\n\n        for p_total in [1, 2, 3]:\n            # Step 3: Construct PCE for each total degree p\n            \n            # Generate PCE multi-index set for total degree p\n            alpha_set = set()\n            for a1 in range(p_total + 1):\n                for a2 in range(p_total - a1 + 1):\n                    for a3 in range(p_total - a1 - a2 + 1):\n                        alpha_set.add((a1, a2, a3))\n            \n            multi_indices = sorted(list(alpha_set))\n            num_coeffs = len(multi_indices)\n            alpha_to_idx = {alpha: i for i, alpha in enumerate(multi_indices)}\n\n            # Build the regression matrix\n            vandermonde = np.zeros((num_collocation_points, num_coeffs))\n            for i, point in enumerate(collocation_nodes):\n                xi1, xi2, xi3 = point\n                for j, alpha in enumerate(multi_indices):\n                    a1, a2, a3 = alpha\n                    vandermonde[i, j] = phi(a1, xi1) * phi(a2, xi2) * phi(a3, xi3)\n\n            # Solve for PCE coefficients using linear least-squares\n            coeffs, _, _, _ = np.linalg.lstsq(vandermonde, model_evals, rcond=None)\n            \n            # Step 4: Calculate first-order Sobol' indices\n            idx_0 = alpha_to_idx[(0, 0, 0)]\n            \n            # Create a boolean mask to exclude the c_0 coefficient\n            non_zero_mask = np.ones(num_coeffs, dtype=bool)\n            non_zero_mask[idx_0] = False\n            total_variance = np.sum(coeffs[non_zero_mask]**2)\n\n            if total_variance < 1e-12: # Handle case of near-constant model\n                sobols = np.zeros(d)\n            else:\n                partial_variances = np.zeros(d)\n                for i in range(d):  # For each input variable xi_i\n                    var_sum_sq = 0.0\n                    for k in range(1, p_total + 1):\n                        alpha = [0] * d\n                        alpha[i] = k\n                        alpha_tuple = tuple(alpha)\n                        if alpha_tuple in alpha_to_idx:\n                            idx = alpha_to_idx[alpha_tuple]\n                            var_sum_sq += coeffs[idx]**2\n                    partial_variances[i] = var_sum_sq\n                \n                sobols = partial_variances / total_variance\n            \n            sobol_indices_by_p[p_total] = sobols\n            \n        # Step 5: Compute convergence metrics for the current level L\n        S1 = sobol_indices_by_p[1]\n        S2 = sobol_indices_by_p[2]\n        S3 = sobol_indices_by_p[3]\n        \n        delta_1_2 = np.max(np.abs(S2 - S1))\n        delta_2_3 = np.max(np.abs(S3 - S2))\n        \n        final_results.append([round(delta_1_2, 6), round(delta_2_3, 6)])\n\n    # Format and print the final output\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```", "id": "3348319"}]}