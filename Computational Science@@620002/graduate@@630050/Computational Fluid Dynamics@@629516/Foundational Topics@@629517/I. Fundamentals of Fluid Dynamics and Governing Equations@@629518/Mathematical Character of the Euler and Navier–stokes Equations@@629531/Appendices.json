{"hands_on_practices": [{"introduction": "The hyperbolic character of the Euler equations dictates that information propagates through an inviscid compressible fluid at finite speeds. This behavior can be precisely understood by analyzing the local wave structure, which is encoded in the eigenstructure of the system's flux Jacobian matrix. This foundational exercise involves deriving these characteristic speeds (eigenvalues) and their corresponding wave modes (eigenvectors), a crucial skill for understanding physical phenomena like shocks and rarefactions and for developing advanced numerical methods based on Riemann solvers [@problem_id:3343704].", "problem": "Consider the one-dimensional compressible Euler equations in conservation form for an ideal gas with ratio of specific heats $\\gamma$:\n$$\n\\frac{\\partial \\boldsymbol{Q}}{\\partial t} + \\frac{\\partial \\boldsymbol{f}(\\boldsymbol{Q})}{\\partial x} = \\boldsymbol{0},\n\\quad\n\\boldsymbol{Q} = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ \\rho E \\end{pmatrix},\n\\quad\n\\boldsymbol{f}(\\boldsymbol{Q}) = \\begin{pmatrix}\n\\rho u \\\\\n\\rho u^{2} + p \\\\\nu(\\rho E + p)\n\\end{pmatrix},\n$$\nwhere $\\rho$ is the mass density, $u$ is the velocity, $E$ is the specific total energy, and $p$ is the pressure satisfying the ideal-gas equation of state $p = (\\gamma - 1)\\rho e$ with $e$ the specific internal energy. Define the sound speed $c$ by $c^{2} = \\gamma p / \\rho$, and the specific total enthalpy $H$ by $H = (\\rho E + p)/\\rho$.\n\nAt a smooth state, the flux Jacobian $\\boldsymbol{A}(\\boldsymbol{Q}) = \\partial \\boldsymbol{f}/\\partial \\boldsymbol{Q}$ characterizes the local propagation of small-amplitude disturbances. Starting from the conservation laws and the equation of state, derive the characteristic speeds and the right and left eigenvectors of $\\boldsymbol{A}(\\boldsymbol{Q})$ in terms of the primitive variables $(\\rho, u, p)$ and $\\gamma$. Impose the normalization that the matrix of left eigenvectors $\\boldsymbol{L}$ satisfies $\\boldsymbol{L}\\boldsymbol{R} = \\boldsymbol{I}$, where $\\boldsymbol{R}$ is the matrix of right eigenvectors and $\\boldsymbol{I}$ is the identity. In particular, construct the contact (entropy) wave as the eigenvector associated with the eigenvalue $u$ along which pressure and velocity are unchanged.\n\nDiscuss the mathematical character of the system at sonic states, clarifying whether the eigenstructure is defective or diagonalizable, and analyze the implications for approximate Riemann solvers, including the need for entropy fixes near transonic rarefactions.\n\nFinally, for a generic small perturbation $\\delta \\boldsymbol{Q} = \\begin{pmatrix} \\delta \\rho \\\\ \\delta(\\rho u) \\\\ \\delta(\\rho E) \\end{pmatrix}$ about a base state $(\\rho, u, p)$, compute the scalar amplitude $\\alpha_{2}$ of the contact wave defined by $\\alpha_{2} = \\boldsymbol{\\ell}_{2} \\cdot \\delta \\boldsymbol{Q}$, where $\\boldsymbol{\\ell}_{2}$ is the left eigenvector associated with the eigenvalue $u$ under the normalization $\\boldsymbol{L}\\boldsymbol{R} = \\boldsymbol{I}$. Express your final answer for $\\alpha_{2}$ symbolically in terms of $u$, $c$, $\\gamma$, $\\delta \\rho$, $\\delta(\\rho u)$, and $\\delta(\\rho E)$. No numerical evaluation is required.", "solution": "The user wants a detailed analysis of the eigenstructure of the one-dimensional compressible Euler equations, a discussion of the system's character at sonic states, and the derivation of the amplitude of the contact wave component of a small perturbation.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n*   **Governing Equations**: $\\frac{\\partial \\boldsymbol{Q}}{\\partial t} + \\frac{\\partial \\boldsymbol{f}(\\boldsymbol{Q})}{\\partial x} = \\boldsymbol{0}$\n*   **State Vector**: $\\boldsymbol{Q} = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ \\rho E \\end{pmatrix}$\n*   **Flux Vector**: $\\boldsymbol{f}(\\boldsymbol{Q}) = \\begin{pmatrix} \\rho u \\\\ \\rho u^{2} + p \\\\ u(\\rho E + p) \\end{pmatrix}$\n*   **Ideal Gas Equation of State**: $p = (\\gamma - 1)\\rho e$, where $\\gamma$ is the ratio of specific heats and $e$ is the specific internal energy.\n*   **Specific Total Energy**: $E = e + \\frac{1}{2}u^2$\n*   **Sound Speed**: $c^{2} = \\gamma p / \\rho$\n*   **Specific Total Enthalpy**: $H = (\\rho E + p)/\\rho = E + p/\\rho$\n*   **Flux Jacobian**: $\\boldsymbol{A}(\\boldsymbol{Q}) = \\partial \\boldsymbol{f}/\\partial \\boldsymbol{Q}$\n*   **Normalization Condition**: The matrix of left eigenvectors $\\boldsymbol{L}$ and the matrix of right eigenvectors $\\boldsymbol{R}$ satisfy $\\boldsymbol{L}\\boldsymbol{R} = \\boldsymbol{I}$, where $\\boldsymbol{I}$ is the identity matrix.\n*   **Contact Wave Definition**: The eigenvector associated with the eigenvalue $u$, along which pressure and velocity are unchanged.\n*   **Perturbation**: A generic small perturbation $\\delta \\boldsymbol{Q} = \\begin{pmatrix} \\delta \\rho \\\\ \\delta(\\rho u) \\\\ \\delta(\\rho E) \\end{pmatrix}$\n*   **Objective**: Compute the scalar amplitude $\\alpha_{2} = \\boldsymbol{\\ell}_{2} \\cdot \\delta \\boldsymbol{Q}$, where $\\boldsymbol{\\ell}_{2}$ is the left eigenvector for the eigenvalue $u$.\n\n**Step 2: Validate Using Extracted Givens**\n\n*   **Scientifically Grounded**: The problem is based on the Euler equations, a cornerstone of fluid dynamics. All definitions (ideal gas law, sound speed, enthalpy) are standard and correct. This is scientifically sound.\n*   **Well-Posed**: The problem asks for a derivation of known quantities and a discussion of a well-established topic in computational fluid dynamics. The final calculation is specific and has a unique answer based on the premises. The problem is well-posed.\n*   **Objective**: The problem is stated in precise mathematical language, free of subjectivity or ambiguity. This is objective.\n*   **Completeness**: All necessary equations and definitions are provided to derive the required quantities. The system is self-contained.\n*   **Other Flaws**: The problem does not exhibit any of the flaws listed in the validation criteria (e.g., it is not trivial, contradictory, or unverifiable).\n\n**Step 3: Verdict and Action**\nThe problem is valid. A complete solution will be provided.\n\n### Solution\n\nThe system of equations can be written in quasilinear form as $\\frac{\\partial \\boldsymbol{Q}}{\\partial t} + \\boldsymbol{A}(\\boldsymbol{Q})\\frac{\\partial \\boldsymbol{Q}}{\\partial x} = \\boldsymbol{0}$, where $\\boldsymbol{A}(\\boldsymbol{Q}) = \\frac{\\partial \\boldsymbol{f}}{\\partial \\boldsymbol{Q}}$ is the flux Jacobian. The eigenvalues of $\\boldsymbol{A}$ represent the characteristic speeds of wave propagation, and the eigenvectors represent the modes of these waves.\n\n**1. Flux Jacobian, Eigenvalues, and Eigenvectors**\n\nTo find the Jacobian $\\boldsymbol{A}$, we must differentiate the components of the flux vector $\\boldsymbol{f}$ with respect to the components of the state vector $\\boldsymbol{Q}$. The components of $\\boldsymbol{f}$ are given in terms of primitive variables $(\\rho, u, p)$, while $\\boldsymbol{Q}$ is in conservative variables. We can express the primitive variables in terms of the conservative ones: $\\rho = Q_1$, $u = Q_2/Q_1$, and $p = (\\gamma-1)(Q_3 - \\frac{1}{2}Q_2^2/Q_1)$. The differentiation is tedious but straightforward. The resulting Jacobian matrix is:\n$$\n\\boldsymbol{A}(\\boldsymbol{Q}) = \\begin{pmatrix}\n0  1  0 \\\\\n\\frac{\\gamma-3}{2}u^2  (3-\\gamma)u  \\gamma-1 \\\\\nu\\left(\\frac{\\gamma-1}{2}u^2 - H\\right)  H - (\\gamma-1)u^2  \\gamma u\n\\end{pmatrix}\n$$\nwhere $H = \\frac{c^2}{\\gamma-1} + \\frac{1}{2}u^2$ is the specific total enthalpy.\n\nThe eigenvalues of $\\boldsymbol{A}$ are the roots of the characteristic polynomial $\\det(\\boldsymbol{A} - \\lambda \\boldsymbol{I}) = 0$. For the Euler equations, these are well-known to be:\n$$\n\\lambda_1 = u - c, \\quad \\lambda_2 = u, \\quad \\lambda_3 = u + c\n$$\nThese correspond to the two acoustic waves (propagating at speeds $u \\pm c$) and the contact/entropy wave (propagating with the fluid velocity $u$).\n\nThe corresponding right eigenvectors $\\boldsymbol{r}_k$, satisfying $\\boldsymbol{A}\\boldsymbol{r}_k = \\lambda_k \\boldsymbol{r}_k$, form the columns of the matrix $\\boldsymbol{R}$. A standard, unscaled choice for these eigenvectors is:\n$$\n\\boldsymbol{r}_1 = \\begin{pmatrix} 1 \\\\ u-c \\\\ H-uc \\end{pmatrix}, \\quad\n\\boldsymbol{r}_2 = \\begin{pmatrix} 1 \\\\ u \\\\ u^2/2 \\end{pmatrix}, \\quad\n\\boldsymbol{r}_3 = \\begin{pmatrix} 1 \\\\ u+c \\\\ H+uc \\end{pmatrix}\n$$\nThe eigenvector $\\boldsymbol{r}_2$ corresponds to the contact wave. A perturbation proportional to $\\boldsymbol{r}_2$ represents a change in density (and thus entropy, since $p=(\\gamma-1)\\rho e$) with no change in pressure or velocity, as specified in the problem.\n\nThe left eigenvectors $\\boldsymbol{\\ell}_k$, satisfying $\\boldsymbol{\\ell}_k \\boldsymbol{A} = \\lambda_k \\boldsymbol{\\ell}_k$, form the rows of the matrix $\\boldsymbol{L}$. The normalization condition $\\boldsymbol{L}\\boldsymbol{R} = \\boldsymbol{I}$ implies that $\\boldsymbol{\\ell}_i \\cdot \\boldsymbol{r}_j = \\delta_{ij}$, where $\\delta_{ij}$ is the Kronecker delta.\n\n**2. Discussion of Sonic States and Numerical Implications**\n\nA sonic state is where the local flow velocity equals the local sound speed, i.e., $|u| = c$. Let's consider $u=c$. The eigenvalues become:\n$$\n\\lambda_1 = 0, \\quad \\lambda_2 = c, \\quad \\lambda_3 = 2c\n$$\nFor a non-zero sound speed $c0$, these eigenvalues are distinct. A matrix with distinct eigenvalues is always diagonalizable. Therefore, the eigenstructure of the flux Jacobian $\\boldsymbol{A}$ is not defective at a sonic point; a full set of linearly independent eigenvectors exists.\n\nThe mathematical character of the system remains strictly hyperbolic. However, a significant issue arises in the context of numerical methods, particularly for approximate Riemann solvers like Roe's method. The problem centers on transonic rarefactions, where a continuous expansion fan crosses a sonic point (e.g., the flow transitions from subsonic $uc$ to supersonic $uc$ across the fan).\n\nThe characteristic fields associated with eigenvalues $\\lambda_1 = u-c$ and $\\lambda_3 = u+c$ are genuinely nonlinear (i.e., $\\nabla_{\\boldsymbol{Q}}\\lambda_k \\cdot \\boldsymbol{r}_k \\neq 0$), meaning they admit both shock and rarefaction wave solutions. The field for $\\lambda_2=u$ is linearly degenerate ($\\nabla_{\\boldsymbol{Q}}\\lambda_2 \\cdot \\boldsymbol{r}_2 = 0$), admitting only contact discontinuities.\n\nIn a transonic rarefaction, for example for the first characteristic family, the wave speed $\\lambda_1(x,t) = u(x,t) - c(x,t)$ varies continuously from a negative value on one side to a positive value on the other. A simple approximate Riemann solver like Roe's method replaces this fan with a single discontinuity propagating at an averaged speed. If this averaged speed is close to zero, the solver might incorrectly place a stationary shock wave where a smooth rarefaction should be. This numerical shock wave violates the second law of thermodynamics (the entropy condition) and is a non-physical artifact.\n\nTo prevent this, an \"entropy fix\" is required. These fixes detect the condition for a transonic rarefaction (e.g., $\\lambda_k(\\boldsymbol{Q}_L)  0  \\lambda_k(\\boldsymbol{Q}_R)$ for the left and right states of a Riemann problem) and modify the numerical flux function. For example, the wave is artificially \"smeared\" or broadened to mimic the behavior of a rarefaction fan, thereby preventing the formation of the entropy-violating shock and ensuring a physically correct solution.\n\n**3. Derivation of the Contact Wave Amplitude $\\alpha_2$**\n\nThe amplitude $\\alpha_2$ of the contact wave component of a perturbation $\\delta\\boldsymbol{Q}$ is given by the projection of $\\delta\\boldsymbol{Q}$ onto the corresponding left eigenvector $\\boldsymbol{\\ell}_2$: $\\alpha_2 = \\boldsymbol{\\ell}_2 \\cdot \\delta\\boldsymbol{Q}$. We must first find the normalized left eigenvector $\\boldsymbol{\\ell}_2$.\n\nFrom the orthogonality condition $\\boldsymbol{\\ell}_2 \\cdot \\boldsymbol{r}_1 = 0$ and $\\boldsymbol{\\ell}_2 \\cdot \\boldsymbol{r}_3 = 0$:\n$$\n\\ell_{2,1} + \\ell_{2,2}(u-c) + \\ell_{2,3}(H-uc) = 0 \\\\\n\\ell_{2,1} + \\ell_{2,2}(u+c) + \\ell_{2,3}(H+uc) = 0\n$$\nSubtracting the first equation from the second gives:\n$$\n2c\\ell_{2,2} + 2uc\\ell_{2,3} = 0 \\implies \\ell_{2,2} = -u\\ell_{2,3} \\quad (\\text{for } c \\neq 0)\n$$\nSubstituting this back into the first equation:\n$$\n\\ell_{2,1} - u(u-c)\\ell_{2,3} + (H-uc)\\ell_{2,3} = 0 \\implies \\ell_{2,1} + (-u^2 + uc + H - uc)\\ell_{2,3} = 0 \\implies \\ell_{2,1} = (u^2-H)\\ell_{2,3}\n$$\nSo, the unnormalized left eigenvector is proportional to $(u^2-H, -u, 1)^T$. Let this be $\\boldsymbol{\\ell}_2^* = (u^2-H, -u, 1)^T$.\n\nNow, we impose the normalization condition $\\boldsymbol{\\ell}_2 \\cdot \\boldsymbol{r}_2 = 1$. Let $\\boldsymbol{\\ell}_2 = S \\boldsymbol{\\ell}_2^*$.\n$$\nS \\left( (u^2-H)\\cdot 1 + (-u)\\cdot u + 1 \\cdot \\frac{u^2}{2} \\right) = 1\n$$\n$$\nS \\left( u^2 - H - u^2 + \\frac{u^2}{2} \\right) = 1 \\implies S \\left( \\frac{u^2}{2} - H \\right) = 1\n$$\nThe scaling factor is $S = \\frac{1}{u^2/2 - H}$. Substituting $H = \\frac{c^2}{\\gamma-1} + \\frac{u^2}{2}$:\n$$\nS = \\frac{1}{u^2/2 - \\left(\\frac{c^2}{\\gamma-1} + \\frac{u^2}{2}\\right)} = -\\frac{\\gamma-1}{c^2}\n$$\nThe normalized left eigenvector $\\boldsymbol{\\ell}_2$ is thus:\n$$\n\\boldsymbol{\\ell}_2 = -\\frac{\\gamma-1}{c^2} \\begin{pmatrix} u^2-H \\\\ -u \\\\ 1 \\end{pmatrix} = -\\frac{\\gamma-1}{c^2} \\begin{pmatrix} u^2 - (\\frac{c^2}{\\gamma-1} + \\frac{u^2}{2}) \\\\ -u \\\\ 1 \\end{pmatrix} = -\\frac{\\gamma-1}{c^2} \\begin{pmatrix} \\frac{u^2}{2} - \\frac{c^2}{\\gamma-1} \\\\ -u \\\\ 1 \\end{pmatrix}\n$$\n$$\n\\boldsymbol{\\ell}_2 = \\begin{pmatrix} -\\frac{(\\gamma-1)u^2}{2c^2} + 1 \\\\ \\frac{(\\gamma-1)u}{c^2} \\\\ -\\frac{\\gamma-1}{c^2} \\end{pmatrix}\n$$\nFinally, we compute the amplitude $\\alpha_2 = \\boldsymbol{\\ell}_2 \\cdot \\delta\\boldsymbol{Q}$:\n$$\n\\alpha_2 = \\left(1 - \\frac{(\\gamma-1)u^2}{2c^2}\\right)\\delta\\rho + \\left(\\frac{(\\gamma-1)u}{c^2}\\right)\\delta(\\rho u) + \\left(-\\frac{\\gamma-1}{c^2}\\right)\\delta(\\rho E)\n$$\nThis can be factored for a more compact representation:\n$$\n\\alpha_2 = \\frac{\\gamma-1}{c^2} \\left[ \\left(\\frac{c^2}{\\gamma-1} - \\frac{u^2}{2}\\right)\\delta\\rho + u\\,\\delta(\\rho u) - \\delta(\\rho E) \\right]\n$$\nThe first form is already expressed in the required variables.", "answer": "$$\\boxed{\\left(1 - \\frac{(\\gamma-1)u^2}{2c^2}\\right)\\delta\\rho + \\frac{(\\gamma-1)u}{c^2}\\delta(\\rho u) - \\frac{\\gamma-1}{c^2}\\delta(\\rho E)}$$", "id": "3343704"}, {"introduction": "A profound mathematical and physical distinction between the Euler and Navier-Stokes equations lies in their behavior under time reversal. The inviscid Euler equations are fundamentally time-reversible, while the dissipative viscous term in the Navier-Stokes equations introduces a definitive \"arrow of time.\" This practice employs a numerical experiment to explore this dichotomy, allowing you to computationally demonstrate how kinetic energy is conserved in an ideal fluid but irreversibly decays in a viscous one, offering deep insight into the nature of physical dissipation [@problem_id:3343741].", "problem": "You are asked to design and implement a program that performs a time-reversal experiment for two-dimensional incompressible flows governed by the Euler equations (zero viscosity) and the Navier–Stokes equations (positive viscosity). The goal is to use principled diagnostics to assess the mathematical character of these equations under time reversal: numerical reversibility for Euler and irreversibility for Navier–Stokes.\n\nThe fundamental base for this task is as follows.\n\n- The incompressible Navier–Stokes equations in a periodic square domain are\n$$\n\\partial_t \\boldsymbol{u} + (\\boldsymbol{u}\\cdot\\nabla)\\boldsymbol{u} = -\\nabla p + \\nu \\nabla^2 \\boldsymbol{u}, \\quad \\nabla \\cdot \\boldsymbol{u} = 0,\n$$\nwith the Euler equations given by the special case $\\nu = 0$. Here $\\boldsymbol{u}(x,y,t)$ is the velocity, $p(x,y,t)$ is the pressure (up to a constant), and $\\nu \\ge 0$ is the kinematic viscosity.\n\n- In two space dimensions, introduce the scalar vorticity $\\omega = \\partial_x u_y - \\partial_y u_x$ and the streamfunction $\\psi$ defined by $\\boldsymbol{u} = (\\partial_y \\psi, -\\partial_x \\psi)$, so that incompressibility is automatically satisfied. The vorticity evolves by\n$$\n\\partial_t \\omega + \\boldsymbol{u}\\cdot\\nabla \\omega = \\nu \\nabla^2 \\omega,\n$$\nand the streamfunction satisfies the elliptic relation\n$$\n\\nabla^2 \\psi = -\\omega.\n$$\n\n- Under time reversal $t \\mapsto -t$, the Euler equations are invariant when combined with the transformation $\\boldsymbol{u}\\mapsto -\\boldsymbol{u}$ (equivalently $\\omega \\mapsto -\\omega$), but the Navier–Stokes equations with $\\nu0$ are not invariant due to the irreversible viscous term $\\nu \\nabla^2 \\boldsymbol{u}$.\n\n- The kinetic energy is\n$$\nE(t) = \\frac{1}{2} \\int_{\\Omega} \\lVert \\boldsymbol{u}(x,y,t)\\rVert^2 \\, \\mathrm{d}x \\,\\mathrm{d}y,\n$$\nand in two dimensions one has the exact balance for smooth solutions\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} E(t) = - \\nu \\int_{\\Omega} \\omega(x,y,t)^2 \\, \\mathrm{d}x \\,\\mathrm{d}y,\n$$\nso $E$ is conserved for $\\nu = 0$ and decays monotonically for $\\nu  0$. In particular, the cumulative dissipation over a time interval $[0,T]$ is\n$$\nD(0,T) = \\nu \\int_{0}^{T} \\int_{\\Omega} \\omega(x,y,t)^2 \\, \\mathrm{d}x \\,\\mathrm{d}y \\,\\mathrm{d}t.\n$$\n\nYour program must implement a spatially pseudo-spectral discretization on a periodic square domain $\\Omega = [0,2\\pi)^2$ with an $N \\times N$ equispaced grid and the $2/3$ de-aliasing rule for nonlinear terms. Adopt a time integration scheme that is strictly time-symmetric for the inviscid part ($\\nu=0$) so that the Euler dynamics is numerically reversible under the mapping $t \\mapsto -t$, $\\omega \\mapsto -\\omega$, and treat the viscous term exactly via an integrating factor when $\\nu  0$ to avoid artificial instability in the diffusive component. All trigonometric functions must take angles in radians. All quantities are non-dimensional.\n\nTime-reversal experiment protocol for each test case:\n\n1. Set the initial vorticity at $t=0$ to\n$$\n\\omega_0(x,y) = A \\left[\\sin(3x + 2y) + \\cos(2x - y)\\right],\n$$\nwhere $A$ is a given amplitude. Recover the corresponding divergence-free velocity $\\boldsymbol{u}_0$ via the streamfunction $\\psi_0$ solving $\\nabla^2 \\psi_0 = -\\omega_0$.\n\n2. Integrate forward from $t=0$ to $t=T$ using a fixed time step $\\Delta t$ and $M$ steps (so $T = M \\Delta t$) for the given viscosity $\\nu \\ge 0$. Record the forward kinetic energy $E(0)$ and $E(T)$, and compute the cumulative dissipation diagnostic\n$$\nD(0,T) \\approx \\nu \\sum_{n=0}^{M-1} \\left( \\int_{\\Omega} \\omega(x,y,t_n)^2 \\, \\mathrm{d}x \\,\\mathrm{d}y \\right) \\Delta t,\n$$\nwhere $t_n = n \\Delta t$. Use the standard Riemann sum with uniform timestep.\n\n3. Perform a time-reversal experiment: construct two consecutive terminal states from the forward integration and apply the mapping $\\omega \\mapsto -\\omega$ consistently to these two states. Then march forward for the same number of steps $M$ with the same $\\nu$ and $\\Delta t$. At the end, compare the obtained vorticity field with $-\\omega_0$ and report the relative reversal error\n$$\n\\varepsilon_{\\mathrm{rev}} = \\frac{\\lVert \\omega_{\\mathrm{rev}}(T) + \\omega_0 \\rVert_{L^2(\\Omega)}}{\\lVert \\omega_0 \\rVert_{L^2(\\Omega)}},\n$$\nwith the convention that if $\\lVert \\omega_0 \\rVert_{L^2(\\Omega)} = 0$ then $\\varepsilon_{\\mathrm{rev}} := 0$. Here $\\lVert \\cdot \\rVert_{L^2(\\Omega)}$ denotes the standard $L^2$ norm on the periodic square domain.\n\n4. Also report the energy ratio\n$$\nR_E = \\frac{E(T)}{E(0)}.\n$$\n\nYour program must compute, for each test case, the triple of floats $(\\varepsilon_{\\mathrm{rev}}, R_E, D(0,T))$.\n\nTest Suite:\n\nUse the following four parameter sets to exercise different facets and edge cases of the experiment. In all cases, the spatial grid is $N = 32$, the domain is $\\Omega = [0,2\\pi)^2$, the time step is $\\Delta t = 0.0025$, and the number of time steps is $M = 400$ so that $T = 1.0$.\n\n- Case $1$ (Euler, reversible baseline): $(\\nu, A) = (0.0, 1.0)$.\n- Case $2$ (Navier–Stokes, mild dissipation): $(\\nu, A) = (0.001, 1.0)$.\n- Case $3$ (Navier–Stokes, stronger dissipation): $(\\nu, A) = (0.01, 1.0)$.\n- Case $4$ (trivial edge case): $(\\nu, A) = (0.01, 0.0)$.\n\nFinal output format:\n\nYour program should produce a single line of output containing the results for the four cases, concatenated in order as a flat list of twelve floats:\n$$\n[\\varepsilon_{\\mathrm{rev}}^{(1)}, R_E^{(1)}, D^{(1)}, \\varepsilon_{\\mathrm{rev}}^{(2)}, R_E^{(2)}, D^{(2)}, \\varepsilon_{\\mathrm{rev}}^{(3)}, R_E^{(3)}, D^{(3)}, \\varepsilon_{\\mathrm{rev}}^{(4)}, R_E^{(4)}, D^{(4)}].\n$$\nThe line must be printed exactly as a comma-separated list enclosed in square brackets with no additional text. All trigonometric angles must be in radians. All quantities are non-dimensional. The answers are floats.", "solution": "The user seeks to implement a numerical experiment to study the time-reversal properties of the 2D incompressible Euler and Navier–Stokes equations. The problem is well-posed, scientifically sound, and provides sufficient detail to construct a unique numerical solution. I will proceed with the implementation as specified.\n\n### Principle-Based Design\n\nThe core of the problem lies in numerically evolving the vorticity transport equation:\n$$\n\\partial_t \\omega + \\boldsymbol{u}\\cdot\\nabla \\omega = \\nu \\nabla^2 \\omega\n$$\non a two-dimensional periodic domain $\\Omega = [0,2\\pi)^2$. The velocity $\\boldsymbol{u}$ is recovered from the vorticity $\\omega$ via a streamfunction $\\psi$ that satisfies the Poisson equation $\\nabla^2 \\psi = -\\omega$. We will use a pseudo-spectral method for spatial discretization and a specialized time-stepping scheme.\n\n**1. Spatial Discretization: Pseudo-Spectral Method**\n\nA pseudo-spectral method is employed, which represents fields like vorticity on an $N \\times N$ grid, and uses the Fast Fourier Transform (FFT) to switch to Fourier space for computations.\n\n- **Vorticity to Velocity**: In Fourier space, derivatives become algebraic multiplications. The streamfunction's Fourier coefficients $\\hat{\\psi}$ are related to the vorticity's coefficients $\\hat{\\omega}$ by:\n$$\n-(k_x^2 + k_y^2)\\hat{\\psi}(\\boldsymbol{k}) = -\\hat{\\omega}(\\boldsymbol{k}) \\implies \\hat{\\psi}(\\boldsymbol{k}) = \\frac{\\hat{\\omega}(\\boldsymbol{k})}{k_x^2 + k_y^2}\n$$\nwhere $\\boldsymbol{k}=(k_x, k_y)$ is the wavevector. The case $\\boldsymbol{k}=0$ is handled by setting $\\hat{\\psi}(0,0)=0$. The velocity coefficients are then $\\hat{u}_x = i k_y \\hat{\\psi}$ and $\\hat{u}_y = -i k_x \\hat{\\psi}$.\n\n- **Nonlinear Advection Term**: The advection term $\\boldsymbol{u}\\cdot\\nabla\\omega$ is computed pseudo-spectrally. We compute $\\boldsymbol{u}$ and $\\omega$ in physical space via inverse FFT, multiply them, then transform back to Fourier space via FFT to compute the spatial derivatives. To prevent aliasing errors from this quadratic nonlinearity, the $2/3$ de-aliasing rule is applied by zeroing out high-frequency modes ($|k_x|, |k_y| > \\lfloor N/3 \\rfloor$) after computing the nonlinear product.\n\n- **Viscous Diffusion Term**: The diffusion term $\\nu \\nabla^2 \\omega$ becomes $-\\nu (k_x^2 + k_y^2) \\hat{\\omega}$ in Fourier space, a simple multiplication.\n\n**2. Time Integration**\n\nThe problem requires a time-symmetric scheme for the inviscid part and an exact treatment of the viscous term. A scheme that satisfies these conditions and is suitable for a two-step reversal experiment is an exponential time-differencing leapfrog-like method. The semi-discretized equation in Fourier space is:\n$$\n\\frac{d\\hat{\\omega}}{dt} = F(\\hat{\\omega}) + L\\hat{\\omega}\n$$\nwhere $L\\hat{\\omega} = -\\nu(k_x^2+k_y^2)\\hat{\\omega}$ is the linear diffusion operator and $F(\\hat{\\omega})$ is the nonlinear advection operator.\n\nA second-order scheme that is time-symmetric for $F$ and treats $L$ with an integrating factor is:\n$$\n\\hat{\\omega}^{n+1} = e^{2L\\Delta t} \\hat{\\omega}^{n-1} + 2\\Delta t e^{L\\Delta t} F(\\hat{\\omega}^n)\n$$\nFor $\\nu=0$, this reduces to the standard second-order leapfrog scheme $\\hat{\\omega}^{n+1} = \\hat{\\omega}^{n-1} + 2\\Delta t F(\\hat{\\omega}^n)$, which is time-reversible. For $\\nu0$, the exponential factors break the time-reversal symmetry, correctly modeling the physical irreversibility.\n\n- **Startup**: This is a two-step method, requiring $\\hat{\\omega}^0$ and $\\hat{\\omega}^1$ to start. $\\hat{\\omega}^0$ is given by the initial condition. $\\hat{\\omega}^1$ is computed using a second-order Runge-Kutta (Heun's method) for the first time step. This maintains the overall second-order accuracy.\n\n**3. Time-Reversal Protocol**\n\n1.  **Forward Integration**: The system is evolved from $t=0$ to $t=T=M\\Delta t$. The states at the last two time steps, $\\omega^{M-1}$ and $\\omega^{M}$, are stored. The initial and final kinetic energies $E(0), E(T)$ and the total dissipation $D(0,T)$ are computed.\n    - Kinetic Energy: $E = \\frac{1}{2}\\int |\\boldsymbol{u}|^2 \\mathrm{d}x \\,\\mathrm{d}y$. Using Parseval's theorem, this is efficiently computed in Fourier space: $E(t) = \\frac{1}{2} \\frac{(2\\pi)^2}{N^4} \\sum_{\\boldsymbol{k} \\neq 0} \\frac{|\\hat{\\omega}(\\boldsymbol{k},t)|^2}{k_x^2+k_y^2}$.\n    - Dissipation: $D(0,T) \\approx \\nu \\Delta t \\sum_{n=0}^{M-1} \\lVert \\omega(t_n) \\rVert^2_{L^2}$, where the squared norm is also computed via Parseval's theorem: $\\lVert \\omega \\rVert^2_{L^2} \\approx \\frac{(2\\pi)^2}{N^4} \\sum_{\\boldsymbol{k}} |\\hat{\\omega}(\\boldsymbol{k})|^2$.\n\n2.  **Reverse Integration**: The same numerical integrator is used to march forward in time for another $M$ steps, but with initial conditions derived from the final state of the forward run. For a two-step method, the initial state is a pair of fields. We apply the time-reversal transformation $\\omega \\mapsto -\\omega$ to the two consecutive terminal states:\n    - $\\omega_{\\text{rev}}(0) = -\\omega(T)$\n    - $\\omega_{\\text{rev}}(\\Delta t) = -\\omega(T-\\Delta t)$ (This requires a slight adaptation for our scheme, we use $\\omega^{M}$ and $\\omega^{M-1}$)\n    The initial pair for the reverse leapfrog integration is thus $(\\hat{\\omega}_{\\text{rev}}^0, \\hat{\\omega}_{\\text{rev}}^1) = (-\\hat{\\omega}^M, -\\hat{\\omega}^{M-1})$.\n\n3.  **Diagnostics**: After the reverse integration, the final state $\\omega_{\\text{rev}}(T)$ is compared to the negative of the initial state, $-\\omega_0$, to compute the reversal error $\\varepsilon_{\\mathrm{rev}}$. The energy ratio $R_E=E(T)/E(0)$ is also reported.\n\nThis numerical setup allows a direct probe of the mathematical character of the equations. For the Euler case ($\\nu=0$), the scheme is time-reversible, so $\\varepsilon_{\\mathrm{rev}}$ should be close to zero (limited by floating-point error and startup scheme asymmetry). For the Navier–Stokes case ($\\nu0$), the scheme is not reversible, and $\\varepsilon_{\\mathrm{rev}}$ is expected to be significant, demonstrating the \"arrow of time\" introduced by viscosity.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ... No, use numpy.fft\n# from scipy.fft import fft2, ifft2 is an allowed equivalent\n\ndef solve():\n    \"\"\"\n    Main function to run the time-reversal experiment for all test cases.\n    \"\"\"\n\n    def solve_case(N, dt, M, nu, A):\n        \"\"\"\n        Solves a single time-reversal experiment case.\n        \"\"\"\n        # =====================================================================\n        # 1. Grid and Wavenumber Setup\n        # =====================================================================\n        L = 2 * np.pi\n        dx = L / N\n        x = np.arange(N) * dx\n        X, Y = np.meshgrid(x, x, indexing='ij')\n\n        kx = np.fft.fftfreq(N, d=1/N) * (2 * np.pi / L)\n        Kx, Ky = np.meshgrid(kx, kx, indexing='ij')\n        K2 = Kx**2 + Ky**2\n\n        K2_inv = np.zeros_like(K2)\n        K2_inv[K2  0] = 1.0 / K2[K2  0]\n\n        kmax = N // 3\n        dealias_mask = (np.abs(Kx) = kmax)  (np.abs(Ky) = kmax)\n\n        # =====================================================================\n        # 2. Helper Functions\n        # =====================================================================\n        def get_advection_hat(omega_hat):\n            psi_hat = -omega_hat * K2_inv\n            ux_hat = 1j * Ky * psi_hat\n            uy_hat = -1j * Kx * psi_hat\n\n            ux = np.real(np.fft.ifft2(ux_hat))\n            uy = np.real(np.fft.ifft2(uy_hat))\n            omega = np.real(np.fft.ifft2(omega_hat))\n\n            ux_omega_hat = np.fft.fft2(ux * omega)\n            uy_omega_hat = np.fft.fft2(uy * omega)\n            \n            ux_omega_hat[~dealias_mask] = 0\n            uy_omega_hat[~dealias_mask] = 0\n\n            return 1j * Kx * ux_omega_hat + 1j * Ky * uy_omega_hat\n\n        def get_L2_norm_sq(omega_hat):\n            return (L**2 / N**4) * np.sum(np.abs(omega_hat)**2)\n\n        def get_energy(omega_hat):\n            energy_density_hat = K2_inv * np.abs(omega_hat)**2\n            return 0.5 * (L**2 / N**4) * np.sum(energy_density_hat)\n        \n        # =====================================================================\n        # 3. Initial Condition  Trivial Case\n        # =====================================================================\n        if A == 0.0:\n            return 0.0, 1.0, 0.0\n\n        omega0 = A * (np.sin(3 * X + 2 * Y) + np.cos(2 * X - Y))\n        omega0_hat = np.fft.fft2(omega0)\n\n        # =====================================================================\n        # 4. Forward Integration\n        # =====================================================================\n        w_hat_p = np.copy(omega0_hat)  # omega_hat at t_{n-1}\n        dissipation_sum = get_L2_norm_sq(w_hat_p)\n        E0 = get_energy(w_hat_p)\n\n        # Startup Step (RK2 - Heun's method) to get omega_hat at t_1\n        k1 = -get_advection_hat(w_hat_p) - nu * K2 * w_hat_p\n        w_hat_star = w_hat_p + dt * k1\n        k2 = -get_advection_hat(w_hat_star) - nu * K2 * w_hat_star\n        w_hat_c = w_hat_p + 0.5 * dt * (k1 + k2)  # omega_hat at t_n\n\n        # Main Time-Stepping Loop\n        exp_visc_1 = np.exp(-nu * K2 * dt)\n        exp_visc_2 = np.exp(-2 * nu * K2 * dt)\n        \n        omega_hat_M_minus_1 = None\n\n        for n in range(1, M):\n            if n  M:\n                 dissipation_sum += get_L2_norm_sq(w_hat_c)\n            \n            # Exponential Leapfrog step\n            # F(w) = -advection(w)\n            F_hat_c = -get_advection_hat(w_hat_c)\n            w_hat_n = exp_visc_2 * w_hat_p + 2 * dt * exp_visc_1 * F_hat_c\n            \n            w_hat_p = w_hat_c\n            w_hat_c = w_hat_n\n\n            if n == M - 2:\n                omega_hat_M_minus_1 = np.copy(w_hat_c)\n\n        omega_hat_M = np.copy(w_hat_c)\n\n        ET = get_energy(omega_hat_M)\n        RE = ET / E0 if E0  0 else 1.0\n        DT = nu * dt * dissipation_sum\n\n        # =====================================================================\n        # 5. Time-Reversal Experiment\n        # =====================================================================\n        w_hat_rev_p = -omega_hat_M          # omega_rev^0 = -omega^M\n        w_hat_rev_c = -omega_hat_M_minus_1  # omega_rev^1 = -omega^{M-1}\n\n        for n in range(1, M):\n            F_hat_rev_c = -get_advection_hat(w_hat_rev_c)\n            w_hat_rev_n = exp_visc_2 * w_hat_rev_p + 2 * dt * exp_visc_1 * F_hat_rev_c\n            \n            w_hat_rev_p = w_hat_rev_c\n            w_hat_rev_c = w_hat_rev_n\n\n        omega_hat_rev_final = w_hat_rev_c\n        \n        norm_w0_sq = get_L2_norm_sq(omega0_hat)\n        norm_err_sq = get_L2_norm_sq(omega_hat_rev_final + omega0_hat)\n        eps_rev = np.sqrt(norm_err_sq / norm_w0_sq)\n\n        return eps_rev, RE, DT\n\n    # --- Main execution script ---\n    test_cases = [\n        (0.0, 1.0),    # Case 1: Euler\n        (0.001, 1.0),  # Case 2: Navier-Stokes (mild)\n        (0.01, 1.0),   # Case 3: Navier-Stokes (strong)\n        (0.01, 0.0),   # Case 4: Trivial\n    ]\n    \n    N = 32\n    dt = 0.0025\n    M = 400\n    \n    results = []\n    for nu, A in test_cases:\n        eps_rev, RE, DT = solve_case(N, dt, M, nu, A)\n        results.extend([eps_rev, RE, DT])\n        \n    print(f\"[{','.join(f'{x:.7g}' for x in results)}]\")\n\nsolve()\n```", "id": "3343741"}, {"introduction": "While smooth, classical solutions to the Euler equations are well-behaved, the realm of \"weak\" solutions, which are essential for describing phenomena like turbulence, is surprisingly complex and can permit non-uniqueness. This advanced practice explores this frontier by connecting the modern mathematical theory of Convex Integration to computational results. You will implement a numerical experiment to show how the inherent dissipation of a numerical scheme, even when small, acts as a selection criterion that can guide an under-resolved simulation toward macroscopically different outcomes, revealing the subtle interplay between numerics and the fundamental structure of the equations [@problem_id:3343706].", "problem": "Consider the unsteady, two-dimensional, incompressible flow on a periodic square domain with side length $2\\pi$. Begin from the conservation of mass and momentum for an inviscid or weakly viscous fluid, which state that the velocity field $\\mathbf{u}(x,y,t)$ satisfies $\\nabla \\cdot \\mathbf{u} = 0$ and the material derivative of velocity is balanced by pressure gradients and, optionally, a viscous term. From this base, adopt the vorticity-streamfunction formulation in which the scalar vorticity $\\omega(x,y,t)$ evolves by advection and diffusion in the form\n$$\n\\frac{\\partial \\omega}{\\partial t} + \\mathbf{u} \\cdot \\nabla \\omega = \\epsilon \\Delta \\omega,\n$$\nwith the streamfunction $\\psi$ satisfying the Poisson equation $\\Delta \\psi = \\omega$ and velocity obtained by $\\mathbf{u} = \\nabla^{\\perp} \\psi = \\left(-\\frac{\\partial \\psi}{\\partial y}, \\frac{\\partial \\psi}{\\partial x}\\right)$. The parameter $\\epsilon \\ge 0$ plays the role of numerical dissipation and models how different schemes may effectively regularize the flow. It is known from recent advances in Convex Integration (CI) that weak solutions of the incompressible Euler equations ($\\epsilon = 0$) may be non-unique; in under-resolved computations, varying $\\epsilon$ can guide the selection of distinct weak limits. Your task is to implement a self-contained numerical experiment that demonstrates, quantitatively, how different values of $\\epsilon$ select different large-scale weak limits in an under-resolved vortex interaction.\n\nYou must implement a pseudo-spectral method on the periodic domain $[0,2\\pi) \\times [0,2\\pi)$ with a uniform grid of $N_x \\times N_y$ points, where $N_x = N_y = 64$. Use Fast Fourier Transform (FFT) to compute derivatives and to solve the Poisson equation. Deliberately avoid dealiasing so that the computation is under-resolved and susceptible to aliasing effects. Time-advance the vorticity with an explicit second-order Runge–Kutta method for the advective term and an integrating factor for diffusion:\n1. Compute $\\mathbf{u}$ from $\\omega$ by solving $\\Delta \\psi = \\omega$ spectrally and then $\\mathbf{u} = \\nabla^{\\perp} \\psi$.\n2. Evaluate the advective term $-\\mathbf{u} \\cdot \\nabla \\omega$ in physical space, with spatial gradients computed spectrally.\n3. Advance $\\omega$ by a second-order Runge–Kutta step for advection alone to obtain an intermediate vorticity.\n4. Apply the diffusion integrating factor $\\exp(-\\epsilon k^2 \\Delta t)$ spectrally to obtain the new vorticity, where $k^2 = k_x^2 + k_y^2$ and $\\Delta t$ is the time step.\n\nUse the following dimensionless parameters: domain side length $L = 2\\pi$, $N_x = N_y = 64$, time step $\\Delta t = 8 \\times 10^{-4}$, total time $T = 2 \\times 10^{-1}$. The initial condition is a pair of like-signed Gaussian vortices centered at $(x_1,y_1)$ and $(x_2,y_2)$, with amplitude $A$ and core size $\\sigma$:\n$$\n\\omega(x,y,0) = A \\exp\\left(-\\frac{(x-x_1)^2 + (y-y_1)^2}{2\\sigma^2}\\right) + A \\exp\\left(-\\frac{(x-x_2)^2 + (y-y_2)^2}{2\\sigma^2}\\right).\n$$\nUse $A = 10$, $\\sigma = 3 \\times 10^{-1}$, $(x_1,y_1) = (\\pi - d/2, \\pi)$, $(x_2,y_2) = (\\pi + d/2, \\pi)$, and $d = 1$. All quantities are dimensionless; no physical units are required.\n\nTo quantify weak-limit selection at large scales, define a low-pass filter that retains Fourier modes with wavenumber magnitude $\\sqrt{k_x^2 + k_y^2} \\le k_{\\mathrm{cut}}$, where $k_{\\mathrm{cut}} = 8$. Let $\\omega_{\\mathrm{low}}(t)$ be the vorticity filtered by this mask, and define the coarse-grained enstrophy at time $t$ by\n$$\nZ_{\\mathrm{low}}(t) = \\frac{1}{2} \\langle \\omega_{\\mathrm{low}}(t)^2 \\rangle,\n$$\nwhere $\\langle \\cdot \\rangle$ denotes the spatial average over the domain. The selection indicator is the dimensionless ratio\n$$\nS(\\epsilon) = \\frac{Z_{\\mathrm{low}}(T)}{Z_{\\mathrm{low}}(0)}.\n$$\nDifferent values of $\\epsilon$ that lead to distinct values of $S(\\epsilon)$ indicate selection of different weak limits at large scales.\n\nImplement the solver described above and evaluate $S(\\epsilon)$ for the following test suite of dissipation parameters:\n- Happy path: $\\epsilon = 10^{-4}$.\n- Inviscid boundary case: $\\epsilon = 0$.\n- Stronger dissipation: $\\epsilon = 5 \\cdot 10^{-3}$.\n- Very strong dissipation edge case: $\\epsilon = 10^{-2}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the test suite above. Each entry must be a floating-point number rounded to six decimal places, and the overall output must have the format $[S(10^{-4}),S(0),S(5 \\cdot 10^{-3}),S(10^{-2})]$. Do not print any additional text.", "solution": "The user has provided a valid problem statement. It describes a well-posed numerical experiment in computational fluid dynamics, grounded in established physical and mathematical principles, with all necessary parameters and methods clearly defined.\n\nThe problem requires the implementation of a numerical simulation to explore how small amounts of dissipation, parameterized by $\\epsilon$, can influence the large-scale behavior of an under-resolved two-dimensional fluid flow. This phenomenon is a numerical proxy for the theoretical concept of weak solution selection for the incompressible Euler equations. The simulation will be performed using a pseudo-spectral method on a doubly periodic domain.\n\nThe governing equations are the vorticity-streamfunction formulation of the 2D incompressible Navier-Stokes equations:\n$$\n\\frac{\\partial \\omega}{\\partial t} + \\mathbf{u} \\cdot \\nabla \\omega = \\epsilon \\Delta \\omega\n$$\n$$\n\\Delta \\psi = \\omega\n$$\n$$\n\\mathbf{u} = \\nabla^{\\perp} \\psi = \\left(-\\frac{\\partial \\psi}{\\partial y}, \\frac{\\partial \\psi}{\\partial x}\\right)\n$$\nHere, $\\omega(x,y,t)$ is the scalar vorticity, $\\mathbf{u}(x,y,t)$ is the velocity field, $\\psi(x,y,t)$ is the streamfunction, and $\\epsilon \\ge 0$ is the dissipation coefficient.\n\nThe numerical solution is constructed on a uniform $N_x \\times N_y$ grid over the periodic domain $[0, 2\\pi) \\times [0, 2\\pi)$, with $N_x = N_y = 64$. The core of the method is the Fast Fourier Transform (FFT), which allows for efficient and highly accurate computation of spatial derivatives and solutions to the Poisson equation.\n\nA field $f(x,y)$ on the grid is represented by its discrete Fourier series:\n$$\n\\hat{f}(k_x, k_y) = \\sum_{j=0}^{N_x-1} \\sum_{l=0}^{N_y-1} f(x_j, y_l) e^{-i(k_x x_j + k_y y_l)}\n$$\nwhere $(k_x, k_y)$ are integer wavenumbers. Spatial differentiation in physical space corresponds to multiplication by $i k_x$ or $i k_y$ in Fourier space. The Laplacian operator $\\Delta = \\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2}$ corresponds to multiplication by $-(k_x^2 + k_y^2) = -k^2$.\n\nThe numerical algorithm proceeds as follows for each time step:\n\n1.  **Solve for the Streamfunction and Velocity:** Given the vorticity field $\\omega$ at the current time, we first compute its Fourier transform $\\hat{\\omega}$. The Poisson equation $\\Delta \\psi = \\omega$ becomes an algebraic equation in Fourier space: $-k^2 \\hat{\\psi} = \\hat{\\omega}$. We solve for $\\hat{\\psi}$:\n    $$\n    \\hat{\\psi}(k_x, k_y) = -\\frac{\\hat{\\omega}(k_x, k_y)}{k_x^2 + k_y^2}\n    $$\n    For the mean mode $(k_x, k_y) = (0,0)$, where $k^2 = 0$, we set $\\hat{\\psi}(0,0) = 0$, which is permissible as the streamfunction is only defined up to an arbitrary constant. The Fourier transforms of the velocity components are then obtained from the relations $\\hat{u} = -i k_y \\hat{\\psi}$ and $\\hat{v} = i k_x \\hat{\\psi}$. Finally, the velocity components $u$ and $v$ in physical space are recovered by applying the inverse FFT.\n\n2.  **Compute the Advection Term:** The nonlinear advection term, $N(\\omega) = -\\mathbf{u} \\cdot \\nabla \\omega$, is computed using a pseudo-spectral approach. The gradients $\\frac{\\partial \\omega}{\\partial x}$ and $\\frac{\\partial \\omega}{\\partial y}$ are calculated spectrally (i.e., multiplication by $i k_x$ and $i k_y$ in Fourier space followed by an inverse FFT). The dot product with the velocity field $\\mathbf{u}$ is then computed point-wise in physical space. The problem specifies that no dealiasing is performed, meaning aliasing errors generated by this nonlinear product are allowed to corrupt the high-wavenumber modes.\n\n3.  **Time Integration:** The scheme is an operator splitting method. The PDE is split into a pure advection part and a pure diffusion part.\n    *   **Advection Step:** The advection equation $\\frac{\\partial \\omega}{\\partial t} = N(\\omega)$ is advanced over a time step $\\Delta t$ using an explicit second-order Runge-Kutta (midpoint) method:\n        $$\n        \\omega^* = \\omega_n + \\frac{\\Delta t}{2} N(\\omega_n)\n        $$\n        $$\n        \\omega_{n+1}^{\\text{adv}} = \\omega_n + \\Delta t N(\\omega^*)\n        $$\n        This yields an intermediate vorticity field, $\\omega_{n+1}^{\\text{adv}}$.\n    *   **Diffusion Step:** The result from the advection step is used as the initial condition for the diffusion equation $\\frac{\\partial \\omega}{\\partial t} = \\epsilon \\Delta \\omega$. This linear equation is solved exactly over the time step $\\Delta t$ in Fourier space using an integrating factor:\n        $$\n        \\hat{\\omega}_{n+1} = \\hat{\\omega}_{n+1}^{\\text{adv}} \\exp(-\\epsilon k^2 \\Delta t)\n        $$\n        The final vorticity field $\\omega_{n+1}$ is obtained by applying the inverse FFT to $\\hat{\\omega}_{n+1}$.\n\n4.  **Initial Condition:** The simulation starts from an initial condition consisting of two co-rotating Gaussian vortices:\n    $$\n    \\omega(x,y,0) = A \\exp\\left(-\\frac{(x-x_1)^2 + (y-y_1)^2}{2\\sigma^2}\\right) + A \\exp\\left(-\\frac{(x-x_2)^2 + (y-y_2)^2}{2\\sigma^2}\\right)\n    $$\n    with specified parameters $A=10$, $\\sigma=0.3$, and vortex separation $d=1$.\n\n5.  **Analysis:** To quantify the selection of different large-scale states, we compute the coarse-grained enstrophy, $Z_{\\text{low}}(t)$. This is the spatially-averaged squared vorticity, but calculated only from the low-wavenumber modes of the solution. A sharp spectral filter is applied, retaining only Fourier modes for which the wavenumber magnitude $\\sqrt{k_x^2 + k_y^2}$ is less than or equal to a cutoff $k_{\\text{cut}} = 8$. The selection indicator is the ratio of final to initial coarse-grained enstrophy:\n    $$\n    S(\\epsilon) = \\frac{Z_{\\text{low}}(T)}{Z_{\\text{low}}(0)}\n    $$\n    By computing this value for different $\\epsilon$, we can quantitatively demonstrate how the dissipation level affects the final state of the large scales of the flow.\n\nThe provided Python code implements this entire procedure. It initializes the grid, wavenumbers, and initial condition. It then iterates through the specified list of $\\epsilon$ values. For each $\\epsilon$, it performs the time-marching simulation for a total time $T = 0.2$ with time step $\\Delta t = 8 \\times 10^{-4}$. Finally, it computes and stores the indicator $S(\\epsilon)$, and prints the collected results in the specified format.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a pseudo-spectral solver for the 2D incompressible vorticity equation\n    to demonstrate weak-limit selection in under-resolved vortex dynamics.\n    \"\"\"\n    # Define the problem parameters\n    L = 2.0 * np.pi\n    N = 64\n    dt = 8.0e-4\n    T = 2.0e-1\n    test_epsilons = [1.0e-4, 0.0, 5.0e-3, 1.0e-2]\n    A = 10.0\n    sigma = 0.3\n    d = 1.0\n    k_cut = 8.0\n\n    # Create the physical and spectral grids\n    x = np.linspace(0, L, N, endpoint=False)\n    y = np.linspace(0, L, N, endpoint=False)\n    xx, yy = np.meshgrid(x, y, indexing='xy')\n\n    # Wavenumbers for a domain of size 2*pi are integers\n    k = np.fft.fftfreq(N) * N\n    kxx, kyy = np.meshgrid(k, k, indexing='xy')\n    k_sq = kxx**2 + kyy**2\n\n    # Pre-compute the inverse Laplacian operator in spectral space\n    # Handle the k=0 mode (division by zero) by setting its inverse to 0\n    k_sq_inv = np.zeros_like(k_sq)\n    nonzero_k = k_sq  0\n    k_sq_inv[nonzero_k] = 1.0 / k_sq[nonzero_k]\n\n    # Create the low-pass filter mask for analysis\n    low_pass_mask = (np.sqrt(k_sq) = k_cut)\n\n    # Define the initial condition: two like-signed Gaussian vortices\n    x1, y1 = np.pi - d / 2.0, np.pi\n    x2, y2 = np.pi + d / 2.0, np.pi\n    r1_sq = (xx - x1)**2 + (yy - y1)**2\n    r2_sq = (xx - x2)**2 + (yy - y2)**2\n    omega_initial = A * np.exp(-r1_sq / (2 * sigma**2)) + A * np.exp(-r2_sq / (2 * sigma**2))\n\n    def get_coarse_grained_enstrophy(omega_field):\n        \"\"\"\n        Computes the coarse-grained enstrophy Z_low from a vorticity field.\n        \"\"\"\n        omega_hat = np.fft.fft2(omega_field)\n        omega_low_hat = omega_hat * low_pass_mask\n        omega_low = np.fft.ifft2(omega_low_hat).real\n        return 0.5 * np.mean(omega_low**2)\n\n    # Calculate the initial coarse-grained enstrophy\n    Z_low_initial = get_coarse_grained_enstrophy(omega_initial)\n\n    def advection_term(w_field):\n        \"\"\"\n        Computes the advection term -u . grad(w) using a pseudo-spectral method.\n        \"\"\"\n        w_hat = np.fft.fft2(w_field)\n\n        # 1. Compute velocity field u = (-psi_y, psi_x) from vorticity w\n        # Solve Delta psi = w = -k^2 psi_hat = w_hat\n        psi_hat = -w_hat * k_sq_inv\n        \n        # In spectral space: u_hat = -i*ky*psi_hat, v_hat = i*kx*psi_hat\n        u_hat = -1j * kyy * psi_hat\n        v_hat =  1j * kxx * psi_hat\n        \n        # Transform velocity to physical space\n        u = np.fft.ifft2(u_hat).real\n        v = np.fft.ifft2(v_hat).real\n\n        # 2. Compute vorticity gradients grad(w) spectrally\n        w_x_hat = 1j * kxx * w_hat\n        w_y_hat = 1j * kyy * w_hat\n        \n        # Transform gradients to physical space\n        w_x = np.fft.ifft2(w_x_hat).real\n        w_y = np.fft.ifft2(w_y_hat).real\n\n        # 3. Compute advection term in physical space (no dealiasing)\n        return -(u * w_x + v * w_y)\n\n    results = []\n    num_steps = int(round(T / dt))\n\n    # Loop over each dissipation parameter and run the simulation\n    for epsilon in test_epsilons:\n        omega = np.copy(omega_initial)\n        \n        # Pre-compute the integrating factor for diffusion for this epsilon\n        diffusion_factor = np.exp(-epsilon * k_sq * dt)\n\n        for _ in range(num_steps):\n            # Step 1: Advance advection with 2nd-order Runge-Kutta (midpoint method)\n            k1 = advection_term(omega)\n            omega_star = omega + 0.5 * dt * k1\n            k2 = advection_term(omega_star)\n            omega_advected = omega + dt * k2\n            \n            # Step 2: Apply diffusion using the exact integrating factor in spectral space\n            omega_advected_hat = np.fft.fft2(omega_advected)\n            omega_new_hat = omega_advected_hat * diffusion_factor\n            omega = np.fft.ifft2(omega_new_hat).real\n            \n        # After the simulation, compute the final coarse-grained enstrophy\n        Z_low_final = get_coarse_grained_enstrophy(omega)\n        \n        # Compute and store the selection indicator S(epsilon)\n        S_epsilon = Z_low_final / Z_low_initial\n        results.append(S_epsilon)\n\n    # Format the results as a comma-separated list of floats rounded to 6 decimal places.\n    formatted_results = [f'{r:.6f}' for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3343706"}]}