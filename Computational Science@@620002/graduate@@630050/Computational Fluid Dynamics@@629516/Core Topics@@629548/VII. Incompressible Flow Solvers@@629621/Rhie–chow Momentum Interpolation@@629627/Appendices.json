{"hands_on_practices": [{"introduction": "This first practice gets to the very heart of why Rhie-Chow interpolation is a cornerstone of modern CFD on collocated grids. We will construct a specific scenario designed to provoke the infamous \"checkerboard\" pressure instability and then use both theoretical analysis and numerical implementation to quantify exactly how the Rhie-Chow correction damps this spurious mode. This exercise [@problem_id:3358660] provides a crucial, foundational understanding of the pressure-velocity decoupling problem that Rhie-Chow interpolation was invented to solve.", "problem": "You are asked to analyze, derive, and numerically verify the Rhie–Chow momentum interpolation (Rhie–Chow (RC)) damping of a spurious pressure-velocity decoupling mode on a one-dimensional, uniform, collocated finite volume discretization for steady incompressible flow. Begin from the steady one-dimensional momentum balance for a Newtonian, constant-density fluid, which in continuous form is $0 = -\\partial p/\\partial x + f(x) + \\nu \\, \\partial^2 u/\\partial x^2$, where $p$ is pressure, $u$ is the velocity component aligned with $x$, $f(x)$ is a body force per unit volume, and $\\nu$ is the kinematic viscosity. Construct a manufactured solution that admits a uniform target velocity $u^\\star$ by prescribing an oscillatory pressure $p(x)=p_0+\\epsilon \\cos(k x)$ and choosing $f(x)$ so that $-\\partial p/\\partial x + f(x) = 0$ exactly in the continuous equation. Consider a uniform periodic domain of non-dimensional length $L=2\\pi$, discretized by $N$ collocated control volumes with uniform spacing $\\Delta x = L/N$ and periodic boundary conditions.\n\nOn a collocated grid, define the following discrete quantities at cell centers indexed by integer $j\\in \\{0,1,\\dots,N-1\\}$ and faces at $x_{j+1/2} = x_j + \\Delta x/2$ with periodic indexing. Let the discrete pressure field be $p_j = p_0 + \\epsilon \\cos(k x_j)$, where $k$ is an integer spatial frequency so that $kL$ is a multiple of $2\\pi$. Consider the face-normal velocity contribution stemming solely from the discrete pressure gradient, neglecting all other terms (i.e., take the homogeneous solution contribution to be constant and exactly interpolated). Use a dimensionless Rhie–Chow scaling factor $D=1$ for simplicity, which corresponds to a unit inverse momentum coefficient. Then:\n- Define the naive (non-RC) face velocity contribution at face $f=j+1/2$ by $u^{\\mathrm{naive}}_f = - D \\, (p_{j+1}-p_j)/\\Delta x$.\n- Define the Rhie–Chow face velocity contribution that uses the average of neighboring cell-centered gradients by $u^{\\mathrm{RC}}_f = - D \\, \\tfrac{1}{2}\\left(g_j + g_{j+1}\\right)$, where $g_j = (p_{j+1} - p_{j-1})/(2\\Delta x)$ is the central difference gradient at cell $j$.\n\nThe RC-induced damping of the spurious mode is quantified here as the change introduced by RC in the face velocity component attributable to the pressure gradient, namely the correction $u^{\\mathrm{RC}}_f - u^{\\mathrm{naive}}_f$. For a given $\\epsilon$ and wavenumber $k$, define the damping amplitude as $A_{\\mathrm{corr}}(k,\\epsilon) = \\max_f \\left|u^{\\mathrm{RC}}_f - u^{\\mathrm{naive}}_f\\right|$, and the normalized damping ratio $R(k,\\epsilon) = A_{\\mathrm{corr}}(k,\\epsilon)/\\epsilon$. Let $\\theta = k \\Delta x$ denote the cell-based nondimensional wavenumber.\n\nYour tasks are:\n- Derive from first principles why $u^{\\mathrm{naive}}_f$ and $u^{\\mathrm{RC}}_f$ are the appropriate discrete counterparts for the pressure gradient contribution to face velocity on a collocated grid and how the RC correction acts to damp the spurious checkerboard mode. Use only the steady momentum balance, central finite volume differences on a uniform grid, and linear interpolation concepts.\n- Show analytically how the RC correction scales with the nondimensional wavenumber $\\theta$, and determine the small-$\\theta$ asymptotic scaling of $R(k,\\epsilon)$ with respect to $k \\Delta x$ and $\\epsilon$.\n\nThen implement a program that, for a single-domain configuration with $L=2\\pi$ and $N=128$, evaluates the RC correction numerically under the manufactured pressure field $p_j = p_0 + \\epsilon \\cos(k x_j)$ for the following set of integer modes $m \\in \\{1,4,16,64\\}$, where $k=m$, and for two amplitudes $\\epsilon \\in \\{10^{-6}, 10^{-3}\\}$. Use periodic indexing. For each pair $(m,\\epsilon)$:\n- Compute the naive face velocity $u^{\\mathrm{naive}}_f$ and the RC face velocity $u^{\\mathrm{RC}}_f$.\n- Compute the normalized damping ratio $R(m,\\epsilon)=A_{\\mathrm{corr}}(m,\\epsilon)/\\epsilon$ by taking the maximum absolute correction over all faces divided by $\\epsilon$.\n\nEstimate the scaling exponent $n$ such that $R \\propto (k\\Delta x)^n$ at small $k\\Delta x$ by a least-squares fit of $\\log R$ versus $\\log(k \\Delta x)$ using only the modes $m \\in \\{1,4,16\\}$ (exclude $m=64$). Do this twice, once for each $\\epsilon$.\n\nAdditionally, quantify the linearity of the RC correction with respect to $\\epsilon$ by computing the maximum relative deviation from perfect linearity across the four modes:\n$$\n\\delta_{\\mathrm{lin}} = \\max_{m \\in \\{1,4,16,64\\}} \\left| \\frac{A_{\\mathrm{corr}}(m,10^{-3})}{A_{\\mathrm{corr}}(m,10^{-6})} \\cdot \\frac{10^{-6}}{10^{-3}} - 1 \\right|.\n$$\n\nTest suite and required outputs:\n- Use $N=128$, $L=2\\pi$, $D=1$, $m \\in \\{1,4,16,64\\}$, and $\\epsilon \\in \\{10^{-6},10^{-3}\\}$.\n- Your program must output a single line containing a comma-separated list enclosed in square brackets with the following items in order:\n    $[ n(10^{-6}), \\, n(10^{-3}), \\, R(1,10^{-6}), \\, R(4,10^{-6}), \\, R(16,10^{-6}), \\, R(64,10^{-6}), \\, R(1,10^{-3}), \\, R(4,10^{-3}), \\, R(16,10^{-3}), \\, R(64,10^{-3}), \\, \\delta_{\\mathrm{lin}} ]$.\n- All quantities are dimensionless, and angles are implicitly in radians. The final outputs should be floating-point numbers.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $[r_1,r_2,\\dots]$).", "solution": "The problem is assessed to be valid. It is a well-posed, scientifically grounded exercise in the numerical analysis of the Rhie–Chow momentum interpolation scheme, a standard technique in computational fluid dynamics (CFD). The problem statement is self-contained, with all necessary parameters and definitions provided for a complete theoretical derivation and numerical verification.\n\n### Theoretical Analysis of Rhie–Chow Damping\n\n#### 1. Pressure-Velocity Decoupling on Collocated Grids\nThe steady one-dimensional momentum equation is given as $0 = -\\partial p/\\partial x + f(x) + \\nu \\, \\partial^2 u/\\partial x^2$. In a finite volume method on a collocated grid, all variables (pressure $p$, velocity $u$) are stored at the cell centers $x_j$, for $j \\in \\{0, 1, \\dots, N-1\\}$. The discrete momentum equation relates the cell-centered velocity $u_j$ to a numerical approximation of the pressure gradient, among other terms. A standard central difference approximation for the pressure gradient at cell $j$ is $(\\nabla p)_j = (p_{j+1} - p_{j-1})/(2\\Delta x)$.\n\nThe continuity equation for an incompressible fluid, $\\partial u/\\partial x = 0$, is discretized by integrating over a control volume (cell $j$), which yields $u_{j+1/2} - u_{j-1/2} = 0$, where $u_{j\\pm 1/2}$ are the velocities at the cell faces. The core problem of a collocated grid arrangement is that the cell-centered pressure gradient $(\\nabla p)_j$ is insensitive to odd-even (checkerboard) oscillations in the pressure field. For instance, a pressure field of the form $p_j = C(-1)^j$ yields $(\\nabla p)_j = (C(-1)^{j+1} - C(-1)^{j-1})/(2\\Delta x) = (C(-1)^{j+1} - C(-1)^{j+1})/(2\\Delta x) = 0$ for all $j$. Such a pressure field would exert no force in the discrete momentum equation, yet it is non-uniform. This allows for spurious, non-physical pressure modes to exist in the solution without being detected or corrected by the momentum equation, a phenomenon known as pressure-velocity decoupling. The highest frequency mode resolvable on the grid, with a non-dimensional wavenumber $k\\Delta x = \\pi$, corresponds to this checkerboard pattern.\n\n#### 2. Naive vs. Rhie–Chow Face Velocity\nTo enforce continuity, face velocities $u_f$ are required. These must be interpolated from cell-centered quantities. The problem defines two methods for calculating the contribution of the pressure gradient to the face velocity at face $f=j+1/2$:\n\n- **Naive Interpolation**: This approach uses the most local discrete pressure gradient available, which is defined across the face itself:\n$$ u^{\\mathrm{naive}}_f = - D \\frac{p_{j+1}-p_j}{\\Delta x} $$\nWhile simple, this method, when used in the context of a full pressure-correction algorithm, does not suppress the spurious pressure modes.\n\n- **Rhie–Chow (RC) Interpolation**: The Rhie–Chow method constructs the face velocity in a manner that explicitly introduces a damping mechanism. The pressure gradient's contribution to face velocity is computed by first evaluating the cell-centered pressure gradients $g_j = (p_{j+1}-p_{j-1})/(2\\Delta x)$ and $g_{j+1}$, and then interpolating these to the face:\n$$ u^{\\mathrm{RC}}_f = - D \\frac{g_j + g_{j+1}}{2} $$\nThis procedure effectively couples the pressure at a point to a wider stencil, preventing the decoupling.\n\nThe essential damping mechanism of the RC scheme is encapsulated in the difference between these two formulations. The RC correction is defined as the difference $\\Delta u_f = u^{\\mathrm{RC}}_f - u^{\\mathrm{naive}}_f$. With the given inverse momentum coefficient $D=1$:\n$$ \\Delta u_{j+1/2} = \\left( -\\frac{1}{2} \\left[ \\frac{p_{j+1}-p_{j-1}}{2\\Delta x} + \\frac{p_{j+2}-p_j}{2\\Delta x} \\right] \\right) - \\left( -\\frac{p_{j+1}-p_j}{\\Delta x} \\right) $$\nCombining terms on a common denominator $4\\Delta x$:\n$$ \\Delta u_{j+1/2} = \\frac{1}{4\\Delta x} \\left[ -(p_{j+1}-p_{j-1}) - (p_{j+2}-p_j) + 4(p_{j+1}-p_j) \\right] $$\n$$ \\Delta u_{j+1/2} = \\frac{1}{4\\Delta x} \\left[ -p_{j+2} + 3p_{j+1} - 3p_j + p_{j-1} \\right] $$\nThis can be rewritten as:\n$$ \\Delta u_{j+1/2} = -\\frac{\\Delta x^2}{4} \\left[ \\frac{p_{j+2} - 3p_{j+1} + 3p_j - p_{j-1}}{\\Delta x^3} \\right] $$\nThe term in brackets is a finite difference approximation of the third-order derivative of pressure, $\\frac{\\partial^3 p}{\\partial x^3}$. The RC correction is thus equivalent to adding a term proportional to $\\Delta x^2 (\\partial^3 p / \\partial x^3)$ to the face velocity. In the context of the full pressure-correction equation (like SIMPLE), this term effectively introduces a fourth-order pressure derivative, which acts as a artificial diffusion on the pressure field, damping high-frequency oscillations.\n\n#### 3. Analytical Scaling for a Sinusoidal Mode\nWe analyze the correction for the prescribed pressure field $p(x) = p_0 + \\epsilon \\cos(kx)$, which at discrete points is $p_j = p_0 + \\epsilon\\cos(kx_j)$. The analysis is simplified by using trigonometric identities. Let $\\theta = k\\Delta x$ be the cell-based non-dimensional wavenumber.\n\nThe naive velocity is:\n$$ u^{\\mathrm{naive}}_{j+1/2} = -\\frac{\\epsilon}{\\Delta x}[\\cos(k(x_j+\\Delta x)) - \\cos(kx_j)] = \\frac{2\\epsilon}{\\Delta x}\\sin(k(x_j+\\Delta x/2))\\sin(k\\Delta x/2) $$\nThe RC velocity is:\n$$ u^{\\mathrm{RC}}_{j+1/2} = -\\frac{1}{2}(g_j + g_{j+1}) $$\nwhere $g_j = -\\frac{\\epsilon}{\\Delta x}\\sin(kx_j)\\sin(k\\Delta x)$. The sum $g_j+g_{j+1}$ becomes:\n$$ g_j+g_{j+1} = -\\frac{\\epsilon}{\\Delta x}\\sin(k\\Delta x)[\\sin(kx_j) + \\sin(k(x_j+\\Delta x))] = -\\frac{2\\epsilon}{\\Delta x}\\sin(k\\Delta x)\\sin(k(x_j+\\Delta x/2))\\cos(k\\Delta x/2) $$\nSo,\n$$ u^{\\mathrm{RC}}_{j+1/2} = \\frac{\\epsilon}{\\Delta x}\\sin(k\\Delta x)\\sin(k(x_j+\\Delta x/2))\\cos(k\\Delta x/2) $$\nUsing $\\sin(k\\Delta x) = 2\\sin(k\\Delta x/2)\\cos(k\\Delta x/2)$, this simplifies to:\n$$ u^{\\mathrm{RC}}_{j+1/2} = \\frac{2\\epsilon}{\\Delta x}\\sin(k\\Delta x/2)\\cos^2(k\\Delta x/2)\\sin(k(x_j+\\Delta x/2)) $$\nThe correction term is $\\Delta u_{j+1/2} = u^{\\mathrm{RC}}_{j+1/2} - u^{\\mathrm{naive}}_{j+1/2}$:\n$$ \\Delta u_{j+1/2} = \\frac{2\\epsilon}{\\Delta x}\\sin(k(x_j+\\Delta x/2))\\sin(k\\Delta x/2)[\\cos^2(k\\Delta x/2) - 1] $$\nUsing $\\cos^2\\alpha - 1 = -\\sin^2\\alpha$:\n$$ \\Delta u_{j+1/2} = -\\frac{2\\epsilon}{\\Delta x}\\sin(k(x_j+\\Delta x/2))\\sin^3(k\\Delta x/2) $$\nThe damping amplitude is the maximum absolute value of this correction over all faces:\n$$ A_{\\mathrm{corr}}(k, \\epsilon) = \\max_f |\\Delta u_f| = \\frac{2\\epsilon}{\\Delta x}|\\sin^3(k\\Delta x/2)| $$\nThe normalized damping ratio $R(k,\\epsilon) = A_{\\mathrm{corr}}(k,\\epsilon)/\\epsilon$ is therefore:\n$$ R(k, \\epsilon) = \\frac{2}{\\Delta x}|\\sin^3(k\\Delta x/2)| $$\n\n#### 4. Asymptotic Scaling and Linearity\nThe expression for $R(k, \\epsilon)$ is independent of the pressure amplitude $\\epsilon$. This demonstrates that the RC correction mechanism, in this idealized form, is perfectly linear with respect to $\\epsilon$. Consequently, the numerical test for linearity, $\\delta_{\\mathrm{lin}}$, is expected to be zero (or within machine precision).\n\nFor the asymptotic scaling at small non-dimensional wavenumber $\\theta = k\\Delta x \\ll 1$, we use the Taylor expansion $\\sin(z) \\approx z$ for small $z$.\n$$ R(k, \\epsilon) \\approx \\frac{2}{\\Delta x} \\left| \\left(\\frac{k\\Delta x}{2}\\right)^3 \\right| = \\frac{2}{\\Delta x} \\frac{k^3\\Delta x^3}{8} = \\frac{k^3\\Delta x^2}{4} $$\nTo find the scaling exponent $n$ such that $R \\propto (k\\Delta x)^n$ for a fixed grid ($\\Delta x$ is constant), we analyze $R$ as a function of $k$:\n$$ R(k) \\propto k^3 $$\nAlternatively, expressing $R$ as a function of $\\theta=k\\Delta x$:\n$$ R(\\theta) \\approx \\frac{(k\\Delta x)^3}{4\\Delta x} = \\frac{1}{4\\Delta x} \\theta^3 $$\nSince $\\Delta x$ is constant, $R(\\theta) \\propto \\theta^3 = (k\\Delta x)^3$. Thus, the scaling exponent is $n=3$. The numerical fit for the smallest wavenumbers should yield a value close to $3$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import linregress\n\ndef solve():\n    \"\"\"\n    Analyzes, derives, and numerically verifies the Rhie–Chow momentum interpolation\n    damping for a 1D steady incompressible flow problem.\n    \"\"\"\n    \n    # Define problem parameters\n    N = 128\n    L = 2 * np.pi\n    dx = L / N\n    modes = [1, 4, 16, 64]\n    epsilons = [1e-6, 1e-3]\n    \n    # Generate grid coordinates for cell centers\n    x_j = np.arange(N) * dx\n    \n    # Dictionaries to store results\n    all_R = {}\n    all_A_corr = {}\n\n    # Iterate over epsilon values and modes\n    for eps in epsilons:\n        all_R[eps] = {}\n        all_A_corr[eps] = {}\n        for m in modes:\n            k = m\n            \n            # --- Numerical Computation of RC Correction ---\n            \n            # Pressure field at cell centers using periodic indexing\n            p_j = eps * np.cos(k * x_j)\n            \n            # Use np.roll for efficient periodic boundary handling\n            p_j_plus_1 = np.roll(p_j, -1)\n            p_j_minus_1 = np.roll(p_j, 1)\n\n            # 1. Naive face velocity contribution from pressure gradient\n            # This is computed for each face j+1/2 between cells j and j+1\n            u_naive = -(p_j_plus_1 - p_j) / dx\n            \n            # 2. Rhie-Chow face velocity contribution\n            # First, compute cell-centered gradients\n            g_j = (p_j_plus_1 - p_j_minus_1) / (2 * dx)\n            g_j_plus_1 = np.roll(g_j, -1)\n            \n            # Then, interpolate gradients to the face\n            u_rc = -0.5 * (g_j + g_j_plus_1)\n            \n            # 3. Compute the correction term, its amplitude, and normalized ratio\n            correction = u_rc - u_naive\n            A_corr = np.max(np.abs(correction))\n            R = A_corr / eps\n            \n            # Store results\n            all_R[eps][m] = R\n            all_A_corr[eps][m] = A_corr\n\n    # --- Post-processing and Analysis ---\n    \n    # 1. Estimate the scaling exponent n\n    fit_modes = [1, 4, 16]\n    log_kdx = np.log([m * dx for m in fit_modes])\n    \n    # Fit for epsilon = 1e-6\n    log_R_eps1 = np.log([all_R[1e-6][m] for m in fit_modes])\n    res1 = linregress(log_kdx, log_R_eps1)\n    n1 = res1.slope\n    \n    # Fit for epsilon = 1e-3\n    log_R_eps2 = np.log([all_R[1e-3][m] for m in fit_modes])\n    res2 = linregress(log_kdx, log_R_eps2)\n    n2 = res2.slope\n\n    # 2. Quantify linearity deviation delta_lin\n    devs = []\n    for m in modes:\n        # The ratio should be 1 for perfect linearity.\n        ratio = (all_A_corr[1e-3][m] / all_A_corr[1e-6][m]) * (1e-6 / 1e-3)\n        dev = np.abs(ratio - 1)\n        devs.append(dev)\n    delta_lin = np.max(devs)\n    \n    # 3. Assemble the final list of results in the required order\n    results = [\n        n1, \n        n2,\n        all_R[1e-6][1], \n        all_R[1e-6][4], \n        all_R[1e-6][16], \n        all_R[1e-6][64],\n        all_R[1e-3][1], \n        all_R[1e-3][4], \n        all_R[1e-3][16], \n        all_R[1e-3][64],\n        delta_lin\n    ]\n\n    # Print the final output in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3358660"}, {"introduction": "Building on the fundamental mechanism of Rhie-Chow momentum interpolation (RCMI), this exercise investigates its performance and accuracy across different physical regimes. By systematically varying the grid Peclet number, $Pe$, you will explore how the balance between convection and diffusion affects the error in the RCMI-reconstructed face velocity compared to a simple linear interpolation. This practice [@problem_id:3358670] is essential for developing an appreciation for the practical behavior of the scheme and its robustness, particularly in the challenging, convection-dominated flows common in engineering applications.", "problem": "Consider a one-dimensional, uniform, periodic grid of length $L$ discretized into $N$ control volumes with cell centers at positions $x_i = \\left(i + \\tfrac{1}{2}\\right)\\Delta x$ for $i \\in \\{0,1,\\dots,N-1\\}$ and $\\Delta x = L/N$. Let the face between cells $i$ and $i+1$ (with periodic wrap of indices modulo $N$) be located at $x_{i+\\tfrac{1}{2}} = (i+1)\\Delta x$. Work in a fully non-dimensional setting: all quantities are non-dimensional, and the density is normalized to unity. Let the manufactured fields be given by the smooth periodic functions $u(x) = U_0 + U_1 \\sin\\left(2\\pi x/L\\right)$ and $p(x) = P_0 + P_1 \\cos\\left(2\\pi x/L\\right)$, where $U_0$, $U_1$, $P_0$, and $P_1$ are constants. Define the reference speed $U_{\\mathrm{ref}} = \\max_{x \\in [0,L]} |u(x)|$. For a target grid Peclet number $Pe$, set the kinematic viscosity $\\nu$ to satisfy $Pe = U_{\\mathrm{ref}} \\Delta x / \\nu$, i.e., $\\nu = U_{\\mathrm{ref}} \\Delta x / Pe$.\n\nStarting from the steady one-dimensional advection–diffusion operator with first-order upwind discretization for convection and central differencing for diffusion, the standard finite-volume neighbor coefficients at cell $i$ are constructed using the exact face mass fluxes. For the east and west faces of cell $i$, define $F_e = u(x_{i+\\tfrac{1}{2}})$, $F_w = u(x_{i-\\tfrac{1}{2}})$, and $D = \\nu/\\Delta x$. Then define\n- $a_E = D + \\max(-F_e, 0)$,\n- $a_W = D + \\max(F_w, 0)$,\n- $a_P = a_E + a_W + (F_e - F_w)$,\nand the auxiliary coefficient $d_i = 1/a_P$. At face $i+\\tfrac{1}{2}}$, define $d_{i+\\tfrac{1}{2}}$ as the arithmetic average $d_{i+\\tfrac{1}{2}} = \\tfrac{1}{2}(d_i + d_{i+1})$.\n\nDefine the following reconstructions of the face velocity $u$ at $x_{i+\\tfrac{1}{2}}$:\n- Linear interpolation: $u^{\\mathrm{lin}}_{i+\\tfrac{1}{2}} = \\tfrac{1}{2}\\left(u(x_i) + u(x_{i+1})\\right)$.\n- Rhie–Chow momentum interpolation (RCMI): $u^{\\mathrm{RC}}_{i+\\tfrac{1}{2}} = u^{\\mathrm{lin}}_{i+\\tfrac{1}{2}} - d_{i+\\tfrac{1}{2}}\\left(p(x_{i+1}) - p(x_i)\\right)$.\n\nFor each face, let $u^{\\mathrm{exact}}_{i+\\tfrac{1}{2}} = u(x_{i+\\tfrac{1}{2}})$. For a given $Pe$, quantify the reconstruction error of each method using the root-mean-square relative error over all faces:\n$$\n\\varepsilon_{\\mathrm{lin}}(Pe) = \\sqrt{\\frac{1}{N}\\sum_{i=0}^{N-1}\\left(\\frac{u^{\\mathrm{lin}}_{i+\\tfrac{1}{2}} - u^{\\mathrm{exact}}_{i+\\tfrac{1}{2}}}{U_{\\mathrm{ref}}}\\right)^2}, \\quad\n\\varepsilon_{\\mathrm{RC}}(Pe) = \\sqrt{\\frac{1}{N}\\sum_{i=0}^{N-1}\\left(\\frac{u^{\\mathrm{RC}}_{i+\\tfrac{1}{2}} - u^{\\mathrm{exact}}_{i+\\tfrac{1}{2}}}{U_{\\mathrm{ref}}}\\right)^2}.\n$$\n\nYour task is to implement a program that, for the specified manufactured fields and discretization, assesses the robustness of Rhie–Chow momentum interpolation by computing the above errors as the Peclet number varies, thereby exploring highly convective regimes.\n\nUse the following fixed parameters for all test cases:\n- Domain length $L = 1$,\n- Number of control volumes $N = 128$,\n- Manufactured field amplitudes $U_0 = 1$, $U_1 = 0.2$, $P_0 = 0$, $P_1 = 0.1$.\n\nTest suite:\n- Peclet numbers $Pe \\in \\{0.1, 1, 10, 100, 1000\\}$.\n\nFor each $Pe$ in the test suite, compute the pair of errors $\\varepsilon_{\\mathrm{RC}}(Pe)$ and $\\varepsilon_{\\mathrm{lin}}(Pe)$ as defined above. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with entries ordered as $[\\varepsilon_{\\mathrm{RC}}(0.1), \\varepsilon_{\\mathrm{lin}}(0.1), \\varepsilon_{\\mathrm{RC}}(1), \\varepsilon_{\\mathrm{lin}}(1), \\varepsilon_{\\mathrm{RC}}(10), \\varepsilon_{\\mathrm{lin}}(10), \\varepsilon_{\\mathrm{RC}}(100), \\varepsilon_{\\mathrm{lin}}(100), \\varepsilon_{\\mathrm{RC}}(1000), \\varepsilon_{\\mathrm{lin}}(1000)]$. All errors are non-dimensional by construction and must be returned as floating-point numbers.", "solution": "The problem requires a quantitative assessment of the Rhie–Chow momentum interpolation (RCMI) scheme by comparing its reconstruction error against that of a simple linear interpolation. This is performed within the framework of the method of manufactured solutions, which provides an exact, analytical form for the underlying continuous fields, allowing for a precise error analysis. The assessment is conducted over a range of grid Peclet numbers to evaluate performance in both diffusion-dominated and advection-dominated regimes.\n\nFirst, we define the computational domain and associated parameters. The one-dimensional periodic domain of length $L=1$ is discretized into $N=128$ control volumes. The grid spacing is therefore $\\Delta x = L/N = 1/128$. Cell centers are at positions $x_i = (i + \\frac{1}{2})\\Delta x$ and cell faces are at $x_{i+\\frac{1}{2}} = (i+1)\\Delta x$ for $i \\in \\{0, 1, \\dots, N-1\\}$. All computations are performed using non-dimensional quantities.\n\nThe manufactured solutions for velocity $u(x)$ and pressure $p(x)$ are given as smooth, periodic functions with specified amplitudes:\n$$u(x) = U_0 + U_1 \\sin\\left(\\frac{2\\pi x}{L}\\right) \\quad \\text{with } U_0 = 1, U_1 = 0.2$$\n$$p(x) = P_0 + P_1 \\cos\\left(\\frac{2\\pi x}{L}\\right) \\quad \\text{with } P_0 = 0, P_1 = 0.1$$\nThe reference velocity, $U_{\\mathrm{ref}}$, used for normalizing the error, is the maximum absolute velocity across the domain. Given that $U_0 > 0$ and $U_1 > 0$, this is:\n$$U_{\\mathrm{ref}} = \\max_{x \\in [0,L]} |u(x)| = |U_0| + |U_1| = 1 + 0.2 = 1.2$$\nThe kinematic viscosity $\\nu$ is tied to the grid Peclet number $Pe$ via the relation $\\nu = U_{\\mathrm{ref}} \\Delta x / Pe$. This allows us to systematically study the effect of varying the ratio of convection to diffusion.\n\nThe RCMI formulation relies on coefficients from the discretized momentum equation. We use a standard finite-volume discretization with first-order upwind for the convection term and central differencing for the diffusion term. For each cell $i$, the key coefficients are constructed as follows:\n1.  **Face fluxes**: Defined using the exact manufactured velocity at the east and west faces of cell $i$: $F_e = u(x_{i+\\frac{1}{2}})$ and $F_w = u(x_{i-\\frac{1}{2}})$. Due to periodicity, the west face of cell $0$ is the east face of cell $N-1$.\n2.  **Diffusion conductance**: $D = \\nu/\\Delta x$. Substituting the expression for $\\nu$, we find $D = (U_{\\mathrm{ref}} \\Delta x / Pe) / \\Delta x = U_{\\mathrm{ref}} / Pe$.\n3.  **Discretization coefficients**:\n    - East neighbor coefficient: $a_E = D + \\max(-F_e, 0)$\n    - West neighbor coefficient: $a_W = D + \\max(F_w, 0)$\n    - Central coefficient: $a_P = a_E + a_W + (F_e - F_w)$\n4.  **Auxiliary coefficient**: The coefficient required for the RCMI pressure correction term is $d_i = 1/a_P$.\n\nThe RCMI scheme requires this coefficient at the cell face, which is obtained by arithmetically averaging the adjacent cell-centered values:\n$$d_{i+\\frac{1}{2}} = \\frac{1}{2}(d_i + d_{i+1})$$\nThe index $i+1$ is taken modulo $N$ to handle the periodic boundary at the last face.\n\nWith these components, we can define the two velocity reconstruction schemes at each face $i+\\frac{1}{2}$:\n- **Linear Interpolation**: A simple average of the velocities at the centers of the two neighboring cells, $i$ and $i+1$.\n    $$u^{\\mathrm{lin}}_{i+\\frac{1}{2}} = \\frac{1}{2}\\left(u(x_i) + u(x_{i+1})\\right)$$\n- **Rhie–Chow Momentum Interpolation**: This scheme corrects the linear interpolation with a term proportional to the cell-to-cell pressure difference, which acts to suppress numerical oscillations.\n    $$u^{\\mathrm{RC}}_{i+\\frac{1}{2}} = u^{\\mathrm{lin}}_{i+\\frac{1}{2}} - d_{i+\\frac{1}{2}}\\left(p(x_{i+1}) - p(x_i)\\right)$$\n\nTo quantify the error of each scheme, we compare the reconstructed velocities to the exact velocity, $u^{\\mathrm{exact}}_{i+\\frac{1}{2}} = u(x_{i+\\frac{1}{2}})$. The error is measured using the root-mean-square (RMS) of the relative difference, calculated over all $N$ faces in the domain:\n$$\\varepsilon_{\\mathrm{lin}}(Pe) = \\sqrt{\\frac{1}{N}\\sum_{i=0}^{N-1}\\left(\\frac{u^{\\mathrm{lin}}_{i+\\frac{1}{2}} - u^{\\mathrm{exact}}_{i+\\frac{1}{2}}}{U_{\\mathrm{ref}}}\\right)^2}$$\n$$\\varepsilon_{\\mathrm{RC}}(Pe) = \\sqrt{\\frac{1}{N}\\sum_{i=0}^{N-1}\\left(\\frac{u^{\\mathrm{RC}}_{i+\\frac{1}{2}} - u^{\\mathrm{exact}}_{i+\\frac{1}{2}}}{U_{\\mathrm{ref}}}\\right)^2}$$\n\nThe overall process is to execute the following steps for each $Pe$ in the test suite $\\{0.1, 1, 10, 100, 1000\\}$:\n1.  Calculate numerical values for $\\Delta x$ and $U_{\\mathrm{ref}}$.\n2.  Define arrays representing the grid points $x_i$ and $x_{i+\\frac{1}{2}}$.\n3.  Evaluate the manufactured fields $u(x)$ and $p(x)$ at all cell centers and faces to get the necessary discrete values.\n4.  For the given $Pe$, compute $D$.\n5.  Assemble the coefficient arrays $a_E$, $a_W$, $a_P$, and then $d_i$.\n6.  Compute the face-centered coefficients $d_{i+\\frac{1}{2}}$.\n7.  Compute the face velocity fields $u^{\\mathrm{lin}}_{i+\\frac{1}{2}}$ and $u^{\\mathrm{RC}}_{i+\\frac{1}{2}}$.\n8.  Calculate and store the RMS errors $\\varepsilon_{\\mathrm{lin}}(Pe)$ and $\\varepsilon_{\\mathrm{RC}}(Pe)$.\n9.  Finally, the collected error pairs are formatted into a single output list.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_errors_for_pe(Pe, L, N, U0, U1, P0, P1):\n    \"\"\"\n    Computes the reconstruction errors for a single Peclet number.\n    \"\"\"\n    # 1. Define grid parameters and reference velocity.\n    dx = L / N\n    # For U0 > 0 and U1 > 0, max|u(x)| = U0 + U1.\n    U_ref = U0 + U1\n\n    # 2. Define grid locations for cell centers and faces.\n    i = np.arange(N)\n    x_i = (i + 0.5) * dx      # Cell centers\n    x_face = (i + 1.0) * dx   # Cell east faces\n\n    # 3. Evaluate the manufactured fields at the required locations.\n    u_cell = U0 + U1 * np.sin(2 * np.pi * x_i / L)\n    p_cell = P0 + P1 * np.cos(2 * np.pi * x_i / L)\n    u_exact_face = U0 + U1 * np.sin(2 * np.pi * x_face / L)\n\n    # 4. Compute coefficients for the Rhie-Chow interpolation.\n    # The diffusion conductance term D.\n    D = U_ref / Pe\n\n    # Face mass fluxes F_e and F_w are the exact velocities at the faces.\n    F_e = u_exact_face\n    # F_w for cell i is F_e for cell i-1. np.roll handles periodicity.\n    F_w = np.roll(u_exact_face, 1)\n\n    # Discretization coefficients for first-order upwind + central diffusion.\n    a_E = D + np.maximum(-F_e, 0)\n    a_W = D + np.maximum(F_w, 0)\n    a_P = a_E + a_W + (F_e - F_w)\n    \n    # Auxiliary coefficient d_i = 1/a_P.\n    d_i = 1.0 / a_P\n\n    # 5. Reconstruct face velocities using both schemes.\n    # Cell i+1 values are obtained by a left shift of cell i values.\n    u_cell_i_plus_1 = np.roll(u_cell, -1)\n    p_cell_i_plus_1 = np.roll(p_cell, -1)\n    d_i_plus_1 = np.roll(d_i, -1)\n\n    # Linear interpolation for face velocity.\n    u_lin_face = 0.5 * (u_cell + u_cell_i_plus_1)\n\n    # Rhie-Chow momentum interpolation.\n    # First, get face-centered d.\n    d_face = 0.5 * (d_i + d_i_plus_1)\n    # RCMI formula.\n    pressure_correction = d_face * (p_cell_i_plus_1 - p_cell)\n    u_rc_face = u_lin_face - pressure_correction\n\n    # 6. Calculate the root-mean-square relative errors.\n    err_lin_sq_normalized = ((u_lin_face - u_exact_face) / U_ref)**2\n    epsilon_lin = np.sqrt(np.mean(err_lin_sq_normalized))\n\n    err_rc_sq_normalized = ((u_rc_face - u_exact_face) / U_ref)**2\n    epsilon_rc = np.sqrt(np.mean(err_rc_sq_normalized))\n\n    return epsilon_rc, epsilon_lin\n\ndef solve():\n    \"\"\"\n    Main function to drive the computation for all test cases.\n    \"\"\"\n    # Define the fixed parameters from the problem statement.\n    L = 1.0\n    N = 128\n    U0 = 1.0\n    U1 = 0.2\n    P0 = 0.0\n    P1 = 0.1\n\n    # Define the test suite for Peclet numbers.\n    test_cases = [0.1, 1, 10, 100, 1000]\n\n    results = []\n    for pe in test_cases:\n        # Calculate errors for the current Pe.\n        err_rc, err_lin = calculate_errors_for_pe(pe, L, N, U0, U1, P0, P1)\n        # Append results in the required order.\n        results.append(err_rc)\n        results.append(err_lin)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3358670"}, {"introduction": "This final practice elevates our analysis to a two-dimensional system and introduces the critical, yet subtle, concept of pressure-robustness. You will investigate a scenario where the exact physical solution is a zero-velocity field, yet a naive numerical discretization of a body force can generate spurious, non-physical velocities. This exercise [@problem_id:3358724] demonstrates how a consistent discretization, built in the spirit of Rhie-Chow, preserves the integrity of the simulation and highlights a deeper principle of numerical methods: discrete operators must mimic the structural properties of their continuous counterparts to achieve robust and accurate results.", "problem": "You are asked to design, analyze, and implement a periodic collocated finite-volume discretization of the steady incompressible Stokes equations in two spatial dimensions that incorporates the Rhie–Chow momentum interpolation concept at the level of face-normal mass fluxes. The goal is to evaluate pressure-robustness under a gradient-dominated forcing by verifying how the discrete velocity error scales with viscosity and whether it is independent of the forcing amplitude. The starting point must be the fundamental conservation laws and standard discrete operator definitions on a uniform periodic grid; your derivation should not assume any pre-derived Rhie–Chow formulas.\n\nThe continuous problem is the steady incompressible Stokes system on a unit-periodic square domain with vanishing mean pressure, given by\n$$\n-\\nabla p + \\mu \\Delta \\mathbf{u} + \\mathbf{f} = \\mathbf{0}, \\qquad \\nabla \\cdot \\mathbf{u} = 0,\n$$\nwith viscosity $\\mu>0$ and forcing $\\mathbf{f} = \\nabla \\phi$, where $\\phi$ is a smooth scalar potential. From the fundamental fact that any pure gradient forcing can be absorbed into the pressure, the exact velocity solution is $\\mathbf{u} \\equiv \\mathbf{0}$ for periodic boundary conditions, regardless of the amplitude of $\\phi$. Pressure-robustness at the discrete level requires that the discrete solenoidal projector annihilates discrete gradients so that the computed velocity does not spuriously depend on $\\|\\phi\\|$.\n\nConsider a uniform collocated grid with $N_x \\times N_y$ cell-centered scalar unknowns on a periodic domain of size $1 \\times 1$. Let $\\Delta x = 1/N_x$ and $\\Delta y = 1/N_y$. Define the following standard discrete operators:\n- A cell-to-face centered discrete gradient $G$ acting separately in the $x$ and $y$ directions such that at an $x$-face centered at index $(i+\\tfrac{1}{2}, j)$,\n$$\n(G_x p)_{i+\\frac{1}{2},j} = \\frac{p_{i+1,j} - p_{i,j}}{\\Delta x},\n$$\nwith periodic wrapping, and similarly for $y$-faces via $(G_y p)_{i, j+\\frac{1}{2}} = \\frac{p_{i,j+1} - p_{i,j}}{\\Delta y}$.\n\n- A face-to-cell centered discrete divergence $D$ such that the cell-centered divergence at $(i,j)$ is\n$$\n(D \\mathbf{u})_{i,j} = \\frac{u_{x,i+\\frac{1}{2},j} - u_{x,i-\\frac{1}{2},j}}{\\Delta x} + \\frac{u_{y,i, j+\\frac{1}{2}} - u_{y,i, j-\\frac{1}{2}}}{\\Delta y}.\n$$\n\n- A cell-centered central difference gradient $\\mathcal{G}$ acting on $\\phi$ at cell centers via\n$$\n(\\mathcal{G}_x \\phi)_{i,j} = \\frac{\\phi_{i+1,j} - \\phi_{i-1,j}}{2\\Delta x}, \\qquad (\\mathcal{G}_y \\phi)_{i,j} = \\frac{\\phi_{i,j+1} - \\phi_{i,j-1}}{2\\Delta y}.\n$$\n\n- A cell-to-face averaging operator $\\mathcal{A}$ that maps a cell-centered vector field to faces by arithmetic averaging of the adjacent cells.\n\nInspired by Rhie–Chow momentum interpolation, define the face-normal predictor flux that will enter continuity as the sum of a face-projected body force contribution and a pressure-gradient mobility term. For pure diffusion linearization on a uniform grid, take a constant momentum mobility at faces equal to $1/\\mu$. Then the face-normal velocity is modeled as\n$$\n\\mathbf{u}_f = \\frac{1}{\\mu}\\,\\mathbf{f}_{\\mathrm{pred},f} - \\frac{1}{\\mu}\\,G p\n$$\nwhere $\\mathbf{f}_{\\mathrm{pred},f}$ is a face-centered approximation of the gradient forcing. The discrete continuity equation $D \\mathbf{u}_f = 0$ yields the pressure equation\n$$\nD G p = D \\,\\mathbf{f}_{\\mathrm{pred},f}.\n$$\nTwo choices for $\\mathbf{f}_{\\mathrm{pred},f}$ are to be implemented and contrasted:\n\n- A consistent, gradient-preserving choice: $\\mathbf{f}_{\\mathrm{pred},f} = G \\phi$, i.e., compute $\\mathbf{f}$ at faces by the same face-gradient operator used for $p$.\n\n- A naive, non-gradient-preserving choice: compute $\\mathbf{f}$ at cell centers via the central difference $\\mathcal{G}\\phi$ and then average to faces via $\\mathcal{A}$, yielding $\\mathbf{f}_{\\mathrm{pred},f} = \\mathcal{A}(\\mathcal{G}\\phi)$.\n\nFor each choice, solve $D G p = D \\,\\mathbf{f}_{\\mathrm{pred},f}$ for the cell-centered $p$ with the periodic zero-mean constraint (i.e., set the spatial mean of $p$ to zero), and then compute the resulting face velocity\n$$\n\\mathbf{u}_f = \\frac{1}{\\mu}\\,\\left(\\mathbf{f}_{\\mathrm{pred},f} - G p\\right).\n$$\nDefine the velocity error as the discrete root-mean-square over faces,\n$$\ne = \\left( \\frac{1}{N_x N_y} \\sum_{i,j} \\left(u_{x,i+\\frac{1}{2},j}^2 + u_{y,i, j+\\frac{1}{2}}^2 \\right) \\right)^{1/2}.\n$$\n\nUse a manufactured scalar potential\n$$\n\\phi(x,y) = A \\sin(2\\pi k_x x)\\cos(2\\pi k_y y)\n$$\nwith amplitude $A>0$ and integer wave numbers $k_x, k_y \\in \\mathbb{Z}$. Note that the exact continuum velocity solution is $\\mathbf{u} \\equiv \\mathbf{0}$ for all $A$ and $\\mu$.\n\nYour tasks:\n- Starting from the fundamental laws (momentum balance and mass conservation) and the above discrete operator definitions, derive the pressure equation and the final face velocity formula for both choices of $\\mathbf{f}_{\\mathrm{pred},f}$ without assuming any previously known Rhie–Chow formulas.\n- Implement a periodic fast solver for the discrete Poisson operator $D G$ using the discrete Fourier transform, enforcing a zero spatial mean pressure.\n- Compute the error $e$ for the consistent and the naive choices over a small test suite and aggregate the results as specified below.\n\nTest suite specification:\n- Use $N_x = 64$, $N_y = 64$, with periodic domain of size $1\\times 1$.\n- Use wave numbers $(k_x,k_y) = (3,2)$.\n- Viscosities: $\\mu \\in \\{0.1, 0.05\\}$.\n- Amplitudes: $A \\in \\{1.0, 10.0\\}$.\n\nCompute and report the following five quantities:\n1. The error $e$ for the consistent choice with $A=10.0$ and $\\mu=0.1$.\n2. The error $e$ for the consistent choice with $A=1000.0$ and $\\mu=0.1$.\n3. The scaled error $e/A$ for the naive choice with $A=1.0$ and $\\mu=0.1$.\n4. The scaled error $e/A$ for the naive choice with $A=10.0$ and $\\mu=0.1$.\n5. The viscosity scaling ratio $r$ for the naive choice at fixed amplitude $A=10.0$, defined by\n$$\nr = \\frac{(e/A)\\ \\text{at}\\ \\mu=0.1}{(e/A)\\ \\text{at}\\ \\mu=0.05}.\n$$\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order listed above, for example, \n\"[result1,result2,result3,result4,result5]\".\n- All values must be standard floating-point numbers. There are no physical units to report for this non-dimensionalized formulation, and angles do not appear. Ensure your implementation is self-contained and uses no external inputs.", "solution": "The problem requires the design and analysis of a periodic collocated finite-volume method for the steady incompressible Stokes equations, focusing on the pressure-robustness of two different implementations inspired by the Rhie–Chow momentum interpolation concept.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n- **Continuous Equations**: Steady incompressible Stokes equations on a unit-periodic square domain:\n  $$-\\nabla p + \\mu \\Delta \\mathbf{u} + \\mathbf{f} = \\mathbf{0}, \\qquad \\nabla \\cdot \\mathbf{u} = 0$$\n- **Forcing**: A pure gradient field, $\\mathbf{f} = \\nabla \\phi$.\n- **Potential Field**: $\\phi(x,y) = A \\sin(2\\pi k_x x)\\cos(2\\pi k_y y)$.\n- **Exact Solution**: $\\mathbf{u} \\equiv \\mathbf{0}$ with a vanishing mean pressure condition on $p$.\n- **Grid**: Uniform collocated grid with $N_x \\times N_y$ cells on a $1 \\times 1$ domain. Cell dimensions are $\\Delta x = 1/N_x$, $\\Delta y = 1/N_y$.\n- **Discrete Operators**:\n  - Cell-to-face gradient $G$: $(G_x p)_{i+\\frac{1}{2},j} = (p_{i+1,j} - p_{i,j})/\\Delta x$.\n  - Face-to-cell divergence $D$: $(D \\mathbf{u})_{i,j} = (u_{x,i+\\frac{1}{2},j} - u_{x,i-\\frac{1}{2},j})/\\Delta x + (u_{y,i, j+\\frac{1}{2}} - u_{y,i, j-\\frac{1}{2}})/\\Delta y$.\n  - Cell-centered gradient $\\mathcal{G}$: $(\\mathcal{G}_x \\phi)_{i,j} = (\\phi_{i+1,j} - \\phi_{i-1,j})/(2\\Delta x)$.\n  - Cell-to-face averaging $\\mathcal{A}$.\n- **Face Velocity Model**: $\\mathbf{u}_f = \\frac{1}{\\mu}\\,\\mathbf{f}_{\\mathrm{pred},f} - \\frac{1}{\\mu}\\,G p$.\n- **Choices for Face Forcing $\\mathbf{f}_{\\mathrm{pred},f}$**:\n  1.  **Consistent**: $\\mathbf{f}_{\\mathrm{pred},f} = G \\phi$.\n  2.  **Naive**: $\\mathbf{f}_{\\mathrm{pred},f} = \\mathcal{A}(\\mathcal{G}\\phi)$.\n- **Discrete Pressure Equation**: Derived from $D \\mathbf{u}_f = 0$, leading to $D G p = D \\,\\mathbf{f}_{\\mathrm{pred},f}$.\n- **Velocity Error Metric**: $e = \\left( \\frac{1}{N_x N_y} \\sum_{i,j} \\left(u_{x,i+\\frac{1}{2},j}^2 + u_{y,i, j+\\frac{1}{2}}^2 \\right) \\right)^{1/2}$.\n- **Solver Specification**: Fast Fourier Transform (FFT) for the periodic Poisson problem $DG p = S$.\n- **Test Parameters**: $N_x=64, N_y=64$, $(k_x, k_y)=(3,2)$, $\\mu \\in \\{0.1, 0.05\\}$, $A \\in \\{1.0, 10.0\\}$.\n- **Required Outputs**: Five specific numerical results related to the error $e$.\n\n**Step 2: Validate Using Extracted Givens**\n\nThe problem is scientifically grounded, well-posed, and objective. It outlines a standard numerical experiment in computational fluid dynamics to investigate the property of pressure-robustness. The equations, operator definitions, and numerical methodology are standard and well-defined. The use of a manufactured solution with a pure gradient forcing is a canonical test for this purpose. The discrete pressure equation is a Poisson equation on a periodic domain; the compatibility condition (zero mean of the right-hand side) is satisfied due to the structure of the discrete divergence operator $D$ on a periodic grid, and the prescription of a zero-mean pressure ensures a unique solution. The problem is self-contained, providing all necessary information for its solution. No scientific, logical, or factual flaws are present.\n\n**Step 3: Verdict and Action**\n\nThe problem is valid. A complete solution will be provided.\n\n### Derivation and Algorithmic Design\n\nThe core of the method lies in coupling the momentum and mass conservation laws at the discrete level. The problem provides a simplified, linearized model for the face-normal velocity $\\mathbf{u}_f$ that is inspired by an inversion of the momentum equation:\n$$\n\\mathbf{u}_f = \\frac{1}{\\mu} \\left( \\mathbf{f}_{\\mathrm{pred},f} - G p \\right)\n$$\nHere, $\\mathbf{u}_f$ represents the vector of velocities normal to the cell faces, $\\mathbf{f}_{\\mathrm{pred},f}$ is a face-centered approximation to the body force $\\mathbf{f}$, $G p$ is the discrete pressure gradient at the faces, and the scalar $1/\\mu$ is a constant mobility factor derived from the viscous term $\\mu \\Delta \\mathbf{u}$.\n\nThe discrete mass conservation equation for an incompressible fluid at steady state is $\\nabla \\cdot \\mathbf{u} = 0$, which is discretized at cell centers as $D \\mathbf{u}_f = 0$. Substituting the model for $\\mathbf{u}_f$ into this continuity equation yields:\n$$\nD \\left( \\frac{1}{\\mu} \\left( \\mathbf{f}_{\\mathrm{pred},f} - G p \\right) \\right) = 0\n$$\nSince the viscosity $\\mu$ is a non-zero constant, it can be factored out and eliminated. By the linearity of the divergence operator $D$, we obtain:\n$$\nD(\\mathbf{f}_{\\mathrm{pred},f}) - D(G p) = 0\n$$\nThis rearranges into the discrete Pressure Poisson Equation (PPE):\n$$\nD G p = D (\\mathbf{f}_{\\mathrm{pred},f})\n$$\nThe operator $L = DG$ constitutes a discrete Laplacian. Once the pressure field $p$ is obtained by solving this equation under the zero-mean constraint, the final face velocities are recovered by substituting $p$ back into its defining expression:\n$$\n\\mathbf{u}_f = \\frac{1}{\\mu} \\left( \\mathbf{f}_{\\mathrm{pred},f} - G p \\right)\n$$\nWe now analyze the two prescribed choices for approximating the forcing term $\\mathbf{f}_{\\mathrm{pred},f} = (G\\phi)_{\\mathrm{pred}, f}$.\n\n**Case 1: Consistent Forcing, $\\mathbf{f}_{\\mathrm{pred},f} = G \\phi$**\nThis choice uses the same discrete gradient operator $G$ for both the pressure $p$ and the potential $\\phi$. The PPE becomes:\n$$\nD G p = D (G \\phi) \\implies DG(p-\\phi) = 0\n$$\nThe solution to the homogeneous discrete Poisson equation $Lq = 0$ on a periodic domain is any constant field $q=C$. Thus, $p - \\phi = C$, which implies $p = \\phi + C$. To satisfy the zero-mean pressure constraint $\\langle p \\rangle = 0$, we require $\\langle \\phi + C \\rangle = \\langle \\phi \\rangle + C = 0$, which determines the constant as $C = -\\langle \\phi \\rangle$. The unique pressure solution is therefore $p = \\phi - \\langle \\phi \\rangle$.\nSubstituting this pressure back into the velocity formula gives:\n$$\n\\mathbf{u}_f = \\frac{1}{\\mu} \\left( G \\phi - G(\\phi - \\langle \\phi \\rangle) \\right) = \\frac{1}{\\mu} \\left( G \\phi - G \\phi + G(\\langle \\phi \\rangle) \\right)\n$$\nSince $\\langle \\phi \\rangle$ is a constant and the gradient operator $G$ annihilates constant fields, $G(\\langle \\phi \\rangle) = \\mathbf{0}$. This leads to:\n$$\n\\mathbf{u}_f = \\mathbf{0}\n$$\nThe resulting velocity is identically zero (to machine precision), irrespective of the amplitude $A$ or viscosity $\\mu$. This demonstrates that the scheme is pressure-robust; the discrete solenoidal projector perfectly annihilates the discrete gradient forcing, correctly reproducing the analytical solution $\\mathbf{u} \\equiv \\mathbf{0}$. The velocity error $e$ is expected to be near zero.\n\n**Case 2: Naive Forcing, $\\mathbf{f}_{\\mathrm{pred},f} = \\mathcal{A}(\\mathcal{G}\\phi)$**\nThis choice first computes a cell-centered gradient $\\mathcal{G}\\phi$ and then averages it to the faces using $\\mathcal{A}$. The discrete operators $\\mathcal{A}$ and $\\mathcal{G}$ are defined such that, in general, $\\mathcal{A}(\\mathcal{G}\\phi) \\neq G\\phi$. This discrepancy, a form of \"commutator error,\" breaks the structural consistency observed in Case 1. The PPE is now:\n$$\nD G p = D \\left( \\mathcal{A}(\\mathcal{G}\\phi) \\right)\n$$\nThe solution $p$ will not be a simple translation of $\\phi$. The computed velocity is:\n$$\n\\mathbf{u}_f = \\frac{1}{\\mu} \\left( \\mathcal{A}(\\mathcal{G}\\phi) - G p \\right) = \\frac{1}{\\mu} \\left( \\mathcal{A}(\\mathcal{G}\\phi) - G \\left( (DG)^{-1} D(\\mathcal{A}(\\mathcal{G}\\phi)) \\right) \\right)\n$$\nThe term $P_G = G(DG)^{-1}D$ is a projector onto the space of discrete gradients (irrotational fields). The velocity is proportional to $(\\mathbf{I} - P_G)(\\mathcal{A}(\\mathcal{G}\\phi))$, which is the projection of $\\mathcal{A}(\\mathcal{G}\\phi)$ onto the space of discretely divergence-free fields. Because $\\mathcal{A}(\\mathcal{G}\\phi)$ is not a discrete gradient in the sense of operator $G$, this projection is non-zero, resulting in a spurious velocity.\nThe magnitude of this spurious velocity scales linearly with the amplitude $A$ of the potential $\\phi$ and inversely with the viscosity $\\mu$. Consequently, the error $e$ is expected to behave as $e \\propto A/\\mu$. This implies that the scaled error $e/A$ should be independent of $A$, and the ratio of scaled errors at two different viscosities, $\\mu_1$ and $\\mu_2$, should be $(\\text{e}/A)_1 / (\\text{e}/A)_2 \\approx \\mu_2/\\mu_1$.\n\n**Implementation: FFT-based Poisson Solver**\nThe periodic PPE $DGp=S$ is solved efficiently using the Fast Fourier Transform. Applying the 2D discrete Fourier transform ($\\mathcal{F}$) to the equation yields:\n$$\n\\mathcal{F}(DGp) = \\mathcal{F}(S) \\implies \\widehat{DG}(\\mathbf{m}) \\hat{p}(\\mathbf{m}) = \\hat{S}(\\mathbf{m})\n$$\nwhere $\\hat{p}$ and $\\hat{S}$ are the transformed fields and $\\widehat{DG}(\\mathbf{m})$ is the symbol (or transfer function) of the discrete Laplacian, with $\\mathbf{m}=(m_x, m_y)$ being the discrete frequency indices. The symbol for the specified operators on a grid with spacings $\\Delta x, \\Delta y$ is:\n$$\n\\widehat{DG}(m_x, m_y) = -\\frac{4}{\\Delta x^2} \\sin^2\\left(\\frac{\\pi m_x}{N_x}\\right) - \\frac{4}{\\Delta y^2} \\sin^2\\left(\\frac{\\pi m_y}{N_y}\\right)\n$$\nThe Fourier coefficients of the pressure are found by pointwise division:\n$$\n\\hat{p}(\\mathbf{m}) = \\frac{\\hat{S}(\\mathbf{m})}{\\widehat{DG}(\\mathbf{m})} \\quad \\text{for } \\mathbf{m} \\neq \\mathbf{0}\n$$\nThe symbol $\\widehat{DG}(\\mathbf{0}) = 0$, corresponding to the null space of the operator. The zero-mean pressure constraint $\\langle p \\rangle=0$ is enforced by setting the zero-frequency component $\\hat{p}(\\mathbf{0})_ = 0$. The pressure field $p$ is then recovered by applying the inverse Fourier transform.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation and compute the required results.\n    \"\"\"\n\n    def compute_error(A, mu, choice, kx, ky, Nx, Ny):\n        \"\"\"\n        Computes the velocity error for a given set of parameters.\n\n        Args:\n            A (float): Amplitude of the potential phi.\n            mu (float): Viscosity.\n            choice (str): 'consistent' or 'naive' for the forcing term.\n            kx, ky (int): Wave numbers for the potential.\n            Nx, Ny (int): Grid dimensions.\n\n        Returns:\n            float: The computed velocity error 'e'.\n        \"\"\"\n        dx = 1.0 / Nx\n        dy = 1.0 / Ny\n\n        # Create cell-centered grid coordinates\n        x_cc = np.arange(Nx) * dx\n        y_cc = np.arange(Ny) * dy\n        XX_cc, YY_cc = np.meshgrid(x_cc, y_cc, indexing='ij')\n\n        # Define the scalar potential phi at cell centers\n        phi_cc = A * np.sin(2 * np.pi * kx * XX_cc) * np.cos(2 * np.pi * ky * YY_cc)\n\n        # --- Define discrete operators using np.roll for periodic boundaries ---\n        \n        # G: cell-center to face-center gradient\n        def G(p_cc):\n            gxp_f = (np.roll(p_cc, -1, axis=0) - p_cc) / dx\n            gyp_f = (np.roll(p_cc, -1, axis=1) - p_cc) / dy\n            return gxp_f, gyp_f\n\n        # D: face-center to cell-center divergence\n        def D(u_f):\n            ux_f, uy_f = u_f\n            div_x = (ux_f - np.roll(ux_f, 1, axis=0)) / dx\n            div_y = (uy_f - np.roll(uy_f, 1, axis=1)) / dy\n            return div_x + div_y\n\n        # G_central: cell-center central-difference gradient\n        def G_central(p_cc):\n            gx_cc = (np.roll(p_cc, -1, axis=0) - np.roll(p_cc, 1, axis=0)) / (2 * dx)\n            gy_cc = (np.roll(p_cc, -1, axis=1) - np.roll(p_cc, 1, axis=1)) / (2 * dy)\n            return gx_cc, gy_cc\n\n        # A: cell-center to face-center averaging\n        def A(f_cc):\n            fx_cc, fy_cc = f_cc\n            fx_f = (fx_cc + np.roll(fx_cc, -1, axis=0)) / 2.0\n            fy_f = (fy_cc + np.roll(fy_cc, -1, axis=1)) / 2.0\n            return fx_f, fy_f\n\n        # --- Compute forcing term and solve for pressure ---\n\n        # Two choices for the face-centered forcing term f_pred_f\n        if choice == 'consistent':\n            f_pred_f = G(phi_cc)\n            # Analytical solution for pressure: p = phi - <phi>\n            p_cc = phi_cc - np.mean(phi_cc)\n        elif choice == 'naive':\n            f_cc = G_central(phi_cc)\n            f_pred_f = A(f_cc)\n            \n            # Solve the Poisson equation DG*p = D*f_pred_f using FFT\n            S = D(f_pred_f)\n            S_hat = np.fft.fft2(S)\n            \n            # Wavenumbers for Fourier symbol\n            mx = np.fft.fftfreq(Nx) * Nx\n            my = np.fft.fftfreq(Ny) * Ny\n            MX, MY = np.meshgrid(mx, my, indexing='ij')\n\n            # Symbol of the discrete Laplacian DG\n            L_hat_x = -4.0 / (dx**2) * np.sin(np.pi * MX / Nx)**2\n            L_hat_y = -4.0 / (dy**2) * np.sin(np.pi * MY / Ny)**2\n            L_hat = L_hat_x + L_hat_y\n\n            # Solve for p in Fourier space, handling the singularity at (0,0)\n            p_hat = np.divide(S_hat, L_hat, out=np.zeros_like(S_hat), where=L_hat != 0)\n            \n            # Inverse FFT to get pressure field\n            p_cc = np.fft.ifft2(p_hat).real\n        else:\n            raise ValueError(\"Choice must be 'consistent' or 'naive'\")\n\n        # --- Compute final face velocity and error ---\n        Gp_f = G(p_cc)\n        ux_f = (1.0 / mu) * (f_pred_f[0] - Gp_f[0])\n        uy_f = (1.0 / mu) * (f_pred_f[1] - Gp_f[1])\n\n        # Compute RMS error as defined in the problem\n        error_sq = (1.0 / (Nx * Ny)) * (np.sum(ux_f**2) + np.sum(uy_f**2))\n        error = np.sqrt(error_sq)\n        \n        return error\n\n    # Test suite parameters\n    Nx, Ny = 64, 64\n    kx, ky = 3, 2\n\n    # --- Compute the 5 required quantities ---\n    results = []\n\n    # 1. Error e for consistent choice with A=10.0 and mu=0.1\n    e1 = compute_error(A=10.0, mu=0.1, choice='consistent', kx=kx, ky=ky, Nx=Nx, Ny=Ny)\n    results.append(e1)\n    \n    # 2. Error e for consistent choice with A=1000.0 and mu=0.1\n    e2 = compute_error(A=1000.0, mu=0.1, choice='consistent', kx=kx, ky=ky, Nx=Nx, Ny=Ny)\n    results.append(e2)\n\n    # 3. Scaled error e/A for naive choice with A=1.0 and mu=0.1\n    e_n1 = compute_error(A=1.0, mu=0.1, choice='naive', kx=kx, ky=ky, Nx=Nx, Ny=Ny)\n    results.append(e_n1 / 1.0)\n    \n    # 4. Scaled error e/A for naive choice with A=10.0 and mu=0.1\n    e_n2 = compute_error(A=10.0, mu=0.1, choice='naive', kx=kx, ky=ky, Nx=Nx, Ny=Ny)\n    results.append(e_n2 / 10.0)\n\n    # 5. Viscosity scaling ratio r for naive choice at fixed A=10.0\n    # Numerator is the result from #4\n    e_A_mu1 = e_n2 / 10.0\n    # Denominator\n    e_n3 = compute_error(A=10.0, mu=0.05, choice='naive', kx=kx, ky=ky, Nx=Nx, Ny=Ny)\n    e_A_mu2 = e_n3 / 10.0\n    r = e_A_mu1 / e_A_mu2\n    results.append(r)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3358724"}]}