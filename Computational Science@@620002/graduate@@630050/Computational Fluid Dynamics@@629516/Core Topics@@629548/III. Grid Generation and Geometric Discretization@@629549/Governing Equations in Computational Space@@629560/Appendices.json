{"hands_on_practices": [{"introduction": "Before tackling complex grids, it is essential to understand the fundamental geometric properties of a single transformed cell. This practice guides you through a first-principles calculation of face area vectors for a quadrilateral cell mapped from a computational square [@problem_id:3324582]. By assembling a discrete divergence operator, you will directly verify the \"metric identity,\" a discrete analogue of a fundamental vector calculus theorem that is the cornerstone of ensuring free-stream preservation in a numerical scheme.", "problem": "Consider a single two-dimensional curvilinear control volume obtained by a bilinear mapping from the computational square $[0,1] \\times [0,1]$ to a convex quadrilateral in physical space. The mapping $\\mathbf{x}(\\xi,\\eta) = \\left(x(\\xi,\\eta), y(\\xi,\\eta)\\right)$ is defined by bilinear interpolation of the four corner points\n$$\n\\mathbf{x}_{1} = (0,0),\\quad \\mathbf{x}_{2} = (2, \\tfrac{1}{2}),\\quad \\mathbf{x}_{3} = \\left(\\tfrac{11}{5}, \\tfrac{9}{5}\\right),\\quad \\mathbf{x}_{4} = \\left(-\\tfrac{2}{5}, \\tfrac{7}{5}\\right),\n$$\nattached respectively to $(\\xi,\\eta) = (0,0)$, $(\\xi,\\eta) = (1,0)$, $(\\xi,\\eta) = (1,1)$, and $(\\xi,\\eta) = (0,1)$. All quantities are nondimensional.\n\nStarting only from the integral form of conservation and basic geometric relations, do the following:\n\n1) Write the bilinear shape functions $N_{i}(\\xi,\\eta)$ for $i \\in \\{1,2,3,4\\}$ and the corresponding mapping $\\mathbf{x}(\\xi,\\eta) = \\sum_{i=1}^{4} N_{i}(\\xi,\\eta)\\,\\mathbf{x}_{i}$.\n\n2) Using the definition of the face area vector $\\mathbf{S}_{f}$ in two dimensions as the integral of the outward unit normal times the differential arc length along each face, derive from first principles an expression for $\\mathbf{S}_{f}$ in terms of the endpoints of each straight face. Compute explicitly the four face area vectors for the south, east, north, and west faces, denoted $\\mathbf{S}_{s}$, $\\mathbf{S}_{e}$, $\\mathbf{S}_{n}$, and $\\mathbf{S}_{w}$, taking the control-volume boundary in counterclockwise orientation starting at $\\mathbf{x}_{1}$ and proceeding through $\\mathbf{x}_{2}$, $\\mathbf{x}_{3}$, $\\mathbf{x}_{4}$, and back to $\\mathbf{x}_{1}$.\n\n3) For a constant vector field $\\mathbf{a} = (3,-1)^{\\top}$, assemble the finite-volume discrete divergence\n$$\n\\left(\\nabla \\cdot \\mathbf{a}\\right)_{\\text{disc}} \\equiv \\frac{1}{A} \\sum_{f \\in \\{s,e,n,w\\}} \\mathbf{a} \\cdot \\mathbf{S}_{f},\n$$\nwhere $A$ is the physical area of the mapped quadrilateral. Evaluate this discrete divergence as a single real number.\n\n4) State whether the metric identity is satisfied for this bilinear cell based on your computation and justify your conclusion briefly in terms of geometric consistency and free-stream preservation.\n\nGive the final discrete divergence as a single real number. No rounding is required and no units should be included in the final answer.", "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It presents a standard exercise in computational fluid dynamics concerning the properties of a finite-volume discretization on a mapped grid. All necessary data and definitions are provided. We may proceed with the solution.\n\nThe solution is presented in four parts as requested by the problem statement.\n\n1) Bilinear Shape Functions and Mapping\n\nFor a unit square computational domain defined by $(\\xi, \\eta) \\in [0,1] \\times [0,1]$, the bilinear shape functions $N_i(\\xi, \\eta)$ are defined such that $N_i$ is equal to $1$ at corner $i$ and $0$ at all other corners. They are given by:\n- $N_1(\\xi, \\eta) = (1-\\xi)(1-\\eta)$ for corner $1$ at $(\\xi, \\eta) = (0,0)$.\n- $N_2(\\xi, \\eta) = \\xi(1-\\eta)$ for corner $2$ at $(\\xi, \\eta) = (1,0)$.\n- $N_3(\\xi, \\eta) = \\xi\\eta$ for corner $3$ at $(\\xi, \\eta) = (1,1)$.\n- $N_4(\\xi, \\eta) = (1-\\xi)\\eta$ for corner $4$ at $(\\xi, \\eta) = (0,1)$.\n\nThe mapping from computational space $(\\xi, \\eta)$ to physical space $\\mathbf{x} = (x,y)$ is a bilinear interpolation of the four corner points $\\mathbf{x}_1, \\mathbf{x}_2, \\mathbf{x}_3, \\mathbf{x}_4$:\n$$\n\\mathbf{x}(\\xi, \\eta) = \\sum_{i=1}^{4} N_i(\\xi, \\eta) \\mathbf{x}_i\n$$\nSubstituting the shape functions, this becomes:\n$$\n\\mathbf{x}(\\xi, \\eta) = (1-\\xi)(1-\\eta)\\mathbf{x}_1 + \\xi(1-\\eta)\\mathbf{x}_2 + \\xi\\eta\\mathbf{x}_3 + (1-\\xi)\\eta\\mathbf{x}_4\n$$\nwhere the given corner coordinates are $\\mathbf{x}_{1} = (0,0)$, $\\mathbf{x}_{2} = (2, \\frac{1}{2})$, $\\mathbf{x}_{3} = (\\frac{11}{5}, \\frac{9}{5})$, and $\\mathbf{x}_{4} = (-\\frac{2}{5}, \\frac{7}{5})$.\n\n2) Face Area Vectors\n\nThe face area vector $\\mathbf{S}_f$ for a two-dimensional face $f$ is defined as the integral of the outward unit normal vector $\\mathbf{n}$ over the arc length $s$ of the face:\n$$\n\\mathbf{S}_f = \\int_{f} \\mathbf{n} \\, ds\n$$\nThe problem specifies a quadrilateral, whose faces are straight line segments. Consider a single straight face from point $\\mathbf{x}_A = (x_A, y_A)$ to $\\mathbf{x}_B = (x_B, y_B)$. The vector displacement along the face is $\\Delta\\mathbf{x} = \\mathbf{x}_B - \\mathbf{x}_A = (\\Delta x, \\Delta y)$, where $\\Delta x = x_B - x_A$ and $\\Delta y = y_B - y_A$. The length of the face is $L = |\\Delta\\mathbf{x}| = \\sqrt{(\\Delta x)^2 + (\\Delta y)^2}$.\n\nThe unit tangent vector along the face from $A$ to $B$ is $\\mathbf{t} = \\frac{\\Delta\\mathbf{x}}{L} = (\\frac{\\Delta x}{L}, \\frac{\\Delta y}{L})$. For a counterclockwise traversal of the control-volume boundary, the outward normal vector $\\mathbf{n}$ is obtained by rotating the tangent vector $\\mathbf{t}$ by $-90$ degrees. This rotation transforms a vector $(v_x, v_y)$ to $(v_y, -v_x)$. Thus, the outward unit normal vector is:\n$$\n\\mathbf{n} = \\left(\\frac{\\Delta y}{L}, -\\frac{\\Delta x}{L}\\right)\n$$\nSince the face is a straight line, the normal vector $\\mathbf{n}$ is constant along it. The integral simplifies to:\n$$\n\\mathbf{S}_f = \\mathbf{n} \\int_{f} ds = \\mathbf{n} L = \\left(\\frac{\\Delta y}{L}, -\\frac{\\Delta x}{L}\\right) L = (\\Delta y, -\\Delta x)\n$$\nSo, for a face from $\\mathbf{x}_A$ to $\\mathbf{x}_B$, $\\mathbf{S}_f = (y_B - y_A, x_A - x_B)$.\n\nWe now compute the area vectors for the four faces of the quadrilateral in counterclockwise order:\n- **South face (s)**: from $\\mathbf{x}_1 = (0,0)$ to $\\mathbf{x}_2 = (2, \\frac{1}{2})$.\n$\\Delta x = 2 - 0 = 2$, $\\Delta y = \\frac{1}{2} - 0 = \\frac{1}{2}$.\n$\\mathbf{S}_s = (\\Delta y, -\\Delta x) = (\\frac{1}{2}, -2)$.\n\n- **East face (e)**: from $\\mathbf{x}_2 = (2, \\frac{1}{2})$ to $\\mathbf{x}_3 = (\\frac{11}{5}, \\frac{9}{5})$.\n$\\Delta x = \\frac{11}{5} - 2 = \\frac{11-10}{5} = \\frac{1}{5}$, $\\Delta y = \\frac{9}{5} - \\frac{1}{2} = \\frac{18-5}{10} = \\frac{13}{10}$.\n$\\mathbf{S}_e = (\\Delta y, -\\Delta x) = (\\frac{13}{10}, -\\frac{1}{5})$.\n\n- **North face (n)**: from $\\mathbf{x}_3 = (\\frac{11}{5}, \\frac{9}{5})$ to $\\mathbf{x}_4 = (-\\frac{2}{5}, \\frac{7}{5})$.\n$\\Delta x = -\\frac{2}{5} - \\frac{11}{5} = -\\frac{13}{5}$, $\\Delta y = \\frac{7}{5} - \\frac{9}{5} = -\\frac{2}{5}$.\n$\\mathbf{S}_n = (\\Delta y, -\\Delta x) = (-\\frac{2}{5}, -(-\\frac{13}{5})) = (-\\frac{2}{5}, \\frac{13}{5})$.\n\n- **West face (w)**: from $\\mathbf{x}_4 = (-\\frac{2}{5}, \\frac{7}{5})$ to $\\mathbf{x}_1 = (0,0)$.\n$\\Delta x = 0 - (-\\frac{2}{5}) = \\frac{2}{5}$, $\\Delta y = 0 - \\frac{7}{5} = -\\frac{7}{5}$.\n$\\mathbf{S}_w = (\\Delta y, -\\Delta x) = (-\\frac{7}{5}, -\\frac{2}{5})$.\n\n3) Discrete Divergence Evaluation\n\nThe discrete divergence for a constant vector field $\\mathbf{a}$ is given by:\n$$\n(\\nabla \\cdot \\mathbf{a})_{\\text{disc}} = \\frac{1}{A} \\sum_{f \\in \\{s,e,n,w\\}} \\mathbf{a} \\cdot \\mathbf{S}_{f}\n$$\nwhere $A$ is the area of the quadrilateral. The given constant vector field is $\\mathbf{a} = (3, -1)^{\\top}$. We compute the sum of the dot products:\n- $\\mathbf{a} \\cdot \\mathbf{S}_s = (3, -1) \\cdot (\\frac{1}{2}, -2) = 3(\\frac{1}{2}) + (-1)(-2) = \\frac{3}{2} + 2 = \\frac{7}{2}$.\n- $\\mathbf{a} \\cdot \\mathbf{S}_e = (3, -1) \\cdot (\\frac{13}{10}, -\\frac{1}{5}) = 3(\\frac{13}{10}) + (-1)(-\\frac{1}{5}) = \\frac{39}{10} + \\frac{1}{5} = \\frac{39}{10} + \\frac{2}{10} = \\frac{41}{10}$.\n- $\\mathbf{a} \\cdot \\mathbf{S}_n = (3, -1) \\cdot (-\\frac{2}{5}, \\frac{13}{5}) = 3(-\\frac{2}{5}) + (-1)(\\frac{13}{5}) = -\\frac{6}{5} - \\frac{13}{5} = -\\frac{19}{5}$.\n- $\\mathbf{a} \\cdot \\mathbf{S}_w = (3, -1) \\cdot (-\\frac{7}{5}, -\\frac{2}{5}) = 3(-\\frac{7}{5}) + (-1)(-\\frac{2}{5}) = -\\frac{21}{5} + \\frac{2}{5} = -\\frac{19}{5}$.\n\nThe sum is:\n$$\n\\sum_{f} \\mathbf{a} \\cdot \\mathbf{S}_{f} = \\frac{7}{2} + \\frac{41}{10} - \\frac{19}{5} - \\frac{19}{5} = \\frac{35}{10} + \\frac{41}{10} - \\frac{38}{10} - \\frac{38}{10} = \\frac{76 - 76}{10} = 0\n$$\nSince the sum is $0$, the discrete divergence is:\n$$\n(\\nabla \\cdot \\mathbf{a})_{\\text{disc}} = \\frac{1}{A} (0) = 0\n$$\nThe value of the area $A$ is not needed to determine the final result. The discrete divergence is exactly $0$.\n\n4) Metric Identity and Justification\n\nThe metric identity for a closed control volume requires that the sum of all face area vectors is the zero vector:\n$$\n\\sum_{f} \\mathbf{S}_{f} = \\mathbf{0}\n$$\nLet's verify this condition with the vectors computed in Part 2.\nSum of x-components:\n$$\n\\sum_{f} S_{f,x} = \\frac{1}{2} + \\frac{13}{10} - \\frac{2}{5} - \\frac{7}{5} = \\frac{5}{10} + \\frac{13}{10} - \\frac{4}{10} - \\frac{14}{10} = \\frac{5 + 13 - 4 - 14}{10} = \\frac{18 - 18}{10} = 0\n$$\nSum of y-components:\n$$\n\\sum_{f} S_{f,y} = -2 - \\frac{1}{5} + \\frac{13}{5} - \\frac{2}{5} = -\\frac{10}{5} - \\frac{1}{5} + \\frac{13}{5} - \\frac{2}{5} = \\frac{-10 - 1 + 13 - 2}{5} = \\frac{-13 + 13}{5} = 0\n$$\nSince both components of the sum are zero, we have $\\sum_{f} \\mathbf{S}_{f} = (0,0) = \\mathbf{0}$. The metric identity is satisfied for this bilinear cell.\n\nJustification: The satisfaction of the metric identity is a direct consequence of the faces forming a closed loop. It is the discrete analogue of the geometric identity $\\oint_{\\partial V} \\mathbf{n} \\, dS = \\mathbf{0}$. This property ensures geometric consistency and is crucial for achieving **free-stream preservation**. For any constant vector field $\\mathbf{a}$, the continuous divergence is $\\nabla \\cdot \\mathbf{a} = 0$. A numerical scheme preserves the free-stream if its discrete divergence operator also yields zero for any constant field. For the given finite-volume discretization, we can write:\n$$\n(\\nabla \\cdot \\mathbf{a})_{\\text{disc}} = \\frac{1}{A} \\sum_{f} \\mathbf{a} \\cdot \\mathbf{S}_{f} = \\frac{1}{A} \\left( \\mathbf{a} \\cdot \\sum_{f} \\mathbf{S}_{f} \\right)\n$$\nSince the metric identity $\\sum_{f} \\mathbf{S}_{f} = \\mathbf{0}$ is satisfied, it follows that $(\\nabla \\cdot \\mathbf{a})_{\\text{disc}} = \\frac{1}{A} (\\mathbf{a} \\cdot \\mathbf{0}) = 0$ for *any* constant vector $\\mathbf{a}$. The result of $0$ computed in Part 3 for the specific vector $\\mathbf{a} = (3,-1)^{\\top}$ is a confirmation of this general principle. This property is satisfied because the control volume is defined by straight-line segments connecting the vertices, forming a closed polygon.\n\nThe final answer required is the numerical value of the discrete divergence. As calculated in Part 3, this value is $0$.", "answer": "$$\n\\boxed{0}\n$$", "id": "3324582"}, {"introduction": "The transformation from physical to computational space is not merely a geometric exercise; it has profound consequences for the stability and efficiency of a simulation. This exercise demonstrates this link by analyzing the Courant–Friedrichs–Lewy (CFL) condition for an advection equation on a stretched grid [@problem_id:3324584]. You will derive how grid mapping metrics directly influence the advection speeds in computational space and, consequently, determine the maximum allowable time step $ \\Delta t $ for an explicit numerical method.", "problem": "Consider three-dimensional advection of a passive scalar field in Computational Fluid Dynamics (CFD), governed in physical space by the conservation law $ \\frac{\\partial q}{\\partial t} + \\nabla \\cdot (\\boldsymbol{U} q) = 0 $, where $ q(\\boldsymbol{x}, t) $ is the scalar and $ \\boldsymbol{U} = (u, v, w) $ is a prescribed velocity field. The physical domain $ [0, L_x] \\times [0, L_y] \\times [0, L_z] $ is mapped from the computational domain $ [0, 1]^3 $ using the one-to-one differentiable mapping $ x(\\xi) = L_x \\frac{\\exp(\\alpha_x \\xi) - 1}{\\exp(\\alpha_x) - 1} $, $ y(\\eta) = L_y \\frac{\\exp(\\alpha_y \\eta) - 1}{\\exp(\\alpha_y) - 1} $, and $ z(\\zeta) = L_z \\zeta $, with $ \\xi, \\eta, \\zeta \\in [0, 1] $. The computational grid is structured and uniform with spacings $ \\Delta \\xi = \\frac{1}{N_{\\xi}} $, $ \\Delta \\eta = \\frac{1}{N_{\\eta}} $, and $ \\Delta \\zeta = \\frac{1}{N_{\\zeta}} $. The flow state is constant with $ \\boldsymbol{U} = (U_0, V_0, W_0) $. The numerical method is an explicit forward Euler time integrator combined with a first-order upwind discretization of the mapped advection equation in computational space. Starting from the governing conservation law and the mapping, derive the stability bound on the time step $ \\Delta t $ based on the Courant–Friedrichs–Lewy (CFL) condition in computational space, and then compute the maximum stable $ \\Delta t $ for the following parameters:\n$ L_x = 2\\,\\mathrm{m} $, $ L_y = 1\\,\\mathrm{m} $, $ L_z = 0.5\\,\\mathrm{m} $, $ \\alpha_x = 3 $, $ \\alpha_y = 2 $, $ U_0 = 30\\,\\mathrm{m/s} $, $ V_0 = 10\\,\\mathrm{m/s} $, $ W_0 = 5\\,\\mathrm{m/s} $, $ N_{\\xi} = 80 $, $ N_{\\eta} = 60 $, and $ N_{\\zeta} = 40 $. Express the final $ \\Delta t_{\\max} $ in seconds, and round your answer to four significant figures. Additionally, in your derivation, explain how the grid stretching, quantified by $ f'(\\xi) $, $ g'(\\eta) $, and $ h'(\\zeta) $, affects the stability bound in computational space.", "solution": "The problem is valid as it is scientifically grounded in the principles of computational fluid dynamics, well-posed with a complete and consistent set of data, and stated in objective, formal language. We proceed with the solution.\n\nThe governing equation for the advection of a passive scalar $q$ in physical space $(x, y, z)$ is given by the conservation law:\n$$\n\\frac{\\partial q}{\\partial t} + \\nabla \\cdot (\\boldsymbol{U} q) = 0\n$$\nGiven that the velocity field $\\boldsymbol{U} = (U_0, V_0, W_0)$ is constant, the equation simplifies to the non-conservative form:\n$$\n\\frac{\\partial q}{\\partial t} + U_0 \\frac{\\partial q}{\\partial x} + V_0 \\frac{\\partial q}{\\partial y} + W_0 \\frac{\\partial q}{\\partial z} = 0\n$$\nThe problem requires transforming this equation from physical space $(x, y, z)$ to computational space $(\\xi, \\eta, \\zeta)$. The grid is stationary, so time is not transformed, i.e., $t = \\tau$. The coordinate transformation is given by:\n$x(\\xi) = L_x \\frac{\\exp(\\alpha_x \\xi) - 1}{\\exp(\\alpha_x) - 1}$\n$y(\\eta) = L_y \\frac{\\exp(\\alpha_y \\eta) - 1}{\\exp(\\alpha_y) - 1}$\n$z(\\zeta) = L_z \\zeta$\n\nThis is a one-dimensional stretching, where $x$ depends only on $\\xi$, $y$ only on $\\eta$, and $z$ only on $\\zeta$. We apply the chain rule for partial derivatives:\n$\\frac{\\partial q}{\\partial x} = \\frac{d\\xi}{dx} \\frac{\\partial q}{\\partial \\xi} = \\left(\\frac{dx}{d\\xi}\\right)^{-1} \\frac{\\partial q}{\\partial \\xi}$\n$\\frac{\\partial q}{\\partial y} = \\frac{d\\eta}{dy} \\frac{\\partial q}{\\partial \\eta} = \\left(\\frac{dy}{d\\eta}\\right)^{-1} \\frac{\\partial q}{\\partial \\eta}$\n$\\frac{\\partial q}{\\partial z} = \\frac{d\\zeta}{dz} \\frac{\\partial q}{\\partial \\zeta} = \\left(\\frac{dz}{d\\zeta}\\right)^{-1} \\frac{\\partial q}{\\partial \\zeta}$\n\nWe compute the transformation metrics (the derivatives of the mapping functions):\n$\\frac{dx}{d\\xi} = x'(\\xi) = L_x \\frac{\\alpha_x \\exp(\\alpha_x \\xi)}{\\exp(\\alpha_x) - 1}$\n$\\frac{dy}{d\\eta} = y'(\\eta) = L_y \\frac{\\alpha_y \\exp(\\alpha_y \\eta)}{\\exp(\\alpha_y) - 1}$\n$\\frac{dz}{d\\zeta} = z'(\\zeta) = L_z$\n\nSubstituting these into the advection equation yields the governing equation in computational space:\n$$\n\\frac{\\partial q}{\\partial t} + \\frac{U_0}{x'(\\xi)} \\frac{\\partial q}{\\partial \\xi} + \\frac{V_0}{y'(\\eta)} \\frac{\\partial q}{\\partial \\eta} + \\frac{W_0}{z'(\\zeta)} \\frac{\\partial q}{\\partial \\zeta} = 0\n$$\nThis is an advection equation with spatially varying advection speeds in computational space:\n$U_{comp}(\\xi) = \\frac{U_0}{x'(\\xi)}$, $V_{comp}(\\eta) = \\frac{V_0}{y'(\\eta)}$, and $W_{comp} = \\frac{W_0}{z'(\\zeta)} = \\frac{W_0}{L_z}$.\n\nThe numerical scheme is an explicit forward Euler in time and first-order upwind in space. Let $q_{i,j,k}^n$ denote the numerical approximation of $q$ at computational coordinates $(i\\Delta\\xi, j\\Delta\\eta, k\\Delta\\zeta)$ and time $n\\Delta t$. Given $U_0, V_0, W_0 > 0$ and noting that the metric terms $x'(\\xi)$, $y'(\\eta)$, and $z'(\\zeta)$ are also positive for the given parameters, the computational velocities $U_{comp}$, $V_{comp}$, $W_{comp}$ are all positive. The first-order upwind scheme for positive velocities uses backward differences. The discretized equation is:\n$$\n\\frac{q_{i,j,k}^{n+1} - q_{i,j,k}^n}{\\Delta t} + U_{comp,i} \\left( \\frac{q_{i,j,k}^n - q_{i-1,j,k}^n}{\\Delta \\xi} \\right) + V_{comp,j} \\left( \\frac{q_{i,j,k}^n - q_{i,j-1,k}^n}{\\Delta \\eta} \\right) + W_{comp,k} \\left( \\frac{q_{i,j,k}^n - q_{i,j,k-1}^n}{\\Delta \\zeta} \\right) = 0\n$$\nwhere $U_{comp,i} = U_{comp}(i\\Delta\\xi)$, $V_{comp,j} = V_{comp}(j\\Delta\\eta)$, and $W_{comp,k}$ is constant.\n\nFor stability of this explicit scheme, the Courant-Friedrichs-Lewy (CFL) condition must be satisfied. Rearranging the equation for $q_{i,j,k}^{n+1}$:\n$$ q_{i,j,k}^{n+1} = \\left(1 - \\frac{U_{comp,i}\\Delta t}{\\Delta \\xi} - \\frac{V_{comp,j}\\Delta t}{\\Delta \\eta} - \\frac{W_{comp,k}\\Delta t}{\\Delta \\zeta}\\right) q_{i,j,k}^n + \\frac{U_{comp,i}\\Delta t}{\\Delta \\xi} q_{i-1,j,k}^n + \\frac{V_{comp,j}\\Delta t}{\\Delta \\eta} q_{i,j-1,k}^n + \\frac{W_{comp,k}\\Delta t}{\\Delta \\zeta} q_{i,j,k-1}^n $$\nA sufficient condition for stability (based on positivity) is that all coefficients of the $q^n$ terms on the right-hand side are non-negative. This leads to the condition:\n$$\n1 - \\frac{U_{comp,i}\\Delta t}{\\Delta \\xi} - \\frac{V_{comp,j}\\Delta t}{\\Delta \\eta} - \\frac{W_{comp,k}\\Delta t}{\\Delta \\zeta} \\ge 0\n$$\n$$\n\\frac{|U_{comp,i}|\\Delta t}{\\Delta \\xi} + \\frac{|V_{comp,j}|\\Delta t}{\\Delta \\eta} + \\frac{|W_{comp,k}|\\Delta t}{\\Delta \\zeta} \\le 1\n$$\nwhere absolute values are used for generality. This must hold for all grid points $(i, j, k)$. The most restrictive condition on the time step $\\Delta t$ occurs where the sum of Courant numbers is maximal.\n$$\n\\Delta t \\le \\frac{1}{\\max_{\\xi,\\eta,\\zeta} \\left( \\frac{|U_{comp}(\\xi)|}{\\Delta \\xi} + \\frac{|V_{comp}(\\eta)|}{\\Delta \\eta} + \\frac{|W_{comp}|}{\\Delta \\zeta} \\right)}\n$$\nThe maximum stable time step $\\Delta t_{\\max}$ is therefore:\n$$\n\\Delta t_{\\max} = \\frac{1}{\\frac{\\max|U_{comp}|}{\\Delta \\xi} + \\frac{\\max|V_{comp}|}{\\Delta \\eta} + \\frac{|W_{comp}|}{\\Delta \\zeta}}\n$$\nThe problem asks to explain the effect of grid stretching. The stretching factors are $x'(\\xi)$, $y'(\\eta)$, and $z'(\\zeta)$, which represent the ratio of physical grid spacing to computational grid spacing (e.g., $\\Delta x \\approx x'(\\xi) \\Delta \\xi$). The computational advection speeds are inversely proportional to these stretching factors, e.g., $U_{comp} = U_0/x'(\\xi)$. The stability limit is determined by the largest computational speeds. These occur where the stretching factors are smallest, which corresponds to the regions of the finest physical grid.\n\nWe must find the maximum values of the computational velocities.\nSince $\\alpha_x = 3 > 0$ and $\\alpha_y = 2 > 0$, the functions $\\exp(\\alpha_x \\xi)$ and $\\exp(\\alpha_y \\eta)$ are monotonically increasing. Consequently, $x'(\\xi)$ and $y'(\\eta)$ are also monotonically increasing. Their minimum values occur at $\\xi=0$ and $\\eta=0$ respectively. This is where the physical grid is finest.\n$\\min x'(\\xi) = x'(0) = L_x \\frac{\\alpha_x \\exp(0)}{\\exp(\\alpha_x) - 1} = \\frac{L_x \\alpha_x}{\\exp(\\alpha_x) - 1}$\n$\\min y'(\\eta) = y'(0) = L_y \\frac{\\alpha_y \\exp(0)}{\\exp(\\alpha_y) - 1} = \\frac{L_y \\alpha_y}{\\exp(\\alpha_y) - 1}$\nThe metric $z' = L_z$ is constant.\n\nThe maximum computational velocities are:\n$\\max|U_{comp}| = \\frac{|U_0|}{\\min x'(\\xi)} = \\frac{U_0(\\exp(\\alpha_x)-1)}{L_x \\alpha_x}$\n$\\max|V_{comp}| = \\frac{|V_0|}{\\min y'(\\eta)} = \\frac{V_0(\\exp(\\alpha_y)-1)}{L_y \\alpha_y}$\n$|W_{comp}| = \\frac{|W_0|}{L_z}$\n\nNow we substitute the given numerical values:\n$L_x = 2\\,\\mathrm{m}$, $L_y = 1\\,\\mathrm{m}$, $L_z = 0.5\\,\\mathrm{m}$\n$\\alpha_x = 3$, $\\alpha_y = 2$\n$U_0 = 30\\,\\mathrm{m/s}$, $V_0 = 10\\,\\mathrm{m/s}$, $W_0 = 5\\,\\mathrm{m/s}$\n$N_{\\xi} = 80 \\implies \\Delta \\xi = \\frac{1}{80}$\n$N_{\\eta} = 60 \\implies \\Delta \\eta = \\frac{1}{60}$\n$N_{\\zeta} = 40 \\implies \\Delta \\zeta = \\frac{1}{40}$\n\nThe denominator of the $\\Delta t_{\\max}$ expression is comprised of three terms:\nTerm 1: $\\frac{\\max|U_{comp}|}{\\Delta \\xi} = \\frac{U_0 (\\exp(\\alpha_x)-1)}{L_x \\alpha_x \\Delta \\xi} = \\frac{30 \\cdot (\\exp(3)-1)}{2 \\cdot 3 \\cdot (1/80)} = \\frac{30 \\cdot 80 \\cdot (\\exp(3)-1)}{6} = 400(\\exp(3)-1)$\nTerm 2: $\\frac{\\max|V_{comp}|}{\\Delta \\eta} = \\frac{V_0 (\\exp(\\alpha_y)-1)}{L_y \\alpha_y \\Delta \\eta} = \\frac{10 \\cdot (\\exp(2)-1)}{1 \\cdot 2 \\cdot (1/60)} = \\frac{10 \\cdot 60 \\cdot (\\exp(2)-1)}{2} = 300(\\exp(2)-1)$\nTerm 3: $\\frac{|W_{comp}|}{\\Delta \\zeta} = \\frac{W_0}{L_z \\Delta \\zeta} = \\frac{5}{0.5 \\cdot (1/40)} = \\frac{5 \\cdot 40}{0.5} = 400$\n\nNow, we compute the numerical values of these terms:\nTerm 1: $400(\\exp(3)-1) \\approx 400(20.085537 - 1) = 400(19.085537) \\approx 7634.2148$\nTerm 2: $300(\\exp(2)-1) \\approx 300(7.389056 - 1) = 300(6.389056) \\approx 1916.7168$\nTerm 3: $400$\n\nThe sum of the terms in the denominator is:\n$S = 7634.2148 + 1916.7168 + 400 = 9950.9316$\n\nFinally, we calculate the maximum stable time step:\n$\\Delta t_{\\max} = \\frac{1}{S} = \\frac{1}{9950.9316} \\approx 0.0001004931\\,\\mathrm{s}$\n\nRounding the result to four significant figures gives:\n$\\Delta t_{\\max} \\approx 0.0001005\\,\\mathrm{s}$", "answer": "$$\n\\boxed{0.0001005}\n$$", "id": "3324584"}, {"introduction": "Moving from a single cell to a complete grid requires robust methods for computing metrics that maintain geometric consistency everywhere. This practice contrasts two common strategies for calculating grid metrics and evaluates their performance on a crucial test: free-stream preservation [@problem_id:3324596]. Through a hands-on coding implementation, you will discover why a \"geometrically conservative\" approach is vital for preventing spurious numerical sources and ensuring the physical fidelity of the simulation, a critical lesson for any CFD code developer.", "problem": "You are to write a complete, runnable program that compares two discrete strategies for computing grid metrics for governing equations in computational space and quantifies their impact on free-stream preservation for a scalar conservation law. The objective is to implement both strategies on a set of smoothly deformed periodic mappings from a computational square to a physical plane and to evaluate the residual of a constant free stream when discretized using a consistent finite-volume divergence in computational space. Your implementation must strictly follow the definitions and discretizations stated below, and your final program must produce a single line of output containing results for all test cases in the specified format.\n\nConsider a smooth, invertible mapping from computational coordinates $\\left(\\xi,\\eta\\right)\\in [0,1]\\times[0,1]$ to physical coordinates $\\left(x,y\\right)$ given by the vector function $\\mathbf{r}\\left(\\xi,\\eta\\right)=\\left(x\\left(\\xi,\\eta\\right),y\\left(\\xi,\\eta\\right)\\right)$. Denote the Jacobian by $J=\\det\\left(\\partial\\mathbf{r}/\\partial\\left(\\xi,\\eta\\right)\\right)$ and the contravariant metric vectors by $\\mathbf{a}^{\\xi}$ and $\\mathbf{a}^{\\eta}$ so that the conservation of a scalar field $q$ with physical velocity $\\mathbf{u}=\\left(u,v\\right)$ in computational space assumes the conservative form\n$$\n\\frac{\\partial\\left(J q\\right)}{\\partial t}+\\frac{\\partial}{\\partial \\xi}\\left(J\\left(\\mathbf{a}^{\\xi}\\cdot\\mathbf{u}\\right)q\\right)+\\frac{\\partial}{\\partial \\eta}\\left(J\\left(\\mathbf{a}^{\\eta}\\cdot\\mathbf{u}\\right)q\\right)=0.\n$$\nFor a constant free stream with constant $q$ and constant $\\mathbf{u}$, the continuous residual reduces to\n$$\n\\mathcal{R}=\\frac{\\partial}{\\partial \\xi}\\left(J\\left(\\mathbf{a}^{\\xi}\\cdot\\mathbf{u}\\right)\\right)+\\frac{\\partial}{\\partial \\eta}\\left(J\\left(\\mathbf{a}^{\\eta}\\cdot\\mathbf{u}\\right)\\right)=\\mathbf{u}\\cdot\\left(\\frac{\\partial\\left(J\\mathbf{a}^{\\xi}\\right)}{\\partial \\xi}+\\frac{\\partial\\left(J\\mathbf{a}^{\\eta}\\right)}{\\partial \\eta}\\right),\n$$\nwhich vanishes identically if the metric identity\n$$\n\\frac{\\partial\\left(J\\mathbf{a}^{\\xi}\\right)}{\\partial \\xi}+\\frac{\\partial\\left(J\\mathbf{a}^{\\eta}\\right)}{\\partial \\eta}=\\mathbf{0}\n$$\nholds. In discrete form, failure to satisfy the metric identity with the same discrete operators used in flux divergences leads to spurious source terms that violate free-stream preservation. You must implement and compare two discrete metric strategies:\n\n- Strategy $\\mathrm{D}$ (differentiate the mapping, average to faces): compute discrete partial derivatives of $x$ and $y$ at cell centers using second-order centered differences with periodic boundaries; form the nodal approximations of $J\\mathbf{a}^{\\xi}$ and $J\\mathbf{a}^{\\eta}$ at cell centers using the two-dimensional analog of the cross-product formulas; then obtain face metric vectors by arithmetic averages of adjacent cell-centered values and scale by the appropriate computational mesh spacing.\n\n- Strategy $\\mathrm{C}$ (cross products of covariant edges on faces): construct face metric vectors directly as discrete integral geometry objects from half-indexed averages of nodal coordinates on cell corners, using differences of these half-indexed positions to form conservative face metric vectors that telescope in the discrete divergence.\n\nDiscrete setting and operators to be used:\n\n- Use a uniform periodic computational grid with $N_{\\xi}$ cells in the $\\xi$ direction and $N_{\\eta}$ cells in the $\\eta$ direction, with spacings $\\Delta \\xi=1/N_{\\xi}$ and $\\Delta \\eta=1/N_{\\eta}$.\n\n- Define node coordinates $\\left(\\xi_{i},\\eta_{j}\\right)$ at integer indices $i\\in\\{0,\\dots,N_{\\xi}-1\\}$ and $j\\in\\{0,\\dots,N_{\\eta}-1\\}$ by $\\xi_{i}=i\\Delta \\xi$ and $\\eta_{j}=j\\Delta \\eta$, with periodic indexing modulo $N_{\\xi}$ and $N_{\\eta}$.\n\n- Define cell centers at $\\left(\\xi_{i+1/2},\\eta_{j+1/2}\\right)=\\left(\\left(i+\\tfrac{1}{2}\\right)\\Delta \\xi,\\left(j+\\tfrac{1}{2}\\right)\\Delta \\eta\\right)$, with $i\\in\\{0,\\dots,N_{\\xi}-1\\}$ and $j\\in\\{0,\\dots,N_{\\eta}-1\\}$.\n\n- Use the following smooth periodic mapping family parametrized by amplitudes $\\alpha$, $\\beta$ and integer frequencies $m,n,p,q$:\n$$\nx\\left(\\xi,\\eta\\right)=\\xi+\\alpha \\sin\\left(2\\pi m \\xi\\right)\\sin\\left(2\\pi n \\eta\\right),\\quad\ny\\left(\\xi,\\eta\\right)=\\eta+\\beta \\sin\\left(2\\pi p \\xi\\right)\\sin\\left(2\\pi q \\eta\\right).\n$$\n\n- Strategy $\\mathrm{D}$ details:\n  - Compute $x$ and $y$ at cell centers $\\left(x_{c},y_{c}\\right)$ by evaluating the mapping at $\\left(\\xi_{i+1/2},\\eta_{j+1/2}\\right)$.\n  - Compute the centered finite differences at cell centers with periodic wrap:\n    $$\n    x_{\\xi}\\approx \\frac{x_{c}\\left(i+1,j\\right)-x_{c}\\left(i-1,j\\right)}{2\\Delta \\xi},\\quad\n    x_{\\eta}\\approx \\frac{x_{c}\\left(i,j+1\\right)-x_{c}\\left(i,j-1\\right)}{2\\Delta \\eta},\n    $$\n    and analogously for $y_{\\xi}$ and $y_{\\eta}$.\n  - Form at cell centers the vectors $J\\mathbf{a}^{\\xi}=\\left(y_{\\eta},-x_{\\eta}\\right)$ and $J\\mathbf{a}^{\\eta}=\\left(-y_{\\xi},x_{\\xi}\\right)$.\n  - Produce face metric vectors by arithmetic averaging of adjacent cell-centered values and scaling by the face computational lengths:\n    $$\n    \\mathbf{S}_{\\xi}^{\\mathrm{D}}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)=\\Delta \\eta\\,\\frac{\\left(J\\mathbf{a}^{\\xi}\\right)\\left(i,j\\right)+\\left(J\\mathbf{a}^{\\xi}\\right)\\left(i+1,j\\right)}{2},\n    $$\n    $$\n    \\mathbf{S}_{\\eta}^{\\mathrm{D}}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)=\\Delta \\xi\\,\\frac{\\left(J\\mathbf{a}^{\\eta}\\right)\\left(i,j\\right)+\\left(J\\mathbf{a}^{\\eta}\\right)\\left(i,j+1\\right)}{2},\n    $$\n    where $\\mathbf{S}_{\\xi}$ lives on $\\xi$-faces at $\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)$ and $\\mathbf{S}_{\\eta}$ lives on $\\eta$-faces at $\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)$ of cell $\\left(i,j\\right)$.\n\n- Strategy $\\mathrm{C}$ details:\n  - Compute nodal coordinates $\\left(x_{n},y_{n}\\right)$ by evaluating the mapping at grid nodes $\\left(\\xi_{i},\\eta_{j}\\right)$.\n  - Compute half-indexed averages at positions $\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)$ by averaging the four surrounding nodal values:\n    $$\n    x_{h}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)=\\frac{x_{n}\\left(i,j\\right)+x_{n}\\left(i+1,j\\right)+x_{n}\\left(i,j+1\\right)+x_{n}\\left(i+1,j+1\\right)}{4},\n    $$\n    and similarly for $y_{h}$, with periodic wrap on indices.\n  - Form conservative face metric vectors via rotated differences of these half-indexed positions:\n    $$\n    \\mathbf{S}_{\\xi}^{\\mathrm{C}}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)=\\left(y_{h}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)-y_{h}\\left(i+\\tfrac{1}{2},j-\\tfrac{1}{2}\\right),\\,-\\left(x_{h}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)-x_{h}\\left(i+\\tfrac{1}{2},j-\\tfrac{1}{2}\\right)\\right)\\right),\n    $$\n    $$\n    \\mathbf{S}_{\\eta}^{\\mathrm{C}}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)=\\left(-\\left(y_{h}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)-y_{h}\\left(i-\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)\\right),\\,\\left(x_{h}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)-x_{h}\\left(i-\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)\\right)\\right).\n    $$\n    This construction is conservative and yields a discrete telescoping identity for the face metric vectors.\n\nDiscrete divergence and free-stream residual:\n\n- For either strategy $\\mathrm{S}\\in\\{\\mathrm{D},\\mathrm{C}\\}$, define face fluxes for constant $q$ and constant $\\mathbf{u}=\\left(u,v\\right)$ as\n$$\nF_{\\xi}^{\\mathrm{S}}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)=q\\,\\mathbf{u}\\cdot \\mathbf{S}_{\\xi}^{\\mathrm{S}}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right),\\quad\nF_{\\eta}^{\\mathrm{S}}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)=q\\,\\mathbf{u}\\cdot \\mathbf{S}_{\\eta}^{\\mathrm{S}}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right).\n$$\n\n- The cell-centered discrete residual for cell $\\left(i,j\\right)$ is\n$$\n\\mathcal{R}^{\\mathrm{S}}\\left(i,j\\right)=F_{\\xi}^{\\mathrm{S}}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)-F_{\\xi}^{\\mathrm{S}}\\left(i-\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)+F_{\\eta}^{\\mathrm{S}}\\left(i+\\tfrac{1}{2},j+\\tfrac{1}{2}\\right)-F_{\\eta}^{\\mathrm{S}}\\left(i+\\tfrac{1}{2},j-\\tfrac{1}{2}\\right),\n$$\nwith periodic wrap. This residual must be zero for perfect free-stream preservation.\n\n- Report the normalized root-mean-square residual\n$$\nE^{\\mathrm{S}}=\\frac{\\sqrt{\\frac{1}{N_{\\xi}N_{\\eta}}\\sum_{i=0}^{N_{\\xi}-1}\\sum_{j=0}^{N_{\\eta}-1}\\left(\\mathcal{R}^{\\mathrm{S}}\\left(i,j\\right)\\right)^{2}}}{|q|\\,\\sqrt{u^{2}+v^{2}}}.\n$$\n\nTest suite:\n\nYour program must implement the above and evaluate $E^{\\mathrm{D}}$ and $E^{\\mathrm{C}}$ for the following four test cases, each defined by $\\left(N_{\\xi},N_{\\eta},\\alpha,\\beta,m,n,p,q,u,v,q_{0}\\right)$:\n\n- Case $1$: $\\left(N_{\\xi},N_{\\eta}\\right)=\\left(48,48\\right)$, $\\alpha=0.15$, $\\beta=-0.17$, $m=1$, $n=1$, $p=1$, $q=2$, $u=0.9$, $v=-0.6$, $q_{0}=2.0$.\n\n- Case $2$: $\\left(N_{\\xi},N_{\\eta}\\right)=\\left(16,16\\right)$, $\\alpha=0.3$, $\\beta=0.2$, $m=2$, $n=1$, $p=1$, $q=2$, $u=1.0$, $v=0.0$, $q_{0}=1.0$.\n\n- Case $3$: $\\left(N_{\\xi},N_{\\eta}\\right)=\\left(32,32\\right)$, $\\alpha=0.0$, $\\beta=0.0$, $m=1$, $n=1$, $p=1$, $q=1$, $u=1.0$, $v=1.0$, $q_{0}=1.0$.\n\n- Case $4$: $\\left(N_{\\xi},N_{\\eta}\\right)=\\left(24,24\\right)$, $\\alpha=0.12$, $\\beta=0.25$, $m=2$, $n=3$, $p=3$, $q=2$, $u=0.7$, $v=1.3$, $q_{0}=0.5$.\n\nFinal output format:\n\n- Your program should produce a single line of output containing the list of results as a comma-separated list of per-case pairs in square brackets. Each pair is the two-element list $\\left[E^{\\mathrm{D}},E^{\\mathrm{C}}\\right]$ for the corresponding case. The final format must be\n$$\n\\left[\\left[E^{\\mathrm{D}}_{1},E^{\\mathrm{C}}_{1}\\right],\\left[E^{\\mathrm{D}}_{2},E^{\\mathrm{C}}_{2}\\right],\\left[E^{\\mathrm{D}}_{3},E^{\\mathrm{C}}_{3}\\right],\\left[E^{\\mathrm{D}}_{4},E^{\\mathrm{C}}_{4}\\right]\\right],\n$$\nwith numeric values printed in standard floating-point notation.", "solution": "The user has provided a problem from the field of computational fluid dynamics (CFD), specifically concerning the numerical verification of free-stream preservation on a transformed grid. The problem is a standard exercise in verifying the properties of different numerical schemes for calculating grid metrics.\n\n### Step 1: Problem Validation\n\nThe problem statement has been meticulously reviewed according to the specified criteria.\n\n- **Extracted Givens**: All parameters, equations, and numerical schemes are explicitly defined.\n    - Governing equation for a scalar $q$ in computational space: $\\frac{\\partial\\left(J q\\right)}{\\partial t}+\\frac{\\partial}{\\partial \\xi}\\left(J\\left(\\mathbf{a}^{\\xi}\\cdot\\mathbf{u}\\right)q\\right)+\\frac{\\partial}{\\partial \\eta}\\left(J\\left(\\mathbf{a}^{\\eta}\\cdot\\mathbf{u}\\right)q\\right)=0$.\n    - Coordinate mapping: $x\\left(\\xi,\\eta\\right)=\\xi+\\alpha \\sin\\left(2\\pi m \\xi\\right)\\sin\\left(2\\pi n \\eta\\right)$, $y\\left(\\xi,\\eta\\right)=\\eta+\\beta \\sin\\left(2\\pi p \\xi\\right)\\sin\\left(2\\pi q \\eta\\right)$.\n    - Discrete grid setup: Uniform, periodic, with $N_{\\xi} \\times N_{\\eta}$ cells.\n    - Strategy D: A scheme based on differentiating the coordinate mapping and averaging to obtain face metrics. All discrete operators are explicitly defined.\n    - Strategy C: A conservative scheme based on constructing face metrics from differences of averaged nodal coordinates. All discrete operators are explicitly defined.\n    - Discrete divergence and residual: A specific finite-difference formula for the divergence is provided, which is to be applied to fluxes calculated with both metric strategies.\n    - Error metric: A normalized root-mean-square (RMS) of the discrete residual.\n    - Test cases: Four distinct sets of parameters are provided for computation.\n\n- **Validation Verdict**:\n    - **Scientifically Grounded**: The problem is based on fundamental principles of conservation laws on curvilinear coordinate systems, a core topic in CFD. The metric identity $\\frac{\\partial\\left(J\\mathbf{a}^{\\xi}\\right)}{\\partial \\xi}+\\frac{\\partial\\left(J\\mathbf{a}^{\\eta}\\right)}{\\partial \\eta}=\\mathbf{0}$ is a standard result, and testing its preservation at the discrete level is a critical verification step. Both Strategy D and Strategy C represent common approaches to metric computation.\n    - **Well-Posed**: The problem is well-posed. The inputs are clearly specified, and the required outputs are uniquely determined by the given algorithms. The provided parameters for the test cases are physically and mathematically sound, ensuring the mapping is invertible and the normalization factor for the error is non-zero.\n    - **Objective**: The problem is stated in precise, objective mathematical language.\n    - **Indexing Notation**: Although the indexing notation for face quantities is unconventional, the formulas for constructing these quantities and using them in the discrete divergence are explicit and unambiguous. A literal implementation of the provided formulas forms a self-consistent and solvable problem.\n\nThe problem is deemed **valid** and a solution will be provided.\n\n### Step 2: Solution Design\n\nThe solution will be implemented in Python using the `numpy` library for efficient array computations. The overall structure will involve a main function that iterates through the four test cases. For each case, a dedicated function will perform the calculations for both Strategy D and Strategy C and return the corresponding errors.\n\n**Strategy C Implementation Outline:**\nThis strategy is known to be geometrically conservative and should satisfy the discrete metric identity exactly. The residual, and therefore the error $E^{\\mathrm{C}}$, is expected to be zero up to machine precision.\n1.  Define the computational grid at node locations $(\\xi_i, \\eta_j)$.\n2.  Evaluate the physical coordinates $(x_n, y_n)$ at these nodes using the provided mapping function.\n3.  Compute the cell-centered physical coordinates $(x_h, y_h)$ by averaging the four surrounding nodal coordinates, using `numpy.roll` for periodic boundary handling.\n4.  Construct the conservative face metric vectors $\\mathbf{S}_{\\xi}^{\\mathrm{C}}$ and $\\mathbf{S}_{\\eta}^{\\mathrm{C}}$ by taking differences of the $(x_h, y_h)$ arrays, again using `numpy.roll` for periodic shifts.\n5.  Calculate the face fluxes $F_{\\xi}^{\\mathrm{C}}$ and $F_{\\eta}^{\\mathrm{C}}$ by taking the dot product of the metric vectors with the constant velocity vector $\\mathbf{u}$ and scaling by $q$.\n6.  Compute the discrete residual $\\mathcal{R}^{\\mathrm{C}}$ by applying the specified divergence formula, implemented using `numpy.roll` to perform the subtractions across adjacent cell faces.\n\n**Strategy D Implementation Outline:**\nThis strategy involves differentiation, which can introduce discretization errors that violate the metric identity. The error $E^{\\mathrm{D}}$ is expected to be non-zero.\n1.  Define the computational grid at cell-center locations $(\\xi_{i+1/2}, \\eta_{j+1/2})$.\n2.  Evaluate the physical coordinates $(x_c, y_c)$ at these cell centers.\n3.  Compute the discrete partial derivatives ($x_{\\xi}$, $x_{\\eta}$, $y_{\\xi}$, $y_{\\eta}$) at cell centers using the specified second-order centered difference formulas, implemented with `numpy.roll`.\n4.  Form the cell-centered metric quantities $J\\mathbf{a}^{\\xi}$ and $J\\mathbf{a}^{\\eta}$.\n5.  Average these cell-centered quantities to obtain the face metric vectors $\\mathbf{S}_{\\xi}^{\\mathrm{D}}$ and $\\mathbf{S}_{\\eta}^{\\mathrm{D}}$.\n6.  Calculate the face fluxes and the discrete residual $\\mathcal{R}^{\\mathrm{D}}$ using the same procedure as in Strategy C.\n\n**Error Calculation:**\nFor both strategies, the final normalized RMS error, $E^{\\mathrm{S}}$, will be computed from the residual field $\\mathcal{R}^{\\mathrm{S}}$ using the provided formula. The results for all test cases will be collected and formatted into the required output string.\n\n```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the CFD problem for all test cases.\n    \"\"\"\n    # Test cases defined as tuples:\n    # (N_xi, N_eta, alpha, beta, m, n, p, q_freq, u, v, q_scalar)\n    test_cases = [\n        (48, 48, 0.15, -0.17, 1, 1, 1, 2, 0.9, -0.6, 2.0),\n        (16, 16, 0.3, 0.2, 2, 1, 1, 2, 1.0, 0.0, 1.0),\n        (32, 32, 0.0, 0.0, 1, 1, 1, 1, 1.0, 1.0, 1.0),\n        (24, 24, 0.12, 0.25, 2, 3, 3, 2, 0.7, 1.3, 0.5),\n    ]\n\n    results = []\n    for params in test_cases:\n        errors = calculate_errors_for_case(params)\n        results.append(errors)\n\n    # Format the final output string exactly as required.\n    case_results_str = [f\"[{ed},{ec}]\" for ed, ec in results]\n    final_output = f\"[{','.join(case_results_str)}]\"\n    return final_output\n\ndef map_coordinates(xi_grid, eta_grid, alpha, beta, m, n, p, q_freq):\n    \"\"\"\n    Computes physical coordinates (x, y) from computational (xi, eta).\n    \"\"\"\n    x = xi_grid + alpha * np.sin(2 * np.pi * m * xi_grid) * np.sin(2 * np.pi * n * eta_grid)\n    y = eta_grid + beta * np.sin(2 * np.pi * p * xi_grid) * np.sin(2 * np.pi * q_freq * eta_grid)\n    return x, y\n\ndef calculate_errors_for_case(params):\n    \"\"\"\n    Calculates the normalized RMS residual errors for Strategy D and Strategy C\n    for a single test case.\n    \"\"\"\n    N_xi, N_eta, alpha, beta, m, n, p, q_freq, u, v, q_scalar = params\n    \n    dxi = 1.0 / N_xi\n    deta = 1.0 / N_eta\n    \n    # --- Grid Setup ---\n    xi_node_1d = np.arange(N_xi) * dxi\n    eta_node_1d = np.arange(N_eta) * deta\n    xi_node, eta_node = np.meshgrid(xi_node_1d, eta_node_1d, indexing='ij')\n\n    xi_center_1d = (np.arange(N_xi) + 0.5) * dxi\n    eta_center_1d = (np.arange(N_eta) + 0.5) * deta\n    xi_center, eta_center = np.meshgrid(xi_center_1d, eta_center_1d, indexing='ij')\n\n    # --- Strategy D: Differentiate then Average ---\n    \n    # 1. Physical coords at cell centers\n    xc, yc = map_coordinates(xi_center, eta_center, alpha, beta, m, n, p, q_freq)\n    \n    # 2. Centered differences of coords at cell centers\n    x_xi = (np.roll(xc, -1, axis=0) - np.roll(xc, 1, axis=0)) / (2 * dxi)\n    x_eta = (np.roll(xc, -1, axis=1) - np.roll(xc, 1, axis=1)) / (2 * deta)\n    y_xi = (np.roll(yc, -1, axis=0) - np.roll(yc, 1, axis=0)) / (2 * dxi)\n    y_eta = (np.roll(yc, -1, axis=1) - np.roll(yc, 1, axis=1)) / (2 * deta)\n    \n    # 3. Cell-centered metric vectors J*a^xi and J*a^eta\n    Ja_xi_D = np.stack((y_eta, -x_eta), axis=-1)\n    Ja_eta_D = np.stack((-y_xi, x_xi), axis=-1)\n    \n    # 4. Face metric vectors by averaging cell-centered values\n    S_xi_D = deta / 2.0 * (Ja_xi_D + np.roll(Ja_xi_D, -1, axis=0))\n    S_eta_D = dxi / 2.0 * (Ja_eta_D + np.roll(Ja_eta_D, -1, axis=1))\n    \n    # 5. Face fluxes\n    F_xi_D = q_scalar * (S_xi_D[..., 0] * u + S_xi_D[..., 1] * v)\n    F_eta_D = q_scalar * (S_eta_D[..., 0] * u + S_eta_D[..., 1] * v)\n\n    # 6. Discrete residual\n    R_D = (F_xi_D - np.roll(F_xi_D, 1, axis=0)) + (F_eta_D - np.roll(F_eta_D, 1, axis=1))\n\n    # --- Strategy C: Conservative Cross Products ---\n\n    # 1. Physical coords at nodes\n    xn, yn = map_coordinates(xi_node, eta_node, alpha, beta, m, n, p, q_freq)\n    \n    # 2. Half-indexed averages (cell-centered positions)\n    xh = 0.25 * (xn + np.roll(xn, -1, axis=0) + np.roll(xn, -1, axis=1) + np.roll(np.roll(xn, -1, axis=0), -1, axis=1))\n    yh = 0.25 * (yn + np.roll(yn, -1, axis=0) + np.roll(yn, -1, axis=1) + np.roll(np.roll(yn, -1, axis=0), -1, axis=1))\n    \n    # 3. Conservative face metric vectors\n    S_xi_C_y = yh - np.roll(yh, 1, axis=1)\n    S_xi_C_x = -(xh - np.roll(xh, 1, axis=1))\n    S_xi_C = np.stack((S_xi_C_y, S_xi_C_x), axis=-1)\n\n    S_eta_C_x = -(yh - np.roll(yh, 1, axis=0))\n    S_eta_C_y = xh - np.roll(xh, 1, axis=0)\n    S_eta_C = np.stack((S_eta_C_x, S_eta_C_y), axis=-1)\n    \n    # 4. Face fluxes\n    F_xi_C = q_scalar * (S_xi_C[..., 0] * u + S_xi_C[..., 1] * v)\n    F_eta_C = q_scalar * (S_eta_C[..., 0] * u + S_eta_C[..., 1] * v)\n\n    # 5. Discrete residual\n    R_C = (F_xi_C - np.roll(F_xi_C, 1, axis=0)) + (F_eta_C - np.roll(F_eta_C, 1, axis=1))\n    \n    # --- Final Error Calculation ---\n    norm_factor = abs(q_scalar) * np.sqrt(u**2 + v**2)\n    \n    if norm_factor == 0:\n        E_D = np.sqrt(np.mean(R_D**2))\n        E_C = np.sqrt(np.mean(R_C**2))\n    else:\n        E_D = np.sqrt(np.mean(R_D**2)) / norm_factor\n        E_C = np.sqrt(np.mean(R_C**2)) / norm_factor\n        \n    return [E_D, E_C]\n\n# The solve() function is defined but not called here to avoid execution in a static context.\n# The output is pre-calculated and placed in the answer tag.\n```", "answer": "[[0.007621183204732104,2.203396917823906e-16],[0.0461877864821617,5.558348633367781e-16],[0.0,0.0],[0.0384218375960012,1.1579294977457784e-15]]", "id": "3324596"}]}