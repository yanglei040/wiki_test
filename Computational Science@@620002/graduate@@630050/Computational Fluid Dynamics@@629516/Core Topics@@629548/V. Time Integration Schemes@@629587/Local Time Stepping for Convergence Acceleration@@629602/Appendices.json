{"hands_on_practices": [{"introduction": "To build a solid foundation, we begin by analyzing local time stepping in its simplest form. This first exercise [@problem_id:3341489] treats the pseudo-time marching scheme as a classical iterative method for solving the steady-state equations. By deriving the iteration matrix for a 1D linear advection problem, you will analytically determine the convergence rate and see precisely how the local Courant number governs the speed at which errors are diminished.", "problem": "Consider the one-dimensional linear advection equation with constant advection speed $a > 0$,\n$$\n\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0,\n$$\ndiscretized by a finite-volume method on three contiguous control volumes (cells) with lengths $\\Delta x_1$, $\\Delta x_2$, and $\\Delta x_3$. Assume a first-order upwind numerical flux consistent with $a>0$ and an inflow Dirichlet boundary condition at the left boundary. Let $u_i(t)$ denote the cell-average in cell $i$. The semi-discrete residual in cell $i$ is the difference of numerical fluxes at its faces. To drive the solution to steady state, consider explicit forward-Euler pseudo-time marching with cell-local time steps $\\Delta t_i$:\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t_i}{\\Delta x_i} R_i(u^n),\n$$\nwhere $R_i(u)$ is the finite-volume residual and $\\Delta x_i$ is the cell volume in one dimension.\n\nStart from first principles (the finite-volume balance for linear advection with upwind flux for $a>0$) to derive the residual $R_i(u)$, and then use the Courant–Friedrichs–Lewy (CFL) stability criterion with a chosen Courant–Friedrichs–Lewy (CFL) number $C \\in (0,1]$ to determine the local time steps $\\Delta t_i$ in terms of ($\\Delta x_i, a, C$). Using the corresponding linear error-propagation form of the iteration, model this pseudo-time stepping as a weighted-Jacobi relaxation for the steady-state linear system and estimate the contraction factor $\\rho$ of one pseudo-time iteration in terms of $C$.\n\nExpress the time steps in seconds and the contraction factor as a unitless decimal. Provide your final answer as a single row matrix containing $\\Delta t_1$, $\\Delta t_2$, $\\Delta t_3$, and $\\rho$ in that order. No numerical substitution for ($\\Delta x_i, a, C$) is required. The final answer must be a single analytical expression.", "solution": "The problem is first validated to ensure it is scientifically sound, well-posed, and objective.\n\nThe givens are:\n- The governing equation: $\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0$, with constant advection speed $a>0$.\n- The spatial discretization: A finite-volume method on three contiguous cells with lengths $\\Delta x_1$, $\\Delta x_2$, $\\Delta x_3$.\n- The numerical flux: First-order upwind, consistent with $a>0$.\n- The boundary condition: An inflow Dirichlet condition at the left boundary.\n- The temporal discretization (pseudo-time): Explicit forward-Euler with cell-local time steps $\\Delta t_i$.\n- The update formula: $u_i^{n+1} = u_i^n - \\frac{\\Delta t_i}{\\Delta x_i} R_i(u^n)$, where $u_i$ is the cell-average and $R_i(u)$ is the finite-volume residual.\n- The stability criterion: The Courant–Friedrichs–Lewy (CFL) condition is to be used with a number $C \\in (0,1]$.\n\nThe problem is scientifically grounded, being a standard analysis of a numerical method for a fundamental partial differential equation. It is well-posed, with sufficient information to derive the requested quantities. The terminology is precise and objective. Thus, the problem is deemed valid.\n\nThe solution proceeds in three steps: derivation of the residual $R_i$, determination of the local time steps $\\Delta t_i$, and estimation of the contraction factor $\\rho$.\n\nStep 1: Derivation of the residual $R_i(u)$\nThe finite-volume method applied to the one-dimensional conservation law $\\frac{\\partial u}{\\partial t} + \\frac{\\partial f(u)}{\\partial x} = 0$ over a control volume (cell) $\\Omega_i = [x_{i-1/2}, x_{i+1/2}]$ of length $\\Delta x_i = x_{i+1/2} - x_{i-1/2}$ yields:\n$$\n\\frac{d}{dt} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t) \\,dx + f(u(x_{i+1/2},t)) - f(u(x_{i-1/2},t)) = 0\n$$\nDefining the cell-average $u_i(t) = \\frac{1}{\\Delta x_i} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t) \\,dx$, the equation becomes:\n$$\n\\Delta x_i \\frac{du_i}{dt} + F_{i+1/2} - F_{i-1/2} = 0\n$$\nwhere $F_{i \\pm 1/2}$ are the numerical fluxes at the cell interfaces. The physical flux for the linear advection equation is $f(u) = au$. The semi-discrete form is:\n$$\n\\frac{du_i}{dt} = -\\frac{1}{\\Delta x_i} (F_{i+1/2} - F_{i-1/2})\n$$\nThe problem provides the explicit Euler time-marching scheme as $u_i^{n+1} = u_i^n - \\frac{\\Delta t_i}{\\Delta x_i} R_i(u^n)$. Approximating the time derivative as $\\frac{du_i}{dt} \\approx \\frac{u_i^{n+1}-u_i^n}{\\Delta t_i}$ (for a single cell's update), we can relate the semi-discrete form to the update formula:\n$$\nu_i^{n+1} - u_i^n \\approx - \\frac{\\Delta t_i}{\\Delta x_i} (F_{i+1/2} - F_{i-1/2})\n$$\nComparing this with the given update formula, we identify the residual $R_i(u)$ as the difference of the numerical fluxes:\n$$\nR_i(u) = F_{i+1/2} - F_{i-1/2}\n$$\nThe problem specifies a first-order upwind flux for $a>0$. This means the flux at an interface is determined by the state in the cell upwind (to the left) of the interface.\nFor the interface at $x_{i+1/2}$ between cells $i$ and $i+1$, the upwind cell is cell $i$. Thus, the numerical flux is $F_{i+1/2} = f(u_i) = a u_i$.\nFor the interface at $x_{i-1/2}$ between cells $i-1$ and $i$, the upwind cell is cell $i-1$. Thus, the numerical flux is $F_{i-1/2} = f(u_{i-1}) = a u_{i-1}$.\nThe residual for an interior cell $i$ is:\n$$\nR_i(u) = a u_i - a u_{i-1} = a(u_i - u_{i-1})\n$$\nThe system consists of three cells, $i=1, 2, 3$. For the first cell, $i=1$, the left boundary is an inflow Dirichlet boundary. Let the value be $u_L$. This value determines the state for the flux calculation at the $x_{1/2}$ interface, effectively acting as $u_0$. So, $F_{1/2} = a u_L$. The residuals for the three cells are:\n$R_1(u) = F_{3/2} - F_{1/2} = a u_1 - a u_L = a(u_1 - u_L)$\n$R_2(u) = F_{5/2} - F_{3/2} = a u_2 - a u_1 = a(u_2 - u_1)$\n$R_3(u) = F_{7/2} - F_{5/2} = a u_3 - a u_2 = a(u_3 - u_2)$\n\nStep 2: Determination of local time steps $\\Delta t_i$\nSubstituting the derived residual into the given update formula:\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t_i}{\\Delta x_i} a (u_i^n - u_{i-1}^n)\n$$\nRearranging the terms for $u_i^{n+1}$:\n$$\nu_i^{n+1} = \\left(1 - \\frac{a \\Delta t_i}{\\Delta x_i}\\right) u_i^n + \\frac{a \\Delta t_i}{\\Delta x_i} u_{i-1}^n\n$$\nThis is the update equation for the explicit first-order upwind scheme. For this scheme to be stable (e.g., to satisfy the positivity condition, ensuring no new extrema are created), the coefficients of the states on the right-hand side must be non-negative. This requires:\n$$\n1 - \\frac{a \\Delta t_i}{\\Delta x_i} \\ge 0 \\implies \\frac{a \\Delta t_i}{\\Delta x_i} \\le 1\n$$\nThis is the Courant–Friedrichs–Lewy (CFL) stability condition. The quantity $\\frac{a \\Delta t_i}{\\Delta x_i}$ is the local Courant number. The problem states that a CFL number $C \\in (0,1]$ is chosen to set the time step. This means we set the local Courant number for each cell to this value $C$:\n$$\n\\frac{a \\Delta t_i}{\\Delta x_i} = C\n$$\nSolving for the local time step $\\Delta t_i$ gives:\n$$\n\\Delta t_i = \\frac{C \\Delta x_i}{a}\n$$\nApplying this to each of the three cells, we get:\n$\\Delta t_1 = \\frac{C \\Delta x_1}{a}$\n$\\Delta t_2 = \\frac{C \\Delta x_2}{a}$\n$\\Delta t_3 = \\frac{C \\Delta x_3}{a}$\n\nStep 3: Estimation of the contraction factor $\\rho$\nThe pseudo-time stepping is an iterative method to find the steady-state solution, which is defined by $\\frac{\\partial u}{\\partial t} = 0$. This implies that the semi-discrete residuals must be zero: $R_i(u) = 0$.\nThe steady-state linear system is:\n$a(u_1 - u_L) = 0$\n$a(u_2 - u_1) = 0$\n$a(u_3 - u_2) = 0$\nThe solution is $u_1 = u_2 = u_3 = u_L$.\nThe iterative scheme to solve this system is given by the update formula with $\\frac{a \\Delta t_i}{\\Delta x_i} = C$:\n$u_1^{n+1} = (1-C) u_1^n + C u_L$\n$u_2^{n+1} = (1-C) u_2^n + C u_1^n$\n$u_3^{n+1} = (1-C) u_3^n + C u_2^n$\nThis system can be written in matrix form $\\mathbf{u}^{n+1} = G \\mathbf{u}^n + \\mathbf{c}$, where $\\mathbf{u}^n = [u_1^n, u_2^n, u_3^n]^T$:\n$$\n\\begin{pmatrix} u_1^{n+1} \\\\ u_2^{n+1} \\\\ u_3^{n+1} \\end{pmatrix} =\n\\begin{pmatrix} 1-C & 0 & 0 \\\\ C & 1-C & 0 \\\\ 0 & C & 1-C \\end{pmatrix}\n\\begin{pmatrix} u_1^n \\\\ u_2^n \\\\ u_3^n \\end{pmatrix} +\n\\begin{pmatrix} C u_L \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\nThe matrix $G$ is the iteration matrix. The convergence rate of the iteration is determined by the spectral radius of $G$, which is the contraction factor $\\rho$.\n$$\nG = \\begin{pmatrix} 1-C & 0 & 0 \\\\ C & 1-C & 0 \\\\ 0 & C & 1-C \\end{pmatrix}\n$$\nSince $G$ is a lower triangular matrix, its eigenvalues are its diagonal entries.\n$$\n\\lambda_1 = \\lambda_2 = \\lambda_3 = 1-C\n$$\nThe spectral radius $\\rho(G)$ is the maximum of the absolute values of the eigenvalues:\n$$\n\\rho = \\rho(G) = \\max_i |\\lambda_i| = |1-C|\n$$\nThe problem specifies that $C \\in (0, 1]$. For this range of $C$, the value of $1-C$ is in the range $[0, 1)$. Therefore, $|1-C| = 1-C$.\nThe contraction factor is:\n$$\n\\rho = 1-C\n$$\nThis scheme is a weighted-Jacobi iteration for the steady-state system with a relaxation factor $\\omega = C$. The iteration converges for any $C \\in (0,1)$, and the convergence is fastest as $C \\to 1$, which gives $\\rho \\to 0$.\n\nFinal Answer Assembly\nThe required quantities are $\\Delta t_1$, $\\Delta t_2$, $\\Delta t_3$, and $\\rho$.\n$\\Delta t_1 = \\frac{C \\Delta x_1}{a}$\n$\\Delta t_2 = \\frac{C \\Delta x_2}{a}$\n$\\Delta t_3 = \\frac{C \\Delta x_3}{a}$\n$\\rho = 1-C$\nThese are combined into a single row matrix as requested.", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{C \\Delta x_1}{a} & \\frac{C \\Delta x_2}{a} & \\frac{C \\Delta x_3}{a} & 1 - C \\end{pmatrix}}\n$$", "id": "3341489"}, {"introduction": "While local time stepping is straightforward for first-order methods, its interaction with higher-order schemes requires careful consideration. This practice [@problem_id:3341502] explores the application of local time steps within a third-order Strong Stability Preserving (SSP) Runge-Kutta method, a popular choice for hyperbolic problems. You will derive the stability constraints imposed by the SSP framework and discover how the structure of the method dictates the maximum allowable local time step, providing insight into the practical challenges of maintaining stability.", "problem": "Consider a semi-discrete form of a nonlinear hyperbolic conservation law in Computational Fluid Dynamics (CFD), written componentwise for each cell as the system of ordinary differential equations\n$$\n\\frac{d u_{i}}{d t} = L_{i}(u),\n$$\nwhere $u$ denotes the vector of all cell-averaged solution values and $L_{i}$ is the spatial discretization operator for cell $i$ constructed with a monotone flux so that Forward Euler (FE) time stepping is admissible under a cellwise stability bound. Assume FE applied to the full semi-discrete system with a per-cell time step $\\tau_{i}$ is strongly stable in a chosen monotone norm or semi-norm (for example, total variation or a positivity norm) provided\n$$\n0 \\le \\tau_{i} \\le \\Delta t_{\\mathrm{FE},i},\n$$\nwith $\\Delta t_{\\mathrm{FE},i} > 0$ denoting the maximum admissible FE step for cell $i$ under the given spatial discretization and current stage state.\n\nWe wish to accelerate convergence to steady state by local time stepping: apply a Strong Stability Preserving (SSP) third-order, three-stage Runge–Kutta method, denoted SSP(3,3), with per-cell time steps $\\Delta t_{i}$, stage-synchronized across all cells. The SSP(3,3) method in Shu–Osher form updates as follows:\n- Stage $1$: \n$$\nu^{(1)} = u^{n} + \\Delta t \\, L(u^{n}),\n$$\n- Stage $2$: \n$$\nu^{(2)} = \\frac{3}{4}\\,u^{n} + \\frac{1}{4}\\left(u^{(1)} + \\Delta t \\, L(u^{(1)})\\right),\n$$\n- Stage $3$ (solution update): \n$$\nu^{n+1} = u^{(3)} = \\frac{1}{3}\\,u^{n} + \\frac{2}{3}\\left(u^{(2)} + \\Delta t \\, L(u^{(2)})\\right).\n$$\n\nUnder local time stepping, interpret $\\Delta t$ componentwise so that for each cell $i$, the FE-like increments in each stage employ $\\Delta t_{i}$. For SSP to hold, each stage must be representable, for each cell $i$, as a convex combination of FE steps $u_{i}^{(m)} + \\tau_{i}^{(m)} L_{i}(u^{(m)})$ with nonnegative weights that sum to one and with each $\\tau_{i}^{(m)}$ admissible, i.e., $0 \\le \\tau_{i}^{(m)} \\le \\Delta t_{\\mathrm{FE},i}$.\n\n(a) Rewrite the SSP(3,3) stages for a fixed cell index $i$ so that each stage $u_{i}^{(k)}$ is expressed explicitly as a convex combination of FE steps, identifying all per-cell FE substeps $\\tau_{i}^{(m)}$ that appear.\n\n(b) From this representation, derive the necessary and sufficient cellwise inequalities on $\\Delta t_{i}$ that ensure every stage remains a convex combination of admissible FE steps for cell $i$.\n\n(c) Suppose one chooses a uniform scaling of the local FE bounds $\\Delta t_{i} = s \\cdot \\Delta t_{\\mathrm{FE},i}$ with a scalar $s \\in \\mathbb{R}$, the same across all cells. Determine the maximum admissible scaling factor $s_{\\max}$ such that the SSP(3,3) method with local time stepping remains SSP in the stated sense. Express the final scaling factor as an exact number (dimensionless).\n\n(d) Briefly discuss, without altering the required calculation, the practical feasibility of satisfying the derived constraints in a multi-cell CFD computation where $L_{i}$ couples neighboring cells, considering stage synchronization and interface flux consistency under local time stepping.", "solution": "The problem requires an analysis of a third-order Strong Stability Preserving (SSP) Runge-Kutta method, SSP(3,3), applied with local time stepping to a system of ordinary differential equations (ODEs) arising from the semi-discretization of a nonlinear hyperbolic conservation law. The analysis will proceed in four parts as requested.\n\nThe semi-discrete system is given for each cell $i$ as:\n$$\n\\frac{d u_{i}}{d t} = L_{i}(u)\n$$\nwhere $u$ is the vector of all cell-averaged solutions. The Forward Euler (FE) method is strongly stable for a time step $\\tau_i$ provided $0 \\le \\tau_{i} \\le \\Delta t_{\\mathrm{FE},i}$, where $\\Delta t_{\\mathrm{FE},i}$ is the maximum admissible FE step for cell $i$ given the current state. The SSP property relies on decomposing each stage of the Runge-Kutta method into a sequence of convex combinations of admissible FE steps.\n\nThe SSP(3,3) method is given in Shu-Osher form:\n- Stage 1: $u^{(1)} = u^{n} + \\Delta t \\, L(u^{n})$\n- Stage 2: $u^{(2)} = \\frac{3}{4}\\,u^{n} + \\frac{1}{4}\\left(u^{(1)} + \\Delta t \\, L(u^{(1)})\\right)$\n- Stage 3: $u^{n+1} = u^{(3)} = \\frac{1}{3}\\,u^{n} + \\frac{2}{3}\\left(u^{(2)} + \\Delta t \\, L(u^{(2)})\\right)$\n\nIn the context of local time stepping, the global $\\Delta t$ is replaced by a cell-dependent $\\Delta t_i$.\n\n**(a) Rewrite stages as explicit convex combinations of FE steps and identify FE substeps**\n\nThe SSP property is guaranteed by the structure of the Shu-Osher form, which expresses each stage update as a convex combination of results from previous stages and FE-like steps. An FE step from a state $w_i$ is defined as $w_i + \\tau_i L_i(w)$.\n\n- **Stage 1:** For cell $i$, the update is:\n$$\nu_{i}^{(1)} = u_{i}^{n} + \\Delta t_{i} L_{i}(u^{n})\n$$\nThis is already in the form of a single FE step starting from $u_i^n$. We can express it as a trivial convex combination with a single term and a weight of $1$:\n$$\nu_{i}^{(1)} = 1 \\cdot \\left( u_{i}^{n} + \\tau_{i}^{(0)} L_{i}(u^{n}) \\right)\n$$\nThe per-cell FE substep is $\\tau_{i}^{(0)} = \\Delta t_{i}$.\n\n- **Stage 2:** For cell $i$, the update is:\n$$\nu_{i}^{(2)} = \\frac{3}{4}\\,u_{i}^{n} + \\frac{1}{4}\\left(u_{i}^{(1)} + \\Delta t_{i} L_{i}(u^{(1)})\\right)\n$$\nThis equation expresses $u_i^{(2)}$ as a convex combination of the state $u_i^n$ (with weight $\\frac{3}{4}$) and the term $(u_{i}^{(1)} + \\Delta t_{i} L_{i}(u^{(1)}))$ (with weight $\\frac{1}{4}$). The weights are non-negative and sum to $1$. The second term is an FE step applied to the state $u_i^{(1)}$. The FE substep associated with this step is:\n$$\n\\tau_{i}^{(1)} = \\Delta t_{i}\n$$\n\n- **Stage 3:** The final update for cell $i$ is:\n$$\nu_{i}^{n+1} = u_{i}^{(3)} = \\frac{1}{3}\\,u_{i}^{n} + \\frac{2}{3}\\left(u_{i}^{(2)} + \\Delta t_{i} L_{i}(u^{(2)})\\right)\n$$\nThis expresses $u_i^{n+1}$ as a convex combination of the state $u_i^n$ (with weight $\\frac{1}{3}$) and the term $(u_{i}^{(2)} + \\Delta t_{i} L_{i}(u^{(2)}))$ (with weight $\\frac{2}{3}$). The second term is an FE step applied to the state $u_i^{(2)}$. The FE substep associated with this step is:\n$$\n\\tau_{i}^{(2)} = \\Delta t_{i}\n$$\n\nIn summary, the method consists of a sequence of operations (FE steps and convex combinations), and the explicit FE substeps appearing in the formulation at each stage are $\\tau_{i}^{(0)} = \\Delta t_{i}$, $\\tau_{i}^{(1)} = \\Delta t_{i}$, and $\\tau_{i}^{(2)} = \\Delta t_{i}$.\n\n**(b) Derive necessary and sufficient cellwise inequalities on $\\Delta t_i$**\n\nThe SSP property requires that every FE step involved in the scheme must be admissible. An FE step with substep $\\tau_i$ from a state $w$ is admissible if $0 \\le \\tau_i \\le \\Delta t_{\\mathrm{FE},i}(w)$, where $\\Delta t_{\\mathrm{FE},i}(w)$ is the maximum stable FE step size for cell $i$ at state $w$.\n\nFor the SSP(3,3) method to be SSP, each of the FE substeps identified in part (a) must be admissible in the context of the stage in which it appears.\n\n1.  For Stage 1, the substep is $\\tau_i^{(0)} = \\Delta t_i$, applied to state $u^n$. The admissibility condition is:\n    $$\n    0 \\le \\Delta t_i \\le \\Delta t_{\\mathrm{FE},i}(u^n)\n    $$\n2.  For Stage 2, the substep is $\\tau_i^{(1)} = \\Delta t_i$, applied to state $u^{(1)}$. The admissibility condition is:\n    $$\n    0 \\le \\Delta t_i \\le \\Delta t_{\\mathrm{FE},i}(u^{(1)})\n    $$\n3.  For Stage 3, the substep is $\\tau_i^{(2)} = \\Delta t_i$, applied to state $u^{(2)}$. The admissibility condition is:\n    $$\n    0 \\le \\Delta t_i \\le \\Delta t_{\\mathrm{FE},i}(u^{(2)})\n    $$\n\nFor a single time step from $n$ to $n+1$ to be SSP, the chosen $\\Delta t_i$ must satisfy all these conditions simultaneously. Therefore, the necessary condition is:\n$$\n\\Delta t_i \\le \\min\\left( \\Delta t_{\\mathrm{FE},i}(u^n), \\Delta t_{\\mathrm{FE},i}(u^{(1)}), \\Delta t_{\\mathrm{FE},i}(u^{(2)}) \\right)\n$$\nFor the purpose of determining the method's intrinsic SSP coefficient, it is standard practice to assume that $\\Delta t_{\\mathrm{FE},i}$ does not change significantly over the stages of a single time step. This is guided by the problem statement where the admissibility condition $0 \\le \\tau_{i}^{(m)} \\le \\Delta t_{\\mathrm{FE},i}$ does not explicitly show a state dependency. Under this standard simplifying assumption, we set $\\Delta t_{\\mathrm{FE},i}(u^n) \\approx \\Delta t_{\\mathrm{FE},i}(u^{(1)}) \\approx \\Delta t_{\\mathrm{FE},i}(u^{(2)}) \\approx \\Delta t_{\\mathrm{FE},i}$ (where the latter is evaluated at state $u^n$).\n\nWith this assumption, the three inequalities collapse into a single condition. This condition is both necessary and sufficient under the given SSP definition and the assumption of a constant $\\Delta t_{\\mathrm{FE},i}$ over the substages:\n$$\n0 \\le \\Delta t_i \\le \\Delta t_{\\mathrm{FE},i}\n$$\n\n**(c) Determine the maximum admissible scaling factor $s_{\\max}$**\n\nWe are given the local time step as a uniform scaling of the local FE bound: $\\Delta t_i = s \\cdot \\Delta t_{\\mathrm{FE},i}$, where $s$ is a scalar constant across all cells and $\\Delta t_{\\mathrm{FE},i}$ is the maximum admissible FE step for cell $i$ (evaluated at state $u^n$).\n\nSubstituting this into the inequality derived in part (b):\n$$\ns \\cdot \\Delta t_{\\mathrm{FE},i} \\le \\Delta t_{\\mathrm{FE},i}\n$$\nThe problem states that $\\Delta t_{\\mathrm{FE},i} > 0$. Therefore, we can divide both sides by $\\Delta t_{\\mathrm{FE},i}$ without changing the direction of the inequality:\n$$\ns \\le 1\n$$\nSince $s$ is typically chosen to be non-negative for a forward time integration, the full range is $0 \\le s \\le 1$. The maximum admissible scaling factor is therefore:\n$$\ns_{\\max} = 1\n$$\nThis value is the well-known SSP coefficient for the SSP(3,3) method.\n\n**(d) Discussion on practical feasibility**\n\nThe derivation in parts (b) and (c) relied on the assumption that the cellwise FE stability bound, $\\Delta t_{\\mathrm{FE},i}$, remains effectively constant throughout the three stages of the Runge-Kutta step. In a practical multi-cell CFD computation, several factors complicate this picture:\n\n1.  **State-Dependent Stability:** The stability bound $\\Delta t_{\\mathrm{FE},i}$ (e.g., from a CFL condition) is a function of the local solution state, e.g., $\\Delta t_{\\mathrm{FE},i} \\propto 1 / (|\\mathbf{v}_i| + c_i)$. As the solution evolves through the stages $u^{(1)}$ and $u^{(2)}$, the local velocity $\\mathbf{v}_i$ and sound speed $c_i$ can change, altering the true value of $\\Delta t_{\\mathrm{FE},i}(u^{(k)})$. If the stability bound decreases significantly during a stage (e.g., due to a strengthening shock), the condition $\\Delta t_i \\le \\Delta t_{\\mathrm{FE},i}(u^{(k)})$ could be violated even if $s=1$ based on the initial state $u^n$.\n\n2.  **Interface Flux Consistency:** The spatial operator $L_i(u)$ for cell $i$ typically depends on the solution in neighboring cells, e.g., through a numerical flux $F_{i+1/2}(u_i, u_{i+1})$. In local time stepping, the intermediate stage values $u_i^{(k)}$ and $u_{j}^{(k)}$ for neighboring cells $i, j$ are computed using their respective time steps $\\Delta t_i$ and $\\Delta t_j$. If $\\Delta t_i \\neq \\Delta t_j$, the collection of stage values $u^{(k)}$ does not correspond to the solution of the semi-discrete system at any single intermediate time. This inconsistency at cell interfaces can lead to a degradation of the formal order of accuracy for transient problems. For convergence to a steady state, this loss of transient accuracy is often considered an acceptable trade-off for the acceleration achieved.\n\n3.  **Strict SSP Property:** Due to the combined effects of state-dependent stability and inconsistent interface states, the rigorously proven SSP property may be compromised in practice. Large ratios of $\\Delta t_i / \\Delta t_j$ between adjacent cells can exacerbate these issues. Consequently, practitioners often use a more conservative scaling factor ($s  1$) and/or limit the maximum ratio of time steps between neighboring cells to maintain robustness and prevent the growth of oscillations.", "answer": "$$\n\\boxed{1}\n$$", "id": "3341502"}, {"introduction": "The true power of local time stepping is realized when it is optimized for performance on modern computer architectures. This final exercise [@problem_id:3341467] introduces a practical constraint known as \"face coherence,\" which limits the time step ratio between neighboring cells to improve parallel load balancing. Your task is to find the optimal coherence factor by creating and maximizing an objective function that balances the convergence rate with a metric for parallel efficiency, embodying a core trade-off in high-performance scientific computing.", "problem": "Consider a one-dimensional finite volume discretization of the linear advection equation, where the conserved scalar $u$ satisfies the conservation law\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial (a(x) u)}{\\partial x} = 0\n$$\non a periodic domain. Let the mesh consist of $N$ cells with cell widths $\\Delta x_i > 0$ and positive characteristic speeds $a_i > 0$, for $i \\in \\{0,1,\\dots,N-1\\}$. Define the face speeds by $a_{i+1/2}$ as a consistent face interpolation of adjacent $a_i$ values, and adopt a standard upwind numerical flux with periodic boundary conditions. Use explicit local pseudo-time stepping where each cell $i$ advances with its own local time step $\\Delta t_i$, subject to a face-coherent constraint: for every face adjacency $(i,i+1)$, the neighboring time steps must satisfy\n$$\n\\max\\{\\Delta t_i,\\Delta t_{i+1}\\} \\le \\gamma \\min\\{\\Delta t_i,\\Delta t_{i+1}\\}\n$$\nfor a given factor $\\gamma \\ge 1$.\n\nStarting from the per-cell Courant–Friedrichs–Lewy (CFL) limited time steps $\\Delta t^{\\mathrm{CFL}}_i$, defined by\n$$\n\\Delta t^{\\mathrm{CFL}}_i = \\frac{\\mathrm{CFL} \\cdot \\Delta x_i}{s_i}\n$$\nwhere $s_i = \\max\\{a_{i-1/2}, a_{i+1/2}\\}$ and $\\mathrm{CFL} \\in (0,1)$ is a chosen Courant number, implement a graph-consistent projection of $\\Delta t_i$ onto the feasible set induced by a given $\\gamma$: iteratively modify the larger of neighboring $\\Delta t$ values across faces until every neighboring pair satisfies the ratio bound. The goal is to choose $\\gamma$ to accelerate convergence while maintaining parallel efficiency in a multirate subcycling schedule.\n\nDefine the one-step explicit update for the finite volume upwind scheme in each cell $i$ by\n$$\nu_i^{n+1} = u_i^n - \\left(\\frac{\\Delta t_i}{\\Delta x_i}\\right)\\left(F_{i+1/2}(u^n) - F_{i-1/2}(u^n)\\right),\n$$\nwhere $F_{i+1/2}$ is the upwind numerical flux using positive characteristic speeds and periodic boundary conditions. This one-step update induces a linear iteration operator $M(\\Delta t)$ acting on the vector of cell states $u$, with a spectral radius $\\rho(M(\\Delta t))$ that quantifies the asymptotic contraction per iteration in the linear regime. Assume all $a_i$ are positive so that the upwind direction is to the right. For a given $\\gamma$, after enforcing face coherence, define the parallel multirate efficiency for one macro-step of duration equal to $\\max_i \\Delta t_i$ by\n$$\nE(\\gamma) = \\frac{N}{\\sum_{i=0}^{N-1} \\lceil \\max_j \\Delta t_j / \\Delta t_i \\rceil},\n$$\nwhich estimates the fraction of ideal parallel utilization under subcycling. To balance convergence rate and parallel efficiency, define the scalar objective\n$$\nJ(\\gamma) = E(\\gamma)\\cdot \\max\\{0,\\,1 - \\rho(M(\\Delta t(\\gamma)))\\},\n$$\nso that unstable schemes with $\\rho(M(\\Delta t)) \\ge 1$ yield $J(\\gamma) = 0$.\n\nYour program must:\n- Construct $M(\\Delta t)$ for a given mesh and $\\gamma$ under the assumptions stated, using a face speed interpolation\n$$\na_{i+1/2} = \\frac{1}{2}(a_i + a_{i+1})\n$$\nand periodic indexing.\n- Compute $\\rho(M(\\Delta t))$ as the maximum absolute eigenvalue of $M(\\Delta t)$.\n- Compute $E(\\gamma)$ and $J(\\gamma)$ for each candidate $\\gamma$ in a provided candidate set.\n- Select the optimal $\\gamma$ that maximizes $J(\\gamma)$; in case of ties within a numerical tolerance, choose the smallest $\\gamma$.\n- Output, for each test case, the triple $[\\gamma^\\ast, E(\\gamma^\\ast), \\rho(M(\\Delta t(\\gamma^\\ast)))]$ with each float rounded to six decimal places.\n\nUse the following test suite of three meshes with their parameters and candidate $\\gamma$ sets. For all three cases, use $\\mathrm{CFL} = 0.9$.\n\nTest case $1$ (heterogeneous but moderate):\n- $N = 12$,\n- $\\Delta x = [1.0, 0.8, 1.2, 0.7, 1.3, 0.9, 0.6, 1.1, 0.95, 1.4, 0.5, 1.0]$,\n- $a = [1.0, 2.5, 1.2, 2.8, 0.9, 2.2, 1.1, 2.6, 0.8, 3.0, 1.3, 2.4]$,\n- candidate $\\gamma$ values $[1.1, 1.25, 1.5, 2.0, 3.0]$.\n\nTest case $2$ (uniform mesh and speed):\n- $N = 10$,\n- $\\Delta x = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]$,\n- $a = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]$,\n- candidate $\\gamma$ values $[1.05, 1.2, 1.5, 2.0]$.\n\nTest case $3$ (strongly heterogeneous):\n- $N = 10$,\n- $\\Delta x = [0.3, 1.5, 0.4, 2.0, 0.35, 1.8, 0.5, 2.2, 0.45, 1.6]$,\n- $a = [0.4, 2.8, 0.5, 3.2, 0.6, 2.5, 0.7, 3.0, 0.8, 2.7]$,\n- candidate $\\gamma$ values $[1.2, 1.5, 1.8, 2.5, 3.5]$.\n\nFinal output specification:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is itself a list $[\\gamma^\\ast, E(\\gamma^\\ast), \\rho(M(\\Delta t(\\gamma^\\ast)))]$ for each of the three test cases, in order. For example, an output of the form $[[\\gamma_1^\\ast,E_1,\\rho_1],[\\gamma_2^\\ast,E_2,\\rho_2],[\\gamma_3^\\ast,E_3,\\rho_3]]$. Each float must be rounded to six decimal places. No physical units are required in the output since all quantities are dimensionless scalars.", "solution": "The problem is valid. It is a well-defined computational task in the field of numerical methods for partial differential equations, specifically addressing the optimization of local time-stepping schemes in computational fluid dynamics. The problem is scientifically grounded, self-contained, and all terms and objectives are specified formally.\n\nThe solution requires a multi-step process for each test case. For each candidate value of the face-coherence factor $\\gamma$, we must compute an objective function $J(\\gamma)$ and then select the $\\gamma$ that maximizes this function. The steps to calculate $J(\\gamma)$ are as follows:\n\n1.  **Compute Face Quantities**: Given cell-centered characteristic speeds $a_i$ for $i \\in \\{0, \\dots, N-1\\}$, we first compute the speeds at the cell faces. The problem specifies an arithmetic mean: $a_{i+1/2} = \\frac{1}{2}(a_i + a_{i+1})$. All indices are periodic, so $a_{N-1/2} = \\frac{1}{2}(a_{N-1} + a_0)$.\n\n2.  **Calculate Initial Time Steps**: The initial time step for each cell, $\\Delta t^{\\mathrm{CFL}}_i$, is determined by the local Courant–Friedrichs–Lewy (CFL) condition. This is defined as $\\Delta t^{\\mathrm{CFL}}_i = \\mathrm{CFL} \\cdot \\Delta x_i / s_i$, where $\\mathrm{CFL}=0.9$ is the Courant number, $\\Delta x_i$ is the width of cell $i$, and $s_i = \\max\\{a_{i-1/2}, a_{i+1/2}\\}$ is the maximum of the speeds at the two faces bounding cell $i$.\n\n3.  **Enforce Face Coherence**: The initial time steps $\\Delta t^{\\mathrm{CFL}}_i$ must be adjusted to satisfy the face-coherent constraint: for any two adjacent cells $i$ and $i+1$, their time steps must satisfy $\\max\\{\\Delta t_i, \\Delta t_{i+1}\\} \\le \\gamma \\min\\{\\Delta t_i, \\Delta t_{i+1}\\}$. This is equivalent to ensuring the ratio of time steps of any two neighbors is no larger than $\\gamma$. The problem specifies an iterative projection: for any neighboring pair $(\\Delta t_i, \\Delta t_{i+1})$ that violates the constraint, the larger of the two is reduced to be exactly $\\gamma$ times the smaller one. This process is repeated over all cell faces until no further changes occur, ensuring all time steps satisfy the constraint. This relaxation process converges because time steps are only ever decreased and are bounded below by zero. Let the resulting time steps be denoted by $\\Delta t_i(\\gamma)$.\n\n4.  **Construct Iteration Operator $M(\\Delta t)$**: The one-step explicit finite volume update is given by:\n    $$\n    u_i^{n+1} = u_i^n - \\left(\\frac{\\Delta t_i}{\\Delta x_i}\\right)\\left(F_{i+1/2}(u^n) - F_{i-1/2}(u^n)\\right)\n    $$\n    Since all characteristic speeds $a_i$ are positive, the upwind flux at face $i+1/2$ (between cells $i$ and $i+1$) depends on the upstream state, which is $u_i^n$. Thus, $F_{i+1/2}(u^n) = a_{i+1/2} u_i^n$. Similarly, $F_{i-1/2}(u^n) = a_{i-1/2} u_{i-1}^n$. Substituting these into the update equation gives:\n    $$\n    u_i^{n+1} = u_i^n - \\frac{\\Delta t_i(\\gamma)}{\\Delta x_i} \\left(a_{i+1/2} u_i^n - a_{i-1/2} u_{i-1}^n\\right)\n    $$\n    Rearranging terms to identify contributions from $u_i^n$ and $u_{i-1}^n$ yields:\n    $$\n    u_i^{n+1} = \\left(1 - \\frac{\\Delta t_i(\\gamma)}{\\Delta x_i} a_{i+1/2}\\right) u_i^n + \\left(\\frac{\\Delta t_i(\\gamma)}{\\Delta x_i} a_{i-1/2}\\right) u_{i-1}^n\n    $$\n    This equation defines the $i$-th row of the linear iteration operator $M(\\Delta t(\\gamma))$ in the matrix equation $u^{n+1} = M u^n$. For each row $i$, the matrix $M$ has two non-zero entries:\n    -   On the main diagonal: $M_{ii} = 1 - \\frac{\\Delta t_i(\\gamma)}{\\Delta x_i} a_{i+1/2}$\n    -   On the sub-diagonal (with periodic wrap-around): $M_{i, (i-1)\\pmod N} = \\frac{\\Delta t_i(\\gamma)}{\\Delta x_i} a_{i-1/2}$\n\n5.  **Compute Spectral Radius $\\rho(M)$**: The asymptotic convergence rate of the linear iteration is determined by the spectral radius of $M$, $\\rho(M)$, which is the maximum absolute value of its eigenvalues. This is computed numerically.\n\n6.  **Compute Parallel Efficiency $E(\\gamma)$**: The parallel efficiency under a multirate subcycling schedule is given by:\n    $$\n    E(\\gamma) = \\frac{N}{\\sum_{i=0}^{N-1} \\lceil \\max_j \\Delta t_j(\\gamma) / \\Delta t_i(\\gamma) \\rceil}\n    $$\n    This metric accounts for the workload imbalance caused by cells taking different numbers of sub-steps within a global macro-step of duration $\\max_j \\Delta t_j$.\n\n7.  **Compute Objective Function $J(\\gamma)$**: The final objective function balances convergence rate (related to $1-\\rho$) and parallel efficiency ($E$):\n    $$\n    J(\\gamma) = E(\\gamma) \\cdot \\max\\{0, 1 - \\rho(M(\\Delta t(\\gamma)))\\}\n    $$\n    A scheme is unstable if $\\rho(M) \\ge 1$, which correctly yields $J(\\gamma) = 0$.\n\n8.  **Optimization**: For each test case, the above steps are performed for every candidate $\\gamma$. The optimal value, $\\gamma^\\ast$, is the one that maximizes $J(\\gamma)$. In case of a tie (determined within a small numerical tolerance), the smallest $\\gamma$ among the tied candidates is chosen. The final output for each test case is the triplet $[\\gamma^\\ast, E(\\gamma^\\ast), \\rho(M(\\Delta t(\\gamma^\\ast)))]$.", "answer": "```python\nimport numpy as np\n\ndef calculate_objective(N, dx, a, cfl, gamma):\n    \"\"\"\n    Calculates the objective function J for a given set of parameters and gamma.\n\n    This function implements steps 1-7 of the solution methodology:\n    1. Compute face speeds.\n    2. Calculate initial CFL-limited time steps.\n    3. Enforce face coherence via iterative projection.\n    4. Construct the iteration matrix M.\n    5. Compute its spectral radius rho.\n    6. Compute the parallel efficiency E.\n    7. Compute the final objective J.\n    \"\"\"\n    # Step 1: Compute face speeds\n    a_face = 0.5 * (a + np.roll(a, -1))\n\n    # Step 2: Calculate initial CFL-limited time steps\n    s = np.maximum(a_face, np.roll(a_face, 1))\n    # Avoid division by zero if s_i can be zero, though problem states a_i > 0\n    s[s == 0] = 1e-16\n    dt = cfl * dx / s\n\n    # Step 3: Perform face-coherent projection\n    dt_proj = dt.copy()\n    max_iter = 1000 # Safety break for the while loop\n    for _ in range(max_iter):\n        num_changes = 0\n        dt_old = dt_proj.copy()\n        for i in range(N):\n            j = (i + 1) % N\n            dt_i, dt_j = dt_proj[i], dt_proj[j]\n            \n            if dt_i > gamma * dt_j:\n                dt_proj[i] = gamma * dt_j\n            elif dt_j > gamma * dt_i:\n                dt_proj[j] = gamma * dt_i\n        \n        if np.allclose(dt_proj, dt_old):\n            break\n    \n    dt_gamma = dt_proj\n    \n    # Step 4: Construct the iteration matrix M\n    M = np.zeros((N, N))\n    diag_vals = 1.0 - (dt_gamma / dx) * a_face\n    np.fill_diagonal(M, diag_vals)\n    \n    subdiag_vals = (dt_gamma / dx) * np.roll(a_face, 1)\n    rows = np.arange(N)\n    cols = (rows - 1) % N\n    M[rows, cols] = subdiag_vals\n    \n    # Step 5: Compute spectral radius of M\n    eigenvalues = np.linalg.eigvals(M)\n    rho = np.max(np.abs(eigenvalues))\n    \n    # Step 6: Compute parallel multirate efficiency E\n    dt_max = np.max(dt_gamma)\n    ratios = dt_max / dt_gamma\n    sum_of_ceilings = np.sum(np.ceil(ratios))\n    E = N / sum_of_ceilings\n    \n    # Step 7: Compute objective function J\n    J = E * np.maximum(0.0, 1.0 - rho)\n    \n    return J, E, rho\n\ndef find_optimal_gamma(N, dx, a, cfl, candidate_gammas):\n    \"\"\"\n    Finds the optimal gamma from a candidate list for a single test case.\n    \"\"\"\n    results_per_gamma = []\n    \n    for gamma in candidate_gammas:\n        J, E, rho = calculate_objective(N, np.array(dx), np.array(a), cfl, gamma)\n        results_per_gamma.append({'gamma': gamma, 'J': J, 'E': E, 'rho': rho})\n        \n    if not results_per_gamma:\n        return None\n        \n    # Find the maximum J value achieved among all candidates\n    max_J = max(r['J'] for r in results_per_gamma)\n            \n    # Find the first gamma (smallest) that achieves a J value close to the max,\n    # to handle ties according to the problem specification.\n    best_result = None\n    tolerance = 1e-9\n    for result in results_per_gamma:\n        if abs(result['J'] - max_J)  tolerance:\n            best_result = result\n            break\n\n    gamma_star = best_result['gamma']\n    E_star = best_result['E']\n    rho_star = best_result['rho']\n    \n    return [\n        round(float(gamma_star), 6),\n        round(E_star, 6),\n        round(rho_star, 6)\n    ]\n\ndef solve():\n    \"\"\"\n    Main function to define test cases, run the optimization, and print the results.\n    \"\"\"\n    test_cases = [\n        {\n            \"N\": 12,\n            \"dx\": [1.0, 0.8, 1.2, 0.7, 1.3, 0.9, 0.6, 1.1, 0.95, 1.4, 0.5, 1.0],\n            \"a\": [1.0, 2.5, 1.2, 2.8, 0.9, 2.2, 1.1, 2.6, 0.8, 3.0, 1.3, 2.4],\n            \"gammas\": [1.1, 1.25, 1.5, 2.0, 3.0]\n        },\n        {\n            \"N\": 10,\n            \"dx\": [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],\n            \"a\": [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],\n            \"gammas\": [1.05, 1.2, 1.5, 2.0]\n        },\n        {\n            \"N\": 10,\n            \"dx\": [0.3, 1.5, 0.4, 2.0, 0.35, 1.8, 0.5, 2.2, 0.45, 1.6],\n            \"a\": [0.4, 2.8, 0.5, 3.2, 0.6, 2.5, 0.7, 3.0, 0.8, 2.7],\n            \"gammas\": [1.2, 1.5, 1.8, 2.5, 3.5]\n        }\n    ]\n    \n    cfl = 0.9\n    \n    final_results = []\n    for case in test_cases:\n        result = find_optimal_gamma(case[\"N\"], case[\"dx\"], case[\"a\"], cfl, case[\"gammas\"])\n        # Format the list as a string for inclusion in the final output string\n        final_results.append(str(result))\n        \n    # Print the final output in the exact required format\n    print(f\"[{','.join(final_results)}]\")\n\nsolve()\n```", "id": "3341467"}]}