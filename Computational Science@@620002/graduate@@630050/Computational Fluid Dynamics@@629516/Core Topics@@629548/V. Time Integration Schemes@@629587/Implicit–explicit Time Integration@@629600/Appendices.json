{"hands_on_practices": [{"introduction": "A crucial first step in evaluating any time integration scheme is to understand its stability. This exercise guides you through a von Neumann stability analysis, the cornerstone for analyzing linear problems with periodic boundary conditions. By deriving the amplification factor for a specific second-order IMEX Runge-Kutta scheme, you will determine the precise stability boundary, a fundamental skill for predicting and ensuring the robustness of a simulation [@problem_id:3334251].", "problem": "Consider the linear advection–diffusion equation in one spatial dimension,\n$$\n\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = \\nu \\frac{\\partial^{2} u}{\\partial x^{2}},\n$$\nposed on a periodic domain with a uniform grid of spacing $\\Delta x$. Let the advection speed $a$ and kinematic viscosity $\\nu$ be constant and nonnegative. Perform a von Neumann (Fourier) stability analysis for a two-stage Implicit–Explicit (IMEX) Runge–Kutta (RK) method in which advection is treated explicitly and diffusion implicitly.\n\nAssume the following semi-discrete spatial operators are used:\n- for advection with $a \\ge 0$, the first-order upwind difference $D^{-} u_{j} = (u_{j} - u_{j-1})/\\Delta x$, whose discrete Fourier symbol for wavenumber $\\theta \\in [0,\\pi]$ is $-a (1 - \\exp(-\\mathrm{i}\\theta))/\\Delta x$,\n- for diffusion, the second-order centered Laplacian $L u_{j} = (u_{j+1} - 2 u_{j} + u_{j-1})/\\Delta x^{2}$, whose discrete Fourier symbol is $-4 \\nu \\sin^{2}(\\theta/2)/\\Delta x^{2}$.\n\nDefine the Courant number and diffusion number,\n$$\nC = \\frac{a \\Delta t}{\\Delta x}, \\qquad D = \\frac{\\nu \\Delta t}{\\Delta x^{2}},\n$$\nand consider the two-stage second-order IMEX RK scheme of Ascher–Ruuth–Spiteri with parameter\n$$\n\\gamma = 1 - \\frac{1}{\\sqrt{2}},\n$$\nwith explicit and implicit Butcher tableaux\n$$\n\\text{Explicit (advection):}\\quad \n\\begin{array}{c|cc}\n0 & 0 & 0 \\\\\n1 & 1 & 0 \\\\\n\\hline\n & \\tfrac{1}{2} & \\tfrac{1}{2}\n\\end{array}\n$$\n$$\n\\text{Implicit (diffusion):}\\quad \n\\begin{array}{c|cc}\n\\gamma & \\gamma & 0 \\\\\n1-\\gamma & 1 - 2\\gamma & \\gamma \\\\\n\\hline\n & \\tfrac{1}{2} & \\tfrac{1}{2}\n\\end{array}\n$$\n\nLet $G(\\theta)$ denote the one-step amplification factor of this IMEX RK method applied to the semi-discrete system for the Fourier mode with wavenumber $\\theta$. Derive $G(\\theta)$ from first principles and determine the maximum Courant number $C_{\\max}$ such that the scheme is stable in the von Neumann sense for all discrete wavenumbers, namely,\n$$\n|G(\\theta)| \\le 1 \\quad \\text{for all} \\quad \\theta \\in [0,\\pi],\n$$\nuniformly with respect to any nonnegative diffusion number $D \\ge 0$. Express your final answer as a dimensionless number. No rounding is required.", "solution": "The user wants to perform a von Neumann stability analysis for a given Implicit-Explicit (IMEX) Runge-Kutta scheme applied to the linear advection-diffusion equation.\n\n### Step 1: Problem Validation\n\n**Extract Givens:**\n-   **PDE:** $\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = \\nu \\frac{\\partial^{2} u}{\\partial x^{2}}$ on a periodic domain.\n-   **Constants:** advection speed $a \\ge 0$, kinematic viscosity $\\nu \\ge 0$.\n-   **Spatial Discretization:** Uniform grid with spacing $\\Delta x$.\n-   **Advection Operator (Explicit):** First-order upwind difference for $a \\ge 0$, $-a D^{-} u_{j} = -a (u_{j} - u_{j-1})/\\Delta x$.\n-   **Advection Fourier Symbol:** The symbol for the operator $-a D^{-}$ is given as $-a (1 - \\exp(-\\mathrm{i}\\theta))/\\Delta x$ for wavenumber $\\theta \\in [0,\\pi]$.\n-   **Diffusion Operator (Implicit):** Second-order centered Laplacian, $\\nu L u_{j} = \\nu (u_{j+1} - 2 u_{j} + u_{j-1})/\\Delta x^{2}$.\n-   **Diffusion Fourier Symbol:** The symbol for the operator $\\nu L$ is given as $-4 \\nu \\sin^{2}(\\theta/2)/\\Delta x^{2}$.\n-   **Dimensionless Numbers:** Courant number $C = \\frac{a \\Delta t}{\\Delta x}$, Diffusion number $D = \\frac{\\nu \\Delta t}{\\Delta x^{2}}$.\n-   **IMEX Scheme:** A two-stage, second-order scheme defined by explicit and implicit Butcher tableaux and the parameter $\\gamma = 1 - \\frac{1}{\\sqrt{2}}$.\n    $$\n    \\text{Explicit (advection):}\\quad A_E = \\begin{pmatrix} 0 & 0 \\\\ 1 & 0 \\end{pmatrix}, \\quad b_E^T = (\\tfrac{1}{2}, \\tfrac{1}{2})\n    $$\n    $$\n    \\text{Implicit (diffusion):}\\quad A_I = \\begin{pmatrix} \\gamma & 0 \\\\ 1 - 2\\gamma & \\gamma \\end{pmatrix}, \\quad b_I^T = (\\tfrac{1}{2}, \\tfrac{1}{2})\n    $$\n-   **Stability Condition:** The one-step amplification factor $G(\\theta)$ must satisfy $|G(\\theta)| \\le 1$ for all $\\theta \\in [0,\\pi]$ and for any nonnegative diffusion number $D \\ge 0$.\n-   **Objective:** Derive $G(\\theta)$ and find the maximum Courant number $C_{\\max}$ that satisfies the stability condition.\n\n**Validate Using Extracted Givens:**\n-   **Scientifically Grounded:** The problem is a standard exercise in the numerical analysis of partial differential equations, specifically in the field of computational fluid dynamics. The advection-diffusion equation, von Neumann analysis, and IMEX-RK methods are all fundamental and well-established concepts. The setup is scientifically sound.\n-   **Well-Posed:** The problem provides all necessary information: the equation, the discretization methods, their Fourier symbols, the time-stepping scheme, and the stability criterion. The objective is to find a single, specific numerical value ($C_{\\max}$). The problem is well-posed.\n-   **Objective:** The problem is formulated using precise mathematical language and definitions, free from ambiguity or subjective claims.\n\n**Verdict:** The problem is valid.\n\n### Step 2: Derivation of the Amplification Factor\n\nThe semi-discrete form of the PDE for each grid point $u_j$ is given by:\n$$\n\\frac{du_j}{dt} = \\underbrace{-a D^{-} u_j}_{\\text{Explicit}} + \\underbrace{\\nu L u_j}_{\\text{Implicit}}\n$$\nWe perform a von Neumann analysis by considering a single Fourier mode $u_j(t) = \\hat{u}(t) \\exp(\\mathrm{i} j \\theta)$, where $\\theta = k_m \\Delta x$ is the dimensionless wavenumber. Substituting this into the semi-discrete equation yields an ordinary differential equation for the mode amplitude $\\hat{u}(t)$:\n$$\n\\frac{d\\hat{u}}{dt} = (\\hat{F} + \\hat{N}) \\hat{u}\n$$\nwhere $\\hat{F}$ and $\\hat{N}$ are the Fourier symbols (eigenvalues) of the explicit and implicit spatial operators, respectively. Using the provided symbols:\n$$\n\\hat{F} = -a \\frac{1 - \\exp(-\\mathrm{i}\\theta)}{\\Delta x}\n$$\n$$\n\\hat{N} = \\nu \\frac{-4 \\sin^{2}(\\theta/2)}{\\Delta x^{2}} = \\nu \\frac{2(\\cos(\\theta)-1)}{\\Delta x^2}\n$$\nLet us define the dimensionless parameters $z_E = \\Delta t \\hat{F}$ and $z_I = \\Delta t \\hat{N}$.\n$$\nz_E = -\\frac{a \\Delta t}{\\Delta x} (1 - \\exp(-\\mathrm{i}\\theta)) = -C(1 - \\cos\\theta + \\mathrm{i}\\sin\\theta)\n$$\n$$\nz_I = \\frac{\\nu \\Delta t}{\\Delta x^2} (2(\\cos\\theta - 1)) = -2D(1 - \\cos\\theta)\n$$\nNote that $z_I$ is always real and non-positive for $D \\ge 0$.\n\nThe amplification factor $G(\\theta) = G(z_E, z_I)$ is the stability function of the IMEX-RK scheme applied to the scalar linear ODE $\\hat{u}' = (\\hat{F}+\\hat{N})\\hat{u}$. For a Diagonally Implicit Runge-Kutta (DIRK) structure on the implicit part, the stages $K_i$ of the method applied to $y' = Fy+Ny$ (with $F=\\hat{F}, N=\\hat{N}$) are:\n$$\nK_i = y_n + \\Delta t \\sum_{j=1}^{i-1} a_{ij} F K_j + \\Delta t \\sum_{j=1}^{i} \\tilde{a}_{ij} N K_j\n$$\nFor our linear problem, let $U^{(i)}$ be the stage solutions.\nStage 1:\n$$\nU^{(1)} = u_n + \\Delta t \\tilde{a}_{11} N U^{(1)} \\implies (1 - \\tilde{a}_{11} z_I)U^{(1)} = u_n\n$$\nWith $\\tilde{a}_{11} = \\gamma$, we have $U^{(1)} = (1 - \\gamma z_I)^{-1} u_n$.\nStage 2:\n$$\nU^{(2)} = u_n + \\Delta t a_{21} F U^{(1)} + \\Delta t (\\tilde{a}_{21} N U^{(1)} + \\tilde{a}_{22} N U^{(2)})\n$$\n$$\n(1 - \\tilde{a}_{22} z_I)U^{(2)} = u_n + (a_{21}z_E + \\tilde{a}_{21}z_I) U^{(1)}\n$$\nUsing $a_{21}=1$, $\\tilde{a}_{21}=1-2\\gamma$, $\\tilde{a}_{22}=\\gamma$:\n$$\n(1 - \\gamma z_I)U^{(2)} = u_n + (z_E + (1-2\\gamma)z_I) (1-\\gamma z_I)^{-1}u_n\n$$\n$$\nU^{(2)} = \\left[ (1-\\gamma z_I)^{-1} + (z_E + (1-2\\gamma)z_I)(1-\\gamma z_I)^{-2} \\right] u_n\n$$\nThe final solution is given by:\n$$\nu_{n+1} = u_n + \\Delta t \\sum_{i=1}^2 b_i F U^{(i)} + \\Delta t \\sum_{i=1}^2 \\tilde{b}_i N U^{(i)}\n$$\nSince $b_i = \\tilde{b}_i = 1/2$, we have:\n$$\nu_{n+1} = u_n + \\frac{1}{2}(z_E+z_I)(U^{(1)} + U^{(2)})\n$$\nThe amplification factor $G(z_E, z_I) = u_{n+1}/u_n$ is:\n$$\nG(z_E, z_I) = 1 + \\frac{1}{2}(z_E+z_I) \\left[ \\frac{U^{(1)}}{u_n} + \\frac{U^{(2)}}{u_n} \\right]\n$$\n$$\nG = 1 + \\frac{1}{2}(z_E+z_I) \\left[ 2(1-\\gamma z_I)^{-1} + (z_E + (1-2\\gamma)z_I)(1-\\gamma z_I)^{-2} \\right]\n$$\n$$\nG = 1 + \\frac{z_E+z_I}{2(1-\\gamma z_I)^2} [2(1-\\gamma z_I) + z_E + (1-2\\gamma)z_I]\n$$\n$$\nG = \\frac{2(1-\\gamma z_I)^2 + (z_E+z_I)(2+z_E+(1-4\\gamma)z_I)}{2(1-\\gamma z_I)^2}\n$$\nExpanding the numerator:\n$N_G = 2(1-2\\gamma z_I + \\gamma^2 z_I^2) + (2z_E+z_E^2+2z_I+(2-4\\gamma)z_Ez_I+(1-4\\gamma)z_I^2)$\n$N_G = (2+2z_E+z_E^2) + (2-4\\gamma)z_I + (2-4\\gamma)z_Ez_I + (2\\gamma^2-4\\gamma+1)z_I^2$\nThe parameter $\\gamma=1-1/\\sqrt{2}$ is a root of $2\\gamma^2-4\\gamma+1=0$. Thus, the $z_I^2$ term vanishes.\n$$\nN_G = (2+2z_E+z_E^2) + (2-4\\gamma)z_I(1+z_E)\n$$\nThe amplification factor simplifies to:\n$$\nG(z_E, z_I) = \\frac{1+z_E+\\frac{1}{2}z_E^2 + (1-2\\gamma)z_I(1+z_E)}{(1-\\gamma z_I)^2}\n$$\n\n### Step 3: Stability Analysis\n\nThe stability condition is $|G(z_E, z_I)| \\le 1$ for all $\\theta \\in [0, \\pi]$ and all $D \\ge 0$.\nA necessary condition for stability is obtained by considering the case with no diffusion, $D=0$, which implies $z_I=0$.\n$$\n|G(z_E, 0)| = |1 + z_E + \\frac{1}{2}z_E^2| \\le 1\n$$\nThis is the stability condition for the explicit part of the scheme (Heun's method). The complex number $z_E$ traces a curve in the complex plane as $\\theta$ varies. We must find the maximum $C$ for which this entire curve lies within the stability region of Heun's method.\nThe curve is given by $z_E = -C(1-e^{-\\mathrm{i}\\theta})$. This can be rewritten as $z_E+C = Ce^{-i\\theta}$, which describes a circle of radius $C$ centered at $-C$. As $\\theta$ sweeps from $0$ to $\\pi$, $z_E$ traces the lower semi-circle from $z_E(0)=0$ to $z_E(\\pi)=-2C$.\n\nThe stability region of Heun's method, $S = \\{z \\in \\mathbb{C} : |1+z+\\frac{1}{2}z^2| \\le 1\\}$, intersects the negative real axis at $z \\in [-2, 0]$. This is found by setting $z=-x$ for $x>0$ and solving $|1-x+\\frac{1}{2}x^2|\\le 1$, which simplifies to $x(x-2)\\le 0$, yielding $0 \\le x \\le 2$.\nThe endpoint of our curve $z_E(\\pi)=-2C$ must be in this interval. Since $C \\ge 0$, we require $-2C \\ge -2$, which implies $C \\le 1$. Thus, a necessary condition is $C_{\\max} \\le 1$.\n\nLet's check if $C=1$ is sufficient for the $D=0$ case. For $C=1$, the curve is $|z_E+1|=1$ with $\\mathrm{Im}(z_E) \\le 0$. We check if this curve is in $S$. Let $z_E = -1+e^{-\\mathrm{i}\\phi}$ for $\\phi \\in [0, \\pi]$.\n$$\n|1+z_E+\\frac{1}{2}z_E^2| = |1+(-1+e^{-\\mathrm{i}\\phi})+\\frac{1}{2}(-1+e^{-\\mathrm{i}\\phi})^2| = |e^{-\\mathrm{i}\\phi}+\\frac{1}{2}(1-2e^{-\\mathrm{i}\\phi}+e^{-2\\mathrm{i}\\phi})| = |\\frac{1}{2}(1+e^{-2\\mathrm{i}\\phi})|\n$$\n$$\n|\\frac{1}{2}(1+e^{-2\\mathrm{i}\\phi})|^2 = \\frac{1}{4}(1+e^{-2\\mathrm{i}\\phi})(1+e^{2\\mathrm{i}\\phi}) = \\frac{1}{4}(2+2\\cos(2\\phi)) = \\frac{1+\\cos(2\\phi)}{2} = \\cos^2(\\phi)\n$$\nSince $|\\cos^2(\\phi)| \\le 1$ for all $\\phi$, the stability condition is satisfied for all points on this curve. Thus, for the purely explicit case, $C_{\\max}=1$.\n\nNow, we must verify that with $C=1$, the scheme remains stable for any $D > 0$. We need to show that $|G(z_E, z_I)| \\le 1$ holds for $z_E$ on the curve for $C=1$ and for any $z_I = -X$ where $X = 2D(1-\\cos\\theta) \\ge 0$. The condition is:\n$$\n|R_E(z_E) + (1-2\\gamma)z_I(1+z_E)|^2 \\le |(1-\\gamma z_I)^2|^2\n$$\nwhere $R_E(z_E) = 1+z_E+\\frac{1}{2}z_E^2$. Substituting $z_I = -X$:\n$$\n|R_E(z_E) - (1-2\\gamma)X(1+z_E)|^2 \\le (1+\\gamma X)^4\n$$\nLet's expand and rearrange this into a polynomial inequality in $X$:\n$$\nP(X) = (1+\\gamma X)^4 - |R_E(z_E) - (1-2\\gamma)X(1+z_E)|^2 \\ge 0\n$$\nExpanding the terms as a polynomial in $X$, we require $P(X) \\ge 0$ for all $X \\ge 0$.\n$P(X) = (1+4\\gamma X+6\\gamma^2 X^2+\\dots) - (|R_E|^2 - 2X\\text{Re}(R_E\\overline{(1-2\\gamma)(1+z_E)}) + X^2|(1-2\\gamma)(1+z_E)|^2)$\n$P(X)= (\\gamma^4 X^4 + 4\\gamma^3 X^3) + (6\\gamma^2 - |(1-2\\gamma)(1+z_E)|^2)X^2 + (4\\gamma + 2\\text{Re}(R_E \\overline{A}))X + (1-|R_E|^2)$, where $A=(1-2\\gamma)(1+z_E)$.\nFor $C=1$, we found $|R_E|^2 = \\cos^2\\theta$. So the constant term is $1-\\cos^2\\theta = \\sin^2\\theta \\ge 0$.\nThe coefficient of $X$ is $4\\gamma + 2\\text{Re}(R_E \\bar{A})$.\n$A=(1-2\\gamma)(1+z_E) = (1-2\\gamma)e^{-\\mathrm{i}\\theta}$. $\\bar{A}=(1-2\\gamma)e^{\\mathrm{i}\\theta}$.\n$R_E = \\frac{1}{2}(1+e^{-2\\mathrm{i}\\theta})$.\n$R_E \\bar{A} = \\frac{1}{2}(1+e^{-2\\mathrm{i}\\theta})(1-2\\gamma)e^{\\mathrm{i}\\theta} = \\frac{1-2\\gamma}{2}(e^{\\mathrm{i}\\theta}+e^{-\\mathrm{i}\\theta}) = (1-2\\gamma)\\cos\\theta$.\nThe term is real, so its real part is itself. The coefficient is $4\\gamma+2(1-2\\gamma)\\cos\\theta=2(2\\gamma+(1-2\\gamma)\\cos\\theta)$.\nSince $\\gamma \\approx 0.293$, $1-2\\gamma \\approx 0.414$, both positive. The expression's minimum is at $\\cos\\theta=-1$, which is $2(2\\gamma-(1-2\\gamma))=2(4\\gamma-1) = 2(4(1-1/\\sqrt{2})-1)=2(3-2\\sqrt{2})>0$. So this coefficient is non-negative.\nThe coefficient of $X^2$ is $6\\gamma^2 - |A|^2 = 6\\gamma^2-(1-2\\gamma)^2$.\n$\\gamma=1-1/\\sqrt{2} \\implies (1-\\gamma)^2=1/2 \\implies 1-2\\gamma+\\gamma^2=1/2 \\implies \\gamma^2=2\\gamma-1/2$.\n$1-2\\gamma = \\sqrt{2}-1$.\nThe coefficient is $6(2\\gamma-1/2) - (1-2\\gamma)^2 = 12\\gamma-3 - (\\sqrt{2}-1)^2 = 12(1-1/\\sqrt{2})-3 - (3-2\\sqrt{2}) = 12-6\\sqrt{2}-3-3+2\\sqrt{2} = 6-4\\sqrt{2}>0$.\nFinally, the coefficients of $X^3$ and $X^4$ are $4\\gamma^3$ and $\\gamma^4$, which are positive.\nAll coefficients of the polynomial $P(X)$ are non-negative for any $\\theta \\in [0,\\pi]$ when $C=1$. Since we consider $X \\ge 0$, this guarantees $P(X) \\ge 0$.\nTherefore, the choice $C=1$ is stable for all $D \\ge 0$. Since we already established that $C_{\\max} \\le 1$, we conclude that $C_{\\max}=1$.", "answer": "$$\n\\boxed{1}\n$$", "id": "3334251"}, {"introduction": "Theoretical analysis must be complemented by practical implementation, especially for nonlinear problems where new challenges arise. This practice focuses on developing a first-order IMEX solver for a scalar conservation law, a common model in fluid dynamics [@problem_id:3334223]. You will engage with critical concepts like mass conservation and positivity preservation, learning how to construct a scheme that respects the underlying physics of the problem.", "problem": "Consider the one-dimensional scalar conservation law with linear reaction on a periodic domain, given by the partial differential equation (PDE)\n$$\nu_t + \\partial_x\\left(\\frac{u^2}{2}\\right) = -k\\,u,\n$$\nwhere $u(x,t) \\ge 0$ is the unknown scalar field, $k \\ge 0$ is a spatially uniform reaction rate, $x \\in [0,1]$ with periodic boundary conditions, and $t \\ge 0$. The goal is to design and analyze a first-order Implicit–Explicit (IMEX) time integration method for this PDE and to investigate positivity preservation and mass conservation properties. The acronym IMEX stands for Implicit–Explicit, i.e., treating the convective flux term explicitly and the reaction term implicitly.\n\nStarting from the finite-volume formulation for a uniform grid with $N$ cells and cell width $\\Delta x = 1/N$, let $u_i^n$ denote the cell average in cell $i$ at time level $t^n$. Use the following foundational principles:\n- Conservation form for the convective flux: the explicit update is determined by numerical fluxes crossing cell interfaces, ensuring local conservation.\n- Backward Euler for linear reaction: the implicit update solves a local algebraic equation per cell.\n\nDerive from first principles a one-step IMEX Euler scheme of the form\n$$\nu_i^{n+1} = \\frac{u_i^n + \\Delta t\\,R_i(u^n)}{1 + k\\,\\Delta t},\n$$\nwhere $R_i(u^n)$ approximates $-\\partial_x\\left(\\frac{u^2}{2}\\right)$ using interface numerical fluxes in conservative form. Select the Godunov flux for Burgers’ equation as the monotone numerical flux\n$$\nF_{i+\\frac{1}{2}} = \\mathcal{G}(u_i^n,u_{i+1}^n),\n$$\nwith the well-known case-based definition for Burgers’ flux $f(u)=\\tfrac{u^2}{2}$:\n- If $u_L \\le u_R$: then $F = f(u_L)$ if $u_L \\ge 0$, $F = f(u_R)$ if $u_R \\le 0$, and $F = f(0) = 0$ otherwise.\n- If $u_L > u_R$: the shock speed is $s = \\frac{f(u_L) - f(u_R)}{u_L - u_R} = \\frac{u_L + u_R}{2}$; set $F = f(u_L)$ if $s \\ge 0$ and $F = f(u_R)$ otherwise.\n\nUse the Courant–Friedrichs–Lewy (CFL) condition for stability of the explicit convective part, based on the characteristic speed $|f'(u)| = |u|$,\n$$\n\\Delta t = \\text{CFL}\\,\\frac{\\Delta x}{\\max_i |u_i^n|},\n$$\nwith $\\text{CFL} \\in (0,1]$.\n\nTasks:\n1. Derive $R_i(u^n)$ explicitly from conservation principles in terms of interface fluxes $F_{i+\\frac{1}{2}}$ and $F_{i-\\frac{1}{2}}$, and explain why the explicit convective update conserves the discrete total mass on a periodic domain.\n2. Prove a positivity condition for the explicit convective update with the Godunov flux under the stated CFL condition when the initial data are nonnegative, and prove positivity preservation for the implicit reaction step with backward Euler.\n3. Propose a limiter strategy that is consistent across explicit and implicit stages, i.e., one that preserves nonnegativity of cell averages in the explicit stage (for example, by using a monotone flux or a bound-preserving correction) and that does not violate the positivity of the implicit reaction update. Justify the consistency of this strategy with conservation in the explicit stage and with local positivity in the implicit stage.\n\nImplementation requirement:\n- Implement a single IMEX Euler step on a periodic domain for test cases defined below. Compute the following diagnostics for each test case:\n    - Positivity after the explicit convective stage: a boolean indicating whether $\\min_i u_i^{\\star} \\ge -10^{-12}$, where $u_i^{\\star} = u_i^n + \\Delta t\\,R_i(u^n)$.\n    - Discrete mass conservation error for the explicit stage: the absolute relative change\n      $$\n      \\left|\\frac{M^{\\star} - M^n}{M^n}\\right|,\n      $$\n      where $M^n = \\sum_i u_i^n \\Delta x$ and $M^{\\star} = \\sum_i u_i^{\\star} \\Delta x$.\n    - Positivity after the full IMEX step: a boolean indicating whether $\\min_i u_i^{n+1} \\ge -10^{-12}$.\n    - Discrete reaction mass consistency error: the absolute relative error\n      $$\n      \\left|\\frac{M^{n+1} - \\frac{M^{\\star}}{1+k\\,\\Delta t}}{\\frac{M^{\\star}}{1+k\\,\\Delta t}}\\right|,\n      $$\n      where $M^{n+1} = \\sum_i u_i^{n+1} \\Delta x$.\n\n- Grid and domain: use a uniform grid on $[0,1]$ with periodic boundary conditions. Treat all quantities as dimensionless.\n\nTest suite:\n- Case A (smooth, moderate reaction, safe CFL): $N=200$, initial condition $u(x)=1+0.2\\sin(2\\pi x)$, $k=0.3$, $\\text{CFL}=0.5$.\n- Case B (near-CFL boundary, weak reaction): $N=100$, initial condition $u(x)=1+0.99\\sin(2\\pi x)$, $k=0.01$, $\\text{CFL}=1.0$.\n- Case C (stiff reaction, safe CFL): $N=200$, initial condition $u(x)=1+0.5\\sin(2\\pi x)$, $k=1000$, $\\text{CFL}=0.5$.\n- Case D (compact support, near-CFL, moderate reaction): $N=400$, initial condition $u(x)=\\max\\{0,\\,1-10|x-0.5|\\}$, $k=1.0$, $\\text{CFL}=0.9$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the following order across the four cases:\n$$\n[\\text{pos\\_explicit\\_A},\\,\\text{mass\\_err\\_explicit\\_A},\\,\\text{pos\\_full\\_A},\\,\\text{mass\\_err\\_implicit\\_A},\\,\\text{pos\\_explicit\\_B},\\,\\text{mass\\_err\\_explicit\\_B},\\,\\text{pos\\_full\\_B},\\,\\text{mass\\_err\\_implicit\\_B},\\,\\text{pos\\_explicit\\_C},\\,\\text{mass\\_err\\_explicit\\_C},\\,\\text{pos\\_full\\_C},\\,\\text{mass\\_err\\_implicit\\_C},\\,\\text{pos\\_explicit\\_D},\\,\\text{mass\\_err\\_explicit\\_D},\\,\\text{pos\\_full\\_D},\\,\\text{mass\\_err\\_implicit\\_D}].\n$$\nEach boolean is either True or False, and each error value is a floating-point number.", "solution": "We begin from the conservation law with reaction\n$$\nu_t + \\partial_x f(u) = -k\\,u,\\quad f(u) = \\frac{u^2}{2},\n$$\non a periodic domain $x \\in [0,1]$. We discretize in space using the finite-volume method on a uniform grid with $N$ cells, $\\Delta x = 1/N$, and periodic boundary conditions. Let $u_i^n$ denote the cell average in cell $i$ at time $t^n$.\n\nFinite-volume update and explicit convection:\nFor the convective part, conservation implies the semi-discrete form\n$$\n\\frac{d u_i}{dt} = -\\frac{1}{\\Delta x}\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right),\n$$\nwhere $F_{i+\\frac{1}{2}}$ is a consistent numerical flux at the interface between cells $i$ and $i+1$, and the periodic boundary conditions imply indices are taken modulo $N$. A first-order explicit time update (Euler forward) for the convection uses\n$$\nu_i^{\\star} = u_i^n + \\Delta t\\,R_i(u^n),\\qquad R_i(u^n) = -\\frac{1}{\\Delta x}\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right),\n$$\nwith $\\Delta t$ chosen to satisfy the Courant–Friedrichs–Lewy (CFL) condition based on the largest characteristic speed. For Burgers’ equation, the characteristic speed is $|f'(u)|=|u|$, so\n$$\n\\Delta t = \\text{CFL}\\,\\frac{\\Delta x}{\\max_i |u_i^n|},\\qquad \\text{CFL} \\in (0,1].\n$$\n\nGodunov flux for Burgers:\nWe select the Godunov flux $\\mathcal{G}(u_L,u_R)$ for the scalar convex flux $f(u) = \\tfrac{u^2}{2}$. The explicit form is:\n- If $u_L \\le u_R$ (rarefaction), then\n$$\nF = \\begin{cases}\nf(u_L), & u_L \\ge 0,\\\\\nf(u_R), & u_R \\le 0,\\\\\n0, & \\text{otherwise}.\n\\end{cases}\n$$\n- If $u_L > u_R$ (shock), compute the shock speed $s = \\frac{f(u_L)-f(u_R)}{u_L-u_R} = \\frac{u_L+u_R}{2}$, and set\n$$\nF = \\begin{cases}\nf(u_L), & s \\ge 0,\\\\\nf(u_R), & s < 0.\n\\end{cases}\n$$\nThis flux is monotone, consistent, and conservative.\n\nMass conservation in the explicit convective stage:\nDefine the discrete total mass at time $t^n$ by\n$$\nM^n = \\sum_{i=0}^{N-1} u_i^n \\Delta x.\n$$\nUsing the conservative residual $R_i(u^n)$,\n$$\nM^{\\star} = \\sum_i u_i^{\\star}\\Delta x = \\sum_i \\left(u_i^n + \\Delta t R_i(u^n)\\right)\\Delta x = M^n + \\Delta t\\sum_i R_i(u^n)\\Delta x.\n$$\nSince\n$$\n\\sum_i R_i(u^n)\\Delta x = -\\sum_i\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right) = 0,\n$$\nby telescoping and periodicity, it follows that $M^{\\star} = M^n$. Therefore, the explicit convective update exactly conserves the discrete mass on a periodic domain for any consistent numerical flux, including the Godunov flux.\n\nPositivity in the explicit convective stage:\nFor scalar conservation laws with monotone flux functions under the CFL condition $\\Delta t \\le \\Delta x / \\max_i |f'(u_i^n)|$, the forward Euler explicit update can be written as a convex combination of neighboring states. In particular, for the Godunov flux and Burgers’ equation, the update $u_i^{\\star}$ satisfies a local maximum principle under $\\text{CFL} \\le 1$, which implies that if $u_i^n \\ge 0$ for all $i$, then $u_i^{\\star} \\ge 0$ for all $i$. This follows from monotonicity of the Godunov flux and that the scheme is total variation diminishing (TVD) at first order, so no new extrema outside the convex hull of neighboring values are generated. Therefore, nonnegativity is preserved by the explicit convective stage under the stated CFL constraint.\n\nImplicit reaction update and positivity:\nThe reaction-only ordinary differential equation (ODE) in each cell is\n$$\n\\frac{d u_i}{dt} = -k\\,u_i,\n$$\nwhich is linear and decoupled across cells. Backward Euler applied to this ODE gives\n$$\n\\frac{u_i^{n+1} - u_i^{\\star}}{\\Delta t} = -k\\,u_i^{n+1}\\quad\\Rightarrow\\quad u_i^{n+1} = \\frac{u_i^{\\star}}{1 + k\\,\\Delta t}.\n$$\nIf $u_i^{\\star} \\ge 0$ and $k \\ge 0$, then $u_i^{n+1} \\ge 0$ as well, so positivity is preserved by the implicit reaction step. Moreover, the discrete mass after the implicit step is\n$$\nM^{n+1} = \\sum_i u_i^{n+1}\\Delta x = \\sum_i \\frac{u_i^{\\star}}{1+k\\,\\Delta t}\\Delta x = \\frac{M^{\\star}}{1+k\\,\\Delta t}.\n$$\nThus the mass decreases by the factor $(1+k\\,\\Delta t)^{-1}$ in one backward Euler step, which is the discrete counterpart of the exact exponential decay and is consistent with the implicit treatment.\n\nLimiter strategy consistent across explicit and implicit stages:\nA consistent strategy is to use a monotone flux (Godunov) in the explicit convective stage together with a CFL $\\le 1$, guaranteeing a local maximum principle and hence nonnegativity when initialized with nonnegative cell averages. For higher-order reconstructions, one may apply a bound-preserving limiter (for example, a Zhang–Shu type scaling of reconstructed interface values to keep cell averages nonnegative) on the explicit stage while maintaining conservation by applying the limiter to the anti-diffusive corrections only. The implicit reaction stage with backward Euler is positivity preserving by construction when the explicit stage output is nonnegative. This consistency comes from:\n- Conservation in the explicit stage: flux limiting does not alter the conservative form; it only modifies interface fluxes or high-order corrections but keeps the telescoping property intact.\n- Positivity across both stages: nonnegativity maintained by the explicit stage is propagated by the implicit reaction step since division by $(1+k\\,\\Delta t)$ preserves sign.\n\nAlgorithmic design for the program:\n- Construct a uniform periodic grid on $[0,1]$ with $N$ cells.\n- Initialize $u_i^n$ by sampling the given initial condition at cell centers $x_i = (i+0.5)\\Delta x$; this serves as the cell average for a first-order method.\n- Compute $\\Delta t = \\text{CFL}\\,\\Delta x / \\max_i |u_i^n|$.\n- Compute Godunov fluxes $F_{i+\\frac{1}{2}}$ for all interfaces using the case-based formula, with periodic indexing.\n- Compute $R_i(u^n)$ via conservative flux differences, update $u_i^{\\star}$ explicitly, and track positivity and mass.\n- Apply implicit reaction update $u_i^{n+1} = u_i^{\\star}/(1+k\\,\\Delta t)$, and track positivity and mass consistency against the factor $(1+k\\,\\Delta t)^{-1}$.\n- Report the diagnostics in the specified output order.\n\nThis principled construction ties the finite-volume conservation law discretization with an IMEX Euler time integrator, and the selected monotone flux together with backward Euler guarantees the desired positivity and mass properties under the given CFL condition. The test suite covers typical and boundary regimes: smooth data with moderate reaction, near-CFL stability limit, stiff reaction, and compactly supported initial data with zero regions. The diagnostics quantify mass conservation and positivity preservation as floats and booleans, respectively, making the results directly testable.", "answer": "```python\nimport numpy as np\n\ndef godunov_flux_burgers(uL, uR):\n    # Burgers flux: f(u) = u^2 / 2\n    fL = 0.5 * uL * uL\n    fR = 0.5 * uR * uR\n    if uL <= uR:\n        # Rarefaction\n        if uL >= 0.0:\n            return fL\n        elif uR <= 0.0:\n            return fR\n        else:\n            return 0.0\n    else:\n        # Shock\n        s = 0.5 * (uL + uR)  # shock speed\n        if s >= 0.0:\n            return fL\n        else:\n            return fR\n\ndef explicit_convective_stage(u, dx, dt):\n    N = len(u)\n    # Compute interface fluxes with periodic indexing\n    F = np.empty(N, dtype=float)  # F[i] = flux at i+1/2\n    for i in range(N):\n        uL = u[i]\n        uR = u[(i + 1) % N]\n        F[i] = godunov_flux_burgers(uL, uR)\n    # Residual R_i = - (F_{i+1/2} - F_{i-1/2}) / dx\n    R = np.empty_like(u)\n    for i in range(N):\n        F_plus = F[i]\n        F_minus = F[(i - 1) % N]\n        R[i] = - (F_plus - F_minus) / dx\n    u_star = u + dt * R\n    return u_star\n\ndef implicit_reaction_step(u_star, k, dt):\n    # Backward Euler for linear reaction: u^{n+1} = u_star / (1 + k dt)\n    denom = 1.0 + k * dt\n    return u_star / denom\n\ndef initial_condition(case_id, x):\n    if case_id == 'A':\n        return 1.0 + 0.2 * np.sin(2.0 * np.pi * x)\n    elif case_id == 'B':\n        return 1.0 + 0.99 * np.sin(2.0 * np.pi * x)\n    elif case_id == 'C':\n        return 1.0 + 0.5 * np.sin(2.0 * np.pi * x)\n    elif case_id == 'D':\n        # Triangular compact support: max(0, 1 - 10 |x - 0.5|)\n        return np.maximum(0.0, 1.0 - 10.0 * np.abs(x - 0.5))\n    else:\n        raise ValueError(\"Unknown case\")\n\ndef run_case(N, k, CFL, case_id):\n    L = 1.0\n    dx = L / N\n    # Cell centers\n    i = np.arange(N)\n    x = (i + 0.5) * dx\n    # Initialize u^n\n    u_n = initial_condition(case_id, x)\n    # Compute dt from CFL and max characteristic speed |u|\n    umax = np.max(np.abs(u_n))\n    # To avoid dt=inf if umax=0 (degenerate), set dt=0 (no convection); here ensure umax>0 for cases\n    dt = CFL * dx / umax if umax > 0.0 else 0.0\n\n    # Mass at time n\n    M_n = np.sum(u_n) * dx\n\n    # Explicit convective stage\n    u_star = explicit_convective_stage(u_n, dx, dt)\n    M_star = np.sum(u_star) * dx\n    # Positivity check after explicit stage\n    pos_explicit = np.min(u_star) >= -1e-12\n    # Mass conservation error after explicit stage (relative)\n    mass_err_explicit = abs(M_star - M_n) / (M_n if M_n != 0.0 else 1.0)\n\n    # Implicit reaction step\n    u_np1 = implicit_reaction_step(u_star, k, dt)\n    M_np1 = np.sum(u_np1) * dx\n    # Positivity check after full IMEX step\n    pos_full = np.min(u_np1) >= -1e-12\n    # Reaction mass consistency error: compare against M_star / (1 + k dt)\n    denom = 1.0 + k * dt\n    target_mass = M_star / denom if denom != 0.0 else M_star\n    mass_err_implicit = abs(M_np1 - target_mass) / (target_mass if target_mass != 0.0 else 1.0)\n\n    return pos_explicit, mass_err_explicit, pos_full, mass_err_implicit\n\ndef solve():\n    test_cases = [\n        # (case_id, N, k, CFL)\n        ('A', 200, 0.3, 0.5),\n        ('B', 100, 0.01, 1.0),\n        ('C', 200, 1000.0, 0.5),\n        ('D', 400, 1.0, 0.9),\n    ]\n\n    results = []\n    for case_id, N, k, CFL in test_cases:\n        pos_explicit, mass_err_explicit, pos_full, mass_err_implicit = run_case(N, k, CFL, case_id)\n        results.extend([pos_explicit, mass_err_explicit, pos_full, mass_err_implicit])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3334223"}, {"introduction": "For problems with dynamics occurring on multiple time scales, a fixed time step can be grossly inefficient. This advanced practice introduces adaptive time-stepping, a powerful technique for creating efficient and robust solvers [@problem_id:3334246]. You will design and implement an IMEX scheme with an embedded error estimator to automatically adjust the time step, ensuring that a target accuracy is met with minimal computational effort.", "problem": "You are given a linear, constant-coefficient, semi-discrete model problem representative of a method-of-lines discretization of a one-dimensional periodic advection–diffusion equation. On the periodic domain of length $2\\pi$, discretized by $N$ uniformly spaced grid points with spacing $h = 2\\pi/N$, the semi-discrete unknown is the vector $y(t) \\in \\mathbb{R}^N$ that evolves according to the additive system\n$$\n\\frac{dy}{dt} = E\\,y + I\\,y,\n$$\nwhere $E$ is the discrete advection operator and $I$ is the discrete diffusion operator, both circulant matrices that commute. With central differences, the discrete Fourier symbol of the first derivative is $\\widehat{D}_1(\\theta) = \\mathrm{i}\\,\\sin(\\theta)/h$, and the discrete Fourier symbol of the second derivative is $\\widehat{D}_2(\\theta) = 2(\\cos(\\theta) - 1)/h^2$. With advection speed $a > 0$ and kinematic viscosity $\\nu > 0$, the Fourier symbols are\n$$\n\\widehat{E}(\\theta) = -a\\,\\widehat{D}_1(\\theta) = -a\\,\\mathrm{i}\\,\\frac{\\sin(\\theta)}{h},\\qquad \\widehat{I}(\\theta) = \\nu\\,\\widehat{D}_2(\\theta) = \\nu\\,\\frac{2(\\cos(\\theta)-1)}{h^2}.\n$$\nLet the initial condition be $y_j(0) = \\sin(k_0 x_j)$ with $x_j = j h$ and integer mode $k_0 \\ge 1$. Because $E$ and $I$ commute and are diagonalized by the discrete Fourier transform, the exact semi-discrete solution at time $t$ is given mode-by-mode by\n$$\n\\widehat{y}(t,\\theta) = \\exp\\!\\big(t(\\widehat{E}(\\theta)+\\widehat{I}(\\theta))\\big)\\,\\widehat{y}(0,\\theta).\n$$\nYour task is to implement an Implicit–Explicit (IMEX) Euler integrator with adaptive time stepping controlled by embedded error estimators for both the explicit and implicit parts, and to validate it against the exact semi-discrete evolution. Specifically:\n\n1) Starting from the additive system $dy/dt = E\\,y + I\\,y$, design one step of the IMEX Euler method that treats the explicit part with forward Euler and the implicit part with backward Euler. State the one-step update expressed in Fourier space for a time step $\\Delta t > 0$:\n$$\n\\widehat{y}_{n+1}(\\theta) = \\frac{1 + \\Delta t\\,\\widehat{E}(\\theta)}{1 - \\Delta t\\,\\widehat{I}(\\theta)}\\,\\widehat{y}_n(\\theta).\n$$\n\n2) Using step doubling, derive embedded error estimators for each contribution separately:\n- For the explicit-only flow $dy/dt = E\\,y$, define the full-step update $\\Phi_E^{\\Delta t}$ and the two half-steps update $\\Phi_E^{\\Delta t/2}\\circ \\Phi_E^{\\Delta t/2}$, and show that their difference applied to $y_n$ provides a local error estimate vector\n$$\ne_E = \\Big(\\big(I + \\tfrac{\\Delta t}{2} E\\big)^2 - \\big(I + \\Delta t\\,E\\big)\\Big)\\,y_n + \\mathcal{O}(\\Delta t^3)\n$$\nwith an associated scalar estimate $\\eta_E = \\|e_E\\|_{\\mathrm{RMS}}$, where $\\|\\cdot\\|_{\\mathrm{RMS}}$ denotes the root-mean-square norm over all grid points.\n\n- For the implicit-only flow $dy/dt = I\\,y$, define the full-step backward Euler update $\\Psi_I^{\\Delta t}$ and the two half-steps update $\\Psi_I^{\\Delta t/2}\\circ \\Psi_I^{\\Delta t/2}$, and show that their difference applied to $y_n$ provides a local error estimate vector\n$$\ne_I = \\Big(\\big(I - \\tfrac{\\Delta t}{2} I\\big)^{-2} - \\big(I - \\Delta t\\,I\\big)^{-1}\\Big)\\,y_n + \\mathcal{O}(\\Delta t^3)\n$$\nwith associated scalar estimate $\\eta_I = \\|e_I\\|_{\\mathrm{RMS}}$.\n\n3) Argue from linearity and commutativity that, to leading order in $\\Delta t$, the local error of the combined IMEX Euler step is additive and can be controlled by the combined scalar estimate\n$$\n\\eta = \\eta_E + \\eta_I.\n$$\n\n4) Design an adaptive time step controller that targets a user-specified tolerance $\\tau > 0$ per step by updating the time step according to\n$$\n\\Delta t_{\\mathrm{new}} = \\Delta t \\,\\min\\!\\big(f_{\\max},\\,\\max(f_{\\min},\\,s\\,(\\tau/\\eta)^{1/2})\\big),\n$$\nwith safety factor $s \\in (0,1)$ and bounds $f_{\\min} \\in (0,1)$, $f_{\\max} > 1$, and use step rejection/acceptance based on whether $\\eta \\le \\tau$.\n\n5) Implement the algorithm entirely in Fourier space for efficiency and compute the final numerical solution at time $T$ using the adaptive IMEX Euler scheme. For validation, compute the exact semi-discrete solution at time $T$ via\n$$\n\\widehat{y}_{\\mathrm{exact}}(T,\\theta) = \\exp\\!\\big(T(\\widehat{E}(\\theta)+\\widehat{I}(\\theta))\\big)\\,\\widehat{y}_0(\\theta),\n$$\nand then obtain $y_{\\mathrm{exact}}(T)$ by inverse discrete Fourier transform. Report the final error for each test as the root-mean-square norm of the difference vector $y_{\\mathrm{num}}(T) - y_{\\mathrm{exact}}(T)$.\n\nThe program must use the following fixed initial condition and constants across all tests: mode $k_0 = 3$, domain length $2\\pi$, grid size $N$ as specified by each test, initial time step $\\Delta t_0 = \\min\\{10^{-2},\\,0.4\\,h/a\\}$, safety factor $s = 0.9$, $f_{\\min} = 0.2$, $f_{\\max} = 5$. The root-mean-square norm is defined by\n$$\n\\|v\\|_{\\mathrm{RMS}} = \\sqrt{\\frac{1}{N}\\sum_{j=0}^{N-1} v_j^2}.\n$$\n\nImplement your solution in a single, complete Python program that carries out the derivation algorithmically and runs the following test suite. For each test, parameters are given as a tuple $(N,a,\\nu,T,\\tau)$:\n\n- Test A (happy path, moderately stiff): $(128,\\,1.0,\\,10^{-2},\\,0.2,\\,10^{-5})$.\n- Test B (stiffer diffusion): $(128,\\,1.0,\\,2\\times 10^{-1},\\,0.2,\\,10^{-5})$.\n- Test C (looser tolerance): $(128,\\,1.0,\\,10^{-2},\\,0.2,\\,10^{-3})$.\n- Test D (tighter tolerance): $(128,\\,1.0,\\,10^{-2},\\,0.2,\\,10^{-7})$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[rA,rB,rC,rD]\"), where each $r$ is the final root-mean-square error for the corresponding test, expressed as a floating-point number with no units.", "solution": "We begin with a semi-discrete model governed by\n$$\n\\frac{dy}{dt} = E\\,y + I\\,y,\n$$\nwhere $E$ is a circulant matrix representing the discrete advection operator and $I$ is a circulant matrix representing the discrete diffusion operator. On a periodic grid with spacing $h = 2\\pi/N$, both $E$ and $I$ are diagonalized by the discrete Fourier transform. Denoting the Fourier mode angle by $\\theta = 2\\pi m/N$ with integer $m \\in \\{0,1,\\dots,N-1\\}$, the Fourier symbols for the discrete first and second derivatives are\n$$\n\\widehat{D}_1(\\theta) = \\mathrm{i}\\,\\frac{\\sin(\\theta)}{h}, \\qquad \\widehat{D}_2(\\theta) = \\frac{2(\\cos(\\theta)-1)}{h^2}.\n$$\nThus with advection speed $a>0$ and kinematic viscosity $\\nu>0$ we have\n$$\n\\widehat{E}(\\theta) = -a\\,\\widehat{D}_1(\\theta) = -a\\,\\mathrm{i}\\,\\frac{\\sin(\\theta)}{h}, \\qquad \\widehat{I}(\\theta) = \\nu\\,\\widehat{D}_2(\\theta) = \\nu\\,\\frac{2(\\cos(\\theta)-1)}{h^2}.\n$$\nBecause $E$ and $I$ commute (they are simultaneously diagonalizable via the discrete Fourier transform), the exact semi-discrete solution is obtained mode-by-mode as\n$$\n\\widehat{y}(t,\\theta) = \\exp\\!\\big(t(\\widehat{E}(\\theta) + \\widehat{I}(\\theta))\\big)\\,\\widehat{y}(0,\\theta).\n$$\n\nWe now design an Implicit–Explicit (IMEX) Euler integrator. Over one time step of size $\\Delta t$, the IMEX Euler update is defined by applying forward Euler to the explicit part and backward Euler to the implicit part, which algebraically gives\n$$\ny_{n+1} = y_n + \\Delta t\\,E\\,y_n + \\Delta t\\,I\\,y_{n+1}.\n$$\nRearranging yields\n$$\n\\big(I - \\Delta t\\,I\\big)\\,y_{n+1} = \\big(I + \\Delta t\\,E\\big)\\,y_n.\n$$\nIn Fourier space, this becomes a scalar multiplication for each mode:\n$$\n\\widehat{y}_{n+1}(\\theta) = \\frac{1 + \\Delta t\\,\\widehat{E}(\\theta)}{1 - \\Delta t\\,\\widehat{I}(\\theta)}\\,\\widehat{y}_n(\\theta).\n$$\nThis is unconditionally stable with respect to the stiff diffusion contribution since for diffusion $\\widehat{I}(\\theta) \\le 0$, hence the denominator $1 - \\Delta t\\,\\widehat{I}(\\theta) \\ge 1$.\n\nTo design embedded error estimators for both parts, we consider step doubling for each subproblem separately. For the explicit-only subproblem $dy/dt = E\\,y$, the forward Euler full-step update is\n$$\n\\Phi_E^{\\Delta t}(y_n) = \\big(I + \\Delta t\\,E\\big)\\,y_n,\n$$\nand the two half-steps update is\n$$\n\\Phi_E^{\\Delta t/2}\\!\\circ \\Phi_E^{\\Delta t/2}(y_n) = \\big(I + \\tfrac{\\Delta t}{2} E\\big)^2 y_n.\n$$\nTheir difference applied to $y_n$ is\n$$\ne_E = \\Big(\\big(I + \\tfrac{\\Delta t}{2} E\\big)^2 - \\big(I + \\Delta t\\,E\\big)\\Big)\\,y_n.\n$$\nA Taylor expansion confirms that $e_E = \\mathcal{O}(\\Delta t^2)$ as a vector. We summarize the explicit local error estimate by the scalar root-mean-square norm\n$$\n\\eta_E = \\|e_E\\|_{\\mathrm{RMS}} = \\sqrt{\\frac{1}{N}\\sum_{j=0}^{N-1} \\big(e_E\\big)_j^2}.\n$$\n\nFor the implicit-only subproblem $dy/dt = I\\,y$, the backward Euler full-step update is the solution of\n$$\n\\big(I - \\Delta t\\,I\\big) y_{n+1} = y_n \\quad \\Rightarrow \\quad \\Psi_I^{\\Delta t}(y_n) = \\big(I - \\Delta t\\,I\\big)^{-1} y_n.\n$$\nTwo half-steps yield\n$$\n\\Psi_I^{\\Delta t/2}\\!\\circ \\Psi_I^{\\Delta t/2}(y_n) = \\big(I - \\tfrac{\\Delta t}{2} I\\big)^{-2} y_n.\n$$\nThus the implicit-only local error estimate vector is\n$$\ne_I = \\Big(\\big(I - \\tfrac{\\Delta t}{2} I\\big)^{-2} - \\big(I - \\Delta t\\,I\\big)^{-1}\\Big)\\,y_n,\n$$\nand the scalar estimate is\n$$\n\\eta_I = \\|e_I\\|_{\\mathrm{RMS}}.\n$$\n\nSince $E$ and $I$ are linear and commute, the leading-order local error of the combined IMEX Euler method is additive in the contributions from the explicit and implicit parts. Concretely, let $\\mathcal{M}_{\\mathrm{IMEX}}^{\\Delta t}$ denote the IMEX Euler one-step map and let $\\mathcal{M}_{\\mathrm{IMEX}}^{\\Delta t/2}\\circ \\mathcal{M}_{\\mathrm{IMEX}}^{\\Delta t/2}$ denote its two half-steps composition. Because $E$ and $I$ commute and the flows are linear, the difference\n$$\n\\big(\\mathcal{M}_{\\mathrm{IMEX}}^{\\Delta t/2}\\circ \\mathcal{M}_{\\mathrm{IMEX}}^{\\Delta t/2} - \\mathcal{M}_{\\mathrm{IMEX}}^{\\Delta t}\\big)\\,y_n\n$$\nexpands to leading order as the sum of the corresponding differences for the explicit-only and implicit-only subproblems. Therefore, to leading order, the total local error admits the additive estimate\n$$\n\\eta = \\eta_E + \\eta_I.\n$$\n\nFor adaptive control, we target a per-step tolerance $\\tau > 0$ and accept a step if $\\eta \\le \\tau$. Following standard variable-step control for first-order methods with step-doubling error estimates behaving like $\\mathcal{O}(\\Delta t^2)$, we update the time step by\n$$\n\\Delta t_{\\mathrm{new}} = \\Delta t \\,\\min\\!\\big(f_{\\max},\\,\\max(f_{\\min},\\,s\\,(\\tau/\\eta)^{1/2})\\big),\n$$\nwith safety factor $s \\in (0,1)$ and bounds $f_{\\min} \\in (0,1)$, $f_{\\max} > 1$ to limit step variation. This exponent $1/2$ arises because the dominant local error scales as $\\Delta t^2$.\n\nAlgorithmically, the method proceeds as follows for each time step at time $t_n$ with state $y_n$:\n- Compute the Fourier transform $\\widehat{y}_n$.\n- Form the IMEX full-step amplification factor in Fourier space,\n$$\n\\widehat{G}_{\\mathrm{IMEX}}(\\theta;\\Delta t) = \\frac{1 + \\Delta t\\,\\widehat{E}(\\theta)}{1 - \\Delta t\\,\\widehat{I}(\\theta)},\n$$\nand the corresponding explicit-only factors $\\widehat{G}_E(\\theta;\\Delta t) = 1 + \\Delta t\\,\\widehat{E}(\\theta)$, $\\widehat{G}_E(\\theta;\\Delta t/2)^2$, and implicit-only factors $\\widehat{G}_I(\\theta;\\Delta t) = \\big(1 - \\Delta t\\,\\widehat{I}(\\theta)\\big)^{-1}$, $\\widehat{G}_I(\\theta;\\Delta t/2)^2$.\n- Compute the candidate next state $\\widehat{y}_{n+1}^{\\mathrm{cand}} = \\widehat{G}_{\\mathrm{IMEX}}(\\theta;\\Delta t)\\,\\widehat{y}_n$.\n- Compute error vectors in physical space by inverse transforming\n$$\ne_E = \\mathcal{F}^{-1}\\!\\Big( \\big(\\widehat{G}_E(\\theta;\\tfrac{\\Delta t}{2})^2 - \\widehat{G}_E(\\theta;\\Delta t)\\big)\\,\\widehat{y}_n \\Big), \\quad\ne_I = \\mathcal{F}^{-1}\\!\\Big( \\big(\\widehat{G}_I(\\theta;\\tfrac{\\Delta t}{2})^2 - \\widehat{G}_I(\\theta;\\Delta t)\\big)\\,\\widehat{y}_n \\Big),\n$$\nthen compute $\\eta_E = \\|e_E\\|_{\\mathrm{RMS}}$, $\\eta_I = \\|e_I\\|_{\\mathrm{RMS}}$, and $\\eta = \\eta_E + \\eta_I$.\n- If $\\eta \\le \\tau$, accept the step by setting $\\widehat{y}_{n+1} = \\widehat{y}_{n+1}^{\\mathrm{cand}}$ and advance $t_{n+1} = t_n + \\Delta t$; otherwise, reject the step and keep $y_n$ unchanged.\n- Update $\\Delta t$ using the controller with exponent $1/2$, safety factor and bounds, and clip to not overshoot the final time.\n\nAt the final time $T$, compute the exact semi-discrete solution\n$$\n\\widehat{y}_{\\mathrm{exact}}(T,\\theta) = \\exp\\!\\big(T(\\widehat{E}(\\theta)+\\widehat{I}(\\theta))\\big)\\,\\widehat{y}_0(\\theta),\n$$\nand transform back to physical space. The reported error is the root-mean-square norm $\\|y_{\\mathrm{num}}(T) - y_{\\mathrm{exact}}(T)\\|_{\\mathrm{RMS}}$.\n\nThis procedure is applied to the test suite with parameter tuples $(N,a,\\nu,T,\\tau)$ specified in the problem. The final output is a single line containing a Python list of floating-point errors for the tests in the same order. Because the operators are diagonal in Fourier space and commute, the decomposition of the embedded error estimators $\\eta = \\eta_E + \\eta_I$ is consistent to leading order, and the adaptive controller drives the local error toward the target tolerance $\\tau$ with step sizes scaling like $\\Delta t \\sim \\sqrt{\\tau}$ for small $\\tau$.", "answer": "```python\nimport numpy as np\n\ndef imex_adaptive_error(N, a, nu, T, tau, k0=3, safety=0.9, fmin=0.2, fmax=5.0):\n    # Grid and wave numbers\n    Lx = 2.0 * np.pi\n    h = Lx / N\n    x = np.arange(N) * h\n\n    # Initial condition y0 = sin(k0 x)\n    y0 = np.sin(k0 * x)\n    yhat0 = np.fft.fft(y0)\n\n    # Fourier mode angles theta\n    m = np.arange(N)\n    theta = 2.0 * np.pi * m / N\n\n    # Fourier symbols for E and I\n    Ehat = -a * 1j * np.sin(theta) / h\n    Ihat = nu * 2.0 * (np.cos(theta) - 1.0) / (h * h)\n\n    # Exact solution factor at time T\n    exact_factor = np.exp(T * (Ehat + Ihat))\n    yhat_exact = exact_factor * yhat0\n    y_exact = np.real(np.fft.ifft(yhat_exact))\n\n    # Adaptive IMEX Euler\n    # Initial timestep: limited by explicit advection stability suggestion and cap\n    if a > 0:\n        dt = min(1e-2, 0.4 * h / a)\n    else:\n        dt = 1e-2\n    t = 0.0\n    yhat = yhat0.copy()\n\n    # Cap on number of steps to avoid infinite loops\n    max_steps = 200000\n    steps = 0\n\n    # Precompute for implicit estimators: denominators will be positive since Ihat <= 0\n    while t < T and steps < max_steps:\n        if dt <= 0.0:\n            break\n        # Clip dt to not overshoot\n        if t + dt > T:\n            dt = T - t\n\n        # Amplification factors\n        # IMEX full-step factor\n        denom = (1.0 - dt * Ihat)\n        # Numerical safeguard: ensure no division by zero (Ihat <= 0 ensures denom >= 1)\n        G_imex = (1.0 + dt * Ehat) / denom\n\n        # Explicit-only factors for error estimator\n        G_E_full = (1.0 + dt * Ehat)\n        G_E_half = (1.0 + 0.5 * dt * Ehat)\n        G_E_twohalf = G_E_half * G_E_half\n\n        # Implicit-only factors for error estimator\n        G_I_full = 1.0 / (1.0 - dt * Ihat)\n        G_I_half = 1.0 / (1.0 - 0.5 * dt * Ihat)\n        G_I_twohalf = G_I_half * G_I_half\n\n        # Candidate next state\n        yhat_cand = G_imex * yhat\n\n        # Error estimator vectors in physical space\n        eE_hat = (G_E_twohalf - G_E_full) * yhat\n        eI_hat = (G_I_twohalf - G_I_full) * yhat\n\n        eE = np.real(np.fft.ifft(eE_hat))\n        eI = np.real(np.fft.ifft(eI_hat))\n\n        # Scalar RMS norms\n        eta_E = np.sqrt(np.mean(eE * eE))\n        eta_I = np.sqrt(np.mean(eI * eI))\n        eta = eta_E + eta_I\n\n        # Step acceptance\n        if eta <= tau or dt <= 1e-16:\n            # Accept\n            yhat = yhat_cand\n            t += dt\n            steps += 1\n\n        # Update timestep using controller with exponent 1/2 (since LTE ~ dt^2)\n        # Avoid division by zero\n        ratio = tau / (eta + 1e-300)\n        factor = safety * (ratio ** 0.5)\n        factor = max(fmin, min(fmax, factor))\n        dt = max(1e-16, dt * factor)\n\n    # Compute final numerical solution\n    y_num = np.real(np.fft.ifft(yhat))\n    # RMS error\n    err = float(np.sqrt(np.mean((y_num - y_exact) ** 2)))\n    return err\n\ndef solve():\n    # Define the test cases: (N, a, nu, T, tau)\n    test_cases = [\n        (128, 1.0, 1e-2, 0.2, 1e-5),   # Test A: happy path\n        (128, 1.0, 2e-1, 0.2, 1e-5),   # Test B: stiffer diffusion\n        (128, 1.0, 1e-2, 0.2, 1e-3),   # Test C: looser tolerance\n        (128, 1.0, 1e-2, 0.2, 1e-7),   # Test D: tighter tolerance\n    ]\n\n    results = []\n    for case in test_cases:\n        N, a, nu, T, tau = case\n        err = imex_adaptive_error(N, a, nu, T, tau)\n        results.append(err)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3334246"}]}