{"hands_on_practices": [{"introduction": "To build powerful numerical solvers for compressible flows, we must first understand the language the fluid speaks: the language of waves. This foundational practice invites you to explore the eigenstructure of the 1D Euler equations, deriving the characteristic wave speeds and the Riemann invariants that travel along them. By mastering this analysis, you will unlock the mathematical basis for many advanced numerical methods and gain a deeper intuition for the physics of wave propagation in gases [@problem_id:3291767].", "problem": "Consider the one-dimensional, inviscid, compressible flow of a thermally and calorically perfect gas governed by the Euler equations in primitive variables $(\\rho,u,p)$, where $\\rho$ is the density, $u$ is the velocity, and $p$ is the pressure. In the context of approximate Riemann solvers used in Computational Fluid Dynamics (CFD), such as the Harten–Lax–van Leer with Contact (HLLC) solver, the eigenstructure of the flux Jacobian for the Euler equations determines the wave speeds and the characteristic variables transported along those waves.\n\nStarting from the Euler equations and fundamental thermodynamic relations for a perfect gas, derive the acoustic wave speeds and the associated characteristic variables (Riemann invariants) for the isentropic families. Then, for the numerical state\n$$\n\\rho = 1.2\\ \\text{kg m}^{-3},\\quad u = 120\\ \\text{m s}^{-1},\\quad p = 101325\\ \\text{Pa},\\quad \\gamma = 1.4,\n$$\ncompute the acoustic speeds and verify the strict hyperbolicity ordering $u-c < u < u+c$. Using the derived characteristic variables corresponding to the left- and right-traveling acoustic families, evaluate the quantity\n$$\nJ \\equiv w_{+} - w_{-},\n$$\nwhere $w_{+}$ and $w_{-}$ are the Riemann invariants associated with the right- and left-traveling acoustic waves, respectively, for a perfect gas.\n\nExpress your final numerical value of $J$ in $\\text{m s}^{-1}$ and round your answer to four significant figures.", "solution": "The problem requires the derivation of acoustic wave speeds and Riemann invariants for the 1D Euler equations, followed by a numerical calculation for a given state.\n\nThe 1D Euler equations for an inviscid, compressible flow, expressed in terms of primitive variables $\\mathbf{W} = (\\rho, u, p)^T$, are:\n$$\n\\frac{\\partial \\rho}{\\partial t} + \\frac{\\partial (\\rho u)}{\\partial x} = 0 \\quad (\\text{Continuity})\n$$\n$$\n\\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} + \\frac{1}{\\rho}\\frac{\\partial p}{\\partial x} = 0 \\quad (\\text{Momentum})\n$$\n$$\n\\frac{\\partial p}{\\partial t} + u \\frac{\\partial p}{\\partial x} + \\gamma p \\frac{\\partial u}{\\partial x} = 0 \\quad (\\text{Energy})\n$$\nThe energy equation in this form is derived from the conservation of energy and continuity, under the assumption of a calorically perfect gas.\n\nWe write this system in the quasi-linear form $\\frac{\\partial \\mathbf{W}}{\\partial t} + \\mathbf{A}(\\mathbf{W}) \\frac{\\partial \\mathbf{W}}{\\partial x} = \\mathbf{0}$. By expanding the continuity equation as $\\frac{\\partial \\rho}{\\partial t} + u\\frac{\\partial \\rho}{\\partial x} + \\rho\\frac{\\partial u}{\\partial x} = 0$, we can identify the flux Jacobian matrix $\\mathbf{A}$:\n$$\n\\mathbf{A} = \\begin{pmatrix} u & \\rho & 0 \\\\ 0 & u & \\frac{1}{\\rho} \\\\ 0 & \\gamma p & u \\end{pmatrix}\n$$\nThe wave speeds of the system are the eigenvalues $\\lambda$ of the matrix $\\mathbf{A}$. They are found by solving the characteristic equation $\\det(\\mathbf{A} - \\lambda \\mathbf{I}) = 0$:\n$$\n\\det \\begin{pmatrix} u - \\lambda & \\rho & 0 \\\\ 0 & u - \\lambda & \\frac{1}{\\rho} \\\\ 0 & \\gamma p & u - \\lambda \\end{pmatrix} = 0\n$$\nExpanding the determinant along the first column gives:\n$$\n(u - \\lambda) \\left[ (u - \\lambda)^2 - (\\gamma p)\\left(\\frac{1}{\\rho}\\right) \\right] = 0\n$$\nIntroducing the definition of the speed of sound squared, $c^2 = \\frac{\\gamma p}{\\rho}$, we have:\n$$\n(u - \\lambda) \\left[ (u - \\lambda)^2 - c^2 \\right] = 0\n$$\nThis yields three distinct real eigenvalues, which confirms the hyperbolic nature of the Euler equations:\n$$\n\\lambda_1 = u - c \\quad (\\text{left-traveling acoustic wave})\n$$\n$$\n\\lambda_2 = u \\quad (\\text{contact/entropy wave})\n$$\n$$\n\\lambda_3 = u + c \\quad (\\text{right-traveling acoustic wave})\n$$\nThe problem asks for the acoustic wave speeds, which are $\\lambda_1 = u - c$ and $\\lambda_3 = u + c$.\n\nNext, we derive the Riemann invariants. These are quantities that remain constant along the characteristic curves defined by $\\frac{dx}{dt} = \\lambda$. The characteristic variables are found from the left eigenvectors $\\mathbf{l}_k^T$ of $\\mathbf{A}$, which satisfy $\\mathbf{l}_k^T \\mathbf{A} = \\lambda_k \\mathbf{l}_k^T$. This leads to the characteristic compatibility equations $\\mathbf{l}_k^T d\\mathbf{W} = 0$ along the characteristics.\n\nLet $\\mathbf{l}^T = (l_1, l_2, l_3)$. The left eigenvector equation is $\\mathbf{l}^T(\\mathbf{A} - \\lambda \\mathbf{I}) = \\mathbf{0}^T$:\n$$\n(l_1, l_2, l_3) \\begin{pmatrix} u - \\lambda & \\rho & 0 \\\\ 0 & u - \\lambda & \\frac{1}{\\rho} \\\\ 0 & \\gamma p & u - \\lambda \\end{pmatrix} = (0, 0, 0)\n$$\nThis gives the system:\n1. $l_1(u - \\lambda) = 0$\n2. $l_1 \\rho + l_2(u - \\lambda) + l_3 \\gamma p = 0$\n3. $l_2 \\frac{1}{\\rho} + l_3(u - \\lambda) = 0$\n\nFor the acoustic waves, $\\lambda = u \\pm c$, so $u - \\lambda = \\mp c \\neq 0$.\nFrom equation (1), $l_1(\\mp c) = 0$, which implies $l_1 = 0$.\nThe system reduces to:\n2. $l_2(\\mp c) + l_3 \\gamma p = 0$\n3. $l_2 \\frac{1}{\\rho} + l_3(\\mp c) = 0 \\implies l_2 = \\pm l_3 \\rho c$\nSubstituting $l_2$ into equation (2):\n$$\n(\\pm l_3 \\rho c)(\\mp c) + l_3 \\gamma p = 0 \\implies -l_3 \\rho c^2 + l_3 \\gamma p = 0 \\implies l_3(-\\rho c^2 + \\gamma p) = 0\n$$\nSince $c^2 = \\gamma p / \\rho$, this equation is satisfied for any choice of $l_3$. We can choose $l_3 = 1$. This gives $l_2 = \\pm \\rho c$.\nThe left eigenvectors for the acoustic families are:\nFor $\\lambda_1 = u - c$: $\\mathbf{l}_1^T = (0, -\\rho c, 1)$\nFor $\\lambda_3 = u + c$: $\\mathbf{l}_3^T = (0, \\rho c, 1)$\n\nThe corresponding characteristic compatibility relations are $\\mathbf{l}^T d\\mathbf{W} = 0$:\n$$-\\rho c \\, du + dp = 0 \\quad \\text{along} \\quad \\frac{dx}{dt} = u - c$$\n$$\\rho c \\, du + dp = 0 \\quad \\text{along} \\quad \\frac{dx}{dt} = u + c$$\nThese can be combined as $dp \\pm \\rho c \\, du = 0$. To find the Riemann invariants, we must integrate these differential forms. The flow across acoustic waves is isentropic, meaning entropy is constant. For a perfect gas, this implies $p = K\\rho^\\gamma$ for some constant $K$. From this, we have $dp = K\\gamma\\rho^{\\gamma-1}d\\rho$. Also, $c^2 = \\frac{\\gamma p}{\\rho} = \\gamma K \\rho^{\\gamma-1}$, so $dp = c^2 d\\rho$.\nThe compatibility relations can be written as $\\frac{dp}{\\rho c} \\pm du = 0$. Let's find a function whose differential is $\\frac{dp}{\\rho c}$:\n$$\n\\int \\frac{dp}{\\rho c} = \\int \\frac{c^2 d\\rho}{\\rho c} = \\int \\frac{c}{\\rho} d\\rho\n$$\nSince $c = \\sqrt{\\gamma K \\rho^{\\gamma-1}}$, let's express this integral in terms of $c$.\n$c^2 = \\gamma K \\rho^{\\gamma-1} \\implies \\ln(c^2) = \\ln(\\gamma K) + (\\gamma-1)\\ln(\\rho) \\implies 2\\ln(c) = \\text{const} + (\\gamma-1)\\ln(\\rho)$.\nDifferentiating with respect to $\\rho$: $\\frac{2}{c}\\frac{dc}{d\\rho} = \\frac{\\gamma-1}{\\rho} \\implies d\\rho = \\frac{2\\rho}{(\\gamma-1)c}dc$.\nSubstituting $d\\rho$ into the integral:\n$$\n\\int \\frac{c}{\\rho} d\\rho = \\int \\frac{c}{\\rho} \\frac{2\\rho}{(\\gamma-1)c} dc = \\int \\frac{2}{\\gamma-1} dc = \\frac{2c}{\\gamma-1}\n$$\nSo, $d\\left(\\frac{2c}{\\gamma-1}\\right) = \\frac{dp}{\\rho c}$.\nThe compatibility relations are now exact differentials:\n$$ d\\left(\\frac{2c}{\\gamma-1}\\right) \\pm du = 0 \\implies d\\left(u \\pm \\frac{2c}{\\gamma-1}\\right) = 0 $$\nThe Riemann invariants are the quantities that are conserved along their respective characteristics:\n$$\nw_{-} = u - \\frac{2c}{\\gamma-1} \\quad (\\text{constant along } \\frac{dx}{dt} = u - c)\n$$\n$$\nw_{+} = u + \\frac{2c}{\\gamma-1} \\quad (\\text{constant along } \\frac{dx}{dt} = u + c)\n$$\nHere, $w_{+}$ is associated with the right-traveling wave and $w_{-}$ with the left-traveling wave.\n\nNow we proceed with the numerical evaluation using the given state:\n$$\n\\rho = 1.2\\ \\text{kg m}^{-3},\\quad u = 120\\ \\text{m s}^{-1},\\quad p = 101325\\ \\text{Pa},\\quad \\gamma = 1.4\n$$\nFirst, calculate the speed of sound $c$:\n$$\nc = \\sqrt{\\frac{\\gamma p}{\\rho}} = \\sqrt{\\frac{1.4 \\times 101325}{1.2}} = \\sqrt{\\frac{141855}{1.2}} = \\sqrt{118212.5}\\ \\text{m s}^{-1}\n$$\n$$\nc \\approx 343.82043\\ \\text{m s}^{-1}\n$$\nThe acoustic wave speeds are:\n$$\n\\lambda_1 = u - c = 120 - 343.82043 = -223.82043\\ \\text{m s}^{-1}\n$$\n$$\n\\lambda_3 = u + c = 120 + 343.82043 = 463.82043\\ \\text{m s}^{-1}\n$$\nThe wave speed of the contact wave is $\\lambda_2 = u = 120\\ \\text{m s}^{-1}$.\nWe verify the strict hyperbolicity ordering $u-c < u < u+c$:\n$$\n-223.82043\\ \\text{m s}^{-1} < 120\\ \\text{m s}^{-1} < 463.82043\\ \\text{m s}^{-1}\n$$\nThe ordering is confirmed, as required for a physically valid flow where $c > 0$.\n\nFinally, we compute the quantity $J \\equiv w_{+} - w_{-}$:\n$$\nJ = \\left(u + \\frac{2c}{\\gamma-1}\\right) - \\left(u - \\frac{2c}{\\gamma-1}\\right) = u + \\frac{2c}{\\gamma-1} - u + \\frac{2c}{\\gamma-1} = \\frac{4c}{\\gamma-1}\n$$\nSubstituting the numerical values for $c$ and $\\gamma$:\n$$\nJ = \\frac{4 \\times \\sqrt{118212.5}}{1.4 - 1} = \\frac{4 \\times \\sqrt{118212.5}}{0.4} = 10 \\times \\sqrt{118212.5}\n$$\n$$\nJ = 10 \\times 343.82043... = 3438.2043...\\ \\text{m s}^{-1}\n$$\nThe problem requires the answer to be rounded to four significant figures.\n$$\nJ \\approx 3438\\ \\text{m s}^{-1}\n$$", "answer": "$$\\boxed{3438}$$", "id": "3291767"}, {"introduction": "From theory to code, this hands-on practice challenges you to build a working numerical engine for simulating compressible flows. You will implement a first-order Godunov scheme using the Harten-Lax-van Leer (HLL) approximate Riemann solver, a workhorse method known for its robustness. This exercise will demystify the inner workings of finite volume methods, giving you practical skills to translate the equations of fluid dynamics into a predictive computational tool [@problem_id:3291811].", "problem": "You are to implement one explicit time step of a first-order Godunov finite volume scheme for the one-dimensional compressible Euler equations using piecewise constant reconstruction and a specified approximate Riemann solver. The governing equations are the conservation laws for mass, momentum, and energy, with state vector $U = [\\rho, \\rho u, E]^\\top$ and flux $F(U) = [\\rho u, \\rho u^2 + p, u (E + p)]^\\top$. The equation of state is the ideal gas law with ratio of specific heats $\\gamma$, and the pressure is given by $p = (\\gamma - 1)\\left(E - \\tfrac{1}{2}\\rho u^2\\right)$. The discrete update, with piecewise constant reconstruction, evolves the cell averages according to $U_i^{n+1} = U_i^n - \\dfrac{\\Delta t}{\\Delta x}\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right)$, where $F_{i\\pm \\frac{1}{2}}$ are numerical fluxes computed by an approximate Riemann solver at the cell interfaces. Use transmissive (zero-gradient) boundary conditions implemented with one ghost cell on each domain boundary.\n\nYour program must implement the Harten–Lax–van Leer (HLL) approximate Riemann solver. You should use signal speed estimates derived from the left and right states and the equation of state to construct the HLL flux. The Courant–Friedrichs–Lewy (CFL) number $0 < \\text{CFL} \\le 1$ governs the explicit time step size via $\\Delta t = \\text{CFL}\\,\\Delta x / a_{\\max}$, where $a_{\\max}$ is a suitable global upper bound on the characteristic speeds across the domain. Compute $a_{\\max}$ as the maximum over all cells of $|u| + c$, where $c$ is the sound speed $c = \\sqrt{\\gamma p / \\rho}$ computed from the primitive variables in each cell.\n\nYou will simulate on the domain $[0,1]$ with $N$ uniform cells of size $\\Delta x = 1/N$, with piecewise constant initial data defined by a single discontinuity at location $x_0 \\in (0,1)$: for cell centers $x_i < x_0$ set the left state $(\\rho_L, u_L, p_L)$, otherwise set the right state $(\\rho_R, u_R, p_R)$. Convert these primitive variables to conserved variables $U = [\\rho, \\rho u, E]^\\top$, where $E = p/(\\gamma - 1) + \\tfrac{1}{2}\\rho u^2$.\n\nFor each test case below, perform exactly one time step as specified, and after the update compute and return the following three quantities:\n- The time step size $\\Delta t$ as a floating-point number.\n- The total mass after the update, $M = \\sum_{i=1}^{N} \\rho_i^{n+1} \\Delta x$, as a floating-point number.\n- The minimum pressure after the update across all interior cells, $\\min_i p_i^{n+1}$, as a floating-point number.\n\nNo physical units are required for this nondimensional problem. Angles do not appear. Express all outputs as decimal floating-point numbers.\n\nUse the following test suite, each specified by $(N, \\text{CFL}, \\gamma, (\\rho_L,u_L,p_L), (\\rho_R,u_R,p_R), x_0)$:\n1. $N = 200$, $\\text{CFL} = 0.5$, $\\gamma = 1.4$, $(\\rho_L,u_L,p_L) = (1.0, 0.0, 1.0)$, $(\\rho_R,u_R,p_R) = (0.125, 0.0, 0.1)$, $x_0 = 0.5$.\n2. $N = 200$, $\\text{CFL} = 0.5$, $\\gamma = 1.4$, $(\\rho_L,u_L,p_L) = (0.445, 0.698, 3.528)$, $(\\rho_R,u_R,p_R) = (0.5, 0.0, 0.571)$, $x_0 = 0.5$.\n3. $N = 200$, $\\text{CFL} = 0.2$, $\\gamma = 1.4$, $(\\rho_L,u_L,p_L) = (1.0, 0.0, 1.0)$, $(\\rho_R,u_R,p_R) = (0.001, 0.0, 0.000001)$, $x_0 = 0.5$.\n4. $N = 200$, $\\text{CFL} = 0.5$, $\\gamma = 1.4$, $(\\rho_L,u_L,p_L) = (1.0, 3.0, 1.0)$, $(\\rho_R,u_R,p_R) = (1.0, 3.0, 1.0)$, $x_0 = 0.25$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case contributes a sub-list of the three values in the order $[\\Delta t, M, \\min p]$. For example, the final output format must be\n$[\\,[\\Delta t_1, M_1, \\min p_1],\\,[\\Delta t_2, M_2, \\min p_2],\\,[\\Delta t_3, M_3, \\min p_3],\\,[\\Delta t_4, M_4, \\min p_4]\\,]$,\nwith no additional text and no spaces anywhere in the line.", "solution": "The user requests the implementation of a single explicit time step for a first-order Godunov-type finite volume scheme to solve the one-dimensional compressible Euler equations. The solution must use the Harten–Lax–van Leer (HLL) approximate Riemann solver.\n\nThe one-dimensional Euler equations are a system of conservation laws given by $\\partial_t U + \\partial_x F(U) = 0$, where $U$ is the vector of conserved variables and $F(U)$ is the flux vector.\nThe state vector $U$ and flux vector $F(U)$ are defined as:\n$$\nU = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ E \\end{pmatrix}, \\quad\nF(U) = \\begin{pmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E+p) \\end{pmatrix}\n$$\nHere, $\\rho$ is the fluid density, $u$ is the velocity, $E$ is the total energy per unit volume, and $p$ is the pressure. The system is closed by the ideal gas equation of state, which relates pressure to the conserved variables:\n$$\np = (\\gamma - 1) \\left( E - \\frac{1}{2}\\rho u^2 \\right)\n$$\nwhere $\\gamma$ is the ratio of specific heats.\n\nThe finite volume method discretizes the spatial domain $[0, 1]$ into $N$ computational cells, $C_i = [x_{i-1/2}, x_{i+1/2}]$, for $i=1, \\dots, N$. Each cell has a uniform width $\\Delta x = 1/N$. The cell-averaged state variable is $U_i(t) = \\frac{1}{\\Delta x} \\int_{C_i} U(x, t) dx$.\nFor a first-order scheme, we assume a piecewise constant reconstruction, meaning the state is uniform within each cell, $U(x, t) = U_i(t)$ for $x \\in C_i$.\nIntegrating the conservation law over cell $C_i$ and over a time interval $[t^n, t^{n+1}]$ yields the explicit time-marching formula:\n$$\nU_i^{n+1} = U_i^n - \\frac{\\Delta t}{\\Delta x} \\left( F_{i+1/2} - F_{i-1/2} \\right)\n$$\nwhere $\\Delta t = t^{n+1} - t^n$ is the time step, and $F_{i\\pm 1/2}$ are the numerical fluxes at the cell interfaces $x_{i\\pm 1/2}$. These fluxes are computed by solving the Riemann problem at each interface.\n\nThe HLL approximate Riemann solver provides an estimate for the interface flux $F_{i+1/2}$ based on the left and right states, $U_L = U_i^n$ and $U_R = U_{i+1}^n$. The method estimates the fastest left-going ($S_L$) and right-going ($S_R$) signal velocities emanating from the interface. A common and robust estimate (Davis, 1988) is:\n$$\nS_L = \\min(u_L - c_L, u_R - c_R)\n$$\n$$\nS_R = \\max(u_L + c_L, u_R + c_R)\n$$\nwhere $c = \\sqrt{\\gamma p / \\rho}$ is the speed of sound. The HLL flux, $F_{HLL}$, is then given by:\n$$\nF_{HLL}(U_L, U_R) = \\begin{cases}\nF(U_L) & \\text{if } S_L \\ge 0 \\\\\nF(U_R) & \\text{if } S_R \\le 0 \\\\\n\\dfrac{S_R F(U_L) - S_L F(U_R) + S_L S_R (U_R - U_L)}{S_R - S_L} & \\text{if } S_L < 0 < S_R\n\\end{cases}\n$$\n\nThe explicit scheme is stable under the Courant–Friedrichs–Lewy (CFL) condition. The time step $\\Delta t$ is calculated as:\n$$\n\\Delta t = \\text{CFL} \\frac{\\Delta x}{a_{\\max}}\n$$\nwhere $\\text{CFL}$ is the CFL number ($0 < \\text{CFL} \\le 1$) and $a_{\\max}$ is the maximum characteristic speed over the entire domain at time $t^n$:\n$$\na_{\\max} = \\max_i(|u_i^n| + c_i^n)\n$$\n\nThe implementation proceeds as follows:\n1.  **Initialization**: Set up the spatial grid with $N$ cells. Initialize the cell-averaged conserved variables $U_i^0$ for $i=1, \\dots, N$ from the given piecewise constant primitive variables $(\\rho, u, p)$, using the conversion $E = p/(\\gamma-1) + \\frac{1}{2}\\rho u^2$.\n2.  **Time Step Calculation**: Compute the maximum characteristic speed $a_{\\max}$ over all cells and calculate the time step $\\Delta t$ using the CFL condition.\n3.  **Boundary Conditions**: Extend the domain with one ghost cell on each side. For transmissive (zero-gradient) boundaries, the state in the left ghost cell is set equal to the state in the first interior cell ($U_0 = U_1$), and the state in the right ghost cell is set equal to the state in the last interior cell ($U_{N+1} = U_N$). This creates an extended state vector of size $N+2$.\n4.  **Flux Calculation**: Loop over all $N+1$ interfaces from $x_{1/2}$ to $x_{N+1/2}$. At each interface $x_{i+1/2}$, use the states $U_i$ and $U_{i+1}$ from the extended grid as the left and right inputs to the HLL solver to compute the numerical flux $F_{i+1/2}$.\n5.  **State Update**: Update the conserved variables $U_i$ for all interior cells $i=1, \\dots, N$ using the discrete conservation law.\n6.  **Output Calculation**: After one time step, convert the new conserved variables $U_i^{n+1}$ back to primitive variables $(\\rho_i^{n+1}, u_i^{n+1}, p_i^{n+1})$. Calculate the total mass $M = \\sum_{i=1}^{N} \\rho_i^{n+1} \\Delta x$ and the minimum pressure $\\min_i p_i^{n+1}$.\n\nThis procedure is applied to each test case to generate the required outputs. Vectorized `numpy` operations are used for efficiency.```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\nclass Euler1DHLLSolver:\n    \"\"\"\n    Implements a single step of a first-order Godunov scheme for the\n    1D Euler equations using the HLL approximate Riemann solver.\n    \"\"\"\n    def __init__(self, N, CFL, gamma, left_prim, right_prim, x0):\n        self.N = N\n        self.CFL = CFL\n        self.gamma = gamma\n        self.dx = 1.0 / self.N\n        self.U = self._initialize_state(left_prim, right_prim, x0)\n\n    def _primitives_to_conserved(self, rho, u, p):\n        return np.array([rho, rho * u, p / (self.gamma - 1.0) + 0.5 * rho * u**2])\n\n    def _conserved_to_primitives_vec(self, U):\n        rho = U[:, 0]\n        rho_u = U[:, 1]\n        E = U[:, 2]\n        u = rho_u / rho\n        # Prevent negative pressure from floating point errors\n        p = np.maximum(1e-12, (self.gamma - 1.0) * (E - 0.5 * rho * u**2))\n        return rho, u, p\n\n    def _get_flux_vec(self, U):\n        rho, u, p = self._conserved_to_primitives_vec(U)\n        rho_u = U[:, 1]\n        E = U[:, 2]\n        \n        F = np.zeros_like(U)\n        F[:, 0] = rho_u\n        F[:, 1] = rho_u * u + p\n        F[:, 2] = u * (E + p)\n        return F\n\n    def _get_hll_flux_vec(self, U_L, U_R):\n        gamma = self.gamma\n        rho_L, u_L, p_L = self._conserved_to_primitives_vec(U_L)\n        rho_R, u_R, p_R = self._conserved_to_primitives_vec(U_R)\n\n        F_L = self._get_flux_vec(U_L)\n        F_R = self._get_flux_vec(U_R)\n\n        c_L = np.sqrt(gamma * p_L / rho_L)\n        c_R = np.sqrt(gamma * p_R / rho_R)\n\n        S_L = np.minimum(u_L - c_L, u_R - c_R)\n        S_R = np.maximum(u_L + c_L, u_R + c_R)\n\n        # Broadcasting for array operations\n        S_L_b = S_L[:, np.newaxis]\n        S_R_b = S_R[:, np.newaxis]\n        \n        # HLL flux formula vectorized\n        num = S_R_b * F_L - S_L_b * F_R + S_L_b * S_R_b * (U_R - U_L)\n        den = S_R - S_L\n        \n        F_hll = np.zeros_like(U_L)\n\n        # Conditions for HLL cases\n        cond_L = S_L >= 0\n        cond_R = S_R = 0\n        cond_star = (~cond_L)  (~cond_R)\n        \n        F_hll[cond_L] = F_L[cond_L]\n        F_hll[cond_R] = F_R[cond_R]\n\n        # For the star region, handle possible division by zero\n        den_star = den[cond_star]\n        is_zero_den = np.isclose(den_star, 0)\n        \n        F_star = np.zeros_like(F_L[cond_star])\n        \n        # Non-zero denominator case\n        non_zero_mask = ~is_zero_den\n        if np.any(non_zero_mask):\n            F_star[non_zero_mask] = num[cond_star][non_zero_mask] / den_star[non_zero_mask, np.newaxis]\n\n        # Zero denominator case (uniform flow U_L=U_R) -> flux is physical flux\n        if np.any(is_zero_den):\n            F_star[is_zero_den] = F_L[cond_star][is_zero_den]\n        \n        F_hll[cond_star] = F_star\n        \n        return F_hll\n\n    def _initialize_state(self, left_prim, right_prim, x0):\n        x_centers = (np.arange(self.N) + 0.5) * self.dx\n        \n        left_U = self._primitives_to_conserved(*left_prim)\n        right_U = self._primitives_to_conserved(*right_prim)\n        \n        mask = (x_centers  x0)[:, np.newaxis]\n        U = np.where(mask, left_U, right_U)\n        return U\n\n    def run_one_step(self):\n        # 1. Calculate time step dt\n        rho, u, p = self._conserved_to_primitives_vec(self.U)\n        c = np.sqrt(self.gamma * p / rho)\n        a_max = np.max(np.abs(u) + c)\n        dt = self.CFL * self.dx / a_max\n        \n        # 2. Apply boundary conditions (1 ghost cell on each side)\n        U_ext = np.zeros((self.N + 2, 3))\n        U_ext[1:-1, :] = self.U\n        U_ext[0, :] = U_ext[1, :]   # zero-gradient BC on left\n        U_ext[-1, :] = U_ext[-2, :] # zero-gradient BC on right\n\n        # 3. Compute fluxes at cell interfaces\n        U_L = U_ext[:-1, :]\n        U_R = U_ext[1:, :]\n        F_half = self._get_hll_flux_vec(U_L, U_R)\n\n        # 4. Update cell averages\n        F_L_cell = F_half[:-1, :] # Fluxes at i-1/2\n        F_R_cell = F_half[1:, :]  # Fluxes at i+1/2\n        U_new = self.U - (dt / self.dx) * (F_R_cell - F_L_cell)\n\n        # 5. Compute required outputs\n        rho_new, _, p_new = self._conserved_to_primitives_vec(U_new)\n        total_mass = np.sum(rho_new) * self.dx\n        min_pressure = np.min(p_new)\n\n        return dt, total_mass, min_pressure\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (200, 0.5, 1.4, (1.0, 0.0, 1.0), (0.125, 0.0, 0.1), 0.5),\n        (200, 0.5, 1.4, (0.445, 0.698, 3.528), (0.5, 0.0, 0.571), 0.5),\n        (200, 0.2, 1.4, (1.0, 0.0, 1.0), (0.001, 0.0, 0.000001), 0.5),\n        (200, 0.5, 1.4, (1.0, 3.0, 1.0), (1.0, 3.0, 1.0), 0.25),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, CFL, gamma, left_prim, right_prim, x0 = case\n        solver = Euler1DHLLSolver(N, CFL, gamma, left_prim, right_prim, x0)\n        res = solver.run_one_step()\n        results.append(list(res))\n\n    # Final print statement in the exact required format.\n    result_strs = [f\"[{r[0]},{r[1]},{r[2]}]\" for r in results]\n    print(f\"[{','.join(result_strs)}]\")\n\nsolve()\n```", "answer": "[[0.002220446049250313,0.5625,0.30601662450257366],[0.0009669046603184646,0.4725,0.571],[0.0005047814882181519,0.5004995,0.005047710411831826],[0.0005973428945413936,1.0,1.0]]", "id": "3291811"}, {"introduction": "Even the most sophisticated tools have their limits, and understanding these limits is the mark of a true expert. This exercise confronts you with a famous pathology of the widely-used Roe's approximate Riemann solver, where it can produce unphysical results like negative pressure. By working through this transonic rarefaction problem, you will uncover why this failure occurs and appreciate the critical role of \"entropy fixes\" in ensuring that our numerical simulations remain true to the laws of physics [@problem_id:3291766].", "problem": "Consider the one-dimensional compressible Euler equations for an ideal gas,\n$$\n\\frac{\\partial}{\\partial t}\n\\begin{pmatrix}\n\\rho \\\\\n\\rho u \\\\\nE\n\\end{pmatrix}\n+\n\\frac{\\partial}{\\partial x}\n\\begin{pmatrix}\n\\rho u \\\\\n\\rho u^{2} + p \\\\\nu\\,(E + p)\n\\end{pmatrix}\n= 0,\n$$\nwith the thermodynamic closure\n$$\nE = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\,\\rho u^{2},\n$$\nwhere $\\rho$ is density, $u$ is velocity, $p$ is pressure, $E$ is total energy, and $\\gamma$ is the constant ratio of specific heats. All variables are nondimensional.\n\nDefine a Riemann problem with left and right states\n$$\n(\\rho_{L}, u_{L}, p_{L}) = (1, -2, 0.1), \\qquad (\\rho_{R}, u_{R}, p_{R}) = (1, 2, 0.1),\n$$\nfor an ideal gas with $\\gamma = 1.4$.\n\nUsing Roe's linearization (without any entropy fix), construct the piecewise-constant approximate solution to this Riemann problem and determine the middle constant state $U_{*}$ corresponding to the self-similar variable $x/t$ lying strictly between the smallest and largest Roe characteristic speeds. Then, compute the pressure $p_{*}$ of this middle state from the conserved variables via the ideal-gas relation.\n\nExplain the mechanism by which Roe's solver in this case loses the invariant domain (positivity of density and pressure), connecting it to the structure of the linearization and the transonic rarefaction character of the data.\n\nProvide the value of $p_{*}$ as a single real number in dimensionless units, and round your answer to four significant figures.", "solution": "The problem requires the analysis of a specific Riemann problem for the one-dimensional compressible Euler equations using Roe's approximate Riemann solver. I will first validate the problem statement and then proceed with a detailed derivation of the solution.\n\nThe system of equations is given by\n$$\n\\frac{\\partial \\mathbf{U}}{\\partial t} + \\frac{\\partial \\mathbf{F}(\\mathbf{U})}{\\partial x} = 0,\n$$\nwhere the vector of conserved variables $\\mathbf{U}$ and the flux vector $\\mathbf{F}$ are\n$$\n\\mathbf{U} = \\begin{pmatrix} \\rho \\\\ \\rho u \\\\ E \\end{pmatrix}, \\qquad \\mathbf{F}(\\mathbf{U}) = \\begin{pmatrix} \\rho u \\\\ \\rho u^{2} + p \\\\ u(E + p) \\end{pmatrix}.\n$$\nThe system is closed by the ideal gas equation of state, which relates the total energy $E$ to pressure $p$, density $\\rho$, and velocity $u$:\n$$\nE = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\rho u^{2}.\n$$\nThe given Riemann problem has the following left ($L$) and right ($R$) states:\n$$\n(\\rho_{L}, u_{L}, p_{L}) = (1, -2, 0.1)\n$$\n$$\n(\\rho_{R}, u_{R}, p_{R}) = (1, 2, 0.1)\n$$\nThe ratio of specific heats is $\\gamma = 1.4$.\n\nRoe's method approximates the solution to the Riemann problem by solving a linearized system $\\frac{\\partial \\mathbf{U}}{\\partial t} + \\tilde{A} \\frac{\\partial \\mathbf{U}}{\\partial x} = 0$, where the Roe matrix $\\tilde{A}(\\mathbf{U}_L, \\mathbf{U}_R)$ is a constant matrix that satisfies the property $\\mathbf{F}_R - \\mathbf{F}_L = \\tilde{A}(\\mathbf{U}_R - \\mathbf{U}_L)$. This matrix is constructed using Roe-averaged variables.\n\nFirst, we compute the necessary primitive and derived quantities for the left and right states.\nFor the left state:\n$$\nE_L = \\frac{p_L}{\\gamma - 1} + \\frac{1}{2}\\rho_L u_L^2 = \\frac{0.1}{1.4 - 1} + \\frac{1}{2}(1)(-2)^2 = \\frac{0.1}{0.4} + 2 = 0.25 + 2 = 2.25\n$$\nThe specific total enthalpy is $h = (E+p)/\\rho$.\n$$\nh_L = \\frac{E_L + p_L}{\\rho_L} = \\frac{2.25 + 0.1}{1} = 2.35\n$$\nFor the right state, the problem is symmetric:\n$$\nE_R = \\frac{p_R}{\\gamma - 1} + \\frac{1}{2}\\rho_R u_R^2 = \\frac{0.1}{1.4 - 1} + \\frac{1}{2}(1)(2)^2 = 0.25 + 2 = 2.25\n$$\n$$\nh_R = \\frac{E_R + p_R}{\\rho_R} = \\frac{2.25 + 0.1}{1} = 2.35\n$$\nNext, we compute the Roe-averaged variables, denoted by a tilde:\n$$\n\\tilde{\\rho} = \\sqrt{\\rho_L \\rho_R} = \\sqrt{1 \\times 1} = 1\n$$\n$$\n\\tilde{u} = \\frac{\\sqrt{\\rho_L}u_L + \\sqrt{\\rho_R}u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}} = \\frac{\\sqrt{1}(-2) + \\sqrt{1}(2)}{\\sqrt{1} + \\sqrt{1}} = \\frac{-2 + 2}{2} = 0\n$$\n$$\n\\tilde{h} = \\frac{\\sqrt{\\rho_L}h_L + \\sqrt{\\rho_R}h_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}} = \\frac{\\sqrt{1}(2.35) + \\sqrt{1}(2.35)}{\\sqrt{1} + \\sqrt{1}} = 2.35\n$$\nThe Roe-averaged speed of sound, $\\tilde{c}$, is given by $\\tilde{c}^2 = (\\gamma - 1)(\\tilde{h} - \\frac{1}{2}\\tilde{u}^2)$.\n$$\n\\tilde{c}^2 = (1.4 - 1)(2.35 - \\frac{1}{2}(0)^2) = 0.4 \\times 2.35 = 0.94\n$$\n$$\n\\tilde{c} = \\sqrt{0.94}\n$$\nThe eigenvalues of the Roe matrix $\\tilde{A}$ are the characteristic speeds evaluated at the averaged state:\n$$\n\\tilde{\\lambda}_1 = \\tilde{u} - \\tilde{c} = -\\sqrt{0.94}\n$$\n$$\n\\tilde{\\lambda}_2 = \\tilde{u} = 0\n$$\n$$\n\\tilde{\\lambda}_3 = \\tilde{u} + \\tilde{c} = \\sqrt{0.94}\n$$\nThe jump in the state vector, $\\Delta \\mathbf{U} = \\mathbf{U}_R - \\mathbf{U}_L$, is decomposed into the basis of the right eigenvectors $\\tilde{\\mathbf{r}}_k$ of $\\tilde{A}$, with coefficients (wave strengths) $\\tilde{\\alpha}_k$: $\\Delta \\mathbf{U} = \\sum_{k=1}^3 \\tilde{\\alpha}_k \\tilde{\\mathbf{r}}_k$.\nThe wave strengths are calculated from the jumps in primitive variables:\n$$\n\\Delta\\rho = \\rho_R - \\rho_L = 1 - 1 = 0\n$$\n$$\n\\Delta u = u_R - u_L = 2 - (-2) = 4\n$$\n$$\n\\Delta p = p_R - p_L = 0.1 - 0.1 = 0\n$$\nThe formulas for the wave strengths are:\n$$\n\\tilde{\\alpha}_1 = \\frac{1}{2\\tilde{c}^2}(\\Delta p - \\tilde{\\rho}\\tilde{c}\\Delta u) = \\frac{1}{2(0.94)}(0 - (1)(\\sqrt{0.94})(4)) = -\\frac{4\\sqrt{0.94}}{2(0.94)} = -\\frac{2}{\\sqrt{0.94}}\n$$\n$$\n\\tilde{\\alpha}_2 = \\Delta\\rho - \\frac{\\Delta p}{\\tilde{c}^2} = 0 - \\frac{0}{0.94} = 0\n$$\n$$\n\\tilde{\\alpha}_3 = \\frac{1}{2\\tilde{c}^2}(\\Delta p + \\tilde{\\rho}\\tilde{c}\\Delta u) = \\frac{1}{2(0.94)}(0 + (1)(\\sqrt{0.94})(4)) = \\frac{4\\sqrt{0.94}}{2(0.94)} = \\frac{2}{\\sqrt{0.94}}\n$$\nThe approximate solution consists of constant states separated by discontinuities moving at speeds $\\tilde{\\lambda}_k$. The state between $\\tilde{\\lambda}_1$ and $\\tilde{\\lambda}_2$ is $\\mathbf{U}_{*L} = \\mathbf{U}_L + \\tilde{\\alpha}_1 \\tilde{\\mathbf{r}}_1$. The state between $\\tilde{\\lambda}_2$ and $\\tilde{\\lambda}_3$ is $\\mathbf{U}_{*R} = \\mathbf{U}_{*L} + \\tilde{\\alpha}_2 \\tilde{\\mathbf{r}}_2$. Since the contact wave strength $\\tilde{\\alpha}_2 = 0$, there is only one intermediate state, $\\mathbf{U}_* = \\mathbf{U}_{*L} = \\mathbf{U}_{*R}$.\n\nThe first right eigenvector of the Roe matrix is $\\tilde{\\mathbf{r}}_1 = (1, \\tilde{u}-\\tilde{c}, \\tilde{h}-\\tilde{u}\\tilde{c})^T$. Evaluated at the Roe-averaged state:\n$$\n\\tilde{\\mathbf{r}}_1 = (1, 0-\\sqrt{0.94}, 2.35 - 0 \\times \\sqrt{0.94})^T = (1, -\\sqrt{0.94}, 2.35)^T\n$$\nThe left state vector is $\\mathbf{U}_L = (\\rho_L, \\rho_L u_L, E_L)^T = (1, -2, 2.25)^T$.\nThe middle state $\\mathbf{U}_* = (\\rho_*, (\\rho u)_*, E_*)^T$ is computed as:\n$$\n\\mathbf{U}_* = \\mathbf{U}_L + \\tilde{\\alpha}_1 \\tilde{\\mathbf{r}}_1 = \\begin{pmatrix} 1 \\\\ -2 \\\\ 2.25 \\end{pmatrix} + \\left(-\\frac{2}{\\sqrt{0.94}}\\right) \\begin{pmatrix} 1 \\\\ -\\sqrt{0.94} \\\\ 2.35 \\end{pmatrix}\n$$\nWe compute the components of $\\mathbf{U}_*$:\n$$\n\\rho_* = 1 - \\frac{2}{\\sqrt{0.94}}\n$$\n$$\n(\\rho u)_* = -2 - \\frac{2}{\\sqrt{0.94}}(-\\sqrt{0.94}) = -2 + 2 = 0\n$$\n$$\nE_* = 2.25 - \\frac{2 \\times 2.35}{\\sqrt{0.94}} = 2.25 - \\frac{4.7}{\\sqrt{0.94}}\n$$\nFrom these conserved variables, we find the primitive variables of the middle state. The velocity is:\n$$\nu_* = \\frac{(\\rho u)_*}{\\rho_*} = \\frac{0}{\\rho_*} = 0\n$$\nThe pressure $p_*$ is found from the total energy:\n$$\nE_* = \\frac{p_*}{\\gamma - 1} + \\frac{1}{2}\\rho_* u_*^2 \\implies p_* = (\\gamma - 1) E_* \\quad (\\text{since } u_*=0)\n$$\nSubstituting the expression for $E_*$:\n$$\np_* = (1.4 - 1) \\left( 2.25 - \\frac{4.7}{\\sqrt{0.94}} \\right) = 0.4 \\left( 2.25 - \\frac{4.7}{\\sqrt{0.94}} \\right)\n$$\nNumerically, $\\sqrt{0.94} \\approx 0.969536$.\n$$\np_* \\approx 0.4 \\left( 2.25 - \\frac{4.7}{0.969536} \\right) \\approx 0.4 (2.25 - 4.84765) = 0.4 (-2.59765) \\approx -1.03906\n$$\nRounding to four significant figures, we get $p_* = -1.039$.\n\nThe negative pressure is unphysical and highlights a known failure of Roe's solver. The mechanism for this failure is as follows:\n1.  **Transonic Rarefaction:** The initial data represent a strong, symmetric expansion. The characteristic speeds associated with the acoustic waves change sign across the problem domain. For the left state, the speeds are $(u_L-c_L, u_L, u_L+c_L)$, where $c_L = \\sqrt{\\gamma p_L / \\rho_L} = \\sqrt{1.4 \\times 0.1 / 1} = \\sqrt{0.14} \\approx 0.374$. All characteristic speeds $u_L \\pm c_L$ and $u_L$ are negative: $(-2.374, -2.0, -1.626)$. For the right state, all speeds are positive: $(1.626, 2.0, 2.374)$. This situation, where a characteristic field (e.g., the $u-c$ or $u+c$ field) is subsonic on both sides but the characteristic speeds cross zero, is termed a transonic rarefaction. The exact solution contains a vacuum state ($p=0, \\rho=0$) forming at the center.\n2.  **Linearization and Non-physical Shocks:** Roe's solver is based on a linearization of the nonlinear Euler equations. It replaces the smooth rarefaction fan of the exact solution with a single discontinuity (a \"rarefaction shock\"). This jump satisfies the Rankine-Hugoniot conditions for the linearized system but violates the entropy condition for the true nonlinear system, as shocks must be compressive. The problem specified no entropy fix, which is a modification designed to add numerical dissipation in such cases to smear the rarefaction and prevent this unphysical solution.\n3.  **Loss of Invariant Domain:** The state vectors for the Euler equations must lie in an \"invariant domain\" defined by the physical constraints $\\rho  0$ and $p  0$. Roe's linearization does not, by itself, guarantee that the intermediate states $(\\mathbf{U}_*)$ will remain within this domain. For a strong expansion like this one, the jump from the initial state $\\mathbf{U}_L$ to the intermediate state $\\mathbf{U}_*$ is characterized by the wave strength $\\tilde{\\alpha}_1$. This jump, $\\tilde{\\alpha}_1 \\tilde{\\mathbf{r}}_1$, is large enough to \"overshoot\" the physical region.\n    Specifically, the new density is $\\rho_* = \\rho_L + \\tilde{\\alpha}_1 (\\tilde{\\mathbf{r}}_1)_1 = 1 - 2/\\sqrt{0.94}$. Since $2  \\sqrt{0.94}$, the resulting density $\\rho_*$ is negative. Consequently, the pressure $p_*$, which is derived from $E_*$, also becomes negative. The linearization is unable to capture the nonlinear dynamics leading to a vacuum and instead produces a mathematically consistent but physically impossible state.", "answer": "$$\n\\boxed{-1.039}\n$$", "id": "3291766"}]}