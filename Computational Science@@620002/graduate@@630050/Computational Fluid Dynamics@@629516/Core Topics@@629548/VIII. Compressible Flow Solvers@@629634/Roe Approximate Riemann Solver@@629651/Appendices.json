{"hands_on_practices": [{"introduction": "The first step toward mastering any numerical method is to implement its core algorithm from first principles. This exercise guides you through the process of building a complete Roe solver for the one-dimensional Euler equations. By calculating the Roe-averaged state, decomposing the jump in conserved variables into characteristic waves, and assembling the final numerical flux, you will gain a concrete understanding of the solver's inner workings. [@problem_id:3359352]", "problem": "Consider the one-dimensional compressible Euler equations in the context of Computational Fluid Dynamics (CFD) and Roe’s approximate Riemann solver. The conservative variables are $U = [\\rho, \\rho u, E]^T$, where $\\rho$ is the mass density in $\\mathrm{kg \\, m^{-3}}$, $u$ is the velocity in $\\mathrm{m \\, s^{-1}}$, and $E$ is the total energy density in $\\mathrm{J \\, m^{-3}}$. The pressure $p$ in $\\mathrm{Pa}$ is related to the conservative variables by the thermodynamic closure for a calorically perfect gas with specific heat ratio $\\gamma$:\n$$\np = (\\gamma - 1)\\left(E - \\tfrac{1}{2} \\rho u^2\\right).\n$$\nThe physical flux vector is\n$$\nF(U) = \\begin{bmatrix}\n\\rho u \\\\\n\\rho u^2 + p \\\\\nu(E + p)\n\\end{bmatrix},\n$$\nwith mass flux in $\\mathrm{kg \\, m^{-2} \\, s^{-1}}$, momentum flux in $\\mathrm{kg \\, m^{-1} \\, s^{-2}}$, and energy flux in $\\mathrm{W \\, m^{-2}}$.\n\nRoe’s approximate Riemann solver constructs a linearized flux Jacobian $A^{\\sim}$ at a Roe-averaged state between left and right states. Let the left and right primitive states be $(\\rho_L, u_L, p_L)$ and $(\\rho_R, u_R, p_R)$, with the same $\\gamma$. Define the left and right total energies by\n$$\nE_L = \\frac{p_L}{\\gamma - 1} + \\tfrac{1}{2} \\rho_L u_L^2, \\quad E_R = \\frac{p_R}{\\gamma - 1} + \\tfrac{1}{2} \\rho_R u_R^2,\n$$\nand the specific enthalpies by\n$$\nH_L = \\frac{E_L + p_L}{\\rho_L}, \\quad H_R = \\frac{E_R + p_R}{\\rho_R}.\n$$\nThe Roe-averaged variables are obtained by square-root density weighting:\n$$\n\\tilde{u} = \\frac{\\sqrt{\\rho_L} u_L + \\sqrt{\\rho_R} u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}, \\quad \\tilde{H} = \\frac{\\sqrt{\\rho_L} H_L + \\sqrt{\\rho_R} H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}},\n$$\nand the Roe-averaged sound speed is\n$$\n\\tilde{a} = \\sqrt{(\\gamma - 1)\\left(\\tilde{H} - \\tfrac{1}{2} \\tilde{u}^2\\right)}.\n$$\nThe eigenvalues of the Roe-linearized Jacobian $A^{\\sim}$ are\n$$\n\\Lambda = \\mathrm{diag}(\\lambda_1, \\lambda_2, \\lambda_3) = \\mathrm{diag}(\\tilde{u} - \\tilde{a}, \\tilde{u}, \\tilde{u} + \\tilde{a}),\n$$\nand a canonical set of right eigenvectors (columns of $R$) for the one-dimensional Euler system is\n$$\nr_1 = \\begin{bmatrix} 1 \\\\ \\tilde{u} - \\tilde{a} \\\\ \\tilde{H} - \\tilde{u}\\tilde{a} \\end{bmatrix}, \\quad\nr_2 = \\begin{bmatrix} 1 \\\\ \\tilde{u} \\\\ \\tfrac{1}{2}\\tilde{u}^2 \\end{bmatrix}, \\quad\nr_3 = \\begin{bmatrix} 1 \\\\ \\tilde{u} + \\tilde{a} \\\\ \\tilde{H} + \\tilde{u}\\tilde{a} \\end{bmatrix},\n$$\nso that\n$$\nR = \\begin{bmatrix}\n1 & 1 & 1 \\\\\n\\tilde{u} - \\tilde{a} & \\tilde{u} & \\tilde{u} + \\tilde{a} \\\\\n\\tilde{H} - \\tilde{u}\\tilde{a} & \\tfrac{1}{2}\\tilde{u}^2 & \\tilde{H} + \\tilde{u}\\tilde{a}\n\\end{bmatrix}.\n$$\nLet $L = R^{-1}$ be the left eigenvector matrix. The jump in conservative variables is $\\Delta U = U_R - U_L$, where $U_L = [\\rho_L, \\rho_L u_L, E_L]^T$ and $U_R = [\\rho_R, \\rho_R u_R, E_R]^T$. The wave strengths are\n$$\n\\alpha = \\begin{bmatrix} \\alpha_1 \\\\ \\alpha_2 \\\\ \\alpha_3 \\end{bmatrix} = L \\, \\Delta U.\n$$\nThe Roe numerical flux is then evaluated as\n$$\nF^{\\mathrm{Roe}} = \\tfrac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\tfrac{1}{2} \\sum_{i=1}^{3} |\\lambda_i| \\, \\alpha_i \\, r_i.\n$$\n\nYour task is to implement a complete, runnable program that, for each provided test case, does the following:\n- Computes $U_L$, $U_R$, $F(U_L)$, $F(U_R)$ from the primitive inputs and $\\gamma$.\n- Forms the Roe averages $\\tilde{u}$, $\\tilde{H}$, $\\tilde{a}$.\n- Constructs $R$, $\\Lambda$, and $L$.\n- Computes the wave strengths $\\alpha_i$.\n- Evaluates the numerical flux $F^{\\mathrm{Roe}}$ and returns its first three components (mass, momentum, energy flux).\n\nYour program must compute the matrices and wave strengths but only output the flux components. Use the following test suite of left/right primitive states with specific heat ratio $\\gamma$:\n- Test $1$ (canonical shock tube-like contrast): $(\\rho_L, u_L, p_L, \\gamma) = (1.0, 0.0, 100000.0, 1.4)$ and $(\\rho_R, u_R, p_R, \\gamma) = (0.125, 0.0, 10000.0, 1.4)$.\n- Test $2$ (contact discontinuity-like case): $(\\rho_L, u_L, p_L, \\gamma) = (1.0, 300.0, 100000.0, 1.4)$ and $(\\rho_R, u_R, p_R, \\gamma) = (0.125, 300.0, 100000.0, 1.4)$.\n- Test $3$ (strong compression case): $(\\rho_L, u_L, p_L, \\gamma) = (1.0, 800.0, 150000.0, 1.4)$ and $(\\rho_R, u_R, p_R, \\gamma) = (0.5, 100.0, 80000.0, 1.4)$.\n- Test $4$ (near-vacuum right state with opposing velocities): $(\\rho_L, u_L, p_L, \\gamma) = (1.0, 50.0, 200000.0, 1.4)$ and $(\\rho_R, u_R, p_R, \\gamma) = (0.02, -50.0, 5000.0, 1.4)$.\n\nAll fluxes must be expressed in International System of Units (SI). Specifically:\n- Mass flux in $\\mathrm{kg \\, m^{-2} \\, s^{-1}}$.\n- Momentum flux in $\\mathrm{kg \\, m^{-1} \\, s^{-2}}$.\n- Energy flux in $\\mathrm{W \\, m^{-2}}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with one triple per test case. Each triple must be of the form $[f_\\mathrm{mass}, f_\\mathrm{mom}, f_\\mathrm{energy}]$, rounded to eight decimal places, with no spaces. For example, the output format must be\n$$\n[[x_1,y_1,z_1],[x_2,y_2,z_2],[x_3,y_3,z_3],[x_4,y_4,z_4]]\n$$\nwhere $x_i$, $y_i$, $z_i$ are decimal floats.", "solution": "The problem is valid. It presents a clear, self-contained, and scientifically grounded task: to implement Roe's approximate Riemann solver for the one-dimensional Euler equations for a set of well-defined test cases. The equations, variable definitions, and the algorithmic steps are all standard and correct within the field of computational fluid dynamics. I will now provide the reasoned solution.\n\nThe solution involves a step-by-step implementation of the Roe solver algorithm as described. For each test case, we are given the primitive variables for the left and right states $(\\rho_L, u_L, p_L)$ and $(\\rho_R, u_R, p_R)$, and the ratio of specific heats $\\gamma$. The goal is to compute the Roe numerical flux, $F^{\\mathrm{Roe}}$, at the interface between these two states.\n\nThe procedure is as follows:\n\n1.  **Compute Conservative State Vectors and Physical Fluxes**\n    The first step is to convert the given primitive variables $(\\rho, u, p)$ into the vector of conservative variables $U = [\\rho, \\rho u, E]^T$. The total energy density $E$ is given by the equation of state for a calorically perfect gas:\n    $$\n    E = \\frac{p}{\\gamma - 1} + \\frac{1}{2} \\rho u^2\n    $$\n    This is done for both the left ($L$) and right ($R$) states to obtain $U_L$ and $U_R$.\n    $$\n    U_L = \\begin{bmatrix} \\rho_L \\\\ \\rho_L u_L \\\\ E_L \\end{bmatrix}, \\quad U_R = \\begin{bmatrix} \\rho_R \\\\ \\rho_R u_R \\\\ E_R \\end{bmatrix}\n    $$\n    Subsequently, the physical flux vectors $F(U_L)$ and $F(U_R)$ are computed using the formula:\n    $$\n    F(U) = \\begin{bmatrix}\n    \\rho u \\\\\n    \\rho u^2 + p \\\\\n    u(E + p)\n    \\end{bmatrix}\n    $$\n\n2.  **Compute Roe-Averaged State**\n    Roe's method linearizes the Riemann problem by introducing a special averaged state, $(\\tilde{\\rho}, \\tilde{u}, \\tilde{p}, \\tilde{H}, \\tilde{a})$. The key is that this averaged state must satisfy the Roe property, $\\Delta F = \\tilde{A} \\Delta U$, where $\\tilde{A}$ is the Jacobian evaluated at the Roe-averaged state. The specific averaging formulas provided in the problem statement guarantee this.\n    We first calculate the specific enthalpies for the left and right states:\n    $$\n    H_L = \\frac{E_L + p_L}{\\rho_L}, \\quad H_R = \\frac{E_R + p_R}{\\rho_R}\n    $$\n    The Roe-averaged velocity $\\tilde{u}$ and enthalpy $\\tilde{H}$ are then computed using a square-root density weighting:\n    $$\n    \\tilde{u} = \\frac{\\sqrt{\\rho_L} u_L + \\sqrt{\\rho_R} u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}, \\quad \\tilde{H} = \\frac{\\sqrt{\\rho_L} H_L + \\sqrt{\\rho_R} H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}\n    $$\n    From these, the Roe-averaged speed of sound $\\tilde{a}$ is found:\n    $$\n    \\tilde{a} = \\sqrt{(\\gamma - 1)\\left(\\tilde{H} - \\tfrac{1}{2} \\tilde{u}^2\\right)}\n    $$\n\n3.  **Determine the Eigenstructure of the Roe Matrix**\n    The Roe matrix $\\tilde{A}$ possesses a set of real eigenvalues and a complete set of linearly independent eigenvectors. The eigenvalues correspond to the speeds of the characteristic waves in the linearized system:\n    $$\n    \\lambda_1 = \\tilde{u} - \\tilde{a}, \\quad \\lambda_2 = \\tilde{u}, \\quad \\lambda_3 = \\tilde{u} + \\tilde{a}\n    $$\n    The corresponding right eigenvectors $r_1, r_2, r_3$ are given, and they form the columns of the right eigenvector matrix $R$. The matrix of left eigenvectors, $L$, is the inverse of $R$, i.e., $L=R^{-1}$.\n\n4.  **Calculate Wave Strengths**\n    The jump in the conservative variables, $\\Delta U = U_R - U_L$, is projected onto the basis of the right eigenvectors. The coefficients of this projection are the wave strengths, $\\alpha_i$.\n    $$\n    \\Delta U = \\sum_{i=1}^3 \\alpha_i r_i = R \\alpha\n    $$\n    The vector of wave strengths $\\alpha = [\\alpha_1, \\alpha_2, \\alpha_3]^T$ is found by solving this linear system, which is most directly done by computing $\\alpha = R^{-1} \\Delta U = L \\Delta U$.\n\n5.  **Compute the Roe Numerical Flux**\n    The Roe flux is constructed as the average of the left and right physical fluxes, plus a dissipation term that models the effects of the waves propagating from the interface. This dissipation term is constructed from the wave strengths, eigenvalues, and eigenvectors.\n    $$\n    F^{\\mathrm{Roe}} = \\frac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\frac{1}{2} \\sum_{i=1}^{3} |\\lambda_i| \\, \\alpha_i \\, r_i\n    $$\n    The term $|\\lambda_i|$ ensures that the scheme is upwinded correctly. Waves with $\\lambda_i > 0$ propagate to the right, and waves with $\\lambda_i < 0$ propagate to the left. The sum represents the net effect of these waves at the cell interface, providing the necessary numerical dissipation to ensure stability and capture discontinuities like shocks. The absolute value $|...|$ is critical, as it ensures that the dissipation term always acts to reduce the total variation, smearing sharp gradients over a few grid cells.\n\nBy implementing these steps for each test case, we can obtain the required numerical flux vector, whose components represent the flux of mass, momentum, and energy across the cell interface.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the Roe's approximate Riemann solver problem\n    for the given test cases.\n    \"\"\"\n\n    test_cases = [\n        {'L': (1.0, 0.0, 100000.0), 'R': (0.125, 0.0, 10000.0), 'gamma': 1.4},\n        {'L': (1.0, 300.0, 100000.0), 'R': (0.125, 300.0, 100000.0), 'gamma': 1.4},\n        {'L': (1.0, 800.0, 150000.0), 'R': (0.5, 100.0, 80000.0), 'gamma': 1.4},\n        {'L': (1.0, 50.0, 200000.0), 'R': (0.02, -50.0, 5000.0), 'gamma': 1.4}\n    ]\n\n    results = []\n    for case in test_cases:\n        rho_l, u_l, p_l = case['L']\n        rho_r, u_r, p_r = case['R']\n        gamma = case['gamma']\n\n        flux_vector = compute_roe_flux(rho_l, u_l, p_l, rho_r, u_r, p_r, gamma)\n        \n        formatted_flux = (f\"[{flux_vector[0]:.8f},\"\n                          f\"{flux_vector[1]:.8f},\"\n                          f\"{flux_vector[2]:.8f}]\")\n        results.append(formatted_flux)\n\n    print(f\"[{','.join(results)}]\")\n\ndef compute_roe_flux(rho_l, u_l, p_l, rho_r, u_r, p_r, gamma):\n    \"\"\"\n    Computes the Roe numerical flux for the 1D Euler equations.\n\n    Args:\n        rho_l, u_l, p_l (float): Density, velocity, and pressure for the left state.\n        rho_r, u_r, p_r (float): Density, velocity, and pressure for the right state.\n        gamma (float): Ratio of specific heats.\n\n    Returns:\n        numpy.ndarray: The Roe flux vector [mass_flux, momentum_flux, energy_flux].\n    \"\"\"\n    \n    gm1 = gamma - 1.0\n\n    # Step 1: Compute Conservative State Vectors and Physical Fluxes\n    # Left State\n    e_l = p_l / gm1 + 0.5 * rho_l * u_l**2\n    u_vec_l = np.array([rho_l, rho_l * u_l, e_l])\n    f_vec_l = np.array([rho_l * u_l, rho_l * u_l**2 + p_l, u_l * (e_l + p_l)])\n\n    # Right State\n    e_r = p_r / gm1 + 0.5 * rho_r * u_r**2\n    u_vec_r = np.array([rho_r, rho_r * u_r, e_r])\n    f_vec_r = np.array([rho_r * u_r, rho_r * u_r**2 + p_r, u_r * (e_r + p_r)])\n\n    # Step 2: Compute Roe-Averaged State\n    sqrt_rho_l = np.sqrt(rho_l)\n    sqrt_rho_r = np.sqrt(rho_r)\n    \n    # Roe-averaged velocity\n    u_roe = (sqrt_rho_l * u_l + sqrt_rho_r * u_r) / (sqrt_rho_l + sqrt_rho_r)\n    \n    # Specific enthalpies\n    h_l = (e_l + p_l) / rho_l\n    h_r = (e_r + p_r) / rho_r\n    \n    # Roe-averaged specific enthalpy\n    h_roe = (sqrt_rho_l * h_l + sqrt_rho_r * h_r) / (sqrt_rho_l + sqrt_rho_r)\n    \n    # Roe-averaged sound speed\n    a_roe_sq = gm1 * (h_roe - 0.5 * u_roe**2)\n    a_roe = np.sqrt(a_roe_sq)\n\n    # Step 3: Determine the Eigenstructure of the Roe Matrix\n    # Eigenvalues\n    lambda_vals = np.array([u_roe - a_roe, u_roe, u_roe + a_roe])\n    \n    # Right eigenvectors\n    r1 = np.array([1.0, u_roe - a_roe, h_roe - u_roe * a_roe])\n    r2 = np.array([1.0, u_roe, 0.5 * u_roe**2])\n    r3 = np.array([1.0, u_roe + a_roe, h_roe + u_roe * a_roe])\n    \n    # Right eigenvector matrix (eigenvectors as columns)\n    R = np.vstack([r1, r2, r3]).T\n\n    # Step 4: Calculate Wave Strengths\n    # Left eigenvector matrix\n    L = np.linalg.inv(R)\n    \n    # Jump in conservative variables\n    delta_u = u_vec_r - u_vec_l\n    \n    # Wave strengths\n    alpha_vals = L @ delta_u\n\n    # Step 5: Compute the Roe Numerical Flux\n    # Dissipation term: sum of |lambda_i| * alpha_i * r_i\n    dissipation = np.zeros(3)\n    abs_lambda = np.abs(lambda_vals)\n    r_vecs = [r1, r2, r3]\n    for i in range(3):\n        dissipation += abs_lambda[i] * alpha_vals[i] * r_vecs[i]\n\n    # Final Roe flux\n    f_roe = 0.5 * (f_vec_l + f_vec_r) - 0.5 * dissipation\n    \n    return f_roe\n\nif __name__ == \"__main__\":\n    solve()\n\n```", "id": "3359352"}, {"introduction": "While powerful, the basic Roe solver can fail in specific yet important scenarios like transonic rarefactions, potentially creating unphysical expansion shocks that violate the second law of thermodynamics. This practice introduces the concept of an \"entropy fix,\" a targeted modification to add numerical dissipation near sonic points where an eigenvalue $\\lambda_i$ approaches zero. You will implement Harten's entropy fix and, critically, evaluate its impact on a stationary contact discontinuity, demonstrating the importance of designing fixes that do not corrupt the solver's accuracy on other wave structures. [@problem_id:3359305]", "problem": "You are to implement and analyze Roe’s approximate Riemann solver for the one-dimensional Euler equations of gas dynamics with an ideal gas and a constant ratio of specific heats, and incorporate an entropy fix that is applied only to the acoustic fields. Then, quantitatively evaluate the effect of this entropy fix on the preservation of a stationary contact discontinuity.\n\nStart from the following fundamental base:\n- The one-dimensional Euler equations of gas dynamics in conservative form for an ideal gas are given as\n$$\nU_t + F(U)_x = 0,\n$$\nwhere the conservative state vector is\n$$\nU = \\begin{bmatrix} \\rho \\\\ \\rho u \\\\ E \\end{bmatrix},\n$$\nthe flux is\n$$\nF(U) = \\begin{bmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E+p) \\end{bmatrix},\n$$\nand the thermodynamic closure for an ideal gas is\n$$\np = (\\gamma - 1)\\left(E - \\frac{1}{2}\\rho u^2\\right).\n$$\nHere, $ \\rho $ is density, $ u $ is velocity, $ p $ is pressure, $ E $ is total energy density, and $ \\gamma $ is the ratio of specific heats.\n\n- Roe’s linearization uses Roe-averaged states to approximate the Jacobian. Define the Roe-averaged velocity $ \\tilde{u} $, Roe-averaged specific enthalpy $ \\tilde{H} $, and Roe-averaged speed of sound $ \\tilde{a} $ by\n$$\n\\tilde{u} = \\frac{\\sqrt{\\rho_L}u_L + \\sqrt{\\rho_R}u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}, \\quad\n\\tilde{H} = \\frac{\\sqrt{\\rho_L}H_L + \\sqrt{\\rho_R}H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}, \\quad\n\\tilde{a} = \\sqrt{(\\gamma - 1)\\left(\\tilde{H} - \\frac{1}{2}\\tilde{u}^2\\right)},\n$$\nwhere $ H = (E + p)/\\rho $ is the total specific enthalpy, and subscripts $ L $ and $ R $ denote left and right states.\n\n- The eigenvalues of the Roe-averaged Jacobian are\n$$\n\\lambda_1 = \\tilde{u} - \\tilde{a}, \\quad \\lambda_2 = \\tilde{u}, \\quad \\lambda_3 = \\tilde{u} + \\tilde{a},\n$$\nwith corresponding right eigenvectors (in conservative-variable form)\n$$\nr_1 = \\begin{bmatrix} 1 \\\\ \\tilde{u} - \\tilde{a} \\\\ \\tilde{H} - \\tilde{u}\\tilde{a} \\end{bmatrix}, \\quad\nr_2 = \\begin{bmatrix} 1 \\\\ \\tilde{u} \\\\ \\frac{1}{2}\\tilde{u}^2 \\end{bmatrix}, \\quad\nr_3 = \\begin{bmatrix} 1 \\\\ \\tilde{u} + \\tilde{a} \\\\ \\tilde{H} + \\tilde{u}\\tilde{a} \\end{bmatrix}.\n$$\nLet $ \\Delta U = U_R - U_L $. The wave strength vector $ \\alpha = (\\alpha_1, \\alpha_2, \\alpha_3)^T $ is obtained from the linear system\n$$\nR \\alpha = \\Delta U, \\quad \\text{where } R = [r_1 \\; r_2 \\; r_3].\n$$\n\n- Roe’s numerical flux at an interface is\n$$\n\\hat{F}(U_L, U_R) = \\frac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\frac{1}{2}\\sum_{i=1}^3 |\\lambda_i| \\alpha_i r_i.\n$$\n\n- An entropy fix regularizes the absolute eigenvalues near sonic points. Use Harten’s quadratic entropy fix function with threshold $ \\delta > 0 $:\n$$\n\\phi(|\\lambda|;\\delta) = \\begin{cases}\n\\frac{1}{2}\\left(\\frac{|\\lambda|^2}{\\delta} + \\delta\\right), & \\text{if } |\\lambda| < \\delta, \\\\\n|\\lambda|, & \\text{if } |\\lambda| \\ge \\delta.\n\\end{cases}\n$$\nApply this entropy fix only to the acoustic fields, meaning modify $ |\\lambda_1| $ and $ |\\lambda_3| $ to $ \\phi(|\\lambda_1|;\\delta) $ and $ \\phi(|\\lambda_3|;\\delta) $, while leaving $ |\\lambda_2| $ unchanged. For comparison, also consider an alternative configuration where the entropy fix is applied to all three fields.\n\nThe task:\n1. Implement a function that computes $ \\hat{F}(U_L, U_R) $ using Roe’s solver with a configurable entropy fix mode: none, acoustic-only, or all-eigenvalues.\n2. Evaluate whether a stationary contact discontinuity is preserved. A stationary contact discontinuity is defined here by $ u_L = u_R = 0 $, $ p_L = p_R $, and $ \\rho_L \\ne \\rho_R $. In such a case, the physical flux on both sides equals $ F(U_L) = F(U_R) = [0, p, 0]^T $, and perfect preservation at the interface means the numerical flux $ \\hat{F} $ equals $ [0, p, 0]^T $ exactly.\n3. Use nondimensional quantities throughout; no physical units are required.\n\nDefine the preservation criterion: For a given configuration, compute the numerical flux $ \\hat{F} $ and the exact physical flux $ F(U_L) $ for the stationary contact case, then compute the error vector $ e = \\hat{F} - F(U_L) $ and its Euclidean norm $ \\|e\\|_2 $. The interface preserves the stationary contact if $ \\|e\\|_2 \\le \\varepsilon $, where $ \\varepsilon $ is a fixed tolerance.\n\nTest Suite:\nUse the following test cases, all with ratio of specific heats $ \\gamma = 1.4 $ and tolerance $ \\varepsilon = 10^{-12} $.\n\n- Case 1 (happy path): Left $ (\\rho_L, u_L, p_L) = (1.0, 0.0, 1.0) $, Right $ (\\rho_R, u_R, p_R) = (2.0, 0.0, 1.0) $, entropy fix threshold $ \\delta = 10^{-3} $, entropy fix mode: acoustic-only. Output a boolean indicating preservation.\n\n- Case 2 (contrast configuration): Same states as Case 1, entropy fix threshold $ \\delta = 10^{-3} $, entropy fix mode: all-eigenvalues. Output a boolean indicating preservation.\n\n- Case 3 (boundary threshold): Same states as Case 1, entropy fix threshold $ \\delta = 10^{-12} $, entropy fix mode: all-eigenvalues. Output a boolean indicating preservation.\n\n- Case 4 (near-stationary contact, effect on acoustic-only fix): Left $ (\\rho_L, u_L, p_L) = (1.0, 10^{-6}, 1.0) $, Right $ (\\rho_R, u_R, p_R) = (2.0, 10^{-6}, 1.0) $, entropy fix threshold $ \\delta = 10^{-3} $. Compute numerical fluxes for entropy fix modes none and acoustic-only, and output the Euclidean norm of their difference $ \\|\\hat{F}_{\\text{acoustic}} - \\hat{F}_{\\text{none}}\\|_2 $ as a float.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $ [\\text{result1},\\text{result2},\\text{result3},\\text{result4}] $), where the first three entries are booleans for Cases 1–3 respectively, and the fourth entry is a float for Case 4. All computations must be nondimensional.", "solution": "The user has requested the implementation and analysis of Roe’s approximate Riemann solver for the one-dimensional Euler equations, with a specific focus on the effect of an entropy fix on the preservation of a stationary contact discontinuity. The problem is scientifically sound, well-posed, and all necessary definitions and data are provided. I will proceed with a full solution.\n\nThe solution involves a step-by-step implementation of the Roe solver, followed by an analysis of its behavior for the four specified test cases. The core of the method is to compute a numerical flux $\\hat{F}(U_L, U_R)$ at the interface between a left state $U_L$ and a right state $U_R$.\n\n### Step 1: State and Flux Representation\nThe problem provides states in primitive variables $(\\rho, u, p)$. These must first be converted to the conservative state vector $U = [\\rho, \\rho u, E]^T$. The total energy density $E$ is found by rearranging the ideal gas equation of state:\n$$\nE = \\frac{p}{\\gamma - 1} + \\frac{1}{2}\\rho u^2\n$$\nThe physical flux function $F(U)$ is given by:\n$$\nF(U) = \\begin{bmatrix} \\rho u \\\\ \\rho u^2 + p \\\\ u(E+p) \\end{bmatrix}\n$$\nWe will need to compute this for both the left and right states.\n\n### Step 2: Roe-Averaged State\nRoe's method linearizes the problem by introducing a state-averaged Jacobian matrix. The elements of this matrix depend on Roe-averaged quantities, which are calculated from the left ($L$) and right ($R$) states. The required averages are the velocity $\\tilde{u}$, specific enthalpy $\\tilde{H}$, and speed of sound $\\tilde{a}$.\n\nFirst, we define the specific enthalpy $H = (E+p)/\\rho$. Then, the Roe averages are computed as:\n$$\n\\tilde{u} = \\frac{\\sqrt{\\rho_L}u_L + \\sqrt{\\rho_R}u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}\n$$\n$$\n\\tilde{H} = \\frac{\\sqrt{\\rho_L}H_L + \\sqrt{\\rho_R}H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}}\n$$\n$$\n\\tilde{a} = \\sqrt{(\\gamma - 1)\\left(\\tilde{H} - \\frac{1}{2}\\tilde{u}^2\\right)}\n$$\nThese averages are constructed to satisfy the Rankine-Hugoniot condition exactly, i.e., $F(U_R) - F(U_L) = \\tilde{A}(U_R - U_L)$, where $\\tilde{A}$ is the Jacobian evaluated at the Roe-averaged state.\n\n### Step 3: Wave Decomposition\nThe jump in state across the interface, $\\Delta U = U_R - U_L$, is projected onto the basis of the right eigenvectors of the Roe-averaged Jacobian, $\\tilde{A}$. The eigenvalues of $\\tilde{A}$ are $\\lambda_1 = \\tilde{u} - \\tilde{a}$, $\\lambda_2 = \\tilde{u}$, and $\\lambda_3 = \\tilde{u} + \\tilde{a}$, corresponding to a left-going acoustic wave, an entropy/contact wave, and a right-going acoustic wave. The projection is given by the linear system:\n$$\nR \\alpha = \\Delta U\n$$\nwhere $R = [r_1, r_2, r_3]$ is the matrix whose columns are the right eigenvectors, and $\\alpha = [\\alpha_1, \\alpha_2, \\alpha_3]^T$ is the vector of wave strengths. By solving this $3 \\times 3$ system, we obtain the explicit formulas for the wave strengths:\n$$\n\\alpha_2 = \\frac{\\gamma-1}{\\tilde{a}^2} \\left( \\Delta U_1 (\\tilde{H} - \\tilde{u}^2) + \\Delta U_2 \\tilde{u} - \\Delta U_3 \\right)\n$$\n$$\n\\alpha_1 = \\frac{1}{2} \\left[ (\\Delta U_1 - \\alpha_2) - \\frac{\\Delta U_2 - \\tilde{u}\\Delta U_1}{\\tilde{a}} \\right]\n$$\n$$\n\\alpha_3 = \\frac{1}{2} \\left[ (\\Delta U_1 - \\alpha_2) + \\frac{\\Delta U_2 - \\tilde{u}\\Delta U_1}{\\tilde{a}} \\right]\n$$\nwhere $\\Delta U = [\\Delta U_1, \\Delta U_2, \\Delta U_3]^T$.\n\n### Step 4: Numerical Flux with Entropy Fix\nThe Roe numerical flux is an upwind-type flux, constructed as an average of the left and right fluxes plus a dissipation term that models the wave propagation at the interface.\n$$\n\\hat{F}(U_L, U_R) = \\frac{1}{2}\\left(F(U_L) + F(U_R)\\right) - \\frac{1}{2}\\sum_{i=1}^3 |\\lambda_i|_{\\text{fixed}} \\alpha_i r_i\n$$\nThe term $|\\lambda_i|$ introduces numerical dissipation. However, for eigenvalues near zero, this can produce non-physical solutions like expansion shocks. Harten's entropy fix is applied to regularize $|\\lambda_i|$:\n$$\n|\\lambda_i|_{\\text{fixed}} = \\phi(|\\lambda_i|;\\delta) = \\begin{cases}\n\\frac{1}{2}\\left(\\frac{|\\lambda_i|^2}{\\delta} + \\delta\\right), & \\text{if } |\\lambda_i| < \\delta \\\\\n|\\lambda_i|, & \\text{if } |\\lambda_i| \\ge \\delta\n\\end{cases}\n$$\nThe problem specifies three modes for applying this fix: `'none'`, `'acoustic-only'` (applied only to $\\lambda_1, \\lambda_3$), and `'all-eigenvalues'`.\n\n### Analysis of Test Cases\n\n**Case 1: Stationary Contact, Acoustic-Only Fix**\n- States: $(\\rho_L, u_L, p_L)=(1.0, 0.0, 1.0)$, $(\\rho_R, u_R, p_R)=(2.0, 0.0, 1.0)$. Mode: `acoustic-only`.\n- A stationary contact has $u_L=u_R=0$ and $p_L=p_R$. This implies $\\tilde{u}=0$. The physical flux on both sides is $F(U_L)=F(U_R)=[0, p, 0]^T = [0, 1, 0]^T$. For perfect preservation, $\\hat{F}$ must be equal to this flux.\n- For this configuration, the wave decomposition correctly isolates the discontinuity into the contact wave. The wave strengths are $\\alpha_1=0$, $\\alpha_3=0$, and $\\alpha_2 = \\Delta \\rho = 1$. The dissipation term becomes $\\frac{1}{2}|\\lambda_2|_{\\text{fixed}} \\alpha_2 r_2$.\n- The eigenvalue $\\lambda_2 = \\tilde{u} = 0$. In `'acoustic-only'` mode, no entropy fix is applied to this eigenvalue, so $|\\lambda_2|_{\\text{fixed}} = |\\lambda_2| = 0$.\n- The dissipation term is exactly zero. Therefore, $\\hat{F} = \\frac{1}{2}(F_L + F_R) = F_L$. The error is zero, and the stationary contact is perfectly preserved. The result is `True`.\n\n**Case 2: Stationary Contact, All-Eigenvalues Fix**\n- Same states, but the entropy fix is applied to all eigenvalues.\n- The wave strengths are again $\\alpha=(0, 1, 0)$. The dissipation is $\\frac{1}{2}|\\lambda_2|_{\\text{fixed}} \\alpha_2 r_2$.\n- The eigenvalue $\\lambda_2 = 0$. With $\\delta=10^{-3}$, we have $|\\lambda_2| < \\delta$. The fix is activated: $|\\lambda_2|_{\\text{fixed}} = \\phi(0; \\delta) = \\frac{\\delta}{2}$.\n- The dissipation term is non-zero: $\\frac{1}{2} (\\frac{\\delta}{2}) (1) r_2$, where $r_2 = [1, \\tilde{u}, \\frac{1}{2}\\tilde{u}^2]^T = [1,0,0]^T$. The dissipation vector is $[\\delta/4, 0, 0]^T$.\n- The numerical flux is $\\hat{F} = [0, 1, 0]^T - [\\delta/4, 0, 0]^T$. The error vector is $e = [-\\delta/4, 0, 0]^T$.\n- The error norm is $\\|e\\|_2 = \\delta/4 = 10^{-3}/4 = 2.5 \\times 10^{-4}$.\n- Since $2.5 \\times 10^{-4} > \\varepsilon=10^{-12}$, the condition is not met. The contact is not preserved. The result is `False`. This demonstrates that applying an entropy fix to the contact wave introduces spurious dissipation that smears a stationary contact.\n\n**Case 3: Stationary Contact, All-Eigenvalues Fix, Small Delta**\n- Same as Case 2, but with $\\delta = 10^{-12}$.\n- The error norm is again $\\delta/4 = 10^{-12}/4 = 2.5 \\times 10^{-13}$.\n- Now, $2.5 \\times 10^{-13} \\le \\varepsilon=10^{-12}$. The preservation criterion is satisfied. The result is `True`.\n\n**Case 4: Near-Stationary Contact**\n- States: $(\\rho_L, u_L, p_L)=(1.0, 10^{-6}, 1.0)$, $(\\rho_R, u_R, p_R)=(2.0, 10^{-6}, 1.0)$, $\\delta=10^{-3}$. We compute $\\|\\hat{F}_{\\text{acoustic}} - \\hat{F}_{\\text{none}}\\|_2$.\n- The difference between the two fluxes is due solely to the difference in their dissipation terms:\n$ \\hat{F}_{\\text{acoustic}} - \\hat{F}_{\\text{none}} = \\frac{1}{2} \\sum_{i=1}^3 (\\alpha_i r_i (|\\lambda_i| - |\\lambda_i|_{\\text{acoustic-fixed}})) $\n- In `'acoustic-only'` mode, the fix is only applied to $\\lambda_1$ and $\\lambda_3$.\n- For this near-stationary flow, $\\tilde{u} = 10^{-6}$ and the Roe-averaged sound speed $\\tilde{a} \\approx 0.995$.\n- The acoustic eigenvalues are $\\lambda_1 = \\tilde{u} - \\tilde{a} \\approx -0.995$ and $\\lambda_3 = \\tilde{u} + \\tilde{a} \\approx 0.995$.\n- The corresponding absolute values are $|\\lambda_1| \\approx 0.995$ and $|\\lambda_3| \\approx 0.995$. Both are much larger than the threshold $\\delta = 10^{-3}$.\n- According to the definition of $\\phi$, if $|\\lambda| \\ge \\delta$, then $\\phi(|\\lambda|; \\delta) = |\\lambda|$.\n- Thus, for both acoustic waves, the entropy fix does nothing. $|\\lambda_{1,3}|_{\\text{acoustic-fixed}} = |\\lambda_{1,3}|$.\n- The dissipation terms for the `'acoustic-only'` and `'none'` modes are identical, and the difference between the fluxes is zero. The result is `0.0`.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_roe_flux(rho_L, u_L, p_L, rho_R, u_R, p_R, gamma, delta, mode):\n    \"\"\"\n    Computes Roe's approximate Riemann solver flux for the 1D Euler equations.\n    \"\"\"\n    # Step 1: Convert primitive variables to conservative variables\n    E_L = p_L / (gamma - 1.0) + 0.5 * rho_L * u_L**2\n    U_L = np.array([rho_L, rho_L * u_L, E_L])\n    \n    E_R = p_R / (gamma - 1.0) + 0.5 * rho_R * u_R**2\n    U_R = np.array([rho_R, rho_R * u_R, E_R])\n\n    # Compute physical fluxes\n    F_L = np.array([rho_L * u_L, rho_L * u_L**2 + p_L, u_L * (E_L + p_L)])\n    F_R = np.array([rho_R * u_R, rho_R * u_R**2 + p_R, u_R * (E_R + p_R)])\n\n    # Step 2: Compute Roe-averaged quantities\n    sqrt_rho_L = np.sqrt(rho_L)\n    sqrt_rho_R = np.sqrt(rho_R)\n    \n    u_tilde = (sqrt_rho_L * u_L + sqrt_rho_R * u_R) / (sqrt_rho_L + sqrt_rho_R)\n    \n    H_L = (E_L + p_L) / rho_L\n    H_R = (E_R + p_R) / rho_R\n    H_tilde = (sqrt_rho_L * H_L + sqrt_rho_R * H_R) / (sqrt_rho_L + sqrt_rho_R)\n    \n    a_tilde_sq = (gamma - 1.0) * (H_tilde - 0.5 * u_tilde**2)\n    # Ensure non-negativity before sqrt due to potential floating point errors\n    a_tilde = np.sqrt(max(0.0, a_tilde_sq))\n\n    # Step 3: Compute wave strengths (alpha vector)\n    Delta_U = U_R - U_L\n    Delta_U1, Delta_U2, Delta_U3 = Delta_U\n    \n    if a_tilde == 0:\n        # This case is degenerate and not expected for the given problems.\n        # A robust implementation would handle this, e.g., by falling\n        # back to a more diffusive flux like Lax-Friedrichs.\n        # For this problem set, an exception is sufficient.\n        raise ValueError(\"Roe-averaged sound speed is zero.\")\n\n    alpha_2 = (gamma - 1.0) / a_tilde**2 * (Delta_U1 * (H_tilde - u_tilde**2) + Delta_U2 * u_tilde - Delta_U3)\n    alpha_1 = 0.5 * ((Delta_U1 - alpha_2) - (Delta_U2 - u_tilde * Delta_U1) / a_tilde)\n    alpha_3 = 0.5 * ((Delta_U1 - alpha_2) + (Delta_U2 - u_tilde * Delta_U1) / a_tilde)\n    alphas = np.array([alpha_1, alpha_2, alpha_3])\n\n    # Eigenvalues and right eigenvectors\n    lambdas = np.array([u_tilde - a_tilde, u_tilde, u_tilde + a_tilde])\n    \n    r1 = np.array([1.0, u_tilde - a_tilde, H_tilde - u_tilde * a_tilde])\n    r2 = np.array([1.0, u_tilde, 0.5 * u_tilde**2])\n    r3 = np.array([1.0, u_tilde + a_tilde, H_tilde + u_tilde * a_tilde])\n    R = np.array([r1, r2, r3]).T # Eigenvectors as columns\n\n    # Step 4: Apply Harten's entropy fix\n    def phi(lambda_abs, d):\n        return 0.5 * (lambda_abs**2 / d + d) if lambda_abs < d else lambda_abs\n\n    abs_lambdas_fixed = np.abs(lambdas)\n    \n    if mode == 'acoustic-only':\n        abs_lambdas_fixed[0] = phi(abs_lambdas_fixed[0], delta)\n        abs_lambdas_fixed[2] = phi(abs_lambdas_fixed[2], delta)\n    elif mode == 'all-eigenvalues':\n        for i in range(3):\n            abs_lambdas_fixed[i] = phi(abs_lambdas_fixed[i], delta)\n    # Mode 'none' requires no changes\n\n    # Step 5: Compute Roe flux\n    dissipation = 0.5 * np.dot(R, (abs_lambdas_fixed * alphas))\n    \n    F_hat = 0.5 * (F_L + F_R) - dissipation\n    return F_hat\n\ndef solve():\n    # Define the test cases from the problem statement.\n    gamma = 1.4\n    epsilon = 1e-12\n    \n    test_cases = [\n        # Case 1\n        {'rho_L': 1.0, 'u_L': 0.0, 'p_L': 1.0, 'rho_R': 2.0, 'u_R': 0.0, 'p_R': 1.0, 'delta': 1e-3, 'mode': 'acoustic-only'},\n        # Case 2\n        {'rho_L': 1.0, 'u_L': 0.0, 'p_L': 1.0, 'rho_R': 2.0, 'u_R': 0.0, 'p_R': 1.0, 'delta': 1e-3, 'mode': 'all-eigenvalues'},\n        # Case 3\n        {'rho_L': 1.0, 'u_L': 0.0, 'p_L': 1.0, 'rho_R': 2.0, 'u_R': 0.0, 'p_R': 1.0, 'delta': 1e-12, 'mode': 'all-eigenvalues'},\n        # Case 4\n        {'rho_L': 1.0, 'u_L': 1e-6, 'p_L': 1.0, 'rho_R': 2.0, 'u_R': 1e-6, 'p_R': 1.0, 'delta': 1e-3}\n    ]\n\n    results = []\n\n    # Cases 1, 2, 3: Preservation of stationary contact\n    for i in range(3):\n        case = test_cases[i]\n        \n        roe_flux = compute_roe_flux(case['rho_L'], case['u_L'], case['p_L'],\n                                      case['rho_R'], case['u_R'], case['p_R'],\n                                      gamma, case['delta'], case['mode'])\n        \n        # For a stationary contact, the exact flux is F(U_L) = [0, p, 0]\n        exact_flux = np.array([0.0, case['p_L'], 0.0])\n        \n        error_norm = np.linalg.norm(roe_flux - exact_flux)\n        \n        results.append(error_norm <= epsilon)\n\n    # Case 4: Difference between acoustic-only and no-fix fluxes\n    case4 = test_cases[3]\n    \n    flux_acoustic = compute_roe_flux(case4['rho_L'], case4['u_L'], case4['p_L'],\n                                     case4['rho_R'], case4['u_R'], case4['p_R'],\n                                     gamma, case4['delta'], 'acoustic-only')\n    \n    flux_none = compute_roe_flux(case4['rho_L'], case4['u_L'], case4['p_L'],\n                                 case4['rho_R'], case4['u_R'], case4['p_R'],\n                                 gamma, case4['delta'], 'none')\n\n    diff_norm = np.linalg.norm(flux_acoustic - flux_none)\n    results.append(diff_norm)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(str(r) for r in results)}]\")\n\nsolve()\n```", "id": "3359305"}, {"introduction": "Beyond entropy violations, the Roe solver's linearization can sometimes lead to states with non-physical negative density or pressure, particularly in problems involving strong rarefactions or near-vacuum conditions. This exercise has you confront this failure mode and implement a robust solution by blending the high-resolution Roe flux with the more diffusive but inherently positivity-preserving Harten–Lax–van Leer–Einfeldt (HLLE) flux. This hands-on task illustrates a practical technique for developing hybrid schemes that adaptively balance accuracy with the crucial requirement of physical admissibility. [@problem_id:3359360]", "problem": "Consider the one-dimensional compressible Euler equations in conservative variables for an ideal gas with ratio of specific heats $\\gamma \\in \\mathbb{R}$, $\\gamma > 1$:\n$$\n\\partial_t \\mathbf{U} + \\partial_x \\mathbf{F}(\\mathbf{U}) = \\mathbf{0}, \\quad \\mathbf{U} = \\begin{bmatrix} \\rho \\\\ m \\\\ E \\end{bmatrix}, \\quad \\mathbf{F}(\\mathbf{U}) = \\begin{bmatrix} m \\\\ \\dfrac{m^2}{\\rho} + p \\\\ (E+p)u \\end{bmatrix},\n$$\nwith primitive variables $\\rho > 0$, $u = m/\\rho$, pressure $p$, and total energy $E$ related by the ideal gas equation of state\n$$\np = (\\gamma - 1)\\left( E - \\tfrac{1}{2}\\rho u^2 \\right).\n$$\nDefine the invariant region $\\mathcal{G} = \\{ \\mathbf{U}: \\rho > 0,\\ p > 0 \\}$.\n\nLet the Roe linearization at a left and right state $(\\mathbf{U}_L, \\mathbf{U}_R)$ be defined by the standard Roe-averaged velocity $\\tilde{u}$, total enthalpy $\\tilde{H}$, and sound speed $\\tilde{a}$:\n$$\n\\tilde{u} = \\frac{\\sqrt{\\rho_L}\\,u_L + \\sqrt{\\rho_R}\\,u_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}},\\quad\n\\tilde{H} = \\frac{\\sqrt{\\rho_L}\\,H_L + \\sqrt{\\rho_R}\\,H_R}{\\sqrt{\\rho_L} + \\sqrt{\\rho_R}},\\quad\n\\tilde{a}^2 = (\\gamma - 1)\\left(\\tilde{H} - \\tfrac{1}{2}\\tilde{u}^2\\right),\n$$\nwhere $H = (E + p)/\\rho$ and $u = m/\\rho$. The Roe flux $\\mathbf{F}^{\\mathrm{Roe}}(\\mathbf{U}_L,\\mathbf{U}_R)$ is the approximate Riemann flux computed using the eigen-decomposition of the Roe matrix with eigenvalues $\\tilde{u}-\\tilde{a}$, $\\tilde{u}$, $\\tilde{u}+\\tilde{a}$ and the corresponding right eigenvectors. The Harten–Lax–van Leer–Einfeldt (HLLE) flux $\\mathbf{F}^{\\mathrm{HLLE}}(\\mathbf{U}_L,\\mathbf{U}_R)$ is defined by one-sided signal speeds $S_L \\le 0 \\le S_R$ constructed from consistent lower and upper bounds on the fastest left- and right-moving characteristics, for example\n$$\nS_L = \\min\\{u_L - c_L,\\ \\tilde{u} - \\tilde{a},\\ u_R - c_R\\},\\quad\nS_R = \\max\\{u_L + c_L,\\ \\tilde{u} + \\tilde{a},\\ u_R + c_R\\},\n$$\nwhere $c = \\sqrt{\\gamma p/\\rho}$ is the physical sound speed, and\n$$\n\\mathbf{F}^{\\mathrm{HLLE}}(\\mathbf{U}_L,\\mathbf{U}_R) = \n\\begin{cases}\n\\mathbf{F}(\\mathbf{U}_L), & S_L \\ge 0,\\\\\n\\mathbf{F}(\\mathbf{U}_R), & S_R \\le 0,\\\\\n\\dfrac{S_R \\mathbf{F}(\\mathbf{U}_L) - S_L \\mathbf{F}(\\mathbf{U}_R) + S_L S_R (\\mathbf{U}_R - \\mathbf{U}_L)}{S_R - S_L}, & \\text{otherwise}.\n\\end{cases}\n$$\n\nA first-order finite volume update on a uniform mesh with $\\Delta x > 0$ is given by\n$$\n\\mathbf{U}_i^{n+1} = \\mathbf{U}_i^{n} - \\lambda \\left( \\hat{\\mathbf{F}}_{i+\\tfrac{1}{2}} - \\hat{\\mathbf{F}}_{i-\\tfrac{1}{2}} \\right), \\quad \\lambda = \\frac{\\Delta t}{\\Delta x},\n$$\nwhere $\\hat{\\mathbf{F}}_{i\\pm \\tfrac{1}{2}}$ is a consistent numerical flux and $\\Delta t > 0$ is the time step chosen via a Courant–Friedrichs–Lewy (CFL) number $\\nu \\in (0,1)$ as\n$$\n\\Delta t = \\nu \\frac{\\Delta x}{\\max_i\\left(|u_i| + c_i\\right)}.\n$$\n\nTasks:\n1. Construct explicit left–right initial states $(\\mathbf{U}_L,\\mathbf{U}_R) \\in \\mathcal{G} \\times \\mathcal{G}$ such that the Roe linearized intermediate state in the central fan between the first and third wave segments has either $\\rho^\\star < 0$ or $p^\\star < 0$. To make this check algorithmically verifiable without advancing in time, define the Roe star state as\n$$\n\\mathbf{U}^\\star = \\mathbf{U}_L + \\alpha_1 \\mathbf{r}_1 + \\alpha_2 \\mathbf{r}_2,\n$$\nwhere $\\{\\mathbf{r}_1,\\mathbf{r}_2,\\mathbf{r}_3\\}$ are the Roe right eigenvectors at $(\\tilde{u},\\tilde{H},\\tilde{a})$ and the wave strength coefficients $\\alpha_k$ are defined by the linear system\n$$\n[\\mathbf{r}_1\\ \\mathbf{r}_2\\ \\mathbf{r}_3]\\begin{bmatrix}\\alpha_1\\\\ \\alpha_2\\\\ \\alpha_3\\end{bmatrix} = \\mathbf{U}_R - \\mathbf{U}_L.\n$$\nDeclare Roe’s solver to be non-admissible for a given $(\\mathbf{U}_L,\\mathbf{U}_R)$ if either component of $\\mathbf{U}^\\star$ yields $\\rho^\\star \\le 0$ or $p^\\star \\le 0$.\n\n2. Design a positivity-preserving flux modification by blending the Roe flux with the HLLE flux at each interface,\n$$\n\\hat{\\mathbf{F}}_{\\theta}(\\mathbf{U}_L,\\mathbf{U}_R) = \\mathbf{F}^{\\mathrm{HLLE}}(\\mathbf{U}_L,\\mathbf{U}_R) + \\theta \\left( \\mathbf{F}^{\\mathrm{Roe}}(\\mathbf{U}_L,\\mathbf{U}_R) - \\mathbf{F}^{\\mathrm{HLLE}}(\\mathbf{U}_L,\\mathbf{U}_R) \\right), \\quad \\theta \\in [0,1],\n$$\nwith an interface-wise parameter $\\theta$ chosen adaptively to ensure that, after one forward Euler step on a periodic mesh with three cells, all updated cell states lie in $\\mathcal{G}$. The choice of $\\theta$ must be computable purely from local neighbor information at each interface and must never increase beyond $\\theta = 1$. Implement a constructive selection rule for $\\theta$ that always guarantees $\\rho_i^{n+1} > 0$ and $p_i^{n+1} > 0$ for the two cells sharing the interface, whenever the CFL number satisfies a bound of the form $\\nu \\le \\nu_0$ for some $\\nu_0 \\in (0,1)$ that you must explicitly specify.\n\n3. Prove an invariant-region property: show that for the HLLE flux alone (that is, for $\\theta = 0$), the mapping $\\mathbf{U}^n \\mapsto \\mathbf{U}^{n+1}$ preserves $\\mathcal{G}$ under the CFL bound $\\nu \\le \\nu_0$, and that the blending with $\\theta \\in [0,1]$ as constructed in task $2$ preserves $\\mathcal{G}$ as well.\n\nImplementation requirements:\n- Use the ideal gas equation with $\\gamma = 1.4$.\n- Use a three-cell periodic mesh with $\\Delta x = 1$ and a single forward Euler step.\n- For the positivity-preserving blended flux, use $\\nu = 0.45$.\n- For the Roe non-admissibility check in task $1$, do not advance in time; only check the Roe star state $\\mathbf{U}^\\star$ as defined above.\n- Treat states as nondimensional; no physical units are required.\n\nTest suite:\n- Use the following left–right primitive-state pairs $(\\rho_L,u_L,p_L;\\ \\rho_R,u_R,p_R)$ and, for the blended-flux update, initialize the three periodic cells as $[\\text{left},\\ \\text{right},\\ \\text{left}]$:\n  - Case A (extreme symmetric rarefaction): $(1.0,-100.0,10^{-6};\\ 1.0,100.0,10^{-6})$.\n  - Case B (strong asymmetric rarefaction with density contrast): $(10.0,-60.0,10^{-4};\\ 0.1,60.0,10^{-6})$.\n  - Case C (moderate shock-tube-like): $(1.0,0.0,1.0;\\ 0.125,0.0,0.1)$.\n  - Case D (near vacuum with opposing velocities): $(10^{-3},-20.0,10^{-12};\\ 10^{-3},20.0,10^{-12})$.\n\nRequired outputs:\n- For each case, output two booleans:\n  - The first boolean is true if Roe’s star state is non-admissible, that is, if $\\rho^\\star \\le 0$ or $p^\\star \\le 0$.\n  - The second boolean is true if, after one periodic three-cell update using the blended flux with $\\nu = 0.45$, all updated cell states satisfy $\\rho > 0$ and $p > 0$.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered as\n$$\n[\\text{roe\\_bad\\_A},\\ \\text{pos\\_ok\\_A},\\ \\text{roe\\_bad\\_B},\\ \\text{pos\\_ok\\_B},\\ \\text{roe\\_bad\\_C},\\ \\text{pos\\_ok\\_C},\\ \\text{roe\\_bad\\_D},\\ \\text{pos\\_ok\\_D}],\n$$\nwhere each symbol is a boolean literal in the implementation language.", "solution": "The problem is valid as it is scientifically grounded in the well-understood principles of computational fluid dynamics, specifically concerning the numerical solution of the Euler equations. It presents a clear, objective, and well-posed set of tasks: analyzing a known failure mode of the Roe approximate Riemann solver and implementing a standard positivity-preserving correction by blending it with the robust HLLE flux. The parameters, initial conditions, and required outputs are all explicitly defined, making the problem self-contained and verifiable.\n\n### Theoretical Foundation\n\nThe one-dimensional Euler equations for a compressible ideal gas are a system of hyperbolic conservation laws:\n$$\n\\partial_t \\mathbf{U} + \\partial_x \\mathbf{F}(\\mathbf{U}) = \\mathbf{0}\n$$\nwhere $\\mathbf{U} = [\\rho, m, E]^T$ is the vector of conserved variables (density, momentum, total energy) and $\\mathbf{F}(\\mathbf{U})$ is the flux vector. The system must be closed with an equation of state, which for an ideal gas relates pressure $p$ to the conserved quantities:\n$$\np = (\\gamma - 1)\\left( E - \\tfrac{1}{2}\\rho u^2 \\right) = (\\gamma - 1)\\left( E - \\tfrac{1}{2}\\frac{m^2}{\\rho} \\right)\n$$\nA physically meaningful solution must reside in the invariant region $\\mathcal{G} = \\{ \\mathbf{U}: \\rho > 0, p > 0 \\}$.\n\nA first-order finite volume method updates the cell-average state $\\mathbf{U}_i$ via:\n$$\n\\mathbf{U}_i^{n+1} = \\mathbf{U}_i^{n} - \\frac{\\Delta t}{\\Delta x} \\left( \\hat{\\mathbf{F}}_{i+\\tfrac{1}{2}} - \\hat{\\mathbf{F}}_{i-\\tfrac{1}{2}} \\right)\n$$\nwhere $\\hat{\\mathbf{F}}_{i\\pm\\tfrac{1}{2}}$ is a numerical flux function consistent with $\\mathbf{F}(\\mathbf{U})$. The choice of numerical flux is crucial for the stability, accuracy, and physical admissibility of the solution.\n\n#### Task 1: Non-Admissibility of the Roe Solver\n\nRoe's approximate Riemann solver linearizes the problem at each cell interface $(i+\\tfrac{1}{2})$ by finding a matrix $\\tilde{\\mathbf{A}}(\\mathbf{U}_i, \\mathbf{U}_{i+1})$ (the Roe matrix) that satisfies $\\mathbf{F}(\\mathbf{U}_{i+1}) - \\mathbf{F}(\\mathbf{U}_i) = \\tilde{\\mathbf{A}}(\\mathbf{U}_{i+1} - \\mathbf{U}_i)$. The matrix $\\tilde{\\mathbf{A}}$ is constructed using Roe-averaged states. While computationally efficient, this linearization can fail to respect the non-linear constraints of the Euler equations, particularly for problems involving strong rarefactions or near-vacuum states. This can lead to the generation of states with non-physical negative density or pressure.\n\nThe problem defines a specific check for this failure. Given left and right states $(\\mathbf{U}_L, \\mathbf{U}_R)$:\n1.  Compute the Roe-averaged quantities $(\\tilde{u}, \\tilde{H}, \\tilde{a})$.\n2.  The jump $\\Delta\\mathbf{U} = \\mathbf{U}_R - \\mathbf{U}_L$ is decomposed in the basis of the right eigenvectors $\\{\\mathbf{r}_1, \\mathbf{r}_2, \\mathbf{r}_3\\}$ of the Roe matrix: $\\Delta\\mathbf{U} = \\sum_{k=1}^3 \\alpha_k \\mathbf{r}_k$.\n3.  The coefficients $\\alpha_k$ are found by solving this linear system. We use the standard eigenvectors:\n    $$\n    \\mathbf{r}_1 = \\begin{bmatrix} 1 \\\\ \\tilde{u}-\\tilde{a} \\\\ \\tilde{H}-\\tilde{u}\\tilde{a} \\end{bmatrix}, \\quad\n    \\mathbf{r}_2 = \\begin{bmatrix} 1 \\\\ \\tilde{u} \\\\ \\frac{1}{2}\\tilde{u}^2 \\end{bmatrix}, \\quad\n    \\mathbf{r}_3 = \\begin{bmatrix} 1 \\\\ \\tilde{u}+\\tilde{a} \\\\ \\tilde{H}+\\tilde{u}\\tilde{a} \\end{bmatrix}\n    $$\n    The second eigenvector $\\mathbf{r}_2$ corresponds to a jump in entropy at constant pressure and velocity.\n4.  An intermediate \"star\" state is defined as $\\mathbf{U}^\\star = \\mathbf{U}_L + \\alpha_1 \\mathbf{r}_1 + \\alpha_2 \\mathbf{r}_2$. This state is checked for physical admissibility by converting it to primitive variables $(\\rho^\\star, u^\\star, p^\\star)$ and verifying if $\\rho^\\star > 0$ and $p^\\star > 0$. If not, the solver is deemed non-admissible for this pair of states.\n\n#### Task 3: Invariant-Region Property of the HLLE Flux\n\nThe HLLE flux is known to be robustly positivity-preserving under an appropriate CFL condition. The update scheme can be proven to be a convex combination of states from the previous time step, which preserves the convex set $\\mathcal{G}$.\nThe HLLE finite volume scheme can be shown to preserve positivity of $\\rho$ and $p$ provided the time step $\\Delta t$ satisfies the CFL-like condition:\n$$\n\\frac{\\Delta t}{\\Delta x} \\max_{j} \\left( S_{R, j+\\tfrac{1}{2}} - S_{L, j+\\tfrac{1}{2}} \\right) \\le 1\n$$\nwhere the maximum is taken over all cell interfaces $j+\\tfrac{1}{2}$. The signal speeds $S_L$ and $S_R$ are defined as:\n$$\nS_L = \\min\\{u_L - c_L,\\ \\tilde{u} - \\tilde{a},\\ u_R - c_R\\}, \\quad S_R = \\max\\{u_L + c_L,\\ \\tilde{u} + \\tilde{a},\\ u_R + c_R\\}\n$$\nLet $S_{\\text{max}} = \\max_i(|u_i| + c_i)$. The time step is $\\Delta t = \\nu \\frac{\\Delta x}{S_{\\text{max}}}$.\nFrom the definitions of $S_L$ and $S_R$, we have the bounds $S_R \\le S_{\\text{max}}$ and $S_L \\ge -S_{\\text{max}}$. Thus, $S_R - S_L \\le 2S_{\\text{max}}$. Substituting this into the CFL condition:\n$$\n\\frac{1}{S_{\\text{max}}} \\nu \\cdot (2 S_{\\text{max}}) \\le 1 \\implies 2\\nu \\le 1 \\implies \\nu \\le 0.5\n$$\nTherefore, for $\\nu \\le \\nu_0 = 0.5$, the HLLE scheme is guaranteed to preserve the invariant region $\\mathcal{G}$.\n\n#### Task 2: Positivity-Preserving Blended Flux\n\nTo combine the accuracy of the Roe solver with the robustness of HLLE, we use a blended flux:\n$$\n\\hat{\\mathbf{F}}_{\\theta} = (1-\\theta)\\mathbf{F}^{\\mathrm{HLLE}} + \\theta \\mathbf{F}^{\\mathrm{Roe}}\n$$\nwhere $\\theta \\in [0,1]$ is an adaptive parameter. To ensure positivity, $\\theta$ must be chosen carefully at each interface. A constructive method, following the framework of positivity-preserving limiters (e.g., Zhang & Shu, JCP 2010), is employed.\n\nAt each interface $j=i+\\tfrac{1}{2}$ between cells $i$ and $i+1$, we determine a single parameter $\\theta_j$ that ensures positivity for the updates in both adjacent cells. This is achieved by considering two \"test states\" which isolate the contribution of the flux at interface $j$:\n$$\n\\mathbf{P}_{i} (\\theta_j) = \\mathbf{U}_i^n - 2\\lambda \\left( \\hat{\\mathbf{F}}_{\\theta_j}(\\mathbf{U}_i^n, \\mathbf{U}_{i+1}^n) - \\mathbf{F}(\\mathbf{U}_i^n) \\right)\n$$\n$$\n\\mathbf{P}_{i+1}(\\theta_j) = \\mathbf{U}_{i+1}^n + 2\\lambda \\left( \\hat{\\mathbf{F}}_{\\theta_j}(\\mathbf{U}_i^n, \\mathbf{U}_{i+1}^n) - \\mathbf{F}(\\mathbf{U}_{i+1}^n) \\right)\n$$\nwhere $\\lambda = \\Delta t/\\Delta x$. For the overall scheme to be positivity-preserving under a CFL condition $\\nu \\le \\nu_0/2 = 0.25$, it is sufficient to ensure $\\mathbf{P}_i, \\mathbf{P}_{i+1} \\in \\mathcal{G}$. Although the problem uses $\\nu=0.45$, this limiting procedure is a robust heuristic that often works beyond its strict theoretical bounds.\n\nLet $\\mathbf{F}^{\\mathrm{R-H}} = \\mathbf{F}^{\\mathrm{Roe}} - \\mathbf{F}^{\\mathrm{HLLE}}$. The test state for cell $i$ can be written as:\n$$\n\\mathbf{P}_{i}(\\theta_j) = \\left( \\mathbf{U}_i^n - 2\\lambda(\\mathbf{F}^{\\mathrm{HLLE}} - \\mathbf{F}_i^n) \\right) - 2\\lambda\\theta_j \\mathbf{F}^{\\mathrm{R-H}}\n$$\nLet $\\mathbf{U}_{\\mathrm{base}} = \\mathbf{U}_i^n - 2\\lambda(\\mathbf{F}^{\\mathrm{HLLE}} - \\mathbf{F}_i^n)$, which is guaranteed to be in $\\mathcal{G}$ under the stricter CFL condition. Let $\\delta\\mathbf{U} = -2\\lambda \\mathbf{F}^{\\mathrm{R-H}}$. We need to find the largest $\\theta \\in [0,1]$ such that $\\mathbf{U}(\\theta) = \\mathbf{U}_{\\mathrm{base}} + \\theta \\delta\\mathbf{U}$ is in $\\mathcal{G}$. This involves two conditions:\n1.  **Density Positivity**: $\\rho(\\theta) = \\rho_{\\mathrm{base}} + \\theta \\delta\\rho > 0$. This is a linear inequality in $\\theta$.\n2.  **Pressure Positivity**: $p(\\theta) = (\\gamma-1)(E(\\theta) - \\frac{m(\\theta)^2}{2\\rho(\\theta)}) > 0$. This transforms into a quadratic inequality $A\\theta^2 + B\\theta + C > 0$, where $C > 0$.\n\nBy solving these inequalities for $\\mathbf{P}_i$ and $\\mathbf{P}_{i+1}$, we obtain two upper bounds, $\\theta_{i, \\max}$ and $\\theta_{i+1, \\max}$. The final blending factor for interface $j$ is $\\theta_j = \\min(\\theta_{i, \\max}, \\theta_{i+1, \\max}, 1.0)$. This construction ensures that the blended flux reverts towards the robust HLLE flux just enough to maintain physical admissibility.\n\nThe full finite volume update is then performed using these locally-determined blended fluxes. This procedure preserves the invariant region $\\mathcal{G}$, as required by Task 3 for the blended scheme.\n\n### Numerical Implementation\n\nTo solve the problem, we implement the following components:\n1.  Functions for conversion between primitive $(\\rho, u, p)$ and conservative $(\\rho, m, E)$ variables.\n2.  Functions to compute the physical flux $\\mathbf{F}(\\mathbf{U})$, sound speed $c$, and total enthalpy $H$.\n3.  A function for the Roe non-admissibility check (Task 1).\n4.  Functions to compute the Roe flux and the HLLE flux.\n5.  A function to compute the positivity-preserving blending factor $\\theta$ at an interface by solving the linear and quadratic inequalities for the two adjacent cells.\n6.  A main routine that sets up the three-cell periodic problem, computes the time step, determines the $\\theta$ for each interface, performs the finite volume update, and checks the final states for positivity.\n\nThe final code will execute this logic for each of the four test cases provided and format the boolean results as required.", "answer": "```python\nimport numpy as np\n\n# Global constants\nGAMMA = 1.4\nGAMMA_MINUS_1 = GAMMA - 1.0\n\n# --- Primitive and Conservative Variable Conversions ---\ndef prim_to_cons(rho, u, p):\n    \"\"\"Converts primitive variables to conservative variables.\"\"\"\n    m = rho * u\n    E = p / GAMMA_MINUS_1 + 0.5 * rho * u**2\n    return np.array([rho, m, E])\n\ndef cons_to_prim(U):\n    \"\"\"Converts conservative variables to primitive variables.\"\"\"\n    rho, m, E = U\n    if rho <= 0:\n        return np.array([rho, 0.0, -1.0]) # Invalid state\n    u = m / rho\n    p = GAMMA_MINUS_1 * (E - 0.5 * m * u)\n    if p <= 0:\n        return np.array([rho, u, p]) # Invalid state\n    return np.array([rho, u, p])\n\n# --- Physics Calculations ---\ndef get_flux(U):\n    \"\"\"Computes the Euler flux vector F(U).\"\"\"\n    rho, m, E = U\n    if rho <= 0: # Handle non-physical state\n        return np.zeros(3)\n    u = m / rho\n    p = GAMMA_MINUS_1 * (E - 0.5 * m * u)\n    if p < 0: p = 0 # Pressure cannot be negative in flux calculation\n    \n    F = np.zeros(3)\n    F[0] = m\n    F[1] = m * u + p\n    F[2] = (E + p) * u\n    return F\n\ndef get_h_and_c(rho, u, p):\n    \"\"\"Computes total enthalpy H and sound speed c.\"\"\"\n    if rho <= 0 or p <= 0:\n        return 0, 0\n    E = p / GAMMA_MINUS_1 + 0.5 * rho * u**2\n    H = (E + p) / rho\n    c = np.sqrt(GAMMA * p / rho)\n    return H, c\n    \n# --- Task 1: Roe Non-Admissibility Check ---\ndef check_roe_admissibility(prim_L, prim_R):\n    \"\"\"Checks if the Roe intermediate state is non-physical.\"\"\"\n    rho_L, u_L, p_L = prim_L\n    rho_R, u_R, p_R = prim_R\n    \n    U_L = prim_to_cons(rho_L, u_L, p_L)\n    U_R = prim_to_cons(rho_R, u_R, p_R)\n\n    # Roe averages\n    sqrt_rho_L, sqrt_rho_R = np.sqrt(rho_L), np.sqrt(rho_R)\n    tilde_u = (sqrt_rho_L * u_L + sqrt_rho_R * u_R) / (sqrt_rho_L + sqrt_rho_R)\n    \n    H_L, _ = get_h_and_c(rho_L, u_L, p_L)\n    H_R, _ = get_h_and_c(rho_R, u_R, p_R)\n    tilde_H = (sqrt_rho_L * H_L + sqrt_rho_R * H_R) / (sqrt_rho_L + sqrt_rho_R)\n\n    a_sq = GAMMA_MINUS_1 * (tilde_H - 0.5 * tilde_u**2)\n    if a_sq < 0:\n        return True # Roe average leads to imaginary sound speed\n\n    tilde_a = np.sqrt(a_sq)\n\n    # Eigenvectors\n    r1 = np.array([1.0, tilde_u - tilde_a, tilde_H - tilde_u * tilde_a])\n    r2 = np.array([1.0, tilde_u, 0.5 * tilde_u**2])\n    r3 = np.array([1.0, tilde_u + tilde_a, tilde_H + tilde_u * tilde_a])\n    R_matrix = np.vstack([r1, r2, r3]).T\n\n    # Solve for wave strengths\n    delta_U = U_R - U_L\n    try:\n        alphas = np.linalg.solve(R_matrix, delta_U)\n    except np.linalg.LinAlgError:\n        return True # Singular matrix, pathological case\n    alpha1, alpha2, _ = alphas\n    \n    # Compute star state as defined in the problem\n    U_star = U_L + alpha1 * r1 + alpha2 * r2\n    \n    # Check positivity\n    _, _, p_star = cons_to_prim(U_star)\n    return U_star[0] <= 0 or p_star <= 0\n\n# --- Task 2: Positivity-Preserving Blended Flux ---\n\ndef get_roe_flux(U_L, U_R):\n    rho_L, u_L, p_L = cons_to_prim(U_L)\n    rho_R, u_R, p_R = cons_to_prim(U_R)\n    \n    if rho_L <= 0 or p_L <=0 or rho_R <= 0 or p_R <= 0:\n        # Fallback for non-physical states, e.g. return average flux\n        return 0.5 * (get_flux(U_L) + get_flux(U_R))\n\n    sqrt_rho_L, sqrt_rho_R = np.sqrt(rho_L), np.sqrt(rho_R)\n    tilde_u = (sqrt_rho_L * u_L + sqrt_rho_R * u_R) / (sqrt_rho_L + sqrt_rho_R)\n\n    H_L, _ = get_h_and_c(rho_L, u_L, p_L)\n    H_R, _ = get_h_and_c(rho_R, u_R, p_R)\n    tilde_H = (sqrt_rho_L * H_L + sqrt_rho_R * H_R) / (sqrt_rho_L + sqrt_rho_R)\n\n    a_sq = GAMMA_MINUS_1 * (tilde_H - 0.5 * tilde_u**2)\n    if a_sq < 0: a_sq = 0 # Einfeldt fix\n    tilde_a = np.sqrt(a_sq)\n\n    r1 = np.array([1.0, tilde_u - tilde_a, tilde_H - tilde_u * tilde_a])\n    r2 = np.array([1.0, tilde_u, 0.5 * tilde_u**2])\n    r3 = np.array([1.0, tilde_u + tilde_a, tilde_H + tilde_u * tilde_a])\n    R_matrix = np.vstack([r1, r2, r3]).T\n\n    delta_U = U_R - U_L\n    try:\n        alphas = np.linalg.solve(R_matrix, delta_U)\n    except np.linalg.LinAlgError: # Fallback\n        return 0.5 * (get_flux(U_L) + get_flux(U_R))\n\n    lambda_tilde = np.array([tilde_u - tilde_a, tilde_u, tilde_u + tilde_a])\n    \n    F_L, F_R = get_flux(U_L), get_flux(U_R)\n    dissipation = R_matrix @ (np.diag(np.abs(lambda_tilde)) @ alphas)\n    \n    return 0.5 * (F_L + F_R) - 0.5 * dissipation\n\ndef get_hlle_flux(U_L, U_R):\n    rho_L, u_L, p_L = cons_to_prim(U_L)\n    rho_R, u_R, p_R = cons_to_prim(U_R)\n    \n    if rho_L <= 0 or p_L <=0: return get_flux(U_R)\n    if rho_R <= 0 or p_R <=0: return get_flux(U_L)\n    \n    H_L, c_L = get_h_and_c(rho_L, u_L, p_L)\n    H_R, c_R = get_h_and_c(rho_R, u_R, p_R)\n    \n    sqrt_rho_L, sqrt_rho_R = np.sqrt(rho_L), np.sqrt(rho_R)\n    tilde_u = (sqrt_rho_L * u_L + sqrt_rho_R * u_R) / (sqrt_rho_L + sqrt_rho_R)\n    tilde_H = (sqrt_rho_L * H_L + sqrt_rho_R * H_R) / (sqrt_rho_L + sqrt_rho_R)\n    a_sq = GAMMA_MINUS_1 * (tilde_H - 0.5 * tilde_u**2)\n    if a_sq < 0: a_sq = 0\n    tilde_a = np.sqrt(a_sq)\n    \n    S_L = min(u_L - c_L, tilde_u - tilde_a, u_R - c_R)\n    S_R = max(u_L + c_L, tilde_u + tilde_a, u_R + c_R)\n\n    F_L, F_R = get_flux(U_L), get_flux(U_R)\n\n    if S_L >= 0: return F_L\n    if S_R <= 0: return F_R\n    \n    return (S_R * F_L - S_L * F_R + S_L * S_R * (U_R - U_L)) / (S_R - S_L)\n\ndef get_positivity_theta(U, factor, U_base, dU):\n    \"\"\"Calculates max theta in [0,1] for one test state.\"\"\"\n    rho_base, m_base, E_base = U_base\n    drho, dm, dE = dU\n    \n    theta_rho = 1.0\n    if drho < -1e-15: # Avoid division by zero\n        theta_rho = -rho_base / drho\n        if theta_rho < 0: theta_rho = 1.0 # Negative root is not a constraint\n    \n    # Quadratic for pressure: A*theta^2 + B*theta + C > 0\n    C = 2 * E_base * rho_base - m_base**2\n    if C < 0: return 0.0 # Base state is already non-positive\n    \n    A = 2 * dE * drho - dm**2\n    B = 2 * (E_base * drho + rho_base * dE) - 2 * m_base * dm\n    \n    theta_p = 1.0\n    \n    if abs(A) < 1e-15: # Linear case\n        if B < -1e-15:\n            root = -C / B\n            if root > 0:\n                theta_p = root\n    else: # Quadratic case\n        delta = B**2 - 4 * A * C\n        if delta >= 0:\n            sqrt_delta = np.sqrt(delta)\n            r1 = (-B + sqrt_delta) / (2 * A)\n            r2 = (-B - sqrt_delta) / (2 * A)\n            \n            # Find smallest positive root\n            pos_roots = []\n            if r1 > 1e-15: pos_roots.append(r1)\n            if r2 > 1e-15: pos_roots.append(r2)\n            \n            if len(pos_roots) > 0:\n                root = min(pos_roots)\n                if A > 0: # Parabola opens up, positive outside roots\n                    if min(r1, r2) > 0:\n                        theta_p = min(r1, r2)\n                else: # Parabola opens down, positive between roots\n                    theta_p = root\n\n    return min(theta_rho, theta_p, 1.0) * 0.9999 # Safety factor\n\ndef run_blended_flux_update(prim_L, prim_R):\n    \"\"\"Runs one step on 3 periodic cells and checks positivity.\"\"\"\n    # Setup\n    dx = 1.0\n    cfl = 0.45\n    \n    U_states_n = [\n        prim_to_cons(*prim_L),\n        prim_to_cons(*prim_R),\n        prim_to_cons(*prim_L)\n    ]\n    \n    # Calculate dt\n    max_wave_speed = 0.0\n    for U in U_states_n:\n        rho, u, p = cons_to_prim(U)\n        _, c = get_h_and_c(rho, u, p)\n        max_wave_speed = max(max_wave_speed, abs(u) + c)\n    dt = cfl * dx / max_wave_speed\n    lam = dt / dx\n\n    # Interfaces states: L_cell, R_cell\n    interfaces = [(U_states_n[2], U_states_n[0]), (U_states_n[0], U_states_n[1]), (U_states_n[1], U_states_n[2])]\n\n    # Compute blending factors\n    thetas = []\n    for U_L, U_R in interfaces:\n        F_roe = get_roe_flux(U_L, U_R)\n        F_hlle = get_hlle_flux(U_L, U_R)\n        F_R_minus_H = F_roe - F_hlle\n        \n        # Theta for Left Cell\n        U_base_L = U_L - 2 * lam * (F_hlle - get_flux(U_L))\n        dU_L = -2 * lam * F_R_minus_H\n        theta_L = get_positivity_theta(U_L, -2*lam, U_base_L, dU_L)\n\n        # Theta for Right Cell\n        U_base_R = U_R + 2 * lam * (F_hlle - get_flux(U_R))\n        dU_R = 2 * lam * F_R_minus_H\n        theta_R = get_positivity_theta(U_R, 2*lam, U_base_R, dU_R)\n\n        thetas.append(min(theta_L, theta_R))\n\n    # Compute blended fluxes\n    fluxes = []\n    for i, (U_L, U_R) in enumerate(interfaces):\n        F_roe = get_roe_flux(U_L, U_R)\n        F_hlle = get_hlle_flux(U_L, U_R)\n        fluxes.append(F_hlle + thetas[i] * (F_roe - F_hlle))\n\n    # Update states\n    U_states_n_plus_1 = [\n        U_states_n[0] - lam * (fluxes[1] - fluxes[0]),\n        U_states_n[1] - lam * (fluxes[2] - fluxes[1]),\n        U_states_n[2] - lam * (fluxes[0] - fluxes[2]),\n    ]\n    \n    # Check positivity of all updated states\n    all_positive = True\n    for U in U_states_n_plus_1:\n        rho, _, p = cons_to_prim(U)\n        if rho <= 0 or p <= 0:\n            all_positive = False\n            break\n            \n    return all_positive\n    \ndef solve():\n    \"\"\"Main solver function to run test cases.\"\"\"\n    # (rho_L, u_L, p_L; rho_R, u_R, p_R)\n    test_cases = [\n        ((1.0, -100.0, 1e-6), (1.0, 100.0, 1e-6)),         # Case A\n        ((10.0, -60.0, 1e-4), (0.1, 60.0, 1e-6)),          # Case B\n        ((1.0, 0.0, 1.0), (0.125, 0.0, 0.1)),              # Case C\n        ((1e-3, -20.0, 1e-12), (1e-3, 20.0, 1e-12)),       # Case D\n    ]\n    \n    results = []\n    for case in test_cases:\n        prim_L, prim_R = case\n        \n        # Task 1: Check Roe admissibility\n        roe_bad = check_roe_admissibility(prim_L, prim_R)\n        results.append(str(roe_bad).lower())\n        \n        # Task 2: Run blended flux update and check positivity\n        pos_ok = run_blended_flux_update(prim_L, prim_R)\n        results.append(str(pos_ok).lower())\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3359360"}]}