{"hands_on_practices": [{"introduction": "The Sod shock tube problem is a canonical benchmark in gas dynamics, providing a fundamental test for any numerical scheme designed to solve the Euler equations. This exercise focuses on calculating the \"star region\" pressure, $p^*$, which is the crucial unknown that connects the initial left and right states. By deriving and solving the nonlinear equation for $p^*$, you will directly engage with the physical principles governing shock waves and rarefactions, building a foundational understanding of the complete self-similar wave structure. [@problem_id:3506428]", "problem": "In computational astrophysics it is common to validate hydrodynamics solvers against exact solutions of one-dimensional Riemann problems governed by the compressible Euler equations, which express conservation of mass, momentum, and energy for a polytropic gas with adiabatic index $\\gamma$. Consider the one-dimensional shock tube problem (the Sod initial value problem) for a perfect gas with $\\gamma=1.4$ in nondimensional code units, where the initial left state $(\\rho_L,p_L,v_L)$ and right state $(\\rho_R,p_R,v_R)$ are given by $(\\rho_L,p_L,v_L)=(1,1,0)$ and $(\\rho_R,p_R,v_R)=(0.125,0.1,0)$. The flow evolves self-similarly and is composed of a left-going rarefaction, a contact discontinuity, and a right-going shock. The state between the rarefaction tail and the shock, called the star region, is uniform and characterized by the pressure $p^\\ast$ and velocity $v^\\ast$.\n\nStarting from the conservation laws and the jump or integral relations appropriate to smooth isentropic expansion waves and shocks in a polytropic gas, derive the nonlinear compatibility equation for the star-region pressure $p^\\ast$ and solve it to obtain the numerical value of $p^\\ast$ for the given initial states. Use nondimensional code units (so the pressure is unitless) and round your final answer to $6$ significant figures.", "solution": "### Step 1: Extract Givens\nThe problem statement provides the following information:\n- The governing equations are the $1$-dimensional compressible Euler equations for a polytropic gas.\n- The gas is perfect with an adiabatic index $\\gamma = 1.4$.\n- The initial left state is $(\\rho_L, p_L, v_L) = (1, 1, 0)$ in nondimensional units.\n- The initial right state is $(\\rho_R, p_R, v_R) = (0.125, 0.1, 0)$ in nondimensional units.\n- The flow structure consists of a left-going rarefaction, a contact discontinuity, and a right-going shock.\n- The region between the rarefaction and the shock (the star region) is characterized by a uniform pressure $p^\\ast$ and velocity $v^\\ast$.\n- The final answer for $p^\\ast$ must be rounded to $6$ significant figures.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientifically Grounded:** The problem describes the Sod shock tube, a standard benchmark problem in computational fluid dynamics and astrophysics. It is governed by the Euler equations, which are fundamental principles of fluid dynamics. The setup is scientifically sound.\n- **Well-Posed:** The Sod Riemann problem with these initial conditions is well-known to have a unique, stable, and physically meaningful solution. The quantity to be found, $p^\\ast$, is well-defined.\n- **Objective:** The problem is stated using precise, technical language with no subjective or ambiguous terms.\n- **Completeness and Consistency:** All necessary parameters ($\\gamma$, initial states) are provided. There are no contradictions in the setup. The description of the wave pattern (rarefaction-contact-shock) is consistent with the initial conditions ($p_L > p_R$).\n\n### Step 3: Verdict and Action\nThe problem is valid. A complete solution will be provided.\n\n### Derivation of the Compatibility Equation for $p^\\ast$\n\nThe solution to the Riemann problem is self-similar and depends on the variable $\\xi = x/t$. The initial discontinuity at $x=0$ evolves into a set of waves separating regions of constant state. For the given initial conditions ($p_L > p_R$), the wave pattern consists of a left-propagating rarefaction wave, a central contact discontinuity, and a right-propagating shock wave.\n\nAcross the contact discontinuity, pressure and velocity are continuous. We denote these values in the \"star region\" (the region between the rarefaction tail and the shock front) as $p^\\ast$ and $v^\\ast$. Our goal is to find two expressions for $v^\\ast$ as a function of $p^\\ast$—one by relating the star region to the initial left state, and the other by relating it to the initial right state—and then equate them.\n\n**1. Left-Going Rarefaction Wave (Region L to Star Region)**\n\nA rarefaction wave is a continuous, isentropic expansion. Across the rarefaction fan, the Riemann invariant corresponding to the right-propagating characteristics ($C_+$) is conserved:\n$$v + \\int \\frac{dp}{\\rho c} = \\text{constant}$$\nwhere $c = \\sqrt{\\gamma p / \\rho}$ is the local sound speed. For an isentropic process in a polytropic gas, $p = K\\rho^\\gamma$, where $K$ is a constant. This allows us to write the sound speed as a function of pressure: $c = c_L (p/p_L)^{(\\gamma-1)/(2\\gamma)}$. The integral can be evaluated as:\n$$\\int \\frac{dp}{\\rho c} = \\int \\frac{c}{\\gamma p} dp = \\frac{2c}{\\gamma-1}$$\nThus, the Riemann invariant is $v + \\frac{2c}{\\gamma-1}$. Applying this across the rarefaction wave, from state $(\\rho_L, p_L, v_L)$ to state $(\\rho^\\ast, p^\\ast, v^\\ast)$:\n$$v_L + \\frac{2 c_L}{\\gamma-1} = v^\\ast + \\frac{2 c^\\ast}{\\gamma-1}$$\nwhere $c_L = \\sqrt{\\gamma p_L / \\rho_L}$ and $c^\\ast = \\sqrt{\\gamma p^\\ast / \\rho^\\ast}$. Since the flow is isentropic from state $L$ to the star region, $c^\\ast = c_L (p^\\ast/p_L)^{(\\gamma-1)/(2\\gamma)}$.\nSolving for $v^\\ast$, we get:\n$$v^\\ast = v_L + \\frac{2 c_L}{\\gamma-1} \\left[ 1 - \\left( \\frac{p^\\ast}{p_L} \\right)^{(\\gamma-1)/(2\\gamma)} \\right]$$\nThis equation gives the velocity in the star region as a function of $p^\\ast$ and the initial left state.\n\n**2. Right-Going Shock Wave (Region R to Star Region)**\n\nThe transition from the initial right state $(\\rho_R, p_R, v_R)$ to the star region state $(\\rho^\\ast, p^\\ast, v^\\ast)$ occurs across a shock wave. The relationship across a shock is given by the Rankine-Hugoniot jump conditions. A standard result derived from these conditions relates the change in velocity to the change in pressure:\n$$(v^\\ast - v_R)^2 = (p^\\ast - p_R)^2 \\frac{2/\\rho_R}{(\\gamma+1)p^\\ast + (\\gamma-1)p_R}$$\nFor a right-going shock, we have $p^\\ast > p_R$ and $v^\\ast > v_R$. Taking the positive square root gives:\n$$v^\\ast = v_R + (p^\\ast - p_R) \\sqrt{\\frac{2/\\rho_R}{(\\gamma+1)p^\\ast + (\\gamma-1)p_R}}$$\nThis equation gives the velocity in the star region as a function of $p^\\ast$ and the initial right state.\n\n**3. The Nonlinear Compatibility Equation**\n\nEquating the two expressions for $v^\\ast$ yields a single nonlinear equation for the unknown pressure $p^\\ast$:\n$$v_L + \\frac{2 c_L}{\\gamma-1} \\left[ 1 - \\left( \\frac{p^\\ast}{p_L} \\right)^{(\\gamma-1)/(2\\gamma)} \\right] = v_R + (p^\\ast - p_R) \\sqrt{\\frac{2/\\rho_R}{(\\gamma+1)p^\\ast + (\\gamma-1)p_R}}$$\n\n### Solving for $p^\\ast$\n\nWe now substitute the given numerical values into this equation.\n- $\\gamma = 1.4$\n- $(\\rho_L, p_L, v_L) = (1, 1, 0)$\n- $(\\rho_R, p_R, v_R) = (0.125, 0.1, 0)$\n\nFrom these, we can calculate accessory constants:\n- Sound speed in the left state: $c_L = \\sqrt{\\frac{\\gamma p_L}{\\rho_L}} = \\sqrt{\\frac{1.4 \\times 1}{1}} = \\sqrt{1.4}$.\n- $\\gamma - 1 = 0.4$\n- $\\gamma + 1 = 2.4$\n- The exponent $(\\gamma-1)/(2\\gamma) = 0.4 / (2 \\times 1.4) = 0.4 / 2.8 = 1/7$.\n\nSubstituting these values into the compatibility equation:\n$$0 + \\frac{2 \\sqrt{1.4}}{0.4} \\left[ 1 - \\left( \\frac{p^\\ast}{1} \\right)^{1/7} \\right] = 0 + (p^\\ast - 0.1) \\sqrt{\\frac{2/0.125}{(2.4)p^\\ast + (0.4)(0.1)}}$$\nSimplifying the terms:\n$$5\\sqrt{1.4} \\left( 1 - (p^\\ast)^{1/7} \\right) = (p^\\ast - 0.1) \\sqrt{\\frac{16}{2.4 p^\\ast + 0.04}}$$\nLet $f(p^\\ast)$ be the function whose root we seek:\n$$f(p^\\ast) = 5\\sqrt{1.4} \\left( 1 - (p^\\ast)^{1/7} \\right) - (p^\\ast - 0.1) \\frac{4}{\\sqrt{2.4 p^\\ast + 0.04}} = 0$$\nThis is a transcendental equation that must be solved using a numerical root-finding method, such as the Newton-Raphson method or a bisection method. The solution must lie in the interval $p_R  p^\\ast  p_L$, which is $0.1  p^\\ast  1$.\n\nLet's test a value, for instance $p^\\ast = 0.3$:\n$$5\\sqrt{1.4} \\approx 5.91608$$\n$$(0.3)^{1/7} \\approx 0.84196$$\nLeft-hand side (LHS) term: $5.91608 \\times (1 - 0.84196) \\approx 0.93474$\nRight-hand side (RHS) term: $(0.3 - 0.1) \\frac{4}{\\sqrt{2.4(0.3) + 0.04}} = 0.2 \\frac{4}{\\sqrt{0.76}} \\approx \\frac{0.8}{0.87178} \\approx 0.91766$\nSince LHS $$ RHS, the true value of $p^\\ast$ must be slightly higher than $0.3$.\n\nEmploying a numerical solver (e.g., the Newton-Raphson method) with an initial guess of $p^\\ast_0 = 0.3$, the solution converges rapidly. The unrounded result is approximately:\n$$p^\\ast \\approx 0.303130178$$\nRounding this value to $6$ significant figures, as requested by the problem, we obtain:\n$$p^\\ast = 0.303130$$", "answer": "$$\\boxed{0.303130}$$", "id": "3506428"}, {"introduction": "While the Euler equations describe complex gas dynamics, the core concepts of Riemann solutions and their numerical application can be effectively studied using the simpler scalar Burgers' equation, $u_t + (\\frac{1}{2}u^2)_x = 0$. This practice bridges theory and computation by guiding you to implement the Godunov numerical flux, which uses the exact solution of the local Riemann problem at each cell interface. This exercise is pivotal for understanding how the theoretical wave structure at $x/t=0$ directly translates into a building block for robust, shock-capturing finite volume methods. [@problem_id:3138345]", "problem": "Consider the scalar conservation law $u_t + f(u)_x = 0$ with the convex flux $f(u) = \\tfrac{1}{2}u^2$ on the real line. The characteristic speed is $f'(u) = u$, so the sonic point is $u = 0$. The Godunov finite volume method for such a scalar law uses, at each cell interface, the exact solution of the local Riemann problem with left state $u_L$ and right state $u_R$ to compute a numerical flux. The numerical flux is the physical flux evaluated at the trace of the exact self-similar solution at the interface, that is, at $x/t = 0$. Pathologies near the sonic point arise when the self-similar Riemann fan degenerates, for example when a rarefaction includes the sonic point or a shock moves with zero speed.\n\nStarting from the fundamental base that defines the exact Riemann solution for a scalar conservation law with convex flux:\n- If $u_L \\le u_R$, the exact solution is a centered rarefaction, which is composed of characteristics with speeds $f'(u)$. The state observed at $x/t = 0$ is determined by whether $0$ lies below, inside, or above the fan of characteristic speeds.\n- If $u_L > u_R$, the exact solution contains a shock satisfying the Rankine–Hugoniot condition with shock speed $s = \\dfrac{f(u_L) - f(u_R)}{u_L - u_R}$, and the admissibility condition that selects the entropy-satisfying solution. The state observed at $x/t = 0$ equals the left state if $s > 0$, equals the right state if $s  0$, and is stationary if $s = 0$.\n\nYour task is to implement a complete program that, for a specified test suite of Riemann initial data pairs $(u_L, u_R)$, computes the Godunov numerical flux at the interface using the exact Riemann solution at $x/t = 0$. You must specifically handle sonic degeneracy cases where $f'(u) = 0$ is within the rarefaction fan or where the shock speed $s$ is zero.\n\nImplement the program to produce, for each test case, a single real number equal to the Godunov flux $G(u_L, u_R)$ for $f(u) = \\tfrac{1}{2}u^2$, rounded to exactly six decimal places. The program should aggregate all results into a single line containing a comma-separated list enclosed in square brackets.\n\nUse the following test suite of left–right states:\n- Case $1$: $u_L = -1.0$, $u_R = 1.0$.\n- Case $2$: $u_L = 0.2$, $u_R = 1.5$.\n- Case $3$: $u_L = -1.5$, $u_R = -0.2$.\n- Case $4$: $u_L = 1.0$, $u_R = 0.2$.\n- Case $5$: $u_L = -0.2$, $u_R = -1.0$.\n- Case $6$: $u_L = 0.5$, $u_R = -0.5$.\n- Case $7$: $u_L = 0.0$, $u_R = 0.5$.\n- Case $8$: $u_L = -0.5$, $u_R = 0.0$.\n- Case $9$: $u_L = 0.0$, $u_R = 0.0$.\n- Case $10$: $u_L = -10^{-12}$, $u_R = 10^{-12}$.\n\nDesign for coverage:\n- Cases $1$, $7$, $8$, and $10$ probe sonic rarefaction degeneracy where the fan includes $u = 0$.\n- Cases $2$ and $3$ probe rarefaction waves entirely on one side of the sonic point.\n- Cases $4$ and $5$ probe shocks with positive and negative speeds.\n- Case $6$ probes a stationary shock with speed $s = 0$.\n- Case $9$ probes the trivial equilibrium state at the sonic point.\n\nFinal output format:\n- The program must print exactly one line containing a single list of the computed fluxes, rounded to six decimal places, as a comma-separated list enclosed in square brackets. For example, a valid output line has the form $[a_1,a_2,\\dots,a_{10}]$ with each $a_k$ shown to six decimals.", "solution": "The problem is valid. It is scientifically grounded in the theory of hyperbolic conservation laws, specifically the Riemann problem for the inviscid Burgers' equation. The problem is well-posed, providing a complete and consistent set of rules to determine a unique Godunov numerical flux for any given pair of left and right states. The language is objective and the task is computationally feasible.\n\nThe problem requires the computation of the Godunov numerical flux, $G(u_L, u_R)$, for the scalar conservation law $u_t + f(u)_x = 0$ with the convex flux function $f(u) = \\frac{1}{2}u^2$. The Godunov flux is defined as the physical flux evaluated at the state $u(x/t=0)$ which arises from the exact solution to the Riemann problem with initial data $(u_L, u_R)$.\n\nThe state at the interface, $u_{God} = u(x/t=0)$, is determined by analyzing the self-similar solution of the Riemann problem. The characteristic speed for this flux function is $f'(u) = u$. The sonic point, where the characteristic speed is zero, is at $u=0$. We must analyze two primary cases based on the initial states $u_L$ and $u_R$.\n\n**Case 1: Rarefaction Wave ($u_L \\le u_R$)**\n\nWhen $u_L \\le u_R$, the exact solution is a centered rarefaction wave. The solution within the wave is continuous and consists of characteristics originating from the origin with speeds in the range $[f'(u_L), f'(u_R)] = [u_L, u_R]$. The state observed at the interface line $x/t = 0$ corresponds to the value of $u$ for which the characteristic speed is zero, i.e., $f'(u) = u = 0$, provided this speed is part of the rarefaction fan.\n\n*   If $u_L \\le 0 \\le u_R$, the fan of characteristic speeds $[u_L, u_R]$ includes $0$. The state at the interface is the sonic state, $u_{God} = 0$. The flux is $G(u_L, u_R) = f(0) = \\frac{1}{2}(0)^2 = 0$. This handles sonic degeneracy where the rarefaction fan straddles the sonic point.\n\n*   If $0  u_L \\le u_R$, the entire fan of characteristic speeds is positive. The rarefaction wave moves to the right. The region at and to the left of the wave (including $x/t=0$) retains the left state. Thus, $u_{God} = u_L$. The flux is $G(u_L, u_R) = f(u_L) = \\frac{1}{2}u_L^2$.\n\n*   If $u_L \\le u_R  0$, the entire fan of characteristic speeds is negative. The rarefaction wave moves to the left. The region at and to the right of the wave (including $x/t=0$) is occupied by the right state. Thus, $u_{God} = u_R$. The flux is $G(u_L, u_R) = f(u_R) = \\frac{1}{2}u_R^2$.\n\n**Case 2: Shock Wave ($u_L > u_R$)**\n\nWhen $u_L > u_R$, the solution is a discontinuous shock wave. The shock's speed, $s$, is given by the Rankine-Hugoniot condition:\n$$s = \\frac{f(u_L) - f(u_R)}{u_L - u_R}$$\nFor the flux $f(u) = \\frac{1}{2}u^2$, this simplifies to:\n$$s = \\frac{\\frac{1}{2}u_L^2 - \\frac{1}{2}u_R^2}{u_L - u_R} = \\frac{\\frac{1}{2}(u_L - u_R)(u_L + u_R)}{u_L - u_R} = \\frac{u_L + u_R}{2}$$\nThe state at the interface $x/t=0$ depends on the direction of the shock's movement, which is determined by the sign of $s$.\n\n*   If $s > 0$, the shock moves to the right. The state at the interface is the state to the left of the shock, which is $u_L$. Thus, $u_{God} = u_L$. The flux is $G(u_L, u_R) = f(u_L) = \\frac{1}{2}u_L^2$.\n\n*   If $s  0$, the shock moves to the left. The state at the interface is the state to the right of the shock, which is $u_R$. Thus, $u_{God} = u_R$. The flux is $G(u_L, u_R) = f(u_R) = \\frac{1}{2}u_R^2$.\n\n*   If $s = 0$, the shock is stationary. This occurs when $u_L + u_R = 0$, i.e., $u_R = -u_L$. The states $u_L$ and $u_R$ persist for $x0$ and $x>0$ respectively. The flux must be continuous across a stationary shock, which is indeed the case: $f(u_L) = \\frac{1}{2}u_L^2 = \\frac{1}{2}(-u_R)^2 = f(u_R)$. The Godunov flux is this constant value, $G(u_L, u_R) = f(u_L) = f(u_R)$. We can unify this with the $s>0$ case by adopting the convention that if $s \\ge 0$, we use the left state $u_L$ to compute the flux.\n\nApplying this logic to the provided test cases:\n*   **Case 1:** ($u_L = -1.0, u_R = 1.0$) $\\implies u_L \\le 0 \\le u_R$, rarefaction. $u_{God} = 0$. Flux $G = f(0) = 0$.\n*   **Case 4:** ($u_L = 1.0, u_R = 0.2$) $\\implies u_L > u_R$, shock. $s = (1.0 + 0.2)/2 = 0.6 > 0$. $u_{God} = u_L = 1.0$. Flux $G = f(1.0) = 0.5$.\n*   **Case 6:** ($u_L = 0.5, u_R = -0.5$) $\\implies u_L > u_R$, shock. $s = (0.5 - 0.5)/2 = 0$. Stationary shock. $u_{God} = u_L = 0.5$. Flux $G = f(0.5) = 0.125$.\n\nThe implementation will follow this case-by-case analysis for each pair $(u_L, u_R)$ in the test suite.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the Godunov flux for a series of Riemann problems\n    for the inviscid Burgers' equation.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (-1.0, 1.0),       # Case 1\n        (0.2, 1.5),        # Case 2\n        (-1.5, -0.2),      # Case 3\n        (1.0, 0.2),        # Case 4\n        (-0.2, -1.0),      # Case 5\n        (0.5, -0.5),       # Case 6\n        (0.0, 0.5),        # Case 7\n        (-0.5, 0.0),       # Case 8\n        (0.0, 0.0),        # Case 9\n        (-1e-12, 1e-12),   # Case 10\n    ]\n\n    results = []\n    for u_L, u_R in test_cases:\n        flux = compute_godunov_flux(u_L, u_R)\n        # Format to exactly six decimal places as required.\n        results.append(f\"{flux:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\ndef flux_function(u: float) - float:\n    \"\"\"\n    Computes the physical flux f(u) = 0.5 * u^2.\n    \"\"\"\n    return 0.5 * u**2\n\ndef compute_godunov_flux(u_L: float, u_R: float) - float:\n    \"\"\"\n    Calculates the Godunov numerical flux G(u_L, u_R) for the convex\n    flux f(u) = 0.5 * u^2.\n\n    The logic is based on the exact solution to the Riemann problem at x/t = 0.\n    The characteristic speed is f'(u) = u. The sonic point is u = 0.\n\n    Args:\n        u_L: The left state of the Riemann problem.\n        u_R: The right state of the Riemann problem.\n\n    Returns:\n        The Godunov numerical flux.\n    \"\"\"\n    u_god = 0.0\n\n    # Case 1: Rarefaction wave (u_L = u_R)\n    if u_L = u_R:\n        # If the fan of characteristics [u_L, u_R] includes the sonic point speed 0,\n        # the state at the interface is the sonic state.\n        if u_L = 0.0 and u_R = 0.0:\n            u_god = 0.0\n        # If the fan is entirely to the right (positive speeds), the wave moves right.\n        # The state at x/t=0 is the left state.\n        elif u_L  0.0:\n            u_god = u_L\n        # If the fan is entirely to the left (negative speeds), the wave moves left.\n        # The state at x/t=0 is the right state.\n        else:  # This implies u_R  0\n            u_god = u_R\n\n    # Case 2: Shock wave (u_L  u_R)\n    else:\n        # Shock speed s = (f(u_L) - f(u_R)) / (u_L - u_R) = 0.5 * (u_L + u_R)\n        s = 0.5 * (u_L + u_R)\n        \n        # If shock is stationary (s=0) or moves right (s0),\n        # the state at x/t=0 is the left state.\n        if s = 0.0:\n            u_god = u_L\n        # If shock moves left (s0), the state at x/t=0 is the right state.\n        else:\n            u_god = u_R\n            \n    return flux_function(u_god)\n\nsolve()\n```", "id": "3138345"}, {"introduction": "In practice, exact Riemann solvers can be computationally expensive, leading to the development of efficient approximate solvers like the Roe scheme. However, these linearized solvers can produce non-physical solutions, such as expansion shocks in transonic flow. This advanced practice tackles this critical issue by implementing an entropy fix, which selectively adds numerical dissipation to ensure the solution adheres to physical laws. By calibrating the entropy fix to maintain accuracy, you will gain insight into the sophisticated engineering required to build robust and reliable numerical methods for hyperbolic systems. [@problem_id:3380629]", "problem": "Implement a complete program that constructs, analyzes, and calibrates a finite-difference Roe scheme with an entropy fix for the scalar, inviscid Burgers conservation law. The goal is to remove non-physical expansion shocks in transonic rarefactions while preserving accuracy on weak shocks through systematic calibration of the added dissipation. Begin from core definitions and well-tested facts about hyperbolic conservation laws, the Riemann problem, and conservative discretizations.\n\nConsider the scalar hyperbolic conservation law\n$$\nu_t + f(u)_x = 0,\n$$\nwith Burgers flux\n$$\nf(u) = \\tfrac{1}{2}u^2.\n$$\nUse a uniform grid on the domain $[-1,1]$ with $N$ cells of width $\\Delta x = 2/N$ and cell centers $x_i = -1 + \\left(i + \\tfrac{1}{2}\\right)\\Delta x$ for $i=0,1,\\dots,N-1$. Let the initial condition be a Riemann problem\n$$\nu(x,0) = \n\\begin{cases}\nu_L,  x  0,\\\\\nu_R,  x \\ge 0,\n\\end{cases}\n$$\nwith transmissive (zero-gradient) boundary conditions. Evolve to a final time $T>0$ using explicit forward Euler time stepping constrained by the Courant–Friedrichs–Lewy (CFL) condition: at each time step, choose\n$$\n\\Delta t = \\nu \\frac{\\Delta x}{\\max_i |u_i| + \\varepsilon_{\\text{safe}}},\n$$\nwhere $\\nu \\in (0,1)$ is the Courant–Friedrichs–Lewy number and $\\varepsilon_{\\text{safe}}$ is a tiny positive number to avoid division by zero.\n\nUse a conservative, semi-discrete finite-difference method based on a numerical flux at cell interfaces:\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right).\n$$\nImplement the Roe flux with an entropy fix. For the scalar case, the Roe linearization speed is\n$$\n\\tilde{\\lambda}(u_L,u_R) = \\frac{f(u_R)-f(u_L)}{u_R-u_L} = \\tfrac{1}{2}(u_L+u_R),\n$$\nfor $u_L \\neq u_R$ (and any consistent value when $u_L = u_R$). The Roe numerical flux is\n$$\nF_{\\text{Roe}}(u_L,u_R) = \\tfrac{1}{2}\\left(f(u_L)+f(u_R)\\right) - \\tfrac{1}{2}\\,|\\tilde{\\lambda}|\\, (u_R-u_L).\n$$\nTo enforce the entropy condition and remove the non-physical expansion shock in transonic rarefactions ($u_L  0  u_R$), replace $|\\tilde{\\lambda}|$ by a smoothed dissipation function that increases the dissipation near sonic points. Use the Harten entropy fix form:\n$$\n\\phi(\\tilde{\\lambda};\\delta) = \n\\begin{cases}\n|\\tilde{\\lambda}|,  |\\tilde{\\lambda}| \\ge \\delta,\\\\\n\\tfrac{1}{2}\\left(\\frac{\\tilde{\\lambda}^2}{\\delta} + \\delta\\right),  |\\tilde{\\lambda}|  \\delta,\n\\end{cases}\n$$\nwith a local threshold\n$$\n\\delta = \\epsilon \\,\\max\\left(|u_L|,|u_R|,|\\tilde{\\lambda}|\\right) + \\varepsilon_{\\min},\n$$\nwhere $\\epsilon > 0$ is a dimensionless calibration parameter and $\\varepsilon_{\\min}$ is a tiny positive number. The entropy-fixed Roe flux is then\n$$\nF_{\\text{Roe+EF}}(u_L,u_R;\\epsilon) = \\tfrac{1}{2}\\left(f(u_L)+f(u_R)\\right) - \\tfrac{1}{2}\\,\\phi(\\tilde{\\lambda};\\delta)\\,(u_R-u_L).\n$$\n\nCompute the exact self-similar solution of the Burgers Riemann problem at time $t>0$ to quantify numerical error:\n- If $u_L  u_R$ (rarefaction), then\n$$\nu(x,t) = \n\\begin{cases}\nu_L,  \\xi \\le u_L,\\\\\n\\xi,  u_L  \\xi  u_R,\\\\\nu_R,  \\xi \\ge u_R,\n\\end{cases}\n\\qquad \\text{with } \\xi = \\frac{x}{t}.\n$$\n- If $u_L > u_R$ (shock), then the shock speed is $s = \\frac{f(u_L)-f(u_R)}{u_L-u_R} = \\tfrac{1}{2}(u_L+u_R)$ and\n$$\nu(x,t) = \n\\begin{cases}\nu_L,  x  s t,\\\\\nu_R,  x \\ge s t.\n\\end{cases}\n$$\n\nDefine the discrete $L^1$ error at time $T$ by\n$$\nE_1 = \\sum_{i=0}^{N-1} |u_i(T) - u_{\\text{exact}}(x_i,T)|\\,\\Delta x.\n$$\n\nCalibration task. Select $\\epsilon$ from the candidate set\n$$\n\\mathcal{E} = \\{0.02, 0.05, 0.10, 0.20\\}\n$$\nby minimizing the discrete $L^1$ error $E_1$ on a weak shock test case. Break ties by choosing the smallest $\\epsilon$ that attains the minimum error.\n\nTest suite. Use the following three Riemann problems with a common grid and time step selection:\n- Case A (transonic rarefaction): $u_L = -1.0$, $u_R = 1.0$, $T = 0.20$, $N = 400$, $\\nu = 0.45$.\n- Case B (weak shock, for calibration): $u_L = 1.05$, $u_R = 1.00$, $T = 0.20$, $N = 400$, $\\nu = 0.45$.\n- Case C (moderate shock): $u_L = 1.00$, $u_R = 0.00$, $T = 0.20$, $N = 400$, $\\nu = 0.45$.\n\nProgram requirements:\n- Implement the entropy-fixed Roe scheme as described, using explicit forward Euler time stepping and transmissive boundary conditions.\n- Calibrate $\\epsilon$ by minimizing $E_1$ on Case B over $\\mathcal{E}$.\n- With the calibrated $\\epsilon$, compute the discrete $L^1$ errors on Cases A, B, and C.\n- Final output format: Your program should produce a single line of output containing a list of four decimal numbers in the format\n$$\n[\\epsilon_{\\text{opt}}, E_1^{\\text{A}}, E_1^{\\text{B}}, E_1^{\\text{C}}],\n$$\nwhere $\\epsilon_{\\text{opt}} \\in \\mathcal{E}$ is the selected calibration value, and $E_1^{\\text{A}}$, $E_1^{\\text{B}}$, $E_1^{\\text{C}}$ are the corresponding $L^1$ errors for Cases A, B, and C. No units are involved, and no angles are used. Express all numbers as decimal floating-point values. The output must be exactly one line containing the list, with values separated by commas and enclosed in square brackets.", "solution": "The user-provided problem is assessed to be **valid**. It is a well-posed, scientifically grounded problem in the field of numerical analysis for partial differential equations. The problem is self-contained, with all necessary data, equations, and conditions clearly specified. The task is to implement a standard numerical method (Roe scheme with Harten entropy fix) for a classic model equation (inviscid Burgers' equation) and perform a calibration and error analysis. The requirements are formal, objective, and internally consistent.\n\nThe solution is implemented by following these steps, which directly correspond to the problem's specifications.\n\n### 1. Problem Formulation and Governing Equations\n\nThe problem addresses the numerical solution of the scalar, nonlinear hyperbolic conservation law given by:\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial f(u)}{\\partial x} = 0\n$$\nwhere $u(x,t)$ is the conserved quantity and $f(u)$ is the flux function. For the inviscid Burgers' equation, the flux is:\n$$\nf(u) = \\frac{1}{2}u^2\n$$\nThe problem is posed on a spatial domain $x \\in [-1, 1]$ with an initial condition defined by a Riemann problem:\n$$\nu(x,0) = \n\\begin{cases}\nu_L,  x  0 \\\\\nu_R,  x \\ge 0\n\\end{cases}\n$$\n\n### 2. Numerical Discretization\n\nA uniform grid with $N$ cells is used. The width of each cell is $\\Delta x = 2/N$, and the cell centers are located at $x_i = -1 + (i + 1/2)\\Delta x$ for $i=0, 1, \\dots, N-1$.\n\nA semi-discrete, conservative finite-difference method is employed. The time evolution of the solution in cell $i$ is governed by:\n$$\n\\frac{du_i}{dt} = - \\frac{1}{\\Delta x}\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right)\n$$\nwhere $u_i(t)$ is the cell-averaged value of the solution in cell $i$, and $F_{i\\pm1/2}$ are the numerical fluxes at the cell interfaces.\n\nFor time integration, the explicit forward Euler method is used:\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+\\frac{1}{2}} - F_{i-\\frac{1}{2}}\\right)\n$$\nwhere $u_i^n$ is the solution at time $t_n$. The time step $\\Delta t$ is dynamically chosen to satisfy the Courant–Friedrichs–Lewy (CFL) stability condition:\n$$\n\\Delta t = \\nu \\frac{\\Delta x}{\\max_i |u_i^n| + \\varepsilon_{\\text{safe}}}\n$$\nHere, $\\nu \\in (0,1)$ is the CFL number, and $\\varepsilon_{\\text{safe}}$ is a small positive constant to prevent division by zero.\n\nTransmissive (zero-gradient) boundary conditions are applied at $x = \\pm 1$. This is implemented by setting the solution in ghost cells equal to the value in the adjacent interior cell, e.g., $u_{-1} = u_0$ and $u_N = u_{N-1}$.\n\n### 3. Entropy-Fixed Roe Flux\n\nThe core of the spatial discretization is the numerical flux, for which the Roe scheme with a Harten-style entropy fix is specified.\n\nThe standard Roe flux for a scalar problem is:\n$$\nF_{\\text{Roe}}(u_L, u_R) = \\frac{1}{2}\\left(f(u_L) + f(u_R)\\right) - \\frac{1}{2}|\\tilde{\\lambda}(u_L, u_R)|(u_R - u_L)\n$$\nwhere $u_L$ and $u_R$ are the states to the left and right of an interface, respectively. The Roe-linearized speed $\\tilde{\\lambda}$ for the Burgers' equation is the arithmetic mean of the characteristic speeds $u_L$ and $u_R$:\n$$\n\\tilde{\\lambda}(u_L, u_R) = \\frac{f(u_R) - f(u_L)}{u_R - u_L} = \\frac{\\frac{1}{2}u_R^2 - \\frac{1}{2}u_L^2}{u_R - u_L} = \\frac{1}{2}(u_L + u_R)\n$$\nThe standard Roe flux can incorrectly admit non-physical expansion shocks where the solution should be a smooth rarefaction wave (i.e., when $u_L  0  u_R$). To remedy this, an entropy fix is introduced by modifying the dissipation term $|\\tilde{\\lambda}|$. The absolute value function is replaced by a smoothed function $\\phi(\\tilde{\\lambda}; \\delta)$:\n$$\n\\phi(\\tilde{\\lambda};\\delta) = \n\\begin{cases}\n|\\tilde{\\lambda}|,  \\text{if } |\\tilde{\\lambda}| \\ge \\delta \\\\\n\\frac{1}{2}\\left(\\frac{\\tilde{\\lambda}^2}{\\delta} + \\delta\\right),  \\text{if } |\\tilde{\\lambda}|  \\delta\n\\end{cases}\n$$\nThis modification increases the numerical dissipation near \"sonic points\" where $\\tilde{\\lambda} \\approx 0$. The threshold $\\delta$ is set locally for each interface:\n$$\n\\delta = \\epsilon \\,\\max\\left(|u_L|,|u_R|,|\\tilde{\\lambda}|\\right) + \\varepsilon_{\\min}\n$$\nwhere $\\epsilon$ is a tunable parameter and $\\varepsilon_{\\min}$ is a small positive constant. The final entropy-fixed Roe flux is:\n$$\nF_{\\text{Roe+EF}}(u_L, u_R) = \\frac{1}{2}\\left(f(u_L) + f(u_R)\\right) - \\frac{1}{2}\\phi(\\tilde{\\lambda};\\delta)(u_R - u_L)\n$$\n\n### 4. Calibration and Error Analysis\n\nThe parameter $\\epsilon$ controls the amount of added dissipation. It must be calibrated. The problem specifies a calibration procedure based on minimizing the discrete $L^1$ error on a weak shock test case (Case B). The $L^1$ error is defined as:\n$$\nE_1 = \\sum_{i=0}^{N-1} |u_i(T) - u_{\\text{exact}}(x_i, T)| \\Delta x\n$$\nwhere $u_{\\text{exact}}$ is the analytical solution to the Riemann problem. The candidate set for $\\epsilon$ is $\\mathcal{E} = \\{0.02, 0.05, 0.10, 0.20\\}$. The value $\\epsilon_{\\text{opt}} \\in \\mathcal{E}$ is chosen that yields the minimum $E_1$ for Case B, with ties broken by selecting the smallest $\\epsilon$.\n\nThe exact self-similar solution $u_{\\text{exact}}(x,t)$ depends on the initial states:\n- **Rarefaction ($u_L  u_R$)**: The solution depends on $\\xi = x/t$.\n$$\nu(x,t) = \n\\begin{cases}\nu_L,  \\xi \\le u_L \\\\\n\\xi,  u_L  \\xi  u_R \\\\\nu_R,  \\xi \\ge u_R\n\\end{cases}\n$$\n- **Shock ($u_L > u_R$)**: The solution is a travelling step-wave with shock speed $s = \\frac{1}{2}(u_L+u_R)$.\n$$\nu(x,t) = \n\\begin{cases}\nu_L,  x  s t \\\\\nu_R,  x \\ge s t\n\\end{cases}\n$$\n\n### 5. Implementation Plan\n\nThe overall algorithm is as follows:\n1.  Define the parameters for the three test cases (A, B, C) and the set of candidate $\\epsilon$ values.\n2.  **Calibration**: Iterate through each $\\epsilon \\in \\mathcal{E}$. For each `eps`, run a simulation for Case B until the final time $T$. Compute the $L^1$ error against the exact solution.\n3.  Select $\\epsilon_{\\text{opt}}$ as the value that minimized the error in the previous step, respecting the tie-breaking rule.\n4.  **Evaluation**: With the determined $\\epsilon_{\\text{opt}}$, run simulations for all three cases (A, B, and C).\n5.  Compute and store the $L^1$ error for each case.\n6.  Format the final output as a list containing $\\epsilon_{\\text{opt}}$ and the three calculated errors for cases A, B, and C.\n\nThe implementation uses `numpy` for efficient vectorized operations, particularly in the flux calculation across all cell interfaces.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# Execution Environment:\n# language: Python\n# version: 3.12\n# libraries:\n#     - name: numpy, version: 1.23.5\n#     - name: scipy, version: 1.11.4\n\ndef roe_flux_vectorized(u_l, u_r, epsilon):\n    \"\"\"\n    Computes the entropy-fixed Roe flux for the Burgers' equation in a \n    vectorized manner.\n    \"\"\"\n    epsilon_min = 1e-12\n\n    # Burgers flux f(u) = 0.5 * u^2\n    f_l = 0.5 * u_l**2\n    f_r = 0.5 * u_r**2\n    \n    # Roe average speed\n    lambda_tilde = 0.5 * (u_l + u_r)\n    \n    # Harten entropy fix threshold (delta)\n    max_val = np.maximum(np.abs(u_l), np.abs(u_r))\n    max_val = np.maximum(max_val, np.abs(lambda_tilde))\n    delta = epsilon * max_val + epsilon_min\n\n    # Modified dissipation term (phi)\n    abs_lambda = np.abs(lambda_tilde)\n    phi = np.where(abs_lambda = delta, \n                   abs_lambda, \n                   0.5 * (lambda_tilde**2 / delta + delta))\n\n    # Final entropy-fixed Roe flux\n    return 0.5 * (f_l + f_r) - 0.5 * phi * (u_r - u_l)\n\ndef run_simulation(u_L, u_R, T, N, nu, epsilon):\n    \"\"\"\n    Runs a simulation of the Burgers' equation for a given Riemann problem.\n    \"\"\"\n    dx = 2.0 / N\n    x = -1.0 + (np.arange(N) + 0.5) * dx\n    \n    # Initial condition\n    u = np.where(x  0, u_L, u_R)\n    \n    t = 0.0\n    epsilon_safe = 1e-12\n    \n    while t  T:\n        # CFL-based time step\n        max_speed = np.max(np.abs(u))\n        dt = nu * dx / (max_speed + epsilon_safe)\n        \n        # Ensure we don't step over the final time T\n        if t + dt  T:\n            dt = T - t\n            \n        # Padded array for transmissive (zero-gradient) boundary conditions\n        u_padded = np.empty(N + 2)\n        u_padded[0] = u[0]\n        u_padded[N+1] = u[N-1]\n        u_padded[1:-1] = u\n        \n        # Left and right states at interfaces\n        u_ls = u_padded[:-1]\n        u_rs = u_padded[1:]\n        \n        # Calculate fluxes at N+1 interfaces\n        fluxes = roe_flux_vectorized(u_ls, u_rs, epsilon)\n        \n        # Update solution using forward Euler\n        u = u - (dt / dx) * (fluxes[1:] - fluxes[:-1])\n        \n        t += dt\n        \n    return u, x, dx\n\ndef exact_solution(x, t, u_l, u_r):\n    \"\"\"\n    Computes the exact solution of the Burgers' Riemann problem.\n    \"\"\"\n    if u_l  u_r:  # Rarefaction\n        if t == 0:\n            return np.where(x  0, u_l, u_r)\n        xi = x / t\n        sol = np.full_like(x, xi)\n        sol = np.where(xi = u_l, u_l, sol)\n        sol = np.where(xi = u_r, u_r, sol)\n        return sol\n    else:  # Shock\n        s = 0.5 * (u_l + u_r)\n        return np.where(x  s * t, u_l, u_r)\n\ndef solve():\n    \"\"\"\n    Main function to perform calibration and evaluation.\n    \"\"\"\n    test_cases = {\n        'A': {'uL': -1.0, 'uR': 1.0, 'T': 0.20, 'N': 400, 'nu': 0.45},\n        'B': {'uL': 1.05, 'uR': 1.00, 'T': 0.20, 'N': 400, 'nu': 0.45},\n        'C': {'uL': 1.00, 'uR': 0.00, 'T': 0.20, 'N': 400, 'nu': 0.45},\n    }\n    \n    epsilon_candidates = [0.02, 0.05, 0.10, 0.20]\n\n    # --- Calibration Phase ---\n    # Calibrate epsilon using Case B (weak shock)\n    errors_B_calib = []\n    calib_params = test_cases['B']\n    for eps in epsilon_candidates:\n        u_num, x_grid, dx = run_simulation(\n            calib_params['uL'], calib_params['uR'], calib_params['T'],\n            calib_params['N'], calib_params['nu'], eps\n        )\n        u_exact_val = exact_solution(\n            x_grid, calib_params['T'], calib_params['uL'], calib_params['uR']\n        )\n        error = np.sum(np.abs(u_num - u_exact_val)) * dx\n        errors_B_calib.append(error)\n        \n    # Find optimal epsilon: minimizing L1 error on Case B.\n    # .index() finds the first occurrence, breaking ties by choosing smallest epsilon.\n    min_error = min(errors_B_calib)\n    chosen_index = errors_B_calib.index(min_error)\n    epsilon_opt = epsilon_candidates[chosen_index]\n    \n    # --- Evaluation Phase ---\n    # Compute L1 errors for all cases using the optimal epsilon\n    final_errors = {}\n    for case_name, params in test_cases.items():\n        u_num, x_grid, dx = run_simulation(\n            params['uL'], params['uR'], params['T'],\n            params['N'], params['nu'], epsilon_opt\n        )\n        u_exact_val = exact_solution(\n            x_grid, params['T'], params['uL'], params['uR']\n        )\n        error = np.sum(np.abs(u_num - u_exact_val)) * dx\n        final_errors[case_name] = error\n\n    # Prepare and print final output\n    results = [\n        epsilon_opt, package to create the documentation for this article. The final output is formatted as a JSON object, with the `docs` key containing a list of objects, each representing a single documentation page.\n        final_errors['A'], \n        final_errors['B'], \n        final_errors['C']\n    ]\n    \n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3380629"}]}