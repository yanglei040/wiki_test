{"hands_on_practices": [{"introduction": "The cornerstone of the Finite Volume Method is the transformation of a volume integral of a divergence into a sum of fluxes over the control volume's surface, as dictated by the divergence theorem. This first exercise provides a direct, hands-on application of this principle. By calculating the discrete divergence on a simple tetrahedral cell and comparing it to the exact analytical value, you will gain a concrete understanding of how this theorem is applied in practice and how numerical approximations, such as face quadrature rules, introduce discretization error [@problem_id:3291622].", "problem": "Consider a single control volume in the Finite Volume Method (FVM) in Computational Fluid Dynamics (CFD): the tetrahedron $K$ with vertices $\\mathbf{v}_0=(0,0,0)$, $\\mathbf{v}_1=(1,0,0)$, $\\mathbf{v}_2=(0,2,0)$, and $\\mathbf{v}_3=(0,0,3)$. Let the vector field be $\\mathbf{F}(\\mathbf{x})=[x^2,xy,y^2]^{\\top}$. Define the discrete divergence at cell $P$ by applying the divergence theorem over $K$ and approximating each face flux with a one-point centroid rule on each triangular face (degree-$1$ exactness): for each face $f$ with centroid $\\mathbf{x}_f^{c}$ and outward area vector $\\mathbf{a}_f=\\int_{f}\\mathbf{n}\\,\\mathrm{d}S$, approximate $\\int_{f}\\mathbf{F}\\cdot\\mathbf{n}\\,\\mathrm{d}S$ by $\\mathbf{F}(\\mathbf{x}_f^{c})\\cdot \\mathbf{a}_f$, and set\n$$\n(\\nabla_h\\cdot \\mathbf{F})_P \\equiv \\frac{1}{|K|}\\sum_{f\\subset \\partial K} \\mathbf{F}(\\mathbf{x}_f^{c})\\cdot \\mathbf{a}_f.\n$$\nCompute $(\\nabla_h\\cdot \\mathbf{F})_P$ exactly for the tetrahedron $K$ described above. Then, independently compute the exact cell-average divergence $\\langle \\nabla\\cdot \\mathbf{F} \\rangle_K$ and compare, explaining any discrepancy. Express your final numerical result for $(\\nabla_h\\cdot \\mathbf{F})_P$ exactly as a rational number (no rounding). No units are required.", "solution": "We begin from the divergence theorem, which states for a sufficiently smooth vector field $\\mathbf{F}$ and a control volume $K$ with boundary $\\partial K$ and outward unit normal $\\mathbf{n}$,\n$$\n\\int_{K} \\nabla\\cdot \\mathbf{F}\\,\\mathrm{d}V \\;=\\; \\int_{\\partial K} \\mathbf{F}\\cdot \\mathbf{n}\\,\\mathrm{d}S.\n$$\nIn the Finite Volume Method (FVM), a discrete divergence at the cell $P$ associated with the control volume $K$ is obtained by approximating the boundary fluxes. With the one-point centroid quadrature on each triangular face $f$, we approximate\n$$\n\\int_{f} \\mathbf{F}\\cdot \\mathbf{n}\\,\\mathrm{d}S \\;\\approx\\; \\mathbf{F}(\\mathbf{x}_f^{c})\\cdot \\mathbf{a}_f,\n$$\nwhere $\\mathbf{a}_f=\\int_{f}\\mathbf{n}\\,\\mathrm{d}S=\\mathbf{n}_f A_f$ is the outward area vector of face $f$ (constant for a planar face), and $\\mathbf{x}_f^{c}$ is the face centroid. Therefore,\n$$\n(\\nabla_h\\cdot \\mathbf{F})_P \\;=\\; \\frac{1}{|K|}\\sum_{f\\subset \\partial K} \\mathbf{F}(\\mathbf{x}_f^{c})\\cdot \\mathbf{a}_f.\n$$\n\nStep $1$: Geometry of the tetrahedron $K$.\nLet the vertices be $\\mathbf{v}_0=(0,0,0)$, $\\mathbf{v}_1=(1,0,0)$, $\\mathbf{v}_2=(0,2,0)$, and $\\mathbf{v}_3=(0,0,3)$. The volume is\n$$\n|K| \\;=\\; \\frac{1}{6}\\,\\det\\big[\\mathbf{v}_1-\\mathbf{v}_0,\\;\\mathbf{v}_2-\\mathbf{v}_0,\\;\\mathbf{v}_3-\\mathbf{v}_0\\big]\n\\;=\\; \\frac{1}{6}\\,\\det\\begin{bmatrix}1&0&0\\\\ 0&2&0\\\\ 0&0&3\\end{bmatrix}\n\\;=\\; \\frac{1}{6}\\cdot 6 \\;=\\; 1.\n$$\n\nStep $2$: Enumerate faces, centroids, and outward area vectors.\nWe take the four triangular faces opposite each vertex:\n- Face $f_0$ opposite $\\mathbf{v}_0$: triangle $(\\mathbf{v}_1,\\mathbf{v}_2,\\mathbf{v}_3)$.\n- Face $f_1$ opposite $\\mathbf{v}_1$: triangle $(\\mathbf{v}_0,\\mathbf{v}_2,\\mathbf{v}_3)$.\n- Face $f_2$ opposite $\\mathbf{v}_2$: triangle $(\\mathbf{v}_0,\\mathbf{v}_3,\\mathbf{v}_1)$.\n- Face $f_3$ opposite $\\mathbf{v}_3$: triangle $(\\mathbf{v}_0,\\mathbf{v}_1,\\mathbf{v}_2)$.\n\nFor a face with vertices $(\\mathbf{a},\\mathbf{b},\\mathbf{c})$, an area vector is\n$$\n\\mathbf{a}_{\\text{raw}} \\;=\\; \\frac{1}{2}\\,(\\mathbf{b}-\\mathbf{a})\\times(\\mathbf{c}-\\mathbf{a}),\n$$\nwhose orientation is corrected to outward by ensuring $\\mathbf{a}_f\\cdot(\\mathbf{v}_{\\text{opp}}-\\mathbf{x}_f^{c})<0$, where $\\mathbf{v}_{\\text{opp}}$ is the opposite vertex and $\\mathbf{x}_f^{c}=(\\mathbf{a}+\\mathbf{b}+\\mathbf{c})/3$ is the face centroid.\n\nCompute face centroids:\n- $f_0$: $\\mathbf{x}_{f_0}^{c}=\\big(\\frac{1}{3},\\frac{2}{3},1\\big)$.\n- $f_1$: $\\mathbf{x}_{f_1}^{c}=\\big(0,\\frac{2}{3},1\\big)$.\n- $f_2$: $\\mathbf{x}_{f_2}^{c}=\\big(\\frac{1}{3},0,1\\big)$.\n- $f_3$: $\\mathbf{x}_{f_3}^{c}=\\big(\\frac{1}{3},\\frac{2}{3},0\\big)$.\n\nCompute area vectors:\n\nFor $f_0$ with $(\\mathbf{v}_1,\\mathbf{v}_2,\\mathbf{v}_3)$:\n$$\n(\\mathbf{v}_2-\\mathbf{v}_1) = (-1,2,0),\\quad (\\mathbf{v}_3-\\mathbf{v}_1)=(-1,0,3),\n$$\n$$\n(\\mathbf{v}_2-\\mathbf{v}_1)\\times(\\mathbf{v}_3-\\mathbf{v}_1) = (6,3,2),\\quad \\mathbf{a}_{f_0,\\text{raw}}=\\frac{1}{2}(6,3,2)=(3,\\tfrac{3}{2},1).\n$$\nWith $\\mathbf{v}_{\\text{opp}}=\\mathbf{v}_0$ and $\\mathbf{x}_{f_0}^{c}=(\\tfrac{1}{3},\\tfrac{2}{3},1)$,\n$$\n\\mathbf{a}_{f_0,\\text{raw}}\\cdot(\\mathbf{v}_0-\\mathbf{x}_{f_0}^{c})=(3,\\tfrac{3}{2},1)\\cdot(-\\tfrac{1}{3},-\\tfrac{2}{3},-1)=-3<0,\n$$\nso $\\mathbf{a}_{f_0}=(3,\\tfrac{3}{2},1)$ is already outward.\n\nFor $f_1$ with $(\\mathbf{v}_0,\\mathbf{v}_2,\\mathbf{v}_3)$:\n$$\n(\\mathbf{v}_2-\\mathbf{v}_0)=(0,2,0),\\quad (\\mathbf{v}_3-\\mathbf{v}_0)=(0,0,3),\n$$\n$$\n(\\mathbf{v}_2-\\mathbf{v}_0)\\times(\\mathbf{v}_3-\\mathbf{v}_0)=(6,0,0),\\quad \\mathbf{a}_{f_1,\\text{raw}}=(3,0,0).\n$$\nWith $\\mathbf{v}_{\\text{opp}}=\\mathbf{v}_1$ and $\\mathbf{x}_{f_1}^{c}=(0,\\tfrac{2}{3},1)$,\n$$\n\\mathbf{a}_{f_1,\\text{raw}}\\cdot(\\mathbf{v}_1-\\mathbf{x}_{f_1}^{c})=(3,0,0)\\cdot(1,-\\tfrac{2}{3},-1)=3>0,\n$$\nso $\\mathbf{a}_{f_1}=-(3,0,0)=(-3,0,0)$ is outward.\n\nFor $f_2$ with $(\\mathbf{v}_0,\\mathbf{v}_3,\\mathbf{v}_1)$:\n$$\n(\\mathbf{v}_3-\\mathbf{v}_0)=(0,0,3),\\quad (\\mathbf{v}_1-\\mathbf{v}_0)=(1,0,0),\n$$\n$$\n(\\mathbf{v}_3-\\mathbf{v}_0)\\times(\\mathbf{v}_1-\\mathbf{v}_0)=(0,3,0),\\quad \\mathbf{a}_{f_2,\\text{raw}}=(0,\\tfrac{3}{2},0).\n$$\nWith $\\mathbf{v}_{\\text{opp}}=\\mathbf{v}_2$ and $\\mathbf{x}_{f_2}^{c}=(\\tfrac{1}{3},0,1)$,\n$$\n\\mathbf{a}_{f_2,\\text{raw}}\\cdot(\\mathbf{v}_2-\\mathbf{x}_{f_2}^{c})=(0,\\tfrac{3}{2},0)\\cdot(-\\tfrac{1}{3},2,-1)=3>0,\n$$\nso $\\mathbf{a}_{f_2}=(0,-\\tfrac{3}{2},0)$ is outward.\n\nFor $f_3$ with $(\\mathbf{v}_0,\\mathbf{v}_1,\\mathbf{v}_2)$:\n$$\n(\\mathbf{v}_1-\\mathbf{v}_0)=(1,0,0),\\quad (\\mathbf{v}_2-\\mathbf{v}_0)=(0,2,0),\n$$\n$$\n(\\mathbf{v}_1-\\mathbf{v}_0)\\times(\\mathbf{v}_2-\\mathbf{v}_0)=(0,0,2),\\quad \\mathbf{a}_{f_3,\\text{raw}}=(0,0,1).\n$$\nWith $\\mathbf{v}_{\\text{opp}}=\\mathbf{v}_3$ and $\\mathbf{x}_{f_3}^{c}=(\\tfrac{1}{3},\\tfrac{2}{3},0)$,\n$$\n\\mathbf{a}_{f_3,\\text{raw}}\\cdot(\\mathbf{v}_3-\\mathbf{x}_{f_3}^{c})=(0,0,1)\\cdot(-\\tfrac{1}{3},-\\tfrac{2}{3},3)=3>0,\n$$\nso $\\mathbf{a}_{f_3}=(0,0,-1)$ is outward.\n\nStep $3$: Evaluate $\\mathbf{F}$ at face centroids and approximate fluxes.\nThe vector field is $\\mathbf{F}=[x^2,xy,y^2]^{\\top}$. Evaluate at centroids:\n\n- On $f_0$, $\\mathbf{x}_{f_0}^{c}=(\\tfrac{1}{3},\\tfrac{2}{3},1)$:\n$$\n\\mathbf{F}(\\mathbf{x}_{f_0}^{c})=\\Big[\\big(\\tfrac{1}{3}\\big)^2,\\;\\tfrac{1}{3}\\cdot \\tfrac{2}{3},\\;\\big(\\tfrac{2}{3}\\big)^2\\Big]=\\Big[\\tfrac{1}{9},\\tfrac{2}{9},\\tfrac{4}{9}\\Big].\n$$\nFlux approximation:\n$$\n\\mathbf{F}(\\mathbf{x}_{f_0}^{c})\\cdot \\mathbf{a}_{f_0}=\\Big(\\tfrac{1}{9},\\tfrac{2}{9},\\tfrac{4}{9}\\Big)\\cdot \\Big(3,\\tfrac{3}{2},1\\Big)=\\tfrac{3}{9}+\\tfrac{3}{9}+\\tfrac{4}{9}=\\tfrac{10}{9}.\n$$\n\n- On $f_1$, $\\mathbf{x}_{f_1}^{c}=(0,\\tfrac{2}{3},1)$:\n$$\n\\mathbf{F}(\\mathbf{x}_{f_1}^{c})=\\big[0,\\;0,\\;\\tfrac{4}{9}\\big],\n$$\nso\n$$\n\\mathbf{F}(\\mathbf{x}_{f_1}^{c})\\cdot \\mathbf{a}_{f_1}=\\big(0,0,\\tfrac{4}{9}\\big)\\cdot(-3,0,0)=0.\n$$\n\n- On $f_2$, $\\mathbf{x}_{f_2}^{c}=(\\tfrac{1}{3},0,1)$:\n$$\n\\mathbf{F}(\\mathbf{x}_{f_2}^{c})=\\big[\\tfrac{1}{9},\\;0,\\;0\\big],\n$$\nso\n$$\n\\mathbf{F}(\\mathbf{x}_{f_2}^{c})\\cdot \\mathbf{a}_{f_2}=\\big(\\tfrac{1}{9},0,0\\big)\\cdot(0,-\\tfrac{3}{2},0)=0.\n$$\n\n- On $f_3$, $\\mathbf{x}_{f_3}^{c}=(\\tfrac{1}{3},\\tfrac{2}{3},0)$:\n$$\n\\mathbf{F}(\\mathbf{x}_{f_3}^{c})=\\Big[\\tfrac{1}{9},\\tfrac{2}{9},\\tfrac{4}{9}\\Big],\n$$\nso\n$$\n\\mathbf{F}(\\mathbf{x}_{f_3}^{c})\\cdot \\mathbf{a}_{f_3}=\\Big(\\tfrac{1}{9},\\tfrac{2}{9},\\tfrac{4}{9}\\Big)\\cdot(0,0,-1)=-\\tfrac{4}{9}.\n$$\n\nSumming the approximate face fluxes:\n$$\n\\sum_{f}\\mathbf{F}(\\mathbf{x}_{f}^{c})\\cdot \\mathbf{a}_{f}=\\tfrac{10}{9}+0+0-\\tfrac{4}{9}=\\tfrac{6}{9}=\\tfrac{2}{3}.\n$$\nSince $|K|=1$, we obtain\n$$\n(\\nabla_h\\cdot \\mathbf{F})_P=\\frac{1}{|K|}\\sum_{f}\\mathbf{F}(\\mathbf{x}_{f}^{c})\\cdot \\mathbf{a}_{f}=\\tfrac{2}{3}.\n$$\n\nStep $4$: Exact cell-average divergence and comparison.\nCompute the analytical divergence:\n$$\n\\nabla\\cdot \\mathbf{F}=\\frac{\\partial}{\\partial x}(x^2)+\\frac{\\partial}{\\partial y}(xy)+\\frac{\\partial}{\\partial z}(y^2)=2x+x+0=3x.\n$$\nThe exact cell-average is\n$$\n\\langle \\nabla\\cdot \\mathbf{F} \\rangle_K \\;=\\; \\frac{1}{|K|}\\int_{K} 3x\\,\\mathrm{d}V \\;=\\; 3\\,\\bar{x}_K,\n$$\nwhere $\\bar{x}_K$ is the volume-average of $x$ over $K$. For a tetrahedron, the volume-average of a linear function equals its value at the centroid, and the centroid is the average of the vertices. Thus\n$$\n\\bar{x}_K=\\frac{x_0+x_1+x_2+x_3}{4}=\\frac{0+1+0+0}{4}=\\frac{1}{4},\n$$\nso\n$$\n\\langle \\nabla\\cdot \\mathbf{F} \\rangle_K=3\\cdot \\frac{1}{4}=\\frac{3}{4}.\n$$\nTherefore, the signed discrepancy using degree-$1$ face quadrature is\n$$\n(\\nabla_h\\cdot \\mathbf{F})_P-\\langle \\nabla\\cdot \\mathbf{F} \\rangle_K=\\frac{2}{3}-\\frac{3}{4}=-\\frac{1}{12}.\n$$\nThe nonzero error arises because the integrand $\\mathbf{F}\\cdot \\mathbf{n}$ restricted to each planar triangular face is a quadratic polynomial, and the one-point centroid rule integrates exactly only up to degree $1$ on triangles. A degree-$2$ exact triangle quadrature would integrate each face flux exactly, yielding equality between the discrete and exact average divergences for this $\\mathbf{F}$ and $K$.", "answer": "$$\\boxed{\\tfrac{2}{3}}$$", "id": "3291622"}, {"introduction": "While theoretical examples often use simple, orthogonal grids, practical CFD applications almost always involve non-orthogonal meshes where cell face normals are not aligned with the vector connecting adjacent cell centers. This geometric complexity requires special treatment to maintain accuracy, particularly for diffusive terms. This practice will guide you through the calculation of a diffusive residual on a skewed cell using a non-orthogonal correction, a standard technique to ensure the fidelity of the simulation on realistic grids [@problem_id:3291658].", "problem": "In a two-dimensional finite volume setting for computational fluid dynamics, consider a single skewed quadrilateral control volume with vertices listed in counterclockwise order at $(0,0)$, $(2,0)$, $(3,1)$, and $(0,1)$. Let the control-volume center $\\boldsymbol{x}_{P}$ be the polygon centroid. Let each face center $\\boldsymbol{x}_{f}$ be the midpoint of its two endpoints. Define the outward face area vector $\\boldsymbol{S}_{f}$ on each face as the vector of length equal to the face length and perpendicular to the face, oriented outward from the control volume. Concretely, for an oriented edge from $(x_{i},y_{i})$ to $(x_{i+1},y_{i+1})$, take the edge vector $\\boldsymbol{t}_{i}=(x_{i+1}-x_{i},\\,y_{i+1}-y_{i})$ and set $\\boldsymbol{S}_{f}=(y_{i+1}-y_{i},\\, -(x_{i+1}-x_{i}))$. For each face, define the neighboring cell center across the face by mirroring the primary center across the face center as $\\boldsymbol{x}_{N} = 2\\,\\boldsymbol{x}_{f} - \\boldsymbol{x}_{P}$, and define $\\boldsymbol{d} = \\boldsymbol{x}_{N} - \\boldsymbol{x}_{P}$ and $\\boldsymbol{e}_{d} = \\boldsymbol{d}/|\\boldsymbol{d}|$.\n\nAssume constant diffusivity $\\Gamma = 1$ (dimensionless) and the scalar field $\\phi(x,y) = x^{2} + y^{2}$ (dimensionless). Using the Finite Volume Method (FVM) with an orthogonal correction term for the face-normal gradient, approximate the diffusive residual in the control volume as the sum over faces of the diffusive flux contributions\n$$\nR_{\\mathrm{disc}} \\approx \\sum_{f} \\Gamma \\left[ \\left(\\boldsymbol{S}_{f} \\cdot \\boldsymbol{e}_{d}\\right) \\frac{\\phi_{N} - \\phi_{P}}{|\\boldsymbol{d}|} \\;+\\; \\left(\\boldsymbol{S}_{f} - \\left(\\boldsymbol{S}_{f} \\cdot \\boldsymbol{e}_{d}\\right)\\boldsymbol{e}_{d}\\right) \\cdot \\left(\\nabla \\phi\\right)_{f}^{\\mathrm{avg}} \\right],\n$$\nwhere $\\phi_{P}=\\phi(\\boldsymbol{x}_{P})$, $\\phi_{N}=\\phi(\\boldsymbol{x}_{N})$, and $\\left(\\nabla \\phi\\right)_{f}^{\\mathrm{avg}}$ is the arithmetic average of the exact cell-centered gradients evaluated at $\\boldsymbol{x}_{P}$ and $\\boldsymbol{x}_{N}$. For comparison, the exact diffusive divergence integrated over the control volume is\n$$\nR_{\\mathrm{exact}} \\;=\\; \\int_{V} \\nabla \\cdot \\left( \\Gamma \\nabla \\phi \\right) \\, \\mathrm{d}V.\n$$\n\nTreat all quantities as dimensionless. Compute the numerical value of $R_{\\mathrm{disc}}$. Your final answer must be a single real number. No rounding is required.", "solution": "The problem requires the computation of the discretized diffusive residual, $R_{\\mathrm{disc}}$, for a given quadrilateral control volume and scalar field. The formula for the residual is given as a sum over the faces of the control volume:\n$$\nR_{\\mathrm{disc}} = \\sum_{f} \\Gamma \\left[ \\left(\\boldsymbol{S}_{f} \\cdot \\boldsymbol{e}_{d}\\right) \\frac{\\phi_{N} - \\phi_{P}}{|\\boldsymbol{d}|} \\;+\\; \\left(\\boldsymbol{S}_{f} - \\left(\\boldsymbol{S}_{f} \\cdot \\boldsymbol{e}_{d}\\right)\\boldsymbol{e}_{d}\\right) \\cdot \\left(\\nabla \\phi\\right)_{f}^{\\mathrm{avg}} \\right]\n$$\nGiven that $\\boldsymbol{e}_d = \\boldsymbol{d}/|\\boldsymbol{d}|$, this expression can be rewritten to avoid explicit calculation of unit vectors and their associated square roots, which simplifies the arithmetic:\n$$\nR_{\\mathrm{disc}} = \\sum_{f} \\Gamma \\left[ \\frac{\\phi_{N} - \\phi_{P}}{|\\boldsymbol{d}|^2} (\\boldsymbol{S}_{f} \\cdot \\boldsymbol{d}) \\;+\\; \\left(\\boldsymbol{S}_{f} - \\frac{\\boldsymbol{S}_{f} \\cdot \\boldsymbol{d}}{|\\boldsymbol{d}|^2}\\boldsymbol{d}\\right) \\cdot \\left(\\nabla \\phi\\right)_{f}^{\\mathrm{avg}} \\right]\n$$\nWe are given the constant diffusivity $\\Gamma = 1$. The scalar field is $\\phi(x,y) = x^2 + y^2$, for which the gradient is $\\nabla\\phi(x,y) = (2x, 2y)$.\n\nFirst, we determine the control volume center $\\boldsymbol{x}_P$, which is the centroid of the quadrilateral with vertices $V_1(0,0)$, $V_2(2,0)$, $V_3(3,1)$, and $V_4(0,1)$. We can find the centroid by decomposing the quadrilateral into two triangles, $T_1 = (V_1, V_2, V_3)$ and $T_2 = (V_1, V_3, V_4)$, finding their individual centroids and areas, and then computing the weighted average.\n\nThe area of a triangle with vertices $(x_1, y_1)$, $(x_2, y_2)$, and $(x_3, y_3)$ is $A = \\frac{1}{2}|x_1(y_2-y_3) + x_2(y_3-y_1) + x_3(y_1-y_2)|$. The centroid is $C = \\frac{1}{3}((x_1,y_1)+(x_2,y_2)+(x_3,y_3))$.\n\nFor triangle $T_1((0,0), (2,0), (3,1))$:\nArea $A_1 = \\frac{1}{2}|0(0-1) + 2(1-0) + 3(0-0)| = 1$.\nCentroid $C_1 = \\frac{1}{3}((0,0)+(2,0)+(3,1)) = (\\frac{5}{3}, \\frac{1}{3})$.\n\nFor triangle $T_2((0,0), (3,1), (0,1))$:\nArea $A_2 = \\frac{1}{2}|0(1-1) + 3(1-0) + 0(0-1)| = \\frac{3}{2}$.\nCentroid $C_2 = \\frac{1}{3}((0,0)+(3,1)+(0,1)) = (1, \\frac{2}{3})$.\n\nThe total area is $A = A_1+A_2 = 1+\\frac{3}{2} = \\frac{5}{2}$. The control volume center is:\n$\\boldsymbol{x}_P = \\frac{A_1 C_1 + A_2 C_2}{A} = \\frac{1(\\frac{5}{3}, \\frac{1}{3}) + \\frac{3}{2}(1, \\frac{2}{3})}{\\frac{5}{2}} = \\frac{(\\frac{5}{3}+\\frac{3}{2}, \\frac{1}{3}+1)}{\\frac{5}{2}} = \\frac{(\\frac{19}{6}, \\frac{4}{3})}{\\frac{5}{2}} = (\\frac{19}{15}, \\frac{8}{15})$.\n\nNext, we evaluate $\\phi$ and $\\nabla\\phi$ at $\\boldsymbol{x}_P$:\n$\\phi_P = \\phi(\\boldsymbol{x}_P) = (\\frac{19}{15})^2 + (\\frac{8}{15})^2 = \\frac{361+64}{225} = \\frac{425}{225} = \\frac{17}{9}$.\n$\\nabla\\phi(\\boldsymbol{x}_P) = (2 \\cdot \\frac{19}{15}, 2 \\cdot \\frac{8}{15}) = (\\frac{38}{15}, \\frac{16}{15})$.\n\nNow, we compute the contribution from each of the four faces.\n\nFace 1: from $V_1(0,0)$ to $V_2(2,0)$.\n$\\boldsymbol{x}_{f1} = \\frac{1}{2}((0,0)+(2,0)) = (1,0)$.\n$\\boldsymbol{S}_{f1} = (0-0, -(2-0)) = (0, -2)$.\n$\\boldsymbol{x}_{N1} = 2\\boldsymbol{x}_{f1} - \\boldsymbol{x}_P = 2(1,0) - (\\frac{19}{15},\\frac{8}{15}) = (\\frac{11}{15}, -\\frac{8}{15})$.\n$\\phi_{N1} = (\\frac{11}{15})^2 + (-\\frac{8}{15})^2 = \\frac{121+64}{225} = \\frac{185}{225} = \\frac{37}{45}$.\n$\\nabla\\phi(\\boldsymbol{x}_{N1}) = (2 \\cdot \\frac{11}{15}, 2 \\cdot (-\\frac{8}{15})) = (\\frac{22}{15}, -\\frac{16}{15})$.\n$\\boldsymbol{d}_1 = \\boldsymbol{x}_{N1} - \\boldsymbol{x}_P = (\\frac{11}{15}-\\frac{19}{15}, -\\frac{8}{15}-\\frac{8}{15}) = (-\\frac{8}{15}, -\\frac{16}{15})$.\n$|\\boldsymbol{d}_1|^2 = (-\\frac{8}{15})^2 + (-\\frac{16}{15})^2 = \\frac{64+256}{225} = \\frac{320}{225} = \\frac{64}{45}$.\n$\\phi_{N1}-\\phi_P = \\frac{37}{45} - \\frac{17}{9} = \\frac{37-85}{45} = -\\frac{48}{45} = -\\frac{16}{15}$.\n$\\boldsymbol{S}_{f1} \\cdot \\boldsymbol{d}_1 = (0,-2)\\cdot(-\\frac{8}{15}, -\\frac{16}{15}) = \\frac{32}{15}$.\nOrthogonal term: $\\frac{\\phi_{N1}-\\phi_P}{|\\boldsymbol{d}_1|^2}(\\boldsymbol{S}_{f1} \\cdot \\boldsymbol{d}_1) = \\frac{-16/15}{64/45}(\\frac{32}{15}) = -\\frac{16}{15}\\frac{45}{64}\\frac{32}{15} = -\\frac{1 \\cdot 3 \\cdot 1}{1 \\cdot 4 \\cdot 1} \\frac{32}{15} = -\\frac{3}{4}\\frac{32}{15} = - \\frac{8}{5}$.\n$(\\nabla \\phi)_{f1}^{\\mathrm{avg}} = \\frac{1}{2}((\\frac{38}{15},\\frac{16}{15})+(\\frac{22}{15},-\\frac{16}{15})) = \\frac{1}{2}(\\frac{60}{15}, 0) = (2,0)$.\nNon-orthogonal vector proj: $\\frac{\\boldsymbol{S}_{f1}\\cdot\\boldsymbol{d}_1}{|\\boldsymbol{d}_1|^2}\\boldsymbol{d}_1 = \\frac{32/15}{64/45}(-\\frac{8}{15}, -\\frac{16}{15}) = \\frac{3}{2}(-\\frac{8}{15}, -\\frac{16}{15}) = (-\\frac{4}{5}, -\\frac{8}{5})$.\nNon-orthogonal vector: $\\boldsymbol{S}_f - (\\dots) = (0,-2) - (-\\frac{4}{5}, -\\frac{8}{5}) = (\\frac{4}{5}, -\\frac{2}{5})$.\nNon-orthogonal term: $(\\frac{4}{5}, -\\frac{2}{5}) \\cdot (2,0) = \\frac{8}{5}$.\nFlux contribution from Face 1: $-\\frac{8}{5} + \\frac{8}{5} = 0$.\n\nFace 2: from $V_2(2,0)$ to $V_3(3,1)$.\n$\\boldsymbol{x}_{f2} = \\frac{1}{2}((2,0)+(3,1)) = (\\frac{5}{2},\\frac{1}{2})$.\n$\\boldsymbol{S}_{f2} = (1-0, -(3-2)) = (1, -1)$.\n$\\boldsymbol{x}_{N2} = 2(\\frac{5}{2},\\frac{1}{2}) - (\\frac{19}{15},\\frac{8}{15}) = (5,1) - (\\frac{19}{15},\\frac{8}{15}) = (\\frac{56}{15}, \\frac{7}{15})$.\n$\\phi_{N2} = (\\frac{56}{15})^2+(\\frac{7}{15})^2 = \\frac{3136+49}{225} = \\frac{3185}{225} = \\frac{637}{45}$.\n$\\nabla\\phi(\\boldsymbol{x}_{N2}) = (\\frac{112}{15}, \\frac{14}{15})$.\n$\\boldsymbol{d}_2 = (\\frac{56-19}{15}, \\frac{7-8}{15}) = (\\frac{37}{15}, -\\frac{1}{15})$.\n$|\\boldsymbol{d}_2|^2 = (\\frac{37}{15})^2+(-\\frac{1}{15})^2 = \\frac{1369+1}{225} = \\frac{1370}{225} = \\frac{274}{45}$.\n$\\phi_{N2}-\\phi_P = \\frac{637}{45} - \\frac{17}{9} = \\frac{637-85}{45} = \\frac{552}{45} = \\frac{184}{15}$.\n$\\boldsymbol{S}_{f2} \\cdot \\boldsymbol{d}_2 = (1,-1)\\cdot(\\frac{37}{15}, -\\frac{1}{15}) = \\frac{38}{15}$.\nOrthogonal term: $\\frac{184/15}{274/45}(\\frac{38}{15}) = \\frac{184 \\cdot 45 \\cdot 38}{15 \\cdot 274 \\cdot 15} = \\frac{184 \\cdot 3 \\cdot 38}{274 \\cdot 15} = \\frac{3496}{685}$.\n$(\\nabla \\phi)_{f2}^{\\mathrm{avg}} = \\frac{1}{2}((\\frac{38}{15},\\frac{16}{15})+(\\frac{112}{15},\\frac{14}{15})) = \\frac{1}{2}(\\frac{150}{15}, \\frac{30}{15}) = (5,1)$.\nNon-orthogonal vector proj: $\\frac{38/15}{274/45}(\\frac{37}{15}, -\\frac{1}{15}) = \\frac{19 \\cdot 3}{137 \\cdot 15}(37,-1) = \\frac{19}{685}(37,-1) = (\\frac{703}{685}, -\\frac{19}{685})$.\nNon-orthogonal vector: $(1,-1) - (\\frac{703}{685}, -\\frac{19}{685}) = (-\\frac{18}{685}, -\\frac{666}{685})$.\nNon-orthogonal term: $(-\\frac{18}{685}, -\\frac{666}{685}) \\cdot (5,1) = \\frac{-90-666}{685} = -\\frac{756}{685}$.\nFlux contribution from Face 2: $\\frac{3496}{685} - \\frac{756}{685} = \\frac{2740}{685} = 4$.\n\nFace 3: from $V_3(3,1)$ to $V_4(0,1)$.\n$\\boldsymbol{x}_{f3} = \\frac{1}{2}((3,1)+(0,1)) = (\\frac{3}{2},1)$.\n$\\boldsymbol{S}_{f3} = (1-1, -(0-3)) = (0, 3)$.\n$\\boldsymbol{x}_{N3} = 2(\\frac{3}{2},1) - (\\frac{19}{15},\\frac{8}{15}) = (3,2) - (\\frac{19}{15},\\frac{8}{15}) = (\\frac{26}{15}, \\frac{22}{15})$.\n$\\phi_{N3} = (\\frac{26}{15})^2+(\\frac{22}{15})^2 = \\frac{676+484}{225} = \\frac{1160}{225} = \\frac{232}{45}$.\n$\\nabla\\phi(\\boldsymbol{x}_{N3}) = (\\frac{52}{15}, \\frac{44}{15})$.\n$\\boldsymbol{d}_3 = (\\frac{26-19}{15}, \\frac{22-8}{15}) = (\\frac{7}{15}, \\frac{14}{15})$.\n$|\\boldsymbol{d}_3|^2 = (\\frac{7}{15})^2+(\\frac{14}{15})^2 = \\frac{49+196}{225} = \\frac{245}{225} = \\frac{49}{45}$.\n$\\phi_{N3}-\\phi_P = \\frac{232}{45} - \\frac{17}{9} = \\frac{232-85}{45} = \\frac{147}{45} = \\frac{49}{15}$.\n$\\boldsymbol{S}_{f3} \\cdot \\boldsymbol{d}_3 = (0,3)\\cdot(\\frac{7}{15}, \\frac{14}{15}) = \\frac{42}{15} = \\frac{14}{5}$.\nOrthogonal term: $\\frac{49/15}{49/45}(\\frac{14}{5}) = 3 \\cdot \\frac{14}{5} = \\frac{42}{5}$.\n$(\\nabla \\phi)_{f3}^{\\mathrm{avg}} = \\frac{1}{2}((\\frac{38}{15},\\frac{16}{15})+(\\frac{52}{15},\\frac{44}{15})) = \\frac{1}{2}(\\frac{90}{15}, \\frac{60}{15}) = (3,2)$.\nNon-orthogonal vector proj: $\\frac{14/5}{49/45}(\\frac{7}{15}, \\frac{14}{15}) = \\frac{14}{5}\\frac{45}{49}\\frac{1}{15}(7,14) = \\frac{18}{7 \\cdot 15}(7,14) = (\\frac{6}{5}, \\frac{12}{5})$.\nNon-orthogonal vector: $(0,3) - (\\frac{6}{5}, \\frac{12}{5}) = (-\\frac{6}{5}, \\frac{3}{5})$.\nNon-orthogonal term: $(-\\frac{6}{5}, \\frac{3}{5}) \\cdot (3,2) = \\frac{-18+6}{5} = -\\frac{12}{5}$.\nFlux contribution from Face 3: $\\frac{42}{5} - \\frac{12}{5} = \\frac{30}{5} = 6$.\n\nFace 4: from $V_4(0,1)$ to $V_1(0,0)$.\n$\\boldsymbol{x}_{f4} = \\frac{1}{2}((0,1)+(0,0)) = (0, \\frac{1}{2})$.\n$\\boldsymbol{S}_{f4} = (0-1, -(0-0)) = (-1, 0)$.\n$\\boldsymbol{x}_{N4} = 2(0,\\frac{1}{2}) - (\\frac{19}{15},\\frac{8}{15}) = (0,1) - (\\frac{19}{15},\\frac{8}{15}) = (-\\frac{19}{15}, \\frac{7}{15})$.\n$\\phi_{N4} = (-\\frac{19}{15})^2+(\\frac{7}{15})^2 = \\frac{361+49}{225} = \\frac{410}{225} = \\frac{82}{45}$.\n$\\nabla\\phi(\\boldsymbol{x}_{N4}) = (-\\frac{38}{15}, \\frac{14}{15})$.\n$\\boldsymbol{d}_4 = (-\\frac{19-19}{15}, \\frac{7-8}{15}) = (-\\frac{38}{15}, -\\frac{1}{15})$.\n$|\\boldsymbol{d}_4|^2 = (-\\frac{38}{15})^2+(-\\frac{1}{15})^2 = \\frac{1444+1}{225} = \\frac{1445}{225} = \\frac{289}{45}$.\n$\\phi_{N4}-\\phi_P = \\frac{82}{45} - \\frac{17}{9} = \\frac{82-85}{45} = -\\frac{3}{45} = -\\frac{1}{15}$.\n$\\boldsymbol{S}_{f4} \\cdot \\boldsymbol{d}_4 = (-1,0)\\cdot(-\\frac{38}{15}, -\\frac{1}{15}) = \\frac{38}{15}$.\nOrthogonal term: $\\frac{-1/15}{289/45}(\\frac{38}{15}) = -\\frac{1 \\cdot 45 \\cdot 38}{15 \\cdot 289 \\cdot 15} = -\\frac{3 \\cdot 38}{289 \\cdot 15} = -\\frac{38}{1445}$.\n$(\\nabla \\phi)_{f4}^{\\mathrm{avg}} = \\frac{1}{2}((\\frac{38}{15},\\frac{16}{15})+(-\\frac{38}{15},\\frac{14}{15})) = \\frac{1}{2}(0, \\frac{30}{15}) = (0,1)$.\nNon-orthogonal vector proj: $\\frac{38/15}{289/45}(-\\frac{38}{15}, -\\frac{1}{15}) = \\frac{38 \\cdot 3}{289 \\cdot 15}(-38,-1) = \\frac{38}{1445}(-38,-1) = (-\\frac{1444}{1445}, -\\frac{38}{1445})$.\nNon-orthogonal vector: $(-1,0) - (-\\frac{1444}{1445}, -\\frac{38}{1445}) = (-\\frac{1}{1445}, \\frac{38}{1445})$.\nNon-orthogonal term: $(-\\frac{1}{1445}, \\frac{38}{1445}) \\cdot (0,1) = \\frac{38}{1445}$.\nFlux contribution from Face 4: $-\\frac{38}{1445} + \\frac{38}{1445} = 0$.\n\nFinally, we sum the contributions from all four faces:\n$R_{\\mathrm{disc}} = 0 + 4 + 6 + 0 = 10$.\n\nThe exact integral is $R_{\\mathrm{exact}} = \\int_V \\nabla \\cdot (\\Gamma \\nabla \\phi) \\,dV$. For $\\Gamma=1$ and $\\phi=x^2+y^2$, we have $\\nabla\\phi=(2x,2y)$ and $\\nabla\\cdot\\nabla\\phi=4$. Thus, $R_{\\mathrm{exact}} = \\int_V 4 \\,dV = 4 \\times \\text{Area}(V) = 4 \\times \\frac{5}{2} = 10$. The chosen numerical scheme is exact for this quadratic field, confirming the result.", "answer": "$$\\boxed{10}$$", "id": "3291658"}, {"introduction": "Accurately resolving sharp gradients in convection-dominated flows without introducing non-physical oscillations is a central challenge in CFD. This exercise moves into advanced methods for convective fluxes, where you will implement a higher-order linear reconstruction scheme to improve accuracy beyond simple upwinding. You will also apply a flux limiter and analyze its effect on the solution's total variation, demonstrating the crucial role limiters play in developing robust, bounded, and high-resolution schemes [@problem_id:3291633].", "problem": "Consider a steady linear advection of a passive scalar field in the Finite Volume Method (FVM) setting, derived from the conservation law and the divergence theorem. Let the scalar be denoted by $\\phi$, density by $\\rho$, and velocity by $\\mathbf{u}$. The conservation statement for a control volume $V$ with boundary $\\partial V$ is\n$$\n\\frac{\\partial}{\\partial t}\\int_V \\phi\\,\\mathrm{d}V + \\int_{\\partial V} \\phi\\,\\mathbf{u}\\cdot\\mathbf{n}\\,\\mathrm{d}A = 0,\n$$\nwhose surface integral is discretized as a sum over faces using the divergence theorem. On an interior face $f$ shared by two cells, the convective contribution is approximated as\n$$\nF_f = m_f \\phi_f, \\qquad m_f = \\rho\\,\\mathbf{u}\\cdot\\mathbf{S}_f,\n$$\nwhere $\\mathbf{S}_f = A_f \\mathbf{n}_f$ is the face area vector with outward unit normal $\\mathbf{n}_f$ for the upwind cell and magnitude $A_f$, and $\\phi_f$ is a reconstructed face value. The upwind cell is selected by the sign of $m_f$.\n\nYou are asked to implement a complete program that, for a single non-orthogonal interior face between two cells $P$ and $N$, computes:\n- the convective face flux using a linear reconstructed face value without limiting (unlimited reconstruction),\n- the convective face flux using a linear reconstructed face value with a limiter (limited reconstruction),\n- the change in a discrete total variation measure across a three-cell line $U\\text{--}P\\text{--}N$ after one explicit Euler time step induced by the face flux, for both unlimited and limited reconstructions.\n\nAll quantities are dimensionless. Geometry and constants are as follows:\n- Cell centers: $\\mathbf{x}_P = (0,0)$, $\\mathbf{x}_N = (1,0.2)$, $\\mathbf{x}_U = (-1,-0.1)$.\n- Face center: $\\mathbf{x}_f = (0.5,0.2)$.\n- Face area vector: $\\mathbf{S}_f = (0.8,0.6)$.\n- Velocity: $\\mathbf{u} = (1,0)$.\n- Density: $\\rho = 1$.\n- Cell volumes: $V_P = 1$, $V_N = 1$.\n- Time step: $\\Delta t = 0.2$.\n\nNote that the face is non-orthogonal because the vector $\\mathbf{x}_N-\\mathbf{x}_P$ is not colinear with $\\mathbf{S}_f$.\n\nFace value reconstruction:\n1. Determine the upwind cell as $P$ since $m_f = \\rho\\,\\mathbf{u}\\cdot\\mathbf{S}_f > 0$ with the given data.\n2. Compute the least-squares gradient in the upwind cell $P$ using its two neighbors $N$ and $U$ by minimizing\n$$\n\\phi(\\mathbf{x}_j)-\\phi(\\mathbf{x}_P) \\approx \\nabla\\phi|_P\\cdot(\\mathbf{x}_j-\\mathbf{x}_P),\\qquad j\\in\\{N,U\\}.\n$$\nThis yields a $2 \\times 2$ linear system for $\\nabla\\phi|_P$ since there are two neighbors in two spatial dimensions. Denote $\\mathbf{r}_j = \\mathbf{x}_j-\\mathbf{x}_P$ and $\\delta\\phi_j=\\phi(\\mathbf{x}_j)-\\phi(\\mathbf{x}_P)$, solve\n$$\n\\begin{bmatrix}\nr_{N,x} & r_{N,y}\\\\\nr_{U,x} & r_{U,y}\n\\end{bmatrix}\n\\begin{bmatrix}\n\\partial\\phi/\\partial x\\\\\n\\partial\\phi/\\partial y\n\\end{bmatrix}\n=\n\\begin{bmatrix}\n\\delta\\phi_N\\\\\n\\delta\\phi_U\n\\end{bmatrix}.\n$$\n3. Construct the unlimited face value at $\\mathbf{x}_f$ by linear reconstruction from $P$:\n$$\n\\phi_f^{\\text{unlim}} = \\phi_P + \\nabla\\phi|_P\\cdot(\\mathbf{x}_f-\\mathbf{x}_P).\n$$\n4. Apply a Barthâ€“Jespersen-type limiter to ensure local boundedness with respect to the stencil $\\{\\phi_U,\\phi_P,\\phi_N\\}$. Let $\\phi_{\\min}=\\min(\\phi_U,\\phi_P,\\phi_N)$ and $\\phi_{\\max}=\\max(\\phi_U,\\phi_P,\\phi_N)$, and denote $\\Delta_f=\\nabla\\phi|_P\\cdot(\\mathbf{x}_f-\\mathbf{x}_P)$. Define the limiter coefficient\n$$\n\\alpha =\n\\begin{cases}\n\\min\\!\\left(1,\\dfrac{\\phi_{\\max}-\\phi_P}{\\Delta_f}\\right), & \\Delta_f>0,\\\\[1.0ex]\n1, & \\Delta_f=0,\\\\[1.0ex]\n\\min\\!\\left(1,\\dfrac{\\phi_{\\min}-\\phi_P}{\\Delta_f}\\right), & \\Delta_f<0,\n\\end{cases}\n$$\nand set\n$$\n\\phi_f^{\\text{lim}} = \\phi_P + \\alpha\\,\\Delta_f.\n$$\n\nConvective flux and explicit update:\n- Compute $m_f=\\rho\\,\\mathbf{u}\\cdot\\mathbf{S}_f$ and\n$$\nF_f^{\\text{unlim}} = m_f \\phi_f^{\\text{unlim}},\\qquad\nF_f^{\\text{lim}} = m_f \\phi_f^{\\text{lim}}.\n$$\n- Update $\\phi_P$ and $\\phi_N$ using forward Euler in time due only to this interior face flux (other faces have zero flux for this experiment):\n$$\n\\phi_P^{\\text{new}} = \\phi_P - \\frac{\\Delta t}{V_P} F_f,\\qquad\n\\phi_N^{\\text{new}} = \\phi_N + \\frac{\\Delta t}{V_N} F_f,\n$$\nwith $F_f$ taken as either $F_f^{\\text{unlim}}$ or $F_f^{\\text{lim}}$.\n\nDiscrete total variation across the three-cell line $U\\text{--}P\\text{--}N$ is defined as\n$$\nTV(\\phi) = \\left|\\phi_P-\\phi_U\\right| + \\left|\\phi_N-\\phi_P\\right|.\n$$\nFor each reconstruction (unlimited and limited), compute the change $\\Delta TV = TV(\\phi^{\\text{new}})-TV(\\phi)$, where $\\phi_U$ is unchanged by this face flux.\n\nTest suite:\nFor each of the following four cases, use the same geometry and constants above and the listed cell-centered scalar values:\n- Case $1$: $\\phi_U=1.0$, $\\phi_P=2.0$, $\\phi_N=3.0$.\n- Case $2$: $\\phi_U=1.0$, $\\phi_P=1.0$, $\\phi_N=10.0$.\n- Case $3$: $\\phi_U=5.0$, $\\phi_P=2.0$, $\\phi_N=2.0$.\n- Case $4$: $\\phi_U=2.0$, $\\phi_P=2.0$, $\\phi_N=2.0$.\n\nOutput specification:\n- For each case, output a list of four floats $[F_f^{\\text{unlim}}, F_f^{\\text{lim}}, \\Delta TV^{\\text{unlim}}, \\Delta TV^{\\text{lim}}]$, each rounded to six decimal places.\n- Your program should produce a single line of output containing a list of these four-element lists for the four test cases, with no spaces, for example: $[[a,b,c,d],[...],...]$.\n\nAll quantities are dimensionless; no physical units are required. Angles are not used. The program must be self-contained and require no input.", "solution": "The problem requires the computation of convective fluxes and the change in total variation for a passive scalar field using the Finite Volume Method (FVM). The analysis focuses on a single interior face between two computational cells, $P$ and $N$, with a third cell $U$ providing stencil support for gradient reconstruction. We will use two reconstruction methods for the face value of the scalar $\\phi$: a standard second-order linear reconstruction (unlimited) and a version limited by the Barth-Jespersen limiter to ensure local boundedness. The calculations will be performed for four distinct initial states of the scalar field.\n\nFirst, we establish the parameters that are constant across all test cases. These are derived from the geometric and flow data provided.\n\nThe cell centers are $\\mathbf{x}_P = (0,0)$, $\\mathbf{x}_N = (1,0.2)$, and $\\mathbf{x}_U = (-1,-0.1)$. The face center is $\\mathbf{x}_f = (0.5,0.2)$. The displacement vectors from the upwind cell center $\\mathbf{x}_P$ to its neighbors and to the face center are:\n$$\n\\mathbf{r}_N = \\mathbf{x}_N - \\mathbf{x}_P = (1, 0.2)\n$$\n$$\n\\mathbf{r}_U = \\mathbf{x}_U - \\mathbf{x}_P = (-1, -0.1)\n$$\n$$\n\\mathbf{r}_f = \\mathbf{x}_f - \\mathbf{x}_P = (0.5, 0.2)\n$$\nThe flow properties are given by density $\\rho = 1$, velocity $\\mathbf{u} = (1,0)$, and the face area vector is $\\mathbf{S}_f = (0.8,0.6)$. The mass flux through the face, $m_f$, is calculated as:\n$$\nm_f = \\rho\\,\\mathbf{u}\\cdot\\mathbf{S}_f = 1 \\times (1,0)\\cdot(0.8,0.6) = 1 \\times (1 \\times 0.8 + 0 \\times 0.6) = 0.8\n$$\nSince $m_f > 0$, the flow is from cell $P$ to cell $N$, making $P$ the upwind cell, as stated in the problem.\n\nThe gradient of the scalar field in cell $P$, $\\nabla\\phi|_P = (\\partial\\phi/\\partial x, \\partial\\phi/\\partial y)^T$, is determined by a least-squares method using the neighboring cell values. This results in the $2 \\times 2$ linear system:\n$$\n\\begin{bmatrix}\nr_{N,x} & r_{N,y}\\\\\nr_{U,x} & r_{U,y}\n\\end{bmatrix}\n\\begin{bmatrix}\n\\partial\\phi/\\partial x\\\\\n\\partial\\phi/\\partial y\n\\end{bmatrix}\n=\n\\begin{bmatrix}\n\\phi_N-\\phi_P\\\\\n\\phi_U-\\phi_P\n\\end{bmatrix}\n\\implies\n\\begin{bmatrix}\n1 & 0.2\\\\\n-1 & -0.1\n\\end{bmatrix}\n\\nabla\\phi|_P =\n\\begin{bmatrix}\n\\delta\\phi_N\\\\\n\\delta\\phi_U\n\\end{bmatrix}\n$$\nThe matrix is invertible, with determinant $\\det(A) = (1)(-0.1) - (0.2)(-1) = 0.1$. The inverse matrix is:\n$$\nA^{-1} = \\frac{1}{0.1}\\begin{bmatrix} -0.1 & -0.2 \\\\ 1 & 1 \\end{bmatrix} = \\begin{bmatrix} -1 & -2 \\\\ 10 & 10 \\end{bmatrix}\n$$\nThus, the gradient components can be calculated for any given set of scalar values $\\{\\phi_U, \\phi_P, \\phi_N\\}$ as:\n$$\n\\begin{bmatrix} \\partial\\phi/\\partial x \\\\ \\partial\\phi/\\partial y \\end{bmatrix} = \\begin{bmatrix} -1 & -2 \\\\ 10 & 10 \\end{bmatrix} \\begin{bmatrix} \\phi_N - \\phi_P \\\\ \\phi_U - \\phi_P \\end{bmatrix}\n$$\n\nThe analysis proceeds case by case.\n\n**Case 1: $\\phi_U=1.0$, $\\phi_P=2.0$, $\\phi_N=3.0$** (Smooth monotonic profile)\n1.  Initial Total Variation: $TV(\\phi) = |\\phi_P-\\phi_U| + |\\phi_N-\\phi_P| = |2-1| + |3-2| = 1+1=2.0$.\n2.  Gradient: $\\delta\\phi_N = 3-2=1$, $\\delta\\phi_U = 1-2=-1$.\n    $\\nabla\\phi|_P = \\begin{bmatrix} -1 & -2 \\\\ 10 & 10 \\end{bmatrix} \\begin{bmatrix} 1 \\\\ -1 \\end{bmatrix} = \\begin{bmatrix} -1+2 \\\\ 10-10 \\end{bmatrix} = \\begin{bmatrix} 1 \\\\ 0 \\end{bmatrix}$.\n3.  Reconstruction: The increment is $\\Delta_f = \\nabla\\phi|_P\\cdot\\mathbf{r}_f = (1,0)\\cdot(0.5,0.2) = 0.5$.\n    $\\phi_f^{\\text{unlim}} = \\phi_P + \\Delta_f = 2.0 + 0.5 = 2.5$.\n4.  Limiter: $\\phi_{\\min}=1.0$, $\\phi_{\\max}=3.0$. Since $\\Delta_f = 0.5 > 0$, we use $\\alpha = \\min(1, \\frac{\\phi_{\\max}-\\phi_P}{\\Delta_f}) = \\min(1, \\frac{3-2}{0.5}) = \\min(1,2)=1$. The limiter is inactive.\n    $\\phi_f^{\\text{lim}} = \\phi_P + \\alpha\\Delta_f = 2.0 + 1 \\times 0.5 = 2.5$.\n5.  Fluxes: $F_f^{\\text{unlim}} = m_f \\phi_f^{\\text{unlim}} = 0.8 \\times 2.5 = 2.0$. Since $\\phi_f^{\\text{lim}} = \\phi_f^{\\text{unlim}}$, $F_f^{\\text{lim}} = 2.0$.\n6.  Updates ($\\Delta t=0.2$, $V_P=V_N=1$): Using flux $F_f = 2.0$,\n    $\\phi_P^{\\text{new}} = \\phi_P - \\frac{\\Delta t}{V_P}F_f = 2.0 - 0.2 \\times 2.0 = 1.6$.\n    $\\phi_N^{\\text{new}} = \\phi_N + \\frac{\\Delta t}{V_N}F_f = 3.0 + 0.2 \\times 2.0 = 3.4$.\n7.  Change in TV: $TV(\\phi^{\\text{new}}) = |1.6-1.0| + |3.4-1.6| = 0.6 + 1.8 = 2.4$.\n    $\\Delta TV = TV(\\phi^{\\text{new}}) - TV(\\phi) = 2.4 - 2.0 = 0.4$. This is the same for both unlimited and limited schemes.\n8.  Result: $[F_f^{\\text{unlim}}, F_f^{\\text{lim}}, \\Delta TV^{\\text{unlim}}, \\Delta TV^{\\text{lim}}] = [2.0, 2.0, 0.4, 0.4]$.\n\n**Case 2: $\\phi_U=1.0$, $\\phi_P=1.0$, $\\phi_N=10.0$** (Sharp gradient)\n1.  Initial TV: $TV(\\phi) = |1-1| + |10-1| = 0+9=9.0$.\n2.  Gradient: $\\delta\\phi_N = 10-1=9$, $\\delta\\phi_U = 1-1=0$.\n    $\\nabla\\phi|_P = \\begin{bmatrix} -1 & -2 \\\\ 10 & 10 \\end{bmatrix} \\begin{bmatrix} 9 \\\\ 0 \\end{bmatrix} = \\begin{bmatrix} -9 \\\\ 90 \\end{bmatrix}$.\n3.  Reconstruction: $\\Delta_f = (-9,90)\\cdot(0.5,0.2) = -4.5 + 18.0 = 13.5$.\n    $\\phi_f^{\\text{unlim}} = \\phi_P + \\Delta_f = 1.0 + 13.5 = 14.5$. This creates an overshoot, as $14.5 > \\phi_N=10$.\n4.  Limiter: $\\phi_{\\min}=1.0$, $\\phi_{\\max}=10.0$. Since $\\Delta_f=13.5 > 0$, $\\alpha = \\min(1, \\frac{10-1}{13.5}) = \\min(1, \\frac{9}{13.5}) = \\min(1, 2/3) \\approx 0.666667$.\n    $\\phi_f^{\\text{lim}} = \\phi_P + \\alpha\\Delta_f = 1.0 + (2/3) \\times 13.5 = 1.0 + 9.0 = 10.0$.\n5.  Fluxes: $F_f^{\\text{unlim}} = 0.8 \\times 14.5 = 11.6$. $F_f^{\\text{lim}} = 0.8 \\times 10.0 = 8.0$.\n6.  Updates and $\\Delta TV$ (Unlimited): $F_f^{\\text{unlim}} = 11.6$.\n    $\\phi_P^{\\text{new}} = 1.0 - 0.2 \\times 11.6 = -1.32$. $\\phi_N^{\\text{new}} = 10.0 + 0.2 \\times 11.6 = 12.32$.\n    $TV(\\phi^{\\text{new}}) = |-1.32-1.0| + |12.32-(-1.32)| = 2.32 + 13.64 = 15.96$.\n    $\\Delta TV^{\\text{unlim}} = 15.96 - 9.0 = 6.96$.\n7.  Updates and $\\Delta TV$ (Limited): $F_f^{\\text{lim}} = 8.0$.\n    $\\phi_P^{\\text{new}} = 1.0 - 0.2 \\times 8.0 = -0.6$. $\\phi_N^{\\text{new}} = 10.0 + 0.2 \\times 8.0 = 11.6$.\n    $TV(\\phi^{\\text{new}}) = |-0.6-1.0| + |11.6-(-0.6)| = 1.6 + 12.2 = 13.8$.\n    $\\Delta TV^{\\text{lim}} = 13.8 - 9.0 = 4.8$.\n8.  Result: $[11.6, 8.0, 6.96, 4.8]$.\n\n**Case 3: $\\phi_U=5.0$, $\\phi_P=2.0$, $\\phi_N=2.0$** (Local minimum)\n1.  Initial TV: $TV(\\phi) = |2-5| + |2-2| = 3+0=3.0$.\n2.  Gradient: $\\delta\\phi_N = 2-2=0$, $\\delta\\phi_U = 5-2=3$.\n    $\\nabla\\phi|_P = \\begin{bmatrix} -1 & -2 \\\\ 10 & 10 \\end{bmatrix} \\begin{bmatrix} 0 \\\\ 3 \\end{bmatrix} = \\begin{bmatrix} -6 \\\\ 30 \\end{bmatrix}$.\n3.  Reconstruction: $\\Delta_f = (-6,30)\\cdot(0.5,0.2) = -3.0 + 6.0 = 3.0$.\n    $\\phi_f^{\\text{unlim}} = 2.0 + 3.0 = 5.0$.\n4.  Limiter: $\\phi_{\\min}=2.0$, $\\phi_{\\max}=5.0$. Since $\\Delta_f=3.0 > 0$, $\\alpha = \\min(1, \\frac{5-2}{3}) = \\min(1,1)=1$. Limiter is inactive.\n    $\\phi_f^{\\text{lim}} = 5.0$.\n5.  Fluxes: $F_f^{\\text{unlim}} = 0.8 \\times 5.0 = 4.0$. $F_f^{\\text{lim}} = 4.0$.\n6.  Updates and $\\Delta TV$: Using flux $F_f = 4.0$,\n    $\\phi_P^{\\text{new}} = 2.0 - 0.2 \\times 4.0 = 1.2$. $\\phi_N^{\\text{new}} = 2.0 + 0.2 \\times 4.0 = 2.8$.\n    $TV(\\phi^{\\text{new}}) = |1.2-5.0| + |2.8-1.2| = 3.8 + 1.6 = 5.4$.\n    $\\Delta TV = 5.4 - 3.0 = 2.4$.\n8.  Result: $[4.0, 4.0, 2.4, 2.4]$.\n\n**Case 4: $\\phi_U=2.0$, $\\phi_P=2.0$, $\\phi_N=2.0$** (Uniform field)\n1.  Initial TV: $TV(\\phi) = |2-2| + |2-2| = 0.0$.\n2.  Gradient: $\\delta\\phi_N = 0$, $\\delta\\phi_U = 0$. $\\nabla\\phi|_P = (0,0)$.\n3.  Reconstruction: $\\Delta_f = 0.0$. $\\phi_f^{\\text{unlim}} = 2.0$.\n4.  Limiter: $\\Delta_f=0$, so $\\alpha=1$. $\\phi_f^{\\text{lim}} = 2.0$.\n5.  Fluxes: $F_f^{\\text{unlim}} = 0.8 \\times 2.0 = 1.6$. $F_f^{\\text{lim}} = 1.6$. This is the flux of a constant field, not a fluctuation flux.\n6.  Updates and $\\Delta TV$: Using flux $F_f = 1.6$,\n    $\\phi_P^{\\text{new}} = 2.0 - 0.2 \\times 1.6 = 1.68$. $\\phi_N^{\\text{new}} = 2.0 + 0.2 \\times 1.6 = 2.32$.\n    $TV(\\phi^{\\text{new}}) = |1.68-2.0| + |2.32-1.68| = 0.32 + 0.64 = 0.96$.\n    $\\Delta TV = 0.96 - 0.0 = 0.96$. This demonstrates that a second-order scheme is generally not total variation diminishing (TVD) and can introduce oscillations even in a constant field if not carefully formulated, though here it simply creates a gradient.\n8.  Result: $[1.6, 1.6, 0.96, 0.96]$.\n\nThe calculations show how the limiter acts to prevent overshoots (Case 2), thereby reducing the increase in total variation, which is a key goal for designing stable, non-oscillatory numerical schemes for convection. In smooth regions (Case 1) or when the reconstruction is incidentally bounded (Case 3), the limiter remains inactive.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes convective fluxes and total variation changes for a scalar advection\n    problem using the Finite Volume Method with unlimited and limited linear\n    reconstruction.\n    \"\"\"\n    # Define constant geometric and flow parameters\n    x_P = np.array([0.0, 0.0])\n    x_N = np.array([1.0, 0.2])\n    x_U = np.array([-1.0, -0.1])\n    x_f = np.array([0.5, 0.2])\n\n    r_N = x_N - x_P\n    r_U = x_U - x_P\n    r_f = x_f - x_P\n\n    S_f = np.array([0.8, 0.6])\n    u = np.array([1.0, 0.0])\n    rho = 1.0\n    V_P = 1.0\n    V_N = 1.0\n    dt = 0.2\n\n    # Mass flux through the face\n    m_f = rho * np.dot(u, S_f)\n\n    # Matrix for least-squares gradient calculation\n    grad_matrix = np.array([[r_N[0], r_N[1]], [r_U[0], r_U[1]]])\n    # Pre-compute the inverse matrix\n    grad_matrix_inv = np.linalg.inv(grad_matrix)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (1.0, 2.0, 3.0),  # Case 1\n        (1.0, 1.0, 10.0), # Case 2\n        (5.0, 2.0, 2.0),  # Case 3\n        (2.0, 2.0, 2.0),  # Case 4\n    ]\n\n    results = []\n    for phi_U, phi_P, phi_N in test_cases:\n        # Initial Total Variation\n        tv_initial = abs(phi_P - phi_U) + abs(phi_N - phi_P)\n\n        # --- Gradient Calculation ---\n        delta_phi_N = phi_N - phi_P\n        delta_phi_U = phi_U - phi_P\n        delta_phi_vec = np.array([delta_phi_N, delta_phi_U])\n        grad_phi_P = np.dot(grad_matrix_inv, delta_phi_vec)\n\n        # --- Unlimited Reconstruction ---\n        delta_f = np.dot(grad_phi_P, r_f)\n        phi_f_unlim = phi_P + delta_f\n        F_f_unlim = m_f * phi_f_unlim\n\n        # --- Limited Reconstruction ---\n        phi_min = min(phi_U, phi_P, phi_N)\n        phi_max = max(phi_U, phi_P, phi_N)\n\n        if delta_f > 1e-12: # Using a small tolerance for float comparison\n            alpha = min(1.0, (phi_max - phi_P) / delta_f)\n        elif delta_f < -1e-12:\n            alpha = min(1.0, (phi_min - phi_P) / delta_f)\n        else: # delta_f is close to zero\n            alpha = 1.0\n\n        phi_f_lim = phi_P + alpha * delta_f\n        F_f_lim = m_f * phi_f_lim\n        \n        # --- Total Variation Change (Unlimited) ---\n        phi_P_new_unlim = phi_P - (dt / V_P) * F_f_unlim\n        phi_N_new_unlim = phi_N + (dt / V_N) * F_f_unlim\n        tv_new_unlim = abs(phi_P_new_unlim - phi_U) + abs(phi_N_new_unlim - phi_P_new_unlim)\n        delta_tv_unlim = tv_new_unlim - tv_initial\n\n        # --- Total Variation Change (Limited) ---\n        phi_P_new_lim = phi_P - (dt / V_P) * F_f_lim\n        phi_N_new_lim = phi_N + (dt / V_N) * F_f_lim\n        tv_new_lim = abs(phi_P_new_lim - phi_U) + abs(phi_N_new_lim - phi_P_new_lim)\n        delta_tv_lim = tv_new_lim - tv_initial\n\n        # Append results for the current case\n        results.append([F_f_unlim, F_f_lim, delta_tv_unlim, delta_tv_lim])\n\n    # Final print statement in the exact required format.\n    output_parts = []\n    for r_list in results:\n        # Format each inner list string with numbers rounded to 6 decimal places\n        output_parts.append(f\"[{','.join([f'{v:.6f}' for v in r_list])}]\")\n\n    final_string = f\"[{','.join(output_parts)}]\"\n    print(final_string)\n\nsolve()\n```", "id": "3291633"}]}