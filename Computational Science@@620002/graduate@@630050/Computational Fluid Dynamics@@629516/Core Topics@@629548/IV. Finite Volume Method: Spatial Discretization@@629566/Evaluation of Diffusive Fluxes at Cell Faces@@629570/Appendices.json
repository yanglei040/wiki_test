{"hands_on_practices": [{"introduction": "We begin our hands-on exploration by tackling a fundamental challenge in modeling diffusion: handling sharp changes in material properties. This practice focuses on a one-dimensional composite medium where the diffusion coefficient $\\Gamma$ has a discontinuity at a cell face. By deriving the exact flux from first principles and comparing it to a common numerical approximation, you will discover why a simple arithmetic average is insufficient and how the concept of harmonic averaging naturally arises from enforcing flux continuity [@problem_id:3316585].", "problem": "Consider one-dimensional, steady diffusion of a passive scalar $\\,\\phi\\,$ with no sources and no convection in a composite medium where the diffusion coefficient $\\,\\Gamma\\,$ has a discontinuity at an interface coincident with a finite-volume face. Two adjacent control volumes share a common face located at position $\\,x_f\\,$. The west cell center is at position $\\,x_W\\,$ and the east cell center is at position $\\,x_E\\,$. The distances from the cell centers to the face are $\\,\\delta_W = x_f - x_W\\,$ and $\\,\\delta_E = x_E - x_f\\,$, respectively, with $\\,\\delta_W \\neq \\delta_E\\,$ to represent a graded mesh. The cross-sectional area is $\\,A\\,$, taken constant, and the diffusion coefficient takes the constant values $\\,\\Gamma_W\\,$ for $\\,x<x_f\\,$ and $\\,\\Gamma_E\\,$ for $\\,x>x_f\\,$, with $\\,\\Gamma_W \\neq \\Gamma_E\\,$.\n\nYou are to evaluate the diffusive flux at the face from the two cell-centered values $\\,\\phi_W\\,$ and $\\,\\phi_E\\,$, starting from Fick’s law $\\,q = -\\Gamma\\,\\mathrm{d}\\phi/\\mathrm{d}x\\,$ and the fact that the steady diffusive flux is continuous across the interface. Define the face flux magnitude predicted by a two-point face scheme using an arithmetic average of the diffusion coefficient as\n$$F_{\\text{arith}} = A\\,\\Gamma_f^{\\text{arith}}\\,\\frac{\\phi_E - \\phi_W}{\\delta_W + \\delta_E},$$\nwith $\\,\\Gamma_f^{\\text{arith}} = \\tfrac{1}{2}\\left(\\Gamma_W + \\Gamma_E\\right)\\,$, and let $\\,F_{\\text{exact}}\\,$ be the physically consistent flux obtained by enforcing flux continuity across the interface and piecewise constant $\\,\\Gamma\\,$.\n\nUsing only the fundamental relations described above, derive and report a closed-form analytic expression for the relative error\n$$\\mathcal{E} = \\frac{F_{\\text{arith}} - F_{\\text{exact}}}{F_{\\text{exact}}},$$\nexpressed solely in terms of $\\,\\Gamma_W\\,$, $\\,\\Gamma_E\\,$, $\\,\\delta_W\\,$, and $\\,\\delta_E\\,$. Interpret this result by relating it to an effective interface resistance and ensure the expression is dimensionless. The final answer must be a single closed-form analytical expression. Do not round.", "solution": "The problem requires the derivation of the relative error between a numerically approximated diffusive flux and the exact diffusive flux across an interface in a composite medium. The starting point is the one-dimensional, steady-state diffusion equation with no sources or convection, which is derived from Fick's law.\n\nFor a one-dimensional system, Fick's law states that the diffusive flux per unit area, $q$, is given by:\n$$q = -\\Gamma \\frac{d\\phi}{dx}$$\nwhere $\\phi$ is the scalar concentration and $\\Gamma$ is the diffusion coefficient. The total flux across a surface of area $A$ is $F = A q$.\n\nUnder steady-state conditions with no sources, the principle of conservation dictates that the flux must be constant throughout the domain. That is, $\\frac{dF}{dx} = 0$, which implies $F$ is a constant. Let us denote this constant exact flux as $F_{\\text{exact}}$.\n\nThe domain is composed of two regions with different diffusion coefficients: $\\Gamma_W$ for $x < x_f$ and $\\Gamma_E$ for $x > x_f$. We can integrate Fick's law across each region separately.\n\nFirst, consider the west-side region, from the cell center at $x_W$ to the face at $x_f$. The diffusion coefficient is $\\Gamma_W$.\n$$F_{\\text{exact}} = -A \\Gamma_W \\frac{d\\phi}{dx} \\quad \\text{for} \\quad x \\in [x_W, x_f]$$\nSeparating variables and integrating from $x_W$ to $x_f$, where the scalar values are $\\phi_W$ and $\\phi_f$ respectively:\n$$\\int_{x_W}^{x_f} F_{\\text{exact}} dx = -A \\Gamma_W \\int_{\\phi_W}^{\\phi_f} d\\phi$$\n$$F_{\\text{exact}} (x_f - x_W) = -A \\Gamma_W (\\phi_f - \\phi_W)$$\nUsing the definition $\\delta_W = x_f - x_W$, we get:\n$$F_{\\text{exact}} \\delta_W = A \\Gamma_W (\\phi_W - \\phi_f)$$\nThis can be rearranged to express the drop in the scalar value:\n$$\\phi_W - \\phi_f = \\frac{F_{\\text{exact}} \\delta_W}{A \\Gamma_W}$$\n\nNext, consider the east-side region, from the face at $x_f$ to the cell center at $x_E$. The diffusion coefficient is $\\Gamma_E$.\n$$F_{\\text{exact}} = -A \\Gamma_E \\frac{d\\phi}{dx} \\quad \\text{for} \\quad x \\in [x_f, x_E]$$\nIntegrating from $x_f$ to $x_E$, where the scalar values are $\\phi_f$ and $\\phi_E$:\n$$\\int_{x_f}^{x_E} F_{\\text{exact}} dx = -A \\Gamma_E \\int_{\\phi_f}^{\\phi_E} d\\phi$$\n$$F_{\\text{exact}} (x_E - x_f) = -A \\Gamma_E (\\phi_E - \\phi_f)$$\nUsing the definition $\\delta_E = x_E - x_f$, we have:\n$$F_{\\text{exact}} \\delta_E = A \\Gamma_E (\\phi_f - \\phi_E)$$\nThis gives the second scalar drop:\n$$\\phi_f - \\phi_E = \\frac{F_{\\text{exact}} \\delta_E}{A \\Gamma_E}$$\n\nTo eliminate the unknown interface scalar value $\\phi_f$, we add the two expressions for the scalar drops:\n$$(\\phi_W - \\phi_f) + (\\phi_f - \\phi_E) = \\frac{F_{\\text{exact}} \\delta_W}{A \\Gamma_W} + \\frac{F_{\\text{exact}} \\delta_E}{A \\Gamma_E}$$\n$$\\phi_W - \\phi_E = \\frac{F_{\\text{exact}}}{A} \\left( \\frac{\\delta_W}{\\Gamma_W} + \\frac{\\delta_E}{\\Gamma_E} \\right)$$\nNow we can solve for the exact flux, $F_{\\text{exact}}$, in terms of the known cell-centered values $\\phi_W$ and $\\phi_E$:\n$$F_{\\text{exact}} = A \\frac{\\phi_W - \\phi_E}{\\frac{\\delta_W}{\\Gamma_W} + \\frac{\\delta_E}{\\Gamma_E}}$$\nTo align with the sign convention used in the definition of $F_{\\text{arith}}$, which is proportional to $\\phi_E - \\phi_W$, we can write:\n$$F_{\\text{exact}} = -A \\frac{\\phi_E - \\phi_W}{\\frac{\\delta_W}{\\Gamma_W} + \\frac{\\delta_E}{\\Gamma_E}}$$\nThis can be rewritten by defining an effective diffusion coefficient for the interface, $\\Gamma_f^{\\text{exact}}$:\n$$F_{\\text{exact}} = A \\, \\Gamma_f^{\\text{exact}} \\frac{\\phi_E - \\phi_W}{\\delta_W + \\delta_E}$$\nComparing the forms, we can identify $\\Gamma_f^{\\text{exact}}$:\n$$A \\, \\Gamma_f^{\\text{exact}} \\frac{\\phi_E - \\phi_W}{\\delta_W + \\delta_E} = -A \\frac{\\phi_E - \\phi_W}{\\frac{\\delta_W}{\\Gamma_W} + \\frac{\\delta_E}{\\Gamma_E}} \\quad \\implies \\quad \\Gamma_f^{\\text{exact}} = \\frac{\\delta_W + \\delta_E}{\\frac{\\delta_W}{\\Gamma_W} + \\frac{\\delta_E}{\\Gamma_E}}$$\nThis is the weighted harmonic mean of the diffusion coefficients. The terms $\\frac{\\delta_W}{A\\Gamma_W}$ and $\\frac{\\delta_E}{A\\Gamma_E}$ represent the diffusive resistances of the west and east segments, demonstrating that for the exact solution, these series resistances add up.\n\nThe problem defines the flux calculated with the arithmetic average of the diffusion coefficient as:\n$$F_{\\text{arith}} = A\\,\\Gamma_f^{\\text{arith}}\\,\\frac{\\phi_E - \\phi_W}{\\delta_W + \\delta_E}$$\nwhere $\\Gamma_f^{\\text{arith}} = \\frac{1}{2}(\\Gamma_W + \\Gamma_E)$.\n\nWe are asked to find the relative error $\\mathcal{E}$:\n$$\\mathcal{E} = \\frac{F_{\\text{arith}} - F_{\\text{exact}}}{F_{\\text{exact}}} = \\frac{F_{\\text{arith}}}{F_{\\text{exact}}} - 1$$\nThe ratio of the fluxes simplifies to the ratio of the effective diffusion coefficients:\n$$\\frac{F_{\\text{arith}}}{F_{\\text{exact}}} = \\frac{A\\,\\Gamma_f^{\\text{arith}}\\,\\frac{\\phi_E - \\phi_W}{\\delta_W + \\delta_E}}{A\\,\\Gamma_f^{\\text{exact}}\\,\\frac{\\phi_E - \\phi_W}{\\delta_W + \\delta_E}} = \\frac{\\Gamma_f^{\\text{arith}}}{\\Gamma_f^{\\text{exact}}}$$\nSubstituting the expressions for $\\Gamma_f^{\\text{arith}}$ and $\\Gamma_f^{\\text{exact}}$:\n$$\\frac{F_{\\text{arith}}}{F_{\\text{exact}}} = \\frac{\\frac{1}{2}(\\Gamma_W + \\Gamma_E)}{\\frac{\\delta_W + \\delta_E}{\\frac{\\delta_W}{\\Gamma_W} + \\frac{\\delta_E}{\\Gamma_E}}} = \\frac{\\Gamma_W + \\Gamma_E}{2} \\cdot \\frac{\\frac{\\delta_W}{\\Gamma_W} + \\frac{\\delta_E}{\\Gamma_E}}{\\delta_W + \\delta_E}$$\nLet's simplify this expression:\n$$\\frac{F_{\\text{arith}}}{F_{\\text{exact}}} = \\frac{\\Gamma_W + \\Gamma_E}{2(\\delta_W + \\delta_E)} \\cdot \\frac{\\delta_W \\Gamma_E + \\delta_E \\Gamma_W}{\\Gamma_W \\Gamma_E} = \\frac{(\\Gamma_W + \\Gamma_E)(\\delta_W \\Gamma_E + \\delta_E \\Gamma_W)}{2 \\Gamma_W \\Gamma_E (\\delta_W + \\delta_E)}$$\nNow, we compute the relative error $\\mathcal{E}$:\n$$\\mathcal{E} = \\frac{(\\Gamma_W + \\Gamma_E)(\\delta_W \\Gamma_E + \\delta_E \\Gamma_W)}{2 \\Gamma_W \\Gamma_E (\\delta_W + \\delta_E)} - 1$$\n$$\\mathcal{E} = \\frac{(\\Gamma_W + \\Gamma_E)(\\delta_W \\Gamma_E + \\delta_E \\Gamma_W) - 2 \\Gamma_W \\Gamma_E (\\delta_W + \\delta_E)}{2 \\Gamma_W \\Gamma_E (\\delta_W + \\delta_E)}$$\nExpanding the numerator:\nNumerator $= (\\Gamma_W \\delta_W \\Gamma_E + \\Gamma_W \\delta_E \\Gamma_W + \\Gamma_E \\delta_W \\Gamma_E + \\Gamma_E \\delta_E \\Gamma_W) - (2\\delta_W \\Gamma_W \\Gamma_E + 2\\delta_E \\Gamma_W \\Gamma_E)$\nNumerator $= \\delta_W \\Gamma_W \\Gamma_E + \\delta_E \\Gamma_W^2 + \\delta_W \\Gamma_E^2 + \\delta_E \\Gamma_W \\Gamma_E - 2\\delta_W \\Gamma_W \\Gamma_E - 2\\delta_E \\Gamma_W \\Gamma_E$\nCombining terms:\nNumerator $= \\delta_E \\Gamma_W^2 + \\delta_W \\Gamma_E^2 - \\delta_W \\Gamma_W \\Gamma_E - \\delta_E \\Gamma_W \\Gamma_E$\nFactoring by $\\delta_W$ and $\\delta_E$:\nNumerator $= \\delta_W(\\Gamma_E^2 - \\Gamma_W \\Gamma_E) + \\delta_E(\\Gamma_W^2 - \\Gamma_W \\Gamma_E)$\nNumerator $= \\delta_W \\Gamma_E(\\Gamma_E - \\Gamma_W) - \\delta_E \\Gamma_W(\\Gamma_E - \\Gamma_W)$\nFactoring out the common term $(\\Gamma_E - \\Gamma_W)$:\nNumerator $= (\\Gamma_E - \\Gamma_W)(\\delta_W \\Gamma_E - \\delta_E \\Gamma_W)$\n\nThus, the final expression for the relative error is:\n$$\\mathcal{E} = \\frac{(\\Gamma_E - \\Gamma_W)(\\delta_W \\Gamma_E - \\delta_E \\Gamma_W)}{2 \\Gamma_W \\Gamma_E (\\delta_W + \\delta_E)}$$\nThis expression is dimensionless, as required. The numerator has units of $[\\Gamma]^2[\\delta]$ and the denominator has units of $[\\Gamma]^2[\\delta]$.\n\nThis result can be interpreted through the concept of diffusive resistance. The exact total resistance is $R_{\\text{exact}} = (\\delta_W/(A\\Gamma_W)) + (\\delta_E/(A\\Gamma_E))$. The resistance implied by the arithmetic mean approximation is $R_{\\text{arith}} = (\\delta_W+\\delta_E)/(A\\Gamma_f^{\\text{arith}})$. The relative error in flux is given by $\\mathcal{E} = R_{\\text{exact}}/R_{\\text{arith}} - 1$. The derived expression shows that this error is zero under two conditions:\n$1$. $\\Gamma_E = \\Gamma_W$: The medium is homogeneous, so there is no discontinuity.\n$2$. $\\delta_W \\Gamma_E = \\delta_E \\Gamma_W$, or $\\delta_W/\\delta_E = \\Gamma_W/\\Gamma_E$: The grid spacing on either side of the interface is graded in a specific ratio related to the diffusion coefficients. In this particular case, the arithmetic mean fortuitously yields the correct harmonic mean required by the physics.\nFor a uniform grid ($\\delta_W = \\delta_E = \\delta$), the error simplifies to $\\mathcal{E} = \\frac{(\\Gamma_E - \\Gamma_W)^2}{4\\Gamma_W\\Gamma_E}$. Since this is always non-negative, the arithmetic average scheme always overestimates the magnitude of the flux compared to the exact solution when the grid is uniform and $\\Gamma_W \\neq \\Gamma_E$.", "answer": "$$\\boxed{\\frac{(\\Gamma_E - \\Gamma_W)(\\delta_W \\Gamma_E - \\delta_E \\Gamma_W)}{2 \\Gamma_W \\Gamma_E (\\delta_W + \\delta_E)}}$$", "id": "3316585"}, {"introduction": "Building upon the 1D case, we now move into two dimensions and address a geometric complexity: non-orthogonal grids. This exercise guides you through the process of verifying a numerical flux scheme using the Method of Manufactured Solutions (MMS), a cornerstone of computational code verification. You will derive and implement a principled non-orthogonal correction to the face gradient, quantifying its accuracy and convergence order on a series of sheared meshes, which is a crucial skill for developing robust CFD codes for real-world geometries [@problem_id:3316543].", "problem": "You are to verify the numerical evaluation of diffusive fluxes through non-orthogonal cell faces for a two-dimensional anisotropic diffusion operator by the method of manufactured solutions. The objective is to determine the observed order of accuracy of a face-flux evaluation scheme and quantify the error norms on a sequence of grids with controlled non-orthogonality. The fundamental base is Fick’s law of diffusion and the divergence theorem. Begin from the statement that the diffusive flux density for a scalar field $\\phi(x,y)$ under an anisotropic, symmetric, positive-definite conductivity tensor $\\mathbf{K}$ is given by $\\mathbf{q} = -\\mathbf{K}\\nabla \\phi$, and that the oriented flux through a face with area vector $\\mathbf{S} = \\mathbf{n}\\,A$ is $F = \\mathbf{q}\\cdot \\mathbf{S}$, where $\\mathbf{n}$ is the outward unit normal and $A$ is the face measure, so that $F = -\\mathbf{n}^{\\mathsf{T}}\\mathbf{K}\\nabla\\phi\\;A$. The task is to devise and implement a face-gradient approximation that remains accurate on non-orthogonal grids by a principled decomposition from first principles, and then compare the resulting discrete face flux with the exact manufactured flux.\n\nDefine the physical domain to be the unit square $\\Omega = [0,1]\\times[0,1]$. Construct a family of structured, parallelogram meshes by a shear mapping from computational coordinates $( \\xi,\\eta )$ to physical coordinates $(x,y)$ as\n$$\nx = \\xi + s\\,\\eta,\\qquad y = \\eta,\n$$\nwhere $s$ is a non-orthogonality (shear) parameter. A structured grid with $N_x = N_y = N$ has nodes at computational coordinates $\\xi_i = i/N$ and $\\eta_j = j/N$ for $i \\in \\{0,1,\\dots,N\\}$ and $j \\in \\{0,1,\\dots,N\\}$. Each cell is the quadrilateral formed by consecutive nodes, and its center is the average of its four vertices. Faces are the edges of these quadrilaterals, and interior faces are those shared by two adjacent cells.\n\nUse an anisotropic, constant, symmetric, positive-definite conductivity tensor\n$$\n\\mathbf{K} = \\begin{bmatrix} 2.0 & 0.5 \\\\ 0.5 & 1.5 \\end{bmatrix}.\n$$\nManufacture a smooth scalar field\n$$\n\\phi(x,y) = \\sin(\\pi x)\\,\\cos(\\pi y) + x^2 - y,\n$$\nwith exact gradient\n$$\n\\nabla\\phi(x,y) = \\begin{bmatrix} \\pi \\cos(\\pi x)\\,\\cos(\\pi y) + 2x \\\\ -\\pi \\sin(\\pi x)\\,\\sin(\\pi y) - 1 \\end{bmatrix}.\n$$\n\nFor each interior face shared by a pair of adjacent cells $P$ and $N$, with cell-center positions $\\mathbf{c}_P$ and $\\mathbf{c}_N$, and edge endpoints $\\mathbf{e}_0$ and $\\mathbf{e}_1$, define the face center $\\mathbf{f} = (\\mathbf{e}_0 + \\mathbf{e}_1)/2$, the edge tangent $\\mathbf{t} = \\mathbf{e}_1 - \\mathbf{e}_0$, the outward area vector for cell $P$ as the edge normal $\\mathbf{S}_f = \\mathbf{n}_f\\,A_f = [t_y,\\,-t_x]$ (whose magnitude equals the edge length $A_f = \\|\\mathbf{t}\\|$), oriented outward from $P$, and the center-to-center vector $\\mathbf{d} = \\mathbf{c}_N - \\mathbf{c}_P$ with unit $\\widehat{\\mathbf{d}} = \\mathbf{d}/\\|\\mathbf{d}\\|$. Starting from the definition $F = -\\mathbf{n}^{\\mathsf{T}}\\mathbf{K}\\nabla\\phi\\;A$, derive a consistent face-gradient approximation $\\nabla\\phi\\big|_f$ on non-orthogonal grids by decomposing $\\nabla\\phi$ into components along $\\widehat{\\mathbf{d}}$ and its orthogonal complement and using only quantities available at cell centers, then construct the corresponding approximate face flux $F_{\\text{approx}} = -\\mathbf{S}_f^{\\mathsf{T}}\\,\\mathbf{K}\\,\\nabla\\phi\\big|_f$. Use the manufactured $\\phi$ and its exact gradients at cell centers to isolate the error attributable to the face-gradient approximation rather than cell-gradient reconstruction.\n\nQuantify error by comparing $F_{\\text{approx}}$ with the exact face flux $F_{\\text{exact}} = -\\mathbf{S}_f^{\\mathsf{T}}\\,\\mathbf{K}\\,\\nabla\\phi(\\mathbf{f})$ over all interior faces. Compute the relative $L_2$ error\n$$\nE_{L_2} = \\sqrt{\\frac{\\sum_{f} \\left(F_{\\text{approx}} - F_{\\text{exact}}\\right)^2}{\\sum_{f} \\left(F_{\\text{exact}}\\right)^2}},\n$$\nand determine observed orders of accuracy between successive refinements $N \\to 2N$ as\n$$\np = \\frac{\\log\\left(E_{L_2}(N) / E_{L_2}(2N)\\right)}{\\log(2)}.\n$$\n\nImplement a program that:\n- Builds the shear-mapped grids for specified $N$ and $s$.\n- Evaluates $\\phi$ and $\\nabla\\phi$ at all cell centers exactly from the manufactured solution.\n- Constructs interior faces, oriented area vectors, and evaluates both $F_{\\text{approx}}$ from a principled non-orthogonal correction derived from first principles and $F_{\\text{exact}}$ from the manufactured gradient at the face center.\n- Aggregates errors over all interior faces to compute $E_{L_2}$ for each case and computes observed orders $p$ across refinements.\n\nYour test suite must use:\n- $s \\in \\{0.0,\\,0.3\\}$.\n- $N \\in \\{8,\\,16,\\,32\\}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the following order of floats:\n- For $s=0.0$: $E_{L_2}(8),\\,E_{L_2}(16),\\,E_{L_2}(32),\\,p(8\\to 16),\\,p(16\\to 32)$,\n- For $s=0.3$: $E_{L_2}(8),\\,E_{L_2}(16),\\,E_{L_2}(32),\\,p(8\\to 16),\\,p(16\\to 32)$.\n\nAll quantities are dimensionless; express all numbers as floating-point values. The final printed line must contain exactly these ten values within a single bracketed list, with no additional text.", "solution": "### Step 1: Extract Givens\nThe problem provides the following information:\n- **Physical Law**: Fick's law of diffusion, with diffusive flux density $\\mathbf{q} = -\\mathbf{K}\\nabla \\phi$.\n- **Flux through a face**: $F = \\mathbf{q}\\cdot \\mathbf{S} = -\\mathbf{S}^{\\mathsf{T}}\\mathbf{K}\\nabla\\phi$, where $\\mathbf{S} = \\mathbf{n}\\,A$.\n- **Domain**: Unit square $\\Omega = [0,1]\\times[0,1]$.\n- **Grid Generation**: A structured parallelogram mesh is generated by the shear mapping $x = \\xi + s\\,\\eta$, $y = \\eta$ from a uniform computational grid in $(\\xi, \\eta)$, where $s$ is the shear parameter. The grid has $N_x = N_y = N$ cells in each direction.\n- **Node Locations**: Nodes are at computational coordinates $\\xi_i = i/N$ and $\\eta_j = j/N$ for $i,j \\in \\{0, \\dots, N\\}$.\n- **Conductivity Tensor**: Anisotropic, constant, symmetric, positive-definite tensor $\\mathbf{K} = \\begin{bmatrix} 2.0 & 0.5 \\\\ 0.5 & 1.5 \\end{bmatrix}$.\n- **Manufactured Solution (Scalar Field)**: $\\phi(x,y) = \\sin(\\pi x)\\,\\cos(\\pi y) + x^2 - y$.\n- **Manufactured Solution (Gradient)**: $\\nabla\\phi(x,y) = \\begin{bmatrix} \\pi \\cos(\\pi x)\\,\\cos(\\pi y) + 2x \\\\ -\\pi \\sin(\\pi x)\\,\\sin(\\pi y) - 1 \\end{bmatrix}$.\n- **Geometric Definitions**: For a face between cells $P$ and $N$:\n    - Face center: $\\mathbf{f} = (\\mathbf{e}_0 + \\mathbf{e}_1)/2$, where $\\mathbf{e}_0, \\mathbf{e}_1$ are endpoints.\n    - Tangent vector: $\\mathbf{t} = \\mathbf{e}_1 - \\mathbf{e}_0$.\n    - Area vector: $\\mathbf{S}_f = [t_y, -t_x]$ (oriented outward from cell $P$).\n    - Center-to-center vector: $\\mathbf{d} = \\mathbf{c}_N - \\mathbf{c}_P$.\n- **Flux Evaluation**:\n    - Approximate flux: $F_{\\text{approx}} = -\\mathbf{S}_f^{\\mathsf{T}}\\,\\mathbf{K}\\,\\nabla\\phi\\big|_f$, where $\\nabla\\phi\\big|_f$ is an approximation.\n    - Exact flux: $F_{\\text{exact}} = -\\mathbf{S}_f^{\\mathsf{T}}\\,\\mathbf{K}\\,\\nabla\\phi(\\mathbf{f})$, using the exact gradient at the face center.\n- **Error Metrics**:\n    - Relative $L_2$ error: $E_{L_2} = \\sqrt{\\frac{\\sum_{f} \\left(F_{\\text{approx}} - F_{\\text{exact}}\\right)^2}{\\sum_{f} \\left(F_{\\text{exact}}\\right)^2}}$.\n    - Observed order of accuracy: $p = \\frac{\\log\\left(E_{L_2}(N) / E_{L_2}(2N)\\right)}{\\log(2)}$.\n- **Test Cases**:\n    - Shear parameter: $s \\in \\{0.0, 0.3\\}$.\n    - Grid sizes: $N \\in \\{8, 16, 32\\}$.\n- **Task**: Derive a face-gradient approximation for non-orthogonal grids, implement it, and compute the specified errors and orders of accuracy. The exact cell-centered values of $\\phi$ and $\\nabla\\phi$ from the manufactured solution are to be used, isolating the error to the face interpolation/reconstruction scheme.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded**: The problem is based on the diffusion equation, a fundamental transport equation in physics and engineering. The method of manufactured solutions is a standard, well-established verification technique in computational science. The chosen manufactured solution is smooth, and the conductivity tensor is symmetric positive-definite, which is physically required for diffusion. The problem is sound.\n2.  **Well-Posed**: The task is to numerically evaluate a well-defined procedure. The inputs are specified, the outputs are defined, and the required derivation follows a standard approach in finite volume methods. A unique, stable, and meaningful result (the error norms and orders of accuracy) is expected. The problem is well-posed.\n3.  **Objective**: The problem uses precise mathematical and computational language. All quantities are defined unambiguously. There are no subjective or opinion-based statements.\n4.  **Completeness and Consistency**: All necessary parameters ($\\mathbf{K}$, $\\phi(x,y)$, $s$, $N$), definitions (geometry, errors), and procedures are provided. The information is self-contained and consistent.\n\n### Step 3: Verdict and Action\nThe problem is valid. It is a well-defined exercise in numerical methods for computational fluid dynamics. A solution will be provided.\n\n### Solution Derivation and Implementation\nThe goal is to verify a numerical scheme for computing the diffusive flux $F = -\\mathbf{S}_f^{\\mathsf{T}}\\mathbf{K}\\nabla\\phi$ across a cell face $f$. The primary challenge on non-orthogonal grids is to find an accurate approximation for the gradient at the face center, $\\nabla\\phi\\big|_f$, using values from the adjacent cell centers, $P$ and $N$. The problem specifies that the exact cell-centered values of $\\phi$ and $\\nabla\\phi$ are known.\n\n**Derivation of the Face-Gradient Approximation**\nWe are tasked to derive a consistent face-gradient approximation, $\\nabla\\phi\\big|_f$, by decomposing the gradient vector. A principled approach is to decompose $\\nabla\\phi\\big|_f$ into components parallel and perpendicular to the vector $\\mathbf{d} = \\mathbf{c}_N - \\mathbf{c}_P$ connecting the two cell centers. Let $\\widehat{\\mathbf{d}} = \\mathbf{d} / \\|\\mathbf{d}\\|$ be the unit vector in this direction.\n\nAny vector can be uniquely decomposed into its projections along and orthogonal to a given direction. Thus, we can write:\n$$\n\\nabla\\phi\\big|_f = (\\nabla\\phi\\big|_f \\cdot \\widehat{\\mathbf{d}})\\,\\widehat{\\mathbf{d}} + \\left( \\nabla\\phi\\big|_f - (\\nabla\\phi\\big|_f \\cdot \\widehat{\\mathbf{d}})\\,\\widehat{\\mathbf{d}} \\right)\n$$\nWe now approximate each of these two orthogonal components.\n\n1.  **Component Parallel to $\\mathbf{d}$**: The directional derivative of $\\phi$ in the direction $\\widehat{\\mathbf{d}}$ at the face, $\\nabla\\phi\\big|_f \\cdot \\widehat{\\mathbf{d}}$, can be approximated by a second-order accurate central finite difference using the scalar values at the cell centers $\\mathbf{c}_P$ and $\\mathbf{c}_N$:\n    $$\n    \\nabla\\phi\\big|_f \\cdot \\widehat{\\mathbf{d}} \\approx \\frac{\\phi_N - \\phi_P}{\\|\\mathbf{d}\\|}\n    $$\n    where $\\phi_P = \\phi(\\mathbf{c}_P)$ and $\\phi_N = \\phi(\\mathbf{c}_N)$. This approximation comes directly from a Taylor series expansion of $\\phi$ about a point on the segment $\\overline{\\mathbf{c}_P \\mathbf{c}_N}$.\n\n2.  **Component Orthogonal to $\\mathbf{d}$**: For the component of the gradient orthogonal to $\\widehat{\\mathbf{d}}$, a reasonable approximation is obtained by using the available cell-centered gradients, $\\nabla\\phi_P$ and $\\nabla\\phi_N$. We first form an average gradient, $\\overline{\\nabla\\phi} = \\frac{1}{2}(\\nabla\\phi_P + \\nabla\\phi_N)$, which is a second-order approximation to $\\nabla\\phi$ at the midpoint of $\\overline{\\mathbf{c}_P \\mathbf{c}_N}$. The component of this average gradient that is orthogonal to $\\widehat{\\mathbf{d}}$ is found by subtracting its projection onto $\\widehat{\\mathbf{d}}$:\n    $$\n    \\left( \\nabla\\phi\\big|_f - (\\nabla\\phi\\big|_f \\cdot \\widehat{\\mathbf{d}})\\,\\widehat{\\mathbf{d}} \\right) \\approx \\overline{\\nabla\\phi} - (\\overline{\\nabla\\phi} \\cdot \\widehat{\\mathbf{d}})\\,\\widehat{\\mathbf{d}}\n    $$\n\nCombining these two approximations yields the complete expression for the face gradient:\n$$\n\\nabla\\phi\\big|_f \\approx \\left(\\frac{\\phi_N - \\phi_P}{\\|\\mathbf{d}\\|}\\right)\\,\\widehat{\\mathbf{d}} + \\left( \\overline{\\nabla\\phi} - (\\overline{\\nabla\\phi} \\cdot \\widehat{\\mathbf{d}})\\,\\widehat{\\mathbf{d}} \\right)\n$$\nThis can be rearranged into a more common \"correction\" form:\n$$\n\\nabla\\phi\\big|_f \\approx \\overline{\\nabla\\phi} + \\left( \\frac{\\phi_N - \\phi_P}{\\|\\mathbf{d}\\|} - \\overline{\\nabla\\phi} \\cdot \\widehat{\\mathbf{d}} \\right)\\,\\widehat{\\mathbf{d}}\n$$\nThis expression represents the face gradient as a simple average of cell-center gradients, plus a correction term. The correction term is non-zero when the interpolated gradient component along $\\mathbf{d}$ (i.e., $\\overline{\\nabla\\phi}\\cdot\\widehat{\\mathbf{d}}$) does not match the central difference approximation $(\\phi_N-\\phi_P)/\\|\\mathbf{d}\\|$. This discrepancy is prominent on non-orthogonal grids where the cell-center connection line $\\mathbf{d}$ is not parallel to the face normal. This scheme is designed to remain second-order accurate on such grids.\n\n**Numerical Implementation**\nThe program will perform the following steps:\n1.  **Setup**: Define the constant matrix $\\mathbf{K}$ and implement the functions for the manufactured solution $\\phi(x,y)$ and its gradient $\\nabla\\phi(x,y)$.\n2.  **Grid Generation**: For a given grid size $N$ and shear parameter $s$, compute the coordinates of all nodes $(x_{i,j}, y_{j})$ using the mapping $x_{i,j} = i/N + s \\cdot (j/N)$ and $y_j = j/N$. Subsequently, compute the center $\\mathbf{c}_{i,j}$ of each cell $(i,j)$ by averaging its four vertex coordinates.\n3.  **Cell-Center Evaluation**: Evaluate the exact scalar field $\\phi$ and gradient $\\nabla\\phi$ at every cell center $\\mathbf{c}_{i,j}$. Store these values for later use.\n4.  **Face Loop and Flux Calculation**: Iterate over all interior faces of the grid. The interior faces can be categorized into two groups: \"vertical\" faces separating cells $(i,j)$ and $(i+1,j)$, and \"horizontal\" faces separating $(i,j)$ and $(i,j+1)$. For each interior face:\n    a.  Identify the adjacent cells $P$ and $N$ and retrieve their pre-computed center locations and field values ($\\mathbf{c}_P, \\mathbf{c}_N, \\phi_P, \\phi_N, \\nabla\\phi_P, \\nabla\\phi_N$).\n    b.  Determine the face endpoints $\\mathbf{e}_0, \\mathbf{e}_1$ and compute the face center $\\mathbf{f}$, tangent $\\mathbf{t}$, and area vector $\\mathbf{S}_f$. A consistent orientation for $\\mathbf{S}_f$ (e.g., pointing from $P$ to $N$) must be maintained.\n    c.  Calculate the exact flux, $F_{\\text{exact}}$, by evaluating $\\nabla\\phi$ at the face center $\\mathbf{f}$ and computing $F_{\\text{exact}} = -\\mathbf{S}_f^{\\mathsf{T}}\\mathbf{K}\\nabla\\phi(\\mathbf{f})$.\n    d.  Calculate the approximate flux, $F_{\\text{approx}}$, by first computing the approximate face gradient $\\nabla\\phi\\big|_f$ using the derived non-orthogonal correction scheme, and then computing $F_{\\text{approx}} = -\\mathbf{S}_f^{\\mathsf{T}}\\mathbf{K}\\nabla\\phi\\big|_f$.\n    e.  Accumulate the squared error $(F_{\\text{approx}} - F_{\\text{exact}})^2$ and the squared exact flux $(F_{\\text{exact}})^2$.\n5.  **Error Analysis**: After looping through all interior faces, compute the relative $L_2$ error $E_{L_2}$ using the aggregated sums. This procedure is repeated for each specified value of $N$ ($8, 16, 32$).\n6.  **Order of Accuracy**: With the errors $E_{L_2}(N)$ and $E_{L_2}(2N)$ for successive grid refinements, compute the observed order of accuracy $p$.\n7.  **Output**: The final results for $s=0.0$ and $s=0.3$ are collected and printed in the specified format. The scheme is expected to exhibit second-order accuracy ($p \\approx 2$).", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\n# This problem requires no external libraries beyond numpy.\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the numerical experiment as per the problem statement.\n    \"\"\"\n\n    # Global constants defined in the problem\n    K_TENSOR = np.array([[2.0, 0.5], [0.5, 1.5]])\n    PI = np.pi\n\n    def phi_func(x, y):\n        \"\"\"Manufactured scalar field phi(x,y).\"\"\"\n        return np.sin(PI * x) * np.cos(PI * y) + x**2 - y\n\n    def grad_phi_func(x, y):\n        \"\"\"Exact gradient of the manufactured scalar field.\"\"\"\n        grad_x = PI * np.cos(PI * x) * np.cos(PI * y) + 2 * x\n        grad_y = -PI * np.sin(PI * x) * np.sin(PI * y) - 1\n        return np.array([grad_x, grad_y])\n\n    def compute_errors_for_case(N, s):\n        \"\"\"\n        Computes the L2 error for a given grid size N and shear parameter s.\n        \"\"\"\n        # 1. Grid Generation\n        nodes = np.zeros((N + 1, N + 1, 2))\n        xi = np.linspace(0, 1, N + 1)\n        eta = np.linspace(0, 1, N + 1)\n        for j in range(N + 1):\n            for i in range(N + 1):\n                nodes[i, j, 0] = xi[i] + s * eta[j]\n                nodes[i, j, 1] = eta[j]\n\n        cell_centers = np.zeros((N, N, 2))\n        for j in range(N):\n            for i in range(N):\n                cell_centers[i, j] = 0.25 * (\n                    nodes[i, j] + nodes[i + 1, j] +\n                    nodes[i + 1, j + 1] + nodes[i, j + 1]\n                )\n\n        # 2. Evaluate exact values at cell centers\n        phi_at_centers = np.zeros((N, N))\n        grad_phi_at_centers = np.zeros((N, N, 2))\n        for j in range(N):\n            for i in range(N):\n                x_c, y_c = cell_centers[i, j]\n                phi_at_centers[i, j] = phi_func(x_c, y_c)\n                grad_phi_at_centers[i, j] = grad_phi_func(x_c, y_c)\n\n        # 3. Loop over interior faces and calculate fluxes\n        sum_sq_err = 0.0\n        sum_sq_exact = 0.0\n\n        all_faces_info = []\n\n        # Vertical interior faces\n        for j in range(N):\n            for i in range(N - 1):\n                # P = cell (i, j), N_cell = cell (i+1, j)\n                e0, e1 = nodes[i + 1, j], nodes[i + 1, j + 1]\n                all_faces_info.append(((i, j), (i + 1, j), e0, e1))\n\n        # Horizontal interior faces\n        for j in range(N - 1):\n            for i in range(N):\n                # P = cell (i, j), N_cell = cell (i, j+1)\n                # Tangent from right to left for upward normal\n                e0, e1 = nodes[i + 1, j + 1], nodes[i, j + 1]\n                all_faces_info.append(((i, j), (i, j + 1), e0, e1))\n\n        for P_idx, N_idx, e0, e1 in all_faces_info:\n            c_P = cell_centers[P_idx]\n            c_N = cell_centers[N_idx]\n\n            phi_P = phi_at_centers[P_idx]\n            phi_N = phi_at_centers[N_idx]\n            grad_phi_P = grad_phi_at_centers[P_idx]\n            grad_phi_N = grad_phi_at_centers[N_idx]\n\n            f_center = 0.5 * (e0 + e1)\n            t = e1 - e0\n            Sf = np.array([t[1], -t[0]])\n\n            d = c_N - c_P\n            # Ensure Sf points from P to N_cell\n            if np.dot(Sf, d)  0:\n                Sf = -Sf\n\n            # Exact flux calculation\n            grad_phi_f_exact = grad_phi_func(f_center[0], f_center[1])\n            F_exact = -Sf.T @ K_TENSOR @ grad_phi_f_exact\n\n            # Approximate flux calculation with non-orthogonal correction\n            d_norm = np.linalg.norm(d)\n            if d_norm == 0: continue\n            d_hat = d / d_norm\n            grad_phi_avg = 0.5 * (grad_phi_P + grad_phi_N)\n\n            correction_term = (\n                (phi_N - phi_P) / d_norm - np.dot(grad_phi_avg, d_hat)\n            ) * d_hat\n            grad_phi_f_approx = grad_phi_avg + correction_term\n            \n            F_approx = -Sf.T @ K_TENSOR @ grad_phi_f_approx\n            \n            sum_sq_err += (F_approx - F_exact)**2\n            sum_sq_exact += F_exact**2\n\n        # 4. Final L2 error calculation\n        if sum_sq_exact == 0:\n            return 0.0 # Avoid division by zero in trivial cases\n        \n        e_l2 = np.sqrt(sum_sq_err / sum_sq_exact)\n        return e_l2\n\n    def calculate_order(e1, e2, n_ratio=2.0):\n        \"\"\"Calculates the observed order of accuracy.\"\"\"\n        if e1 = 0 or e2 = 0:\n            return np.inf\n        return np.log(e1 / e2) / np.log(n_ratio)\n    \n    # Test cases parameters\n    test_cases = [\n        {'s': 0.0, 'N_values': [8, 16, 32]},\n        {'s': 0.3, 'N_values': [8, 16, 32]},\n    ]\n    \n    final_results = []\n    \n    for case in test_cases:\n        s = case['s']\n        N_values = case['N_values']\n        \n        errors = [compute_errors_for_case(N, s) for N in N_values]\n        \n        final_results.extend(errors)\n        \n        order1 = calculate_order(errors[0], errors[1])\n        order2 = calculate_order(errors[1], errors[2])\n        final_results.append(order1)\n        final_results.append(order2)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{val:.8f}' for val in final_results)}]\")\n\nsolve()\n```", "id": "3316543"}, {"introduction": "Our final practice addresses the complex interaction between an anisotropic material and the computational grid. Here, the conductivity is described by a tensor $\\mathbf{K}$, and its principal axes may not align with the grid lines, creating \"cross-diffusion\" effects where the flux is not parallel to the gradient. This exercise [@problem_id:3316594] demonstrates the failure of a simple Two-Point Flux Approximation (TPFA) in this scenario and introduces the more sophisticated Multi-Point Flux Approximation (MPFA), which uses a wider stencil to accurately capture the physics.", "problem": "Consider a two-dimensional diffusive process governed by Fourier’s law of heat conduction (equivalently, Fick’s law of mass diffusion), which states that the diffusive flux vector is given by $\\mathbf{q}=-\\mathbf{K}\\nabla u$, where $\\mathbf{K}\\in\\mathbb{R}^{2\\times 2}$ is a symmetric, positive definite conductivity tensor and $u:\\mathbb{R}^2\\to\\mathbb{R}$ is a scalar potential with gradient $\\nabla u$. In a finite-volume context, the normal flux across a face with unit normal $\\mathbf{n}_f$ is defined by $q_f=-\\mathbf{n}_f^\\top\\mathbf{K}\\nabla u$. The conductivity tensor is assumed anisotropic with principal values $k_10$ and $k_20$, and principal directions rotated by an angle $\\theta$ relative to a fixed global frame. Let $\\mathbf{R}(\\theta)$ denote the planar rotation by angle $\\theta$, and define the conductivity tensor by $\\mathbf{K}=\\mathbf{R}(\\theta)^\\top\\mathrm{diag}(k_1,k_2)\\,\\mathbf{R}(\\theta)$. The face normal is oriented at an angle $\\varphi$ in the same global frame, i.e., $\\mathbf{n}_f=[\\cos\\varphi,\\sin\\varphi]^\\top$, with tangent $\\mathbf{t}_f=[-\\sin\\varphi,\\cos\\varphi]^\\top$.\n\nTwo numerical flux approximations are to be evaluated:\n- Two-Point Flux Approximation (TPFA): $q_f^{\\mathrm{TPFA}}$ uses only the difference of cell-centered values along the line connecting the two adjacent cell centers and the projection of $\\mathbf{K}$ onto the normal direction.\n- MultiPoint Flux Approximation (MPFA): $q_f^{\\mathrm{MPFA}}$ reconstructs the local gradient using multiple point values to capture both normal and tangential directional derivatives, thereby accounting for cross-coupling introduced by anisotropy and misalignment.\n\nAssume a linear scalar field of the form $u(x,y)=a\\,x+b\\,y$, where $a$ and $b$ are constants, so that $\\nabla u=\\mathbf{g}=[a,b]^\\top$ is constant. Consider a face centered at the origin with unit normal $\\mathbf{n}_f$ and tangent $\\mathbf{t}_f$. Let the two adjacent cell centers be located at positions $\\mathbf{r}_A=-\\frac{d}{2}\\mathbf{n}_f$ and $\\mathbf{r}_B=+\\frac{d}{2}\\mathbf{n}_f$, where $d0$ is the distance between the cell centers along the normal. In addition, define tangential neighbor positions on each side: $\\mathbf{r}_{A,\\pm}=\\mathbf{r}_A\\pm s\\,\\mathbf{t}_f$ and $\\mathbf{r}_{B,\\pm}=\\mathbf{r}_B\\pm s\\,\\mathbf{t}_f$, where $s\\ge 0$ is the tangential offset.\n\nDefine the exact normal flux by $q_f^{\\mathrm{exact}}=-\\mathbf{n}_f^\\top\\mathbf{K}\\mathbf{g}$. Define the Two-Point Flux Approximation by $q_f^{\\mathrm{TPFA}}=-\\left(\\mathbf{n}_f^\\top\\mathbf{K}\\mathbf{n}_f\\right)\\,\\frac{u(\\mathbf{r}_B)-u(\\mathbf{r}_A)}{d}$. Define the MultiPoint Flux Approximation by first constructing directional derivatives\n$$\nD_n=\\frac{u(\\mathbf{r}_B)-u(\\mathbf{r}_A)}{d},\\quad D_t^{(A)}=\\frac{u(\\mathbf{r}_{A,+})-u(\\mathbf{r}_{A,-})}{2s},\\quad D_t^{(B)}=\\frac{u(\\mathbf{r}_{B,+})-u(\\mathbf{r}_{B,-})}{2s},\n$$\nwith the convention that if $s=0$ then $D_t^{(A)}=D_t^{(B)}=0$, and set $D_t=\\frac{D_t^{(A)}+D_t^{(B)}}{2}$. Form the reconstructed gradient $\\widehat{\\nabla u}=D_n\\,\\mathbf{n}_f+D_t\\,\\mathbf{t}_f$, and compute\n$$\nq_f^{\\mathrm{MPFA}}=-\\mathbf{n}_f^\\top\\mathbf{K}\\,\\widehat{\\nabla u}.\n$$\nBy design, for linear $u$ and $s0$, $\\widehat{\\nabla u}$ recovers $\\nabla u$ exactly.\n\nYour task is to implement a program that, for a given set of parameters $(k_1,k_2,\\theta,\\varphi,d,s,a,b)$, computes the pair of absolute errors $\\left|q_f^{\\mathrm{TPFA}}-q_f^{\\mathrm{exact}}\\right|$ and $\\left|q_f^{\\mathrm{MPFA}}-q_f^{\\mathrm{exact}}\\right|$. Use angles in radians. Treat all quantities as dimensionless. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets.\n\nTest Suite:\n- Case $\\mathbf{1}$ (anisotropic but aligned): $(k_1,k_2,\\theta,\\varphi,d,s,a,b)=(2.0,0.5,0.0,0.0,1.0,0.5,1.0,0.5)$.\n- Case $\\mathbf{2}$ (anisotropic, $\\mathbf{K}$ rotated): $(k_1,k_2,\\theta,\\varphi,d,s,a,b)=(2.0,0.5,\\frac{\\pi}{4},0.0,1.0,0.5,1.0,0.5)$.\n- Case $\\mathbf{3}$ (isotropic): $(k_1,k_2,\\theta,\\varphi,d,s,a,b)=(1.0,1.0,\\frac{\\pi}{3},\\frac{\\pi}{4},1.0,0.5,1.0,0.5)$.\n- Case $\\mathbf{4}$ (general misalignment): $(k_1,k_2,\\theta,\\varphi,d,s,a,b)=(3.0,0.7,\\frac{\\pi}{6},\\frac{\\pi}{3},1.2,0.4,1.0,0.5)$.\n- Case $\\mathbf{5}$ (boundary, no tangential neighbors): $(k_1,k_2,\\theta,\\varphi,d,s,a,b)=(2.0,0.5,\\frac{\\pi}{4},\\frac{\\pi}{6},1.0,0.0,1.0,0.5)$.\n\nRequired final output format: Your program should produce a single line of output containing the results for all test cases as a comma-separated list of pairs, each pair itself being a comma-separated list of the two floating-point absolute errors, enclosed in square brackets. For example, an output with three test cases should look like $\\left[[e_{1}^{\\mathrm{TPFA}},e_{1}^{\\mathrm{MPFA}}],[e_{2}^{\\mathrm{TPFA}},e_{2}^{\\mathrm{MPFA}}],[e_{3}^{\\mathrm{TPFA}},e_{3}^{\\mathrm{MPFA}}]\\right]$.", "solution": "The problem requires the calculation of absolute errors for two numerical flux approximations, the Two-Point Flux Approximation (TPFA) and the MultiPoint Flux Approximation (MPFA), relative to an exact analytical flux for a two-dimensional diffusion problem. The problem is well-posed, scientifically sound, and provides all necessary information for a unique solution.\n\nThe analysis begins by formalizing the mathematical constructs provided in the problem statement. All quantities are treated as dimensionless.\n\nFirst, we define the primary vectors and matrices. The scalar field is linear, $u(x,y)=a\\,x+b\\,y$, which implies a constant gradient vector $\\mathbf{g}=\\nabla u = [a,b]^\\top$.\nThe face unit normal vector $\\mathbf{n}_f$ and unit tangent vector $\\mathbf{t}_f$ are defined by the face orientation angle $\\varphi$:\n$$\n\\mathbf{n}_f = \\begin{pmatrix} \\cos\\varphi \\\\ \\sin\\varphi \\end{pmatrix}, \\quad \\mathbf{t}_f = \\begin{pmatrix} -\\sin\\varphi \\\\ \\cos\\varphi \\end{pmatrix}\n$$\nThese two vectors form an orthonormal basis for $\\mathbb{R}^2$.\n\nThe conductivity tensor $\\mathbf{K}$ is defined by its principal conductivities $k_1$ and $k_2$ and the rotation angle $\\theta$ of its principal axes. The rotation matrix $\\mathbf{R}(\\theta)$ and its transpose $\\mathbf{R}(\\theta)^\\top$ are:\n$$\n\\mathbf{R}(\\theta) = \\begin{pmatrix} \\cos\\theta  -\\sin\\theta \\\\ \\sin\\theta  \\cos\\theta \\end{pmatrix}, \\quad \\mathbf{R}(\\theta)^\\top = \\begin{pmatrix} \\cos\\theta  \\sin\\theta \\\\ -\\sin\\theta  \\cos\\theta \\end{pmatrix}\n$$\nThe tensor $\\mathbf{K}$ is given by $\\mathbf{K}=\\mathbf{R}(\\theta)^\\top\\mathrm{diag}(k_1,k_2)\\,\\mathbf{R}(\\theta)$. Performing the matrix multiplication yields the components of $\\mathbf{K}$:\n$$\n\\mathbf{K} = \\begin{pmatrix} k_1\\cos^2\\theta + k_2\\sin^2\\theta  (k_2-k_1)\\sin\\theta\\cos\\theta \\\\ (k_2-k_1)\\sin\\theta\\cos\\theta  k_1\\sin^2\\theta + k_2\\cos^2\\theta \\end{pmatrix}\n$$\nThis is a symmetric matrix, and since $k_1  0$ and $k_2  0$, it is positive definite as required.\n\nWith these definitions, we can derive the expressions for the three fluxes.\n\n**1. Exact Normal Flux, $q_f^{\\mathrm{exact}}$**\n\nThe exact normal flux is defined by $q_f^{\\mathrm{exact}}=-\\mathbf{n}_f^\\top\\mathbf{K}\\mathbf{g}$. This is a direct computation involving matrix-vector multiplication.\n$$\nq_f^{\\mathrm{exact}} = - \\begin{pmatrix} \\cos\\varphi  \\sin\\varphi \\end{pmatrix} \\begin{pmatrix} K_{11}  K_{12} \\\\ K_{21}  K_{22} \\end{pmatrix} \\begin{pmatrix} a \\\\ b \\end{pmatrix}\n$$\n\n**2. Two-Point Flux Approximation, $q_f^{\\mathrm{TPFA}}$**\n\nThe TPFA flux is defined as $q_f^{\\mathrm{TPFA}}=-\\left(\\mathbf{n}_f^\\top\\mathbf{K}\\mathbf{n}_f\\right)\\,\\frac{u(\\mathbf{r}_B)-u(\\mathbf{r}_A)}{d}$. The term $\\frac{u(\\mathbf{r}_B)-u(\\mathbf{r}_A)}{d}$ represents a finite difference approximation of the normal derivative. For a linear scalar field $u(\\mathbf{r}) = \\mathbf{g}^\\top\\mathbf{r} + c$, this term can be computed exactly. Given $\\mathbf{r}_A = -\\frac{d}{2}\\mathbf{n}_f$ and $\\mathbf{r}_B = \\frac{d}{2}\\mathbf{n}_f$:\n$$\nu(\\mathbf{r}_B) - u(\\mathbf{r}_A) = (\\mathbf{g}^\\top\\mathbf{r}_B + c) - (\\mathbf{g}^\\top\\mathbf{r}_A + c) = \\mathbf{g}^\\top(\\mathbf{r}_B - \\mathbf{r}_A) = \\mathbf{g}^\\top(d\\,\\mathbf{n}_f) = d\\,(\\mathbf{g}^\\top\\mathbf{n}_f)\n$$\nTherefore, the finite difference is exact:\n$$\n\\frac{u(\\mathbf{r}_B)-u(\\mathbf{r}_A)}{d} = \\mathbf{g}^\\top\\mathbf{n}_f = \\mathbf{n}_f^\\top\\mathbf{g}\n$$\nSubstituting this back into the TPFA definition, we get:\n$$\nq_f^{\\mathrm{TPFA}} = -\\left(\\mathbf{n}_f^\\top\\mathbf{K}\\mathbf{n}_f\\right) \\left(\\mathbf{n}_f^\\top\\mathbf{g}\\right)\n$$\nThe TPFA flux is the product of an effective normal conductivity, $T_{\\mathrm{eff}} = \\mathbf{n}_f^\\top\\mathbf{K}\\mathbf{n}_f$, and the projection of the gradient onto the face normal, $g_n = \\mathbf{n}_f^\\top\\mathbf{g}$.\n\n**3. MultiPoint Flux Approximation, $q_f^{\\mathrm{MPFA}}$**\n\nThe MPFA flux is $q_f^{\\mathrm{MPFA}}=-\\mathbf{n}_f^\\top\\mathbf{K}\\,\\widehat{\\nabla u}$, where $\\widehat{\\nabla u}$ is a reconstructed gradient.\nThe reconstructed gradient is $\\widehat{\\nabla u}=D_n\\,\\mathbf{n}_f+D_t\\,\\mathbf{t}_f$.\nThe normal derivative component $D_n$ is the same as the one used in TPFA:\n$$\nD_n = \\frac{u(\\mathbf{r}_B)-u(\\mathbf{r}_A)}{d} = \\mathbf{n}_f^\\top\\mathbf{g}\n$$\nThe tangential derivative component $D_t = \\frac{1}{2}(D_t^{(A)} + D_t^{(B)})$ is computed based on values at tangential neighbor locations. Let's analyze the case for $s  0$:\n$$\nD_t^{(A)} = \\frac{u(\\mathbf{r}_{A,+}) - u(\\mathbf{r}_{A,-})}{2s} = \\frac{\\mathbf{g}^\\top(\\mathbf{r}_{A,+}-\\mathbf{r}_{A,-})}{2s} = \\frac{\\mathbf{g}^\\top((\\mathbf{r}_A+s\\mathbf{t}_f)-(\\mathbf{r}_A-s\\mathbf{t}_f))}{2s} = \\frac{\\mathbf{g}^\\top(2s\\mathbf{t}_f)}{2s} = \\mathbf{g}^\\top\\mathbf{t}_f\n$$\nSimilarly, $D_t^{(B)} = \\mathbf{g}^\\top\\mathbf{t}_f$, so $D_t = \\mathbf{g}^\\top\\mathbf{t}_f = \\mathbf{t}_f^\\top\\mathbf{g}$.\nThe reconstructed gradient for $s0$ is:\n$$\n\\widehat{\\nabla u} = (\\mathbf{n}_f^\\top\\mathbf{g})\\,\\mathbf{n}_f + (\\mathbf{t}_f^\\top\\mathbf{g})\\,\\mathbf{t}_f\n$$\nSince $\\{\\mathbf{n}_f, \\mathbf{t}_f\\}$ is an orthonormal basis, this expression is the decomposition of the vector $\\mathbf{g}$ onto this basis. Thus, $\\widehat{\\nabla u} = \\mathbf{g}$. The MPFA scheme exactly reconstructs the gradient for a linear field when $s0$.\nConsequently, for $s  0$:\n$$\nq_f^{\\mathrm{MPFA}} = -\\mathbf{n}_f^\\top\\mathbf{K}\\,\\widehat{\\nabla u} = -\\mathbf{n}_f^\\top\\mathbf{K}\\,\\mathbf{g} = q_f^{\\mathrm{exact}}\n$$\nThis implies that the absolute error for MPFA is zero for all test cases where $s  0$.\n\nNow, consider the case $s=0$. The problem states that if $s=0$, then $D_t^{(A)} = D_t^{(B)} = 0$, which leads to $D_t = 0$.\nThe reconstructed gradient becomes:\n$$\n\\widehat{\\nabla u} = D_n\\,\\mathbf{n}_f = (\\mathbf{n}_f^\\top\\mathbf{g})\\,\\mathbf{n}_f\n$$\nThe MPFA flux is then:\n$$\nq_f^{\\mathrm{MPFA}} = -\\mathbf{n}_f^\\top\\mathbf{K}\\left( (\\mathbf{n}_f^\\top\\mathbf{g})\\,\\mathbf{n}_f \\right) = -(\\mathbf{n}_f^\\top\\mathbf{g}) (\\mathbf{n}_f^\\top\\mathbf{K}\\mathbf{n}_f)\n$$\nThis is identical to the expression for $q_f^{\\mathrm{TPFA}}$. Therefore, when $s=0$, $q_f^{\\mathrm{MPFA}} = q_f^{\\mathrm{TPFA}}$, and their errors will be identical.\n\n**4. Error Calculation**\n\nThe absolute errors are computed as:\n$$\nE_{\\mathrm{TPFA}} = \\left|q_f^{\\mathrm{TPFA}} - q_f^{\\mathrm{exact}}\\right| = \\left| -\\left(\\mathbf{n}_f^\\top\\mathbf{K}\\mathbf{n}_f\\right) \\left(\\mathbf{n}_f^\\top\\mathbf{g}\\right) - (-\\mathbf{n}_f^\\top\\mathbf{K}\\mathbf{g}) \\right| = \\left| \\mathbf{n}_f^\\top\\mathbf{K}\\mathbf{g} - (\\mathbf{n}_f^\\top\\mathbf{K}\\mathbf{n}_f) (\\mathbf{n}_f^\\top\\mathbf{g}) \\right|\n$$\nThe TPFA error is non-zero if $\\mathbf{K}$ has off-diagonal terms when expressed in the $\\{\\mathbf{n}_f, \\mathbf{t}_f\\}$ basis, which occurs when the principal axes of $\\mathbf{K}$ are not aligned with the face normal/tangent.\n\nThe MPFA error is:\n$$\nE_{\\mathrm{MPFA}} = \\left|q_f^{\\mathrm{MPFA}} - q_f^{\\mathrm{exact}}\\right| = \\begin{cases} 0  \\text{if } s  0 \\\\ E_{\\mathrm{TPFA}}  \\text{if } s = 0 \\end{cases}\n$$\n\nThe implementation will follow these derived formulas. For each test case, we construct the $\\mathbf{K}$ matrix and the vectors $\\mathbf{g}$ and $\\mathbf{n}_f$, then compute the fluxes and their differences.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes absolute errors for TPFA and MPFA flux approximations for a set of test cases.\n    \"\"\"\n\n    test_cases = [\n        # (k1, k2, theta, phi, d, s, a, b)\n        (2.0, 0.5, 0.0, 0.0, 1.0, 0.5, 1.0, 0.5),\n        (2.0, 0.5, np.pi/4, 0.0, 1.0, 0.5, 1.0, 0.5),\n        (1.0, 1.0, np.pi/3, np.pi/4, 1.0, 0.5, 1.0, 0.5),\n        (3.0, 0.7, np.pi/6, np.pi/3, 1.2, 0.4, 1.0, 0.5),\n        (2.0, 0.5, np.pi/4, np.pi/6, 1.0, 0.0, 1.0, 0.5),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        k1, k2, theta, phi, d, s, a, b = case\n\n        # --- Define vectors and matrices ---\n\n        # Gradient vector g\n        g = np.array([a, b])\n\n        # Face normal vector n_f\n        n_f = np.array([np.cos(phi), np.sin(phi)])\n\n        # Conductivity tensor K\n        c_theta, s_theta = np.cos(theta), np.sin(theta)\n        K = np.array([\n            [k1 * c_theta**2 + k2 * s_theta**2, (k2 - k1) * s_theta * c_theta],\n            [(k2 - k1) * s_theta * c_theta, k1 * s_theta**2 + k2 * c_theta**2]\n        ])\n\n        # --- Calculate fluxes ---\n\n        # 1. Exact flux\n        # q_f_exact = -n_f^T * K * g\n        q_f_exact = -n_f @ (K @ g)\n\n        # 2. Two-Point Flux Approximation (TPFA)\n        # q_f_tpfa = -(n_f^T * K * n_f) * (n_f^T * g)\n        transmissibility = n_f @ (K @ n_f)\n        grad_normal_proj = n_f @ g\n        q_f_tpfa = -transmissibility * grad_normal_proj\n\n        # --- Calculate errors ---\n\n        # TPFA error\n        error_tpfa = np.abs(q_f_tpfa - q_f_exact)\n\n        # MPFA error\n        # For a linear scalar field u, the MPFA scheme is exact if s > 0.\n        # If s = 0, the MPFA scheme degenerates to the TPFA scheme.\n        if s > 0:\n            error_mpfa = 0.0\n        else: # s == 0\n            error_mpfa = error_tpfa\n        \n        results.append([error_tpfa, error_mpfa])\n\n    # Format the final output string as a list of lists.\n    # e.g., [[err1_tpfa,err1_mpfa],[err2_tpfa,err2_mpfa]]\n    inner_parts = [f\"[{res[0]},{res[1]}]\" for res in results]\n    final_string = f\"[{','.join(inner_parts)}]\"\n    print(final_string)\n\nsolve()\n```", "id": "3316594"}]}