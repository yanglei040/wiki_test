{"hands_on_practices": [{"introduction": "We begin our hands-on exploration with the most fundamental boundary in fluid dynamics: the solid wall. In an inviscid flow, a solid wall acts as a streamline, and this constraint imposes a powerful compatibility condition that must be satisfied by the governing equations. This practice challenges you to derive this condition from the first principles of the Euler equations, revealing a direct link between the pressure gradient normal to the wall, the local flow velocity, and the wall's curvature [@problem_id:3296213]. Mastering this relationship is essential for understanding how geometry shapes the pressure field and for developing robust numerical schemes for complex geometries.", "problem": "Consider a two-dimensional, steady, inviscid, compressible flow governed by the Euler equations adjacent to an adiabatic, impermeable, slip wall. Let the wall be represented locally by a smooth curve $y(x)$, and introduce a local orthonormal frame with unit tangent $\\mathbf{t}$ and outward unit normal $\\mathbf{n}$, where the coordinate $s$ is the arclength along the wall and $n$ is the distance normal to the wall measured into the fluid. The flow velocity $\\mathbf{V}$ decomposes as $\\mathbf{V} = V_t \\mathbf{t} + V_n \\mathbf{n}$, and the slip, impermeable condition imposes $V_n = 0$ on the wall. For a perfect gas with specific heat ratio $\\gamma$ and specific gas constant $R$, the sound speed is $a = \\sqrt{\\gamma R T}$ and the density is $\\rho = p/(R T)$, where $p$ is the static pressure and $T$ is the static temperature. The tangential flow Mach number at the wall is $M_t = V_t/a$.\n\nStarting from the inviscid momentum balance projected onto the normal direction and the kinematics of motion along a curved streamline, derive a compatibility boundary condition that expresses the magnitude of the normal pressure gradient at the wall, $|\\partial p/\\partial n|$, in terms of the flow and wall geometry. Explicitly relate $|\\partial p/\\partial n|$ to the tangential speed $V_t$ and the wall curvature $\\kappa_w$, where the signed curvature is defined by $\\kappa_w = \\mathrm{d}\\theta/\\mathrm{d}s$ with $\\theta(s)$ the tangent angle; equivalently, for a wall given as a graph $y(x)$, the curvature magnitude is\n$$\n|\\kappa_w(x)| = \\frac{|y''(x)|}{\\left(1 + \\left(y'(x)\\right)^2\\right)^{3/2}}.\n$$\nUse only the inviscid steady Euler equations, Newton’s second law, and the ideal-gas relations as the fundamental base.\n\nAlgorithmic task: Implement a program that, for a set of specified test cases, computes the magnitude of the normal pressure gradient at the wall,\n$$\n\\left|\\frac{\\partial p}{\\partial n}\\right| = \\rho \\, V_t^2 \\, |\\kappa_w|,\n$$\nwith $V_t = M_t \\, a$, $a = \\sqrt{\\gamma R T}$, and $\\rho = \\frac{p}{R T}$, using analytic expressions for $y'(x)$ and $y''(x)$ evaluated at a given point $x_0$. All outputs must be expressed in Pascals per meter ($\\mathrm{Pa/m}$). The final numerical answers must be printed rounded to six decimal places.\n\nTest suite:\n- Case A (happy path, flat wall): $y(x) = 0$, $y'(x) = 0$, $y''(x) = 0$, $\\gamma = 1.4$, $R = 287$, $p = 100000$ $\\mathrm{Pa}$, $T = 300$ $\\mathrm{K}$, $M_t = 0.5$, $x_0 = 0$.\n- Case B (gentle curvature via parabola): $y(x) = \\dfrac{x^2}{2R_c}$, $y'(x) = \\dfrac{x}{R_c}$, $y''(x) = \\dfrac{1}{R_c}$ with $R_c = 2.0$ $\\mathrm{m}$, $\\gamma = 1.4$, $R = 287$, $p = 120000$ $\\mathrm{Pa}$, $T = 320$ $\\mathrm{K}$, $M_t = 0.8$, $x_0 = 0$.\n- Case C (transonic curvature via circle): $y(x) = \\sqrt{R_c^2 - x^2}$, $y'(x) = -\\dfrac{x}{\\sqrt{R_c^2 - x^2}}$, $y''(x) = -\\dfrac{1}{\\sqrt{R_c^2 - x^2}} - \\dfrac{x^2}{\\left(R_c^2 - x^2\\right)^{3/2}}$ with $R_c = 1.5$ $\\mathrm{m}$, $\\gamma = 1.4$, $R = 287$, $p = 100000$ $\\mathrm{Pa}$, $T = 300$ $\\mathrm{K}$, $M_t = 1.0$, $x_0 = 0$.\n- Case D (severe curvature and supersonic, mimicking shock interaction risk): $y(x) = \\dfrac{x^2}{2R_c}$, $y'(x) = \\dfrac{x}{R_c}$, $y''(x) = \\dfrac{1}{R_c}$ with $R_c = 0.05$ $\\mathrm{m}$, $\\gamma = 1.4$, $R = 287$, $p = 200000$ $\\mathrm{Pa}$, $T = 300$ $\\mathrm{K}$, $M_t = 2.5$, $x_0 = 0$.\n- Case E (near-stagnation tangential velocity): $y(x) = \\dfrac{x^2}{2R_c}$, $y'(x) = \\dfrac{x}{R_c}$, $y''(x) = \\dfrac{1}{R_c}$ with $R_c = 0.2$ $\\mathrm{m}$, $\\gamma = 1.4$, $R = 287$, $p = 100000$ $\\mathrm{Pa}$, $T = 300$ $\\mathrm{K}$, $M_t = 0.01$, $x_0 = 0$.\n\nYour program should produce a single line of output containing the results for Cases A through E, in order, as a comma-separated list enclosed in square brackets, for example, $[r_A,r_B,r_C,r_D,r_E]$, where each $r_\\cdot$ is the computed value of $|\\partial p/\\partial n|$ in $\\mathrm{Pa/m}$ rounded to six decimal places.", "solution": "The problem is to derive a compatibility boundary condition for the normal pressure gradient at a solid wall for a steady, inviscid, compressible flow, and then to implement a program to compute this gradient for a given set of test cases.\n\n### Derivation of the Normal Pressure Gradient Boundary Condition\n\nThe derivation begins with the steady-state Euler momentum equation for an inviscid fluid, which is a statement of Newton's second law for a fluid element:\n$$\n\\rho (\\mathbf{V} \\cdot \\nabla) \\mathbf{V} = - \\nabla p\n$$\nwhere $\\rho$ is the fluid density, $\\mathbf{V}$ is the velocity vector, and $p$ is the static pressure.\n\nTo analyze the flow near a curved wall, it is advantageous to use a natural coordinate system $(s, n)$, where $s$ is the arclength along a streamline and $n$ is the coordinate normal to the streamline. The velocity vector is tangential to the streamline, so $\\mathbf{V} = V \\mathbf{t}$, where $V$ is the flow speed and $\\mathbf{t}$ is the unit tangent vector.\n\nThe acceleration term, $(\\mathbf{V} \\cdot \\nabla) \\mathbf{V}$, can be decomposed into tangential and normal components. The convective derivative of the velocity vector is given by:\n$$\n(\\mathbf{V} \\cdot \\nabla) \\mathbf{V} = V \\frac{\\partial (V \\mathbf{t})}{\\partial s} = V \\left( \\frac{\\partial V}{\\partial s} \\mathbf{t} + V \\frac{\\partial \\mathbf{t}}{\\partial s} \\right)\n$$\nFrom differential geometry, the derivative of the tangent vector with respect to arclength is related to the streamline curvature $\\kappa$ and the principal unit normal vector $\\mathbf{n}_{cc}$ (which points towards the center of curvature):\n$$\n\\frac{\\partial \\mathbf{t}}{\\partial s} = \\kappa \\mathbf{n}_{cc}\n$$\nThe curvature $\\kappa$ is the reciprocal of the radius of curvature, $\\kappa = 1/R_c$. Substituting this into the acceleration expression yields:\n$$\n(\\mathbf{V} \\cdot \\nabla) \\mathbf{V} = V \\frac{\\partial V}{\\partial s} \\mathbf{t} + \\kappa V^2 \\mathbf{n}_{cc}\n$$\nThe first term represents the change in speed along the streamline, and the second term is the centripetal acceleration required to keep the fluid particle on its curved path.\n\nThe pressure gradient $\\nabla p$ can also be decomposed in this coordinate system. The Euler momentum equation becomes:\n$$\n\\rho \\left( V \\frac{\\partial V}{\\partial s} \\mathbf{t} + \\kappa V^2 \\mathbf{n}_{cc} \\right) = - \\left( \\frac{\\partial p}{\\partial s} \\mathbf{t} + \\frac{\\partial p}{\\partial n} \\mathbf{n}_{cc} \\right)\n$$\nBy equating the vector components in the normal direction $\\mathbf{n}_{cc}$, we obtain the normal momentum balance equation:\n$$\n\\rho \\kappa V^2 = - \\frac{\\partial p}{\\partial n}\n$$\nor\n$$\n\\frac{\\partial p}{\\partial n} = - \\rho \\kappa V^2\n$$\nThis fundamental relation states that a pressure gradient normal to a streamline is necessary to balance the centrifugal force arising from its curvature. The pressure increases in the direction opposite to the center of curvature.\n\nAt a solid, impermeable wall, the flow cannot pass through it, so the normal component of velocity is zero. For an inviscid flow, this implies the wall itself is a streamline. Therefore, at the wall, the flow velocity is purely tangential, $V = V_t$, and the streamline curvature is equal to the wall curvature, $\\kappa = \\kappa_w$. Substituting these into the normal momentum equation gives:\n$$\n\\left. \\frac{\\partial p}{\\partial n} \\right|_{\\text{wall}} = - \\rho_w \\kappa_w V_{t,w}^2\n$$\nThe problem asks for the magnitude of this gradient, $|\\partial p/\\partial n|$. Taking the absolute value, we get:\n$$\n\\left| \\frac{\\partial p}{\\partial n} \\right| = |\\- \\rho_w \\kappa_w V_{t,w}^2|\n$$\nSince density $\\rho$ and $V_t^2$ are non-negative, this simplifies to:\n$$\n\\left| \\frac{\\partial p}{\\partial n} \\right| = \\rho_w V_{t,w}^2 |\\kappa_w|\n$$\nThis is the desired compatibility boundary condition, which relates the normal pressure gradient at the wall to the local density, tangential velocity, and wall curvature.\n\n### Algorithmic Computation\n\nThe algorithmic task is to compute $|\\partial p/\\partial n|$ for several test cases. The problem provides all necessary parameters and relations. The calculation proceeds as follows for each case:\n$1$. The wall curvature magnitude, $|\\kappa_w|$, is calculated at the specified point $x_0$ using the provided formula for a curve $y(x)$:\n$$\n|\\kappa_w(x_0)| = \\frac{|y''(x_0)|}{\\left(1 + \\left(y'(x_0)\\right)^2\\right)^{3/2}}\n$$\n$2$. The fluid density $\\rho$ is calculated using the ideal gas law:\n$$\n\\rho = \\frac{p}{R T}\n$$\n$3$. The speed of sound $a$ is calculated for a perfect gas:\n$$\na = \\sqrt{\\gamma R T}\n$$\n$4$. The tangential velocity $V_t$ is determined from the tangential Mach number $M_t$:\n$$\nV_t = M_t a\n$$\n$5$. Finally, these values are substituted into the derived formula:\n$$\n\\left| \\frac{\\partial p}{\\partial n} \\right| = \\rho V_t^2 |\\kappa_w|\n$$\n\nIt is instructive to substitute the expressions for $\\rho$, $a$, and $V_t$ into the final formula to obtain a simplified expression for verification purposes:\n$$\n\\left| \\frac{\\partial p}{\\partial n} \\right| = \\left( \\frac{p}{R T} \\right) (M_t \\sqrt{\\gamma R T})^2 |\\kappa_w| = \\frac{p}{R T} M_t^2 (\\gamma R T) |\\kappa_w|\n$$\nThe terms $R T$ cancel, yielding a compact and elegant relationship:\n$$\n\\left| \\frac{\\partial p}{\\partial n} \\right| = p \\, \\gamma \\, M_t^2 \\, |\\kappa_w|\n$$\nThis simplified form is useful for checking the results. However, the implementation will follow the full chain of calculations as specified in the problem statement to demonstrate each step.\n\nThe implementation will process the provided test cases, calculating $|\\partial p/\\partial n|$ for each and formatting the results as requested. All physical units are in the SI system, so the resulting pressure gradient will be in Pascals per meter ($\\mathrm{Pa/m}$).", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the magnitude of the normal pressure gradient at a wall\n    for several test cases of compressible, inviscid flow.\n    \"\"\"\n\n    # Test cases are defined as tuples with the following structure:\n    # (p, T, Mt, gamma, R, y_prime_at_x0, y_double_prime_at_x0)\n    # where:\n    # p: static pressure (Pa)\n    # T: static temperature (K)\n    # Mt: tangential Mach number\n    # gamma: specific heat ratio\n    # R: specific gas constant (J/(kg*K))\n    # y_prime_at_x0: value of the first derivative of wall shape y(x) at x0\n    # y_double_prime_at_x0: value of the second derivative of wall shape y(x) at x0\n    \n    test_cases = [\n        # Case A: happy path, flat wall\n        (100000, 300, 0.5, 1.4, 287, 0.0, 0.0),\n        # Case B: gentle curvature via parabola (Rc = 2.0 m)\n        (120000, 320, 0.8, 1.4, 287, 0.0, 1.0 / 2.0),\n        # Case C: transonic curvature via circle (Rc = 1.5 m)\n        (100000, 300, 1.0, 1.4, 287, 0.0, -1.0 / 1.5),\n        # Case D: severe curvature and supersonic (Rc = 0.05 m)\n        (200000, 300, 2.5, 1.4, 287, 0.0, 1.0 / 0.05),\n        # Case E: near-stagnation tangential velocity (Rc = 0.2 m)\n        (100000, 300, 0.01, 1.4, 287, 0.0, 1.0 / 0.2),\n    ]\n\n    results = []\n\n    def calculate_dpdn(p, T, Mt, gamma, R, y_prime_val, y_double_prime_val):\n        \"\"\"Calculates |dp/dn| for a single case.\"\"\"\n        # 1. Calculate the magnitude of the wall curvature |kappa_w|\n        # |kappa_w(x)| = |y''(x)| / (1 + (y'(x))^2)^(3/2)\n        kappa_mag = np.abs(y_double_prime_val) / (1 + y_prime_val**2)**1.5\n\n        # If curvature is zero, the gradient is zero.\n        if kappa_mag == 0:\n            return 0.0\n\n        # 2. Calculate density rho\n        # rho = p / (R * T)\n        rho = p / (R * T)\n\n        # 3. Calculate speed of sound a\n        # a = sqrt(gamma * R * T)\n        a = np.sqrt(gamma * R * T)\n\n        # 4. Calculate tangential velocity Vt\n        # Vt = Mt * a\n        V_t = Mt * a\n\n        # 5. Calculate the magnitude of the normal pressure gradient\n        # |dp/dn| = rho * Vt^2 * |kappa_w|\n        dpdn_mag = rho * V_t**2 * kappa_mag\n        \n        return dpdn_mag\n\n    for case in test_cases:\n        p, T, Mt, gamma, R, y_prime_val, y_double_prime_val = case\n        result = calculate_dpdn(p, T, Mt, gamma, R, y_prime_val, y_double_prime_val)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # The results are rounded to six decimal places.\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```", "id": "3296213"}, {"introduction": "Moving from solid walls to open boundaries, a primary challenge is to allow waves and flow structures to exit the computational domain without generating spurious reflections that contaminate the solution. This exercise delves into the classic Orlanski convective boundary condition, a widely-used method for achieving a non-reflecting or \"absorbing\" outflow. By analyzing the boundary's interaction with plane waves through dispersion relations, you will learn to derive the reflection coefficient and see precisely how the performance depends on tuning a single parameter: the convection speed [@problem_id:3296236]. This practice provides invaluable insight into the design and analysis of non-reflecting boundary conditions, a critical skill for any CFD practitioner.", "problem": "You are to implement and analyze an absorbing outflow boundary condition of Orlanski type for one-dimensional, small-amplitude disturbances in a uniform, compressible flow, within the framework of Computational Fluid Dynamics (CFD). The Orlanski convective boundary condition prescribes a one-way advection condition at the boundary in terms of a user-specified convection speed. Your task is to optimize this convection speed from a dispersion relation and to quantify the consequences of mis-tuning on acoustic feedback.\n\nStart from the following fundamental base:\n- The one-dimensional, linearized equations for small-amplitude disturbances in a uniform mean flow of speed $U$ and speed of sound $a$ admit plane-wave solutions with dispersion relations $ \\omega(k) = k \\, c(k)$, where $k$ is the wavenumber, $\\omega$ is the angular frequency, and $c(k)$ is a branch-dependent phase velocity. For a uniform flow, well-tested facts yield three nondispersive branches with constant $c(k)$:\n  - Right-running acoustic branch: $ \\omega(k) = k \\, (U + a)$.\n  - Left-running acoustic branch: $ \\omega(k) = k \\, (U - a)$.\n  - Convected entropy or vorticity branch: $ \\omega(k) = k \\, U$.\n  Because these branches are nondispersive, the group velocity equals the phase velocity, $ c_g = \\mathrm{d}\\omega/\\mathrm{d}k = c$.\n- An Orlanski-type convective boundary condition imposes a one-way advection at the boundary $x = L$ of the form $ \\partial \\phi / \\partial t + c_b \\, \\partial \\phi / \\partial x = 0$, where $\\phi$ is any disturbance variable and $c_b$ is a user-specified boundary convection speed. For an outgoing plane wave that truly travels at speed $c$ relative to the laboratory frame, perfect absorption requires $c_b = c$. Any mis-tuning $c_b \\neq c$ generates partial reflection.\n\nYou must:\n1. From the dispersion relations above, determine $c$ for the specified branch and parameters $U$ and $a$. Use $c = U + a$ for the right-running acoustic branch, $c = U - a$ for the left-running acoustic branch, and $c = U$ for the convected entropy or vorticity branch.\n2. At $x = L$, consider a right-going incident plane wave $ \\phi^+(x,t) = A \\, \\exp( \\mathrm{i} ( k x - \\omega t ) )$ and a left-going reflected plane wave $ \\phi^-(x,t) = B \\, \\exp( \\mathrm{i} ( -k x - \\omega t ) ) $, both satisfying the same branch dispersion relation. Impose the boundary condition $ \\partial \\phi / \\partial t + c_b \\, \\partial \\phi / \\partial x = 0$ at $x=L$ to derive the complex amplitude reflection coefficient $R = B/A$ in terms of $c_b$ and $c$. Then compute the reflection magnitude $|R|$.\n3. Model a simple scalar acoustic feedback loop by a dimensionless loop gain $G$ that captures all coupling and propagation effects except boundary reflection. Define an instability indicator that equals $1$ if $|R| \\, G \\geq 1$ and equals $0$ otherwise. This indicator represents whether the boundary reflection is strong enough, when combined with the loop gain, to close a positive feedback loop.\n4. For each test case below, compute and return $|R|$ and the instability indicator. All speeds must be treated in units of $\\mathrm{m/s}$, $|R|$ is dimensionless, and $G$ is dimensionless. The final $|R|$ must be rounded to six decimal places. The instability indicator must be an integer $0$ or $1$.\n\nUse the following test suite:\n- Case $1$ (happy path, perfectly tuned for the outgoing acoustic branch): $U = 100\\,\\mathrm{m/s}$, $a = 340\\,\\mathrm{m/s}$, branch $=$ right-running acoustic, choose $c_b$ by tuning to the dispersion relation (that is, take $c_b = \\mathrm{d}\\omega/\\mathrm{d}k$ for the chosen branch), loop gain $G = 1.25$.\n- Case $2$ (mis-tuned to convective speed, significant reflection and potential feedback): $U = 100\\,\\mathrm{m/s}$, $a = 340\\,\\mathrm{m/s}$, branch $=$ right-running acoustic, choose $c_b = U$, loop gain $G = 1.70$.\n- Case $3$ (over-tuned toward the acoustic speed, moderate reflection): $U = 100\\,\\mathrm{m/s}$, $a = 340\\,\\mathrm{m/s}$, branch $=$ right-running acoustic, choose $c_b = U + 0.5\\,a = 270\\,\\mathrm{m/s}$, loop gain $G = 3.50$.\n- Case $4$ (convected entropy or vorticity branch, perfectly tuned): $U = 150\\,\\mathrm{m/s}$, $a = 350\\,\\mathrm{m/s}$, branch $=$ convected entropy/vorticity, choose $c_b$ by tuning to the dispersion relation, loop gain $G = 5.00$.\n- Case $5$ (edge case with extremely small boundary convection speed, near-total reflection): $U = 50\\,\\mathrm{m/s}$, $a = 330\\,\\mathrm{m/s}$, branch $=$ right-running acoustic, choose $c_b = 10\\,\\mathrm{m/s}$, loop gain $G = 0.98$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to one test case and is itself a two-element list $[|R|, \\mathrm{indicator}]$. The reflection magnitude $|R|$ must be rounded to six decimal places, and the instability indicator must be an integer as defined above.\n- For example, the printed line must look like $[[r_1,i_1],[r_2,i_2],\\ldots]$ with no extra text or spaces beyond those necessary for comma separation and brackets.", "solution": "The problem statement is first validated against the required criteria.\n\n### Step 1: Extract Givens\n- **Governing Physics**: One-dimensional, linearized equations for small-amplitude disturbances in a uniform, compressible flow.\n- **Dispersion Relations**: Plane-wave solutions have dispersion relations $ \\omega(k) = k \\, c(k) $. For a uniform flow with speed $U$ and sound speed $a$, three nondispersive branches exist:\n  - Right-running acoustic: $ \\omega(k) = k \\, (U + a) $\n  - Left-running acoustic: $ \\omega(k) = k \\, (U - a) $\n  - Convected entropy or vorticity: $ \\omega(k) = k \\, U $\n- **Group Velocity**: For these branches, group velocity equals phase velocity: $ c_g = \\mathrm{d}\\omega/\\mathrm{d}k = c $.\n- **Boundary Condition**: An Orlanski-type convective boundary condition is imposed at a boundary $x = L$: $ \\partial \\phi / \\partial t + c_b \\, \\partial \\phi / \\partial x = 0 $, where $c_b$ is a user-specified convection speed.\n- **Wave Forms**: At $x = L$, the total disturbance $\\phi$ is a superposition of a right-going incident wave $ \\phi^+(x,t) = A \\, \\exp( \\mathrm{i} ( k x - \\omega t ) ) $ and a left-going reflected wave $ \\phi^-(x,t) = B \\, \\exp( \\mathrm{i} ( -k x - \\omega t ) ) $. Both waves satisfy the same branch dispersion relation.\n- **Task 1**: Determine the characteristic speed $c$ for a given branch and parameters $U$ and $a$.\n- **Task 2**: Derive the complex amplitude reflection coefficient $R = B/A$ and its magnitude $|R|$ in terms of $c_b$ and $c$.\n- **Task 3**: Define an instability indicator. Indicator is $1$ if $|R| \\, G \\geq 1$ and $0$ otherwise, where $G$ is a given dimensionless loop gain.\n- **Task 4**: Compute $|R|$ (rounded to six decimal places) and the instability indicator for five test cases.\n- **Test Cases**:\n  - Case $1$: $U = 100\\,\\mathrm{m/s}$, $a = 340\\,\\mathrm{m/s}$, branch = right-running acoustic, $c_b$ tuned to the dispersion relation, loop gain $G = 1.25$.\n  - Case $2$: $U = 100\\,\\mathrm{m/s}$, $a = 340\\,\\mathrm{m/s}$, branch = right-running acoustic, $c_b = U$, loop gain $G = 1.70$.\n  - Case $3$: $U = 100\\,\\mathrm{m/s}$, $a = 340\\,\\mathrm{m/s}$, branch = right-running acoustic, $c_b = U + 0.5\\,a = 270\\,\\mathrm{m/s}$, loop gain $G = 3.50$.\n  - Case $4$: $U = 150\\,\\mathrm{m/s}$, $a = 350\\,\\mathrm{m/s}$, branch = convected entropy/vorticity, $c_b$ tuned to the dispersion relation, loop gain $G = 5.00$.\n  - Case $5$: $U = 50\\,\\mathrm{m/s}$, $a = 330\\,\\mathrm{m/s}$, branch = right-running acoustic, $c_b = 10\\,\\mathrm{m/s}$, loop gain $G = 0.98$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is evaluated based on the predefined criteria.\n- **Scientifically Grounded**: The problem is based on fundamental principles of wave propagation and fluid dynamics. The linearized compressible flow equations, dispersion relations for uniform flow, and the Orlanski boundary condition are standard, well-established concepts in acoustics and computational fluid dynamics. The formulation is scientifically sound and free of pseudoscience.\n- **Well-Posed**: The problem is clearly defined. The derivation of the reflection coefficient is a standard mathematical physics exercise with a unique solution given the setup. All necessary parameters and conditions for each test case are provided, making the problem self-contained and admitting a unique, stable, and meaningful solution.\n- **Objective**: The problem is stated using precise, formal, and unbiased language. It is free of subjective claims or opinions.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. It is a well-posed, scientifically grounded problem in applied physics. I will now proceed with the solution.\n\n### Derivation of the Reflection Coefficient Magnitude\nThe total disturbance $\\phi(x,t)$ is the sum of the incident and reflected waves:\n$$ \\phi(x,t) = \\phi^+(x,t) + \\phi^-(x,t) = A \\, \\exp( \\mathrm{i} ( k x - \\omega t ) ) + B \\, \\exp( \\mathrm{i} ( -k x - \\omega t ) ) $$\nThe Orlanski boundary condition at the boundary $x=L$ is:\n$$ \\frac{\\partial \\phi}{\\partial t} + c_b \\frac{\\partial \\phi}{\\partial x} = 0 \\quad \\text{at } x=L $$\nWe compute the partial derivatives of $\\phi(x,t)$ and evaluate them at $x=L$:\n$$ \\frac{\\partial \\phi}{\\partial t} \\bigg|_{x=L} = - \\mathrm{i} \\omega A \\, \\exp( \\mathrm{i} ( k L - \\omega t ) ) - \\mathrm{i} \\omega B \\, \\exp( \\mathrm{i} ( -k L - \\omega t ) ) $$\n$$ \\frac{\\partial \\phi}{\\partial x} \\bigg|_{x=L} = \\mathrm{i} k A \\, \\exp( \\mathrm{i} ( k L - \\omega t ) ) - \\mathrm{i} k B \\, \\exp( \\mathrm{i} ( -k L - \\omega t ) ) $$\nSubstituting these into the boundary condition equation:\n$$ [-\\mathrm{i} \\omega A e^{\\mathrm{i} kL} - \\mathrm{i} \\omega B e^{-\\mathrm{i} kL}] + c_b [\\mathrm{i} k A e^{\\mathrm{i} kL} - \\mathrm{i} k B e^{-\\mathrm{i} kL}] = 0 $$\nThe common factor $\\exp(-\\mathrm{i}\\omega t)$ has been cancelled. Now, we group terms by amplitudes $A$ and $B$:\n$$ A e^{\\mathrm{i} kL} (-\\mathrm{i} \\omega + \\mathrm{i} k c_b) + B e^{-\\mathrm{i} kL} (-\\mathrm{i} \\omega - \\mathrm{i} k c_b) = 0 $$\nWe solve for the reflection coefficient $R = B/A$:\n$$ B e^{-\\mathrm{i} kL} (-\\mathrm{i} \\omega - \\mathrm{i} k c_b) = - A e^{\\mathrm{i} kL} (-\\mathrm{i} \\omega + \\mathrm{i} k c_b) $$\n$$ \\frac{B}{A} = - \\frac{e^{\\mathrm{i} kL}}{e^{-\\mathrm{i} kL}} \\frac{-\\mathrm{i} \\omega + \\mathrm{i} k c_b}{-\\mathrm{i} \\omega - \\mathrm{i} k c_b} = - e^{2\\mathrm{i} kL} \\frac{\\mathrm{i}(k c_b - \\omega)}{-\\mathrm{i}(k c_b + \\omega)} = e^{2\\mathrm{i} kL} \\frac{k c_b - \\omega}{k c_b + \\omega} $$\nThe incident wave satisfies the dispersion relation $\\omega = k c$, where $c$ is the constant phase (and group) velocity for the specific branch. Substituting $\\omega = k c$ into the expression for $R$:\n$$ R = e^{2\\mathrm{i} kL} \\frac{k c_b - k c}{k c_b + k c} = e^{2\\mathrm{i} kL} \\frac{k(c_b - c)}{k(c_b + c)} = e^{2\\mathrm{i} kL} \\frac{c_b - c}{c_b + c} $$\nThe problem requires the reflection magnitude, $|R|$. Since $|e^{2\\mathrm{i} kL}| = 1$ and the speeds $c$ and $c_b$ are real quantities:\n$$ |R| = \\left| \\frac{c_b - c}{c_b + c} \\right| $$\nThis formula shows that perfect absorption, $|R|=0$, is achieved only when the boundary convection speed $c_b$ is perfectly tuned to the wave's propagation speed $c$. Any mismatch results in a non-zero reflection.\n\n### Instability Criterion\nThe instability indicator is defined as $1$ if the product of the reflection magnitude $|R|$ and the loop gain $G$ is greater than or equal to $1$, and $0$ otherwise.\n$$ \\mathrm{indicator} = \\begin{cases} 1 & \\text{if } |R| \\cdot G \\geq 1 \\\\ 0 & \\text{if } |R| \\cdot G < 1 \\end{cases} $$\n\n### Analysis of Test Cases\n\n**Case 1**:\n- Parameters: $U = 100\\,\\mathrm{m/s}$, $a = 340\\,\\mathrm{m/s}$, branch is right-running acoustic, $G = 1.25$.\n- True wave speed $c = U+a = 100 + 340 = 440\\,\\mathrm{m/s}$.\n- Boundary speed $c_b$ is tuned to the dispersion relation, so $c_b = c = 440\\,\\mathrm{m/s}$.\n- Reflection magnitude: $|R| = \\left| \\frac{440 - 440}{440 + 440} \\right| = \\left| \\frac{0}{880} \\right| = 0.0$.\n- Instability check: $|R| \\cdot G = 0.0 \\times 1.25 = 0.0$. Since $0.0 < 1$, the indicator is $0$.\n- Result: $[0.000000, 0]$.\n\n**Case 2**:\n- Parameters: $U = 100\\,\\mathrm{m/s}$, $a = 340\\,\\mathrm{m/s}$, branch is right-running acoustic, $G = 1.70$.\n- True wave speed $c = U+a = 440\\,\\mathrm{m/s}$.\n- Boundary speed is mis-tuned to the mean flow speed: $c_b = U = 100\\,\\mathrm{m/s}$.\n- Reflection magnitude: $|R| = \\left| \\frac{100 - 440}{100 + 440} \\right| = \\left| \\frac{-340}{540} \\right| = \\frac{34}{54} = \\frac{17}{27} \\approx 0.6296296...$. Rounded to six decimal places, $|R| = 0.629630$.\n- Instability check: $|R| \\cdot G = \\frac{17}{27} \\times 1.70 = \\frac{17}{27} \\times \\frac{17}{10} = \\frac{289}{270} \\approx 1.070 > 1$. The indicator is $1$.\n- Result: $[0.629630, 1]$.\n\n**Case 3**:\n- Parameters: $U = 100\\,\\mathrm{m/s}$, $a = 340\\,\\mathrm{m/s}$, branch is right-running acoustic, $G = 3.50$.\n- True wave speed $c = U+a = 440\\,\\mathrm{m/s}$.\n- Boundary speed is over-tuned: $c_b = U + 0.5 a = 100 + 0.5 \\times 340 = 100 + 170 = 270\\,\\mathrm{m/s}$.\n- Reflection magnitude: $|R| = \\left| \\frac{270 - 440}{270 + 440} \\right| = \\left| \\frac{-170}{710} \\right| = \\frac{17}{71} \\approx 0.2394366...$. Rounded to six decimal places, $|R| = 0.239437$.\n- Instability check: $|R| \\cdot G = \\frac{17}{71} \\times 3.50 = \\frac{17}{71} \\times \\frac{7}{2} = \\frac{119}{142} \\approx 0.838 < 1$. The indicator is $0$.\n- Result: $[0.239437, 0]$.\n\n**Case 4**:\n- Parameters: $U = 150\\,\\mathrm{m/s}$, $a = 350\\,\\mathrm{m/s}$, branch is convected entropy/vorticity, $G = 5.00$.\n- True wave speed $c = U = 150\\,\\mathrm{m/s}$.\n- Boundary speed $c_b$ is tuned to the dispersion relation, so $c_b = c = 150\\,\\mathrm{m/s}$.\n- Reflection magnitude: $|R| = \\left| \\frac{150 - 150}{150 + 150} \\right| = \\left| \\frac{0}{300} \\right| = 0.0$.\n- Instability check: $|R| \\cdot G = 0.0 \\times 5.00 = 0.0$. Since $0.0 < 1$, the indicator is $0$.\n- Result: $[0.000000, 0]$.\n\n**Case 5**:\n- Parameters: $U = 50\\,\\mathrm{m/s}$, $a = 330\\,\\mathrm{m/s}$, branch is right-running acoustic, $G = 0.98$.\n- True wave speed $c = U+a = 50 + 330 = 380\\,\\mathrm{m/s}$.\n- Boundary speed is set to an extremely small value: $c_b = 10\\,\\mathrm{m/s}$.\n- Reflection magnitude: $|R| = \\left| \\frac{10 - 380}{10 + 380} \\right| = \\left| \\frac{-370}{390} \\right| = \\frac{37}{39} \\approx 0.9487179...$. Rounded to six decimal places, $|R| = 0.948718$.\n- Instability check: $|R| \\cdot G = \\frac{37}{39} \\times 0.98 = \\frac{37}{39} \\times \\frac{49}{50} = \\frac{1813}{1950} \\approx 0.9297 < 1$. The indicator is $0$.\n- Result: $[0.948718, 0]$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# No other libraries outside the Python standard library are permitted.\n\ndef solve():\n    \"\"\"\n    Computes the reflection magnitude and instability indicator for an\n    Orlanski-type boundary condition across several test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {\n            \"U\": 100, \"a\": 340, \"branch\": \"right-running acoustic\", \n            \"cb_mode\": \"tuned\", \"G\": 1.25\n        },\n        {\n            \"U\": 100, \"a\": 340, \"branch\": \"right-running acoustic\", \n            \"cb_mode\": (\"fixed\", 100), \"G\": 1.70\n        },\n        {\n            \"U\": 100, \"a\": 340, \"branch\": \"right-running acoustic\", \n            \"cb_mode\": (\"fixed\", 270), \"G\": 3.50\n        },\n        {\n            \"U\": 150, \"a\": 350, \"branch\": \"convected entropy/vorticity\", \n            \"cb_mode\": \"tuned\", \"G\": 5.00\n        },\n        {\n            \"U\": 50, \"a\": 330, \"branch\": \"right-running acoustic\", \n            \"cb_mode\": (\"fixed\", 10), \"G\": 0.98\n        },\n    ]\n\n    results = []\n    for case in test_cases:\n        U = case[\"U\"]\n        a = case[\"a\"]\n        branch = case[\"branch\"]\n        cb_mode = case[\"cb_mode\"]\n        G = case[\"G\"]\n\n        # 1. Determine the true wave speed 'c' from the dispersion relation.\n        c = 0.0\n        if branch == \"right-running acoustic\":\n            c = U + a\n        elif branch == \"left-running acoustic\":\n            c = U - a\n        elif branch == \"convected entropy/vorticity\":\n            c = U\n\n        # Determine the boundary convection speed 'c_b'.\n        c_b = 0.0\n        if cb_mode == \"tuned\":\n            c_b = c\n        elif isinstance(cb_mode, tuple) and cb_mode[0] == \"fixed\":\n            c_b = cb_mode[1]\n\n        # 2. Compute the reflection magnitude |R|.\n        # Formula: |R| = |(c_b - c) / (c_b + c)|\n        # Handle potential division by zero, although not expected with given data.\n        if abs(c_b + c)  1e-9:\n            # This case corresponds to an ill-posed B.C. and implies total reflection.\n            R_mag = 1.0\n        else:\n            R_mag = abs((c_b - c) / (c_b + c))\n        \n        # 3. Compute the instability indicator.\n        # Indicator is 1 if |R|*G >= 1, and 0 otherwise.\n        is_unstable = 1 if R_mag * G >= 1 else 0\n\n        # Store the formatted result for this case.\n        results.append([f\"{R_mag:.6f}\", is_unstable])\n\n    # Final print statement in the exact required format.\n    # Manually construct the string to avoid spaces added by str(list).\n    # e.g., '[[0.000000,0],[0.629630,1],...]'\n    output_strings = [f\"[{r},{i}]\" for r, i in results]\n    print(f\"[{','.join(output_strings)}]\")\n\nsolve()\n```", "id": "3296236"}, {"introduction": "This final practice synthesizes our understanding of boundary conditions by examining their global impact on a complete flow problem: the placement of a normal shock in a Laval nozzle. You will contrast a simple supersonic outflow extrapolation with a more sophisticated characteristic-based boundary condition, modeling their behavior using an acoustic impedance analogy [@problem_id:3296195]. By implementing a quasi-one-dimensional solver, you will directly observe how the reflectivity of the outlet boundary dictates the final steady-state position of the shock wave, providing a vivid demonstration of how a local numerical choice can have profound consequences on the global physics of the simulated flow.", "problem": "A one-dimensional quasi-steady analysis of compressible flow through a converging-diverging Laval nozzle is to be implemented to contrast the numerical impact of two outflow boundary conditions on shock placement, post-shock pressure recovery, and wave reflections. The nozzle geometry is specified by an area distribution $A(x)$ along the axial coordinate $x \\in [0,L]$ with throat at $x_{\\mathrm{t}}$ and exit at $x_{\\mathrm{e}}$. The flow is assumed inviscid, calorically perfect gas with constant ratio of specific heats $\\gamma$, and ideal gas constant normalized to unity, so that $a^2 = \\gamma T$ with speed of sound $a$, static temperature $T$, and the static equation of state $p = \\rho T$. Stagnation (total) quantities at the inlet are $p_0$ and $T_0$, with normalized values $p_0 = 1$ and $T_0 = 1$. The nozzle area is given by $A(x) = 1 + 2.2\\,(x - 1.5)^2$ for $x \\in [0,3]$, so that $L = 3$, $x_{\\mathrm{t}} = 1.5$, $A(x_{\\mathrm{t}}) = 1$, and $A(x_{\\mathrm{e}}) = A(3) = 5.95$.\n\nThe algorithm must begin from first principles. Use the one-dimensional inviscid Euler equations and their quasi-one-dimensional specialization with area variation to reason about isentropic flow relations, normal shock relations, and characteristic-based boundary behavior. From the conservation laws and the assumption of locally isentropic regions separated by a single normal shock, construct the area–Mach number relationship for an isentropic streamtube and the stagnation-to-static relations for pressure and temperature. Across a normal shock, use the Rankine–Hugoniot conditions derived from conservation of mass, momentum, and energy to relate upstream Mach number $M_1$ to downstream Mach number $M_2$ and the pressure jump $p_2/p_1$. At an outlet boundary, use linearized one-dimensional acoustics to define the acoustic impedance $Z = \\rho a$ of the outgoing medium and the reflection coefficient $R = (Z_{\\mathrm{b}} - Z)/(Z_{\\mathrm{b}} + Z)$ for a boundary with impedance $Z_{\\mathrm{b}}$, where $Z_{\\mathrm{b}} \\to \\infty$ approximates a hard reflection (supersonic outflow extrapolation acting like a high-impedance termination) and $Z_{\\mathrm{b}} = Z$ approximates a perfectly non-reflecting termination (characteristic outflow that matches the incoming characteristic).\n\nDefine the two boundary conditions to be compared:\n- Supersonic outflow extrapolation boundary condition: approximate the outlet as a high-impedance termination with $Z_{\\mathrm{b}} \\gg Z$, which implies a strong reflection with $R \\approx 1$.\n- Characteristic outflow boundary condition: approximate the outlet as impedance-matched with $Z_{\\mathrm{b}} = Z$, which implies minimal reflection with $R \\approx 0$.\n\nLet the external back pressure be $p_{\\mathrm{b}}$ and let a small-amplitude outgoing acoustic wave of amplitude $p_{\\mathrm{w}}$ impinge on the outlet. Model the effective outlet pressure felt by the internal flow as $p_{\\mathrm{eff}} = p_{\\mathrm{b}} + R\\,p_{\\mathrm{w}}$, where $R$ depends on the chosen boundary condition.\n\nFor a candidate shock location $x_{\\mathrm{s}} \\in (x_{\\mathrm{t}}, x_{\\mathrm{e}})$, compute:\n1. The supersonic upstream Mach number $M_1$ at $x_{\\mathrm{s}}$ using the area–Mach relation on the supersonic branch, taking the isentropic path from the throat ($A^* = A(x_{\\mathrm{t}})$).\n2. The upstream static pressure $p_1$ from $p_0$ and $M_1$ using isentropic relations derived from the Euler equations and the ideal gas law.\n3. The downstream Mach number $M_2$ and static pressure $p_2$ at $x_{\\mathrm{s}}$ by applying the Rankine–Hugoniot relations for a normal shock.\n4. The downstream stagnation pressure $p_{0,2}$ at $x_{\\mathrm{s}}$ from $p_2$ and $M_2$ using isentropic relations in the post-shock region.\n5. The isentropic subsonic evolution from $x_{\\mathrm{s}}$ to the exit $x_{\\mathrm{e}}$: determine the effective post-shock $A^*$ for the subsonic branch from $M_2$ at $A(x_{\\mathrm{s}})$, then find $M_{\\mathrm{e}}$ at $A(x_{\\mathrm{e}})$ on the subsonic branch and compute the exit static pressure $p_{\\mathrm{e}}$ from $p_{0,2}$ and $M_{\\mathrm{e}}$.\n\nDefine the steady shock location $x_{\\mathrm{s}}$ for a given $p_{\\mathrm{eff}}$ as the root of the scalar equation $p_{\\mathrm{e}}(x_{\\mathrm{s}}) - p_{\\mathrm{eff}} = 0$ over the interval $(x_{\\mathrm{t}}, x_{\\mathrm{e}})$, acknowledging that a physically admissible shock exists only when $p_{\\mathrm{eff}}$ exceeds the perfectly expanded supersonic exit pressure obtained from the supersonic branch without a shock.\n\nMeasurements to report for each boundary condition on each test case:\n- Downstream shock location $x_{\\mathrm{s}}$ as a float (use $-1.0$ if no internal shock exists).\n- Pressure recovery across the shock $p_2/p_1$ as a float (use $1.0$ if no internal shock exists).\n- Reflection coefficient magnitude $R$ as a float.\n\nAll quantities are nondimensionalized by the inlet stagnation values, so no physical units are required. Angles are not used.\n\nImplement a complete, runnable program that:\n- Computes the above using numerical root finding for the shock location when it exists, and falls back to reporting no-shock metrics otherwise.\n- Uses the acoustic impedance model to compute $R$ for each boundary condition; approximate $Z_{\\mathrm{b}}$ for supersonic outflow extrapolation as a large multiple of the local medium impedance $Z$ to model a high-impedance termination, and use $Z_{\\mathrm{b}} = Z$ for characteristic outflow.\n- Aggregates the results for the specified test suite into the exact final output format.\n\nTest suite parameters to cover typical, near-boundary, and edge scenarios:\n- Case $1$: $\\gamma = 1.4$, $p_0 = 1$, $p_{\\mathrm{b}} = 0.12$, $p_{\\mathrm{w}} = 0.01$.\n- Case $2$: $\\gamma = 1.4$, $p_0 = 1$, $p_{\\mathrm{b}} = 0.05$, $p_{\\mathrm{w}} = 0.008$.\n- Case $3$: $\\gamma = 1.4$, $p_0 = 1$, $p_{\\mathrm{b}} = 0.03$, $p_{\\mathrm{w}} = 0.005$.\n\nFinal output format requirement:\n- Your program should produce a single line of output containing a list of lists, one sublist per test case, each sublist in the order $[x_{\\mathrm{s}}^{\\mathrm{extrap}}, x_{\\mathrm{s}}^{\\mathrm{char}}, (p_2/p_1)^{\\mathrm{extrap}}, (p_2/p_1)^{\\mathrm{char}}, R^{\\mathrm{extrap}}, R^{\\mathrm{char}}]$, with all numbers printed as Python floats. For example, a single line like $[[v_{11},v_{12},v_{13},v_{14},v_{15},v_{16}],[v_{21},v_{22},v_{23},v_{24},v_{25},v_{26}],[v_{31},v_{32},v_{33},v_{34},v_{35},v_{36}]]$.", "solution": "The problem requires a one-dimensional, quasi-steady analysis of compressible flow in a Laval nozzle to determine the location of a normal shock under different outflow boundary conditions. The solution is constructed from the fundamental principles of gas dynamics.\n\n### I. Governing Principles for Isentropic Flow\nThe flow is modeled as inviscid and for a calorically perfect gas. In regions without shocks, the flow is isentropic. The relationship between stagnation and static properties is governed by the Mach number $M = u/a$, where $u$ is the flow velocity and $a = \\sqrt{\\gamma T}$ is the local speed of sound. Given the normalized inlet stagnation pressure $p_0=1$ and temperature $T_0=1$, the local static pressure $p$ and temperature $T$ are:\n$$ \\frac{p_0}{p} = \\left( 1 + \\frac{\\gamma-1}{2} M^2 \\right)^{\\frac{\\gamma}{\\gamma-1}} \\implies p = \\left( 1 + \\frac{\\gamma-1}{2} M^2 \\right)^{-\\frac{\\gamma}{\\gamma-1}} $$\n$$ \\frac{T_0}{T} = 1 + \\frac{\\gamma-1}{2} M^2 \\implies T = \\left( 1 + \\frac{\\gamma-1}{2} M^2 \\right)^{-1} $$\nwhere $\\gamma$ is the ratio of specific heats.\n\nFor quasi-one-dimensional flow, conservation of mass and momentum under isentropic conditions leads to the area-Mach number relation, which connects the local cross-sectional area $A$ to the Mach number $M$. The relation is referenced to the sonic throat area $A^*$, where $M=1$:\n$$ \\frac{A}{A^*} = \\frac{1}{M} \\left[ \\frac{2}{\\gamma+1} \\left(1 + \\frac{\\gamma-1}{2} M^2 \\right) \\right]^{\\frac{\\gamma+1}{2(\\gamma-1)}} $$\nThis equation is transcendental in $M$ and must be solved numerically. For a given area ratio $A/A^*  1$, there exist two solutions for $M$: one subsonic ($M1$) and one supersonic ($M1$). The nozzle geometry is given by $A(x) = 1 + 2.2(x-1.5)^2$, with the throat at $x_{\\mathrm{t}}=1.5$ where $A(x_{\\mathrm{t}})=1$. Since the inlet is a large reservoir, we assume the flow chokes at the throat, so the reference sonic area for the flow upstream of any shock is $A^*=A(x_{\\mathrm{t}})=1$.\n\n### II. Normal Shock Relations\nIf a normal shock occurs, there is an abrupt, non-isentropic change in flow properties. The relationships across the shock (Rankine-Hugoniot conditions) are derived from the conservation of mass, momentum, and energy. Subscript $1$ denotes conditions immediately upstream of the shock, and subscript $2$ denotes conditions immediately downstream.\nThe downstream Mach number $M_2$ is a function of the upstream Mach number $M_1$:\n$$ M_2^2 = \\frac{M_1^2 + \\frac{2}{\\gamma-1}}{\\frac{2\\gamma}{\\gamma-1}M_1^2 - 1} $$\nA shock can only form in supersonic flow ($M_1  1$), and the flow downstream is always subsonic ($M_2  1$).\nThe static pressure ratio across the shock, which represents the pressure recovery, is:\n$$ \\frac{p_2}{p_1} = \\frac{2\\gamma}{\\gamma+1}M_1^2 - \\frac{\\gamma-1}{\\gamma+1} $$\nAcross the shock, stagnation pressure is lost. The new downstream stagnation pressure $p_{0,2}$ can be found from the local static properties $(p_2, M_2)$ via the isentropic relation:\n$$ p_{0,2} = p_2 \\left( 1 + \\frac{\\gamma-1}{2} M_2^2 \\right)^{\\frac{\\gamma}{\\gamma-1}} $$\n\n### III. Modeling the Flow with an Internal Shock\nTo find the steady shock location $x_{\\mathrm{s}}$ for a given effective back pressure $p_{\\mathrm{eff}}$, we construct a function $p_{\\mathrm{e}}(x_{\\mathrm{s}})$ that calculates the nozzle exit pressure resulting from a shock at location $x_{\\mathrm{s}}$. The correct $x_{\\mathrm{s}}$ is the root of the equation $p_{\\mathrm{e}}(x_{\\mathrm{s}}) - p_{\\mathrm{eff}} = 0$.\n\nThe algorithm to compute $p_{\\mathrm{e}}(x_{\\mathrm{s}})$ for a candidate shock location $x_{\\mathrm{s}} \\in (x_{\\mathrm{t}}, x_{\\mathrm{e}})$ is as follows:\n1.  **Upstream Isentropic Flow**: For a given $x_{\\mathrm{s}}$, calculate the area $A(x_{\\mathrm{s}})$. Since the flow is isentropic from the throat to the shock, the area ratio is $A(x_{\\mathrm{s}})/A(x_{\\mathrm{t}})$. Solve the area-Mach number relation for the supersonic Mach number $M_1$ at $x_{\\mathrm{s}}$.\n2.  **Pre-Shock Static Pressure**: Calculate the static pressure $p_1$ just before the shock using the isentropic pressure relation with $M_1$ and $p_0=1$.\n3.  **Normal Shock Jump**: Apply the Rankine-Hugoniot relations to find the post-shock Mach number $M_2$ and static pressure $p_2$.\n4.  **Post-Shock Stagnation Pressure**: Calculate the post-shock stagnation pressure $p_{0,2}$ from $p_2$ and $M_2$.\n5.  **Downstream Isentropic Flow**: The flow from $x_{\\mathrm{s}}$ to the exit $x_{\\mathrm{e}}$ is subsonic and isentropic, governed by the stagnation pressure $p_{0,2}$. This new isentropic flow has a different effective sonic area, $A_{2}^*$. We find $A_{2}^*$ by applying the area-Mach relation at $x_{\\mathrm{s}}$ with area $A(x_{\\mathrm{s}})$ and Mach number $M_2$.\n6.  **Exit Conditions**: Using the area ratio $A(x_{\\mathrm{e}})/A_{2}^*$ (where $x_{\\mathrm{e}}=3$), solve the area-Mach relation for the subsonic exit Mach number $M_{\\mathrm{e}}$.\n7.  **Exit Static Pressure**: Calculate the exit pressure $p_{\\mathrm{e}}$ using the isentropic pressure relation with $M_{\\mathrm{e}}$ and the post-shock stagnation pressure $p_{0,2}$. This is the value of $p_{\\mathrm{e}}(x_{\\mathrm{s}})$.\n\n### IV. Outflow Boundary Condition Model\nThe problem introduces an acoustic model for the outlet boundary to determine the effective back pressure $p_{\\mathrm{eff}}$.\n-   **Acoustic Impedance**: $Z = \\rho a$.\n-   **Reflection Coefficient**: $R = (Z_{\\mathrm{b}} - Z)/(Z_{\\mathrm{b}} + Z)$, where $Z_{\\mathrm{b}}$ is the impedance of the external medium.\n-   **Effective Back Pressure**: $p_{\\mathrm{eff}} = p_{\\mathrm{b}} + R \\, p_{\\mathrm{w}}$, where $p_{\\mathrm{b}}$ is the ambient back pressure and $p_{\\mathrm{w}}$ is the amplitude of an outgoing acoustic wave.\n\nThe two boundary conditions are modeled as follows:\n1.  **Supersonic Outflow Extrapolation**: This corresponds to a high-impedance termination, $Z_{\\mathrm{b}} \\gg Z$. We model this by setting $Z_{\\mathrm{b}} = K Z$ with a large constant $K$ (e.g., $K=10^6$). The reflection coefficient is $R^{\\mathrm{extrap}} = (K-1)/(K+1) \\approx 1$.\n2.  **Characteristic Outflow**: This corresponds to a perfectly non-reflecting boundary, $Z_{\\mathrm{b}} = Z$. The reflection coefficient is $R^{\\mathrm{char}} = (1-1)/(1+1) = 0$.\n\n### V. Numerical Solution Algorithm\nFor each test case $(\\gamma, p_{\\mathrm{b}}, p_{\\mathrm{w}})$ and for each boundary condition type:\n1.  **Calculate $R$ and $p_{\\mathrm{eff}}$**: Determine the reflection coefficient $R$ and the effective pressure $p_{\\mathrm{eff}}$ for the boundary condition.\n2.  **Check for Shock Existence**: A normal shock exists inside the diverging section only if $p_{\\mathrm{eff}}$ lies within a specific range.\n    -   The minimum pressure, $p_{\\mathrm{min}}$, corresponds to fully supersonic flow to the exit (shock downstream of exit). This is found by solving the area-Mach relation for the supersonic $M_{\\mathrm{e}}$ at $A(x_{\\mathrm{e}})$ and computing the corresponding isentropic static pressure.\n    -   The maximum pressure, $p_{\\mathrm{max}}$, corresponds to fully subsonic flow throughout the nozzle. This is found by solving the area-Mach relation for the subsonic $M_{\\mathrm{e}}$ at $A(x_{\\mathrm{e}})$ and computing its isentropic static pressure.\n    -   If $p_{\\mathrm{min}}  p_{\\mathrm{eff}}  p_{\\mathrm{max}}$, a shock exists. Otherwise, no internal shock is formed, and we report default values ($x_{\\mathrm{s}} = -1.0, p_2/p_1 = 1.0$).\n3.  **Find Shock Location**: If a shock is expected, solve the nonlinear equation $p_{\\mathrm{e}}(x_{\\mathrm{s}}) - p_{\\mathrm{eff}} = 0$ for $x_{\\mathrm{s}}$ over the interval $(x_{\\mathrm{t}}, x_{\\mathrm{e}})$, i.e., $(1.5, 3.0)$. A numerical root-finding method like the Brent-Dekker method is suitable.\n4.  **Compute Metrics**: Once the shock location $x_{\\mathrm{s}}$ is found, re-evaluate the flow conditions at $x_{\\mathrm{s}}$ to compute the pressure recovery ratio $p_2/p_1$.\n5.  **Aggregate and Report**: Collect the computed values ($x_{\\mathrm{s}}$, $p_2/p_1$, $|R|$) for each boundary condition and test case, and format the output as specified.\n\nThe implementation will rely on numerical root-finders to solve for Mach numbers from the area ratio and for the shock location from the pressure matching condition.", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Solves the 1D quasi-steady compressible flow problem in a Laval nozzle\n    for different outflow boundary conditions.\n    \"\"\"\n\n    test_cases = [\n        # (gamma, p_b, p_w)\n        (1.4, 0.12, 0.01),\n        (1.4, 0.05, 0.008),\n        (1.4, 0.03, 0.005),\n    ]\n\n    # Nozzle geometry\n    nozzle_area = lambda x: 1.0 + 2.2 * (x - 1.5)**2\n    x_throat = 1.5\n    x_exit = 3.0\n\n    # Approximations for boundary conditions\n    K_extrap = 1e6  # Large factor for high-impedance approximation\n\n    # Helper function for area-Mach relation residual\n    def area_mach_residual(M, A_ratio, gamma):\n        if M == 0:\n            return -np.inf\n        term1 = 2 / (gamma + 1)\n        term2 = 1 + (gamma - 1) / 2 * M**2\n        return (A_ratio**2) - (1 / M**2) * (term1 * term2)**((gamma + 1) / (gamma - 1))\n\n    # Helper function to get Mach from Area Ratio\n    def get_mach_from_area_ratio(A_ratio, gamma, branch='supersonic'):\n        try:\n            if branch == 'supersonic':\n                # Search for M  1\n                return brentq(area_mach_residual, 1.00001, 10.0, args=(A_ratio, gamma))\n            else: # subsonic\n                # Search for M  1\n                return brentq(area_mach_residual, 1e-6, 0.99999, args=(A_ratio, gamma))\n        except ValueError:\n            return np.nan\n\n    # Main function to calculate exit pressure given a shock location\n    def calculate_exit_pressure(x_s, gamma):\n        p0 = 1.0\n        A_t = nozzle_area(x_throat)\n        \n        # 1. Upstream Isentropic Flow\n        A_s = nozzle_area(x_s)\n        A_ratio_1 = A_s / A_t\n        M1 = get_mach_from_area_ratio(A_ratio_1, gamma, branch='supersonic')\n        if np.isnan(M1): return np.nan\n        \n        # 2. Pre-Shock Static Pressure\n        p1 = p0 * (1 + (gamma - 1) / 2 * M1**2)**(-gamma / (gamma - 1))\n\n        # 3. Normal Shock Jump\n        M1_sq = M1**2\n        M2_sq = (M1_sq + 2 / (gamma - 1)) / (2 * gamma / (gamma - 1) * M1_sq - 1)\n        M2 = np.sqrt(M2_sq)\n        p2 = p1 * (1 + 2 * gamma / (gamma + 1) * (M1_sq - 1))\n\n        # 4. Post-Shock Stagnation Pressure\n        p0_2 = p2 * (1 + (gamma - 1) / 2 * M2**2)**(gamma / (gamma - 1))\n\n        # 5. Downstream Isentropic Flow (find effective A*)\n        # Using area-mach relation at shock location with post-shock conditions\n        gm1 = gamma - 1\n        gp1 = gamma + 1\n        term = (1/M2) * ( (2/gp1) * (1 + gm1/2*M2**2) )**(gp1/(2*gm1))\n        A2_star = A_s / term\n\n        # 6. Exit Conditions\n        A_e = nozzle_area(x_exit)\n        A_ratio_2 = A_e / A2_star\n        M_e = get_mach_from_area_ratio(A_ratio_2, gamma, branch='subsonic')\n        if np.isnan(M_e): return np.nan\n\n        # 7. Exit Static Pressure\n        p_e = p0_2 * (1 + (gamma - 1) / 2 * M_e**2)**(-gamma / (gamma - 1))\n        \n        return p_e\n\n    # Residual for shock location root finding\n    def shock_location_residual(x_s, p_target, gamma):\n        p_e = calculate_exit_pressure(x_s, gamma)\n        if np.isnan(p_e):\n            # Penalize invalid x_s values to guide the solver\n            return 1e9 * (x_s - x_throat)\n        return p_e - p_target\n\n    final_results = []\n    \n    for gamma, p_b, p_w in test_cases:\n        p0 = 1.0\n        A_t = nozzle_area(x_throat)\n        A_e = nozzle_area(x_exit)\n        A_ratio_exit = A_e / A_t\n\n        # Calculate pressure bounds for shock existence\n        M_e_sup = get_mach_from_area_ratio(A_ratio_exit, gamma, branch='supersonic')\n        p_min = p0 * (1 + (gamma - 1) / 2 * M_e_sup**2)**(-gamma / (gamma - 1))\n\n        M_e_sub = get_mach_from_area_ratio(A_ratio_exit, gamma, branch='subsonic')\n        p_max = p0 * (1 + (gamma - 1) / 2 * M_e_sub**2)**(-gamma / (gamma - 1))\n        \n        case_results = []\n        \n        # Define BCs and their parameters\n        bcs = {\n            'extrap': {'K': K_extrap},\n            'char': {'K': 1.0}\n        }\n        \n        results_map = {}\n\n        for name, params in bcs.items():\n            K = params['K']\n            R = (K - 1) / (K + 1)\n            p_eff = p_b + R * p_w\n\n            if not (p_min  p_eff  p_max):\n                x_s_sol = -1.0\n                p_recovery = 1.0\n            else:\n                try:\n                    # Use a narrow but safe interval away from singularities\n                    x_s_sol = brentq(shock_location_residual, x_throat + 1e-6, x_exit - 1e-6, args=(p_eff, gamma))\n\n                    A_s_sol = nozzle_area(x_s_sol)\n                    A_ratio_sol = A_s_sol / A_t\n                    M1_sol = get_mach_from_area_ratio(A_ratio_sol, gamma, branch='supersonic')\n                    p_recovery = 1 + 2 * gamma / (gamma + 1) * (M1_sol**2 - 1)\n                except ValueError:\n                    # Root not bracketed, implies pressure is outside shock regime\n                    x_s_sol = -1.0\n                    p_recovery = 1.0\n            \n            results_map[name] = {\n                'xs': x_s_sol,\n                'pr': p_recovery,\n                'R': abs(R)\n            }\n        \n        # Assemble sublist in the required order\n        case_results.extend([\n            results_map['extrap']['xs'],\n            results_map['char']['xs'],\n            results_map['extrap']['pr'],\n            results_map['char']['pr'],\n            results_map['extrap']['R'],\n            results_map['char']['R']\n        ])\n        \n        final_results.append(case_results)\n\n    print(str(final_results).replace(\" \", \"\"))\n\nsolve()\n```", "id": "3296195"}]}