{"hands_on_practices": [{"introduction": "Before running any complex fluid simulation, it is essential to understand the fundamental trade-offs between accuracy, stability, and computational cost. This practice provides a foundational analysis of a finite difference scheme, focusing on how the choice of grid spacing impacts both the accuracy of the discrete equations and the stability of the time-stepping algorithm. By deriving the truncation error and the stability bound for the viscous term on an anisotropic grid, you will develop a core understanding of the constraints that govern practical CFD simulations [@problem_id:3340070].", "problem": "Consider the two-dimensional incompressible Navier–Stokes equations in a square lid-driven cavity of side length $L$, with the top lid moving at uniform velocity $U$ in the $x$-direction and no-slip boundary conditions on all walls. A standard projection method is employed to enforce incompressibility: an explicit viscous update produces a provisional velocity field, and then a pressure Poisson problem is solved to project this field onto the divergence-free subspace. The spatial discretization uses second-order centered finite differences on a uniform but anisotropic Cartesian grid with spacings $\\Delta x \\neq \\Delta y$, where $\\Delta x = L/N_{x}$ and $\\Delta y = L/N_{y}$ for given positive integers $N_{x}$ and $N_{y}$. The discrete Laplacian for a scalar field $\\phi$ at interior node $(i,j)$ is defined by\n$$\n(\\nabla_{h}^{2}\\phi)_{i,j} \\equiv \\frac{\\phi_{i+1,j} - 2\\phi_{i,j} + \\phi_{i-1,j}}{\\Delta x^{2}} + \\frac{\\phi_{i,j+1} - 2\\phi_{i,j} + \\phi_{i,j-1}}{\\Delta y^{2}}.\n$$\nStarting from the partial differential equation model and the above discrete operator, perform the following:\n\n(1) Derive the leading-order truncation error of the discrete Laplacian $(\\nabla_{h}^{2}\\phi)_{i,j}$ in terms of continuous derivatives of $\\phi$, explicitly exhibiting the dependence on $\\Delta x$ and $\\Delta y$.\n\n(2) Consider the explicit forward Euler update for the viscous term applied to each component of velocity,\n$$\n\\boldsymbol{u}^{*} = \\boldsymbol{u}^{n} + \\nu\\,\\Delta t\\,\\nabla_{h}^{2}\\boldsymbol{u}^{n},\n$$\nwhere $\\nu$ is the kinematic viscosity and $\\Delta t$ the time step. Using a modal (eigenvalue) analysis of the discrete Laplacian with homogeneous Dirichlet boundary conditions on the cavity walls, derive a stability bound for $\\Delta t$ that depends on $\\Delta x$ and $\\Delta y$. Explain how anisotropy ($\\Delta x \\neq \\Delta y$) enters into this bound.\n\n(3) Justify, using a discrete inner-product argument, why the Helmholtz–Hodge projection step is non-expansive in an appropriate discrete $\\ell^{2}$ norm and therefore does not further restrict the explicit viscous stability bound derived in part $(2)$ when using compatible centered differencing for divergence and gradient.\n\nFinally, for a cavity with $L = 0.1$ $\\mathrm{m}$, $N_{x} = 128$, $N_{y} = 64$, and $\\nu = 1.0 \\times 10^{-6}$ $\\mathrm{m}^{2}/\\mathrm{s}$, compute the maximum stable $\\Delta t$ for the explicit viscous update you derived in part $(2)$. Express your final time step in seconds and round your answer to four significant figures.", "solution": "This problem addresses the numerical analysis of a finite difference scheme for the incompressible Navier-Stokes equations, focusing on truncation error, stability, and the properties of the projection method. We shall address each part of the problem in sequence.\n\n(1) Truncation Error of the Discrete Laplacian\n\nThe truncation error, $\\tau_{i,j}$, of the discrete Laplacian operator, $(\\nabla_{h}^{2}\\phi)_{i,j}$, is defined as the difference between the discrete operator applied to the continuous field $\\phi(x,y)$ and the exact continuous Laplacian operator applied to the same field, evaluated at the grid point $(x_i, y_j)$.\n$$\n\\tau_{i,j} = (\\nabla_{h}^{2}\\phi)_{i,j} - (\\nabla^{2}\\phi)(x_i, y_j)\n$$\nThe continuous Laplacian is $\\nabla^{2}\\phi = \\frac{\\partial^{2}\\phi}{\\partial x^{2}} + \\frac{\\partial^{2}\\phi}{\\partial y^{2}}$. The given discrete Laplacian is\n$$\n(\\nabla_{h}^{2}\\phi)_{i,j} = \\frac{\\phi_{i+1,j} - 2\\phi_{i,j} + \\phi_{i-1,j}}{\\Delta x^{2}} + \\frac{\\phi_{i,j+1} - 2\\phi_{i,j} + \\phi_{i,j-1}}{\\Delta y^{2}}\n$$\nTo find the truncation error, we perform a Taylor series expansion of the terms $\\phi_{i\\pm1, j}$ and $\\phi_{i, j\\pm1}$ around the point $(x_i, y_j)$, assuming $\\phi$ is sufficiently smooth. For the $x$-derivatives, we have:\n$$\n\\phi_{i+1,j} = \\phi(x_i+\\Delta x, y_j) = \\phi_{i,j} + \\Delta x\\frac{\\partial\\phi}{\\partial x} + \\frac{\\Delta x^{2}}{2!}\\frac{\\partial^{2}\\phi}{\\partial x^{2}} + \\frac{\\Delta x^{3}}{3!}\\frac{\\partial^{3}\\phi}{\\partial x^{3}} + \\frac{\\Delta x^{4}}{4!}\\frac{\\partial^{4}\\phi}{\\partial x^{4}} + O(\\Delta x^{5})\n$$\n$$\n\\phi_{i-1,j} = \\phi(x_i-\\Delta x, y_j) = \\phi_{i,j} - \\Delta x\\frac{\\partial\\phi}{\\partial x} + \\frac{\\Delta x^{2}}{2!}\\frac{\\partial^{2}\\phi}{\\partial x^{2}} - \\frac{\\Delta x^{3}}{3!}\\frac{\\partial^{3}\\phi}{\\partial x^{3}} + \\frac{\\Delta x^{4}}{4!}\\frac{\\partial^{4}\\phi}{\\partial x^{4}} + O(\\Delta x^{5})\n$$\nAdding these two expansions cancels the odd-order derivative terms:\n$$\n\\phi_{i+1,j} + \\phi_{i-1,j} = 2\\phi_{i,j} + \\Delta x^{2}\\frac{\\partial^{2}\\phi}{\\partial x^{2}} + \\frac{2\\Delta x^{4}}{24}\\frac{\\partial^{4}\\phi}{\\partial x^{4}} + O(\\Delta x^{6})\n$$\nRearranging this expression to match the form of the discrete derivative gives:\n$$\n\\frac{\\phi_{i+1,j} - 2\\phi_{i,j} + \\phi_{i-1,j}}{\\Delta x^{2}} = \\frac{\\partial^{2}\\phi}{\\partial x^{2}} + \\frac{\\Delta x^{2}}{12}\\frac{\\partial^{4}\\phi}{\\partial x^{4}} + O(\\Delta x^{4})\n$$\nAn identical analysis for the $y$-direction yields:\n$$\n\\frac{\\phi_{i,j+1} - 2\\phi_{i,j} + \\phi_{i,j-1}}{\\Delta y^{2}} = \\frac{\\partial^{2}\\phi}{\\partial y^{2}} + \\frac{\\Delta y^{2}}{12}\\frac{\\partial^{4}\\phi}{\\partial y^{2}} + O(\\Delta y^{4})\n$$\nSubstituting these expressions back into the definition of the discrete Laplacian, we obtain:\n$$\n(\\nabla_{h}^{2}\\phi)_{i,j} = \\left(\\frac{\\partial^{2}\\phi}{\\partial x^{2}} + \\frac{\\partial^{2}\\phi}{\\partial y^{2}}\\right) + \\frac{\\Delta x^{2}}{12}\\frac{\\partial^{4}\\phi}{\\partial x^{4}} + \\frac{\\Delta y^{2}}{12}\\frac{\\partial^{4}\\phi}{\\partial y^{2}} + O(\\Delta x^{4}, \\Delta y^{4})\n$$\nThe term in the parenthesis is the continuous Laplacian, $\\nabla^{2}\\phi$. Therefore, the leading-order truncation error is:\n$$\n\\tau_{i,j} = \\frac{\\Delta x^{2}}{12}\\frac{\\partial^{4}\\phi}{\\partial x^{4}} + \\frac{\\Delta y^{2}}{12}\\frac{\\partial^{4}\\phi}{\\partial y^{2}}\n$$\nThe discretization is second-order accurate in space, with the error explicitly dependent on the grid spacings $\\Delta x$ and $\\Delta y$.\n\n(2) Stability Bound for the Explicit Viscous Update\n\nThe stability of the explicit forward Euler scheme for the viscous term, $\\boldsymbol{u}^{*} = \\boldsymbol{u}^{n} + \\nu\\,\\Delta t\\,\\nabla_{h}^{2}\\boldsymbol{u}^{n}$, is analyzed by examining the amplification of discrete error modes. The analysis is identical for each velocity component, so we consider a scalar field $u$. A modal analysis requires finding the eigenvalues of the discrete Laplacian operator $\\nabla_{h}^{2}$ with homogeneous Dirichlet boundary conditions.\n\nAn eigenmode of the operator on the discrete domain can be written as $u_{i,j} = \\sin(k_x x_i) \\sin(k_y y_j)$, where $x_i = i\\Delta x$ and $y_j = j\\Delta y$. The wavenumbers are $k_x = m\\pi/L$ and $k_y = p\\pi/L$, for integers $m \\in [1, N_x-1]$ and $p \\in [1, N_y-1]$. Applying the discrete Laplacian to this mode yields:\n$$\n(\\nabla_{h}^{2}u)_{i,j} = \\left( \\frac{\\sin(k_x(i+1)\\Delta x) - 2\\sin(k_x i\\Delta x) + \\sin(k_x(i-1)\\Delta x)}{\\Delta x^2} \\right)\\sin(k_y j\\Delta y) + \\sin(k_x i\\Delta x)\\left( \\frac{\\sin(k_y(j+1)\\Delta y) - 2\\sin(k_y j\\Delta y) + \\sin(k_y(j-1)\\Delta y)}{\\Delta y^2} \\right)\n$$\nUsing the trigonometric identity $\\sin(A+B)+\\sin(A-B) = 2\\sin(A)\\cos(B)$, the numerator of the $x$-term simplifies to $2\\sin(k_x i\\Delta x)\\cos(k_x\\Delta x) - 2\\sin(k_x i\\Delta x) = 2\\sin(k_x i\\Delta x)(\\cos(k_x\\Delta x)-1)$. With the half-angle identity $\\cos(\\theta)-1 = -2\\sin^2(\\theta/2)$, this becomes $-4\\sin(k_x i\\Delta x)\\sin^2(k_x\\Delta x/2)$. A similar result holds for the $y$-term.\nThus, the application of the operator results in:\n$$\n(\\nabla_{h}^{2}u)_{i,j} = \\left[ -\\frac{4}{\\Delta x^2}\\sin^2\\left(\\frac{k_x\\Delta x}{2}\\right) - \\frac{4}{\\Delta y^2}\\sin^2\\left(\\frac{k_y\\Delta y}{2}\\right) \\right] u_{i,j}\n$$\nThe expression in brackets is the eigenvalue, $\\lambda_{m,p}$, corresponding to the mode $(m,p)$. Substituting an eigenmode into the time-stepping scheme gives $u^{n+1} = (1 + \\nu\\Delta t \\lambda_{m,p})u^n$. The amplification factor is $G = 1 + \\nu\\Delta t \\lambda_{m,p}$. For stability, we require $|G| \\leq 1$, which means $-1 \\leq 1 + \\nu\\Delta t \\lambda_{m,p} \\leq 1$.\nThe eigenvalues $\\lambda_{m,p}$ are strictly negative for any non-trivial mode, so the condition $G \\leq 1$ is always satisfied. The remaining condition is $-1 \\leq 1 + \\nu\\Delta t \\lambda_{m,p}$, which implies $\\nu\\Delta t \\lambda_{m,p} \\geq -2$, or $\\Delta t \\leq \\frac{-2}{\\nu\\lambda_{m,p}}$.\n\nTo ensure stability for all possible modes, we must satisfy this condition for the eigenvalue with the largest magnitude (the most negative eigenvalue), which we denote $\\lambda_{min}$. This occurs for the highest frequency modes the grid can support, where the $\\sin^2$ terms are maximized. The arguments are $\\frac{k_x\\Delta x}{2} = \\frac{m\\pi}{L}\\frac{L/N_x}{2} = \\frac{m\\pi}{2N_x}$ and $\\frac{k_y\\Delta y}{2} = \\frac{p\\pi}{2N_y}$. The maximum value of $\\sin^2$ is $1$, which is approached as the argument approaches $\\pi/2$. This corresponds to the highest wavenumbers, $m=N_x-1$ and $p=N_y-1$, for which $k_x \\approx \\pi/\\Delta x$ and $k_y \\approx \\pi/\\Delta y$. For these \"worst-case\" modes, $\\sin^2(k_x\\Delta x/2) \\approx 1$ and $\\sin^2(k_y\\Delta y/2) \\approx 1$.\nThe most negative eigenvalue is thus approximately:\n$$\n\\lambda_{min} \\approx -\\frac{4}{\\Delta x^2} - \\frac{4}{\\Delta y^2}\n$$\nThe stability condition becomes:\n$$\n\\Delta t \\leq \\frac{-2}{\\nu(-\\frac{4}{\\Delta x^2} - \\frac{4}{\\Delta y^2})} = \\frac{1}{2\\nu(\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2})}\n$$\nAnisotropy ($\\Delta x \\neq \\Delta y$) enters directly into this bound. The stability limit is determined by the sum of the inverse squared grid spacings. If one grid spacing is much smaller than the other (e.g., $\\Delta x \\ll \\Delta y$), the term with the smaller spacing ($1/\\Delta x^2$) will dominate the sum, making the time step restriction much more severe. The stability is effectively governed by the smallest grid cell dimension in the mesh.\n\n(3) Non-Expansive Nature of the Projection Step\n\nThe projection step decomposes the provisional velocity field $\\boldsymbol{u}^*$ into a divergence-free part $\\boldsymbol{u}^{n+1}$ and the gradient of a scalar potential $\\phi$ (related to pressure), such that $\\boldsymbol{u}^* = \\boldsymbol{u}^{n+1} + \\nabla_h \\phi$. By construction, $\\nabla_h \\cdot \\boldsymbol{u}^{n+1} = 0$. The question is to show that this projection is non-expansive in the discrete $\\ell^2$ norm, i.e., $\\|\\boldsymbol{u}^{n+1}\\|_2 \\leq \\|\\boldsymbol{u}^*\\|_2$.\n\nThe squared $\\ell^2$ norm is defined via the inner product, $\\|\\boldsymbol{v}\\|_2^2 = \\langle \\boldsymbol{v}, \\boldsymbol{v} \\rangle = \\sum_{i,j} \\boldsymbol{v}_{i,j} \\cdot \\boldsymbol{v}_{i,j} \\Delta x \\Delta y$. We evaluate the squared norm of $\\boldsymbol{u}^*$:\n$$\n\\|\\boldsymbol{u}^*\\|^2 = \\langle \\boldsymbol{u}^{n+1} + \\nabla_h \\phi, \\boldsymbol{u}^{n+1} + \\nabla_h \\phi \\rangle = \\|\\boldsymbol{u}^{n+1}\\|^2 + 2\\langle\\boldsymbol{u}^{n+1}, \\nabla_h \\phi\\rangle + \\|\\nabla_h \\phi\\|^2\n$$\nThe crucial step is to analyze the cross-term $\\langle\\boldsymbol{u}^{n+1}, \\nabla_h \\phi\\rangle$. Using the property of summation by parts, which is the discrete analogue of integration by parts, and assuming compatible finite difference operators for the gradient ($\\nabla_h$) and divergence ($\\nabla_h \\cdot$), the inner product can be rewritten. For discrete operators satisfying the negative adjoint relationship $\\langle \\boldsymbol{v}, \\nabla_h \\psi \\rangle = -\\langle \\nabla_h \\cdot \\boldsymbol{v}, \\psi \\rangle$ (with boundary terms vanishing under appropriate conditions), we have:\n$$\n\\langle\\boldsymbol{u}^{n+1}, \\nabla_h \\phi\\rangle = -\\langle\\nabla_h \\cdot \\boldsymbol{u}^{n+1}, \\phi\\rangle\n$$\nBy the definition of the projection, the resulting velocity field $\\boldsymbol{u}^{n+1}$ is discretely divergence-free, so $\\nabla_h \\cdot \\boldsymbol{u}^{n+1} = 0$. Consequently, the inner product is zero:\n$$\n\\langle\\boldsymbol{u}^{n+1}, \\nabla_h \\phi\\rangle = 0\n$$\nThis demonstrates that the space of discrete divergence-free fields and the space of discrete gradient fields are orthogonal under this inner product. The decomposition is orthogonal.\nSubstituting this result back into the expression for $\\|\\boldsymbol{u}^*\\|^2$ gives:\n$$\n\\|\\boldsymbol{u}^*\\|^2 = \\|\\boldsymbol{u}^{n+1}\\|^2 + \\|\\nabla_h \\phi\\|^2\n$$\nThis is a discrete form of the Pythagorean theorem. Since the squared norm $\\|\\nabla_h \\phi\\|^2$ is non-negative, it follows directly that:\n$$\n\\|\\boldsymbol{u}^{n+1}\\|^2 \\leq \\|\\boldsymbol{u}^*\\|^2\n$$\nTaking the square root of both sides, we find $\\|\\boldsymbol{u}^{n+1}\\|_2 \\leq \\|\\boldsymbol{u}^*\\|_2$. This confirms that the projection step is non-expansive. It does not amplify the norm of the velocity field. Therefore, the stability of the overall scheme is governed solely by the explicit viscous (and advective, if present) updates, and the projection step does not impose any additional, more restrictive stability constraint.\n\nFinal Calculation\n\nWe are asked to compute the maximum stable time step $\\Delta t_{max}$ for the given parameters. The formula is:\n$$\n\\Delta t_{max} = \\frac{1}{2\\nu\\left(\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2}\\right)}\n$$\nThe given values are $L = 0.1\\,\\mathrm{m}$, $N_x = 128$, $N_y = 64$, and $\\nu = 1.0 \\times 10^{-6}\\,\\mathrm{m^2/s}$.\nFirst, we compute the grid spacings:\n$$\n\\Delta x = \\frac{L}{N_x} = \\frac{0.1\\,\\mathrm{m}}{128}\n$$\n$$\n\\Delta y = \\frac{L}{N_y} = \\frac{0.1\\,\\mathrm{m}}{64}\n$$\nNext, we calculate the inverse squared spacings:\n$$\n\\frac{1}{\\Delta x^2} = \\left(\\frac{128}{0.1}\\right)^2 = 1280^2 = 1,638,400\\,\\mathrm{m}^{-2}\n$$\n$$\n\\frac{1}{\\Delta y^2} = \\left(\\frac{64}{0.1}\\right)^2 = 640^2 = 409,600\\,\\mathrm{m}^{-2}\n$$\nThe sum is:\n$$\n\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2} = 1,638,400 + 409,600 = 2,048,000\\,\\mathrm{m}^{-2}\n$$\nNow, we substitute this into the stability formula:\n$$\n\\Delta t_{max} = \\frac{1}{2(1.0 \\times 10^{-6}\\,\\mathrm{m^2/s})(2,048,000\\,\\mathrm{m}^{-2})} = \\frac{1}{2 \\times 10^{-6} \\times 2.048 \\times 10^{6}\\,\\mathrm{s}^{-1}} = \\frac{1}{4.096\\,\\mathrm{s}^{-1}}\n$$\nPerforming the final division:\n$$\n\\Delta t_{max} = 0.244140625\\,\\mathrm{s}\n$$\nRounding to four significant figures as requested, we obtain:\n$$\n\\Delta t_{max} \\approx 0.2441\\,\\mathrm{s}\n$$", "answer": "$$\\boxed{0.2441}$$", "id": "3340070"}, {"introduction": "The overall accuracy of a CFD simulation is often limited not by the discretization in the interior of the domain, but by the treatment of boundary conditions. This is particularly true for the streamfunction-vorticity formulation, where the vorticity at solid walls is not known a priori and must be computed as part of the solution. This exercise guides you through the derivation of a second-order accurate wall vorticity condition, a classic technique that significantly improves the fidelity of near-wall flow predictions and the calculation of surface shear stress [@problem_id:3340086].", "problem": "Consider the two-dimensional incompressible lid-driven cavity in a square domain of height $H$, discretized on a uniform Cartesian mesh of spacing $h$ in both directions. Use the streamfunction–vorticity formulation of the incompressible Navier–Stokes equations, where the streamfunction $\\psi(x,y)$ satisfies the kinematic relations $u = \\frac{\\partial \\psi}{\\partial y}$ and $v = -\\frac{\\partial \\psi}{\\partial x}$, and the scalar vorticity $\\omega(x,y)$ is defined by $\\omega = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y}$. The streamfunction–vorticity kinematic constraint is $\\nabla^{2} \\psi = - \\omega$, which holds in the entire domain. On all solid walls, the no-penetration condition implies that the streamfunction is constant along the wall; take $\\psi = \\psi_{w}$ on the top lid $y = H$. The top lid moves with a constant tangential velocity $U$ in the $x$-direction, so that $u(x,H) = U$ and $v(x,H) = 0$.\n\nLet $j$ index grid lines in the $y$-direction, with $j = N$ denoting the top wall at $y = H$, $j = N - 1$ the first interior line at $y = H - h$, and $j = N - 2$ the second interior line at $y = H - 2h$. Similarly, let $i$ index grid lines in the $x$-direction. Denote $\\psi_{i,N} = \\psi(x_{i},H)$, $\\psi_{i,N-1} = \\psi(x_{i},H-h)$, and $\\psi_{i,N-2} = \\psi(x_{i},H-2h)$.\n\nStarting from the fundamental definitions above and using Taylor expansions in the wall-normal direction about $y = H$, construct a second-order accurate discrete boundary condition for the top-wall vorticity $\\omega_{i,N} = \\omega(x_{i},H)$ in terms of the quantities $\\psi_{i,N}$, $\\psi_{i,N-1}$, $\\psi_{i,N-2}$, the grid spacing $h$, and the lid speed $U$. Your construction must:\n\n- Use only the definitions $u = \\frac{\\partial \\psi}{\\partial y}$, $v = -\\frac{\\partial \\psi}{\\partial x}$, $\\omega = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y}$, and $\\nabla^{2} \\psi = - \\omega$, together with smoothness (existence of the required derivatives).\n- Enforce consistency to second order in $h$ by explicitly canceling all terms up to order $h$ in the Taylor series remainder for the wall-normal expansion.\n- Explain why $\\psi_{xx}(x,H) = 0$ under no-penetration on the top wall and how this simplifies the relation between $\\omega$ and $\\psi$ at the wall.\n\nThen, analyze the stability and impact of your boundary condition on the computed near-wall vorticity by addressing the following points from first principles:\n\n- Consistency: Show that your boundary condition recovers the exact wall vorticity for any flow whose near-wall streamwise velocity $u(y)$ is linear in $y$ and for uniform lid motion $u(x,H) = U$, $v(x,H) = 0$.\n- Stability: Argue, using an energy or enstrophy-based reasoning for viscous flows, why a boundary condition that is a second-order accurate approximation of $\\omega(x_{i},H) = - \\frac{\\partial^{2} \\psi}{\\partial y^{2}}(x_{i},H)$ does not inject spurious enstrophy at the wall in a semi-discrete diffusion-dominated regime, and thus is non-destabilizing relative to a first-order wall vorticity approximation.\n- Near-wall impact: Explain how increasing the order of accuracy in the wall vorticity condition changes the leading-order truncation error and the qualitative behavior of computed vorticity gradients near the lid, particularly in mitigating overshoot or undershoot adjacent to the moving wall and improving the accuracy of shear stress $\\tau_{w} = \\mu \\frac{\\partial u}{\\partial y}$.\n\nExpress your final answer as a single, closed-form analytic expression for $\\omega_{i,N}$ in terms of $\\psi_{i,N}$, $\\psi_{i,N-1}$, $\\psi_{i,N-2}$, $h$, and $U$. No numerical evaluation is required, and no units should be included in the final expression.", "solution": "The objective is to derive a second-order accurate finite difference boundary condition for vorticity $\\omega$ on the moving top lid of a square cavity. The derivation will be based on the streamfunction-vorticity formulation of the incompressible Navier-Stokes equations.\n\nThe governing equations and definitions are:\n- Kinematic relations: $u = \\frac{\\partial \\psi}{\\partial y}$ and $v = -\\frac{\\partial \\psi}{\\partial x}$.\n- Vorticity definition: $\\omega = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y}$.\n- Streamfunction-vorticity equation: $\\nabla^{2} \\psi = \\frac{\\partial^2 \\psi}{\\partial x^2} + \\frac{\\partial^2 \\psi}{\\partial y^2} = -\\omega$.\n\nThis final equation, the Poisson equation for the streamfunction $\\psi$, holds everywhere in the domain, including on its boundaries. At any point $(x_i, H)$ on the top wall (indexed by $j=N$), we have:\n$$\n\\omega(x_i, H) = -\\left( \\frac{\\partial^2 \\psi}{\\partial x^2} + \\frac{\\partial^2 \\psi}{\\partial y^2} \\right)\\bigg|_{y=H}\n$$\nWe denote wall quantities at a grid point $i$ as $\\omega_{i,N} = \\omega(x_i, H)$ and $\\psi_{i,N} = \\psi(x_i, H)$.\n\nFirst, we analyze the term $\\frac{\\partial^2 \\psi}{\\partial x^2}(x_i, H)$. The problem states the boundary conditions on the top lid are $u(x,H) = U$ and $v(x,H) = 0$. The no-penetration condition $v=0$ on the line $y=H$ implies:\n$$\nv(x,H) = -\\frac{\\partial \\psi}{\\partial x}(x,H) = 0\n$$\nThis equation holds for all $x$ along the lid. This means that $\\psi(x,H)$ is constant with respect to $x$. The problem statement confirms this by specifying $\\psi = \\psi_w$ on the top lid. Since $\\psi(x,H)$ does not vary with $x$, its first and second partial derivatives with respect to $x$ are zero:\n$$\n\\frac{\\partial \\psi}{\\partial x}(x,H) = 0 \\quad \\text{and} \\quad \\frac{\\partial^2 \\psi}{\\partial x^2}(x,H) = 0\n$$\nThis simplifies the relationship between vorticity and streamfunction at the top wall to:\n$$\n\\omega(x_i, H) = - \\frac{\\partial^2 \\psi}{\\partial y^2}(x_i, H) \\quad \\implies \\quad \\omega_{i,N} = -\\left(\\frac{\\partial^2 \\psi}{\\partial y^2}\\right)_{i,N}\n$$\nOur goal now is to find a second-order accurate finite difference approximation for $\\left(\\frac{\\partial^2 \\psi}{\\partial y^2}\\right)_{i,N}$ using values of $\\psi$ at grid points inside the domain ($j=N$, $j=N-1$, $j=N-2$) and the known velocity boundary condition.\n\nWe write Taylor series expansions for $\\psi$ at $y = H-h$ and $y = H-2h$ around the point $y=H$, for a fixed $x_i$:\n$$\n\\psi_{i,N-1} = \\psi(x_i, H-h) = \\psi_{i,N} - h \\left(\\frac{\\partial \\psi}{\\partial y}\\right)_{i,N} + \\frac{h^2}{2} \\left(\\frac{\\partial^2 \\psi}{\\partial y^2}\\right)_{i,N} - \\frac{h^3}{6} \\left(\\frac{\\partial^3 \\psi}{\\partial y^3}\\right)_{i,N} + O(h^4)\n$$\n$$\n\\psi_{i,N-2} = \\psi(x_i, H-2h) = \\psi_{i,N} - 2h \\left(\\frac{\\partial \\psi}{\\partial y}\\right)_{i,N} + \\frac{(2h)^2}{2} \\left(\\frac{\\partial^2 \\psi}{\\partial y^2}\\right)_{i,N} - \\frac{(2h)^3}{6} \\left(\\frac{\\partial^3 \\psi}{\\partial y^3}\\right)_{i,N} + O(h^4)\n$$\nThe boundary condition for the tangential velocity $u(x,H)=U$ gives us the first derivative of $\\psi$:\n$$\nu(x_i, H) = \\left(\\frac{\\partial \\psi}{\\partial y}\\right)_{i,N} = U\n$$\nSubstituting this and $\\omega_{i,N} = -(\\psi_{yy})_{i,N}$ into the expansions gives:\n$$\n(1) \\quad \\psi_{i,N-1} = \\psi_{i,N} - hU - \\frac{h^2}{2}\\omega_{i,N} - \\frac{h^3}{6}\\left(\\frac{\\partial^3 \\psi}{\\partial y^3}\\right)_{i,N} + O(h^4)\n$$\n$$\n(2) \\quad \\psi_{i,N-2} = \\psi_{i,N} - 2hU - 2h^2\\omega_{i,N} - \\frac{4h^3}{3}\\left(\\frac{\\partial^3 \\psi}{\\partial y^3}\\right)_{i,N} + O(h^4)\n$$\nWe seek an expression for $\\omega_{i,N}$ that is second-order accurate, which means its truncation error must be $O(h^2)$. To achieve this, we must eliminate the unknown third derivative term, $(\\psi_{yyy})_{i,N}$. We can do this by taking a linear combination of equations $(1)$ and $(2)$. To cancel the $h^3$ terms, we multiply equation $(1)$ by $8$ and subtract equation $(2)$:\n$$\n8\\psi_{i,N-1} - \\psi_{i,N-2} = 8\\left(\\psi_{i,N} - hU - \\frac{h^2}{2}\\omega_{i,N}\\right) - \\left(\\psi_{i,N} - 2hU - 2h^2\\omega_{i,N}\\right) + O(h^4)\n$$\nThe $O(h^3)$ term is $8(-\\frac{h^3}{6}) - (-\\frac{8h^3}{6}) = 0$, so it cancels as intended. Now, we simplify the remaining expression:\n$$\n8\\psi_{i,N-1} - \\psi_{i,N-2} = (8\\psi_{i,N} - \\psi_{i,N}) - (8hU - 2hU) - (4h^2\\omega_{i,N} - 2h^2\\omega_{i,N}) + O(h^4)\n$$\n$$\n8\\psi_{i,N-1} - \\psi_{i,N-2} = 7\\psi_{i,N} - 6hU - 2h^2\\omega_{i,N} + O(h^4)\n$$\nFinally, we solve for $\\omega_{i,N}$:\n$$\n2h^2\\omega_{i,N} = 7\\psi_{i,N} - 8\\psi_{i,N-1} + \\psi_{i,N-2} - 6hU + O(h^4)\n$$\n$$\n\\omega_{i,N} = \\frac{7\\psi_{i,N} - 8\\psi_{i,N-1} + \\psi_{i,N-2}}{2h^2} - \\frac{3U}{h} + O(h^2)\n$$\nThis provides the desired second-order accurate expression for the wall vorticity $\\omega_{i,N}$.\n\nNext, we address the required analysis points.\n\n- **Consistency**: To show consistency, we test the formula on a flow where the streamwise velocity is linear in the wall-normal coordinate, $u(y) = A(y-H) + U$. This satisfies $u(H)=U$. The vorticity for this profile is $\\omega = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y} = 0 - A = -A$. We must verify that our formula for $\\omega_{i,N}$ yields this exact value.\nFirst, we find the corresponding streamfunction by integrating $u = \\frac{\\partial\\psi}{\\partial y}$:\n$\\psi(y) = \\int (A(y-H) + U) dy = \\frac{A}{2}(y-H)^2 + Uy + C$.\nWe evaluate $\\psi$ at the grid points:\n$\\psi_{i,N} = \\psi(H) = UH+C$.\n$\\psi_{i,N-1} = \\psi(H-h) = \\frac{A}{2}(-h)^2 + U(H-h) + C = \\psi_{i,N} + \\frac{A}{2}h^2 - Uh$.\n$\\psi_{i,N-2} = \\psi(H-2h) = \\frac{A}{2}(-2h)^2 + U(H-2h) + C = \\psi_{i,N} + 2Ah^2 - 2Uh$.\nSubstituting these into our derived formula for $\\omega_{i,N}$:\n$$\n\\omega_{i,N} = \\frac{7\\psi_{i,N} - 8(\\psi_{i,N} + \\frac{A}{2}h^2 - Uh) + (\\psi_{i,N} + 2Ah^2 - 2Uh)}{2h^2} - \\frac{3U}{h}\n$$\nThe terms involving $\\psi_{i,N}$ cancel: $(7-8+1)\\psi_{i,N} = 0$. The remaining terms in the numerator are:\n$(-8)(\\frac{A}{2}h^2) + 2Ah^2 + (-8)(-Uh) - 2Uh = -4Ah^2 + 2Ah^2 + 8Uh - 2Uh = -2Ah^2 + 6Uh$.\nSo,\n$$\n\\omega_{i,N} = \\frac{-2Ah^2 + 6Uh}{2h^2} - \\frac{3U}{h} = -A + \\frac{3U}{h} - \\frac{3U}{h} = -A\n$$\nThis matches the exact vorticity $\\omega = -A$. Thus, the boundary condition is consistent and exact for flows with a locally linear velocity profile.\n\n- **Stability**: The stability of a numerical scheme for the vorticity transport equation, $\\frac{D\\omega}{Dt} = \\nu \\nabla^2\\omega$, is related to the behavior of the total enstrophy, $E = \\frac{1}{2}\\int \\omega^2 dA$. The time evolution of $E$ is given by $\\frac{dE}{dt} = \\nu \\oint_{\\partial \\Omega} \\omega \\frac{\\partial \\omega}{\\partial n} dS - \\nu \\int_\\Omega |\\nabla\\omega|^2 dA$. The first term represents enstrophy production at the boundary, while the second term represents viscous dissipation in the interior. Numerical instability can arise if the boundary condition introduces a spurious, non-physical source of enstrophy. The physical generation of vorticity at a no-slip wall is directly linked to the velocity gradients, summarized by the kinematic condition $\\omega = -\\psi_{yy}$ at the wall. A numerical boundary condition for $\\omega$ is an approximation of this physical link. A first-order accurate condition has a truncation error of $O(h)$, which acts as an artificial enstrophy source/sink of this order. If this artificial term is a source, it can pump non-physical energy into the simulation, causing instability. A second-order accurate approximation reduces this error to $O(h^2)$. By representing the physical mechanism of vorticity generation more faithfully, it drastically reduces the magnitude of the spurious enstrophy source at the boundary. This makes the scheme less prone to instability compared to a first-order scheme, as it adheres more closely to the physical energy (enstrophy) balance.\n\n- **Near-wall impact**: The order of accuracy of the wall vorticity condition has a profound impact on the quality of the numerical solution.\n    - **Truncation Error**: By increasing the order of accuracy from first, $O(h)$, to second, $O(h^2)$, the error in the computed wall vorticity decreases quadratically with grid refinement, rather than linearly. This allows for significantly more accurate results with fewer grid points.\n    - **Qualitative Behavior**: The flow near the moving lid is characterized by a thin shear layer with very high vorticity gradients. A lower-order boundary condition can introduce numerical oscillations (overshoot/undershoot) in the computed vorticity profile near the wall, failing to capture these gradients smoothly. The second-order condition provides a more accurate value for $\\omega_{i,N}$, which serves as a better Dirichlet condition for the vorticity transport equation solved in the interior. This leads to a smoother, more physically realistic vorticity field near the wall, mitigating the numerical artifacts common with lower-order schemes.\n    - **Shear Stress Accuracy**: The shear stress on the top wall is $\\tau_w = \\mu \\left. \\frac{\\partial u}{\\partial y} \\right|_{y=H}$. On the wall, we have $\\omega = \\frac{\\partial v}{\\partial x} - \\frac{\\partial u}{\\partial y}$. Since $v=0$ all along the wall, $\\frac{\\partial v}{\\partial x} = 0$, which gives $\\left. \\omega \\right|_{y=H} = -\\left. \\frac{\\partial u}{\\partial y} \\right|_{y=H}$. Therefore, the wall shear stress is directly proportional to the wall vorticity: $\\tau_w = -\\mu \\omega_w$. The accuracy of the computed shear stress, a quantity of great engineering importance, is thus determined entirely by the accuracy of the wall vorticity. A second-order accurate vorticity boundary condition yields a second-order accurate shear stress, a substantial improvement over the first-order accuracy provided by simpler schemes.", "answer": "$$ \\boxed{ \\frac{7\\psi_{i,N} - 8\\psi_{i,N-1} + \\psi_{i,N-2}}{2h^2} - \\frac{3U}{h} } $$", "id": "3340086"}, {"introduction": "This final hands-on practice transitions from theoretical analysis to practical implementation, addressing a critical challenge in simulating flows in complex geometries: grid non-orthogonality. You will write code to solve the pressure Poisson equation on a skewed grid, directly comparing a naive discretization with a mathematically consistent one that accounts for grid skewness. This exercise provides a powerful, tangible demonstration of how inconsistencies between discrete operators can violate fundamental physical principles like mass conservation, leading to significant errors in the solution [@problem_id:3340097].", "problem": "Consider the incompressible lid-driven cavity flow in two dimensions in a dimensionless formulation with cavity side length $L=1$ and lid speed $U=1$, such that all quantities are nondimensional. The foundational base consists of the incompressible Navier–Stokes equations with constant kinematic viscosity, the incompressibility constraint, and the projection method used in Computational Fluid Dynamics (CFD), specifically the Helmholtz–Hodge decomposition of a velocity field.\n\nStart from the incompressibility constraint $\\nabla \\cdot \\mathbf{u} = 0$ and the standard projection method idea wherein a tentative velocity $\\mathbf{u}^\\ast$ is corrected by the gradient of a pressure field $p$ to enforce incompressibility:\n$$\n\\mathbf{u}^{n+1} = \\mathbf{u}^\\ast - \\Delta t \\, \\nabla p,\n$$\nand thus the pressure $p$ is obtained from the Poisson equation\n$$\n\\nabla^2 p = \\frac{1}{\\Delta t} \\, \\nabla \\cdot \\mathbf{u}^\\ast.\n$$\nTo study pressure–velocity coupling errors under grid skewness, consider a skewed non-orthogonal structured grid obtained by a linear mapping from computational coordinates $(\\xi,\\eta) \\in [0,1]\\times[0,1]$ to physical coordinates $(x,y)$:\n$$\nx = \\xi + \\alpha \\, \\eta, \\quad y = \\eta,\n$$\nwhere the skewness parameter $\\alpha$ relates to the grid skew angle $\\theta$ (in degrees) between the coordinate lines via\n$$\n\\alpha = \\cot \\theta.\n$$\nUnder this mapping, the physical differential operators expressed in computational derivatives are\n$$\n\\frac{\\partial}{\\partial x} = \\frac{\\partial}{\\partial \\xi}, \\quad \\frac{\\partial}{\\partial y} = -\\alpha \\frac{\\partial}{\\partial \\xi} + \\frac{\\partial}{\\partial \\eta},\n$$\nso that the gradient and divergence become\n$$\n\\nabla p = \\begin{bmatrix} p_\\xi \\\\ -\\alpha \\, p_\\xi + p_\\eta \\end{bmatrix}, \\quad \\nabla \\cdot \\mathbf{u} = u_\\xi - \\alpha \\, v_\\xi + v_\\eta,\n$$\nand the Laplacian includes cross-derivative terms,\n$$\n\\nabla^2 p = (1+\\alpha^2) \\, p_{\\xi\\xi} - 2 \\alpha \\, p_{\\xi\\eta} + p_{\\eta\\eta}.\n$$\nThese expressions show that ignoring cross-derivative terms on skewed grids ($\\alpha \\neq 0$) breaks consistency between the divergence and gradient operators required for accurate pressure–velocity coupling in the projection method.\n\nImplement a finite-difference discretization on an $N \\times N$ uniform grid in computational coordinates with spacing $h = \\frac{1}{N+1}$ (interior points only, with homogeneous Dirichlet boundary condition $p=0$ for the pressure on the physical boundary, and zero padding for velocity values at the boundary). Use second-order central differences to approximate $p_\\xi$, $p_\\eta$, $p_{\\xi\\xi}$, $p_{\\eta\\eta}$, and $p_{\\xi\\eta}$:\n- $p_{\\xi\\xi} \\approx \\frac{p_{i+1,j} - 2 p_{i,j} + p_{i-1,j}}{h^2}$,\n- $p_{\\eta\\eta} \\approx \\frac{p_{i,j+1} - 2 p_{i,j} + p_{i,j-1}}{h^2}$,\n- $p_{\\xi\\eta} \\approx \\frac{p_{i+1,j+1} - p_{i+1,j-1} - p_{i-1,j+1} + p_{i-1,j-1}}{4 h^2}$,\nand similarly for velocity derivatives.\n\nFor the tentative velocity, use a manufactured dimensionless field defined on computational coordinates:\n$$\nu^\\ast(\\xi,\\eta) = \\sin(\\pi \\xi)\\, \\sin(\\pi \\eta), \\quad v^\\ast(\\xi,\\eta) = \\sin(2\\pi \\xi)\\, \\sin(\\pi \\eta),\n$$\nwhich yields a non-zero divergence in physical coordinates via the above divergence relation. Solve the pressure Poisson equation in two ways:\n1. An orthogonal-grid assumption that neglects cross-derivative terms, i.e.,\n$$\n\\nabla^2 p \\approx p_{\\xi\\xi} + p_{\\eta\\eta}.\n$$\n2. A correct skewed-grid Laplacian that includes cross-derivative terms, i.e.,\n$$\n\\nabla^2 p \\approx (1+\\alpha^2) \\, p_{\\xi\\xi} - 2 \\alpha \\, p_{\\xi\\eta} + p_{\\eta\\eta}.\n$$\nIn both cases, set the right-hand side to $\\frac{1}{\\Delta t}\\, \\nabla \\cdot \\mathbf{u}^\\ast$ computed with the correct skewed divergence $u_\\xi - \\alpha v_\\xi + v_\\eta$.\n\nAfter obtaining $p$, compute the corrected velocity\n$$\nu = u^\\ast - \\Delta t \\, p_\\xi, \\quad v = v^\\ast - \\Delta t \\, (-\\alpha p_\\xi + p_\\eta),\n$$\nand then measure the residual divergence in physical coordinates,\n$$\n\\varepsilon = \\left\\| u_\\xi - \\alpha v_\\xi + v_\\eta \\right\\|_{L^2},\n$$\napproximated on the grid by\n$$\n\\varepsilon \\approx \\sqrt{ h^2 \\sum_{i,j} \\left( u_\\xi - \\alpha v_\\xi + v_\\eta \\right)_{i,j}^2 }.\n$$\n\nAngle unit specification: $\\theta$ must be provided in degrees. All quantities are nondimensional; report the residual divergence $\\varepsilon$ as a dimensionless float.\n\nYour program must build sparse matrices for the two Poisson operators, solve for $p$ in both cases, correct the velocity, and compute the residual divergence norms. Use a fixed time step $\\Delta t = 10^{-2}$.\n\nTest suite:\n- Case A (happy path, orthogonal grid): $N=20$, $\\theta=90$.\n- Case B (mild skewness): $N=20$, $\\theta=80$.\n- Case C (moderate skewness): $N=20$, $\\theta=60$.\n- Case D (strong skewness): $N=20$, $\\theta=45$.\n- Case E (severe skewness and reduced resolution, boundary sensitivity): $N=12$, $\\theta=30$.\n\nFor each test case, compute two floats: the residual divergence norm $\\varepsilon_{\\text{naive}}$ using the orthogonal-grid Poisson operator and $\\varepsilon_{\\text{correct}}$ using the skewed-grid Poisson operator. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case yields a two-element list $[\\varepsilon_{\\text{naive}}, \\varepsilon_{\\text{correct}}]$. For example, the output format must be\n$[ [e_{A,\\text{naive}},e_{A,\\text{correct}}], [e_{B,\\text{naive}},e_{B,\\text{correct}}], \\dots ]$.", "solution": "The solution involves implementing a numerical experiment in Python to demonstrate the effect of grid skewness on the accuracy of a projection method for incompressible flow. The methodology proceeds as follows:\n\n1.  **Grid and Coordinate System**: A structured grid in a 2D physical domain $(x,y)$ is defined via a linear transformation from a uniform Cartesian grid in a computational domain $(\\xi,\\eta) \\in [0,1]\\times[0,1]$. The transformation is given by $x = \\xi + \\alpha \\eta$ and $y = \\eta$, where $\\alpha = \\cot(\\theta)$ is the skewness parameter derived from the grid angle $\\theta$. The computational grid consists of $N \\times N$ interior points with spacing $h = 1/(N+1)$. Total grid size including boundaries is $(N+2)\\times(N+2)$.\n\n2.  **Governing Equations and Discretization**: The core of the projection method for incompressible flow is solving the pressure Poisson equation $\\nabla^2 p = \\frac{1}{\\Delta t} \\nabla \\cdot \\mathbf{u}^\\ast$. All differential operators ($\\nabla \\cdot$, $\\nabla$, $\\nabla^2$) are transformed into the computational $(\\xi, \\eta)$ coordinate system. The problem requires using second-order central differences to discretize all spatial derivatives.\n\n3.  **Manufactured Tentative Velocity**: A tentative velocity field, $\\mathbf{u}^\\ast = (u^\\ast, v^\\ast)$, is analytically defined on the computational grid: $u^\\ast(\\xi,\\eta) = \\sin(\\pi \\xi) \\sin(\\pi \\eta)$ and $v^\\ast(\\xi,\\eta) = \\sin(2\\pi \\xi) \\sin(\\pi \\eta)$. This field is not divergence-free in the physical coordinates on a skewed grid.\n\n4.  **Right-Hand Side (RHS) Construction**: The RHS of the Poisson equation, $S = \\frac{1}{\\Delta t} \\nabla \\cdot \\mathbf{u}^\\ast$, is computed. The divergence operator in skewed coordinates is $\\nabla \\cdot \\mathbf{u}^\\ast = \\frac{\\partial u^\\ast}{\\partial \\xi} - \\alpha \\frac{\\partial v^\\ast}{\\partial \\xi} + \\frac{\\partial v^\\ast}{\\partial \\eta}$. The derivatives $\\frac{\\partial u^\\ast}{\\partial \\xi}$, $\\frac{\\partial v^\\ast}{\\partial \\xi}$, and $\\frac{\\partial v^\\ast}{\\partial \\eta}$ are computed on the interior grid points using central differences. The resulting $N \\times N$ matrix of RHS values is flattened into a vector $\\mathbf{b}$ of size $N^2 \\times 1$.\n\n5.  **Pressure Poisson Matrix Assembly**: The pressure Poisson equation is a linear system $\\mathbf{A} \\mathbf{p} = \\mathbf{b}$, where $\\mathbf{p}$ is the vector of unknown pressure values at the $N^2$ interior points. Two distinct system matrices, $\\mathbf{A}_{\\text{naive}}$ and $\\mathbf{A}_{\\text{correct}}$, are constructed as sparse matrices.\n    *   **Naive Operator**: $\\mathbf{A}_{\\text{naive}}$ corresponds to the discretization of $\\nabla^2 p \\approx \\frac{\\partial^2 p}{\\partial \\xi^2} + \\frac{\\partial^2 p}{\\partial \\eta^2}$. This results in a standard 5-point stencil for the Laplacian.\n    *   **Correct Operator**: $\\mathbf{A}_{\\text{correct}}$ corresponds to the full skewed Laplacian $\\nabla^2 p = (1+\\alpha^2)\\frac{\\partial^2 p}{\\partial \\xi^2} - 2\\alpha \\frac{\\partial^2 p}{\\partial \\xi \\partial \\eta} + \\frac{\\partial^2 p}{\\partial \\eta^2}$. Discretizing this operator yields a 9-point stencil that correctly accounts for grid skewness.\n\n6.  **Solving for Pressure**: The two linear systems, $\\mathbf{A}_{\\text{naive}} \\mathbf{p}_{\\text{naive}} = \\mathbf{b}$ and $\\mathbf{A}_{\\text{correct}} \\mathbf{p}_{\\text{correct}} = \\mathbf{b}$, are solved to obtain the pressure fields for the naive and correct cases, respectively. The resulting solution vectors are reshaped into $N \\times N$ arrays and padded with zeros to represent the homogeneous Dirichlet boundary condition ($p=0$) on the $(N+2)\\times(N+2)$ grid.\n\n7.  **Velocity Correction**: The velocity field is corrected using the pressure gradient: $\\mathbf{u} = \\mathbf{u}^\\ast - \\Delta t \\nabla p$. In component form using computational coordinates, the correction is $u = u^\\ast - \\Delta t \\frac{\\partial p}{\\partial \\xi}$ and $v = v^\\ast - \\Delta t (-\\alpha \\frac{\\partial p}{\\partial \\xi} + \\frac{\\partial p}{\\partial \\eta})$. This step is performed for both $p_{\\text{naive}}$ and $p_{\\text{correct}}$ to get two new velocity fields, $\\mathbf{u}_{\\text{naive}}$ and $\\mathbf{u}_{\\text{correct}}$. The pressure derivatives are computed using central differences.\n\n8.  **Residual Divergence Calculation**: The final step is to measure the incompressibility error by computing the $L^2$-norm of the divergence of the corrected velocity fields. The residual divergence is given by $\\varepsilon = \\| \\nabla \\cdot \\mathbf{u} \\|_{L_2} \\approx \\sqrt{ h^2 \\sum_{i,j} (\\frac{\\partial u}{\\partial \\xi} - \\alpha \\frac{\\partial v}{\\partial \\xi} + \\frac{\\partial v}{\\partial \\eta})_{i,j}^2 }$. This norm is calculated for both $\\mathbf{u}_{\\text{naive}}$ and $\\mathbf{u}_{\\text{correct}}$.\n\nWhen the discrete operators for gradient, divergence, and Laplacian are defined consistently, as is the case for the \"correct\" formulation, the discrete divergence of the corrected velocity field is expected to be zero to machine precision. The \"naive\" formulation breaks this consistency on skewed grids, leading to a significant non-zero residual divergence that increases with grid skewness ($\\alpha$). For an orthogonal grid ($\\theta=90^\\circ$, $\\alpha=0$), both formulations are identical and should yield the same small residual, which arises from the inherent mismatch between the discrete five-point Laplacian and the composition of the discrete divergence and gradient operators on a collocated grid.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import lil_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef calculate_residual(p, u_star, v_star, N, h, dt, alpha):\n    \"\"\"\n    Computes the residual divergence norm for a given pressure solution.\n\n    Args:\n        p (np.ndarray): The (N+2)x(N+2) pressure field with zero boundaries.\n        u_star (np.ndarray): The (N+2)x(N+2) tentative u-velocity field.\n        v_star (np.ndarray): The (N+2)x(N+2) tentative v-velocity field.\n        N (int): Number of interior grid points in one dimension.\n        h (float): Grid spacing in computational coordinates.\n        dt (float): Time step.\n        alpha (float): Grid skewness parameter.\n\n    Returns:\n        float: The L2-norm of the residual divergence.\n    \"\"\"\n    # Pressure gradients on the N x N interior grid.\n    # 'xy' indexing is used: i for columns (xi), j for rows (eta).\n    p_xi = (p[1:-1, 2:] - p[1:-1, :-2]) / (2 * h)\n    p_eta = (p[2:, 1:-1] - p[:-2, 1:-1]) / (2 * h)\n\n    # Correct the velocity on the N x N interior grid.\n    u_corr = u_star[1:-1, 1:-1] - dt * p_xi\n    v_corr = v_star[1:-1, 1:-1] - dt * (-alpha * p_xi + p_eta)\n\n    # Pad corrected velocity with zeros to create (N+2)x(N+2) fields for derivative calculation.\n    u_final = np.zeros((N + 2, N + 2))\n    v_final = np.zeros((N + 2, N + 2))\n    u_final[1:-1, 1:-1] = u_corr\n    v_final[1:-1, 1:-1] = v_corr\n    \n    # Calculate derivatives of the final corrected velocity on the N x N interior grid.\n    u_final_xi = (u_final[1:-1, 2:] - u_final[1:-1, :-2]) / (2 * h)\n    v_final_xi = (v_final[1:-1, 2:] - v_final[1:-1, :-2]) / (2 * h)\n    v_final_eta = (v_final[2:, 1:-1] - v_final[:-2, 1:-1]) / (2 * h)\n\n    # Residual divergence on the N x N interior grid.\n    res_div = u_final_xi - alpha * v_final_xi + v_final_eta\n    \n    # L2 Norm of the residual divergence.\n    epsilon = np.sqrt(h**2 * np.sum(res_div**2))\n    return epsilon\n\ndef solve_case(N, theta):\n    \"\"\"\n    Solves the problem for a single test case specified by N and theta.\n    \n    Args:\n        N (int): Number of interior grid points in one dimension.\n        theta (float): Grid skew angle in degrees.\n        \n    Returns:\n        list: A two-element list containing [epsilon_naive, epsilon_correct].\n    \"\"\"\n    # 1. Parameters\n    dt = 1e-2\n    h = 1.0 / (N + 1)\n    if theta == 90.0:\n        alpha = 0.0\n    else:\n        alpha = 1.0 / np.tan(np.deg2rad(theta))\n\n    # 2. Grid and Tentative Velocity Field\n    coords = np.linspace(0, 1, N + 2)\n    xi, eta = np.meshgrid(coords, coords, indexing='xy')\n\n    u_star = np.sin(np.pi * xi) * np.sin(np.pi * eta)\n    v_star = np.sin(2 * np.pi * xi) * np.sin(np.pi * eta)\n\n    # 3. Right-Hand Side (RHS) of the Poisson Equation\n    u_star_xi = (u_star[1:-1, 2:] - u_star[1:-1, :-2]) / (2 * h)\n    v_star_xi = (v_star[1:-1, 2:] - v_star[1:-1, :-2]) / (2 * h)\n    v_star_eta = (v_star[2:, 1:-1] - v_star[:-2, 1:-1]) / (2 * h)\n\n    div_u_star = u_star_xi - alpha * v_star_xi + v_star_eta\n    rhs = (1 / dt) * div_u_star\n    b = rhs.flatten()  # Row-major flattening: (j,i) -> k = j*N+i\n\n    # 4. Assemble Sparse Matrices for Poisson Solvers\n    num_unknowns = N * N\n    A_naive = lil_matrix((num_unknowns, num_unknowns))\n    A_correct = lil_matrix((num_unknowns, num_unknowns))\n    \n    h2 = h**2\n    \n    for j in range(N):  # row index 0 to N-1\n        for i in range(N):  # col index 0 to N-1\n            k = j * N + i  # 1D index, row-major\n            \n            # Case 1: Naive (Orthogonal) Laplacian (5-point stencil)\n            A_naive[k, k] = -4.0 / h2\n            if i > 0:   A_naive[k, k - 1] = 1.0 / h2\n            if i < N - 1: A_naive[k, k + 1] = 1.0 / h2\n            if j > 0:   A_naive[k, k - N] = 1.0 / h2\n            if j < N - 1: A_naive[k, k + N] = 1.0 / h2\n\n            # Case 2: Correct Skewed Laplacian (9-point stencil)\n            A_correct[k, k] = (1 + alpha**2) * (-2.0 / h2) + (-2.0 / h2)\n            if i > 0:   A_correct[k, k - 1] = (1 + alpha**2) / h2\n            if i < N - 1: A_correct[k, k + 1] = (1 + alpha**2) / h2\n            if j > 0:   A_correct[k, k - N] = 1.0 / h2\n            if j < N - 1: A_correct[k, k + N] = 1.0 / h2\n            \n            coeff_xieta = -2.0 * alpha / (4.0 * h2)\n            if j < N - 1 and i < N - 1: A_correct[k, k + N + 1] += coeff_xieta\n            if j > 0 and i < N - 1:     A_correct[k, k - N + 1] -= coeff_xieta\n            if j < N - 1 and i > 0:     A_correct[k, k + N - 1] -= coeff_xieta\n            if j > 0 and i > 0:         A_correct[k, k - N - 1] += coeff_xieta\n    \n    # 5. Solve the Linear Systems for Pressure\n    A_naive_csr = A_naive.tocsr()\n    A_correct_csr = A_correct.tocsr()\n\n    p_naive_vec = spsolve(A_naive_csr, b)\n    p_correct_vec = spsolve(A_correct_csr, b)\n    \n    p_naive_int = p_naive_vec.reshape((N, N))\n    p_correct_int = p_correct_vec.reshape((N, N))\n\n    p_naive = np.zeros((N + 2, N + 2))\n    p_correct = np.zeros((N + 2, N + 2))\n    p_naive[1:-1, 1:-1] = p_naive_int\n    p_correct[1:-1, 1:-1] = p_correct_int\n\n    # 6. Calculate Final Residual Divergence Norms\n    eps_naive = calculate_residual(p_naive, u_star, v_star, N, h, dt, alpha)\n    eps_correct = calculate_residual(p_correct, u_star, v_star, N, h, dt, alpha)\n    \n    return [eps_naive, eps_correct]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (20, 90.0),\n        (20, 80.0),\n        (20, 60.0),\n        (20, 45.0),\n        (12, 30.0),\n    ]\n\n    results = []\n    for N, theta in test_cases:\n        result = solve_case(N, theta)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3340097"}]}