{"hands_on_practices": [{"introduction": "A primary goal of solution verification is to estimate the magnitude of discretization error in a simulation result. This exercise introduces the Grid Convergence Index (GCI), a standardized and widely accepted method for reporting this uncertainty. By deriving the GCI formula from the fundamental asymptotic error model, you will gain a first-principles understanding of how it connects the change between solutions on two grids to an error estimate on the finer grid. This practice [@problem_id:3326350] is foundational, equipping you with a practical tool while also highlighting the crucial assumption about the asymptotic range of convergence upon which it depends.", "problem": "A scalar quantity $S$ from a Computational Fluid Dynamics (CFD) simulation is computed on two systematically refined grids. Let $S_1$ denote the value on the fine grid and $S_2$ the value on the medium grid, with a uniform refinement ratio $r = h_2 / h_1 > 1$ between medium and fine characteristic mesh spacings $h_2$ and $h_1$. Assume the numerical method has theoretical order of accuracy $p$ and that the discretization error in the asymptotic regime scales as $|S(h) - S_{\\text{exact}}| \\approx C h^{p}$ for some constant $C$. The Grid Convergence Index (GCI), introduced to quantify the uncertainty due to discretization for a pair of grids, incorporates a safety factor $F_s$ and is based on the relationship between successive-grid errors in the asymptotic range.\n\nGiven $p = 2$, $r = 1.3$, $S_1 = 1.00$, $S_2 = 0.98$, and $F_s = 1.25$, derive the expression for the two-grid Grid Convergence Index from first principles and compute $\\mathrm{GCI}_{21}$ associated with the fine grid. Briefly comment on whether the computed value alone is sufficient evidence that the pair of solutions is within the asymptotic range, and justify your reasoning based on the foundational definition of the asymptotic regime.\n\nExpress the final numerical value of $\\mathrm{GCI}_{21}$ as a dimensionless decimal, rounded to four significant figures.", "solution": "The problem is deemed valid. It is scientifically grounded in the principles of numerical analysis and computational fluid dynamics (CFD), specifically the methodology for quantifying discretization error through grid convergence studies. The problem is well-posed, providing all necessary data and definitions ($S_1$, $S_2$, $p$, $r$, $F_s$) to derive and compute the Grid Convergence Index (GCI). The language is objective and unambiguous. It is directly relevant to the topic of grid convergence and solution verification, and contains no scientific flaws or inconsistencies.\n\nThe derivation of the Grid Convergence Index ($\\mathrm{GCI}$) begins with the fundamental assumption that for a sufficiently small characteristic mesh spacing, $h$, the numerical solution $S(h)$ approaches the exact solution $S_{\\text{exact}}$ with a discretization error that scales with the order of accuracy, $p$. This relationship can be written as:\n$$ S(h) = S_{\\text{exact}} + C h^{p} + \\mathcal{O}(h^{p+1}) $$\nwhere $C$ is a constant that depends on the flow problem and the numerical scheme but is independent of $h$ in the asymptotic range. For this analysis, we neglect the higher-order terms.\n\nWe are given solutions on two grids: a fine grid with characteristic spacing $h_1$ yielding solution $S_1$, and a medium grid with spacing $h_2$ yielding solution $S_2$. The grid refinement ratio is $r = h_2 / h_1$. Applying the error model to each grid gives:\n$$ S_1 \\approx S_{\\text{exact}} + C h_1^p \\quad (1) $$\n$$ S_2 \\approx S_{\\text{exact}} + C h_2^p \\quad (2) $$\nSubstituting $h_2 = r h_1$ into equation (2):\n$$ S_2 \\approx S_{\\text{exact}} + C (r h_1)^p = S_{\\text{exact}} + C r^p h_1^p \\quad (3) $$\nOur goal is to estimate the error in the fine-grid solution, $E_1 = S_1 - S_{\\text{exact}} \\approx C h_1^p$, without knowing $S_{\\text{exact}}$ or $C$. We can eliminate $S_{\\text{exact}}$ by subtracting equation (1) from equation (3):\n$$ S_2 - S_1 \\approx (S_{\\text{exact}} + C r^p h_1^p) - (S_{\\text{exact}} + C h_1^p) $$\n$$ S_2 - S_1 \\approx C h_1^p (r^p - 1) $$\nRecognizing that $C h_1^p$ is the approximation for the error on the fine grid, $E_1$, we have:\n$$ S_2 - S_1 \\approx E_1 (r^p - 1) $$\nSolving for the estimated absolute error on the fine grid, $E_{a,1}$:\n$$ E_{a,1} \\approx \\frac{S_2 - S_1}{r^p - 1} $$\nThis result can also be obtained by using Richardson extrapolation to find a more accurate estimate of the solution, $S_{\\text{ext}}$. By eliminating the $C h^p$ term between equations (1) and (3), we find:\n$$ S_{\\text{ext}} = \\frac{r^p S_1 - S_2}{r^p - 1} $$\nThe estimated error in $S_1$ is then the difference between $S_1$ and this higher-order estimate:\n$$ E_{a,1} = S_1 - S_{\\text{ext}} = S_1 - \\frac{r^p S_1 - S_2}{r^p - 1} = \\frac{S_1(r^p - 1) - (r^p S_1 - S_2)}{r^p - 1} = \\frac{S_2 - S_1}{r^p-1} $$\nThe Grid Convergence Index for the fine grid, denoted $\\mathrm{GCI}_{21}$, is defined as a safety-factored measure of the relative error. The safety factor $F_s$ accounts for the fact that the analysis is based on approximations. The expression for $\\mathrm{GCI}_{21}$ is:\n$$ \\mathrm{GCI}_{21} = F_s \\frac{|E_{a,1}|}{|S_1|} = F_s \\left| \\frac{(S_2 - S_1)/S_1}{r^p - 1} \\right| $$\nThis is the required expression derived from first principles.\n\nNow, we compute the value of $\\mathrm{GCI}_{21}$ using the provided data:\nTheoretical order of accuracy: $p = 2$\nGrid refinement ratio: $r = 1.3$\nFine grid solution: $S_1 = 1.00$\nMedium grid solution: $S_2 = 0.98$\nSafety factor: $F_s = 1.25$\n\nFirst, calculate the term $r^p - 1$:\n$$ r^p - 1 = (1.3)^2 - 1 = 1.69 - 1 = 0.69 $$\nNext, calculate the relative difference between solutions:\n$$ \\frac{S_2 - S_1}{S_1} = \\frac{0.98 - 1.00}{1.00} = -0.02 $$\nSubstitute these values into the $\\mathrm{GCI}_{21}$ formula:\n$$ \\mathrm{GCI}_{21} = 1.25 \\times \\left| \\frac{-0.02}{0.69} \\right| = 1.25 \\times \\frac{0.02}{0.69} \\approx 1.25 \\times 0.0289855... $$\n$$ \\mathrm{GCI}_{21} \\approx 0.03623188... $$\nRounding the result to four significant figures gives $0.03623$. This corresponds to an estimated uncertainty of approximately $3.623\\%$.\n\nRegarding whether the computed $\\mathrm{GCI}_{21}$ value alone is sufficient evidence that the solutions are within the asymptotic range: it is not. The entire derivation and calculation are predicated on the *assumption* that the simulations are in the asymptotic range, where the error behaves as $C h^p$. A two-grid study provides no means to *verify* this assumption. To gain confidence that the solutions are in the asymptotic range, a study with at least three systematically refined grids is required. With three grids (e.g., fine $S_1$, medium $S_2$, coarse $S_3$), one can calculate the *observed* or *apparent* order of accuracy, $p_{\\text{obs}}$:\n$$ p_{\\text{obs}} = \\frac{\\ln\\left( \\frac{S_3 - S_2}{S_2 - S_1} \\right)}{\\ln(r)} $$\nIf the value of $p_{\\text{obs}}$ is close to the theoretical order of accuracy $p$, it provides strong evidence that the simulations are indeed within the asymptotic range of convergence. Without this check, a small GCI value could be misleading, potentially arising from insensitivity of the solution to grid refinement for reasons other than convergence to the correct continuum solution (e.g., if iterative convergence tolerances are too loose). Therefore, a single $\\mathrm{GCI}_{21}$ value is an estimate of uncertainty, not a proof of asymptotic convergence.", "answer": "$$ \\boxed{0.03623} $$", "id": "3326350"}, {"introduction": "The GCI method discussed previously is powerful, but its validity hinges on the assumption that the simulations are in the asymptotic range, where the error decreases at a rate determined by the theoretical order of accuracy, $p$. This next practice [@problem_id:3326375] demonstrates how to test this critical assumption. By using results from a Method of Manufactured Solutions (MMS) on three systematically refined grids, you will compute the *observed* order of accuracy, $p_{obs}$, and compare it to the theoretical value, providing direct evidence of whether the convergence is behaving as expected.", "problem": "A steady two-dimensional scalar advection–diffusion equation is verified using the Method of Manufactured Solutions (MMS). The code employs a cell-centered Finite Volume (FV) discretization on uniform Cartesian meshes. Face-normal convective fluxes are obtained by evaluating the flux at the face center using a piecewise-linear reconstruction from cell centers with a least-squares gradient, and diffusive fluxes are computed using a Green–Gauss gradient on cell-centered values with arithmetic averaging of the material coefficient to faces. No slope limiter is activated for the manufactured smooth solution. The spatial meshes are nested and uniformly refined with constant refinement ratio, and the exact MMS field is known everywhere in the domain. The discrete error in the scalar field is reported in the discrete $L_{1}$ norm for three meshes of sizes $N \\times N$ with $N \\in \\{32, 64, 128\\}$. Denote by $h$ the uniform cell width, so that $h_{1} = 1/32$, $h_{2} = 1/64$, $h_{3} = 1/128$, with a constant refinement ratio $r = h_{1}/h_{2} = h_{2}/h_{3} = 2$. The measured errors are\n\n$$\nE(h_{1}) = E_{1} = 3.200 \\times 10^{-3}, \\quad E(h_{2}) = E_{2} = 8.500 \\times 10^{-4}, \\quad E(h_{3}) = E_{3} = 2.200 \\times 10^{-4}.\n$$\n\nStarting from the core definition of discretization error and the standard asymptotic error model for a consistent method, derive a relation that allows the observed order of accuracy $p$ to be inferred from data at multiple grid spacings. Then, using the three error measurements above, determine the observed order $p$ for this cell-centered FV scheme. Round your answer to four significant figures and report it as a dimensionless number.\n\nFinally, compare the observed order to the nominal second-order expectation for piecewise-linear reconstruction with one-point face flux integration on uniform Cartesian meshes, and explain physically and numerically why deviations from the nominal order may occur in terms of reconstruction and flux integration errors. Your explanation should be grounded in first principles about truncation error, polynomial reconstruction, and quadrature, without invoking any black-box formulas.", "solution": "The analysis of the problem will proceed in three parts as requested: first, the derivation of a relation for the observed order of accuracy; second, the calculation of this order using the provided data; and third, an explanation for the deviation of the observed order from the nominal theoretical order.\n\n### Part 1: Derivation of the Relation for Observed Order of Accuracy\n\nThe foundation of this analysis is the asymptotic error model for a consistent numerical method. For a sufficiently small grid spacing $h$, the discretization error $E$ is expected to behave according to the relation:\n$$\nE(h) = C h^p + \\mathcal{O}(h^{p+q})\n$$\nwhere $C$ is a constant independent of $h$, $p$ is the formal order of accuracy of the method, and the term $\\mathcal{O}(h^{p+q})$ with $q \\ge 1$ represents higher-order terms in the error expansion.\n\nIn the asymptotic limit, as $h \\to 0$, the leading term dominates, and we can write the approximation:\n$$\nE(h) \\approx C h^p\n$$\nTo determine the observed order of accuracy, $p$, we can use error measurements from simulations on at least two different grids. Let us consider two grids with characteristic cell sizes $h_i$ and $h_j$ and their corresponding errors $E_i$ and $E_j$. Applying the asymptotic model, we have:\n$$\nE_i \\approx C h_i^p\n$$\n$$\nE_j \\approx C h_j^p\n$$\nAssuming $C$ and $p$ are constant over this range of grid spacings, we can eliminate the constant $C$ by taking the ratio of the two error equations:\n$$\n\\frac{E_i}{E_j} \\approx \\frac{C h_i^p}{C h_j^p} = \\left(\\frac{h_i}{h_j}\\right)^p\n$$\nTo solve for $p$, we take the natural logarithm of both sides:\n$$\n\\ln\\left(\\frac{E_i}{E_j}\\right) \\approx \\ln\\left(\\left(\\frac{h_i}{h_j}\\right)^p\\right) = p \\ln\\left(\\frac{h_i}{h_j}\\right)\n$$\nThis yields the desired relation for the observed order of accuracy:\n$$\np \\approx \\frac{\\ln(E_i/E_j)}{\\ln(h_i/h_j)}\n$$\nThis relation can be used with any pair of grids. When three or more grids are available with a constant refinement ratio $r = h_k/h_{k+1}$, as is the case here, one could compute $p$ for each consecutive pair of grids. However, a more robust method that utilizes all data points is to perform a linear least-squares fit on the logarithmic form of the error model, $\\ln(E) = p \\ln(h) + \\ln(C)$.\n\nFor three grids with uniform refinement, such that the points $(\\ln(h_1), \\ln(h_2), \\ln(h_3))$ are equally spaced, the least-squares best-fit slope $p$ is identical to the slope computed using the two outermost data points, $(h_1, E_1)$ and $(h_3, E_3)$. Therefore, the relation derived from this approach is:\n$$\np = \\frac{\\ln(E_1/E_3)}{\\ln(h_1/h_3)}\n$$\nThis is the relation we will use for the calculation.\n\n### Part 2: Calculation of the Observed Order of Accuracy\n\nThe problem provides the following data:\n- Grid spacings: $h_1 = 1/32$, $h_2 = 1/64$, $h_3 = 1/128$.\n- The constant grid refinement ratio is $r = h_1/h_2 = h_2/h_3 = 2$.\n- Measured errors: $E_1 = 3.200 \\times 10^{-3}$, $E_2 = 8.500 \\times 10^{-4}$, and $E_3 = 2.200 \\times 10^{-4}$.\n\nWe use the derived relation with the data from the coarsest grid ($h_1, E_1$) and the finest grid ($h_3, E_3$) to obtain the most representative order of accuracy over the studied range. The ratio of the grid spacings is:\n$$\n\\frac{h_1}{h_3} = \\frac{1/32}{1/128} = \\frac{128}{32} = 4\n$$\nAlternatively, since $h_1=rh_2=r(rh_3)=r^2 h_3$, the ratio is $r^2=2^2=4$.\n\nThe ratio of the corresponding errors is:\n$$\n\\frac{E_1}{E_3} = \\frac{3.200 \\times 10^{-3}}{2.200 \\times 10^{-4}} = \\frac{32}{2.2} \\approx 14.5454...\n$$\nNow, we substitute these values into the formula for $p$:\n$$\np = \\frac{\\ln(E_1/E_3)}{\\ln(h_1/h_3)} = \\frac{\\ln(14.5454...)}{\\ln(4)}\n$$\nCalculating the numerical values:\n$$\np = \\frac{2.677234...}{1.386294...} \\approx 1.931240...\n$$\nRounding the result to four significant figures as requested, we get:\n$$\np \\approx 1.931\n$$\n\n### Part 3: Explanation for Deviation from Nominal Order\n\nThe observed order of accuracy $p \\approx 1.931$ is slightly below the nominal second-order accuracy ($p=2$) expected for a piecewise-linear reconstruction scheme on a uniform Cartesian mesh. This deviation can be explained by considering the details of the truncation error and the practical limitations of the asymptotic error model.\n\n1.  **Asymptotic Convergence**: The error model $E \\approx C h^p$ is strictly valid only in the asymptotic limit where $h \\to 0$. For finite grid spacings, higher-order terms in the error expansion, $E(h) = C_p h^p + C_{p+1} h^{p+1} + \\dots$, are not negligible. The presence of these terms \"contaminates\" the leading-order behavior, causing the *observed* order to differ from the formal order $p$. The fact that the order calculated between grids 1 and 2 ($p_{12} \\approx 1.912$) is lower than that between grids 2 and 3 ($p_{23} \\approx 1.950$) suggests that the method is indeed approaching its asymptotic order of $p=2$ as the mesh is refined. The reported value of $p \\approx 1.931$ is an average over this range and reflects that the simulations are not yet fully in the asymptotic regime.\n\n2.  **Truncation Error Cancellation and Symmetry Breaking**: The nominal second-order accuracy of a finite volume scheme on a uniform grid arises from a cancellation of the leading-order truncation errors from opposite faces of a control volume. This cancellation relies heavily on the symmetry of the discretization stencil, which is characteristic of central-difference schemes.\n    The problem describes a scheme for an advection-diffusion equation. The diffusive flux discretization, using a Green-Gauss gradient (which on a uniform Cartesian grid is equivalent to a central difference) and arithmetic averaging, is symmetric and naturally second-order.\n    However, the convective flux calculation involves a \"piecewise-linear reconstruction from cell centers\" to determine the flux at the face. This implies an upwind-biased approach, where the state of the fluid in the upwind cell is used to determine the face value $\\phi_f$. Even though the gradient used for this reconstruction is second-order accurate (least-squares), the one-sided nature of upwinding fundamentally breaks the symmetry of the stencil.\n    This asymmetry disrupts the perfect cancellation of the primary error terms. The resulting truncation error for the advective part, while formally of order $\\mathcal{O}(h^2)$, contains terms analogous to numerical diffusion (often related to the third derivative of the solution, e.g., $\\propto h^2 \\frac{\\partial^3\\phi}{\\partial x^3}$), which are absent in a purely symmetric scheme. The coefficient of this leading error term can be significant and can reduce the effective, or observed, order of accuracy on meshes that are not sufficiently fine, leading to a value slightly less than $2$.\n\nIn summary, the primary reason for the observed order being $1.931$ instead of exactly $2$ is that the simulations have not reached a fine-enough grid resolution to be truly in the asymptotic range where the $\\mathcal{O}(h^2)$ error term completely dominates. This effect is compounded by the inherent nature of the upwind-biased convective scheme, whose leading error terms, although formally second-order, are less favorable than those of a perfectly symmetric scheme, causing a slower convergence to the theoretical order.", "answer": "$$\n\\boxed{1.931}\n$$", "id": "3326375"}, {"introduction": "Our analysis so far has implicitly assumed that the exact solution is smooth. However, many real-world fluid dynamics problems involve non-smooth features like shocks, contact discontinuities, or sharp boundary layers, which can significantly alter convergence behavior. This advanced practice [@problem_id:3326338] delves into this complexity by using a manufactured solution with a built-in \"kink\" to explore how a lack of regularity degrades the order of accuracy. By computing the error in different norms ($L_1$, $L_2$, and $L_\\infty$), you will uncover the important principle that the observed convergence rate for non-smooth solutions depends critically on the norm used to measure the error.", "problem": "Consider the two-dimensional, steady, linear advection–reaction partial differential equation on the unit square domain $\\Omega = [0,1]\\times[0,1]$,\n$$\na_x \\,\\frac{\\partial u}{\\partial x} + a_y \\,\\frac{\\partial u}{\\partial y} + \\sigma \\, u = s(x,y),\n$$\nsubject to Dirichlet boundary conditions $u(x,y) = u_{\\text{MMS}}(x,y)$ for $(x,y) \\in \\partial \\Omega$. Use a Method of Manufactured Solutions (MMS) where the exact solution is prescribed as\n$$\nu_{\\text{MMS}}(x,y) = \\sin(2\\pi x)\\,\\exp(y) + \\left|y - 0.5\\right|,\n$$\nwith angles implicitly in radians. Construct the source term $s(x,y)$ from the governing equation by substituting $u_{\\text{MMS}}$ and evaluating the required derivatives wherever they are defined in the classical sense. You must explicitly handle the nondifferentiability of the absolute value term in a principled way by using the piecewise definition of its first derivative, namely $\\frac{d}{dy}\\left|y-0.5\\right| = \\operatorname{sign}(y-0.5)$ for $y \\neq 0.5$, with $\\operatorname{sign}(0)=0$ used at $y=0.5$ for the purposes of pointwise source evaluation on grid nodes lying exactly on the kink. No second derivatives of $\\left|y-0.5\\right|$ are required in this problem.\n\nDiscretize the interior of $\\Omega$ on uniform Cartesian grids using $N_x$ points in the $x$-direction and $N_y$ points in the $y$-direction, with spacings $h_x = 1/(N_x-1)$ and $h_y = 1/(N_y-1)$. Construct the discrete operator using second-order centered finite differences for the first derivatives and pointwise evaluation for the reaction term, with Dirichlet boundary values set by $u_{\\text{MMS}}$ on $\\partial \\Omega$. Do not use any upwinding, limiters, filtering, or artificial diffusion.\n\nFor each discrete solution, compute the error $e_{i,j} = u_{i,j}^{\\text{num}} - u_{\\text{MMS}}(x_i,y_j)$ at interior grid points $(x_i,y_j)$, and then compute the following three error norms:\n- The discrete $L_1$ norm,\n$$\n\\|e\\|_{L_1} = h_x\\,h_y \\sum_{i=1}^{N_x-2} \\sum_{j=1}^{N_y-2} \\left|e_{i,j}\\right|.\n$$\n- The discrete $L_2$ norm,\n$$\n\\|e\\|_{L_2} = \\sqrt{h_x\\,h_y \\sum_{i=1}^{N_x-2} \\sum_{j=1}^{N_y-2} e_{i,j}^2 }.\n$$\n- The discrete $L_\\infty$ norm,\n$$\n\\|e\\|_{L_\\infty} = \\max_{1 \\le i \\le N_x-2, \\, 1 \\le j \\le N_y-2} \\left|e_{i,j}\\right|.\n$$\n\nUsing three successively refined grids, estimate the observed order of accuracy $p$ via Richardson extrapolation between the two finest grids for each norm. In particular, if the error on the middle grid is $E(h_2)$ and the error on the finest grid is $E(h_3)$, with effective grid spacings $h_2$ and $h_3$, compute the observed order $p$ as the value satisfying $E(h) \\approx C h^p$; concretely, use the effective grid spacing $h = \\max(h_x, h_y)$ on each grid for this estimation and evaluate the order $p$ from the two finest levels without any external hints. Explain, in your solution, why the nondifferentiability at $y=0.5$ causes norm-dependent order degradation.\n\nYour program must implement the above procedure and solve the discrete linear systems exactly (to solver tolerance) on each grid. The final outputs are computed $p$ values for the $L_1$, $L_2$, and $L_\\infty$ norms for each of the following test cases (each case includes parameter values and a test-suite of three grids):\n\n- Case $\\mathrm{A}$ (kink aligned on all grids, isotropic refinement):\n  - $a_x = 1$, $a_y = 1$, $\\sigma = 2$.\n  - Grids: $(N_x,N_y) \\in \\{(17,17),(33,33),(65,65)\\}$.\n\n- Case $\\mathrm{B}$ (kink misaligned on all grids, isotropic refinement):\n  - $a_x = 1$, $a_y = 0.5$, $\\sigma = 1$.\n  - Grids: $(N_x,N_y) \\in \\{(16,16),(32,32),(64,64)\\}$.\n\n- Case $\\mathrm{C}$ (weak advection, strong reaction, isotropic refinement):\n  - $a_x = 0.1$, $a_y = 0.1$, $\\sigma = 10$.\n  - Grids: $(N_x,N_y) \\in \\{(17,17),(33,33),(65,65)\\}$.\n\n- Case $\\mathrm{D}$ (anisotropic refinement with kink aligned in $y$):\n  - $a_x = 1$, $a_y = 1$, $\\sigma = 2$.\n  - Grids: $(N_x,N_y) \\in \\{(33,17),(65,33),(97,49)\\}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each case contributes a list of three floating-point numbers [$p_{L_1},p_{L_2},p_{L_\\infty}$] rounded to six decimal places, and the overall output must be a list of these lists in the same order as the cases, for example, [[$p_{A,L_1}, p_{A,L_2}, p_{A,L_\\infty}$],[$p_{B,L_1}, p_{B,L_2}, p_{B,L_\\infty}$],[$p_{C,L_1}, p_{C,L_2}, p_{C,L_\\infty}$],[$p_{D,L_1}, p_{D,L_2}, p_{D,L_\\infty}$]]. No additional text may be printed.\n\nAll quantities in this problem are dimensionless and must be treated in consistent mathematical units. Angles in trigonometric functions are in radians. Your code must be self-contained and produce the specified output without requiring any user input.", "solution": "The problem is valid as it presents a well-posed, scientifically grounded task in computational fluid dynamics and numerical analysis, with all necessary data and definitions provided. We proceed with the solution.\n\nThe core of the problem is to verify the order of accuracy of a numerical method for a partial differential equation (PDE) using the Method of Manufactured Solutions (MMS). This involves prescribing an exact solution, deriving a corresponding source term, solving the PDE numerically on a sequence of refined grids, and then calculating the observed order of convergence from the computed errors.\n\n**1. Governing Equation and Manufactured Solution**\n\nThe governing equation is the two-dimensional, steady, linear advection–reaction equation on the domain $\\Omega = [0,1]\\times[0,1]$:\n$$\na_x \\,\\frac{\\partial u}{\\partial x} + a_y \\,\\frac{\\partial u}{\\partial y} + \\sigma \\, u = s(x,y)\n$$\nThe manufactured solution is given as:\n$$\nu_{\\text{MMS}}(x,y) = \\sin(2\\pi x)\\,\\exp(y) + \\left|y - 0.5\\right|\n$$\nThis solution is composed of a smooth ($C^\\infty$) part, $u_{smooth}(x,y) = \\sin(2\\pi x)\\exp(y)$, and a non-smooth part, $u_{kink}(y) = |y-0.5|$, which is continuous but not differentiable at $y=0.5$.\n\n**2. Source Term Derivation**\n\nTo find the source term $s(x,y)$ that makes $u_{\\text{MMS}}(x,y)$ an exact solution, we substitute it into the PDE. First, we compute the partial derivatives of $u_{\\text{MMS}}$. The derivative with respect to $x$ is:\n$$\n\\frac{\\partial u_{\\text{MMS}}}{\\partial x} = 2\\pi\\cos(2\\pi x)\\,\\exp(y)\n$$\nThe derivative with respect to $y$ requires handling the absolute value term. For $y \\neq 0.5$, the derivative of $|y-0.5|$ is $\\operatorname{sign}(y-0.5)$, where $\\operatorname{sign}(z)$ is $1$ if $z>0$ and $-1$ if $z<0$. As specified, for pointwise evaluation at $y=0.5$, we use $\\operatorname{sign}(0)=0$. Thus:\n$$\n\\frac{\\partial u_{\\text{MMS}}}{\\partial y} = \\sin(2\\pi x)\\,\\exp(y) + \\operatorname{sign}(y-0.5)\n$$\nSubstituting these into the PDE gives the manufactured source term:\n$$\ns(x,y) = a_x \\left(2\\pi\\cos(2\\pi x)\\exp(y)\\right) + a_y \\left(\\sin(2\\pi x)\\exp(y) + \\operatorname{sign}(y-0.5)\\right) + \\sigma \\left(\\sin(2\\pi x)\\exp(y) + \\left|y - 0.5\\right|\\right)\n$$\n\n**3. Numerical Discretization and Linear System**\n\nThe domain is discretized using a uniform Cartesian grid with $N_x$ and $N_y$ points, yielding grid spacings $h_x = 1/(N_x-1)$ and $h_y = 1/(N_y-1)$. The grid points are $(x_i, y_j) = (i h_x, j h_y)$.\n\nThe spatial derivatives are approximated using second-order central finite differences for any interior point $(x_i, y_j)$, where $1 \\le i \\le N_x-2$ and $1 \\le j \\le N_y-2$:\n$$\n\\frac{\\partial u}{\\partial x}\\bigg|_{(x_i,y_j)} \\approx \\frac{u_{i+1,j} - u_{i-1,j}}{2h_x}, \\quad \\frac{\\partial u}{\\partial y}\\bigg|_{(x_i,y_j)} \\approx \\frac{u_{i,j+1} - u_{i,j-1}}{2h_y}\n$$\nSubstituting these into the PDE yields the discrete equation at each interior node $(i,j)$:\n$$\na_x \\left(\\frac{u_{i+1,j} - u_{i-1,j}}{2h_x}\\right) + a_y \\left(\\frac{u_{i,j+1} - u_{i,j-1}}{2h_y}\\right) + \\sigma u_{i,j} = s(x_i,y_j)\n$$\nRearranging the terms to group coefficients of the unknown values of $u$ gives:\n$$\n\\left(-\\frac{a_x}{2h_x}\\right)u_{i-1,j} + \\left(\\frac{a_x}{2h_x}\\right)u_{i+1,j} + \\left(-\\frac{a_y}{2h_y}\\right)u_{i,j-1} + \\left(\\frac{a_y}{2h_y}\\right)u_{i,j+1} + \\sigma u_{i,j} = s(x_i,y_j)\n$$\nThis set of $(N_x-2)(N_y-2)$ linear algebraic equations forms a large, sparse system $A \\mathbf{u} = \\mathbf{b}$. The vector $\\mathbf{u}$ contains the unknown values $u_{i,j}$ at the interior grid points. The matrix $A$ is sparse, with five non-zero entries per row (a five-point stencil). For points adjacent to the boundary, known Dirichlet values $u_{\\text{MMS}}(x_i, y_j)$ are moved to the right-hand side vector $\\mathbf{b}$. For example, at an interior point $(1,j)$ adjacent to the $x=0$ boundary, the term involving $u_{0,j}$ is known, and the equation becomes:\n$$\na_x \\left(\\frac{u_{2,j} - u_{\\text{MMS}}(x_0,y_j)}{2h_x}\\right) + \\dots = s(x_1,y_j) \\implies \\dots = s(x_1,y_j) + a_x\\frac{u_{\\text{MMS}}(x_0,y_j)}{2h_x}\n$$\nThe resulting system $A \\mathbf{u} = \\mathbf{b}$ is solved using a standard sparse linear algebra solver.\n\n**4. Error Analysis and Expected Order of Accuracy**\n\nThe formal order of accuracy of a numerical scheme is determined by its truncation error, which is the residual obtained when the exact solution is substituted into the discrete equations. The central difference scheme is formally second-order accurate ($\\mathcal{O}(h^2)$) for sufficiently smooth solutions (at least $C^3$).\n\nThe manufactured solution $u_{\\text{MMS}}$ is not sufficiently smooth due to the term $|y-0.5|$. This function is $C^0$, and its first derivative has a jump discontinuity at $y=0.5$. Standard numerical analysis theory predicts that this lack of regularity degrades the convergence rate of the scheme. For a $p$-th order method applied to a function with a jump discontinuity in its $k$-th derivative, the observed order of convergence in the $L_q$ norm is predicted to be $\\min(p, k + 1/q)$.\n\nIn this problem, the scheme is second-order ($p=2$) and the solution has a jump in its first derivative ($k=1$). Therefore, the expected orders of convergence are:\n- **$L_\\infty$ norm ($q=\\infty$):** The order is $\\min(2, 1 + 1/\\infty) = \\min(2, 1) = 1$. The maximum error is dominated by the points closest to the singularity and is expected to decrease linearly with grid spacing.\n- **$L_2$ norm ($q=2$):** The order is $\\min(2, 1 + 1/2) = \\min(2, 1.5) = 1.5$.\n- **$L_1$ norm ($q=1$):** The order is $\\min(2, 1 + 1/1) = \\min(2, 2) = 2$.\n\nThis theoretical degradation occurs when the singularity at $y=0.5$ lies between grid lines. However, a phenomenon known as \"superconvergence\" can occur if the singularity is always aligned with a grid line. In grids where $N_y-1$ is a multiple of $2$, the line $y=0.5$ will coincide with a grid line $y_j = j h_y$ for $j=(N_y-1)/2$. At this line, the central difference stencil for $\\partial u/\\partial y$ is symmetric about the kink. The discrete operator effectively computes the average of the left and right derivatives, which is $\\frac{1}{2}(1 + (-1)) = 0$. The source term at $y=0.5$ is also evaluated using $\\operatorname{sign}(y-0.5)|_{y=0.5}=0$. This matching between the discrete operator and the source term evaluation can lead to a cancellation of the leading error term, potentially restoring the formal second-order accuracy.\n\n- **Cases A, C, D:** The grids are chosen such that $N_y-1$ is always even ($16, 32, 64$ for A/C; $16, 32, 48$ for D). Thus, the kink is always aligned with the grid. We expect to observe near second-order convergence ($p \\approx 2$) for all norms.\n- **Case B:** The grids are chosen such that $N_y-1$ is always odd ($15, 31, 63$). The kink at $y=0.5$ is always misaligned, falling between grid lines. Here, we expect to observe the norm-dependent order degradation predicted by the theory: $p_{L_1} \\approx 2$, $p_{L_2} \\approx 1.5$, and $p_{L_\\infty} \\approx 1$.\n\n**5. Observed Order Calculation**\n\nGiven the error norms, $E$, computed on a sequence of grids, the observed order of accuracy, $p$, is estimated using the results from the two finest grids. If $E_2$ and $E_3$ are the errors on grids with effective spacings $h_2$ and $h_3$, respectively, then assuming $E \\approx C h^p$, we have:\n$$\n\\frac{E_2}{E_3} \\approx \\left(\\frac{h_2}{h_3}\\right)^p \\implies p = \\frac{\\log(E_2 / E_3)}{\\log(h_2 / h_3)}\n$$\nThe effective grid spacing is defined as $h = \\max(h_x, h_y)$. This procedure is applied to each of the $L_1$, $L_2$, and $L_\\infty$ error norms to determine their respective convergence orders.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.sparse import lil_matrix, csc_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef u_mms(x, y):\n    \"\"\"Computes the manufactured solution u_MMS(x, y).\"\"\"\n    return np.sin(2 * np.pi * x) * np.exp(y) + np.abs(y - 0.5)\n\ndef source_term(x, y, ax, ay, sigma):\n    \"\"\"Computes the source term s(x, y) for the manufactured solution.\"\"\"\n    dudx = 2 * np.pi * np.cos(2 * np.pi * x) * np.exp(y)\n    dudy = np.sin(2 * np.pi * x) * np.exp(y) + np.sign(y - 0.5)\n    u = u_mms(x, y)\n    return ax * dudx + ay * dudy + sigma * u\n\ndef solve_pde(Nx, Ny, ax, ay, sigma):\n    \"\"\"\n    Solves the 2D advection-reaction PDE on a grid of size (Nx, Ny)\n    and returns the L1, L2, and L_infinity error norms.\n    \"\"\"\n    hx = 1.0 / (Nx - 1)\n    hy = 1.0 / (Ny - 1)\n    \n    x = np.linspace(0, 1, Nx)\n    y = np.linspace(0, 1, Ny)\n    X, Y = np.meshgrid(x, y)\n\n    # Number of interior points\n    Ni = Nx - 2\n    Nj = Ny - 2\n    N_unknowns = Ni * Nj\n\n    if N_unknowns == 0:\n        return 0.0, 0.0, 0.0\n\n    # Assemble the sparse matrix A and vector b\n    A = lil_matrix((N_unknowns, N_unknowns))\n    b = np.zeros(N_unknowns)\n\n    C_W = -ax / (2 * hx)\n    C_E = ax / (2 * hx)\n    C_S = -ay / (2 * hy)\n    C_N = ay / (2 * hy)\n    C_P = sigma\n\n    for j in range(1, Ny - 1):      # Corresponds to rows of interior grid\n        for i in range(1, Nx - 1):  # Corresponds to columns of interior grid\n            k = (j - 1) * Ni + (i - 1)  # Row-major mapping to 1D index\n            \n            # Diagonal entry\n            A[k, k] = C_P\n\n            # Off-diagonal entries for neighbors\n            # West neighbor\n            if i > 1:\n                A[k, k - 1] = C_W\n            # East neighbor\n            if i  Nx - 2:\n                A[k, k + 1] = C_E\n            # South neighbor\n            if j > 1:\n                A[k, k - Ni] = C_S\n            # North neighbor\n            if j  Ny - 2:\n                A[k, k + Ni] = C_N\n\n            # Construct RHS vector b\n            b[k] = source_term(x[i], y[j], ax, ay, sigma)\n            \n            # Incorporate boundary conditions into RHS\n            if i == 1:       # Left boundary\n                b[k] -= C_W * u_mms(x[0], y[j])\n            if i == Nx - 2:  # Right boundary\n                b[k] -= C_E * u_mms(x[Nx - 1], y[j])\n            if j == 1:       # Bottom boundary\n                b[k] -= C_S * u_mms(x[i], y[0])\n            if j == Ny - 2:  # Top boundary\n                b[k] -= C_N * u_mms(x[i], y[Ny - 1])\n                \n    # Solve the linear system\n    A_csc = csc_matrix(A)\n    u_sol_vec = spsolve(A_csc, b)\n    \n    # Reshape solution to 2D grid of interior points\n    u_num = u_sol_vec.reshape((Nj, Ni))\n    \n    # Get exact solution on interior points\n    X_int, Y_int = np.meshgrid(x[1:-1], y[1:-1])\n    u_exact_int = u_mms(X_int, Y_int)\n\n    # Compute error\n    error = u_num - u_exact_int\n    \n    # Compute error norms\n    l1_norm = hx * hy * np.sum(np.abs(error))\n    l2_norm = np.sqrt(hx * hy * np.sum(error**2))\n    linf_norm = np.max(np.abs(error))\n    \n    return l1_norm, l2_norm, linf_norm\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    test_cases = [\n        # Case A: kink aligned, isotropic refinement\n        {'ax': 1.0, 'ay': 1.0, 'sigma': 2.0, 'grids': [(17, 17), (33, 33), (65, 65)]},\n        # Case B: kink misaligned, isotropic refinement\n        {'ax': 1.0, 'ay': 0.5, 'sigma': 1.0, 'grids': [(16, 16), (32, 32), (64, 64)]},\n        # Case C: weak advection, strong reaction, aligned kink\n        {'ax': 0.1, 'ay': 0.1, 'sigma': 10.0, 'grids': [(17, 17), (33, 33), (65, 65)]},\n        # Case D: anisotropic refinement, aligned kink\n        {'ax': 1.0, 'ay': 1.0, 'sigma': 2.0, 'grids': [(33, 17), (65, 33), (97, 49)]},\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        errors = []\n        h_effs = []\n        for Nx, Ny in case['grids']:\n            hx = 1.0 / (Nx - 1)\n            hy = 1.0 / (Ny - 1)\n            h_effs.append(max(hx, hy))\n            \n            l1, l2, linf = solve_pde(Nx, Ny, case['ax'], case['ay'], case['sigma'])\n            errors.append((l1, l2, linf))\n\n        # Errors from middle and fine grids\n        E2 = errors[1]\n        E3 = errors[2]\n        \n        # Effective grid spacings for middle and fine grids\n        h2 = h_effs[1]\n        h3 = h_effs[2]\n\n        # Calculate observed order of accuracy p\n        case_p_values = []\n        log_h_ratio = np.log(h2 / h3)\n        \n        for i in range(3): # For L1, L2, Linf norms\n            if E2[i] > 0 and E3[i] > 0:\n                p = np.log(E2[i] / E3[i]) / log_h_ratio\n            else:\n                p = 0.0 # Error is zero, no convergence to measure\n            case_p_values.append(p)\n        \n        all_results.append(case_p_values)\n\n    # Format the final output string\n    case_strings = []\n    for p_list in all_results:\n        num_strings = [f\"{val:.6f}\" for val in p_list]\n        case_strings.append(f\"[{','.join(num_strings)}]\")\n    \n    print(f\"[{','.join(case_strings)}]\")\n\nsolve()\n```", "id": "3326338"}]}