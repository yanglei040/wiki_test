{"hands_on_practices": [{"introduction": "To truly grasp the mechanics of Stein Variational Gradient Descent, it's invaluable to move from abstract theory to concrete computation. This first exercise provides a direct, hands-on calculation of a single SVGD update step for a simple two-particle system targeting a standard normal distribution. By working through the roles of the score function and the kernel gradient from first principles, you will build a foundational intuition for how particles are pushed and pulled through the probability landscape [@problem_id:3348310].", "problem": "Consider Stein Variational Gradient Descent (SVGD), which performs functional gradient descent on the Kullback–Leibler divergence by transporting a particle distribution via a velocity field in a Reproducing Kernel Hilbert Space (RKHS). In one dimension, the Stein operator for a differentiable target density $p(x)$ acting on a scalar test function $f$ is $T_{p} f(x) = f^{\\prime}(x) + f(x)\\,\\nabla_{x} \\ln p(x)$. Let the target be the standard normal density $p(x) = \\mathcal{N}(0,1)$, and let the RKHS be induced by the Radial Basis Function (RBF) kernel with bandwidth parameter $h > 0$ given by $k_{h}(x,x^{\\prime}) = \\exp\\!\\big(-\\frac{(x-x^{\\prime})^{2}}{2 h^{2}}\\big)$. You are given two initial particles at locations $x_{1}^{(0)} = -1$ and $x_{2}^{(0)} = 2$. Using the SVGD framework starting from the Stein operator definition and the RKHS representer property (without assuming any pre-stated closed-form update), derive the empirical SVGD particle update for a single iteration with step size $\\epsilon > 0$, and then compute the updated particle locations $x_{1}^{(1)}$ and $x_{2}^{(1)}$ explicitly as analytic functions of $h$ and $\\epsilon$. Express your final result in exact closed form (no rounding). The final answer must be a single row vector containing $x_{1}^{(1)}$ and $x_{2}^{(1)}$ as functions of $h$ and $\\epsilon$.", "solution": "The user has asked for a derivation of the Stein Variational Gradient Descent (SVGD) update rule and its application to a specific two-particle system.\n\n### Step 1: Problem Validation\nThe problem statement is validated against the specified criteria.\n\n- **Givens**:\n    -   Method: Stein Variational Gradient Descent (SVGD).\n    -   Stein operator (1D): $T_{p} f(x) = f^{\\prime}(x) + f(x)\\,\\nabla_{x} \\ln p(x)$.\n    -   Target density: $p(x) = \\mathcal{N}(0,1)$, the standard normal distribution.\n    -   Reproducing Kernel Hilbert Space (RKHS): Induced by the Radial Basis Function (RBF) kernel $k_{h}(x,x^{\\prime}) = \\exp(-\\frac{(x-x^{\\prime})^{2}}{2 h^{2}})$ with bandwidth $h > 0$.\n    -   Initial particle locations: $x_{1}^{(0)} = -1$ and $x_{2}^{(0)} = 2$.\n    -   Number of particles: $N=2$.\n    -   Iteration step size: $\\epsilon > 0$.\n-   **Validation**:\n    -   **Scientifically Grounded:** The problem uses standard, well-established concepts from Bayesian inference, machine learning, and functional analysis (SVGD, KL divergence, RKHS, Stein's method). It is scientifically sound.\n    -   **Well-Posed:** The problem provides all necessary information (target density, kernel, initial conditions, step size) to compute a unique, single-step update for the particle locations.\n    -   **Objective:** The problem is phrased in precise, technical language with no subjective or ambiguous elements.\n    -   The problem is self-contained, consistent, and feasible.\n\n-   **Verdict**: The problem is valid.\n\n### Step 2: Derivation of the SVGD Update Rule\n\nThe objective of SVGD is to transport an initial particle distribution $q_0$ to a target distribution $p$ by applying a velocity field $\\phi(x)$ to the particles. The particles are updated as $x' = x + \\epsilon \\phi(x)$. The optimal velocity field $\\phi(x)$ is the one that maximally decreases the Kullback–Leibler (KL) divergence, $KL(q_k || p)$, at each step. This corresponds to performing functional gradient descent on the KL divergence in an RKHS $\\mathcal{H}$.\n\nThe directional derivative of the KL divergence with respect to a perturbation in the direction of $\\phi$ is given by:\n$$ \\nabla_{\\phi} KL(q || p) = - \\mathbb{E}_{x \\sim q}[T_p \\phi(x)] $$\nwhere $T_p$ is the Stein operator. To achieve the steepest descent, we must choose $\\phi$ to maximize $\\mathbb{E}_{x \\sim q}[T_p \\phi(x)]$ subject to the constraint that $\\phi$ lies within a unit ball in the RKHS, i.e., $\\|\\phi\\|_{\\mathcal{H}} \\le 1$.\n\nThe expression $F[\\phi] = \\mathbb{E}_{x \\sim q}[T_p \\phi(x)]$ is a linear functional of $\\phi$. By the Riesz representation theorem, for any such linear functional on an RKHS, there exists a unique element $\\psi_q \\in \\mathcal{H}$ such that $F[\\phi] = \\langle \\phi, \\psi_q \\rangle_{\\mathcal{H}}$ for all $\\phi \\in \\mathcal{H}$. The function $\\phi$ that maximizes this inner product under the norm constraint is $\\phi = \\psi_q / \\|\\psi_q\\|_{\\mathcal{H}}$. The direction of steepest ascent is therefore given by $\\psi_q$.\n\nWe can find $\\psi_q$ using the reproducing property of the kernel $k(x, x')$. For any function $f \\in \\mathcal{H}$ and point $y$, we have $f(y) = \\langle f(\\cdot), k(y, \\cdot) \\rangle_{\\mathcal{H}}$. Applying this to $\\psi_q$:\n$$ \\psi_q(y) = \\langle \\psi_q(\\cdot), k(y, \\cdot) \\rangle_{\\mathcal{H}} $$\nSince the inner product is symmetric, $\\langle f, g \\rangle_{\\mathcal{H}} = \\langle g, f \\rangle_{\\mathcal{H}}$, and from the definition of $\\psi_q$, we have $\\langle k(y, \\cdot), \\psi_q(\\cdot) \\rangle_{\\mathcal{H}} = F[k(y, \\cdot)]$. Therefore:\n$$ \\psi_q(y) = F[k(y, \\cdot)] = \\mathbb{E}_{x \\sim q}[T_{p,x} k(y, x)] $$\nHere, $T_{p,x}$ denotes that the Stein operator acts on $k(y,x)$ as a function of its second argument, $x$.\nFor a symmetric kernel, $k(y,x) = k(x,y)$, the optimal velocity field at a point $y$ is:\n$$ \\phi^*(y) = \\psi_q(y) = \\mathbb{E}_{x \\sim q}[T_{p,x} k(x,y)] = \\mathbb{E}_{x \\sim q}[\\nabla_x k(x,y) + k(x,y) \\nabla_x \\ln p(x)] $$\nIn practice, the expectation over $q$ is approximated by an empirical average over the current set of $N$ particles $\\{x_i\\}_{i=1}^N$:\n$$ \\phi(y) \\approx \\frac{1}{N} \\sum_{i=1}^N [\\nabla_{x_i} k(x_i, y) + k(x_i, y) \\nabla_{x_i} \\ln p(x_i)] $$\nThe SVGD update for a particle $x_j$ is then $x_j^{(t+1)} = x_j^{(t)} + \\epsilon \\phi(x_j^{(t)})$, where the velocity field is evaluated at the particle's current location $x_j^{(t)}$:\n$$ \\phi(x_j^{(t)}) = \\frac{1}{N} \\sum_{i=1}^N [\\nabla_{x_i} k(x_i^{(t)}, x_j^{(t)}) + k(x_i^{(t)}, x_j^{(t)}) \\nabla_{x_i} \\ln p(x_i^{(t)})] $$\n\n### Step 3: Application to the Given Problem\n\nWe apply the derived update rule to the specifics of the problem.\n1.  **Target Distribution**: $p(x) = \\mathcal{N}(0,1) = \\frac{1}{\\sqrt{2\\pi}} \\exp(-\\frac{x^2}{2})$.\n    The log-density is $\\ln p(x) = -\\frac{x^2}{2} - \\frac{1}{2}\\ln(2\\pi)$.\n    The score function (gradient of the log-density) is $\\nabla_x \\ln p(x) = -x$.\n\n2.  **Kernel**: The RBF kernel is $k(x, x') = \\exp(-\\frac{(x-x')^2}{2h^2})$.\n    Its gradient with respect to the first argument is:\n    $$ \\nabla_x k(x, x') = \\frac{\\partial}{\\partial x} \\exp\\left(-\\frac{(x-x')^2}{2h^2}\\right) = \\exp\\left(-\\frac{(x-x')^2}{2h^2}\\right) \\cdot \\left(-\\frac{2(x-x')}{2h^2}\\right) = -k(x,x') \\frac{x-x'}{h^2} $$\n\n3.  **Particle Update Equation**: Let the particle locations at iteration $t=0$ be $\\{x_i^{(0)}\\}_{i=1}^N$. The velocity field for particle $x_j^{(0)}$ is:\n    $$ \\phi(x_j^{(0)}) = \\frac{1}{N} \\sum_{i=1}^N \\left[ -k(x_i^{(0)}, x_j^{(0)}) \\frac{x_i^{(0)} - x_j^{(0)}}{h^2} + k(x_i^{(0)}, x_j^{(0)}) (-x_i^{(0)}) \\right] $$\n    $$ \\phi(x_j^{(0)}) = \\frac{1}{N} \\sum_{i=1}^N k(x_i^{(0)}, x_j^{(0)}) \\left( -\\frac{x_i^{(0)} - x_j^{(0)}}{h^2} - x_i^{(0)} \\right) $$\n\n4.  **Initial Conditions**: We have $N=2$ particles at $x_1^{(0)} = -1$ and $x_2^{(0)} = 2$.\n\n5.  **Compute update for $x_1^{(1)}$**: Let $j=1$.\n    $$ \\phi(x_1^{(0)}) = \\frac{1}{2} \\left[ k(x_1^{(0)}, x_1^{(0)}) \\left( -\\frac{x_1^{(0)} - x_1^{(0)}}{h^2} - x_1^{(0)} \\right) + k(x_2^{(0)}, x_1^{(0)}) \\left( -\\frac{x_2^{(0)} - x_1^{(0)}}{h^2} - x_2^{(0)} \\right) \\right] $$\n    We compute the terms:\n    -   $x_1^{(0)} = -1$, $x_2^{(0)} = 2$.\n    -   $k(x_1^{(0)}, x_1^{(0)}) = \\exp(0) = 1$.\n    -   $k(x_2^{(0)}, x_1^{(0)}) = \\exp\\left(-\\frac{(2 - (-1))^2}{2h^2}\\right) = \\exp\\left(-\\frac{9}{2h^2}\\right)$.\n    -   Term for $i=1$: $1 \\cdot (0 - (-1)) = 1$.\n    -   Term for $i=2$: $\\exp\\left(-\\frac{9}{2h^2}\\right) \\left( -\\frac{2 - (-1)}{h^2} - 2 \\right) = \\exp\\left(-\\frac{9}{2h^2}\\right) \\left( -\\frac{3}{h^2} - 2 \\right)$.\n    The velocity is:\n    $$ \\phi(x_1^{(0)}) = \\frac{1}{2} \\left[ 1 - \\left( \\frac{3}{h^2} + 2 \\right) \\exp\\left(-\\frac{9}{2h^2}\\right) \\right] $$\n    The updated particle location is:\n    $$ x_1^{(1)} = x_1^{(0)} + \\epsilon \\phi(x_1^{(0)}) = -1 + \\frac{\\epsilon}{2} \\left[ 1 - \\left( 2 + \\frac{3}{h^2} \\right) \\exp\\left(-\\frac{9}{2h^2}\\right) \\right] $$\n\n6.  **Compute update for $x_2^{(1)}$**: Let $j=2$.\n    $$ \\phi(x_2^{(0)}) = \\frac{1}{2} \\left[ k(x_1^{(0)}, x_2^{(0)}) \\left( -\\frac{x_1^{(0)} - x_2^{(0)}}{h^2} - x_1^{(0)} \\right) + k(x_2^{(0)}, x_2^{(0)}) \\left( -\\frac{x_2^{(0)} - x_2^{(0)}}{h^2} - x_2^{(0)} \\right) \\right] $$\n    We compute the terms:\n    -   $k(x_1^{(0)}, x_2^{(0)}) = \\exp\\left(-\\frac{(-1 - 2)^2}{2h^2}\\right) = \\exp\\left(-\\frac{9}{2h^2}\\right)$.\n    -   $k(x_2^{(0)}, x_2^{(0)}) = 1$.\n    -   Term for $i=1$: $\\exp\\left(-\\frac{9}{2h^2}\\right) \\left( -\\frac{-1 - 2}{h^2} - (-1) \\right) = \\exp\\left(-\\frac{9}{2h^2}\\right) \\left( \\frac{3}{h^2} + 1 \\right)$.\n    -   Term for $i=2$: $1 \\cdot (0 - 2) = -2$.\n    The velocity is:\n    $$ \\phi(x_2^{(0)}) = \\frac{1}{2} \\left[ \\left( \\frac{3}{h^2} + 1 \\right) \\exp\\left(-\\frac{9}{2h^2}\\right) - 2 \\right] $$\n    The updated particle location is:\n    $$ x_2^{(1)} = x_2^{(0)} + \\epsilon \\phi(x_2^{(0)}) = 2 + \\frac{\\epsilon}{2} \\left[ \\left( 1 + \\frac{3}{h^2} \\right) \\exp\\left(-\\frac{9}{2h^2}\\right) - 2 \\right] $$\n    This simplifies to:\n    $$ x_2^{(1)} = 2 - \\epsilon + \\frac{\\epsilon}{2} \\left( 1 + \\frac{3}{h^2} \\right) \\exp\\left(-\\frac{9}{2h^2}\\right) $$\nThe final expressions for the updated particle locations are:\n$$ x_1^{(1)} = -1 + \\frac{\\epsilon}{2} \\left[ 1 - \\left( 2 + \\frac{3}{h^2} \\right) \\exp\\left(-\\frac{9}{2h^2}\\right) \\right] $$\n$$ x_2^{(1)} = 2 - \\epsilon + \\frac{\\epsilon}{2} \\left( 1 + \\frac{3}{h^2} \\right) \\exp\\left(-\\frac{9}{2h^2}\\right) $$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-1 + \\frac{\\epsilon}{2} \\left( 1 - \\left(2 + \\frac{3}{h^2}\\right) \\exp\\left(-\\frac{9}{2h^2}\\right) \\right) & 2 - \\epsilon + \\frac{\\epsilon}{2} \\left( 1 + \\frac{3}{h^2} \\right) \\exp\\left(-\\frac{9}{2h^2}\\right)\n\\end{pmatrix}\n}\n$$", "id": "3348310"}, {"introduction": "A key feature that distinguishes SVGD is its ability to prevent particles from collapsing to a single point, a common failure mode in other variational methods. This is achieved through a delicate interplay between an \"attraction\" force, driven by the target distribution's score function, and a \"repulsion\" force, generated by the kernel gradient. This practice provides a beautiful analytical demonstration of this mechanism, allowing you to derive the precise condition under which these two forces balance for a two-particle system [@problem_id:3348300]. Solving for this critical separation provides deep insight into how kernel bandwidth and target variance cooperatively maintain particle diversity.", "problem": "Consider Stein Variational Gradient Descent (SVGD), defined by the functional gradient flow that transports a set of particles to approximate a target density $p(x)$. For a finite set of $n$ particles $\\{x_{i}\\}_{i=1}^{n}$ in $\\mathbb{R}^{d}$, the empirical SVGD velocity at particle $x_{i}$ is\n$$\n\\phi(x_{i}) \\;=\\; \\frac{1}{n} \\sum_{j=1}^{n} \\Big( k(x_{j},x_{i}) \\,\\nabla \\ln p(x_{j}) \\;+\\; \\nabla_{x_{j}} k(x_{j},x_{i}) \\Big),\n$$\nwhere $k(x,y)$ is a positive definite kernel and $\\nabla$ denotes gradient with respect to the argument. In SVGD, the first term is the attraction toward high-density regions and the second term is a repulsion that spreads particles. Let the kernel be the Gaussian radial basis function (RBF) kernel $k(x,y) = \\exp\\!\\big(-\\|x-y\\|^{2}/(2 h^{2})\\big)$ with bandwidth $h>0$.\n\nTask A (scaling of repulsion): In one dimension ($d=1$), for $n=2$ particles at locations $x_{1}$ and $x_{2}$ with inter-particle distance $d = |x_{1}-x_{2}|$, derive the magnitude of the pairwise repulsion contribution from $x_{2}$ to the velocity of $x_{1}$ as a function of $d$ and $h$. You must express it in closed form using only $d$ and $h$.\n\nTask B (quantitative avoidance of mode collapse): Consider the one-dimensional Gaussian target $p(x) = \\mathcal{N}(0,\\sigma^{2})$ with variance $\\sigma^{2} > 0$. Place $n=2$ particles symmetrically at $x_{1}=a$ and $x_{2}=-a$ with $a>0$. Using only the SVGD definition above and the RBF kernel given, compute the exact condition under which the radial component of the SVGD velocity at $x_{1}$ points outward (i.e., increases $|a|$). Then, solve for the unique critical separation $a_{c}(h,\\sigma)$ for which the radial SVGD velocity at $x_{1}$ is exactly zero. Your final answer must be a single closed-form analytic expression for $a_{c}(h,\\sigma)$ with no unevaluated limits or implicit definitions.\n\nAnswer format requirement: Provide only the analytic expression for $a_{c}(h,\\sigma)$ as your final answer. Do not include units. No rounding is required.", "solution": "The user has provided a valid problem statement concerning the properties of Stein Variational Gradient Descent (SVGD). The problem is scientifically grounded, well-posed, and contains all necessary information for a rigorous mathematical derivation. I will proceed with a complete solution.\n\nThe problem is divided into two tasks. I will solve them sequentially to arrive at the final required expression for the critical separation $a_{c}(h, \\sigma)$.\n\nFirst, let's establish the necessary mathematical components.\nThe SVGD velocity at particle $x_i$ is given by:\n$$ \\phi(x_{i}) = \\frac{1}{n} \\sum_{j=1}^{n} \\left( k(x_{j},x_{i}) \\nabla \\ln p(x_{j}) + \\nabla_{x_{j}} k(x_{j},x_{i}) \\right) $$\nThe kernel is the one-dimensional ($d=1$) Gaussian RBF kernel:\n$$ k(x,y) = \\exp\\left(-\\frac{(x-y)^2}{2h^2}\\right) $$\nThe gradient of the kernel with respect to its first argument, $x_j$, is:\n$$ \\nabla_{x_{j}} k(x_{j},x_{i}) = \\frac{\\partial}{\\partial x_j} \\exp\\left(-\\frac{(x_j-x_i)^2}{2h^2}\\right) = \\exp\\left(-\\frac{(x_j-x_i)^2}{2h^2}\\right) \\cdot \\left(-\\frac{2(x_j-x_i)}{2h^2}\\right) = -\\frac{x_j-x_i}{h^2} k(x_j,x_i) $$\n\n**Task A: Scaling of Repulsion**\n\nThis task requires the magnitude of the pairwise repulsion contribution from particle $x_2$ to the velocity of particle $x_1$. The number of particles is $n=2$. The repulsion contribution is the part of the velocity update involving the kernel gradient. For the velocity $\\phi(x_1)$, the term corresponding to $j=2$ contains the repulsion from $x_2$. This contribution is given by $\\frac{1}{n} \\nabla_{x_2} k(x_2, x_1)$.\n\nUsing $n=2$ and the derivative calculated above:\n$$ \\text{Repulsion from } x_2 \\text{ on } x_1 = \\frac{1}{2} \\nabla_{x_2} k(x_2, x_1) = \\frac{1}{2} \\left( -\\frac{x_2-x_1}{h^2} k(x_2, x_1) \\right) = \\frac{x_1-x_2}{2h^2} k(x_1, x_2) $$\nThe problem asks for the magnitude of this term. Let $d = |x_1 - x_2|$. The kernel $k(x_1, x_2)$ is always positive.\n$$ k(x_1, x_2) = \\exp\\left(-\\frac{(x_1-x_2)^2}{2h^2}\\right) = \\exp\\left(-\\frac{d^2}{2h^2}\\right) $$\nThe magnitude is therefore:\n$$ \\left| \\frac{x_1-x_2}{2h^2} k(x_1, x_2) \\right| = \\frac{|x_1-x_2|}{2h^2} k(x_1, x_2) = \\frac{d}{2h^2} \\exp\\left(-\\frac{d^2}{2h^2}\\right) $$\nThis expression represents the magnitude of the repulsion force exerted by one particle on another as a function of their separation $d$ and the kernel bandwidth $h$.\n\n**Task B: Quantitative Avoidance of Mode Collapse**\n\nThis task requires us to find the critical separation $a_c(h, \\sigma)$ for a specific setup.\nThe given setup is:\n- Dimension: $d=1$.\n- Number of particles: $n=2$.\n- Particle locations: $x_1 = a$ and $x_2 = -a$, with $a > 0$.\n- Target density: $p(x) = \\mathcal{N}(0, \\sigma^2) = \\frac{1}{\\sqrt{2\\pi\\sigma^2}} \\exp\\left(-\\frac{x^2}{2\\sigma^2}\\right)$.\n\nWe first compute the gradient of the log-target density:\n$$ \\ln p(x) = -\\ln(\\sqrt{2\\pi}\\sigma) - \\frac{x^2}{2\\sigma^2} $$\n$$ \\nabla \\ln p(x) = \\frac{d}{dx} \\ln p(x) = -\\frac{x}{\\sigma^2} $$\nAt the particle locations, we have:\n$$ \\nabla \\ln p(x_1) = \\nabla \\ln p(a) = -\\frac{a}{\\sigma^2} $$\n$$ \\nabla \\ln p(x_2) = \\nabla \\ln p(-a) = -\\frac{-a}{\\sigma^2} = \\frac{a}{\\sigma^2} $$\n\nNext, we evaluate the SVGD velocity at $x_1 = a$. The velocity expression is:\n$$ \\phi(x_1) = \\frac{1}{2} \\left[ \\left( k(x_1, x_1) \\nabla\\ln p(x_1) + \\nabla_{x_1} k(x_1, x_1) \\right) + \\left( k(x_2, x_1) \\nabla\\ln p(x_2) + \\nabla_{x_2} k(x_2, x_1) \\right) \\right] $$\nWe compute each term in the sum:\n\nTerm 1 (interaction with self, $j=1$):\n- $k(x_1, x_1) = k(a,a) = \\exp(0) = 1$.\n- $\\nabla\\ln p(x_1) = -a/\\sigma^2$.\n- $\\nabla_{x_1} k(x_1, x_1) = -\\frac{x_1-x_1}{h^2} k(x_1,x_1) = 0$.\nSo, the first term in brackets is $(1 \\cdot (-a/\\sigma^2) + 0) = -a/\\sigma^2$.\n\nTerm 2 (interaction with $x_2$, $j=2$):\n- $x_2 - x_1 = -a - a = -2a$.\n- $k(x_2, x_1) = k(-a, a) = \\exp\\left(-\\frac{(-2a)^2}{2h^2}\\right) = \\exp\\left(-\\frac{2a^2}{h^2}\\right)$.\n- $\\nabla\\ln p(x_2) = a/\\sigma^2$.\n- $\\nabla_{x_2} k(x_2, x_1) = -\\frac{x_2-x_1}{h^2} k(x_2, x_1) = -\\frac{-2a}{h^2} \\exp\\left(-\\frac{2a^2}{h^2}\\right) = \\frac{2a}{h^2} \\exp\\left(-\\frac{2a^2}{h^2}\\right)$.\nSo, the second term in brackets is:\n$$ \\exp\\left(-\\frac{2a^2}{h^2}\\right) \\cdot \\left(\\frac{a}{\\sigma^2}\\right) + \\frac{2a}{h^2} \\exp\\left(-\\frac{2a^2}{h^2}\\right) = \\exp\\left(-\\frac{2a^2}{h^2}\\right) \\left( \\frac{a}{\\sigma^2} + \\frac{2a}{h^2} \\right) $$\n\nNow, we assemble the full expression for $\\phi(x_1)$:\n$$ \\phi(x_1) = \\frac{1}{2} \\left[ -\\frac{a}{\\sigma^2} + \\exp\\left(-\\frac{2a^2}{h^2}\\right) \\left( \\frac{a}{\\sigma^2} + \\frac{2a}{h^2} \\right) \\right] $$\nFactoring out $a/2$:\n$$ \\phi(x_1) = \\frac{a}{2} \\left[ -\\frac{1}{\\sigma^2} + \\exp\\left(-\\frac{2a^2}{h^2}\\right) \\left( \\frac{1}{\\sigma^2} + \\frac{2}{h^2} \\right) \\right] $$\nThe critical separation $a_c$ is defined as the value of $a$ for which the velocity is zero, i.e., $\\phi(x_1) = 0$. Since we are given $a>0$, we need the term in the square brackets to be zero. Let $a = a_c$:\n$$ -\\frac{1}{\\sigma^2} + \\exp\\left(-\\frac{2a_c^2}{h^2}\\right) \\left( \\frac{1}{\\sigma^2} + \\frac{2}{h^2} \\right) = 0 $$\n$$ \\exp\\left(-\\frac{2a_c^2}{h^2}\\right) \\left( \\frac{1}{\\sigma^2} + \\frac{2}{h^2} \\right) = \\frac{1}{\\sigma^2} $$\n$$ \\exp\\left(-\\frac{2a_c^2}{h^2}\\right) = \\frac{1/\\sigma^2}{1/\\sigma^2 + 2/h^2} $$\nTo simplify the right-hand side, we find a common denominator:\n$$ \\frac{1/\\sigma^2}{(h^2 + 2\\sigma^2)/(\\sigma^2 h^2)} = \\frac{1}{\\sigma^2} \\cdot \\frac{\\sigma^2 h^2}{h^2 + 2\\sigma^2} = \\frac{h^2}{h^2 + 2\\sigma^2} $$\nThe equation for $a_c$ is:\n$$ \\exp\\left(-\\frac{2a_c^2}{h^2}\\right) = \\frac{h^2}{h^2 + 2\\sigma^2} $$\nTo solve for $a_c$, we take the natural logarithm of both sides:\n$$ -\\frac{2a_c^2}{h^2} = \\ln\\left(\\frac{h^2}{h^2 + 2\\sigma^2}\\right) $$\nUsing the property $\\ln(x/y) = -\\ln(y/x)$:\n$$ \\frac{2a_c^2}{h^2} = \\ln\\left(\\frac{h^2 + 2\\sigma^2}{h^2}\\right) = \\ln\\left(1 + \\frac{2\\sigma^2}{h^2}\\right) $$\nNow, we solve for $a_c^2$:\n$$ a_c^2 = \\frac{h^2}{2} \\ln\\left(1 + \\frac{2\\sigma^2}{h^2}\\right) $$\nSince $a > 0$, we take the positive square root:\n$$ a_c(h, \\sigma) = \\sqrt{\\frac{h^2}{2} \\ln\\left(1 + \\frac{2\\sigma^2}{h^2}\\right)} $$\nThis can be written as:\n$$ a_c(h, \\sigma) = h \\sqrt{\\frac{1}{2} \\ln\\left(1 + \\frac{2\\sigma^2}{h^2}\\right)} $$\nThis is the unique critical separation for which the SVGD velocity at $x_1=a$ is zero. For $a  a_c$, the term $\\exp(-2a^2/h^2)$ is larger, making the velocity positive (outward repulsion dominates). For $a > a_c$, the velocity is negative (inward attraction to the mode at $x=0$ dominates).", "answer": "$$ \\boxed{h \\sqrt{\\frac{1}{2} \\ln\\left(1 + \\frac{2\\sigma^2}{h^2}\\right)}} $$", "id": "3348300"}, {"introduction": "Having explored the static balance of forces in a unimodal setting, we now turn to a more complex and practical scenario: a multi-modal target distribution. A crucial test for any advanced sampling algorithm is its ability to discover multiple, well-separated modes. This exercise applies the tools of dynamical systems analysis to predict the behavior of an SVGD particle system initialized in the low-probability region between two modes [@problem_id:3348233]. By linearizing the SVGD dynamics, you will derive a clear condition that determines whether the particles will \"split\" and successfully find both modes, revealing how algorithmic parameters govern the global exploratory power of SVGD.", "problem": "Consider a one-dimensional target probability density that is a symmetric mixture of two Gaussian components separated by a distance, and the Stein Variational Gradient Descent (SVGD) dynamics starting from a unimodal initialization centered at the origin. The objective is to derive from first principles a condition that predicts whether, at early times, the SVGD particle system will split into two groups that move toward the two modes of the target.\n\nYou are given the following foundational definitions:\n\n- The target density is a symmetric mixture\n$$\np(x) = \\tfrac{1}{2} \\,\\mathcal{N}(x \\mid -m, s^2) + \\tfrac{1}{2} \\,\\mathcal{N}(x \\mid m, s^2),\n$$\nwhere $\\mathcal{N}(x \\mid \\mu, \\sigma^2)$ denotes the Gaussian density with mean $\\mu$ and variance $\\sigma^2$, and the parameters $m > 0$ and $s > 0$ represent the half-separation and the component standard deviation, respectively.\n\n- Stein Variational Gradient Descent (SVGD) updates $n$ particles $\\{x_i\\}_{i=1}^n$ according to the functional gradient in a Reproducing Kernel Hilbert Space (RKHS), yielding the vector field\n$$\n\\phi(x) \\;=\\; \\mathbb{E}_{X \\sim q}\\Big[\\,k(X,x)\\,\\nabla \\log p(X) \\;+\\; \\nabla_X k(X,x)\\,\\Big],\n$$\nwhere $q$ is the current particle empirical distribution, $k$ is a positive-definite kernel, and $\\nabla$ denotes derivative with respect to the argument. In the continuum limit, the SVGD transport field acting on the particle location $x$ is given by the expectation above. The Radial Basis Function (RBF) kernel is specified as\n$$\nk(x,y) \\;=\\; \\exp\\!\\left(-\\frac{(x-y)^2}{2 h^2}\\right),\n$$\nwith bandwidth $h > 0$.\n\n- The initialization is unimodal at the origin with a small but nonzero variance,\n$$\nq_0 \\;=\\; \\mathcal{N}(x \\mid 0, v_0),\n$$\nwhere $v_0 > 0$ encodes the initial spread of particles around $x = 0$.\n\nTask:\n\n1. Using only the definitions above and standard properties of Gaussian integrals and derivatives, derive the linearization of the SVGD transport field $\\phi(x)$ near $x = 0$ under the continuum approximation $q \\approx q_0$. Show that the early-time dynamics of a particle at position $x$ satisfy an equation of the form\n$$\n\\frac{dx}{dt} \\;\\approx\\; A\\,x,\n$$\nand obtain from first principles an explicit expression for the growth coefficient $A$ as a function of $m$, $s$, $h$, and $v_0$.\n\n2. Justify why the sign of $A$ determines the splitting behavior: if $A > 0$, an infinitesimal displacement $x > 0$ grows, leading to splitting of the mass toward the two modes; if $A \\le 0$, the origin is not linearly unstable, and mass does not split under the linearized dynamics.\n\n3. Implement a program that, for each test case below, computes the value of $A$ and outputs a boolean indicating whether splitting is predicted ($\\text{True}$ if $A > 0$, otherwise $\\text{False}$). Your computation must be scientifically sound and may use exact Gaussian expectations where available and numerical quadrature where needed for expectations involving $\\tanh(\\cdot)$.\n\nTest suite:\n\n- Case 1: $(3.0, 1.0, 1.0, 0.01)$\n- Case 2: $(3.0, 1.0, 3.0, 0.01)$\n- Case 3: $(0.5, 1.0, 1.0, 0.01)$\n- Case 4: $(3.0, 1.0, 0.05, 0.001)$\n- Case 5: $(3.0, 1.0, 1.0, 1.0)$\n\nFinal output format:\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets; for example, for three cases the format would be\n$$\n[\\text{True},\\text{False},\\text{True}].\n$$\nNo additional text should be printed.", "solution": "The user wants me to derive a condition for the splitting of a particle system in Stein Variational Gradient Descent (SVGD) and implement a program to test this condition.\n\n### Step 1: Extract Givens\n- **Target Density ($p(x)$)**: A symmetric mixture of two Gaussians:\n  $$p(x) = \\frac{1}{2} \\mathcal{N}(x \\mid -m, s^2) + \\frac{1}{2} \\mathcal{N}(x \\mid m, s^2)$$\n  where $m  0$ is the half-separation and $s  0$ is the standard deviation of the components.\n\n- **SVGD Transport Field ($\\phi(x)$)**: In the continuum limit with particle distribution $q(x)$:\n  $$\\phi(x) = \\mathbb{E}_{X \\sim q}\\left[ k(X,x) \\nabla \\log p(X) + \\nabla_X k(X,x) \\right]$$\n\n- **Kernel ($k(x,y)$)**: A Radial Basis Function (RBF) kernel:\n  $$k(x,y) = \\exp\\left(-\\frac{(x-y)^2}{2 h^2}\\right)$$\n  with bandwidth $h  0$.\n\n- **Initial Distribution ($q_0$)**: A unimodal Gaussian centered at the origin:\n  $$q_0(x) = \\mathcal{N}(x \\mid 0, v_0)$$\n  where $v_0 > 0$ is the initial variance.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, well-posed, and objective. It asks for a stability analysis of a well-defined dynamical system (SVGD) under specific, mathematically sound conditions. The setup is self-contained and consistent. No scientific principles are violated. The task is a standard exercise in the analysis of stochastic methods. The problem is valid.\n\n### Step 3: Derivation of the Growth Coefficient A\n\nThe problem asks for an analysis of the early-time dynamics of a particle. The dynamics are given by the ODE $\\frac{dx}{dt} = \\phi(x)$. At early times, the particle distribution $q$ is well-approximated by the initial distribution $q_0 = \\mathcal{N}(x \\mid 0, v_0)$. The transport field is thus:\n$$ \\phi(x) \\approx \\mathbb{E}_{X \\sim q_0}\\left[ k(X,x) \\nabla \\log p(X) + \\nabla_X k(X,x) \\right] $$\nWe linearize this field around the origin $x=0$. The Taylor expansion is $\\phi(x) \\approx \\phi(0) + x \\phi'(0)$.\n\nFirst, we evaluate $\\phi(0)$. The arguments of the expectation are taken with respect to $X \\sim \\mathcal{N}(0, v_0)$, a distribution symmetric about $0$.\n$$ \\phi(0) = \\mathbb{E}_{X \\sim q_0}\\left[ k(X,0) \\nabla \\log p(X) + \\nabla_X k(X,0) \\right] $$\nThe kernel derivative is $\\nabla_X k(X,x) = \\frac{x-X}{h^2} k(X,x)$. At $x=0$, this becomes $-\\frac{X}{h^2} k(X,0)$.\nThe score function $\\nabla \\log p(X)$ must be computed. First, we write $p(x)$ as:\n$$ p(x) \\propto \\exp\\left(-\\frac{(x+m)^2}{2s^2}\\right) + \\exp\\left(-\\frac{(x-m)^2}{2s^2}\\right) = \\exp\\left(-\\frac{x^2+m^2}{2s^2}\\right) \\left[ \\exp\\left(-\\frac{xm}{s^2}\\right) + \\exp\\left(\\frac{xm}{s^2}\\right) \\right] $$\n$$ p(x) \\propto \\exp\\left(-\\frac{x^2+m^2}{2s^2}\\right) \\cosh\\left(\\frac{xm}{s^2}\\right) $$\nTaking the logarithm and differentiating with respect to $x$:\n$$ \\log p(x) = C - \\frac{x^2+m^2}{2s^2} + \\log\\left(\\cosh\\left(\\frac{xm}{s^2}\\right)\\right) $$\n$$ \\nabla \\log p(x) = \\frac{d}{dx}\\log p(x) = -\\frac{x}{s^2} + \\frac{1}{\\cosh\\left(\\frac{xm}{s^2}\\right)} \\sinh\\left(\\frac{xm}{s^2}\\right) \\frac{m}{s^2} = -\\frac{x}{s^2} + \\frac{m}{s^2} \\tanh\\left(\\frac{xm}{s^2}\\right) $$\nLet $\\psi(X) = \\nabla \\log p(X)$.\nThe full expression for $\\phi(0)$ is:\n$$ \\phi(0) = \\mathbb{E}_{X \\sim q_0}\\left[ k(X,0) \\left(-\\frac{X}{s^2} + \\frac{m}{s^2} \\tanh\\left(\\frac{Xm}{s^2}\\right)\\right) - \\frac{X}{h^2} k(X,0) \\right] $$\nThe term inside the expectation is $k(X,0) \\left[ -X\\left(\\frac{1}{s^2}+\\frac{1}{h^2}\\right) + \\frac{m}{s^2} \\tanh\\left(\\frac{Xm}{s^2}\\right) \\right]$.\nSince $k(X,0) = \\exp(-X^2/2h^2)$ is an even function of $X$, and the term in brackets is an odd function of $X$, the entire integrand is odd. The expectation of an odd function over a symmetric distribution $\\mathcal{N}(0, v_0)$ is zero. Thus, $\\phi(0) = 0$.\n\nThe linearized dynamics are therefore $\\frac{dx}{dt} \\approx x \\phi'(0)$, which means the growth coefficient is $A = \\phi'(0)$. We compute this derivative:\n$$ A = \\phi'(0) = \\frac{d}{dx} \\mathbb{E}_{X \\sim q_0}\\left[ k(X,x) \\psi(X) + \\nabla_X k(X,x) \\right] \\bigg|_{x=0} $$\nWe can swap expectation and differentiation:\n$$ A = \\mathbb{E}_{X \\sim q_0}\\left[ \\frac{d}{dx} \\left( k(X,x) \\psi(X) + \\frac{x-X}{h^2}k(X,x) \\right) \\bigg|_{x=0} \\right] $$\nUsing the product rule and evaluating at $x=0$:\n$$ A = \\mathbb{E}_{X \\sim q_0}\\left[ (\\nabla_x k(X,x)|_{x=0}) \\psi(X) + k(X,0) (\\nabla_x \\psi(X)|_{x=0}) + \\left(\\frac{1}{h^2}k(X,x) + \\frac{x-X}{h^2}\\nabla_x k(X,x)\\right)\\bigg|_{x=0} \\right] $$\nNote that $\\nabla_x \\psi(X) = 0$ as $\\psi$ is a function of $X$ only. Also, $\\nabla_x k(X,x)|_{x=0} = \\frac{X-x}{h^2}k(X,x)|_{x=0} = \\frac{X}{h^2}k(X,0)$.\n$$ A = \\mathbb{E}_{X \\sim q_0}\\left[ \\frac{X}{h^2}k(X,0) \\psi(X) + \\frac{1}{h^2}k(X,0) - \\frac{X}{h^2}\\frac{X}{h^2}k(X,0) \\right] $$\n$$ A = \\mathbb{E}_{X \\sim q_0}\\left[ k(X,0) \\left( \\frac{X}{h^2}\\psi(X) + \\frac{1}{h^2} - \\frac{X^2}{h^4} \\right) \\right] $$\nSubstituting $\\psi(X) = -X/s^2 + (m/s^2) \\tanh(Xm/s^2)$:\n$$ A = \\mathbb{E}_{X \\sim q_0}\\left[ e^{-X^2/2h^2} \\left( \\frac{X}{h^2}\\left(-\\frac{X}{s^2} + \\frac{m}{s^2}\\tanh\\left(\\frac{Xm}{s^2}\\right)\\right) + \\frac{1}{h^2} - \\frac{X^2}{h^4} \\right) \\right] $$\n$$ A = \\mathbb{E}_{X \\sim q_0}\\left[ e^{-X^2/2h^2} \\left( \\frac{1}{h^2} - X^2\\left(\\frac{1}{s^2h^2} + \\frac{1}{h^4}\\right) + \\frac{Xm}{s^2h^2}\\tanh\\left(\\frac{Xm}{s^2}\\right) \\right) \\right] $$\nThis expression can be broken into three terms by linearity of expectation:\n$$ A = \\frac{1}{h^2}\\mathbb{E}[e^{-X^2/2h^2}] - \\left(\\frac{s^2+h^2}{s^2h^4}\\right)\\mathbb{E}[X^2e^{-X^2/2h^2}] + \\frac{m}{s^2h^2}\\mathbb{E}\\left[X\\tanh\\left(\\frac{Xm}{s^2}\\right)e^{-X^2/2h^2}\\right] $$\nwhere expectations are over $X \\sim \\mathcal{N}(0, v_0)$. The first two expectations are analytic. For a random variable $X \\sim \\mathcal{N}(0, v_0)$, we use the standard results for Gaussian integrals:\n$$ I_0 = \\mathbb{E}[e^{-X^2/2h^2}] = \\int_{-\\infty}^{\\infty} e^{-X^2/2h^2} \\frac{1}{\\sqrt{2\\pi v_0}} e^{-X^2/2v_0} dX = \\frac{h}{\\sqrt{v_0+h^2}} $$\n$$ I_2 = \\mathbb{E}[X^2e^{-X^2/2h^2}] = \\int_{-\\infty}^{\\infty} X^2 \\frac{1}{\\sqrt{2\\pi v_0}} e^{-X^2(1/2v_0+1/2h^2)} dX = \\frac{v_0 h^3}{(v_0+h^2)^{3/2}} $$\nThe third expectation, involving $\\tanh(\\cdot)$, does not have a simple closed form and will be computed numerically:\n$$ I_{\\tanh} = \\mathbb{E}\\left[X\\tanh\\left(\\frac{Xm}{s^2}\\right)e^{-X^2/2h^2}\\right] = \\int_{-\\infty}^{\\infty} X \\tanh\\left(\\frac{Xm}{s^2}\\right) e^{-X^2/2h^2} \\frac{1}{\\sqrt{2\\pi v_0}} e^{-X^2/2v_0} dX $$\nCombining these, the final expression for $A$ is:\n$$ A = \\frac{1}{h^2} \\frac{h}{\\sqrt{v_0+h^2}} - \\frac{s^2+h^2}{s^2h^4} \\frac{v_0 h^3}{(v_0+h^2)^{3/2}} + \\frac{m}{s^2h^2} I_{\\tanh} $$\n$$ A = \\frac{1}{h\\sqrt{v_0+h^2}} - \\frac{(s^2+h^2)v_0}{s^2h(v_0+h^2)^{3/2}} + \\frac{m}{s^2h^2} I_{\\tanh} $$\n\n### Justification of the Splitting Criterion\n\nThe linearized dynamics near the origin are given by the ODE $\\frac{dx}{dt} = A x$. The solution to this equation is $x(t) = x(0) e^{At}$.\n- If $A > 0$, any infinitesimal perturbation $x(0) \\neq 0$ will grow exponentially in time. A particle with initial position $x(0) > 0$ will move towards positive infinity (i.e., towards the mode at $+m$), and a particle with $x(0)  0$ will move towards negative infinity (towards the mode at $-m$). This behavior describes the splitting of the particle system into two groups.\n- If $A \\leq 0$, the perturbation $x(0)$ will either decay to zero ($A0$) or remain constant ($A=0$) under the linearized dynamics. In either case, the origin is stable or neutrally stable, and there is no exponential separation of particles. Therefore, the particle system does not split.\n\nThe sign of $A$ is the sole determinant of splitting in this linearized model.\n\n### Implementation Details\n\nA Python program will be implemented to compute the value of $A$ for each test case.\n1. The analytical parts of the formula for $A$ will be computed directly.\n2. The integral $I_{\\tanh}$ will be computed using numerical quadrature, specifically `scipy.integrate.quad`. The integrand is a well-behaved function that decays rapidly to zero.\n3. The final value of $A$ is computed by summing the terms.\n4. The result for each test case is `True` if $A > 0$ and `False` otherwise.", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Computes the splitting condition for SVGD dynamics for a set of test cases.\n    \"\"\"\n\n    test_cases = [\n        (3.0, 1.0, 1.0, 0.01),\n        (3.0, 1.0, 3.0, 0.01),\n        (0.5, 1.0, 1.0, 0.01),\n        (3.0, 1.0, 0.05, 0.001),\n        (3.0, 1.0, 1.0, 1.0),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        m, s, h, v0 = case\n        \n        # Avoid division by zero for parameters, although given test cases are safe.\n        if s = 0 or h = 0 or v0 = 0:\n            # Invalid parameters, but we must produce a boolean.\n            # Define behavior for such cases if they were possible.\n            # A  0 prediction is less likely for ill-defined cases.\n            results.append(False)\n            continue\n\n        # Term 1 of A\n        # A1 = 1 / (h * sqrt(v0 + h^2))\n        term1 = 1.0 / (h * np.sqrt(v0 + h**2))\n\n        # Term 2 of A\n        # A2 = - (s^2 + h^2) * v0 / (s^2 * h * (v0 + h^2)^(3/2))\n        term2_numerator = (s**2 + h**2) * v0\n        term2_denominator = (s**2 * h * (v0 + h**2)**1.5)\n        term2 = -term2_numerator / term2_denominator\n\n        # Term 3 of A involves a numerical integral for I_tanh\n        # I_tanh = integral(X * tanh(X*m/s^2) * exp(-X^2/(2*h^2)) * N(X|0, v0)) dX\n        # The integrand can be simplified by combining the Gaussians.\n        v_c = (v0 * h**2) / (v0 + h**2)\n\n        def integrand(X):\n            \"\"\"\n            The function to be integrated for I_tanh calculation.\n            Integrand = X * tanh(X*m/s^2) * exp(-X^2/2h^2) * PDF_of_N(0,v0)\n                      = X * tanh(X*m/s^2) * (1/sqrt(2pi*v0)) * exp(-X^2/(2*v_c))\n            \"\"\"\n            factor = 1.0 / np.sqrt(2.0 * np.pi * v0)\n            return X * np.tanh(X * m / s**2) * factor * np.exp(-X**2 / (2.0 * v_c))\n\n        # Perform numerical integration\n        # The integrand is symmetric and well-behaved, quad is efficient.\n        # quad returns a tuple (result, estimated_error)\n        i_tanh, _ = quad(integrand, -np.inf, np.inf)\n\n        # A3 = (m / (s^2 * h^2)) * I_tanh\n        term3 = (m / (s**2 * h**2)) * i_tanh\n\n        # The growth coefficient A is the sum of the three terms.\n        A = term1 + term2 + term3\n\n        # Splitting is predicted if A  0\n        results.append(A  0)\n\n    # Print results in the specified format\n    print(f\"[{','.join(map(str, results))}]\".replace(\"True\", \"True\").replace(\"False\", \"False\"))\n\nsolve()\n\n```", "id": "3348233"}]}