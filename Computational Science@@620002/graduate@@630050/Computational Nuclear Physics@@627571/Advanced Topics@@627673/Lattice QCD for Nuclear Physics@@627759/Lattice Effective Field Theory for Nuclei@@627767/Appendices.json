{"hands_on_practices": [{"introduction": "To translate continuum physics onto a discrete computational lattice, we must replace continuous derivatives with finite differences. This foundational practice explores the consequences of this crucial step for a free particle's energy-momentum relationship. By deriving the lattice dispersion relation, you will uncover how the underlying cubic grid explicitly breaks continuous rotational symmetry and develop a quantitative measure for this unavoidable artifact.", "problem": "Consider low-energy nuclear dynamics formulated within Effective Field Theory (EFT) on a three-dimensional cubic spatial lattice with lattice spacing $a$ and Periodic Boundary Conditions (PBC). Work in the one-nucleon sector where interactions are absent and the dynamics are governed by the nonrelativistic kinetic energy operator. The continuum free-particle Hamiltonian is given by $H = -\\frac{\\hbar^2}{2m}\\nabla^2$, where $m$ is the nucleon mass and $\\hbar$ is Planck’s constant divided by $2\\pi$. On the lattice, the kinetic term is defined by a discrete Laplacian constructed to be accurate to order $\\mathcal{O}(a^2)$ and to respect cubic symmetry. \n\nStarting from the Taylor expansion of $f(\\mathbf{r} \\pm a\\hat{\\mathbf{e}}_{i})$ about $f(\\mathbf{r})$ and the requirement that the discrete Laplacian approximate the continuum Laplacian $\\nabla^2$ with truncation error $\\mathcal{O}(a^2)$, construct the seven-point stencil for the lattice Laplacian in three dimensions, and hence the corresponding lattice kinetic operator. Using this lattice operator, derive the single-particle dispersion relation $E(\\mathbf{k})$ for a plane-wave eigenstate $\\psi(\\mathbf{r}) = \\exp(i\\mathbf{k}\\cdot\\mathbf{r})$ of lattice momentum $\\mathbf{k}$.\n\nTo quantify rotational symmetry breaking induced by the lattice discretization, consider two momenta with the same magnitude $|\\mathbf{k}| = k$: one along a coordinate axis, $\\mathbf{k}_{\\text{ax}} = (k, 0, 0)$, and one along the body diagonal, $\\mathbf{k}_{\\text{bd}} = (k/\\sqrt{3}, k/\\sqrt{3}, k/\\sqrt{3})$. Define the dimensionless anisotropy measure\n$$\nR(x) = \\frac{E(\\mathbf{k}_{\\text{ax}}) - E(\\mathbf{k}_{\\text{bd}})}{E_{\\text{cont}}(k)},\n$$\nwhere $x = ka$ and $E_{\\text{cont}}(k) = \\hbar^{2}k^{2}/(2m)$ is the continuum dispersion. Derive a closed-form expression for $R(x)$ and its small-$x$ series expansion about $x=0$. Report, as your final answer, the leading-order coefficient $c$ in the expansion $R(x) = c\\,x^{2} + \\mathcal{O}(x^{4})$. Express the final answer as a unitless exact number; no rounding is required.", "solution": "The problem statement is validated as scientifically grounded, well-posed, and self-contained. It describes a standard problem in lattice field theory concerning the discretization of a kinetic energy operator and the analysis of the resulting artifacts, specifically the breaking of rotational symmetry. We may proceed with the solution.\n\nThe first step is to construct the discrete lattice Laplacian, denoted $\\nabla^2_{\\text{lat}}$, which approximates the continuum Laplacian $\\nabla^2$ with a truncation error of order $\\mathcal{O}(a^2)$, where $a$ is the lattice spacing. We consider a scalar function $f(\\mathbf{r})$ on the lattice, where $\\mathbf{r}$ represents a point on the cubic grid. For any of the three spatial directions, indexed by $i \\in \\{1, 2, 3\\}$, we perform a Taylor series expansion of $f$ at neighboring sites $\\mathbf{r} \\pm a\\hat{\\mathbf{e}}_i$ around the point $\\mathbf{r}$, where $\\hat{\\mathbf{e}}_i$ is the unit vector along the $i$-th axis.\nThe expansions are:\n$$f(\\mathbf{r} + a\\hat{\\mathbf{e}}_i) = f(\\mathbf{r}) + a \\frac{\\partial f}{\\partial r_i} + \\frac{a^2}{2!} \\frac{\\partial^2 f}{\\partial r_i^2} + \\frac{a^3}{3!} \\frac{\\partial^3 f}{\\partial r_i^3} + \\frac{a^4}{4!} \\frac{\\partial^4 f}{\\partial r_i^4} + \\mathcal{O}(a^5)$$\n$$f(\\mathbf{r} - a\\hat{\\mathbf{e}}_i) = f(\\mathbf{r}) - a \\frac{\\partial f}{\\partial r_i} + \\frac{a^2}{2!} \\frac{\\partial^2 f}{\\partial r_i^2} - \\frac{a^3}{3!} \\frac{\\partial^3 f}{\\partial r_i^3} + \\frac{a^4}{4!} \\frac{\\partial^4 f}{\\partial r_i^4} - \\mathcal{O}(a^5)$$\nAdding these two equations eliminates terms with odd powers of $a$:\n$$f(\\mathbf{r} + a\\hat{\\mathbf{e}}_i) + f(\\mathbf{r} - a\\hat{\\mathbf{e}}_i) = 2f(\\mathbf{r}) + a^2 \\frac{\\partial^2 f}{\\partial r_i^2} + \\frac{a^4}{12} \\frac{\\partial^4 f}{\\partial r_i^4} + \\mathcal{O}(a^6)$$\nRearranging this to solve for the second partial derivative gives the central difference formula:\n$$\\frac{\\partial^2 f}{\\partial r_i^2} = \\frac{1}{a^2} \\left[ f(\\mathbf{r} + a\\hat{\\mathbf{e}}_i) + f(\\mathbf{r} - a\\hat{\\mathbf{e}}_i) - 2f(\\mathbf{r}) \\right] - \\frac{a^2}{12} \\frac{\\partial^4 f}{\\partial r_i^4} + \\mathcal{O}(a^4)$$\nThe leading error term is proportional to $a^2$, so this form provides an approximation to $\\frac{\\partial^2 f}{\\partial r_i^2}$ that is accurate to order $\\mathcal{O}(a^2)$. To construct the three-dimensional Laplacian, $\\nabla^2 = \\sum_{i=1}^3 \\frac{\\partial^2}{\\partial r_i^2}$, we sum the central difference expressions for $i=1, 2, 3$:\n$$\\nabla^2 f(\\mathbf{r}) = \\frac{1}{a^2} \\sum_{i=1}^3 \\left[ f(\\mathbf{r} + a\\hat{\\mathbf{e}}_i) + f(\\mathbf{r} - a\\hat{\\mathbf{e}}_i) - 2f(\\mathbf{r}) \\right] + \\mathcal{O}(a^2)$$\nThe lattice Laplacian operator, $\\nabla^2_{\\text{lat}}$, is defined by dropping the error terms:\n$$\\nabla^2_{\\text{lat}} f(\\mathbf{r}) = \\frac{1}{a^2} \\left( \\sum_{i=1}^3 \\left[ f(\\mathbf{r} + a\\hat{\\mathbf{e}}_i) + f(\\mathbf{r} - a\\hat{\\mathbf{e}}_i) \\right] - 6f(\\mathbf{r}) \\right)$$\nThis operator uses the function values at the central point $\\mathbf{r}$ and its six nearest neighbors, thus constituting the required seven-point stencil.\n\nThe nonrelativistic kinetic energy operator on the lattice, $H_{\\text{lat}}$, is obtained by substituting $\\nabla^2_{\\text{lat}}$ into the continuum expression $H = -(\\hbar^2/2m)\\nabla^2$:\n$$H_{\\text{lat}} = -\\frac{\\hbar^2}{2m} \\nabla^2_{\\text{lat}} = -\\frac{\\hbar^2}{2ma^2} \\left( \\sum_{i=1}^3 \\left[ T_i^+ + T_i^- \\right] - 6 \\right)$$\nwhere $T_i^{\\pm}$ are translation operators such that $T_i^{\\pm} f(\\mathbf{r}) = f(\\mathbf{r} \\pm a\\hat{\\mathbf{e}}_i)$.\n\nNext, we derive the single-particle dispersion relation $E(\\mathbf{k})$ by finding the eigenvalues of $H_{\\text{lat}}$ for a plane-wave state $\\psi(\\mathbf{r}) = \\exp(i\\mathbf{k}\\cdot\\mathbf{r})$. Applying the translation operators to this state yields:\n$$T_i^{\\pm} \\psi(\\mathbf{r}) = \\exp(i\\mathbf{k}\\cdot(\\mathbf{r} \\pm a\\hat{\\mathbf{e}}_i)) = \\exp(i\\mathbf{k}\\cdot\\mathbf{r}) \\exp(\\pm i a k_i) = \\psi(\\mathbf{r}) \\exp(\\pm i a k_i)$$\nThe action of the Hamiltonian on the plane wave is therefore:\n$$H_{\\text{lat}} \\psi(\\mathbf{r}) = -\\frac{\\hbar^2}{2ma^2} \\left( \\sum_{i=1}^3 \\left[ \\exp(i a k_i) + \\exp(-i a k_i) \\right] - 6 \\right) \\psi(\\mathbf{r})$$\nUsing the identity $2\\cos\\theta = e^{i\\theta} + e^{-i\\theta}$, we simplify the expression in the parenthesis:\n$$H_{\\text{lat}} \\psi(\\mathbf{r}) = -\\frac{\\hbar^2}{2ma^2} \\left( \\sum_{i=1}^3 2\\cos(a k_i) - 6 \\right) \\psi(\\mathbf{r}) = \\frac{\\hbar^2}{ma^2} \\left( 3 - \\sum_{i=1}^3 \\cos(a k_i) \\right) \\psi(\\mathbf{r})$$\nThe eigenvalue is the energy $E(\\mathbf{k})$. Using the identity $1 - \\cos\\theta = 2\\sin^2(\\theta/2)$:\n$$E(\\mathbf{k}) = \\frac{\\hbar^2}{ma^2} \\sum_{i=1}^3 \\left(1 - \\cos(a k_i)\\right) = \\frac{2\\hbar^2}{ma^2} \\sum_{i=1}^3 \\sin^2\\left(\\frac{a k_i}{2}\\right)$$\nThis is the lattice dispersion relation.\n\nNow, we evaluate this for the two specified momentum vectors, $\\mathbf{k}_{\\text{ax}} = (k, 0, 0)$ and $\\mathbf{k}_{\\text{bd}} = (k/\\sqrt{3}, k/\\sqrt{3}, k/\\sqrt{3})$, where $|\\mathbf{k}_{\\text{ax}}| = |\\mathbf{k}_{\\text{bd}}| = k$.\nFor the axial momentum $\\mathbf{k}_{\\text{ax}}$, the components are $k_1=k$, $k_2=0$, $k_3=0$:\n$$E(\\mathbf{k}_{\\text{ax}}) = \\frac{2\\hbar^2}{ma^2} \\left[ \\sin^2\\left(\\frac{ak}{2}\\right) + \\sin^2(0) + \\sin^2(0) \\right] = \\frac{2\\hbar^2}{ma^2} \\sin^2\\left(\\frac{ak}{2}\\right)$$\nFor the body-diagonal momentum $\\mathbf{k}_{\\text{bd}}$, the components are $k_1=k_2=k_3=k/\\sqrt{3}$:\n$$E(\\mathbf{k}_{\\text{bd}}) = \\frac{2\\hbar^2}{ma^2} \\sum_{i=1}^3 \\sin^2\\left(\\frac{ak}{2\\sqrt{3}}\\right) = \\frac{6\\hbar^2}{ma^2} \\sin^2\\left(\\frac{ak}{2\\sqrt{3}}\\right)$$\nThe anisotropy measure $R(x)$ is defined with $x=ka$ and the continuum energy $E_{\\text{cont}}(k) = \\hbar^2 k^2/(2m) = \\hbar^2 x^2/(2ma^2)$.\n$$R(x) = \\frac{E(\\mathbf{k}_{\\text{ax}}) - E(\\mathbf{k}_{\\text{bd}})}{E_{\\text{cont}}(k)} = \\frac{\\frac{2\\hbar^2}{ma^2} \\sin^2\\left(\\frac{x}{2}\\right) - \\frac{6\\hbar^2}{ma^2} \\sin^2\\left(\\frac{x}{2\\sqrt{3}}\\right)}{\\frac{\\hbar^2 x^2}{2ma^2}}$$\nSimplifying this expression, we obtain the closed form for $R(x)$:\n$$R(x) = \\frac{4}{x^2} \\sin^2\\left(\\frac{x}{2}\\right) - \\frac{12}{x^2} \\sin^2\\left(\\frac{x}{2\\sqrt{3}}\\right) = \\frac{4}{x^2} \\left[ \\sin^2\\left(\\frac{x}{2}\\right) - 3\\sin^2\\left(\\frac{x}{2\\sqrt{3}}\\right) \\right]$$\nTo find the leading-order behavior for small $x$, we expand the sine-squared terms. The Taylor series for $\\sin^2(u)$ around $u=0$ is $\\sin^2(u) = (u - u^3/6 + \\dots)^2 = u^2 - u^4/3 + \\mathcal{O}(u^6)$.\nFor the first term, with $u=x/2$:\n$$\\sin^2\\left(\\frac{x}{2}\\right) = \\left(\\frac{x}{2}\\right)^2 - \\frac{1}{3}\\left(\\frac{x}{2}\\right)^4 + \\mathcal{O}(x^6) = \\frac{x^2}{4} - \\frac{x^4}{48} + \\mathcal{O}(x^6)$$\nFor the second term, with $u=x/(2\\sqrt{3})$:\n$$3\\sin^2\\left(\\frac{x}{2\\sqrt{3}}\\right) = 3\\left[ \\left(\\frac{x}{2\\sqrt{3}}\\right)^2 - \\frac{1}{3}\\left(\\frac{x}{2\\sqrt{3}}\\right)^4 + \\mathcal{O}(x^6) \\right] = 3\\left[ \\frac{x^2}{12} - \\frac{x^4}{3 \\cdot 144} + \\mathcal{O}(x^6) \\right] = \\frac{x^2}{4} - \\frac{x^4}{144} + \\mathcal{O}(x^6)$$\nThe difference is:\n$$\\sin^2\\left(\\frac{x}{2}\\right) - 3\\sin^2\\left(\\frac{x}{2\\sqrt{3}}\\right) = \\left(\\frac{x^2}{4} - \\frac{x^4}{48}\\right) - \\left(\\frac{x^2}{4} - \\frac{x^4}{144}\\right) + \\mathcal{O}(x^6) = \\left(-\\frac{1}{48} + \\frac{1}{144}\\right)x^4 + \\mathcal{O}(x^6)$$\n$$= \\frac{-3+1}{144}x^4 + \\mathcal{O}(x^6) = -\\frac{2}{144}x^4 + \\mathcal{O}(x^6) = -\\frac{1}{72}x^4 + \\mathcal{O}(x^6)$$\nFinally, we substitute this back into the expression for $R(x)$:\n$$R(x) = \\frac{4}{x^2} \\left[ -\\frac{1}{72}x^4 + \\mathcal{O}(x^6) \\right] = -\\frac{4}{72}x^2 + \\mathcal{O}(x^4) = -\\frac{1}{18}x^2 + \\mathcal{O}(x^4)$$\nThe problem asks for the coefficient $c$ in the expansion $R(x) = c\\,x^2 + \\mathcal{O}(x^4)$. By comparison, we find $c = -1/18$.", "answer": "$$\\boxed{-\\frac{1}{18}}$$", "id": "3567125"}, {"introduction": "The breaking of rotational symmetry, introduced by the lattice discretization, is not merely a mathematical feature; it has direct physical consequences on the predicted energy spectrum. [@problem_id:3567125] This practice demonstrates how a state with definite angular momentum in the continuum, such as a $J=2$ state, splits into multiple distinct energy levels corresponding to irreducible representations of the cubic group. You will quantify this splitting by analyzing simulated correlation function data, a core task in lattice spectroscopy.", "problem": "Consider a nonrelativistic nuclear state with total angular momentum $J=2$ in lattice effective field theory for nuclei. In the continuum with rotational symmetry group $\\mathrm{O}(3)$, the five magnetic sublevels of a $J=2$ multiplet are degenerate. On a cubic lattice, rotational symmetry is reduced to the cubic group $\\mathrm{O}_h$, and the $J=2$ multiplet decomposes into the two-dimensional irreducible representation (irrep) $E$ and the three-dimensional irrep $T_2$, which can have different energies at finite lattice spacing $a$. The leading discretization effects can be described by Symanzik effective theory as $\\mathcal{O}(a^2)$ corrections. A spin-$2$ anisotropy operator induces energy shifts that are traceless over the multiplet, so the shifts satisfy $2\\,\\Delta E_E + 3\\,\\Delta E_{T_2} = 0$. Assume the simplest nontrivial pattern consistent with this tracelessness, where the irrep-dependent coefficients are $s_E = +\\frac{3}{5}$ and $s_{T_2} = -\\frac{2}{5}$, and the fractional anisotropy strength is parameterized by a dimensionless coefficient $\\eta$ multiplying $(a/a_0)^2$, with $a_0 = 1.0\\,\\mathrm{fm}$ a fixed reference length.\n\nLet the continuum energy (i.e., $a \\to 0$) be $E_0$ in $\\mathrm{MeV}$, and define the unimproved irrep energies at finite $a$ as\n$$\nE_r^{\\text{unimp}} = E_0 \\left[1 + s_r\\,\\eta\\,\\left(\\frac{a}{a_0}\\right)^2\\right], \\quad r \\in \\{E, T_2\\},\n$$\nand an improved operator with coefficient $\\lambda$ that aims to cancel the leading anisotropy, modeled as\n$$\nE_r^{\\text{imp}} = E_0 \\left[1 + s_r\\,(\\eta - \\lambda)\\,\\left(\\frac{a}{a_0}\\right)^2\\right], \\quad r \\in \\{E, T_2\\}.\n$$\nAssume single-state Euclidean-time correlation functions for each irrep $r$ given by\n$$\nC_r(t_n) = A_r \\, e^{-E_r\\, t_n}, \\quad t_n = n\\,\\Delta t, \\quad n=0,1,\\dots,N,\n$$\nin natural units where $\\hbar=c=1$, with $E_r$ in $\\mathrm{MeV}$, $t$ in $\\mathrm{MeV}^{-1}$, and $A_r$ dimensionless amplitudes. The effective mass estimator at discrete times is\n$$\nm_{\\text{eff},r}(n) = \\frac{1}{\\Delta t}\\,\\ln\\left(\\frac{C_r(t_n)}{C_r(t_{n+1})}\\right),\n$$\nwhich, for a single exponential, equals $E_r$ exactly (independent of $A_r$). For a given window $n \\in [n_{\\min}, n_{\\max}]$ with $0 \\le n_{\\min} < n_{\\max} < N$, define the measured energy as the average of $m_{\\text{eff},r}(n)$ over this window. The cubic rotational-symmetry breaking can be quantified by the irrep energy splitting,\n$$\n\\delta \\equiv E_{T_2} - E_E,\n$$\ncomputed separately for the unimproved and improved operators.\n\nYour task is to implement a program that, for each test case below, constructs the correlators $C_E(t_n)$ and $C_{T_2}(t_n)$ using both $E_r^{\\text{unimp}}$ and $E_r^{\\text{imp}}$, extracts the measured irrep energies via the effective mass in the specified time window, and returns the unimproved and improved splittings $\\delta_{\\text{unimp}}$ and $\\delta_{\\text{imp}}$, respectively.\n\nUse the following test suite. All energies are in $\\mathrm{MeV}$, all times are in $\\mathrm{MeV}^{-1}$, and all lattice spacings are in $\\mathrm{fm}$. The amplitudes $A_E$ and $A_{T_2}$ are dimensionless. The parameters are given as $(a, E_0, \\eta, \\lambda, \\Delta t, N, n_{\\min}, n_{\\max}, A_E, A_{T_2})$:\n- Case 1 (happy path, exact cancellation): $(a = 1.0\\,\\mathrm{fm}, E_0 = 12.0\\,\\mathrm{MeV}, \\eta = 0.08, \\lambda = 0.08, \\Delta t = 0.05\\,\\mathrm{MeV}^{-1}, N = 60, n_{\\min} = 10, n_{\\max} = 20, A_E = 1.3, A_{T_2} = 1.1)$.\n- Case 2 (small $a$, partial improvement): $(a = 0.2\\,\\mathrm{fm}, E_0 = 8.0\\,\\mathrm{MeV}, \\eta = 0.30, \\lambda = 0.25, \\Delta t = 0.10\\,\\mathrm{MeV}^{-1}, N = 40, n_{\\min} = 5, n_{\\max} = 15, A_E = 1.0, A_{T_2} = 0.9)$.\n- Case 3 (zero anisotropy, baseline): $(a = 0.5\\,\\mathrm{fm}, E_0 = 15.0\\,\\mathrm{MeV}, \\eta = 0.00, \\lambda = 0.00, \\Delta t = 0.05\\,\\mathrm{MeV}^{-1}, N = 50, n_{\\min} = 10, n_{\\max} = 25, A_E = 1.2, A_{T_2} = 1.2)$.\n- Case 4 (large $a$, partial improvement): $(a = 1.4\\,\\mathrm{fm}, E_0 = 10.0\\,\\mathrm{MeV}, \\eta = 0.20, \\lambda = 0.15, \\Delta t = 0.05\\,\\mathrm{MeV}^{-1}, N = 60, n_{\\min} = 12, n_{\\max} = 22, A_E = 2.0, A_{T_2} = 0.5)$.\n\nCompute the unimproved and improved splittings $\\delta_{\\text{unimp}}$ and $\\delta_{\\text{imp}}$ for each case, expressed in $\\mathrm{MeV}$ and rounded to three decimal places. Your program should produce a single line of output containing the results as a comma-separated list of four pairs, each pair enclosed in square brackets, and the entire list enclosed in square brackets. For example, the output format must be\n$$\n[\\,[\\delta_{\\text{unimp}}^{(1)},\\delta_{\\text{imp}}^{(1)}],\\,[\\delta_{\\text{unimp}}^{(2)},\\delta_{\\text{imp}}^{(2)}],\\,[\\delta_{\\text{unimp}}^{(3)},\\delta_{\\text{imp}}^{(3)}],\\,[\\delta_{\\text{unimp}}^{(4)},\\delta_{\\text{imp}}^{(4)}]\\,],\n$$\nwith each $\\delta$ displayed as a decimal float in $\\mathrm{MeV}$ rounded to three decimal places.", "solution": "The problem statement has been meticulously reviewed and is determined to be **valid**. It is scientifically grounded in the principles of lattice effective field theory, mathematically self-consistent, and provides a well-posed computational task with all necessary parameters defined.\n\nThe problem requires the calculation of energy splittings between different irreducible representations (irreps) of the cubic group, which arise from the breaking of continuous rotational symmetry on a spatial lattice. A state with total angular momentum $J=2$, which forms a five-dimensional multiplet in the continuum with $\\mathrm{O}(3)$ symmetry, decomposes into a two-dimensional irrep $E$ and a three-dimensional irrep $T_2$ under the cubic group $\\mathrm{O}_h$. At finite lattice spacing $a$, these irreps are no longer degenerate.\n\nThe leading-order energy shifts caused by this discretization are given to be proportional to $(a/a_0)^2$. The problem defines models for these energies, both for an unimproved theory and a theory improved by a counterterm with coefficient $\\lambda$.\n\nThe unimproved energy for an irrep $r \\in \\{E, T_2\\}$ is:\n$$\nE_r^{\\text{unimp}} = E_0 \\left[1 + s_r\\,\\eta\\,\\left(\\frac{a}{a_0}\\right)^2\\right]\n$$\nThe improved energy is:\n$$\nE_r^{\\text{imp}} = E_0 \\left[1 + s_r\\,(\\eta - \\lambda)\\,\\left(\\frac{a}{a_0}\\right)^2\\right]\n$$\nwhere $E_0$ is the continuum energy, $\\eta$ is the anisotropy parameter, $a$ is the lattice spacing, and $a_0 = 1.0\\,\\mathrm{fm}$ is a reference scale. The irrep-dependent coefficients are given as $s_E = +\\frac{3}{5}$ and $s_{T_2} = -\\frac{2}{5}$. These satisfy the tracelessness condition $2s_E + 3s_{T_2} = 2(\\frac{3}{5}) + 3(-\\frac{2}{5}) = 0$.\n\nThe task is to extract these energies from simulated Euclidean-time correlation functions, $C_r(t_n) = A_r \\, e^{-E_r\\, t_n}$, where $t_n = n\\,\\Delta t$. The energy is to be measured using the effective mass estimator:\n$$\nm_{\\text{eff},r}(n) = \\frac{1}{\\Delta t}\\,\\ln\\left(\\frac{C_r(t_n)}{C_r(t_{n+1})}\\right)\n$$\nFor a correlation function described by a single exponential, as is the case here, the effective mass is exactly equal to the energy exponent, independent of the time step $n$ and the amplitude $A_r$. We can see this by direct substitution:\n$$\nm_{\\text{eff},r}(n) = \\frac{1}{\\Delta t}\\,\\ln\\left(\\frac{A_r e^{-E_r t_n}}{A_r e^{-E_r t_{n+1}}}\\right) = \\frac{1}{\\Delta t}\\,\\ln\\left(e^{-E_r (t_n - t_{n+1})}\\right)\n$$\nSince $t_{n+1} - t_n = (n+1)\\Delta t - n\\Delta t = \\Delta t$, the expression simplifies to:\n$$\nm_{\\text{eff},r}(n) = \\frac{1}{\\Delta t}\\,\\ln\\left(e^{E_r \\Delta t}\\right) = \\frac{1}{\\Delta t}\\,(E_r \\Delta t) = E_r\n$$\nTherefore, the \"measured\" energy, defined as the average of $m_{\\text{eff},r}(n)$ over any time window $[n_{\\min}, n_{\\max}]$, will also be exactly $E_r$. The parameters $A_r$, $\\Delta t$, $N$, $n_{\\min}$, and $n_{\\max}$ are thus extraneous for determining the final energy splitting in this idealized scenario, but the problem requires implementing the full analysis pipeline as a procedural verification.\n\nThe quantity of interest is the energy splitting, $\\delta \\equiv E_{T_2} - E_E$.\nFor the unimproved case, the measured splitting $\\delta_{\\text{unimp}}$ is:\n$$\n\\delta_{\\text{unimp}} = E_{T_2}^{\\text{unimp}} - E_E^{\\text{unimp}} = E_0 \\left[1 + s_{T_2}\\,\\eta\\,\\left(\\frac{a}{a_0}\\right)^2\\right] - E_0 \\left[1 + s_E\\,\\eta\\,\\left(\\frac{a}{a_0}\\right)^2\\right]\n$$\n$$\n\\delta_{\\text{unimp}} = E_0 \\, \\eta \\, \\left(\\frac{a}{a_0}\\right)^2 (s_{T_2} - s_E)\n$$\nSubstituting the given values $s_E = \\frac{3}{5}$ and $s_{T_2} = -\\frac{2}{5}$, we find $s_{T_2} - s_E = -\\frac{2}{5} - \\frac{3}{5} = -1$.\n$$\n\\delta_{\\text{unimp}} = - E_0 \\, \\eta \\, \\left(\\frac{a}{a_0}\\right)^2\n$$\nSimilarly, for the improved case, the splitting $\\delta_{\\text{imp}}$ is:\n$$\n\\delta_{\\text{imp}} = E_{T_2}^{\\text{imp}} - E_E^{\\text{imp}} = E_0 \\, (\\eta - \\lambda) \\, \\left(\\frac{a}{a_0}\\right)^2 (s_{T_2} - s_E)\n$$\n$$\n\\delta_{\\text{imp}} = - E_0 \\, (\\eta - \\lambda) \\, \\left(\\frac{a}{a_0}\\right)^2\n$$\nThe improvement aims to reduce this splitting. Perfect improvement, where $\\lambda = \\eta$, results in $\\delta_{\\text{imp}} = 0$, restoring the energy degeneracy at the level of $\\mathcal{O}(a^2)$ discretization errors.\n\nThe implementation will follow these steps for each test case:\n1.  Define the constants $s_E$, $s_{T_2}$, and $a_0$.\n2.  Define a function to calculate the splitting. This function will take the problem parameters as input, including a factor for the anisotropy term (this factor will be $\\eta$ for the unimproved case and $\\eta - \\lambda$ for the improved case).\n3.  Inside the function, calculate the energies $E_E$ and $E_{T_2}$ using the appropriate formula.\n4.  Although analytically unnecessary, construct the correlator arrays $C_E(t_n)$ and $C_{T_2}(t_n)$ up to time index $n = n_{\\max}+1$.\n5.  Compute the effective mass for each irrep for each time step $n$ in the window $[n_{\\min}, n_{\\max}]$.\n6.  Average the effective masses to obtain the measured energies $E_E^{\\text{meas}}$ and $E_{T_2}^{\\text{meas}}$.\n7.  Return the splitting $\\delta = E_{T_2}^{\\text{meas}} - E_E^{\\text{meas}}$.\n8.  For each test case, call this function twice: once for the unimproved splitting (with anisotropy factor $\\eta$) and once for the improved splitting (with anisotropy factor $\\eta - \\lambda$).\n9.  Collect the results, round them to three decimal places, and format them into the specified output string. This numerical procedure will serve to confirm the analytical expressions derived above.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the lattice EFT energy splitting problem for the given test suite.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Format: (a, E0, eta, lambda, dt, N, n_min, n_max, A_E, A_T2)\n    test_cases = [\n        (1.0, 12.0, 0.08, 0.08, 0.05, 60, 10, 20, 1.3, 1.1),\n        (0.2, 8.0, 0.30, 0.25, 0.10, 40, 5, 15, 1.0, 0.9),\n        (0.5, 15.0, 0.00, 0.00, 0.05, 50, 10, 25, 1.2, 1.2),\n        (1.4, 10.0, 0.20, 0.15, 0.05, 60, 12, 22, 2.0, 0.5),\n    ]\n\n    # Fixed parameters from the problem description\n    s_E = 3.0 / 5.0\n    s_T2 = -2.0 / 5.0\n    a0 = 1.0  # fm\n\n    def calculate_splitting(\n            a, E0, anisotropy_factor, dt, N, n_min, n_max, A_E, A_T2\n        ):\n        \"\"\"\n        Calculates the energy splitting for a given set of parameters.\n        The 'anisotropy_factor' is eta for unimproved, and (eta - lambda) for improved.\n        \"\"\"\n        \n        # Calculate the energies for E and T2 irreps\n        a_ratio_sq = (a / a0)**2\n        E_E = E0 * (1.0 + s_E * anisotropy_factor * a_ratio_sq)\n        E_T2 = E0 * (1.0 + s_T2 * anisotropy_factor * a_ratio_sq)\n\n        # Generate correlator data points.\n        # We need data up to t_{n_max+1} to calculate the last effective mass point.\n        max_time_idx = n_max + 1\n        time_steps = np.arange(max_time_idx + 1) * dt\n        \n        C_E = A_E * np.exp(-E_E * time_steps)\n        C_T2 = A_T2 * np.exp(-E_T2 * time_steps)\n\n        # Calculate effective mass in the specified window [n_min, n_max]\n        eff_mass_E_list = []\n        eff_mass_T2_list = []\n        for n in range(n_min, n_max + 1):\n            m_eff_E = (1.0 / dt) * np.log(C_E[n] / C_E[n+1])\n            m_eff_T2 = (1.0 / dt) * np.log(C_T2[n] / C_T2[n+1])\n            eff_mass_E_list.append(m_eff_E)\n            eff_mass_T2_list.append(m_eff_T2)\n\n        # The measured energy is the average of the effective mass over the window.\n        # For a single exponential, the effective mass is constant, so the average is redundant\n        # but we compute it as per the problem's procedural requirement.\n        measured_E_E = np.mean(eff_mass_E_list)\n        measured_E_T2 = np.mean(eff_mass_T2_list)\n\n        # The splitting is the difference between the measured irrep energies.\n        delta = measured_E_T2 - measured_E_E\n        \n        return delta\n\n    # Store results for all cases\n    all_results = []\n\n    for case in test_cases:\n        a, E0, eta, lam, dt, N, n_min, n_max, A_E, A_T2 = case\n        \n        # Calculate unimproved splitting (anisotropy_factor = eta)\n        delta_unimp = calculate_splitting(\n            a, E0, eta, dt, N, n_min, n_max, A_E, A_T2\n        )\n        \n        # Calculate improved splitting (anisotropy_factor = eta - lambda)\n        delta_imp = calculate_splitting(\n            a, E0, (eta - lam), dt, N, n_min, n_max, A_E, A_T2\n        )\n        \n        all_results.append([delta_unimp, delta_imp])\n        \n    # Format the final output string exactly as specified.\n    # [[val1,val2],[val3,val4],...] with rounding to three decimal places.\n    pair_strs = [f\"[{res[0]:.3f},{res[1]:.3f}]\" for res in all_results]\n    final_output_str = f\"[{','.join(pair_strs)}]\"\n\n    print(final_output_str)\n\nsolve()\n```", "id": "3567059"}, {"introduction": "While discretization errors are unavoidable at finite lattice spacing, we can construct \"improved\" operators that systematically mitigate their effects. This exercise introduces a powerful and widely used technique—angular averaging in momentum space—to restore rotational symmetry to the pion propagator, a key component of the long-range nuclear force. You will implement this improvement and assess its effectiveness using a sensitive diagnostic observable designed to probe for anisotropy. [@problem_id:3567059]", "problem": "Implement a program that, for a discretized momentum lattice used in Lattice Effective Field Theory (LEFT) for nuclei, constructs a long-range pion propagator in momentum space with and without rotational-symmetry restoration via angular averaging over momentum-space shells, and then assesses its effect on a tensor-polarization-like diagnostic of the deuteron at finite lattice spacing. The program must output a list of floating-point numbers corresponding to a prescribed test suite. Use natural units where $\\hbar = c = 1$, with momenta in $\\mathrm{fm}^{-1}$, lengths in $\\mathrm{fm}$, and no explicit conversion factors.\n\nFundamental base and definitions to use:\n- Consider a periodic cubic lattice with $L$ sites along each spatial direction and lattice spacing $a$. The discretized momenta are given by $k_i = \\frac{2\\pi}{La} n_i$ where $n_i \\in \\{-\\frac{L}{2}, \\dots, \\frac{L}{2}-1\\}$ for each Cartesian component $i \\in \\{x,y,z\\}$, assuming $L$ is even and periodic boundary conditions.\n- The lattice Laplacian in momentum space produces the standard lattice dispersion $\\hat{k}^2 = \\left(\\frac{2}{a}\\right)^2 \\sum_{i=x,y,z} \\left(1 - \\cos(a k_i)\\right)$, which is a well-tested discretization of the continuum operator. For a free massive pion field with mass $m_\\pi$, the lattice propagator in momentum space is $D_{\\mathrm{lat}}(\\mathbf{k}) = \\frac{1}{\\hat{k}^2 + m_\\pi^2}$.\n- Rotational symmetry breaking at finite lattice spacing arises because $\\hat{k}^2$ depends on the direction of $\\mathbf{k}$ on the lattice. A simple and widely used restoration technique is $k$-space angular averaging: for each momentum shell characterized by $|\\mathbf{k}|$ (equivalently by the integer shell label $N = n_x^2 + n_y^2 + n_z^2$ on a cubic lattice), define the angular-averaged propagator $D_{\\mathrm{avg}}$ by averaging $D_{\\mathrm{lat}}(\\mathbf{k})$ over all momentum vectors sharing the same $N$.\n- To make contact with deuteron tensor structure, define a tensor-polarization-like diagnostic that mimics the quadrupole angular dependence without requiring a full two-nucleon calculation. Let the quantization axis be the $z$-axis, and use the quadrupole angular factor $(3\\cos^2\\theta - 1)$ where $\\cos\\theta = \\frac{k_z}{|\\mathbf{k}|}$. Weight the momentum sum by a spherically symmetric deuteron $S$-wave model in momentum space, $\\phi(\\mathbf{k}) \\propto \\exp\\left(-\\left|\\mathbf{k}\\right|^2/\\beta^2\\right)$, so that $|\\phi(\\mathbf{k})|^2 \\propto \\exp\\left(-2\\left|\\mathbf{k}\\right|^2/\\beta^2\\right)$. Define the normalized diagnostic $T$ (dimensionless) by\n$$\nT[D] \\equiv \\frac{\\sum_{\\mathbf{k}\\neq \\mathbf{0}} \\left(3\\cos^2\\theta - 1\\right)\\, D(\\mathbf{k})\\, \\exp\\left(-\\frac{2|\\mathbf{k}|^2}{\\beta^2}\\right)}{\\sum_{\\mathbf{k}\\neq \\mathbf{0}} \\exp\\left(-\\frac{2|\\mathbf{k}|^2}{\\beta^2}\\right)} \\,,\n$$\nwhere $D(\\mathbf{k})$ is either $D_{\\mathrm{lat}}(\\mathbf{k})$ (naive, anisotropic) or the angular-averaged shell value $D_{\\mathrm{avg}}(|\\mathbf{k}|)$ (restored, isotropic). Note that for a perfectly rotationally invariant $D(\\mathbf{k})$ that depends only on $|\\mathbf{k}|$ and a spherically symmetric weight, the numerator analytically vanishes due to the orthogonality of the quadrupole moment, implying $T[D_{\\mathrm{avg}}]\\to 0$ up to machine precision on a finite lattice if shell averaging is exact.\n- Angles must be treated in radians. The output $T$ for each case is unitless.\n\nYour program should:\n- Construct $\\mathbf{k}$ on the cubic grid for given $L$ and $a$.\n- Compute $D_{\\mathrm{lat}}(\\mathbf{k})$ for given $m_\\pi$.\n- Build $D_{\\mathrm{avg}}(|\\mathbf{k}|)$ by grouping momenta by the integer shell label $N = n_x^2+n_y^2+n_z^2$ and averaging $D_{\\mathrm{lat}}$ over each shell. Assign $D_{\\mathrm{avg}}(|\\mathbf{k}|)$ to each $\\mathbf{k}$ by its shell label. Exclude the $\\mathbf{k}=\\mathbf{0}$ mode from the $T$ sums.\n- Compute $T_{\\mathrm{naive}} \\equiv T[D_{\\mathrm{lat}}]$ and $T_{\\mathrm{avg}} \\equiv T[D_{\\mathrm{avg}}]$ using the normalized diagnostic defined above.\n\nNumerical stability and implementation details:\n- Use double precision floating point arithmetic.\n- For $\\mathbf{k}=\\mathbf{0}$, exclude that single mode from both numerator and denominator sums to avoid division by zero in $\\cos\\theta$ and to reflect that the quadrupole factor is ill-defined there.\n- Ensure that all sums are performed over the full Brillouin zone represented by the grid $\\{n_x,n_y,n_z\\}$.\n\nTest suite:\nFor each parameter tuple $(L, a, m_\\pi, \\beta)$ below, compute and report two floats: $T_{\\mathrm{naive}}$ and $T_{\\mathrm{avg}}$, in that order, rounded to $8$ decimal places.\n- Case $1$: $L=16$, $a=1.32\\,\\mathrm{fm}$, $m_\\pi=0.70\\,\\mathrm{fm}^{-1}$, $\\beta=0.90\\,\\mathrm{fm}^{-1}$.\n- Case $2$: $L=16$, $a=0.99\\,\\mathrm{fm}$, $m_\\pi=0.70\\,\\mathrm{fm}^{-1}$, $\\beta=0.90\\,\\mathrm{fm}^{-1}$.\n- Case $3$: $L=32$, $a=0.99\\,\\mathrm{fm}$, $m_\\pi=0.70\\,\\mathrm{fm}^{-1}$, $\\beta=0.90\\,\\mathrm{fm}^{-1}$.\n- Case $4$: $L=16$, $a=1.32\\,\\mathrm{fm}$, $m_\\pi=1.50\\,\\mathrm{fm}^{-1}$, $\\beta=0.90\\,\\mathrm{fm}^{-1}$.\n\nExpected qualitative behavior to check reasoning: $|T_{\\mathrm{avg}}|$ should be numerically close to $0$ for all cases due to rotational-symmetry restoration by shell averaging, while $|T_{\\mathrm{naive}}|$ should be nonzero and generally decrease as $a$ decreases (finer lattice) or as $m_\\pi$ increases (shorter range).\n\nFinal output format:\n- Your program should produce a single line of output containing the $8$ floats corresponding to the $4$ cases, ordered as $[T_{\\mathrm{naive}}^{(1)},T_{\\mathrm{avg}}^{(1)},T_{\\mathrm{naive}}^{(2)},T_{\\mathrm{avg}}^{(2)},T_{\\mathrm{naive}}^{(3)},T_{\\mathrm{avg}}^{(3)},T_{\\mathrm{naive}}^{(4)},T_{\\mathrm{avg}}^{(4)}]$, each rounded to $8$ decimal places, with no additional text. For example, an acceptable format is $[0.01234567,0.00000001,0.00987654,0.00000000,0.00876543,0.00000001,0.00654321,0.00000000]$.", "solution": "The problem as stated is scientifically sound, internally consistent, and well-posed. All definitions and parameters required for a unique, verifiable solution are provided. The context is a standard-form problem in computational lattice field theory, concerning the quantification and correction of rotational symmetry breaking, which is a known lattice artifact. The physical principles, mathematical definitions, and proposed computational tasks are all valid.\n\nThe solution proceeds by implementing the steps outlined in the problem statement. The core principles are the discretization of quantum field theory on a spatial lattice and the analysis of artifacts introduced by this discretization.\n\nFirst, we establish the discretized momentum space. For a cubic lattice of size $(La)^3$, with $L$ sites and lattice spacing $a$ in each of the $3$ dimensions, the momentum vectors $\\mathbf{k}$ are given by:\n$$ \\mathbf{k} = (k_x, k_y, k_z), \\quad \\text{where} \\quad k_i = \\frac{2\\pi}{La}n_i $$\nThe integers $n_i$ range from $-\\frac{L}{2}$ to $\\frac{L}{2}-1$ for each Cartesian component $i \\in \\{x,y,z\\}$. These momentum vectors populate the first Brillouin zone of the lattice.\n\nThe kinetic energy of a particle is modified on the lattice. The continuum kinetic term, proportional to $|\\mathbf{k}|^2$, is replaced by its lattice counterpart, $\\hat{k}^2$. A common form, which is used here, is derived from a symmetric finite difference approximation of the Laplacian operator:\n$$ \\hat{k}^2 = \\sum_{i \\in \\{x,y,z\\}} \\left( \\frac{2}{a} \\sin\\left(\\frac{a k_i}{2}\\right) \\right)^2 = \\sum_{i \\in \\{x,y,z\\}} \\left( \\frac{2}{a} \\sin\\left(\\frac{\\pi n_i}{L}\\right) \\right)^2 $$\nThis expression for $\\hat{k}^2$ is not a function of $|\\mathbf{k}|^2$ alone. For a fixed momentum magnitude $|\\mathbf{k}|$, the value of $\\hat{k}^2$ depends on the orientation of the vector $\\mathbf{k}$ relative to the lattice axes. This breaks the rotational symmetry of the continuum theory.\n\nThe propagator for a pion of mass $m_\\pi$ on the lattice, $D_{\\mathrm{lat}}(\\mathbf{k})$, is built using this lattice kinetic term:\n$$ D_{\\mathrm{lat}}(\\mathbf{k}) = \\frac{1}{\\hat{k}^2 + m_\\pi^2} $$\nThe anisotropy of $\\hat{k}^2$ is inherited by $D_{\\mathrm{lat}}(\\mathbf{k})$.\n\nTo restore rotational symmetry, we employ an angular averaging procedure. We group momentum vectors $\\mathbf{k}$ into shells. A shell is defined as the set of all vectors corresponding to integer triplets $(n_x, n_y, n_z)$ that have the same sum of squares, $N = n_x^2 + n_y^2 + n_z^2$. All vectors within such a shell have the same continuum magnitude, $|\\mathbf{k}|^2 = \\left(\\frac{2\\pi}{La}\\right)^2 N$. The averaged propagator, $D_{\\mathrm{avg}}$, is defined to be constant within each shell, its value being the arithmetic mean of $D_{\\mathrm{lat}}(\\mathbf{k})$ over all vectors in that shell.\n$$ D_{\\mathrm{avg}}(N) = \\frac{1}{\\mathcal{N}_N} \\sum_{\\mathbf{k} \\text{ in shell } N} D_{\\mathrm{lat}}(\\mathbf{k}) $$\nwhere $\\mathcal{N}_N$ is the number of momentum vectors in shell $N$. The resulting function $D_{\\mathrm{avg}}$ depends only on $N$, and thus only on $|\\mathbf{k}|$, restoring rotational symmetry by construction.\n\nTo quantify the effect of this procedure, we use the diagnostic $T$:\n$$ T[D] = \\frac{\\sum_{\\mathbf{k}\\neq \\mathbf{0}} \\left(3\\cos^2\\theta - 1\\right)\\, D(\\mathbf{k})\\, \\exp\\left(-\\frac{2|\\mathbf{k}|^2}{\\beta^2}\\right)}{\\sum_{\\mathbf{k}\\neq \\mathbf{0}} \\exp\\left(-\\frac{2|\\mathbf{k}|^2}{\\beta^2}\\right)} $$\nwhere $\\cos\\theta = k_z/|\\mathbf{k}|$. The term $(3\\cos^2\\theta - 1)$ is proportional to the spherical harmonic $Y_{20}(\\theta, \\phi)$, which integrates to zero over a sphere. When $D(\\mathbf{k})$ is a function of $|\\mathbf{k}|$ only, as $D_{\\mathrm{avg}}(\\mathbf{k})$ is, the numerator sum can be grouped by shells. Due to the cubic symmetry of the lattice, the sum of $(3\\cos^2\\theta - 1)$ over any complete shell is exactly zero. Therefore, $T[D_{\\mathrm{avg}}]$ is expected to be zero up to floating-point precision errors. In contrast, for the naive, anisotropic propagator $D_{\\mathrm{lat}}(\\mathbf{k})$, the term $D_{\\mathrm{lat}}(\\mathbf{k})$ is not constant within a shell, so this cancellation does not occur, and $T[D_{\\mathrm{lat}}]$ will be non-zero, providing a measure of the lattice-induced anisotropy.\n\nThe algorithm to be implemented is as follows:\n1. For each parameter set $(L, a, m_\\pi, \\beta)$, create the three-dimensional grid of integer vectors $\\mathbf{n}=(n_x, n_y, n_z)$.\n2. From $\\mathbf{n}$, compute the grids for the physical momenta $\\mathbf{k}$, their squared magnitude $|\\mathbf{k}|^2$, and the lattice kinetic term $\\hat{k}^2$.\n3. Calculate the naive propagator $D_{\\mathrm{lat}}(\\mathbf{k})$ for every point on the momentum grid.\n4. Determine the shell index $N = n_x^2+n_y^2+n_z^2$ for each grid point. Using this, group the $D_{\\mathrm{lat}}(\\mathbf{k})$ values by shell and compute the average for each shell, yielding $D_{\\mathrm{avg}}(N)$. Construct the $D_{\\mathrm{avg}}(\\mathbf{k})$ grid by assigning the appropriate shell-averaged value to each point $\\mathbf{k}$.\n5. Compute the components of the diagnostic $T$: the quadrupole factor $(3\\cos^2\\theta-1)$ and the Gaussian weight $\\exp(-2|\\mathbf{k}|^2/\\beta^2)$.\n6. Perform the sums for the numerator and denominator of $T$, excluding the $\\mathbf{k}=\\mathbf{0}$ mode, to find $T_{\\mathrm{naive}} = T[D_{\\mathrm{lat}}]$ and $T_{\\mathrm{avg}} = T[D_{\\mathrm{avg}}]$.\n7. Collect the results for all test cases and format the output as specified.\n\nThe implementation will leverage the `numpy` library for efficient vectorized operations on multi-dimensional arrays. The shell-averaging step can be efficiently performed using a combination of `numpy.unique` to identify the shells and `numpy.bincount` to perform the weighted sum and count for the average.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Computes a tensor-polarization-like diagnostic for a pion propagator\n    on a discretized momentum lattice, with and without rotational-symmetry\n    restoration, for a suite of test cases.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (L, a, m_pi, beta)\n        (16, 1.32, 0.70, 0.90),\n        (16, 0.99, 0.70, 0.90),\n        (32, 0.99, 0.70, 0.90),\n        (16, 1.32, 1.50, 0.90),\n    ]\n\n    results = []\n    \n    for L, a, m_pi, beta in test_cases:\n        # Use double precision floats for all calculations.\n        L, a, m_pi, beta = float(L), float(a), float(m_pi), float(beta)\n\n        # 1. Construct momentum grid\n        # Integer momentum indices n_i from -L/2 to L/2 - 1\n        n_coords = np.arange(-L / 2, L / 2, dtype=np.float64)\n        nx, ny, nz = np.meshgrid(n_coords, n_coords, n_coords, indexing='ij')\n\n        # Physical momenta k_i = (2*pi / (L*a)) * n_i\n        k_factor = (2.0 * np.pi) / (L * a)\n        kx = k_factor * nx\n        ky = k_factor * ny\n        kz = k_factor * nz\n\n        k_squared = kx**2 + ky**2 + kz**2\n\n        # 2. Compute the naive lattice propagator D_lat(k)\n        # Lattice Laplacian k_hat^2 = sum_i (2/a * sin(pi*n_i/L))^2\n        k_hat_squared = ( (2./a * np.sin(np.pi * nx / L))**2 +\n                          (2./a * np.sin(np.pi * ny / L))**2 +\n                          (2./a * np.sin(np.pi * nz / L))**2 )\n\n        # Naive propagator D_lat(k) = 1 / (k_hat^2 + m_pi^2)\n        d_lat = 1.0 / (k_hat_squared + m_pi**2)\n\n        # 3. Build the angular-averaged propagator D_avg(k)\n        # Group momenta by integer shell label N = nx^2 + ny^2 + nz^2\n        N = nx**2 + ny**2 + nz**2\n\n        # Use np.unique and np.bincount for efficient shell averaging\n        unique_N, inverse_indices = np.unique(N.flatten(), return_inverse=True)\n        \n        # Sum of d_lat values in each shell\n        sum_d_on_shell = np.bincount(inverse_indices, weights=d_lat.flatten())\n        # Count of points in each shell\n        count_on_shell = np.bincount(inverse_indices)\n        \n        # Average d_lat on each shell\n        avg_d_on_shell = sum_d_on_shell / count_on_shell\n\n        # Map the shell-averaged values back to the full grid\n        d_avg = avg_d_on_shell[inverse_indices].reshape(d_lat.shape)\n\n        # 4. Compute the diagnostic T for both propagators\n        # Mask to exclude the k=0 mode from sums\n        mask = (nx != 0) | (ny != 0) | (nz != 0)\n        \n        # Numerator components\n        cos_theta_sq = np.zeros_like(k_squared)\n        # Avoid division by zero at k=0\n        nonzero_k_mask = k_squared > 1e-15\n        cos_theta_sq[nonzero_k_mask] = kz[nonzero_k_mask]**2 / k_squared[nonzero_k_mask]\n        \n        quadrupole_factor = 3.0 * cos_theta_sq - 1.0\n        weight_factor = np.exp(-2.0 * k_squared / beta**2)\n\n        # Denominator for T is the sum of weights\n        denominator = np.sum(weight_factor[mask])\n        \n        # Numerator for T_naive\n        numerator_naive = np.sum((quadrupole_factor * d_lat * weight_factor)[mask])\n        \n        # Numerator for T_avg\n        numerator_avg = np.sum((quadrupole_factor * d_avg * weight_factor)[mask])\n\n        # Compute T_naive and T_avg\n        t_naive = numerator_naive / denominator\n        t_avg = numerator_avg / denominator\n        \n        results.extend([t_naive, t_avg])\n\n    # Final print statement in the exact required format.\n    # Round to 8 decimal places.\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```", "id": "3567097"}]}