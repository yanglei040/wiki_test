{"hands_on_practices": [{"introduction": "The foundation of many nuclear structure calculations, including those for electromagnetic transitions, is the single-particle matrix element. Before tackling complex many-body systems, one must master the analytical tools to evaluate how transition operators act between individual nucleon states. This foundational exercise ([@problem_id:3545957]) walks you through the derivation of the reduced matrix element for a general multipole operator in the $jj$-coupling scheme, providing essential practice with the powerful machinery of angular momentum algebra.", "problem": "Consider a single nucleon moving in a spherically symmetric mean-field potential, so that the single-particle eigenstates can be written as $\\lvert n \\, l \\, j \\, m_j \\rangle$ with orbital angular momentum $l$, intrinsic spin $s = \\tfrac{1}{2}$, total angular momentum $j$, and magnetic projection $m_j$. Let the spatial wave function separate into a radial part $R_{n l}(r)$ and an angular-spin part constructed by coupling $l$ and $s$ to $j$. Define the one-body spherical tensor operator of rank $\\lambda$ acting only in coordinate space by $T^{(\\lambda)}_{\\mu} = r^{\\lambda} Y_{\\lambda \\mu}(\\Omega)$, where $Y_{\\lambda \\mu}(\\Omega)$ are the Condon–Shortley spherical harmonics normalized by $\\int \\lvert Y_{\\lambda \\mu}(\\Omega) \\rvert^{2} \\, d\\Omega = 1$. Using only standard angular momentum coupling theory grounded in the Wigner–Eckart theorem and the recoupling of orbital and spin angular momenta via Wigner $6j$ symbols, derive from first principles the closed-form analytic expression for the reduced single-particle matrix element $\\langle n_b \\, l_b \\, j_b \\lVert r^{\\lambda} Y_{\\lambda} \\rVert n_a \\, l_a \\, j_a \\rangle$ in the $jj$-coupling scheme. Your final expression must be written in terms of:\n- a radial integral $R^{(\\lambda)}_{ba} \\equiv \\int_{0}^{\\infty} dr \\, r^{2} \\, R_{n_b l_b}(r) \\, r^{\\lambda} \\, R_{n_a l_a}(r)$,\n- one Wigner $3j$ symbol,\n- one Wigner $6j$ symbol,\n- and explicit dependence on $l_a$, $l_b$, $j_a$, $j_b$, and $\\lambda$.\nDefine any shorthand you introduce (for example, $\\hat{j} \\equiv \\sqrt{2j+1}$). Present the final result as a single closed-form analytic expression. Do not compute any numerical values.", "solution": "The problem statement is a standard exercise in the quantum theory of angular momentum, specifically within the context of the nuclear shell model. It requires the derivation of a reduced single-particle matrix element for an electromagnetic-type operator. The problem is scientifically grounded, well-posed, objective, and contains all necessary information. It is therefore deemed valid.\n\nThe objective is to derive the analytic expression for the reduced matrix element $\\langle n_b \\, l_b \\, j_b \\lVert T^{(\\lambda)} \\rVert n_a \\, l_a \\, j_a \\rangle$, where the single-particle operator is $T^{(\\lambda)}_{\\mu} = r^{\\lambda} Y_{\\lambda \\mu}(\\Omega)$. The single-particle states $|n \\, l \\, j \\, m_j \\rangle$ are eigenstates in a $jj$-coupling scheme.\n\nFirst, we define the shorthand notation $\\hat{j} \\equiv \\sqrt{2j+1}$ for any angular momentum $j$.\n\nThe single-particle wave function has a separable form, consisting of a radial part and an angular-spin part:\n$$\n\\Psi_{nljm_j}(\\mathbf{r}) = \\langle \\mathbf{r} | n \\, l \\, j \\, m_j \\rangle = R_{nl}(r) \\langle \\Omega, \\sigma | (ls)j m_j \\rangle\n$$\nHere, $R_{nl}(r)$ is the radial wave function and $|(ls)j m_j\\rangle$ is the coupled angular-spin state. The operator $T^{(\\lambda)}_{\\mu} = r^{\\lambda} Y_{\\lambda \\mu}(\\Omega)$ is a product of a purely radial part, $r^{\\lambda}$, and a purely angular part, $Y_{\\lambda \\mu}(\\Omega)$. Since $r^{\\lambda}$ is a scalar with respect to rotations, it does not affect the tensor properties of the operator. The matrix element can thus be factored into a radial integral and a reduced matrix element of the angular-spin part.\n\n$$\n\\langle n_b \\, l_b \\, j_b \\lVert r^{\\lambda} Y_{\\lambda} \\rVert n_a \\, l_a \\, j_a \\rangle = \\left( \\int_{0}^{\\infty} dr \\, r^{2} \\, R_{n_b l_b}(r) \\, r^{\\lambda} \\, R_{n_a l_a}(r) \\right) \\langle (l_b s) j_b \\lVert Y_{\\lambda} \\rVert (l_a s) j_a \\rangle\n$$\nThe radial integral corresponds precisely to the definition of $R^{(\\lambda)}_{ba}$ given in the problem statement. The task reduces to calculating the reduced matrix element of $Y_{\\lambda}$ in the coupled basis, $\\langle (l_b s) j_b \\lVert Y_{\\lambda} \\rVert (l_a s) j_a \\rangle$.\n\nThe operator $Y_{\\lambda}$ acts only on the orbital part (subspace 1) of the coupled state $|(ls)j\\rangle$ and is a scalar operator (identity) with respect to the spin part (subspace 2). For such an operator, a standard formula from angular momentum recoupling theory gives the reduced matrix element in the coupled basis in terms of the reduced matrix element in the uncoupled basis. The formula is:\n$$\n\\langle (j_1 j_2)J \\lVert F^{(k)} \\rVert (j'_1 j'_2)J' \\rangle = \\delta_{j_2 j'_2} (-1)^{j_1+j_2+J'+k} \\hat{J} \\hat{J'} \\begin{Bmatrix} J & k & J' \\\\ j'_1 & j_1 & j_2 \\end{Bmatrix} \\langle j_1 \\lVert F^{(k)} \\rVert j'_1 \\rangle\n$$\nWe make the following identifications:\n_Subspace 1 (orbital):_ $j_1 \\to l_b$, $j'_1 \\to l_a$.\n_Subspace 2 (spin):_ $j_2 \\to s$, $j'_2 \\to s$.\n_Coupled states:_ $J \\to j_b$, $J' \\to j_a$.\n_Operator:_ $F^{(k)} \\to Y_{\\lambda}$, so $k \\to \\lambda$.\n\nThe condition $\\delta_{s,s}=1$ is met. Substituting these into the formula, we obtain:\n$$\n\\langle (l_b s) j_b \\lVert Y_{\\lambda} \\rVert (l_a s) j_a \\rangle = (-1)^{l_b+s+j_a+\\lambda} \\hat{j_b} \\hat{j_a} \\begin{Bmatrix} j_b & \\lambda & j_a \\\\ l_a & l_b & s \\end{Bmatrix} \\langle l_b \\lVert Y_{\\lambda} \\rVert l_a \\rangle\n$$\nThe next step is to find an explicit expression for the reduced matrix element of the spherical harmonic in the orbital basis, $\\langle l_b \\lVert Y_{\\lambda} \\rVert l_a \\rangle$. We can derive this using the Wigner-Eckart theorem and the known formula for the integral of three spherical harmonics (the Gaunt integral).\n\nThe Wigner-Eckart theorem states:\n$$\n\\langle l_b m_{l_b} | Y_{\\lambda \\mu} | l_a m_{l_a} \\rangle = (-1)^{l_b-m_{l_b}} \\begin{pmatrix} l_b & \\lambda & l_a \\\\ -m_{l_b} & \\mu & m_{l_a} \\end{pmatrix} \\langle l_b \\lVert Y_{\\lambda} \\rVert l_a \\rangle\n$$\nThe matrix element on the left is also given by the Gaunt integral:\n$$\n\\langle l_b m_{l_b} | Y_{\\lambda \\mu} | l_a m_{l_a} \\rangle = \\int d\\Omega \\, Y_{l_b m_{l_b}}^*(\\Omega) Y_{\\lambda \\mu}(\\Omega) Y_{l_a m_{l_a}}(\\Omega)\n$$\nUsing the Condon-Shortley phase convention, $Y_{lm}^* = (-1)^m Y_{l,-m}$, this becomes:\n$$\n(-1)^{m_{l_b}} \\int d\\Omega \\, Y_{l_b, -m_{l_b}}(\\Omega) Y_{\\lambda \\mu}(\\Omega) Y_{l_a m_{l_a}}(\\Omega)\n$$\nThe integral of three spherical harmonics is given by:\n$$\n\\int Y_{j_1 m_1} Y_{j_2 m_2} Y_{j_3 m_3} d\\Omega = \\sqrt{\\frac{\\hat{j_1}^2 \\hat{j_2}^2 \\hat{j_3}^2}{4\\pi}} \\begin{pmatrix} j_1 & j_2 & j_3 \\\\ 0 & 0 & 0 \\end{pmatrix} \\begin{pmatrix} j_1 & j_2 & j_3 \\\\ m_1 & m_2 & m_3 \\end{pmatrix}\n$$\nApplying this to our integral yields:\n$$\n\\langle l_b m_{l_b} | Y_{\\lambda \\mu} | l_a m_{l_a} \\rangle = (-1)^{m_{l_b}} \\sqrt{\\frac{\\hat{l_b}^2 \\hat{\\lambda}^2 \\hat{l_a}^2}{4\\pi}} \\begin{pmatrix} l_b & \\lambda & l_a \\\\ 0 & 0 & 0 \\end{pmatrix} \\begin{pmatrix} l_b & \\lambda & l_a \\\\ -m_{l_b} & \\mu & m_{l_a} \\end{pmatrix}\n$$\nBy comparing this result with the Wigner-Eckart theorem expression, we can extract the reduced matrix element:\n$$\n\\langle l_b \\lVert Y_{\\lambda} \\rVert l_a \\rangle = (-1)^{l_b} \\sqrt{\\frac{(2l_a+1)(2l_b+1)(2\\lambda+1)}{4\\pi}} \\begin{pmatrix} l_b & \\lambda & l_a \\\\ 0 & 0 & 0 \\end{pmatrix}\n$$\nNow we assemble all the components. The full reduced matrix element is:\n$$\n\\langle n_b l_b j_b \\lVert r^{\\lambda} Y_{\\lambda} \\rVert n_a l_a j_a \\rangle = R_{ba}^{(\\lambda)} \\times \\left( (-1)^{l_b+s+j_a+\\lambda} \\hat{j_b} \\hat{j_a} \\begin{Bmatrix} j_b & \\lambda & j_a \\\\ l_a & l_b & s \\end{Bmatrix} \\langle l_b \\lVert Y_{\\lambda} \\rVert l_a \\rangle \\right)\n$$\nSubstituting the expression for $\\langle l_b \\lVert Y_{\\lambda} \\rVert l_a \\rangle$:\n$$\n= R_{ba}^{(\\lambda)} (-1)^{l_b+s+j_a+\\lambda} \\hat{j_b} \\hat{j_a} \\begin{Bmatrix} j_b & \\lambda & j_a \\\\ l_a & l_b & s \\end{Bmatrix} \\left( (-1)^{l_b} \\frac{\\hat{l_a}\\hat{l_b}\\hat{\\lambda}}{\\sqrt{4\\pi}} \\begin{pmatrix} l_b & \\lambda & l_a \\\\ 0 & 0 & 0 \\end{pmatrix} \\right)\n$$\nThe phase factor simplifies: $(-1)^{l_b+s+j_a+\\lambda} (-1)^{l_b} = (-1)^{2l_b+s+j_a+\\lambda} = (-1)^{s+j_a+\\lambda}$.\nThe problem specifies a nucleon, for which the intrinsic spin is $s=1/2$. Substituting this value, the final expression is:\n$$\n\\langle n_b l_b j_b \\lVert r^{\\lambda} Y_{\\lambda} \\rVert n_a l_a j_a \\rangle = R_{ba}^{(\\lambda)} \\frac{(-1)^{1/2+j_a+\\lambda}}{\\sqrt{4\\pi}} \\hat{j_a}\\hat{j_b}\\hat{l_a}\\hat{l_b}\\hat{\\lambda} \\begin{Bmatrix} j_b & \\lambda & j_a \\\\ l_a & l_b & 1/2 \\end{Bmatrix} \\begin{pmatrix} l_b & \\lambda & l_a \\\\ 0 & 0 & 0 \\end{pmatrix}\n$$\nThis expression contains the radial integral, one Wigner $6j$ symbol, one Wigner $3j$ symbol, and explicit dependence on the relevant quantum numbers, as required. The Wigner $3j$ symbol $\\begin{pmatrix} l_b & \\lambda & l_a \\\\ 0 & 0 & 0 \\end{pmatrix}$ enforces the parity selection rule, being non-zero only if $l_a+l_b+\\lambda$ is an even integer.", "answer": "$$\\boxed{R^{(\\lambda)}_{ba} \\frac{(-1)^{1/2+j_a+\\lambda}}{\\sqrt{4\\pi}} \\sqrt{(2j_a+1)(2j_b+1)(2l_a+1)(2l_b+1)(2\\lambda+1)} \\begin{Bmatrix} j_b & \\lambda & j_a \\\\ l_a & l_b & 1/2 \\end{Bmatrix} \\begin{pmatrix} l_b & \\lambda & l_a \\\\ 0 & 0 & 0 \\end{pmatrix}}$$", "id": "3545957"}, {"introduction": "In theoretical physics, a single observable can often be represented by different but equivalent mathematical forms, a concept related to gauge invariance. For electric dipole transitions, the 'length' and 'velocity' forms of the operator should yield identical results, a consequence of Siegert's theorem. This computational practice ([@problem_id:3545976]) invites you to test this equivalence numerically and discover how it can be broken in the finite, truncated model spaces that are a necessity in any practical calculation, offering a critical insight into the nature of approximation in computational physics.", "problem": "You are asked to implement a numerical experiment in the domain of computational nuclear physics to assess gauge-form equivalence of electric dipole ($E1$) transition rates under incomplete model spaces. Work strictly within non-relativistic quantum mechanics and use a single-particle Hamiltonian on a one-dimensional coordinate to emulate the essential features of electric dipole transitions. The fundamental base of your derivation and algorithm must start from the time-independent Schrödinger equation, the canonical position and momentum operators, and the relation between electromagnetic transition operators in different gauges via commutators.\n\nConsider a single nucleon moving in a one-dimensional confining potential. Adopt units in which $\\hbar = 1$, $m = 1$, and choose an oscillator length scale $b = 1$. Construct a truncated basis of $N$ harmonic oscillator number states $\\{|n\\rangle\\}_{n=0}^{N-1}$ to represent operators and the Hamiltonian. Define the annihilation operator $a$ and creation operator $a^\\dagger$ acting on the basis by $a|n\\rangle = \\sqrt{n}\\,|n-1\\rangle$ and $a^\\dagger|n\\rangle = \\sqrt{n+1}\\,|n+1\\rangle$. Using these operators, define the position operator $x$ and the momentum operator $p$ by\n$$\nx = \\frac{b}{\\sqrt{2}}\\,(a + a^\\dagger), \\qquad p = \\frac{i}{\\sqrt{2} b}\\,(a^\\dagger - a),\n$$\nwhich follow from canonical quantization with the chosen oscillator length scale $b$. Construct the Hamiltonian\n$$\nH = \\frac{1}{2}p^2 + \\frac{1}{2}\\,\\omega^2 x^2 + \\alpha\\,x^4,\n$$\nwhere $\\omega$ is a frequency parameter and $\\alpha$ controls an anharmonic quartic term. For $\\alpha = 0$, the model is a pure harmonic oscillator; for $\\alpha \\neq 0$, the quartic term induces deviations from a harmonic spectrum and increases sensitivity to basis truncation.\n\nYour task is to compute and compare, for the transition from the first excited state ($|i\\rangle$) to the ground state ($|f\\rangle$) obtained by diagonalizing $H$ in the truncated basis:\n- The length-form electric dipole matrix element,\n$$\nM_L = \\langle f|\\,x\\,|i\\rangle,\n$$\n- The velocity-form electric dipole matrix element,\n$$\nM_V = \\frac{\\langle f|\\,p\\,|i\\rangle}{m\\,\\omega_{fi}},\n$$\nwhere $m=1$ and $\\omega_{fi} = E_i - E_f$ is the transition angular frequency determined from the eigenvalues of $H$. The equivalence between length and velocity forms for exact eigenstates of the exact Hamiltonian follows from the fundamental commutator $[H,x] = -i p/m$ (since $m=1$ and $\\hbar=1$), which itself derives from the canonical commutation relation and the form of the non-relativistic kinetic energy. In an incomplete model space (finite $N$), truncation errors and the presence of anharmonicity ($\\alpha \\neq 0$) can break this equivalence numerically.\n\nDefine the reduced transition probability proxies in the two forms by\n$$\nB_L = |M_L|^2, \\qquad B_V = |M_V|^2,\n$$\nwhich are proportional to the reduced transition probability for electric dipole transitions up to a common constant factor. Since the emission rate for electric dipole transitions is proportional to $E_\\gamma^3 B(E1)$ with the same $E_\\gamma$ for both gauges, the relative difference in the reduced probabilities is a faithful proxy for the relative difference in transition rates. Quantify the gauge-form difference using the dimensionless fractional deviation\n$$\n\\delta = \\frac{B_V - B_L}{B_L}.\n$$\n\nImplement a program that:\n1. Builds matrices for $x$, $p$, and $H$ in the truncated harmonic oscillator basis for given $(\\alpha, N, \\omega)$.\n2. Diagonalizes $H$ to obtain the two lowest eigenvalues $E_f < E_i$ and corresponding eigenvectors.\n3. Computes $M_L$, $M_V$, $B_L$, $B_V$, and returns $\\delta$ for the transition $i \\to f$.\n\nNo external input is allowed; hard-code the test suite specified below. Angles do not appear in this problem, and the final outputs are dimensionless floats, so no physical units are required for the outputs.\n\nTest suite to evaluate different facets of the solution:\n- Case 1 (exact equivalence baseline, happy path): $(\\alpha, N, \\omega) = (0.0, 10, 1.0)$.\n- Case 2 (small anharmonicity, large space, near-equivalence): $(\\alpha, N, \\omega) = (0.05, 40, 1.0)$.\n- Case 3 (small anharmonicity, small space, visible violation): $(\\alpha, N, \\omega) = (0.05, 6, 1.0)$.\n- Case 4 (strong anharmonicity, moderate space, significant violation): $(\\alpha, N, \\omega) = (0.5, 20, 1.0)$.\n\nYour program should produce a single line of output containing the results for these four cases as a comma-separated list enclosed in square brackets in the order listed above. For example, if the fractional deviations are $\\delta_1, \\delta_2, \\delta_3, \\delta_4$, the output must be formatted exactly as\n\"[delta1,delta2,delta3,delta4]\".", "solution": "The present problem requires the numerical implementation of a procedure to quantify the violation of gauge-form equivalence for electric dipole ($E1$) transitions within a truncated model space. The core of this investigation lies in the relationship between the length form and velocity form of the electric dipole operator, which is strictly valid only for exact eigenstates of the full, untruncated Hamiltonian.\n\nWe begin with the fundamental principles of non-relativistic quantum mechanics. The system consists of a single particle of mass $m$ in a one-dimensional potential. The Hamiltonian is given by\n$$\nH = T + V = \\frac{p^2}{2m} + V(x)\n$$\nwhere $x$ and $p$ are the canonical position and momentum operators, satisfying the commutation relation $[x, p] = i\\hbar$.\n\nThe interaction of a charged particle with an electromagnetic field, in the long-wavelength limit (dipole approximation), can be described using different but equivalent \"gauges\" for the operator. The two most common forms are the length form, proportional to the position operator $x$, and the velocity form, proportional to the momentum operator $p$. The transition matrix element between an initial state $|i\\rangle$ and a final state $|f\\rangle$ (eigenstates of $H$ with energies $E_i$ and $E_f$, respectively) in these two forms are defined as $M_L = \\langle f|x|i\\rangle$ and $M_V' = \\langle f|p|i\\rangle$.\n\nThe theoretical equivalence between these forms arises from the Heisenberg equation of motion for the position operator, $\\dot{x} = \\frac{1}{i\\hbar}[x, H]$. The matrix element of this equation is:\n$$\n\\langle f|\\dot{x}|i\\rangle = \\frac{1}{i\\hbar}\\langle f|xH - Hx|i\\rangle = \\frac{1}{i\\hbar}(E_i - E_f)\\langle f|x|i\\rangle = \\frac{\\omega_{fi}}{i\\hbar}\\langle f|x|i\\rangle\n$$\nwhere $\\omega_{fi} = E_i - E_f$. Since classically $p = m\\dot{x}$, we identify the matrix element of the momentum operator as $\\langle f|p|i\\rangle = m\\langle f|\\dot{x}|i\\rangle$. Combining these relations yields:\n$$\n\\langle f|p|i\\rangle = m \\left( \\frac{\\omega_{fi}}{i\\hbar} \\right) \\langle f|x|i\\rangle = -i\\frac{m\\omega_{fi}}{\\hbar} \\langle f|x|i\\rangle\n$$\nThe problem defines the velocity-form matrix element as $M_V = \\frac{\\langle f|p|i\\rangle}{m\\omega_{fi}}$. Substituting the derived relationship between the matrix elements of $p$ and $x$ and setting $\\hbar=1$ as per the problem specification, we find:\n$$\nM_V = \\frac{-i (m\\omega_{fi}) \\langle f|x|i\\rangle}{m\\omega_{fi}} = -i\\langle f|x|i\\rangle = -i M_L\n$$\nThis implies that for the exact eigenstates, the squared magnitudes of these matrix elements are equal: $B_V = |M_V|^2 = |-i M_L|^2 = |M_L|^2 = B_L$. The fractional deviation $\\delta = (B_V - B_L)/B_L$ is therefore exactly zero. This equivalence is a manifestation of a general principle known as Siegert's theorem.\n\nThe core of the numerical task is to represent this system within a finite, truncated basis and observe the breakdown of this equivalence. We use a basis composed of the lowest $N$ eigenstates of the simple harmonic oscillator (HO), $\\{|n\\rangle\\}_{n=0}^{N-1}$. In this basis, any operator $O$ becomes an $N \\times N$ matrix with elements $O_{mn} = \\langle m|O|n\\rangle$.\n\nThe algorithm proceeds as follows:\n1.  **Construct Operator Matrices**:\n    *   The annihilation ($a$) and creation ($a^\\dagger$) operators are constructed as $N \\times N$ matrices based on their actions $a|n\\rangle = \\sqrt{n}|n-1\\rangle$ and $a^\\dagger|n\\rangle = \\sqrt{n+1}|n+1\\rangle$. The resulting matrix for $a$ has non-zero elements only on the first super-diagonal, and the matrix for $a^\\dagger$ is its transpose.\n    *   The matrices for position ($X$) and momentum ($P$) are built using the provided definitions in terms of the matrices for $a$ and $a^\\dagger$:\n        $$\n        X = \\frac{b}{\\sqrt{2}}(A + A^\\dagger), \\qquad P = \\frac{i}{\\sqrt{2} b}(A^\\dagger - A)\n        $$\n        With the problem's units ($b=1$), these matrices are constructed.\n    *   The Hamiltonian matrix $H_{mat}$ is assembled from the operator matrices using matrix multiplication and addition:\n        $$\n        H_{mat} = \\frac{1}{2}P^2 + \\frac{1}{2}\\omega^2 X^2 + \\alpha X^4\n        $$\n\n2.  **Solve the Eigenvalue Problem**:\n    *   The matrix $H_{mat}$ is Hermitian. We diagonalize it using a standard numerical library function (e.g., `scipy.linalg.eigh`) to find its eigenvalues and eigenvectors.\n    *   The eigenvalues are sorted in ascending order. The lowest eigenvalue is identified as the ground state energy, $E_f$, and the second-lowest as the first excited state energy, $E_i$.\n    *   The corresponding eigenvectors, $|f\\rangle$ and $|i\\rangle$, are columns of coefficients representing these states in the chosen HO basis.\n\n3.  **Compute Transition Properties**:\n    *   The transition energy is calculated as $\\omega_{fi} = E_i - E_f$.\n    *   The length-form matrix element is computed via matrix multiplication: $M_L = \\langle f|X|i\\rangle = |f\\rangle^\\dagger X |i\\rangle$.\n    *   Similarly, the momentum matrix element is computed: $\\langle f|P|i\\rangle = |f\\rangle^\\dagger P |i\\rangle$.\n    *   The velocity-form matrix element is then $M_V = \\frac{\\langle f|P|i\\rangle}{m\\omega_{fi}}$, with $m=1$.\n    *   The reduced transition probability proxies are $B_L = |M_L|^2$ and $B_V = |M_V|^2$.\n    *   Finally, the fractional deviation $\\delta = (B_V - B_L) / B_L$ is calculated. This value quantifies the degree to which the gauge equivalence is violated due to the finite basis size $N$ and the presence of the anharmonic term $\\alpha x^4$. When $\\alpha \\neq 0$, the exact eigenstates of $H$ are no longer simple HO states but infinite superpositions. Truncating the basis at a finite $N$ omits components of the true wavefunctions, which breaks the commutator identity at the matrix level and leads to $\\delta \\neq 0$.\n\nThis procedure is repeated for each set of parameters $(\\alpha, N, \\omega)$ in the provided test suite.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import eigh\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Test suite to evaluate different facets of the solution:\n    # (alpha, N, omega)\n    test_cases = [\n        (0.0, 10, 1.0),\n        (0.05, 40, 1.0),\n        (0.05, 6, 1.0),\n        (0.5, 20, 1.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        alpha, N, omega = case\n        delta = calculate_deviation(alpha, N, omega)\n        results.append(delta)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\ndef calculate_deviation(alpha, N, omega):\n    \"\"\"\n    Calculates the gauge-form deviation for a given set of parameters.\n\n    Args:\n        alpha (float): Strength of the anharmonic term.\n        N (int): Dimension of the truncated harmonic oscillator basis.\n        omega (float): Frequency parameter of the harmonic potential.\n\n    Returns:\n        float: The fractional deviation delta = (B_V - B_L) / B_L.\n    \"\"\"\n    # Use parameters specified in the problem statement\n    hbar = 1.0\n    m = 1.0\n    b = 1.0\n\n    # Step 1: Build operator matrices in the truncated HO basis\n    \n    # Annihilation operator `a`\n    # Matrix element a_mn = <m|a|n> = sqrt(n) * delta_{m, n-1}.\n    # This corresponds to non-zero elements at (row, col) = (n-1, n),\n    # which is the first super-diagonal (k=1).\n    diag_elements_a = np.sqrt(np.arange(1, N, dtype=float))\n    a = np.diag(diag_elements_a, k=1)\n    \n    # Creation operator `a_dag` is the conjugate transpose of `a`.\n    # Since `a` is real, this is simply the transpose.\n    a_dag = a.T\n    \n    # Position operator `x`\n    x = (b / np.sqrt(2.0)) * (a + a_dag)\n    \n    # Momentum operator `p`\n    p = (1j * hbar / (np.sqrt(2.0) * b)) * (a_dag - a)\n    \n    # Hamiltonian `H`\n    x2 = x @ x\n    x4 = x2 @ x2\n    p2 = p @ p\n    \n    # p is purely imaginary, so p^2 is real. Enforce this to avoid\n    # small imaginary noise from floating point inaccuracies.\n    p2_real = np.real(p2)\n    \n    H = (1.0 / (2.0 * m)) * p2_real + 0.5 * m * omega**2 * x2 + alpha * x4\n    \n    # Step 2: Diagonalize the Hamiltonian matrix\n    # eigh is used for Hermitian matrices, returns sorted eigenvalues\n    # and corresponding eigenvectors as columns.\n    eigenvalues, eigenvectors = eigh(H)\n    \n    # Identify ground state (f) and first excited state (i)\n    E_f = eigenvalues[0]\n    psi_f = eigenvectors[:, 0]\n    \n    E_i = eigenvalues[1]\n    psi_i = eigenvectors[:, 1]\n\n    # Step 3: Compute transition properties\n    \n    # Transition energy\n    omega_fi = E_i - E_f\n    if omega_fi <= 0:\n        # Should not happen for a confining potential, indicates an issue.\n        return np.nan\n\n    # Length-form matrix element M_L = <f|x|i>\n    # Eigenvectors from eigh of a real symmetric matrix are real.\n    M_L = psi_f.T @ x @ psi_i\n\n    # Momentum matrix element for velocity form\n    # M_p = <f|p|i>\n    # psi_f is real, p is complex, so the result is complex\n    M_p = psi_f.T @ p @ psi_i\n    \n    # Velocity-form matrix element M_V\n    M_V = M_p / (m * omega_fi)\n    \n    # Reduced transition probability proxies B_L and B_V\n    B_L = np.abs(M_L)**2\n    B_V = np.abs(M_V)**2\n    \n    # Fractional deviation delta\n    if B_L == 0:\n        return np.inf if B_V != 0 else 0.0\n        \n    delta = (B_V - B_L) / B_L\n    \n    return delta\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3545976"}, {"introduction": "Calculating the full spectrum of a realistic nucleus is often computationally intractable due to the immense size of the Hamiltonian matrix. The Lanczos method provides a powerful alternative, allowing us to compute the distribution of transition strengths without performing a full diagonalization. This advanced exercise ([@problem_id:3545977]) guides you through the implementation of the Lanczos strength-function method, providing hands-on experience with a workhorse algorithm that is indispensable in modern large-scale nuclear shell-model calculations.", "problem": "Write a complete, runnable program that implements the Lanczos strength-function method to compute discrete electromagnetic transition strengths in finite-dimensional model spaces and assess convergence with respect to the number of Lanczos vectors. The program must adhere to the following specification.\n\n- Mathematical definitions:\n  - Let $H \\in \\mathbb{R}^{N \\times N}$ be a real symmetric Hamiltonian matrix with orthonormal eigenpairs $\\{ \\lvert n \\rangle, E_n \\}$, so that $H \\lvert n \\rangle = E_n \\lvert n \\rangle$ and $\\langle n \\vert m \\rangle = \\delta_{nm}$.\n  - Let $O \\in \\mathbb{R}^{N \\times N}$ be a real symmetric transition operator.\n  - Let the initial state $\\lvert i \\rangle \\in \\mathbb{R}^N$ be a normalized vector. For cases where $\\lvert i \\rangle$ is the ground state of $H$, it means $\\lvert i \\rangle$ is the normalized eigenvector of $H$ associated with the smallest eigenvalue $E_i$.\n  - The exact discrete strength distribution from $\\lvert i \\rangle$ is\n    $$ S(\\omega) = \\sum_{n=1}^{N} \\left| \\langle n \\lvert O \\rvert i \\rangle \\right|^2 \\, \\delta\\!\\left(\\omega - (E_n - E_i)\\right). $$\n  - The Lanczos strength-function approximation is constructed by:\n    - Starting vector $\\lvert \\phi_0 \\rangle = \\frac{O \\lvert i \\rangle}{\\| O \\lvert i \\rangle \\|}$ if $\\| O \\lvert i \\rangle \\| \\neq 0$, otherwise the distribution is identically zero.\n    - Perform $m$-step Lanczos tridiagonalization of $H$ on the Krylov subspace $\\mathcal{K}_m(H,\\lvert \\phi_0 \\rangle) = \\text{span}\\{\\lvert \\phi_0 \\rangle, H \\lvert \\phi_0 \\rangle, \\dots, H^{m-1} \\lvert \\phi_0 \\rangle\\}$ to obtain the tridiagonal matrix $T_m$ with eigenpairs $\\{ \\theta_k, \\lvert y_k \\rangle \\}$, where $\\lvert y_k \\rangle$ are eigenvectors of $T_m$ and $\\theta_k \\in \\mathbb{R}$ are the corresponding Ritz energies.\n    - The approximate discrete strengths and transition energies are\n      $$ \\tilde{S}(\\omega) = \\sum_{k=1}^{m'} w_k \\, \\delta\\!\\left(\\omega - (\\theta_k - E_i)\\right), \\quad w_k = \\| O \\lvert i \\rangle \\|^2 \\, \\left| \\langle e_1 \\vert y_k \\rangle \\right|^2, $$\n      where $m' \\le m$ is the numerical rank of the constructed tridiagonalization (terminates early if a Lanczos norm vanishes), and $\\lvert e_1 \\rangle$ is the first basis vector of $\\mathbb{R}^{m'}$.\n  - To assess convergence, compare the exact and Lanczos-approximated smeared strength functions\n    $$ S_\\sigma(\\omega) = \\sum_{n=1}^{N} \\left| \\langle n \\lvert O \\rvert i \\rangle \\right|^2 \\, g_\\sigma\\!\\left(\\omega - (E_n - E_i)\\right), \\quad\n       \\tilde{S}_\\sigma(\\omega) = \\sum_{k=1}^{m'} w_k \\, g_\\sigma\\!\\left(\\omega - (\\theta_k - E_i)\\right), $$\n    where $g_\\sigma(x) = \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\!\\left(-\\frac{x^2}{2\\sigma^2}\\right)$ is a Gaussian of width $\\sigma$.\n  - Sum rules to validate numerics:\n    - Zeroth-moment sum rule (non-energy-weighted): $\\int_{-\\infty}^{\\infty} S(\\omega)\\, d\\omega = \\langle i \\lvert O^2 \\rvert i \\rangle$.\n    - The corresponding Lanczos approximation satisfies $\\sum_{k} w_k \\approx \\langle i \\lvert O^2 \\rvert i \\rangle$ in finite arithmetic.\n\n- Numerical and output requirements:\n  - All quantities are dimensionless; energies and strengths must be treated as dimensionless numbers. No physical units are required.\n  - Use a Gaussian smearing width of $\\sigma = 0.15$ and a uniform grid in $\\omega$ with spacing $\\Delta \\omega = 0.01$. The grid must cover the interval\n    $$ \\omega \\in [\\min(\\Delta E) - 0.5, \\max(\\Delta E) + 0.5], \\quad \\Delta E = \\{ E_n - E_i \\}_{n=1}^{N}, $$\n    and must also include the approximate transition energies $\\{ \\theta_k - E_i \\}$ when present.\n  - For each test case, compute two scalar diagnostics:\n    - The relative $\\ell_1$ error of the smeared distributions on the grid,\n      $$ \\varepsilon_{\\mathrm{L1}} = \\frac{\\sum_j \\left| \\tilde{S}_\\sigma(\\omega_j) - S_\\sigma(\\omega_j) \\right|}{\\sum_j S_\\sigma(\\omega_j)}, $$\n      with the convention that if the denominator is zero (identically zero strength), then $\\varepsilon_{\\mathrm{L1}} = 0$.\n    - The relative error in the non-energy-weighted sum rule,\n      $$ \\varepsilon_{0} = \n         \\begin{cases}\n           \\dfrac{\\left| \\sum_k w_k - \\sum_n \\left| \\langle n \\lvert O \\rvert i \\rangle \\right|^2 \\right|}{\\sum_n \\left| \\langle n \\lvert O \\rvert i \\rangle \\right|^2}, & \\text{if } \\sum_n \\left| \\langle n \\lvert O \\rvert i \\rangle \\right|^2 > 0, \\\\\n           0, & \\text{otherwise.}\n         \\end{cases}\n      $$\n  - Define a convergence flag for each test case as a boolean\n    $$ \\text{converged} = \\left( \\varepsilon_{\\mathrm{L1}} \\le \\tau \\right), \\quad \\tau = 0.05. $$\n\n- Test suite:\n  - Use the following four test cases. In all cases $N = 6$ and all matrices are given explicitly; matrix entries not shown are zero, and all matrices are symmetric with $M_{ij} = M_{ji}$.\n  - For cases where the initial state is the ground state, take $\\lvert i \\rangle$ to be the normalized eigenvector of $H$ associated with the smallest eigenvalue obtained by exact diagonalization; if there is degeneracy at the minimum, choose the eigenvector in that degenerate subspace having the largest overlap with the canonical basis vector $\\lvert e_1 \\rangle$.\n  - Test Case $1$ (happy path):\n    - $H_1 = \\begin{pmatrix}\n      -3.0 & 0.2 & 0.0 & 0.0 & 0.0 & 0.0\\\\\n      0.2 & -1.5 & 0.3 & 0.0 & 0.0 & 0.0\\\\\n      0.0 & 0.3 & 0.5 & 0.4 & 0.0 & 0.0\\\\\n      0.0 & 0.0 & 0.4 & 1.8 & 0.5 & 0.0\\\\\n      0.0 & 0.0 & 0.0 & 0.5 & 3.0 & 0.6\\\\\n      0.0 & 0.0 & 0.0 & 0.0 & 0.6 & 4.5\n      \\end{pmatrix}$,\n      $O_1 = \\begin{pmatrix}\n      0.0 & 0.5 & 0.1 & 0.0 & 0.0 & 0.0\\\\\n      0.5 & 0.0 & 0.4 & 0.2 & 0.0 & 0.0\\\\\n      0.1 & 0.4 & 0.0 & 0.3 & 0.2 & 0.0\\\\\n      0.0 & 0.2 & 0.3 & 0.0 & 0.4 & 0.1\\\\\n      0.0 & 0.0 & 0.2 & 0.4 & 0.0 & 0.5\\\\\n      0.0 & 0.0 & 0.0 & 0.1 & 0.5 & 0.0\n      \\end{pmatrix}$,\n      initial state $\\lvert i \\rangle$ is the ground state of $H_1$, $m = 4$.\n  - Test Case $2$ (boundary in $m$):\n    - Same $H_1$ and $O_1$ as in Test Case $1$, initial state $\\lvert i \\rangle$ is the ground state of $H_1$, $m = 1$.\n  - Test Case $3$ (zero operator edge case):\n    - Same $H_1$ as in Test Case $1$, take $O_0 = 0_{6 \\times 6}$ (the $6 \\times 6$ zero matrix), initial state $\\lvert i \\rangle$ is the ground state of $H_1$, $m = 4$.\n  - Test Case $4$ (degenerate Hamiltonian):\n    - $H_2 = \\mathrm{diag}(0.0,\\, 0.0,\\, 1.0,\\, 1.5,\\, 2.5,\\, 2.5)$,\n      $O_2 = \\begin{pmatrix}\n      0.0 & 0.3 & 0.2 & 0.0 & 0.1 & 0.0\\\\\n      0.3 & 0.0 & 0.0 & 0.2 & 0.0 & 0.1\\\\\n      0.2 & 0.0 & 0.0 & 0.3 & 0.0 & 0.0\\\\\n      0.0 & 0.2 & 0.3 & 0.0 & 0.4 & 0.0\\\\\n      0.1 & 0.0 & 0.0 & 0.4 & 0.0 & 0.2\\\\\n      0.0 & 0.1 & 0.0 & 0.0 & 0.2 & 0.0\n      \\end{pmatrix}$,\n      initial state $\\lvert i \\rangle = \\lvert e_1 \\rangle = (1,0,0,0,0,0)^\\top$, $m = 4$.\n\n- Required final output format:\n  - For each test case, output a list containing three entries $[\\varepsilon_{\\mathrm{L1}}, \\varepsilon_0, \\text{converged}]$, where the boolean is printed as a language-native boolean literal.\n  - The program must produce a single line of output containing the results as a comma-separated list of these per-test-case lists enclosed in square brackets, for example:\n    $$ \\texttt{[[0.0123,0.0001,True],[\\dots],\\dots]} $$\n  - No other text may be printed.\n\nAll computations must be performed in pure floating-point arithmetic. The program must be self-contained, must not read any input, and must not access external files or the network. The implementation language and environment constraints are specified in the final answer section. All energies and strengths are to be treated as dimensionless numbers. Angles are not used. Percentages must not be used; all errors must be given as decimal fractions.", "solution": "The user wants to implement the Lanczos strength-function method to compute and analyze electromagnetic transition strengths. This is a common technique in computational nuclear physics and quantum chemistry for studying the response of a quantum system to an external probe when full diagonalization of the Hamiltonian is computationally expensive or intractable. Here, we apply it to small, well-defined model systems to validate the method and its implementation.\n\n### Validation of the Problem Statement\n**Step 1: Extract Givens**\n- **Hamiltonian ($H$)**: A real symmetric $N \\times N$ matrix.\n- **Transition Operator ($O$)**: A real symmetric $N \\times N$ matrix.\n- **Initial State ($\\lvert i \\rangle$)**: A normalized vector in $\\mathbb{R}^N$. It can be a specific eigenvector (e.g., ground state) of $H$. For degenerate ground states, a tie-breaking rule is provided: choose the eigenvector with the largest overlap with $\\lvert e_1 \\rangle$.\n- **Exact Strength Distribution**: $S(\\omega) = \\sum_{n=1}^{N} \\left| \\langle n \\lvert O \\rvert i \\rangle \\right|^2 \\, \\delta\\!\\left(\\omega - (E_n - E_i)\\right)$, where $\\{ \\lvert n \\rangle, E_n \\}$ are eigenpairs of $H$.\n- **Lanczos Strength-Function Approximation**:\n    - Starting vector: $\\lvert \\phi_0 \\rangle = O \\lvert i \\rangle / \\| O \\lvert i \\rangle \\|$.\n    - Algorithm: $m$-step Lanczos tridiagonalization of $H$ in the Krylov subspace starting with $\\lvert \\phi_0 \\rangle$, yielding a tridiagonal matrix $T_m$.\n    - Approximate Strengths and Energies: $\\tilde{S}(\\omega) = \\sum_{k=1}^{m'} w_k \\, \\delta\\!\\left(\\omega - (\\theta_k - E_i)\\right)$, with weights $w_k = \\| O \\lvert i \\rangle \\|^2 \\, \\left| \\langle e_1 \\vert y_k \\rangle \\right|^2$, where $\\{ \\theta_k, \\lvert y_k \\rangle \\}$ are eigenpairs of $T_{m'}$ and $m' \\le m$ is the numerical rank.\n- **Smeared Strength Functions**: Both $S(\\omega)$ and $\\tilde{S}(\\omega)$ are convoluted with a Gaussian $g_\\sigma(x) = \\frac{1}{\\sigma \\sqrt{2\\pi}} \\exp\\!\\left(-\\frac{x^2}{2\\sigma^2}\\right)$ with $\\sigma = 0.15$.\n- **Sum Rule**: The zeroth moment (non-energy-weighted) is $\\int S(\\omega)\\, d\\omega = \\langle i \\lvert O^2 \\rvert i \\rangle$. The Lanczos approximation should conserve this: $\\sum_k w_k \\approx \\langle i \\lvert O^2 \\rvert i \\rangle$.\n- **Numerical Parameters**: Grid spacing $\\Delta \\omega = 0.01$. Grid range must cover all exact and approximate transition energies, extended by $\\pm 0.5$.\n- **Diagnostics**:\n    - Relative $\\ell_1$ error $\\varepsilon_{\\mathrm{L1}}$ between smeared distributions.\n    - Relative error $\\varepsilon_{0}$ in the zeroth-moment sum rule.\n- **Convergence Criterion**: $\\text{converged} = (\\varepsilon_{\\mathrm{L1}} \\le \\tau)$ with $\\tau = 0.05$.\n- **Test Cases**: Four specific cases are provided with explicit $6 \\times 6$ matrices for $H$ and $O$, values for $m$, and definitions for $\\lvert i \\rangle$.\n\n**Step 2: Validate Using Extracted Givens**\n- **Scientifically Grounded**: The problem is rooted in fundamental principles of quantum mechanics (calculation of transition probabilities) and numerical linear algebra (Krylov subspace methods, specifically the Lanczos algorithm). All definitions and formulas are standard in theoretical and computational physics. The problem is scientifically sound.\n- **Well-Posed**: The problem is fully specified. All matrices, parameters ($m$, $\\sigma$, $\\Delta\\omega$, $\\tau$), and initial conditions are provided. The procedures for determining the initial state (including degeneracy resolution) and for handling edge cases (like $O \\lvert i \\rangle = 0$) are explicit. The requested outputs are unambiguously defined. A unique, deterministic solution exists for each test case.\n- **Objective**: The problem is stated in precise, formal mathematical and algorithmic language, free from subjectivity or ambiguity.\n\nThe problem statement passes all validation criteria. It is a well-defined computational physics problem with no scientific, logical, or structural flaws.\n\n**Step 3: Verdict and Action**\nThe problem is **valid**. A solution will be provided.\n\n### Principle-Based Solution Design\nThe solution involves implementing a computational workflow that calculates and compares the exact and Lanczos-approximated transition strength functions. The core steps of the algorithm for each test case are as follows:\n\n1.  **Preparation**: The Hamiltonian $H$, operator $O$, number of Lanczos iterations $m$, and the rule for determining the initial state $\\lvert i \\rangle$ are defined for the specific test case.\n\n2.  **Initial State Determination**: The initial state $\\lvert i \\rangle$ and its corresponding energy $E_i$ are determined. If specified as the ground state, this requires the complete diagonalization of the Hamiltonian $H$ using a standard numerical eigensolver (e.g., `numpy.linalg.eigh`). The smallest eigenvalue is identified. If this eigenvalue is degenerate, the provided tie-breaking rule (maximum overlap with the canonical basis vector $\\lvert e_1 \\rangle$) is applied to select a single, unique initial state vector $\\lvert i \\rangle$.\n\n3.  **Exact Strength Calculation**: With all eigenpairs $\\{E_n, \\lvert n \\rangle\\}$ of $H$ available from the previous step, the exact discrete transition spectrum is computed. The transition energies are $\\Delta E_n = E_n - E_i$, and the corresponding strengths are $S_n = |\\langle n \\lvert O \\rvert i \\rangle|^2$. The zeroth-moment sum rule, $\\sum_n S_n$, is also calculated as a benchmark, which is equivalent to $\\langle i \\lvert O^2 \\rvert i \\rangle$.\n\n4.  **Lanczos Algorithm**: The Lanczos tridiagonalization of $H$ is performed.\n    a. The process starts with the vector $\\lvert \\phi_0 \\rangle = O \\lvert i \\rangle$, which is normalized. If $O \\lvert i \\rangle$ is the zero vector, the strength function is trivially zero, and the calculation of diagnostics is straightforward.\n    b. A three-term recurrence relation, $H \\lvert q_j \\rangle = \\beta_{j-1} \\lvert q_{j-1} \\rangle + \\alpha_j \\lvert q_j \\rangle + \\beta_j \\lvert q_{j+1} \\rangle$, is used iteratively for $m$ steps to generate an orthonormal basis $\\{\\lvert q_j \\rangle\\}$ for the Krylov subspace and the entries of the real symmetric tridiagonal matrix $T_m$ (with diagonals $\\alpha_j$ and off-diagonals $\\beta_j$). The process may terminate early if a $\\beta_j$ becomes numerically zero, indicating that an invariant subspace has been found. The final size of the tridiagonal matrix is $m' \\times m'$.\n\n5.  **Approximate Strength Calculation**: The tridiagonal matrix $T_{m'}$ is diagonalized to obtain its eigenpairs, the Ritz energies $\\{\\theta_k\\}$ and Ritz vectors $\\{\\lvert y_k \\rangle\\}$. An efficient eigensolver for tridiagonal matrices (`scipy.linalg.eigh_tridiagonal`) is used. The approximate transition strengths (weights) are then computed using the formula $w_k = \\| O \\lvert i \\rangle \\|^2 \\, |\\langle e_1 \\lvert y_k \\rangle|^2$, where $\\langle e_1 \\lvert y_k \\rangle$ is simply the first component of the eigenvector $\\lvert y_k \\rangle$.\n\n6.  **Smeared Function Evaluation**: To compare the continuous distributions, a uniform energy grid $\\{\\omega_j\\}$ is constructed. Its range is determined by the minimum and maximum of both the exact and approximate transition energies, with a buffer of $0.5$ on each side, as specified. The discrete exact strengths $\\{S_n\\}$ and approximate strengths $\\{w_k\\}$ are then \"smeared\" by convolving them with a Gaussian function of width $\\sigma=0.15$. This yields the continuous functions $S_\\sigma(\\omega_j)$ and $\\tilde{S}_\\sigma(\\omega_j)$ evaluated on the grid.\n\n7.  **Diagnostic Computation**: The two required scalar diagnostics are calculated:\n    - $\\varepsilon_{\\mathrm{L1}}$: The relative $\\ell_1$ norm of the difference between the smeared functions $S_\\sigma$ and $\\tilde{S}_\\sigma$ on the grid.\n    - $\\varepsilon_{0}$: The relative error between the exact sum rule $\\sum_n S_n$ and the approximated sum rule $\\sum_k w_k$.\n    Finally, the boolean convergence flag is set based on whether $\\varepsilon_{\\mathrm{L1}}$ is below the threshold $\\tau=0.05$.\n\nThis sequence of steps is encapsulated in a program that iterates through the four provided test cases, calculates the three-element list $[\\varepsilon_{\\mathrm{L1}}, \\varepsilon_{0}, \\text{converged}]$ for each, and formats the final output as specified.", "answer": "```python\nimport numpy as np\nfrom scipy.linalg import eigh_tridiagonal\n\ndef solve():\n    \"\"\"\n    Main function to define test cases and generate the final output.\n    \"\"\"\n\n    # Test Case 1 & 2\n    H1 = np.zeros((6, 6))\n    H1.flat[::7] = [-3.0, -1.5, 0.5, 1.8, 3.0, 4.5]\n    H1[0, 1] = H1[1, 0] = 0.2\n    H1[1, 2] = H1[2, 1] = 0.3\n    H1[2, 3] = H1[3, 2] = 0.4\n    H1[3, 4] = H1[4, 3] = 0.5\n    H1[4, 5] = H1[5, 4] = 0.6\n\n    O1 = np.zeros((6, 6))\n    O1[0, 1] = O1[1, 0] = 0.5\n    O1[0, 2] = O1[2, 0] = 0.1\n    O1[1, 2] = O1[2, 1] = 0.4\n    O1[1, 3] = O1[3, 1] = 0.2\n    O1[2, 3] = O1[3, 2] = 0.3\n    O1[2, 4] = O1[4, 2] = 0.2\n    O1[3, 4] = O1[4, 3] = 0.4\n    O1[3, 5] = O1[5, 3] = 0.1\n    O1[4, 5] = O1[5, 4] = 0.5\n\n    # Test Case 3\n    O0 = np.zeros((6, 6))\n\n    # Test Case 4\n    H2 = np.diag([0.0, 0.0, 1.0, 1.5, 2.5, 2.5])\n    O2 = np.zeros((6, 6))\n    O2[0, 1] = O2[1, 0] = 0.3\n    O2[0, 2] = O2[2, 0] = 0.2\n    O2[0, 4] = O2[4, 0] = 0.1\n    O2[1, 3] = O2[3, 1] = 0.2\n    O2[1, 5] = O2[5, 1] = 0.1\n    O2[2, 3] = O2[3, 2] = 0.3\n    O2[3, 4] = O2[4, 3] = 0.4\n    O2[4, 5] = O2[5, 4] = 0.2\n\n    initial_state_e1 = np.zeros(6)\n    initial_state_e1[0] = 1.0\n\n    test_cases = [\n        {'H': H1, 'O': O1, 'm': 4, 'initial_state_def': 'ground_state'},\n        {'H': H1, 'O': O1, 'm': 1, 'initial_state_def': 'ground_state'},\n        {'H': H1, 'O': O0, 'm': 4, 'initial_state_def': 'ground_state'},\n        {'H': H2, 'O': O2, 'm': 4, 'initial_state_def': initial_state_e1}\n    ]\n    \n    results = []\n    for case in test_cases:\n        result = compute_strength_function_diagnostics(**case)\n        results.append(result)\n\n    output_parts = []\n    for res in results:\n        # Format boolean as True/False literal without quotes\n        part = f\"[{res[0]},{res[1]},{str(res[2])}]\"\n        output_parts.append(part)\n    final_output = f\"[{','.join(output_parts)}]\"\n    print(final_output)\n\ndef get_initial_state(H, initial_state_def):\n    \"\"\"\n    Determines the initial state vector |i> and its energy E_i.\n    \"\"\"\n    if isinstance(initial_state_def, np.ndarray):\n        i_state = initial_state_def\n        i_energy = i_state.T @ H @ i_state\n        return i_state, i_energy\n\n    if initial_state_def == 'ground_state':\n        eigenvalues, eigenvectors = np.linalg.eigh(H)\n        min_eigenvalue = eigenvalues[0]\n        \n        # Find indices of degenerate ground states\n        gs_indices = np.where(np.isclose(eigenvalues, min_eigenvalue))[0]\n        \n        if len(gs_indices) == 1:\n            i_state = eigenvectors[:, gs_indices[0]]\n        else:\n            # Tie-breaking rule: max overlap with e1\n            gs_candidates = eigenvectors[:, gs_indices]\n            best_idx_in_subspace = np.argmax(np.abs(gs_candidates[0, :]))\n            i_state = gs_candidates[:, best_idx_in_subspace]\n            \n        i_energy = min_eigenvalue\n        return i_state, i_energy\n    \n    raise ValueError(\"Invalid initial_state_def\")\n\ndef compute_strength_function_diagnostics(H, O, m, initial_state_def):\n    \"\"\"\n    Computes diagnostics for a single test case.\n    \"\"\"\n    N = H.shape[0]\n    sigma = 0.15\n    delta_omega = 0.01\n    conv_tau = 0.05\n    \n    # Step 1: Determine initial state and energy\n    i_state, i_energy = get_initial_state(H, initial_state_def)\n    \n    # Step 2: Calculate starting vector for Lanczos\n    phi0_unnorm = O @ i_state\n    norm_phi0_unnorm = np.linalg.norm(phi0_unnorm)\n\n    # Step 3: Handle the zero strength case\n    if norm_phi0_unnorm < 1e-15:\n        return [0.0, 0.0, True]\n\n    # Step 4: Lanczos Algorithm\n    phi0 = phi0_unnorm / norm_phi0_unnorm\n    V = np.zeros((N, m + 1))\n    alphas = np.zeros(m)\n    betas = np.zeros(m - 1)\n    V[:, 0] = phi0\n    \n    w_prime = H @ V[:, 0]\n    alpha = np.dot(V[:, 0], w_prime)\n    alphas[0] = alpha\n    w = w_prime - alpha * V[:, 0]\n    \n    m_prime = m\n    for j in range(1, m):\n        beta = np.linalg.norm(w)\n        if beta < 1e-15:\n            m_prime = j\n            break\n\n        V[:, j] = w / beta\n        betas[j - 1] = beta\n\n        w_prime = H @ V[:, j]\n        alpha = np.dot(V[:, j], w_prime)\n        alphas[j] = alpha\n        \n        w = w_prime - alpha * V[:, j] - beta * V[:, j - 1]\n\n    # Step 5: Get approximate spectrum (Ritz values)\n    eff_alphas = alphas[:m_prime]\n    eff_betas = betas[:m_prime - 1]\n    ritz_energies, ritz_vectors = eigh_tridiagonal(eff_alphas, eff_betas)\n    \n    approx_weights = norm_phi0_unnorm**2 * ritz_vectors[0, :]**2\n    approx_sum_rule = np.sum(approx_weights)\n    approx_trans_energies = ritz_energies - i_energy\n    \n    # Step 6: Get exact spectrum\n    exact_energies, exact_vectors = np.linalg.eigh(H)\n    exact_trans_energies = exact_energies - i_energy\n    exact_strengths = (exact_vectors.T @ phi0_unnorm)**2\n    exact_sum_rule = np.sum(exact_strengths)\n    \n    # Step 7: Smeared functions on a grid\n    all_trans_energies = np.concatenate((exact_trans_energies, approx_trans_energies))\n    omega_min = np.min(all_trans_energies) - 0.5\n    omega_max = np.max(all_trans_energies) + 0.5\n    omega_grid = np.arange(omega_min, omega_max, delta_omega)\n\n    def gaussian(x, s):\n        return np.exp(-x**2 / (2 * s**2)) / (s * np.sqrt(2 * np.pi))\n\n    # Vectorized calculation of smeared functions\n    s_exact_smeared = np.sum(\n        gaussian(omega_grid[:, np.newaxis] - exact_trans_energies, sigma) * exact_strengths, axis=1\n    )\n    s_approx_smeared = np.sum(\n        gaussian(omega_grid[:, np.newaxis] - approx_trans_energies, sigma) * approx_weights, axis=1\n    )\n    \n    # Step 8: Calculate diagnostics\n    # epsilon_L1\n    l1_numerator = np.sum(np.abs(s_approx_smeared - s_exact_smeared))\n    l1_denominator = np.sum(s_exact_smeared)\n    epsilon_l1 = l1_numerator / l1_denominator if l1_denominator > 1e-15 else 0.0\n\n    # epsilon_0\n    sum_rule_numerator = np.abs(approx_sum_rule - exact_sum_rule)\n    sum_rule_denominator = exact_sum_rule\n    epsilon_0 = sum_rule_numerator / sum_rule_denominator if sum_rule_denominator > 1e-15 else 0.0\n    \n    # Convergence flag\n    converged = (epsilon_l1 <= conv_tau)\n\n    return [epsilon_l1, epsilon_0, converged]\n\nsolve()\n```", "id": "3545977"}]}