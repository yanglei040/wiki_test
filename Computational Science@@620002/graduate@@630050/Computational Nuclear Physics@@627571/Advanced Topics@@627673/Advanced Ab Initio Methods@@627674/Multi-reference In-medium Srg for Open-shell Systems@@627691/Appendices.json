{"hands_on_practices": [{"introduction": "Before delving into a sophisticated method, it is essential to understand the problem it aims to solve. This first practice uses a simple, exactly solvable shell model to demonstrate how interactions can lead to strong mixing between configurations, rendering a single-determinant description inadequate [@problem_id:3571469]. By calculating the \"leading-configuration weight,\" you will develop a quantitative feel for when a single-reference picture breaks down, thereby establishing the clear motivation for multi-reference formalisms like the MR-IMSRG.", "problem": "Consider a schematic two-level shell-model for an open-shell nucleus with two valence nucleons, designed to probe the suitability of a single Slater determinant reference in the context of multi-reference in-medium Similarity Renormalization Group (MR-IMSRG). The model space consists of two single-particle orbitals, labeled $a$ and $b$, with single-particle energies $\\varepsilon_a$ and $\\varepsilon_b$, respectively. Each orbital supports a paired, seniority-zero configuration in which both valence nucleons occupy the same orbital. Let the seniority-zero basis be $\\{\\lvert aa \\rangle, \\lvert bb \\rangle\\}$, where $\\lvert aa \\rangle$ denotes both valence nucleons occupying orbital $a$, and similarly for $\\lvert bb \\rangle$.\n\nStart from the second-quantized Hamiltonian\n$$\n\\hat{H} = \\sum_{i} \\varepsilon_i \\hat{n}_i + \\frac{1}{4} \\sum_{ij,kl} \\bar{v}_{ij,kl}\\, a_i^\\dagger a_j^\\dagger a_l a_k,\n$$\nwhere $\\varepsilon_i$ are single-particle energies, $\\hat{n}_i$ are number operators, and $\\bar{v}_{ij,kl}$ are antisymmetrized two-body matrix elements. In the reduced seniority-zero subspace spanned by $\\{\\lvert aa \\rangle, \\lvert bb \\rangle\\}$, assume a schematic interaction that couples these two paired configurations with a real mixing parameter $V$ and neglects additional diagonal correlation shifts (a constant energy shift common to both basis states does not affect configuration weights). Under these assumptions, the Hamiltonian in this subspace is a real, symmetric $2\\times 2$ matrix determined by $\\varepsilon_a$, $\\varepsilon_b$, and $V$.\n\nLet the \"single Slater determinant reference\" be defined as the noninteracting ground configuration: the paired configuration that minimizes the one-body energy, i.e., $\\lvert \\text{ref} \\rangle = \\lvert aa \\rangle$ if $\\varepsilon_a \\le \\varepsilon_b$ and $\\lvert \\text{ref} \\rangle = \\lvert bb \\rangle$ otherwise. Denote the exact normalized ground state of the $2\\times 2$ Hamiltonian by $\\lvert \\Psi_0 \\rangle$. The quantity that measures the failure of a single Slater determinant reference in this schematic model is the leading-configuration weight\n$$\nw_{\\text{ref}} = \\left| \\langle \\text{ref} \\lvert \\Psi_0 \\rangle \\right|^2.\n$$\nA value $w_{\\text{ref}} \\approx 1$ indicates that a single-reference description is adequate, while $w_{\\text{ref}} \\ll 1$ signals strong multi-configurational character and motivates a multi-reference treatment such as MR-IMSRG.\n\nTask: For each parameter set $(\\varepsilon_a, \\varepsilon_b, V)$ provided in the test suite below, construct the associated $2\\times 2$ seniority-zero Hamiltonian, perform an exact diagonalization to obtain $\\lvert \\Psi_0 \\rangle$, identify the appropriate $\\lvert \\text{ref} \\rangle$ based on $(\\varepsilon_a, \\varepsilon_b)$, and compute $w_{\\text{ref}}$.\n\nYou must produce the results for the following test suite:\n- Test $1$: $(\\varepsilon_a, \\varepsilon_b, V) = (0.0, 1.0, 0.3)$.\n- Test $2$: $(\\varepsilon_a, \\varepsilon_b, V) = (0.0, 0.2, 0.15)$.\n- Test $3$: $(\\varepsilon_a, \\varepsilon_b, V) = (0.0, 0.0, 0.5)$.\n- Test $4$: $(\\varepsilon_a, \\varepsilon_b, V) = (0.0, 0.5, 0.0)$.\n- Edge Test $5$: $(\\varepsilon_a, \\varepsilon_b, V) = (0.0, 0.01, 0.05)$.\n\nAll quantities are dimensionless in this schematic model, so no physical units are required.\n\nYour program should output a single line containing the list of $w_{\\text{ref}}$ values for the test suite, each rounded to six decimal places, aggregated as a comma-separated list enclosed in square brackets. For example, the required output format is $[\\text{result}_1,\\text{result}_2,\\ldots,\\text{result}_5]$, where each $\\text{result}_k$ is a float rounded to six decimal places.", "solution": "The problem is assessed to be valid. It is scientifically grounded in the principles of quantum mechanics and nuclear shell model theory, well-posed with a unique and meaningful solution, objective, and self-contained. The provided parameters and definitions are sufficient and consistent for constructing and solving the problem.\n\nThe task is to compute the leading-configuration weight $w_{\\text{ref}}$ for a schematic two-level system describing two valence nucleons. This involves constructing and diagonalizing a $2\\times 2$ Hamiltonian matrix for several sets of parameters.\n\n### Step 1: Constructing the Hamiltonian Matrix\n\nThe model space is spanned by two seniority-zero basis states, $\\lvert aa \\rangle$ and $\\lvert bb \\rangle$, where both nucleons occupy orbital $a$ or orbital $b$, respectively. We can represent these orthonormal basis states by the standard basis vectors in $\\mathbb{R}^2$:\n$$\n\\lvert aa \\rangle \\rightarrow \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}, \\quad \\lvert bb \\rangle \\rightarrow \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}\n$$\nThe Hamiltonian $\\hat{H}$ in this basis is a $2\\times 2$ matrix $\\mathbf{H}$ with elements $H_{ij} = \\langle \\phi_i \\vert \\hat{H} \\vert \\phi_j \\rangle$ for $i,j \\in \\{a, b\\}$.\n\nThe diagonal elements represent the energies of the pure configurations. The one-body part of the Hamiltonian, $\\sum_k \\varepsilon_k \\hat{n}_k$, contributes to these energies. For the state $\\lvert aa \\rangle$, two nucleons are in orbital $a$, so its one-body energy is $2\\varepsilon_a$. For $\\lvert bb \\rangle$, the energy is $2\\varepsilon_b$. The problem states that we can neglect any additional diagonal shifts from the two-body interaction, which are assumed to be zero or contribute a constant shift to both states. Since a global energy shift does not affect the eigenvectors, we can write the diagonal matrix elements as:\n$$\nH_{11} = \\langle aa \\vert \\hat{H} \\vert aa \\rangle = 2\\varepsilon_a\n$$\n$$\nH_{22} = \\langle bb \\vert \\hat{H} \\vert bb \\rangle = 2\\varepsilon_b\n$$\nThe off-diagonal elements, $H_{12} = \\langle aa \\vert \\hat{H} \\vert bb \\rangle$, represent the mixing between the two configurations due to the two-body interaction. The problem specifies this mixing with a single real parameter $V$. Since the Hamiltonian is Hermitian (and real-symmetric in this case), we have $H_{12} = H_{21} = V$.\n\nThus, the Hamiltonian matrix in the basis $(\\lvert aa \\rangle, \\lvert bb \\rangle)$ is:\n$$\n\\mathbf{H} = \\begin{pmatrix} 2\\varepsilon_a  V \\\\ V  2\\varepsilon_b \\end{pmatrix}\n$$\n\n### Step 2: Diagonalization of the Hamiltonian\n\nTo find the exact ground state $\\lvert \\Psi_0 \\rangle$, we must find the eigenvector corresponding to the lowest eigenvalue of $\\mathbf{H}$. The eigenvalues $E$ are the roots of the characteristic equation $\\det(\\mathbf{H} - E\\mathbf{I}) = 0$:\n$$\n(2\\varepsilon_a - E)(2\\varepsilon_b - E) - V^2 = 0\n$$\nThe ground state energy $E_0$ is the lower of the two eigenvalues.\nThe corresponding normalized eigenvector $\\lvert \\Psi_0 \\rangle$ can be written as a linear combination of the basis states:\n$$\n\\lvert \\Psi_0 \\rangle = c_a \\lvert aa \\rangle + c_b \\lvert bb \\rangle, \\quad \\text{with } |c_a|^2 + |c_b|^2 = 1\n$$\nIn our matrix representation, this eigenvector is $\\begin{pmatrix} c_a \\\\ c_b \\end{pmatrix}$. This vector can be found efficiently using standard numerical linear algebra routines, such as those available in `numpy`. These routines typically return the eigenvalues and a matrix whose columns are the corresponding normalized eigenvectors. We select the eigenvector column that corresponds to the minimum eigenvalue.\n\n### Step 3: Identification of the Reference State\n\nThe single Slater determinant reference state, $\\lvert \\text{ref} \\rangle$, is defined as the non-interacting ground configuration, i.e., the basis state with the lower one-body energy.\n- If $\\varepsilon_a \\le \\varepsilon_b$, the state $\\lvert aa \\rangle$ has lower or equal energy ($2\\varepsilon_a \\le 2\\varepsilon_b$). Therefore, $\\lvert \\text{ref} \\rangle = \\lvert aa \\rangle$.\n- If $\\varepsilon_a  \\varepsilon_b$, the state $\\lvert bb \\rangle$ has lower energy. Therefore, $\\lvert \\text{ref} \\rangle = \\lvert bb \\rangle$.\n\n### Step 4: Calculation of the Leading-Configuration Weight\n\nThe leading-configuration weight, $w_{\\text{ref}}$, measures the overlap squared between the exact ground state $\\lvert \\Psi_0 \\rangle$ and the reference state $\\lvert \\text{ref} \\rangle$:\n$$\nw_{\\text{ref}} = \\left| \\langle \\text{ref} \\lvert \\Psi_0 \\rangle \\right|^2\n$$\nUsing the coefficient expansion of $\\lvert \\Psi_0 \\rangle$:\n- If $\\lvert \\text{ref} \\rangle = \\lvert aa \\rangle$, then $\\langle \\text{ref} \\lvert \\Psi_0 \\rangle = \\langle aa \\vert (c_a \\lvert aa \\rangle + c_b \\lvert bb \\rangle) = c_a$. The weight is $w_{\\text{ref}} = |c_a|^2 = c_a^2$, as the coefficients can be chosen to be real.\n- If $\\lvert \\text{ref} \\rangle = \\lvert bb \\rangle$, then $\\langle \\text{ref} \\lvert \\Psi_0 \\rangle = \\langle bb \\vert (c_a \\lvert aa \\rangle + c_b \\lvert bb \\rangle) = c_b$. The weight is $w_{\\text{ref}} = |c_b|^2 = c_b^2$.\n\nThe procedure for each given set of parameters $(\\varepsilon_a, \\varepsilon_b, V)$ is as follows:\n1.  Construct the matrix $\\mathbf{H} = \\begin{pmatrix} 2\\varepsilon_a  V \\\\ V  2\\varepsilon_b \\end{pmatrix}$.\n2.  Numerically diagonalize $\\mathbf{H}$ to find its eigenvalues and eigenvectors.\n3.  Identify the eigenvector $\\begin{pmatrix} c_a \\\\ c_b \\end{pmatrix}$ corresponding to the lowest eigenvalue.\n4.  Determine the reference state based on the comparison of $\\varepsilon_a$ and $\\varepsilon_b$.\n5.  If $\\varepsilon_a \\le \\varepsilon_b$, calculate $w_{\\text{ref}} = c_a^2$.\n6.  If $\\varepsilon_a  \\varepsilon_b$, calculate $w_{\\text{ref}} = c_b^2$.\nThis procedure is applied to all test cases to generate the final list of results.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the schematic two-level shell model problem for a given test suite.\n\n    For each parameter set (eps_a, eps_b, V), this function:\n    1. Constructs the 2x2 Hamiltonian matrix.\n    2. Diagonalizes the Hamiltonian to find the ground state eigenvector.\n    3. Identifies the appropriate single Slater determinant reference state.\n    4. Computes the leading-configuration weight w_ref.\n    \"\"\"\n\n    # Test suite from the problem statement.\n    # Each tuple is in the format (eps_a, eps_b, V).\n    test_cases = [\n        (0.0, 1.0, 0.3),   # Test 1\n        (0.0, 0.2, 0.15),  # Test 2\n        (0.0, 0.0, 0.5),   # Test 3\n        (0.0, 0.5, 0.0),   # Test 4\n        (0.0, 0.01, 0.05)  # Edge Test 5\n    ]\n\n    results = []\n    for eps_a, eps_b, V in test_cases:\n        # Step 1: Construct the 2x2 Hamiltonian matrix H.\n        # The basis is {|aa, |bb}.\n        # H_11 = 2*eps_a, H_22 = 2*eps_b, H_12 = H_21 = V.\n        hamiltonian = np.array([\n            [2 * eps_a, V],\n            [V, 2 * eps_b]\n        ], dtype=float)\n\n        # Step 2: Diagonalize the Hamiltonian.\n        # numpy.linalg.eigh is suitable for Hermitian matrices. It returns\n        # eigenvalues sorted in ascending order and corresponding eigenvectors\n        # as columns of a matrix.\n        eigenvalues, eigenvectors = np.linalg.eigh(hamiltonian)\n\n        # The ground state is the eigenvector corresponding to the lowest eigenvalue.\n        # This is the first column of the eigenvectors matrix.\n        ground_state_vector = eigenvectors[:, 0]\n        c_a, c_b = ground_state_vector[0], ground_state_vector[1]\n\n        # Step 3: Identify the reference state |ref.\n        # |ref is |aa if eps_a = eps_b, otherwise |ref is |bb.\n        # The basis state |aa corresponds to index 0.\n        # The basis state |bb corresponds to index 1.\n        if eps_a = eps_b:\n            ref_index = 0  # Reference state is |aa\n        else:\n            ref_index = 1  # Reference state is |bb\n\n        # Step 4: Compute the leading-configuration weight w_ref.\n        # w_ref = |ref|Psi_0|^2.\n        # If ref is |aa (index 0), weight is c_a^2.\n        # If ref is |bb (index 1), weight is c_b^2.\n        w_ref = ground_state_vector[ref_index]**2\n        \n        results.append(w_ref)\n\n    # Format the final output as a comma-separated list of strings,\n    # with each result rounded to six decimal places, enclosed in brackets.\n    output_str = f\"[{','.join([f'{r:.6f}' for r in results])}]\"\n    print(output_str)\n\n# Execute the main function.\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3571469"}, {"introduction": "Having established the need for a multi-reference approach, this practice shifts focus to the mathematical tools used to describe these complex, correlated states. This exercise provides a direct, hands-on calculation of the effective zero- and one-body parts of a Hamiltonian based on a correlated reference state defined by its one-body density matrix, $\\gamma$, and two-body cumulant, $\\lambda$ [@problem_id:3571488]. Mastering this generalized normal-ordering is a foundational skill for understanding the structure of the MR-IMSRG equations and how they differ from their simpler single-reference counterparts.", "problem": "Consider a two-body Hamiltonian in second quantization,\n$$\\hat{V} \\equiv \\frac{1}{4} \\sum_{p q r s} v_{p q, r s}\\, a_{p}^{\\dagger} a_{q}^{\\dagger} a_{s} a_{r},$$\nwith real antisymmetrized two-body matrix elements $v_{p q, r s}$ that satisfy $v_{p q, r s} = - v_{q p, r s} = - v_{p q, s r} = v_{q p, s r}$ and $v_{p q, r s} = v_{r s, p q}$. Work in a model space of three orthonormal single-particle orbitals labeled $1,2,3$, and assume the only nonzero two-body matrix elements (in energy units of mega-electron-volts, MeV) are\n$$v_{12,12} = 2.0,\\quad v_{13,13} = 0.8,\\quad v_{23,23} = 1.6,$$\nwith all other $v_{p q, r s}$ equal to zero (the stated antisymmetries are implied). Let the reference for generalized normal ordering be a correlated state suitable for an open-shell system in the Multi-Reference In-Medium Similarity Renormalization Group (IMSRG), characterized by the one-body reduced density matrix $\\gamma_{i j} \\equiv \\langle a_{j}^{\\dagger} a_{i} \\rangle$ and the two-body cumulant $\\lambda_{i j, k l}$, where the two-body reduced density matrix $\\Gamma^{(2)}$ decomposes as $\\Gamma^{(2)}_{i j, k l} = \\gamma_{i k}\\gamma_{j l} - \\gamma_{i l}\\gamma_{j k} + \\lambda_{i j, k l}$. Take the nonzero elements of the reference densities to be\n$$\\gamma_{11} = 1.0,\\quad \\gamma_{22} = 0.6,\\quad \\gamma_{33} = 0.4,$$\nand\n$$\\lambda_{12,12} = -0.02,\\quad \\lambda_{13,13} = +0.02,\\quad \\lambda_{23,23} = +0.02,$$\nwith all other $\\gamma_{i j}$ and $\\lambda_{i j, k l}$ equal to zero, and with the usual antisymmetry and Hermiticity properties understood. For comparison to single-reference normal ordering, use the Slater-determinant reference with orbitals $1$ and $2$ occupied and orbital $3$ empty, for which $\\gamma^{\\mathrm{SR}}_{11} = \\gamma^{\\mathrm{SR}}_{22} = 1$, $\\gamma^{\\mathrm{SR}}_{33} = 0$, off-diagonal $\\gamma^{\\mathrm{SR}}_{i j} = 0$ when $i \\neq j$, and $\\lambda^{\\mathrm{SR}}_{i j, k l} = 0$.\n\nStarting from the fundamental second-quantized definitions of normal ordering relative to a general correlated reference and the generalized Wick theorem, derive the multi-reference normal-ordered zero-body energy $E^{(0)}_{\\mathrm{MR}}$ and one-body operator coefficients $f^{p}_{q,\\mathrm{MR}}$ of $\\hat{V}$ in terms of $v_{p q, r s}$, $\\gamma$, and $\\lambda$, and identify the normal-ordered two-body part. Evaluate the multi-reference zero-, one-, and two-body parts numerically for the data given above. Then, perform the analogous single-reference normal ordering with the stated Slater determinant and compute the single-reference zero-body energy $E^{(0)}_{\\mathrm{SR}}$. Finally, report the difference\n$$\\Delta E \\equiv E^{(0)}_{\\mathrm{MR}} - E^{(0)}_{\\mathrm{SR}}.$$\nExpress the final result for $\\Delta E$ in MeV and round your answer to four significant figures.", "solution": "The solution requires the decomposition of the two-body Hamiltonian $\\hat{V}$ into its normal-ordered components with respect to a general correlated reference state $|\\Psi\\rangle$. This decomposition is the foundation of the In-Medium Similarity Renormalization Group (IM-SRG) and is defined by the Generalized Wick Theorem. The operator is expressed as a sum of its expectation value (zero-body part), a one-body normal-ordered part, and a two-body normal-ordered part. For the given two-body operator $\\hat{V}$, the decomposition up to the two-body level is:\n$$ \\hat{V} = E^{(0)} + \\sum_{p q} f^{p}_{q} :a_{p}^{\\dagger} a_{q}: + \\frac{1}{4} \\sum_{p q r s} v_{pq,rs}^{(\\text{NO})} :a_{p}^{\\dagger} a_{q}^{\\dagger} a_{s} a_{r}: $$\nwhere $:\\dots:$ denotes normal ordering with respect to $|\\Psi\\rangle$.\n\n### 1. Zero-Body Part (Energy)\n\nThe zero-body part, $E^{(0)}$, is the expectation value of the operator in the reference state:\n$$ E^{(0)} = \\langle \\hat{V} \\rangle = \\frac{1}{4} \\sum_{p q r s} v_{p q, r s} \\langle a_{p}^{\\dagger} a_{q}^{\\dagger} a_{s} a_{r} \\rangle $$\nThe expectation value $\\langle a_{p}^{\\dagger} a_{q}^{\\dagger} a_{s} a_{r} \\rangle$ is the two-body reduced density matrix (2-RDM), $\\Gamma^{(2)}_{pq,rs}$. Using the provided decomposition in terms of the one-body RDM ($\\gamma$) and the two-body cumulant ($\\lambda$):\n$$ \\Gamma^{(2)}_{pq,rs} = \\gamma_{pr}\\gamma_{qs} - \\gamma_{ps}\\gamma_{qr} + \\lambda_{pq,rs} $$\nThe zero-body energy is therefore:\n$$ E^{(0)} = \\frac{1}{4} \\sum_{p q r s} v_{p q, r s} (\\gamma_{pr}\\gamma_{qs} - \\gamma_{ps}\\gamma_{qr} + \\lambda_{pq,rs}) $$\n\n### 2. Numerical Evaluation of Energies\n\nThe interaction $v_{pq,rs}$ and the density matrices are block-diagonal in the given basis. This simplifies the summation. With antisymmetrized matrix elements, the energy expression for a diagonal interaction simplifies to a sum over unique pairs:\n$$ E^{(0)} = \\sum_{pq} v_{pq,pq} \\Gamma^{(2)}_{pq,pq} $$\n**For the Multi-Reference (MR) case:**\nThe 1-RDM $\\gamma$ is diagonal, so $\\gamma_{pr}\\gamma_{qs} - \\gamma_{ps}\\gamma_{qr}$ simplifies to $\\gamma_{pp}\\gamma_{qq}$ for the relevant terms.\n$$ \\Gamma^{(2)}_{12,12} = \\gamma_{11}\\gamma_{22} + \\lambda_{12,12} = (1.0)(0.6) + (-0.02) = 0.58 $$\n$$ \\Gamma^{(2)}_{13,13} = \\gamma_{11}\\gamma_{33} + \\lambda_{13,13} = (1.0)(0.4) + (0.02) = 0.42 $$\n$$ \\Gamma^{(2)}_{23,23} = \\gamma_{22}\\gamma_{33} + \\lambda_{23,23} = (0.6)(0.4) + (0.02) = 0.24 + 0.02 = 0.26 $$\nThe MR zero-body energy is:\n$$ E^{(0)}_{\\mathrm{MR}} = v_{12,12}\\Gamma^{(2)}_{12,12} + v_{13,13}\\Gamma^{(2)}_{13,13} + v_{23,23}\\Gamma^{(2)}_{23,23} $$\n$$ E^{(0)}_{\\mathrm{MR}} = (2.0)(0.58) + (0.8)(0.42) + (1.6)(0.26) = 1.16 + 0.336 + 0.416 = 1.912 \\, \\text{MeV} $$\n**For the Single-Reference (SR) case:**\nThe reference is a Slater determinant, so the cumulant $\\lambda^{\\mathrm{SR}}$ is zero. The densities are $\\gamma^{\\mathrm{SR}}_{11} = 1$, $\\gamma^{\\mathrm{SR}}_{22} = 1$, $\\gamma^{\\mathrm{SR}}_{33} = 0$.\n$$ \\Gamma^{(2),\\mathrm{SR}}_{12,12} = \\gamma^{\\mathrm{SR}}_{11}\\gamma^{\\mathrm{SR}}_{22} = (1)(1) = 1 $$\n$$ \\Gamma^{(2),\\mathrm{SR}}_{13,13} = \\gamma^{\\mathrm{SR}}_{11}\\gamma^{\\mathrm{SR}}_{33} = (1)(0) = 0 $$\n$$ \\Gamma^{(2),\\mathrm{SR}}_{23,23} = \\gamma^{\\mathrm{SR}}_{22}\\gamma^{\\mathrm{SR}}_{33} = (1)(0) = 0 $$\nThe SR zero-body energy is the expectation value in the Slater determinant, which is simply the interaction energy of the occupied pair:\n$$ E^{(0)}_{\\mathrm{SR}} = (2.0)(1) + (0.8)(0) + (1.6)(0) = 2.0 \\, \\text{MeV} $$\n\n### 3. Final Difference\nThe final quantity to be calculated is the difference between the MR and SR zero-body energies:\n$$ \\Delta E = E^{(0)}_{\\mathrm{MR}} - E^{(0)}_{\\mathrm{SR}} = 1.912 \\, \\text{MeV} - 2.0 \\, \\text{MeV} = -0.088 \\, \\text{MeV} $$\nRounding to four significant figures gives $-0.08800$.", "answer": "$$\\boxed{-0.08800}$$", "id": "3571488"}, {"introduction": "This final practice brings the theory to life by simulating the core mechanism of the in-medium similarity renormalization group: the decoupling flow. Using a schematic pairing Hamiltonian that captures the essence of open-shell physics, you will implement and solve the differential equations that systematically drive the off-diagonal Hamiltonian elements towards zero [@problem_id:3571475]. This coding exercise offers direct insight into how the SRG flow dynamically block-diagonalizes the Hamiltonian and allows for a practical comparison of different generator choices.", "problem": "You are to implement and analyze a toy flow for the Multi-Reference In-Medium Similarity Renormalization Group (MR-IM-SRG) applied to an open-shell two-level pairing Hamiltonian. Begin from the following foundational elements.\n\n1. Flow equation and truncation. The Similarity Renormalization Group (SRG) flow is defined by the differential equation\n$$\n\\frac{d \\hat{H}(s)}{ds} = [\\hat{\\eta}(s), \\hat{H}(s)],\n$$\nwhere $s$ is the continuous flow parameter, $\\hat{H}(s)$ is the $s$-dependent Hamiltonian, and $\\hat{\\eta}(s)$ is an anti-Hermitian generator. In the In-Medium Similarity Renormalization Group (IM-SRG), operators are normal-ordered with respect to a reference state. In the Multi-Reference (MR) extension, the reference encodes fractional occupation numbers to represent open-shell correlations. In this problem, you will consider a truncation at the normal-ordered two-body level, often denoted MR-IM-SRG(2), and restrict the dynamics to a seniority-zero two-state subspace so that the Hamiltonian reduces to a $2 \\times 2$ effective problem in this subspace.\n\n2. Toy two-level pairing Hamiltonian and normal ordering. Consider two single-particle levels with single-particle energies $\\epsilon_1$ and $\\epsilon_2$ (in $\\mathrm{MeV}$), a pairing strength $G$ (in $\\mathrm{MeV}$), and fractional occupation numbers $n_1, n_2 \\in [0,1]$ encoding the multi-reference open-shell state. Adopt the following well-motivated mean-field plus pairing closure to define the initial, normal-ordered $2 \\times 2$ Hamiltonian in the pair-subspace as\n$$\n\\hat{H}(0) \\mapsto H(0) = \n\\begin{pmatrix}\ne_1  v_0 \\\\\nv_0  e_2\n\\end{pmatrix},\n$$\nwith\n$$\ne_i = 2 \\epsilon_i - G\\, n_i,\\quad\n\\kappa_i = \\sqrt{n_i(1-n_i)},\\quad\nv_0 = -G \\,\\kappa_1 \\kappa_2.\n$$\nThis closure reflects that the diagonal normal-ordered one-body field acquires a contribution linear in the occupation numbers and that the off-diagonal pair-transfer amplitude scales with the anomalous densities $\\kappa_i$. All energies are in $\\mathrm{MeV}$. This definition yields a consistent, self-contained initial value problem in the seniority-zero subspace.\n\n3. Generators. Consider the following two standard SRG generators:\n- Wegner generator: $\\hat{\\eta}_\\mathrm{Wegner}(s) = [H_\\mathrm{d}(s), H_\\mathrm{od}(s)]$, where $H_\\mathrm{d}(s)$ is the diagonal part of $H(s)$ and $H_\\mathrm{od}(s)$ is its off-diagonal part. In the present $2 \\times 2$ setting, write $H(s) = \\begin{pmatrix} e_1(s)  v(s) \\\\ v(s)  e_2(s) \\end{pmatrix}$ and split $H(s)=H_\\mathrm{d}(s)+H_\\mathrm{od}(s)$ in the canonical way.\n- White generator: $\\eta_{ij}(s) = H_{ij}(s)/\\Delta_{ij}(s)$ for $i\\neq j$, with $\\Delta_{ij}(s)$ an energy denominator, taken here as the difference of instantaneous diagonal matrix elements, i.e., $\\Delta_{12}(s)=e_1(s)-e_2(s)$. In a $2 \\times 2$ context, take $\\eta_{12}(s)=v(s)/\\Delta_{12}(s)$ and $\\eta_{21}(s)=-\\eta_{12}(s)$.\n\n4. Derive the closed $2 \\times 2$ flow at MR-IM-SRG(2) level in this subspace. Using only the flow equation $\\frac{dH}{ds}=[\\eta,H]$ and the definitions above, and restricting to the $2 \\times 2$ pair-subspace, show that the off-diagonal flow equations become:\n- For the Wegner generator,\n$$\n\\frac{dv}{ds} = -\\Delta^2\\, v,\\quad\n\\frac{de_1}{ds} = 2 v^2 \\Delta,\\quad\n\\frac{de_2}{ds} = -2 v^2 \\Delta,\\quad\n\\Delta \\equiv e_1-e_2.\n$$\n- For the White generator (with the canonical denominator $\\Delta$),\n$$\n\\frac{dv}{ds} = -v,\\quad\n\\frac{de_1}{ds} = \\frac{2 v^2}{\\Delta},\\quad\n\\frac{de_2}{ds} = -\\frac{2 v^2}{\\Delta},\\quad\n\\Delta \\equiv e_1-e_2,\n$$\nwith the convention that when $|\\Delta|$ is numerically negligible, the diagonal flows are set to zero to avoid division by zero. These equations are the exact $2 \\times 2$ consequences of the commutator dynamics under the chosen generators and are consistent with MR-IM-SRG(2) truncation in this reduced subspace.\n\n5. Suppression metric. Define the suppression factor of the off-diagonal matrix element as\n$$\nR(s) = \\frac{|v(s)|}{|v(0)|}.\n$$\nThe task is to compute $R(s)$ for specified parameter sets and flow generators.\n\n6. Units. All energies $\\epsilon_i, G, e_i, v$ are in $\\mathrm{MeV}$. For the Wegner generator, the flow parameter $s$ carries units of $\\mathrm{MeV}^{-2}$ so that the product $\\Delta^2 s$ is dimensionless. For the White generator, $s$ is dimensionless. The requested output, $R(s)$, is dimensionless.\n\n7. Programming task. Write a complete, runnable program that:\n- Constructs $H(0)$ from $(\\epsilon_1,\\epsilon_2,G,n_1,n_2)$ using the closure in item $2$.\n- Evolves the flow to $s=s_\\mathrm{end}$ using the ordinary differential equations in item $4$ for the specified generator.\n- Returns the suppression $R(s_\\mathrm{end})$ for each test case below.\n\n8. Test suite. Use the following four test cases, each specified as a $7$-tuple $(\\text{generator}, \\epsilon_1, \\epsilon_2, G, n_1, n_2, s_\\mathrm{end})$, where the generator is the string “Wegner” or “White”, all energies are in $\\mathrm{MeV}$, and $s_\\mathrm{end}$ is in $\\mathrm{MeV}^{-2}$ for “Wegner” and dimensionless for “White”:\n- Case A (general, Wegner): $(\\text{\"Wegner\"},\\, 0.0,\\, 1.0,\\, 0.5,\\, 0.7,\\, 0.3,\\, 5.0)$\n- Case B (general, White): $(\\text{\"White\"},\\, 0.0,\\, 1.0,\\, 0.5,\\, 0.7,\\, 0.3,\\, 5.0)$\n- Case C (degenerate, Wegner): $(\\text{\"Wegner\"},\\, 0.0,\\, 0.0,\\, 0.3,\\, 0.5,\\, 0.5,\\, 10.0)$\n- Case D (large $s$, Wegner): $(\\text{\"Wegner\"},\\, 0.0,\\, 2.0,\\, 1.0,\\, 0.6,\\, 0.4,\\, 40.0)$\n\n9. Final output format. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For the four cases above, the output must be of the form\n$$\n[\\;R_A, R_B, R_C, R_D\\;],\n$$\nwhere each $R_\\bullet$ is a floating-point number. No additional text should be printed.", "solution": "The core of this problem is to solve a system of coupled ordinary differential equations (ODEs) that describe the evolution of the Hamiltonian's matrix elements as a function of the flow parameter $s$. The Hamiltonian is represented by a $2\\times 2$ matrix in the seniority-zero subspace:\n$$\nH(s) = \\begin{pmatrix} e_1(s)  v(s) \\\\ v(s)  e_2(s) \\end{pmatrix}\n$$\nA key property of the SRG flow is that the trace of the Hamiltonian is a constant of motion, since $\\text{Tr}([\\eta, H]) = 0$. This implies $e_1(s) + e_2(s) = \\text{const}$. This property allows us to simplify the system by focusing on the evolution of the off-diagonal element $v(s)$ and the difference of the diagonal elements, $\\Delta(s) \\equiv e_1(s) - e_2(s)$. The flow equation for $\\Delta(s)$ is derived as $\\frac{d\\Delta}{ds} = \\frac{de_1}{ds} - \\frac{de_2}{ds}$.\n\nThis leads to two distinct systems of ODEs, one for each generator.\n\n### 1. Wegner Generator\nUsing the provided flow equations, the system for the state vector $\\vec{y}(s) = [v(s), \\Delta(s)]^T$ is:\n$$\n\\begin{cases}\n\\frac{dv}{ds} = -v(s) \\Delta(s)^2 \\\\\n\\frac{d\\Delta}{ds} = \\frac{de_1}{ds} - \\frac{de_2}{ds} = (2 v^2 \\Delta) - (-2 v^2 \\Delta) = 4v(s)^2 \\Delta(s)\n\\end{cases}\n$$\nNote that if the system starts in a degenerate state where $\\Delta(0)=0$, then $\\frac{d\\Delta}{ds}|_{s=0}=0$ and $\\frac{dv}{ds}|_{s=0}=0$. The flow stalls, and the Hamiltonian remains unchanged.\n\n### 2. White Generator\nThe system of ODEs for the White generator is:\n$$\n\\begin{cases}\n\\frac{dv}{ds} = -v(s) \\\\\n\\frac{d\\Delta}{ds} = \\frac{de_1}{ds} - \\frac{de_2}{ds} = \\left(\\frac{2 v^2}{\\Delta}\\right) - \\left(-\\frac{2 v^2}{\\Delta}\\right) = \\frac{4v(s)^2}{\\Delta(s)}\n\\end{cases}\n$$\nIn this case, the evolution of $v(s)$ is independent of $\\Delta(s)$ and can be solved analytically: $v(s) = v(0) e^{-s}$. The equation for $\\Delta(s)$ requires special handling if $\\Delta(s)$ approaches zero, as specified in the problem.\n\n### Numerical Implementation Strategy\nThe general algorithm to solve for each test case is as follows:\n1.  From the input parameters $(\\epsilon_1, \\epsilon_2, G, n_1, n_2)$, calculate the initial matrix elements $v_0 = v(0)$, $e_{1,0} = e_1(0)$, and $e_{2,0} = e_2(0)$.\n2.  From these, determine the initial state vector for the ODE system: $\\vec{y}(0) = [v(0), \\Delta(0)]^T = [v_0, e_{1,0} - e_{2,0}]^T$.\n3.  Define a function that computes the right-hand side of the ODE system, $\\frac{d\\vec{y}}{ds} = f(s, \\vec{y})$, selecting the appropriate equations based on the generator type. This function must include the specified safety check for the White generator when $|\\Delta| \\approx 0$.\n4.  Use a standard numerical ODE solver, such as `scipy.integrate.solve_ivp`, to integrate the system from $s=0$ to the specified $s_\\mathrm{end}$.\n5.  Extract the final value of the off-diagonal element, $v(s_\\mathrm{end})$, from the solver's output.\n6.  Compute the final suppression factor $R(s_\\mathrm{end}) = |v(s_\\mathrm{end})| / |v_0|$. Handle the edge case where $|v_0|$ is zero.\n\nThis procedure constitutes a complete and correct method for solving the initial value problem for each test case provided.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Main function to run the MR-IM-SRG flow for the specified test cases.\n    \"\"\"\n\n    # Test suite from the problem statement.\n    # Format: (generator_type, epsilon1, epsilon2, G, n1, n2, s_end)\n    test_cases = [\n        (\"Wegner\", 0.0, 1.0, 0.5, 0.7, 0.3, 5.0),    # Case A\n        (\"White\", 0.0, 1.0, 0.5, 0.7, 0.3, 5.0),     # Case B\n        (\"Wegner\", 0.0, 0.0, 0.3, 0.5, 0.5, 10.0),   # Case C\n        (\"Wegner\", 0.0, 2.0, 1.0, 0.6, 0.4, 40.0)    # Case D\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_srg_flow(case)\n        results.append(result)\n\n    # Format the final output as a comma-separated list in brackets.\n    # The map to str ensures floating point numbers are correctly represented.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_srg_flow(case):\n    \"\"\"\n    Calculates the suppression factor R(s_end) for a single test case.\n    \"\"\"\n    generator, eps1, eps2, G, n1, n2, s_end = case\n    \n    # 1. Calculate initial conditions for H(0)\n    # Check for valid occupation numbers to avoid domain errors with sqrt\n    if not (0.0 = n1 = 1.0 and 0.0 = n2 = 1.0):\n        raise ValueError(\"Occupation numbers n1 and n2 must be in [0, 1].\")\n\n    kappa1 = np.sqrt(n1 * (1.0 - n1))\n    kappa2 = np.sqrt(n2 * (1.0 - n2))\n    \n    v0 = -G * kappa1 * kappa2\n    e1_0 = 2.0 * eps1 - G * n1\n    e2_0 = 2.0 * eps2 - G * n2\n    Delta0 = e1_0 - e2_0\n\n    # If v0 is numerically zero, the off-diagonal coupling is absent from the start.\n    # The suppression ratio is ill-defined, but we can consider it 1.0\n    # as there is no change from its initial (zero) value.\n    if np.isclose(v0, 0.0):\n        return 1.0\n\n    # 2. Define the system of ODEs\n    # The state vector y is [v, Delta]\n    def ode_system(s, y, gen_type, delta_cutoff=1e-9):\n        v, Delta = y\n        \n        if gen_type == \"Wegner\":\n            dv_ds = -v * Delta**2\n            dDelta_ds = 4.0 * v**2 * Delta\n        elif gen_type == \"White\":\n            dv_ds = -v\n            # Avoid division by zero as per problem statement\n            if abs(Delta)  delta_cutoff:\n                dDelta_ds = 0.0\n            else:\n                dDelta_ds = 4.0 * v**2 / Delta\n        else:\n            raise ValueError(f\"Unknown generator type: {gen_type}\")\n            \n        return [dv_ds, dDelta_ds]\n\n    # Special analytical cases for verification and efficiency\n    # Case C (degenerate Wegner): Delta(0)=0 implies flow stalls.\n    if generator == \"Wegner\" and np.isclose(Delta0, 0.0):\n        return 1.0\n\n    # While Case B (White) has an analytical solution for v(s),\n    # we use the numerical solver for consistency and generality.\n    \n    # 3. Solve the ODE system\n    y0 = [v0, Delta0]\n    sol = solve_ivp(\n        ode_system, \n        (0.0, s_end), \n        y0, \n        args=(generator,),\n        method='RK45', \n        dense_output=False,\n        rtol=1e-8,\n        atol=1e-8\n    )\n    \n    # 4. Extract the final value of v(s)\n    # sol.y contains the solution at different time points, the last column is at s_end\n    v_final = sol.y[0, -1]\n    \n    # 5. Compute the suppression factor R(s_end)\n    R = np.abs(v_final) / np.abs(v0)\n    \n    return R\n\n# Execute the main function\nsolve()\n```", "id": "3571475"}]}