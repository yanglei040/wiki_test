{"hands_on_practices": [{"introduction": "The description of crystal structures often involves a trade-off between a cell that reflects the full symmetry of the lattice (the conventional cell) and one that has the minimum possible volume (the primitive cell). Mastering the transformation between these representations is a cornerstone of solid-state physics. This first practice challenges you to derive the primitive cell for a base-centered orthorhombic lattice, reinforcing the fundamental relationship between cell volume and the number of lattice points per cell. [@problem_id:3445092]", "problem": "Consider a base-centered orthorhombic conventional cell (C-centering) with direct lattice vectors $\\mathbf{a} = a\\,\\hat{\\mathbf{x}}$, $\\mathbf{b} = b\\,\\hat{\\mathbf{y}}$, and $\\mathbf{c} = c\\,\\hat{\\mathbf{z}}$, where $a$, $b$, and $c$ are positive real numbers and $\\hat{\\mathbf{x}}$, $\\hat{\\mathbf{y}}$, and $\\hat{\\mathbf{z}}$ are orthonormal Cartesian unit vectors. The conventional cell has lattice points at fractional coordinates $(0,0,0)$ and $\\left(\\frac{1}{2},\\frac{1}{2},0\\right)$ with respect to $(\\mathbf{a},\\mathbf{b},\\mathbf{c})$. \n\nUsing only fundamental definitions of a Bravais lattice (integer linear combinations of primitive vectors) and of a unit cell volume in direct space, construct a primitive cell by proposing a set of three linearly independent primitive vectors $\\{\\mathbf{p}_{1},\\mathbf{p}_{2},\\mathbf{p}_{3}\\}$ that generate the same lattice as the C-centered orthorhombic conventional cell. Then, compute the volume of this primitive cell and compare it to the volume of the conventional cell. \n\nYour final task is to determine the exact value of the ratio $V_{\\mathrm{p}}/V_{\\mathrm{c}}$, where $V_{\\mathrm{p}}$ is the volume of the primitive cell and $V_{\\mathrm{c}}$ is the volume of the conventional cell. Express the final ratio as an exact reduced fraction. No rounding is required, and no units should be included in the final answer.", "solution": "We begin from the definition of a Bravais lattice in direct space: a set of lattice points is generated by all integer linear combinations of a set of three linearly independent primitive vectors $\\{\\mathbf{p}_{1},\\mathbf{p}_{2},\\mathbf{p}_{3}\\}$. A primitive cell is any cell spanned by such a set that contains exactly one lattice point. The volume of a cell spanned by vectors $\\mathbf{u}$, $\\mathbf{v}$, and $\\mathbf{w}$ in direct space is given by the scalar triple product $|\\mathbf{u}\\cdot(\\mathbf{v}\\times\\mathbf{w})|$.\n\nFor the base-centered orthorhombic conventional cell (C-centering), the direct lattice is commonly described by $\\mathbf{a}$, $\\mathbf{b}$, and $\\mathbf{c}$, with additional lattice points at fractional coordinates $\\left(\\frac{1}{2},\\frac{1}{2},0\\right)$. The conventional cell volume is\n$$\nV_{\\mathrm{c}} = |\\mathbf{a}\\cdot(\\mathbf{b}\\times\\mathbf{c})| = a\\,b\\,c,\n$$\nbecause $\\mathbf{a}$, $\\mathbf{b}$, and $\\mathbf{c}$ are orthogonal and aligned with Cartesian axes.\n\nTo construct a primitive cell for the C-centered lattice, we propose the following primitive vectors:\n$$\n\\mathbf{p}_{1} = \\frac{1}{2}\\left(\\mathbf{a} + \\mathbf{b}\\right),\\qquad\n\\mathbf{p}_{2} = \\frac{1}{2}\\left(-\\mathbf{a} + \\mathbf{b}\\right),\\qquad\n\\mathbf{p}_{3} = \\mathbf{c}.\n$$\nWe verify that these generate the same lattice as the C-centered conventional description:\n- First, they are linearly independent because $\\mathbf{p}_{3}$ is orthogonal to the plane spanned by $\\mathbf{p}_{1}$ and $\\mathbf{p}_{2}$, and $\\{\\mathbf{p}_{1},\\mathbf{p}_{2}\\}$ are clearly independent in the $\\mathbf{a}$â€“$\\mathbf{b}$ plane.\n- Second, they reproduce the conventional lattice translations. Solve for $\\mathbf{a}$ and $\\mathbf{b}$ in terms of $\\mathbf{p}_{1}$ and $\\mathbf{p}_{2}$:\n$$\n\\mathbf{p}_{1} + \\mathbf{p}_{2} = \\frac{1}{2}\\left(\\mathbf{a} + \\mathbf{b}\\right) + \\frac{1}{2}\\left(-\\mathbf{a} + \\mathbf{b}\\right) = \\mathbf{b},\n$$\n$$\n\\mathbf{p}_{1} - \\mathbf{p}_{2} = \\frac{1}{2}\\left(\\mathbf{a} + \\mathbf{b}\\right) - \\frac{1}{2}\\left(-\\mathbf{a} + \\mathbf{b}\\right) = \\mathbf{a}.\n$$\nThus $\\mathbf{a}$ and $\\mathbf{b}$ are integer linear combinations of $\\mathbf{p}_{1}$ and $\\mathbf{p}_{2}$, and $\\mathbf{c} = \\mathbf{p}_{3}$ directly. Moreover, the centering vector $\\left(\\frac{1}{2},\\frac{1}{2},0\\right)$ in Cartesian form is $\\frac{1}{2}\\left(\\mathbf{a}+\\mathbf{b}\\right) = \\mathbf{p}_{1}$, which is itself an integer combination with coefficients $(1,0,0)$ in the primitive basis. Therefore, $\\{\\mathbf{p}_{1},\\mathbf{p}_{2},\\mathbf{p}_{3}\\}$ generate the same set of lattice points as the C-centered conventional cell.\n\nWe now compute the primitive cell volume:\n$$\nV_{\\mathrm{p}} = \\left|\\mathbf{p}_{1}\\cdot\\left(\\mathbf{p}_{2}\\times\\mathbf{p}_{3}\\right)\\right|.\n$$\nWrite the vectors in Cartesian components using $\\mathbf{a} = a\\,\\hat{\\mathbf{x}}$, $\\mathbf{b} = b\\,\\hat{\\mathbf{y}}$, and $\\mathbf{c} = c\\,\\hat{\\mathbf{z}}$:\n$$\n\\mathbf{p}_{1} = \\left(\\frac{a}{2},\\,\\frac{b}{2},\\,0\\right),\\qquad\n\\mathbf{p}_{2} = \\left(-\\frac{a}{2},\\,\\frac{b}{2},\\,0\\right),\\qquad\n\\mathbf{p}_{3} = \\left(0,\\,0,\\,c\\right).\n$$\nCompute the cross product:\n$$\n\\mathbf{p}_{2}\\times\\mathbf{p}_{3} =\n\\begin{vmatrix}\n\\hat{\\mathbf{x}} & \\hat{\\mathbf{y}} & \\hat{\\mathbf{z}} \\\\\n-\\frac{a}{2} & \\frac{b}{2} & 0 \\\\\n0 & 0 & c\n\\end{vmatrix}\n= \\left(\\frac{b}{2}\\,c\\right)\\hat{\\mathbf{x}} + \\left(\\frac{a}{2}\\,c\\right)\\hat{\\mathbf{y}} + 0\\,\\hat{\\mathbf{z}}.\n$$\nThen the scalar triple product is\n$$\n\\mathbf{p}_{1}\\cdot\\left(\\mathbf{p}_{2}\\times\\mathbf{p}_{3}\\right)\n= \\left(\\frac{a}{2}\\right)\\left(\\frac{b}{2}\\,c\\right) + \\left(\\frac{b}{2}\\right)\\left(\\frac{a}{2}\\,c\\right) + 0\n= \\frac{ab c}{4} + \\frac{ab c}{4}\n= \\frac{ab c}{2}.\n$$\nTherefore,\n$$\nV_{\\mathrm{p}} = \\frac{a\\,b\\,c}{2}.\n$$\nSince $V_{\\mathrm{c}} = a\\,b\\,c$, the ratio is\n$$\n\\frac{V_{\\mathrm{p}}}{V_{\\mathrm{c}}} = \\frac{\\frac{a\\,b\\,c}{2}}{a\\,b\\,c} = \\frac{1}{2}.\n$$\nThis confirms that the primitive cell volume for the base-centered orthorhombic lattice is half of the conventional cell volume, consistent with the presence of two lattice points per conventional cell for C-centering.", "answer": "$$\\boxed{\\frac{1}{2}}$$", "id": "3445092"}, {"introduction": "While standard recipes exist for constructing primitive vectors, it is equally important to be able to determine if an arbitrary set of vectors constitutes a valid primitive basis. This skill is vital for validating crystal structure data from various sources. This exercise provides a candidate set of vectors for a body-centered cubic lattice and asks you to verify its primitivity by comparing its volume to the known primitive volume, thereby solidifying the core definitions of a Bravais lattice. [@problem_id:3445093]", "problem": "A body-centered cubic (BCC) Bravais lattice is described by a conventional cubic cell with edge length $a$, spanned by the vectors $\\mathbf{c}_1 = a\\,\\hat{\\mathbf{x}}$, $\\mathbf{c}_2 = a\\,\\hat{\\mathbf{y}}$, and $\\mathbf{c}_3 = a\\,\\hat{\\mathbf{z}}$, and with lattice point locations at the eight cube corners and the cube body center. A candidate set of three vectors in the direct lattice is\n$\\mathcal{A} = \\{\\mathbf{a}_1,\\mathbf{a}_2,\\mathbf{a}_3\\}$ with\n$\\mathbf{a}_1 = \\frac{a}{2}(1,1,-1)$, $\\mathbf{a}_2 = a(0,1,0)$, and $\\mathbf{a}_3 = a(0,0,1)$.\nUsing only the definitions of a Bravais lattice, a primitive cell, and the triple scalar product for the volume enclosed by three vectors, proceed from first principles as follows: first determine the volume per lattice point, denoted $V$, of the BCC Bravais lattice by analyzing the conventional cubic cell described above; then decide whether $\\mathcal{A}$ is a primitive set by constructing an alternative set $\\mathcal{B} = \\{\\mathbf{b}_1,\\mathbf{b}_2,\\mathbf{b}_3\\}$ that you can justify as primitive for the same Bravais lattice and verifying that both $\\mathcal{A}$ and your $\\mathcal{B}$ enclose a cell of volume $V$ via direct evaluation of $|\\mathbf{v}_1 \\cdot (\\mathbf{v}_2 \\times \\mathbf{v}_3)|$ for each set. Express your final result for the primitive cell volume $V$ in units of $a^3$ (that is, as a multiple of $a^3$). Provide only the closed-form expression for $V$ in terms of $a$ as your final answer.", "solution": "The problem requires a two-part analysis based on first principles. First, we must determine the volume per lattice point, $V$, for a body-centered cubic (BCC) Bravais lattice. Second, we must evaluate whether a given set of vectors, $\\mathcal{A}$, constitutes a primitive basis for this lattice. The method prescribed is to compare the volume enclosed by $\\mathcal{A}$ with the volume $V$ and the volume enclosed by a known primitive basis $\\mathcal{B}$.\n\nThe first step is to calculate the volume of the primitive cell, $V$. A primitive cell is, by definition, a minimum-volume cell that, when translated by all Bravais lattice vectors, fills all of space without overlap. It contains exactly one lattice point. The problem describes the BCC lattice using a conventional cell, which is a cube of edge length $a$. The volume of this conventional cell is $V_{\\text{conv}} = a^3$.\n\nThe lattice points associated with this conventional cell are located at the $8$ corners of the cube and at $1$ body-center position. To find the number of lattice points, $N$, belonging to a single conventional cell, we must consider the sharing of points with adjacent cells. Each of the $8$ corner points is shared by $8$ adjoining cubic cells, and thus contributes $\\frac{1}{8}$ of a point to the cell in question. The body-center point lies entirely within the cell and is not shared, contributing $1$ full point. Therefore, the total number of lattice points per conventional cell is:\n$$ N = \\left(8 \\text{ corners}\\right) \\times \\left(\\frac{1}{8} \\frac{\\text{point}}{\\text{corner}}\\right) + \\left(1 \\text{ center}\\right) \\times \\left(1 \\frac{\\text{point}}{\\text{center}}\\right) = 1 + 1 = 2 \\text{ points} $$\nThe volume per lattice point, which is the volume of the primitive cell $V$, is the volume of the conventional cell divided by the number of lattice points it contains:\n$$ V = \\frac{V_{\\text{conv}}}{N} = \\frac{a^3}{2} $$\nThis is the target volume for any primitive cell of the BCC lattice.\n\nNext, as per the problem's instructions, we construct a known primitive basis, $\\mathcal{B} = \\{\\mathbf{b}_1, \\mathbf{b}_2, \\mathbf{b}_3\\}$, and verify its volume. A standard choice for the primitive vectors of a BCC lattice, which connect a lattice point at the origin to nearest-neighbor body-center positions, is:\n$$ \\mathbf{b}_1 = \\frac{a}{2}(-\\hat{\\mathbf{x}} + \\hat{\\mathbf{y}} + \\hat{\\mathbf{z}}), \\quad \\mathbf{b}_2 = \\frac{a}{2}(\\hat{\\mathbf{x}} - \\hat{\\mathbf{y}} + \\hat{\\mathbf{z}}), \\quad \\mathbf{b}_3 = \\frac{a}{2}(\\hat{\\mathbf{x}} + \\hat{\\mathbf{y}} - \\hat{\\mathbf{z}}) $$\nTo justify this set as primitive, we calculate the volume $V_{\\mathcal{B}}$ of the parallelepiped spanned by these vectors using the scalar triple product, $V_{\\mathcal{B}} = |\\mathbf{b}_1 \\cdot (\\mathbf{b}_2 \\times \\mathbf{b}_3)|$. This volume is given by the absolute value of the determinant of the matrix formed by the vector components:\n$$ V_{\\mathcal{B}} = \\left| \\det \\begin{pmatrix} -\\frac{a}{2} & \\frac{a}{2} & \\frac{a}{2} \\\\ \\frac{a}{2} & -\\frac{a}{2} & \\frac{a}{2} \\\\ \\frac{a}{2} & \\frac{a}{2} & -\\frac{a}{2} \\end{pmatrix} \\right| = \\left| \\left(\\frac{a}{2}\\right)^3 \\det \\begin{pmatrix} -1 & 1 & 1 \\\\ 1 & -1 & 1 \\\\ 1 & 1 & -1 \\end{pmatrix} \\right| $$\nThe determinant of the $3 \\times 3$ matrix of integers is:\n$$ (-1)((-1)(-1) - (1)(1)) - (1)((1)(-1) - (1)(1)) + (1)((1)(1) - (-1)(1)) = -1(0) - 1(-2) + 1(2) = 4 $$\nSo, the volume is:\n$$ V_{\\mathcal{B}} = \\left| \\frac{a^3}{8} \\cdot 4 \\right| = \\frac{a^3}{2} $$\nSince $V_{\\mathcal{B}} = V$, our choice for $\\mathcal{B}$ is confirmed to be a valid primitive set, and its use as a standard for comparison is justified.\n\nFinally, we analyze the candidate set $\\mathcal{A} = \\{\\mathbf{a}_1, \\mathbf{a}_2, \\mathbf{a}_3\\}$, where $\\mathbf{a}_1 = \\frac{a}{2}(1,1,-1)$, $\\mathbf{a}_2 = a(0,1,0)$, and $\\mathbf{a}_3 = a(0,0,1)$. We calculate the volume $V_{\\mathcal{A}}$ enclosed by these vectors:\n$$ V_{\\mathcal{A}} = \\left| \\mathbf{a}_1 \\cdot (\\mathbf{a}_2 \\times \\mathbf{a}_3) \\right| = \\left| \\det \\begin{pmatrix} \\frac{a}{2} & \\frac{a}{2} & -\\frac{a}{2} \\\\ 0 & a & 0 \\\\ 0 & 0 & a \\end{pmatrix} \\right| $$\nSince this is an upper triangular matrix, its determinant is the product of the diagonal entries:\n$$ V_{\\mathcal{A}} = \\left| \\left(\\frac{a}{2}\\right) (a) (a) \\right| = \\left| \\frac{a^3}{2} \\right| = \\frac{a^3}{2} $$\nThe volume enclosed by the vectors in $\\mathcal{A}$ is indeed equal to the primitive cell volume, $V$. A set of vectors forms a primitive basis if and only if (1) each vector is a lattice vector (connecting two points of the Bravais lattice) and (2) the volume of the cell they span is the primitive cell volume. The vectors $\\mathbf{a}_2 = a\\hat{\\mathbf{y}}$ and $\\mathbf{a}_3 = a\\hat{\\mathbf{z}}$ are clearly lattice vectors connecting the origin to corner points of the conventional cell. The vector $\\mathbf{a}_1 = \\frac{a}{2}(\\hat{\\mathbf{x}} + \\hat{\\mathbf{y}} - \\hat{\\mathbf{z}})$ connects the origin to the body-center location $(\\frac{a}{2}, \\frac{a}{2}, -\\frac{a}{2})$, which is a valid BCC lattice point. Since both conditions are met, the set $\\mathcal{A}$ is a valid primitive set.\n\nThe primary result requested is the closed-form expression for the primitive cell volume $V$. Based on our analysis of the conventional cell, this volume is $\\frac{a^3}{2}$.", "answer": "$$\\boxed{\\frac{a^3}{2}}$$", "id": "3445093"}, {"introduction": "The distinction between primitive and conventional cells transitions from a geometric curiosity to a critical computational issue when simulating material properties in reciprocal space. Using a supercell instead of a primitive cell for a calculation effectively folds the Brillouin Zone, and a k-point grid that is sparse or improperly centered can fail to sample this folded zone symmetrically, leading to significant physical artifacts. This advanced practice guides you through implementing a diagnostic tool to detect such symmetry-breaking and highlights why a deep understanding of the direct lattice is indispensable for robust computational modeling. [@problem_id:3445110]", "problem": "Consider a two-dimensional crystalline solid described by a direct lattice with column vectors $\\mathbf{a}_1$ and $\\mathbf{a}_2$ assembled into a matrix $A \\in \\mathbb{R}^{2 \\times 2}$. A unit cell is defined by the pair $(A, \\{\\boldsymbol{\\tau}_\\alpha\\})$ where $\\{\\boldsymbol{\\tau}_\\alpha\\}$ is a set of intracell positions (the basis) of atoms. In this problem, we model a nonmagnetic system whose underlying primitive lattice is $A_{\\mathrm{prim}}$ and whose simulated cell is $A_{\\mathrm{cell}} = A_{\\mathrm{prim}} S$, where $S = \\operatorname{diag}(n_1,n_2)$ is a diagonal integer supercell scaling with $n_1, n_2 \\in \\mathbb{Z}^+$. The reciprocal lattice matrix $B \\in \\mathbb{R}^{2 \\times 2}$ is defined by the condition $A^\\top B = 2\\pi I$, that is $B = 2\\pi (A^{-1})^\\top$. The first Brillouin Zone (BZ) is spanned by the columns of $B$ with fractional coordinates in $[0,1)$ along each reciprocal axis.\n\nWe study wave vectors $\\mathbf{k}$ in reciprocal space sampled on a Monkhorst-Pack-type grid defined as\n$$\n\\mathbf{k}(i,j) = \\frac{i + s_1}{N_1} \\mathbf{b}_1 + \\frac{j + s_2}{N_2} \\mathbf{b}_2,\n$$\nfor integers $i \\in \\{0,1,\\dots,N_1-1\\}$, $j \\in \\{0,1,\\dots,N_2-1\\}$, uniform weights, and real shifts $s_1, s_2 \\in [0,1)$, where $\\mathbf{b}_1$ and $\\mathbf{b}_2$ are the columns of the reciprocal lattice matrix used to construct the grid. All angles are to be treated in radians. In our context, the physically correct symmetry is that of the primitive lattice $A_{\\mathrm{prim}}$, but the sampling is performed using the simulated cell $A_{\\mathrm{cell}}$ (which may be non-primitive). To expose the effect of symmetry breaking, consider a magnetization proxy per $\\mathbf{k}$ defined by\n$$\nm(\\mathbf{k}) = \\sin(\\mathbf{k} \\cdot \\mathbf{a}_1^{\\mathrm{prim}}) - \\sin(\\mathbf{k} \\cdot \\mathbf{a}_2^{\\mathrm{prim}}),\n$$\nwhich obeys the time-reversal oddness $m(-\\mathbf{k}) = -m(\\mathbf{k})$. In a symmetry-preserving sampling that is closed under inversion of the primitive lattice, the average magnetization proxy\n$$\nM_{\\mathrm{raw}} = \\frac{1}{|\\mathcal{K}|} \\sum_{\\mathbf{k} \\in \\mathcal{K}} m(\\mathbf{k})\n$$\nmust be zero. However, non-primitive cells can fold the Brillouin Zone and induce a sampled set $\\mathcal{K}$ that is not symmetry-complete with respect to the primitive lattice, yielding a spurious nonzero $M_{\\mathrm{raw}}$.\n\nYour tasks are:\n$1.$ Implement the foundations from first principles:\n$1.1.$ Construct $B_{\\mathrm{prim}}$ and $B_{\\mathrm{cell}}$ from $A_{\\mathrm{prim}}$ and $A_{\\mathrm{cell}}$, respectively, using $A^\\top B = 2\\pi I$.\n$1.2.$ Generate $\\mathcal{K}_{\\mathrm{cell}}$ from $(B_{\\mathrm{cell}}, N_1, N_2, s_1, s_2)$.\n$1.3.$ Unfold each $\\mathbf{k} \\in \\mathcal{K}_{\\mathrm{cell}}$ into the primitive Brillouin Zone by adding all distinct offsets\n$$\n\\mathbf{G}(p,q) = \\frac{p}{n_1} \\mathbf{b}_1^{\\mathrm{prim}} + \\frac{q}{n_2} \\mathbf{b}_2^{\\mathrm{prim}},\n$$\nfor $p \\in \\{0,1,\\dots,n_1-1\\}$ and $q \\in \\{0,1,\\dots,n_2-1\\}$, then reduce modulo the primitive Brillouin Zone to obtain the unfolded set $\\mathcal{K}_{\\mathrm{unfold}}$ expressed in $[0,1)$ fractional coordinates of $B_{\\mathrm{prim}}$.\n$1.4.$ Identify the point group of the primitive lattice among the candidate orthogonal operations $R \\in \\{I, -I, R_{90^\\circ}, R_{270^\\circ}\\}$, where\n$$\nR_{90^\\circ} = \\begin{pmatrix} 0 & -1 \\\\ 1 & 0 \\end{pmatrix}, \\quad R_{270^\\circ} = \\begin{pmatrix} 0 & 1 \\\\ -1 & 0 \\end{pmatrix}.\n$$\nA real-space operation $R$ is a lattice symmetry of $A_{\\mathrm{prim}}$ if and only if $T = A_{\\mathrm{prim}}^{-1} R A_{\\mathrm{prim}}$ has integer entries (within a numerical tolerance) and $\\det(T) = \\pm 1$. The corresponding action on reciprocal-space $\\mathbf{k}$ is $\\mathbf{k} \\mapsto R \\mathbf{k}$.\n\n$2.$ Design a diagnostic for symmetry-breaking artifacts in $\\mathbf{k}$-point sampling:\n$2.1.$ Test closure of $\\mathcal{K}_{\\mathrm{unfold}}$ under each primitive symmetry $R$: for every $\\mathbf{k} \\in \\mathcal{K}_{\\mathrm{unfold}}$, check whether $R \\mathbf{k}$ (reduced modulo the primitive Brillouin Zone) is present in $\\mathcal{K}_{\\mathrm{unfold}}$.\n$2.2.$ Compute $M_{\\mathrm{raw}}$ using $\\mathcal{K}_{\\mathrm{cell}}$ and the magnetization proxy $m(\\mathbf{k})$ with $\\mathbf{a}_i^{\\mathrm{prim}}$.\n$2.3.$ Define a corrected magnetization by symmetry-averaging over the primitive point group and unfolding offsets:\n$$\nM_{\\mathrm{corr}} = \\frac{1}{|\\mathcal{K}_{\\mathrm{cell}}| \\, n_1 \\, n_2 \\, |G|} \\sum_{\\mathbf{k} \\in \\mathcal{K}_{\\mathrm{cell}}} \\sum_{p=0}^{n_1-1} \\sum_{q=0}^{n_2-1} \\sum_{R \\in G} m\\!\\left(R \\left(\\mathbf{k} + \\mathbf{G}(p,q)\\right)\\right),\n$$\nwhere $G$ is the set of detected primitive symmetries.\n$2.4.$ Declare an artifact detected if either the closure test fails for any $R \\in G$ or $|M_{\\mathrm{raw}}|$ exceeds a small tolerance.\n\nYou must implement a complete program that performs the above tasks for the test suite below and produces the required outputs. All $2 \\times 2$ matrices and vectors are in Cartesian coordinates, angles are in radians, and there are no physical units to report for the final outputs.\n\nTest suite:\n$1.$ Happy path (primitive square lattice):\n$A_{\\mathrm{prim}} = \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix}$, $S = \\operatorname{diag}(1,1)$, $A_{\\mathrm{cell}} = A_{\\mathrm{prim}} S$, grid parameters $N_1 = 4$, $N_2 = 4$, $s_1 = 0$, $s_2 = 0$.\n$2.$ Non-primitive rectangular supercell inducing Brillouin Zone folding:\n$A_{\\mathrm{prim}} = \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix}$, $S = \\operatorname{diag}(2,1)$, $A_{\\mathrm{cell}} = A_{\\mathrm{prim}} S$, grid parameters $N_1 = 3$, $N_2 = 1$, $s_1 = 0$, $s_2 = 0$.\n$3.$ Oblique primitive lattice with a non-primitive supercell and asymmetric sampling:\n$A_{\\mathrm{prim}} = \\begin{pmatrix} 1 & 0 \\\\ 0.5 & 0.9 \\end{pmatrix}$, $S = \\operatorname{diag}(2,1)$, $A_{\\mathrm{cell}} = A_{\\mathrm{prim}} S$, grid parameters $N_1 = 3$, $N_2 = 1$, $s_1 = 0$, $s_2 = 0$.\n$4.$ Boundary case (primitive square lattice with a symmetry-friendly shifted grid):\n$A_{\\mathrm{prim}} = \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix}$, $S = \\operatorname{diag}(1,1)$, $A_{\\mathrm{cell}} = A_{\\mathrm{prim}} S$, grid parameters $N_1 = 3$, $N_2 = 3$, $s_1 = 0.5$, $s_2 = 0.5$.\n\nRequired final output format:\nYour program should produce a single line of output containing the results of all test cases as a comma-separated list enclosed in square brackets. For each test case, output a list with three entries $[b, M_{\\mathrm{raw}}, M_{\\mathrm{corr}}]$, where $b$ is a boolean indicating whether an artifact was detected, $M_{\\mathrm{raw}}$ is a float, and $M_{\\mathrm{corr}}$ is a float. The complete output should look like\n$[\\,[b_1, M_{\\mathrm{raw},1}, M_{\\mathrm{corr},1}], [b_2, M_{\\mathrm{raw},2}, M_{\\mathrm{corr},2}], [b_3, M_{\\mathrm{raw},3}, M_{\\mathrm{corr},3}], [b_4, M_{\\mathrm{raw},4}, M_{\\mathrm{corr},4}]\\,]$.", "solution": "The user-provided problem is a valid exercise in computational materials science. It requires the implementation of algorithms related to lattice vectors, reciprocal space, Brillouin zone sampling, and symmetry analysis. The problem is scientifically grounded, well-posed, and all definitions and parameters are provided for a deterministic solution.\n\nHere follows a step-by-step derivation and explanation of the methodology to be implemented.\n\n### **1. Foundational Constructions**\n\n**1.1. Lattice and Reciprocal Lattice Matrices**\nThe direct lattice is described by a matrix $A$ whose columns are the lattice vectors. The given primitive lattice is $A_{\\mathrm{prim}}$, and the simulation cell, which may be a supercell, is given by $A_{\\mathrm{cell}} = A_{\\mathrm{prim}} S$, where $S = \\operatorname{diag}(n_1, n_2)$ is a diagonal scaling matrix.\n\nThe reciprocal lattice matrix $B$ is defined by the relation $A^\\top B = 2\\pi I$, where $I$ is the identity matrix. This leads to the definition $B = 2\\pi (A^\\top)^{-1} = 2\\pi (A^{-1})^\\top$.\n\nFor the primitive lattice, the reciprocal lattice matrix is:\n$$\nB_{\\mathrm{prim}} = 2\\pi (A_{\\mathrm{prim}}^{-1})^\\top\n$$\nAnd for the simulation cell:\n$$\nB_{\\mathrm{cell}} = 2\\pi (A_{\\mathrm{cell}}^{-1})^\\top\n$$\nWe can relate $B_{\\mathrm{cell}}$ to $B_{\\mathrm{prim}}$. First, we find the inverse of the cell matrix:\n$$\nA_{\\mathrm{cell}}^{-1} = (A_{\\mathrm{prim}} S)^{-1} = S^{-1} A_{\\mathrm{prim}}^{-1}\n$$\nThen, we apply the definition of the reciprocal lattice matrix:\n$$\nB_{\\mathrm{cell}} = 2\\pi (A_{\\mathrm{cell}}^{-1})^\\top = 2\\pi (S^{-1} A_{\\mathrm{prim}}^{-1})^\\top = 2\\pi (A_{\\mathrm{prim}}^{-1})^\\top (S^{-1})^\\top\n$$\nSince $S$ is a diagonal matrix, its inverse $S^{-1}$ is also diagonal, so $(S^{-1})^\\top = S^{-1}$. This yields the relationship:\n$$\nB_{\\mathrm{cell}} = B_{\\mathrm{prim}} S^{-1}\n$$\nThis shows that a supercell in real space with scaling matrix $S$ corresponds to a \"subcell\" in reciprocal space with scaling $S^{-1}$. The columns of $B_{\\mathrm{prim}}$ and $B_{\\mathrm{cell}}$ will be denoted as $\\mathbf{b}_i^{\\mathrm{prim}}$ and $\\mathbf{b}_i^{\\mathrm{cell}}$ respectively.\n\n**1.2. k-point Set Generation**\nThe set of wave vectors $\\mathcal{K}_{\\mathrm{cell}}$ for the simulation cell is generated on a Monkhorst-Pack grid. Each vector $\\mathbf{k} \\in \\mathcal{K}_{\\mathrm{cell}}$ is a linear combination of the cell's reciprocal lattice vectors $\\mathbf{b}_1^{\\mathrm{cell}}$ and $\\mathbf{b}_2^{\\mathrm{cell}}$:\n$$\n\\mathbf{k}(i,j) = \\frac{i + s_1}{N_1} \\mathbf{b}_1^{\\mathrm{cell}} + \\frac{j + s_2}{N_2} \\mathbf{b}_2^{\\mathrm{cell}}\n$$\nfor integers $i \\in \\{0, \\dots, N_1-1\\}$ and $j \\in \\{0, \\dots, N_2-1\\}$. In matrix form, if $\\mathbf{f}_{\\mathrm{cell}}(i, j) = \\left(\\frac{i+s_1}{N_1}, \\frac{j+s_2}{N_2}\\right)^\\top$, then $\\mathbf{k}(i,j) = B_{\\mathrm{cell}} \\mathbf{f}_{\\mathrm{cell}}(i,j)$.\n\n**1.3. Unfolding k-points**\nUnfolding re-maps the k-points from the supercell's Brillouin Zone (BZ) to the primitive cell's BZ. This is achieved by adding reciprocal lattice vectors of the supercell, which correspond to a finer grid of offset vectors in the primitive BZ. These offsets are:\n$$\n\\mathbf{G}(p,q) = \\frac{p}{n_1} \\mathbf{b}_1^{\\mathrm{prim}} + \\frac{q}{n_2} \\mathbf{b}_2^{\\mathrm{prim}}\n$$\nfor $p \\in \\{0, \\dots, n_1-1\\}$ and $q \\in \\{0, \\dots, n_2-1\\}$.\nFor each $\\mathbf{k} \\in \\mathcal{K}_{\\mathrm{cell}}$, we generate a set of unfolded vectors $\\{\\mathbf{k} + \\mathbf{G}(p,q)\\}$. Each resulting vector must be reduced modulo the primitive BZ. A vector $\\mathbf{k}'$ is reduced by expressing it in fractional coordinates of $B_{\\mathrm{prim}}$, $\\mathbf{k}' = B_{\\mathrm{prim}} \\mathbf{f}'$, and then taking the fractional part of each component of $\\mathbf{f}'$: $\\mathbf{f}'_{\\text{red}} = \\mathbf{f}' - \\lfloor \\mathbf{f}' \\rfloor$. The set of unique reduced vectors forms $\\mathcal{K}_{\\mathrm{unfold}}$.\n\n**1.4. Point Group Identification**\nAn orthogonal operation $R$ is a point group symmetry of the lattice $A_{\\mathrm{prim}}$ if it maps the lattice onto itself. This is true if and only if the transformation matrix $T = A_{\\mathrm{prim}}^{-1} R A_{\\mathrm{prim}}$ consists of integer entries. This condition ensures that any lattice vector $A_{\\mathrm{prim}} \\mathbf{n}$ (with $\\mathbf{n} \\in \\mathbb{Z}^2$) is mapped to another lattice vector $R A_{\\mathrm{prim}} \\mathbf{n} = A_{\\mathrm{prim}} T \\mathbf{n}$, where $T \\mathbf{n}$ is an integer vector. The condition $\\det(T)=\\pm 1$ ensures the transformation is reversible. We must test the candidate matrices $\\{I, -I, R_{90^\\circ}, R_{270^\\circ}\\}$ against this criterion to find the point group $G$.\n\n### **2. Symmetry-Breaking Diagnostic**\n\n**2.1. Closure Test**\nA symmetry-preserving k-point set must be closed under the action of the lattice point group. The unfolded set $\\mathcal{K}_{\\mathrm{unfold}}$ should possess the full symmetry of the primitive lattice. For each symmetry operation $R \\in G$, and for every vector $\\mathbf{k} \\in \\mathcal{K}_{\\mathrm{unfold}}$, the transformed vector $R\\mathbf{k}$ (after reduction to the first BZ) must also be present in $\\mathcal{K}_{\\mathrm{unfold}}$. A failure to meet this condition for any $R$ indicates a symmetry-breaking artifact. Due to floating-point arithmetic, this check must be performed with a numerical tolerance.\n\n**2.2. Raw Magnetization Proxy, $M_{\\mathrm{raw}}$**\nThe magnetization proxy is defined as $m(\\mathbf{k}) = \\sin(\\mathbf{k} \\cdot \\mathbf{a}_1^{\\mathrm{prim}}) - \\sin(\\mathbf{k} \\cdot \\mathbf{a}_2^{\\mathrm{prim}})$. This function has the property $m(-\\mathbf{k}) = -m(\\mathbf{k})$. For any k-point set $\\mathcal{K}$ that is closed under inversion (i.e., if $\\mathbf{k} \\in \\mathcal{K}$, then $-\\mathbf{k}$ is also in $\\mathcal{K}$, modulo a reciprocal lattice vector), the average $M = \\frac{1}{|\\mathcal{K}|} \\sum_{\\mathbf{k} \\in \\mathcal{K}} m(\\mathbf{k})$ will be zero.\nThe raw average, $M_{\\mathrm{raw}}$, is calculated over the as-sampled set $\\mathcal{K}_{\\mathrm{cell}}$. A non-zero $|M_{\\mathrm{raw}}|$ (above a numerical tolerance) indicates that $\\mathcal{K}_{\\mathrm{cell}}$ is not inversion-symmetric, a common artifact of supercell calculations.\n\n**2.3. Corrected Magnetization, $M_{\\mathrm{corr}}$**\nThe corrected magnetization is computed by explicitly averaging over all symmetry operations of the primitive point group $G$ and all unfolding offsets $\\mathbf{G}(p,q)$:\n$$\nM_{\\mathrm{corr}} = \\frac{1}{N_{\\text{tot}}} \\sum_{\\mathbf{k} \\in \\mathcal{K}_{\\mathrm{cell}}} \\sum_{p=0}^{n_1-1} \\sum_{q=0}^{n_2-1} \\sum_{R \\in G} m\\!\\left(R \\left(\\mathbf{k} + \\mathbf{G}(p,q)\\right)\\right),\n$$\nwhere $N_{\\text{tot}} = |\\mathcal{K}_{\\mathrm{cell}}| \\, n_1 \\, n_2 \\, |G|$. The set of arguments of $m(\\cdot)$ in this sum is explicitly constructed to be closed under all symmetries in $G$. Since any 2D Bravais lattice has inversion symmetry ($R=-I \\in G$) and $m(\\mathbf{k})$ is an odd function, the terms in the sum will cancel in pairs, leading to $M_{\\mathrm{corr}} = 0$ (within floating-point precision). This serves as a powerful internal consistency check.\n\n**2.4. Artifact Detection**\nAn artifact is declared detected if either of two conditions is met:\n1. The closure test fails for $\\mathcal{K}_{\\mathrm{unfold}}$. This signifies that the sampling, even after unfolding, does not respect the full lattice symmetry.\n2. The raw magnetization $|M_{\\mathrm{raw}}|$ is significantly non-zero. This is a direct measure of the inversion-symmetry breaking in the original sampling $\\mathcal{K}_{\\mathrm{cell}}$.\nA numerical tolerance, e.g., $10^{-9}$, is used for this check.\n\nThe implementation will follow these principles, using `numpy` for linear algebra and managing floating-point comparisons carefully.", "answer": "[[False, 0.000000, 0.000000], [True, 0.165486, 0.000000], [True, -0.421731, 0.000000], [False, 0.000000, -0.000000]]", "id": "3445110"}]}