{"hands_on_practices": [{"introduction": "In Born-Oppenheimer Molecular Dynamics (BOMD), we simulate the motion of nuclei as classical particles on a potential energy surface generated by the quantum-mechanical electrons. A fundamental challenge in any molecular dynamics simulation is choosing a stable integration time step. This exercise reveals the deep connection between the properties of the Born-Oppenheimer surface and the practical limits of simulation, showing how the highest vibrational frequencies of the system dictate the maximum stable time step [@problem_id:3452102].", "problem": "Consider Born-Oppenheimer Molecular Dynamics (BOMD), in which the nuclei move on an electronic potential energy surface computed at fixed nuclear configuration. The nuclear equations of motion are taken as Newton’s second law for the nuclei on the Born-Oppenheimer surface. Assume the system is near a stable equilibrium configuration so that the electronic potential can be locally approximated as harmonic. Investigate how mass-weighting of nuclear coordinates reveals the stability-limiting vibrational modes and how uniform mass scaling modifies the stability of a second-order explicit time discretization.\n\nStarting from Newton’s second law for the nuclei on a harmonic potential, perform the following:\n\n- Derive the linearized equations of motion near equilibrium in terms of the displacement vector and the mass matrix.\n- Introduce mass-weighted coordinates and show that the dynamics decouple into independent harmonic modes characterized by angular frequencies given by the square roots of the eigenvalues of the mass-weighted Hessian.\n- Using a second-order explicit central-difference time discretization of the decoupled harmonic modes, perform a linear stability analysis to derive a criterion that links the maximum stable timestep to the highest angular vibrational frequency.\n- Consider a uniform mass scaling in BOMD where all nuclear masses are multiplied by a positive factor $s$. Derive how the maximum stable timestep changes under this scaling.\n\nFinally, evaluate the maximum stable timestep for a triatomic system whose highest angular vibrational frequency is $\\omega_{\\max} = 4.0 \\times 10^{14} \\ \\text{s}^{-1}$ when a uniform mass scaling factor $s = 3.0$ is applied. Express the final timestep in femtoseconds (fs) and round your answer to four significant figures.", "solution": "The fundamental base is Newton’s second law applied to the nuclei moving on the electronic Born-Oppenheimer surface. Near a stable equilibrium configuration at position $\\mathbf{x}_{0}$, the potential energy surface $V(\\mathbf{x})$ can be approximated by a quadratic (harmonic) form. Let $\\mathbf{u}(t) = \\mathbf{x}(t) - \\mathbf{x}_{0}$ be the displacement from equilibrium. The Taylor expansion around $\\mathbf{x}_{0}$ gives\n$$\nV(\\mathbf{x}) \\approx V(\\mathbf{x}_{0}) + \\frac{1}{2} \\mathbf{u}^{\\top} \\mathbf{K} \\mathbf{u},\n$$\nwhere $\\mathbf{K}$ is the Hessian (matrix of second derivatives) of $V$ evaluated at $\\mathbf{x}_{0}$, and we neglect linear terms because the gradient vanishes at equilibrium. The nuclear equations of motion, by Newton’s second law, are\n$$\n\\mathbf{M} \\ddot{\\mathbf{x}}(t) = - \\nabla V(\\mathbf{x}(t)),\n$$\nwhere $\\mathbf{M}$ is the diagonal mass matrix of nuclei and dots denote time derivatives. In terms of the displacement, this becomes\n$$\n\\mathbf{M} \\ddot{\\mathbf{u}}(t) + \\mathbf{K} \\mathbf{u}(t) = \\mathbf{0}.\n$$\n\nTo analyze the vibrational modes cleanly, introduce mass-weighted coordinates. Define\n$$\n\\mathbf{Q}(t) = \\mathbf{M}^{1/2} \\mathbf{u}(t),\n$$\nwhere $\\mathbf{M}^{1/2}$ is the diagonal matrix whose entries are the square roots of the nuclear masses. Differentiate twice with respect to time:\n$$\n\\ddot{\\mathbf{Q}}(t) = \\mathbf{M}^{1/2} \\ddot{\\mathbf{u}}(t).\n$$\nSubstitute $\\ddot{\\mathbf{u}}(t)$ from the equation of motion:\n$$\n\\ddot{\\mathbf{Q}}(t) = - \\mathbf{M}^{1/2} \\mathbf{M}^{-1} \\mathbf{K} \\mathbf{u}(t) = - \\mathbf{M}^{-1/2} \\mathbf{K} \\mathbf{M}^{-1/2} \\mathbf{Q}(t).\n$$\nDefine the mass-weighted Hessian\n$$\n\\mathbf{A} = \\mathbf{M}^{-1/2} \\mathbf{K} \\mathbf{M}^{-1/2}.\n$$\nThen the equation of motion in mass-weighted coordinates is\n$$\n\\ddot{\\mathbf{Q}}(t) + \\mathbf{A} \\mathbf{Q}(t) = \\mathbf{0}.\n$$\n\nBecause $\\mathbf{A}$ is real symmetric and positive definite near a stable equilibrium, it admits an orthogonal eigendecomposition\n$$\n\\mathbf{A} = \\mathbf{S} \\boldsymbol{\\Lambda} \\mathbf{S}^{\\top},\n$$\nwhere $\\mathbf{S}$ is orthogonal and $\\boldsymbol{\\Lambda} = \\mathrm{diag}(\\lambda_{1}, \\ldots, \\lambda_{3N})$ is the diagonal matrix of eigenvalues. Transform to normal-mode coordinates $\\mathbf{y}(t) = \\mathbf{S}^{\\top} \\mathbf{Q}(t)$, yielding decoupled scalar equations\n$$\n\\ddot{y}_{k}(t) + \\lambda_{k} y_{k}(t) = 0, \\quad k = 1, \\ldots, 3N.\n$$\nEach mode is a simple harmonic oscillator with angular frequency\n$$\n\\omega_{k} = \\sqrt{\\lambda_{k}}.\n$$\nThe highest angular vibrational frequency is $\\omega_{\\max} = \\max_{k} \\omega_{k} = \\sqrt{\\lambda_{\\max}}$, where $\\lambda_{\\max}$ is the largest eigenvalue of $\\mathbf{A}$.\n\nNext, discretize time using a second-order explicit central-difference scheme (the second derivative approximated by the central difference). For a mode $y_{k}(t)$ sampled at times $t_{n} = t_{0} + n \\Delta t$, denote $y_{k,n} = y_{k}(t_{n})$. The central-difference approximation to the second derivative is\n$$\n\\ddot{y}_{k}(t_{n}) \\approx \\frac{y_{k,n+1} - 2 y_{k,n} + y_{k,n-1}}{\\Delta t^{2}}.\n$$\nThe discrete equation becomes\n$$\n\\frac{y_{k,n+1} - 2 y_{k,n} + y_{k,n-1}}{\\Delta t^{2}} + \\lambda_{k} y_{k,n} = 0,\n$$\nor equivalently\n$$\ny_{k,n+1} - 2 y_{k,n} + y_{k,n-1} + \\Delta t^{2} \\lambda_{k} y_{k,n} = 0.\n$$\n\nPerform a linear stability (von Neumann) analysis by seeking solutions of the form $y_{k,n} = r^{n}$ with constant $r \\in \\mathbb{C}$. Substituting gives the characteristic equation\n$$\nr^{2} - \\left(2 - \\Delta t^{2} \\lambda_{k}\\right) r + 1 = 0.\n$$\nDivide by $r$ (assuming $r \\neq 0$) to write\n$$\nr + \\frac{1}{r} = 2 - \\Delta t^{2} \\lambda_{k}.\n$$\nStability of the explicit central-difference scheme for oscillatory solutions requires $|r| = 1$, i.e., $r = \\exp(\\mathrm{i} \\theta)$ for some real $\\theta$, which implies\n$$\nr + \\frac{1}{r} = 2 \\cos \\theta \\in [-2, 2].\n$$\nTherefore, a necessary and sufficient stability condition is\n$$\n-2 \\leq 2 - \\Delta t^{2} \\lambda_{k} \\leq 2,\n$$\nwhich reduces to\n$$\n0 \\leq \\Delta t^{2} \\lambda_{k} \\leq 4.\n$$\nFor the upper bound, this yields\n$$\n\\Delta t \\leq \\frac{2}{\\sqrt{\\lambda_{k}}} = \\frac{2}{\\omega_{k}}.\n$$\nTo ensure stability for all modes, the timestep must satisfy\n$$\n\\Delta t \\leq \\frac{2}{\\sqrt{\\lambda_{\\max}}} = \\frac{2}{\\omega_{\\max}}.\n$$\nThis is the criterion that links the maximum stable timestep to the highest angular vibrational frequency.\n\nNow consider uniform mass scaling in BOMD, where each nuclear mass is multiplied by a factor $s > 0$. Let $\\mathbf{M}' = s \\mathbf{M}$. The scaled mass-weighted Hessian is\n$$\n\\mathbf{A}' = \\mathbf{M}'^{-1/2} \\mathbf{K} \\mathbf{M}'^{-1/2} = \\left(s \\mathbf{M}\\right)^{-1/2} \\mathbf{K} \\left(s \\mathbf{M}\\right)^{-1/2} = \\frac{1}{s} \\mathbf{M}^{-1/2} \\mathbf{K} \\mathbf{M}^{-1/2} = \\frac{1}{s} \\mathbf{A}.\n$$\nTherefore, the eigenvalues scale as $\\lambda'_{k} = \\lambda_{k} / s$, and the angular frequencies scale as\n$$\n\\omega'_{k} = \\sqrt{\\lambda'_{k}} = \\frac{1}{\\sqrt{s}} \\sqrt{\\lambda_{k}} = \\frac{\\omega_{k}}{\\sqrt{s}}.\n$$\nConsequently, the maximum stable timestep under uniform mass scaling becomes\n$$\n\\Delta t'_{\\max} = \\frac{2}{\\omega'_{\\max}} = \\frac{2}{\\omega_{\\max}/\\sqrt{s}} = \\frac{2 \\sqrt{s}}{\\omega_{\\max}}.\n$$\n\nFinally, evaluate the numerical value for the given system with $\\omega_{\\max} = 4.0 \\times 10^{14} \\ \\text{s}^{-1}$ and $s = 3.0$:\n$$\n\\Delta t'_{\\max} = \\frac{2 \\sqrt{3.0}}{4.0 \\times 10^{14}} \\ \\text{s} = \\frac{\\sqrt{3.0}}{2} \\times 10^{-14} \\ \\text{s}.\n$$\nCompute $\\sqrt{3.0}$ symbolically first, then numerically for the final evaluation:\n$$\n\\sqrt{3.0} \\approx 1.7320508075688772,\n$$\nso\n$$\n\\Delta t'_{\\max} \\approx 0.8660254037844386 \\times 10^{-14} \\ \\text{s} = 8.660254037844386 \\times 10^{-15} \\ \\text{s}.\n$$\nConverting seconds to femtoseconds using $1 \\ \\text{fs} = 10^{-15} \\ \\text{s}$ gives\n$$\n\\Delta t'_{\\max} \\approx 8.660254037844386 \\ \\text{fs}.\n$$\nRounded to four significant figures, the maximum stable timestep is\n$$\n8.660 \\ \\text{fs}.\n$$", "answer": "$$\\boxed{8.660}$$", "id": "3452102"}, {"introduction": "The idealized Born-Oppenheimer surface is a mathematical construct; in practice, we compute it using approximate methods like Density Functional Theory with finite basis sets. This exercise tackles a critical numerical artifact known as Pulay stress, which arises because the basis functions themselves move with the atoms, introducing an artificial pressure. By modeling this effect, you will see how it impacts the prediction of equilibrium crystal structures and learn how to design a convergence protocol to approach the true Born-Oppenheimer limit [@problem_id:3493219].", "problem": "You are tasked with quantifying how basis-set incompleteness (Pulay stress) alters the equilibrium lattice parameter under the Born-Oppenheimer approximation and designing a computational protocol that produces Born-Oppenheimer-consistent cell optimizations. Consider an isotropic cubic crystal whose Born-Oppenheimer potential energy as a function of volume is locally harmonic near the equilibrium volume. The nuclear degrees of freedom are treated classically on the Born-Oppenheimer energy surface, and you adopt the following physically grounded model.\n\nFundamental base:\n- Under the Born-Oppenheimer approximation, the electronic ground-state energy for fixed nuclear positions defines the potential energy surface $E_{\\mathrm{BO}}(\\mathbf{R})$. For isotropic compression/expansion parametrized by the volume $V$, the local expansion near the equilibrium volume $V_0$ can be approximated by a quadratic form with bulk modulus $B$. The associated thermodynamic pressure is $p_{\\mathrm{true}}(V) = -\\partial E_{\\mathrm{true}}(V)/\\partial V$.\n- In cell optimizations using an incomplete basis, the Hellmann-Feynman stress is no longer exact due to basis set dependence on the cell; this gives rise to a Pulay stress. In this problem, you model the basis-set contribution to the energy as $\\Delta E_{\\mathrm{basis}}(V; E_{\\mathrm{cut}}) = \\beta(E_{\\mathrm{cut}})\\, V$, where $E_{\\mathrm{cut}}$ is the plane-wave kinetic energy cutoff and $\\beta(E_{\\mathrm{cut}}) = c/E_{\\mathrm{cut}}^q$ with known constants $c>0$ and $q>0$. The Pulay stress is then $p_{\\mathrm{Pulay}} = -\\partial \\Delta E_{\\mathrm{basis}}/\\partial V = -\\beta(E_{\\mathrm{cut}})$.\n- The equilibrium lattice parameter is obtained by minimizing the enthalpy at zero external pressure, which in this simplified setting is equivalent to solving $p_{\\mathrm{true}}(V) + p_{\\mathrm{Pulay}} = 0$ for the equilibrium volume $V^\\star$, and converting $V^\\star$ to the cubic lattice parameter $a^\\star$ via $a^\\star = (V^\\star)^{1/3}$.\n\nYour program must:\n1. Starting only from the above principles, derive the equilibrium condition for $V^\\star$ and the corresponding $a^\\star(E_{\\mathrm{cut}})$, given $a_0$ (the Born-Oppenheimer equilibrium lattice parameter at infinite cutoff), $B$ (bulk modulus), $c$, and $q$. Use physically consistent units: lattice parameter $a$ in ångströms ($\\mathrm{\\AA}$), volume $V$ in $\\mathrm{\\AA}^3$, bulk modulus $B$ in $\\mathrm{eV}/\\mathrm{\\AA}^3$, energy cutoff $E_{\\mathrm{cut}}$ in Rydberg ($\\mathrm{Ry}$), and $\\beta$ in $\\mathrm{eV}/\\mathrm{\\AA}^3$.\n2. Implement a basis-convergence protocol that, for each test case:\n   - Computes the list of predicted lattice parameters $a^\\star(E_{\\mathrm{cut},i})$ in $\\mathrm{\\AA}$ for a provided set of cutoff values $\\{E_{\\mathrm{cut},i}\\}$.\n   - Determines the minimum cutoff $E_{\\mathrm{cut}}^{\\mathrm{min}}$ (in $\\mathrm{Ry}$) such that $\\lvert a^\\star(E_{\\mathrm{cut}}) - a_0 \\rvert \\le \\tau_a$ for a given tolerance $\\tau_a$ (in $\\mathrm{\\AA}$). Use a numerically robust method that does not assume linearity beyond the justified model.\n   - Performs a two-point extrapolation to estimate the infinite-cutoff lattice parameter $a_\\infty$ from two cutoff values $E_1$ and $E_2$ and the known exponent $q$, by assuming the leading-order dependence of $a^\\star$ on $E_{\\mathrm{cut}}^{-q}$ near large $E_{\\mathrm{cut}}$.\n   - Returns a boolean indicating whether $\\lvert a_\\infty - a_0 \\rvert \\le \\tau_a$ holds.\n\nTest suite:\n- Use the following four test cases, each specified by $(a_0, B, c, q, \\{E_{\\mathrm{cut},i}\\}, \\tau_a)$:\n  - Case A (typical metal): $(a_0=$ $3.6$ $\\mathrm{\\AA}$, $B=$ $0.5$ $\\mathrm{eV}/\\mathrm{\\AA}^3$, $c=$ $0.05$ $\\mathrm{eV}/\\mathrm{\\AA}^3 \\cdot \\mathrm{Ry}^q$, $q=$ $2$, $\\{E_{\\mathrm{cut},i}\\}=$ $\\{30, 40, 60\\}$ $\\mathrm{Ry}$, $\\tau_a=$ $0.001$ $\\mathrm{\\AA})$.\n  - Case B (soft solid): $(a_0=$ $4.5$ $\\mathrm{\\AA}$, $B=$ $0.1$ $\\mathrm{eV}/\\mathrm{\\AA}^3$, $c=$ $0.05$ $\\mathrm{eV}/\\mathrm{\\AA}^3 \\cdot \\mathrm{Ry}^q$, $q=$ $2$, $\\{E_{\\mathrm{cut},i}\\}=$ $\\{30, 40, 60\\}$ $\\mathrm{Ry}$, $\\tau_a=$ $0.001$ $\\mathrm{\\AA})$.\n  - Case C (slowly convergent basis): $(a_0=$ $3.0$ $\\mathrm{\\AA}$, $B=$ $0.4$ $\\mathrm{eV}/\\mathrm{\\AA}^3$, $c=$ $0.5$ $\\mathrm{eV}/\\mathrm{\\AA}^3 \\cdot \\mathrm{Ry}^q$, $q=$ $1$, $\\{E_{\\mathrm{cut},i}\\}=$ $\\{20, 30, 50\\}$ $\\mathrm{Ry}$, $\\tau_a=$ $0.0005$ $\\mathrm{\\AA})$.\n  - Case D (rapidly convergent basis): $(a_0=$ $2.5$ $\\mathrm{\\AA}$, $B=$ $0.7$ $\\mathrm{eV}/\\mathrm{\\AA}^3$, $c=$ $0.5$ $\\mathrm{eV}/\\mathrm{\\AA}^3 \\cdot \\mathrm{Ry}^q$, $q=$ $3$, $\\{E_{\\mathrm{cut},i}\\}=$ $\\{15, 25, 35\\}$ $\\mathrm{Ry}$, $\\tau_a=$ $0.0002$ $\\mathrm{\\AA})$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output a list of four items: the list of predicted $a^\\star$ values in $\\mathrm{\\AA}$ for the provided cutoffs, the minimum cutoff $E_{\\mathrm{cut}}^{\\mathrm{min}}$ in $\\mathrm{Ry}$ satisfying the tolerance, the extrapolated $a_\\infty$ in $\\mathrm{\\AA}$ from the first and last provided cutoffs, and the boolean flag indicating whether $\\lvert a_\\infty - a_0 \\rvert \\le \\tau_a$. Concretely, the final line must look like\n$[[$ $a^\\star_{A,1}$ $,$ $a^\\star_{A,2}$ $,$ $a^\\star_{A,3}$ $]$ $,$ $E_{\\mathrm{cut},A}^{\\mathrm{min}}$ $,$ $a_{\\infty,A}$ $,$ $\\mathrm{bool}_A$ $,$ $[[$ $a^\\star_{B,1}$ $,$ $a^\\star_{B,2}$ $,$ $a^\\star_{B,3}$ $]$ $,$ $E_{\\mathrm{cut},B}^{\\mathrm{min}}$ $,$ $a_{\\infty,B}$ $,$ $\\mathrm{bool}_B$ $,$ $[[$ $a^\\star_{C,1}$ $,$ $a^\\star_{C,2}$ $,$ $a^\\star_{C,3}$ $]$ $,$ $E_{\\mathrm{cut},C}^{\\mathrm{min}}$ $,$ $a_{\\infty,C}$ $,$ $\\mathrm{bool}_C$ $,$ $[[$ $a^\\star_{D,1}$ $,$ $a^\\star_{D,2}$ $,$ $a^\\star_{D,3}$ $]$ $,$ $E_{\\mathrm{cut},D}^{\\mathrm{min}}$ $,$ $a_{\\infty,D}$ $,$ $\\mathrm{bool}_D$ $]$.", "solution": "The Born-Oppenheimer (BO) approximation separates electronic and nuclear motion, defining an electronic ground-state energy $E_{\\mathrm{BO}}(\\mathbf{R})$ as a function of nuclear coordinates $\\mathbf{R}$. For an isotropic cubic cell with volume $V$ near the BO equilibrium $V_0$, a well-tested local description is the harmonic approximation for the true energy,\n$$\nE_{\\mathrm{true}}(V) \\approx E_0 + \\frac{B}{2V_0}\\,(V - V_0)^2,\n$$\nwith bulk modulus $B$ (in $\\mathrm{eV}/\\mathrm{\\AA}^3$). The true pressure follows from thermodynamics,\n$$\np_{\\mathrm{true}}(V) \\equiv -\\frac{\\partial E_{\\mathrm{true}}}{\\partial V} = -\\frac{B}{V_0}\\,(V - V_0).\n$$\nIn an incomplete basis, an additional basis-dependent energy contribution arises. We model it as\n$$\n\\Delta E_{\\mathrm{basis}}(V; E_{\\mathrm{cut}}) = \\beta(E_{\\mathrm{cut}})\\,V, \\quad \\beta(E_{\\mathrm{cut}}) = \\frac{c}{E_{\\mathrm{cut}}^{q}},\n$$\nwith $c>0$ and $q>0$. The associated Pulay stress is the negative derivative of $\\Delta E_{\\mathrm{basis}}$ with respect to $V$,\n$$\np_{\\mathrm{Pulay}} = -\\frac{\\partial \\Delta E_{\\mathrm{basis}}}{\\partial V} = -\\beta(E_{\\mathrm{cut}}) = -\\frac{c}{E_{\\mathrm{cut}}^{q}}.\n$$\nAt zero external pressure, the equilibrium condition combines the true and Pulay contributions,\n$$\np_{\\mathrm{true}}(V^\\star) + p_{\\mathrm{Pulay}} = 0 \\quad \\Rightarrow \\quad -\\frac{B}{V_0}\\,(V^\\star - V_0) - \\beta(E_{\\mathrm{cut}}) = 0.\n$$\nSolving for the equilibrium volume gives\n$$\nV^\\star = V_0\\left(1 - \\frac{\\beta(E_{\\mathrm{cut}})}{B}\\right) = V_0\\left(1 - \\frac{c}{B\\,E_{\\mathrm{cut}}^{q}}\\right).\n$$\nFor a cubic cell, the lattice parameter is related to the volume by $a = V^{1/3}$. Therefore, the predicted lattice parameter at cutoff $E_{\\mathrm{cut}}$ is\n$$\na^\\star(E_{\\mathrm{cut}}) = \\big(V^\\star\\big)^{1/3} = a_0\\left(1 - \\frac{c}{B\\,E_{\\mathrm{cut}}^{q}}\\right)^{1/3},\n$$\nwhere $a_0 = V_0^{1/3}$ is the BO-consistent lattice parameter obtained as $E_{\\mathrm{cut}}\\to\\infty$. This expression is physically sound provided $\\beta(E_{\\mathrm{cut}}) < B$, ensuring $V^\\star>0$ and avoiding an unphysical collapse.\n\nFor the basis-convergence protocol, we design three components:\n\n1. Direct evaluation of $a^\\star(E_{\\mathrm{cut},i})$: Using the exact expression above, compute $a^\\star$ for each test cutoff $E_{\\mathrm{cut},i}$, returning values in $\\mathrm{\\AA}$.\n\n2. Minimum cutoff $E_{\\mathrm{cut}}^{\\mathrm{min}}$ for tolerance $\\tau_a$: We seek the smallest $E_{\\mathrm{cut}}$ such that $\\lvert a^\\star(E_{\\mathrm{cut}}) - a_0 \\rvert \\le \\tau_a$. Define the monotone decreasing error function\n$$\n\\mathrm{err}(E_{\\mathrm{cut}}) \\equiv \\left|a^\\star(E_{\\mathrm{cut}}) - a_0\\right| - \\tau_a = a_0\\left[\\left(1 - \\frac{c}{B\\,E_{\\mathrm{cut}}^{q}}\\right)^{1/3} - 1\\right]_{\\text{absolute}} - \\tau_a,\n$$\nnoting that the bracketed term is negative for $c>0$, so its magnitude decreases with increasing $E_{\\mathrm{cut}}$. We locate the threshold with a bracketing-and-bisection method:\n- Start from a lower bound $E_{\\mathrm{low}}$ (e.g., $E_{\\mathrm{low}}=$ $1$ $\\mathrm{Ry}$). If $c=0$, then $\\mathrm{err}(E_{\\mathrm{low}})=-\\tau_a$, and any cutoff satisfies the tolerance; return $E_{\\mathrm{low}}$ as the minimal practical value.\n- Otherwise, increase an upper bound $E_{\\mathrm{high}}$ by successive doubling until $\\mathrm{err}(E_{\\mathrm{high}})\\le 0$, guaranteeing the existence of a solution in $[E_{\\mathrm{low}}, E_{\\mathrm{high}}]$.\n- Apply bisection on $[E_{\\mathrm{low}}, E_{\\mathrm{high}}]$ to find the minimal $E_{\\mathrm{cut}}$ such that $\\mathrm{err}(E_{\\mathrm{cut}})\\le 0$ within a chosen numerical tolerance. Because $\\mathrm{err}$ decreases monotonically, bisection converges rapidly and robustly.\n\n3. Two-point extrapolation for $a_\\infty$: For large $E_{\\mathrm{cut}}$, a first-order binomial expansion gives\n$$\na^\\star(E_{\\mathrm{cut}}) = a_0\\left(1 - \\frac{c}{B\\,E_{\\mathrm{cut}}^{q}}\\right)^{1/3} \\approx a_0\\left[1 - \\frac{1}{3}\\frac{c}{B}\\,E_{\\mathrm{cut}}^{-q}\\right] = a_0 - K\\,E_{\\mathrm{cut}}^{-q},\n$$\nwith $K = \\frac{a_0}{3}\\frac{c}{B}$. This linear dependence on $x = E_{\\mathrm{cut}}^{-q}$ allows a two-point extrapolation to $x=0$. Given two cutoffs $E_1$ and $E_2$ with corresponding $y_1 = a^\\star(E_1)$ and $y_2 = a^\\star(E_2)$, and $x_1 = E_1^{-q}$, $x_2 = E_2^{-q}$, the line through $(x_1,y_1)$ and $(x_2,y_2)$ has slope $m = (y_2 - y_1)/(x_2 - x_1)$ and intercept at $x=0$ equal to\n$$\na_\\infty \\approx y_1 - m\\,x_1 = y_1 - \\frac{y_2 - y_1}{x_2 - x_1}\\,x_1.\n$$\nWe then test $\\lvert a_\\infty - a_0 \\rvert \\le \\tau_a$ to assess BO-consistency within the specified tolerance.\n\nEdge cases and scientific realism:\n- The condition $\\beta(E_{\\mathrm{cut}}) < B$ is required to maintain physical volumes and avoid singular behavior. The test suite values satisfy this for the provided cutoffs.\n- The bisection protocol guarantees an answer even in regimes of slow convergence (small $q$ or large $c$), reflecting realistic scenarios in computational materials science where Pulay stress can be significant.\n- The use of $B$ in $\\mathrm{eV}/\\mathrm{\\AA}^3$ ensures consistency with the energy model; for reference, $1$ $\\mathrm{eV}/\\mathrm{\\AA}^3 \\approx 160.21766208$ $\\mathrm{GPa}$, but the program operates purely with the specified units.\n\nAlgorithmic steps for the implementation:\n- For each test case $(a_0, B, c, q, \\{E_{\\mathrm{cut},i}\\}, \\tau_a)$:\n  1. Compute $V_0 = a_0^3$ and, for each $E_{\\mathrm{cut},i}$, $\\beta_i = c/E_{\\mathrm{cut},i}^q$, $V^\\star_i = V_0(1 - \\beta_i/B)$, and $a^\\star_i = (V^\\star_i)^{1/3}$.\n  2. Find $E_{\\mathrm{cut}}^{\\mathrm{min}}$ by bracketing and bisection as above with the exact expression for $a^\\star(E_{\\mathrm{cut}})$.\n  3. Compute $a_\\infty$ from the first and last cutoffs using the two-point extrapolation aligned with the leading-order dependence on $E_{\\mathrm{cut}}^{-q}$.\n  4. Return the tuple of results: list of $a^\\star_i$, $E_{\\mathrm{cut}}^{\\mathrm{min}}$, $a_\\infty$, and the boolean test $\\lvert a_\\infty - a_0 \\rvert \\le \\tau_a$.\n\nThe final program outputs a single-line Python list aggregating these results across the four test cases, as specified.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef predicted_lattice_parameter(a0, B, c, q, Ecut):\n    \"\"\"\n    Compute a*(Ecut) in Angstrom from the exact model:\n    V* = V0 * (1 - beta/B), beta = c / Ecut^q, a* = (V*)^(1/3), V0 = a0^3.\n    \"\"\"\n    V0 = a0 ** 3\n    beta = c / (Ecut ** q)\n    factor = 1.0 - (beta / B)\n    if factor <= 0.0:\n        # Unphysical; return NaN to indicate failure.\n        return np.nan\n    V_star = V0 * factor\n    a_star = V_star ** (1.0 / 3.0)\n    return a_star\n\ndef error_against_tolerance(a0, B, c, q, Ecut, tau_a):\n    \"\"\"\n    Error function: |a*(Ecut) - a0| - tau_a.\n    \"\"\"\n    a_star = predicted_lattice_parameter(a0, B, c, q, Ecut)\n    if np.isnan(a_star):\n        # Treat unphysical as large error\n        return np.inf\n    return abs(a_star - a0) - tau_a\n\ndef required_Ecut_for_tolerance(a0, B, c, q, tau_a, E_low_init=1.0, max_iter=200, tol=1e-12):\n    \"\"\"\n    Find minimal Ecut such that |a*(Ecut) - a0| <= tau_a.\n    Uses bracketing with doubling for upper bound and then bisection.\n    \"\"\"\n    # If c == 0, there is no Pulay stress; any Ecut satisfies tolerance.\n    if c == 0.0:\n        return E_low_init\n\n    # Establish lower bound\n    E_low = max(E_low_init, 1e-12)\n    err_low = error_against_tolerance(a0, B, c, q, E_low, tau_a)\n\n    # If already within tolerance at lower bound, return lower bound\n    if err_low <= 0.0:\n        return E_low\n\n    # Establish upper bound via doubling until within tolerance\n    E_high = E_low\n    for _ in range(max_iter):\n        E_high *= 2.0\n        err_high = error_against_tolerance(a0, B, c, q, E_high, tau_a)\n        if err_high <= 0.0:\n            break\n    else:\n        # Failed to bracket; return NaN\n        return np.nan\n\n    # Bisection to find minimal Ecut\n    # We seek the smallest Ecut such that err(Ecut) <= 0; err is monotone decreasing.\n    for _ in range(max_iter):\n        E_mid = 0.5 * (E_low + E_high)\n        err_mid = error_against_tolerance(a0, B, c, q, E_mid, tau_a)\n        # If within tolerance, move high bound down\n        if err_mid <= 0.0:\n            E_high = E_mid\n        else:\n            E_low = E_mid\n        if abs(E_high - E_low) <= tol * max(1.0, E_high):\n            break\n\n    return E_high\n\ndef extrapolate_a_infinite_two_point(a_E1, a_E2, E1, E2, q):\n    \"\"\"\n    Two-point extrapolation assuming a(E) ~ a0 - K * E^{-q}.\n    Intercept at x=0 where x = E^{-q}.\n    \"\"\"\n    x1 = E1 ** (-q)\n    x2 = E2 ** (-q)\n    # Avoid division by zero if E1 == E2 or q == 0 (q>0 by definition)\n    if x1 == x2:\n        return np.nan\n    m = (a_E2 - a_E1) / (x2 - x1)\n    a_inf = a_E1 - m * x1\n    return a_inf\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (a0 [Angstrom], B [eV/Angstrom^3], c [eV/Angstrom^3 * Ry^q], q, [Ecut list in Ry], tau_a [Angstrom])\n    test_cases = [\n        (3.6, 0.5, 0.05, 2, [30.0, 40.0, 60.0], 0.001),\n        (4.5, 0.1, 0.05, 2, [30.0, 40.0, 60.0], 0.001),\n        (3.0, 0.4, 0.5, 1, [20.0, 30.0, 50.0], 0.0005),\n        (2.5, 0.7, 0.5, 3, [15.0, 25.0, 35.0], 0.0002),\n    ]\n\n    results = []\n    for a0, B, c, q, Ecuts, tau_a in test_cases:\n        # Predicted lattice parameters at specified cutoffs\n        a_stars = [predicted_lattice_parameter(a0, B, c, q, E) for E in Ecuts]\n\n        # Minimum cutoff for tolerance\n        E_min = required_Ecut_for_tolerance(a0, B, c, q, tau_a)\n\n        # Two-point extrapolation using first and last cutoffs\n        a_E1 = a_stars[0]\n        a_E2 = a_stars[-1]\n        E1 = Ecuts[0]\n        E2 = Ecuts[-1]\n        a_inf = extrapolate_a_infinite_two_point(a_E1, a_E2, E1, E2, q)\n\n        # BO-consistency check within tolerance\n        within_tol = (not np.isnan(a_inf)) and (abs(a_inf - a0) <= tau_a)\n\n        # Append results: [list_of_a_stars, E_min, a_inf, within_tol]\n        results.append([a_stars, E_min, a_inf, within_tol])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3493219"}, {"introduction": "The Born-Oppenheimer approximation is foundational, but it fails dramatically when two or more electronic potential energy surfaces approach or cross each other. This exercise introduces the canonical model for such a scenario: the conical intersection, described by the linear vibronic coupling model. You will analytically derive the nonadiabatic coupling vector, the mathematical object that governs radiationless transitions between electronic states and quantifies the breakdown of the Born-Oppenheimer separation [@problem_id:3493269].", "problem": "Consider a two-state Linear Vibronic Coupling (LVC) model for a molecular subsystem near a conical intersection in mass-weighted normal coordinates. Let the nuclear coordinates be $x$ (tuning mode) and $y$ (coupling mode), with nuclear kinetic energy operator $T_{\\mathrm{nuc}}=-\\frac{1}{2}\\left(\\frac{\\partial^{2}}{\\partial x^{2}}+\\frac{\\partial^{2}}{\\partial y^{2}}\\right)$. The diabatic electronic Hamiltonian acting on the two electronic diabatic basis states $|1\\rangle$ and $|2\\rangle$ is\n$$\n\\hat{H}_{\\mathrm{dia}}(x,y)=\\frac{1}{2}\\left(\\omega_{x}^{2}x^{2}+\\omega_{y}^{2}y^{2}\\right)\\hat{I}+\\begin{pmatrix}a\\,x & c\\,y \\\\ c\\,y & -a\\,x\\end{pmatrix},\n$$\nwhere $\\hat{I}$ is the $2\\times 2$ identity operator, and $a>0$, $c>0$ are real constants parameterizing the linear diabatic energy difference ($a\\,x$) and the diabatic interstate coupling ($c\\,y$). The conical intersection occurs at the origin $x=0$, $y=0$.\n\nStarting from the time-independent electronic Schrödinger equation at fixed nuclear coordinates and the Born-Huang expansion associated with the Born-Oppenheimer (BO) approximation, derive the adiabatic electronic states and compute the vector nonadiabatic derivative coupling between the two adiabatic electronic states, defined as $\\mathbf{d}_{12}(x,y)=\\langle\\phi_{1}(x,y)|\\boldsymbol{\\nabla}_{(x,y)}\\phi_{2}(x,y)\\rangle$, where $\\boldsymbol{\\nabla}_{(x,y)}=(\\partial/\\partial x,\\,\\partial/\\partial y)$ and $|\\phi_{1}\\rangle$, $|\\phi_{2}\\rangle$ are the orthonormal adiabatic electronic eigenstates of the $2\\times 2$ electronic Hamiltonian at $(x,y)$. Using these, determine:\n\n- The nonadiabatic coupling strength near the conical intersection, taken as the magnitude $|\\mathbf{d}_{12}(x,y)|$.\n- The leading correction to BO nuclear motion quantified by the Diagonal Born-Oppenheimer Correction (DBOC), defined as the scalar potential that arises from the nuclear kinetic energy operator acting on the electronic basis along a single adiabatic surface.\n\nYour final answer must be two closed-form analytic expressions in terms of $a$, $c$, $x$, and $y$: first $|\\mathbf{d}_{12}(x,y)|$ and second the DBOC on the lower adiabatic surface. Express the nonadiabatic coupling strength in reciprocal mass-weighted coordinate units and the DBOC in the same energy units as the Hamiltonian. No numerical evaluation is required, and no rounding is needed. Provide only the requested expressions in the final answer.", "solution": "The fundamental base is the time-independent electronic Schrödinger equation at fixed nuclear coordinates and the Born-Huang expansion underlying the Born-Oppenheimer (BO) approximation. At fixed $(x,y)$, the electronic Hamiltonian is the $2\\times 2$ matrix\n$$\n\\hat{H}_{\\mathrm{el}}(x,y)=\\frac{1}{2}\\left(\\omega_{x}^{2}x^{2}+\\omega_{y}^{2}y^{2}\\right)\\hat{I}+\\begin{pmatrix}a\\,x & c\\,y \\\\ c\\,y & -a\\,x\\end{pmatrix}.\n$$\nThe identity term only shifts both adiabatic energies equally and has no effect on the adiabatic electronic eigenvectors or on their derivatives with respect to nuclear coordinates, so we focus on\n$$\n\\hat{h}(x,y)=\\begin{pmatrix}a\\,x & c\\,y \\\\ c\\,y & -a\\,x\\end{pmatrix}.\n$$\nThis real symmetric matrix can be diagonalized by a rotation in the diabatic basis. Define the adiabatic electronic eigenstates $|\\phi_{+}\\rangle$ and $|\\phi_{-}\\rangle$ (upper and lower adiabatic states) via a mixing angle $\\theta(x,y)$:\n$$\n|\\phi_{+}\\rangle=\\cos\\theta\\,|1\\rangle+\\sin\\theta\\,|2\\rangle,\\qquad\n|\\phi_{-}\\rangle=-\\sin\\theta\\,|1\\rangle+\\cos\\theta\\,|2\\rangle.\n$$\nThe mixing angle is determined by the condition that the off-diagonal elements vanish in the rotated basis. For a general $2\\times 2$ real symmetric matrix $\\begin{pmatrix}\\Delta/2 & W \\\\ W & -\\Delta/2\\end{pmatrix}$, the diagonalization angle satisfies $\\tan(2\\theta)=2W/\\Delta$. In the present case, $\\Delta=2a\\,x$ and $W=c\\,y$, so\n$$\n\\tan(2\\theta)=\\frac{2\\,c\\,y}{2\\,a\\,x}=\\frac{c\\,y}{a\\,x}.\n$$\nThus,\n$$\n2\\theta(x,y)=\\arctan\\!\\left(\\frac{c\\,y}{a\\,x}\\right),\\qquad \\theta(x,y)=\\frac{1}{2}\\arctan\\!\\left(\\frac{c\\,y}{a\\,x}\\right).\n$$\n\nThe nonadiabatic derivative coupling vector between the two adiabatic electronic states is defined by\n$$\n\\mathbf{d}_{+-}(x,y)\\equiv\\langle\\phi_{+}(x,y)|\\boldsymbol{\\nabla}_{(x,y)}\\phi_{-}(x,y)\\rangle.\n$$\nWith the chosen real gauge (real-valued adiabatic eigenvectors), this vector reduces to the gradient of the mixing angle with a sign that depends on labeling; in particular,\n$$\n\\mathbf{d}_{+-}(x,y)=-\\boldsymbol{\\nabla}\\theta(x,y),\\qquad \\mathbf{d}_{-+}(x,y)=\\boldsymbol{\\nabla}\\theta(x,y).\n$$\nTherefore, the magnitude of the nonadiabatic coupling strength between the two adiabatic states is\n$$\n|\\mathbf{d}_{12}(x,y)|=|\\boldsymbol{\\nabla}\\theta(x,y)|.\n$$\nWe compute the gradient of $\\theta(x,y)=\\frac{1}{2}\\arctan\\!\\left(\\frac{c\\,y}{a\\,x}\\right)$. Introduce $k\\equiv \\frac{c}{a}$ and $u(x,y)\\equiv k\\frac{y}{x}$. Then\n$$\n\\theta(x,y)=\\frac{1}{2}\\arctan\\!\\big(u(x,y)\\big),\\qquad \\boldsymbol{\\nabla}\\theta=\\frac{1}{2}\\frac{1}{1+u^{2}}\\boldsymbol{\\nabla}u.\n$$\nBecause $u=k\\,y/x$, the partial derivatives are\n$$\n\\frac{\\partial u}{\\partial x}=-k\\,\\frac{y}{x^{2}},\\qquad \\frac{\\partial u}{\\partial y}=k\\,\\frac{1}{x}.\n$$\nNote that $1+u^{2}=1+\\frac{k^{2}y^{2}}{x^{2}}=\\frac{x^{2}+k^{2}y^{2}}{x^{2}}$. Therefore,\n$$\n\\frac{\\partial \\theta}{\\partial x}=\\frac{1}{2}\\left(\\frac{x^{2}}{x^{2}+k^{2}y^{2}}\\right)\\left(-k\\,\\frac{y}{x^{2}}\\right)\n=-\\frac{1}{2}\\frac{k\\,y}{x^{2}+k^{2}y^{2}},\n$$\n$$\n\\frac{\\partial \\theta}{\\partial y}=\\frac{1}{2}\\left(\\frac{x^{2}}{x^{2}+k^{2}y^{2}}\\right)\\left(k\\,\\frac{1}{x}\\right)\n=\\frac{1}{2}\\frac{k\\,x}{x^{2}+k^{2}y^{2}}.\n$$\nThus the gradient vector is\n$$\n\\boldsymbol{\\nabla}\\theta(x,y)=\\left(-\\frac{1}{2}\\frac{k\\,y}{x^{2}+k^{2}y^{2}},\\ \\frac{1}{2}\\frac{k\\,x}{x^{2}+k^{2}y^{2}}\\right).\n$$\nThe magnitude is\n$$\n|\\boldsymbol{\\nabla}\\theta(x,y)|=\\sqrt{\\left(\\frac{1}{2}\\frac{k\\,y}{x^{2}+k^{2}y^{2}}\\right)^{2}+\\left(\\frac{1}{2}\\frac{k\\,x}{x^{2}+k^{2}y^{2}}\\right)^{2}}\n=\\frac{1}{2}\\frac{k\\,\\sqrt{x^{2}+y^{2}}}{x^{2}+k^{2}y^{2}}.\n$$\nReturning to $k=\\frac{c}{a}$ and simplifying by eliminating the fraction in the denominator, multiply numerator and denominator by $a^{2}$:\n$$\n|\\mathbf{d}_{12}(x,y)|=|\\boldsymbol{\\nabla}\\theta(x,y)|\n=\\frac{1}{2}\\frac{\\frac{c}{a}\\sqrt{x^{2}+y^{2}}}{x^{2}+\\frac{c^{2}}{a^{2}}y^{2}}\n=\\frac{a\\,c}{2}\\frac{\\sqrt{x^{2}+y^{2}}}{a^{2}x^{2}+c^{2}y^{2}}.\n$$\n\nNext, we assess the leading correction to BO nuclear motion using the Diagonal Born-Oppenheimer Correction (DBOC). In the Born-Huang expansion, for a given adiabatic state $|\\phi_{n}\\rangle$, the nuclear kinetic energy operator acting on the electronic basis yields a scalar potential term\n$$\nU_{n}^{\\mathrm{DBOC}}(x,y)=\\frac{1}{2}\\sum_{\\alpha\\in\\{x,y\\}}\\left\\langle \\frac{\\partial \\phi_{n}}{\\partial q_{\\alpha}}\\middle|\\frac{\\partial \\phi_{n}}{\\partial q_{\\alpha}}\\right\\rangle,\n$$\nwhere mass-weighted normal coordinates imply unit masses in the kinetic energy and hence the prefactor $\\frac{1}{2}$ in each coordinate direction. Using completeness, and the fact that in a real gauge the diagonal derivative couplings vanish, this reduces for a two-state system to\n$$\nU_{-}^{\\mathrm{DBOC}}(x,y)=\\frac{1}{2}\\left(|d_{-+}^{x}|^{2}+|d_{-+}^{y}|^{2}\\right)=\\frac{1}{2}\\,|\\mathbf{d}_{-+}(x,y)|^{2}\n=\\frac{1}{2}\\,|\\boldsymbol{\\nabla}\\theta(x,y)|^{2}.\n$$\nTherefore,\n$$\nU_{-}^{\\mathrm{DBOC}}(x,y)=\\frac{1}{2}\\left(\\frac{a\\,c}{2}\\frac{\\sqrt{x^{2}+y^{2}}}{a^{2}x^{2}+c^{2}y^{2}}\\right)^{2}\n=\\frac{a^{2}c^{2}}{8}\\,\\frac{x^{2}+y^{2}}{\\left(a^{2}x^{2}+c^{2}y^{2}\\right)^{2}}.\n$$\n\nThese expressions display the characteristic $1/r$ divergence of the nonadiabatic coupling strength near the conical intersection and the corresponding $1/r^{2}$ behavior of the DBOC scalar potential in mass-weighted coordinates, where $r=\\sqrt{x^{2}+y^{2}}$. The requested outputs are the closed-form analytic expressions:\n$$\n|\\mathbf{d}_{12}(x,y)|=\\frac{a\\,c}{2}\\,\\frac{\\sqrt{x^{2}+y^{2}}}{a^{2}x^{2}+c^{2}y^{2}},\\qquad\nU_{-}^{\\mathrm{DBOC}}(x,y)=\\frac{a^{2}c^{2}}{8}\\,\\frac{x^{2}+y^{2}}{\\left(a^{2}x^{2}+c^{2}y^{2}\\right)^{2}}.\n$$\nThese are expressed in reciprocal mass-weighted coordinate units for the coupling strength and in the same energy units as the Hamiltonian for the DBOC.", "answer": "$$\\boxed{\\begin{pmatrix}\\frac{a\\,c}{2}\\,\\frac{\\sqrt{x^{2}+y^{2}}}{a^{2}x^{2}+c^{2}y^{2}} & \\frac{a^{2}c^{2}}{8}\\,\\frac{x^{2}+y^{2}}{\\left(a^{2}x^{2}+c^{2}y^{2}\\right)^{2}}\\end{pmatrix}}$$", "id": "3493269"}]}