{"hands_on_practices": [{"introduction": "The crucial first step in any quantum transport simulation is to properly model the interaction between the central device and the semi-infinite leads that act as electron reservoirs. This exercise contrasts the computationally convenient wide-band limit (WBL) approximation against an exact, energy-dependent lead self-energy [@problem_id:3482922]. By quantifying the error, especially near the band edges where van Hove singularities arise, you will develop a critical understanding of when the WBL is valid and when a more rigorous treatment of the lead broadening function $\\Gamma(E)$ is necessary.", "problem": "Consider a single-site device described by a Hamiltonian $H_\\mathrm{d} = [\\varepsilon_\\mathrm{d}]$ coupled to two semi-infinite one-dimensional tight-binding leads, labeled left ($L$) and right ($R$). Each lead is characterized by an on-site energy $\\varepsilon_0$ and a nearest-neighbor hopping parameter $t$, and the device couples to the terminal site of each lead via coupling amplitudes $\\tau_L$ and $\\tau_R$. Work within the framework of Non-Equilibrium Green's Functions (NEGF), beginning from the definitions of the retarded Green's function $G^r$, advanced Green's function $G^a$, self-energies $\\Sigma_\\alpha^r(E)$ with $\\alpha \\in \\{L,R\\}$, and coupling (broadening) functions $\\Gamma_\\alpha(E)$. Use the Landauer approach for coherent transport and the relationship between the transmission and the device and lead properties that follows from the NEGF formalism. \n\nYour tasks are:\n- Starting from the fundamental NEGF definitions and the equations that define lead self-energies for semi-infinite periodic systems, derive the exact energy-dependent surface Green's function of a semi-infinite one-dimensional tight-binding chain and hence obtain $\\Sigma_\\alpha^r(E)$ and $\\Gamma_\\alpha(E)$ for each lead.\n- Define the wide-band limit (WBL) approximation by replacing the energy-dependent coupling functions $\\Gamma_\\alpha(E)$ with constants $\\Gamma_{\\alpha,0}$ chosen by evaluating the exact $\\Gamma_\\alpha(E)$ at a reference energy $E_0$. In this problem, let $E_0 = 0\\,\\mathrm{eV}$.\n- Using NEGF, derive the transmission function through the single-site device, expressed in terms of $G^r$, $G^a$, and the coupling functions. Evaluate this transmission once using the exact semi-infinite tight-binding self-energies and once using the wide-band limit with $\\Gamma_{\\alpha,0}$ and no energy-dependent real shifts.\n- Quantify the error of the wide-band limit near the band edges, where van Hove singularities occur, by computing for each energy $E$ the error measure $\\Delta(E) = \\left|T_\\mathrm{WBL}(E) - T_\\mathrm{exact}(E)\\right| / \\max\\left(T_\\mathrm{exact}(E), \\epsilon_\\mathrm{reg}\\right)$, with a regularization constant $\\epsilon_\\mathrm{reg} = 10^{-12}$. Express all energies and couplings in $\\mathrm{eV}$.\n\nImplement the above in a program that computes the error measure $\\Delta(E)$ for the following test suite of parameter sets, which explores a general case, approach to the van Hove singularity at the band edge, outside the band, and a coupling boundary condition:\n\n- Case $1$ (general, band center): $(E, \\varepsilon_\\mathrm{d}, \\varepsilon_0, t, \\tau_L, \\tau_R) = (0.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 1.0\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV})$.\n- Case $2$ (near band edge): $(E, \\varepsilon_\\mathrm{d}, \\varepsilon_0, t, \\tau_L, \\tau_R) = (1.8\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 1.0\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV})$.\n- Case $3$ (closer to band edge): $(E, \\varepsilon_\\mathrm{d}, \\varepsilon_0, t, \\tau_L, \\tau_R) = (1.95\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 1.0\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV})$.\n- Case $4$ (approaching van Hove singularity): $(E, \\varepsilon_\\mathrm{d}, \\varepsilon_0, t, \\tau_L, \\tau_R) = (1.999\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 1.0\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV})$.\n- Case $5$ (outside the band): $(E, \\varepsilon_\\mathrm{d}, \\varepsilon_0, t, \\tau_L, \\tau_R) = (2.1\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 1.0\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV})$.\n- Case $6$ (zero coupling boundary): $(E, \\varepsilon_\\mathrm{d}, \\varepsilon_0, t, \\tau_L, \\tau_R) = (0.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 1.0\\,\\mathrm{eV}, 0.0\\,\\mathrm{eV}, 0.5\\,\\mathrm{eV})$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[r_1,r_2,\\dots,r_6]$), where each $r_i$ is the floating-point value of $\\Delta(E)$ for the corresponding case. All energies and couplings must be in $\\mathrm{eV}$, and computed transmissions are dimensionless. No angles appear in this problem.", "solution": "The problem proposed is a valid and well-posed exercise in the field of computational materials science, specifically concerning quantum transport through a single-site electronic device modeled within the Non-Equilibrium Green's Function (NEGF) formalism. It requires the derivation and comparison of the transmission function using an exact lead self-energy versus the wide-band limit approximation. All provided parameters and definitions are standard, scientifically sound, and self-consistent. We therefore proceed with the solution.\n\nThe primary task is to derive the transmission function $T(E)$ for a single-level quantum dot, described by Hamiltonian $H_\\mathrm{d} = [\\varepsilon_\\mathrm{d}]$, coupled to two semi-infinite one-dimensional tight-binding leads. The solution involves several key steps: deriving the lead properties, constructing the device Green's function, and then calculating the transmission.\n\n**1. Surface Green's Function of a 1D Tight-Binding Lead**\n\nA semi-infinite one-dimensional tight-binding lead, indexed from site $n=0$ to infinity, is described by a Hamiltonian with on-site energy $\\varepsilon_0$ and nearest-neighbor hopping $t$. The retarded Green's function $g^r(E) = [(E+i\\eta)I - H_\\mathrm{lead}]^{-1}$ (where $\\eta \\to 0^+$) is required. The element corresponding to the terminal site of the lead, $g^r_{00}(E)$, is known as the surface Green's function, which we denote as $g^r_{surf}(E)$.\n\nThis element can be found using a recursive argument. The Green's function at site $0$ can be expressed via the Dyson equation, where the self-energy term accounts for the coupling to the rest of the chain (sites $n=1, 2, \\dots$):\n$$g^r_{surf}(E) = \\left( E+i\\eta - \\varepsilon_0 - t \\cdot g^r_{surf}(E) \\cdot t \\right)^{-1}$$\nHere, we have exploited the fact that the self-energy for connecting to the sub-chain starting at site $1$ is $t^2 g^r_{surf}(E)$ because the sub-chain is identical in structure to the original semi-infinite chain. Letting $g = g^r_{surf}(E)$ and $z = E - \\varepsilon_0 + i\\eta$, the equation becomes:\n$$g = (z - t^2 g)^{-1} \\implies t^2 g^2 - z g + 1 = 0$$\nThis quadratic equation for $g$ has two solutions:\n$$g = \\frac{z \\pm \\sqrt{z^2 - 4t^2}}{2t^2}$$\nTo select the physically correct root, we require that the Green's function represents an outgoing or decaying wave into the lead, which corresponds to the solution that decays as $\\mathrm{Im}(E) \\to \\infty$. This condition is satisfied by the minus sign. Thus, the exact surface Green's function is:\n$$g^r_{surf}(E) = \\frac{(E - \\varepsilon_0) - \\sqrt{(E - \\varepsilon_0)^2 - 4t^2}}{2t^2}$$\nIn this expression, the branch of the square root is chosen such that its imaginary part is negative, consistent with the small positive imaginary part $i\\eta$ in the energy $E$.\n\n**2. Lead Self-Energy and Broadening Function**\n\nThe lead $\\alpha \\in \\{L, R\\}$ couples to the device via a hopping amplitude $\\tau_\\alpha$. The retarded self-energy, $\\Sigma^r_\\alpha(E)$, which describes the influence of the lead on the device, is given by:\n$$\\Sigma^r_\\alpha(E) = \\tau_\\alpha^2 g^r_{surf}(E) = \\frac{\\tau_\\alpha^2}{2t^2} \\left[ (E - \\varepsilon_0) - \\sqrt{(E - \\varepsilon_0)^2 - 4t^2} \\right]$$\nThe broadening (or coupling) function, $\\Gamma_\\alpha(E)$, is related to the self-energy by $\\Gamma_\\alpha(E) = i[\\Sigma^r_\\alpha(E) - \\Sigma^a_\\alpha(E)]$. Since the advanced self-energy is the Hermitian conjugate of the retarded one, $\\Sigma^a_\\alpha(E) = (\\Sigma^r_\\alpha(E))^*$, this simplifies to:\n$$\\Gamma_\\alpha(E) = -2 \\mathrm{Im}[\\Sigma^r_\\alpha(E)]$$\nThe behavior of $\\Gamma_\\alpha(E)$ depends on whether the energy $E$ falls within the conduction band of the leads, which spans from $\\varepsilon_0 - 2|t|$ to $\\varepsilon_0 + 2|t|$.\n\n- **Inside the band ($|E - \\varepsilon_0|  2|t|$):** The term $(E - \\varepsilon_0)^2 - 4t^2$ is negative. The square root is purely imaginary: $\\sqrt{(E - \\varepsilon_0)^2 - 4t^2} = \\pm i\\sqrt{4t^2 - (E - \\varepsilon_0)^2}$. The correct physical root gives a negative imaginary part for $\\Sigma^r_\\alpha(E)$, corresponding to dissipation.\n$$\\Sigma^r_\\alpha(E) = \\frac{\\tau_\\alpha^2}{2t^2} \\left[ (E - \\varepsilon_0) - i\\sqrt{4t^2 - (E - \\varepsilon_0)^2} \\right]$$\nThe imaginary part is $\\mathrm{Im}[\\Sigma^r_\\alpha(E)] = -\\frac{\\tau_\\alpha^2}{2t^2}\\sqrt{4t^2 - (E - \\varepsilon_0)^2}$. The broadening is therefore:\n$$\\Gamma_\\alpha(E) = \\frac{\\tau_\\alpha^2}{t^2}\\sqrt{4t^2 - (E - \\varepsilon_0)^2}$$\n- **Outside the band ($|E - \\varepsilon_0| > 2|t|$):** The square root term is real. In the limit $\\eta \\to 0^+$, the imaginary part of $\\Sigma^r_\\alpha(E)$ is zero. Thus, $\\Gamma_\\alpha(E) = 0$, indicating that there are no available states in the lead for transport at these energies.\n\n**3. Transmission Function: Exact vs. Wide-Band Limit**\n\nThe total retarded Green's function for the single-site device is:\n$$G^r(E) = \\left[ E - \\varepsilon_\\mathrm{d} - \\Sigma^r_L(E) - \\Sigma^r_R(E) \\right]^{-1}$$\nThe transmission function, according to the Landauer-Büttiker formula in the NEGF framework, is given by:\n$$T(E) = \\mathrm{Tr}\\left[\\Gamma_L(E) G^r(E) \\Gamma_R(E) G^a(E)\\right]$$\nFor a single-site device, this is a scalar expression, with $G^a(E) = (G^r(E))^*$:\n$$T(E) = \\Gamma_L(E) \\Gamma_R(E) |G^r(E)|^2$$\n\n**A. Exact Transmission, $T_\\mathrm{exact}(E)$**\nTo compute the exact transmission, we use the energy-dependent expressions for $\\Sigma^r_\\alpha(E)$ and $\\Gamma_\\alpha(E)$ derived above. The transmission will be non-zero only within the lead band.\n\n**B. Wide-Band Limit (WBL) Transmission, $T_\\mathrm{WBL}(E)$**\nThe WBL approximation simplifies the problem by assuming the lead broadening is constant over the energy range of interest. The energy-dependent self-energy $\\Sigma^r_\\alpha(E)$ is replaced by a purely imaginary constant:\n$$\\Sigma^r_\\alpha(E) \\approx \\Sigma^r_{\\alpha, \\mathrm{WBL}} = -i\\frac{\\Gamma_{\\alpha,0}}{2}$$\nwhere $\\Gamma_{\\alpha,0}$ is the value of the exact broadening function evaluated at a reference energy $E_0$. The problem specifies $E_0 = 0\\,\\mathrm{eV}$. For the given lead parameters $\\varepsilon_0 = 0\\,\\mathrm{eV}$ and $t=1.0\\,\\mathrm{eV}$, $E_0$ is at the band center.\n$$\\Gamma_{\\alpha,0} = \\Gamma_\\alpha(E_0=0) = \\frac{\\tau_\\alpha^2}{t^2}\\sqrt{4t^2 - (0 - 0)^2} = \\frac{2|t|\\tau_\\alpha^2}{t^2} = \\frac{2\\tau_\\alpha^2}{|t|}$$\nThe device Green's function in the WBL is:\n$$G^r_\\mathrm{WBL}(E) = \\left[ E - \\varepsilon_\\mathrm{d} - (-i\\frac{\\Gamma_{L,0}}{2}) - (-i\\frac{\\Gamma_{R,0}}{2}) \\right]^{-1} = \\left[ (E - \\varepsilon_\\mathrm{d}) + i\\frac{\\Gamma_{L,0} + \\Gamma_{R,0}}{2} \\right]^{-1}$$\nThe WBL transmission is then a Lorentzian function:\n$$T_\\mathrm{WBL}(E) = \\Gamma_{L,0} \\Gamma_{R,0} |G^r_\\mathrm{WBL}(E)|^2 = \\frac{\\Gamma_{L,0} \\Gamma_{R,0}}{(E - \\varepsilon_\\mathrm{d})^2 + \\left(\\frac{\\Gamma_{L,0} + \\Gamma_{R,0}}{2}\\right)^2}$$\nThis approximation notably predicts non-zero transmission at all energies, a key difference from the exact result.\n\n**4. Error Metric**\nThe error of the WBL approximation is quantified by the measure $\\Delta(E)$:\n$$\\Delta(E) = \\frac{\\left|T_\\mathrm{WBL}(E) - T_\\mathrm{exact}(E)\\right|}{\\max\\left(T_\\mathrm{exact}(E), \\epsilon_\\mathrm{reg}\\right)}$$\nThe regularization constant $\\epsilon_\\mathrm{reg} = 10^{-12}$ prevents division by zero in regions where $T_\\mathrm{exact}(E)$ is zero, such as outside the conduction band or when a lead is decoupled.\n\nWe will now implement these formulae to compute $\\Delta(E)$ for the specified test cases.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the error measure Δ(E) for the WBL approximation across several test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (E, eps_d, eps_0, t, tau_L, tau_R)\n        (0.0, 0.0, 0.0, 1.0, 0.5, 0.5),   # Case 1: general, band center\n        (1.8, 0.0, 0.0, 1.0, 0.5, 0.5),   # Case 2: near band edge\n        (1.95, 0.0, 0.0, 1.0, 0.5, 0.5),  # Case 3: closer to band edge\n        (1.999, 0.0, 0.0, 1.0, 0.5, 0.5), # Case 4: approaching van Hove singularity\n        (2.1, 0.0, 0.0, 1.0, 0.5, 0.5),   # Case 5: outside the band\n        (0.0, 0.0, 0.0, 1.0, 0.0, 0.5),   # Case 6: zero coupling boundary\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_delta(*case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef calculate_delta(E, eps_d, eps_0, t, tau_L, tau_R):\n    \"\"\"\n    Calculates the error measure Δ(E) for a given set of parameters.\n    \n    Args:\n        E (float): Energy.\n        eps_d (float): Device on-site energy.\n        eps_0 (float): Lead on-site energy.\n        t (float): Lead hopping parameter.\n        tau_L (float): Left lead coupling.\n        tau_R (float): Right lead coupling.\n\n    Returns:\n        float: The calculated error Δ(E).\n    \"\"\"\n    epsilon_reg = 1e-12\n    t_abs = np.abs(t)\n\n    # --- Wide-Band Limit (WBL) Calculation ---\n    # Reference energy for WBL is E0 = 0.0 eV.\n    # The reference energy E0 falls within the band since eps_0=0 and t=1.\n    if t_abs > 0:\n        E0 = 0.0\n        arg_sqrt_wbl = 4 * t**2 - (E0 - eps_0)**2\n        # WBL constant is based on E0 being in the band.\n        if arg_sqrt_wbl >= 0:\n            Gamma_L0 = (tau_L**2 / t**2) * np.sqrt(arg_sqrt_wbl) if t!=0 else 0\n            Gamma_R0 = (tau_R**2 / t**2) * np.sqrt(arg_sqrt_wbl) if t!=0 else 0\n        else: # E0 is outside the band, all WBL couplings are zero.\n            Gamma_L0 = 0.0\n            Gamma_R0 = 0.0\n    else:\n        Gamma_L0 = 0.0\n        Gamma_R0 = 0.0\n\n    Gamma_sum_0 = Gamma_L0 + Gamma_R0\n    denominator_wbl = (E - eps_d)**2 + (Gamma_sum_0 / 2)**2\n    \n    if np.isclose(denominator_wbl, 0.0):\n        # Avoid division by zero, though unlikely for physical parameters.\n        T_wbl = float('inf') if Gamma_L0 * Gamma_R0 != 0 else 0.0\n    else:\n        T_wbl = (Gamma_L0 * Gamma_R0) / denominator_wbl\n    \n    # --- Exact Calculation ---\n    band_half_width = 2 * t_abs\n    is_in_band = np.abs(E - eps_0)  band_half_width\n\n    if not is_in_band or t_abs == 0:\n        T_exact = 0.0\n    else:\n        # Calculate Γ_α(E)\n        arg_sqrt_exact = 4 * t**2 - (E - eps_0)**2\n        Gamma_L = (tau_L**2 / t**2) * np.sqrt(arg_sqrt_exact)\n        Gamma_R = (tau_R**2 / t**2) * np.sqrt(arg_sqrt_exact)\n\n        # Calculate Σ^r_α(E)\n        # Use numpy.lib.scimath.sqrt to handle complex results automatically\n        # for arguments that are negative.\n        sqrt_term_complex = np.lib.scimath.sqrt((E - eps_0)**2 - 4 * t**2)\n        \n        Sigma_r_surf_factor = ((E - eps_0) - sqrt_term_complex) / (2 * t**2)\n        \n        Sigma_r_L = tau_L**2 * Sigma_r_surf_factor\n        Sigma_r_R = tau_R**2 * Sigma_r_surf_factor\n        \n        Sigma_r_total = Sigma_r_L + Sigma_r_R\n\n        # Calculate G^r(E)\n        G_r = 1.0 / (E - eps_d - Sigma_r_total)\n        \n        # Calculate T_exact(E)\n        T_exact = Gamma_L * Gamma_R * np.abs(G_r)**2\n    \n    # --- Error Calculation ---\n    numerator = np.abs(T_wbl - T_exact)\n    denominator = np.maximum(T_exact, epsilon_reg)\n    delta = numerator / denominator\n    \n    return delta\n\nsolve()\n```", "id": "3482922"}, {"introduction": "With the basics of lead modeling established, we now apply the NEGF formalism to a hallmark of mesoscopic physics: the Aharonov-Bohm effect in a quantum ring. This practice challenges you to simulate the periodic oscillations in conductance as a function of magnetic flux, a direct manifestation of quantum interference between electron paths [@problem_id:3482866]. Furthermore, you will implement Büttiker probes to model dephasing, allowing you to observe firsthand how inelastic scattering and the loss of phase coherence suppress these quintessentially quantum signatures.", "problem": "You are tasked with implementing a computational experiment using the Non-Equilibrium Green’s Function (NEGF) formalism to study quantum transport in a mesoscopic ring geometry that exhibits Aharonov–Bohm oscillations. The ring is modeled as a single-band tight-binding lattice with $N$ sites, nearest-neighbor hopping, and complex Peierls phases on the hopping terms to account for a perpendicular magnetic field $B$ threading the ring. Two external leads are attached to the ring at opposite sites, and dephasing is introduced via Büttiker voltage probes attached to selected ring sites. Your program must compute the two-terminal conductance $G(B)$ in units of $2e^2/h$ and quantify the oscillation amplitude as a function of dephasing strength and probe density.\n\nFoundational base to use:\n- The retarded Green’s function, $G^r(E)$, for the device region is defined by\n$$\nG^r(E) = \\left[E + i0^+ - H - \\sum_\\alpha \\Sigma_\\alpha\\right]^{-1},\n$$\nwhere $H$ is the device Hamiltonian and $\\Sigma_\\alpha$ are self-energies for each terminal $\\alpha$ (leads and probes).\n- The tight-binding Hamiltonian on a ring with nearest-neighbor hopping $t$ and Peierls phase $\\varphi$ per bond is\n$$\nH_{i,i+1} = -t\\, e^{i\\varphi}, \\quad H_{i+1,i} = -t\\, e^{-i\\varphi},\n$$\nwith periodic boundary conditions $i+N \\equiv i$, and $\\sum_{\\text{bonds around ring}} \\varphi = 2\\pi \\Phi/\\Phi_0$, where $\\Phi = B A$ is the magnetic flux, $A$ is the ring area, and $\\Phi_0 = h/e$ is the flux quantum.\n- In the wide-band limit, a terminal $\\alpha$ coupled to site $i_\\alpha$ with coupling rate $\\gamma_\\alpha$ produces a self-energy\n$$\n\\Sigma_\\alpha = -i\\gamma_\\alpha \\, |i_\\alpha\\rangle\\langle i_\\alpha|, \\quad \\Gamma_\\alpha = i\\left(\\Sigma_\\alpha - \\Sigma_\\alpha^\\dagger\\right) = 2\\gamma_\\alpha\\, |i_\\alpha\\rangle\\langle i_\\alpha|.\n$$\n- The multi-terminal Landauer–Büttiker current relation in linear response is\n$$\nI_\\alpha = \\frac{2e^2}{h}\\sum_\\beta T_{\\alpha\\beta}(V_\\alpha - V_\\beta),\n$$\nwith transmission\n$$\nT_{\\alpha\\beta}(E) = \\mathrm{Tr}\\left[\\Gamma_\\alpha G^r(E)\\,\\Gamma_\\beta G^a(E)\\right],\n$$\nand $G^a = \\left(G^r\\right)^\\dagger$. In the single-site wide-band coupling case, this reduces to\n$$\nT_{\\alpha\\beta}(E) = \\Gamma_\\alpha \\Gamma_\\beta \\left|G^r_{i_\\alpha,i_\\beta}(E)\\right|^2.\n$$\n- Büttiker probes model dephasing by adding terminals at selected sites with coupling $\\eta$ and unknown potentials $V_p$, determined by enforcing zero net current into each probe, $I_p=0$.\n\nYour task:\n1. Construct a ring Hamiltonian $H$ of size $N\\times N$ with nearest-neighbor hopping $t$ and uniform Peierls phase per bond so that the total phase accumulated around the ring equals $2\\pi\\Phi/\\Phi_0$. Use a ring radius $R$ to define area $A=\\pi R^2$. Use periodic boundary conditions and set all onsite energies to $0$. Use $t=1$.\n2. Attach two leads at sites $i_L=0$ and $i_R=N/2$ (assume $N$ is even), modeled in the wide-band limit with self-energies $\\Sigma_L=-i\\gamma\\,|i_L\\rangle\\langle i_L|$ and $\\Sigma_R=-i\\gamma\\,|i_R\\rangle\\langle i_R|$, with $\\gamma=0.5$. Let the Fermi energy be $E_F=0$ and add a small numerical regularization $i\\delta$ with $\\delta=10^{-12}$ to $E_F$.\n3. Add Büttiker probes at specified subsets of ring sites with coupling $\\eta$ (wide-band, single-site), each contributing a self-energy $\\Sigma_p=-i\\eta\\,|i_p\\rangle\\langle i_p|$ and broadening $\\Gamma_p=2\\eta\\,|i_p\\rangle\\langle i_p|$, and treat them as voltage probes with unknown potentials $V_p$. Determine $V_p$ by imposing $I_p=0$ via the linear Landauer–Büttiker relations.\n4. For a given magnetic field $B$, compute the retarded Green’s function $G^r(E_F)$ and all transmissions $T_{\\alpha\\beta}(E_F)$ among terminals. Build the linear system for multi-terminal currents, enforce $I_p=0$ for probes, and apply source–drain bias by fixing $V_L=+1/2$ and $V_R=-1/2$. Compute the dimensionless two-terminal conductance $g(B)$, defined by\n$$\ng(B) = \\frac{I_L}{V_L - V_R},\n$$\nwhich equals $G(B)$ in units of $2e^2/h$.\n5. Investigate Aharonov–Bohm oscillations across one flux quantum by sweeping $B$ from $0$ to $B_{\\max}=\\Phi_0/A$ and evaluating $g(B)$ at $51$ equally spaced values including endpoints. Quantify the oscillation amplitude as\n$$\n\\Delta g = \\max_{B\\in[0,B_{\\max}]} g(B) - \\min_{B\\in[0,B_{\\max}]} g(B).\n$$\n6. Implement three distinct dephasing configurations using Büttiker probes to study the dependence of oscillation amplitude on dephasing strength and probe density.\n\nPhysical units and constants:\n- Use $B$ in Tesla.\n- Use $R$ in meters and area $A=\\pi R^2$ in $\\mathrm{m}^2$.\n- Use the electron charge $e$ in Coulombs and Planck’s constant $h$ in Joule-seconds, with the flux quantum $\\Phi_0=h/e$ in Webers ($\\mathrm{Wb}$).\n- Report conductance in units of $2e^2/h$ as dimensionless floats.\n\nTest suite specification:\n- Common parameters: $N=40$, $t=1$, $E_F=0$, $\\delta=10^{-12}$, $\\gamma=0.5$, $R=50\\times 10^{-9}\\,\\mathrm{m}$, $i_L=0$, $i_R=20$, $B\\in[0,B_{\\max}]$ with $51$ points.\n- Case A (coherent reference): no probes, $\\eta=0$.\n- Case B (weak dephasing, sparse probes): probes at $i_p\\in\\{4,8,12,16,24,28,32,36\\}$, $\\eta=0.05$.\n- Case C (strong dephasing, dense probes): probes at all sites except $i_L$ and $i_R$, $\\eta=0.5$.\n\nRequired outputs per case:\n- $g(0)$ at $B=0$,\n- $g(\\Phi_0/2A)$ at $B=B_{\\max}/2$,\n- $\\Delta g$ over the sweep $B\\in[0,B_{\\max}]$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order\n$$\n\\left[g_A(0),\\, g_A(B_{\\max}/2),\\, \\Delta g_A,\\, g_B(0),\\, g_B(B_{\\max}/2),\\, \\Delta g_B,\\, g_C(0),\\, g_C(B_{\\max}/2),\\, \\Delta g_C\\right],\n$$\nwhere each entry is a float rounded to six decimal places. No additional text should be printed.", "solution": "The problem requires the implementation of a quantum transport calculation based on the Non-Equilibrium Green's Function (NEGF) formalism to study the Aharonov-Bohm effect in a mesoscopic ring subjected to dephasing. The solution involves constructing the system's Hamiltonian, accounting for external connections via self-energies, calculating the Green's function and transmission probabilities, and finally solving for the two-terminal conductance. Dephasing is modeled using Büttiker's voltage probes, which requires solving a self-consistent problem for the probe potentials.\n\nThe solution is implemented through a series of computational steps for each specified physical configuration:\n\n1.  **System Definition**: The core of the device is a one-dimensional ring with $N$ sites described by a tight-binding model. The Hamiltonian matrix $H$, of size $N \\times N$, has zero on-site energies ($H_{i,i}=0$) and nearest-neighbor hopping terms of magnitude $t$. A magnetic field $B$ perpendicular to the ring's area $A$ introduces a magnetic flux $\\Phi = BA$. This is incorporated into the Hamiltonian via the Peierls substitution, which imparts a complex phase to the hopping elements. The phase accumulated over a single bond is uniform and given by $\\varphi = \\frac{2\\pi}{N} \\frac{\\Phi}{\\Phi_0}$, where $\\Phi_0=h/e$ is the magnetic flux quantum. The Hamiltonian matrix elements are thus:\n    $$\n    H_{i,j} =\n    \\begin{cases}\n    -t e^{i\\varphi}    \\text{if } j = (i+1) \\pmod N \\\\\n    -t e^{-i\\varphi}   \\text{if } j = (i-1) \\pmod N \\\\\n    0                  \\text{otherwise}\n    \\end{cases}\n    $$\n    We set the hopping energy $t=1$ as the unit of energy.\n\n2.  **Terminal Self-Energies**: The ring is connected to external terminals: two leads (source $L$ and drain $R$) and a set of Büttiker voltage probes used to model dephasing. Each terminal $\\alpha$, coupled to a single site $i_\\alpha$ of the ring, contributes a self-energy term $\\Sigma_\\alpha$ to the system. In the wide-band approximation, this self-energy is local and purely imaginary:\n    $$\n    \\Sigma_\\alpha = -i\\gamma_\\alpha |i_\\alpha\\rangle\\langle i_\\alpha|\n    $$\n    where $|i_\\alpha\\rangle$ is the basis vector for site $i_\\alpha$, and $\\gamma_\\alpha$ is the coupling strength. For the leads, the coupling is $\\gamma=0.5$, and for the probes, it is $\\eta$. The total self-energy matrix $\\Sigma$ is the sum of contributions from all terminals: $\\Sigma = \\sum_\\alpha \\Sigma_\\alpha$.\n\n3.  **Retarded Green's Function**: The central quantity in the NEGF formalism is the retarded Green's function $G^r(E)$, which describes the propagation of an electron with energy $E$ through the device. It is obtained by inverting a matrix representing the effective Hamiltonian of the open system:\n    $$\n    G^r(E) = \\left[ (E + i\\delta)I - H - \\Sigma \\right]^{-1}\n    $$\n    Here, $I$ is the identity matrix, and $\\delta$ is an infinitesimal positive number ($10^{-12}$ in this implementation) ensuring the \"retarded\" nature of the Green's function. All calculations are performed at the Fermi energy, $E=E_F=0$.\n\n4.  **Transmission Probabilities**: The probability for an electron to transmit from terminal $\\beta$ to terminal $\\alpha$ is given by the Landauer-Büttiker formula:\n    $$\n    T_{\\alpha\\beta}(E) = \\mathrm{Tr}\\left[\\Gamma_\\alpha G^r(E) \\Gamma_\\beta G^a(E)\\right]\n    $$\n    where $G^a(E) = (G^r(E))^\\dagger$ is the advanced Green's function and $\\Gamma_\\alpha(E) = i(\\Sigma_\\alpha(E) - \\Sigma_\\alpha^\\dagger(E))$ is the broadening function describing the rate of electron escape into terminal $\\alpha$. For our single-site, wide-band coupling model, this simplifies to $\\Gamma_\\alpha = 2\\gamma_\\alpha |i_\\alpha\\rangle\\langle i_\\alpha|$ and the transmission formula reduces to:\n    $$\n    T_{\\alpha\\beta} = (2\\gamma_\\alpha)(2\\gamma_\\beta) \\left|G^r_{i_\\alpha, i_\\beta}\\right|^2\n    $$\n    where $G^r_{i_\\alpha, i_\\beta}$ is the matrix element of the Green's function between the coupling sites of terminals $\\alpha$ and $\\beta$.\n\n5.  **Büttiker Probes and Dephasing**: Dephasing processes scatter electrons between different momentum states, destroying phase coherence. Büttiker's model simulates this by introducing fictitious voltage probes that draw no net current. For each probe $p$, the condition $I_p=0$ must be satisfied. According to the multi-terminal Landauer formula, the current into terminal $\\alpha$ is $I_\\alpha = \\frac{2e^2}{h} \\sum_{\\beta \\neq \\alpha} T_{\\alpha\\beta} (V_\\alpha - V_\\beta)$. The condition $I_p=0$ for all probes $p$ generates a system of linear equations for the unknown probe potentials $V_p$:\n    $$\n    \\sum_{\\beta \\neq p} T_{p\\beta} (V_p - V_\\beta) = 0 \\quad \\implies \\quad \\left(\\sum_{\\beta \\neq p} T_{p\\beta}\\right) V_p - \\sum_{\\beta \\neq p, \\text{probe}} T_{p\\beta} V_\\beta = T_{pL}V_L + T_{pR}V_R\n    $$\n    This linear system is constructed and solved for the vector of probe potentials $\\{V_p\\}$, given the fixed lead potentials $V_L = +1/2$ and $V_R = -1/2$.\n\n6.  **Conductance Calculation**: Once all terminal potentials are known, the current $I_L$ flowing from the source lead is calculated. The dimensionless conductance $g(B)$, in units of $2e^2/h$, is then given by:\n    $$\n    g(B) = \\frac{I_L / (2e^2/h)}{V_L - V_R} = \\sum_{\\beta \\neq L} T_{L\\beta}(V_L - V_\\beta)\n    $$\n    since we define $V_L - V_R = 1$.\n\n7.  **Aharonov-Bohm Oscillations Analysis**: To observe the Aharonov-Bohm effect, the entire calculation is repeated for a series of magnetic field values. The field $B$ is swept from $0$ to $B_{\\max} = \\Phi_0/A$, which corresponds to sweeping the magnetic flux $\\Phi$ through the ring from $0$ to one flux quantum $\\Phi_0$. This sweep is performed over $51$ equally spaced points. The conductance $g(B)$ is stored for each point. From the resulting curve, the required quantities are extracted: $g(0)$, $g(B_{\\max}/2)$, and the oscillation amplitude $\\Delta g = \\max(g) - \\min(g)$. This procedure is carried out for three different dephasing configurations as specified in the problem statement.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_conductance(flux_ratio, probe_sites, eta, N, t, E_F, delta, gamma, i_L, i_R, V_L, V_R):\n    \"\"\"\n    Computes the two-terminal dimensionless conductance for a mesoscopic ring.\n\n    This function implements the NEGF formalism for a tight-binding ring with leads and\n    Büttiker probes, calculating the conductance for a given magnetic flux.\n    \"\"\"\n    # 1. Construct the tight-binding Hamiltonian H for the ring\n    H = np.zeros((N, N), dtype=complex)\n    phase = (2 * np.pi / N) * flux_ratio\n    exp_phase = np.exp(1j * phase)\n    \n    for i in range(N - 1):\n        H[i, i + 1] = -t * exp_phase\n        H[i + 1, i] = -t * np.conj(exp_phase)\n    # Periodic boundary conditions for the ring\n    H[N - 1, 0] = -t * exp_phase\n    H[0, N - 1] = -t * np.conj(exp_phase)\n    \n    # 2. Construct the total self-energy matrix Sigma from all terminals\n    Sigma = np.zeros((N, N), dtype=complex)\n    Sigma[i_L, i_L] = -1j * gamma\n    Sigma[i_R, i_R] = -1j * gamma\n    for p_site in probe_sites:\n        Sigma[p_site, p_site] -= 1j * eta\n        \n    # 3. Calculate the retarded Green's function G^r\n    E = E_F + 1j * delta\n    G_r = np.linalg.inv(E * np.eye(N) - H - Sigma)\n    \n    # 4. Define terminals and calculate the transmission matrix T\n    terminals = [(i_L, gamma), (i_R, gamma)] + [(p, eta) for p in probe_sites]\n    num_terminals = len(terminals)\n    T = np.zeros((num_terminals, num_terminals))\n\n    for alpha in range(num_terminals):\n        for beta in range(alpha + 1, num_terminals):\n            i_alpha, gamma_alpha = terminals[alpha]\n            i_beta, gamma_beta = terminals[beta]\n            \n            trans = 4 * gamma_alpha * gamma_beta * np.abs(G_r[i_alpha, i_beta])**2\n            T[alpha, beta] = trans\n            T[beta, alpha] = trans\n\n    # 5. Solve for probe voltages if probes are present\n    num_probes = len(probe_sites)\n    if num_probes == 0:\n        # For the coherent case with no probes, conductance is simply T_LR\n        g = T[0, 1]\n        return g\n\n    # Set up and solve the linear system for probe potentials\n    A_matrix = np.zeros((num_probes, num_probes))\n    b_vector = np.zeros(num_probes)\n    \n    # Terminal indices: L=0, R=1, probes=2 to num_probes+1\n    for k in range(num_probes):  # Matrix row index, corresponding to probe k\n        alpha = k + 2  # Terminal index for probe k\n        \n        # Right-hand side of the linear system\n        b_vector[k] = T[alpha, 0] * V_L + T[alpha, 1] * V_R\n        \n        # Left-hand side matrix A\n        A_matrix[k, k] = np.sum(T[alpha, :]) # On-diagonal: sum of transmissions from probe\n        for m in range(num_probes): # Matrix column index\n            if k != m:\n                beta = m + 2 # Terminal index for probe m\n                A_matrix[k, m] = -T[alpha, beta]\n            \n    probe_voltages = np.linalg.solve(A_matrix, b_vector)\n    \n    # 6. Calculate the final two-terminal conductance\n    all_voltages = np.zeros(num_terminals)\n    all_voltages[0] = V_L\n    all_voltages[1] = V_R\n    all_voltages[2:] = probe_voltages\n    \n    # Calculate dimensionless current into lead L (index 0)\n    i_L_dim = 0.0\n    for beta in range(1, num_terminals):\n        i_L_dim += T[0, beta] * (all_voltages[0] - all_voltages[beta])\n        \n    g = i_L_dim  # Since V_L - V_R = 1\n    return g\n\ndef solve():\n    \"\"\"\n    Main function to run the quantum transport experiment for all test cases.\n    \"\"\"\n    # Common physical and numerical parameters\n    N = 40\n    t = 1.0\n    E_F = 0.0\n    delta = 1e-12\n    gamma = 0.5\n    i_L = 0\n    i_R = 20\n    V_L_bias = 0.5\n    V_R_bias = -0.5\n    \n    # Magnetic field sweep parameters\n    num_b_points = 51\n    # We sweep the dimensionless flux ratio Phi/Phi_0 from 0 to 1.\n    flux_ratios = np.linspace(0.0, 1.0, num_b_points)\n\n    # Define the three test cases as specified\n    probe_sites_C = [i for i in range(N) if i not in [i_L, i_R]]\n    test_cases = [\n        {'name': 'A', 'probe_sites': [], 'eta': 0.0},\n        {'name': 'B', 'probe_sites': [4, 8, 12, 16, 24, 28, 32, 36], 'eta': 0.05},\n        {'name': 'C', 'probe_sites': probe_sites_C, 'eta': 0.5}\n    ]\n\n    results = []\n\n    for case in test_cases:\n        probe_sites = case['probe_sites']\n        eta = case['eta']\n        \n        g_values = []\n        for flux_ratio in flux_ratios:\n            g = calculate_conductance(flux_ratio, probe_sites, eta, N, t, E_F, delta, gamma, i_L, i_R, V_L_bias, V_R_bias)\n            g_values.append(g)\n            \n        g_values = np.array(g_values)\n        \n        # Extract required results for the current case\n        g_zero_flux = g_values[0]  # B=0 corresponds to flux_ratio=0\n        # B = B_max/2 corresponds to flux_ratio=0.5. Index is (51-1)/2 = 25.\n        g_half_flux = g_values[25]\n        delta_g = np.max(g_values) - np.min(g_values)\n        \n        results.extend([g_zero_flux, g_half_flux, delta_g])\n\n    # Print the final results in the required format\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\nsolve()\n```", "id": "3482866"}, {"introduction": "A robust theoretical framework must not only predict phenomena but also respect the fundamental symmetries of nature. This final practice guides you to verify the Onsager-Casimir reciprocity relations, a profound symmetry governing transport in the presence of a magnetic field, using a multi-terminal Hall bar geometry [@problem_id:3482888]. By computing transmissions with Peierls phases, you will confirm that $T_{pq}(B) = T_{qp}(-B)$ and explore how this symmetry breaks down when foundational assumptions of the theory, such as the hermiticity of the Hamiltonian, are violated.", "problem": "You are asked to design and implement a numerical experiment to evaluate microreversibility for coherent quantum transport in a multi-terminal tight-binding device using the Non-Equilibrium Green’s Function (NEGF) formalism, and to explore deviations caused by non-conservative discretizations or asymmetric lead self-energy implementations.\n\nYou must proceed from the following fundamental base in solid-state quantum transport:\n- The Non-Equilibrium Green’s Function (NEGF) retarded Green’s function of an open device, $G^{r}$, and the advanced Green’s function, $G^{a}$, are defined by the operator inverses of open-boundary Hamiltonians that include the leads via self-energies.\n- Each semi-infinite lead contributes a retarded self-energy $\\Sigma_{p}^{r}$ to the device Hamiltonian, and its broadening matrix is $\\Gamma_{p} = i \\left(\\Sigma_{p}^{r} - \\left(\\Sigma_{p}^{r}\\right)^{\\dagger}\\right)$.\n- The transmission from lead $q$ into lead $p$ at energy $E$ is defined by the Caroli formula $T_{pq}(E) = \\mathrm{Tr} \\left[ \\Gamma_{p} G^{r} \\Gamma_{q} G^{a} \\right]$.\n- Microreversibility (Onsager–Casimir symmetry) for non-interacting coherent transport in the presence of a magnetic field $B$ states that, under time-reversal invariance, $T_{pq}(B) = T_{qp}(-B)$ for all leads $p \\neq q$.\n\nYour task:\n- Implement a coherent transport simulator for a square-lattice device of size $L_{x} \\times L_{y}$ with nearest-neighbor hopping using a Peierls substitution to incorporate a uniform perpendicular magnetic field through a dimensionless flux per plaquette $f$ (i.e., a fraction of the magnetic flux quantum). Use the Landau gauge so that hopping in the $y$-direction acquires a phase factor $\\exp\\left(i 2 \\pi f x\\right)$, where $x \\in \\{0,1,\\dots,L_{x}-1\\}$ labels the lattice coordinate along $x$.\n- Attach four semi-infinite leads to the left, right, bottom, and top device edges. Model each lead as a set of decoupled semi-infinite one-dimensional chains (one per edge site) with onsite energy equal to the device onsite energy and nearest-neighbor hopping equal to the device hopping magnitude. The coupling from each edge device site to its lead should equal the missing bond at that edge. For vertical edges, include the appropriate Peierls phase in the coupling at the interface so that the coupling amplitude is $v=-t \\exp\\left(\\pm i 2 \\pi f x\\right)$, with the sign chosen by the outward normal, but note that $\\Sigma_{p}^{r}$ depends on $|v|^{2}$ and thus its diagonal entries are independent of the phase in the conservative implementation.\n- Compute the retarded and advanced surface Green’s function of a semi-infinite one-dimensional chain by solving the quadratic fixed-point equation for the surface Green’s function and selecting the retarded or advanced branch by the sign of the imaginary part. Use a positive infinitesimal $i \\eta$ with $\\eta  0$ added to the energy to select outgoing boundary conditions.\n- Build the device retarded and advanced Green’s functions, and compute all transmissions $T_{pq}$ for $p \\neq q$ at a single energy $E$.\n\nMicroreversibility check:\n- For a given flux $f$ and its reversal $-f$, compute the transmission matrices $\\{T_{pq}(f)\\}$ and $\\{T_{pq}(-f)\\}$ and return the maximum absolute deviation\n$$\\Delta(f) = \\max_{p \\neq q} \\left| T_{pq}(f) - T_{qp}(-f) \\right|.$$\n- A correct conservative and symmetric implementation should yield $\\Delta(f)$ numerically close to $0$ up to roundoff.\n\nDeviation experiments:\n- Implement two controlled deviations:\n  1. A non-conservative discretization in which the device Hamiltonian is made non-Hermitian along the $x$-direction by using asymmetric forward/backward hoppings $-t$ and $-(t+\\delta)$ with $\\delta  0$, while keeping the $y$-direction conservative with the Peierls phase. This should spuriously violate microreversibility and increase $\\Delta(f)$.\n  2. An asymmetric lead self-energy implementation in which one chosen lead uses the advanced (rather than retarded) surface Green’s function to build its self-energy. This unphysical choice violates analyticity and should increase $\\Delta(f)$.\n\nNumerical and physical parameters to use in all runs:\n- Lattice sizes: $L_{x} = L_{y} = 3$.\n- Nearest-neighbor hopping magnitude: $t = 1$.\n- Onsite energy: $u = 0$.\n- Energy: $E = 0$.\n- Infinitesimal broadening: $\\eta = 1 \\times 10^{-9}$.\n- Flux values: $f \\in \\{0, 0.08\\}$.\n- Asymmetry parameter for the non-conservative discretization: $\\delta = 0.1$.\n\nTest suite:\n- Case $1$ (happy path, finite field): conservative device and all-lead-retarded self-energies at $f = 0.08$.\n- Case $2$ (boundary, zero field): conservative device and all-lead-retarded self-energies at $f = 0$.\n- Case $3$ (non-conservative discretization): device with asymmetric $x$-hopping with $\\delta = 0.1$, all-lead-retarded, at $f = 0.08$.\n- Case $4$ (asymmetric lead self-energy): conservative device but with the top lead using the advanced branch for its surface Green’s function (others retarded), at $f = 0.08$.\n\nWhat to compute and output:\n- For each case, compute the scalar $\\Delta(f)$ defined above. Your program must produce a single line of output containing these four scalar results as a comma-separated list enclosed in square brackets in the order of Cases $1$ through $4$, i.e., $[\\Delta_{1},\\Delta_{2},\\Delta_{3},\\Delta_{4}]$.\n- All quantities are dimensionless; no physical units are required.\n- Angles, where applicable as phases, are in radians by construction of the complex exponential.\n\nConstraints:\n- Do not hard-code any shortcut expressions for the final microreversibility property. Your implementation must proceed from the definitions of the retarded and advanced Green’s functions, self-energies, broadenings, and the transmission formula, as stated above.\n- Ensure numerically stable selection of the retarded or advanced branch via the infinitesimal $i \\eta$ and explicit branch selection on the surface Green’s function roots.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4]\").", "solution": "The user has provided a problem that requires a numerical simulation of quantum transport in a mesoscopic device using the Non-Equilibrium Green's Function (NEGF) formalism. The core of the problem is to verify the microreversibility principle, $T_{pq}(B) = T_{qp}(-B)$, for a conservative system and to demonstrate its violation under specific non-physical conditions.\n\n### Step 1: Extract Givens\n\n- **System**: A 2D tight-binding model on a square lattice of size $L_x \\times L_y$ with four semi-infinite leads attached to the edges (left, right, bottom, top).\n- **Physical Parameters**:\n    - Lattice size: $L_x = 3, L_y = 3$.\n    - Nearest-neighbor hopping magnitude: $t = 1$.\n    - Onsite energy: $u = 0$.\n    - Energy for transmission calculation: $E = 0$.\n    - Infinitesimal broadening for Green's functions: $\\eta = 1 \\times 10^{-9}$.\n- **Magnetic Field**: A uniform perpendicular magnetic field is included via a Peierls substitution, represented by a dimensionless flux per plaquette, $f$. In the Landau gauge, the hopping integral in the $+y$ direction from a site at horizontal coordinate $x$ acquires a phase factor $\\exp(i 2 \\pi f x)$.\n- **Lead Model**: Each lead consists of decoupled 1D semi-infinite chains attached to each site on the corresponding device edge. The lead onsite energy and hopping match the device parameters.\n- **NEGF Definitions**:\n    - Retarded/Advanced Green's Functions: $G^{r}, G^{a}$.\n    - Lead Self-Energy: $\\Sigma_{p}^{r}$. Calculated from the surface Green's function of a 1D chain.\n    - Broadening Matrix: $\\Gamma_{p} = i \\left(\\Sigma_{p}^{r} - (\\Sigma_{p}^{r})^{\\dagger}\\right)$.\n    - Transmission Formula (Caroli): $T_{pq}(E) = \\mathrm{Tr} \\left[ \\Gamma_{p} G^{r} \\Gamma_{q} G^{a} \\right]$.\n- **Microreversibility Check**: Compute the maximum deviation $\\Delta(f) = \\max_{p \\neq q} \\left| T_{pq}(f) - T_{qp}(-f) \\right|$.\n- **Deviation Scenarios**:\n    1.  **Non-conservative discretization**: Asymmetric hopping in the x-direction with hopping elements $-t$ and $-(t+\\delta)$, where $\\delta = 0.1$. This makes the device Hamiltonian non-Hermitian.\n    2.  **Asymmetric lead self-energy**: For the top lead, the self-energy is constructed using the advanced surface Green's function, $g_s^a$, instead of the retarded one, $g_s^r$.\n- **Test Cases**:\n    1.  Conservative system ($\\delta=0$, all leads retarded), $f = 0.08$.\n    2.  Conservative system ($\\delta=0$, all leads retarded), $f = 0$.\n    3.  Non-conservative system ($\\delta = 0.1$), $f = 0.08$.\n    4.  Asymmetric top lead self-energy, $f = 0.08$.\n- **Output**: A single line containing the four computed $\\Delta$ values, comma-separated and enclosed in brackets: $[\\Delta_1, \\Delta_2, \\Delta_3, \\Delta_4]$.\n\n### Step 2: Validate Using Extracted Givens\n\nThe problem is a standard, well-defined exercise in computational condensed matter physics.\n- **Scientifically Grounded**: The problem is built upon the established NEGF formalism, tight-binding models, and the Peierls substitution for magnetic fields. These are fundamental concepts in solid-state and mesoscopic physics. The deviation experiments are designed to probe the physical assumptions underlying the theory (e.g., hermiticity, causality/analyticity).\n- **Well-Posed**: All necessary parameters ($L_x, L_y, t, u, E, \\eta, f, \\delta$) and definitions are provided. The objective—calculating $\\Delta(f)$ for four distinct cases—is clear and unambiguous. A unique numerical solution exists for each case.\n- **Objective**: The problem is stated in precise, technical language, free from subjectivity or ambiguity.\n\nThe problem passes all validation criteria. It is not scientifically unsound, incomplete, contradictory, unrealistic, or ill-posed. It represents a conceptually sound and computationally tractable problem.\n\n### Step 3: Verdict and Action\n\nThe problem statement is **valid**. A solution will be developed based on the specified principles and parameters.\n\n### Principle-Based Design\n\nThe solution will be structured into a set of functions, each responsible for a distinct physical or computational step, reflecting the structure of the NEGF formalism.\n\n1.  **System and Site Indexing**: The $L_x \\times L_y = 3 \\times 3$ device has $N=9$ sites. A mapping from 2D lattice coordinates $(i_x, i_y)$ to a 1D matrix index $k$ is established using $k = i_y \\cdot L_x + i_x$.\n\n2.  **Surface Green's Function**: The self-energy of the semi-infinite leads requires the surface Green's function, $g_s$, of a 1D tight-binding chain. This is found by solving the quadratic equation $t^2 g_s^2 - (E - u + i\\eta) g_s + 1 = 0$. The two roots correspond to the retarded ($g_s^r$, with $\\mathrm{Im}(g_s^r)  0$) and advanced ($g_s^a$, with $\\mathrm{Im}(g_s^a) > 0$) branches. A function will solve this equation and return both branches.\n\n3.  **Device Hamiltonian Construction**: An $N \\times N$ matrix $H$ is constructed.\n    - **Hopping in x-direction**: For a conservative device ($\\delta=0$), hopping between adjacent sites is $-t$. For the non-conservative case, the hopping from $x$ to $x+1$ is $-(t+\\delta)$ and from $x+1$ to $x$ is $-t$, resulting in a non-Hermitian matrix $H \\neq H^{\\dagger}$.\n    - **Hopping in y-direction**: Hopping from $(i_x, i_y)$ to $(i_x, i_y+1)$ includes the Peierls phase factor, giving a matrix element $-t \\exp(i 2\\pi f i_x)$. The conjugate element ensures this part of the Hamiltonian is Hermitian. The property $H(-f) = H(f)^T$ is crucial for microreversibility.\n\n4.  **Lead Self-Energies**: Four $N \\times N$ self-energy matrices, $\\Sigma_p$, are constructed ($p \\in \\{0,1,2,3\\}$ for left, right, bottom, top). Each is diagonal in the site basis. For a site $k$ at an edge, the self-energy is $\\Sigma_{p,kk} = |v|^2 g_s$, where $|v|^2=t^2$ is the squared coupling strength and $g_s$ is the surface Green's function.\n    - In standard cases, $g_s = g_s^r$.\n    - In Case 4, for the top lead ($p=3$), $g_s=g_s^a$ is used, which violates the analyticity requirement for a retarded self-energy.\n\n5.  **Device Green's Functions**:\n    - The retarded Green's function is computed via matrix inversion: $G^r = [ (E+i\\eta)I - H - \\sum_p \\Sigma_p ]^{-1}$.\n    - The advanced Green's function is its Hermitian conjugate: $G^a = (G^r)^{\\dagger}$. This relation holds by definition and correctly propagates the consequences of any non-physicality in $H$ or $\\Sigma$.\n\n6.  **Broadening and Transmission**:\n    - The broadening matrices are computed using their definition: $\\Gamma_p = i(\\Sigma_p - \\Sigma_p^{\\dagger})$. For a standard retarded self-energy, $\\Gamma_p$ is positive semi-definite. For the unphysical self-energy in Case 4, the corresponding $\\Gamma_3$ becomes negative-definite, representing an unphysical gain of particles.\n    - The transmission $T_{pq}$ is calculated using the Caroli formula, $T_{pq} = \\mathrm{Tr}(\\Gamma_p G^r \\Gamma_q G^a)$. The trace operation yields a real-valued transmission probability.\n\n7.  **Microreversibility Check**: The entire calculation is performed for a given flux $f$ and its reversal $-f$ to obtain the transmission matrices $\\{T_{pq}(f)\\}$ and $\\{T_{pq}(-f)\\}$. The final deviation $\\Delta(f)$ is found by taking the maximum absolute difference $|T_{pq}(f) - T_{qp}(-f)|$ over all pairs of distinct leads $p \\neq q$.\n\nThis step-by-step implementation directly translates the physical definitions from the problem statement into a numerical algorithm, ensuring no shortcuts are taken and the core physics is explicitly modeled. For the \"happy path\" cases (1 and 2), $\\Delta(f)$ is expected to be near machine precision. For the deviation cases (3 and 4), violations of hermiticity or analyticity break the underlying symmetries, leading to a numerically significant, non-zero $\\Delta(f)$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import inv\n\ndef solve():\n    \"\"\"\n    Main function to run the NEGF simulation for the four test cases\n    and check microreversibility.\n    \"\"\"\n\n    # --- Physical and numerical parameters from the problem statement ---\n    LX, LY = 3, 3\n    T_HOP = 1.0\n    U_ONSITE = 0.0\n    E_ENERGY = 0.0\n    ETA = 1e-9\n    DELTA = 0.1\n    FLUX_VALUES = {'case1': 0.08, 'case2': 0.0, 'case3': 0.08, 'case4': 0.08}\n\n    def get_surface_green_function(t_hop, E, u, eta):\n        \"\"\"\n        Solves the quadratic equation for the 1D semi-infinite lead's \n        surface Green's function (g_s).\n        \n        The equation is t_hop^2 * g_s^2 - (E - u + i*eta) * g_s + 1 = 0.\n        \n        Returns:\n            (g_r, g_a): Retarded (Im  0) and advanced (Im > 0) solutions.\n        \"\"\"\n        complex_E = E - u + 1j * eta\n        \n        # Coefficients of the quadratic equation a*x^2 + b*x + c = 0\n        a = t_hop**2\n        b = -complex_E\n        c = 1.0\n        \n        discriminant_sqrt = np.sqrt(b**2 - 4 * a * c, dtype=np.complex128)\n        \n        g1 = (-b + discriminant_sqrt) / (2 * a)\n        g2 = (-b - discriminant_sqrt) / (2 * a)\n        \n        # The retarded branch has a negative imaginary part, advanced has a positive one.\n        g_r = g1 if g1.imag  0 else g2\n        g_a = g1 if g1.imag > 0 else g2\n        \n        return g_r, g_a\n\n    def build_hamiltonian(Lx, Ly, t_hop, f, delta):\n        \"\"\"\n        Builds the device Hamiltonian matrix H for a given flux f.\n        The parameter delta introduces non-Hermitian x-hopping if non-zero.\n        \"\"\"\n        N = Lx * Ly\n        H = np.zeros((N, N), dtype=np.complex128)\n        \n        for iy in range(Ly):\n            for ix in range(Lx):\n                k = iy * Lx + ix\n                \n                # Hopping in x-direction (to the right neighbor)\n                if ix  Lx - 1:\n                    k_right = k + 1\n                    H[k, k_right] = -(t_hop + delta)  # Asymmetric hopping\n                    H[k_right, k] = -t_hop\n                \n                # Hopping in y-direction (to the top neighbor) with Peierls phase\n                if iy  Ly - 1:\n                    k_up = k + Lx\n                    phase = np.exp(1j * 2 * np.pi * f * ix)\n                    H[k, k_up] = -t_hop * phase\n                    H[k_up, k] = -t_hop * np.conj(phase)\n        return H\n\n    def build_self_energies(Lx, Ly, t_hop, E, u, eta, asymmetric_lead_idx):\n        \"\"\"\n        Builds the self-energy matrices for the 4 leads.\n        Leads indexed as 0:left, 1:right, 2:bottom, 3:top.\n        If asymmetric_lead_idx is specified, that lead uses g_s^a instead of g_s^r.\n        \"\"\"\n        N = Lx * Ly\n        g_r, g_a = get_surface_green_function(t_hop, E, u, eta)\n        \n        sigmas = [np.zeros((N, N), dtype=np.complex128) for _ in range(4)]\n        v_sq = t_hop**2\n        \n        # Determine which surface Green's function to use for each lead\n        g_s_choices = [g_r] * 4\n        if asymmetric_lead_idx != -1:\n            g_s_choices[asymmetric_lead_idx] = g_a\n\n        # Lead 0 (left edge, x=0)\n        for iy in range(Ly):\n            k = iy * Lx + 0\n            sigmas[0][k, k] = v_sq * g_s_choices[0]\n            \n        # Lead 1 (right edge, x=Lx-1)\n        for iy in range(Ly):\n            k = iy * Lx + (Lx - 1)\n            sigmas[1][k, k] = v_sq * g_s_choices[1]\n            \n        # Lead 2 (bottom edge, y=0)\n        for ix in range(Lx):\n            k = 0 * Lx + ix\n            sigmas[2][k, k] = v_sq * g_s_choices[2]\n            \n        # Lead 3 (top edge, y=Ly-1)\n        for ix in range(Ly):\n            k = (Ly - 1) * Lx + ix\n            sigmas[3][k, k] = v_sq * g_s_choices[3]\n            \n        return sigmas\n\n    def compute_transmission_matrix(f, delta, asymmetric_lead_idx):\n        \"\"\"\n        Computes the full transmission matrix T_pq for a given set of parameters.\n        \"\"\"\n        N = LX * LY\n        \n        H = build_hamiltonian(LX, LY, T_HOP, f, delta)\n        \n        sigmas = build_self_energies(LX, LY, T_HOP, E_ENERGY, U_ONSITE, ETA, asymmetric_lead_idx)\n        sigma_total = sum(sigmas)\n        \n        # Retarded Green's function\n        complex_E = E_ENERGY - U_ONSITE + 1j * ETA\n        G_r = inv(complex_E * np.identity(N) - H - sigma_total)\n        \n        # Advanced Green's function\n        G_a = G_r.conj().T\n        \n        # Broadening matrices\n        gammas = [1j * (s - s.conj().T) for s in sigmas]\n        \n        # Transmission T_pq = Tr(Gamma_p * G_r * Gamma_q * G_a)\n        num_leads = 4\n        T_matrix = np.zeros((num_leads, num_leads))\n        for p in range(num_leads):\n            for q in range(num_leads):\n                if p != q:\n                    # Use @ for matrix multiplication\n                    prod = gammas[p] @ G_r @ gammas[q] @ G_a\n                    T_matrix[p, q] = np.trace(prod).real\n        return T_matrix\n\n    def calculate_delta(f, delta, asymmetric_lead_idx):\n        \"\"\"\n        Calculates the microreversibility deviation Delta(f).\n        \"\"\"\n        T_f_pos = compute_transmission_matrix(f, delta, asymmetric_lead_idx)\n        T_f_neg = compute_transmission_matrix(-f, delta, asymmetric_lead_idx)\n        \n        max_dev = 0.0\n        num_leads = 4\n        for p in range(num_leads):\n            for q in range(num_leads):\n                if p != q:\n                    dev = np.abs(T_f_pos[p, q] - T_f_neg[q, p])\n                    if dev > max_dev:\n                        max_dev = dev\n        return max_dev\n\n    # --- Define and run test cases ---\n    test_cases = [\n        # Case 1 (happy path, finite field): conservative, f = 0.08\n        {'f': FLUX_VALUES['case1'], 'delta': 0.0, 'asym_idx': -1},\n        # Case 2 (boundary, zero field): conservative, f = 0\n        {'f': FLUX_VALUES['case2'], 'delta': 0.0, 'asym_idx': -1},\n        # Case 3 (non-conservative discretization): asymmetric hopping, f = 0.08\n        {'f': FLUX_VALUES['case3'], 'delta': DELTA, 'asym_idx': -1},\n        # Case 4 (asymmetric lead self-energy): top lead uses g_s^a, f = 0.08\n        {'f': FLUX_VALUES['case4'], 'delta': 0.0, 'asym_idx': 3},\n    ]\n\n    results = []\n    for case in test_cases:\n        delta_val = calculate_delta(case['f'], case['delta'], case['asym_idx'])\n        results.append(delta_val)\n\n    # --- Final print statement in the exact required format ---\n    # Using scientific notation to handle both small and large values consistently.\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nsolve()\n```", "id": "3482888"}]}