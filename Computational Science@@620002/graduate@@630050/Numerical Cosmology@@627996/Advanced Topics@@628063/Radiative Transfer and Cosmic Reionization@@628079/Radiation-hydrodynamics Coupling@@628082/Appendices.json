{"hands_on_practices": [{"introduction": "Full frequency-dependent radiative transfer is often computationally prohibitive in large-scale cosmological simulations. A common and necessary simplification is the 'grey' approximation, which uses frequency-averaged opacities. This exercise [@problem_id:3483018] provides hands-on practice in deriving two of the most important grey opacities, the Planck mean and Rosseland mean, from first principles. By working through this derivation, you will solidify your understanding of how microphysical processes are encapsulated into the effective coefficients that govern radiation-hydrodynamics coupling in different physical limits.", "problem": "In numerical cosmology, radiation-hydrodynamics (RHD) coupling requires grey opacities that aggregate frequency-dependent microphysics into effective temperature-dependent coefficients. Two such coefficients are the Planck mean opacity and the Rosseland mean opacity. Let the monochromatic absorption opacity be a power law in frequency, $\\kappa_{\\nu} \\propto \\nu^{2}$, and let the radiation field be a blackbody at temperature $T$, described by Planck’s law $B_{\\nu}(T)$.\n\nStarting from the core definitions\n$$\\kappa_{P}(T) \\equiv \\frac{\\int_{0}^{\\infty} \\kappa_{\\nu}\\, B_{\\nu}(T)\\, d\\nu}{\\int_{0}^{\\infty} B_{\\nu}(T)\\, d\\nu}, \\quad \\text{and} \\quad \\frac{1}{\\kappa_{R}(T)} \\equiv \\frac{\\int_{0}^{\\infty} \\frac{1}{\\kappa_{\\nu}}\\, \\frac{\\partial B_{\\nu}(T)}{\\partial T}\\, d\\nu}{\\int_{0}^{\\infty} \\frac{\\partial B_{\\nu}(T)}{\\partial T}\\, d\\nu},$$\nand using Planck’s law\n$$B_{\\nu}(T) = \\frac{2 h \\nu^{3}}{c^{2}} \\left[\\exp\\!\\left(\\frac{h \\nu}{k_{B} T}\\right) - 1\\right]^{-1},$$\nderive how $\\kappa_{P}$ and $\\kappa_{R}$ scale with $T$ (up to multiplicative constants), by evaluating the temperature dependence of the relevant integrals. Assume pure absorption (no scattering), spatial homogeneity, and isotropy. Express your final answer as a row matrix whose two entries are the $T$-dependences of $\\kappa_{P}(T)$ and $\\kappa_{R}(T)$, respectively. No numerical evaluation or rounding is required, and omit all multiplicative constants independent of $T$.", "solution": "The goal is to determine the temperature dependence of the Planck mean opacity, $\\kappa_{P}(T)$, and the Rosseland mean opacity, $\\kappa_{R}(T)$, given the monochromatic opacity $\\kappa_{\\nu} \\propto \\nu^{2}$. We will analyze each case separately by examining the temperature scaling of the defining integrals. Let the constant of proportionality for the opacity be $A$, such that $\\kappa_{\\nu} = A \\nu^{2}$, where $A$ is independent of frequency $\\nu$ and temperature $T$.\n\nFirst, we analyze the Planck mean opacity, $\\kappa_{P}(T)$, defined as:\n$$ \\kappa_{P}(T) \\equiv \\frac{\\int_{0}^{\\infty} \\kappa_{\\nu}\\, B_{\\nu}(T)\\, d\\nu}{\\int_{0}^{\\infty} B_{\\nu}(T)\\, d\\nu} $$\nWe will evaluate the temperature dependence of the numerator and the denominator separately.\n\nThe denominator is the total intensity of a blackbody, obtained by integrating the Planck function $B_{\\nu}(T)$ over all frequencies:\n$$ \\int_{0}^{\\infty} B_{\\nu}(T)\\, d\\nu = \\int_{0}^{\\infty} \\frac{2 h \\nu^{3}}{c^{2}} \\left[\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right) - 1\\right]^{-1} d\\nu $$\nTo evaluate the temperature dependence, we perform a change of variables to a dimensionless frequency $x = \\frac{h \\nu}{k_{B} T}$. This implies $\\nu = \\frac{k_{B} T}{h} x$ and $d\\nu = \\frac{k_{B} T}{h} dx$. Substituting these into the integral:\n$$ \\int_{0}^{\\infty} \\frac{2h}{c^{2}} \\left(\\frac{k_{B} T}{h}x\\right)^{3} \\frac{1}{\\exp(x) - 1} \\left(\\frac{k_{B} T}{h}dx\\right) = \\frac{2h}{c^{2}} \\left(\\frac{k_{B}}{h}\\right)^{4} T^{4} \\int_{0}^{\\infty} \\frac{x^{3}}{\\exp(x) - 1} dx $$\nThe integral $\\int_{0}^{\\infty} \\frac{x^{3}}{\\exp(x) - 1} dx = \\frac{\\pi^{4}}{15}$ is a dimensionless constant. Thus, the denominator is proportional to $T^{4}$. This is consistent with the Stefan-Boltzmann law, where the total radiated power is proportional to $T^{4}$.\n$$ \\int_{0}^{\\infty} B_{\\nu}(T)\\, d\\nu \\propto T^{4} $$\n\nNext, we analyze the numerator of the $\\kappa_{P}(T)$ expression, substituting $\\kappa_{\\nu} = A \\nu^{2}$:\n$$ \\int_{0}^{\\infty} \\kappa_{\\nu}\\, B_{\\nu}(T)\\, d\\nu = \\int_{0}^{\\infty} (A \\nu^{2}) \\left( \\frac{2 h \\nu^{3}}{c^{2}} \\left[\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right) - 1\\right]^{-1} \\right) d\\nu = \\frac{2hA}{c^{2}} \\int_{0}^{\\infty} \\nu^{5} \\left[\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right) - 1\\right]^{-1} d\\nu $$\nUsing the same substitution $x = \\frac{h \\nu}{k_{B} T}$:\n$$ \\frac{2hA}{c^{2}} \\int_{0}^{\\infty} \\left(\\frac{k_{B} T}{h}x\\right)^{5} \\frac{1}{\\exp(x) - 1} \\left(\\frac{k_{B} T}{h}dx\\right) = \\frac{2hA}{c^{2}} \\left(\\frac{k_{B}}{h}\\right)^{6} T^{6} \\int_{0}^{\\infty} \\frac{x^{5}}{\\exp(x) - 1} dx $$\nThe integral $\\int_{0}^{\\infty} \\frac{x^{5}}{\\exp(x) - 1} dx$ is another dimensionless constant. Therefore, the numerator is proportional to $T^{6}$:\n$$ \\int_{0}^{\\infty} \\kappa_{\\nu}\\, B_{\\nu}(T)\\, d\\nu \\propto T^{6} $$\nCombining the results for the numerator and denominator, the temperature scaling of the Planck mean opacity is:\n$$ \\kappa_{P}(T) \\propto \\frac{T^{6}}{T^{4}} = T^{2} $$\n\nSecond, we analyze the Rosseland mean opacity, $\\kappa_{R}(T)$, defined via its reciprocal:\n$$ \\frac{1}{\\kappa_{R}(T)} \\equiv \\frac{\\int_{0}^{\\infty} \\kappa_{\\nu}^{-1}\\, \\frac{\\partial B_{\\nu}(T)}{\\partial T}\\, d\\nu}{\\int_{0}^{\\infty} \\frac{\\partial B_{\\nu}(T)}{\\partial T}\\, d\\nu} $$\nFrom $\\kappa_{\\nu} = A \\nu^{2}$, we have $\\kappa_{\\nu}^{-1} = A^{-1} \\nu^{-2}$. We first need the partial derivative of the Planck function with respect to temperature:\n$$ \\frac{\\partial B_{\\nu}(T)}{\\partial T} = \\frac{\\partial}{\\partial T} \\left( \\frac{2 h \\nu^{3}}{c^{2}} \\left[\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right) - 1\\right]^{-1} \\right) $$\n$$ = \\frac{2 h \\nu^{3}}{c^{2}} (-1) \\left[\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right) - 1\\right]^{-2} \\exp\\left(\\frac{h \\nu}{k_{B} T}\\right) \\left(-\\frac{h \\nu}{k_{B} T^{2}}\\right) $$\n$$ = \\frac{2 h^{2} \\nu^{4}}{c^{2} k_{B} T^{2}} \\frac{\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right)}{\\left[\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right) - 1\\right]^{2}} $$\nNow, we evaluate the denominator of the $1/\\kappa_{R}(T)$ expression. We can note that since $\\int_{0}^{\\infty} B_{\\nu}(T) d\\nu \\propto T^{4}$, then $\\frac{\\partial}{\\partial T}\\int_{0}^{\\infty} B_{\\nu}(T) d\\nu \\propto T^{3}$. Interchanging the derivative and integral, $\\int_{0}^{\\infty} \\frac{\\partial B_{\\nu}(T)}{\\partial T} d\\nu \\propto T^{3}$. Let's verify this by direct integration.\n$$ \\int_{0}^{\\infty} \\frac{\\partial B_{\\nu}(T)}{\\partial T} d\\nu = \\int_{0}^{\\infty} \\frac{2 h^{2} \\nu^{4}}{c^{2} k_{B} T^{2}} \\frac{\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right)}{\\left[\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right) - 1\\right]^{2}} d\\nu $$\nUsing the substitution $x = \\frac{h \\nu}{k_{B} T}$:\n$$ \\frac{2 h^{2}}{c^{2} k_{B} T^{2}} \\int_{0}^{\\infty} \\left(\\frac{k_{B} T}{h}x\\right)^{4} \\frac{\\exp(x)}{[\\exp(x) - 1]^{2}} \\left(\\frac{k_{B} T}{h}dx\\right) = \\frac{2 k_{B}^{4}}{c^{2} h^{3}} T^{3} \\int_{0}^{\\infty} \\frac{x^{4} \\exp(x)}{[\\exp(x) - 1]^{2}} dx $$\nThe integral is a constant, so the denominator scales as $T^{3}$:\n$$ \\int_{0}^{\\infty} \\frac{\\partial B_{\\nu}(T)}{\\partial T} d\\nu \\propto T^{3} $$\nNext, we evaluate the numerator of the $1/\\kappa_{R}(T)$ expression, with $\\kappa_{\\nu}^{-1} = A^{-1} \\nu^{-2}$:\n$$ \\int_{0}^{\\infty} \\kappa_{\\nu}^{-1}\\, \\frac{\\partial B_{\\nu}(T)}{\\partial T} d\\nu = \\int_{0}^{\\infty} (A^{-1} \\nu^{-2}) \\left( \\frac{2 h^{2} \\nu^{4}}{c^{2} k_{B} T^{2}} \\frac{\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right)}{\\left[\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right) - 1\\right]^{2}} \\right) d\\nu $$\n$$ = \\frac{2 h^{2} A^{-1}}{c^{2} k_{B} T^{2}} \\int_{0}^{\\infty} \\nu^{2} \\frac{\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right)}{\\left[\\exp\\left(\\frac{h \\nu}{k_{B} T}\\right) - 1\\right]^{2}} d\\nu $$\nUsing the substitution $x = \\frac{h \\nu}{k_{B} T}$:\n$$ \\frac{2 h^{2} A^{-1}}{c^{2} k_{B} T^{2}} \\int_{0}^{\\infty} \\left(\\frac{k_{B} T}{h}x\\right)^{2} \\frac{\\exp(x)}{[\\exp(x)-1]^{2}} \\left(\\frac{k_{B} T}{h}dx\\right) = \\frac{2 k_{B}^{2} A^{-1}}{c^{2} h} T^{1} \\int_{0}^{\\infty} \\frac{x^{2} \\exp(x)}{[\\exp(x) - 1]^{2}} dx $$\nThe integral is a constant, so the numerator scales as $T^{1}$:\n$$ \\int_{0}^{\\infty} \\kappa_{\\nu}^{-1}\\, \\frac{\\partial B_{\\nu}(T)}{\\partial T} d\\nu \\propto T $$\nCombining the results for the numerator and denominator of $1/\\kappa_{R}(T)$:\n$$ \\frac{1}{\\kappa_{R}(T)} \\propto \\frac{T}{T^{3}} = T^{-2} $$\nTherefore, the temperature scaling of the Rosseland mean opacity is:\n$$ \\kappa_{R}(T) \\propto (T^{-2})^{-1} = T^{2} $$\nBoth the Planck and Rosseland mean opacities scale as the square of the temperature.", "answer": "$$\\boxed{\\begin{pmatrix} T^{2} & T^{2} \\end{pmatrix}}$$", "id": "3483018"}, {"introduction": "The vast disparity between the speed of light $c$ and typical hydrodynamic velocities poses a severe time-step constraint for explicit numerical schemes. To make simulations feasible, many codes employ the reduced speed-of-light approximation (RSLA), where $c$ is replaced by a much smaller $c_{\\rm red}$. This practice [@problem_id:3482963] challenges you to quantify the errors introduced by this approximation across different physical regimes, from optically thin streaming to optically thick diffusion. This is a crucial skill for any computational astrophysicist, as it builds intuition for when numerical shortcuts are justified and what their physical consequences are.", "problem": "You are to quantify the numerical error introduced by the reduced speed-of-light approximation, defined by a reduced speed $c_{\\rm red}$ with $0 < c_{\\rm red} < c$, on three coupled radiation-hydrodynamics observables central to numerical cosmology: the ionization front speed, the radiation pressure, and a radiation-modified shock indicator, across optically thin (streaming) and optically thick (diffusive) regimes. Your derivation and implementation must start from first principles and well-tested formulas and be scientifically consistent.\n\nStart from the following fundamentals, definitions, and closures in one spatial dimension under gray radiation:\n- Radiation energy density $E$ and radiation flux $F$ satisfy the moment equations closed by the Eddington factor. In the optically thin streaming limit, $F$ approaches $c E$ along the ray direction and the radiation pressure $P_r$ approaches $E$. In the optically thick diffusive limit, flux follows Fick’s law $F \\approx -D \\,\\partial_x E$ with diffusion coefficient $D = \\frac{c}{3 \\kappa \\rho}$ for absorption opacity $\\kappa$ and mass density $\\rho$, and the radiation pressure closure is $P_r \\approx \\frac{E}{3}$.\n- The ionization front (I-front) speed $v_I$ in a uniform hydrogen medium with number density $n_{\\rm H}$ can be estimated at early times by balancing the photon number flux $\\Phi_\\gamma$ against the rate of ionizations required per unit area, with an upper bound set by the finite propagation speed. The photon number flux is $\\Phi_\\gamma = \\frac{F}{\\epsilon}$ where $\\epsilon$ is the mean ionizing photon energy. The reduced speed-of-light (RSLA) replaces $c$ by $c_{\\rm red}$ in the radiative transport terms.\n- Gas pressure is $P_g = n_g k_{\\rm B} T$ for gas number density $n_g$, Boltzmann constant $k_{\\rm B}$, and temperature $T$. For pure atomic hydrogen gas, take $n_g = n_{\\rm H}$ and $\\rho = n_{\\rm H} m_p$ with proton mass $m_p$.\n- Define an upstream radiation-modified shock indicator $\\Theta$ as the fraction of total upstream pressure due to radiation, $\\Theta = \\frac{P_r}{P_r + P_g}$, which is a dimensionless measure of the relative importance of radiation pressure in modifying shock structure.\n\nYour tasks:\n- Derive, from the above fundamentals, formulas for the streaming and diffusive regimes that allow computing:\n  - The true ionization front speed $v_I^{\\rm true}$ with $c$, and the RSLA ionization front speed $v_I^{\\rm red}$ with $c_{\\rm red}$.\n  - The true radiation pressure $P_r^{\\rm true}$ and RSLA radiation pressure $P_r^{\\rm red}$ in both regimes.\n  - The upstream shock indicator $\\Theta^{\\rm true}$ and $\\Theta^{\\rm red}$.\n- From these, compute three fractional errors for each case:\n  - The fractional error in ionization front speed $\\delta_{v_I} = \\frac{v_I^{\\rm red} - v_I^{\\rm true}}{v_I^{\\rm true}}$.\n  - The fractional error in radiation pressure $\\delta_{P_r} = \\frac{P_r^{\\rm red} - P_r^{\\rm true}}{P_r^{\\rm true}}$.\n  - The fractional error in the shock indicator $\\delta_{\\Theta} = \\frac{\\Theta^{\\rm red} - \\Theta^{\\rm true}}{\\Theta^{\\rm true}}$.\n\nUse the International System of Units (SI) throughout. Velocities must be in meters per second (m/s), fluxes in watts per square meter (W/m$^2$), energies in joules (J), pressures in pascals (Pa), densities in kilograms per cubic meter (kg/m$^3$), opacities in square meters per kilogram (m$^2$/kg), lengths in meters (m), and temperatures in kelvin (K). The final outputs are dimensionless fractional errors. Use the constants $c = 2.99792458 \\times 10^8$ (m/s), $k_{\\rm B} = 1.380649 \\times 10^{-23}$ (J/K), $m_p = 1.67262192369 \\times 10^{-27}$ (kg), and $\\epsilon = 20 \\times 1.602176634 \\times 10^{-19}$ (J).\n\nImplement the following test suite of parameter sets to ensure coverage of streaming and diffusive regimes, including happy path and boundary cases. For each case, the medium is pure hydrogen so $n_g = n_{\\rm H}$ and $\\rho = n_{\\rm H} m_p$, and regime classification should be based on the optical depth $\\tau = \\kappa \\rho L$:\n- Case $1$ (streaming, saturation by $c$): $n_{\\rm H} = 10^6$ (m$^{-3}$), $F = 1.024 \\times 10^{-1}$ (W/m$^2$), $\\kappa = 4.0 \\times 10^{-2}$ (m$^2$/kg), $L = 10^9$ (m), $T = 10^4$ (K), $c_{\\rm red}/c = 10^{-2}$.\n- Case $2$ (streaming, photon-limited): $n_{\\rm H} = 10^{10}$ (m$^{-3}$), $F = 10^{-3}$ (W/m$^2$), $\\kappa = 4.0 \\times 10^{-2}$ (m$^2$/kg), $L = 10^9$ (m), $T = 10^4$ (K), $c_{\\rm red}/c = 10^{-1}$.\n- Case $3$ (diffusion, high optical depth): $n_{\\rm H} = 10^{16}$ (m$^{-3}$), $F = 10$ (W/m$^2$), $\\kappa = 4.0 \\times 10^{-2}$ (m$^2$/kg), $L = 10^{13}$ (m), $T = 10^5$ (K), $c_{\\rm red}/c = 10^{-2}$.\n- Case $4$ (streaming, boundary $\\Phi_\\gamma/n_{\\rm H} = c$): $n_{\\rm H} = 10^8$ (m$^{-3}$), $F = c \\, n_{\\rm H} \\, \\epsilon$ (W/m$^2$), $\\kappa = 4.0 \\times 10^{-2}$ (m$^2$/kg), $L = 10^9$ (m), $T = 10^4$ (K), $c_{\\rm red}/c = 3 \\times 10^{-2}$.\n\nRegime use in computation:\n- If $\\tau < 10^{-2}$, treat as streaming.\n- Otherwise, treat as diffusive.\n\nYour program must compute the three fractional errors $\\delta_{v_I}$, $\\delta_{P_r}$, and $\\delta_{\\Theta}$ for each case and output them in a single line as a comma-separated list enclosed in square brackets, in the order of cases $1$ through $4$, with each case contributing three numbers in the order listed, and each number rounded to six decimal places. For example, an output format like $[x_1,y_1,z_1,x_2,y_2,z_2,x_3,y_3,z_3,x_4,y_4,z_4]$ is required on a single line with no additional text.", "solution": "The problem requires a quantitative analysis of the numerical error introduced by the reduced speed-of-light approximation (RSLA) in a one-dimensional radiation-hydrodynamics context. We must derive expressions for the fractional errors in three key observables—ionization front speed ($v_I$), radiation pressure ($P_r$), and a radiation-modified shock indicator ($\\Theta$)—for both optically thin (streaming) and optically thick (diffusive) regimes. The derivation will be based on the provided first principles, followed by a numerical implementation for a specified set of test cases.\n\nFirst, we establish the physical and computational framework. The system is governed by the moment equations for radiation energy density, $E$, and flux, $F$. The RSLA consists of replacing the true speed of light, $c$, with a reduced value, $c_{\\rm red}$, where $0 < c_{\\rm red} < c$, in the radiative transport terms. We will denote quantities calculated with $c$ as `true` (e.g., $v_I^{\\rm true}$) and those with $c_{\\rm red}$ as `red` (e.g., $v_I^{\\rm red}$).\n\nThe regime is determined by the optical depth, $\\tau = \\kappa \\rho L$, where $\\kappa$ is the mass absorption opacity, $\\rho$ is the mass density, and $L$ is a characteristic length scale. The medium is pure hydrogen, so $\\rho = n_{\\rm H} m_p$, where $n_{\\rm H}$ is the hydrogen number density and $m_p$ is the proton mass. Per the problem specification, the streaming regime applies if $\\tau < 10^{-2}$, and the diffusive regime applies otherwise.\n\nThe gas pressure is given by the ideal gas law, $P_g = n_g k_{\\rm B} T$. For a pure hydrogen gas, the gas number density $n_g$ is identical to $n_{\\rm H}$, so $P_g = n_{\\rm H} k_{\\rm B} T$. This quantity is unaffected by the RSLA.\n\nLet us derive the necessary formulas for each regime.\n\n**1. Optically Thin (Streaming) Regime ($\\tau < 10^{-2}$)**\n\nIn the streaming limit, radiation propagates freely. The closure relations are $F = cE$ and $P_r = E$.\nCombining these gives a direct relationship between radiation pressure and flux: $P_r = F/c$.\n\nTrue Quantities (using $c$):\n- Radiation Pressure: $P_r^{\\rm true} = \\frac{F}{c}$. The flux $F$ is a given parameter.\n- Ionization Front Speed: The speed of an R-type ionization front, $v_I$, is determined by the balance between the supply of ionizing photons and the speed limit of light. The photon number flux is $\\Phi_\\gamma = F/\\epsilon$, where $\\epsilon$ is the mean energy per ionizing photon. Balancing this with the rate of ionization, $v_I n_{\\rm H}$, gives a photon-limited speed of $v_{phot} = \\frac{F}{\\epsilon n_{\\rm H}}$. The front cannot outrun the photons, so its speed is capped by $c$. Thus, $v_I^{\\rm true} = \\min\\left(\\frac{F}{\\epsilon n_{\\rm H}}, c\\right)$.\n- Shock Indicator: $\\Theta^{\\rm true} = \\frac{P_r^{\\rm true}}{P_r^{\\rm true} + P_g} = \\frac{F/c}{F/c + n_{\\rm H} k_{\\rm B} T}$.\n\nRSLA-affected Quantities (using $c_{\\rm red}$):\nThe RSLA modifies the transport relation to $F = c_{\\rm red}E$. The closure $P_r = E$ is a property of anisotropic radiation and is retained.\n- RSLA Radiation Pressure: $P_r^{\\rm red} = \\frac{F}{c_{\\rm red}}$.\n- RSLA Ionization Front Speed: The photon flux is unchanged, but the propagation speed limit is now $c_{\\rm red}$. Thus, $v_I^{\\rm red} = \\min\\left(\\frac{F}{\\epsilon n_{\\rm H}}, c_{\\rm red}\\right)$.\n- RSLA Shock Indicator: $\\Theta^{\\rm red} = \\frac{P_r^{\\rm red}}{P_r^{\\rm red} + P_g} = \\frac{F/c_{\\rm red}}{F/c_{\\rm red} + n_{\\rm H} k_{\\rm B} T}$.\n\n**2. Optically Thick (Diffusive) Regime ($\\tau \\ge 10^{-2}$)**\n\nIn the diffusive limit, radiation transport is described by Fick's law, $F \\approx -D \\nabla E$, with a diffusion coefficient $D = \\frac{c\\lambda}{3} = \\frac{c}{3\\kappa\\rho}$. The closure for nearly isotropic radiation is $P_r \\approx E/3$.\nIn one dimension, we approximate the gradient as $|\\nabla E| \\approx E/L$, where $L$ is the characteristic length scale. The flux magnitude is then $F \\approx \\frac{c E}{3 \\kappa \\rho L} = \\frac{c E}{3\\tau}$. We can express the energy density in terms of the flux: $E \\approx \\frac{3 \\tau F}{c}$.\n\nTrue Quantities (using $c$):\n- Radiation Pressure: $P_r^{\\rm true} \\approx \\frac{E}{3} \\approx \\frac{\\tau F}{c}$.\n- Ionization Front Speed: The photon supply rate $v_{phot} = \\frac{F}{\\epsilon n_{\\rm H}}$ remains a key factor. However, the effective propagation speed of the radiation front is the diffusion speed, $v_{diff} \\approx D/L = \\frac{c}{3\\kappa\\rho L} = \\frac{c}{3\\tau}$. This serves as the upper bound. So, $v_I^{\\rm true} = \\min\\left(\\frac{F}{\\epsilon n_{\\rm H}}, \\frac{c}{3\\tau}\\right)$.\n- Shock Indicator: $\\Theta^{\\rm true} = \\frac{P_r^{\\rm true}}{P_r^{\\rm true} + P_g} = \\frac{\\tau F / c}{\\tau F / c + n_{\\rm H} k_{\\rm B} T}$.\n\nRSLA-affected Quantities (using $c_{\\rm red}$):\nThe RSLA modifies the diffusion coefficient to $D_{\\rm red} = \\frac{c_{\\rm red}}{3\\kappa\\rho}$.\n- RSLA Radiation Pressure: The flux-energy relation becomes $F \\approx \\frac{c_{\\rm red} E}{3\\tau}$, leading to $E \\approx \\frac{3\\tau F}{c_{\\rm red}}$. The pressure is then $P_r^{\\rm red} \\approx \\frac{E}{3} \\approx \\frac{\\tau F}{c_{\\rm red}}$.\n- RSLA Ionization Front Speed: The propagation speed limit is now the reduced diffusion speed, $v_{diff}^{\\rm red} \\approx \\frac{c_{\\rm red}}{3\\tau}$. Thus, $v_I^{\\rm red} = \\min\\left(\\frac{F}{\\epsilon n_{\\rm H}}, \\frac{c_{\\rm red}}{3\\tau}\\right)$.\n- RSLA Shock Indicator: $\\Theta^{\\rm red} = \\frac{P_r^{\\rm red}}{P_r^{\\red} + P_g} = \\frac{\\tau F / c_{\\rm red}}{\\tau F / c_{\\rm red} + n_{\\rm H} k_{\\rm B} T}$.\n\n**3. Fractional Errors**\n\nFor each case, we compute the following fractional errors:\n- $\\delta_{v_I} = \\frac{v_I^{\\rm red} - v_I^{\\rm true}}{v_I^{\\rm true}}}$\n- $\\delta_{P_r} = \\frac{P_r^{\\rm red} - P_r^{\\rm true}}{P_r^{\\rm true}}}$\n- $\\delta_{\\Theta} = \\frac{\\Theta^{\\rm red} - \\Theta^{\\rm true}}{\\Theta^{\\rm true}}}$\n\nBy inspection, the fractional error in radiation pressure is independent of the regime. Let $f = c/c_{\\rm red}$.\nIn the streaming regime, $P_r^{\\rm red} = F/c_{\\rm red} = (c/c_{\\rm red})(F/c) = f P_r^{\\rm true}$.\nIn the diffusive regime, $P_r^{\\rm red} = \\tau F/c_{\\rm red} = (c/c_{\\rm red})(\\tau F/c) = f P_r^{\\rm true}$.\nIn both regimes, we find the same simple relation for the pressure error:\n$\\delta_{P_r} = \\frac{f P_r^{\\rm true} - P_r^{\\rm true}}{P_r^{\\rm true}} = f - 1 = \\frac{c}{c_{\\rm red}} - 1$.\n\nThe error in the shock indicator can be expressed analytically as well. Let $X = P_r^{\\rm true}$ and $Y = P_g$.\n$\\Theta^{\\rm true} = \\frac{X}{X+Y}$ and $\\Theta^{\\rm red} = \\frac{fX}{fX+Y}$.\nThe fractional error is:\n$\\delta_{\\Theta} = \\frac{\\Theta^{\\rm red}}{\\Theta^{\\rm true}} - 1 = \\left(\\frac{fX}{fX+Y}\\right) \\left(\\frac{X+Y}{X}\\right) - 1 = \\frac{f(X+Y)}{fX+Y} - 1 = \\frac{fX + fY - fX - Y}{fX+Y} = \\frac{(f-1)Y}{fX+Y}$.\nThis can be rewritten in terms of $\\Theta^{\\rm true}$ as $\\delta_{\\Theta} = \\frac{(f-1)(1-\\Theta^{\\rm true})}{1+(f-1)\\Theta^{\\rm true}}$.\n\nThe error in the I-front speed, $\\delta_{v_I}$, is more complex due to the `min` function and must be evaluated on a case-by-case basis.\n\n**4. Computational Procedure for Test Cases**\n\nFor each set of parameters ($n_{\\rm H}$, $F$, $\\kappa$, $L$, $T$, $c_{\\rm red}/c$):\n1.  Define physical constants: $c = 2.99792458 \\times 10^8$ m/s, $k_{\\rm B} = 1.380649 \\times 10^{-23}$ J/K, $m_p = 1.67262192369 \\times 10^{-27}$ kg, $\\epsilon = 20 \\times 1.602176634 \\times 10^{-19}$ J.\n2.  Calculate derived parameters: $\\rho = n_{\\rm H} m_p$, $\\tau = \\kappa \\rho L$, $P_g = n_{\\rm H} k_{\\rm B} T$, and $c_{\\rm red} = (c_{\\rm red}/c) \\times c$. For case $4$, the flux $F$ must be calculated first as $F = c n_{\\rm H} \\epsilon$.\n3.  Determine the regime by comparing $\\tau$ to $10^{-2}$.\n4.  Apply the appropriate set of formulas (streaming or diffusive) to calculate $P_r^{\\rm true}$, $P_r^{\\rm red}$, $v_I^{\\rm true}$, $v_I^{\\rm red}$, $\\Theta^{\\rm true}$, and $\\Theta^{\\rm red}$.\n5.  Compute the three fractional errors $\\delta_{P_r}$, $\\delta_{v_I}$, and $\\delta_{\\Theta}$. The denominators for these fractions must be non-zero, which is guaranteed by the problem parameters.\n6.  The results are then aggregated and formatted as required.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the fractional numerical error introduced by the reduced\n    speed-of-light approximation (RSLA) on key radiation-hydrodynamics\n    observables in numerical cosmology.\n    \"\"\"\n    # Physical Constants in SI units\n    C = 2.99792458e8  # Speed of light (m/s)\n    K_B = 1.380649e-23  # Boltzmann constant (J/K)\n    M_P = 1.67262192369e-27  # Proton mass (kg)\n    EPSILON_eV = 20.0  # Mean ionizing photon energy in eV\n    e_charge = 1.602176634e-19 # Elementary charge in C\n    EPSILON = EPSILON_eV * e_charge # Mean ionizing photon energy (J)\n\n    # Test cases from the problem statement\n    # Each case is a tuple: (n_H, F_or_calc_flag, kappa, L, T, c_red_ratio)\n    # F_or_calc_flag is either the flux F or a string 'calc' for Case 4\n    test_cases = [\n        # Case 1 (streaming, saturation by c)\n        (1e6, 1.024e-1, 4.0e-2, 1e9, 1e4, 1e-2),\n        # Case 2 (streaming, photon-limited)\n        (1e10, 1e-3, 4.0e-2, 1e9, 1e4, 1e-1),\n        # Case 3 (diffusion, high optical depth)\n        (1e16, 10.0, 4.0e-2, 1e13, 1e5, 1e-2),\n        # Case 4 (streaming, boundary phi/n_H = c)\n        (1e8, 'calc', 4.0e-2, 1e9, 1e4, 3e-2),\n    ]\n\n    results = []\n\n    for case in test_cases:\n        n_H, F_val, kappa, L, T, c_red_ratio = case\n\n        # Calculate flux for Case 4\n        if F_val == 'calc':\n            F = C * n_H * EPSILON\n        else:\n            F = F_val\n\n        # Preliminiary calculations\n        rho = n_H * M_P\n        tau = kappa * rho * L\n        P_g = n_H * K_B * T\n        c_red = c_red_ratio * C\n\n        # Determine regime\n        is_streaming = tau  1e-2\n\n        if is_streaming:\n            # --- Streaming Regime ---\n            # I-front Speed\n            v_phot = F / (EPSILON * n_H)\n            v_I_true = min(v_phot, C)\n            v_I_red = min(v_phot, c_red)\n            \n            # Radiation Pressure\n            P_r_true = F / C\n            P_r_red = F / c_red\n        else:\n            # --- Diffusive Regime ---\n            # I-front Speed\n            v_phot = F / (EPSILON * n_H)\n            v_diff_true = C / (3 * tau)\n            v_diff_red = c_red / (3 * tau)\n            v_I_true = min(v_phot, v_diff_true)\n            v_I_red = min(v_phot, v_diff_red)\n\n            # Radiation Pressure\n            P_r_true = tau * F / C\n            P_r_red = tau * F / c_red\n\n        # Shock indicator (calculation is the same form for both regimes)\n        # Avoid division by zero if P_r_true + P_g is zero\n        denom_true = P_r_true + P_g\n        Theta_true = P_r_true / denom_true if denom_true != 0 else 0.0\n\n        denom_red = P_r_red + P_g\n        Theta_red = P_r_red / denom_red if denom_red != 0 else 0.0\n\n        # Calculate fractional errors\n        # Avoid division by zero if true values are zero\n        delta_vI = (v_I_red - v_I_true) / v_I_true if v_I_true != 0 else 0.0\n        delta_Pr = (P_r_red - P_r_true) / P_r_true if P_r_true != 0 else 0.0\n        delta_Theta = (Theta_red - Theta_true) / Theta_true if Theta_true != 0 else 0.0\n\n        results.extend([delta_vI, delta_Pr, delta_Theta])\n\n    # Format the final output string\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3482963"}, {"introduction": "The energy exchange between matter and radiation can be an extremely rapid process, making the governing equations mathematically 'stiff'. Explicit time integration schemes become unstable or prohibitively expensive when dealing with such stiffness. This final practice [@problem_id:3482949] guides you through the construction of an implicit solver, a standard and robust technique for handling stiff coupling. By implementing a Newton-Raphson iteration for the implicit update, you will gain direct experience with the core algorithms that ensure the stability and accuracy of modern radiation-hydrodynamics codes.", "problem": "Consider grey radiation-hydrodynamics coupling in a homogeneous cell in numerical cosmology, where the radiation energy density $E_r$ and the matter internal energy density $u$ exchange energy through isotropic emission and absorption. Assume the grey (frequency-integrated) Planck mean opacity $\\kappa_P$ and adopt an ideal-gas closure for the matter such that $u = \\rho c_v T$, where $\\rho$ is the mass density, $c_v$ is the specific heat at constant volume, and $T$ is the temperature. The radiation energy density $E_r$ obeys the coupling through the Planck source proportional to $a_r T^4$, where $a_r$ is the radiation constant, and the coupling is scaled by the speed of light $c$. The fundamental continuous coupling laws are\n$$\n\\frac{dE_r}{dt} = c\\,\\kappa_P\\left(a_r T^4 - E_r\\right) + \\text{(non-stiff terms)},\n$$\n$$\n\\frac{du}{dt} = -\\,c\\,\\kappa_P\\left(a_r T^4 - E_r\\right) + \\text{(non-stiff terms)},\n$$\nwith $T = \\frac{u}{\\rho c_v}$.\n\nYour task is to construct a time integrator that treats the stiff radiation-matter source term implicitly and the remaining non-stiff terms explicitly, i.e., an Implicit-Explicit (IMEX) method. The implicit part must be $L$-stable. You shall:\n\n- Start from the above laws and split the right-hand side into a stiff source $S(\\cdot)$ and a non-stiff part $N(\\cdot)$, each defined in terms of the variables $E_r$ and $u$ and parameters $\\rho$, $c_v$, $\\kappa_P$, $a_r$, and $c$.\n- Design a single-step IMEX time discretization that is $L$-stable on the implicit part (the stiff source $S(\\cdot)$), and explain how $L$-stability is ensured in the implicit sub-step for linearized dynamics.\n- Derive the nonlinear algebraic system for the stiff sub-step over one time step of size $\\Delta t$ when the non-stiff part is set to zero (i.e., for this exercise, the explicit term $N(\\cdot)$ is zero), and outline a Newton–Raphson iteration to solve this system. In particular, provide a linearization of the Planck source $a_r T^4$ with respect to $E_r$ and $u$ and construct the associated Jacobian entries needed by Newton’s method.\n\nYou must implement a self-contained program that performs one IMEX step for the stiff source-only coupling (i.e., with the explicit part set to zero) using your derived $L$-stable implicit method and Newton linearization for the Planck source. Use dimensionless code units (no physical units) and ensure positivity of $E_r$ and $u$ in the iteration. The program must compute and return the updated values $\\left[E_r^{n+1},u^{n+1}\\right]$ for each test case below.\n\nTest suite (each tuple lists $\\left(\\rho, c_v, \\kappa_P, a_r, c, \\Delta t, E_r^n, u^n\\right)$):\n\n- Case $1$ (equilibrium consistency): $\\left(1.0, 1.0, 100.0, 1.0, 1.0\\times 10^5, 1.0\\times 10^{-3}, 1.0, 1.0\\right)$.\n- Case $2$ (stiff relaxation, radiation-dominated initial state): $\\left(1.0, 1.0, 1000.0, 1.0, 1.0\\times 10^5, 1.0\\times 10^{-3}, 10.0, 0.1\\right)$.\n- Case $3$ (weak coupling, near-non-stiff): $\\left(1.0, 1.0, 1.0\\times 10^{-3}, 1.0, 10.0, 1.0\\times 10^{-2}, 1.5, 1.0\\right)$.\n- Case $4$ (zero opacity, no change): $\\left(1.0, 1.0, 0.0, 1.0, 1.0\\times 10^5, 1.0\\times 10^{-3}, 2.0, 3.0\\right)$.\n- Case $5$ (extremely stiff step, large $\\Delta t$): $\\left(1.0, 1.0, 100.0, 1.0, 1.0\\times 10^5, 1.0\\times 10^{-1}, 0.2, 5.0\\right)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is the list $\\left[E_r^{n+1},u^{n+1}\\right]$ for the corresponding test case in the order given above. For example, the output format must be\n$$\n\\left[\\left[E_1,u_1\\right],\\left[E_2,u_2\\right],\\left[E_3,u_3\\right],\\left[E_4,u_4\\right],\\left[E_5,u_5\\right]\\right],\n$$\nwith each $E_i$ and $u_i$ represented as floating-point numbers in code units. Express all quantities in dimensionless code units.", "solution": "The problem requires the design and implementation of a numerical method to solve the stiff coupling equations for radiation energy density, $E_r$, and matter internal energy density, $u$, in a homogeneous cell. The method must be an Implicit-Explicit (IMEX) scheme where the stiff source terms are handled implicitly with an $L$-stable method.\n\n### Step 1: Problem Validation\n\n**Extraction of Givens:**\n*   **State Variables**: Radiation energy density $E_r$, matter internal energy density $u$.\n*   **Parameters**: Constant mass density $\\rho$, constant specific heat at constant volume $c_v$, grey Planck mean opacity $\\kappa_P$, radiation constant $a_r$, and the speed of light $c$.\n*   **Equation of State / Closure**: The matter is an ideal gas, so its temperature $T$ is related to its internal energy density $u$ by $u = \\rho c_v T$, which gives $T = u / (\\rho c_v)$.\n*   **Continuous Coupling Laws**: The time evolution of the state variables is governed by the system of ordinary differential equations (ODEs):\n    $$\n    \\frac{dE_r}{dt} = c\\,\\kappa_P\\left(a_r T^4 - E_r\\right) + \\text{(non-stiff terms)}\n    $$\n    $$\n    \\frac{du}{dt} = -\\,c\\,\\kappa_P\\left(a_r T^4 - E_r\\right) + \\text{(non-stiff terms)}\n    $$\n\n**Validation Using Extracted Givens:**\n1.  **Scientifically Grounded**: The problem describes the fundamental process of energy exchange between matter and radiation via thermal emission and absorption, a core concept in radiation hydrodynamics and astrophysics. The use of the Planck function $a_r T^4$ as the source for thermal radiation and the ideal gas law are standard, well-established physical models. The problem is scientifically sound.\n2.  **Well-Posed**: This is a standard initial value problem for a system of two coupled ODEs. The coupling term ensures energy conservation ($d(E_r+u)/dt=0$ for the stiff part), which leads to a stable physical equilibrium. The problem is well-posed.\n3.  **Objective**: The problem is stated in precise, formal, and unbiased scientific language.\n4.  **Complete and Consistent**: All necessary parameters ($\\rho, c_v, \\kappa_P, a_r, c$) and initial conditions ($E_r^n, u^n$) are provided for solving the specified task. The task specifically instructs to set the \"non-stiff terms\" to zero, resolving any ambiguity. No contradictions are present.\n\n**Verdict:** The problem is valid and self-contained. A solution can be constructed.\n\n### Step 2: Design of an L-Stable Implicit-Explicit (IMEX) Time Integrator\n\n**Splitting the System into Stiff and Non-Stiff Parts**\n\nLet the state vector be $\\mathbf{Y} = [E_r, u]^T$. The system of ODEs can be written in the form $\\frac{d\\mathbf{Y}}{dt} = \\mathbf{S}(\\mathbf{Y}) + \\mathbf{N}(\\mathbf{Y})$. The stiff source term, $\\mathbf{S}(\\mathbf{Y})$, arises from the matter-radiation coupling, which can occur on very short timescales when the opacity $\\kappa_P$ is large. The non-stiff part, $\\mathbf{N}(\\mathbf{Y})$, comprises all other terms, which for this problem are set to zero.\n\nThe stiff source term is:\n$$\n\\mathbf{S}(\\mathbf{Y}) = \\begin{pmatrix} S_1(E_r, u) \\\\ S_2(E_r, u) \\end{pmatrix} = \\begin{pmatrix} c\\,\\kappa_P\\left(a_r T(u)^4 - E_r\\right) \\\\ -c\\,\\kappa_P\\left(a_r T(u)^4 - E_r\\right) \\end{pmatrix}\n$$\nwhere $T(u) = u / (\\rho c_v)$. The non-stiff part is $\\mathbf{N}(\\mathbf{Y}) = \\mathbf{0}$.\n\nA crucial property of the source term is that it conserves total energy: $S_1 + S_2 = 0$, which implies $\\frac{d}{dt}(E_r + u) = 0$ for the stiff exchange part.\n\n**IMEX Discretization and L-Stability**\n\nA first-order IMEX scheme (IMEX-Euler) discretizes the system as:\n$$\n\\frac{\\mathbf{Y}^{n+1} - \\mathbf{Y}^n}{\\Delta t} = \\mathbf{S}(\\mathbf{Y}^{n+1}) + \\mathbf{N}(\\mathbf{Y}^n)\n$$\nSince $\\mathbf{N}(\\mathbf{Y})$ is set to zero, this reduces to the fully implicit Backward Euler method for the stiff source term:\n$$\n\\mathbf{Y}^{n+1} = \\mathbf{Y}^n + \\Delta t \\, \\mathbf{S}(\\mathbf{Y}^{n+1})\n$$\nThis choice of implicit method must be $L$-stable. To verify this, we consider the linear test equation $\\dot{y} = \\lambda y$, where $\\lambda \\in \\mathbb{C}$ and $\\text{Re}(\\lambda)  0$. The Backward Euler method gives $y^{n+1} = y^n + \\Delta t \\lambda y^{n+1}$, leading to the amplification factor $R(z) = y^{n+1}/y^n = (1-z)^{-1}$, where $z = \\lambda \\Delta t$. $L$-stability requires that $\\lim_{\\text{Re}(z) \\to -\\infty} |R(z)| = 0$. For the Backward Euler method,\n$$\n\\lim_{z \\to -\\infty} \\left| \\frac{1}{1-z} \\right| = 0\n$$\nThus, the Backward Euler method is $L$-stable. This property guarantees that for very stiff components (where $|\\lambda \\Delta t| \\gg 1$), the numerical solution is strongly damped towards equilibrium, preventing spurious oscillations and allowing for large time steps $\\Delta t$.\n\n### Step 3: Newton-Raphson Iteration for the Implicit Sub-step\n\nThe Backward Euler step requires solving the following nonlinear algebraic system for the unknown state $\\mathbf{Y}^{n+1} = [E_r^{n+1}, u^{n+1}]^T$:\n$$\n\\mathbf{F}(\\mathbf{Y}^{n+1}) \\equiv \\mathbf{Y}^{n+1} - \\mathbf{Y}^n - \\Delta t \\, \\mathbf{S}(\\mathbf{Y}^{n+1}) = \\mathbf{0}\n$$\nWe solve this system using the Newton-Raphson method. Let $\\mathbf{Y}_k$ be the $k$-th iterative guess for $\\mathbf{Y}^{n+1}$. The update $\\Delta \\mathbf{Y}_k = \\mathbf{Y}_{k+1} - \\mathbf{Y}_k$ is found by solving the linear system:\n$$\n\\mathbf{J}(\\mathbf{Y}_k) \\Delta\\mathbf{Y}_k = -\\mathbf{F}(\\mathbf{Y}_k)\n$$\nwhere $\\mathbf{J}(\\mathbf{Y}_k)$ is the Jacobian matrix of $\\mathbf{F}$ evaluated at $\\mathbf{Y}_k$. The Jacobian is given by $\\mathbf{J} = \\frac{\\partial \\mathbf{F}}{\\partial \\mathbf{Y}} = \\mathbf{I} - \\Delta t \\frac{\\partial \\mathbf{S}}{\\partial \\mathbf{Y}}$, where $\\mathbf{I}$ is the $2 \\times 2$ identity matrix.\n\n**Linearization of the Planck Source and Jacobian Construction**\n\nTo find the Jacobian of the source, $\\mathbf{J}_S = \\frac{\\partial \\mathbf{S}}{\\partial \\mathbf{Y}}$, we linearize the Planck source term $a_r T^4$ with respect to $E_r$ and $u$.\nThe Planck source $B(T) = a_r T^4$ depends only on $u$ through $T(u) = u/(\\rho c_v)$.\n*   Linearization with respect to $E_r$:\n    $$\n    \\frac{\\partial B(T(u))}{\\partial E_r} = 0\n    $$\n*   Linearization with respect to $u$:\n    $$\n    \\frac{\\partial B(T(u))}{\\partial u} = \\frac{dB}{dT} \\frac{\\partial T}{\\partial u} = \\left(4 a_r T^3\\right) \\left(\\frac{1}{\\rho c_v}\\right) = \\frac{4 a_r T^3}{\\rho c_v}\n    $$\nThe partial derivatives of the source vector $\\mathbf{S}$ are:\n$$\n\\frac{\\partial S_1}{\\partial E_r} = \\frac{\\partial}{\\partial E_r} \\left[c\\,\\kappa_P\\left(a_r T^4 - E_r\\right)\\right] = -c\\,\\kappa_P\n$$\n$$\n\\frac{\\partial S_1}{\\partial u} = \\frac{\\partial}{\\partial u} \\left[c\\,\\kappa_P\\left(a_r T^4 - E_r\\right)\\right] = c\\,\\kappa_P \\frac{\\partial (a_r T^4)}{\\partial u} = \\frac{4 c\\,\\kappa_P a_r T^3}{\\rho c_v}\n$$\nSince $S_2 = -S_1$, we have $\\frac{\\partial S_2}{\\partial E_r} = c\\,\\kappa_P$ and $\\frac{\\partial S_2}{\\partial u} = -\\frac{4 c\\,\\kappa_P a_r T^3}{\\rho c_v}$.\nLet's define the term $\\alpha = \\frac{4 c\\,\\kappa_P a_r T^3}{\\rho c_v}$. The Jacobian of the source is:\n$$\n\\mathbf{J}_S = \\frac{\\partial \\mathbf{S}}{\\partial \\mathbf{Y}} = \\begin{pmatrix} -c\\,\\kappa_P  \\alpha \\\\ c\\,\\kappa_P  -\\alpha \\end{pmatrix}\n$$\nThe full Jacobian for the Newton iteration is:\n$$\n\\mathbf{J} = \\mathbf{I} - \\Delta t \\, \\mathbf{J}_S = \\begin{pmatrix} 1 + \\Delta t c\\,\\kappa_P  -\\Delta t \\alpha \\\\ -\\Delta t c\\,\\kappa_P  1 + \\Delta t \\alpha \\end{pmatrix}\n$$\n\n**Simplified 1D Newton-Raphson Solver**\n\nAs noted, the stiff source conserves total energy. Summing the two equations in the Backward Euler system gives:\n$(E_r^{n+1} - E_r^n) + (u^{n+1} - u^n) = \\Delta t (S_1 + S_2) = 0$.\nThis implies $E_r^{n+1} + u^{n+1} = E_r^n + u^n$. Let $C_{tot} = E_r^n + u^n$ be the constant total energy.\nWe can eliminate $E_r^{n+1} = C_{tot} - u^{n+1}$ and reduce the $2 \\times 2$ system to a single non-linear equation for $x = u^{n+1}$:\n$$\ng(x) \\equiv x - u^n - \\Delta t \\left[-c\\,\\kappa_P\\left(a_r \\left(\\frac{x}{\\rho c_v}\\right)^4 - (C_{tot} - x)\\right)\\right] = 0\n$$\n$$\ng(x) = x - u^n + \\Delta t \\, c\\,\\kappa_P\\left(a_r \\left(\\frac{x}{\\rho c_v}\\right)^4 + x - C_{tot}\\right) = 0\n$$\nThis scalar equation can be solved efficiently with Newton's method: $x_{k+1} = x_k - g(x_k)/g'(x_k)$. The derivative $g'(x)$ is:\n$$\ng'(x) = 1 + \\Delta t \\, c\\,\\kappa_P\\left(a_r \\frac{4 x^3}{(\\rho c_v)^4} + 1\\right) = 1 + \\Delta t \\left(\\frac{4 c\\,\\kappa_P a_r T^3}{\\rho c_v} + c\\,\\kappa_P\\right) = 1 + \\Delta t(\\alpha + c\\,\\kappa_P)\n$$\n(Note: $T$ is computed using $x$). This is precisely the determinant of the $2 \\times 2$ Jacobian $\\mathbf{J}$, highlighting the equivalence of the methods.\nThe iteration starts with an initial guess $x_0 = u^n$. To ensure physical solutions, we enforce positivity for $u$ and $E_r$. Since $u^{n+1} \\in (0, C_{tot})$, if a Newton step $x_{k+1}$ falls outside this range, a backtracking line search (e.g., step halving) is applied to the update until the new guess is valid.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the radiation-matter coupling problem\n    for a suite of test cases.\n    \"\"\"\n\n    # Test suite from the problem statement.\n    # Each tuple: (rho, cv, kappa_P, ar, c, dt, Er_n, u_n)\n    test_cases = [\n        (1.0, 1.0, 100.0, 1.0, 1.0e5, 1.0e-3, 1.0, 1.0),\n        (1.0, 1.0, 1000.0, 1.0, 1.0e5, 1.0e-3, 10.0, 0.1),\n        (1.0, 1.0, 1.0e-3, 1.0, 10.0, 1.0e-2, 1.5, 1.0),\n        (1.0, 1.0, 0.0, 1.0, 1.0e5, 1.0e-3, 2.0, 3.0),\n        (1.0, 1.0, 100.0, 1.0, 1.0e5, 1.0e-1, 0.2, 5.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        rho, cv, kappa_P, ar, c, dt, Er_n, u_n = case\n        Er_np1, u_np1 = perform_implicit_step(rho, cv, kappa_P, ar, c, dt, Er_n, u_n)\n        results.append([Er_np1, u_np1])\n\n    # Custom string formatting to match the required output format.\n    result_str = \"[\" + \",\".join([f\"[{e:.7e},{u:.7e}]\" for e, u in results]) + \"]\"\n    print(result_str)\n\n\ndef perform_implicit_step(rho, cv, kappa_P, ar, c, dt, Er_n, u_n):\n    \"\"\"\n    Performs one implicit Backward Euler step for the stiff source term\n    using a 1D Newton-Raphson solver.\n\n    Args:\n        rho (float): Mass density.\n        cv (float): Specific heat at constant volume.\n        kappa_P (float): Planck mean opacity.\n        ar (float): Radiation constant.\n        c (float): Speed of light.\n        dt (float): Time step size.\n        Er_n (float): Radiation energy density at time n.\n        u_n (float): Matter internal energy density at time n.\n\n    Returns:\n        tuple[float, float]: The updated state (Er_np1, u_np1).\n    \"\"\"\n\n    # If opacity is zero, there is no coupling, so no change.\n    if kappa_P == 0.0:\n        return Er_n, u_n\n\n    # Total energy is conserved by the source term.\n    total_energy = Er_n + u_n\n\n    # Initial guess for u_np1 is u_n.\n    u_k = float(u_n)\n\n    # Newton-Raphson solver parameters\n    max_iter = 50\n    tol = 1.0e-12\n\n    for _ in range(max_iter):\n        # Ensure positivity of u_k. This should be handled by the line search,\n        # but as a safeguard, we floor it at a small positive number.\n        if u_k = 0:\n            u_k = tol * 1e-3 # small positive value\n\n        # The state at iteration k must be within physical bounds\n        # u must be positive, and Er = total_energy - u must be positive.\n        u_k = min(max(u_k, tol), total_energy - tol)\n\n        # Calculate a_r * T^4 and its derivative with respect to u.\n        # T = u / (rho * cv)\n        # Using np.isclose to handle potential zero denominators safely.\n        if np.isclose(rho * cv, 0.0):\n            temp_term_u = 0.0\n            deriv_term_u = 0.0\n        else:\n            inv_rho_cv = 1.0 / (rho * cv)\n            T_k = u_k * inv_rho_cv\n            T_k_3 = T_k**3\n            T_k_4 = T_k * T_k_3\n            \n            temp_term_u = ar * T_k_4\n            deriv_term_u = 4.0 * ar * T_k_3 * inv_rho_cv\n\n        # Define the residual function g(u_k) for the 1D Newton solver.\n        # g(x) = x - u_n + dt*c*kappa_P*(ar*(x/(rho*cv))^4 + x - total_energy) = 0\n        g = u_k - u_n + dt * c * kappa_P * (temp_term_u + u_k - total_energy)\n        \n        # Check for convergence based on the residual norm\n        if abs(g)  tol:\n            break\n\n        # Define the derivative of the residual function, g'(u_k).\n        # g'(x) = 1 + dt*c*kappa_P*(4*ar*x^3/(rho*cv)^4 + 1)\n        g_prime = 1.0 + dt * c * kappa_P * (deriv_term_u + 1.0)\n        \n        # Calculate Newton step\n        delta_u = -g / g_prime\n\n        # Backtracking line search to enforce positivity of u and Er\n        lambda_step = 1.0\n        while True:\n            u_trial = u_k + lambda_step * delta_u\n            if u_trial > 0 and u_trial  total_energy:\n                u_k = u_trial\n                break\n            lambda_step *= 0.5\n            if lambda_step  1.0e-8: # Failsafe to prevent infinite loops\n                # If step is too small, just accept the last valid state\n                break\n        \n        if abs(lambda_step * delta_u)  tol * (1.0 + abs(u_k)):\n             break\n    \n    # After convergence, u_np1 is u_k\n    u_np1 = u_k\n    # Er_np1 is determined by energy conservation\n    Er_np1 = total_energy - u_np1\n\n    return Er_np1, u_np1\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3482949"}]}