{"hands_on_practices": [{"introduction": "This first practice problem connects the theoretical machinery of accretion disk physics to the observable phenomenon of variability. By deriving a characteristic fluctuation timescale from a given power spectral density, you will reinforce your understanding of the fundamental timescales (dynamical, thermal, and viscous) that govern disk evolution [@problem_id:3479056]. This exercise highlights how abstract disk parameters can be linked to concrete, measurable quantities, a crucial skill in astrophysical modeling.", "problem": "Consider a geometrically thin, radiatively efficient Shakura–Sunyaev $\\alpha$-disk around a non-spinning black hole of mass $M=10^8\\,M_\\odot$. Let the cylindrical radius of interest be $R=50\\,r_g$, where the gravitational radius is $r_g \\equiv GM/c^2$. Assume that stochastic fluctuations in the local mass accretion rate at radius $R$ have a flicker-noise Power Spectral Density (PSD) $P(f)\\propto f^{-1}$ over a finite frequency band bounded by a low-frequency cutoff $f_{\\min}$ and a high-frequency cutoff $f_{\\max}$. Adopt the following physically motivated identifications: the high-frequency cutoff is set by the local dynamical (orbital) time, $f_{\\max} = 1/t_{\\mathrm{dyn}}(R)$, and the low-frequency cutoff is set by the local viscous time, $f_{\\min} = 1/t_{\\mathrm{visc}}(R)$. Use the standard thin-disk timescale hierarchy with $\\alpha$-viscosity: the Keplerian angular frequency $\\Omega_K(R)=\\sqrt{GM/R^3}$, the dynamical time $t_{\\mathrm{dyn}}(R)=2\\pi/\\Omega_K(R)$, the thermal time $t_{\\mathrm{th}}(R)=\\alpha^{-1} t_{\\mathrm{dyn}}(R)$, and the viscous time $t_{\\mathrm{visc}}(R)=(r/h)^2 t_{\\mathrm{th}}(R)$, where $h/r$ is the constant disk aspect ratio. Take $\\alpha=0.1$ and $h/r=0.05$ at the radius $R=50\\,r_g$.\n\nDefine the characteristic variability frequency $f_{\\mathrm{var}}$ of the flicker-noise process on the band $[f_{\\min},f_{\\max}]$ as the logarithmic-centroid of the variance per logarithmic frequency interval,\n$$\nf_{\\mathrm{var}} \\equiv \\exp\\!\\left(\\frac{\\int_{\\ln f_{\\min}}^{\\ln f_{\\max}} \\ln f \\, w(f)\\, d\\ln f}{\\int_{\\ln f_{\\min}}^{\\ln f_{\\max}} w(f)\\, d\\ln f}\\right),\n$$\nwhere the weight is the variance density per logarithmic interval $w(f)\\propto f P(f)$. The corresponding characteristic variability timescale is $t_{\\mathrm{var}} \\equiv 1/f_{\\mathrm{var}}$.\n\nStarting from the definitions above and the identifications for $f_{\\min}$ and $f_{\\max}$, derive an analytic expression for $t_{\\mathrm{var}}$ at $R=50\\,r_g$ in terms of fundamental constants and the given disk parameters. Then evaluate it numerically for $M=10^8\\,M_\\odot$, and express the final result in days. Round your final numerical answer to $3$ significant figures.\n\nUse the constants $G=6.67430\\times 10^{-11}\\,\\mathrm{m^3\\,kg^{-1}\\,s^{-2}}$, $c=2.99792458\\times 10^8\\,\\mathrm{m\\,s^{-1}}$, and $M_\\odot=1.98847\\times 10^{30}\\,\\mathrm{kg}$.", "solution": "### Step 1: Extract Givens\nThe problem statement provides the following information:\n-   Black hole mass: $M=10^8\\,M_\\odot$\n-   Spin: non-spinning black hole\n-   Accretion disk model: geometrically thin, radiatively efficient Shakura–Sunyaev $\\alpha$-disk\n-   Radius of interest: $R=50\\,r_g$\n-   Gravitational radius definition: $r_g \\equiv GM/c^2$\n-   Power Spectral Density (PSD) of mass accretion rate fluctuations: $P(f)\\propto f^{-1}$\n-   Frequency band: $[f_{\\min}, f_{\\max}]$\n-   High-frequency cutoff: $f_{\\max} = 1/t_{\\mathrm{dyn}}(R)$\n-   Low-frequency cutoff: $f_{\\min} = 1/t_{\\mathrm{visc}}(R)$\n-   Timescale hierarchy definitions:\n    -   Keplerian angular frequency: $\\Omega_K(R)=\\sqrt{GM/R^3}$\n    -   Dynamical time: $t_{\\mathrm{dyn}}(R)=2\\pi/\\Omega_K(R)$\n    -   Thermal time: $t_{\\mathrm{th}}(R)=\\alpha^{-1} t_{\\mathrm{dyn}}(R)$\n    -   Viscous time: $t_{\\mathrm{visc}}(R)=(r/h)^2 t_{\\mathrm{th}}(R)$, where $h/r$ is the constant disk aspect ratio\n-   Disk parameters at radius $R$:\n    -   Viscosity parameter: $\\alpha=0.1$\n    -   Disk aspect ratio: $h/r=0.05$\n-   Definition of characteristic variability frequency:\n    $f_{\\mathrm{var}} \\equiv \\exp\\!\\left(\\frac{\\int_{\\ln f_{\\min}}^{\\ln f_{\\max}} \\ln f \\, w(f)\\, d\\ln f}{\\int_{\\ln f_{\\min}}^{\\ln f_{\\max}} w(f)\\, d\\ln f}\\right)$\n-   Weight function: $w(f)\\propto f P(f)$\n-   Definition of characteristic variability timescale: $t_{\\mathrm{var}} \\equiv 1/f_{\\mathrm{var}}$\n-   Constants:\n    -   $G=6.67430\\times 10^{-11}\\,\\mathrm{m^3\\,kg^{-1}\\,s^{-2}}$\n    -   $c=2.99792458\\times 10^8\\,\\mathrm{m\\,s^{-1}}$\n    -   $M_\\odot=1.98847\\times 10^{30}\\,\\mathrm{kg}$\n-   Required output: an analytic expression for $t_{\\mathrm{var}}$ and its numerical value in days, rounded to $3$ significant figures.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded in the well-established theory of black hole accretion disks, specifically the Shakura-Sunyaev model. The definitions for the physical timescales (dynamical, thermal, viscous) are standard in the field. The concept of a flicker-noise PSD ($f^{-1}$) is commonly observed in accretion systems. The definition of the characteristic frequency as a logarithmic centroid is mathematically well-posed and objective. All parameters are clearly defined, and the given numerical values are physically realistic for a supermassive black hole. The problem is self-contained, consistent, and requires a solution based on established physical and mathematical principles, with no apparent flaws.\n\n### Step 3: Verdict and Action\nThe problem is valid. I will proceed with the solution.\n\n### Derivation of the Analytic Expression\n\nFirst, we determine the characteristic variability frequency, $f_{\\mathrm{var}}$. The weight function $w(f)$ is proportional to $f P(f)$. Given that the PSD is $P(f) \\propto f^{-1}$, we can write $P(f) = k f^{-1}$ for some constant $k$. The weight function is therefore $w(f) \\propto f (k f^{-1}) = k$, which is a constant. Let's denote this constant as $C$.\n\nThe definition of $f_{\\mathrm{var}}$ involves the quantity $\\ln f_{\\mathrm{var}}$:\n$$ \\ln f_{\\mathrm{var}} = \\frac{\\int_{\\ln f_{\\min}}^{\\ln f_{\\max}} \\ln f \\, w(f)\\, d(\\ln f)}{\\int_{\\ln f_{\\min}}^{\\ln f_{\\max}} w(f)\\, d(\\ln f)} $$\nSince $w(f)=C$ is a constant, it can be factored out of the integrals and cancelled:\n$$ \\ln f_{\\mathrm{var}} = \\frac{\\int_{\\ln f_{\\min}}^{\\ln f_{\\max}} \\ln f \\, d(\\ln f)}{\\int_{\\ln f_{\\min}}^{\\ln f_{\\max}} d(\\ln f)} $$\nLet $u = \\ln f$. The integrals become:\n$$ \\ln f_{\\mathrm{var}} = \\frac{\\int_{\\ln f_{\\min}}^{\\ln f_{\\max}} u \\, du}{\\int_{\\ln f_{\\min}}^{\\ln f_{\\max}} du} = \\frac{\\left[ \\frac{1}{2}u^2 \\right]_{\\ln f_{\\min}}^{\\ln f_{\\max}}  }{ \\left[ u \\right]_{\\ln f_{\\min}}^{\\ln f_{\\max}} } = \\frac{\\frac{1}{2}((\\ln f_{\\max})^2 - (\\ln f_{\\min})^2)}{\\ln f_{\\max} - \\ln f_{\\min}} $$\nUsing the difference of squares, $a^2-b^2=(a-b)(a+b)$:\n$$ \\ln f_{\\mathrm{var}} = \\frac{\\frac{1}{2}(\\ln f_{\\max} - \\ln f_{\\min})(\\ln f_{\\max} + \\ln f_{\\min})}{\\ln f_{\\max} - \\ln f_{\\min}} = \\frac{1}{2}(\\ln f_{\\max} + \\ln f_{\\min}) $$\nUsing logarithm properties, this simplifies to:\n$$ \\ln f_{\\mathrm{var}} = \\ln((f_{\\max} f_{\\min})^{1/2}) $$\nExponentiating both sides gives the characteristic frequency as the geometric mean of the boundary frequencies:\n$$ f_{\\mathrm{var}} = \\sqrt{f_{\\max}f_{\\min}} $$\nThe characteristic timescale is $t_{\\mathrm{var}} = 1/f_{\\mathrm{var}}$. Substituting the expression for $f_{\\mathrm{var}}$:\n$$ t_{\\mathrm{var}} = \\frac{1}{\\sqrt{f_{\\max}f_{\\min}}} $$\nThe problem identifies $f_{\\max} = 1/t_{\\mathrm{dyn}}(R)$ and $f_{\\min} = 1/t_{\\mathrm{visc}}(R)$. Substituting these into the expression for $t_{\\mathrm{var}}$ gives:\n$$ t_{\\mathrm{var}} = \\frac{1}{\\sqrt{(1/t_{\\mathrm{dyn}}(R))(1/t_{\\mathrm{visc}}(R))}} = \\sqrt{t_{\\mathrm{dyn}}(R) t_{\\mathrm{visc}}(R)} $$\nNext, we express $t_{\\mathrm{visc}}(R)$ in terms of $t_{\\mathrm{dyn}}(R)$ and the disk parameters. The definitions are $t_{\\mathrm{th}}(R) = \\alpha^{-1} t_{\\mathrm{dyn}}(R)$ and $t_{\\mathrm{visc}}(R)=(r/h)^2 t_{\\mathrm{th}}(R)$. We are given the aspect ratio as $h/r$, so $(r/h)=(h/r)^{-1}$.\n$$ t_{\\mathrm{visc}}(R) = \\left(\\frac{h}{r}\\right)^{-2} t_{\\mathrm{th}}(R) = \\left(\\frac{h}{r}\\right)^{-2} \\alpha^{-1} t_{\\mathrm{dyn}}(R) $$\nNow, we substitute this into the expression for $t_{\\mathrm{var}}$:\n$$ t_{\\mathrm{var}} = \\sqrt{t_{\\mathrm{dyn}}(R) \\left[ \\left(\\frac{h}{r}\\right)^{-2} \\alpha^{-1} t_{\\mathrm{dyn}}(R) \\right]} = \\sqrt{t_{\\mathrm{dyn}}(R)^2 \\left(\\frac{h}{r}\\right)^{-2} \\alpha^{-1}} $$\n$$ t_{\\mathrm{var}} = t_{\\mathrm{dyn}}(R) \\left(\\frac{h}{r}\\right)^{-1} \\alpha^{-1/2} $$\nThe dynamical time is $t_{\\mathrm{dyn}}(R) = 2\\pi / \\Omega_K(R) = 2\\pi \\sqrt{R^3/(GM)}$. The radius is $R=50\\,r_g = 50\\,GM/c^2$.\n$$ t_{\\mathrm{dyn}}(R) = 2\\pi \\sqrt{\\frac{(50GM/c^2)^3}{GM}} = 2\\pi \\sqrt{\\frac{50^3 G^3 M^3 / c^6}{GM}} = 2\\pi \\sqrt{\\frac{50^3 G^2 M^2}{c^6}} $$\n$$ t_{\\mathrm{dyn}}(R) = 2\\pi \\cdot 50^{3/2} \\frac{GM}{c^3} $$\nFinally, we substitute this expression for $t_{\\mathrm{dyn}}(R)$ into the equation for $t_{\\mathrm{var}}$ to obtain the full analytic expression:\n$$ t_{\\mathrm{var}} = \\left( 2\\pi \\cdot 50^{3/2} \\frac{GM}{c^3} \\right) \\left(\\frac{h}{r}\\right)^{-1} \\alpha^{-1/2} $$\nThis expression for $t_{\\mathrm{var}}$ is in terms of the fundamental constants $G$ and $c$, the black hole mass $M$, and the disk parameters $\\alpha$ and $h/r$, as requested.\n\n### Numerical Evaluation\n\nWe are given the following values:\n-   $M = 10^8 M_\\odot = 10^8 \\times 1.98847 \\times 10^{30}\\,\\mathrm{kg} = 1.98847 \\times 10^{38}\\,\\mathrm{kg}$\n-   $G = 6.67430 \\times 10^{-11}\\,\\mathrm{m^3\\,kg^{-1}\\,s^{-2}}$\n-   $c = 2.99792458 \\times 10^8\\,\\mathrm{m\\,s^{-1}}$\n-   $\\alpha = 0.1$\n-   $h/r = 0.05$\n\nFirst, let's calculate the light-crossing time of the gravitational radius, $t_g = GM/c^3$:\n$$ t_g = \\frac{(6.67430 \\times 10^{-11}\\,\\mathrm{m^3\\,kg^{-1}\\,s^{-2}}) \\times (1.98847 \\times 10^{38}\\,\\mathrm{kg})}{(2.99792458 \\times 10^8\\,\\mathrm{m\\,s^{-1}})^3} $$\n$$ t_g \\approx \\frac{1.32712 \\times 10^{28}\\,\\mathrm{m^3\\,s^{-2}}}{2.69440 \\times 10^{25}\\,\\mathrm{m^3\\,s^{-3}}} \\approx 492.549\\,\\mathrm{s} $$\nNext, we calculate the dynamical time $t_{\\mathrm{dyn}}$ at $R=50\\,r_g$:\n$$ t_{\\mathrm{dyn}} = 2\\pi \\cdot 50^{3/2} t_g = 2\\pi \\cdot (50 \\sqrt{50}) \\cdot t_g \\approx 2\\pi \\cdot 353.553 \\cdot 492.549\\,\\mathrm{s} \\approx 1094060\\,\\mathrm{s} $$\nNow, we calculate the characteristic timescale $t_{\\mathrm{var}}$:\n$$ t_{\\mathrm{var}} = t_{\\mathrm{dyn}} \\left(\\frac{h}{r}\\right)^{-1} \\alpha^{-1/2} = t_{\\mathrm{dyn}} \\cdot (0.05)^{-1} \\cdot (0.1)^{-1/2} $$\n$$ t_{\\mathrm{var}} = t_{\\mathrm{dyn}} \\cdot (20) \\cdot \\sqrt{10} \\approx 1094060\\,\\mathrm{s} \\times 20 \\times 3.16228 \\approx 69192430\\,\\mathrm{s} $$\nFinally, we convert the result from seconds to days. The number of seconds in one day is $24 \\times 60 \\times 60 = 86400\\,\\mathrm{s}$.\n$$ t_{\\mathrm{var}} \\text{ (in days)} = \\frac{69192430\\,\\mathrm{s}}{86400\\,\\mathrm{s/day}} \\approx 800.838\\,\\text{days} $$\nRounding to $3$ significant figures, we get $801$ days.", "answer": "$$\n\\boxed{801}\n$$", "id": "3479056"}, {"introduction": "Cosmological simulations often lack the resolution to model accretion disks from first principles, necessitating the use of \"subgrid\" models to capture their effects. This exercise guides you through the process of constructing and calibrating such a model, a foundational skill in computational astrophysics [@problem_id:3479059]. You will use principles of gravitational stability and viscous transport to create a simplified accretion rate formula and then calibrate it against a more detailed theoretical model, providing hands-on experience with the art of physically-motivated approximation.", "problem": "You are tasked with constructing and calibrating a physically motivated, but subgrid, accretion prescription limited by angular momentum transport for a black hole embedded in an isolated gaseous disk. The calibration is performed by comparing against a controlled “ground-truth” model of a gravito-turbulent, viscous disk patch at a fixed galactocentric radius. The goal is to derive, implement, and test a calibration constant relating the subgrid model to the disk model over a small suite of cases with varying Toomre stability and vertical thickness.\n\nFundamental base and assumptions:\n- Begin from the definition of the Toomre stability parameter $Q$, the hydrostatic relation for the disk scale height, and the standard viscous accretion mass flux. Specifically, adopt:\n  - Toomre parameter $Q$ defined by $Q \\equiv \\dfrac{c_s \\kappa}{\\pi G \\Sigma}$ for a thin, rotating disk, where $c_s$ is the sound speed, $\\kappa$ is the epicyclic frequency, $G$ is the gravitational constant, and $\\Sigma$ is the surface density.\n  - Local vertical hydrostatic equilibrium $H \\equiv \\dfrac{c_s}{\\Omega}$, and take $\\kappa \\approx \\Omega$ for the considered isolated disk patch.\n  - Viscous mass accretion rate relation $\\dot{M} \\equiv 3 \\pi \\nu \\Sigma$, where $\\nu \\equiv \\alpha_{\\mathrm{grav}} c_s H$ is the effective kinematic viscosity produced by gravitational torques, with $\\alpha_{\\mathrm{grav}}$ a dimensionless transport efficiency.\n\n- Close the “ground-truth” model for $\\alpha_{\\mathrm{grav}}$ with a well-tested monotonic suppression with increasing stability and increasing thickness:\n  - Let $Q_{\\mathrm{crit}} \\equiv 1$, and define\n    $$\\alpha_{\\mathrm{grav}}(Q,H/R) \\equiv \\dfrac{\\alpha_0}{1 + \\left(\\dfrac{Q}{Q_{\\mathrm{crit}}}\\right)^2} \\times \\dfrac{1}{1 + \\left(\\dfrac{H}{R}\\right)^2},$$\n    where $\\alpha_0$ is a constant of order unity, $R$ is the cylindrical radius of the patch, and $H/R$ is the disk aspect ratio. This choice reflects decreased gravitational torque efficiency with increasing $Q$ (greater stability) and with increasing thickness (weaker self-gravity).\n\n- Using the above, eliminate $\\Sigma$ with $Q$ and $H$ and obtain a “ground-truth” accretion rate $\\dot{M}_{\\mathrm{sim}}$ solely in terms of $c_s$, $G$, $Q$, $\\alpha_0$, and $H/R$. You must use the base relations and not insert any ad hoc formula not derived from them.\n\nSubgrid model to calibrate:\n- Consider a subgrid model that estimates the accretion rate by the form\n  $$\\dot{M}_{\\mathrm{model}} \\equiv \\kappa_c \\, M_{\\mathrm{gas}} \\, \\dfrac{c_s^3}{G\\,Q},$$\n  where $M_{\\mathrm{gas}}$ is the gas mass contained in the numerical patch and $\\kappa_c$ is a calibration constant with units of $\\mathrm{kg}^{-1}$ to ensure dimensional consistency. The factor $M_{\\mathrm{gas}}$ represents the resolution-scale gas reservoir available to be torqued inward.\n\n- To maintain physical consistency between $Q$, $H$, and $M_{\\mathrm{gas}}$, determine $M_{\\mathrm{gas}}$ by first computing $\\Sigma$ from the base relations and then taking the patch gas mass as $M_{\\mathrm{gas}} \\equiv \\Sigma \\, A$, where the patch area $A$ is fixed and given by $A \\equiv 2 \\pi R \\, \\Delta R$, with fixed radius $R$ and radial width $\\Delta R$.\n\nCalibration task:\n- Calibrate the single constant $\\kappa_c$ by minimizing the sum of squared residuals between $\\dot{M}_{\\mathrm{model}}$ and $\\dot{M}_{\\mathrm{sim}}$ over a designated subset of cases (the “training” subset). Because the model is linear in $\\kappa_c$, you should use the least-squares solution for a linear model $y = \\kappa_c x$ with\n  $$x \\equiv M_{\\mathrm{gas}} \\, \\dfrac{c_s^3}{G\\,Q}, \\quad y \\equiv \\dot{M}_{\\mathrm{sim}}.$$\n\nPhysics, constants, and units:\n- Use the International System of Units (SI) everywhere.\n- Gravitational constant: $G \\equiv 6.67430 \\times 10^{-11} \\ \\mathrm{m}^3\\,\\mathrm{kg}^{-1}\\,\\mathrm{s}^{-2}$.\n- Sound speed: $c_s \\equiv 1.0 \\times 10^{4} \\ \\mathrm{m\\,s^{-1}}$.\n- Fiducial radius and annulus width: $R \\equiv 100 \\ \\mathrm{pc}$, $\\Delta R \\equiv 10 \\ \\mathrm{pc}$, where $1 \\ \\mathrm{pc} \\equiv 3.085677581 \\times 10^{16} \\ \\mathrm{m}$. You must convert to meters.\n- Viscous efficiency normalization: $\\alpha_0 \\equiv 0.2$ (dimensionless).\n- Critical Toomre stability: $Q_{\\mathrm{crit}} \\equiv 1$ (dimensionless).\n- Angle units are not required because no angles appear explicitly.\n- The final calibrated constant $\\kappa_c$ must be reported in $\\mathrm{kg}^{-1}$.\n- Any intermediate or derived accretion rates, if used in the final output, must be in $\\mathrm{kg\\,s^{-1}}$. The final required outputs below are dimensionless relative errors and a single dimensional constant; they must be reported in the specified units.\n\nProcedure your program must implement:\n1. For each test case, take the given pair $(Q,H)$ and compute $H/R$ using $R$ from above. Use the fundamental relations $Q \\equiv \\dfrac{c_s \\kappa}{\\pi G \\Sigma}$ with $\\kappa \\approx \\Omega$ and $H \\equiv \\dfrac{c_s}{\\Omega}$ to express $\\Sigma$ in terms of $Q$, $H$, $c_s$, and $G$. Then compute $M_{\\mathrm{gas}} \\equiv \\Sigma \\, A$ with $A \\equiv 2 \\pi R \\Delta R$.\n2. Compute $\\alpha_{\\mathrm{grav}}(Q,H/R)$ using the definition above, and from it the “ground-truth” accretion rate $\\dot{M}_{\\mathrm{sim}}$ via the viscous accretion relation and the base definitions.\n3. Calibrate $\\kappa_c$ by least squares using only the first four cases in the test suite (in the order provided below).\n4. With this calibrated $\\kappa_c$, evaluate $\\dot{M}_{\\mathrm{model}}$ for all test cases and compute the relative error for each case as\n   $$\\epsilon \\equiv \\dfrac{\\dot{M}_{\\mathrm{model}} - \\dot{M}_{\\mathrm{sim}}}{\\dot{M}_{\\mathrm{sim}}}.$$\n   Each $\\epsilon$ must be reported as a decimal (dimensionless).\n\nTest suite:\n- Use the following eight cases, each specified by $(Q, H_{\\mathrm{pc}})$, where $H_{\\mathrm{pc}}$ is the scale height in parsecs:\n  - Case $1$: $(Q = 0.7, \\ H_{\\mathrm{pc}} = 5)$\n  - Case $2$: $(Q = 1.0, \\ H_{\\mathrm{pc}} = 10)$\n  - Case $3$: $(Q = 2.0, \\ H_{\\mathrm{pc}} = 10)$\n  - Case $4$: $(Q = 1.5, \\ H_{\\mathrm{pc}} = 50)$\n  - Case $5$: $(Q = 3.0, \\ H_{\\mathrm{pc}} = 5)$\n  - Case $6$: $(Q = 1.2, \\ H_{\\mathrm{pc}} = 30)$\n  - Case $7$: $(Q = 5.0, \\ H_{\\mathrm{pc}} = 100)$\n  - Case $8$: $(Q = 0.9, \\ H_{\\mathrm{pc}} = 20)$\n\nFinal output specification:\n- Your program should produce a single line of output containing a comma-separated list enclosed in square brackets with the following entries in order:\n  - The calibrated constant $\\kappa_c$ in $\\mathrm{kg}^{-1}$, followed by\n  - The relative errors $\\epsilon$ for Cases $1$ through $8$, each as a decimal.\n- Example of the required output format (values here are placeholders): \n  - \"[1.23e-45,0.01,-0.02,0.005,0.1,-0.03,0.2,-0.15,0.0]\"", "solution": "The problem statement has been analyzed and is determined to be valid. It is scientifically grounded within the standard framework of accretion disk theory and phenomenological modeling, mathematically well-posed, and provides a complete and consistent set of definitions, data, and objectives. The task is to derive and implement a calibration procedure for a subgrid accretion model.\n\nThe solution proceeds in several steps: first, deriving expressions for key physical quantities from the provided base relations; second, formulating the calibration procedure; and third, outlining the computational algorithm.\n\nFirst, we derive the necessary physical quantities. The surface density $\\Sigma$ is expressed in terms of the Toomre parameter $Q$ and scale height $H$.\nWe are given:\n$Q \\equiv \\dfrac{c_s \\kappa}{\\pi G \\Sigma}$\n$H \\equiv \\dfrac{c_s}{\\Omega}$\n$\\kappa \\approx \\Omega$\nFrom the relations for $H$ and $\\kappa$, we find the epicyclic frequency $\\kappa \\approx \\Omega = \\dfrac{c_s}{H}$. Substituting this into the definition of $Q$:\n$Q = \\dfrac{c_s (c_s/H)}{\\pi G \\Sigma} = \\dfrac{c_s^2}{\\pi G \\Sigma H}$\nSolving for the surface density $\\Sigma$ yields:\n$$ \\Sigma = \\dfrac{c_s^2}{\\pi G Q H} $$\nThe gas mass $M_{\\mathrm{gas}}$ within the specified annular patch of area $A \\equiv 2 \\pi R \\Delta R$ is then:\n$$ M_{\\mathrm{gas}} = \\Sigma A = \\left(\\dfrac{c_s^2}{\\pi G Q H}\\right) (2 \\pi R \\Delta R) = \\dfrac{2 c_s^2 R \\Delta R}{G Q H} $$\n\nNext, we formulate the \"ground-truth\" accretion rate $\\dot{M}_{\\mathrm{sim}}$. The viscous accretion rate is given by $\\dot{M} \\equiv 3 \\pi \\nu \\Sigma$. The effective kinematic viscosity is $\\nu \\equiv \\alpha_{\\mathrm{grav}} c_s H$. Combining these gives:\n$$ \\dot{M}_{\\mathrm{sim}} = 3 \\pi (\\alpha_{\\mathrm{grav}} c_s H) \\Sigma $$\nSubstituting our derived expression for $\\Sigma$:\n$$ \\dot{M}_{\\mathrm{sim}} = 3 \\pi (\\alpha_{\\mathrm{grav}} c_s H) \\left( \\dfrac{c_s^2}{\\pi G Q H} \\right) = \\dfrac{3 \\alpha_{\\mathrm{grav}} c_s^3}{G Q} $$\nThe dimensionless transport efficiency $\\alpha_{\\mathrm{grav}}$ is given by the function:\n$$ \\alpha_{\\mathrm{grav}}(Q, H/R) = \\dfrac{\\alpha_0}{1 + (Q/Q_{\\mathrm{crit}})^2} \\times \\dfrac{1}{1 + (H/R)^2} $$\nwhere $\\alpha_0$ and $Q_{\\mathrm{crit}}$ are constants. Thus, the complete expression for the ground-truth accretion rate to be used for comparison is:\n$$ \\dot{M}_{\\mathrm{sim}} = \\dfrac{3 c_s^3}{G Q} \\left[ \\dfrac{\\alpha_0}{1 + (Q/Q_{\\mathrm{crit}})^2} \\times \\dfrac{1}{1 + (H/R)^2} \\right] $$\n\nThe problem proposes a subgrid model of the form $\\dot{M}_{\\mathrm{model}} \\equiv \\kappa_c \\, M_{\\mathrm{gas}} \\, \\dfrac{c_s^3}{G\\,Q}$. This is a linear model $y = \\kappa_c x$, where the dependent variable is $y \\equiv \\dot{M}_{\\mathrm{sim}}$ and the independent variable is $x \\equiv M_{\\mathrm{gas}} \\, \\dfrac{c_s^3}{G\\,Q}$.\nThe calibration constant $\\kappa_c$ is determined by minimizing the sum of squared residuals, $\\sum (y_i - \\kappa_c x_i)^2$, over a training set of data points $(x_i, y_i)$. The standard least-squares solution for this model (regression through the origin) is:\n$$ \\kappa_c = \\dfrac{\\sum_i x_i y_i}{\\sum_i x_i^2} $$\nThe summation is performed over the first four test cases, as specified in the problem statement.\n\nThe computational procedure is as follows:\n1. Define all physical constants ($G$, $c_s$, $\\alpha_0$, $Q_{\\mathrm{crit}}$) and geometric parameters ($R$, $\\Delta R$) in SI units. The conversion $1 \\ \\mathrm{pc} = 3.085677581 \\times 10^{16} \\ \\mathrm{m}$ is used.\n2. For each of the eight test cases given by $(Q, H_{\\mathrm{pc}})$:\n    a. Convert the scale height $H_{\\mathrm{pc}}$ from parsecs to meters to get $H$.\n    b. Calculate the aspect ratio $H/R$.\n    c. Compute the ground-truth accretion rate $\\dot{M}_{\\mathrm{sim}}$ using its derived formula. This serves as the target value $y_i$.\n    d. Compute the gas mass $M_{\\mathrm{gas}}$ using its derived formula.\n    e. Compute the model's independent variable $x_i = M_{\\mathrm{gas}} \\dfrac{c_s^3}{G Q}$.\n3. Using the calculated values of $x_i$ and $y_i$ for the first four cases ($i=1, 2, 3, 4$), compute the calibration constant $\\kappa_c$ via the least-squares formula.\n4. With the calibrated $\\kappa_c$, calculate the modeled accretion rate $\\dot{M}_{\\mathrm{model},i} = \\kappa_c x_i$ for all eight cases.\n5. For each case, compute the relative error $\\epsilon_i = (\\dot{M}_{\\mathrm{model},i} - \\dot{M}_{\\mathrm{sim},i}) / \\dot{M}_{\\mathrm{sim},i}$.\n6. The final output is an ordered list containing the value of $\\kappa_c$ followed by the eight relative errors $\\epsilon_1, \\dots, \\epsilon_8$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the black hole accretion subgrid model calibration problem.\n    \"\"\"\n    # Physics, constants, and units in SI\n    G = 6.67430e-11  # m^3 kg^-1 s^-2\n    c_s = 1.0e4      # m s^-1\n    PC_TO_M = 3.085677581e16  # m/pc\n    \n    # Fiducial radius and annulus width\n    R_pc = 100.0     # pc\n    DeltaR_pc = 10.0 # pc\n    R = R_pc * PC_TO_M      # m\n    DeltaR = DeltaR_pc * PC_TO_M  # m\n    \n    # Model parameters\n    alpha_0 = 0.2          # dimensionless\n    Q_crit = 1.0           # dimensionless\n\n    # Test suite: (Q, H_pc)\n    test_cases = [\n        (0.7, 5.0),   # Case 1\n        (1.0, 10.0),  # Case 2\n        (2.0, 10.0),  # Case 3\n        (1.5, 50.0),  # Case 4\n        (3.0, 5.0),   # Case 5\n        (1.2, 30.0),  # Case 6\n        (5.0, 100.0), # Case 7\n        (0.9, 20.0),  # Case 8\n    ]\n\n    # Lists to store intermediate values for all cases\n    y_values = []  # Stores M_dot_sim\n    x_values = []  # Stores M_gas * c_s^3 / (G * Q)\n\n    # Step 1  2: Process each test case\n    for Q, H_pc in test_cases:\n        H = H_pc * PC_TO_M  # m\n        H_over_R = H / R\n\n        # Compute alpha_grav\n        alpha_grav = (alpha_0 / (1 + (Q / Q_crit)**2)) * (1 / (1 + H_over_R**2))\n        \n        # Compute ground-truth accretion rate M_dot_sim (y_i)\n        # M_dot_sim = (3 * alpha_grav * c_s^3) / (G * Q)\n        M_dot_sim = (3 * alpha_grav * c_s**3) / (G * Q)\n        y_values.append(M_dot_sim)\n\n        # Compute M_gas\n        # M_gas = (2 * c_s^2 * R * DeltaR) / (G * Q * H)\n        M_gas = (2 * c_s**2 * R * DeltaR) / (G * Q * H)\n        \n        # Compute the independent variable for the model (x_i)\n        # x = M_gas * c_s^3 / (G * Q)\n        x_val = M_gas * (c_s**3 / (G * Q))\n        x_values.append(x_val)\n\n    # Convert lists to numpy arrays for vectorized operations\n    y_all = np.array(y_values)\n    x_all = np.array(x_values)\n\n    # Step 3: Calibrate kappa_c using the training subset (first 4 cases)\n    x_train = x_all[:4]\n    y_train = y_all[:4]\n    \n    # kappa_c = sum(x_i * y_i) / sum(x_i^2)\n    sum_xy = np.sum(x_train * y_train)\n    sum_x2 = np.sum(x_train**2)\n    \n    # Handle potential division by zero, although not expected here\n    if sum_x2 == 0:\n        kappa_c = 0.0\n    else:\n        kappa_c = sum_xy / sum_x2\n    \n    # Step 4: Evaluate the model and compute relative errors for all cases\n    M_dot_model_all = kappa_c * x_all\n    \n    # epsilon = (M_dot_model - M_dot_sim) / M_dot_sim\n    # Avoid division by zero if M_dot_sim is zero\n    # np.divide handles this by returning inf or nan, which is fine\n    with np.errstate(divide='ignore', invalid='ignore'):\n         relative_errors = (M_dot_model_all - y_all) / y_all\n\n    # Prepare final output list\n    results = [kappa_c] + list(relative_errors)\n    \n    # Print in the required format\n    # The format specifier \"{}\" for float uses a default representation that's\n    # similar to 'g', switching to scientific notation for large/small numbers.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3479059"}, {"introduction": "Magnetic fields are the engine of accretion, yet their numerical simulation poses significant challenges, chief among them preserving the solenoidal constraint $\\nabla \\cdot \\mathbf{B} = 0$. This advanced practice introduces the Constrained Transport (CT) method, a cornerstone of modern magnetohydrodynamic codes, which is designed to maintain this constraint to machine precision [@problem_id:3479125]. By implementing a CT scheme, you will gain direct insight into how robust numerical methods are built to faithfully represent fundamental physical laws.", "problem": "You must implement and study the evolution of a magnetic field in ideal magnetohydrodynamics (MHD) using the Constrained Transport (CT) method. The goal is to demonstrate, both analytically and numerically, that the discrete magnetic divergence constraint $\\,\\nabla\\cdot\\mathbf{B}=0\\,$ is preserved to machine precision within a finite-volume scheme. Contextually, this represents the magnetic dynamics in geometrically thin patches of black hole accretion flows, where ideal MHD induction governs field evolution. The mathematical base should begin from Faraday's law and ideal Ohm's law, without introducing any shortcut formulas.\n\nFundamental base:\n- Ideal Ohm's law in ideal magnetohydrodynamics (MHD): $\\mathbf{E}=-\\mathbf{v}\\times\\mathbf{B}$.\n- Faraday's law: $\\partial_t\\mathbf{B}=-\\nabla\\times\\mathbf{E}$.\n- Magnetic solenoidal constraint: $\\nabla\\cdot\\mathbf{B}=0$.\n\nDiscrete geometry and variables:\n- Use a uniform, periodic, Cartesian grid on a square domain of length $L_x=L_y=1$ in dimensionless code units. Let the number of cells be $N_x$ and $N_y$ along $x$ and $y$, respectively, with spacings $\\Delta x=L_x/N_x$ and $\\Delta y=L_y/N_y$.\n- Store $B_x$ on $x$-faces with indices $(i+\\tfrac{1}{2},j)$ and $B_y$ on $y$-faces with indices $(i,j+\\tfrac{1}{2})$. Store the electric field emf component $E_z$ at cell corners $(i+\\tfrac{1}{2},j+\\tfrac{1}{2})$.\n- Initialize the magnetic field from a corner-centered vector potential $A_z$ such that the discrete divergence is exactly zero, using $B_x=\\partial_y A_z$ and $B_y=-\\partial_x A_z$ in the discrete sense on faces derived from corner differences. All quantities are dimensionless.\n\nFinite-volume constrained transport update:\n- Derive the CT update from the integral form of Faraday's law, applied to face-averaged magnetic fluxes and corner-centered electromotive forces. The update must use a single set of corner $E_z$ values shared consistently by both $B_x$ and $B_y$ updates. You must obtain a face-centered update that is a discrete curl of the corner-centered $E_z$ and demonstrate that the discrete divergence, computed by a face-centered finite-volume difference, is invariant under this update.\n\nVelocity fields:\n- Use predetermined, divergence-free velocity fields to compute $\\mathbf{E}=-\\mathbf{v}\\times\\mathbf{B}$ at corners. Velocity fields should be evaluated at corners and may be time-dependent. All fields are periodic.\n\nRequired numerical demonstrations:\n- Implement the CT scheme in code units (dimensionless), evolve the magnetic field for a specified number of timesteps using a Courant–Friedrichs–Lewy (CFL) condition with CFL number in $(0,1)$ computed from the maximum corner velocity magnitude, and compute the maximum absolute discrete divergence in the grid after evolution for each test case.\n\nTest suite:\n- Provide exactly four test cases with the following parameter sets, each expressed in dimensionless code units:\n  1. $N_x=32$, $N_y=32$, $A_z(x,y)=B_0\\sin(2\\pi x)\\sin(2\\pi y)$ with $B_0=1$, solid-body rotation $\\mathbf{v}(x,y)=(-\\Omega y,\\ \\Omega x)$ with $\\Omega=0.1$, timesteps $N_{\\text{step}}=50$, CFL number $C=0.3$.\n  2. $N_x=16$, $N_y=16$, $A_z(x,y)=B_0\\sin(2\\pi x)\\sin(2\\pi y)$ with $B_0=0.5$, static velocity $\\mathbf{v}=(0,0)$, timesteps $N_{\\text{step}}=10$, CFL number $C=0.5$.\n  3. $N_x=8$, $N_y=8$, $A_z(x,y)=B_0\\sin(2\\pi x)\\sin(2\\pi y)$ with $B_0=1$, linear shear $\\mathbf{v}(x,y)=(S y,\\ 0)$ with $S=0.2$, timesteps $N_{\\text{step}}=40$, CFL number $C=0.4$.\n  4. $N_x=12$, $N_y=10$, $A_z(x,y)=B_0\\sin(2\\pi x)\\sin(2\\pi y)$ with $B_0=1$, time-dependent incompressible swirl $\\mathbf{v}(x,y,t)=(\\sin(2\\pi y)\\cos(2\\pi t),\\ -\\sin(2\\pi x)\\cos(2\\pi t))$, timesteps $N_{\\text{step}}=25$, CFL number $C=0.3$.\n\nAlgorithmic constraints:\n- Corner-centered $E_z$ must be computed from corner-centered velocities and corner-centered magnetic field components obtained by averaging adjacent face-centered values to corners.\n- The periodicity must be enforced in all interpolations and differences.\n- The timestep $\\Delta t$ must be computed as $\\Delta t=C\\min(\\Delta x,\\Delta y)/v_{\\max}$ where $v_{\\max}$ is the maximum magnitude of the corner velocity; if $v_{\\max}=0$, set $\\Delta t=C\\min(\\Delta x,\\Delta y)$.\n\nOutput specification:\n- For each test case, compute the maximum absolute value of the discrete divergence at cell centers after the final timestep. The discrete divergence at a cell $(i,j)$ is\n  $$D_{i,j}=\\frac{B_x|_{i+\\frac{1}{2},j}-B_x|_{i-\\frac{1}{2},j}}{\\Delta x}+\\frac{B_y|_{i,j+\\frac{1}{2}}-B_y|_{i,j-\\frac{1}{2}}}{\\Delta y}.$$\n- Express the output as dimensionless floats. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4]\").\n\nAngle units:\n- All trigonometric functions use radians.\n\nUnits:\n- Use dimensionless code units throughout.\n\nYour program must be a complete, runnable implementation that produces the specified output, with no user input.", "solution": "The problem requires the implementation and validation of the Constrained Transport (CT) method for the ideal magnetohydrodynamics (MHD) induction equation on a two-dimensional Cartesian grid. The primary objective is to demonstrate, both analytically and numerically, that the discrete divergence of the magnetic field is preserved to machine precision over time.\n\nWe begin with the fundamental equations governing the evolution of the magnetic field $\\mathbf{B}$ in ideal MHD. These are Faraday's law of induction and the ideal Ohm's law:\n$$\n\\frac{\\partial \\mathbf{B}}{\\partial t} = -\\nabla \\times \\mathbf{E}\n$$\n$$\n\\mathbf{E} = -\\mathbf{v} \\times \\mathbf{B}\n$$\nwhere $\\mathbf{E}$ is the electric field and $\\mathbf{v}$ is the plasma velocity. Combining these gives the ideal induction equation:\n$$\n\\frac{\\partial \\mathbf{B}}{\\partial t} = \\nabla \\times (\\mathbf{v} \\times \\mathbf{B})\n$$\nA fundamental property of magnetic fields is the solenoidal constraint, $\\nabla \\cdot \\mathbf{B} = 0$. This condition is preserved by the induction equation. Taking the divergence of Faraday's law, we find:\n$$\n\\frac{\\partial}{\\partial t}(\\nabla \\cdot \\mathbf{B}) = \\nabla \\cdot \\left(\\frac{\\partial \\mathbf{B}}{\\partial t}\\right) = -\\nabla \\cdot (\\nabla \\times \\mathbf{E})\n$$\nSince the divergence of a curl of any vector field is identically zero ($\\nabla \\cdot (\\nabla \\times \\mathbf{F}) \\equiv 0$), it follows that $\\frac{\\partial}{\\partial t}(\\nabla \\cdot \\mathbf{B}) = 0$. This means that if $\\nabla \\cdot \\mathbf{B} = 0$ at an initial time $t=0$, it will remain zero for all subsequent times. A key challenge in numerical MHD is to construct a scheme that respects this property at the discrete level. The Constrained Transport method is designed for this exact purpose.\n\nWe discretize the problem on a uniform, periodic, Cartesian grid of size $N_x \\times N_y$ on a domain $[0, L_x] \\times [0, L_y]$ with $L_x=L_y=1$. The grid spacings are $\\Delta x = L_x/N_x$ and $\\Delta y = L_y/N_y$. We employ a staggered grid (a Yee-like grid) where different field components are located at different positions relative to a grid cell $(i,j)$:\n- Cell-centered quantities are at $(x_i, y_j) = ((i+0.5)\\Delta x, (j+0.5)\\Delta y)$.\n- The $x$-component of the magnetic field, $B_x$, is defined on $x$-faces at $(x_{i+1/2}, y_j) = ((i+1)\\Delta x, (j+0.5)\\Delta y)$.\n- The $y$-component, $B_y$, is on $y$-faces at $(x_i, y_{j+1/2}) = ((i+0.5)\\Delta x, (j+1)\\Delta y)$.\n- The $z$-component of the electric field, $E_z$, is at cell corners at $(x_{i+1/2}, y_{j+1/2}) = ((i+1)\\Delta x, (j+1)\\Delta y)$.\n\nThe discrete divergence of $\\mathbf{B}$ is naturally defined at cell centers $(i,j)$ using a centered finite-difference scheme:\n$$\nD_{i,j} = \\left(\\nabla \\cdot \\mathbf{B}\\right)_{i,j} = \\frac{B_x|_{i+1/2,j} - B_x|_{i-1/2,j}}{\\Delta x} + \\frac{B_y|_{i,j+1/2} - B_y|_{i,j-1/2}}{\\Delta y}\n$$\nTo ensure the initial discrete divergence is zero, we initialize the magnetic field from a corner-centered vector potential $A_z$, located at the same positions as $E_z$. The magnetic field is defined as the discrete curl of $A_z$:\n$$\nB_x|_{i+1/2,j} = \\frac{A_z|_{i+1/2,j+1/2} - A_z|_{i+1/2,j-1/2}}{\\Delta y}\n$$\n$$\nB_y|_{i,j+1/2} = -\\frac{A_z|_{i+1/2,j+1/2} - A_z|_{i-1/2,j+1/2}}{\\Delta x}\n$$\nSubstituting these definitions into the discrete divergence formula yields a sum that is algebraically zero, as terms cancel out perfectly in a telescoping fashion. Thus, $D_{i,j}=0$ at initialization, up to machine floating-point precision.\n\nThe CT method evolves the magnetic field using a finite-volume update derived from the integral form of Faraday's law, $\\oint_{\\partial S} \\mathbf{E} \\cdot d\\mathbf{l} = -\\frac{d}{dt}\\int_S \\mathbf{B} \\cdot d\\mathbf{A}$. Applying this to the $x$-face (an area $\\Delta y \\times 1$) and the $y$-face (an area $\\Delta x \\times 1$) yields update equations for $B_x$ and $B_y$:\n$$\n\\frac{\\partial B_x|_{i+1/2,j}}{\\partial t} = -\\frac{E_z|_{i+1/2,j+1/2} - E_z|_{i+1/2,j-1/2}}{\\Delta y}\n$$\n$$\n\\frac{\\partial B_y|_{i,j+1/2}}{\\partial t} = \\frac{E_z|_{i+1/2,j+1/2} - E_z|_{i-1/2,j+1/2}}{\\Delta x}\n$$\nNotice that the time evolution of the face-centered magnetic field components is given by the discrete curl of the corner-centered electric field $E_z$. This structure is identical to how $\\mathbf{B}$ was defined from $A_z$.\n\nTo show that this scheme preserves the zero-divergence condition, we examine the time evolution of the discrete divergence. Using a forward Euler time step for simplicity, $B^{n+1} = B^n + \\Delta t (\\partial B/\\partial t)$, the divergence at step $n+1$ is:\n$$\nD^{n+1}_{i,j} = D^n_{i,j} + \\Delta t \\left( \\frac{(\\partial_t B_x)|_{i+1/2,j} - (\\partial_t B_x)|_{i-1/2,j}}{\\Delta x} + \\frac{(\\partial_t B_y)|_{i,j+1/2} - (\\partial_t B_y)|_{i,j-1/2}}{\\Delta y} \\right)\n$$\nThe term multiplied by $\\Delta t$ is the discrete divergence of the time derivative field, $\\nabla \\cdot (\\partial_t \\mathbf{B})$. Substituting the CT update equations, this term becomes exactly the discrete divergence of a field derived from the curl of $E_z$. As shown with the initialization from $A_z$, such a construction results in an algebraically zero discrete divergence. Therefore, $D^{n+1}_{i,j} = D^n_{i,j}$. Since $D^0_{i,j} = 0$, the discrete divergence remains zero for all times, limited only by the accumulation of floating-point round-off errors.\n\nThe numerical algorithm proceeds as follows:\n1.  Initialize the grid and parameters for a given test case.\n2.  Define corner coordinates and compute the initial vector potential $A_z$ at these corners.\n3.  Calculate the initial face-centered fields $B_x$ and $B_y$ as the discrete curl of $A_z$, ensuring the initial discrete divergence is zero.\n4.  Calculate the constant time step $\\Delta t = C \\min(\\Delta x, \\Delta y) / v_{\\max}$, where $v_{\\max}$ is the maximum possible magnitude of the corner velocity over the entire simulation.\n5.  Begin the time-stepping loop for $N_{\\text{step}}$ iterations:\n    a.  Compute the velocity components $(v_x, v_y)$ at each corner for the current time $t$.\n    b.  Average the face-centered magnetic field components $B_x$ and $B_y$ to the corners. For example, $B_x|_{i+1/2,j+1/2} = 0.5 \\left( B_x|_{i+1/2,j} + B_x|_{i+1/2,j+1} \\right)$, respecting periodic boundaries.\n    c.  Calculate the corner electric field $E_z = v_y B_x - v_x B_y$.\n    d.  Update $B_x$ and $B_y$ using a forward Euler step with the time derivatives calculated from the discrete curl of $E_z$.\n6.  After the final step, compute the discrete divergence $D_{i,j}$ at all cell centers.\n7.  The final result for the test case is the maximum absolute value of this divergence array, $\\max |D_{i,j}|$. This value is expected to be on the order of machine epsilon.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the Constrained Transport MHD simulation for all test cases.\n    \"\"\"\n    test_cases = [\n        {\n            'Nx': 32, 'Ny': 32, 'B0': 1.0, 'vel_type': 'rotation',\n            'vel_param': 0.1, 'N_step': 50, 'CFL': 0.3\n        },\n        {\n            'Nx': 16, 'Ny': 16, 'B0': 0.5, 'vel_type': 'static',\n            'vel_param': 0.0, 'N_step': 10, 'CFL': 0.5\n        },\n        {\n            'Nx': 8, 'Ny': 8, 'B0': 1.0, 'vel_type': 'shear',\n            'vel_param': 0.2, 'N_step': 40, 'CFL': 0.4\n        },\n        {\n            'Nx': 12, 'Ny': 10, 'B0': 1.0, 'vel_type': 'swirl',\n            'vel_param': None, 'N_step': 25, 'CFL': 0.3\n        }\n    ]\n\n    results = []\n    \n    for params in test_cases:\n        max_div = run_simulation(params)\n        results.append(max_div)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef run_simulation(params):\n    \"\"\"\n    Executes a single 2D ideal MHD simulation using the Constrained Transport method.\n    \"\"\"\n    # Unpack parameters\n    Nx, Ny = params['Nx'], params['Ny']\n    B0 = params['B0']\n    vel_type = params['vel_type']\n    vel_param = params['vel_param']\n    N_step = params['N_step']\n    CFL = params['CFL']\n\n    # Grid setup\n    Lx, Ly = 1.0, 1.0\n    dx, dy = Lx / Nx, Ly / Ny\n\n    # Define corner coordinates. These are at ((i+1)dx, (j+1)dy) for i,j in [0,N-1]\n    # np.linspace with endpoint=False gives [0, L-d], so we add d to get [d, L]\n    x_corner_1d = np.linspace(0, Lx, Nx, endpoint=False) + dx\n    y_corner_1d = np.linspace(0, Ly, Ny, endpoint=False) + dy\n    xx_c, yy_c = np.meshgrid(x_corner_1d, y_corner_1d, indexing='ij')\n    \n    # Initialize Vector Potential Az at corners\n    Az = B0 * np.sin(2 * np.pi * xx_c) * np.sin(2 * np.pi * yy_c)\n\n    # Initialize Magnetic Field Bx, By from Az to ensure div(B)=0\n    # Bx lives on x-faces (i+1/2, j)\n    # By lives on y-faces (i, j+1/2)\n    # B = curl(A), Bx=dAz/dy, By=-dAz/dx\n    # Using np.roll for periodic boundary conditions\n    Bx = (Az - np.roll(Az, 1, axis=1)) / dy\n    By = -(Az - np.roll(Az, 1, axis=0)) / dx\n\n    # Determine maximum velocity for timestep calculation\n    v_max = 0.0\n    if vel_type == 'rotation':\n        # v = (-omega*y, omega*x), max |v| at corner (Lx, Ly)\n        v_max = vel_param * np.sqrt(Lx**2 + Ly**2)\n    elif vel_type == 'static':\n        v_max = 0.0\n    elif vel_type == 'shear':\n        # v = (S*y, 0), max |v| at max y\n        v_max = vel_param * Ly\n    elif vel_type == 'swirl':\n        # v = (sin(2py)cos(2pt), -sin(2px)cos(2pt))\n        # max |v| over space and time is sqrt(1^2+1^2) = sqrt(2)\n        v_max = np.sqrt(2.0)\n\n    # Calculate timestep dt using CFL condition\n    min_ds = min(dx, dy)\n    if v_max == 0.0:\n        dt = CFL * min_ds\n    else:\n        dt = CFL * min_ds / v_max\n\n    # --- Time Evolution Loop ---\n    t = 0.0\n    for _ in range(N_step):\n        # 1. Compute velocity at corners (vx_c, vy_c)\n        if vel_type == 'rotation':\n            vx_c = -vel_param * yy_c\n            vy_c =  vel_param * xx_c\n        elif vel_type == 'static':\n            vx_c = np.zeros_like(xx_c)\n            vy_c = np.zeros_like(yy_c)\n        elif vel_type == 'shear':\n            vx_c = vel_param * yy_c\n            vy_c = np.zeros_like(yy_c)\n        elif vel_type == 'swirl':\n            cos_t = np.cos(2 * np.pi * t)\n            vx_c = np.sin(2 * np.pi * yy_c) * cos_t\n            vy_c = -np.sin(2 * np.pi * xx_c) * cos_t\n        \n        # 2. Average B from faces to corners\n        Bx_c = 0.5 * (Bx + np.roll(Bx, -1, axis=1))\n        By_c = 0.5 * (By + np.roll(By, -1, axis=0))\n\n        # 3. Compute Electric Field Ez at corners: Ez is the z-component of E = -v x B\n        Ez = vy_c * Bx_c - vx_c * By_c\n\n        # 4. Update B using CT: dB/dt = -curl(E)\n        # dBx/dt = -dEz/dy\n        # dBy/dt = dEz/dx\n        dBx_dt = -(Ez - np.roll(Ez, 1, axis=1)) / dy\n        dBy_dt = (Ez - np.roll(Ez, 1, axis=0)) / dx\n\n        # 5. Simple forward Euler step\n        Bx += dBx_dt * dt\n        By += dBy_dt * dt\n\n        # Update time\n        t += dt\n\n    # --- Post-simulation: Compute final divergence ---\n    # div(B) at cell centers (i,j)\n    divB = (Bx - np.roll(Bx, 1, axis=0)) / dx + \\\n           (By - np.roll(By, 1, axis=1)) / dy\n           \n    return np.max(np.abs(divB))\n\nsolve()\n```", "id": "3479125"}]}