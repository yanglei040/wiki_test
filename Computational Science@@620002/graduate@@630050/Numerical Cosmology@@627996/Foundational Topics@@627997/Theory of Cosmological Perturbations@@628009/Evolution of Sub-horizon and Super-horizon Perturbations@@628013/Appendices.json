{"hands_on_practices": [{"introduction": "Our journey into the dynamics of cosmological perturbations begins at their very origin: quantum fluctuations during inflation. In theory, we initialize these fluctuations in the \"Bunch-Davies\" vacuum state in the infinite past. This practice tackles the real-world numerical challenge of starting at a finite, albeit very early, time and quantifies the sensitivity of our results to this crucial choice [@problem_id:3471532]. By exploring how the final amplitude of the curvature perturbation depends on the initial sub-horizon depth, you will gain a practical understanding of how to robustly set up inflationary simulations.", "problem": "Design and implement a program to numerically assess the robustness of Bunch–Davies initial conditions for curvature perturbations in a single-field, constant slow-roll parameter background by initializing sub-horizon modes at a finite ratio $k/(aH)=\\alpha \\gg 1$ and varying $\\alpha$ to quantify the sensitivity of the frozen curvature perturbation amplitude.\n\nYou must work within the following consistent, self-contained framework:\n\n- Background and perturbations:\n  - Consider a single-field inflationary background with constant first slow-roll parameter $\\epsilon$, where $\\epsilon \\in (0,1)$ is constant.\n  - Work in conformal time $\\eta < 0$, with scale factor $a(\\eta)$ scaling as a pure power law for constant $\\epsilon$. Let $p \\equiv 1/(1-\\epsilon)$ and set the overall normalization of the scale factor to unity so that $a(\\eta) = (-\\eta)^{-p}$. This fixes the convention and removes an arbitrary multiplicative constant.\n  - The Mukhanov variable $v_k(\\eta)$ obeys the Mukhanov–Sasaki equation\n    $$ v_k''(\\eta) + \\left(k^2 - \\frac{z''(\\eta)}{z(\\eta)}\\right) v_k(\\eta) = 0, $$\n    where $z(\\eta) = a(\\eta) \\sqrt{2\\epsilon}$ in reduced Planck units (set to unity), and primes denote derivatives with respect to $\\eta$. For constant $\\epsilon$, one has\n    $$ \\frac{z''}{z} = \\frac{a''}{a} = \\frac{p(p+1)}{\\eta^2}. $$\n  - The comoving curvature perturbation is $\\zeta_k(\\eta) = v_k(\\eta)/z(\\eta)$, which freezes to a constant amplitude on super-horizon scales.\n\n- Initialization protocol (finite Bunch–Davies approximation):\n  - The exact Bunch–Davies vacuum requires $v_k(\\eta) \\to e^{-ik\\eta}/\\sqrt{2k}$ as $\\eta \\to -\\infty$. To approximate this at finite time, initialize at a finite sub-horizon ratio $k/(aH)=\\alpha$ with the plane-wave prescription:\n    $$ v_k(\\eta_i) = \\frac{e^{-ik\\eta_i}}{\\sqrt{2k}}, \\quad v_k'(\\eta_i) = -i k \\frac{e^{-ik\\eta_i}}{\\sqrt{2k}}. $$\n  - Using $aH = a'/a = -p/\\eta$, the sub-horizon condition $k/(aH)=\\alpha$ implies\n    $$ \\eta_i = -\\frac{p\\,\\alpha}{k}. $$\n\n- Numerical task:\n  - For given $\\epsilon$ and $k$, integrate the Mukhanov–Sasaki equation from $\\eta=\\eta_i$ to a final time $\\eta=\\eta_f$ chosen such that the mode is deeply super-horizon, i.e.,\n    $$ \\eta_f = -\\frac{p\\,\\alpha_{\\text{out}}}{k}, \\quad \\text{with} \\quad \\alpha_{\\text{out}} \\ll 1. $$\n  - At $\\eta_f$, compute the frozen amplitude\n    $$ A(\\alpha) \\equiv \\left|\\zeta_k(\\eta_f)\\right| = \\left|\\frac{v_k(\\eta_f)}{z(\\eta_f)}\\right|. $$\n\n- Robustness metric:\n  - Use a large reference value $\\alpha_{\\text{ref}}$ and report fractional deviations\n    $$ \\delta(\\alpha) \\equiv \\frac{A(\\alpha) - A(\\alpha_{\\text{ref}})}{A(\\alpha_{\\text{ref}})}. $$\n  - This removes any residual dependence on the arbitrary normalization of $a(\\eta)$ and isolates sensitivity to the finite-time initialization.\n\n- Parameter choices and units:\n  - Work in reduced Planck units with $M_{\\mathrm{pl}}=1$.\n  - Use the following fixed parameters: $\\epsilon = 0.01$, $k = 1$, $\\alpha_{\\text{out}} = 10^{-3}$, and $\\alpha_{\\text{ref}} = 100$.\n  - The results are dimensionless. No physical units are required.\n\n- Test suite:\n  - Evaluate the robustness metric for the set of initial sub-horizon depths\n    $$ \\{\\alpha\\} = [2, 5, 10, 20, 50, 100]. $$\n  - These probe a boundary case ($\\alpha=2$), intermediate cases, and approach the reference large value.\n\n- Output specification:\n  - Your program should numerically integrate the system for each $\\alpha$ in the order listed above, compute $\\delta(\\alpha)$ using $\\alpha_{\\text{ref}}=100$, and produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[x1,x2,x3,x4,x5,x6]\"). Each entry must be a floating-point number.\n\nConstraints and implementation details:\n- The computation must be done by explicitly integrating the second-order ordinary differential equation for $v_k(\\eta)$ rewritten as a first-order system in terms of real and imaginary parts.\n- Ensure numerical accuracy sufficient to resolve oscillatory behavior at large $\\alpha$ and the transition across horizon crossing to the super-horizon regime where $\\zeta_k$ freezes.\n- Do not assume or use any closed-form solution for $v_k(\\eta)$ or $\\zeta_k(\\eta)$; the solution must arise from numerical integration of the posed initial value problem.", "solution": "The user's problem is valid and will be solved as stated. It is scientifically grounded in the principles of cosmological perturbation theory, well-posed as a numerical initial value problem, and its parameters and objectives are defined with sufficient precision.\n\nThe problem requires a numerical investigation into the robustness of the Bunch–Davies vacuum initial conditions for scalar perturbations during single-field inflation. The standard Bunch–Davies vacuum is defined in the infinite past, $\\eta \\to -\\infty$. In numerical simulations, one must start at a finite time $\\eta_i$, which corresponds to a finite sub-horizon scale where the mode number $k$ is much larger than the expansion rate $aH$. This is parameterized by the ratio $\\alpha = k/(aH) \\gg 1$. The problem is to quantify how the final, super-horizon amplitude of the curvature perturbation depends on the choice of this initial scale $\\alpha$.\n\nThe core of the problem is the numerical integration of the Mukhanov–Sasaki equation for the gauge-invariant variable $v_k(\\eta)$. For a single scalar field with a constant first slow-roll parameter $\\epsilon$, this equation is\n$$ v_k''(\\eta) + \\left(k^2 - \\frac{z''(\\eta)}{z(\\eta)}\\right) v_k(\\eta) = 0 $$\nwhere primes denote derivatives with respect to conformal time $\\eta$. The background is characterized by the scale factor $a(\\eta) = (-\\eta)^{-p}$ with $p \\equiv 1/(1-\\epsilon)$, and the potential term is given by $\\frac{z''}{z} = \\frac{a''}{a} = \\frac{p(p+1)}{\\eta^2}$. The variable $z(\\eta)$ is defined as $z(\\eta) = a(\\eta) \\sqrt{2\\epsilon}$ in reduced Planck units ($M_{\\text{pl}}=1$).\n\nTo solve this second-order, linear, complex ordinary differential equation (ODE), we decompose the Mukhanov variable $v_k(\\eta)$ into its real and imaginary parts, $v_k(\\eta) = v_R(\\eta) + i v_I(\\eta)$. The Mukhanov–Sasaki equation then separates into two independent, identical equations for the real and imaginary components:\n$$ v_R''(\\eta) + \\left(k^2 - \\frac{p(p+1)}{\\eta^2}\\right) v_R(\\eta) = 0 $$\n$$ v_I''(\\eta) + \\left(k^2 - \\frac{p(p+1)}{\\eta^2}\\right) v_I(\\eta) = 0 $$\nFor numerical integration using a standard ODE solver, this system is rewritten as a system of four first-order ODEs. Let the state vector be $\\mathbf{y}(\\eta) = [y_0(\\eta), y_1(\\eta), y_2(\\eta), y_3(\\eta)]^T \\equiv [v_R(\\eta), v_R'(\\eta), v_I(\\eta), v_I'(\\eta)]^T$. The system is then described by $\\frac{d\\mathbf{y}}{d\\eta} = \\mathbf{f}(\\eta, \\mathbf{y})$, where:\n$$ \\mathbf{f}(\\eta, \\mathbf{y}) = \\begin{pmatrix} y_1 \\\\ -\\left(k^2 - \\frac{p(p+1)}{\\eta^2}\\right) y_0 \\\\ y_3 \\\\ -\\left(k^2 - \\frac{p(p+1)}{\\eta^2}\\right) y_2 \\end{pmatrix} $$\n\nThe integration starts at an initial time $\\eta_i$ corresponding to the sub-horizon ratio $\\alpha = k/(aH)$. Using $aH = a'/a = -p/\\eta$, we find $\\eta_i = -p\\alpha/k$. At this time, we impose the finite Bunch-Davies initial conditions, which approximate the pure negative-frequency plane wave solution $v_k(\\eta) \\approx e^{-ik\\eta}/\\sqrt{2k}$ that holds for $\\eta \\to -\\infty$. The initial conditions for $v_k$ and its derivative $v_k'$ are:\n$$ v_k(\\eta_i) = \\frac{e^{-ik\\eta_i}}{\\sqrt{2k}} = \\frac{1}{\\sqrt{2k}}\\left(\\cos(k\\eta_i) - i\\sin(k\\eta_i)\\right) $$\n$$ v_k'(\\eta_i) = -ik \\frac{e^{-ik\\eta_i}}{\\sqrt{2k}} = \\frac{k}{\\sqrt{2k}}\\left(-\\sin(k\\eta_i) - i\\cos(k\\eta_i)\\right) $$\nFrom these, we construct the initial state vector $\\mathbf{y}(\\eta_i)$:\n$$ \\mathbf{y}(\\eta_i) = \\frac{1}{\\sqrt{2k}} \\begin{pmatrix} \\cos(k\\eta_i) \\\\ -k\\sin(k\\eta_i) \\\\ -\\sin(k\\eta_i) \\\\ -k\\cos(k\\eta_i) \\end{pmatrix} $$\n\nThe integration is performed from $\\eta = \\eta_i$ to a final time $\\eta = \\eta_f$ where the mode is deep in the super-horizon regime. This corresponds to a ratio $\\alpha_{\\text{out}} = k/(aH) \\ll 1$, giving $\\eta_f = -p\\alpha_{\\text{out}}/k$. At $\\eta_f$, we compute the comoving curvature perturbation $\\zeta_k(\\eta_f) = v_k(\\eta_f)/z(\\eta_f)$. Its amplitude is given by\n$$ A(\\alpha) = |\\zeta_k(\\eta_f)| = \\frac{|v_k(\\eta_f)|}{|z(\\eta_f)|} = \\frac{\\sqrt{v_R(\\eta_f)^2 + v_I(\\eta_f)^2}}{(-\\eta_f)^{-p}\\sqrt{2\\epsilon}} $$\n\nTo quantify the sensitivity to the initial choice of $\\alpha$, we compute the fractional deviation $\\delta(\\alpha)$ of the amplitude $A(\\alpha)$ from a reference amplitude $A(\\alpha_{\\text{ref}})$ calculated with a very large reference value $\\alpha_{\\text{ref}}$:\n$$ \\delta(\\alpha) = \\frac{A(\\alpha) - A(\\alpha_{\\text{ref}})}{A(\\alpha_{\\text{ref}})} $$\nThis metric isolates the error introduced by starting the evolution at a finite sub-horizon scale $\\alpha$ instead of at $\\alpha \\to \\infty$.\n\nThe algorithm proceeds as follows:\n1.  Define the physical parameters: $\\epsilon = 0.01$, $k = 1$, $\\alpha_{\\text{out}} = 10^{-3}$, and $\\alpha_{\\text{ref}} = 100$. Calculate the derived parameter $p = 1/(1-\\epsilon)$.\n2.  Compute the reference amplitude $A(\\alpha_{\\text{ref}})$ by numerically integrating the system for $\\alpha = \\alpha_{\\text{ref}}$.\n3.  Iterate through the specified test set $\\{\\alpha\\} = \\{$2$, $5$, $10$, $20$, $50$, $100\\}$.\n4.  For each $\\alpha$ in the set, compute the corresponding amplitude $A(\\alpha)$ by numerical integration.\n5.  Calculate the robustness metric $\\delta(\\alpha)$ for each test case.\n6.  Collect the results and format them as specified. For $\\alpha = \\alpha_{\\text{ref}}$, the result is trivially $\\delta(\\alpha_{\\text{ref}}) = 0$.\nThe numerical integration will be performed using a high-precision solver to accurately capture the oscillatory behavior at early times ($\\eta \\ll -1/k$) and the subsequent freeze-out at late times ($\\eta \\gg -1/k$).", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Numerically assesses the robustness of Bunch-Davies initial conditions\n    for curvature perturbations by varying the initial sub-horizon scale.\n    \"\"\"\n\n    # --- Problem Parameters ---\n    epsilon = 0.01\n    k = 1.0\n    alpha_out = 1e-3\n    alpha_ref = 100.0\n    test_alphas = [2.0, 5.0, 10.0, 20.0, 50.0, 100.0]\n\n    # --- Derived Constants ---\n    p = 1.0 / (1.0 - epsilon)\n    p_p_plus_1 = p * (p + 1.0)\n    sqrt_2k = np.sqrt(2.0 * k)\n    sqrt_2epsilon = np.sqrt(2.0 * epsilon)\n\n    def get_amplitude(alpha):\n        \"\"\"\n        Computes the frozen amplitude A(alpha) by integrating the Mukhanov-Sasaki equation.\n        \"\"\"\n        \n        # --- Time intervals ---\n        # Initial time eta_i, based on alpha = k/(aH)\n        eta_i = -p * alpha / k\n        # Final time eta_f, for deep super-horizon evolution\n        eta_f = -p * alpha_out / k\n\n        # --- Initial Conditions (Finite Bunch-Davies) ---\n        # v_k(eta_i) = exp(-i*k*eta_i) / sqrt(2k)\n        # v_k'(eta_i) = -i*k * v_k(eta_i)\n        cos_k_eta_i = np.cos(k * eta_i)\n        sin_k_eta_i = np.sin(k * eta_i)\n        \n        # State vector y = [v_R, v_R', v_I, v_I']\n        y_i = np.array([\n            cos_k_eta_i / sqrt_2k,          # v_R(eta_i)\n            -k * sin_k_eta_i / sqrt_2k,     # v_R'(eta_i)\n            -sin_k_eta_i / sqrt_2k,         # v_I(eta_i)\n            -k * cos_k_eta_i / sqrt_2k,     # v_I'(eta_i)\n        ])\n\n        # --- ODE System Definition ---\n        # y' = f(eta, y)\n        def mukhanov_sasaki_system(eta, y):\n            # Potential term in MS equation: (k^2 - z''/z)\n            # z''/z = a''/a = p(p+1)/eta^2\n            potential_term = k**2 - p_p_plus_1 / eta**2\n            \n            # y = [v_R, v_R', v_I, v_I']\n            # y' = [v_R', v_R'', v_I', v_I'']\n            return np.array([\n                y[1],                       # y_0' = y_1\n                -potential_term * y[0],     # y_1' = - (k^2 - ...) * y_0\n                y[3],                       # y_2' = y_3\n                -potential_term * y[2]      # y_3' = - (k^2 - ...) * y_2\n            ])\n\n        # --- Numerical Integration ---\n        # Use a high-precision solver from eta_i to eta_f\n        sol = solve_ivp(\n            mukhanov_sasaki_system,\n            [eta_i, eta_f],\n            y_i,\n            method='RK45',\n            t_eval=[eta_f],\n            rtol=1e-9,  # Relative tolerance for accuracy\n            atol=1e-12  # Absolute tolerance for accuracy\n        )\n\n        y_f = sol.y[:, -1]\n        v_R_f = y_f[0]\n        v_I_f = y_f[2]\n\n        # --- Amplitude Calculation ---\n        # v_k(eta_f) = v_R(eta_f) + i*v_I(eta_f)\n        v_k_f_abs = np.sqrt(v_R_f**2 + v_I_f**2)\n        \n        # z(eta_f) = a(eta_f) * sqrt(2*epsilon)\n        # a(eta_f) = (-eta_f)^(-p)\n        a_f = (-eta_f)**(-p)\n        z_f = a_f * sqrt_2epsilon\n        \n        # A(alpha) = |zeta_k(eta_f)| = |v_k(eta_f)/z(eta_f)|\n        amplitude = v_k_f_abs / z_f\n        \n        return amplitude\n\n    # --- Main Calculation Loop ---\n    \n    # 1. Compute reference amplitude\n    A_ref = get_amplitude(alpha_ref)\n    \n    # 2. Compute fractional deviation for each test alpha\n    results = []\n    for alpha in test_alphas:\n        A_alpha = get_amplitude(alpha)\n        delta_alpha = (A_alpha - A_ref) / A_ref\n        results.append(delta_alpha)\n        \n    # Final print statement in the exact required format\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```", "id": "3471532"}, {"introduction": "As inflation proceeds, perturbations that began deep inside the causal horizon are stretched to super-horizon scales. This exercise simulates this critical transition and investigates one of the cornerstones of modern cosmology: the conservation of the comoving curvature perturbation $\\zeta_k$ for super-horizon modes [@problem_id:3471482]. You will not only verify this conservation numerically in the standard adiabatic case but also diagnose how this principle is modified by the presence of non-adiabatic pressures, a key feature in many advanced inflationary models.", "problem": "Implement a complete, runnable program that numerically solves the Mukhanov–Sasaki equation for the Fourier mode function $v_k(\\eta)$ across horizon crossing and diagnoses the conservation of the comoving curvature perturbation $\\zeta_k(\\eta)=v_k(\\eta)/z(\\eta)$ on super-horizon scales in the presence of tiny non-adiabatic sources. Your implementation must adhere to the following physically and numerically self-consistent specifications.\n\nBackground and fundamental base:\n- Work in a spatially flat Friedmann–Robertson–Walker (FRW) spacetime with conformal time $\\eta < 0$ and scale factor $a(\\eta)=-1/(H\\eta)$.\n- Consider a single canonical scalar degree of freedom with a constant slow-roll parameter $\\epsilon$, where $0 < \\epsilon \\ll 1$, and adopt natural units with $c=\\hbar=M_{\\rm pl}=1$.\n- Use the Mukhanov–Sasaki variable $v_k(\\eta)$ and function $z(\\eta)=a(\\eta)\\sqrt{2\\epsilon}$ so that the mode equation takes the canonical form\n$$\nv_k''(\\eta)+\\left(k^2-\\frac{z''(\\eta)}{z(\\eta)}\\right)v_k(\\eta)=0,\n$$\nwhere primes denote derivatives with respect to conformal time $\\eta$ and $k > 0$ is the comoving wavenumber.\n- From the above background, determine $z''(\\eta)/z(\\eta)$ explicitly in terms of $\\eta$ only, and use that analytic expression in your solver.\n\nInitial conditions and numerical domain:\n- Impose Bunch–Davies initial conditions deep inside the horizon, i.e., at $\\eta_{\\rm i}=-100/k$:\n$$\nv_k(\\eta_{\\rm i})=\\frac{e^{-ik\\eta_{\\rm i}}}{\\sqrt{2k}},\\quad\nv_k'(\\eta_{\\rm i})=-i k\\,\\frac{e^{-ik\\eta_{\\rm i}}}{\\sqrt{2k}}.\n$$\n- Integrate the mode equation forward in conformal time to $\\eta_{\\rm f}=-10^{-3}/k$, which is well after horizon exit.\n- Evaluate the curvature perturbation as $\\zeta_k(\\eta)=v_k(\\eta)/z(\\eta)$ at two super-horizon times:\n$$\n\\eta_{\\rm sh,start}=-\\frac{10^{-1}}{k},\\qquad \\eta_{\\rm sh,end}=-\\frac{10^{-3}}{k}.\n$$\n- Compute the purely numerical super-horizon drift of $\\zeta_k$ from the homogeneous Mukhanov–Sasaki integration (adiabatic case) as the dimensionless quantity\n$$\n\\Delta_{\\rm num}=\\frac{\\left|\\zeta_k(\\eta_{\\rm sh,end})-\\zeta_k(\\eta_{\\rm sh,start})\\right|}{\\left|\\zeta_k(\\eta_{\\rm sh,start})\\right|}.\n$$\n\nTiny non-adiabatic sources and super-horizon evolution:\n- For super-horizon scales $k \\ll aH$, use the well-tested super-horizon evolution equation for the comoving curvature perturbation,\n$$\n\\zeta_k'(\\eta)=-\\frac{\\mathcal{H}(\\eta)}{\\rho(\\eta)+P(\\eta)}\\,\\delta P_{\\rm nad}(\\eta,k),\n$$\nwhere $\\mathcal{H}(\\eta)=a'(\\eta)/a(\\eta)$ is the conformal Hubble parameter, $\\rho(\\eta)$ is the background energy density, $P(\\eta)$ is the background pressure, and $\\delta P_{\\rm nad}$ is the non-adiabatic pressure perturbation. For a canonical scalar field with constant $\\epsilon$, one has $\\rho(\\eta)+P(\\eta)=2\\epsilon H^2$ in natural units.\n- Introduce a tiny, localized, non-adiabatic source centered on horizon crossing via\n$$\n\\delta P_{\\rm nad}(\\eta,k)=A_{\\rm nad}\\,(\\rho+P)\\,\\exp\\!\\left[-\\frac{\\bigl(\\ln(-k\\eta)-\\mu\\bigr)^2}{2\\sigma^2}\\right],\n$$\nwith $\\mu=0$ so the source peaks at $-k\\eta=1$. Using the above, the super-horizon evolution becomes\n$$\n\\zeta_k'(\\eta)=-\\mathcal{H}(\\eta)\\,A_{\\rm nad}\\,\\exp\\!\\left[-\\frac{\\bigl(\\ln(-k\\eta)\\bigr)^2}{2\\sigma^2}\\right].\n$$\n- For the diagnostic, approximate the sourced drift after horizon exit by integrating the above equation only on the super-horizon interval $[\\eta_{\\rm sh,start},\\eta_{\\rm sh,end}]$. Denote the corresponding absolute fractional drift by\n$$\n\\Delta_{\\rm src}=\\frac{\\left|\\int_{\\eta_{\\rm sh,start}}^{\\eta_{\\rm sh,end}}\\zeta_k'(\\eta)\\,d\\eta\\right|}{\\left|\\zeta_k(\\eta_{\\rm sh,start})\\right|}.\n$$\n- Decide that $\\zeta_k$ is numerically conserved on super-horizon scales whenever both $\\Delta_{\\rm num} \\leq {\\rm tol}$ and $\\Delta_{\\rm src} \\leq {\\rm tol}$ for a given tolerance ${\\rm tol} > 0$.\n\nTest suite and required output:\n- Use $H=1$ and $\\epsilon=10^{-2}$ for all tests. Angles are not used. All quantities are dimensionless in the chosen natural units.\n- Implement the solver and diagnostic for the following four test cases, each specified by the tuple $(k, A_{\\rm nad}, \\sigma, {\\rm tol})$:\n    1. $(k, A_{\\rm nad}, \\sigma, {\\rm tol})=(10^{-1}, 0, 3\\times 10^{-1}, 10^{-3})$.\n    2. $(k, A_{\\rm nad}, \\sigma, {\\rm tol})=(5\\times 10^{-2}, 10^{-9}, 3\\times 10^{-1}, 10^{-3})$.\n    3. $(k, A_{\\rm nad}, \\sigma, {\\rm tol})=(5\\times 10^{-2}, 10^{-6}, 5\\times 10^{-1}, 10^{-3})$.\n    4. $(k, A_{\\rm nad}, \\sigma, {\\rm tol})=(2\\times 10^{-2}, 10^{-4}, 1, 10^{-3})$.\n- For each test case, compute the boolean flag\n$${\\rm conserved}=(\\Delta_{\\rm num}\\leq{\\rm tol}) \\wedge (\\Delta_{\\rm src}\\leq{\\rm tol}),$$\nand aggregate the four booleans into a single list in order of the test cases.\n- Final output format: Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, for example, \"[True,False,True,True]\". No other text should be printed.", "solution": "We work in a spatially flat Friedmann–Robertson–Walker (FRW) spacetime with exact de Sitter expansion, constant Hubble parameter $H$, conformal time $\\eta < 0$, and scale factor $a(\\eta)=-1/(H\\eta)$. For a canonical scalar field with constant slow-roll parameter $\\epsilon$, the Mukhanov–Sasaki (MS) variable $v_k(\\eta)$ obeys the ordinary differential equation\n$$\nv_k''(\\eta)+\\left(k^2-\\frac{z''(\\eta)}{z(\\eta)}\\right)v_k(\\eta)=0,\n$$\nwith $z(\\eta)=a(\\eta)\\sqrt{2\\epsilon}$. The comoving curvature perturbation is $\\zeta_k(\\eta)=v_k(\\eta)/z(\\eta)$.\n\nStep 1: Derive $z''(\\eta)/z(\\eta)$ in de Sitter.\nSince $z(\\eta)\\propto a(\\eta)$ for constant $\\epsilon$, we have\n$$\n\\frac{z''(\\eta)}{z(\\eta)}=\\frac{a''(\\eta)}{a(\\eta)}.\n$$\nUsing $a(\\eta)=-\\frac{1}{H\\eta}$, we compute\n$$\na'(\\eta)=\\frac{1}{H\\eta^2},\\qquad a''(\\eta)=-\\frac{2}{H\\eta^3},\\qquad \\Rightarrow\\ \\frac{a''(\\eta)}{a(\\eta)}=\\frac{-\\frac{2}{H\\eta^3}}{-\\frac{1}{H\\eta}}=\\frac{2}{\\eta^2}.\n$$\nTherefore,\n$$\n\\frac{z''(\\eta)}{z(\\eta)}=\\frac{2}{\\eta^2}.\n$$\nThe MS equation specializes to\n$$\nv_k''(\\eta)+\\left(k^2-\\frac{2}{\\eta^2}\\right)v_k(\\eta)=0.\n$$\n\nStep 2: Initial conditions and domain.\nDeep inside the horizon at $\\eta_{\\rm i}=-100/k$, the Bunch–Davies vacuum gives\n$$\nv_k(\\eta_{\\rm i})=\\frac{e^{-ik\\eta_{\\rm i}}}{\\sqrt{2k}},\\qquad v_k'(\\eta_{\\rm i})=-i k\\,\\frac{e^{-ik\\eta_{\\rm i}}}{\\sqrt{2k}}.\n$$\nWe integrate to $\\eta_{\\rm f}=-10^{-3}/k$, well after horizon exit. To assess super-horizon conservation, we record\n$$\n\\eta_{\\rm sh,start}=-\\frac{10^{-1}}{k},\\qquad \\eta_{\\rm sh,end}=-\\frac{10^{-3}}{k}.\n$$\nAt each time $\\eta$, we also need $z(\\eta)=a(\\eta)\\sqrt{2\\epsilon}=-\\frac{1}{H\\eta}\\sqrt{2\\epsilon}$; with $H=1$, this is $z(\\eta)=-\\sqrt{2\\epsilon}/\\eta$.\n\nWe compute $\\zeta_k(\\eta)=v_k(\\eta)/z(\\eta)$ at the two super-horizon times and form the purely numerical drift\n$$\n\\Delta_{\\rm num}=\\frac{\\left|\\zeta_k(\\eta_{\\rm sh,end})-\\zeta_k(\\eta_{\\rm sh,start})\\right|}{\\left|\\zeta_k(\\eta_{\\rm sh,start})\\right|}.\n$$\n\nStep 3: Tiny non-adiabatic sources and super-horizon drift.\nOn super-horizon scales, neglecting spatial gradients, the comoving curvature perturbation evolves as\n$$\n\\zeta_k'(\\eta)=-\\frac{\\mathcal{H}(\\eta)}{\\rho(\\eta)+P(\\eta)}\\,\\delta P_{\\rm nad}(\\eta,k),\n$$\nwhere $\\mathcal{H}(\\eta)=a'(\\eta)/a(\\eta)$ is the conformal Hubble parameter. For a canonical scalar with constant $\\epsilon$, $\\rho(\\eta)+P(\\eta)=2\\epsilon H^2$ in natural units. We choose a localized, tiny non-adiabatic source centered on horizon exit,\n$$\n\\delta P_{\\rm nad}(\\eta,k)=A_{\\rm nad}\\,(\\rho+P)\\,\\exp\\!\\left[-\\frac{\\bigl(\\ln(-k\\eta)\\bigr)^2}{2\\sigma^2}\\right].\n$$\nSubstituting yields\n$$\n\\zeta_k'(\\eta)=-\\mathcal{H}(\\eta)\\,A_{\\rm nad}\\,\\exp\\!\\left[-\\frac{\\bigl(\\ln(-k\\eta)\\bigr)^2}{2\\sigma^2}\\right].\n$$\nIn exact de Sitter, $\\mathcal{H}(\\eta)=a'(\\eta)/a(\\eta)=-1/\\eta$, so\n$$\n\\zeta_k'(\\eta)=\\frac{A_{\\rm nad}}{\\eta}\\,\\exp\\!\\left[-\\frac{\\bigl(\\ln(-k\\eta)\\bigr)^2}{2\\sigma^2}\\right].\n$$\nThe sourced super-horizon drift from $\\eta_{\\rm sh,start}$ to $\\eta_{\\rm sh,end}$ is\n$$\n\\Delta\\zeta_{\\rm src}=\\int_{\\eta_{\\rm sh,start}}^{\\eta_{\\rm sh,end}}\\zeta_k'(\\eta)\\,d\\eta\n=A_{\\rm nad}\\int_{\\eta_{\\rm sh,start}}^{\\eta_{\\rm sh,end}}\\frac{1}{\\eta}\\,\\exp\\!\\left[-\\frac{\\bigl(\\ln(-k\\eta)\\bigr)^2}{2\\sigma^2}\\right]\\,d\\eta.\n$$\nWith the substitution $u=\\ln(-k\\eta)$, $du=d\\eta/\\eta$, this integral becomes Gaussian:\n$$\n\\Delta\\zeta_{\\rm src}=A_{\\rm nad}\\int_{u_{\\rm start}}^{u_{\\rm end}} e^{-u^2/(2\\sigma^2)}\\,du\n= A_{\\rm nad}\\,\\sqrt{\\frac{\\pi}{2}}\\,\\sigma\\left[\\operatorname{erf}\\!\\left(\\frac{u}{\\sqrt{2}\\,\\sigma}\\right)\\right]_{u_{\\rm start}}^{u_{\\rm end}},\n$$\nwhere $u_{\\rm start}=\\ln(-k\\,\\eta_{\\rm sh,start})$ and $u_{\\rm end}=\\ln(-k\\,\\eta_{\\rm sh,end})$. The absolute fractional sourced drift is therefore\n$$\n\\Delta_{\\rm src}=\\frac{\\left|\\Delta\\zeta_{\\rm src}\\right|}{\\left|\\zeta_k(\\eta_{\\rm sh,start})\\right|}\n=\\frac{\\left|A_{\\rm nad}\\,\\sqrt{\\frac{\\pi}{2}}\\,\\sigma\\left(\\operatorname{erf}\\!\\left(\\frac{u_{\\rm end}}{\\sqrt{2}\\,\\sigma}\\right)-\\operatorname{erf}\\!\\left(\\frac{u_{\\rm start}}{\\sqrt{2}\\,\\sigma}\\right)\\right)\\right|}{\\left|\\zeta_k(\\eta_{\\rm sh,start})\\right|}.\n$$\n\nStep 4: Diagnostic and tests.\nWe declare super-horizon conservation to hold numerically if both $\\Delta_{\\rm num} \\leq {\\rm tol}$ and $\\Delta_{\\rm src} \\leq {\\rm tol}$. We apply this to the four specified test cases:\n1. $(k,A_{\\rm nad},\\sigma,{\\rm tol})=(10^{-1}, 0, 3\\times 10^{-1}, 10^{-3})$.\n2. $(k,A_{\\rm nad},\\sigma,{\\rm tol})=(5\\times 10^{-2}, 10^{-9}, 3\\times 10^{-1}, 10^{-3})$.\n3. $(k,A_{\\rm nad},\\sigma,{\\rm tol})=(5\\times 10^{-2}, 10^{-6}, 5\\times 10^{-1}, 10^{-3})$.\n4. $(k,A_{\\rm nad},\\sigma,{\\rm tol})=(2\\times 10^{-2}, 10^{-4}, 1, 10^{-3})$.\n\nAlgorithmic design:\n- Numerically integrate the MS equation as a real $4$-dimensional system by splitting $v_k$ into real and imaginary parts to avoid complex ODE limitations. Use an explicit Runge–Kutta method with stringent tolerances to ensure accurate phase and amplitude evolution across horizon crossing.\n- Compute $z(\\eta)$ and $\\zeta_k(\\eta)=v_k(\\eta)/z(\\eta)$ at $\\eta_{\\rm sh,start}$ and $\\eta_{\\rm sh,end}$, forming $\\Delta_{\\rm num}$.\n- Evaluate $\\Delta_{\\rm src}$ using the analytic Gaussian integral above, which is valid on the super-horizon interval by construction.\n- For each test, output the boolean ${\\rm conserved}=(\\Delta_{\\rm num}\\le {\\rm tol}) \\text{ and } (\\Delta_{\\rm src}\\le {\\rm tol})$.\n- Aggregate the four booleans into a single list printed on one line in the required format.\n\nScientific realism and coverage:\n- The background and perturbation equations are standard and well-tested in linear cosmological perturbation theory.\n- The test suite covers: a strictly adiabatic case ($A_{\\rm nad}=0$), extremely small non-adiabaticity, and progressively larger but still tiny sources, as well as different scales $k$, ensuring the solver handles pre- and post-horizon regimes and that the super-horizon diagnostic behaves consistently.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\nfrom math import erf, sqrt, pi\n\n# Constants in natural units\nH = 1.0            # Hubble parameter (dimensionless in chosen units)\nepsilon = 1e-2     # slow-roll parameter (constant, small)\n\ndef a_of_eta(eta):\n    # de Sitter: a(eta) = -1/(H*eta), eta  0\n    return -1.0 / (H * eta)\n\ndef z_of_eta(eta):\n    # z = a * sqrt(2*epsilon)\n    return a_of_eta(eta) * np.sqrt(2.0 * epsilon)\n\ndef zpp_over_z(eta):\n    # For de Sitter with constant epsilon, z''/z = a''/a = 2/eta^2\n    return 2.0 / (eta**2)\n\ndef ms_system(eta, y, k):\n    # y = [Re(v), Im(v), Re(v'), Im(v')]\n    vr, vi, vpr, vpi = y\n    coeff = (k**2) - zpp_over_z(eta)\n    dvr = vpr\n    dvi = vpi\n    dvpr = -coeff * vr\n    dvpi = -coeff * vi\n    return [dvr, dvi, dvpr, dvpi]\n\ndef bunch_davies_ic(k, eta_i):\n    # v(eta_i) = exp(-i k eta_i)/sqrt(2k)\n    phase = np.exp(-1j * k * eta_i)\n    v0 = phase / np.sqrt(2.0 * k)\n    vp0 = (-1j * k) * v0\n    return np.array([v0.real, v0.imag, vp0.real, vp0.imag], dtype=float)\n\ndef compute_zeta(vr, vi, eta):\n    v = vr + 1j * vi\n    z = z_of_eta(eta)\n    return v / z\n\ndef sourced_fractional_drift(k, A_nad, sigma, eta_start, eta_end, zeta_ref_abs):\n    # Super-horizon sourced drift integral using analytic Gaussian integral.\n    # zeta' = A_nad * (1/eta) * exp[-(ln(-k eta))^2 / (2 sigma^2)]\n    # Integral over eta -> u = ln(-k eta)\n    u_start = np.log(-k * eta_start)\n    u_end = np.log(-k * eta_end)\n    pref = A_nad * np.sqrt(pi / 2.0) * sigma\n    arg_start = u_start / (np.sqrt(2.0) * sigma)\n    arg_end = u_end / (np.sqrt(2.0) * sigma)\n    delta_zeta = pref * (erf(arg_end) - erf(arg_start))\n    return abs(delta_zeta) / zeta_ref_abs\n\ndef solve_case(k, A_nad, sigma, tol):\n    # Define times\n    eta_i = -100.0 / k\n    eta_sh_start = -1.0e-1 / k\n    eta_sh_end = -1.0e-3 / k\n    eta_f = eta_sh_end\n\n    # Initial conditions\n    y0 = bunch_davies_ic(k, eta_i)\n\n    # Integrate MS equation\n    t_eval = [eta_sh_start, eta_sh_end]\n    sol = solve_ivp(\n        fun=lambda eta, y: ms_system(eta, y, k),\n        t_span=(eta_i, eta_f),\n        y0=y0,\n        t_eval=t_eval,\n        method=\"RK45\",\n        rtol=1e-9,\n        atol=1e-12,\n        dense_output=False,\n        vectorized=False,\n    )\n\n    if not sol.success or sol.y.shape[1] != 2:\n        # Fallback: treat as non-conserved if solver failed\n        return False\n\n    # Extract solutions at the two super-horizon times\n    vr_start, vi_start = sol.y[0, 0], sol.y[1, 0]\n    vr_end, vi_end = sol.y[0, 1], sol.y[1, 1]\n\n    # Compute zeta at start and end\n    zeta_start = compute_zeta(vr_start, vi_start, t_eval[0])\n    zeta_end = compute_zeta(vr_end, vi_end, t_eval[1])\n\n    # Numerical drift from homogeneous MS evolution\n    num_drift = abs(zeta_end - zeta_start) / abs(zeta_start)\n\n    # Sourced super-horizon drift fraction\n    src_drift = sourced_fractional_drift(k, A_nad, sigma, t_eval[0], t_eval[1], abs(zeta_start))\n\n    # Conservation criterion\n    conserved = (num_drift = tol) and (src_drift = tol)\n    return conserved\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each tuple: (k, A_nad, sigma, tol)\n    test_cases = [\n        (1.0e-1, 0.0, 3.0e-1, 1.0e-3),\n        (5.0e-2, 1.0e-9, 3.0e-1, 1.0e-3),\n        (5.0e-2, 1.0e-6, 5.0e-1, 1.0e-3),\n        (2.0e-2, 1.0e-4, 1.0, 1.0e-3),\n    ]\n\n    results = []\n    for k, A_nad, sigma, tol in test_cases:\n        result = solve_case(k, A_nad, sigma, tol)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3471482"}, {"introduction": "After inflation, the universe cools and enters the familiar radiation and matter-dominated eras, where perturbations eventually re-enter the horizon to seed the large-scale structure we observe today. This final practice bridges the abstract formalism of general relativity with the intuitive physics of Newtonian gravity that governs structure formation on sub-horizon scales [@problem_id:3471486]. By numerically evolving the full linear perturbation equations, you will verify that on small scales, the relationship between gravitational potential and matter density correctly reduces to the well-known Poisson equation, a fundamental check for any cosmological simulation.", "problem": "You are tasked with numerically validating the Newtonian (Poisson-limit) behavior of scalar metric perturbations in a spatially flat Lambda Cold Dark Matter (ΛCDM) cosmology. Specifically, for Fourier modes with wavenumber $k$ much larger than the conformal Hubble rate $aH$, the Newtonian Poisson equation $k^2 \\Phi = 4 \\pi G a^2 \\bar{\\rho} \\, \\delta$ should hold to high accuracy. For modes with $k \\lesssim aH$, general relativistic corrections introduce deviations from this Newtonian relation. Your program must implement a self-consistent numerical evolution of the linear perturbations to quantify the fractional residual of the Newtonian Poisson equation.\n\nThe cosmological background is a flat ΛCDM Universe with present-day matter density parameter $\\Omega_{m0}$ and cosmological constant density parameter $\\Omega_{\\Lambda 0}$, and Hubble parameter $H(a) = H_0 \\sqrt{\\Omega_{m0} a^{-3} + \\Omega_{\\Lambda 0}}$. We define the conformal Hubble rate as $\\mathcal{H}(a) = a H(a)$. For convenience and to avoid unit conversion, set $H_0 = 1$ (dimensionless units), so all quantities are dimensionless. Use $\\Omega_{m0} = 0.3$ and $\\Omega_{\\Lambda 0} = 0.7$.\n\nConsider pressureless matter (cold dark matter) with linear perturbations in Newtonian gauge. Evolve the following system for a single Fourier mode $k$ as a function of the logarithmic scale factor $N = \\ln a$:\n\n- Continuity equation for dust:\n$$\n\\delta' = - \\theta + 3 \\Phi' \\, ,\n$$\n- Euler equation for dust:\n$$\n\\theta' = - \\mathcal{H} \\, \\theta + k^2 \\Phi \\, ,\n$$\n- Einstein momentum constraint (used to compute $\\Phi'$ self-consistently):\n$$\nk^2 \\left(\\Phi' + \\mathcal{H} \\Phi \\right) = 4 \\pi G \\, a^2 \\bar{\\rho} \\, \\theta \\, .\n$$\n\nHere, $\\delta$ is the matter density contrast, $\\theta$ is the velocity divergence, $\\Phi$ is the Bardeen potential, and a prime denotes a derivative with respect to conformal time $\\eta$. Convert these equations to derivatives with respect to $N$ using $X_N \\equiv \\frac{dX}{dN} = \\frac{X'}{\\mathcal{H}}$. Use the background Friedmann relation $3 H^2(a) = 8 \\pi G \\, \\bar{\\rho}_{\\text{tot}}(a)$ and define the matter fraction\n$$\n\\Omega_m(a) = \\frac{\\Omega_{m0} a^{-3}}{\\Omega_{m0} a^{-3} + \\Omega_{\\Lambda 0}} \\, ,\n$$\nto express $4 \\pi G a^2 \\bar{\\rho}$ in terms of $\\mathcal{H}(a)$ via\n$$\n4 \\pi G a^2 \\bar{\\rho} = \\frac{3}{2} \\mathcal{H}^2(a) \\, \\Omega_m(a) \\, .\n$$\n\nInitial conditions: choose an early time $a_i = 10^{-3}$ and set adiabatic growing-mode initial conditions deep in matter domination. Take $\\Phi(a_i) = \\Phi_0$ with $\\Phi_0 = 10^{-5}$, $\\delta(a_i) = -2 \\Phi_0$, and $\\theta(a_i) = 0$. Evolve to $a_f = 1$.\n\nFor each $k$, after evolving to $a_f$, compute the fractional residual of the Newtonian Poisson equation,\n$$\nR(k) = \\frac{\\left| k^2 \\Phi(a_f) - 4 \\pi G a_f^2 \\bar{\\rho}(a_f) \\, \\delta(a_f) \\right|}{\\left| 4 \\pi G a_f^2 \\bar{\\rho}(a_f) \\, \\delta(a_f) \\right|} \\, ,\n$$\nwhich is a dimensionless float.\n\nTest suite:\n- Use $a_f = 1$ and compute $\\mathcal{H}_f \\equiv \\mathcal{H}(a_f)$ with the given background parameters.\n- Evaluate the fractional residual $R(k)$ for the following four wavenumbers:\n    1. $k = 0.01 \\, \\mathcal{H}_f$ (super-horizon at $a_f$),\n    2. $k = 1 \\, \\mathcal{H}_f$ (near-horizon at $a_f$),\n    3. $k = 10 \\, \\mathcal{H}_f$ (sub-horizon at $a_f$),\n    4. $k = 100 \\, \\mathcal{H}_f$ (deeply sub-horizon at $a_f$).\nThis set probes behavior across super-horizon, horizon, and sub-horizon regimes.\n\nRequired final output:\n- Your program should produce a single line of output containing the four computed residuals as a comma-separated list enclosed in square brackets, in the order specified above, for example, \"[r1,r2,r3,r4]\".\n- All outputs are dimensionless floats. No percentages and no physical units should be printed.\n\nScientific and numerical realism:\n- The implementation must be based on the above fundamental relations from General Relativity (GR) linear perturbation theory and the ΛCDM background.\n- The numerical integration should be performed with robust ordinary differential equation solvers and appropriate variable transformations to ensure stability across the test suite.", "solution": "The problem as stated is scientifically grounded, self-contained, and well-posed. It requires the numerical integration of a system of linear ordinary differential equations (ODEs) that describe the evolution of cosmological perturbations in a $\\Lambda$CDM universe. The equations and initial conditions are standard in the field of physical cosmology, based on General Relativity. The task is to compute the fractional residual of the Newtonian Poisson equation at the present day ($a_f=1$) for various perturbation scales, which is a classic exercise for understanding the transition from the general relativistic to the Newtonian description of gravity.\n\nThe solution proceeds as follows:\nFirst, we must formulate a system of first-order ODEs suitable for numerical integration. The problem provides three equations for the matter density contrast $\\delta$, the velocity divergence $\\theta$, and the gravitational potential $\\Phi$. The derivatives are with respect to conformal time $\\eta$. It is more convenient to integrate with respect to the logarithm of the scale factor, $N = \\ln a$. The relationship between derivatives is $\\frac{d}{dN} = \\frac{1}{\\mathcal{H}}\\frac{d}{d\\eta}$, where $\\mathcal{H} = aH$ is the conformal Hubble rate.\n\nThe given equations are:\n1.  Continuity: $\\delta' = - \\theta + 3 \\Phi'$\n2.  Euler: $\\theta' = - \\mathcal{H} \\, \\theta + k^2 \\Phi$\n3.  Einstein momentum constraint: $k^2 \\left(\\Phi' + \\mathcal{H} \\Phi \\right) = 4 \\pi G \\, a^2 \\bar{\\rho} \\, \\theta$\n\nLet a subscript $N$ denote a derivative with respect to $N$, i.e., $X_N = dX/dN = X'/\\mathcal{H}$.\nWe convert the equations:\n1.  $\\mathcal{H} \\delta_N = -\\theta + 3\\mathcal{H}\\Phi_N \\implies \\delta_N = -\\frac{\\theta}{\\mathcal{H}} + 3\\Phi_N$\n2.  $\\mathcal{H} \\theta_N = -\\mathcal{H}\\theta + k^2\\Phi \\implies \\theta_N = -\\theta + \\frac{k^2}{\\mathcal{H}}\\Phi$\n3.  $k^2(\\mathcal{H} \\Phi_N + \\mathcal{H}\\Phi) = 4\\pi G a^2 \\bar{\\rho} \\, \\theta \\implies \\Phi_N = \\frac{4\\pi G a^2 \\bar{\\rho}}{k^2\\mathcal{H}}\\theta - \\Phi$\n\nUsing the provided identity, $4 \\pi G a^2 \\bar{\\rho} = \\frac{3}{2} \\mathcal{H}^2(a) \\, \\Omega_m(a)$, where $\\bar{\\rho}$ is the background matter density, the equation for $\\Phi_N$ becomes:\n$$\n\\Phi_N = \\frac{\\frac{3}{2} \\mathcal{H}^2 \\Omega_m}{k^2 \\mathcal{H}}\\theta - \\Phi = \\frac{3}{2} \\Omega_m(a) \\frac{\\mathcal{H}(a)}{k^2} \\theta - \\Phi\n$$\nSubstituting this into the equation for $\\delta_N$ is possible, but it is numerically more direct to solve for all three variables, $[\\delta, \\theta, \\Phi]$, simultaneously. The system of first-order ODEs in $N$ for the state vector $Y(N) = [\\delta(N), \\theta(N), \\Phi(N)]^T$ is:\n$$\n\\frac{d\\delta}{dN} = -\\frac{\\theta}{\\mathcal{H}} + 3 \\left( \\frac{3}{2} \\Omega_m \\frac{\\mathcal{H}}{k^2}\\theta - \\Phi \\right) = \\left( \\frac{9}{2} \\frac{\\Omega_m \\mathcal{H}}{k^2} - \\frac{1}{\\mathcal{H}} \\right) \\theta - 3\\Phi\n$$\n$$\n\\frac{d\\theta}{dN} = -\\theta + \\frac{k^2}{\\mathcal{H}}\\Phi\n$$\n$$\n\\frac{d\\Phi}{dN} = \\frac{3}{2} \\Omega_m \\frac{\\mathcal{H}}{k^2}\\theta - \\Phi\n$$\nThe background quantities $\\mathcal{H}(a)$ and $\\Omega_m(a)$ are functions of $N$ through $a=e^N$:\n-   $\\mathcal{H}(a) = a H(a) = a H_0 \\sqrt{\\Omega_{m0} a^{-3} + \\Omega_{\\Lambda 0}} = H_0 \\sqrt{\\Omega_{m0} a^{-1} + \\Omega_{\\Lambda 0} a^2}$\n-   $\\Omega_m(a) = \\frac{\\Omega_{m0} a^{-3}}{\\Omega_{m0} a^{-3} + \\Omega_{\\Lambda 0}} = \\frac{\\Omega_{m0}}{\\Omega_{m0} + \\Omega_{\\Lambda 0} a^3}$\n\nWith $H_0 = 1$, $\\Omega_{m0} = 0.3$, and $\\Omega_{\\Lambda 0} = 0.7$, we integrate this system from the initial time $a_i = 10^{-3}$ ($N_i = \\ln(10^{-3})$) to the final time $a_f = 1$ ($N_f = 0$). The initial conditions correspond to the standard adiabatic growing mode deep in the matter-dominated era ($a \\ll 1$): $\\Phi(a_i) = \\Phi_0 = 10^{-5}$, $\\delta(a_i) = -2\\Phi_0$, and $\\theta(a_i) = 0$.\n\nThe integration is performed for four different wavenumbers: $k/\\mathcal{H}_f = \\{0.01, 1, 10, 100\\}$, where $\\mathcal{H}_f = \\mathcal{H}(a_f=1) = H_0\\sqrt{\\Omega_{m0}+\\Omega_{\\Lambda 0}} = 1$. The wavenumbers are thus $k \\in \\{0.01, 1, 10, 100\\}$. A numerical ODE solver, specifically `scipy.integrate.solve_ivp`, is used.\n\nAfter obtaining the final state $[\\delta(a_f), \\theta(a_f), \\Phi(a_f)]$, we compute the fractional residual of the Newtonian Poisson equation:\n$$\nR(k) = \\frac{\\left| k^2 \\Phi_f - (4 \\pi G a_f^2 \\bar{\\rho}_f) \\, \\delta_f \\right|}{\\left| (4 \\pi G a_f^2 \\bar{\\rho}_f) \\, \\delta_f \\right|}\n$$\nThe term $4 \\pi G a_f^2 \\bar{\\rho}_f$ is calculated using the identity:\n$$\n4 \\pi G a_f^2 \\bar{\\rho}(a_f) = \\frac{3}{2} \\mathcal{H}(a_f)^2 \\Omega_m(a_f) = \\frac{3}{2} (1)^2 (0.3) = 0.45\n$$\nThe resulting four values of $R(k)$ are then reported. The expectation is that $R(k)$ will be small for sub-horizon modes ($k \\gg \\mathcal{H}_f$) and larger for super-horizon modes ($k \\lesssim \\mathcal{H}_f$), demonstrating the regime where Newtonian gravity is a valid approximation.", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\n# Main function to encapsulate the solution process.\ndef solve():\n    \"\"\"\n    Numerically integrates the evolution of cosmological perturbations and computes\n    the fractional residual of the Newtonian Poisson equation for different\n    wavenumbers.\n    \"\"\"\n    # Cosmological Parameters\n    OMEGA_M0 = 0.3\n    OMEGA_L0 = 0.7\n    H0 = 1.0  # Dimensionless Hubble constant\n\n    # Integration settings\n    A_I = 1e-3  # Initial scale factor\n    A_F = 1.0   # Final scale factor\n    N_I = np.log(A_I)\n    N_F = np.log(A_F)\n\n    # Initial conditions for adiabatic growing mode\n    PHI_0 = 1e-5\n    DELTA_I = -2.0 * PHI_0\n    THETA_I = 0.0\n    PHI_I = PHI_0\n    Y0 = [DELTA_I, THETA_I, PHI_I]\n\n    # Helper functions for background evolution\n    def h_conf_func(a, omega_m0=OMEGA_M0, omega_l0=OMEGA_L0, h0=H0):\n        \"\"\"Calculates the conformal Hubble rate H_conf = a*H.\"\"\"\n        return h0 * np.sqrt(omega_m0 * a**(-1.0) + omega_l0 * a**(2.0))\n\n    def omega_m_func(a, omega_m0=OMEGA_M0, omega_l0=OMEGA_L0):\n        \"\"\"Calculates the matter density parameter Omega_m(a).\"\"\"\n        return (omega_m0 * a**(-3.0)) / (omega_m0 * a**(-3.0) + omega_l0)\n\n    # ODE system definition for the integrator\n    def ode_system(N, Y, k, omega_m0, omega_l0, h0):\n        \"\"\"\n        Defines the system of ODEs for (delta, theta, Phi) with respect to N = ln(a).\n        Y[0] = delta, Y[1] = theta, Y[2] = Phi\n        \"\"\"\n        delta, theta, phi = Y\n        a = np.exp(N)\n\n        # Calculate background quantities at the current step\n        h_conf = h_conf_func(a, omega_m0, omega_l0, h0)\n        omega_m = omega_m_func(a, omega_m0, omega_l0)\n\n        # The system of ODEs dY/dN\n        # Equation for d(delta)/dN\n        d_delta_dN = ( (9.0/2.0) * omega_m * h_conf / k**2 - 1.0 / h_conf ) * theta - 3.0 * phi\n        # Equation for d(theta)/dN\n        d_theta_dN = -theta + k**2 / h_conf * phi\n        # Equation for d(Phi)/dN\n        d_phi_dN = (3.0/2.0) * omega_m * h_conf / k**2 * theta - phi\n        \n        return [d_delta_dN, d_theta_dN, d_phi_dN]\n\n    # Define the wavenumbers for the test suite\n    h_conf_f = h_conf_func(A_F)\n    test_cases_k = [0.01 * h_conf_f, 1.0 * h_conf_f, 10.0 * h_conf_f, 100.0 * h_conf_f]\n\n    results = []\n    for k_val in test_cases_k:\n        # Numerically integrate the ODE system for the current k\n        sol = solve_ivp(\n            fun=ode_system,\n            t_span=[N_I, N_F],\n            y0=Y0,\n            args=(k_val, OMEGA_M0, OMEGA_L0, H0),\n            t_eval=[N_F],\n            method='RK45', # Standard solver, sufficient for this problem\n            rtol=1e-7, atol=1e-12 # Tolerances for high accuracy\n        )\n        \n        # Extract final values of the perturbations\n        delta_f, _, phi_f = sol.y[:, -1]\n\n        # Calculate the fractional residual of the Newtonian Poisson equation\n        # The term 4*pi*G*a^2*rho_m becomes (3/2)*H_conf^2*Omega_m\n        newtonian_coeff = (3.0/2.0) * h_conf_f**2 * omega_m_func(A_F)\n        \n        gr_poisson_term = k_val**2 * phi_f\n        newtonian_poisson_term = newtonian_coeff * delta_f\n        \n        # Guard against division by an extremely small number\n        if abs(newtonian_poisson_term)  1e-30:\n            # This case is not expected in a physical growing mode scenario\n            residual = np.nan\n        else:\n            residual = np.abs(gr_poisson_term - newtonian_poisson_term) / np.abs(newtonian_poisson_term)\n        \n        results.append(residual)\n\n    # Format and print the final output as specified\n    print(f\"[{','.join(f'{r:.6f}' for r in results)}]\")\n\n# Execute the main function to produce the solution.\nsolve()\n```", "id": "3471486"}]}