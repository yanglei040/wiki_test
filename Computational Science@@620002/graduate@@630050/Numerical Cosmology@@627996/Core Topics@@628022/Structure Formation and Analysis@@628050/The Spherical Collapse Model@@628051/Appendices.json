{"hands_on_practices": [{"introduction": "Our exploration of the spherical collapse model begins with the classic, analytically solvable case of an Einstein-de Sitter universe. By working with the famous cycloid parametric solution, you will develop a fundamental intuition for the non-linear dynamics of a top-hat overdensity. This practice reveals a key temporal symmetry in gravitational collapse and establishes the core concepts of 'turnaround' and 'collapse' that underpin all subsequent models [@problem_id:3498610].", "problem": "Consider a spherically symmetric, pressureless top-hat overdensity of fixed mass $M$ embedded in an Einstein–de Sitter (EdS) universe, defined as a spatially flat matter-only Friedmann–Lemaître–Robertson–Walker (FLRW) cosmology with matter density parameter $\\Omega_{m}=1$ and cosmological constant $\\Omega_{\\Lambda}=0$. In the spherical collapse model, the physical radius $R(t)$ of the overdense patch obeys Newtonian gravity with radial equation of motion $d^{2}R/dt^{2}=-G M/R^{2}$ and admits a bound solution for sufficiently large initial overdensity. \n\nStarting from the energy integral of Newtonian gravity for radial motion, \n$$\\frac{1}{2}\\,\\dot{R}^{2}-\\frac{G M}{R}=E,$$ \nwith constant specific energy $E<0$, show that the bound trajectory can be represented by the cycloid-like parametric solution\n$$R(\\theta)=a\\left(1-\\cos\\theta\\right),\\qquad t(\\theta)=\\sqrt{\\frac{a^{3}}{G M}}\\left(\\theta-\\sin\\theta\\right),$$\nwhere $a>0$ is a constant determined by the energy $E$ and mass $M$, $G$ is the gravitational constant, and the time origin is chosen such that $t=0$ at $\\theta=0$. Define the turnaround time $t_{\\rm ta}$ as the first time at which $dR/dt=0$ and the collapse time $t_{\\rm coll}$ as the first time at which $R(t)$ returns to zero radius after turnaround. Compute the ratio $t_{\\rm coll}/t_{\\rm ta}$ as a single real number. No rounding is required, and no units are needed because the final answer is dimensionless.", "solution": "The problem asks us to first validate a proposed parametric solution for the radial motion of a spherical overdensity and then to compute the ratio of its collapse time to its turnaround time.\n\nFirst, we verify that the parametric solution solves the given energy integral. The problem provides the energy integral for the radial motion of the overdense patch of mass $M$ and radius $R(t)$:\n$$ \\frac{1}{2}\\dot{R}^{2} - \\frac{G M}{R} = E $$\nwhere $\\dot{R} = dR/dt$ and $E < 0$ is the constant specific energy for a bound solution.\n\nThe proposed parametric solution is given by:\n$$ R(\\theta) = a(1 - \\cos\\theta) $$\n$$ t(\\theta) = \\sqrt{\\frac{a^{3}}{G M}}(\\theta - \\sin\\theta) $$\nwhere $a$ is a positive constant. The parameter $\\theta$ evolves over time.\n\nTo verify this solution, we must compute $\\dot{R}$ and substitute it along with $R(\\theta)$ into the energy equation. We use the chain rule to find $\\dot{R}$:\n$$ \\dot{R} = \\frac{dR}{dt} = \\frac{dR/d\\theta}{dt/d\\theta} $$\nFirst, we find the derivatives of $R$ and $t$ with respect to $\\theta$:\n$$ \\frac{dR}{d\\theta} = \\frac{d}{d\\theta} \\left[a(1 - \\cos\\theta)\\right] = a\\sin\\theta $$\n$$ \\frac{dt}{d\\theta} = \\frac{d}{d\\theta} \\left[\\sqrt{\\frac{a^{3}}{G M}}(\\theta - \\sin\\theta)\\right] = \\sqrt{\\frac{a^{3}}{G M}}(1 - \\cos\\theta) $$\nNow, we compute their ratio to find $\\dot{R}$:\n$$ \\dot{R} = \\frac{a\\sin\\theta}{\\sqrt{\\frac{a^{3}}{G M}}(1 - \\cos\\theta)} = \\frac{a}{\\sqrt{\\frac{a^{3}}{G M}}} \\frac{\\sin\\theta}{1 - \\cos\\theta} = \\sqrt{\\frac{G M}{a}} \\frac{\\sin\\theta}{1 - \\cos\\theta} $$\nUsing the half-angle trigonometric identities $\\sin\\theta = 2\\sin(\\theta/2)\\cos(\\theta/2)$ and $1 - \\cos\\theta = 2\\sin^{2}(\\theta/2)$, the expression for $\\dot{R}$ simplifies:\n$$ \\dot{R} = \\sqrt{\\frac{G M}{a}} \\frac{2\\sin(\\theta/2)\\cos(\\theta/2)}{2\\sin^{2}(\\theta/2)} = \\sqrt{\\frac{G M}{a}} \\frac{\\cos(\\theta/2)}{\\sin(\\theta/2)} = \\sqrt{\\frac{G M}{a}} \\cot\\left(\\frac{\\theta}{2}\\right) $$\nNext, we substitute $R(\\theta)$ and this expression for $\\dot{R}$ into the energy integral:\n$$ \\frac{1}{2} \\left( \\sqrt{\\frac{G M}{a}} \\cot\\left(\\frac{\\theta}{2}\\right) \\right)^{2} - \\frac{G M}{a(1 - \\cos\\theta)} = E $$\n$$ \\frac{1}{2} \\frac{G M}{a} \\cot^{2}\\left(\\frac{\\theta}{2}\\right) - \\frac{G M}{a(2\\sin^{2}(\\theta/2))} = E $$\nExpressing the cotangent in terms of sine and cosine:\n$$ \\frac{G M}{2a} \\frac{\\cos^{2}(\\theta/2)}{\\sin^{2}(\\theta/2)} - \\frac{G M}{2a\\sin^{2}(\\theta/2)} = E $$\n$$ \\frac{G M}{2a\\sin^{2}(\\theta/2)} \\left( \\cos^{2}(\\frac{\\theta}{2}) - 1 \\right) = E $$\nUsing the identity $\\cos^{2}(x) - 1 = -\\sin^{2}(x)$:\n$$ \\frac{G M}{2a\\sin^{2}(\\theta/2)} \\left( -\\sin^{2}(\\frac{\\theta}{2}) \\right) = E $$\n$$ -\\frac{G M}{2a} = E $$\nThis result shows that the energy $E$ is indeed constant and independent of the parameter $\\theta$ (and thus of time $t$). The constant $a$ is determined by the energy and mass as $a = -GM/(2E)$. Since $E<0$ for a bound orbit, $a$ is positive, consistent with the problem statement. This validates the given parametric form as a correct solution to the equation of motion.\n\nNext, we compute the turnaround time, $t_{\\rm ta}$. Turnaround is defined as the first time at which the expansion halts and the velocity becomes zero, i.e., $\\dot{R}=0$. From our expression for $\\dot{R}$:\n$$ \\dot{R} = \\sqrt{\\frac{G M}{a}} \\cot\\left(\\frac{\\theta}{2}\\right) = 0 $$\nThis requires $\\cot(\\theta/2) = 0$. The initial condition is $t=0$ at $\\theta=0$, which corresponds to $R=0$. The shell expands for $\\theta \\in (0, \\pi)$, where $\\dot{R}>0$. The first time after $t=0$ that $\\dot{R}=0$ occurs when $\\theta/2 = \\pi/2$, so $\\theta_{\\rm ta} = \\pi$.\nThe turnaround time $t_{\\rm ta}$ is the time corresponding to $\\theta = \\pi$:\n$$ t_{\\rm ta} = t(\\pi) = \\sqrt{\\frac{a^{3}}{G M}}(\\pi - \\sin\\pi) = \\sqrt{\\frac{a^{3}}{G M}}(\\pi - 0) = \\pi\\sqrt{\\frac{a^{3}}{G M}} $$\nAt this time, the radius reaches its maximum value, $R_{\\rm ta} = R(\\pi) = a(1 - \\cos\\pi) = 2a$.\n\nFinally, we compute the collapse time, $t_{\\rm coll}$. This is defined as the first time at which the radius returns to zero after turnaround. We need to find the value of $\\theta > \\theta_{\\rm ta} = \\pi$ for which $R(\\theta) = 0$:\n$$ R(\\theta) = a(1 - \\cos\\theta) = 0 $$\nSince $a > 0$, this implies $1 - \\cos\\theta = 0$, or $\\cos\\theta = 1$. The solutions are $\\theta = 2k\\pi$ for any integer $k$. The initial state is at $k=0$ ($\\theta=0$). The first time the radius returns to zero after turnaround ($\\theta=\\pi$) corresponds to $k=1$, so $\\theta_{\\rm coll} = 2\\pi$.\nThe collapse time $t_{\\rm coll}$ is the time corresponding to $\\theta = 2\\pi$:\n$$ t_{\\rm coll} = t(2\\pi) = \\sqrt{\\frac{a^{3}}{G M}}(2\\pi - \\sin(2\\pi)) = \\sqrt{\\frac{a^{3}}{G M}}(2\\pi - 0) = 2\\pi\\sqrt{\\frac{a^{3}}{G M}} $$\n\nThe problem asks for the ratio $t_{\\rm coll}/t_{\\rm ta}$:\n$$ \\frac{t_{\\rm coll}}{t_{\\rm ta}} = \\frac{2\\pi\\sqrt{\\frac{a^{3}}{G M}}}{\\pi\\sqrt{\\frac{a^{3}}{G M}}} = 2 $$\nThe ratio is exactly $2$. This indicates that the time taken for the overdensity to collapse back to a point singularity is twice the time it took to expand to its maximum radius. The duration of the collapse phase ($t_{\\rm coll} - t_{\\rm ta}$) is equal to the duration of the expansion phase ($t_{\\rm ta}$).", "answer": "$$\\boxed{2}$$", "id": "3498610"}, {"introduction": "Moving beyond idealized models, we now tackle the evolution of an overdensity in a realistic $\\Lambda$CDM universe, where the cosmological constant significantly alters the dynamics. As no simple closed-form solution exists, this exercise requires you to develop a numerical integrator to solve the full equation of motion. You will implement a solver for a stiff differential equation and use event detection to precisely pinpoint the moments of turnaround and collapse, a critical skill set in modern numerical cosmology [@problem_id:3498600].", "problem": "Consider a spherically symmetric top-hat overdensity embedded in an expanding Friedmann–Lemaître–Robertson–Walker background. Let the background cosmology be characterized by present-day matter density parameter $\\Omega_{\\mathrm{m}0}$, cosmological constant density parameter $\\Omega_{\\Lambda 0}$, and Hubble parameter $H_{0}$. Let the scale factor be $a$, and define the dimensionless Hubble function $E(a) \\equiv H(a)/H_{0}$, with\n$$\nE(a) = \\sqrt{\\Omega_{\\mathrm{m}0}\\,a^{-3} + \\Omega_{k0}\\,a^{-2} + \\Omega_{\\Lambda 0}}, \\quad \\Omega_{k0} \\equiv 1 - \\Omega_{\\mathrm{m}0} - \\Omega_{\\Lambda 0}.\n$$\nLet the initial scale factor be $a_{i}$, and the initial top-hat overdensity be $\\delta_{i}$ at $a=a_{i}$. Denote the physical radius of the top-hat by $R(t)$, and define the dimensionless radius variable\n$$\ny(a) \\equiv \\frac{R(a)}{R(a_{i})},\n$$\nso that $y(a_{i}) = 1$. The mass inside the top-hat is conserved, $M = \\frac{4\\pi}{3} R^{3} \\rho_{\\mathrm{b}}(a) [1+\\delta(a)]$, with background matter density $\\rho_{\\mathrm{b}}(a) = \\rho_{\\mathrm{c}0}\\,\\Omega_{\\mathrm{m}0}\\,a^{-3}$ and critical density $\\rho_{\\mathrm{c}0} = 3 H_{0}^{2}/(8\\pi G)$. The spherical top-hat evolves under the Newtonian equation of motion with a cosmological constant,\n$$\n\\ddot{R} = -\\frac{G M}{R^{2}} + \\frac{\\Lambda}{3} R, \\quad \\Lambda = 3 H_{0}^{2} \\Omega_{\\Lambda 0},\n$$\nwhere overdots denote derivatives with respect to cosmic time $t$.\n\nYour tasks are:\n1. Derive a second-order ordinary differential equation in the independent variable $a$ for $y(a)$ that is suitable for numerical integration as a stiff system. You must start from the equation of motion above and the chain rule $d/dt = a H(a) d/da$, where $H(a) = H_{0} E(a)$. Express your final equation entirely in terms of $a$, $y$, $\\Omega_{\\mathrm{m}0}$, $\\Omega_{\\Lambda 0}$, $a_{i}$, and $\\delta_{i}$, and constants. Do not assume a specific gauge beyond the Newtonian treatment appropriate for sub-horizon spherical collapse.\n2. Specify physically consistent initial conditions at $a=a_{i}$ for $y(a)$ and $dy/da$ using the linear growing-mode relation in the matter-dominated limit, where $f(a) \\equiv d\\ln D/d\\ln a \\approx 1$ at sufficiently small $a$. Your initial conditions must be given explicitly in terms of $a_{i}$ and $\\delta_{i}$.\n3. Design an adaptive-step integrator with event detection for:\n   - Turnaround, defined by the condition $dy/da = 0$ (equivalently $\\dot{R} = 0$).\n   - Collapse, defined by the condition $y(a) = y_{\\mathrm{thr}}$, with a prescribed small threshold $y_{\\mathrm{thr}}$ representing practical collapse ($y_{\\mathrm{thr}} \\ll 1$).\n   The integrator must be robust for stiff behavior near collapse and must terminate at collapse or at a maximum scale factor $a_{\\max}$ if neither event occurs. If an event does not occur before $a_{\\max}$, report a sentinel value of $-1.0$ for the corresponding quantity.\n4. Implement the above as a complete, runnable program that:\n   - Integrates the system in the independent variable $a$ using an implicit, stiff solver with adaptive step-size.\n   - Implements event detection for both turnaround and collapse.\n   - Returns, for each test input, a pair of floating-point numbers $\\big[a_{\\mathrm{ta}}, a_{\\mathrm{coll}}\\big]$ where $a_{\\mathrm{ta}}$ is the turnaround scale factor and $a_{\\mathrm{coll}}$ is the collapse scale factor (using the threshold), or $-1.0$ if not attained by $a_{\\max}$.\n   - Uses dimensionless units for all quantities. No physical units should appear in the output.\n   - Uses radians for any angle if applicable, although angles are not explicitly required here.\n\nUse the following system form for numerical integration. Introduce the state vector $u(a) = \\big(y(a), v(a)\\big)$, where $v(a) \\equiv dy/da$. Your system must have the form\n$$\n\\frac{dy}{da} = v, \\quad \\frac{dv}{da} = F\\big(a, y, v; \\Omega_{\\mathrm{m}0}, \\Omega_{\\Lambda 0}, a_{i}, \\delta_{i}\\big),\n$$\nwith $F$ derived from first principles.\n\nInitial conditions at $a=a_{i}$ must be\n$$\ny(a_{i}) = 1, \\quad \\left.\\frac{dy}{da}\\right|_{a=a_{i}} = \\frac{1}{a_{i}}\\left[1 - \\frac{2}{3}\\,\\delta_{i}\\right],\n$$\nconsistent with the linear growing mode in the matter-dominated limit $f(a_{i}) \\approx 1$.\n\nNumerical details:\n- Use an adaptive stiff solver with event detection. The turnaround event is $v(a)=0$ with negative-going direction, and the collapse event is $y(a)-y_{\\mathrm{thr}}=0$ with negative-going direction.\n- Use $y_{\\mathrm{thr}} = 10^{-3}$ as the collapse threshold.\n- If an event does not occur by $a_{\\max}$, report $-1.0$ for that quantity.\n- The independent variable $a$ is dimensionless, and all other quantities are dimensionless. No physical units are required in the output.\n\nTest suite:\n- Case $1$: $\\Omega_{\\mathrm{m}0} = 1.0$, $\\Omega_{\\Lambda 0} = 0.0$, $\\delta_{i} = 0.01$, $a_{i} = 10^{-3}$, $a_{\\max} = 1.0$.\n- Case $2$: $\\Omega_{\\mathrm{m}0} = 0.3$, $\\Omega_{\\Lambda 0} = 0.7$, $\\delta_{i} = 0.005$, $a_{i} = 10^{-3}$, $a_{\\max} = 3.0$.\n- Case $3$: $\\Omega_{\\mathrm{m}0} = 0.2$, $\\Omega_{\\Lambda 0} = 0.0$, $\\delta_{i} = 0.001$, $a_{i} = 10^{-3}$, $a_{\\max} = 10.0$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results for the three cases as a comma-separated list of lists enclosed in square brackets, for example\n\"[ [a_ta1,a_coll1],[a_ta2,a_coll2],[a_ta3,a_coll3] ]\",\nwhere each $a_{\\mathrm{ta}}$ and $a_{\\mathrm{coll}}$ is a floating-point number and any missing event is marked by $-1.0$.", "solution": "The user has provided a well-posed problem from the field of physical cosmology, specifically concerning the numerical solution of the spherical collapse model. The problem statement is scientifically grounded, self-contained, and internally consistent. All necessary parameters and initial conditions for a unique solution are provided. We shall proceed with the derivation and numerical implementation.\n\nThe solution is structured as follows:\n$1$. Derivation of the second-order ordinary differential equation (ODE) for the dimensionless radius $y(a)$ with respect to the scale factor $a$.\n$2$. Formulation of the initial value problem, including the system of first-order ODEs and the specified initial conditions.\n$3$. Description of the numerical integration strategy, including the choice of solver and the implementation of event detection for turnaround and collapse.\n\n### 1. Derivation of the Equation of Motion\n\nThe starting point is the Newtonian equation of motion for the physical radius $R(t)$ of the spherical top-hat, including the effect of a cosmological constant $\\Lambda$:\n$$\n\\ddot{R} = -\\frac{G M}{R^{2}} + \\frac{\\Lambda}{3} R\n$$\nwhere overdots denote derivatives with respect to cosmic time $t$, $G$ is the gravitational constant, and $M$ is the mass enclosed within the radius $R$, which is conserved.\n\nThe mass $M$ can be expressed in terms of the initial conditions at scale factor $a_i$. The density inside the shell is $\\rho(a_i) = \\rho_{\\mathrm{b}}(a_i) (1+\\delta_i)$, where $\\rho_{\\mathrm{b}}(a)$ is the background matter density and $\\delta_i$ is the initial overdensity.\n$$\nM = \\frac{4\\pi}{3} R(a_i)^3 \\rho_{\\mathrm{b}}(a_i) (1+\\delta_i)\n$$\nUsing the definitions $\\rho_{\\mathrm{b}}(a) = \\rho_{\\mathrm{c}0}\\,\\Omega_{\\mathrm{m}0}\\,a^{-3}$ and $\\rho_{\\mathrm{c}0} = 3 H_{0}^{2}/(8\\pi G)$, we can write the mass as:\n$$\nM = \\frac{4\\pi}{3} R(a_i)^3 \\left( \\frac{3 H_0^2}{8\\pi G} \\Omega_{\\mathrm{m}0} a_i^{-3} \\right) (1+\\delta_i) = \\frac{H_0^2 \\Omega_{\\mathrm{m}0} (1+\\delta_i) R(a_i)^3}{2 G a_i^3}\n$$\nThe cosmological constant is given by $\\Lambda = 3 H_{0}^{2} \\Omega_{\\Lambda 0}$. Substituting the expressions for $M$ and $\\Lambda$ into the equation of motion yields:\n$$\n\\ddot{R} = -\\frac{G}{R^2} \\left( \\frac{H_0^2 \\Omega_{\\mathrm{m}0} (1+\\delta_i) R(a_i)^3}{2 G a_i^3} \\right) + \\frac{3 H_0^2 \\Omega_{\\Lambda 0}}{3} R\n$$\n$$\n\\ddot{R} = -\\frac{H_0^2 \\Omega_{\\mathrm{m}0} (1+\\delta_i)}{2 a_i^3} \\frac{R(a_i)^3}{R^2} + H_0^2 \\Omega_{\\Lambda 0} R\n$$\nWe introduce the dimensionless radius $y(a) \\equiv R(a)/R(a_i)$, which implies $R(a) = R(a_i) y(a)$. Differentiating with respect to time gives $\\ddot{R} = R(a_i) \\ddot{y}$. Substituting this into the equation and dividing by $R(a_i)$ gives an equation for $y$:\n$$\n\\ddot{y} = -\\frac{H_0^2 \\Omega_{\\mathrm{m}0} (1+\\delta_i)}{2 a_i^3 y^2} + H_0^2 \\Omega_{\\Lambda 0} y\n$$\nNext, we change the independent variable from cosmic time $t$ to the scale factor $a$. The chain rule for time derivatives is $\\frac{d}{dt} = \\frac{da}{dt} \\frac{d}{da} = \\dot{a} \\frac{d}{da}$. Since $H = \\dot{a}/a$, we have $\\dot{a} = a H(a) = a H_0 E(a)$. Thus, $\\frac{d}{dt} = a H_0 E(a) \\frac{d}{da}$.\nThe first derivative of $y$ is:\n$$\n\\dot{y} = \\frac{dy}{dt} = a H_0 E(a) \\frac{dy}{da}\n$$\nThe second derivative is:\n$$\n\\ddot{y} = \\frac{d\\dot{y}}{dt} = a H_0 E(a) \\frac{d}{da} \\left( a H_0 E(a) \\frac{dy}{da} \\right)\n$$\n$$\n\\ddot{y} = a H_0^2 E(a) \\left[ \\frac{d(a E(a))}{da} \\frac{dy}{da} + a E(a) \\frac{d^2y}{da^2} \\right]\n$$\n$$\n\\ddot{y} = a H_0^2 E(a) \\left[ \\left(E(a) + a \\frac{dE}{da}\\right) \\frac{dy}{da} + a E(a) \\frac{d^2y}{da^2} \\right]\n$$\nEquating the two expressions for $\\ddot{y}$ and cancelling $H_0^2$:\n$$\na E(a) \\left[ \\left(E(a) + a \\frac{dE}{da}\\right) \\frac{dy}{da} + a E(a) \\frac{d^2y}{da^2} \\right] = -\\frac{\\Omega_{\\mathrm{m}0} (1+\\delta_i)}{2 a_i^3 y^2} + \\Omega_{\\Lambda 0} y\n$$\nWe now solve for $\\frac{d^2y}{da^2}$. Let $v(a) \\equiv \\frac{dy}{da}$.\n$$\na^2 E(a)^2 \\frac{d^2y}{da^2} = -a E(a) \\left(E(a) + a \\frac{dE}{da}\\right) v + \\Omega_{\\Lambda 0} y - \\frac{\\Omega_{\\mathrm{m}0} (1+\\delta_i)}{2 a_i^3 y^2}\n$$\nTo simplify the coefficient of $v$, we evaluate the term $a \\frac{d(a E^2)}{da} / 2 = a(E^2 + a \\cdot 2 E \\frac{dE}{da})/2 = aE^2 + a^2 E \\frac{dE}{da}$.\nFrom $E(a)^2 = \\Omega_{\\mathrm{m}0} a^{-3} + \\Omega_{k0} a^{-2} + \\Omega_{\\Lambda 0}$, we have:\n$$\na E(a)^2 = \\Omega_{\\mathrm{m}0} a^{-2} + \\Omega_{k0} a^{-1} + \\Omega_{\\Lambda 0} a\n$$\nAnd $2 E \\frac{dE}{da} = -3 \\Omega_{\\mathrm{m}0} a^{-4} - 2 \\Omega_{k0} a^{-3}$, which gives $a^2 E \\frac{dE}{da} = \\frac{a^2}{2}(-3 \\Omega_{\\mathrm{m}0} a^{-4} - 2 \\Omega_{k0} a^{-3}) = -\\frac{3}{2}\\Omega_{\\mathrm{m}0}a^{-2} - \\Omega_{k0}a^{-1}$.\nThe coefficient of $v$ involves the sum:\n$$\n-\\left( a E(a)^2 + a^2 E \\frac{dE}{da} \\right) = - \\left( (\\Omega_{\\mathrm{m}0} a^{-2} - \\frac{3}{2}\\Omega_{\\mathrm{m}0}a^{-2}) + (\\Omega_{k0} a^{-1} - \\Omega_{k0}a^{-1}) + \\Omega_{\\Lambda 0} a \\right) = \\frac{1}{2}\\Omega_{\\mathrm{m}0}a^{-2} - \\Omega_{\\Lambda 0}a\n$$\nSubstituting this back, we get the equation for $\\frac{d^2y}{da^2}$:\n$$\n\\frac{d^2y}{da^2} = \\frac{1}{a^2 E(a)^2} \\left[ \\left( \\frac{1}{2}\\Omega_{\\mathrm{m}0}a^{-2} - \\Omega_{\\Lambda 0}a \\right)v + \\Omega_{\\Lambda 0} y - \\frac{\\Omega_{\\mathrm{m}0}(1+\\delta_i)}{2 a_i^3 y^2} \\right]\n$$\nThis is the required second-order ODE for $y(a)$.\n\n### 2. Initial Value Problem Formulation\n\nTo solve this numerically, we convert the second-order ODE into a system of two first-order ODEs. Let the state vector be $u(a) = \\begin{pmatrix} y(a) \\\\ v(a) \\end{pmatrix}$, where $v(a) = \\frac{dy}{da}$. The system is:\n$$\n\\frac{du}{da} = \n\\begin{pmatrix} \\frac{dy}{da} \\\\ \\frac{dv}{da} \\end{pmatrix}\n=\n\\begin{pmatrix} v \\\\ F(a, y, v) \\end{pmatrix}\n$$\nwhere\n$$\nF(a, y, v) = \\frac{1}{a^2 E(a)^2} \\left[ \\left( \\frac{1}{2}\\Omega_{\\mathrm{m}0}a^{-2} - \\Omega_{\\Lambda 0}a \\right)v + \\Omega_{\\Lambda 0} y - \\frac{\\Omega_{\\mathrm{m}0}(1+\\delta_i)}{2 a_i^3 y^2} \\right]\n$$\nwith $E(a)^2 = \\Omega_{\\mathrm{m}0}a^{-3} + (1-\\Omega_{\\mathrm{m}0}-\\Omega_{\\Lambda 0})a^{-2} + \\Omega_{\\Lambda 0}$.\n\nThe problem specifies the initial conditions at $a=a_i$. These are consistent with the linear growing mode in the matter-dominated limit ($f(a_i) \\approx 1$):\n- $y(a_i) = 1$\n- $v(a_i) = \\left.\\frac{dy}{da}\\right|_{a=a_i} = \\frac{1}{a_i} \\left[ 1 - \\frac{2}{3} \\delta_i \\right]$\nThe initial state vector is therefore $u(a_i) = \\left( 1, \\frac{1}{a_i} [1 - \\frac{2}{3}\\delta_i] \\right)$.\n\n### 3. Numerical Integration Strategy\n\nThe ODE system exhibits stiff behavior, particularly near collapse ($y \\to 0$) where the term proportional to $1/y^2$ causes the derivatives to become very large. An implicit solver with adaptive step-sizing is required for a robust and efficient solution. We will use `scipy.integrate.solve_ivp` with the `Radau` method, which is designed for stiff problems.\n\nThe problem requires detecting two specific events during the integration:\n1.  **Turnaround**: Occurs when the shell reaches its maximum radius and begins to contract. This corresponds to the physical velocity $\\dot{R}$ changing sign from positive to negative. Since both $a$ and $E(a)$ are positive, this is equivalent to $v(a) = \\frac{dy}{da}$ crossing zero from positive to negative. The event function is $v(a) = 0$, and we seek a root where the function is decreasing (direction = $-1$). This event is non-terminal.\n2.  **Collapse**: Defined as the point where the dimensionless radius $y(a)$ shrinks to a small threshold value $y_{\\mathrm{thr}} = 10^{-3}$. The event function is $y(a) - y_{\\mathrm{thr}} = 0$. Since the shell is collapsing, $y(a)$ is decreasing, so we seek a root where the function is decreasing (direction = $-1$). This event is terminal, halting the integration.\n\nThe integration for each test case will proceed from $a=a_i$ up to a maximum scale factor $a_{\\max}$. The times (scale factors) of any detected events are recorded. If an event is not detected by $a_{\\max}$, its corresponding scale factor is reported as $-1.0$.\n\nThe implementation combines these components into a single function that iterates through the provided test cases, solves the initial value problem for each, extracts the turnaround and collapse scale factors, and formats the output as specified.", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Solves the spherical collapse model ODE for given cosmological parameters.\n    \"\"\"\n\n    test_cases = [\n        # (Omega_m0, Omega_L0, delta_i, a_i, a_max)\n        (1.0, 0.0, 0.01, 1e-3, 1.0),\n        (0.3, 0.7, 0.005, 1e-3, 3.0),\n        (0.2, 0.0, 0.001, 1e-3, 10.0),\n    ]\n\n    y_thr = 1e-3\n    results = []\n\n    for params in test_cases:\n        Omega_m0, Omega_L0, delta_i, a_i, a_max = params\n        Omega_k0 = 1.0 - Omega_m0 - Omega_L0\n\n        def spherical_collapse_ode(a, u, p):\n            \"\"\"\n            Defines the system of ODEs for the spherical collapse model.\n            u = [y, v] where y is the dimensionless radius and v = dy/da.\n            p = [Omega_m0, Omega_L0, Omega_k0, delta_i, a_i]\n            \"\"\"\n            y, v = u\n            Omega_m0_p, Omega_L0_p, Omega_k0_p, delta_i_p, a_i_p = p\n            \n            # Avoid division by zero if y is non-positive, though the solver\n            # and collapse event should prevent this.\n            if y <= 0:\n                # Return large derivatives to signify a problematic state\n                return [v, -1e100]\n\n            # E(a)^2 = H(a)^2 / H0^2\n            E_sq = Omega_m0_p * a**-3 + Omega_k0_p * a**-2 + Omega_L0_p\n\n            # dv/da = F(a, y, v)\n            # F = (1/(a^2 E^2)) * [ term_v * v + term_y * y + term_const ]\n            \n            # Coefficient of v in the numerator of dv/da\n            v_coeff = 0.5 * Omega_m0_p * a**-2 - Omega_L0_p * a\n            \n            # term with y\n            y_term = Omega_L0_p * y\n\n            # term independent of v and y (inside the bracket)\n            const_term = -0.5 * Omega_m0_p * (1.0 + delta_i_p) / (a_i_p**3 * y**2)\n\n            dv_da = (v_coeff * v + y_term + const_term) / (a**2 * E_sq)\n            \n            return [v, dv_da]\n\n        # Initial conditions\n        y0 = 1.0\n        v0 = (1.0 / a_i) * (1.0 - (2.0 / 3.0) * delta_i)\n        u0 = [y0, v0]\n\n        # Event: Turnaround (dy/da = v = 0)\n        def turnaround(a, u, p):\n            return u[1]\n        turnaround.terminal = False\n        turnaround.direction = -1  # Event triggers when v goes from positive to negative\n\n        # Event: Collapse (y = y_thr)\n        def collapse(a, u, p):\n            return u[0] - y_thr\n        collapse.terminal = True\n        collapse.direction = -1   # Event triggers when y decreases through y_thr\n\n        # Integration span\n        t_span = (a_i, a_max)\n\n        # Solve the ODE\n        sol = solve_ivp(\n            fun=spherical_collapse_ode,\n            t_span=t_span,\n            y0=u0,\n            method='Radau',\n            args=([Omega_m0, Omega_L0, Omega_k0, delta_i, a_i],),\n            events=[turnaround, collapse],\n            dense_output=True,\n            atol=1e-9,  # Absolute tolerance\n            rtol=1e-9,  # Relative tolerance\n        )\n        \n        # Extract results\n        a_ta = -1.0\n        if sol.t_events[0].size > 0:\n            a_ta = sol.t_events[0][0]\n\n        a_coll = -1.0\n        if sol.t_events[1].size > 0:\n            a_coll = sol.t_events[1][0]\n        # In case the terminal event didn't trigger correctly but integration stopped\n        elif sol.status == 1 and sol.y[0, -1] <= y_thr:\n            a_coll = sol.t[-1]\n\n        results.append([a_ta, a_coll])\n\n    # Format the final output string\n    str_results = [f\"[{r[0]},{r[1]}]\" for r in results]\n    print(f\"[{','.join(str_results)}]\")\n\n\nsolve()\n```", "id": "3498600"}, {"introduction": "A numerical result is only as reliable as the code that produces it, making validation an indispensable part of computational science. This practice focuses on quantifying the accuracy of your numerical integrator for the spherical collapse problem. By implementing a Leapfrog scheme and using Richardson extrapolation, you will verify the convergence rate of your code and establish rigorous error bounds on your predictions for the turnaround and virial radii [@problem_id:3498607].", "problem": "You are tasked with designing and validating a numerical integrator for the spherical top-hat collapse in an Einstein–de Sitter cosmology (matter-only, zero cosmological constant). The integrator must be second-order accurate and its convergence must be demonstrated via Richardson extrapolation applied to the turnaround radius and the virial radius.\n\nFundamental base to use:\n- Newton's second law of motion: $m \\, d^2 R / dt^2 = F$.\n- Newtonian gravity for a spherically symmetric mass distribution: the gravitational acceleration at physical radius $R$ due to enclosed mass $M$ is $a(R) = - G M / R^2$.\n- Conservation of specific mechanical energy for an isolated spherical shell: $\\varepsilon = \\tfrac{1}{2} v^2 + \\Phi(R)$ with gravitational potential $\\Phi(R) = - G M / R$ for motion under an inverse-square central force.\n- Virial theorem for a bound, isolated system in an inverse-square potential at equilibrium: $2 K + U = 0$, leading to a virial relation between the virial radius and the turnaround radius in the matter-only case.\n\nDefinitions to implement:\n- The spherical top-hat region is characterized by its outer physical radius $R(t)$ and enclosed mass $M$; its outer shell evolves under $d^2 R / dt^2 = - G M / R^2$ with initial conditions $R(0) = R_0$ and $v(0) = v_0 > 0$ (an initially expanding shell).\n- The turnaround radius $R_{\\rm ta}$ is the first local maximum of $R(t)$ where the radial velocity $v(t) = dR/dt$ changes sign from positive to negative.\n- The virial radius $R_{\\rm vir}$ is the equilibrium size inferred from energy conservation and the virial theorem in a matter-only universe.\n\nProgram requirements:\n1. Implement a fixed time-step, second-order, symplectic Leapfrog (velocity Verlet) integrator for the ordinary differential equation $d^2 R / dt^2 = - G M / R^2$ that advances $(R, v)$ in time with step size $h$ and detects the first turnaround by identifying the sign change of the half-step velocity. Use the discrete maximum of the recorded $R$ values as the numerical estimate of $R_{\\rm ta}(h)$.\n2. For each test case, produce two numerical approximations of $R_{\\rm ta}$ using step sizes $h$ and $h/2$, then perform one-step Richardson extrapolation of order $p = 2$ to estimate the zero-step limit $R_{\\rm ta}^{\\rm (extrap)}$ via the formula\n$$\nR_{\\rm ta}^{\\rm (extrap)} = R_{\\rm ta}(h/2) + \\frac{R_{\\rm ta}(h/2) - R_{\\rm ta}(h)}{2^p - 1}.\n$$\n3. Using fundamental principles, derive an exact expression for $R_{\\rm ta}$ in the matter-only case from the initial conditions $(R_0, v_0)$ and $M$ and compute the exact $R_{\\rm vir}$ from $R_{\\rm ta}$ using the virial theorem.\n4. Compute the fractional errors for both $R_{\\rm ta}$ and $R_{\\rm vir}$ as\n$$\n\\delta_{\\rm ta} = \\left| \\frac{R_{\\rm ta}^{\\rm (extrap)} - R_{\\rm ta}^{\\rm (exact)}}{R_{\\rm ta}^{\\rm (exact)}} \\right|,\\quad\n\\delta_{\\rm vir} = \\left| \\frac{R_{\\rm vir}^{\\rm (extrap)} - R_{\\rm vir}^{\\rm (exact)}}{R_{\\rm vir}^{\\rm (exact)}} \\right|.\n$$\n5. Demonstrate that for all test cases the fractional errors satisfy $\\delta_{\\rm ta} < 10^{-5}$ and $\\delta_{\\rm vir} < 10^{-5}$.\n\nScientific realism and units:\n- Use normalized units with $G = 1$. All quantities are dimensionless in these units, so no physical unit conversion is required.\n- Initial velocities $v_0$ are specified as positive values so that the shell initially expands before turning around.\n\nTest suite:\nProvide results for the following three test cases, each specified as $(M, R_0, v_0, h)$:\n- Case A (general, moderately bound): $(1, 1, 0.5, 2 \\times 10^{-3})$.\n- Case B (near-parabolic boundary, weakly bound with large turnaround radius): $(1, 1, 1.3, 5 \\times 10^{-4})$.\n- Case C (strongly bound, small turnaround radius): $(1, 1, 0.1, 2 \\times 10^{-4})$.\n\nFinal output format:\n- Your program should produce a single line of output containing the fractional errors in the order\n$$\n[\\delta_{\\rm ta}^{(A)}, \\delta_{\\rm vir}^{(A)}, \\delta_{\\rm ta}^{(B)}, \\delta_{\\rm vir}^{(B)}, \\delta_{\\rm ta}^{(C)}, \\delta_{\\rm vir}^{(C)}],\n$$\nas a comma-separated list enclosed in square brackets, where each entry is a floating-point number.", "solution": "The problem is valid.\n\n### Step 1: Extract Givens\n- **Equation of Motion**: The outer shell of the spherical top-hat region evolves under its own gravity according to Newton's second law, which for a shell of mass $m$ at physical radius $R$ enclosing a total mass $M$ is $m \\frac{d^2 R}{dt^2} = -\\frac{GMm}{R^2}$, simplifying to the acceleration equation $\\frac{d^2 R}{dt^2} = -\\frac{GM}{R^2}$.\n- **Initial Conditions**: The shell starts its evolution at $t=0$ with an initial radius $R(0) = R_0$ and an initial outward velocity $v(0) = v_0 > 0$.\n- **Definitions**:\n    - **Turnaround Radius ($R_{\\rm ta}$)**: The first local maximum of $R(t)$, where the radial velocity $v = dR/dt$ becomes zero.\n    - **Virial Radius ($R_{\\rm vir}$)**: The equilibrium radius of the collapsed and virialized object, determined by the virial theorem.\n- **Numerical Method**:\n    - **Integrator**: A second-order symplectic Leapfrog (velocity Verlet) integrator with a fixed time step $h$.\n    - **Turnaround Detection**: The numerical estimate $R_{\\rm ta}(h)$ is the discrete maximum of the radius values $R_i$ recorded during the integration until the first turnaround.\n- **Extrapolation**: A one-step Richardson extrapolation of order $p=2$ must be used to find an improved estimate for the turnaround radius:\n$$\nR_{\\rm ta}^{\\rm (extrap)} = R_{\\rm ta}(h/2) + \\frac{R_{\\rm ta}(h/2) - R_{\\rm ta}(h)}{2^p - 1}.\n$$\n- **Error Calculation**: The fractional errors for the turnaround and virial radii are defined as:\n$$\n\\delta_{\\rm ta} = \\left| \\frac{R_{\\rm ta}^{\\rm (extrap)} - R_{\\rm ta}^{\\rm (exact)}}{R_{\\rm ta}^{\\rm (exact)}} \\right|,\\quad\n\\delta_{\\rm vir} = \\left| \\frac{R_{\\rm vir}^{\\rm (extrap)} - R_{\\rm vir}^{\\rm (exact)}}{R_{\\rm vir}^{\\rm (exact)}} \\right|.\n$$\n- **Accuracy Requirement**: The computed fractional errors must satisfy $\\delta_{\\rm ta} < 10^{-5}$ and $\\delta_{\\rm vir} < 10^{-5}$ for all test cases.\n- **Units**: Normalized units are used, with the gravitational constant $G=1$.\n- **Test Cases**:\n    - Case A: $(M, R_0, v_0, h) = (1, 1, 0.5, 2 \\times 10^{-3})$.\n    - Case B: $(M, R_0, v_0, h) = (1, 1, 1.3, 5 \\times 10^{-4})$.\n    - Case C: $(M, R_0, v_0, h) = (1, 1, 0.1, 2 \\times 10^{-4})$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, well-posed, and objective. It represents a standard and fundamental problem in cosmology concerning the formation of large-scale structures. The physical model (Newtonian gravity, energy conservation, virial theorem) and the numerical methods (Leapfrog integration, Richardson extrapolation) are standard and appropriate for the task. The problem is self-contained, providing all necessary equations, initial conditions, constants, and clear definitions. The initial conditions for all test cases correspond to gravitationally bound systems (i.e., total energy is negative, $v_0^2 < 2GM/R_0$), which ensures that a turnaround event will occur. The problem statement is free of contradictions, ambiguities, and scientific flaws.\n\n### Step 3: Verdict and Action\nThe problem is deemed valid. A complete solution is provided below.\n\n### Principle-Based Solution Design\n\nThe solution is developed in three main parts: analytical derivation, numerical implementation, and error analysis.\n\n**1. Analytical Derivations**\n\nThe exact solutions for $R_{\\rm ta}$ and $R_{\\rm vir}$ are derived from fundamental conservation laws.\n\n**Exact Turnaround Radius ($R_{\\rm ta}^{\\rm (exact)}$)**\nThe specific mechanical energy $\\varepsilon$ of the shell, $\\varepsilon = \\frac{1}{2}v^2 - \\frac{GM}{R}$, is a conserved quantity. We can evaluate it at the initial time ($t=0$) and at the moment of turnaround ($t=t_{\\rm ta}$).\n- At $t=0$: $R = R_0$, $v = v_0 \\implies \\varepsilon = \\frac{1}{2}v_0^2 - \\frac{GM}{R_0}$.\n- At $t=t_{\\rm ta}$: $R = R_{\\rm ta}$, $v = 0 \\implies \\varepsilon = -\\frac{GM}{R_{\\rm ta}}$.\nEquating these two expressions for the conserved energy $\\varepsilon$ yields:\n$$\n-\\frac{GM}{R_{\\rm ta}} = \\frac{1}{2}v_0^2 - \\frac{GM}{R_0}\n$$\nSolving for $R_{\\rm ta}$ gives the exact analytical expression for the turnaround radius, valid for a bound system where the total energy is negative:\n$$\nR_{\\rm ta}^{\\rm (exact)} = \\frac{GM}{\\frac{GM}{R_0} - \\frac{1}{2}v_0^2} = \\frac{2GMR_0}{2GM - v_0^2R_0}\n$$\n\n**Exact Virial Radius ($R_{\\rm vir}^{\\rm (exact)}$)**\nAfter collapse, the system is assumed to reach a stable equilibrium state (virialization). For a system governed by an inverse-square law force like gravity, the virial theorem states that the time-averaged kinetic energy $\\langle K \\rangle$ and potential energy $\\langle U \\rangle$ are related by $2\\langle K \\rangle + \\langle U \\rangle = 0$. The total energy of the virialized system, $E_{\\rm vir} = \\langle K \\rangle + \\langle U \\rangle$, can thus be expressed as $E_{\\rm vir} = \\frac{1}{2}\\langle U \\rangle$. The potential energy at the virial radius is $\\langle U \\rangle = U_{\\rm vir} = -\\frac{GMm}{R_{\\rm vir}}$ (where $m$ is the shell mass).\nSince total energy is conserved throughout the entire process, the energy of the virialized system must equal the initial energy, which is also the energy at turnaround, $E = E_{\\rm ta} = -\\frac{GMm}{R_{\\rm ta}}$. Equating the energy expressions:\n$$\nE_{\\rm vir} = E_{\\rm ta} \\implies \\frac{1}{2} \\left( -\\frac{GMm}{R_{\\rm vir}} \\right) = -\\frac{GMm}{R_{\\rm ta}}\n$$\nThis directly leads to the simple, exact relation between the virial and turnaround radii for a matter-only universe:\n$$\nR_{\\rm vir}^{\\rm (exact)} = \\frac{1}{2} R_{\\rm ta}^{\\rm (exact)}\n$$\n\n**2. Numerical Integration Scheme**\n\nThe equation of motion, $\\ddot{R} = a(R) = -GM/R^2$, is integrated numerically using the specified second-order Leapfrog (velocity Verlet) algorithm. For a time step $h$, the state $(R_{n+1}, v_{n+1})$ at time $t_{n+1}$ is determined from the state $(R_n, v_n)$ at time $t_n$ by the following steps:\n1.  **Half-step velocity update**: $v_{n+1/2} = v_n + \\frac{h}{2} a(R_n)$.\n2.  **Full-step position update**: $R_{n+1} = R_n + h v_{n+1/2}$.\n3.  **Full-step velocity update**: $v_{n+1} = v_{n+1/2} + \\frac{h}{2} a(R_{n+1})$.\n\nThe simulation starts with the initial conditions $(R_0, v_0)$ and is run until the velocity $v$ becomes non-positive. The numerical estimate for the turnaround radius for a given step size $h$, denoted $R_{\\rm ta}(h)$, is the maximum value of the radius encountered during this integration period.\n\n**3. Extrapolation and Error Analysis**\n\nSince the Leapfrog integrator has a second-order error dependence ($p=2$), a more accurate result can be obtained via Richardson extrapolation. By performing the simulation for two different step sizes, $h$ and $h/2$, we obtain two estimates, $R_{\\rm ta}(h)$ and $R_{\\rm ta}(h/2)$. The extrapolated value, $R_{\\rm ta}^{\\rm (extrap)}$, which has a higher order of accuracy, is calculated using the provided formula with $p=2$:\n$$\nR_{\\rm ta}^{\\rm (extrap)} = R_{\\rm ta}(h/2) + \\frac{R_{\\rm ta}(h/2) - R_{\\rm ta}(h)}{2^2 - 1} = R_{\\rm ta}(h/2) + \\frac{1}{3} \\left(R_{\\rm ta}(h/2) - R_{\\rm ta}(h)\\right)\n$$\nThe corresponding extrapolated virial radius is obtained by applying the physical relation derived earlier:\n$$\nR_{\\rm vir}^{\\rm (extrap)} = \\frac{1}{2} R_{\\rm ta}^{\\rm (extrap)}\n$$\nFinally, the fractional errors are calculated by comparing these extrapolated numerical results to the exact analytical solutions. Notably, the fractional error for the virial radius is provably identical to that of the turnaround radius due to their linear relationship:\n$$\n\\delta_{\\rm vir} = \\left| \\frac{R_{\\rm vir}^{\\rm (extrap)} - R_{\\rm vir}^{\\rm (exact)}}{R_{\\rm vir}^{\\rm (exact)}} \\right| = \\left| \\frac{\\frac{1}{2}R_{\\rm ta}^{\\rm (extrap)} - \\frac{1}{2}R_{\\rm ta}^{\\rm (exact)}}{\\frac{1}{2}R_{\\rm ta}^{\\rm (exact)}} \\right| = \\left| \\frac{R_{\\rm ta}^{\\rm (extrap)} - R_{\\rm ta}^{\\rm (exact)}}{R_{\\rm ta}^{\\rm (exact)}} \\right| = \\delta_{\\rm ta}\n$$\nThe implementation will calculate both errors and confirm they meet the required precision threshold of $< 10^{-5}$.", "answer": "```python\nimport numpy as np\n\ndef run_simulation(M, R0, v0, h):\n    \"\"\"\n    Integrates the equation of motion for a spherical shell using the Leapfrog method.\n\n    The method simulates the trajectory of a shell with initial radius R0 and velocity v0\n    under the gravitational influence of the enclosed mass M. It stops when the shell\n    turns around (velocity becomes non-positive) and returns the maximum radius achieved.\n\n    Args:\n        M (float): The enclosed mass.\n        R0 (float): The initial radius of the shell.\n        v0 (float): The initial velocity of the shell.\n        h (float): The time step for the integration.\n\n    Returns:\n        float: The numerical a pproximation of the turnaround radius, R_ta(h).\n    \"\"\"\n    G = 1.0  # Normalized gravitational constant\n\n    r = float(R0)\n    v = float(v0)\n    \n    # Ensure the system is bound and will turn around\n    if 0.5 * v**2 >= G * M / r:\n        raise ValueError(\"System is not gravitationally bound; no turnaround will occur.\")\n\n    max_r = r\n    \n    # The integration loop continues as long as the shell is expanding (v > 0).\n    while v > 0:\n        # Leapfrog (velocity Verlet) integration steps\n        # 1. Acceleration at the current position\n        a_current = -G * M / r**2\n        \n        # 2. Velocity at the half-step\n        v_half_step = v + 0.5 * h * a_current\n        \n        # 3. Position at the next full step\n        r_next = r + h * v_half_step\n        \n        # 4. Acceleration at the new position\n        a_next = -G * M / r_next**2\n        \n        # 5. Velocity at the next full step\n        v_next = v_half_step + 0.5 * h * a_next\n        \n        # Update state for the next iteration\n        r, v = r_next, v_next\n        \n        # Track the maximum radius reached. Since the loop runs while v>0,\n        # r is monotonically increasing until the turnaround point. This check\n        # correctly captures the discrete maximum even if the radius overshoots\n        # the true peak in the final step.\n        if r > max_r:\n            max_r = r\n            \n    return max_r\n\ndef solve():\n    \"\"\"\n    Main function to solve the spherical collapse problem for the given test cases.\n    \n    For each test case, it:\n    1. Calculates the exact analytical turnaround and virial radii.\n    2. Runs numerical simulations for step sizes h and h/2.\n    3. Performs Richardson extrapolation to get a more accurate numerical estimate.\n    4. Computes the fractional errors for the turnaround and virial radii.\n    5. Collects the errors for final output.\n    \"\"\"\n    test_cases = [\n        # Case A (general, moderately bound)\n        (1.0, 1.0, 0.5, 2e-3),\n        # Case B (near-parabolic, weakly bound)\n        (1.0, 1.0, 1.3, 5e-4),\n        # Case C (strongly bound)\n        (1.0, 1.0, 0.1, 2e-4),\n    ]\n\n    G = 1.0\n    p = 2.0  # Order of the Leapfrog integrator\n    results = []\n\n    for M, R0, v0, h in test_cases:\n        # 1. Analytical Solution\n        # Exact turnaround radius from energy conservation\n        R_ta_exact = (2.0 * G * M * R0) / (2.0 * G * M - v0**2 * R0)\n        # Exact virial radius from the virial theorem in a matter-only universe\n        R_vir_exact = 0.5 * R_ta_exact\n\n        # 2. Numerical Integration\n        # Run simulation with step size h\n        R_ta_h = run_simulation(M, R0, v0, h)\n        # Run simulation with step size h/2\n        R_ta_h_half = run_simulation(M, R0, v0, h / 2.0)\n\n        # 3. Richardson Extrapolation\n        # Improve the estimate of R_ta using the results from two step sizes.\n        R_ta_extrap = R_ta_h_half + (R_ta_h_half - R_ta_h) / (2**p - 1.0)\n        \n        # The extrapolated virial radius is derived from the extrapolated turnaround radius.\n        R_vir_extrap = 0.5 * R_ta_extrap\n\n        # 4. Fractional Error Calculation\n        delta_ta = np.abs((R_ta_extrap - R_ta_exact) / R_ta_exact)\n        delta_vir = np.abs((R_vir_extrap - R_vir_exact) / R_vir_exact)\n        \n        results.extend([delta_ta, delta_vir])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.10e}' for r in results)}]\")\n\nsolve()\n```", "id": "3498607"}]}