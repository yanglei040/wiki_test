{"hands_on_practices": [{"introduction": "Introducing a numerical term like artificial viscosity is not without practical consequences for a simulation's stability and performance. Its primary role in capturing shocks introduces a new signal speed, which in turn constrains the maximum allowable time step through the Courant–Friedrichs–Lewy (CFL) condition. This first exercise provides a concrete, quantitative look at this fundamental relationship, connecting the viscosity term to the practical necessity of adaptive time-stepping in cosmological simulations [@problem_id:3465304].", "problem": "In Smoothed Particle Hydrodynamics (SPH) used for numerical cosmology, artificial viscosity introduces a characteristic pairwise signal velocity that bounds the speed at which compressive disturbances propagate between neighbors. For an explicitly time-integrated method, stability and causality impose that information must not traverse more than an order-unity fraction of the local resolution scale in a single time step, a requirement commonly captured by the Courant–Friedrichs–Lewy (CFL) condition. Consider a single SPH particle evolving under hydrodynamics and gravity in a cosmological setting, with local smoothing length $h$ and an estimate of the maximum pairwise artificial-viscosity signal speed over its neighbors, $v_{\\text{sig}}$. Assume a standard explicit scheme in which the only relevant bound is that set by finite signal propagation over the kernel scale, modulated by a dimensionless Courant factor $C_{\\text{CFL}} \\in (0,1)$.\n\nStarting from these principles and definitions, derive a general expression for the particle’s maximum allowed time step $\\Delta t_{\\max}$ in terms of $h$, $v_{\\text{sig}}$, and $C_{\\text{CFL}}$. Then evaluate this maximum time step for a particle with $h = 0.005$, neighbor-maximum $v_{\\text{sig}} = 30$, and $C_{\\text{CFL}} = 0.25$. All quantities are given in consistent code units so that the resulting time step is in code time units. Round your final numerical answer to $4$ significant figures. Finally, based on your derivation, discuss the implications of this bound for local time-stepping strategies in cosmological simulations, particularly in regions with strong shocks and large density contrasts. Your final reported answer must be the single numerical value of $\\Delta t_{\\max}$ in code time units.", "solution": "The relevant starting point is the stability constraint for explicit time integration in hyperbolic systems with finite signal propagation speeds. In such systems, the Courant–Friedrichs–Lewy (CFL) condition enforces that in one time step, the fastest signal should not traverse more than an order-unity fraction of the local resolution scale. In Smoothed Particle Hydrodynamics (SPH), the local resolution scale is set by the smoothing length $h$, while the maximal neighbor-to-neighbor propagation speed of compressive disturbances in the presence of artificial viscosity is captured by an estimate $v_{\\text{sig}}$ constructed from pairwise interactions.\n\nThe fundamental requirement is that the distance traversed by the fastest relevant signal during a time step $\\Delta t$ is bounded by a fraction of the resolution length. Writing this causality and stability constraint,\n$$\nv_{\\text{sig}} \\, \\Delta t \\lesssim C_{\\text{CFL}} \\, h,\n$$\nwhere $C_{\\text{CFL}} \\in (0,1)$ is a dimensionless Courant factor that encodes the geometric constants of the kernel support, details of the explicit scheme, and a safety margin for nonlinearities and multi-dimensional effects. Solving this for the time step bound gives the general expression\n$$\n\\Delta t_{\\max} = \\frac{C_{\\text{CFL}} \\, h}{v_{\\text{sig}}}.\n$$\n\nThis follows directly from (i) the definition of the SPH smoothing length $h$ as the characteristic kernel scale over which interactions are resolved, (ii) the identification of $v_{\\text{sig}}$ as an upper bound to the neighbor-to-neighbor information speed introduced by artificial viscosity to capture compressive shocks, and (iii) the stability requirement of explicit methods that the domain of dependence of the discrete scheme must contain that of the continuum problem.\n\nWe now evaluate this expression for the specified particle data. Given $h = 0.005$, $v_{\\text{sig}} = 30$, and $C_{\\text{CFL}} = 0.25$, all in consistent code units, we substitute into\n$$\n\\Delta t_{\\max} = \\frac{C_{\\text{CFL}} \\, h}{v_{\\text{sig}}}.\n$$\nCompute the numerator:\n$$\nC_{\\text{CFL}} \\, h = 0.25 \\times 0.005 = 0.00125.\n$$\nDivide by $v_{\\text{sig}}$:\n$$\n\\Delta t_{\\max} = \\frac{0.00125}{30} = 0.000041666\\ldots = 4.166666\\ldots \\times 10^{-5}.\n$$\nRounding to $4$ significant figures yields\n$$\n\\Delta t_{\\max} = 4.167 \\times 10^{-5},\n$$\nin code time units.\n\nImplications for local time-stepping in cosmological simulations: The derived bound shows that $\\Delta t_{\\max} \\propto h / v_{\\text{sig}}$. In cosmological structure formation, high-density regions such as virialized halos and shock fronts typically have smaller $h$ (due to Lagrangian adaptivity concentrating resolution) and larger $v_{\\text{sig}}$ (due to enhanced sound speeds and relative velocities across compressive flows that trigger stronger artificial viscosity). Consequently, $\\Delta t_{\\max}$ can decrease by orders of magnitude in these regions compared to the diffuse intergalactic medium. Local time-stepping schemes exploit this by assigning smaller time steps only where needed, thus maintaining accuracy and stability near shocks while avoiding a global time step limited by a tiny subset of particles. However, this introduces challenges: synchronization between hydrodynamics and long-range gravity solvers, conservation errors if neighboring particles evolve with disparate time steps, and the need for time-step limiters to prevent large disparities across interacting neighbors. In comoving formulations, care must also be taken that $v_{\\text{sig}}$ and $h$ are consistently defined in the same (physical or comoving) frame so that the CFL bound remains meaningful. Overall, the scaling $\\Delta t_{\\max} \\sim h / v_{\\text{sig}}$ motivates hierarchical local time-stepping with neighbor-aware limiters in realistic cosmological flows.", "answer": "$$\\boxed{4.167 \\times 10^{-5}}$$", "id": "3465304"}, {"introduction": "A major challenge with artificial viscosity is that its dissipative effects, while essential for shocks, can unphysically dampen other important fluid motions like shear and vorticity. To address this, modern SPH codes employ \"switches\" that intelligently modulate the viscosity based on local flow conditions. This next practice guides you through the process of constructing such a switch from first principles, demonstrating how a simple ratio of flow invariants can distinguish between compression and rotation to improve the physical realism of the simulation [@problem_id:3465306].", "problem": "In cosmological Smoothed Particle Hydrodynamics (SPH), artificial viscosity is introduced to capture shocks while avoiding spurious dissipation in vortical or shear-dominated flows. A common strategy is to modulate the artificial viscosity coefficient by a switch factor that suppresses viscosity in regions where vorticity dominates over compression. Consider a switch function $f$ that multiplies a base artificial viscosity coefficient $\\alpha$, so that the effective coefficient is $f \\alpha$. The switch $f$ should satisfy the following principles derived from first principles and dimensional analysis:\n\n- It depends only on kinematic invariants that distinguish compression from rotation, namely the divergence magnitude $\\left|\\nabla \\cdot \\mathbf{v}\\right|$ and the vorticity magnitude $\\left|\\nabla \\times \\mathbf{v}\\right|$.\n- It is dimensionless, bounded between $0$ and $1$, increases monotonically with $\\left|\\nabla \\cdot \\mathbf{v}\\right|$ at fixed $\\left|\\nabla \\times \\mathbf{v}\\right|$, and decreases monotonically with $\\left|\\nabla \\times \\mathbf{v}\\right|$ at fixed $\\left|\\nabla \\cdot \\mathbf{v}\\right|$.\n- It remains well-defined in quiescent flows by including a regularizing term constructed from the local signal speed $c$ and smoothing length $h$, combined with a small dimensionless parameter $\\epsilon0$, such that the combination has the same dimensions as $\\left|\\nabla \\cdot \\mathbf{v}\\right|$ and $\\left|\\nabla \\times \\mathbf{v}\\right|$.\n\n(a) Using these requirements, construct the simplest admissible form of $f$ built from nonnegative linear contributions of the admissible invariants that respects the stated monotonicity, boundedness, and dimensional constraints.\n\n(b) For a locally vortical flow in a cosmological SPH calculation with $\\left|\\nabla \\cdot \\mathbf{v}\\right|=0.01$, $\\left|\\nabla \\times \\mathbf{v}\\right|=10$, $c=1$, $h=0.05$, $\\epsilon=0.1$, and base coefficient $\\alpha=1$, evaluate the switch $f$ and the effective artificial viscosity coefficient $f\\alpha$.\n\nRound your numerical results for $f$ and $f\\alpha$ to four significant figures. Report your final answers as two numbers without units in the order $\\left(f, f\\alpha\\right)$.", "solution": "(a) To construct the switch function $f$, we follow the provided principles. The function must distinguish between compression, measured by the divergence magnitude $D = |\\nabla \\cdot \\mathbf{v}|$, and rotation, measured by the vorticity magnitude $W = |\\nabla \\times \\mathbf{v}|$. Both $D$ and $W$ have dimensions of inverse time ($[T^{-1}]$).\n\n- **Dimensionless and Monotonic:** To be dimensionless, $f$ must be a function of a dimensionless combination of its inputs. For $f$ to increase with $D$ and decrease with $W$, the simplest form is a ratio with $D$ in the numerator and $W$ in the denominator.\n- **Simplicity and Boundedness:** The simplest form built from nonnegative linear contributions that is bounded between 0 and 1 is a ratio of the compression term to the sum of all relevant terms:\n$$ f = \\frac{|\\nabla \\cdot \\mathbf{v}|}{|\\nabla \\cdot \\mathbf{v}| + |\\nabla \\times \\mathbf{v}|} $$\nThis function naturally ranges from 0 (for pure rotation/shear, where $|\\nabla \\cdot \\mathbf{v}| \\to 0$) to 1 (for pure compression, where $|\\nabla \\times \\mathbf{v}| \\to 0$).\n- **Regularization:** To prevent division by zero in quiescent flows where both divergence and vorticity are zero, a regularization term must be added to the denominator. This term must have the same dimensions as divergence, $[T^{-1}]$. Using the local signal speed $c$ ($[L T^{-1}]$) and smoothing length $h$ ($[L]$), the combination $c/h$ provides the correct dimensions. The regularization term is thus $\\epsilon c/h$.\n\nCombining these points, the simplest admissible form for the switch function is:\n$$ f = \\frac{|\\nabla \\cdot \\mathbf{v}|}{|\\nabla \\cdot \\mathbf{v}| + |\\nabla \\times \\mathbf{v}| + \\epsilon \\frac{c}{h}} $$\nThis form is known as the Balsara switch.\n\n(b) Now we evaluate $f$ and the effective viscosity coefficient $f\\alpha$ using the given values:\n- $|\\nabla \\cdot \\mathbf{v}| = 0.01$\n- $|\\nabla \\times \\mathbf{v}| = 10$\n- $c = 1$\n- $h = 0.05$\n- $\\epsilon = 0.1$\n- $\\alpha = 1$\n\nFirst, calculate the regularization term in the denominator:\n$$ \\epsilon \\frac{c}{h} = (0.1) \\frac{1}{0.05} = 0.1 \\times 20 = 2 $$\nNext, substitute all values into the expression for $f$:\n$$ f = \\frac{0.01}{0.01 + 10 + 2} = \\frac{0.01}{12.01} \\approx 0.000832639... $$\nRounding to four significant figures, we get $f = 0.0008326$.\nThe effective artificial viscosity coefficient is:\n$$ f\\alpha = (0.0008326) \\times 1 = 0.0008326 $$\nThe very low value of the switch confirms that the viscosity is correctly suppressed in this vorticity-dominated flow.", "answer": "$$ \\boxed{ \\begin{pmatrix} 0.0008326  0.0008326 \\end{pmatrix} } $$", "id": "3465306"}, {"introduction": "Even a well-designed numerical method can produce unphysical artifacts when faced with specific physical conditions. This conceptual problem delves into one such classic issue in SPH: the formation of a spurious pressure gradient, or \"blip\", at a stationary contact discontinuity. You will diagnose why standard artificial viscosity is fundamentally unable to correct this error and explore more advanced remedies, highlighting the importance of choosing the right tools to ensure physical accuracy at fluid interfaces [@problem_id:3504512].", "problem": "In Smoothed Particle Hydrodynamics (SPH), consider a one-dimensional, stationary, planar contact discontinuity at position $x=0$ between two ideal-gas phases with equal true pressure $P_0$, equal velocity $v=0$, and different constant densities $\\rho_{\\mathrm{L}} \\neq \\rho_{\\mathrm{R}}$ on the left and right, respectively. The gas obeys the ideal-gas equation of state $P=(\\gamma-1)\\rho u$, where $u$ is the specific internal energy and $\\gamma$ is the adiabatic index. You use the density–entropy SPH formulation in which each particle carries an entropic function $A$ that is advected in the absence of shocks and determines its pressure together with the kernel-interpolated density. No physical viscosity or conduction is present. You enable only an artificial viscosity (AV) shock capturing term with a standard compression-based trigger, and you do not include any artificial conductivity (AC) or diffusion of thermal energy/entropy. After transients, you observe a persistent, localized, non-zero pressure gradient (“pressure blip”) at the interface and associated spurious surface-tension-like forces.\n\nFrom first principles of the Euler equations, the ideal-gas law, and the structure of SPH discretizations and their dissipation triggers, which of the following statements best explain why artificial viscosity alone does not remove the pressure blip in density–entropy SPH and how adding artificial conductivity or adopting a pressure–entropy formulation remedies it? Select all that apply.\n\nA. In density–entropy SPH, a contact discontinuity with equal true pressure but different densities produces a spurious pressure jump because the kernel-smoothed density $\\rho_i$ is mixed across the interface while the entropic function $A_i$ remains particle-wise; thus $P_i=A_i\\,\\rho_i^{\\gamma}$ becomes multivalued near the contact. Artificial viscosity acts through the momentum equation when neighbors are in compression (i.e., interparticle $\\mathbf{v}_{ij}\\cdot \\mathbf{r}_{ij}0$), which is absent at a stationary contact, so it does not remove the multivalued pressure.\n\nB. Artificial viscosity directly diffuses the specific internal energy $u$ across the contact even without compression, equalizing $u$ and hence $P$ under $P=(\\gamma-1)\\rho u$, so it removes the blip in purely isobaric, stationary contacts.\n\nC. Adding an artificial conductivity term that diffuses thermal energy or entropy between neighbors across sharp $u$ or $A$ gradients drives these fields toward continuity; together with $P=(\\gamma-1)\\rho u$ (or $P=A\\,\\rho^{\\gamma}$), this yields a single-valued pressure and removes the blip, while leaving the inviscid momentum equation unmodified away from shocks.\n\nD. A pressure–entropy SPH formulation chooses pressure-weighted volume elements and a particle Lagrangian depending on $P$ so that the discretized force law is consistent across contacts and $P$ is single-valued by construction; this eliminates the blip and surface-tension-like error at the interface.\n\nE. The pressure blip is caused by failure of kernel normalization near boundaries; simply increasing the neighbor number $N_{\\mathrm{ngb}}$ always eliminates it without any change to the formulation or additional diffusion terms.\n\nSelect all correct options.", "solution": "This problem explores a well-known numerical artifact in SPH at contact discontinuities. Let's analyze each option based on the principles of SPH.\n\nThe core of the problem lies in the density-entropy SPH formulation. Pressure for particle $i$ is calculated as $P_i = A_i \\rho_i^\\gamma$. The entropic function $A_i$ is a property of the particle and remains constant, while the density $\\rho_i$ is a smoothed average over its neighbors. At a contact discontinuity with equal pressure $P_0$ but different densities $\\rho_L \\neq \\rho_R$, particles from the left and right sides will have different entropic functions ($A_L = P_0/\\rho_L^\\gamma \\neq P_0/\\rho_R^\\gamma = A_R$). Near the interface, a particle's neighbors come from both sides, so its smoothed density $\\rho_i$ will be an intermediate value. However, it retains its original $A_i$. This leads to an inconsistent pressure calculation (e.g., a particle from the left will have $P_i = A_L \\rho_i^\\gamma \\neq P_0$), creating a spurious pressure gradient, or \"blip\".\n\nWith this understanding, let's evaluate the options:\n\n**A. Correct.** This statement accurately identifies the origin of the pressure blip: the conflict between the particle-wise constant entropic function $A_i$ and the kernel-smoothed density $\\rho_i$. It also correctly explains why standard artificial viscosity (AV) is ineffective: AV is triggered by compression ($\\mathbf{v}_{ij}\\cdot\\mathbf{r}_{ij}  0$), which is absent in a stationary ($\\mathbf{v}=0$) contact discontinuity.\n\n**B. Incorrect.** Standard artificial viscosity is not a diffusion term for internal energy $u$ and is not active in the absence of compression. It cannot equalize $u$ across the contact.\n\n**C. Correct.** An artificial conductivity (AC) term is specifically designed to handle thermal discontinuities. It introduces diffusion of thermal energy or entropy, driven by the sharp gradients in $u$ or $A$ that exist at the contact. This smoothing process makes the pressure calculation consistent across the interface, thereby removing the blip. It acts on the energy equation, leaving the momentum equation unchanged in non-shock regions.\n\n**D. Correct.** Pressure-entropy SPH formulations are advanced schemes that reformulate the equations of motion to prioritize pressure continuity. By using pressure as a fundamental variable in the Lagrangian or employing iterative methods, they ensure that pressure is consistent across contact discontinuities by construction, thus preventing the artifact from forming in the first place.\n\n**E. Incorrect.** The pressure blip is a fundamental issue with the formulation, not a simple kernel-sampling or normalization error at an external boundary. Increasing the number of neighbors merely smears the artifact over a wider region without eliminating the underlying inconsistency in the pressure calculation.\n\nTherefore, options A, C, and D correctly describe the problem and its potential solutions.", "answer": "$$\\boxed{ACD}$$", "id": "3504512"}]}