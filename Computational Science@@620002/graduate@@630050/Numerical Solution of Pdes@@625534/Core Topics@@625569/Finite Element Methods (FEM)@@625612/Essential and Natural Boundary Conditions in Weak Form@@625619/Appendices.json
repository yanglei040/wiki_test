{"hands_on_practices": [{"introduction": "This first practice is a foundational exercise in translating a Partial Differential Equation (PDE) from its strong form to its weak form. Starting with a second-order elliptic equation on a 2D domain, you will use integration by parts to derive the corresponding weak formulation. This process will require you to carefully distinguish between essential (Dirichlet) and natural (Neumann, Robin) boundary conditions, reinforcing the core mechanism by which natural conditions become part of the variational problem itself [@problem_id:3387621].", "problem": "Consider the second-order linear elliptic Partial Differential Equation (PDE) in mixed boundary conditions on the unit square domain $\\Omega=(0,1)\\times(0,1)$ with boundary $\\Gamma=\\partial\\Omega$ partitioned into a Dirichlet segment $\\Gamma_D$, a Neumann segment $\\Gamma_N$, and a Robin segment $\\Gamma_R$ as follows:\n- $\\Gamma_D=\\{(x,0): 0<x<1\\}$,\n- $\\Gamma_N=\\{(x,1): 0<x<1\\}\\cup\\{(0,y): 0<y<1\\}$,\n- $\\Gamma_R=\\{(1,y): 0<y<1\\}$.\n\nThe strong form is\n$$\n-\\nabla\\cdot\\big(k\\,\\nabla u\\big)+c\\,u=f\\quad\\text{in }\\Omega,\n$$\nwith boundary conditions\n$$\nu=g\\quad\\text{on }\\Gamma_D,\\qquad \\big(k\\,\\nabla u\\big)\\cdot n=h\\quad\\text{on }\\Gamma_N,\\qquad \\big(k\\,\\nabla u\\big)\\cdot n+\\alpha\\,u=r\\quad\\text{on }\\Gamma_R,\n$$\nwhere $n$ is the outward unit normal. The coefficients and data are\n$$\nk=\\begin{pmatrix}2 & 1 \\\\[4pt] 1 & 3\\end{pmatrix},\\quad c=5,\\quad \\alpha=4,\\quad f(x,y)=x+2,\\quad g=0,\n$$\n$$\nh(x,1)=1+x\\text{ for }(x,1)\\in\\Gamma_N,\\quad h(0,y)=0\\text{ for }(0,y)\\in\\Gamma_N,\\quad r(y)=y^2\\text{ for }(1,y)\\in\\Gamma_R.\n$$\n\n(a) Starting from the strong form and using integration by parts together with the given boundary conditions, construct the weak form by identifying the trial space $V$ and test space $V_0$, and assembling the bilinear form $a(\\cdot,\\cdot)$ and the linear functional $\\ell(\\cdot)$ so that the weak problem reads: find $u\\in V$ such that\n$$\na(u,v)=\\ell(v)\\quad\\text{for all }v\\in V_0.\n$$\nClearly state which boundary conditions are essential and which are natural, and ensure that the Neumann and Robin data appear in the correct places.\n\n(b) Let $u(x,y)=(1+x)\\,y$ and $v(x,y)=y$. Using your assembled $a(\\cdot,\\cdot)$ and $\\ell(\\cdot)$, evaluate the scalar\n$$\nJ \\equiv a(u,v)-\\ell(v).\n$$\nReport the exact value of $J$ as a single real number. No rounding is required, and no units are involved.", "solution": "The user wants me to solve a two-part problem centered on the weak formulation of a second-order elliptic partial differential equation.\n\n(a) Construct the weak form of the given PDE.\n\nThe process begins with the strong form of the PDE, valid in the domain $\\Omega$:\n$$\n-\\nabla\\cdot\\big(k\\,\\nabla u\\big)+c\\,u=f\n$$\nTo derive the weak form, we multiply the equation by an arbitrary test function $v$ and integrate over the domain $\\Omega$. The test function $v$ is chosen from a suitable space $V_0$, which will be defined shortly.\n$$\n\\int_\\Omega \\left( -\\nabla\\cdot(k\\,\\nabla u) + c\\,u \\right) v \\, d\\Omega = \\int_\\Omega f v \\, d\\Omega\n$$\nUsing the linearity of the integral, we separate the terms on the left-hand side:\n$$\n-\\int_\\Omega \\big(\\nabla\\cdot(k\\,\\nabla u)\\big) v \\, d\\Omega + \\int_\\Omega c\\,u\\,v \\, d\\Omega = \\int_\\Omega f v \\, d\\Omega\n$$\nThe first term is handled using integration by parts, which in this multidimensional context is an application of the divergence theorem (or Green's first identity). The identity states $\\int_\\Omega (\\nabla \\cdot \\mathbf{F}) \\phi \\, d\\Omega = \\oint_{\\partial\\Omega} (\\mathbf{F} \\cdot n) \\phi \\, dS - \\int_\\Omega \\mathbf{F} \\cdot \\nabla\\phi \\, d\\Omega$. Let $\\mathbf{F} = k\\,\\nabla u$ and $\\phi = v$.\n$$\n\\int_\\Omega \\big(\\nabla\\cdot(k\\,\\nabla u)\\big) v \\, d\\Omega = \\oint_{\\Gamma} \\big((k\\,\\nabla u)\\cdot n\\big) v \\, dS - \\int_\\Omega (k\\,\\nabla u)\\cdot \\nabla v \\, d\\Omega\n$$\nwhere $\\Gamma = \\partial\\Omega$ is the boundary of the domain and $n$ is the outward unit normal vector. Substituting this back into the integrated PDE gives:\n$$\n-\\left( \\oint_{\\Gamma} \\big((k\\,\\nabla u)\\cdot n\\big) v \\, dS - \\int_\\Omega (k\\,\\nabla u)\\cdot \\nabla v \\, d\\Omega \\right) + \\int_\\Omega c\\,u\\,v \\, d\\Omega = \\int_\\Omega f v \\, d\\Omega\n$$\nRearranging the terms yields the foundational equation for the weak form:\n$$\n\\int_\\Omega (k\\,\\nabla u)\\cdot \\nabla v \\, d\\Omega + \\int_\\Omega c\\,u\\,v \\, d\\Omega = \\int_\\Omega f v \\, d\\Omega + \\oint_{\\Gamma} \\big((k\\,\\nabla u)\\cdot n\\big) v \\, dS\n$$\nThe boundary conditions are now incorporated. The boundary $\\Gamma$ is partitioned into $\\Gamma_D$, $\\Gamma_N$, and $\\Gamma_R$. The boundary integral is split accordingly:\n$$\n\\oint_{\\Gamma} \\big((k\\,\\nabla u)\\cdot n\\big) v \\, dS = \\int_{\\Gamma_D} \\big((k\\,\\nabla u)\\cdot n\\big) v \\, dS + \\int_{\\Gamma_N} \\big((k\\,\\nabla u)\\cdot n\\big) v \\, dS + \\int_{\\Gamma_R} \\big((k\\,\\nabla u)\\cdot n\\big) v \\, dS\n$$\nThe distinction between essential and natural boundary conditions is crucial.\nAn **essential boundary condition** is one that is imposed directly on the function space for the solution. In this problem, the Dirichlet condition $u=g$ on $\\Gamma_D$ is a quintessential essential condition. We define the trial space $V$ for the solution $u$ and the test space $V_0$ for the test function $v$ using the appropriate Sobolev space $H^1(\\Omega) = \\{w \\in L^2(\\Omega) : \\nabla w \\in [L^2(\\Omega)]^2\\}$.\nThe trial space is the set of functions that satisfy the essential (Dirichlet) boundary condition:\n$V = \\{w \\in H^1(\\Omega) \\mid w|_{\\Gamma_D} = g\\}$.\nThe test space is the corresponding vector space where the homogeneous version of the essential condition holds:\n$V_0 = \\{w \\in H^1(\\Omega) \\mid w|_{\\Gamma_D} = 0\\}$.\nSince any test function $v \\in V_0$ must be zero on $\\Gamma_D$, the integral over $\\Gamma_D$ vanishes:\n$$\n\\int_{\\Gamma_D} \\big((k\\,\\nabla u)\\cdot n\\big) v \\, dS = 0\n$$\n**Natural boundary conditions** are those that are not explicitly enforced on the function spaces but are instead incorporated into the weak formulation itself through the boundary integral terms. The Neumann and Robin conditions fall into this category.\nOn the Neumann boundary $\\Gamma_N$, we substitute the condition $(k\\,\\nabla u)\\cdot n = h$:\n$$\n\\int_{\\Gamma_N} \\big((k\\,\\nabla u)\\cdot n\\big) v \\, dS = \\int_{\\Gamma_N} h v \\, dS\n$$\nOn the Robin boundary $\\Gamma_R$, we substitute the condition $(k\\,\\nabla u)\\cdot n = r - \\alpha u$:\n$$\n\\int_{\\Gamma_R} \\big((k\\,\\nabla u)\\cdot n\\big) v \\, dS = \\int_{\\Gamma_R} (r - \\alpha u) v \\, dS = \\int_{\\Gamma_R} r v \\, dS - \\int_{\\Gamma_R} \\alpha u v \\, dS\n$$\nSubstituting these boundary integral expressions back into the main equation gives:\n$$\n\\int_\\Omega (k\\,\\nabla u)\\cdot \\nabla v \\, d\\Omega + \\int_\\Omega c\\,u\\,v \\, d\\Omega = \\int_\\Omega f v \\, d\\Omega + \\int_{\\Gamma_N} h v \\, dS + \\int_{\\Gamma_R} r v \\, dS - \\int_{\\Gamma_R} \\alpha u v \\, dS\n$$\nTo arrive at the standard weak form $a(u,v)=\\ell(v)$, we group all terms involving the solution $u$ on the left-hand side and all other terms, which depend only on the test function $v$ and given data, on the right-hand side.\n$$\n\\int_\\Omega (k\\,\\nabla u)\\cdot \\nabla v \\, d\\Omega + \\int_\\Omega c\\,u\\,v \\, d\\Omega + \\int_{\\Gamma_R} \\alpha u v \\, dS = \\int_\\Omega f v \\, d\\Omega + \\int_{\\Gamma_N} h v \\, dS + \\int_{\\Gamma_R} r v \\, dS\n$$\nFrom this equation, we identify the bilinear form $a(\\cdot,\\cdot)$ and the linear functional $\\ell(\\cdot)$.\n\nThe final weak formulation is: Find $u \\in V$ such that $a(u,v) = \\ell(v)$ for all $v \\in V_0$.\n\nThe components are:\n- **Trial Space:** $V = \\{w \\in H^1(\\Omega) \\mid w=g \\text{ on } \\Gamma_D\\}$. Since $g=0$ is given, $V = \\{w \\in H^1(\\Omega) \\mid w=0 \\text{ on } \\Gamma_D\\}$.\n- **Test Space:** $V_0 = \\{w \\in H^1(\\Omega) \\mid w=0 \\text{ on } \\Gamma_D\\}$. For this problem, $V = V_0$.\n- **Bilinear Form:**\n$$a(u,v) = \\int_\\Omega \\Big( (k\\,\\nabla u)\\cdot\\nabla v + c\\,u\\,v \\Big) \\,d\\Omega + \\int_{\\Gamma_R} \\alpha\\,u\\,v \\,dS$$\n- **Linear Functional:**\n$$\\ell(v) = \\int_\\Omega f v \\,d\\Omega + \\int_{\\Gamma_N} h v \\,dS + \\int_{\\Gamma_R} r v \\,dS$$\n\n- **Essential Boundary Condition:** $u=g$ on $\\Gamma_D$. It is enforced by the construction of the trial space $V$.\n- **Natural Boundary Conditions:** $(k\\,\\nabla u)\\cdot n=h$ on $\\Gamma_N$ and $(k\\,\\nabla u)\\cdot n+\\alpha\\,u=r$ on $\\Gamma_R$. They are satisfied weakly through their inclusion in the definitions of $a(u,v)$ and $\\ell(v)$.\n\n(b) Evaluate $J \\equiv a(u,v)-\\ell(v)$.\n\nWe need to compute the scalar $J$ for the given functions $u(x,y)=(1+x)y$ and $v(x,y)=y$.\nThe expression for $J$ is:\n$$\nJ = a(u,v) - \\ell(v) = \\left( \\int_\\Omega \\big((k\\,\\nabla u)\\cdot\\nabla v + c\\,u\\,v\\big) \\,d\\Omega + \\int_{\\Gamma_R} \\alpha\\,u\\,v \\,dS \\right) - \\left( \\int_\\Omega f v \\,d\\Omega + \\int_{\\Gamma_N} h v \\,dS + \\int_{\\Gamma_R} r v \\,dS \\right)\n$$\nRearranging the terms for a combined calculation:\n$$\nJ = \\int_\\Omega \\Big( (k\\,\\nabla u)\\cdot\\nabla v + c\\,u\\,v - fv \\Big) \\,d\\Omega + \\int_{\\Gamma_R} (\\alpha\\,u\\,v - r v) \\,dS - \\int_{\\Gamma_N} h v \\,dS\n$$\nFirst, we compute the necessary components:\n- Functions: $u(x,y) = (1+x)y$, $v(x,y) = y$\n- Gradients: $\\nabla u = \\begin{pmatrix} y \\\\ 1+x \\end{pmatrix}$, $\\nabla v = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$\n- Coefficient matrix: $k = \\begin{pmatrix} 2 & 1 \\\\ 1 & 3 \\end{pmatrix}$\n- Other coefficients and data: $c=5$, $\\alpha=4$, $f(x,y)=x+2$.\n\nNow, we evaluate each integral term.\n\n1.  **Domain Integral:** $\\int_\\Omega \\Big( (k\\,\\nabla u)\\cdot\\nabla v + c\\,u\\,v - fv \\Big) \\,d\\Omega$ over $\\Omega=(0,1)\\times(0,1)$.\n    We compute the integrand term-by-term:\n    - $k\\,\\nabla u = \\begin{pmatrix} 2 & 1 \\\\ 1 & 3 \\end{pmatrix} \\begin{pmatrix} y \\\\ 1+x \\end{pmatrix} = \\begin{pmatrix} 2y + (1+x) \\\\ y + 3(1+x) \\end{pmatrix} = \\begin{pmatrix} x+2y+1 \\\\ 3x+y+3 \\end{pmatrix}$\n    - $(k\\,\\nabla u)\\cdot\\nabla v = (x+2y+1)(0) + (3x+y+3)(1) = 3x+y+3$\n    - $c\\,u\\,v = 5 \\cdot (1+x)y \\cdot y = 5(1+x)y^2 = 5y^2+5xy^2$\n    - $f v = (x+2)y = xy+2y$\n    The full integrand is $(3x+y+3) + (5y^2+5xy^2) - (xy+2y) = 5xy^2 - xy + 5y^2 - y + 3x + 3$.\n    We integrate this over the unit square:\n    $\\int_0^1 \\int_0^1 (5xy^2 - xy + 5y^2 - y + 3x + 3) \\, dx \\, dy$\n    $= \\int_0^1 \\left[ \\frac{5}{2}x^2y^2 - \\frac{1}{2}x^2y + 5xy^2 - xy + \\frac{3}{2}x^2 + 3x \\right]_{x=0}^{1} \\, dy$\n    $= \\int_0^1 \\left( \\frac{5}{2}y^2 - \\frac{1}{2}y + 5y^2 - y + \\frac{3}{2} + 3 \\right) \\, dy$\n    $= \\int_0^1 \\left( \\frac{15}{2}y^2 - \\frac{3}{2}y + \\frac{9}{2} \\right) \\, dy$\n    $= \\left[ \\frac{15}{2}\\frac{y^3}{3} - \\frac{3}{2}\\frac{y^2}{2} + \\frac{9}{2}y \\right]_0^1 = \\left[ \\frac{5}{2}y^3 - \\frac{3}{4}y^2 + \\frac{9}{2}y \\right]_0^1$\n    $= \\frac{5}{2} - \\frac{3}{4} + \\frac{9}{2} = \\frac{14}{2} - \\frac{3}{4} = 7 - \\frac{3}{4} = \\frac{25}{4}$.\n\n2.  **Neumann Boundary Integral:** $- \\int_{\\Gamma_N} h v \\,dS$\n    $\\Gamma_N$ consists of two parts:\n    - $\\Gamma_{N1} = \\{(x,1) : 0<x<1\\}$. Here $dS=dx$, $h(x,1)=1+x$, and $v(x,1)=1$.\n      $\\int_{\\Gamma_{N1}} h v \\,dS = \\int_0^1 (1+x)(1) \\,dx = [x+\\frac{x^2}{2}]_0^1 = 1+\\frac{1}{2} = \\frac{3}{2}$.\n    - $\\Gamma_{N2} = \\{(0,y) : 0<y<1\\}$. Here $dS=dy$, $h(0,y)=0$, and $v(0,y)=y$.\n      $\\int_{\\Gamma_{N2}} h v \\,dS = \\int_0^1 (0)(y) \\,dy = 0$.\n    The total Neumann integral contribution is $-\\frac{3}{2}$.\n\n3.  **Robin Boundary Integral:** $\\int_{\\Gamma_R} (\\alpha\\,u\\,v - r v) \\,dS$\n    $\\Gamma_R = \\{(1,y) : 0<y<1\\}$. Here $dS=dy$.\n    - $\\alpha=4$.\n    - $u(1,y) = (1+1)y = 2y$.\n    - $r(y) = y^2$.\n    - $v(1,y) = y$.\n    The integrand is $(\\alpha u(1,y) v(1,y) - r(y)v(1,y)) = (4(2y)y - y^2 y) = 8y^2-y^3$.\n    The integral is $\\int_0^1 (8y^2-y^3) \\,dy = [\\frac{8}{3}y^3 - \\frac{1}{4}y^4]_0^1 = \\frac{8}{3} - \\frac{1}{4} = \\frac{32-3}{12} = \\frac{29}{12}$.\n\n4.  **Final Value of J:**\n    Combining all parts:\n    $J = (\\text{Domain Integral}) + (\\text{Robin Integral}) - (\\text{Neumann Integral})$\n    $J = \\frac{25}{4} + \\frac{29}{12} - \\frac{3}{2}$\n    To sum these fractions, we use a common denominator of $12$:\n    $J = \\frac{25 \\cdot 3}{12} + \\frac{29}{12} - \\frac{3 \\cdot 6}{12} = \\frac{75 + 29 - 18}{12} = \\frac{104 - 18}{12} = \\frac{86}{12}$\n    Simplifying the fraction gives:\n    $J = \\frac{43}{6}$", "answer": "$$\\boxed{\\frac{43}{6}}$$", "id": "3387621"}, {"introduction": "Building on our understanding of natural boundary conditions, this next exercise explores the important special case of a pure Neumann problem for the Poisson equation. You will discover that for a solution to exist, the problem data must satisfy a \"compatibility condition,\" a result with deep mathematical and physical implications. This practice [@problem_id:3387571] illuminates the subtleties of natural boundary conditions and introduces the related concepts of solution uniqueness and methods for enforcing it.", "problem": "Consider the Poisson Partial Differential Equation (PDE) $-\\Delta u = f$ on a bounded, connected, Lipschitz domain $\\Omega \\subset \\mathbb{R}^{2}$ with outward unit normal $\\boldsymbol{n}$ on its boundary $\\Gamma = \\partial \\Omega$, subject to the pure Neumann boundary condition $\\partial_{\\boldsymbol{n}} u = g_{N}$ on $\\Gamma$. Starting from the divergence theorem and the definition of the weak formulation, derive the necessary compatibility condition that ensures the existence of weak solutions. Then explain, from first principles, why the solution $u$ is not unique and how to enforce uniqueness by imposing a mean-zero constraint in the weak problem. Finally, describe a principled way to enforce the mean-zero constraint in a conforming Finite Element Method (FEM) discretization, including the algebraic form of the augmented linear system using a Lagrange multiplier.\n\nFor a concrete calculation, take $\\Omega$ to be the unit disk in $\\mathbb{R}^{2}$, parameterized by polar coordinates $(r,\\theta)$ with angles measured in radians, and let the data be $f(r,\\theta) = r^{2}$ and $g_{N}(\\theta) = \\sin(\\theta)$. If the given data do not satisfy the compatibility condition, one common remedy is to add a constant correction $\\alpha$ to the Neumann boundary data, replacing $g_{N}$ by $g_{N}^{\\star} = g_{N} + \\alpha$. Compute the exact value of the constant $\\alpha$ that restores compatibility. Provide your final answer as a single exact value. No rounding is required.", "solution": "The problem statement is parsed and validated as follows.\n\n**Step 1: Extract Givens**\n- **PDE:** $-\\Delta u = f$\n- **Domain:** A bounded, connected, Lipschitz domain $\\Omega \\subset \\mathbb{R}^{2}$ with boundary $\\Gamma = \\partial \\Omega$.\n- **Boundary Condition:** Pure Neumann, $\\partial_{\\boldsymbol{n}} u = g_{N}$ on $\\Gamma$, where $\\boldsymbol{n}$ is the outward unit normal.\n- **Task 1:** Derive the necessary compatibility condition for the existence of weak solutions starting from the divergence theorem.\n- **Task 2:** Explain the non-uniqueness of the solution $u$ and how to enforce uniqueness using a mean-zero constraint.\n- **Task 3:** Describe the enforcement of the mean-zero constraint in a conforming Finite Element Method (FEM) using a Lagrange multiplier, providing the algebraic form of the augmented linear system.\n- **Task 4 (Concrete Calculation):**\n  - Domain: $\\Omega$ is the unit disk in $\\mathbb{R}^{2}$.\n  - Data: $f(r,\\theta) = r^{2}$ and $g_{N}(\\theta) = \\sin(\\theta)$.\n  - Correction Method: Replace $g_{N}$ with $g_{N}^{\\star} = g_{N} + \\alpha$, where $\\alpha$ is a constant.\n  - Objective: Compute the exact value of $\\alpha$ to restore compatibility.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem is scientifically grounded, well-posed, and objective. It addresses standard topics in the theory and numerical analysis of partial differential equations, specifically the Poisson equation with Neumann boundary conditions.\n- The use of concepts such as weak formulation, compatibility condition, function spaces like $H^1(\\Omega)$, Lagrange multipliers, and the Finite Element Method are all standard and mathematically rigorous.\n- The problem is self-contained and provides all necessary information for both the theoretical derivations and the concrete calculation.\n- The language is precise and uses standard mathematical terminology, avoiding ambiguity or subjectivity.\n- The concrete calculation involves well-defined functions on a standard domain (the unit disk), and the goal is to find a specific constant that satisfies a clearly defined mathematical condition.\n\n**Step 3: Verdict and Action**\nThe problem is valid. The solution process will proceed.\n\n***\n\nWe address each part of the problem sequentially.\n\n**Part 1: Derivation of the Compatibility Condition**\n\nThe process begins by deriving the weak formulation of the problem. We start with the strong form of the Poisson equation:\n$$-\\Delta u = f \\quad \\text{in } \\Omega$$\nWe multiply this equation by an arbitrary test function $v$ from a suitable function space, which for this problem is the Sobolev space $H^1(\\Omega)$, and integrate over the domain $\\Omega$:\n$$-\\int_{\\Omega} (\\Delta u) v \\, d\\mathbf{x} = \\int_{\\Omega} f v \\, d\\mathbf{x}$$\nThe left-hand side is integrated by parts. The relevant vector calculus identity is the first Green's identity, which is a direct consequence of the divergence theorem. The divergence theorem states that for a vector field $\\mathbf{F}$, $\\int_{\\Omega} (\\nabla \\cdot \\mathbf{F}) \\, d\\mathbf{x} = \\int_{\\Gamma} \\mathbf{F} \\cdot \\boldsymbol{n} \\, dS$. Let $\\mathbf{F} = v \\nabla u$. Then $\\nabla \\cdot \\mathbf{F} = \\nabla v \\cdot \\nabla u + v \\Delta u$. Applying the divergence theorem gives:\n$$\\int_{\\Omega} (\\nabla v \\cdot \\nabla u + v \\Delta u) \\, d\\mathbf{x} = \\int_{\\Gamma} (v \\nabla u) \\cdot \\boldsymbol{n} \\, dS$$\nRearranging this identity, we find an expression for the integral of $v \\Delta u$:\n$$\\int_{\\Omega} v \\Delta u \\, d\\mathbf{x} = \\int_{\\Gamma} v (\\nabla u \\cdot \\boldsymbol{n}) \\, dS - \\int_{\\Omega} \\nabla u \\cdot \\nabla v \\, d\\mathbf{x}$$\nSubstituting this back into the integrated PDE and using the definition of the normal derivative $\\partial_{\\boldsymbol{n}} u = \\nabla u \\cdot \\boldsymbol{n}$ yields:\n$$-\\left( \\int_{\\Gamma} v (\\partial_{\\boldsymbol{n}} u) \\, dS - \\int_{\\Omega} \\nabla u \\cdot \\nabla v \\, d\\mathbf{x} \\right) = \\int_{\\Omega} f v \\, d\\mathbf{x}$$\n$$\\int_{\\Omega} \\nabla u \\cdot \\nabla v \\, d\\mathbf{x} - \\int_{\\Gamma} v (\\partial_{\\boldsymbol{n}} u) \\, dS = \\int_{\\Omega} f v \\, d\\mathbf{x}$$\nNow, we enforce the Neumann boundary condition $\\partial_{\\boldsymbol{n}} u = g_{N}$ on $\\Gamma$:\n$$\\int_{\\Omega} \\nabla u \\cdot \\nabla v \\, d\\mathbf{x} = \\int_{\\Omega} f v \\, d\\mathbf{x} + \\int_{\\Gamma} v g_{N} \\, dS$$\nThis equation defines the weak formulation: Find $u \\in H^1(\\Omega)$ such that the above equality holds for all test functions $v \\in H^1(\\Omega)$.\n\nTo derive the compatibility condition, we observe that the gradient operator $\\nabla$ annihilates constant functions. Let us choose a specific test function $v = c$ for some non-zero constant $c \\in \\mathbb{R}$. For simplicity, let $c=1$. Substituting $v=1$ into the weak formulation:\nThe left-hand side (LHS) becomes:\n$$\\text{LHS} = \\int_{\\Omega} \\nabla u \\cdot \\nabla (1) \\, d\\mathbf{x} = \\int_{\\Omega} \\nabla u \\cdot \\mathbf{0} \\, d\\mathbf{x} = 0$$\nThe right-hand side (RHS) becomes:\n$$\\text{RHS} = \\int_{\\Omega} f (1) \\, d\\mathbf{x} + \\int_{\\Gamma} (1) g_{N} \\, dS = \\int_{\\Omega} f \\, d\\mathbf{x} + \\int_{\\Gamma} g_{N} \\, dS$$\nFor a solution to exist, the LHS must equal the RHS. This imposes a constraint on the data $f$ and $g_N$:\n$$0 = \\int_{\\Omega} f \\, d\\mathbf{x} + \\int_{\\Gamma} g_{N} \\, dS$$\nThis is the necessary compatibility condition. It has a physical interpretation in heat transfer, for example, where it represents a global energy balance: the total heat generated within the domain ($\\int f \\, d\\mathbf{x}$) must be balanced by the heat flux across the boundary ($-\\int g_N \\, dS$).\n\n**Part 2: Non-uniqueness and Uniqueness Enforcement**\n\nIf a solution $u$ to the weak problem exists, it is not unique. Let $u$ be a solution. Consider the function $\\tilde{u} = u + c$, where $c$ is an arbitrary constant. Since $\\nabla \\tilde{u} = \\nabla(u+c) = \\nabla u + \\nabla c = \\nabla u$, substituting $\\tilde{u}$ into the LHS of the weak form gives:\n$$\\int_{\\Omega} \\nabla \\tilde{u} \\cdot \\nabla v \\, d\\mathbf{x} = \\int_{\\Omega} \\nabla u \\cdot \\nabla v \\, d\\mathbf{x}$$\nThe LHS is identical for both $u$ and $\\tilde{u}$. The RHS of the weak form does not depend on the solution $u$. Therefore, if $u$ satisfies the weak formulation, so does $\\tilde{u} = u+c$ for any constant $c \\in \\mathbb{R}$. The solution is unique only up to an additive constant.\n\nTo enforce uniqueness, we must impose an additional constraint that fixes this constant. A standard choice is to require the solution to have a zero mean value over the domain:\n$$\\int_{\\Omega} u \\, d\\mathbf{x} = 0$$\nThe problem is then posed on the subspace $V_0 = \\{w \\in H^1(\\Omega) \\mid \\int_{\\Omega} w \\, d\\mathbf{x} = 0\\}$. The PoincarÃ©-Wirtinger inequality guarantees that for functions in $V_0$, the seminorm $|\\cdot|_{H^1(\\Omega)} = \\|\\nabla(\\cdot)\\|_{L^2(\\Omega)}$ is a norm equivalent to the full $H^1(\\Omega)$ norm. This ensures that the bilinear form $a(u,v) = \\int_{\\Omega} \\nabla u \\cdot \\nabla v \\, d\\mathbf{x}$ is coercive on $V_0$. By the Lax-Milgram theorem, the problem of finding $u \\in V_0$ such that $a(u,v) = L(v)$ for all $v \\in V_0$ has a unique solution, provided the compatibility condition holds.\n\n**Part 3: FEM with Lagrange Multiplier**\n\nIn a conforming Finite Element Method, the space $H^1(\\Omega)$ is approximated by a finite-dimensional subspace $V_h \\subset H^1(\\Omega)$, spanned by a set of basis functions $\\{\\phi_i\\}_{i=1}^N$. The discrete solution is $u_h = \\sum_{j=1}^N U_j \\phi_j$. Enforcing the mean-zero constraint $\\int_{\\Omega} u_h \\, d\\mathbf{x} = 0$ directly by constructing a basis for the discrete version of $V_0$ can be cumbersome.\n\nA more general and principled approach is to use a Lagrange multiplier $\\lambda \\in \\mathbb{R}$ to enforce the constraint. We seek a pair $(u_h, \\lambda) \\in V_h \\times \\mathbb{R}$ that solves the saddle-point problem:\nFind $(u_h, \\lambda)$ such that for all $(v_h, \\mu) \\in V_h \\times \\mathbb{R}$:\n$$\n\\begin{cases}\n\\int_{\\Omega} \\nabla u_h \\cdot \\nabla v_h \\, d\\mathbf{x} + \\int_{\\Omega} \\lambda v_h \\, d\\mathbf{x} = \\int_{\\Omega} f v_h \\, d\\mathbf{x} + \\int_{\\Gamma} g_N v_h \\, dS \\\\\n\\int_{\\Omega} \\mu u_h \\, d\\mathbf{x} = 0\n\\end{cases}\n$$\nLetting $v_h = \\phi_i$ for $i=1,\\dots,N$ and $\\mu=1$, we obtain the algebraic system. Let $\\mathbf{U} \\in \\mathbb{R}^N$ be the vector of coefficients $U_j$.\nThe first equation becomes:\n$$\\sum_{j=1}^N U_j \\left( \\int_{\\Omega} \\nabla \\phi_j \\cdot \\nabla \\phi_i \\, d\\mathbf{x} \\right) + \\lambda \\left( \\int_{\\Omega} \\phi_i \\, d\\mathbf{x} \\right) = \\int_{\\Omega} f \\phi_i \\, d\\mathbf{x} + \\int_{\\Gamma} g_N \\phi_i \\, dS$$\nThe second equation becomes:\n$$\\sum_{j=1}^N U_j \\left( \\int_{\\Omega} \\phi_j \\, d\\mathbf{x} \\right) = 0$$\nLet us define the following matrices and vectors:\n- Stiffness Matrix: $A \\in \\mathbb{R}^{N \\times N}$ with $A_{ij} = \\int_{\\Omega} \\nabla \\phi_i \\cdot \\nabla \\phi_j \\, d\\mathbf{x}$.\n- Load Vector: $\\mathbf{F} \\in \\mathbb{R}^N$ with $F_i = \\int_{\\Omega} f \\phi_i \\, d\\mathbf{x} + \\int_{\\Gamma} g_N \\phi_i \\, dS$.\n- Constraint Vector: $\\mathbf{B} \\in \\mathbb{R}^N$ with $B_j = \\int_{\\Omega} \\phi_j \\, d\\mathbf{x}$.\n\nThe system can be written in a block matrix form:\n$$\n\\begin{pmatrix}\nA & \\mathbf{B} \\\\\n\\mathbf{B}^T & 0\n\\end{pmatrix}\n\\begin{pmatrix}\n\\mathbf{U} \\\\\n\\lambda\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\mathbf{F} \\\\\n0\n\\end{pmatrix}\n$$\nThis augmented system is non-singular and has a unique solution $(\\mathbf{U}, \\lambda)$, thus yielding a unique FEM solution $u_h$ that satisfies the mean-zero constraint.\n\n**Part 4: Concrete Calculation**\n\nWe need to find the constant $\\alpha$ such that the modified data, $f(r,\\theta) = r^2$ and $g_N^{\\star}(\\theta) = \\sin(\\theta) + \\alpha$, satisfy the compatibility condition on the unit disk $\\Omega$. The condition is:\n$$\\int_{\\Omega} f \\, d\\mathbf{x} + \\int_{\\Gamma} g_N^{\\star} \\, dS = 0$$\nThe domain $\\Omega$ is the unit disk, so we use polar coordinates $(r, \\theta)$. The area element is $d\\mathbf{x} = r \\, dr \\, d\\theta$, and the boundary line element is $dS = 1 \\cdot d\\theta = d\\theta$ since $r=1$ on $\\Gamma$.\n\nFirst, we compute the integral of $f$ over $\\Omega$:\n$$\\int_{\\Omega} f \\, d\\mathbf{x} = \\int_0^{2\\pi} \\int_0^1 (r^2) (r \\, dr \\, d\\theta) = \\int_0^{2\\pi} \\left( \\int_0^1 r^3 \\, dr \\right) \\, d\\theta$$\nThe inner integral is:\n$$\\int_0^1 r^3 \\, dr = \\left[ \\frac{r^4}{4} \\right]_0^1 = \\frac{1}{4}$$\nThe outer integral is:\n$$\\int_0^{2\\pi} \\frac{1}{4} \\, d\\theta = \\frac{1}{4} [\\theta]_0^{2\\pi} = \\frac{2\\pi}{4} = \\frac{\\pi}{2}$$\nNext, we compute the integral of $g_N^{\\star}$ over the boundary $\\Gamma$:\n$$\\int_{\\Gamma} g_N^{\\star} \\, dS = \\int_0^{2\\pi} (\\sin(\\theta) + \\alpha) \\, d\\theta = \\int_0^{2\\pi} \\sin(\\theta) \\, d\\theta + \\int_0^{2\\pi} \\alpha \\, d\\theta$$\nThe first term is:\n$$\\int_0^{2\\pi} \\sin(\\theta) \\, d\\theta = [-\\cos(\\theta)]_0^{2\\pi} = -\\cos(2\\pi) - (-\\cos(0)) = -1 - (-1) = 0$$\nThe second term is:\n$$\\int_0^{2\\pi} \\alpha \\, d\\theta = \\alpha [\\theta]_0^{2\\pi} = 2\\pi\\alpha$$\nSo, $\\int_{\\Gamma} g_N^{\\star} \\, dS = 2\\pi\\alpha$.\n\nFinally, we substitute these results into the compatibility condition:\n$$\\frac{\\pi}{2} + 2\\pi\\alpha = 0$$\nSolving for $\\alpha$:\n$$2\\pi\\alpha = -\\frac{\\pi}{2}$$\n$$\\alpha = \\frac{-\\pi/2}{2\\pi} = -\\frac{1}{4}$$\nThe required constant is $\\alpha = -1/4$.", "answer": "$$\\boxed{-\\frac{1}{4}}$$", "id": "3387571"}, {"introduction": "This final practice bridges the gap between theory and practical implementation by guiding you through a code verification experiment. Using the Method of Manufactured Solutions, you will test a finite element solver for a problem with mixed boundary conditions, verifying the correct implementation of both essential and natural boundary types [@problem_id:3387554]. This hands-on coding exercise will demonstrate how abstract variational principles are translated into a concrete numerical simulation and introduce you to powerful verification techniques, such as measuring error convergence rates and boundary residuals.", "problem": "Consider the scalar prototype elliptic boundary value problem on the open interval $(0,1)$:\nFind $u:(0,1)\\to\\mathbb{R}$ such that\n$-(a\\,u'(x))' = f(x)$ for $x\\in(0,1)$,\nwith a Dirichlet (essential) boundary condition at the left endpoint and a Neumann (natural) boundary condition at the right endpoint:\n$u(0)=u_D$ and $a\\,u'(1)=g_N$.\nAssume a constant positive diffusion coefficient $a>0$ and adopt the standard weak form: find $u\\in \\{ w\\in H^1(0,1)\\,:\\,w(0)=u_D\\}$ such that\n$\\int_0^1 a\\,u'(x)\\,v'(x)\\,dx = \\int_0^1 f(x)\\,v(x)\\,dx + g_N\\,v(1)$ for all $v\\in \\{ w\\in H^1(0,1)\\,:\\,w(0)=0\\}$,\nwhere $H^1(0,1)$ is the Sobolev space of square-integrable functions with square-integrable first weak derivative. In this weak form, $u(0)=u_D$ is an essential boundary condition (imposed on the trial space), while $a\\,u'(1)=g_N$ is a natural boundary condition (appearing as a boundary term on the right-hand side).\n\nYou will perform a method of manufactured solutions verification experiment to test correct handling of essential and natural boundary conditions in a one-dimensional linear Finite Element Method (FEM) code using continuous, piecewise-linear basis functions on a uniform mesh of $N$ elements on $[0,1]$. Choose the manufactured exact solution\n$u_{\\text{ex}}(x) = \\sin(\\pi x) + x^2$,\nwith constant coefficient $a=2$. Derive $f$ and the boundary data from this $u_{\\text{ex}}$ so that the exact solution satisfies the strong form:\n$f(x) = -a\\,u_{\\text{ex}}''(x) = a\\left(\\pi^2 \\sin(\\pi x) - 2\\right)$, $u_D = u_{\\text{ex}}(0)$, $g_N = a\\,u_{\\text{ex}}'(1)$.\nYour program must assemble the FEM linear system for the weak form, including the correct natural boundary load contribution at $x=1$ and implement two mechanisms for the essential boundary at $x=0$:\n- Strong imposition: directly constrain the nodal degree of freedom to $u_D$ in the algebraic system.\n- Penalty imposition: augment the bilinear and linear forms with a consistent penalty term at $x=0$, namely add $\\frac{\\gamma}{h}\\,u(0)\\,v(0)$ to the left-hand side and $\\frac{\\gamma}{h}\\,u_D\\,v(0)$ to the right-hand side, where $h$ is the first element size and $\\gamma>0$ is a user-defined penalty parameter.\n\nDefine the following error norms and boundary residual measurements:\n- $L^2$-norm error: $$E_{L^2} = \\left(\\int_0^1 \\left(u_{\\text{ex}}(x)-u_h(x)\\right)^2\\,dx\\right)^{1/2},$$\n- $H^1$-seminorm error: $$E_{H^1} = \\left(\\int_0^1 \\left(u_{\\text{ex}}'(x)-u_h'(x)\\right)^2\\,dx\\right)^{1/2},$$\n- essential boundary residual: $R_D = |u_h(0)-u_D|$,\n- natural boundary residual: $R_N = |a\\,u_h'(1)-g_N|$,\nwhere $u_h$ is the FEM solution.\n\nYour program must:\n- Assemble the FEM system using exact quadrature or sufficiently accurate Gaussian quadrature for the element load and error integrals. The mesh is uniform with $N$ elements, nodes $x_i=i\\,h$, $h=1/N$, for $i=0,\\dots,N$.\n- Include the natural boundary term $g_N\\,v(1)$ in the global load vector.\n- Provide both strong and penalty imposition options at $x=0$, with the penalty scaling $\\gamma/h$.\n- Compute $E_{L^2}$, $E_{H^1}$, $R_D$, and $R_N$.\n\nTest suite:\n- Convergence test (strong imposition): compute $E_{L^2}$ and $E_{H^1}$ for $N\\in\\{10,20,40\\}$ and report the observed convergence rates\n$p_{L^2} = \\dfrac{\\log\\left(E_{L^2}(N=20)/E_{L^2}(N=40)\\right)}{\\log(2)}$ and $p_{H^1} = \\dfrac{\\log\\left(E_{H^1}(N=20)/E_{H^1}(N=40)\\right)}{\\log(2)}$.\nAlso report the baseline $N=40$ strong-imposition metrics $E_{L^2}$, $R_D$, and $R_N$.\n- Penalty sensitivity test (penalty imposition on $x=0$): fix $N=40$ and compute $(E_{L^2}, R_D, R_N)$ for penalty parameters $\\gamma\\in\\{10^{-2},10^{1},10^{3},10^{6}\\}$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the exact order\n$[p_{L^2},p_{H^1},E_{L^2}^{\\text{strong}}(N{=}40),R_D^{\\text{strong}}(N{=}40),R_N^{\\text{strong}}(N{=}40),E_{L^2}^{\\text{pen}}(\\gamma{=}10^{-2}),R_D^{\\text{pen}}(\\gamma{=}10^{-2}),R_N^{\\text{pen}}(\\gamma{=}10^{-2}),E_{L^2}^{\\text{pen}}(\\gamma{=}10^{1}),R_D^{\\text{pen}}(\\gamma{=}10^{1}),R_N^{\\text{pen}}(\\gamma{=}10^{1}),E_{L^2}^{\\text{pen}}(\\gamma{=}10^{3}),R_D^{\\text{pen}}(\\gamma{=}10^{3}),R_N^{\\text{pen}}(\\gamma{=}10^{3}),E_{L^2}^{\\text{pen}}(\\gamma{=}10^{6}),R_D^{\\text{pen}}(\\gamma{=}10^{6}),R_N^{\\text{pen}}(\\gamma{=}10^{6})]$.\nAll entries must be real numbers (floating-point). The program must run without user input and print exactly one line in the specified format.", "solution": "The user wants to solve a finite element problem.\n\n### 1. Problem Specification and Validation\n\nThe problem is a standard one-dimensional scalar elliptic boundary value problem:\n$$\n-(a\\,u'(x))' = f(x) \\quad \\text{for } x \\in (0, 1)\n$$\nwith mixed boundary conditions: an essential (Dirichlet) condition $u(0)=u_D$ and a natural (Neumann) condition $a\\,u'(1)=g_N$. This is a well-posed problem under the given conditions ($a$ is a positive constant).\n\nThe task is to perform a Method of Manufactured Solutions (MMS) verification. This is a standard procedure in computational science to verify the correctness of a numerical solver and to measure its convergence rates.\n\n**Given Data:**\n- Manufactured solution: $u_{\\text{ex}}(x) = \\sin(\\pi x) + x^2$\n- Diffusion coefficient: $a=2$\n\nFrom these, we derive the forcing function $f(x)$ and boundary data $u_D$, $g_N$ such that $u_{\\text{ex}}(x)$ is the exact solution to the strong form.\n\n- First derivative: $u_{\\text{ex}}'(x) = \\pi \\cos(\\pi x) + 2x$\n- Second derivative: $u_{\\text{ex}}''(x) = -\\pi^2 \\sin(\\pi x) + 2$\n\n- Forcing function:\n$$\nf(x) = -a u_{\\text{ex}}''(x) = -2(-\\pi^2 \\sin(\\pi x) + 2) = 2\\pi^2 \\sin(\\pi x) - 4\n$$\n\n- Essential boundary value at $x=0$:\n$$\nu_D = u_{\\text{ex}}(0) = \\sin(0) + 0^2 = 0\n$$\n\n- Natural boundary value at $x=1$:\n$$\ng_N = a u_{\\text{ex}}'(1) = 2(\\pi \\cos(\\pi) + 2(1)) = 2(-\\pi + 2) = 4 - 2\\pi\n$$\nAll provided specifications are consistent, scientifically sound, and form a complete basis for a numerical experiment. The problem is valid.\n\n### 2. Finite Element Formulation\n\nThe standard weak form is given: find $u \\in V_{u_D} = \\{ w\\in H^1(0,1) \\,:\\, w(0)=u_D\\}$ such that for all $v \\in V_0 = \\{ w\\in H^1(0,1) \\,:\\, w(0)=0 \\}$:\n$$\n\\int_0^1 a\\,u'(x)\\,v'(x)\\,dx = \\int_0^1 f(x)\\,v(x)\\,dx + g_N\\,v(1)\n$$\nWe discretize the domain $[0,1]$ with a uniform mesh of $N$ elements of size $h=1/N$. The nodes are $x_i = i h$ for $i=0, \\dots, N$. We use continuous, piecewise-linear basis functions $\\phi_i(x)$, where $\\phi_i(x_j) = \\delta_{ij}$.\n\nThe finite element solution is $u_h(x) = \\sum_{j=0}^{N} U_j \\phi_j(x)$, where $U_j$ are the unknown nodal values. Substituting this into the weak form and choosing test functions $v = \\phi_i$ for $i=0, \\dots, N$ leads to the linear algebraic system $\\mathbf{K} \\mathbf{U} = \\mathbf{F}$, where:\n- $\\mathbf{K}_{ij} = \\int_0^1 a\\,\\phi_j'(x)\\,\\phi_i'(x)\\,dx$ (Stiffness Matrix)\n- $\\mathbf{F}_i = \\int_0^1 f(x)\\,\\phi_i(x)\\,dx + g_N\\,\\phi_i(1)$ (Load Vector)\n- $\\mathbf{U}$ is the vector of nodal values $[U_0, U_1, \\dots, U_N]^T$.\n\n### 3. System Assembly\n\n**Element Stiffness Matrix:** For a generic element $[x_e, x_{e+1}]$ of length $h$, the local stiffness matrix connecting nodes $e$ and $e+1$ is:\n$$\n\\mathbf{K}^e = \\int_{x_e}^{x_{e+1}} a \\begin{pmatrix} -1/h \\\\ 1/h \\end{pmatrix} \\begin{pmatrix} -1/h & 1/h \\end{pmatrix} dx = \\frac{a}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix} = \\frac{2}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix}\n$$\n\n**Element Load Vector:** The integral for the forcing term $\\mathbf{F}^e_i = \\int_{x_e}^{x_{e+1}} f(x)\\phi_i(x)dx$ is computed using Gaussian quadrature for sufficient accuracy. Using a quadrature rule of order $k$ on the reference interval $[-1,1]$, the integral on an element becomes:\n$$\n\\int_{x_e}^{x_{e+1}} g(x)\\,dx = \\frac{h}{2} \\int_{-1}^{1} g(x(\\xi))\\, d\\xi \\approx \\frac{h}{2} \\sum_{q=1}^{k} w_q g(x(\\xi_q))\n$$\nwhere $\\xi_q$ and $w_q$ are the quadrature points and weights.\n\n**Global Assembly:** The global matrix $\\mathbf{K}$ and vector $\\mathbf{F}$ are assembled by summing the contributions from all elements.\n\n**Boundary Conditions:**\n- **Natural BC:** The term $g_N v(1)$ only affects the test function $v = \\phi_N$, since $\\phi_N(1)=1$ and $\\phi_i(1)=0$ for $i \\neq N$. Thus, we add $g_N$ to the last entry of the global load vector: $\\mathbf{F}_N \\leftarrow \\mathbf{F}_N + g_N$.\n\n- **Essential BC:** At $x=0$, we must enforce $U_0 = u_D$.\n    1.  **Strong Imposition:** The system is modified to enforce the condition exactly. A robust method is to adjust the load vector for the known value and then replace the corresponding equation:\n        - For $i=1, \\dots, N$, update $\\mathbf{F}_i \\leftarrow \\mathbf{F}_i - \\mathbf{K}_{i,0} u_D$. (Since $u_D=0$, this step has no effect).\n        - Zero out the first row and column of $\\mathbf{K}$: $\\mathbf{K}_{0,j} = \\mathbf{K}_{j,0} = 0$.\n        - Set $\\mathbf{K}_{0,0} = 1$ and $\\mathbf{F}_0 = u_D$.\n    2.  **Penalty Imposition:** The weak form is augmented with penalty terms. This translates to modifying the algebraic system:\n        - $\\mathbf{K}_{0,0} \\leftarrow \\mathbf{K}_{0,0} + \\frac{\\gamma}{h}$\n        - $\\mathbf{F}_{0} \\leftarrow \\mathbf{F}_{0} + \\frac{\\gamma}{h} u_D$\n        where $\\gamma > 0$ is the penalty parameter.\n\n### 4. Error and Residual Calculation\n\nAfter solving $\\mathbf{K}\\mathbf{U} = \\mathbf{F}$ for the nodal values $\\mathbf{U}$, we compute the required metrics.\n- **$L^2$-norm error $E_{L^2}$ and $H^1$-seminorm error $E_{H^1}$:** These are computed by summing element-wise integrals evaluated using Gaussian quadrature.\n$$\nE_{L^2}^2 = \\sum_e \\int_{x_e}^{x_{e+1}} (u_{\\text{ex}}(x) - u_h(x))^2\\,dx \\quad , \\quad E_{H^1}^2 = \\sum_e \\int_{x_e}^{x_{e+1}} (u'_{\\text{ex}}(x) - u'_h(x))^2\\,dx\n$$\nOn an element $e$, the derivative of the FEM solution is constant: $u'_h(x) = (U_{e+1}-U_e)/h$.\n\n- **Essential Boundary Residual $R_D$:** This measures how well the essential BC is satisfied.\n$$\nR_D = |u_h(0) - u_D| = |U_0 - u_D|\n$$\nFor strong imposition, $R_D$ will be zero to machine precision. For the penalty method, it will be a small non-zero value that decreases as $\\gamma$ increases.\n\n- **Natural Boundary Residual $R_N$:** This measures the error in the Neumann condition.\n$$\nR_N = |a u'_h(1) - g_N| = |a \\frac{U_N - U_{N-1}}{h} - g_N|\n$$\n\n### 5. Numerical Execution\n\nThe tasks are performed by a Python script:\n1.  **Convergence Study:** The FEM system is solved with strong imposition for $N \\in \\{10, 20, 40\\}$. The theoretical convergence rates for linear elements are $O(h^2)$ for the $L^2$ error and $O(h)$ for the $H^1$ error. Thus, we expect the calculated rates $p_{L^2}$ and $p_{H^1}$ to be close to $2.0$ and $1.0$, respectively, when halving the mesh size $h$.\n2.  **Penalty Study:** For a fixed mesh ($N=40$), the system is solved using the penalty method for various $\\gamma$ values. We observe the effect of $\\gamma$ on the solution accuracy ($E_{L^2}$) and boundary condition satisfaction ($R_D, R_N$). As $\\gamma$ increases, the penalty term enforces the Dirichlet condition more strictly, causing $R_D$ to decrease. An optimal range for $\\gamma$ typically exists; if too large, it can lead to ill-conditioning of the stiffness matrix.\n\nThe implementation encapsulates these steps, calculates all required metrics, and formats them into the specified single-line output.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import roots_legendre\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the FEM simulation, analysis, and output generation.\n    \"\"\"\n    # ------------------- Problem Definition -------------------\n    A_COEFF = 2.0\n    PI = np.pi\n\n    def u_ex(x):\n        \"\"\"Manufactured exact solution.\"\"\"\n        return np.sin(PI * x) + x**2\n\n    def u_ex_prime(x):\n        \"\"\"First derivative of the exact solution.\"\"\"\n        return PI * np.cos(PI * x) + 2 * x\n\n    def f_source(x):\n        \"\"\"Source term derived from the exact solution.\"\"\"\n        return A_COEFF * (PI**2 * np.sin(PI * x) - 2.0)\n\n    U_D = u_ex(0.0)\n    G_N = A_COEFF * u_ex_prime(1.0)\n    \n    # ------------------- FEM Solver -------------------\n    def run_fem_simulation(N, method, gamma=None):\n        \"\"\"\n        Core FEM solver for the 1D BVP.\n\n        Args:\n            N (int): Number of elements.\n            method (str): 'strong' or 'penalty' for essential BC imposition.\n            gamma (float, optional): Penalty parameter for the penalty method.\n\n        Returns:\n            dict: A dictionary containing computed errors and residuals.\n        \"\"\"\n        # Setup mesh\n        h = 1.0 / N\n        nodes = np.linspace(0, 1, N + 1)\n        \n        # Initialize global system\n        K = np.zeros((N + 1, N + 1))\n        F = np.zeros(N + 1)\n        \n        # Quadrature rule for integration\n        q_order = 5  # Sufficiently high order for smooth integrands\n        q_points, q_weights = roots_legendre(q_order)\n\n        # Assembly over elements\n        for e in range(N):\n            # Element stiffness matrix\n            k_e = (A_COEFF / h) * np.array([[1, -1], [-1, 1]])\n            \n            # Element load vector (using numerical quadrature)\n            f_e = np.zeros(2)\n            x_e = nodes[e]\n            for q_p, q_w in zip(q_points, q_weights):\n                x_q = x_e + h * (q_p + 1.0) / 2.0  # Map point to [x_e, x_{e+1}]\n                xi_q = (x_q - x_e) / h            # Map point to [0, 1]\n                \n                f_val = f_source(x_q)\n                f_e[0] += f_val * (1.0 - xi_q) * q_w\n                f_e[1] += f_val * xi_q * q_w\n                \n            f_e *= h / 2.0\n            \n            # Assemble into global system\n            K[e:e+2, e:e+2] += k_e\n            F[e:e+2] += f_e\n            \n        # Apply Boundary Conditions\n        # Natural BC at x=1 (node N)\n        F[N] += G_N\n        \n        # Essential BC at x=0 (node 0)\n        if method == 'strong':\n            # Adjust RHS for non-zero Dirichlet values\n            for i in range(1, N + 1):\n                F[i] -= K[i, 0] * U_D\n            # Enforce the condition\n            K[0, :] = 0.0\n            K[:, 0] = 0.0\n            K[0, 0] = 1.0\n            F[0] = U_D\n        elif method == 'penalty':\n            if gamma is None:\n                raise ValueError(\"gamma must be provided for penalty method.\")\n            penalty_val = gamma / h\n            K[0, 0] += penalty_val\n            F[0] += penalty_val * U_D\n        else:\n            raise ValueError(f\"Unknown method for essential BC: {method}\")\n            \n        # Solve linear system\n        U = np.linalg.solve(K, F)\n        \n        # Post-processing: Calculate errors and residuals\n        err_L2_sq_total = 0.0\n        err_H1_sq_total = 0.0\n        \n        for e in range(N):\n            x_e = nodes[e]\n            U_e, U_e1 = U[e], U[e+1]\n            \n            err_L2_sq_e = 0.0\n            err_H1_sq_e = 0.0\n            \n            for q_p, q_w in zip(q_points, q_weights):\n                x_q = x_e + h * (q_p + 1.0) / 2.0\n                xi_q = (x_q - x_e) / h\n                \n                u_h_q = U_e * (1.0 - xi_q) + U_e1 * xi_q\n                u_h_prime_q = (U_e1 - U_e) / h\n                \n                u_ex_q = u_ex(x_q)\n                u_ex_prime_q = u_ex_prime(x_q)\n                \n                err_L2_sq_e += (u_ex_q - u_h_q)**2 * q_w\n                err_H1_sq_e += (u_ex_prime_q - u_h_prime_q)**2 * q_w\n                \n            err_L2_sq_total += err_L2_sq_e * (h / 2.0)\n            err_H1_sq_total += err_H1_sq_e * (h / 2.0)\n\n        E_L2 = np.sqrt(err_L2_sq_total)\n        E_H1 = np.sqrt(err_H1_sq_total)\n        \n        R_D = np.abs(U[0] - U_D)\n        u_h_prime_at_1 = (U[N] - U[N-1]) / h\n        R_N = np.abs(A_COEFF * u_h_prime_at_1 - G_N)\n        \n        return {'E_L2': E_L2, 'E_H1': E_H1, 'R_D': R_D, 'R_N': R_N}\n\n    # ------------------- Test Suite Execution -------------------\n    final_results = []\n    \n    # Task 1: Convergence test (strong imposition)\n    N_vals = [10, 20, 40]\n    strong_results = {}\n    for n in N_vals:\n        strong_results[n] = run_fem_simulation(n, method='strong')\n\n    # Calculate convergence rates using N=20 and N=40\n    p_L2 = np.log(strong_results[20]['E_L2'] / strong_results[40]['E_L2']) / np.log(2)\n    p_H1 = np.log(strong_results[20]['E_H1'] / strong_results[40]['E_H1']) / np.log(2)\n    final_results.extend([p_L2, p_H1])\n    \n    # Store baseline metrics for N=40 strong imposition\n    res_strong_40 = strong_results[40]\n    final_results.extend([res_strong_40['E_L2'], res_strong_40['R_D'], res_strong_40['R_N']])\n    \n    # Task 2: Penalty sensitivity test\n    N_penalty = 40\n    gamma_vals = [1e-2, 1e1, 1e3, 1e6]\n    for g in gamma_vals:\n        res_pen = run_fem_simulation(N_penalty, method='penalty', gamma=g)\n        final_results.extend([res_pen['E_L2'], res_pen['R_D'], res_pen['R_N']])\n        \n    # ------------------- Final Output -------------------\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```", "id": "3387554"}]}