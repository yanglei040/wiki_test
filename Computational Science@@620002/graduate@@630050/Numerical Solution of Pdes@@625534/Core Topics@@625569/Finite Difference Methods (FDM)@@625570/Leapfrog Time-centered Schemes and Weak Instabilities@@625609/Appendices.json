{"hands_on_practices": [{"introduction": "The definition of stability for numerical schemes can be subtle. While neutral stability, where all amplification factors $g$ satisfy $|g|=1$, might seem sufficient for error boundedness, this is not always the case. This exercise guides you through a classic example demonstrating how a neutrally stable scheme can still exhibit weak instability, leading to unbounded error growth over long time integrations. By analyzing a specific case where the scheme's amplification polynomial has a repeated root on the unit circle, you will derive the mechanism of linear error growth firsthand, providing deep insight into why this phenomenon is a critical concern in numerical simulations [@problem_id:3415211].", "problem": "Consider the one-dimensional linear advection equation $u_{t} + a\\,u_{x} = 0$ on a periodic domain, with wave speed $a \\neq 0$. Discretize in space with a uniform grid of spacing $\\Delta x$ indexed by $j \\in \\mathbb{Z}$ and in time with step $\\Delta t$ indexed by $n \\in \\mathbb{Z}$. Use the leapfrog time-centered scheme\n$$\n\\frac{u_{j}^{n+1} - u_{j}^{n-1}}{2\\,\\Delta t} + a\\,\\frac{u_{j+1}^{n} - u_{j-1}^{n}}{2\\,\\Delta x} = 0,\n$$\ni.e.,\n$$\nu_{j}^{n+1} = u_{j}^{n-1} - \\mu\\left(u_{j+1}^{n} - u_{j-1}^{n}\\right),\n\\quad \\text{with} \\quad \\mu := \\frac{a\\,\\Delta t}{\\Delta x}.\n$$\nAdopt a Fourier mode ansatz $u_{j}^{n} = \\widehat{u}^{\\,n}\\,\\exp(i\\,\\kappa\\,j)$ with $\\kappa := k\\,\\Delta x \\in [-\\pi,\\pi]$ for wavenumber $k \\in \\mathbb{R}$. Assume exact arithmetic yields the amplification polynomial for $\\widehat{u}^{\\,n}$ and that neutral stability means $|g|=1$ for all relevant roots $g$ of this polynomial.\n\nNow, construct a concrete setting that demonstrates that neutral stability does not imply bounded error growth over long time in the presence of rounding errors. To this end, choose the Courant number $\\mu = 1$ and the Fourier wavenumber $\\kappa = \\pi/2$. In this case the amplification polynomial has a repeated unit-modulus root. Suppose the exact solution is identically zero, but the computed initial modal amplitudes are contaminated by a tiny rounding mismatch modeled as\n$$\n\\widehat{u}^{\\,0} = 0, \n\\qquad \n\\widehat{u}^{\\,1} = -\\,i\\,\\varepsilon,\n$$\nwith a fixed $\\varepsilon$ satisfying $0|\\varepsilon|\\ll 1$ representing the projection of the rounding error onto this Fourier mode at the startup.\n\nUsing only the above fundamental setup and the Fourier-mode recurrence implied by the scheme, derive the exact closed-form expression for the modal amplitude $\\widehat{u}^{\\,N}$ after $N$ time steps, expressed in terms of $\\varepsilon$ and $N$. Your final answer must be a single analytic expression. No numerical rounding is required, and no physical units apply.", "solution": "The user has provided a problem statement regarding the analysis of weak instability in the leapfrog time-centered numerical scheme.\n\n### Step 1: Problem Validation\n\nThe problem is first subjected to a rigorous validation process.\n\n**Extracted Givens:**\n- **Governing Equation**: $u_{t} + a\\,u_{x} = 0$ with $a \\neq 0$.\n- **Discretization Scheme**: Leapfrog time-centered, $u_{j}^{n+1} = u_{j}^{n-1} - \\mu\\left(u_{j+1}^{n} - u_{j-1}^{n}\\right)$, where $\\mu := \\frac{a\\,\\Delta t}{\\Delta x}$.\n- **Analysis Method**: Fourier mode ansatz, $u_{j}^{n} = \\widehat{u}^{\\,n}\\,\\exp(i\\,\\kappa\\,j)$, with $\\kappa := k\\,\\Delta x$.\n- **Stability Condition**: Neutral stability is defined as $|g|=1$ for all relevant roots $g$ of the amplification polynomial.\n- **Specific Parameters**: Courant number $\\mu = 1$, normalized wavenumber $\\kappa = \\pi/2$.\n- **Initial Conditions for the Modal Amplitude**: $\\widehat{u}^{\\,0} = 0$ and $\\widehat{u}^{\\,1} = -\\,i\\,\\varepsilon$, where $0  |\\varepsilon| \\ll 1$.\n- **Objective**: Derive the closed-form expression for $\\widehat{u}^{\\,N}$ in terms of $\\varepsilon$ and $N$.\n\n**Validation Verdict:**\nThe problem is **valid**. It is a well-posed, scientifically grounded problem from the field of numerical analysis of partial differential equations. All necessary information is provided, the terminology is precise, and the setup is standard for demonstrating the concept of weak instability in numerical schemes. The problem does not violate any of the criteria for invalidity.\n\n### Step 2: Derivation of the Solution\n\nWe begin with the provided recurrence relation for the leapfrog scheme:\n$$\nu_{j}^{n+1} = u_{j}^{n-1} - \\mu\\left(u_{j+1}^{n} - u_{j-1}^{n}\\right)\n$$\nWe substitute the Fourier mode ansatz $u_{j}^{n} = \\widehat{u}^{\\,n}\\,\\exp(i\\,\\kappa\\,j)$ into this equation:\n$$\n\\widehat{u}^{\\,n+1}\\,\\exp(i\\,\\kappa\\,j) = \\widehat{u}^{\\,n-1}\\,\\exp(i\\,\\kappa\\,j) - \\mu\\left(\\widehat{u}^{\\,n}\\,\\exp(i\\,\\kappa\\,(j+1)) - \\widehat{u}^{\\,n}\\,\\exp(i\\,\\kappa\\,(j-1))\\right)\n$$\nDividing the entire equation by the common factor $\\exp(i\\,\\kappa\\,j)$ yields a recurrence relation for the modal amplitudes $\\widehat{u}^{\\,n}$:\n$$\n\\widehat{u}^{\\,n+1} = \\widehat{u}^{\\,n-1} - \\mu\\,\\widehat{u}^{\\,n}\\left(\\exp(i\\,\\kappa) - \\exp(-i\\,\\kappa)\\right)\n$$\nUsing Euler's identity, $\\exp(i\\,\\kappa) - \\exp(-i\\,\\kappa) = 2i\\sin(\\kappa)$, the relation becomes:\n$$\n\\widehat{u}^{\\,n+1} = \\widehat{u}^{\\,n-1} - 2i\\mu\\sin(\\kappa)\\,\\widehat{u}^{\\,n}\n$$\nRearranging the terms, we obtain a second-order linear homogeneous recurrence relation with constant coefficients:\n$$\n\\widehat{u}^{\\,n+1} + 2i\\mu\\sin(\\kappa)\\,\\widehat{u}^{\\,n} - \\widehat{u}^{\\,n-1} = 0\n$$\nThe problem specifies the parameters $\\mu = 1$ and $\\kappa = \\pi/2$. We substitute these values into the recurrence. Since $\\sin(\\pi/2) = 1$, the coefficient $2i\\mu\\sin(\\kappa)$ becomes $2i(1)(1) = 2i$. The specific recurrence relation for this case is:\n$$\n\\widehat{u}^{\\,n+1} + 2i\\,\\widehat{u}^{\\,n} - \\widehat{u}^{\\,n-1} = 0\n$$\nTo solve this recurrence, we find the roots of its characteristic polynomial by substituting the trial solution $\\widehat{u}^{\\,n} = g^n$:\n$$\ng^{n+1} + 2i\\,g^n - g^{n-1} = 0\n$$\nAssuming $g \\neq 0$ and dividing by $g^{n-1}$, we get the amplification polynomial:\n$$\ng^2 + 2i\\,g - 1 = 0\n$$\nThis quadratic expression is a perfect square:\n$$\n(g + i)^2 = g^2 + 2ig + i^2 = g^2 + 2ig - 1 = 0\n$$\nThe polynomial has a repeated root $g_{1,2} = -i$. The modulus of this root is $|-i| = 1$, confirming the problem's statement about a repeated unit-modulus root, which corresponds to neutral stability.\n\nFor a recurrence relation with a repeated root $g$, the general solution for $\\widehat{u}^{\\,n}$ takes the form:\n$$\n\\widehat{u}^{\\,n} = (C_1 + C_2 n) g^n\n$$\nwhere $C_1$ and $C_2$ are constants to be determined from the initial conditions. Substituting $g = -i$, we have:\n$$\n\\widehat{u}^{\\,n} = (C_1 + C_2 n) (-i)^n\n$$\nThe problem provides the initial conditions representing a small rounding error: $\\widehat{u}^{\\,0} = 0$ and $\\widehat{u}^{\\,1} = -i\\varepsilon$.\nWe apply the condition for $n=0$:\n$$\n\\widehat{u}^{\\,0} = (C_1 + C_2 \\cdot 0) (-i)^0 = C_1 \\cdot 1 = C_1\n$$\nGiven $\\widehat{u}^{\\,0} = 0$, we find that $C_1 = 0$.\n\nNext, we apply the condition for $n=1$:\n$$\n\\widehat{u}^{\\,1} = (C_1 + C_2 \\cdot 1) (-i)^1 = (0 + C_2) (-i) = -i C_2\n$$\nGiven $\\widehat{u}^{\\,1} = -i\\varepsilon$, we equate the expressions:\n$$\n-i C_2 = -i\\varepsilon \\implies C_2 = \\varepsilon\n$$\nHaving found the constants $C_1 = 0$ and $C_2 = \\varepsilon$, we substitute them into the general solution to find the specific solution for the modal amplitude at time step $n$:\n$$\n\\widehat{u}^{\\,n} = (0 + \\varepsilon n) (-i)^n = n \\varepsilon (-i)^n\n$$\nThe problem requests the expression for $\\widehat{u}^{\\,N}$ after $N$ time steps. We simply replace $n$ with $N$:\n$$\n\\widehat{u}^{\\,N} = N \\varepsilon (-i)^N\n$$\nThis result shows that the magnitude of the modal amplitude, $|\\widehat{u}^{\\,N}| = |N \\varepsilon (-i)^N| = N|\\varepsilon|$, grows linearly with the number of time steps $N$. This linear growth, arising from a repeated unit-modulus root in the amplification polynomial, is the hallmark of a weak instability. Despite the scheme being neutrally stable by the $|g|=1$ criterion, a small initial error can be amplified over time, leading to a loss of accuracy in long-time simulations.", "answer": "$$\\boxed{N \\varepsilon (-i)^N}$$", "id": "3415211"}, {"introduction": "While theoretical analysis can predict the existence of numerical errors, verifying and quantifying them in a practical code implementation is an essential skill for any computational scientist. This hands-on practice introduces the Method of Manufactured Solutions (MMS) as a powerful verification technique. You will design and implement a numerical experiment to independently measure two key artifacts of the leapfrog scheme: the phase error of the physical mode (dispersion) and the contamination from the non-physical computational mode. This exercise bridges the gap between abstract theory and concrete practice, equipping you with a robust methodology for assessing the accuracy and reliability of your numerical solvers [@problem_id:3415242].", "problem": "Design and implement a program that uses the method of manufactured solutions to separately measure physical-mode dispersion and computational-mode contamination in a leapfrog time-centered finite difference scheme for a one-dimensional linear advection equation. Start from the fundamental conservation law and its linear advection specialization. Consider the initial-boundary value problem for a scalar field governed by the partial differential equation\n$$\nu_t + a\\,u_x = 0\n$$\non the periodic spatial domain\n$$\nx \\in [0,L],\n$$\nwith constant advection speed $a$, periodic boundary conditions in $x$, and an exactly representable manufactured solution\n$$\nu_{\\text{exact}}(x,t) = \\cos(k x - a k t),\n$$\nwhere $k$ is the spatial wave number. Use a uniform grid with $J$ points, grid spacing $\\Delta x = L/J$, grid nodes $x_j = j \\,\\Delta x$ for integer $j \\in \\{0,1,\\dots,J-1\\}$, and time step $\\Delta t$ set by the Courant number $c \\in (0,1]$ through\n$$\n\\Delta t = \\frac{c\\,\\Delta x}{a}.\n$$\nEvolve the numerical solution $u_j^n \\approx u(x_j, n \\Delta t)$ with the leapfrog time-centered scheme and centered difference in space,\n$$\nu_j^{n+1} = u_j^{n-1} - c \\left(u_{j+1}^n - u_{j-1}^n\\right),\n$$\nwith indices interpreted periodically modulo $J$. Initialize using the manufactured solution with two time levels. For the unseeded case, take\n$$\nu_j^0 = u_{\\text{exact}}(x_j,0), \\quad u_j^1 = u_{\\text{exact}}(x_j,\\Delta t).\n$$\nFor a seeded case that deliberately injects a computational-mode component, take\n$$\nu_j^0 = u_{\\text{exact}}(x_j,0), \\quad u_j^1 = u_{\\text{exact}}(x_j,\\Delta t) + \\varepsilon \\, u_{\\text{exact}}(x_j,0),\n$$\nwith a small $\\varepsilon  0$.\n\nDefine two quantitative diagnostics that must be computed by your program.\n\n$1.$ Physical-mode dispersion measurement. After $N$ time steps, let $T = N \\Delta t$ denote the simulated final time. Estimate the numerical phase $\\phi_{\\text{num}}$ of the principal Fourier mode at wave number $k$ in $u^N$ by projecting onto the basis $\\{\\cos(k x), \\sin(k x)\\}$,\n$$\nA = \\frac{2}{J} \\sum_{j=0}^{J-1} u_j^N \\cos(k x_j), \\qquad\nB = \\frac{2}{J} \\sum_{j=0}^{J-1} u_j^N \\sin(k x_j),\n$$\nand set\n$$\n\\phi_{\\text{num}} = \\operatorname{atan2}(B, A),\n$$\nwith angles in radians. Define the numerical phase speed\n$$\nc_{\\text{num}} = \\frac{\\phi_{\\text{num}}}{k T},\n$$\nand report the relative dispersion error as the decimal\n$$\nE_{\\text{disp}} = \\frac{|c_{\\text{num}} - a|}{|a|}.\n$$\nWhen comparing phases, use the simulated final time $T = N \\Delta t$ actually achieved by your time stepper.\n\n$2.$ Computational-mode contamination measurement. For $n \\ge 1$, define the even-time physical component $v^n$ and the alternating-time computational component $w^n$ by the time-splitting\n$$\nv_j^n = \\frac{u_j^n + u_j^{n-1}}{2}, \\qquad w_j^n = \\frac{(-1)^n}{2}\\,\\left(u_j^n - u_j^{n-1}\\right).\n$$\nAt the final time level $n=N$, compute the discrete Euclidean norms\n$$\n\\|v^N\\|_2 = \\left(\\sum_{j=0}^{J-1} (v_j^N)^2 \\right)^{1/2}, \\qquad\n\\|w^N\\|_2 = \\left(\\sum_{j=0}^{J-1} (w_j^N)^2 \\right)^{1/2},\n$$\nand report the contamination ratio\n$$\nR = \\frac{\\|w^N\\|_2}{\\|v^N\\|_2}.\n$$\n\nYour program must implement the above, using the following test suite. All quantities are dimensionless; angles are in radians. For the dispersion tests, select $N$ as the nearest integer to the target time divided by the time step, and use the simulated time $T = N \\Delta t$ in the diagnostic. For the contamination tests, use the specified number of time steps. All tests use the same domain and wave:\n- Domain and wave for all tests: $L = 2\\pi$, $a = 1$, $J = 128$, wave index $m = 3$, wave number $k = 2\\pi m/L = m$.\n\nImplement and run these five cases:\n- Case $1$ (dispersion): $c = 0.5$, target time $T_{\\text{target}} = 0.5$, unseeded initialization. Output $E_{\\text{disp}}$.\n- Case $2$ (dispersion): $c = 0.9$, target time $T_{\\text{target}} = 0.5$, unseeded initialization. Output $E_{\\text{disp}}$.\n- Case $3$ (dispersion): $c = 0.99$, target time $T_{\\text{target}} = 0.5$, unseeded initialization. Output $E_{\\text{disp}}$.\n- Case $4$ (contamination): $c = 0.5$, number of steps $N = 400$, unseeded initialization. Output $R$.\n- Case $5$ (contamination): $c = 0.5$, number of steps $N = 400$, seeded initialization with $\\varepsilon = 10^{-3}$. Output $R$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the cases above, for example\n$$\n[\\text{result}_1,\\text{result}_2,\\text{result}_3,\\text{result}_4,\\text{result}_5].\n$$\nEach $\\text{result}_i$ must be a decimal number.", "solution": "The user wants to analyze a numerical scheme for the linear advection equation using the method of manufactured solutions. The task involves implementing the scheme and then calculating two specific diagnostics: one for numerical dispersion and one for computational mode contamination.\n\n### Principle-Based Design\n\nThe problem addresses the numerical solution of the one-dimensional linear advection equation, which is a fundamental prototype for hyperbolic partial differential equations (PDEs). The governing equation is\n$$\n\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0\n$$\nwhere $u(x,t)$ is a scalar field, and $a$ is a constant advection speed. This equation describes the propagation of a wave profile $u(x,t=0)$ with constant speed $a$ without changing its shape.\n\nThe chosen numerical method is the leapfrog time-centered scheme. For a uniform grid with spatial step $\\Delta x$ and time step $\\Delta t$, the discretized equation is\n$$\n\\frac{u_j^{n+1} - u_j^{n-1}}{2\\Delta t} + a \\frac{u_{j+1}^n - u_{j-1}^n}{2\\Delta x} = 0.\n$$\nRearranging and introducing the Courant number $c = a \\Delta t / \\Delta x$ yields the update rule specified in the problem:\n$$\nu_j^{n+1} = u_j^{n-1} - c \\left(u_{j+1}^n - u_{j-1}^n\\right).\n$$\nThis scheme is second-order accurate in both space and time. A key characteristic is that it is non-dissipative; for stable computations (i.e., when the Courant-Friedrichs-Lewy condition $|c| \\le 1$ is met), the amplitude of Fourier modes is perfectly preserved. However, it is dispersive, meaning different Fourier modes propagate at different speeds, leading to a distortion of the wave profile.\n\nAnother crucial feature of the leapfrog scheme, as a three-time-level method, is the presence of a computational mode in addition to the physical mode that approximates the true solution. This extraneous mode can introduce spurious oscillations, particularly a high-frequency oscillation with period $2\\Delta t$.\n\nTo quantitatively assess these numerical artifacts, we use the Method of Manufactured Solutions (MMS). MMS is a powerful verification technique where an analytical solution, the \"manufactured solution,\" is chosen a priori. Here, the chosen solution is a pure monochromatic wave:\n$$\nu_{\\text{exact}}(x,t) = \\cos(k x - a k t).\n$$\nThis solution is an exact solution to the PDE on a periodic domain $[0, L]$ provided the wave number $k$ is a multiple of $2\\pi/L$. We use this exact solution to initialize the numerical scheme and as a benchmark against which to measure numerical errors.\n\nThe solution will be implemented as follows:\n$1.$ Set up the computational grid $x_j=j\\Delta x$ for $j \\in \\{0, \\dots, J-1\\}$ and determine the time step $\\Delta t$ and the total number of steps $N$.\n$2.$ Initialize the numerical solution at two time levels, $u^0$ and $u^1$, using the manufactured solution. This is necessary because the leapfrog scheme is a three-level scheme. The initialization is either \"unseeded\" (using the exact solution at $t=0$ and $t=\\Delta t$) or \"seeded\" (adding a small perturbation to $u^1$ specifically to excite the computational mode).\n$3.$ Implement the time-stepping loop, which iteratively applies the leapfrog formula for $N-1$ steps to compute the solution up to the final time level $u^N$. Periodic boundary conditions are handled by treating array indices cyclically, for which `numpy.roll` is well-suited.\n$4.$ After the simulation, compute the specified diagnostic based on the final numerical state ($u^N$ and $u^{N-1}$).\n\n**Diagnostic 1: Physical-mode dispersion ($E_{\\text{disp}}$)**\nNumerical dispersion causes the numerical wave speed $c_{\\text{num}}$ to differ from the true speed $a$. To measure this, we compute the phase of the numerical solution at the final time $T = N\\Delta t$. The numerical solution is projected onto the Fourier basis functions $\\cos(kx)$ and $\\sin(kx)$ to find the coefficients $A$ and $B$. These coefficients determine the phase of the wave. The numerical phase angle $\\phi_{\\text{num}}$ is found via $\\operatorname{atan2}(B, A)$. The numerical phase velocity is then calculated as $c_{\\text{num}} = \\phi_{\\text{num}} / (k T)$. The relative dispersion error, $E_{\\text{disp}} = |c_{\\text{num}} - a|/|a|$, quantifies the deviation from the ideal behavior. For the given test cases, the total phase rotation is less than $\\pi$, so phase unwrapping is not required.\n\n**Diagnostic 2: Computational-mode contamination ($R$)**\nThe physical mode evolves slowly in time, while the computational mode oscillates with a period of $2\\Delta t$, manifesting as an alternation of the solution values at even and odd time steps. The splitting formulas\n$$\nv_j^n = \\frac{u_j^n + u_j^{n-1}}{2} \\qquad \\text{and} \\qquad w_j^n = \\frac{(-1)^n}{2}(u_j^n - u_j^{n-1})\n$$\nare designed to separate these two components. $v^n$ represents the physical component by averaging over two consecutive time steps, which filters out the high-frequency oscillation. $w^n$ isolates the computational component by taking a difference, which is then demodulated by the $(-1)^n$ factor. The contamination ratio $R = \\|w^N\\|_2 / \\|v^N\\|_2$ measures the relative energy (in the sense of the square of the Euclidean norm) of the computational mode compared to the physical mode at the final time. In the unseeded case, $R$ should be very small (near machine precision), as the computational mode is only excited by round-off errors. In the seeded case, the deliberate perturbation in the initial data for $u^1$ will introduce a computational mode with a predictable initial amplitude, leading to a much larger value of $R$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements the leapfrog scheme for the 1D linear advection equation,\n    and computes dispersion and contamination diagnostics.\n    \"\"\"\n\n    # Define common parameters for all test cases\n    L = 2 * np.pi\n    a = 1.0\n    J = 128\n    m = 3\n    k = float(m)  # Wave number k = 2*pi*m/L = m for L=2*pi\n\n    # Define the five test cases from the problem statement\n    test_cases = [\n        {'type': 'dispersion', 'c': 0.5, 'T_target': 0.5, 'seeded': False},\n        {'type': 'dispersion', 'c': 0.9, 'T_target': 0.5, 'seeded': False},\n        {'type': 'dispersion', 'c': 0.99, 'T_target': 0.5, 'seeded': False},\n        {'type': 'contamination', 'c': 0.5, 'N': 400, 'seeded': False},\n        {'type': 'contamination', 'c': 0.5, 'N': 400, 'seeded': True, 'eps': 1e-3}\n    ]\n\n    results = []\n    for params in test_cases:\n        # 1. Setup grid and time step parameters\n        c = params['c']\n        dx = L / J\n        dt = c * dx / a\n\n        if params['type'] == 'dispersion':\n            # For dispersion tests, N is calculated from T_target\n            N = int(np.round(params['T_target'] / dt))\n        else:  # 'contamination'\n            # For contamination tests, N is given\n            N = params['N']\n\n        x_grid = np.arange(J) * dx\n\n        # 2. Define and initialize the solution\n        def u_exact(x, t):\n            return np.cos(k * x - a * k * t)\n\n        # u_prev is u^0, u_curr is u^1\n        u_prev = u_exact(x_grid, 0.0)\n        u1_at_dt = u_exact(x_grid, dt)\n        \n        if params['seeded']:\n            u_curr = u1_at_dt + params['eps'] * u_exact(x_grid, 0.0)\n        else:\n            u_curr = u1_at_dt\n        \n        # 3. Time-stepping loop\n        # The loop iterates from n=1 to N-1, N-1 times.\n        # It computes u^2, u^3, ..., u^N.\n        for n in range(1, N):\n            # Centered difference using np.roll for periodic boundaries\n            u_j_plus_1 = np.roll(u_curr, -1)\n            u_j_minus_1 = np.roll(u_curr, 1)\n            \n            # Leapfrog update rule\n            u_next = u_prev - c * (u_j_plus_1 - u_j_minus_1)\n            \n            # Update time levels for the next iteration\n            u_prev = u_curr\n            u_curr = u_next\n        \n        # After loop, u_curr is u^N and u_prev is u^(N-1)\n\n        # 4. Compute the required diagnostic\n        if params['type'] == 'dispersion':\n            T_sim = N * dt\n            \n            # Project onto Fourier basis to find A and B\n            A = (2.0 / J) * np.sum(u_curr * np.cos(k * x_grid))\n            B = (2.0 / J) * np.sum(u_curr * np.sin(k * x_grid))\n            \n            phi_num = np.arctan2(B, A)\n            \n            # Avoid division by zero, though not relevant for these test cases\n            if k == 0 or T_sim == 0:\n                # If k=0, phase speed is undefined. If T=0, no evolution.\n                # Here we assume a=0 is the corresponding c_num\n                c_num = 0.0\n            else:\n                c_num = phi_num / (k * T_sim)\n                \n            E_disp = np.abs(c_num - a) / np.abs(a)\n            results.append(E_disp)\n            \n        else:  # 'contamination'\n            # Split into physical (v) and computational (w) components\n            v_N = (u_curr + u_prev) / 2.0\n            \n            sign = 1.0 if N % 2 == 0 else -1.0\n            w_N = (sign / 2.0) * (u_curr - u_prev)\n            \n            # Compute discrete Euclidean norms\n            norm_v = np.linalg.norm(v_N)\n            norm_w = np.linalg.norm(w_N)\n            \n            # Calculate the contamination ratio R\n            if norm_v == 0:\n                R = np.inf if norm_w > 0 else 0.0\n            else:\n                R = norm_w / norm_v\n\n            results.append(R)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.15g}' for r in results)}]\")\n\nsolve()\n```", "id": "3415242"}, {"introduction": "Once a numerical instability is understood and can be measured, the next step is to develop strategies for its mitigation. This problem focuses on the Robert–Asselin (RA) filter, a widely used technique for selectively damping the high-frequency oscillations associated with the leapfrog scheme's computational mode. Through a detailed von Neumann analysis, you will calibrate the filter parameter $\\epsilon$ to meet specific design criteria. This practice illuminates the essential trade-offs in numerical modeling, forcing you to balance the need to suppress an instability against the equally important goal of minimizing accuracy degradation, such as phase error, in the physical solution [@problem_id:3415215].", "problem": "Consider the linear advection partial differential equation (PDE) $u_{t} + c\\,u_{x} = 0$ with constant wave speed $c0$, discretized on a uniform spatial grid with spacing $\\Delta x$ and time step $\\Delta t$ by the leapfrog time-centered scheme with centered spatial differences:\n$$\nu_{j}^{n+1} = u_{j}^{n-1} - 2\\mu\\left(u_{j+1}^{n} - u_{j-1}^{n}\\right), \\quad \\text{where} \\quad \\mu \\equiv \\frac{c\\,\\Delta t}{2\\,\\Delta x}.\n$$\nTo suppress the weak instability associated with the leapfrog computational mode, apply after each leapfrog update the Robert–Asselin (RA) filter:\n$$\nu_{j}^{n} \\leftarrow u_{j}^{n} + \\epsilon\\left(u_{j}^{n+1} - 2u_{j}^{n} + u_{j}^{n-1}\\right),\n$$\nwhere $\\epsilon \\in (0,1/2)$ is a dimensionless parameter to be calibrated.\n\nPerform a von Neumann Fourier analysis by considering modes of the form $u_{j}^{n} = \\widehat{u}\\,\\lambda^{n} \\exp(i j \\theta)$, where $\\theta \\in [-\\pi,\\pi]$ is the nondimensional wavenumber and $\\lambda$ is the one-step amplification factor of the composite leapfrog-plus-filter step. Use the following parameter values:\n- $c = 0.8$,\n- $\\Delta x = 1$,\n- $\\Delta t = 1$,\nso that $\\mu = 0.4$. Calibrate $\\epsilon$ by enforcing that the computational mode at $\\theta = \\pi$ decays by a factor of $0.9$ in amplitude per composite time step, and simultaneously require that the additional phase error per time step induced by the RA filter for the physical mode at $\\theta = \\pi/4$ does not exceed $0.007$ radians.\n\nStarting from the discrete update and filter definitions above, derive the composite amplification relation, identify the computational-mode amplification factor at $\\theta = \\pi$, and determine $\\epsilon$ from the prescribed decay. Then, derive to leading order in $\\epsilon$ the RA-induced phase perturbation for the physical mode and evaluate it at $\\theta = \\pi/4$ to verify whether the phase-error limit is respected. If the derived $\\epsilon$ violates the phase-error limit, choose the largest $\\epsilon$ that achieves an amplitude decay factor no less than $0.9$ per step for the computational mode and still satisfies the phase-error bound. Otherwise, accept the value imposed by the computational-mode decay. Provide the final value of $\\epsilon$ as a dimensionless number. No rounding is required. All angles must be treated in radians.", "solution": "The user wants me to solve a numerical analysis problem involving the leapfrog scheme and the Robert-Asselin filter for the linear advection equation.\n\nHere's my plan:\n1.  **Validate the problem statement:** I will extract all given information and meticulously check for scientific soundness, completeness, and objectivity. Given its basis in standard numerical PDE methods, the problem is expected to be valid.\n\n2.  **Derive the composite amplification relation:** I'll perform a von Neumann analysis on the combined leapfrog-plus-filter scheme as described. This involves substituting a Fourier mode of the form $u_j^n = \\widehat{u} \\lambda^n \\exp(ij\\theta)$ into the system of discrete equations to derive the characteristic polynomial for the amplification factor $\\lambda$. The system is:\n    1.  A leapfrog step to compute $u^{n+1}$ from $u^n$ and $u^{n-1}$.\n    2.  An RA filter step which updates the value of $u^n$ using $u^{n+1}$, $u^n$, and $u^{n-1}$. Let's denote the filtered value as $u_f^n$.\n    3.  The next leapfrog step to compute $u^{n+2}$ uses $u^{n+1}$ and the filtered value $u_f^n$.\n\n3.  **Analyze the computational mode:** I will specialize the characteristic polynomial to the wavenumber $\\theta = \\pi$. This will yield the amplification factors for the physical and computational modes at this specific wavenumber. Using the provided decay requirement for the computational mode, I will determine the value of the filter parameter $\\epsilon$.\n\n4.  **Analyze the phase error:** I'll find the physical-mode root of the characteristic polynomial, $\\lambda_p$. I will then derive an expression for the phase perturbation, $\\Delta\\phi$, introduced by the filter, valid to the leading order in $\\epsilon$. This is the difference between the phase of $\\lambda_p$ with the filter ($\\epsilon  0$) and without it ($\\epsilon=0$).\n\n5.  **Apply constraints and determine the final value:** I will evaluate the phase perturbation at the specified wavenumber $\\theta = \\pi/4$ and use the given parameter values to establish a constraint on $\\epsilon$. I will then compare the value of $\\epsilon$ derived from the computational mode decay with this phase error constraint. Following the problem's logic, I will either accept the initial value of $\\epsilon$ or choose the maximum permissible value that satisfies all conditions.\n\nLet's begin the formal process.\n\n### Step 1: Extract Givens\n-   PDE: $u_{t} + c\\,u_{x} = 0$, with constant $c  0$.\n-   Leapfrog scheme: $u_{j}^{n+1} = u_{j}^{n-1} - 2\\mu\\left(u_{j+1}^{n} - u_{j-1}^{n}\\right)$.\n-   Courant-like parameter: $\\mu \\equiv \\frac{c\\,\\Delta t}{2\\,\\Delta x}$.\n-   Robert–Asselin (RA) filter: $u_{j}^{n} \\leftarrow u_{j}^{n} + \\epsilon\\left(u_{j}^{n+1} - 2u_{j}^{n} + u_{j}^{n-1}\\right)$, where $\\epsilon \\in (0, 1/2)$.\n-   Fourier mode for analysis: $u_{j}^{n} = \\widehat{u}\\,\\lambda^{n} \\exp(i j \\theta)$, with $\\theta \\in [-\\pi,\\pi]$.\n-   Parameter values: $c = 0.8$, $\\Delta x = 1$, $\\Delta t = 1$. This implies $\\mu = \\frac{0.8 \\times 1}{2 \\times 1} = 0.4$.\n-   Constraint 1 (Computational mode decay): At $\\theta = \\pi$, the computational mode decays by a factor of $0.9$ per step.\n-   Constraint 2 (Phase error): The additional phase error per time step induced by the RA filter for the physical mode at $\\theta = \\pi/4$ must not exceed $0.007$ radians.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is scientifically grounded, well-posed, and objective.\n-   **Scientific Grounding:** The problem deals with a standard, well-established topic in numerical analysis: the stability and accuracy of finite difference schemes for PDEs. The leapfrog scheme, its weak instability, and the Robert-Asselin filter are all canonical subjects in this field.\n-   **Well-Posedness:** The problem provides a clear set of equations, parameters, and two distinct constraints to determine a single parameter, $\\epsilon$. The logic for choosing $\\epsilon$ in case of conflict between constraints is also specified. The structure suggests a unique solution exists.\n-   **Objectivity:** The problem is stated in precise mathematical language, free from ambiguity or subjective claims.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. I will proceed with the solution.\n\n### Derivation and Solution\n\nWe analyze the combined leapfrog-filter scheme. The process for advancing from the pair $(u^{n-1}, u^n)$ to $(u^n, u^{n+1})$ and then to $(u^{n+1}, u^{n+2})$ is as follows:\n1.  Compute $u_j^{n+1}$ using the standard leapfrog update:\n    $u_j^{n+1} = u_j^{n-1} - 2\\mu(u_{j+1}^{n} - u_{j-1}^{n})$\n2.  The value $u_j^n$ is then filtered to produce a new value, $u_{f,j}^n$, which is used in the subsequent step:\n    $u_{f,j}^n = u_j^n + \\epsilon(u_j^{n+1} - 2u_j^n + u_j^{n-1})$\n3.  The next state $u_j^{n+2}$ is calculated using the filtered value $u_{f,j}^n$:\n    $u_j^{n+2} = u_{f,j}^n - 2\\mu(u_{j+1}^{n+1} - u_{j-1}^{n+1})$\n\nTo perform the von Neumann analysis, we substitute the Fourier mode $u_j^n = \\widehat{u}^n e^{ij\\theta}$ into these equations. The spatial difference term becomes:\n$u_{j+1}^n - u_{j-1}^n = \\widehat{u}^n e^{ij\\theta}(e^{i\\theta} - e^{-i\\theta}) = \\widehat{u}^n e^{ij\\theta} (2i\\sin\\theta)$.\n\nThe system of equations in Fourier space becomes:\n1.  $\\widehat{u}^{n+1} = \\widehat{u}^{n-1} - 2\\mu (2i\\sin\\theta) \\widehat{u}^n = \\widehat{u}^{n-1} - 4i\\mu\\sin\\theta \\widehat{u}^n$.\n2.  $\\widehat{u}_f^n = \\widehat{u}^n + \\epsilon(\\widehat{u}^{n+1} - 2\\widehat{u}^n + \\widehat{u}^{n-1})$.\n3.  $\\widehat{u}^{n+2} = \\widehat{u}_f^n - 4i\\mu\\sin\\theta \\widehat{u}^{n+1}$.\n\nSubstitute (2) into (3):\n$\\widehat{u}^{n+2} = [\\widehat{u}^n + \\epsilon(\\widehat{u}^{n+1} - 2\\widehat{u}^n + \\widehat{u}^{n-1})] - 4i\\mu\\sin\\theta \\widehat{u}^{n+1}$.\n\nFrom (1), we express $\\widehat{u}^{n-1}$ in terms of more recent values: $\\widehat{u}^{n-1} = \\widehat{u}^{n+1} + 4i\\mu\\sin\\theta \\widehat{u}^n$. Substitute this into the equation for $\\widehat{u}^{n+2}$:\n$\\widehat{u}^{n+2} = \\widehat{u}^n + \\epsilon[\\widehat{u}^{n+1} - 2\\widehat{u}^n + (\\widehat{u}^{n+1} + 4i\\mu\\sin\\theta \\widehat{u}^n)] - 4i\\mu\\sin\\theta \\widehat{u}^{n+1}$\n$\\widehat{u}^{n+2} = \\widehat{u}^n + \\epsilon(2\\widehat{u}^{n+1} - 2\\widehat{u}^n + 4i\\mu\\sin\\theta \\widehat{u}^n) - 4i\\mu\\sin\\theta \\widehat{u}^{n+1}$\n\nGroup terms by $\\widehat{u}^{n+1}$ and $\\widehat{u}^n$:\n$\\widehat{u}^{n+2} = (2\\epsilon - 4i\\mu\\sin\\theta)\\widehat{u}^{n+1} + (1 - 2\\epsilon + 4i\\epsilon\\mu\\sin\\theta)\\widehat{u}^n$.\n\nBy setting $\\widehat{u}^n = \\lambda^n$, we obtain the characteristic polynomial for the amplification factor $\\lambda$:\n$\\lambda^2 - (2\\epsilon - 4i\\mu\\sin\\theta)\\lambda - (1 - 2\\epsilon + 4i\\epsilon\\mu\\sin\\theta) = 0$.\n\n**Calibration of $\\epsilon$ using the computational mode**\n\nWe analyze the case $\\theta=\\pi$. Here, $\\sin\\theta = 0$. The characteristic polynomial simplifies to:\n$\\lambda^2 - 2\\epsilon\\lambda - (1 - 2\\epsilon) = 0$.\n\nThe roots are given by the quadratic formula:\n$\\lambda = \\frac{2\\epsilon \\pm \\sqrt{(-2\\epsilon)^2 - 4(1)(-(1-2\\epsilon))}}{2} = \\epsilon \\pm \\sqrt{\\epsilon^2 + 1 - 2\\epsilon} = \\epsilon \\pm \\sqrt{(\\epsilon-1)^2}$.\nSince $\\epsilon \\in (0, 1/2)$, $\\epsilon-1  0$, so $\\sqrt{(\\epsilon-1)^2} = |\\epsilon-1| = 1-\\epsilon$.\nThe two roots are:\n$\\lambda_1 = \\epsilon + (1-\\epsilon) = 1$ (physical mode).\n$\\lambda_2 = \\epsilon - (1-\\epsilon) = 2\\epsilon - 1$ (computational mode).\n\nThe problem requires the computational mode to decay by a factor of $0.9$ per step. This means the magnitude of its amplification factor must be $0.9$:\n$|\\lambda_2| = |2\\epsilon - 1| = 0.9$.\nSince $\\epsilon \\in (0, 1/2)$, $2\\epsilon-1$ is negative. Thus, $|2\\epsilon-1| = -(2\\epsilon-1) = 1-2\\epsilon$.\n$1 - 2\\epsilon = 0.9 \\implies 2\\epsilon = 0.1 \\implies \\epsilon = 0.05$.\nThis value lies in the prescribed range $(0, 1/2)$.\n\n**Phase error analysis**\n\nThe roots of the general characteristic equation are:\n$\\lambda = \\frac{(2\\epsilon - 4i\\mu\\sin\\theta) \\pm \\sqrt{(2\\epsilon - 4i\\mu\\sin\\theta)^2 + 4(1-2\\epsilon+4i\\epsilon\\mu\\sin\\theta)}}{2}$.\nThe term under the square root simplifies to $4(1 - (2\\mu\\sin\\theta)^2 - (2\\epsilon - \\epsilon^2))$. Let $\\nu = 2\\mu\\sin\\theta$.\nThe roots are $\\lambda = (\\epsilon - i\\nu) \\pm \\sqrt{1-\\nu^2 - 2\\epsilon + \\epsilon^2}$.\nThe physical mode is the one that approaches $1$ as $\\nu \\to 0$. Let $R = \\sqrt{1-\\nu^2-2\\epsilon+\\epsilon^2}$.\nAs $\\nu \\to 0$, $R \\to \\sqrt{(1-\\epsilon)^2} = 1-\\epsilon$.\nThe roots become $\\epsilon \\pm (1-\\epsilon)$, which are $1$ and $2\\epsilon-1$. The physical root is thus $\\lambda_p = (\\epsilon - i\\nu) + R$.\n\nThe phase of the physical mode is $\\phi(\\epsilon) = \\arg(\\lambda_p)$. We are interested in the additional phase error, $\\Delta\\phi = \\phi(\\epsilon) - \\phi(0)$, to leading order in $\\epsilon$.\nFor small $\\epsilon$, we expand $\\lambda_p$:\n$R = \\sqrt{1-\\nu^2 - (2\\epsilon-\\epsilon^2)} \\approx \\sqrt{1-\\nu^2}\\left(1 - \\frac{2\\epsilon}{1-\\nu^2}\\right)^{1/2} \\approx \\sqrt{1-\\nu^2}\\left(1 - \\frac{\\epsilon}{1-\\nu^2}\\right) = \\sqrt{1-\\nu^2} - \\frac{\\epsilon}{\\sqrt{1-\\nu^2}}$.\n$\\lambda_p(\\epsilon) \\approx (\\epsilon - i\\nu) + \\sqrt{1-\\nu^2} - \\frac{\\epsilon}{\\sqrt{1-\\nu^2}} = \\underbrace{(-i\\nu + \\sqrt{1-\\nu^2})}_{\\lambda_p(0)} + \\epsilon\\left(1 - \\frac{1}{\\sqrt{1-\\nu^2}}\\right)$.\nThe phase perturbation is given by $\\Delta\\phi \\approx \\text{Im}\\left(\\frac{\\delta\\lambda_p}{\\lambda_p(0)}\\right)$, where $\\delta\\lambda_p$ is the $O(\\epsilon)$ term.\nNote that for the un-filtered leapfrog scheme, $|\\lambda_p(0)|=|\\sqrt{1-\\nu^2} - i\\nu|=1$ for stable modes ($\\nu^2 \\le 1$).\nThus, $\\frac{1}{\\lambda_p(0)} = \\overline{\\lambda_p(0)} = \\sqrt{1-\\nu^2} + i\\nu$.\n$\\Delta\\phi \\approx \\text{Im}\\left[ \\epsilon\\left(1 - \\frac{1}{\\sqrt{1-\\nu^2}}\\right) (\\sqrt{1-\\nu^2} + i\\nu) \\right]$.\n$\\Delta\\phi \\approx \\epsilon\\nu\\left(1 - \\frac{1}{\\sqrt{1-\\nu^2}}\\right)$.\n\nThe phase error constraint is $|\\Delta\\phi| \\le 0.007$ at $\\theta = \\pi/4$.\nFirst, we calculate $\\nu$ with the given parameters: $\\mu=0.4$ and $\\theta=\\pi/4$.\n$\\nu = 2\\mu\\sin\\theta = 2(0.4)\\sin(\\pi/4) = 0.8 \\frac{\\sqrt{2}}{2} = 0.4\\sqrt{2}$.\nSince $\\nu^2 = (0.4\\sqrt{2})^2 = 0.32  1$, the scheme is stable.\nThe magnitude of the phase error is:\n$|\\Delta\\phi| = \\left|\\epsilon\\nu\\left(1 - \\frac{1}{\\sqrt{1-\\nu^2}}\\right)\\right| = \\epsilon\\nu\\left(\\frac{1}{\\sqrt{1-\\nu^2}} - 1\\right)$.\nThe term in the parenthesis is $\\frac{1}{\\sqrt{1-0.32}}-1 = \\frac{1}{\\sqrt{0.68}}-1$.\nWe require $|\\Delta\\phi| \\le 0.007$, so we find the maximum allowed $\\epsilon$:\n$\\epsilon \\le \\frac{0.007}{\\nu(\\frac{1}{\\sqrt{1-\\nu^2}}-1)} = \\frac{0.007}{0.4\\sqrt{2}(\\frac{1}{\\sqrt{0.68}} - 1)}$.\nLet's evaluate the bound:\n$0.4\\sqrt{2} \\approx 0.565685$.\n$\\frac{1}{\\sqrt{0.68}} - 1 \\approx \\frac{1}{0.82462} - 1 \\approx 1.21268 - 1 = 0.21268$.\n$\\epsilon \\le \\frac{0.007}{0.565685 \\times 0.21268} \\approx \\frac{0.007}{0.12032} \\approx 0.058178$.\n\n**Final decision on $\\epsilon$**\n\n1.  The computational mode decay requirement at $\\theta=\\pi$ gives $\\epsilon = 0.05$.\n2.  The phase error limit at $\\theta=\\pi/4$ requires $\\epsilon \\le 0.058178...$.\n\nThe value $\\epsilon=0.05$ satisfies the phase error constraint ($0.05 \\le 0.058178...$).\nAccording to the problem statement, \"If the derived $\\epsilon$ violates the phase-error limit, [...] Otherwise, accept the value imposed by the computational-mode decay.\"\nSince there is no violation, we accept the value derived from the computational mode decay requirement.\nThe final value for the parameter is $\\epsilon = 0.05$.\nAll angles were treated in radians as requested. No rounding is required as the result is an exact decimal.", "answer": "$$\\boxed{0.05}$$", "id": "3415215"}]}