{"hands_on_practices": [{"introduction": "Understanding the Pressure Poisson Equation begins with its derivation and a feel for its numerical behavior. This first practice guides you through deriving the PPE from the fractional-step method's projection step and then applying a single iteration of the Jacobi method. By manually calculating the pressure update at a single grid point, you will gain a concrete understanding of how the local pressure responds to the divergence of the intermediate velocity field and the pressure of its neighbors. [@problem_id:3307564]", "problem": "Consider a two-dimensional, incompressible flow advanced by a fractional-step (projection) method in Computational Fluid Dynamics (CFD). Let the intermediate velocity field be denoted by $\\mathbf{u}^{\\ast}$, the mass density by $\\rho$, and the time step by $\\Delta t$. The corrected velocity $\\mathbf{u}^{n+1}$ is obtained by enforcing incompressibility through a pressure correction. Work on a uniform Cartesian grid with spacing $h$ in both directions, and assume Dirichlet boundary conditions for pressure on the domain boundary. Focus on an interior cell $(i,j)$.\n\nStarting from the governing equations of incompressible flow and the definition of the fractional-step projection, derive the pressure Poisson equation (PPE) as the equation that enforces $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$ in terms of $p^{n+1}$ and $\\mathbf{u}^{\\ast}$. Discretize the Laplacian operator by a standard five-point stencil on the uniform grid, and derive the Jacobi fixed-point iteration for the interior pressure update in terms of the neighboring pressure values from the previous iterate and the local source term. Then, compute one Jacobi iteration for the specific interior location $(i,j)$ using the following data:\n\n- Grid spacing: $h = 0.01 \\,\\text{m}$.\n- Density: $\\rho = 1000 \\,\\text{kg}\\,\\text{m}^{-3}$.\n- Time step: $\\Delta t = 0.1 \\,\\text{s}$.\n- Face-centered intermediate velocities at $(i,j)$:\n  - $u^{\\ast}_{i+\\frac{1}{2},j} = 0.20 \\,\\text{m}\\,\\text{s}^{-1}$, $u^{\\ast}_{i-\\frac{1}{2},j} = 0.10 \\,\\text{m}\\,\\text{s}^{-1}$,\n  - $v^{\\ast}_{i,j+\\frac{1}{2}} = -0.05 \\,\\text{m}\\,\\text{s}^{-1}$, $v^{\\ast}_{i,j-\\frac{1}{2}} = -0.10 \\,\\text{m}\\,\\text{s}^{-1}$.\n- Previous-iterate neighbor pressures (in Pascals) at iteration $m$:\n  - $p^{(m)}_{i+1,j} = 100000$, $p^{(m)}_{i-1,j} = 100010$, $p^{(m)}_{i,j+1} = 100000$, $p^{(m)}_{i,j-1} = 100005$.\n\nUse the standard second-order finite-volume or finite-difference discrete divergence to form $q_{i,j} = \\left(\\frac{\\rho}{\\Delta t}\\right)\\nabla \\cdot \\mathbf{u}^{\\ast}$ at the cell $(i,j)$ and perform one Jacobi update for the interior pressure. Express the updated pressure in Pascals. Provide the exact value; do not round.\n\nAdditionally, for a square interior grid of size $N_{x} \\times N_{y}$ with Dirichlet boundary conditions, discuss the expected convergence rate per iteration of the Jacobi method by giving the spectral radius of the Jacobi iteration matrix as a function of $N_{x}$ and $N_{y}$, and briefly interpret its implication for large $N_{x},N_{y}$. The discussion does not affect the requested numerical answer.", "solution": "The problem requires a multistep derivation and calculation within the context of computational fluid dynamics, specifically concerning the projection method for incompressible flows. We will proceed by first deriving the continuous Pressure Poisson Equation (PPE), then discretizing it and formulating the Jacobi iterative scheme, followed by a numerical calculation for one iteration step, and finally a discussion on the method's convergence.\n\n**1. Derivation of the Pressure Poisson Equation (PPE)**\n\nThe projection method for solving the incompressible Navier-Stokes equations advances the solution in time by splitting the momentum equation update into two steps. The governing equations for an incompressible fluid with constant density $\\rho$ are the continuity equation and the momentum equation.\n\nThe core of the projection method lies in the second step, the correction or projection step. After an intermediate velocity field, $\\mathbf{u}^{\\ast}$, is computed (typically by solving the momentum equation without the pressure gradient term), a pressure field $p^{n+1}$ is found such that the corrected velocity field, $\\mathbf{u}^{n+1}$, is divergence-free.\n\nThe relationship between the corrected velocity $\\mathbf{u}^{n+1}$, the intermediate velocity $\\mathbf{u}^{\\ast}$, and the pressure at the new time step, $p^{n+1}$, is given by the projection step equation:\n$$ \\frac{\\mathbf{u}^{n+1} - \\mathbf{u}^{\\ast}}{\\Delta t} = -\\frac{1}{\\rho} \\nabla p^{n+1} $$\nwhere $\\Delta t$ is the time step. This equation can be rearranged to express the corrected velocity explicitly:\n$$ \\mathbf{u}^{n+1} = \\mathbf{u}^{\\ast} - \\frac{\\Delta t}{\\rho} \\nabla p^{n+1} $$\nThe fundamental constraint for an incompressible flow is that the velocity field must be divergence-free (solenoidal) at all times. We enforce this condition on the corrected velocity field $\\mathbf{u}^{n+1}$:\n$$ \\nabla \\cdot \\mathbf{u}^{n+1} = 0 $$\nTo derive the equation for the pressure $p^{n+1}$, we take the divergence of the velocity correction equation:\n$$ \\nabla \\cdot \\mathbf{u}^{n+1} = \\nabla \\cdot \\left( \\mathbf{u}^{\\ast} - \\frac{\\Delta t}{\\rho} \\nabla p^{n+1} \\right) $$\nApplying the incompressibility constraint $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$ to the left side and using the linearity of the divergence operator on the right side, we get:\n$$ 0 = \\nabla \\cdot \\mathbf{u}^{\\ast} - \\nabla \\cdot \\left( \\frac{\\Delta t}{\\rho} \\nabla p^{n+1} \\right) $$\nAssuming the density $\\rho$ and time step $\\Delta t$ are constants, they can be moved outside the divergence operator:\n$$ \\nabla \\cdot (\\nabla p^{n+1}) = \\frac{\\rho}{\\Delta t} \\nabla \\cdot \\mathbf{u}^{\\ast} $$\nThe operator $\\nabla \\cdot \\nabla$ is the Laplacian operator, denoted by $\\nabla^2$ or $\\Delta$. Thus, we arrive at the Pressure Poisson Equation (PPE):\n$$ \\nabla^2 p^{n+1} = \\frac{\\rho}{\\Delta t} \\nabla \\cdot \\mathbf{u}^{\\ast} $$\nThis elliptic partial differential equation determines the pressure field required to project the intermediate velocity field onto a divergence-free space.\n\n**2. Discretization and Jacobi Iteration**\n\nWe discretize the PPE on a uniform two-dimensional Cartesian grid with spacing $h$ in both the $x$ and $y$ directions. Let $p_{i,j}$ denote the pressure at the center of cell $(i,j)$.\n\nThe Laplacian operator $\\nabla^2 p$ at $(i,j)$ is approximated using a standard second-order, five-point finite difference stencil:\n$$ (\\nabla^2 p)_{i,j} \\approx \\frac{p_{i+1,j} - 2p_{i,j} + p_{i-1,j}}{h^2} + \\frac{p_{i,j+1} - 2p_{i,j} + p_{i,j-1}}{h^2} $$\nThe source term on the right-hand side, which we denote as $q$, is discretized at the cell center $(i,j)$. The problem specifies a staggered grid arrangement where velocities are stored at cell faces. The divergence of the intermediate velocity field $\\mathbf{u}^{\\ast} = (u^{\\ast}, v^{\\ast})$ is approximated by a central difference:\n$$ (\\nabla \\cdot \\mathbf{u}^{\\ast})_{i,j} \\approx \\frac{u^{\\ast}_{i+\\frac{1}{2},j} - u^{\\ast}_{i-\\frac{1}{2},j}}{h} + \\frac{v^{\\ast}_{i,j+\\frac{1}{2}} - v^{\\ast}_{i,j-\\frac{1}{2}}}{h} $$\nThe discretized source term is then:\n$$ q_{i,j} = \\left(\\frac{\\rho}{\\Delta t}\\right) \\left( \\frac{u^{\\ast}_{i+\\frac{1}{2},j} - u^{\\ast}_{i-\\frac{1}{2},j}}{h} + \\frac{v^{\\ast}_{i,j+\\frac{1}{2}} - v^{\\ast}_{i,j-\\frac{1}{2}}}{h} \\right) $$\nCombining these, the fully discretized PPE is:\n$$ \\frac{p_{i+1,j} + p_{i-1,j} + p_{i,j+1} + p_{i,j-1} - 4p_{i,j}}{h^2} = q_{i,j} $$\nTo derive the Jacobi fixed-point iteration, we solve this equation for the center pressure $p_{i,j}$. Let the iteration counter be $m$. The Jacobi method updates the value at $(i,j)$ using only the values from the previous iteration, $m$, for all neighboring points.\n$$ -4p_{i,j} = h^2 q_{i,j} - (p_{i+1,j} + p_{i-1,j} + p_{i,j+1} + p_{i,j-1}) $$\n$$ p_{i,j} = \\frac{1}{4} (p_{i+1,j} + p_{i-1,j} + p_{i,j+1} + p_{i,j-1} - h^2 q_{i,j}) $$\nThe Jacobi update rule is therefore:\n$$ p^{(m+1)}_{i,j} = \\frac{1}{4} \\left( p^{(m)}_{i+1,j} + p^{(m)}_{i-1,j} + p^{(m)}_{i,j+1} + p^{(m)}_{i,j-1} - h^2 q_{i,j} \\right) $$\n\n**3. Numerical Calculation of One Jacobi Iteration**\n\nWe are given the following data:\n- Grid spacing: $h = 0.01 \\,\\text{m}$.\n- Density: $\\rho = 1000 \\,\\text{kg}\\,\\text{m}^{-3}$.\n- Time step: $\\Delta t = 0.1 \\,\\text{s}$.\n- Intermediate velocities:\n  - $u^{\\ast}_{i+\\frac{1}{2},j} = 0.20 \\,\\text{m}\\,\\text{s}^{-1}$, $u^{\\ast}_{i-\\frac{1}{2},j} = 0.10 \\,\\text{m}\\,\\text{s}^{-1}$\n  - $v^{\\ast}_{i,j+\\frac{1}{2}} = -0.05 \\,\\text{m}\\,\\text{s}^{-1}$, $v^{\\ast}_{i,j-\\frac{1}{2}} = -0.10 \\,\\text{m}\\,\\text{s}^{-1}$\n- Previous-iterate pressures (at iteration $m$):\n  - $p^{(m)}_{i+1,j} = 100000$ Pa, $p^{(m)}_{i-1,j} = 100010$ Pa, $p^{(m)}_{i,j+1} = 100000$ Pa, $p^{(m)}_{i,j-1} = 100005$ Pa.\n\nFirst, we compute the discrete divergence of $\\mathbf{u}^{\\ast}$ at cell $(i,j)$:\n$$ (\\nabla \\cdot \\mathbf{u}^{\\ast})_{i,j} = \\frac{0.20 - 0.10}{0.01} + \\frac{-0.05 - (-0.10)}{0.01} = \\frac{0.10}{0.01} + \\frac{0.05}{0.01} = 10 + 5 = 15 \\,\\text{s}^{-1} $$\nNext, we compute the source term $q_{i,j}$:\n$$ q_{i,j} = \\frac{\\rho}{\\Delta t} (\\nabla \\cdot \\mathbf{u}^{\\ast})_{i,j} = \\frac{1000}{0.1} \\times 15 = 10000 \\times 15 = 150000 \\,\\text{Pa}\\,\\text{m}^{-2} $$\nNow, we compute the term $h^2 q_{i,j}$ that appears in the Jacobi formula:\n$$ h^2 q_{i,j} = (0.01)^2 \\times 150000 = 0.0001 \\times 150000 = 15 \\,\\text{Pa} $$\nFinally, we perform one Jacobi iteration to find $p^{(m+1)}_{i,j}$:\n$$ p^{(m+1)}_{i,j} = \\frac{1}{4} \\left( p^{(m)}_{i+1,j} + p^{(m)}_{i-1,j} + p^{(m)}_{i,j+1} + p^{(m)}_{i,j-1} - h^2 q_{i,j} \\right) $$\nSubstituting the given pressure values and the calculated term:\n$$ p^{(m+1)}_{i,j} = \\frac{1}{4} (100000 + 100010 + 100000 + 100005 - 15) $$\n$$ p^{(m+1)}_{i,j} = \\frac{1}{4} (400015 - 15) $$\n$$ p^{(m+1)}_{i,j} = \\frac{1}{4} (400000) $$\n$$ p^{(m+1)}_{i,j} = 100000 \\,\\text{Pa} $$\n\n**4. Convergence Rate of the Jacobi Method**\n\nThe convergence of the Jacobi method for the linear system $A\\mathbf{p}=\\mathbf{b}$ is governed by the spectral radius, $\\rho(T_J)$, of the Jacobi iteration matrix $T_J$. For the 2D Poisson equation discretized with the five-point stencil on a rectangular grid with $N_x \\times N_y$ interior points and Dirichlet boundary conditions, the spectral radius of the Jacobi matrix is given by:\n$$ \\rho(T_J) = \\frac{1}{2} \\left[ \\cos\\left(\\frac{\\pi}{N_x+1}\\right) + \\cos\\left(\\frac{\\pi}{N_y+1}\\right) \\right] $$\nFor a large number of grid points, i.e., $N_x \\gg 1$ and $N_y \\gg 1$, the arguments of the cosine functions are small. We can use the Taylor series expansion $\\cos(x) \\approx 1 - x^2/2$ for small $x$.\n$$ \\rho(T_J) \\approx \\frac{1}{2} \\left[ \\left(1 - \\frac{1}{2}\\left(\\frac{\\pi}{N_x+1}\\right)^2\\right) + \\left(1 - \\frac{1}{2}\\left(\\frac{\\pi}{N_y+1}\\right)^2\\right) \\right] $$\n$$ \\rho(T_J) \\approx 1 - \\frac{\\pi^2}{4} \\left( \\frac{1}{(N_x+1)^2} + \\frac{1}{(N_y+1)^2} \\right) $$\nSince the grid spacing $h$ is inversely proportional to $N_x$ and $N_y$ (e.g., $h_x = L_x/(N_x+1)$ for a domain of length $L_x$), we have $\\rho(T_J) \\approx 1 - O(h^2)$.\n\nThis result has a critical implication for the performance of the Jacobi method. As the grid is refined (i.e., $N_x, N_y \\rightarrow \\infty$ or $h \\rightarrow 0$), the spectral radius $\\rho(T_J)$ approaches $1$. The convergence rate, which depends on how much smaller than $1$ the spectral radius is, becomes extremely low. The number of iterations required to reduce the error by a fixed factor is proportional to $(1 - \\rho(T_J))^{-1}$, which is $O(N_x^2 + N_y^2)$ or $O(h^{-2})$. This indicates that the computational effort for the Jacobi solver increases quadratically with the grid resolution in each direction, making it prohibitively slow for fine grids and large-scale problems. This poor scaling necessitates the use of more advanced and efficient solvers like the Successive Over-Relaxation (SOR) method, conjugate gradient methods, or, most effectively, multigrid methods.", "answer": "$$\n\\boxed{100000}\n$$", "id": "3307564"}, {"introduction": "The projection method is designed to enforce the incompressibility constraint exactly, at least in theory. This exercise provides a powerful analytical demonstration of this principle, moving beyond numerical approximation. By solving the Pressure Poisson Equation for a specific, non-solenoidal velocity field in a periodic domain, you will derive the exact pressure field that perfectly projects the velocity onto a divergence-free space, highlighting the elegance and purpose of the PPE. [@problem_id:3321950]", "problem": "Consider a two-dimensional, constant-density incompressible flow in a periodic domain governed by the incompressible Navier–Stokes equations. Work in nondimensional variables so that density is $1$ and the time step is $\\Delta t = 1$. The domain is $\\Omega = [0,2\\pi]\\times[0,2\\pi]$ with periodic boundary conditions in both directions. In a standard fractional-step projection method, a provisional velocity field $\\,\\boldsymbol{u}^{\\ast}\\,$ is first advanced without pressure, and then corrected by a pressure update to enforce incompressibility.\n\nStart from the fundamental constraints of incompressible flow and the definition of the projection step: the corrected velocity satisfies $\\,\\nabla\\cdot \\boldsymbol{u}^{n+1} = 0\\,$ and is obtained from the provisional velocity by subtracting a pressure gradient over one time step. Use these foundations to derive the elliptic boundary value problem that the pressure must satisfy under periodic boundary conditions when enforcing incompressibility after the correction, without assuming any pre-derived formula.\n\nLet the given provisional velocity be\n$$\n\\boldsymbol{u}^{\\ast}(x,y) = \\big(2\\sin(x)\\cos(y),\\; -\\cos(x)\\sin(y)\\big), \\quad (x,y)\\in\\Omega.\n$$\nImpose the standard zero-mean condition on the pressure over $\\Omega$ to ensure uniqueness.\n\nUsing the above, compute:\n- the pressure field $p(x,y)$ that enforces incompressibility after one projection step, and\n- the reduction factor $r$ in divergence defined by\n$$\nr \\equiv \\frac{\\|\\nabla\\cdot \\boldsymbol{u}^{n+1}\\|_{L^{2}(\\Omega)}}{\\|\\nabla\\cdot \\boldsymbol{u}^{\\ast}\\|_{L^{2}(\\Omega)}},\n$$\nwhere $\\|f\\|_{L^{2}(\\Omega)} \\equiv \\left(\\int_{\\Omega} |f|^{2}\\, \\mathrm{d}x\\,\\mathrm{d}y\\right)^{1/2}$.\n\nReport your final answer as a pair consisting of the closed-form expression for $p(x,y)$ and the scalar $r$. No units are needed because of the nondimensionalization. The answer must be a single row matrix containing these two entries. No rounding is required.", "solution": "### 1. Derivation of the Pressure Poisson Equation (PPE)\nThe projection method corrects the provisional velocity field $\\boldsymbol{u}^{\\ast}$ to obtain a divergence-free velocity field $\\boldsymbol{u}^{n+1}$ for the next time step. The correction step is defined as:\n$$ \\boldsymbol{u}^{n+1} = \\boldsymbol{u}^{\\ast} - \\Delta t \\nabla p $$\nGiven that the density $\\rho=1$ and the time step $\\Delta t = 1$, this simplifies to:\n$$ \\boldsymbol{u}^{n+1} = \\boldsymbol{u}^{\\ast} - \\nabla p $$\nThe incompressibility constraint requires that the corrected velocity field is divergence-free:\n$$ \\nabla \\cdot \\boldsymbol{u}^{n+1} = 0 $$\nTo find the governing equation for the pressure $p$, we take the divergence of the correction step equation:\n$$ \\nabla \\cdot \\boldsymbol{u}^{n+1} = \\nabla \\cdot (\\boldsymbol{u}^{\\ast} - \\nabla p) = \\nabla \\cdot \\boldsymbol{u}^{\\ast} - \\nabla^2 p $$\nApplying the incompressibility constraint yields the Pressure Poisson Equation (PPE):\n$$ \\nabla^2 p = \\nabla \\cdot \\boldsymbol{u}^{\\ast} $$\n\n### 2. Calculation of the Source Term\nThe source term for the PPE is the divergence of the given provisional velocity field, $\\boldsymbol{u}^{\\ast}(x,y) = (2\\sin(x)\\cos(y), -\\cos(x)\\sin(y))$. Let $u^{\\ast} = 2\\sin(x)\\cos(y)$ and $v^{\\ast} = -\\cos(x)\\sin(y)$.\n$$ \\nabla \\cdot \\boldsymbol{u}^{\\ast} = \\frac{\\partial u^{\\ast}}{\\partial x} + \\frac{\\partial v^{\\ast}}{\\partial y} = \\frac{\\partial}{\\partial x}(2\\sin(x)\\cos(y)) + \\frac{\\partial}{\\partial y}(-\\cos(x)\\sin(y)) $$\n$$ \\nabla \\cdot \\boldsymbol{u}^{\\ast} = 2\\cos(x)\\cos(y) - \\cos(x)\\cos(y) = \\cos(x)\\cos(y) $$\nThus, the PPE to solve is $\\nabla^2 p = \\cos(x)\\cos(y)$ on the periodic domain $\\Omega = [0,2\\pi]\\times[0,2\\pi]$.\n\n### 3. Solving for the Pressure Field $p(x,y)$\nWe seek a solution of the form $p(x,y) = A\\cos(x)\\cos(y)$, which is consistent with the source term and the periodic boundary conditions. We compute the Laplacian of this trial solution:\n$$ \\frac{\\partial^2 p}{\\partial x^2} = -A\\cos(x)\\cos(y) $$\n$$ \\frac{\\partial^2 p}{\\partial y^2} = -A\\cos(x)\\cos(y) $$\n$$ \\nabla^2 p = \\frac{\\partial^2 p}{\\partial x^2} + \\frac{\\partial^2 p}{\\partial y^2} = -2A\\cos(x)\\cos(y) $$\nEquating this to the source term:\n$$ -2A\\cos(x)\\cos(y) = \\cos(x)\\cos(y) \\implies -2A = 1 \\implies A = -\\frac{1}{2} $$\nThe particular solution is $p(x,y) = -\\frac{1}{2}\\cos(x)\\cos(y)$. The general solution is $p(x,y) = -\\frac{1}{2}\\cos(x)\\cos(y) + C$. The uniqueness condition requires the pressure to have a zero mean over the domain:\n$$ \\int_0^{2\\pi}\\int_0^{2\\pi} \\left(-\\frac{1}{2}\\cos(x)\\cos(y) + C\\right) \\,dx\\,dy = 0 $$\nSince $\\int_0^{2\\pi} \\cos(x)\\,dx = 0$ and $\\int_0^{2\\pi} \\cos(y)\\,dy = 0$, the integral of the first term is zero. The equation becomes $C \\cdot (2\\pi)^2 = 0$, which implies $C=0$. The unique pressure field is:\n$$ p(x,y) = -\\frac{1}{2}\\cos(x)\\cos(y) $$\n\n### 4. Calculation of the Divergence Reduction Factor $r$\nThe reduction factor is $r = \\frac{\\|\\nabla\\cdot \\boldsymbol{u}^{n+1}\\|_{L^{2}(\\Omega)}}{\\|\\nabla\\cdot \\boldsymbol{u}^{\\ast}\\|_{L^{2}(\\Omega)}}$.\nBy construction, the projection step ensures that the corrected velocity field is divergence-free, i.e., $\\nabla \\cdot \\boldsymbol{u}^{n+1} = 0$. Therefore, the numerator is $\\|\\nabla\\cdot \\boldsymbol{u}^{n+1}\\|_{L^{2}(\\Omega)} = 0$.\nThe denominator requires the $L^2$-norm of $\\nabla \\cdot \\boldsymbol{u}^{\\ast} = \\cos(x)\\cos(y)$.\n$$ \\|\\nabla\\cdot \\boldsymbol{u}^{\\ast}\\|_{L^{2}(\\Omega)}^2 = \\int_0^{2\\pi}\\int_0^{2\\pi} (\\cos(x)\\cos(y))^2 \\,dx\\,dy = \\left(\\int_0^{2\\pi} \\cos^2(x)\\,dx\\right) \\left(\\int_0^{2\\pi} \\cos^2(y)\\,dy\\right) $$\nUsing the identity $\\int_0^{2\\pi} \\cos^2(\\theta)\\,d\\theta = \\pi$, we get:\n$$ \\|\\nabla\\cdot \\boldsymbol{u}^{\\ast}\\|_{L^{2}(\\Omega)}^2 = \\pi \\cdot \\pi = \\pi^2 $$\nThe norm is $\\|\\nabla\\cdot \\boldsymbol{u}^{\\ast}\\|_{L^{2}(\\Omega)} = \\pi$, which is non-zero. The reduction factor is therefore:\n$$ r = \\frac{0}{\\pi} = 0 $$\nThe projection step perfectly eliminates the divergence, resulting in a reduction factor of zero. The pair to report is $(p(x,y), r)$.", "answer": "$$\n\\boxed{\\begin{pmatrix} -\\frac{1}{2}\\cos(x)\\cos(y) & 0 \\end{pmatrix}}\n$$", "id": "3321950"}, {"introduction": "Transitioning from theory to practical application requires building a robust numerical solver. This hands-on coding problem challenges you to implement a finite volume discretization of the PPE, a method rooted in physical conservation laws. You will focus on the critical task of incorporating different boundary conditions and confront the solvability condition for pure Neumann problems, a crucial aspect for ensuring a well-posed problem in many fluid dynamics simulations. [@problem_id:3434688]", "problem": "Consider the Pressure Poisson Equation (PPE) for incompressible projection methods, posed on a two-dimensional rectangular domain, and discretized by the finite volume method on a uniform, cell-centered grid. The mathematical model and numerical formulation must be derived from first principles, starting with the divergence theorem and conservation of flux over a control volume. The governing equation is the Poisson equation for the pressure field $p$, written in the form $\\nabla^{2} p = f$ on a rectangular domain $\\Omega = [0,L_x] \\times [0,L_y]$, where $f$ is a given source field. The boundary is denoted by $\\partial \\Omega$, with outward unit normal $\\mathbf{n}$. Boundary conditions are prescribed on each side: either Dirichlet $p = p_D$ or Neumann $\\frac{\\partial p}{\\partial n} = g$. The aim is to incorporate boundary conditions into the finite volume PPE by expressing Neumann terms as boundary face fluxes and by validating the global flux balance for solvability.\n\nYou must derive the finite volume discretization from the following fundamental base:\n- The divergence theorem (Gauss’s theorem): $\\int_{\\Omega} \\nabla \\cdot \\mathbf{q}\\, d\\Omega = \\int_{\\partial \\Omega} \\mathbf{q}\\cdot \\mathbf{n}\\, dS$ for sufficiently smooth vector fields $\\mathbf{q}$.\n- The definition of the Laplacian as the divergence of the gradient: $\\nabla^{2} p = \\nabla \\cdot (\\nabla p)$.\n- The finite volume balance over each control volume: the sum of fluxes over faces equals the volume integral of sources.\n\nOn a uniform grid with $N_x \\times N_y$ rectangular control volumes, cell spacings $\\Delta x = L_x/N_x$ and $\\Delta y = L_y/N_y$, you must:\n- Express the discrete face flux across each interior face by a linear approximation of the normal gradient using the cell-center difference divided by the center-to-center distance, multiplied by the face area. This yields face contributions with coefficients proportional to $A/d$ for each face.\n- For Dirichlet boundaries, treat the boundary face as contributing a known flux term driven by the known boundary value at the face, using the distance from the cell center to the boundary face (one half of the cell spacing) to define the appropriate $A/d$ coefficient that multiplies the prescribed $p_D$.\n- For Neumann boundaries, incorporate the boundary condition as a prescribed normal gradient $\\frac{\\partial p}{\\partial n} = g$ on the face, and insert the corresponding known flux $g \\, A$ into the right-hand side for the adjacent boundary control volume.\n- Assemble the resulting linear system for the unknown cell-centered pressure values.\n\nGlobal solvability must be validated for pure Neumann boundary conditions using the integrated compatibility condition derived from the divergence theorem, which states that the domain integral of the source must equal the boundary integral of the normal derivative when all boundaries are Neumann. In discrete form on the uniform grid, this translates to checking whether the sum of $f$ times control volume areas equals the sum of $g$ times boundary face lengths, to within a specified tolerance. When any Dirichlet boundary is present, the linear system should be well-posed without the compatibility condition; nevertheless, the global balance should be computed and reported.\n\nYour program must:\n- Build the finite volume linear system for the PPE with the above principles and boundary condition handling.\n- For pure Neumann problems, implement a gauge fixing to remove the nullspace (constant-pressure mode) by constraining a single cell’s pressure to a specified value (e.g., zero) so that a unique solution is obtained for numerical purposes. The residual used for validation must exclude the gauged row when assessing the original PPE balance.\n- Compute and report the global flux balance mismatch and a boolean indicating solvability under pure Neumann boundary conditions.\n- Solve the linear system and compute a discrete residual norm for the PPE equations.\n\nAll quantities are nondimensional; no physical units are required.\n\nTest suite definition:\n- Use the following three test cases, each specified by $(N_x,N_y,L_x,L_y)$, constant source $f$, and boundary conditions on the west ($x=0$), east ($x=L_x$), south ($y=0$), and north ($y=L_y$) boundaries. For Dirichlet boundaries, use constant $p_D$; for Neumann boundaries, use constant $g$.\n\n1. Happy path (mixed boundary conditions):\n    - $N_x = 10$, $N_y = 8$, $L_x = 1.0$, $L_y = 1.0$,\n    - $f = 0.0$,\n    - West: Dirichlet $p_D = 0.0$; East: Dirichlet $p_D = 1.0$; South: Neumann $g = 0.0$; North: Neumann $g = 0.0$.\n\n2. Pure Neumann, globally consistent:\n    - $N_x = 12$, $N_y = 12$, $L_x = 1.0$, $L_y = 2.0$,\n    - $f = 3.0$ (constant),\n    - West: Neumann $g = 0.0$; East: Neumann $g = 0.0$; South: Neumann $g = 2.0$; North: Neumann $g = 4.0$.\n    - The discrete global balance condition should hold: $\\sum f \\Delta x \\Delta y \\approx \\sum g\\, A_{\\text{face}}$.\n\n3. Pure Neumann, globally inconsistent:\n    - $N_x = 16$, $N_y = 16$, $L_x = 1.0$, $L_y = 1.0$,\n    - $f = 1.0$ (constant),\n    - West: Neumann $g = 0.0$; East: Neumann $g = 0.0$; South: Neumann $g = 0.0$; North: Neumann $g = 0.0$.\n    - The discrete global balance condition should fail: $\\sum f \\Delta x \\Delta y \\not\\approx \\sum g\\, A_{\\text{face}}$.\n\nOutput specification:\n- For each test case, produce a three-element list $[b, m, r]$ where $b$ is a boolean indicating solvability (for pure Neumann cases, true if the global balance holds within tolerance; for mixed boundary cases, always true), $m$ is a float equal to the absolute mismatch $|\\sum f \\Delta x \\Delta y - \\sum g A_{\\text{face}}|$, and $r$ is a float equal to the discrete $\\ell_2$ norm of the residual of the original PPE equations per cell (for pure Neumann cases, exclude the gauged row when computing the residual norm). Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the format $[[b_1,m_1,r_1],[b_2,m_2,r_2],[b_3,m_3,r_3]]$.\n\nNumerical tolerances:\n- Use a balance tolerance of $10^{-10}$ when determining the boolean $b$ for solvability in pure Neumann cases.", "solution": "### Derivation of the Finite Volume Discretization\n\nThe governing equation is the Poisson equation for pressure $p(\\mathbf{x})$ on a two-dimensional domain $\\Omega = [0,L_x] \\times [0,L_y]$:\n$$ \\nabla^2 p = f $$\nwhere $f$ is a given source term. Using the identity $\\nabla^2 p = \\nabla \\cdot (\\nabla p)$, we can write the equation in conservation form. The finite volume method starts by integrating this equation over a control volume (or cell) $V_{i,j}$ centered at $(x_i, y_j)$:\n$$ \\int_{V_{i,j}} \\nabla \\cdot (\\nabla p) \\,dV = \\int_{V_{i,j}} f \\,dV $$\nApplying the divergence theorem to the left-hand side converts the volume integral into a surface integral over the boundary of the control volume, $\\partial V_{i,j}$:\n$$ \\oint_{\\partial V_{i,j}} (\\nabla p) \\cdot \\mathbf{n} \\,dS = \\int_{V_{i,j}} f \\,dV $$\nwhere $\\mathbf{n}$ is the outward unit normal vector on the surface $\\partial V_{i,j}$.\n\nThe grid is uniform and cell-centered, with $N_x \\times N_y$ cells. The cell dimensions are $\\Delta x = L_x/N_x$ and $\\Delta y = L_y/N_y$, so the volume (area in 2D) of cell $V_{i,j}$ is $\\Delta V = \\Delta x \\Delta y$. The pressure $p_{i,j}$ represents the value at the cell center. The surface integral is the sum of fluxes across the four faces of the rectangular cell (east, west, north, south):\n$$ F_e + F_w + F_n + F_s = f_{i,j} \\Delta x \\Delta y $$\nwhere $F_k$ is the total flux out of face $k$. For an interior face, e.g., the east face between cell $(i,j)$ and $(i+1,j)$, the flux is approximated using a second-order central difference for the gradient:\n$$ F_e = \\int_{\\text{east face}} (\\nabla p \\cdot \\mathbf{e}_x) \\,dS \\approx \\left(\\frac{p_{i+1,j} - p_{i,j}}{\\Delta x}\\right) \\Delta y $$\nSimilarly, the fluxes for the other faces of an interior cell are:\n$$ F_w = \\int_{\\text{west face}} (\\nabla p \\cdot (-\\mathbf{e}_x)) \\,dS \\approx -\\left(\\frac{p_{i,j} - p_{i-1,j}}{\\Delta x}\\right) \\Delta y $$\n$$ F_n = \\int_{\\text{north face}} (\\nabla p \\cdot \\mathbf{e}_y) \\,dS \\approx \\left(\\frac{p_{i,j+1} - p_{i,j}}{\\Delta y}\\right) \\Delta x $$\n$$ F_s = \\int_{\\text{south face}} (\\nabla p \\cdot (-\\mathbf{e}_y)) \\,dS \\approx -\\left(\\frac{p_{i,j} - p_{i,j-1}}{\\Delta y}\\right) \\Delta x $$\nSubstituting these into the balance equation yields the standard five-point stencil for the Laplacian:\n$$ \\frac{\\Delta y}{\\Delta x}(p_{i+1,j} - 2p_{i,j} + p_{i-1,j}) + \\frac{\\Delta x}{\\Delta y}(p_{i,j+1} - 2p_{i,j} + p_{i,j-1}) = f_{i,j} \\Delta x \\Delta y $$\nThis equation forms one row in a linear system $A\\mathbf{p} = \\mathbf{b}$, where $\\mathbf{p}$ is the vector of unknown cell-centered pressures. For an interior cell $(i,j)$ with 1D index $k = j \\cdot N_x + i$:\n- Diagonal coefficient: $A_{k,k} = -2\\left(\\frac{\\Delta y}{\\Delta x} + \\frac{\\Delta x}{\\Delta y}\\right)$\n- Off-diagonal coefficients: $A_{k, k\\pm 1} = \\frac{\\Delta y}{\\Delta x}$ (for east/west neighbors), $A_{k, k\\pm N_x} = \\frac{\\Delta x}{\\Delta y}$ (for north/south neighbors).\n- Right-hand side: $b_k = f_{i,j} \\Delta x \\Delta y$.\n\n#### Boundary Conditions\n\nFor cells adjacent to the domain boundary, one or more flux terms must be modified.\n\n**1. Neumann Boundary Condition**:\nThe normal derivative is prescribed, $\\frac{\\partial p}{\\partial n} = g$. The flux across the boundary face is directly specified. For example, on the east boundary ($x=L_x$), the outward normal is $\\mathbf{n}=\\mathbf{e}_x$, so $\\frac{\\partial p}{\\partial x}=g_e$. The flux out of the east face of cell $(N_x-1, j)$ is:\n$$ F_e = \\int_{\\text{east face}} (\\nabla p \\cdot \\mathbf{e}_x) \\,dS = \\int g_e \\,dS = g_e \\Delta y $$\nThis is a known value. The flux balance becomes $F_w + F_n + F_s + g_e \\Delta y = f_{N_x-1,j} \\Delta x \\Delta y$. The known flux term moves to the right-hand side, so $b_k$ is modified: $b_k \\rightarrow b_k - g_e \\Delta y$. Similar modifications apply to other Neumann boundaries, with careful attention to the outward normal's direction.\n\n**2. Dirichlet Boundary Condition**:\nThe pressure is prescribed, $p=p_D$. The flux is approximated using a one-sided difference between the cell center and the boundary. For the east face of cell $(N_x-1, j)$, the face is at $x=L_x$ and the cell center is at $x=L_x-\\frac{\\Delta x}{2}$. The gradient is $\\frac{\\partial p}{\\partial x} \\approx \\frac{p_D - p_{N_x-1,j}}{\\Delta x/2}$. The flux is:\n$$ F_e = \\left(\\frac{p_D - p_{N_x-1,j}}{\\Delta x/2}\\right) \\Delta y = 2\\frac{\\Delta y}{\\Delta x}(p_D - p_{N_x-1,j}) $$\nThis expression contains the unknown $p_{N_x-1,j}$ and the known $p_D$. The term involving the unknown modifies the diagonal element of matrix $A$: $A_{k,k} \\rightarrow A_{k,k} - 2\\frac{\\Delta y}{\\Delta x}$. The term involving the known value modifies the right-hand side vector: $b_k \\rightarrow b_k - 2\\frac{\\Delta y}{\\Delta x}p_D$.\n\n### Solvability and Gauge Fixing\n\nFor a pure Neumann problem, the matrix $A$ is singular, having a nullspace corresponding to a constant pressure field (i.e., $A\\mathbf{c} = \\mathbf{0}$ if $\\mathbf{c}$ is a vector of constants). A solution exists only if the right-hand side vector $\\mathbf{b}$ is orthogonal to the nullspace of $A^T$. This leads to the compatibility condition, which in its continuous form is:\n$$ \\int_{\\Omega} f \\,dV = \\oint_{\\partial \\Omega} \\frac{\\partial p}{\\partial n} \\,dS $$\nIn discrete form, this is checked by comparing the sum of all source terms with the sum of all prescribed boundary fluxes:\n$$ \\sum_{i,j} f_{i,j} \\Delta x \\Delta y = \\sum_{\\text{bnd faces}} g_k A_k $$\nIf this condition holds, a unique solution can be obtained by \"gauge fixing\" — constraining one pressure value. We set $p_{0,0}=0$ by modifying the first row of the linear system to be $1 \\cdot p_{0,0} = 0$.\n\n### Residual Calculation\n\nAfter solving the (possibly modified) system $A'\\mathbf{p} = \\mathbf{b}'$ to find $\\mathbf{p}$, the quality of the solution is assessed by computing the residual of the *original* equations, $\\mathbf{r}_{\\text{vec}} = A\\mathbf{p} - \\mathbf{b}$. The discrete $\\ell_2$ norm per cell is then calculated as the Root-Mean-Square (RMS) of the residual vector components. For pure Neumann problems, the equation corresponding to the gauged cell is excluded from this calculation as it was artificially altered.\n$$ r = \\sqrt{\\frac{1}{N_{\\text{eq}}} \\sum_{k \\in \\text{non-gauged}} ( (A\\mathbf{p})_k - b_k )^2} $$\nwhere $N_{\\text{eq}}$ is the number of equations in the sum ($N_x N_y$ for mixed-BC cases, $N_x N_y - 1$ for pure Neumann cases).", "answer": "```python\nimport numpy as np\nfrom scipy.sparse import lil_matrix\nfrom scipy.sparse.linalg import spsolve\n\ndef solve_ppe_fv(Nx, Ny, Lx, Ly, f_val, bc_west, bc_east, bc_south, bc_north):\n    \"\"\"\n    Solves the 2D Pressure Poisson Equation using a cell-centered finite volume method.\n\n    The implemented linear system corresponds to a discretization of Nabla^2 p = f.\n    \"\"\"\n    dx = Lx / Nx\n    dy = Ly / Ny\n    N = Nx * Ny\n\n    # --- 1. Global Balance Check ---\n    source_integral = f_val * Lx * Ly\n    flux_integral = 0.0\n    \n    is_pure_neumann = True\n    bcs = {'W': bc_west, 'E': bc_east, 'S': bc_south, 'N': bc_north}\n    lengths = {'W': Ly, 'E': Ly, 'S': Lx, 'N': Lx}\n\n    for direction, bc in bcs.items():\n        if bc[0] == 'N':\n            flux_integral += bc[1] * lengths[direction]\n        else:\n            is_pure_neumann = False\n    \n    mismatch = abs(source_integral - flux_integral)\n    balance_tol = 1e-10\n    \n    if is_pure_neumann:\n        is_solvable = mismatch < balance_tol\n    else:\n        is_solvable = True\n\n    # --- 2. Assemble Linear System A*p = b ---\n    A = lil_matrix((N, N), dtype=float)\n    b = np.full(N, f_val * dx * dy, dtype=float)\n\n    Cx = dy / dx\n    Cy = dx / dy\n\n    for j in range(Ny):\n        for i in range(Nx):\n            k = j * Nx + i\n            \n            # South face\n            if j > 0:\n                A[k, k] -= Cy\n                A[k, k - Nx] += Cy\n            else: # South boundary\n                bc_type, bc_val = bc_south\n                if bc_type == 'D':\n                    A[k, k] -= 2 * Cy\n                    b[k] -= 2 * Cy * bc_val\n                elif bc_type == 'N': # dp/dn = -dp/dy = g_s\n                    b[k] -= bc_val * dx\n\n            # North face\n            if j < Ny - 1:\n                A[k, k] -= Cy\n                A[k, k + Nx] += Cy\n            else: # North boundary\n                bc_type, bc_val = bc_north\n                if bc_type == 'D':\n                    A[k, k] -= 2 * Cy\n                    b[k] -= 2 * Cy * bc_val\n                elif bc_type == 'N': # dp/dn = dp/dy = g_n\n                    b[k] -= bc_val * dx\n            \n            # West face\n            if i > 0:\n                A[k, k] -= Cx\n                A[k, k - 1] += Cx\n            else: # West boundary\n                bc_type, bc_val = bc_west\n                if bc_type == 'D':\n                    A[k, k] -= 2 * Cx\n                    b[k] -= 2 * Cx * bc_val\n                elif bc_type == 'N': # dp/dn = -dp/dx = g_w\n                    b[k] -= bc_val * dy\n\n            # East face\n            if i < Nx - 1:\n                A[k, k] -= Cx\n                A[k, k + 1] += Cx\n            else: # East boundary\n                bc_type, bc_val = bc_east\n                if bc_type == 'D':\n                    A[k, k] -= 2 * Cx\n                    b[k] -= 2 * Cx * bc_val\n                elif bc_type == 'N': # dp/dn = dp/dx = g_e\n                    b[k] -= bc_val * dy\n\n    A_orig = A.copy().tocsr()\n    b_orig = b.copy()\n    \n    # --- 3. Gauge Fixing for Pure Neumann case ---\n    if is_pure_neumann:\n        gauge_idx = 0\n        A[gauge_idx, :] = 0\n        A[gauge_idx, gauge_idx] = 1.0\n        b[gauge_idx] = 0.0\n\n    # --- 4. Solve the linear system ---\n    A_csr = A.tocsr()\n    try:\n        p = spsolve(A_csr, b)\n    except Exception as e:\n        # Fallback for numerically singular cases\n        p = np.zeros(N)\n\n    # --- 5. Compute Residual Norm ---\n    res_vec = (A_orig @ p) - b_orig\n    \n    if is_pure_neumann:\n        res_sum_sq = np.sum(np.delete(res_vec, gauge_idx)**2)\n        num_eq = N - 1\n    else:\n        res_sum_sq = np.sum(res_vec**2)\n        num_eq = N\n    \n    residual_norm = np.sqrt(res_sum_sq / num_eq) if num_eq > 0 else 0.0\n\n    return [is_solvable, mismatch, residual_norm]\n\ndef solve():\n    \"\"\"\n    Main function to run the test cases and print the results.\n    \"\"\"\n    test_cases = [\n        {\n            \"params\": (10, 8, 1.0, 1.0, 0.0),\n            \"bcs\": {\n                \"bc_west\": ('D', 0.0), 'bc_east': ('D', 1.0),\n                'bc_south': ('N', 0.0), 'bc_north': ('N', 0.0)\n            }\n        },\n        {\n            \"params\": (12, 12, 1.0, 2.0, 3.0),\n            \"bcs\": {\n                \"bc_west\": ('N', 0.0), 'bc_east': ('N', 0.0),\n                'bc_south': ('N', 2.0), 'bc_north': ('N', 4.0)\n            }\n        },\n        {\n            \"params\": (16, 16, 1.0, 1.0, 1.0),\n            \"bcs\": {\n                \"bc_west\": ('N', 0.0), 'bc_east': ('N', 0.0),\n                'bc_south': ('N', 0.0), 'bc_north': ('N', 0.0)\n            }\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        Nx, Ny, Lx, Ly, f_val = case[\"params\"]\n        bcs = case[\"bcs\"]\n        result = solve_ppe_fv(Nx, Ny, Lx, Ly, f_val, **bcs)\n        results.append(f\"[{result[0]},{result[1]},{result[2]}]\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3434688"}]}