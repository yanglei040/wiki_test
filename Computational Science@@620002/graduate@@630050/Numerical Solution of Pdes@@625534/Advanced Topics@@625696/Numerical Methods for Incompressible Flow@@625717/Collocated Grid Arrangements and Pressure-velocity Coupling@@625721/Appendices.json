{"hands_on_practices": [{"introduction": "To build a strong intuition for pressure-velocity decoupling, there is no substitute for seeing it in action. This hands-on coding exercise [@problem_id:3372220] guides you to implement and contrast two schemes: a naive central-differencing approach and a Rhie-Chow-inspired \"virtual staggered\" method. By applying a checkerboard pressure field, you will directly observe why the former fails and how the latter successfully couples pressure and velocity, providing a concrete foundation for the theoretical concepts that follow.", "problem": "Consider the steady, incompressible Stokes equations on a two-dimensional periodic unit square domain with uniform grid spacing in both directions. The unknowns are the cell-centered velocity components and pressure, with the velocity components collocated with pressure. The governing equations are the momentum balance and the continuity condition: $$\\mu \\nabla^2 \\mathbf{u} - \\nabla p = \\mathbf{0}, \\quad \\nabla \\cdot \\mathbf{u} = 0,$$ where $\\mathbf{u} = (u,v)$ is the velocity, $p$ is the pressure, and $\\mu > 0$ is the dynamic viscosity. In a compact semi-discrete modeling of the momentum equations on a collocated grid, one commonly simplifies the discrete momentum operator to a diagonal coefficient $a > 0$ such that the predicted cell-centered velocities are related to discrete pressure gradients by $$a\\,u_{i,j} \\approx -\\left.\\frac{\\partial p}{\\partial x}\\right|_{i,j}, \\quad a\\,v_{i,j} \\approx -\\left.\\frac{\\partial p}{\\partial y}\\right|_{i,j},$$ for all interior cells $(i,j)$, with periodic boundary conditions in both directions. In this context, a purely collocated central scheme that forms mass fluxes at cell faces by averaging adjacent cell-centered velocities is known to admit a spurious, high-frequency pressure mode (the pressure checkerboard), which decouples pressure from continuity. To avoid this issue while preserving second-order central accuracy in the velocity field reconstruction, one can construct a virtual staggered stencil using a compact finite difference approach (a stencil that mimics staggered coupling by using face-centered pressure differences).\n\nYour task is to implement, test, and quantify the effect of two face-velocity reconstructions for a collocated grid:\n1. A naive collocated central reconstruction that computes face velocities by averaging adjacent cell-centered velocities, where the cell-centered velocities are computed from compact central differences of pressure at the cell centers.\n2. A virtual staggered reconstruction (Rhie–Chow-like momentum interpolation) that uses compact second-order face-centered pressure differences to form face velocities directly from pressure, decoupled from cell-centered averaging.\n\nDefinitions and discrete operators to use:\n- Let $N_x$ and $N_y$ be the number of cells in the $x$ and $y$ directions, respectively. The uniform spacings are $\\Delta x = 1/N_x$ and $\\Delta y = 1/N_y$.\n- Cell centers are located at $(x_i,y_j) = ((i+1/2)\\Delta x,(j+1/2)\\Delta y)$ for $i=0,\\dots,N_x-1$, $j=0,\\dots,N_y-1$ with periodic indexing.\n- Define the alternating (checkerboard) pressure mode by $p_{i,j} = (-1)^{i+j}$ at every cell center $(i,j)$.\n- Define compact second-order central differences at cell centers for the pressure gradients: $$\\left.\\frac{\\partial p}{\\partial x}\\right|_{i,j} \\approx \\frac{p_{i+1,j} - p_{i-1,j}}{2\\Delta x}, \\quad \\left.\\frac{\\partial p}{\\partial y}\\right|_{i,j} \\approx \\frac{p_{i,j+1} - p_{i,j-1}}{2\\Delta y}.$$ Use periodic indexing here.\n- Naive collocated face velocities use averaged cell-centered velocities: $$u_{i+1/2,j}^{\\text{naive}} = \\frac{1}{2}(u_{i,j} + u_{i+1,j}), \\quad v_{i,j+1/2}^{\\text{naive}} = \\frac{1}{2}(v_{i,j} + v_{i,j+1}),$$ where $u_{i,j} = -\\frac{1}{a}\\left.\\frac{\\partial p}{\\partial x}\\right|_{i,j}$ and $v_{i,j} = -\\frac{1}{a}\\left.\\frac{\\partial p}{\\partial y}\\right|_{i,j}$.\n- Virtual staggered face velocities use compact second-order pressure differences evaluated across faces: $$u_{i+1/2,j}^{\\text{vs}} = -\\frac{1}{a}\\frac{p_{i+1,j} - p_{i,j}}{\\Delta x}, \\quad v_{i,j+1/2}^{\\text{vs}} = -\\frac{1}{a}\\frac{p_{i,j+1} - p_{i,j}}{\\Delta y}.$$ This formula mimics staggered coupling by directly connecting pressure jumps across faces to mass fluxes.\n- The discrete divergence at each cell center is computed from face mass fluxes by $$\\left.(\\nabla \\cdot \\mathbf{u})\\right|_{i,j} \\approx \\frac{u_{i+1/2,j} - u_{i-1/2,j}}{\\Delta x} + \\frac{v_{i,j+1/2} - v_{i,j-1/2}}{\\Delta y},$$ again with periodic indexing.\n\nAdditionally, you must verify that the velocity reconstruction for smooth fields maintains second-order central accuracy in the face-normal component. Consider a manufactured, smooth, periodic velocity field without pressure forcing, $$u(x,y) = \\sin(2\\pi x)\\cos(2\\pi y),$$ and reconstruct the $x$-face velocity by a compact second-order central averaging of adjacent cell-centered values, $$u_{i+1/2,j}^{\\text{rec}} = \\frac{1}{2}\\left(u_{i,j}^{\\text{cc}} + u_{i+1,j}^{\\text{cc}}\\right),$$ where $u_{i,j}^{\\text{cc}} = u(x_i,y_j)$ and the exact face value is $u(x_{i+1/2},y_j)$. Use periodic indexing. Quantify the observed order of accuracy $p$ by computing the discrete $\\ell^2$ error for two different grid resolutions $(N_x,N_y)=(16,16)$ and $(32,32)$ and forming $$p = \\log_2\\left(\\frac{E_{16}}{E_{32}}\\right),$$ where $E_{N}$ is the discrete $\\ell^2$ error in the reconstructed $x$-face velocity on the $N\\times N$ grid.\n\nImplement a program, adhering to the execution environment constraints described elsewhere, that performs the following test suite:\n\n- Test case 1 (happy path elimination): $N_x=32$, $N_y=32$, $a=1.0$. Compute the discrete divergence $\\ell^2$ norm using the naive collocated scheme and the virtual staggered scheme with the checkerboard pressure. Output a boolean that is true if the naive divergence norm is less than $10^{-12}$ and the virtual staggered divergence norm is greater than $10^{-3}$.\n- Test case 2 (parameter variation): $N_x=16$, $N_y=16$, $a=0.5$. With the checkerboard pressure, output a boolean that is true if the naive divergence norm is less than $10^{-12}$ and the virtual staggered divergence norm is greater than $10^{-3}$.\n- Test case 3 (accuracy in $u$): For $a$ arbitrary (not used), compute the reconstructed $x$-face velocity error using $u(x,y) = \\sin(2\\pi x)\\cos(2\\pi y)$ for $(N_x,N_y)=(16,16)$ and $(32,32)$, and output the observed order of accuracy $p$ as a float rounded to six decimal places.\n- Test case 4 (boundary-sized grid): $N_x=4$, $N_y=4$, $a=1.0$. With the checkerboard pressure, output a boolean that is true if the naive divergence norm is less than $10^{-12}$ and the virtual staggered divergence norm is greater than $10^{-3}$.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3,result4]\"), where the first, second, and fourth entries are booleans as specified above, and the third entry is the float $p$ rounded to six decimal places.", "solution": "The problem requires an analysis and implementation of two different finite difference schemes for computing face velocities on a collocated grid, in the context of the steady, incompressible Stokes equations. The objective is to demonstrate the well-known pressure-velocity decoupling problem associated with a naive central-differencing scheme and how a Rhie-Chow-like momentum interpolation, here termed a \"virtual staggered\" scheme, resolves it. The analysis is performed by evaluating the discrete divergence generated by a high-frequency, checkerboard pressure mode. Additionally, the accuracy of a related velocity reconstruction for smooth fields is assessed.\n\nFirst, the core of the problem lies in the construction of the discrete divergence operator, which forms a discrete pressure Poisson equation. The operator's properties determine whether certain pressure modes, such as the checkerboard pattern, are correctly coupled to the velocity field via the continuity equation.\n\nLet the pressure field be the checkerboard mode, defined as $p_{i,j} = (-1)^{i+j}$ for all grid cells $(i,j)$ with indices taken modulo $N_x$ and $N_y$ respectively. We analyze the two specified schemes under this pressure field.\n\n**1. Naive Collocated Central Scheme**\n\nThis scheme first computes cell-centered velocities using a compact, second-order central difference for the pressure gradient. For the $x$-component of velocity at cell $(i,j)$:\n$$u_{i,j} = -\\frac{1}{a} \\left(\\frac{p_{i+1,j} - p_{i-1,j}}{2\\Delta x}\\right)$$\nWhen the checkerboard pressure $p_{i,j} = (-1)^{i+j}$ is applied, we have $p_{i+1,j} = (-1)^{i+1+j} = -(-1)^{i+j} = -p_{i,j}$, and similarly $p_{i-1,j} = (-1)^{i-1+j} = -(-1)^{i+j} = -p_{i,j}$. Therefore, the discrete pressure gradient is:\n$$\\frac{p_{i+1,j} - p_{i-1,j}}{2\\Delta x} = \\frac{-p_{i,j} - (-p_{i,j})}{2\\Delta x} = 0$$\nThis holds for any $(i,j)$. By symmetry, the $y$-gradient is also zero. Consequently, the computed cell-centered velocities are zero everywhere: $u_{i,j} = 0$ and $v_{i,j} = 0$.\n\nNext, the face velocities are computed by averaging adjacent cell-centered velocities:\n$$u_{i+1/2,j}^{\\text{naive}} = \\frac{1}{2}(u_{i,j} + u_{i+1,j}) = \\frac{1}{2}(0 + 0) = 0$$\n$$v_{i,j+1/2}^{\\text{naive}} = \\frac{1}{2}(v_{i,j} + v_{i,j+1}) = \\frac{1}{2}(0 + 0) = 0$$\nFinally, the discrete divergence at cell $(i,j)$ is computed from these face velocities:\n$$\\left.(\\nabla \\cdot \\mathbf{u})\\right|_{i,j} = \\frac{u_{i+1/2,j}^{\\text{naive}} - u_{i-1/2,j}^{\\text{naive}}}{\\Delta x} + \\frac{v_{i,j+1/2}^{\\text{naive}} - v_{i,j-1/2}^{\\text{naive}}}{\\Delta y} = \\frac{0 - 0}{\\Delta x} + \\frac{0-0}{\\Delta y} = 0$$\nThe discrete divergence is identically zero for the checkerboard pressure mode. This means that a non-physical, high-frequency pressure field produces no divergence, making it \"invisible\" to the continuity equation. Such a mode is a null-space solution of the discrete operator and can contaminate the numerical solution without being corrected. This demonstrates the scheme's failure.\n\n**2. Virtual Staggered Reconstruction**\n\nThis scheme computes face velocities directly from pressure differences across the faces, mimicking a staggered grid arrangement. For the $x$-face between cells $(i,j)$ and $(i+1,j)$:\n$$u_{i+1/2,j}^{\\text{vs}} = -\\frac{1}{a}\\frac{p_{i+1,j} - p_{i,j}}{\\Delta x}$$\nApplying the checkerboard pressure $p_{i,j} = (-1)^{i+j}$:\n$$u_{i+1/2,j}^{\\text{vs}} = -\\frac{1}{a\\Delta x}(-p_{i,j} - p_{i,j}) = \\frac{2p_{i,j}}{a\\Delta x} = \\frac{2(-1)^{i+j}}{a\\Delta x}$$\nSimilarly for the $y$-face velocity:\n$$v_{i,j+1/2}^{\\text{vs}} = -\\frac{1}{a}\\frac{p_{i,j+1} - p_{i,j}}{\\Delta y} = \\frac{2p_{i,j}}{a\\Delta y} = \\frac{2(-1)^{i+j}}{a\\Delta y}$$\nNow, we compute the discrete divergence at cell $(i,j)$:\n$$\\left.(\\nabla \\cdot \\mathbf{u})\\right|_{i,j} = \\frac{u_{i+1/2,j}^{\\text{vs}} - u_{i-1/2,j}^{\\text{vs}}}{\\Delta x} + \\frac{v_{i,j+1/2}^{\\text{vs}} - v_{i,j-1/2}^{\\text{vs}}}{\\Delta y}$$\nThe velocity on the left face, $u_{i-1/2,j}^{\\text{vs}}$, is given by $u_{i-1/2,j}^{\\text{vs}} = \\frac{2(-1)^{(i-1)+j}}{a\\Delta x} = -\\frac{2(-1)^{i+j}}{a\\Delta x} = -u_{i+1/2,j}^{\\text{vs}}$. A similar relation holds for the $y$-velocities. Substituting these into the divergence expression:\n$$\\left.(\\nabla \\cdot \\mathbf{u})\\right|_{i,j} = \\frac{1}{\\Delta x}\\left(\\frac{2p_{i,j}}{a\\Delta x} - \\left(-\\frac{2p_{i,j}}{a\\Delta x}\\right)\\right) + \\frac{1}{\\Delta y}\\left(\\frac{2p_{i,j}}{a\\Delta y} - \\left(-\\frac{2p_{i,j}}{a\\Delta y}\\right)\\right)$$\n$$\\left.(\\nabla \\cdot \\mathbf{u})\\right|_{i,j} = \\frac{4p_{i,j}}{a\\Delta x^2} + \\frac{4p_{i,j}}{a\\Delta y^2} = -\\frac{4}{a}\\left(\\frac{1}{\\Delta x^2} + \\frac{1}{\\Delta y^2}\\right)(-1)^{i+j+1}$$\nThis result is non-zero and, in fact, has a large magnitude that scales with $1/(\\Delta x^2)$. This scheme correctly translates the high-frequency pressure oscillations into a strong, non-zero divergence signal, enabling a pressure-correction algorithm to effectively suppress this spurious mode.\n\n**3. Accuracy of Velocity Reconstruction**\n\nThe third task is to assess the order of accuracy for reconstructing face velocities from cell-centered values for a smooth field. The reconstruction formula is:\n$$u_{i+1/2,j}^{\\text{rec}} = \\frac{1}{2}\\left(u_{i,j}^{\\text{cc}} + u_{i+1,j}^{\\text{cc}}\\right)$$\nwhere $u_{i,j}^{\\text{cc}} = u(x_i,y_j)$ is the exact velocity sampled at the cell center. The exact value at the face is $u(x_{i+1/2}, y_j)$. We can use Taylor series expansions around the face center $x_{i+1/2}$:\n$$u_{i,j}^{\\text{cc}} = u(x_{i+1/2} - \\Delta x/2, y_j) = u(x_{i+1/2},y_j) - \\frac{\\Delta x}{2} \\frac{\\partial u}{\\partial x} + \\frac{(\\Delta x)^2}{8} \\frac{\\partial^2 u}{\\partial x^2} - O(\\Delta x^3)$$\n$$u_{i+1,j}^{\\text{cc}} = u(x_{i+1/2} + \\Delta x/2, y_j) = u(x_{i+1/2},y_j) + \\frac{\\Delta x}{2} \\frac{\\partial u}{\\partial x} + \\frac{(\\Delta x)^2}{8} \\frac{\\partial^2 u}{\\partial x^2} + O(\\Delta x^3)$$\nAveraging these two expressions yields:\n$$u_{i+1/2,j}^{\\text{rec}} = u(x_{i+1/2},y_j) + \\frac{(\\Delta x)^2}{8} \\frac{\\partial^2 u}{\\partial x^2}(x_{i+1/2},y_j) + O(\\Delta x^4)$$\nThe leading term of the truncation error is proportional to $(\\Delta x)^2$. Therefore, the reconstruction scheme is second-order accurate. The numerical experiment should confirm this by calculating the order of accuracy $p = \\log_2(E_{16}/E_{32})$, where $E_N$ is the $\\ell^2$ error on an $N \\times N$ grid. Since $E_N \\propto (1/N)^2$, we expect $p \\approx \\log_2((1/16)^2 / (1/32)^2) = \\log_2( (32/16)^2 ) = \\log_2(2^2) = 2$.\n\nThe implementation will proceed by discretizing these formulas on uniform grids using `numpy` arrays. Periodic boundary conditions are efficiently handled using `numpy.roll`. The $\\ell^2$ norm of a discrete field $f_{i,j}$ on an $N_x \\times N_y$ grid is computed as $\\sqrt{\\frac{1}{N_x N_y}\\sum_{i,j} f_{i,j}^2}$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef run_divergence_test(Nx, Ny, a):\n    \"\"\"\n    Computes the discrete divergence norm for the two schemes\n    given a checkerboard pressure field.\n    \"\"\"\n    dx = 1.0 / Nx\n    dy = 1.0 / Ny\n\n    # Create the checkerboard pressure field p_ij = (-1)^(i+j)\n    i_indices = np.arange(Nx)\n    j_indices = np.arange(Ny)\n    ii, jj = np.meshgrid(i_indices, j_indices)\n    p = (-1.0)**(ii + jj)\n\n    # --- 1. Naive Collocated Central Scheme ---\n\n    # Compute cell-centered pressure gradients using second-order central differences\n    # dp/dx|_{i,j} = (p_{i+1,j} - p_{i-1,j}) / (2*dx)\n    dpdx_cc = (np.roll(p, -1, axis=1) - np.roll(p, 1, axis=1)) / (2.0 * dx)\n    dpdy_cc = (np.roll(p, -1, axis=0) - np.roll(p, 1, axis=0)) / (2.0 * dy)\n\n    # Compute cell-centered velocities\n    u_cc = -dpdx_cc / a\n    v_cc = -dpdy_cc / a\n\n    # Compute face velocities by averaging cell-centered velocities\n    # u_{i+1/2,j} = 0.5 * (u_{i,j} + u_{i+1,j})\n    u_face_naive = 0.5 * (u_cc + np.roll(u_cc, -1, axis=1))\n    v_face_naive = 0.5 * (v_cc + np.roll(v_cc, -1, axis=0))\n\n    # Compute divergence from face velocities\n    # div_i,j = (u_{i+1/2,j} - u_{i-1/2,j})/dx + (v_{i,j+1/2} - v_{i,j-1/2})/dy\n    div_u_naive = (u_face_naive - np.roll(u_face_naive, 1, axis=1)) / dx\n    div_v_naive = (v_face_naive - np.roll(v_face_naive, 1, axis=0)) / dy\n    div_naive = div_u_naive + div_v_naive\n    \n    # Compute l2 norm of the divergence field\n    norm_naive = np.sqrt(np.mean(div_naive**2))\n\n    # --- 2. Virtual Staggered Reconstruction ---\n\n    # Compute face velocities directly from pressure differences across faces\n    # u_{i+1/2,j} = -1/a * (p_{i+1,j} - p_{i,j})/dx\n    u_face_vs = -1.0/a * (np.roll(p, -1, axis=1) - p) / dx\n    v_face_vs = -1.0/a * (np.roll(p, -1, axis=0) - p) / dy\n\n    # Compute divergence from face velocities\n    div_u_vs = (u_face_vs - np.roll(u_face_vs, 1, axis=1)) / dx\n    div_v_vs = (v_face_vs - np.roll(v_face_vs, 1, axis=0)) / dy\n    div_vs = div_u_vs + div_v_vs\n    \n    # Compute l2 norm of the divergence field\n    norm_vs = np.sqrt(np.mean(div_vs**2))\n\n    return norm_naive, norm_vs\n\ndef run_accuracy_test():\n    \"\"\"\n    Computes the order of accuracy for the face velocity reconstruction.\n    \"\"\"\n    u_func = lambda x, y: np.sin(2.0 * np.pi * x) * np.cos(2.0 * np.pi * y)\n    \n    errors = []\n    resolutions = [16, 32]\n    \n    for N in resolutions:\n        Nx, Ny = N, N\n        dx, dy = 1.0/Nx, 1.0/Ny\n\n        # Cell center coordinates\n        x_cc = (np.arange(Nx) + 0.5) * dx\n        y_cc = (np.arange(Ny) + 0.5) * dy\n        xv_cc, yv_cc = np.meshgrid(x_cc, y_cc)\n\n        # Exact cell-centered velocity\n        u_cc = u_func(xv_cc, yv_cc)\n\n        # Reconstructed face velocity (at x_{i+1/2}, y_j)\n        u_rec = 0.5 * (u_cc + np.roll(u_cc, -1, axis=1))\n\n        # Exact face velocity (at x_{i+1/2}, y_j)\n        # Face centers are at x=(i+1)*dx\n        x_face = (np.arange(Nx) + 1.0) * dx\n        xv_face, yv_face = np.meshgrid(x_face, y_cc) # Note: y is cell-centered\n        u_exact = u_func(xv_face, yv_face)\n\n        # Compute l2 error norm\n        error_field = u_rec - u_exact\n        l2_error = np.sqrt(np.mean(error_field**2))\n        errors.append(l2_error)\n        \n    E16, E32 = errors[0], errors[1]\n    order_p = np.log2(E16 / E32)\n    \n    return order_p\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    test_cases = [\n        {'type': 'divergence', 'Nx': 32, 'Ny': 32, 'a': 1.0},\n        {'type': 'divergence', 'Nx': 16, 'Ny': 16, 'a': 0.5},\n        {'type': 'accuracy'},\n        {'type': 'divergence', 'Nx': 4, 'Ny': 4, 'a': 1.0},\n    ]\n\n    results = []\n    \n    # Test case 1\n    case1 = test_cases[0]\n    norm_naive, norm_vs = run_divergence_test(case1['Nx'], case1['Ny'], case1['a'])\n    result1 = norm_naive < 1e-12 and norm_vs > 1e-3\n    results.append(str(result1))\n\n    # Test case 2\n    case2 = test_cases[1]\n    norm_naive, norm_vs = run_divergence_test(case2['Nx'], case2['Ny'], case2['a'])\n    result2 = norm_naive < 1e-12 and norm_vs > 1e-3\n    results.append(str(result2))\n\n    # Test case 3\n    order_p = run_accuracy_test()\n    result3 = f\"{round(order_p, 6):.6f}\"\n    results.append(result3)\n\n    # Test case 4\n    case4 = test_cases[3]\n    norm_naive, norm_vs = run_divergence_test(case4['Nx'], case4['Ny'], case4['a'])\n    result4 = norm_naive < 1e-12 and norm_vs > 1e-3\n    results.append(str(result4))\n\n    # Final print statement in the exact required format\n    # Convert Python booleans to lowercase 'true'/'false' for the output.\n    output_str = f\"[{','.join(s.lower() if s in ['True', 'False'] else s for s in results)}]\"\n    print(output_str)\n\nsolve()\n```", "id": "3372220"}, {"introduction": "After observing that Rhie-Chow interpolation resolves the decoupling issue, we now investigate the underlying mathematical mechanism. This analytical practice [@problem_id:3372235] uses Fourier analysis to reveal how the method acts as a scale-selective filter, effectively damping high-frequency numerical noise like the checkerboard mode. You will derive the precise scaling required for this filter to work without corrupting the long-wavelength, physically accurate parts of the solution as the grid is refined.", "problem": "Consider a two-dimensional, periodic square domain $[0,1]\\times[0,1]$ with incompressible flow, and let the density be unity. Define a manufactured velocity field and pressure field by\n$$u_{1}(x,y) = \\sin(2\\pi x)\\sin(2\\pi y), \\quad u_{2}(x,y) = \\cos(2\\pi x)\\cos(2\\pi y), \\quad p(x,y) = \\cos(2\\pi x)\\cos(2\\pi y),$$\nwhich are smooth and $(1,1)$-periodic. You may assume the low-Reynolds-number regime where the convective term is negligible, so the governing steady incompressible Stokes equations hold:\n$$-\\nabla p + \\nu \\nabla^{2}\\boldsymbol{u} + \\boldsymbol{f} = \\boldsymbol{0}, \\quad \\nabla \\cdot \\boldsymbol{u} = 0,$$\nwith constant viscosity $\\nu>0$ and a body force $\\boldsymbol{f}(x,y)$ to be determined so that $(\\boldsymbol{u},p)$ is an exact solution.\n\nNow consider a collocated, cell-centered Finite Volume Method (FVM) on a uniform Cartesian grid of spacing $h$, using central differences for diffusive fluxes and face-normal mass fluxes formed by Rhie–Chow momentum interpolation. In widely used implementations of the Rhie–Chow momentum interpolation, the face-normal mass flux contains a pressure-difference-based correction that is equivalent, in the discrete continuity equation, to adding a pressure-smoothing term of the form $-\\kappa(h)\\,\\nabla_{h}^{2} p$, where $\\nabla_{h}^{2}$ denotes the standard five-point discrete Laplacian on the uniform grid and $\\kappa(h)>0$ is an effective, grid-dependent smoothing coefficient induced by the flux construction.\n\nPerform a Fourier-symbol analysis of the discrete Laplacian on this grid to characterize how $-\\kappa(h)\\,\\nabla_{h}^{2} p$ acts on both long-wavelength physical gradients (small wavenumbers) and the pressure checkerboard mode (the highest resolvable wavenumber at the Nyquist limit). Using this characterization, derive the asymptotic scaling requirement for $\\kappa(h)$ as $h\\to 0$ that simultaneously:\n- eliminates the spurious checkerboard mode at the Nyquist wavenumber, and\n- does not overdamp long-wavelength physical pressure gradients in the $h\\to 0$ limit.\n\nAssume $\\kappa(h) = C h^{m}$ with a constant $C>0$ independent of $h$, and determine the unique exponent $m$ that satisfies both criteria. Your final answer must be this exponent $m$ as a single number. No rounding is required, and no physical units should be reported in the final answer.\n\nIn the first part, compute the body force $\\boldsymbol{f}(x,y)$ that makes the given manufactured fields satisfy the steady Stokes equations. In the second part, carry out the Fourier-symbol analysis and derive the required $m$.", "solution": "We begin from the steady incompressible Stokes equations,\n$$-\\nabla p + \\nu \\nabla^{2}\\boldsymbol{u} + \\boldsymbol{f} = \\boldsymbol{0}, \\quad \\nabla \\cdot \\boldsymbol{u} = 0,$$\nwhere $\\boldsymbol{u} = (u_{1},u_{2})$ and $p$ are given as\n$$u_{1}(x,y) = \\sin(2\\pi x)\\sin(2\\pi y), \\quad u_{2}(x,y) = \\cos(2\\pi x)\\cos(2\\pi y), \\quad p(x,y) = \\cos(2\\pi x)\\cos(2\\pi y).$$\n\nFirst, we verify incompressibility. Compute\n$$\\frac{\\partial u_{1}}{\\partial x} = 2\\pi \\cos(2\\pi x)\\sin(2\\pi y), \\quad \\frac{\\partial u_{2}}{\\partial y} = -2\\pi \\cos(2\\pi x)\\sin(2\\pi y),$$\nso\n$$\\nabla \\cdot \\boldsymbol{u} = \\frac{\\partial u_{1}}{\\partial x} + \\frac{\\partial u_{2}}{\\partial y} = 2\\pi \\cos(2\\pi x)\\sin(2\\pi y) - 2\\pi \\cos(2\\pi x)\\sin(2\\pi y) = 0.$$\nThus, the manufactured velocity field is divergence-free.\n\nNext, compute the pressure gradient and the Laplacian of the velocity field. The pressure gradient is\n$$\\nabla p = \\left( \\frac{\\partial p}{\\partial x}, \\frac{\\partial p}{\\partial y} \\right) = \\left( -2\\pi \\sin(2\\pi x)\\cos(2\\pi y), -2\\pi \\cos(2\\pi x)\\sin(2\\pi y) \\right).$$\nFor the velocity Laplacian, compute second derivatives:\n$$\\frac{\\partial^{2} u_{1}}{\\partial x^{2}} = -4\\pi^{2} \\sin(2\\pi x)\\sin(2\\pi y), \\quad \\frac{\\partial^{2} u_{1}}{\\partial y^{2}} = -4\\pi^{2} \\sin(2\\pi x)\\sin(2\\pi y),$$\nso\n$$\\nabla^{2} u_{1} = \\frac{\\partial^{2} u_{1}}{\\partial x^{2}} + \\frac{\\partial^{2} u_{1}}{\\partial y^{2}} = -8\\pi^{2} \\sin(2\\pi x)\\sin(2\\pi y).$$\nSimilarly,\n$$\\frac{\\partial^{2} u_{2}}{\\partial x^{2}} = -4\\pi^{2} \\cos(2\\pi x)\\cos(2\\pi y), \\quad \\frac{\\partial^{2} u_{2}}{\\partial y^{2}} = -4\\pi^{2} \\cos(2\\pi x)\\cos(2\\pi y),$$\nso\n$$\\nabla^{2} u_{2} = -8\\pi^{2} \\cos(2\\pi x)\\cos(2\\pi y).$$\nHence\n$$\\nabla^{2} \\boldsymbol{u} = \\left( -8\\pi^{2} \\sin(2\\pi x)\\sin(2\\pi y),\\; -8\\pi^{2} \\cos(2\\pi x)\\cos(2\\pi y) \\right).$$\n\nPlugging into the Stokes momentum balance,\n$$-\\nabla p + \\nu \\nabla^{2}\\boldsymbol{u} + \\boldsymbol{f} = \\boldsymbol{0} \\quad \\Longrightarrow \\quad \\boldsymbol{f} = \\nabla p - \\nu \\nabla^{2}\\boldsymbol{u}.$$\nTherefore,\n\\begin{align*}\nf_{1}(x,y) &= \\frac{\\partial p}{\\partial x} - \\nu \\nabla^{2} u_{1} = -2\\pi \\sin(2\\pi x)\\cos(2\\pi y) - \\nu\\left( -8\\pi^{2} \\sin(2\\pi x)\\sin(2\\pi y) \\right) \\\\\n&= -2\\pi \\sin(2\\pi x)\\cos(2\\pi y) + 8\\nu\\pi^{2} \\sin(2\\pi x)\\sin(2\\pi y), \\\\\nf_{2}(x,y) &= \\frac{\\partial p}{\\partial y} - \\nu \\nabla^{2} u_{2} = -2\\pi \\cos(2\\pi x)\\sin(2\\pi y) - \\nu\\left( -8\\pi^{2} \\cos(2\\pi x)\\cos(2\\pi y) \\right) \\\\\n&= -2\\pi \\cos(2\\pi x)\\sin(2\\pi y) + 8\\nu\\pi^{2} \\cos(2\\pi x)\\cos(2\\pi y).\n\\end{align*}\nThis body force makes $(\\boldsymbol{u},p)$ satisfy the steady incompressible Stokes equations on the periodic domain.\n\nWe now analyze the Rhie–Chow momentum interpolation on a collocated grid. In such schemes, the face-normal mass flux construction introduces a pressure-difference-based correction that, when inserted into the discrete continuity equation, acts like an added pressure-smoothing term $-\\kappa(h)\\,\\nabla_{h}^{2} p$, where $\\nabla_{h}^{2}$ is the standard five-point discrete Laplacian on the uniform grid of spacing $h$, and $\\kappa(h)>0$ depends only on $h$ (and possibly constant physical parameters encapsulated in $C$ below). We assume a scaling $\\kappa(h) = C h^{m}$ with a constant $C>0$ independent of $h$ and seek $m$ such that two conditions are met as $h \\to 0$:\n- Long-wavelength physical pressure gradients (small wavenumbers) are not overdamped in the continuum limit, which requires the smoothing effect to vanish.\n- The spurious checkerboard mode at the Nyquist wavenumber is suppressed, which requires a nonvanishing damping effect for that mode.\n\nTo make these requirements precise, we perform a Fourier-symbol analysis of the discrete Laplacian. Consider discrete Fourier modes\n$$p_{i,j} = \\exp\\!\\left( \\mathrm{i} (k_{x} i h + k_{y} j h) \\right),$$\nfor integers $i,j$ and wavenumbers $(k_{x},k_{y})$ in the first Brillouin zone. The five-point discrete Laplacian has the Fourier symbol\n$$\\lambda_{h}(k_{x},k_{y}) = \\frac{2\\cos(k_{x} h) - 2}{h^{2}} + \\frac{2\\cos(k_{y} h) - 2}{h^{2}} = -\\frac{4}{h^{2}}\\left( \\sin^{2}\\!\\left(\\frac{k_{x}h}{2}\\right) + \\sin^{2}\\!\\left(\\frac{k_{y}h}{2}\\right) \\right).$$\nTherefore, acting on a Fourier mode, the smoothing term contributes a factor $-\\kappa(h)\\,\\lambda_{h}(k_{x},k_{y})$.\n\nWe now examine two regimes.\n\n1. Small wavenumbers corresponding to long-wavelength physical gradients. For fixed continuous wavenumbers $(k_{x},k_{y})$ independent of $h$, as $h\\to 0$ we have\n$$\\sin^{2}\\!\\left(\\frac{k_{x}h}{2}\\right) \\sim \\left(\\frac{k_{x}h}{2}\\right)^{2}, \\quad \\sin^{2}\\!\\left(\\frac{k_{y}h}{2}\\right) \\sim \\left(\\frac{k_{y}h}{2}\\right)^{2},$$\nand hence\n$$\\lambda_{h}(k_{x},k_{y}) \\sim -\\left( k_{x}^{2} + k_{y}^{2} \\right) \\quad \\text{as } h\\to 0.$$\nThe added smoothing contribution is then asymptotically\n$$-\\kappa(h)\\,\\lambda_{h}(k_{x},k_{y}) \\sim \\kappa(h)\\left( k_{x}^{2} + k_{y}^{2} \\right).$$\nTo avoid overdamping physical gradients in the continuum limit, this contribution must vanish as $h\\to 0$ for any fixed $(k_{x},k_{y})$, which requires\n$$\\lim_{h\\to 0} \\kappa(h) = 0 \\quad \\Longrightarrow \\quad m>0.$$\n\n2. The checkerboard mode at the Nyquist wavenumber. The classical checkerboard alternation on the grid corresponds to the highest resolvable modes with\n$$k_{x} = \\frac{\\pi}{h}, \\quad k_{y} = \\frac{\\pi}{h}.$$\nThen\n$$\\sin^{2}\\!\\left(\\frac{k_{x}h}{2}\\right) = \\sin^{2}\\!\\left(\\frac{\\pi}{2}\\right) = 1, \\quad \\sin^{2}\\!\\left(\\frac{k_{y}h}{2}\\right) = 1,$$\nso\n$$\\lambda_{h}\\!\\left(\\frac{\\pi}{h}, \\frac{\\pi}{h}\\right) = -\\frac{4}{h^{2}}(1+1) = -\\frac{8}{h^{2}}.$$\nThe smoothing contribution for this mode is\n$$-\\kappa(h)\\,\\lambda_{h}\\!\\left(\\frac{\\pi}{h}, \\frac{\\pi}{h}\\right) = \\kappa(h)\\,\\frac{8}{h^{2}} = 8 C\\, h^{m-2}.$$\nTo suppress the checkerboard mode in the $h\\to 0$ limit without sending the damping to infinity (which would imply severe overdamping of the highest-frequency content and potential stiffness), we require the damping contribution to approach a finite, strictly positive constant. This yields\n$$\\lim_{h\\to 0} 8 C\\, h^{m-2} = \\text{finite and } > 0 \\quad \\Longrightarrow \\quad m-2 = 0 \\quad \\Longrightarrow \\quad m = 2.$$\nWith $m=2$ and $C>0$, the checkerboard damping tends to $8C$, a positive constant, ensuring suppression, while for any fixed physical wavenumber $(k_{x},k_{y})$, the smoothing term scales like $\\kappa(h)\\left( k_{x}^{2}+k_{y}^{2}\\right) = C h^{2}\\left( k_{x}^{2}+k_{y}^{2}\\right) \\to 0$ as $h\\to 0$, ensuring no overdamping of physical gradients asymptotically.\n\nIn summary:\n- The manufactured fields satisfy incompressible steady Stokes with the body force\n\\begin{align*}\nf_{1}(x,y) &= -2\\pi \\sin(2\\pi x)\\cos(2\\pi y) + 8\\nu\\pi^{2} \\sin(2\\pi x)\\sin(2\\pi y), \\\\\nf_{2}(x,y) &= -2\\pi \\cos(2\\pi x)\\sin(2\\pi y) + 8\\nu\\pi^{2} \\cos(2\\pi x)\\cos(2\\pi y).\n\\end{align*}\n- The Rhie–Chow-induced pressure smoothing term $-\\kappa(h)\\,\\nabla_{h}^{2}p$ must have $\\kappa(h) = C h^{m}$ with $m=2$ to simultaneously suppress the checkerboard and avoid overdamping long-wavelength physical gradients as $h\\to 0$.\n\nTherefore, the unique exponent is $m=2$.", "answer": "$$\\boxed{2}$$", "id": "3372235"}, {"introduction": "The choice of a spatial discretization scheme has ripple effects throughout the entire numerical method, including its stability over time. This exercise [@problem_id:3372226] explores these consequences by analyzing a system that combines Rhie-Chow interpolation with an explicit time-integration scheme. Through a von Neumann stability analysis, you will determine the maximum allowable time step, revealing the direct link between the pressure-smoothing properties of the coupling scheme and the temporal stability of the simulation.", "problem": "Consider the linearized, inviscid, incompressible momentum and continuity equations for a single spatial dimension, written for the velocity field $u(x,t)$ and pressure field $p(x,t)$ as $u_{t} + U\\,u_{x} = -p_{x}$ and $u_{x} = 0$. To allow explicit time marching on a collocated grid, introduce Artificial Compressibility (AC) with coefficient $\\beta > 0$, replacing the exact continuity by $\\beta\\,p_{t} + u_{x} = 0$. On a uniform collocated grid with spacing $h$, discretize all spatial derivatives using second-order central differences. For pressure-velocity coupling, compute face velocities via the Rhie–Chow interpolation, which in one dimension reduces to the well-tested face formula $u_{j+\\frac{1}{2}} = \\frac{1}{2}\\left(u_{j+1} + u_{j}\\right) - \\gamma\\,\\frac{p_{j+1} - p_{j}}{h}$, where $\\gamma > 0$ represents the inverse of the diagonal of the linearized momentum operator and is treated as a constant. Using these face velocities, the discrete divergence at a cell center becomes $u_{x}\\big|_{j} \\approx \\frac{u_{j+\\frac{1}{2}} - u_{j-\\frac{1}{2}}}{h}$, which introduces a discrete pressure-Laplacian term and yields a continuity equation of the form $\\beta\\,p_{t} + u_{x} - \\gamma\\,p_{xx} = 0$.\n\nAdvance in time by a forward Euler method with step size $\\Delta t$, treating all terms explicitly. Perform a Fourier (von Neumann) stability analysis for the collocated scheme described above, focusing exclusively on the pressure checkerboard mode $p_{j}^{n} \\propto (-1)^{j}$ and $u_{j}^{n} \\propto (-1)^{j}$, which corresponds to the discrete wavenumber $\\theta = k h = \\pi$. Derive the associated single-mode amplification factor and determine the maximum allowable non-dimensional Rhie–Chow diffusion number $\\mathcal{D} = \\frac{\\gamma\\,\\Delta t}{\\beta\\,h^{2}}$ such that the magnitude of the amplification factor does not exceed $1$ for this checkerboard mode under the stated discretizations and coupling.\n\nExpress your final answer as a dimensionless number. If any rounding is necessary, round to four significant figures; otherwise provide an exact value.", "solution": "We perform a von Neumann stability analysis on the given semi-discrete system of equations.\n1.  Momentum: $u_{t} + U u_{x} = -p_{x}$\n2.  Continuity: $\\beta p_{t} + u_{x} - \\gamma p_{xx} = 0$\n\nWe discretize all spatial derivatives using second-order central differences:\n$u_{x}\\big|_j \\approx \\frac{u_{j+1} - u_{j-1}}{2h}$\n$p_{x}\\big|_j \\approx \\frac{p_{j+1} - p_{j-1}}{2h}$\n$p_{xx}\\big|_j \\approx \\frac{p_{j+1} - 2p_j + p_{j-1}}{h^2}$\n\nApplying the forward Euler method for the time derivatives gives the fully discrete update rules:\n$$ \\frac{u_j^{n+1} - u_j^n}{\\Delta t} + U \\left( \\frac{u_{j+1}^n - u_{j-1}^n}{2h} \\right) = - \\left( \\frac{p_{j+1}^n - p_{j-1}^n}{2h} \\right) $$\n$$ \\beta \\left( \\frac{p_j^{n+1} - p_j^n}{\\Delta t} \\right) + \\left( \\frac{u_{j+1}^n - u_{j-1}^n}{2h} \\right) - \\gamma \\left( \\frac{p_{j+1}^n - 2p_j^n + p_{j-1}^n}{h^2} \\right) = 0 $$\n\nRearranging for the values at time step $n+1$:\n$$ u_j^{n+1} = u_j^n - \\frac{U \\Delta t}{2h} (u_{j+1}^n - u_{j-1}^n) - \\frac{\\Delta t}{2h} (p_{j+1}^n - p_{j-1}^n) $$\n$$ p_j^{n+1} = p_j^n - \\frac{\\Delta t}{2\\beta h} (u_{j+1}^n - u_{j-1}^n) + \\frac{\\gamma \\Delta t}{\\beta h^2} (p_{j+1}^n - 2p_j^n + p_{j-1}^n) $$\n\nWe introduce Fourier modes $u_j^n = \\hat{u}^n e^{i j \\theta}$ and $p_j^n = \\hat{p}^n e^{i j \\theta}$, where $\\theta = k h$ is the dimensionless wavenumber. The difference terms transform as follows:\n$$ u_{j+1}^n - u_{j-1}^n = \\hat{u}^n e^{ij\\theta} (e^{i\\theta} - e^{-i\\theta}) = 2i \\sin(\\theta) \\hat{u}^n e^{ij\\theta} $$\n$$ p_{j+1}^n - p_{j-1}^n = \\hat{p}^n e^{ij\\theta} (e^{i\\theta} - e^{-i\\theta}) = 2i \\sin(\\theta) \\hat{p}^n e^{ij\\theta} $$\n$$ p_{j+1}^n - 2p_j^n + p_{j-1}^n = \\hat{p}^n e^{ij\\theta} (e^{i\\theta} - 2 + e^{-i\\theta}) = 2(\\cos(\\theta) - 1) \\hat{p}^n e^{ij\\theta} $$\n\nSubstituting these into the update equations and cancelling the common factor $e^{ij\\theta}$:\n$$ \\hat{u}^{n+1} = \\hat{u}^n - \\frac{U \\Delta t}{h} i \\sin(\\theta) \\hat{u}^n - \\frac{\\Delta t}{h} i \\sin(\\theta) \\hat{p}^n $$\n$$ \\hat{p}^{n+1} = \\hat{p}^n - \\frac{\\Delta t}{\\beta h} i \\sin(\\theta) \\hat{u}^n + \\frac{2\\gamma \\Delta t}{\\beta h^2} (\\cos(\\theta) - 1) \\hat{p}^n $$\n\nThis can be written in matrix form, $\\begin{pmatrix} \\hat{u}^{n+1} \\\\ \\hat{p}^{n+1} \\end{pmatrix} = \\mathbf{G}(\\theta) \\begin{pmatrix} \\hat{u}^{n} \\\\ \\hat{p}^{n} \\end{pmatrix}$, where $\\mathbf{G}(\\theta)$ is the amplification matrix:\n$$\n\\mathbf{G}(\\theta) = \\begin{pmatrix}\n1 - i \\frac{U \\Delta t}{h} \\sin\\theta & -i \\frac{\\Delta t}{h} \\sin\\theta \\\\\n-i \\frac{\\Delta t}{\\beta h} \\sin\\theta & 1 + \\frac{2 \\gamma \\Delta t}{\\beta h^2}(\\cos\\theta - 1)\n\\end{pmatrix}\n$$\n\nThe problem asks to analyze the checkerboard mode, which corresponds to the highest discrete wavenumber, $\\theta = \\pi$. For this mode, we have $\\sin(\\pi) = 0$ and $\\cos(\\pi) = -1$.\nSubstituting these values into the amplification matrix:\n$$\n\\mathbf{G}(\\pi) = \\begin{pmatrix}\n1 - 0 & 0 \\\\\n0 & 1 + \\frac{2 \\gamma \\Delta t}{\\beta h^2}(-1 - 1)\n\\end{pmatrix}\n= \\begin{pmatrix}\n1 & 0 \\\\\n0 & 1 - \\frac{4 \\gamma \\Delta t}{\\beta h^2}\n\\end{pmatrix}\n$$\nThe matrix is diagonal, so the amplification factors (eigenvalues) are the diagonal entries: $\\lambda_1 = 1$ and $\\lambda_2 = 1 - \\frac{4 \\gamma \\Delta t}{\\beta h^2}$. The amplification factor associated with the pressure checkerboard mode is $\\lambda_2$. Let's call it $G_{\\pi}$.\n$$ G_{\\pi} = 1 - \\frac{4 \\gamma \\Delta t}{\\beta h^2} $$\nUsing the definition of the non-dimensional Rhie-Chow diffusion number, $\\mathcal{D} = \\frac{\\gamma \\Delta t}{\\beta h^2}$, we can write the amplification factor as:\n$$ G_{\\pi} = 1 - 4 \\mathcal{D} $$\nFor numerical stability, the magnitude of the amplification factor must not exceed $1$:\n$$ |G_{\\pi}| \\le 1 \\quad \\implies \\quad |1 - 4\\mathcal{D}| \\le 1 $$\nThis inequality is equivalent to the pair of inequalities:\n$$ -1 \\le 1 - 4\\mathcal{D} \\le 1 $$\nWe solve for $\\mathcal{D}$. The right-hand inequality:\n$$ 1 - 4\\mathcal{D} \\le 1 \\implies -4\\mathcal{D} \\le 0 \\implies \\mathcal{D} \\ge 0 $$\nSince $\\gamma$, $\\Delta t$, $\\beta$, and $h^2$ are all positive constants, $\\mathcal{D}$ is inherently positive, so this condition is always satisfied.\nThe left-hand inequality:\n$$ -1 \\le 1 - 4\\mathcal{D} \\implies 4\\mathcal{D} \\le 1 + 1 \\implies 4\\mathcal{D} \\le 2 $$\n$$ \\mathcal{D} \\le \\frac{2}{4} = \\frac{1}{2} $$\nCombining the conditions, the stability requirement for the checkerboard mode is $0 \\le \\mathcal{D} \\le \\frac{1}{2}$. The maximum allowable value for the non-dimensional Rhie-Chow diffusion number $\\mathcal{D}$ is therefore $\\frac{1}{2}$.", "answer": "$$\\boxed{\\frac{1}{2}}$$", "id": "3372226"}]}