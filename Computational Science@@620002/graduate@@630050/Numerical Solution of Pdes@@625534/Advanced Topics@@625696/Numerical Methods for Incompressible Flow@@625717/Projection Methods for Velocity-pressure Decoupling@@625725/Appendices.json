{"hands_on_practices": [{"introduction": "This first exercise focuses on a crucial theoretical aspect of projection methods: their temporal order of accuracy. By performing a consistency analysis on the classic non-incremental (Chorin) and incremental (Temam) projection methods, you will uncover why seemingly small algorithmic changes have a significant impact on the accuracy of the pressure solution [@problem_id:3435342]. This practice reveals the fundamental challenge posed by the artificial pressure boundary condition, a recurring and critical theme in the study and application of projection methods.", "problem": "Consider the unsteady incompressible Stokes equations posed on the unit square domain $\\Omega=(0,1)^{2}$ with homogeneous no-slip boundary conditions:\n$$\n\\partial_{t}\\boldsymbol{u} - \\nu \\Delta \\boldsymbol{u} + \\nabla p = \\boldsymbol{f}, \\qquad \\nabla \\cdot \\boldsymbol{u} = 0 \\quad \\text{in } \\Omega \\times (0,T], \\qquad \\boldsymbol{u}|_{\\partial\\Omega}=\\boldsymbol{0},\n$$\nwhere $\\boldsymbol{u}(\\boldsymbol{x},t)$ is the velocity field, $p(\\boldsymbol{x},t)$ is the pressure, $\\nu>0$ is the kinematic viscosity, and $\\boldsymbol{f}$ is a sufficiently smooth body force chosen so that the exact solution $(\\boldsymbol{u},p)$ is smooth on $\\overline{\\Omega}\\times[0,T]$. Assume a semi-discrete (in time) analysis in which spatial operators and boundary conditions are imposed exactly (i.e., no spatial discretization error). Let $\\Delta t>0$ be the uniform time step and define $t^{n}=n\\Delta t$.\n\nTwo classical projection methods are considered with first-order time stepping:\n\n1. The non-incremental pressure-correction method (Chorin). The method advances from $\\boldsymbol{u}^{n}$ to $\\boldsymbol{u}^{n+1}$ by: first computing an intermediate velocity $\\boldsymbol{v}^{n+1}$ via a backward Euler viscous step without pressure,\n$$\n\\frac{\\boldsymbol{v}^{n+1}-\\boldsymbol{u}^{n}}{\\Delta t} - \\nu \\Delta \\boldsymbol{v}^{n+1} = \\boldsymbol{f}^{n+1}, \\qquad \\boldsymbol{v}^{n+1}|_{\\partial\\Omega}=\\boldsymbol{0},\n$$\nthen solving a scalar Poisson equation for the projection potential $\\phi^{n+1}$,\n$$\n\\Delta \\phi^{n+1} = \\frac{1}{\\Delta t} \\nabla \\cdot \\boldsymbol{v}^{n+1} \\quad \\text{in } \\Omega, \\qquad \\frac{\\partial \\phi^{n+1}}{\\partial n}\\Big|_{\\partial\\Omega}=0,\n$$\nand updating\n$$\n\\boldsymbol{u}^{n+1} = \\boldsymbol{v}^{n+1} - \\Delta t \\nabla \\phi^{n+1}, \\qquad p^{n+1} = \\phi^{n+1}.\n$$\n\n2. The incremental pressure-correction method (Temam). The method advances from $(\\boldsymbol{u}^{n},p^{n})$ by first computing $\\boldsymbol{v}^{n+1}$ via a backward Euler viscous step with the previous pressure,\n$$\n\\frac{\\boldsymbol{v}^{n+1}-\\boldsymbol{u}^{n}}{\\Delta t} - \\nu \\Delta \\boldsymbol{v}^{n+1} + \\nabla p^{n} = \\boldsymbol{f}^{n+1}, \\qquad \\boldsymbol{v}^{n+1}|_{\\partial\\Omega}=\\boldsymbol{0},\n$$\nthen solving for $\\phi^{n+1}$,\n$$\n\\Delta \\phi^{n+1} = \\frac{1}{\\Delta t} \\nabla \\cdot \\boldsymbol{v}^{n+1} \\quad \\text{in } \\Omega, \\qquad \\frac{\\partial \\phi^{n+1}}{\\partial n}\\Big|_{\\partial\\Omega}=0,\n$$\nand updating\n$$\n\\boldsymbol{u}^{n+1} = \\boldsymbol{v}^{n+1} - \\Delta t \\nabla \\phi^{n+1}, \\qquad p^{n+1} = p^{n} + \\phi^{n+1}.\n$$\n\nAssume that $\\boldsymbol{u}$ and $p$ are sufficiently smooth in time and space and that the boundary data are consistent with the Stokes problem, with $\\boldsymbol{u}|_{\\partial\\Omega}=\\boldsymbol{0}$ exactly.\n\nUsing a first-principles consistency and stability reasoning for each scheme, determine the expected temporal orders of accuracy in the $L^{2}(\\Omega)$ norm for the velocity and pressure when $\\Delta t \\to 0$. Let $\\alpha_{C}$ and $\\beta_{C}$ denote the temporal orders for the velocity $\\boldsymbol{u}$ and pressure $p$, respectively, under the Chorin method, and let $\\alpha_{T}$ and $\\beta_{T}$ denote the corresponding orders under the Temam method. Express your final answer as the row matrix $(\\alpha_{C},\\beta_{C},\\alpha_{T},\\beta_{T})$. No rounding is required, and no physical units should be included with the final answer.", "solution": "The temporal orders of accuracy for the velocity and pressure for each projection method are determined by a consistency analysis, which involves calculating the local truncation error of each scheme. The stability of these first-order projection methods is assumed, which, by the Lax-Richtmyer equivalence theorem, implies that the order of the global error is the same as the order of the local truncation error.\n\n**1. Non-incremental Pressure-Correction Method (Chorin)**\n\nThe scheme consists of three steps:\n1.  Viscous step: $\\frac{\\boldsymbol{v}^{n+1}-\\boldsymbol{u}^{n}}{\\Delta t} - \\nu \\Delta \\boldsymbol{v}^{n+1} = \\boldsymbol{f}^{n+1}, \\quad \\boldsymbol{v}^{n+1}|_{\\partial\\Omega}=\\boldsymbol{0}.$\n2.  Poisson equation: $\\Delta \\phi^{n+1} = \\frac{1}{\\Delta t} \\nabla \\cdot \\boldsymbol{v}^{n+1}, \\quad \\frac{\\partial \\phi^{n+1}}{\\partial n}\\Big|_{\\partial\\Omega}=0.$\n3.  Update: $\\boldsymbol{u}^{n+1} = \\boldsymbol{v}^{n+1} - \\Delta t \\nabla \\phi^{n+1}, \\quad p^{n+1} = \\phi^{n+1}.$\n\nThe crucial aspect of this scheme is the treatment of the pressure. The numerical pressure $p^{n+1}$ is set to be the potential $\\phi^{n+1}$. The boundary condition for $\\phi^{n+1}$ is derived by enforcing the no-penetration condition ($\\boldsymbol{u}^{n+1}\\cdot\\boldsymbol{n}=0$) on the boundary. From the update step, $\\boldsymbol{u}^{n+1}\\cdot\\boldsymbol{n} = \\boldsymbol{v}^{n+1}\\cdot\\boldsymbol{n} - \\Delta t \\nabla\\phi^{n+1}\\cdot\\boldsymbol{n}$. Since both $\\boldsymbol{u}^{n+1}$ and $\\boldsymbol{v}^{n+1}$ are zero on the boundary, their normal components are zero. This leads to $\\Delta t \\nabla\\phi^{n+1}\\cdot\\boldsymbol{n} = 0$, which implies the artificial boundary condition $\\frac{\\partial \\phi^{n+1}}{\\partial n} = 0$. Since $p^{n+1} = \\phi^{n+1}$, the scheme implicitly imposes $\\frac{\\partial p^{n+1}}{\\partial n}\\Big|_{\\partial\\Omega}=0$.\n\nLet's compare this to the boundary condition satisfied by the exact pressure $p(\\boldsymbol{x},t)$. By evaluating the exact momentum equation on the boundary $\\partial\\Omega$ where $\\boldsymbol{u}=\\boldsymbol{0}$ (and thus $\\partial_t \\boldsymbol{u} = \\boldsymbol{0}$), we have:\n$$-\\nu \\Delta \\boldsymbol{u} + \\nabla p = \\boldsymbol{f} \\quad \\text{on } \\partial\\Omega.$$\nTaking the dot product with the outward normal vector $\\boldsymbol{n}$ gives the exact Neumann boundary condition for the pressure:\n$$\\frac{\\partial p}{\\partial n} = \\boldsymbol{n} \\cdot (\\boldsymbol{f} + \\nu \\Delta \\boldsymbol{u}) \\quad \\text{on } \\partial\\Omega.$$\nThis expression is generally non-zero. Therefore, the scheme imposes a boundary condition on the pressure that is inconsistent with the exact pressure's boundary condition. The error in the Neumann data is $O(1)$. This $O(1)$ inconsistency creates a numerical boundary layer in the pressure solution. Rigorous analysis shows that this boundary layer has a thickness of $O(\\sqrt{\\nu\\Delta t})$ and leads to a global error in the $L^2(\\Omega)$ norm that scales as $O(\\sqrt{\\Delta t})$. Thus, the order of accuracy for the pressure is $\\beta_C = 1/2$.\n\nNow, let's analyze the velocity error. The local truncation error for the velocity, $\\boldsymbol{e}_{u}^{n+1} = \\boldsymbol{u}_{num}^{n+1} - \\boldsymbol{u}_{exact}(t^{n+1})$, can be analyzed by substituting the exact solution into the scheme. The analysis shows that the intermediate velocity error is $\\boldsymbol{v}^{n+1} - \\boldsymbol{u}(t^{n+1}) = \\Delta t \\nabla p(t^{n+1}) + O((\\Delta t)^2)$. The velocity update is $\\boldsymbol{u}^{n+1} = \\boldsymbol{v}^{n+1} - \\Delta t\\nabla \\phi^{n+1}$. The local error is then:\n$$\\boldsymbol{u}^{n+1} - \\boldsymbol{u}(t^{n+1}) \\approx (\\boldsymbol{v}^{n+1} - \\boldsymbol{u}(t^{n+1})) - \\Delta t \\nabla \\phi^{n+1} \\approx \\Delta t \\nabla p(t^{n+1}) - \\Delta t \\nabla \\phi^{n+1} = \\Delta t \\nabla (p(t^{n+1}) - \\phi^{n+1}).$$\nThe term $\\nabla(p(t^{n+1}) - \\phi^{n+1})$ is the gradient of the pressure error. Even though the pressure error itself is large near the boundary, its gradient is found to be bounded in the $L^2$ norm, i.e., $\\|\\nabla(p - \\phi)\\|_{L^2} = O(1)$. Therefore, the local truncation error for velocity is $O(\\Delta t)$. For a stable scheme, this yields a global velocity accuracy of first order. Thus, $\\alpha_C = 1$.\n\nIn summary, for the non-incremental Chorin method, we have $(\\alpha_C, \\beta_C) = (1, 1/2)$.\n\n**2. Incremental Pressure-Correction Method (Temam)**\n\nThe scheme consists of three steps:\n1.  Viscous step: $\\frac{\\boldsymbol{v}^{n+1}-\\boldsymbol{u}^{n}}{\\Delta t} - \\nu \\Delta \\boldsymbol{v}^{n+1} + \\nabla p^{n} = \\boldsymbol{f}^{n+1}, \\quad \\boldsymbol{v}^{n+1}|_{\\partial\\Omega}=\\boldsymbol{0}.$\n2.  Poisson equation: $\\Delta \\phi^{n+1} = \\frac{1}{\\Delta t} \\nabla \\cdot \\boldsymbol{v}^{n+1}, \\quad \\frac{\\partial \\phi^{n+1}}{\\partial n}\\Big|_{\\partial\\Omega}=0.$\n3.  Update: $\\boldsymbol{u}^{n+1} = \\boldsymbol{v}^{n+1} - \\Delta t \\nabla \\phi^{n+1}, \\quad p^{n+1} = p^{n} + \\phi^{n+1}.$\n\nThe crucial differences are the inclusion of $\\nabla p^n$ in the viscous step and the incremental update of the pressure. Let's analyze the boundary condition for the pressure $p^{n+1}$. As before, the projection requires $\\frac{\\partial\\phi^{n+1}}{\\partial n}=0$. From the pressure update, this implies:\n$$\\frac{\\partial p^{n+1}}{\\partial n}\\Big|_{\\partial\\Omega} = \\frac{\\partial p^{n}}{\\partial n}\\Big|_{\\partial\\Omega} + \\frac{\\partial \\phi^{n+1}}{\\partial n}\\Big|_{\\partial\\Omega} = \\frac{\\partial p^{n}}{\\partial n}\\Big|_{\\partial\\Omega}.$$\nThe scheme imposes a lagged boundary condition on the pressure. Let us evaluate the error in this boundary condition at time $t^{n+1}$. Assuming the numerical solution is accurate at time $t^n$, i.e., $\\frac{\\partial p^n}{\\partial n} \\approx \\frac{\\partial p(t^n)}{\\partial n}$, the error in the Neumann data is:\n$$\\frac{\\partial p^n}{\\partial n} - \\frac{\\partial p(t^{n+1})}{\\partial n} \\approx \\frac{\\partial p(t^n)}{\\partial n} - \\frac{\\partial p(t^{n+1})}{\\partial n} = -\\left( \\frac{\\partial p(t^{n+1})}{\\partial n} - \\frac{\\partial p(t^n)}{\\partial n} \\right) = - \\Delta t \\frac{\\partial}{\\partial t}\\left(\\frac{\\partial p}{\\partial n}\\right) + O((\\Delta t)^2).$$\nThe error in the pressure boundary condition is $O(\\Delta t)$. For an elliptic equation like the pressure Poisson equation, an $O(\\Delta t)$ error in the Neumann data leads to an $O(\\Delta t)$ error in the solution over the entire domain. Thus, the local truncation error for pressure is $O(\\Delta t)$, and the global accuracy is first-order. So, $\\beta_T = 1$.\n\nFor the velocity, we can combine the scheme's equations to find the underlying consistency error. The result is that the incremental scheme is equivalent to a fully coupled backward Euler discretization of the Stokes equations, plus a splitting error term. This splitting error is of the form $\\nu \\Delta t \\Delta(\\nabla(p^{n+1}-p^n))$. Since $p^{n+1}-p^n \\approx \\Delta t \\frac{\\partial p}{\\partial t}$, this splitting error is $O((\\Delta t)^2)$. The dominant temporal error comes from the first-order backward Euler discretization of $\\partial_t\\boldsymbol{u}$, which has a truncation error of $O(\\Delta t)$. Therefore, the total local truncation error for velocity is $O(\\Delta t)$, leading to a first-order accurate velocity solution. Thus, $\\alpha_T = 1$.\n\nIn summary, for the incremental Temam method, we have $(\\alpha_T, \\beta_T) = (1, 1)$.\n\n**Conclusion**\n\nCombining the results for both schemes, the temporal orders of accuracy are:\n-   Chorin's non-incremental method: $(\\alpha_C, \\beta_C) = (1, 1/2)$.\n-   Temam's incremental method: $(\\alpha_T, \\beta_T) = (1, 1)$.\n\nThe final answer is the row matrix $(\\alpha_{C}, \\beta_{C}, \\alpha_{T}, \\beta_{T})$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1 & \\frac{1}{2} & 1 & 1\n\\end{pmatrix}\n}\n$$", "id": "3435342"}, {"introduction": "Theory comes to life through implementation. This practice guides you through building both an incremental (velocity-correction) and a non-incremental (pressure-correction) scheme for the Stokes equations on a periodic domain [@problem_id:3322008]. Using Fourier spectral methods will simplify the spatial calculus, allowing you to focus on the core logic of the projection algorithm—from the predictor step to the Poisson solve and the final correction—and to verify that your implementation correctly enforces the divergence-free constraint.", "problem": "Consider the two-dimensional incompressible Stokes equations on a periodic square domain of side length $L$ with spatial coordinates $(x,y)$, where all quantities are nondimensional:\n$$\n\\frac{\\partial \\mathbf{u}}{\\partial t} = -\\nabla p + \\nu \\nabla^2 \\mathbf{u} + \\mathbf{f}, \\quad \\nabla \\cdot \\mathbf{u} = 0,\n$$\nwith velocity $\\mathbf{u}(x,y,t)$, pressure $p(x,y,t)$, kinematic viscosity $\\nu$, and body force $\\mathbf{f}(x,y,t)$. The objective is to design and implement one time step of two distinct fractional-step projection methods:\n1. A velocity-correction (incremental pressure projection) scheme.\n2. A standard pressure-correction (non-incremental) scheme.\n\nBoth schemes must be derived and implemented starting from the fundamental base of the above governing equations and the Helmholtz decomposition of vector fields (into divergence-free and gradient parts), ensuring the divergence-free constraint at the end of the step. The domain is periodic, so the spatial discretization should respect periodic boundary conditions. Use a Fourier spectral representation (discrete Fourier transform on a uniform grid) to compute spatial derivatives, gradients, divergences, and solve the scalar Poisson problem that arises in the projection.\n\nImplement the following in a single program:\n- Represent the domain as $[0,2\\pi] \\times [0,2\\pi]$ with a uniform $N \\times N$ grid for each test case.\n- Use a single explicit time step from $t^n$ to $t^{n+1} = t^n + \\Delta t$.\n- For the velocity-correction scheme, construct the intermediate velocity by explicitly including the old pressure gradient and then enforce incompressibility via a scalar potential correction. Update the pressure incrementally.\n- For the standard pressure-correction scheme, construct the intermediate velocity without any pressure term, then enforce incompressibility via a scalar pressure solve, and update the pressure non-incrementally.\n- Solve the required periodic Poisson problem in Fourier space by imposing a zero-mean constraint on the pressure (set the zero wavenumber component of pressure to zero).\n- Quantify the following for each test case:\n  1. The $L^2$ norm of the divergence of the corrected velocity from the velocity-correction scheme at $t^{n+1}$.\n  2. The $L^2$ norm of the divergence of the corrected velocity from the pressure-correction scheme at $t^{n+1}$.\n  3. The $L^2$ norm of the difference between the updated pressure and the sum of old pressure plus the scalar correction for the velocity-correction scheme (this evaluates the pressure update formula used by the incremental approach).\n  4. The $L^2$ norm of the difference between the updated pressure and the scalar correction for the pressure-correction scheme (this evaluates the pressure update formula used by the non-incremental approach).\n  5. The $L^2$ norm of the difference between the updated pressures produced by the two schemes.\n\nStart from the following analytic fields at time $t^n$ (all nondimensional), evaluated on the grid:\n- Initial velocity components:\n  $$\n  u_x^n(x,y) = \\sin(x)\\cos(y) + 0.25 \\sin(3x)\\sin(2y), \\quad\n  u_y^n(x,y) = -\\cos(x)\\sin(y) + 0.25 \\cos(2x)\\sin(3y).\n  $$\n- Initial pressure (for nonzero initial pressure cases):\n  $$\n  p^n(x,y) = \\cos(2x)\\sin(y).\n  $$\n  For zero initial pressure cases, use $p^n(x,y) = 0$.\n- Body force:\n  $$\n  f_x(x,y) = 0.1 \\cos(2x)\\cos(2y), \\quad\n  f_y(x,y) = -0.1 \\sin(2x)\\sin(2y).\n  $$\n  For zero-force cases, use $\\mathbf{f}(x,y) = \\mathbf{0}$.\n\nUse the discrete Fourier transform to compute spatial operators. Let $k_x$ and $k_y$ be the angular wavenumbers associated with the discrete Fourier modes on the grid, and use the Fourier relations for gradient, divergence, and Laplacian consistently over the periodic domain. Enforce zero mean for the pressure by setting the Fourier coefficient at the zero wavenumber to $0$.\n\nTest Suite:\nImplement the program for the following four test cases, each specified by the tuple $(N, \\Delta t, \\nu, p\\_zero, f\\_zero)$:\n1. $(32, 0.05, 0.1, \\text{False}, \\text{False})$.\n2. $(32, 0.001, 0.5, \\text{False}, \\text{False})$.\n3. $(32, 0.2, 0.01, \\text{False}, \\text{True})$.\n4. $(32, 0.1, 0.1, \\text{True}, \\text{False})$.\n\nFor each test case:\n- Construct the fields $u_x^n$, $u_y^n$, $p^n$ (either nonzero or zero as specified), and $\\mathbf{f}$ (either nonzero or zero as specified).\n- Perform one time step using both schemes, enforcing incompressibility via the projection.\n- Compute the quantities enumerated above as real numbers.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output a list of five floating-point numbers in the following order:\n$[ \\| \\nabla \\cdot \\mathbf{u}^{n+1}\\|_{2,\\text{vel-corr}}, \\| \\nabla \\cdot \\mathbf{u}^{n+1}\\|_{2,\\text{press-corr}}, \\| p^{n+1} - (p^n + \\phi)\\|_{2,\\text{vel-corr}}, \\| p^{n+1} - \\phi\\|_{2,\\text{press-corr}}, \\| p^{n+1}_{\\text{vel-corr}} - p^{n+1}_{\\text{press-corr}} \\|_{2} ]$,\nthen aggregate all test cases sequentially into a single flat list. For example, the output format is\n$[r_{1,1}, r_{1,2}, r_{1,3}, r_{1,4}, r_{1,5}, r_{2,1}, \\dots, r_{4,5}]$,\nwith each $r_{i,j}$ a floating-point number. No physical units are required since the problem is nondimensional; angles are in radians due to the periodic trigonometric functions on the domain $[0,2\\pi]^2$.", "solution": "The problem requires the implementation and comparison of two fractional-step projection methods for the two-dimensional incompressible Stokes equations on a doubly periodic domain. The spatial discretization will be handled using a Fourier spectral method, which is natural for periodic problems. We will carry out a single time step using an explicit-in-viscosity formulation.\n\nThe governing Stokes equations are:\n$$\n\\frac{\\partial \\mathbf{u}}{\\partial t} = -\\nabla p + \\nu \\nabla^2 \\mathbf{u} + \\mathbf{f} \\quad (1)\n$$\n$$\n\\nabla \\cdot \\mathbf{u} = 0 \\quad (2)\n$$\nwhere $\\mathbf{u}$ is the velocity, $p$ is the pressure, $\\nu$ is the kinematic viscosity, and $\\mathbf{f}$ is a body force. The domain is $[0, 2\\pi] \\times [0, 2\\pi]$.\n\nA semi-discrete form using an explicit Euler method for the viscous and force terms and an implicit pressure gradient is:\n$$\n\\frac{\\mathbf{u}^{n+1} - \\mathbf{u}^n}{\\Delta t} = -\\nabla p^{n+1} + \\nu \\nabla^2 \\mathbf{u}^n + \\mathbf{f}^n\n$$\n$$\n\\nabla \\cdot \\mathbf{u}^{n+1} = 0\n$$\nThis coupled system is solved using projection methods, which decouple the velocity and pressure updates.\n\n**Spatial Discretization: Fourier Spectral Method**\nFor a periodic function on an $N \\times N$ grid, we use the Discrete Fourier Transform (DFT). The spatial derivative operators become algebraic multiplications in Fourier space. Let $\\hat{g}(\\mathbf{k}) = \\mathcal{F}(g(\\mathbf{x}))$ be the DFT of a field $g$, where $\\mathbf{k} = (k_x, k_y)$ is the wavenumber vector.\n- Gradient: $\\mathcal{F}(\\nabla g) = i\\mathbf{k} \\hat{g}$\n- Divergence: $\\mathcal{F}(\\nabla \\cdot \\mathbf{v}) = i\\mathbf{k} \\cdot \\hat{\\mathbf{v}}$\n- Laplacian: $\\mathcal{F}(\\nabla^2 g) = -|\\mathbf{k}|^2 \\hat{g} = -(k_x^2 + k_y^2) \\hat{g}$\n\nThe core of the projection step is solving a Poisson equation of the form $\\nabla^2 \\phi = S$. In Fourier space, this becomes $-|\\mathbf{k}|^2 \\hat{\\phi} = \\hat{S}$, which is solved as $\\hat{\\phi} = -\\hat{S} / |\\mathbf{k}|^2$. For the DC component ($k_x=k_y=0$), $|\\mathbf{k}|^2=0$. A unique solution is obtained by imposing a zero-mean constraint on $\\phi$, which translates to setting its DC Fourier coefficient $\\hat{\\phi}(0,0)=0$. This is consistent as $\\hat{S}(0,0)$ will also be zero for a source term $S$ that is the divergence of a vector field on a periodic domain.\n\n**1. Velocity-Correction (Incremental Pressure) Scheme**\n\nThis scheme incorporates the pressure gradient from the previous time step into the prediction of an intermediate velocity field, $\\mathbf{u}^*$.\n\n**Step 1: Predictor Step.** An intermediate velocity $\\mathbf{u}^*$ is computed by time-stepping the full momentum equation using the old pressure $p^n$:\n$$\n\\frac{\\mathbf{u}^* - \\mathbf{u}^n}{\\Delta t} = -\\nabla p^n + \\nu \\nabla^2 \\mathbf{u}^n + \\mathbf{f}^n\n$$\nIn Fourier space, this is:\n$$\n\\hat{\\mathbf{u}}^* = \\hat{\\mathbf{u}}^n + \\Delta t (-i\\mathbf{k}\\hat{p}^n - \\nu |\\mathbf{k}|^2\\hat{\\mathbf{u}}^n + \\hat{\\mathbf{f}}^n)\n$$\n\n**Step 2: Projection Step.** The field $\\mathbf{u}^*$ is not generally divergence-free. It is projected onto the space of divergence-free fields. This is achieved by finding a scalar potential $\\phi$ such that subtracting its gradient corrects the velocity. The correction is defined by:\n$$\n\\frac{\\mathbf{u}^{n+1} - \\mathbf{u}^*}{\\Delta t} = -\\nabla \\phi\n$$\nEnforcing the incompressibility constraint $\\nabla \\cdot \\mathbf{u}^{n+1} = 0$ on this equation leads to a Poisson equation for $\\phi$:\n$$\n\\nabla^2 \\phi = \\frac{1}{\\Delta t} \\nabla \\cdot \\mathbf{u}^*\n$$\nWe solve this in Fourier space:\n$$\n\\hat{\\phi} = -\\frac{1}{\\Delta t |\\mathbf{k}|^2} (i\\mathbf{k} \\cdot \\hat{\\mathbf{u}}^*)\n$$\nwith $\\hat{\\phi}(0,0) = 0$.\n\n**Step 3: Velocity Correction & Pressure Update.** The final velocity is computed by applying the correction:\n$$\n\\hat{\\mathbf{u}}^{n+1} = \\hat{\\mathbf{u}}^* - \\Delta t (i\\mathbf{k}\\hat{\\phi})\n$$\nThe pressure is updated incrementally:\n$$\np^{n+1} = p^n + \\phi\n$$\nThe problem asks to verify this definition by computing $\\| p^{n+1} - (p^n + \\phi) \\|_{2}$, which should be zero to machine precision.\n\n**2. Standard Pressure-Correction (Non-Incremental) Scheme**\n\nThis classic scheme omits the pressure gradient from the predictor step.\n\n**Step 1: Predictor Step.** An intermediate velocity $\\mathbf{u}^*$ is computed without any pressure term:\n$$\n\\frac{\\mathbf{u}^* - \\mathbf{u}^n}{\\Delta t} = \\nu \\nabla^2 \\mathbf{u}^n + \\mathbf{f}^n\n$$\nIn Fourier space:\n$$\n\\hat{\\mathbf{u}}^* = \\hat{\\mathbf{u}}^n + \\Delta t (-\\nu |\\mathbf{k}|^2\\hat{\\mathbf{u}}^n + \\hat{\\mathbf{f}}^n)\n$$\n\n**Step 2: Projection Step.** The correction step uses a scalar potential, which is now identified with the new pressure $p^{n+1}$ (or a scaled version). The governing equations for the step are:\n$$\n\\frac{\\mathbf{u}^{n+1} - \\mathbf{u}^*}{\\Delta t} = -\\nabla p^{n+1}, \\quad \\nabla \\cdot \\mathbf{u}^{n+1} = 0\n$$\nThis leads to a Poisson equation for the pressure at time $t^{n+1}$:\n$$\n\\nabla^2 p^{n+1} = \\frac{1}{\\Delta t} \\nabla \\cdot \\mathbf{u}^*\n$$\nIn the problem's notation, we solve for a scalar $\\phi$ and then set $p^{n+1}=\\phi$. The solution in Fourier space is:\n$$\n\\hat{\\phi} = \\hat{p}^{n+1} = -\\frac{1}{\\Delta t |\\mathbf{k}|^2} (i\\mathbf{k} \\cdot \\hat{\\mathbf{u}}^*)\n$$\nwith $\\hat{\\phi}(0,0) = 0$.\n\n**Step 3: Velocity Correction & Pressure Update.** The final velocity is:\n$$\n\\hat{\\mathbf{u}}^{n+1} = \\hat{\\mathbf{u}}^* - \\Delta t (i\\mathbf{k}\\hat{p}^{n+1})\n$$\nThe pressure update is non-incremental; the new pressure is simply the potential $\\phi$ found in the projection step:\n$$\np^{n+1} = \\phi\n$$\nThe problem verifies this by asking for $\\| p^{n+1} - \\phi \\|_{2}$.\n\n**Equivalence of the Schemes for Stokes Flow**\nA key insight for this problem is that for the linear Stokes equations with this explicit time-stepping, the two schemes yield identical results for both velocity and pressure, provided the initial pressure field $p^n$ has zero mean. The specified $p^n(x,y) = \\cos(2x)\\sin(y)$ has a mean of zero over the periodic domain. Consequently, all computed norms that check for differences or consistency should be non-zero only due to floating-point numerical errors and should be on the order of machine precision. The final velocity fields from both schemes will be divergence-free to machine precision by construction.\n\n**Implementation Summary**\nFor each test case:\n1. Construct the $N \\times N$ grid, initial fields $\\mathbf{u}^n$, $p^n$, $\\mathbf{f}^n$, and wavenumber arrays $k_x, k_y$.\n2. Compute the 2D DFT of all initial fields.\n3. Execute the predictor, projection, and correction steps for both schemes as described above, performing all calculus operations in Fourier space.\n4. Compute the required five $L^2$ norms. The $L^2$ norm of a discrete field $g_{ij}$ on a grid of size $N \\times N$ over a domain of side length $L=2\\pi$ is calculated as $\\|g\\|_{2} = (L/N)\\sqrt{\\sum_{i,j} |g_{ij}|^2}$.\n5. The results are collected and formatted into a single flat list.", "answer": "```python\nimport numpy as np\n\ndef l2_norm(field, L, N):\n    \"\"\"\n    Computes the discrete L2 norm of a 2D field on a periodic domain of side L.\n    \"\"\"\n    return (L / N) * np.linalg.norm(field)\n\ndef solve_for_test_case(N, dt, nu, p_zero, f_zero):\n    \"\"\"\n    Performs one time step of two projection methods for the 2D Stokes equations.\n    \"\"\"\n    L = 2.0 * np.pi\n    h = L / N\n    \n    # Create grid and wavenumbers\n    x = np.arange(N) * h\n    xx, yy = np.meshgrid(x, x, indexing='ij')\n    \n    k = np.fft.fftfreq(N, d=1.0/N) # integer wavenumbers\n    kx, ky = np.meshgrid(k, k, indexing='ij')\n    k_sq = kx**2 + ky**2\n    \n    # Inverse Laplacian operator in Fourier space (k_sq_inv)\n    # Handle the k=0 case to prevent division by zero, enforcing zero-mean for phi.\n    k_sq_inv = np.zeros_like(k_sq)\n    k_sq_inv[k_sq > 0] = 1.0 / k_sq[k_sq > 0]\n\n    # --- Initial fields ---\n    ux_n = np.sin(xx) * np.cos(yy) + 0.25 * np.sin(3 * xx) * np.sin(2 * yy)\n    uy_n = -np.cos(xx) * np.sin(yy) + 0.25 * np.cos(2 * xx) * np.sin(3 * yy)\n    \n    if p_zero:\n        p_n = np.zeros((N, N))\n    else:\n        p_n = np.cos(2 * xx) * np.sin(yy)\n        \n    if f_zero:\n        fx = np.zeros((N, N))\n        fy = np.zeros((N, N))\n    else:\n        fx = 0.1 * np.cos(2 * xx) * np.cos(2 * yy)\n        fy = -0.1 * np.sin(2 * xx) * np.sin(2 * yy)\n\n    # FFT of initial fields\n    ux_hat_n = np.fft.fft2(ux_n)\n    uy_hat_n = np.fft.fft2(uy_n)\n    p_hat_n = np.fft.fft2(p_n)\n    fx_hat = np.fft.fft2(fx)\n    fy_hat = np.fft.fft2(fy)\n\n    # --- 1. Velocity-Correction (Incremental) Scheme ---\n    \n    # Predictor step\n    rhs_x_hat = -1j * kx * p_hat_n - nu * k_sq * ux_hat_n + fx_hat\n    rhs_y_hat = -1j * ky * p_hat_n - nu * k_sq * uy_hat_n + fy_hat\n    ux_star_hat_vc = ux_hat_n + dt * rhs_x_hat\n    uy_star_hat_vc = uy_hat_n + dt * rhs_y_hat\n    \n    # Poisson solve for phi\n    div_u_star_hat_vc = 1j * kx * ux_star_hat_vc + 1j * ky * uy_star_hat_vc\n    phi_hat_vc = (-1.0 / dt) * div_u_star_hat_vc * k_sq_inv\n    \n    # Velocity correction\n    ux_hat_n1_vc = ux_star_hat_vc - dt * (1j * kx * phi_hat_vc)\n    uy_hat_n1_vc = uy_star_hat_vc - dt * (1j * ky * phi_hat_vc)\n    \n    # Pressure update\n    p_hat_n1_vc = p_hat_n + phi_hat_vc\n    \n    # --- 2. Standard Pressure-Correction (Non-Incremental) Scheme ---\n\n    # Predictor step\n    rhs_x_hat_pc = -nu * k_sq * ux_hat_n + fx_hat\n    rhs_y_hat_pc = -nu * k_sq * uy_hat_n + fy_hat\n    ux_star_hat_pc = ux_hat_n + dt * rhs_x_hat_pc\n    uy_star_hat_pc = uy_hat_n + dt * rhs_y_hat_pc\n    \n    # Poisson solve for phi (which is p^{n+1})\n    div_u_star_hat_pc = 1j * kx * ux_star_hat_pc + 1j * ky * uy_star_hat_pc\n    p_hat_n1_pc = (-1.0 / dt) * div_u_star_hat_pc * k_sq_inv\n    phi_hat_pc = p_hat_n1_pc\n    \n    # Velocity correction\n    ux_hat_n1_pc = ux_star_hat_pc - dt * (1j * kx * p_hat_n1_pc)\n    uy_hat_n1_pc = uy_star_hat_pc - dt * (1j * ky * p_hat_n1_pc)\n    \n    # --- Calculate Metrics ---\n    \n    # 1. Divergence norm for velocity-correction\n    div_u_n1_hat_vc = 1j * kx * ux_hat_n1_vc + 1j * ky * uy_hat_n1_vc\n    div_u_n1_vc = np.fft.ifft2(div_u_n1_hat_vc).real\n    norm1 = l2_norm(div_u_n1_vc, L, N)\n\n    # 2. Divergence norm for pressure-correction\n    div_u_n1_hat_pc = 1j * kx * ux_hat_n1_pc + 1j * ky * uy_hat_n1_pc\n    div_u_n1_pc = np.fft.ifft2(div_u_n1_hat_pc).real\n    norm2 = l2_norm(div_u_n1_pc, L, N)\n    \n    # 3. Pressure update consistency for velocity-correction\n    p_n1_vc = np.fft.ifft2(p_hat_n1_vc).real\n    phi_vc = np.fft.ifft2(phi_hat_vc).real\n    diff3 = p_n1_vc - (p_n + phi_vc)\n    norm3 = l2_norm(diff3, L, N)\n    \n    # 4. Pressure update consistency for pressure-correction\n    p_n1_pc = np.fft.ifft2(p_hat_n1_pc).real\n    phi_pc = np.fft.ifft2(phi_hat_pc).real\n    diff4 = p_n1_pc - phi_pc\n    norm4 = l2_norm(diff4, L, N)\n    \n    # 5. L2 norm of difference between final pressures\n    diff5 = p_n1_vc - p_n1_pc\n    norm5 = l2_norm(diff5, L, N)\n    \n    return [norm1, norm2, norm3, norm4, norm5]\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    test_cases = [\n        # (N, dt, nu, p_zero, f_zero)\n        (32, 0.05, 0.1, False, False),\n        (32, 0.001, 0.5, False, False),\n        (32, 0.2, 0.01, False, True),\n        (32, 0.1, 0.1, True, False)\n    ]\n\n    all_results = []\n    for case in test_cases:\n        N, dt, nu, p_zero, f_zero = case\n        case_results = solve_for_test_case(N, dt, nu, p_zero, f_zero)\n        all_results.extend(case_results)\n\n    # Format the final output string\n    # Using 'g' format for concise representation of very small numbers\n    result_str = ','.join(f\"{r:.16g}\" for r in all_results)\n    print(f\"[{result_str}]\")\n\nsolve()\n```", "id": "3322008"}, {"introduction": "Our theoretical models often assume perfect, instantaneous solutions to linear systems, but practical computation relies on iterative solvers with finite tolerances. This exercise explores the real-world consequences of an inexact pressure Poisson solve, linking the solver's residual to two essential physical properties: the error in mass conservation and the stability of the system's kinetic energy [@problem_id:3435288]. This analysis provides a vital, practical principle for choosing solver tolerances to maintain the simulation's physical fidelity without compromising the overall accuracy of the scheme.", "problem": "Consider the incompressible Navier–Stokes equations in a periodic box with velocity $u$ and pressure $p$. A class of velocity–pressure decoupling methods known as projection methods (for example, the Chorin–Temam scheme) advances one time step by first computing an intermediate velocity $u^{\\ast}$ from the momentum equation and then projecting $u^{\\ast}$ onto the divergence-free subspace by subtracting a discrete gradient. Let $D$ denote a consistent discrete divergence, $G$ a consistent discrete gradient, and $A := D G$ the discrete Laplace operator acting on scalar fields. Assume the discrete operators satisfy the discrete integration-by-parts identity $\\langle A \\phi, \\psi \\rangle = - \\langle G \\phi, G \\psi \\rangle$ for any scalar grid functions $\\phi, \\psi$, where $\\langle \\cdot, \\cdot \\rangle$ is the discrete $L^{2}$ inner product and $\\|\\cdot\\|$ its induced norm. The exact projection step computes $\\phi^{n+1}$ from $A \\phi^{n+1} = D u^{\\ast}$ and sets $u^{n+1} = u^{\\ast} - G \\phi^{n+1}$. In practice, the pressure Poisson equation is solved iteratively to a finite tolerance. Let $\\tilde{\\phi}^{n+1}$ denote the inexact solution returned by the linear solver, with residual $\\rho$ defined by $A \\tilde{\\phi}^{n+1} = D u^{\\ast} + \\rho$. The solver reports a norm-based stopping condition $\\|\\rho\\| \\le \\varepsilon$, where $\\varepsilon$ is the (user-chosen) tolerance. The projected velocity is then $u^{n+1}_{\\text{inc}} := u^{\\ast} - G \\tilde{\\phi}^{n+1}$.\n\nStarting from the governing equations and the operator identities above, analyze how the inexact Poisson solve affects:\n- the discrete divergence residual $\\|D u^{n+1}_{\\text{inc}}\\|$, viewed as a measure of mass conservation error, and\n- the discrete kinetic energy balance, quantified by the difference $\\|u^{n+1}_{\\text{inc}}\\|^{2} - \\|u^{\\ast}\\|^{2}$.\n\nAssume a Poincaré inequality $\\|\\psi\\| \\le C_{P} \\|G \\psi\\|$ holds for scalar fields $\\psi$ of zero mean, with Poincaré constant $C_{P}$ depending only on the domain. The fully discrete scheme has temporal order $p$ and spatial order $q$, so its truncation error scales like $\\mathcal{O}(\\Delta t^{p} + h^{q})$ in $L^{2}$, where $\\Delta t$ is the time step and $h$ a characteristic mesh size. Based on your analysis, select the tolerance criterion that ensures the divergence error introduced by the inexact projection is no larger than the scheme’s truncation error and that the perturbation to the discrete energy balance is of higher order, so stability and mass conservation are preserved at the design accuracy.\n\nWhich of the following tolerance prescriptions is appropriate?\n\nA. Choose the linear solver tolerance so that the absolute residual satisfies $\\|\\rho\\| \\le C \\left( \\Delta t^{p} + h^{q} \\right)$, with a constant $C$ independent of $\\Delta t$ and $h$. Under this choice, the divergence residual is of the same order as the scheme’s truncation error, and the energy defect induced by the inexact projection is $\\mathcal{O}\\!\\left((\\Delta t^{p} + h^{q})^{2}\\right)$.\n\nB. Choose the linear solver tolerance proportional to the time step, $\\|\\rho\\| \\le C \\Delta t$, independent of the mesh size $h$ and of $\\|D u^{\\ast}\\|$. This guarantees exact mass conservation for any grid resolution.\n\nC. Impose a relative residual tolerance $\\|\\rho\\| \\le \\varepsilon_{\\mathrm{rel}} \\|D u^{\\ast}\\|$ with $\\varepsilon_{\\mathrm{rel}} \\le \\frac{1}{2 C_{P}}$. This ensures that the projection step is energy non-increasing regardless of $u^{\\ast}$.\n\nD. Choose the linear solver tolerance so that $\\|\\rho\\| \\le C h^{q}$, ignoring $\\Delta t$. Then the divergence residual vanishes as $h \\to 0$ for fixed $\\Delta t$, which suffices to guarantee stability for any time step.", "solution": "The user requires a critical validation of the problem statement, followed by a detailed derivation and analysis of the options provided.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n*   **System:** Incompressible Navier–Stokes equations in a periodic box.\n*   **Unknowns:** Velocity $u$, pressure $p$.\n*   **Numerical Method:** A projection method for velocity-pressure decoupling.\n*   **Discrete Operators:**\n    *   $D$: a consistent discrete divergence operator.\n    *   $G$: a consistent discrete gradient operator.\n    *   $A := D G$: the discrete Laplace operator on scalar fields.\n*   **Discrete Inner Product and Norm:** $\\langle \\cdot, \\cdot \\rangle$ (discrete $L^2$ inner product) and its induced norm $\\|\\cdot\\|$.\n*   **Operator Identity:** $\\langle A \\phi, \\psi \\rangle = - \\langle G \\phi, G \\psi \\rangle$ for any scalar grid functions $\\phi$ and $\\psi$. This implies $A$ is symmetric and negative semi-definite.\n*   **Exact Projection:**\n    1.  Compute intermediate velocity $u^{\\ast}$.\n    2.  Solve the Poisson equation $A \\phi^{n+1} = D u^{\\ast}$.\n    3.  Update velocity: $u^{n+1} = u^{\\ast} - G \\phi^{n+1}$.\n*   **Inexact Projection:**\n    1.  Solve the Poisson equation inexactly, yielding $\\tilde{\\phi}^{n+1}$.\n    2.  The inexact solution satisfies $A \\tilde{\\phi}^{n+1} = D u^{\\ast} + \\rho$, where $\\rho$ is the residual.\n    3.  The solver terminates when $\\|\\rho\\| \\le \\varepsilon$, where $\\varepsilon$ is the tolerance.\n    4.  The inexactly projected velocity is $u^{n+1}_{\\text{inc}} := u^{\\ast} - G \\tilde{\\phi}^{n+1}$.\n*   **Function Space Property:** A Poincaré inequality $\\|\\psi\\| \\le C_{P} \\|G \\psi\\|$ holds for scalar fields $\\psi$ of zero mean, with a constant $C_P$.\n*   **Scheme Accuracy:** The overall numerical scheme has temporal order $p$ and spatial order $q$, with a truncation error of $\\mathcal{O}(\\Delta t^{p} + h^{q})$ in the $L^2$ norm.\n\n**Step 2: Validate Using Extracted Givens**\n\n*   **Scientifically Grounded:** The problem statement is firmly rooted in the theory of numerical methods for partial differential equations, specifically for computational fluid dynamics. The concepts of projection methods, discrete operators ($D$, $G$, $A$), operator identities, Poisson equations, and truncation error are standard and well-established. The identity $\\langle A \\phi, \\psi \\rangle = - \\langle G \\phi, G \\psi \\rangle$ is a cornerstone of stable finite difference/element methods, reflecting the properties of the continuous operators.\n*   **Well-Posed:** The task is to analyze the consequences of an inexact solve and determine an appropriate solver tolerance. This is a well-defined question in numerical analysis. The provided information is sufficient to perform the required derivations.\n*   **Objective:** The problem is stated using precise, objective mathematical language, free from ambiguity or subjective claims.\n\n**Step 3: Verdict and Action**\n\nThe problem is valid. It is a standard and well-posed question in the numerical analysis of the Navier-Stokes equations. The solution will proceed with the derivation.\n\n### Derivation and Analysis\n\nThe analysis has two main parts: determining the effect of the inexact solve on mass conservation (divergence) and on the kinetic energy balance.\n\n**1. Analysis of the Divergence Residual**\n\nThe goal is to find an expression for $\\|D u^{n+1}_{\\text{inc}}\\|$. We start with the definition of the inexactly projected velocity, $u^{n+1}_{\\text{inc}} = u^{\\ast} - G \\tilde{\\phi}^{n+1}$.\nApplying the discrete divergence operator $D$ to this equation yields:\n$$D u^{n+1}_{\\text{inc}} = D(u^{\\ast} - G \\tilde{\\phi}^{n+1}) = D u^{\\ast} - D G \\tilde{\\phi}^{n+1}$$\nUsing the definition of the discrete Laplacian, $A = DG$, we have:\n$$D u^{n+1}_{\\text{inc}} = D u^{\\ast} - A \\tilde{\\phi}^{n+1}$$\nThe inexactly solved Poisson equation is defined by $A \\tilde{\\phi}^{n+1} = D u^{\\ast} + \\rho$, where $\\rho$ is the solver residual. Substituting this into the previous equation gives:\n$$D u^{n+1}_{\\text{inc}} = D u^{\\ast} - (D u^{\\ast} + \\rho) = - \\rho$$\nTaking the norm of both sides, we arrive at a crucial relationship:\n$$\\|D u^{n+1}_{\\text{inc}}\\| = \\|-\\rho\\| = \\|\\rho\\|$$\nThis result shows that the $L^2$-norm of the divergence error in the final velocity is exactly equal to the $L^2$-norm of the residual from the pressure Poisson solve. For the overall scheme to maintain its designed accuracy, any error source should be controlled to be no larger than the scheme's truncation error. The truncation error is given as $\\mathcal{O}(\\Delta t^{p} + h^{q})$. Therefore, to preserve the formal order of accuracy of the scheme, the divergence error must satisfy:\n$$\\|D u^{n+1}_{\\text{inc}}\\| = \\mathcal{O}(\\Delta t^{p} + h^{q})$$\nThis implies that the solver tolerance $\\varepsilon$ must be set such that the residual norm satisfies:\n$$\\|\\rho\\| \\le C(\\Delta t^{p} + h^{q})$$\nfor some constant $C$ independent of the discretization parameters $\\Delta t$ and $h$.\n\n**2. Analysis of the Discrete Kinetic Energy Balance**\n\nThe goal is to analyze the change in discrete kinetic energy, $\\|u^{n+1}_{\\text{inc}}\\|^{2} - \\|u^{\\ast}\\|^{2}$. We start by expanding the norm of the updated velocity:\n$$\\|u^{n+1}_{\\text{inc}}\\|^{2} = \\|u^{\\ast} - G \\tilde{\\phi}^{n+1}\\|^{2} = \\langle u^{\\ast} - G \\tilde{\\phi}^{n+1}, u^{\\ast} - G \\tilde{\\phi}^{n+1} \\rangle$$\n$$\\|u^{n+1}_{\\text{inc}}\\|^{2} = \\|u^{\\ast}\\|^{2} - 2\\langle u^{\\ast}, G \\tilde{\\phi}^{n+1} \\rangle + \\|G \\tilde{\\phi}^{n+1}\\|^{2}$$\nThe energy change is:\n$$\\|u^{n+1}_{\\text{inc}}\\|^{2} - \\|u^{\\ast}\\|^{2} = - 2\\langle u^{\\ast}, G \\tilde{\\phi}^{n+1} \\rangle + \\|G \\tilde{\\phi}^{n+1}\\|^{2}$$\nA standard property of discrete divergence and gradient operators that are consistent with integration by parts is that they are formal adjoints, satisfying $\\langle v, G \\psi \\rangle = -\\langle D v, \\psi \\rangle$ for vector fields $v$ and scalar fields $\\psi$ (given appropriate boundary conditions, like the periodic ones here). Applying this property:\n$$\\langle u^{\\ast}, G \\tilde{\\phi}^{n+1} \\rangle = -\\langle D u^{\\ast}, \\tilde{\\phi}^{n+1} \\rangle$$\nSubstituting this back into the energy balance equation:\n$$\\|u^{n+1}_{\\text{inc}}\\|^{2} - \\|u^{\\ast}\\|^{2} = 2\\langle D u^{\\ast}, \\tilde{\\phi}^{n+1} \\rangle + \\|G \\tilde{\\phi}^{n+1}\\|^{2}$$\nNow, we use the given identity $\\langle A \\phi, \\psi \\rangle = -\\langle G \\phi, G \\psi \\rangle$. Setting $\\phi = \\psi = \\tilde{\\phi}^{n+1}$, we get $\\|G \\tilde{\\phi}^{n+1}\\|^{2} = -\\langle A \\tilde{\\phi}^{n+1}, \\tilde{\\phi}^{n+1} \\rangle$.\n$$\\|u^{n+1}_{\\text{inc}}\\|^{2} - \\|u^{\\ast}\\|^{2} = 2\\langle D u^{\\ast}, \\tilde{\\phi}^{n+1} \\rangle - \\langle A \\tilde{\\phi}^{n+1}, \\tilde{\\phi}^{n+1} \\rangle$$\nFrom the inexact Poisson solve, we have $D u^{\\ast} = A \\tilde{\\phi}^{n+1} - \\rho$. Substituting this for the first term:\n$$\\|u^{n+1}_{\\text{inc}}\\|^{2} - \\|u^{\\ast}\\|^{2} = 2\\langle A \\tilde{\\phi}^{n+1} - \\rho, \\tilde{\\phi}^{n+1} \\rangle - \\langle A \\tilde{\\phi}^{n+1}, \\tilde{\\phi}^{n+1} \\rangle$$\n$$= 2\\langle A \\tilde{\\phi}^{n+1}, \\tilde{\\phi}^{n+1} \\rangle - 2\\langle \\rho, \\tilde{\\phi}^{n+1} \\rangle - \\langle A \\tilde{\\phi}^{n+1}, \\tilde{\\phi}^{n+1} \\rangle$$\n$$\\|u^{n+1}_{\\text{inc}}\\|^{2} - \\|u^{\\ast}\\|^{2} = \\langle A \\tilde{\\phi}^{n+1}, \\tilde{\\phi}^{n+1} \\rangle - 2\\langle \\rho, \\tilde{\\phi}^{n+1} \\rangle$$\nThis expression still involves the unknown solution $\\tilde{\\phi}^{n+1}$. A more insightful approach is to quantify the \"energy defect\", which is the perturbation to the energy balance caused by the inexactness. Let $\\phi_{err} = \\tilde{\\phi}^{n+1} - \\phi^{n+1}$ be the error in the scalar potential. Subtracting the exact Poisson equation ($A\\phi^{n+1} = Du^*$) from the inexact one ($A\\tilde{\\phi}^{n+1} = Du^* + \\rho$) gives $A \\phi_{err} = \\rho$.\nThe energy defect is the difference in kinetic energy between the inexact and exact projections:\n$$E_{def} = \\|u^{n+1}_{\\text{inc}}\\|^{2} - \\|u^{n+1}\\|^{2} = \\|u^{\\ast} - G\\tilde{\\phi}^{n+1}\\|^{2} - \\|u^{\\ast} - G\\phi^{n+1}\\|^{2}$$\nNote that $u^{n+1}_{\\text{inc}} = u^{\\ast} - G(\\phi^{n+1} + \\phi_{err}) = (u^{\\ast} - G\\phi^{n+1}) - G\\phi_{err} = u^{n+1} - G\\phi_{err}$.\n$$E_{def} = \\|u^{n+1} - G\\phi_{err}\\|^{2} - \\|u^{n+1}\\|^{2}$$\n$$E_{def} = (\\|u^{n+1}\\|^{2} - 2\\langle u^{n+1}, G\\phi_{err} \\rangle + \\|G\\phi_{err}\\|^{2}) - \\|u^{n+1}\\|^{2} = \\|G\\phi_{err}\\|^{2} - 2\\langle u^{n+1}, G\\phi_{err} \\rangle$$\nUsing the adjoint property again, $\\langle u^{n+1}, G\\phi_{err} \\rangle = -\\langle D u^{n+1}, \\phi_{err} \\rangle$. For an exact projection, the resulting velocity field is discretely divergence-free, i.e., $D u^{n+1} = 0$. Thus, the inner product term vanishes: $\\langle u^{n+1}, G\\phi_{err} \\rangle = 0$.\nThe energy defect simplifies to:\n$$E_{def} = \\|G\\phi_{err}\\|^{2}$$\nTo bound this term, we use the error equation $A\\phi_{err} = \\rho$. Taking the inner product with $\\phi_{err}$: $\\langle A\\phi_{err}, \\phi_{err} \\rangle = \\langle \\rho, \\phi_{err} \\rangle$. Using the operator identity gives $-\\|G\\phi_{err}\\|^2 = \\langle \\rho, \\phi_{err} \\rangle$.\nBy the Cauchy-Schwarz and Poincaré inequalities (assuming $\\phi_{err}$ has zero mean, which is a valid assumption for the Poisson equation in a periodic domain):\n$$\\|G\\phi_{err}\\|^{2} = |-\\langle \\rho, \\phi_{err} \\rangle| \\le \\|\\rho\\| \\|\\phi_{err}\\| \\le \\|\\rho\\| C_{P} \\|G\\phi_{err}\\|$$\nAssuming $\\|G\\phi_{err}\\| \\ne 0$, we can divide by it to get $\\|G\\phi_{err}\\| \\le C_{P} \\|\\rho\\|$.\nTherefore, the energy defect is bounded by:\n$$E_{def} = \\|G\\phi_{err}\\|^{2} \\le (C_{P}\\|\\rho\\|)^2 = C_{P}^2 \\|\\rho\\|^2$$\nIf we set the tolerance according to the accuracy requirement, $\\|\\rho\\| = \\mathcal{O}(\\Delta t^{p} + h^{q})$, then the energy defect is:\n$$E_{def} = \\mathcal{O}(\\|\\rho\\|^2) = \\mathcal{O}\\left((\\Delta t^{p} + h^{q})^{2}\\right)$$\nThis is a higher-order term compared to the scheme's truncation error, which is desired for numerical stability.\n\n### Option-by-Option Analysis\n\n*   **A. Choose the linear solver tolerance so that the absolute residual satisfies $\\|\\rho\\| \\le C \\left( \\Delta t^{p} + h^{q} \\right)$, with a constant $C$ independent of $\\Delta t$ and $h$. Under this choice, the divergence residual is of the same order as the scheme’s truncation error, and the energy defect induced by the inexact projection is $\\mathcal{O}\\!\\left((\\Delta t^{p} + h^{q})^{2}\\right)$.**\n    This statement is perfectly consistent with our derivation. First, setting $\\|\\rho\\|$ to be on the order of the truncation error ensures that the divergence error $\\|D u^{n+1}_{\\text{inc}}\\| = \\|\\rho\\|$ matches the scheme's overall accuracy. Second, our analysis shows the energy defect is $\\mathcal{O}(\\|\\rho\\|^2)$, which correctly becomes $\\mathcal{O}((\\Delta t^{p} + h^{q})^{2})$ under this choice of tolerance. This perturbation to the energy is of higher order and does not compromise the stability related to the scheme's designed accuracy.\n    **Verdict: Correct.**\n\n*   **B. Choose the linear solver tolerance proportional to the time step, $\\|\\rho\\| \\le C \\Delta t$, independent of the mesh size $h$ and of $\\|D u^{\\ast}\\|$. This guarantees exact mass conservation for any grid resolution.**\n    This prescription is flawed. The tolerance should scale with the total truncation error, $\\mathcal{O}(\\Delta t^{p} + h^{q})$, not just the temporal component. Furthermore, the claim that it \"guarantees exact mass conservation\" is false. Exact conservation would require $D u^{n+1}_{\\text{inc}} = 0$, which implies $\\|\\rho\\|=0$ (an exact solve), not $\\|\\rho\\| \\le C \\Delta t$.\n    **Verdict: Incorrect.**\n\n*   **C. Impose a relative residual tolerance $\\|\\rho\\| \\le \\varepsilon_{\\mathrm{rel}} \\|D u^{\\ast}\\|$ with $\\varepsilon_{\\mathrm{rel}} \\le \\frac{1}{2 C_{P}}$. This ensures that the projection step is energy non-increasing regardless of $u^{\\ast}$.**\n    This option is misguided. The primary goal of setting the tolerance is to maintain the overall order of accuracy of the numerical scheme. A relative tolerance is not guaranteed to do this; it can be too strict if $\\|D u^{\\ast}\\|$ is small or too loose if $\\|D u^{\\ast}\\|$ is large. The specific claim about ensuring non-increasing energy with the constant $\\frac{1}{2C_P}$ is non-standard and does not follow from a straightforward analysis of the energy balance, which depends on the solution itself. The correct approach balances all error sources against the truncation error.\n    **Verdict: Incorrect.**\n\n*   **D. Choose the linear solver tolerance so that $\\|\\rho\\| \\le C h^{q}$, ignoring $\\Delta t$. Then the divergence residual vanishes as $h \\to 0$ for fixed $\\Delta t$, which suffices to guarantee stability for any time step.**\n    This tolerance criterion is incomplete because it ignores the temporal error component $\\mathcal{O}(\\Delta t^p)$. Similar to option B, it does not correctly balance the error sources. The final assertion that controlling this one error source \"suffices to guarantee stability for any time step\" is a vast overstatement. The stability of the full scheme depends on all its components (e.g., advection, diffusion) and is typically subject to constraints like a CFL condition, especially for explicit or semi-implicit methods.\n    **Verdict: Incorrect.**", "answer": "$$\\boxed{A}$$", "id": "3435288"}]}