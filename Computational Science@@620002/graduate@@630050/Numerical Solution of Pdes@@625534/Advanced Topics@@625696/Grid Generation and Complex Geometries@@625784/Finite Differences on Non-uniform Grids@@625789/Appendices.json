{"hands_on_practices": [{"introduction": "To build robust numerical solvers, we must first master the art of constructing accurate finite difference stencils on arbitrary grids. While uniform grids offer simple, symmetric formulas, real-world applications often demand grid refinement in areas of high activity, leading to non-uniform spacing. This first exercise guides you through the foundational process of deriving a second-order accurate central difference approximation for a first derivative on a three-point non-uniform stencil, a cornerstone technique for discretizing partial differential equations [@problem_id:3394040].", "problem": "Consider a one-dimensional discretization of a Partial Differential Equation (PDE), where a sufficiently smooth function $f(x)$ is sampled at three consecutive, nonuniform nodes $x_{i-1} < x_i < x_{i+1}$. Define the local mesh spacings $h_{-} = x_i - x_{i-1}$ and $h_{+} = x_{i+1} - x_i$, with $h_{-} > 0$ and $h_{+} > 0$. Using only the three function values $f_{i-1} = f(x_{i-1})$, $f_i = f(x_i)$, and $f_{i+1} = f(x_{i+1})$, construct a unique linear combination\n$$a_{-1} f_{i-1} + a_{0} f_i + a_{+1} f_{i+1}$$\nthat provides a consistent approximation to the first derivative $f'(x_i)$ with the maximal algebraic order achievable from these three nodes on a nonuniform grid. Starting from first principles, derive the coefficients $a_{-1}$, $a_0$, and $a_{+1}$ in terms of $h_{-}$ and $h_{+}$, determine the order $p$ of the approximation, and compute the leading truncation error coefficient $C$ in the local expansion\n$$a_{-1} f_{i-1} + a_{0} f_i + a_{+1} f_{i+1} = f'(x_i) + C\\, f^{(3)}(x_i) + \\text{higher-order terms}.$$\nExpress your final answer as a closed-form analytic expression. No rounding is required, and no physical units are involved.", "solution": "We begin from the Taylor series expansions of the smooth function $f(x)$ around the point $x_i$, evaluated at the neighboring nodes $x_{i-1}$ and $x_{i+1}$. Let $h_{-} = x_i - x_{i-1} > 0$ and $h_{+} = x_{i+1} - x_i > 0$. By Taylor's theorem,\n\n$$\nf(x_{i-1}) = f(x_i - h_{-}) = f(x_i) - h_{-} f'(x_i) + \\frac{h_{-}^{2}}{2} f''(x_i) - \\frac{h_{-}^{3}}{6} f^{(3)}(x_i) + \\frac{h_{-}^{4}}{24} f^{(4)}(x_i) + \\cdots,\n$$\n\n\n$$\nf(x_{i+1}) = f(x_i + h_{+}) = f(x_i) + h_{+} f'(x_i) + \\frac{h_{+}^{2}}{2} f''(x_i) + \\frac{h_{+}^{3}}{6} f^{(3)}(x_i) + \\frac{h_{+}^{4}}{24} f^{(4)}(x_i) + \\cdots.\n$$\n\nWe seek coefficients $a_{-1}$, $a_0$, and $a_{+1}$ such that the linear combination\n\n$$\nS = a_{-1} f(x_{i-1}) + a_{0} f(x_i) + a_{+1} f(x_{i+1})\n$$\n\napproximates $f'(x_i)$ with maximal order using only these three points. Substituting the Taylor expansions into $S$ and collecting terms by derivatives of $f$ at $x_i$ yields\n\n$$\nS = (a_{-1} + a_0 + a_{+1}) f(x_i) + \\left(- a_{-1} h_{-} + a_{+1} h_{+}\\right) f'(x_i) + \\left(\\frac{a_{-1} h_{-}^{2}}{2} + \\frac{a_{+1} h_{+}^{2}}{2}\\right) f''(x_i)\n$$\n\n\n$$\n\\quad + \\left(- \\frac{a_{-1} h_{-}^{3}}{6} + \\frac{a_{+1} h_{+}^{3}}{6}\\right) f^{(3)}(x_i) + \\cdots.\n$$\n\nTo achieve consistency with the target derivative $f'(x_i)$, we require the coefficient of $f(x_i)$ to vanish and the coefficient of $f'(x_i)$ to equal $1$. To maximize the algebraic order of accuracy using three points, we further eliminate the $f''(x_i)$ term. This gives a linear system for $a_{-1}$, $a_0$, and $a_{+1}$:\n\n$$\na_{-1} + a_0 + a_{+1} = 0,\n$$\n\n\n$$\n- a_{-1} h_{-} + a_{+1} h_{+} = 1,\n$$\n\n\n$$\n\\frac{a_{-1} h_{-}^{2}}{2} + \\frac{a_{+1} h_{+}^{2}}{2} = 0.\n$$\n\nFrom the third equation, we have $a_{-1} h_{-}^{2} + a_{+1} h_{+}^{2} = 0$, which implies\n\n$$\na_{-1} = - a_{+1} \\frac{h_{+}^{2}}{h_{-}^{2}}.\n$$\n\nSubstituting into the second equation,\n\n$$\n- \\left(- a_{+1} \\frac{h_{+}^{2}}{h_{-}^{2}}\\right) h_{-} + a_{+1} h_{+} = 1 \\quad \\Rightarrow \\quad a_{+1} \\left(\\frac{h_{+}^{2}}{h_{-}} + h_{+}\\right) = 1.\n$$\n\nHence\n\n$$\na_{+1} = \\frac{1}{\\dfrac{h_{+}^{2}}{h_{-}} + h_{+}} = \\frac{h_{-}}{h_{+} (h_{-} + h_{+})}.\n$$\n\nThen\n\n$$\na_{-1} = - a_{+1} \\frac{h_{+}^{2}}{h_{-}^{2}} = - \\frac{h_{+}}{h_{-} (h_{-} + h_{+})}.\n$$\n\nFinally, using $a_0 = - (a_{-1} + a_{+1})$, we obtain\n\n$$\na_0 = \\frac{h_{+}^{2} - h_{-}^{2}}{h_{-} h_{+} (h_{-} + h_{+})}.\n$$\n\nThese coefficients eliminate the $f(x_i)$ and $f''(x_i)$ contributions and normalize the $f'(x_i)$ term to $1$. With three nodes, this is the unique construction that achieves the maximal algebraic order, which is second order. To compute the leading truncation error coefficient, examine the $f^{(3)}(x_i)$ term:\n\n$$\n\\text{leading error term} = \\left(- \\frac{a_{-1} h_{-}^{3}}{6} + \\frac{a_{+1} h_{+}^{3}}{6}\\right) f^{(3)}(x_i).\n$$\n\nSubstitute $a_{-1}$ and $a_{+1}$:\n\n$$\n- \\frac{a_{-1} h_{-}^{3}}{6} = - \\frac{\\left(- \\dfrac{h_{+}}{h_{-} (h_{-} + h_{+})}\\right) h_{-}^{3}}{6} = \\frac{h_{+} h_{-}^{2}}{6 (h_{-} + h_{+})},\n$$\n\n\n$$\n\\frac{a_{+1} h_{+}^{3}}{6} = \\frac{\\left(\\dfrac{h_{-}}{h_{+} (h_{-} + h_{+})}\\right) h_{+}^{3}}{6} = \\frac{h_{-} h_{+}^{2}}{6 (h_{-} + h_{+})}.\n$$\n\nSumming these two contributions gives\n\n$$\n\\frac{h_{+} h_{-}^{2} + h_{-} h_{+}^{2}}{6 (h_{-} + h_{+})} = \\frac{h_{-} h_{+} (h_{-} + h_{+})}{6 (h_{-} + h_{+})} = \\frac{h_{-} h_{+}}{6}.\n$$\n\nTherefore the leading truncation error is\n\n$$\nC\\, f^{(3)}(x_i) \\quad \\text{with} \\quad C = \\frac{h_{-} h_{+}}{6},\n$$\n\nand the approximation is of order $p = 2$, since the error scales like the product $h_{-} h_{+}$, which is $\\mathcal{O}(h^{2})$ under mesh refinement where $h_{-}$ and $h_{+}$ are both proportional to a small parameter $h$. As a consistency check, in the uniform case $h_{-} = h_{+} = h$, these coefficients reduce to $a_{-1} = - \\dfrac{1}{2 h}$, $a_0 = 0$, $a_{+1} = \\dfrac{1}{2 h}$, and $C = \\dfrac{h^{2}}{6}$, which is the classical second-order central difference for $f'(x_i)$ with the correct leading error term.", "answer": "$$\\boxed{\\begin{pmatrix}\n-\\dfrac{h_{+}}{h_{-}\\left(h_{-}+h_{+}\\right)} & \\dfrac{h_{+}^{2}-h_{-}^{2}}{h_{-}h_{+}\\left(h_{-}+h_{+}\\right)} & \\dfrac{h_{-}}{h_{+}\\left(h_{-}+h_{+}\\right)} & 2 & \\dfrac{h_{-}h_{+}}{6}\n\\end{pmatrix}}$$", "id": "3394040"}, {"introduction": "A consistent finite difference scheme does not automatically guarantee a physically meaningful solution. This is especially true for convection-dominated problems, where standard central-difference stencils can produce spurious, non-physical oscillations. In this practice, you will apply non-uniform grid formulas to the convection-diffusion equation and analyze the resulting discrete operator to understand when it fails to satisfy the crucial M-matrix property, leading to such instabilities. This exercise bridges the gap between abstract stencil derivation and the practical stability analysis essential for reliable simulation [@problem_id:3394088].", "problem": "Consider the steady one-dimensional convectionâ€“diffusion boundary value problem\n$$\n-\\nu\\,u''(x)+\\mu\\,u'(x)=f(x),\\quad x\\in(0,L),\n$$\nwith Dirichlet boundary conditions $u(0)=\\ell_0$ and $u(L)=\\ell_L$, where $\\nu>0$ and $\\mu\\in\\mathbb{R}$ are constants. Let $\\{x_i\\}$ be a strictly increasing nonuniform grid with consecutive spacings $h_-:=x_i-x_{i-1}>0$ and $h_+:=x_{i+1}-x_i>0$ at an interior node $x_i$. Discretize $u''(x_i)$ by quadratic interpolation on $\\{x_{i-1},x_i,x_{i+1}\\}$ and $u'(x_i)$ by the three-point central formula on the same nonuniform stencil. This yields a tridiagonal discrete operator row\n$$\na_{i,i-1}\\,u_{i-1}+a_{i,i}\\,u_i+a_{i,i+1}\\,u_{i+1}=b_i,\n$$\nwith coefficients\n$$\na_{i,i-1}=-\\frac{2\\nu}{h_-(h_-+h_+)}-\\mu\\left(\\frac{h_+}{h_-(h_-+h_+)}\\right),\\quad\na_{i,i}=\\frac{2\\nu}{h_-h_+}+\\mu\\left(\\frac{h_+-h_-}{h_-h_+}\\right),\n$$\n$$\na_{i,i+1}=-\\frac{2\\nu}{h_+(h_-+h_+)}+\\mu\\left(\\frac{h_-}{h_+(h_-+h_+)}\\right).\n$$\nHere $b_i$ collects the contributions of $f$ and the boundary conditions at $x_{i-1}$ and $x_{i+1}$.\n\nA real tridiagonal matrix is an $M$-matrix (monotone matrix) if each diagonal entry is positive, each off-diagonal entry is nonpositive, and the matrix is weakly diagonally dominant by rows. Focusing on the local row above, determine precisely for which parameter ranges in $(\\nu,\\mu,h_-,h_+)$ the $M$-matrix conditions are violated at node $x_i$. Then construct a concrete counterexample by specifying a grid and parameters $(\\nu,\\mu)$, boundary values, and a right-hand side $f$ for which the resulting discrete solution exhibits a non-monotone interior undershoot or overshoot (a spurious oscillation).\n\nFinally, define the local upwind cell Peclet number\n$$\n\\mathrm{Pe}_{\\mathrm{up}}:=\\frac{|\\mu|\\,h_{\\mathrm{up}}}{\\nu},\n$$\nwhere $h_{\\mathrm{up}}:=h_-$ if $\\mu>0$ and $h_{\\mathrm{up}}:=h_+$ if $\\mu<0$. What is the exact critical threshold value $\\mathrm{Pe}_{\\star}$ such that the $M$-matrix property is violated whenever $\\mathrm{Pe}_{\\mathrm{up}}>\\mathrm{Pe}_{\\star}$? Give your final answer as a single exact number.", "solution": "We begin from the standard three-point nonuniform-grid formulas derived by Taylor expansion or Lagrange interpolation. On the stencil $\\{x_{i-1},x_i,x_{i+1}\\}$ with $h_-:=x_i-x_{i-1}$ and $h_+:=x_{i+1}-x_i$, the second derivative at $x_i$ is approximated by\n$$\nu''(x_i)\\approx \\frac{2}{h_-(h_-+h_+)}\\,u_{i-1}-\\frac{2}{h_-h_+}\\,u_i+\\frac{2}{h_+(h_-+h_+)}\\,u_{i+1}.\n$$\nThe first derivative at $x_i$ using the three-point central difference on a nonuniform stencil is\n$$\nu'(x_i)\\approx -\\frac{h_+}{h_-(h_-+h_+)}\\,u_{i-1}+\\frac{h_+-h_-}{h_-h_+}\\,u_i+\\frac{h_-}{h_+(h_-+h_+)}\\,u_{i+1}.\n$$\nInserting these into $-\\nu u''+\\mu u'$ gives the row coefficients\n$$\na_{i,i-1}=-\\frac{2\\nu}{h_-(h_-+h_+)}-\\mu\\,\\frac{h_+}{h_-(h_-+h_+)},\\quad\na_{i,i}=\\frac{2\\nu}{h_-h_+}+\\mu\\,\\frac{h_+-h_-}{h_-h_+},\n$$\n$$\na_{i,i+1}=-\\frac{2\\nu}{h_+(h_-+h_+)}+\\mu\\,\\frac{h_-}{h_+(h_-+h_+)}.\n$$\nWe analyze the $M$-matrix conditions for this row.\n\n1. Off-diagonal signs. For an $M$-matrix we require $a_{i,i\\pm 1}\\le 0$.\n- For $a_{i,i-1}$,\n$$\na_{i,i-1}=-\\frac{1}{h_-(h_-+h_+)}\\bigl(2\\nu+\\mu h_+\\bigr).\n$$\nIf $\\mu\\ge 0$ then $2\\nu+\\mu h_+>0$, so $a_{i,i-1}<0$, always acceptable. If $\\mu<0$, then $2\\nu+\\mu h_+$ can become negative; in that case $a_{i,i-1}>0$ and the $M$-matrix condition is violated when\n$$\n2\\nu+\\mu h_+<0\\quad\\Longleftrightarrow\\quad |\\mu|\\,h_+>2\\nu.\n$$\n- For $a_{i,i+1}$,\n$$\na_{i,i+1}=\\frac{1}{h_+(h_-+h_+)}\\bigl(-2\\nu+\\mu h_-\\bigr).\n$$\nIf $\\mu\\le 0$ then $\\mu h_-\\le 0$ and $-2\\nu+\\mu h_-<0$, so $a_{i,i+1}<0$, always acceptable. If $\\mu>0$, then $a_{i,i+1}>0$ precisely when\n$$\n-2\\nu+\\mu h_->0\\quad\\Longleftrightarrow\\quad \\mu\\,h_->2\\nu.\n$$\nThus, in all cases, the off-diagonal that lies in the downwind direction can flip sign and violate the $M$-matrix condition whenever the upwind cell length $h_{\\mathrm{up}}$ satisfies\n$$\n|\\mu|\\,h_{\\mathrm{up}}>2\\nu,\\quad\\text{where}\\quad h_{\\mathrm{up}}=\\begin{cases}\nh_- & \\mu>0,\\\\\nh_+ & \\mu<0.\n\\end{cases}\n$$\n\n2. Diagonal sign and diagonal dominance. The diagonal entry is\n$$\na_{i,i}=\\frac{2\\nu}{h_-h_+}+\\mu\\,\\frac{h_+-h_-}{h_-h_+}.\n$$\nFor moderate advection $|\\mu|\\le \\frac{2\\nu}{\\min\\{h_-,h_+\\}}$, the diagonal remains positive. Moreover, the diffusion contribution alone satisfies weak diagonal dominance with equality:\n$$\n\\frac{2\\nu}{h_-h_+}=\\frac{2\\nu}{h_-(h_-+h_+)}+\\frac{2\\nu}{h_+(h_-+h_+)},\n$$\nwhile the advection contribution to $a_{i,i}$ is the negative of the sum of the advection contributions to $a_{i,i-1}$ and $a_{i,i+1}$, so weak diagonal dominance by rows continues to hold whenever both off-diagonals are nonpositive. Therefore, the loss of the $M$-matrix property is governed by the sign of the downwind off-diagonal, which is precisely the condition derived above.\n\nEquivalently, defining the local upwind Peclet number\n$$\n\\mathrm{Pe}_{\\mathrm{up}}:=\\frac{|\\mu|\\,h_{\\mathrm{up}}}{\\nu},\n$$\nthe $M$-matrix property is violated at node $x_i$ whenever $\\mathrm{Pe}_{\\mathrm{up}}>2$.\n\nCounterexample exhibiting spurious oscillations. Take the grid $\\{x_0,x_1,x_2,x_3\\}=\\{0,1,2,5\\}$, so that at $x_1$ we have $h_- = x_1-x_0=1$ and $h_+=x_2-x_1=1$, and at $x_2$ we have $h_- = x_2-x_1=1$ and $h_+=x_3-x_2=3$. Choose parameters $\\nu=1$ and $\\mu=10$, so that at $x_2$ the upwind spacing is $h_- = 1$ (because $\\mu>0$) and $\\mu h_-=10>2\\nu=2$, violating the $M$-matrix condition. Impose Dirichlet boundary conditions $u(0)=0$ and $u(5)=1$ and take $f\\equiv 0$.\n\nThe two interior equations (for $u_1$ at $x_1$ and $u_2$ at $x_2$) use the coefficients computed above:\n- At $x_1$ with $h_-=1$, $h_+=1$,\n$$\na_{1,0}=-\\frac{2+\\mu}{2}=-6,\\quad a_{1,1}=2,\\quad a_{1,2}=\\frac{\\mu-2}{2}=4.\n$$\n- At $x_2$ with $h_-=1$, $h_+=3$,\n$$\na_{2,1}=-\\frac{2+3\\mu}{4}=-8,\\quad a_{2,2}=\\frac{2}{3}+\\frac{2\\mu}{3}=\\frac{22}{3},\\quad a_{2,3}=\\frac{\\mu-2}{12}=\\frac{2}{3}.\n$$\nWith $f\\equiv 0$, the right-hand sides reduce to boundary contributions:\n$$\n2\\,u_1+4\\,u_2=-a_{1,0}\\,u_0=0,\\qquad -8\\,u_1+\\frac{22}{3}\\,u_2=-a_{2,3}\\,u_3=-\\frac{2}{3}\\cdot 1=-\\frac{2}{3}.\n$$\nSolving the $2\\times 2$ system gives\n$$\nu_1=-2\\,u_2,\\qquad 16\\,u_2+\\frac{22}{3}\\,u_2=-\\frac{2}{3}\\ \\Longrightarrow\\ 70\\,u_2=-2\\ \\Longrightarrow\\ u_2=-\\frac{1}{35},\\quad u_1=\\frac{2}{35}.\n$$\nThe exact solution of the continuous problem with $f\\equiv 0$ and $\\mu,\\nu>0$ is monotone increasing from $0$ to $1$, but the discrete solution exhibits a spurious oscillation: $u_2<0<u_1$, an interior undershoot below the left boundary value $0$ caused by the violation of the $M$-matrix condition.\n\nIn summary, the $M$-matrix property is violated locally when $|\\mu|\\,h_{\\mathrm{up}}>2\\nu$, i.e., when the local upwind Peclet number exceeds the critical threshold\n$$\n\\mathrm{Pe}_{\\star}=2.\n$$\nThis threshold is independent of the mesh ratio $h_+/h_-$; only the upwind spacing $h_{\\mathrm{up}}$ enters.", "answer": "$$\\boxed{2}$$", "id": "3394088"}, {"introduction": "For many physical systems governed by conservation laws, it is paramount that the numerical scheme inherits this property. A powerful method for achieving this is the finite volume approach, which focuses on balancing fluxes across cell boundaries rather than just approximating derivatives at points. This final exercise challenges you to derive a conservative scheme for the diffusion equation on a non-uniform grid by integrating over dual cells. By proving that your scheme conserves a discrete total mass, you will see how this fundamental property dictates the correct long-term equilibrium state of the system, a key feature of physically robust numerical methods [@problem_id:3394092].", "problem": "Consider the linear diffusion partial differential equation (PDE) $u_{t}=\\nu\\,u_{xx}$ with constant diffusivity $\\nu>0$ on a periodic interval $[0,L]$. Let $\\{x_{i}\\}_{i=0}^{N-1}$ be a strictly increasing set of $N$ nodes with periodic wrap-around $x_{i+N}=x_{i}+L$, and denote the nonuniform spacings by $h_{i}=x_{i+1}-x_{i}$ for all $i$ (indices understood modulo $N$). Define midpoints $x_{i+\\frac{1}{2}}=\\frac{x_{i}+x_{i+1}}{2}$ and dual-cell lengths (quadrature weights) $w_{i}=x_{i+\\frac{1}{2}}-x_{i-\\frac{1}{2}}=\\frac{h_{i-1}+h_{i}}{2}$. Using the integral (conservative) form of the PDE over the dual cell $[x_{i-\\frac{1}{2}},x_{i+\\frac{1}{2}}]$, derive a conservative three-point, quadrature-weighted, semi-discrete finite-difference scheme at each node $x_{i}$ of the form\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}\\big(w_{i}u_{i}(t)\\big)=F_{i+\\frac{1}{2}}(t)-F_{i-\\frac{1}{2}}(t),\n$$\nwith a consistent numerical flux $F_{i+\\frac{1}{2}}(t)$ computed only from $u_{i}(t)$, $u_{i+1}(t)$, and $x_{i}$, $x_{i+1}$. Write the resulting scheme explicitly as a three-point stencil for $\\frac{\\mathrm{d}}{\\mathrm{d}t}u_{i}(t)$ in terms of $u_{i-1}(t)$, $u_{i}(t)$, $u_{i+1}(t)$ and the grid spacings.\n\nStarting from the conservation law and your semi-discrete scheme, prove that the quadrature-weighted discrete mass $\\sum_{i=0}^{N-1}w_{i}u_{i}(t)$ is invariant in time for all $t\\ge 0$. Then, using periodic boundary conditions and the strict positivity of $\\nu$, argue that the solution of the semi-discrete ordinary differential equation converges as $t\\to\\infty$ to a spatially constant state $u_{i}(t)\\to c$ independent of $i$. Express the constant $c$ solely in terms of the initial data $\\{u_{i}(0)\\}_{i=0}^{N-1}$ and the quadrature weights $\\{w_{i}\\}_{i=0}^{N-1}$.\n\nProvide the final expression for $c$ as your answer. No numerical evaluation is required; give a closed-form expression. Do not include units.", "solution": "We begin by integrating the PDE $u_t = \\nu u_{xx}$ over the dual cell (or control volume) $[x_{i-1/2}, x_{i+1/2}]$ associated with node $x_i$:\n$$\n\\int_{x_{i-1/2}}^{x_{i+1/2}} u_t(x,t) \\,dx = \\int_{x_{i-1/2}}^{x_{i+1/2}} \\frac{\\partial}{\\partial x} (\\nu u_x(x,t)) \\,dx\n$$\nApplying the Fundamental Theorem of Calculus to the right-hand side and approximating the integral on the left-hand side with a midpoint rule, where $u(x,t) \\approx u_i(t)$ over the cell, we get:\n$$\n\\frac{d}{dt} \\left( u_i(t) \\cdot (x_{i+1/2} - x_{i-1/2}) \\right) = \\left[ \\nu u_x(x,t) \\right]_{x_{i-1/2}}^{x_{i+1/2}} = \\nu u_x(x_{i+1/2},t) - \\nu u_x(x_{i-1/2},t)\n$$\nThe cell width is the quadrature weight $w_i = x_{i+1/2} - x_{i-1/2} = \\frac{h_{i-1}+h_i}{2}$. We approximate the physical flux at the cell faces using a central difference:\n$$\n\\nu u_x(x_{i+1/2},t) \\approx \\nu \\frac{u_{i+1}(t) - u_i(t)}{h_i}\n$$\nLet's define the numerical flux at the interface $x_{i+1/2}$ as $F_{i+1/2}(t) = \\nu \\frac{u_{i+1}(t) - u_i(t)}{h_i}$. The semi-discrete equation becomes:\n$$\n\\frac{d}{dt}(w_i u_i(t)) = F_{i+1/2}(t) - F_{i-1/2}(t)\n$$\nThis is the desired conservative form. Since $w_i$ is constant, we can expand this to get the explicit stencil for $\\frac{d u_i}{dt}$:\n$$\n\\frac{d u_i}{dt} = \\frac{1}{w_i} \\left( \\nu \\frac{u_{i+1} - u_i}{h_i} - \\nu \\frac{u_i - u_{i-1}}{h_{i-1}} \\right) = \\frac{2\\nu}{h_{i-1}+h_i} \\left( \\frac{1}{h_{i-1}}u_{i-1} - \\left(\\frac{1}{h_i}+\\frac{1}{h_{i-1}}\\right)u_i + \\frac{1}{h_i}u_{i+1} \\right)\n$$\n\nTo prove mass conservation, we sum the conservative form over all nodes $i=0, \\dots, N-1$:\n$$\n\\frac{d}{dt} \\sum_{i=0}^{N-1} w_i u_i(t) = \\sum_{i=0}^{N-1} (F_{i+1/2}(t) - F_{i-1/2}(t))\n$$\nThe sum on the right is a telescoping series. Because of the periodic boundary conditions (where indices are taken modulo $N$), every flux $F_{i+1/2}$ that leaves cell $i$ is exactly the flux that enters cell $i+1$. When summed over all cells, all internal fluxes cancel perfectly, and since there are no external boundaries, the total sum is zero. Therefore:\n$$\n\\frac{d}{dt} \\sum_{i=0}^{N-1} w_i u_i(t) = 0\n$$\nThe total discrete mass $M(t) = \\sum_{i=0}^{N-1} w_i u_i(t)$ is invariant in time.\n\nAs $t \\to \\infty$, the diffusion process drives the system to equilibrium, where all gradients vanish. The steady-state solution must therefore be a constant, $u_i(t) \\to c$ for some $c$ independent of $i$.\n\nTo find this constant $c$, we use the conservation of mass: $M(t) = M(0)$ for all $t$.\n$$\nM(\\infty) = \\lim_{t\\to\\infty} \\sum_{i=0}^{N-1} w_i u_i(t) = \\sum_{i=0}^{N-1} w_i \\left( \\lim_{t\\to\\infty} u_i(t) \\right) = \\sum_{i=0}^{N-1} w_i c = c \\sum_{i=0}^{N-1} w_i\n$$\nEquating this to the initial mass $M(0) = \\sum_{i=0}^{N-1} w_i u_i(0)$:\n$$\nc \\sum_{i=0}^{N-1} w_i = \\sum_{i=0}^{N-1} w_i u_i(0) \\implies c = \\frac{\\sum_{i=0}^{N-1} w_i u_i(0)}{\\sum_{i=0}^{N-1} w_i}\n$$", "answer": "$$\n\\boxed{\\frac{\\sum_{i=0}^{N-1} w_{i} u_{i}(0)}{\\sum_{i=0}^{N-1} w_{i}}}\n$$", "id": "3394092"}]}