{"hands_on_practices": [{"introduction": "A primary challenge when applying explicit time-stepping schemes to grids with cut cells is the severe time-step restriction imposed by the smallest cells. This exercise provides a direct, hands-on calculation to experience this instability and to see how a simple stabilization technique, cell merging, effectively resolves the issue. By comparing the results of a naive update with a stabilized one for a simple 1D heat transfer problem, you will gain a quantitative understanding of why such stabilization is crucial for practical simulations [@problem_id:3376330].", "problem": "Consider the one-dimensional, nondimensional heat equation $u_{t}=\\kappa\\,u_{xx}$ with constant diffusivity $\\kappa>0$ on a short segment represented by two finite volume cells, where an immersed solid boundary cuts the left cell into a tiny fluid subcell adjacent to a regular fluid cell. The left cell $C_{0}$ nominally spans $[0,\\Delta x]$, and the right cell $C_{1}$ spans $[\\Delta x,2\\Delta x]$, with uniform grid spacing $\\Delta x$. An immersed boundary intersects $C_{0}$ at position $x_{L}=\\Delta x-\\varepsilon\\,\\Delta x$, leaving a fluid subcell of length $\\ell=\\varepsilon\\,\\Delta x$ adjacent to the face at $x=\\Delta x$. The external right boundary at $x=2\\Delta x$ is subject to a homogeneous Neumann condition. The value of $u$ on the immersed boundary is prescribed by a Dirichlet condition $u(x_{L},t)=u_{b}$, enforced using the Ghost Fluid Method (GFM) in which the diffusive flux at the cut face is computed from a one-sided linear gradient between the cellâ€™s representative value and the boundary value over the geometric distance to the cut face.\n\nYou are given the following nondimensional parameters and initial data:\n- $\\Delta x=1$,\n- $\\varepsilon=0.1$ (so $\\ell=0.1$),\n- $\\kappa=1$,\n- time step $\\Delta t=0.2$ (Forward Euler),\n- $u_{b}=0$ at $x=x_{L}$,\n- initial cell averages $U_{0}^{n}=1$ in $C_{0}$ and $U_{1}^{n}=1$ in $C_{1}$.\n\nGeometric data:\n- The fluid portion of $C_{0}$ occupies $[x_{L},\\Delta x]=[0.9,1]$, so its centroid is at $x_{c,0}=0.95$ and volume (length) $V_{0}=\\ell=0.1$.\n- The regular cell $C_{1}$ occupies $[1,2]$, with centroid $x_{c,1}=1.5$ and volume $V_{1}=1$.\n- Distances from centroids to the interface at $x=1$ are $d_{0}=1-x_{c,0}=0.05$ and $d_{1}=x_{c,1}-1=0.5$. The distance from $x_{c,0}$ to the cut face at $x_{L}$ is $d_{L}=x_{c,0}-x_{L}=0.05$.\n\nTask A (naive explicit update on the cut cell): Using the finite volume method derived from conservation for $u_{t}=\\kappa u_{xx}$, approximate the gradients at faces with linear two-point formulas consistent with nonuniform distances. For the internal face at $x=1$, use the common two-point approximation $\\partial u/\\partial x\\big|_{1} \\approx (U_{1}^{n}-U_{0}^{n})/(d_{0}+d_{1})$. For the immersed boundary face at $x=x_{L}$, enforce the Dirichlet boundary via GFM by taking $\\partial u/\\partial x\\big|_{x_{L}^{+}} \\approx (U_{0}^{n}-u_{b})/d_{L}$. Perform a single Forward Euler step for $C_{0}$ to compute $U_{0,\\text{naive}}^{n+1}$.\n\nTask B (cell-merging stabilized update): Merge $C_{0}$ and $C_{1}$ into a single control volume of length $V_{m}=V_{0}+V_{1}=1.1$. Let the merged average be $U_{m}^{n}=(V_{0}U_{0}^{n}+V_{1}U_{1}^{n})/V_{m}$. The merged centroid is $x_{c,m}=(V_{0}x_{c,0}+V_{1}x_{c,1})/V_{m}$, and the distance from $x_{c,m}$ to the cut face is $d_{m}=x_{c,m}-x_{L}$. Update the merged average by a single Forward Euler step using only external boundary faces:\n- At $x=2$, impose $\\partial u/\\partial x=0$.\n- At $x=x_{L}$, approximate $\\partial u/\\partial x\\big|_{x_{L}^{+}} \\approx (U_{m}^{n}-u_{b})/d_{m}$.\nSet $U_{0,\\text{merge}}^{n+1}:=U_{m}^{n+1}$ as the stabilized cut-cell value after merging.\n\nCompute the scalar difference\n$$\\delta \\;=\\; U_{0,\\text{merge}}^{n+1}\\;-\\;U_{0,\\text{naive}}^{n+1}.$$\nReport $\\delta$ as a dimensionless number, rounded to four significant figures.", "solution": "The problem statement is found to be valid as it is scientifically grounded in the principles of numerical methods for partial differential equations, is well-posed with all necessary information provided, and is expressed in objective, unambiguous language. We can therefore proceed with the solution.\n\nThe problem asks for the difference between two updated values for a cut cell, one computed with a naive explicit method and the other with a stabilized cell-merging method. We address each task sequentially.\n\nFirst, we address Task A: the naive explicit update for the cut cell $C_{0}$. The one-dimensional heat equation is $u_{t}=\\kappa u_{xx}$. Applying the finite volume method to the fluid portion of cell $C_{0}$, which has volume (length) $V_{0}$ and occupies the interval $[x_{L}, \\Delta x]$, we integrate the PDE over this volume:\n$$ \\int_{V_0} u_t \\,dx = \\int_{V_0} \\kappa u_{xx} \\,dx $$\nAssuming the cell average is $U_{0}(t) = \\frac{1}{V_{0}} \\int_{V_0} u(x,t) \\,dx$, the left-hand side becomes $V_{0}\\frac{dU_{0}}{dt}$. The right-hand side becomes, by the fundamental theorem of calculus, $\\kappa u_{x}|_{\\Delta x} - \\kappa u_{x}|_{x_{L}}$. This yields the semi-discrete equation:\n$$ V_{0} \\frac{dU_{0}}{dt} = \\kappa \\left( \\frac{\\partial u}{\\partial x}\\bigg|_{x=\\Delta x} - \\frac{\\partial u}{\\partial x}\\bigg|_{x=x_{L}} \\right) $$\nApplying the Forward Euler time integration scheme with a time step $\\Delta t$, we get the fully discrete update formula:\n$$ U_{0}^{n+1} = U_{0}^{n} + \\frac{\\Delta t \\kappa}{V_{0}} \\left( \\left(\\frac{\\partial u}{\\partial x}\\right)\\bigg|_{x=\\Delta x}^{n} - \\left(\\frac{\\partial u}{\\partial x}\\right)\\bigg|_{x=x_{L}}^{n} \\right) $$\nThe problem specifies the approximations for the spatial derivatives (fluxes):\n- At the internal face $x=\\Delta x=1$: $\\left(\\frac{\\partial u}{\\partial x}\\right)\\big|_{x=\\Delta x}^{n} \\approx \\frac{U_{1}^{n}-U_{0}^{n}}{d_{0}+d_{1}}$\n- At the immersed boundary face $x=x_{L}$: $\\left(\\frac{\\partial u}{\\partial x}\\right)\\big|_{x=x_{L}^{+}}^{n} \\approx \\frac{U_{0}^{n}-u_{b}}{d_{L}}$\n\nWe substitute the given numerical values: $\\Delta x=1$, $\\varepsilon=0.1$, $\\kappa=1$, $\\Delta t=0.2$, $u_{b}=0$, $U_{0}^{n}=1$, $U_{1}^{n}=1$.\nGeometric data: $V_{0}=0.1$, $x_{L}=0.9$, $x_{c,0}=0.95$, $d_{0}=1-x_{c,0}=0.05$, $d_{1}=x_{c,1}-1=0.5$, and $d_{L}=x_{c,0}-x_{L}=0.05$.\n\nFirst, we compute the approximate gradients at step $n$:\n$$ \\left(\\frac{\\partial u}{\\partial x}\\right)\\bigg|_{x=1}^{n} \\approx \\frac{1-1}{0.05+0.5} = \\frac{0}{0.55} = 0 $$\n$$ \\left(\\frac{\\partial u}{\\partial x}\\right)\\bigg|_{x=0.9}^{n} \\approx \\frac{1-0}{0.05} = 20 $$\nNow, we substitute these into the update formula for $U_{0,\\text{naive}}^{n+1}$:\n$$ U_{0,\\text{naive}}^{n+1} = U_{0}^{n} + \\frac{\\Delta t \\kappa}{V_{0}} \\left( 0 - 20 \\right) = 1 + \\frac{0.2 \\times 1}{0.1} \\left(-20\\right) = 1 + 2(-20) = 1 - 40 = -39 $$\nSo, $U_{0,\\text{naive}}^{n+1} = -39$. The large magnitude and negative sign indicate a numerical instability, which is expected for an explicit scheme on a small cut cell with this time step.\n\nNext, we address Task B: the cell-merging stabilized update. The cut cell $C_{0}$ is merged with its neighbor $C_{1}$ to form a single larger control volume $C_{m}$.\nFirst, we determine the properties of the merged cell.\n- Merged volume: $V_{m} = V_{0} + V_{1} = 0.1 + 1 = 1.1$.\n- Merged cell-average at time $n$: $U_{m}^{n} = \\frac{V_{0}U_{0}^{n} + V_{1}U_{1}^{n}}{V_{m}} = \\frac{0.1 \\times 1 + 1 \\times 1}{1.1} = \\frac{1.1}{1.1} = 1$.\n- Merged cell centroid: $x_{c,m} = \\frac{V_{0}x_{c,0} + V_{1}x_{c,1}}{V_{m}} = \\frac{0.1 \\times 0.95 + 1 \\times 1.5}{1.1} = \\frac{0.095 + 1.5}{1.1} = \\frac{1.595}{1.1} = 1.45$.\n- Distance from the merged centroid to the cut face: $d_{m} = x_{c,m} - x_{L} = 1.45 - 0.9 = 0.55$.\n\nThe merged control volume occupies the interval $[x_{L}, 2\\Delta x] = [0.9, 2]$. The finite volume update is performed on this larger cell, using only the fluxes at its external boundaries ($x=x_{L}$ and $x=2$).\n$$ U_{m}^{n+1} = U_{m}^{n} + \\frac{\\Delta t \\kappa}{V_{m}} \\left( \\left(\\frac{\\partial u}{\\partial x}\\right)\\bigg|_{x=2}^{n} - \\left(\\frac{\\partial u}{\\partial x}\\right)\\bigg|_{x=x_{L}}^{n} \\right) $$\nThe boundary conditions for the merged-cell update are:\n- At $x=2$: Homogeneous Neumann condition, $\\frac{\\partial u}{\\partial x} = 0$.\n- At $x=x_{L}$: Ghost Fluid Method approximation, $\\left(\\frac{\\partial u}{\\partial x}\\right)\\big|_{x=x_{L}^{+}}^{n} \\approx \\frac{U_{m}^{n} - u_{b}}{d_{m}}$.\n\nWe compute the required gradient at $x=x_{L}$:\n$$ \\left(\\frac{\\partial u}{\\partial x}\\right)\\bigg|_{x=0.9}^{n} \\approx \\frac{1 - 0}{0.55} = \\frac{1}{0.55} $$\nSubstituting into the update formula for $U_{m}^{n+1}$:\n$$ U_{m}^{n+1} = U_{m}^{n} + \\frac{\\Delta t \\kappa}{V_{m}} \\left( 0 - \\frac{1}{0.55} \\right) = 1 + \\frac{0.2 \\times 1}{1.1} \\left( -\\frac{1}{0.55} \\right) = 1 - \\frac{0.2}{1.1 \\times 0.55} = 1 - \\frac{0.2}{0.605} $$\n$$ U_{m}^{n+1} = 1 - \\frac{200}{605} = 1 - \\frac{40}{121} = \\frac{121 - 40}{121} = \\frac{81}{121} $$\nThe stabilized cut-cell value is set to this merged value: $U_{0,\\text{merge}}^{n+1} = U_{m}^{n+1} = \\frac{81}{121}$.\nNumerically, this is approximately $0.6694214876$.\n\nFinally, we compute the scalar difference $\\delta$:\n$$ \\delta = U_{0,\\text{merge}}^{n+1} - U_{0,\\text{naive}}^{n+1} $$\n$$ \\delta = \\frac{81}{121} - (-39) = 39 + \\frac{81}{121} \\approx 39 + 0.6694214876 = 39.6694214876 $$\nThe problem requires this value rounded to four significant figures. The number is $39.6694...$. The first four significant digits are $3$, $9$, $6$, $6$. The fifth digit is $9$, which is $\\ge 5$, so we round up the fourth digit.\n$$ \\delta \\approx 39.67 $$\nThis result highlights the dramatic difference between the unstable naive update and the stable cell-merging approach for handling small cut cells in explicit time-stepping schemes.", "answer": "$$\n\\boxed{39.67}\n$$", "id": "3376330"}, {"introduction": "Beyond numerical stability, the accuracy of embedded boundary methods hinges on their ability to represent complex geometries and their derivatives. The Ghost Fluid Method is frequently used to model physical discontinuities, such as the pressure jump due to surface tension, which is proportional to interface curvature. This practice explores how the accuracy of this physical model depends critically on the geometric fidelity of the underlying interface reconstruction, tasking you with quantifying the error when using a simple linear approximation versus a more accurate quadratic one [@problem_id:3376339].", "problem": "Consider a two-dimensional incompressible two-phase interface captured by the Volume of Fluid (VOF) method, with pressure coupling via the Ghost Fluid Method (GFM). The GFM imposes a discontinuity in pressure across the interface according to the capillary pressure jump. The jump is given by the Laplace law, which states that the pressure jump equals the surface tension multiplied by the interface curvature. The interface is smooth, and local curvature is computed from a reconstruction of the interface shape within a uniform grid.\n\nFundamental base:\n- Laplace pressure jump: If the interface curvature is $\\,\\kappa\\,$ and the surface tension coefficient is $\\,\\sigma\\,$, then the pressure jump across the interface is $\\,\\Delta p = \\sigma \\kappa\\,$.\n- Curvature of a planar curve parameterized as $\\,y(x)\\,$ is given by\n$$\n\\kappa(x) = \\frac{y''(x)}{\\left(1 + \\left(y'(x)\\right)^2\\right)^{3/2}}.\n$$\n\nInterface configuration:\n- The interface is given analytically as a sinusoid,\n$$\ny(x) = a \\sin\\left( \\frac{2\\pi}{\\lambda} x \\right),\n$$\nwhere $\\,a\\,$ is the amplitude in meters and $\\,\\lambda\\,$ is the wavelength in meters.\n- The spatial domain is periodic in $\\,x\\,$ over one wavelength $\\,\\lambda\\,$.\n- A uniform grid of $\\,N_x\\,$ points samples the interface at locations $\\,x_i = i \\Delta x\\,$ for $\\,i=0,1,\\dots,N_x-1\\,$ with $\\,\\Delta x = \\lambda/N_x\\,$.\n\nReconstruction strategies:\n- Linear interface reconstruction: Approximate the local interface near $\\,x_i\\,$ by a first-degree polynomial,\n$$\ny(x) \\approx \\alpha_i + \\beta_i (x - x_i),\n$$\nwhich yields $y''(x_i) \\approx 0$ and therefore $\\kappa_{\\text{lin}}(x_i) \\approx 0$.\n- Quadratic interface reconstruction: Approximate the local interface near $\\,x_i\\,$ by a second-degree polynomial over a symmetric stencil of five points $\\,\\{x_{i-2}, x_{i-1}, x_{i}, x_{i+1}, x_{i+2}\\}\\,$ using least squares,\n$$\ny(x) \\approx a_{0,i} + a_{1,i} (x - x_i) + a_{2,i} (x - x_i)^2,\n$$\nfrom which\n$$\ny'(x_i) \\approx a_{1,i}, \\quad y''(x_i) \\approx 2 a_{2,i}, \\quad \\kappa_{\\text{quad}}(x_i) \\approx \\frac{2 a_{2,i}}{\\left( 1 + a_{1,i}^2 \\right)^{3/2}}.\n$$\n\nExact curvature:\nFrom the analytic interface, compute $\\,y'(x) = a \\left(\\frac{2\\pi}{\\lambda}\\right) \\cos\\left(\\frac{2\\pi}{\\lambda}x\\right)\\,$ and $\\,y''(x) = -a \\left(\\frac{2\\pi}{\\lambda}\\right)^2 \\sin\\left(\\frac{2\\pi}{\\lambda}x\\right)\\,$ to obtain the exact curvature\n$$\n\\kappa_{\\text{exact}}(x) = \\frac{-a \\left( \\frac{2\\pi}{\\lambda} \\right)^2 \\sin\\left( \\frac{2\\pi}{\\lambda} x \\right)}{\\left(1 + a^2 \\left( \\frac{2\\pi}{\\lambda} \\right)^2 \\cos^2\\left( \\frac{2\\pi}{\\lambda} x \\right) \\right)^{3/2}}.\n$$\n\nPressure jump error quantification:\n- For each grid location $\\,x_i\\,$, compute the exact pressure jump $\\,\\Delta p_{\\text{exact}}(x_i) = \\sigma \\kappa_{\\text{exact}}(x_i)\\,$ in Pascals.\n- Compute the estimated pressure jumps based on reconstruction:\n$$\n\\Delta p_{\\text{lin}}(x_i) = \\sigma \\kappa_{\\text{lin}}(x_i), \\quad \\Delta p_{\\text{quad}}(x_i) = \\sigma \\kappa_{\\text{quad}}(x_i).\n$$\n- Quantify the error via the root-mean-square error (RMSE) across the periodic domain,\n$$\n\\text{RMSE}_{\\text{lin}} = \\sqrt{\\frac{1}{N_x} \\sum_{i=0}^{N_x-1} \\left( \\Delta p_{\\text{lin}}(x_i) - \\Delta p_{\\text{exact}}(x_i) \\right)^2 },\n$$\n$$\n\\text{RMSE}_{\\text{quad}} = \\sqrt{\\frac{1}{N_x} \\sum_{i=0}^{N_x-1} \\left( \\Delta p_{\\text{quad}}(x_i) - \\Delta p_{\\text{exact}}(x_i) \\right)^2 }.\n$$\n\nScientific realism:\nThis setup models the curvature-induced pressure jump that a Ghost Fluid Method would impose across a VOF-reconstructed interface. The linear reconstruction, while standard for Piecewise Linear Interface Calculation (PLIC), cannot represent curvature at leading order, and the quadratic reconstruction captures second derivatives needed for curvature. The resulting error directly quantifies the mis-imposed capillary pressure in Pascals, which affects the numerical solution of partial differential equations governing two-phase incompressible flow.\n\nTest suite:\nFor each test case, the program shall compute $\\,\\text{RMSE}_{\\text{lin}}\\,$ and $\\,\\text{RMSE}_{\\text{quad}}\\,$ in Pascals.\n\n- Test Case $\\,1\\,$ (happy path): $\\,\\sigma = 0.072\\,$ N/m, $\\,\\lambda = 1.0\\,$ m, $\\,a = 0.05\\,$ m, $\\,N_x = 128\\,$.\n- Test Case $\\,2\\,$ (higher curvature amplitude): $\\,\\sigma = 0.072\\,$ N/m, $\\,\\lambda = 1.0\\,$ m, $\\,a = 0.20\\,$ m, $\\,N_x = 128\\,$.\n- Test Case $\\,3\\,$ (higher frequency): $\\,\\sigma = 0.072\\,$ N/m, $\\,\\lambda = 0.25\\,$ m, $\\,a = 0.05\\,$ m, $\\,N_x = 128\\,$.\n- Test Case $\\,4\\,$ (coarser grid resolution): $\\,\\sigma = 0.072\\,$ N/m, $\\,\\lambda = 1.0\\,$ m, $\\,a = 0.05\\,$ m, $\\,N_x = 32\\,$.\n\nAngle units are implicit in the trigonometric functions defined over radians. All lengths are in meters and pressure is in Pascals. Your program must compute and report $\\,\\text{RMSE}_{\\text{lin}}\\,$ and $\\,\\text{RMSE}_{\\text{quad}}\\,$ for each test case.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order\n$$\n\\left[ \\text{RMSE}_{\\text{lin}}^{(1)}, \\text{RMSE}_{\\text{quad}}^{(1)}, \\text{RMSE}_{\\text{lin}}^{(2)}, \\text{RMSE}_{\\text{quad}}^{(2)}, \\text{RMSE}_{\\text{lin}}^{(3)}, \\text{RMSE}_{\\text{quad}}^{(3)}, \\text{RMSE}_{\\text{lin}}^{(4)}, \\text{RMSE}_{\\text{quad}}^{(4)} \\right],\n$$\nwhere the superscript denotes the test case number. Each value must be a floating-point number in Pascals.", "solution": "The problem statement has been critically examined and is determined to be **valid**. It is scientifically grounded in the principles of computational fluid dynamics, mathematically well-posed, self-contained, and free of ambiguity or contradiction. It presents a rigorous and meaningful task in numerical analysis, specifically concerning the accuracy of interface curvature estimation, which is a critical component in the numerical simulation of two-phase flows with surface tension.\n\nThe task is to compute the root-mean-square error (RMSE) of the capillary pressure jump across a sinusoidal interface for two different interface reconstruction methods: linear and quadratic. The solution proceeds by first discretizing the analytical interface, then computing the exact curvature and pressure jump at each grid point. Subsequently, the pressure jump is estimated using each reconstruction method, and the RMSE is calculated by comparing these estimates to the exact values.\n\n**1. Discretization and Exact Solution**\n\nThe domain is a single wavelength $\\,\\lambda\\,$ of the sinusoid, sampled by $\\,N_x\\,$ equidistant points. The grid spacing is $\\,\\Delta x = \\lambda/N_x\\,$, and the grid points are $\\,x_i = i \\Delta x\\,$ for $\\,i=0, 1, \\dots, N_x-1\\,$.\n\nThe interface is defined by $\\,y(x) = a \\sin(kx)\\,$ where $\\,k = 2\\pi/\\lambda\\,$. The exact first and second derivatives are:\n$$\ny'(x) = ak \\cos(kx)\n$$\n$$\ny''(x) = -ak^2 \\sin(kx)\n$$\nThe exact curvature, $\\,\\kappa_{\\text{exact}}(x_i)\\,$, at each grid point $\\,x_i\\,$ is calculated using the provided formula:\n$$\n\\kappa_{\\text{exact}}(x_i) = \\frac{y''(x_i)}{\\left(1 + \\left(y'(x_i)\\right)^2\\right)^{3/2}} = \\frac{-ak^2 \\sin(kx_i)}{\\left(1 + (ak)^2 \\cos^2(kx_i)\\right)^{3/2}}\n$$\nThe exact pressure jump is then $\\,\\Delta p_{\\text{exact}}(x_i) = \\sigma \\kappa_{\\text{exact}}(x_i)\\,$, where $\\,\\sigma\\,$ is the surface tension coefficient.\n\n**2. Linear Reconstruction Error ($\\,\\text{RMSE}_{\\text{lin}}\\,$)**\n\nThe linear interface reconstruction approximates the interface locally with a straight line. This implies that the second derivative, and thus the curvature, is zero.\n$$\n\\kappa_{\\text{lin}}(x_i) = 0 \\implies \\Delta p_{\\text{lin}}(x_i) = \\sigma \\kappa_{\\text{lin}}(x_i) = 0\n$$\nThe error for the linear reconstruction at each point is $\\,\\Delta p_{\\text{lin}}(x_i) - \\Delta p_{\\text{exact}}(x_i) = -\\Delta p_{\\text{exact}}(x_i)\\,$. The RMSE is therefore the root mean square of the exact pressure jump itself:\n$$\n\\text{RMSE}_{\\text{lin}} = \\sqrt{\\frac{1}{N_x} \\sum_{i=0}^{N_x-1} \\left(0 - \\Delta p_{\\text{exact}}(x_i)\\right)^2} = \\sqrt{\\frac{1}{N_x} \\sum_{i=0}^{N_x-1} \\left(\\Delta p_{\\text{exact}}(x_i)\\right)^2}\n$$\n\n**3. Quadratic Reconstruction Error ($\\,\\text{RMSE}_{\\text{quad}}\\,$)**\n\nFor the quadratic reconstruction, the interface near $\\,x_i\\,$ is approximated by a parabola, $\\,y(x) \\approx P_i(x) = a_{0,i} + a_{1,i}(x-x_i) + a_{2,i}(x-x_i)^2\\,$. The coefficients $\\,a_{0,i}\\,$, $\\,a_{1,i}\\,$, and $\\,a_{2,i}\\,$ are determined by a least-squares fit to the true interface values $\\,y_j = y(x_j)\\,$ on a symmetric $\\,5$-point stencil: $\\,\\{x_{i-2}, x_{i-1}, x_i, x_{i+1}, x_{i+2}\\}\\,$. The problem is periodic, so indices are taken modulo $\\,N_x\\,$.\n\nWe seek to find the coefficient vector $\\,\\mathbf{c}_i = [a_{0,i}, a_{1,i}, a_{2,i}]^T\\,$ that minimizes the sum of squared residuals. This is a linear least-squares problem, solved by the normal equations $\\,\\mathbf{A}^T\\mathbf{A}\\mathbf{c}_i = \\mathbf{A}^T\\mathbf{y}_{\\text{stencil},i}\\,$, where $\\,\\mathbf{y}_{\\text{stencil},i} = [y_{i-2}, y_{i-1}, y_i, y_{i+1}, y_{i+2}]^T\\,$ and $\\,\\mathbf{A}\\,$ is the design matrix:\n$$\n\\mathbf{A} = \\begin{pmatrix}\n1 & (x_{i-2}-x_i) & (x_{i-2}-x_i)^2 \\\\\n1 & (x_{i-1}-x_i) & (x_{i-1}-x_i)^2 \\\\\n1 & (x_{i}-x_i)   & (x_{i}-x_i)^2 \\\\\n1 & (x_{i+1}-x_i) & (x_{i+1}-x_i)^2 \\\\\n1 & (x_{i+2}-x_i) & (x_{i+2}-x_i)^2\n\\end{pmatrix} = \\begin{pmatrix}\n1 & -2\\Delta x & 4(\\Delta x)^2 \\\\\n1 & -\\Delta x & (\\Delta x)^2 \\\\\n1 & 0 & 0 \\\\\n1 & \\Delta x & (\\Delta x)^2 \\\\\n1 & 2\\Delta x & 4(\\Delta x)^2\n\\end{pmatrix}\n$$\nThe solution is $\\,\\mathbf{c}_i = (\\mathbf{A}^T\\mathbf{A})^{-1}\\mathbf{A}^T \\mathbf{y}_{\\text{stencil},i}\\,$. The operator matrix $\\,\\mathbf{P} = (\\mathbf{A}^T\\mathbf{A})^{-1}\\mathbf{A}^T\\,$ can be pre-calculated, as it only depends on $\\,\\Delta x\\,$. We are interested in $\\,a_{1,i}\\,$ and $\\,a_{2,i}\\,$, which correspond to the second and third rows of $\\,\\mathbf{P}\\,$. The calculation yields:\n$$\na_{1,i} = \\frac{1}{10\\Delta x}(-2y_{i-2} - y_{i-1} + y_{i+1} + 2y_{i+2})\n$$\n$$\na_{2,i} = \\frac{1}{14(\\Delta x)^2}(2y_{i-2} - y_{i-1} - 2y_i - y_{i+1} + 2y_{i+2})\n$$\nThese stencils are applied to the entire grid of $\\,y_i\\,$ values to obtain a vector of coefficients $\\,a_{1}\\,$ and $\\,a_{2}\\,$ for all grid points. Computationally, this is performed efficiently using vectorized operations with periodic boundary conditions (e.g., using `numpy.roll`).\n\nFrom the quadratic approximation, the derivatives at $\\,x_i\\,$ are estimated as $\\,y'(x_i) \\approx a_{1,i}\\,$ and $\\,y''(x_i) \\approx 2a_{2,i}\\,$. The curvature is then:\n$$\n\\kappa_{\\text{quad}}(x_i) = \\frac{2a_{2,i}}{\\left(1 + a_{1,i}^2\\right)^{3/2}}\n$$\nThe corresponding pressure jump is $\\,\\Delta p_{\\text{quad}}(x_i) = \\sigma \\kappa_{\\text{quad}}(x_i)\\,$.\n\nFinally, the RMSE for the quadratic reconstruction is computed:\n$$\n\\text{RMSE}_{\\text{quad}} = \\sqrt{\\frac{1}{N_x} \\sum_{i=0}^{N_x-1} \\left( \\Delta p_{\\text{quad}}(x_i) - \\Delta p_{\\text{exact}}(x_i) \\right)^2 }\n$$\nThe implementation will compute these quantities for each of the four specified test cases.", "answer": "[0.100140224151,0.000109012411,0.852654326508,0.015053351515,6.408974249673,0.028084013143,0.100140224151,0.002766336582]", "id": "3376339"}, {"introduction": "This practice revisits the small-cell stiffness problem from a more advanced, implicit perspective. While implicit methods are unconditionally stable, their application to cut-cell grids can lead to large, ill-conditioned linear systems. This exercise guides you through implementing an elegant solution using the Schur complement to algebraically eliminate the stiff degrees of freedom associated with cut cells, resulting in a smaller, well-conditioned system for the remaining unknowns. By comparing this approach to solving the full system, you will appreciate how techniques from numerical linear algebra provide powerful and robust tools for handling embedded boundary problems [@problem_id:3376340].", "problem": "Consider the one-dimensional heat equation with Dirichlet boundary conditions on the unit interval. Let the field be represented by $u(x,t)$ satisfying $u_t = \\kappa u_{xx}$ on $x \\in (0,1)$, $t \\ge 0$, with $u(0,t)=0$, $u(1,t)=0$, and initial condition $u(x,0) = \\sin(\\pi x)$. Discretize the spatial domain with $N$ interior points at positions $x_i = i h$ for $i=1,\\dots,N$, where $h = \\frac{1}{N+1}$. Use a first-order backward Euler time integrator with time step $\\Delta t > 0$. Represent the semi-discrete update in matrix form as\n$$\n(M - \\Delta t\\, \\kappa\\, L)\\, u^{n+1} = M\\, u^n,\n$$\nwhere $u^n \\in \\mathbb{R}^N$, $M \\in \\mathbb{R}^{N \\times N}$ is a diagonal mass matrix, and $L \\in \\mathbb{R}^{N \\times N}$ is the standard second difference operator associated with Dirichlet boundary conditions, i.e., $(L u)_i = \\frac{u_{i-1} - 2 u_i + u_{i+1}}{h^2}$ for $i=1,\\dots,N$ with $u_0 = 0$ and $u_{N+1}=0$. Let the diffusivity be $\\kappa = 1$. The matrix $M$ models cut-cells by assigning a small volume fraction to selected entries: for regular cells, set $M_{ii} = 1$, and for cut-cells, set $M_{ii} = \\alpha_i \\in (0,1]$. Small volume fractions $0 < \\alpha_i \\ll 1$ induce small-cell stiffness in explicit schemes; an implicit scheme avoids time step restrictions but may suffer from ill-conditioning and localized stiffness if one attempts to couple small-cell unknowns directly.\n\nYour task is to develop and implement an implicit time integrator that removes small-cell stiffness via Schur complement elimination on the cut-cell unknowns. Proceed as follows without using any pre-derived formulas beyond the definitions above:\n- Start from the backward Euler discretization, fundamental properties of linear systems, and block Gaussian elimination. Partition the unknowns into two sets: the set $A$ of regular cells and the set $B$ of cut-cells with volume fractions $\\{\\alpha_i\\}_{i \\in B}$. Partition the linear system into blocks corresponding to $A$ and $B$.\n- Derive the reduced system on $A$ obtained by eliminating the $B$ unknowns through Schur complement. Carefully justify the algebraic steps and state the conditions under which the elimination is valid. Explain how to reconstruct the eliminated unknowns after solving the reduced system.\n- Design an algorithm to assemble $M$, $L$, the full system matrix $A = M - \\Delta t\\, L$, and the right-hand side, then solve one implicit time step both by the full system and by the Schur complement reduction. Show that both approaches produce the same numerical solution up to numerical error.\n- Discuss the conditioning properties of the reduced system compared to the full system in terms of the spectral condition number. Define the spectral condition number as the $2$-norm condition number of the respective matrices.\n\nInitial condition: set $u^0_i = \\sin(\\pi x_i)$ for $i=1,\\dots,N$.\n\nYou must implement a complete, runnable program that:\n- Constructs $M$, $L$, and $A$ for each test case.\n- Computes $u^{1}$ from $u^{0}$ by solving the full system and by the Schur complement reduced system, then reconstructs the eliminated cut-cell unknowns.\n- Computes two quantities per test case:\n  1. The maximum absolute difference between the two $u^{1}$ solutions (full versus Schur complement), defined as $\\max_i |u^{1,\\text{full}}_i - u^{1,\\text{schur}}_i|$, as a float.\n  2. The condition number reduction factor defined as $\\frac{\\kappa_2(A)}{\\kappa_2(S)}$, where $\\kappa_2(\\cdot)$ denotes the $2$-norm condition number, $A$ is the full system matrix, and $S$ is the Schur complement of the eliminated block. If there are no cut-cells (i.e., the set $B$ is empty), define the reduction factor to be $1$.\n\nYour program must use the following test suite, which covers typical, boundary, and edge cases. In each case, $\\kappa = 1$, $u^0_i = \\sin(\\pi x_i)$, and Dirichlet boundary values are $0$:\n- Test case $1$: $N=50$, $\\Delta t = 0.5$, cut-cell set $B = \\{25\\}$ with $\\alpha_{25} = 10^{-3}$.\n- Test case $2$: $N=50$, $\\Delta t = 0.5$, no cut-cells, i.e., $B = \\emptyset$.\n- Test case $3$: $N=80$, $\\Delta t = 2.0$, cut-cell set $B = \\{10,40,70\\}$ with $\\alpha_{10} = \\alpha_{40} = \\alpha_{70} = 10^{-4}$.\n- Test case $4$: $N=100$, $\\Delta t = 10.0$, cut-cell set $B = \\{1\\}$ with $\\alpha_{1} = 10^{-8}$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated flat list enclosed in square brackets, ordered as $[\\text{err}_1,\\text{ratio}_1,\\text{err}_2,\\text{ratio}_2,\\text{err}_3,\\text{ratio}_3,\\text{err}_4,\\text{ratio}_4]$, where $\\text{err}_k$ is the maximum absolute difference for test case $k$ and $\\text{ratio}_k$ is the condition number reduction factor for test case $k$. All values must be floats. No additional text should be printed.", "solution": "The user-provided problem is assessed to be valid. It is scientifically grounded in the fields of numerical analysis and linear algebra, is well-posed with a clear objective, and is free of any invalidating flaws. A complete solution is therefore provided.\n\nThe problem requires the derivation and implementation of a Schur complement-based implicit time-stepping method for the one-dimensional heat equation, $u_t = \\kappa u_{xx}$, on a domain with cut-cells. The goal is to mitigate the ill-conditioning introduced by small-volume cut-cells.\n\nThe backward Euler discretization of the heat equation yields a linear system to be solved at each time step, $n+1$:\n$$\n(M - \\Delta t\\, \\kappa\\, L)\\, u^{n+1} = M\\, u^n\n$$\nwhere $u^{n+1}$ is the vector of unknown temperatures at the new time step, $u^n$ is the solution from the previous step, $\\Delta t$ is the time step size, and $\\kappa$ is the thermal diffusivity. The matrix $M$ is the mass matrix, which is diagonal. For regular grid cells, its diagonal entries are $1$; for cut-cells, they are small volume fractions $\\alpha_i \\in (0,1)$. The matrix $L$ is the standard second-order finite difference approximation of the Laplacian operator $u_{xx}$ with homogeneous Dirichlet boundary conditions. We define the system matrix as $A = M - \\Delta t\\, \\kappa\\, L$ and the right-hand side as $b = M u^n$. The system to solve is $A u^{n+1} = b$.\n\n**Derivation of the Schur Complement Method**\n\nTo address the stiffness introduced by the small diagonal entries of $M$ for cut-cells, we partition the system's degrees of freedom. Let the set of all cell indices be partitioned into two disjoint sets: $A$, the set of regular (\"active\") cells, and $B$, the set of cut-cells that we wish to eliminate.\n\nBy reordering the vector of unknowns $u^{n+1}$ and the corresponding equations, we can write the linear system $A u^{n+1} = b$ in a $2 \\times 2$ block form:\n$$\n\\begin{pmatrix} A_{AA} & A_{AB} \\\\ A_{BA} & A_{BB} \\end{pmatrix}\n\\begin{pmatrix} u_A \\\\ u_B \\end{pmatrix} =\n\\begin{pmatrix} b_A \\\\ b_B \\end{pmatrix}\n$$\nHere, $u_A$ and $u_B$ are subvectors of $u^{n+1}$ corresponding to the cell sets $A$ and $B$, respectively. The matrices $A_{AA}$, $A_{AB}$, $A_{BA}$, and $A_{BB}$ are the corresponding blocks of the system matrix $A$, and $b_A$ and $b_B$ are the partitioned blocks of the right-hand side vector $b$.\n\nThis block system is equivalent to the following two equations:\n1. $A_{AA} u_A + A_{AB} u_B = b_A$\n2. $A_{BA} u_A + A_{BB} u_B = b_B$\n\nThe core idea of the Schur complement method is to algebraically eliminate the unknowns $u_B$ from the system. We can solve for $u_B$ from the second equation:\n$$\nA_{BB} u_B = b_B - A_{BA} u_A\n$$\n$$\nu_B = A_{BB}^{-1} (b_B - A_{BA} u_A)\n$$\nThis step is valid if and only if the matrix block $A_{BB}$ is invertible. Let's analyze $A_{BB}$:\n$A_{BB} = M_{BB} - \\Delta t\\, \\kappa\\, L_{BB}$.\nThe mass matrix block $M_{BB}$ is a diagonal matrix with positive entries $\\{\\alpha_i\\}_{i \\in B}$.\nThe Laplacian block $L_{BB}$ is a principal submatrix of $L$. The matrix $-L$ is symmetric positive definite (SPD). Any principal submatrix of an SPD matrix is also SPD. Thus, $-L_{BB}$ is SPD.\nFor the specific test cases in this problem, the cut-cells are not adjacent to each other. This simplifies $L_{BB}$ to be a diagonal matrix with entries $-2/h^2$, and $L_{AB}, L_{BA}$ have a sparse structure. Consequently, $A_{BB}$ is a diagonal matrix with entries $(\\alpha_i + 2\\Delta t \\kappa / h^2)$. Since $\\alpha_i > 0$, $\\Delta t > 0$, $\\kappa > 0$, and $h^2 > 0$, all diagonal entries of $A_{BB}$ are strictly positive. Therefore, $A_{BB}$ is invertible.\n\nSubstituting the expression for $u_B$ into the first equation gives:\n$$\nA_{AA} u_A + A_{AB} \\left( A_{BB}^{-1} (b_B - A_{BA} u_A) \\right) = b_A\n$$\nRearranging the terms to isolate $u_A$, we obtain the reduced system:\n$$\n(A_{AA} - A_{AB} A_{BB}^{-1} A_{BA}) u_A = b_A - A_{AB} A_{BB}^{-1} b_B\n$$\nThis is the Schur complement system. We define:\n- The Schur complement matrix: $S = A_{AA} - A_{AB} A_{BB}^{-1} A_{BA}$\n- The modified right-hand side: $\\hat{b}_A = b_A - A_{AB} A_{BB}^{-1} b_B$\n\nThe reduced system to be solved for the regular cell unknowns $u_A$ is $S u_A = \\hat{b}_A$.\n\n**Reconstruction of Eliminated Unknowns**\n\nAfter solving the reduced system for $u_A$, the solution for the eliminated cut-cell unknowns $u_B$ can be recovered by back-substitution into the expression derived earlier:\n$$\nu_B = A_{BB}^{-1} (b_B - A_{BA} u_A)\n$$\nCombining $u_A$ and $u_B$ gives the complete solution vector $u^{n+1}$.\n\n**Algorithmic and Conditioning Summary**\n\nThe algorithm proceeds as follows:\n1.  Assemble the full system matrices $M$, $L$, and $A = M - \\Delta t \\kappa L$. Compute the right-hand side $b = M u^0$.\n2.  Solve the full system $A u^{1,\\text{full}} = b$ as a baseline.\n3.  If cut-cells exist, partition $A$ and $b$ into blocks corresponding to regular ($A$) and cut ($B$) cells.\n4.  Construct the Schur complement $S$ and the modified right-hand side $\\hat{b}_A$.\n5.  Solve the reduced system $S u_A = \\hat{b}_A$.\n6.  Reconstruct $u_B$ to obtain the full solution vector $u^{1,\\text{schur}}$.\n7.  Compare the results and conditioning.\n\nThe presence of small volume fractions $\\alpha_i \\ll 1$ makes the mass matrix $M$ nearly singular. This ill-conditioning is transferred to the full system matrix $A$, whose spectral condition number $\\kappa_2(A)$ can become very large. The Schur complement method isolates this stiffness. The inversion of $A_{BB}$ is numerically stable as its entries are dominated by the well-behaved term $2\\Delta t \\kappa / h^2$. The resulting reduced system matrix $S$ operates only on the regular degrees of freedom and is typically much better conditioned than $A$. Therefore, we expect the condition number reduction factor, $\\kappa_2(A)/\\kappa_2(S)$, to be significantly greater than $1$ when small cut-cells are present, demonstrating the effectiveness of the method. The numerical solutions from both methods should be identical up to machine precision, as the Schur complement method is an exact algebraic rearrangement.", "answer": "[3.33066907e-16,3.13600101e+02,0.00000000e+00,1.00000000e+00,4.44089210e-16,1.48869158e+04,1.49880108e-15,1.21665290e+08]", "id": "3376340"}]}