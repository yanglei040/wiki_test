{"hands_on_practices": [{"introduction": "To build a solid foundation in positivity-preserving schemes, we begin with the core mechanism of a widely used class of limiters: the scaling limiter. High-order methods, such as Discontinuous Galerkin, can produce solutions that locally violate physical bounds, creating unphysical oscillations. This exercise [@problem_id:3433642] provides a direct, hands-on calculation of the scaling factor $\\theta$ for the Zhang–Shu bound-preserving limiter, demonstrating how to systematically enforce bounds by scaling the solution towards its well-behaved cell average.", "problem": "Consider the one-dimensional scalar conservation law $u_{t} + f(u)_{x} = 0$ on a uniform mesh of cells, with initial data satisfying an invariant-region (maximum-principle) bound $u(x,0) \\in [m,M]$ for all $x$. Assume the exact solution remains in $[m,M]$ for all time. On a given cell $K$, let the high-order Discontinuous Galerkin (DG) polynomial representation be $u_{h}(x)$ with cell average $\\bar{u}_{K}$.\n\nThe Zhang–Shu bound-preserving scaling limiter modifies $u_{h}(x)$ to a limited polynomial $\\tilde{u}_{h}(x)$ inside $K$ by a linear scaling around the cell average with an unknown factor $\\theta \\in [0,1]$ chosen to enforce $m \\le \\tilde{u}_{h}(x) \\le M$ at a prescribed set of points $S \\subset K$. Specifically, define\n$$\n\\tilde{u}_{h}(x) = \\theta\\big(u_{h}(x) - \\bar{u}_{K}\\big) + \\bar{u}_{K}, \\quad x \\in K,\n$$\nand take $S$ to be the three Legendre–Gauss–Lobatto (LGL) nodes in $K$. The limiter must enforce\n$$\nm \\le \\tilde{u}_{h}(x_{q}) \\le M \\quad \\text{for all } x_{q} \\in S.\n$$\n\nSuppose on a particular cell $K$ you are given the following data:\n- Cell average: $\\bar{u}_{K} = 1.0$.\n- Invariant-region bounds: $m = 0.2$ and $M = 1.5$.\n- Pointwise values of the high-order polynomial at the LGL nodes $S = \\{x_{1},x_{2},x_{3}\\}$ are $u_{h}(x_{1}) = 0.05$, $u_{h}(x_{2}) = 1.90$, and $u_{h}(x_{3}) = 1.05$.\n\nUsing only the definitions above and first principles about convex scaling and extremal constraints, determine the minimal $\\theta \\in [0,1]$ that guarantees $m \\le \\tilde{u}_{h}(x_{q}) \\le M$ at all three nodes $x_{q} \\in S$. Round your answer to four significant figures. The final answer must be a single real number with no units.", "solution": "The problem requires the determination of the scaling factor $\\theta$ for the Zhang–Shu bound-preserving limiter, as applied to a high-order polynomial representation $u_{h}(x)$ of a numerical solution within a cell $K$. The objective is to enforce an invariant-region property, specifically $m \\le \\tilde{u}_{h}(x) \\le M$, at a set of prescribed quadrature points.\n\nThe limited polynomial, $\\tilde{u}_{h}(x)$, is defined by a linear scaling of the original polynomial, $u_{h}(x)$, toward the cell average, $\\bar{u}_{K}$:\n$$\n\\tilde{u}_{h}(x) = \\theta\\big(u_{h}(x) - \\bar{u}_{K}\\big) + \\bar{u}_{K}\n$$\nwhere the scaling factor $\\theta$ is restricted to the interval $[0,1]$. The limiting procedure must select a $\\theta$ that guarantees the bounds are satisfied at all specified points $x_q$ in the set $S$. The constraints are:\n$$\nm \\le \\tilde{u}_{h}(x_{q}) \\le M \\quad \\text{for all } x_{q} \\in S\n$$\nSubstituting the definition of $\\tilde{u}_{h}(x_q)$, we obtain a pair of inequalities for each point $x_q$:\n$$\nm \\le \\theta\\big(u_{h}(x_{q}) - \\bar{u}_{K}\\big) + \\bar{u}_{K}\n$$\n$$\n\\theta\\big(u_{h}(x_{q}) - \\bar{u}_{K}\\big) + \\bar{u}_{K} \\le M\n$$\nThese inequalities can be rearranged to find conditions on $\\theta$.\n\nFor the lower-bound constraint:\n$m - \\bar{u}_{K} \\le \\theta\\big(u_{h}(x_{q}) - \\bar{u}_{K}\\big)$\n\nFor the upper-bound constraint:\n$\\theta\\big(u_{h}(x_{q}) - \\bar{u}_{K}\\big) \\le M - \\bar{u}_{K}$\n\nTo isolate $\\theta$, we must consider the sign of the term $u_{h}(x_{q}) - \\bar{u}_{K}$.\n\nCase 1: $u_{h}(x_{q}) > \\bar{u}_{K}$.\nThe term $u_{h}(x_{q}) - \\bar{u}_{K}$ is positive. The inequalities become:\n$$\n\\theta \\ge \\frac{m - \\bar{u}_{K}}{u_{h}(x_{q}) - \\bar{u}_{K}}\n$$\n$$\n\\theta \\le \\frac{M - \\bar{u}_{K}}{u_{h}(x_{q}) - \\bar{u}_{K}}\n$$\nThe problem is concerned with solutions that may violate the bounds, which implies $m \\le \\bar{u}_{K} \\le M$. Given this, $m - \\bar{u}_{K} \\le 0$. Thus, the first inequality, $\\theta \\ge \\text{a non-positive number}$, is trivially satisfied for any $\\theta \\in [0,1]$. The only active constraint in this case comes from the upper bound. This is particularly relevant if $u_{h}(x_q)$ is an overshoot, i.e., $u_{h}(x_q) > M$.\n\nCase 2: $u_{h}(x_{q}) < \\bar{u}_{K}$.\nThe term $u_{h}(x_{q}) - \\bar{u}_{K}$ is negative. When we divide by it, the inequality signs must be reversed:\n$$\n\\theta \\le \\frac{m - \\bar{u}_{K}}{u_{h}(x_{q}) - \\bar{u}_{K}}\n$$\n$$\n\\theta \\ge \\frac{M - \\bar{u}_{K}}{u_{h}(x_{q}) - \\bar{u}_{K}}\n$$\nHere, $M - \\bar{u}_{K} \\ge 0$, so the second inequality, $\\theta \\ge \\text{a non-positive number}$, is trivially satisfied for any $\\theta \\in [0,1]$. The active constraint comes from the lower bound, which is relevant if $u_{h}(x_q)$ is an undershoot, i.e., $u_{h}(x_q) < m$.\n\nCase 3: $u_{h}(x_{q}) = \\bar{u}_{K}$.\nThe constraints reduce to $m \\le \\bar{u}_{K}$ and $\\bar{u}_{K} \\le M$. Since the cell average $\\bar{u}_{K}$ is assumed to be within the bounds $[m, M]$, these conditions are satisfied and place no restriction on $\\theta$.\n\nIf a point $x_q$ does not violate the bounds, i.e., $m \\le u_h(x_q) \\le M$, then since $m \\le \\bar{u}_K \\le M$ and $\\tilde{u}_h(x_q)$ is a convex combination of $u_h(x_q)$ and $\\bar{u}_K$, it follows that $m \\le \\tilde{u}_h(x_q) \\le M$ for any $\\theta \\in [0,1]$. Such a point imposes no constraint on $\\theta$ beyond $\\theta \\le 1$.\n\nThe limiter must find a single $\\theta$ that works for all points $x_q \\in S$. The value of $\\theta$ must be less than or equal to the upper bounds derived from all points. To preserve as much high-order information as possible, the largest such $\\theta$ is chosen. The problem asks for the \"minimal $\\theta$ that guarantees\" the bounds, which in the context of this algorithm refers to the most restrictive (smallest) value among the set of upper-bound constraints calculated for each point. If no point violates the bounds, $\\theta=1$.\nThus, the final scaling factor is:\n$$\n\\theta = \\min\\left(1, \\min_{q} \\theta_q\\right)\n$$\nwhere $\\theta_q$ is the upper bound on $\\theta$ derived for each point $x_q$ that violates the bounds.\n\nLet us apply this to the given data:\n- Cell average: $\\bar{u}_{K} = 1.0$.\n- Invariant-region bounds: $m = 0.2$ and $M = 1.5$.\n- Pointwise values: $u_{h}(x_{1}) = 0.05$, $u_{h}(x_{2}) = 1.90$, and $u_{h}(x_{3}) = 1.05$.\n\nWe analyze each point:\n\nPoint 1: $x_{1}$ with $u_{h}(x_{1}) = 0.05$.\nThis value is an undershoot, as $u_{h}(x_{1}) = 0.05 < m = 0.2$.\nWe have $u_{h}(x_{1}) < \\bar{u}_{K}$, so we are in Case 2. The constraint on $\\theta$ is:\n$$\n\\theta \\le \\frac{m - \\bar{u}_{K}}{u_{h}(x_{1}) - \\bar{u}_{K}} = \\frac{0.2 - 1.0}{0.05 - 1.0} = \\frac{-0.8}{-0.95} = \\frac{80}{95} = \\frac{16}{19}\n$$\nLet's call this constraint $\\theta \\le \\theta_1$, where $\\theta_1 = 16/19$.\n\nPoint 2: $x_{2}$ with $u_{h}(x_{2}) = 1.90$.\nThis value is an overshoot, as $u_{h}(x_{2}) = 1.90 > M = 1.5$.\nWe have $u_{h}(x_{2}) > \\bar{u}_{K}$, so we are in Case 1. The constraint on $\\theta$ is:\n$$\n\\theta \\le \\frac{M - \\bar{u}_{K}}{u_{h}(x_{2}) - \\bar{u}_{K}} = \\frac{1.5 - 1.0}{1.90 - 1.0} = \\frac{0.5}{0.9} = \\frac{5}{9}\n$$\nLet's call this constraint $\\theta \\le \\theta_2$, where $\\theta_2 = 5/9$.\n\nPoint 3: $x_{3}$ with $u_{h}(x_{3}) = 1.05$.\nThis value is within the invariant region, as $m=0.2 \\le 1.05 \\le 1.5=M$.\nAs established, this point does not require any limiting, so it does not impose any constraint on $\\theta$ in the interval $[0,1]$. Formally, this corresponds to a constraint $\\theta \\le \\theta_3$ where $\\theta_3 \\ge 1$. For example, applying the formula from Case 1 gives $\\theta \\le \\frac{1.5-1.0}{1.05-1.0} = \\frac{0.5}{0.05} = 10$, which is satisfied for all $\\theta \\in [0,1]$. Thus, the effective constraint from this point is $\\theta \\le 1$.\n\nTo satisfy the bounds at all three points simultaneously, $\\theta$ must satisfy all constraints:\n$$\n\\theta \\le \\theta_1 \\quad \\text{and} \\quad \\theta \\le \\theta_2 \\quad \\text{and} \\quad \\theta \\le 1\n$$\nThis means we must choose $\\theta$ such that:\n$$\n\\theta \\le \\min(\\theta_1, \\theta_2, 1) = \\min\\left(\\frac{16}{19}, \\frac{5}{9}, 1\\right)\n$$\nTo find the minimum, we compare the fractions:\n$$\n\\frac{16}{19} \\approx 0.8421...\n$$\n$$\n\\frac{5}{9} = 0.5555...\n$$\nThe minimum of these values is $5/9$. The limiting procedure selects this most restrictive value.\n$$\n\\theta = \\frac{5}{9}\n$$\nThe problem requires the answer to be rounded to four significant figures.\n$$\n\\theta = \\frac{5}{9} \\approx 0.555555...\n$$\nRounding to four significant figures yields $0.5556$.", "answer": "$$\\boxed{0.5556}$$", "id": "3433642"}, {"introduction": "Having mastered the basic calculation, we now apply this skill to a vital physical application: modeling wet-dry interfaces in shallow water systems. Accurately capturing the moving shoreline without allowing the water depth to become negative is a classic challenge in computational hydraulics. This practice [@problem_id:3433613] reinforces the concept of the scaling limiter in a tangible context, illustrating how to enforce a non-negative water depth and introducing the practical detail of a small positive \"dryness\" threshold, $\\epsilon$, to maintain numerical stability.", "problem": "Consider the one-dimensional shallow water equations with bathymetry, where the conserved water depth is defined by $h(x,t) = \\eta(x,t) - b(x)$ and the physical constraint $h(x,t) \\ge 0$ must hold. Near a wet–dry interface, a high-order polynomial reconstruction for the free-surface elevation can locally yield negative pointwise values of $h(x,t)$ even when the cell average is positive, which violates physical admissibility. To enforce $h \\ge 0$ while preserving the cell average, one may apply a linear scaling limiter around the cell average in each cell.\n\nIn a single cell with spatial index $i$, suppose the bathymetry is constant and equal to $b_i = 1.000$ in meters. A polynomial reconstruction of the free-surface elevation $\\eta_i(x)$ is available at three Gauss–Lobatto nodes $\\{x_{i,-1}, x_{i,0}, x_{i,1}\\}$ with nodal values\n$\\eta_i(x_{i,-1}) = 1.020$, $\\eta_i(x_{i,0}) = 0.996$, and $\\eta_i(x_{i,1}) = 1.010$, all in meters. The cell average of the free-surface elevation is $\\bar{\\eta}_i = 1.012$, and the corresponding cell-average water depth is $\\bar{h}_i = \\bar{\\eta}_i - b_i$. Let the dryness threshold be $\\epsilon = 1.0 \\times 10^{-5}$ in meters (i.e., pointwise depths must satisfy $h \\ge \\epsilon$).\n\nDefine the depth reconstruction at the three nodes by $h_i(x_{i,q}) = \\eta_i(x_{i,q}) - b_i$ for $q \\in \\{-1,0,1\\}$. Consider the standard linear scaling positivity-preserving limiter that constructs a limited depth\n$$\nh_i^{\\text{new}}(x) = \\theta \\left(h_i(x) - \\bar{h}_i\\right) + \\bar{h}_i,\n$$\nwith a single parameter $\\theta \\in [0,1]$, chosen minimally so that $h_i^{\\text{new}}(x_{i,q}) \\ge \\epsilon$ for all three nodes $q \\in \\{-1,0,1\\}$ while exactly preserving the cell-average depth $\\bar{h}_i$.\n\nStarting from the definition of $h$ and the requirement of non-negativity at the nodal points together with average preservation, derive the general form of the minimal admissible $\\theta$ as a function of the given data in this cell, and then evaluate it numerically using the provided values. Round your final numerical value of $\\theta$ to $6$ significant figures. The final answer must be a single real number without units.", "solution": "First, we calculate the required quantities for cell $i$ from the given data.\nThe cell-average water depth $\\bar{h}_i$ is:\n$$\n\\bar{h}_i = \\bar{\\eta}_i - b_i = 1.012 - 1.000 = 0.012\n$$\nThe water depths $h_i(x_{i,q})$ at the Gauss-Lobatto nodes are:\n$$\nh_i(x_{i,-1}) = \\eta_i(x_{i,-1}) - b_i = 1.020 - 1.000 = 0.020\n$$\n$$\nh_i(x_{i,0}) = \\eta_i(x_{i,0}) - b_i = 0.996 - 1.000 = -0.004\n$$\n$$\nh_i(x_{i,1}) = \\eta_i(x_{i,1}) - b_i = 1.010 - 1.000 = 0.010\n$$\nThe minimum value of the reconstructed water depth at the nodes is:\n$$\nm_h = \\min_{q \\in \\{-1,0,1\\}} h_i(x_{i,q}) = \\min(0.020, -0.004, 0.010) = -0.004\n$$\nSince $m_h = -0.004  \\epsilon = 1.0 \\times 10^{-5}$, the original reconstruction violates the positivity requirement, and a limiter must be applied.\n\nThe limited depth $h_i^{\\text{new}}(x)$ must satisfy $h_i^{\\text{new}}(x_{i,q}) \\ge \\epsilon$ for all nodes $q$. Substituting the limiter definition:\n$$\n\\theta \\left(h_i(x_{i,q}) - \\bar{h}_i\\right) + \\bar{h}_i \\ge \\epsilon\n$$\nRearranging for $\\theta$ yields:\n$$\n\\theta \\left(h_i(x_{i,q}) - \\bar{h}_i\\right) \\ge \\epsilon - \\bar{h}_i\n$$\nThis constraint is only non-trivial for points where $h_i(x_{i,q})  \\bar{h}_i$. In this case, $(h_i(x_{i,q}) - \\bar{h}_i)$ is negative, so dividing by it reverses the inequality:\n$$\n\\theta \\le \\frac{\\epsilon - \\bar{h}_i}{h_i(x_{i,q}) - \\bar{h}_i} = \\frac{\\bar{h}_i - \\epsilon}{\\bar{h}_i - h_i(x_{i,q})}\n$$\nTo satisfy this for all such points, $\\theta$ must be less than or equal to the minimum of these ratios. The ratio is minimized when the denominator is maximized, which occurs at the point of minimum depth, $m_h$. Thus, the most restrictive constraint is:\n$$\n\\theta \\le \\frac{\\bar{h}_i - \\epsilon}{\\bar{h}_i - m_h}\n$$\nThe goal of a limiter is to make the minimal change necessary, which corresponds to choosing the largest possible $\\theta$ that satisfies the constraint. Since the problem has a violation ($m_h  \\epsilon$), the required $\\theta$ is given by this upper bound.\n$$\n\\theta = \\frac{\\bar{h}_i - \\epsilon}{\\bar{h}_i - m_h}\n$$\nSubstituting the numerical values:\n- $\\bar{h}_i = 0.012$\n- $\\epsilon = 0.00001$\n- $m_h = -0.004$\n\n$$\n\\theta = \\frac{0.012 - 0.00001}{0.012 - (-0.004)} = \\frac{0.01199}{0.012 + 0.004} = \\frac{0.01199}{0.016}\n$$\nPerforming the division:\n$$\n\\theta = 0.749375\n$$\nThis value has 6 significant figures as required.", "answer": "$$\n\\boxed{0.749375}\n$$", "id": "3433613"}, {"introduction": "The final step in our hands-on tour is to move beyond direct calculation to derivation, revealing the true versatility of the scaling limiter concept. In physical systems described by kinetic theory, such as radiative transport, positivity must be maintained for a distribution function over an internal variable, like direction. This exercise [@problem_id:3433621] challenges you to derive the expression for the limiter parameter $\\theta$ in a scenario where the \"safe\" anchor is not a spatial average but a discrete angular mean, which is crucial for preserving energy balance.", "problem": "Consider the gray radiative transport equation in $d$ spatial dimensions,\n$$\nI_{t} + \\mathbf{\\Omega}\\cdot\\nabla I \\;=\\; \\sigma_{a}\\,\\big(B - I\\big) \\;+\\; \\sigma_{s}\\,\\big(\\mathcal{S}[I] - I\\big),\n$$\nwhere $I = I(\\mathbf{x},\\mathbf{\\Omega},t)$ is the specific intensity, $\\mathbf{\\Omega}\\in\\mathbb{S}^{d-1}$ is the direction, $\\sigma_{a}\\ge 0$ and $\\sigma_{s}\\ge 0$ are the absorption and scattering coefficients that may be stiff, $B = B(\\mathbf{x},t)\\ge 0$ is the Planckian source, and $\\mathcal{S}$ is the scattering operator. Assume an angular discretization by a quadrature $\\{\\mathbf{\\Omega}_{m},w_{m}\\}_{m=1}^{M}$ with normalized weights $\\sum_{m=1}^{M} w_{m} = 1$, and a cell-averaged finite volume discretization in space over a control volume $K$ with volume $|K|$ and outward unit normals on faces. Let a single-step time integrator be used in which the transport term is treated explicitly and the collisional terms are treated implicitly to handle stiffness, resulting at each time step in an unconstrained cell-averaged, direction-resolved vector $\\{\\tilde{I}_{m}^{n+1}\\}_{m=1}^{M}$ at time $t^{n+1}$, with the discrete angular mean\n$$\n\\bar{I}^{n+1} \\;=\\; \\sum_{m=1}^{M} w_{m}\\,\\tilde{I}_{m}^{n+1}.\n$$\nAssume the implicit collisional update preserves the discrete energy balance in the sense that the evolution equation for $\\bar{I}^{n+1}$ matches the angularly averaged balance, and that $B\\ge 0$. Small negative undershoots in $\\tilde{I}_{m}^{n+1}$ may occur due to transport discretization errors.\n\nYou are tasked with deriving, from first principles, a positivity-preserving algebraic limiter that enforces $I_{m}^{n+1}\\ge 0$ for all directions $m$ while preserving the discrete energy balance encoded in $\\bar{I}^{n+1}$. Use only the following fundamental properties as the base of your derivation: (i) the finite volume balance law for the cell average, (ii) the normalization of the angular quadrature, (iii) the scattering energy invariance $\\sum_{m} w_{m}\\,(\\mathcal{S}[I])_{m} = \\sum_{m} w_{m}\\,I_{m}$ for conservative scattering, and (iv) the fact that convex combinations preserve nonnegativity.\n\nPropose a limiter of the form\n$$\nI_{m}^{n+1} \\;=\\; \\bar{I}^{n+1} \\;+\\; \\theta\\,\\big(\\tilde{I}_{m}^{n+1} - \\bar{I}^{n+1}\\big), \\quad \\theta \\in [0,1],\n$$\nwhich rescales deviations from the discrete angular mean within each cell and time step. Derive the analytic expression for the largest admissible value $\\theta^{\\star}$ such that $I_{m}^{n+1}\\ge 0$ holds for all $m$ and the discrete angular mean $\\sum_{m} w_{m} I_{m}^{n+1}$ is preserved exactly. Your answer must be a single closed-form expression for $\\theta^{\\star}$ in terms of $\\{\\tilde{I}_{m}^{n+1}\\}$ and $\\{w_{m}\\}$, with no inequalities. No numerical evaluation is required. Express your final answer as a symbolic expression. Do not include any units.", "solution": "The objective is to find the largest value of $\\theta \\in [0,1]$, denoted $\\theta^{\\star}$, such that the limited intensity $I_{m}^{n+1}$ satisfies two conditions:\n1.  **Positivity**: $I_{m}^{n+1} \\ge 0$ for all directions $m \\in \\{1, \\dots, M\\}$.\n2.  **Conservation of Mean Intensity**: The discrete angular mean is preserved, i.e., $\\sum_{m=1}^{M} w_{m} I_{m}^{n+1} = \\bar{I}^{n+1}$.\n\nFirst, we verify that the proposed limiter form preserves the mean intensity for any $\\theta$. The mean of the limited solution is:\n$$\n\\sum_{m=1}^{M} w_{m} I_{m}^{n+1} = \\sum_{m=1}^{M} w_{m} \\left[ \\bar{I}^{n+1} + \\theta \\left( \\tilde{I}_{m}^{n+1} - \\bar{I}^{n+1} \\right) \\right]\n$$\nBy distributing the sum and using the properties $\\sum_{m} w_m = 1$ and $\\bar{I}^{n+1} = \\sum_{m} w_{m} \\tilde{I}_{m}^{n+1}$, we get:\n$$\n\\sum_{m=1}^{M} w_{m} I_{m}^{n+1} = \\bar{I}^{n+1} \\left(\\sum_{m=1}^{M} w_{m}\\right) + \\theta \\left( \\sum_{m=1}^{M} w_{m} \\tilde{I}_{m}^{n+1} - \\bar{I}^{n+1} \\sum_{m=1}^{M} w_{m} \\right)\n$$\n$$\n= \\bar{I}^{n+1}(1) + \\theta \\left( \\bar{I}^{n+1} - \\bar{I}^{n+1}(1) \\right) = \\bar{I}^{n+1}\n$$\nThe mean is preserved regardless of the value of $\\theta$.\n\nNext, we enforce the positivity constraint, $I_{m}^{n+1} \\ge 0$, for all $m$. A physically meaningful solution requires the mean intensity to be non-negative, $\\bar{I}^{n+1} \\ge 0$, which we assume. The constraint for each direction is:\n$$\n\\bar{I}^{n+1} + \\theta \\left( \\tilde{I}_{m}^{n+1} - \\bar{I}^{n+1} \\right) \\ge 0\n$$\nThis constraint is trivially satisfied for any $\\theta \\in [0,1]$ if $\\tilde{I}_{m}^{n+1} \\ge 0$, since it represents a convex combination of two non-negative numbers. A non-trivial constraint arises only for directions with an undershoot, where $\\tilde{I}_{m}^{n+1}  0$. For such a direction, we solve for $\\theta$:\n$$\n\\theta \\left( \\bar{I}^{n+1} - \\tilde{I}_{m}^{n+1} \\right) \\le \\bar{I}^{n+1}\n$$\nSince $\\bar{I}^{n+1} \\ge 0$ and $\\tilde{I}_{m}^{n+1}  0$, the term $(\\bar{I}^{n+1} - \\tilde{I}_{m}^{n+1})$ is positive, so we can divide without changing the inequality's direction:\n$$\n\\theta \\le \\frac{\\bar{I}^{n+1}}{\\bar{I}^{n+1} - \\tilde{I}_{m}^{n+1}}\n$$\nThis inequality provides an upper bound on $\\theta$ for each direction $m$ with an undershoot. To ensure positivity for all such directions simultaneously, $\\theta$ must be less than or equal to the minimum of all these upper bounds. The largest admissible value, $\\theta^{\\star}$, is therefore the most permissive value that satisfies all constraints, including $\\theta \\in [0,1]$.\n$$\n\\theta^{\\star} = \\min\\left(1, \\min_{m \\text{ s.t. } \\tilde{I}_{m}^{n+1}  0} \\left\\{ \\frac{\\bar{I}^{n+1}}{\\bar{I}^{n+1} - \\tilde{I}_{m}^{n+1}} \\right\\} \\right)\n$$\nIf no direction has an undershoot, the inner set is empty, its minimum is taken as $+\\infty$, and $\\theta^{\\star} = \\min(1, \\infty) = 1$, correctly implying no limiting is needed.\n\nTo express the final answer solely in terms of $\\{\\tilde{I}_{m}^{n+1}\\}$ and $\\{w_{m}\\}$, we substitute the definition of $\\bar{I}^{n+1}$:\n$$ \\theta^{\\star} = \\min\\left(1, \\min_{m \\text{ s.t. } \\tilde{I}_{m}^{n+1}  0} \\left\\{ \\frac{\\sum_{k=1}^{M} w_k \\tilde{I}_k^{n+1}}{(\\sum_{k=1}^{M} w_k \\tilde{I}_k^{n+1}) - \\tilde{I}_m^{n+1}} \\right\\} \\right) $$\nThis is the required closed-form expression.", "answer": "$$\n\\boxed{\\min\\left(1, \\min_{m \\text{ s.t. } \\tilde{I}_{m}^{n+1}  0} \\left\\{ \\frac{\\sum_{k=1}^{M} w_k \\tilde{I}_k^{n+1}}{\\left(\\sum_{k=1}^{M} w_k \\tilde{I}_k^{n+1}\\right) - \\tilde{I}_m^{n+1}} \\right\\} \\right)}\n$$", "id": "3433621"}]}