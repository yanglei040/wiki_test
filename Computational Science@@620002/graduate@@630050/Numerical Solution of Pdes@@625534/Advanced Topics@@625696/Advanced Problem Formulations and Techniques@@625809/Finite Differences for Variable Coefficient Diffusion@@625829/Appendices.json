{"hands_on_practices": [{"introduction": "Before tackling complex discontinuities, it is crucial to establish a robust discretization for smoothly varying coefficients. This practice guides you in deriving a face-averaging formula for the diffusion coefficient $a(x,y)$ that ensures your numerical scheme can exactly represent linear solutions, a key property for achieving higher-order accuracy on general grids. This theoretical exercise [@problem_id:3393670] builds the foundation for more advanced numerical treatments of the diffusion operator.", "problem": "Consider the steady variable-coefficient diffusion equation in two spatial dimensions,\n$$\n-\\,\\nabla\\cdot\\big(a(x,y)\\,\\nabla u(x,y)\\big)=0,\n$$\nposed on a rectangular domain with a conforming Cartesian mesh of axis-aligned rectangular control volumes. Let the control volume centered at $\\big(x_i,y_j\\big)$ have widths $\\Delta x_i$ in the $x$-direction and $\\Delta y_j$ in the $y$-direction. A standard two-point finite volume approximation defines the normal flux across a vertical face at $\\big(x_{i+\\frac{1}{2}},y_j\\big)$ by\n$$\nF_{i+\\frac{1}{2},j} \\;\\approx\\; -\\,a_{i+\\frac{1}{2},j}\\,\\frac{u_{i+1,j}-u_{i,j}}{\\Delta x_{i+\\frac{1}{2}}}\\;\\Delta y_j,\n$$\nand similarly for horizontal faces, where $\\Delta x_{i+\\frac{1}{2}}=\\tfrac{1}{2}\\big(\\Delta x_i+\\Delta x_{i+1}\\big)$, and $a_{i+\\frac{1}{2},j}$ is a face-centered coefficient obtained by averaging nearby cell-centered samples $a_{i,j}$ and $a_{i+1,j}$.\n\nStarting from the divergence theorem and the definition of the finite volume method, derive a face-averaging design for $a_{i+\\frac{1}{2},j}$ that guarantees the discrete operator exactly preserves any steady linear solution $u(x,y)=\\alpha x+\\beta y+\\gamma$ when the coefficient $a(x,y)=Ax + By + C$ is linear and satisfies $\\nabla a\\cdot\\nabla u=0$ so that the continuous operator vanishes. Identify the minimal conditions on the averaging weights for $a_{i+\\frac{1}{2},j}$ required for this property on a general nonuniform Cartesian mesh. Your final answer must be the single closed-form analytic expression for $a_{i+\\frac{1}{2},j}$ in terms of $\\Delta x_i$, $\\Delta x_{i+1}$, $a_{i,j}$, and $a_{i+1,j}$, written in LaTeX. No numerical approximation or rounding is needed and no physical units should be included in the final answer.", "solution": "The problem requires the derivation of a face-averaging formula for the coefficient $a(x,y)$ in a finite volume discretization of the steady-state, variable-coefficient diffusion equation,\n$$ -\\nabla \\cdot \\big(a(x,y) \\nabla u(x,y)\\big) = 0. $$\nThis formula for the face-centered coefficient, which we denote as $a_{i+\\frac{1}{2},j}$, must guarantee that the discrete operator exactly preserves any linear solution of the form $u(x,y) = \\alpha x + \\beta y + \\gamma$ when the coefficient $a(x,y) = Ax + By + C$ is also linear and the condition $\\nabla a \\cdot \\nabla u = 0$ holds.\n\nThe finite volume method begins by integrating the partial differential equation over a control volume $V_{i,j}$, which is centered at $(x_i, y_j)$ and has dimensions $\\Delta x_i \\times \\Delta y_j$.\n$$ - \\iint_{V_{i,j}} \\nabla \\cdot (a \\nabla u) \\, dx \\, dy = 0. $$\nApplying the divergence theorem transforms this into an equation for the balance of fluxes across the boundary $\\partial V_{i,j}$ of the control volume:\n$$ - \\oint_{\\partial V_{i,j}} (a \\nabla u) \\cdot \\mathbf{n} \\, dS = 0, $$\nwhere $\\mathbf{n}$ is the outward-pointing unit normal vector. For a rectangular control volume, this equation states that the sum of fluxes across the four faces is zero:\n$$ \\mathcal{F}_{i+\\frac{1}{2}, j} - \\mathcal{F}_{i-\\frac{1}{2}, j} + \\mathcal{G}_{i, j+\\frac{1}{2}} - \\mathcal{G}_{i, j-\\frac{1}{2}} = 0. $$\nHere, $\\mathcal{F}$ and $\\mathcal{G}$ represent the exact total fluxes across the vertical and horizontal faces, respectively. For the vertical face at $x=x_{i+\\frac{1}{2}}$, the flux is given by the integral:\n$$ \\mathcal{F}_{i+\\frac{1}{2}, j} = \\int_{y_j - \\Delta y_j/2}^{y_j + \\Delta y_j/2} \\left(-a(x,y) \\frac{\\partial u}{\\partial x}\\right)\\bigg|_{x=x_{i+\\frac{1}{2}}} dy. $$\nThe problem provides the corresponding numerical approximation for this flux:\n$$ F_{i+\\frac{1}{2},j} = -a_{i+\\frac{1}{2},j}\\,\\frac{u_{i+1,j}-u_{i,j}}{\\Delta x_{i+\\frac{1}{2}}}\\;\\Delta y_j. $$\nThe discrete conservation law is formed by substituting these numerical fluxes into the balance equation:\n$$ (F_{i+\\frac{1}{2},j} - F_{i-\\frac{1}{2},j}) + (G_{i,j+\\frac{1}{2}} - G_{i,j-\\frac{1}{2}}) = 0. $$\nOur objective is to determine the expression for $a_{i+\\frac{1}{2},j}$ that ensures this discrete equation holds exactly for the given linear functions.\n\nFor a linear solution $u(x,y) = \\alpha x + \\beta y + \\gamma$, the nodal values are $u_{i,j} = \\alpha x_i + \\beta y_j + \\gamma$. The finite difference quotient for the gradient, taken between cell centers, is exact:\n$$ \\frac{u_{i+1,j} - u_{i,j}}{x_{i+1} - x_i} = \\frac{(\\alpha x_{i+1} + \\beta y_j + \\gamma) - (\\alpha x_i + \\beta y_j + \\gamma)}{x_{i+1} - x_i} = \\alpha = \\frac{\\partial u}{\\partial x}. $$\nThe problem defines the distance between cell centers as $\\Delta x_{i+\\frac{1}{2}} = \\frac{1}{2}(\\Delta x_i + \\Delta x_{i+1})$. The geometry of the contiguous control volumes implies that $x_{i+1} - x_i = \\frac{1}{2}\\Delta x_i + \\frac{1}{2}\\Delta x_{i+1} = \\Delta x_{i+\\frac{1}{2}}$. Therefore, the discrete derivative term correctly evaluates the constant partial derivative:\n$$ \\frac{u_{i+1,j}-u_{i,j}}{\\Delta x_{i+\\frac{1}{2}}} = \\alpha. $$\nSimilarly, for the $y$-direction, $\\frac{u_{i,j+1}-u_{i,j}}{\\Delta y_{j+\\frac{1}{2}}} = \\beta$.\n\nSubstituting these exact derivatives into the numerical flux expressions yields:\n$$ F_{i+\\frac{1}{2},j} = -a_{i+\\frac{1}{2},j} \\alpha \\Delta y_j \\quad \\text{and} \\quad G_{i,j+\\frac{1}{2}} = -a_{i,j+\\frac{1}{2}} \\beta \\Delta x_i. $$\nThe discrete conservation law for the control volume $(i,j)$ becomes:\n$$ \\alpha \\Delta y_j (a_{i-\\frac{1}{2},j} - a_{i+\\frac{1}{2},j}) + \\beta \\Delta x_i (a_{i,j-\\frac{1}{2}} - a_{i,j+\\frac{1}{2}}) = 0. $$\nTo fulfill this condition, we can enforce that the numerical flux approximation $F_{i+\\frac{1}{2},j}$ be equal to the exact integrated flux $\\mathcal{F}_{i+\\frac{1}{2},j}$. Let's compute this exact flux for the linear coefficient $a(x,y)=Ax+By+C$ and constant gradient $\\partial u / \\partial x = \\alpha$:\n$$ \\mathcal{F}_{i+\\frac{1}{2},j} = -\\alpha \\int_{y_j - \\Delta y_j/2}^{y_j + \\Delta y_j/2} (A x_{i+\\frac{1}{2}} + B y + C) \\, dy. $$\nEvaluating the integral with respect to $y$:\n$$ \\mathcal{F}_{i+\\frac{1}{2},j} = -\\alpha \\left[ (A x_{i+\\frac{1}{2}} + C)y + \\frac{B}{2}y^2 \\right]_{y_j - \\Delta y_j/2}^{y_j + \\Delta y_j/2} = -\\alpha \\left( (A x_{i+\\frac{1}{2}} + C)\\Delta y_j + B y_j \\Delta y_j \\right). $$\n$$ \\mathcal{F}_{i+\\frac{1}{2},j} = -\\alpha (A x_{i+\\frac{1}{2}} + B y_j + C) \\Delta y_j = -\\alpha \\, a\\left(x_{i+\\frac{1}{2}}, y_j\\right) \\Delta y_j. $$\nBy equating the numerical flux $F_{i+\\frac{1}{2},j} = -a_{i+\\frac{1}{2},j} \\alpha \\Delta y_j$ to the exact flux $\\mathcal{F}_{i+\\frac{1}{2},j}$, we find the necessary condition for the face coefficient:\n$$ a_{i+\\frac{1}{2},j} = a\\left(x_{i+\\frac{1}{2}}, y_j\\right). $$\nThis means the numerical coefficient at the face must be the exact value of the continuous coefficient at the geometric center of that face. This choice guarantees that the discrete conservation equation is satisfied, as it becomes proportional to the continuous condition $\\nabla a \\cdot \\nabla u = A\\alpha+B\\beta = 0$.\n\nThe final step is to express $a_{i+\\frac{1}{2},j} = a(x_{i+\\frac{1}{2}}, y_j)$ in terms of the known cell-centered values $a_{i,j} = a(x_i, y_j)$ and $a_{i+1,j} = a(x_{i+1}, y_j)$. Since $a(x,y)$ is linear in its arguments, the function $a(x, y_j)$ is a linear function of $x$. Its value at $x_{i+\\frac{1}{2}}$ can be found by linear interpolation between its values at $x_i$ and $x_{i+1}$. The general one-dimensional linear interpolation formula for a function $f(x)$ between points $x_0$ and $x_1$ is $f(x) = f(x_0) \\frac{x_1-x}{x_1-x_0} + f(x_1) \\frac{x-x_0}{x_1-x_0}$.\nWe set $f(x) = a(x, y_j)$, $x_0=x_i$, $x_1=x_{i+1}$, and $x=x_{i+\\frac{1}{2}}$. The coordinate of the face is $x_{i+\\frac{1}{2}} = x_i + \\frac{\\Delta x_i}{2}$. The relevant distances for the interpolation weights are:\n$x_{i+1} - x_i = \\Delta x_{i+\\frac{1}{2}} = \\frac{\\Delta x_i + \\Delta x_{i+1}}{2}$.\n$x - x_0 = x_{i+\\frac{1}{2}} - x_i = \\frac{\\Delta x_i}{2}$.\n$x_1 - x = x_{i+1} - x_{i+\\frac{1}{2}} = \\frac{\\Delta x_{i+1}}{2}$.\n\nSubstituting these distances into the interpolation formula:\n$$ a_{i+\\frac{1}{2},j} = a_{i,j} \\frac{\\frac{\\Delta x_{i+1}}{2}}{\\frac{\\Delta x_i + \\Delta x_{i+1}}{2}} + a_{i+1,j} \\frac{\\frac{\\Delta x_i}{2}}{\\frac{\\Delta x_i + \\Delta x_{i+1}}{2}}. $$\nSimplifying this expression yields the final face-averaging formula:\n$$ a_{i+\\frac{1}{2},j} = a_{i,j} \\frac{\\Delta x_{i+1}}{\\Delta x_i + \\Delta x_{i+1}} + a_{i+1,j} \\frac{\\Delta x_i}{\\Delta x_i + \\Delta x_{i+1}}. $$\nThis is a weighted arithmetic mean of the adjacent cell-centered coefficients, where the weights are determined by the widths of the cells.\nThe minimal conditions identified for the averaging weights $w_i$ and $w_{i+1}$ in a scheme of the form $a_{i+1/2,j} = w_i a_{i,j} + w_{i+1}a_{i+1,j}$ are that they must satisfy $w_i+w_{i+1}=1$ and $w_i x_i + w_{i+1} x_{i+1} = x_{i+1/2}$. These conditions enforce that the averaging is equivalent to linear interpolation to the face center, which is precisely what the derived formula accomplishes.", "answer": "$$\\boxed{\\frac{\\Delta x_{i+1} a_{i,j} + \\Delta x_i a_{i+1,j}}{\\Delta x_i + \\Delta x_{i+1}}}$$", "id": "3393670"}, {"introduction": "Real-world diffusion often occurs across composite materials with sharp interfaces, where properties like conductivity change abruptly. This practical exercise [@problem_id:3393695] challenges you to implement a finite difference scheme that correctly handles such discontinuities in one dimension by deriving an effective conductivity based on the physical principle of flux continuity. Comparing your numerical results to the exact solution reveals the critical importance of using a harmonic average for the coefficient $k(x)$, rather than a simple arithmetic one.", "problem": "Consider the one-dimensional steady-state diffusion governed by the conservation of flux and Fick's law: the diffusive flux $q(x)$ satisfies $q(x) = -k(x)\\,u_x(x)$ where $k(x)$ is a spatially varying conductivity, and steady balance implies $q_x(x) = 0$. Together these give the second-order Partial Differential Equation (PDE) $-(k(x)\\,u_x(x))_x = 0$ on the domain $x \\in (0,1)$, with Dirichlet boundary conditions $u(0) = u_L$ and $u(1) = u_R$. The conductivity $k(x)$ is discontinuous across a finite set of interfaces; specifically, there exist ordered interface positions $\\{\\alpha_1,\\alpha_2,\\dots,\\alpha_{m-1}\\}$ with $0 = \\alpha_0 < \\alpha_1 < \\cdots < \\alpha_{m-1} < \\alpha_m = 1$, such that $k(x) = k_j$ for $x \\in [\\alpha_{j-1},\\alpha_j)$ and $j \\in \\{1,2,\\dots,m\\}$. Across each interface $x = \\alpha_j$, physical consistency requires continuity of the solution $u(x)$ and continuity of the flux $k(x)\\,u_x(x)$.\nYour tasks are:\n- Starting from the conservation law $q_x(x) = 0$ and Fick's law $q(x) = -k(x)\\,u_x(x)$, derive a robust finite difference approximation on a uniform grid of $N$ points $x_i = i\\,h$ with $h = 1/(N-1)$, enforcing the interface conditions implicitly through face fluxes. Use control volumes around interior grid points $x_i$ for $i \\in \\{1,2,\\dots,N-2\\}$ and obtain a discrete balance that conserves flux through each control volume.\n- Show that the discrete flux across each face $(x_i,x_{i+1})$ can be consistently represented by an effective conductivity $k_{i+1/2}$ multiplying the discrete gradient $(u_{i+1} - u_i)/h$, where $k_{i+1/2}$ arises from a local series composition of conductivities over the subinterval $(x_i,x_{i+1})$. Explicitly, for piecewise constant $k(x)$, the series law for resistances yields\n$$\nk_{i+1/2} = \\frac{h}{\\displaystyle \\int_{x_i}^{x_{i+1}} \\frac{1}{k(x)}\\,dx }.\n$$\n- Assemble the resulting tridiagonal linear system for the interior unknowns $\\{u_i\\}_{i=1}^{N-2}$, incorporating the Dirichlet boundary conditions through the right-hand side.\n- For the zero-source case $-(k(x)\\,u_x(x))_x = 0$ with piecewise constant $k(x)$ and Dirichlet boundary conditions, derive the exact solution in terms of the cumulative integral of $1/k(x)$:\n$$\nu(x) = u_L + (u_R - u_L)\\,\\frac{\\displaystyle \\int_0^x \\frac{1}{k(s)}\\,ds}{\\displaystyle \\int_0^1 \\frac{1}{k(s)}\\,ds}.\n$$\nUse this exact solution to compute the error of your numerical method.\n\nAll variables in this problem are non-dimensional; no physical units are required. Angles are not involved in this problem.\n\nImplement a complete program that:\n- Constructs the uniform grid.\n- Computes the effective face conductivities $k_{i-1/2}$ and $k_{i+1/2}$ from the series law over each face interval $(x_{i-1},x_i)$ and $(x_i,x_{i+1})$ using the given $\\{\\alpha_j\\}$ and $\\{k_j\\}$.\n- Assembles and solves the tridiagonal linear system for the interior unknowns with the given Dirichlet boundary data.\n- Evaluates the exact solution on the grid and computes the maximum absolute error over all grid points.\n- Executes the following test suite of parameter values and outputs the maximum absolute error for each case, in a single line as specified below.\n\nTest suite (each case specified by $(N,\\boldsymbol{\\alpha},\\boldsymbol{k},u_L,u_R)$):\n1. Case A (happy path, single interface): $(N = 201,\\ \\boldsymbol{\\alpha} = [0.37],\\ \\boldsymbol{k} = [1.0,4.0],\\ u_L = 0.0,\\ u_R = 1.0)$.\n2. Case B (interface near boundary): $(N = 201,\\ \\boldsymbol{\\alpha} = [0.001],\\ \\boldsymbol{k} = [2.0,0.5],\\ u_L = 0.0,\\ u_R = 1.0)$.\n3. Case C (extreme contrast ratio): $(N = 401,\\ \\boldsymbol{\\alpha} = [0.7333333],\\ \\boldsymbol{k} = [10^{-6},1.0],\\ u_L = 0.0,\\ u_R = 1.0)$.\n4. Case D (two interfaces): $(N = 301,\\ \\boldsymbol{\\alpha} = [0.2,0.8],\\ \\boldsymbol{k} = [1.0,10.0,0.1],\\ u_L = 0.0,\\ u_R = 1.0)$.\n\nRequired final output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For the above four cases, the program must print exactly one line in the format $[e_A,e_B,e_C,e_D]$, where each entry is the maximum absolute error for the corresponding case, represented as a decimal number.", "solution": "We begin from the fundamental balance laws. In steady state diffusion, the diffusive flux $q(x)$ obeys the conservation law $q_x(x) = 0$, and Fick's law relates flux to gradient via $q(x) = -k(x)\\,u_x(x)$, where $k(x)$ is the conductivity. Combining these yields the second-order Partial Differential Equation (PDE)\n$$\n-(k(x)\\,u_x(x))_x = 0 \\quad \\text{for } x \\in (0,1),\n$$\nwith Dirichlet boundary conditions $u(0) = u_L$ and $u(1) = u_R$. At any interface $x=\\alpha_j$ where $k(x)$ is discontinuous, the physical requirements are continuity of $u(x)$ and continuity of the flux $k(x)\\,u_x(x)$. These interface conditions follow from conservation of mass and the absence of singular sources.\n\nTo discretize, we use a finite volume method on a uniform grid of $N$ points $x_i = i\\,h$ with $h = 1/(N-1)$. For each interior node $x_i$, $i \\in \\{1,2,\\dots,N-2\\}$, integrating the conservation law over a control volume centered at $x_i$ yields a balance of fluxes at the control volume faces:\n$$\nq(x_{i+1/2}) - q(x_{i-1/2}) = 0.\n$$\nApproximating the flux at each face $x_{i+1/2}$ (located between nodes $x_i$ and $x_{i+1}$) using a two-point approximation gives\n$$\nq(x_{i+1/2}) \\approx -k_{i+1/2}\\,\\frac{u_{i+1} - u_i}{h}, \\quad q(x_{i-1/2}) \\approx -k_{i-1/2}\\,\\frac{u_i - u_{i-1}}{h},\n$$\nwhere $k_{i\\pm 1/2}$ are effective face conductivities. Substituting, we obtain the discrete conservation\n$$\n-k_{i+1/2}\\,\\frac{u_{i+1} - u_i}{h} + k_{i-1/2}\\,\\frac{u_i - u_{i-1}}{h} = 0.\n$$\nMultiplying by $h$ and rearranging yields the symmetric tridiagonal stencil\n$$\n-k_{i-1/2}\\,u_{i-1} + \\left(k_{i-1/2} + k_{i+1/2}\\right)\\,u_i - k_{i+1/2}\\,u_{i+1} = 0,\n$$\nvalid for each interior index $i \\in \\{1,2,\\dots,N-2\\}$. Incorporating Dirichlet boundary conditions $u_0 = u_L$ and $u_{N-1} = u_R$ moves the boundary contributions to the right-hand side:\n$$\n-k_{i-1/2}\\,u_{i-1} + \\left(k_{i-1/2} + k_{i+1/2}\\right)\\,u_i - k_{i+1/2}\\,u_{i+1} =\n\\begin{cases}\nk_{i-1/2}\\,u_L & \\text{if } i=1,\\\\\n0 & \\text{if } 1 < i < N-2,\\\\\nk_{i+1/2}\\,u_R & \\text{if } i=N-2.\n\\end{cases}\n$$\nThis linear system is symmetric and strictly diagonally dominant because $k_{i\\pm 1/2} > 0$, ensuring a unique solution and stability.\n\nThe key issue in interface problems is the choice of effective face conductivity $k_{i+1/2}$. For smooth $k(x)$, midpoint or arithmetic averages would suffice to achieve second-order accuracy. However, at discontinuities of $k(x)$ within an interval $(x_i,x_{i+1})$, naively sampling $k$ at a point fails to capture the correct flux continuity. The correct effective conductivity is obtained from the series law for resistances. Over the interval $(x_i,x_{i+1})$ with length $h$, the flux is constant and the drop in $u$ is the sum of drops across subsegments:\n$$\nu_{i+1} - u_i = \\int_{x_i}^{x_{i+1}} u_x(s)\\,ds = -\\int_{x_i}^{x_{i+1}} \\frac{q}{k(s)}\\,ds = -q\\int_{x_i}^{x_{i+1}} \\frac{1}{k(s)}\\,ds.\n$$\nSolving for the flux $q$ gives\n$$\nq = -\\frac{u_{i+1} - u_i}{\\displaystyle \\int_{x_i}^{x_{i+1}} \\frac{1}{k(s)}\\,ds}.\n$$\nComparing with the discrete flux $q \\approx -k_{i+1/2}\\,\\frac{u_{i+1}-u_i}{h}$ yields the effective face conductivity\n$$\nk_{i+1/2} = \\frac{h}{\\displaystyle \\int_{x_i}^{x_{i+1}} \\frac{1}{k(s)}\\,ds}.\n$$\nFor piecewise constant $k(x)$ with interfaces $\\{\\alpha_j\\}$, the integral $\\int_{x_i}^{x_{i+1}} 1/k(s)\\,ds$ decomposes into a finite sum over overlapping subsegments with lengths $\\ell_j$ inside each material:\n$$\n\\int_{x_i}^{x_{i+1}} \\frac{1}{k(s)}\\,ds = \\sum_{j=1}^{m} \\frac{\\ell_j}{k_j}, \\quad \\text{where } \\ell_j = \\max\\{0, \\min(x_{i+1},\\alpha_j) - \\max(x_i,\\alpha_{j-1})\\}.\n$$\nThus,\n$$\nk_{i+1/2} = \\frac{h}{\\displaystyle \\sum_{j=1}^{m} \\frac{\\ell_j}{k_j} }.\n$$\nWhen $(x_i,x_{i+1})$ lies entirely inside a single material, this reduces to $k_{i+1/2} = k_j$. When $(x_i,x_{i+1})$ straddles a single interface and $k$ is piecewise constant on each side, the above formula is the exact series combination of conductivities across the two subsegments, which generalizes the familiar harmonic mean (recovered when the interface lies exactly halfway between the nodes, i.e., $\\ell_{\\text{left}} = \\ell_{\\text{right}} = h/2$).\n\nFor the zero-source governing PDE, an exact solution is available from integrating $u_x = -q/k(x)$ with constant flux $q$ and applying Dirichlet boundary conditions:\n$$\nu(x) = u_L + (u_R - u_L)\\,\\frac{\\displaystyle \\int_0^x \\frac{1}{k(s)}\\,ds}{\\displaystyle \\int_0^1 \\frac{1}{k(s)}\\,ds}.\n$$\nBecause $k(x)$ is piecewise constant, $\\int_0^x \\frac{1}{k(s)}\\,ds$ is a piecewise linear function of $x$ whose slopes are $1/k_j$ within each material interval $[\\alpha_{j-1},\\alpha_j)$, and the denominator $\\int_0^1 \\frac{1}{k(s)}\\,ds$ is the total sum of interval lengths divided by their conductivities.\n\nAlgorithmic steps for the program:\n1. Construct the uniform grid $\\{x_i\\}_{i=0}^{N-1}$ and set Dirichlet values $u_0 = u_L$, $u_{N-1} = u_R$.\n2. For each interior index $i \\in \\{1,\\dots,N-2\\}$, compute $k_{i-1/2}$ and $k_{i+1/2}$ via the series law:\n   - For the face interval $(x_{i-1},x_i)$, compute overlapping subsegment lengths $\\ell_j = \\max\\{0, \\min(x_i,\\alpha_j) - \\max(x_{i-1},\\alpha_{j-1})\\}$, then set $k_{i-1/2} = h / \\sum_j (\\ell_j/k_j)$.\n   - Similarly for $(x_i,x_{i+1})$ to obtain $k_{i+1/2}$.\n3. Assemble the tridiagonal system\n   $$\n   -k_{i-1/2}\\,u_{i-1} + \\left(k_{i-1/2}+k_{i+1/2}\\right)\\,u_i - k_{i+1/2}\\,u_{i+1} = b_i,\n   $$\n   with $b_1 = k_{1-1/2}\\,u_L$, $b_i=0$ for $1<i<N-2$, and $b_{N-2} = k_{N-2+1/2}\\,u_R$.\n4. Solve for the interior unknowns and assemble the full solution vector $\\{u_i\\}$ including boundaries.\n5. Compute the exact solution on the grid using the cumulative integral of $1/k(x)$ and evaluate the maximum absolute error $\\max_i |u_i^{\\text{num}} - u_i^{\\text{exact}}|$.\n6. Apply the above to the four test cases and produce a single-line output in the required format.\n\nThis discretization is consistent with the conservation law and rigorously enforces flux continuity across interfaces through the series-law effective conductivities. The resulting linear system is symmetric positive definite, so numerical solution via direct methods is straightforward. The error measures quantify the method's accuracy in the presence of discontinuous coefficients and varying interface configurations.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef overlap_length(a_start, a_end, b_start, b_end):\n    \"\"\"Length of overlap between intervals [a_start, a_end] and [b_start, b_end].\"\"\"\n    left = max(a_start, b_start)\n    right = min(a_end, b_end)\n    return max(0.0, right - left)\n\ndef effective_conductivity_on_interval(xL, xR, alphas, ks):\n    \"\"\"\n    Compute the effective conductivity over [xL, xR] for piecewise-constant k defined\n    by interfaces 'alphas' (sorted ascending) and values 'ks' per segment.\n    Uses the series law: k_eff = (xR - xL) / sum_j (overlap_j / k_j).\n    \"\"\"\n    # Build segment boundaries: [0, alpha1, alpha2, ..., 1]\n    boundaries = [0.0] + list(alphas) + [1.0]\n    denom = 0.0\n    for j in range(len(ks)):\n        seg_start = boundaries[j]\n        seg_end = boundaries[j + 1]\n        ell = overlap_length(xL, xR, seg_start, seg_end)\n        if ell > 0.0:\n            denom += ell / ks[j]\n    # denom should be positive since xR > xL and ks[j] > 0\n    if denom <= 0.0:\n        # This should not happen, but guard against numerical issues.\n        return 0.0\n    return (xR - xL) / denom\n\ndef assemble_and_solve(N, alphas, ks, uL, uR):\n    \"\"\"\n    Assemble the tridiagonal system for -(k u')' = 0 with Dirichlet BCs\n    using effective face conductivities, solve, and return the grid, numerical solution.\n    \"\"\"\n    x = np.linspace(0.0, 1.0, N)\n    h = x[1] - x[0]\n    M = N - 2  # number of interior points\n    if M <= 0:\n        # Trivial grid with only boundaries\n        u = np.array([uL, uR]) if N == 2 else np.array([uL])\n        return x, u\n\n    # Precompute face conductivities k_{i-1/2} and k_{i+1/2} for interior stencils\n    k_left_face = np.zeros(M)\n    k_right_face = np.zeros(M)\n    for i in range(1, N - 1):  # i = 1..N-2\n        im = i - 1  # interior index 0..M-1\n        k_left_face[im] = effective_conductivity_on_interval(x[i - 1], x[i], alphas, ks)\n        k_right_face[im] = effective_conductivity_on_interval(x[i], x[i + 1], alphas, ks)\n\n    # Assemble tridiagonal matrix A and RHS b\n    diag = k_left_face + k_right_face\n    lower = -k_left_face[1:]   # subdiagonal A[i,i-1] for i=1..M-1\n    upper = -k_right_face[:-1] # superdiagonal A[i,i+1] for i=0..M-2\n    b = np.zeros(M)\n    # Boundary contributions\n    b[0] += k_left_face[0] * uL\n    b[-1] += k_right_face[-1] * uR\n\n    # Build full matrix for solve (small sizes acceptable)\n    A = np.zeros((M, M))\n    np.fill_diagonal(A, diag)\n    np.fill_diagonal(A[1:], lower)       # subdiagonal\n    np.fill_diagonal(A[:, 1:], upper)    # superdiagonal\n\n    # Solve for interior unknowns\n    u_interior = np.linalg.solve(A, b)\n\n    # Assemble full solution including boundaries\n    u = np.zeros(N)\n    u[0] = uL\n    u[-1] = uR\n    u[1:-1] = u_interior\n    return x, u\n\ndef integral_invk_up_to(x, alphas, ks):\n    \"\"\"\n    Compute S(x) = int_0^x (1/k(s)) ds for piecewise-constant k defined by 'alphas' and 'ks'.\n    \"\"\"\n    boundaries = [0.0] + list(alphas) + [1.0]\n    S = 0.0\n    # Sum contributions from each segment up to x\n    for j in range(len(ks)):\n        seg_start = boundaries[j]\n        seg_end = boundaries[j + 1]\n        if x <= seg_start:\n            break\n        contrib_end = min(x, seg_end)\n        length = max(0.0, contrib_end - seg_start)\n        S += length / ks[j]\n        if x < seg_end:\n            break\n    return S\n\ndef exact_solution_on_grid(x, alphas, ks, uL, uR):\n    \"\"\"\n    Exact solution for -(k u')' = 0 with Dirichlet BCs:\n    u(x) = uL + (uR - uL) * S(x) / S(1), where S(x) = int_0^x 1/k(s) ds.\n    \"\"\"\n    S1 = integral_invk_up_to(1.0, alphas, ks)\n    # Handle degenerate case (should not happen for positive ks)\n    if S1 <= 0.0:\n        return np.full_like(x, uL)\n    u_exact = np.empty_like(x)\n    for i, xi in enumerate(x):\n        Sx = integral_invk_up_to(xi, alphas, ks)\n        u_exact[i] = uL + (uR - uL) * (Sx / S1)\n    return u_exact\n\ndef max_abs_error(u_num, u_exact):\n    return float(np.max(np.abs(u_num - u_exact)))\n\ndef run_case(N, alphas, ks, uL, uR):\n    x, u_num = assemble_and_solve(N, alphas, ks, uL, uR)\n    u_exact = exact_solution_on_grid(x, alphas, ks, uL, uR)\n    return max_abs_error(u_num, u_exact)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A: (N, alphas, ks, uL, uR)\n        (201, [0.37], [1.0, 4.0], 0.0, 1.0),\n        # Case B: interface near boundary\n        (201, [0.001], [2.0, 0.5], 0.0, 1.0),\n        # Case C: extreme contrast ratio\n        (401, [0.7333333], [1.0e-6, 1.0], 0.0, 1.0),\n        # Case D: two interfaces\n        (301, [0.2, 0.8], [1.0, 10.0, 0.1], 0.0, 1.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, alphas, ks, uL, uR = case\n        err = run_case(N, alphas, ks, uL, uR)\n        results.append(err)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3393695"}, {"introduction": "Moving to multiple dimensions, material interfaces are rarely aligned with the grid, leading to a \"staircasing\" error that can degrade accuracy. This advanced practice [@problem_id:3393723] has you investigate this very issue by computing the flux across a grid face that is cut by a smooth, circular interface. By comparing a simple midpoint sampling of the coefficient $a(\\mathbf{x})$ with a more accurate subcell integration, you will quantify a key source of error in simulations involving complex, non-grid-aligned geometries.", "problem": "Consider the scalar diffusion operator in two spatial dimensions defined by the partial differential equation $-\\nabla \\cdot \\left(a(\\mathbf{x}) \\nabla u(\\mathbf{x})\\right) = f(\\mathbf{x})$, where $a(\\mathbf{x})$ is a positive diffusion coefficient that may be discontinuous and $u(\\mathbf{x})$ is a sufficiently smooth scalar field. Focus on fluxes across Cartesian grid faces as used in finite volume and finite difference discretizations: the normal flux across a vertical face located at $x = x_{i+\\frac{1}{2}}$ and spanning $y \\in [y_{j-\\frac{1}{2}}, y_{j+\\frac{1}{2}}]$ is given by the line integral\n$$\nF^{\\text{true}}_{i+\\frac{1}{2},j} = \\int_{y_{j-\\frac{1}{2}}}^{y_{j+\\frac{1}{2}}} a\\left(x_{i+\\frac{1}{2}}, y\\right) \\, \\frac{\\partial u}{\\partial x}\\left(x_{i+\\frac{1}{2}}, y\\right) \\, dy.\n$$\nOn a uniform mesh of the unit square domain $[0,1] \\times [0,1]$ with $N$ cells per direction and mesh width $h = 1/N$, define cell centers $(x_i, y_j) = \\left(\\left(i+\\frac{1}{2}\\right)h, \\left(j+\\frac{1}{2}\\right)h\\right)$ and vertical faces at $x_{i+\\frac{1}{2}} = (i+1)h$ with $y \\in [y_{j-\\frac{1}{2}}, y_{j+\\frac{1}{2}}] = [jh, (j+1)h]$.\n\nAssume a piecewise constant diffusion coefficient $a(\\mathbf{x})$ that jumps across a smooth curve, specifically a circle centered at $(c_x, c_y)$ with radius $r$:\n$$\na(x,y) = \\begin{cases}\na_{\\mathrm{in}}, & (x - c_x)^2 + (y - c_y)^2 \\le r^2, \\\\\na_{\\mathrm{out}}, & (x - c_x)^2 + (y - c_y)^2 > r^2,\n\\end{cases}\n$$\nwhere $a_{\\mathrm{in}} > 0$ and $a_{\\mathrm{out}} > 0$ are constants. Consider a manufactured scalar field\n$$\nu(x,y) = x\\,(1 + c\\,y),\n$$\nwith a constant $c \\in \\mathbb{R}$, so that\n$$\n\\frac{\\partial u}{\\partial x}(x,y) = 1 + c\\,y.\n$$\n\nInvestigate the staircasing error that arises when approximating the normal flux across vertical faces in the presence of the discontinuity of $a(x,y)$ along the smooth circle, by comparing two discrete flux approximations:\n\n1. A standard midpoint-sampled finite difference flux,\n$$\nF^{\\mathrm{std}}_{i+\\frac{1}{2},j} = a\\!\\left(x_{i+\\frac{1}{2}}, y_j\\right)\\,\\left[u\\!\\left(x_{i+1}, y_j\\right) - u\\!\\left(x_{i}, y_j\\right)\\right],\n$$\nwhich, for the given $u$, simplifies to $F^{\\mathrm{std}}_{i+\\frac{1}{2},j} = h\\,a\\!\\left(x_{i+\\frac{1}{2}}, y_j\\right)\\,(1 + c\\,y_j)$.\n\n2. A subcell flux integration that accounts for the fraction of the face lying inside versus outside the circle by integrating the coefficient along the face, but still using the face-centered approximation for the derivative,\n$$\nF^{\\mathrm{sub}}_{i+\\frac{1}{2},j} = \\left(\\frac{u\\!\\left(x_{i+1}, y_j\\right) - u\\!\\left(x_{i}, y_j\\right)}{h}\\right) \\int_{y_{j-\\frac{1}{2}}}^{y_{j+\\frac{1}{2}}} a\\!\\left(x_{i+\\frac{1}{2}}, y\\right)\\,dy,\n$$\nwhich, for the given $u$, simplifies to $F^{\\mathrm{sub}}_{i+\\frac{1}{2},j} = (1 + c\\,y_j)\\,\\Big(a_{\\mathrm{in}}\\,L_{\\mathrm{in}} + a_{\\mathrm{out}}\\,L_{\\mathrm{out}}\\Big)$, where $L_{\\mathrm{in}}$ is the length of the face segment inside the circle and $L_{\\mathrm{out}} = h - L_{\\mathrm{in}}$.\n\nThe exact flux across the face is\n$$\nF^{\\mathrm{true}}_{i+\\frac{1}{2},j} = a_{\\mathrm{in}} \\int_{\\mathcal{I}_{\\mathrm{in}}} (1 + c\\,y)\\,dy + a_{\\mathrm{out}} \\int_{\\mathcal{I}_{\\mathrm{out}}} (1 + c\\,y)\\,dy,\n$$\nwhere $\\mathcal{I}_{\\mathrm{in}}$ and $\\mathcal{I}_{\\mathrm{out}}$ denote the subsets of $[y_{j-\\frac{1}{2}}, y_{j+\\frac{1}{2}}]$ inside and outside the circle along the vertical line $x = x_{i+\\frac{1}{2}}$. Note that if the face is entirely inside or entirely outside the circle, then both $F^{\\mathrm{std}}_{i+\\frac{1}{2},j}$ and $F^{\\mathrm{sub}}_{i+\\frac{1}{2},j}$ coincide with $F^{\\mathrm{true}}_{i+\\frac{1}{2},j}$ because the midpoint rule is exact for linear integrands.\n\nStarting from the definitions above and the geometric characterization of the intersection of a vertical line $x = x_{i+\\frac{1}{2}}$ with the circle, derive expressions for $L_{\\mathrm{in}}$ and the exact integrals needed for $F^{\\mathrm{true}}_{i+\\frac{1}{2},j}$. Implement a program that, for each vertical face in the grid, computes the absolute errors\n$$\nE^{\\mathrm{std}}_{i+\\frac{1}{2},j} = \\left|F^{\\mathrm{std}}_{i+\\frac{1}{2},j} - F^{\\mathrm{true}}_{i+\\frac{1}{2},j}\\right|, \\quad E^{\\mathrm{sub}}_{i+\\frac{1}{2},j} = \\left|F^{\\mathrm{sub}}_{i+\\frac{1}{2},j} - F^{\\mathrm{true}}_{i+\\frac{1}{2},j}\\right|.\n$$\nAggregate each error measure over all faces by reporting the maximum absolute error for each method,\n$$\nE^{\\mathrm{std}}_{\\max} = \\max_{i,j} E^{\\mathrm{std}}_{i+\\frac{1}{2},j}, \\quad E^{\\mathrm{sub}}_{\\max} = \\max_{i,j} E^{\\mathrm{sub}}_{i+\\frac{1}{2},j}.\n$$\n\nYour program must evaluate four test cases to probe different regimes of staircasing and geometric intersection. The test suite parameters $(N, r, c_x, c_y, a_{\\mathrm{in}}, a_{\\mathrm{out}}, c)$ are:\n\n- Test 1 (general case with pronounced jump and moderate mesh): $(N=64, r=0.35, c_x=0.5, c_y=0.5, a_{\\mathrm{in}}=0.1, a_{\\mathrm{out}}=10.0, c=0.5)$.\n- Test 2 (constant derivative to isolate coefficient integration effects): $(N=32, r=0.35, c_x=0.5, c_y=0.5, a_{\\mathrm{in}}=0.1, a_{\\mathrm{out}}=10.0, c=0.0)$.\n- Test 3 (large circle near domain-wide intersection and stronger $y$-variation): $(N=64, r=0.49, c_x=0.5, c_y=0.5, a_{\\mathrm{in}}=0.2, a_{\\mathrm{out}}=5.0, c=1.0)$.\n- Test 4 (finer mesh, small offset circle, mild $y$-variation): $(N=128, r=0.12, c_x=0.4, c_y=0.6, a_{\\mathrm{in}}=0.5, a_{\\mathrm{out}}=2.0, c=0.3)$.\n\nFor each test case, compute $(E^{\\mathrm{std}}_{\\max}, E^{\\mathrm{sub}}_{\\max})$ as floating-point values. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered sequentially by test case and method, i.e., $[E^{\\mathrm{std}}_{\\max}\\text{(Test 1)}, E^{\\mathrm{sub}}_{\\max}\\text{(Test 1)}, E^{\\mathrm{std}}_{\\max}\\text{(Test 2)}, E^{\\mathrm{sub}}_{\\max}\\text{(Test 2)}, E^{\\mathrm{std}}_{\\max}\\text{(Test 3)}, E^{\\mathrm{sub}}_{\\max}\\text{(Test 3)}, E^{\\mathrm{std}}_{\\max}\\text{(Test 4)}, E^{\\mathrm{sub}}_{\\max}\\text{(Test 4)}]$. No physical units or angle units are involved, and the output values should be reported as raw floating-point numbers without any rounding specification imposed beyond default numerical precision.", "solution": "The central task is to quantify the error introduced by two common finite difference/volume approximations for the flux across a grid cell face when the diffusion coefficient $a(\\mathbf{x})$ is discontinuous. We are given the true flux and two approximations, and we must derive the necessary formulas to compute them and their respective errors.\n\nThe physical model is the steady-state diffusion equation $-\\nabla \\cdot \\left(a(\\mathbf{x}) \\nabla u(\\mathbf{x})\\right) = f(\\mathbf{x})$. The analysis focuses on the normal flux across a vertical face, located at $x = x_{i+\\frac{1}{2}}$ and spanning the interval $y \\in [y_{j-\\frac{1}{2}}, y_{j+\\frac{1}{2}}]$. On a uniform grid with spacing $h=1/N$, the face is at $x_{i+\\frac{1}{2}} = (i+1)h$ and spans the $y$-interval $[y_{\\text{low}}, y_{\\text{high}}] = [jh, (j+1)h]$. The scalar field is specified as $u(x,y) = x(1+cy)$, for which the gradient component $\\frac{\\partial u}{\\partial x} = 1+cy$ is linear in $y$.\n\nThe three flux quantities for a face $(i,j)$ are:\n$1$. The true flux, which is the exact integral:\n$$\nF^{\\text{true}}_{i+\\frac{1}{2},j} = \\int_{y_{j-\\frac{1}{2}}}^{y_{j+\\frac{1}{2}}} a\\left(x_{i+\\frac{1}{2}}, y\\right) \\left(1 + c\\,y\\right) \\, dy\n$$\n$2$. The standard midpoint-sampled flux, which approximates the integrand at the face center $(x_{i+\\frac{1}{2}}, y_j)$, where $y_j=(j+\\frac{1}{2})h$:\n$$\nF^{\\mathrm{std}}_{i+\\frac{1}{2},j} = h \\cdot a\\left(x_{i+\\frac{1}{2}}, y_j\\right) \\left(1 + c\\,y_j\\right)\n$$\n$3$. The subcell-integrated flux, which separates the averaging of the coefficient and the gradient:\n$$\nF^{\\mathrm{sub}}_{i+\\frac{1}{2},j} = \\left(1 + c\\,y_j\\right) \\int_{y_{j-\\frac{1}{2}}}^{y_{j+\\frac{1}{2}}} a\\left(x_{i+\\frac{1}{2}}, y\\right) \\, dy\n$$\n\nThe core of the problem lies in evaluating these quantities, which requires a precise geometric analysis of the intersection between each vertical face and the circular discontinuity of $a(\\mathbf{x})$.\n\n**Geometric Analysis and Integration**\nThe diffusion coefficient is $a_{\\mathrm{in}}$ inside the circle $(x - c_x)^2 + (y - c_y)^2 = r^2$ and $a_{\\mathrm{out}}$ outside. For a vertical face at a fixed $x=x_{\\text{face}} = (i+1)h$, we first determine if it intersects the circle by checking if $|x_{\\text{face}} - c_x| \\le r$.\n\nIf $|x_{\\text{face}} - c_x| > r$, the face is entirely outside the circle. The coefficient $a(x_{\\text{face}}, y)$ is constant at $a_{\\text{out}}$ along the entire face. In this case, all three flux formulations are equivalent because the one-point midpoint quadrature rule is exact for the linear integrand $(1+cy)$.\n\nIf $|x_{\\text{face}} - c_x| \\le r$, the face is cut by the circle. The vertical line intersects the circle at two $y$-coordinates:\n$$\ny_{\\text{int}} = c_y \\pm \\sqrt{r^2 - (x_{\\text{face}} - c_x)^2}\n$$\nLet these intersection points be $y_{\\text{int,low}}$ and $y_{\\text{int,high}}$. The portion of the face that lies inside the circle is the intersection of its $y$-interval $[y_{\\text{low}}, y_{\\text{high}}]$ with the circle's chord $[y_{\\text{int,low}}, y_{\\text{int,high}}]$. Let this intersection be the interval $\\mathcal{I}_{\\mathrm{in}} = [y_a, y_b]$, where $y_a = \\max(y_{\\text{low}}, y_{\\text{int,low}})$ and $y_b = \\min(y_{\\text{high}}, y_{\\text{int,high}})$. The length of this segment is $L_{\\mathrm{in}} = \\max(0, y_b - y_a)$. The remainder of the face has length $L_{\\mathrm{out}} = h - L_{\\mathrm{in}}$.\n\n**Flux Calculation**\nWith the intersection geometry established, we can formulate the computable expressions for the fluxes. Let $g(y) = 1+cy$ be the gradient term. Its primitive is $G(y) = \\int g(y)dy = y + \\frac{c}{2}y^2$. Integrals of $g(y)$ over an interval $[y_1, y_2]$ are computed as $G(y_2) - G(y_1)$.\n\nThe integral of the coefficient $a(x,y)$ along the face is:\n$$\n\\int_{y_{\\text{low}}}^{y_{\\text{high}}} a(x_{\\text{face}}, y)\\,dy = a_{\\mathrm{in}}L_{\\mathrm{in}} + a_{\\mathrm{out}}L_{\\mathrm{out}} = a_{\\mathrm{in}}L_{\\mathrm{in}} + a_{\\mathrm{out}}(h - L_{\\mathrm{in}}) = (a_{\\mathrm{in}} - a_{\\mathrm{out}})L_{\\mathrm{in}} + a_{\\mathrm{out}}h\n$$\n\nThe true flux is $F^{\\text{true}} = \\int_{y_{\\text{low}}}^{y_{\\text{high}}} a(x_{\\text{face}}, y)g(y)dy$. This can be efficiently computed as:\n$$\nF^{\\text{true}} = a_{\\mathrm{out}} \\int_{y_{\\text{low}}}^{y_{\\text{high}}} g(y)dy + (a_{\\mathrm{in}} - a_{\\mathrm{out}}) \\int_{\\mathcal{I}_{\\mathrm{in}}} g(y)dy\n$$\n$$\nF^{\\text{true}} = a_{\\mathrm{out}}(G(y_{\\text{high}}) - G(y_{\\text{low}})) + (a_{\\mathrm{in}} - a_{\\mathrm{out}})(G(y_b) - G(y_a))\n$$\nwhere the second term is zero if $L_{\\mathrm{in}}=0$.\n\nThe subcell flux is:\n$$\nF^{\\mathrm{sub}} = g(y_j) \\int_{y_{\\text{low}}}^{y_{\\text{high}}} a(x_{\\text{face}}, y)dy = (1+cy_j) \\left( (a_{\\mathrm{in}} - a_{\\mathrm{out}})L_{\\mathrm{in}} + a_{\\mathrm{out}}h \\right)\n$$\nThe error in this approximation, $E^{\\mathrm{sub}} = |F^{\\mathrm{sub}} - F^{\\text{true}}|$, arises from decoupling the integral of the product into a product of integrals (approximating one with a midpoint value). This error is proportional to the covariance of $a(x_{\\text{face}}, y)$ and $g(y)$ along the face. If $c=0$, $g(y)=1$ is constant, the covariance is zero, and thus $E^{\\mathrm{sub}}$ must be zero.\n\nThe standard flux is:\n$$\nF^{\\mathrm{std}} = h \\cdot g(y_j) \\cdot a(x_{\\text{face}}, y_j)\n$$\nwhere $a(x_{\\text{face}}, y_j)$ is $a_{\\mathrm{in}}$ if the face midpoint $(x_{\\text{face}}, y_j)$ is inside the circle, and $a_{\\mathrm{out}}$ otherwise. The error $E^{\\mathrm{std}} = |F^{\\mathrm{std}} - F^{\\text{true}}|$ is a manifestation of \"staircasing,\" as the discontinuous coefficient is approximated by a single sample, ignoring sub-cell variations. This error is generally non-zero even if $c=0$.\n\n**Algorithm**\nThe algorithm proceeds by iterating through each test case. For each case, it initializes the maximum errors $E^{\\mathrm{std}}_{\\max}$ and $E^{\\mathrm{sub}}_{\\max}$ to $0$. It then loops over all interior vertical faces, indexed by $i \\in \\{0, \\dots, N-2\\}$ and $j \\in \\{0, \\dots, N-1\\}$. For each face, it performs the geometric analysis to find $L_{\\mathrm{in}}$ and the integration interval $\\mathcal{I}_{\\mathrm{in}}$. It then computes $F^{\\text{true}}$, $F^{\\mathrm{std}}$, and $F^{\\mathrm{sub}}$ using the derived formulas. The absolute errors are calculated, and the maximums are updated. This process is vectorized over the $j$ index for efficiency. Finally, the pair of maximum errors $(E^{\\mathrm{std}}_{\\max}, E^{\\mathrm{sub}}_{\\max})$ is stored for the test case.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Format: (N, r, c_x, c_y, a_in, a_out, c)\n    test_cases = [\n        (64, 0.35, 0.5, 0.5, 0.1, 10.0, 0.5),\n        (32, 0.35, 0.5, 0.5, 0.1, 10.0, 0.0),\n        (64, 0.49, 0.5, 0.5, 0.2, 5.0, 1.0),\n        (128, 0.12, 0.4, 0.6, 0.5, 2.0, 0.3),\n    ]\n\n    results = []\n    for case in test_cases:\n        E_std_max, E_sub_max = compute_errors_for_case(*case)\n        results.extend([E_std_max, E_sub_max])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef compute_errors_for_case(N, r, c_x, c_y, a_in, a_out, c):\n    \"\"\"\n    Computes the maximum absolute errors for the standard and subcell flux\n    approximations for a single test case.\n    \"\"\"\n    h = 1.0 / N\n    max_std_err = 0.0\n    max_sub_err = 0.0\n\n    # Vectorized setup for y-coordinates over a column of faces\n    j_indices = np.arange(N)\n    y_low = j_indices * h\n    y_high = (j_indices + 1) * h\n    y_j_centers = (j_indices + 0.5) * h\n\n    # Primitive of the integrand g(y) = 1 + c*y\n    def G(y):\n        return y + 0.5 * c * y**2\n\n    # Loop over vertical face columns (indexed by i from 0 to N-2)\n    for i in range(N - 1):\n        x_face = (i + 1) * h\n        \n        # --- Geometric calculations ---\n        delta_x = x_face - c_x\n        \n        # Default intersection interval is empty.\n        y_a = y_low.copy() \n        y_b = y_low.copy()\n\n        if delta_x**2 <= r**2:\n            # Line intersects the circle\n            delta_y_intersect = np.sqrt(r**2 - delta_x**2)\n            y_int_low = c_y - delta_y_intersect\n            y_int_high = c_y + delta_y_intersect\n            \n            # Intersection of face's y-interval and circle's chord y-interval\n            y_a = np.maximum(y_low, y_int_low)\n            y_b = np.minimum(y_high, y_int_high)\n        \n        # Length of face segment inside the circle\n        L_in = np.maximum(0, y_b - y_a)\n\n        # --- Flux calculations (vectorized over j) ---\n        \n        # 1. True Flux (F_true)\n        # Integral of g(y) over the whole face interval\n        integral_face = G(y_high) - G(y_low)\n        # Integral of g(y) over the segment inside the circle\n        integral_in = G(y_b) - G(y_a)\n        # Correct for empty intersections where y_b <= y_a\n        integral_in[y_b <= y_a] = 0.0\n        \n        F_true = (a_in - a_out) * integral_in + a_out * integral_face\n        \n        # 2. Standard Midpoint Flux (F_std)\n        # Check if midpoint (x_face, y_j_centers) is inside the circle\n        dist_sq_mid = (x_face - c_x)**2 + (y_j_centers - c_y)**2\n        is_inside_midpoint = dist_sq_mid <= r**2\n        a_mid = np.where(is_inside_midpoint, a_in, a_out)\n        \n        F_std = h * a_mid * (1 + c * y_j_centers)\n        \n        # 3. Subcell Integrated Flux (F_sub)\n        L_out = h - L_in\n        effective_a_sub = a_in * L_in + a_out * L_out\n        \n        F_sub = (1 + c * y_j_centers) * effective_a_sub\n\n        # --- Error calculation and update ---\n        err_std = np.abs(F_std - F_true)\n        err_sub = np.abs(F_sub - F_true)\n        \n        max_std_err = max(max_std_err, np.max(err_std))\n        max_sub_err = max(max_sub_err, np.max(err_sub))\n            \n    return max_std_err, max_sub_err\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3393723"}]}