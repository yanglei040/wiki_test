{"hands_on_practices": [{"introduction": "A cornerstone of the finite element and Discontinuous Galerkin (DG) methods is the use of a reference element, which standardizes computations. This practice explores the fundamental mechanism of mapping from this reference space to the physical elements of a mesh. By deriving how the mass and stiffness matrices transform under an affine map, you will gain insight into how geometry, encapsulated by the Jacobian, is separated from the algebraic structure of the basis, a principle that applies to both nodal and modal formulations [@problem_id:3424466].", "problem": "Consider the one-dimensional Discontinuous Galerkin (DG) discretization of a second-order scalar partial differential equation on an element $e = [x_L, x_R]$. Let the reference element be $[-1, 1]$, and consider the affine mapping $x(\\xi) = \\dfrac{x_R - x_L}{2}\\,\\xi + \\dfrac{x_R + x_L}{2}$ with Jacobian $J = \\dfrac{x_R - x_L}{2}$. Let $\\{\\hat{\\phi}_i(\\xi)\\}_{i=0}^{p}$ be a polynomial basis on the reference element (which may be either nodal or modal), and define the corresponding physical-element basis by $\\phi_i(x) = \\hat{\\phi}_i(\\xi(x))$. The element mass and stiffness matrices are defined by\n$$\nM_{ij}^{e} = \\int_{x_L}^{x_R} \\phi_i(x)\\,\\phi_j(x)\\,dx,\\qquad \nK_{ij}^{e} = \\int_{x_L}^{x_R} \\frac{d\\phi_i}{dx}(x)\\,\\frac{d\\phi_j}{dx}(x)\\,dx.\n$$\nOn the reference element, define the mass and stiffness matrices\n$$\n\\hat{M}_{ij} = \\int_{-1}^{1} \\hat{\\phi}_i(\\xi)\\,\\hat{\\phi}_j(\\xi)\\,d\\xi,\\qquad \n\\hat{K}_{ij} = \\int_{-1}^{1} \\frac{d\\hat{\\phi}_i}{d\\xi}(\\xi)\\,\\frac{d\\hat{\\phi}_j}{d\\xi}(\\xi)\\,d\\xi.\n$$\nStarting from the change-of-variables theorem for integrals and the chain rule for derivatives, derive how integrals over $[x_L, x_R]$ transform under the affine map and determine precisely how the Jacobian $J$ appears in $M_{ij}^{e}$ and $K_{ij}^{e}$ in terms of $\\hat{M}_{ij}$ and $\\hat{K}_{ij}$. Provide all steps in your reasoning and do not assume any special properties of the basis beyond polynomiality and the pullback $\\phi_i(x) = \\hat{\\phi}_i(\\xi(x))$. \n\nGive your final answer as the pair $(M_{ij}^{e}, K_{ij}^{e})$ expressed only in terms of $J$, $\\hat{M}_{ij}$, and $\\hat{K}_{ij}$. Your final answer must be a single analytic expression and contain no equations or inequalities.", "solution": "The problem as stated is valid. It is a standard and well-posed problem in the theory of finite element and discontinuous Galerkin methods, based on established mathematical principles. All terms are clearly defined, and the premises are self-consistent and sufficient to derive the required relationships. We now proceed with the solution.\n\nThe objective is to relate the physical element matrices, $M_{ij}^{e}$ and $K_{ij}^{e}$, defined on the physical element $e = [x_L, x_R]$, to the reference element matrices, $\\hat{M}_{ij}$ and $\\hat{K}_{ij}$, defined on the reference element $[-1, 1]$. This is achieved through the provided affine mapping and its Jacobian.\n\nLet the affine mapping from the reference coordinate $\\xi \\in [-1, 1]$ to the physical coordinate $x \\in [x_L, x_R]$ be\n$$\nx(\\xi) = \\frac{x_R - x_L}{2}\\,\\xi + \\frac{x_R + x_L}{2}.\n$$\nThe Jacobian of this transformation, $J$, is the derivative of $x$ with respect to $\\xi$:\n$$\nJ = \\frac{dx}{d\\xi} = \\frac{d}{d\\xi}\\left(\\frac{x_R - x_L}{2}\\,\\xi + \\frac{x_R + x_L}{2}\\right) = \\frac{x_R - x_L}{2}.\n$$\nSince $x_L$ and $x_R$ are constants for a given element, the Jacobian $J$ is a constant. The inverse mapping from $x$ to $\\xi$ can also be differentiated:\n$$\n\\frac{d\\xi}{dx} = \\left(\\frac{dx}{d\\xi}\\right)^{-1} = J^{-1} = \\frac{1}{J}.\n$$\n\nWe will now derive the expressions for the mass matrix $M_{ij}^{e}$ and the stiffness matrix $K_{ij}^{e}$ separately.\n\n### Transformation of the Mass Matrix $M_{ij}^{e}$\n\nThe definition of the physical element mass matrix is\n$$\nM_{ij}^{e} = \\int_{x_L}^{x_R} \\phi_i(x)\\,\\phi_j(x)\\,dx.\n$$\nTo evaluate this integral, we perform a change of variables from the physical coordinate $x$ to the reference coordinate $\\xi$. The integration limits change from $[x_L, x_R]$ to $[-1, 1]$. The differential element transforms as $dx = \\frac{dx}{d\\xi}\\,d\\xi = J\\,d\\xi$. The basis functions on the physical element, $\\phi_i(x)$, are defined as the pullback of the reference basis functions, $\\hat{\\phi}_i(\\xi)$, such that $\\phi_i(x(\\xi)) = \\hat{\\phi}_i(\\xi)$.\n\nSubstituting these transformations into the integral for $M_{ij}^{e}$:\n$$\nM_{ij}^{e} = \\int_{-1}^{1} \\phi_i(x(\\xi))\\,\\phi_j(x(\\xi))\\,(J\\,d\\xi).\n$$\nUsing the pullback relationship $\\phi_k(x(\\xi)) = \\hat{\\phi}_k(\\xi)$, we get:\n$$\nM_{ij}^{e} = \\int_{-1}^{1} \\hat{\\phi}_i(\\xi)\\,\\hat{\\phi}_j(\\xi)\\,J\\,d\\xi.\n$$\nSince the Jacobian $J$ is constant with respect to the integration variable $\\xi$, it can be factored out of the integral:\n$$\nM_{ij}^{e} = J \\int_{-1}^{1} \\hat{\\phi}_i(\\xi)\\,\\hat{\\phi}_j(\\xi)\\,d\\xi.\n$$\nThe remaining integral is, by definition, the reference mass matrix, $\\hat{M}_{ij}$:\n$$\n\\hat{M}_{ij} = \\int_{-1}^{1} \\hat{\\phi}_i(\\xi)\\,\\hat{\\phi}_j(\\xi)\\,d\\xi.\n$$\nTherefore, the relationship for the mass matrix is:\n$$\nM_{ij}^{e} = J \\hat{M}_{ij}.\n$$\n\n### Transformation of the Stiffness Matrix $K_{ij}^{e}$\n\nThe definition of the physical element stiffness matrix is\n$$\nK_{ij}^{e} = \\int_{x_L}^{x_R} \\frac{d\\phi_i}{dx}(x)\\,\\frac{d\\phi_j}{dx}(x)\\,dx.\n$$\nThis transformation requires two steps: first, transforming the derivatives $\\frac{d\\phi_k}{dx}$, and second, transforming the integral itself.\n\nWe use the chain rule to relate the derivative with respect to $x$ to the derivative with respect to $\\xi$:\n$$\n\\frac{d\\phi_k}{dx} = \\frac{d\\phi_k}{d\\xi}\\,\\frac{d\\xi}{dx}.\n$$\nThe term $\\frac{d\\phi_k}{d\\xi}$ is the derivative of the composite function $\\phi_k(x(\\xi))$ with respect to $\\xi$. By definition, this is equal to the derivative of the reference basis function $\\frac{d\\hat{\\phi}_k}{d\\xi}$. The term $\\frac{d\\xi}{dx}$ is the inverse of the Jacobian, which we found to be $J^{-1}$. Thus,\n$$\n\\frac{d\\phi_k}{dx}(x) = \\frac{d\\hat{\\phi}_k}{d\\xi}(\\xi(x)) \\cdot \\frac{1}{J}.\n$$\nSubstituting this expression for the derivatives of both $\\phi_i$ and $\\phi_j$ into the definition of $K_{ij}^{e}$:\n$$\nK_{ij}^{e} = \\int_{x_L}^{x_R} \\left(\\frac{1}{J}\\frac{d\\hat{\\phi}_i}{d\\xi}(\\xi(x))\\right) \\left(\\frac{1}{J}\\frac{d\\hat{\\phi}_j}{d\\xi}(\\xi(x))\\right) dx.\n$$\nCombining the constant factors of $J$:\n$$\nK_{ij}^{e} = \\int_{x_L}^{x_R} \\frac{1}{J^2} \\frac{d\\hat{\\phi}_i}{d\\xi}(\\xi(x)) \\frac{d\\hat{\\phi}_j}{d\\xi}(\\xi(x)) dx.\n$$\nNext, we perform the change of variables for the integral, similar to the mass matrix case. The integration domain becomes $[-1, 1]$ and the differential $dx$ becomes $J\\,d\\xi$:\n$$\nK_{ij}^{e} = \\int_{-1}^{1} \\frac{1}{J^2} \\frac{d\\hat{\\phi}_i}{d\\xi}(\\xi) \\frac{d\\hat{\\phi}_j}{d\\xi}(\\xi) (J\\,d\\xi).\n$$\nThe factors involving the constant Jacobian $J$ can be simplified and moved outside the integral:\n$$\nK_{ij}^{e} = \\frac{J}{J^2} \\int_{-1}^{1} \\frac{d\\hat{\\phi}_i}{d\\xi}(\\xi)\\,\\frac{d\\hat{\\phi}_j}{d\\xi}(\\xi)\\,d\\xi = \\frac{1}{J} \\int_{-1}^{1} \\frac{d\\hat{\\phi}_i}{d\\xi}(\\xi)\\,\\frac{d\\hat{\\phi}_j}{d\\xi}(\\xi)\\,d\\xi.\n$$\nThe remaining integral is the definition of the reference stiffness matrix, $\\hat{K}_{ij}$:\n$$\n\\hat{K}_{ij} = \\int_{-1}^{1} \\frac{d\\hat{\\phi}_i}{d\\xi}(\\xi)\\,\\frac{d\\hat{\\phi}_j}{d\\xi}(\\xi)\\,d\\xi.\n$$\nTherefore, the relationship for the stiffness matrix is:\n$$\nK_{ij}^{e} = \\frac{1}{J} \\hat{K}_{ij}.\n$$\n\nThe final answer is the pair $(M_{ij}^{e}, K_{ij}^{e})$ expressed in terms of $J$, $\\hat{M}_{ij}$, and $\\hat{K}_{ij}$. Based on the derivations above, this pair is $\\left(J\\,\\hat{M}_{ij}, \\frac{1}{J}\\hat{K}_{ij}\\right)$.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\nJ \\hat{M}_{ij} & \\frac{1}{J} \\hat{K}_{ij}\n\\end{pmatrix}\n}\n$$", "id": "3424466"}, {"introduction": "While nodal and modal bases are algebraically equivalent, they offer distinct perspectives on the numerical solution. This exercise delves into the concept of superconvergence, a remarkable phenomenon where certain solution properties exhibit unusually high accuracy. By analyzing the convergence rates for a modal cell average versus a nodal point value, you will uncover a key theoretical advantage of the moment-based view inherent to modal methods [@problem_id:3424499].", "problem": "Consider the one-dimensional linear advection Partial Differential Equation (PDE) $u_{t} + a\\,u_{x} = 0$ on the periodic interval $[0,L]$ with smooth, $L$-periodic initial data $u(x,0) \\in C^{\\infty}([0,L])$ and constant wave speed $a > 0$. Discretize $[0,L]$ with a uniform mesh of $N$ elements of size $h = L/N$, and on each element $I_{j}$ use the Discontinuous Galerkin (DG) method with local polynomial space of degree $p \\geq 1$.\n\nWork with two algebraically equivalent but distinct bases for the local polynomial space:\n- A modal basis consisting of orthonormal Legendre polynomials $\\{P_{m}(\\xi)\\}_{m=0}^{p}$ on the reference element $\\xi \\in [-1,1]$ mapped affinely onto each physical element $I_{j}$.\n- A nodal basis consisting of Lagrange polynomials through Gauss–Lobatto–Legendre (GLL) nodes on the reference element, pulled back to each $I_{j}$, with volume integrals computed using the corresponding GLL quadrature (assume exact evaluation of the DG bilinear forms for polynomials up to degree $2p-1$).\n\nUse the standard upwind numerical flux at element interfaces and assume exact time integration of the semi-discrete system. Let the initial condition be a single Fourier mode $u(x,0) = \\exp(i k x)$ with wavenumber $k \\in \\mathbb{R}$ and $|k|h \\ll 1$.\n\nDefine the cell average on $I_{j}$ at time $t$ by $\\bar{u}_{j}(t) = \\frac{1}{h}\\int_{I_{j}} u(x,t)\\,\\mathrm{d}x$ and its DG counterpart $\\bar{u}_{j,h}(t)$ by the coefficient of the constant basis function (the zeroth modal coefficient) under the modal formulation. Define the interface flux at the right face $x_{j+1/2}$ by $f_{j+1/2,h}(t) = a\\,u_{h}(x_{j+1/2}^{-},t)$, where $u_{h}(x_{j+1/2}^{-},t)$ is the trace from the left element, and define the nodal point value error at that face by $e_{\\mathrm{point}}(t) = u_{h}(x_{j+1/2}^{-},t) - u(x_{j+1/2},t)$.\n\nStarting from the DG weak formulation and the properties of the modal and nodal bases, analyze the asymptotic small-$h$ behavior of:\n- the cell-average error $e_{\\mathrm{avg}}(t) = \\bar{u}_{j,h}(t) - \\bar{u}_{j}(t)$ under the modal basis, and\n- the pointwise nodal error $e_{\\mathrm{point}}(t)$ at the right face under the nodal basis.\n\nUnder the assumptions stated above (uniform mesh, upwind flux, exact time integration, smooth periodic data, and orthonormal modal basis with exact volume integration), determine the leading-order powers of $h$ that govern $e_{\\mathrm{avg}}(t)$ and $e_{\\mathrm{point}}(t)$ as $h \\to 0$, and hence compute the order gap\n$$\n\\Delta(p) := \\alpha_{\\mathrm{modal\\text{-}avg}} - \\alpha_{\\mathrm{nodal\\text{-}point}},\n$$\nwhere $\\alpha_{\\mathrm{modal\\text{-}avg}}$ is the leading accuracy order in $h$ of the modal cell average and $\\alpha_{\\mathrm{nodal\\text{-}point}}$ is the leading accuracy order in $h$ of the nodal point value at the face. You must express your final answer as a closed-form expression in $p$ only. Also, state clearly the conditions under which this enhanced accuracy of modal low-order moments over nodal point values holds. No rounding is required, and no physical units are to be reported in the final answer.", "solution": "The problem requires an analysis of the asymptotic convergence rates for two different error quantities in a Discontinuous Galerkin (DG) discretization of the linear advection equation, $u_{t} + a\\,u_{x} = 0$. The goal is to determine the order gap, $\\Delta(p)$, between the accuracy of the cell average in a modal basis formulation and the accuracy of a nodal point value in a nodal basis formulation.\n\nLet the polynomial space of degree at most $p$ on a reference element $I_{\\text{ref}} = [-1,1]$ be denoted by $\\mathcal{P}^p(I_{\\text{ref}})$. The DG solution $u_h(x,t)$ on each physical element $I_j$ is a polynomial of degree $p$.\n\n### Analysis of the Cell-Average Error under a Modal Basis ($\\alpha_{\\mathrm{modal\\text{-}avg}}$)\n\nThe modal basis for $\\mathcal{P}^p(I_{\\text{ref}})$ consists of orthonormal Legendre polynomials, $\\{P_m(\\xi)\\}_{m=0}^p$. The solution on element $I_j$ is written as $u_h(x,t) = \\sum_{m=0}^p \\hat{u}_{j,m}(t) \\phi_m(x)$, where $\\phi_m(x)$ are the basis functions mapped and scaled from $P_m(\\xi)$. The constant basis function is proportional to $P_0(\\xi)$, which is a constant.\n\nThe cell average of the DG solution on element $I_j$ is defined as $\\bar{u}_{j,h}(t) = \\frac{1}{h} \\int_{I_j} u_h(x,t) \\, \\mathrm{d}x$. Due to the orthogonality of Legendre polynomials, where $\\int_{-1}^1 P_m(\\xi)P_0(\\xi) \\, d\\xi = 0$ for $m>0$, the cell average is determined solely by the coefficient of the constant basis function ($m=0$). Specifically, $\\bar{u}_{j,h}(t)$ is directly proportional to the modal coefficient $\\hat{u}_{j,0}(t)$. The problem defines $\\bar{u}_{j,h}(t)$ as this coefficient.\n\nLet's examine the evolution of the cell average. By choosing the test function $v_h$ to be the constant function $v_h=1$ on $I_j$ in the DG weak formulation, we obtain a conservation equation for the cell average:\n$$\n\\frac{d}{dt} \\int_{I_j} u_h(x,t) \\cdot 1 \\, \\mathrm{d}x + \\int_{I_j} a u_{h,x}(x,t) \\cdot 1 \\, \\mathrm{d}x = 0\n$$\nThe DG formulation replaces the second term with a combination of an integrated-by-parts volume term (which vanishes since $\\partial_x v_h = 0$) and a surface term involving the numerical flux. With an upwind flux $f^*(u^-, u^+) = a u^-$ (since $a>0$), the scheme becomes:\n$$\n\\frac{d}{dt} \\left(h \\bar{u}_{j,h}(t) \\right) + a u_h(x_{j+1/2}^-, t) - a u_h(x_{j-1/2}^-, t) = 0\n$$\nwhere $u_h(x_{j-1/2}^-, t)$ is the value from the left at the left interface, i.e., from element $I_{j-1}$. This simplifies to the finite-volume-like equation for the cell average:\n$$\n\\frac{d}{dt} \\bar{u}_{j,h}(t) + \\frac{a}{h} \\left( u_h(x_{j+1/2}^-, t) - u_h(x_{j-1/2}^-, t) \\right) = 0\n$$\nThe exact cell average $\\bar{u}_j(t) = \\frac{1}{h}\\int_{I_j} u(x,t) \\, \\mathrm{d}x$ obeys a similar equation derived from the PDE:\n$$\n\\frac{d}{dt} \\bar{u}_j(t) = \\frac{1}{h} \\int_{I_j} u_t \\, \\mathrm{d}x = -\\frac{1}{h} \\int_{I_j} a u_x \\, \\mathrm{d}x = -\\frac{a}{h} \\left( u(x_{j+1/2}, t) - u(x_{j-1/2}, t) \\right)\n$$\nThe evolution of the cell-average error $e_{\\mathrm{avg},j}(t) = \\bar{u}_{j,h}(t) - \\bar{u}_j(t)$ is therefore governed by the error in the numerical flux:\n$$\n\\frac{d}{dt} e_{\\mathrm{avg},j}(t) = -\\frac{a}{h} \\left[ \\left( u_h(x_{j+1/2}^-, t) - u(x_{j+1/2}, t) \\right) - \\left( u_h(x_{j-1/2}^-, t) - u(x_{j-1/2}, t) \\right) \\right]\n$$\nWhile standard DG error estimates show the pointwise error at the interface, $u_h(x_{j\\pm 1/2}^-, t) - u(x_{j\\pm 1/2}, t)$, is of order $O(h^{p+1})$, a more detailed analysis reveals a special cancellation. For the one-dimensional linear advection equation on a uniform periodic mesh with an upwind flux, the leading error terms in the numerical flux expansion telescope across the grid. This cancellation, combined with the specific orthogonality properties of the DG projection onto the space of polynomials, results in a much higher order of accuracy for the low-order moments of the solution. This a well-known superconvergence phenomenon.\n\nFor the cell average (the zeroth moment), the error converges with an order of $2p+1$. This means:\n$$\ne_{\\mathrm{avg}}(t) = O(h^{2p+1})\n$$\nTherefore, the leading accuracy order for the modal cell average is $\\alpha_{\\mathrm{modal\\text{-}avg}} = 2p+1$.\n\nThis enhanced accuracy is conditional and holds under the following circumstances:\n1.  The governing PDE is linear (or is being solved in a manner where the error equation is linear).\n2.  The exact solution $u(x,t)$ is sufficiently smooth (at least $C^{2p+1}$).\n3.  The computational mesh is uniform or varies smoothly.\n4.  An appropriate numerical flux is used, such as the upwind flux.\n5.  The error is measured for a low-order integral moment of the solution (the cell average being the zeroth moment).\n\n### Analysis of the Pointwise Nodal Error under a Nodal Basis ($\\alpha_{\\mathrm{nodal\\text{-}point}}$)\n\nThe nodal basis is constructed using Lagrange polynomials $\\{L_i(\\xi)\\}_{i=0}^p$ associated with $p+1$ Gauss-Lobatto-Legendre (GLL) nodes on the reference element $[-1,1]$. The GLL nodes include the endpoints, so $\\xi_0 = -1$ and $\\xi_p = 1$. The DG solution on an element is represented as $u_h(x,t) = \\sum_{i=0}^p u_{h,i}(t) L_i(\\xi(x))$, where the degrees of freedom $u_{h,i}(t)$ are the values of the solution at the physical nodes $x_i \\in I_j$.\n\nThe error quantity of interest is $e_{\\mathrm{point}}(t) = u_{h}(x_{j+1/2}^{-},t) - u(x_{j+1/2},t)$. The point $x_{j+1/2}^{-}$ is the right boundary of element $I_j$. In the nodal GLL basis, this point corresponds to the node $\\xi_p=1$, and is therefore one of the computational nodes of the scheme. The value $u_h(x_{j+1/2}^-, t)$ is thus one of the degrees of freedom of the numerical solution.\n\nStandard error estimates for DG methods for smooth solutions show that the approximation error in the $L^{\\infty}$ norm is of order $p+1$:\n$$\n\\| u_h - u \\|_{L^{\\infty}} = \\sup_{x, t} |u_h(x,t) - u(x,t)| = O(h^{p+1})\n$$\nThis optimal-order estimate bounds the error at every point in the domain, including the nodal points. Thus, the error at the specific nodal point $x_{j+1/2}^{-}$ must also be of this order:\n$$\ne_{\\mathrm{point}}(t) = |u_{h}(x_{j+1/2}^{-},t) - u(x_{j+1/2},t)| = O(h^{p+1})\n$$\nWhile superconvergence can occur for nodal DG methods at specific interior points (typically Gauss-Radau points, which are different from the GLL nodes), there is no general superconvergence result for the solution value at the element boundaries. These points are directly involved in the flux computation and feel the full effect of the discontinuity with the neighboring element. Therefore, the convergence rate is not expected to be higher than the optimal order $p+1$.\nThe leading accuracy order for the nodal point value is $\\alpha_{\\mathrm{nodal\\text{-}point}} = p+1$.\n\n### Computation of the Order Gap $\\Delta(p)$\n\nThe order gap $\\Delta(p)$ is defined as the difference between the convergence orders of the modal cell average and the nodal point value. Using the results derived above:\n$$\n\\alpha_{\\mathrm{modal\\text{-}avg}} = 2p+1\n$$\n$$\n\\alpha_{\\mathrm{nodal\\text{-}point}} = p+1\n$$\nThe gap is therefore:\n$$\n\\Delta(p) = \\alpha_{\\mathrm{modal\\text{-}avg}} - \\alpha_{\\mathrm{nodal\\text{-}point}} = (2p+1) - (p+1) = 2p + 1 - p - 1 = p\n$$\nThis result highlights a fundamental property of DG methods: integral quantities like cell averages can be significantly more accurate than pointwise values, especially those at element interfaces.", "answer": "$$\\boxed{p}$$", "id": "3424499"}, {"introduction": "The practical performance of a numerical scheme for wave phenomena is ultimately determined by its ability to propagate waves with minimal error. This hands-on practice uses Fourier analysis to perform a head-to-head comparison of DG operators constructed with modal and nodal bases. By computing the eigenstructure of the semi-discrete system, you will directly quantify and contrast the numerical dispersion and dissipation, revealing how basis choice influences the fidelity of wave simulations [@problem_id:3424500].", "problem": "Consider the one-dimensional linear advection equation $u_t + a u_x = 0$ with constant advection speed $a > 0$ on a periodic domain partitioned into a uniform mesh of elements of size $h$. Using the Discontinuous Galerkin (DG) method, approximate $u$ on each element with polynomials of degree $p$ and employ an upwind numerical flux at interfaces. Compare two bases for representing the local polynomial space: a modal basis (orthonormal Legendre polynomials) and a nodal basis (Lagrange polynomials at Gauss-Lobatto-Legendre (GLL) nodes). Work in a semi-discrete setting (continuous in time, discrete in space).\n\nStart from the weak form of the DG method on a single element, mapped from the physical interval $[x_{j-1/2}, x_{j+1/2}]$ to the reference interval $[-1,1]$ via $x = x_j + (h/2)\\xi$, where $x_j$ is the element center and $\\xi \\in [-1,1]$. Let $\\{\\phi_i(\\xi)\\}_{i=0}^p$ denote either the modal or nodal basis functions on the reference element, and let $u_j(\\xi,t) = \\sum_{i=0}^p u_{j,i}(t) \\phi_i(\\xi)$ be the local expansion. Define the reference mass matrix $M_{\\text{ref}}$ and the reference stiffness matrix $S_{\\text{ref}}$ by\n$$\n(M_{\\text{ref}})_{i k} = \\int_{-1}^{1} \\phi_i(\\xi)\\,\\phi_k(\\xi)\\,d\\xi,\\qquad\n(S_{\\text{ref}})_{i k} = \\int_{-1}^{1} \\phi_i'(\\xi)\\,\\phi_k(\\xi)\\,d\\xi,\n$$\nand define the boundary evaluation vectors $b_- \\in \\mathbb{R}^{p+1}$ and $b_+ \\in \\mathbb{R}^{p+1}$ by $b_{\\pm,i} = \\phi_i(\\pm 1)$, with associated boundary bilinear forms\n$$\nB_R = b_+\\,b_+^\\top,\\qquad B_L = b_-\\,b_+^\\top.\n$$\nFor $a>0$ (flow to the right) with upwind flux, the semi-discrete elemental operator can be written in the form\n$$\n\\frac{h}{a}\\,\\dot{\\boldsymbol{u}}_j = 2\\,M_{\\text{ref}}^{-1}\\left(-S_{\\text{ref}} + B_R\\right)\\boldsymbol{u}_j - 2\\,M_{\\text{ref}}^{-1}B_L\\,\\boldsymbol{u}_{j-1},\n$$\nwhere $\\boldsymbol{u}_j \\in \\mathbb{R}^{p+1}$ collects the degrees of freedom on element $j$.\n\nOn a uniform periodic mesh, perform a Fourier (Bloch) analysis by assuming a mode of the form $\\boldsymbol{u}_j(t) = \\boldsymbol{v}\\,e^{\\lambda t} e^{\\mathrm{i}\\theta j}$, where $\\theta \\in \\mathbb{R}$ is the dimensionless wavenumber (angle) in radians, and define the dimensionless eigenvalue\n$$\n\\mu(\\theta) = \\frac{h}{a}\\,\\lambda(\\theta).\n$$\nShow that $\\mu(\\theta)$ is given by the eigenvalues of the $(p+1)\\times(p+1)$ Fourier symbol matrix\n$$\n\\mathcal{G}(\\theta) = 2\\,M_{\\text{ref}}^{-1}\\left(-S_{\\text{ref}} + B_R - e^{-\\mathrm{i}\\theta} B_L\\right).\n$$\nFor each basis (modal or nodal), construct $\\mathcal{G}(\\theta)$ and compute its eigenvalues at prescribed $(p,\\theta)$ pairs. Identify the principal branch eigenvalue $\\mu_\\star(\\theta)$ for each case as the one whose imaginary part is nearest to $-\\theta$ (the exact continuous dispersion relation for $u_t + a u_x = 0$ is $\\lambda_{\\text{exact}} = -\\mathrm{i} a k$, so in dimensionless form $\\mu_{\\text{exact}} = -\\mathrm{i}\\theta$). Quantify dispersion error and numerical dissipation as:\n- dispersion error: $\\mathrm{Im}(\\mu_\\star(\\theta)) + \\theta$,\n- dissipation: $\\mathrm{Re}(\\mu_\\star(\\theta))$.\n\nAdditionally, quantify the difference between the eigenstructures of the modal and nodal operators at the same $(p,\\theta)$ by:\n- principal eigenvalue difference: $\\left|\\mu_{\\star,\\text{modal}}(\\theta) - \\mu_{\\star,\\text{nodal}}(\\theta)\\right|$,\n- bidirectional Hausdorff distance between eigenvalue sets: the maximum of the two directed distances, where a directed distance from set $A$ to set $B$ is $\\max_{\\alpha\\in A}\\min_{\\beta\\in B}|\\alpha-\\beta|$.\n\nImplement all constructions rigorously from first principles as follows:\n- For the modal basis, use orthonormal Legendre polynomials on $[-1,1]$, i.e., $\\phi_n(\\xi) = \\sqrt{\\frac{2n+1}{2}}\\,P_n(\\xi)$, where $P_n$ is the $n$-th Legendre polynomial. For integration, use Gauss-Legendre quadrature of sufficient order to evaluate $S_{\\text{ref}}$ exactly. Use $M_{\\text{ref}} = I$.\n- For the nodal basis, use Lagrange polynomials at $N=p+1$ Gauss-Lobatto-Legendre nodes and their associated quadrature weights, with volume integrals approximated by GLL quadrature and a diagonal mass matrix $M_{\\text{ref}} = \\mathrm{diag}(w_0,\\dots,w_p)$. Use the exact boundary evaluations $\\phi_i(\\pm 1)$ implied by the nodal basis.\n\nYour program must compute, for each test case $(p,\\theta)$ in the test suite below, the six quantities:\n1. dispersion error in the modal basis,\n2. dissipation in the modal basis,\n3. dispersion error in the nodal basis,\n4. dissipation in the nodal basis,\n5. principal eigenvalue difference between modal and nodal bases,\n6. bidirectional Hausdorff distance between the full eigenvalue sets.\n\nAngles are to be provided and interpreted in radians. There are no physical units required in the final output because all quantities are dimensionless.\n\nTest Suite:\n- $(p,\\theta) = (1, 10^{-6})$,\n- $(p,\\theta) = (3, \\pi/4)$,\n- $(p,\\theta) = (4, 0.9\\pi)$,\n- $(p,\\theta) = (2, \\pi/2)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case contributes a sublist of six floating-point numbers in the order specified above. For example, the output format should be exactly like:\n$[ [r_{1,1}, r_{1,2}, r_{1,3}, r_{1,4}, r_{1,5}, r_{1,6}], [r_{2,1}, r_{2,2}, r_{2,3}, r_{2,4}, r_{2,5}, r_{2,6}], \\dots ]$.", "solution": "The user has provided a well-defined problem in the field of numerical analysis for partial differential equations. The problem is scientifically grounded, formally specified, and requires the implementation of established numerical methods. There are no contradictions, ambiguities, or unsound premises. Therefore, the problem is valid.\n\n### Step 1: Givens Extraction\n\nThe problem statement provides the following data and definitions:\n1.  **Governing Equation**: The one-dimensional linear advection equation $u_t + a u_x = 0$ with constant advection speed $a > 0$.\n2.  **Domain and Mesh**: A periodic domain with a uniform mesh of element size $h$.\n3.  **Numerical Method**: Discontinuous Galerkin (DG) method with local polynomial approximations of degree $p$.\n4.  **Numerical Flux**: Upwind flux.\n5.  **Local Bases**:\n    -   Modal: Orthonormal Legendre polynomials on $[-1,1]$, $\\phi_n(\\xi) = \\sqrt{\\frac{2n+1}{2}}\\,P_n(\\xi)$.\n    -   Nodal: Lagrange polynomials at $p+1$ Gauss-Lobatto-Legendre (GLL) nodes on $[-1,1]$.\n6.  **Coordinate Mapping**: $x = x_j + (h/2)\\xi$ for $\\xi \\in [-1,1]$.\n7.  **Local Solution Expansion**: $u_j(\\xi,t) = \\sum_{i=0}^p u_{j,i}(t) \\phi_i(\\xi)$.\n8.  **Reference Matrices and Vectors**:\n    -   Mass Matrix: $(M_{\\text{ref}})_{i k} = \\int_{-1}^{1} \\phi_i(\\xi)\\,\\phi_k(\\xi)\\,d\\xi$.\n    -   Stiffness Matrix: $(S_{\\text{ref}})_{i k} = \\int_{-1}^{1} \\phi_i'(\\xi)\\,\\phi_k(\\xi)\\,d\\xi$.\n    -   Boundary Vectors: $b_{\\pm,i} = \\phi_i(\\pm 1)$.\n    -   Boundary Bilinear Forms: $B_R = b_+\\,b_+^\\top$, $B_L = b_-\\,b_+^\\top$.\n9.  **Semi-Discrete System**: The evolution of the degrees of freedom $\\boldsymbol{u}_j$ on element $j$ is given by\n    $$\n    \\frac{h}{a}\\,\\dot{\\boldsymbol{u}}_j = 2\\,M_{\\text{ref}}^{-1}\\left(-S_{\\text{ref}} + B_R\\right)\\boldsymbol{u}_j - 2\\,M_{\\text{ref}}^{-1}B_L\\,\\boldsymbol{u}_{j-1}.\n    $$\n10. **Fourier Analysis**:\n    -   Ansatz: $\\boldsymbol{u}_j(t) = \\boldsymbol{v}\\,e^{\\lambda t} e^{\\mathrm{i}\\theta j}$, where $\\theta$ is the dimensionless wavenumber.\n    -   Dimensionless Eigenvalue: $\\mu(\\theta) = \\frac{h}{a}\\,\\lambda(\\theta)$.\n    -   Fourier Symbol Matrix: $\\mathcal{G}(\\theta) = 2\\,M_{\\text{ref}}^{-1}\\left(-S_{\\text{ref}} + B_R - e^{-\\mathrm{i}\\theta} B_L\\right)$. The values $\\mu(\\theta)$ are the eigenvalues of $\\mathcal{G}(\\theta)$.\n11. **Analysis Quantities**:\n    -   Principal Eigenvalue $\\mu_\\star(\\theta)$: The eigenvalue whose imaginary part is closest to $-\\theta$.\n    -   Dispersion Error: $\\mathrm{Im}(\\mu_\\star(\\theta)) + \\theta$.\n    -   Dissipation: $\\mathrm{Re}(\\mu_\\star(\\theta))$.\n    -   Principal Eigenvalue Difference: $|\\mu_{\\star,\\text{modal}}(\\theta) - \\mu_{\\star,\\text{nodal}}(\\theta)|$.\n    -   Bidirectional Hausdorff Distance: The maximum of the two directed distances between the sets of modal and nodal eigenvalues.\n12. **Basis-Specific Implementations**:\n    -   Modal: $M_{\\text{ref}} = I$. $S_{\\text{ref}}$ to be computed using Gauss-Legendre quadrature of sufficient order for exactness.\n    -   Nodal: $M_{\\text{ref}}$ is a diagonal mass matrix from GLL quadrature, $M_{\\text{ref}} = \\mathrm{diag}(w_0,\\dots,w_p)$. Integrals are approximated by GLL quadrature.\n13. **Test Suite**:\n    -   $(p,\\theta) = (1, 10^{-6})$\n    -   $(p,\\theta) = (3, \\pi/4)$\n    -   $(p,\\theta) = (4, 0.9\\pi)$\n    -   $(p,\\theta) = (2, \\pi/2)$\n\n### Step 2: Problem Validation\n\nThe problem is a standard exercise in the numerical analysis of DG methods. All components are well-defined within the established mathematical framework.\n-   **Scientifically Grounded and Objective**: The problem is based on the mathematical theory of numerical methods for PDEs. The concepts of DG methods, basis functions, Fourier stability analysis, dispersion, and dissipation are standard and objective.\n-   **Well-Posed and Complete**: The problem provides all necessary equations, definitions, and data to construct the required matrices and perform the analysis. The tasks are specific and lead to a unique set of computable numbers. The formulation is self-contained.\n-   **No Flaws**: The problem does not violate any scientific principles, is not based on false premises, is formalizable, and is computationally feasible. It is a non-trivial problem requiring careful implementation of several numerical components.\n\n### Step 3: Verdict and Action\n\nThe problem statement is **valid**. A solution will be provided by implementing the specified constructions.\n\n### Method and Implementation\n\nThe solution involves constructing the Fourier symbol matrix $\\mathcal{G}(\\theta)$ for both the modal and nodal bases for each given $(p, \\theta)$ pair. This requires the following steps:\n\n**A. Modal Basis Construction ($\\phi_n(\\xi) = \\sqrt{(2n+1)/2} P_n(\\xi)$)**\n1.  **Mass Matrix ($M_{\\text{ref}}$)**: Due to the orthonormality of the basis, $M_{\\text{ref}}$ is the identity matrix, $I$, of size $(p+1) \\times (p+1)$.\n2.  **Stiffness Matrix ($S_{\\text{ref}}$)**: The entries are $(S_{\\text{ref}})_{ik} = \\int_{-1}^{1} \\phi_i'(\\xi)\\phi_k(\\xi)d\\xi$. The integrand $\\phi_i'(\\xi)\\phi_k(\\xi)$ is a polynomial of degree $(i-1)+k$. The maximum degree for $i,k \\in \\{0, \\dots, p\\}$ is $2p-1$. Gauss-Legendre quadrature with $N_q$ points is exact for polynomials of degree up to $2N_q-1$. Thus, we need $N_q \\ge p$. We will use $N_q = p+2$ points for robustness. The integral is computed as a weighted sum of the integrand evaluated at the quadrature nodes.\n3.  **Boundary Vectors ($b_{\\pm}$)**: The entries are $b_{\\pm,i} = \\phi_i(\\pm 1)$. Since $P_i(1)=1$ and $P_i(-1)=(-1)^i$, these are readily computed as $b_{+,i} = \\sqrt{(2i+1)/2}$ and $b_{-,i} = (-1)^i \\sqrt{(2i+1)/2}$.\n4.  **Boundary Matrices**: $B_R$ and $B_L$ are formed by the outer products $b_+ b_+^T$ and $b_- b_+^T$, respectively.\n\n**B. Nodal Basis Construction (Lagrange Polynomials $\\ell_i(\\xi_j) = \\delta_{ij}$ at GLL nodes)**\n1.  **GLL Nodes and Weights**: For a given degree $p$, the $p+1$ GLL nodes $\\{\\xi_j\\}_{j=0}^p$ are the roots of $(1-\\xi^2)P_p'(\\xi)=0$. These consist of $\\xi_0 = -1$, $\\xi_p=1$, and the $p-1$ roots of $P_p'(\\xi)$, which are also the roots of the Jacobi polynomial $P_{p-1}^{(1,1)}(\\xi)$. The corresponding weights $\\{w_j\\}_{j=0}^p$ are given by the formula $w_j = \\frac{2}{p(p+1)[P_p(\\xi_j)]^2}$.\n2.  **Mass Matrix ($M_{\\text{ref}}$)**: Using GLL quadrature for the mass matrix integral yields a diagonal (\"lumped\") mass matrix with the quadrature weights on the diagonal: $M_{\\text{ref}} = \\mathrm{diag}(w_0, \\dots, w_p)$.\n3.  **Stiffness Matrix ($S_{\\text{ref}}$)**: Applying GLL quadrature to the stiffness matrix integral gives $(S_{\\text{ref}})_{ik} = \\int \\phi_i' \\phi_k d\\xi \\approx \\sum_j w_j \\phi_i'(\\xi_j) \\phi_k(\\xi_j) = w_k \\phi_i'(\\xi_k)$. Let $D$ be the differentiation matrix where $D_{ki} = \\phi_i'(\\xi_k)$ (derivative of $i$-th basis function at $k$-th node). Then $(S_{\\text{ref}})_{ik} = w_k D_{ki}$. In matrix terms, this is $S_{\\text{ref}} = (D^T W)$, where $W=\\mathrm{diag}(w_0, \\dots, w_p)$. The differentiation matrix $D$ can be constructed from its known analytical formula involving Legendre polynomials.\n4.  **Boundary Vectors ($b_{\\pm}$)**: Since $\\xi_0=-1$ and $\\xi_p=1$, the basis property $\\phi_i(\\xi_j)=\\delta_{ij}$ directly gives $b_{+,i} = \\phi_i(1) = \\phi_i(\\xi_p) = \\delta_{ip}$ and $b_{-,i} = \\phi_i(-1) = \\phi_i(\\xi_0) = \\delta_{i0}$. Thus, $b_+$ is the last standard basis vector and $b_-$ is the first.\n5.  **Boundary Matrices**: $B_R = e_p e_p^T$ and $B_L = e_0 e_p^T$.\n\n**C. Analysis**\nFor each basis, once $M_{\\text{ref}}$, $S_{\\text{ref}}$, $B_R$, and $B_L$ are constructed:\n1.  The Fourier symbol matrix $\\mathcal{G}(\\theta)$ is assembled.\n2.  Its eigenvalues $\\mu(\\theta)$ are computed using a standard numerical library function.\n3.  The principal eigenvalue $\\mu_\\star$ is identified by finding the eigenvalue whose imaginary part is closest to the exact dimensionless dispersion relation, $-\\theta$.\n4.  The requested six metrics (dispersion error, dissipation for both bases, principal eigenvalue difference, and Hausdorff distance) are calculated from the computed eigenvalues.", "answer": "```python\nimport numpy as np\nfrom scipy.special import roots_jacobi, legendre\n\ndef get_modal_matrices(p):\n    \"\"\"\n    Constructs matrices for the modal basis (orthonormal Legendre polynomials).\n    \"\"\"\n    # Orthonormal Legendre polynomials: phi_n(x) = sqrt((2n+1)/2) * P_n(x)\n    # Mass matrix M_ref is the identity matrix due to orthonormality.\n    M_ref = np.identity(p + 1)\n    \n    # Stiffness matrix S_ref: (S_ref)_ik = integral(phi_i' * phi_k) dx\n    # We use high-order Gauss-Legendre quadrature for exact integration.\n    # Integrand phi_i' * phi_k is a polynomial of degree (i-1) + k.\n    # Max degree is (p-1) + p = 2p-1. We need n_quad points such that 2*n_quad - 1 >= 2p - 1.\n    # Using p+2 points is sufficient.\n    n_quad = p + 2\n    xi_q, w_q = np.polynomial.legendre.leggauss(n_quad)\n    \n    S_ref = np.zeros((p + 1, p + 1))\n    \n    phi_vals = np.zeros((p + 1, n_quad))\n    phi_deriv_vals = np.zeros((p + 1, n_quad))\n    \n    for i in range(p + 1):\n        P_i = legendre(i)\n        P_i_deriv = P_i.deriv(1)\n        c_i = np.sqrt((2 * i + 1) / 2.0)\n        phi_vals[i, :] = c_i * P_i(xi_q)\n        phi_deriv_vals[i, :] = c_i * P_i_deriv(xi_q)\n\n    # Compute S_ref using quadrature\n    for i in range(p + 1):\n        for k in range(p + 1):\n            integrand = phi_deriv_vals[i, :] * phi_vals[k, :]\n            S_ref[i, k] = np.sum(w_q * integrand)\n\n    # Boundary vectors b_plus and b_minus\n    b_plus = np.array([np.sqrt((2 * i + 1) / 2.0) for i in range(p + 1)])\n    b_minus = np.array([np.sqrt((2 * i + 1) / 2.0) * (-1)**i for i in range(p + 1)])\n\n    B_R = np.outer(b_plus, b_plus)\n    B_L = np.outer(b_minus, b_plus)\n    \n    return M_ref, S_ref, B_R, B_L\n\ndef get_gll_nodes_weights(p):\n    \"\"\"\n    Computes Gauss-Lobatto-Legendre nodes and weights for degree p.\n    \"\"\"\n    if p == 0:\n        return np.array([0.0]), np.array([2.0])\n    if p == 1:\n        return np.array([-1.0, 1.0]), np.array([1.0, 1.0])\n        \n    interior_nodes = roots_jacobi(p - 1, 1, 1)[0]\n    nodes = np.concatenate(([-1.0], interior_nodes, [1.0]))\n    \n    P_p = legendre(p)\n    weights = 2.0 / (p * (p + 1) * P_p(nodes)**2)\n    \n    return nodes, weights\n\ndef get_differentiation_matrix(p, nodes):\n    \"\"\"\n    Computes the differentiation matrix for Lagrange basis at GLL nodes.\n    D_ij = phi_j'(xi_i)\n    \"\"\"\n    N = p + 1\n    D = np.zeros((N, N))\n    P_p = legendre(p)\n    \n    for i in range(N):\n        for j in range(N):\n            if i == j:\n                if i == 0:\n                    D[i, j] = -p * (p + 1) / 4.0\n                elif i == p:\n                    D[i, j] = p * (p + 1) / 4.0\n                else:\n                    D[i, j] = 0.0\n            else:\n                D[i, j] = P_p(nodes[i]) / (P_p(nodes[j]) * (nodes[i] - nodes[j]))\n    return D\n\ndef get_nodal_matrices(p):\n    \"\"\"\n    Constructs matrices for the nodal basis (Lagrange at GLL nodes).\n    \"\"\"\n    nodes, weights = get_gll_nodes_weights(p)\n    \n    M_ref = np.diag(weights)\n    \n    D = get_differentiation_matrix(p, nodes) # D_ij = phi_j'(xi_i)\n    \n    # S_ref_ik = integral(phi_i' phi_k) approx sum_j w_j phi_i'(xi_j) phi_k(xi_j)\n    # = w_k phi_i'(xi_k) = w_k D_ki\n    # In matrix form: S_ref = (D.T @ W), where W=diag(weights)\n    S_ref = D.T @ np.diag(weights)\n    \n    B_R = np.zeros((p + 1, p + 1))\n    B_R[p, p] = 1.0\n    \n    B_L = np.zeros((p + 1, p + 1))\n    B_L[0, p] = 1.0\n    \n    return M_ref, S_ref, B_R, B_L\n\ndef bidirectional_hausdorff(A, B):\n    \"\"\"\n    Calculates the bidirectional Hausdorff distance between two sets of numbers.\n    \"\"\"\n    # Reshape for broadcasting\n    A_col = A[:, np.newaxis]\n    B_row = B[np.newaxis, :]\n    \n    dist_mat_abs = np.abs(A_col - B_row)\n    \n    d_A_to_B = np.max(np.min(dist_mat_abs, axis=1))\n    d_B_to_A = np.max(np.min(dist_mat_abs, axis=0))\n    \n    return max(d_A_to_B, d_B_to_A)\n\ndef analyze_basis(p, theta, basis_type):\n    if basis_type == 'modal':\n        M_ref, S_ref, B_R, B_L = get_modal_matrices(p)\n    elif basis_type == 'nodal':\n        M_ref, S_ref, B_R, B_L = get_nodal_matrices(p)\n    else:\n        raise ValueError(\"Unknown basis type\")\n\n    M_inv = np.linalg.inv(M_ref)\n    \n    G = 2 * M_inv @ (-S_ref + B_R - np.exp(-1j * theta) * B_L)\n    \n    eigenvalues = np.linalg.eigvals(G)\n    \n    idx = np.argmin(np.abs(np.imag(eigenvalues) + theta))\n    mu_star = eigenvalues[idx]\n    \n    dispersion_error = np.imag(mu_star) + theta\n    dissipation = np.real(mu_star)\n    \n    return dispersion_error, dissipation, mu_star, eigenvalues\n\ndef solve():\n    test_cases = [\n        (1, 1e-6),\n        (3, np.pi/4),\n        (4, 0.9*np.pi),\n        (2, np.pi/2),\n    ]\n\n    results = []\n    for p, theta in test_cases:\n        disp_err_modal, diss_modal, mu_star_modal, eig_modal = analyze_basis(p, theta, 'modal')\n        disp_err_nodal, diss_nodal, mu_star_nodal, eig_nodal = analyze_basis(p, theta, 'nodal')\n        \n        principal_eig_diff = np.abs(mu_star_modal - mu_star_nodal)\n        hausdorff_dist = bidirectional_hausdorff(eig_modal, eig_nodal)\n        \n        case_results = [\n            disp_err_modal,\n            diss_modal,\n            disp_err_nodal,\n            diss_nodal,\n            principal_eig_diff,\n            hausdorff_dist\n        ]\n        results.append(case_results)\n\n    # Format output as a list of lists strings\n    formatted_results = []\n    for case_res in results:\n        formatted_results.append(f\"[{', '.join(f'{x:.15e}' for x in case_res)}]\")\n    \n    print(f\"[{', '.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3424500"}]}