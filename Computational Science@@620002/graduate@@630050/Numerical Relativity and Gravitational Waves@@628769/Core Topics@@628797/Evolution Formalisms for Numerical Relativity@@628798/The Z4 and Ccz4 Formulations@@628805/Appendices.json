{"hands_on_practices": [{"introduction": "A cornerstone of the Z4 and CCZ4 formulations is their ability to dynamically suppress violations of the Einstein constraints. This is achieved by introducing damping terms into the evolution equations. To build a solid theoretical understanding, this first exercise asks you to analyze the behavior of these constraints in the simplest possible setting: as small perturbations on a flat background. By treating the constraint violation as a field satisfying a damped wave equation, you will derive its characteristic exponential decay time, providing a direct link between the damping parameter $\\kappa_1$ and the rate at which numerical errors are suppressed [@problem_id:3497122]. This foundational analysis is the first step in appreciating the robust stability properties of the formulation.", "problem": "In the Conformal and Covariant formulation of Z4 (CCZ4), the Einstein constraint violations are encoded in a four-vector $Z_{a}$. A standard numerical test of expected behavior in this formulation is to analyze the linearized constraint-propagation subsystem about a flat Minkowski background, where the lapse is $\\alpha = 1$, the shift is $\\beta^{i} = 0$, and all fields are small perturbations with spatial scales much larger than the numerical grid spacing. In this regime, the principal part of the evolution operator acting on the constraints is wave-like, and the CCZ4 damping mechanism introduces a linear-in-time-derivative damping proportional to the parameter $\\kappa_{1} > 0$. These facts are well established for the Z4 family of formulations and underlie the robust-stability and constraint-damping tests used in numerical relativity.\n\nAssume that a single Cartesian component $Z$ of the spatial constraint $Z_{i}$ decouples and satisfies, to leading order in perturbation theory and at the level of principal parts, a damped wave equation of the form\n$$\n\\partial_{t}^{2} Z - \\partial_{x}^{2} Z + 2 \\kappa_{1} \\,\\partial_{t} Z = 0,\n$$\nin units where the physical wave speed is unity. Consider the standard plane-wave ansatz used in the linearized tests,\n$$\nZ(t,x) = A \\,\\exp\\!\\big(i(k x - \\omega t)\\big),\n$$\nwith constant complex amplitude $A$, real wavenumber $k \\neq 0$, and complex frequency $\\omega$. The underdamped regime is defined by $|k| > \\kappa_{1}$, in which oscillations persist while amplitudes decay exponentially.\n\nStarting from these premises, derive the dispersion relation for $\\omega$ and use it to determine the e-folding time $\\tau$ of the amplitude, defined as the time for $|Z|$ to decrease by a factor of $\\exp(-1)$, in the underdamped regime. Express your final answer as a single closed-form analytic expression in terms of $\\kappa_{1}$ only. No rounding is required. Use dimensionless code units where time is measured in units with light speed equal to $1$.", "solution": "The problem statement is found to be valid. It is scientifically grounded in the established theory of numerical relativity, specifically the analysis of constraint propagation in Z4-type formulations. The problem is well-posed, providing a specific partial differential equation (PDE) and a functional form for its solution (an ansatz), with a clear objective to derive a physical quantity (the e-folding time). The language is objective and all necessary parameters and conditions are specified. No contradictions or ambiguities are present.\n\nThe task is to determine the e-folding time $\\tau$ for a plane-wave solution to the damped wave equation given by\n$$\n\\partial_{t}^{2} Z - \\partial_{x}^{2} Z + 2 \\kappa_{1} \\,\\partial_{t} Z = 0\n$$\nThe proposed solution is a plane-wave ansatz of the form\n$$\nZ(t,x) = A \\,\\exp\\!\\big(i(k x - \\omega t)\\big)\n$$\nwhere $k$ is a real wavenumber and $\\omega$ is a complex frequency. Our goal is to first find the dispersion relation, which connects $\\omega$ and $k$, and then use it to find the e-folding time $\\tau$ in the underdamped regime, defined by $|k| > \\kappa_{1}$.\n\nFirst, we substitute the ansatz into the PDE. To do this, we calculate the required partial derivatives of $Z(t,x)$:\nThe first partial derivative with respect to time $t$ is:\n$$\n\\partial_{t} Z = \\frac{\\partial}{\\partial t} \\left[ A \\exp(i(kx - \\omega t)) \\right] = A (-i\\omega) \\exp(i(kx - \\omega t)) = -i\\omega Z\n$$\nThe second partial derivative with respect to time $t$ is:\n$$\n\\partial_{t}^{2} Z = \\frac{\\partial}{\\partial t} (-i\\omega Z) = (-i\\omega)^2 Z = -\\omega^2 Z\n$$\nThe second partial derivative with respect to the spatial coordinate $x$ is:\n$$\n\\partial_{x} Z = \\frac{\\partial}{\\partial x} \\left[ A \\exp(i(kx - \\omega t)) \\right] = A (ik) \\exp(i(kx - \\omega t)) = ikZ\n$$\n$$\n\\partial_{x}^{2} Z = \\frac{\\partial}{\\partial x} (ikZ) = (ik)^2 Z = -k^2 Z\n$$\nSubstituting these expressions back into the governing PDE yields:\n$$\n(-\\omega^2 Z) - (-k^2 Z) + 2 \\kappa_{1} (-i\\omega Z) = 0\n$$\nSince the ansatz represents a non-trivial solution ($A \\neq 0$), we can divide the entire equation by $Z$:\n$$\n-\\omega^2 + k^2 - 2i\\kappa_{1}\\omega = 0\n$$\nRearranging this equation into a standard quadratic form for the frequency $\\omega$, we obtain the dispersion relation:\n$$\n\\omega^2 + 2i\\kappa_{1}\\omega - k^2 = 0\n$$\nThis is a quadratic equation in $\\omega$ of the form $a\\omega^2 + b\\omega + c = 0$, with coefficients $a=1$, $b=2i\\kappa_{1}$, and $c=-k^2$. We can solve for $\\omega$ using the quadratic formula:\n$$\n\\omega = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a} = \\frac{-2i\\kappa_{1} \\pm \\sqrt{(2i\\kappa_{1})^2 - 4(1)(-k^2)}}{2(1)}\n$$\nLet's simplify the expression under the square root:\n$$\n(2i\\kappa_{1})^2 - 4(-k^2) = 4i^2\\kappa_{1}^2 + 4k^2 = -4\\kappa_{1}^2 + 4k^2 = 4(k^2 - \\kappa_{1}^2)\n$$\nSubstituting this back into the solution for $\\omega$:\n$$\n\\omega = \\frac{-2i\\kappa_{1} \\pm \\sqrt{4(k^2 - \\kappa_{1}^2)}}{2} = \\frac{-2i\\kappa_{1} \\pm 2\\sqrt{k^2 - \\kappa_{1}^2}}{2}\n$$\nSimplifying the expression gives the two solutions for the complex frequency:\n$$\n\\omega_{\\pm} = -i\\kappa_{1} \\pm \\sqrt{k^2 - \\kappa_{1}^2}\n$$\nThe problem specifies the underdamped regime, where $|k| > \\kappa_{1}$. This implies $k^2 > \\kappa_{1}^2$, so the term $k^2 - \\kappa_{1}^2$ is positive, and its square root is a real number.\n\nThe complex frequency $\\omega$ is generally expressed as $\\omega = \\text{Re}(\\omega) + i\\,\\text{Im}(\\omega)$. Comparing this with our solution, we can identify the real and imaginary parts:\n$$\n\\text{Re}(\\omega) = \\pm\\sqrt{k^2 - \\kappa_{1}^2}\n$$\n$$\n\\text{Im}(\\omega) = -\\kappa_{1}\n$$\nThe real part of the frequency determines the oscillatory behavior of the wave, while the imaginary part governs the exponential growth or decay of its amplitude.\n\nThe time dependence of the wave's amplitude is contained in the factor $\\exp(-i\\omega t)$. Let's expand this using the real and imaginary parts of $\\omega$:\n$$\n\\exp(-i\\omega t) = \\exp(-i(\\text{Re}(\\omega) + i\\,\\text{Im}(\\omega))t) = \\exp(-i\\,\\text{Re}(\\omega)t) \\exp(\\text{Im}(\\omega)t)\n$$\nThe full solution is $Z(t,x) = A \\exp(\\text{Im}(\\omega)t) \\exp(i(kx - \\text{Re}(\\omega)t))$.\nThe amplitude of the wave is $|Z(t,x)|$. Since $A$ is a complex constant, we can write $A = |A|\\exp(i\\phi)$.\n$$\n|Z(t,x)| = | |A|\\exp(i\\phi) \\exp(\\text{Im}(\\omega)t) \\exp(i(kx - \\text{Re}(\\omega)t)) |\n$$\n$$\n|Z(t,x)| = |A| \\cdot |\\exp(\\text{Im}(\\omega)t)| \\cdot |\\exp(i(\\phi + kx - \\text{Re}(\\omega)t))|\n$$\nSince the arguments of the complex exponentials are real numbers, the magnitude of the last term is $1$. The amplitude is thus:\n$$\n|Z(t,x)| = |A|\\exp(\\text{Im}(\\omega)t)\n$$\nSubstituting the value we found for $\\text{Im}(\\omega) = -\\kappa_{1}$:\n$$\n|Z(t,x)| = |A|\\exp(-\\kappa_{1}t)\n$$\nSince $\\kappa_{1}>0$, the amplitude decays exponentially over time. The e-folding time, $\\tau$, is the time interval over which the amplitude decreases by a factor of $\\exp(-1)$. We set the ratio of the amplitude at time $t+\\tau$ to the amplitude at time $t$ equal to $\\exp(-1)$:\n$$\n\\frac{|Z(t+\\tau,x)|}{|Z(t,x)|} = \\frac{|A|\\exp(-\\kappa_{1}(t+\\tau))}{|A|\\exp(-\\kappa_{1}t)} = \\exp(-1)\n$$\nSimplifying the left-hand side:\n$$\n\\exp(-\\kappa_{1}t - \\kappa_{1}\\tau + \\kappa_{1}t) = \\exp(-\\kappa_{1}\\tau)\n$$\nThus, we have the equation:\n$$\n\\exp(-\\kappa_{1}\\tau) = \\exp(-1)\n$$\nTaking the natural logarithm of both sides gives:\n$$\n-\\kappa_{1}\\tau = -1\n$$\nSolving for the e-folding time $\\tau$, we find:\n$$\n\\tau = \\frac{1}{\\kappa_{1}}\n$$\nThis result is independent of the wavenumber $k$, provided the condition for the underdamped regime ($|k| > \\kappa_{1}$) is met. The final expression depends only on the damping parameter $\\kappa_{1}$, as required by the problem statement.", "answer": "$$\\boxed{\\frac{1}{\\kappa_{1}}}$$", "id": "3497122"}, {"introduction": "After deriving the theoretical decay rate of constraints, the next crucial step in computational science is to verify this behavior in a numerical setting. This practice guides you through a standard \"gauge-wave test,\" a common verification tool in numerical relativity used to confirm that a code correctly implements the underlying equations. You will use the analytic solution to a simplified advection-damping model to generate numerical data for the evolution of constraint components, mimicking a simulation [@problem_id:3497123]. By fitting an exponential decay model to this data, you will numerically measure the damping rates and confirm that they match the theoretical predictions, thereby bridging the gap between analytical theory and practical implementation.", "problem": "You are to design and implement a periodic gauge-wave test to measure the decay rate of the constraint norm under the Conformal and Covariant Z4 (CCZ4) formulation of numerical relativity. Begin from a first-principles model of the constraint propagation in the Z4 framework under linearization about Minkowski spacetime in geometric units (speed of light $c = 1$). In the Z4 formulation, the constraint four-vector $Z_{\\mu}$ is introduced so that violations of the Einstein constraints propagate as dynamical fields. The CCZ4 formulation adds damping terms controlled by parameters $\\kappa_1$ and $\\kappa_2$ to suppress these violations. In a one-dimensional periodic gauge-wave setting, consider the simplified, linearized, decoupled advection-damping model for the two representative components of the constraint fields: the spatial component $Z_x$ and the normal projection $\\Theta \\equiv n^{\\mu} Z_{\\mu}$,\n$$\n\\partial_t Z_x + \\partial_x Z_x = -\\kappa_1 Z_x, \\quad \n\\partial_t \\Theta + \\partial_x \\Theta = -\\left(\\kappa_1 + \\kappa_2\\right)\\Theta,\n$$\nposed on the periodic domain $x \\in [0, 2\\pi)$ with wave speed $c=1$. This model captures the essential transport character of constraint propagation and the distinct damping channels introduced by $\\kappa_1$ and $\\kappa_2$ in the CCZ4 formulation, while remaining analytically tractable.\n\nUse the periodic gauge-wave initial data of the form\n$$\nZ_x(x,0) = A \\sin(k x), \\quad \\Theta(x,0) = 0,\n$$\nor\n$$\nZ_x(x,0) = 0, \\quad \\Theta(x,0) = A \\sin(k x),\n$$\nwith $A > 0$ small and integer wavenumber $k \\ge 1$. For each case, evolve the solution for time $t \\in [0, T]$ and construct the numerical time series of the $L^2$-norm of the constraint four-vector (restricted here to the two modeled components),\n$$\n\\|Z_{\\mu}\\|_2(t) \\equiv \\left(\\int_0^{2\\pi} \\left[ Z_x(x,t)^2 + \\Theta(x,t)^2 \\right] \\, dx \\right)^{1/2}.\n$$\nBecause the transport part is unitary with respect to the $L^2$ inner product on a periodic domain, the $L^2$-norm decays purely due to damping. Under the advection-damping model above and the single-component initializations, the fields evolve as translated sinusoids with exponential damping, and thus $\\|Z_{\\mu}\\|_2(t)$ is expected to exhibit exponential decay. Your task is to measure the decay rate by fitting an exponential decay constant $\\lambda$ from the numerical data for $\\|Z_{\\mu}\\|_2(t)$ using a linear least-squares fit to the logarithm,\n$$\n\\log \\|Z_{\\mu}\\|_2(t) \\approx C - \\lambda t,\n$$\nover a specified time window, returning $\\lambda$ as a float.\n\nImplement a program that:\n- Constructs a uniform spatial grid on $[0,2\\pi)$ with at least $N=256$ points.\n- Uses the analytic gauge-wave solution forms to generate numerical time series data at $N_t+1$ uniformly spaced times in $[0,T]$ for each test case, with $T$ and $N_t$ chosen to ensure a robust regression fit.\n- Computes $\\|Z_{\\mu}\\|_2(t)$ by numerical quadrature on the grid at each time.\n- Fits a single exponential decay constant $\\lambda$ for each test case by least squares on $\\{\\left(t_j, \\log \\|Z_{\\mu}\\|_2(t_j)\\right)\\}$ over the entire interval (excluding $t=0$ to avoid division by zero in the logarithm).\n- Returns the fitted $\\lambda$ rounded to six decimal places for each test case.\n\nUse the following test suite of parameter values and initializations (all quantities are dimensionless geometric units, and the decay constants must be expressed in inverse time units):\n- Case $1$: $\\kappa_1 = 0.1$, $\\kappa_2 = 0.0$, initialize $Z_x$ only with $A = 10^{-3}$ and $k=1$.\n- Case $2$: $\\kappa_1 = 0.1$, $\\kappa_2 = 0.2$, initialize $\\Theta$ only with $A = 10^{-3}$ and $k=1$.\n- Case $3$: $\\kappa_1 = 0.5$, $\\kappa_2 = 0.0$, initialize $Z_x$ only with $A = 10^{-3}$ and $k=1$.\n- Case $4$: $\\kappa_1 = 0.0$, $\\kappa_2 = 0.3$, initialize $\\Theta$ only with $A = 10^{-3}$ and $k=1$.\n- Case $5$: $\\kappa_1 = 0.05$, $\\kappa_2 = -0.05$, initialize $\\Theta$ only with $A = 10^{-3}$ and $k=1$.\n- Case $6$: $\\kappa_1 = 0.0$, $\\kappa_2 = 0.0$, initialize $Z_x$ only with $A = 10^{-3}$ and $k=1$.\n\nFor each case, the program must output the fitted exponential decay constant $\\lambda$ as a float rounded to six decimal places. The final output must be a single line containing a comma-separated Python-style list of the six results, in the same order as the cases above, for example, $[\\lambda_1,\\lambda_2,\\lambda_3,\\lambda_4,\\lambda_5,\\lambda_6]$.\n\nYour program must be self-contained and require no input. It must use geometric units and report the decay constants in inverse time units. Angles are measured in radians. All percentages, if any, must be represented as decimals or fractions; do not use the percentage symbol. Ensure that your program is deterministic and does not use any external files or network access.", "solution": "The problem statement has been meticulously validated and is determined to be sound. It is scientifically grounded in the principles of numerical relativity, specifically the CCZ4 formulation, and presents a well-posed mathematical problem based on a standard simplified model used for verification tests. The objectives are clear, the givens are sufficient and consistent, and the problem is free of ambiguity or non-scientific content.\n\nThe task is to determine the exponential decay rate, $\\lambda$, of the $L^2$-norm of a simplified constraint vector, $\\|Z_{\\mu}\\|_2(t)$, for a periodic gauge-wave test in the CCZ4 framework. This will be achieved by fitting the model $\\log \\|Z_{\\mu}\\|_2(t) \\approx C - \\lambda t$ to numerically generated data derived from the analytic solution.\n\nFirst, we derive the exact analytical solution to the governing advection-damping equations:\n$$\n\\partial_t Z_x + \\partial_x Z_x = -\\kappa_1 Z_x\n$$\n$$\n\\partial_t \\Theta + \\partial_x \\Theta = -\\left(\\kappa_1 + \\kappa_2\\right)\\Theta\n$$\nThese are linear, first-order partial differential equations with constant coefficients. For a generic equation of the form $\\partial_t u + c \\partial_x u = -\\alpha u$ with wave speed $c=1$, the solution can be found using the method of characteristics. The solution is given by $u(x,t) = u_0(x-t) e^{-\\alpha t}$, where $u_0(x) = u(x,0)$ is the initial data.\n\nApplying this general solution to our specific fields, we obtain:\n$$\nZ_x(x,t) = Z_x(x-t, 0) e^{-\\kappa_1 t}\n$$\n$$\n\\Theta(x,t) = \\Theta(x-t, 0) e^{-(\\kappa_1 + \\kappa_2) t}\n$$\nThe problem specifies two types of initial conditions. We analyze each separately to find the time evolution of the $L^2$-norm, defined as $\\|Z_{\\mu}\\|_2(t) \\equiv \\left(\\int_0^{2\\pi} \\left[ Z_x(x,t)^2 + \\Theta(x,t)^2 \\right] \\, dx \\right)^{1/2}$.\n\nCase A: Initialization of $Z_x$ only.\nThe initial conditions are $Z_x(x,0) = A \\sin(k x)$ and $\\Theta(x,0) = 0$. The evolved fields are:\n$$\nZ_x(x,t) = A \\sin(k(x-t)) e^{-\\kappa_1 t}\n$$\n$$\n\\Theta(x,t) = 0\n$$\nThe squared $L^2$-norm is:\n$$\n\\|Z_{\\mu}\\|_2^2(t) = \\int_0^{2\\pi} \\left( A \\sin(k(x-t)) e^{-\\kappa_1 t} \\right)^2 dx = A^2 e^{-2\\kappa_1 t} \\int_0^{2\\pi} \\sin^2(k(x-t)) dx\n$$\nSince $k$ is an integer, the integral of $\\sin^2$ of any phase-shifted argument over the periodic domain $[0, 2\\pi)$ evaluates to $\\pi$.\n$$\n\\int_0^{2\\pi} \\sin^2(k(x-t)) dx = \\pi\n$$\nTherefore, the norm is:\n$$\n\\|Z_{\\mu}\\|_2(t) = \\sqrt{A^2 \\pi e^{-2\\kappa_1 t}} = A \\sqrt{\\pi} e^{-\\kappa_1 t}\n$$\nTaking the natural logarithm gives $\\log \\|Z_{\\mu}\\|_2(t) = \\log(A\\sqrt{\\pi}) - \\kappa_1 t$. Comparing this to the specified fitting model $\\log \\|Z_{\\mu}\\|_2(t) \\approx C - \\lambda t$, we identify the theoretical decay rate as $\\lambda = \\kappa_1$.\n\nCase B: Initialization of $\\Theta$ only.\nThe initial conditions are $Z_x(x,0) = 0$ and $\\Theta(x,0) = A \\sin(k x)$. The evolved fields are:\n$$\nZ_x(x,t) = 0\n$$\n$$\n\\Theta(x,t) = A \\sin(k(x-t)) e^{-(\\kappa_1 + \\kappa_2) t}\n$$\nThe squared $L^2$-norm is:\n$$\n\\|Z_{\\mu}\\|_2^2(t) = \\int_0^{2\\pi} \\left( A \\sin(k(x-t)) e^{-(\\kappa_1+\\kappa_2) t} \\right)^2 dx = A^2 e^{-2(\\kappa_1+\\kappa_2) t} \\int_0^{2\\pi} \\sin^2(k(x-t)) dx\n$$\nAgain, the integral evaluates to $\\pi$, so the norm is:\n$$\n\\|Z_{\\mu}\\|_2(t) = \\sqrt{A^2 \\pi e^{-2(\\kappa_1+\\kappa_2) t}} = A \\sqrt{\\pi} e^{-(\\kappa_1 + \\kappa_2) t}\n$$\nTaking the natural logarithm gives $\\log \\|Z_{\\mu}\\|_2(t) = \\log(A\\sqrt{\\pi}) - (\\kappa_1 + \\kappa_2) t$. The theoretical decay rate is therefore $\\lambda = \\kappa_1 + \\kappa_2$.\n\nThe numerical implementation will proceed as follows:\nFor each test case, we define the parameters $\\kappa_1$, $\\kappa_2$, $A$, $k$, and the initialization type.\nA uniform spatial grid $x_i$ is created on $[0, 2\\pi)$ with $N=256$ points. The grid spacing is $\\Delta x = 2\\pi/N$.\nA uniform time grid $t_j$ is created on $[0, T]$ with $N_t+1$ points. We choose $T=10$ and $N_t=100$ to provide sufficient data for a robust fit.\nFor each time $t_j$ (for $j > 0$), we evaluate the analytical solutions for $Z_x(x_i, t_j)$ and $\\Theta(x_i, t_j)$ at each spatial grid point.\nThe integrand $I_i(t_j) = Z_x(x_i, t_j)^2 + \\Theta(x_i, t_j)^2$ is computed.\nThe $L^2$-norm is calculated using numerical quadrature. For a periodic function on a uniform grid, the trapezoidal rule is highly accurate and simplifies to $\\|Z_{\\mu}\\|_2(t_j) = \\sqrt{\\Delta x \\sum_{i=0}^{N-1} I_i(t_j)}$.\nA time series of points $(t_j, \\log \\|Z_{\\mu}\\|_2(t_j))$ is generated for $j=1, \\dots, N_t$.\nA linear least-squares fit is performed on these points to find the slope $m$ and intercept $c$ of the line $y = mt+c$. Using `numpy.polyfit`, this is straightforward.\nThe decay rate is then extracted from the slope of the fitted line, $\\lambda = -m$.\nThis procedure is repeated for all six test cases, and the final list of fitted $\\lambda$ values, rounded to six decimal places, is produced. The numerical results are expected to match the theoretical predictions $\\lambda = \\kappa_1$ or $\\lambda = \\kappa_1 + \\kappa_2$ to high precision.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the periodic gauge-wave test problem for the CCZ4 formulation.\n\n    For each test case, this function:\n    1. Sets up the numerical grid and time steps.\n    2. Generates time-series data for the L2-norm of the constraints\n       using the analytic solution of the model equations.\n    3. Computes the L2-norm via numerical quadrature.\n    4. Performs a linear least-squares fit on the logarithm of the norm\n       vs. time to find the exponential decay rate lambda.\n    5. Collects the results and prints them in the specified format.\n    \"\"\"\n\n    # Test suite of parameters from the problem statement.\n    # Format: (kappa1, kappa2, initialized_field, A, k)\n    test_cases = [\n        (0.1, 0.0, 'Zx', 1e-3, 1),\n        (0.1, 0.2, 'Theta', 1e-3, 1),\n        (0.5, 0.0, 'Zx', 1e-3, 1),\n        (0.0, 0.3, 'Theta', 1e-3, 1),\n        (0.05, -0.05, 'Theta', 1e-3, 1),\n        (0.0, 0.0, 'Zx', 1e-3, 1)\n    ]\n\n    results = []\n\n    # Numerical parameters for the simulation and fit\n    N = 256         # Number of spatial grid points\n    Nt = 100        # Number of time steps for the fit\n    T = 10.0        # Total evolution time\n\n    # Set up spatial grid on [0, 2*pi)\n    x = np.linspace(0, 2 * np.pi, N, endpoint=False)\n    dx = x[1] - x[0]\n\n    # Set up time grid on [0, T]\n    times = np.linspace(0, T, Nt + 1)\n    # We fit over t > 0 as per the problem description\n    fit_times = times[1:]\n\n    for case in test_cases:\n        kappa1, kappa2, init_field, A, k = case\n        \n        log_norms = []\n\n        for t in fit_times:\n            if init_field == 'Zx':\n                # Analytic solution for Zx, with Theta = 0\n                zx_vals = A * np.sin(k * (x - t)) * np.exp(-kappa1 * t)\n                theta_vals = np.zeros_like(x)\n                \n            elif init_field == 'Theta':\n                # Analytic solution for Theta, with Zx = 0\n                zx_vals = np.zeros_like(x)\n                theta_vals = A * np.sin(k * (x - t)) * np.exp(-(kappa1 + kappa2) * t)\n            \n            # Integrand for the L2-norm squared\n            integrand = zx_vals**2 + theta_vals**2\n\n            # Numerical quadrature (Trapezoidal rule for periodic function)\n            integral = np.sum(integrand) * dx\n            \n            # Compute the L2-norm and its logarithm\n            norm = np.sqrt(integral)\n            log_norms.append(np.log(norm))\n\n        # Perform linear least-squares fit: log(norm) = slope * t + intercept\n        # The model is C - lambda*t, so lambda = -slope.\n        slope, _ = np.polyfit(fit_times, log_norms, 1)\n        \n        lambda_fit = -slope\n        \n        # Round to 6 decimal places as required\n        results.append(round(lambda_fit, 6))\n\n    # Format and print the final output as a single-line list\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3497123"}, {"introduction": "In a full numerical simulation, the Hamiltonian constraint $H$ and momentum constraints $M_i$ do not evolve independently; their dynamics are coupled to each other and to the Z4 constraint-damping fields $Z_{\\mu}$. This exercise moves beyond single-equation models to explore these crucial interactions within a more realistic, coupled system. You will analyze a system of ordinary differential equations that models the evolution of the Fourier amplitudes of $H$, $M$, $Z^0$, and $Z^1$ [@problem_id:3497100]. This allows you to investigate and compare different damping strategies, such as damping all components of $Z_\\mu$ versus only its timelike component, and to quantify their differential impact on Hamiltonian and momentum constraint violations, offering deeper insight into the formulation's design and behavior.", "problem": "Consider the propagation of the Hamiltonian constraint and momentum constraints in the Z4 formulation and the Conformal and Covariant Z4 formulation (CCZ4) of Numerical Relativity. Begin from the fundamental base that, in a $(3+1)$ decomposition of General Relativity, the Hamiltonian constraint $H$ and momentum constraints $M_i$ must vanish on physical solutions, and that the Z4 approach augments the Einstein field equations with a four-vector of constraint variables $Z_\\mu$ to dynamically control these violations, while CCZ4 adds conformal and covariant structure and damping terms. Work in a linearized regime around Minkowski spacetime, in a $(1+1)$ dimensional setting, and consider a single Fourier mode in space with wavenumber $k$. Assume a reduced dynamical system for the mode amplitudes $\\{H(t), M(t), Z^0(t), Z^1(t)\\}$, where $H$ denotes the Hamiltonian constraint amplitude, $M$ denotes the single nontrivial momentum constraint amplitude in the spatial $x$ direction, $Z^0$ denotes the time component of the $Z_\\mu$ vector, and $Z^1$ denotes the spatial component aligned with the wave propagation direction.\n\nConstruct and analyze the following dimensionless linearized evolution model for the constraint subsystem:\n$$\n\\frac{dH}{dt} \\;=\\; -a_H\\, k\\, Z^1 \\;-\\; b_H\\, Z^0 \\;-\\; d_H\\, H,\n$$\n$$\n\\frac{dM}{dt} \\;=\\; -a_M\\, k\\, Z^0 \\;-\\; b_M\\, k\\, Z^1 \\;-\\; d_M\\, M,\n$$\n$$\n\\frac{dZ^0}{dt} \\;=\\; -c_0\\, k\\, M \\;-\\; e_0\\, H \\;-\\; \\kappa_0\\, Z^0,\n$$\n$$\n\\frac{dZ^1}{dt} \\;=\\; -c_1\\, k\\, H \\;-\\; e_1\\, M \\;-\\; \\kappa_1\\, Z^1.\n$$\nHere $a_H$, $b_H$, $d_H$, $a_M$, $b_M$, $d_M$, $c_0$, $e_0$, $c_1$, $e_1$ are fixed positive coupling coefficients, and $\\kappa_0$, $\\kappa_1$ are damping rates that encode the formulation choice: full covariant damping of all $Z_\\mu$ components corresponds to $\\kappa_0 = \\kappa$ and $\\kappa_1 = \\kappa$, while selective damping of $Z^0$ only corresponds to $\\kappa_0 = \\kappa$ and $\\kappa_1 = 0$. The terms proportional to $d_H$ and $d_M$ represent small intrinsic numerical diffusion of the constraints in a discretized evolution. Assume the following specific coefficient values that are consistent with linearized coupling between constraints and the $Z_\\mu$ fields:\n$$\na_H = 0.8,\\quad b_H = 0.5,\\quad d_H = 0.02,\\quad a_M = 0.6,\\quad b_M = 0.4,\\quad d_M = 0.01,\n$$\n$$\nc_0 = 0.7,\\quad e_0 = 0.3,\\quad c_1 = 0.9,\\quad e_1 = 0.2.\n$$\n\nYou are to implement and integrate this ordinary differential equation system for the mode amplitudes with initial data\n$$\nH(0) = 1,\\quad M(0) = 1,\\quad Z^0(0) = 0,\\quad Z^1(0) = 0,\n$$\nin dimensionless time $t$, and compare how the constraint violations evolve under the two damping strategies. For each test case, run the integration up to a specified final time $T$ and compute two diagnostic quantities:\n$$\nR_H \\;=\\; \\log_{10}\\!\\left(\\frac{|H(T)|}{|H(0)|}\\right),\\qquad\nR_M \\;=\\; \\log_{10}\\!\\left(\\frac{|M(T)|}{|M(0)|}\\right).\n$$\nThese diagnostics quantify reduction (negative values) or growth (positive values) of the Hamiltonian and momentum constraint amplitudes relative to their initial values.\n\nAll quantities are dimensionless; no physical units are required. Angles are not used. Percentages are not used. Your program must compute and report real-valued floats.\n\nImplement the program to evaluate the following test suite, which exercises a general case, boundary conditions, and edge cases:\n- Test case $1$: full covariant damping with $k = 0.5$, $\\kappa = 0.2$, $T = 50$.\n- Test case $2$: selective damping of $Z^0$ only with $k = 0.5$, $\\kappa = 0.2$, $T = 50$.\n- Test case $3$: boundary case with no damping, full covariant configuration, $k = 0.5$, $\\kappa = 0.0$, $T = 50$.\n- Test case $4$: edge case with high wavenumber and strong damping, full covariant configuration, $k = 5.0$, $\\kappa = 1.0$, $T = 20$.\n- Test case $5$: edge case counterpart with high wavenumber and strong damping, selective damping of $Z^0$ only, $k = 5.0$, $\\kappa = 1.0$, $T = 20$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. The list must contain the sequence of $(R_H,R_M)$ for each test case in order, flattened into a single list. For example, the format is $[R_{H,1},R_{M,1},R_{H,2},R_{M,2},R_{H,3},R_{M,3},R_{H,4},R_{M,4},R_{H,5},R_{M,5}]$ with no spaces and no additional text.", "solution": "The problem presented is a well-posed initial value problem for a system of four coupled, linear, first-order ordinary differential equations (ODEs) with constant coefficients. This system models the linearized evolution of constraint violations in numerical relativity under the Z4 and CCZ4 formulations. The goal is to integrate this system and compute diagnostic quantities that measure the growth or decay of constraint amplitudes.\n\nThe governing equations are:\n$$\n\\frac{dH}{dt} = -d_H H - b_H Z^0 - a_H k Z^1\n$$\n$$\n\\frac{dM}{dt} = -d_M M - a_M k Z^0 - b_M k Z^1\n$$\n$$\n\\frac{dZ^0}{dt} = -e_0 H - c_0 k M - \\kappa_0 Z^0\n$$\n$$\n\\frac{dZ^1}{dt} = -c_1 k H - e_1 M - \\kappa_1 Z^1\n$$\n\nThis system can be written in a compact matrix form, $\\frac{d\\mathbf{y}}{dt} = \\mathbf{A} \\mathbf{y}$, which is the fundamental starting point for the analysis. The state vector $\\mathbf{y}(t)$ is defined by the amplitudes of the constraints and the $Z_\\mu$ variables:\n$$\n\\mathbf{y}(t) = \\begin{pmatrix} H(t) \\\\ M(t) \\\\ Z^0(t) \\\\ Z^1(t) \\end{pmatrix}\n$$\nThe system matrix $\\mathbf{A}$ is a $4 \\times 4$ matrix composed of the coefficients provided in the problem statement. It depends on the wavenumber $k$ and the damping parameters $\\kappa_0$ and $\\kappa_1$.\n$$\n\\mathbf{A} = \\begin{pmatrix}\n-d_H & 0 & -b_H & -a_H k \\\\\n0 & -d_M & -a_M k & -b_M k \\\\\n-e_0 & -c_0 k & -\\kappa_0 & 0 \\\\\n-c_1 k & -e_1 & 0 & -\\kappa_1\n\\end{pmatrix}\n$$\nThe problem specifies the initial state of the system at time $t=0$ as:\n$$\n\\mathbf{y}(0) = \\begin{pmatrix} H(0) \\\\ M(0) \\\\ Z^0(0) \\\\ Z^1(0) \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\nFor a linear system with a constant coefficient matrix $\\mathbf{A}$, the solution at any time $t$ can be formally written using the matrix exponential:\n$$\n\\mathbf{y}(t) = e^{\\mathbf{A}t} \\mathbf{y}(0)\n$$\nThis provides a direct and exact method to determine the state of the system at the final time $T$. The computational procedure is to construct the matrix product $\\mathbf{A}T$, compute its matrix exponential $e^{\\mathbf{A}T}$, and then apply it to the initial condition vector $\\mathbf{y}(0)$ to find $\\mathbf{y}(T)$.\n\nThe program will implement this procedure for each of the $5$ test cases. For each case, the parameters $k$, $T$, and $\\kappa$ are used to define the damping parameters $\\kappa_0$ and $\\kappa_1$ according to the specified damping strategy ('full' or 'selective'). The specific numerical values for the coefficients $a_H = 0.8$, $b_H = 0.5$, $d_H = 0.02$, $a_M = 0.6$, $b_M = 0.4$, $d_M = 0.01$, $c_0 = 0.7$, $e_0 = 0.3$, $c_1 = 0.9$, and $e_1 = 0.2$ are then used to populate the matrix $\\mathbf{A}$. The matrix exponential is computed using a high-fidelity numerical algorithm (specifically, `scipy.linalg.expm`).\n\nOnce the final state vector $\\mathbf{y}(T) = [H(T), M(T), Z^0(T), Z^1(T)]^T$ is obtained, the diagnostic quantities $R_H$ and $R_M$ are calculated. Given the initial conditions $H(0) = 1$ and $M(0) = 1$, the formulas simplify to:\n$$\nR_H = \\log_{10}\\left(\\frac{|H(T)|}{|H(0)|}\\right) = \\log_{10}(|H(T)|)\n$$\n$$\nR_M = \\log_{10}\\left(\\frac{|M(T)|}{|M(0)|}\\right) = \\log_{10}(|M(T)|)\n$$\nThe absolute value is taken because the amplitude can oscillate and become negative, while the diagnostic measures the magnitude of the constraint violation. The results for each test case are then collected and formatted into the required output string.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import expm\n\ndef solve():\n    \"\"\"\n    Solves a system of linear ODEs modeling constraint propagation in numerical relativity\n    for a series of test cases.\n    \"\"\"\n    # Define the fixed coefficients from the problem statement.\n    a_H = 0.8\n    b_H = 0.5\n    d_H = 0.02\n    a_M = 0.6\n    b_M = 0.4\n    d_M = 0.01\n    c_0 = 0.7\n    e_0 = 0.3\n    c_1 = 0.9\n    e_1 = 0.2\n\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (k, kappa, T, damping_type)\n    test_cases = [\n        # Test case 1: full covariant damping\n        (0.5, 0.2, 50.0, 'full'),\n        # Test case 2: selective damping\n        (0.5, 0.2, 50.0, 'selective'),\n        # Test case 3: no damping (boundary case)\n        (0.5, 0.0, 50.0, 'full'),\n        # Test case 4: high k, strong damping, full\n        (5.0, 1.0, 20.0, 'full'),\n        # Test case 5: high k, strong damping, selective\n        (5.0, 1.0, 20.0, 'selective'),\n    ]\n\n    results = []\n    \n    # Initial conditions vector y(0) = [H(0), M(0), Z^0(0), Z^1(0)]^T\n    y0 = np.array([1.0, 1.0, 0.0, 0.0])\n\n    for k, kappa, T, damping_type in test_cases:\n        # Set formulation-dependent damping rates kappa_0 and kappa_1\n        if damping_type == 'full':\n            kappa_0 = kappa\n            kappa_1 = kappa\n        elif damping_type == 'selective':\n            kappa_0 = kappa\n            kappa_1 = 0.0\n        \n        # Construct the system matrix A for the ODE system dy/dt = A*y\n        A = np.array([\n            [-d_H, 0.0, -b_H, -a_H * k],\n            [0.0, -d_M, -a_M * k, -b_M * k],\n            [-e_0, -c_0 * k, -kappa_0, 0.0],\n            [-c_1 * k, -e_1, 0.0, -kappa_1]\n        ])\n\n        # The exact solution to the linear ODE system is y(T) = exp(A*T) @ y(0).\n        # We compute the matrix exponential of (A*T).\n        evolution_operator = expm(A * T)\n        \n        # Apply the evolution operator to the initial state to get the final state.\n        y_T = evolution_operator @ y0\n\n        # Extract final constraint amplitudes\n        H_T = y_T[0]\n        M_T = y_T[1]\n\n        # Initial values are H(0) = 1.0, M(0) = 1.0\n        H_0 = 1.0\n        M_0 = 1.0\n\n        # Calculate the diagnostic quantities R_H and R_M\n        # The log10 of the ratio of final to initial absolute amplitudes\n        R_H = np.log10(np.abs(H_T) / H_0)\n        R_M = np.log10(np.abs(M_T) / M_0)\n\n        results.extend([R_H, R_M])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3497100"}]}