{"hands_on_practices": [{"introduction": "The Valencia formulation evolves a set of conserved variables, yet the physics of the fluid, described by its equation of state, is most naturally expressed in terms of primitive variables like density and pressure. A crucial and non-trivial step in any numerical relativity code is therefore the \"conserved-to-primitive\" variable recovery. This foundational exercise [@problem_id:3496801] guides you through the analytical derivation of the core algebraic equation that connects the conserved quantities to the fluid pressure, providing an essential look under the hood of every GRHD simulation.", "problem": "Consider General Relativistic Hydrodynamics (GRHD) in a $3+1$ split on Minkowski spacetime with lapse $\\alpha=1$, shift $\\beta^{i}=0$, and spatial metric $\\gamma_{ij}=\\delta_{ij}$, in geometrized code units where the speed of light $c$ and the gravitational constant $G$ are unity. In the Valencia formulation, the conserved variables are defined by the rest-mass density $D$, momentum density $S_{i}$, and energy variable $\\tau$, built from the primitive variables rest-mass density $\\rho$, Eulerian three-velocity $v^{i}$, pressure $p$, and specific internal energy $\\epsilon$, together with the Lorentz factor $W$. The core definitions are:\n$$\nD = \\rho W,\\quad S_{i} = \\rho h W^{2} v_{i},\\quad \\tau = \\rho h W^{2} - p - D,\n$$\nwhere the specific enthalpy $h$ is given by an Equation of State (EOS). Adopt a gamma-law EOS,\n$$\np = (\\Gamma - 1)\\,\\rho\\,\\epsilon,\\quad h = 1 + \\epsilon + \\frac{p}{\\rho}.\n$$\nStarting from these definitions alone, and without introducing any additional specialized formulas, carry out the following:\n\n1. Eliminate the primitive variables $\\rho$ and $v^{i}$ to derive a single scalar algebraic relation that connects the unknown pressure $p$ to the conserved variables through the scalars $D$, $\\tau$, and $S^{2} \\equiv \\gamma^{ij} S_{i} S_{j}$, together with the Lorentz factor $W$. Then further eliminate $W$ to produce an equation involving only $p$ and the known conserved quantities $D$, $\\tau$, $S^{2}$, and the adiabatic index $\\Gamma$.\n\n2. For a particular conserved state specified by\n$$\nD = 2,\\quad S_{x} = 6\\sqrt{3},\\quad S_{y} = 0,\\quad S_{z} = 0,\\quad \\tau = 9,\\quad \\Gamma = 2,\n$$\nsolve your derived equation to recover the pressure $p$ in this state. Express the final pressure in dimensionless code units. If an approximation is required at any step, justify it; otherwise, give the exact value. No rounding instruction is necessary unless an approximation is made.", "solution": "The problem is evaluated as valid as it is scientifically grounded in general relativistic hydrodynamics, self-contained, well-posed, and objective. It presents a standard but non-trivial derivation and calculation within the specified theoretical framework.\n\nThe solution proceeds in two parts as requested.\n\nPart 1: Derivation of the algebraic equation for pressure $p$.\n\nWe are given the definitions for the conserved variables in the Valencia formulation on a flat background ($\\gamma_{ij} = \\delta_{ij}$, $\\alpha=1$, $\\beta^i=0$):\n$$\nD = \\rho W\n$$\n$$\nS_{i} = \\rho h W^{2} v_{i}\n$$\n$$\n\\tau = \\rho h W^{2} - p - D\n$$\nand a gamma-law equation of state:\n$$\np = (\\Gamma - 1)\\,\\rho\\,\\epsilon\n$$\n$$\nh = 1 + \\epsilon + \\frac{p}{\\rho}\n$$\nHere, $\\rho$ is the rest-mass density, $W$ is the Lorentz factor, $h$ is the specific enthalpy, $v_i$ is the three-velocity, $p$ is the pressure, $\\epsilon$ is the specific internal energy, and $\\Gamma$ is the adiabatic index.\n\nFirst, we express the specific enthalpy $h$ in terms of $p$, $\\rho$, and $\\Gamma$. From the EOS, we have $\\epsilon = \\frac{p}{(\\Gamma-1)\\rho}$. Substituting this into the definition of $h$:\n$$\nh = 1 + \\frac{p}{(\\Gamma - 1)\\rho} + \\frac{p}{\\rho} = 1 + \\frac{p}{\\rho} \\left( \\frac{1}{\\Gamma-1} + 1 \\right) = 1 + \\frac{p}{\\rho} \\left( \\frac{\\Gamma}{\\Gamma-1} \\right)\n$$\nThis gives us a direct relation between $h$, $p$, and $\\rho$:\n$$\n\\rho h = \\rho + \\frac{\\Gamma p}{\\Gamma-1}\n$$\n\nNext, we manipulate the conserved variable definitions. Let's define an auxiliary variable $A$ for convenience:\n$$\nA \\equiv \\tau + D + p\n$$\nFrom the definition of $\\tau$, we can see that:\n$$\nA = (\\rho h W^2 - p - D) + D + p = \\rho h W^2\n$$\nNow consider the momentum density $S_i$. Its magnitude squared is $S^2 \\equiv S_i S^i = \\delta^{ij} S_i S_j = S_i S_i$.\n$$\nS^2 = (\\rho h W^2 v_i) (\\rho h W^2 v_i) = (\\rho h W^2)^2 (v_i v_i) = A^2 v^2\n$$\nwhere $v^2 = v_i v_i$. The Lorentz factor is defined as $W = (1-v^2)^{-1/2}$, which implies $v^2 = 1 - W^{-2}$. Substituting this into the expression for $S^2$:\n$$\nS^2 = A^2 (1 - W^{-2})\n$$\nRearranging this equation gives the requested relation between $p$, the conserved scalars $D, \\tau, S^2$ (which are part of $A$), and the Lorentz factor $W$:\n$$\nS^2 = (\\tau + D + p)^2 \\left(1 - \\frac{1}{W^2}\\right)\n$$\nThis equation fulfills the first requirement of Part $1$.\n\nTo eliminate $W$, we need another relation. We can derive an expression for $W$ from the definitions. From $S^2 = A^2(1 - W^{-2})$, we can solve for $W$:\n$$\n\\frac{S^2}{A^2} = 1 - \\frac{1}{W^2} \\implies \\frac{1}{W^2} = 1 - \\frac{S^2}{A^2} = \\frac{A^2 - S^2}{A^2}\n$$\nSince $W \\ge 1$, we must have $A^2 - S^2 \\ge 0$. Also, since relativistic velocities require $A > |S|$, both $A$ and $\\sqrt{A^2-S^2}$ are real and non-negative. Taking the positive square root:\n$$\nW = \\frac{A}{\\sqrt{A^2 - S^2}}\n$$\nNow, we find an alternative expression for $W$ involving the EOS. Let's combine $A = \\rho h W^2$ and $D=\\rho W$:\n$$\nh = \\frac{A}{\\rho W^2} = \\frac{A}{(D/W) W^2} = \\frac{A}{DW}\n$$\nNow we equate the two expressions we have for $h$:\n$$\n1 + \\frac{\\Gamma}{\\Gamma-1} \\frac{p}{\\rho} = \\frac{A}{DW}\n$$\nSubstitute $\\rho = D/W$:\n$$\n1 + \\frac{\\Gamma}{\\Gamma-1} \\frac{p}{D/W} = \\frac{A}{DW} \\implies 1 + \\frac{\\Gamma p W}{(\\Gamma-1)D} = \\frac{A}{DW}\n$$\nMultiply by $DW$:\n$$\nDW + \\frac{\\Gamma p}{\\Gamma-1} W^2 = A\n$$\nNow we substitute our expression $W = A/\\sqrt{A^2 - S^2}$ into this equation to eliminate $W$:\n$$\nD \\left(\\frac{A}{\\sqrt{A^2 - S^2}}\\right) + \\frac{\\Gamma p}{\\Gamma-1} \\left(\\frac{A^2}{A^2 - S^2}\\right) = A\n$$\nAssuming $A \\neq 0$ (which is physically required), we divide by $A$:\n$$\n\\frac{D}{\\sqrt{A^2-S^2}} + \\frac{\\Gamma p A}{(\\Gamma-1)(A^2 - S^2)} = 1\n$$\nTo eliminate the square root from the denominator, multiply the entire equation by $A^2 - S^2$:\n$$\nD \\sqrt{A^2 - S^2} + \\frac{\\Gamma p A}{\\Gamma-1} = A^2 - S^2\n$$\nRearranging gives the final equation involving only $p$, the knowns $D, \\tau, S^2$, and $\\Gamma$ (with $A = \\tau+D+p$):\n$$\n(\\tau+D+p)^2 - S^2 - D\\sqrt{(\\tau+D+p)^2 - S^2} - \\frac{\\Gamma p (\\tau+D+p)}{\\Gamma-1} = 0\n$$\nThis is the desired algebraic equation for $p$.\n\nPart 2: Solving for pressure $p$.\n\nWe are given the specific conserved state:\n$D = 2$\n$S_x = 6\\sqrt{3}$, $S_y = 0$, $S_z = 0$. So, $S^2 = S_x^2 + S_y^2 + S_z^2 = (6\\sqrt{3})^2 = 36 \\times 3 = 108$.\n$\\tau = 9$\n$\\Gamma = 2$\n\nFor $\\Gamma=2$, the term $\\frac{\\Gamma}{\\Gamma-1} = \\frac{2}{2-1} = 2$.\nThe auxiliary quantity $A$ is $A = \\tau+D+p = 9+2+p = 11+p$.\nSubstituting these values into the derived equation:\n$$\n((11+p)^2 - 108) - 2\\sqrt{(11+p)^2 - 108} - 2p(11+p) = 0\n$$\nLet's simplify the terms inside the parentheses and the square root:\n$$\n(11+p)^2 - 108 = (121 + 22p + p^2) - 108 = p^2 + 22p + 13\n$$\nThe term $2p(11+p) = 22p + 2p^2$.\nThe equation becomes:\n$$\n(p^2 + 22p + 13) - 2\\sqrt{p^2 + 22p + 13} - (22p + 2p^2) = 0\n$$\nSimplifying by collecting terms:\n$$\n-p^2 + 13 - 2\\sqrt{p^2 + 22p + 13} = 0\n$$\n$$\n13 - p^2 = 2\\sqrt{p^2 + 22p + 13}\n$$\nTo solve for $p$, we square both sides. This may introduce extraneous solutions. A necessary condition for a valid solution is that the right-hand side is non-negative, which implies $13-p^2 \\ge 0$. As pressure must be non-negative ($p \\ge 0$), this restricts potential solutions to the range $0 \\le p \\le \\sqrt{13}$.\nSquaring both sides yields:\n$$\n(13-p^2)^2 = 4(p^2 + 22p + 13)\n$$\n$$\n169 - 26p^2 + p^4 = 4p^2 + 88p + 52\n$$\nRearranging into a standard polynomial form:\n$$\np^4 - 30p^2 - 88p + 117 = 0\n$$\nWe seek roots of this quartic polynomial. Let's test for simple integer roots. For $p=1$:\n$$\n(1)^4 - 30(1)^2 - 88(1) + 117 = 1 - 30 - 88 + 117 = 118 - 118 = 0\n$$\nSo, $p=1$ is a root. Let's check if it is valid. It is in the required range $0 \\le 1 \\le \\sqrt{13}$. We must verify it in the equation before squaring:\nLeft side: $13-p^2 = 13 - 1^2 = 12$.\nRight side: $2\\sqrt{p^2+22p+13} = 2\\sqrt{1^2+22(1)+13} = 2\\sqrt{1+22+13} = 2\\sqrt{36} = 2(6) = 12$.\nSince $12=12$, $p=1$ is a valid solution.\n\nTo check for other solutions, we perform polynomial division of $p^4 - 30p^2 - 88p + 117$ by $(p-1)$ to get the cubic factor:\n$$\n(p-1)(p^3 + p^2 - 29p - 117) = 0\n$$\nLet $g(p) = p^3 + p^2 - 29p - 117$. We search for other real roots. Analysis of $g(p)$ shows it has only one real root, which lies between $p=6$ and $p=7$. Any root $p > \\sqrt{13} \\approx 3.606$ would violate the condition $13-p^2 \\ge 0$ and is therefore an extraneous solution introduced by squaring. Thus, no other valid physical solutions exist.\n\nThe unique physically acceptable pressure is $p=1$.", "answer": "$$\n\\boxed{1}\n$$", "id": "3496801"}, {"introduction": "With the ability to convert between conserved and primitive variables, we can build the engine of our simulation: the numerical flux calculation. In the finite volume method, the evolution of the system is determined by the fluxes of conserved quantities across the boundaries of each grid cell. This hands-on practice [@problem_id:3496789] directs you to implement the robust and widely-used Harten–Lax–van Leer–Einfeldt (HLLE) approximate Riemann solver, a cornerstone algorithm for capturing shocks and contact discontinuities in relativistic flows.", "problem": "Consider one-dimensional special-relativistic hydrodynamics in flat spacetime within the Valencia formulation used in numerical relativity. In geometrized units where the speed of light is $c=1$, model a perfect fluid with a gamma-law equation of state. Let the fluid primitive variables be the rest-mass density $\\,\\rho\\,$, the pressure $\\,p\\,$, and the Eulerian three-velocity $\\,v\\,$ along the $x$ direction. Assume a gamma-law equation of state with constant adiabatic index $\\,\\gamma\\,$, and define the specific internal energy $\\,\\epsilon\\,$ and specific enthalpy $\\,h\\,$ by $\\,\\epsilon = \\dfrac{p}{(\\gamma - 1)\\rho}\\,$ and $\\,h = 1 + \\epsilon + \\dfrac{p}{\\rho}\\,$. Let the Lorentz factor be $\\,W = \\dfrac{1}{\\sqrt{1 - v^2}}\\,.$\n\nThe Valencia formulation introduces conservative variables $\\,D\\,$, $\\,S_x\\,$, and $\\,\\tau\\,$, defined from the primitive variables, and the corresponding physical fluxes $\\,F^x(D)\\,$, $\\,F^x(S_x)\\,$, and $\\,F^x(\\tau)\\,$ along the $x$-direction. Starting from mass conservation $\\,\\nabla_\\mu(\\rho u^\\mu)=0\\,$ and energy-momentum conservation $\\,\\nabla_\\mu T^{\\mu\\nu}=0\\,$ with the perfect-fluid stress-energy tensor $\\,T^{\\mu\\nu} = \\rho h u^\\mu u^\\nu + p g^{\\mu\\nu}\\,$ in Minkowski spacetime, derive an algorithm that computes the Harten–Lax–van Leer–Einfeldt (HLLE) numerical flux at an interface between two states. Your derivation must identify the physical flux vector components in terms of the conservative variables and estimate the left and right limiting characteristic speeds in special relativity using the local sound speed.\n\nImplement the derived algorithm as a complete, runnable program that, for each test case, takes a left state $(\\rho_L, p_L, v_L)$ and a right state $(\\rho_R, p_R, v_R)$ together with $\\,\\gamma\\,$, and outputs the HLLE numerical flux vector $[F_D, F_{S_x}, F_{\\tau}]$ at the interface. Use the special-relativistic sound speed $\\,c_s\\,$ of a gamma-law ideal fluid and the appropriate relativistic formula for signal speeds along $x$ based on $\\,v\\,$ and $\\,c_s\\,$. Ensure all states are physically admissible: $\\,\\rho > 0\\,$, $\\,p > 0\\,$, and $\\,|v| < 1\\,$.\n\nUnits: use geometrized units with $\\,c=1\\,$. Angles are not used. Express each flux component as a float rounded to eight decimal places.\n\nTest suite:\n- Case A (moderate subsonic states):\n  - Left: $\\,\\rho_L = 1.0\\,$, $\\,p_L = 1.0\\,$, $\\,v_L = 0.0\\,$.\n  - Right: $\\,\\rho_R = 0.125\\,$, $\\,p_R = 0.1\\,$, $\\,v_R = 0.0\\,$.\n  - Adiabatic index: $\\,\\gamma = 1.4\\,$.\n- Case B (supersonic left state toward higher pressure):\n  - Left: $\\,\\rho_L = 1.0\\,$, $\\,p_L = 0.1\\,$, $\\,v_L = 0.8\\,$.\n  - Right: $\\,\\rho_R = 1.0\\,$, $\\,p_R = 1.0\\,$, $\\,v_R = 0.0\\,$.\n  - Adiabatic index: $\\,\\gamma = 1.4\\,$.\n- Case C (near-vacuum right state):\n  - Left: $\\,\\rho_L = 0.5\\,$, $\\,p_L = 0.5\\,$, $\\,v_L = 0.3\\,$.\n  - Right: $\\,\\rho_R = 10^{-6}\\,$, $\\,p_R = 10^{-8}\\,$, $\\,v_R = 0.0\\,$.\n  - Adiabatic index: $\\,\\gamma = 1.4\\,$.\n- Case D (strongly relativistic opposing flows):\n  - Left: $\\,\\rho_L = 1.0\\,$, $\\,p_L = 10.0\\,$, $\\,v_L = 0.9\\,$.\n  - Right: $\\,\\rho_R = 1.0\\,$, $\\,p_R = 1.0\\,$, $\\,v_R = -0.5\\,$.\n  - Adiabatic index: $\\,\\gamma = 1.4\\,$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element corresponds to one test case and is itself a list of three floats $[F_D, F_{S_x}, F_{\\tau}]$ rounded to eight decimal places. For example, the output should look like $[[f_{D,A}, f_{S,A}, f_{\\tau,A}], [f_{D,B}, f_{S,B}, f_{\\tau,B}], [f_{D,C}, f_{S,C}, f_{\\tau,C}], [f_{D,D}, f_{S,D}, f_{\\tau,D}]]$, where $\\,f_{D,A}\\,$ is the $\\,F_D\\,$ value for Case A, etc.", "solution": "The user wants to solve a problem in special-relativistic hydrodynamics.\n\n### Step 1: Extract Givens\nThe problem provides the following information:\n- **Physics Model**: One-dimensional special-relativistic hydrodynamics in flat spacetime (Minkowski).\n- **Fluid**: Perfect fluid.\n- **Equation of State (EoS)**: Gamma-law, $p = (\\gamma - 1)\\rho\\epsilon$, with a constant adiabatic index $\\gamma$.\n- **Primitive Variables**: Rest-mass density $\\rho$, pressure $p$, and Eulerian three-velocity $v$ in the $x$-direction.\n- **Derived Quantities**:\n    - Specific internal energy: $\\epsilon = \\frac{p}{(\\gamma - 1)\\rho}$\n    - Specific enthalpy: $h = 1 + \\epsilon + \\frac{p}{\\rho}$\n    - Lorentz factor: $W = \\frac{1}{\\sqrt{1 - v^2}}$\n- **Framework**: Valencia formulation.\n- **Conservative Variables**: $D$, $S_x$, $\\tau$.\n- **Physical Fluxes**: $F^x(D)$, $F^x(S_x)$, $F^x(\\tau)$.\n- **Governing Equations**: Mass conservation $\\nabla_\\mu(\\rho u^\\mu)=0$ and energy-momentum conservation $\\nabla_\\mu T^{\\mu\\nu}=0$, with the stress-energy tensor $T^{\\mu\\nu} = \\rho h u^\\mu u^\\nu + p g^{\\mu\\nu}$.\n- **Numerical Method**: Harten–Lax–van Leer–Einfeldt (HLLE) numerical flux.\n- **Task**: Derive an algorithm to compute the HLLE numerical flux at an interface and implement it.\n- **Signal Speed Estimation**: Use the special-relativistic sound speed $c_s$ and the relativistic formula for signal speeds.\n- **Physical Admissibility**: All states must satisfy $\\rho > 0$, $p > 0$, and $|v| < 1$.\n- **Units**: Geometrized units with $c=1$.\n- **Test Cases**:\n    - **Case A**: Left State $(\\rho_L, p_L, v_L) = (1.0, 1.0, 0.0)$, Right State $(\\rho_R, p_R, v_R) = (0.125, 0.1, 0.0)$, $\\gamma = 1.4$.\n    - **Case B**: Left State $(\\rho_L, p_L, v_L) = (1.0, 0.1, 0.8)$, Right State $(\\rho_R, p_R, v_R) = (1.0, 1.0, 0.0)$, $\\gamma = 1.4$.\n    - **Case C**: Left State $(\\rho_L, p_L, v_L) = (0.5, 0.5, 0.3)$, Right State $(\\rho_R, p_R, v_R) = (10^{-6}, 10^{-8}, 0.0)$, $\\gamma = 1.4$.\n    - **Case D**: Left State $(\\rho_L, p_L, v_L) = (1.0, 10.0, 0.9)$, Right State $(\\rho_R, p_R, v_R) = (1.0, 1.0, -0.5)$, $\\gamma = 1.4$.\n- **Output Format**: A single line containing a list of lists, e.g., `[[f_DA, f_SA, f_tauA], [f_DB, f_SB, f_tauB], ...]`, with each flux component rounded to eight decimal places.\n\n### Step 2: Validate Using Extracted Givens\n1.  **Scientifically Grounded**: The problem is firmly rooted in the established theories of special relativity and fluid dynamics. The Valencia formulation and HLLE scheme are standard and widely used tools in numerical relativity. All definitions and equations are standard in the field.\n2.  **Well-Posed**: The problem is well-posed. It provides two well-defined physical states and asks for the computation of the numerical flux between them using a specified algorithm (HLLE). All necessary parameters ($\\gamma$) and state variables are given. Given a deterministic algorithm, the solution is unique and meaningful.\n3.  **Objective**: The problem is stated in precise, objective language. The terms are standard within physics and numerical methods. There is no subjective or opinion-based content.\n4.  **Self-Contained and Consistent**: The problem contains all necessary information. The definitions of primitive and conserved variables, along with the EoS, are consistent with each other and with the standard literature. There are no contradictions.\n5.  **Realistic/Feasible**: The physical parameters in the test cases are admissible ($\\rho>0, p>0, |v|<1$) and representative of scenarios encountered in relativistic astrophysics simulations (e.g., shock tubes).\n\nThe problem does not exhibit any of the flaws listed in the instructions. It is a standard, verifiable problem in computational physics.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. We will proceed to derive and implement the solution.\n\n### Principle-Based Design and Derivation\n\nThe system of one-dimensional special-relativistic hydrodynamic equations can be written in conservation-law form:\n$$\n\\frac{\\partial \\mathbf{U}}{\\partial t} + \\frac{\\partial \\mathbf{F}}{\\partial x} = 0\n$$\nwhere $\\mathbf{U}$ is the vector of conserved variables and $\\mathbf{F}$ is the vector of their corresponding fluxes.\n\n**1. Conserved Variables and Fluxes**\n\nIn the Valencia formulation for flat spacetime, the conserved variables $\\mathbf{U} = [D, S_x, \\tau]^T$ are defined in terms of the primitive variables $(\\rho, p, v)$.\n\n-   **Conserved Rest-Mass Density ($D$)**: This is the rest-mass density as measured in the lab frame. It is derived from the time component of the conserved four-current $J^\\mu = \\rho u^\\mu$, where $u^\\mu = W(1, v, 0, 0)$ is the four-velocity.\n    $$D = \\rho W$$\n-   **Conserved Momentum Density ($S_x$)**: This is the momentum density in the $x$-direction. It is the mixed time-space component of the stress-energy tensor, $S_x = T^{tx}$.\n    $$S_x = \\rho h W^2 v$$\n-   **Conserved Energy Density ($\\tau$)**: This is defined as the total energy density measured by a Eulerian observer, $E=T^{tt}$, minus the conserved rest-mass density, $D$.\n    $$E = T^{tt} = \\rho h W^2 - p$$\n    $$\\tau = E - D = \\rho h W^2 - p - \\rho W$$\n\nThe specific enthalpy $h$ for a gamma-law gas is:\n$$h = 1 + \\epsilon + \\frac{p}{\\rho} = 1 + \\frac{\\gamma p}{(\\gamma-1)\\rho}$$\n\nThe flux vector $\\mathbf{F}(\\mathbf{U}) = [F_D, F_{S_x}, F_\\tau]^T$ is derived from the spatial components of the corresponding tensors.\n-   **Mass Flux ($F_D$)**: This is the spatial component of the four-current, $J^x$.\n    $$F_D = \\rho u^x = \\rho W v = D v$$\n-   **Momentum Flux ($F_{S_x}$)**: This is the spatial component of the stress-energy tensor, $T^{xx}$.\n    $$F_{S_x} = \\rho h u^x u^x + p g^{xx} = \\rho h (Wv)^2 + p = S_x v + p$$\n-   **Energy Flux ($F_\\tau$)**: The conservation law for $\\tau$ is $\\partial_t \\tau + \\partial_x F_\\tau = 0$. From $\\partial_t \\tau = \\partial_t(E-D) = \\partial_t E - \\partial_t D$ and the fundamental conservation laws $\\partial_t E + \\partial_x S_x = 0$ and $\\partial_t D + \\partial_x F_D = 0$, we get $\\partial_t \\tau = - \\partial_x S_x - (-\\partial_x F_D) = - \\partial_x(S_x - F_D)$. Thus,\n    $$F_\\tau = S_x - F_D = S_x - D v$$\n    An equivalent and computationally simpler expression is $F_\\tau = (\\tau+p)v$.\n\n**2. HLLE Numerical Flux**\n\nThe HLLE numerical flux $\\mathbf{F}^{\\text{HLLE}}$ at an interface between a left state $(\\mathbf{U}_L, \\mathbf{F}_L)$ and a right state $(\\mathbf{U}_R, \\mathbf{F}_R)$ is given by:\n$$\n\\mathbf{F}^{\\text{HLLE}} = \\frac{S_R \\mathbf{F}_L - S_L \\mathbf{F}_R + S_L S_R (\\mathbf{U}_R - \\mathbf{U}_L)}{S_R - S_L}\n$$\nHere, $S_L$ and $S_R$ are estimates for the fastest left-going and right-going signal speeds in the Riemann fan emerging from the interface.\n\n**3. Signal Speed Estimation**\n\nThe characteristic speeds of the system are the eigenvalues of the Jacobian matrix $\\partial \\mathbf{F} / \\partial \\mathbf{U}$. For 1D special-relativistic hydrodynamics, these are a contact wave moving with the fluid, $\\lambda_0 = v$, and two sound waves with speeds $\\lambda_\\pm$. In flat spacetime, the speeds of the sound waves as measured in the lab frame are given by the relativistic velocity addition formula:\n$$\n\\lambda_\\pm = \\frac{v \\pm c_s}{1 \\pm v c_s}\n$$\nwhere $c_s$ is the sound speed in the fluid's rest frame. For a gamma-law gas, the sound speed squared is:\n$$\nc_s^2 = \\frac{\\partial p}{\\partial e}\\bigg|_s = \\frac{\\gamma p}{\\rho h}\n$$\nwhere $e = \\rho(1+\\epsilon)$ is the total energy density in the rest frame. The sound speed must be less than the speed of light ($c_s < 1$), which is true for $\\gamma \\in (1, 2]$.\n\nThe signal speeds $S_L$ and $S_R$ are estimated by taking the minimum and maximum characteristic speeds over the left and right states. A common, robust choice is:\n$$\nS_L = \\min(0, \\lambda_{-,L}, \\lambda_{-,R})\n$$\n$$\nS_R = \\max(0, \\lambda_{+,L}, \\lambda_{+,R})\n$$\nwhere $\\lambda_{\\pm,L}$ and $\\lambda_{\\pm,R}$ are the sound wave speeds calculated for the left and right states, respectively. This choice ensures that the method is properly upwinded. If all waves move to the right ($\\lambda_{-,L} > 0, \\lambda_{-,R} > 0$), then $S_L=0$ and $\\mathbf{F}^{\\text{HLLE}} = \\mathbf{F}_L$. If all waves move to the left ($\\lambda_{+,L} < 0, \\lambda_{+,R} < 0$), then $S_R=0$ and $\\mathbf{F}^{\\text{HLLE}} = \\mathbf{F}_R$.\n\n**4. Algorithm**\n\nThe algorithm to compute the HLLE flux vector for a given left state $(\\rho_L, p_L, v_L)$ and right state $(\\rho_R, p_R, v_R)$ is as follows:\n\n1.  **For the Left State**:\n    a.  Calculate the Lorentz factor $W_L = (1 - v_L^2)^{-1/2}$.\n    b.  Calculate the specific enthalpy $h_L = 1 + \\frac{\\gamma p_L}{(\\gamma-1)\\rho_L}$.\n    c.  Calculate the sound speed $c_{s,L} = \\sqrt{\\frac{\\gamma p_L}{\\rho_L h_L}}$.\n    d.  Calculate the characteristic speeds $\\lambda_{\\pm,L} = \\frac{v_L \\pm c_{s,L}}{1 \\pm v_L c_{s,L}}$.\n    e.  Calculate the conserved state vector $\\mathbf{U}_L = [D_L, S_{x,L}, \\tau_L]^T$ using the formulas above.\n    f.  Calculate the flux vector $\\mathbf{F}_L = [F_{D,L}, F_{S_x,L}, F_{\\tau,L}]^T$ using the formulas above.\n\n2.  **For the Right State**: Repeat step 1 for the right state variables to obtain $\\lambda_{\\pm,R}$, $\\mathbf{U}_R$, and $\\mathbf{F}_R$.\n\n3.  **Estimate Signal Speeds**: Compute $S_L = \\min(0, \\lambda_{-,L}, \\lambda_{-,R})$ and $S_R = \\max(0, \\lambda_{+,L}, \\lambda_{+,R})$.\n\n4.  **Calculate HLLE Flux**: If $S_R - S_L$ is non-zero, apply the HLLE formula:\n    $$\n    \\mathbf{F}^{\\text{HLLE}} = \\frac{S_R \\mathbf{F}_L - S_L \\mathbf{F}_R + S_L S_R (\\mathbf{U}_R - \\mathbf{U}_L)}{S_R - S_L}\n    $$\n    If $S_R - S_L \\approx 0$, it implies $S_L=S_R=0$. In this case, the states are in a region where all characteristic speeds are zero, which is non-physical unless the fluid is cold dust ($p=0, c_s=0$). In practice, for a stable numerical implementation with floating-point arithmetic, a small positive value is added to the denominator or a special case is handled. For the given test cases, this degeneracy is not expected.\n\n5.  **Output**: Return the resulting flux vector $\\mathbf{F}^{\\text{HLLE}} = [F_D, F_{S_x}, F_\\tau]$, with each component formatted as required.\n\nThis algorithm will be implemented in the final program.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_hlle_flux(rho_L, p_L, v_L, rho_R, p_R, v_R, gamma):\n    \"\"\"\n    Calculates the HLLE numerical flux for 1D special relativistic hydrodynamics.\n\n    Args:\n        rho_L (float): Rest-mass density of the left state.\n        p_L (float): Pressure of the left state.\n        v_L (float): Velocity of the left state.\n        rho_R (float): Rest-mass density of the right state.\n        p_R (float): Pressure of the right state.\n        v_R (float): Velocity of the right state.\n        gamma (float): Adiabatic index.\n\n    Returns:\n        list[float]: The HLLE flux vector [F_D, F_Sx, F_tau].\n    \"\"\"\n\n    def get_state_properties(rho, p, v, gamma):\n        \"\"\"\n        Computes derived physical quantities from primitive variables.\n        \"\"\"\n        # Ensure physical admissibility of the state\n        if rho <= 0 or p <= 0 or abs(v) >= 1:\n            raise ValueError(f\"Physically inadmissible state: rho={rho}, p={p}, v={v}\")\n\n        # Lorentz factor\n        W = 1.0 / np.sqrt(1.0 - v**2)\n        \n        # Specific enthalpy\n        h = 1.0 + gamma * p / ((gamma - 1.0) * rho)\n        \n        # Sound speed squared and sound speed\n        # This must be < 1 for a causal EOS\n        cs2 = (gamma * p) / (rho * h)\n        if cs2 >= 1.0:\n            raise ValueError(f\"Acausal sound speed detected: cs^2 = {cs2} >= 1\")\n        cs = np.sqrt(cs2)\n        \n        # Characteristic speeds (eigenvalues)\n        lambda_p = (v + cs) / (1.0 + v * cs)\n        lambda_m = (v - cs) / (1.0 - v * cs)\n        \n        # Conservative variables\n        D = rho * W\n        Sx = rho * h * W**2 * v\n        tau = rho * h * W**2 - p - D\n        \n        U = np.array([D, Sx, tau])\n        \n        # Flux vector\n        F_D = D * v\n        F_Sx = Sx * v + p\n        F_tau = (tau + p) * v # Equivalent to Sx - D*v\n        \n        F = np.array([F_D, F_Sx, F_tau])\n        \n        return lambda_p, lambda_m, U, F\n\n    # Calculate properties for Left and Right states\n    lambda_p_L, lambda_m_L, U_L, F_L = get_state_properties(rho_L, p_L, v_L, gamma)\n    lambda_p_R, lambda_m_R, U_R, F_R = get_state_properties(rho_R, p_R, v_R, gamma)\n    \n    # Estimate signal speeds\n    S_L = min(0.0, lambda_m_L, lambda_m_R)\n    S_R = max(0.0, lambda_p_L, lambda_p_R)\n    \n    # Denominator of the HLLE flux formula\n    S_R_minus_S_L = S_R - S_L\n    \n    # Handle the case where S_R == S_L to avoid division by zero\n    if np.isclose(S_R_minus_S_L, 0.0):\n        # This occurs if all waves are stationary or all move in one direction.\n        # If S_L=S_R=0, implies subsonic flow split. A simple average can be taken.\n        # If S_L, S_R are not zero, the upwinding part of HLLE handles this.\n        # S_L <= 0, S_R >= 0 by definition, so S_R-S_L=0 only if S_L=S_R=0\n        # Given this suggests all eigenvalues are zero, F should be zero if v=0.\n        # A more general choice is to average the fluxes.\n        return (0.5 * (F_L + F_R)).tolist()\n\n    # Calculate the HLLE flux\n    F_HLLE = (S_R * F_L - S_L * F_R + S_L * S_R * (U_R - U_L)) / S_R_minus_S_L\n    \n    return F_HLLE.tolist()\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A (moderate subsonic states)\n        {'L': (1.0, 1.0, 0.0), 'R': (0.125, 0.1, 0.0), 'gamma': 1.4},\n        # Case B (supersonic left state toward higher pressure)\n        {'L': (1.0, 0.1, 0.8), 'R': (1.0, 1.0, 0.0), 'gamma': 1.4},\n        # Case C (near-vacuum right state)\n        {'L': (0.5, 0.5, 0.3), 'R': (1e-6, 1e-8, 0.0), 'gamma': 1.4},\n        # Case D (strongly relativistic opposing flows)\n        {'L': (1.0, 10.0, 0.9), 'R': (1.0, 1.0, -0.5), 'gamma': 1.4},\n    ]\n\n    results = []\n    for case in test_cases:\n        rho_L, p_L, v_L = case['L']\n        rho_R, p_R, v_R = case['R']\n        gamma = case['gamma']\n        \n        flux_vector = calculate_hlle_flux(rho_L, p_L, v_L, rho_R, p_R, v_R, gamma)\n        \n        # Format each component to 8 decimal places\n        formatted_flux = [f\"{x:.8f}\" for x in flux_vector]\n        results.append(f\"[{','.join(formatted_flux)}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[[{results[0][1:-1]}],[{results[1][1:-1]}],[{results[2][1:-1]}],[{results[3][1:-1]}]]\")\n\nsolve()\n```", "id": "3496789"}, {"introduction": "Simulating physics in strong gravity, especially near black holes, introduces profound challenges that are absent in special relativity. The choice of spacetime coordinates, encoded by the lapse function $\\alpha$ and shift vector $\\beta^i$, can dramatically impact the stability and efficiency of a numerical code. This final practice [@problem_id:3496811] confronts the critical issue of the Courant–Friedrichs–Lewy (CFL) condition near an event horizon, demonstrating how a naive implementation can fail and guiding you to derive a robust timestep limit based on coordinate-invariant physical speeds.", "problem": "Consider the General Relativistic Hydrodynamics (GRHD) Valencia formulation in a $3+1$ split of spacetime, where the line element can be written as $$ds^2 = -\\alpha^2 dt^2 + \\gamma_{ij}\\left(dx^i + \\beta^i dt\\right)\\left(dx^j + \\beta^j dt\\right),$$ with lapse $\\alpha$, shift $\\beta^i$, and spatial metric $\\gamma_{ij}$. The Valencia formulation evolves conservative variables with fluxes that depend on the transport velocity $\\tilde{v}^i = \\alpha v^i - \\beta^i$, where $v^i$ is the Eulerian three-velocity measured by the normal observer. In a diagonal spatial metric, define the orthonormal (physical) components of the velocity by $v_{\\hat{i}} = \\sqrt{\\gamma_{ii}}\\, v^i$ (no summation on $i$).\n\nNear a black hole horizon in a Schwarzschild-like slicing, the lapse $\\alpha$ collapses to $0$, while in horizon-penetrating coordinates (such as Painlevé–Gullstrand), the lapse can remain finite. This poses a numerical challenge for Courant–Friedrichs–Lewy (CFL) stability if the timestep is based solely on coordinate characteristic speeds. Your task is to start from first principles and carry out the following:\n\n1. Starting from the $3+1$ decomposition and the definition of the Eulerian observer, derive the coordinate transport speed along a single spatial direction $i$ for the Valencia fluxes in terms of $\\alpha$, $\\beta^i$, and $v_{\\hat{i}}$.\n2. Show the relation between the coordinate transport speed and the physical speed measured in the orthonormal frame, and derive a rescaling that yields an effective transport speed based on the physical components $v_{\\hat{i}}$ rather than the coordinate components $v^i$, such that the effective CFL condition is governed by physical speeds. Your rescaling must be justified by mapping to a horizon-penetrating coordinate system and demonstrating equivalence there.\n3. Specialize to spherically symmetric spacetimes and purely radial flows. Provide the metric coefficients for:\n   - Schwarzschild coordinates with mass parameter $M$, radial coordinate $r$, lapse $\\alpha = \\sqrt{1 - 2M/r}$, vanishing shift $\\beta^r = 0$, and spatial metric component $\\gamma_{rr} = 1/\\left(1 - 2M/r\\right)$;\n   - Painlevé–Gullstrand coordinates with $\\alpha = 1$, radial shift $\\beta^r = \\sqrt{2M/r}$, and $\\gamma_{rr} = 1$.\n4. Let a numerical grid in the radial direction have uniform spacing $\\Delta r$, and let the CFL bound on the coordinate timestep be of the form $$\\Delta t_{\\mathrm{coord}} \\le \\mathcal{C}\\,\\frac{\\Delta r}{\\max |\\lambda|},$$ where $\\mathcal{C}$ is the Courant factor and $\\lambda$ is the coordinate transport speed along $r$. Using your rescaling, define an effective physical transport speed and the corresponding effective CFL timestep $\\Delta t_{\\mathrm{phys}}$ based on physical speeds. You must express all steps and quantities in terms of $\\alpha$, $\\beta^r$, $\\gamma_{rr}$, and $v_{\\hat{r}}$.\n5. Implement a program that, for each test case below, computes both $\\Delta t_{\\mathrm{coord}}$ and $\\Delta t_{\\mathrm{phys}}$ and returns the ratio $\\Delta t_{\\mathrm{phys}} / \\Delta t_{\\mathrm{coord}}$.\n\nUse dimensionless geometric units with $G = c = M = 1$, so that all lengths and times are expressed in units of $M$. Angles do not appear. Your final program must produce results as floats. No percentages are allowed.\n\nTest Suite:\n- Case $1$: Schwarzschild slicing at $r = 2.1$, $v_{\\hat{r}} = 0.5$, $\\Delta r = 0.01$, $\\mathcal{C} = 0.4$.\n- Case $2$: Schwarzschild slicing at $r = 2.01$, $v_{\\hat{r}} = 0.5$, $\\Delta r = 0.01$, $\\mathcal{C} = 0.4$.\n- Case $3$: Schwarzschild slicing at $r = 10.0$, $v_{\\hat{r}} = 0.5$, $\\Delta r = 0.01$, $\\mathcal{C} = 0.4$.\n- Case $4$: Painlevé–Gullstrand slicing at $r = 2.01$, $v_{\\hat{r}} = 0.5$, $\\Delta r = 0.01$, $\\mathcal{C} = 0.4$.\n- Case $5$: Painlevé–Gullstrand slicing at $r = 5.0$, $v_{\\hat{r}} = 0.0$, $\\Delta r = 0.01$, $\\mathcal{C} = 0.4$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., $[result1,result2,result3]$), where each $result$ is the float ratio $\\Delta t_{\\mathrm{phys}} / \\Delta t_{\\mathrm{coord}}$ for the corresponding test case, in the order given above.", "solution": "The problem requires an analysis of the Courant–Friedrichs–Lewy (CFL) stability condition for the Valencia formulation of General Relativistic Hydrodynamics (GRHD) in strong gravitational fields, particularly near a black hole horizon. The core task is to contrast a naive CFL condition based on coordinate-dependent transport speeds with a more robust condition based on an effective physical speed, and to quantify their difference.\n\nAs a preliminary step, we must validate the problem statement. The problem is grounded in the standard $3+1$ decomposition of spacetime and the Valencia formulation, correctly identifying the lapse $\\alpha$, shift $\\beta^i$, and spatial metric $\\gamma_{ij}$. The definitions of the transport velocity $\\tilde{v}^i = \\alpha v^i - \\beta^i$ and the orthonormal velocity components $v_{\\hat{i}} = \\sqrt{\\gamma_{ii}} v^i$ are standard. The provided metric components for Schwarzschild and Painlevé–Gullstrand coordinates are correct. The central issue—the collapse of the lapse function $\\alpha$ in Schwarzschild coordinates near the horizon and its detrimental effect on a naive CFL condition—is a well-known challenge in numerical relativity. The problem makes a significant simplification by not explicitly including the sound speed $c_s$ in the characteristic speed calculation, focusing solely on the advective transport of the fluid. This isolates the geometric effects of the coordinate system on the time step, which is the main conceptual point being tested. Given this focus, the problem is well-posed, self-contained, and scientifically sound within its specified scope.\n\nWe now proceed with the solution, following the steps outlined in the problem. For all calculations, we use geometric units where $G=c=M=1$.\n\n**1. Derivation of the Coordinate Transport Speed**\n\nThe Valencia formulation evolves conserved quantities whose fluxes are functions of the transport velocity $\\tilde{v}^i$. The characteristic speeds of the hyperbolic system are related to $\\tilde{v}^i$. For this problem, we consider the advective part of the characteristic spectrum, which is given by the transport velocity itself. This is the \"coordinate transport speed\" which we denote as $\\lambda_{\\text{coord}}$. The problem defines the transport velocity along a spatial direction $i$ as:\n$$ \\tilde{v}^i = \\alpha v^i - \\beta^i $$\nHere, $v^i$ is the Eulerian three-velocity. The problem also defines the physical (orthonormal) component of the velocity, $v_{\\hat{i}}$, for a diagonal spatial metric via the relation:\n$$ v_{\\hat{i}} = \\sqrt{\\gamma_{ii}} \\, v^i \\quad (\\text{no summation on } i) $$\nWe can express the coordinate velocity component $v^i$ in terms of the physical velocity component $v_{\\hat{i}}$:\n$$ v^i = \\frac{v_{\\hat{i}}}{\\sqrt{\\gamma_{ii}}} $$\nSubstituting this into the definition of the transport velocity, we obtain the coordinate transport speed for the Valencia fluxes in terms of $\\alpha$, $\\beta^i$, $\\gamma_{ii}$, and $v_{\\hat{i}}$:\n$$ \\lambda_{\\text{coord}}^{(i)} = \\alpha \\frac{v_{\\hat{i}}}{\\sqrt{\\gamma_{ii}}} - \\beta^i $$\nFor the remainder of this analysis, we specialize to purely radial flow, so we are interested in the component $i=r$.\n$$ \\lambda_{\\text{coord}} \\equiv \\lambda_{\\text{coord}}^{(r)} = \\alpha \\frac{v_{\\hat{r}}}{\\sqrt{\\gamma_{rr}}} - \\beta^r $$\n\n**2. Derivation of an Effective Physical Transport Speed and Rescaling**\n\nThe CFL condition limits the timestep $\\Delta t$ based on the grid spacing $\\Delta r$ and the maximum coordinate speed $|\\lambda|$:\n$$ \\Delta t_{\\mathrm{coord}} \\le \\mathcal{C} \\frac{\\Delta r}{\\max|\\lambda_{\\text{coord}}|} $$\nwhere $\\mathcal{C}$ is the Courant factor. Let us analyze the behavior of $\\lambda_{\\text{coord}}$ in the specified coordinate systems.\n\nIn Schwarzschild coordinates, we have $\\beta^r = 0$, $\\alpha = \\sqrt{1 - 2M/r}$, and $\\gamma_{rr} = 1/(1 - 2M/r)$. With $M=1$, these are:\n$$ \\alpha = \\sqrt{1 - 2/r}, \\quad \\beta^r = 0, \\quad \\gamma_{rr} = \\frac{1}{1 - 2/r} = \\frac{1}{\\alpha^2} $$\nThe coordinate transport speed is:\n$$ \\lambda_{\\text{coord, Schw}} = \\alpha \\frac{v_{\\hat{r}}}{\\sqrt{1/\\alpha^2}} - 0 = \\alpha^2 v_{\\hat{r}} = \\left(1 - \\frac{2}{r}\\right) v_{\\hat{r}} $$\nAs the radial coordinate $r$ approaches the event horizon at $r=2M=2$, the lapse $\\alpha \\to 0$ and $\\lambda_{\\text{coord, Schw}} \\to 0$. This implies that $\\Delta t_{\\mathrm{coord}}$ would become arbitrarily large, which is numerically unstable and physically incorrect, as the fluid can be moving at a significant physical speed $v_{\\hat{r}}$.\n\nTo remedy this, we need an \"effective physical transport speed,\" $\\lambda_{\\text{phys-eff}}$, that remains well-behaved. The problem suggests we can find it by considering a horizon-penetrating coordinate system, such as Painlevé–Gullstrand (PG) coordinates. In PG coordinates (with $M=1$):\n$$ \\alpha = 1, \\quad \\beta^r = \\sqrt{2/r}, \\quad \\gamma_{rr} = 1 $$\nThe coordinate transport speed in PG is:\n$$ \\lambda_{\\text{coord, PG}} = (1) \\frac{v_{\\hat{r}}}{\\sqrt{1}} - \\sqrt{2/r} = v_{\\hat{r}} - \\beta^r $$\nThis expression is well-behaved at the horizon. For example, at $r=2$, $\\lambda_{\\text{coord, PG}} = v_{\\hat{r}} - 1$. Since the physical speed $|v_{\\hat{r}}|$ must be less than $1$ for massive particles, this denominator never vanishes.\n\nThe fact that $\\lambda_{\\text{coord, PG}}$ is well-behaved motivates defining the effective physical transport speed, $\\lambda_{\\text{phys-eff}}$, to be this quantity, but expressed in a general form that applies to any slicing. We propose the following definition for the effective physical speed:\n$$ \\lambda_{\\text{phys-eff}} = v_{\\hat{r}} - \\beta^r $$\nThis choice is justified because in the \"good\" PG coordinates, it is identical to the coordinate transport speed, $\\lambda_{\\text{coord, PG}}$. The \"rescaling\" is thus to replace the problematic factor $\\alpha/\\sqrt{\\gamma_{rr}}$ in the general expression for $\\lambda_{\\text{coord}}$ with $1$. This effectively removes the coordinate-singularity-induced pathology from the CFL calculation.\n\n**3. Timestep Definitions and Final Ratio**\n\nWe now have two distinct definitions for the transport speed to be used in the CFL condition.\n\nThe naive coordinate timestep, $\\Delta t_{\\mathrm{coord}}$, is based on $\\lambda_{\\text{coord}}$:\n$$ \\Delta t_{\\mathrm{coord}} = \\mathcal{C} \\frac{\\Delta r}{|\\lambda_{\\text{coord}}|} = \\mathcal{C} \\frac{\\Delta r}{\\left|\\alpha \\frac{v_{\\hat{r}}}{\\sqrt{\\gamma_{rr}}} - \\beta^r\\right|} $$\n\nThe effective physical timestep, $\\Delta t_{\\mathrm{phys}}$, is based on our derived $\\lambda_{\\text{phys-eff}}$:\n$$ \\Delta t_{\\mathrm{phys}} = \\mathcal{C} \\frac{\\Delta r}{|\\lambda_{\\text{phys-eff}}|} = \\mathcal{C} \\frac{\\Delta r}{|v_{\\hat{r}} - \\beta^r|} $$\n\nThe problem asks for the ratio $\\Delta t_{\\mathrm{phys}} / \\Delta t_{\\mathrm{coord}}$. This is given by:\n$$ \\frac{\\Delta t_{\\mathrm{phys}}}{\\Delta t_{\\mathrm{coord}}} = \\frac{\\mathcal{C} \\frac{\\Delta r}{|v_{\\hat{r}} - \\beta^r|}}{\\mathcal{C} \\frac{\\Delta r}{\\left|\\alpha \\frac{v_{\\hat{r}}}{\\sqrt{\\gamma_{rr}}} - \\beta^r\\right|}} = \\frac{\\left|\\alpha \\frac{v_{\\hat{r}}}{\\sqrt{\\gamma_{rr}}} - \\beta^r\\right|}{|v_{\\hat{r}} - \\beta^r|} $$\n\n**4. Calculation for Test Cases**\n\nWe now apply this formula to the provided test cases, with $M=1$.\n\n*   **For Schwarzschild Slicing**: $\\beta^r = 0$, $\\alpha = \\sqrt{1-2/r}$, $\\sqrt{\\gamma_{rr}} = 1/\\alpha$. The term $\\alpha/\\sqrt{\\gamma_{rr}} = \\alpha^2 = 1-2/r$.\n    The ratio simplifies to:\n    $$ \\frac{|(1-2/r)v_{\\hat{r}} - 0|}{|v_{\\hat{r}} - 0|} = \\frac{|(1-2/r)v_{\\hat{r}}|}{|v_{\\hat{r}}|} = 1 - \\frac{2}{r} $$\n    (Assuming $r>2$ and $v_{\\hat{r}} \\ne 0$).\n\n    *   **Case 1**: $r=2.1$. Ratio = $1 - 2/2.1 = 1/2.1 \\approx 0.047619$.\n    *   **Case 2**: $r=2.01$. Ratio = $1 - 2/2.01 = 0.01/2.01 \\approx 0.004975$.\n    *   **Case 3**: $r=10.0$. Ratio = $1 - 2/10.0 = 0.8$.\n\n*   **For Painlevé–Gullstrand Slicing**: $\\alpha=1$, $\\gamma_{rr}=1$.\n    The ratio is:\n    $$ \\frac{\\left|1 \\cdot \\frac{v_{\\hat{r}}}{\\sqrt{1}} - \\beta^r\\right|}{|v_{\\hat{r}} - \\beta^r|} = \\frac{|v_{\\hat{r}} - \\beta^r|}{|v_{\\hat{r}} - \\beta^r|} = 1 $$\n\n    *   **Case 4**: $r=2.01$. Ratio = $1.0$.\n    *   **Case 5**: $r=5.0$. Ratio = $1.0$.\n\nThese calculations confirm that the effective physical timestep corrects the pathology of the coordinate-based timestep in Schwarzschild coordinates, especially near the event horizon, while being equivalent to it in the well-behaved Painlevé–Gullstrand system.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the ratio of the effective physical CFL timestep to the naive coordinate\n    CFL timestep for several test cases in GRHD.\n    \"\"\"\n\n    # Test suite format: (slicing_type, r, v_hat_r, delta_r, C)\n    # The parameters delta_r and C are not needed for the ratio calculation\n    # but are included for completeness based on the problem description.\n    test_cases = [\n        (\"schwarzschild\", 2.1, 0.5, 0.01, 0.4),\n        (\"schwarzschild\", 2.01, 0.5, 0.01, 0.4),\n        (\"schwarzschild\", 10.0, 0.5, 0.01, 0.4),\n        (\"painleve-gullstrand\", 2.01, 0.5, 0.01, 0.4),\n        (\"painleve-gullstrand\", 5.0, 0.0, 0.01, 0.4),\n    ]\n\n    results = []\n    \n    # Set geometric units G = c = M = 1\n    M = 1.0\n\n    for case in test_cases:\n        slicing, r, v_hat_r, _, _ = case\n\n        # Initialize metric components\n        alpha, beta_r, gamma_rr = 0.0, 0.0, 0.0\n\n        if slicing == \"schwarzschild\":\n            # Schwarzschild metric components in geometric units (M=1)\n            # Ensure r > 2M to avoid division by zero or sqrt of negative\n            if r <= 2 * M:\n                raise ValueError(\"Radial coordinate r must be outside the event horizon for Schwarzschild.\")\n            \n            alpha = np.sqrt(1 - 2 * M / r)\n            beta_r = 0.0\n            gamma_rr = 1.0 / (1 - 2 * M / r)\n\n        elif slicing == \"painleve-gullstrand\":\n            # Painlevé-Gullstrand metric components in geometric units (M=1)\n            alpha = 1.0\n            beta_r = np.sqrt(2 * M / r)\n            gamma_rr = 1.0\n        \n        else:\n            raise ValueError(f\"Unknown slicing type: {slicing}\")\n            \n        # Denominator of the ratio: |lambda_phys-eff| = |v_hat_r - beta_r|\n        # This is the magnitude of the effective physical transport speed.\n        # Handle the case where v_hat_r = beta_r to avoid division by zero.\n        # In the given test cases, this condition is not met where it matters.\n        # If v_hat_r is 0.0, both numerator and denominator can be zero in Schw.\n        # The limit of the ratio should be taken. For Schw, ratio is independent of v_hat_r.\n        # For PG, if v_hat_r = beta_r, the timestep is infinite for both methods. The ratio is indeterminate (0/0).\n        # We assume for such physical edge cases, the ratio would be defined as 1.\n        \n        denominator_speed = v_hat_r - beta_r\n\n        # Numerator of the ratio: |lambda_coord| = |alpha * v_hat_r / sqrt(gamma_rr) - beta_r|\n        # This is the magnitude of the naive coordinate transport speed.\n        numerator_speed = alpha * v_hat_r / np.sqrt(gamma_rr) - beta_r\n        \n        # Calculate the ratio.\n        # If the effective physical speed is zero, it implies the fluid is stationary\n        # with respect to the \"river of space\", making the coordinate transport speed\n        # also zero. The ratio is ill-defined (0/0), but physically it means both\n        # timesteps are infinite, so their ratio can be taken as 1.\n        if abs(denominator_speed) < 1e-15:\n            # Check if numerator is also zero\n            if abs(numerator_speed) < 1e-15:\n                ratio = 1.0\n            else:\n                # This case (non-zero numerator, zero denominator) shouldn't occur\n                # with the chosen definitions but is handled for robustness.\n                ratio = np.inf\n        else:\n            ratio = abs(numerator_speed / denominator_speed)\n            \n        results.append(ratio)\n\n    # Format the final output as specified\n    print(f\"[{','.join(f'{res:.12f}'.rstrip('0').rstrip('.') for res in results)}]\")\n\nsolve()\n```", "id": "3496811"}]}