{"hands_on_practices": [{"introduction": "The stability of any numerical simulation in general relativity is fundamentally constrained by the local geometry of spacetime. This exercise provides a direct, hands-on calculation connecting the lapse function $\\alpha$ and shift vector $\\beta^x$, which define the coordinate system's relation to the physical causal structure, to the maximum stable time step $\\Delta t$ allowed by the Courant–Friedrichs–Lewy (CFL) condition. By computing the coordinate characteristic speeds for a simplified BSSN system, you will gain a concrete understanding of how spacetime dynamics directly dictate the practical limits of a numerical evolution [@problem_id:3464355].", "problem": "In a one-dimensional finite-volume method-of-lines discretization of the tensor (radiative) sector of the Baumgarte–Shapiro–Shibata–Nakamura (BSSN) formulation of general relativity in the wave zone, use a Harten–Lax–van Leer (HLL) approximate Riemann solver for the intercell numerical fluxes. Assume the following modeling assumptions hold at a fixed time slice:\n\n- Gravitational radiation propagates at the physical speed of light relative to Eulerian observers.\n- The spatial metric along the propagation direction is approximately flat so that geometric factors other than the lapse and shift can be neglected in the principal part, consistent with an asymptotically flat wave zone.\n- The coordinate characteristic cone along the $x$-direction is determined solely by the lapse $\\alpha$ and the shift component $\\beta^{x}$.\n- Interface values of $\\alpha$ and $\\beta^{x}$ are approximated by arithmetic averages of their neighboring cell-centered values.\n\nYou are given a uniform grid with spacing $\\Delta x = 0.5\\,M$ (express all times in units of $M$). The Courant–Friedrichs–Lewy (CFL) coefficient for the explicit Strong–Stability–Preserving Runge–Kutta (SSP–RK) time integrator is $C_{\\mathrm{CFL}} = 0.45$. The cell-centered gauge fields in four consecutive cells are:\n- Cell $i=1$: $\\alpha_{1} = 0.908295106$, $\\beta^{x}_{1} = 0.1739130435$.\n- Cell $i=2$: $\\alpha_{2} = 0.9128709292$, $\\beta^{x}_{2} = 0.1666666667$.\n- Cell $i=3$: $\\alpha_{3} = 0.9165151390$, $\\beta^{x}_{3} = 0.1600000000$.\n- Cell $i=4$: $\\alpha_{4} = 0.919145031$, $\\beta^{x}_{4} = 0.1538461538$.\n\nTreat the three interfaces $x_{3/2}$, $x_{5/2}$, and $x_{7/2}$ between these cells with HLL, using the extremal coordinate characteristic speeds computed from the local lapse and shift as the left and right signal speeds. Determine the largest stable global time step $\\Delta t_{\\max}$ permitted by the CFL condition across these three interfaces. Round your answer to four significant figures and express it in units of $M$.", "solution": "The user-provided problem is assessed to be valid. It is scientifically grounded in the principles of numerical relativity, specifically the BSSN formulation and its numerical solution using finite-volume methods. The problem is well-posed, with all necessary data and relationships provided for a unique solution. The language is objective and the setup is consistent. We may therefore proceed with the solution.\n\nThe problem asks for the largest stable global time step, $\\Delta t_{\\max}$, for a one-dimensional system governed by the Courant–Friedrichs–Lewy (CFL) condition. For an explicit time-integration scheme, the CFL condition is given by:\n$$\n\\Delta t \\le C_{\\mathrm{CFL}} \\frac{\\Delta x}{\\lambda_{\\max}^{\\mathrm{global}}}\n$$\nwhere $C_{\\mathrm{CFL}}$ is the CFL coefficient, $\\Delta x$ is the grid spacing, and $\\lambda_{\\max}^{\\mathrm{global}}$ is the maximum absolute characteristic speed over the entire computational domain. The largest stable time step, $\\Delta t_{\\max}$, is obtained when this inequality is an equality.\n\nThe problem states that gravitational radiation propagates at the physical speed of light, $c=1$ in geometrized units, relative to Eulerian observers. The coordinate propagation speeds, which are the characteristic speeds (eigenvalues) of the hyperbolic system, are determined by the spacetime geometry, specifically the lapse function $\\alpha$ and the shift vector component $\\beta^{x}$. For propagation along the $x$-direction, the left- and right-going characteristic speeds are given by:\n$$\n\\lambda_{\\pm} = \\beta^{x} \\pm \\alpha c = \\beta^{x} \\pm \\alpha\n$$\nThe HLL approximate Riemann solver requires estimates for the signal speeds, which are taken here as these extremal characteristic speeds. The CFL condition depends on the magnitude of the fastest characteristic speed at any given point. This is calculated as:\n$$\n\\lambda_{\\max}^{\\mathrm{local}} = \\max(|\\lambda_{+}|, |\\lambda_{-}|) = \\max(|\\beta^{x} + \\alpha|, |\\beta^{x} - \\alpha|)\n$$\nSince the lapse $\\alpha$ is strictly positive and physical solutions require the causal condition $|\\beta^{x}| < \\alpha$, this expression simplifies to:\n$$\n\\lambda_{\\max}^{\\mathrm{local}} = \\alpha + |\\beta^{x}|\n$$\nAll provided values for $\\beta^{x}$ are positive, so $|\\beta^{x}| = \\beta^{x}$.\n\nThe problem instructs us to evaluate these speeds at the interfaces between computational cells. The values of $\\alpha$ and $\\beta^{x}$ at an interface $x_{i+1/2}$ between cells $i$ and $i+1$ are approximated by the arithmetic average of the cell-centered values:\n$$\n\\alpha_{i+1/2} = \\frac{\\alpha_{i} + \\alpha_{i+1}}{2}\n$$\n$$\n\\beta^{x}_{i+1/2} = \\frac{\\beta^{x}_{i} + \\beta^{x}_{i+1}}{2}\n$$\nThe maximum local speed at the interface is then $\\lambda_{\\max, i+1/2} = \\alpha_{i+1/2} + \\beta^{x}_{i+1/2}$. The global maximum speed is the maximum of these values across all relevant interfaces.\n\nThe given data are:\n- Grid spacing: $\\Delta x = 0.5\\,M$\n- CFL coefficient: $C_{\\mathrm{CFL}} = 0.45$\n- Cell $i=1$: $\\alpha_{1} = 0.908295106$, $\\beta^{x}_{1} = 0.1739130435$\n- Cell $i=2$: $\\alpha_{2} = 0.9128709292$, $\\beta^{x}_{2} = 0.1666666667$\n- Cell $i=3$: $\\alpha_{3} = 0.9165151390$, $\\beta^{x}_{3} = 0.1600000000$\n- Cell $i=4$: $\\alpha_{4} = 0.919145031$, $\\beta^{x}_{4} = 0.1538461538$\n\nWe calculate the interface values and maximum characteristic speeds for the three interfaces $x_{3/2}$, $x_{5/2}$, and $x_{7/2}$.\n\n**Interface $x_{3/2}$ (between cells $1$ and $2$):**\n$$\n\\alpha_{3/2} = \\frac{0.908295106 + 0.9128709292}{2} = 0.9105830176\n$$\n$$\n\\beta^{x}_{3/2} = \\frac{0.1739130435 + 0.1666666667}{2} = 0.1702898551\n$$\n$$\n\\lambda_{\\max, 3/2} = \\alpha_{3/2} + \\beta^{x}_{3/2} = 0.9105830176 + 0.1702898551 = 1.0808728727\n$$\n\n**Interface $x_{5/2}$ (between cells $2$ and $3$):**\n$$\n\\alpha_{5/2} = \\frac{0.9128709292 + 0.9165151390}{2} = 0.9146930341\n$$\n$$\n\\beta^{x}_{5/2} = \\frac{0.1666666667 + 0.1600000000}{2} = 0.16333333335\n$$\n$$\n\\lambda_{\\max, 5/2} = \\alpha_{5/2} + \\beta^{x}_{5/2} = 0.9146930341 + 0.16333333335 = 1.07802636745\n$$\n\n**Interface $x_{7/2}$ (between cells $3$ and $4$):**\n$$\n\\alpha_{7/2} = \\frac{0.9165151390 + 0.919145031}{2} = 0.917830085\n$$\n$$\n\\beta^{x}_{7/2} = \\frac{0.1600000000 + 0.1538461538}{2} = 0.1569230769\n$$\n$$\n\\lambda_{\\max, 7/2} = \\alpha_{7/2} + \\beta^{x}_{7/2} = 0.917830085 + 0.1569230769 = 1.0747531619\n$$\n\nThe global maximum characteristic speed is the maximum of these three values:\n$$\n\\lambda_{\\max}^{\\mathrm{global}} = \\max(1.0808728727, 1.07802636745, 1.0747531619) = 1.0808728727\n$$\n\nNow we can compute the maximum stable time step $\\Delta t_{\\max}$:\n$$\n\\Delta t_{\\max} = C_{\\mathrm{CFL}} \\frac{\\Delta x}{\\lambda_{\\max}^{\\mathrm{global}}} = 0.45 \\times \\frac{0.5}{1.0808728727}\n$$\n$$\n\\Delta t_{\\max} = \\frac{0.225}{1.0808728727} \\approx 0.20816406\\,M\n$$\nRounding this result to four significant figures as requested, we obtain:\n$$\n\\Delta t_{\\max} \\approx 0.2082\\,M\n$$", "answer": "$$\n\\boxed{0.2082}\n$$", "id": "3464355"}, {"introduction": "Moving from theory to practice, this exercise challenges you to implement a robust Harten-Lax-van Leer (HLL) approximate Riemann solver for the equations of special relativistic hydrodynamics (SRHD). Real-world astrophysical simulations, such as those of binary neutron star mergers, frequently encounter extreme conditions like near-vacuum densities and ultra-relativistic flows. This problem focuses on implementing essential techniques, such as atmosphere floors and velocity capping, which are critical for ensuring that a numerical code remains stable and physically meaningful in these challenging regimes [@problem_id:3464284].", "problem": "You are asked to derive and implement a robust approximate Riemann solver of Harten–Lax–van Leer (HLL) type for one-dimensional Special Relativistic Hydrodynamics (SRHD) suitable for use in numerical relativity codes that model matter in regions relevant to gravitational-wave simulations. The model assumes flat spacetime and code units with speed of light equal to unity, i.e., $c = 1$. The governing system is the conservation law\n$$\n\\partial_t \\mathbf{U} + \\partial_x \\mathbf{F}(\\mathbf{U}) = 0,\n$$\nwhere the conserved variables $\\mathbf{U}$ and fluxes $\\mathbf{F}$ are defined in terms of primitive variables $\\rho$ (rest-mass density), $v$ (fluid $x$-velocity), and $p$ (pressure), along with adiabatic index $\\gamma$, as follows. Define the Lorentz factor $\\Gamma = 1/\\sqrt{1-v^2}$, the specific enthalpy $h = 1 + \\epsilon + p/\\rho$ with $\\epsilon = p/\\left((\\gamma-1)\\rho\\right)$, and the enthalpy density $w = \\rho h = \\rho + \\frac{\\gamma}{\\gamma - 1} p$. Then set\n$$\n\\mathbf{U} = \\begin{bmatrix} D \\\\ S \\\\ \\tau \\end{bmatrix} = \\begin{bmatrix} \\Gamma \\rho \\\\ w \\Gamma^2 v \\\\ w \\Gamma^2 - p - \\Gamma \\rho \\end{bmatrix}, \\quad\n\\mathbf{F}(\\mathbf{U}) = \\begin{bmatrix} D v \\\\ S v + p \\\\ S - D v \\end{bmatrix}.\n$$\nAssume an ideal-gas equation of state and a relativistic sound speed defined by\n$$\nc_s^2 = \\frac{\\gamma p}{w},\n$$\nwith characteristic speeds in the $x$-direction given by the relativistic addition formula\n$$\n\\lambda_\\pm = \\frac{v \\pm c_s}{1 \\pm v\\,c_s}.\n$$\nThe Harten–Lax–van Leer (HLL) solver approximates the Riemann fan by two waves of speeds $S_L$ and $S_R$ that bound all characteristic fields. For robustness in the presence of vacuum and near-vacuum states, you must implement an atmosphere treatment by enforcing floors on the primitive variables and capping the velocity as follows, applied independently to left and right states before any other computation:\n- $\\rho \\leftarrow \\max(\\rho, \\rho_{\\text{floor}})$,\n- $p \\leftarrow \\max(p, p_{\\text{floor}})$,\n- $v \\leftarrow \\min\\left(\\max\\left(v, -v_{\\max}\\right), v_{\\max}\\right)$ with $v_{\\max} = 1 - \\epsilon$ and a fixed $\\epsilon = 10^{-12}$.\n\nYour tasks are:\n- Starting from the integral (weak) form of the conservation law and the assumption that the Riemann solution is approximated by a single constant state between two waves of speeds $S_L$ and $S_R$, derive the HLL numerical flux at the interface. Express your final HLL flux formula in terms of $\\mathbf{U}_L$, $\\mathbf{U}_R$, $\\mathbf{F}_L$, $\\mathbf{F}_R$, $S_L$, and $S_R$, and include the proper upwind limiting cases when the interface signal speeds have the same sign.\n- Justify the choice $S_L = \\min\\{\\lambda_-(\\text{left}), \\lambda_-(\\text{right})\\}$ and $S_R = \\max\\{\\lambda_+(\\text{left}), \\lambda_+(\\text{right})\\}$, and explain how the atmosphere floors ensure that $c_s^2 \\in [0, 1)$ is well-defined and numerically stable under vacuum-like inputs.\n- Provide a numerically safe fallback for the degenerate case $S_R - S_L \\to 0$ to avoid division by zero.\n\nImplement a program that:\n- For each test case, applies the atmosphere treatment, converts primitives to conserved variables, computes the relativistic sound speed and bounding wave speeds $S_L$ and $S_R$, constructs the HLL flux for the interface, and returns the flux vector components as floats rounded to $8$ decimal places.\n- Uses code units where $c=1$ such that all returned flux components are dimensionless.\n- Produces a single line of output containing the results as a comma-separated list of lists, each inner list being the three flux components $[F_D, F_S, F_\\tau]$ for the corresponding test case.\n\nTest suite:\n- Case $1$ (counter-streaming, symmetric thermodynamics): left $(\\rho_L, v_L, p_L) = (1.0, 0.5, 1.0)$, right $(\\rho_R, v_R, p_R) = (1.0, -0.5, 1.0)$, $\\gamma = 5/3$, $\\rho_{\\text{floor}} = 10^{-12}$, $p_{\\text{floor}} = 10^{-12}$.\n- Case $2$ (rarefaction into vacuum with relativistic gas): left $(1.0, 0.9, 1.0)$, right $(0.0, 0.0, 0.0)$, $\\gamma = 4/3$, $\\rho_{\\text{floor}} = 10^{-12}$, $p_{\\text{floor}} = 10^{-12}$.\n- Case $3$ (contact-like discontinuity at rest): left $(1.0, 0.0, 1.0)$, right $(0.125, 0.0, 1.0)$, $\\gamma = 5/3$, $\\rho_{\\text{floor}} = 10^{-12}$, $p_{\\text{floor}} = 10^{-12}$.\n- Case $4$ (near-atmosphere state into vacuum): left $(10^{-9}, 0.0, 10^{-10})$, right $(0.0, 0.0, 0.0)$, $\\gamma = 5/3$, $\\rho_{\\text{floor}} = 10^{-12}$, $p_{\\text{floor}} = 10^{-12}$.\n- Case $5$ (uniform supersonic advection to the left): left $(1.0, -0.8, 0.1)$, right $(1.0, -0.8, 0.1)$, $\\gamma = 5/3$, $\\rho_{\\text{floor}} = 10^{-12}$, $p_{\\text{floor}} = 10^{-12}$.\n\nNumerical details:\n- Use $\\epsilon = 10^{-12}$ for the velocity cap.\n- In computing $c_s^2$, clip the result to the interval $[0, 1 - 10^{-12}]$ to avoid superluminal numerical artifacts.\n- If $S_R \\le 0$, use the right flux; if $S_L \\ge 0$, use the left flux; otherwise use the derived HLL flux. If $S_R - S_L$ is smaller than $10^{-14}$ in absolute value, use a continuous fallback equal to the arithmetic average $\\left(\\mathbf{F}_L + \\mathbf{F}_R\\right)/2$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets and grouped by test case, for example, $[[F_{D,1},F_{S,1},F_{\\tau,1}],[F_{D,2},F_{S,2},F_{\\tau,2}],\\dots]$, where each $F$ is rounded to $8$ decimal places.", "solution": "The user has requested the derivation and implementation of the Harten–Lax–van Leer (HLL) approximate Riemann solver for the one-dimensional Special Relativistic Hydrodynamics (SRHD) equations. The problem is well-posed, scientifically sound, and provides all necessary information for a complete solution.\n\n### 1. Derivation of the HLL Numerical Flux\n\nThe SRHD equations are a system of conservation laws of the form:\n$$\n\\partial_t \\mathbf{U} + \\partial_x \\mathbf{F}(\\mathbf{U}) = 0\n$$\nwhere $\\mathbf{U}$ is the vector of conserved variables and $\\mathbf{F}(\\mathbf{U})$ is the vector of corresponding fluxes. For a finite volume numerical scheme, we need to compute the numerical flux $\\mathbf{F}_{i+1/2}$ at the interface between two computational cells, $i$ and $i+1$, with states $\\mathbf{U}_L = \\mathbf{U}_i$ and $\\mathbf{U}_R = \\mathbf{U}_{i+1}$, respectively.\n\nThe HLL solver approximates the solution to the Riemann problem at the interface. It assumes that the complex wave structure of the exact solution (which, for SRHD, consists of two nonlinear waves and a contact discontinuity) can be simplified to a single constant state, $\\mathbf{U}_{\\text{HLL}}$, separated from the initial left and right states by two waves traveling at speeds $S_L$ and $S_R$. These speeds are chosen to be the minimum and maximum signal velocities in the system, ensuring that $S_L \\le 0 \\le S_R$ for an interface at $x=0$ that is crossed by the wave fan.\n\nWe derive the HLL flux by applying the integral form of the conservation law. Integrating the system over the region $[x_1, x_2] \\times [t, t+\\Delta t]$ and applying the divergence theorem gives the Rankine-Hugoniot jump condition across a discontinuity moving with speed $s$:\n$$\ns(\\mathbf{U}_{\\text{right}} - \\mathbf{U}_{\\text{left}}) = \\mathbf{F}_{\\text{right}} - \\mathbf{F}_{\\text{left}}\n$$\nIn the HLL model, we have two such discontinuities. Applying the jump condition across the left wave (speed $S_L$) and the right wave (speed $S_R$), which bound the intermediate state $\\mathbf{U}_{\\text{HLL}}$, we get:\n$$\nS_L(\\mathbf{U}_{\\text{HLL}} - \\mathbf{U}_L) = \\mathbf{F}(\\mathbf{U}_{\\text{HLL}}) - \\mathbf{F}_L\n$$\n$$\nS_R(\\mathbf{U}_{\\text{HLL}} - \\mathbf{U}_R) = \\mathbf{F}(\\mathbf{U}_{\\text{HLL}}) - \\mathbf{F}_R\n$$\nHere, $\\mathbf{F}_L = \\mathbf{F}(\\mathbf{U}_L)$, $\\mathbf{F}_R = \\mathbf{F}(\\mathbf{U}_R)$, and $\\mathbf{F}(\\mathbf{U}_{\\text{HLL}})$ is the flux corresponding to the unknown state $\\mathbf{U}_{\\text{HLL}}$. The HLL method avoids explicitly calculating $\\mathbf{U}_{\\text{HLL}}$ by introducing a single numerical flux $\\mathbf{F}_{\\text{HLL}}$ that is consistent with these jump conditions.\n\nAn alternative path to the flux formula is to consider the state $\\mathbf{U}_{\\text{HLL}}$ itself. Eliminating $\\mathbf{F}(\\mathbf{U}_{\\text{HLL}})$ from the two jump conditions is not straightforward as $\\mathbf{F}$ is a nonlinear function of $\\mathbf{U}$. Instead, we integrate the conservation law over the region between the two waves, $[S_L t, S_R t]$. This yields:\n$$\n\\frac{d}{dt} \\int_{S_L t}^{S_R t} \\mathbf{U}(x, t) dx = \\mathbf{F}_L - \\mathbf{F}_R + S_L \\mathbf{U}_L - S_R \\mathbf{U}_R\n$$\nAssuming $\\mathbf{U}(x,t) = \\mathbf{U}_{\\text{HLL}}$ for $x \\in [S_L t, S_R t]$, the integral becomes $\\mathbf{U}_{\\text{HLL}}(S_R - S_L)t$. Differentiating with respect to $t$ gives $\\mathbf{U}_{\\text{HLL}}(S_R-S_L)$. Equating this with the right-hand side, we can solve for the constant intermediate state:\n$$\n\\mathbf{U}_{\\text{HLL}} = \\frac{S_R \\mathbf{U}_R - S_L \\mathbf{U}_L - (\\mathbf{F}_R - \\mathbf{F}_L)}{S_R - S_L}\n$$\nThe numerical flux at the interface ($x=0$) is the flux passing through this surface. In the HLL approximation, this flux is consistent with the jump across the wave that has crossed the interface. For $S_L < 0 < S_R$, the left wave has moved left and the right wave has moved right. The state at $x=0$ is $\\mathbf{U}_{\\text{HLL}}$. The flux at the interface, $\\mathbf{F}_{\\text{HLL}}$, can be found by using the Rankine-Hugoniot condition across either shock. Using the left shock:\n$$\n\\mathbf{F}_{\\text{HLL}} = \\mathbf{F}_L + S_L (\\mathbf{U}_{\\text{HLL}} - \\mathbf{U}_L)\n$$\nSubstituting the expression for $\\mathbf{U}_{\\text{HLL}}$:\n$$\n\\mathbf{F}_{\\text{HLL}} = \\mathbf{F}_L + S_L \\left( \\frac{S_R \\mathbf{U}_R - S_L \\mathbf{U}_L - \\mathbf{F}_R + \\mathbf{F}_L}{S_R - S_L} - \\mathbf{U}_L \\right)\n$$\n$$\n\\mathbf{F}_{\\text{HLL}} = \\mathbf{F}_L + \\frac{S_L}{S_R - S_L} \\left( S_R \\mathbf{U}_R - S_L \\mathbf{U}_L - \\mathbf{F}_R + \\mathbf{F}_L - (S_R-S_L)\\mathbf{U}_L \\right)\n$$\n$$\n\\mathbf{F}_{\\text{HLL}} = \\mathbf{F}_L + \\frac{S_L}{S_R - S_L} \\left( S_R (\\mathbf{U}_R - \\mathbf{U}_L) - (\\mathbf{F}_R - \\mathbf{F}_L) \\right)\n$$\n$$\n(S_R - S_L)\\mathbf{F}_{\\text{HLL}} = (S_R - S_L)\\mathbf{F}_L + S_L S_R(\\mathbf{U}_R - \\mathbf{U}_L) - S_L(\\mathbf{F}_R - \\mathbf{F}_L)\n$$\n$$\n(S_R - S_L)\\mathbf{F}_{\\text{HLL}} = S_R \\mathbf{F}_L - S_L \\mathbf{F}_L + S_L S_R(\\mathbf{U}_R - \\mathbf{U}_L) - S_L \\mathbf{F}_R + S_L \\mathbf{F}_L\n$$\nThis simplifies to the canonical HLL flux formula:\n$$\n\\mathbf{F}_{\\text{HLL}} = \\frac{S_R \\mathbf{F}_L - S_L \\mathbf{F}_R + S_L S_R (\\mathbf{U}_R - \\mathbf{U}_L)}{S_R - S_L}\n$$\nThis formula is applicable for the case $S_L < 0 < S_R$. The logic must be completed with the upwind cases:\n- If $S_L \\ge 0$, the entire structure of the Riemann fan moves to the right of the interface. The state at the interface is therefore the original left state, $\\mathbf{U}_L$. The flux is $\\mathbf{F}_{\\text{HLL}} = \\mathbf{F}_L$.\n- If $S_R \\le 0$, the entire structure moves to the left of the interface. The state at the interface is the original right state, $\\mathbf{U}_R$. The flux is $\\mathbf{F}_{\\text{HLL}} = \\mathbf{F}_R$.\n\n### 2. Justification of Wave Speed Choice and Atmosphere Treatment\n\n**Wave Speed Choice:** The characteristic speeds of the SRHD system are the eigenvalues of the Jacobian matrix $\\partial \\mathbf{F} / \\partial \\mathbf{U}$. These are the speeds at which information propagates. For the given 1D system, they are the fluid velocity $v$ (for the contact discontinuity) and the relativistic combination of fluid velocity and sound speed, $\\lambda_\\pm = \\frac{v \\pm c_s}{1 \\pm v c_s}$, for the sound waves. For a numerical scheme to be stable (e.g., to satisfy a discrete entropy condition), the numerical domain of dependence must contain the true physical domain of dependence. In the context of an HLL solver, this means the estimated signal speeds $S_L$ and $S_R$ must bound all physical characteristic speeds emanating from the interface. A widely adopted, robust choice that guarantees this is:\n$$\nS_L = \\min\\{\\lambda_-(\\text{left}), \\lambda_-(\\text{right})\\}\n$$\n$$\nS_R = \\max\\{\\lambda_+(\\text{left}), \\lambda_+(\\text{right})\\}\n$$\nThis choice ensures $S_L \\le \\lambda_- < v < \\lambda_+ \\le S_R$ for both the left and right states, thus enclosing the entire Riemann fan and yielding a stable, Godunov-type scheme.\n\n**Atmosphere Treatment:** Numerical simulations of astrophysical flows often encounter regions of extremely low density and pressure, approaching a vacuum. These states are numerically challenging.\n1.  **Well-defined Sound Speed:** The sound speed is defined as $c_s^2 = \\gamma p / w$, where $w = \\rho + \\frac{\\gamma}{\\gamma-1} p$. If both $\\rho$ and $p$ are zero, $w$ is zero, and $c_s^2$ becomes an indeterminate form $0/0$. By enforcing minimum floor values, $\\rho \\leftarrow \\max(\\rho, \\rho_{\\text{floor}})$ and $p \\leftarrow \\max(p, p_{\\text{floor}})$ with $\\rho_{\\text{floor}} > 0$ and $p_{\\text{floor}} > 0$, we ensure that the enthalpy density $w$ is strictly positive (since $\\gamma>1$). This guarantees that $c_s^2$ is always well-defined and non-negative.\n2.  **Causality and Stability:** For a physically realistic ideal gas described by the given equation of state, causality requires the sound speed to be less than the speed of light, i.e., $c_s < 1$. This translates to a constraint on the adiabatic index, $\\gamma < 2$. The expression for $c_s^2 = \\frac{\\gamma p}{\\rho + \\frac{\\gamma p}{\\gamma-1}}$ has a maximum value of $\\gamma-1$ in the ultra-relativistic limit ($p/\\rho \\to \\infty$). With $\\gamma=5/3$ or $\\gamma=4/3$, this condition is met. The explicit clipping of $c_s^2$ to $[0, 1 - \\epsilon]$ is an additional safeguard against potential floating-point errors that might numerically violate this physical bound. The velocity cap $|v| \\le v_{\\max} = 1-\\epsilon$ is essential to prevent the Lorentz factor $\\Gamma = (1-v^2)^{-1/2}$ from becoming infinite or undefined, which would lead to catastrophic failure in the computation of the conserved variables.\n\n### 3. Fallback for Degenerate Case\n\nThe derived HLL flux formula has a denominator of $S_R - S_L$. In cases of nearly uniform flow where the left and right states are very similar, $\\mathbf{U}_L \\approx \\mathbf{U}_R$, the signal speeds will also be very close, $S_L \\approx S_R$. This can lead to a division by a very small number, which is numerically unstable and can amplify floating-point inaccuracies in the numerator, producing spurious oscillations or `NaN` values. A robust implementation must handle this degeneracy. A simple and effective fallback is to use the arithmetic mean of the left and right fluxes:\n$$\n\\mathbf{F}_{\\text{HLL}} = \\frac{1}{2}(\\mathbf{F}_L + \\mathbf{F}_R)\n$$\nThis choice is activated when $|S_R - S_L|$ is below a small tolerance (e.g., $10^{-14}$). This flux is more dissipative than the standard HLL flux, but since it is only used when $\\mathbf{F}_L \\approx \\mathbf{F}_R$, the added dissipation is negligible and it provides a smooth, continuous, and robust transition through the degenerate state.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and implements the HLL approximate Riemann solver for 1D Special\n    Relativistic Hydrodynamics (SRHD).\n    \"\"\"\n\n    def prims_to_cons_flux(rho, v, p, gamma, rho_floor, p_floor, v_max_eps):\n        \"\"\"\n        Converts primitive variables to conserved variables and fluxes,\n        applying atmosphere treatment.\n        \"\"\"\n        # Atmosphere treatment: apply floors and velocity cap\n        v_max = 1.0 - v_max_eps\n        rho_f = max(rho, rho_floor)\n        p_f = max(p, p_floor)\n        v_f = min(max(v, -v_max), v_max)\n\n        # Derived quantities\n        Gamma = 1.0 / np.sqrt(1.0 - v_f**2)\n        # Enthalpy density w = rho*h = rho(1 + eps + p/rho)\n        # eps = p / ((gamma-1)*rho)\n        # h = 1 + p/((gamma-1)*rho) + p/rho = 1 + (gamma*p)/((gamma-1)*rho)\n        # w = rho * h = rho + gamma*p/(gamma-1)\n        w = rho_f + (gamma / (gamma - 1.0)) * p_f\n        \n        # Conserved variables U = [D, S, tau]\n        D = Gamma * rho_f\n        S = w * Gamma**2 * v_f\n        tau = w * Gamma**2 - p_f - D\n        U = np.array([D, S, tau])\n        \n        # Fluxes F = [F_D, F_S, F_tau]\n        F_D = D * v_f\n        F_S = S * v_f + p_f\n        F_tau = S - D * v_f\n        F = np.array([F_D, F_S, F_tau])\n        \n        return rho_f, v_f, p_f, w, U, F\n\n    def compute_hll_flux(state_L, state_R, gamma, rho_floor, p_floor):\n        \"\"\"\n        Computes the HLL flux at the interface between two states.\n        \"\"\"\n        v_max_eps = 1e-12\n        cs2_clip_eps = 1e-12\n        degeneracy_tol = 1e-14\n\n        rho_L, v_L, p_L = state_L\n        rho_R, v_R, p_R = state_R\n\n        # 1. Apply atmosphere and convert to conserved/flux for both states\n        rho_L_f, v_L_f, p_L_f, w_L, U_L, F_L = prims_to_cons_flux(\n            rho_L, v_L, p_L, gamma, rho_floor, p_floor, v_max_eps\n        )\n        rho_R_f, v_R_f, p_R_f, w_R, U_R, F_R = prims_to_cons_flux(\n            rho_R, v_R, p_R, gamma, rho_floor, p_floor, v_max_eps\n        )\n\n        # 2. Compute sound speeds and characteristic speeds\n        # Left state\n        cs2_L = (gamma * p_L_f) / w_L\n        cs2_L = min(max(cs2_L, 0.0), 1.0 - cs2_clip_eps)\n        cs_L = np.sqrt(cs2_L)\n        \n        if (1.0 + v_L_f * cs_L) == 0.0 or (1.0 - v_L_f * cs_L) == 0.0:\n            lambda_p_L = v_L_f\n            lambda_m_L = v_L_f\n        else:\n            lambda_p_L = (v_L_f + cs_L) / (1.0 + v_L_f * cs_L)\n            lambda_m_L = (v_L_f - cs_L) / (1.0 - v_L_f * cs_L)\n\n        # Right state\n        cs2_R = (gamma * p_R_f) / w_R\n        cs2_R = min(max(cs2_R, 0.0), 1.0 - cs2_clip_eps)\n        cs_R = np.sqrt(cs2_R)\n        \n        if (1.0 + v_R_f * cs_R) == 0.0 or (1.0 - v_R_f * cs_R) == 0.0:\n            lambda_p_R = v_R_f\n            lambda_m_R = v_R_f\n        else:\n            lambda_p_R = (v_R_f + cs_R) / (1.0 + v_R_f * cs_R)\n            lambda_m_R = (v_R_f - cs_R) / (1.0 - v_R_f * cs_R)\n\n        # 3. Compute HLL wave speeds S_L and S_R\n        S_L = min(lambda_m_L, lambda_m_R)\n        S_R = max(lambda_p_L, lambda_p_R)\n\n        # 4. Compute HLL flux based on S_L and S_R\n        if S_L >= 0.0:\n            F_hll = F_L\n        elif S_R <= 0.0:\n            F_hll = F_R\n        else:\n            # Degeneracy fallback\n            if abs(S_R - S_L) < degeneracy_tol:\n                F_hll = 0.5 * (F_L + F_R)\n            else:\n                F_hll = (S_R * F_L - S_L * F_R + S_L * S_R * (U_R - U_L)) / (S_R - S_L)\n        \n        return F_hll\n\n    test_cases = [\n        # Case 1: counter-streaming, symmetric thermodynamics\n        {'left': (1.0, 0.5, 1.0), 'right': (1.0, -0.5, 1.0), \n         'gamma': 5/3, 'rho_floor': 1e-12, 'p_floor': 1e-12},\n        # Case 2: rarefaction into vacuum with relativistic gas\n        {'left': (1.0, 0.9, 1.0), 'right': (0.0, 0.0, 0.0), \n         'gamma': 4/3, 'rho_floor': 1e-12, 'p_floor': 1e-12},\n        # Case 3: contact-like discontinuity at rest\n        {'left': (1.0, 0.0, 1.0), 'right': (0.125, 0.0, 1.0), \n         'gamma': 5/3, 'rho_floor': 1e-12, 'p_floor': 1e-12},\n        # Case 4: near-atmosphere state into vacuum\n        {'left': (1e-9, 0.0, 1e-10), 'right': (0.0, 0.0, 0.0), \n         'gamma': 5/3, 'rho_floor': 1e-12, 'p_floor': 1e-12},\n        # Case 5: uniform supersonic advection to the left\n        {'left': (1.0, -0.8, 0.1), 'right': (1.0, -0.8, 0.1), \n         'gamma': 5/3, 'rho_floor': 1e-12, 'p_floor': 1e-12},\n    ]\n\n    results = []\n    for case in test_cases:\n        flux = compute_hll_flux(case['left'], case['right'], case['gamma'],\n                                case['rho_floor'], case['p_floor'])\n        rounded_flux = [f\"{f:.8f}\" for f in flux]\n        results.append(f\"[{','.join(rounded_flux)}]\")\n\n    print(f\"[[{','.join(results)}]]\")\n\nsolve()\n```", "id": "3464284"}, {"introduction": "A working solver is not necessarily a correct one; understanding its numerical properties is paramount for generating reliable scientific results. This exercise delves into the crucial role of numerical dissipation by comparing the Harten-Lax-van Leer-Einfeldt (HLLE) solver against a Roe-type solver for a model BSSN system. You will use Fourier analysis to see how an incorrect estimation of the characteristic wave speeds in the HLLE solver can fail to damp high-frequency modes, leading to the very instabilities that robust stability tests in numerical relativity are designed to detect [@problem_id:3464381].", "problem": "Consider the Baumgarte-Shapiro-Shibata-Nakamura (BSSN) formulation of the Einstein equations, linearized about Minkowski spacetime in one spatial dimension with the Bona-Massó family of slicing conditions specialized to the so-called $1+\\log$ slicing and vanishing shift. In the linear regime, treat the subsystem as a constant-coefficient first-order hyperbolic system that decouples into a gauge sector and a constraint sector. Represent the state vector as $U = [c, g]^{\\top}$, where $c$ denotes a representative constraint-violating mode and $g$ denotes a representative gauge mode. For the purposes of this problem, assume the following physically motivated statements:\n\n- The Bona-Massó slicing condition is $\\partial_t \\alpha = - \\alpha^2 f(\\alpha) K$ with $f(\\alpha) = 2/\\alpha$ and background lapse $\\alpha_0 = 1$, where $\\alpha$ is the lapse function and $K$ is the trace of the extrinsic curvature. Linearization about $\\alpha_0 = 1$ implies a gauge characteristic speed $v_g = \\sqrt{f(\\alpha_0)}$.\n- In the linearized, first-order reduction of the BSSN constraint subsystem, the principal part admits propagation of constraint violations at the physical speed $v_c = 1$ (units with the speed of light $c=1$).\n\nHence, the linearized flux Jacobian can be modeled as $A = \\mathrm{diag}(v_c, v_g)$, and the conservation-law form is $\\partial_t U + \\partial_x F(U) = 0$ with $F(U) = A U$. Consider a uniform grid of spacing $\\Delta x$ and a semi-discrete finite-volume discretization using numerical fluxes at cell interfaces $i \\pm \\tfrac{1}{2}$, advanced in time with forward Euler time-stepping of step size $\\Delta t$. Two approximate Riemann solvers are to be compared:\n\n- Harten-Lax-van Leer-Einfeldt (HLLE), which uses global left and right wave-speed bounds $s_L$ and $s_R$ such that all characteristic speeds lie in $[s_L, s_R]$.\n- Roe-type flux, which uses characteristic decomposition based on a Roe linearization and applies dissipation proportional to the absolute characteristic speeds per mode.\n\nFor the decoupled linear model above, you must identify the characteristic speeds $v_c$ and $v_g$ from first principles and use them to construct the semi-discrete Fourier symbol of the resulting method-of-lines operator for each solver. Let $\\theta = k \\Delta x$ denote the nondimensional wavenumber. For each mode and each characteristic speed $v$, the semi-discrete operator acting on a Fourier mode $e^{i k x}$ can be written as $\\lambda(\\theta)$ so that the forward Euler update factor is $G(\\theta) = 1 + \\Delta t \\, \\lambda(\\theta)$. The magnitude $\\lvert G(\\theta) \\rvert$ determines the per-step amplification of that Fourier mode. The robust stability test in numerical relativity targets high-frequency instabilities; therefore, the relevant diagnostic for stability is the maximum amplification over $\\theta \\in [0,\\pi]$ and over the two characteristic sectors.\n\nYou are to compare HLLE against Roe-type flux under correctly estimated and misestimated wave-speed bounds. Assume HLLE uses symmetric bounds $s_L = -\\alpha_{\\mathrm{est}}$ and $s_R = \\alpha_{\\mathrm{est}}$, where $\\alpha_{\\mathrm{est}}$ is an estimate of the largest absolute characteristic speed. For Roe-type flux on this diagonal linear system, dissipation is applied per characteristic with strength equal to the absolute speed for that characteristic.\n\nTasks to complete:\n\n1. Derive the gauge speed $v_g$ implied by $1+\\log$ slicing using the $f(\\alpha)$ given, and set the constraint speed $v_c$ as above. Express all speeds in dimensionless units with $c=1$.\n2. For the semi-discrete finite-volume method on a uniform grid, construct the Fourier symbol $\\lambda(\\theta)$ for each characteristic sector for both HLLE and Roe-type fluxes, based solely on the decoupled linear model and the choice of numerical flux. Argue how the HLLE dissipation depends on $\\alpha_{\\mathrm{est}}$ (global bound), whereas Roe-type dissipation depends on the characteristic speed $v$ of the sector itself.\n3. Using forward Euler time-stepping, compute the per-step amplification factor magnitude $\\lvert G(\\theta) \\rvert$ for each solver and take the maximum over $\\theta \\in [0,\\pi]$ and over both sectors. This maximum is the diagnostic to report for each test.\n4. Craft a scenario where mis-estimation of the HLLE bounds $\\alpha_{\\mathrm{est}}$ amplifies high-frequency instabilities in the robust stability test by reducing numerical dissipation below what is required to control the central-difference advection term at high wavenumbers.\n\nUse the following test suite with $\\Delta x = 1$ and background lapse $\\alpha_0 = 1$:\n\n- Test case A: $\\alpha_{\\mathrm{est}} = \\alpha_{\\mathrm{true}}$ and $\\Delta t = 0.9 \\, \\Delta x / \\alpha_{\\mathrm{true}}$.\n- Test case B: $\\alpha_{\\mathrm{est}} = 1.00$ and $\\Delta t = 0.9 \\, \\Delta x / \\alpha_{\\mathrm{true}}$.\n- Test case C: $\\alpha_{\\mathrm{est}} = \\alpha_{\\mathrm{true}}$ and $\\Delta t = 1.1 \\, \\Delta x / \\alpha_{\\mathrm{true}}$.\n- Test case D: $\\alpha_{\\mathrm{est}} = 2.00$ and $\\Delta t = 0.9 \\, \\Delta x / \\alpha_{\\mathrm{true}}$.\n\nHere $\\alpha_{\\mathrm{true}} = \\max(\\lvert v_c \\rvert, \\lvert v_g \\rvert)$ is the true maximum characteristic speed implied by the physics.\n\nYour program must:\n\n- Compute $v_g$ and $v_c$ from the formulation above.\n- For each test case, evaluate the maximum per-step amplification $\\max_{\\theta \\in [0,\\pi]} \\lvert G(\\theta) \\rvert$ for HLLE and for Roe-type flux. Use a numerical search over $\\theta$ densely enough to capture the maximum reliably.\n- Aggregate the results as a single list containing, for each test case in the order A, B, C, D, a two-element list $[\\mathrm{HLLE\\_max}, \\mathrm{Roe\\_max}]$ of floating-point numbers.\n\nFinal output format requirement:\n\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For example, the output must look like $[[x_1,y_1],[x_2,y_2],[x_3,y_3],[x_4,y_4]]$, where each $x_i$ and $y_i$ is a floating-point number representing the maximum per-step amplification for HLLE and Roe-type flux respectively for the $i$-th test case.\n- All quantities are dimensionless; do not attach any physical units. Express all floating-point values with Python’s default string formatting.", "solution": "The problem requires a stability analysis of two approximate Riemann solvers, Harten-Lax-van Leer-Einfeldt (HLLE) and a Roe-type flux, for a simplified model of the Baumgarte-Shapiro-Shibata-Nakamura (BSSN) equations. The analysis will be conducted using Fourier analysis of the semi-discrete method-of-lines operators.\n\n**1. Derivation of Physical Parameters**\n\nThe problem states that the system decouples into two sectors: a constraint-violating sector and a gauge sector. The characteristic speeds for these sectors are denoted by $v_c$ and $v_g$ respectively.\n\nThe constraint propagation speed is given as the speed of light. In the dimensionless units used ($c=1$), this is:\n$$v_c = 1$$\n\nThe gauge speed $v_g$ is derived from the Bona-Massó slicing condition $\\partial_t \\alpha = - \\alpha^2 f(\\alpha) K$. The specific form for $1+\\log$ slicing is given as $f(\\alpha) = 2/\\alpha$. The gauge speed is determined by this function evaluated at the background lapse, $\\alpha_0 = 1$:\n$$v_g = \\sqrt{f(\\alpha_0)} = \\sqrt{\\frac{2}{\\alpha_0}}$$\nSubstituting $\\alpha_0 = 1$:\n$$v_g = \\sqrt{\\frac{2}{1}} = \\sqrt{2}$$\n\nThe set of characteristic speeds is therefore $\\{v_c, v_g\\} = \\{1, \\sqrt{2}\\}$. The true maximum absolute characteristic speed, $\\alpha_{\\mathrm{true}}$, is the maximum of the absolute values of these speeds:\n$$\\alpha_{\\mathrm{true}} = \\max(|v_c|, |v_g|) = \\max(1, \\sqrt{2}) = \\sqrt{2}$$\n\n**2. Semi-Discrete Fourier Analysis**\n\nWe consider a scalar linear advection equation, $\\partial_t u + v \\partial_x u = 0$, which represents one of the decoupled modes. The semi-discrete finite-volume scheme on a uniform grid with spacing $\\Delta x$ is:\n$$\\frac{du_i}{dt} = -\\frac{1}{\\Delta x} \\left( F^*_{i+1/2} - F^*_{i-1/2} \\right)$$\nwhere $F^*_{i+1/2} = F^*(u_i, u_{i+1})$ is the numerical flux at the interface between cells $i$ and $i+1$.\n\nTo find the Fourier symbol $\\lambda(\\theta)$ of the spatial operator, we substitute a single Fourier mode $u_j(t) = \\hat{u}(t) e^{i k j \\Delta x} = \\hat{u}(t) e^{i j \\theta}$, where $\\theta = k \\Delta x$ is the nondimensional wavenumber. The time evolution of the amplitude is then given by $\\frac{d\\hat{u}}{dt} = \\lambda(\\theta) \\hat{u}$. The symbol $\\lambda(\\theta)$ is found to be:\n$$\\lambda(\\theta) = -\\frac{1}{\\Delta x} \\left( F^*(1, e^{i\\theta}) - F^*(e^{-i\\theta}, 1) \\right)$$\n\nFor a linear advection equation with physical flux $F(u)=vu$, the numerical fluxes are:\n\n**Roe-type Flux:** This flux is formulated as a centered flux plus a dissipation term proportional to the characteristic speed.\n$$F^*_{\\text{Roe}}(u_L, u_R) = \\frac{1}{2}(F(u_L) + F(u_R)) - \\frac{1}{2}|v|(u_R - u_L) = \\frac{v}{2}(u_L + u_R) - \\frac{|v|}{2}(u_R - u_L)$$\nThe dissipation is specific to the mode, with a coefficient equal to $|v|$.\n\n**HLLE Flux:** This flux uses global signal velocity estimates, $s_L$ and $s_R$. The problem specifies symmetric bounds $s_L = -\\alpha_{\\mathrm{est}}$ and $s_R = \\alpha_{\\mathrm{est}}$.\n$$F^*_{\\text{HLLE}}(u_L, u_R) = \\frac{s_R F(u_L) - s_L F(u_R) + s_L s_R (u_R - u_L)}{s_R - s_L}$$\nSubstituting $F(u)=vu$, $s_L = -\\alpha_{\\mathrm{est}}$, and $s_R = \\alpha_{\\mathrm{est}}$:\n$$F^*_{\\text{HLLE}}(u_L, u_R) = \\frac{\\alpha_{\\mathrm{est}}(v u_L) - (-\\alpha_{\\mathrm{est}})(v u_R) + (-\\alpha_{\\mathrm{est}})(\\alpha_{\\mathrm{est}})(u_R - u_L)}{2\\alpha_{\\mathrm{est}}} = \\frac{v}{2}(u_L + u_R) - \\frac{\\alpha_{\\mathrm{est}}}{2}(u_R - u_L)$$\nThe HLLE flux with symmetric bounds has a structure identical to the Roe-type flux, but the dissipation coefficient is the globally estimated maximum speed, $\\alpha_{\\mathrm{est}}$, for all modes, not the mode-specific speed $|v|$.\n\nCombining these flux forms, we can write a generic flux with a dissipation coefficient $D$:\n$$F^*(u_L, u_R) = \\frac{v}{2}(u_L + u_R) - \\frac{D}{2}(u_R - u_L)$$\nwhere $D = |v|$ for Roe-type flux and $D = \\alpha_{\\mathrm{est}}$ for HLLE flux.\n\nThe corresponding Fourier symbol is:\n$$\\lambda(\\theta) = \\frac{1}{\\Delta x} \\left( -i v \\sin(\\theta) + D(\\cos(\\theta) - 1) \\right)$$\nThe term $-i v \\sin(\\theta)$ arises from the centered flux part (advection) and the term $D(\\cos(\\theta) - 1)$ arises from the dissipation part. This confirms that the dissipation for Roe depends on the local characteristic speed $v$, while for HLLE it depends on the global estimate $\\alpha_{\\mathrm{est}}$.\n\n**3. Amplification Factor and Stability Diagnostic**\n\nUsing forward Euler time-stepping with a step size $\\Delta t$, the amplification factor $G(\\theta)$ for a Fourier mode is:\n$$G(\\theta) = 1 + \\Delta t \\lambda(\\theta) = 1 + \\frac{\\Delta t}{\\Delta x} \\left( -i v \\sin(\\theta) + D(\\cos(\\theta) - 1) \\right)$$\nThe stability of the scheme is determined by the magnitude of this complex number, $|G(\\theta)|$. For stability, we require $|G(\\theta)| \\leq 1$ for all $\\theta \\in [0, \\pi]$ and for all modes. The diagnostic for each test case is the maximum value of $|G(\\theta)|$ over both characteristic sectors (with speeds $v_c=1$ and $v_g=\\sqrt{2}$) and all nondimensional wavenumbers $\\theta \\in [0, \\pi]$.\nThe squared magnitude is:\n$$|G(\\theta)|^2 = \\left(1 + \\frac{\\Delta t}{\\Delta x} D(\\cos(\\theta) - 1)\\right)^2 + \\left(\\frac{\\Delta t}{\\Delta x} v \\sin(\\theta)\\right)^2$$\nFor each test case, we compute the maximum of $\\sqrt{|G(\\theta)|^2}$ by performing a numerical search over a dense grid of $\\theta$ values from $0$ to $\\pi$.\n\n**4. Scenario for Instability due to Mis-estimation**\n\nA scenario where mis-estimation of the HLLE bounds leads to instability is presented by **Test Case B**.\nIn this case, the true fastest speed is $\\alpha_{\\mathrm{true}} = \\sqrt{2} \\approx 1.414$, but the estimate used for HLLE is $\\alpha_{\\mathrm{est}} = 1.00$. This estimate is an underestimation of the true maximum speed.\n\nThe HLLE solver applies a numerical dissipation with coefficient $D = \\alpha_{\\mathrm{est}} = 1.0$ to all characteristic fields.\n- For the constraint mode ($v_c = 1$), the dissipation coefficient $D=1.0$ correctly matches the wave speed $|v_c|=1.0$. This mode will be stable under the given time step.\n- For the gauge mode ($v_g = \\sqrt{2}$), the dissipation coefficient is $D=1.0$, which is less than the wave speed $|v_g| \\approx 1.414$. The numerical dissipation is insufficient to damp instabilities arising from the centered-difference part of the numerical scheme for this faster wave.\n\nThe stability condition for this scheme is $|G(\\theta)|^2 \\le 1$. Analytical investigation shows that when the advective speed $|v|$ is larger than the dissipation coefficient $D$, it is possible for the maximum value of $|G(\\theta)|$ to exceed $1$ for some $\\theta \\in (0, \\pi)$, even if the standard CFL condition seems satisfied. The Roe-type solver is immune to this particular issue because it inherently uses $D=|v|$ for each mode, providing the \"correct\" amount of dissipation for this linear model.\n\nConversely, **Test Case D** presents a scenario of overestimation ($\\alpha_{\\mathrm{est}}=2.0 > \\sqrt{2}$). This leads to excessive numerical dissipation. The stability condition for forward Euler requires $D \\frac{\\Delta t}{\\Delta x} \\le 1$. In Case D, $D \\frac{\\Delta t}{\\Delta x} = 2.0 \\cdot \\frac{0.9/\\sqrt{2}}{1} \\approx 1.27 > 1$, causing instability for HLLE at high frequencies ($\\theta=\\pi$).\n\nFinally, **Test Case C** probes the stability limit by using a time step that violates the Courant-Friedrichs-Lewy (CFL) condition. The CFL number for the fastest mode is $|v_g| \\frac{\\Delta t}{\\Delta x} = \\sqrt{2} \\cdot \\frac{1.1/\\sqrt{2}}{1} = 1.1 > 1$. Both Roe and HLLE (which uses the correct $\\alpha_{\\mathrm{est}}$ in this case) are expected to become unstable.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the numerical relativity stability problem by calculating the maximum\n    amplification factor for HLLE and Roe-type solvers under various conditions.\n    \"\"\"\n\n    # 1. Derive Physical Parameters\n    # Lapse at background is alpha_0 = 1\n    # f(alpha) = 2/alpha\n    # Gauge speed vg = sqrt(f(alpha_0))\n    alpha_0 = 1.0\n    vg = np.sqrt(2.0 / alpha_0)\n    \n    # Constraint speed is speed of light, c=1\n    vc = 1.0\n    \n    # True maximum characteristic speed\n    alpha_true = max(abs(vc), abs(vg))\n    \n    # Grid spacing\n    dx = 1.0\n\n    # Test cases from the problem statement\n    # Each tuple is (alpha_est_factor, dt_factor) where alpha_est = alpha_est_factor\n    # and dt = dt_factor * dx / alpha_true. For factors that depend on alpha_true,\n    # we use a sentinel value (None) and compute it inside the loop.\n    test_params = [\n        (None, 0.9),  # Case A: alpha_est = alpha_true, dt = 0.9 * dx / alpha_true\n        (1.00, 0.9),  # Case B: alpha_est = 1.00, dt = 0.9 * dx / alpha_true\n        (None, 1.1),  # Case C: alpha_est = alpha_true, dt = 1.1 * dx / alpha_true\n        (2.00, 0.9),  # Case D: alpha_est = 2.00, dt = 0.9 * dx / alpha_true\n    ]\n    \n    results = []\n\n    # Discretize theta for numerical search of the maximum\n    theta = np.linspace(0, np.pi, 2000)\n    cos_theta = np.cos(theta)\n    sin_theta = np.sin(theta)\n\n    def get_max_amplification(v_list, D_list, dt, dx):\n        \"\"\"\n        Calculates the maximum amplification factor over a list of modes.\n        Each mode is defined by its speed v and dissipation coefficient D.\n        \"\"\"\n        max_g_sq = 0.0\n        \n        # Coefficients for the amplification factor calculation\n        dt_dx = dt / dx\n        \n        for v, D in zip(v_list, D_list):\n            # |G(theta)|^2 = (1 + dt/dx * D*(cos(theta)-1))^2 + (dt/dx * v*sin(theta))^2\n            real_part = 1.0 + dt_dx * D * (cos_theta - 1.0)\n            imag_part = dt_dx * v * sin_theta\n            \n            g_sq = real_part**2 + imag_part**2\n            max_g_sq = max(max_g_sq, np.max(g_sq))\n            \n        return np.sqrt(max_g_sq)\n\n    # 3. Compute max amplification for each test case\n    for alpha_est_val, dt_factor in test_params:\n        \n        # Set alpha_est for the current test case\n        if alpha_est_val is None:\n            alpha_est = alpha_true\n        else:\n            alpha_est = alpha_est_val\n            \n        # Set time step for the current test case\n        dt = dt_factor * dx / alpha_true\n        \n        speeds = [vc, vg]\n        \n        # --- HLLE Solver ---\n        # Dissipation is the same for all modes, D = alpha_est\n        D_hlle = [alpha_est, alpha_est]\n        hlle_max_amp = get_max_amplification(speeds, D_hlle, dt, dx)\n        \n        # --- Roe-type Solver ---\n        # Dissipation is mode-specific, D = |v|\n        D_roe = [abs(v) for v in speeds]\n        roe_max_amp = get_max_amplification(speeds, D_roe, dt, dx)\n        \n        results.append([hlle_max_amp, roe_max_amp])\n\n    # Final print statement in the exact required format\n    # Example format: [[x1,y1],[x2,y2],[x3,y3],[x4,y4]]\n    result_str = \",\".join([f\"[{r[0]},{r[1]}]\" for r in results])\n    print(f\"[{result_str}]\")\n\nsolve()\n\n```", "id": "3464381"}]}