{"hands_on_practices": [{"introduction": "The $3+1$ decomposition provides a powerful dictionary for translating four-dimensional spacetime geometry into the language of three-dimensional spatial slices evolving in time. A crucial first step in mastering this formalism is to practice using this dictionary. This exercise [@problem_id:3487089] challenges you to compute the fundamental quantities of the $3+1$ decomposition—the lapse $\\alpha$, shift $\\beta^i$, and extrinsic curvature $K_{ij}$—for a non-trivial foliation of a simple spacetime. By working through the hyperboloidal slicing of Minkowski space, you will gain concrete experience in applying the core definitions and see how curvature can arise in the spatial slices even when the parent spacetime is flat.", "problem": "Consider four-dimensional Minkowski spacetime with metric $g_{ab}$ of signature $(-,+,+,+)$ in global Cartesian coordinates $(t,x,y,z)$, where $r^{2} = x^{2} + y^{2} + z^{2}$. Define a hyperboloidal time coordinate $\\tau$ by the relation $t = \\sqrt{\\tau^{2} + r^{2}}$, so that each level set $\\tau = \\text{constant}$ is a spacelike hyperboloid. Using only core definitions of the $3+1$ decomposition in the Arnowitt–Deser–Misner (ADM) formalism, derive the future-directed unit normal $n^{a}$ to the slices, the lapse $\\alpha$, and the shift $\\beta^{i}$ associated with the coordinate system $(\\tau, x, y, z)$. Then compute the trace of the extrinsic curvature $K$ of the $\\tau = \\text{constant}$ slices and justify why $K$ is constant and negative on each slice. Provide the final answer as a single closed-form analytic expression for $K$ in terms of $\\tau$ only.", "solution": "We begin with Minkowski spacetime in Cartesian coordinates $(t,x,y,z)$, with metric $g_{ab}$ such that $ds^{2} = -dt^{2} + dx^{2} + dy^{2} + dz^{2}$ and signature $(-,+,+,+)$. We define a hyperboloidal time coordinate $\\tau$ by $t = \\sqrt{\\tau^{2} + r^{2}}$, where $r^{2} = x^{2} + y^{2} + z^{2}$. Equivalently, $\\tau$ is the function $\\tau = \\sqrt{t^{2} - r^{2}}$ on the region $t^{2} > r^{2}$.\n\nFor a foliation by level sets of $\\tau$, the future-directed unit normal $n^{a}$ to the hypersurfaces $\\tau = \\text{constant}$ can be obtained from the gradient of $\\tau$. The gradient covector is\n$$\n\\nabla_{a}\\tau = \\left(\\frac{\\partial \\tau}{\\partial t}, \\frac{\\partial \\tau}{\\partial x}, \\frac{\\partial \\tau}{\\partial y}, \\frac{\\partial \\tau}{\\partial z}\\right) = \\left(\\frac{t}{\\tau}, -\\frac{x}{\\tau}, -\\frac{y}{\\tau}, -\\frac{z}{\\tau}\\right).\n$$\nIts squared norm is\n$$\ng^{ab}\\nabla_{a}\\tau \\nabla_{b}\\tau = -\\left(\\frac{t}{\\tau}\\right)^{2} + \\frac{x^{2}+y^{2}+z^{2}}{\\tau^{2}} = -\\frac{t^{2}-r^{2}}{\\tau^{2}} = -1,\n$$\nso $|\\nabla \\tau|^{2} = -1$. In the $3+1$ decomposition for spacelike slices, the lapse $\\alpha$ is defined such that the normal covector $n_a = -\\alpha \\nabla_a \\tau$. The normalization condition $n_a n^a = -1$ implies that $(-\\alpha \\nabla_a \\tau)(-\\alpha g^{ab} \\nabla_b \\tau) = \\alpha^2(g^{ab}\\nabla_a \\tau \\nabla_b \\tau) = -1$. Since we found $g^{ab}\\nabla_a \\tau \\nabla_b \\tau = -1$, this gives $\\alpha^2(-1)=-1$, so $\\alpha=1$. We choose the future-pointing normal, for which we take\n$$\nn_{a} = -\\nabla_{a}\\tau = \\left(-\\frac{t}{\\tau}, \\frac{x}{\\tau}, \\frac{y}{\\tau}, \\frac{z}{\\tau}\\right).\n$$\nRaising indices with $g^{ab}$, we obtain the future-directed unit normal vector\n$$\nn^{a} = g^{ab} n_{b} = \\left(\\frac{t}{\\tau}, \\frac{x}{\\tau}, \\frac{y}{\\tau}, \\frac{z}{\\tau}\\right).\n$$\nThus the lapse is $\\alpha = 1$.\n\nNext we compute the shift $\\beta^{i}$ by expressing the metric in $(\\tau,x,y,z)$. Differentiating $t(\\tau,x,y,z) = \\sqrt{\\tau^{2} + r^{2}}$ gives\n$$\n\\frac{\\partial t}{\\partial \\tau} = \\frac{\\tau}{t}, \\quad \\frac{\\partial t}{\\partial x^{i}} = \\frac{x^{i}}{t},\n$$\nso\n$$\ndt = \\frac{\\tau}{t}\\, d\\tau + \\frac{x^{i}}{t}\\, dx^{i}.\n$$\nSubstituting into $ds^{2} = -dt^{2} + \\delta_{ij} dx^{i} dx^{j}$, we find\n$$\nds^{2} = -\\left(\\frac{\\tau}{t}\\, d\\tau + \\frac{x^{i}}{t}\\, dx^{i}\\right)^{2} + \\delta_{ij} dx^{i} dx^{j}.\n$$\nExpanding,\n$$\nds^{2} = -\\frac{\\tau^{2}}{t^{2}}\\, d\\tau^{2} - \\frac{2\\tau x^{i}}{t^{2}}\\, d\\tau\\, dx^{i} + \\left(\\delta_{ij} - \\frac{x^{i} x^{j}}{t^{2}}\\right) dx^{i} dx^{j}.\n$$\nThis identifies the spatial metric on the slices as\n$$\n\\gamma_{ij} = \\delta_{ij} - \\frac{x^{i} x^{j}}{t^{2}},\n$$\nand the mixed components as\n$$\ng_{\\tau i} = - \\frac{\\tau x^{i}}{t^{2}}.\n$$\nIn the $3+1$ form, $g_{\\tau i} = \\gamma_{ij} \\beta^{j}$, so\n$$\n\\beta^{i} = \\gamma^{ij} g_{\\tau j}.\n$$\nThe inverse of $\\gamma_{ij}$ is obtained via the Sherman–Morrison formula. Noting $t^{2} = \\tau^{2} + r^{2}$, one verifies\n$$\n\\gamma^{ij} = \\delta^{ij} + \\frac{x^{i} x^{j}}{\\tau^{2}}.\n$$\nTherefore,\n$$\n\\beta^{i} = \\left(\\delta^{ij} + \\frac{x^{i} x^{j}}{\\tau^{2}}\\right)\\left(-\\frac{\\tau x^{j}}{t^{2}}\\right) = -\\frac{\\tau}{t^{2}}\\left(x^{i} + \\frac{x^{i} r^{2}}{\\tau^{2}}\\right) = -\\frac{\\tau}{t^{2}}\\frac{t^{2}}{\\tau^{2}} x^{i} = -\\frac{x^{i}}{\\tau}.\n$$\nWe can also confirm the lapse from $g_{\\tau\\tau} = -\\alpha^{2} + \\gamma_{ij}\\beta^{i}\\beta^{j}$. From the above,\n$$\ng_{\\tau\\tau} = -\\frac{\\tau^{2}}{t^{2}}, \\quad \\gamma_{ij}\\beta^{i}\\beta^{j} = \\left(\\delta_{ij} - \\frac{x^{i} x^{j}}{t^{2}}\\right)\\frac{x^{i} x^{j}}{\\tau^{2}} = \\frac{r^{2}}{\\tau^{2}} - \\frac{r^{4}}{t^{2}\\tau^{2}} = \\frac{r^{2}}{t^{2}}.\n$$\nThus $-\\frac{\\tau^{2}}{t^{2}} = -\\alpha^{2} + \\frac{r^{2}}{t^{2}}$, implying $\\alpha^{2} = \\frac{\\tau^{2} + r^{2}}{t^{2}} = 1$ and hence $\\alpha = 1$, consistent with the normalization above.\n\nFinally, we compute the trace of the extrinsic curvature $K$. In the ADM convention for signature $(-,+,+,+)$, the extrinsic curvature tensor is $K_{ij} = -\\frac{1}{2}\\mathcal{L}_{n}\\gamma_{ij}$ plus terms involving the shift, and its trace obeys\n$$\nK = -\\nabla_{a} n^{a},\n$$\nwhere $\\nabla_{a}$ is the covariant derivative compatible with $g_{ab}$. In Minkowski inertial coordinates, $\\nabla_{a} n^{a} = \\partial_{a} n^{a}$ because the Christoffel symbols vanish, but care is needed because $n^{a}$ depends on $(t,x,y,z)$ through $\\tau = \\sqrt{t^{2} - r^{2}}$. Define $\\sigma(t,x,y,z) = \\sqrt{t^{2} - r^{2}}$. Then\n$$\nn^{a} = \\left(\\frac{t}{\\sigma}, \\frac{x}{\\sigma}, \\frac{y}{\\sigma}, \\frac{z}{\\sigma}\\right).\n$$\nUsing\n$$\n\\partial_{t}\\sigma = \\frac{t}{\\sigma}, \\quad \\partial_{x}\\sigma = -\\frac{x}{\\sigma}, \\quad \\partial_{y}\\sigma = -\\frac{y}{\\sigma}, \\quad \\partial_{z}\\sigma = -\\frac{z}{\\sigma},\n$$\nwe compute\n\\begin{align*}\n\\partial_{t}\\left(\\frac{t}{\\sigma}\\right) = \\frac{\\sigma - t\\,\\partial_{t}\\sigma}{\\sigma^{2}} = \\frac{\\sigma - t^{2}/\\sigma}{\\sigma^{2}} = \\frac{\\sigma^{2} - t^{2}}{\\sigma^{3}} = -\\frac{r^{2}}{\\sigma^{3}}, \\\\\n\\partial_{x}\\left(\\frac{x}{\\sigma}\\right) = \\frac{\\sigma - x\\,\\partial_{x}\\sigma}{\\sigma^{2}} = \\frac{\\sigma + x^{2}/\\sigma}{\\sigma^{2}} = \\frac{\\sigma^{2} + x^{2}}{\\sigma^{3}}, \\\\\n\\partial_{y}\\left(\\frac{y}{\\sigma}\\right) = \\frac{\\sigma^{2} + y^{2}}{\\sigma^{3}}, \\\\\n\\partial_{z}\\left(\\frac{z}{\\sigma}\\right) = \\frac{\\sigma^{2} + z^{2}}{\\sigma^{3}}.\n\\end{align*}\nSumming yields\n$$\n\\nabla_{a} n^{a} = \\partial_{a} n^{a} = -\\frac{r^{2}}{\\sigma^{3}} + \\frac{\\sigma^{2} + x^{2}}{\\sigma^{3}} + \\frac{\\sigma^{2} + y^{2}}{\\sigma^{3}} + \\frac{\\sigma^{2} + z^{2}}{\\sigma^{3}} = \\frac{3\\sigma^{2}}{\\sigma^{3}} = \\frac{3}{\\sigma}.\n$$\nRestricting to the hypersurface $\\tau = \\sigma$, we obtain\n$$\n\\nabla_{a} n^{a} = \\frac{3}{\\tau}, \\quad \\text{hence} \\quad K = -\\nabla_{a} n^{a} = -\\frac{3}{\\tau}.\n$$\nThis shows that on each hyperboloidal slice $\\tau = \\text{constant}$, the trace of the extrinsic curvature is spatially constant and negative. Its constancy arises because $\\nabla_{a} n^{a}$ depends only on $\\sigma = \\sqrt{t^{2} - r^{2}}$, which is equal to the slice label $\\tau$ everywhere on the slice, and its negativity follows from the ADM sign convention $K = -\\nabla_{a} n^{a}$ with $n^{a}$ chosen future-directed in a spacetime of signature $(-,+,+,+)$.", "answer": "$$\\boxed{-\\frac{3}{\\tau}}$$", "id": "3487089"}, {"introduction": "A cornerstone of general relativity is the principle of general covariance, which states that the laws of physics are independent of the choice of coordinates. In the $3+1$ formalism, the freedom to choose coordinates is largely captured by the lapse function $\\alpha$ and shift vector $\\beta^i$. This hands-on coding exercise [@problem_id:3487145] provides a direct, numerical verification of this principle for the lapse. You will demonstrate that a physical observable—the total energy radiated in gravitational waves—remains invariant under a re-scaling of the time coordinate, but only if the transformation, governed by the lapse, is correctly accounted for in the calculation.", "problem": "You are asked to verify the invariance of a physically measurable quantity under a time-reparametrization (lapse rescaling) in the context of the spacetime foliation known as the $3+1$ decomposition, and to quantify numerical artifacts introduced by performing the same calculation naively in coordinate time. Work in geometric units where $G=c=1$, so all quantities in this problem are dimensionless.\n\nConsider a gravitational wave strain proxy $h(u)$ at future null infinity, where $u$ is the physical retarded time. In the $3+1$ decomposition, coordinate time $t$ advances according to $du=\\alpha(t)\\,dt$, where $\\alpha$ is the lapse. A pure time-reparametrization rescales the lapse as $\\alpha\\rightarrow \\alpha'(t')=f(t')\\,\\alpha(t)$, corresponding to a new coordinate time $t'$ satisfying $du=\\alpha'(t')\\,dt'$ with the same physical $u$. The News function is $N(u)=dh/du$, and the Bondi mass loss rate is $dM/du=-(16\\pi)^{-1}\\int |N|^2\\,d\\Omega$. For this computational problem, you will work with the proxy energy functional\n$$\nE[h]:=\\int |N(u)|^2\\,du=\\int \\left|\\frac{dh}{du}\\right|^2\\,du,\n$$\nwhich is proportional to the integral of the energy flux over retarded time after a trivial angular normalization. Show numerically that $E[h]$ is invariant under time-reparametrization when computed consistently with the Jacobian implied by the lapse, and that a naive computation that ignores the Jacobian is not invariant.\n\nFundamental bases you may use:\n- The $3+1$ decomposition identifies a lapse $\\alpha$ such that $du=\\alpha\\,dt$.\n- Under a lapse rescaling $\\alpha\\rightarrow \\alpha'=f(t')\\alpha$ one has $du=\\alpha'(t')\\,dt'$.\n- The chain rule implies $dh/dt=\\alpha\\,N$ and $dh/dt'=\\alpha'\\,N$.\n\nYour program must implement the following steps:\n1. Define a smooth, localized waveform in physical retarded time $u$:\n   - Let $h(u)=A\\exp\\!\\left(-\\frac{(u-u_0)^2}{2\\sigma^2}\\right)\\cos\\!\\big(\\omega (u-u_0)\\big)$ with parameters $A=1$, $u_0=0$, $\\sigma=5$, and $\\omega=0.8$.\n   - Use a uniform physical-time grid $u\\in[-U,U]$ with $U=30$ and $N_u=60001$ points, so the uniform step is $\\Delta u=2U/(N_u-1)$.\n2. Original foliation:\n   - Take $\\alpha=1$, so $u=t$.\n   - Compute the “proper” energy $E_{\\text{proper}}=\\int |dh/dt|^2/\\alpha\\,dt$, which here reduces to $E_{\\text{proper}}=\\int |dh/du|^2\\,du$ on the $u$-grid.\n   - Also compute the “naive” energy $E_{\\text{naive}}=\\int |dh/dt|^2\\,dt$, which equals $E_{\\text{proper}}$ when $\\alpha=1$.\n3. Rescaled foliation:\n   - For each specified $f(t')$ below, construct the new coordinate time $t'(u)$ by solving the ordinary differential equation $dt'/du = 1/f(t')$ with initial condition $t'(u=-U)=0$. Use a stable, sufficiently accurate explicit method.\n   - Create a uniform $t'$-grid with the same number of points $N_u$, spanning the interval $[t'(u=-U),t'(u=+U)]$.\n   - Invert $t'(u)$ to obtain $u(t')$ by monotone interpolation, and evaluate $h$ on the uniform $t'$-grid via $h(t')=h(u(t'))$.\n   - Compute\n     - the “proper” rescaled energy $E'_{\\text{proper}}=\\int |dh/dt'|^2/\\alpha'(t')\\,dt' = \\int |dh/dt'|^2/f(t')\\,dt'$ on the uniform $t'$-grid,\n     - and the “naive” rescaled energy $E'_{\\text{naive}}=\\int |dh/dt'|^2\\,dt'$ on the same grid.\n4. For each rescaling $f$, report three diagnostics:\n   - The relative invariance error $\\epsilon_{\\text{inv}}=\\big|E'_{\\text{proper}}-E_{\\text{proper}}\\big|/E_{\\text{proper}}$,\n   - The naive relative deviation $\\epsilon_{\\text{naive}}=\\big|E'_{\\text{naive}}-E_{\\text{naive}}\\big|/E_{\\text{naive}}$,\n   - A sampling stretch factor $S=\\max_{t'} f(t')/\\min_{t'} f(t')$, which quantifies non-uniformity introduced by the time-dependent rescaling.\n\nTest suite:\n- Case $1$ (identity): $f_1(t')=1$.\n- Case $2$ (constant rescaling): $f_2(t')=2$.\n- Case $3$ (mildly time-dependent): $f_3(t')=1+0.3\\sin(0.5\\,t')$.\n- Case $4$ (strongly time-dependent): $f_4(t')=1+0.9\\sin(0.9\\,t')$.\n\nAngle units are radians. All outputs are dimensionless in geometric units.\n\nYour program must output a single line containing the concatenated results for the four cases, in order, as a comma-separated list enclosed in square brackets. For each case output the triplet $[\\epsilon_{\\text{inv}},\\epsilon_{\\text{naive}},S]$ in that order, concatenated into a single flat list. For example, the overall output format must be\n\"[eps_inv_case1,eps_naive_case1,S_case1,eps_inv_case2,eps_naive_case2,S_case2,eps_inv_case3,eps_naive_case3,S_case3,eps_inv_case4,eps_naive_case4,S_case4]\".\n\nAll numerical differentiation and integration must be implemented by your code. No user input is permitted. The final answers must be printed as floating-point numbers.", "solution": "The problem statement is valid. It is scientifically grounded in the principles of general relativity and its $3+1$ formulation, specifically concerning the invariance of physical observables under choices of spacetime foliation. The problem is well-posed, providing a complete set of definitions, parameters, and a clear computational objective that is feasible and verifiable.\n\nThe core principle to be demonstrated is the invariance of a physical quantity under a coordinate transformation. The proxy for total radiated energy, $E[h]$, is defined in terms of the physical retarded time $u$ as:\n$$\nE[h] = \\int \\left|\\frac{dh}{du}\\right|^2 du = \\int |N(u)|^2 du\n$$\nThis quantity must have the same value regardless of the coordinate system used for its computation, provided the computation correctly accounts for the transformation. We are considering a transformation from one coordinate time $t$ to another, $t'$, which reparametrizes the foliation. The relationship between the physical time interval $du$ and the coordinate time intervals $dt$ and $dt'$ is given by the lapse function, $\\alpha$ and $\\alpha'$ respectively:\n$$\ndu = \\alpha(t) \\, dt = \\alpha'(t') \\, dt'\n$$\nThe problem specifies an initial foliation with $\\alpha(t)=1$, so $du=dt$ and $u=t$ (up to a trivial constant). The reparametrization introduces a new lapse $\\alpha'(t') = f(t')\\alpha(t) = f(t')$.\n\nTo compute the integral for $E[h]$ in the new $t'$ coordinates, we must transform both the integrand and the measure. Using the chain rule, the News function $N(u) = dh/du$ can be expressed in terms of the derivative with respect to $t'$:\n$$\n\\frac{dh}{dt'} = \\frac{dh}{du} \\frac{du}{dt'} = N(u) \\, \\alpha'(t') \\implies N(u) = \\frac{1}{\\alpha'(t')} \\frac{dh}{dt'}\n$$\nThe integration measure transforms as $du = \\alpha'(t') dt'$. Substituting these into the definition of $E[h]$ yields the expression for the energy in the new coordinates:\n$$\nE[h] = \\int \\left| \\frac{1}{\\alpha'(t')} \\frac{dh}{dt'} \\right|^2 (\\alpha'(t') dt') = \\int \\frac{|dh/dt'|^2}{(\\alpha'(t'))^2} \\alpha'(t') dt' = \\int \\frac{|dh/dt'|^2}{\\alpha'(t')} dt'\n$$\nThis demonstrates that the \"proper\" energy computation, $E'_{\\text{proper}} = \\int |dh/dt'|^2/\\alpha'(t')\\,dt'$, is constructed precisely to be invariant. The \"naive\" computation, $E'_{\\text{naive}} = \\int |dh/dt'|^2\\,dt'$, omits the Jacobian factors and is therefore not expected to be invariant. Our task is to verify this numerically.\n\nThe computational procedure is as follows:\n\n1.  **Baseline Calculation**: First, we establish the baseline value for the energy. We define a uniform grid in the physical time $u$ spanning $[-U, U] = [-30, 30]$ with $N_u = 60001$ points. In the original foliation, $\\alpha=1$, so coordinate time $t$ is identical to $u$. We evaluate the waveform $h(u)$ on this grid. The derivative $dh/dt = dh/du$ is computed using a second-order finite difference scheme. The energy $E_{\\text{proper}} = \\int |dh/du|^2 du$ is then calculated using the trapezoidal rule for numerical integration. For this baseline case, $E_{\\text{naive}} = \\int |dh/dt|^2 dt$ is identical to $E_{\\text{proper}}$.\n\n2.  **Coordinate Transformation**: For each given rescaling function $f(t')$, we must establish the mapping between the physical time $u$ and the new coordinate time $t'$. This is achieved by solving the ordinary differential equation $dt'/du = 1/\\alpha'(t') = 1/f(t')$, with the initial condition $t'(u=-U)=0$. This initial value problem is solved using a high-accuracy adaptive Runge-Kutta method (`DOP853` or `RK45` as implemented in `scipy.integrate.solve_ivp`) to obtain discrete values of $t'(u)$ on our physical time grid.\n\n3.  **Rescaled Grid and Interpolation**: We then construct a new uniform computational grid in the $t'$ coordinate, spanning the calculated range $[t'(-U), t'(U)]$ with the same number of points, $N_u$. To evaluate the waveform $h$ on this new grid, we require the inverse mapping $u(t')$. Since $f(t') > 0$, the function $t'(u)$ is strictly monotonic, guaranteeing a unique inverse. We construct a cubic spline interpolant for $u(t')$ from the results of the ODE integration. This allows us to find the value of $u$ corresponding to each point on our uniform $t'$-grid, and subsequently evaluate $h(t') = h(u(t'))$.\n\n4.  **Rescaled Energy Calculation**: On the uniform $t'$-grid, we compute the derivative $dh/dt'$ using the same finite difference method. We also evaluate the rescaled lapse $\\alpha'(t')=f(t')$ at each grid point. With these quantities, we compute the rescaled energies $E'_{\\text{proper}} = \\int |dh/dt'|^2/f(t')\\,dt'$ and $E'_{\\text{naive}} = \\int |dh/dt'|^2\\,dt'$ via numerical integration.\n\n5.  **Diagnostic Metrics**: Finally, for each test case, we compute the specified diagnostics. The relative invariance error $\\epsilon_{\\text{inv}} = |E'_{\\text{proper}} - E_{\\text{proper}}|/E_{\\text{proper}}$ quantifies how well the proper calculation preserves the energy value, isolating numerical (discretization, interpolation) errors. The naive relative deviation $\\epsilon_{\\text{naive}} = |E'_{\\text{naive}} - E_{\\text{naive}}|/E_{\\text{naive}}$ measures the failure of the naive calculation to be invariant. The stretch factor $S = \\max(f)/\\min(f)$ characterizes the degree of non-uniformity of the time transformation. We expect $\\epsilon_{\\text{inv}}$ to be small (close to machine precision, limited by numerical accuracy), whereas $\\epsilon_{\\text{naive}}$ will be significantly different from zero for any non-trivial rescaling where $f(t')$ is not uniformly equal to $1$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp, trapezoid\nfrom scipy.interpolate import interp1d\n\ndef solve():\n    \"\"\"\n    Verifies the invariance of a physical energy functional under time-reparametrization\n    in the 3+1 decomposition of spacetime, and quantifies the error from a naive calculation.\n    \"\"\"\n    # 1. Define constants and the waveform\n    A = 1.0\n    u0 = 0.0\n    sigma = 5.0\n    omega = 0.8\n    U = 30.0\n    Nu = 60001\n\n    # Define a uniform grid in physical retarded time u\n    u_grid = np.linspace(-U, U, Nu)\n    du = u_grid[1] - u_grid[0]\n\n    def h_func(u_vals):\n        \"\"\"Defines the gravitational wave strain proxy h(u).\"\"\"\n        arg = u_vals - u0\n        return A * np.exp(-arg**2 / (2 * sigma**2)) * np.cos(omega * arg)\n\n    # 2. Original foliation (alpha=1, so t=u)\n    t_grid_orig = u_grid\n    dt_orig = du\n    h_orig = h_func(t_grid_orig)\n    \n    # Compute derivative dh/dt numerically using second-order central differences\n    dhdt_orig = np.gradient(h_orig, dt_orig)\n    \n    # In the original foliation, lapse alpha is 1\n    alpha_orig = 1.0\n    \n    # Integrands for proper and naive energy\n    integrand_proper_orig = dhdt_orig**2 / alpha_orig\n    integrand_naive_orig = dhdt_orig**2\n    \n    # Compute energies using the trapezoidal rule. They are identical for alpha=1.\n    E_proper = trapezoid(integrand_proper_orig, t_grid_orig)\n    E_naive = trapezoid(integrand_naive_orig, t_grid_orig)\n    \n    # Define the test cases for the rescaling function f(t')\n    test_cases = [\n        {\"func\": lambda tp: 1.0, \"name\": \"identity\"},\n        {\"func\": lambda tp: 2.0, \"name\": \"constant\"},\n        {\"func\": lambda tp: 1.0 + 0.3 * np.sin(0.5 * tp), \"name\": \"mildly_tdep\"},\n        {\"func\": lambda tp: 1.0 + 0.9 * np.sin(0.9 * tp), \"name\": \"strongly_tdep\"}\n    ]\n    \n    results = []\n\n    # 3. Loop through rescaled foliation cases\n    for case in test_cases:\n        f = case[\"func\"]\n        \n        # a. Solve the ODE dt'/du = 1/f(t') to get the map t'(u)\n        def ode_rhs(u, t_prime):\n            # The ODE depends on the value of the solution t_prime\n            return 1.0 / f(t_prime)\n        \n        sol = solve_ivp(\n            ode_rhs, \n            t_span=[u_grid[0], u_grid[-1]], \n            y0=[0.0],  # Initial condition t'(-U) = 0\n            t_eval=u_grid,\n            method='DOP853', # Use a high-order accurate solver\n            rtol=1e-13, \n            atol=1e-13\n        )\n        t_prime_of_u = sol.y.flatten()\n\n        # b. Create a new uniform grid in t' and interpolate to find u(t')\n        t_prime_min = t_prime_of_u[0]\n        t_prime_max = t_prime_of_u[-1]\n        t_prime_grid = np.linspace(t_prime_min, t_prime_max, Nu)\n        dt_prime = t_prime_grid[1] - t_prime_grid[0]\n        \n        # Create a cubic spline interpolant for u(t')\n        u_of_t_prime = interp1d(t_prime_of_u, u_grid, kind='cubic', bounds_error=False, fill_value=\"extrapolate\")\n        \n        # Evaluate u on the new t' grid\n        u_on_t_prime_grid = u_of_t_prime(t_prime_grid)\n\n        # c. Evaluate waveform, derivative, and lapse on the new t' grid\n        h_rescaled = h_func(u_on_t_prime_grid)\n        dhdt_prime = np.gradient(h_rescaled, dt_prime)\n        alpha_prime = f(t_prime_grid)\n\n        # d. Compute rescaled energies\n        integrand_proper_rescaled = dhdt_prime**2 / alpha_prime\n        integrand_naive_rescaled = dhdt_prime**2\n        \n        E_prime_proper = trapezoid(integrand_proper_rescaled, t_prime_grid)\n        E_prime_naive = trapezoid(integrand_naive_rescaled, t_prime_grid)\n\n        # e. Compute final diagnostic quantities\n        # Relative invariance error\n        eps_inv = np.abs(E_prime_proper - E_proper) / E_proper if E_proper != 0 else 0.0\n        \n        # Naive relative deviation\n        eps_naive = np.abs(E_prime_naive - E_naive) / E_naive if E_naive != 0 else 0.0\n\n        # Sampling stretch factor\n        stretch_factor_S = np.max(alpha_prime) / np.min(alpha_prime)\n\n        results.extend([eps_inv, eps_naive, stretch_factor_S])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{val:.15g}' for val in results)}]\")\n\nsolve()\n```", "id": "3487145"}, {"introduction": "In numerical relativity, one does not typically know the spacetime foliation in advance; instead, it is generated dynamically using a chosen gauge condition. The choice of gauge is critical for the long-term stability and accuracy of a simulation. This exercise [@problem_id:3487119] delves into one of the most celebrated gauge choices, maximal slicing, where the trace of the extrinsic curvature is held at zero ($K=0$). You will implement a numerical solver for the resulting elliptic equation for the lapse function in a Schwarzschild background and analyze its computational cost, providing a practical introduction to the trade-offs between different gauge strategies.", "problem": "You are to implement and analyze numerical gauge conditions for the lapse function in the context of the three-plus-one decomposition of general relativity, specialized to a spherically symmetric, time-symmetric slice of the Schwarzschild spacetime in isotropic coordinates. Your tasks are grounded in first principles from the three-plus-one decomposition and must be expressed and solved in purely mathematical terms.\n\nStart from the evolution equation for the trace of the extrinsic curvature in the three-plus-one decomposition,\n$$\n\\partial_t K \\;=\\; - D^i D_i \\alpha \\;+\\; \\alpha \\left( K_{ij} K^{ij} + 4\\pi(\\rho + S) \\right) \\;+\\; \\beta^i \\partial_i K,\n$$\nwhere $K$ is the trace of the extrinsic curvature $K_{ij}$, $\\alpha$ is the lapse function, $\\beta^i$ is the shift vector, $D_i$ is the spatial covariant derivative compatible with the spatial three-metric $\\gamma_{ij}$, and $\\rho$ and $S$ are the matter energy density and trace of the spatial stress, respectively. In vacuum Schwarzschild and on a time-symmetric slice one has $K_{ij} = 0$, $K = 0$, $\\rho = 0$, $S = 0$, and take $\\beta^i = 0$. Enforcing maximal slicing means $K = 0$ is maintained, hence $\\partial_t K = 0$, which yields the elliptic equation\n$$\nD^i D_i \\alpha \\;=\\; 0.\n$$\nIn isotropic coordinates for Schwarzschild, the spatial three-metric is conformally flat, $\\gamma_{ij} = \\psi^4 \\delta_{ij}$ with conformal factor $\\psi(r) = 1 + \\frac{M}{2 r}$, where $M$ is the Schwarzschild mass and $r$ is the isotropic radius. For a scalar $\\alpha(r)$ in spherical symmetry, the Laplace–Beltrami operator is\n$$\nD^i D_i \\alpha \\;=\\; \\frac{1}{\\psi^6 r^2}\\partial_r\\!\\Big( r^2 \\,\\psi(r)^2\\, \\partial_r \\alpha \\Big).\n$$\nSetting this to zero yields the ordinary differential equation\n$$\n\\partial_r \\!\\left( r^2 \\psi(r)^2 \\,\\partial_r \\alpha(r) \\right) \\;=\\; 0,\n$$\nwhich must be solved on the radial interval $r \\in [r_h, r_{\\max}]$ with $r_h = \\frac{M}{2}$ denoting the horizon radius in isotropic coordinates. Impose Dirichlet boundary conditions $\\alpha(r_h) = 0$ and $\\alpha(r_{\\max}) = 1$. The exact solution to this boundary value problem is\n$$\n\\alpha_{\\text{exact}}(r) \\;=\\; \\frac{r_{\\max} + M/2}{r_{\\max} - M/2} \\cdot \\frac{r - M/2}{r + M/2}.\n$$\n\nPart A (elliptic solve and accuracy): Discretize the ordinary differential equation\n$$\n\\partial_r \\!\\left( r^2 \\psi(r)^2 \\,\\partial_r \\alpha(r) \\right) \\;=\\; 0\n$$\non a uniform grid $r_i = r_h + i\\,\\Delta r$ for $i = 0,1,\\dots,N-1$ with $\\Delta r = \\frac{r_{\\max} - r_h}{N-1}$, using a second-order conservative finite-difference scheme in flux form. Let $r_{i+\\frac{1}{2}} = \\frac{r_i + r_{i+1}}{2}$ and define the midpoint coefficient $A_{i+\\frac{1}{2}} = r_{i+\\frac{1}{2}}^2\\,\\psi(r_{i+\\frac{1}{2}})^2$. For interior nodes $i = 1,2,\\dots,N-2$ enforce the discrete equation\n$$\n\\frac{1}{\\Delta r}\\left[ A_{i+\\frac{1}{2}} \\frac{\\alpha_{i+1} - \\alpha_i}{\\Delta r} \\;-\\; A_{i-\\frac{1}{2}} \\frac{\\alpha_i - \\alpha_{i-1}}{\\Delta r} \\right] \\;=\\; 0,\n$$\nwith boundary values $\\alpha_0 = 0$ and $\\alpha_{N-1} = 1$. This yields a tridiagonal linear system for the unknown vector $(\\alpha_1,\\dots,\\alpha_{N-2})$ to be solved by the Thomas algorithm. After solving, compute the discrete maximum norm error\n$$\n\\|\\alpha - \\alpha_{\\text{exact}}\\|_{\\infty} \\;=\\; \\max_{0 \\le i \\le N-1} \\left| \\alpha_i - \\alpha_{\\text{exact}}(r_i) \\right|.\n$$\n\nPart B (hyperbolic gauge driver cost model and threshold): Consider a simpler hyperbolic gauge driver for the lapse, a damped wave equation in an auxiliary time $\\tau$,\n$$\n\\partial_{\\tau}^2 \\alpha \\;+\\; \\eta\\, \\partial_{\\tau} \\alpha \\;=\\; c_g^2 \\, D^i D_i \\alpha,\n$$\nwith the same Dirichlet boundary conditions $\\alpha(r_h,\\tau) = 0$ and $\\alpha(r_{\\max},\\tau) = 1$. In steady state, this hyperbolic driver solves the same elliptic equation $D^i D_i \\alpha = 0$. Assume an explicit second-order finite-difference time integration with the Courant–Friedrichs–Lewy time step restriction $\\Delta \\tau = \\text{CFL} \\cdot \\frac{\\Delta r}{c_g}$. Assume the following fixed operation counts for a cost model:\n- Elliptic build-and-solve cost per interior grid point: $c_{\\text{build}} = 100$ and $c_{\\text{solve}} = 40$, hence $c_E = c_{\\text{build}} + c_{\\text{solve}} = 140$ operations per interior grid point to assemble coefficients and perform one tridiagonal solve.\n- Hyperbolic per-step update cost per interior grid point: $c_H = 20$ operations.\n\nAssume that boundary information must traverse the domain at finite speed to enforce the Dirichlet conditions, so estimate the minimum number of hyperbolic steps as\n$$\nN_{\\text{steps}} \\;=\\; \\left\\lceil \\frac{N-1}{\\text{CFL}} \\right\\rceil.\n$$\nThen estimate the costs by\n$$\n\\text{cost}_{\\text{elliptic}} \\;=\\; c_E \\cdot (N-2), \\qquad\n\\text{cost}_{\\text{hyperbolic}} \\;=\\; c_H \\cdot (N-2) \\cdot N_{\\text{steps}}.\n$$\nDefine the threshold grid size $N_{\\star}$ where costs are equal by solving\n$$\nc_E \\cdot (N_{\\star}-2) \\;=\\; c_H \\cdot (N_{\\star}-2) \\cdot \\left\\lceil \\frac{N_{\\star}-1}{\\text{CFL}} \\right\\rceil.\n$$\nFor the purpose of this assignment, use the continuous approximation without the ceiling to derive and report\n$$\nN_{\\star} \\;=\\; \\left\\lceil 1 + \\frac{c_E \\cdot \\text{CFL}}{c_H} \\right\\rceil.\n$$\n\nImplementation requirements:\n- Implement the elliptic finite-difference solver in Part A, compute $\\|\\alpha - \\alpha_{\\text{exact}}\\|_{\\infty}$, and report it as a floating-point number.\n- Implement the cost model in Part B as specified, and compute $\\text{cost}_{\\text{elliptic}}$, $\\text{cost}_{\\text{hyperbolic}}$, the threshold $N_{\\star}$, and a boolean flag indicating whether $\\text{cost}_{\\text{elliptic}}  \\text{cost}_{\\text{hyperbolic}}$.\n\nTest suite:\nUse the following parameter sets, each specified as a tuple $(M, r_{\\max}, N, c_g, \\eta, \\text{CFL})$:\n- Test $1$: $(1, 10, 64, 1, 1, 0.5)$.\n- Test $2$: $(1, 100, 256, 1, 1, 0.5)$.\n- Test $3$: $(2, 40, 128, 1, 1, 0.5)$.\n- Test $4$ (edge case with few points): $(1, 2, 8, 1, 1, 0.5)$.\n\nFinal output format:\nYour program should produce a single line of output containing a list of per-test results, where each per-test result is itself a list with five entries in the following order:\n$[\\|\\alpha - \\alpha_{\\text{exact}}\\|_{\\infty}, \\text{cost}_{\\text{elliptic}}, \\text{cost}_{\\text{hyperbolic}}, N_{\\star}, (\\text{cost}_{\\text{elliptic}}  \\text{cost}_{\\text{hyperbolic}})]$.\nFor example, a valid output could look like\n$[[e_1,cE_1,cH_1,N_{\\star},b_1],[e_2,cE_2,cH_2,N_{\\star},b_2],\\dots]$,\nwith all numbers as plain decimals and booleans as $True$ or $False$, printed on a single line. No physical unit conversion is required; report all quantities as pure numbers.", "solution": "This problem required correction before a valid solution could be provided. The original problem statement contained an incorrect formula for the Laplace-Beltrami operator and, more critically, provided an 'exact solution' for the lapse function that was inconsistent with the specified finite-domain boundary conditions. These errors have been fixed in the problem description above. The following solution addresses the corrected problem.\n\n### Part A: Elliptic Solver for Maximal Slicing Lapse\n\nThe problem starts with the evolution equation for the trace of the extrinsic curvature, $K$, and under the specified conditions (vacuum, time-symmetric, zero shift) and the maximal slicing gauge condition ($ \\partial_t K = 0 $), it correctly reduces to the elliptic equation for the lapse, $ D^i D_i \\alpha = 0 $.\n\nThe spatial geometry is given in isotropic coordinates by the metric $ \\gamma_{ij} = \\psi^4(r) \\delta_{ij} $ with conformal factor $ \\psi(r) = 1 + M/(2r) $. For a spherically symmetric scalar function $ \\alpha(r) $, the Laplace-Beltrami operator is\n$$\nD^i D_i \\alpha(r) = \\frac{1}{\\sqrt{\\det \\gamma}} \\partial_i (\\sqrt{\\det \\gamma} \\, \\gamma^{ij} \\partial_j \\alpha) = \\frac{1}{\\psi^6 r^2} \\partial_r (r^2 \\psi^2 \\partial_r \\alpha)\n$$\nSetting $D^i D_i \\alpha = 0$ is equivalent to solving the ODE\n$$\n\\partial_r \\left( r^2 \\psi(r)^2 \\partial_r \\alpha(r) \\right) = 0\n$$\non the domain $ r \\in [r_h, r_{\\max}] $, where $ r_h = M/2 $, with Dirichlet boundary conditions $ \\alpha(r_h) = 0 $ and $ \\alpha(r_{\\max}) = 1 $.\n\nTo find the exact solution, we integrate the ODE twice.\n$$\nr^2 \\psi(r)^2 \\partial_r \\alpha = C_1 \\implies \\partial_r \\alpha = \\frac{C_1}{r^2 (1 + M/2r)^2} = \\frac{C_1}{(r + M/2)^2}\n$$\nIntegrating with respect to $r$ gives:\n$$\n\\alpha(r) = -\\frac{C_1}{r + M/2} + C_2\n$$\nWe apply the boundary conditions to find the constants $C_1$ and $C_2$.\n1.  $ \\alpha(r_h) = \\alpha(M/2) = 0 \\implies -\\frac{C_1}{M/2 + M/2} + C_2 = 0 \\implies C_2 = C_1/M $.\n2.  $ \\alpha(r_{\\max}) = 1 \\implies -\\frac{C_1}{r_{\\max} + M/2} + C_2 = 1 \\implies C_1 \\left(\\frac{1}{M} - \\frac{1}{r_{\\max} + M/2}\\right) = 1 $.\nSolving for $C_1$ yields $C_1 = \\frac{M(r_{\\max} + M/2)}{r_{\\max} - M/2}$. Substituting back gives the exact solution for the BVP:\n$$\n\\alpha_{\\text{exact}}(r) = \\frac{r_{\\max} + M/2}{r_{\\max} - M/2} \\cdot \\frac{r - M/2}{r + M/2}\n$$\nThe numerical implementation follows the finite-difference scheme detailed in the problem statement. This scheme discretizes the ODE into a tridiagonal linear system, which can be solved efficiently. The accuracy is then evaluated by comparing the numerical solution to the corrected exact solution above.\n\n### Part B: Hyperbolic Gauge Driver Cost Model\n\nThis part is a theoretical cost comparison. The costs for the direct elliptic solve and the iterative hyperbolic scheme are estimated using the provided models.\nThe elliptic cost is linear in the number of grid points:\n$$\n\\text{cost}_{\\text{elliptic}} = c_E (N-2)\n$$\nwhere $ c_E = 140 $. The hyperbolic cost includes an additional factor for the number of time steps required for relaxation:\n$$\n\\text{cost}_{\\text{hyperbolic}} = c_H (N-2) N_{\\text{steps}}\n$$\nwhere $ c_H = 20 $ and $ N_{\\text{steps}} = \\lceil (N-1)/\\text{CFL} \\rceil $. The threshold grid size $ N_{\\star} $ is where these costs are equal. Using the continuous approximation as instructed, $ c_E = c_H (N_{\\star}-1)/\\text{CFL} $, which gives:\n$$\nN_{\\star} = \\left\\lceil 1 + \\frac{c_E \\cdot \\text{CFL}}{c_H} \\right\\rceil\n$$\nFor each test case, the implementation calculates the error of the elliptic solver, the two cost estimates, the threshold $N_{\\star}$, and a boolean comparison of the costs.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import solve_banded\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        (1.0, 10.0, 64, 1.0, 1.0, 0.5),\n        (1.0, 100.0, 256, 1.0, 1.0, 0.5),\n        (2.0, 40.0, 128, 1.0, 1.0, 0.5),\n        (1.0, 2.0, 8, 1.0, 1.0, 0.5),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_test_case(*case)\n        results.append(result)\n\n    # Format the final output string as a list of lists.\n    output_str = \"[\" + \",\".join([\n        f\"[{r[0]},{r[1]},{r[2]},{r[3]},{r[4]}]\"\n        for r in results\n    ]) + \"]\"\n    \n    print(output_str)\n\ndef run_test_case(M, r_max, N, c_g, eta, CFL):\n    \"\"\"\n    Executes Parts A and B for a single test case with corrected physics.\n\n    Args:\n        M (float): Schwarzschild mass.\n        r_max (float): Outer boundary of the radial domain.\n        N (int): Number of grid points.\n        c_g (float): Gauge wave speed (unused).\n        eta (float): Damping parameter (unused).\n        CFL (float): Courant-Friedrichs-Lewy number for cost model.\n\n    Returns:\n        list: A list containing the five required output values.\n    \"\"\"\n    \n    # --- Part A: Elliptic Solver ---\n\n    r_h = M / 2.0\n    if N = 2:\n        return [float('nan'), 0, 0, 0, False]\n\n    r_grid = np.linspace(r_h, r_max, N)\n    delta_r = (r_max - r_h) / (N - 1)\n\n    def psi(r_val, M_val):\n        return 1.0 + M_val / (2.0 * r_val)\n\n    def alpha_exact_corrected(r_val, M_val, r_max_val):\n        # The correct exact solution for the finite domain BVP\n        if abs(r_max_val - M_val / 2.0)  1e-15: return np.nan # ill-posed\n        prefactor = (r_max_val + M_val / 2.0) / (r_max_val - M_val / 2.0)\n        term = (r_val - M_val / 2.0) / (r_val + M_val / 2.0)\n        return prefactor * term\n\n    r_mid = r_grid[:-1] + delta_r / 2.0\n    A_mid = r_mid**2 * psi(r_mid, M)**2\n\n    N_interior = N - 2\n    ab = np.zeros((3, N_interior))\n    ab[1, :] = A_mid[1:] + A_mid[:-1]\n    ab[0, 1:] = -A_mid[1:-1]\n    ab[2, :-1] = -A_mid[1:-1]\n\n    rhs = np.zeros(N_interior)\n    rhs[-1] = A_mid[-1] * 1.0\n\n    alpha_interior = solve_banded((1, 1), ab, rhs)\n\n    alpha_numerical = np.zeros(N)\n    alpha_numerical[0] = 0.0\n    alpha_numerical[1:-1] = alpha_interior\n    alpha_numerical[-1] = 1.0\n\n    alpha_exact_vals = alpha_exact_corrected(r_grid, M, r_max)\n    max_norm_error = np.max(np.abs(alpha_numerical - alpha_exact_vals))\n    \n    # --- Part B: Cost Model ---\n\n    c_E = 140.0\n    c_H = 20.0\n    \n    cost_elliptic = c_E * (N - 2)\n    \n    N_steps = np.ceil((N - 1) / CFL)\n    cost_hyperbolic = c_H * (N - 2) * N_steps\n\n    N_star_float = 1.0 + (c_E * CFL) / c_H\n    N_star = int(np.ceil(N_star_float))\n\n    is_elliptic_cheaper = cost_elliptic  cost_hyperbolic\n    \n    return [\n        max_norm_error,\n        cost_elliptic,\n        cost_hyperbolic,\n        N_star,\n        is_elliptic_cheaper\n    ]\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3487119"}]}