{"hands_on_practices": [{"introduction": "To test General Relativity, we must compare observational data against theoretical waveform models. A fundamental first step is to be able to quantify the difference between two competing theoretical models. The noise-weighted inner product provides a statistically meaningful measure of similarity, and from this, we derive the \"mismatch\" — a value between 0 and 1 that represents the fractional loss in signal-to-noise ratio if one waveform is used as a template to find the other. This exercise [@problem_id:3488789] offers hands-on practice in computing the mismatch, a cornerstone metric in gravitational-wave astronomy for assessing model accuracy and constructing the template banks used in searches.", "problem": "Consider two frequency-domain inspiral–merger–ringdown (IMR) gravitational-wave models, denoted by $h_1(f)$ and $h_2(f)$, for a quasi-circular, non-precessing binary with component masses $m_1$ and $m_2$ (in solar masses) and dimensionless aligned spins $\\chi_1$ and $\\chi_2$. Let the inner product between two signals $a$ and $b$ be defined as\n$$\n(a|b) = 4\\,\\Re \\int_0^\\infty \\frac{\\tilde a(f)\\,\\tilde b^*(f)}{S_n(f)}\\,df,\n$$\nwhere $S_n(f)$ is the one-sided noise power spectral density of a detector, and the tilde denotes the Fourier transform. The normalized overlap between $h_1$ and $h_2$ maximized over a constant phase shift $\\phi$ and a time shift $t$ is\n$$\n\\mathcal{O} = \\max_{\\phi,t} \\frac{(h_1|h_2)}{\\sqrt{(h_1|h_1)\\,(h_2|h_2)}},\n$$\nand the mismatch is $\\mathcal{M} = 1 - \\mathcal{O}$.\n\nYou will compute $\\mathcal{M}$ for four test cases using the following physically motivated and self-consistent setup:\n\n1. Frequency grid and sampling:\n   - Use a sampling rate $f_{\\mathrm{samp}} = 4096$ Hz and a discrete Fourier transform length $N = 16384$.\n   - The frequency resolution is $\\Delta f = f_{\\mathrm{samp}}/N$ and the Nyquist frequency is $f_{\\mathrm{Nyq}} = f_{\\mathrm{samp}}/2$.\n   - Define a lower frequency cutoff $f_{\\mathrm{low}} = 20$ Hz; for $f  f_{\\mathrm{low}}$, the waveform amplitude must be set to zero.\n\n2. Noise power spectral density:\n   - Use the following analytic, positive-definite approximation to the Advanced Laser Interferometer Gravitational-Wave Observatory (Advanced LIGO) design sensitivity curve:\n     $$\n     S_n(f) = S_0\\left[\\left(\\frac{f_0}{f}\\right)^4 + 1 + \\left(\\frac{f}{f_0}\\right)^2\\right],\n     $$\n     with $S_0 = 10^{-46}$ and $f_0 = 100$ Hz. This form captures the rise at low frequency, the minimum around $f_0$, and degradation at high frequency.\n\n3. IMR models:\n   - Common definitions:\n     - Convert solar masses to geometric time units using $M_\\odot = 4.925491\\times 10^{-6}$ s, so the total mass in seconds is $M = (m_1+m_2)\\,M_\\odot$.\n     - The symmetric mass ratio is $\\eta = \\frac{m_1 m_2}{(m_1+m_2)^2}$.\n     - The effective aligned spin is $\\chi_{\\mathrm{eff}} = \\frac{m_1 \\chi_1 + m_2 \\chi_2}{m_1+m_2}$.\n     - The prograde Kerr innermost stable circular orbit (ISCO) radius (in units of $M$) is\n       $$\n       r_{\\mathrm{ISCO}} = 3 + Z_2 - \\mathrm{sign}(a)\\,\\sqrt{(3 - Z_1)\\left(3 + Z_1 + 2 Z_2\\right)},\n       $$\n       where $a = \\chi_{\\mathrm{eff}}$,\n       $$\n       Z_1 = 1 + (1-a^2)^{1/3}\\left[(1+a)^{1/3} + (1-a)^{1/3}\\right],\\quad\n       Z_2 = \\sqrt{3a^2 + Z_1^2}.\n       $$\n       The corresponding orbital angular frequency is\n       $$\n       \\Omega_{\\mathrm{ISCO}} = \\frac{1}{M\\left(r_{\\mathrm{ISCO}}^{3/2} + a\\right)},\n       $$\n       and the gravitational-wave ISCO frequency is $f_{\\mathrm{ISCO}} = \\Omega_{\\mathrm{ISCO}}/(2\\pi)$. For the non-spinning case, use $a=0$.\n   - Amplitude model (applies to both models, with different cutoff choices):\n     $$\n     A(f) = f^{-7/6}\\,\\exp\\left[-\\left(\\frac{f}{f_{\\mathrm{cut}}}\\right)^p\\right],\n     $$\n     with $p>0$. Choose $p=4$ for Model 1 and $p=3$ for Model 2. This exponential taper regularizes the inspiral amplitude and mimics merger–ringdown suppression.\n   - Phase model:\n     - Use a leading-order post-Newtonian inspiral phase scaling,\n       $$\n       \\psi_{\\mathrm{LO}}(f) = \\frac{3}{128\\,\\eta}\\left(\\pi M f\\right)^{-5/3},\n       $$\n       which captures the dominant chirp behavior.\n     - Model 1 phase: $\\psi_1(f) = \\psi_{\\mathrm{LO}}(f)$.\n     - Model 2 phase: $\\psi_2(f) = \\psi_{\\mathrm{LO}}(f) + \\delta\\left(\\frac{f}{f_{\\mathrm{ISCO}}^{\\mathrm{(NS)}}}\\right)^2$, where $f_{\\mathrm{ISCO}}^{\\mathrm{(NS)}}$ is computed with $a=0$ and $\\delta = 0.1$ radians, introducing a small, physically motivated high-frequency correction to represent modeling differences near merger.\n   - Cutoff frequency:\n     - Model 1 uses a spin-dependent cutoff $f_{\\mathrm{cut}} = 1.3\\,f_{\\mathrm{ISCO}}(a=\\chi_{\\mathrm{eff}})$.\n     - Model 2 uses a non-spinning cutoff $f_{\\mathrm{cut}} = 1.3\\,f_{\\mathrm{ISCO}}(a=0)$.\n\n   The frequency-domain waveforms are then\n   $$\n   h_1(f) = A_1(f)\\,e^{i\\psi_1(f)},\\qquad h_2(f) = A_2(f)\\,e^{i\\psi_2(f)}.\n   $$\n\n4. Maximization over phase and time:\n   - A constant phase shift $\\phi$ multiplies $h_2(f)$ by $e^{i\\phi}$; a time shift $t$ multiplies it by $e^{i2\\pi f t}$.\n   - Show that maximizing over $\\phi$ yields the magnitude of the complex correlation, and maximizing over $t$ corresponds to finding the maximum magnitude of the inverse discrete Fourier transform of the one-sided, noise-weighted cross-spectrum. Numerically, with a uniform frequency grid $f_k = k\\,\\Delta f$, use the discrete sum to approximate integrals. For the time maximization, evaluate the inverse discrete Fourier transform over the compact time grid associated with $f_{\\mathrm{samp}}$ and $N$ and take the maximum magnitude.\n\n5. Computation details:\n   - Inner products should be approximated by Riemann sums over $f\\in[0,f_{\\mathrm{Nyq}}]$, with the integrand set to zero for $f  f_{\\mathrm{low}}$.\n   - All frequencies are in hertz (Hz). The mismatch $\\mathcal{M}$ is unitless and must be reported as a float rounded to six decimal places.\n\nTest suite:\n- Case 1 (general, equal mass): $(m_1,m_2,\\chi_1,\\chi_2) = (30.0,30.0,0.2,0.2)$.\n- Case 2 (unequal mass, mixed spins): $(15.0,10.0,0.5,-0.3)$.\n- Case 3 (binary neutron star, small spins; potential boundary due to high $f_{\\mathrm{ISCO}}$): $(1.4,1.3,0.02,-0.01)$.\n- Case 4 (high spin, moderate mass ratio): $(35.0,20.0,0.95,0.8)$.\n\nYour program should produce a single line of output containing the mismatches for the four test cases as a comma-separated list enclosed in square brackets, for example, \"[m1,m2,m3,m4]\". Each entry must be a float rounded to six decimal places, with no units.", "solution": "The user has provided a problem in the domain of gravitational-wave data analysis, which requires the computation of the mismatch between two phenomenological inspiral-merger-ringdown (IMR) waveform models. The problem is to be validated against rigorous scientific and logical standards before a solution is attempted.\n\n### Step 1: Problem Validation\n\nThe problem statement provides a comprehensive and self-contained set of definitions, equations, and parameters.\n- **Givens**:\n    - **Models**: Two frequency-domain models, $h_1(f)$ and $h_2(f)$, for non-precessing binaries with parameters $(m_1, m_2, \\chi_1, \\chi_2)$.\n    - **Inner Product**: $(a|b) = 4\\,\\Re \\int_0^\\infty \\frac{\\tilde a(f)\\,\\tilde b^*(f)}{S_n(f)}\\,df$.\n    - **Overlap and Mismatch**: $\\mathcal{O} = \\max_{\\phi,t} \\frac{(h_1|h_2)}{\\sqrt{(h_1|h_1)\\,(h_2|h_2)}}$, and $\\mathcal{M} = 1 - \\mathcal{O}$.\n    - **Numerical Setup**: $f_{\\mathrm{samp}} = 4096$ Hz, $N = 16384$, $\\Delta f = f_{\\mathrm{samp}}/N$, $f_{\\mathrm{Nyq}} = f_{\\mathrm{samp}}/2$, $f_{\\mathrm{low}} = 20$ Hz.\n    - **Noise PSD**: $S_n(f) = S_0[ (f_0/f)^4 + 1 + (f/f_0)^2 ]$ with $S_0 = 10^{-46}$ and $f_0 = 100$ Hz.\n    - **Physical Constants and Definitions**: $M_\\odot = 4.925491\\times 10^{-6}$ s. Definitions for total mass $M$, symmetric mass ratio $\\eta$, and effective spin $\\chi_{\\mathrm{eff}}$ are provided.\n    - **ISCO Frequency**: A complete set of equations for $f_{\\mathrm{ISCO}}$ based on the Kerr metric ISCO radius is given.\n    - **Waveform Models**: Specific functional forms for amplitude $A(f)$ and phase $\\psi(f)$ for both models are defined, including parameter choices ($p=4$ for Model 1, $p=3$ for Model 2) and differences in phase corrections ($\\delta = 0.1$) and cutoff frequency definitions.\n    - **Maximization Procedure**: A clear physical and numerical description of how to maximize the overlap over phase and time shifts is provided, correctly identifying the process with an inverse Discrete Fourier Transform (IDFT) of the noise-weighted cross-spectrum.\n    - **Test Cases**: Four distinct, physically relevant test cases are specified.\n\n- **Validation Verdict**:\n    1.  **Scientifically Grounded**: The problem is firmly rooted in the principles of general relativity and gravitational-wave data analysis. The concepts of inner products, noise PSDs, waveform matching, and post-Newtonian/phenomenological models are all standard in the field. The provided formulas, such as for the Kerr ISCO and the LIGO noise curve, are established and physically motivated.\n    2.  **Well-Posed**: The problem is mathematically and computationally well-defined. All necessary constants, functions, and parameters are provided, leading to a unique numerical result for each test case.\n    3.  **Objective**: The problem is stated using precise, objective language, free of ambiguity or subjective claims.\n    4.  **Flaws**: The problem exhibits none of the disqualifying flaws. It is scientifically sound, fully formalizable, complete, feasible, well-structured, non-trivial, and verifiable.\n\n- **Conclusion**: The problem is valid. A solution will be developed.\n\n### Step 2: Solution Development\n\nThe core of the problem is to compute the mismatch $\\mathcal{M} = 1 - \\mathcal{O}$. This requires calculating the maximized overlap $\\mathcal{O}$. The overlap is defined as:\n$$\n\\mathcal{O} = \\frac{\\max_{\\phi, t} (h_1 | h_2')}{\\sqrt{(h_1|h_1)(h_2|h_2)}}\n$$\nwhere $h_2'(f) = h_2(f) e^{i(2\\pi f t + \\phi)}$.\n\n**Normalization Factors (Denominator):**\nThe denominator contains the norms of the two waveforms. For a waveform $h$, the norm-squared is given by:\n$$\n(h|h) = 4\\Re \\int_0^\\infty \\frac{h(f) h^*(f)}{S_n(f)} df = 4 \\int_0^\\infty \\frac{|h(f)|^2}{S_n(f)} df\n$$\nThese integrals will be approximated as a discrete Riemann sum over the frequency grid:\n$$\n(h|h) \\approx 4 \\sum_{k=k_{\\text{low}}}^{k_{\\text{Nyq}}} \\frac{|h(f_k)|^2}{S_n(f_k)} \\Delta f\n$$\nwhere $f_k = k \\Delta f$ and $k_{\\text{low}}$ is the index corresponding to $f_{\\text{low}}$.\n\n**Maximized Inner Product (Numerator):**\nThe numerator requires maximizing the inner product $(h_1 | h_2')$ over a time shift $t$ and phase shift $\\phi$.\n$$\n(h_1 | h_2') = 4\\Re \\int_0^\\infty \\frac{h_1(f) (h_2(f)e^{i(2\\pi f t + \\phi)})^*}{S_n(f)} df = 4\\Re \\left[ e^{-i\\phi} \\int_0^\\infty \\frac{h_1(f)h_2^*(f)}{S_n(f)} e^{-i2\\pi f t} df \\right]\n$$\nLet the complex quantity $C(t) = \\int_0^\\infty \\frac{h_1(f)h_2^*(f)}{S_n(f)} e^{-i2\\pi f t} df$. The expression to maximize is $4\\Re[e^{-i\\phi} C(t)]$. For any given $t$, this is maximized over $\\phi$ by choosing $e^{-i\\phi}$ to have the same phase as $C(t)$, yielding a maximum value of $4|C(t)|$. We must then maximize this over $t$. The final maximized inner product is $4 \\max_t |C(t)|$.\n\nThe function $C(t)$ is the inverse Fourier transform of the one-sided, noise-weighted cross-spectrum $Q(f) = \\frac{h_1(f)h_2^*(f)}{S_n(f)}$. Computationally, we can find $\\max_t |C(t)|$ by computing the inverse discrete Fourier transform (IDFT) of the discrete spectrum $Q_k = Q(f_k)$ and finding the maximum magnitude of the resulting time series.\nThe IDFT of a one-sided spectrum $Q_k$ (for $k=0, \\dots, N/2$) can be implemented by creating an array of length $N$, placing $Q_k$ in the first $N/2+1$ elements, zero-padding the rest, and applying an IDFT. The relationship between the IDFT and the continuous integral requires a scaling factor.\n$$\n\\max_t |C(t)| \\approx \\max_n \\left| \\Delta f \\sum_{k=0}^{N/2} Q_k e^{-i2\\pi kn/N} \\right|\n$$\nThe standard `ifft` in libraries like `numpy` computes $(1/N) \\sum X_k e^{i2\\pi kn/N}$. To match our desired computation, we must scale the output of `ifft(X)` by $N \\cdot \\Delta f = f_{\\mathrm{samp}}$. Note the sign difference in the exponential; this corresponds to a time reversal, which does not affect the maximum of the absolute value.\n\n**Implementation Steps:**\n1.  Define a frequency grid $f_k$ from $0$ to $f_{\\mathrm{Nyq}}$ with spacing $\\Delta f$.\n2.  For each test case $(m_1, m_2, \\chi_1, \\chi_2)$:\n    a. Implement a function to calculate $f_{\\mathrm{ISCO}}$ based on the provided Kerr formula.\n    b. Implement a function to generate waveforms $h_1(f)$ and $h_2(f)$ according to their distinct amplitude and phase prescriptions, ensuring waveforms are zeroed for $f  f_{\\mathrm{low}}$.\n    c. Compute the noise PSD $S_n(f)$ on the frequency grid.\n    d. Calculate the norms $(h_1|h_1)$ and $(h_2|h_2)$ using Riemann summation.\n    e. Compute the noise-weighted cross-spectrum $Q(f_k)$.\n    f. Use `numpy.fft.ifft` on a one-sided $Q(f_k)$ array (padded to length $N$) and scale by $f_{\\mathrm{samp}}$ to get a time series.\n    g. Find the maximum absolute value of this time series, `max_corr`.\n    h. Calculate the overlap $\\mathcal{O} = \\frac{4 \\cdot \\text{max\\_corr}}{\\sqrt{(h_1|h_1)(h_2|h_2)}}$. The factors of $4$ cancel, so $\\mathcal{O} = \\frac{\\text{max\\_corr}}{\\sqrt{(\\text{norm}_1/4)(\\text{norm}_2/4)}}$.\n    i. Compute and store the mismatch $\\mathcal{M} = 1 - \\mathcal{O}$.\n3.  Format the list of mismatch values as specified.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the mismatch between two IMR gravitational-wave models\n    for a set of test cases.\n    \"\"\"\n\n    # --- Physical and Numerical Constants ---\n    M_SUN_S = 4.925491e-6  # Solar mass in seconds (G=c=1 units)\n    F_SAMP = 4096.0         # Sampling rate in Hz\n    N = 16384               # Number of points in the DFT\n    F_LOW = 20.0            # Lower frequency cutoff in Hz\n    S0 = 1e-46              # Noise PSD amplitude\n    F0 = 100.0              # Noise PSD characteristic frequency in Hz\n    DELTA_PHASE = 0.1       # Phase correction parameter in radians\n\n    # --- Helper Functions ---\n\n    def get_isco_freq(m1, m2, spin_a):\n        \"\"\"Calculates the gravitational-wave ISCO frequency.\"\"\"\n        if not -1.0 = spin_a = 1.0:\n            raise ValueError(\"Spin parameter 'a' must be between -1 and 1.\")\n\n        total_mass_sec = (m1 + m2) * M_SUN_S\n\n        if np.isclose(spin_a, 0):\n            r_isco = 6.0\n        else:\n            a_sq = spin_a**2\n            z1 = 1.0 + (1.0 - a_sq)**(1/3) * ((1.0 + spin_a)**(1/3) + (1.0 - spin_a)**(1/3))\n            z2 = np.sqrt(3.0 * a_sq + z1**2)\n            \n            # Ensure argument of sqrt is non-negative to avoid domain errors\n            sqrt_arg = (3.0 - z1) * (3.0 + z1 + 2.0 * z2)\n            r_isco = 3.0 + z2 - np.sign(spin_a) * np.sqrt(max(0, sqrt_arg))\n\n        omega_isco = 1.0 / (total_mass_sec * (r_isco**1.5 + spin_a))\n        f_isco = omega_isco / (2.0 * np.pi)\n        return f_isco\n\n    def get_ligo_psd(freqs):\n        \"\"\"Calculates the analytic Advanced LIGO noise power spectral density.\"\"\"\n        psd = np.full_like(freqs, np.inf)\n        valid_f_mask = freqs  0\n        f_valid = freqs[valid_f_mask]\n        f_ratio = F0 / f_valid\n        psd[valid_f_mask] = S0 * (f_ratio**4 + 1.0 + (f_valid / F0)**2)\n        return psd\n\n    def generate_waveform(freqs, m1, m2, chi1, chi2, model_type):\n        \"\"\"Generates a frequency-domain waveform model.\"\"\"\n        total_mass_sec = (m1 + m2) * M_SUN_S\n        eta = (m1 * m2) / (m1 + m2)**2\n        chi_eff = (m1 * chi1 + m2 * chi2) / (m1 + m2)\n\n        f_isco_spin = get_isco_freq(m1, m2, chi_eff)\n        f_isco_ns = get_isco_freq(m1, m2, 0.0)\n        \n        if model_type == 1:\n            p, f_cut = 4.0, 1.3 * f_isco_spin\n        elif model_type == 2:\n            p, f_cut = 3.0, 1.3 * f_isco_ns\n        else:\n            raise ValueError(\"model_type must be 1 or 2\")\n\n        h = np.zeros_like(freqs, dtype=np.complex128)\n        \n        # Only compute for f  0 to avoid singularities\n        mask = freqs  0\n        f_valid = freqs[mask]\n        \n        # Amplitude\n        amp = f_valid**(-7.0/6.0) * np.exp(-(f_valid / f_cut)**p)\n        \n        # Phase\n        psi_lo = (3.0 / (128.0 * eta)) * (np.pi * total_mass_sec * f_valid)**(-5.0/3.0)\n        psi = psi_lo\n        if model_type == 2:\n            psi_corr = DELTA_PHASE * (f_valid / f_isco_ns)**2\n            psi += psi_corr\n            \n        h[mask] = amp * np.exp(1j * psi)\n        \n        # Apply low-frequency cutoff\n        h[freqs  F_LOW] = 0.0\n        \n        return h\n\n    def calculate_mismatch(params):\n        \"\"\"Computes the mismatch for a single binary system.\"\"\"\n        m1, m2, chi1, chi2 = params\n        \n        delta_f = F_SAMP / N\n        freqs = np.arange(N / 2 + 1) * delta_f\n\n        h1 = generate_waveform(freqs, m1, m2, chi1, chi2, model_type=1)\n        h2 = generate_waveform(freqs, m1, m2, chi1, chi2, model_type=2)\n        Sn = get_ligo_psd(freqs)\n\n        # Denominator of overlap: norm of each waveform\n        integrand1 = np.divide(np.abs(h1)**2, Sn, where=Sn!=0, out=np.zeros_like(Sn))\n        integrand2 = np.divide(np.abs(h2)**2, Sn, where=Sn!=0, out=np.zeros_like(Sn))\n        \n        norm1_sq = np.sum(integrand1) * delta_f\n        norm2_sq = np.sum(integrand2) * delta_f\n\n        # Numerator of overlap: maximized over time and phase\n        cross_spectrum = np.divide(h1 * np.conj(h2), Sn, where=Sn!=0, out=np.zeros_like(Sn, dtype=np.complex128))\n    \n        X = np.zeros(N, dtype=np.complex128)\n        X[:len(cross_spectrum)] = cross_spectrum\n        \n        # IFFT scaling: multiply by N * df = f_samp to match integral def.\n        # This finds max_t | integral(Q(f) exp(i 2pi f t) df) |\n        time_series = np.fft.ifft(X) * F_SAMP\n        max_corr = np.max(np.abs(time_series))\n        \n        # Final overlap and mismatch calculation\n        # Factors of 4 from inner product definition cancel out\n        denominator = np.sqrt(norm1_sq * norm2_sq)\n        if denominator == 0:\n            return 1.0 # Mismatch is 1 if signals have no power in band\n        \n        overlap = max_corr / denominator\n        mismatch = 1.0 - overlap\n        return mismatch\n    \n    # --- Main Execution Logic ---\n    \n    test_cases = [\n        (30.0, 30.0, 0.2, 0.2),       # Case 1\n        (15.0, 10.0, 0.5, -0.3),      # Case 2\n        (1.4, 1.3, 0.02, -0.01),     # Case 3\n        (35.0, 20.0, 0.95, 0.8),       # Case 4\n    ]\n\n    results = []\n    for case in test_cases:\n        mismatch_val = calculate_mismatch(case)\n        results.append(f\"{mismatch_val:.6f}\")\n\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3488789"}, {"introduction": "General Relativity makes the stringent prediction that the entire evolution of a binary black hole system is self-determined; the physics of the early inspiral dictates the properties of the final remnant black hole. We can test this by performing an inspiral-merger-ringdown (IMR) consistency test, where we infer the final black hole's mass and spin from the inspiral portion of the signal and independently from the ringdown portion, then check if the results agree. This exercise [@problem_id:3488813] guides you through a complete, albeit simplified, version of this test using a Bayesian framework. By propagating uncertainties from synthetic measurements and calculating the Bayes factor for consistency versus inconsistency, you will gain practical insight into one of the most powerful null tests of GR.", "problem": "Implement a complete and runnable program that performs a simplified inspiral–merger–ringdown (IMR) consistency test of General Relativity (GR) using a synthetic dataset, by propagating measurement uncertainties through inspiral and ringdown inference and computing the Bayes factor for the hypothesis of consistency versus inconsistency between the inspiral-predicted and ringdown-inferred final black hole spin. Work entirely in geometric units where the gravitational constant and the speed of light satisfy $G = c = 1$, and express all quantities in dimensionless form. The final output must be a single line with the results for all test cases as a comma-separated list enclosed in square brackets. The values in the list must be the Bayes factors (floats).\n\nYou must construct the test on the following physical and statistical bases, using only the definitions and well-tested formulas given here, without introducing any additional empirical fitting beyond those specified. The test targets the dimensionless final spin parameter $a \\in (0,1)$ of the remnant black hole. The inspiral-measured parameter is the symmetric mass ratio $\\eta \\in (0,0.25]$, and the ringdown-measured quantities are the dimensionless dominant quasi-normal mode (QNM) frequency $\\hat{\\omega}$ and the dimensionless damping time $\\hat{\\tau}$. The program must compute a Bayes factor that quantifies the evidence for the hypothesis that the inspiral and ringdown are consistent with a single common final spin $a$ (hypothesis $\\mathcal{H}_{\\mathrm{c}}$) versus the hypothesis that the inspiral and ringdown prefer different final spins (hypothesis $\\mathcal{H}_{\\mathrm{i}}$).\n\nFundamental base and modeling assumptions to use:\n- The inspiral summary parameter is the symmetric mass ratio $\\eta \\equiv \\frac{m_1 m_2}{(m_1 + m_2)^2}$, and the nonspinning final spin of the remnant is approximated by the well-tested fit\n$$\na(\\eta) \\equiv a_{\\mathrm{f}}(\\eta) = \\sqrt{12}\\,\\eta - 3.871\\,\\eta^2.\n$$\n- The dominant Kerr black hole QNM ($\\ell = m = 2, n = 0$) dimensionless frequency and quality factor as functions of the final spin $a$ are given by the standard Berti–Cardoso–Will fits\n$$\n\\hat{\\omega}(a) = 1.5251 - 1.1568\\,\\bigl(1 - a\\bigr)^{0.1292}, \\quad\nQ(a) = 0.7000 + 1.4187\\,\\bigl(1 - a\\bigr)^{-0.4990}.\n$$\n- The dimensionless damping time is\n$$\n\\hat{\\tau}(a) = \\frac{2\\,Q(a)}{\\hat{\\omega}(a)}.\n$$\n- Inspiral measurement model: a single Gaussian measurement of $\\eta$ with mean $\\bar{\\eta}$ and standard deviation $\\sigma_{\\eta}$. Propagate this uncertainty to $a$ using linear uncertainty propagation with the derivative $\\frac{da}{d\\eta}$ evaluated at $\\bar{\\eta}$, yielding a Gaussian $a_{\\mathrm{I}} \\sim \\mathcal{N}(\\mu_{\\mathrm{I}}, \\sigma_{\\mathrm{I}}^2)$ where $\\mu_{\\mathrm{I}} = a(\\bar{\\eta})$ and $\\sigma_{\\mathrm{I}} = \\left|\\frac{da}{d\\eta}(\\bar{\\eta})\\right| \\sigma_{\\eta}$.\n- Ringdown measurement model: a two-dimensional Gaussian measurement of $\\mathbf{y} \\equiv (\\hat{\\omega}, \\hat{\\tau})$ with mean $\\bar{\\mathbf{y}}$ and diagonal covariance $\\Sigma_{\\mathrm{R}} = \\text{diag}(\\sigma_{\\hat{\\omega}}^2, \\sigma_{\\hat{\\tau}}^2)$. Infer $a$ by minimizing the weighted least-squares misfit\n$$\n\\chi^2(a) = \\bigl(\\bar{\\mathbf{y}} - \\mathbf{g}(a)\\bigr)^{\\top} \\Sigma_{\\mathrm{R}}^{-1} \\bigl(\\bar{\\mathbf{y}} - \\mathbf{g}(a)\\bigr),\n$$\nwhere $\\mathbf{g}(a) = (\\hat{\\omega}(a), \\hat{\\tau}(a))$. Approximate the ringdown posterior for $a$ as Gaussian $a_{\\mathrm{R}} \\sim \\mathcal{N}(\\mu_{\\mathrm{R}}, \\sigma_{\\mathrm{R}}^2)$, where $\\mu_{\\mathrm{R}}$ is the minimizer of $\\chi^2(a)$ over $a \\in (0,1)$ and\n$$\n\\sigma_{\\mathrm{R}}^2 \\approx \\Bigl(J^{\\top} \\Sigma_{\\mathrm{R}}^{-1} J\\Bigr)^{-1}\\Bigr|_{a = \\mu_{\\mathrm{R}}},\n$$\nwith sensitivity vector $J = \\frac{d\\mathbf{g}}{da} = \\left(\\frac{d\\hat{\\omega}}{da}, \\frac{d\\hat{\\tau}}{da}\\right)$ evaluated at $a = \\mu_{\\mathrm{R}}$. Numerical finite differences are acceptable for computing $J$.\n- Bayesian model comparison with a Gaussian prior for $a$: adopt a prior $a \\sim \\mathcal{N}(\\mu_0, \\sigma_0^2)$ with mean $\\mu_0$ and standard deviation $\\sigma_0$, truncated notionally to $(0,1)$ but used in its non-truncated Gaussian form for analytic tractability.\n- Under the consistency hypothesis $\\mathcal{H}_{\\mathrm{c}}$, both measurements share the same $a$, and the evidence is the one-dimensional integral\n$$\nZ_{\\mathrm{c}} = \\int_{-\\infty}^{+\\infty} \\mathcal{N}\\bigl(a; \\mu_{\\mathrm{I}}, \\sigma_{\\mathrm{I}}^2\\bigr)\\,\\mathcal{N}\\bigl(a; \\mu_{\\mathrm{R}}, \\sigma_{\\mathrm{R}}^2\\bigr)\\,\\mathcal{N}\\bigl(a; \\mu_0, \\sigma_0^2\\bigr)\\, da.\n$$\n- Under the inconsistency hypothesis $\\mathcal{H}_{\\mathrm{i}}$, the inspiral and ringdown are governed by independent spins $a_{\\mathrm{I}}$ and $a_{\\mathrm{R}}$ drawn from the same prior, so the evidence factorizes as\n$$\nZ_{\\mathrm{i}} = \\left[\\int_{-\\infty}^{+\\infty} \\mathcal{N}\\bigl(a_{\\mathrm{I}}; \\mu_{\\mathrm{I}}, \\sigma_{\\mathrm{I}}^2\\bigr)\\,\\mathcal{N}\\bigl(a_{\\mathrm{I}}; \\mu_0, \\sigma_0^2\\bigr)\\, da_{\\mathrm{I}}\\right]\\,\n\\left[\\int_{-\\infty}^{+\\infty} \\mathcal{N}\\bigl(a_{\\mathrm{R}}; \\mu_{\\mathrm{R}}, \\sigma_{\\mathrm{R}}^2\\bigr)\\,\\mathcal{N}\\bigl(a_{\\mathrm{R}}; \\mu_0, \\sigma_0^2\\bigr)\\, da_{\\mathrm{R}}\\right].\n$$\n- The Bayes factor is $K \\equiv \\frac{Z_{\\mathrm{c}}}{Z_{\\mathrm{i}}}$.\n\nSynthetic data construction for the test suite:\n- For each test, define a true symmetric mass ratio $\\eta_{\\text{true}}$, construct the true final spin $a_{\\text{true}} = a(\\eta_{\\text{true}})$, and define a ringdown bias $\\delta a$ to set the ringdown mean spin $a_{\\text{RD}} = a_{\\text{true}} + \\delta a$.\n- Set the ringdown mean measurements to the noise-free model values at $a_{\\text{RD}}$:\n$$\n\\bar{\\hat{\\omega}} = \\hat{\\omega}(a_{\\text{RD}}), \\quad \\bar{\\hat{\\tau}} = \\hat{\\tau}(a_{\\text{RD}}).\n$$\n- The inspiral mean measurement of $\\eta$ is $\\bar{\\eta}$ with standard deviation $\\sigma_{\\eta}$; propagate to $(\\mu_{\\mathrm{I}}, \\sigma_{\\mathrm{I}})$ as specified above.\n- Use a Gaussian prior with mean $\\mu_0$ and standard deviation $\\sigma_0$.\n\nNumerical requirements:\n- Implement robust one-dimensional minimization of $\\chi^2(a)$ over $a \\in (0,1)$ to find $\\mu_{\\mathrm{R}}$.\n- Use numerical central finite differences with a small step to compute $J$.\n- Compute the one-dimensional Gaussian evidence integrals in closed form.\n- All quantities are dimensionless; no physical unit conversion is required.\n- Your program must produce a single line of output containing the Bayes factors for all test cases as a comma-separated list enclosed in square brackets, for example, $[\\text{value}_1,\\text{value}_2,\\text{value}_3]$.\n\nPrior specification (common to all tests):\n- $\\mu_0 = 0.7$,\n- $\\sigma_0 = 0.3$.\n\nTest suite:\n- Test $1$ (happy path, consistent, equal-mass–like):\n  - $\\eta_{\\text{true}} = 0.25$, $\\delta a = 0.0$,\n  - $\\bar{\\eta} = 0.248$, $\\sigma_{\\eta} = 0.004$,\n  - $\\sigma_{\\hat{\\omega}} = 0.003$, $\\sigma_{\\hat{\\tau}} = 0.2$.\n- Test $2$ (inconsistent ringdown bias, moderate mass ratio):\n  - $\\eta_{\\text{true}} = 0.20$, $\\delta a = 0.10$,\n  - $\\bar{\\eta} = 0.202$, $\\sigma_{\\eta} = 0.004$,\n  - $\\sigma_{\\hat{\\omega}} = 0.003$, $\\sigma_{\\hat{\\tau}} = 0.2$.\n- Test $3$ (edge case with weak inspiral and strong ringdown):\n  - $\\eta_{\\text{true}} = 0.24$, $\\delta a = 0.0$,\n  - $\\bar{\\eta} = 0.235$, $\\sigma_{\\eta} = 0.020$,\n  - $\\sigma_{\\hat{\\omega}} = 0.001$, $\\sigma_{\\hat{\\tau}} = 0.05$.\n\nFinal output format:\n- Your program must print exactly one line to standard output: a single list in the form $[K_1,K_2,K_3]$, where $K_i$ is the Bayes factor for test $i$ computed as specified above. No extra spaces or text are allowed.", "solution": "We begin by formalizing the quantities and the flow from measurements to a Bayes factor. All mathematical symbols and numbers are presented in LaTeX.\n\nDefinitions and measurement models:\n- The symmetric mass ratio is $\\eta = \\frac{m_1 m_2}{(m_1 + m_2)^2}$ and satisfies $\\eta \\in (0, 0.25]$. For nonspinning progenitors, the final Kerr spin $a$ is approximated by the well-tested relation\n$$\na(\\eta) = \\sqrt{12}\\,\\eta - 3.871\\,\\eta^2,\n$$\nwhich recovers $a \\approx 0.686$ at $\\eta = 0.25$.\n\n- The dominant Kerr quasi-normal mode (QNM) dimensionless frequency and quality factor as functions of the final spin $a$ are given by\n$$\n\\hat{\\omega}(a) = 1.5251 - 1.1568 \\bigl(1-a\\bigr)^{0.1292}, \\quad\nQ(a) = 0.7000 + 1.4187 \\bigl(1-a\\bigr)^{-0.4990},\n$$\nand the dimensionless damping time is\n$$\n\\hat{\\tau}(a) = \\frac{2 Q(a)}{\\hat{\\omega}(a)}.\n$$\n\n- Inspiral measurement: a Gaussian measurement of $\\eta$ with mean $\\bar{\\eta}$ and standard deviation $\\sigma_{\\eta}$ is propagated to a Gaussian estimate of $a$ via linearization. We compute the mean\n$$\n\\mu_{\\mathrm{I}} = a(\\bar{\\eta}),\n$$\nand the standard deviation\n$$\n\\sigma_{\\mathrm{I}} = \\left|\\frac{da}{d\\eta}(\\bar{\\eta})\\right| \\sigma_{\\eta}, \\quad \\frac{da}{d\\eta} = \\sqrt{12} - 2 \\cdot 3.871 \\, \\eta.\n$$\nThis uses first-order uncertainty propagation, which is valid for sufficiently small $\\sigma_{\\eta}$.\n\n- Ringdown measurement: a two-dimensional Gaussian observation $\\bar{\\mathbf{y}} = \\bigl(\\bar{\\hat{\\omega}}, \\bar{\\hat{\\tau}}\\bigr)$ with diagonal covariance $\\Sigma_{\\mathrm{R}} = \\mathrm{diag}(\\sigma_{\\hat{\\omega}}^2, \\sigma_{\\hat{\\tau}}^2)$ informs the parameter $a$ via the mapping $\\mathbf{g}(a) = \\bigl(\\hat{\\omega}(a), \\hat{\\tau}(a)\\bigr)$. We define the misfit\n$$\n\\chi^2(a) = \\bigl(\\bar{\\mathbf{y}} - \\mathbf{g}(a)\\bigr)^{\\top} \\Sigma_{\\mathrm{R}}^{-1} \\bigl(\\bar{\\mathbf{y}} - \\mathbf{g}(a)\\bigr),\n$$\nand choose\n$$\n\\mu_{\\mathrm{R}} = \\operatorname*{arg\\,min}_{a \\in (0,1)} \\chi^2(a).\n$$\nThe posterior variance from the local Gaussian approximation is given by the inverse Fisher information:\n$$\n\\sigma_{\\mathrm{R}}^2 \\approx \\Bigl(J^{\\top} \\Sigma_{\\mathrm{R}}^{-1} J\\Bigr)^{-1} \\Big|_{a = \\mu_{\\mathrm{R}}}, \\quad J = \\frac{d\\mathbf{g}}{da} = \\left(\\frac{d\\hat{\\omega}}{da}, \\frac{d\\hat{\\tau}}{da}\\right).\n$$\nWe compute $J$ numerically by central finite differences with a small step $h$, namely\n$$\n\\frac{d\\hat{\\omega}}{da}(a) \\approx \\frac{\\hat{\\omega}(a + h) - \\hat{\\omega}(a - h)}{2 h}, \\quad \\frac{d\\hat{\\tau}}{da}(a) \\approx \\frac{\\hat{\\tau}(a + h) - \\hat{\\tau}(a - h)}{2 h}.\n$$\n\n- Bayesian model comparison: adopt a prior $a \\sim \\mathcal{N}(\\mu_0, \\sigma_0^2)$ with $\\mu_0 = 0.7$ and $\\sigma_0 = 0.3$. Under the consistency hypothesis $\\mathcal{H}_{\\mathrm{c}}$, the evidence is\n$$\nZ_{\\mathrm{c}} = \\int_{-\\infty}^{+\\infty} \\mathcal{N}\\bigl(a; \\mu_{\\mathrm{I}}, \\sigma_{\\mathrm{I}}^2\\bigr)\\,\\mathcal{N}\\bigl(a; \\mu_{\\mathrm{R}}, \\sigma_{\\mathrm{R}}^2\\bigr)\\,\\mathcal{N}\\bigl(a; \\mu_0, \\sigma_0^2\\bigr)\\, da.\n$$\nUnder the inconsistency hypothesis $\\mathcal{H}_{\\mathrm{i}}$, with independent $a_{\\mathrm{I}}$ and $a_{\\mathrm{R}}$, the evidence factorizes:\n$$\nZ_{\\mathrm{i}} = \\left[\\int_{-\\infty}^{+\\infty} \\mathcal{N}\\bigl(a_{\\mathrm{I}}; \\mu_{\\mathrm{I}}, \\sigma_{\\mathrm{I}}^2\\bigr)\\,\\mathcal{N}\\bigl(a_{\\mathrm{I}}; \\mu_0, \\sigma_0^2\\bigr)\\, da_{\\mathrm{I}}\\right]\\,\n\\left[\\int_{-\\infty}^{+\\infty} \\mathcal{N}\\bigl(a_{\\mathrm{R}}; \\mu_{\\mathrm{R}}, \\sigma_{\\mathrm{R}}^2\\bigr)\\,\\mathcal{N}\\bigl(a_{\\mathrm{R}}; \\mu_0, \\sigma_0^2\\bigr)\\, da_{\\mathrm{R}}\\right].\n$$\n\nClosed-form evidences for Gaussian products:\n- The product of Gaussians in $a$ remains Gaussian in $a$. Let us define precisions $\\lambda_{\\mathrm{I}} = \\sigma_{\\mathrm{I}}^{-2}$, $\\lambda_{\\mathrm{R}} = \\sigma_{\\mathrm{R}}^{-2}$, and $\\lambda_0 = \\sigma_0^{-2}$. The integral for $Z_{\\mathrm{c}}$ can be written by completing the square. The exponent’s quadratic form is\n$$\n\\frac{(a - \\mu_{\\mathrm{I}})^2}{\\sigma_{\\mathrm{I}}^2} + \\frac{(a - \\mu_{\\mathrm{R}})^2}{\\sigma_{\\mathrm{R}}^2} + \\frac{(a - \\mu_0)^2}{\\sigma_0^2} = \\Lambda\\, a^2 - 2 b\\, a + c,\n$$\nwhere\n$$\n\\Lambda = \\lambda_{\\mathrm{I}} + \\lambda_{\\mathrm{R}} + \\lambda_0, \\quad b = \\lambda_{\\mathrm{I}} \\mu_{\\mathrm{I}} + \\lambda_{\\mathrm{R}} \\mu_{\\mathrm{R}} + \\lambda_0 \\mu_0, \\quad c = \\lambda_{\\mathrm{I}} \\mu_{\\mathrm{I}}^2 + \\lambda_{\\mathrm{R}} \\mu_{\\mathrm{R}}^2 + \\lambda_0 \\mu_0^2.\n$$\nCompleting the square with posterior mean $m = b/\\Lambda$, the integral yields\n$$\nZ_{\\mathrm{c}} = \\frac{1}{(2\\pi)\\,\\sigma_{\\mathrm{I}}\\,\\sigma_{\\mathrm{R}}\\,\\sigma_0} \\cdot \\frac{1}{\\sqrt{\\Lambda}} \\cdot \\exp\\left( -\\frac{1}{2}\\left[c - \\frac{b^2}{\\Lambda}\\right] \\right).\n$$\n\n- Each factor in $Z_{\\mathrm{i}}$ is a convolution integral of two Gaussians, giving\n$$\n\\int \\mathcal{N}(a; \\mu, \\sigma^2) \\mathcal{N}(a; \\mu_0, \\sigma_0^2)\\, da = \\mathcal{N}(\\mu; \\mu_0, \\sigma^2 + \\sigma_0^2) = \\frac{1}{\\sqrt{2\\pi(\\sigma^2 + \\sigma_0^2)}} \\exp\\left( -\\frac{1}{2} \\frac{(\\mu - \\mu_0)^2}{\\sigma^2 + \\sigma_0^2} \\right).\n$$\nTherefore,\n$$\nZ_{\\mathrm{i}} = \\frac{1}{2\\pi \\sqrt{(\\sigma_{\\mathrm{I}}^2 + \\sigma_0^2)(\\sigma_{\\mathrm{R}}^2 + \\sigma_0^2)}} \\exp\\left( -\\frac{1}{2} \\left[ \\frac{(\\mu_{\\mathrm{I}} - \\mu_0)^2}{\\sigma_{\\mathrm{I}}^2 + \\sigma_0^2} + \\frac{(\\mu_{\\mathrm{R}} - \\mu_0)^2}{\\sigma_{\\mathrm{R}}^2 + \\sigma_0^2} \\right] \\right).\n$$\n\nBayes factor:\n- The Bayes factor is\n$$\nK = \\frac{Z_{\\mathrm{c}}}{Z_{\\mathrm{i}}}.\n$$\nPlugging the expressions derived above gives a closed form that can be computed directly from $(\\mu_{\\mathrm{I}}, \\sigma_{\\mathrm{I}})$, $(\\mu_{\\mathrm{R}}, \\sigma_{\\mathrm{R}})$, and $(\\mu_0, \\sigma_0)$.\n\nSynthetic data generation for each test:\n- For each test, we set $\\eta_{\\mathrm{true}}$ and compute $a_{\\mathrm{true}} = a(\\eta_{\\mathrm{true}})$. A ringdown bias $\\delta a$ is applied to construct the ringdown mean spin $a_{\\mathrm{RD}} = a_{\\mathrm{true}} + \\delta a$. We then set the ringdown means to the model predictions\n$$\n\\bar{\\hat{\\omega}} = \\hat{\\omega}(a_{\\mathrm{RD}}), \\quad \\bar{\\hat{\\tau}} = \\hat{\\tau}(a_{\\mathrm{RD}}).\n$$\nThe inspiral mean for $\\eta$ is given as $\\bar{\\eta}$ with standard deviation $\\sigma_{\\eta}$, from which we compute $\\mu_{\\mathrm{I}}$ and $\\sigma_{\\mathrm{I}}$ via the linearization.\n\nAlgorithmic steps:\n- For each test case,\n  - Compute $a_{\\mathrm{true}} = a(\\eta_{\\mathrm{true}})$ and $a_{\\mathrm{RD}} = a_{\\mathrm{true}} + \\delta a$.\n  - Compute ringdown means $\\bar{\\hat{\\omega}}$ and $\\bar{\\hat{\\tau}}$ using the provided QNM fits.\n  - Compute $\\mu_{\\mathrm{I}} = a(\\bar{\\eta})$ and $\\sigma_{\\mathrm{I}} = \\left|\\sqrt{12} - 2\\cdot 3.871 \\, \\bar{\\eta}\\right| \\sigma_{\\eta}$.\n  - Infer $\\mu_{\\mathrm{R}}$ by minimizing $\\chi^2(a)$ over $a \\in (0,1)$; compute $\\sigma_{\\mathrm{R}}^2 \\approx \\bigl(J^{\\top} \\Sigma_{\\mathrm{R}}^{-1} J\\bigr)^{-1}$ at $a = \\mu_{\\mathrm{R}}$ using numerical derivatives for $J$.\n  - Compute $Z_{\\mathrm{c}}$ and $Z_{\\mathrm{i}}$ using the closed-form expressions above with $\\mu_0 = 0.7$ and $\\sigma_0 = 0.3$.\n  - Return $K = Z_{\\mathrm{c}}/Z_{\\mathrm{i}}$.\n\nTest suite specifics:\n- Test $1$: $\\eta_{\\mathrm{true}} = 0.25$, $\\delta a = 0.0$, $\\bar{\\eta} = 0.248$, $\\sigma_{\\eta} = 0.004$, $\\sigma_{\\hat{\\omega}} = 0.003$, $\\sigma_{\\hat{\\tau}} = 0.2$.\n- Test $2$: $\\eta_{\\mathrm{true}} = 0.20$, $\\delta a = 0.10$, $\\bar{\\eta} = 0.202$, $\\sigma_{\\eta} = 0.004$, $\\sigma_{\\hat{\\omega}} = 0.003$, $\\sigma_{\\hat{\\tau}} = 0.2$.\n- Test $3$: $\\eta_{\\mathrm{true}} = 0.24$, $\\delta a = 0.0$, $\\bar{\\eta} = 0.235$, $\\sigma_{\\eta} = 0.020$, $\\sigma_{\\hat{\\omega}} = 0.001$, $\\sigma_{\\hat{\\tau}} = 0.05$.\n\nThe program must assemble the Bayes factors for the three tests into a single list and print it exactly in the format $[K_1,K_2,K_3]$ on one line, with no extra text.\n\nThis procedure tests the General Relativity (GR) hypothesis that a single final spin parameter $a$ explains both the inspiral and ringdown measurements. A large Bayes factor $K$ supports consistency, while a small $K$ supports inconsistency. The design covers a happy path (Test $1$), a deliberately inconsistent scenario (Test $2$), and an edge case with weak inspiral but strong ringdown information (Test $3$).", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import minimize_scalar\n\ndef final_spin_from_eta(eta: float) - float:\n    # a(eta) = sqrt(12)*eta - 3.871*eta^2\n    return np.sqrt(12.0) * eta - 3.871 * eta**2\n\ndef da_deta(eta: float) - float:\n    # derivative of final spin wrt eta: sqrt(12) - 2*3.871*eta\n    return np.sqrt(12.0) - 2.0 * 3.871 * eta\n\ndef omega_hat(a: float) - float:\n    # Dimensionless QNM frequency fit\n    return 1.5251 - 1.1568 * (1.0 - a)**0.1292\n\ndef Q_factor(a: float) - float:\n    # Quality factor fit\n    return 0.7000 + 1.4187 * (1.0 - a)**(-0.4990)\n\ndef tau_hat(a: float) - float:\n    # Dimensionless damping time\n    w = omega_hat(a)\n    Q = Q_factor(a)\n    return 2.0 * Q / w\n\ndef g_vec(a: float) - np.ndarray:\n    return np.array([omega_hat(a), tau_hat(a)])\n\ndef chi2(a: float, ybar: np.ndarray, inv_cov: np.ndarray) - float:\n    # Enforce bounds inside minimization; if outside (0,1), penalize\n    if not (0.0  a  1.0):\n        return 1e9 + (a - 0.5)**2\n    r = ybar - g_vec(a)\n    return float(r.T @ inv_cov @ r)\n\ndef numerical_J(a: float, h: float = 1e-6) - np.ndarray:\n    # Central finite differences for derivatives of omega_hat and tau_hat wrt a\n    ap = min(a + h, 1.0 - 1e-9)\n    am = max(a - h, 1e-9)\n    gp = g_vec(ap)\n    gm = g_vec(am)\n    return (gp - gm) / (ap - am)\n\ndef infer_ringdown_posterior(ybar: np.ndarray, sigmas: np.ndarray) - tuple[float, float]:\n    # ybar = [omega_hat_mean, tau_hat_mean]; sigmas = [sigma_omega, sigma_tau]\n    cov = np.diag(sigmas**2)\n    inv_cov = np.diag(1.0 / (sigmas**2))\n    # Minimize chi^2 over a in (0,1)\n    res = minimize_scalar(lambda a: chi2(a, ybar, inv_cov), bounds=(0.0, 1.0), method='bounded')\n    a_hat = float(res.x)\n    # Fisher information for variance\n    J = numerical_J(a_hat)\n    F = float(J.T @ inv_cov @ J)\n    # Guard against numerical issues\n    if F = 0.0 or not np.isfinite(F):\n        # Fall back to a small variance to avoid division by zero; but keep finite\n        var = 1e6\n    else:\n        var = 1.0 / F\n    return a_hat, var\n\ndef gaussian_evidence_consistent(muI: float, sigI: float, muR: float, sigR: float, mu0: float, sig0: float) - float:\n    # Z_c = (1/((2π) σI σR σ0)) * (1/sqrt(Λ)) * exp(-0.5*(c - b^2/Λ))\n    lamI = 1.0 / (sigI**2)\n    lamR = 1.0 / (sigR**2)\n    lam0 = 1.0 / (sig0**2)\n    Lam = lamI + lamR + lam0\n    b = lamI * muI + lamR * muR + lam0 * mu0\n    c = lamI * muI**2 + lamR * muR**2 + lam0 * mu0**2\n    pref = 1.0 / ((2.0 * np.pi) * sigI * sigR * sig0)\n    val = pref * (1.0 / np.sqrt(Lam)) * np.exp(-0.5 * (c - (b**2) / Lam))\n    return float(val)\n\ndef gaussian_evidence_inconsistent(muI: float, sigI: float, muR: float, sigR: float, mu0: float, sig0: float) - float:\n    # Z_i = [N(muI; mu0, sigI^2+sig0^2)] * [N(muR; mu0, sigR^2+sig0^2)]\n    sI2 = sigI**2 + sig0**2\n    sR2 = sigR**2 + sig0**2\n    prefI = 1.0 / np.sqrt(2.0 * np.pi * sI2)\n    prefR = 1.0 / np.sqrt(2.0 * np.pi * sR2)\n    expI = np.exp(-0.5 * ((muI - mu0)**2) / sI2)\n    expR = np.exp(-0.5 * ((muR - mu0)**2) / sR2)\n    return float(prefI * expI * prefR * expR)\n\ndef bayes_factor(muI: float, sigI: float, muR: float, sigR: float, mu0: float, sig0: float) - float:\n    Zc = gaussian_evidence_consistent(muI, sigI, muR, sigR, mu0, sig0)\n    Zi = gaussian_evidence_inconsistent(muI, sigI, muR, sigR, mu0, sig0)\n    # Avoid division by zero\n    if Zi == 0.0 or not np.isfinite(Zi):\n        return float('inf')\n    return Zc / Zi\n\ndef solve():\n    # Prior parameters\n    mu0 = 0.7\n    sig0 = 0.3\n\n    # Define the test cases from the problem statement.\n    # Each test case: (eta_true, delta_a, eta_bar, sigma_eta, sigma_omega_hat, sigma_tau_hat)\n    test_cases = [\n        (0.25, 0.0, 0.248, 0.004, 0.003, 0.2),   # Test 1\n        (0.20, 0.10, 0.202, 0.004, 0.003, 0.2),  # Test 2\n        (0.24, 0.0, 0.235, 0.020, 0.001, 0.05),  # Test 3\n    ]\n\n    results = []\n    for (eta_true, delta_a, eta_bar, sigma_eta, sigma_omega, sigma_tau) in test_cases:\n        # True and ringdown-bias spins\n        a_true = final_spin_from_eta(eta_true)\n        a_rd = a_true + delta_a\n        # Ringdown mean observables\n        ybar = np.array([omega_hat(a_rd), tau_hat(a_rd)])\n        sigmas = np.array([sigma_omega, sigma_tau])\n\n        # Inspiral mean and sigma\n        mu_I = final_spin_from_eta(eta_bar)\n        dade = da_deta(eta_bar)\n        sig_I = abs(dade) * sigma_eta\n        # Guard: ensure positive non-zero sigma\n        sig_I = max(sig_I, 1e-9)\n\n        # Ringdown posterior approximation\n        mu_R, var_R = infer_ringdown_posterior(ybar, sigmas)\n        sig_R = np.sqrt(max(var_R, 1e-18))\n\n        # Bayes factor\n        K = bayes_factor(mu_I, sig_I, mu_R, sig_R, mu0, sig0)\n        results.append(K)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3488813"}, {"introduction": "Suppose a test for deviations from GR reveals an unexpected excess of power in the residual data or a glaring inconsistency between inspiral and ringdown. Is this a discovery of new physics or merely a random statistical fluctuation? This question can only be answered within a rigorous statistical framework. This practice [@problem_id:3488777] explores the calculation of statistical significance, or $p$-value, for an observed excess using the chi-squared distribution as a model for residual power. Furthermore, it addresses the critical \"look-elsewhere effect,\" teaching you how to correctly interpret significance when a search has been conducted across many independent windows, a crucial skill for claiming a robust detection and avoiding false alarms.", "problem": "A gravitational-wave event from a binary black hole coalescence is analyzed to test General Relativity (GR) in the merger regime using a residual-power diagnostic. Let the strain data in a single detector be modeled as $d(t) = h_{\\mathrm{GR}}(t;\\hat{\\theta}) + n(t)$, where $h_{\\mathrm{GR}}(t;\\hat{\\theta})$ is the best-fit GR waveform at maximum likelihood parameters $\\hat{\\theta}$ and $n(t)$ is a zero-mean, Gaussian, stationary noise process characterized by a one-sided Power Spectral Density (PSD) $S_{n}(f)$. Define the noise-weighted inner product between two time series $a(t)$ and $b(t)$ by\n$$\n(a|b) \\equiv 4 \\,\\Re \\int_{0}^{\\infty} \\frac{\\tilde{a}(f)\\,\\tilde{b}^{*}(f)}{S_{n}(f)}\\,\\mathrm{d}f,\n$$\nwhere $\\tilde{a}(f)$ denotes the Fourier transform of $a(t)$ and $^{*}$ denotes complex conjugation. The residual is $r(t) \\equiv d(t) - h_{\\mathrm{GR}}(t;\\hat{\\theta})$.\n\nUnder the null hypothesis that GR is correct and the model $h_{\\mathrm{GR}}$ captures the true signal, $r(t)$ is distributed as Gaussian noise. Consider a narrow merger time-frequency window $\\mathcal{W}$ that admits $k$ effectively independent, orthonormal, whitened basis components with unit variance when projected using the inner product above. In such a window, the residual power statistic is\n$$\n\\rho \\equiv (r|r)_{\\mathcal{W}},\n$$\nwhich, under the null hypothesis, is distributed as a $\\chi^2$ random variable with $k$ degrees of freedom.\n\nSuppose the merger window $\\mathcal{W}$ is constructed to contain $k=4$ effectively independent degrees of freedom (e.g., two independent Fourier bins, each with two orthogonal quadratures after whitening). In one such window, the observed value is $\\rho_{\\mathrm{obs}}=20$. The local significance of this excess is quantified by the upper-tail probability $p_{\\mathrm{local}}=\\mathbb{P}(\\chi^{2}_{k} \\ge \\rho_{\\mathrm{obs}})$ under the null.\n\nA look-elsewhere study is performed by scanning across $M=50$ disjoint merger sub-windows of the same construction, each producing an independent realization of $\\rho$. The global significance against the null is defined as the probability that at least one of the $M$ windows produces a value exceeding $\\rho_{\\mathrm{obs}}$ under the null.\n\nStarting only from the definitions above and the standard properties of Gaussian random variables and chi-squared distributions, do the following:\n\n1. Derive an explicit expression for $p_{\\mathrm{local}}$ in terms of $\\rho_{\\mathrm{obs}}$ for $k=4$.\n2. Using independence across windows, derive an explicit expression for the global $p$-value $p_{\\mathrm{global}}$ in terms of $p_{\\mathrm{local}}$ and $M$.\n3. Evaluate $p_{\\mathrm{global}}$ numerically for $\\rho_{\\mathrm{obs}}=20$, $k=4$, and $M=50$.\n\nExpress the final answer as a single decimal number equal to $p_{\\mathrm{global}}$, rounded to three significant figures. Do not include any units in your final answer.", "solution": "The user wants me to solve a problem related to the statistical analysis of gravitational wave data.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n*   Strain data model: $d(t) = h_{\\mathrm{GR}}(t;\\hat{\\theta}) + n(t)$.\n*   $h_{\\mathrm{GR}}(t;\\hat{\\theta})$ is the best-fit General Relativity (GR) waveform.\n*   $n(t)$ is zero-mean, Gaussian, stationary noise with one-sided Power Spectral Density (PSD) $S_{n}(f)$.\n*   Noise-weighted inner product: $(a|b) \\equiv 4 \\,\\Re \\int_{0}^{\\infty} \\frac{\\tilde{a}(f)\\,\\tilde{b}^{*}(f)}{S_{n}(f)}\\,\\mathrm{d}f$.\n*   Residual: $r(t) \\equiv d(t) - h_{\\mathrm{GR}}(t;\\hat{\\theta})$.\n*   Null hypothesis: $r(t)$ is distributed as Gaussian noise.\n*   Residual power statistic: $\\rho \\equiv (r|r)_{\\mathcal{W}}$.\n*   Under the null hypothesis, $\\rho$ is distributed as a chi-squared random variable, $\\chi^{2}_{k}$, with $k$ degrees of freedom.\n*   Number of degrees of freedom in the merger window: $k=4$.\n*   Observed residual power: $\\rho_{\\mathrm{obs}}=20$.\n*   Definition of local p-value: $p_{\\mathrm{local}}=\\mathbb{P}(\\chi^{2}_{k} \\ge \\rho_{\\mathrm{obs}})$.\n*   Number of disjoint, independent sub-windows for the look-elsewhere study: $M=50$.\n*   Definition of global p-value: the probability that at least one of the $M$ windows produces a value exceeding $\\rho_{\\mathrm{obs}}$.\n\n**Step 2: Validate Using Extracted Givens**\n\nThe problem statement is scientifically grounded, well-posed, and objective. It describes a standard procedure in gravitational-wave data analysis for testing the consistency of observed data with the predictions of General Relativity. The statistical framework (chi-squared test, p-values, look-elsewhere effect) is correctly formulated. All definitions and numerical values are provided, are free of contradictions, and are physically plausible within the context of the problem. The problem does not violate any of the specified invalidity criteria.\n\n**Step 3: Verdict and Action**\n\nThe problem is valid. A complete solution will be provided.\n\n### Solution\n\nThe solution is divided into three parts as requested by the problem statement.\n\n**1. Derivation of an explicit expression for $p_{\\mathrm{local}}$**\n\nThe local p-value, $p_{\\mathrm{local}}$, is the probability of observing a residual power greater than or equal to $\\rho_{\\mathrm{obs}}$ under the null hypothesis. The problem states that the statistic $\\rho$ follows a chi-squared distribution with $k$ degrees of freedom, denoted $\\chi^2_k$. Thus, we have:\n$$\np_{\\mathrm{local}} = \\mathbb{P}(\\chi^{2}_{k} \\ge \\rho_{\\mathrm{obs}})\n$$\nThe probability density function (PDF) for a $\\chi^2_k$ random variable $x$ is given by:\n$$\nf(x; k) = \\frac{1}{2^{k/2} \\Gamma(k/2)} x^{k/2 - 1} \\exp\\left(-\\frac{x}{2}\\right)\n$$\nwhere $\\Gamma(z)$ is the gamma function. For this problem, we are given $k=4$. The gamma function value is $\\Gamma(k/2) = \\Gamma(4/2) = \\Gamma(2) = (2-1)! = 1! = 1$.\nSubstituting $k=4$ into the PDF, we get:\n$$\nf(x; 4) = \\frac{1}{2^{4/2} \\Gamma(2)} x^{4/2 - 1} \\exp\\left(-\\frac{x}{2}\\right) = \\frac{1}{4 \\cdot 1} x^{1} \\exp\\left(-\\frac{x}{2}\\right) = \\frac{1}{4} x \\exp\\left(-\\frac{x}{2}\\right)\n$$\nThe local p-value is the integral of this PDF from $\\rho_{\\mathrm{obs}}$ to infinity:\n$$\np_{\\mathrm{local}} = \\int_{\\rho_{\\mathrm{obs}}}^{\\infty} f(x; 4) \\, \\mathrm{d}x = \\int_{\\rho_{\\mathrm{obs}}}^{\\infty} \\frac{1}{4} x \\exp\\left(-\\frac{x}{2}\\right) \\, \\mathrm{d}x\n$$\nWe solve this integral using integration by parts, $\\int u \\, \\mathrm{d}v = uv - \\int v \\, \\mathrm{d}u$. Let $u = x$ and $\\mathrm{d}v = \\exp(-x/2) \\, \\mathrm{d}x$. Then $\\mathrm{d}u = \\mathrm{d}x$ and $v = -2 \\exp(-x/2)$.\n$$\n\\int x \\exp\\left(-\\frac{x}{2}\\right) \\, \\mathrm{d}x = x \\left(-2 \\exp\\left(-\\frac{x}{2}\\right)\\right) - \\int \\left(-2 \\exp\\left(-\\frac{x}{2}\\right)\\right) \\, \\mathrm{d}x\n$$\n$$\n= -2x \\exp\\left(-\\frac{x}{2}\\right) + 2 \\int \\exp\\left(-\\frac{x}{2}\\right) \\, \\mathrm{d}x = -2x \\exp\\left(-\\frac{x}{2}\\right) - 4 \\exp\\left(-\\frac{x}{2}\\right) = -2(x+2) \\exp\\left(-\\frac{x}{2}\\right)\n$$\nNow we evaluate the definite integral for $p_{\\mathrm{local}}$:\n$$\np_{\\mathrm{local}} = \\frac{1}{4} \\left[ -2(x+2) \\exp\\left(-\\frac{x}{2}\\right) \\right]_{\\rho_{\\mathrm{obs}}}^{\\infty}\n$$\nThe upper limit evaluates to $0$, since $\\lim_{x \\to \\infty} (x+2) \\exp(-x/2) = 0$.\n$$\np_{\\mathrm{local}} = \\frac{1}{4} \\left( 0 - \\left[-2(\\rho_{\\mathrm{obs}}+2) \\exp\\left(-\\frac{\\rho_{\\mathrm{obs}}}{2}\\right)\\right] \\right) = \\frac{2(\\rho_{\\mathrm{obs}}+2)}{4} \\exp\\left(-\\frac{\\rho_{\\mathrm{obs}}}{2}\\right)\n$$\nThe explicit expression for $p_{\\mathrm{local}}$ for $k=4$ is:\n$$\np_{\\mathrm{local}} = \\left(1 + \\frac{\\rho_{\\mathrm{obs}}}{2}\\right) \\exp\\left(-\\frac{\\rho_{\\mathrm{obs}}}{2}\\right)\n$$\n\n**2. Derivation of an explicit expression for $p_{\\mathrm{global}}$**\n\nThe global p-value, $p_{\\mathrm{global}}$, is the probability that at least one of the $M$ independent windows produces a value of $\\rho$ exceeding $\\rho_{\\mathrm{obs}}$. Let $E_i$ be the event that the $i$-th window has a residual power $\\rho_i \\ge \\rho_{\\mathrm{obs}}$. Under the null hypothesis, the probability of this event for any single window is $p_{\\mathrm{local}}$:\n$$\n\\mathbb{P}(E_i) = p_{\\mathrm{local}} \\quad \\text{for } i=1, \\dots, M\n$$\nWe wish to find the probability of the union of these events:\n$$\np_{\\mathrm{global}} = \\mathbb{P}(E_1 \\cup E_2 \\cup \\dots \\cup E_M)\n$$\nIt is simpler to calculate the probability of the complementary event: that none of the windows show an excess. This is the intersection of the complementary events $E_i^c$, where $\\mathbb{P}(E_i^c) = 1 - p_{\\mathrm{local}}$.\n$$\n1 - p_{\\mathrm{global}} = \\mathbb{P}(E_1^c \\cap E_2^c \\cap \\dots \\cap E_M^c)\n$$\nSince the $M$ windows are stated to be independent, the probability of the intersection is the product of the individual probabilities:\n$$\n1 - p_{\\mathrm{global}} = \\prod_{i=1}^{M} \\mathbb{P}(E_i^c) = \\prod_{i=1}^{M} (1 - p_{\\mathrm{local}}) = (1 - p_{\\mathrm{local}})^M\n$$\nTherefore, the explicit expression for the global p-value is:\n$$\np_{\\mathrm{global}} = 1 - (1 - p_{\\mathrm{local}})^M\n$$\n\n**3. Numerical evaluation of $p_{\\mathrm{global}}$**\n\nWe are given the values $\\rho_{\\mathrm{obs}}=20$, $k=4$, and $M=50$.\nFirst, we calculate $p_{\\mathrm{local}}$ using the expression derived in part 1:\n$$\np_{\\mathrm{local}} = \\left(1 + \\frac{20}{2}\\right) \\exp\\left(-\\frac{20}{2}\\right) = (1+10) \\exp(-10) = 11 \\exp(-10)\n$$\nNow, we substitute this into the expression for $p_{\\mathrm{global}}$ from part 2, with $M=50$:\n$$\np_{\\mathrm{global}} = 1 - (1 - 11 \\exp(-10))^{50}\n$$\nWe now evaluate this expression numerically.\n$$\n\\exp(-10) \\approx 4.539992976 \\times 10^{-5}\n$$\n$$\np_{\\mathrm{local}} = 11 \\times \\exp(-10) \\approx 11 \\times 4.539992976 \\times 10^{-5} \\approx 4.99399227 \\times 10^{-4}\n$$\n$$\n1 - p_{\\mathrm{local}} \\approx 1 - 4.99399227 \\times 10^{-4} \\approx 0.99950060077\n$$\n$$\n(1 - p_{\\mathrm{local}})^{50} \\approx (0.99950060077)^{50} \\approx 0.9753303603\n$$\n$$\np_{\\mathrm{global}} = 1 - (1 - p_{\\mathrm{local}})^{50} \\approx 1 - 0.9753303603 \\approx 0.0246696397\n$$\nRounding the final result to three significant figures, we get $0.0247$.", "answer": "$$\\boxed{0.0247}$$", "id": "3488777"}]}