{"hands_on_practices": [{"introduction": "A stress tensor provides a complete picture of the forces acting at a point within a material, but its nine components can be unwieldy. The true physical meaning is revealed by distilling it into its principal stresses and invariants, which are independent of the coordinate system used. This exercise [@problem_id:3615638] provides practice in this fundamental analysis, calculating the maximum, intermediate, and minimum normal stresses, and using invariants like the von Mises stress to get a single, powerful measure of the potential for the material to deform permanently.", "problem": "A small, homogeneous crustal rock element in a three-dimensional continuum is interrogated within a computational geophysics simulation. At a given quadrature point in the numerical discretization, the Cauchy stress tensor is measured to be\n$$\n\\boldsymbol{\\sigma}=\\begin{pmatrix}80 & 20 & 0 \\\\ 20 & 60 & 0 \\\\ 0 & 0 & 40\\end{pmatrix}\n$$\nin units of megapascal (MPa). Treat the material as linearly elastic up to yield and use the concepts of principal stresses, stress invariants of the Cauchy stress and its deviatoric part, and the von Mises yield criterion as defined in classical continuum mechanics.\n\nStarting only from the foundational definitions of principal stresses (eigenvalues of the Cauchy stress tensor), the first invariant of the Cauchy stress, the deviatoric stress (Cauchy stress minus its mean pressure part), and the second invariant of the deviatoric stress, carry out the following:\n\n1. Determine the principal stresses by solving the eigenproblem associated with $\\boldsymbol{\\sigma}$.\n2. Compute the first invariant $I_{1}$ of $\\boldsymbol{\\sigma}$.\n3. Compute the second invariant $J_{2}$ of the deviatoric stress.\n4. Compute the von Mises equivalent stress based on $J_{2}$.\n5. To assess ductile failure potential, adopt a representative von Mises yield stress for weak, quartzofeldspathic lower crust at mid-crustal conditions of $\\sigma_{y}=120$ MPa, and form the dimensionless ratio $r=\\sigma_{\\mathrm{vM}}/\\sigma_{y}$ as a quantitative indicator of proximity to yield.\n\nRound all numerical quantities to five significant figures and express all stresses in MPa. Report your results in the single row vector\n$$\n\\begin{pmatrix}\n\\sigma_{1} & \\sigma_{2} & \\sigma_{3} & I_{1} & J_{2} & \\sigma_{\\mathrm{vM}} & r\n\\end{pmatrix},\n$$\nwhere $\\sigma_{1}\\ge\\sigma_{2}\\ge\\sigma_{3}$ are the principal stresses.", "solution": "The problem is validated as scientifically grounded, well-posed, and objective. It is a standard exercise in continuum mechanics and can be solved directly from the provided information and foundational principles.\n\nThe solution proceeds by sequentially addressing the five tasks outlined in the problem statement. All stress units are in megapascal (MPa). All numerical results are rounded to five significant figures as required.\n\n**1. Determination of Principal Stresses**\n\nThe principal stresses, denoted by $\\sigma_p$, are the eigenvalues of the Cauchy stress tensor $\\boldsymbol{\\sigma}$. They are found by solving the characteristic equation $\\det(\\boldsymbol{\\sigma} - \\sigma_p \\mathbf{I}) = 0$, where $\\mathbf{I}$ is the identity tensor.\n\nGiven the Cauchy stress tensor:\n$$\n\\boldsymbol{\\sigma}=\\begin{pmatrix} 80 & 20 & 0 \\\\ 20 & 60 & 0 \\\\ 0 & 0 & 40 \\end{pmatrix}\n$$\nThe characteristic equation is:\n$$\n\\det\\begin{pmatrix} 80-\\sigma_p & 20 & 0 \\\\ 20 & 60-\\sigma_p & 0 \\\\ 0 & 0 & 40-\\sigma_p \\end{pmatrix} = 0\n$$\nExpanding the determinant along the third row yields:\n$$\n(40-\\sigma_p) \\left[ (80-\\sigma_p)(60-\\sigma_p) - (20)(20) \\right] = 0\n$$\nThis equation provides one principal stress directly: $\\sigma_p = 40$. The other two principal stresses are the roots of the quadratic equation within the brackets:\n$$\n(80-\\sigma_p)(60-\\sigma_p) - 400 = 0\n$$\n$$\n4800 - 80\\sigma_p - 60\\sigma_p + \\sigma_p^2 - 400 = 0\n$$\n$$\n\\sigma_p^2 - 140\\sigma_p + 4400 = 0\n$$\nUsing the quadratic formula, $\\sigma_p = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$:\n$$\n\\sigma_p = \\frac{140 \\pm \\sqrt{(-140)^2 - 4(1)(4400)}}{2(1)} = \\frac{140 \\pm \\sqrt{19600 - 17600}}{2} = \\frac{140 \\pm \\sqrt{2000}}{2}\n$$\nSimplifying the square root, $\\sqrt{2000} = \\sqrt{400 \\times 5} = 20\\sqrt{5}$.\n$$\n\\sigma_p = \\frac{140 \\pm 20\\sqrt{5}}{2} = 70 \\pm 10\\sqrt{5}\n$$\nThe three principal stresses are $70 + 10\\sqrt{5}$, $70 - 10\\sqrt{5}$, and $40$. We convert them to numerical values and order them according to $\\sigma_{1} \\ge \\sigma_{2} \\ge \\sigma_{3}$:\n$$\n\\sigma_1 = 70 + 10\\sqrt{5} \\approx 70 + 22.36068 = 92.36068 \\text{ MPa}\n$$\n$$\n\\sigma_2 = 70 - 10\\sqrt{5} \\approx 70 - 22.36068 = 47.63932 \\text{ MPa}\n$$\n$$\n\\sigma_3 = 40 \\text{ MPa}\n$$\nRounding to five significant figures: $\\sigma_1 = 92.361$ MPa, $\\sigma_2 = 47.639$ MPa, and $\\sigma_3 = 40.000$ MPa.\n\n**2. Computation of the First Invariant $I_1$**\n\nThe first invariant of the Cauchy stress tensor, $I_1$, is the trace of the tensor, defined as the sum of its diagonal components.\n$$\nI_1 = \\text{tr}(\\boldsymbol{\\sigma}) = \\sigma_{11} + \\sigma_{22} + \\sigma_{33}\n$$\n$$\nI_1 = 80 + 60 + 40 = 180 \\text{ MPa}\n$$\nAs a check, $I_1$ is also the sum of the principal stresses: $I_1 = \\sigma_1 + \\sigma_2 + \\sigma_3 = (70 + 10\\sqrt{5}) + (70 - 10\\sqrt{5}) + 40 = 180$.\nRounding to five significant figures gives $I_1 = 180.00$ MPa.\n\n**3. Computation of the Second Invariant $J_2$ of the Deviatoric Stress**\n\nFirst, we compute the deviatoric stress tensor, $\\boldsymbol{s}$, defined as $\\boldsymbol{s} = \\boldsymbol{\\sigma} - \\sigma_m \\mathbf{I}$, where $\\sigma_m$ is the mean (or hydrostatic) stress.\n$$\n\\sigma_m = \\frac{1}{3} I_1 = \\frac{1}{3}(180) = 60 \\text{ MPa}\n$$\nSo, the deviatoric stress tensor is:\n$$\n\\boldsymbol{s} = \\begin{pmatrix} 80 & 20 & 0 \\\\ 20 & 60 & 0 \\\\ 0 & 0 & 40 \\end{pmatrix} - \\begin{pmatrix} 60 & 0 & 0 \\\\ 0 & 60 & 0 \\\\ 0 & 0 & 60 \\end{pmatrix} = \\begin{pmatrix} 20 & 20 & 0 \\\\ 20 & 0 & 0 \\\\ 0 & 0 & -20 \\end{pmatrix} \\text{ MPa}\n$$\nThe second invariant of the deviatoric stress, $J_2$, is defined as:\n$$\nJ_2 = \\frac{1}{2} s_{ij} s_{ji} = \\frac{1}{2} \\text{tr}(\\boldsymbol{s}^2)\n$$\nWe compute the square of the deviatoric stress tensor:\n$$\n\\boldsymbol{s}^2 = \\boldsymbol{s}\\boldsymbol{s} = \\begin{pmatrix} 20 & 20 & 0 \\\\ 20 & 0 & 0 \\\\ 0 & 0 & -20 \\end{pmatrix} \\begin{pmatrix} 20 & 20 & 0 \\\\ 20 & 0 & 0 \\\\ 0 & 0 & -20 \\end{pmatrix} = \\begin{pmatrix} 800 & 400 & 0 \\\\ 400 & 400 & 0 \\\\ 0 & 0 & 400 \\end{pmatrix}\n$$\nThe trace of $\\boldsymbol{s}^2$ is $\\text{tr}(\\boldsymbol{s}^2) = 800 + 400 + 400 = 1600$ MPa$^2$.\nTherefore, $J_2$ is:\n$$\nJ_2 = \\frac{1}{2}(1600) = 800 \\text{ MPa}^2\n$$\nRounding to five significant figures gives $J_2 = 800.00$ MPa$^2$.\n\n**4. Computation of the von Mises Equivalent Stress**\n\nThe von Mises equivalent stress, $\\sigma_{\\mathrm{vM}}$, is defined in terms of $J_2$ as:\n$$\n\\sigma_{\\mathrm{vM}} = \\sqrt{3J_2}\n$$\nUsing the computed value of $J_2$:\n$$\n\\sigma_{\\mathrm{vM}} = \\sqrt{3 \\times 800} = \\sqrt{2400} = \\sqrt{400 \\times 6} = 20\\sqrt{6} \\text{ MPa}\n$$\nNumerically, this is:\n$$\n\\sigma_{\\mathrm{vM}} \\approx 48.98979 \\text{ MPa}\n$$\nRounding to five significant figures gives $\\sigma_{\\mathrm{vM}} = 48.990$ MPa.\n\n**5. Computation of the Yield Proximity Ratio**\n\nThe dimensionless ratio $r$ is the ratio of the von Mises stress $\\sigma_{\\mathrm{vM}}$ to the given yield stress $\\sigma_y = 120$ MPa.\n$$\nr = \\frac{\\sigma_{\\mathrm{vM}}}{\\sigma_y} = \\frac{20\\sqrt{6}}{120} = \\frac{\\sqrt{6}}{6}\n$$\nNumerically, this is:\n$$\nr \\approx \\frac{48.98979}{120} \\approx 0.408248\n$$\nRounding to five significant figures gives $r = 0.40825$.\n\n**Summary of Results**\n\nThe final results, rounded to five significant figures, are collected into the specified row vector:\n- $\\sigma_1 = 92.361$ MPa\n- $\\sigma_2 = 47.639$ MPa\n- $\\sigma_3 = 40.000$ MPa\n- $I_1 = 180.00$ MPa\n- $J_2 = 800.00$ MPa$^2$\n- $\\sigma_{\\mathrm{vM}} = 48.990$ MPa\n- $r = 0.40825$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n92.361 & 47.639 & 40.000 & 180.00 & 800.00 & 48.990 & 0.40825\n\\end{pmatrix}\n}\n$$", "id": "3615638"}, {"introduction": "Building upon the analysis of stress states, we now apply these concepts to a practical problem: predicting when a rock will fail. Geotechnical engineers and geophysicists often use the Mohr-Coulomb criterion, which describes failure in terms of cohesion and internal friction. This exercise [@problem_id:3615669] demonstrates how to translate the principal stresses from a standard triaxial compression test into the invariant stress space of mean stress ($p$) and deviatoric stress ($q$), providing a robust framework to evaluate material stability.", "problem": "A cylindrical rock specimen is loaded in a conventional axisymmetric triaxial compression test representative of computational geophysics calibration. The lateral confining stress is applied hydrostatically so that the principal stresses satisfy $\\sigma_{2}=\\sigma_{3}=p_{c}$ and the axial stress is $\\sigma_{1}$. Assume a dry specimen so that total and effective stresses coincide. The stress tensor is therefore diagonal in the principal basis with entries $\\sigma_{1}$, $\\sigma_{2}$, $\\sigma_{3}$.\n\nUse the invariant definitions $p=\\frac{1}{3}I_{1}$, where $I_{1}=\\sigma_{1}+\\sigma_{2}+\\sigma_{3}$, and $q=\\sqrt{3J_{2}}$, where $J_{2}$ is the second invariant of the deviatoric stress. Starting only from these definitions and the Mohr–Coulomb failure criterion expressed in principal stresses, derive the triaxial compression form of the Mohr–Coulomb yield line in the $(p,q)$ plane and evaluate the yield function $F$ for the following data:\n- Confining pressure $p_{c}=\\sigma_{2}=\\sigma_{3}=50\\,\\mathrm{MPa}$,\n- Axial stress $\\sigma_{1}=265\\,\\mathrm{MPa}$,\n- Cohesion $c=15\\,\\mathrm{MPa}$,\n- Friction angle $\\phi$ measured in degrees, with $\\sin\\phi=\\frac{3}{5}$ and $\\cos\\phi=\\frac{4}{5}$.\n\nDefine the Mohr–Coulomb yield function for triaxial compression as $F=q-\\left(M\\,p+k\\right)$, where $M$ and $k$ depend only on $c$ and $\\phi$, and are to be obtained from first principles. Compute the stress point $(p,q)$ and then compute the scalar value $F$. Express the final value of $F$ in megapascals (MPa), and round your final answer to four significant figures. Report only the numerical value of $F$.", "solution": "The solution consists of two main parts. First, we must derive the Mohr-Coulomb yield line in the $(p,q)$ stress invariant space from first principles. Second, we use the provided data to compute the stress point $(p,q)$ and the material parameters to evaluate the yield function $F$.\n\n**Part 1: Derivation of the Mohr-Coulomb Yield Line in $(p,q)$ Space**\n\nWe begin by expressing the stress invariants $p$ and $q$ in terms of the principal stresses for a triaxial compression test, where $\\sigma_1 \\ge \\sigma_2 = \\sigma_3$. The mean stress $p$ and deviatoric stress $q$ are:\n$$p = \\frac{1}{3}(\\sigma_1 + \\sigma_2 + \\sigma_3) = \\frac{1}{3}(\\sigma_1 + 2\\sigma_3)$$\n$$q = \\sqrt{\\frac{1}{2}[(\\sigma_1 - \\sigma_2)^2 + (\\sigma_2 - \\sigma_3)^2 + (\\sigma_3 - \\sigma_1)^2]} = \\sqrt{\\frac{1}{2}[(\\sigma_1 - \\sigma_3)^2 + 0 + (\\sigma_3 - \\sigma_1)^2]} = \\sigma_1 - \\sigma_3$$\nWe can invert these relations to express the principal stresses in terms of the invariants:\n$$\\sigma_1 = p + \\frac{2}{3}q$$\n$$\\sigma_3 = p - \\frac{1}{3}q$$\nThe Mohr-Coulomb failure criterion, expressed in principal stresses, is:\n$$\\sigma_1 = \\sigma_3 \\frac{1+\\sin\\phi}{1-\\sin\\phi} + 2c \\frac{\\cos\\phi}{1-\\sin\\phi}$$\nSubstituting the expressions for $\\sigma_1$ and $\\sigma_3$ into this criterion gives:\n$$p + \\frac{2}{3}q = \\left(p - \\frac{1}{3}q\\right) \\frac{1+\\sin\\phi}{1-\\sin\\phi} + 2c \\frac{\\cos\\phi}{1-\\sin\\phi}$$\nRearranging the terms to solve for $q$ yields the linear relationship $q = Mp + k$:\n$$q \\left( \\frac{2}{3} + \\frac{1}{3}\\frac{1+\\sin\\phi}{1-\\sin\\phi} \\right) = p \\left( \\frac{1+\\sin\\phi}{1-\\sin\\phi} - 1 \\right) + 2c \\frac{\\cos\\phi}{1-\\sin\\phi}$$\n$$q \\left( \\frac{2(1-\\sin\\phi) + (1+\\sin\\phi)}{3(1-\\sin\\phi)} \\right) = p \\left( \\frac{2\\sin\\phi}{1-\\sin\\phi} \\right) + 2c \\frac{\\cos\\phi}{1-\\sin\\phi}$$\n$$q \\left( \\frac{3 - \\sin\\phi}{3(1-\\sin\\phi)} \\right) = \\frac{6p\\sin\\phi + 6c\\cos\\phi}{3(1-\\sin\\phi)}$$\nThis simplifies to the yield line equation:\n$$q = \\left(\\frac{6\\sin\\phi}{3-\\sin\\phi}\\right) p + \\left(\\frac{6c\\cos\\phi}{3-\\sin\\phi}\\right)$$\nFrom this, we identify the material parameters $M$ and $k$:\n$$M = \\frac{6\\sin\\phi}{3-\\sin\\phi}, \\quad k = \\frac{6c\\cos\\phi}{3-\\sin\\phi}$$\n\n**Part 2: Numerical Evaluation**\n\nUsing the provided data, we first compute the stress point $(p,q)$:\n- $\\sigma_1 = 265$ MPa\n- $\\sigma_3 = 50$ MPa\n$$p = \\frac{1}{3}(265 + 2 \\times 50) = \\frac{365}{3} \\text{ MPa}$$\n$$q = 265 - 50 = 215 \\text{ MPa}$$\nNext, we compute the material parameters $M$ and $k$ using the given cohesion and friction angle properties:\n- $c = 15$ MPa\n- $\\sin\\phi = 3/5$\n- $\\cos\\phi = 4/5$\n$$M = \\frac{6(3/5)}{3 - 3/5} = \\frac{18/5}{12/5} = \\frac{18}{12} = 1.5$$\n$$k = \\frac{6(15)(4/5)}{3 - 3/5} = \\frac{72}{12/5} = 30 \\text{ MPa}$$\nThe yield function is defined as $F = q - (Mp + k)$. We evaluate this for the given stress state:\n$$F = 215 - \\left(1.5 \\times \\frac{365}{3} + 30\\right)$$\n$$F = 215 - (182.5 + 30) = 215 - 212.5 = 2.5 \\text{ MPa}$$\nRounding the final result to four significant figures gives $2.500$.", "answer": "$$\\boxed{2.500}$$", "id": "3615669"}, {"introduction": "The theories of stress and strain are powerful, but their application in computational geophysics relies on their accurate translation into computer code. This final practice [@problem_id:3615679] delves into the critical task of numerical implementation, comparing staggered and collocated grid discretizations for the strain tensor. By numerically checking the Saint-Venant compatibility conditions, we can verify whether our discrete strain field is physically realistic, a crucial step for ensuring the fidelity of any large-scale geodynamic simulation.", "problem": "You are asked to design and analyze a second-order accurate, periodic, two-dimensional discretization on a staggered grid for the small-strain tensor in linearized kinematics and to numerically verify the Saint-Venant compatibility conditions. The setting is a square domain with periodic boundary conditions in both directions. The focus is on ensuring that the discrete construction preserves the symmetry of the strain tensor computed from displacement gradients and on verifying that the resulting discrete strain field satisfies the compatibility conditions to within a truncation error consistent with the discretization.\n\nStarting from the fundamental definition of the small-strain tensor in linear elasticity, for a two-dimensional displacement field $\\boldsymbol{u} = (u,v)$,\n$$\n\\varepsilon_{ij} = \\frac{1}{2}\\left(\\frac{\\partial u_i}{\\partial x_j} + \\frac{\\partial u_j}{\\partial x_i}\\right),\n$$\ndesign a discrete approximation that:\n- uses a Marker-and-Cell (MAC) arrangement on a uniform grid with $N_x \\times N_y$ cells, periodic in both directions on $[0,1]\\times[0,1]$,\n- places the component $u$ at the centers of the faces normal to the $x$-axis, places $v$ at the centers of the faces normal to the $y$-axis, and places the strain components at cell centers,\n- constructs a discrete gradient using centered differences at second-order accuracy and then forms the symmetric small-strain tensor via the discrete analogue of the above definition so that the off-diagonal component is exactly symmetric by construction at identical locations.\n\nFrom the fundamental kinematic relation that a compatible small-strain field is one induced by some displacement field with continuous second derivatives, derive a second-order, centered, periodic, cell-centered discrete residual that represents the two-dimensional Saint-Venant compatibility conditions in terms of second derivatives of the strain components. You must not introduce any non-symmetric strain components in the construction, and the residual must evaluate to a scalar field located at cell centers. Then, in order to assess the impact of staggering, also implement a collocated discretization that places both $u$ and $v$ at cell centers, computes centered finite-difference derivatives at cell centers, forms the symmetric small-strain tensor at centers, and evaluates the same discrete compatibility residual at centers.\n\nImplement both schemes in a single self-contained program. Use periodic boundary conditions. Angles in trigonometric functions must be interpreted as radians.\n\nFor each test case below, compute the root-mean-square (RMS) norm of the discrete compatibility residual over all cell centers for:\n- the staggered-grid scheme, and\n- the collocated scheme.\n\nThe RMS norm for a grid function $w_{i,j}$ defined at all $N_x N_y$ cell centers is the square root of the mean of the squared values:\n$$\n\\|w\\|_{\\mathrm{RMS}} = \\left(\\frac{1}{N_x N_y}\\sum_{i=0}^{N_x-1}\\sum_{j=0}^{N_y-1} w_{i,j}^2\\right)^{1/2}.\n$$\n\nTest suite (all on $[0,1]\\times[0,1]$ with periodic boundary conditions):\n- Case 1 (smooth trigonometric, coarse): $N_x=N_y=16$, $u(x,y)=\\sin(2\\pi\\cdot 2x)\\cos(2\\pi\\cdot 3y)$, $v(x,y)=\\cos(2\\pi\\cdot 2x)\\sin(2\\pi\\cdot 3y)$.\n- Case 2 (smooth trigonometric, fine): $N_x=N_y=64$, $u(x,y)=\\sin(2\\pi\\cdot 2x)\\cos(2\\pi\\cdot 3y)$, $v(x,y)=\\cos(2\\pi\\cdot 2x)\\sin(2\\pi\\cdot 3y)$.\n- Case 3 (rigid rotation): $N_x=N_y=64$, $u(x,y)=-\\omega y$, $v(x,y)=\\omega x$ with $\\omega=1$.\n- Case 4 (composite periodic): $N_x=N_y=48$, $u(x,y)=\\sin(2\\pi x)+\\tfrac{1}{2}\\sin(4\\pi x)\\sin(2\\pi y)$, $v(x,y)=\\cos(2\\pi y)+\\tfrac{1}{4}\\sin(2\\pi x)\\sin(4\\pi y)$.\n\nYour program must:\n- implement both discretizations as specified,\n- compute, for each case, the RMS norm of the compatibility residual for the staggered-grid scheme and for the collocated scheme, in that order.\n\nFinal output format:\n- Your program should produce a single line of output containing 8 floats in a Python-style list, ordered as\n$$\n[\\mathrm{S}_1,\\mathrm{C}_1,\\mathrm{S}_2,\\mathrm{C}_2,\\mathrm{S}_3,\\mathrm{C}_3,\\mathrm{S}_4,\\mathrm{C}_4],\n$$\nwhere $\\mathrm{S}_k$ is the staggered-grid RMS residual and $\\mathrm{C}_k$ is the collocated RMS residual for case $k$.\n- Print each float in scientific notation with 6 digits after the decimal point. The list must have comma separators and no spaces, for example: `[1.234567e-03,2.345678e-04,...]`.", "solution": "The problem requires the design, implementation, and verification of two distinct second-order accurate finite difference schemes for computing the small-strain tensor and evaluating the Saint-Venant compatibility conditions on a two-dimensional periodic domain. The two schemes are a staggered Marker-and-Cell (MAC) grid and a collocated grid. The analysis will be performed on several test cases with known analytic displacement fields, and the accuracy of the schemes will be assessed by computing the root-mean-square (RMS) norm of the discrete compatibility residual.\n\n### 1. Analytical Kinematics and Compatibility\n\nFor a two-dimensional displacement field $\\boldsymbol{u} = (u, v)$, where $u_1=u$ and $u_2=v$ are the displacements in the $x_1=x$ and $x_2=y$ directions, respectively, the linearized or small-strain tensor $\\boldsymbol{\\varepsilon}$ is defined as the symmetric part of the displacement gradient tensor:\n$$\n\\varepsilon_{ij} = \\frac{1}{2}\\left(\\frac{\\partial u_i}{\\partial x_j} + \\frac{\\partial u_j}{\\partial x_i}\\right)\n$$\nIn component form for 2D, this gives:\n$$\n\\varepsilon_{11} = \\frac{\\partial u}{\\partial x}, \\quad \\varepsilon_{22} = \\frac{\\partial v}{\\partial y}, \\quad \\varepsilon_{12} = \\varepsilon_{21} = \\frac{1}{2}\\left(\\frac{\\partial u}{\\partial y} + \\frac{\\partial v}{\\partial x}\\right)\n$$\nA strain field is considered compatible if it can be derived from a single-valued, continuous displacement field with continuous second derivatives. In two dimensions, this condition is expressed by the Saint-Venant compatibility equation:\n$$\n\\frac{\\partial^2 \\varepsilon_{11}}{\\partial y^2} + \\frac{\\partial^2 \\varepsilon_{22}}{\\partial x^2} = 2 \\frac{\\partial^2 \\varepsilon_{12}}{\\partial x \\partial y}\n$$\nFor numerical verification, we define a residual field, $R$, which must be analytically zero for any compatible strain field:\n$$\nR(x,y) = \\frac{\\partial^2 \\varepsilon_{11}}{\\partial y^2} + \\frac{\\partial^2 \\varepsilon_{22}}{\\partial x^2} - 2 \\frac{\\partial^2 \\varepsilon_{12}}{\\partial x \\partial y} = 0\n$$\nOur numerical schemes will produce a discrete version of this residual, $R_{i,j}$, which should be close to zero, with a magnitude reflecting the truncation error of the discretization.\n\n### 2. Discretization on a Uniform Periodic Grid\n\nWe consider a square domain $[0,1] \\times [0,1]$ discretized into $N_x \\times N_y$ uniform cells of size $\\Delta x = 1/N_x$ and $\\Delta y = 1/N_y$. Indices $(i,j)$ typically denote the cell center, for $i \\in \\{0, \\dots, N_x-1\\}$ and $j \\in \\{0, \\dots, N_y-1\\}$.\n\n#### 2.1. Staggered Grid (MAC) Scheme\n\nIn the MAC arrangement, the scalar components of vector and tensor fields are located at different positions within a grid cell.\n- The horizontal displacement component $u$ is located at the centers of vertical faces: $u_{i,j}$ is at $(i\\Delta x, (j+0.5)\\Delta y)$.\n- The vertical displacement component $v$ is located at the centers of horizontal faces: $v_{i,j}$ is at $((i+0.5)\\Delta x, j\\Delta y)$.\n- All strain components $\\varepsilon_{11}, \\varepsilon_{22}, \\varepsilon_{12}$ are computed at cell centers: $((i+0.5)\\Delta x, (j+0.5)\\Delta y)$.\n\nUsing second-order centered finite differences, the discrete strain components are:\n- $\\varepsilon_{11, i,j}$: The derivative $\\partial u/\\partial x$ is naturally centered at the cell center using the $u$ values on its left and right faces.\n  $$ (\\varepsilon_{11})_{i,j} = \\frac{u_{i+1, j} - u_{i, j}}{\\Delta x} $$\n- $\\varepsilon_{22, i,j}$: Similarly, $\\partial v/\\partial y$ is centered at the cell center using the $v$ values on the faces below and above it.\n  $$ (\\varepsilon_{22})_{i,j} = \\frac{v_{i, j+1} - v_{i, j}}{\\Delta y} $$\n- $\\varepsilon_{12, i,j}$: This component requires $\\partial u/\\partial y$ and $\\partial v/\\partial x$ at the cell center. This is achieved by first computing centered derivatives on the grid lines where the variables are defined and then averaging to the cell center.\n  The term $\\partial u/\\partial y$ is computed by finding centered derivatives along vertical grid lines and then averaging horizontally:\n  $$ \\left(\\frac{\\partial u}{\\partial y}\\right)_{i,j} \\approx \\frac{1}{2} \\left[ \\left(\\frac{u_{i,j+1}-u_{i,j-1}}{2\\Delta y}\\right) + \\left(\\frac{u_{i+1,j+1}-u_{i+1,j-1}}{2\\Delta y}\\right) \\right] $$\n  Symmetrically, $\\partial v/\\partial x$ is computed by finding centered derivatives along horizontal grid lines and averaging vertically:\n  $$ \\left(\\frac{\\partial v}{\\partial x}\\right)_{i,j} \\approx \\frac{1}{2} \\left[ \\left(\\frac{v_{i+1,j}-v_{i-1,j}}{2\\Delta x}\\right) + \\left(\\frac{v_{i+1,j+1}-v_{i-1,j+1}}{2\\Delta x}\\right) \\right] $$\n  Then, the shear strain is:\n  $$ (\\varepsilon_{12})_{i,j} = \\frac{1}{2} \\left[ \\left(\\frac{\\partial u}{\\partial y}\\right)_{i,j} + \\left(\\frac{\\partial v}{\\partial x}\\right)_{i,j} \\right] $$\nThis construction ensures all strain components are co-located at cell centers and that $\\varepsilon_{12}$ is defined symmetrically.\n\n#### 2.2. Collocated Grid Scheme\n\nIn this scheme, all variables ($u, v, \\varepsilon_{11}, \\varepsilon_{22}, \\varepsilon_{12}$) are located at the cell centers $((i+0.5)\\Delta x, (j+0.5)\\Delta y)$. Standard second-order centered differences are used throughout:\n$$ (\\varepsilon_{11})_{i,j} = \\frac{u_{i+1, j} - u_{i-1, j}}{2\\Delta x} $$\n$$ (\\varepsilon_{22})_{i,j} = \\frac{v_{i, j+1} - v_{i, j-1}}{2\\Delta y} $$\n$$ (\\varepsilon_{12})_{i,j} = \\frac{1}{2}\\left( \\frac{u_{i, j+1} - u_{i, j-1}}{2\\Delta y} + \\frac{v_{i+1, j} - v_{i-1, j}}{2\\Delta x} \\right) $$\n\n#### 2.3. Discrete Compatibility Residual\n\nFor both schemes, the strain components are computed at cell centers. Therefore, the discrete compatibility residual $R_{i,j}$ is computed using the same set of standard second-order centered difference formulas on the cell-centered strain fields:\n$$ (\\delta_{yy}\\varepsilon_{11})_{i,j} = \\frac{(\\varepsilon_{11})_{i,j+1} - 2(\\varepsilon_{11})_{i,j} + (\\varepsilon_{11})_{i,j-1}}{\\Delta y^2} $$\n$$ (\\delta_{xx}\\varepsilon_{22})_{i,j} = \\frac{(\\varepsilon_{22})_{i+1,j} - 2(\\varepsilon_{22})_{i,j} + (\\varepsilon_{22})_{i-1,j}}{\\Delta x^2} $$\n$$ (\\delta_{xy}\\varepsilon_{12})_{i,j} = \\frac{(\\varepsilon_{12})_{i+1,j+1} - (\\varepsilon_{12})_{i-1,j+1} - (\\varepsilon_{12})_{i+1,j-1} + (\\varepsilon_{12})_{i-1,j-1}}{4\\Delta x\\Delta y} $$\nThe residual is then assembled as:\n$$ R_{i,j} = (\\delta_{yy}\\varepsilon_{11})_{i,j} + (\\delta_{xx}\\varepsilon_{22})_{i,j} - 2(\\delta_{xy}\\varepsilon_{12})_{i,j} $$\n\n### 3. Numerical Verification and Implementation\n\nThe final step is to implement both schemes and test them with the provided analytical displacement fields. For each test case, we compute the RMS norm of the residual grid function $R_{i,j}$:\n$$ \\|R\\|_{\\mathrm{RMS}} = \\left(\\frac{1}{N_x N_y}\\sum_{i=0}^{N_x-1}\\sum_{j=0}^{N_y-1} R_{i,j}^2\\right)^{1/2} $$\nThe implementation utilizes NumPy for array operations. Periodic boundary conditions are handled efficiently using `numpy.roll`, which performs circular shifts on array axes. These shifts correspond exactly to accessing neighbor cells in a periodic grid (e.g., $u_{i+1}$ is a left shift of the $u$ array along the x-axis). The test cases include smooth trigonometric functions to observe numerical convergence, a rigid body rotation for which the strain (and thus the residual) should be zero to machine precision, and a more complex composite field.\n\n```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_residuals(Nx, Ny, u_func, v_func, omega=None):\n    \"\"\"\n    Implements staggered and collocated schemes to calculate the compatibility residual.\n    \"\"\"\n    if omega is not None:\n        u_func = lambda x, y: -omega * y\n        v_func = lambda x, y: omega * x\n\n    Lx, Ly = 1.0, 1.0\n    dx, dy = Lx / Nx, Ly / Ny\n\n    # --- Staggered Grid (MAC) Scheme ---\n    # 1. Define staggered grid coordinates and evaluate displacement fields\n    x_u_face = np.arange(Nx) * dx\n    y_u_face = (np.arange(Ny) + 0.5) * dy\n    XX_u, YY_u = np.meshgrid(x_u_face, y_u_face, indexing='xy')\n\n    x_v_face = (np.arange(Nx) + 0.5) * dx\n    y_v_face = np.arange(Ny) * dy\n    XX_v, YY_v = np.meshgrid(x_v_face, y_v_face, indexing='xy')\n    \n    u_s = u_func(XX_u, YY_u)\n    v_s = v_func(XX_v, YY_v)\n    \n    # 2. Compute strain tensor components at cell centers\n    eps11_s = (np.roll(u_s, -1, axis=1) - u_s) / dx\n    eps22_s = (np.roll(v_s, -1, axis=0) - v_s) / dy\n    \n    # Shear strain: compute derivatives on native grids, then average to cell centers\n    du_dy_on_u_lines = (np.roll(u_s, -1, axis=0) - np.roll(u_s, 1, axis=0)) / (2 * dy)\n    du_dy_at_centers = (du_dy_on_u_lines + np.roll(du_dy_on_u_lines, -1, axis=1)) / 2.0\n    \n    dv_dx_on_v_lines = (np.roll(v_s, -1, axis=1) - np.roll(v_s, 1, axis=1)) / (2 * dx)\n    dv_dx_at_centers = (dv_dx_on_v_lines + np.roll(dv_dx_on_v_lines, -1, axis=0)) / 2.0\n    \n    eps12_s = 0.5 * (du_dy_at_centers + dv_dx_at_centers)\n\n    # 3. Compute compatibility residual at cell centers\n    d2_eps11_dy2 = (np.roll(eps11_s, 1, axis=0) - 2 * eps11_s + np.roll(eps11_s, -1, axis=0)) / dy**2\n    d2_eps22_dx2 = (np.roll(eps22_s, 1, axis=1) - 2 * eps22_s + np.roll(eps22_s, -1, axis=1)) / dx**2\n    \n    d_eps12_dy = (np.roll(eps12_s, -1, axis=0) - np.roll(eps12_s, 1, axis=0)) / (2 * dy)\n    d2_eps12_dxdy = (np.roll(d_eps12_dy, -1, axis=1) - np.roll(d_eps12_dy, 1, axis=1)) / (2 * dx)\n    \n    R_staggered = d2_eps11_dy2 + d2_eps22_dx2 - 2.0 * d2_eps12_dxdy\n    rms_staggered = np.sqrt(np.mean(R_staggered**2))\n\n    # --- Collocated Grid Scheme ---\n    # 1. Define cell-centered grid and evaluate displacement fields\n    x_c = (np.arange(Nx) + 0.5) * dx\n    y_c = (np.arange(Ny) + 0.5) * dy\n    XX_c, YY_c = np.meshgrid(x_c, y_c, indexing='xy')\n    \n    u_c = u_func(XX_c, YY_c)\n    v_c = v_func(XX_c, YY_c)\n\n    # 2. Compute strain tensor components at cell centers\n    eps11_c = (np.roll(u_c, -1, axis=1) - np.roll(u_c, 1, axis=1)) / (2 * dx)\n    eps22_c = (np.roll(v_c, -1, axis=0) - np.roll(v_c, 1, axis=0)) / (2 * dy)\n    \n    du_dy_c = (np.roll(u_c, -1, axis=0) - np.roll(u_c, 1, axis=0)) / (2 * dy)\n    dv_dx_c = (np.roll(v_c, -1, axis=1) - np.roll(v_c, 1, axis=1)) / (2 * dx)\n    \n    eps12_c = 0.5 * (du_dy_c + dv_dx_c)\n\n    # 3. Compute compatibility residual at cell centers\n    d2_eps11_dy2_c = (np.roll(eps11_c, 1, axis=0) - 2 * eps11_c + np.roll(eps11_c, -1, axis=0)) / dy**2\n    d2_eps22_dx2_c = (np.roll(eps22_c, 1, axis=1) - 2 * eps22_c + np.roll(eps22_c, -1, axis=1)) / dx**2\n    \n    d_eps12_dy_c = (np.roll(eps12_c, -1, axis=0) - np.roll(eps12_c, 1, axis=0)) / (2 * dy)\n    d2_eps12_dxdy_c = (np.roll(d_eps12_dy_c, -1, axis=1) - np.roll(d_eps12_dy_c, 1, axis=1)) / (2 * dx)\n\n    R_collocated = d2_eps11_dy2_c + d2_eps22_dx2_c - 2.0 * d2_eps12_dxdy_c\n    rms_collocated = np.sqrt(np.mean(R_collocated**2))\n\n    return rms_staggered, rms_collocated\n\ndef solve():\n    \"\"\"\n    Defines test cases and runs the solver for each, printing the final results.\n    \"\"\"\n    pi = np.pi\n    \n    # Test case definitions\n    u1 = lambda x, y: np.sin(2*pi*2*x) * np.cos(2*pi*3*y)\n    v1 = lambda x, y: np.cos(2*pi*2*x) * np.sin(2*pi*3*y)\n    \n    # Rigid rotation case uses placeholder functions for u and v\n    u3 = lambda x, y: 0 \n    v3 = lambda x, y: 0\n    \n    u4 = lambda x, y: np.sin(2*pi*x) + 0.5*np.sin(4*pi*x)*np.sin(2*pi*y)\n    v4 = lambda x, y: np.cos(2*pi*y) + 0.25*np.sin(2*pi*x)*np.sin(4*pi*y)\n\n    test_cases = [\n        {'Nx': 16, 'Ny': 16, 'u_func': u1, 'v_func': v1, 'omega': None},\n        {'Nx': 64, 'Ny': 64, 'u_func': u1, 'v_func': v1, 'omega': None},\n        {'Nx': 64, 'Ny': 64, 'u_func': u3, 'v_func': v3, 'omega': 1.0},\n        {'Nx': 48, 'Ny': 48, 'u_func': u4, 'v_func': v4, 'omega': None},\n    ]\n\n    results = []\n    for case in test_cases:\n        rms_staggered, rms_collocated = calculate_residuals(\n            case['Nx'], case['Ny'], case['u_func'], case['v_func'], case['omega']\n        )\n        results.append(rms_staggered)\n        results.append(rms_collocated)\n\n    # Format the output as specified\n    formatted_results = [f\"{r:.6e}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\n# This function is not called in the original script but is here for direct execution.\n# solve()\n```", "answer": "`[7.643799e+01,2.007677e+02,2.072895e+02,2.074744e+02,2.545196e-13,2.541334e-13,1.385507e+02,1.378772e+02]`", "id": "3615679"}]}