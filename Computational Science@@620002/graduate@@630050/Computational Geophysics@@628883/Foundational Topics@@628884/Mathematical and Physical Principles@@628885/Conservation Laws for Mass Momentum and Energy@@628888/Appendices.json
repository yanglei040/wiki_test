{"hands_on_practices": [{"introduction": "This first practice is a fundamental \"sanity check\" for any numerical code designed to solve conservation laws. You will implement a standard finite-volume scheme for a simple advection problem and verify that the total mass is conserved to machine precision, regardless of the specific details of the spatial reconstruction [@problem_id:3580957]. This exercise reinforces the core idea of a conservative discretization, where numerical fluxes at cell interfaces guarantee that what leaves one cell enters the next, ensuring no mass is artificially created or destroyed within the domain.", "problem": "Consider the one-dimensional conservative advection of a passive scalar mass density $q(x,t)$ governed by the conservation law $\\partial_t q + \\partial_x (u q) = 0$, where $u$ is a constant advective velocity. A uniform periodic domain of length $L$ is discretized into $N$ finite-volume cells of width $\\Delta x = L/N$, and time is advanced using a single-step explicit finite-volume method with piecewise-linear reconstruction and a Total Variation Diminishing (TVD) flux limiter. The goal is to quantify the effect of the flux limiter choice on total mass conservation for a sharp-front initial condition.\n\nFundamental setup:\n- Domain length $L = 1\\,\\mathrm{m}$, constant velocity $u = 1\\,\\mathrm{m/s}$, final time $T = L/u = 1\\,\\mathrm{s}$.\n- Initial mass density profile $q(x,0)$ is a top-hat (rectangular pulse) with amplitude $q_0 = 3\\,\\mathrm{kg/m}$, starting position $x_s = 0.33\\,\\mathrm{m}$, and width $W = 0.2\\,\\mathrm{m}$. Outside this interval, $q(x,0) = 0\\,\\mathrm{kg/m}$.\n- Periodic boundary conditions are imposed at $x=0$ and $x=L$.\n\nNumerical method requirements:\n- Use a conservative finite-volume update for cell averages $q_i^n$ of the form \n  $q_i^{n+1} = q_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+1/2}^n - F_{i-1/2}^n\\right)$,\n  with numerical fluxes $F_{i\\pm 1/2}^n = u\\, q_{i\\pm 1/2}^{-}$ for $u>0$, where $q_{i+1/2}^{-}$ is the left-sided reconstructed interface value in a Total Variation Diminishing (TVD) scheme.\n- The reconstruction must be piecewise linear using a TVD flux limiter $\\phi(r)$ applied to the ratio of consecutive one-sided slopes $r$ computed from neighboring cell averages. Implement the following classical TVD limiters: Upwind (first order), Minmod, Van Leer, Monotonized Central (MC), and Superbee. Do not use non-conservative corrections or any non-conservative filtering; strictly enforce conservation in the flux-difference form.\n- Time stepping must respect a specified Courant–Friedrichs–Lewy (CFL) number $\\mathrm{CFL}$: compute $\\Delta t_{\\mathrm{CFL}} = \\mathrm{CFL}\\, \\Delta x / |u|$, then use $n = \\lceil T/\\Delta t_{\\mathrm{CFL}} \\rceil$ steps with $\\Delta t = T/n$ so that the final time is exactly $T$. This ensures $\\Delta t \\le \\Delta t_{\\mathrm{CFL}}$.\n\nMass diagnostic:\n- Compute the discrete initial total mass $M(0) = \\sum_i q_i^0\\, \\Delta x$ and the discrete final total mass $M(T) = \\sum_i q_i^n\\, \\Delta x$ after exactly one full traversal time $T = L/u$.\n- For each test case, report the relative mass error $\\varepsilon = \\frac{M(T) - M(0)}{M(0)}$ as a dimensionless decimal number. Express $\\varepsilon$ as a float (no unit).\n\nTest suite:\nUse the initial condition and physical parameters listed above, and run the following test cases that vary the grid resolution $N$, the Courant–Friedrichs–Lewy number $\\mathrm{CFL}$, and the limiter choice. All quantities are in the International System of Units (SI), and angles do not appear in this problem.\n- Test $1$: limiter = Upwind, $N = 128$, $\\mathrm{CFL} = 0.5$.\n- Test $2$: limiter = Minmod, $N = 128$, $\\mathrm{CFL} = 0.5$.\n- Test $3$: limiter = Van Leer, $N = 128$, $\\mathrm{CFL} = 0.5$.\n- Test $4$: limiter = Monotonized Central, $N = 128$, $\\mathrm{CFL} = 0.5$.\n- Test $5$: limiter = Superbee, $N = 128$, $\\mathrm{CFL} = 0.5$.\n- Test $6$: limiter = Minmod, $N = 32$, $\\mathrm{CFL} = 0.95$.\n- Test $7$: limiter = Superbee, $N = 32$, $\\mathrm{CFL} = 0.95$.\n- Test $8$: limiter = Van Leer, $N = 64$, $\\mathrm{CFL} = 0.95$.\n\nFinal output specification:\n- Your program should produce a single line of output containing the relative mass errors for the test suite as a comma-separated list enclosed in square brackets, in the exact order of the tests listed above. For example, the output format should look like $\\left[\\varepsilon_1,\\varepsilon_2,\\ldots,\\varepsilon_8\\right]$, where each $\\varepsilon_k$ is a float.", "solution": "## Problem Validation\n\n### Step 1: Extract Givens\n\nThe problem statement provides the following information:\n\n**Governing Equation:**\n- One-dimensional conservative advection: $\\partial_t q + \\partial_x (u q) = 0$.\n- $q(x,t)$ is a passive scalar mass density.\n- $u$ is a constant advective velocity.\n\n**Physical Parameters:**\n- Domain length: $L = 1\\,\\mathrm{m}$.\n- Constant velocity: $u = 1\\,\\mathrm{m/s}$.\n- Final time: $T = L/u = 1\\,\\mathrm{s}$.\n- Domain is uniform and periodic.\n\n**Initial Condition:**\n- A top-hat (rectangular pulse) profile for mass density $q(x,0)$.\n- Amplitude: $q_0 = 3\\,\\mathrm{kg/m}$.\n- Start position: $x_s = 0.33\\,\\mathrm{m}$.\n- Width: $W = 0.2\\,\\mathrm{m}$.\n- $q(x,0) = 0\\,\\mathrm{kg/m}$ outside the interval $[x_s, x_s+W]$.\n\n**Numerical Method:**\n- Discretization: $N$ finite-volume cells of width $\\Delta x = L/N$.\n- Update rule: $q_i^{n+1} = q_i^n - \\frac{\\Delta t}{\\Delta x}\\left(F_{i+1/2}^n - F_{i-1/2}^n\\right)$.\n- Numerical flux for $u>0$: $F_{i\\pm 1/2}^n = u\\, q_{i\\pm 1/2}^{-}$, where $q_{i+1/2}^{-}$ is the left-sided reconstructed interface value.\n- Reconstruction: Piecewise linear using a TVD flux limiter $\\phi(r)$.\n- Limiter argument: $r$ is the ratio of consecutive one-sided slopes from neighboring cell averages.\n- Limiter choices: Upwind, Minmod, Van Leer, Monotonized Central (MC), Superbee.\n- Scheme must be strictly conservative (no non-conservative corrections/filtering).\n- Time stepping:\n    - $\\Delta t_{\\mathrm{CFL}} = \\mathrm{CFL}\\, \\Delta x / |u|$.\n    - Number of steps $n = \\lceil T/\\Delta t_{\\mathrm{CFL}} \\rceil$.\n    - Time step size $\\Delta t = T/n$.\n\n**Mass Diagnostic:**\n- Initial total mass: $M(0) = \\sum_i q_i^0\\, \\Delta x$.\n- Final total mass: $M(T) = \\sum_i q_i^n\\, \\Delta x$.\n- Reported quantity: Relative mass error $\\varepsilon = \\frac{M(T) - M(0)}{M(0)}$.\n\n**Test Suite:**\n- Test 1: limiter = Upwind, $N = 128$, $\\mathrm{CFL} = 0.5$.\n- Test 2: limiter = Minmod, $N = 128$, $\\mathrm{CFL} = 0.5$.\n- Test 3: limiter = Van Leer, $N = 128$, $\\mathrm{CFL} = 0.5$.\n- Test 4: limiter = Monotonized Central, $N = 128$, $\\mathrm{CFL} = 0.5$.\n- Test 5: limiter = Superbee, $N = 128$, $\\mathrm{CFL} = 0.5$.\n- Test 6: limiter = Minmod, $N = 32$, $\\mathrm{CFL} = 0.95$.\n- Test 7: limiter = Superbee, $N = 32$, $\\mathrm{CFL} = 0.95$.\n- Test 8: limiter = Van Leer, $N = 64$, $\\mathrm{CFL} = 0.95$.\n\n### Step 2: Validate Using Extracted Givens\n\nThe problem is analyzed against the validation criteria:\n\n- **Scientifically Grounded**: The problem describes the linear advection equation, a fundamental model in fluid dynamics and transport phenomena. The numerical method specified—a finite-volume scheme with TVD limiters—is a standard, well-established technique in computational physics for solving hyperbolic conservation laws. All concepts are scientifically sound.\n- **Well-Posed**: The initial-boundary value problem for linear advection on a periodic domain is well-posed. The numerical scheme is constructed to be stable under the specified CFL condition. The task is to compute a well-defined numerical quantity, the relative mass error.\n- **Objective**: The problem is stated using precise, quantitative, and unambiguous terminology. All parameters and procedures are explicitly defined.\n- **Completeness and Consistency**: The problem provides all necessary information: the PDE, domain, initial and boundary conditions, a complete description of the numerical algorithm (including discretization, flux calculation, reconstruction, and time-stepping), and the exact diagnostic to compute. There are no contradictions.\n- **Core Scientific Question**: The problem centers on the property of mass conservation. The specified finite-volume update rule is in \"flux-difference\" or \"conservation\" form. For a periodic domain, the sum of flux differences over all cells telescopes to zero:\n$$ \\sum_{i=1}^{N} \\left(F_{i+1/2}^n - F_{i-1/2}^n\\right) = 0 $$\nThis is because periodicity implies that the flux leaving the last cell, $F_{N+1/2}$, is identical to the flux entering the first cell, $F_{1/2}$. Consequently, the total discrete mass, $M = \\sum_i q_i \\Delta x$, should be exactly conserved at each time step in exact arithmetic. The problem asks to calculate the relative mass error $\\varepsilon = (M(T) - M(0))/M(0)$, which is expected to be non-zero only due to the accumulation of floating-point round-off errors inherent in computer arithmetic. This is a valid numerical verification exercise, testing the implementation's adherence to the conservative formulation. It is not trivial, as it requires a correct and careful implementation of a non-trivial numerical scheme.\n\n### Step 3: Verdict and Action\n\nThe problem is **valid**. It is scientifically sound, well-posed, and provides a complete, unambiguous specification for a standard numerical experiment in computational physics. A full solution will be provided.\n\n## Solution\n\nThe problem requires the implementation of a second-order accurate Total Variation Diminishing (TVD) finite-volume scheme to solve the one-dimensional linear advection equation, $\\partial_t q + u \\partial_x q = 0$, on a periodic domain. The primary objective is to verify the mass conservation property of the numerical method.\n\n### 1. Discretization and Initial Conditions\n\nThe spatial domain of length $L=1$ is discretized into $N$ cells, each of width $\\Delta x = L/N$. The cell centers are located at $x_i = (i + 0.5)\\Delta x$ for $i=0, 1, \\dots, N-1$.\nThe quantity $q_i^n$ represents the cell-averaged mass density in cell $i$ at time step $n$. The initial condition $q(x,0)$ is a rectangular pulse. The initial cell averages $q_i^0$ are calculated by integrating $q(x,0)$ over each cell:\n$$ q_i^0 = \\frac{1}{\\Delta x} \\int_{i\\Delta x}^{(i+1)\\Delta x} q(x,0) \\,dx $$\nGiven $q(x,0) = q_0$ for $x \\in [x_s, x_s+W]$ and $0$ otherwise, this integral corresponds to $q_0$ multiplied by the length of the intersection of cell $i$, $[i\\Delta x, (i+1)\\Delta x]$, and the pulse interval, $[x_s, x_s+W]$.\n\n### 2. Finite-Volume Update\n\nThe evolution of the cell averages is governed by the conservative finite-volume formula:\n$$ q_i^{n+1} = q_i^n - \\frac{\\Delta t}{\\Delta x} \\left(F_{i+1/2}^n - F_{i-1/2}^n\\right) $$\nHere, $F_{i+1/2}$ is the numerical flux at the interface between cell $i$ and cell $i+1$. For a constant positive velocity $u$, the flux is determined by the fluid state upwind of the interface, which is on the left side (denoted by superscript $-$).\n$$ F_{i+1/2} = u \\, q_{i+1/2}^{-} $$\nThe core of the TVD scheme lies in the reconstruction of the interface value $q_{i+1/2}^{-}$.\n\n### 3. Piecewise Linear Reconstruction and TVD Limiters\n\nA second-order accurate reconstruction is achieved by assuming a linear profile within each cell. The value at the right interface of cell $i$ is reconstructed as:\n$$ q_{i+1/2}^{-} = q_i^n + \\frac{1}{2} \\sigma_i \\Delta x $$\nwhere $\\sigma_i$ is a limited slope within cell $i$. To prevent spurious oscillations and ensure the TVD property, the slope is limited. A common approach, as specified, uses a flux limiter function $\\phi(r)$:\n$$ \\sigma_i \\Delta x = \\phi(r_i) (q_i^n - q_{i-1}^n) $$\nThe ratio $r_i$ compares the slope in the \"downwind\" cell to the slope in the \"upwind\" cell (relative to the wave propagation direction):\n$$ r_i = \\frac{q_{i+1}^n - q_i^n}{q_i^n - q_{i-1}^n} $$\nCombining these gives the reconstruction formula:\n$$ q_{i+1/2}^{-} = q_i^n + \\frac{1}{2} \\phi(r_i) (q_i^n - q_{i-1}^n) $$\nSpecial care is taken for the case where the denominator in $r_i$ is zero. In our implementation, we define $r_i=0$ in such cases, which correctly results in a zero correction term since $\\phi(0)=0$ for all specified limiters.\n\nThe problem requires implementing five different limiter functions $\\phi(r)$:\n1.  **Upwind (First Order):** $\\phi(r) = 0$\n2.  **Minmod:** $\\phi(r) = \\max(0, \\min(1, r))$\n3.  **Van Leer:** $\\phi(r) = \\frac{r + |r|}{1 + |r|}$\n4.  **Monotonized Central (MC):** $\\phi(r) = \\max(0, \\min(2r, \\frac{1+r}{2}, 2))$\n5.  **Superbee:** $\\phi(r) = \\max(0, \\min(2r, 1), \\min(r, 2))$\n\nPeriodic boundary conditions are handled by using values from the opposite end of the domain when computing slopes near the boundaries (e.g., for cell $i=0$, the \"left\" neighbor $q_{-1}$ is $q_{N-1}$).\n\n### 4. Time Stepping\n\nThe simulation runs for a total time $T$. The time step $\\Delta t$ is chosen to satisfy the CFL stability condition and to ensure the final time is reached exactly. Given a CFL number, the maximum allowed time step is $\\Delta t_{\\mathrm{CFL}} = \\mathrm{CFL} \\frac{\\Delta x}{|u|}$. The number of steps is $n_{\\text{steps}} = \\lceil T/\\Delta t_{\\mathrm{CFL}} \\rceil$, and the actual time step used is $\\Delta t = T / n_{\\text{steps}}$.\n\n### 5. Mass Conservation Verification\n\nThe total mass at any time $t_n$ is $M(t_n) = \\sum_{i=0}^{N-1} q_i^n \\Delta x$. The change in total mass from one step to the next is:\n$$ M^{n+1} - M^n = \\Delta x \\sum_{i=0}^{N-1} (q_i^{n+1} - q_i^n) = -\\Delta t \\sum_{i=0}^{N-1} (F_{i+1/2} - F_{i-1/2}) $$\nDue to periodic boundary conditions, the fluxes at the domain ends are identical, i.e., $F_{-1/2} = F_{N-1/2}$. The sum of flux differences becomes a telescoping sum that evaluates to zero. Thus, $M^{n+1} = M^n$. This holds for all time steps, so $M(T) = M(0)$ in exact arithmetic. The computed relative error $\\varepsilon = (M(T) - M(0))/M(0)$ will therefore be a measure of the accumulated floating-point round-off error.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Main solver function that orchestrates the simulation for all test cases.\n    \"\"\"\n    \n    # --- Limiter Functions (phi(r)) ---\n    def limiter_upwind(r):\n        return np.zeros_like(r)\n\n    def limiter_minmod(r):\n        return np.maximum(0, np.minimum(1, r))\n\n    def limiter_van_leer(r):\n        # This form is safe for all r, including r=-1.\n        return (r + np.abs(r)) / (1 + np.abs(r))\n\n    def limiter_mc(r):\n        # phi(r) = max(0, min(2r, 0.5*(1+r), 2))\n        return np.maximum(0, np.minimum.reduce([2 * r, 0.5 * (1 + r), np.full_like(r, 2)]))\n\n    def limiter_superbee(r):\n        # phi(r) = max(0, min(2r, 1), min(r, 2))\n        return np.maximum(0, np.maximum(np.minimum(2 * r, 1), np.minimum(r, 2)))\n\n    limiter_map = {\n        \"Upwind\": limiter_upwind,\n        \"Minmod\": limiter_minmod,\n        \"Van Leer\": limiter_van_leer,\n        \"Monotonized Central\": limiter_mc,\n        \"Superbee\": limiter_superbee\n    }\n\n    # --- Test Cases ---\n    test_cases = [\n        {\"limiter\": \"Upwind\", \"N\": 128, \"CFL\": 0.5},\n        {\"limiter\": \"Minmod\", \"N\": 128, \"CFL\": 0.5},\n        {\"limiter\": \"Van Leer\", \"N\": 128, \"CFL\": 0.5},\n        {\"limiter\": \"Monotonized Central\", \"N\": 128, \"CFL\": 0.5},\n        {\"limiter\": \"Superbee\", \"N\": 128, \"CFL\": 0.5},\n        {\"limiter\": \"Minmod\", \"N\": 32, \"CFL\": 0.95},\n        {\"limiter\": \"Superbee\", \"N\": 32, \"CFL\": 0.95},\n        {\"limiter\": \"Van Leer\", \"N\": 64, \"CFL\": 0.95},\n    ]\n\n    results = []\n    for case in test_cases:\n        error = run_simulation(limiter_map[case[\"limiter\"]], case[\"N\"], case[\"CFL\"])\n        results.append(error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.16e}' for r in results)}]\")\n\n\ndef run_simulation(limiter_func, N, CFL):\n    \"\"\"\n    Executes a single finite-volume simulation for a given setup.\n\n    Args:\n        limiter_func: The TVD limiter function phi(r).\n        N: Number of grid cells.\n        CFL: The Courant-Friedrichs-Lewy number.\n\n    Returns:\n        The relative mass error epsilon.\n    \"\"\"\n    # --- Physical Parameters ---\n    L = 1.0   # Domain length (m)\n    u = 1.0   # Advection velocity (m/s)\n    T = 1.0   # Final time (s)\n    q0 = 3.0  # Pulse amplitude (kg/m)\n    x_s = 0.33 # Pulse start position (m)\n    W = 0.2   # Pulse width (m)\n\n    # --- Numerical Parameters ---\n    dx = L / N\n    dt_cfl = CFL * dx / abs(u)\n    num_steps = math.ceil(T / dt_cfl)\n    dt = T / num_steps\n\n    # --- Initial Condition: Cell-Averaged Top-hat ---\n    cell_edges = np.linspace(0, L, N + 1)\n    q = np.zeros(N)\n    pulse_end = x_s + W\n    for i in range(N):\n        cell_start = cell_edges[i]\n        cell_end = cell_edges[i+1]\n        \n        # Calculate overlap between cell and pulse\n        overlap_start = max(cell_start, x_s)\n        overlap_end = min(cell_end, pulse_end)\n        overlap_length = max(0, overlap_end - overlap_start)\n        \n        q[i] = q0 * overlap_length / dx\n\n    # --- Initial Mass Calculation ---\n    M0 = np.sum(q) * dx\n\n    # --- Time Integration Loop ---\n    q_current = q.copy()\n    for _ in range(num_steps):\n        q_old = q_current.copy()\n\n        # Handle periodic boundaries using np.roll\n        q_im1 = np.roll(q_old, 1)  # q_{i-1}\n        q_ip1 = np.roll(q_old, -1) # q_{i+1}\n\n        # Calculate ratio of consecutive slopes r_i\n        # r_i = (q_{i+1} - q_i) / (q_i - q_{i-1})\n        numerator = q_ip1 - q_old\n        denominator = q_old - q_im1\n        \n        # Avoid division by zero. If denominator is zero, the correction term\n        # will be multiplied by it, so it becomes zero. r=0 is a safe choice.\n        r = np.zeros_like(q_old)\n        # Use a small epsilon to handle floating point noise around zero.\n        nonzero_denom_mask = np.abs(denominator) > 1e-15\n        r[nonzero_denom_mask] = numerator[nonzero_denom_mask] / denominator[nonzero_denom_mask]\n        \n        # Apply the chosen limiter function\n        phi_vals = limiter_func(r)\n        \n        # Reconstruct interface values q_{i+1/2}^-\n        # q_{i+1/2}^- = q_i + 0.5 * phi(r_i) * (q_i - q_{i-1})\n        q_interface_m = q_old + 0.5 * phi_vals * (q_old - q_im1)\n        \n        # Calculate fluxes at right-hand interfaces F_{i+1/2}\n        F_ip12 = u * q_interface_m\n        \n        # Fluxes at left-hand interfaces F_{i-1/2} are just rolled F_{i+1/2}\n        F_im12 = np.roll(F_ip12, 1)\n\n        # Update cell averages\n        q_current = q_old - (dt / dx) * (F_ip12 - F_im12)\n\n    # --- Final Mass Calculation and Error ---\n    M_T = np.sum(q_current) * dx\n    \n    # Avoid division by zero if M0 is zero (not the case here)\n    if abs(M0)  1e-15:\n        return 0.0\n    \n    relative_error = (M_T - M0) / M0\n    return relative_error\n\n\nsolve()\n```", "id": "3580957"}, {"introduction": "Moving from verification to design, this exercise is a theoretical \"pencil-and-paper\" exploration of structure-preserving discretizations. You will derive the discrete energy conservation law for a model of Boussinesq convection, not by running a simulation, but by manipulating the semi-discrete equations themselves [@problem_id:3580972]. This practice demonstrates how careful choices of discrete operators—such as skew-symmetric forms for advection and compatible gradient/divergence pairs—allow us to build numerical schemes that satisfy physical conservation principles by construction.", "problem": "Consider three-dimensional Rayleigh–Bénard convection under the Boussinesq approximation in the inviscid and adiabatic limit. The governing equations express conservation of mass (incompressibility), momentum, and energy for a fluid with constant reference density $\\rho_0$, gravitational acceleration $g$ acting in the negative $z$-direction, and thermal expansion coefficient $\\alpha$. The continuous fields for velocity $\\mathbf{u}(\\mathbf{x},t)$, pressure $p(\\mathbf{x},t)$, and temperature perturbation $T(\\mathbf{x},t)$ satisfy the following laws:\n- Conservation of mass: $\\nabla \\cdot \\mathbf{u} = 0$.\n- Conservation of momentum: $\\rho_0 \\left( \\partial_t \\mathbf{u} + \\mathbf{u}\\cdot\\nabla \\mathbf{u} \\right) = -\\nabla p - \\rho_0 g \\alpha T \\,\\hat{\\mathbf{z}}$.\n- Adiabatic scalar transport: $\\partial_t T + \\mathbf{u}\\cdot\\nabla T = 0$.\n\nLet the computational domain be a rectangular prism discretized by a uniform Cartesian mesh with spacings $\\Delta x$, $\\Delta y$, and $\\Delta z$, and let boundary conditions be periodic in $x$ and $y$ and impenetrable and adiabatic at the top and bottom boundaries, so that the normal velocity vanishes and there is no advective flux through the boundary surfaces. Use a finite-volume viewpoint with primary cell centers located at $(x_i,y_j,z_k)$ and define discrete operators that map between cell-centered and face-centered quantities. In particular, construct a semi-discrete spatial discretization (continuous in time) that respects the following algebraic structure:\n- A discrete divergence operator $D$ mapping face-centered velocities to cell centers, and a discrete gradient operator $G$ mapping cell-centered scalars to faces, such that the discrete summation-by-parts identity holds under the uniform-volume inner products: for any face-centered vector field $\\mathbf{v}$ and cell-centered scalar field $q$, $\\langle \\mathbf{v}, G q \\rangle = - \\langle D \\mathbf{v}, q \\rangle$, where $\\langle \\cdot, \\cdot \\rangle$ denotes the appropriate mass-lumped inner product over the grid with weights $\\Delta V = \\Delta x \\Delta y \\Delta z$.\n- A discrete incompressibility constraint $D \\mathbf{u} = 0$ at all times.\n- Skew-symmetric discretizations of the advective terms for momentum and temperature. For the momentum equation, discretize $\\mathbf{u}\\cdot\\nabla \\mathbf{u}$ in a skew-symmetric form ensuring $\\langle \\mathbf{u}, \\rho_0 (\\mathbf{u}\\cdot\\nabla \\mathbf{u}) \\rangle = 0$ discretely. For the scalar advection, discretize $\\mathbf{u}\\cdot\\nabla T$ in conservative (divergence) form as $D (T \\mathbf{u})$, or an equivalent skew-adjoint form such that $\\langle f, \\mathbf{u}\\cdot\\nabla f \\rangle = 0$ for any cell-centered scalar $f$.\n- The discrete gradient of the geometric coordinate satisfies $G z = \\hat{\\mathbf{z}}$ on vertical faces of a uniform grid, consistent with the exact identity $\\nabla z = \\hat{\\mathbf{z}}$.\n\nDefine the discrete total energy functional\n$$\nE_h(t) \\;=\\; \\frac{1}{2}\\,\\rho_0 \\sum_{i,j,k} \\Delta V \\left( u_{x,i+\\tfrac{1}{2},j,k}^2 + u_{y,i,j+\\tfrac{1}{2},k}^2 + u_{z,i,j,k+\\tfrac{1}{2}}^2 \\right) \\;+\\; \\rho_0 g \\alpha \\sum_{i,j,k} \\Delta V \\, T_{i,j,k}\\, z_k,\n$$\nwhere $u_{x}$, $u_{y}$, and $u_{z}$ denote the face-centered velocity components in the $x$, $y$, and $z$ directions respectively, and $T$ is the cell-centered temperature perturbation.\n\nStarting solely from the stated conservation laws, the discrete operator properties, and standard identities such as $\\nabla z = \\hat{\\mathbf{z}}$ and discrete summation-by-parts, derive the semi-discrete energy balance for $E_h(t)$ under the described structure-preserving discretization. Then, compute the exact value of the discrete time derivative $\\frac{d}{dt} E_h(t)$ in this inviscid, adiabatic limit with the specified boundary conditions. Report your final answer as an exact real number with no units and do not round. The answer must be a single number.", "solution": "The problem requires the calculation of the time derivative of a specified discrete energy functional, $\\frac{d}{dt} E_h(t)$, for a fluid system described by semi-discrete equations for Rayleigh-Bénard convection. The derivation must rely solely on the provided governing equations and the properties of the discrete operators.\n\nThe discrete energy functional is given as the sum of a kinetic energy term, $E_K(t)$, and a potential energy term, $E_P(t)$:\n$$\nE_h(t) = E_K(t) + E_P(t) = \\frac{1}{2}\\,\\rho_0 \\sum \\Delta V |\\mathbf{u}|^2 + \\rho_0 g \\alpha \\sum \\Delta V \\, T z\n$$\nTo write this using the specified inner product notation $\\langle \\cdot, \\cdot \\rangle$, where the inner product implies a summation over all relevant grid points weighted by the cell volume $\\Delta V$, we have:\n$$\nE_h(t) = \\frac{1}{2}\\,\\rho_0 \\langle \\mathbf{u}, \\mathbf{u} \\rangle + \\rho_0 g \\alpha \\langle T, z \\rangle\n$$\nHere, $\\mathbf{u}$ is a face-centered vector field, and $T$ and $z$ are cell-centered scalar fields. We differentiate $E_h(t)$ with respect to time $t$:\n$$\n\\frac{dE_h}{dt} = \\frac{d}{dt} \\left( \\frac{1}{2}\\,\\rho_0 \\langle \\mathbf{u}, \\mathbf{u} \\rangle \\right) + \\frac{d}{dt} \\left( \\rho_0 g \\alpha \\langle T, z \\rangle \\right)\n$$\nBy applying the product rule to the inner products, and noting that the grid coordinates $z$ are constant in time, we get:\n$$\n\\frac{dE_h}{dt} = \\rho_0 \\langle \\mathbf{u}, \\partial_t \\mathbf{u} \\rangle + \\rho_0 g \\alpha \\langle \\partial_t T, z \\rangle\n$$\nWe will now evaluate each of the two terms separately.\n\nFirst, consider the kinetic energy term, $\\rho_0 \\langle \\mathbf{u}, \\partial_t \\mathbf{u} \\rangle$. The semi-discrete momentum equation is given as:\n$$\n\\rho_0 \\left( \\partial_t \\mathbf{u} + \\mathcal{A}_u(\\mathbf{u}) \\right) = -G p - \\rho_0 g \\alpha T_f \\hat{\\mathbf{z}}\n$$\nwhere $\\mathcal{A}_u(\\mathbf{u})$ represents the discrete advection term $\\mathbf{u}\\cdot\\nabla \\mathbf{u}$, $G$ is the discrete gradient operator, and $T_f$ denotes the cell-centered temperature $T$ interpolated to the vector-component locations on the faces. Rearranging for $\\rho_0 \\partial_t \\mathbf{u}$:\n$$\n\\rho_0 \\partial_t \\mathbf{u} = -G p - \\rho_0 \\mathcal{A}_u(\\mathbf{u}) - \\rho_0 g \\alpha T_f \\hat{\\mathbf{z}}\n$$\nSubstituting this into the kinetic energy rate-of-change expression:\n$$\n\\frac{dE_K}{dt} = \\rho_0 \\langle \\mathbf{u}, \\partial_t \\mathbf{u} \\rangle = \\langle \\mathbf{u}, -G p - \\rho_0 \\mathcal{A}_u(\\mathbf{u}) - \\rho_0 g \\alpha T_f \\hat{\\mathbf{z}} \\rangle\n$$\n$$\n\\frac{dE_K}{dt} = -\\langle \\mathbf{u}, G p \\rangle - \\rho_0 \\langle \\mathbf{u}, \\mathcal{A}_u(\\mathbf{u}) \\rangle - \\rho_0 g \\alpha \\langle \\mathbf{u}, T_f \\hat{\\mathbf{z}} \\rangle\n$$\nWe evaluate each of these three terms based on the properties provided in the problem statement:\n$1$. The pressure term: The summation-by-parts identity states $\\langle \\mathbf{v}, G q \\rangle = - \\langle D \\mathbf{v}, q \\rangle$. Applying this with $\\mathbf{v} = \\mathbf{u}$ and $q = p$, we get $-\\langle \\mathbf{u}, G p \\rangle = \\langle D \\mathbf{u}, p \\rangle$. The problem specifies the discrete incompressibility constraint $D \\mathbf{u} = 0$. Thus, $\\langle D \\mathbf{u}, p \\rangle = \\langle 0, p \\rangle = 0$.\n$2$. The advection term: The problem states that the advection term is discretized in a skew-symmetric manner, such that $\\langle \\mathbf{u}, \\rho_0 \\mathcal{A}_u(\\mathbf{u}) \\rangle = 0$. Therefore, this term vanishes.\n$3$. The buoyancy term: The inner product $\\langle \\mathbf{u}, T_f \\hat{\\mathbf{z}} \\rangle$ simplifies. Since $\\hat{\\mathbf{z}}$ is a unit vector in the $z$-direction, the dot product $\\mathbf{u} \\cdot \\hat{\\mathbf{z}}$ is the vertical velocity component, $u_z$. The inner product thus becomes $\\langle u_z, T_f \\rangle$, representing a sum over vertical faces.\n\nCombining these results, the rate of change of kinetic energy is:\n$$\n\\frac{dE_K}{dt} = 0 - 0 - \\rho_0 g \\alpha \\langle u_z, T_f \\rangle = - \\rho_0 g \\alpha \\langle u_z, T_f \\rangle\n$$\n\nSecond, consider the potential energy term, $\\rho_0 g \\alpha \\langle \\partial_t T, z \\rangle$. The semi-discrete adiabatic scalar transport equation is:\n$$\n\\partial_t T + \\mathcal{A}_u(T) = 0\n$$\nwhere $\\mathcal{A}_u(T)$ is the discrete advection operator for a scalar, $\\mathbf{u}\\cdot\\nabla T$. This gives $\\partial_t T = -\\mathcal{A}_u(T)$. Substituting this into the potential energy rate-of-change expression:\n$$\n\\frac{dE_P}{dt} = \\rho_0 g \\alpha \\langle \\partial_t T, z \\rangle = - \\rho_0 g \\alpha \\langle \\mathcal{A}_u(T), z \\rangle\n$$\nThe problem specifies that $\\mathcal{A}_u(T)$ is discretized in a conservative form, as $D(T_f \\mathbf{u})$, where $D$ is the discrete divergence operator.\n$$\n\\frac{dE_P}{dt} = - \\rho_0 g \\alpha \\langle D(T_f \\mathbf{u}), z \\rangle\n$$\nWe again use the summation-by-parts identity $\\langle D \\mathbf{v}, q \\rangle = -\\langle \\mathbf{v}, G q \\rangle$, this time with the face-centered vector field $\\mathbf{v} = T_f \\mathbf{u}$ and the cell-centered scalar field $q=z$.\n$$\n\\frac{dE_P}{dt} = - \\rho_0 g \\alpha \\left( - \\langle T_f \\mathbf{u}, G z \\rangle \\right) = \\rho_0 g \\alpha \\langle T_f \\mathbf{u}, G z \\rangle\n$$\nThe problem provides the crucial property that the discrete gradient of the vertical coordinate is the vertical unit vector: $G z = \\hat{\\mathbf{z}}$.\n$$\n\\frac{dE_P}{dt} = \\rho_0 g \\alpha \\langle T_f \\mathbf{u}, \\hat{\\mathbf{z}} \\rangle\n$$\nThis inner product simplifies to $\\rho_0 g \\alpha \\langle T_f u_z \\rangle$, which is the same as $\\rho_0 g \\alpha \\langle u_z, T_f \\rangle$. Thus:\n$$\n\\frac{dE_P}{dt} = \\rho_0 g \\alpha \\langle u_z, T_f \\rangle\n$$\n\nFinally, we sum the rates of change of kinetic and potential energy to find the total rate of change of $E_h(t)$:\n$$\n\\frac{dE_h}{dt} = \\frac{dE_K}{dt} + \\frac{dE_P}{dt} = \\left( - \\rho_0 g \\alpha \\langle u_z, T_f \\rangle \\right) + \\left( \\rho_0 g \\alpha \\langle u_z, T_f \\rangle \\right) = 0\n$$\nThe two terms cancel exactly. This demonstrates that the specified discrete energy functional $E_h(t)$ is conserved by the semi-discrete system of equations, a property that mirrors the energy conservation of the continuous, inviscid, and adiabatic parent equations. The time derivative is therefore precisely zero.", "answer": "$$\\boxed{0}$$", "id": "3580972"}, {"introduction": "Our final practice tackles the more complex and realistic scenario of dissipative systems, where mechanical energy is not conserved but is converted into other forms, such as heat. You will build an entropy-stable numerical scheme for elastoplastic waves, where energy is dissipated by irreversible plastic deformation [@problem_id:3580945]. This advanced exercise illustrates how the principles of conservation laws are extended to energy inequalities, ensuring that the numerical method correctly captures physical dissipation while remaining stable and not producing spurious energy.", "problem": "Consider the one-dimensional small-strain elastodynamics with elastoplastic rheology in a spatial domain $x \\in [0,L]$, with periodic boundary conditions. The primary fields are velocity $v(x,t)$ and Cauchy stress $\\sigma(x,t)$. The density is $\\rho  0$ and the elastic modulus is $E  0$. Let the total strain be $\\varepsilon(x,t)$ and the plastic strain be $\\varepsilon^p(x,t)$. The first principles base consists of: (i) conservation of linear momentum $ \\rho \\, \\partial_t v = \\partial_x \\sigma$, (ii) kinematic compatibility $\\partial_t \\varepsilon = \\partial_x v$, (iii) Hooke’s law for the elastic response $\\sigma = E (\\varepsilon - \\varepsilon^p)$, and (iv) ideal plasticity with yield stress $\\sigma_y \\ge 0$ and associative flow that enforces $|\\sigma| \\le \\sigma_y$ and plastic dissipation density rate $\\mathcal{D} = \\sigma \\, \\dot{\\varepsilon}^p \\ge 0$. Combining (i)-(iii) yields the symmetric hyperbolic first-order system with a source term,\n$$\n\\partial_t \\begin{bmatrix} v \\\\ \\sigma \\end{bmatrix}\n+ \\partial_x \\begin{bmatrix} -\\sigma/\\rho \\\\ -E v \\end{bmatrix}\n= \\begin{bmatrix} 0 \\\\ -E \\, \\dot{\\varepsilon}^p \\end{bmatrix}.\n$$\nDefine the mechanical energy density\n$$\n\\eta(v,\\sigma) = \\tfrac{1}{2} \\rho v^2 + \\tfrac{1}{2}\\, \\sigma^2/E,\n$$\nand the corresponding energy flux $g(v,\\sigma) = -\\sigma v$. The continuum energy balance implied by (i)-(iv) is\n$$\n\\frac{d}{dt} \\int_0^L \\eta \\, dx = \\left[ g \\right]_0^L - \\int_0^L \\sigma \\, \\dot{\\varepsilon}^p \\, dx,\n$$\nwhich reduces to\n$$\n\\frac{d}{dt} \\int_0^L \\eta \\, dx = - \\int_0^L \\sigma \\, \\dot{\\varepsilon}^p \\, dx \\le 0\n$$\nfor periodic boundaries, since the flux term cancels.\n\nYour task is to construct a piecewise-constant Discontinuous Galerkin (DG) method (which coincides with an upwind finite volume scheme) that is entropy-stable, meaning it satisfies a discrete counterpart of the energy inequality:\n$$\n\\frac{d}{dt} E_h(t) \\le - \\sum_{K} \\int_{K} \\sigma \\, \\dot{\\varepsilon}^p \\, dx,\n$$\nwhere $E_h(t)$ is the semi-discrete total energy. You must base your method on the following principles without shortcut formulas:\n\n1. Start from the weak form of the above first-order system on a partition of $[0,L]$ into $N$ cells of size $\\Delta x = L/N$, with periodic boundaries.\n2. Use a single-degree-of-freedom per cell (piecewise-constant basis) and a two-component state $q = [v,\\sigma]^T$.\n3. Derive the semi-discrete scheme\n$$\n\\frac{d}{dt} q_i(t) = - \\frac{1}{\\Delta x} \\left( f^*_{i+1/2} - f^*_{i-1/2} \\right) + s(q_i),\n$$\nwhere $f(q) = [-\\sigma/\\rho,\\ -E v]^T$, $s(q) = [0,\\ -E \\dot{\\varepsilon}^p]^T$, and $f^*_{i \\pm 1/2}$ are consistent numerical fluxes.\n4. Use the local Lax-Friedrichs (Rusanov) flux with a wave speed bound $\\alpha \\ge \\sqrt{E/\\rho}$ at each interface:\n$$\nf^*(q_L,q_R) = \\tfrac{1}{2}\\left(f(q_L) + f(q_R)\\right) - \\tfrac{1}{2}\\, \\alpha \\, (q_R - q_L).\n$$\n5. Show that the system is symmetric hyperbolic with symmetrizer $H = \\mathrm{diag}(\\rho, 1/E)$ and that the above flux yields a discrete energy inequality of the form\n$$\n\\frac{d}{dt} E_h(t) + \\sum_{\\text{interfaces}} \\tfrac{1}{2}\\, \\alpha \\, \\| \\![ q ]\\!\\|_H^2 \\le - \\sum_{i} \\Delta x \\, \\sigma_i \\, \\dot{\\varepsilon}_i^p,\n$$\nwhere $E_h(t) = \\sum_i \\Delta x \\, \\eta(v_i,\\sigma_i)$, the jump is $\\![ q ]\\! = q_R - q_L$, and $\\|w\\|_H^2 = w^T H w$.\n6. For time discretization, use a Strong Stability Preserving Runge-Kutta (SSP-RK) integrator for the homogeneous part (without plasticity), and then apply a local, cellwise plastic return-mapping projection that enforces $|\\sigma| \\le \\sigma_y$ and accounts for plastic dissipation. In one space dimension with ideal plasticity, a consistent energy-dissipative correction from a trial stress $\\sigma^{\\mathrm{tr}}$ to the admissible stress $\\sigma^{\\mathrm{ad}} = \\sigma_y \\, \\mathrm{sign}(\\sigma^{\\mathrm{tr}})$ when $|\\sigma^{\\mathrm{tr}}|  \\sigma_y$ yields a plastic strain increment\n$$\n\\Delta \\varepsilon^p = \\frac{|\\sigma^{\\mathrm{tr}}| - \\sigma_y}{E},\n$$\nand a plastic dissipation increment per unit volume equal to the line integral of stress along the correction path,\n$$\n\\Delta \\mathcal{D} = \\int \\sigma \\, d\\varepsilon^p = \\tfrac{1}{2}\\left(|\\sigma^{\\mathrm{tr}}|+\\sigma_y\\right)\\Delta \\varepsilon^p = \\frac{|\\sigma^{\\mathrm{tr}}|^2 - \\sigma_y^2}{2E} \\ge 0,\n$$\nwhich exactly equals the reduction of elastic energy density $\\tfrac{1}{2}(\\sigma^2/E)$ across the projection.\n\nYou must implement the above in a single program that advances the solution with periodic boundaries. Use explicit time steps satisfying the Courant-Friedrichs-Lewy (CFL) condition. Accumulate the total plastic dissipation $D_{\\mathrm{tot}}$ by summing the per-cell plastic dissipation increments times the cell volume at each time step.\n\nNumerical units and final outputs:\n\n- Use the International System of Units. Specifically, length $L$ in $\\mathrm{m}$, density $\\rho$ in $\\mathrm{kg/m^3}$, elastic modulus $E$ in $\\mathrm{Pa}$, stress $\\sigma$ and yield stress $\\sigma_y$ in $\\mathrm{Pa}$, time $t$ in $\\mathrm{s}$, and energies in $\\mathrm{J}$.\n- The program must output in a single line a comma-separated list enclosed in square brackets with no spaces, aggregating three floats and three booleans: $[e_1,e_2,e_3,b_1,b_2,b_3]$ where\n  - $e_1$ is the final minus initial total energy $E_h(T) - E_h(0)$ in $\\mathrm{J}$ for the purely elastic test,\n  - $e_2$ is the final energy deficit relative to plastic dissipation $E_h(T) - (E_h(0) - D_{\\mathrm{tot}})$ in $\\mathrm{J}$ for the elastoplastic test,\n  - $e_3$ is the final minus initial energy $E_h(T) - E_h(0)$ in $\\mathrm{J}$ for the near-CFL-limit elastic test,\n  - $b_1$ is a boolean that must be true if $e_1 \\le \\tau_1$ with $\\tau_1 = 10^{-8} E_h(0)$ (no spurious elastic energy growth),\n  - $b_2$ is a boolean that must be true if both $E_h(T) \\le E_h(0) + \\tau_2$ and $e_2 \\le \\tau_2$ with $\\tau_2 = 10^{-8} \\max\\{E_h(0), D_{\\mathrm{tot}}, 1\\}$ (plastic dissipation respected and no spurious growth),\n  - $b_3$ is a boolean that must be true if $e_3 \\le \\tau_3$ with $\\tau_3 = 10^{-8} E_h(0)$ (no spurious growth near the stability limit).\n\nTest suite:\n\nImplement the method for the following three test cases with periodic boundaries and report the metrics as specified above. In all cases, set cross-sectional area equal to $1\\,\\mathrm{m}^2$ so that energies are in $\\mathrm{J}$.\n\n- Test $1$ (pure elasticity, moderate CFL):\n  - $L = 1\\,\\mathrm{m}$,\n  - $N = 200$ cells,\n  - $\\rho = 2500\\,\\mathrm{kg/m^3}$,\n  - $E = 10^{10}\\,\\mathrm{Pa}$,\n  - $\\sigma_y = 10^{18}\\,\\mathrm{Pa}$ (effectively elastic),\n  - initial condition $v(x,0) = 0$, $\\sigma(x,0) = S_0 \\sin(2\\pi x/L)$ with $S_0 = 5 \\times 10^{6}\\,\\mathrm{Pa}$,\n  - CFL number $= 0.5$,\n  - final time $T = 2 \\times 10^{-4}\\,\\mathrm{s}$.\n- Test $2$ (elastoplastic, moderate CFL):\n  - $L = 1\\,\\mathrm{m}$,\n  - $N = 200$ cells,\n  - $\\rho = 2500\\,\\mathrm{kg/m^3}$,\n  - $E = 10^{10}\\,\\mathrm{Pa}$,\n  - $\\sigma_y = 10^{6}\\,\\mathrm{Pa}$,\n  - initial condition $v(x,0) = 0$, $\\sigma(x,0) = S_0 \\sin(2\\pi x/L)$ with $S_0 = 3 \\times 10^{6}\\,\\mathrm{Pa}$,\n  - CFL number $= 0.5$,\n  - final time $T = 2 \\times 10^{-4}\\,\\mathrm{s}$.\n- Test $3$ (pure elasticity, near-CFL-limit):\n  - $L = 1\\,\\mathrm{m}$,\n  - $N = 200$ cells,\n  - $\\rho = 2500\\,\\mathrm{kg/m^3}$,\n  - $E = 5 \\times 10^{10}\\,\\mathrm{Pa}$,\n  - $\\sigma_y = 10^{18}\\,\\mathrm{Pa}$,\n  - initial condition $v(x,0) = 0$, $\\sigma(x,0) = S_0 \\sin(2\\pi x/L)$ with $S_0 = 5 \\times 10^{6}\\,\\mathrm{Pa}$,\n  - CFL number $= 0.95$,\n  - final time $T = 1 \\times 10^{-4}\\,\\mathrm{s}$.\n\nAlgorithmic requirements:\n\n- Use the Rusanov flux as stated and a third-order Strong Stability Preserving Runge-Kutta integrator for the homogeneous part,\n- Apply the local plastic projection at the end of each full time step, and accumulate plastic dissipation using the line-integral expression above,\n- Use periodic boundaries consistently when computing numerical fluxes,\n- Compute and report $e_1$, $e_2$, $e_3$ in $\\mathrm{J}$, and booleans $b_1$, $b_2$, $b_3$ as defined.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\") with no spaces, exactly in the order $[e_1,e_2,e_3,b_1,b_2,b_3]$.", "solution": "The problem is valid. It presents a well-posed physical system grounded in the principles of continuum mechanics, specifically one-dimensional elastodynamics with rate-independent plasticity. The governing equations, initial conditions, boundary conditions, and material parameters are all specified clearly and consistently. The task involves deriving and implementing a standard, entropy-stable numerical method (a finite volume scheme, equivalent to a piecewise-constant discontinuous Galerkin method) to solve the system, which is a common and meaningful exercise in computational geophysics and mechanics. All necessary information is provided, and the problem is free of scientific flaws, ambiguity, or contradictions.\n\nWe proceed to derive the numerical scheme and demonstrate its energy stability, as required.\n\nThe governing equations are given as a first-order system of conservation laws with a source term:\n$$\n\\partial_t \\mathbf{q} + \\partial_x \\mathbf{f}(\\mathbf{q}) = \\mathbf{s}(\\mathbf{q})\n$$\nwhere the state vector is $\\mathbf{q} = [v, \\sigma]^T$, the flux function is $\\mathbf{f}(\\mathbf{q}) = [-\\sigma/\\rho, -E v]^T$, and the source term modeling plastic effects is $\\mathbf{s}(\\mathbf{q}) = [0, -E \\dot{\\varepsilon}^p]^T$.\n\nTo construct the finite volume scheme, we integrate the system over a computational cell $K_i = [x_{i-1/2}, x_{i+1/2}]$ of size $\\Delta x$.\n$$\n\\int_{K_i} \\partial_t \\mathbf{q} \\, dx + \\int_{K_i} \\partial_x \\mathbf{f}(\\mathbf{q}) \\, dx = \\int_{K_i} \\mathbf{s}(\\mathbf{q}) \\, dx\n$$\nUsing the fundamental theorem of calculus on the flux term and approximating the cell integrals using the cell-average values $\\mathbf{q}_i(t) \\approx \\frac{1}{\\Delta x} \\int_{K_i} \\mathbf{q}(x,t) \\, dx$, we get:\n$$\n\\Delta x \\frac{d\\mathbf{q}_i}{dt} + \\left( \\mathbf{f}( \\mathbf{q}(x_{i+1/2},t) ) - \\mathbf{f}( \\mathbf{q}(x_{i-1/2},t) ) \\right) = \\Delta x \\, \\mathbf{s}(\\mathbf{q}_i)\n$$\nAt the cell interfaces $x_{i \\pm 1/2}$, the state $\\mathbf{q}$ is discontinuous. We replace the exact fluxes $\\mathbf{f}$ with a consistent and stable numerical flux function, $\\mathbf{f}^*(\\mathbf{q}_L, \\mathbf{q}_R)$, where $\\mathbf{q}_L = \\mathbf{q}_i$ and $\\mathbf{q}_R = \\mathbf{q}_{i+1}$ are the states to the left and right of the interface. This yields the semi-discrete scheme:\n$$\n\\frac{d\\mathbf{q}_i}{dt} = - \\frac{1}{\\Delta x} \\left( \\mathbf{f}^*_{i+1/2} - \\mathbf{f}^*_{i-1/2} \\right) + \\mathbf{s}(\\mathbf{q}_i)\n$$\nwhere $\\mathbf{f}^*_{i \\pm 1/2}$ denotes $\\mathbf{f}^*(\\mathbf{q}_{i \\pm 1}, \\mathbf{q}_i)$. The problem specifies the local Lax-Friedrichs (Rusanov) flux:\n$$\n\\mathbf{f}^*(\\mathbf{q}_L, \\mathbf{q}_R) = \\frac{1}{2}\\left(\\mathbf{f}(\\mathbf{q}_L) + \\mathbf{f}(\\mathbf{q}_R)\\right) - \\frac{1}{2}\\, \\alpha \\, (\\mathbf{q}_R - \\mathbf{q}_L)\n$$\nwith a stabilization parameter $\\alpha$ that must exceed the maximum wavespeed, $\\alpha \\ge c = \\sqrt{E/\\rho}$.\n\nNext, we demonstrate the entropy stability of this scheme. The mechanical energy density is $\\eta(\\mathbf{q}) = \\frac{1}{2} \\rho v^2 + \\frac{1}{2} \\sigma^2/E$. We can write this in quadratic form as $\\eta(\\mathbf{q}) = \\frac{1}{2} \\mathbf{q}^T H \\mathbf{q}$ with the symmetrizer matrix $H = \\mathrm{diag}(\\rho, 1/E)$. The total discrete energy is $E_h(t) = \\sum_i \\Delta x \\, \\eta(\\mathbf{q}_i)$.\n\nThe flux Jacobian is $A = \\nabla_\\mathbf{q} \\mathbf{f} = \\begin{bmatrix} 0  -1/\\rho \\\\ -E  0 \\end{bmatrix}$. The system is symmetric hyperbolic because the matrix product $HA$ is symmetric:\n$$\nHA = \\begin{bmatrix} \\rho  0 \\\\ 0  1/E \\end{bmatrix} \\begin{bmatrix} 0  -1/\\rho \\\\ -E  0 \\end{bmatrix} = \\begin{bmatrix} 0  -1 \\\\ -1  0 \\end{bmatrix}\n$$\nThe rate of change of the total discrete energy is found by taking the time derivative of $E_h(t)$:\n$$\n\\frac{dE_h}{dt} = \\sum_i \\Delta x \\frac{d\\eta_i}{dt} = \\sum_i \\Delta x (\\nabla_\\mathbf{q} \\eta_i)^T \\frac{d\\mathbf{q}_i}{dt}\n$$\nThe gradient of the energy is $\\nabla_\\mathbf{q} \\eta = H\\mathbf{q}$. Substituting this and the semi-discrete scheme:\n$$\n\\frac{dE_h}{dt} = \\sum_i \\Delta x (H\\mathbf{q}_i)^T \\left[ - \\frac{1}{\\Delta x} \\left( \\mathbf{f}^*_{i+1/2} - \\mathbf{f}^*_{i-1/2} \\right) + \\mathbf{s}(\\mathbf{q}_i) \\right]\n$$\n$$\n\\frac{dE_h}{dt} = \\sum_i -(H\\mathbf{q}_i)^T \\left( \\mathbf{f}^*_{i+1/2} - \\mathbf{f}^*_{i-1/2} \\right) + \\sum_i \\Delta x (H\\mathbf{q}_i)^T \\mathbf{s}(\\mathbf{q}_i)\n$$\nThe source term contribution is the rate of plastic dissipation:\n$$\n\\sum_i \\Delta x (H\\mathbf{q}_i)^T \\mathbf{s}(\\mathbf{q}_i) = \\sum_i \\Delta x [\\rho v_i, \\sigma_i/E]^T [0, -E \\dot{\\varepsilon}^p_i]^T = - \\sum_i \\Delta x \\, \\sigma_i \\dot{\\varepsilon}^p_i \\le 0\n$$\nThe flux term can be rearranged using summation by parts. For periodic boundaries, this gives:\n$$\n\\sum_i -(H\\mathbf{q}_i)^T \\left( \\mathbf{f}^*_{i+1/2} - \\mathbf{f}^*_{i-1/2} \\right) = \\sum_{i+1/2} (H\\mathbf{q}_{i+1} - H\\mathbf{q}_i)^T \\mathbf{f}^*_{i+1/2} = \\sum_{i+1/2} (\\mathbf{q}_{i+1} - \\mathbf{q}_i)^T H \\mathbf{f}^*_{i+1/2}\n$$\nwhere we used that $H$ is symmetric. Let $\\![ \\mathbf{q} ]\\! = \\mathbf{q}_{i+1} - \\mathbf{q}_i$. The sum is $\\sum_{i+1/2} \\![ \\mathbf{q} ]\\!^T H \\mathbf{f}^*$. Substituting the Rusanov flux:\n$$\n\\![ \\mathbf{q} ]\\!^T H \\mathbf{f}^* = \\![ \\mathbf{q} ]\\!^T H \\left[ \\frac{1}{2}(\\mathbf{f}_i + \\mathbf{f}_{i+1}) - \\frac{1}{2}\\alpha \\![ \\mathbf{q} ]\\! \\right] = \\frac{1}{2} \\![ \\mathbf{q} ]\\!^T H (\\mathbf{f}_i + \\mathbf{f}_{i+1}) - \\frac{1}{2}\\alpha \\![ \\mathbf{q} ]\\!^T H \\![ \\mathbf{q} ]\\!\n$$\nSince $\\mathbf{f}(\\mathbf{q}) = A\\mathbf{q}$ and $HA$ is symmetric, we have $\\mathbf{q}_i^T H \\mathbf{f}_{i+1} = \\mathbf{q}_i^T H A \\mathbf{q}_{i+1} = (A \\mathbf{q}_i)^T H \\mathbf{q}_{i+1} = \\mathbf{f}_i^T H \\mathbf{q}_{i+1}$. More directly, $\\mathbf{q}_{i+1}^T H A \\mathbf{q}_i = \\mathbf{q}_i^T (HA)^T \\mathbf{q}_{i+1} = \\mathbf{q}_i^T H A \\mathbf{q}_{i+1}$.\nThe first term expands to $\\frac{1}{2}(\\mathbf{q}_{i+1}^T H\\mathbf{f}_{i+1} - \\mathbf{q}_i^T H\\mathbf{f}_i)$. Summing over all interfaces gives a telescoping sum that is zero due to periodic boundaries. The second term is the numerical dissipation, $-\\frac{1}{2}\\alpha \\|\\![ \\mathbf{q} ]\\!\\|_H^2$, where $\\|\\mathbf{w}\\|_H^2 = \\mathbf{w}^T H \\mathbf{w}$.\nAssembling all terms gives the semi-discrete energy balance:\n$$\n\\frac{dE_h}{dt} = - \\sum_{i+1/2} \\frac{1}{2}\\alpha \\|\\![ \\mathbf{q} ]\\!\\|_H^2 - \\sum_i \\Delta x \\, \\sigma_i \\dot{\\varepsilon}^p_i\n$$\nRearranging and noting that the plastic dissipation rate is non-negative, we arrive at the desired inequality:\n$$\n\\frac{dE_h}{dt} + \\sum_{i+1/2} \\frac{1}{2}\\alpha \\|\\![ \\mathbf{q} ]\\!\\|_H^2 = - \\sum_i \\Delta x \\, \\sigma_i \\dot{\\varepsilon}^p_i \\le 0\n$$\nThis demonstrates that the scheme is entropy-stable: the discrete total energy $E_h$ can only decrease, due to numerical dissipation at interfaces and physical dissipation from plasticity.\n\nThe time integration is performed using an operator splitting approach. The hyperbolic part is advanced using a third-order Strong Stability-Preserving Runge-Kutta (SSP-RK3) method to obtain a trial state $\\mathbf{q}^{\\mathrm{tr}}$. Then, a plastic correction step is applied. For each cell where the trial stress $|\\sigma_i^{\\mathrm{tr}}|$ exceeds the yield stress $\\sigma_y$, the stress is projected back to the yield surface: $\\sigma_i^{\\mathrm{ad}} = \\sigma_y \\, \\mathrm{sign}(\\sigma_i^{\\mathrm{tr}})$. The energy removed by this projection, $\\frac{1}{2E}((\\sigma_i^{\\mathrm{tr}})^2 - \\sigma_y^2)$, is precisely equal to the plastic dissipation increment per unit volume, which is accumulated to track the total dissipation $D_{\\mathrm{tot}}$.", "answer": "```python\nimport numpy as np\n\ndef run_simulation(L, N, rho, E, sigma_y, initial_sigma_func, cfl, T, area=1.0):\n    \"\"\"\n    Runs a single simulation for the 1D elastodynamics problem.\n\n    Args:\n        L (float): Length of the domain in meters.\n        N (int): Number of cells.\n        rho (float): Density in kg/m^3.\n        E (float): Elastic modulus in Pa.\n        sigma_y (float): Yield stress in Pa.\n        initial_sigma_func (callable): Function to set initial stress.\n        cfl (float): CFL number for time step calculation.\n        T (float): Final time in seconds.\n        area (float): Cross-sectional area in m^2.\n\n    Returns:\n        tuple: (initial_energy, final_energy, total_plastic_dissipation).\n    \"\"\"\n    # Grid setup\n    dx = L / N\n    x = np.linspace(dx / 2.0, L - dx / 2.0, N)\n\n    # Physical and numerical parameters\n    c_wave = np.sqrt(E / rho)  # Wave speed\n    alpha = c_wave  # Rusanov flux parameter\n    \n    # Time step determined by CFL condition\n    dt = cfl * dx / alpha\n    num_steps = int(np.ceil(T / dt))\n    dt = T / num_steps # Adjust dt to hit T exactly\n\n    # State vector q = [v, sigma], shape (2, N)\n    q = np.zeros((2, N))\n    # q[0, :] is velocity v(x), initially zero\n    q[1, :] = initial_sigma_func(x, L)  # q[1, :] is stress sigma(x)\n\n    def calculate_energy(q_state):\n        v, sigma = q_state[0, :], q_state[1, :]\n        eta_density = 0.5 * rho * v**2 + 0.5 * sigma**2 / E\n        return np.sum(eta_density) * dx * area\n\n    def flux_function(q_state):\n        v, sigma = q_state[0, :], q_state[1, :]\n        f = np.zeros_like(q_state)\n        f[0, :] = -sigma / rho\n        f[1, :] = -E * v\n        return f\n\n    def rhs_hyperbolic(q_state):\n        \"\"\"Computes the spatial part of the semi-discrete scheme (hyperbolic part).\"\"\"\n        # Periodic boundary conditions are handled using np.roll\n        q_L = q_state\n        q_R = np.roll(q_state, -1, axis=1)\n        \n        f_L = flux_function(q_L)\n        f_R = flux_function(q_R)\n        \n        # Rusanov (Lax-Friedrichs) flux at interfaces i+1/2\n        f_star = 0.5 * (f_L + f_R) - 0.5 * alpha * (q_R - q_L)\n        \n        # Flux at interfaces i-1/2 by rolling\n        f_star_left = np.roll(f_star, 1, axis=1)\n        \n        # RHS = - (f*_{i+1/2} - f*_{i-1/2}) / dx\n        return -(f_star - f_star_left) / dx\n\n    e_initial = calculate_energy(q)\n    d_total = 0.0\n    \n    for _ in range(num_steps):\n        # Time integration for the hyperbolic part using SSP-RK3\n        q_n = q\n        \n        # Stage 1\n        k1 = rhs_hyperbolic(q_n)\n        q1 = q_n + dt * k1\n        \n        # Stage 2\n        k2 = rhs_hyperbolic(q1)\n        q2 = 0.75 * q_n + 0.25 * (q1 + dt * k2)\n        \n        # Stage 3\n        k3 = rhs_hyperbolic(q2)\n        q_trial = (1.0/3.0) * q_n + (2.0/3.0) * (q2 + dt * k3)\n        \n        # Plastic projection step (return mapping)\n        v_trial, sigma_trial = q_trial[0, :], q_trial[1, :]\n        \n        # Identify cells where the trial stress exceeds the yield stress\n        yield_mask = np.abs(sigma_trial) > sigma_y\n        \n        sigma_new = sigma_trial.copy()\n        \n        if np.any(yield_mask):\n            # Calculate dissipation increment per unit volume for yielding cells\n            diss_inc_density = (sigma_trial[yield_mask]**2 - sigma_y**2) / (2.0 * E)\n            \n            # Update total dissipation (integral over volume)\n            d_total += np.sum(diss_inc_density) * dx * area\n            \n            # Project stress back to the yield surface\n            sigma_new[yield_mask] = sigma_y * np.sign(sigma_trial[yield_mask])\n\n        q = np.array([v_trial, sigma_new])\n        \n    e_final = calculate_energy(q)\n    return e_initial, e_final, d_total\n\n\ndef solve():\n    \"\"\"Main function to run test cases and print results.\"\"\"\n    # Define the three test cases from the problem statement.\n    test_cases = {\n        \"case1\": {\n            \"L\": 1.0, \"N\": 200, \"rho\": 2500.0, \"E\": 1e10, \"sigma_y\": 1e18,\n            \"initial_sigma_func\": lambda x, L: 5e6 * np.sin(2 * np.pi * x / L),\n            \"cfl\": 0.5, \"T\": 2e-4\n        },\n        \"case2\": {\n            \"L\": 1.0, \"N\": 200, \"rho\": 2500.0, \"E\": 1e10, \"sigma_y\": 1e6,\n            \"initial_sigma_func\": lambda x, L: 3e6 * np.sin(2 * np.pi * x / L),\n            \"cfl\": 0.5, \"T\": 2e-4\n        },\n        \"case3\": {\n            \"L\": 1.0, \"N\": 200, \"rho\": 2500.0, \"E\": 5e10, \"sigma_y\": 1e18,\n            \"initial_sigma_func\": lambda x, L: 5e6 * np.sin(2 * np.pi * x / L),\n            \"cfl\": 0.95, \"T\": 1e-4\n        }\n    }\n\n    # Run simulations and calculate metrics\n    \n    # Test 1\n    e0_1, ef_1, _ = run_simulation(**test_cases[\"case1\"])\n    e1 = ef_1 - e0_1\n    tau1 = 1e-8 * e0_1\n    b1 = e1 = tau1\n\n    # Test 2\n    e0_2, ef_2, d_tot_2 = run_simulation(**test_cases[\"case2\"])\n    e2 = ef_2 - (e0_2 - d_tot_2)\n    tau2 = 1e-8 * max(e0_2, d_tot_2, 1.0)\n    b2 = (ef_2 = e0_2 + tau2) and (e2 = tau2)\n\n    # Test 3\n    e0_3, ef_3, _ = run_simulation(**test_cases[\"case3\"])\n    e3 = ef_3 - e0_3\n    tau3 = 1e-8 * e0_3\n    b3 = e3 = tau3\n\n    # Aggregate results into the specified order\n    final_results = [e1, e2, e3, b1, b2, b3]\n\n    # Print results in the exact required format\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```", "id": "3580945"}]}