{"hands_on_practices": [{"introduction": "This practice focuses on deriving a high-order one-sided stencil, a crucial tool for handling boundaries in numerical simulations. While central stencils are often preferred for their accuracy, they cannot be used at the edges of a computational domain. This exercise guides you through the fundamental process of using Taylor series moment conditions to construct a third-order accurate approximation for the first derivative, ensuring that your simulation maintains its high fidelity right up to the boundary [@problem_id:3591736].", "problem": "In computational geophysics, boundary closures for finite difference schemes must respect the physics of wave propagation near domain edges. Consider a one-dimensional uniform grid with spacing $h$ used to discretize the spatial derivative of a sufficiently smooth scalar field $f(x)$, for example the pressure field in the one-dimensional acoustic wave equation. At the left boundary $x_0$, you are asked to construct a one-sided approximation to $f'(x_0)$ using only boundary and interior values $f(x_0)$, $f(x_0+h)$, $f(x_0+2h)$, and $f(x_0+3h)$. Starting from the Taylor series definition about $x_0$ and imposing moment conditions so that the approximation is third-order accurate in $h$, determine the unique linear combination of these four samples that yields $f'(x_0)$ up to an error of order $h^3$. Assume $f$ is at least four times continuously differentiable in a neighborhood of $x_0$. Express your final answer as a single simplified closed-form analytic expression in terms of $f(x_0)$, $f(x_0+h)$, $f(x_0+2h)$, $f(x_0+3h)$, and $h$. Do not round; no numerical approximation is required. If you refer to any acronym, such as partial differential equation (PDE), spell it out on first use.", "solution": "We seek a one-sided finite difference approximation for $f'(x_0)$ using values at $x_0$, $x_0+h$, $x_0+2h$, and $x_0+3h$. Let the approximation take the form\n$$\nD_h f(x_0) \\equiv \\frac{1}{h}\\left( w_0 f(x_0) + w_1 f(x_0+h) + w_2 f(x_0+2h) + w_3 f(x_0+3h) \\right),\n$$\nwhere $w_0$, $w_1$, $w_2$, and $w_3$ are dimensionless weights to be determined by enforcing consistency with the Taylor series and achieving third-order accuracy.\n\nUsing the Taylor series expansion of $f$ about $x_0$, for $j \\in \\{0,1,2,3\\}$ we have\n$$\nf(x_0 + j h) = f(x_0) + j h f'(x_0) + \\frac{j^2 h^2}{2} f''(x_0) + \\frac{j^3 h^3}{6} f^{(3)}(x_0) + \\frac{j^4 h^4}{24} f^{(4)}(x_0) + \\mathcal{O}(h^5).\n$$\nSubstituting into $D_h f(x_0)$ yields\n\\begin{align*}\nD_h f(x_0)\n&= \\frac{1}{h}\\sum_{j=0}^{3} w_j \\left[ f(x_0) + j h f'(x_0) + \\frac{j^2 h^2}{2} f''(x_0) + \\frac{j^3 h^3}{6} f^{(3)}(x_0) + \\frac{j^4 h^4}{24} f^{(4)}(x_0) + \\mathcal{O}(h^5) \\right] \\\\\n&= \\left(\\frac{1}{h}\\sum_{j=0}^{3} w_j\\right) f(x_0) + \\left(\\sum_{j=0}^{3} j w_j\\right) f'(x_0) + \\left(\\frac{h}{2}\\sum_{j=0}^{3} j^2 w_j\\right) f''(x_0) \\\\\n&\\quad + \\left(\\frac{h^2}{6}\\sum_{j=0}^{3} j^3 w_j\\right) f^{(3)}(x_0) + \\left(\\frac{h^3}{24}\\sum_{j=0}^{3} j^4 w_j\\right) f^{(4)}(x_0) + \\mathcal{O}(h^4).\n\\end{align*}\nTo ensure consistency for the derivative and third-order accuracy, we impose the following moment conditions:\n$$\n\\sum_{j=0}^{3} w_j = 0, \\quad \\sum_{j=0}^{3} j w_j = 1, \\quad \\sum_{j=0}^{3} j^2 w_j = 0, \\quad \\sum_{j=0}^{3} j^3 w_j = 0.\n$$\nThese conditions eliminate the zeroth-, second-, and third-derivative contamination and normalize the first derivative, leaving a leading truncation error of order $h^3$ from the fourth derivative term.\n\nLet us write the system explicitly for $w_0$, $w_1$, $w_2$, and $w_3$:\n\\begin{align*}\nw_0 + w_1 + w_2 + w_3 &= 0, \\\\\n0\\cdot w_0 + 1\\cdot w_1 + 2\\cdot w_2 + 3\\cdot w_3 &= 1, \\\\\n0^2\\cdot w_0 + 1^2\\cdot w_1 + 2^2\\cdot w_2 + 3^2\\cdot w_3 &= 0, \\\\\n0^3\\cdot w_0 + 1^3\\cdot w_1 + 2^3\\cdot w_2 + 3^3\\cdot w_3 &= 0.\n\\end{align*}\nEliminate $w_0$ using the first equation, $w_0 = -w_1 - w_2 - w_3$, and solve the remaining three equations for $w_1$, $w_2$, and $w_3$:\n\\begin{align*}\nw_1 + 2 w_2 + 3 w_3 &= 1, \\\\\nw_1 + 4 w_2 + 9 w_3 &= 0, \\\\\nw_1 + 8 w_2 + 27 w_3 &= 0.\n\\end{align*}\nSubtract the first from the second and the second from the third:\n\\begin{align*}\n(4-2) w_2 + (9-3) w_3 &= -1 \\quad \\Rightarrow \\quad 2 w_2 + 6 w_3 = -1, \\\\\n(8-4) w_2 + (27-9) w_3 &= 0 \\quad \\Rightarrow \\quad 4 w_2 + 18 w_3 = 0.\n\\end{align*}\nFrom $4 w_2 + 18 w_3 = 0$ we obtain $w_2 = -\\frac{9}{2} w_3$. Substitute into $2 w_2 + 6 w_3 = -1$:\n$$\n2\\left(-\\frac{9}{2} w_3\\right) + 6 w_3 = -1 \\quad \\Rightarrow \\quad -9 w_3 + 6 w_3 = -1 \\quad \\Rightarrow \\quad -3 w_3 = -1 \\quad \\Rightarrow \\quad w_3 = \\frac{1}{3}.\n$$\nThen $w_2 = -\\frac{9}{2}\\cdot \\frac{1}{3} = -\\frac{3}{2}$, and from $w_1 + 2 w_2 + 3 w_3 = 1$,\n$$\nw_1 + 2\\left(-\\frac{3}{2}\\right) + 3\\left(\\frac{1}{3}\\right) = 1 \\quad \\Rightarrow \\quad w_1 - 3 + 1 = 1 \\quad \\Rightarrow \\quad w_1 = 3.\n$$\nFinally, $w_0 = -w_1 - w_2 - w_3 = -\\left(3 - \\frac{3}{2} + \\frac{1}{3}\\right) = -\\frac{11}{6}$.\n\nThus the approximation is\n$$\nD_h f(x_0) = \\frac{1}{h}\\left( -\\frac{11}{6} f(x_0) + 3 f(x_0+h) - \\frac{3}{2} f(x_0+2h) + \\frac{1}{3} f(x_0+3h) \\right) = \\frac{-11 f(x_0) + 18 f(x_0+h) - 9 f(x_0+2h) + 2 f(x_0+3h)}{6 h}.\n$$\nTo confirm the third-order accuracy, compute the coefficient of the $h^3 f^{(4)}(x_0)$ term:\n$$\n\\sum_{j=0}^{3} j^4 w_j = 0^4 w_0 + 1^4 w_1 + 2^4 w_2 + 3^4 w_3 = 0 + 3 + 16\\left(-\\frac{3}{2}\\right) + 81\\left(\\frac{1}{3}\\right) = 3 - 24 + 27 = 6.\n$$\nTherefore,\n$$\nD_h f(x_0) = f'(x_0) + \\frac{h^3}{24}\\cdot 6\\, f^{(4)}(x_0) + \\mathcal{O}(h^4) = f'(x_0) + \\frac{h^3}{4} f^{(4)}(x_0) + \\mathcal{O}(h^4),\n$$\nwhich verifies a third-order accurate truncation error. The requested closed-form expression is as above.", "answer": "$$\\boxed{\\frac{-11 f(x_0) + 18 f(x_0+h) - 9 f(x_0+2h) + 2 f(x_0+3h)}{6 h}}$$", "id": "3591736"}, {"introduction": "Understanding the theoretical truncation error is key, but seeing it in action provides deeper insight. This practice first tasks you with deriving a fourth-order accurate central difference stencil, a workhorse in many geophysical modeling codes. You will then apply this stencil to a simple polynomial function, a scenario where the theoretical error term can be calculated exactly, allowing you to directly verify that the numerical error scales with the grid spacing $h$ as predicted by the Taylor series analysis [@problem_id:3591785].", "problem": "In high-order numerical modeling of seismic wavefields in computational geophysics, spatial derivatives are often approximated by Finite Difference (FD) operators constructed from Taylor series expansions to control numerical dispersion. Consider a smooth scalar field derivative approximation at a point using a symmetric five-point stencil. Starting from Taylor series expansions about a point $x$ for the values $f(x \\pm h)$ and $f(x \\pm 2h)$, construct a linear combination that approximates $f^{\\prime}(x)$ with fourth-order accuracy in the grid spacing $h$. You must determine the coefficients by enforcing consistency with the Taylor series and canceling lower-order error terms.\n\nAfter deriving the fourth-order accurate central difference approximation for $f^{\\prime}(x)$, apply it to the function $f(x) = x^{5}$ at $x = 0$ with grid spacing $h = 0.1$, and compute:\n- the approximate derivative using the derived stencil,\n- the exact derivative,\n- the leading-order truncation error term from your Taylor-series-based derivation, and specialize it to this function.\n\nDefine the non-dimensional error amplification factor\n$$E \\equiv \\frac{f^{\\prime}_{\\text{FD}}(x) - f^{\\prime}(x)}{h^{4}}$$\nevaluated at $x=0$ with $h=0.1$. Provide the value of $E$. No rounding is required. Report only the value of $E$ as your final answer, with no units.", "solution": "The objective is to derive a fourth-order accurate, symmetric five-point finite difference approximation for the first derivative, $f^{\\prime}(x)$, and then apply it to a specific function.\n\nFirst, we establish the general form of a symmetric five-point approximation for the first derivative $f^{\\prime}(x)$ at a point $x$. Due to the anti-symmetric nature required for a first derivative approximation on a symmetric stencil, the form can be written as a linear combination of differences:\n$$f^{\\prime}_{\\text{FD}}(x) = \\frac{a_1 [f(x+h) - f(x-h)] + a_2 [f(x+2h) - f(x-2h)]}{h}$$\nwhere $a_1$ and $a_2$ are coefficients to be determined, and $h$ is the grid spacing.\n\nWe use Taylor series expansions for $f(x \\pm kh)$ around the point $x$. We need to retain terms up to at least the fifth derivative to determine the fourth-order error term.\n$$f(x \\pm h) = f(x) \\pm h f^{\\prime}(x) + \\frac{h^2}{2!} f^{\\prime\\prime}(x) \\pm \\frac{h^3}{3!} f^{\\prime\\prime\\prime}(x) + \\frac{h^4}{4!} f^{(4)}(x) \\pm \\frac{h^5}{5!} f^{(5)}(x) + \\mathcal{O}(h^6)$$\n$$f(x \\pm 2h) = f(x) \\pm (2h) f^{\\prime}(x) + \\frac{(2h)^2}{2!} f^{\\prime\\prime}(x) \\pm \\frac{(2h)^3}{3!} f^{\\prime\\prime\\prime}(x) + \\frac{(2h)^4}{4!} f^{(4)}(x) \\pm \\frac{(2h)^5}{5!} f^{(5)}(x) + \\mathcal{O}(h^6)$$\n\nFrom these expansions, we construct the difference terms:\n$$f(x+h) - f(x-h) = 2h f^{\\prime}(x) + \\frac{2h^3}{6} f^{\\prime\\prime\\prime}(x) + \\frac{2h^5}{120} f^{(5)}(x) + \\mathcal{O}(h^7)$$\n$$f(x+h) - f(x-h) = 2h f^{\\prime}(x) + \\frac{h^3}{3} f^{\\prime\\prime\\prime}(x) + \\frac{h^5}{60} f^{(5)}(x) + \\mathcal{O}(h^7)$$\nAnd for the outer points:\n$$f(x+2h) - f(x-2h) = 2(2h) f^{\\prime}(x) + \\frac{2(2h)^3}{6} f^{\\prime\\prime\\prime}(x) + \\frac{2(2h)^5}{120} f^{(5)}(x) + \\mathcal{O}(h^7)$$\n$$f(x+2h) - f(x-2h) = 4h f^{\\prime}(x) + \\frac{8h^3}{3} f^{\\prime\\prime\\prime}(x) + \\frac{8h^5}{15} f^{(5)}(x) + \\mathcal{O}(h^7)$$\n\nSubstituting these back into the expression for $f^{\\prime}_{\\text{FD}}(x)$:\n$$f^{\\prime}_{\\text{FD}}(x) = \\frac{a_1}{h} \\left( 2h f^{\\prime}(x) + \\frac{h^3}{3} f^{\\prime\\prime\\prime}(x) + \\frac{h^5}{60} f^{(5)}(x) + \\dots \\right) + \\frac{a_2}{h} \\left( 4h f^{\\prime}(x) + \\frac{8h^3}{3} f^{\\prime\\prime\\prime}(x) + \\frac{8h^5}{15} f^{(5)}(x) + \\dots \\right)$$\nGrouping terms by the derivatives of $f(x)$:\n$$f^{\\prime}_{\\text{FD}}(x) = (2a_1 + 4a_2) f^{\\prime}(x) + \\left( \\frac{a_1}{3} + \\frac{8a_2}{3} \\right) h^2 f^{\\prime\\prime\\prime}(x) + \\left( \\frac{a_1}{60} + \\frac{8a_2}{15} \\right) h^4 f^{(5)}(x) + \\mathcal{O}(h^6)$$\n\nFor this expression to be a consistent approximation of $f^{\\prime}(x)$, the coefficient of $f^{\\prime}(x)$ must be $1$. To achieve fourth-order accuracy, the error term of order $h^2$ must be zero. This gives us a system of two linear equations for $a_1$ and $a_2$:\n1. $2a_1 + 4a_2 = 1$\n2. $\\frac{a_1}{3} + \\frac{8a_2}{3} = 0 \\implies a_1 + 8a_2 = 0$\n\nFrom equation (2), we have $a_1 = -8a_2$. Substituting this into equation (1):\n$2(-8a_2) + 4a_2 = 1 \\implies -16a_2 + 4a_2 = 1 \\implies -12a_2 = 1 \\implies a_2 = -\\frac{1}{12}$.\nThen, $a_1 = -8(-\\frac{1}{12}) = \\frac{8}{12} = \\frac{2}{3}$.\n\nThe finite difference formula is:\n$$f^{\\prime}_{\\text{FD}}(x) = \\frac{\\frac{2}{3}[f(x+h) - f(x-h)] - \\frac{1}{12}[f(x+2h) - f(x-2h)]}{h}$$\n$$f^{\\prime}_{\\text{FD}}(x) = \\frac{1}{12h} \\left( 8[f(x+h) - f(x-h)] - [f(x+2h) - f(x-2h)] \\right)$$\n$$f^{\\prime}_{\\text{FD}}(x) = \\frac{f(x-2h) - 8f(x-h) + 8f(x+h) - f(x+2h)}{12h}$$\n\nThe leading-order truncation error is the first non-zero term after $f^{\\prime}(x)$. This is the term containing $h^4 f^{(5)}(x)$:\n$$\\text{Error} = f^{\\prime}_{\\text{FD}}(x) - f^{\\prime}(x) = \\left( \\frac{a_1}{60} + \\frac{8a_2}{15} \\right) h^4 f^{(5)}(x) + \\mathcal{O}(h^6)$$\nSubstituting the values of $a_1 = \\frac{2}{3}$ and $a_2 = -\\frac{1}{12}$:\n$$\\text{Error} = \\left( \\frac{2/3}{60} + \\frac{8(-1/12)}{15} \\right) h^4 f^{(5)}(x) = \\left( \\frac{2}{180} - \\frac{8}{180} \\right) h^4 f^{(5)}(x) = -\\frac{6}{180} h^4 f^{(5)}(x)$$\n$$\\text{Error} = -\\frac{1}{30} h^4 f^{(5)}(x)$$\nThis is the leading-order truncation error term.\n\nNow we apply this to the function $f(x) = x^5$ at $x=0$ with $h=0.1$.\nThe exact derivative is $f^{\\prime}(x) = 5x^4$. At $x=0$, the exact value is $f^{\\prime}(0) = 5(0)^4 = 0$.\n\nWe compute the approximate derivative using the stencil. The required function values are:\n$f(h) = f(0.1) = (0.1)^5 = 10^{-5}$\n$f(-h) = f(-0.1) = (-0.1)^5 = -10^{-5}$\n$f(2h) = f(0.2) = (0.2)^5 = 32 \\times 10^{-5}$\n$f(-2h) = f(-0.2) = (-0.2)^5 = -32 \\times 10^{-5}$\n\nSubstituting into the formula for $f^{\\prime}_{\\text{FD}}(0)$:\n$$f^{\\prime}_{\\text{FD}}(0) = \\frac{f(-0.2) - 8f(-0.1) + 8f(0.1) - f(0.2)}{12(0.1)}$$\n$$f^{\\prime}_{\\text{FD}}(0) = \\frac{(-32 \\times 10^{-5}) - 8(-10^{-5}) + 8(10^{-5}) - (32 \\times 10^{-5})}{1.2}$$\n$$f^{\\prime}_{\\text{FD}}(0) = \\frac{(-32 + 8 + 8 - 32) \\times 10^{-5}}{1.2} = \\frac{-48 \\times 10^{-5}}{1.2} = -40 \\times 10^{-5} = -4 \\times 10^{-4}$$\n\nNext, we evaluate the leading-order truncation error term. We need the fifth derivative of $f(x)=x^5$:\n$f^{\\prime}(x) = 5x^4$\n$f^{\\prime\\prime}(x) = 20x^3$\n$f^{\\prime\\prime\\prime}(x) = 60x^2$\n$f^{(4)}(x) = 120x$\n$f^{(5)}(x) = 120$\nThe fifth derivative is a constant, so $f^{(5)}(0) = 120$. All higher derivatives are zero.\nThe theoretical error is:\n$$\\text{Error} = -\\frac{1}{30} h^4 f^{(5)}(0) = -\\frac{1}{30} (0.1)^4 (120) = -4 \\times (0.1)^4 = -4 \\times 10^{-4}$$\nThe actual error is $f^{\\prime}_{\\text{FD}}(0) - f^{\\prime}(0) = -4 \\times 10^{-4} - 0 = -4 \\times 10^{-4}$. The theoretical error matches the actual error exactly because all higher-order error terms, which involve derivatives $f^{(n)}(x)$ for $n>5$, are zero for the function $f(x)=x^5$.\n\nFinally, we compute the non-dimensional error amplification factor $E$:\n$$E \\equiv \\frac{f^{\\prime}_{\\text{FD}}(x) - f^{\\prime}(x)}{h^{4}}$$\nAt $x=0$ with $h=0.1$:\n$$E = \\frac{-4 \\times 10^{-4}}{(0.1)^4} = \\frac{-4 \\times 10^{-4}}{10^{-4}} = -4$$\nAlternatively, using the analytical error expression:\n$$E = \\frac{-\\frac{1}{30} h^4 f^{(5)}(0)}{h^4} = -\\frac{1}{30} f^{(5)}(0) = -\\frac{120}{30} = -4$$\nThe value of $E$ is exactly $-4$.", "answer": "$$\\boxed{-4}$$", "id": "3591785"}, {"introduction": "Moving beyond single-point derivations, this comprehensive exercise challenges you to implement and compare two different types of fourth-order schemes: explicit and compact. Compact schemes offer superior spectral properties for a given stencil width, making them highly valuable for wave propagation problems, but they require solving a system of equations. By implementing both and measuring their error on a sinusoidal function, you will gain practical experience in the trade-offs between computational cost and accuracy that are central to designing numerical models [@problem_id:3591782].", "problem": "You are tasked with deriving and implementing finite difference schemes for approximating the first derivative of a smooth function that arise naturally in computational geophysics. The foundational base must be the Taylor series expansion of a smooth function on a uniform grid. Consider a uniform grid with spacing $h$ and nodes $x_i = x_0 + i h$ for integer $i$, and a smooth function $f(x)$. The objective is to derive, from Taylor series expansions, the interior coefficients of a fourth-order compact finite difference scheme for the first derivative, as well as the fourth-order explicit central difference scheme. Then, apply both schemes to approximate $f'(x)$ for $f(x) = \\sin(5x)$ at grid spacing $h = 0.1$, quantify the numerical error of each scheme relative to the exact derivative $f'(x) = 5 \\cos(5x)$, and compute the ratio of the root-mean-square errors of the compact scheme to the explicit scheme.\n\nStart from the Taylor series expansions about $x_i$ for $f(x_{i \\pm 1})$, $f(x_{i \\pm 2})$, $f'(x_{i \\pm 1})$, and proceed to construct:\n1. An interior tridiagonal relation of the form $\\alpha f'_{i-1} + f'_i + \\alpha f'_{i+1} = \\frac{\\beta}{h}\\left(f_{i+1} - f_{i-1}\\right)$ with coefficients $\\alpha$ and $\\beta$ chosen to achieve fourth-order accuracy.\n2. A fourth-order explicit central difference stencil for $f'(x_i)$ built from $f_{i-2}$, $f_{i-1}$, $f_{i+1}$, and $f_{i+2}$.\n\nExplain how to handle boundaries for the compact scheme using consistent one-sided fourth-order approximations for $f'(x)$ at the first and last grid points, and demonstrate how the interior tridiagonal system can be solved to obtain $f'(x)$ on the interior grid points. Express all angles in radians.\n\nDefine the domain as $x \\in [0, L]$ with $L = 1.0$ and $h = 0.1$, so that the grid nodes are $x_i = i h$ for $i = 0,1,\\dots,N$ where $N = L/h$. For the explicit fourth-order central difference, compute approximations only at indices $i$ where the stencil is valid (i.e., $i \\in \\{2,3,\\dots,N-2\\}$). For the compact scheme, solve the tridiagonal system for interior indices $i \\in \\{1,2,\\dots,N-1\\}$ using one-sided fourth-order closures at $i=0$ and $i=N$.\n\nDefine the error metrics as the root-mean-square of the pointwise error relative to the exact derivative, restricted to indices where the explicit stencil is valid, namely\n$$\n\\mathrm{RMSE}_{\\mathrm{explicit}} = \\sqrt{\\frac{1}{M}\\sum_{i=2}^{N-2} \\left( D^{\\mathrm{explicit}}_i - f'_{\\mathrm{exact}}(x_i)\\right)^2}, \\quad\n\\mathrm{RMSE}_{\\mathrm{compact}} = \\sqrt{\\frac{1}{M}\\sum_{i=2}^{N-2} \\left( D^{\\mathrm{compact}}_i - f'_{\\mathrm{exact}}(x_i)\\right)^2},\n$$\nwhere $M = N-3$. Quantify the relative performance by the ratio\n$$\nR = \\frac{\\mathrm{RMSE}_{\\mathrm{compact}}}{\\mathrm{RMSE}_{\\mathrm{explicit}}}.\n$$\nAngles must be treated in radians.\n\nImplement a complete, runnable program that:\n- Constructs the grid and function values for $f(x) = \\sin(k x)$ with $k \\in \\{5,10,25\\}$ and $h = 0.1$ on $x \\in [0,1]$.\n- Computes $f'(x)$ using the derived fourth-order compact scheme with one-sided fourth-order boundary closures and solves the resulting tridiagonal interior system.\n- Computes $f'(x)$ using the derived fourth-order explicit central difference scheme.\n- Computes the exact derivative $f'(x) = k \\cos(k x)$ and evaluates the root-mean-square errors on the indices $i \\in \\{2,\\dots,N-2\\}$.\n- Returns the ratio $R$ for each test case.\n\nTest Suite:\n- Case $1$: $k = 5$, $h = 0.1$, $L = 1.0$.\n- Case $2$: $k = 10$, $h = 0.1$, $L = 1.0$.\n- Case $3$: $k = 25$, $h = 0.1$, $L = 1.0$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[result1,result2,result3]\"). The output list elements must be floating-point numbers. Angles and trigonometric evaluations must be in radians.", "solution": "The problem requires the derivation, implementation, and comparison of two fourth-order finite difference schemes for the first derivative of a smooth function $f(x)$ on a uniform grid. The foundation for these derivations is the Taylor series expansion.\n\nLet the grid be defined by nodes $x_i = x_0 + i h$ for integer $i$, where $h$ is the uniform grid spacing. We denote the function value at a node as $f_i = f(x_i)$. The Taylor series expansion of $f(x)$ around $x_i$ is given by:\n$$\nf(x_i + \\delta x) = \\sum_{n=0}^{\\infty} \\frac{(\\delta x)^n}{n!} f^{(n)}(x_i)\n$$\nwhere $f^{(n)}(x_i)$ is the $n$-th derivative of $f$ evaluated at $x_i$. Using this, we can write expansions for neighboring points:\n$$\nf_{i \\pm k} = f(x_i \\pm kh) = f_i \\pm (kh)f'_i + \\frac{(kh)^2}{2!}f''_i \\pm \\frac{(kh)^3}{3!}f'''_i + \\frac{(kh)^4}{4!}f^{(4)}_i \\pm \\dots\n$$\nSimilarly, we can expand the derivatives of $f$:\n$$\nf'_{i \\pm k} = f'(x_i \\pm kh) = f'_i \\pm (kh)f''_i + \\frac{(kh)^2}{2!}f'''_i \\pm \\frac{(kh)^3}{3!}f^{(4)}_i + \\dots\n$$\n\n**1. Derivation of the Fourth-Order Compact Finite Difference Scheme**\n\nWe seek coefficients $\\alpha$ and $\\beta$ for the tridiagonal relation:\n$$\n\\alpha f'_{i-1} + f'_i + \\alpha f'_{i+1} = \\frac{\\beta}{h}(f_{i+1} - f_{i-1})\n$$\nThe goal is to choose $\\alpha$ and $\\beta$ to maximize the order of accuracy. We substitute the Taylor series expansions for each term around the central point $x_i$.\n\nThe left-hand side (LHS) is:\n$$\n\\text{LHS} = \\alpha (f'_{i-1} + f'_{i+1}) + f'_i\n$$\nUsing the expansions for $f'_{i \\pm 1}$:\n$$\nf'_{i+1} = f'_i + h f''_i + \\frac{h^2}{2} f'''_i + \\frac{h^3}{6} f^{(4)}_i + \\frac{h^4}{24} f^{(5)}_i + \\mathcal{O}(h^5)\n$$\n$$\nf'_{i-1} = f'_i - h f''_i + \\frac{h^2}{2} f'''_i - \\frac{h^3}{6} f^{(4)}_i + \\frac{h^4}{24} f^{(5)}_i - \\mathcal{O}(h^5)\n$$\nSumming these two gives:\n$$\nf'_{i+1} + f'_{i-1} = 2f'_i + h^2 f'''_i + \\frac{h^4}{12} f^{(5)}_i + \\mathcal{O}(h^6)\n$$\nSubstituting this into the LHS expression:\n$$\n\\text{LHS} = \\alpha(2f'_i + h^2 f'''_i + \\frac{h^4}{12} f^{(5)}_i) + f'_i + \\mathcal{O}(\\alpha h^6) = (1 + 2\\alpha)f'_i + \\alpha h^2 f'''_i + \\frac{\\alpha h^4}{12} f^{(5)}_i + \\mathcal{O}(\\alpha h^6)\n$$\n\nThe right-hand side (RHS) is:\n$$\n\\text{RHS} = \\frac{\\beta}{h}(f_{i+1} - f_{i-1})\n$$\nUsing the expansions for $f_{i \\pm 1}$:\n$$\nf_{i+1} - f_{i-1} = (f_i + hf'_i + \\frac{h^2}{2}f''_i + \\frac{h^3}{6}f'''_i + \\dots) - (f_i - hf'_i + \\frac{h^2}{2}f''_i - \\frac{h^3}{6}f'''_i + \\dots)\n$$\n$$\nf_{i+1} - f_{i-1} = 2h f'_i + \\frac{h^3}{3} f'''_i + \\frac{h^5}{60} f^{(5)}_i + \\mathcal{O}(h^7)\n$$\nSubstituting this into the RHS expression:\n$$\n\\text{RHS} = \\frac{\\beta}{h} \\left( 2h f'_i + \\frac{h^3}{3} f'''_i + \\frac{h^5}{60} f^{(5)}_i + \\mathcal{O}(h^7) \\right) = 2\\beta f'_i + \\frac{\\beta h^2}{3} f'''_i + \\frac{\\beta h^4}{60} f^{(5)}_i + \\mathcal{O}(\\beta h^6)\n$$\n\nTo achieve the highest accuracy, we equate the LHS and RHS and match coefficients of the derivatives of $f$ at $x_i$:\n$$\n(1 + 2\\alpha)f'_i + \\alpha h^2 f'''_i + \\dots = 2\\beta f'_i + \\frac{\\beta h^2}{3} f'''_i + \\dots\n$$\nMatching coefficients for $f'_i$ and $f'''_i$:\n1. Coefficient of $f'_i$: $1 + 2\\alpha = 2\\beta$\n2. Coefficient of $f'''_i$: $\\alpha h^2 = \\frac{\\beta h^2}{3} \\implies \\alpha = \\frac{\\beta}{3}$\n\nWe solve this system of two linear equations. Substituting (2) into (1):\n$$\n1 + 2\\left(\\frac{\\beta}{3}\\right) = 2\\beta \\implies 1 = 2\\beta - \\frac{2\\beta}{3} = \\frac{4\\beta}{3} \\implies \\beta = \\frac{3}{4}\n$$\nNow, we find $\\alpha$:\n$$\n\\alpha = \\frac{1}{3} \\beta = \\frac{1}{3} \\left(\\frac{3}{4}\\right) = \\frac{1}{4}\n$$\nThus, the fourth-order compact scheme is defined by $\\alpha = 1/4$ and $\\beta = 3/4$. The truncation error (T.E.) is determined by the lowest-order derivative whose coefficients do not match. The equation for the scheme is LHS - RHS = $0$. The T.E. is the first non-zero term in that difference.\n$$\n\\text{T.E.} = \\left( \\frac{\\alpha h^4}{12} - \\frac{\\beta h^4}{60} \\right) f^{(5)}_i = h^4 \\left( \\frac{1/4}{12} - \\frac{3/4}{60} \\right) f^{(5)}_i = h^4 \\left( \\frac{1}{48} - \\frac{3}{240} \\right) f^{(5)}_i = h^4 \\left( \\frac{5-3}{240} \\right) f^{(5)}_i = \\frac{2}{240} h^4 f^{(5)}_i = \\frac{1}{120} h^4 f^{(5)}_i\n$$\nThe scheme is fourth-order accurate, as the leading error term is proportional to $h^4$.\n\n**2. Derivation of the Fourth-Order Explicit Central Difference Scheme**\n\nWe seek an approximation for $f'_i$ using function values at $f_{i \\pm 1}$ and $f_{i \\pm 2}$:\n$$\nf'_i \\approx A(f_{i+1} - f_{i-1}) + B(f_{i+2} - f_{i-2})\n$$\nWe use the Taylor series expansions for these differences:\n$$\nf_{i+1} - f_{i-1} = 2h f'_i + \\frac{h^3}{3} f'''_i + \\frac{h^5}{60} f^{(5)}_i + \\mathcal{O}(h^7)\n$$\n$$\nf_{i+2} - f_{i-2} = 2(2h)f'_i + \\frac{(2h)^3}{3}f'''_i + \\frac{(2h)^5}{60}f^{(5)}_i + \\mathcal{O}(h^7) = 4h f'_i + \\frac{8h^3}{3} f'''_i + \\frac{32h^5}{60} f^{(5)}_i + \\mathcal{O}(h^7)\n$$\nSubstituting these into the approximation formula:\n$$\nf'_i \\approx A \\left( 2h f'_i + \\frac{h^3}{3} f'''_i + \\dots \\right) + B \\left( 4h f'_i + \\frac{8h^3}{3} f'''_i + \\dots \\right)\n$$\n$$\nf'_i \\approx (2hA + 4hB)f'_i + \\left(\\frac{h^3}{3}A + \\frac{8h^3}{3}B\\right)f'''_i + \\dots\n$$\nTo obtain a fourth-order accurate approximation for $f'_i$, we must satisfy:\n1. Coefficient of $f'_i$: $2hA + 4hB = 1$\n2. Coefficient of $f'''_i$: $\\frac{h^3}{3}A + \\frac{8h^3}{3}B = 0 \\implies A + 8B = 0 \\implies A = -8B$\n\nSolve this system. Substitute (2) into (1):\n$$\n2h(-8B) + 4hB = 1 \\implies -16hB + 4hB = 1 \\implies -12hB = 1 \\implies B = -\\frac{1}{12h}\n$$\nThen, find $A$:\n$$\nA = -8B = -8\\left(-\\frac{1}{12h}\\right) = \\frac{8}{12h} = \\frac{2}{3h}\n$$\nSubstituting $A$ and $B$ back into the formula gives the scheme:\n$$\nf'_i \\approx \\frac{2}{3h}(f_{i+1} - f_{i-1}) - \\frac{1}{12h}(f_{i+2} - f_{i-2}) = \\frac{1}{12h} \\left[ 8(f_{i+1} - f_{i-1}) - (f_{i+2} - f_{i-2}) \\right]\n$$\n$$\nf'_i \\approx \\frac{1}{12h} (f_{i-2} - 8 f_{i-1} + 8 f_{i+1} - f_{i+2})\n$$\nThe truncation error is determined by the next term in the expansion. The approximate derivative is $f'_{i, \\text{approx}} = f'_i + C h^4 f^{(5)}_i + \\dots$. The error term is:\n$$\n\\text{T.E.} = f'_{i, \\text{exact}} - f'_{i, \\text{approx}} = -\\left(A \\frac{h^5}{60} + B \\frac{32h^5}{60}\\right) f^{(5)}_i = -\\frac{h^4}{60} (hA + 32hB) f^{(5)}_i\n$$\nSubstituting $hA = 2/3$ and $hB = -1/12$:\n$$\n\\text{T.E.} = -\\frac{h^4}{60} \\left(\\frac{2}{3} + 32\\left(-\\frac{1}{12}\\right)\\right)f^{(5)}_i = -\\frac{h^4}{60} \\left(\\frac{2}{3} - \\frac{8}{3}\\right)f^{(5)}_i = -\\frac{h^4}{60} (-2)f^{(5)}_i = \\frac{h^4}{30} f^{(5)}_i\n$$\nThis scheme is also fourth-order accurate.\n\n**3. Implementation and Boundary Conditions**\n\nThe problem is solved on the domain $x \\in [0, L]$ with $L=1.0$ and $h=0.1$. This defines a grid with $N = L/h = 10$ intervals and $N+1=11$ points, $x_i = ih$ for $i=0, 1, \\dots, 10$.\n\nThe explicit scheme requires a $5$-point stencil and is only valid for interior points where neighbors $f_{i \\pm 1}, f_{i \\pm 2}$ exist. For our grid, this applies to indices $i \\in \\{2, 3, \\dots, N-2\\}$, or $i \\in \\{2, 3, \\dots, 8\\}$.\n\nThe compact scheme, $\\frac{1}{4} f'_{i-1} + f'_i + \\frac{1}{4} f'_{i+1} = \\frac{3}{4h}(f_{i+1} - f_{i-1})$, is applied to the interior points $i \\in \\{1, 2, \\dots, N-1\\}$. This forms a system of $N-1$ linear equations for the $N+1$ unknowns $f'_0, \\dots, f'_N$. The system is not closed. To obtain a solvable system for the interior derivatives $f'_1, \\dots, f'_{N-1}$, the boundary derivatives $f'_0$ and $f'_N$ must be provided. We use fourth-order one-sided difference formulas for these:\n- At the left boundary ($i=0$):\n$$\nf'_0 \\approx \\frac{1}{12h}(-25f_0 + 48f_1 - 36f_2 + 16f_3 - 3f_4)\n$$\n- At the right boundary ($i=N$):\n$$\nf'_N \\approx \\frac{1}{12h}(25f_N - 48f_{N-1} + 36f_{N-2} - 16f_{N-3} + 3f_{N-4})\n$$\nOnce $f'_0$ and $f'_N$ are computed, they are treated as known values. The system for the interior derivatives $[f'_1, \\dots, f'_{N-1}]^T$ becomes a tridiagonal system of size $(N-1) \\times (N-1)$:\n$$\nA \\mathbf{F'} = \\mathbf{b}\n$$\nwhere $\\mathbf{F'} = [f'_1, f'_2, \\dots, f'_{N-1}]^T$. The matrix $A$ has $1$ on the main diagonal and $\\alpha=1/4$ on the first lower and upper diagonals. The right-hand side vector $\\mathbf{b}$ is initially $b_{i-1} = \\frac{\\beta}{h}(f_{i+1} - f_{i-1})$ for $i=1, \\dots, N-1$. The first and last equations are modified:\n- For $i=1$: $\\frac{1}{4}f'_0 + f'_1 + \\frac{1}{4}f'_2 = \\dots \\implies f'_1 + \\frac{1}{4}f'_2 = b_0 - \\frac{1}{4}f'_0$\n- For $i=N-1$: $\\frac{1}{4}f'_{N-2} + f'_{N-1} + \\frac{1}{4}f'_N = \\dots \\implies \\frac{1}{4}f'_{N-2} + f'_{N-1} = b_{N-2} - \\frac{1}{4}f'_N$\nThe tridiagonal system is then solved for the interior derivatives.\n\n**4. Error Analysis**\n\nThe performance of the two schemes is compared by calculating the root-mean-square error (RMSE) for each, relative to the exact derivative $f'(x)$. Both errors are computed over the same set of interior points where the explicit stencil is valid, $i \\in \\{2, \\dots, N-2\\}$. The ratio $R = \\mathrm{RMSE}_{\\mathrm{compact}}/\\mathrm{RMSE}_{\\mathrm{explicit}}$ quantifies their relative performance.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives, implements, and compares fourth-order finite difference schemes.\n    \"\"\"\n    \n    # Test cases: k values for f(x) = sin(kx)\n    test_cases = [5.0, 10.0, 25.0]\n    \n    # Grid parameters\n    L = 1.0\n    h = 0.1\n    \n    results = []\n\n    for k in test_cases:\n        N = int(L / h)  # N=10, giving N+1=11 grid points from 0 to 10\n        x = np.linspace(0.0, L, N + 1)\n        \n        # Function and its exact derivative\n        f = np.sin(k * x)\n        f_prime_exact = k * np.cos(k * x)\n\n        # ----------------------------------------------------------------------\n        # 1. Fourth-Order Explicit Central Difference Scheme\n        # ----------------------------------------------------------------------\n        # Stencil: f'_i = (f_{i-2} - 8f_{i-1} + 8f_{i+1} - f_{i+2}) / (12h)\n        # Valid for i = 2, ..., N-2\n        f_prime_explicit = np.full_like(x, np.nan)\n        for i in range(2, N - 1): # Python indices 2 to N-2 (inclusive)\n            f_prime_explicit[i] = (f[i-2] - 8.0*f[i-1] + 8.0*f[i+1] - f[i+2]) / (12.0 * h)\n\n        # ----------------------------------------------------------------------\n        # 2. Fourth-Order Compact Finite Difference Scheme\n        # ----------------------------------------------------------------------\n        # Relation: alpha*f'_{i-1} + f'_i + alpha*f'_{i+1} = beta/h * (f_{i+1} - f_{i-1})\n        alpha = 1.0 / 4.0\n        beta = 3.0 / 4.0\n\n        # Boundary closures: one-sided fourth-order formulas\n        # At i=0 (forward difference)\n        f_prime_0 = (-25.0*f[0] + 48.0*f[1] - 36.0*f[2] + 16.0*f[3] - 3.0*f[4]) / (12.0 * h)\n        # At i=N (backward difference)\n        f_prime_N = (25.0*f[N] - 48.0*f[N-1] + 36.0*f[N-2] - 16.0*f[N-3] + 3.0*f[N-4]) / (12.0 * h)\n        \n        # Set up the tridiagonal system for interior points f'_1, ..., f'_{N-1}\n        num_interior_pts = N - 1\n        A_compact = np.zeros((num_interior_pts, num_interior_pts))\n        b_compact = np.zeros(num_interior_pts)\n\n        # Populate the tridiagonal matrix A\n        np.fill_diagonal(A_compact, 1.0)\n        np.fill_diagonal(A_compact[1:, :-1], alpha)\n        np.fill_diagonal(A_compact[:-1, 1:], alpha)\n\n        # Populate the RHS vector b\n        for i in range(1, N): # Grid indices 1 to N-1\n            matrix_row = i - 1\n            b_compact[matrix_row] = (beta / h) * (f[i+1] - f[i-1])\n\n        # Modify first and last elements of b to account for boundary conditions\n        b_compact[0] -= alpha * f_prime_0\n        b_compact[-1] -= alpha * f_prime_N\n\n        # Solve the system A*f' = b for interior derivatives\n        f_prime_interior = np.linalg.solve(A_compact, b_compact)\n        \n        # Assemble the full solution vector for the compact scheme\n        f_prime_compact = np.concatenate(([f_prime_0], f_prime_interior, [f_prime_N]))\n\n        # ----------------------------------------------------------------------\n        # 3. Error Calculation\n        # ----------------------------------------------------------------------\n        # Compare schemes on indices where the explicit stencil is valid: i = 2, ..., N-2\n        idx_start = 2\n        idx_end = N - 1 # Slice will be [idx_start:idx_end], i.e., up to N-2\n        \n        # Slices of the derivatives for the common interval\n        d_explicit_subset = f_prime_explicit[idx_start:idx_end]\n        d_compact_subset = f_prime_compact[idx_start:idx_end]\n        d_exact_subset = f_prime_exact[idx_start:idx_end]\n\n        # Calculate Root-Mean-Square Errors (RMSE)\n        err_explicit = d_explicit_subset - d_exact_subset\n        err_compact = d_compact_subset - d_exact_subset\n        \n        rmse_explicit = np.sqrt(np.mean(err_explicit**2))\n        rmse_compact = np.sqrt(np.mean(err_compact**2))\n\n        # Calculate the ratio of RMSEs\n        if rmse_explicit == 0.0:\n            ratio = 0.0 if rmse_compact == 0.0 else np.inf\n        else:\n            ratio = rmse_compact / rmse_explicit\n        \n        results.append(ratio)\n\n    # Print the final list of ratios\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3591782"}]}