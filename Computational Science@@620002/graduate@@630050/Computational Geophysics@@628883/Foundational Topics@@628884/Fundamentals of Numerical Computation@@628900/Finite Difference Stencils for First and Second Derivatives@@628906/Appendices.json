{"hands_on_practices": [{"introduction": "This exercise serves as a fundamental building block for creating and understanding finite difference stencils. Starting from first principles, you will use Taylor series expansions—the cornerstone of finite difference theory—to derive the coefficients for a high-order stencil. This analytical practice is followed by a dispersion analysis to compute the modified wavenumber, a crucial diagnostic for predicting how accurately the stencil propagates waves of different lengths in geophysical simulations [@problem_id:3594256].", "problem": "In one spatial dimension, consider the discretization of the second derivative $f''(x)$ on a uniform grid $x_{i} = x_{0} + i h$ with spacing $h$, as it appears in computational geophysics when modeling acoustic or elastic wave propagation. You are to derive a centered five-point stencil that is fourth-order accurate for approximating $f''(x_{i})$.\n\nStart from the assumption of a linear, shift-invariant discrete operator of the form\n$$\n\\mathcal{L} f_{i} = \\frac{1}{h^{2}} \\left( A f_{i-2} + B f_{i-1} + C f_{i} + B f_{i+1} + A f_{i+2} \\right),\n$$\nwith unknown real coefficients $A$, $B$, and $C$. Use Taylor series expansions of $f(x)$ about $x_{i}$, assuming $f(x)$ is sufficiently smooth, and impose the conditions necessary so that $\\mathcal{L} f_{i}$ approximates $f''(x_{i})$ with a truncation error of order $\\mathcal{O}(h^{4})$.\n\nThen, perform a dispersion analysis by applying $\\mathcal{L}$ to a Fourier mode $u_{i} = \\exp(i k x_{i})$ with real wavenumber $k$. Define the modified wavenumber $k^{*}(kh)$ for the second derivative stencil by the relation\n$$\n\\mathcal{L} u_{i} = -\\left(k^{*}(kh)\\right)^{2} u_{i}.\n$$\nCompute the closed-form expression for $k^{*}(kh)$ in terms of $h$ and $kh$.\n\nProvide your final answer as a single row matrix whose first five entries are the stencil coefficients $(A, B, C, B, A)$ in order $m=-2,-1,0,1,2$, and whose sixth entry is the analytical expression for $k^{*}(kh)$. No numerical rounding is required. Express your answer exactly in terms of rational numbers and trigonometric functions as appropriate.", "solution": "The user wants me to derive a fourth-order accurate, five-point centered finite difference stencil for the second derivative and then compute its modified wavenumber.\n\n### Step 1: Problem Validation\n\nFirst, I will validate the problem statement.\n\n**Extraction of Givens:**\n1.  **Problem:** Discretization of the second derivative $f''(x)$ on a uniform grid $x_i = x_0 + i h$.\n2.  **Operator Form:** A centered five-point stencil of the form $\\mathcal{L} f_{i} = \\frac{1}{h^{2}} \\left( A f_{i-2} + B f_{i-1} + C f_{i} + B f_{i+1} + A f_{i+2} \\right)$.\n3.  **Accuracy Requirement:** The stencil must approximate $f''(x_i)$ with a truncation error of order $\\mathcal{O}(h^{4})$.\n4.  **Derivation Method:** Use Taylor series expansions of $f(x)$ about $x_i$.\n5.  **Dispersion Analysis:** Apply the operator $\\mathcal{L}$ to a Fourier mode $u_i = \\exp(i k x_i)$.\n6.  **Modified Wavenumber Definition:** $\\mathcal{L} u_i = -(k^{*}(kh))^{2} u_i$.\n7.  **Task:**\n    a. Find the coefficients $A$, $B$, and $C$.\n    b. Find the closed-form expression for the modified wavenumber $k^{*}(kh)$.\n8.  **Output Format:** A single row matrix with the five stencil coefficients $(A, B, C, B, A)$ and the expression for $k^{*}(kh)$.\n\n**Validation using Extracted Givens:**\n*   **Scientifically Grounded:** The problem is a standard exercise in numerical analysis, specifically in the field of finite difference methods for solving partial differential equations, which is a core technique in computational geophysics. The concepts of Taylor series analysis for accuracy and dispersion analysis for wave propagation properties are fundamental. The problem is scientifically sound.\n*   **Well-Posed:** The problem is well-posed. It provides a clear objective and sufficient constraints (the form of the operator and the required order of accuracy) to uniquely determine the unknown coefficients $A, B, C$. The subsequent dispersion analysis is a direct calculation based on the derived operator.\n*   **Objective:** The problem is stated in precise, objective mathematical language.\n*   **Other Flaws:** The problem is self-contained and consistent. It does not contain any of the listed flaws (e.g., scientific unsoundness, missing information, ambiguity).\n\n**Verdict:** The problem is valid. I will now proceed with the solution.\n\n### Part 1: Derivation of Stencil Coefficients\n\nTo find the coefficients $A$, $B$, and $C$, we expand each term $f_{i+m} = f(x_i + mh)$ in the operator $\\mathcal{L}$ using a Taylor series around the point $x_i$, assuming $f(x)$ is sufficiently smooth.\n\nThe operator is given by:\n$$\n\\mathcal{L} f_{i} = \\frac{1}{h^{2}} \\left( A f_{i-2} + B f_{i-1} + C f_{i} + B f_{i+1} + A f_{i+2} \\right)\n$$\nWe can rewrite this as:\n$$\nh^2 \\mathcal{L} f_{i} = A(f_{i-2} + f_{i+2}) + B(f_{i-1} + f_{i+1}) + C f_i\n$$\nThe Taylor expansions for $f(x_i \\pm mh)$ are:\n$$\nf(x_i \\pm mh) = f(x_i) \\pm (mh)f'(x_i) + \\frac{(mh)^2}{2!}f''(x_i) \\pm \\frac{(mh)^3}{3!}f'''(x_i) + \\frac{(mh)^4}{4!}f^{(4)}(x_i) + \\frac{(mh)^5}{5!}f^{(5)}(x_i) + \\frac{(mh)^6}{6!}f^{(6)}(x_i) + \\mathcal{O}(h^8)\n$$\nDue to the symmetry of the stencil, when we sum the pairs $f_{i-m} + f_{i+m}$, the odd-powered derivative terms cancel out.\nFor $m=1$:\n$$\nf_{i-1} + f_{i+1} = 2f_i + \\frac{2 h^2}{2!} f_i'' + \\frac{2 h^4}{4!} f_i^{(4)} + \\frac{2 h^6}{6!} f_i^{(6)} + \\mathcal{O}(h^8) = 2 f_i + h^2 f_i'' + \\frac{1}{12} h^4 f_i^{(4)} + \\frac{1}{360} h^6 f_i^{(6)} + \\mathcal{O}(h^8)\n$$\nFor $m=2$:\n$$\nf_{i-2} + f_{i+2} = 2f_i + \\frac{2 (2h)^2}{2!} f_i'' + \\frac{2 (2h)^4}{4!} f_i^{(4)} + \\frac{2 (2h)^6}{6!} f_i^{(6)} + \\mathcal{O}(h^8) = 2 f_i + 4 h^2 f_i'' + \\frac{4}{3} h^4 f_i^{(4)} + \\frac{8}{45} h^6 f_i^{(6)} + \\mathcal{O}(h^8)\n$$\nSubstituting these sums back into the expression for $h^2 \\mathcal{L} f_i$:\n$$\nh^2 \\mathcal{L} f_i = A \\left( 2 f_i + 4 h^2 f_i'' + \\frac{4}{3} h^4 f_i^{(4)} + \\dots \\right) + B \\left( 2 f_i + h^2 f_i'' + \\frac{1}{12} h^4 f_i^{(4)} + \\dots \\right) + C f_i\n$$\nWe group terms by the order of the derivative of $f$ at $x_i$:\n$$\nh^2 \\mathcal{L} f_i = (2A + 2B + C) f_i + (4A + B) h^2 f_i'' + \\left(\\frac{4}{3}A + \\frac{1}{12}B\\right) h^4 f_i^{(4)} + \\left(\\frac{8}{45}A + \\frac{1}{360}B\\right) h^6 f_i^{(6)} + \\dots\n$$\nDividing by $h^2$, we get the expansion for the operator $\\mathcal{L}$:\n$$\n\\mathcal{L} f_i = \\frac{1}{h^2}(2A + 2B + C) f_i + (4A + B) f_i'' + \\left(\\frac{4}{3}A + \\frac{1}{12}B\\right) h^2 f_i^{(4)} + \\mathcal{O}(h^4)\n$$\nWe require that $\\mathcal{L}f_i$ approximates $f_i''$ with a truncation error of $\\mathcal{O}(h^4)$. This imposes the following conditions on the coefficients:\n1.  The coefficient of $f_i$ must be zero: $2A + 2B + C = 0$.\n2.  The coefficient of $f_i''$ must be one: $4A + B = 1$.\n3.  The coefficient of $h^2 f_i^{(4)}$ must be zero for the truncation error to be $\\mathcal{O}(h^4)$: $\\frac{4}{3}A + \\frac{1}{12}B = 0$.\n\nWe now solve this system of three linear equations for $A$, $B$, and $C$.\nFrom the third equation:\n$$\n\\frac{4}{3}A = -\\frac{1}{12}B \\implies 16A = -B \\implies B = -16A\n$$\nSubstitute this into the second equation:\n$$\n4A + (-16A) = 1 \\implies -12A = 1 \\implies A = -\\frac{1}{12}\n$$\nNow we find $B$:\n$$\nB = -16A = -16 \\left(-\\frac{1}{12}\\right) = \\frac{16}{12} = \\frac{4}{3}\n$$\nFinally, we find $C$ from the first equation:\n$$\nC = -2A - 2B = -2\\left(-\\frac{1}{12}\\right) - 2\\left(\\frac{4}{3}\\right) = \\frac{1}{6} - \\frac{8}{3} = \\frac{1}{6} - \\frac{16}{6} = -\\frac{15}{6} = -\\frac{5}{2}\n$$\nThe coefficients for the five-point, fourth-order stencil are $A = -1/12$, $B = 4/3$, and $C = -5/2$. The full set of stencil coefficients $(A, B, C, B, A)$ for points $(i-2, i-1, i, i+1, i+2)$ is $(-\\frac{1}{12}, \\frac{4}{3}, -\\frac{5}{2}, \\frac{4}{3}, -\\frac{1}{12})$.\n\n### Part 2: Dispersion Analysis and Modified Wavenumber\n\nNext, we perform a dispersion analysis by applying the discrete operator $\\mathcal{L}$ to a Fourier mode $u_i = \\exp(i k x_i)$, where $k$ is the wavenumber. We note that $u_{i+m} = \\exp(ik(x_i+mh)) = u_i \\exp(ikmh)$.\n$$\n\\mathcal{L} u_i = \\frac{1}{h^2} \\left[ A u_{i-2} + B u_{i-1} + C u_i + B u_{i+1} + A u_{i+2} \\right]\n$$\n$$\n\\mathcal{L} u_i = \\frac{u_i}{h^2} \\left[ A e^{-i2kh} + B e^{-ikh} + C + B e^{ikh} + A e^{i2kh} \\right]\n$$\nUsing Euler's identity, $e^{i\\theta} + e^{-i\\theta} = 2\\cos(\\theta)$, we can simplify the expression:\n$$\n\\mathcal{L} u_i = \\frac{u_i}{h^2} \\left[ C + 2B \\cos(kh) + 2A \\cos(2kh) \\right]\n$$\nThe modified wavenumber $k^*(kh)$ is defined by the relation $\\mathcal{L} u_i = -(k^*(kh))^2 u_i$. Therefore, we have:\n$$\n-(k^*(kh))^2 = \\frac{1}{h^2} \\left[ C + 2B \\cos(kh) + 2A \\cos(2kh) \\right]\n$$\nNow, substitute the derived values for $A, B, C$:\n$$\n-(k^*)^2 = \\frac{1}{h^2} \\left[ -\\frac{5}{2} + 2\\left(\\frac{4}{3}\\right) \\cos(kh) + 2\\left(-\\frac{1}{12}\\right) \\cos(2kh) \\right]\n$$\n$$\n-(k^*)^2 = \\frac{1}{h^2} \\left[ -\\frac{5}{2} + \\frac{8}{3} \\cos(kh) - \\frac{1}{6} \\cos(2kh) \\right]\n$$\nMultiplying by $-1$ gives the expression for $(k^*)^2$:\n$$\n(k^*)^2 = \\frac{1}{h^2} \\left[ \\frac{5}{2} - \\frac{8}{3} \\cos(kh) + \\frac{1}{6} \\cos(2kh) \\right]\n$$\nTo simplify, we can use the identity $C = -(2A+2B) = -2(-1/12) - 2(4/3) = 1/6 - 8/3 = -15/6 = -5/2$.\nAn alternative approach recognizes that the sum of coefficients is zero.\n$C+2B+2A=0 \\implies C=-2A-2B$.\n$(k^*)^2 = -\\frac{1}{h^2} \\left[ -2A - 2B + 2B \\cos(kh) + 2A \\cos(2kh) \\right]$\n$(k^*)^2 = \\frac{2}{h^2} \\left[ B(1 - \\cos(kh)) + A(1 - \\cos(2kh)) \\right]$\nUsing the identity $1 - \\cos(\\theta) = 2\\sin^2(\\theta/2)$:\n$(k^*)^2 = \\frac{2}{h^2} \\left[ B(2\\sin^2(kh/2)) + A(2\\sin^2(kh)) \\right]$\nUsing $\\sin(kh) = 2\\sin(kh/2)\\cos(kh/2)$:\n$(k^*)^2 = \\frac{4}{h^2} \\left[ B\\sin^2(kh/2) + A(4\\sin^2(kh/2)\\cos^2(kh/2)) \\right]$\n$(k^*)^2 = \\frac{4}{h^2} \\sin^2(kh/2) \\left[ B + 4A\\cos^2(kh/2) \\right]$\nSubstitute $B=4/3$ and $A=-1/12$:\n$(k^*)^2 = \\frac{4}{h^2} \\sin^2(kh/2) \\left[ \\frac{4}{3} + 4\\left(-\\frac{1}{12}\\right)\\cos^2(kh/2) \\right] = \\frac{4}{h^2} \\sin^2(kh/2) \\left[ \\frac{4}{3} - \\frac{1}{3}\\cos^2(kh/2) \\right]$\n$(k^*)^2 = \\frac{4}{3h^2} \\sin^2(kh/2) \\left[ 4 - \\cos^2(kh/2) \\right]$\nUsing $1 - \\cos^2(x) = \\sin^2(x)$, we can write $4-\\cos^2(kh/2) = 3+\\sin^2(kh/2)$.\nLet's return to the form with full-angle cosines for simplicity.\n$(k^*)^2 = \\frac{1}{3h^2} (\\cos^2(kh) - 8\\cos(kh) + 7)$\nThis can be factored as:\n$(k^*)^2 = \\frac{1}{3h^2} (1 - \\cos(kh))(7 - \\cos(kh))$\nTaking the square root and noting that for physical wavenumbers $k \\ge 0$ and $h > 0$, we have:\n$$\nk^*(kh) = \\frac{1}{h} \\sqrt{\\frac{(1 - \\cos(kh))(7 - \\cos(kh))}{3}}\n$$\nThis is the closed-form expression for the modified wavenumber.\n\nThe final answer requires the five coefficients $(A, B, C, B, A)$ and the expression for $k^*(kh)$ in a single row matrix.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-\\frac{1}{12} & \\frac{4}{3} & -\\frac{5}{2} & \\frac{4}{3} & -\\frac{1}{12} & \\frac{1}{h} \\sqrt{\\frac{(1-\\cos(kh))(7-\\cos(kh))}{3}}\n\\end{pmatrix}\n}\n$$", "id": "3594256"}, {"introduction": "Moving from analytical derivation to computational implementation, this practice guides you in building a versatile tool for generating finite difference stencils. By reformulating the derivation as a condition of exact polynomial differentiation, you will construct and solve a linear system for the stencil weights. This powerful method automates the creation of high-order interior stencils and provides a systematic approach for designing the asymmetric stencils needed at grid boundaries, a common challenge in practical modeling scenarios [@problem_id:3594272].", "problem": "Construct a program that, on a one-dimensional uniform grid with spacing $h$, builds Finite Difference (FD) stencils for the second derivative $\\partial_{xx} u$ that are exactly differentiating polynomials up to degree $p$. Use the Taylor series as the fundamental base to derive the algebraic conditions that the stencil weights must satisfy for polynomial exactness. Your program must:\n\n1. From the Taylor series expansion of a sufficiently smooth function $u(x)$ about a point $x_0$, derive the moment conditions that FD weights $\\{\\alpha_i\\}_{i=0}^{p}$ must satisfy so that the FD approximation\n$$\n\\partial_{xx} u(x_0) \\approx \\frac{1}{h^2} \\sum_{i=0}^{p} \\alpha_i \\, u\\!\\left(x_0 + s_i h\\right)\n$$\nis exact for all polynomials $u(x)$ of degree up to $p$, where $\\{s_i\\}$ are the integer offsets specifying the stencil locations relative to $x_0$. Do not use any pre-tabulated formulas; derive the linear system from first principles.\n\n2. Implement a solver that, for a given integer degree $p \\ge 2$ and a specified stencil geometry (interior symmetric or boundary one-sided), constructs offsets $\\{s_i\\}$ and solves the resulting linear system for the weights $\\{\\alpha_i\\}$ ensuring exactness up to degree $p$. Use $p+1$ points:\n   - Interior symmetric stencils: for even $p$, choose offsets $s_i \\in \\{-\\frac{p}{2}, -\\frac{p}{2}+1, \\dots, \\frac{p}{2}\\}$, centered at $x_0$.\n   - Boundary one-sided stencils: choose offsets $s_i \\in \\{0,1,2,\\dots,p\\}$ at the left boundary $x_0$.\n\n3. Quantify the benefits for modeling smooth background fields in gravitational and magnetic surveying by evaluating approximation errors for a composite smooth background profile\n$$\nu(x) = 10^{-3} x^3 + \\sin(0.3 x),\n$$\nwhere the angle in the sine function is in radians. For this profile, report the maximum absolute error of your FD approximation to $\\partial_{xx} u(x)$ across specified grid points. The composite profile mimics a slowly varying gravitational background (polynomial trend) superimposed with a smooth magnetic variation (sinusoid). Treat all quantities as non-dimensionalized, so no physical units are required.\n\nBase your derivation on the Taylor series expansion\n$$\nu(x_0 + s h) = \\sum_{k=0}^{\\infty} \\frac{u^{(k)}(x_0)}{k!} (s h)^k,\n$$\nand the definition of the second derivative $u''(x_0) = \\partial_{xx} u(x_0)$.\n\nYour program must produce the FD weights by solving the linear system implied by exactness up to degree $p$ and then compute the requested errors. Do not rely on any specialized finite-difference libraries or shortcut formulas.\n\nTest Suite:\n- Use the following grid setups and degrees $p$.\n  - Polynomial exactness tests on an interior grid:\n    1. Case A: $p=2$, domain $x \\in [0,1]$, $N=101$ equally spaced points, $h = 1/100$, interior symmetric stencil, evaluate over interior points excluding $1$ grid cell near each boundary. For each polynomial $x^k$, $k=0,1,2$, compute the maximum absolute error between the FD approximation and the exact $\\partial_{xx} x^k$, and report the single maximum across all three $k$ values.\n    2. Case B: $p=6$, same domain and grid as Case A, interior symmetric stencil excluding $3$ cells near each boundary, polynomials $x^k$ for $k=0,1,2,3,4,5,6$, and report the maximum absolute error across all $k$ and interior points.\n\n  - Polynomial exactness test at the left boundary:\n    3. Case C: $p=6$, domain $x \\in [0,1]$, $N=101$, one-sided stencil at $x_0=0$ with offsets $\\{0,1,2,3,4,5,6\\}$. For polynomials $x^k$, $k=0,1,\\dots,6$, compute the maximum absolute error of the FD approximation at $x_0=0$.\n\n  - Smooth background composite profile tests:\n    4. Case D: $p=2$, domain $x \\in [0,10]$, $N=1001$, interior symmetric stencil excluding $1$ cell near boundaries; compute the maximum absolute error of the FD approximation to $\\partial_{xx} u(x)$ across interior points.\n    5. Case E: $p=4$, same domain and grid as Case D, interior symmetric stencil excluding $2$ cells near boundaries; report the maximum absolute error as in Case D.\n    6. Case F: $p=6$, same domain and grid as Case D, interior symmetric stencil excluding $3$ cells near boundaries; report the maximum absolute error as in Case D.\n    7. Case G: $p=6$, same domain and grid as Case D, one-sided left boundary stencil at $x_0=0$; report the absolute error at the boundary point.\n\nFinal Output Format:\n- Your program should produce a single line of output containing the seven results in the order of Cases A through G, as a comma-separated list enclosed in square brackets, for example, \"[resultA,resultB,resultC,resultD,resultE,resultF,resultG]\". All seven results must be floating-point numbers. Angles must be interpreted as radians. No physical units are required because the variables are non-dimensionalized.", "solution": "The problem requires the construction and evaluation of finite difference (FD) stencils for the second derivative, $\\partial_{xx} u$, ensuring exactness for polynomials up to a specified degree $p$. The derivation must be based on first principles using the Taylor series expansion.\n\n### Derivation of Finite Difference Stencil Weights\n\nThe general form of a finite difference approximation for the second derivative of a function $u(x)$ at a point $x_0$ on a uniform grid with spacing $h$ is given by:\n$$\n\\partial_{xx} u(x_0) \\approx \\frac{1}{h^2} \\sum_{i=0}^{p} \\alpha_i u(x_0 + s_i h)\n$$\nHere, $\\{\\alpha_i\\}_{i=0}^{p}$ are the unknown dimensionless weights, and $\\{s_i\\}_{i=0}^{p}$ are integer offsets that define the stencil geometry relative to $x_0$. We use $p+1$ points to construct the stencil.\n\nTo determine the weights $\\alpha_i$, we require that this approximation be exact for all polynomials up to degree $p$. This is equivalent to matching the Taylor series expansion of the right-hand side with the exact second derivative, $u''(x_0)$.\n\nThe Taylor series expansion of $u(x)$ around $x_0$ is:\n$$\nu(x_0 + \\Delta x) = \\sum_{k=0}^{\\infty} \\frac{u^{(k)}(x_0)}{k!} (\\Delta x)^k\n$$\nwhere $u^{(k)}(x_0)$ is the $k$-th derivative of $u$ at $x_0$. Substituting $\\Delta x = s_i h$ for each term in the FD sum, we get:\n$$\nu(x_0 + s_i h) = \\sum_{k=0}^{\\infty} \\frac{u^{(k)}(x_0)}{k!} (s_i h)^k\n$$\nNow, we substitute this expansion into the FD formula:\n$$\n\\frac{1}{h^2} \\sum_{i=0}^{p} \\alpha_i \\left( \\sum_{k=0}^{\\infty} \\frac{u^{(k)}(x_0)}{k!} (s_i h)^k \\right)\n$$\nBy linearity, we can swap the order of summation:\n$$\n\\sum_{k=0}^{\\infty} \\frac{u^{(k)}(x_0) h^k}{h^2 k!} \\left( \\sum_{i=0}^{p} \\alpha_i s_i^k \\right)\n$$\nWe want this expression to be equal to $u''(x_0)$. This means the coefficient of $u^{(2)}(x_0)$ must be $1$, and the coefficients of all other derivatives $u^{(k)}(x_0)$ for $k \\neq 2$ must be zero, at least for $k \\le p$. Let us examine the coefficients for each derivative term $u^{(k)}(x_0)$:\n\nFor $k=0$: The coefficient is $\\frac{h^0}{h^2 0!} \\sum_{i=0}^{p} \\alpha_i s_i^0 = \\frac{1}{h^2} \\sum_{i=0}^{p} \\alpha_i$. For this term to be zero, we must have:\n$$\n\\sum_{i=0}^{p} \\alpha_i s_i^0 = \\sum_{i=0}^{p} \\alpha_i = 0\n$$\n\nFor $k=1$: The coefficient is $\\frac{h^1}{h^2 1!} \\sum_{i=0}^{p} \\alpha_i s_i^1 = \\frac{1}{h} \\sum_{i=0}^{p} \\alpha_i s_i$. For this term to be zero:\n$$\n\\sum_{i=0}^{p} \\alpha_i s_i^1 = 0\n$$\n\nFor $k=2$: The coefficient is $\\frac{h^2}{h^2 2!} \\sum_{i=0}^{p} \\alpha_i s_i^2 = \\frac{1}{2} \\sum_{i=0}^{p} \\alpha_i s_i^2$. We require this to be $1$:\n$$\n\\frac{1}{2} \\sum_{i=0}^{p} \\alpha_i s_i^2 = 1 \\implies \\sum_{i=0}^{p} \\alpha_i s_i^2 = 2\n$$\n\nFor $k \\in \\{3, 4, \\dots, p\\}$: The coefficient is $\\frac{h^k}{h^2 k!} \\sum_{i=0}^{p} \\alpha_i s_i^k$. For these terms to be zero:\n$$\n\\sum_{i=0}^{p} \\alpha_i s_i^k = 0\n$$\n\nThese $p+1$ equations form a system of linear equations for the $p+1$ unknown weights $\\{\\alpha_i\\}$. We can express this system in matrix form, $\\mathbf{M} \\boldsymbol{\\alpha} = \\mathbf{b}$, where $\\boldsymbol{\\alpha} = [\\alpha_0, \\alpha_1, \\dots, \\alpha_p]^T$:\n$$\n\\begin{pmatrix}\ns_0^0    & s_1^0    & \\dots  & s_p^0    \\\\\ns_0^1    & s_1^1    & \\dots  & s_p^1    \\\\\ns_0^2    & s_1^2    & \\dots  & s_p^2    \\\\\n\\vdots   & \\vdots   & \\ddots & \\vdots   \\\\\ns_0^p    & s_1^p    & \\dots  & s_p^p\n\\end{pmatrix}\n\\begin{pmatrix}\n\\alpha_0 \\\\\n\\alpha_1 \\\\\n\\alpha_2 \\\\\n\\vdots \\\\\n\\alpha_p\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0 \\\\\n0 \\\\\n2 \\\\\n\\vdots \\\\\n0\n\\end{pmatrix}\n$$\nThe coefficient matrix $\\mathbf{M}$ is a Vandermonde matrix, with elements $M_{ki} = s_i^k$. As long as the stencil points $s_i$ are distinct, this matrix is invertible, guaranteeing a unique solution for the weights $\\boldsymbol{\\alpha}$.\n\n### Implementation and Evaluation Strategy\n\nThe procedure involves the following steps for each test case:\n1.  **Define Stencil Geometry**: For a given degree $p$, determine the integer offsets $\\{s_i\\}$. For symmetric interior stencils with even $p$, $s_i \\in \\{ -p/2, \\dots, p/2 \\}$. For one-sided boundary stencils, $s_i \\in \\{ 0, \\dots, p \\}$.\n2.  **Solve for Weights**: Construct the Vandermonde matrix $\\mathbf{M}$ and the right-hand side vector $\\mathbf{b}$ as derived above. Solve the linear system $\\mathbf{M} \\boldsymbol{\\alpha} = \\mathbf{b}$ to find the weights $\\boldsymbol{\\alpha}$.\n3.  **Apply Stencil and Compute Error**:\n    *   Define the grid, test function $u(x)$, and its exact second derivative $u''(x)$.\n    *   At each specified evaluation point $x_j$, gather the function values $u(x_j + s_i h)$ required by the stencil.\n    *   Compute the FD approximation: $u''_{FD}(x_j) = \\frac{1}{h^2} \\sum_i \\alpha_i u(x_j + s_i h)$.\n    *   Calculate the absolute error $|u''_{FD}(x_j) - u''(x_j)|$.\n    *   Report the maximum of these errors over the specified domain or at the specified point, as required by the test case.\n\nFor polynomial exactness tests (Cases A, B, C), the theoretical error is zero, so the computed error should be on the order of machine floating-point precision. For the smooth composite function (Cases D-G), the error is expected to decrease as the degree of exactness $p$ increases, demonstrating the benefit of higher-order methods for resolving smooth fields.\n\nThe order of accuracy for a symmetric stencil of degree $p$ (where $p$ is even) is $O(h^p)$, as the error term associated with the odd power $u^{(p+1)}$ cancels due to symmetry. For a one-sided stencil, the order is generally $O(h^{p-1})$. This explains why higher-order stencils yield significantly smaller errors for smooth functions, a crucial aspect in computational geophysics for accurately capturing background field variations.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef get_stencil_weights(p, s_offsets):\n    \"\"\"\n    Computes finite difference weights for the second derivative.\n    The stencil must be exact for polynomials up to degree p.\n\n    Args:\n        p (int): The maximum degree of the polynomial for which the stencil is exact.\n        s_offsets (np.ndarray): An array of p+1 integer offsets for the stencil points.\n\n    Returns:\n        np.ndarray: The array of p+1 stencil weights.\n    \"\"\"\n    if len(s_offsets) != p + 1:\n        raise ValueError(\"Number of offsets must be p + 1.\")\n    \n    # Construct the Vandermonde matrix M, where M[k, i] = s_offsets[i]**k\n    # for k in 0..p and i in 0..p\n    M = np.vander(s_offsets, N=p + 1, increasing=True).T\n    \n    # Construct the right-hand side vector b\n    b = np.zeros(p + 1)\n    b[2] = 2.0  # The condition for the second derivative\n    \n    # Solve the linear system M @ alpha = b for the weights alpha\n    weights = np.linalg.solve(M, b)\n    return weights\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    results = []\n\n    # --- Case A: p=2, interior, polynomial exactness ---\n    p_A = 2\n    N_A = 101\n    x_A = np.linspace(0.0, 1.0, N_A)\n    h_A = 1.0 / (N_A - 1)\n    p_half_A = p_A // 2\n    s_offsets_A = np.arange(-p_half_A, p_half_A + 1)\n    weights_A = get_stencil_weights(p_A, s_offsets_A)\n    \n    max_err_A = 0.0\n    for k in range(p_A + 1):\n        u_poly = x_A**k\n        if k < 2:\n            u_xx_exact_poly = np.zeros_like(x_A)\n        else:\n            u_xx_exact_poly = k * (k - 1) * x_A**(k - 2)\n\n        for j in range(p_half_A, N_A - p_half_A):\n            u_values = u_poly[j - p_half_A : j + p_half_A + 1]\n            u_xx_fd = np.dot(weights_A, u_values) / h_A**2\n            err = np.abs(u_xx_fd - u_xx_exact_poly[j])\n            if err > max_err_A:\n                max_err_A = err\n    results.append(max_err_A)\n\n    # --- Case B: p=6, interior, polynomial exactness ---\n    p_B = 6\n    N_B = 101\n    x_B = np.linspace(0.0, 1.0, N_B)\n    h_B = 1.0 / (N_B - 1)\n    p_half_B = p_B // 2\n    s_offsets_B = np.arange(-p_half_B, p_half_B + 1)\n    weights_B = get_stencil_weights(p_B, s_offsets_B)\n\n    max_err_B = 0.0\n    for k in range(p_B + 1):\n        u_poly = x_B**k\n        if k < 2:\n            u_xx_exact_poly = np.zeros_like(x_B)\n        else:\n            u_xx_exact_poly = k * (k - 1) * x_B**(k - 2)\n            \n        for j in range(p_half_B, N_B - p_half_B):\n            u_values = u_poly[j - p_half_B : j + p_half_B + 1]\n            u_xx_fd = np.dot(weights_B, u_values) / h_B**2\n            err = np.abs(u_xx_fd - u_xx_exact_poly[j])\n            if err > max_err_B:\n                max_err_B = err\n    results.append(max_err_B)\n\n    # --- Case C: p=6, boundary, polynomial exactness ---\n    p_C = 6\n    N_C = 101\n    x_C = np.linspace(0.0, 1.0, N_C)\n    h_C = 1.0 / (N_C - 1)\n    s_offsets_C = np.arange(p_C + 1)\n    weights_C = get_stencil_weights(p_C, s_offsets_C)\n    \n    max_err_C = 0.0\n    for k in range(p_C + 1):\n        u_poly = x_C**k\n        if k < 2:\n            u_xx_exact_val = 0.0\n        else:\n            u_xx_exact_val = k * (k - 1) * x_C[0]**(k - 2)\n\n        u_values = u_poly[0 : p_C + 1]\n        u_xx_fd = np.dot(weights_C, u_values) / h_C**2\n        err = np.abs(u_xx_fd - u_xx_exact_val)\n        if err > max_err_C:\n            max_err_C = err\n    results.append(max_err_C)\n\n    # --- Setup for Cases D, E, F, G (Smooth Profile) ---\n    N_smooth = 1001\n    x_smooth = np.linspace(0.0, 10.0, N_smooth)\n    h_smooth = 10.0 / (N_smooth - 1)\n    u_smooth = 1e-3 * x_smooth**3 + np.sin(0.3 * x_smooth)\n    u_xx_exact_smooth = 6e-3 * x_smooth - (0.3**2) * np.sin(0.3 * x_smooth)\n\n    # --- Case D: p=2, interior, smooth profile ---\n    p_D = 2\n    p_half_D = p_D // 2\n    s_offsets_D = np.arange(-p_half_D, p_half_D + 1)\n    weights_D = get_stencil_weights(p_D, s_offsets_D)\n    \n    u_xx_fd_D = np.zeros(N_smooth)\n    eval_indices_D = range(p_half_D, N_smooth - p_half_D)\n    for j in eval_indices_D:\n        u_values = u_smooth[j - p_half_D : j + p_half_D + 1]\n        u_xx_fd_D[j] = np.dot(weights_D, u_values) / h_smooth**2\n    max_err_D = np.max(np.abs(u_xx_fd_D[list(eval_indices_D)] - u_xx_exact_smooth[list(eval_indices_D)]))\n    results.append(max_err_D)\n    \n    # --- Case E: p=4, interior, smooth profile ---\n    p_E = 4\n    p_half_E = p_E // 2\n    s_offsets_E = np.arange(-p_half_E, p_half_E + 1)\n    weights_E = get_stencil_weights(p_E, s_offsets_E)\n\n    u_xx_fd_E = np.zeros(N_smooth)\n    eval_indices_E = range(p_half_E, N_smooth - p_half_E)\n    for j in eval_indices_E:\n        u_values = u_smooth[j - p_half_E : j + p_half_E + 1]\n        u_xx_fd_E[j] = np.dot(weights_E, u_values) / h_smooth**2\n    max_err_E = np.max(np.abs(u_xx_fd_E[list(eval_indices_E)] - u_xx_exact_smooth[list(eval_indices_E)]))\n    results.append(max_err_E)\n\n    # --- Case F: p=6, interior, smooth profile ---\n    p_F = 6\n    p_half_F = p_F // 2\n    s_offsets_F = np.arange(-p_half_F, p_half_F + 1)\n    weights_F = get_stencil_weights(p_F, s_offsets_F)\n    \n    u_xx_fd_F = np.zeros(N_smooth)\n    eval_indices_F = range(p_half_F, N_smooth - p_half_F)\n    for j in eval_indices_F:\n        u_values = u_smooth[j - p_half_F : j + p_half_F + 1]\n        u_xx_fd_F[j] = np.dot(weights_F, u_values) / h_smooth**2\n    max_err_F = np.max(np.abs(u_xx_fd_F[list(eval_indices_F)] - u_xx_exact_smooth[list(eval_indices_F)]))\n    results.append(max_err_F)\n\n    # --- Case G: p=6, boundary, smooth profile ---\n    p_G = 6\n    s_offsets_G = np.arange(p_G + 1)\n    weights_G = get_stencil_weights(p_G, s_offsets_G)\n\n    u_values_G = u_smooth[0 : p_G + 1]\n    u_xx_fd_G = np.dot(weights_G, u_values_G) / h_smooth**2\n    err_G = np.abs(u_xx_fd_G - u_xx_exact_smooth[0])\n    results.append(err_G)\n    \n    # Final print statement\n    print(f\"[{','.join(f'{r:.15e}' for r in results)}]\")\n\nsolve()\n```", "id": "3594272"}, {"introduction": "This final practice integrates stencil design and spectral analysis into a comprehensive study directly relevant to modern seismic wave modeling. You will compare a standard high-order explicit stencil with an advanced compact (implicit) stencil, exploring a key trade-off between computational footprint and spectral accuracy. The analysis advances from the spatial operator alone to the fully-discrete wave equation, assessing the combined effects of spatial discretization, the time-stepping scheme, and stability constraints, which is an essential skill for designing robust and efficient numerical simulations [@problem_id:3594271].", "problem": "You are tasked with constructing and analyzing finite difference stencils for the second spatial derivative operator on a one-dimensional uniform grid, and then using their discrete spectral properties to quantify phase-velocity dispersion for the fully discrete constant-time-step scheme of the one-dimensional acoustic wave equation used in computational seismology. Your program must implement both a compact Padé-type stencil and an explicit high-order stencil, derive their discrete Fourier symbols, and evaluate the fully discrete dispersion relation for a set of test parameters. All angles must be in radians, and any physical quantity must be expressed in the specified units.\n\nConsider a one-dimensional uniform grid with spacing $h$, grid nodes $x_i = i h$, and a smooth scalar field $u(x)$. Let $u_i \\equiv u(x_i)$. You will construct and analyze the following two spatial discretizations for the second derivative $\\partial_{xx} u$:\n\n- A compact tridiagonal Padé-type stencil of the form\n  $$\n  \\alpha\\, u''_{i-1} + u''_i + \\alpha\\, u''_{i+1}\n  \\;=\\;\n  \\frac{1}{h^2}\\left[\n  a \\left(u_{i-1} - 2 u_i + u_{i+1}\\right)\n  + b \\left(u_{i-2} - 2 u_i + u_{i+2}\\right)\n  \\right],\n  $$\n  where $u''_i$ denotes the discrete approximation to $\\partial_{xx} u$ at $x_i$, and $\\alpha$, $a$, $b$ are constants to be determined to achieve a target order of accuracy using Taylor series about $x_i$ and symmetry.\n\n- An explicit centered stencil of order $8$ (eighth order) for $\\partial_{xx} u$ with offsets up to $\\pm 4$, of the general form\n  $$\n  u''_i \\;\\approx\\; \\frac{1}{h^2}\\left(c_0 u_i + \\sum_{m=1}^{4} c_m \\left(u_{i+m} + u_{i-m}\\right)\\right),\n  $$\n  where $\\{c_m\\}$ are constants to be chosen to achieve formal order $8$ by canceling Taylor series truncation terms up to and including $\\mathcal{O}(h^8)$.\n\nFor each stencil, perform a discrete Fourier analysis: for a Fourier mode $u_i = e^{\\mathrm{i} i \\theta}$ with $\\theta = k h \\in [0,\\pi]$, the stencil acts as a scalar multiplication by its symbol. Define the dimensionless spatial symbol $\\mu(\\theta)$ by\n$$\n\\widehat{D^{(2)}}(\\theta) \\;=\\; -\\frac{\\mu(\\theta)}{h^2},\n$$\nso that the continuous Laplacian eigenvalue $-\\frac{\\theta^2}{h^2}$ is replaced by $-\\frac{\\mu(\\theta)}{h^2}$. Derive $\\mu(\\theta)$ for each stencil in terms of $\\theta$, the coefficients, and trigonometric functions.\n\nNext, consider the fully discrete scheme for the one-dimensional acoustic wave equation with heterogeneous wave speed $c(x)$,\n$$\n\\partial_{tt} u(x,t) \\;=\\; c(x)^2 \\,\\partial_{xx} u(x,t),\n$$\nin which space is discretized by one of the above discrete second derivatives and time is discretized by the standard centered second-order finite difference in time with uniform time step $\\Delta t$:\n$$\nu_i^{n+1} - 2 u_i^n + u_i^{n-1} \\;=\\; \\left(c_i \\frac{\\Delta t}{h}\\right)^2 \\left(-\\mu(\\theta)\\right) u_i^n,\n$$\nwhere $c_i = c(x_i)$. Using Fourier analysis locally (i.e., treating $c_i$ as locally constant), show that the fully discrete dispersion relation for a mode with nondimensional wavenumber $\\theta$ is\n$$\n\\sin^2\\!\\left(\\frac{\\omega \\Delta t}{2}\\right) \\;=\\; \\left(\\frac{c \\,\\Delta t}{2 h}\\right)^2 \\mu(\\theta),\n$$\nwhere $\\omega$ is the angular frequency. Define the local Courant number $\\nu_{\\text{loc}} \\equiv c \\,\\Delta t / h$ and the discrete phase velocity $c_{\\text{ph}} \\equiv \\omega/k$ with $k=\\theta/h$, and express the phase-velocity ratio $c_{\\text{ph}}/c$ as a function of $\\theta$, $\\nu_{\\text{loc}}$, and $\\mu(\\theta)$. Your program will use this relation to compute phase-velocity dispersion.\n\nStability constraint: the above scheme is stable provided that for the largest local Courant number $\\nu_{\\max}$ and the supremum of the symbol, $\\mu_{\\max} \\equiv \\max_{\\theta \\in [0,\\pi]} \\mu(\\theta)$, the inequality\n$$\n\\left(\\frac{\\nu_{\\max}}{2}\\right)^2 \\mu_{\\max} \\;\\le\\; 1\n$$\nholds, equivalently $\\nu_{\\max} \\le \\dfrac{2}{\\sqrt{\\mu_{\\max}}}$. Because $c(x)$ is heterogeneous, the global time step must be chosen using $c_{\\max} \\equiv \\max_x c(x)$.\n\nImplementation requirements for your program:\n\n- Determine the compact Padé coefficients $\\alpha$, $a$, $b$ by matching Taylor series about $x_i$ to obtain formal order $6$ (sixth order) accuracy for $\\partial_{xx} u$. Then derive and implement its discrete symbol $\\mu_{\\text{cp}}(\\theta)$.\n\n- Use a standard explicit centered order $8$ stencil and implement its discrete symbol $\\mu_{8}(\\theta)$ by summing cosine terms with the appropriate coefficients.\n\n- For a set of nondimensional wavenumbers $\\Theta = [\\theta_1,\\dots,\\theta_M]$ with $\\theta_m \\in [0,\\pi]$, and a set of wave speeds $\\mathcal{C} = [c_1,\\dots,c_L]$, choose a single global $\\Delta t$ according to the most restrictive stability limit across both stencils with a safety factor of $0.9$, i.e.,\n  $$\n  \\frac{\\Delta t}{h} \\;=\\; 0.9 \\times \\min\\!\\left(\\frac{1}{c_{\\max}}\\frac{2}{\\sqrt{\\mu_{\\text{cp}}^{\\max}}},\\;\\frac{1}{c_{\\max}}\\frac{2}{\\sqrt{\\mu_{8}^{\\max}}}\\right),\n  $$\n  where $\\mu_{\\text{cp}}^{\\max} = \\max_{\\theta \\in [0,\\pi]} \\mu_{\\text{cp}}(\\theta)$ and $\\mu_{8}^{\\max} = \\max_{\\theta \\in [0,\\pi]} \\mu_{8}(\\theta)$, and $c_{\\max} = \\max_j c_j$.\n\n- For each stencil $s \\in \\{\\text{cp},8\\}$, each $\\theta \\in \\Theta$, and each $c \\in \\mathcal{C}$, compute the discrete phase-velocity ratio\n  $$\n  \\frac{c_{\\text{ph}}}{c} \\;=\\; \\frac{2\\,\\arcsin\\!\\left(\\min\\!\\left\\{1,\\;\\frac{\\nu_{\\text{loc}}}{2}\\sqrt{\\mu_s(\\theta)}\\right\\}\\right)}{\\nu_{\\text{loc}}\\,\\theta},\n  $$\n  with $\\nu_{\\text{loc}} = c\\,\\Delta t/h$, and then the absolute relative error $E_s(\\theta,c) \\equiv \\left|\\frac{c_{\\text{ph}}}{c} - 1\\right|$. For each stencil, return the maximum error over $\\Theta \\times \\mathcal{C}$.\n\nTest suite and required outputs:\n\nUse the following two test cases, each with its own set of wave speeds and a common grid spacing:\n\n- Test Case A:\n  - Grid spacing: $h = 10$ meters.\n  - Wave speeds: $\\mathcal{C}_A = [2000,\\,3500,\\,5000]$ meters per second.\n  - Nondimensional wavenumbers: $\\Theta = [0.1,\\,0.5,\\,1.0,\\,1.5,\\,2.0,\\,2.5,\\,3.0]$ radians.\n\n- Test Case B:\n  - Grid spacing: $h = 10$ meters.\n  - Wave speeds: $\\mathcal{C}_B = [1500,\\,6000]$ meters per second.\n  - Nondimensional wavenumbers: the same $\\Theta$ as in Test Case A.\n\nFor each test case, your program must:\n\n- Compute the global stable time step $\\Delta t$ in seconds (with the $0.9$ safety factor) using $c_{\\max}$ from that case and the most restrictive bound across the two stencils.\n\n- Compute $E_{\\text{cp}}^{\\max} \\equiv \\max_{\\theta \\in \\Theta,\\,c \\in \\mathcal{C}} E_{\\text{cp}}(\\theta,c)$ and $E_{8}^{\\max} \\equiv \\max_{\\theta \\in \\Theta,\\,c \\in \\mathcal{C}} E_{8}(\\theta,c)$.\n\n- Compute the ratio $R \\equiv E_{8}^{\\max} / E_{\\text{cp}}^{\\max}$.\n\nFinal output format:\n\nYour program should produce a single line of output containing the eight results as a comma-separated list enclosed in square brackets:\n$$\n\\left[ E_{\\text{cp},A}^{\\max},\\; E_{8,A}^{\\max},\\; \\Delta t_A,\\; R_A,\\; E_{\\text{cp},B}^{\\max},\\; E_{8,B}^{\\max},\\; \\Delta t_B,\\; R_B \\right],\n$$\nwhere the subscript $A$ or $B$ denotes the corresponding test case. The time steps $\\Delta t_A$ and $\\Delta t_B$ must be expressed in seconds. All values must be printed as floating-point numbers.", "solution": "We begin with the uniform grid $x_i = i h$ and a smooth function $u(x)$. The goal is to construct finite difference stencils for $\\partial_{xx} u$, derive their discrete Fourier symbols, and use those symbols in the fully discrete dispersion relation for the one-dimensional acoustic wave equation discretized in time by a centered second-order finite difference.\n\nCompact Padé-type stencil construction. Assume a tridiagonal compact relation\n$$\n\\alpha\\, u''_{i-1} + u''_i + \\alpha\\, u''_{i+1}\n\\;=\\;\n\\frac{1}{h^2}\\left[\na \\left(u_{i-1} - 2 u_i + u_{i+1}\\right)\n+ b \\left(u_{i-2} - 2 u_i + u_{i+2}\\right)\n\\right],\n$$\nwith unknown constants $\\alpha$, $a$, $b$ to be chosen. We enforce sixth-order accuracy for $\\partial_{xx} u$ by using Taylor series expansions around $x_i$.\n\nTaylor expansions. For $m \\in \\mathbb{Z}$,\n$$\nu_{i+m} = u + m h u' + \\frac{(m h)^2}{2} u'' + \\frac{(m h)^3}{6} u^{(3)} + \\frac{(m h)^4}{24} u^{(4)} + \\frac{(m h)^5}{120} u^{(5)} + \\frac{(m h)^6}{720} u^{(6)} + \\frac{(m h)^7}{5040} u^{(7)} + \\frac{(m h)^8}{40320} u^{(8)} + \\cdots,\n$$\nwhere derivatives are evaluated at $x_i$. From symmetry, odd derivatives cancel in the symmetric combinations we use.\n\nRight-hand side building blocks:\n$$\nS_1 \\equiv u_{i-1} - 2 u_i + u_{i+1} = h^2 u'' + \\frac{h^4}{12} u^{(4)} + \\frac{h^6}{360} u^{(6)} + \\frac{h^8}{20160} u^{(8)} + \\cdots,\n$$\n$$\nS_2 \\equiv u_{i-2} - 2 u_i + u_{i+2} = 4 h^2 u'' + \\frac{16 h^4}{12} u^{(4)} + \\frac{64 h^6}{360} u^{(6)} + \\frac{256 h^8}{20160} u^{(8)} + \\cdots.\n$$\nHence the right-hand side divided by $h^2$ is\n$$\n\\frac{1}{h^2}\\left( a S_1 + b S_2 \\right)\n= \\left(a + 4 b\\right) u'' + \\left(\\frac{a + 16 b}{12}\\right) h^2 u^{(4)} + \\left(\\frac{a + 64 b}{360}\\right) h^4 u^{(6)} + \\left(\\frac{a + 256 b}{20160}\\right) h^6 u^{(8)} + \\cdots.\n$$\n\nLeft-hand side expansion. Expanding $u''_{i\\pm 1}$:\n$$\nu''_{i\\pm 1} = u'' \\pm h u^{(3)} + \\frac{h^2}{2} u^{(4)} \\pm \\frac{h^3}{6} u^{(5)} + \\frac{h^4}{24} u^{(6)} \\pm \\frac{h^5}{120} u^{(7)} + \\frac{h^6}{720} u^{(8)} + \\cdots.\n$$\nTherefore,\n$$\n\\alpha\\, u''_{i-1} + u''_i + \\alpha\\, u''_{i+1} = (1 + 2 \\alpha) u'' + \\alpha h^2 u^{(4)} + \\frac{\\alpha}{12} h^4 u^{(6)} + \\frac{\\alpha}{360} h^6 u^{(8)} + \\cdots.\n$$\n\nMatching coefficients for sixth-order accuracy (i.e., matching $u''$, $h^2 u^{(4)}$, and $h^4 u^{(6)}$ terms), we obtain the system:\n$$\n1 + 2 \\alpha = a + 4 b,\\quad\n\\alpha = \\frac{a + 16 b}{12},\\quad\n\\frac{\\alpha}{12} = \\frac{a + 64 b}{360}.\n$$\nSolving, we find\n$$\n\\alpha = \\frac{2}{11},\\quad a = \\frac{12}{11},\\quad b = \\frac{3}{44}.\n$$\nThis yields a sixth-order accurate compact Padé-type stencil.\n\nFourier symbol for the compact stencil. For a Fourier mode $u_i = e^{\\mathrm{i} i \\theta}$, we replace shifts by $e^{\\pm \\mathrm{i} \\theta}$. The right-hand operator gives\n$$\nu_{i-1} - 2 u_i + u_{i+1} \\mapsto 2 \\cos\\theta - 2,\\quad\nu_{i-2} - 2 u_i + u_{i+2} \\mapsto 2 \\cos(2\\theta) - 2,\n$$\nand the left-hand side becomes $(\\alpha e^{-\\mathrm{i}\\theta} + 1 + \\alpha e^{\\mathrm{i}\\theta}) \\widehat{u''} = (1 + 2 \\alpha \\cos\\theta)\\,\\widehat{u''}$. Thus the discrete operator eigenvalue is\n$$\n\\widehat{D^{(2)}}_{\\text{cp}}(\\theta) = \\frac{1}{h^2}\\,\\frac{a\\left(2 \\cos\\theta - 2\\right) + b\\left(2 \\cos 2\\theta - 2\\right)}{1 + 2 \\alpha \\cos\\theta}.\n$$\nBy definition, we set $\\widehat{D^{(2)}}(\\theta) = -\\dfrac{\\mu(\\theta)}{h^2}$, hence for the compact stencil\n$$\n\\mu_{\\text{cp}}(\\theta) = -\\,\\frac{a\\left(2 \\cos\\theta - 2\\right) + b\\left(2 \\cos 2\\theta - 2\\right)}{1 + 2 \\alpha \\cos\\theta}.\n$$\nWith the computed coefficients, $\\mu_{\\text{cp}}(\\theta)$ is a positive function on $\\theta \\in [0,\\pi]$.\n\nExplicit eighth-order stencil and its symbol. A standard explicit centered eighth-order approximation for $\\partial_{xx} u$ with offsets up to $\\pm 4$ has the form\n$$\nu''_i \\approx \\frac{1}{h^2}\\left(c_0 u_i + \\sum_{m=1}^{4} c_m (u_{i+m} + u_{i-m})\\right),\n$$\nwith symmetric coefficients $\\{c_m\\}$. For a Fourier mode, the symbol becomes\n$$\n\\widehat{D^{(2)}}_{8}(\\theta) = \\frac{1}{h^2}\\left(c_0 + 2 \\sum_{m=1}^{4} c_m \\cos(m \\theta)\\right),\n$$\nso that\n$$\n\\mu_{8}(\\theta) = -\\left(c_0 + 2 \\sum_{m=1}^{4} c_m \\cos(m \\theta)\\right).\n$$\nA known choice of coefficients that yields formal eighth-order accuracy is\n$$\nc_0 = -\\frac{205}{72},\\quad c_1 = \\frac{8}{5},\\quad c_2 = -\\frac{1}{5},\\quad c_3 = \\frac{8}{315},\\quad c_4 = -\\frac{1}{560}.\n$$\nWith these coefficients, $\\mu_{8}(\\theta)$ is positive on $\\theta \\in [0,\\pi]$.\n\nFully discrete dispersion relation. For the acoustic wave equation $\\partial_{tt} u = c^2 \\partial_{xx} u$ discretized in time by the centered second-order time difference with time step $\\Delta t$, and in space by a discrete second derivative with symbol $-\\mu(\\theta)/h^2$, inserting a plane wave $u_i^n = e^{\\mathrm{i}(i\\theta - n \\omega \\Delta t)}$ gives\n$$\ne^{-\\mathrm{i}\\omega \\Delta t} - 2 + e^{\\mathrm{i}\\omega \\Delta t} = \\left(\\frac{c \\Delta t}{h}\\right)^2 \\left(-\\mu(\\theta)\\right),\n$$\nwhich simplifies using $e^{-\\mathrm{i}\\omega \\Delta t} - 2 + e^{\\mathrm{i}\\omega \\Delta t} = -4 \\sin^2\\!\\left(\\frac{\\omega \\Delta t}{2}\\right)$ to\n$$\n\\sin^2\\!\\left(\\frac{\\omega \\Delta t}{2}\\right) = \\left(\\frac{c \\Delta t}{2 h}\\right)^2 \\mu(\\theta).\n$$\nDefine the local Courant number $\\nu_{\\text{loc}} \\equiv \\dfrac{c \\Delta t}{h}$. The discrete phase velocity is $c_{\\text{ph}} \\equiv \\omega/k$ with $k=\\theta/h$. Solving for $\\omega \\Delta t$,\n$$\n\\omega \\Delta t = 2 \\arcsin\\!\\left(\\min\\left\\{1,\\, \\frac{\\nu_{\\text{loc}}}{2}\\sqrt{\\mu(\\theta)}\\right\\}\\right),\n$$\nand hence\n$$\n\\frac{c_{\\text{ph}}}{c} = \\frac{\\omega/k}{c} = \\frac{\\omega \\Delta t}{\\nu_{\\text{loc}} \\theta} = \\frac{2 \\arcsin\\!\\left(\\min\\left\\{1,\\, \\frac{\\nu_{\\text{loc}}}{2}\\sqrt{\\mu(\\theta)}\\right\\}\\right)}{\\nu_{\\text{loc}} \\theta}.\n$$\nThe absolute relative phase-velocity error is $E(\\theta,c) \\equiv \\left|\\dfrac{c_{\\text{ph}}}{c} - 1\\right|$.\n\nStability and time step selection. The scheme is stable if $\\left(\\dfrac{\\nu_{\\max}}{2}\\right)^2 \\mu_{\\max} \\le 1$, where $\\mu_{\\max} \\equiv \\max_{\\theta \\in [0,\\pi]} \\mu(\\theta)$ and $\\nu_{\\max} \\equiv \\max_x \\nu_{\\text{loc}} = \\dfrac{c_{\\max}\\, \\Delta t}{h}$. Therefore,\n$$\n\\Delta t \\le \\frac{2}{\\sqrt{\\mu_{\\max}}}\\,\\frac{h}{c_{\\max}}.\n$$\nWhen comparing two stencils, we must use a single $\\Delta t$ satisfying the most restrictive bound across both, multiplied by a safety factor to avoid borderline arguments in $\\arcsin$. We choose\n$$\n\\frac{\\Delta t}{h} = 0.9 \\times \\min\\!\\left(\\frac{1}{c_{\\max}}\\frac{2}{\\sqrt{\\mu_{\\text{cp}}^{\\max}}},\\; \\frac{1}{c_{\\max}}\\frac{2}{\\sqrt{\\mu_{8}^{\\max}}}\\right).\n$$\n\nAlgorithmic design for the program.\n\n- Implement $\\mu_{\\text{cp}}(\\theta)$ using the derived coefficients $\\alpha=\\dfrac{2}{11}$, $a=\\dfrac{12}{11}$, $b=\\dfrac{3}{44}$:\n  $$\n  \\mu_{\\text{cp}}(\\theta) = -\\,\\frac{a(2\\cos\\theta - 2) + b(2\\cos 2\\theta - 2)}{1 + 2 \\alpha \\cos\\theta}.\n  $$\n\n- Implement $\\mu_8(\\theta)$ using the given coefficients:\n  $$\n  \\mu_{8}(\\theta) = -\\left(c_0 + 2 \\sum_{m=1}^{4} c_m \\cos(m \\theta)\\right),\n  $$\n  with $c_0 = -\\dfrac{205}{72}$, $c_1 = \\dfrac{8}{5}$, $c_2 = -\\dfrac{1}{5}$, $c_3 = \\dfrac{8}{315}$, $c_4 = -\\dfrac{1}{560}$.\n\n- Compute $\\mu_{\\text{cp}}^{\\max}$ and $\\mu_{8}^{\\max}$ by sampling $\\theta \\in [0,\\pi]$ densely (e.g., a uniform grid) and taking the maximum.\n\n- For each test case, compute $c_{\\max}$ from the specified $\\mathcal{C}$, then compute $\\Delta t/h$ using the most restrictive bound across both stencils with the safety factor $0.9$, and then $\\Delta t = (\\Delta t/h) \\times h$ in seconds.\n\n- For each stencil $s \\in \\{\\text{cp},8\\}$, compute the absolute relative error\n  $$\n  E_s(\\theta,c) = \\left|\\frac{2 \\arcsin\\!\\left(\\min\\left\\{1,\\, \\frac{\\nu_{\\text{loc}}}{2}\\sqrt{\\mu_s(\\theta)}\\right\\}\\right)}{\\nu_{\\text{loc}} \\theta} - 1\\right|,\\quad \\nu_{\\text{loc}} = \\frac{c \\Delta t}{h},\n  $$\n  over all $\\theta \\in \\Theta$ and $c \\in \\mathcal{C}$, and record the maximum.\n\n- Output for Test Case A (with $h = 10$ meters, $\\mathcal{C}_A = [2000,\\,3500,\\,5000]$ meters per second, and $\\Theta = [0.1,\\,0.5,\\,1.0,\\,1.5,\\,2.0,\\,2.5,\\,3.0]$ radians): $E_{\\text{cp},A}^{\\max}$, $E_{8,A}^{\\max}$, $\\Delta t_A$ in seconds, and $R_A \\equiv E_{8,A}^{\\max}/E_{\\text{cp},A}^{\\max}$.\n\n- Output for Test Case B (with $h = 10$ meters, $\\mathcal{C}_B = [1500,\\,6000]$ meters per second, and the same $\\Theta$): $E_{\\text{cp},B}^{\\max}$, $E_{8,B}^{\\max}$, $\\Delta t_B$ in seconds, and $R_B \\equiv E_{8,B}^{\\max}/E_{\\text{cp},B}^{\\max}$.\n\nThe final program prints a single line in the format\n$$\n\\left[ E_{\\text{cp},A}^{\\max},\\; E_{8,A}^{\\max},\\; \\Delta t_A,\\; R_A,\\; E_{\\text{cp},B}^{\\max},\\; E_{8,B}^{\\max},\\; \\Delta t_B,\\; R_B \\right],\n$$\nwith times in seconds and all quantities as floating-point numbers. This design assesses spectral dispersion over a set of nondimensional wavenumbers and heterogeneous wave speeds via local Fourier analysis, honoring stability constraints induced by the fully discrete scheme.", "answer": "```python\nimport numpy as np\n\ndef mu_compact(theta):\n    \"\"\"\n    Compute the dimensionless symbol mu(theta) for the sixth-order compact Padé stencil:\n      alpha u''_{i-1} + u''_i + alpha u''_{i+1}\n        = (1/h^2)[ a (u_{i-1} - 2 u_i + u_{i+1}) + b (u_{i-2} - 2 u_i + u_{i+2}) ]\n    with alpha = 2/11, a = 12/11, b = 3/44.\n    Returns mu(theta) such that D2_hat = -mu(theta)/h^2.\n    \"\"\"\n    alpha = 2.0/11.0\n    a = 12.0/11.0\n    b = 3.0/44.0\n    cos1 = np.cos(theta)\n    cos2 = np.cos(2.0*theta)\n    numerator = a*(2.0*cos1 - 2.0) + b*(2.0*cos2 - 2.0)\n    denom = 1.0 + 2.0*alpha*cos1\n    mu = - numerator / denom\n    return mu\n\ndef mu_explicit8(theta):\n    \"\"\"\n    Compute the dimensionless symbol mu(theta) for the explicit 8th-order central stencil:\n      u''_i ≈ (1/h^2) [ c0*u_i + sum_{m=1}^4 c_m (u_{i+m} + u_{i-m}) ]\n    with coefficients:\n      c0 = -205/72,\n      c1 = 8/5, c2 = -1/5, c3 = 8/315, c4 = -1/560.\n    Returns mu(theta) such that D2_hat = -mu(theta)/h^2.\n    \"\"\"\n    c0 = -205.0/72.0\n    c = np.array([0.0, 8.0/5.0, -1.0/5.0, 8.0/315.0, -1.0/560.0])\n    cos_terms = c0 + 2.0*(c[1]*np.cos(theta) + c[2]*np.cos(2.0*theta)\n                          + c[3]*np.cos(3.0*theta) + c[4]*np.cos(4.0*theta))\n    mu = -cos_terms\n    return mu\n\ndef max_mu(mu_func, n_samples=200001):\n    \"\"\"Compute mu_max over theta in [0, pi] by dense sampling.\"\"\"\n    thetas = np.linspace(0.0, np.pi, n_samples)\n    mu_vals = mu_func(thetas)\n    # numerical safety: tiny negatives at theta=0 due to cancellation -> clamp\n    mu_vals = np.maximum(mu_vals, 0.0)\n    return float(np.max(mu_vals))\n\ndef phase_velocity_ratio(mu_val, theta, nu_loc):\n    \"\"\"\n    Compute c_ph/c for given mu(theta), theta, and local Courant number nu_loc.\n    Uses the exact fully discrete dispersion relation:\n      sin^2(omega*dt/2) = (nu_loc^2/4) * mu(theta).\n    Returns ratio = (omega/k)/c = (2*asin(min(1, 0.5*nu_loc*sqrt(mu)))) / (nu_loc * theta)\n    \"\"\"\n    if theta == 0.0:\n        return 1.0  # zero wavenumber: no dispersion\n    arg = 0.5 * nu_loc * np.sqrt(max(mu_val, 0.0))\n    # clamp to slightly below 1 to avoid domain errors\n    arg = min(arg, 1.0)\n    # Small numerical relaxation to avoid asin(1) -> pi/2 exactly causing potential inf sensitivity\n    if arg > 1.0 - 1e-15:\n        arg = 1.0 - 1e-15\n    omega_dt = 2.0 * np.arcsin(arg)\n    ratio = omega_dt / (nu_loc * theta)\n    return float(ratio)\n\ndef compute_case_metrics(h, c_values, theta_values, safety=0.9):\n    \"\"\"\n    For a given h (meters), list of c_values (m/s), and theta_values (radians),\n    compute:\n      - global stable dt using the most restrictive stencil bound with safety factor,\n      - max abs relative phase velocity error for compact and explicit-8 stencils,\n      - ratio of these maxima (explicit/compact).\n    Returns (Ecp_max, E8_max, dt, ratio).\n    \"\"\"\n    # Compute mu_max for both stencils\n    mu_max_cp = max_mu(mu_compact)\n    mu_max_e8 = max_mu(mu_explicit8)\n\n    # Most restrictive nu_max across stencils\n    nu_max_cp = 2.0 / np.sqrt(mu_max_cp) if mu_max_cp > 0 else np.inf\n    nu_max_e8 = 2.0 / np.sqrt(mu_max_e8) if mu_max_e8 > 0 else np.inf\n    nu_max_global = min(nu_max_cp, nu_max_e8)\n\n    c_max = max(c_values)\n    # dt/h with safety factor across both stencils and heterogeneous c\n    dt_over_h = safety * (nu_max_global / c_max)\n    dt = dt_over_h * h  # seconds\n\n    # Evaluate errors\n    Ecp_max = 0.0\n    E8_max = 0.0\n    for c in c_values:\n        nu_loc = c * dt_over_h\n        for theta in theta_values:\n            mu_cp = float(mu_compact(theta))\n            mu_e8 = float(mu_explicit8(theta))\n            # clamp mu to nonnegative\n            mu_cp = max(mu_cp, 0.0)\n            mu_e8 = max(mu_e8, 0.0)\n\n            r_cp = phase_velocity_ratio(mu_cp, theta, nu_loc)\n            r_e8 = phase_velocity_ratio(mu_e8, theta, nu_loc)\n\n            e_cp = abs(r_cp - 1.0)\n            e_e8 = abs(r_e8 - 1.0)\n\n            if e_cp > Ecp_max:\n                Ecp_max = e_cp\n            if e_e8 > E8_max:\n                E8_max = e_e8\n\n    ratio = (E8_max / Ecp_max) if Ecp_max > 0 else np.inf\n    return Ecp_max, E8_max, dt, ratio\n\ndef solve():\n    # Test Case A parameters\n    h_A = 10.0  # meters\n    c_values_A = [2000.0, 3500.0, 5000.0]  # m/s\n    theta_values = [0.1, 0.5, 1.0, 1.5, 2.0, 2.5, 3.0]  # radians\n\n    # Test Case B parameters\n    h_B = 10.0  # meters\n    c_values_B = [1500.0, 6000.0]  # m/s\n\n    # Compute metrics for A and B\n    Ecp_A, E8_A, dt_A, R_A = compute_case_metrics(h_A, c_values_A, theta_values, safety=0.9)\n    Ecp_B, E8_B, dt_B, R_B = compute_case_metrics(h_B, c_values_B, theta_values, safety=0.9)\n\n    results = [Ecp_A, E8_A, dt_A, R_A, Ecp_B, E8_B, dt_B, R_B]\n    print(f\"[{','.join(map(lambda x: f'{x}', results))}]\")\n\nsolve()\n```", "id": "3594271"}]}