{"hands_on_practices": [{"introduction": "Downward continuation is fundamentally an ill-posed problem due to its inherent instability. This first exercise gets to the heart of *why* this is the case by having you derive the continuation operator directly from Laplace's equation and examine its behavior in the Fourier domain [@problem_id:3618205]. By calculating a maximum safe continuation depth based on an amplification tolerance, you will develop a tangible understanding of how high-frequency components are amplified and why regularization is essential.", "problem": "Consider a scalar potential field $\\,\\phi(x,y,z)\\,$ in a source-free, homogeneous half-space that satisfies Laplace’s equation $\\,\\nabla^{2}\\phi=0\\,$ for $\\,z>0\\,$. Let the field be measured on the horizontal plane $\\,z=z_{0}\\,$ and suppose its two-dimensional horizontal Fourier transform $\\,\\widehat{\\phi}(\\mathbf{k},z)\\,$ with horizontal wavevector $\\,\\mathbf{k}\\in\\mathbb{R}^{2}\\,$ is band-limited such that $\\,\\widehat{\\phi}(\\mathbf{k},z_{0})=0\\,$ for all $\\,|\\mathbf{k}|>k_{c}\\,$, where $\\,k_{c}>0\\,$ is the cutoff wavenumber. Using only the fundamental base that $\\,\\phi\\,$ obeys $\\,\\nabla^{2}\\phi=0\\,$ and standard properties of the Fourier transform, first derive the multiplicative operator in the horizontal wavenumber domain that maps $\\,\\widehat{\\phi}(\\mathbf{k},z_{0})\\,$ to $\\,\\widehat{\\phi}(\\mathbf{k},z_{0}-h)\\,$ for a downward continuation distance $\\,h>0\\,$. Define the dynamic range of this operator over the band $\\,|\\mathbf{k}|\\in[0,k_{c}]\\,$ as the ratio of its maximum to minimum magnitude across this interval. Then, given a specified maximum allowable dynamic range factor $\\,R>1\\,$, determine symbolically the maximum downward continuation distance $\\,h_{\\max}\\,$ such that the dynamic range of the operator over $\\,|\\mathbf{k}|\\in[0,k_{c}]\\,$ does not exceed $\\,R\\,$. Express your final answer as a closed-form analytic expression in terms of $\\,k_{c}\\,$ and $\\,R\\,$. Assume $\\,k_{c}\\,$ is given in radians per meter and express $\\,h_{\\max}\\,$ in meters. No numerical rounding is required.", "solution": "` tag for detailed reasoning.\n- `<final_answer>` tag for the final answer in a `\\boxed{}`.\n\nLet's begin with the validation process.\n\n### Step 1: Extract Givens\n- A scalar potential field $\\phi(x,y,z)$ in a source-free, homogeneous half-space.\n- The field satisfies Laplace’s equation, $\\nabla^{2}\\phi=0$, for $z>0$.\n- The field is measured on the horizontal plane $z=z_{0}$.\n- The two-dimensional horizontal Fourier transform is $\\widehat{\\phi}(\\mathbf{k},z)$, with horizontal wavevector $\\mathbf{k}\\in\\mathbb{R}^{2}$.\n- The field is band-limited: $\\widehat{\\phi}(\\mathbf{k},z_{0})=0$ for all $|\\mathbf{k}|>k_{c}$, where $k_{c}>0$ is the cutoff wavenumber.\n- The required task is to derive the multiplicative operator that maps $\\widehat{\\phi}(\\mathbf{k},z_{0})$ to $\\widehat{\\phi}(\\mathbf{k},z_{0}-h)$ for a downward continuation distance $h>0$.\n- The dynamic range of the operator is defined as the ratio of its maximum to minimum magnitude over the band $|\\mathbf{k}|\\in[0,k_{c}]$.\n- A maximum allowable dynamic range factor is given as $R>1$.\n- The final goal is to determine the maximum downward continuation distance $h_{\\max}$ such that the dynamic range does not exceed $R$.\n- The final expression for $h_{\\max}$ should be in terms of $k_{c}$ and $R$.\n\n### Step 2: Validate Using Extracted Givens\nThe problem statement is evaluated against the validation criteria.\n\n- **Scientifically Grounded**: The problem is fundamentally sound. It is a classic problem in potential field theory, which is a cornerstone of geophysics, geodesy, and other physical sciences. The governing equation, Laplace's equation $\\nabla^{2}\\phi=0$, correctly describes potential fields (like gravity or magnetism) in source-free regions. The use of the Fourier transform to solve this linear partial differential equation is a standard, valid, and powerful mathematical technique. The concept of upward and downward continuation, the instability of downward continuation, and its regularization by limiting wavenumber or amplification factor are all core and realistic concepts in geophysical data processing.\n- **Well-Posed**: The problem is well-posed. It provides a clear physical and mathematical setup and asks for a specific, derivable quantity. The necessary physical assumption—that the potential field vanishes at infinite vertical distance ($z \\to \\infty$) from its sources, which are implicitly located at $z \\le 0$—is standard in this context and allows for a unique solution.\n- **Objective**: The language is precise, technical, and free of any subjective or ambiguous terminology.\n- **Incomplete or Contradictory Setup**: The problem is self-contained. All necessary variables ($k_c$, $R$), definitions (dynamic range), and physical laws ($\\nabla^2\\phi=0$) are provided. There are no contradictions.\n- **Unrealistic or Infeasible**: The setup is a simplified but physically realistic model used in practice. The notion of a perfectly band-limited signal is an idealization, but it is a common and useful one in signal processing theory.\n- **Ill-Posed or Poorly Structured**: The problem is well-structured, leading the solver from first principles (Laplace's equation) to the derivation of an operator and finally to a quantitative limit based on a stability criterion. The solution is unique and stable.\n\n### Step 3: Verdict and Action\nThe problem is valid. It is a standard and well-formulated problem in computational geophysics. I will now proceed with a full derivation of the solution.\n\nThe problem requires us to find the maximum downward continuation distance $h_{\\max}$ given a constraint on the dynamic range of the continuation operator. We begin by deriving this operator from first principles.\n\nThe scalar potential field $\\phi(x,y,z)$ satisfies Laplace's equation in the source-free half-space $z>0$:\n$$\n\\nabla^{2}\\phi = \\frac{\\partial^{2}\\phi}{\\partial x^{2}} + \\frac{\\partial^{2}\\phi}{\\partial y^{2}} + \\frac{\\partial^{2}\\phi}{\\partial z^{2}} = 0\n$$\nWe apply a two-dimensional Fourier transform in the horizontal spatial coordinates, $(x,y)$. Let $\\mathbf{k} = (k_x, k_y)$ be the horizontal wavevector. The Fourier transform of $\\phi(x,y,z)$ is defined as:\n$$\n\\widehat{\\phi}(\\mathbf{k},z) = \\mathcal{F}_{xy}\\{\\phi(x,y,z)\\} = \\int_{-\\infty}^{\\infty}\\int_{-\\infty}^{\\infty} \\phi(x,y,z) \\exp(-i(k_x x + k_y y)) \\,dx\\,dy\n$$\nUsing the differentiation property of the Fourier transform, $\\mathcal{F}\\{\\frac{\\partial^n f}{\\partial x^n}\\} = (ik_x)^n \\widehat{f}$, we transform Laplace's equation term by term:\n$$\n\\mathcal{F}_{xy}\\left\\{\\frac{\\partial^{2}\\phi}{\\partial x^{2}}\\right\\} = (ik_x)^{2}\\widehat{\\phi} = -k_x^{2}\\widehat{\\phi}(\\mathbf{k},z)\n$$\n$$\n\\mathcal{F}_{xy}\\left\\{\\frac{\\partial^{2}\\phi}{\\partial y^{2}}\\right\\} = (ik_y)^{2}\\widehat{\\phi} = -k_y^{2}\\widehat{\\phi}(\\mathbf{k},z)\n$$\nThe derivative with respect to $z$ is treated as a derivative of the transformed function:\n$$\n\\mathcal{F}_{xy}\\left\\{\\frac{\\partial^{2}\\phi}{\\partial z^{2}}\\right\\} = \\frac{\\partial^{2}}{\\partial z^{2}}\\widehat{\\phi}(\\mathbf{k},z)\n$$\nSubstituting these into the transformed Laplace's equation yields:\n$$\n-k_x^{2}\\widehat{\\phi}(\\mathbf{k},z) - k_y^{2}\\widehat{\\phi}(\\mathbf{k},z) + \\frac{d^{2}\\widehat{\\phi}}{dz^{2}}(\\mathbf{k},z) = 0\n$$\nLet $|\\mathbf{k}| = \\sqrt{k_x^2 + k_y^2}$ be the magnitude of the horizontal wavevector. The equation becomes an ordinary differential equation (ODE) in the variable $z$:\n$$\n\\frac{d^{2}\\widehat{\\phi}}{dz^{2}} - |\\mathbf{k}|^{2}\\widehat{\\phi} = 0\n$$\nThe general solution to this second-order homogeneous linear ODE is:\n$$\n\\widehat{\\phi}(\\mathbf{k},z) = A(\\mathbf{k})\\exp(|\\mathbf{k}|z) + B(\\mathbf{k})\\exp(-|\\mathbf{k}|z)\n$$\nwhere $A(\\mathbf{k})$ and $B(\\mathbf{k})$ are coefficients that depend on the wavevector $\\mathbf{k}$ and are determined by boundary conditions. The problem is set in the half-space $z>0$, with sources implicitly confined to the region $z \\le 0$. A fundamental property of potential fields from bounded sources is that they must decay to zero as the distance from the sources approaches infinity. Therefore, we must have $\\phi(x,y,z) \\to 0$ as $z \\to \\infty$. This implies that its Fourier transform $\\widehat{\\phi}(\\mathbf{k},z)$ must also decay to zero as $z \\to \\infty$. The term $\\exp(|\\mathbf{k}|z)$ grows with $z$ for any $|\\mathbf{k}|>0$. To satisfy the physical boundary condition at infinity, its coefficient must be zero, i.e., $A(\\mathbf{k})=0$. This leaves the physically valid solution:\n$$\n\\widehat{\\phi}(\\mathbf{k},z) = B(\\mathbf{k})\\exp(-|\\mathbf{k}|z)\n$$\nWe are given the field on the plane $z=z_0$ and want to find its value on the plane $z=z_0-h$, where $h>0$ is the downward continuation distance.\nAt $z=z_0$, the transformed field is:\n$$\n\\widehat{\\phi}(\\mathbf{k},z_0) = B(\\mathbf{k})\\exp(-|\\mathbf{k}|z_0)\n$$\nAt $z=z_0-h$, the transformed field is:\n$$\n\\widehat{\\phi}(\\mathbf{k},z_0-h) = B(\\mathbf{k})\\exp(-|\\mathbf{k}|(z_0-h))\n$$\nWe can express $B(\\mathbf{k})$ from the first equation as $B(\\mathbf{k}) = \\widehat{\\phi}(\\mathbf{k},z_0)\\exp(|\\mathbf{k}|z_0)$. Substituting this into the second equation:\n$$\n\\widehat{\\phi}(\\mathbf{k},z_0-h) = \\left( \\widehat{\\phi}(\\mathbf{k},z_0)\\exp(|\\mathbf{k}|z_0) \\right) \\exp(-|\\mathbf{k}|(z_0-h))\n$$\n$$\n\\widehat{\\phi}(\\mathbf{k},z_0-h) = \\widehat{\\phi}(\\mathbf{k},z_0)\\exp(|\\mathbf{k}|z_0 - |\\mathbf{k}|z_0 + |\\mathbf{k}|h)\n$$\n$$\n\\widehat{\\phi}(\\mathbf{k},z_0-h) = \\widehat{\\phi}(\\mathbf{k},z_0)\\exp(|\\mathbf{k}|h)\n$$\nThis relationship shows that, in the wavenumber domain, downward continuation by a distance $h$ is achieved by multiplication with the operator $C(\\mathbf{k},h) = \\exp(|\\mathbf{k}|h)$. This is the downward continuation operator.\n\nNext, we evaluate the dynamic range of this operator. The magnitude of the operator is $|C(\\mathbf{k},h)| = |\\exp(|\\mathbf{k}|h)| = \\exp(|\\mathbf{k}|h)$, since $|\\mathbf{k}|$ and $h$ are real and non-negative.\nThe problem states that the field is band-limited, so we are interested in the operator's behavior over the wavenumber interval $|\\mathbf{k}| \\in [0, k_c]$. The function $f(|\\mathbf{k}|) = \\exp(|\\mathbf{k}|h)$ is a monotonically increasing function of $|\\mathbf{k}|$ for $h>0$.\nThe minimum magnitude of the operator occurs at the minimum value of $|\\mathbf{k}|$, which is $|\\mathbf{k}|=0$:\n$$\n|C|_{\\min} = \\exp(0 \\cdot h) = \\exp(0) = 1\n$$\nThe maximum magnitude of the operator occurs at the maximum value of $|\\mathbf{k}|$, which is $|\\mathbf{k}|=k_c$:\n$$\n|C|_{\\max} = \\exp(k_c h)\n$$\nThe dynamic range, which we denote as $D$, is defined as the ratio of the maximum to minimum magnitude:\n$$\nD = \\frac{|C|_{\\max}}{|C|_{\\min}} = \\frac{\\exp(k_c h)}{1} = \\exp(k_c h)\n$$\nThe problem imposes the constraint that this dynamic range must not exceed a given factor $R > 1$. So, we must have:\n$$\nD \\le R\n$$\n$$\n\\exp(k_c h) \\le R\n$$\nWe seek the maximum downward continuation distance, $h_{\\max}$, that satisfies this condition. The maximum value of $h$ is obtained when the equality holds:\n$$\n\\exp(k_c h_{\\max}) = R\n$$\nTo solve for $h_{\\max}$, we take the natural logarithm of both sides of the equation:\n$$\n\\ln(\\exp(k_c h_{\\max})) = \\ln(R)\n$$\n$$\nk_c h_{\\max} = \\ln(R)\n$$\nFinally, isolating $h_{\\max}$ gives the desired expression:\n$$\nh_{\\max} = \\frac{\\ln(R)}{k_c}\n$$\nThis result is physically meaningful. It shows that the maximum continuation depth is directly proportional to the logarithm of the tolerated dynamic range and inversely proportional to the cutoff wavenumber of the signal. A signal with higher frequency content (larger $k_c$) is more sensitive to the amplification effect of downward continuation, thus limiting the achievable depth for a given stability constraint $R$.", "answer": "$$\n\\boxed{\\frac{\\ln(R)}{k_{c}}}\n$$", "id": "3618205"}, {"introduction": "Building on the Fourier-domain nature of the continuation operator, we now explore its numerical implementation using the Fast Fourier Transform (FFT). This practice addresses a critical artifact of using FFTs on finite data—the wrap-around error caused by implicit periodic boundary conditions [@problem_id:3618265]. You are challenged to analyze the source of this numerical contamination and evaluate the effectiveness of standard mitigation techniques, a crucial skill for producing reliable results.", "problem": "You are given a scalar potential field $u(x,y,0)$ measured over a rectangular domain of size $L_x \\times L_y$ on the plane $z=0$. In a source-free half-space above the plane, the potential satisfies Laplace’s equation $\\nabla^2 u = 0$. You seek to compute the continuation of the field to height $z=h$ (upward continuation) or depth $z=-h$ (downward continuation) using a Fast Fourier Transform (FFT)-based algorithm on a uniform grid, which implicitly assumes periodic boundary conditions with period $L_x$ and $L_y$ in the $x$ and $y$ directions.\n\nStarting from first principles of harmonic continuation in a source-free half-space and the properties of the discrete Fourier transform on a finite domain, analyze the origin and qualitative scaling of the bias introduced by the implicit periodic extension near the domain edges when performing upward or downward continuation. Then, determine which proposed mitigation strategies are scientifically justified and effective.\n\nSelect all options that are correct.\n\nA. The FFT-based continuation is equivalent, in the physical domain, to convolving $u$ with a lattice-summed Green’s function, i.e., the Poisson kernel periodically replicated on the $\\mathbb{Z}^2$ lattice of periods $L_x$ and $L_y$. Consequently, near an edge at a distance $d$, the dominant bias arises from the nearest periodic images at a separation $s \\approx \\min(L_x - 2d,\\, L_y - 2d)$. For upward continuation to height $h$, the bias magnitude scales like a Poisson-kernel tail $P(s,h) \\sim \\dfrac{h}{2\\pi (s^2 + h^2)^{3/2}}$, decaying rapidly as $s$ grows. A practical mitigation is to zero-pad in space to create a guard zone so that $s$ is large (e.g., several $h$), perform the continuation on the padded grid, and discard a border of width comparable to the guard zone.\n\nB. In downward continuation, high spatial frequencies are suppressed, so periodic wrap-around is negligible. Therefore, padding is unnecessary; in fact, using a rectangular (boxcar) window at the original edges is optimal to preserve resolution.\n\nC. Applying a smooth apodization (for example, a cosine taper) that decays to near zero at the boundaries before the FFT reduces boundary discontinuities, thereby reducing spectral leakage and the influence of periodic images. After continuation, restricting attention to the untapered interior reduces edge bias. This is particularly important for downward continuation, where high wavenumbers are amplified.\n\nD. Increasing the number of Fourier modes by zero-filling in the Fourier domain (interpolating in $k$) without enlarging the spatial extent increases the effective periodicity length and therefore removes wrap-around bias near the edges.\n\nE. Mirror-padding (even extension) of the data at the boundaries eliminates spurious image interactions for harmonic fields because solutions of Laplace’s equation are even-symmetric, so periodic sums no longer bias the edges; hence it is a complete remedy without discarding borders.", "solution": "The user wants me to analyze the problem statement regarding upward and downward continuation of potential fields using FFTs, and then evaluate the proposed mitigation strategies for edge effects.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n- A scalar potential field $u(x,y,0)$ is measured over a rectangular domain of size $L_x \\times L_y$ on the plane $z=0$.\n- In the source-free half-space above the plane ($z>0$), the potential satisfies Laplace’s equation $\\nabla^2 u = 0$.\n- The objective is to compute the continuation of the field to height $z=h$ (upward continuation) or depth $z=-h$ (downward continuation).\n- The method used is a Fast Fourier Transform (FFT)-based algorithm on a uniform grid.\n- The FFT algorithm implicitly assumes periodic boundary conditions with periods $L_x$ and $L_y$ in the $x$ and $y$ directions.\n- The task is to analyze the origin and scaling of the bias introduced by the periodic extension and evaluate proposed mitigation strategies.\n\n**Step 2: Validate Using Extracted Givens**\nThe problem statement is scientifically sound, well-posed, and objective.\n- **Scientifically Grounded:** The problem is rooted in fundamental principles of potential theory (Laplace's equation) and standard numerical methods in computational geophysics and signal processing (FFT-based filtering). The concepts of upward/downward continuation and artifacts from periodic boundary conditions are standard topics in this field.\n- **Well-Posed:** The problem is a conceptual analysis of a numerical method's properties. It asks for a qualitative analysis and evaluation of techniques, which is a well-defined task with scientifically verifiable answers.\n- **Objective:** The language is technical and precise. It describes a mathematical and computational setup without any subjective or ambiguous terms.\n\nAll criteria for a valid problem are met. No flaws are identified.\n\n**Step 3: Verdict and Action**\nThe problem is valid. I will proceed with the derivation and analysis.\n\n### Derivation from First Principles\n\nIn a source-free region, a potential field $u(x,y,z)$ satisfies Laplace's equation:\n$$ \\nabla^2 u = \\frac{\\partial^2 u}{\\partial x^2} + \\frac{\\partial^2 u}{\\partial y^2} + \\frac{\\partial^2 u}{\\partial z^2} = 0 $$\nWe can represent the field using a 2D Fourier transform with respect to the spatial coordinates $x$ and $y$. Let $\\hat{u}(k_x, k_y, z)$ be the Fourier transform of $u(x,y,z)$:\n$$ \\hat{u}(k_x, k_y, z) = \\iint u(x,y,z) e^{-i(k_x x + k_y y)} dx dy $$\nApplying the Fourier transform to Laplace's equation yields an ordinary differential equation in $z$:\n$$ (-k_x^2 - k_y^2)\\hat{u}(k_x, k_y, z) + \\frac{\\partial^2 \\hat{u}}{\\partial z^2}(k_x, k_y, z) = 0 $$\nLet $k = \\sqrt{k_x^2 + k_y^2}$ be the radial wavenumber. The equation becomes:\n$$ \\frac{\\partial^2 \\hat{u}}{\\partial z^2} - k^2 \\hat{u} = 0 $$\nThe general solution is $\\hat{u}(k,z) = A(k)e^{kz} + B(k)e^{-kz}$.\nFor the half-space $z \\ge 0$, we require the potential to be bounded as $z \\to \\infty$. This physical constraint implies that $A(k)=0$ for any $k \\ne 0$. Thus, the solution is $\\hat{u}(k,z) = B(k)e^{-kz}$.\nAt $z=0$, we have $\\hat{u}(k,0) = B(k)$. Therefore, the solution for any $z>0$ is:\n$$ \\hat{u}(k_x, k_y, z) = \\hat{u}(k_x, k_y, 0) e^{-kz} $$\nThis equation is the core of Fourier-domain continuation.\n- **Upward Continuation** to a height $z=h > 0$: We multiply the spectrum by the filter $e^{-kh}$. This is a low-pass filter, as it exponentially attenuates components with high wavenumbers $k$. The process is stable.\n- **Downward Continuation** to a depth $z=-h$ ($h>0$): We seek the field at a level below the measurement plane. Formally, this corresponds to using the operator $e^{-k(-h)} = e^{kh}$. This is a high-pass filter that exponentially *amplifies* high-wavenumber components. This makes the process inherently unstable and an ill-posed inverse problem, as any high-frequency noise in the data will be massively amplified.\n\nThe FFT-based algorithm implements this process on a discrete grid of size $L_x \\times L_y$. The use of the Discrete Fourier Transform (DFT), which is computed by the FFT algorithm, implicitly assumes that the data $u(x,y,0)$ is periodic with periods $L_x$ and $L_y$.\nBy the convolution theorem, multiplication in the Fourier domain is equivalent to convolution in the spatial domain. The spatial-domain operator corresponding to the filter $e^{-k|z|}$ is the Poisson kernel for half-space continuation, $P(x,y,z) = \\frac{|z|}{2\\pi (x^2+y^2+z^2)^{3/2}}$.\nBecause the FFT implies periodicity, the operation performed is not a standard convolution but a **circular convolution**. This is equivalent to convolving the original data patch with a periodized version of the kernel:\n$$ u_{FFT}(x,y,z) = u(x,y,0) * \\left( \\sum_{m,n=-\\infty}^{\\infty} P(x-mL_x, y-nL_y, z) \\right) $$\nwhere $*$ denotes convolution. The true solution would only involve the $m=0, n=0$ term. The bias, or \"wrap-around\" error, is the contribution from all other terms $(m,n) \\neq (0,0)$. This bias is largest near the boundaries of the domain, where the influence of the nearest periodic images of the data (e.g., from a distance of approximately $L_x$ and $L_y$) is strongest.\n\n### Option-by-Option Analysis\n\n**A. The FFT-based continuation is equivalent, in the physical domain, to convolving $u$ with a lattice-summed Green’s function, i.e., the Poisson kernel periodically replicated on the $\\mathbb{Z}^2$ lattice of periods $L_x$ and $L_y$. Consequently, near an edge at a distance $d$, the dominant bias arises from the nearest periodic images at a separation $s \\approx \\min(L_x - 2d,\\, L_y - 2d)$. For upward continuation to height $h$, the bias magnitude scales like a Poisson-kernel tail $P(s,h) \\sim \\dfrac{h}{2\\pi (s^2 + h^2)^{3/2}}$, decaying rapidly as $s$ grows. A practical mitigation is to zero-pad in space to create a guard zone so that $s$ is large (e.g., several $h$), perform the continuation on the padded grid, and discard a border of width comparable to the guard zone.**\n\nThis statement is largely correct.\n1. The description of the FFT-based process as convolution with a lattice-summed (periodized) Poisson kernel is accurate.\n2. The scaling of the bias with the Poisson kernel tail is correct. The distance to the nearest periodic image is of the order of the domain size, $L_x$ or $L_y$. So the bias at any point is influenced by the kernel evaluated at these distances. The decay is rapid, scaling approximately as $h/s^3$ for $s \\gg h$. The specific geometric formula for $s$ presented is somewhat non-standard, but the qualitative point that the bias depends on the distance to periodic images is correct.\n3. The proposed mitigation strategy—zero-padding in the spatial domain—is the standard and most effective method. Padding the data with a \"guard zone\" of zeros effectively increases the periods $L_x$ and $L_y$, thus increasing the separation $s$ from the periodic images. This drastically reduces the wrap-around bias in the region of the original data. Discarding the border after continuation is necessary to remove the areas affected by the artificial discontinuity introduced by the padding itself.\n\nVerdict: **Correct**.\n\n**B. In downward continuation, high spatial frequencies are suppressed, so periodic wrap-around is negligible. Therefore, padding is unnecessary; in fact, using a rectangular (boxcar) window at the original edges is optimal to preserve resolution.**\n\nThis statement is incorrect on multiple fundamental points.\n1. As derived above, downward continuation applies the operator $e^{kh}$, which *amplifies*, not suppresses, high spatial frequencies.\n2. Because of this amplification, any discontinuity at the boundary (which contains significant high-frequency power) will have its effects magnified. The periodic wrap-around of these amplified high-frequency artifacts will be severe, not negligible.\n3. Consequently, padding is *more* critical for downward continuation than for upward continuation to control these amplified artifacts. Using a rectangular window (i.e., no modification) is the worst-case scenario, as it creates a sharp step-discontinuity that dooms the procedure to failure from extreme ringing (Gibbs phenomenon) and wrap-around errors.\n\nVerdict: **Incorrect**.\n\n**C. Applying a smooth apodization (for example, a cosine taper) that decays to near zero at the boundaries before the FFT reduces boundary discontinuities, thereby reducing spectral leakage and the influence of periodic images. After continuation, restricting attention to the untapered interior reduces edge bias. This is particularly important for downward continuation, where high wavenumbers are amplified.**\n\nThis statement is correct and describes a critical best practice.\n1. Applying a smooth tapering window (apodization) forces the data to smoothly approach zero at the boundaries. This makes the periodic extension of the data continuous, which significantly reduces the high-frequency power associated with the artificial boundary jump (i.e., it mitigates spectral leakage).\n2. Reducing the spectral power of the discontinuities reduces the amplitude of the artifacts that can be wrapped around by the periodic convolution.\n3. The method modifies the data in the tapered region, so for an accurate result, one must discard this border and only consider the central, untapered part of the domain.\n4. This procedure is especially vital for downward continuation. By taming the artificial high-frequency content at the boundaries *before* applying the unstable $e^{kh}$ amplification operator, it helps stabilize the process and prevent the catastrophic amplification of numerical artifacts.\n\nVerdict: **Correct**.\n\n**D. Increasing the number of Fourier modes by zero-filling in the Fourier domain (interpolating in $k$) without enlarging the spatial extent increases the effective periodicity length and therefore removes wrap-around bias near the edges.**\n\nThis statement is incorrect. It confuses the effects of padding in the spatial domain versus the frequency domain.\n1. Zero-filling (or zero-padding) in the *Fourier domain* (i.e., inserting zeros between the existing coefficients, typically around the Nyquist frequency) corresponds to interpolation in the *spatial domain*. The result is a denser grid of points within the same original spatial extent ($L_x \\times L_y$).\n2. This operation does *not* change the fundamental periods $L_x$ and $L_y$. Therefore, it does not increase the distance to the periodic images and does nothing to mitigate the wrap-around bias. To increase the periodicity length, one must perform zero-padding in the *spatial domain* before the forward FFT.\n\nVerdict: **Incorrect**.\n\n**E. Mirror-padding (even extension) of the data at the boundaries eliminates spurious image interactions for harmonic fields because solutions of Laplace’s equation are even-symmetric, so periodic sums no longer bias the edges; hence it is a complete remedy without discarding borders.**\n\nThis statement is incorrect.\n1. The primary premise that \"solutions of Laplace’s equation are even-symmetric\" is false. A general harmonic function (e.g., $u(x)=x$) is not even-symmetric about an arbitrary boundary.\n2. Mirror-padding (even extension) is a powerful technique that creates continuity of the function and its first derivative across the periodic boundary (if implemented correctly), which is highly effective at reducing spectral leakage. It is equivalent to performing a Discrete Cosine Transform (DCT).\n3. However, it is not a \"complete remedy\". It implicitly imposes a Neumann boundary condition ($\\partial u / \\partial n = 0$, where $n$ is the normal to the boundary) on the data. The true potential field is not guaranteed to satisfy this artificial condition. While often superior to zero-padding, it still introduces an artifact, and the results near the boundary will be biased by this imposed symmetry. Therefore, claiming it is a \"complete remedy without discarding borders\" is a significant overstatement.\n\nVerdict: **Incorrect**.", "answer": "$$\\boxed{AC}$$", "id": "3618265"}, {"introduction": "This final practice synthesizes theory and numerical methods through a hands-on coding exercise. You will implement and compare Fourier and wavelet-based continuation algorithms, allowing you to directly observe the impact of boundary conditions discussed previously [@problem_id:3618265] and see how different strategies perform in practice [@problem_id:3618227]. This exercise not only solidifies your understanding of FFT-based methods but also introduces wavelet analysis as a powerful, spatially-adaptive alternative for geophysical signal processing.", "problem": "Consider a scalar potential field sampled on a $1$-dimensional uniform grid. In a homogeneous source-free region, the scalar potential satisfies Laplace’s equation. For vertical continuation between two horizontal planes separated by a distance $h$, the continuation operator in the spatial Fourier domain depends only on the magnitude of the horizontal wavenumber. Starting from Laplace’s equation and separation of variables, derive the vertical propagation factor in the horizontal Fourier domain as a function of the absolute horizontal wavenumber and the continuation distance $h$. Then, design a wavelet-domain approximation to this operator by assigning a single representative wavenumber to each dyadic wavelet scale and applying a scale-dependent factor per level. Use the orthonormal Haar wavelet for the wavelet-domain implementation.\n\nYour task is to write a complete program that:\n- Implements three continuation operators on a $1$-dimensional signal sampled at $N$ points with spacing $dx$:\n  $1)$ a “reference” Fourier-domain continuation using large zero-padding (to approximate free-space boundary conditions),\n  $2)$ a “naive” Fourier-domain continuation using the discrete Fourier transform at the original length $N$ (which enforces periodic boundaries),\n  $3)$ a wavelet-domain continuation using Haar wavelets with scale-dependent factors based on a representative wavenumber per level.\n- Handles both upward continuation (positive $h$) and mildly downward continuation (negative $h$) by incorporating a stabilizing high-wavenumber regularization for the downward case that is applied consistently in all three methods in their respective spectral variables.\n\nFundamental base for derivation and design:\n- Use Laplace’s equation and separation of variables to justify the existence of an exponential vertical propagation factor in the horizontal spectral domain.\n- For the wavelet-domain approximation, define an effective wavenumber per dyadic detail level $j$ by identifying a representative bandcenter for the Haar detail at that level. Use this $k_{\\text{eff}}(j)$ to form the level-dependent factor. The approximation must treat the scaling (coarsest) coefficients as the lowest-frequency band with an effective wavenumber of zero.\n\nSignal and grid specification (dimensionless units):\n- Use a $1$-dimensional grid with $N = 256$ points and spacing $dx = 1$. Let the domain length be $L = N \\, dx$ and positions $x_n = n \\, dx$ for $n = 0, 1, \\dots, N-1$.\n- Construct a synthetic band-limited signal as a sum of two Gaussian anomalies placed so that one is near a boundary to expose boundary-handling differences:\n  $$ f(x) = A_1 \\exp\\!\\left(-\\frac{(x - x_1)^2}{2 \\sigma_1^2}\\right) + A_2 \\exp\\!\\left(-\\frac{(x - x_2)^2}{2 \\sigma_2^2}\\right), $$\n  where $A_1 = 1$, $x_1 = 0.05 L$, $\\sigma_1 = 0.02 L$, $A_2 = 0.7$, $x_2 = 0.65 L$, and $\\sigma_2 = 0.06 L$.\n\nReference Fourier-domain continuation:\n- Construct a zero-padded array of length $N_p = p \\, N$ with a padding factor $p = 8$, placing the original signal centered within the padded array and zeros elsewhere, and use the discrete Fourier transform at spacing $dx$ to apply the vertical propagation factor in the spectral domain. Transform back and extract the original central segment of length $N$.\n\nNaive Fourier-domain continuation:\n- Apply the same spectral-domain propagation at the original length $N$ (i.e., periodic boundary assumption).\n\nWavelet-domain continuation:\n- Implement the orthonormal Haar wavelet transform to full depth ($\\log_2 N$ levels).\n- For detail level $j \\in \\{1, 2, \\dots, \\log_2 N\\}$, assign an effective wavenumber\n  $$ k_{\\text{eff}}(j) = \\frac{\\pi}{2^j \\, dx}. $$\n  Treat the scaling (coarsest) coefficients as $k_{\\text{eff}} = 0$.\n- Apply the same functional dependence on $k_{\\text{eff}}(j)$ and $h$ as in the Fourier-domain derivation (from Laplace’s equation) to each level’s coefficients. For downward continuation ($h < 0$), stabilize with a multiplicative regularization factor of the form\n  $$ R(k) = \\frac{1}{1 + \\left(\\frac{|k|}{k_c}\\right)^p}, $$\n  applied to both Fourier-domain and wavelet-domain implementations, using the same $k_c$ and $p$ parameters in both domains. The regularization is only active for $h < 0$; for $h \\ge 0$ set $R(k) = 1$.\n\nPerformance metrics to compute:\n- For each test case, produce the following comparisons against the “reference” (zero-padded) Fourier continuation result:\n  $1)$ the relative $\\ell_2$ error of the wavelet-domain result,\n  $2)$ the relative $\\ell_2$ error of the naive Fourier-domain result,\n  $3)$ the improvement defined as the naive error minus the wavelet error (a positive number indicates the wavelet method is closer to the reference).\n- For one specific test, also report a boundary-focused metric: the mean absolute error over the first $M = 24$ samples, and the boundary-improvement defined as the naive boundary error minus the wavelet boundary error.\n\nTest suite:\n- Use the fixed grid and signal defined above. Evaluate the following four scenarios:\n  $1)$ Upward continuation with $h = 10$.\n  $2)$ Upward continuation with $h = 30$.\n  $3)$ Mild downward continuation with $h = -5$, using $k_c = \\frac{\\pi}{6 \\, dx}$ and $p = 4$.\n  $4)$ Upward continuation with $h = 15$, and report the boundary-focused improvement over the first $M = 24$ samples instead of the global $\\ell_2$ improvement.\n\nAnswer specification:\n- All quantities are dimensionless. No physical units are required in the output.\n- Your program must compute, for each of the four scenarios above, a single float equal to the improvement defined in the “Performance metrics” section. For scenarios $1$, $2$, and $3$ this improvement is the global $\\ell_2$ improvement; for scenario $4$ this improvement is the boundary-focused improvement over the first $M = 24$ samples.\n- Final output format: Your program should produce a single line of output containing the four results as a comma-separated list enclosed in square brackets (e.g., $[r_1,r_2,r_3,r_4]$). No other text should be printed.", "solution": "The problem requires the derivation of the vertical continuation operator for a potential field and its implementation using three different numerical methods: a reference Fourier-domain method with large zero-padding, a naive Fourier-domain method assuming periodicity, and a wavelet-domain approximation using the Haar basis. The performance of the naive and wavelet methods is to be evaluated against the reference method for several test cases.\n\n### 1. Derivation of the Vertical Continuation Operator\n\nA scalar potential field $\\Phi$ in a two-dimensional, homogeneous, source-free region $(x, z)$ satisfies Laplace's equation:\n$$\n\\frac{\\partial^2 \\Phi}{\\partial x^2} + \\frac{\\partial^2 \\Phi}{\\partial z^2} = 0\n$$\nHere, $x$ is the horizontal coordinate and $z$ is the vertical coordinate. We seek a solution using the method of separation of variables, assuming a solution of the form $\\Phi(x, z) = X(x)Z(z)$. Substituting this into Laplace's equation and rearranging gives:\n$$\n\\frac{1}{X(x)}\\frac{d^2 X}{dx^2} = -\\frac{1}{Z(z)}\\frac{d^2 Z}{dz^2}\n$$\nSince the left side depends only on $x$ and the right side only on $z$, both must be equal to a constant, which we denote as $-k^2$. This yields two ordinary differential equations:\n$$\n\\frac{d^2 X}{dx^2} + k^2 X(x) = 0 \\quad \\implies \\quad X(x) \\propto e^{\\pm i k x}\n$$\n$$\n\\frac{d^2 Z}{dz^2} - k^2 Z(z) = 0 \\quad \\implies \\quad Z(z) \\propto e^{\\pm k z}\n$$\nThe general solution for the vertical dependence is $Z(z) = C e^{kz} + D e^{-kz}$. However, since $k$ appears as $k^2$ in the separation constant, the z-dependence must be a function of the magnitude of the horizontal wavenumber, $|k|$. The solution for the vertical dependence is more generally written as $Z(z) \\propto e^{\\pm |k| z}$.\n\nWe assume the potential sources are located at $z < 0$, and the field is measured on the plane $z=0$. For upward continuation, we are interested in the field in the region $z > 0$. The potential field must remain bounded and decay to zero as $z \\to \\infty$. This physical constraint requires that we discard the exponentially growing term $e^{|k|z}$, leaving only the decaying term $e^{-|k|z}$.\n\nTherefore, a single harmonic component of the potential field has the form $\\Phi_k(x, z) \\propto e^{ikx} e^{-|k|z}$. The full potential is a superposition (integral) of all such components. If we take the spatial Fourier transform of the potential field with respect to the horizontal coordinate $x$, denoted by $\\mathcal{F}$, we have:\n$$\n\\hat{\\Phi}(k, z) = \\mathcal{F}\\{\\Phi(x,z)\\}\n$$\nFrom the separated solution, the relationship between the field's spectrum at two different heights, say $z=0$ and $z=h$, is:\n$$\n\\hat{\\Phi}(k, h) = \\hat{\\Phi}(k, 0) e^{-|k|h}\n$$\nThe factor $P(k, h) = e^{-|k|h}$ is the **vertical propagation factor** in the horizontal Fourier domain.\n- For **upward continuation** ($h > 0$), this factor is a low-pass filter, attenuating high-wavenumber components. This is a stable operation, reflecting the physical reality that field details are smoothed out with distance.\n- For **downward continuation** ($h < 0$), the factor becomes $e^{|k|(-h)}$, which amplifies high-wavenumber components. This makes the process an ill-posed inverse problem, highly sensitive to noise. To stabilize it, a regularization filter is required. As specified, we use a Tikhonov-style filter:\n$$\nR(k) = \\frac{1}{1 + \\left(\\frac{|k|}{k_c}\\right)^p}\n$$\nwhere $k_c$ is a cutoff wavenumber and $p$ controls the steepness of the cutoff. The full operator for downward continuation is the product $P(k, h) R(k)$. For upward continuation, $R(k) = 1$.\n\n### 2. Numerical Implementation Strategies\n\nWe are tasked with implementing three methods to apply this operator on a discrete grid.\n\n**Reference Fourier-Domain Method:**\nThe Discrete Fourier Transform (DFT) inherently assumes that the signal is periodic. This can cause wrap-around artifacts (aliasing) when applying a filter, especially if the signal is not close to zero at its boundaries. To approximate a non-periodic, free-space scenario, the signal is embedded in the center of a much larger array of zeros. This zero-padding effectively isolates the signal from its periodic images. The procedure is:\n1.  Create a padded array of length $N_p = p \\cdot N$ (with $p=8$) and place the original signal of length $N$ in its center.\n2.  Compute the DFT of the padded signal.\n3.  Calculate the propagation operator $e^{-|k|h}$ for the wavenumbers $k$ corresponding to the padded length $N_p$.\n4.  Multiply the transformed signal by the operator.\n5.  Compute the inverse DFT.\n6.  Extract the central part of the resulting array, corresponding to the original signal's domain.\n\n**Naive Fourier-Domain Method:**\nThis method ignores boundary effects and applies the DFT directly to the original, unpadded signal of length $N$. The steps are identical to the reference method but with $p=1$ (i.e., no padding). This approach is computationally efficient but suffers from wrap-around artifacts, especially for signals with significant amplitude near the boundaries.\n\n**Wavelet-Domain Method:**\nThis method provides a compromise between the accuracy of the padded Fourier method and the efficiency of the naive method. The Discrete Wavelet Transform (DWT) decomposes a signal into components that are localized in both space and scale (frequency). The approximation is based on applying a single continuation factor to all coefficients at a given scale.\n1.  **Decomposition**: An orthonormal Haar DWT is applied recursively to the signal of length $N=2^J$, yielding a set of approximation (scaling) coefficients $a_J$ (1 coefficient) and detail coefficients $\\{d_j\\}_{j=1}^J$ for each level $j$. Level $d_j$ contains $2^{J-j}$ coefficients.\n2.  **Scale-Dependent Filtering**: A single representative wavenumber is assigned to each wavelet level.\n    - For the detail coefficients $d_j$ at level $j$, which capture variations at a scale of roughly $2^j dx$, the effective wavenumber is $k_{\\text{eff}}(j) = \\frac{\\pi}{2^j dx}$.\n    - For the coarsest scaling coefficient $a_J$, which represents the DC component or mean of the signal, the effective wavenumber is $k_{\\text{eff}} = 0$.\n3.  The propagation operator, including regularization for $h<0$, is evaluated at this $k_{\\text{eff}}(j)$ and applied as a multiplicative factor to all coefficients in the corresponding level $d_j$. The scaling coefficient $a_J$ is multiplied by the operator at $k=0$, which is $1$.\n4.  **Reconstruction**: The signal is reconstructed from the modified coefficients using the inverse DWT.\n\nBecause wavelets are spatially localized, this method is expected to handle signal boundaries more gracefully than the naive DFT, reducing wrap-around artifacts without the need for extensive padding.\n\n### 3. Performance Evaluation\n\nThe comparison is made against the zero-padded Fourier method, treated as the \"ground truth\" or reference solution. The key metrics are:\n- **Relative $\\ell_2$ Error**: $\\frac{\\|\\mathbf{y}_{\\text{method}} - \\mathbf{y}_{\\text{ref}}\\|_2}{\\|\\mathbf{y}_{\\text{ref}}\\|_2}$, where $\\mathbf{y}$ is the continued signal vector.\n- **Mean Absolute Boundary Error**: $\\frac{1}{M}\\sum_{n=0}^{M-1} |y_{\\text{method}, n} - y_{\\text{ref}, n}|$, focusing on the first $M$ samples.\n- **Improvement**: The primary output is the improvement of the wavelet method over the naive Fourier method, defined as the difference in their respective errors: $\\text{Improvement} = \\text{Error}_{\\text{naive}} - \\text{Error}_{\\text{wavelet}}$. A positive value indicates that the wavelet method is a better approximation of the reference solution.", "answer": "```python\nimport numpy as np\n\ndef dwt_one_level(s):\n    \"\"\"Performs one level of the orthonormal Haar 1D DWT.\"\"\"\n    if len(s) % 2 != 0:\n        raise ValueError(\"Signal length must be a power of 2.\")\n    s_even = s[0::2]\n    s_odd = s[1::2]\n    sqrt2_inv = 1.0 / np.sqrt(2.0)\n    a = (s_even + s_odd) * sqrt2_inv\n    d = (s_even - s_odd) * sqrt2_inv\n    return a, d\n\ndef dwt_full(signal):\n    \"\"\"Performs a full multi-level orthonormal Haar 1D DWT.\"\"\"\n    coeffs = []\n    a = signal.copy()\n    num_levels = int(np.log2(len(a)))\n    for _ in range(num_levels):\n        a, d = dwt_one_level(a)\n        coeffs.insert(0, d)\n    coeffs.insert(0, a) # Final list is [a_J, d_J, d_{J-1}, ..., d_1]\n    return coeffs\n\ndef idwt_one_level(a, d):\n    \"\"\"Performs one level of the orthonormal Haar 1D IDWT.\"\"\"\n    if len(a) != len(d):\n        raise ValueError(\"Approximation and detail coeffs must have the same length.\")\n    sqrt2_inv = 1.0 / np.sqrt(2.0)\n    s = np.zeros(len(a) * 2)\n    s[0::2] = (a + d) * sqrt2_inv\n    s[1::2] = (a - d) * sqrt2_inv\n    return s\n\ndef idwt_full(coeffs):\n    \"\"\"Performs a full multi-level orthonormal Haar 1D IDWT.\"\"\"\n    # coeffs list is [a_J, d_J, ..., d_1]\n    a = coeffs[0]\n    for i in range(1, len(coeffs)):\n        d = coeffs[i]\n        a = idwt_one_level(a, d)\n    return a\n\ndef fourier_continuation(signal, h, dx, p_pad, kc, p_reg):\n    \"\"\"\n    Performs vertical continuation in the Fourier domain.\n    p_pad=1 for naive method, p_pad > 1 for reference (padded) method.\n    \"\"\"\n    N = len(signal)\n    Np = N * p_pad\n\n    if p_pad > 1:\n        padded_signal = np.zeros(Np, dtype=float)\n        start = (Np - N) // 2\n        padded_signal[start:start + N] = signal\n        signal_to_transform = padded_signal\n    else:\n        signal_to_transform = signal\n\n    F = np.fft.fft(signal_to_transform)\n    k = 2.0 * np.pi * np.fft.fftfreq(Np, d=dx)\n\n    # Propagation factor\n    prop_factor = np.exp(-np.abs(k) * h)\n\n    # Regularization factor (only for downward continuation)\n    if h < 0:\n        # To avoid division by zero for k=0 if kc=0 (though problem has kc > 0)\n        with np.errstate(divide='ignore', invalid='ignore'):\n            reg_factor = 1.0 / (1.0 + (np.abs(k) / kc)**p_reg)\n        reg_factor[np.isinf(reg_factor)] = 0 # Handle cases of large k\n        reg_factor[np.isnan(reg_factor)] = 1 # Handle k=0 case\n    else:\n        reg_factor = np.ones_like(k)\n        \n    operator = prop_factor * reg_factor\n    F_continued = F * operator\n    continued_signal_padded = np.fft.ifft(F_continued).real\n\n    if p_pad > 1:\n        start = (Np - N) // 2\n        return continued_signal_padded[start:start + N]\n    else:\n        return continued_signal_padded\n\ndef wavelet_continuation(signal, h, dx, kc, p_reg):\n    \"\"\"Performs vertical continuation in the Haar wavelet domain.\"\"\"\n    N = len(signal)\n    J = int(np.log2(N))\n    \n    # Forward DWT\n    coeffs = dwt_full(signal)\n    \n    modified_coeffs = []\n    \n    # Process scaling coefficient (a_J): k_eff=0, operator=1, so no change\n    modified_coeffs.append(coeffs[0]) \n    \n    # Process detail coefficients (d_j for j=J..1)\n    # The coeffs list is [a_J, d_J, ..., d_1]\n    for i in range(1, J + 1):\n        # Level j corresponds to index i in the list. j = J - i + 1\n        j = J - i + 1\n        d_level = coeffs[i]\n        \n        k_eff = np.pi / (2**j * dx)\n        \n        # Propagation factor\n        prop_factor = np.exp(-k_eff * h)\n        \n        # Regularization factor\n        if h < 0:\n            reg_factor = 1.0 / (1.0 + (k_eff / kc)**p_reg)\n        else:\n            reg_factor = 1.0\n        \n        operator = prop_factor * reg_factor\n        d_level_mod = d_level * operator\n        modified_coeffs.append(d_level_mod)\n    \n    # Inverse DWT\n    reconstructed_signal = idwt_full(modified_coeffs)\n    return reconstructed_signal\n\ndef solve():\n    \"\"\"\n    Main function to run the simulations and compute performance metrics.\n    \"\"\"\n    # Signal and grid specification\n    N = 256\n    dx = 1.0\n    L = N * dx\n    x = np.arange(N) * dx\n\n    # Synthetic signal parameters\n    A1 = 1.0\n    x1 = 0.05 * L\n    sigma1 = 0.02 * L\n    A2 = 0.7\n    x2 = 0.65 * L\n    sigma2 = 0.06 * L\n\n    # Construct the signal\n    signal = A1 * np.exp(-(x - x1)**2 / (2.0 * sigma1**2)) + \\\n             A2 * np.exp(-(x - x2)**2 / (2.0 * sigma2**2))\n\n    # General configuration\n    p_pad = 8\n    M_boundary = 24\n\n    # Test suite\n    test_cases = [\n        {'h': 10.0, 'kc': None, 'p_reg': None, 'metric': 'global_improvement'},\n        {'h': 30.0, 'kc': None, 'p_reg': None, 'metric': 'global_improvement'},\n        {'h': -5.0, 'kc': np.pi / (6.0 * dx), 'p_reg': 4.0, 'metric': 'global_improvement'},\n        {'h': 15.0, 'kc': None, 'p_reg': None, 'metric': 'boundary_improvement'},\n    ]\n\n    results = []\n\n    for case in test_cases:\n        h = case['h']\n        kc = case['kc']\n        p_reg = case['p_reg']\n\n        # 1. Reference (zero-padded Fourier) continuation\n        ref_res = fourier_continuation(signal, h, dx, p_pad, kc, p_reg)\n        \n        # 2. Naive (periodic Fourier) continuation\n        nai_res = fourier_continuation(signal, h, dx, 1, kc, p_reg)\n        \n        # 3. Wavelet-domain continuation\n        wav_res = wavelet_continuation(signal, h, dx, kc, p_reg)\n\n        if case['metric'] == 'global_improvement':\n            norm_ref = np.linalg.norm(ref_res)\n            # Avoid division by zero if reference signal is all-zero\n            if norm_ref == 0:\n                err_wav = np.linalg.norm(wav_res - ref_res)\n                err_nai = np.linalg.norm(nai_res - ref_res)\n            else:\n                err_wav = np.linalg.norm(wav_res - ref_res) / norm_ref\n                err_nai = np.linalg.norm(nai_res - ref_res) / norm_ref\n            \n            improvement = err_nai - err_wav\n            results.append(improvement)\n            \n        elif case['metric'] == 'boundary_improvement':\n            err_wav_boundary = np.mean(np.abs(wav_res[:M_boundary] - ref_res[:M_boundary]))\n            err_nai_boundary = np.mean(np.abs(nai_res[:M_boundary] - ref_res[:M_boundary]))\n            \n            improvement = err_nai_boundary - err_wav_boundary\n            results.append(improvement)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3618227"}]}