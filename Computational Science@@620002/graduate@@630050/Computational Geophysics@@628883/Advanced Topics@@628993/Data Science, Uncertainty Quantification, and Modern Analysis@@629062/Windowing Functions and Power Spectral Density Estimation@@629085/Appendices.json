{"hands_on_practices": [{"introduction": "The first step in mitigating spectral leakage is choosing an appropriate window function, and the Kaiser window is a versatile tool for this purpose. This practice guides you through designing a Kaiser window to meet a specific sidelobe attenuation target, directly illustrating the fundamental trade-off between spectral resolution and dynamic range. By deriving and applying the concept of Equivalent Noise Bandwidth (ENBW), you will quantify this trade-off and build an intuition for how different windows impact your spectral estimates. [@problem_id:3618894]", "problem": "A discrete-time geophysical signal, sampled at uniform spacing, is analyzed with a Discrete Fourier Transform (DFT) of length $N$. To mitigate spectral leakage in the estimation of the Power Spectral Density (PSD), the time series is tapered with a window $w[n]$ prior to computing the periodogram. Consider the Kaiser window, defined on the index set $n = 0,1,\\dots,N-1$ by\n$$\nw[n] = \\frac{I_0\\left(\\beta \\sqrt{1 - \\left(\\frac{n - \\alpha}{\\alpha}\\right)^2}\\right)}{I_0(\\beta)}, \\quad \\alpha = \\frac{N-1}{2},\n$$\nwhere $I_0(\\cdot)$ is the modified Bessel function of the first kind and order zero, and $\\beta \\ge 0$ is a tunable shape parameter controlling the trade-off between mainlobe width and sidelobe attenuation. For a given target sidelobe attenuation (specified as a negative decibel level, e.g., $-60$ $\\mathrm{dB}$), a widely accepted design rule relates the magnitude of attenuation to a corresponding choice of $\\beta$.\n\nThe Equivalent Noise Bandwidth (ENBW) of a window quantifies the bandwidth over which white noise is averaged by the window’s spectral response. In continuous frequency, ENBW is defined by\n$$\n\\mathrm{ENBW} = \\frac{\\int_{-\\infty}^{\\infty} |W(f)|^2 \\, df}{|W(0)|^2},\n$$\nwhere $W(f)$ is the Fourier transform of $w[n]$. For DFT-based analysis with bin spacing $\\Delta f$ and a rectangular window baseline for comparison, it is standard to express ENBW in units of DFT bins. Using first principles that relate Parseval’s theorem in the discrete-time setting to the integrated squared window spectrum, derive a discrete-sum expression for the ENBW in bins as a function of $N$ and $w[n]$. Then, using that expression, compute ENBW for the Kaiser window instances in the test suite defined below.\n\nDefine the resolution loss relative to the rectangular window as the ratio of the ENBW (in bins) of the chosen window to that of the rectangular window. For the rectangular window $w[n]=1$, use the discrete-sum expression to show that its ENBW equals $1$ bin, making the resolution loss equal to the ENBW of the chosen window.\n\nYour tasks are:\n1. Given a target sidelobe attenuation in decibels (negative number, e.g., $-60$ $\\mathrm{dB}$), choose the Kaiser parameter $\\beta$ that meets the target using a well-tested design rule that maps attenuation magnitude to $\\beta$.\n2. Using your derived discrete-sum expression, compute the ENBW (in bins) for the Kaiser window of length $N$.\n3. Estimate the resolution loss relative to the rectangular window as the ENBW ratio defined above.\n\nAnswer all numerical quantities as dimensionless floats. Angles do not appear. No physical units are required because ENBW is expressed in bins and resolution loss is a ratio. Round all reported floats to six decimal places.\n\nImplement a program that evaluates the following test suite, where each case is a pair $(S_{\\mathrm{dB}}, N)$:\n- Case 1 (happy path): $(-60.0, 1024)$.\n- Case 2 (boundary of design rule): $(-50.0, 1024)$.\n- Case 3 (edge case yielding $\\beta=0$): $(-10.0, 1024)$.\n- Case 4 (higher attenuation, smaller $N$): $(-80.0, 256)$.\n- Case 5 (very high attenuation, larger $N$): $(-100.0, 4096)$.\n\nFor each case, produce a triple $[\\beta, \\mathrm{ENBW\\_bins}, \\mathrm{resolution\\_loss}]$. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with each case represented as a nested list of three floats, for example:\n$[[\\beta_1,\\mathrm{ENBW}_1,\\mathrm{loss}_1],[\\beta_2,\\mathrm{ENBW}_2,\\mathrm{loss}_2],\\dots]$.", "solution": "The problem requires the derivation and application of a discrete-sum formula for the Equivalent Noise Bandwidth (ENBW) of a window function, specifically the Kaiser window, in the context of spectral analysis. The solution proceeds in three principal stages: first, the derivation of the ENBW formula from fundamental principles; second, the specification of the design rules for the Kaiser window; and third, the application of these results to compute the required quantities for the provided test cases.\n\n### Derivation of the Discrete-Sum Expression for ENBW\n\nThe Equivalent Noise Bandwidth (ENBW) is a measure of a filter's or window's effective bandwidth for noise. The continuous-frequency definition is given as:\n$$\n\\mathrm{ENBW_{Hz}} = \\frac{\\int_{-\\infty}^{\\infty} |W(f)|^2 \\, df}{|W(0)|^2}\n$$\nwhere $W(f)$ is the Fourier Transform of the continuous-time window function $w(t)$. In our discrete-time setting, we are given a window sequence $w[n]$ of length $N$, defined for $n = 0, 1, \\dots, N-1$. The relevant Fourier transform is the Discrete-Time Fourier Transform (DTFT), $W(e^{j\\omega})$, which is periodic in frequency with period $f_s$, the sampling rate. The integral is thus performed over one period, for instance, from $-f_s/2$ to $f_s/2$.\n$$\n\\mathrm{ENBW_{Hz}} = \\frac{\\int_{-f_s/2}^{f_s/2} |W(e^{j2\\pi f T_s})|^2 \\, df}{|W(e^{j0})|^2}\n$$\nwhere $T_s = 1/f_s$ is the sampling period.\n\nThe numerator involves the integral of the squared magnitude of the DTFT. We can relate this integral to the energy of the time-domain sequence using Parseval's theorem for discrete-time signals:\n$$\n\\sum_{n=-\\infty}^{\\infty} |w[n]|^2 = \\frac{1}{2\\pi} \\int_{-\\pi}^{\\pi} |W(e^{j\\omega})|^2 \\, d\\omega\n$$\nLet's perform a change of variables in the numerator's integral from frequency $f$ to normalized angular frequency $\\omega = 2\\pi f T_s$. This gives $df = d\\omega / (2\\pi T_s)$, and the integration limits change from $[-f_s/2, f_s/2]$ to $[-\\pi, \\pi]$.\n$$\n\\int_{-f_s/2}^{f_s/2} |W(e^{j2\\pi f T_s})|^2 \\, df = \\int_{-\\pi}^{\\pi} |W(e^{j\\omega})|^2 \\frac{d\\omega}{2\\pi T_s} = \\frac{1}{T_s} \\left( \\frac{1}{2\\pi} \\int_{-\\pi}^{\\pi} |W(e^{j\\omega})|^2 \\, d\\omega \\right)\n$$\nApplying Parseval's theorem, and noting that $w[n]$ is zero outside $n = 0, \\dots, N-1$, the expression becomes:\n$$\n\\frac{1}{T_s} \\sum_{n=0}^{N-1} |w[n]|^2\n$$\nSince window functions are typically real-valued, this simplifies to $\\frac{1}{T_s} \\sum_{n=0}^{N-1} w[n]^2$.\n\nThe denominator is the squared magnitude of the DTFT at zero frequency ($f=0$, $\\omega=0$), which is the DC component:\n$$\nW(e^{j0}) = \\sum_{n=0}^{N-1} w[n] e^{-j0 \\cdot n} = \\sum_{n=0}^{N-1} w[n]\n$$\nThus, the denominator is $(\\sum_{n=0}^{N-1} w[n])^2$.\n\nCombining the numerator and denominator, we obtain the ENBW in units of Hz:\n$$\n\\mathrm{ENBW_{Hz}} = \\frac{\\frac{1}{T_s} \\sum_{n=0}^{N-1} w[n]^2}{(\\sum_{n=0}^{N-1} w[n])^2}\n$$\nThe problem requires the ENBW in units of DFT bins. For an $N$-point DFT, the frequency resolution, or bin spacing, is $\\Delta f = f_s/N$. To convert from Hz to bins, we divide by $\\Delta f$:\n$$\n\\mathrm{ENBW_{bins}} = \\frac{\\mathrm{ENBW_{Hz}}}{\\Delta f} = \\frac{\\mathrm{ENBW_{Hz}}}{f_s/N} = \\frac{N}{f_s} \\mathrm{ENBW_{Hz}}\n$$\nSubstituting the expression for $\\mathrm{ENBW_{Hz}}$:\n$$\n\\mathrm{ENBW_{bins}} = \\frac{N}{f_s} \\frac{\\frac{1}{T_s} \\sum_{n=0}^{N-1} w[n]^2}{(\\sum_{n=0}^{N-1} w[n])^2}\n$$\nSince $T_s = 1/f_s$, the terms cancel, yielding the final discrete-sum expression for ENBW in bins:\n$$\n\\mathrm{ENBW_{bins}} = N \\frac{\\sum_{n=0}^{N-1} w[n]^2}{(\\sum_{n=0}^{N-1} w[n])^2}\n$$\nThis is the discrete-sum expression required.\n\n### Validation with the Rectangular Window and Definition of Resolution Loss\n\nFor the rectangular window, $w[n] = 1$ for $n = 0, \\dots, N-1$. We apply the derived formula:\nThe sum is $\\sum_{n=0}^{N-1} w[n] = \\sum_{n=0}^{N-1} 1 = N$.\nThe sum of squares is $\\sum_{n=0}^{N-1} w[n]^2 = \\sum_{n=0}^{N-1} 1^2 = N$.\nSubstituting these into the ENBW formula:\n$$\n\\mathrm{ENBW_{bins, rect}} = N \\frac{N}{N^2} = 1\n$$\nThe ENBW of the rectangular window is exactly $1$ bin. The problem defines resolution loss as the ratio of the ENBW of the chosen window to that of the rectangular window. Therefore:\n$$\n\\mathrm{Resolution\\;Loss} = \\frac{\\mathrm{ENBW_{bins}}(w)}{\\mathrm{ENBW_{bins, rect}}} = \\frac{\\mathrm{ENBW_{bins}}(w)}{1} = \\mathrm{ENBW_{bins}}(w)\n$$\nThus, for any window, the resolution loss is numerically identical to its ENBW expressed in bins.\n\n### Kaiser Window Design and Computational Procedure\n\nThe Kaiser window is defined as\n$$\nw[n] = \\frac{I_0\\left(\\beta \\sqrt{1 - \\left(\\frac{n - \\alpha}{\\alpha}\\right)^2}\\right)}{I_0(\\beta)}, \\quad \\text{for } n = 0, \\dots, N-1\n$$\nwhere $\\alpha = (N-1)/2$, $I_0(\\cdot)$ is the modified Bessel function of the first kind of order zero, and $\\beta$ is the shape parameter. A key property is that if $\\beta=0$, the argument of $I_0$ in the numerator is $0$, and since $I_0(0)=1$, the window simplifies to $w[n]=1$, the rectangular window.\n\nThe parameter $\\beta$ is chosen based on the desired sidelobe attenuation, $A = -S_{\\mathrm{dB}}$, where $S_{\\mathrm{dB}}$ is the attenuation in decibels (a negative value). A standard set of empirical formulas is:\n$$ \\beta = \\begin{cases} 0, & A \\le 21 \\\\ 0.5842(A - 21)^{0.4} + 0.07886(A - 21), & 21  A \\le 50 \\\\ 0.1102(A - 8.7),  A > 50 \\end{cases} $$\n\nThe computational procedure for each test case $(S_{\\mathrm{dB}}, N)$ is as follows:\n1.  Calculate the positive attenuation $A = -S_{\\mathrm{dB}}$.\n2.  Determine the Kaiser parameter $\\beta$ using the piecewise formula above.\n3.  Generate the $N$-point Kaiser window sequence $w[n]$ using the calculated $\\beta$ and the given $N$. The function $I_0(x)$ is evaluated using standard numerical libraries.\n4.  Compute the sum of window samples, $\\sum_{n=0}^{N-1} w[n]$, and the sum of squared window samples, $\\sum_{n=0}^{N-1} w[n]^2$.\n5.  Calculate the ENBW in bins using the derived formula: $\\mathrm{ENBW_{bins}} = N \\frac{\\sum w[n]^2}{(\\sum w[n])^2}$.\n6.  The resolution loss is equal to the computed $\\mathrm{ENBW_{bins}}$.\n7.  The final results $[\\beta, \\mathrm{ENBW_{bins}}, \\mathrm{Resolution\\;Loss}]$ are rounded to six decimal places.\n\nThis procedure is implemented to solve for the specified test suite.", "answer": "```python\nimport numpy as np\nfrom scipy.special import i0\n\ndef solve():\n    \"\"\"\n    Computes Kaiser window parameters, ENBW, and resolution loss for a given\n    test suite of sidelobe attenuations and window lengths.\n    \"\"\"\n    # Test suite format: (S_dB, N)\n    # S_dB: Target sidelobe attenuation in decibels\n    # N: Window length\n    test_cases = [\n        (-60.0, 1024),\n        (-50.0, 1024),\n        (-10.0, 1024),\n        (-80.0, 256),\n        (-100.0, 4096),\n    ]\n\n    results = []\n    \n    for s_db, n in test_cases:\n        # 1. Calculate positive attenuation A\n        A = -s_db\n\n        # 2. Determine Kaiser parameter beta from attenuation A\n        if A = 21:\n            beta = 0.0\n        elif A = 50:\n            beta = 0.5842 * (A - 21)**0.4 + 0.07886 * (A - 21)\n        else: # A  50\n            beta = 0.1102 * (A - 8.7)\n        \n        # 3. Handle the special case of beta=0 (rectangular window)\n        if beta == 0.0:\n            enbw_bins = 1.0\n            resolution_loss = 1.0\n        else:\n            # 4. Generate the N-point Kaiser window sequence\n            # Create the index array for the window\n            indices = np.arange(n)\n            alpha = (n - 1) / 2.0\n            \n            # Argument for the Bessel function in the numerator\n            # The argument inside the sqrt is 1 - ((n-alpha)/alpha)^2\n            # which is mathematically guaranteed to be non-negative.\n            # Using floating point arithmetic, it should remain so.\n            arg = beta * np.sqrt(1 - ((indices - alpha) / alpha)**2)\n            \n            window = i0(arg) / i0(beta)\n            \n            # 5. Compute sums needed for ENBW calculation\n            sum_w = np.sum(window)\n            sum_w_sq = np.sum(window**2)\n            \n            # 6. Calculate ENBW in bins using the derived discrete-sum formula\n            enbw_bins = n * sum_w_sq / (sum_w**2)\n            \n            # 7. Resolution loss equals ENBW in bins\n            resolution_loss = enbw_bins\n\n        # 8. Round results to six decimal places and store them\n        beta_rounded = round(beta, 6)\n        enbw_rounded = round(enbw_bins, 6)\n        loss_rounded = round(resolution_loss, 6)\n        \n        results.append([beta_rounded, enbw_rounded, loss_rounded])\n\n    # Format the final output string as specified\n    case_strings = []\n    for r in results:\n        # Creates a string like \"[val1,val2,val3]\" for each case\n        case_strings.append(f\"[{r[0]},{r[1]},{r[2]}]\")\n    \n    final_output = f\"[{','.join(case_strings)}]\"\n    print(final_output)\n\nsolve()\n```", "id": "3618894"}, {"introduction": "While a DFT's frequency resolution is fundamentally limited by the observation time, we can estimate the frequency of a strong, isolated tone with much higher precision. This exercise introduces the classic technique of quadratic interpolation, which refines a frequency estimate by fitting a parabola to the local peak of the periodogram. Through deriving the estimator and analyzing its properties, you will understand its power and also its limitations, particularly the bias introduced when using it with non-rectangular windows. [@problem_id:3618941]", "problem": "A narrowband microseismic trace is sampled at a rate $f_{s}$ for $N$ samples and analyzed via the Discrete Fourier Transform (DFT) to estimate the dominant sinusoidal component’s frequency. The observed time series $x[n]$ is modeled as a single sinusoid of unknown frequency $f_{0}$, amplitude $A$, and phase $\\phi$, contaminated by additive noise whose contribution to three adjacent DFT bins is negligible compared to the sinusoid’s peak. To obtain a Power Spectral Density (PSD) estimate, the time series is windowed by a rectangular window $w[n]$ defined by $w[n]=1$ for $n=0,1,\\dots,N-1$ and $w[n]=0$ otherwise, and the DFT is computed as\n$$\nX[k]=\\sum_{n=0}^{N-1}x[n]\\exp(-\\mathrm{i}\\,2\\pi kn/N).\n$$\nLet $k$ denote the DFT bin index at which the periodogram has its largest value within the local neighborhood of the spectral peak associated with $f_{0}$, and define the three locally dominant periodogram samples $P_{k-1}$, $P_{k}$, and $P_{k+1}$ by $P_{m}=|X[m]|^{2}$ for $m\\in\\{k-1,k,k+1\\}$. Assume that the underlying noiseless peak shape in the neighborhood of $k$ is sufficiently smooth that, over the three-bin neighborhood $\\{k-1,k,k+1\\}$, the variation of $|X[m]|^{2}$ can be approximated by a concave quadratic as a function of the bin offset $d\\in\\{-1,0,1\\}$.\n\nStarting only from the definitions above and the assumption of local quadratic behavior of the periodogram near its maximum induced by the rectangular window, derive the closed-form quadratic-interpolation estimator for the sub-bin offset $\\delta$ (where the true frequency’s bin index is $k+\\delta$ with $-0.5\\leq\\delta\\leq 0.5$) using the three samples $P_{k-1}$, $P_{k}$, and $P_{k+1}$. Then express the corresponding frequency estimate $\\hat{f}$ in Hertz as a single analytic expression in terms of $f_{s}$, $N$, $k$, $P_{k-1}$, $P_{k}$, and $P_{k+1}$.\n\nFinally, discuss—without performing additional numerical calculations—why applying non-rectangular windows (for example, the Hann or Hamming window) can introduce bias into this quadratic interpolation estimator of frequency when used on the DFT magnitude or magnitude-squared. Your discussion should connect the window’s spectral main-lobe shape to the curvature properties that underlie the quadratic fit.\n\nExpress your final frequency estimate in Hz as a single closed-form analytic expression. No rounding is required.", "solution": "The task is to derive a frequency estimator based on quadratic interpolation of the periodogram peak. This involves three parts: first, deriving the formula for the sub-bin frequency offset; second, constructing the final frequency estimate in Hertz; and third, discussing the effect of non-rectangular windows on this estimator.\n\n**Part 1: Derivation of the Sub-Bin Offset $\\delta$**\n\nWe are given that in the neighborhood of the spectral peak, the periodogram $P_m = |X[m]|^2$ can be approximated by a concave quadratic function. Let $k$ be the integer bin index of the largest sample of the periodogram peak. We consider the three adjacent samples $P_{k-1}$, $P_k$, and $P_{k+1}$. Let $d$ be the offset from the central bin index $k$, so that the bin index is $m = k+d$. We model the periodogram locally as a parabola in $d$:\n$$p(d) = ad^2 + bd + c$$\nThe three known points on this parabola correspond to $d \\in \\{-1, 0, 1\\}$:\n1. For $d=-1$, we have $p(-1) = P_{k-1}$. Substituting into the quadratic form gives:\n   $$a(-1)^2 + b(-1) + c = a - b + c = P_{k-1}$$\n2. For $d=0$, we have $p(0) = P_{k}$. This gives:\n   $$a(0)^2 + b(0) + c = c = P_k$$\n3. For $d=1$, we have $p(1) = P_{k+1}$. This gives:\n   $$a(1)^2 + b(1) + c = a + b + c = P_{k+1}$$\n\nWe have a system of three linear equations for the coefficients $a$, $b$, and $c$. From the second equation, we immediately find $c = P_k$. Substituting this into the first and third equations yields:\n$$a - b + P_k = P_{k-1} \\implies a - b = P_{k-1} - P_k$$\n$$a + b + P_k = P_{k+1} \\implies a + b = P_{k+1} - P_k$$\n\nWe can solve this $2 \\times 2$ system for $a$ and $b$. Adding the two equations gives:\n$$(a - b) + (a + b) = (P_{k-1} - P_k) + (P_{k+1} - P_k)$$\n$$2a = P_{k-1} + P_{k+1} - 2P_k$$\n$$a = \\frac{1}{2}(P_{k-1} + P_{k+1} - 2P_k)$$\n\nSubtracting the first equation from the second gives:\n$$(a + b) - (a - b) = (P_{k+1} - P_k) - (P_{k-1} - P_k)$$\n$$2b = P_{k+1} - P_{k-1}$$\n$$b = \\frac{1}{2}(P_{k+1} - P_{k-1})$$\n\nThe sub-bin offset, which we denote as $\\delta$, corresponds to the value of $d$ at which the parabola $p(d)$ reaches its maximum. To find this maximum, we take the derivative of $p(d)$ with respect to $d$ and set it to zero:\n$$\\frac{dp}{dd} = 2ad + b = 0$$\nSolving for $d$ gives the location of the peak:\n$$\\delta = d_{\\text{max}} = -\\frac{b}{2a}$$\n\nSubstituting our expressions for $a$ and $b$:\n$$\\delta = -\\frac{\\frac{1}{2}(P_{k+1} - P_{k-1})}{2 \\left( \\frac{1}{2}(P_{k-1} + P_{k+1} - 2P_k) \\right)} = -\\frac{P_{k+1} - P_{k-1}}{2(P_{k-1} + P_{k+1} - 2P_k)}$$\nThis can be written more conventionally by negating both the numerator and the denominator:\n$$\\delta = \\frac{P_{k-1} - P_{k+1}}{2(P_{k-1} - 2P_k + P_{k+1})}$$\nThis is the closed-form expression for the sub-bin offset $\\delta$. The range of $\\delta$ is $[-0.5, 0.5]$ by definition, as $k$ is the bin with the largest magnitude in the local triplet.\n\n**Part 2: Expression for the Frequency Estimate $\\hat{f}$**\n\nThe frequency corresponding to a DFT bin index $m$ is given by $f = \\frac{m \\cdot f_s}{N}$, where $f_s$ is the sampling frequency and $N$ is the number of samples. Our refined estimate of the true bin index is $k + \\delta$. Therefore, the estimated frequency $\\hat{f}$ is:\n$$\\hat{f} = (k + \\delta) \\frac{f_s}{N}$$\nSubstituting the expression for $\\delta$ we derived:\n$$\\hat{f} = \\left( k + \\frac{P_{k-1} - P_{k+1}}{2(P_{k-1} - 2P_k + P_{k+1})} \\right) \\frac{f_s}{N}$$\nThis is the final analytic expression for the frequency estimate.\n\n**Part 3: Discussion on Bias from Non-Rectangular Windows**\n\nThe derivation above relies critically on the assumption that the periodogram near its peak can be accurately modeled by a quadratic function. The shape of the periodogram peak for a single sinusoid is determined by the squared magnitude of the Fourier transform of the window function, centered at the sinusoid's frequency.\n\nFor the rectangular window, the Fourier transform is a sinc function, and its squared magnitude, $|S(f)|^2 \\propto \\text{sinc}^2\\left(\\pi (f-f_0) T\\right)$, where $T$ is the window duration. The peak of the $\\text{sinc}^2$ function is very nearly parabolic near its maximum. The quadratic interpolation estimator is therefore highly accurate for signals windowed with a rectangular window, as the model assumption holds well. The estimator can be seen as being \"tuned\" to the specific curvature of the $\\text{sinc}^2$ function's main lobe.\n\nNon-rectangular windows, such as the Hann or Hamming windows, are tapered at their edges to reduce spectral leakage (i.e., to lower the sidelobes in their frequency response). This tapering, however, has the side effect of broadening the main lobe of the window's spectrum. The shape of these wider main lobes (e.g., for a Hann window) is mathematically different from a $\\text{sinc}^2$ function. In particular, the peaks are \"flatter\" than a $\\text{sinc}^2$ peak.\n\nThis difference in shape means that a quadratic function is a poorer approximation for the peak of a periodogram generated using a Hann or Hamming window compared to a rectangular one. The \"flatness\" of the peak implies that the curvature (the second derivative) at the maximum is smaller in magnitude. The term $P_{k-1} - 2P_k + P_{k+1}$ in our estimator for $\\delta$ is a finite difference approximation of the second derivative of the periodogram. When using a Hann window, for a given true sub-bin offset, this term will have a different value than it would have for a rectangular window because the main lobe is broader and less curved.\n\nApplying the formula for $\\delta$, which was implicitly derived for the curvature of a $\\text{sinc}^2$ function, to the periodogram samples from a non-rectangular window will result in a systematic error in the estimate of $\\delta$. This error is dependent on the true sub-bin location of the frequency and is therefore a bias. If the true frequency lands exactly on a bin center ($\\delta=0$), the estimator will be unbiased due to symmetry ($P_{k-1} = P_{k+1}$). However, for any other location (e.g., $\\delta=0.5$), the mismatch between the assumed quadratic shape and the actual main-lobe shape will lead to a biased estimate $\\hat{\\delta} \\neq \\delta$. In summary, the quadratic interpolation formula is specific to the spectral shape of the rectangular window, and its application to data from other windows introduces bias because their main-lobe shapes and curvatures do not satisfy the underlying assumption of the model.", "answer": "$$\n\\boxed{\\hat{f} = \\left( k + \\frac{P_{k-1} - P_{k+1}}{2(P_{k-1} - 2P_k + P_{k+1})} \\right) \\frac{f_s}{N}}\n$$", "id": "3618941"}, {"introduction": "A correctly computed Power Spectral Density (PSD) must be consistent with the signal's time-domain properties, specifically its variance, a principle rooted in Parseval's theorem. This practice demonstrates how proper normalization preserves this relationship and highlights a common pitfall where incorrect scaling leads to significant errors in total power. By deriving and calculating the deviation factor for several common windows, you will gain a practical understanding of how window choice affects amplitude scaling in spectral estimates. [@problem_id:3618920]", "problem": "Consider a discrete-time, zero-mean, wide-sense stationary geophysical signal $x[n]$ with variance $\\sigma_{x}^{2}$, sampled at frequency $f_{s}$, and observed over $N=1001$ samples indexed by $n=0,1,\\dots,N-1$. A generic taper (window) $w[n]$ is applied to the record to form $x_{w}[n]=w[n]x[n]$. Define the discrete-time Fourier transform of the windowed record as\n$$\nX_{w}(\\omega)=\\sum_{n=0}^{N-1} w[n]\\,x[n]\\,\\exp(-\\mathrm{i}\\,\\omega n),\n$$\nwith angular frequency $\\omega\\in[-\\pi,\\pi]$. By Parseval’s theorem,\n$$\n\\frac{1}{2\\pi}\\int_{-\\pi}^{\\pi}\\left|X_{w}(\\omega)\\right|^{2}\\,\\mathrm{d}\\omega=\\sum_{n=0}^{N-1}\\left|w[n]x[n]\\right|^{2}.\n$$\nTwo distinct power spectral density (PSD) estimators are considered.\n\n1. An energy-normalized estimator,\n$$\n\\widehat{S}_{U}(\\omega)=\\frac{1}{2\\pi\\,N\\,U}\\,\\left|X_{w}(\\omega)\\right|^{2},\\quad U=\\frac{1}{N}\\sum_{n=0}^{N-1}w[n]^{2},\n$$\nwhose integral over $\\omega\\in[-\\pi,\\pi]$ is used to recover the time-domain variance.\n\n2. A practitioner’s estimator that attempts to correct the window’s amplitude response via the coherent gain $G_{c}$ but (incorrectly) sets the equivalent noise bandwidth to unity,\n$$\n\\widehat{S}_{B}(\\omega)=\\frac{1}{2\\pi\\,N\\,G_{c}^{2}}\\,\\left|X_{w}(\\omega)\\right|^{2},\\quad G_{c}=\\frac{1}{N}\\sum_{n=0}^{N-1}w[n],\n$$\ni.e., this choice implicitly takes $B_{e}=1$ in discrete-frequency bins.\n\nTasks:\n- Starting from the above definitions and Parseval’s theorem, demonstrate that $\\int_{-\\pi}^{\\pi}\\widehat{S}_{U}(\\omega)\\,\\mathrm{d}\\omega$ equals the time-domain variance in expectation for any window $w[n]$ when $x[n]$ is zero-mean and wide-sense stationary.\n- For the “$G_{c}$-only” practitioner’s estimator $\\widehat{S}_{B}(\\omega)$, derive the multiplicative deviation factor\n$$\nD_{w}=\\frac{\\mathbb{E}\\left[\\int_{-\\pi}^{\\pi}\\widehat{S}_{B}(\\omega)\\,\\mathrm{d}\\omega\\right]}{\\sigma_{x}^{2}},\n$$\nin terms of $w[n]$ and $N$. Then, using $N=1001$ and the following windows defined on $n=0,1,\\dots,N-1$ with $\\theta_{n}=\\frac{2\\pi n}{N-1}$,\n- Rectangular: $w[n]=1$,\n- Hann: $w[n]=\\frac{1}{2}\\left(1-\\cos\\theta_{n}\\right)$,\n- Hamming: $w[n]=0.54-0.46\\cos\\theta_{n}$,\n- Blackman: $w[n]=0.42-0.50\\cos\\theta_{n}+0.08\\cos(2\\theta_{n})$,\ncompute $D_{w}$ for each window.\n\nReport the four dimensionless values $\\left(D_{\\text{rect}},D_{\\text{hann}},D_{\\text{hamming}},D_{\\text{blackman}}\\right)$, rounded to four significant figures. No units are required. Angles, where relevant, are in radians.", "solution": "First, we demonstrate that the total power obtained by integrating the energy-normalized estimator $\\widehat{S}_{U}(\\omega)$ is, in expectation, equal to the signal variance $\\sigma_{x}^{2}$. We begin with the integral of $\\widehat{S}_{U}(\\omega)$ over its frequency domain $\\omega \\in [-\\pi, \\pi]$:\n$$\n\\int_{-\\pi}^{\\pi}\\widehat{S}_{U}(\\omega)\\,\\mathrm{d}\\omega = \\int_{-\\pi}^{\\pi}\\frac{1}{2\\pi\\,N\\,U}\\,\\left|X_{w}(\\omega)\\right|^{2}\\,\\mathrm{d}\\omega\n$$\nThe terms $\\frac{1}{N\\,U}$ are constant with respect to $\\omega$ and can be factored out of the integral:\n$$\n\\int_{-\\pi}^{\\pi}\\widehat{S}_{U}(\\omega)\\,\\mathrm{d}\\omega = \\frac{1}{N\\,U} \\left( \\frac{1}{2\\pi}\\int_{-\\pi}^{\\pi}\\left|X_{w}(\\omega)\\right|^{2}\\,\\mathrm{d}\\omega \\right)\n$$\nUsing the provided Parseval’s theorem, $\\frac{1}{2\\pi}\\int_{-\\pi}^{\\pi}\\left|X_{w}(\\omega)\\right|^{2}\\,\\mathrm{d}\\omega=\\sum_{n=0}^{N-1}\\left|w[n]x[n]\\right|^{2}$, we substitute the sum for the integral:\n$$\n\\int_{-\\pi}^{\\pi}\\widehat{S}_{U}(\\omega)\\,\\mathrm{d}\\omega = \\frac{1}{N\\,U} \\sum_{n=0}^{N-1}\\left(w[n]x[n]\\right)^{2}\n$$\nNext, we take the expectation $\\mathbb{E}[\\cdot]$ of this quantity. Since the window $w[n]$ and the normalization factor $U$ are deterministic, the expectation operator applies only to the signal term $x[n]$:\n$$\n\\mathbb{E}\\left[\\int_{-\\pi}^{\\pi}\\widehat{S}_{U}(\\omega)\\,\\mathrm{d}\\omega\\right] = \\frac{1}{N\\,U} \\sum_{n=0}^{N-1}w[n]^{2}\\mathbb{E}\\left[x[n]^{2}\\right]\n$$\nThe signal $x[n]$ is defined as zero-mean and wide-sense stationary (WSS). For a zero-mean process, the variance $\\sigma_{x}^{2}$ is equal to the mean square value: $\\sigma_{x}^{2} = \\mathbb{E}[x[n]^2] - (\\mathbb{E}[x[n]])^2 = \\mathbb{E}[x[n]^2] - 0^2 = \\mathbb{E}[x[n]^2]$. The WSS property ensures that this variance is constant for all $n$. Substituting $\\mathbb{E}[x[n]^2] = \\sigma_{x}^{2}$:\n$$\n\\mathbb{E}\\left[\\int_{-\\pi}^{\\pi}\\widehat{S}_{U}(\\omega)\\,\\mathrm{d}\\omega\\right] = \\frac{1}{N\\,U} \\sum_{n=0}^{N-1}w[n]^{2}\\sigma_{x}^{2} = \\frac{\\sigma_{x}^{2}}{N\\,U} \\sum_{n=0}^{N-1}w[n]^{2}\n$$\nNow, we substitute the definition of the energy normalization factor, $U=\\frac{1}{N}\\sum_{n=0}^{N-1}w[n]^{2}$:\n$$\n\\mathbb{E}\\left[\\int_{-\\pi}^{\\pi}\\widehat{S}_{U}(\\omega)\\,\\mathrm{d}\\omega\\right] = \\frac{\\sigma_{x}^{2}}{N\\left(\\frac{1}{N}\\sum_{n=0}^{N-1}w[n]^{2}\\right)} \\sum_{n=0}^{N-1}w[n]^{2} = \\frac{\\sigma_{x}^{2}}{\\sum_{n=0}^{N-1}w[n]^{2}} \\sum_{n=0}^{N-1}w[n]^{2} = \\sigma_{x}^{2}\n$$\nThis completes the demonstration.\n\nNext, we derive the multiplicative deviation factor $D_{w}$ for the practitioner's estimator $\\widehat{S}_{B}(\\omega)$. The procedure is analogous. We start with the expected value of the integrated spectrum:\n$$\n\\mathbb{E}\\left[\\int_{-\\pi}^{\\pi}\\widehat{S}_{B}(\\omega)\\,\\mathrm{d}\\omega\\right] = \\mathbb{E}\\left[\\int_{-\\pi}^{\\pi}\\frac{1}{2\\pi\\,N\\,G_{c}^{2}}\\,\\left|X_{w}(\\omega)\\right|^{2}\\,\\mathrm{d}\\omega\\right]\n$$\nFollowing the same steps of applying Parseval's theorem and taking the expectation:\n$$\n\\mathbb{E}\\left[\\int_{-\\pi}^{\\pi}\\widehat{S}_{B}(\\omega)\\,\\mathrm{d}\\omega\\right] = \\frac{1}{N\\,G_{c}^{2}} \\mathbb{E}\\left[\\sum_{n=0}^{N-1}\\left(w[n]x[n]\\right)^{2}\\right] = \\frac{1}{N\\,G_{c}^{2}} \\sum_{n=0}^{N-1}w[n]^{2}\\mathbb{E}\\left[x[n]^{2}\\right] = \\frac{\\sigma_{x}^{2}}{N\\,G_{c}^{2}} \\sum_{n=0}^{N-1}w[n]^{2}\n$$\nThe deviation factor $D_{w}$ is defined as the ratio of this expected total power to the true variance $\\sigma_{x}^{2}$:\n$$\nD_{w} = \\frac{\\mathbb{E}\\left[\\int_{-\\pi}^{\\pi}\\widehat{S}_{B}(\\omega)\\,\\mathrm{d}\\omega\\right]}{\\sigma_{x}^{2}} = \\frac{\\frac{\\sigma_{x}^{2}}{N\\,G_{c}^{2}} \\sum_{n=0}^{N-1}w[n]^{2}}{\\sigma_{x}^{2}} = \\frac{1}{N\\,G_{c}^{2}} \\sum_{n=0}^{N-1}w[n]^{2}\n$$\nSubstituting the definition of the coherent gain, $G_{c}=\\frac{1}{N}\\sum_{n=0}^{N-1}w[n]$:\n$$\nD_{w} = \\frac{\\sum_{n=0}^{N-1}w[n]^{2}}{N \\left( \\frac{1}{N}\\sum_{n=0}^{N-1}w[n] \\right)^{2}} = \\frac{N \\sum_{n=0}^{N-1}w[n]^{2}}{\\left(\\sum_{n=0}^{N-1}w[n]\\right)^{2}}\n$$\nThis is the general expression for $D_w$. We now compute this for each window with $N=1001$. Let $M=N-1=1000$ and $\\theta_n = \\frac{2\\pi n}{M}$. We utilize the summation identity $\\sum_{n=0}^{M} \\cos(k\\theta_n) = 1$ for integer $k$ where $M$ is not a divisor of $k$.\n\n1.  **Rectangular window**: $w[n]=1$ for $n=0, \\dots, N-1$.\n    $\\sum_{n=0}^{N-1} w[n] = \\sum_{n=0}^{N-1} 1 = N$.\n    $\\sum_{n=0}^{N-1} w[n]^2 = \\sum_{n=0}^{N-1} 1^2 = N$.\n    $D_{\\text{rect}} = \\frac{N \\cdot N}{N^2} = 1$.\n\n2.  **Hann window**: $w[n]=\\frac{1}{2}\\left(1-\\cos\\theta_{n}\\right)$.\n    $\\sum_{n=0}^{N-1} w[n] = \\frac{1}{2}\\sum_{n=0}^{M} (1-\\cos\\theta_n) = \\frac{1}{2}\\left(\\sum_0^M 1 - \\sum_0^M \\cos\\theta_n\\right) = \\frac{1}{2}(N-1) = \\frac{M}{2}$.\n    $\\sum_{n=0}^{N-1} w[n]^2 = \\frac{1}{4}\\sum_{n=0}^{M} (1-\\cos\\theta_n)^2 = \\frac{1}{4}\\sum (1 - 2\\cos\\theta_n + \\cos^2\\theta_n)$.\n    Using $\\cos^2\\theta_n = \\frac{1}{2}(1+\\cos(2\\theta_n))$, the sum becomes $\\frac{1}{4}\\sum( \\frac{3}{2} - 2\\cos\\theta_n + \\frac{1}{2}\\cos(2\\theta_n) ) = \\frac{1}{4}(\\frac{3}{2}N - 2(1) + \\frac{1}{2}(1)) = \\frac{1}{4}(\\frac{3N-3}{2}) = \\frac{3(N-1)}{8}$.\n    $D_{\\text{hann}} = \\frac{N \\cdot \\frac{3(N-1)}{8}}{(\\frac{N-1}{2})^2} = \\frac{3N(N-1)/8}{(N-1)^2/4} = \\frac{3N}{2(N-1)}$.\n    For $N=1001$, $D_{\\text{hann}} = \\frac{3 \\cdot 1001}{2 \\cdot 1000} = \\frac{3003}{2000} = 1.5015$.\n\n3.  **Hamming window**: $w[n]=0.54-0.46\\cos\\theta_{n}$. Let $a=0.54, b=0.46$.\n    $\\sum w[n] = \\sum(a-b\\cos\\theta_n) = aN - b(1) = 0.54(1001) - 0.46 = 540.08$.\n    $\\sum w[n]^2 = \\sum(a^2 - 2ab\\cos\\theta_n + b^2\\cos^2\\theta_n) = a^2N - 2ab(1) + b^2\\sum \\frac{1+\\cos(2\\theta_n)}{2} = a^2N - 2ab + b^2(\\frac{N+1}{2})$.\n    $= (0.54)^2(1001) - 2(0.54)(0.46) + (0.46)^2(\\frac{1002}{2}) = 0.2916(1001) - 0.4968 + 0.2116(501) = 291.8916 - 0.4968 + 106.0116 = 397.4064$.\n    $D_{\\text{hamming}} = \\frac{1001 \\cdot 397.4064}{(540.08)^2} = \\frac{397803.8064}{291686.4064} \\approx 1.363806$.\n\n4.  **Blackman window**: $w[n]=0.42-0.50\\cos\\theta_{n}+0.08\\cos(2\\theta_{n})$. Let $a_0=0.42, a_1=0.50, a_2=0.08$.\n    $\\sum w[n] = \\sum (a_0 - a_1\\cos\\theta_n + a_2\\cos(2\\theta_n)) = a_0N - a_1(1) + a_2(1) = 0.42(1001) - 0.50 + 0.08 = 420.0$.\n    $\\sum w[n]^2 = \\sum (a_0 - a_1\\cos\\theta_n + a_2\\cos(2\\theta_n))^2$. Expanding gives terms with sums of $1$, $\\cos(k\\theta_n)$, $\\cos^2(k\\theta_n)$ and cross products $\\cos(j\\theta_n)\\cos(k\\theta_n)$. Using the summation identities:\n    $\\sum w[n]^2 = a_0^2N + (a_1^2+a_2^2)\\frac{N+1}{2} - 2(a_0a_1 - a_0a_2 + a_1a_2)$.\n    $= (0.42)^2(1001) + (0.50^2+0.08^2)\\frac{1002}{2} - 2(0.42 \\cdot 0.50 - 0.42 \\cdot 0.08 + 0.50 \\cdot 0.08)$.\n    $= 0.1764(1001) + (0.25+0.0064)(501) - 2(0.21 - 0.0336 + 0.04)$.\n    $= 176.5764 + (0.2564)(501) - 2(0.2164) = 176.5764 + 128.4564 - 0.4328 = 304.6$.\n    $D_{\\text{blackman}} = \\frac{1001 \\cdot 304.6}{(420.0)^2} = \\frac{304904.6}{176400} \\approx 1.728484$.\n\nRounding the values to four significant figures:\n- $D_{\\text{rect}} = 1.000$\n- $D_{\\text{hann}} = 1.5015 \\to 1.502$\n- $D_{\\text{hamming}} = 1.363806... \\to 1.364$\n- $D_{\\text{blackman}} = 1.728484... \\to 1.728$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.000  1.502  1.364  1.728\n\\end{pmatrix}\n}\n$$", "id": "3618920"}]}