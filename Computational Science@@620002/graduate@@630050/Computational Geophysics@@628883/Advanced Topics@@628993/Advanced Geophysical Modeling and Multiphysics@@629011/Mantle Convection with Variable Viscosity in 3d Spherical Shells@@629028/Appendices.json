{"hands_on_practices": [{"introduction": "To understand and compare the dynamics of mantle convection across different planetary bodies or under different conditions, we must first distill the complex governing equations into a set of fundamental, dimensionless parameters. This practice focuses on deriving the two most important of these: the Rayleigh numbers for basal heating ($Ra$) and internal heating ($Ra_H$). By performing this non-dimensionalization and then calculating the values for an Earth-like mantle, you will gain a core understanding of what drives convection and how the source of heat fundamentally alters the character of the flow [@problem_id:3609282].", "problem": "Consider Boussinesq thermal convection of an incompressible mantle in a three-dimensional spherical shell with inner radius $r_{i}$ and outer radius $r_{o}$. The viscosity is strongly temperature dependent, but for nondimensionalization one uses a reference dynamic viscosity $\\eta_{0}$ defined at a specified reference state. Let the material properties be radially uniform and constant except for viscosity: density $\\rho$, thermal expansivity $\\alpha$, thermal conductivity $k$, thermal diffusivity $\\kappa$, and gravitational acceleration $g$. Assume constant gravity $g$ and constant material properties for the purposes of defining control parameters. The shell thickness is $D=r_{o}-r_{i}$. Two sources of thermal buoyancy are present: a basal temperature contrast $\\Delta T_{b}$ between the bottom and top boundaries, and uniform internal radiogenic heating characterized by a mass-specific heating rate $H$ (in $\\mathrm{W\\,kg^{-1}}$), so that the volumetric heating rate is $\\dot{q}=\\rho H$ (in $\\mathrm{W\\,m^{-3}}$). \n\nStarting from the dimensional Boussinesq Stokes and energy equations, and using the thermal diffusion time scale $D^{2}/\\kappa$, the length scale $D$, the velocity scale $\\kappa/D$, and temperature scales appropriate to each forcing, derive from first principles the dimensionless control parameters that multiply the buoyancy term in the nondimensional momentum equation:\n- the classical Rayleigh number $Ra$ associated with a prescribed basal temperature contrast $\\Delta T_{b}$, and \n- the internally heated Rayleigh number $Ra_{H}$ associated with uniform volumetric heating $\\dot{q}$.\n\nThen, using the Earth-like parameter values\n- $r_{o}=6.371\\times 10^{6}\\ \\mathrm{m}$, $r_{i}=3.480\\times 10^{6}\\ \\mathrm{m}$,\n- $\\rho=3300\\ \\mathrm{kg\\,m^{-3}}$, $\\alpha=3.0\\times 10^{-5}\\ \\mathrm{K^{-1}}$, $g=9.81\\ \\mathrm{m\\,s^{-2}}$,\n- $\\kappa=1.0\\times 10^{-6}\\ \\mathrm{m^{2}\\,s^{-1}}$, $k=4.0\\ \\mathrm{W\\,m^{-1}\\,K^{-1}}$,\n- $\\eta_{0}=1.0\\times 10^{21}\\ \\mathrm{Pa\\,s}$,\n- $\\Delta T_{b}=2500\\ \\mathrm{K}$, and $H=5.0\\times 10^{-12}\\ \\mathrm{W\\,kg^{-1}}$,\n\nevaluate the two Rayleigh numbers. Express both answers as dimensionless quantities and round to four significant figures. Your final answer should report $(Ra,\\ Ra_{H})$ in that order as a single row using the format specified for multiple numerical answers.", "solution": "The problem is first validated and found to be scientifically sound, well-posed, and complete. We can therefore proceed with the derivation and calculation.\n\nThe derivation of the dimensionless Rayleigh numbers begins with the governing equations for Boussinesq thermal convection of an incompressible fluid. The relevant dimensional equations are the Stokes equation (conservation of momentum for slow, viscous flow), the continuity equation (conservation of mass), and the thermal energy equation (conservation of energy).\n\nThe Stokes equation, including the buoyancy force term under the Boussinesq approximation, is:\n$$ \\nabla \\cdot \\boldsymbol{\\tau} - \\nabla P' + \\mathbf{f}_b = \\mathbf{0} $$\nwhere $\\boldsymbol{\\tau}$ is the deviatoric stress tensor, which for a Newtonian fluid with reference viscosity $\\eta_0$ is $\\boldsymbol{\\tau} = \\eta_0(\\nabla\\mathbf{u} + (\\nabla\\mathbf{u})^T)$. $P'$ is the dynamic pressure, and $\\mathbf{f}_b$ is the buoyancy force. The buoyancy force is given by $\\mathbf{f}_b = \\Delta \\rho \\mathbf{g} = -\\rho \\alpha (T-T_{ref}) \\mathbf{g}$, where $\\rho$ is the reference density, $\\alpha$ is the thermal expansivity, $T$ is temperature, $T_{ref}$ is a reference temperature, and $\\mathbf{g}$ is the gravitational acceleration vector. Assuming gravity acts radially inward ($\\mathbf{g} = -g\\hat{\\mathbf{r}}$), the buoyancy force term becomes $\\rho \\alpha (T-T_{ref}) g \\hat{\\mathbf{r}}$.\n\nThe continuity equation for an incompressible fluid is:\n$$ \\nabla \\cdot \\mathbf{u} = 0 $$\nwhere $\\mathbf{u}$ is the velocity vector.\n\nThe thermal energy equation with internal heating is:\n$$ \\rho c_p \\left( \\frac{\\partial T}{\\partial t} + (\\mathbf{u} \\cdot \\nabla) T \\right) = k \\nabla^2 T + \\dot{q} $$\nwhere $c_p$ is the specific heat capacity, $k$ is the thermal conductivity, and $\\dot{q} = \\rho H$ is the volumetric heating rate.\n\nNext, we introduce dimensionless variables (denoted with a prime) based on the specified scales:\n- Position: $\\mathbf{r}' = \\mathbf{r} / D$\n- Time: $t' = t / (D^2/\\kappa)$\n- Velocity: $\\mathbf{u}' = \\mathbf{u} / (\\kappa/D)$\n- Temperature: $T = T_{ref} + \\Delta T_{scale} \\theta$, where $\\Delta T_{scale}$ is a characteristic temperature scale and $\\theta$ is the dimensionless temperature.\n- Pressure: The natural scale for dynamic pressure is the viscous stress scale, so we define $P' = (\\eta_0 \\kappa / D^2) p'$.\n\nThe differential operators transform as $\\nabla = (1/D)\\nabla'$ and $\\nabla^2 = (1/D^2)\\nabla'^2$.\n\nWe substitute these into the Stokes equation:\n$$ \\nabla' \\cdot \\left( \\frac{\\eta_0 \\kappa}{D^3} (\\nabla'\\mathbf{u}' + (\\nabla'\\mathbf{u}')^T) \\right) - \\nabla' \\left( \\frac{\\eta_0 \\kappa}{D^3} p' \\right) + \\rho \\alpha g \\Delta T_{scale} \\theta \\hat{\\mathbf{r}} = \\mathbf{0} $$\nMultiplying the entire equation by $D^3 / (\\eta_0 \\kappa)$ yields the dimensionless momentum equation:\n$$ \\nabla' \\cdot (\\nabla'\\mathbf{u}' + (\\nabla'\\mathbf{u}')^T) - \\nabla' p' + \\left( \\frac{\\rho \\alpha g D^3 \\Delta T_{scale}}{\\eta_0 \\kappa} \\right) \\theta \\hat{\\mathbf{r}} = \\mathbf{0} $$\nThe dimensionless group multiplying the buoyancy term is the generalized Rayleigh number for a chosen temperature scale $\\Delta T_{scale}$.\n\nNow we nondimensionalize the energy equation by substituting the dimensionless variables into the dimensional equation:\n$$ \\rho c_p \\frac{\\kappa \\Delta T_{scale}}{D^2} \\left( \\frac{\\partial \\theta}{\\partial t'} + (\\mathbf{u}' \\cdot \\nabla') \\theta \\right) = k \\frac{\\Delta T_{scale}}{D^2} \\nabla'^2 \\theta + \\rho H $$\nUsing the relation $k = \\rho c_p \\kappa$, the equation becomes:\n$$ k \\frac{\\Delta T_{scale}}{D^2} \\left( \\frac{\\partial \\theta}{\\partial t'} + (\\mathbf{u}' \\cdot \\nabla') \\theta \\right) = k \\frac{\\Delta T_{scale}}{D^2} \\nabla'^2 \\theta + \\rho H $$\nDividing by $k \\Delta T_{scale} / D^2$ gives the dimensionless energy equation:\n$$ \\frac{\\partial \\theta}{\\partial t'} + (\\mathbf{u}' \\cdot \\nabla') \\theta = \\nabla'^2\\theta + \\frac{\\rho H D^2}{k \\Delta T_{scale}} $$\n\nThe problem requires deriving the two Rayleigh numbers by considering each heating mode separately.\n\nCase 1: Basal heating ($Ra$)\nFor convection driven by a prescribed basal temperature contrast $\\Delta T_b$, we set the internal heating $H=0$. The natural choice for the temperature scale is the imposed contrast itself: $\\Delta T_{scale} = \\Delta T_b$. Substituting this into the dimensionless coefficient of the buoyancy term gives the classical Rayleigh number, $Ra$:\n$$ Ra = \\frac{\\rho \\alpha g \\Delta T_b D^3}{\\eta_0 \\kappa} $$\n\nCase 2: Internal heating ($Ra_H$)\nFor convection driven solely by uniform internal heating $H$, there is no externally imposed temperature contrast ($\\Delta T_b=0$). The temperature scale must be intrinsic to the system. In the dimensionless energy equation, the term $\\frac{\\rho H D^2}{k \\Delta T_{scale}}$ represents the dimensionless strength of the internal heating. For a proper scaling, the primary driving term should be of order unity. Therefore, we set it to $1$, which defines the intrinsic temperature scale for internal heating, $\\Delta T_H$:\n$$ \\Delta T_H = \\frac{\\rho H D^2}{k} $$\nSubstituting this scale $\\Delta T_{scale} = \\Delta T_H$ into the generalized Rayleigh number expression yields the internally heated Rayleigh number, $Ra_H$:\n$$ Ra_H = \\frac{\\rho \\alpha g D^3}{\\eta_0 \\kappa} \\left( \\frac{\\rho H D^2}{k} \\right) = \\frac{\\rho^2 \\alpha g H D^5}{\\eta_0 \\kappa k} $$\n\nNow, we evaluate these two Rayleigh numbers using the provided Earth-like parameters:\n- $r_{o} = 6.371 \\times 10^{6}\\ \\mathrm{m}$\n- $r_{i} = 3.480 \\times 10^{6}\\ \\mathrm{m}$\n- $\\rho = 3300\\ \\mathrm{kg\\,m^{-3}}$\n- $\\alpha = 3.0 \\times 10^{-5}\\ \\mathrm{K^{-1}}$\n- $g = 9.81\\ \\mathrm{m\\,s^{-2}}$\n- $\\kappa = 1.0 \\times 10^{-6}\\ \\mathrm{m^{2}\\,s^{-1}}$\n- $k = 4.0\\ \\mathrm{W\\,m^{-1}\\,K^{-1}}$\n- $\\eta_{0} = 1.0 \\times 10^{21}\\ \\mathrm{Pa\\,s}$\n- $\\Delta T_{b} = 2500\\ \\mathrm{K}$\n- $H = 5.0 \\times 10^{-12}\\ \\mathrm{W\\,kg^{-1}}$\n\nFirst, calculate the shell thickness $D$:\n$$ D = r_o - r_i = (6.371 - 3.480) \\times 10^{6}\\ \\mathrm{m} = 2.891 \\times 10^{6}\\ \\mathrm{m} $$\n\nCalculation of $Ra$:\n$$ Ra = \\frac{\\rho \\alpha g \\Delta T_b D^3}{\\eta_0 \\kappa} $$\n$$ Ra = \\frac{(3300) \\cdot (3.0 \\times 10^{-5}) \\cdot (9.81) \\cdot (2500) \\cdot (2.891 \\times 10^{6})^{3}}{(1.0 \\times 10^{21}) \\cdot (1.0 \\times 10^{-6})} $$\n$$ Ra = \\frac{(2427.975) \\cdot (2.41654 \\times 10^{19})}{1.0 \\times 10^{15}} = \\frac{5.86718 \\times 10^{22}}{1.0 \\times 10^{15}} = 5.86718 \\times 10^{7} $$\nRounding to four significant figures, $Ra = 5.867 \\times 10^{7}$.\n\nCalculation of $Ra_H$:\n$$ Ra_H = \\frac{\\rho^2 \\alpha g H D^5}{\\eta_0 \\kappa k} $$\n$$ Ra_H = \\frac{(3300)^2 \\cdot (3.0 \\times 10^{-5}) \\cdot (9.81) \\cdot (5.0 \\times 10^{-12}) \\cdot (2.891 \\times 10^{6})^{5}}{(1.0 \\times 10^{21}) \\cdot (1.0 \\times 10^{-6}) \\cdot (4.0)} $$\n$$ Ra_H = \\frac{(1.089 \\times 10^{7}) \\cdot (3.0 \\times 10^{-5}) \\cdot (9.81) \\cdot (5.0 \\times 10^{-12}) \\cdot (2.01894 \\times 10^{32})}{4.0 \\times 10^{15}} $$\n$$ Ra_H = \\frac{(1.6033 \\times 10^{-8}) \\cdot (2.01894 \\times 10^{32})}{4.0 \\times 10^{15}} = \\frac{3.23588 \\times 10^{24}}{4.0 \\times 10^{15}} = 8.0897 \\times 10^{8} $$\nRounding to four significant figures, $Ra_H = 8.090 \\times 10^{8}$.\n\nThe evaluated Rayleigh numbers are $(Ra, Ra_H) = (5.867 \\times 10^7, 8.090 \\times 10^8)$.", "answer": "$$\\boxed{\\begin{pmatrix} 5.867 \\times 10^{7}  8.090 \\times 10^{8} \\end{pmatrix}}$$", "id": "3609282"}, {"introduction": "The vigor of mantle convection translates into mechanical stress that pushes and pulls on the planet's cold, rigid outer layer, the lithosphere. Whether a planet develops active plate tectonics or a stagnant, immobile lid depends on the balance between these convective driving stresses and the strength of the lithosphere. This exercise provides a powerful hands-on application of scaling analysis, allowing you to estimate the convective driving stress and compare it to a plausible lithospheric yield stress, thereby predicting a planet's tectonic regime from first principles [@problem_id:3609252].", "problem": "Consider whole-mantle convection in a three-dimensional spherical shell with inner radius fixed and outer radius corresponding to the planetary surface. Assume an incompressible, infinite Prandtl number, Boussinesq fluid with temperature-dependent viscosity. Let the reference density be $\\rho_{0}$, the coefficient of thermal expansivity be $\\alpha$, the gravitational acceleration be $g$, and the total superadiabatic temperature drop across the convecting shell be $\\Delta T$. The shell thickness is $d$. Viscosity varies strongly with temperature, but you may take the leading-order convective driving stress to be set by the depth-integrated buoyancy force. The lithosphere is assumed to yield by a frictional-plastic (Byerlee-type) criterion with depth-dependent yield stress $\\sigma_{y}(z)=C_{0}+f\\,\\rho_{\\ell}\\,g\\,z$, where $C_{0}$ is the cohesion, $f$ is an effective friction coefficient, $\\rho_{\\ell}$ is the lithospheric density, and $z$ is depth.\n\nStarting from the steady Stokes momentum balance in the Boussinesq approximation for an incompressible fluid, and using an order-of-magnitude scaling based on the depth-integrated buoyancy force, derive an estimate for the characteristic convective stress scale $\\sigma_{c}$ and then form the nondimensional mobility measure $\\Lambda=\\sigma_{c}/\\sigma_{y}$ evaluated at a characteristic brittle-plastic depth $z=z_{b}$. You may assume that the dominant geometric length scale entering the buoyancy integration is $d$ and that spherical curvature does not alter the leading-order scaling of the radial stress.\n\nUse the following Earth-like parameter values: $\\rho_{0}=3300\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$, $\\alpha=2.5\\times 10^{-5}\\,\\mathrm{K}^{-1}$, $\\Delta T=2500\\,\\mathrm{K}$, $g=9.8\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$, $d=2.8\\times 10^{6}\\,\\mathrm{m}$, $C_{0}=2.0\\times 10^{7}\\,\\mathrm{Pa}$, $f=0.60$, $\\rho_{\\ell}=3300\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$, and $z_{b}=5.0\\times 10^{4}\\,\\mathrm{m}$. Compute the numerical value of $\\Lambda$ as a pure number and round your final answer to three significant figures. Do not include units in your final answer.", "solution": "The problem is evaluated to be valid. It is scientifically grounded in the principles of continuum mechanics and geophysics, specifically mantle convection and lithospheric rheology. The problem is well-posed, providing all necessary parameters and a clear objective for a scaling analysis. The language is objective and the given data are physically consistent and realistic for an Earth-like planet.\n\nThe task is to derive an estimate for the characteristic convective stress scale, $\\sigma_{c}$, and use it to compute the nondimensional mobility measure $\\Lambda$, defined as the ratio of $\\sigma_{c}$ to the lithospheric yield stress $\\sigma_{y}$ at a characteristic depth $z_{b}$.\n\nWe begin with the momentum balance for an incompressible, infinite Prandtl number, Boussinesq fluid, which is the steady Stokes equation:\n$$ -\\nabla p + \\nabla \\cdot \\boldsymbol{\\tau} + \\mathbf{F}_{b} = \\mathbf{0} $$\nHere, $p$ is the dynamic pressure, $\\boldsymbol{\\tau}$ is the deviatoric stress tensor, and $\\mathbf{F}_{b}$ is the buoyancy force per unit volume. The buoyancy force arises from temperature-induced density variations and is given by:\n$$ \\mathbf{F}_{b} = \\delta \\rho \\, \\mathbf{g} $$\nIn the Boussinesq approximation, the density anomaly $\\delta \\rho$ is related to the temperature anomaly $\\delta T$ through the coefficient of thermal expansivity $\\alpha$: $\\delta \\rho = -\\rho_{0} \\alpha \\, \\delta T$, where $\\rho_{0}$ is the reference density. Assuming gravity acts radially inward, $\\mathbf{g} = -g \\hat{\\mathbf{r}}$, the buoyancy force vector is $\\mathbf{F}_{b} = (\\rho_{0} \\alpha \\, \\delta T g) \\hat{\\mathbf{r}}$. The magnitude of the buoyancy force per unit volume is $|\\mathbf{F}_{b}| = \\rho_{0} \\alpha g |\\delta T|$.\n\nThe problem states that the leading-order convective driving stress, $\\sigma_{c}$, is set by the depth-integrated buoyancy force. This quantity represents the total buoyancy force acting on a vertical column of fluid, per unit area, and thus has units of stress. We can estimate its scale by integrating the characteristic buoyancy force per unit volume over the thickness of the convecting shell, $d$. The characteristic temperature anomaly $|\\delta T|$ across the shell is the superadiabatic temperature drop, $\\Delta T$.\n$$ \\sigma_{c} \\sim \\int_{0}^{d} (\\rho_{0} \\alpha g \\Delta T) \\, dz $$\nSince the integrand is constant in this scaling argument, the integral evaluates to:\n$$ \\sigma_{c} = \\rho_{0} \\alpha g \\Delta T d $$\nThis expression represents the characteristic driving stress of mantle convection.\n\nNext, we evaluate the yield stress of the lithosphere, $\\sigma_{y}$. The problem provides a depth-dependent, frictional-plastic (Byerlee-type) criterion:\n$$ \\sigma_{y}(z) = C_{0} + f\\,\\rho_{\\ell}\\,g\\,z $$\nwhere $C_{0}$ is the cohesion, $f$ is the effective friction coefficient, $\\rho_{\\ell}$ is the lithospheric density, and $z$ is the depth. We need to evaluate this yield stress at the characteristic brittle-plastic depth, $z = z_{b}$.\n$$ \\sigma_{y}(z_{b}) = C_{0} + f\\,\\rho_{\\ell}\\,g\\,z_{b} $$\n\nThe nondimensional mobility measure, $\\Lambda$, is the ratio of the convective driving stress to the lithospheric resisting strength:\n$$ \\Lambda = \\frac{\\sigma_{c}}{\\sigma_{y}(z_{b})} = \\frac{\\rho_{0} \\alpha g \\Delta T d}{C_{0} + f\\,\\rho_{\\ell}\\,g\\,z_{b}} $$\n\nWe now substitute the given Earth-like parameter values:\n- $\\rho_{0} = 3300\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$\n- $\\alpha = 2.5 \\times 10^{-5}\\,\\mathrm{K}^{-1}$\n- $g = 9.8\\,\\mathrm{m}\\,\\mathrm{s}^{-2}$\n- $\\Delta T = 2500\\,\\mathrm{K}$\n- $d = 2.8 \\times 10^{6}\\,\\mathrm{m}$\n- $C_{0} = 2.0 \\times 10^{7}\\,\\mathrm{Pa}$\n- $f = 0.60$\n- $\\rho_{\\ell} = 3300\\,\\mathrm{kg}\\,\\mathrm{m}^{-3}$\n- $z_{b} = 5.0 \\times 10^{4}\\,\\mathrm{m}$\n\nFirst, we compute the numerator, $\\sigma_{c}$:\n$$ \\sigma_{c} = (3300) \\times (2.5 \\times 10^{-5}) \\times (9.8) \\times (2500) \\times (2.8 \\times 10^{6}) \\, \\mathrm{Pa} $$\n$$ \\sigma_{c} = 5.6595 \\times 10^{9} \\, \\mathrm{Pa} $$\n\nNext, we compute the denominator, $\\sigma_{y}(z_{b})$:\n$$ \\sigma_{y}(z_{b}) = (2.0 \\times 10^{7}) + (0.60) \\times (3300) \\times (9.8) \\times (5.0 \\times 10^{4}) \\, \\mathrm{Pa} $$\nThe second term (frictional resistance) is:\n$$ f\\,\\rho_{\\ell}\\,g\\,z_{b} = 9.702 \\times 10^{8} \\, \\mathrm{Pa} $$\nSo, the total yield stress is:\n$$ \\sigma_{y}(z_{b}) = (2.0 \\times 10^{7}) + (9.702 \\times 10^{8}) \\, \\mathrm{Pa} = 9.902 \\times 10^{8} \\, \\mathrm{Pa} $$\n\nFinally, we compute the ratio $\\Lambda$:\n$$ \\Lambda = \\frac{5.6595 \\times 10^{9}}{9.902 \\times 10^{8}} = 5.7155019... $$\n\nThe problem requires the answer to be rounded to three significant figures.\n$$ \\Lambda \\approx 5.72 $$\nThis value is a nondimensional measure comparing the force driving plate tectonics to the force resisting it within the brittle part of the lithosphere.", "answer": "$$\\boxed{5.72}$$", "id": "3609252"}, {"introduction": "A central challenge in simulating mantle convection is the immense variation in viscosity, which can span many orders of magnitude from the cold lithosphere to the hot deep mantle. This creates a formidable numerical problem for the iterative solvers used to solve the Stokes equations for momentum. This practice delves into the heart of high-performance computing for geodynamics by exploring how Algebraic Multigrid (AMG) preconditioners, essential for efficient solvers, must be intelligently designed with viscosity-weighted \"smoothers\" to handle these extreme coefficient jumps and maintain rapid convergence [@problem_id:3609251].", "problem": "Consider incompressible Stokes flow for mantle convection in a three-dimensional spherical shell with variable viscosity. The governing momentum balance is given by $-\\nabla \\cdot \\left(2 \\eta(\\mathbf{x}) \\mathbf{D}(\\mathbf{u})\\right) + \\nabla p = \\mathbf{f}$ with incompressibility constraint $\\nabla \\cdot \\mathbf{u} = 0$, where $\\eta(\\mathbf{x})$ is the spatially varying viscosity, $\\mathbf{u}$ is the velocity, $p$ is the pressure, $\\mathbf{D}(\\mathbf{u}) = \\frac{1}{2}\\left(\\nabla \\mathbf{u} + \\nabla \\mathbf{u}^{\\top}\\right)$ is the strain-rate tensor, and $\\mathbf{f}$ is the body force. Upon discretization on an unstructured mesh for a three-dimensional spherical shell, the velocity block associated with the symmetric positive definite operator $-\\nabla \\cdot \\left(2 \\eta(\\mathbf{x}) \\mathbf{D}(\\cdot)\\right)$ is solved by a Krylov method with Algebraic Multigrid (AMG) preconditioning. The preconditioned operator is denoted by $P^{-1}A$, where $A$ is the discrete velocity block and $P$ is the AMG preconditioner. The convergence of the Preconditioned Conjugate Gradient (PCG) method for the symmetric positive definite preconditioned operator is controlled by the effective condition number $\\kappa_{\\text{eff}}$ of $P^{-1}A$.\n\nYou must estimate and compare Krylov iteration counts for AMG-preconditioned solves of the velocity block under two smoother strategies on the unstructured mesh: viscosity-weighted smoothers and standard smoothers. The comparison must quantify how coefficient jumps, measured by the viscosity contrast $\\Delta \\eta$, influence the estimated iteration counts.\n\nStart from the following fundamental base: discrete symmetric positive definite operators arising from variable-coefficient elliptic problems, the definition of condition number $\\kappa$ in terms of spectral bounds, and the worst-case error reduction per iteration in Preconditioned Conjugate Gradient, given by the bound $r(\\kappa) = \\frac{\\sqrt{\\kappa} - 1}{\\sqrt{\\kappa} + 1}$ for the energy norm of the error. Use these to construct a predictive model for iteration counts that captures the primary dependencies relevant to variable viscosity in three-dimensional spherical shells and unstructured meshes.\n\nImplement the following estimator for the effective condition number:\n1. Define the baseline AMG robustness constant as $\\kappa^\\star = 8$.\n2. Model mesh quality by a scalar $q \\in [0,1]$ with $q = 1$ representing an excellent, near-isotropic unstructured mesh and $q = 0$ representing a very poor, highly anisotropic unstructured mesh. Let the mesh factor be $F_{\\text{mesh}}(q) = 1 + \\gamma (1 - q)$ with $\\gamma = 15$.\n3. Model the AMG level factor, accounting for non-ideal coarsening and interpolation on unstructured meshes, as $F_{\\text{levels}}(L) = 1 + 0.1 (L - 1)$, where $L$ is the number of AMG levels.\n4. Model the spherical shell geometric factor as $F_{\\text{shell}}(r_{\\text{in}}, r_{\\text{out}}) = 1 + \\delta \\frac{R_m}{H}$ with $R_m = \\frac{r_{\\text{in}} + r_{\\text{out}}}{2}$, $H = r_{\\text{out}} - r_{\\text{in}}$, and $\\delta = 0.05$. The radii $r_{\\text{in}}$ and $r_{\\text{out}}$ must be provided in meters.\n5. Model the coefficient-jump factor due to viscosity contrast $\\Delta \\eta$ differently for the two smoother strategies:\n   - For standard smoothers, use $F_{\\text{jump,std}}(\\Delta \\eta) = (\\Delta \\eta)^{\\beta}$ with $\\beta = \\frac{1}{3}$.\n   - For viscosity-weighted smoothers, use $F_{\\text{jump,w}}(\\Delta \\eta) = 1 + c \\log_{10}(\\Delta \\eta)$ with $c = 0.5$.\n\nCombine these to obtain the effective condition numbers\n$$\n\\kappa_{\\text{eff,std}} = \\kappa^\\star \\, F_{\\text{mesh}}(q) \\, F_{\\text{levels}}(L) \\, F_{\\text{shell}}(r_{\\text{in}}, r_{\\text{out}}) \\, F_{\\text{jump,std}}(\\Delta \\eta),\n$$\n$$\n\\kappa_{\\text{eff,w}} = \\kappa^\\star \\, F_{\\text{mesh}}(q) \\, F_{\\text{levels}}(L) \\, F_{\\text{shell}}(r_{\\text{in}}, r_{\\text{out}}) \\, F_{\\text{jump,w}}(\\Delta \\eta).\n$$\n\nFor a given tolerance $\\epsilon$ on the reduction of the error norm (starting from unit initial error), estimate the required number of PCG iterations $n$ by the bound\n$$\nn = \\left\\lceil \\frac{\\ln(\\epsilon)}{\\ln\\left(r(\\kappa_{\\text{eff}})\\right)} \\right\\rceil,\n\\quad\n\\text{with}\n\\quad\nr(\\kappa_{\\text{eff}}) = \\frac{\\sqrt{\\kappa_{\\text{eff}}} - 1}{\\sqrt{\\kappa_{\\text{eff}}} + 1}.\n$$\n\nExplain in your approach how coefficient jumps affect smoother efficacy, and why viscosity-weighted smoothers mitigate the degradation seen with standard smoothers on unstructured meshes.\n\nImplement a program that, for each test case, computes a pair of integers $\\left[n_{\\text{std}}, n_{\\text{w}}\\right]$ representing iteration counts for standard and viscosity-weighted smoothers, respectively, using the estimator above. No physical units are required in the output since iteration counts are dimensionless. Angles are not used in this problem.\n\nUse the following test suite, which spans a general case, favorable mesh quality, severe coefficient jumps with poor mesh, and pronounced geometric thin-shell effects. All radii are specified in meters:\n- Test case $1$: $\\Delta \\eta = 10^{6}$, $q = 0.5$, $L = 5$, $r_{\\text{in}} = 3.48 \\times 10^{6}$, $r_{\\text{out}} = 6.371 \\times 10^{6}$, $\\epsilon = 10^{-6}$.\n- Test case $2$: $\\Delta \\eta = 10^{3}$, $q = 0.95$, $L = 5$, $r_{\\text{in}} = 3.48 \\times 10^{6}$, $r_{\\text{out}} = 6.371 \\times 10^{6}$, $\\epsilon = 10^{-8}$.\n- Test case $3$: $\\Delta \\eta = 10^{8}$, $q = 0.1$, $L = 6$, $r_{\\text{in}} = 3.48 \\times 10^{6}$, $r_{\\text{out}} = 6.371 \\times 10^{6}$, $\\epsilon = 10^{-4}$.\n- Test case $4$: $\\Delta \\eta = 10^{6}$, $q = 0.7$, $L = 4$, $r_{\\text{in}} = 6.0 \\times 10^{6}$, $r_{\\text{out}} = 6.2 \\times 10^{6}$, $\\epsilon = 10^{-6}$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each entry is itself a two-element list per test case in the same order as above, for example $\\left[\\left[n_{\\text{std},1},n_{\\text{w},1}\\right],\\left[n_{\\text{std},2},n_{\\text{w},2}\\right],\\ldots\\right]$.", "solution": "The problem is valid as it is scientifically grounded in computational fluid dynamics and numerical linear algebra, is well-posed with a complete set of definitions and parameters, and is expressed in objective, formal language. All components required for a unique, verifiable solution are provided.\n\nThe problem asks for an estimation of the number of Preconditioned Conjugate Gradient (PCG) iterations required to solve the velocity block of a Stokes flow problem, which models mantle convection. The system arises from the discretization of a variable-coefficient elliptic partial differential equation on a three-dimensional spherical shell using an unstructured mesh. The core of the analysis is to compare the performance of two different smoother strategies within an Algebraic Multigrid (AMG) preconditioner: standard smoothers and viscosity-weighted smoothers.\n\nThe governing momentum equation for incompressible Stokes flow is\n$$\n-\\nabla \\cdot \\left(2 \\eta(\\mathbf{x}) \\mathbf{D}(\\mathbf{u})\\right) + \\nabla p = \\mathbf{f}\n$$\ncoupled with the incompressibility constraint $\\nabla \\cdot \\mathbf{u} = 0$. Here, $\\eta(\\mathbf{x})$ is the spatially varying viscosity, which can vary by many orders of magnitude within the Earth's mantle. The discrete form of the velocity operator, denoted by $A$, is a symmetric positive definite matrix. Due to the large viscosity contrast $\\Delta \\eta$ and characteristics of the mesh, $A$ is typically ill-conditioned, necessitating a powerful preconditioner such as AMG for the Krylov solver (PCG).\n\nThe convergence rate of PCG is governed by the condition number $\\kappa$ of the preconditioned system, $P^{-1}A$. A well-known bound for the reduction of the energy norm of the error after $n$ iterations is given by $r(\\kappa)^n$, where the convergence factor is $r(\\kappa) = \\frac{\\sqrt{\\kappa} - 1}{\\sqrt{\\kappa} + 1}$. To achieve a desired error tolerance $\\epsilon$ from an initial unit error, the number of iterations $n$ must satisfy $r(\\kappa)^n \\le \\epsilon$. Solving for $n$ yields the estimate:\n$$\nn \\ge \\frac{\\ln(\\epsilon)}{\\ln(r(\\kappa))}\n$$\nSince $n$ must be an integer, we take the ceiling of this value:\n$$\nn = \\left\\lceil \\frac{\\ln(\\epsilon)}{\\ln\\left(r(\\kappa)\\right)} \\right\\rceil\n$$\nThe problem provides a phenomenological model to estimate the effective condition number, $\\kappa_{\\text{eff}}$, of the AMG-preconditioned system. The model combines several factors that influence AMG performance:\n$$\n\\kappa_{\\text{eff}} = \\kappa^\\star \\cdot F_{\\text{mesh}} \\cdot F_{\\text{levels}} \\cdot F_{\\text{shell}} \\cdot F_{\\text{jump}}\n$$\nwhere $\\kappa^\\star$ is a baseline constant reflecting the ideal robustness of AMG, and the other factors account for degradations due to mesh quality, number of multigrid levels, geometry, and coefficient heterogeneity.\n\nA critical aspect of AMG performance for variable-coefficient problems lies in the choice of the smoother, which is an iterative method (like Gauss-Seidel or Jacobi) used to reduce high-frequency error components on each grid level. Large jumps in the viscosity $\\eta(\\mathbf{x})$ induce large jumps in the entries of the matrix $A$.\n- **Standard Smoothers**: These smoothers operate without knowledge of the matrix coefficients. At interfaces between low- and high-viscosity regions, they become inefficient. They fail to adequately smooth error modes that are oscillatory in the low-viscosity region but smooth in the high-viscosity region, leading to a breakdown in the synergy between smoothing and coarse-grid correction. This degradation is modeled by a power-law dependency on the viscosity contrast $\\Delta \\eta$: $F_{\\text{jump,std}}(\\Delta \\eta) = (\\Delta \\eta)^{\\beta}$ with $\\beta = \\frac{1}{3}$. This indicates a severe, polynomial increase in the condition number as $\\Delta \\eta$ grows.\n- **Viscosity-Weighted Smoothers**: These methods are designed to be robust for such problems. They explicitly use the magnitude of the matrix coefficients (which are related to viscosity) to scale the smoothing updates. This allows the smoother to remain effective across coefficient jumps. The resulting AMG preconditioner is more robust, with performance degrading only mildly with increasing $\\Delta \\eta$. This is captured by a logarithmic dependency: $F_{\\text{jump,w}}(\\Delta \\eta) = 1 + c \\log_{10}(\\Delta \\eta)$ with $c = 0.5$.\n\nThe calculation proceeds by first evaluating the common factors for each test case:\n1.  **Mesh Factor**: $F_{\\text{mesh}}(q) = 1 + \\gamma (1 - q)$, with $\\gamma = 15$. This factor increases as mesh quality $q$ degrades (approaches $0$).\n2.  **Levels Factor**: $F_{\\text{levels}}(L) = 1 + 0.1 (L - 1)$. This factor models slight performance degradation as the number of AMG levels $L$ increases.\n3.  **Shell Geometry Factor**: $F_{\\text{shell}}(r_{\\text{in}}, r_{\\text{out}}) = 1 + \\delta \\frac{R_m}{H}$, with $\\delta = 0.05$, mean radius $R_m = \\frac{r_{\\text{in}} + r_{\\text{out}}}{2}$, and thickness $H = r_{\\text{out}} - r_{\\text{in}}$. This term accounts for geometric anisotropy, which becomes more pronounced for thin shells (large $\\frac{R_m}{H}$ ratio).\n\nNext, we compute the two distinct jump factors, $F_{\\text{jump,std}}$ and $F_{\\text{jump,w}}$, for each case. These are then combined with the common factors and the baseline $\\kappa^\\star = 8$ to compute $\\kappa_{\\text{eff,std}}$ and $\\kappa_{\\text{eff,w}}$. Finally, for each effective condition number, we compute the corresponding convergence factor $r(\\kappa_{\\text{eff}})$ and use the iteration count formula to find the estimated number of iterations, $n_{\\text{std}}$ and $n_{\\text{w}}$.\n\nFor each test case provided, we will calculate the pair of iteration counts $[n_{\\text{std}}, n_{\\text{w}}]$. The results will quantitatively demonstrate the superior robustness of the viscosity-weighted smoother, especially in scenarios with high viscosity contrast, poor mesh quality, or challenging geometries, as reflected by the significantly lower iteration counts predicted for $n_{\\text{w}}$ compared to $n_{\\text{std}}$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and prints the estimated PCG iteration counts for standard and\n    viscosity-weighted AMG smoothers based on the provided model and test cases.\n    \"\"\"\n    \n    # Define constants from the problem statement.\n    KAPPA_STAR = 8.0\n    GAMMA = 15.0\n    DELTA = 0.05\n    BETA = 1.0 / 3.0\n    C = 0.5\n\n    # Define the factor models as functions.\n    def f_mesh(q):\n        \"\"\"Calculates the mesh quality factor.\"\"\"\n        return 1.0 + GAMMA * (1.0 - q)\n\n    def f_levels(L):\n        \"\"\"Calculates the AMG level factor.\"\"\"\n        return 1.0 + 0.1 * (L - 1.0)\n\n    def f_shell(r_in, r_out):\n        \"\"\"Calculates the spherical shell geometric factor.\"\"\"\n        if r_out = r_in:\n            # Avoid division by zero or negative thickness.\n            # This case is physically not expected in the problem context.\n            return 1.0 \n        R_m = (r_in + r_out) / 2.0\n        H = r_out - r_in\n        return 1.0 + DELTA * (R_m / H)\n\n    def f_jump_std(delta_eta):\n        \"\"\"Calculates the coefficient-jump factor for standard smoothers.\"\"\"\n        return delta_eta**BETA\n\n    def f_jump_w(delta_eta):\n        \"\"\"Calculates the coefficient-jump factor for viscosity-weighted smoothers.\"\"\"\n        return 1.0 + C * np.log10(delta_eta)\n\n    def calculate_iterations(kappa_eff, epsilon):\n        \"\"\"Estimates the number of PCG iterations required.\"\"\"\n        # For a perfectly preconditioned system, kappa_eff = 1, r = 0, iterations = 1.\n        if kappa_eff = 1.0:\n            return 1\n            \n        sqrt_kappa = np.sqrt(kappa_eff)\n        r = (sqrt_kappa - 1.0) / (sqrt_kappa + 1.0)\n        \n        # If r is close to 1, log(r) is close to 0, indicating slow convergence.\n        # This check prevents division by a very small number or zero if r=1.\n        if r = 1.0:\n            return np.inf # Divergence\n\n        num_iter = np.ceil(np.log(epsilon) / np.log(r))\n        return int(num_iter)\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        {'delta_eta': 1e6, 'q': 0.5, 'L': 5, 'r_in': 3.48e6, 'r_out': 6.371e6, 'epsilon': 1e-6},\n        {'delta_eta': 1e3, 'q': 0.95, 'L': 5, 'r_in': 3.48e6, 'r_out': 6.371e6, 'epsilon': 1e-8},\n        {'delta_eta': 1e8, 'q': 0.1, 'L': 6, 'r_in': 3.48e6, 'r_out': 6.371e6, 'epsilon': 1e-4},\n        {'delta_eta': 1e6, 'q': 0.7, 'L': 4, 'r_in': 6.0e6, 'r_out': 6.2e6, 'epsilon': 1e-6},\n    ]\n\n    results = []\n    for case in test_cases:\n        # Extract parameters for the current case\n        delta_eta = case['delta_eta']\n        q = case['q']\n        L = case['L']\n        r_in = case['r_in']\n        r_out = case['r_out']\n        epsilon = case['epsilon']\n\n        # Calculate the common factors for the condition number\n        factor_mesh = f_mesh(q)\n        factor_levels = f_levels(L)\n        factor_shell = f_shell(r_in, r_out)\n\n        # Calculate the base part of the condition number\n        kappa_base = KAPPA_STAR * factor_mesh * factor_levels * factor_shell\n\n        # --- Standard Smoother Calculation ---\n        factor_jump_std = f_jump_std(delta_eta)\n        kappa_eff_std = kappa_base * factor_jump_std\n        n_std = calculate_iterations(kappa_eff_std, epsilon)\n        \n        # --- Viscosity-Weighted Smoother Calculation ---\n        factor_jump_w = f_jump_w(delta_eta)\n        kappa_eff_w = kappa_base * factor_jump_w\n        n_w = calculate_iterations(kappa_eff_w, epsilon)\n\n        results.append([n_std, n_w])\n\n    # Format the final output string exactly as required: [[n_std,1,n_w,1],[...]]\n    output_str = \"[\" + \",\".join([f\"[{r[0]},{r[1]}]\" for r in results]) + \"]\"\n    print(output_str)\n\nsolve()\n```", "id": "3609251"}]}