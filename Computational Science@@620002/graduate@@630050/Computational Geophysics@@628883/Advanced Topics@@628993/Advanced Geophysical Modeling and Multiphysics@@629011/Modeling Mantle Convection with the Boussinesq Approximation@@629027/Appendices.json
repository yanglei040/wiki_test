{"hands_on_practices": [{"introduction": "Before diving into complex numerical codes, a firm grasp of the underlying physics is essential. This practice uses linear stability analysis, a powerful analytical method, to explore the fundamental question: under what conditions does a static fluid layer begin to convect? By solving this classic Rayleigh-Bénard problem [@problem_id:3610794], you will derive the critical Rayleigh number ($Ra_c$) and critical wavenumber ($k_c$), providing direct insight into the balance of forces that governs the transition from conduction to convection.", "problem": "Consider a horizontally infinite layer of incompressible, Newtonian mantle fluid of thickness $H$, heated from below and cooled from above, modeled under the Boussinesq approximation. Gravity $\\boldsymbol{g}= -g\\,\\hat{\\boldsymbol{z}}$ acts downward. Let the density be $\\rho$, kinematic viscosity $\\nu$, thermal diffusivity $\\kappa$, thermal expansivity $\\alpha$, and the imposed temperature difference across the layer be $\\Delta T>0$. Non-dimensionalize using the thermal diffusion time $H^{2}/\\kappa$ for time, the layer thickness $H$ for length, and the imposed temperature difference $\\Delta T$ for temperature, so that the non-dimensional vertical coordinate is $z\\in[0,1]$ and the Rayleigh number is $Ra = \\dfrac{\\alpha g \\Delta T H^{3}}{\\nu \\kappa}$.\n\nAssume the infinite Prandtl number limit appropriate for mantle convection, so that inertia is negligible in the linearized momentum equation. Let the basic conductive state be $T_{0}(z)=1-z$ and $\\boldsymbol{u}_{0}=\\boldsymbol{0}$. Consider infinitesimal perturbations $(\\boldsymbol{u},p,\\theta)$ about this base state, with $\\theta$ the temperature perturbation. Impose isothermal boundary conditions on the temperature perturbation, and free-slip boundary conditions on the velocity, at both plates:\n- $z=0$ and $z=1$: $\\,\\theta=0$, $\\,w=0$, $\\,\\partial^{2} w/\\partial z^{2}=0$, where $w$ is the vertical velocity.\n\nStarting from the non-dimensional linearized Boussinesq equations about the conductive state,\n- incompressibility: $\\nabla\\cdot\\boldsymbol{u}=0$;\n- Stokes momentum balance: $\\boldsymbol{0}=-\\nabla p+\\nabla^{2}\\boldsymbol{u}+Ra\\,\\theta\\,\\hat{\\boldsymbol{z}}$;\n- heat: $\\dfrac{\\partial \\theta}{\\partial t}=\\nabla^{2}\\theta+w$,\nperform a normal-mode linear stability analysis by seeking solutions proportional to $\\exp\\!\\big(i k x+\\sigma t\\big)$ with horizontal wavenumber $k>0$, growth rate $\\sigma$, and vertical structure functions of $z$. Derive the ordinary differential eigenvalue problem for the vertical velocity amplitude $W(z)$ and temperature amplitude $\\Theta(z)$ under the stated boundary conditions, determine the neutrally stable dispersion relation $Ra=Ra(k)$ for the fundamental vertical mode, and minimize $Ra(k)$ over $k>0$ to obtain the critical Rayleigh number $Ra_{c}$ and the corresponding critical wavenumber $k_{c}$ for the onset of stationary convection for free-slip, isothermal plates.\n\nThen, explain qualitatively (in words, not in formulas) how and why these critical values differ from the rigid, no-slip, isothermal case at both plates.\n\nProvide as your final answer the exact, closed-form expressions for the nondimensional pair $\\big(Ra_{c},\\,k_{c}\\big)$ for the free-slip, isothermal case, written as a single row using the LaTeX $\\pmatrix$ convention, with no numerical rounding.", "solution": "The problem asks for a linear stability analysis of Rayleigh-Bénard convection in a horizontally infinite fluid layer of thickness $H$ with free-slip, isothermal boundary conditions. We are to find the critical Rayleigh number $Ra_c$ and critical wavenumber $k_c$ for the onset of stationary convection.\n\nFirst, we begin with the provided non-dimensional linearized Boussinesq equations for the perturbations of velocity $\\boldsymbol{u}=(u,v,w)$, pressure $p$, and temperature $\\theta$ about the quiescent, conductive base state. The problem is set in a coordinate system where $\\hat{\\boldsymbol{z}}$ points upward, so the vertical coordinate $z$ spans from $0$ to $1$. The equations are:\n1. Incompressibility: $\\nabla\\cdot\\boldsymbol{u}=0$\n2. Stokes momentum balance (infinite Prandtl number): $\\boldsymbol{0}=-\\nabla p+\\nabla^{2}\\boldsymbol{u}+Ra\\,\\theta\\,\\hat{\\boldsymbol{z}}$\n3. Heat transport: $\\dfrac{\\partial \\theta}{\\partial t}=\\nabla^{2}\\theta+w$\n\nHere, $Ra = \\frac{\\alpha g \\Delta T H^3}{\\nu \\kappa}$ is the Rayleigh number.\n\nWe perform a normal-mode analysis, seeking solutions that are periodic in the horizontal direction and grow or decay exponentially in time. We can, without loss of generality due to Squire's theorem, consider two-dimensional rolls oriented along the $y$-axis, so all variables are independent of $y$ and the velocity component $v=0$. The perturbations are written as:\n$$w(x,z,t) = W(z) \\exp(i k x + \\sigma t)$$\n$$u(x,z,t) = U(z) \\exp(i k x + \\sigma t)$$\n$$\\theta(x,z,t) = \\Theta(z) \\exp(i k x + \\sigma t)$$\n$$p(x,z,t) = P(z) \\exp(i k x + \\sigma t)$$\nwhere $k>0$ is the horizontal wavenumber and $\\sigma$ is the complex growth rate. Substituting these forms into the governing equations transforms the partial differential equations into ordinary differential equations (ODEs) for the amplitude functions $W(z)$, $U(z)$, $\\Theta(z)$, and $P(z)$. Let $D \\equiv \\frac{d}{dz}$.\n\nThe incompressibility equation $\\frac{\\partial u}{\\partial x} + \\frac{\\partial w}{\\partial z} = 0$ becomes:\n$$ikU + DW = 0 \\quad \\implies \\quad U = \\frac{i}{k} DW$$\n\nThe momentum equations become:\nx-component: $0 = -ikP + (D^2 - k^2)U$\nz-component: $0 = -DP + (D^2 - k^2)W + Ra\\,\\Theta$\n\nThe heat transport equation becomes:\n$$\\sigma \\Theta = (D^2 - k^2)\\Theta + W$$\n\nOur next step is to eliminate $U$ and $P$ to obtain a system for $W$ and $\\Theta$.\nSubstitute $U = \\frac{i}{k}DW$ into the x-momentum equation:\n$$0 = -ikP + (D^2 - k^2)\\left(\\frac{i}{k}DW\\right) \\implies P = \\frac{1}{k^2}(D^2 - k^2)DW$$\nNow, substitute this expression for $P$ into the z-momentum equation by first differentiating it with respect to $z$:\n$$DP = \\frac{1}{k^2}(D^2 - k^2)D^2W$$\nThe z-momentum equation is then:\n$$0 = -\\frac{1}{k^2}(D^2 - k^2)D^2W + (D^2 - k^2)W + Ra\\,\\Theta$$\nMultiplying by $k^2$ and rearranging gives:\n$$k^2Ra\\,\\Theta = (D^2 - k^2)D^2W - k^2(D^2 - k^2)W = (D^2 - k^2)(D^2W - k^2W)$$\nThis simplifies to a single fourth-order ODE coupling $W$ and $\\Theta$:\n$$(D^2 - k^2)^2 W = k^2 Ra\\,\\Theta \\quad (*)$$\n\nWe are looking for the onset of stationary convection, which corresponds to the marginal stability case where the growth rate is purely real and equals zero ($\\sigma=0$). This is justified by the principle of exchange of stabilities, which holds for this problem. Setting $\\sigma=0$ in the heat transport equation gives the second ODE:\n$$(D^2 - k^2)\\Theta = -W \\quad (**)$$\n\nWe now have a coupled system of ODEs for $W(z)$ and $\\Theta(z)$. The boundary conditions at the top and bottom plates ($z=0$ and $z=1$) are given as isothermal ($\\theta=0$), impermeable ($w=0$), and free-slip. The free-slip condition ($\\frac{\\partial u}{\\partial z}=0$ at the boundaries), combined with incompressibility, leads to $\\frac{\\partial^2 w}{\\partial z^2}=0$. Thus, the boundary conditions on the amplitude functions are:\n$$W(0) = W(1) = 0$$\n$$\\Theta(0) = \\Theta(1) = 0$$\n$$D^2W(0) = D^2W(1) = 0$$\n\nThese particular boundary conditions are all satisfied by sinusoidal functions. Let's try a solution of the form $W(z) = A \\sin(n\\pi z)$ for an integer $n \\ge 1$.\n- $W(0) = A \\sin(0) = 0$ and $W(1) = A \\sin(n\\pi) = 0$.\n- $D^2W = -A(n\\pi)^2 \\sin(n\\pi z)$, so $D^2W(0)=0$ and $D^2W(1)=0$.\nThis form is a valid eigenfunction for the system.\n\nNow we substitute $W(z) = A \\sin(n\\pi z)$ into equations $(*)$ and $(**)$ to find the eigenvalue $Ra$.\nFrom $(**)$, we find $\\Theta(z)$:\n$$(D^2 - k^2)\\Theta = -A \\sin(n\\pi z)$$\nSince $D^2[\\sin(n\\pi z)] = -(n\\pi)^2 \\sin(n\\pi z)$, we can assume $\\Theta(z) = B \\sin(n\\pi z)$. Substituting this gives:\n$$(-(n\\pi)^2 - k^2)B \\sin(n\\pi z) = -A \\sin(n\\pi z)$$\n$$B = \\frac{A}{(n\\pi)^2 + k^2}$$\nSo, $\\Theta(z) = \\frac{A}{(n\\pi)^2 + k^2}\\sin(n\\pi z)$. This form also satisfies the boundary condition $\\Theta(0)=\\Theta(1)=0$.\n\nNow, substitute both $W(z)$ and $\\Theta(z)$ into equation $(*)$:\n$$(D^2 - k^2)^2 (A \\sin(n\\pi z)) = k^2 Ra \\left( \\frac{A}{(n\\pi)^2 + k^2}\\sin(n\\pi z) \\right)$$\nLet's evaluate the left-hand side operator:\n$$(D^2 - k^2)(A \\sin(n\\pi z)) = (-(n\\pi)^2 - k^2)A \\sin(n\\pi z)$$\n$$(D^2 - k^2)^2(A \\sin(n\\pi z)) = (-(n\\pi)^2 - k^2)^2 A \\sin(n\\pi z) = ((n\\pi)^2 + k^2)^2 A \\sin(n\\pi z)$$\nSubstituting this back into the main equation:\n$$((n\\pi)^2 + k^2)^2 A \\sin(n\\pi z) = k^2 Ra \\frac{A}{(n\\pi)^2 + k^2} \\sin(n\\pi z)$$\nFor a non-trivial solution ($A \\neq 0$), we can cancel $A\\sin(n\\pi z)$ to obtain the dispersion relation for $Ra$ as a function of $k$ and $n$:\n$$Ra(k,n) = \\frac{((n\\pi)^2 + k^2)^3}{k^2}$$\nThe onset of convection corresponds to the minimum possible Rayleigh number. We must minimize $Ra$ with respect to the mode number $n$ and the wavenumber $k$. For any fixed $k>0$, the function $Ra(k,n)$ is minimized by choosing the smallest possible integer value for $n$, which is $n=1$ (the fundamental mode).\n$$Ra(k) = \\frac{(\\pi^2 + k^2)^3}{k^2}$$\nTo find the critical wavenumber $k_c$ that minimizes $Ra(k)$, we compute the derivative with respect to $k$ and set it to zero. It is easier to use $x=k^2$ as the variable:\n$$Ra(x) = \\frac{(\\pi^2 + x)^3}{x}$$\n$$\\frac{dRa}{dx} = \\frac{3(\\pi^2+x)^2 \\cdot x - (\\pi^2+x)^3 \\cdot 1}{x^2} = 0$$\nFor a minimum, the numerator must be zero. Since $x=k^2>0$, $\\pi^2+x \\neq 0$, so we can divide by $(\\pi^2+x)^2$:\n$$3x - (\\pi^2+x) = 0$$\n$$2x - \\pi^2 = 0 \\implies x = \\frac{\\pi^2}{2}$$\nThus, the critical wavenumber squared is $k_c^2 = \\frac{\\pi^2}{2}$, which gives the critical wavenumber:\n$$k_c = \\sqrt{\\frac{\\pi^2}{2}} = \\frac{\\pi}{\\sqrt{2}}$$\nFinally, we substitute this value back into the expression for $Ra(k)$ to find the critical Rayleigh number $Ra_c$:\n$$Ra_c = \\frac{(\\pi^2 + k_c^2)^3}{k_c^2} = \\frac{(\\pi^2 + \\frac{\\pi^2}{2})^3}{\\frac{\\pi^2}{2}} = \\frac{(\\frac{3\\pi^2}{2})^3}{\\frac{\\pi^2}{2}}$$\n$$Ra_c = \\frac{\\frac{27\\pi^6}{8}}{\\frac{\\pi^2}{2}} = \\frac{27\\pi^6}{8} \\cdot \\frac{2}{\\pi^2} = \\frac{27\\pi^4}{4}$$\nSo, for free-slip, isothermal boundaries, the critical values for the onset of stationary convection are $k_c = \\frac{\\pi}{\\sqrt{2}}$ and $Ra_c = \\frac{27\\pi^4}{4}$. Numerically, these are $k_c \\approx 2.221$ and $Ra_c \\approx 657.51$.\n\nQualitative comparison with the rigid, no-slip, isothermal case:\n\nFor rigid (no-slip) boundaries, the boundary conditions for the vertical velocity amplitude become $W=0$ and $DW=0$ at $z=0$ and $z=1$. These more restrictive conditions lead to critical values of $Ra_c \\approx 1707.76$ and $k_c \\approx 3.117$.\n\nThe critical Rayleigh number ($Ra_c$) is significantly higher for rigid boundaries compared to free-slip boundaries ($1708$ vs. $657.5$). The Rayleigh number represents the ratio of buoyant driving forces to dissipative forces (viscous and thermal). Rigid, no-slip boundaries introduce strong viscous drag near the top and bottom of the fluid layer, dissipating kinetic energy far more effectively than free-slip boundaries, where the fluid can move horizontally without shear stress. This enhanced viscous dissipation stabilizes the conductive state, meaning a much stronger buoyancy force (and thus a higher $Ra$) is required to overcome the resistance and initiate convective motion.\n\nThe critical wavenumber ($k_c$) is larger for rigid boundaries compared to free-slip boundaries ($3.12$ vs. $2.22$). The wavenumber is inversely related to the horizontal wavelength of the convection cells at their onset ($\\lambda_c = 2\\pi/k_c$). A larger $k_c$ implies narrower convection cells. The no-slip condition strongly constrains the fluid flow in the vertical direction near the boundaries. The fluid must slow down and come to a stop. To accommodate this strong vertical shear, the flow organizes into narrower cells. In contrast, with free-slip boundaries, the lack of viscous resistance at the top and bottom allows the fluid to complete its overturning circulation over a wider horizontal distance with less effort, resulting in broader convection cells and a smaller critical wavenumber.", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{27\\pi^4}{4} & \\frac{\\pi}{\\sqrt{2}}\n\\end{pmatrix}\n}\n$$", "id": "3610794"}, {"introduction": "Having established the physical conditions for convection, the next step is to translate the continuous governing equations into a discrete form that a computer can solve. For incompressible flows like mantle convection, a naive discretization can lead to numerical instabilities and non-physical solutions. This exercise [@problem_id:3610769] guides you through the construction of discrete operators on a staggered Marker-and-Cell (MAC) grid, a classic and robust finite-difference technique that guarantees both exact local mass conservation and a stable velocity-pressure coupling.", "problem": "Consider two-dimensional mantle convection under the Boussinesq approximation, in a rectangular domain $[0,L_{x}] \\times [0,L_{y}]$ with uniform spacings $h_{x}$ and $h_{y}$. The Boussinesq approximation assumes constant reference density $\\rho_{0}$ except in the buoyancy term, incompressibility $\\nabla \\cdot \\boldsymbol{u} = 0$, and constant viscosity $\\mu$. The governing dimensional equations are, in steady state, the incompressible Stokes equations with buoyancy and an advection–diffusion equation for temperature $T$:\n$$\n-\\nabla p + \\mu \\nabla^{2} \\boldsymbol{u} + \\rho_{0} \\alpha g \\left(T - T_{0}\\right) \\boldsymbol{e}_{y} = \\boldsymbol{0}, \\quad \\nabla \\cdot \\boldsymbol{u} = 0, \\quad \\boldsymbol{u} \\cdot \\nabla T = \\kappa \\nabla^{2} T,\n$$\nwhere $\\alpha$ is the thermal expansivity, $g$ is gravitational acceleration, $\\boldsymbol{e}_{y}$ is the vertical unit vector, and $\\kappa$ is thermal diffusivity. For computational geophysics applications, a staggered Marker-and-Cell (MAC) grid is commonly used: scalar fields $p$ and $T$ are stored at cell centers $(i,j)$, the horizontal velocity component $u$ is stored at vertical cell faces $(i+\\frac{1}{2},j)$, and the vertical velocity component $v$ is stored at horizontal cell faces $(i,j+\\frac{1}{2})$.\n\nStarting from the fundamental conservation laws and the definition of fluxes, construct second-order accurate discrete operators on this staggered grid:\n- A discrete gradient operator $\\boldsymbol{G}$ mapping cell-centered scalars to face-centered vectors, consistent with Newton’s second law so that the discrete pressure gradient enters the face-centered momentum equations.\n- A discrete divergence operator $D$ mapping face-centered vectors to cell-centered scalars, consistent with mass conservation so that $D \\boldsymbol{u}=0$ enforces exact discrete incompressibility.\n- A discrete Laplacian operator $L$ acting on cell-centered scalars and built from $D$ and $\\boldsymbol{G}$ in a manner that ensures a discrete Green’s identity and a symmetric positive definite discrete Poisson operator for pressure.\n\nYour derivation must:\n1. Define the placement of unknowns on the MAC grid and the index conventions $(i,j)$ for centers, $(i+\\frac{1}{2},j)$ for $u$-faces, and $(i,j+\\frac{1}{2})$ for $v$-faces.\n2. Use flux-balance and summation-by-parts arguments to determine the signs and finite-difference forms of $D$ and $\\boldsymbol{G}$ so that $D$ is the negative adjoint of $\\boldsymbol{G}$ under appropriate discrete inner products.\n3. Show that $L = D \\boldsymbol{G}$ acting on a cell-centered scalar produces the standard second-order five-point stencil on centers.\n4. Explain why these operator choices lead to a discrete inf–sup stable pairing between pressure and velocity and exact enforcement of $D \\boldsymbol{u}=0$ in the incompressible constraint.\n\nProvide your final answer as three closed-form discrete expressions for the operator actions at the indicated grid locations: $(\\boldsymbol{G}p)_{i+\\frac{1}{2},j}$ and $(\\boldsymbol{G}p)_{i,j+\\frac{1}{2}}$, $(D \\boldsymbol{u})_{i,j}$, and $(L p)_{i,j}$. No numerical evaluation is required. Express the final answer as analytic formulas; no units are needed. If any assumptions on boundary conditions are needed to justify adjointness or stability, state them clearly in your derivation, but do not include them in the final expressions. The final answer must be given as a single row matrix in the $\\LaTeX$ $\\pmatrix$ environment containing the three expressions in order.", "solution": "The problem requires the construction of second-order accurate discrete operators for the gradient, divergence, and Laplacian on a staggered Marker-and-Cell (MAC) grid, suitable for simulating two-dimensional ($2$D) mantle convection under the Boussinesq approximation. The derivation will be based on finite-difference approximations that respect fundamental physical and mathematical properties, such as mass conservation and the relationship between operators.\n\nFirst, we define the placement of the discrete variables on the grid. We consider a rectangular grid with uniform spacings $h_x$ and $h_y$. Scalar quantities, pressure $p$ and temperature $T$, are defined at the centers of grid cells. We denote the value at the center of cell $(i,j)$ as $p_{i,j}$ and $T_{i,j}$. The horizontal velocity component, $u$, is defined at the center of vertical cell faces, denoted $u_{i+\\frac{1}{2},j}$. The vertical velocity component, $v$, is defined at the center of horizontal cell faces, denoted $v_{i,j+\\frac{1}{2}}$. This staggered arrangement is fundamental to the stability of the numerical scheme.\n\nLet's construct the discrete operators as required.\n\n1.  **Discrete Gradient Operator $\\boldsymbol{G}$**\n    The continuous momentum equation includes the pressure gradient term, $-\\nabla p$. In the discrete form, this term must be evaluated at the locations of the velocity components.\n    \n    The $x$-component of the momentum equation is solved at the location of $u_{i+\\frac{1}{2},j}$. A second-order accurate finite difference approximation for the partial derivative $\\frac{\\partial p}{\\partial x}$ at this location is a central difference using the two adjacent pressure nodes, $p_{i,j}$ and $p_{i+1,j}$. This defines the $x$-component of the discrete gradient operator $\\boldsymbol{G}$ acting on a cell-centered scalar field $p$:\n    $$(\\boldsymbol{G}p)_{i+\\frac{1}{2},j} = \\frac{p_{i+1,j} - p_{i,j}}{h_x}$$\n    \n    Similarly, the $y$-component of the momentum equation is solved at the location of $v_{i,j+\\frac{1}{2}}$. A second-order central difference for $\\frac{\\partial p}{\\partial y}$ at this point uses the adjacent pressure nodes $p_{i,j}$ and $p_{i,j+1}$. This defines the $y$-component of the discrete gradient:\n    $$(\\boldsymbol{G}p)_{i,j+\\frac{1}{2}} = \\frac{p_{i,j+1} - p_{i,j}}{h_y}$$\n    The operator $\\boldsymbol{G}$ thus maps a scalar field at cell centers to a vector field at cell faces.\n\n2.  **Discrete Divergence Operator $D$**\n    The incompressibility constraint, $\\nabla \\cdot \\boldsymbol{u} = 0$, is enforced at the cell centers. We derive the discrete operator by considering mass conservation for the control volume represented by cell $(i,j)$, which spans $[x_{i-\\frac{1}{2}}, x_{i+\\frac{1}{2}}] \\times [y_{j-\\frac{1}{2}}, y_{j+\\frac{1}{2}}]$. Integrating the continuity equation over this cell's volume (or area in $2$D) $\\Omega_{i,j}$:\n    $$\\iint_{\\Omega_{i,j}} (\\nabla \\cdot \\boldsymbol{u}) \\,dx\\,dy = 0$$\n    Applying the divergence theorem, this integral is converted into a flux integral over the boundary $\\partial \\Omega_{i,j}$:\n    $$\\oint_{\\partial \\Omega_{i,j}} \\boldsymbol{u} \\cdot \\boldsymbol{n} \\,ds = 0$$\n    Approximating the flux across each of the four faces of the cell using the face-centered velocity values, we get:\n    $$(u_{i+\\frac{1}{2},j}h_y) - (u_{i-\\frac{1}{2},j}h_y) + (v_{i,j+\\frac{1}{2}}h_x) - (v_{i,j-\\frac{1}{2}}h_x) = 0$$\n    Dividing by the cell area $h_x h_y$, we obtain the discrete divergence equation. This defines the action of the discrete divergence operator $D$ on a face-centered vector field $\\boldsymbol{u}$:\n    $$(D\\boldsymbol{u})_{i,j} = \\frac{u_{i+\\frac{1}{2},j} - u_{i-\\frac{1}{2},j}}{h_x} + \\frac{v_{i,j+\\frac{1}{2}} - v_{i,j-\\frac{1}{2}}}{h_y}$$\n    This operator maps a vector field at cell faces to a scalar field at cell centers. The equation $(D\\boldsymbol{u})_{i,j} = 0$ enforces exact discrete mass conservation for each cell.\n\n3.  **Adjoint Relationship between $D$ and $\\boldsymbol{G}$**\n    The operators $D$ and $\\boldsymbol{G}$ are negative adjoints of each other ($D = -\\boldsymbol{G}^T$) with respect to appropriate discrete inner products. Let the inner product for cell-centered scalars be $\\langle q, p \\rangle_c = \\sum_{i,j} q_{i,j} p_{i,j} h_x h_y$ and for face-centered vectors be $\\langle \\boldsymbol{w}, \\boldsymbol{u} \\rangle_f = \\sum_{i,j} w_{x, i+\\frac{1}{2},j} u_{i+\\frac{1}{2},j} h_x h_y + \\sum_{i,j} w_{y, i,j+\\frac{1}{2}} u_{i,j+\\frac{1}{2}} h_x h_y$. We examine $\\langle p, D\\boldsymbol{u} \\rangle_c$:\n    $$\\langle p, D\\boldsymbol{u} \\rangle_c = \\sum_{i,j} p_{i,j} \\left( \\frac{u_{i+\\frac{1}{2},j} - u_{i-\\frac{1}{2},j}}{h_x} + \\frac{v_{i,j+\\frac{1}{2}} - v_{i,j-\\frac{1}{2}}}{h_y} \\right) h_x h_y$$\n    Using summation by parts on the first term (summing over $i$):\n    $$\\sum_{i,j} p_{i,j} (u_{i+\\frac{1}{2},j} - u_{i-\\frac{1}{2},j}) = \\sum_j \\left( \\sum_i p_{i,j} u_{i+\\frac{1}{2},j} - \\sum_i p_{i,j} u_{i-\\frac{1}{2},j} \\right)$$\n    By re-indexing the second sum ($i \\to i+1$), this becomes $\\sum_{i,j} (p_{i,j} - p_{i+1,j}) u_{i+\\frac{1}{2},j}$, assuming boundary terms vanish. This is valid if, for instance, the normal component of velocity is zero at the boundaries.\n    The sum becomes:\n    $$\\sum_{i,j} p_{i,j} (u_{i+\\frac{1}{2},j} - u_{i-\\frac{1}{2},j}) = - \\sum_{i,j} \\left(\\frac{p_{i+1,j} - p_{i,j}}{h_x}\\right) u_{i+\\frac{1}{2},j} h_x$$\n    Applying the same logic to the $v$ terms and substituting back into the inner product expression:\n    $$\\langle p, D\\boldsymbol{u} \\rangle_c = - \\sum_{i,j} \\left(\\frac{p_{i+1,j} - p_{i,j}}{h_x}\\right) u_{i+\\frac{1}{2},j} h_x h_y - \\sum_{i,j} \\left(\\frac{p_{i,j+1} - p_{i,j}}{h_y}\\right) v_{i,j+\\frac{1}{2}} h_x h_y$$\n    $$\\langle p, D\\boldsymbol{u} \\rangle_c = - \\left( \\sum_{i,j} (\\boldsymbol{G}p)_{i+\\frac{1}{2},j} u_{i+\\frac{1}{2},j} h_x h_y + \\sum_{i,j} (\\boldsymbol{G}p)_{i,j+\\frac{1}{2}} v_{i,j+\\frac{1}{2}} h_x h_y \\right) = - \\langle \\boldsymbol{G}p, \\boldsymbol{u} \\rangle_f$$\n    This confirms the negative adjoint relationship.\n\n4.  **Discrete Laplacian Operator $L = D\\boldsymbol{G}$**\n    The discrete Laplacian $L$ acting on a cell-centered scalar $p$ is constructed by composing the divergence and gradient operators: $Lp = D(\\boldsymbol{G}p)$.\n    Let $\\boldsymbol{w} = \\boldsymbol{G}p$. The components of $\\boldsymbol{w}$ are $w_{x, i\\pm\\frac{1}{2},j} = (\\boldsymbol{G}p)_{i\\pm\\frac{1}{2},j}$ and $w_{y, i,j\\pm\\frac{1}{2}} = (\\boldsymbol{G}p)_{i,j\\pm\\frac{1}{2}}$.\n    Applying the divergence operator $D$ to $\\boldsymbol{w}$:\n    $$(Lp)_{i,j} = (D\\boldsymbol{w})_{i,j} = \\frac{w_{x, i+\\frac{1}{2},j} - w_{x, i-\\frac{1}{2},j}}{h_x} + \\frac{w_{y, i,j+\\frac{1}{2}} - w_{y, i,j-\\frac{1}{2}}}{h_y}$$\n    Substitute the expressions for the components of $\\boldsymbol{G}p$:\n    $$w_{x, i+\\frac{1}{2},j} = \\frac{p_{i+1,j} - p_{i,j}}{h_x}, \\quad w_{x, i-\\frac{1}{2},j} = \\frac{p_{i,j} - p_{i-1,j}}{h_x}$$\n    $$w_{y, i,j+\\frac{1}{2}} = \\frac{p_{i,j+1} - p_{i,j}}{h_y}, \\quad w_{y, i,j-\\frac{1}{2}} = \\frac{p_{i,j} - p_{i,j-1}}{h_y}$$\n    Substituting these into the expression for $(Lp)_{i,j}$:\n    $$(Lp)_{i,j} = \\frac{1}{h_x}\\left(\\frac{p_{i+1,j} - p_{i,j}}{h_x} - \\frac{p_{i,j} - p_{i-1,j}}{h_x}\\right) + \\frac{1}{h_y}\\left(\\frac{p_{i,j+1} - p_{i,j}}{h_y} - \\frac{p_{i,j} - p_{i,j-1}}{h_y}\\right)$$\n    $$(Lp)_{i,j} = \\frac{p_{i+1,j} - 2p_{i,j} + p_{i-1,j}}{h_x^2} + \\frac{p_{i,j+1} - 2p_{i,j} + p_{i,j-1}}{h_y^2}$$\n    This is the standard second-order accurate $5$-point stencil for the Laplacian operator on a Cartesian grid. The operator $-L = -D\\boldsymbol{G}$ is symmetric and positive semidefinite, ensuring a well-behaved pressure Poisson system.\n\n5.  **inf-sup Stability and Incompressibility**\n    The MAC grid provides a stable coupling between pressure and velocity spaces, satisfying the discrete inf-sup (or LBB) condition. This is crucial for avoiding spurious, non-physical pressure modes (e.g., checkerboard oscillations) that can plague colocated grid arrangements. The staggered placement ensures that the null space of the discrete gradient operator $\\boldsymbol{G}$ contains only constant pressure fields, which mirrors the continuous case and prevents unphysical pressure solutions. The discrete divergence operator $D$ is constructed from a flux balance, meaning the condition $D\\boldsymbol{u}=0$ enforces mass conservation exactly on each discrete control volume, which is a major strength of this method. The combination of exact discrete conservation and inf-sup stability makes the MAC scheme a robust choice for incompressible flow problems like mantle convection.", "answer": "$$\\boxed{\\pmatrix{ \\frac{p_{i+1,j} - p_{i,j}}{h_x} & \\frac{p_{i,j+1} - p_{i,j}}{h_y} & \\frac{u_{i+\\frac{1}{2},j} - u_{i-\\frac{1}{2},j}}{h_x} + \\frac{v_{i,j+\\frac{1}{2}} - v_{i,j-\\frac{1}{2}}}{h_y} & \\frac{p_{i+1,j} - 2p_{i,j} + p_{i-1,j}}{h_x^2} + \\frac{p_{i,j+1} - 2p_{i,j} + p_{i,j-1}}{h_y^2} }}$$", "id": "3610769"}, {"introduction": "In a convection model, the velocity and temperature fields are intimately coupled: the temperature field creates buoyancy forces that drive flow, and the flow field advects the temperature. In the Earth's mantle, this transport is strongly advection-dominated, a regime characterized by a high Péclet number ($Pe \\gg 1$) where standard numerical methods can fail. This practice [@problem_id:3610749] uses modified equation analysis to dissect and compare different numerical schemes for the advection term, revealing the critical trade-offs between accuracy, stability, and the introduction of numerical artifacts like artificial diffusion and dispersion.", "problem": "Consider modeling mantle convection under the Boussinesq approximation, where the temperature field satisfies the advection–diffusion–source equation $\\partial_t T + \\mathbf{u} \\cdot \\nabla T = \\kappa \\nabla^2 T + Q$, with kinematic viscosity and density independent of temperature except in the buoyancy term. In strongly advection-dominated regimes typical of Earth's mantle, the Peclet number $Pe = U L / \\kappa$ satisfies $Pe \\gg 1$, where $U$ and $L$ are characteristic velocity and length scales. To assess discretizations of the advective transport of temperature in computational geophysics, analyze the one-dimensional equation along a local streamline with constant velocity $\\partial_t T + u\\,\\partial_x T = \\kappa\\,\\partial_{xx} T + Q$ on a uniform grid of spacing $h$, where $u>0$ and $\\kappa>0$. Define the grid Peclet number $Pe_h = u h/(2 \\kappa)$.\n\nUsing a modified equation analysis based on Taylor expansions about a grid point, compare the discrete advection operators:\n- Central-difference approximation for $\\partial_x T$,\n- First-order upwind approximation for $\\partial_x T$,\n- Streamline upwind/Petrov–Galerkin (SUPG) stabilization for linear finite elements, modeled as adding a streamline-diffusion term characterized by a parameter $\\tau$ so that the method introduces an effective diffusion of the form $\\kappa_{\\text{SUPG}} = \\tau u^2$.\n\nQuantify, in terms of $h$, $u$, and $\\kappa$, the leading-order numerical diffusion and dispersion introduced by each method in the advection-dominated regime $Pe \\gg 1$. Then, determine which statements below are correct.\n\nA. For first-order upwind on a uniform grid, the leading-order equivalent numerical diffusion is $\\kappa_{\\text{num}} = u h / 2$, which reduces the effective grid Peclet number to $Pe_h^{\\text{eff}} = u h / \\big(2(\\kappa + u h/2)\\big)$ and yields a monotone scheme for any $Pe_h$.\n\nB. For central differences, the leading-order truncation error in the advective term is dispersive (odd derivative) with coefficient $u h^2/6$, i.e., it contributes a term $u (h^2/6)\\,\\partial_{xxx} T$, so there is no numerical diffusion; when $Pe_h \\gg 1$, spurious oscillations are likely unless the mesh is refined.\n\nC. For SUPG with $\\tau = h/(2u)$, the leading-order equivalent numerical diffusion is $\\kappa_{\\text{num}} = \\tau u^2 = u h/2$ and the stabilization removes dispersion entirely, leaving only diffusive leading-order truncation.\n\nD. For SUPG with $\\tau = h/u$, the equivalent numerical diffusion becomes $\\kappa_{\\text{num}} = u h$, which doubles the diffusion relative to upwind and ensures $Pe_h^{\\text{eff}} \\le 1/2$ regardless of $\\kappa$.\n\nSelect all correct options.", "solution": "The problem statement is a well-posed and standard exercise in the numerical analysis of advection-diffusion equations, a fundamental topic in computational geophysics and fluid dynamics. It is scientifically grounded, objective, and contains all necessary information to perform a modified equation analysis. The problem is therefore valid.\n\nWe are tasked with analyzing the leading-order numerical diffusion and dispersion for three different spatial discretizations of the one-dimensional advection-diffusion equation:\n$$ \\partial_t T + u\\,\\partial_x T = \\kappa\\,\\partial_{xx} T + Q $$\nwhere $u > 0$ and $\\kappa > 0$. The analysis will be performed using Taylor series expansions around a grid point $x_j$, where $T_j = T(x_j, t)$. The relevant expansions are:\n$$ T_{j\\pm 1} = T_j \\pm h\\,\\partial_x T \\Big|_j + \\frac{h^2}{2!}\\,\\partial_{xx} T \\Big|_j \\pm \\frac{h^3}{3!}\\,\\partial_{xxx} T \\Big|_j + \\frac{h^4}{4!}\\,\\partial_{xxxx} T \\Big|_j \\pm \\dots $$\nThe modified equation is derived by substituting the Taylor series expansions of the discrete operators into the semi-discretized equation and collecting terms. This reveals the partial differential equation that the numerical scheme is actually solving, including its error terms. Error terms with even-order spatial derivatives (e.g., $\\partial_{xx} T$) are diffusive, while terms with odd-order spatial derivatives (e.g., $\\partial_{xxx} T$) are dispersive.\n\nFor all cases, we assume the diffusion term $\\kappa\\,\\partial_{xx} T$ is approximated by the standard second-order central difference, which has a leading-order truncation error of $O(h^2)$:\n$$ \\kappa\\,\\partial_{xx} T \\Big|_j \\approx \\kappa \\frac{T_{j+1} - 2T_j + T_{j-1}}{h^2} = \\kappa \\left( \\partial_{xx} T + \\frac{h^2}{12} \\partial_{xxxx} T + O(h^4) \\right) \\Big|_j $$\n\nWe analyze each option by examining the discretization of the advection term $u\\,\\partial_x T$.\n\nA. **First-order upwind approximation**\nSince $u>0$, the first-order upwind approximation for the advection term at node $j$ is:\n$$ u\\,\\partial_x T \\Big|_j \\approx u\\,\\frac{T_j - T_{j-1}}{h} $$\nUsing the Taylor expansion for $T_{j-1}$:\n$$ u\\,\\frac{T_j - T_{j-1}}{h} = u\\,\\frac{1}{h} \\left( T_j - \\left(T_j - h\\,\\partial_x T + \\frac{h^2}{2}\\,\\partial_{xx} T - O(h^3)\\right) \\right) = u\\,\\partial_x T - \\frac{u h}{2}\\,\\partial_{xx} T + O(h^2) $$\nThe leading-order truncation error introduced by this approximation is $+(\\frac{u h}{2})\\,\\partial_{xx} T$. This is a diffusive term, equivalent to adding a numerical diffusion coefficient $\\kappa_{\\text{num}} = u h/2$.\nThe modified equation's effective diffusion coefficient is $\\kappa_{\\text{eff}} = \\kappa + \\kappa_{\\text{num}} = \\kappa + u h/2$.\nThe problem defines the grid Peclet number as $Pe_h = u h/(2 \\kappa)$. The effective grid Peclet number is:\n$$ Pe_h^{\\text{eff}} = \\frac{u h}{2 \\kappa_{\\text{eff}}} = \\frac{u h}{2\\left(\\kappa + \\frac{u h}{2}\\right)} $$\nThis matches the expression given in the option. A key feature of the first-order upwind scheme is its inherent numerical diffusion, which prevents the formation of spurious oscillations, making the resulting solution monotone regardless of the grid Peclet number $Pe_h$ (provided the time-stepping is stable). Thus, all parts of the statement are correct.\n**Verdict: Correct**\n\nB. **Central-difference approximation**\nThe second-order central-difference approximation for the advection term is:\n$$ u\\,\\partial_x T \\Big|_j \\approx u\\,\\frac{T_{j+1} - T_{j-1}}{2h} $$\nUsing Taylor expansions for $T_{j+1}$ and $T_{j-1}$:\n$$ u\\,\\frac{T_{j+1} - T_{j-1}}{2h} = u\\,\\frac{1}{2h} \\left( (T_j + h\\,\\partial_x T + \\frac{h^2}{2}\\,\\partial_{xx} T + \\frac{h^3}{6}\\,\\partial_{xxx} T + \\dots) - (T_j - h\\,\\partial_x T + \\frac{h^2}{2}\\,\\partial_{xx} T - \\frac{h^3}{6}\\,\\partial_{xxx} T + \\dots) \\right) $$\n$$ = u\\,\\frac{1}{2h} \\left( 2h\\,\\partial_x T + \\frac{h^3}{3}\\,\\partial_{xxx} T + O(h^5) \\right) = u\\,\\partial_x T + \\frac{u h^2}{6}\\,\\partial_{xxx} T + O(h^4) $$\nThe leading-order error term is of order $O(h^2)$ and involves the third derivative, $\\partial_{xxx} T$. This is a dispersive error, not a diffusive one. There is no leading-order (i.e., $O(h)$ or $O(h^2)$) numerical diffusion term proportional to $\\partial_{xx} T$. The statement that the leading-order truncation error contributes a term proportional to $u (h^2/6)\\,\\partial_{xxx} T$ is correct (the sign depends on convention, but the form and magnitude are correct). The absence of numerical diffusion in this scheme is known to cause non-physical oscillations, particularly in advection-dominated regimes ($Pe_h \\gg 1$) where the physical diffusion is too small to damp them. This necessitates grid refinement to reduce $h$ until stability is achieved (typically $Pe_h \\le 1$). The statement is fully consistent with standard analysis.\n**Verdict: Correct**\n\nC. **Streamline upwind/Petrov–Galerkin (SUPG) with $\\tau = h/(2u)$**\nThe SUPG method is based on a Galerkin finite element formulation (which behaves like a central difference scheme) and adds an artificial diffusion term for stabilization. The modified equation for linear elements is approximately:\n$$ \\partial_t T + u \\partial_x T - (\\kappa + \\kappa_{\\text{SUPG}}) \\partial_{xx} T + \\dots = u \\left(\\frac{h^2}{6} - \\tau u \\right) \\partial_{xxx} T + \\dots $$\nwhere the numerical diffusion is $\\kappa_{\\text{SUPG}} = \\tau u^2$. This shows that SUPG adds diffusion while simultaneously modifying the leading-order dispersion from the underlying Galerkin method.\nThe option considers the choice $\\tau = h/(2u)$.\nThe numerical diffusion is $\\kappa_{\\text{num}} = \\tau u^2 = \\left(\\frac{h}{2u}\\right) u^2 = \\frac{u h}{2}$. This part of the statement is correct.\nNext, we check the claim that this choice \"removes dispersion entirely\". The coefficient of the leading-order dispersive term $\\partial_{xxx} T$ becomes:\n$$ u \\left(\\frac{h^2}{6} - \\tau u \\right) = u \\left(\\frac{h^2}{6} - \\left(\\frac{h}{2u}\\right) u \\right) = u \\left(\\frac{h^2}{6} - \\frac{h^2}{2}\\right) = -u \\frac{h^2}{3} $$\nThe coefficient is non-zero. Therefore, dispersion is not removed. In fact, its magnitude is increased compared to the original central-difference scheme. The statement's claim that dispersion is removed is false. To remove the leading dispersive error, one would need to choose $\\tau = h^2/(6u)$.\n**Verdict: Incorrect**\n\nD. **Streamline upwind/Petrov–Galerkin (SUPG) with $\\tau = h/u$**\nWe analyze this specific choice of $\\tau$ as requested.\nFirst, we find the equivalent numerical diffusion:\n$$ \\kappa_{\\text{num}} = \\tau u^2 = \\left(\\frac{h}{u}\\right) u^2 = u h $$\nThe numerical diffusion for the first-order upwind scheme is $\\kappa_{\\text{upwind}} = u h/2$. So, $\\kappa_{\\text{num}} = u h = 2 \\kappa_{\\text{upwind}}$. The statement that this choice doubles the diffusion relative to upwind is correct.\nNext, we check the claim about the effective grid Peclet number, $Pe_h^{\\text{eff}}$.\n$$ Pe_h^{\\text{eff}} = \\frac{u h}{2 \\kappa_{\\text{eff}}} = \\frac{u h}{2(\\kappa + \\kappa_{\\text{num}})} = \\frac{u h}{2(\\kappa + u h)} $$\nThe claim is $Pe_h^{\\text{eff}} \\le 1/2$. Let's test this inequality:\n$$ \\frac{u h}{2(\\kappa + u h)} \\le \\frac{1}{2} $$\nMultiplying both sides by $2(\\kappa + u h)$ (which is positive since $\\kappa > 0, u > 0, h > 0$):\n$$ u h \\le \\kappa + u h $$\n$$ 0 \\le \\kappa $$\nThis inequality is true according to the problem statement ($\\kappa > 0$). Therefore, this choice of $\\tau$ indeed ensures that the effective grid Peclet number is kept below $1/2$, which guarantees a stable, non-oscillatory scheme. All parts of the statement are mathematically correct consequences of the given parameter choice.\n**Verdict: Correct**\n\nIn summary, statements A, B, and D are correct, while statement C is incorrect.", "answer": "$$\\boxed{ABD}$$", "id": "3610749"}]}