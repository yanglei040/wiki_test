{"hands_on_practices": [{"introduction": "The most fundamental departure from isotropic wave propagation lies in the nature of the wave's polarization. In an anisotropic medium, the modes we think of as P-waves and S-waves become 'quasi-compressional' (qP) and 'quasi-shear' (qS), as their particle motion is generally neither purely parallel nor purely perpendicular to the direction of wavefront propagation. This practice [@problem_id:3575984] provides a foundational exercise in quantifying this phenomenon by calculating the polarization vectors directly from the Christoffel equation and measuring their 'tilt' relative to the propagation direction.", "problem": "You are to implement a complete, self-contained program that, for a transversely isotropic elastic medium with a vertical symmetry axis (vertical transverse isotropy), computes the quasi-compressional (qP) and quasi-shear vertical (qSV) polarization vectors from first principles and reports how much these polarizations tilt relative to the phase normal as a function of the polar angle. Your derivation and implementation must begin from the linear elastodynamic equation and the constitutive relation of linear elasticity, and proceed through the plane-wave ansatz and the Christoffel formulation, without invoking pre-packaged shortcut formulas for anisotropic waves. The computational approach must be general and must determine the polarizations as eigenvectors of the Christoffel matrix constructed for the specified symmetry and propagation direction. The classification of modes must be done by logical, physics-based criteria rather than by assuming isotropic-like ordering.\n\nFundamental base:\n- Linear elastodynamics and Hooke’s law in index notation: the balance of linear momentum for small deformations in an elastic medium is given by $c_{ijkl} \\, \\partial_j \\partial_l u_k = \\rho \\, \\partial_t^2 u_i$, where $u_i$ is displacement, $\\rho$ is mass density, and $c_{ijkl}$ is the fourth-order stiffness tensor with the minor and major symmetries appropriate to linear elasticity.\n- Plane-wave ansatz: seek solutions of the form $u_i(\\mathbf{x},t) = A_i \\exp\\left(i \\omega \\left(t - \\mathbf{n} \\cdot \\mathbf{x} / v\\right)\\right)$, where $\\omega$ is angular frequency, $v$ is phase velocity, and $\\mathbf{n}$ is the unit phase-normal (direction of wavefront normal).\n- Christoffel formulation: substitution of the plane-wave ansatz yields the eigenproblem $\\Gamma_{ik} A_k = \\rho v^2 A_i$ with the Christoffel matrix $\\Gamma_{ik} = c_{ijkl} n_j n_l$.\n\nSetup and constraints:\n- The symmetry class is vertical transverse isotropy (VTI) with symmetry axis aligned with the $z$ axis. Use Voigt notation to parameterize the stiffness tensor by the independent components $\\{c_{11}, c_{33}, c_{44}, c_{66}, c_{13}\\}$ and enforce the VTI identity $c_{66} = \\left(c_{11} - c_{12}\\right)/2$, which determines $c_{12} = c_{11} - 2 c_{66}$.\n- Consider propagation restricted to the $x$–$z$ plane due to axisymmetry, with the unit phase-normal $\\mathbf{n}$ parametrized by the polar angle $\\theta$ measured from the $z$ axis (the symmetry axis). Use $\\mathbf{n}(\\theta) = \\left(\\sin \\theta, 0, \\cos \\theta\\right)$.\n- For each propagation direction, form the Christoffel matrix from first principles using the above definitions and solve the resulting $3 \\times 3$ eigenproblem to obtain three wave modes and their polarization vectors. Among these modes, identify the SH mode as the one whose polarization has the largest magnitude of the $y$ component; the remaining two modes are the qP and qSV. Among these remaining two, identify the qP mode as the mode whose polarization has the largest absolute inner product with the phase normal $\\mathbf{n}$; the other is the qSV mode.\n- For each mode of interest (qP and qSV), define the tilt angle $\\alpha$ as the acute angle in $[0, \\pi/2]$ between the unit polarization vector and $\\mathbf{n}$, given by $\\alpha = \\arccos\\left(\\left| \\hat{\\mathbf{a}} \\cdot \\mathbf{n} \\right|\\right)$, where $\\hat{\\mathbf{a}}$ is the unit polarization vector. Report tilt angles in degrees.\n\nAngle units and physical units:\n- Angles $\\theta$ are specified in degrees, and all tilt angles must be reported in degrees.\n- Stiffnesses $c_{ij}$ are in pascals (Pa) and density $\\rho$ is in kilograms per cubic meter (kg/m$^3$). The program will not directly output velocities, but the physics must be consistent dimensionally.\n\nTest suite:\nFor each test case, compute the qP and qSV tilt angles for the polar angles $\\theta \\in \\{0^\\circ, 30^\\circ, 60^\\circ, 90^\\circ\\}$.\n\n- Test Case 1 (Isotropic reference embedded in VTI form):\n  - $\\rho = 2500 \\ \\text{kg/m}^3$\n  - $c_{11} = 80 \\times 10^9 \\ \\text{Pa}$, $c_{33} = 80 \\times 10^9 \\ \\text{Pa}$, $c_{44} = 30 \\times 10^9 \\ \\text{Pa}$, $c_{66} = 30 \\times 10^9 \\ \\text{Pa}$, $c_{13} = 20 \\times 10^9 \\ \\text{Pa}$\n  - This corresponds to Lamé parameters $\\lambda = 20 \\times 10^9 \\ \\text{Pa}$ and $\\mu = 30 \\times 10^9 \\ \\text{Pa}$.\n\n- Test Case 2 (Weak VTI):\n  - $\\rho = 2400 \\ \\text{kg/m}^3$\n  - $c_{11} = 60 \\times 10^9 \\ \\text{Pa}$, $c_{33} = 55 \\times 10^9 \\ \\text{Pa}$, $c_{44} = 20 \\times 10^9 \\ \\text{Pa}$, $c_{66} = 25 \\times 10^9 \\ \\text{Pa}$, $c_{13} = 18 \\times 10^9 \\ \\text{Pa}$\n  - Enforce $c_{12} = c_{11} - 2 c_{66} = 10 \\times 10^9 \\ \\text{Pa}$.\n\n- Test Case 3 (Strong VTI):\n  - $\\rho = 2700 \\ \\text{kg/m}^3$\n  - $c_{11} = 100 \\times 10^9 \\ \\text{Pa}$, $c_{33} = 50 \\times 10^9 \\ \\text{Pa}$, $c_{44} = 15 \\times 10^9 \\ \\text{Pa}$, $c_{66} = 35 \\times 10^9 \\ \\text{Pa}$, $c_{13} = 12 \\times 10^9 \\ \\text{Pa}$\n  - Enforce $c_{12} = c_{11} - 2 c_{66} = 30 \\times 10^9 \\ \\text{Pa}$.\n\nRequired outputs:\n- For each test case, output two lists of floats (in degrees), each of length $4$ corresponding to $\\theta = [0, 30, 60, 90]$ degrees, rounded to six decimal places:\n  1. The list of qP tilt angles.\n  2. The list of qSV tilt angles.\n- Aggregate the results for all test cases into a single top-level list of length $3$, where each element is the pair of lists described above.\n- Final output format: Your program should produce a single line of output containing the nested list with no spaces, using comma-separated values and square brackets. For example, the overall structure must be like: [[[qP_case1],[qSV_case1]],[[qP_case2],[qSV_case2]],[[qP_case3],[qSV_case3]]], where each bracketed block contains the four rounded floats for the specified angles.\n\nConstraints and notes:\n- The program must be standalone and must not require any external input; it must compute and print the specified nested list for the three test cases as a single line.\n- The program must compute polarizations and tilt strictly by solving the Christoffel eigenproblem for each direction and classifying the modes as specified.\n- All angles supplied and reported must be in degrees. All reported floats must be rounded to six decimal places.", "solution": "The problem requires the calculation of quasi-compressional (qP) and quasi-shear vertical (qSV) wave polarization tilt angles in a transversely isotropic medium with a vertical axis of symmetry (VTI). The calculation must start from first principles of linear elasticity and be performed for several propagation directions and sets of elastic parameters.\n\n### Principle-Based Derivation and Algorithmic Design\n\n**1. Elastodynamic Wave Equation and the Plane-Wave Ansatz**\n\nThe fundamental governing equation for small-amplitude elastic waves in a continuous medium is the linear elastodynamic equation, which represents a balance of linear momentum. In index notation, it is:\n$$\n\\partial_j \\sigma_{ij} = \\rho \\, \\partial_t^2 u_i\n$$\nwhere $\\sigma_{ij}$ is the second-order stress tensor, $u_i$ is the displacement vector, $\\rho$ is the mass density, $t$ is time, and $\\partial_j$ denotes the partial derivative with respect to the spatial coordinate $x_j$. The summation convention over repeated indices is implied.\n\nThe stress tensor is related to the strain tensor $\\epsilon_{kl} = \\frac{1}{2}(\\partial_l u_k + \\partial_k u_l)$ through the constitutive relation of linear elasticity, or Hooke's Law:\n$$\n\\sigma_{ij} = c_{ijkl} \\epsilon_{kl}\n$$\nHere, $c_{ijkl}$ is the fourth-order stiffness tensor, which characterizes the elastic properties of the medium. Substituting the constitutive relation into the elastodynamic equation yields:\n$$\nc_{ijkl} \\, \\partial_j \\partial_l u_k = \\rho \\, \\partial_t^2 u_i\n$$\n\nWe seek plane-wave solutions, which describe waves with planar wavefronts. A plane-wave solution is expressed by the ansatz:\n$$\nu_i(\\mathbf{x},t) = A_i \\exp\\left(i \\omega \\left(t - \\frac{\\mathbf{n} \\cdot \\mathbf{x}}{v}\\right)\\right)\n$$\nwhere $A_i$ is the constant polarization vector defining the direction of particle motion, $\\omega$ is the angular frequency, $\\mathbf{n}$ is the unit vector normal to the wavefronts (the phase-normal), $v$ is the phase velocity, and $i = \\sqrt{-1}$.\n\n**2. The Christoffel Formulation**\n\nSubstituting the plane-wave ansatz into the elastodynamic equation involves taking derivatives of the exponential function:\n- $\\partial_l u_k = \\left(-\\frac{i\\omega}{v} n_l\\right) u_k$\n- $\\partial_j \\partial_l u_k = \\left(-\\frac{i\\omega}{v} n_j\\right) \\left(-\\frac{i\\omega}{v} n_l\\right) u_k = -\\frac{\\omega^2}{v^2} n_j n_l u_k$\n- $\\partial_t^2 u_i = (i\\omega)^2 u_i = -\\omega^2 u_i$\n\nSubstituting these derivatives into the elastodynamic equation gives:\n$$\nc_{ijkl} \\left(-\\frac{\\omega^2}{v^2} n_j n_l\\right) A_k \\exp(\\dots) = \\rho \\left(-\\omega^2\\right) A_i \\exp(\\dots)\n$$\nCanceling the common factor $-\\omega^2 \\exp(\\dots)$ and rearranging, we obtain the Christoffel equation, which is an algebraic eigenvalue problem:\n$$\n(c_{ijkl} n_j n_l) A_k = \\rho v^2 A_i\n$$\nThis can be written compactly as:\n$$\n\\Gamma_{ik} A_k = \\lambda A_i\n$$\nwhere $\\Gamma_{ik} = c_{ijkl} n_j n_l$ is the Christoffel matrix (or acoustic tensor), and the eigenvalues are $\\lambda = \\rho v^2$. For any given propagation direction $\\mathbf{n}$, this $3 \\times 3$ system yields three eigenvalues and three corresponding eigenvectors. The eigenvectors $A_i$ are the polarization vectors, and the eigenvalues determine the phase velocities of the three possible wave modes.\n\n**3. VTI Symmetry and Christoffel Matrix Construction**\n\nThe problem specifies a VTI medium with the symmetry axis aligned with the $z$-axis ($x_3$). The stiffness tensor for such a medium, expressed in $6 \\times 6$ Voigt matrix notation, is:\n$$\nC = \\begin{pmatrix}\nc_{11} & c_{12} & c_{13} & 0 & 0 & 0 \\\\\nc_{12} & c_{11} & c_{13} & 0 & 0 & 0 \\\\\nc_{13} & c_{13} & c_{33} & 0 & 0 & 0 \\\\\n0 & 0 & 0 & c_{44} & 0 & 0 \\\\\n0 & 0 & 0 & 0 & c_{44} & 0 \\\\\n0 & 0 & 0 & 0 & 0 & c_{66}\n\\end{pmatrix}\n$$\nwith the VTI-specific constraint $c_{12} = c_{11} - 2c_{66}$.\n\nDue to the axial symmetry, wave properties depend only on the polar angle $\\theta$ between the phase-normal $\\mathbf{n}$ and the symmetry axis ($z$-axis). We can thus restrict our analysis to propagation in the $x-z$ plane without loss of generality. The phase-normal vector is then $\\mathbf{n} = (\\sin\\theta, 0, \\cos\\theta)$.\n\nSubstituting the VTI stiffness components and $n_x=\\sin\\theta, n_y=0, n_z=\\cos\\theta$ into the general expression for $\\Gamma_{ik}$ yields the specific Christoffel matrix for this case:\n$$\n\\Gamma = \\begin{pmatrix}\nc_{11} \\sin^2\\theta + c_{44} \\cos^2\\theta & 0 & (c_{13}+c_{44}) \\sin\\theta \\cos\\theta \\\\\n0 & c_{66} \\sin^2\\theta + c_{44} \\cos^2\\theta & 0 \\\\\n(c_{13}+c_{44}) \\sin\\theta \\cos\\theta & 0 & c_{44} \\sin^2\\theta + c_{33} \\cos^2\\theta\n\\end{pmatrix}\n$$\nThis matrix is block-diagonal. The $(1,1)$ element of the matrix (in terms of block structure) corresponds to motion purely in the $y$-direction, decoupled from motions in the $x-z$ plane. This corresponds to the shear-horizontal (SH) wave. The remaining $2 \\times 2$ submatrix governs the coupled quasi-compressional (qP) and quasi-shear-vertical (qSV) waves, whose polarizations lie in the $x-z$ plane.\n\n**4. Mode Classification and Tilt Angle Calculation**\n\nFor each propagation direction $\\theta$, the algorithm is as follows:\n1.  **Construct $\\Gamma(\\theta)$**: Using the given elastic parameters and angle $\\theta$.\n2.  **Solve Eigenproblem**: Solve the eigenvalue problem $\\Gamma \\mathbf{A} = \\lambda \\mathbf{A}$. Since $\\Gamma$ is a real symmetric matrix, this yields three real eigenvalues and a set of three mutually orthogonal eigenvectors. We use a numerical library function (`numpy.linalg.eigh`) to obtain the eigenvalues and the corresponding normalized eigenvectors.\n3.  **Identify SH Mode**: The SH mode is characterized by polarization perpendicular to the $x-z$ plane. Its eigenvector is of the form $(0, c, 0)$, where $c$ is a normalization constant. We identify the SH mode by finding the eigenvector with the largest absolute value in its $y$-component.\n4.  **Identify qP and qSV Modes**: The remaining two eigenvectors correspond to the qP and qSV modes. The qP mode is \"quasi-longitudinal\", meaning its polarization vector is more closely aligned with the phase-normal $\\mathbf{n}$ than the qSV mode. The qSV mode is \"quasi-transverse\", with its polarization being more perpendicular to $\\mathbf{n}$. We formalize this by computing the absolute value of the dot product between each polarization vector and $\\mathbf{n}$. The mode with the larger absolute dot product is classified as qP, and the other is qSV.\n5.  **Compute Tilt Angle**: The tilt angle $\\alpha$ is the acute angle between a mode's polarization vector $\\hat{\\mathbf{a}}$ and the phase-normal $\\mathbf{n}$. It is computed using the formula:\n    $$\n    \\alpha = \\arccos(|\\hat{\\mathbf{a}} \\cdot \\mathbf{n}|)\n    $$\n    The result from `arccos` is in radians and must be converted to degrees for the final output. For the qP and qSV modes, since their polarization vectors are orthogonal and lie in the same plane as $\\mathbf{n}$, their tilt angles satisfy the relation $\\alpha_{\\text{qP}} + \\alpha_{\\text{qSV}} = 90^\\circ$. This serves as a valuable consistency check. For propagation along symmetry axes ($\\theta = 0^\\circ$ and $\\theta = 90^\\circ$), the waves are pure modes (P, SV, SH), resulting in tilt angles of $0^\\circ$ for qP and $90^\\circ$ for qSV. An isotropic medium (Test Case 1) also exhibits pure modes, meaning these tilt angles should hold for all propagation directions.\n\nThis detailed, first-principles-based procedure is implemented for each test case to compute the required tilt angles.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the computation for all test cases and print the final result.\n    \"\"\"\n    \n    # Test cases defined as (density, c11, c33, c44, c66, c13).\n    # Stiffnesses are in GPa; they will be scaled by 1e9 in the calculation function.\n    test_cases = [\n        # Test Case 1 (Isotropic reference)\n        (2500, 80e9, 80e9, 30e9, 30e9, 20e9),\n        # Test Case 2 (Weak VTI)\n        (2400, 60e9, 55e9, 20e9, 25e9, 18e9),\n        # Test Case 3 (Strong VTI)\n        (2700, 100e9, 50e9, 15e9, 35e9, 12e9),\n    ]\n\n    angles_deg = [0.0, 30.0, 60.0, 90.0]\n    \n    all_results = []\n    for params in test_cases:\n        qp_tilts, qsv_tilts = compute_tilts(params, angles_deg)\n        all_results.append((qp_tilts, qsv_tilts))\n\n    # Format the final output string to match the exact requirement:\n    # [[[qP_case1],[qSV_case1]],[[qP_case2],[qSV_case2]],[[qP_case3],[qSV_case3]]]\n    # with no spaces and 6 decimal places for each number.\n    case_strings = []\n    for qp_tilts, qsv_tilts in all_results:\n        # Format lists of floats to strings with 6 decimal places\n        qp_str = '[' + ','.join(f'{x:.6f}' for x in qp_tilts) + ']'\n        qsv_str = '[' + ','.join(f'{x:.6f}' for x in qsv_tilts) + ']'\n        case_strings.append(f'[{qp_str},{qsv_str}]')\n    \n    final_output = '[' + ','.join(case_strings) + ']'\n    print(final_output)\n\ndef compute_tilts(params, angles_deg):\n    \"\"\"\n    Computes qP and qSV tilt angles for a given VTI medium and a list of propagation angles.\n\n    Args:\n        params (tuple): A tuple containing material properties (rho, c11, c33, c44, c66, c13).\n        angles_deg (list): A list of polar angles in degrees.\n\n    Returns:\n        tuple: A tuple of two lists: (qP_tilt_angles, qSV_tilt_angles) in degrees.\n    \"\"\"\n    _rho, c11, c33, c44, c66, c13 = params\n    \n    qp_tilts_deg = []\n    qsv_tilts_deg = []\n\n    for theta_deg in angles_deg:\n        theta_rad = np.radians(theta_deg)\n        s = np.sin(theta_rad)\n        c = np.cos(theta_rad)\n        \n        # Phase normal vector n\n        n = np.array([s, 0, c])\n\n        # Construct the 3x3 Christoffel matrix Gamma for VTI media\n        Gamma = np.zeros((3, 3))\n        Gamma[0, 0] = c11 * s**2 + c44 * c**2\n        Gamma[1, 1] = c66 * s**2 + c44 * c**2\n        Gamma[2, 2] = c44 * s**2 + c33 * c**2\n        Gamma[0, 2] = (c13 + c44) * s * c\n        Gamma[2, 0] = Gamma[0, 2]\n        \n        # Solve the eigenproblem for the symmetric Christoffel matrix\n        # eigvecs[:, i] is the normalized eigenvector corresponding to eigvals[i]\n        _eigvals, eigvecs = np.linalg.eigh(Gamma)\n\n        # Classify modes\n        pol_vectors = [eigvecs[:, i] for i in range(3)]\n        \n        # 1. Identify SH mode (polarization with largest y-component)\n        sh_idx = np.argmax(np.abs(eigvecs[1, :]))\n\n        # 2. Identify qP and qSV modes from the remaining two\n        p_sv_indices = [i for i in range(3) if i != sh_idx]\n        \n        vec1 = pol_vectors[p_sv_indices[0]]\n        vec2 = pol_vectors[p_sv_indices[1]]\n        \n        dot_prod1 = np.abs(np.dot(vec1, n))\n        dot_prod2 = np.abs(np.dot(vec2, n))\n        \n        if dot_prod1 > dot_prod2:\n            # vec1 is qP, vec2 is qSV\n            cos_alpha_qp = dot_prod1\n            cos_alpha_qsv = dot_prod2\n        else:\n            # vec2 is qP, vec1 is qSV\n            cos_alpha_qp = dot_prod2\n            cos_alpha_qsv = dot_prod1\n            \n        # 3. Calculate tilt angles in degrees\n        # np.arccos can receive values slightly > 1.0 due to float precision, so we clip.\n        alpha_qp_rad = np.arccos(np.clip(cos_alpha_qp, -1.0, 1.0))\n        alpha_qsv_rad = np.arccos(np.clip(cos_alpha_qsv, -1.0, 1.0))\n        \n        qp_tilts_deg.append(np.degrees(alpha_qp_rad))\n        qsv_tilts_deg.append(np.degrees(alpha_qsv_rad))\n        \n    return qp_tilts_deg, qsv_tilts_deg\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3575984"}, {"introduction": "Having explored the fundamental nature of anisotropic polarization, a critical next step is to understand how this property affects seismic observables. This exercise [@problem_id:3576014] bridges this gap by tasking you with computing the travel time of a qP-wave through a layered anisotropic medium. By implementing a straight-ray approximation—a common simplification used to isolate the effect of velocity anisotropy—and comparing the result to an isotropic model, you will directly quantify the kinematic impact of anisotropy, a key effect observed in seismic survey data.", "problem": "You are tasked with deriving and implementing a computational method to evaluate quasi-compressional wave (qP) travel times in a horizontally layered, transversely isotropic medium with a vertical symmetry axis (Vertical Transverse Isotropy, VTI) and, for one designated case, a horizontal symmetry axis (Horizontal Transverse Isotropy, HTI). The goal is to integrate the anisotropic eikonal along a fixed straight source-to-receiver path, and to compare the resulting qP travel time against an isotropic prediction to quantify the timing difference driven by anisotropy.\n\nStart from the following fundamental base:\n- The plane-wave propagation in an elastic anisotropic medium is governed by the Christoffel equation, which for a given propagation direction with unit normal components $n_x$ and $n_z$ in the $x\\!-\\!z$ plane yields mode-dependent phase velocities via the eigenvalue problem of the Christoffel matrix. The quasi-compressional (qP) mode corresponds to the largest eigenvalue.\n- The eikonal integral for travel time along a prescribed path with differential arc length $\\mathrm{d}\\ell$ is $T = \\int s(\\theta)\\,\\mathrm{d}\\ell$, where $s(\\theta)$ is the direction-dependent phase slowness $s(\\theta) = 1/v_{\\text{phase}}(\\theta)$ and $\\theta$ is the angle between the propagation direction and the symmetry axis of the medium.\n- For a straight path through horizontally layered media with total receiver depth $Z_R$ and horizontal offset $X$, the path direction unit vector is $d = \\left(\\frac{X}{\\sqrt{X^2 + Z_R^2}},\\,\\frac{Z_R}{\\sqrt{X^2 + Z_R^2}}\\right)$, so the path length inside layer $i$ of thickness $h_i$ is $\\ell_i = h_i/d_z$, where $d_z$ is the vertical component of $d$. The anisotropic travel time is then $T_{\\text{aniso}} = \\sum_i \\ell_i\\,s_i(\\theta_i)$, while the isotropic prediction uses $s_i^{\\text{iso}} = 1/\\alpha_{0,i}$, with $\\alpha_{0,i}$ the vertical $P$-wave velocity in layer $i$, yielding $T_{\\text{iso}}=\\sum_i \\ell_i\\,s_i^{\\text{iso}}$.\n\nUse the following widely accepted parameterization in terms of Thomsen parameters for transversely isotropic media:\n- Let $\\alpha_0$ be the vertical $P$-wave velocity, $\\beta_0$ be the vertical $S$-wave velocity, $\\epsilon$ and $\\delta$ be Thomsen anisotropy parameters, and $\\rho$ be density. Define the stiffness-like quantities (mass-density scaled) for use in the Christoffel formulation:\n  $$C = \\rho\\,\\alpha_0^2,\\quad L = \\rho\\,\\beta_0^2,\\quad A = \\rho\\,\\alpha_0^2\\,(1 + 2\\epsilon),$$\n  and determine $F$ from $\\delta$ via\n  $$\\delta = \\frac{(F+L)^2 - (C - L)^2}{2\\,C\\,(C - L)}\\quad\\Rightarrow\\quad F = -L + \\sqrt{(C - L)^2 + 2\\,\\delta\\,C\\,(C - L)}.$$\nThese relations parameterize a Transversely Isotropic (TI) medium in the $x\\!-\\!z$ plane. For a VTI layer (symmetry axis along $z$), the propagation direction angle $\\theta$ is the angle to $z$; for an HTI layer (symmetry axis along $x$), $\\theta$ is the angle to $x$.\n\nYour implementation should:\n1. For each layer, compute the qP phase velocity $v_{\\text{phase}}(\\theta)$ by solving the Christoffel eigenproblem appropriate to the symmetry axis orientation (VTI or HTI) for propagation in the $x\\!-\\!z$ plane, using the defined quantities $A$, $C$, $L$, and $F$ and density $\\rho$.\n2. Compute the anisotropic travel time $T_{\\text{aniso}}$ along the fixed straight path by summing $s_i(\\theta_i)\\,\\ell_i$ across layers, where $\\ell_i = h_i/d_z$ and $s_i(\\theta_i) = 1/v_{\\text{phase},i}(\\theta_i)$.\n3. Compute the isotropic travel time $T_{\\text{iso}}$ along the same path using $s_i^{\\text{iso}} = 1/\\alpha_{0,i}$.\n4. Output the anisotropy-driven timing difference $\\Delta T = T_{\\text{aniso}} - T_{\\text{iso}}$.\n\nUse the following test suite, where all distances are in meters, velocities in meters per second, density in kilograms per cubic meter, angles in radians, and travel times in seconds:\n- Test 1 (single VTI layer, moderate anisotropy, oblique path):\n  - Layers: one VTI layer with $h_1 = 1000$, $\\rho_1 = 2500$, $\\alpha_{0,1} = 3000$, $\\beta_{0,1} = 1500$, $\\epsilon_1 = 0.20$, $\\delta_1 = 0.10$.\n  - Geometry: $X = 1000$, $Z_R = h_1$.\n- Test 2 (two VTI layers, small offset, modest anisotropy):\n  - Layers: \n    - Layer 1 (VTI): $h_1 = 800$, $\\rho_1 = 2400$, $\\alpha_{0,1} = 3200$, $\\beta_{0,1} = 1600$, $\\epsilon_1 = 0.15$, $\\delta_1 = 0.05$.\n    - Layer 2 (VTI): $h_2 = 1200$, $\\rho_2 = 2500$, $\\alpha_{0,2} = 3400$, $\\beta_{0,2} = 1700$, $\\epsilon_2 = 0.10$, $\\delta_2 = 0.02$.\n  - Geometry: $X = 500$, $Z_R = h_1 + h_2$.\n- Test 3 (near-isotropic VTI, oblique path; boundary check):\n  - Layers: one VTI layer with $h_1 = 1500$, $\\rho_1 = 2500$, $\\alpha_{0,1} = 3000$, $\\beta_{0,1} = 1500$, $\\epsilon_1 = 0.00$, $\\delta_1 = 0.00$.\n  - Geometry: $X = 1500$, $Z_R = h_1$.\n- Test 4 (mixed orientations: VTI over HTI, oblique path):\n  - Layers:\n    - Layer 1 (VTI): $h_1 = 800$, $\\rho_1 = 2600$, $\\alpha_{0,1} = 3300$, $\\beta_{0,1} = 1800$, $\\epsilon_1 = 0.25$, $\\delta_1 = 0.05$.\n    - Layer 2 (HTI): $h_2 = 1200$, $\\rho_2 = 2500$, $\\alpha_{0,2} = 3200$, $\\beta_{0,2} = 1700$, $\\epsilon_2 = 0.20$, $\\delta_2 = 0.10$.\n  - Geometry: $X = 2000$, $Z_R = h_1 + h_2$.\n- Test 5 (VTI, vertical path; boundary check):\n  - Layers:\n    - Layer 1 (VTI): $h_1 = 600$, $\\rho_1 = 2500$, $\\alpha_{0,1} = 3100$, $\\beta_{0,1} = 1600$, $\\epsilon_1 = 0.12$, $\\delta_1 = 0.04$.\n    - Layer 2 (VTI): $h_2 = 900$, $\\rho_2 = 2550$, $\\alpha_{0,2} = 3200$, $\\beta_{0,2} = 1650$, $\\epsilon_2 = 0.10$, $\\delta_2 = 0.05$.\n    - Layer 3 (VTI): $h_3 = 500$, $\\rho_3 = 2600$, $\\alpha_{0,3} = 3300$, $\\beta_{0,3} = 1700$, $\\epsilon_3 = 0.08$, $\\delta_3 = 0.03$.\n  - Geometry: $X = 0$, $Z_R = h_1 + h_2 + h_3$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each entry is the timing difference $\\Delta T$ for a test case, rounded to six decimal places in seconds. For example, the output format must be like $[\\Delta T_1,\\Delta T_2,\\dots]$ with each $\\Delta T_i$ a decimal number in seconds.", "solution": "The problem is subjected to validation and is determined to be valid. It is scientifically grounded in the principles of elastic wave propagation in anisotropic media, mathematically well-posed, and provides a complete and consistent set of parameters and objectives. The core task involves computing the quasi-P (qP) wave travel time difference between an anisotropic model and its isotropic reference along a prescribed straight-line path through a layered medium. This requires the derivation and solution of the Christoffel equation for transversely isotropic (TI) media.\n\nThe solution proceeds as follows:\nFirst, we establish the theoretical framework. The travel time $T$ of a wave along a path $\\mathcal{L}$ is given by the eikonal integral:\n$$T = \\int_{\\mathcal{L}} s(\\mathbf{x}, \\mathbf{n}) \\, \\mathrm{d}\\ell$$\nwhere $s$ is the phase slowness, which is the reciprocal of the phase velocity $v_{\\text{phase}}$, and $\\mathrm{d}\\ell$ is the differential arc length. The slowness depends on the location $\\mathbf{x}$ and the propagation direction $\\mathbf{n}$. The problem simplifies this by assuming a horizontally-layered medium and a fixed straight-line path from a source at $(0, 0)$ to a receiver at $(X, Z_R)$. Within each layer $i$, the material properties are constant. The propagation direction is uniform along the entire path. The unit direction vector $\\mathbf{d}$ is:\n$$ \\mathbf{d} = (d_x, d_z) = \\left( \\frac{X}{\\sqrt{X^2 + Z_R^2}}, \\frac{Z_R}{\\sqrt{X^2 + Z_R^2}} \\right) $$\nThe path length $\\ell_i$ within a layer $i$ of thickness $h_i$ is $\\ell_i = h_i / d_z$. The total travel time is a sum over the layers:\n$$ T = \\sum_{i} \\ell_i s_i(\\mathbf{d}) = \\sum_{i} \\frac{h_i}{d_z} \\frac{1}{v_{\\text{phase}, i}(\\mathbf{d})} $$\n\nThe core of the problem is to determine the qP-wave phase velocity $v_{\\text{phase}, i}$ for each layer. This velocity is obtained by solving the eigenvalue problem for the Christoffel matrix $\\mathbf{\\Gamma}$:\n$$ (\\mathbf{\\Gamma} - \\lambda \\mathbf{I})\\mathbf{u} = \\mathbf{0} \\quad \\text{with} \\quad \\lambda = \\rho v_{\\text{phase}}^2 $$\nwhere $\\rho$ is the density, $\\mathbf{u}$ is the polarization vector, and $\\mathbf{I}$ is the identity matrix. For a TI medium with its symmetry axis aligned with the $z$-coordinate axis (VTI), and for wave propagation in the $x$-$z$ plane with direction vector $\\mathbf{n} = (\\sin\\theta, 0, \\cos\\theta)$, where $\\theta$ is the phase angle with respect to the symmetry ($z$) axis, the Christoffel matrix is given by:\n$$ \\mathbf{\\Gamma} = \\begin{pmatrix} C_{11}n_x^2 + C_{55}n_z^2 & 0 & (C_{13}+C_{55})n_x n_z \\\\ 0 & C_{66}n_x^2+C_{55}n_z^2 & 0 \\\\ (C_{13}+C_{55})n_x n_z & 0 & C_{55}n_x^2 + C_{33}n_z^2 \\end{pmatrix} $$\nThe problem provides a parameterization based on Thomsen's parameters $\\epsilon$ and $\\delta$, and vertical P- and S-wave velocities, $\\alpha_0$ and $\\beta_0$. The elastic stiffness constants $C_{ij}$ are related to the provided quantities $A, C, L, F$ as follows: $A = C_{11}$, $C = C_{33}$, $L = C_{55}$, and $F = C_{13}$. The problem uses mass-density scaled versions, which is correct for the formulation $\\lambda = \\rho v^2$. The problem does not require $C_{66}$ or $C_{12}$ as the SH-wave mode (the $(2,2)$ element) decouples and is not of interest.\n\nThe remaining $2 \\times 2$ submatrix governs the coupled qP and quasi-SV (qSV) waves. Its eigenvalues $\\lambda = \\rho v^2$ are found by solving the characteristic equation. The components are:\n$$ \\Gamma_{11} = A\\sin^2\\theta + L\\cos^2\\theta $$\n$$ \\Gamma_{33} = L\\sin^2\\theta + C\\cos^2\\theta $$\n$$ \\Gamma_{13} = (F+L)\\sin\\theta\\cos\\theta $$\nThe two eigenvalues are given by:\n$$ \\lambda_{\\text{qP,qSV}} = \\frac{1}{2} \\left[ (\\Gamma_{11} + \\Gamma_{33}) \\pm \\sqrt{(\\Gamma_{11} - \\Gamma_{33})^2 + 4\\Gamma_{13}^2} \\right] $$\nThe qP-wave corresponds to the larger velocity, hence the larger eigenvalue, which is obtained by taking the positive sign.\n$$ \\lambda_{\\text{qP}} = \\frac{1}{2} \\left[ (\\Gamma_{11} + \\Gamma_{33}) + \\sqrt{(\\Gamma_{11} - \\Gamma_{33})^2 + 4\\Gamma_{13}^2} \\right] $$\nThe qP phase velocity is then $v_{\\text{qP}}(\\theta) = \\sqrt{\\lambda_{\\text{qP}}/\\rho}$.\n\nFor each layer $i$, we perform the following steps:\n1.  Calculate the constant path direction vector components $d_x$ and $d_z$.\n2.  Determine the phase angle $\\theta_i$. The problem specifies two orientations:\n    -   **VTI (Vertical Transverse Isotropy)**: Symmetry axis is vertical ($z$). The angle $\\theta_i$ is between the propagation direction $\\mathbf{d}$ and the $z$-axis. Thus, $\\cos\\theta_i = d_z$ and $\\sin\\theta_i = d_x$.\n    -   **HTI (Horizontal Transverse Isotropy)**: Symmetry axis is horizontal ($x$). The angle $\\theta_i$ is between $\\mathbf{d}$ and the $x$-axis. Thus, $\\cos\\theta_i = d_x$ and $\\sin\\theta_i = d_z$.\n3.  Compute the stiffness-like quantities $C_i, L_i, A_i, F_i$ from the given Thomsen parameters ($\\alpha_{0,i}, \\beta_{0,i}, \\epsilon_i, \\delta_i$) and density $\\rho_i$.\n    $$ C_i = \\rho_i \\alpha_{0,i}^2 $$\n    $$ L_i = \\rho_i \\beta_{0,i}^2 $$\n    $$ A_i = \\rho_i \\alpha_{0,i}^2 (1 + 2\\epsilon_i) $$\n    $$ F_i = -L_i + \\sqrt{(C_i - L_i)^2 + 2\\delta_i C_i (C_i - L_i)} $$\n4.  Substitute these into the expressions for $\\Gamma_{11}, \\Gamma_{33}, \\Gamma_{13}$ to find $\\lambda_{\\text{qP},i}$.\n5.  Calculate the qP phase velocity $v_{\\text{qP},i} = \\sqrt{\\lambda_{\\text{qP},i}/\\rho_i}$.\n6.  The path length in the layer is $\\ell_i = h_i/d_z$. Note that for a vertical path ($X=0$), $d_z=1$ and $\\ell_i = h_i$. For this case, $\\theta_i=0$ for VTI layers, leading to $v_{\\text{qP},i}=\\alpha_{0,i}$ and $\\Delta T = 0$, as expected.\n7.  The anisotropic travel time for the layer is $T_{\\text{aniso},i} = \\ell_i / v_{\\text{qP},i}$.\n8.  The isotropic travel time for the layer is $T_{\\text{iso},i} = \\ell_i / \\alpha_{0,i}$.\n\nThe total times $T_{\\text{aniso}} = \\sum_i T_{\\text{aniso},i}$ and $T_{\\text{iso}} = \\sum_i T_{\\text{iso},i}$ are summed, and the difference $\\Delta T = T_{\\text{aniso}} - T_{\\text{iso}}$ is computed for each test case.\n\nThe computational implementation will encapsulate this logic, processing each test case by iterating through its layers, calculating the layer-specific travel time contributions, and summing them to find the total times and their final difference.\n\nSpecial cases provided as checks are:\n-   **Test 3 (Isotropic limit)**: With $\\epsilon_1=0.00$ and $\\delta_1=0.00$, we must have $A_1=C_1$ and $F_1=C_1-2L_1$. This results in $\\lambda_{\\text{qP},1}=C_1$, which means $v_{\\text{qP},1}=\\alpha_{0,1}$ for all angles. Consequently, $T_{\\text{aniso}} = T_{\\text{iso}}$ and $\\Delta T$ must be $0$.\n-   **Test 5 (Vertical incidence)**: With $X=0$, the path is vertical. For VTI layers, the propagation is along the symmetry axis ($\\theta=0$). This yields $v_{\\text{qP},i}=\\alpha_{0,i}$, so again, $T_{\\text{aniso}} = T_{\\text{iso}}$ and $\\Delta T$ must be $0$.\n\nThese checks confirm the correctness of the formulation and its implementation.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Computes the travel time difference between anisotropic and isotropic models\n    for qP-waves along a straight path in layered VTI/HTI media.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Structure: (geometry, layers_data)\n    # geometry: (X, Z_R)\n    # layers_data: list of (h, rho, alpha0, beta0, epsilon, delta, type_str)\n    test_cases = [\n        # Test 1\n        (\n            {\"X\": 1000, \"Z_R\": 1000},\n            [\n                {\"h\": 1000, \"rho\": 2500, \"alpha0\": 3000, \"beta0\": 1500, \"epsilon\": 0.20, \"delta\": 0.10, \"type\": \"VTI\"}\n            ]\n        ),\n        # Test 2\n        (\n            {\"X\": 500, \"Z_R\": 2000},\n            [\n                {\"h\": 800,  \"rho\": 2400, \"alpha0\": 3200, \"beta0\": 1600, \"epsilon\": 0.15, \"delta\": 0.05, \"type\": \"VTI\"},\n                {\"h\": 1200, \"rho\": 2500, \"alpha0\": 3400, \"beta0\": 1700, \"epsilon\": 0.10, \"delta\": 0.02, \"type\": \"VTI\"}\n            ]\n        ),\n        # Test 3\n        (\n            {\"X\": 1500, \"Z_R\": 1500},\n            [\n                {\"h\": 1500, \"rho\": 2500, \"alpha0\": 3000, \"beta0\": 1500, \"epsilon\": 0.00, \"delta\": 0.00, \"type\": \"VTI\"}\n            ]\n        ),\n        # Test 4\n        (\n            {\"X\": 2000, \"Z_R\": 2000},\n            [\n                {\"h\": 800,  \"rho\": 2600, \"alpha0\": 3300, \"beta0\": 1800, \"epsilon\": 0.25, \"delta\": 0.05, \"type\": \"VTI\"},\n                {\"h\": 1200, \"rho\": 2500, \"alpha0\": 3200, \"beta0\": 1700, \"epsilon\": 0.20, \"delta\": 0.10, \"type\": \"HTI\"}\n            ]\n        ),\n        # Test 5\n         (\n            {\"X\": 0, \"Z_R\": 2000},\n            [\n                {\"h\": 600, \"rho\": 2500, \"alpha0\": 3100, \"beta0\": 1600, \"epsilon\": 0.12, \"delta\": 0.04, \"type\": \"VTI\"},\n                {\"h\": 900, \"rho\": 2550, \"alpha0\": 3200, \"beta0\": 1650, \"epsilon\": 0.10, \"delta\": 0.05, \"type\": \"VTI\"},\n                {\"h\": 500, \"rho\": 2600, \"alpha0\": 3300, \"beta0\": 1700, \"epsilon\": 0.08, \"delta\": 0.03, \"type\": \"VTI\"}\n            ]\n        )\n    ]\n    \n    results = []\n    \n    for case in test_cases:\n        geometry, layers_data = case\n        X, Z_R = geometry[\"X\"], geometry[\"Z_R\"]\n\n        if X == 0 and Z_R == 0:\n            results.append(0.0)\n            continue\n        \n        path_length_total = np.sqrt(X**2 + Z_R**2)\n        \n        # Handle vertical path as a special case to avoid division by zero if X is used.\n        if path_length_total == 0:\n            results.append(0.0)\n            continue\n\n        d_x = X / path_length_total\n        d_z = Z_R / path_length_total\n\n        total_t_aniso = 0.0\n        total_t_iso = 0.0\n        \n        # For vertical path, dz=1, path_length_in_layer = h.\n        # For horizontal path, this model is ill-defined (h/dz -> inf).\n        # We assume Z_R > 0 for all cases as per problem description.\n        if d_z == 0:\n            # This case is not in the test suite, but would be a singularity.\n            # We can skip or raise an error. Here we assume non-horizontal paths.\n            results.append(np.nan) # Or handle as per a more detailed spec.\n            continue\n            \n        for layer in layers_data:\n            h = layer[\"h\"]\n            rho = layer[\"rho\"]\n            alpha0 = layer[\"alpha0\"]\n            beta0 = layer[\"beta0\"]\n            epsilon = layer[\"epsilon\"]\n            delta = layer[\"delta\"]\n            orientation = layer[\"type\"]\n\n            path_length_in_layer = h / d_z\n\n            # Isotropic Travel Time Contribution\n            total_t_iso += path_length_in_layer / alpha0\n\n            # Anisotropic Travel Time Contribution\n            if orientation == \"VTI\":  # Symmetry axis is z\n                cos_theta = d_z\n                sin_theta = d_x\n            elif orientation == \"HTI\":  # Symmetry axis is x\n                cos_theta = d_x\n                sin_theta = d_z\n            else:\n                raise ValueError(f\"Unknown orientation: {orientation}\")\n\n            # Calculate stiffness-like quantities\n            C = rho * alpha0**2\n            L = rho * beta0**2\n            A = rho * alpha0**2 * (1 + 2 * epsilon)\n            \n            F_term_sqrt = (C - L)**2 + 2 * delta * C * (C - L)\n            if F_term_sqrt  0:\n                raise ValueError(\"Unphysical parameters: negative term in F calculation.\")\n            F = -L + np.sqrt(F_term_sqrt)\n\n            # Christoffel matrix components for qP-qSV\n            sin2_theta = sin_theta**2\n            cos2_theta = cos_theta**2\n\n            gamma_11 = A * sin2_theta + L * cos2_theta\n            gamma_33 = L * sin2_theta + C * cos2_theta\n            gamma_13 = (F + L) * sin_theta * cos_theta\n            \n            # Solve for qP eigenvalue\n            term1 = gamma_11 + gamma_33\n            sqrt_term = np.sqrt((gamma_11 - gamma_33)**2 + 4 * gamma_13**2)\n            \n            lambda_qp = 0.5 * (term1 + sqrt_term)\n            \n            # Calculate qP phase velocity\n            v_qp = np.sqrt(lambda_qp / rho)\n\n            total_t_aniso += path_length_in_layer / v_qp\n\n        delta_T = total_t_aniso - total_t_iso\n        results.append(delta_T)\n\n    # Format output as specified\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n\n```", "id": "3576014"}, {"introduction": "While kinematic models provide crucial insights, a complete understanding of wave phenomena requires simulating the full wavefield dynamics. This final practice [@problem_id:3575981] guides you through the essential first steps of building a numerical wave simulator for VTI media. You will derive the first-order velocity-stress equations and discretize them on a staggered grid, revealing exactly how the components of the anisotropic stiffness tensor, such as $c_{11}$ and $c_{33}$, translate into a concrete computational algorithm at the heart of modern seismic modeling codes.", "problem": "You are asked to derive and discretize the first-order velocity–stress formulation of elastic wave propagation in a medium exhibiting Vertical Transverse Isotropy (VTI), and then implement a small computational experiment that numerically demonstrates how stiffness anisotropy enters the update equations on a staggered grid. Begin from fundamental laws of continuum mechanics and linear elasticity, and proceed to an algorithmic prescription suitable for finite differences.\n\nThe fundamental base to use consists of the balance of linear momentum and the linear elastic constitutive relations (Hooke’s law) for a transversely isotropic medium (with the axis of symmetry aligned vertically). In a two-dimensional $x$–$z$ section, consider the in-plane quasi-compressional and quasi-shear vertical (P–SV) system. The unknowns are the particle velocities $v_x(x,z,t)$ and $v_z(x,z,t)$ and the Cauchy stress components $\\sigma_{xx}(x,z,t)$, $\\sigma_{zz}(x,z,t)$, and $\\sigma_{xz}(x,z,t)$. Density is $\\rho(x,z)$ and the stiffnesses are $c_{11}(x,z)$, $c_{33}(x,z)$, $c_{13}(x,z)$, $c_{44}(x,z)$, and $c_{66}(x,z)$, where the Vertical Transverse Isotropy (VTI) reduction implies invariance under rotations about the vertical axis. You must derive the first-order system that couples the time rate of stress to velocity gradients and the time rate of velocity to stress gradients, making explicit where anisotropy enters via these stiffnesses.\n\nYou must then specify the finite-difference discretization on a staggered grid of the Virieux type, where the particle velocities are located at cell faces and the normal stresses are located at cell centers; the shear stress is located at cell corners. Use second-order central differences and periodic boundary conditions in both directions to avoid boundary complications. Your discretization must make explicit how $c_{11}$, $c_{33}$, $c_{13}$, and $c_{44}$ weight the corresponding spatial derivatives in the discrete update equations.\n\nAfter presenting your derivation and discretization, implement a program that, for each test case listed below, performs the following two tasks:\n\n1. Computes the quasi-compressional wave phase speeds along the principal directions of symmetry using the continuous Christoffel analysis specialized to principal axes, i.e., horizontal ($x$-directed) and vertical ($z$-directed) propagation. Report $v_{\\mathrm{P},x} = \\sqrt{c_{11}/\\rho}$ and $v_{\\mathrm{P},z} = \\sqrt{c_{33}/\\rho}$ in meters per second (m/s), and also their ratio $r = v_{\\mathrm{P},x}/v_{\\mathrm{P},z}$ (dimensionless).\n\n2. Constructs a small uniform-grid, periodic, staggered-grid layout with $N_x = 6$, $N_z = 6$, grid spacings $\\Delta x = \\Delta z = 10$ meters, and defines face-centered particle velocity fields\n$$\nv_x\\big((i+\\tfrac{1}{2})\\Delta x,\\, j\\Delta z\\big) = \\sin(k_x x)\\,\\cos(k_z z),\\quad\nv_z\\big(i\\Delta x,\\, (j+\\tfrac{1}{2})\\Delta z\\big) = \\cos(k_x x)\\,\\sin(k_z z),\n$$\nwith $k_x = \\frac{2\\pi}{L_x}$, $k_z = \\frac{2\\pi}{L_z}$, $L_x = N_x \\Delta x$, and $L_z = N_z \\Delta z$. Using your discrete staggered-grid formulas, compute the stress rates $\\partial_t \\sigma_{xx}$, $\\partial_t \\sigma_{zz}$ at the central cell $(i_0,j_0) = (3,3)$ and $\\partial_t \\sigma_{xz}$ at the central shear node $(i_0+\\tfrac{1}{2}, j_0+\\tfrac{1}{2}) = (3.5,3.5)$. From these, report the magnitude\n$$\nM = \\sqrt{\\big(\\partial_t \\sigma_{xx}\\big)^2 + \\big(\\partial_t \\sigma_{zz}\\big)^2 + \\big(\\partial_t \\sigma_{xz}\\big)^2}\n$$\nin pascals per second (Pa/s). Use strictly periodic indexing in both directions when forming finite differences.\n\nTest suite (all stiffnesses in pascals, density in kilograms per cubic meter):\n\n- Case A (isotropic baseline): $c_{11} = c_{33} = \\lambda + 2\\mu$, $c_{13} = \\lambda$, $c_{44} = \\mu$, $c_{66} = \\mu$, with $\\lambda = 10\\times 10^9$, $\\mu = 5\\times 10^9$, $\\rho = 2200$.\n- Case B (VTI, horizontal faster): $c_{11} = 24\\times 10^9$, $c_{33} = 18\\times 10^9$, $c_{13} = 8\\times 10^9$, $c_{44} = 6\\times 10^9$, $c_{66} = 7\\times 10^9$, $\\rho = 2200$.\n- Case C (VTI, vertical faster): $c_{11} = 18\\times 10^9$, $c_{33} = 24\\times 10^9$, $c_{13} = 8\\times 10^9$, $c_{44} = 6\\times 10^9$, $c_{66} = 7\\times 10^9$, $\\rho = 2200$.\n- Case D (isotropic with different density): $c_{11} = c_{33} = 20\\times 10^9$, $c_{13} = 10\\times 10^9$, $c_{44} = 5\\times 10^9$, $c_{66} = 5\\times 10^9$, $\\rho = 2600$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each case, output four floats in this order: $v_{\\mathrm{P},x}$ in m/s, $v_{\\mathrm{P},z}$ in m/s, the ratio $r$ (dimensionless), and $M$ in Pa/s. Concatenate the results across all test cases to form one flat list. Express all floating-point outputs with six decimal places. For example, the output format should be like\n$$\n[\\text{caseA\\_vPx},\\text{caseA\\_vPz},\\text{caseA\\_r},\\text{caseA\\_M},\\text{caseB\\_vPx},\\ldots]\n$$\n\nNo external input should be read by the program, and no external files or network access are allowed. Use meters, seconds, kilograms, and pascals consistently throughout.", "solution": "The problem is valid. It is scientifically grounded in the principles of continuum mechanics and computational geophysics, well-posed with sufficient information for a unique solution, and objectively stated.\n\n### Part 1: Derivation of the First-Order Velocity-Stress System\n\nThe derivation begins from two fundamental principles of continuum mechanics: the balance of linear momentum and the constitutive law for a linear elastic material.\n\n**1. Balance of Linear Momentum (Cauchy's Equation of Motion)**\nIn the absence of body forces, the balance of linear momentum states that the product of mass density $\\rho$ and particle acceleration is equal to the divergence of the Cauchy stress tensor $\\boldsymbol{\\sigma}$.\n$$\n\\rho \\frac{\\partial v_i}{\\partial t} = \\frac{\\partial \\sigma_{ij}}{\\partial x_j}\n$$\nwhere $v_i$ are the components of the particle velocity vector, $t$ is time, and $x_j$ are the spatial coordinates. We adopt the Einstein summation convention for repeated indices.\n\nFor a two-dimensional P-SV system in the $x$-$z$ plane (indexed by $1$ and $3$ respectively), the relevant velocity components are $v_x$ and $v_z$, and the relevant stress components are $\\sigma_{xx}$, $\\sigma_{zz}$, and $\\sigma_{xz}$. The equations of motion expand to:\n$$\n\\rho \\frac{\\partial v_x}{\\partial t} = \\frac{\\partial \\sigma_{xx}}{\\partial x} + \\frac{\\partial \\sigma_{xz}}{\\partial z} \\quad (1)\n$$\n$$\n\\rho \\frac{\\partial v_z}{\\partial t} = \\frac{\\partial \\sigma_{xz}}{\\partial x} + \\frac{\\partial \\sigma_{zz}}{\\partial z} \\quad (2)\n$$\nThese two equations relate the time rate of change of particle velocity to the spatial gradients of the stress components.\n\n**2. Constitutive Relation (Hooke's Law for VTI Media)**\nThe constitutive relation connects the stress tensor to the strain tensor. For a linear elastic medium, Hooke's law states $\\sigma_{ij} = C_{ijkl} \\epsilon_{kl}$, where $\\mathbf{C}$ is the fourth-order elasticity tensor and $\\boldsymbol{\\epsilon}$ is the small strain tensor, $\\epsilon_{kl} = \\frac{1}{2}(\\partial u_k/\\partial x_l + \\partial u_l/\\partial x_k)$. The time-derivative form relates the stress rate to the strain rate tensor $\\dot{\\boldsymbol{\\epsilon}}$:\n$$\n\\frac{\\partial \\sigma_{ij}}{\\partial t} = C_{ijkl} \\dot{\\epsilon}_{kl}\n$$\nThe components of the strain rate tensor are related to velocity gradients by $\\dot{\\epsilon}_{kl} = \\frac{1}{2}\\left(\\frac{\\partial v_k}{\\partial x_l} + \\frac{\\partial v_l}{\\partial x_k}\\right)$.\n\nFor a Vertical Transverse Isotropy (VTI) medium, the symmetry axis is vertical (the $z$-axis). The elasticity tensor has only five independent components, which are given in Voigt notation as $c_{11}$, $c_{33}$, $c_{13}$, $c_{44}$, and $c_{66}$. The stress-strain rate relations for the 2D P-SV system in the $x$-$z$ plane are:\n$$\n\\begin{pmatrix} \\dot{\\sigma}_{xx} \\\\ \\dot{\\sigma}_{zz} \\\\ \\dot{\\sigma}_{xz} \\end{pmatrix} = \\begin{pmatrix} c_{11}  c_{13}  0 \\\\ c_{13}  c_{33}  0 \\\\ 0  0  c_{44} \\end{pmatrix} \\begin{pmatrix} \\dot{\\epsilon}_{xx} \\\\ \\dot{\\epsilon}_{zz} \\\\ 2\\dot{\\epsilon}_{xz} \\end{pmatrix}\n$$\nSubstituting the strain rates with velocity gradients ($\\dot{\\epsilon}_{xx} = \\partial v_x/\\partial x$, $\\dot{\\epsilon}_{zz} = \\partial v_z/\\partial z$, and $2\\dot{\\epsilon}_{xz} = \\partial v_x/\\partial z + \\partial v_z/\\partial x$), we obtain the required first-order stress rate equations:\n$$\n\\frac{\\partial \\sigma_{xx}}{\\partial t} = c_{11} \\frac{\\partial v_x}{\\partial x} + c_{13} \\frac{\\partial v_z}{\\partial z} \\quad (3)\n$$\n$$\n\\frac{\\partial \\sigma_{zz}}{\\partial t} = c_{13} \\frac{\\partial v_x}{\\partial x} + c_{33} \\frac{\\partial v_z}{\\partial z} \\quad (4)\n$$\n$$\n\\frac{\\partial \\sigma_{xz}}{\\partial t} = c_{44} \\left( \\frac{\\partial v_x}{\\partial z} + \\frac{\\partial v_z}{\\partial x} \\right) \\quad (5)\n$$\nThe stiffness parameter $c_{66}$ is related to SH waves and does not appear in the 2D P-SV system.\n\n**Summary of the First-Order System**\nEquations $(1)$-$(5)$ constitute the first-order velocity-stress system for P-SV waves in a VTI medium. Anisotropy is explicitly represented by the distinct stiffness coefficients $c_{11}$, $c_{33}$, $c_{13}$, and $c_{44}$. In an isotropic medium, these are related via two Lamé parameters, $\\lambda$ and $\\mu$, as $c_{11}=c_{33}=\\lambda+2\\mu$, $c_{13}=\\lambda$, and $c_{44}=\\mu$. The departure from these equivalences quantifies the degree of anisotropy.\n\n### Part 2: Finite-Difference Discretization on a Staggered Grid\n\nWe discretize the system on a staggered grid of the Virieux type. The spatial domain is discretized into cells of size $\\Delta x \\times \\Delta z$. Grid points are indexed by $(i,j)$, corresponding to physical coordinates $(i\\Delta x, j\\Delta z)$. The field components are located as follows:\n- Normal stresses $\\sigma_{xx}, \\sigma_{zz}$ are at cell centers: $(i, j)$\n- Horizontal velocity $v_x$ is at vertical cell faces: $(i+1/2, j)$\n- Vertical velocity $v_z$ is at horizontal cell faces: $(i, j+1/2)$\n- Shear stress $\\sigma_{xz}$ is at cell corners/nodes: $(i+1/2, j+1/2)$\n\nUsing second-order central finite differences, the spatial derivatives at the required locations are approximated as follows. Let $f_{i,j}$ denote the value of a function $f$ at grid location $(i,j)$.\n\n**Discretization of Stress Rate Equations:**\nThe stress rate equations require velocity gradients.\nThe derivatives $\\partial v_x/\\partial x$ and $\\partial v_z/\\partial z$ are evaluated at cell centers $(i,j)$:\n$$\n\\left(\\frac{\\partial v_x}{\\partial x}\\right)_{i,j} \\approx \\frac{v_{x, i+1/2, j} - v_{x, i-1/2, j}}{\\Delta x}\n$$\n$$\n\\left(\\frac{\\partial v_z}{\\partial z}\\right)_{i,j} \\approx \\frac{v_{z, i, j+1/2} - v_{z, i, j-1/2}}{\\Delta z}\n$$\nThe derivatives $\\partial v_x/\\partial z$ and $\\partial v_z/\\partial x$ are evaluated at shear nodes $(i+1/2, j+1/2)$:\n$$\n\\left(\\frac{\\partial v_x}{\\partial z}\\right)_{i+1/2,j+1/2} \\approx \\frac{v_{x, i+1/2, j+1} - v_{x, i+1/2, j}}{\\Delta z}\n$$\n$$\n\\left(\\frac{\\partial v_z}{\\partial x}\\right)_{i+1/2,j+1/2} \\approx \\frac{v_{z, i+1, j+1/2} - v_{z, i, j+1/2}}{\\Delta x}\n$$\nSubstituting these into equations $(3)$-$(5)$ yields the discrete update rules for stress rates. For the purpose of the numerical experiment, we write the expressions for a specific time instance:\n$$\n\\left(\\frac{\\partial \\sigma_{xx}}{\\partial t}\\right)_{i,j} = c_{11} \\left( \\frac{v_{x, i+1/2, j} - v_{x, i-1/2, j}}{\\Delta x} \\right) + c_{13} \\left( \\frac{v_{z, i, j+1/2} - v_{z, i, j-1/2}}{\\Delta z} \\right)\n$$\n$$\n\\left(\\frac{\\partial \\sigma_{zz}}{\\partial t}\\right)_{i,j} = c_{13} \\left( \\frac{v_{x, i+1/2, j} - v_{x, i-1/2, j}}{\\Delta x} \\right) + c_{33} \\left( \\frac{v_{z, i, j+1/2} - v_{z, i, j-1/2}}{\\Delta z} \\right)\n$$\n$$\n\\left(\\frac{\\partial \\sigma_{xz}}{\\partial t}\\right)_{i+1/2,j+1/2} = c_{44} \\left( \\frac{v_{x, i+1/2, j+1} - v_{x, i+1/2, j}}{\\Delta z} + \\frac{v_{z, i+1, j+1/2} - v_{z, i, j+1/2}}{\\Delta x} \\right)\n$$\nThese expressions explicitly show how the stiffness parameters $c_{11}$, $c_{33}$, $c_{13}$, and $c_{44}$ weight the discrete velocity gradients to determine the instantaneous stress rates, thus demonstrating how material anisotropy enters the numerical stencil. The problem specifies periodic boundary conditions, which means array indexing must wrap around the grid dimensions (e.g., index $i-1$ for $i=0$ becomes $N_x-1$).\n\nThe discretization of the velocity update equations follows a similar procedure, requiring derivatives of stress components at the velocity locations, but is not explicitly required for the numerical part of this problem.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the computational geophysics problem for VTI media.\n    The function iterates through four test cases, calculating phase speeds and a\n    numerical stress-rate magnitude for each.\n    \"\"\"\n    \n    # Test suite definition\n    test_cases = [\n        # Case A (isotropic baseline)\n        {'name': 'A', 'c11': (10e9 + 2*5e9), 'c33': (10e9 + 2*5e9), 'c13': 10e9, 'c44': 5e9, 'rho': 2200.0},\n        # Case B (VTI, horizontal faster)\n        {'name': 'B', 'c11': 24e9, 'c33': 18e9, 'c13': 8e9, 'c44': 6e9, 'rho': 2200.0},\n        # Case C (VTI, vertical faster)\n        {'name': 'C', 'c11': 18e9, 'c33': 24e9, 'c13': 8e9, 'c44': 6e9, 'rho': 2200.0},\n        # Case D (isotropic with different density)\n        {'name': 'D', 'c11': 20e9, 'c33': 20e9, 'c13': 10e9, 'c44': 5e9, 'rho': 2600.0}\n    ]\n\n    all_results = []\n\n    # Grid and initial field parameters\n    Nx = 6\n    Nz = 6\n    dx = 10.0\n    dz = 10.0\n    Lx = Nx * dx\n    Lz = Nz * dz\n    kx = 2 * np.pi / Lx\n    kz = 2 * np.pi / Lz\n\n    # Evaluation point indices\n    i0, j0 = 3, 3\n\n    for case in test_cases:\n        c11 = case['c11']\n        c33 = case['c33']\n        c13 = case['c13']\n        c44 = case['c44']\n        rho = case['rho']\n\n        # Task 1: Compute phase speeds and their ratio\n        v_px = np.sqrt(c11 / rho)\n        v_pz = np.sqrt(c33 / rho)\n        ratio_r = v_px / v_pz\n        \n        # Task 2: Compute stress rate magnitude M\n        \n        # Define velocity functions based on the analytical expressions\n        # v_x at (i+1/2)dx, jdz\n        def get_vx(i_half, j):\n            x = i_half * dx\n            z = j * dz\n            return np.sin(kx * x) * np.cos(kz * z)\n\n        # v_z at idx, (j+1/2)dz\n        def get_vz(i, j_half):\n            x = i * dx\n            z = j_half * dz\n            return np.cos(kx * x) * np.sin(kz * z)\n\n        # Compute velocity gradients using second-order central differences\n        \n        # Gradients for normal stresses at cell center (i0, j0)\n        # Note: Periodic BC are naturally handled by the analytical sin/cos functions.\n        # No explicit modulo arithmetic is needed as we are not iterating a simulation.\n\n        # v_x at (i0 +/- 1/2, j0)\n        vx_p_half_i = get_vx(i0 + 0.5, j0)\n        vx_m_half_i = get_vx(i0 - 0.5, j0)\n        \n        # v_z at (i0, j0 +/- 1/2)\n        vz_p_half_j = get_vz(i0, j0 + 0.5)\n        vz_m_half_j = get_vz(i0, j0 - 0.5)\n\n        dvx_dx = (vx_p_half_i - vx_m_half_i) / dx\n        dvz_dz = (vz_p_half_j - vz_m_half_j) / dz\n\n        # Gradients for shear stress at node (i0+1/2, j0+1/2)\n        \n        # v_x at (i0+1/2, j0+1) and (i0+1/2, j0)\n        vx_p1_j = get_vx(i0 + 0.5, j0 + 1)\n        vx_j = get_vx(i0 + 0.5, j0)\n        \n        # v_z at (i0+1, j0+1/2) and (i0, j0+1/2)\n        vz_p1_i = get_vz(i0 + 1, j0 + 0.5)\n        vz_i = get_vz(i0, j0 + 0.5)\n\n        dvx_dz = (vx_p1_j - vx_j) / dz\n        dvz_dx = (vz_p1_i - vz_i) / dx\n\n        # Compute stress rates using the constitutive relations\n        dt_sigma_xx = c11 * dvx_dx + c13 * dvz_dz\n        dt_sigma_zz = c13 * dvx_dx + c33 * dvz_dz\n        dt_sigma_xz = c44 * (dvx_dz + dvz_dx)\n        \n        # Compute the magnitude M\n        M = np.sqrt(dt_sigma_xx**2 + dt_sigma_zz**2 + dt_sigma_xz**2)\n        \n        # Append results for this case\n        all_results.extend([v_px, v_pz, ratio_r, M])\n\n    # Format and print the final output string\n    formatted_results = [f'{r:.6f}' for r in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3575981"}]}