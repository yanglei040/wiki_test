{"hands_on_practices": [{"introduction": "To appreciate the need for sophisticated absorbing boundary conditions, it is essential to first understand the limitations of simpler approaches. This exercise guides you through a foundational analysis of the first-order Engquist–Majda boundary condition. By deriving the reflection coefficient $R(\\theta)$ as a function of incidence angle, you will quantify how its performance degrades for non-normally incident waves, providing a clear motivation for developing more robust methods. [@problem_id:3572784]", "problem": "Consider the two-dimensional acoustic wave equation for a scalar field $u(x,y,t)$ in a homogeneous, isotropic medium of constant wave speed $c$,\n$$\n\\frac{\\partial^{2} u}{\\partial t^{2}} = c^{2} \\left( \\frac{\\partial^{2} u}{\\partial x^{2}} + \\frac{\\partial^{2} u}{\\partial y^{2}} \\right).\n$$\nThe computational domain is the half-space $x \\leq 0$ with a truncation boundary at $x=0$. To minimize artificial reflections at $x=0$, an absorbing boundary condition (ABC) of first-order Engquist–Majda type is imposed,\n$$\n\\left( \\frac{\\partial}{\\partial t} + c \\frac{\\partial}{\\partial x} \\right) u(x=0,y,t) = 0,\n$$\nwhich approximates one-way propagation in the $+x$ direction by neglecting tangential coupling.\n\nA time-harmonic plane wave solution inside the domain has the form\n$$\nu_{\\text{inc}}(x,y,t) = \\exp\\big( i (k_{x} x + k_{y} y - \\omega t) \\big),\n$$\nwhere $\\omega = c k$ and $k = \\sqrt{k_{x}^{2} + k_{y}^{2}}$. The incidence angle $\\theta \\in [0,\\pi/2)$ is defined with respect to the boundary normal (the $+x$-axis), so that $k_{x} = k \\cos\\theta$ and $k_{y} = k \\sin\\theta$. Due to the ABC, a reflected wave is generated and can be written as\n$$\nu_{\\text{ref}}(x,y,t) = R(\\theta)\\, \\exp\\big( i (-k_{x} x + k_{y} y - \\omega t) \\big),\n$$\nwhere $R(\\theta)$ is the complex reflection coefficient, defined as the ratio of the reflected to incident amplitude at the boundary.\n\nStarting from the acoustic wave equation and the specified boundary condition, derive $R(\\theta)$ in closed form and then quantify the angle-dependent error by the energy reflection fraction\n$$\ne(\\theta) = \\left| R(\\theta) \\right|^{2}.\n$$\nProvide your final expressions for $R(\\theta)$ and $e(\\theta)$ in terms of $\\theta$, with $\\theta$ expressed in radians. No numerical evaluation or rounding is required. The final answer must be a single closed-form analytic expression or a single row matrix of such expressions as specified.", "solution": "The problem is valid as it is scientifically grounded, well-posed, objective, and self-contained. The analysis pertains to a standard and fundamental topic in computational wave propagation. We shall now proceed with the derivation.\n\nThe total acoustic field $u(x,y,t)$ in the domain $x \\leq 0$ is the linear superposition of the incident wave $u_{\\text{inc}}$ and the reflected wave $u_{\\text{ref}}$ generated at the boundary $x=0$.\n$$\nu(x,y,t) = u_{\\text{inc}}(x,y,t) + u_{\\text{ref}}(x,y,t)\n$$\nSubstituting the given forms for the incident and reflected waves:\n$$\nu(x,y,t) = \\exp\\big( i (k_{x} x + k_{y} y - \\omega t) \\big) + R(\\theta)\\, \\exp\\big( i (-k_{x} x + k_{y} y - \\omega t) \\big)\n$$\nThe problem requires applying the first-order Engquist–Majda absorbing boundary condition (ABC) at the boundary $x=0$:\n$$\n\\left( \\frac{\\partial}{\\partial t} + c \\frac{\\partial}{\\partial x} \\right) u(x,y,t) \\bigg|_{x=0} = 0\n$$\nTo apply this condition, we first compute the necessary partial derivatives of the total field $u(x,y,t)$.\n\nThe partial derivative with respect to time $t$ is:\n$$\n\\frac{\\partial u}{\\partial t} = (-i \\omega) \\exp\\big( i (k_{x} x + k_{y} y - \\omega t) \\big) + R(\\theta) (-i \\omega) \\exp\\big( i (-k_{x} x + k_{y} y - \\omega t) \\big)\n$$\n$$\n\\frac{\\partial u}{\\partial t} = -i \\omega \\left( u_{\\text{inc}} + u_{\\text{ref}} \\right)\n$$\nThe partial derivative with respect to the spatial coordinate $x$ is:\n$$\n\\frac{\\partial u}{\\partial x} = (i k_{x}) \\exp\\big( i (k_{x} x + k_{y} y - \\omega t) \\big) + R(\\theta) (-i k_{x}) \\exp\\big( i (-k_{x} x + k_{y} y - \\omega t) \\big)\n$$\n$$\n\\frac{\\partial u}{\\partial x} = i k_{x} \\left( u_{\\text{inc}} - u_{\\text{ref}} \\right)\n$$\nNow, we substitute these derivatives into the ABC operator:\n$$\n\\frac{\\partial u}{\\partial t} + c \\frac{\\partial u}{\\partial x} = -i \\omega (u_{\\text{inc}} + u_{\\text{ref}}) + c(i k_{x} (u_{\\text{inc}} - u_{\\text{ref}}))\n$$\nGrouping terms by $u_{\\text{inc}}$ and $u_{\\text{ref}}$:\n$$\n\\frac{\\partial u}{\\partial t} + c \\frac{\\partial u}{\\partial x} = (-i \\omega + i c k_{x}) u_{\\text{inc}} + (-i \\omega - i c k_{x}) u_{\\text{ref}}\n$$\nWe now evaluate this expression at the boundary $x=0$. At $x=0$, the incident and reflected wave terms become:\n$$\nu_{\\text{inc}}(0,y,t) = \\exp\\big( i (k_{y} y - \\omega t) \\big)\n$$\n$$\nu_{\\text{ref}}(0,y,t) = R(\\theta)\\, \\exp\\big( i (k_{y} y - \\omega t) \\big) = R(\\theta) u_{\\text{inc}}(0,y,t)\n$$\nSubstituting this relationship into the boundary condition equation at $x=0$:\n$$\n(-i \\omega + i c k_{x}) u_{\\text{inc}}(0,y,t) + (-i \\omega - i c k_{x}) R(\\theta) u_{\\text{inc}}(0,y,t) = 0\n$$\nSince $u_{\\text{inc}}(0,y,t)$ is not identically zero, we can divide it out, yielding an algebraic equation for the reflection coefficient $R(\\theta)$:\n$$\n(-i \\omega + i c k_{x}) + (-i \\omega - i c k_{x}) R(\\theta) = 0\n$$\nSolving for $R(\\theta)$:\n$$\nR(\\theta) (-i \\omega - i c k_{x}) = -(-i \\omega + i c k_{x}) = i \\omega - i c k_{x}\n$$\n$$\nR(\\theta) = \\frac{i \\omega - i c k_{x}}{-i \\omega - i c k_{x}} = \\frac{i(\\omega - c k_{x})}{-i(\\omega + c k_{x})} = - \\frac{\\omega - c k_{x}}{\\omega + c k_{x}} = \\frac{c k_{x} - \\omega}{c k_{x} + \\omega}\n$$\nTo express $R(\\theta)$ in terms of the incidence angle $\\theta$, we use the given relations:\n$\\omega = c k$ and $k_{x} = k \\cos\\theta$.\nSubstituting these into the expression for $R(\\theta)$:\n$$\nR(\\theta) = \\frac{c(k \\cos\\theta) - ck}{c(k \\cos\\theta) + ck}\n$$\nFactoring out the common term $ck$ from the numerator and denominator:\n$$\nR(\\theta) = \\frac{ck(\\cos\\theta - 1)}{ck(\\cos\\theta + 1)} = \\frac{\\cos\\theta - 1}{\\cos\\theta + 1}\n$$\nThis expression can be simplified using the trigonometric half-angle identities $1-\\cos\\theta = 2\\sin^2(\\frac{\\theta}{2})$ and $1+\\cos\\theta = 2\\cos^2(\\frac{\\theta}{2})$:\n$$\nR(\\theta) = \\frac{-(1 - \\cos\\theta)}{1 + \\cos\\theta} = -\\frac{2\\sin^2(\\frac{\\theta}{2})}{2\\cos^2(\\frac{\\theta}{2})} = -\\tan^2\\left(\\frac{\\theta}{2}\\right)\n$$\nThis is the closed-form expression for the reflection coefficient.\n\nNext, we quantify the angle-dependent error by the energy reflection fraction $e(\\theta) = |R(\\theta)|^{2}$. The angle $\\theta$ is in $[0, \\pi/2)$, so $\\cos\\theta$ is real, and thus $R(\\theta)$ is real.\n$$\ne(\\theta) = \\left| -\\tan^2\\left(\\frac{\\theta}{2}\\right) \\right|^2 = \\left( \\tan^2\\left(\\frac{\\theta}{2}\\right) \\right)^2 = \\tan^4\\left(\\frac{\\theta}{2}\\right)\n$$\nAlternatively, using the expression in terms of $\\cos\\theta$:\n$$\ne(\\theta) = \\left| \\frac{\\cos\\theta - 1}{\\cos\\theta + 1} \\right|^2 = \\left( \\frac{\\cos\\theta - 1}{\\cos\\theta + 1} \\right)^2 = \\left( \\frac{1 - \\cos\\theta}{1 + \\cos\\theta} \\right)^2\n$$\nBoth forms are equivalent. The formulation in terms of the tangent is more compact.\n\nThe final results are the expressions for the reflection coefficient $R(\\theta)$ and the energy reflection fraction $e(\\theta)$.\n$R(\\theta) = -\\tan^2(\\frac{\\theta}{2})$\n$e(\\theta) = \\tan^4(\\frac{\\theta}{2})$", "answer": "$$\n\\boxed{\\begin{pmatrix} -\\tan^2\\left(\\frac{\\theta}{2}\\right) & \\tan^4\\left(\\frac{\\theta}{2}\\right) \\end{pmatrix}}\n$$", "id": "3572784"}, {"introduction": "Moving from simple approximations to advanced engineering, this practice focuses on the design of a Perfectly Matched Layer (PML). You will develop a PML that meets a target reflection performance while adhering to crucial real-world constraints imposed by numerical stability and spatial discretization. This problem bridges the gap between the continuous theory of the PML and its practical implementation in a finite-difference scheme, a common task for computational geophysicists. [@problem_id:3572786]", "problem": "A one-dimensional acoustic medium of constant wave speed $c$ is truncated and terminated by a perfectly matched layer (PML). The physical domain occupies $x \\le 0$. The PML occupies $0 \\le x \\le L$ and is terminated at $x=L$ by a perfectly reflecting boundary. The PML is implemented via stretched-coordinate damping with $s(x) = 1 + i\\,\\sigma(x)/\\omega$, where $\\omega$ is angular frequency and $\\sigma(x) \\ge 0$ is a prescribed damping profile. Consider normally incident plane waves within the band $f \\in [f_{\\min}, f_{\\max}]$.\n\nThe damping profile is chosen as a polynomial,\n$$\n\\sigma(x) = \\sigma_{\\max} \\left(\\frac{x}{L}\\right)^{m}, \\quad 0 \\le x \\le L,\n$$\nwith integer polynomial order $m \\ge 1$ and peak damping $\\sigma_{\\max} > 0$.\n\nThe numerical discretization in the entire domain (physical region and PML) uses a second-order staggered-grid finite-difference time-domain scheme with spatial grid spacing $h$ selected to resolve the highest frequency by $P$ points per wavelength, and time step $\\Delta t$ chosen by the Courant–Friedrichs–Lewy (CFL) condition with Courant number $\\nu$:\n$$\nh = \\frac{c}{P f_{\\max}}, \\qquad \\Delta t = \\frac{\\nu\\,h}{c}.\n$$\nAssume the following design constraints:\n1. Target reflection magnitude for the return into the physical domain due to the PML truncation is $|R| \\le R_{t}$ for all $f \\in [f_{\\min}, f_{\\max}]$.\n2. Explicit time stepping stability imposes $\\sigma_{\\max}\\,\\Delta t \\le 2$; to minimize $L$, you may saturate this bound.\n3. To suppress discrete interface reflection across the band with a second-order spatial scheme, require $\\sigma'(0)=0$ at the PML entrance; choose the smallest polynomial order $m$ that satisfies this.\n4. For robustness of discrete absorption across incidence angles within the band, require a minimum of $N_{\\min}$ grid cells across the PML, so $L \\ge N_{\\min}\\,h$.\n\nGiven the parameters\n$$\nc = 3000 \\, \\mathrm{m\\,s^{-1}}, \\quad f_{\\min} = 5 \\, \\mathrm{Hz}, \\quad f_{\\max} = 50 \\, \\mathrm{Hz}, \\quad P = 12, \\quad \\nu = 0.5, \\quad R_{t} = 10^{-3}, \\quad N_{\\min} = 10,\n$$\ncompute the pair consisting of:\n- the minimum PML thickness $L$ (in meters) that satisfies all constraints and achieves $|R| \\le R_{t}$ over the band, and\n- the minimum polynomial damping order $m$.\n\nExpress the final thickness in meters and round to four significant figures. Report the two answers as a single row matrix $\\begin{pmatrix} L & m \\end{pmatrix}$ in that order. No intermediate values are needed in the final answer.", "solution": "The problem requires the determination of the minimum Perfectly Matched Layer (PML) thickness, $L$, and the minimum integer polynomial damping order, $m$, that satisfy a given set of design constraints for a one-dimensional acoustic wave propagation problem.\n\nFirst, we validate the problem statement.\nThe givens are:\n- Wave speed: $c = 3000 \\ \\mathrm{m\\,s^{-1}}$\n- Frequency band: $f \\in [f_{\\min}, f_{\\max}]$ with $f_{\\min} = 5 \\ \\mathrm{Hz}$ and $f_{\\max} = 50 \\ \\mathrm{Hz}$\n- Physical domain: $x \\le 0$\n- PML domain: $0 \\le x \\le L$ with a perfectly reflecting boundary at $x=L$\n- Stretched-coordinate parameter: $s(x) = 1 + i\\,\\sigma(x)/\\omega$\n- Damping profile: $\\sigma(x) = \\sigma_{\\max} \\left(\\frac{x}{L}\\right)^{m}$ for $m \\ge 1$ (integer)\n- Discretization parameters: $P = 12$ points per wavelength at $f_{\\max}$, Courant number $\\nu = 0.5$\n- Grid spacing: $h = \\frac{c}{P f_{\\max}}$\n- Time step: $\\Delta t = \\frac{\\nu h}{c}$\n- Constraints:\n  1. Reflection magnitude: $|R| \\le R_{t} = 10^{-3}$ for $f \\in [f_{\\min}, f_{\\max}]$\n  2. Stability: $\\sigma_{\\max}\\,\\Delta t \\le 2$ (saturated to $\\sigma_{\\max}\\,\\Delta t = 2$ to minimize $L$)\n  3. Discrete interface reflection: $\\sigma'(0)=0$, choose smallest integer $m \\ge 1$\n  4. Robustness: $L \\ge N_{\\min}\\,h$ with $N_{\\min} = 10$\n\nThe problem is scientifically grounded in the established theory of PMLs and finite-difference methods. It is well-posed, objective, and contains sufficient information for a unique solution. Therefore, the problem is deemed valid. We proceed with the solution.\n\n1.  Determination of the polynomial order $m$:\n    Constraint 3 requires that the first derivative of the damping profile $\\sigma(x)$ is zero at the physical domain-PML interface, $x=0$. This is to minimize spurious reflections from the discrete interface.\n    The damping profile is $\\sigma(x) = \\sigma_{\\max} \\left(\\frac{x}{L}\\right)^{m}$.\n    Its derivative with respect to $x$ is:\n    $$\n    \\sigma'(x) = \\frac{d}{dx} \\left[ \\sigma_{\\max} \\left(\\frac{x}{L}\\right)^{m} \\right] = \\sigma_{\\max} \\frac{m x^{m-1}}{L^m}\n    $$\n    For $\\sigma'(0)$ to be zero, the exponent of $x$ must be positive, i.e., $m-1 > 0$, which implies $m > 1$.\n    Given that $m$ must be an integer and the problem states $m \\ge 1$, the smallest integer value satisfying $m > 1$ is $m=2$.\n\n2.  Calculation of discretization parameters $h$ and $\\Delta t$:\n    The spatial grid spacing $h$ is set to resolve the shortest wavelength (corresponding to $f_{\\max}$) with $P$ points.\n    $$\n    h = \\frac{c}{P f_{\\max}} = \\frac{3000}{12 \\times 50} = \\frac{3000}{600} = 5 \\ \\text{m}\n    $$\n    The time step $\\Delta t$ is determined by the Courant–Friedrichs–Lewy (CFL) condition with Courant number $\\nu$.\n    $$\n    \\Delta t = \\frac{\\nu h}{c} = \\frac{0.5 \\times 5}{3000} = \\frac{2.5}{3000} = \\frac{1}{1200} \\ \\text{s}\n    $$\n\n3.  Determination of the peak damping $\\sigma_{\\max}$:\n    Constraint 2 provides an explicit time-stepping stability condition, which is to be saturated to minimize $L$:\n    $$\n    \\sigma_{\\max} \\Delta t = 2\n    $$\n    Solving for $\\sigma_{\\max}$:\n    $$\n    \\sigma_{\\max} = \\frac{2}{\\Delta t} = \\frac{2}{1/1200} = 2400 \\ \\mathrm{s^{-1}}\n    $$\n\n4.  Derivation of the reflection constraint on $L$:\n    The theoretical reflection coefficient magnitude $|R|$ for a continuous PML of thickness $L$ terminated by a perfect reflector is given by the two-way attenuation through the layer:\n    $$\n    |R| = \\exp\\left(-2 \\int_0^L \\operatorname{Im}(k_{\\text{PML}}) \\,dx\\right)\n    $$\n    where $k_{\\text{PML}}$ is the wavenumber in the PML. For the stretched-coordinate formulation, the effective wavenumber is $k s(x) = \\frac{\\omega}{c}(1+i\\frac{\\sigma(x)}{\\omega})$. The imaginary part is $\\operatorname{Im}(k s(x)) = \\frac{\\sigma(x)}{c}$. This attenuation is frequency-independent.\n    $$\n    |R| = \\exp\\left(-\\frac{2}{c} \\int_0^L \\sigma(x) \\,dx\\right)\n    $$\n    We first evaluate the integral of the damping profile:\n    $$\n    \\int_0^L \\sigma(x) \\,dx = \\int_0^L \\sigma_{\\max} \\left(\\frac{x}{L}\\right)^m \\,dx = \\frac{\\sigma_{\\max}}{L^m} \\left[ \\frac{x^{m+1}}{m+1} \\right]_0^L = \\frac{\\sigma_{\\max} L}{m+1}\n    $$\n    Substituting this into the expression for $|R|$:\n    $$\n    |R| = \\exp\\left(-\\frac{2 \\sigma_{\\max} L}{c(m+1)}\\right)\n    $$\n    Constraint 1 requires $|R| \\le R_{t}$. Since the expression for $|R|$ is independent of frequency, satisfying this condition for any frequency ensures it holds for the entire band.\n    $$\n    \\exp\\left(-\\frac{2 \\sigma_{\\max} L}{c(m+1)}\\right) \\le R_{t}\n    $$\n    To find the minimum $L$ that satisfies this, we solve for $L$:\n    $$\n    -\\frac{2 \\sigma_{\\max} L}{c(m+1)} \\le \\ln(R_{t})\n    $$\n    Multiplying by $-1$ reverses the inequality:\n    $$\n    \\frac{2 \\sigma_{\\max} L}{c(m+1)} \\ge -\\ln(R_{t}) = \\ln\\left(\\frac{1}{R_{t}}\\right)\n    $$\n    This establishes a lower bound for $L$ based on the required reflection attenuation, which we denote as $L_R$:\n    $$\n    L \\ge \\frac{c(m+1)}{2 \\sigma_{\\max}} \\ln\\left(\\frac{1}{R_{t}}\\right) = L_R\n    $$\n\n5.  Evaluation of the minimum required thickness $L$:\n    We have two lower bounds on $L$:\n    a) From the reflection constraint (Constraint 1): $L \\ge L_{R}$.\n    b) From the robustness constraint (Constraint 4): $L \\ge N_{\\min} h$, which we denote as $L_N$.\n    The minimum thickness $L$ must satisfy both conditions, so $L_{\\min} = \\max(L_R, L_N)$.\n\n    Let's compute the numerical values of $L_R$ and $L_N$.\n    For $L_R$, we use $c=3000$, $m=2$, $\\sigma_{\\max}=2400$, and $R_{t}=10^{-3}$:\n    $$\n    L_R = \\frac{3000 \\times (2+1)}{2 \\times 2400} \\ln\\left(\\frac{1}{10^{-3}}\\right) = \\frac{9000}{4800} \\ln(1000) = \\frac{15}{8} \\ln(1000)\n    $$\n    $L_R = 1.875 \\times \\ln(1000) \\approx 1.875 \\times 6.907755 \\approx 12.95204 \\ \\text{m}$.\n\n    For $L_N$, we use $N_{\\min}=10$ and $h=5$:\n    $$\n    L_N = N_{\\min} h = 10 \\times 5 = 50 \\ \\text{m}\n    $$\n\n    Comparing the two bounds:\n    $$\n    L_{\\min} = \\max(L_R, L_N) = \\max(12.95204, 50) = 50 \\ \\text{m}\n    $$\n    The minimum required PML thickness is $L = 50 \\ \\text{m}$. The problem requests this value rounded to four significant figures, which is $50.00 \\ \\text{m}$.\n\n    The final pair of design parameters is the minimum thickness $L$ and the minimum polynomial order $m$.\n    - Minimum PML thickness: $L = 50.00 \\ \\text{m}$\n    - Minimum polynomial damping order: $m = 2$", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n50.00 & 2\n\\end{pmatrix}\n}\n$$", "id": "3572786"}, {"introduction": "The ultimate test of an absorbing boundary is its ability to handle all field components, including those that do not propagate energy but decay exponentially—the evanescent waves. This advanced exercise confronts this challenge, demonstrating how a naive boundary condition can spuriously reflect these components and create unphysical, growing modes. Through analysis and computation, you will discover the importance of kinematically scaling the boundary condition to ensure it correctly absorbs both propagating and evanescent fields. [@problem_id:3572754]", "problem": "You are asked to evaluate the behavior of an Absorbing Boundary Condition (ABC) when confronted with evanescent components generated by subcritical incidence in a homogeneous acoustic medium. Begin from first principles and derive the required relations, then implement a computational test to measure whether the ABC spuriously absorbs or reflects non-propagating components, and propose a corrective scaling. Your program must be complete and runnable, and it must compute results for the specified test suite and produce them in the exact format described at the end.\n\nConsider a homogeneous, lossless acoustic medium characterized by constant wave speed $c$ in meters per second. Let a time-harmonic field $u(\\mathbf{x},t)$ at angular frequency $\\omega$ in radians per second satisfy the acoustic wave equation. Upon separation of variables, the time-harmonic part $u(\\mathbf{x})$ obeys the Helmholtz equation\n$$\n\\nabla^2 u + k^2 u = 0,\n$$\nwhere $k = \\omega / c$ is the wavenumber in radians per meter. For a plane wave decomposed into tangential and normal components relative to a planar boundary at $z=0$, define the tangential wavenumber $k_x$ (in radians per meter) and the normal wavenumber\n$$\nk_n = \\sqrt{k^2 - k_x^2},\n$$\nwith the convention that the principal square root is taken so that $\\operatorname{Im}(k_n) \\ge 0$. Subcritical incidence refers to the regime $k_x > k$, in which case $k_n = i \\alpha$ with $\\alpha = \\sqrt{k_x^2 - k^2} > 0$, and the field in the $z$ direction is evanescent, of the form $u(z) \\propto e^{-\\alpha z}$ for $z > 0$.\n\nA first-order local Absorbing Boundary Condition (ABC) on the plane $z=0$ is modeled by the Robin-type boundary condition\n$$\n\\frac{\\partial u}{\\partial z} = s \\, u,\n$$\nwhere $s$ is a complex impedance-like parameter chosen by the scheme. Two widely used choices are:\n- A naive Sommerfeld-type choice $s = i k$ that is independent of the ray parameter $k_x$.\n- A kinematically scaled choice $s = i k_n$ that depends on the normal wavenumber.\n\nYour tasks are:\n1. From the Helmholtz equation and the plane-wave decomposition, derive the reflection coefficient $R$ at $z=0$ for a mode with normal wavenumber $k_n$ impinging on this boundary condition. Show how $R$ depends on $s$ and $k_n$ starting from the boundary condition and the superposition of modes in the vicinity of $z=0$.\n2. Specialize your result to the evanescent case $k_x > k$, and explain the physical meaning of the reflection amplitude $|R|$ in terms of the ratio between the growing and decaying exponentials at the boundary. Explain why an ABC should not spuriously absorb or reflect an evanescent component and what condition on $s$ eliminates this spurious effect.\n3. Propose a corrective scaling for $s$ based on your derivation that is consistent with physically correct handling of both propagating ($k_x \\le k$) and evanescent ($k_x > k$) components.\n\nThen implement a program that, for each test case, computes the magnitude $|R|$ under the naive choice $s = i k$ and under the corrective scaled choice $s = i k_n$. Use the following test suite where all physical quantities must be interpreted in the specified units:\n- Frequency $f$ in $\\mathrm{Hz}$, with $\\omega = 2\\pi f$.\n- Wave speed $c$ in $\\mathrm{m/s}$.\n- Ray parameter ratio $r = k_x / k$ (dimensionless), from which $k_x = r k$.\n\nTest suite (each item is $(f,c,r)$):\n1. $(10, 1500, 0.0)$: normal incidence, propagating.\n2. $(10, 1500, 0.8)$: oblique incidence, propagating.\n3. $(10, 1500, 0.999)$: near-grazing incidence from below cutoff, propagating.\n4. $(10, 1500, 1.001)$: slightly above cutoff, evanescent.\n5. $(10, 1500, 1.2)$: well above cutoff, evanescent.\n6. $(20, 2000, 1.5)$: strong evanescence at different $f$ and $c$, evanescent.\n\nYour program must:\n- Compute $k = 2\\pi f / c$ in $\\mathrm{rad/m}$ and $k_x = r\\,k$.\n- Compute $k_n$ as $k_n = \\sqrt{k^2 - k_x^2}$ if $k_x \\le k$, and $k_n = i \\sqrt{k_x^2 - k^2}$ if $k_x > k$.\n- For each case, compute the magnitude $|R|$ under $s = i k$ and under $s = i k_n$.\n\nFinal output format:\n- Produce a single line containing a comma-separated flat list of floating-point numbers enclosed in square brackets.\n- The list must contain $12$ entries in total: for each test case in order, output first the naive $|R|$, then the scaled $|R|$.\n- Each printed number must be rounded to six decimal places.\nExample format with placeholder values: $[0.123456,0.000000,0.234567,0.000000,\\dots]$.", "solution": "The problem is evaluated to be scientifically sound, well-posed, and complete. All necessary physical principles, equations, and parameters for a unique solution are provided. We proceed with the solution.\n\n### 1. Derivation of the Reflection Coefficient $R$\n\nWe consider a time-harmonic acoustic field $u(\\mathbf{x})$, which satisfies the Helmholtz equation in a homogeneous medium with wave speed $c$ and angular frequency $\\omega$:\n$$\n\\nabla^2 u + k^2 u = 0,\n$$\nwhere $k = \\omega/c$ is the wavenumber. We analyze the field near a planar boundary located at $z=0$. The field can be decomposed into plane waves, each characterized by a tangential wavenumber $k_x$. For a fixed $k_x$, the field's spatial dependence is of the form $u(x,z) = U(z) e^{i k_x x}$. Substituting this into the Helmholtz equation yields an ordinary differential equation for $U(z)$:\n$$\n\\frac{d^2U}{dz^2} + (k^2 - k_x^2)U = 0 \\quad \\implies \\quad \\frac{d^2U}{dz^2} + k_n^2 U = 0,\n$$\nwhere $k_n = \\sqrt{k^2 - k_x^2}$ is the normal wavenumber. The problem specifies the convention $\\operatorname{Im}(k_n) \\ge 0$.\n\nLet the computational domain be $z<0$. A wave incident on the boundary at $z=0$ from within the domain travels in the $+z$ direction. The reflected wave travels in the $-z$ direction. The total field $U(z)$ is a superposition of these two components:\n$$\nU(z) = \\underbrace{A e^{i k_n z}}_{\\text{Incident}} + \\underbrace{B e^{-i k_n z}}_{\\text{Reflected}},\n$$\nwhere $A$ is the amplitude of the incident wave and $B$ is the amplitude of the reflected wave. The reflection coefficient is defined as the ratio of these amplitudes, $R = B/A$. Thus, we can write the total field near the boundary as:\n$$\nU(z) = A (e^{i k_n z} + R e^{-i k_n z}).\n$$\nThe ABC is given as a Robin-type boundary condition at $z=0$:\n$$\n\\frac{\\partial u}{\\partial z} = s u,\n$$\nwhere $s$ is a parameter defining the boundary condition. Since the factor $e^{i k_x x}$ is common, this applies directly to $U(z)$:\n$$\n\\left. \\frac{dU}{dz} \\right|_{z=0} = s \\, U(0).\n$$\nWe compute the necessary terms:\n- $U(0) = A(e^0 + R e^0) = A(1+R)$.\n- $\\frac{dU}{dz} = A(i k_n e^{i k_n z} - i k_n R e^{-i k_n z})$.\n- $\\left. \\frac{dU}{dz} \\right|_{z=0} = A(i k_n - i k_n R) = i k_n A(1-R)$.\n\nSubstituting these into the boundary condition equation:\n$$\ni k_n A(1-R) = s A(1+R).\n$$\nAssuming $A \\neq 0$, we can solve for $R$:\n$$\ni k_n - i k_n R = s + sR \\\\\ni k_n - s = R(s + i k_n) \\\\\nR = \\frac{i k_n - s}{s + i k_n}.\n$$\nThis expression gives the reflection coefficient $R$ for a wave with normal wavenumber $k_n$ impinging on a boundary characterized by the parameter $s$.\n\n### 2. Analysis of the Evanescent Case\n\nThe evanescent regime occurs when the tangential wavenumber is greater than the total wavenumber, $k_x > k$. In this case, $k_n^2 = k^2 - k_x^2 < 0$. We define a positive real decay constant $\\alpha = \\sqrt{k_x^2 - k^2}$. The normal wavenumber, subject to the constraint $\\operatorname{Im}(k_n) \\ge 0$, becomes purely imaginary:\n$$\nk_n = \\sqrt{-\\alpha^2} = i \\alpha.\n$$\nSubstituting $k_n = i\\alpha$ into the expression for the total field $U(z)$:\n$$\nU(z) = A(e^{i(i\\alpha)z} + R e^{-i(i\\alpha)z}) = A(e^{-\\alpha z} + R e^{\\alpha z}).\n$$\nIn this context, the field is a superposition of an exponentially decaying component ($e^{-\\alpha z}$), which is physically expected, and an exponentially growing component ($e^{\\alpha z}$), which is unphysical and should not be generated by a passive boundary. The reflection coefficient $R$ now represents the relative amplitude of the spurious, growing mode generated by the boundary condition.\n\nAn ideal ABC should mimic an infinite, sourceless medium. In such a medium, an evanescent field simply decays to zero. Therefore, a perfect ABC for evanescent waves must not generate any growing component, which means the coefficient $R$ must be zero. Let's find the condition on $s$ that achieves this. We substitute $k_n = i\\alpha$ into our formula for $R$:\n$$\nR = \\frac{i(i\\alpha) - s}{s + i(i\\alpha)} = \\frac{-\\alpha - s}{s - \\alpha}.\n$$\nFor there to be no spurious reflection (i.e., no generation of the growing mode), we must have $R=0$. This requires the numerator to be zero:\n$$\n-\\alpha - s = 0 \\quad \\implies \\quad s = -\\alpha.\n$$\nThis is the ideal choice for $s$ to perfectly absorb an evanescent mode with decay rate $\\alpha$.\n\n### 3. Corrective Scaling for the ABC Parameter $s$\n\nWe have found the ideal parameter $s$ for two separate cases:\n- **Propagating waves ($k_x \\le k$):** Here $k_n$ is real and positive. The condition for a perfect one-way ABC is to match the impedance of the outgoing wave, which corresponds to setting $s = i k_n$. This yields $R = \\frac{ik_n - ik_n}{ik_n + ik_n} = 0$.\n- **Evanescent waves ($k_x > k$):** Here $k_n = i\\alpha$. The condition for preventing spurious generation of growing modes is $s = -\\alpha$.\n\nWe seek a single, unified expression for $s$ that is correct in both regimes. We notice that in the evanescent case, $s = -\\alpha = i(i\\alpha) = i k_n$.\nTherefore, the choice\n$$\ns = i k_n\n$$\nis the ideal, corrective scaling that works for **all** values of $k_x$. It perfectly absorbs any incident plane wave, whether it is propagating or evanescent. This is the \"kinematically scaled choice\" mentioned in the problem.\n\nWe contrast this with the \"naive\" Sommerfeld-type choice, $s = i k$, which is independent of the incidence angle (i.e., of $k_x$). For this naive choice, the reflection coefficient is:\n$$\nR_{\\text{naive}} = \\frac{i k_n - i k}{i k + i k_n} = \\frac{k_n - k}{k_n + k}.\n$$\n- For propagating waves ($k_x < k$), $k_n = \\sqrt{k^2 - k_x^2}$ is real and $0 < k_n < k$. Thus, $R_{\\text{naive}} \\neq 0$ (unless $k_x=0$, where $k_n=k$ and $R=0$).\n- For evanescent waves ($k_x > k$), $k_n = i\\alpha$ is purely imaginary. The reflection coefficient becomes $R_{\\text{naive}} = \\frac{i\\alpha - k}{i\\alpha + k}$. The magnitude is:\n$$\n|R_{\\text{naive}}| = \\left| \\frac{-k + i\\alpha}{k + i\\alpha} \\right| = \\frac{\\sqrt{(-k)^2 + \\alpha^2}}{\\sqrt{k^2 + \\alpha^2}} = 1.\n$$\nThis shows that the naive ABC acts as a perfect reflector for all evanescent modes, which is a highly undesirable artifact.\n\nThe computational test will compare $|R|$ for the naive choice ($s=ik$) and the scaled choice ($s=ik_n$). For the scaled choice, $|R_{\\text{scaled}}|=0$ for all cases, as derived.", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the reflection coefficient magnitude for a first-order ABC\n    under two different parameterizations (naive and scaled) for a suite of test cases.\n    \"\"\"\n    # Test suite: each tuple is (frequency f [Hz], wave speed c [m/s], ray parameter ratio r = kx/k)\n    test_cases = [\n        (10, 1500, 0.0),    # Normal incidence, propagating\n        (10, 1500, 0.8),    # Oblique incidence, propagating\n        (10, 1500, 0.999),  # Near-grazing, propagating\n        (10, 1500, 1.001),  # Slightly evanescent\n        (10, 1500, 1.2),    # Evanescent\n        (20, 2000, 1.5),    # Strongly evanescent\n    ]\n\n    results = []\n\n    for f, c, r in test_cases:\n        # Calculate primary physical quantities\n        # k: total wavenumber in rad/m\n        # kx: tangential wavenumber in rad/m\n        k = 2.0 * np.pi * f / c\n        kx = r * k\n\n        # Calculate the squared normal wavenumber\n        # This can be negative for evanescent waves\n        kn_squared = k**2 - kx**2\n\n        # Calculate the normal wavenumber kn, enforcing the Im(kn) >= 0 convention.\n        # np.sqrt on a complex number returns the principal root, which automatically\n        # satisfies this convention for real arguments (positive or negative).\n        kn = np.sqrt(kn_squared + 0j)\n\n        # 1. Compute reflection for the naive choice: s = i*k\n        # The reflection coefficient is R = (k_n - k) / (k_n + k)\n        # The denominator k_n + k is zero only if k=0 (not in tests) or k_n = -k.\n        # Since Im(kn) >= 0 and Re(kn) >= 0, and k > 0, this cannot happen.\n        R_naive_num = kn - k\n        R_naive_den = kn + k\n        R_naive = R_naive_num / R_naive_den\n        abs_R_naive = np.abs(R_naive)\n\n        # 2. Compute reflection for the kinematically scaled choice: s = i*k_n\n        # The reflection coefficient is R = (i*k_n - s) / (s + i*k_n).\n        # With s = i*k_n, the numerator becomes zero, so R = 0, provided k_n is not zero.\n        # If k_n is zero (critical incidence, r=1), the formula is 0/0, but the limit is 0.\n        # Thus, the reflection is always zero for the scaled choice.\n        abs_R_scaled = 0.0\n\n        results.append(round(abs_R_naive, 6))\n        results.append(round(abs_R_scaled, 6))\n\n    # Format the final output string as required\n    print(f\"[{','.join(f'{x:.6f}' for x in results)}]\")\n\nsolve()\n```", "id": "3572754"}]}