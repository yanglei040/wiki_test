{"hands_on_practices": [{"introduction": "Geophysical materials are often anisotropic, meaning their properties vary with direction. This practice focuses on the essential skill of transforming the thermal conductivity tensor from its simple, diagonal form in the material's own crystallographic frame to a more complex, non-diagonal form in the laboratory or geographic frame [@problem_id:3602771]. Mastering this tensor rotation is fundamental for accurately modeling heat flow in realistic geological structures.", "problem": "A crystalline rock specimen used in computational geophysics exhibits orthorhombic anisotropy in its thermal transport, with principal thermal conductivities $k_1$, $k_2$, and $k_3$ along the crystallographic axes $\\hat{a}$, $\\hat{b}$, and $\\hat{c}$, respectively. In the crystallographic frame, the thermal conductivity tensor is diagonal. In the laboratory (geographic) Cartesian frame $(\\hat{x},\\hat{y},\\hat{z})$, the specimen is oriented by a yaw angle $\\varphi$ about $\\hat{z}$ followed by a tilt angle $\\theta$ about $\\hat{y}$. Both angles are measured in radians. The thermal conduction is governed by Fourier’s law, which in Cartesian coordinates reads $\\boldsymbol{q}=-\\mathbf{K}\\,\\nabla T$, where $\\boldsymbol{q}$ is the heat flux vector, $\\mathbf{K}$ is the second-rank conductivity tensor, and $T$ is temperature. Under proper orthonormal changes of basis, vectors and gradients transform by the same rotation, and the scalar contraction $\\boldsymbol{q}\\cdot\\nabla T$ is invariant.\n\nStarting from these principles, derive the laboratory-frame expression for the off-diagonal component $K_{xz}$ of the rotated conductivity tensor. The rotation from the crystallographic frame to the laboratory frame is defined by the matrix\n$$\n\\mathbf{R}=\\mathbf{R}_y(\\theta)\\,\\mathbf{R}_z(\\varphi),\n$$\nwhere\n$$\n\\mathbf{R}_z(\\varphi)=\\begin{pmatrix}\n\\cos(\\varphi) & -\\sin(\\varphi) & 0 \\\\\n\\sin(\\varphi) & \\cos(\\varphi) & 0 \\\\\n0 & 0 & 1\n\\end{pmatrix},\\qquad\n\\mathbf{R}_y(\\theta)=\\begin{pmatrix}\n\\cos(\\theta) & 0 & \\sin(\\theta) \\\\\n0 & 1 & 0 \\\\\n-\\sin(\\theta) & 0 & \\cos(\\theta)\n\\end{pmatrix}.\n$$\nLet the conductivity tensor in the crystallographic frame be\n$$\n\\mathbf{K}_{\\mathrm{c}}=\\operatorname{diag}(k_1,k_2,k_3).\n$$\nUse the invariance of the physical law $\\boldsymbol{q}=-\\mathbf{K}\\,\\nabla T$ under rotations to obtain the rotated tensor in the laboratory frame and then write a closed-form analytic expression for $K_{xz}$ in terms of $k_1$, $k_2$, $k_3$, $\\varphi$, and $\\theta$. Provide your final expression for $K_{xz}$ and express the physical unit as $\\mathrm{W\\,m^{-1}\\,K^{-1}}$. No numerical evaluation is required.", "solution": "The problem statement is subjected to validation before a solution is attempted.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n- **Physical System**: A crystalline rock with orthorhombic thermal anisotropy.\n- **Principal Thermal Conductivities**: $k_1$, $k_2$, $k_3$ along crystallographic axes $\\hat{a}$, $\\hat{b}$, $\\hat{c}$.\n- **Conductivity Tensor in Crystallographic Frame**: $\\mathbf{K}_{\\mathrm{c}} = \\operatorname{diag}(k_1, k_2, k_3)$.\n- **Governing Equation**: Fourier's law, $\\boldsymbol{q}=-\\mathbf{K}\\,\\nabla T$.\n- **Coordinate Transformation**: The laboratory frame $(\\hat{x},\\hat{y},\\hat{z})$ is obtained from the crystallographic frame by a rotation $\\mathbf{R}=\\mathbf{R}_y(\\theta)\\,\\mathbf{R}_z(\\varphi)$.\n- **Rotation Matrices**:\n$$\n\\mathbf{R}_z(\\varphi)=\\begin{pmatrix}\n\\cos(\\varphi) & -\\sin(\\varphi) & 0 \\\\\n\\sin(\\varphi) & \\cos(\\varphi) & 0 \\\\\n0 & 0 & 1\n\\end{pmatrix},\\qquad\n\\mathbf{R}_y(\\theta)=\\begin{pmatrix}\n\\cos(\\theta) & 0 & \\sin(\\theta) \\\\\n0 & 1 & 0 \\\\\n-\\sin(\\theta) & 0 & \\cos(\\theta)\n\\end{pmatrix}.\n$$\n- **Invariance Condition**: The scalar contraction $\\boldsymbol{q}\\cdot\\nabla T$ is invariant under orthonormal changes of basis.\n- **Objective**: Derive the expression for the off-diagonal component $K_{xz}$ of the conductivity tensor in the laboratory frame.\n\n**Step 2: Validate Using Extracted Givens**\n1.  **Scientific Grounding**: The problem is based on the established principles of continuum mechanics and thermodynamics, specifically the theory of heat conduction in anisotropic media. The use of a second-rank tensor for thermal conductivity and its transformation under rotation are standard concepts in physics and engineering. The physical setup is realistic for materials studied in geophysics.\n2.  **Well-Posedness**: The problem is clearly defined and provides all necessary information to derive the requested quantity. The initial tensor, the rotation operations, and the transformation law are explicitly given. A unique solution exists and can be obtained through direct calculation.\n3.  **Objectivity**: The problem is stated in precise, objective, and quantitative terms, free from any subjectivity or ambiguity.\n\nThe problem is self-contained, scientifically sound, and well-posed. No flaws listed in the validation criteria are present.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A solution will be provided.\n\n### Derivation of the Solution\n\nThe physical properties described by a second-rank tensor, such as the thermal conductivity $\\mathbf{K}$, transform under a rotation of the coordinate system. Let the crystallographic frame be the unprimed frame and the laboratory frame be the primed frame. A vector $\\mathbf{v}$ in the unprimed frame is transformed to $\\mathbf{v}' = \\mathbf{R}\\mathbf{v}$ in the primed frame. The problem states that the rotation from the crystallographic frame to the laboratory frame is given by the matrix $\\mathbf{R}$. Therefore, the conductivity tensor in the laboratory frame, which we denote as $\\mathbf{K}$, is related to the conductivity tensor in the crystallographic frame, $\\mathbf{K}_{\\mathrm{c}}$, by the similarity transformation:\n$$\n\\mathbf{K} = \\mathbf{R} \\mathbf{K}_{\\mathrm{c}} \\mathbf{R}^{T}\n$$\nwhere $\\mathbf{R}^{T}$ is the transpose of $\\mathbf{R}$.\n\nThe components of the transformed tensor $\\mathbf{K}$ are given by:\n$$\nK_{ij} = \\sum_{l=1}^{3} \\sum_{m=1}^{3} R_{il} (K_{\\mathrm{c}})_{lm} R_{jm}\n$$\nSince $\\mathbf{K}_{\\mathrm{c}}$ is a diagonal tensor, with $(K_{\\mathrm{c}})_{lm} = k_l \\delta_{lm}$ where $\\delta_{lm}$ is the Kronecker delta, the expression simplifies to:\n$$\nK_{ij} = \\sum_{l=1}^{3} R_{il} (k_l) R_{jl} = \\sum_{l=1}^{3} k_l R_{il} R_{jl}\n$$\nWe are asked to find the component $K_{xz}$, which in matrix index notation corresponds to $K_{13}$. Setting $i=1$ and $j=3$, we have:\n$$\nK_{xz} = K_{13} = \\sum_{l=1}^{3} k_l R_{1l} R_{3l} = k_1 R_{11} R_{31} + k_2 R_{12} R_{32} + k_3 R_{13} R_{33}\n$$\nThe next step is to compute the rotation matrix $\\mathbf{R} = \\mathbf{R}_y(\\theta)\\mathbf{R}_z(\\varphi)$.\n$$\n\\mathbf{R} = \\begin{pmatrix}\n\\cos(\\theta) & 0 & \\sin(\\theta) \\\\\n0 & 1 & 0 \\\\\n-\\sin(\\theta) & 0 & \\cos(\\theta)\n\\end{pmatrix}\n\\begin{pmatrix}\n\\cos(\\varphi) & -\\sin(\\varphi) & 0 \\\\\n\\sin(\\varphi) & \\cos(\\varphi) & 0 \\\\\n0 & 0 & 1\n\\end{pmatrix}\n$$\nPerforming the matrix multiplication gives:\n$$\n\\mathbf{R} = \\begin{pmatrix}\n\\cos(\\theta)\\cos(\\varphi) & -\\cos(\\theta)\\sin(\\varphi) & \\sin(\\theta) \\\\\n\\sin(\\varphi) & \\cos(\\varphi) & 0 \\\\\n-\\sin(\\theta)\\cos(\\varphi) & \\sin(\\theta)\\sin(\\varphi) & \\cos(\\theta)\n\\end{pmatrix}\n$$\nFrom this matrix, we identify the required components:\n- $R_{11} = \\cos(\\theta)\\cos(\\varphi)$\n- $R_{12} = -\\cos(\\theta)\\sin(\\varphi)$\n- $R_{13} = \\sin(\\theta)$\n- $R_{31} = -\\sin(\\theta)\\cos(\\varphi)$\n- $R_{32} = \\sin(\\theta)\\sin(\\varphi)$\n- $R_{33} = \\cos(\\theta)$\n\nNow we substitute these components into the expression for $K_{xz}$:\n$$\nK_{xz} = k_1 (\\cos(\\theta)\\cos(\\varphi))(-\\sin(\\theta)\\cos(\\varphi)) + k_2 (-\\cos(\\theta)\\sin(\\varphi))(\\sin(\\theta)\\sin(\\varphi)) + k_3 (\\sin(\\theta))(\\cos(\\theta))\n$$\nSimplifying each term:\n$$\nK_{xz} = -k_1 \\sin(\\theta)\\cos(\\theta)\\cos^{2}(\\varphi) - k_2 \\sin(\\theta)\\cos(\\theta)\\sin^{2}(\\varphi) + k_3 \\sin(\\theta)\\cos(\\theta)\n$$\nWe can factor out the common term $\\sin(\\theta)\\cos(\\theta)$:\n$$\nK_{xz} = \\sin(\\theta)\\cos(\\theta) \\left[ k_3 - k_1\\cos^{2}(\\varphi) - k_2\\sin^{2}(\\varphi) \\right]\n$$\nTo obtain a more physically insightful form, we can use the identity $1 = \\cos^{2}(\\varphi) + \\sin^{2}(\\varphi)$ to rewrite $k_3$:\n$$\nK_{xz} = \\sin(\\theta)\\cos(\\theta) \\left[ k_3(\\cos^{2}(\\varphi) + \\sin^{2}(\\varphi)) - k_1\\cos^{2}(\\varphi) - k_2\\sin^{2}(\\varphi) \\right]\n$$\nGrouping terms with $\\cos^{2}(\\varphi)$ and $\\sin^{2}(\\varphi)$:\n$$\nK_{xz} = \\sin(\\theta)\\cos(\\theta) \\left[ (k_3 - k_1)\\cos^{2}(\\varphi) + (k_3 - k_2)\\sin^{2}(\\varphi) \\right]\n$$\nThis is the final closed-form expression for the $K_{xz}$ component of the thermal conductivity tensor in the laboratory frame. This expression shows that the off-diagonal component $K_{xz}$ is non-zero only if the material is anisotropic (i.e., $k_1, k_2, k_3$ are not all equal) and the orientation involves a tilt angle $\\theta$ that is not an integer multiple of $\\pi/2$. The physical units of each component of the thermal conductivity tensor, including $K_{xz}$, are $\\mathrm{W\\,m^{-1}\\,K^{-1}}$.", "answer": "$$\n\\boxed{\\sin(\\theta)\\cos(\\theta) \\left[ (k_3 - k_1)\\cos^{2}(\\varphi) + (k_3 - k_2)\\sin^{2}(\\varphi) \\right]}\n$$", "id": "3602771"}, {"introduction": "The cooling of a magmatic body is governed by the interplay between heat conduction within the body and heat convection at its boundaries. This exercise delves into this interaction by deriving the dominant cooling timescales in two key physical regimes, distinguished by the dimensionless Biot number [@problem_id:3602787]. By analyzing these asymptotic limits, you will develop a deeper intuition for whether a cooling process is controlled by internal diffusion or boundary exchange.", "problem": "A laterally extensive magmatic sill of uniform thickness $2L$ is emplaced at initial uniform temperature $T_{i}$ within a cooler environment at ambient temperature $T_{\\infty}$. The sill surfaces at $x=\\pm L$ exchange heat with the ambient fluid by convection with a constant heat transfer coefficient $h$. The sill is homogeneous and isotropic with density $\\rho$, specific heat capacity $c$, and thermal conductivity $k$, and radiative heat transfer is negligible. Assume one-dimensional heat conduction in the slab direction $x$, symmetry about the mid-plane $x=0$, and constant thermophysical properties. Starting from conservation of energy and Fourier’s law of heat conduction, derive from first principles the governing model and compute the dominant exponential cooling timescale $\\tau$ for the spatially averaged temperature departure from the ambient, defined by the leading decay constant of the solution for the temperature difference $\\theta(x,t)=T(x,t)-T_{\\infty}$.\n\nIntroduce the Biot number $\\mathrm{Bi}=hL/k$ and analyze the two asymptotic regimes $\\mathrm{Bi}\\ll 1$ and $\\mathrm{Bi}\\gg 1$. In each regime, obtain the leading-order closed-form analytic expression for the dominant cooling timescale $\\tau$ as a function of $L$, $h$, $k$, $\\rho$, and $c$. Provide your final answers in the order $\\mathrm{Bi}\\ll 1$ then $\\mathrm{Bi}\\gg 1$ as two expressions. No numerical evaluation is required and no rounding is required. Do not include units in your final boxed answer.", "solution": "The appropriate starting point is the local conservation of energy for a continuum coupled with Fourier’s law of heat conduction. Let $\\theta(x,t)=T(x,t)-T_{\\infty}$ denote the temperature departure from the ambient. For a homogeneous medium with density $\\rho$, specific heat $c$, and thermal conductivity $k$, the internal energy balance reads\n$$\n\\rho c \\,\\frac{\\partial \\theta}{\\partial t} = k \\,\\frac{\\partial^{2} \\theta}{\\partial x^{2}},\n$$\nwhich is the one-dimensional transient heat equation. It can be written as\n$$\n\\frac{\\partial \\theta}{\\partial t} = \\alpha \\,\\frac{\\partial^{2} \\theta}{\\partial x^{2}},\n$$\nwhere the thermal diffusivity is $\\alpha = \\frac{k}{\\rho c}$. The domain is the half-slab $0 \\le x \\le L$ by symmetry, with initial condition $\\theta(x,0)=T_{i}-T_{\\infty}$.\n\nThe boundary conditions follow from symmetry and convective exchange. At the mid-plane $x=0$, symmetry implies a zero gradient,\n$$\n\\left.\\frac{\\partial \\theta}{\\partial x}\\right|_{x=0} = 0.\n$$\nAt the surface $x=L$, Fourier’s law gives the conductive heat flux $-k \\,\\partial \\theta/\\partial x$, and Newton’s law of cooling gives the convective heat flux $h\\,\\theta(L,t)$. Energy balance at the boundary requires these to be equal (outward conductive flux equals convective loss),\n$$\n-k \\left.\\frac{\\partial \\theta}{\\partial x}\\right|_{x=L} = h\\,\\theta(L,t).\n$$\n\nWe seek modal solutions by separation of variables. Let $\\theta(x,t) = X(x)\\,G(t)$. Substituting into the heat equation yields\n$$\nX(x)\\,\\frac{\\mathrm{d}G}{\\mathrm{d}t} = \\alpha\\,G(t)\\,\\frac{\\mathrm{d}^{2}X}{\\mathrm{d}x^{2}},\n$$\nwhich separates to\n$$\n\\frac{1}{\\alpha}\\,\\frac{1}{G}\\,\\frac{\\mathrm{d}G}{\\mathrm{d}t} = \\frac{1}{X}\\,\\frac{\\mathrm{d}^{2}X}{\\mathrm{d}x^{2}} = -\\lambda,\n$$\nwhere $\\lambda>0$ is a separation constant (eigenvalue). The temporal factor is\n$$\nG(t) = G(0)\\,\\exp(-\\alpha \\lambda t),\n$$\nand the spatial eigenfunction satisfies\n$$\n\\frac{\\mathrm{d}^{2}X}{\\mathrm{d}x^{2}} + \\lambda X = 0.\n$$\nThe general solution is\n$$\nX(x) = A \\cos(\\sqrt{\\lambda}\\,x) + B \\sin(\\sqrt{\\lambda}\\,x).\n$$\nThe symmetry boundary condition at $x=0$ implies $X'(0)=0$, which gives $B=0$. Thus\n$$\nX(x) = A \\cos(\\sqrt{\\lambda}\\,x).\n$$\nImposing the convective boundary condition at $x=L$,\n$$\n-k\\,X'(L) = h\\,X(L),\n$$\nyields\n$$\n-k\\left[-A \\sqrt{\\lambda} \\sin(\\sqrt{\\lambda}\\,L)\\right] = h\\left[A \\cos(\\sqrt{\\lambda}\\,L)\\right],\n$$\nor equivalently\n$$\nk \\sqrt{\\lambda}\\,\\sin(\\sqrt{\\lambda}\\,L) = h \\cos(\\sqrt{\\lambda}\\,L).\n$$\nDividing both sides by $k \\sqrt{\\lambda}\\,\\cos(\\sqrt{\\lambda}\\,L)$,\n$$\n\\tan(\\sqrt{\\lambda}\\,L) = \\frac{h}{k \\sqrt{\\lambda}}.\n$$\nDefine the dimensionless eigenvalue $\\mu = \\sqrt{\\lambda}\\,L$. Introducing the Biot number $\\mathrm{Bi} = \\frac{h L}{k}$, the eigenvalue condition becomes\n$$\n\\tan(\\mu) = \\frac{\\mathrm{Bi}}{\\mu}\n\\quad\\Longleftrightarrow\\quad\n\\mu\\,\\tan(\\mu) = \\mathrm{Bi}.\n$$\nThis transcendental equation determines the discrete set of eigenvalues $\\mu_{n}$, $n=1,2,\\dots$, with corresponding temporal decay rates $\\alpha \\lambda_{n} = \\alpha \\mu_{n}^{2}/L^{2}$. Any admissible initial condition can be expanded in these eigenmodes, and for long times the solution is dominated by the slowest decaying mode $n=1$ with the smallest positive $\\mu_{1}$.\n\nThe dominant exponential cooling timescale $\\tau$ for the spatially averaged temperature departure is set by the leading decay rate,\n$$\n\\tau = \\frac{1}{\\alpha \\lambda_{1}} = \\frac{L^{2}}{\\alpha \\mu_{1}^{2}}.\n$$\nTo obtain explicit closed-form expressions, we analyze the two asymptotic regimes for $\\mathrm{Bi}$.\n\nRegime $\\mathrm{Bi}\\ll 1$ (weak convection, lumped-capacitance limit):\nFor small $\\mathrm{Bi}$, the eigenvalue $\\mu_{1}$ is small. Use the expansion $\\tan(\\mu) = \\mu + \\frac{\\mu^{3}}{3} + \\mathcal{O}(\\mu^{5})$. Substituting into $\\mu \\tan(\\mu) = \\mathrm{Bi}$ gives\n$$\n\\mu^{2} + \\frac{\\mu^{4}}{3} + \\mathcal{O}(\\mu^{6}) = \\mathrm{Bi}.\n$$\nTo leading order, $\\mu_{1}^{2} \\approx \\mathrm{Bi}$, hence\n$$\n\\tau \\approx \\frac{L^{2}}{\\alpha\\,\\mathrm{Bi}}.\n$$\nExpressed in material parameters, using $\\alpha = k/(\\rho c)$ and $\\mathrm{Bi} = hL/k$,\n$$\n\\tau \\approx \\frac{L^{2}}{(k/(\\rho c))\\,(hL/k)} = \\frac{\\rho c\\,L}{h}.\n$$\nThis is the classical lumped-capacitance timescale, reflecting boundary-controlled cooling when internal conduction rapidly equilibrates the slab.\n\nRegime $\\mathrm{Bi}\\gg 1$ (strong convection, conduction-limited interior):\nFor large $\\mathrm{Bi}$, the boundary is nearly isothermal at ambient, and the smallest eigenvalue approaches the Dirichlet–Neumann mixed case. Let $\\mu_{1} = \\frac{\\pi}{2} - \\varepsilon$ with $\\varepsilon \\ll 1$. Using $\\tan\\left(\\frac{\\pi}{2}-\\varepsilon\\right) = \\cot(\\varepsilon) \\approx \\frac{1}{\\varepsilon} - \\frac{\\varepsilon}{3} + \\mathcal{O}(\\varepsilon^{3})$, we find\n$$\n\\mu_{1}\\,\\tan(\\mu_{1}) \\approx \\left(\\frac{\\pi}{2} - \\varepsilon\\right)\\left(\\frac{1}{\\varepsilon} - \\frac{\\varepsilon}{3}\\right)\n= \\frac{\\pi}{2}\\,\\frac{1}{\\varepsilon} - \\frac{\\pi}{6}\\,\\varepsilon - 1 + \\mathcal{O}(\\varepsilon^{3}).\n$$\nBalancing the leading term with $\\mathrm{Bi}$ gives $\\varepsilon \\approx \\frac{\\pi}{2\\,\\mathrm{Bi}}$. Then\n$$\n\\mu_{1}^{2} = \\left(\\frac{\\pi}{2} - \\varepsilon\\right)^{2} \\approx \\frac{\\pi^{2}}{4} - \\frac{\\pi^{2}}{2\\,\\mathrm{Bi}} + \\mathcal{O}\\!\\left(\\frac{1}{\\mathrm{Bi}^{2}}\\right).\n$$\nTo leading order,\n$$\n\\mu_{1}^{2} \\approx \\frac{\\pi^{2}}{4},\n\\qquad\n\\tau \\approx \\frac{L^{2}}{\\alpha\\,(\\pi^{2}/4)} = \\frac{4 L^{2}}{\\pi^{2}\\,\\alpha}.\n$$\nIn material parameters,\n$$\n\\tau \\approx \\frac{4 L^{2}}{\\pi^{2}\\,(k/(\\rho c))} = \\frac{4 \\rho c\\,L^{2}}{\\pi^{2}\\,k}.\n$$\nThis conduction-limited timescale reflects the slowest interior diffusion mode with an effectively pinned surface temperature.\n\nCollecting the leading-order results in the requested order $\\mathrm{Bi}\\ll 1$ then $\\mathrm{Bi}\\gg 1$, the dominant cooling timescale is\n$$\n\\tau \\approx \\frac{\\rho c\\,L}{h}\n\\quad\\text{for}\\quad \\mathrm{Bi}\\ll 1,\n\\qquad\n\\tau \\approx \\frac{4 \\rho c\\,L^{2}}{\\pi^{2}\\,k}\n\\quad\\text{for}\\quad \\mathrm{Bi}\\gg 1.\n$$", "answer": "$$\\boxed{\\begin{pmatrix}\\dfrac{\\rho c\\,L}{h} & \\dfrac{4\\,\\rho c\\,L^{2}}{\\pi^{2}\\,k}\\end{pmatrix}}$$", "id": "3602787"}, {"introduction": "Many crucial geophysical processes, such as mantle convection and lithospheric dynamics, occur on a planetary scale where spherical geometry and heterogeneous material properties are paramount. This advanced computational exercise guides you through the implementation of a spectral Galerkin method to solve for steady-state heat flow on a sphere with spatially varying conductivity [@problem_id:3602798]. You will tackle key numerical challenges, including basis function representation, quadrature, and preconditioned iterative solvers, building skills directly applicable to global-scale modeling.", "problem": "Consider steady heat conduction on the unit sphere $S^2$ with heterogeneous conductivity $k(\\theta,\\phi)$, governed by the conservation law and Fourier's law on a smooth manifold: find a scalar temperature field $T(\\theta,\\phi)$ with zero mean over $S^2$ satisfying\n$$\n\\nabla_s \\cdot \\left(k(\\theta,\\phi)\\,\\nabla_s T(\\theta,\\phi)\\right) = f(\\theta,\\phi)\n$$\nwhere $\\nabla_s$ is the surface gradient operator and $\\nabla_s\\cdot$ is the surface divergence. The operator $\\nabla_s^2 = \\nabla_s\\cdot\\nabla_s$ is the Laplace–Beltrami operator on $S^2$. Angles must be treated in radians.\n\nYou will implement a spectral Galerkin method with a spherical harmonic basis truncated at degree $l_{\\mathrm{max}}$, preconditioned by the diagonal Laplace–Beltrami spectrum. The unknown is expanded in a real spherical harmonic basis $\\{Y_{\\alpha}(\\theta,\\phi)\\}$ indexed by mode $\\alpha$ corresponding to a pair $(l,m)$ and a trigonometric type:\n- For $m=0$: $Y_{l,0}(\\theta,\\phi) = N_{l,0} P_l^0(\\cos\\theta)$,\n- For $m>0$ (cosine type): $Y^{(c)}_{l,m}(\\theta,\\phi) = \\sqrt{2}\\,N_{l,m} P_l^m(\\cos\\theta)\\cos(m\\phi)$,\n- For $m>0$ (sine type): $Y^{(s)}_{l,m}(\\theta,\\phi) = \\sqrt{2}\\,N_{l,m} P_l^m(\\cos\\theta)\\sin(m\\phi)$,\nwhere $P_l^m$ are the associated Legendre polynomials, and the normalization $N_{l,m}$ is\n$$\nN_{l,m} = \\sqrt{\\frac{2l+1}{4\\pi}\\,\\frac{(l-m)!}{(l+m)!}}.\n$$\nThis real basis is orthonormal on $S^2$ with respect to the surface measure $d\\Omega = \\sin\\theta\\,d\\theta\\,d\\phi$. The stiffness matrix is defined by the weak form\n$$\nA_{\\alpha\\beta} \\equiv \\int_{S^2} k(\\theta,\\phi)\\,\\nabla_s Y_\\beta(\\theta,\\phi)\\cdot\\nabla_s Y_\\alpha(\\theta,\\phi)\\,d\\Omega,\n$$\nand the load vector components are\n$$\nb_\\alpha \\equiv \\int_{S^2} f(\\theta,\\phi)\\,Y_\\alpha(\\theta,\\phi)\\,d\\Omega.\n$$\nThe preconditioner $M$ must be diagonal in the spherical harmonic basis, using the Laplace–Beltrami eigenvalues scaled by the area-weighted average conductivity $\\overline{k}$:\n$$\nM_{\\alpha\\alpha} = \\overline{k}\\,l(l+1),\n$$\nfor each active mode with $l\\ge 1$. The null space corresponding to $l=0$ must be excluded from the linear system (enforcing the zero-mean constraint).\n\nDiscretize the surface integrals by equiangular quadrature with midpoints that avoid the poles:\n- Use $N_\\theta$ polar samples at $\\theta_i = \\left(i+\\frac{1}{2}\\right)\\frac{\\pi}{N_\\theta}$ for $i=0,\\dots,N_\\theta-1$,\n- Use $N_\\phi$ azimuthal samples at $\\phi_j = j\\frac{2\\pi}{N_\\phi}$ for $j=0,\\dots,N_\\phi-1$,\nand weights $w_{ij} = \\sin\\theta_i\\,\\Delta\\theta\\,\\Delta\\phi$ where $\\Delta\\theta=\\pi/N_\\theta$ and $\\Delta\\phi=2\\pi/N_\\phi$. For the stiffness matrix, the integrand uses\n$$\n\\nabla_s Y_\\beta\\cdot\\nabla_s Y_\\alpha = \\left(\\frac{\\partial Y_\\beta}{\\partial \\theta}\\frac{\\partial Y_\\alpha}{\\partial \\theta}\\right) + \\left(\\frac{1}{\\sin^2\\theta}\\frac{\\partial Y_\\beta}{\\partial \\phi}\\frac{\\partial Y_\\alpha}{\\partial \\phi}\\right).\n$$\nUse the identity $\\frac{\\partial}{\\partial \\theta}P_l^m(\\cos\\theta) = -\\sin\\theta\\,\\frac{d}{dx}P_l^m(x)\\big|_{x=\\cos\\theta}$ to compute polar derivatives, and exact trigonometric derivatives for azimuthal terms. The right-hand side must be taken as a fixed combination of real spherical harmonics with zero mean,\n$$\nf(\\theta,\\phi) = Y_{2,0}(\\theta,\\phi) + \\frac{1}{2}Y^{(c)}_{3,2}(\\theta,\\phi),\n$$\nso that solvability is guaranteed after removing the $l=0$ mode.\n\nConductivity heterogeneity is smooth and parameterized by a contrast factor $r\\ge 1$ as\n$$\nk(\\theta,\\phi;r) = 1 + (r-1)\\,\\left(\\sin^4\\theta\\right)\\,\\left(\\cos^2(2\\phi)\\right),\n$$\nso that $\\min k = 1$ and $\\max k = r$. The area-weighted average $\\overline{k}$ must be computed as\n$$\n\\overline{k} = \\frac{\\int_{S^2} k(\\theta,\\phi)\\,d\\Omega}{\\int_{S^2} d\\Omega}\n$$\nusing the same quadrature.\n\nImplement a Preconditioned Conjugate Gradient (PCG) solver for the reduced symmetric positive definite linear system with active modes $l\\ge 1$, tolerance $\\varepsilon$ on the relative residual $\\|r\\|_2/\\|b\\|_2$, and a maximum number of iterations $K_{\\max}$. The preconditioner application is $z = M^{-1}r$ elementwise. Initialize $x=0$ and iterate until convergence. Report the number of iterations taken to reach $\\|r\\|_2/\\|b\\|_2 \\le \\varepsilon$.\n\nYour program must:\n- Use the truncation $l_{\\mathrm{max}}$, and quadrature sizes $N_\\theta$ and $N_\\phi$ exactly as specified in the test suite,\n- Assemble $A$ and $b$ by quadrature as above,\n- Exclude the $l=0$ mode from $A$, $b$, and $M$,\n- Solve with PCG and the spherical harmonic diagonal preconditioner $M$; do not use any external iterative solver routines.\n\nTest Suite:\n- Case $1$: $N_\\theta=36$, $N_\\phi=72$, $l_{\\mathrm{max}}=9$, $r=1$, $\\varepsilon=10^{-8}$, $K_{\\max}=500$.\n- Case $2$: $N_\\theta=36$, $N_\\phi=72$, $l_{\\mathrm{max}}=9$, $r=10$, $\\varepsilon=10^{-8}$, $K_{\\max}=500$.\n- Case $3$: $N_\\theta=36$, $N_\\phi=72$, $l_{\\mathrm{max}}=9$, $r=100$, $\\varepsilon=10^{-8}$, $K_{\\max}=500$.\n- Case $4$: $N_\\theta=36$, $N_\\phi=72$, $l_{\\mathrm{max}}=9$, $r=1000$, $\\varepsilon=10^{-8}$, $K_{\\max}=500$.\n\nFinal Output Format:\nYour program should produce a single line of output containing the iteration counts for the four cases as a comma-separated list enclosed in square brackets (e.g., \"[$i_1$,$i_2$,$i_3$,$i_4$]\"), where each $i_k$ is an integer. No extra text may be printed.", "solution": "The user wants to solve a steady-state heat conduction problem on a sphere using a spectral Galerkin method.\n\n### 1. Verification of the Problem Statement\n\nThe problem is to find the temperature field $T(\\theta, \\phi)$ on a unit sphere $S^2$ governed by the elliptic partial differential equation:\n$$\n\\nabla_s \\cdot \\left(k(\\theta,\\phi)\\,\\nabla_s T(\\theta,\\phi)\\right) = f(\\theta,\\phi)\n$$\nwith a specified heterogeneous thermal conductivity $k(\\theta,\\phi)$ and a source term $f(\\theta,\\phi)$. The solution $T$ is constrained to have a zero mean over the sphere, i.e., $\\int_{S^2} T\\,d\\Omega=0$. This is a standard problem in mathematical physics and geophysics, often referred to as a variable-coefficient Poisson-type equation on a manifold.\n\nThe proposed solution method is a spectral Galerkin approach using a real spherical harmonic basis. This is a suitable and powerful technique for problems on a spherical domain. The problem specifies all necessary components: the basis functions, the method for deriving the linear system (weak form), the numerical integration (quadrature) scheme, the structure of the preconditioner, and the iterative solver (Preconditioned Conjugate Gradient).\n\nAll parameters, functions, and constraints are well-defined and scientifically consistent. The source term $f(\\theta,\\phi)$ is composed of spherical harmonics of degree $l \\ge 1$, which correctly implies $\\int_{S^2} f\\,d\\Omega = 0$. This is the necessary compatibility condition for the existence of a solution to the PDE. The removal of the $l=0$ (constant) mode from the solution space correctly enforces the zero-mean constraint and ensures the resulting linear system is non-singular. The problem is well-posed, computationally specific, and scientifically grounded. It is therefore deemed valid.\n\n### 2. Theoretical Framework and Algorithmic Design\n\n#### 2.1. Weak Formulation and Galerkin Method\nThe first step is to derive the weak formulation of the PDE. We multiply the equation by a smooth test function $v(\\theta, \\phi)$ with zero mean and integrate over the sphere $S^2$:\n$$\n\\int_{S^2} v \\left(\\nabla_s \\cdot (k \\nabla_s T)\\right) d\\Omega = \\int_{S^2} v f d\\Omega\n$$\nUsing Green's first identity (integration by parts on a manifold), and noting that the sphere has no boundary, the left-hand side becomes:\n$$\n- \\int_{S^2} k(\\theta, \\phi) \\nabla_s v \\cdot \\nabla_s T \\, d\\Omega = \\int_{S^2} v f \\,d\\Omega\n$$\nThe Galerkin method approximates the unknown temperature field $T$ as a finite linear combination of basis functions $\\{Y_\\alpha\\}$:\n$$\nT(\\theta, \\phi) \\approx \\sum_{\\beta} x_\\beta Y_\\beta(\\theta, \\phi)\n$$\nwhere $x_\\beta$ are the unknown coefficients to be determined. The basis functions $\\{Y_\\alpha\\}$ are the real spherical harmonics, truncated at a maximum degree $l_{\\mathrm{max}}$. Since $T$ must have zero mean, we exclude the $Y_{0,0}$ mode (which is a constant) from the basis.\n\nWe choose the test functions $v$ to be the same basis functions $Y_\\alpha$ from our truncated set. Substituting the expansion for $T$ and setting $v = Y_\\alpha$ for each basis function in the set, we obtain a system of linear equations $Ax=b$:\n$$\n\\sum_{\\beta} \\left( \\int_{S^2} k(\\theta, \\phi) \\nabla_s Y_\\alpha \\cdot \\nabla_s Y_\\beta \\, d\\Omega \\right) x_\\beta = \\int_{S^2} Y_\\alpha f \\, d\\Omega\n$$\nThis defines the stiffness matrix $A$ and the load vector $b$:\n$$\nA_{\\alpha\\beta} = \\int_{S^2} k(\\theta, \\phi) \\nabla_s Y_\\alpha \\cdot \\nabla_s Y_\\beta \\, d\\Omega\n$$\n$$\nb_\\alpha = \\int_{S^2} f Y_\\alpha d\\Omega\n$$\nThe dot product of the surface gradients in spherical coordinates is given by:\n$$\n\\nabla_s Y_\\alpha \\cdot \\nabla_s Y_\\beta = \\frac{\\partial Y_\\alpha}{\\partial\\theta}\\frac{\\partial Y_\\beta}{\\partial\\theta} + \\frac{1}{\\sin^2\\theta} \\frac{\\partial Y_\\alpha}{\\partial\\phi}\\frac{\\partial Y_\\beta}{\\partial\\phi}\n$$\n\n#### 2.2. Numerical Assembly\nThe integrals for $A_{\\alpha\\beta}$ are computed numerically using a specified equiangular quadrature rule. The sphere is discretized into a grid of $N_\\theta \\times N_\\phi$ points $(\\theta_i, \\phi_j)$ with associated weights $w_{ij} = \\sin\\theta_i \\Delta\\theta \\Delta\\phi$. The integral is approximated by a weighted sum over these grid points:\n$$\nA_{\\alpha\\beta} \\approx \\sum_{i,j} k(\\theta_i, \\phi_j) \\left( \\frac{\\partial Y_\\alpha}{\\partial\\theta}\\frac{\\partial Y_\\beta}{\\partial\\theta} + \\frac{1}{\\sin^2\\theta_i} \\frac{\\partial Y_\\alpha}{\\partial\\phi}\\frac{\\partial Y_\\beta}{\\partial\\phi} \\right)_{(\\theta_i, \\phi_j)} w_{ij}\n$$\nThe load vector $b$ can be determined directly. Since the source term $f(\\theta,\\phi) = Y_{2,0} + \\frac{1}{2}Y^{(c)}_{3,2}$ is given as a linear combination of basis functions, and the basis is orthonormal, the coefficients $b_\\alpha$ are simply the coefficients of the expansion. All components of $b$ are zero except for those corresponding to the modes $Y_{2,0}$ and $Y^{(c)}_{3,2}$.\n\n#### 2.3. Preconditioned Conjugate Gradient (PCG) Solver\nThe resulting linear system $Ax=b$ is symmetric and positive definite, making the Conjugate Gradient (CG) method an effective solver. To accelerate convergence, especially for high conductivity contrast $r$, we employ a preconditioner $M$. A good preconditioner $M$ should be an approximation of $A$ and the system $M^{-1}z = r$ should be easy to solve.\n\nThe problem specifies a diagonal preconditioner based on the eigenvalues of the Laplace-Beltrami operator, scaled by the average conductivity $\\overline{k}$. The spherical harmonics are eigenfunctions of the Laplace-Beltrami operator $\\nabla_s^2 = \\nabla_s \\cdot \\nabla_s$:\n$$\n\\nabla_s^2 Y_\\alpha = -l(l+1) Y_\\alpha\n$$\nFor a constant conductivity $k(\\theta,\\phi) = \\overline{k}$, the operator becomes $\\overline{k} \\nabla_s^2$, and the stiffness matrix $A$ would be diagonal with entries $\\overline{k}\\, l(l+1)$. This suggests a preconditioner:\n$$\nM_{\\alpha\\alpha} = \\overline{k}\\, l_\\alpha(l_\\alpha+1)\n$$\nwhere $l_\\alpha$ is the degree of the mode $Y_\\alpha$. This matrix is diagonal, so its inverse is trivial to compute. The average conductivity $\\overline{k}$ is computed using the same quadrature rule:\n$$\n\\overline{k} = \\frac{\\sum_{i,j} k(\\theta_i, \\phi_j) w_{ij}}{\\sum_{i,j} w_{ij}}\n$$\nThe PCG algorithm iteratively finds the solution $x$ by minimizing the A-norm of the error. It maintains a sequence of residuals $r_k$, search directions $p_k$, and preconditioned residuals $z_k = M^{-1}r_k$.\n\nThe algorithm proceeds as follows:\n1. Initialize solution $x_0 = 0$, residual $r_0 = b$, preconditioned residual $z_0 = M^{-1}r_0$, and search direction $p_0 = z_0$.\n2. For $k = 0, 1, 2, \\ldots$ until convergence:\n   a. Compute matrix-vector product: $v_k = A p_k$.\n   b. Compute step size: $\\alpha_k = (r_k^T z_k) / (p_k^T v_k)$.\n   c. Update solution: $x_{k+1} = x_k + \\alpha_k p_k$.\n   d. Update residual: $r_{k+1} = r_k - \\alpha_k v_k$.\n   e. Check for convergence: if $\\|r_{k+1}\\|_2 / \\|b\\|_2 \\le \\varepsilon$, stop.\n   f. Update preconditioned residual: $z_{k+1} = M^{-1}r_{k+1}$.\n   g. Compute improvement factor: $\\beta_k = (r_{k+1}^T z_{k+1}) / (r_k^T z_k)$.\n   h. Update search direction: $p_{k+1} = z_{k+1} + \\beta_k p_k$.\n\nThe number of iterations required for convergence is a measure of the effectiveness of the preconditioner and the conditioning of the system, which is influenced by the conductivity contrast $r$.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import lpmn, factorial\n\ndef pcg_solve(A, b, M_inv, tol, max_iter):\n    \"\"\"\n    Solves the linear system Ax=b using the Preconditioned Conjugate Gradient method.\n    \"\"\"\n    x = np.zeros_like(b)\n    r = b - A @ x\n    \n    b_norm = np.linalg.norm(b)\n    if b_norm == 0:\n        return 0\n\n    if np.linalg.norm(r) / b_norm  tol:\n        return 0\n\n    z = M_inv * r\n    p = z.copy()\n    rs_old = np.dot(r, z)\n\n    if rs_old == 0:\n        return 1\n\n    for k in range(max_iter):\n        Ap = A @ p\n        alpha = rs_old / np.dot(p, Ap)\n        \n        x += alpha * p\n        r -= alpha * Ap\n\n        rel_res = np.linalg.norm(r) / b_norm\n        if rel_res  tol:\n            return k + 1\n\n        z = M_inv * r\n        rs_new = np.dot(r, z)\n\n        beta = rs_new / rs_old\n        p = z + beta * p\n        rs_old = rs_new\n        \n    return max_iter\n\nclass SpectralSolver:\n    \"\"\"\n    Implements the spectral Galerkin method for steady heat conduction on a sphere.\n    \"\"\"\n    def __init__(self, l_max, N_theta, N_phi):\n        self.l_max = l_max\n        self.N_theta = N_theta\n        self.N_phi = N_phi\n        \n        self._generate_mode_info()\n        self._setup_grid()\n        self._precompute_basis_functions()\n\n    def _generate_mode_info(self):\n        self.mode_info = []\n        for l in range(1, self.l_max + 1):\n            # m = 0 mode\n            self.mode_info.append({'l': l, 'm': 0, 'type': 'z'})\n            for m in range(1, l + 1):\n                # m > 0 cosine mode\n                self.mode_info.append({'l': l, 'm': m, 'type': 'c'})\n                # m > 0 sine mode\n                self.mode_info.append({'l': l, 'm': m, 'type': 's'})\n        self.num_active_modes = len(self.mode_info)\n\n    def _setup_grid(self):\n        theta = (np.arange(self.N_theta) + 0.5) * (np.pi / self.N_theta)\n        phi = np.arange(self.N_phi) * (2 * np.pi / self.N_phi)\n        self.theta_grid, self.phi_grid = np.meshgrid(theta, phi, indexing='ij')\n        \n        delta_theta = np.pi / self.N_theta\n        delta_phi = 2 * np.pi / self.N_phi\n        self.weights = np.sin(self.theta_grid) * delta_theta * delta_phi\n\n    def _precompute_basis_functions(self):\n        # Precompute Legendre polynomials and their derivatives\n        cos_theta_1d = np.cos(self.theta_grid[:, 0])\n        plm_vals, plm_derivs = lpmn(self.l_max, self.l_max, cos_theta_1d)\n\n        self.Y_grid = np.zeros((self.num_active_modes, self.N_theta, self.N_phi))\n        self.dY_dtheta_grid = np.zeros_like(self.Y_grid)\n        self.dY_dphi_grid = np.zeros_like(self.Y_grid)\n        \n        sin_theta = np.sin(self.theta_grid)\n\n        for idx, mode in enumerate(self.mode_info):\n            l, m = mode['l'], mode['m']\n            \n            # Normalization constant N_lm\n            norm_factor = np.sqrt(((2 * l + 1) / (4 * np.pi)) * (factorial(l - m) / factorial(l + m)))\n            \n            # Legendre polynomials and derivatives for this mode\n            P_lm = plm_vals[m, l, :].reshape(-1, 1)\n            dP_lm_dx = plm_derivs[m, l, :].reshape(-1, 1)\n            dP_lm_dtheta = -sin_theta[:, 0].reshape(-1, 1) * dP_lm_dx\n\n            cos_m_phi = np.cos(m * self.phi_grid[0, :])\n            sin_m_phi = np.sin(m * self.phi_grid[0, :])\n            \n            if m == 0:  # Zonal harmonics\n                self.Y_grid[idx, :, :] = norm_factor * P_lm\n                self.dY_dtheta_grid[idx, :, :] = norm_factor * dP_lm_dtheta\n                self.dY_dphi_grid[idx, :, :] = 0.0\n            else:\n                prefactor = np.sqrt(2) * norm_factor\n                if mode['type'] == 'c':  # Cosine type\n                    self.Y_grid[idx, :, :] = prefactor * P_lm * cos_m_phi\n                    self.dY_dtheta_grid[idx, :, :] = prefactor * dP_lm_dtheta * cos_m_phi\n                    self.dY_dphi_grid[idx, :, :] = -prefactor * m * P_lm * sin_m_phi\n                else:  # Sine type\n                    self.Y_grid[idx, :, :] = prefactor * P_lm * sin_m_phi\n                    self.dY_dtheta_grid[idx, :, :] = prefactor * dP_lm_dtheta * sin_m_phi\n                    self.dY_dphi_grid[idx, :, :] = prefactor * m * P_lm * cos_m_phi\n\n    def assemble_and_solve(self, r, tol, max_iter):\n        # 1. Assemble stiffness matrix A\n        k_grid = 1 + (r - 1) * (np.sin(self.theta_grid)**4) * (np.cos(2 * self.phi_grid)**2)\n        \n        A = np.zeros((self.num_active_modes, self.num_active_modes))\n        inv_sin2_theta = 1.0 / np.sin(self.theta_grid)**2\n\n        for i in range(self.num_active_modes):\n            for j in range(i, self.num_active_modes):\n                integrand = k_grid * (\n                    self.dY_dtheta_grid[i] * self.dY_dtheta_grid[j] +\n                    inv_sin2_theta * self.dY_dphi_grid[i] * self.dY_dphi_grid[j]\n                )\n                A[i, j] = np.sum(integrand * self.weights)\n                if i != j:\n                    A[j, i] = A[i, j]\n\n        # 2. Assemble load vector b\n        b = np.zeros(self.num_active_modes)\n        # Find indices for f = Y_{2,0} + 0.5 * Y^{(c)}_{3,2}\n        idx_2_0 = next(i for i, mode in enumerate(self.mode_info) if mode['l'] == 2 and mode['m'] == 0)\n        idx_3_2_c = next(i for i, mode in enumerate(self.mode_info) if mode['l'] == 3 and mode['m'] == 2 and mode['type'] == 'c')\n        b[idx_2_0] = 1.0\n        b[idx_3_2_c] = 0.5\n\n        # 3. Assemble preconditioner M\n        k_bar = np.sum(k_grid * self.weights) / np.sum(self.weights)\n        M_diag = np.array([k_bar * mode['l'] * (mode['l'] + 1) for mode in self.mode_info])\n        M_inv_diag = 1.0 / M_diag\n        \n        # 4. Solve using PCG\n        iterations = pcg_solve(A, b, M_inv_diag, tol, max_iter)\n        return iterations\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # (N_theta, N_phi, l_max, r, epsilon, K_max)\n        (36, 72, 9, 1, 1e-8, 500),\n        (36, 72, 9, 10, 1e-8, 500),\n        (36, 72, 9, 100, 1e-8, 500),\n        (36, 72, 9, 1000, 1e-8, 500),\n    ]\n\n    N_theta, N_phi, l_max = test_cases[0][:3]\n    solver = SpectralSolver(l_max, N_theta, N_phi)\n\n    results = []\n    for _, _, _, r, epsilon, K_max in test_cases:\n        iterations = solver.assemble_and_solve(r, epsilon, K_max)\n        results.append(iterations)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3602798"}]}