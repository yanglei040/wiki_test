{"hands_on_practices": [{"introduction": "A core strength of the finite element method is its ability to model complex geometries by mapping simple, computationally convenient reference elements (like a square) to arbitrarily shaped quadrilateral elements in the physical domain. This geometric transformation is governed by the Jacobian matrix. This first practice provides a concrete, hands-on exercise in calculating the Jacobian determinant for a skewed quadrilateral, a fundamental quantity that measures how the area is distorted by the mapping and serves as a critical indicator of element quality and numerical stability [@problem_id:3572383].", "problem": "Consider a two-dimensional isoparametric bilinear quadrilateral finite element used to discretize a heterogeneous conductivity field in computational geophysics within the Finite Element Method (FEM). The physical element is defined by its four corner nodes, which map from the reference square $(\\xi,\\eta) \\in [-1,1] \\times [-1,1]$ using the bilinear isoparametric formulation $x(\\xi,\\eta) = \\sum_{i=1}^{4} N_{i}(\\xi,\\eta)\\,x_{i}$ and $y(\\xi,\\eta) = \\sum_{i=1}^{4} N_{i}(\\xi,\\eta)\\,y_{i}$, where $N_{i}(\\xi,\\eta)$ are the standard bilinear shape functions, and the Jacobian matrix $\\mathbf{J}(\\xi,\\eta)$ of the mapping is defined by $\\mathbf{J}(\\xi,\\eta) = \\begin{pmatrix} \\partial x / \\partial \\xi & \\partial x / \\partial \\eta \\\\ \\partial y / \\partial \\xi & \\partial y / \\partial \\eta \\end{pmatrix}$. The nodes are ordered so that node $1$ corresponds to $(\\xi,\\eta) = (-1,-1)$, node $2$ to $(\\xi,\\eta) = (1,-1)$, node $3$ to $(\\xi,\\eta) = (1,1)$, and node $4$ to $(\\xi,\\eta) = (-1,1)$. The physical coordinates, in kilometers, of the four nodes are:\n- Node $1$: $(x_{1},y_{1}) = (0,\\,0)$,\n- Node $2$: $(x_{2},y_{2}) = (2.0,\\,0.1)$,\n- Node $3$: $(x_{3},y_{3}) = (2.2,\\,1.9)$,\n- Node $4$: $(x_{4},y_{4}) = (0.1,\\,2.0)$.\n\nThis element is convex but highly skewed.\n\nStarting from the isoparametric mapping and the definition of the Jacobian, compute the determinant $\\det\\mathbf{J}(\\xi,\\eta)$ at the four two-point Gauss–Legendre quadrature points for the square, located at $(\\xi,\\eta) = (\\pm 1/\\sqrt{3},\\,\\pm 1/\\sqrt{3})$. Based on these values, assess the risk of numerical instability due to near-singular mappings for this element.\n\nReport as your final result the minimum value of $\\det\\mathbf{J}(\\xi,\\eta)$ over the four Gauss points. Round your answer to four significant figures. Express your answer in square kilometers.", "solution": "The isoparametric bilinear mapping for a four-node quadrilateral uses the standard bilinear shape functions\n$$\nN_{1}(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta),\\quad\nN_{2}(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1-\\eta),\n$$\n$$\nN_{3}(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1+\\eta),\\quad\nN_{4}(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1+\\eta),\n$$\nso that the physical position is\n$$\nx(\\xi,\\eta) = \\sum_{i=1}^{4} N_{i}(\\xi,\\eta)\\,x_{i},\\qquad\ny(\\xi,\\eta) = \\sum_{i=1}^{4} N_{i}(\\xi,\\eta)\\,y_{i}.\n$$\nThe Jacobian matrix $\\mathbf{J}(\\xi,\\eta)$ follows from the chain rule:\n$$\n\\mathbf{J}(\\xi,\\eta) = \n\\begin{pmatrix}\n\\frac{\\partial x}{\\partial \\xi} & \\frac{\\partial x}{\\partial \\eta} \\\\\n\\frac{\\partial y}{\\partial \\xi} & \\frac{\\partial y}{\\partial \\eta}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\sum_{i=1}^{4}\\frac{\\partial N_{i}}{\\partial \\xi}x_{i} & \\sum_{i=1}^{4}\\frac{\\partial N_{i}}{\\partial \\eta}x_{i} \\\\\n\\sum_{i=1}^{4}\\frac{\\partial N_{i}}{\\partial \\xi}y_{i} & \\sum_{i=1}^{4}\\frac{\\partial N_{i}}{\\partial \\eta}y_{i}\n\\end{pmatrix}.\n$$\nThe derivatives of the shape functions are\n$$\n\\frac{\\partial N_{1}}{\\partial \\xi} = -\\frac{1}{4}(1-\\eta),\\quad\n\\frac{\\partial N_{2}}{\\partial \\xi} = \\frac{1}{4}(1-\\eta),\\quad\n\\frac{\\partial N_{3}}{\\partial \\xi} = \\frac{1}{4}(1+\\eta),\\quad\n\\frac{\\partial N_{4}}{\\partial \\xi} = -\\frac{1}{4}(1+\\eta),\n$$\n$$\n\\frac{\\partial N_{1}}{\\partial \\eta} = -\\frac{1}{4}(1-\\xi),\\quad\n\\frac{\\partial N_{2}}{\\partial \\eta} = -\\frac{1}{4}(1+\\xi),\\quad\n\\frac{\\partial N_{3}}{\\partial \\eta} = \\frac{1}{4}(1+\\xi),\\quad\n\\frac{\\partial N_{4}}{\\partial \\eta} = \\frac{1}{4}(1-\\xi).\n$$\nWith $(x_{1},y_{1}) = (0,\\,0)$, $(x_{2},y_{2}) = (2.0,\\,0.1)$, $(x_{3},y_{3}) = (2.2,\\,1.9)$, $(x_{4},y_{4}) = (0.1,\\,2.0)$, we can write compactly\n$$\n\\frac{\\partial x}{\\partial \\xi}(\\eta) = \\frac{(1-\\eta)\\,x_{2} + (1+\\eta)\\,x_{3} - (1+\\eta)\\,x_{4}}{4},\\qquad\n\\frac{\\partial y}{\\partial \\xi}(\\eta) = \\frac{(1-\\eta)\\,y_{2} + (1+\\eta)\\,y_{3} - (1+\\eta)\\,y_{4}}{4},\n$$\n$$\n\\frac{\\partial x}{\\partial \\eta}(\\xi) = \\frac{-(1+\\xi)\\,x_{2} + (1+\\xi)\\,x_{3} + (1-\\xi)\\,x_{4}}{4},\\qquad\n\\frac{\\partial y}{\\partial \\eta}(\\xi) = \\frac{-(1+\\xi)\\,y_{2} + (1+\\xi)\\,y_{3} + (1-\\xi)\\,y_{4}}{4}.\n$$\nThe two-point Gauss–Legendre quadrature points on $[-1,1]$ are at $\\xi = \\pm r$ and $\\eta = \\pm r$, where\n$$\nr = \\frac{1}{\\sqrt{3}} \\approx 0.577350269.\n$$\nWe evaluate $\\det\\mathbf{J}(\\xi,\\eta) = \\left(\\frac{\\partial x}{\\partial \\xi}\\right)\\left(\\frac{\\partial y}{\\partial \\eta}\\right) - \\left(\\frac{\\partial x}{\\partial \\eta}\\right)\\left(\\frac{\\partial y}{\\partial \\xi}\\right)$ at the four points.\n\nFirst, for $(\\xi,\\eta) = (r,r)$, use $(1-\\eta) = 1-r \\approx 0.422649731$, $(1+\\eta) = 1+r \\approx 1.577350269$, and $(1\\pm\\xi)$ similarly:\n$$\n\\frac{\\partial x}{\\partial \\xi}(r) = \\frac{0.422649731\\cdot 2.0 + 1.577350269\\cdot 2.2 - 1.577350269\\cdot 0.1}{4} \\approx 1.0394337568,\n$$\n$$\n\\frac{\\partial y}{\\partial \\xi}(r) = \\frac{0.422649731\\cdot 0.1 + 1.577350269\\cdot 1.9 - 1.577350269\\cdot 2.0}{4} \\approx -0.02886751345,\n$$\n$$\n\\frac{\\partial x}{\\partial \\eta}(r) = \\frac{-1.577350269\\cdot 2.0 + 1.577350269\\cdot 2.2 + 0.422649731\\cdot 0.1}{4} \\approx 0.089433756775,\n$$\n$$\n\\frac{\\partial y}{\\partial \\eta}(r) = \\frac{-1.577350269\\cdot 0.1 + 1.577350269\\cdot 1.9 + 0.422649731\\cdot 2.0}{4} \\approx 0.92113248655.\n$$\nThus,\n$$\n\\det\\mathbf{J}(r,r) \\approx 1.0394337568\\cdot 0.92113248655 - 0.089433756775\\cdot(-0.02886751345) \\approx 0.96003799.\n$$\n\nSecond, for $(\\xi,\\eta) = (-r,r)$, $(1+\\xi) = 1-r \\approx 0.422649731$, $(1-\\xi) = 1+r \\approx 1.577350269$, while $(1\\pm\\eta)$ as before:\n$$\n\\frac{\\partial x}{\\partial \\xi}(r) \\approx 1.0394337568,\\quad \\frac{\\partial y}{\\partial \\xi}(r) \\approx -0.02886751345,\n$$\n$$\n\\frac{\\partial x}{\\partial \\eta}(-r) = \\frac{-0.422649731\\cdot 2.0 + 0.422649731\\cdot 2.2 + 1.577350269\\cdot 0.1}{4} \\approx 0.060566243275,\n$$\n$$\n\\frac{\\partial y}{\\partial \\eta}(-r) = \\frac{-0.422649731\\cdot 0.1 + 0.422649731\\cdot 1.9 + 1.577350269\\cdot 2.0}{4} \\approx 0.9788675135,\n$$\nand\n$$\n\\det\\mathbf{J}(-r,r) \\approx 1.0394337568\\cdot 0.9788675135 - 0.060566243275\\cdot(-0.02886751345) \\approx 1.019216337.\n$$\n\nThird, for $(\\xi,\\eta) = (r,-r)$, $(1-\\eta) = 1+r \\approx 1.577350269$, $(1+\\eta) = 1-r \\approx 0.422649731$:\n$$\n\\frac{\\partial x}{\\partial \\xi}(-r) = \\frac{1.577350269\\cdot 2.0 + 0.422649731\\cdot 2.2 - 0.422649731\\cdot 0.1}{4} \\approx 1.010566243275,\n$$\n$$\n\\frac{\\partial y}{\\partial \\xi}(-r) = \\frac{1.577350269\\cdot 0.1 + 0.422649731\\cdot 1.9 - 0.422649731\\cdot 2.0}{4} \\approx 0.02886751345,\n$$\nand with $(1\\pm\\xi)$ as in the first case:\n$$\n\\frac{\\partial x}{\\partial \\eta}(r) \\approx 0.089433756775,\\qquad\n\\frac{\\partial y}{\\partial \\eta}(r) \\approx 0.92113248655,\n$$\nyielding\n$$\n\\det\\mathbf{J}(r,-r) \\approx 1.010566243275\\cdot 0.92113248655 - 0.089433756775\\cdot 0.02886751345 \\approx 0.928283607.\n$$\n\nFourth, for $(\\xi,\\eta) = (-r,-r)$:\n$$\n\\frac{\\partial x}{\\partial \\xi}(-r) \\approx 1.010566243275,\\quad \\frac{\\partial y}{\\partial \\xi}(-r) \\approx 0.02886751345,\n$$\n$$\n\\frac{\\partial x}{\\partial \\eta}(-r) \\approx 0.060566243275,\\quad \\frac{\\partial y}{\\partial \\eta}(-r) \\approx 0.9788675135,\n$$\nand\n$$\n\\det\\mathbf{J}(-r,-r) \\approx 1.010566243275\\cdot 0.9788675135 - 0.060566243275\\cdot 0.02886751345 \\approx 0.987461796.\n$$\n\nCollecting these, the four Jacobian determinants (in square kilometers) at the Gauss points are approximately:\n$$\n\\det\\mathbf{J}(r,r) \\approx 0.96003799,\\quad\n\\det\\mathbf{J}(-r,r) \\approx 1.019216337,\\quad\n\\det\\mathbf{J}(r,-r) \\approx 0.928283607,\\quad\n\\det\\mathbf{J}(-r,-r) \\approx 0.987461796.\n$$\nThe minimum value is\n$$\n\\min\\{\\det\\mathbf{J}\\} \\approx 0.928283607.\n$$\n\nRegarding numerical stability, the isoparametric mapping becomes near-singular when $\\det\\mathbf{J}(\\xi,\\eta)$ approaches zero or changes sign within the element, which leads to large interpolation gradients and ill-conditioned stiffness matrices. Here, all determinants remain positive and of comparable magnitude; the ratio of the minimum to the maximum, $0.928283607 / 1.019216337 \\approx 0.911$, indicates moderate distortion but not near-singularity. Therefore, the risk of numerical instability due to a near-singular mapping is low for this element.\n\nRounding the minimum determinant to four significant figures, and expressing the value in square kilometers as requested, gives\n$$\n0.9283.\n$$", "answer": "$$\\boxed{0.9283}$$", "id": "3572383"}, {"introduction": "Once the geometric relationship between the physical and reference elements is established, the next step is to construct the discrete algebraic system that approximates the governing partial differential equation. This exercise focuses on assembling the element stiffness matrix for an anisotropic diffusion problem, a process central to simulations in heat transfer, fluid flow, and electromagnetism. This practice will test your understanding of the complete \"recipe\" for this procedure, from applying the chain rule to transform gradients to using numerical quadrature to evaluate the final integral expression [@problem_id:3572415].", "problem": "Consider the two-dimensional steady-state diffusion problem in a heterogeneous anisotropic medium typical of computational geophysics: find $u(\\mathbf{x})$ on a domain $\\Omega \\subset \\mathbb{R}^2$ such that $-\\nabla \\cdot (\\mathbf{K}(\\mathbf{x}) \\nabla u) = f$ with appropriate boundary conditions, where $\\mathbf{K}(\\mathbf{x})$ is a spatially varying symmetric positive-definite (SPD) conductivity tensor. In the Finite Element Method (FEM), the element stiffness matrix on a single quadrilateral element contributes to the global system that discretizes the weak form of this equation.\n\nFocus on a single isoparametric bilinear quadrilateral element ($Q_1$) with nodes at physical coordinates $\\{\\mathbf{x}_a\\}_{a=1}^4$ and corresponding bilinear shape functions $\\{N_a(\\xi,\\eta)\\}_{a=1}^4$ defined on the reference square $\\hat{\\Omega} = [-1,1]\\times[-1,1]$ with local coordinates $(\\xi,\\eta)$. The isoparametric mapping is defined by $\\mathbf{x}(\\xi,\\eta) = \\sum_{a=1}^4 N_a(\\xi,\\eta)\\,\\mathbf{x}_a$. The Jacobian matrix of this mapping is $\\mathbf{J}(\\xi,\\eta) = \\dfrac{\\partial \\mathbf{x}}{\\partial (\\xi,\\eta)}$, and the chain rule relates physical gradients of shape functions to reference gradients via $\\nabla N_a = \\mathbf{J}^{-T} \\,\\hat{\\nabla} N_a$, where $\\hat{\\nabla}$ denotes gradients with respect to $(\\xi,\\eta)$.\n\nYou are to select the option that correctly sets up the integral expression for the $4\\times 4$ element stiffness matrix for this $Q_1$ element with $\\mathbf{K}(\\mathbf{x})$ varying spatially and anisotropically, and that correctly states a numerically sound procedure to evaluate it using appropriate tensor-product Gauss-Legendre quadrature on $\\hat{\\Omega}$.\n\nWhich option gives a correct expression and evaluation steps?\n\nA. $k_{ij}^e = \\displaystyle \\int_{-1}^{1}\\!\\!\\int_{-1}^{1} \\big(\\nabla N_i(\\xi,\\eta)\\big)^{T}\\,\\mathbf{K}\\big(\\mathbf{x}(\\xi,\\eta)\\big)\\,\\nabla N_j(\\xi,\\eta)\\,\\det\\mathbf{J}(\\xi,\\eta)\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta$, with $\\nabla N_i = \\mathbf{J}^{-T}\\hat{\\nabla}N_i$ and $\\mathbf{x}(\\xi,\\eta)=\\sum_{a=1}^4 N_a(\\xi,\\eta)\\mathbf{x}_a$. Procedure: choose tensor-product Gauss-Legendre points $\\{(\\xi_g,\\eta_g),w_g^\\xi,w_g^\\eta\\}$ of order at least $2\\times 2$ (increase order if $\\mathbf{K}$ varies strongly), and for each point compute $\\hat{\\nabla}N_i(\\xi_g,\\eta_g)$, $\\mathbf{J}(\\xi_g,\\eta_g)$, $\\det\\mathbf{J}(\\xi_g,\\eta_g)$, $\\nabla N_i(\\xi_g,\\eta_g)$, evaluate $\\mathbf{K}\\big(\\mathbf{x}(\\xi_g,\\eta_g)\\big)$, form $\\big(\\nabla N_i\\big)^T\\mathbf{K}\\nabla N_j$, and accumulate $k_{ij}^e \\mathrel{+}= \\big(\\nabla N_i\\big)^T\\mathbf{K}\\nabla N_j\\,\\det\\mathbf{J}\\,w_g^\\xi w_g^\\eta$ over all points.\n\nB. $k_{ij}^e = \\displaystyle \\int_{-1}^{1}\\!\\!\\int_{-1}^{1} \\big(\\hat{\\nabla} N_i(\\xi,\\eta)\\big)^{T}\\,\\mathbf{K}\\big(\\mathbf{x}_c\\big)\\,\\hat{\\nabla} N_j(\\xi,\\eta)\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta$, where $\\mathbf{x}_c$ is the element centroid. Procedure: use a single Gauss point at $(\\xi,\\eta)=(0,0)$ with weight $4$, evaluate $\\mathbf{K}$ at $\\mathbf{x}_c$, and compute $k_{ij}^e = 4\\,\\big(\\hat{\\nabla} N_i(0,0)\\big)^{T}\\,\\mathbf{K}(\\mathbf{x}_c)\\,\\hat{\\nabla} N_j(0,0)$.\n\nC. $k_{ij}^e = \\displaystyle \\int_{-1}^{1}\\!\\!\\int_{-1}^{1} \\big(\\nabla N_i(\\xi,\\eta)\\big)^{T}\\,\\mathbf{K}\\big(\\mathbf{x}(\\xi,\\eta)\\big)\\,\\nabla N_j(\\xi,\\eta)\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta$, with $\\nabla N_i = \\mathbf{J}^{T}\\hat{\\nabla}N_i$ and $\\mathbf{x}(\\xi,\\eta)=\\sum_{a=1}^4 N_a(\\xi,\\eta)\\mathbf{x}_a$. Procedure: choose $2\\times 2$ Gauss-Legendre points, compute $\\mathbf{J}$ only once at $(\\xi,\\eta)=(0,0)$, reuse it at all points, evaluate $\\mathbf{K}$ at each mapped point, and accumulate $k_{ij}^e$ without the $\\det\\mathbf{J}$ factor.\n\nD. $k_{ij}^e = \\displaystyle \\int_{-1}^{1}\\!\\!\\int_{-1}^{1} \\big(\\hat{\\nabla} N_i(\\xi,\\eta)\\big)^{T}\\,\\big(\\mathbf{J}^{T}\\,\\mathbf{K}\\big(\\mathbf{x}(\\xi,\\eta)\\big)\\,\\mathbf{J}\\big)\\,\\hat{\\nabla} N_j(\\xi,\\eta)\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta$. Procedure: use tensor-product Gauss-Legendre quadrature of order $1\\times 1$ for efficiency, compute $\\mathbf{J}$ and $\\mathbf{K}$ at the single Gauss point, form the inner product above, and sum with the quadrature weight; no determinant term is needed because the transformation is embedded in $\\mathbf{J}^{T}\\mathbf{K}\\mathbf{J}$.\n\nSelect the correct option.", "solution": "### Problem Validation\n\n#### Step 1: Extract Givens\n\nThe problem statement provides the following information:\n1.  **Governing Equation**: The two-dimensional steady-state diffusion equation in a heterogeneous anisotropic medium is $-\\nabla \\cdot (\\mathbf{K}(\\mathbf{x}) \\nabla u) = f$.\n2.  **Domain**: The problem is defined on a domain $\\Omega \\subset \\mathbb{R}^2$.\n3.  **Conductivity Tensor**: $\\mathbf{K}(\\mathbf{x})$ is a spatially varying, symmetric positive-definite (SPD) tensor.\n4.  **Discretization Method**: The Finite Element Method (FEM) is used.\n5.  **Element Type**: A single isoparametric bilinear quadrilateral element ($Q_1$) is considered.\n6.  **Nodal Coordinates**: The element has nodes at physical coordinates $\\{\\mathbf{x}_a\\}_{a=1}^4$.\n7.  **Shape Functions**: Bilinear shape functions $\\{N_a(\\xi,\\eta)\\}_{a=1}^4$ are defined on the reference square $\\hat{\\Omega} = [-1,1]\\times[-1,1]$ with local coordinates $(\\xi,\\eta)$.\n8.  **Isoparametric Mapping**: The mapping from reference to physical coordinates is $\\mathbf{x}(\\xi,\\eta) = \\sum_{a=1}^4 N_a(\\xi,\\eta)\\,\\mathbf{x}_a$.\n9.  **Jacobian Matrix**: The Jacobian of the mapping is $\\mathbf{J}(\\xi,\\eta) = \\dfrac{\\partial \\mathbf{x}}{\\partial (\\xi,\\eta)}$.\n10. **Chain Rule for Gradients**: The relationship between physical gradients ($\\nabla$) and reference gradients ($\\hat{\\nabla}$) of the shape functions is given as $\\nabla N_a = \\mathbf{J}^{-T} \\,\\hat{\\nabla} N_a$.\n\n#### Step 2: Validate Using Extracted Givens\n\nThe problem statement describes a standard application of the Finite Element Method to a second-order elliptic partial differential equation.\n-   **Scientifically Grounded**: The problem is rooted in the fundamental principles of continuum mechanics (diffusion) and numerical analysis (FEM). The governing equation is a standard model for heat conduction, fluid flow in porous media, and electrostatics. The use of isoparametric quadrilateral elements is a canonical topic in FEM literature. All elements are scientifically sound.\n-   **Well-Posed**: The problem asks for the correct expression and evaluation procedure for the element stiffness matrix. This is a well-defined question within the context of FEM theory. Given the inputs, a unique and correct expression exists.\n-   **Objective**: The language is precise, mathematical, and free of any subjective or ambiguous terminology. All terms ($\\mathbf{K}$, $Q_1$ element, isoparametric mapping, Jacobian) are standard in the field.\n-   **Completeness**: The problem provides all necessary information to derive the element stiffness matrix. The properties of $\\mathbf{K}$, the element type, the mapping, and the relationship between gradients are all specified.\n\nThe problem statement does not violate any of the invalidity criteria. It is a well-formed, standard question in computational science and engineering.\n\n#### Step 3: Verdict and Action\n\nThe problem statement is **valid**. Proceeding to the solution.\n\n### Derivation of the Element Stiffness Matrix\n\nThe solution begins with the weak form of the governing partial differential equation, $-\\nabla \\cdot (\\mathbf{K} \\nabla u) = f$. To find the weak form, we multiply by a suitable test function $v$ (from the same space as $u$) and integrate over the domain $\\Omega$.\n\n$$ -\\int_{\\Omega} v \\, \\nabla \\cdot (\\mathbf{K} \\nabla u) \\, \\mathrm{d}\\mathbf{x} = \\int_{\\Omega} v f \\, \\mathrm{d}\\mathbf{x} $$\n\nApplying Green's first identity (integration by parts in multiple dimensions) to the left-hand side:\n\n$$ \\int_{\\Omega} (\\nabla v)^T (\\mathbf{K} \\nabla u) \\, \\mathrm{d}\\mathbf{x} - \\int_{\\partial \\Omega} v (\\mathbf{K} \\nabla u) \\cdot \\mathbf{n} \\, \\mathrm{d}s = \\int_{\\Omega} v f \\, \\mathrm{d}\\mathbf{x} $$\n\nHere, $\\mathbf{n}$ is the outward unit normal to the boundary $\\partial \\Omega$. The boundary integral term is handled by applying boundary conditions. The element stiffness matrix arises from the bilinear form on the left-hand side, $a(v,u) = \\int_{\\Omega} (\\nabla v)^T (\\mathbf{K} \\nabla u) \\, \\mathrm{d}\\mathbf{x}$.\n\nIn the Finite Element Method, the domain $\\Omega$ is partitioned into elements $\\Omega_e$. The total integral is the sum of integrals over each element:\n\n$$ a(v,u) = \\sum_e \\int_{\\Omega_e} (\\nabla v)^T (\\mathbf{K} \\nabla u) \\, \\mathrm{d}\\mathbf{x} $$\n\nWithin a single element $\\Omega_e$, the solution $u$ and test function $v$ are approximated using the shape functions $N_a$:\n$u^e(\\mathbf{x}) = \\sum_{j=1}^4 u_j N_j(\\mathbf{x})$ and $v^e(\\mathbf{x}) = \\sum_{i=1}^4 v_i N_i(\\mathbf{x})$, where $u_j$ and $v_i$ are nodal values.\n\nSubstituting these approximations into the integral over one element:\n\n$$ a^e(v^e, u^e) = \\int_{\\Omega_e} \\left(\\nabla \\sum_{i=1}^4 v_i N_i\\right)^T \\mathbf{K} \\left(\\nabla \\sum_{j=1}^4 u_j N_j\\right) \\, \\mathrm{d}\\mathbf{x} $$\n$$ = \\sum_{i=1}^4 \\sum_{j=1}^4 v_i u_j \\int_{\\Omega_e} (\\nabla N_i)^T \\mathbf{K} (\\nabla N_j) \\, \\mathrm{d}\\mathbf{x} $$\n\nThe $(i,j)$-th entry of the $4 \\times 4$ element stiffness matrix, denoted $k_{ij}^e$, is the integral term:\n\n$$ k_{ij}^e = \\int_{\\Omega_e} (\\nabla N_i)^T \\mathbf{K}(\\mathbf{x}) (\\nabla N_j) \\, \\mathrm{d}\\mathbf{x} $$\n\nThis integral is over the physical element domain $\\Omega_e$. For computation, it must be transformed to the reference square $\\hat{\\Omega} = [-1,1]\\times[-1,1]$. This requires a change of variables, $\\mathbf{x} \\to (\\xi, \\eta)$. The differential area element transforms as $\\mathrm{d}\\mathbf{x} = \\det(\\mathbf{J}) \\, \\mathrm{d}\\xi \\, \\mathrm{d}\\eta$. The physical gradients $\\nabla N_a$ are functions of the reference gradients $\\hat{\\nabla} N_a$ via the stated chain rule: $\\nabla N_a = \\mathbf{J}^{-T} \\hat{\\nabla} N_a$.\n\nSubstituting these transformations into the expression for $k_{ij}^e$:\n\n$$ k_{ij}^e = \\int_{-1}^{1}\\!\\!\\int_{-1}^{1} \\Big(\\nabla N_i\\big(\\mathbf{x}(\\xi,\\eta)\\big)\\Big)^T \\mathbf{K}\\big(\\mathbf{x}(\\xi,\\eta)\\big) \\Big(\\nabla N_j\\big(\\mathbf{x}(\\xi,\\eta)\\big)\\Big) \\det\\mathbf{J}(\\xi,\\eta) \\, \\mathrm{d}\\xi \\, \\mathrm{d}\\eta $$\n\nThis is the fundamental expression for the element stiffness matrix entry, integrated over the reference element. For numerical evaluation, this integral is approximated using numerical quadrature, typically Gauss-Legendre quadrature for this geometry.\n\nThe integrand is $I(\\xi, \\eta) = (\\nabla N_i)^T \\mathbf{K} (\\nabla N_j) \\det(\\mathbf{J})$. For a general non-parallelogram quadrilateral, the Jacobian $\\mathbf{J}$ is a function of $(\\xi, \\eta)$. Its components are linear in $\\xi$ and $\\eta$. Consequently, $\\det(\\mathbf{J})$ is a polynomial of up to degree 2. The physical gradients are $\\nabla N_i = \\mathbf{J}^{-T} \\hat{\\nabla} N_i$, whose components are rational functions of $(\\xi, \\eta)$ (polynomials divided by $\\det(\\mathbf{J})$). Furthermore, the conductivity tensor $\\mathbf{K}(\\mathbf{x}(\\xi, \\eta))$ is also a function of $(\\xi, \\eta)$. Thus, the integrand is generally a complicated rational function, not a simple polynomial.\nNumerical quadrature is performed by summing the integrand evaluated at a set of Gauss points $\\{(\\xi_g, \\eta_g)\\}$ multiplied by corresponding weights $w_g$:\n\n$$ k_{ij}^e \\approx \\sum_g \\Big[ \\Big(\\nabla N_i\\Big)^T \\mathbf{K} \\Big(\\nabla N_j\\Big) \\det(\\mathbf{J}) \\Big]_{(\\xi_g, \\eta_g)} w_g $$\n\nFor a tensor-product grid of points, $w_g = w_g^\\xi w_g^\\eta$.\n\n### Option-by-Option Analysis\n\n**A. $k_{ij}^e = \\displaystyle \\int_{-1}^{1}\\!\\!\\int_{-1}^{1} \\big(\\nabla N_i(\\xi,\\eta)\\big)^{T}\\,\\mathbf{K}\\big(\\mathbf{x}(\\xi,\\eta)\\big)\\,\\nabla N_j(\\xi,\\eta)\\,\\det\\mathbf{J}(\\xi,\\eta)\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta$, with $\\nabla N_i = \\mathbf{J}^{-T}\\hat{\\nabla}N_i$ and $\\mathbf{x}(\\xi,\\eta)=\\sum_{a=1}^4 N_a(\\xi,\\eta)\\mathbf{x}_a$. Procedure: choose tensor-product Gauss-Legendre points $\\{(\\xi_g,\\eta_g),w_g^\\xi,w_g^\\eta\\}$ of order at least $2\\times 2$ (increase order if $\\mathbf{K}$ varies strongly), and for each point compute $\\hat{\\nabla}N_i(\\xi_g,\\eta_g)$, $\\mathbf{J}(\\xi_g,\\eta_g)$, $\\det\\mathbf{J}(\\xi_g,\\eta_g)$, $\\nabla N_i(\\xi_g,\\eta_g)$, evaluate $\\mathbf{K}\\big(\\mathbf{x}(\\xi_g,\\eta_g)\\big)$, form $\\big(\\nabla N_i\\big)^T\\mathbf{K}\\nabla N_j$, and accumulate $k_{ij}^e \\mathrel{+}= \\big(\\nabla N_i\\big)^T\\mathbf{K}\\nabla N_j\\,\\det\\mathbf{J}\\,w_g^\\xi w_g^\\eta$ over all points.**\n\n-   **Integral Expression**: The formula for $k_{ij}^e$ perfectly matches the correctly derived expression after changing variables to the reference element.\n-   **Definitions**: The provided definitions for $\\nabla N_i$ and the isoparametric mapping are correct.\n-   **Procedure**: The evaluation procedure described is the standard and correct algorithm. It correctly states that all quantities depending on $(\\xi, \\eta)$ (i.e., $\\hat{\\nabla}N_i$, $\\mathbf{J}$, $\\det\\mathbf{J}$, $\\mathbf{K}$) must be computed at each Gauss point. Using a $2 \\times 2$ Gauss quadrature rule is the standard for bilinear quadrilaterals, as it integrates the mass matrix exactly for parallelograms and passes the patch test, ensuring convergence. The recommendation to increase the order for distorted elements or strongly varying $\\mathbf{K}$ is sound numerical practice for maintaining accuracy. The accumulation step is also correctly formulated.\n\nThis option is entirely correct. **Correct**.\n\n**B. $k_{ij}^e = \\displaystyle \\int_{-1}^{1}\\!\\!\\int_{-1}^{1} \\big(\\hat{\\nabla} N_i(\\xi,\\eta)\\big)^{T}\\,\\mathbf{K}\\big(\\mathbf{x}_c\\big)\\,\\hat{\\nabla} N_j(\\xi,\\eta)\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta$, where $\\mathbf{x}_c$ is the element centroid. Procedure: use a single Gauss point at $(\\xi,\\eta)=(0,0)$ with weight $4$, evaluate $\\mathbf{K}$ at $\\mathbf{x}_c$, and compute $k_{ij}^e = 4\\,\\big(\\hat{\\nabla} N_i(0,0)\\big)^{T}\\,\\mathbf{K}(\\mathbf{x}_c)\\,\\hat{\\nabla} N_j(0,0)$.**\n\n-   **Integral Expression**: This expression is fundamentally flawed. It applies reference gradients $\\hat{\\nabla} N_a$ directly, without transforming them to physical space using the Jacobian $\\mathbf{J}$. It also completely omits the $\\det(\\mathbf{J})$ factor from the area-element transformation. The formula effectively computes the stiffness matrix as if the physical element were the reference square itself, ignoring the actual element geometry and anisotropy induced by the mapping.\n-   **Procedure**: $1 \\times 1$ Gauss quadrature (reduced integration) is generally not accurate enough and can lead to spurious zero-energy modes. The procedure is consistent with the flawed integral (by also approximating $\\mathbf{K}$ as constant), but the integral itself is incorrect.\n\nThis option is incorrect due to a flawed mathematical formulation. **Incorrect**.\n\n**C. $k_{ij}^e = \\displaystyle \\int_{-1}^{1}\\!\\!\\int_{-1}^{1} \\big(\\nabla N_i(\\xi,\\eta)\\big)^{T}\\,\\mathbf{K}\\big(\\mathbf{x}(\\xi,\\eta)\\big)\\,\\nabla N_j(\\xi,\\eta)\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta$, with $\\nabla N_i = \\mathbf{J}^{T}\\hat{\\nabla}N_i$ and $\\mathbf{x}(\\xi,\\eta)=\\sum_{a=1}^4 N_a(\\xi,\\eta)\\mathbf{x}_a$. Procedure: choose $2\\times 2$ Gauss-Legendre points, compute $\\mathbf{J}$ only once at $(\\xi,\\eta)=(0,0)$, reuse it at all points, evaluate $\\mathbf{K}$ at each mapped point, and accumulate $k_{ij}^e$ without the $\\det\\mathbf{J}$ factor.**\n\n-   **Integral Expression**: The integral is missing the crucial Jacobian determinant factor $\\det(\\mathbf{J})$, which arises from the change of variables $\\mathrm{d}\\mathbf{x} = \\det(\\mathbf{J}) \\mathrm{d}\\xi \\mathrm{d}\\eta$.\n-   **Definitions**: The gradient transformation is stated as $\\nabla N_i = \\mathbf{J}^{T}\\hat{\\nabla}N_i$, which is incorrect. The correct relation is $\\nabla N_i = \\mathbf{J}^{-T}\\hat{\\nabla}N_i$.\n-   **Procedure**: The procedure suggests computing $\\mathbf{J}$ only once at the element's parametric center. This is only valid for parallelogram-shaped elements where $\\mathbf{J}$ is constant. For general distorted quadrilaterals, $\\mathbf{J}$ varies with $(\\xi, \\eta)$ and must be re-evaluated at each Gauss point.\n\nThis option contains multiple fundamental errors in the formula, definition, and procedure. **Incorrect**.\n\n**D. $k_{ij}^e = \\displaystyle \\int_{-1}^{1}\\!\\!\\int_{-1}^{1} \\big(\\hat{\\nabla} N_i(\\xi,\\eta)\\big)^{T}\\,\\big(\\mathbf{J}^{T}\\,\\mathbf{K}\\big(\\mathbf{x}(\\xi,\\eta)\\big)\\,\\mathbf{J}\\big)\\,\\hat{\\nabla} N_j(\\xi,\\eta)\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta$. Procedure: use tensor-product Gauss-Legendre quadrature of order $1\\times 1$ for efficiency, compute $\\mathbf{J}$ and $\\mathbf{K}$ at the single Gauss point, form the inner product above, and sum with the quadrature weight; no determinant term is needed because the transformation is embedded in $\\mathbf{J}^{T}\\mathbf{K}\\mathbf{J}$.**\n\n-   **Integral Expression**: The expression is incorrect. The correct transformation of the integrand is $(\\hat{\\nabla} N_i)^T \\mathbf{J}^{-1} \\mathbf{K} \\mathbf{J}^{-T} \\hat{\\nabla} N_j \\det(\\mathbf{J})$. This expression incorrectly uses $\\mathbf{J}^T$ and $\\mathbf{J}$ instead of $\\mathbf{J}^{-1}$ and $\\mathbf{J}^{-T}$ and also omits the $\\det(\\mathbf{J})$ factor.\n-   **Reasoning**: The claim that the determinant is not needed because the transformation is \"embedded\" is fallacious. The $\\det(\\mathbf{J})$ factor arises from the transformation of the differential area element and is a separate contribution from the transformation of the gradients.\n-   **Procedure**: Recommending $1 \\times 1$ quadrature as a general rule is poor advice. While usable in some contexts (reduced integration), it is not a generally \"sound\" procedure due to potential issues with accuracy and stability (spurious modes).\n\nThis option presents an incorrect formula and faulty reasoning. **Incorrect**.", "answer": "$$\\boxed{A}$$", "id": "3572415"}, {"introduction": "With the fundamentals of element mapping and matrix assembly established, we can now apply these tools to a sophisticated problem in computational geophysics: the analysis of numerical dispersion. This advanced practice challenges you to compare the accuracy of linear triangular ($P_1$) and bilinear quadrilateral ($Q_1$) elements for simulating anisotropic wave propagation. By implementing a numerical experiment based on Bloch-Floquet theory, you will gain deep insight into how the choice of element type affects the fidelity of wave simulations, a crucial consideration for achieving accurate results in seismic modeling and imaging [@problem_id:3572395].", "problem": "Consider the two-dimensional anti-plane shear (out-of-plane) elastic wave equation with constant anisotropic shear stiffness, which is a standard scalar surrogate for elastic shear-horizontal wave propagation in computational geophysics. Let $u(x,y,t)$ be the out-of-plane displacement in a homogeneous medium with density $\\rho>0$ and symmetric positive-definite anisotropy tensor $\\mathbf{A}\\in\\mathbb{R}^{2\\times 2}$. The governing equation is\n$$\n\\rho\\,\\partial_{tt} u \\;=\\; \\nabla\\cdot\\big(\\mathbf{A}\\,\\nabla u\\big)\\,,\n$$\nwith $\\mathbf{A}=\\begin{bmatrix} a_{11} & a_{12} \\\\ a_{12} & a_{22}\\end{bmatrix}$ constant. For a plane wave of the form $u(\\mathbf{x},t)=\\exp\\big(i(\\mathbf{k}\\cdot\\mathbf{x}-\\omega t)\\big)$ with wave vector $\\mathbf{k}=k\\,\\mathbf{n}(\\theta)$, where $\\mathbf{n}(\\theta)=[\\cos\\theta,\\sin\\theta]^T$ and $\\theta$ is the propagation direction in radians, the exact dispersion relation follows from first principles as\n$$\n\\omega^2 \\;=\\; \\frac{k^2}{\\rho}\\;\\mathbf{n}(\\theta)^T\\,\\mathbf{A}\\,\\mathbf{n}(\\theta)\\,,\n$$\nand the exact phase velocity is $c(\\theta)=\\omega/k=\\sqrt{\\mathbf{n}(\\theta)^T\\,\\mathbf{A}\\,\\mathbf{n}(\\theta)/\\rho}$.\n\nWe seek to compare the numerical dispersion (directional phase velocity) of two standard two-dimensional finite element discretizations on the unit square periodic cell $\\Omega=[0,1]\\times[0,1]$:\n- Linear triangular elements ($P_1$) on the mesh formed by two triangles splitting the unit square along the diagonal, with nodes at $(0,0)$, $(1,0)$, $(1,1)$, and $(0,1)$.\n- Bilinear quadrilateral elements ($Q_1$) on the unit square with the same four corner nodes.\n\nLet $h=1$ denote the cell size. Use the standard Galerkin method with consistent mass matrices. For the $P_1$ elements, use exact analytic element matrices for linear triangles. For the $Q_1$ elements, use exact $2\\times 2$ Gauss quadrature on the reference square to assemble the element matrices. Assemble the global $4\\times 4$ stiffness matrix $\\mathbf{K}$ and mass matrix $\\mathbf{M}$ on the periodic cell for each element type.\n\nImpose Bloch periodicity with quasi-periodic boundary conditions across the unit cell: if $\\boldsymbol{\\xi}=k\\,\\mathbf{n}(\\theta)$ is the dimensionless wave vector (with $h=1$), then the nodal values at periodic images differ by a phase factor $\\exp(i\\,\\boldsymbol{\\xi}\\cdot\\mathbf{T})$ where $\\mathbf{T}$ is a lattice translation. With the four nodes ordered as $\\{(0,0),(1,0),(1,1),(0,1)\\}$, the Bloch-amplitude vector mapping the four nodal unknowns to a single complex amplitude is\n$$\n\\mathbf{v}(\\boldsymbol{\\xi}) \\;=\\; \\begin{bmatrix}1 \\\\ e^{i\\,\\xi_x} \\\\ e^{i\\,(\\xi_x+\\xi_y)} \\\\ e^{i\\,\\xi_y}\\end{bmatrix}\\,,\n$$\nwhere $\\boldsymbol{\\xi}=[\\xi_x,\\xi_y]^T=[k\\cos\\theta,\\,k\\sin\\theta]^T$. The semidiscrete dispersion relation emerges from the generalized Rayleigh quotient\n$$\n\\omega_h^2(\\boldsymbol{\\xi}) \\;=\\; \\frac{\\mathbf{v}(\\boldsymbol{\\xi})^{\\ast}\\,\\mathbf{K}\\,\\mathbf{v}(\\boldsymbol{\\xi})}{\\mathbf{v}(\\boldsymbol{\\xi})^{\\ast}\\,\\mathbf{M}\\,\\mathbf{v}(\\boldsymbol{\\xi})}\\,,\n$$\nwhere $^{\\ast}$ denotes complex conjugate transpose.\n\nDefine the numerical phase velocity at fixed $k$ and direction $\\theta$ by $c_h(\\theta;k)=\\omega_h(\\boldsymbol{\\xi})/k$. Alternatively, define the numerical wavenumber $k_h(\\theta;\\omega)$ at fixed angular frequency $\\omega$ and direction $\\theta$ implicitly by solving $\\omega_h\\big(k_h\\,\\mathbf{n}(\\theta)\\big)=\\omega$. Given an exact target angular frequency $\\omega=c(\\theta)\\,k_0$ at some reference wavenumber magnitude $k_0$, a key error metric is the relative phase-velocity error at fixed $\\omega$:\n$$\n\\varepsilon(\\theta;k_0) \\;=\\; \\frac{c_h(\\theta;\\omega)-c(\\theta)}{c(\\theta)} \\;=\\; \\frac{k_0}{k_h(\\theta;\\omega)}-1\\,.\n$$\n\nYour tasks are:\n1) Starting from the governing equation and the plane-wave ansatz, derive the exact dispersion relation and phase velocity $c(\\theta)$ as a function of direction $\\theta$ and the anisotropy tensor $\\mathbf{A}$.\n2) Derive the finite element semidiscrete form on the unit cell for both $P_1$ and $Q_1$ elements, expressing the global matrices $\\mathbf{K}$ and $\\mathbf{M}$ in terms of element contributions. State clearly how the Bloch periodicity reduces the problem to the Rayleigh quotient given above.\n3) Using the derived formulas, implement a program that, for a given symmetric positive-definite $\\mathbf{A}$ and density $\\rho$, computes for each element family the directional numerical wavenumber $k_h(\\theta;\\omega)$ that solves $\\omega_h\\big(k_h\\,\\mathbf{n}(\\theta)\\big)=\\omega$ with $\\omega=c(\\theta)\\,k_0$, and evaluates the maximum absolute value over $\\theta\\in[0,2\\pi)$ of the relative error $\\varepsilon(\\theta;k_0)$ sampled at uniformly spaced angles.\n\nScientific and numerical requirements:\n- Use $h=1$ and dimensionless units; angles $\\theta$ are in radians.\n- Use consistent mass matrices for both $P_1$ and $Q_1$ elements.\n- For $Q_1$, use exact $2\\times 2$ Gauss quadrature to assemble element matrices.\n- For $P_1$, use exact analytic expressions for linear triangles.\n- Use the Bloch-amplitude vector $\\mathbf{v}(\\boldsymbol{\\xi})$ as stated above.\n- Compute $k_h(\\theta;\\omega)$ for each $\\theta$ by solving the scalar nonlinear equation $\\omega_h\\big(k\\,\\mathbf{n}(\\theta)\\big)=\\omega$ with a robust bracketing method over $k\\in(0,\\pi)$.\n- Sample $\\theta$ uniformly with $N_\\theta=16$ directions: $\\theta_m=2\\pi m/N_\\theta$ for $m=0,1,\\dots,15$.\n\nTest suite and required output:\nEvaluate the maximum absolute relative phase-velocity error over the $16$ directions for each of the following three test cases. In all cases use $\\rho=1$ and the same anisotropy tensor $\\mathbf{A}=\\begin{bmatrix}4 & 1 \\\\ 1 & 2\\end{bmatrix}$. For each test case $j$, define $k_0^{(j)}$ as follows:\n- Test 1 (happy path): $k_0^{(1)}=\\pi/12$.\n- Test 2 (moderate wavenumber): $k_0^{(2)}=\\pi/6$.\n- Test 3 (nearer to Brillouin-zone boundary): $k_0^{(3)}=\\pi/3$.\n\nFor each test case, compute two floating-point results:\n- $E_{P_1}^{(j)}=\\max_{m}|\\varepsilon_{P_1}(\\theta_m;k_0^{(j)})|$,\n- $E_{Q_1}^{(j)}=\\max_{m}|\\varepsilon_{Q_1}(\\theta_m;k_0^{(j)})|$.\n\nFinal output format:\nYour program should produce a single line of output containing a comma-separated list enclosed in square brackets with six floating-point numbers in the order\n$$\n\\big[E_{P_1}^{(1)},\\;E_{Q_1}^{(1)},\\;E_{P_1}^{(2)},\\;E_{Q_1}^{(2)},\\;E_{P_1}^{(3)},\\;E_{Q_1}^{(3)}\\big]\\,.\n$$\nAll six numbers are dimensionless. No additional text or formatting should be printed.", "solution": "The problem requires a validation followed by a comprehensive solution to analyze the numerical dispersion of finite element methods for the 2D anti-plane shear wave equation.\n\n### Problem Validation\n**Step 1: Extracted Givens**\n-   **Governing Equation**: $\\rho\\,\\partial_{tt} u \\;=\\; \\nabla\\cdot\\big(\\mathbf{A}\\,\\nabla u\\big)$\n-   **Parameters**: Density $\\rho>0$, constant symmetric positive-definite anisotropy tensor $\\mathbf{A}=\\begin{bmatrix} a_{11} & a_{12} \\\\ a_{12} & a_{22}\\end{bmatrix}$.\n-   **Plane Wave**: $u(\\mathbf{x},t)=\\exp\\big(i(\\mathbf{k}\\cdot\\mathbf{x}-\\omega t)\\big)$ with $\\mathbf{k}=k\\,\\mathbf{n}(\\theta)$ and $\\mathbf{n}(\\theta)=[\\cos\\theta,\\sin\\theta]^T$.\n-   **Exact Dispersion Relation**: $\\omega^2 = \\frac{k^2}{\\rho}\\;\\mathbf{n}(\\theta)^T\\,\\mathbf{A}\\,\\mathbf{n}(\\theta)$.\n-   **Exact Phase Velocity**: $c(\\theta)=\\sqrt{\\mathbf{n}(\\theta)^T\\,\\mathbf{A}\\,\\mathbf{n}(\\theta)/\\rho}$.\n-   **Discretization Domain**: Unit square periodic cell $\\Omega=[0,1]\\times [0,1]$ with cell size $h=1$.\n-   **Element Types**: Linear triangular ($P_1$) and bilinear quadrilateral ($Q_1$). Nodes are at $(0,0), (1,0), (1,1), (0,1)$. The $P_1$ mesh splits the square along the diagonal from $(0,0)$ to $(1,1)$.\n-   **Numerical Method**: Galerkin method with consistent mass matrices. $Q_1$ matrices assembled using $2\\times 2$ Gauss quadrature. $P_1$ matrices from exact analytic formulas.\n-   **Periodicity**: Bloch periodicity with Bloch-amplitude vector for nodes $\\{(0,0),(1,0),(1,1),(0,1)\\}$ given by $\\mathbf{v}(\\boldsymbol{\\xi}) = [1, e^{i\\,\\xi_x}, e^{i\\,(\\xi_x+\\xi_y)}, e^{i\\,\\xi_y}]^T$, where $\\boldsymbol{\\xi}=k\\,\\mathbf{n}(\\theta)$.\n-   **Semidiscrete Dispersion**: $\\omega_h^2(\\boldsymbol{\\xi}) = (\\mathbf{v}(\\boldsymbol{\\xi})^{\\ast}\\,\\mathbf{K}\\,\\mathbf{v}(\\boldsymbol{\\xi})) / (\\mathbf{v}(\\boldsymbol{\\xi})^{\\ast}\\,\\mathbf{M}\\,\\mathbf{v}(\\boldsymbol{\\xi}))$.\n-   **Error Metric**: Relative phase-velocity error $\\varepsilon(\\theta;k_0) = k_0/k_h(\\theta;\\omega)-1$, where $k_h$ solves $\\omega_h\\big(k_h\\,\\mathbf{n}(\\theta)\\big)=\\omega$ for a target frequency $\\omega=c(\\theta)\\,k_0$.\n-   **Numerical Evaluation**: Solve for $k_h \\in (0,\\pi)$ using a robust bracketing method. Sample $N_\\theta=16$ directions $\\theta_m=2\\pi m/N_\\theta$.\n-   **Test Suite**: $\\rho=1$, $\\mathbf{A}=\\begin{bmatrix}4 & 1 \\\\ 1 & 2\\end{bmatrix}$. Three test cases with $k_0 = \\pi/12, \\pi/6, \\pi/3$.\n-   **Output**: Maximum absolute error over all directions for each test case and element type, resulting in $6$ values.\n\n**Step 2: Validation Using Extracted Givens**\nThe problem is scientifically grounded, describing a standard physical model (anisotropic wave propagation) and its analysis with a standard numerical method (Finite Element Method). The concepts of numerical dispersion, Bloch-Floquet theory, and error analysis are all well-established. The provided anisotropy tensor $\\mathbf{A}$ is symmetric, and since its determinant is $4\\times 2 - 1^2 = 7 > 0$ and its first principal minor is $4 > 0$, it is positive-definite as required physically. The problem is well-posed, providing all necessary definitions, parameters, and procedures to arrive at a unique, computable result. The language is objective and unambiguous. The problem does not violate any of the invalidity criteria.\n\n**Step 3: Verdict and Action**\nThe problem is valid. A complete solution follows.\n\n---\n\n### Principle-Based Solution\n\nThe solution is presented in three parts as requested: derivation of the exact dispersion relation, derivation of the finite element semidiscrete form, and an outline of the numerical implementation.\n\n**1. Exact Dispersion Relation**\n\nThe governing partial differential equation is $\\rho\\,\\partial_{tt} u = \\nabla\\cdot\\big(\\mathbf{A}\\,\\nabla u\\big)$. We substitute the plane-wave ansatz $u(\\mathbf{x},t)=\\exp\\big(i(\\mathbf{k}\\cdot\\mathbf{x}-\\omega t)\\big)$.\nThe time and space derivatives are:\n-   $\\partial_{tt} u = (-i\\omega)^2 u = -\\omega^2 u$\n-   $\\nabla u = i\\mathbf{k} u$\n-   $\\nabla\\cdot\\big(\\mathbf{A}\\,\\nabla u\\big) = \\nabla\\cdot\\big(i\\mathbf{A}\\mathbf{k} u\\big) = (i\\mathbf{k})\\cdot(i\\mathbf{A}\\mathbf{k} u) = -\\big(\\mathbf{k}^T\\mathbf{A}\\mathbf{k}\\big) u$, since $\\mathbf{A}$ is constant.\n\nSubstituting these into the governing equation yields:\n$$\n\\rho(-\\omega^2 u) = -(\\mathbf{k}^T\\mathbf{A}\\mathbf{k}) u\n$$\nFor a non-trivial solution ($u \\neq 0$), we arrive at the dispersion relation:\n$$\n\\rho\\omega^2 = \\mathbf{k}^T\\mathbf{A}\\mathbf{k}\n$$\nWith the wave vector $\\mathbf{k} = k\\,\\mathbf{n}(\\theta)$, this becomes $\\rho\\omega^2 = k^2\\,\\mathbf{n}(\\theta)^T\\mathbf{A}\\mathbf{n}(\\theta)$. The phase velocity $c(\\theta) = \\omega/k$ (for $\\omega, k > 0$) is thus:\n$$\nc(\\theta) = \\sqrt{\\frac{\\mathbf{n}(\\theta)^T\\mathbf{A}\\mathbf{n}(\\theta)}{\\rho}}\n$$\nExpanding the quadratic form with $\\mathbf{n}(\\theta)=[\\cos\\theta, \\sin\\theta]^T$ and $\\mathbf{A}=\\begin{bmatrix} a_{11} & a_{12} \\\\ a_{12} & a_{22}\\end{bmatrix}$:\n$$\n\\mathbf{n}(\\theta)^T\\mathbf{A}\\mathbf{n}(\\theta) = a_{11}\\cos^2\\theta + 2a_{12}\\cos\\theta\\sin\\theta + a_{22}\\sin^2\\theta\n$$\nThis completes the derivation of the exact phase velocity.\n\n**2. Finite Element Semidiscrete Form**\n\nThe weak form of the governing equation over the domain $\\Omega$ is obtained by multiplying by a test function $v$ and integrating, which results in $\\mathbf{M}\\ddot{\\mathbf{u}} + \\mathbf{K}\\mathbf{u} = \\mathbf{0}$, where nodal vectors $\\mathbf{u}(t)$ and $\\ddot{\\mathbf{u}}(t)$ contain the degrees of freedom and their accelerations. The global mass matrix $\\mathbf{M}$ and stiffness matrix $\\mathbf{K}$ are given by:\n$$\nM_{ij} = \\int_\\Omega \\rho N_i N_j \\, d\\Omega, \\quad K_{ij} = \\int_\\Omega (\\nabla N_i)^T \\mathbf{A} (\\nabla N_j) \\, d\\Omega\n$$\nwhere $N_i$ are the global shape functions. These matrices are assembled from element-level contributions.\n\n**$P_1$ Triangular Elements:**\nThe unit square is meshed with two triangles, T1 (nodes $1,2,3$ at $(0,0), (1,0), (1,1)$) and T2 (nodes $1,3,4$ at $(0,0), (1,1), (0,1)$). The area of each is $A = 1/2$. For linear triangles, the gradient of the shape functions is constant.\n\nFor T1 with vertices $(0,0), (1,0), (1,1)$, the matrix of shape function gradients is $\\mathbf{B}^1 = [\\nabla N^1_1, \\nabla N^1_2, \\nabla N^1_3] = \\begin{bmatrix} -1 & 1 & 0 \\\\ 0 & -1 & 1 \\end{bmatrix}$. The element stiffness matrix is $K^1 = A \\cdot (\\mathbf{B}^1)^T \\mathbf{A} \\mathbf{B}^1$:\n$$\nK^1 = \\frac{1}{2} \\begin{bmatrix} a_{11} & -a_{11}+a_{12} & -a_{12} \\\\ -a_{11}+a_{12} & a_{11}-2a_{12}+a_{22} & a_{12}-a_{22} \\\\ -a_{12} & a_{12}-a_{22} & a_{22} \\end{bmatrix}\n$$\nFor T2 with vertices $(0,0), (1,1), (0,1)$, the gradient matrix for local nodes mapping to global $1,3,4$ is $\\mathbf{B}^2 = [\\nabla N^2_1, \\nabla N^2_3, \\nabla N^2_4] = \\begin{bmatrix} 0 & 1 & -1 \\\\ -1 & 0 & 1 \\end{bmatrix}$. The element stiffness matrix is $K^2 = A \\cdot (\\mathbf{B}^2)^T \\mathbf{A} \\mathbf{B}^2$:\n$$\nK^2 = \\frac{1}{2} \\begin{bmatrix} a_{22} & -a_{12} & a_{12}-a_{22} \\\\ -a_{12} & a_{11} & -a_{11}+a_{12} \\\\ a_{12}-a_{22} & -a_{11}+a_{12} & a_{11}-2a_{12}+a_{22} \\end{bmatrix}\n$$\nThe consistent element mass matrix for a linear triangle is $M^e = \\frac{\\rho A}{12} \\begin{bmatrix} 2 & 1 & 1 \\\\ 1 & 2 & 1 \\\\ 1 & 1 & 2 \\end{bmatrix} = \\frac{\\rho}{24} \\begin{bmatrix} 2 & 1 & 1 \\\\ 1 & 2 & 1 \\\\ 1 & 1 & 2 \\end{bmatrix}$.\n\nThe $4\\times 4$ global matrices $\\mathbf{K}_P$ and $\\mathbf{M}_P$ are formed by assembling the contributions from $K^1, M^1$ (on nodes $1,2,3$) and $K^2, M^2$ (on nodes $1,3,4$).\n\n**$Q_1$ Quadrilateral Elements:**\nThe unit square is a single $Q_1$ element with nodes $1,2,3,4$ at $(0,0), (1,0), (1,1), (0,1)$. The shape functions are $N_1=(1-x)(1-y)$, $N_2=x(1-y)$, $N_3=xy$, $N_4=(1-x)y$. Element matrices $\\mathbf{K}_Q$ and $\\mathbf{M}_Q$ are computed by numerical quadrature over the element domain $[0,1]\\times[0,1]$. As specified, we use a $2\\times 2$ tensor-product Gauss-Legendre quadrature rule, which is exact for these bilinear elements.\n$$\n\\mathbf{K}_Q = \\sum_{q=1}^4 w_q (\\mathbf{B}(\\mathbf{x}_q))^T \\mathbf{A} \\mathbf{B}(\\mathbf{x}_q), \\quad \\mathbf{M}_Q = \\rho \\sum_{q=1}^4 w_q \\mathbf{N}(\\mathbf{x}_q)^T \\mathbf{N}(\\mathbf{x}_q)\n$$\nwhere $\\mathbf{x}_q, w_q$ are the quadrature points and weights, $\\mathbf{N}$ is the vector of shape functions, and $\\mathbf{B}=[\\nabla N_1, \\dots, \\nabla N_4]$ is the matrix of shape function gradients.\n\n**Bloch Periodicity and Numerical Dispersion:**\nAssuming a harmonic solution $\\mathbf{u}(t) = \\mathbf{U} e^{-i\\omega_h t}$ for the nodal values, we get a generalized eigenvalue problem $\\mathbf{K}\\mathbf{U} = \\omega_h^2\\mathbf{M}\\mathbf{U}$. The Bloch-Floquet theorem dictates that for a periodic structure, the solution must be of the form $\\mathbf{U} \\propto \\mathbf{v}(\\boldsymbol{\\xi})$, where $\\mathbf{v}(\\boldsymbol{\\xi})$ is the Bloch-amplitude vector specified in the problem. Substituting this into the eigenvalue problem and forming the Rayleigh quotient gives the scalar numerical dispersion relation:\n$$\n\\omega_h^2(\\boldsymbol{\\xi}) = \\frac{\\mathbf{v}(\\boldsymbol{\\xi})^{\\ast}\\,\\mathbf{K}\\,\\mathbf{v}(\\boldsymbol{\\xi})}{\\mathbf{v}(\\boldsymbol{\\xi})^{\\ast}\\,\\mathbf{M}\\,\\mathbf{v}(\\boldsymbol{\\xi})}\n$$\n\n**3. Numerical Error Analysis**\n\nThe final task is to compute the maximum relative phase-velocity error. For each of the $N_\\theta=16$ propagation directions $\\theta_m$, and for each test case defined by $k_0$, we perform the following steps:\n1.  Calculate the exact phase velocity $c(\\theta_m)$ and the target angular frequency $\\omega = c(\\theta_m) k_0$.\n2.  Define a residual function $f(k) = \\omega_h^2(k\\mathbf{n}(\\theta_m)) - \\omega^2$.\n3.  Solve the scalar nonlinear equation $f(k) = 0$ for the numerical wavenumber $k_h(\\theta_m; \\omega)$ using a bracketing root-finder (e.g., Brent's method) on the interval $(0, \\pi)$. The interval is appropriate as $\\omega_h(k=0)=0$ (ensuring $f(0) < 0$ for $k_0>0$) and $k=\\pi$ corresponds to the Nyquist wavenumber for a grid of size $h=1$.\n4.  Compute the relative error $\\varepsilon(\\theta_m;k_0) = k_0/k_h - 1$.\n5.  The final result for a given element type and $k_0$ is the maximum of the absolute values of these errors over all $m=0, \\dots, 15$. This procedure is repeated for both $P_1$ and $Q_1$ elements across all three test cases.", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import brentq\n\ndef get_p1_matrices(a11, a12, a22, rho):\n    \"\"\"\n    Computes the global stiffness and mass matrices for P1 triangular elements\n    on a unit square split along the main diagonal.\n    \"\"\"\n    # Stiffness matrix for triangle 1 (nodes 1,2,3)\n    K1 = 0.5 * np.array([\n        [a11, -a11 + a12, -a12],\n        [-a11 + a12, a11 - 2 * a12 + a22, a12 - a22],\n        [-a12, a12 - a22, a22]\n    ])\n    \n    # Stiffness matrix for triangle 2 (nodes 1,3,4)\n    # Local node order maps to global 1,3,4\n    K2 = 0.5 * np.array([\n        [a22, -a12, a12 - a22],\n        [-a12, a11, -a11 + a12],\n        [a12 - a22, -a11 + a12, a11 - 2 * a12 + a22]\n    ])\n    \n    K_P = np.zeros((4, 4))\n    # Python indices for nodes are 0,1,2,3.\n    # T1 nodes (1,2,3) -> indices (0,1,2)\n    K_P[np.ix_([0, 1, 2], [0, 1, 2])] += K1\n    # T2 nodes (1,3,4) -> indices (0,2,3)\n    K_P[np.ix_([0, 2, 3], [0, 2, 3])] += K2\n    \n    # Consistent mass matrix for a linear triangle (Area=0.5)\n    M_elem = (rho * 0.5 / 12.0) * np.array([\n        [2, 1, 1],\n        [1, 2, 1],\n        [1, 1, 2]\n    ])\n    \n    M_P = np.zeros((4, 4))\n    # Assemble mass matrices for T1 and T2\n    M_P[np.ix_([0, 1, 2], [0, 1, 2])] += M_elem\n    M_P[np.ix_([0, 2, 3], [0, 2, 3])] += M_elem\n    \n    return K_P, M_P\n\ndef get_q1_matrices(A, rho):\n    \"\"\"\n    Computes the stiffness and mass matrices for a Q1 bilinear quadrilateral\n    element on the unit square using 2x2 Gauss quadrature.\n    \"\"\"\n    # Gauss points and weights for the interval [0,1]\n    gp = 0.5 * (1.0 - 1.0 / np.sqrt(3)), 0.5 * (1.0 + 1.0 / np.sqrt(3))\n    w = 0.5, 0.5\n    \n    K_Q = np.zeros((4, 4))\n    M_Q = np.zeros((4, 4))\n    \n    # 2x2 quadrature loop\n    for i in range(2):\n        for j in range(2):\n            x, y = gp[i], gp[j]\n            weight = w[i] * w[j]\n            \n            # Shape functions N at (x,y)\n            N = np.array([(1-x)*(1-y), x*(1-y), x*y, (1-x)*y])\n            \n            # Gradients of shape functions dN/dx and dN/dy\n            dN_dx = np.array([-(1-y), 1-y, y, -y])\n            dN_dy = np.array([-(1-x), -x, x, 1-x])\n            \n            B = np.vstack((dN_dx, dN_dy))  # Gradient matrix B (2x4)\n            \n            K_Q += weight * B.T @ A @ B\n            M_Q += rho * weight * np.outer(N, N)\n            \n    return K_Q, M_Q\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases_k0 = [np.pi / 12.0, np.pi / 6.0, np.pi / 3.0]\n\n    # Problem constants\n    RHO = 1.0\n    A_TENSOR = np.array([[4.0, 1.0], [1.0, 2.0]])\n    N_THETA = 16\n    \n    # Pre-compute FE matrices\n    a11, a12, a22 = A_TENSOR[0, 0], A_TENSOR[0, 1], A_TENSOR[1, 1]\n    K_p1, M_p1 = get_p1_matrices(a11, a12, a22, RHO)\n    K_q1, M_q1 = get_q1_matrices(A_TENSOR, RHO)\n    \n    matrices = {'P1': (K_p1, M_p1), 'Q1': (K_q1, M_q1)}\n    \n    all_results = []\n    \n    for k0 in test_cases_k0:\n        for elem_type in ['P1', 'Q1']:\n            K, M = matrices[elem_type]\n            max_abs_error = 0.0\n            \n            angles = np.linspace(0, 2 * np.pi, N_THETA, endpoint=False)\n            \n            for theta in angles:\n                n_vec = np.array([np.cos(theta), np.sin(theta)])\n                \n                # Exact phase velocity and target frequency\n                c_sq_exact = (n_vec.T @ A_TENSOR @ n_vec) / RHO\n                c_exact = np.sqrt(c_sq_exact)\n                omega_sq_target = c_sq_exact * k0**2\n                \n                def omega_h_sq(k, n, K_mat, M_mat):\n                    if k  1e-12: return 0.0\n                    xi = k * n\n                    v = np.array([1, \n                                  np.exp(1j * xi[0]), \n                                  np.exp(1j * (xi[0] + xi[1])),\n                                  np.exp(1j * xi[1])])\n                    \n                    num = (v.conj().T @ K_mat @ v).real\n                    den = (v.conj().T @ M_mat @ v).real\n                    return num / den if den != 0 else 0.0\n\n                def residual(k):\n                    return omega_h_sq(k, n_vec, K, M) - omega_sq_target\n                \n                try:\n                    # Solve for numerical wavenumber k_h\n                    k_h = brentq(residual, 1e-9, np.pi)\n                    # Calculate relative phase velocity error\n                    error = (k0 / k_h) - 1.0\n                    if abs(error) > max_abs_error:\n                        max_abs_error = abs(error)\n                except ValueError:\n                    # This case should not occur for the given problem parameters.\n                    # It would indicate that the root is not bracketed in (0, pi).\n                    max_abs_error = np.nan\n\n            all_results.append(max_abs_error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\nsolve()\n```", "id": "3572395"}]}