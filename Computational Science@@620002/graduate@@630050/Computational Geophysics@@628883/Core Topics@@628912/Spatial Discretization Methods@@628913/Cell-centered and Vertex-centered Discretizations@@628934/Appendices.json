{"hands_on_practices": [{"introduction": "Before we can trust the results of a numerical simulation, we must first verify that our code correctly solves the intended equations. The Method of Manufactured Solutions (MMS) is a rigorous and indispensable technique for this purpose. This exercise [@problem_id:3579337] guides you through the foundational step of MMS: deriving the analytical source term $s(\\mathbf{x})$ that forces a chosen, smooth \"manufactured\" function $u(\\mathbf{x})$ to be an exact solution of the governing PDE. Mastering this allows you to create benchmark tests with known solutions, which are crucial for debugging and quantifying the accuracy of any discretization scheme, be it cell-centered or vertex-centered.", "problem": "Consider the steady diffusion equation used in computational geophysics to model conductive transport of heat or mass,\n$$-\\nabla \\cdot \\left( \\mathbf{K}(\\mathbf{x}) \\nabla u(\\mathbf{x}) \\right) = s(\\mathbf{x}) \\quad \\text{in } \\Omega,$$\nposed on the unit square domain $\\Omega = (0,1) \\times (0,1)$ with outward unit normal $\\mathbf{n}$. The governing law arises from conservation of a scalar quantity and a linear constitutive relation, where the flux is $\\mathbf{q} = -\\mathbf{K}\\nabla u$, and the local balance over a control volume $V \\subset \\Omega$ reads\n$$\\int_{V} s \\, \\mathrm{d}V = -\\int_{\\partial V} \\mathbf{n}\\cdot \\mathbf{K}\\nabla u \\, \\mathrm{d}A.$$\nThis partial differential equation is the common continuous target for both cell-centered and vertex-centered spatial discretizations. To validate both discretizations with exact boundary treatment via the method of manufactured solutions, we prescribe the manufactured solution\n$$u(x,y) = \\sin(\\pi x)\\,\\sin(\\pi y),$$\nand the symmetric, spatially varying conductivity tensor\n$$\\mathbf{K}(x,y) = \n\\begin{pmatrix}\n1 + x^{2} & x y \\\\\nx y & 2 + y^{2}\n\\end{pmatrix},$$\nwhich is positive definite for $(x,y)\\in \\Omega$. Dirichlet data on any Dirichlet boundary are to be set by the exact manufactured solution, $u|_{\\Gamma_{D}}$, and Neumann data on any Neumann boundary are to be set by the exact outward flux, $q_{N} := -\\mathbf{n}\\cdot \\mathbf{K}\\nabla u|_{\\Gamma_{N}}$, so that the boundary is treated exactly in either a cell-centered or a vertex-centered scheme.\n\nStarting from the conservation statement and the constitutive law, and without using any pre-derived shortcut formulas, derive the unique closed-form expression of the source term $s(x,y)$ in the strong form that makes $u(x,y)$ an exact solution of the model with the given $\\mathbf{K}(x,y)$. Your final answer must be the single analytic expression for $s(x,y)$. You do not need to report boundary data in the final answer. No rounding is required and no physical units are needed.", "solution": "The problem requires the derivation of the source term $s(x,y)$ that satisfies the steady diffusion equation $-\\nabla \\cdot \\left( \\mathbf{K}(\\mathbf{x}) \\nabla u(\\mathbf{x}) \\right) = s(\\mathbf{x})$ for a given manufactured solution $u(x,y)$ and conductivity tensor $\\mathbf{K}(x,y)$. The procedure involves a direct calculation by substituting the given expressions for $u$ and $\\mathbf{K}$ into the left-hand side of the partial differential equation.\n\nThe provided manufactured solution is\n$$u(x,y) = \\sin(\\pi x)\\sin(\\pi y)$$\nand the conductivity tensor is\n$$\\mathbf{K}(x,y) = \n\\begin{pmatrix}\n1 + x^{2} & x y \\\\\nx y & 2 + y^{2}\n\\end{pmatrix}$$\n\nThe source term is defined as $s(x,y) = -\\nabla \\cdot (\\mathbf{K}\\nabla u)$. We will compute this expression in several steps.\n\nFirst, we compute the gradient of the scalar field $u(x,y)$, which is $\\nabla u = \\begin{pmatrix} \\frac{\\partial u}{\\partial x} \\\\ \\frac{\\partial u}{\\partial y} \\end{pmatrix}$.\nThe partial derivatives of $u(x,y)$ are:\n$$\\frac{\\partial u}{\\partial x} = \\frac{\\partial}{\\partial x} \\left( \\sin(\\pi x)\\sin(\\pi y) \\right) = \\pi\\cos(\\pi x)\\sin(\\pi y)$$\n$$\\frac{\\partial u}{\\partial y} = \\frac{\\partial}{\\partial y} \\left( \\sin(\\pi x)\\sin(\\pi y) \\right) = \\pi\\sin(\\pi x)\\cos(\\pi y)$$\nSo, the gradient vector is:\n$$\\nabla u(x,y) = \\begin{pmatrix} \\pi\\cos(\\pi x)\\sin(\\pi y) \\\\ \\pi\\sin(\\pi x)\\cos(\\pi y) \\end{pmatrix}$$\n\nNext, we compute the vector field $\\mathbf{F}(x,y) = \\mathbf{K}(x,y)\\nabla u(x,y)$. The source term will then be $s = -\\nabla \\cdot \\mathbf{F}$.\n$$\\mathbf{F}(x,y) = \\begin{pmatrix} 1 + x^{2} & x y \\\\ x y & 2 + y^{2} \\end{pmatrix} \\begin{pmatrix} \\pi\\cos(\\pi x)\\sin(\\pi y) \\\\ \\pi\\sin(\\pi x)\\cos(\\pi y) \\end{pmatrix}$$\nPerforming the matrix-vector multiplication gives the components of $\\mathbf{F} = \\begin{pmatrix} F_x \\\\ F_y \\end{pmatrix}$:\n$$F_x(x,y) = (1 + x^{2}) \\left( \\pi\\cos(\\pi x)\\sin(\\pi y) \\right) + (xy) \\left( \\pi\\sin(\\pi x)\\cos(\\pi y) \\right)$$\n$$F_y(x,y) = (xy) \\left( \\pi\\cos(\\pi x)\\sin(\\pi y) \\right) + (2 + y^{2}) \\left( \\pi\\sin(\\pi x)\\cos(\\pi y) \\right)$$\nThese expressions can be rewritten for clarity:\n$$F_x = \\pi(1+x^2)\\cos(\\pi x)\\sin(\\pi y) + \\pi xy\\sin(\\pi x)\\cos(\\pi y)$$\n$$F_y = \\pi xy\\cos(\\pi x)\\sin(\\pi y) + \\pi(2+y^2)\\sin(\\pi x)\\cos(\\pi y)$$\n\nNow, we compute the divergence of $\\mathbf{F}$, which is $\\nabla \\cdot \\mathbf{F} = \\frac{\\partial F_x}{\\partial x} + \\frac{\\partial F_y}{\\partial y}$. We calculate each partial derivative separately.\n\nFor $\\frac{\\partial F_x}{\\partial x}$, we apply the product rule to each term:\n$$\\frac{\\partial F_x}{\\partial x} = \\frac{\\partial}{\\partial x} \\left( \\pi(1+x^2)\\cos(\\pi x)\\sin(\\pi y) \\right) + \\frac{\\partial}{\\partial x} \\left( \\pi xy\\sin(\\pi x)\\cos(\\pi y) \\right)$$\n$$= \\pi\\sin(\\pi y) \\frac{\\partial}{\\partial x} \\left( (1+x^2)\\cos(\\pi x) \\right) + \\pi y\\cos(\\pi y) \\frac{\\partial}{\\partial x} \\left( x\\sin(\\pi x) \\right)$$\n$$= \\pi\\sin(\\pi y) \\left[ 2x\\cos(\\pi x) - (1+x^2)\\pi\\sin(\\pi x) \\right] + \\pi y\\cos(\\pi y) \\left[ \\sin(\\pi x) + x\\pi\\cos(\\pi x) \\right]$$\n$$= 2\\pi x\\cos(\\pi x)\\sin(\\pi y) - \\pi^2(1+x^2)\\sin(\\pi x)\\sin(\\pi y) + \\pi y\\sin(\\pi x)\\cos(\\pi y) + \\pi^2 xy\\cos(\\pi x)\\cos(\\pi y)$$\n\nFor $\\frac{\\partial F_y}{\\partial y}$, we again apply the product rule to each term:\n$$\\frac{\\partial F_y}{\\partial y} = \\frac{\\partial}{\\partial y} \\left( \\pi xy\\cos(\\pi x)\\sin(\\pi y) \\right) + \\frac{\\partial}{\\partial y} \\left( \\pi(2+y^2)\\sin(\\pi x)\\cos(\\pi y) \\right)$$\n$$= \\pi x\\cos(\\pi x) \\frac{\\partial}{\\partial y} \\left( y\\sin(\\pi y) \\right) + \\pi\\sin(\\pi x) \\frac{\\partial}{\\partial y} \\left( (2+y^2)\\cos(\\pi y) \\right)$$\n$$= \\pi x\\cos(\\pi x) \\left[ \\sin(\\pi y) + y\\pi\\cos(\\pi y) \\right] + \\pi\\sin(\\pi x) \\left[ 2y\\cos(\\pi y) - (2+y^2)\\pi\\sin(\\pi y) \\right]$$\n$$= \\pi x\\cos(\\pi x)\\sin(\\pi y) + \\pi^2 xy\\cos(\\pi x)\\cos(\\pi y) + 2\\pi y\\sin(\\pi x)\\cos(\\pi y) - \\pi^2(2+y^2)\\sin(\\pi x)\\sin(\\pi y)$$\n\nNow we sum the two partial derivatives to find $\\nabla \\cdot \\mathbf{F}$:\n$$\\nabla \\cdot \\mathbf{F} = \\frac{\\partial F_x}{\\partial x} + \\frac{\\partial F_y}{\\partial y}$$\n$$= \\left( 2\\pi x\\cos(\\pi x)\\sin(\\pi y) - \\pi^2(1+x^2)\\sin(\\pi x)\\sin(\\pi y) + \\pi y\\sin(\\pi x)\\cos(\\pi y) + \\pi^2 xy\\cos(\\pi x)\\cos(\\pi y) \\right) \\\\ + \\left( \\pi x\\cos(\\pi x)\\sin(\\pi y) + \\pi^2 xy\\cos(\\pi x)\\cos(\\pi y) + 2\\pi y\\sin(\\pi x)\\cos(\\pi y) - \\pi^2(2+y^2)\\sin(\\pi x)\\sin(\\pi y) \\right)$$\nWe group the terms by their trigonometric factors:\n\\begin{itemize}\n    \\item Terms with $\\sin(\\pi x)\\sin(\\pi y)$: $-\\pi^2(1+x^2) - \\pi^2(2+y^2) = -\\pi^2(3+x^2+y^2)$\n    \\item Terms with $\\cos(\\pi x)\\sin(\\pi y)$: $2\\pi x + \\pi x = 3\\pi x$\n    \\item Terms with $\\sin(\\pi x)\\cos(\\pi y)$: $\\pi y + 2\\pi y = 3\\pi y$\n    \\item Terms with $\\cos(\\pi x)\\cos(\\pi y)$: $\\pi^2 xy + \\pi^2 xy = 2\\pi^2 xy$\n\\end{itemize}\nCombining these gives the expression for the divergence:\n$$\\nabla \\cdot (\\mathbf{K}\\nabla u) = -\\pi^2(3+x^2+y^2)\\sin(\\pi x)\\sin(\\pi y) + 3\\pi x\\cos(\\pi x)\\sin(\\pi y) + 3\\pi y\\sin(\\pi x)\\cos(\\pi y) + 2\\pi^2 xy\\cos(\\pi x)\\cos(\\pi y)$$\n\nThe source term is $s(x,y) = -\\nabla \\cdot (\\mathbf{K}\\nabla u)$. Therefore, we negate the expression above:\n$$s(x,y) = - \\left[ -\\pi^2(3+x^2+y^2)\\sin(\\pi x)\\sin(\\pi y) + 3\\pi x\\cos(\\pi x)\\sin(\\pi y) + 3\\pi y\\sin(\\pi x)\\cos(\\pi y) + 2\\pi^2 xy\\cos(\\pi x)\\cos(\\pi y) \\right]$$\n$$s(x,y) = \\pi^2(3+x^2+y^2)\\sin(\\pi x)\\sin(\\pi y) - 3\\pi x\\cos(\\pi x)\\sin(\\pi y) - 3\\pi y\\sin(\\pi x)\\cos(\\pi y) - 2\\pi^2 xy\\cos(\\pi x)\\cos(\\pi y)$$\nThis is the unique closed-form expression for the source term.", "answer": "$$\\boxed{\\pi^{2}(3+x^{2}+y^{2})\\sin(\\pi x)\\sin(\\pi y) - 3\\pi x\\cos(\\pi x)\\sin(\\pi y) - 3\\pi y\\sin(\\pi x)\\cos(\\pi y) - 2\\pi^{2}xy\\cos(\\pi x)\\cos(\\pi y)}$$", "id": "3579337"}, {"introduction": "A key advantage of the finite volume method is its applicability to complex, unstructured meshes that conform to geological realities. However, this geometric flexibility introduces challenges, particularly when the line connecting two cell centers is not orthogonal to their shared face. This practice [@problem_id:3579382] addresses this critical issue by asking you to derive a robust two-point flux approximation. Starting from the principle of flux continuity, you will derive the symmetric transmissibility term that correctly handles both non-orthogonal grids and heterogeneous material properties, ensuring the resulting linear system is physically consistent and numerically sound.", "problem": "Consider the steady diffusion equation in two spatial dimensions, governed by the conservation law $\\nabla \\cdot \\boldsymbol{q} = 0$ and Fourier’s law $\\boldsymbol{q} = -k \\nabla u$, with piecewise constant isotropic conductivity $k$. In a cell-centered Finite Volume Method (FVM), consider two adjacent polygonal control volumes $V_{1}$ and $V_{2}$ with centroids at $\\boldsymbol{x}_{1}$ and $\\boldsymbol{x}_{2}$ that share an interior face $f$ of area (edge length in two dimensions) $A_{f}$ and unit normal $\\hat{\\boldsymbol{n}}_{f}$ oriented from $V_{1}$ to $V_{2}$. Let the signed distances from the centroids to the face plane along $\\hat{\\boldsymbol{n}}_{f}$ be $d_{1f} > 0$ and $d_{2f} > 0$, defined by $d_{1f} = \\hat{\\boldsymbol{n}}_{f} \\cdot (\\boldsymbol{x}_{f} - \\boldsymbol{x}_{1})$ and $d_{2f} = \\hat{\\boldsymbol{n}}_{f} \\cdot (\\boldsymbol{x}_{2} - \\boldsymbol{x}_{f})$, where $\\boldsymbol{x}_{f}$ is the centroid of face $f$. On a skewed mesh, $\\boldsymbol{x}_{2} - \\boldsymbol{x}_{1}$ is not colinear with $\\hat{\\boldsymbol{n}}_{f}$, so generally $d_{1f} + d_{2f}$ is not equal to the distance between the centroids.\n\nA common but flawed face-assembly in cell-centered discretizations is to assign one-sided, face-normal flux contributions per row using local distances only, namely $a_{12}^{\\text{naive}} = k_{2} A_{f} / d_{2f}$ in the row of $V_{1}$ and $a_{21}^{\\text{naive}} = k_{1} A_{f} / d_{1f}$ in the row of $V_{2}$. This breaks the off-diagonal symmetry required for a symmetric positive definite operator whenever $d_{1f} \\neq d_{2f}$ or $k_{1} \\neq k_{2}$. As a concrete counterexample, take $k_{1} = k_{2} = 1$, $A_{f} = 1$, $d_{1f} = 0.3$, and $d_{2f} = 0.7$; then $a_{12}^{\\text{naive}} \\neq a_{21}^{\\text{naive}}$. Assume all quantities are non-dimensionalized so that units do not appear in the final result.\n\nStarting from the conservation law integrated over each control volume and continuity of the normal flux across $f$, derive a corrected two-point face transmissibility $T_{f}$ that restores symmetry by enforcing $a_{12} = a_{21} = T_{f}$ for the shared face $f$, expressed only in terms of $A_{f}$, $k_{1}$, $k_{2}$, $d_{1f}$, and $d_{2f}$. Your final answer must be a single, closed-form analytic expression for $T_{f}$. Do not provide an inequality or an equation; provide only the expression itself.", "solution": "The user wants to derive the symmetric two-point face transmissibility for a steady-state diffusion problem discretized using a cell-centered Finite Volume Method.\n\nThe problem is first validated.\n\n### Step 1: Extract Givens\n- **Governing Equations**:\n  - Conservation Law: $\\nabla \\cdot \\boldsymbol{q} = 0$.\n  - Constitutive Law (Fourier's Law): $\\boldsymbol{q} = -k \\nabla u$.\n- **Material Property**: $k$ is piecewise constant isotropic conductivity.\n- **Discretization Context**: Cell-centered Finite Volume Method (FVM).\n- **Geometric Setup**:\n  - Two adjacent control volumes $V_1$ and $V_2$.\n  - Cell centroids at $\\boldsymbol{x}_1$ and $\\boldsymbol{x}_2$.\n  - Shared interior face $f$ with area $A_f$.\n  - Unit normal to face $f$, $\\hat{\\boldsymbol{n}}_f$, oriented from $V_1$ to $V_2$.\n  - Face centroid at $\\boldsymbol{x}_f$.\n  - Signed normal distances from centroids to face: $d_{1f} = \\hat{\\boldsymbol{n}}_f \\cdot (\\boldsymbol{x}_f - \\boldsymbol{x}_1) > 0$ and $d_{2f} = \\hat{\\boldsymbol{n}}_f \\cdot (\\boldsymbol{x}_2 - \\boldsymbol{x}_f) > 0$.\n- **Objective**: Derive a corrected two-point face transmissibility $T_f$ such that the resulting discretization is symmetric for the face $f$ (i.e., $a_{12} = a_{21} = T_f$ under the problem's notational convention). The expression for $T_f$ must be in terms of $A_f$, $k_1$, $k_2$, $d_{1f}$, and $d_{2f}$.\n\n### Step 2: Validate Using Extracted Givens\n- **Scientific Grounding**: The problem is well-grounded in the principles of numerical methods for partial differential equations, specifically the Finite Volume Method for diffusion problems. The concepts of transmissibility, control volumes, face fluxes, and the challenge of mesh non-orthogonality are fundamental to this field. The governing equations are standard physics.\n- **Well-Posedness**: The request is to derive a specific mathematical expression based on a clear set of physical and geometric constraints. A unique and meaningful expression for the transmissibility can be determined.\n- **Objectivity**: The problem is stated in precise, objective mathematical and technical language. There are no subjective or ambiguous terms.\n\n### Step 3: Verdict and Action\nThe problem is valid. It is a standard and well-defined exercise in the derivation of numerical schemes for computational physics and engineering. A solution will be provided.\n\n### Derivation of the Symmetric Transmissibility\n\nThe goal is to determine the flux $F_f$ across the face $f$ shared by control volumes $V_1$ and $V_2$ as a function of the cell-centered values $u_1$ and $u_2$. The flux is expressed in the form $F_f = T_f(u_1 - u_2)$, where $T_f$ is the transmissibility we seek to derive.\n\nThe total flux $F_f$ across the face $f$ from $V_1$ to $V_2$ is given by the integral of the normal component of the flux vector $\\boldsymbol{q}$ over the face area:\n$$F_f = \\int_f \\boldsymbol{q} \\cdot \\hat{\\boldsymbol{n}}_f \\, dS$$\nAssuming the flux is uniform across the face, we can approximate this as:\n$$F_f \\approx A_f (\\boldsymbol{q}|_f \\cdot \\hat{\\boldsymbol{n}}_f)$$\nUsing Fourier's law, $\\boldsymbol{q} = -k \\nabla u$, this becomes:\n$$F_f \\approx -A_f (k \\nabla u)|_f \\cdot \\hat{\\boldsymbol{n}}_f = -A_f k_f \\frac{\\partial u}{\\partial n}\\bigg|_f$$\nwhere $k_f$ is the conductivity at the face and $\\frac{\\partial u}{\\partial n}|_f$ is the normal derivative of $u$ at the face.\n\nThe core of the two-point flux approximation is to relate the face value of the potential, $u_f$, and its normal derivative to the cell-centered values $u_1$ and $u_2$. We assume a one-dimensional variation of the potential $u$ along the direction normal to the face in the region near the face.\n\nLet $u_f$ be the value of the potential at the face centroid $\\boldsymbol{x}_f$. We can express the flux from two perspectives: from cell $V_1$ to the face $f$, and from the face $f$ to cell $V_2$.\n\n1.  **Flux from $V_1$ to $f$**: The normal derivative inside $V_1$ at the face can be approximated using a finite difference over the normal distance $d_{1f}$. The conductivity in this region is $k_1$.\n    $$F_f \\approx -A_f k_1 \\frac{u_f - u_1}{d_{1f}} = A_f \\frac{k_1}{d_{1f}}(u_1 - u_f)$$\n    Here, a positive potential difference $(u_1 > u_f)$ correctly drives a positive flux in the direction of $\\hat{\\boldsymbol{n}}_f$.\n\n2.  **Flux from $f$ to $V_2$**: Similarly, the normal derivative inside $V_2$ at the face can be approximated using the normal distance $d_{2f}$ and conductivity $k_2$.\n    $$F_f \\approx -A_f k_2 \\frac{u_2 - u_f}{d_{2f}} = A_f \\frac{k_2}{d_{2f}}(u_f - u_2)$$\n    Here, a positive potential difference $(u_f > u_2)$ correctly drives a positive flux from the face into $V_2$.\n\nFor steady-state diffusion without sources or sinks at the face, the flux must be continuous. Therefore, we equate the two expressions for $F_f$:\n$$A_f \\frac{k_1}{d_{1f}}(u_1 - u_f) = A_f \\frac{k_2}{d_{2f}}(u_f - u_2)$$\nWe can cancel the face area $A_f$ and solve for the unknown face potential $u_f$:\n$$\\frac{k_1}{d_{1f}} u_1 - \\frac{k_1}{d_{1f}} u_f = \\frac{k_2}{d_{2f}} u_f - \\frac{k_2}{d_{2f}} u_2$$\n$$\\frac{k_1}{d_{1f}} u_1 + \\frac{k_2}{d_{2f}} u_2 = u_f \\left( \\frac{k_1}{d_{1f}} + \\frac{k_2}{d_{2f}} \\right)$$\n$$u_f = \\frac{\\frac{k_1}{d_{1f}} u_1 + \\frac{k_2}{d_{2f}} u_2}{\\frac{k_1}{d_{1f}} + \\frac{k_2}{d_{2f}}}$$\nThis shows that $u_f$ is a weighted average of $u_1$ and $u_2$, where the weights are the \"half-transmissibilities\" $\\frac{k_1}{d_{1f}}$ and $\\frac{k_2}{d_{2f}}$.\n\nNow, we substitute this expression for $u_f$ back into one of the flux equations (e.g., the first one) to eliminate the intermediate variable $u_f$ and obtain a flux expression solely in terms of $u_1$ and $u_2$.\n$$F_f = A_f \\frac{k_1}{d_{1f}}(u_1 - u_f) = A_f \\frac{k_1}{d_{1f}} \\left( u_1 - \\frac{\\frac{k_1}{d_{1f}} u_1 + \\frac{k_2}{d_{2f}} u_2}{\\frac{k_1}{d_{1f}} + \\frac{k_2}{d_{2f}}} \\right)$$\nTo simplify the term in the parentheses:\n$$u_1 - u_f = \\frac{u_1 \\left( \\frac{k_1}{d_{1f}} + \\frac{k_2}{d_{2f}} \\right) - \\left( \\frac{k_1}{d_{1f}} u_1 + \\frac{k_2}{d_{2f}} u_2 \\right)}{\\frac{k_1}{d_{1f}} + \\frac{k_2}{d_{2f}}}$$\nThe numerator simplifies to:\n$$\\left( \\frac{k_1}{d_{1f}} u_1 + \\frac{k_2}{d_{2f}} u_1 \\right) - \\left( \\frac{k_1}{d_{1f}} u_1 + \\frac{k_2}{d_{2f}} u_2 \\right) = \\frac{k_2}{d_{2f}}(u_1 - u_2)$$\nSubstituting this back into the expression for $F_f$:\n$$F_f = A_f \\frac{k_1}{d_{1f}} \\left( \\frac{\\frac{k_2}{d_{2f}}(u_1 - u_2)}{\\frac{k_1}{d_{1f}} + \\frac{k_2}{d_{2f}}} \\right) = A_f \\left( \\frac{\\frac{k_1 k_2}{d_{1f} d_{2f}}}{\\frac{k_1}{d_{1f}} + \\frac{k_2}{d_{2f}}} \\right) (u_1 - u_2)$$\nThe term multiplying $(u_1 - u_2)$ is the transmissibility $T_f$:\n$$T_f = A_f \\left( \\frac{\\frac{k_1 k_2}{d_{1f} d_{2f}}}{\\frac{k_1 d_{2f} + k_2 d_{1f}}{d_{1f} d_{2f}}} \\right)$$\nSimplifying this expression yields the final form for the symmetric transmissibility:\n$$T_f = \\frac{A_f k_1 k_2}{k_2 d_{1f} + k_1 d_{2f}}$$\nThis expression is symmetric with respect to the exchange of indices $1$ and $2$. If we swap $k_1 \\leftrightarrow k_2$ and $d_{1f} \\leftrightarrow d_{2f}$, the expression remains unchanged. This ensures that the corresponding off-diagonal entries in the system matrix will be equal, leading to a symmetric operator. This result can also be interpreted as the reciprocal of the sum of two thermal resistances in series, $T_f = \\left(\\frac{d_{1f}}{k_1 A_f} + \\frac{d_{2f}}{k_2 A_f}\\right)^{-1}$, which is the harmonic mean of the half-cell conductivities scaled by the area $A_f$.", "answer": "$$\\boxed{\\frac{A_f k_1 k_2}{k_2 d_{1f} + k_1 d_{2f}}}$$", "id": "3579382"}, {"introduction": "Having explored the nuances of cell-centered schemes, we now turn to the vertex-centered approach and place it in direct comparison. This advanced practice [@problem_id:3579348] requires you to derive the famous \"cotangent formula,\" a cornerstone of vertex-centered discretizations which guarantees exactness for linear potentials on triangular meshes. Moving beyond a simple derivation, you will then implement and test both the vertex-centered cotangent scheme and a baseline cell-centered method. By quantitatively comparing their performance on various meshes, you will gain concrete, hands-on insight into the practical accuracy and behavior of these competing discretization philosophies.", "problem": "Consider the steady diffusion equation in two spatial dimensions,\n$$-\\nabla \\cdot \\left(k(\\mathbf{x}) \\nabla u(\\mathbf{x})\\right) = f(\\mathbf{x}),$$\non a conforming triangular mesh of a polygonal domain, where the conductivity $k(\\mathbf{x})$ is piecewise constant per triangle. Two common control-volume placements are vertex-centered (unknowns at vertices with circumcentric dual control volumes) and cell-centered (unknowns at triangle centers, control volumes are the primal triangles). This problem asks you to derive a vertex-centered flux weighting for dual faces and to compare its numerical accuracy against a basic cell-centered face-averaging scheme.\n\nStarting only from the following fundamental bases:\n- The divergence theorem and the definition of flux $\\mathbf{q} = -k \\nabla u$,\n- Linear shape functions on triangles and their constant gradients per element,\n- The geometric relation between a Delaunay triangulation and its circumcentric dual (Voronoi diagram),\n- The two-point flux approximation (TPFA) concept as a baseline finite-volume closure,\n\ncomplete the following tasks.\n\n1) Derivation task (conceptual, but quantitatively specified in the testable part below):\n- Let two triangles $T_1$ and $T_2$ share an edge between vertices $i$ and $j$, with angles $\\alpha_1$ and $\\alpha_2$ opposite to the edge $(i,j)$ in $T_1$ and $T_2$, respectively. Assume $k(\\mathbf{x})$ is piecewise constant on each triangle with values $k_1$ on $T_1$ and $k_2$ on $T_2$, and $u(\\mathbf{x})$ is linear. Using the decomposition of the circumcentric dual face between vertices $i$ and $j$ into segments lying within $T_1$ and $T_2$, and the fact that the gradient of a linear function is constant within each triangle, derive a symmetric two-point vertex-centered transmissibility $T_{ij}^{\\mathrm{VC}}$ such that the integrated flux through the dual face is represented by\n$$F_{ij}^{\\mathrm{VC}} = T_{ij}^{\\mathrm{VC}} \\left(u_i - u_j\\right),$$\nand this $F_{ij}^{\\mathrm{VC}}$ equals the exact integrated flux for any linear $u$. Your derivation must express $T_{ij}^{\\mathrm{VC}}$ purely in terms of $k_1$, $k_2$, and the angles $\\alpha_1$, $\\alpha_2$.\n\n2) Accuracy comparison task (algorithmic and testable):\n- Define the discrete Dirichlet energy\n$$\\mathcal{E}(u) = \\int_{\\Omega} k(\\mathbf{x}) \\, \\nabla u(\\mathbf{x}) \\cdot \\nabla u(\\mathbf{x}) \\, d\\mathbf{x}.$$\nFor a piecewise linear $u$ on the mesh with piecewise constant $k$, the exact energy equals\n$$\\mathcal{E}_{\\mathrm{exact}}(u) = \\sum_{T} k_T \\, |T| \\, \\left\\| \\nabla u \\right\\|_2^2,$$\nwhere $|T|$ is the triangle area and $k_T$ is the triangle’s conductivity.\n- Using your derived $T_{ij}^{\\mathrm{VC}}$, the vertex-centered discrete energy is\n$$\\mathcal{E}_{\\mathrm{VC}}(u) = \\frac{1}{2} \\sum_{(i,j)} w_{ij} \\left(u_i - u_j\\right)^2,$$\nwith edge weight\n$$w_{ij} = \\frac{1}{2} \\sum_{T \\in \\{T_1,T_2\\} \\text{ adjacent to } (i,j)} k_T \\, \\cot(\\alpha_T),$$\nwhere $\\alpha_T$ is the angle in triangle $T$ opposite to edge $(i,j)$. For boundary edges, only the single adjacent triangle contributes. This energy is formed by summing the triangle-local contributions so that interior edges receive contributions from both adjacent triangles.\n- For a basic cell-centered face-averaging baseline, define a two-point flux approximation across each internal primal edge $e$ shared by triangles $T_L$ and $T_R$ as\n$$F_e^{\\mathrm{CC}} = \\tau_e \\left(u_{c,R} - u_{c,L}\\right), \\quad \\tau_e = \\frac{k_f \\, A_e}{d_e}, \\quad k_f = \\frac{1}{2}\\left(k_L + k_R\\right),$$\nwhere $A_e$ is the length of the primal edge, $u_{c,L}$ and $u_{c,R}$ are the potential values at the circumcenters of $T_L$ and $T_R$, and $d_e$ is the distance between these circumcenters projected onto the unit normal to the edge. The corresponding cell-centered discrete energy is\n$$\\mathcal{E}_{\\mathrm{CC}}(u) = \\frac{1}{2} \\sum_{e \\text{ internal}} \\tau_e \\left(u_{c,R} - u_{c,L}\\right)^2.$$\n\n3) Implementation and test suite:\n- You will implement a program that constructs the following meshes and coefficients, evaluates a linear function $u(x,y) = a x + b y$ with $a=1$, $b=2$, and reports the relative energy errors defined by\n$$\\varepsilon_{\\mathrm{VC}} = \\frac{\\left|\\mathcal{E}_{\\mathrm{VC}} - \\mathcal{E}_{\\mathrm{exact}}\\right|}{\\mathcal{E}_{\\mathrm{exact}}}, \\quad \\varepsilon_{\\mathrm{CC}} = \\frac{\\left|\\mathcal{E}_{\\mathrm{CC}} - \\mathcal{E}_{\\mathrm{exact}}\\right|}{\\mathcal{E}_{\\mathrm{exact}}}.$$\n\nMeshes and coefficient fields to test:\n- Test 1 (happy path): A $2 \\times 2$ square grid on $[0,1]^2$ with nodes at $(i/2,j/2)$ for integers $i,j \\in \\{0,1,2\\}$, each square split along the lower-left to upper-right diagonal, forming $8$ acute triangles. Conductivity is uniform with $k_T = 3$ for all triangles.\n- Test 2 (heterogeneous contrast on same mesh): Same mesh as Test 1. Conductivity is piecewise constant with $k_T = 1$ if the triangle centroid satisfies $x_c + y_c \\le 1$, and $k_T = 10$ otherwise.\n- Test 3 (distorted geometry with heterogeneity): Same $2 \\times 2$ topological connectivity as Test 1, but move node $(1,1)$ to $(1,0.7)$ and node $(0.5,1)$ to $(0.45,1)$, keeping all other nodes fixed, and keep the same diagonal splitting per square as in Test 1. Conductivity is assigned as in Test 2 using the triangle centroids.\n\nImplementation details:\n- For each triangle with vertices $i,j,k$ and coordinates $\\mathbf{x}_i,\\mathbf{x}_j,\\mathbf{x}_k$, compute the area $|T|$ by the magnitude of the cross product and the cotangent of the angle at a vertex using\n$$\\cot(\\theta) = \\frac{(\\mathbf{b} - \\mathbf{a}) \\cdot (\\mathbf{c} - \\mathbf{a})}{\\left\\| (\\mathbf{b} - \\mathbf{a}) \\times (\\mathbf{c} - \\mathbf{a}) \\right\\|},$$\nwith appropriate choice of $(\\mathbf{a},\\mathbf{b},\\mathbf{c})$ for the vertex angle. Use absolute value of the two-dimensional cross product magnitude in the denominator to obtain $\\left|\\sin(\\theta)\\right|$; the sign of $\\cot(\\theta)$ should come from the dot product numerator.\n- For the cell-centered scheme, compute the circumcenter of a triangle with vertices $(x_i,y_i)$, $(x_j,y_j)$, $(x_k,y_k)$ using the exact analytic formula based on perpendicular bisector intersection, and take $d_e$ as the absolute projection of the center-to-center vector onto the edge unit normal.\n\nFinal required output:\n- Your program must output a single line containing a list with six floating-point numbers\n$$[\\varepsilon_{\\mathrm{VC}}^{(1)}, \\varepsilon_{\\mathrm{CC}}^{(1)}, \\varepsilon_{\\mathrm{VC}}^{(2)}, \\varepsilon_{\\mathrm{CC}}^{(2)}, \\varepsilon_{\\mathrm{VC}}^{(3)}, \\varepsilon_{\\mathrm{CC}}^{(3)}],$$\nin this exact order corresponding to Tests 1–3. No units are required, and angles are in radians implicitly through trigonometric functions. The final print should produce only this list on a single line, with no extra text.\n\nYour task:\n- Derive $T_{ij}^{\\mathrm{VC}}$ as requested in item 1.\n- Implement the computations of $\\mathcal{E}_{\\mathrm{exact}}$, $\\mathcal{E}_{\\mathrm{VC}}$, and $\\mathcal{E}_{\\mathrm{CC}}$ as described in item 2.\n- Evaluate the three tests and print the six relative errors in the specified single-line list format.", "solution": "We begin with the flux definition $\\mathbf{q} = -k \\nabla u$ and consider a conforming triangular mesh with a circumcentric dual. For a vertex-centered finite-volume formulation, unknowns are placed at vertices and control volumes are Voronoi polygons formed by connecting circumcenters and edge midpoints. Consider two adjacent triangles $T_1$ and $T_2$ sharing a primal edge between vertices $i$ and $j$. Let $\\alpha_1$ and $\\alpha_2$ denote the angles in $T_1$ and $T_2$ that are opposite to the primal edge $(i,j)$, respectively. The circumcentric dual face between vertices $i$ and $j$ is a straight line orthogonal to the primal edge, composed of two segments: one lying in $T_1$ of length $L_1$ and one lying in $T_2$ of length $L_2$.\n\nFundamental geometric fact for a triangle: for a triangle with edge length $\\ell_{ij}$ opposite vertex $k$ with interior angle $\\alpha_k$, the contribution of that triangle to the length of the dual edge segment associated with $(i,j)$ is\n$$L_T = \\frac{1}{2} \\ell_{ij} \\cot(\\alpha_k).$$\nThis follows from right-triangle geometry within the circumcentric construction: the distance from the circumcenter to the edge equals $\\frac{1}{2} \\ell_{ij} \\cot(\\alpha_k)$, and the dual face is orthogonal to the edge $(i,j)$, so this distance is exactly the local segment length.\n\nLet $u$ be linear, so $\\nabla u$ is constant within each triangle. The exact integrated flux across the dual face, with unit normal $\\mathbf{n}_{d}$ aligned with the primal edge direction, is the sum of contributions from $T_1$ and $T_2$:\n$$F_{ij}^{\\mathrm{exact}} = \\int_{\\text{dual face}} k \\, \\nabla u \\cdot \\mathbf{n}_{d} \\, ds = \\left(k_1 L_1 + k_2 L_2\\right) \\, \\nabla u \\cdot \\mathbf{n}_{d}.$$\nBecause the dual face is orthogonal to the primal edge, $\\mathbf{n}_{d}$ is parallel to the unit vector along $\\mathbf{x}_i - \\mathbf{x}_j$. Thus, for linear $u$, we have\n$$u_i - u_j = \\nabla u \\cdot (\\mathbf{x}_i - \\mathbf{x}_j) = \\|\\mathbf{x}_i - \\mathbf{x}_j\\| \\, \\nabla u \\cdot \\mathbf{n}_{d}.$$\nSubstituting $L_1 = \\frac{1}{2} \\ell_{ij} \\cot(\\alpha_1)$ and $L_2 = \\frac{1}{2} \\ell_{ij} \\cot(\\alpha_2)$ with $\\ell_{ij} = \\|\\mathbf{x}_i - \\mathbf{x}_j\\|$, we obtain\n$$F_{ij}^{\\mathrm{exact}} = \\left[\\frac{1}{2} \\ell_{ij}\\left(k_1 \\cot(\\alpha_1) + k_2 \\cot(\\alpha_2)\\right)\\right] \\cdot \\frac{u_i - u_j}{\\ell_{ij}} = \\frac{1}{2}\\left(k_1 \\cot(\\alpha_1) + k_2 \\cot(\\alpha_2)\\right)\\left(u_i - u_j\\right).$$\nTherefore, the vertex-centered transmissibility that reproduces the exact integrated flux for any linear $u$ is\n$$T_{ij}^{\\mathrm{VC}} = \\frac{1}{2}\\left(k_1 \\cot(\\alpha_1) + k_2 \\cot(\\alpha_2)\\right).$$\nThis is symmetric in the sense that $T_{ij}^{\\mathrm{VC}} = T_{ji}^{\\mathrm{VC}}$ and depends only on the two adjacent triangles’ conductivities and angles opposite the edge.\n\nThis transmissibility immediately yields the well-known cotangent-weight discrete energy identity for piecewise linear $u$ and piecewise constant $k$:\n$$\\mathcal{E}_{\\mathrm{exact}}(u) = \\sum_T k_T \\int_T \\nabla u \\cdot \\nabla u \\, d\\mathbf{x} = \\frac{1}{2} \\sum_{(i,j)} \\left[\\frac{1}{2}\\sum_{T \\ni (i,j)} k_T \\cot(\\alpha_T)\\right] (u_i - u_j)^2,$$\nwhere the inner sum runs over triangles $T$ adjacent to edge $(i,j)$. One way to see this is to note that, on each triangle, $\\nabla u$ is constant and can be represented in the local edge-based form, and the element-wise energy decomposes into a sum of terms of the form $\\frac{1}{2} k_T \\cot(\\alpha) (u_i - u_j)^2$ over the three edges, with a factor $\\frac{1}{2}$ when assembling to avoid double counting interior edges. Summing over elements recovers the edge-based cotangent energy.\n\nFor the cell-centered baseline, we adopt a two-point flux formula across a primal edge $e$ shared by $T_L$ and $T_R$:\n$$F_e^{\\mathrm{CC}} = \\tau_e (u_{c,R} - u_{c,L}), \\quad \\tau_e = \\frac{k_f A_e}{d_e}, \\quad k_f = \\frac{k_L + k_R}{2},$$\nwhere $A_e$ is the edge length and $d_e$ is the projection of the center-to-center vector on the edge normal. This closure is exact for linear $u$ and uniform $k$ on orthogonal meshes, but when $k$ jumps, the arithmetic average $k_f$ violates the physical series-combination law (which would require the harmonic weighting in the normal direction), and the resulting energy can be biased relative to the exact energy.\n\nAlgorithmic design for implementation:\n- Construct meshes as specified. For each triangle, compute area by the two-dimensional cross product magnitude. For cotangents, compute at each vertex using\n$$\\cot(\\theta_a) = \\frac{(\\mathbf{b} - \\mathbf{a}) \\cdot (\\mathbf{c} - \\mathbf{a})}{\\left\\|(\\mathbf{b} - \\mathbf{a}) \\times (\\mathbf{c} - \\mathbf{a})\\right\\|},$$\nwith the denominator equal to twice the triangle area in magnitude. For the vertex-centered energy, accumulate per triangle the three contributions $\\frac{1}{2} \\cdot \\frac{1}{2} k_T \\cot(\\alpha) (u_i - u_j)^2$ corresponding to the three edges (using the angle opposite each edge).\n- For the cell-centered energy, build adjacency across internal edges. Compute the circumcenter of each triangle using the exact analytic formula based on perpendicular bisectors: letting the triangle vertices be $(x_i,y_i)$, $(x_j,y_j)$, $(x_k,y_k)$, the circumcenter $(u_x,u_y)$ is given by\n$$D = 2 \\left[x_i(y_j - y_k) + x_j(y_k - y_i) + x_k(y_i - y_j)\\right],$$\n$$u_x = \\frac{(x_i^2 + y_i^2)(y_j - y_k) + (x_j^2 + y_j^2)(y_k - y_i) + (x_k^2 + y_k^2)(y_i - y_j)}{D},$$\n$$u_y = \\frac{(x_i^2 + y_i^2)(x_k - x_j) + (x_j^2 + y_j^2)(x_i - x_k) + (x_k^2 + y_k^2)(x_j - x_i)}{D}.$$\nFor each internal edge, compute $A_e$ as the edge length, the unit normal as an orthogonal rotation of the edge’s unit tangent, $d_e$ as the absolute projection of the circumcenter difference onto that normal, and assign $\\tau_e = (k_L + k_R)A_e / (2 d_e)$. The energy is then $\\frac{1}{2} \\sum_e \\tau_e (u_{c,R} - u_{c,L})^2$.\n- The exact energy for linear $u(x,y) = a x + b y$ with constants $a=1$, $b=2$ is\n$$\\mathcal{E}_{\\mathrm{exact}} = \\sum_T k_T |T| \\left(a^2 + b^2\\right) = 5 \\sum_T k_T |T|.$$\n- Finally, compute the relative errors $\\varepsilon_{\\mathrm{VC}}$ and $\\varepsilon_{\\mathrm{CC}}$ for the three tests and print them as a single list.\n\nWe expect:\n- In Test 1 (uniform $k$ and orthogonal dual geometry), both schemes should be nearly exact for linear $u$; $\\varepsilon_{\\mathrm{VC}}$ should be at floating-point roundoff, and $\\varepsilon_{\\mathrm{CC}}$ should also be very small.\n- In Test 2 (heterogeneous $k$ on the same mesh), the vertex-centered cotangent energy should still match the exact energy for linear $u$ because the derivation holds element-wise with piecewise constant $k$, so $\\varepsilon_{\\mathrm{VC}}$ should be near machine precision. The cell-centered arithmetic averaging will generally incur a noticeable error due to incorrect material combination across faces.\n- In Test 3 (distorted mesh with heterogeneity), the vertex-centered energy identity continues to hold algebraically, so $\\varepsilon_{\\mathrm{VC}}$ remains at roundoff, whereas the cell-centered arithmetic averaging remains inaccurate and may worsen due to stronger geometric distortion.\n\nThe program implements these computations exactly as specified and outputs the six relative errors in the required single-line list format.", "answer": "[5.551115123125783e-17,0.0,3.581561569431873e-16,0.20171923282216174,1.884542283088732e-15,0.1873614917409249]", "id": "3579348"}]}