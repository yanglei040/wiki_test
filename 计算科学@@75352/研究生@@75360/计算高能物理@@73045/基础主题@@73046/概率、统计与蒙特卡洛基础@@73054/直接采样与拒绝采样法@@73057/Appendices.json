{"hands_on_practices": [{"introduction": "这个首要的实践练习是一个基础热身，旨在巩固拒绝采样方法的核心数学原理。我们将探索如何为一个给定的目标分布函数构建一个有效的“包络”函数。通过为一个类伽马函数的目标分布推导指数形式的提议分布，并对其进行优化，你将掌握如何通过微积分计算来确定理论上最高的接受率，这是设计高效蒙特卡洛算法的关键一步 ([@problem_id:3512598])。", "problem": "在计算高能物理中，诸如量能器簇射中次级强子的能量分布等谱，通常由一个在 $x \\geq 0$ 上的未归一化形状 $f(x)$ 来建模。考虑函数族\n$$\nf(x) = x^{\\alpha} \\exp(-\\beta x)\n$$\n其参数满足 $\\alpha > 0$ 和 $\\beta > 0$，使得 $f(x)$ 在 $[0,\\infty)$ 上的积分有限且众数位于区间内部。你的任务是构建一个拒绝采样方案，该方案基于一个允许通过逆变换方法直接采样的提议分布。具体来说，设提议分布为率是 $\\lambda$ 的指数分布，其概率密度函数为\n$$\nq_{\\lambda}(x) = \\lambda \\exp(-\\lambda x), \\quad x \\geq 0,\n$$\n可以通过逆累积分布函数 $x = -\\frac{1}{\\lambda} \\ln U$ 进行采样，其中 $U$ 在 $[0,1]$ 上均匀分布。在拒绝采样方法中，未归一化的目标 $\\pi(x) = f(x)$ 被 $M q_{\\lambda}(x)$ 所包络，其中 $M$ 是一个常数，满足对所有 $x \\geq 0$ 都有 $\\pi(x) \\leq M q_{\\lambda}(x)$。\n\n任务：\n1. 使用求最值的微积分方法和可微函数的基本性质，确定 $f(x)$ 在 $[0,\\infty)$ 上的全局最大值，并以闭合形式表示所得的紧上界 $M_{f}(\\alpha,\\beta)$。\n2. 对于使用提议分布 $q_{\\lambda}(x)$ 的拒绝采样方案，使用求最值的微积分方法，推导由要求 $\\sup_{x \\geq 0} \\frac{f(x)}{q_{\\lambda}(x)} \\leq M$ 所隐含的最小包络常数 $M(\\alpha,\\beta,\\lambda)$。然后，从未归一化目标和归一化提议分布的拒绝采样中平均接受概率的定义出发，以闭合形式计算接受率 $A(\\alpha,\\beta,\\lambda)$。最后，选择 $\\lambda$ 以最大化接受率，并以闭合形式给出最大化的接受率 $A_{\\mathrm{max}}(\\alpha,\\beta)$。\n\n精确表达你的最终结果。无需四舍五入。接受率是无量纲的；上界 $M_{f}(\\alpha,\\beta)$ 与 $f(x)$ 的单位相同。", "solution": "该问题已被验证，并被认为是一个在计算统计学领域中良定的、有科学依据的问题。它是自洽的、一致的，并且需要应用微积分和概率论的标准原理。我将给出完整的解答。\n\n该问题分为两个主要任务。第一个是求目标形状函数 $f(x)$ 的最大值。第二个是确定使用指数提议分布的拒绝采样方案的最优接受率。\n\n**任务1：确定 $f(x)$ 的最大值**\n\n未归一化目标形状由以下函数给出：\n$$f(x) = x^{\\alpha} \\exp(-\\beta x)$$\n对于 $x \\geq 0$，参数 $\\alpha > 0$ 和 $\\beta > 0$。\n\n为了找到 $f(x)$ 在区间 $[0, \\infty)$ 上的全局最大值，我们首先通过计算其关于 $x$ 的一阶导数并令其为零来找到临界点。使用微分的乘法法则：\n$$\n\\frac{d f}{dx} = \\frac{d}{dx} \\left( x^{\\alpha} \\exp(-\\beta x) \\right) = (\\alpha x^{\\alpha-1}) \\exp(-\\beta x) + x^{\\alpha} (-\\beta \\exp(-\\beta x))\n$$\n我们可以提出公因式：\n$$\n\\frac{d f}{dx} = x^{\\alpha-1} \\exp(-\\beta x) (\\alpha - \\beta x)\n$$\n为了找到 $x > 0$ 时的临界点，我们令导数为零：\n$$\nx^{\\alpha-1} \\exp(-\\beta x) (\\alpha - \\beta x) = 0\n$$\n由于 $\\alpha > 0$，对于任何 $x > 0$，项 $x^{\\alpha-1}$ 和 $\\exp(-\\beta x)$ 都严格为正。因此，导数仅在括号中的项为零时才为零：\n$$\n\\alpha - \\beta x = 0 \\implies x = \\frac{\\alpha}{\\beta}\n$$\n这是定义域 $(0, \\infty)$ 内部唯一的临界点。\n\n为了确定该点是否对应于一个最大值，我们可以考察函数在定义域边界处的行为。\n在 $x=0$ 处：$f(0) = 0^{\\alpha} \\exp(0) = 0$ (因为 $\\alpha > 0$)。\n当 $x \\to \\infty$ 时：指数项 $\\exp(-\\beta x)$ 衰减到零的速度比任何 $x$ 的幂次增长的速度都快。因此，$\\lim_{x\\to\\infty} f(x) = 0$。\n\n由于函数在定义域 $[0, \\infty)$ 的两端均为零，并且对于所有 $x > 0$ 均为正，因此在 $x = \\frac{\\alpha}{\\beta}$ 处的单临界点必定是全局最大值的位置。\n\n函数的最大值，记为 $M_f(\\alpha, \\beta)$，通过在该点计算 $f(x)$ 的值得到：\n$$\nM_f(\\alpha, \\beta) = f\\left(\\frac{\\alpha}{\\beta}\\right) = \\left(\\frac{\\alpha}{\\beta}\\right)^{\\alpha} \\exp\\left(-\\beta \\cdot \\frac{\\alpha}{\\beta}\\right) = \\left(\\frac{\\alpha}{\\beta}\\right)^{\\alpha} \\exp(-\\alpha)\n$$\n这就是 $f(x)$ 的紧上界。\n\n**任务2：优化拒绝采样方案**\n\n提议分布是率为 $\\lambda$ 的指数分布：\n$$\nq_{\\lambda}(x) = \\lambda \\exp(-\\lambda x)\n$$\n对于拒绝采样，我们需要找到一个常数 $M$ 使得对所有 $x \\geq 0$ 都有 $f(x) \\leq M q_{\\lambda}(x)$。能够得到最高效率的最小常数由下式给出：\n$$\nM(\\alpha, \\beta, \\lambda) = \\sup_{x \\geq 0} \\frac{f(x)}{q_{\\lambda}(x)}\n$$\n让我们分析比率函数 $h(x) = \\frac{f(x)}{q_{\\lambda}(x)}$：\n$$\nh(x) = \\frac{x^{\\alpha} \\exp(-\\beta x)}{\\lambda \\exp(-\\lambda x)} = \\frac{1}{\\lambda} x^{\\alpha} \\exp(-(\\beta - \\lambda)x)\n$$\n为使此函数在 $[0, \\infty)$ 上有界，指数项中的指数必须为负，这要求 $\\beta - \\lambda > 0$，即 $\\lambda < \\beta$。如果 $\\lambda \\geq \\beta$，$h(x)$ 将在 $x \\to \\infty$ 时无界，并且不存在有限的包络常数 $M$。\n\n假设 $\\lambda < \\beta$，我们通过微分找到 $h(x)$ 的最大值，这与任务1类似。其函数形式为 $C x^A \\exp(-B x)$，其中 $C = 1/\\lambda$，$A = \\alpha$，以及 $B = \\beta - \\lambda$。最大值出现在 $x = \\frac{A}{B} = \\frac{\\alpha}{\\beta - \\lambda}$。\n在该点计算 $h(x)$ 的值，得到最小包络常数：\n$$\nM(\\alpha, \\beta, \\lambda) = h\\left(\\frac{\\alpha}{\\beta - \\lambda}\\right) = \\frac{1}{\\lambda} \\left(\\frac{\\alpha}{\\beta - \\lambda}\\right)^{\\alpha} \\exp\\left(-(\\beta - \\lambda) \\frac{\\alpha}{\\beta - \\lambda}\\right) = \\frac{1}{\\lambda} \\left(\\frac{\\alpha}{\\beta - \\lambda}\\right)^{\\alpha} \\exp(-\\alpha)\n$$\n平均接受概率，或接受率 $A$，由未归一化目标的积分与包络函数 $M q_{\\lambda}(x)$ 的积分之比给出：\n$$\nA(\\alpha, \\beta, \\lambda) = \\frac{\\int_{0}^{\\infty} f(x) dx}{\\int_{0}^{\\infty} M(\\alpha, \\beta, \\lambda) q_{\\lambda}(x) dx}\n$$\n由于 $q_{\\lambda}(x)$ 是一个归一化的概率密度函数，$\\int_{0}^{\\infty} q_{\\lambda}(x) dx = 1$。分母简化为 $M(\\alpha, \\beta, \\lambda)$。\n分子是 $f(x)$ 的积分：\n$$\n\\int_{0}^{\\infty} f(x) dx = \\int_{0}^{\\infty} x^{\\alpha} \\exp(-\\beta x) dx\n$$\n这个积分与伽马函数 $\\Gamma(z) = \\int_0^\\infty t^{z-1} e^{-t} dt$ 有关。使用换元法，令 $t = \\beta x$，我们有 $x = t/\\beta$ 和 $dx = dt/\\beta$：\n$$\n\\int_{0}^{\\infty} \\left(\\frac{t}{\\beta}\\right)^{\\alpha} \\exp(-t) \\frac{dt}{\\beta} = \\frac{1}{\\beta^{\\alpha+1}} \\int_{0}^{\\infty} t^{\\alpha} \\exp(-t) dt = \\frac{\\Gamma(\\alpha+1)}{\\beta^{\\alpha+1}}\n$$\n因此，接受率为：\n$$\nA(\\alpha, \\beta, \\lambda) = \\frac{\\Gamma(\\alpha+1)/\\beta^{\\alpha+1}}{M(\\alpha, \\beta, \\lambda)} = \\frac{\\Gamma(\\alpha+1)}{\\beta^{\\alpha+1}} \\left[ \\frac{1}{\\lambda} \\left(\\frac{\\alpha}{\\beta - \\lambda}\\right)^{\\alpha} \\exp(-\\alpha) \\right]^{-1}\n$$\n$$\nA(\\alpha, \\beta, \\lambda) = \\frac{\\Gamma(\\alpha+1)}{\\beta^{\\alpha+1}} \\frac{\\lambda (\\beta - \\lambda)^{\\alpha}}{\\alpha^{\\alpha}} \\exp(\\alpha)\n$$\n为了最大化接受率，我们需要在区间 $(0, \\beta)$ 上选择 $\\lambda$ 来最大化依赖于 $\\lambda$ 的项，即 $g(\\lambda) = \\lambda (\\beta - \\lambda)^{\\alpha}$。我们通过将其导数设为零来求最大值：\n$$\n\\frac{dg}{d\\lambda} = \\frac{d}{d\\lambda} \\left[ \\lambda (\\beta - \\lambda)^{\\alpha} \\right] = 1 \\cdot (\\beta - \\lambda)^{\\alpha} + \\lambda \\cdot \\alpha(\\beta - \\lambda)^{\\alpha-1}(-1) = (\\beta - \\lambda)^{\\alpha-1} \\left( (\\beta - \\lambda) - \\alpha\\lambda \\right)\n$$\n由于 $\\lambda < \\beta$，令导数为零：\n$$\n\\beta - \\lambda - \\alpha\\lambda = 0 \\implies \\beta = \\lambda(1 + \\alpha) \\implies \\lambda_{\\mathrm{opt}} = \\frac{\\beta}{1+\\alpha}\n$$\n这个 $\\lambda$ 的值在 $(0, \\beta)$ 内，因此是一个有效的选择。\n现在，我们将 $\\lambda_{\\mathrm{opt}}$ 代回到接受率的表达式中，以找到可能的最大接受率 $A_{\\mathrm{max}}$。\n首先，计算 $g(\\lambda_{\\mathrm{opt}})$：\n$$\n\\lambda_{\\mathrm{opt}} = \\frac{\\beta}{1+\\alpha} \\quad \\text{and} \\quad \\beta - \\lambda_{\\mathrm{opt}} = \\beta - \\frac{\\beta}{1+\\alpha} = \\frac{\\alpha\\beta}{1+\\alpha}\n$$\n$$\ng(\\lambda_{\\mathrm{opt}}) = \\left(\\frac{\\beta}{1+\\alpha}\\right) \\left(\\frac{\\alpha\\beta}{1+\\alpha}\\right)^{\\alpha} = \\frac{\\beta \\cdot \\alpha^{\\alpha} \\beta^{\\alpha}}{(1+\\alpha) (1+\\alpha)^{\\alpha}} = \\frac{\\alpha^{\\alpha} \\beta^{\\alpha+1}}{(1+\\alpha)^{\\alpha+1}}\n$$\n将此代入 $A$ 的表达式中：\n$$\nA_{\\mathrm{max}}(\\alpha, \\beta) = \\frac{\\Gamma(\\alpha+1) \\exp(\\alpha)}{\\alpha^{\\alpha} \\beta^{\\alpha+1}} \\cdot g(\\lambda_{\\mathrm{opt}}) = \\frac{\\Gamma(\\alpha+1) \\exp(\\alpha)}{\\alpha^{\\alpha} \\beta^{\\alpha+1}} \\cdot \\frac{\\alpha^{\\alpha} \\beta^{\\alpha+1}}{(1+\\alpha)^{\\alpha+1}}\n$$\n项 $\\alpha^{\\alpha}$ 和 $\\beta^{\\alpha+1}$ 消去，得到最大化接受率的最终结果：\n$$\nA_{\\mathrm{max}}(\\alpha, \\beta) = \\frac{\\Gamma(\\alpha+1) \\exp(\\alpha)}{(1+\\alpha)^{\\alpha+1}}\n$$\n这个结果显著地独立于参数 $\\beta$。\n\n这两个任务的最终结果是：\n1.  $f(x)$ 的紧上界是 $M_f(\\alpha, \\beta) = (\\frac{\\alpha}{\\beta})^{\\alpha} \\exp(-\\alpha)$。\n2.  最大化的接受率是 $A_{\\mathrm{max}}(\\alpha, \\beta) = \\frac{\\Gamma(\\alpha+1) \\exp(\\alpha)}{(1+\\alpha)^{\\alpha+1}}$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\left(\\frac{\\alpha}{\\beta}\\right)^{\\alpha} \\exp(-\\alpha) & \\frac{\\Gamma(\\alpha+1) \\exp(\\alpha)}{(1+\\alpha)^{\\alpha+1}}\n\\end{pmatrix}\n}\n$$", "id": "3512598"}, {"introduction": "在掌握了基础优化技巧后，我们将把这些原理应用于一个更贴近高能物理研究的实际场景。布赖特-维格纳（Breit-Wigner）分布是描述粒子物理学中不稳定粒子（即共振态）质量分布的标准模型。本练习将指导你如何为一个在有限能量或质量区间（即截断分布）内的布赖特-维格纳分布构建一个拒绝采样器，这在处理真实的实验数据和模拟中是一个非常普遍且重要的问题 ([@problem_id:3512597])。", "problem": "在高能物理 (HEP) 的蒙特卡罗 (MC) 模拟中，对于一个极点质量为 $m$、宽度为 $\\Gamma$ 的窄共振，其目标采样密度取为限制在区间 $\\left[m - \\Delta, m + \\Delta\\right]$ 上的截断布莱特-维格纳分布（也称为柯西/洛伦兹线型）。在此区间上的截断概率密度函数 (PDF) 定义为\n$$\nf(x) \\equiv \\frac{C}{(x - m)^{2} + \\frac{\\Gamma^{2}}{4}}, \\quad x \\in [m - \\Delta, m + \\Delta],\n$$\n在其他情况下 $f(x) = 0$，其中归一化常数 $C$ 的选取需满足 $\\int_{m - \\Delta}^{m + \\Delta} f(x)\\,\\mathrm{d}x = 1$。\n\n你的任务是设计一个拒绝采样器，它通过使用一个支撑集恰好是该截断区间的提议包络来遵循该截断。考虑在 $\\left[m - \\Delta, m + \\Delta\\right]$ 上的均匀提议密度，\n$$\ng(x) \\equiv \\frac{1}{2\\Delta}, \\quad x \\in [m - \\Delta, m + \\Delta],\n$$\n在其他情况下 $g(x) = 0$。请确定最小包络常数 $M$，使得对所有 $x \\in [m - \\Delta, m + \\Delta]$ 都有 $f(x) \\leq M\\,g(x)$，并从第一性原理出发，计算基于此包络的拒绝算法的全局平均接受概率 $\\alpha$。\n\n然后，分析由接受-拒绝步骤引出的作为 $x$ 的函数的接受概率（记为 $a(x)$），并评估其在截断边界 $x = m \\pm \\Delta$ 处的极限值，以描述边缘效应。\n\n你的推导必须从拒绝采样的核心定义和概率密度的归一化出发。将最终答案表示为仅含 $\\Gamma$ 和 $\\Delta$ 的全局平均接受概率 $\\alpha$ 的单个闭式解析表达式。无需进行数值取整。", "solution": "我们从核心定义开始。目标截断布莱特-维格纳概率密度函数是\n$$\nf(x) = \\frac{C}{(x - m)^{2} + \\frac{\\Gamma^{2}}{4}}, \\quad x \\in [m - \\Delta, m + \\Delta],\n$$\n其中 $C$ 由截断区间上的归一化条件确定。提议概率密度函数在同一区间上是均匀的，\n$$\ng(x) = \\frac{1}{2\\Delta}, \\quad x \\in [m - \\Delta, m + \\Delta].\n$$\n在接受-拒绝采样中，需要一个包络常数 $M \\geq 1$，使得对于支撑集中的所有 $x$ 都有 $f(x) \\leq M\\,g(x)$。由于 $g(x)$ 在该区间上是常数，最小的可行 $M$ 满足\n$$\nM = \\frac{\\max_{x \\in [m - \\Delta, m + \\Delta]} f(x)}{g(x)} = \\frac{\\max_{x \\in [m - \\Delta, m + \\Delta]} f(x)}{\\frac{1}{2\\Delta}} = 2\\Delta \\,\\max_{x \\in [m - \\Delta, m + \\Delta]} f(x).\n$$\n函数 $f(x)$ 在极点 $x = m$ 处达到其最大值，所以\n$$\n\\max f(x) = f(m) = \\frac{C}{\\frac{\\Gamma^{2}}{4}} = \\frac{4C}{\\Gamma^{2}}.\n$$\n因此，\n$$\nM = 2\\Delta \\cdot \\frac{4C}{\\Gamma^{2}} = \\frac{8\\Delta\\,C}{\\Gamma^{2}}.\n$$\n\n为了计算 $C$，我们在截断区间上施加归一化条件：\n$$\n\\int_{m - \\Delta}^{m + \\Delta} f(x)\\,\\mathrm{d}x = \\int_{m - \\Delta}^{m + \\Delta} \\frac{C}{(x - m)^{2} + \\frac{\\Gamma^{2}}{4}}\\,\\mathrm{d}x = 1.\n$$\n令 $y = x - m$。则积分变为\n$$\nC \\int_{-\\Delta}^{\\Delta} \\frac{\\mathrm{d}y}{y^{2} + \\left(\\frac{\\Gamma}{2}\\right)^{2}} = 1.\n$$\n使用标准公式 $\\int \\frac{\\mathrm{d}y}{y^{2} + a^{2}} = \\frac{1}{a}\\arctan\\!\\left(\\frac{y}{a}\\right)$，并令 $a = \\frac{\\Gamma}{2}$，我们得到\n$$\n\\int_{-\\Delta}^{\\Delta} \\frac{\\mathrm{d}y}{y^{2} + \\left(\\frac{\\Gamma}{2}\\right)^{2}} = \\left.\\frac{2}{\\Gamma}\\arctan\\!\\left(\\frac{2y}{\\Gamma}\\right)\\right|_{-\\Delta}^{\\Delta} = \\frac{2}{\\Gamma}\\left(\\arctan\\!\\left(\\frac{2\\Delta}{\\Gamma}\\right) - \\arctan\\!\\left(-\\frac{2\\Delta}{\\Gamma}\\right)\\right) = \\frac{4}{\\Gamma}\\arctan\\!\\left(\\frac{2\\Delta}{\\Gamma}\\right).\n$$\n因此，\n$$\nC \\cdot \\frac{4}{\\Gamma}\\arctan\\!\\left(\\frac{2\\Delta}{\\Gamma}\\right) = 1 \\quad \\Rightarrow \\quad C = \\frac{\\Gamma}{4\\,\\arctan\\!\\left(\\frac{2\\Delta}{\\Gamma}\\right)}.\n$$\n\n将 $C$ 代入 $M$ 得\n$$\nM = \\frac{8\\Delta}{\\Gamma^{2}} \\cdot \\frac{\\Gamma}{4\\,\\arctan\\!\\left(\\frac{2\\Delta}{\\Gamma}\\right)} = \\frac{2\\Delta}{\\Gamma} \\cdot \\frac{1}{\\arctan\\!\\left(\\frac{2\\Delta}{\\Gamma}\\right)}.\n$$\n\n对于使用归一化的 $f$ 和 $g$ 的接受-拒绝采样，全局平均接受概率 $\\alpha$ 由目标归一化值与包络体积之比给出，这可以简化为\n$$\n\\alpha = \\int_{m - \\Delta}^{m + \\Delta} \\frac{f(x)}{M\\,g(x)}\\,g(x)\\,\\mathrm{d}x = \\frac{1}{M}\\int_{m - \\Delta}^{m + \\Delta} f(x)\\,\\mathrm{d}x = \\frac{1}{M},\n$$\n因为 $f$ 在截断区间上是归一化的。因此，\n$$\n\\alpha = \\frac{1}{M} = \\frac{\\Gamma}{2\\Delta}\\,\\arctan\\!\\left(\\frac{2\\Delta}{\\Gamma}\\right).\n$$\n\n接下来，我们分析在接受-拒绝步骤中使用的逐点接受概率 $a(x)$。从 $g$ 中抽取的样本 $x$ 被接受的概率为\n$$\na(x) = \\frac{f(x)}{M\\,g(x)}.\n$$\n由于 $g(x) = \\frac{1}{2\\Delta}$ 且 $M = 2\\Delta\\,\\max f(x) = 2\\Delta\\,f(m)$，我们有\n$$\na(x) = \\frac{f(x)}{(2\\Delta\\,f(m))\\,\\frac{1}{2\\Delta}} = \\frac{f(x)}{f(m)}.\n$$\n因此，逐点接受概率是布莱特-维格纳分布在 $x$ 处的值与其在 $x = m$ 处的峰值之比，即\n$$\na(x) = \\frac{\\frac{C}{(x - m)^{2} + \\frac{\\Gamma^{2}}{4}}}{\\frac{C}{\\frac{\\Gamma^{2}}{4}}} = \\frac{\\frac{\\Gamma^{2}}{4}}{(x - m)^{2} + \\frac{\\Gamma^{2}}{4}} = \\frac{\\Gamma^{2}}{4(x - m)^{2} + \\Gamma^{2}}.\n$$\n在截断边界 $x = m \\pm \\Delta$ 处，这变为\n$$\na(m \\pm \\Delta) = \\frac{\\Gamma^{2}}{4\\Delta^{2} + \\Gamma^{2}}.\n$$\n这量化了边缘效应：与极点 $x=m$ 附近的提议样本（其中 $a(m)=1$）相比，边界附近的提议样本以较低的概率被接受。当 $\\Gamma$ 固定时，随着 $\\Delta$ 的增加，边界接受率 $a(m \\pm \\Delta)$ 减小，反映出对于更宽的提议区间，在边缘附近的效率损失更急剧。相反，对于远小于 $\\Gamma$ 的 $\\Delta$，$a(m \\pm \\Delta) \\approx 1$，包络紧密地跟随目标分布，从而在整个区间上产生均匀的高接受率。\n\n总而言之，对于截断区间上的均匀包络，其最小包络常数和全局平均接受概率由归一化和极点处的最大值确定，而边缘效应则由逐点接受率捕获。所要求的全局平均接受概率的最终闭式表达式是\n$$\n\\alpha = \\frac{\\Gamma}{2\\Delta}\\,\\arctan\\!\\left(\\frac{2\\Delta}{\\Gamma}\\right).\n$$", "answer": "$$\\boxed{\\frac{\\Gamma}{2\\Delta}\\,\\arctan\\!\\left(\\frac{2\\Delta}{\\Gamma}\\right)}$$", "id": "3512597"}, {"introduction": "最后，我们将探讨一种在专业高能物理蒙特卡洛事件生成器中广泛应用的先进技术。当目标函数具有多个峰（例如，由多个重叠的共振态产生）时，使用单一的简单提议分布会变得极其低效。这个实践练习将介绍多通道采样方法，它通过使用多个提议分布的加权和来构造一个更紧密、更高效的复合包络。你将学习如何将权重优化问题转化为一个数值优化问题来求解，从而深刻理解现代蒙特卡洛技术如何应对复杂的多维度积分和抽样挑战 ([@problem_id:3512593])。", "problem": "考虑一个高能散射的玩具参数化，其中两个初态粒子产生四个末态粒子 ($2\\to 4$)。在此类过程中，矩阵元的平方通常表现出多个共振分母，这些分母可以通过类 Breit–Wigner 峰的叠加来建模。设方形定义域 $\\mathbf{x}=(u,v)\\in[0,1]^2$ 上的目标非负形状为 $f(\\mathbf{x})$，其定义为各道贡献之和 $f(\\mathbf{x})=\\sum_{i=1}^{M} f_i(\\mathbf{x}) + f_{\\mathrm{bg}}$，其中每个 $f_i$ 是代表一个共振的局域峰，而 $f_{\\mathrm{bg}}$ 是一个恒定本底。使用接受-拒绝 (Accept–Reject, AR) 蒙特卡洛 (Monte Carlo, MC) 方法进行事件生成需要一个包络 $g(\\mathbf{x})$，使得对于所有 $\\mathbf{x}$ 都有 $C\\,g(\\mathbf{x})\\ge f(\\mathbf{x})$，其中 $C>0$ 是一个有限界。一种标准的多道构建使用\n$$\ng(\\mathbf{x})=\\sum_{i=1}^{M} w_i\\,g_i(\\mathbf{x}),\n$$\n其中 $w_i\\ge 0$ 是权重，满足 $\\sum_{i=1}^{M} w_i=1$，而 $g_i(\\mathbf{x})$ 是在 $[0,1]^2$ 上归一化的建议概率密度函数。通过最小化最坏情况比率，即通过选择权重 $w_i$ 来最小化以下表达式，可以提高多道 AR 的接受率：\n$$\n\\max_{\\mathbf{x}\\in[0,1]^2}\\,\\frac{f(\\mathbf{x})}{\\sum_{i=1}^{M} w_i\\,g_i(\\mathbf{x})}.\n$$\n\n你需要实现一个完整、独立的程序，从第一性原理出发执行以下步骤：\n\n1. 对于每个共振道 $i$，将建议密度 $g_i(\\mathbf{x})$ 定义为 $[0,1]$ 上的两个截断柯西（类 Breit–Wigner）因子的乘积，\n$g_i(\\mathbf{x})=g_{i,u}(u)\\,g_{i,v}(v)$,\n其中对于坐标 $x\\in[0,1]$，\n$g_{i,\\bullet}(x)=\\frac{1}{Z_{i,\\bullet}}\\,\\frac{1}{\\pi}\\,\\frac{\\gamma_{i,\\bullet}}{(x-c_{i,\\bullet})^2+\\gamma_{i,\\bullet}^2}$,\n其位置为 $c_{i,\\bullet}\\in(0,1)$，宽度为 $\\gamma_{i,\\bullet}>0$，截断归一化子为\n$Z_{i,\\bullet}=F_{i,\\bullet}(1)-F_{i,\\bullet}(0)$, $F_{i,\\bullet}(x)=\\frac{1}{\\pi}\\arctan\\!\\left(\\frac{x-c_{i,\\bullet}}{\\gamma_{i,\\bullet}}\\right)+\\frac{1}{2}$.\n包含一个额外的均匀本底道，其建议密度为 $g_{\\mathrm{bg}}(\\mathbf{x})=1$ 在 $[0,1]^2$ 上。目标函数为\n$f(\\mathbf{x})=\\sum_{i=1}^{M} A_i\\,g_i(\\mathbf{x}) + A_{\\mathrm{bg}}$,\n其中振幅 $A_i\\ge 0$ 和 $A_{\\mathrm{bg}}\\ge 0$。这个玩具构建通过将主要的不变质量结构映射到 $(u,v)$ 来近似一个 $2\\to 4$ 过程中的重叠共振。\n\n2. 优化道权重 $w_i$（包括本底）以最小化上确界\n$$\nC^\\star=\\inf_{\\{w_i\\}}\\;\\max_{\\mathbf{x}\\in[0,1]^2}\\;\\frac{f(\\mathbf{x})}{\\sum_{i} w_i\\,g_i(\\mathbf{x})},\n$$\n约束条件为 $w_i\\ge 0$ 和 $\\sum_i w_i=1$。你必须在一个 $[0,1]^2$ 内的离散网格上，通过原理性地规约为一个凸问题来数值求解此问题；不要依赖于绕过从 AR 包络和混合的基本定义进行推导的特设启发式方法。\n\n3. 使用优化后的权重，实现多道 AR 抽样以生成 $N$ 个独立样本，并估计经验接受效率\n$$\n\\varepsilon=\\frac{\\text{接受的样本数}}{N}.\n$$\n对于每次建议抽样，以概率 $w_i$ 选择道 $i$，然后使用截断柯西因子的精确逆变换抽样从 $g_i(\\mathbf{x})$ 中抽取 $(u,v)$，并以概率 $p_{\\mathrm{acc}}(\\mathbf{x})=f(\\mathbf{x})/[C^\\star\\,g(\\mathbf{x})]$ 接受，其中 $g(\\mathbf{x})=\\sum_i w_i\\,g_i(\\mathbf{x})$。\n\n4. 测试套件。对以下四个参数集评估上述过程（每个参数集代表一个不同的 $2\\to 4$ 重叠共振场景；在所有情况下都包括均匀本底道作为一个额外的建议）：\n\n- 情况 1（峰分离良好，小本底）：$M=3$，振幅 $(A_1,A_2,A_3)=(1.0,0.9,0.6)$，本底振幅 $A_{\\mathrm{bg}}=0.02$，中心和宽度\n  $$\n  (c_{1,u},\\gamma_{1,u})=(0.25,0.02),\\quad (c_{1,v},\\gamma_{1,v})=(0.70,0.02),\n  $$\n  $$\n  (c_{2,u},\\gamma_{2,u})=(0.75,0.03),\\quad (c_{2,v},\\gamma_{2,v})=(0.30,0.025),\n  $$\n  $$\n  (c_{3,u},\\gamma_{3,u})=(0.45,0.04),\\quad (c_{3,v},\\gamma_{3,v})=(0.50,0.04).\n  $$\n\n- 情况 2（峰严重重叠，极小本底）：$M=3$，振幅 $(A_1,A_2,A_3)=(1.0,0.8,0.7)$，本底振幅 $A_{\\mathrm{bg}}=0.01$，\n  $$\n  (c_{1,u},\\gamma_{1,u})=(0.40,0.03),\\quad (c_{1,v},\\gamma_{1,v})=(0.60,0.03),\n  $$\n  $$\n  (c_{2,u},\\gamma_{2,u})=(0.45,0.025),\\quad (c_{2,v},\\gamma_{2,v})=(0.55,0.025),\n  $$\n  $$\n  (c_{3,u},\\gamma_{3,u})=(0.50,0.035),\\quad (c_{3,v},\\gamma_{3,v})=(0.50,0.035).\n  $$\n\n- 情况 3（窄峰，无本底）：$M=3$，振幅 $(A_1,A_2,A_3)=(1.0,1.0,0.9)$，本底振幅 $A_{\\mathrm{bg}}=0.0$，\n  $$\n  (c_{1,u},\\gamma_{1,u})=(0.30,0.008),\\quad (c_{1,v},\\gamma_{1,v})=(0.70,0.008),\n  $$\n  $$\n  (c_{2,u},\\gamma_{2,u})=(0.70,0.008),\\quad (c_{2,v},\\gamma_{2,v})=(0.30,0.008),\n  $$\n  $$\n  (c_{3,u},\\gamma_{3,u})=(0.50,0.006),\\quad (c_{3,v},\\gamma_{3,v})=(0.50,0.006).\n  $$\n\n- 情况 4（中度重叠，强本底）：$M=3$，振幅 $(A_1,A_2,A_3)=(0.8,0.8,0.4)$，本底振幅 $A_{\\mathrm{bg}}=0.20$，\n  $$\n  (c_{1,u},\\gamma_{1,u})=(0.35,0.025),\\quad (c_{1,v},\\gamma_{1,v})=(0.65,0.025),\n  $$\n  $$\n  (c_{2,u},\\gamma_{2,u})=(0.65,0.025),\\quad (c_{2,v},\\gamma_{2,v})=(0.35,0.025),\n  $$\n  $$\n  (c_{3,u},\\gamma_{3,u})=(0.50,0.040),\\quad (c_{3,v},\\gamma_{3,v})=(0.50,0.040).\n  $$\n\n使用大小为 $G_u\\times G_v$ 的均匀优化网格，其中 $G_u=50$ 和 $G_v=50$，以及每种情况 $N=20000$ 个 MC 样本用于 AR 效率估计。此问题中不出现角度。所有量都是无量纲的。\n\n你的程序应产生单行输出，其中包含四个情况的结果，形式为方括号括起来的逗号分隔列表。列表中的每一项本身必须是一个形式为 $[C^\\star,\\varepsilon,w_1,w_2,w_3,w_4]$ 的列表，包含优化后的上确界 $C^\\star$、以小数表示的经验接受效率 $\\varepsilon$，以及三个共振道加上均匀本底道的优化权重，按此顺序排列。例如，输出必须看起来像\n$$\n[[C^\\star_1,\\varepsilon_1,w_{1,1},w_{1,2},w_{1,3},w_{1,4}],[C^\\star_2,\\varepsilon_2,w_{2,1},w_{2,2},w_{2,3},w_{2,4}],[C^\\star_3,\\varepsilon_3,w_{3,1},w_{3,2},w_{3,3},w_{3,4}],[C^\\star_4,\\varepsilon_4,w_{4,1},w_{4,2},w_{4,3},w_{4,4}]].\n$$", "solution": "该问题要求为一个 $2 \\to 4$ 粒子散射过程的玩具模型实现一个优化的多道接受-拒绝 (AR) 抽样算法。此任务涉及三个主要阶段：定义目标和建议分布，优化抽样策略，以及执行蒙特卡洛模拟以估计效率。该解决方案是从第一性原理出发开发的。\n\n首先，我们定义模型的数学组件。抽样空间是单位正方形 $\\mathbf{x}=(u,v) \\in [0,1]^2$。目标分布 $f(\\mathbf{x})$ 是一个代表矩阵元平方的非负函数。它被构造为来自 $M$ 个共振道和一个均匀本底道的贡献之和。让索引 $i \\in \\{1, \\dots, M\\}$ 表示共振道，索引 $i=M+1$ 表示本底道。\n\n对于每个共振道 $i \\in \\{1, \\dots, M\\}$，其建议概率密度函数 (PDF) 以两个独立的截断柯西分布的乘积形式给出：\n$$\ng_i(\\mathbf{x}) = g_{i,u}(u) \\, g_{i,v}(v)\n$$\n其中对于坐标 $x \\in [0,1]$（代表 $u$ 或 $v$），截断柯西 PDF 为\n$$\ng_{i,\\bullet}(x) = \\frac{1}{Z_{i,\\bullet}} \\, \\frac{1}{\\pi} \\, \\frac{\\gamma_{i,\\bullet}}{(x-c_{i,\\bullet})^2 + \\gamma_{i,\\bullet}^2}.\n$$\n在这里，$c_{i,\\bullet} \\in (0,1)$ 是位置参数（峰中心），$\\gamma_{i,\\bullet} > 0$ 是尺度参数（与峰宽相关）。归一化常数 $Z_{i,\\bullet}$ 确保 $\\int_0^1 g_{i,\\bullet}(x) dx = 1$。它是根据标准柯西分布的累积分布函数 (CDF) $F(x; c, \\gamma) = \\frac{1}{\\pi}\\arctan(\\frac{x-c}{\\gamma}) + \\frac{1}{2}$ 计算得出的。因此，对于截断域 $[0,1]$ 的归一化为：\n$$\nZ_{i,\\bullet} = \\int_0^1 \\frac{1}{\\pi} \\, \\frac{\\gamma_{i,\\bullet}}{(x-c_{i,\\bullet})^2 + \\gamma_{i,\\bullet}^2} dx = F(1; c_{i,\\bullet}, \\gamma_{i,\\bullet}) - F(0; c_{i,\\bullet}, \\gamma_{i,\\bullet}).\n$$\n对于本底道，其建议 PDF 表示为 $g_{M+1}(\\mathbf{x})$，是单位正方形上的均匀分布：\n$g_{M+1}(\\mathbf{x}) = g_{\\mathrm{bg}}(\\mathbf{x}) = 1$, $\\text{for } \\mathbf{x} \\in [0,1]^2$.\n目标分布 $f(\\mathbf{x})$ 被构造为这些建议 PDF 的线性组合：\n$$\nf(\\mathbf{x}) = \\sum_{i=1}^{M} A_i g_i(\\mathbf{x}) + A_{\\mathrm{bg}} g_{M+1}(\\mathbf{x}) = \\sum_{i=1}^{M+1} A_i g_i(\\mathbf{x}),\n$$\n其中 $A_i \\ge 0$ 是给定的振幅，且 $A_{M+1} \\equiv A_{\\mathrm{bg}}$。\n\n多道 AR 方法的核心是使用建议 PDF 的混合作为总体建议分布：\n$$\ng(\\mathbf{x}) = \\sum_{i=1}^{M+1} w_i g_i(\\mathbf{x}),\n$$\n其中 $w_i \\ge 0$ 是满足归一化条件 $\\sum_{i=1}^{M+1} w_i = 1$ 的权重。目标是找到一个包络函数 $h(\\mathbf{x}) = C g(\\mathbf{x})$，使得对于所有 $\\mathbf{x} \\in [0,1]^2$ 都有 $h(\\mathbf{x}) \\ge f(\\mathbfx)$，且常数 $C$ 尽可能小。这可以最小化拒绝率。对于给定的一组权重 $\\{w_i\\}$，最优常数是 $C = \\max_{\\mathbf{x}} \\frac{f(\\mathbf{x})}{g(\\mathbf{x})}$。问题在于找到最小化此最大值的权重 $\\{w_i\\}$，即找到最优上确界 $C^\\star$：\n$$\nC^\\star = \\inf_{\\{w_i\\}} \\max_{\\mathbf{x} \\in [0,1]^2} \\frac{f(\\mathbf{x})}{\\sum_{i=1}^{M+1} w_i g_i(\\mathbf{x})}.\n$$\n这是一个极大极小问题。它可以被转换成一个更易处理的凸优化问题。设 $C$ 为最大值。该问题等价于：\n$$\n\\text{最小化 } C \\quad \\text{约束条件为} \\quad C \\sum_{i=1}^{M+1} w_i g_i(\\mathbf{x}) \\ge f(\\mathbf{x}) \\text{ for all } \\mathbf{x} \\in [0,1]^2, \\text{ and } \\sum_{i=1}^{M+1} w_i = 1, w_i \\ge 0.\n$$\n我们引入变量替换：$v_i = C w_i$。非负约束 $w_i \\ge 0$ 意味着 $v_i \\ge 0$。和约束变为 $\\sum_{i=1}^{M+1} v_i = \\sum_{i=1}^{M+1} C w_i = C \\sum_{i=1}^{M+1} w_i = C \\cdot 1 = C$。因此，最小化 $C$ 等价于最小化 $\\sum v_i$。不等式变为 $\\sum_{i=1}^{M+1} v_i g_i(\\mathbf{x}) \\ge f(\\mathbf{x})$。优化问题现在是一个线性规划 (Linear Program, LP) 问题：\n$$\n\\text{最小化 } \\sum_{i=1}^{M+1} v_i \\quad \\text{约束条件为} \\quad \\sum_{i=1}^{M+1} v_i g_i(\\mathbf{x}) \\ge f(\\mathbf{x}) \\text{ for all } \\mathbf{x} \\in [0,1]^2, \\text{ and } v_i \\ge 0.\n$$\n为了数值求解此问题，我们将连续域 $[0,1]^2$ 离散化为一个包含 $N_{\\text{grid}} = G_u \\times G_v$ 个点的有限网格 $\\{\\mathbf{x}_k\\}_{k=1}^{N_{\\text{grid}}}$。无限的约束集被一个有限集所取代：\n$$\n\\sum_{i=1}^{M+1} v_i g_i(\\mathbf{x}_k) \\ge f(\\mathbf{x}_k), \\quad \\text{for } k=1, \\dots, N_{\\text{grid}}.\n$$\n这是一个标准的 LP 问题，可以使用数值库求解。设最优解为 $\\{v_i^\\star\\}$。最优上确界为 $C^\\star = \\sum_i v_i^\\star$，最优权重为 $w_i^\\star = v_i^\\star / C^\\star$。\n\n一旦找到最优权重 $w_i^\\star$ 和上确界 $C^\\star$，我们就可以实现多道 AR 抽样器。生成一个样本的算法如下：\n1.  以概率 $w_j^\\star$ 选择一个道 $j \\in \\{1, \\dots, M+1\\}$。\n2.  从对应的建议 PDF $g_j(\\mathbf{x})$ 中生成一个随机变量 $\\mathbf{x} = (u,v)$。\n3.  计算接受概率 $p_{\\mathrm{acc}}(\\mathbf{x}) = \\frac{f(\\mathbf{x})}{C^\\star g(\\mathbf{x})}$，其中 $g(\\mathbf{x}) = \\sum_i w_i^\\star g_i(\\mathbf{x})$。\n4.  生成一个均匀随机数 $r \\sim U(0,1)$。如果 $r < p_{\\mathrm{acc}}(\\mathbf{x})$，接受样本 $\\mathbf{x}$。否则，拒绝它并重复该过程。\n\n为了从截断柯西分布 $g_{i,\\bullet}(x)$ 中生成样本，我们使用逆变换抽样法。截断分布的 CDF 为 $P(x) = (F(x) - F(0))/(F(1) - F(0)) = (F(x) - F_0)/Z$。将其设为一个均匀随机数 $y \\sim U(0,1)$ 并求解 $x$ 可得：\n$F(x) = y Z + F_0$。代入 $F(x)$ 的表达式：\n$$\n\\frac{1}{\\pi}\\arctan\\left(\\frac{x-c}{\\gamma}\\right) + \\frac{1}{2} = y Z + F_0.\n$$\n求解 $x$ 得到抽样公式：\n$$\nx = c + \\gamma \\tan\\left( \\pi \\left( y Z + F_0 - \\frac{1}{2} \\right) \\right).\n$$\n由于 $g_i(u,v)=g_{i,u}(u)g_{i,v}(v)$，我们可以使用此公式及其各自的参数独立地对 $u$ 和 $v$ 进行抽样。对于本底道，我们从 $[0,1]^2$ 中均匀抽样 $(u,v)$。\n\n最后，我们通过生成 $N$ 个建议并计数接受的样本数 $N_{\\text{acc}}$ 来估计经验接受效率 $\\varepsilon$：\n$$\n\\varepsilon = \\frac{N_{\\text{acc}}}{N}.\n$$\n这个经验值应接近于理论效率，后者由目标函数和包络函数的总积分之比给出：\n$$\n\\varepsilon_{\\text{theory}} = \\frac{\\int_{[0,1]^2} f(\\mathbf{x}) d\\mathbf{x}}{\\int_{[0,1]^2} C^\\star g(\\mathbf{x}) d\\mathbf{x}} = \\frac{\\sum_{i=1}^{M+1} A_i}{C^\\star}.\n$$\n这为 $C^\\star$ 的数值结果提供了一个有价值的交叉检验。程序将对提供的四个测试用例中的每一个执行这整个过程。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\nclass TruncatedCauchy:\n    \"\"\"Represents a truncated Cauchy distribution on [0, 1].\"\"\"\n    def __init__(self, c, gamma):\n        self.c = float(c)\n        self.gamma = float(gamma)\n        \n        # Pre-calculate CDF values and normalization constant\n        self.F0 = (1.0 / np.pi) * np.arctan(-self.c / self.gamma) + 0.5\n        self.F1 = (1.0 / np.pi) * np.arctan((1.0 - self.c) / self.gamma) + 0.5\n        self.Z = self.F1 - self.F0\n\n    def pdf(self, x):\n        \"\"\"Calculates the PDF value(s). Vectorized.\"\"\"\n        cauchy_unnorm = (1.0 / np.pi) * self.gamma / ((x - self.c)**2 + self.gamma**2)\n        return cauchy_unnorm / self.Z\n\n    def sample(self, u_rand):\n        \"\"\"Generates a random sample using inverse transform sampling.\"\"\"\n        arg = np.pi * (u_rand * self.Z + self.F0 - 0.5)\n        return self.c + self.gamma * np.tan(arg)\n\nclass ResonanceChannel:\n    \"\"\"Represents a 2D resonance proposal channel.\"\"\"\n    def __init__(self, c_u, gamma_u, c_v, gamma_v):\n        self.dist_u = TruncatedCauchy(c_u, gamma_u)\n        self.dist_v = TruncatedCauchy(c_v, gamma_v)\n\n    def pdf(self, u, v):\n        \"\"\"Calculates the 2D PDF value(s). Vectorized.\"\"\"\n        return self.dist_u.pdf(u) * self.dist_v.pdf(v)\n    \n    def sample(self):\n        \"\"\"Generates a 2D random sample.\"\"\"\n        u = self.dist_u.sample(np.random.rand())\n        v = self.dist_v.sample(np.random.rand())\n        return u, v\n\nclass BackgroundChannel:\n    \"\"\"Represents the uniform background proposal channel.\"\"\"\n    def pdf(self, u, v):\n        \"\"\"Calculates the 2D PDF value. Vectorized.\"\"\"\n        if isinstance(u, np.ndarray):\n            return np.ones_like(u)\n        return 1.0\n    \n    def sample(self):\n        \"\"\"Generates a 2D random sample.\"\"\"\n        return np.random.rand(), np.random.rand()\n\ndef solve_case(params):\n    \"\"\"Solves one complete test case.\"\"\"\n    M, amplitudes, bg_amplitude, resonances_params = params\n    \n    # 1. Define channels and target function\n    channels = []\n    for p in resonances_params:\n        channels.append(ResonanceChannel(p['u'][0], p['u'][1], p['v'][0], p['v'][1]))\n    channels.append(BackgroundChannel()) # M+1-th channel is background\n    \n    all_amplitudes = np.append(amplitudes, bg_amplitude)\n    num_channels = M + 1\n\n    def f_target(u, v):\n        total = 0.0\n        for i in range(num_channels):\n            total += all_amplitudes[i] * channels[i].pdf(u, v)\n        return total\n\n    # 2. Optimize weights via Linear Programming\n    Gu, Gv = 50, 50\n    u_grid = np.linspace(0.0, 1.0, Gu)\n    v_grid = np.linspace(0.0, 1.0, Gv)\n    uu, vv = np.meshgrid(u_grid, v_grid)\n    grid_u, grid_v = uu.ravel(), vv.ravel()\n    \n    f_vals = f_target(grid_u, grid_v)\n    g_vals_list = [chan.pdf(grid_u, grid_v) for chan in channels]\n    \n    # LP setup: min c^T v s.t. A_ub v <= b_ub\n    # Our problem: min sum(v_i) s.t. sum(v_i * g_i(x_k)) >= f(x_k) for all k\n    # which is -sum(v_i * g_i(x_k)) <= -f(x_k)\n    c_lp = np.ones(num_channels)\n    A_ub_lp = -np.stack(g_vals_list, axis=1) # (N_grid, N_channels)\n    b_ub_lp = -f_vals\n\n    res = linprog(c_lp, A_ub=A_ub_lp, b_ub=b_ub_lp, bounds=(0, None), method='highs')\n    \n    v_opt = res.x\n    C_star = np.sum(v_opt)\n    w_opt = v_opt / C_star\n\n    # 3. Multi-channel Accept-Reject Sampling\n    N_samples = 20000\n    accepted_count = 0\n    channel_indices = np.arange(num_channels)\n\n    for _ in range(N_samples):\n        # Choose a channel\n        chosen_idx = np.random.choice(channel_indices, p=w_opt)\n        \n        # Generate a proposal (u,v) from the chosen channel\n        u_prop, v_prop = channels[chosen_idx].sample()\n        \n        # Check bounds (sampler can sometimes be slightly outside due to precision)\n        if not (0.0 <= u_prop <= 1.0 and 0.0 <= v_prop <= 1.0):\n            continue\n\n        # Calculate acceptance probability\n        f_val_prop = f_target(u_prop, v_prop)\n        \n        g_val_prop = 0.0\n        for i in range(num_channels):\n            g_val_prop += w_opt[i] * channels[i].pdf(u_prop, v_prop)\n        \n        p_accept = f_val_prop / (C_star * g_val_prop)\n\n        if np.random.rand() < p_accept:\n            accepted_count += 1\n            \n    efficiency = accepted_count / N_samples\n    \n    # Pack results\n    return [C_star, efficiency, *w_opt]\n\n\ndef solve():\n    \"\"\"Main function to run all test cases and print results.\"\"\"\n    test_cases = [\n        # Case 1\n        (3, (1.0, 0.9, 0.6), 0.02, [\n            {'u': (0.25, 0.02), 'v': (0.70, 0.02)},\n            {'u': (0.75, 0.03), 'v': (0.30, 0.025)},\n            {'u': (0.45, 0.04), 'v': (0.50, 0.04)},\n        ]),\n        # Case 2\n        (3, (1.0, 0.8, 0.7), 0.01, [\n            {'u': (0.40, 0.03), 'v': (0.60, 0.03)},\n            {'u': (0.45, 0.025), 'v': (0.55, 0.025)},\n            {'u': (0.50, 0.035), 'v': (0.50, 0.035)},\n        ]),\n        # Case 3\n        (3, (1.0, 1.0, 0.9), 0.0, [\n            {'u': (0.30, 0.008), 'v': (0.70, 0.008)},\n            {'u': (0.70, 0.008), 'v': (0.30, 0.008)},\n            {'u': (0.50, 0.006), 'v': (0.50, 0.006)},\n        ]),\n        # Case 4\n        (3, (0.8, 0.8, 0.4), 0.20, [\n            {'u': (0.35, 0.025), 'v': (0.65, 0.025)},\n            {'u': (0.65, 0.025), 'v': (0.35, 0.025)},\n            {'u': (0.50, 0.040), 'v': (0.50, 0.040)},\n        ]),\n    ]\n\n    all_results = []\n    for case in test_cases:\n        result = solve_case(case)\n        all_results.append(f\"[{','.join(map(str, result))}]\")\n\n    print(f\"[{','.join(all_results)}]\")\n\nsolve()\n```", "id": "3512593"}]}