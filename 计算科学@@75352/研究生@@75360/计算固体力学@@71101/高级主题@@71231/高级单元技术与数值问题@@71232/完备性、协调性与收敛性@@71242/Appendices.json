{"hands_on_practices": [{"introduction": "有限元分析的准确性不仅取决于单元的插值函数，还深刻地依赖于从理想的父单元到物理网格的几何映射。雅可比行列式 $J(\\xi,\\eta)$ 是衡量此映射质量的关键指标，它直接关联到单元的积分和导数计算。通过本练习 [@problem_id:3549774]，您将亲自推导一个扭曲四边形单元的雅可比行列式，并分析其如何影响完备性、相容性与收敛性，从而理解单元几何形状对求解精度的重要性。", "problem": "考虑在有限元方法 (FEM) 中使用的一个等参双线性四边形单元 ($Q4$)。父域是自然坐标 $(\\xi,\\eta) \\in [-1,1] \\times [-1,1]$ 的正方形，并且到物理域的单元映射由双线性形函数 $N_{i}(\\xi,\\eta)$ 和物理角节点坐标 $(x_{i},y_{i})$ ($i=1,2,3,4$) 定义。双线性形函数为\n$$\nN_{1}(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta),\\quad\nN_{2}(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1-\\eta),\\quad\nN_{3}(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1+\\eta),\\quad\nN_{4}(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1+\\eta).\n$$\n设物理角节点坐标为\n$$\n(x_{1},y_{1})=(0,0),\\quad (x_{2},y_{2})=(2,0),\\quad (x_{3},y_{3})=(2(1+\\alpha),1),\\quad (x_{4},y_{4})=(0,1),\n$$\n其中 $\\alpha \\ge 0$ 是一个无量纲的畸变参数，它将右上角水平移动。等参映射为\n$$\nx(\\xi,\\eta) = \\sum_{i=1}^{4} N_{i}(\\xi,\\eta)\\, x_{i},\\qquad y(\\xi,\\eta) = \\sum_{i=1}^{4} N_{i}(\\xi,\\eta)\\, y_{i}.\n$$\n将映射的雅可比矩阵定义为\n$$\n\\mathbf{F}(\\xi,\\eta) = \n\\begin{pmatrix}\n\\frac{\\partial x}{\\partial \\xi}  \\frac{\\partial x}{\\partial \\eta} \\\\\n\\frac{\\partial y}{\\partial \\xi}  \\frac{\\partial y}{\\partial \\eta}\n\\end{pmatrix},\n$$\n其行列式为 $J(\\xi,\\eta) = \\det \\mathbf{F}(\\xi,\\eta)$。从以上定义出发：\n- 推导 $J(\\xi,\\eta)$ 作为 $\\alpha$、$\\xi$ 和 $\\eta$ 的函数的显式表达式。\n- 使用等参映射的基本原理，分析确保在整个父域上 $J(\\xi,\\eta)>0$ 的正性条件，以及由比率 $J_{\\max}/J_{\\min}$ 量化的有界性，其中 $J_{\\min}=\\min_{(\\xi,\\eta)\\in[-1,1]^{2}} J(\\xi,\\eta)$ 且 $J_{\\max}=\\max_{(\\xi,\\eta)\\in[-1,1]^{2}} J(\\xi,\\eta)$。\n- 解释 $J$ 的正性和有界性如何与完备性（表示线性场的能力）、相容性（跨单元边界的位移连续性）和收敛性（随网格细化的误差减小）相关，重点关注通过映射引起的插值误差放大及其对收敛率的影响。\n\n假设，为了在收敛性研究中获得可接受的单元质量，有界性要求设置为\n$$\n\\frac{J_{\\max}}{J_{\\min}} \\le \\kappa_{\\max},\\quad \\kappa_{\\max} = 2.\n$$\n确定最大的允许畸变参数 $\\alpha^{\\star}$，使得正性条件和有界性条件同时成立。将 $\\alpha^{\\star}$ 的最终答案表示为一个无量纲数。无需四舍五入。", "solution": "所述问题在科学上是合理的、适定的，并包含唯一解所需的所有必要信息。等参映射、变换的雅可比矩阵及其性质是有限元方法（FEM）理论的核心概念。本问题针对一个特定的双线性四边形单元研究了这些概念。\n\n求解过程分四个阶段：首先，我们推导雅可比行列式 $J(\\xi,\\eta)$ 的显式表达式；其次，我们分析其正性和有界性的条件；第三，我们讨论其对有限元方法核心性质——完备性、相容性和收敛性的影响；第四，我们根据给定准则计算最大允许畸变参数 $\\alpha^{\\star}$。\n\n首先，我们确定从父域坐标 $(\\xi, \\eta)$ 到物理域坐标 $(x,y)$ 的映射。该映射由下式给出\n$$x(\\xi,\\eta) = \\sum_{i=1}^{4} N_{i}(\\xi,\\eta)\\, x_{i}$$\n$$y(\\xi,\\eta) = \\sum_{i=1}^{4} N_{i}(\\xi,\\eta)\\, y_{i}$$\n形函数 $N_i$ 和节点坐标 $(x_i, y_i)$ 是已知的。\n对于 $x$ 坐标，代入给定值 $x_{1}=0$, $x_{2}=2$, $x_{3}=2(1+\\alpha)$ 和 $x_{4}=0$：\n$$x(\\xi,\\eta) = N_{2}(\\xi,\\eta) (2) + N_{3}(\\xi,\\eta) (2(1+\\alpha))$$\n$$x(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1-\\eta)(2) + \\frac{1}{4}(1+\\xi)(1+\\eta)(2(1+\\alpha))$$\n$$x(\\xi,\\eta) = \\frac{1}{2}(1+\\xi) \\left[ (1-\\eta) + (1+\\alpha)(1+\\eta) \\right]$$\n$$x(\\xi,\\eta) = \\frac{1}{2}(1+\\xi) \\left[ 1 - \\eta + 1 + \\eta + \\alpha(1+\\eta) \\right]$$\n$$x(\\xi,\\eta) = \\frac{1}{2}(1+\\xi) \\left[ 2 + \\alpha(1+\\eta) \\right] = (1+\\xi)\\left(1 + \\frac{\\alpha}{2}(1+\\eta)\\right)$$\n对于 $y$ 坐标，代入给定值 $y_{1}=0$, $y_{2}=0$, $y_{3}=1$ 和 $y_{4}=1$：\n$$y(\\xi,\\eta) = N_{3}(\\xi,\\eta) (1) + N_{4}(\\xi,\\eta) (1)$$\n$$y(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1+\\eta) + \\frac{1}{4}(1-\\xi)(1+\\eta)$$\n$$y(\\xi,\\eta) = \\frac{1+\\eta}{4} \\left[ (1+\\xi) + (1-\\xi) \\right] = \\frac{1+\\eta}{4}(2) = \\frac{1}{2}(1+\\eta)$$\n接下来，我们通过对 $x(\\xi,\\eta)$ 和 $y(\\xi,\\eta)$ 分别求关于 $\\xi$ 和 $\\eta$ 的偏导数来计算雅可比矩阵 $\\mathbf{F}(\\xi,\\eta)$ 的分量。\n$$\\frac{\\partial x}{\\partial \\xi} = \\frac{\\partial}{\\partial \\xi} \\left[ (1+\\xi)\\left(1 + \\frac{\\alpha}{2}(1+\\eta)\\right) \\right] = 1 + \\frac{\\alpha}{2}(1+\\eta)$$\n$$\\frac{\\partial x}{\\partial \\eta} = \\frac{\\partial}{\\partial \\eta} \\left[ (1+\\xi)\\left(1 + \\frac{\\alpha}{2}(1+\\eta)\\right) \\right] = (1+\\xi)\\frac{\\alpha}{2}$$\n$$\\frac{\\partial y}{\\partial \\xi} = \\frac{\\partial}{\\partial \\xi} \\left[ \\frac{1}{2}(1+\\eta) \\right] = 0$$\n$$\\frac{\\partial y}{\\partial \\eta} = \\frac{\\partial}{\\partial \\eta} \\left[ \\frac{1}{2}(1+\\eta) \\right] = \\frac{1}{2}$$\n因此，雅可比矩阵为\n$$\n\\mathbf{F}(\\xi,\\eta) = \n\\begin{pmatrix}\n1 + \\frac{\\alpha}{2}(1+\\eta)  \\frac{\\alpha}{2}(1+\\xi) \\\\\n0  \\frac{1}{2}\n\\end{pmatrix}\n$$\n雅可比行列式 $J(\\xi,\\eta) = \\det \\mathbf{F}(\\xi,\\eta)$ 计算如下：\n$$J(\\xi,\\eta) = \\left( 1 + \\frac{\\alpha}{2}(1+\\eta) \\right) \\left( \\frac{1}{2} \\right) - \\left( \\frac{\\alpha}{2}(1+\\xi) \\right) (0)$$\n$$J(\\xi,\\eta) = \\frac{1}{2} + \\frac{\\alpha}{4}(1+\\eta)$$\n这就是雅可比行列式的显式表达式。注意它与 $\\xi$ 无关。\n\n现在，我们分析 $J(\\xi,\\eta)$ 在父域 $(\\xi,\\eta) \\in [-1,1] \\times [-1,1]$ 上的正性和有界性。参数 $\\alpha$ 已知为 $\\alpha \\ge 0$。\n正性条件要求对于域中所有的 $(\\xi,\\eta)$，都有 $J(\\xi,\\eta) > 0$。为了检验这一点，我们找到 $J$ 的最小值，记为 $J_{\\min}$。由于 $\\alpha \\ge 0$，$J(\\xi,\\eta)$ 是关于 $\\eta$ 的一个非减函数。因此，其最小值在 $\\eta$ 取最小值时出现，即 $\\eta = -1$。\n$$J_{\\min} = \\min_{(\\xi,\\eta)\\in[-1,1]^{2}} J(\\xi,\\eta) = J(\\xi, -1) = \\frac{1}{2} + \\frac{\\alpha}{4}(1 - 1) = \\frac{1}{2}$$\n由于 $J_{\\min} = 1/2$ 是严格为正的，因此对于所有 $\\alpha \\ge 0$，在整个父单元上 $J(\\xi,\\eta) > 0$ 的条件都满足。这确保了对于这类单元，等参映射总是非奇异且一一对应的。\n对于有界性分析，我们需要 $J$ 的最大值，记为 $J_{\\max}$。由于 $J$ 随 $\\eta$ 非减，其最大值在 $\\eta = 1$ 时出现。\n$$J_{\\max} = \\max_{(\\xi,\\eta)\\in[-1,1]^{2}} J(\\xi,\\eta) = J(\\xi, 1) = \\frac{1}{2} + \\frac{\\alpha}{2}$$\n有界性由比率 $J_{\\max}/J_{\\min}$ 量化：\n$$\\frac{J_{\\max}}{J_{\\min}} = \\frac{\\frac{1}{2} + \\frac{\\alpha}{2}}{\\frac{1}{2}} = 1 + \\alpha$$\n\n接下来，我们将雅可比矩阵的这些性质与有限元方法中的完备性、相容性和收敛性概念联系起来。\n**完备性**要求单元的形函数能够精确表示任何线性位移场（一个常应变状态）。对于双线性 Q4 单元，其形函数的构造满足 $\\sum_{i=1}^{4} N_{i} = 1$，并且可以再现任何形如 $a+bx+cy$ 的函数。这个性质是形函数所固有的，并确保单元通过斑块检验，这是收敛的一个必要条件。雅可比矩阵在这里的作用是次要但基础的：一个有效的、可逆的映射（$J > 0$）是必需的，用以唯一地将物理空间 $(x,y)$ 与父空间 $(\\xi,\\eta)$ 联系起来，这是整个公式有意义的前提条件。\n**相容性**要求位移场在单元间边界上是连续的。对于等参单元，对几何和位移使用相同的形函数可以保证这一点。两个单元之间公共边的映射仅由该边上节点的坐标定义。如果两个单元共享这些节点，它们就共享相同的物理边界，并且由相同的节点值沿该边插值得到的位移场将是连续的。在整个单元（包括其边界）上为正的雅可比行列式（$J>0$）确保了非退化的几何形状，即单元不会重叠或折叠，这对于构成一个有效、相容的网格至关重要。\n**收敛性**指的是数值解的误差随着网格的细化而减小。有限元方法中的误差估计表明，近似误差受一个常数 $C$ 的限制，该常数除其他因素外，还取决于单元的几何形状。这个常数 $C$ 会受到单元从其理想形状（父域中的正方形）畸变的不利影响。对于等参映射，雅可比矩阵 $\\mathbf{F}$ 及其逆矩阵 $\\mathbf{F}^{-1}$ 的范数会出现在这个常数中。单元内雅可比行列式 $J$ 的巨大变化是高度畸变的标志。比率 $J_{\\max}/J_{\\min}$ 是衡量这种畸变的常用指标。如果这个比率很大，误差界限中的常数 $C$ 可能会变得很大，导致在给定的网格尺寸 $h$ 下精度不佳。为了一以最优理论速率收敛，在一系列细化网格中，所有单元的该比率都必须保持有界。奇异点（$J=0$）对应于无限大的比率，会破坏误差估计并导致收敛失败。\n\n最后，我们根据约束条件 $\\frac{J_{\\max}}{J_{\\min}} \\le \\kappa_{\\max}$（其中 $\\kappa_{\\max} = 2$）来确定最大允许畸变参数 $\\alpha^{\\star}$。\n我们已经发现，对于 $\\alpha \\ge 0$，$J>0$ 的正性条件总是满足的。\n有界性条件是：\n$$\\frac{J_{\\max}}{J_{\\min}} \\le 2$$\n代入我们推导出的比率表达式：\n$$1 + \\alpha \\le 2$$\n这可以简化为：\n$$\\alpha \\le 1$$\n由于问题指定 $\\alpha \\ge 0$，因此畸变参数的可接受范围是 $0 \\le \\alpha \\le 1$。最大允许值 $\\alpha^{\\star}$ 是此范围的上限。\n$$\\alpha^{\\star} = 1$$", "answer": "$$\\boxed{1}$$", "id": "3549774"}, {"introduction": "在有限元实践中，为了提高计算效率，我们常常采用减缩积分。然而，这种简化可能引入非物理的、零能量的变形模式，即“沙漏模式”，它会导致数值解的失稳和失效。本练习 [@problem_id:3549776] 将引导您显式地构造这些导致数值不稳定的沙漏模式，并从根本上理解为什么它们会破坏解的稳定性和收敛性。", "problem": "考虑一个定义在母坐标 $(\\xi,\\eta) \\in [-1,1]\\times[-1,1]$ 上的二维、线性弹性、平面应变四节点四边形有限元（$Q4$ 单元）。节点排序为 $1:(-1,-1)$, $2:(+1,-1)$, $3:(+1,+1)$, $4:(-1,+1)$。该单元对位移场 $\\boldsymbol{u}(\\xi,\\eta) = u(\\xi,\\eta)\\,\\boldsymbol{e}_x + v(\\xi,\\eta)\\,\\boldsymbol{e}_y$ 使用双线性插值，其中 $u(\\xi,\\eta)$ 和 $v(\\xi,\\eta)$ 是通过四个形函数 $N_i(\\xi,\\eta)$ 从节点值插值得到。这些形函数构成单位分解，并在节点处满足克罗内克-德尔塔插值性质。假设到物理坐标的映射为矩形映射，在 $(\\xi,\\eta)=(0,0)$ 处具有单位雅可比行列式，因此在单元中心，对物理坐标的导数等于对母坐标的导数。应变在小应变运动学下计算，应变向量定义为 $\\boldsymbol{\\varepsilon} = \\begin{pmatrix} \\varepsilon_{xx}  \\varepsilon_{yy}  \\gamma_{xy} \\end{pmatrix}^{\\mathsf{T}}$，使用标准定义 $\\varepsilon_{xx} = \\partial u/\\partial x$, $\\varepsilon_{yy} = \\partial v/\\partial y$ 和 $\\gamma_{xy} = \\partial u/\\partial y + \\partial v/\\partial x$。单元刚度在中心 $(\\xi,\\eta)=(0,0)$ 处使用单点高斯积分（减缩积分）。材料是均匀、各向同性、线性弹性的，但您应保持所有材料参数为符号形式。\n\n从这些基本原理出发，完成以下任务：\n\n1. 根据四个节点位移分量 $u_i$ 和 $v_i$ ($i=1,\\dots,4$)，推导在 $(\\xi,\\eta)=(0,0)$ 处的离散应变算子 $\\boldsymbol{B}$。将中心点的 $\\varepsilon_{xx}$, $\\varepsilon_{yy}$ 和 $\\gamma_{xy}$ 表示为节点值的线性形式。仅使用由节点位置所隐含的双线性形函数及其在中心点导数的性质；不要假设任何不能从这些性质推导出的公式。\n\n2. 确定所有位于 $\\boldsymbol{B}$ 的核中且非刚体模态（两次平移和一次平面内旋转）的非平凡节点位移模式 $(u_1,v_1,u_2,v_2,u_3,v_3,u_4,v_4)$。识别并明确构造由减缩积分为此 $Q4$ 单元引入的作为零能量运动模式的沙漏模态，并证明它们在 $(\\xi,\\eta)=(0,0)$ 处产生 $\\boldsymbol{\\varepsilon}=\\boldsymbol{0}$，同时又不是刚体运动。\n\n3. 使用完备性、相容性和收敛性原理，解释为什么这些沙漏模态破坏了相容性和稳定性，以及减缩积分如何导致离散双线性形式丧失矫顽性。将您的解释建立在有限元法（FEM）的变分结构和足够积分的作用之上。\n\n4. 关注由 $u$ 位移在节点 $1,2,3,4$ 处分别交替为 $+1,-1,+1,-1$ 且所有 $v$ 位移均为零所定义的沙漏模态。将其对应的8分量节点位移向量归一化，使其欧几里得范数等于 $1$，并按 $(u_1,v_1,u_2,v_2,u_3,v_3,u_4,v_4)$ 的顺序报告归一化后的向量。\n\n不得为材料参数代入任何数值。您最终报告的结果必须是单一的归一化沙漏模态向量。无需四舍五入。", "solution": "该问题已经过验证，被认为是科学上合理、适定、客观且内部一致的。它代表了计算固体力学领域内一项标准且基础的分析。因此，我们可以进行完整的解答。\n\n该问题要求对一个四节点四边形（$Q4$）平面应变有限元进行多部分分析，重点关注减缩积分的病态效应。我们将按顺序处理每个部分。\n\n**1. 在单元中心推导离散应变算子 $\\boldsymbol{B}$**\n\n单元内的位移场 $(u,v)$ 是通过使用双线性形函数 $N_i(\\xi,\\eta)$ 从节点位移 $(u_i,v_i)$ 插值得到的。在母域中任意一点 $(\\xi,\\eta)$ 的位移由下式给出：\n$$\nu(\\xi,\\eta) = \\sum_{i=1}^{4} N_i(\\xi,\\eta) u_i\n$$\n$$\nv(\\xi,\\eta) = \\sum_{i=1}^{4} N_i(\\xi,\\eta) v_i\n$$\n对于节点位于 $(\\xi_i, \\eta_i) \\in \\{(-1,-1), (1,-1), (1,1), (-1,1)\\}$ 的 $Q4$ 单元，其双线性形函数定义为：\n$$\nN_i(\\xi,\\eta) = \\frac{1}{4}(1 + \\xi_i\\xi)(1 + \\eta_i\\eta)\n$$\n问题陈述，由于在单元中心 $(\\xi,\\eta)=(0,0)$ 处存在一个单位雅可比行列式的矩形映射，因此在该特定点，对物理坐标的导数等于对母坐标的导数。即，在 $(\\xi,\\eta)=(0,0)$ 处有 $\\frac{\\partial}{\\partial x} = \\frac{\\partial}{\\partial \\xi}$ 和 $\\frac{\\partial}{\\partial y} = \\frac{\\partial}{\\partial \\eta}$。\n\n应变分量 $\\varepsilon_{xx}$、$\\varepsilon_{yy}$ 和 $\\gamma_{xy}$ 由位移场的导数定义。我们必须首先求出形函数的导数。\n$$\n\\frac{\\partial N_i}{\\partial \\xi} = \\frac{1}{4} \\xi_i (1 + \\eta_i\\eta) \\quad \\implies \\quad \\frac{\\partial N_i}{\\partial \\xi}\\bigg|_{(0,0)} = \\frac{1}{4} \\xi_i\n$$\n$$\n\\frac{\\partial N_i}{\\partial \\eta} = \\frac{1}{4} \\eta_i (1 + \\xi_i\\xi) \\quad \\implies \\quad \\frac{\\partial N_i}{\\partial \\eta}\\bigg|_{(0,0)} = \\frac{1}{4} \\eta_i\n$$\n对于节点 $i=1,2,3,4$，其在母域中的节点坐标为 $\\xi = (-1, +1, +1, -1)^{\\mathsf{T}}$ 和 $\\eta = (-1, -1, +1, +1)^{\\mathsf{T}}$。\n\n现在，我们可以计算中心点 $(0,0)$ 处的应变分量：\n$$\n\\varepsilon_{xx}(0,0) = \\frac{\\partial u}{\\partial x}\\bigg|_{(0,0)} = \\frac{\\partial u}{\\partial \\xi}\\bigg|_{(0,0)} = \\sum_{i=1}^{4} \\frac{\\partial N_i}{\\partial \\xi}\\bigg|_{(0,0)} u_i = \\frac{1}{4} \\sum_{i=1}^{4} \\xi_i u_i\n$$\n$$\n\\varepsilon_{xx}(0,0) = \\frac{1}{4}(-1 \\cdot u_1 + 1 \\cdot u_2 + 1 \\cdot u_3 - 1 \\cdot u_4) = \\frac{1}{4}(-u_1 + u_2 + u_3 - u_4)\n$$\n类似地，对于 $\\varepsilon_{yy}$：\n$$\n\\varepsilon_{yy}(0,0) = \\frac{\\partial v}{\\partial y}\\bigg|_{(0,0)} = \\frac{\\partial v}{\\partial \\eta}\\bigg|_{(0,0)} = \\sum_{i=1}^{4} \\frac{\\partial N_i}{\\partial \\eta}\\bigg|_{(0,0)} v_i = \\frac{1}{4} \\sum_{i=1}^{4} \\eta_i v_i\n$$\n$$\n\\varepsilon_{yy}(0,0) = \\frac{1}{4}(-1 \\cdot v_1 - 1 \\cdot v_2 + 1 \\cdot v_3 + 1 \\cdot v_4) = \\frac{1}{4}(-v_1 - v_2 + v_3 + v_4)\n$$\n对于剪切应变 $\\gamma_{xy}$：\n$$\n\\gamma_{xy}(0,0) = \\frac{\\partial u}{\\partial y}\\bigg|_{(0,0)} + \\frac{\\partial v}{\\partial x}\\bigg|_{(0,0)} = \\frac{\\partial u}{\\partial \\eta}\\bigg|_{(0,0)} + \\frac{\\partial v}{\\partial \\xi}\\bigg|_{(0,0)}\n$$\n$$\n\\gamma_{xy}(0,0) = \\sum_{i=1}^{4} \\frac{\\partial N_i}{\\partial \\eta}\\bigg|_{(0,0)} u_i + \\sum_{i=1}^{4} \\frac{\\partial N_i}{\\partial \\xi}\\bigg|_{(0,0)} v_i = \\frac{1}{4} \\sum_{i=1}^{4} \\eta_i u_i + \\frac{1}{4} \\sum_{i=1}^{4} \\xi_i v_i\n$$\n$$\n\\gamma_{xy}(0,0) = \\frac{1}{4}(-u_1 - u_2 + u_3 + u_4) + \\frac{1}{4}(-v_1 + v_2 + v_3 - v_4)\n$$\n离散应变-位移关系 $\\boldsymbol{\\varepsilon} = \\boldsymbol{B}\\boldsymbol{d}$ 将应变向量 $\\boldsymbol{\\varepsilon} = (\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy})^{\\mathsf{T}}$ 与节点位移向量 $\\boldsymbol{d} = (u_1, v_1, u_2, v_2, u_3, v_3, u_4, v_4)^{\\mathsf{T}}$ 联系起来。根据上述表达式，在中心点 $(\\xi,\\eta)=(0,0)$ 处求值的矩阵 $\\boldsymbol{B}$ 为：\n$$\n\\boldsymbol{B}(0,0) = \\frac{1}{4} \\begin{pmatrix}\n-1  0  1  0  1  0  -1  0 \\\\\n0  -1  0  -1  0  1  0  1 \\\\\n-1  -1  -1  1  1  1  1  -1\n\\end{pmatrix}\n$$\n\n**2. 沙漏模态的识别**\n\n沙漏模态是在积分点产生零应变的非刚体位移模式。它们是离散应变算子 $\\boldsymbol{B}(0,0)$ 的核中的向量，不包括对应于刚体运动的向量。我们必须找到 $\\boldsymbol{B}(0,0)$ 的零空间，即所有满足 $\\boldsymbol{B}(0,0)\\boldsymbol{d} = \\boldsymbol{0}$ 的非零向量 $\\boldsymbol{d}$。这导出一个由三个线性方程组成的方程组：\n$$\n-u_1 + u_2 + u_3 - u_4 = 0 \\quad (1)\n$$\n$$\n-v_1 - v_2 + v_3 + v_4 = 0 \\quad (2)\n$$\n$$\n-u_1 - u_2 + u_3 + u_4 - v_1 + v_2 + v_3 - v_4 = 0 \\quad (3)\n$$\n矩阵 $\\boldsymbol{B}(0,0)$ 的秩为 $3$，因此其核的维数为 $8-3=5$。其中三个维度对应于刚体模态（两次平移，一次平面内旋转），它们在任何地方都产生零应变，因此必然位于 $\\boldsymbol{B}(0,0)$ 的核中。剩下的 $5-3=2$ 个维度对应于沙漏模态。\n\n刚体模态是：\n1.  **x方向平移**：$\\boldsymbol{d}_{R1} = (1, 0, 1, 0, 1, 0, 1, 0)^{\\mathsf{T}}$。\n2.  **y方向平移**：$\\boldsymbol{d}_{R2} = (0, 1, 0, 1, 0, 1, 0, 1)^{\\mathsf{T}}$。\n3.  **平面内旋转**：对于方形单元，小角度旋转的节点位移为 $\\boldsymbol{u} \\propto (-y_i)$ 和 $\\boldsymbol{v} \\propto (x_i)$。这给出 $\\boldsymbol{d}_{R3} \\propto (1, -1, 1, 1, -1, 1, -1, -1)^{\\mathsf{T}}$。\n可以验证这三个向量满足方程 $(1)$、$(2)$ 和 $(3)$。\n\n两个沙漏模态是核中与刚体模态线性无关的向量。我们可以通过观察满足核方程的模式来构造它们。我们定义节点向量 $\\boldsymbol{h}_{xy} = (1, -1, 1, -1)^{\\mathsf{T}}$。\n\n*   **沙漏模态 1 (HG1)**：令 $\\boldsymbol{u} = c_1 \\boldsymbol{h}_{xy} = (c_1, -c_1, c_1, -c_1)^{\\mathsf{T}}$ 且 $\\boldsymbol{v} = \\boldsymbol{0}$。\n    方程 (1): $-c_1 + (-c_1) + c_1 - (-c_1) = 0$。\n    方程 (2): $0 = 0$。\n    方程 (3): $-c_1 - (-c_1) + c_1 + (-c_1) + 0 = 0$。\n    该模态满足在中心点的零应变条件。对应的位移向量（取 $c_1=1$）是 $\\boldsymbol{d}_{H1} = (1, 0, -1, 0, 1, 0, -1, 0)^{\\mathsf{T}}$。这代表一个运动模式，其中位移场为 $u(\\xi,\\eta) \\propto \\xi\\eta$ 且 $v(\\xi,\\eta)=0$。\n\n*   **沙漏模态 2 (HG2)**：令 $\\boldsymbol{u} = \\boldsymbol{0}$ 且 $\\boldsymbol{v} = c_2 \\boldsymbol{h}_{xy} = (c_2, -c_2, c_2, -c_2)^{\\mathsf{T}}$。\n    方程 (1): $0 = 0$。\n    方程 (2): $-c_2 - (-c_2) + c_2 + (-c_2) = 0$。\n    方程 (3): $0 - c_2 + (-c_2) + c_2 - (-c_2) = 0$。\n    该模态也满足零应变条件。对应的位移向量（取 $c_2=1$）是 $\\boldsymbol{d}_{H2} = (0, 1, 0, -1, 0, 1, 0, -1)^{\\mathsf{T}}$。该模式对应于 $u(\\xi,\\eta)=0$ 和 $v(\\xi,\\eta) \\propto \\xi\\eta$。\n\n这两个向量 $\\boldsymbol{d}_{H1}$ 和 $\\boldsymbol{d}_{H2}$ 彼此线性无关，也与刚体模态线性无关。它们构成了该单元沙漏模态空间的一组基。\n\n**3. 病态行为的解释**\n\n沙漏模态的存在是一种数值病态，它违反了稳定且收敛的有限元格式的基本要求。\n\n*   **完备性**：$Q4$ 单元的双线性插值空间是“完备的”，因为它可以精确表示刚体运动和常应变状态。插值本身也可以表示沙漏场（例如，$u=\\xi\\eta$）。问题不在于插值的完备性，而在于减缩积分法则无法检测与这些模态相关的能量。\n\n*   **相容性与稳定性**：核心问题在于稳定性。在有限元法的变分格式中，总势能被最小化。应变能是节点位移的二次型，表示为 $U = \\frac{1}{2}\\boldsymbol{d}^{\\mathsf{T}}\\boldsymbol{K}\\boldsymbol{d}$，其中 $\\boldsymbol{K}$ 是单元刚度矩阵。刚度矩阵是通过在单元体积上对 $\\boldsymbol{B}^{\\mathsf{T}}\\boldsymbol{C}\\boldsymbol{B}$ 的乘积进行积分来计算的，其中 $\\boldsymbol{C}$ 是材料本构矩阵。对于一个稳定的单元，$\\boldsymbol{K}$ 在非刚体运动的变形空间上必须是正定的。这一性质，即离散双线性形式的矫顽性，确保任何非刚体变形都会产生正的应变能代价，从而得到唯一解。\n\n    当使用单点积分时，刚度矩阵近似为 $\\boldsymbol{K} \\approx (\\boldsymbol{B}^{\\mathsf{T}}(0,0)\\boldsymbol{C}\\boldsymbol{B}(0,0)) \\times \\text{Area}$。如果 $\\boldsymbol{d}$ 是一个沙漏模态向量，那么根据定义有 $\\boldsymbol{B}(0,0)\\boldsymbol{d}=\\boldsymbol{0}$。因此，与该模态相关的应变能计算为零：\n    $$\n    U_{HG} = \\frac{1}{2}\\boldsymbol{d}_{HG}^{\\mathsf{T}}\\boldsymbol{K}\\boldsymbol{d}_{HG} = \\frac{1}{2} (\\boldsymbol{B}(0,0)\\boldsymbol{d}_{HG})^{\\mathsf{T}} \\boldsymbol{C} (\\boldsymbol{B}(0,0)\\boldsymbol{d}_{HG}) \\times \\text{Area} = 0\n    $$\n    尽管沙漏模态的真实应变能非零，因为除了单元中心外，各处的应变都非零。例如，对于 HG1，$u=\\xi\\eta$，所以 $\\varepsilon_{xx}=\\partial u/\\partial x \\propto \\eta$ 且 $\\gamma_{xy}=\\partial u/\\partial y \\propto \\xi$。应变能密度非零，其在单元上的积分为正。\n\n    积分未能“看到”这种能量意味着离散刚度矩阵 $\\boldsymbol{K}$ 是奇异的（它的核比仅包含刚体模态的核更大）。这种矫顽性的丧失意味着离散系统 $\\boldsymbol{K}\\boldsymbol{d}=\\boldsymbol{f}$ 是不稳定的，可能没有唯一解。在网格中，这些零能量模态可以在没有任何能量惩罚的情况下被激发，导致解中出现没有物理依据的、虚假的、振荡的“棋盘”模式。虽然单个单元的位移场可能是连续的（`C^0` 相容），但由这种未受惩罚的模态组成的全局解通常在物理意义上表现出高度不连续或“不相容”。\n\n*   **收敛性**：稳定的方法是收敛的先决条件。由于减缩积分单元是不稳定的，当网格细化（$h \\to 0$）时，它不保证能收敛到正确解。数值解可能被沙漏模态的任意组合所污染，从而阻止误差消失。\n\n**4. 特定沙漏模态的归一化**\n\n问题指定了一个沙漏模态，其 $u$ 位移在节点 $1, 2, 3, 4$ 处分别交替为 $(+1, -1, +1, -1)$，且所有 $v$ 位移均为零。这对应于以下节点位移值：\n$$\nu_1 = 1, \\quad u_2 = -1, \\quad u_3 = 1, \\quad u_4 = -1\n$$\n$$\nv_1 = 0, \\quad v_2 = 0, \\quad v_3 = 0, \\quad v_4 = 0\n$$\n对应的8分量节点位移向量 $\\boldsymbol{d}$，按 $(u_1, v_1, u_2, v_2, u_3, v_3, u_4, v_4)$ 顺序排列为：\n$$\n\\boldsymbol{d} = (1, 0, -1, 0, 1, 0, -1, 0)^{\\mathsf{T}}\n$$\n我们必须将该向量归一化，使其欧几里得范数为 $1$。首先，我们计算其当前范数 $||\\boldsymbol{d}||_2$：\n$$\n||\\boldsymbol{d}||_2 = \\sqrt{1^2 + 0^2 + (-1)^2 + 0^2 + 1^2 + 0^2 + (-1)^2 + 0^2} = \\sqrt{1 + 1 + 1 + 1} = \\sqrt{4} = 2\n$$\n归一化向量 $\\boldsymbol{d}_{\\text{norm}}$ 通过将 $\\boldsymbol{d}$ 除以其范数得到：\n$$\n\\boldsymbol{d}_{\\text{norm}} = \\frac{1}{||\\boldsymbol{d}||_2} \\boldsymbol{d} = \\frac{1}{2} (1, 0, -1, 0, 1, 0, -1, 0)^{\\mathsf{T}}\n$$\n$$\n\\boldsymbol{d}_{\\text{norm}} = (\\frac{1}{2}, 0, -\\frac{1}{2}, 0, \\frac{1}{2}, 0, -\\frac{1}{2}, 0)^{\\mathsf{T}}\n$$\n这就是所要求的归一化沙漏模态向量。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{2}  0  -\\frac{1}{2}  0  \\frac{1}{2}  0  -\\frac{1}{2}  0\n\\end{pmatrix}\n}\n$$", "id": "3549776"}, {"introduction": "确保单元满足完备性（多项式再生能力）和相容性（单元间连续性）是保证有限元方法收敛的基石，尤其是在处理高阶单元和复杂几何时。这个综合性练习 [@problem_id:3549779] 旨在建立一个数值实验框架，用以系统地检验这些核心属性。您将通过具体案例，验证在不同几何映射（仿射、曲线、近奇异）下，单元的完备性如何被影响，同时确认相容性如何通过节点自由度的构造得以保证。", "problem": "您的任务是形式化并实现一个数值实验，以探究二维平面弹性力学中$H^1$相容等参单元的完备性、相容性和收敛性概念。基本设置为小应变、运动学容许的矢量值位移的$H^1$空间。请使用以下基本原理和定义来设计算法。\n\n1. 基本定义：\n   - $H^1$空间是函数及其一阶导数均平方可积的Sobolev空间。在平面弹性力学背景下，$H^1$相容有限元确保位移场$u_x$和$u_y$在单元交界面上是连续的。\n   - 从具有自然坐标$(\\xi,\\eta)\\in[-1,1]\\times[-1,1]$的参考正方形到物理四边形的等参映射，使用相同的形函数来插值几何$(x(\\xi,\\eta),y(\\xi,\\eta))$和位移分量$(u_x(\\xi,\\eta),u_y(\\xi,\\eta))$。\n   - $p$次完备性（多项式再生）意味着当在声称具有完备性的坐标空间中表示时，插值空间能够精确地再生任何次数最高为$p$的多项式。\n   - 相容性（单元间连续性）要求有限元插值在相邻单元的共享边上是连续的。\n   - 网格细化下的收敛性要求几何映射具有正则性，特别是雅可比行列式$J(\\xi,\\eta)=\\det\\left(\\frac{\\partial(x,y)}{\\partial(\\xi,\\eta)}\\right)$不为零且不变号，以避免单元翻转并确保有界的条件数。\n\n2. 单元构建要求：\n   - 构建一个$H^1$相容的九节点等参四边形单元，其具有在张量积节点$(\\xi,\\eta)\\in\\{-1,0,1\\}\\times\\{-1,0,1\\}$上定义的二次Lagrange形函数。将在$\\xi\\in\\{-1,0,1\\}$上的一维二次Lagrange基函数记为$l_1(\\xi)$、$l_2(\\xi)$、$l_3(\\xi)$，对$\\eta$也类似。二维形函数是张量积$N_{ij}(\\xi,\\eta)=l_i(\\xi)l_j(\\eta)$，其中$i,j\\in\\{1,2,3\\}$。\n   - 通过在所有九个插值点上使用节点自由度（$u_x$和$u_y$的值）来强制实现$H^1$相容性。这导致了共享边上的连续性，因为二维二次基函数在边上的限制简化为仅依赖于边节点的一维二次基函数。\n\n3. 完备性测试设计：\n   - 考虑物理坐标$(x,y)$中的二次位移多项式：\n     $$\n     u_x(x,y)=1+2x+3y+\\tfrac{1}{2}x^2+xy+\\tfrac{1}{4}y^2,\\qquad\n     u_y(x,y)=-\\tfrac{1}{2}+x-2y+0.1x^2+0.2xy-0.3y^2.\n     $$\n   - 对于每个单元，通过在九个节点的物理节点坐标$(x_i,y_i)$处计算$(u_x,u_y)$来获得节点值。构造等参插值式\n     $$\n     u_{h,x}(\\xi,\\eta)=\\sum_{i=1}^9N_i(\\xi,\\eta)\\,u_x(x_i,y_i),\\quad\n     u_{h,y}(\\xi,\\eta)=\\sum_{i=1}^9N_i(\\xi,\\eta)\\,u_y(x_i,y_i).\n     $$\n   - 在单元内部对$(\\xi,\\eta)$进行均匀采样，并评估最大绝对插值误差：\n     $$\n     e_{\\max}=\\max_{(\\xi,\\eta)\\in\\mathcal{S}}\\max\\left(\\big|u_{h,x}(\\xi,\\eta)-u_x(x(\\xi,\\eta),y(\\xi,\\eta))\\big|,\\ \\big|u_{h,y}(\\xi,\\eta)-u_y(x(\\xi,\\eta),y(\\xi,\\eta))\\big|\\right),\n     $$\n     其中$\\mathcal{S}$是一个固定的采样点网格。如果对于选定的容差$\\varepsilon$，有$e_{\\max}\\le \\varepsilon$，则声明再生是“精确的”。\n\n4. 在双单元片区上的相容性测试设计：\n   - 构建一个由两个共享一条垂直边的相邻单元组成的片区。对于共享边，通过在交界面上采样点来验证连续性，其中左单元为$(\\xi,\\eta)=(1,\\eta)$，右单元为$(\\xi,\\eta)=(-1,\\eta)$，并计算差值\n     $$\n     c_{\\max}=\\max_{\\eta\\in\\mathcal{E}}\\left\\|u_h^{\\text{left}}(1,\\eta)-u_h^{\\text{right}}(-1,\\eta)\\right\\|_\\infty,\n     $$\n     其中$u_h=(u_{h,x},u_{h,y})$，$\\|\\cdot\\|_\\infty$是分量上的最大范数，$\\mathcal{E}$是边采样点的固定网格。如果对于选定的容差$\\delta$，有$c_{\\max}\\le \\delta$，则声明连续性为“真”。\n\n5. 雅可比行列式正则性评估：\n   - 对于每个单元，使用形函数导数从几何映射中计算雅可比行列式$J(\\xi,\\eta)$，并报告内部采样网格上的最小值$J_{\\min}=\\min_{(\\xi,\\eta)\\in\\mathcal{S}}J(\\xi,\\eta)$。这量化了与奇异映射的接近程度。\n\n6. 测试套件：\n   - 使用三个测试用例，每个用例包含一个由左右两个单元组成的片区，单元由其九个物理节点坐标定义，坐标按网格中的$(\\xi,\\eta)$顺序排列\n     $$\n     \\{(-1,-1),(0,-1),(1,-1),(-1,0),(0,0),(1,0),(-1,1),(0,1),(1,1)\\}.\n     $$\n     对于所有用例，右单元是位于$[0.5,1]\\times[0,1]$上的规则矩形，其节点为\n     $$\n     \\{(0.5,0),(0.75,0),(1,0),(0.5,0.5),(0.75,0.5),(1,0.5),(0.5,1),(0.75,1),(1,1)\\}.\n     $$\n     左单元因用例而异：\n     - 用例A（仿射/双线性映射）：位于$[0,0.5]\\times[0,1]$上的规则矩形，其节点为\n       $$\n       \\{(0,0),(0.25,0),(0.5,0),(0,0.5),(0.25,0.5),(0.5,0.5),(0,1),(0.25,1),(0.5,1)\\}.\n       $$\n     - 用例B（弯曲映射，正雅可比行列式）：在保持共享交界面节点不变的情况下，使边凸出，\n       $$\n       \\{(0,0),(0.25,-0.1),(0.5,0),(-0.1,0.5),(0.25,0.5),(0.5,0.5),(0,1),(0.25,1.2),(0.5,1)\\}.\n       $$\n     - 用例C（在一个角点处接近奇异的雅可比行列式）：左边缘塌陷，左上角和左下角节点之间的间距非常小，\n       $$\n       \\{(0,0),(0.25,0),(0.5,0),(0,0.0005),(0.25,0.5),(0.5,0.5),(0,0.001),(0.25,1),(0.5,1)\\}.\n       $$\n   - 采样集：在$(\\xi,\\eta)$上使用$[-0.9,0.9]^2$内的$11\\times 11$均匀网格$\\mathcal{S}$，在$\\eta\\in[-0.9,0.9]$上使用11点的均匀网格$\\mathcal{E}$。\n   - 容差：为再生设置$\\varepsilon=10^{-10}$，为连续性设置$\\delta=10^{-12}$。\n\n7. 所需输出：\n   - 为每个用例生成一个包含三个条目的列表：片区的布尔型再生结果（如果两个单元都满足$e_{\\max}\\le\\varepsilon$则为真），共享边的布尔型连续性结果，以及两个单元上的浮点数$J_{\\min}$。最终输出必须是单行文本，包含一个由三个用例列表组成的逗号分隔列表，并用方括号括起来，例如$[[b_1,c_1,j_1],[b_2,c_2,j_2],[b_3,c_3,j_3]]$。\n\n8. 单位：所有量都是无量纲的；不需要物理单位。不涉及角度。\n\n您的程序必须实现指定的单元，执行完备性和相容性测试，并按上述确切格式生成所需的输出。", "solution": "我们从二维平面弹性力学的$H^1$相容等参单元的基本结构开始。未知的位移矢量场是$(u_x,u_y)$，其中每个分量都属于Sobolev空间$H^1$。在等参方法中，几何和场变量都由相同的形函数插值。在每个自然坐标上，基于$\\{-1,0,1\\}$的张量积二次Lagrange基底产生九个节点。将在节点$\\{-1,0,1\\}$处的一维二次Lagrange多项式记为$l_1(\\xi)$，$l_2(\\xi)$，$l_3(\\xi)$，满足$l_1(-1)=1$，$l_1(0)=l_1(1)=0$；$l_2(0)=1$，$l_2(-1)=l_2(1)=0$；$l_3(1)=1$，$l_3(-1)=l_3(0)=0$。一个典型的选择是\n$$\nl_1(\\xi)=\\tfrac{1}{2}\\xi(\\xi-1),\\quad l_2(\\xi)=1-\\xi^2,\\quad l_3(\\xi)=\\tfrac{1}{2}\\xi(\\xi+1),\n$$\n其导数为\n$$\nl_1'(\\xi)=\\xi-\\tfrac{1}{2},\\quad l_2'(\\xi)=-2\\xi,\\quad l_3'(\\xi)=\\xi+\\tfrac{1}{2}.\n$$\n二维形函数为$N_{ij}(\\xi,\\eta)=l_i(\\xi)l_j(\\eta)$，其导数为$N_{ij,\\xi}=l_i'(\\xi)l_j(\\eta)$和$N_{ij,\\eta}=l_i(\\xi)l_j'(\\eta)$，其中$i,j\\in\\{1,2,3\\}$。在$(\\xi,\\eta)\\in\\{(-1,-1),(0,-1),(1,-1),(-1,0),(0,0),(1,0),(-1,1),(0,1),(1,1)\\}$上以行主序对九个节点进行索引，可得到一个一致的映射。\n\n等参几何映射为\n$$\nx(\\xi,\\eta)=\\sum_{k=1}^9 N_k(\\xi,\\eta)\\,x_k,\\quad y(\\xi,\\eta)=\\sum_{k=1}^9 N_k(\\xi,\\eta)\\,y_k,\n$$\n其中$(x_k,y_k)$是物理节点坐标，$N_k$是$N_{ij}$的扁平化表示法。该映射的雅可比矩阵是\n$$\n\\mathbf{J}=\n\\begin{bmatrix}\n\\frac{\\partial x}{\\partial \\xi}  \\frac{\\partial x}{\\partial \\eta}\\\\\n\\frac{\\partial y}{\\partial \\xi}  \\frac{\\partial y}{\\partial \\eta}\n\\end{bmatrix}\n=\n\\begin{bmatrix}\n\\sum_k N_{k,\\xi}x_k  \\sum_k N_{k,\\eta}x_k\\\\\n\\sum_k N_{k,\\xi}y_k  \\sum_k N_{k,\\eta}y_k\n\\end{bmatrix},\\quad J(\\xi,\\eta)=\\det(\\mathbf{J}).\n$$\n映射的正则性要求在整个单元内$J(\\xi,\\eta)>0$；接近零的值表示接近奇异，并可能导致精度损失或收敛性问题。\n\n$H^1$相容的位移插值使用相同的形函数：\n$$\nu_{h,x}(\\xi,\\eta)=\\sum_{k=1}^9 N_k(\\xi,\\eta)\\,u_x(x_k,y_k),\\quad\nu_{h,y}(\\xi,\\eta)=\\sum_{k=1}^9 N_k(\\xi,\\eta)\\,u_y(x_k,y_k).\n$$\n因为基函数是节点的且为$C^0$连续，所以$u_h$在任何单元边上的限制是在相应自然坐标下的一维二次Lagrange插值，仅依赖于该边上的节点。因此，如果相邻单元共享边节点的物理坐标相同，则插值沿该边是连续的，从而保证了$H^1$相容意义下的相容性（单元间连续性）。\n\n完备性是针对在物理坐标中给定的目标多项式进行评估的：\n$$\nu_x(x,y)=1+2x+3y+\\tfrac{1}{2}x^2+xy+\\tfrac{1}{4}y^2,\\quad\nu_y(x,y)=-\\tfrac{1}{2}+x-2y+0.1x^2+0.2xy-0.3y^2.\n$$\n对于矩形单元，在从$(\\xi,\\eta)$到$(x,y)$的仿射或双线性几何映射下，$(x,y)$中的任何二次多项式都变为$(\\xi,\\eta)$中的一个二次多项式，二次Lagrange基可以精确再生该多项式；因此，在浮点舍入误差范围内，$e_{\\max}=0$。当映射是弯曲的（非仿射）时，一个二次多项式$u(x,y)$与一个非仿射映射$(x(\\xi,\\eta),y(\\xi,\\eta))$的复合会产生一个在$(\\xi,\\eta)$中次数高于2的多项式（例如，如果几何和场都是二次的，则次数为4），这个多项式不能被二次插值精确表示；因此$e_{\\max}>0$。接近奇异的雅可比行列式会放大插值误差并恶化条件数，通常会进一步增大$e_{\\max}$。\n\n我们构建三个双单元片区：\n- 用例 A（仿射/双线性）：左单元$[0,0.5]\\times[0,1]$，右单元$[0.5,1]\\times[0,1]$。该映射是双线性的且正则，因此对于二次多项式$u(x,y)$的完备性成立：$e_{\\max}\\approx 0$。由于共享边节点，相容性通过构造得以保证。\n- 用例 B（弯曲的左单元）：扰动左单元的边中点节点，使顶部和左侧边凸出，同时保持共享交界面节点固定。映射保持正则（$J>0$），但在物理坐标中的完备性丧失，因为$u(x(\\xi,\\eta),y(\\xi,\\eta))$在$(\\xi,\\eta)$中的次数超过二次，所以$e_{\\max}>0$。相容性仍然成立。\n- 用例 C（接近奇异的左单元）：使左单元的顶部和底部节点塌陷得非常靠近，导致在一个角点附近$J(\\xi,\\eta)\\approx 0$。在物理坐标中的完备性不成立（$e_{\\max}>0$），但由于边节点是公共的，共享边上的相容性仍然成立。\n\n算法步骤：\n1. 实现$i=1,2,3$时的$l_i(\\xi)$和$l_i'(\\xi)$，并构造九个二维形函数$N_k(\\xi,\\eta)$及其导数。\n2. 对于每个单元，在内部采样网格$\\mathcal{S}$上计算$(x(\\xi,\\eta),y(\\xi,\\eta))$和$J(\\xi,\\eta)$，并计算插值场$u_h(\\xi,\\eta)$和精确场$u(x(\\xi,\\eta),y(\\xi,\\eta))$以获得$e_{\\max}$。\n3. 对于每个片区，通过使用相应的$(\\xi,\\eta)$对在共享边上采样，并比较左右插值场来计算$c_{\\max}$。\n4. 对于每个用例，返回完备性的布尔值（两个单元都满足$e_{\\max}\\le\\varepsilon$）、连续性的布尔值（$c_{\\max}\\le\\delta$）以及两个单元上的最小雅可比行列式$J_{\\min}$。\n\n选定的容差为$\\varepsilon=10^{-10}$和$\\delta=10^{-12}$，这与双精度浮点数的预期一致。最终输出将三个用例的结果聚合到一个列表的列表中，每个子列表包含两个布尔值和一个浮点数，如规范所述。该实验表明：\n- 为什么在仿射/双线性映射下，对于二次场，等参二次完备性得到保证（因为复合结果仍在插值空间内）。\n- 弯曲映射如何在保持$H^1$相容性的同时，破坏了在物理坐标中的完备性。\n- 接近奇异的雅可比行列式如何标志着几何退化，这种退化会损害精度，并在实践中影响收敛性，即使界面连续性仍然由节点的$C^0$结构强制保证。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef l_basis_and_deriv(xi):\n    # 1D quadratic Lagrange basis at nodes -1, 0, 1\n    l1 = 0.5 * xi * (xi - 1.0)\n    l2 = 1.0 - xi**2\n    l3 = 0.5 * xi * (xi + 1.0)\n    dl1 = xi - 0.5\n    dl2 = -2.0 * xi\n    dl3 = xi + 0.5\n    return (np.array([l1, l2, l3]), np.array([dl1, dl2, dl3]))\n\ndef N_Q9(xi, eta):\n    l_xi, dl_xi = l_basis_and_deriv(xi)\n    l_eta, dl_eta = l_basis_and_deriv(eta)\n    # Tensor-product basis in row-major order:\n    # indices correspond to (i,j) with i,j in {0,1,2} mapped to positions:\n    # (0,0),(1,0),(2,0),(0,1),(1,1),(2,1),(0,2),(1,2),(2,2)\n    N = np.zeros(9)\n    dN_dxi = np.zeros(9)\n    dN_deta = np.zeros(9)\n    idx = 0\n    for j in range(3):\n        for i in range(3):\n            N[idx] = l_xi[i] * l_eta[j]\n            dN_dxi[idx] = dl_xi[i] * l_eta[j]\n            dN_deta[idx] = l_xi[i] * dl_eta[j]\n            idx += 1\n    return N, dN_dxi, dN_deta\n\ndef map_element(coords, xi, eta):\n    # coords shape: (9,2) for x,y of nodes in Q9 order\n    N, dN_dxi, dN_deta = N_Q9(xi, eta)\n    x = np.dot(N, coords[:,0])\n    y = np.dot(N, coords[:,1])\n    dx_dxi = np.dot(dN_dxi, coords[:,0])\n    dx_deta = np.dot(dN_deta, coords[:,0])\n    dy_dxi = np.dot(dN_dxi, coords[:,1])\n    dy_deta = np.dot(dN_deta, coords[:,1])\n    J = dx_dxi * dy_deta - dx_deta * dy_dxi\n    return x, y, J\n\ndef u_exact(x, y):\n    ux = 1.0 + 2.0*x + 3.0*y + 0.5*x**2 + x*y + 0.25*y**2\n    uy = -0.5 + 1.0*x - 2.0*y + 0.1*x**2 + 0.2*x*y - 0.3*y**2\n    return np.array([ux, uy])\n\ndef interpolate_u(coords, xi, eta, nodal_u):\n    # nodal_u shape: (9,2)\n    N, _, _ = N_Q9(xi, eta)\n    uhx = np.dot(N, nodal_u[:,0])\n    uhy = np.dot(N, nodal_u[:,1])\n    return np.array([uhx, uhy])\n\ndef element_nodal_u(coords):\n    # Evaluate exact u at physical nodal coordinates\n    nodal_u = np.zeros((9,2))\n    for k in range(9):\n        xk, yk = coords[k,0], coords[k,1]\n        nodal_u[k,:] = u_exact(xk, yk)\n    return nodal_u\n\ndef element_error_and_minJ(coords, sample_pts):\n    nodal_u = element_nodal_u(coords)\n    max_err = 0.0\n    minJ = np.inf\n    for xi, eta in sample_pts:\n        x, y, J = map_element(coords, xi, eta)\n        uh = interpolate_u(coords, xi, eta, nodal_u)\n        ue = u_exact(x, y)\n        err = np.max(np.abs(uh - ue))\n        if err > max_err:\n            max_err = err\n        if J < minJ:\n            minJ = J\n    return max_err, minJ\n\ndef edge_continuity(left_coords, right_coords, edge_pts):\n    # Compare u_h on shared vertical edge: left at xi=+1, right at xi=-1\n    nodal_u_left = element_nodal_u(left_coords)\n    nodal_u_right = element_nodal_u(right_coords)\n    max_jump = 0.0\n    for eta in edge_pts:\n        uh_left = interpolate_u(left_coords, 1.0, eta, nodal_u_left)\n        uh_right = interpolate_u(right_coords, -1.0, eta, nodal_u_right)\n        jump = np.max(np.abs(uh_left - uh_right))\n        if jump > max_jump:\n            max_jump = jump\n    return max_jump\n\ndef build_patch_case(case_id):\n    # Right element: regular rectangle on [0.5,1]x[0,1]\n    right = np.array([\n        [0.5,0.0],[0.75,0.0],[1.0,0.0],\n        [0.5,0.5],[0.75,0.5],[1.0,0.5],\n        [0.5,1.0],[0.75,1.0],[1.0,1.0]\n    ], dtype=float)\n    if case_id == 'A':\n        # Left element: regular rectangle on [0,0.5]x[0,1]\n        left = np.array([\n            [0.0,0.0],[0.25,0.0],[0.5,0.0],\n            [0.0,0.5],[0.25,0.5],[0.5,0.5],\n            [0.0,1.0],[0.25,1.0],[0.5,1.0]\n        ], dtype=float)\n    elif case_id == 'B':\n        # Left element: curved mapping, preserve shared interface nodes (indices 2,5,8)\n        left = np.array([\n            [0.0,0.0],[0.25,-0.1],[0.5,0.0],\n            [-0.1,0.5],[0.25,0.5],[0.5,0.5],\n            [0.0,1.0],[0.25,1.2],[0.5,1.0]\n        ], dtype=float)\n    elif case_id == 'C':\n        # Left element: near-singular at the left edge, preserve shared interface nodes\n        left = np.array([\n            [0.0,0.0],[0.25,0.0],[0.5,0.0],\n            [0.0,0.0005],[0.25,0.5],[0.5,0.5],\n            [0.0,0.001],[0.25,1.0],[0.5,1.0]\n        ], dtype=float)\n    else:\n        raise ValueError(\"Unknown case_id\")\n    return left, right\n\ndef solve():\n    # Define sampling points\n    grid_vals = np.linspace(-0.9, 0.9, 11)\n    sample_pts = [(xi, eta) for xi in grid_vals for eta in grid_vals]\n    edge_pts = list(grid_vals)\n\n    eps_repro = 1e-10\n    eps_cont = 1e-12\n\n    cases = ['A','B','C']\n    results = []\n    for case_id in cases:\n        left, right = build_patch_case(case_id)\n        # Element-wise error and min J\n        err_left, minJ_left = element_error_and_minJ(left, sample_pts)\n        err_right, minJ_right = element_error_and_minJ(right, sample_pts)\n        # Patch reproduction boolean\n        repro_ok = (err_left <= eps_repro) and (err_right <= eps_repro)\n        # Continuity along shared edge\n        max_jump = edge_continuity(left, right, edge_pts)\n        cont_ok = (max_jump <= eps_cont)\n        # Aggregate min J over both elements\n        minJ_patch = min(minJ_left, minJ_right)\n        results.append([repro_ok, cont_ok, float(minJ_patch)])\n\n    # Final print statement in the exact required format.\n    # Print a single line: list of per-case lists [repro_ok, cont_ok, minJ]\n    print(f\"[{','.join(str(res) for res in results)}]\")\n\nsolve()\n```", "id": "3549779"}]}