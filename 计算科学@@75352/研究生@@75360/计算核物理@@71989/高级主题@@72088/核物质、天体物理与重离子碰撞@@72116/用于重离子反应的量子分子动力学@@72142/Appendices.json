{"hands_on_practices": [{"introduction": "在量子分子动力学 (QMD) 模型中，核子质心的运动由平均场势主导，该势源于有效的核子-核子相互作用。本练习将指导您完成一个关键的推导过程：从一个类似Skyrme的能量密度泛函出发，通过泛函求导计算出作用在核子上的平均场力。掌握这一过程是理解QMD模型中动力学演化如何从底层相互作用中产生的核心 [@problem_id:3584132]。", "problem": "在重离子反应的量子分子动力学 (QMD) 描述中，单粒子平均场势源于一个依赖于局域核子密度及其梯度的有效类Skyrme能量密度泛函。考虑对称核物质，其沿着 $x$ 方向具有一维密度分布，在横向方向上是均匀的，由下式给出\n$$\\rho(x) = \\rho_{0}\\left[1 + \\delta \\tanh\\!\\left(\\frac{x}{a}\\right)\\right],$$\n其中 $\\rho_{0}$ 是饱和密度，$\\delta$ 是一个无量纲小振幅，$a$ 是一个特征弥散长度。\n\n假设相互作用能量密度是局域类Skyrme部分和表面梯度项之和，\n$$\\varepsilon(\\rho,\\nabla \\rho) = \\frac{\\alpha}{2}\\,\\frac{\\rho^{2}}{\\rho_{0}} + \\frac{\\beta}{\\gamma + 1}\\,\\frac{\\rho^{\\gamma + 1}}{\\rho_{0}^{\\gamma}} + \\frac{C_{s}}{2}\\,|\\nabla \\rho|^{2},$$\n其中 $\\alpha$、$\\beta$、$\\gamma$ 和 $C_{s}$ 是常数参数。单粒子平均场势定义为总相互作用能对 $\\rho$ 的泛函导数，对于一个带有梯度的局域泛函，这可简化为\n$$U(x) = \\frac{\\partial \\varepsilon}{\\partial \\rho}\\bigg|_{\\rho=\\rho(x)} - \\nabla \\cdot \\left(\\frac{\\partial \\varepsilon}{\\partial (\\nabla \\rho)}\\bigg|_{\\nabla \\rho=\\nabla \\rho(x)}\\right).$$\n作用在核子上的平均场力为 $-\\nabla U(x)$。忽略所有动量依赖的贡献和任何时间依赖性。\n\n仅使用这些定义和链式法则，对于上面给出的分布 $\\rho(x)$，推导平均场力的 $x$ 分量 $F_{x} = -\\partial U/\\partial x$ 在 $x=0$ 处的值的闭式表达式，用 $\\alpha$、$\\beta$、$\\gamma$、$C_{s}$、$\\rho_{0}$、$\\delta$ 和 $a$ 表示。然后，使用以下参数，对 $x=0$ 处的 $F_{x}$ 进行数值计算：\n- $\\alpha = -356$ MeV,\n- $\\beta = 303$ MeV,\n- $\\gamma = \\frac{7}{6}$,\n- $C_{s} = 30$ MeV fm$^{5}$,\n- $\\rho_{0} = 0.16$ fm$^{-3}$,\n- $\\delta = 0.3$,\n- $a = 2.0$ fm.\n\n将您关于 $F_{x}$ 的最终结果以 MeV/fm 为单位表示，并将您的答案四舍五入到三位有效数字。", "solution": "我们从给定的相互作用能量密度开始，\n$$\\varepsilon(\\rho,\\nabla \\rho) = \\frac{\\alpha}{2}\\,\\frac{\\rho^{2}}{\\rho_{0}} + \\frac{\\beta}{\\gamma + 1}\\,\\frac{\\rho^{\\gamma + 1}}{\\rho_{0}^{\\gamma}} + \\frac{C_{s}}{2}\\,|\\nabla \\rho|^{2}.$$\n对于一个带有梯度的局域泛函，单粒子平均场势由标准的欧拉-拉格朗日泛函导数给出，\n$$U(x) = \\frac{\\partial \\varepsilon}{\\partial \\rho} - \\nabla \\cdot \\left(\\frac{\\partial \\varepsilon}{\\partial (\\nabla \\rho)}\\right).$$\n我们计算这些偏导数：\n- 局域部分得到\n$$\\frac{\\partial \\varepsilon}{\\partial \\rho} = \\alpha \\frac{\\rho}{\\rho_{0}} + \\beta \\frac{\\rho^{\\gamma}}{\\rho_{0}^{\\gamma}} = \\alpha \\left(\\frac{\\rho}{\\rho_{0}}\\right) + \\beta \\left(\\frac{\\rho}{\\rho_{0}}\\right)^{\\gamma}.$$\n- 梯度项得到\n$$\\frac{\\partial \\varepsilon}{\\partial (\\nabla \\rho)} = C_{s}\\,\\nabla \\rho,$$\n因此\n$$\\nabla \\cdot \\left(\\frac{\\partial \\varepsilon}{\\partial (\\nabla \\rho)}\\right) = C_{s}\\,\\nabla \\cdot (\\nabla \\rho) = C_{s}\\,\\nabla^{2} \\rho.$$\n因此，\n$$U(x) = \\alpha \\left(\\frac{\\rho(x)}{\\rho_{0}}\\right) + \\beta \\left(\\frac{\\rho(x)}{\\rho_{0}}\\right)^{\\gamma} - C_{s}\\,\\nabla^{2} \\rho(x).$$\n在一维情况下（仅依赖于 $x$），$\\nabla \\to \\partial/\\partial x$ 且 $\\nabla^{2} \\to \\partial^{2}/\\partial x^{2}$，所以\n$$U(x) = \\alpha \\left(\\frac{\\rho(x)}{\\rho_{0}}\\right) + \\beta \\left(\\frac{\\rho(x)}{\\rho_{0}}\\right)^{\\gamma} - C_{s}\\,\\frac{\\partial^{2} \\rho(x)}{\\partial x^{2}}.$$\n力为 $-\\nabla U(x)$，在一维情况下，$x$ 分量是\n$$F_{x}(x) = -\\frac{\\partial U}{\\partial x} = -\\frac{\\mathrm{d}}{\\mathrm{d}x}\\left[\\alpha \\left(\\frac{\\rho}{\\rho_{0}}\\right) + \\beta \\left(\\frac{\\rho}{\\rho_{0}}\\right)^{\\gamma}\\right] + C_{s}\\,\\frac{\\mathrm{d}}{\\mathrm{d}x}\\left(\\frac{\\partial^{2} \\rho}{\\partial x^{2}}\\right).$$\n根据链式法则，\n$$\\frac{\\mathrm{d}}{\\mathrm{d}x}\\left[\\alpha \\left(\\frac{\\rho}{\\rho_{0}}\\right) + \\beta \\left(\\frac{\\rho}{\\rho_{0}}\\right)^{\\gamma}\\right] = \\left[\\frac{\\alpha}{\\rho_{0}} + \\frac{\\beta \\gamma}{\\rho_{0}}\\left(\\frac{\\rho}{\\rho_{0}}\\right)^{\\gamma - 1}\\right]\\frac{\\mathrm{d}\\rho}{\\mathrm{d}x}.$$\n最后一项是三阶导数，\n$$\\frac{\\mathrm{d}}{\\mathrm{d}x}\\left(\\frac{\\partial^{2} \\rho}{\\partial x^{2}}\\right) = \\frac{\\partial^{3} \\rho}{\\partial x^{3}}.$$\n因此，\n$$F_{x}(x) = -\\left[\\frac{\\alpha}{\\rho_{0}} + \\frac{\\beta \\gamma}{\\rho_{0}}\\left(\\frac{\\rho(x)}{\\rho_{0}}\\right)^{\\gamma - 1}\\right]\\frac{\\mathrm{d}\\rho(x)}{\\mathrm{d}x} + C_{s}\\,\\frac{\\partial^{3} \\rho(x)}{\\partial x^{3}}.$$\n\n我们现在对于给定的分布，在 $x=0$ 处求值，\n$$\\rho(x) = \\rho_{0}\\left[1 + \\delta \\tanh\\!\\left(\\frac{x}{a}\\right)\\right], \\quad u \\equiv \\frac{x}{a}.$$\n所需的导数是\n$$\\frac{\\mathrm{d}\\rho}{\\mathrm{d}x} = \\rho_{0}\\,\\delta\\,\\frac{1}{a}\\,\\mathrm{sech}^{2}(u),$$\n$$\\frac{\\mathrm{d}^{2}\\rho}{\\mathrm{d}x^{2}} = \\rho_{0}\\,\\delta\\,\\frac{1}{a}\\,\\frac{\\mathrm{d}}{\\mathrm{d}x}\\left[\\mathrm{sech}^{2}(u)\\right] = -2\\,\\rho_{0}\\,\\delta\\,\\frac{1}{a^{2}}\\,\\mathrm{sech}^{2}(u)\\,\\tanh(u),$$\n$$\\frac{\\mathrm{d}^{3}\\rho}{\\mathrm{d}x^{3}} = -2\\,\\rho_{0}\\,\\delta\\,\\frac{1}{a^{2}}\\,\\frac{\\mathrm{d}}{\\mathrm{d}x}\\left[\\mathrm{sech}^{2}(u)\\,\\tanh(u)\\right] = -2\\,\\rho_{0}\\,\\delta\\,\\frac{1}{a^{3}}\\left[-2\\,\\mathrm{sech}^{2}(u)\\,\\tanh^{2}(u) + \\mathrm{sech}^{4}(u)\\right].$$\n在 $x=0$ 处，我们有 $u=0$，$\\tanh(0)=0$ 和 $\\mathrm{sech}(0)=1$，所以\n$$\\rho(0) = \\rho_{0}, \\quad \\frac{\\mathrm{d}\\rho}{\\mathrm{d}x}\\bigg|_{x=0} = \\rho_{0}\\,\\delta\\,\\frac{1}{a}, \\quad \\frac{\\mathrm{d}^{3}\\rho}{\\mathrm{d}x^{3}}\\bigg|_{x=0} = -2\\,\\rho_{0}\\,\\delta\\,\\frac{1}{a^{3}}.$$\n另外，\n$$\\left(\\frac{\\rho(0)}{\\rho_{0}}\\right)^{\\gamma - 1} = 1^{\\gamma - 1} = 1.$$\n因此，\n$$F_{x}(0) = -\\left[\\frac{\\alpha}{\\rho_{0}} + \\frac{\\beta \\gamma}{\\rho_{0}}\\cdot 1\\right]\\left(\\rho_{0}\\,\\delta\\,\\frac{1}{a}\\right) + C_{s}\\left(-2\\,\\rho_{0}\\,\\delta\\,\\frac{1}{a^{3}}\\right).$$\n化简得，\n$$F_{x}(0) = -\\left[\\alpha + \\beta \\gamma\\right]\\frac{\\delta}{a} - 2\\,C_{s}\\,\\rho_{0}\\,\\frac{\\delta}{a^{3}}.$$\n\n这就是所求的闭式表达式。现在代入数值：\n- $\\alpha = -356$ MeV,\n- $\\beta = 303$ MeV,\n- $\\gamma = \\frac{7}{6}$，所以 $\\beta \\gamma = 303 \\times \\frac{7}{6} = 353.5$ MeV,\n- 因此，$\\alpha + \\beta \\gamma = -356 + 353.5 = -2.5$ MeV。\n- $\\delta = 0.3$,\n- $a = 2.0$ fm，所以 $a^{3} = 8.0$ fm$^{3}$,\n- $C_{s} = 30$ MeV fm$^{5}$,\n- $\\rho_{0} = 0.16$ fm$^{-3}$.\n\n计算两个贡献项：\n$$-\\left[\\alpha + \\beta \\gamma\\right]\\frac{\\delta}{a} = -\\left[-2.5\\right]\\frac{0.3}{2.0} = 2.5 \\times 0.15 = 0.375 \\text{ MeV/fm},$$\n$$- 2\\,C_{s}\\,\\rho_{0}\\,\\frac{\\delta}{a^{3}} = -2 \\times 30 \\times 0.16 \\times \\frac{0.3}{8.0} = -\\frac{2.88}{8.0} = -0.36 \\text{ MeV/fm}.$$\n求和得，\n$F_{x}(0) = 0.375 - 0.36 = 0.015 \\text{ MeV/fm}.$\n\n四舍五入到三位有效数字并以 MeV/fm 为单位表示，结果是 $0.0150$ MeV/fm。", "answer": "$$\\boxed{0.0150}$$", "id": "3584132"}, {"introduction": "当QMD模拟的时间演化结束后，我们得到的是所有核子在相空间中的坐标和动量。为了提取有物理意义的观测量，我们必须将这些离散的核子组合成核碎片。本练习将让您亲手实现一种标准的相空间聚类算法，通过设定空间和动量上的截断来识别碎片，这是计算碎片产额和电荷分布等关键物理量的第一步 [@problem_id:3584083]。", "problem": "要求您从第一性原理出发，实现一个在重离子反应的量子分子动力学（QMD）模拟中常用的相空间集团化程序。在该程序中（在QMD社区中通常被称为最小生成树（MST）方法），核子通过坐标空间和动量空间中的成对截断被分组为碎片。您的任务是为一个模拟中心金-金碰撞末期快照的合成数据集实现此程序，并计算碎片电荷分布。\n\n基本定义：\n- 在量子分子动力学（QMD）中，每个核子由一个质心位置矢量 $\\mathbf{r}_i$（单位为 $\\mathrm{fm}$）和一个质心动量矢量 $\\mathbf{p}_i$（单位为 $\\mathrm{MeV}/c$）表示。\n- 定义核子 $i$ 和 $j$ 之间的欧几里得空间距离为 $d_{ij} = \\lVert \\mathbf{r}_i - \\mathbf{r}_j \\rVert_2$，单位为 $\\mathrm{fm}$。\n- 定义核子 $i$ 和 $j$ 之间的欧几里得动量距离为 $\\Delta p_{ij} = \\lVert \\mathbf{p}_i - \\mathbf{p}_j \\rVert_2$，单位为 $\\mathrm{MeV}/c$。\n- 给定截断值 $R_c$ 和 $P_c$，当且仅当 $d_{ij} \\le R_c$ 且 $\\Delta p_{ij} \\le P_c$ 时，在 $i$ 和 $j$ 之间绘制一条无向边。\n- 集团（碎片）是该无向图的连通分量。\n- 每个核子都有一个类型 $t_i \\in \\{\\text{p}, \\text{n}\\}$，表示质子（$\\text{p}$）或中子（$\\text{n}$）。一个碎片 $C$ 的电荷数是 $Z(C) = \\sum_{i \\in C} \\mathbb{1}[t_i = \\text{p}]$。\n- 带电碎片的电荷分布 $P(Z)$ 定义为 $P(Z) = N_Z / N_{\\text{frag}}$，其中 $N_Z$ 是电荷为 $Z \\ge 1$ 的碎片数量，$N_{\\text{frag}}$ 是电荷 $Z \\ge 1$ 的碎片总数。电荷为 $Z=0$ 的碎片（纯中子集团）不包含在 $P(Z)$ 的计算中。如果某个测试用例中不存在带电碎片，则返回一个空列表。\n\n对所有测试用例使用以下参数：\n- 空间截断值 $R_c = 3\\,\\mathrm{fm}$。\n- 动量截断值 $P_c = 250\\,\\mathrm{MeV}/c$。\n- 边界是包含性的：$d_{ij} = R_c$ 和 $\\Delta p_{ij} = P_c$ 的核子对被视为相连。\n\n仅使用图的连通性来实现上述过程；不要使用任何能量最小化或此处定义之外的额外物理学知识。\n\n为以下每个合成测试用例计算 $P(Z)$。每个测试用例提供一个核子类型、位置（单位 $\\mathrm{fm}$）和动量（单位 $\\mathrm{MeV}/c$）的列表。位置和动量以有序三元组形式给出。您的实现必须将这些列表视为事件中所有核子的完整集合，并且不得引入任何额外的粒子。\n\n测试套件：\n- 测试用例 A（两个分离良好的碎片和一个自由中子）：\n  - 类型 $[t_i]$: $[\\text{p}, \\text{p}, \\text{p}, \\text{n}, \\text{n}, \\text{n}, \\text{p}, \\text{p}, \\text{n}, \\text{n}, \\text{n}]$。\n  - 位置 $\\mathbf{r}_i$（单位 $\\mathrm{fm}$）：\n    - 集团 1：$\\left(0.0, 0.0, 0.0\\right)$, $\\left(1.0, 0.5, 0.0\\right)$, $\\left(-0.8, -0.2, 0.3\\right)$, $\\left(0.5, -0.7, 0.2\\right)$, $\\left(-1.2, 0.6, -0.4\\right)$, $\\left(0.2, 1.0, -0.5\\right)$。\n    - 集团 2：$\\left(10.0, 0.0, 0.0\\right)$, $\\left(10.5, -0.3, 0.7\\right)$, $\\left(9.2, 0.4, -0.6\\right)$, $\\left(11.0, 0.8, 0.1\\right)$。\n    - 自由中子：$\\left(30.0, 30.0, 0.0\\right)$。\n  - 动量 $\\mathbf{p}_i$（单位 $\\mathrm{MeV}/c$）：\n    - 集团 1：$\\left(100.0, 5.0, -10.0\\right)$, $\\left(95.0, -10.0, 0.0\\right)$, $\\left(110.0, 0.0, 15.0\\right)$, $\\left(105.0, 5.0, 0.0\\right)$, $\\left(90.0, -5.0, -5.0\\right)$, $\\left(100.0, 10.0, 5.0\\right)$。\n    - 集团 2：$\\left(-50.0, 50.0, 0.0\\right)$, $\\left(-55.0, 45.0, 10.0\\right)$, $\\left(-60.0, 55.0, -5.0\\right)$, $\\left(-45.0, 40.0, 5.0\\right)$。\n    - 自由中子：$\\left(300.0, -200.0, 100.0\\right)$。\n- 测试用例 B（空间上紧凑的集合，动量上分离的核子；每对核子都违反了动量截断条件）：\n  - 类型 $[t_i]$: $[\\text{p}, \\text{p}, \\text{n}, \\text{n}]$。\n  - 位置 $\\mathbf{r}_i$（单位 $\\mathrm{fm}$）：$\\left(0.0, 0.0, 0.0\\right)$, $\\left(0.5, 0.5, 0.0\\right)$, $\\left(-0.4, 0.2, -0.1\\right)$, $\\left(0.3, -0.6, 0.2\\right)$。\n  - 动量 $\\mathbf{p}_i$（单位 $\\mathrm{MeV}/c$）：$\\left(0.0, 0.0, 0.0\\right)$, $\\left(500.0, 0.0, 0.0\\right)$, $\\left(0.0, 800.0, 0.0\\right)$, $\\left(0.0, 0.0, 1000.0\\right)$。\n- 测试用例 C（恰好在 $R_c$ 和 $P_c$ 上的边界连通性；测试包含性阈值和传递性）：\n  - 类型 $[t_i]$: $[\\text{p}, \\text{n}, \\text{p}]$。\n  - 位置 $\\mathbf{r}_i$（单位 $\\mathrm{fm}$）：$\\left(0.0, 0.0, 0.0\\right)$, $\\left(3.0, 0.0, 0.0\\right)$, $\\left(6.0, 0.0, 0.0\\right)$。\n  - 动量 $\\mathbf{p}_i$（单位 $\\mathrm{MeV}/c$）：$\\left(0.0, 0.0, 0.0\\right)$, $\\left(250.0, 0.0, 0.0\\right)$, $\\left(500.0, 0.0, 0.0\\right)$。\n- 测试用例 D（链式连通性；端点远超截断值，但通过中间体连接）：\n  - 类型 $[t_i]$: $[\\text{p}, \\text{n}, \\text{p}, \\text{n}, \\text{p}]$。\n  - 位置 $\\mathbf{r}_i$（单位 $\\mathrm{fm}$）：$\\left(0.0, 0.0, 0.0\\right)$, $\\left(2.5, 0.0, 0.0\\right)$, $\\left(5.0, 0.0, 0.0\\right)$, $\\left(7.5, 0.0, 0.0\\right)$, $\\left(10.0, 0.0, 0.0\\right)$。\n  - 动量 $\\mathbf{p}_i$（单位 $\\mathrm{MeV}/c$）：$\\left(0.0, 0.0, 0.0\\right)$, $\\left(200.0, 0.0, 0.0\\right)$, $\\left(400.0, 0.0, 0.0\\right)$, $\\left(600.0, 0.0, 0.0\\right)$, $\\left(800.0, 0.0, 0.0\\right)$。\n\n计算和输出要求：\n- 根据定义实现图，使用 $R_c = 3\\,\\mathrm{fm}$ 和 $P_c = 250\\,\\mathrm{MeV}/c$，并采用包含性不等式。\n- 对每个测试用例，计算列表 $[P(1), P(2), \\dots, P(Z_{\\max})]$，其中 $Z_{\\max}$ 是观测到的碎片电荷 $Z \\ge 1$ 的最大值。将概率表示为小数点后舍入到六位的小数。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，列表中的每个元素本身就是对应于一个测试用例的、用方括号括起来的逗号分隔列表，顺序与上述相同。例如，一个有效的输出格式是 $\\left[\\left[a,b\\right],\\left[c\\right],\\left[d,e\\right]\\right]$，其中每个符号都被替换为一个保留六位小数的十进制数。\n\n不应读取任何输入；所有数据必须在程序内定义。确保所有距离单位为 $\\mathrm{fm}$，所有动量单位为 $\\mathrm{MeV}/c$。不使用角度。概率必须以小数形式打印，而非分数。通过严格遵守上述阈值和定义来确保科学真实性。", "solution": "此问题已经过验证。\n\n### 第1步：提取给定信息\n- **定义**：\n    - 核子表示：质心位置 $\\mathbf{r}_i$（单位 $\\mathrm{fm}$），质心动量 $\\mathbf{p}_i$（单位 $\\mathrm{MeV}/c$）。\n    - 空间距离：$d_{ij} = \\lVert \\mathbf{r}_i - \\mathbf{r}_j \\rVert_2$，单位 $\\mathrm{fm}$。\n    - 动量距离：$\\Delta p_{ij} = \\lVert \\mathbf{p}_i - \\mathbf{p}_j \\rVert_2$，单位 $\\mathrm{MeV}/c$。\n    - 连通性条件：当且仅当 $d_{ij} \\le R_c$ 且 $\\Delta p_{ij} \\le P_c$ 时，核子 $i$ 和 $j$ 之间存在一条无向边。\n    - 集团（碎片）：生成的无向图的连通分量。\n    - 核子类型：$t_i \\in \\{\\text{p}, \\text{n}\\}$，代表质子或中子。\n    - 碎片电荷：$Z(C) = \\sum_{i \\in C} \\mathbb{1}[t_i = \\text{p}]$。\n    - 电荷分布：对于带电碎片（$Z \\ge 1$），$P(Z) = N_Z / N_{\\text{frag}}$，其中 $N_Z$ 是电荷为 $Z$ 的碎片数量，$N_{\\text{frag}}$ 是电荷 $Z \\ge 1$ 的碎片总数。\n- **参数**：\n    - 空间截断值 $R_c = 3\\,\\mathrm{fm}$。\n    - 动量截断值 $P_c = 250\\,\\mathrm{MeV}/c$。\n    - 边界条件：包含性（$\\le$）。\n- **测试用例**：\n    - **测试用例 A**：提供11个核子的类型、位置和动量。\n    - **测试用例 B**：提供4个核子的类型、位置和动量。\n    - **测试用例 C**：提供3个核子的类型、位置和动量。\n    - **测试用例 D**：提供5个核子的类型、位置和动量。\n- **输出要求**：\n    - 为每个测试用例计算 $[P(1), P(2), \\dots, P(Z_{\\max})]$。\n    - 概率必须是舍入到六位小数的十进制数。\n    - 最终输出是一个单行字符串，表示这些列表的列表。\n\n### 第2步：使用提取的给定信息进行验证\n根据验证标准评估问题陈述。\n\n- **科学上合理**：该问题描述了一种相空间集团化算法，这是量子分子动力学（QMD）模拟中分析核反应产物的标准技术。物理量（位置单位 $\\mathrm{fm}$，动量单位 $\\mathrm{MeV}/c$）、粒子类型（质子、中子）和概念（碎片、电荷）都是核物理的基础。指定的截断值 $R_c = 3\\,\\mathrm{fm}$ 和 $P_c = 250\\,\\mathrm{MeV}/c$ 在重离子碰撞的背景下，用于区分束缚集团和自由核子是物理上合理的。该问题在科学上是合理的。\n- **提法明确**：该问题在数学和算法上定义明确。形成图的标准是清晰的。将集团定义为连通分量是明确的。计算电荷分布 $P(Z)$ 的过程有明确规定。给定输入数据，算法是确定性的，将产生唯一的解。\n- **客观的**：问题陈述使用了精确、量化和无偏见的语言。所有定义、参数和测试数据都无歧义地提供。\n\n该问题不存在任何无效性缺陷：\n1.  **科学或事实上不合理**：它基于计算核物理中使用的一个简化但有效的模型。\n2.  **不可形式化或不相关**：该问题是一个可形式化的图论问题，并且与所述领域直接相关。\n3.  **设置不完整或矛盾**：所有必要的数据和参数（$R_c$、$P_c$ 以及每个测试用例的核子状态）都已提供。定义在内部是一致的。\n4.  **不切实际或不可行**：提供的数据是合成的，但在物理上是合理的。计算是可行的。\n5.  **提法不明确或结构不良**：存在一个唯一的、稳定的解，并由给定的算法确定。没有未定义的术语。\n6.  **伪深刻、琐碎或同义反复**：该问题需要对图遍历和数据分析进行非平凡的实现，并且测试用例旨在探究算法的不同方面（例如，边界条件、传递性）。\n7.  **超出科学可验证性**：结果是可以通过计算验证的。\n\n### 第3步：结论与行动\n该问题是**有效的**。将提供一个解决方案。\n\n### 基于原理的设计\n该问题旨在从核子的相空间分布中识别核碎片，这是一个经典的模式识别问题。其指导原则是，属于同一碎片的核子在坐标空间和动量空间中同时彼此“接近”。这一原则被形式化为一个图连通性问题。\n\n解决方案分四个阶段实施：\n\n1.  **图的构建**：将 $N$ 个核子的集合建模为无向图中的 $N$ 个顶点。相空间邻近性的核心原则被转化为邻接规则。当且仅当任意两个顶点 $i$ 和 $j$ 的空间距离 $d_{ij} = \\lVert \\mathbf{r}_i - \\mathbf{r}_j \\rVert_2$ 和动量距离 $\\Delta p_{ij} = \\lVert \\mathbf{p}_i - \\mathbf{p}_j \\rVert_2$ 满足条件 $d_{ij} \\le R_c$ 和 $\\Delta p_{ij} \\le P_c$ 时，在它们之间建立一条边。通过遍历所有 $\\binom{N}{2}$ 个唯一的核子对并应用此规则来构建邻接表。\n\n2.  **通过连通分量识别集团**：根据定义，碎片是所构建图的连通分量。采用标准的图遍历算法——深度优先搜索（DFS）——来寻找这些分量。一个大小为 $N$ 的布尔数组 `visited` 用于跟踪已分配到某个集团的核子。算法从 $i=0$ 到 $N-1$ 遍历每个核子。如果核子 $i$ 尚未被访问，则从 $i$ 开始一个新的DFS遍历。DFS系统地通过已建立的边探索所有可达的核子，将它们收集到一个 `current_cluster` 中。此集团中的所有核子都被标记为 `visited`。重复此过程，直到所有核子都分配到一个集团，从而保证所有核子的集合被划分为互不相交的子集，即碎片。\n\n3.  **碎片电荷计算**：对于每个识别出的集团（碎片），计算其总电荷数 $Z$。根据定义 $Z(C) = \\sum_{i \\in C} \\mathbb{1}[t_i = \\text{p}]$，这通过计算该集团内的质子数量来实现。\n\n4.  **电荷分布分析**：最后一步是计算碎片集合的电荷分布 $P(Z)$。根据问题定义，首先从分析中排除电荷为零的集团（$Z=0$，即纯中子集团）。剩余（带电）碎片的总数表示为 $N_{\\text{frag}}$。如果 $N_{\\text{frag}} = 0$，则分布未定义，表示为空列表。否则，对带电碎片集合中存在的每个电荷值 $Z \\ge 1$ 进行频率计数 $N_Z$。然后，每个电荷 $Z$ 的概率计算为 $P(Z) = N_Z / N_{\\text{frag}}$。结果被编译成一个列表 $[P(1), P(2), \\dots, P(Z_{\\max})]$，其中 $Z_{\\max}$ 是在碎片中观察到的最大电荷。每个概率都格式化为六位小数。\n\n这种结构化的、基于原理的方法确保了一个正确且鲁棒的实现，它将碎片的物理定义直接映射到一个定义明确的计算算法上。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a phase-space clusterization procedure for nucleons and\n    computes the fragment charge distribution for several test cases.\n    \"\"\"\n\n    # Define the global parameters from the problem statement.\n    R_c = 3.0  # Spatial cutoff in fm\n    P_c = 250.0 # Momentum cutoff in MeV/c\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test Case A\n        {\n            \"types\": ['p', 'p', 'p', 'n', 'n', 'n', 'p', 'p', 'n', 'n', 'n'],\n            \"positions\": np.array([\n                (0.0, 0.0, 0.0), (1.0, 0.5, 0.0), (-0.8, -0.2, 0.3),\n                (0.5, -0.7, 0.2), (-1.2, 0.6, -0.4), (0.2, 1.0, -0.5),\n                (10.0, 0.0, 0.0), (10.5, -0.3, 0.7), (9.2, 0.4, -0.6),\n                (11.0, 0.8, 0.1), (30.0, 30.0, 0.0)\n            ]),\n            \"momenta\": np.array([\n                (100.0, 5.0, -10.0), (95.0, -10.0, 0.0), (110.0, 0.0, 15.0),\n                (105.0, 5.0, 0.0), (90.0, -5.0, -5.0), (100.0, 10.0, 5.0),\n                (-50.0, 50.0, 0.0), (-55.0, 45.0, 10.0), (-60.0, 55.0, -5.0),\n                (-45.0, 40.0, 5.0), (300.0, -200.0, 100.0)\n            ])\n        },\n        # Test Case B\n        {\n            \"types\": ['p', 'p', 'n', 'n'],\n            \"positions\": np.array([\n                (0.0, 0.0, 0.0), (0.5, 0.5, 0.0), \n                (-0.4, 0.2, -0.1), (0.3, -0.6, 0.2)\n            ]),\n            \"momenta\": np.array([\n                (0.0, 0.0, 0.0), (500.0, 0.0, 0.0),\n                (0.0, 800.0, 0.0), (0.0, 0.0, 1000.0)\n            ])\n        },\n        # Test Case C\n        {\n            \"types\": ['p', 'n', 'p'],\n            \"positions\": np.array([\n                (0.0, 0.0, 0.0), (3.0, 0.0, 0.0), (6.0, 0.0, 0.0)\n            ]),\n            \"momenta\": np.array([\n                (0.0, 0.0, 0.0), (250.0, 0.0, 0.0), (500.0, 0.0, 0.0)\n            ])\n        },\n        # Test Case D\n        {\n            \"types\": ['p', 'n', 'p', 'n', 'p'],\n            \"positions\": np.array([\n                (0.0, 0.0, 0.0), (2.5, 0.0, 0.0), (5.0, 0.0, 0.0), \n                (7.5, 0.0, 0.0), (10.0, 0.0, 0.0)\n            ]),\n            \"momenta\": np.array([\n                (0.0, 0.0, 0.0), (200.0, 0.0, 0.0), (400.0, 0.0, 0.0), \n                (600.0, 0.0, 0.0), (800.0, 0.0, 0.0)\n            ])\n        }\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        types = case[\"types\"]\n        positions = case[\"positions\"]\n        momenta = case[\"momenta\"]\n        num_nucleons = len(types)\n        \n        # 1. Graph Construction: Build adjacency list\n        adj = {i: [] for i in range(num_nucleons)}\n        for i in range(num_nucleons):\n            for j in range(i + 1, num_nucleons):\n                d_ij = np.linalg.norm(positions[i] - positions[j])\n                dp_ij = np.linalg.norm(momenta[i] - momenta[j])\n                \n                # Check connectivity conditions (inclusive)\n                if d_ij = R_c and dp_ij = P_c:\n                    adj[i].append(j)\n                    adj[j].append(i)\n\n        # 2. Cluster Identification: Find connected components using DFS\n        clusters = []\n        visited = [False] * num_nucleons\n        for i in range(num_nucleons):\n            if not visited[i]:\n                current_cluster = []\n                stack = [i]\n                visited[i] = True\n                while stack:\n                    u = stack.pop()\n                    current_cluster.append(u)\n                    for v in adj[u]:\n                        if not visited[v]:\n                            visited[v] = True\n                            stack.append(v)\n                clusters.append(sorted(current_cluster))\n        \n        # 3. Fragment Charge Calculation\n        cluster_charges = []\n        for cluster in clusters:\n            charge = sum(1 for nucleon_idx in cluster if types[nucleon_idx] == 'p')\n            cluster_charges.append(charge)\n            \n        # 4. Charge Distribution Analysis\n        charged_fragment_charges = [z for z in cluster_charges if z > 0]\n        \n        if not charged_fragment_charges:\n            all_results.append([])\n            continue\n            \n        n_frag = len(charged_fragment_charges)\n        z_max = max(charged_fragment_charges)\n        \n        charge_counts = {}\n        for z in charged_fragment_charges:\n            charge_counts[z] = charge_counts.get(z, 0) + 1\n            \n        p_z = [0.0] * z_max\n        for z, count in charge_counts.items():\n            if z > 0:\n                p_z[z - 1] = count / n_frag\n        \n        all_results.append(p_z)\n\n    # Format the final output string as specified\n    formatted_results = []\n    for res_list in all_results:\n        formatted_list = [f\"{x:.6f}\" for x in res_list]\n        formatted_results.append(f\"[{','.join(formatted_list)}]\")\n    \n    final_output = f\"[{','.join(formatted_results)}]\"\n    print(final_output)\n\nsolve()\n```", "id": "3584083"}, {"introduction": "仅仅根据相空间中的邻近性将核子分组，并不能保证所形成的集团是物理上束缚的稳定原子核。因此，我们需要一个物理判据来验证这些候选碎片的稳定性。本练习将引导您推导一个集团的内能表达式，该能量是判断一个集团是否束缚的关键，从而为几何聚类算法找到的碎片赋予了坚实的物理基础 [@problem_id:3584137]。", "problem": "在量子分子动力学（QMD, Quantum Molecular Dynamics）中，核子由高斯波包表示，其在相空间中的质心（记为 $\\{\\mathbf{r}_i,\\mathbf{p}_i\\}_{i=1}^{A}$）根据由有效多体哈密顿量推导出的哈密顿方程演化。考虑一个在重离子反应模拟过程中识别出的由 $A$ 个核子组成的候选集团。假设基于质心可观测量进行集团验证时，采用以下物理上标准的近似：\n- 所有核子具有相等的质量 $m$。\n- 集团内势能通过对候选集团内所有核子对的有效两体相互作用 $V(|\\mathbf{r}_i-\\mathbf{r}_j|)$ 求和来计算，并忽略与候选集团外核子的相互作用。\n- 集团的内动能通过从质心动量中减去集团的质心运动来计算，即通过投影到候选集团成员之间的相对运动上来计算。\n- 与高斯宽度相关的内禀零点能和自能贡献，在集团束缚的尺度上可以忽略不计，或者已经被一致地减去，因此只有基于质心的贡献进入验证判据。\n\n从质心自由度的经典哈密顿量以及内能的定义（候选集团的总能量减去其质心动能）出发，推导一个仅用 $\\{\\mathbf{r}_i,\\mathbf{p}_i\\}_{i=1}^{A}$、核子质量 $m$ 和对势 $V(|\\mathbf{r}_i-\\mathbf{r}_j|)$ 表示的平均每核子内能 $E_{\\mathrm{int}}/A$ 的闭式解析表达式。此处，$\\mathbf{P}_{\\mathrm{cm}} \\equiv \\sum_{i=1}^{A} \\mathbf{p}_i$ 表示集团质心动量。\n\n然后，利用该表达式，阐明简单的结合能验证判据：如果集团的平均每核子内能低于 $-E_{\\mathrm{th}}$，则认为该集团是束缚的。其中，$E_{\\mathrm{th}}$ 是一个用户指定的正阈值，解释为每核子的最小结合能量级。您最终报告的结果必须是根据上述量写出的 $E_{\\mathrm{int}}/A$ 的闭式解析表达式。不要将不等式作为最终答案报告。最终表达式无需进行数值计算，也无需单位。", "solution": "问题陈述已经过验证，被认为是科学上合理、定义明确且客观的。它代表了计算核物理模拟分析中的一个标准程序。因此，我们可以着手进行推导。\n\n目标是推导一个由 $A$ 个核子组成的候选集团的平均每核子内能 $E_{\\mathrm{int}}/A$ 的解析表达式。内能定义为集团的总能量减去其质心运动的动能。我们首先根据给定的核子质心的经典哈密顿量来定义总能量。\n\n集团的总能量 $E_{\\mathrm{tot}}$ 是总动能 $T$ 和总势能 $U$ 的和。\n总动能是单个核子动能的总和。鉴于 $A$ 个核子每个的质量均为 $m$，总动能为：\n$$T = \\sum_{i=1}^{A} \\frac{\\mathbf{p}_i^2}{2m}$$\n其中 $\\mathbf{p}_i$ 是第 $i$ 个核子质心的动量。\n\n集团内势能 $U$ 由集团内所有唯一的核子对 $(i, j)$ 的有效两体相互作用 $V(|\\mathbf{r}_i - \\mathbf{r}_j|)$ 的总和给出。表达式如下：\n$$U = \\sum_{1 \\le i  j \\le A} V(|\\mathbf{r}_i - \\mathbf{r}_j|)$$\n其中 $\\mathbf{r}_i$ 是第 $i$ 个核子质心的位置。求和符号 $1 \\le i  j \\le A$ 确保每对核子只被计算一次。\n\n因此，集团的总能量为：\n$$E_{\\mathrm{tot}} = T + U = \\sum_{i=1}^{A} \\frac{\\mathbf{p}_i^2}{2m} + \\sum_{1 \\le i  j \\le A} V(|\\mathbf{r}_i - \\mathbf{r}_j|)$$\n\n接下来，我们确定与集团质心（CM）运动相关的动能。集团的总质量为 $M_{\\mathrm{tot}} = Am$。质心动量 $\\mathbf{P}_{\\mathrm{cm}}$ 在问题陈述中被定义为单个核子动量的矢量和：\n$$\\mathbf{P}_{\\mathrm{cm}} = \\sum_{i=1}^{A} \\mathbf{p}_i$$\n质心的动能由标准公式给出：\n$$T_{\\mathrm{cm}} = \\frac{\\mathbf{P}_{\\mathrm{cm}}^2}{2 M_{\\mathrm{tot}}} = \\frac{\\left(\\sum_{i=1}^{A} \\mathbf{p}_i\\right)^2}{2Am}$$\n\n集团的内能 $E_{\\mathrm{int}}$ 定义为总能量减去质心动能：\n$$E_{\\mathrm{int}} = E_{\\mathrm{tot}} - T_{\\mathrm{cm}}$$\n代入 $E_{\\mathrm{tot}}$ 和 $T_{\\mathrm{cm}}$ 的表达式：\n$$E_{\\mathrm{int}} = \\left( \\sum_{i=1}^{A} \\frac{\\mathbf{p}_i^2}{2m} + \\sum_{1 \\le i  j \\le A} V(|\\mathbf{r}_i - \\mathbf{r}_j|) \\right) - \\frac{\\left(\\sum_{i=1}^{A} \\mathbf{p}_i\\right)^2}{2Am}$$\n势能项 $U$ 只依赖于相对位置，因此不受减去质心运动的影响。内动能定义为 $T_{\\mathrm{int}} = T - T_{\\mathrm{cm}}$。\n\n问题要求的是平均每核子内能 $E_{\\mathrm{int}}/A$。我们将 $E_{\\mathrm{int}}$ 的表达式除以核子数 $A$：\n$$\\frac{E_{\\mathrm{int}}}{A} = \\frac{1}{A} \\left[ \\sum_{i=1}^{A} \\frac{\\mathbf{p}_i^2}{2m} - \\frac{\\left(\\sum_{i=1}^{A} \\mathbf{p}_i\\right)^2}{2Am} + \\sum_{1 \\le i  j \\le A} V(|\\mathbf{r}_i - \\mathbf{r}_j|) \\right]$$\n将因子 $1/A$ 分配到每一项，我们得到最终表达式：\n$$\\frac{E_{\\mathrm{int}}}{A} = \\frac{1}{2mA} \\sum_{i=1}^{A} \\mathbf{p}_i^2 - \\frac{1}{2mA^2} \\left(\\sum_{i=1}^{A} \\mathbf{p}_i\\right)^2 + \\frac{1}{A} \\sum_{1 \\le i  j \\le A} V(|\\mathbf{r}_i - \\mathbf{r}_j|)$$\n这就是仅用指定量表示的平均每核子内能的闭式解析表达式。\n\n作为任务的第二部分，我们阐明结合能判据。如果一个态的内能为负，则它是束缚的。量 $-E_{\\mathrm{int}}/A$ 可以解释为每核子的结合能量级。问题指定了一个验证判据，即该量级必须超过某个最小正阈值 $E_{\\mathrm{th}}$。这可以转化为以下条件：如果一个候选集团计算出的平均每核子内能 $E_{\\mathrm{int}}/A$ 小于该阈值的负值，则认为该集团是束缚的。数学上，这由不等式表示：\n$$\\frac{E_{\\mathrm{int}}}{A}  -E_{\\mathrm{th}}$$\n这确保了集团不仅是束缚的（具有负内能），而且其束缚强度足以满足指定的阈值。然而，问题所要求的最终答案是 $E_{\\mathrm{int}}/A$ 本身的表达式，而不是不等式。", "answer": "$$\\boxed{\\frac{1}{2mA} \\sum_{i=1}^{A} \\mathbf{p}_i^2 - \\frac{1}{2mA^2} \\left(\\sum_{i=1}^{A} \\mathbf{p}_i\\right)^2 + \\frac{1}{A} \\sum_{1 \\le i  j \\le A} V(|\\mathbf{r}_i - \\mathbf{r}_j|)}$$", "id": "3584137"}]}