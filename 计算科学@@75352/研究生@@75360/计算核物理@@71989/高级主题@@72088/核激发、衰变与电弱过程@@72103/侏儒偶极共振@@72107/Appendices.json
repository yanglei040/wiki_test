{"hands_on_practices": [{"introduction": "研究矮偶极共振的一个关键任务是量化其对总电偶极强度的贡献。本实践侧重于一项基本的数据分析技能：从给定的离散谱中计算低能态所占的能量加权求和规则（$m_1$）的份额。该练习 [@problem_id:3582897] 提供了一种直接衡量PDR重要性的方法。", "problem": "给定一个离散电偶极（$E1$）谱，由激发能 $E_{\\nu}$（单位为 $\\mathrm{MeV}$）和约化跃迁几率 $B(E1;0\\rightarrow\\nu)$（单位为 $e^{2}\\ \\mathrm{fm}^{2}$）表示。在线性响应理论中，$E1$ 强度函数可以建模为对离散态的求和，而 k 阶能量加权求和规则（记为 $m_{k}$）在离散谱上的基本定义为 $m_{k}=\\sum_{\\nu} E_{\\nu}^{k}\\, B(E1;0\\rightarrow\\nu)$。$k=1$ 的情况给出了能量加权求和规则 $m_{1}$。在截断能量 $E_{c}$ 以下，由矮偶极共振（PDR）耗尽的 $m_{1}$ 的份额，定义为能量 $E_{\\nu}\\leq E_{c}$ 的态所携带的能量加权强度与所有态的总能量加权强度之比。你的任务是仅根据这些定义，设计并实现一个计算过程，以评估该份额在几个测试谱和截断能量下的值。\n\n使用以下基本原理和定义：\n- 离散强度函数可以表示为 $S(E)=\\sum_{\\nu} B(E1;0\\rightarrow\\nu)\\,\\delta(E-E_{\\nu})$。\n- 离散谱的能量加权和 $m_{1}$ 由 $m_{1}=\\int_{0}^{\\infty} E\\,S(E)\\,dE=\\sum_{\\nu} E_{\\nu}\\, B(E1;0\\rightarrow\\nu)$ 给出。\n- 截断能量 $E_{c}$ 以下的 PDR 份额，记为 $f(E_{c})$，由比率 $f(E_{c})=\\dfrac{\\sum_{E_{\\nu}\\leq E_{c}} E_{\\nu}\\,B(E1;0\\rightarrow\\nu)}{\\sum_{\\nu} E_{\\nu}\\,B(E1;0\\rightarrow\\nu)}$ 给出。\n\n算法要求：\n- 实现一个函数，给定 $E_{\\nu}$ 和 $B(E1;0\\rightarrow\\nu)$ 的数组以及一个截断能量 $E_{c}$，使用包含条件 $E_{\\nu}\\leq E_{c}$ 计算 $f(E_{c})$。\n- 结果是无量纲的；确保程序输出浮点数值，并四舍五入到 $6$ 位小数。\n- 所有能量 $E_{\\nu}$ 的单位是 $\\mathrm{MeV}$，所有 $B(E1;0\\rightarrow\\nu)$ 值的单位是 $e^{2}\\ \\mathrm{fm}^{2}$。最终的份额 $f(E_{c})$ 没有单位。\n\n测试套件：\n为以下每组参数计算 $f(E_{c})$。每个测试用例都是一个三元组 $(\\{E_{\\nu}\\},\\{B_{\\nu}\\},E_{c})$，其中 $\\{E_{\\nu}\\}$ 是激发能列表，$\\{B_{\\nu}\\}$ 是按相同顺序对应的 $B(E1;0\\rightarrow\\nu)$ 值列表。截断能量 $E_{c}$ 的单位是 $\\mathrm{MeV}$。\n\n- 测试用例 $1$ (一般情况，包含低能 PDR 态和高能巨偶极强度)：\n  - $\\{E_{\\nu}\\}=\\{5.2,\\ 6.8,\\ 7.4,\\ 8.1,\\ 9.5,\\ 14.8,\\ 15.3,\\ 16.7,\\ 17.2\\}\\ \\mathrm{MeV}$\n  - $\\{B_{\\nu}\\}=\\{0.023,\\ 0.017,\\ 0.015,\\ 0.012,\\ 0.010,\\ 0.450,\\ 0.380,\\ 0.300,\\ 0.280\\}\\ e^{2}\\ \\mathrm{fm}^{2}$\n  - $E_{c}=10.0\\ \\mathrm{MeV}$\n- 测试用例 $2$ (边界情况，其中 $E_{c}$ 低于最小激发能)：\n  - $\\{E_{\\nu}\\}=\\{5.2,\\ 6.8,\\ 7.4,\\ 8.1,\\ 9.5,\\ 14.8,\\ 15.3,\\ 16.7,\\ 17.2\\}\\ \\mathrm{MeV}$\n  - $\\{B_{\\nu}\\}=\\{0.023,\\ 0.017,\\ 0.015,\\ 0.012,\\ 0.010,\\ 0.450,\\ 0.380,\\ 0.300,\\ 0.280\\}\\ e^{2}\\ \\mathrm{fm}^{2}$\n  - $E_{c}=4.0\\ \\mathrm{MeV}$\n- 测试用例 $3$ (边界情况，其中 $E_{c}$ 高于最大激发能)：\n  - $\\{E_{\\nu}\\}=\\{5.2,\\ 6.8,\\ 7.4,\\ 8.1,\\ 9.5,\\ 14.8,\\ 15.3,\\ 16.7,\\ 17.2\\}\\ \\mathrm{MeV}$\n  - $\\{B_{\\nu}\\}=\\{0.023,\\ 0.017,\\ 0.015,\\ 0.012,\\ 0.010,\\ 0.450,\\ 0.380,\\ 0.300,\\ 0.280\\}\\ e^{2}\\ \\mathrm{fm}^{2}$\n  - $E_{c}=25.0\\ \\mathrm{MeV}$\n- 测试用例 $4$ (边缘情况，测试当 $E_{c}$ 等于一个激发能时的包含条件以及存在零强度态的情况)：\n  - $\\{E_{\\nu}\\}=\\{4.0,\\ 6.0,\\ 10.0,\\ 12.0\\}\\ \\mathrm{MeV}$\n  - $\\{B_{\\nu}\\}=\\{0.000,\\ 0.005,\\ 0.020,\\ 0.300\\}\\ e^{2}\\ \\mathrm{fm}^{2}$\n  - $E_{c}=10.0\\ \\mathrm{MeV}$\n\n输出规范：\n- 你的程序应生成单行输出，其中包含四个测试用例的结果，形式为方括号内以逗号分隔的列表。例如，格式必须是 $[r_{1},r_{2},r_{3},r_{4}]$，其中每个 $r_{i}$ 是对应测试用例的 $f(E_{c})$ 值，四舍五入到 $6$ 位小数。", "solution": "此问题被评估为 **有效**。它在科学上基于核物理的既定原理，特别是核巨共振和求和规则理论。所提供的能量加权求和规则（$m_1$）和强度份额（$f(E_c)$）的定义是该领域的标准定义。该问题定义明确，提供了所有必要的数据、清晰的定义和一个唯一的、可计算的目标。测试用例中的数据在物理上是合理的。不存在矛盾、歧义或事实错误。\n\n目标是计算截至截断能量 $E_c$ 时，离散态所耗尽的电偶极（$E1$）能量加权求和规则（$m_1$）的份额。这个份额 $f(E_c)$ 是一个关键的可观测量，用于量化像矮偶极共振（PDR）这样的低能共振结构的强度。该问题为该计算提供了基本公式：\n$$\nf(E_{c})=\\dfrac{\\sum_{E_{\\nu}\\leq E_{c}} E_{\\nu}\\,B(E1;0\\rightarrow\\nu)}{\\sum_{\\nu} E_{\\nu}\\,B(E1;0\\rightarrow\\nu)}\n$$\n其中 $\\{E_{\\nu}\\}$ 是离散激发能的集合，$\\{B(E1;0\\rightarrow\\nu)\\}$ 是相应约化跃迁几率的集合。\n\n算法的设计直接遵循此数学定义。计算可以分解为三个主要步骤：\n\n1.  **计算总能量加权和 ($m_1$)**：表达式 $f(E_c)$ 的分母是总能量加权和，$m_1 = \\sum_{\\nu} E_{\\nu}\\,B(E1;0\\rightarrow\\nu)$。首先计算输入的能量数组 $E_{\\nu}$ 和跃迁几率数组 $B(E1;0\\rightarrow\\nu)$ 的逐元素乘积。这个结果乘积数组的所有元素之和即为总的 $m_1$。给定能量数组 $\\mathbf{E} = [E_1, E_2, \\dots, E_N]$ 和跃迁几率数组 $\\mathbf{B} = [B_1, B_2, \\dots, B_N]$，此步骤对应于计算 $\\sum_{i=1}^{N} E_i B_i$。\n\n2.  **计算截至 $E_c$ 的部分能量加权和**：分子是由能量 $E_{\\nu}$ 小于或等于截断能量 $E_c$ 的态所贡献的能量加权和部分。这被定义为 $\\sum_{E_{\\nu}\\leq E_{c}} E_{\\nu}\\,B(E1;0\\rightarrow\\nu)$。在算法上，这通过基于条件 $E_{\\nu} \\leq E_c$ 筛选态来实现。我们识别所有满足此条件的索引 $\\nu$。然后，仅对这些选定的索引求和相应的能量加权乘积 $E_{\\nu}B(E1;0\\rightarrow\\nu)$。\n\n3.  **计算份额 $f(E_c)$**：最后一步是计算部分和（来自步骤2）与总和（来自步骤1）的比率。必须考虑一个特殊情况：如果总和 $m_1$ 为零（如果所有 $B(E1)$ 值都为零，就会发生这种情况），则该分数是未定义的。然而，在任何具有 $E1$ 响应的物理系统中，$m_1 > 0$。对于所提供的测试用例，$m_1$ 严格为正。如果 $m_1=0$，分子也必须为 $0$，物理上有意义的份额结果是 $0$。实现将通过在计算出的分母为 $0$ 时返回 $0.0$ 来处理这种情况。\n\n实现将使用 `numpy` 库，该库对数组的数值运算进行了高度优化。\n- 输入的能量列表和跃迁几率列表将被转换为 `numpy` 数组，我们称之为 `E_arr` 和 `B_arr`。\n- 逐元素乘积 $E_{\\nu} B(E1;0\\rightarrow\\nu)$ 可通过 `ew_strength = E_arr * B_arr` 高效计算。\n- 总和 $m_1$ 随后就是 `np.sum(ew_strength)`。\n- 为了计算分子，创建一个布尔掩码：`mask = E_arr = E_c`。此掩码识别 `E_arr` 中满足能量截断条件的元素。\n- 然后通过将此掩码应用于 `ew_strength` 数组并对结果求和来计算部分和：`np.sum(ew_strength[mask])`。\n- 最后，计算比率并根据问题规范的要求四舍五入到 $6$ 位小数。\n\n这种方法将物理定义直接、高效且稳健地转换为计算算法。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the pygmy dipole resonance fraction problem for the given test cases.\n    \"\"\"\n\n    # Test suite from the problem statement.\n    # Each case is a tuple: (list of energies, list of B(E1) values, cutoff energy).\n    test_cases = [\n        (\n            [5.2, 6.8, 7.4, 8.1, 9.5, 14.8, 15.3, 16.7, 17.2],\n            [0.023, 0.017, 0.015, 0.012, 0.010, 0.450, 0.380, 0.300, 0.280],\n            10.0\n        ),\n        (\n            [5.2, 6.8, 7.4, 8.1, 9.5, 14.8, 15.3, 16.7, 17.2],\n            [0.023, 0.017, 0.015, 0.012, 0.010, 0.450, 0.380, 0.300, 0.280],\n            4.0\n        ),\n        (\n            [5.2, 6.8, 7.4, 8.1, 9.5, 14.8, 15.3, 16.7, 17.2],\n            [0.023, 0.017, 0.015, 0.012, 0.010, 0.450, 0.380, 0.300, 0.280],\n            25.0\n        ),\n        (\n            [4.0, 6.0, 10.0, 12.0],\n            [0.000, 0.005, 0.020, 0.300],\n            10.0\n        )\n    ]\n\n    def compute_pdr_fraction(energies, b_values, e_cutoff):\n        \"\"\"\n        Computes the fraction of the m1 sum rule up to a cutoff energy.\n\n        Args:\n            energies (list or np.ndarray): Excitation energies E_nu in MeV.\n            b_values (list or np.ndarray): Reduced transition probabilities B(E1) in e^2 fm^2.\n            e_cutoff (float): The cutoff energy E_c in MeV.\n\n        Returns:\n            float: The dimensionless fraction f(E_c).\n        \"\"\"\n        E_arr = np.array(energies)\n        B_arr = np.array(b_values)\n\n        # Calculate the energy-weighted strength for each state: E_nu * B(E1)\n        energy_weighted_strengths = E_arr * B_arr\n\n        # Calculate the total energy-weighted sum (denominator)\n        m1_total = np.sum(energy_weighted_strengths)\n\n        # If total sum rule is zero, the fraction is also zero.\n        if m1_total == 0.0:\n            return 0.0\n\n        # Create a boolean mask for states with energy = e_cutoff\n        mask = E_arr = e_cutoff\n\n        # Calculate the partial energy-weighted sum (numerator)\n        # by summing the strengths of states that satisfy the condition\n        m1_pdr = np.sum(energy_weighted_strengths[mask])\n        \n        # Compute the fraction\n        fraction = m1_pdr / m1_total\n        \n        return fraction\n\n    # Process each test case and store the formatted results\n    results = []\n    for E_nu, B_nu, E_c in test_cases:\n        result = compute_pdr_fraction(E_nu, B_nu, E_c)\n        # Format the result to 6 decimal places as required.\n        results.append(f\"{result:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3582897"}, {"introduction": "在了解了如何分析谱之后，我们现在转向从微观模型生成谱。本练习将指导您实现一个简化的准粒子随机相近似（QRPA）模型，这是描述像PDR这样的集体模式的核结构理论的基石。您将从单粒子能级和配对关联出发，从头开始构建谱 [@problem_id:3582916]。", "problem": "您的任务是基于一种与能量密度泛函观点相关的简化但自洽的方案，为与矮偶极共振相关的有限原子核的小振幅线性响应设计、实现并执行一个计算代理。物理目标是富中子核$^{68}\\mathrm{Ni}$中的低能电偶极强度，其量化为在$[5,10]$ MeV窗口内耗尽的能量加权求和规则的分数。您的实现必须是一个完整的程序，该程序能构建一个带配对的球形准粒子基，建立一个可分离的同位旋矢量电偶极剩余相互作用，求解准粒子随机相近似（QRPA）方程，并计算所要求的分数。\n\n从以下基本基础开始：\n- 在基态附近线性化的依赖时间的Hartree-Fock-Bogoliubov（TDHFB）理论产生了准粒子随机相近似（QRPA），这可以表述为针对双准粒子叠加的小振幅运动方程问题。\n- Bardeen-Cooper-Schrieffer（BCS）近似从单粒子能量和配对能隙中提供了准粒子能量和占据振幅，且满足$u^2+v^2=1$。\n- 在有限原子核中，电偶极算符必须通过质子和中子的有效电荷进行质心修正，对于同位旋矢量偶极算符，$e_p = N/A$ 和 $e_n = -Z/A$，其中$Z$是质子数，$N$是中子数，$A=Z+N$。\n- 电偶极算符的能量加权求和规则（EWSR）可以通过与哈密顿量的双对易子得到，它为集体性建立了一个全局基准，但您将直接从QRPA强度分布中计算该分数。\n\n在不使用任何外部数据的情况下，实现以下算法规范：\n1. 将原子核固定为$^{68}\\mathrm{Ni}$，因此$Z=28$，$N=40$，$A=68$。对每种粒子（质子和中子），使用一个围绕化学势为$0$的球形等间距单粒子谱，使得空穴能级的能量$\\epsilon_h0$，粒子能级的能量$\\epsilon_p0$。对于给定的能级间距$d$以及整数$L_h$和$L_p$，取\n   - 空穴能量 $\\epsilon_h = -d\\,(k-1/2)$，对于$k=1,\\dots,L_h$，\n   - 粒子能量 $\\epsilon_p = +d\\,(k-1/2)$，对于$k=1,\\dots,L_p$。\n2. 对每种粒子$s\\in\\{p,n\\}$，应用具有恒定配对能隙$\\Delta_s$的Bardeen-Cooper-Schrieffer（BCS）配对。对于每个单粒子能量$\\epsilon$，定义准粒子能量$E=\\sqrt{\\epsilon^2+\\Delta_s^2}$和占据振幅$u=\\sqrt{(1+\\epsilon/E)/2}$及$v=\\sqrt{(1-\\epsilon/E)/2}$。\n3. 通过将同种粒子的一个空穴态和一个粒子态组合成能量为$E_{2\\mathrm{qp}}=E_p+E_h$的组态，来形成双准粒子空间。为每个组态关联一个来自电偶极算符的约化矩阵元因子。使用$e_s$作为有效电荷，其中$e_p=N/A$和$e_n=-Z/A$。使用一个依赖于能量差$\\Delta\\epsilon=\\epsilon_p-\\epsilon_h$的光滑径向形状因子，即$R(\\Delta\\epsilon)=1/\\left(1+\\left(\\Delta\\epsilon/\\Lambda\\right)^2\\right)$，其中$\\Lambda$是一个正的能量标度参数。对于BCS准粒子相干性，使用标准的粒子-空穴组合因子$C_{ph}=u_p v_h - v_p u_h$。将组态的单体耦合振幅定义为$D_i=e_s\\,R(\\Delta\\epsilon)\\,C_{ph}$。\n4. 采用一种可分离的同位旋矢量偶极剩余相互作用，该相互作用在由与探针算符相同的单体场产生的道中是吸引的。在双准粒子基中，这导致QRPA矩阵具有以下形式\n   - $A_{ij}=\\delta_{ij}\\,E_{2\\mathrm{qp},i}+\\kappa_R\\,D_i D_j$，\n   - $B_{ij}=\\kappa_R\\,D_i D_j$，\n   其中$\\kappa_R$是控制集体性的正实数耦合强度。将QRPA哈密顿矩阵组装为实数$2M\\times 2M$的分块矩阵\n   $$H_{\\mathrm{QRPA}}=\\begin{pmatrix}A  B \\\\ -B  -A\\end{pmatrix},$$\n   其中$M$是双准粒子组态的数量，$A$和$B$是实数对称$M\\times M$矩阵。\n5. 求解$H_{\\mathrm{QRPA}}$的QRPA本征问题，以获得本征值$\\omega_\\nu$和本征向量$(X^{(\\nu)},Y^{(\\nu)})$。保留能量为正$\\omega_\\nu0$且虚部可忽略的本征模式（将任何小于一个很小容差的虚部分量视为数值噪声）。通过重标定本征向量来归一化每个模式，以满足$X^{T}X-Y^{T}Y=1$。\n6. 对每个QRPA模式计算约化电偶极跃迁振幅为$T_\\nu=\\sum_{i=1}^{M}D_i\\,(X_i^{(\\nu)}+Y_i^{(\\nu)})$。然后，离散约化跃迁几率为$B_\\nu = \\left|T_\\nu\\right|^2$。离散能量加权和为$m_1^{\\mathrm{(QRPA)}}=\\sum_{\\nu}\\omega_\\nu\\,B_\\nu$，在$[5,10]$ MeV窗口内的低能贡献为$m_1^{\\mathrm{(low)}}=\\sum_{\\nu,\\,\\omega_\\nu\\in[5,10]}\\omega_\\nu\\,B_\\nu$。\n7. 将所要求的分数定义为无量纲比率$f=m_1^{\\mathrm{(low)}}/m_1^{\\mathrm{(QRPA)}}$。只要在剩余相互作用和探针中都使用相同的单体场，这个分数就是普适的，与单体场的总体归一化无关。对每个测试用例，报告四舍五入到六位小数的$f$。\n\n角度单位不适用。所有能量必须以MeV表示。最终要求的结果是十进制形式的无量纲实数。\n\n测试套件：\n实施您的程序，以评估以下四个参数集的份数$f$。对于每种情况，使用$Z=28$，$N=40$，$A=68$和电偶极窗口$[5,10]$ MeV。每个元组指定$(d, L_h, L_p, \\Delta_n, \\Delta_p, \\kappa_R, \\Lambda)$，其中所有能量都以MeV为单位。\n- 情况1：$(1.5, 6, 6, 1.2, 1.0, 0.08, 5.0)$\n- 情况2：$(1.5, 6, 6, 1.2, 1.0, 0.18, 5.0)$\n- 情况3：$(2.0, 5, 5, 0.0, 0.0, 0.05, 5.0)$\n- 情况4：$(2.5, 5, 5, 0.5, 0.5, 0.00, 5.0)$\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，结果顺序与上面列出的测试用例相同，每个条目四舍五入到六位小数，例如，$[x_1,x_2,x_3,x_4]$，其中每个$x_i$是为情况$i$计算的分数$f$并四舍五入到六位小数。不应打印其他任何文本。", "solution": "该问题被评估为有效。这是一个在原子核结构物理学中适定、自洽且有科学依据的计算问题。它要求实现一个简化的准粒子随机相近似（QRPA）模型，以计算原子核$^{68}\\mathrm{Ni}$的一个特定物理可观测量，即电偶极能量加权求和规则的低能部分。该模型虽然简化，但遵循了应用于原子核的多体量子力学的基本原理。所有参数、定义和步骤都已明确提供，从而为每个测试用例导出一个唯一且可验证的解。\n\n解决方案通过执行问题陈述中详述的算法步骤来进行。\n\n1.  **原子核和模型空间设置：** 计算是针对原子核$^{68}\\mathrm{Ni}$进行的，它有$Z=28$个质子和$N=40$个中子，总共$A=Z+N=68$个核子。单粒子空间由一组质子和中子的等间距能级建模。对于给定的能级间距$d$，空穴态（在平均场基态中被占据）的能量为$\\epsilon_h = -d(k-1/2)$，其中$k=1,\\dots,L_h$，而粒子态（未被占据）的能量为$\\epsilon_p = +d(k-1/2)$，其中$k=1,\\dots,L_p$。化学势被隐式地设为零，用以区分空穴态和粒子态。\n\n2.  **准粒子变换：** 通过Bardeen-Cooper-Schrieffer (BCS) 形式主义来包含核的配对关联。对于给定种类$s \\in \\{p,n\\}$且具有配对能隙$\\Delta_s$的每个单粒子能级$\\epsilon$，我们定义一个准粒子。准粒子能量为$E = \\sqrt{\\epsilon^2 + \\Delta_s^2}$。从粒子态到准粒子态的变换涉及Bogoliubov振幅$u$和$v$，由$u = \\sqrt{(1+\\epsilon/E)/2}$和$v = \\sqrt{(1-\\epsilon/E)/2}$给出，它们满足归一化条件$u^2+v^2=1$。在没有配对的极限情况（$\\Delta_s=0$）下，一个粒子态（$\\epsilon0$）对应于$u=1, v=0$，一个空穴态（$\\epsilon0$）对应于$u=0, v=1$。\n\n3.  **双准粒子基的构建：** 系统的元激发被建模为双准粒子（2qp）组态的叠加。在这个模型中，我们只考虑粒子-空穴型双准粒子态，它们是通过组合同一种类的一个粒子态和一个空穴态形成的。这样一个双准粒子组态$i$的未扰动能量是所涉及的两个准粒子能量之和，$E_{2\\mathrm{qp},i} = E_p + E_h$。\n\n4.  **算符与相互作用：**\n    系统由同位旋矢量电偶极算符探测，其有效电荷为$e_p = N/A$和$e_n = -Z/A$，以确保赝质心运动不会对内禀激发强度产生贡献。\n    该算符与一个双准粒子组态$i$的耦合由振幅$D_i$给出。该振幅是三个因子的乘积：有效电荷$e_s$、一个依赖于粒子-空穴能隙$\\Delta\\epsilon = \\epsilon_p - \\epsilon_h$的形状因子$R(\\Delta\\epsilon) = 1/(1+(\\Delta\\epsilon/\\Lambda)^2)$，以及BCS相干因子$C_{ph} = u_p v_h - v_p u_h$，它解释了态的准粒子性质。\n    准粒子之间的剩余相互作用是描述集体运动的关键组成部分。选择了一种可分离相互作用，形式为$V = \\kappa_R \\hat{D}^\\dagger \\hat{D}$，其中$\\hat{D}$是与跃迁振幅$D_i$相关的单体算符，$\\kappa_R$是相互作用强度。这种自洽的选择（对探针和相互作用使用相同的算符）显著简化了QRPA矩阵的结构。\n\n5.  **QRPA矩阵的构建与求解：** 依赖时间的Hartree-Fock-Bogoliubov（TDHFB）方程在线性化后，会导出QRPA方程。对于可分离相互作用，这些方程可简化为一个矩阵本征值问题。QRPA矩阵在维度为$M$的双准粒子基中构建。它是一个$2M \\times 2M$的矩阵，形式如下：\n    $$H_{\\mathrm{QRPA}}=\\begin{pmatrix}A  B \\\\ -B  -A\\end{pmatrix}$$\n    这里，$A$和$B$是实数、对称的$M \\times M$矩阵，定义为：\n    $$A_{ij}=\\delta_{ij}\\,E_{2\\mathrm{qp},i}+\\kappa_R\\,D_i D_j$$\n    $$B_{ij}=\\kappa_R\\,D_i D_j$$\n    $H_{\\mathrm{QRPA}}$的本征值$\\omega_\\nu$代表了集体激发态（声子）的能量。相应的本征向量$(\\boldsymbol{X}^{(\\nu)}, \\boldsymbol{Y}^{(\\nu)})$包含了声子态中双准粒子组态的振幅。物理上有意义的解对应于实数、正的本征值$\\omega_\\nu  0$。这些物理态的本征向量根据条件$\\boldsymbol{X}^{(\\nu)T}\\boldsymbol{X}^{(\\nu)} - \\boldsymbol{Y}^{(\\nu)T}\\boldsymbol{Y}^{(\\nu)} = 1$进行归一化。该本征值问题使用标准的线性代数库进行数值求解。\n\n6.  **可观测量的计算：** 对于每个能量为$\\omega_\\nu$的集体态$\\nu$，计算约化跃迁几率$B(E1)_\\nu$。它与跃迁振幅$T_\\nu$的平方成正比，跃迁振幅由下式给出：\n    $$T_\\nu=\\sum_{i=1}^{M}D_i\\,(X_i^{(\\nu)}+Y_i^{(\\nu)})$$\n    则强度为$B_\\nu = |T_\\nu|^2$。模型内的总能量加权求和规则（EWSR）为$m_1^{\\mathrm{(QRPA)}}=\\sum_{\\nu}\\omega_\\nu\\,B_\\nu$。我们感兴趣的是该求和规则中位于低能（“矮”）区域的部分，此处定义为能量窗口$[5, 10]$ MeV。这部分的贡献是$m_1^{\\mathrm{(low)}}=\\sum_{\\nu, \\, \\omega_\\nu\\in[5,10]}\\omega_\\nu\\,B_\\nu$。最终结果是无量纲比值$f = m_1^{\\mathrm{(low)}} / m_1^{\\mathrm{(QRPA)}}$。对测试套件中提供的每个参数集重复此过程。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_fraction(d, Lh, Lp, delta_n, delta_p, kappa_R, Lambda):\n    \"\"\"\n    Calculates the pygmy dipole resonance fraction of the energy-weighted sum rule\n    based on a simplified, self-consistent QRPA model.\n\n    The function implements the step-by-step procedure outlined in the problem:\n    1. Sets up the nuclear properties and single-particle basis.\n    2. Applies BCS theory to obtain a quasiparticle basis.\n    3. Constructs the two-quasiparticle (2qp) basis and operator matrix elements.\n    4. Builds the separable QRPA matrices A and B.\n    5. Solves the QRPA eigenvalue problem.\n    6. Computes transition strengths and the energy-weighted sum rule.\n    7. Calculates the fraction of the sum rule in the specified energy window.\n    \"\"\"\n    # 1. Constants and nucleus properties\n    Z, N = 28, 40\n    A = Z + N\n    e_p, e_n = N / A, -Z / A\n    E_min, E_max = 5.0, 10.0\n\n    # 2. Single-particle spectrum generation\n    eps_h = [-d * (k - 0.5) for k in range(1, Lh + 1)]\n    eps_p = [+d * (k - 0.5) for k in range(1, Lp + 1)]\n\n    # Helper function for BCS quantities (quasiparticle energy and amplitudes)\n    def get_bcs(eps, delta):\n        if np.abs(delta)  1e-12:  # Handle the no-pairing case\n            E = np.abs(eps)\n            if eps > 0:\n                u, v = 1.0, 0.0\n            else:  # eps  0\n                u, v = 0.0, 1.0\n        else:\n            E = np.sqrt(eps**2 + delta**2)\n            # Add a small value to E in denominator to prevent division by zero if eps=0.\n            # Not strictly necessary here since eps is never zero.\n            u = np.sqrt(0.5 * (1 + eps / (E + 1e-15)))\n            v = np.sqrt(0.5 * (1 - eps / (E + 1e-15)))\n        return E, u, v\n\n    # 3. Two-quasiparticle basis construction\n    configs = []\n    \n    # Proton 2qp configurations\n    for ep_val in eps_p:\n        for eh_val in eps_h:\n            Ep, up, vp = get_bcs(ep_val, delta_p)\n            Eh, uh, vh = get_bcs(eh_val, delta_p)\n            \n            E2qp = Ep + Eh\n            delta_eps = ep_val - eh_val\n            R = 1.0 / (1.0 + (delta_eps / Lambda)**2)\n            Cph = up * vh - vp * uh\n            D_i = e_p * R * Cph\n            configs.append({'E2qp': E2qp, 'D': D_i})\n\n    # Neutron 2qp configurations\n    for ep_val in eps_p:\n        for eh_val in eps_h:\n            Ep, up, vp = get_bcs(ep_val, delta_n)\n            Eh, uh, vh = get_bcs(eh_val, delta_n)\n            \n            E2qp = Ep + Eh\n            delta_eps = ep_val - eh_val\n            R = 1.0 / (1.0 + (delta_eps / Lambda)**2)\n            Cph = up * vh - vp * uh\n            D_i = e_n * R * Cph\n            configs.append({'E2qp': E2qp, 'D': D_i})\n    \n    M = len(configs)\n    if M == 0:\n        return 0.0\n\n    # 4. QRPA matrices A and B\n    E2qp_vec = np.array([c['E2qp'] for c in configs])\n    D_vec = np.array([c['D'] for c in configs])\n    \n    A = np.diag(E2qp_vec) + kappa_R * np.outer(D_vec, D_vec)\n    B = kappa_R * np.outer(D_vec, D_vec)\n\n    # 5. QRPA Hamiltonian solution\n    H_qrpa = np.block([[A, B], [-B, -A]])\n    eigvals, eigvecs = np.linalg.eig(H_qrpa)\n\n    # 6. Compute strength distribution\n    strength_dist = []\n    tolerance = 1e-9\n    for i in range(2 * M):\n        omega = eigvals[i]\n        \n        # Filter for physical solutions (positive real energy)\n        if np.real(omega) > tolerance and np.abs(np.imag(omega))  tolerance:\n            omega_real = np.real(omega)\n            \n            # Eigenvectors for real eigenvalues of real matrices can be chosen as real\n            vec = np.real(eigvecs[:, i])\n            X = vec[:M]\n            Y = vec[M:]\n            \n            # Normalization condition for QRPA modes\n            norm_sq = X.T @ X - Y.T @ Y\n            \n            if norm_sq > tolerance:\n                norm_factor = 1.0 / np.sqrt(norm_sq)\n                X_norm = X * norm_factor\n                Y_norm = Y * norm_factor\n                \n                # Transition amplitude and strength\n                T_nu = D_vec.T @ (X_norm + Y_norm)\n                B_nu = T_nu**2\n                strength_dist.append((omega_real, B_nu))\n\n    # 7. Calculate the fraction of the EWSR in the specified window\n    m1_total = sum(w * b for w, b in strength_dist)\n    m1_low = sum(w * b for w, b in strength_dist if E_min = w = E_max)\n\n    if m1_total  1e-12:  # Avoid division by zero for cases with no strength\n        return 0.0\n        \n    fraction = m1_low / m1_total\n    return fraction\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (d, Lh, Lp, delta_n, delta_p, kappa_R, Lambda)\n        (1.5, 6, 6, 1.2, 1.0, 0.08, 5.0),\n        (1.5, 6, 6, 1.2, 1.0, 0.18, 5.0),\n        (2.0, 5, 5, 0.0, 0.0, 0.05, 5.0),\n        (2.5, 5, 5, 0.5, 0.5, 0.00, 5.0)\n    ]\n\n    results = []\n    for case in test_cases:\n        d, Lh, Lp, delta_n, delta_p, kappa_R, Lambda = case\n        fraction = calculate_fraction(d, Lh, Lp, delta_n, delta_p, kappa_R, Lambda)\n        results.append(f\"{fraction:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n\n```", "id": "3582916"}, {"introduction": "任何可靠的理论计算都必须与基本的物理定律保持一致。这最后一个实践介绍了一种关键的验证技术：根据与模型无关的Thomas-Reiche-Kuhn（TRK）能量加权求和规则来检验计算出的谱。通过实施这一检验 [@problem_id:3582935]，您将学习如何验证您的理论模型是否正确地捕捉了系统的总集体强度。", "problem": "您正在使用能量加权求和规则，验证一个用于侏儒偶极共振 (PDR) 和同位旋矢量巨偶极共振 (GDR) 响应的准粒子随机相位近似 (QRPA) 实现。从线性响应的定义出发，离散跃迁强度的能量加权和是强度函数的一阶矩，定义为 $m_1 = \\sum_i E_i B_i$，其中 $E_i$ 是激发能，$B_i$ 是约化电偶极跃迁概率。同位旋矢量电偶极能量加权和的解析基准值，由双对易子求和规则导出，是考虑了速度依赖项增强效应的 Thomas-Reiche-Kuhn (TRK) 值，由 $m_1^{\\mathrm{TRK}} = \\frac{9}{4\\pi} \\frac{\\hbar^2}{2 m_N} \\frac{N Z}{A} (1 + \\kappa)$ 给出。此处，$\\hbar^2/(2 m_N)$ 是一个关于核子质量的标准常数，而 $\\kappa$ 是一个源于所选能量密度泛函的无量纲增强因子。\n\n实现一个程序，该程序能够：\n- 从提供的类 QRPA 状态列表中计算离散的能量加权和 $m_1 = \\sum_i E_i B_i$。\n- 使用 $m_1^{\\mathrm{TRK}} = \\frac{9}{4\\pi} \\frac{\\hbar^2}{2 m_N} \\frac{N Z}{A} (1 + \\kappa)$ 计算同一原子核的解析基准值 $m_1^{\\mathrm{TRK}}$，其中 $\\hbar^2/(2 m_N) = 20.735$，单位为 MeV fm$^2$。\n- 使用指定的容差比较这两个值，并输出一个布尔值，以指示计算出的 $m_1$ 是否在 $m_1^{\\mathrm{TRK}}$ 的允许偏差范围内。\n\n科学和数值细节及要求：\n- 所有激发能 $E_i$ 必须以 MeV 为单位提供。\n- 所有约化跃迁概率 $B_i$ 必须以 $e^2\\,\\mathrm{fm}^2$ 为单位提供。\n- 因此，求和结果 $m_1$ 的单位是 $e^2\\,\\mathrm{fm}^2\\,\\mathrm{MeV}$。\n- 容差是一个相对界限 $\\delta$；对于 $m_1^{\\mathrm{TRK}}  0$ 的情况，如果满足 $\\lvert m_1 - m_1^{\\mathrm{TRK}} \\rvert \\le \\delta\\, m_1^{\\mathrm{TRK}}$，则测试通过。对于 $m_1^{\\mathrm{TRK}} = 0$ 的情况，使用绝对容差 $\\epsilon$，并要求 $\\lvert m_1 \\rvert \\le \\epsilon$。\n\n使用以下原子核和离散态集的测试套件。每个测试用例是一个元组 $(N,Z,A,\\kappa,\\{E_i\\},\\{B_i\\})$，容差参数为 $\\delta = 0.05$ 和 $\\epsilon = 10^{-9}$：\n\n1. 情况 A (理想路径，近乎完备的集合)：$N=82$，$Z=50$，$A=132$，$\\kappa=0.2$，$E=\\,[7.8,\\,8.5,\\,9.2,\\,14.5,\\,15.8,\\,17.2,\\,18.5,\\,20.0]$，$B=\\,[0.35,\\,0.40,\\,0.45,\\,6.0,\\,8.0,\\,7.5,\\,5.0,\\,5.4171]$。\n2. 情况 B (收集不足，模型空间不完备)：$N=40$，$Z=28$，$A=68$，$\\kappa=0.25$，$E=\\,[7.7,\\,8.2,\\,9.0,\\,15.0,\\,16.5,\\,18.0]$，$B=\\,[0.5,\\,0.6,\\,0.4,\\,6.0,\\,6.5,\\,4.0]$。\n3. 情况 C (收集过度，存在污染或重复计算)：$N=126$，$Z=82$，$A=208$，$\\kappa=0.1$，$E=\\,[7.5,\\,8.0,\\,8.6,\\,13.0,\\,14.8,\\,16.2,\\,17.5]$，$B=\\,[0.2,\\,0.3,\\,0.35,\\,14.0,\\,16.0,\\,15.0,\\,13.0]$。\n4. 情况 D (基准值为零，无同位旋矢量 E1 和)：$N=0$，$Z=1$，$A=1$，$\\kappa=0.0$，$E=\\,[\\,]$ (空列表)，$B=\\,[\\,]$ (空列表)。\n5. 情况 E (近乎完备的集合，但有少量缺失)：$N=70$，$Z=50$，$A=120$，$\\kappa=0.2$，$E=\\,[7.9,\\,8.3,\\,9.1,\\,14.2,\\,15.7,\\,17.0,\\,18.3,\\,19.2]$，$B=\\,[0.4,\\,0.45,\\,0.5,\\,5.5,\\,7.0,\\,6.5,\\,4.5,\\,6.0]$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按上述情况的顺序显示结果。每个元素都是一个布尔值，指示该情况是否通过验证，例如 $[\\mathrm{True},\\mathrm{False},\\mathrm{True}]$。", "solution": "该验证方法基于从线性响应理论和双对易子恒等式导出的能量加权求和规则。对于一个算符 $F$ 和哈密顿量 $H$，存在一个普适的恒等式\n$$\nm_1(F) = \\frac{1}{2} \\langle 0 | [F,[H,F]] | 0 \\rangle,\n$$\n其中 $|0\\rangle$ 表示基态。在强度函数的离散谱表示中，一阶能量加权求和规则为\n$$\nm_1 = \\sum_i E_i B_i,\n$$\n其中 $E_i$ 是激发能，$B_i$ 是约化跃迁概率，两者都从准粒子随机相位近似 (QRPA) 计算中提取。\n\n对于与原子核中偶极响应相关的同位旋矢量电偶极算符，其解析基准是 Thomas-Reiche-Kuhn (TRK) 求和规则。在具有动能哈密顿量的独立粒子模型中，双对易子得出的是没有增强效应的 TRK 和。然而，在包含速度依赖项和交换项的现实能量密度泛函中，该和值会受到一个因子 $(1+\\kappa)$ 的增强，其中 $\\kappa$ 是一个概括了这些额外贡献的无量纲参数。由此产生的解析基准值为\n$$\nm_1^{\\mathrm{TRK}} = \\frac{9}{4\\pi} \\frac{\\hbar^2}{2 m_N} \\frac{N Z}{A} (1 + \\kappa).\n$$\n常数 $\\hbar^2/(2 m_N)$ 是一个关于核子质量的著名值，在实际计算中取为 $\\hbar^2/(2 m_N) = 20.735$，单位为 MeV fm$^2$，这样当 $B_i$ 的单位为 $e^2\\,\\mathrm{fm}^2$ 且 $E_i$ 的单位为 MeV 时，$m_1^{\\mathrm{TRK}}$ 的单位就是 $e^2\\,\\mathrm{fm}^2\\,\\mathrm{MeV}$。\n\n程序的算法步骤：\n1. 对于每个测试用例 $(N,Z,A,\\kappa,\\{E_i\\},\\{B_i\\})$，计算\n$$\nm_1 = \\sum_i E_i B_i.\n$$\n2. 计算解析基准值\n$$\nm_1^{\\mathrm{TRK}} = \\frac{9}{4\\pi} \\cdot \\left( \\frac{\\hbar^2}{2 m_N} \\right) \\cdot \\left( \\frac{N Z}{A} \\right) \\cdot (1 + \\kappa),\n$$\n其中 $\\frac{\\hbar^2}{2 m_N} = 20.735$ MeV fm$^2$。\n3. 应用通过/失败判据。对于 $m_1^{\\mathrm{TRK}}  0$ 的情况，使用相对容差 $\\delta = 0.05$：\n$$\n\\text{如果 } \\lvert m_1 - m_1^{\\mathrm{TRK}} \\rvert \\le \\delta\\, m_1^{\\mathrm{TRK}} \\text{ 则通过}。\n$$\n对于 $m_1^{\\mathrm{TRK}} = 0$ 的情况，使用绝对容差 $\\epsilon = 10^{-9}$：\n$$\n\\text{如果 } \\lvert m_1 \\rvert \\le \\epsilon \\text{ 则通过}。\n$$\n\n与侏儒偶极共振 (PDR) 相关的科学原理：\n- PDR 表现为低能偶极强度，通常碎裂分布在主 GDR 峰之下。在 QRPA 中，这通过具有较小 $B(E1)$ 值的低能离散跃迁来捕捉。能量加权和 $m_1$ 收集了来自 PDR 和 GDR 两个区域的贡献。\n- 当组态空间和剩余相互作用足够时，一个良好实现的 QRPA 应该能在合理的容差范围内恢复 TRK 求和规则（带有适当的 $(1+\\kappa)$ 增强）。收集不足表明缺少组态或模型空间不足；收集过度则表明存在污染，如质心赝能或重复计算。\n\n对所提供测试套件的合理性检查：\n- 情况 A ($N=82$, $Z=50$, $A=132$, $\\kappa=0.2$)：离散列表包含类 PDR 的低能跃迁和若干类 GDR 的跃迁，其选择使得 $m_1$ 非常接近 $m_1^{\\mathrm{TRK}}$，因此预计会通过。\n- 情况 B ($N=40$, $Z=28$, $A=68$, $\\kappa=0.25$)：离散和被有意设置得低于基准值（大约有几个百分点的缺失），在 $\\delta = 0.05$ 的条件下预计会失败。\n- 情况 C ($N=126$, $Z=82$, $A=208$, $\\kappa=0.1$)：离散和被有意设置得高于基准值（收集过度），预计会失败。\n- 情况 D ($N=0$, $Z=1$, $A=1$, $\\kappa=0.0$)：由于 $\\frac{N Z}{A} = 0$，基准值为零，并且离散谱为空，得出 $m_1 = 0$，在绝对容差下预计会通过。\n- 情况 E ($N=70$, $Z=50$, $A=120$, $\\kappa=0.2$)：离散和略低于基准值，但在 5% 的相对容差范围内，预计会通过。\n\n程序按顺序输出一行布尔值列表，指示情况 A 到 E 的通过/失败。这直接将针对带增强的 TRK 基准的 QRPA 实现的能量加权求和规则验证操作化了。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_m1_discrete(energies, strengths):\n    # Energies in MeV, strengths in e^2 fm^2; result in e^2 fm^2 MeV\n    if len(energies) == 0:\n        return 0.0\n    e = np.array(energies, dtype=float)\n    b = np.array(strengths, dtype=float)\n    return float(np.dot(e, b))\n\ndef compute_m1_trk(N, Z, A, kappa):\n    # m1_TRK = (9/(4*pi)) * (hbar^2/(2 m_N)) * (N*Z/A) * (1 + kappa)\n    if A == 0:\n        return 0.0\n    hbar2_over_2mN = 20.735  # MeV fm^2\n    prefactor = 9.0 / (4.0 * np.pi)\n    return float(prefactor * hbar2_over_2mN * (N * Z / A) * (1.0 + kappa))\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (N, Z, A, kappa, energies_list, strengths_list)\n    test_cases = [\n        # Case A: 132Sn, near-complete collection\n        (82, 50, 132, 0.2,\n         [7.8, 8.5, 9.2, 14.5, 15.8, 17.2, 18.5, 20.0],\n         [0.35, 0.40, 0.45, 6.0, 8.0, 7.5, 5.0, 5.4171]),\n        # Case B: 68Ni, under-collection\n        (40, 28, 68, 0.25,\n         [7.7, 8.2, 9.0, 15.0, 16.5, 18.0],\n         [0.5, 0.6, 0.4, 6.0, 6.5, 4.0]),\n        # Case C: 208Pb, over-collection\n        (126, 82, 208, 0.1,\n         [7.5, 8.0, 8.6, 13.0, 14.8, 16.2, 17.5],\n         [0.2, 0.3, 0.35, 14.0, 16.0, 15.0, 13.0]),\n        # Case D: 1H, zero TRK benchmark, empty spectrum\n        (0, 1, 1, 0.0,\n         [], []),\n        # Case E: 120Sn, small deficit within tolerance\n        (70, 50, 120, 0.2,\n         [7.9, 8.3, 9.1, 14.2, 15.7, 17.0, 18.3, 19.2],\n         [0.4, 0.45, 0.5, 5.5, 7.0, 6.5, 4.5, 6.0]),\n    ]\n\n    # Tolerances\n    rel_tol = 0.05  # relative tolerance for nonzero TRK\n    abs_tol = 1e-9  # absolute tolerance for zero TRK\n\n    results = []\n    for (N, Z, A, kappa, energies, strengths) in test_cases:\n        m1_disc = compute_m1_discrete(energies, strengths)\n        m1_trk = compute_m1_trk(N, Z, A, kappa)\n        if m1_trk > 0.0:\n            passes = abs(m1_disc - m1_trk) = rel_tol * m1_trk\n        else:\n            passes = abs(m1_disc) = abs_tol\n        results.append(passes)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, [r.lower() if isinstance(r, bool) else r for r in results]))}]\")\n\nsolve()\n```", "id": "3582935"}]}