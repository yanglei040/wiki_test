{"hands_on_practices": [{"introduction": "在任何基于图的分析中，第一步都是将图的拓扑结构转化为精确的数学对象。本练习将引导你完成这一基本过程，即构建图拉普拉斯算子 $L$，这是一个核心算子，它编码了节点的连通性以及边的权重信息。熟练掌握从图的 incidence matrix $B$ 和权重矩阵 $W$ 出发计算 $L = B^{\\top} W B$ 的方法，是理解如图形LASSO和图总变分等更高级模型不可或缺的基础。[@problem_id:3478305]", "problem": "考虑一个无向加权图，有三个标记为$1$、$2$和$3$的节点，边$(1,2)$的权重为$2$，边$(2,3)$的权重为$1$。选择任意边的方向来定义关联矩阵，例如，将$(1,2)$定向为$1 \\to 2$，将$(2,3)$定向为$2 \\to 3$。令$B \\in \\mathbb{R}^{2 \\times 3}$表示有向关联矩阵，其第$e$行在源节点处为$+1$，在汇节点处为$-1$，其他位置为零。令$W \\in \\mathbb{R}^{2 \\times 2}$为边权重的对角矩阵，其元素$W_{ee}$等于边$e$的权重。加权图拉普拉斯矩阵由基本关系$L = B^{\\top} W B$定义。\n\n这种基于图的算子在通过全变分正则化进行图上的稀疏恢复中起着核心作用，其中图差分算子$B$编码了边差分的稀疏性；在图形最小绝对收缩和选择算子（Graphical LASSO）中，拉普拉斯结构的精度矩阵导致似然项涉及$L$的伪行列式（其非零特征值的乘积）。\n\n任务：\n- 根据给定的图和方向，使用上述基本定义显式地构造$B$和$L$。\n- 计算$L$的所有特征值和相应的特征向量。\n- 使用$L$的谱分解，计算$L$的伪行列式，定义为所有非零特征值的乘积。\n\n将$L$的伪行列式的值作为您的最终答案。不需要四舍五入，也不需要报告单位。中间步骤必须如上所述从第一性原理得到充分证明。", "solution": "本问题要求计算加权图拉普拉斯矩阵$L$的伪行列式。解题过程分为三步：首先，根据给定的图结构和定义构造拉普拉斯矩阵$L$；其次，计算$L$的特征值；第三，将伪行列式计算为非零特征值的乘积。\n\n首先，我们根据问题陈述构造必要的矩阵。该图有三个节点，我们标记为$\\{1, 2, 3\\}$，以及两条边。边为$e_1 = (1,2)$，权重$w_1 = 2$，以及$e_2 = (2,3)$，权重$w_2 = 1$。问题为定义关联矩阵指定了边的方向：第一条边为$1 \\to 2$，第二条边为$2 \\to 3$。\n\n有向关联矩阵$B \\in \\mathbb{R}^{2 \\times 3}$的行对应于边，列对应于节点。对于从节点$u$定向到节点$v$的边，对应的行在$u$的列中为$+1$，在$v$的列中为$-1$。\n对于边$e_1: 1 \\to 2$，$B$的第一行为$\\begin{pmatrix} 1  -1  0 \\end{pmatrix}$。\n对于边$e_2: 2 \\to 3$，$B$的第二行为$\\begin{pmatrix} 0  1  -1 \\end{pmatrix}$。\n合并这些行得到关联矩阵：\n$$\nB = \\begin{pmatrix} 1  -1  0 \\\\ 0  1  -1 \\end{pmatrix}\n$$\n$B$的转置是：\n$$\nB^{\\top} = \\begin{pmatrix} 1  0 \\\\ -1  1 \\\\ 0  -1 \\end{pmatrix}\n$$\n权重矩阵$W \\in \\mathbb{R}^{2 \\times 2}$是包含边权重的对角矩阵。权重为$w_1 = 2$和$w_2 = 1$。\n$$\nW = \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix}\n$$\n加权图拉普拉斯矩阵$L$定义为$L = B^{\\top} W B$。我们计算这个乘积：\n首先，我们计算$W B$：\n$$\nW B = \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} 1  -1  0 \\\\ 0  1  -1 \\end{pmatrix} = \\begin{pmatrix} 2  -2  0 \\\\ 0  1  -1 \\end{pmatrix}\n$$\n接下来，我们计算$L = B^{\\top} (W B)$：\n$$\nL = B^{\\top} (W B) = \\begin{pmatrix} 1  0 \\\\ -1  1 \\\\ 0  -1 \\end{pmatrix} \\begin{pmatrix} 2  -2  0 \\\\ 0  1  -1 \\end{pmatrix} = \\begin{pmatrix} (1)(2) + (0)(0)  (1)(-2) + (0)(1)  (1)(0) + (0)(-1) \\\\ (-1)(2) + (1)(0)  (-1)(-2) + (1)(1)  (-1)(0) + (1)(-1) \\\\ (0)(2) + (-1)(0)  (0)(-2) + (-1)(1)  (0)(0) + (-1)(-1) \\end{pmatrix}\n$$\n$$\nL = \\begin{pmatrix} 2  -2  0 \\\\ -2  3  -1 \\\\ 0  -1  1 \\end{pmatrix}\n$$\n这就完成了构造$B$和$L$的第一个任务。\n\n第二个任务是计算$L$的特征值和特征向量。特征值$\\lambda$是特征方程$\\det(L - \\lambda I) = 0$的根，其中$I$是$3 \\times 3$的单位矩阵。\n$$\nL - \\lambda I = \\begin{pmatrix} 2-\\lambda  -2  0 \\\\ -2  3-\\lambda  -1 \\\\ 0  -1  1-\\lambda \\end{pmatrix}\n$$\n我们计算行列式：\n$$\n\\det(L - \\lambda I) = (2-\\lambda) \\begin{vmatrix} 3-\\lambda  -1 \\\\ -1  1-\\lambda \\end{vmatrix} - (-2) \\begin{vmatrix} -2  -1 \\\\ 0  1-\\lambda \\end{vmatrix}\n$$\n$$\n= (2-\\lambda)((3-\\lambda)(1-\\lambda) - 1) + 2((-2)(1-\\lambda) - 0)\n$$\n$$\n= (2-\\lambda)(\\lambda^2 - 4\\lambda + 3 - 1) + 2(-2 + 2\\lambda)\n$$\n$$\n= (2-\\lambda)(\\lambda^2 - 4\\lambda + 2) - 4 + 4\\lambda\n$$\n$$\n= 2\\lambda^2 - 8\\lambda + 4 - \\lambda^3 + 4\\lambda^2 - 2\\lambda - 4 + 4\\lambda\n$$\n$$\n= -\\lambda^3 + 6\\lambda^2 - 6\\lambda\n$$\n将特征多项式设为零以求特征值：\n$$\n-\\lambda^3 + 6\\lambda^2 - 6\\lambda = 0\n$$\n$$\n-\\lambda(\\lambda^2 - 6\\lambda + 6) = 0\n$$\n一个特征值立即被确定为$\\lambda_1 = 0$。这对于连通图的拉普拉斯矩阵是预期的；对应的特征向量是全一向量，$v_1 = \\begin{pmatrix} 1  1  1 \\end{pmatrix}^{\\top}$，因为$L$的行和均为零。\n\n另外两个特征值是二次方程$\\lambda^2 - 6\\lambda + 6 = 0$的根。使用二次公式$\\lambda = \\frac{-b \\pm \\sqrt{b^2-4ac}}{2a}$：\n$$\n\\lambda = \\frac{6 \\pm \\sqrt{(-6)^2 - 4(1)(6)}}{2(1)} = \\frac{6 \\pm \\sqrt{36 - 24}}{2} = \\frac{6 \\pm \\sqrt{12}}{2}\n$$\n由于$\\sqrt{12} = \\sqrt{4 \\times 3} = 2\\sqrt{3}$，特征值为：\n$$\n\\lambda = \\frac{6 \\pm 2\\sqrt{3}}{2} = 3 \\pm \\sqrt{3}\n$$\n所以，$L$的三个特征值是$\\lambda_1 = 0$，$\\lambda_2 = 3 - \\sqrt{3}$和$\\lambda_3 = 3 + \\sqrt{3}$。\n为完整起见，相应的特征向量是$v_1 = \\begin{pmatrix} 1  1  1 \\end{pmatrix}^{\\top}$，$v_2 = \\begin{pmatrix} 1-\\sqrt{3}  \\sqrt{3}-2  1 \\end{pmatrix}^{\\top}$和$v_3 = \\begin{pmatrix} 1+\\sqrt{3}  -2-\\sqrt{3}  1 \\end{pmatrix}^{\\top}$。\n\n最后一个任务是计算$L$的伪行列式，它被定义为所有非零特征值的乘积。非零特征值是$\\lambda_2 = 3 - \\sqrt{3}$和$\\lambda_3 = 3 + \\sqrt{3}$。\n伪行列式，记作$\\det^+(L)$，是：\n$$\n\\det^+(L) = \\lambda_2 \\times \\lambda_3 = (3 - \\sqrt{3})(3 + \\sqrt{3})\n$$\n使用平方差公式$(a-b)(a+b) = a^2 - b^2$：\n$$\n\\det^+(L) = 3^2 - (\\sqrt{3})^2 = 9 - 3 = 6\n$$\n图拉普拉斯矩阵$L$的伪行列式是$6$。", "answer": "$$\\boxed{6}$$", "id": "3478305"}, {"introduction": "在掌握了图的基本矩阵表示之后，我们进一步探索如何利用这些工具从数据中学习图的结构。本练习将通过一个简洁的2节点案例，引导你从第一性原理出发，推导出图形LASSO（Graphical LASSO）的解析解。通过运用次梯度最优性条件，你将深刻理解 $\\ell_1$ 惩罚项是如何精确地诱导稀疏性，从而帮助我们识别变量间的条件独立结构。[@problem_id:3478302]", "problem": "考虑一个零均值高斯图模型，其精度矩阵 $\\Theta \\in \\mathbb{S}_{++}^{2}$ 和样本协方差矩阵 $S \\in \\mathbb{S}_{++}^{2}$ 由下式给出\n$$\nS \\;=\\; \\begin{pmatrix} s_{11}  s_{12} \\\\ s_{12}  s_{22} \\end{pmatrix},\n$$\n其中 $s_{11}  0$，$s_{22}  0$，且 $s_{11} s_{22} - s_{12}^{2}  0$。图最小绝对收缩和选择算子 (Graphical LASSO) 估计量 $\\hat{\\Theta}$ 被定义为以下凸优化问题的解\n$$\n\\min_{\\Theta \\in \\mathbb{S}_{++}^{2}} \\; \\Big\\{ -\\ln \\det(\\Theta) + \\operatorname{tr}(S \\Theta) + \\lambda \\sum_{i \\neq j} |\\theta_{ij}| \\Big\\},\n$$\n其中 $\\ell_{1}$ 惩罚仅应用于非对角元素，$\\lambda \\geq 0$，且 $\\mathbb{S}_{++}^{2}$ 表示 $2 \\times 2$ 对称正定矩阵锥。\n\n仅使用第一性原理，包括目标函数的定义、矩阵对数和迹的基本性质，以及非光滑凸函数的次梯度最优性条件，对 $p=2$ 的情况执行以下操作：\n- 将 $\\Theta$ 参数化为 $\\Theta = \\begin{pmatrix} a  b \\\\ b  c \\end{pmatrix}$，其中 $a0$，$c0$，且 $ac - b^{2}  0$。\n- 推导一阶最优性和次梯度条件，并用 $s_{11}$、$s_{12}$、$s_{22}$ 和 $\\lambda$ 显式地求解最优解 $\\hat{\\Theta}$。\n- 确定最小的惩罚水平 $\\lambda_{\\mathrm{th}}$（作为 $S$ 的函数），使得对于所有 $\\lambda \\geq \\lambda_{\\mathrm{th}}$，$\\hat{\\Theta}$ 的最优非对角项恰好为零。\n\n以 $S$ 的元素表示 $\\lambda_{\\mathrm{th}}$ 的单个闭式解析表达式作为您的最终答案。无需四舍五入。不涉及单位。", "solution": "设目标函数为 $f(\\Theta)$。我们需要在 $\\Theta \\in \\mathbb{S}_{++}^2$ 上最小化 $f(\\Theta)$。\n使用指定的参数化 $\\Theta = \\begin{pmatrix} a  b \\\\ b  c \\end{pmatrix}$ 和 $S = \\begin{pmatrix} s_{11}  s_{12} \\\\ s_{12}  s_{22} \\end{pmatrix}$，我们可以将目标函数的各项写为：\n- $\\det(\\Theta) = ac - b^2$\n- $\\operatorname{tr}(S\\Theta) = \\operatorname{tr}\\left( \\begin{pmatrix} s_{11}  s_{12} \\\\ s_{12}  s_{22} \\end{pmatrix} \\begin{pmatrix} a  b \\\\ b  c \\end{pmatrix} \\right) = s_{11}a + 2s_{12}b + s_{22}c$\n- $\\lambda \\sum_{i \\neq j} |\\theta_{ij}| = \\lambda(|\\theta_{12}| + |\\theta_{21}|) = 2\\lambda|b|$\n\n用 $a$、$b$ 和 $c$ 表示的目标函数是：\n$$ f(a, b, c) = -\\ln(ac - b^2) + s_{11}a + 2s_{12}b + s_{22}c + 2\\lambda|b| $$\n优化受约束 $a0$，$c0$ 和 $ac - b^2  0$ 的限制。由于这是一个凸优化问题，当零向量包含在目标函数的次微分中时，达到最小值。该函数关于 $a$ 和 $c$ 是可微的，但由于 $|b|$ 项的存在，关于 $b$ 仅是次可微的。\n\n让我们计算偏导数和次梯度。\n在最优点 $(\\hat{a}, \\hat{b}, \\hat{c})$ 处，$f$ 关于 $(a, b, c)$ 的次微分必须包含 $(0, 0, 0)$。\n\n$a$ 的最优性条件是：\n$$ \\frac{\\partial f}{\\partial a} = -\\frac{c}{ac - b^2} + s_{11} = 0 $$\n$c$ 的最优性条件是：\n$$ \\frac{\\partial f}{\\partial c} = -\\frac{a}{ac - b^2} + s_{22} = 0 $$\n$b$ 的次梯度最优性条件是：\n$$ 0 \\in \\frac{\\partial f}{\\partial b} = \\frac{2b}{ac - b^2} + 2s_{12} + 2\\lambda \\partial|b| $$\n其中 $\\partial|b|$ 是绝对值函数在 $b$ 处的次微分。如果 $b \\neq 0$，它被定义为 $\\operatorname{sgn}(b)$；如果 $b = 0$，它被定义为区间 $[-1, 1]$。设 $z \\in \\partial|b|$。$b$ 的条件可以重写为：\n$$ \\frac{b}{ac - b^2} + s_{12} + \\lambda z = 0 $$\n这三个条件必须在最优解 $\\hat{\\Theta} = \\begin{pmatrix} \\hat{a}  \\hat{b} \\\\ \\hat{b}  \\hat{c} \\end{pmatrix}$ 处成立。\n\n让我们用矩阵形式重新表达这些条件。$\\Theta$ 的逆是 $\\Theta^{-1} = \\frac{1}{ac-b^2}\\begin{pmatrix} c  -b \\\\ -b  a \\end{pmatrix}$。\n最优性条件可以写为：\n- $(\\Theta^{-1})_{11} = \\frac{c}{ac - b^2} = s_{11}$\n- $(\\Theta^{-1})_{22} = \\frac{a}{ac - b^2} = s_{22}$\n- $(\\Theta^{-1})_{12} = \\frac{-b}{ac - b^2} = s_{12} + \\lambda z$\n这可以简洁地总结为 $\\Theta^{-1} = S + \\Lambda$，其中 $\\Lambda = \\begin{pmatrix} 0  \\lambda z \\\\ \\lambda z  0 \\end{pmatrix}$ 且 $z \\in \\partial|b|$。\n\n我们想找到阈值 $\\lambda_{\\mathrm{th}}$，使得对于任何 $\\lambda \\geq \\lambda_{\\mathrm{th}}$，最优非对角元素 $\\hat{b}$ 为零。让我们假设 $\\hat{b} = 0$。\n如果 $\\hat{b} = 0$，精度矩阵是对角的：$\\hat{\\Theta} = \\begin{pmatrix} \\hat{a}  0 \\\\ 0  \\hat{c} \\end{pmatrix}$。\n它的逆也是对角的：$\\hat{\\Theta}^{-1} = \\begin{pmatrix} 1/\\hat{a}  0 \\\\ 0  1/\\hat{c} \\end{pmatrix}$。\n\n现在，我们检查这种形式是否能满足最优性条件。\n从 $\\hat{\\Theta}^{-1}$ 的对角元素上的条件来看：\n- $(\\hat{\\Theta}^{-1})_{11} = 1/\\hat{a} = s_{11} \\implies \\hat{a} = 1/s_{11}$\n- $(\\hat{\\Theta}^{-1})_{22} = 1/\\hat{c} = s_{22} \\implies \\hat{c} = 1/s_{22}$\n因为 $S \\in \\mathbb{S}_{++}^2$，我们有 $s_{11}  0$ 和 $s_{22}  0$，所以 $\\hat{a}  0$ 且 $\\hat{c}  0$。行列式为 $\\hat{a}\\hat{c} - \\hat{b}^2 = (s_{11}s_{22})^{-1}  0$。所得矩阵 $\\hat{\\Theta}$ 是正定的，符合要求。\n\n现在，我们必须满足非对角元素的条件。当 $\\hat{b} = 0$ 时，条件是：\n$(\\hat{\\Theta}^{-1})_{12} = s_{12} + \\lambda z$\n因为 $\\hat{\\Theta}$ 是对角的，所以 $(\\hat{\\Theta}^{-1})_{12} = 0$。因此，条件变为：\n$0 = s_{12} + \\lambda z$\n这意味着 $z = -s_{12}/\\lambda$。\n\n根据 $\\hat{b} = 0$ 情况下次梯度的定义，我们必须有 $z \\in [-1, 1]$。\n因此，存在一个 $\\hat{b}=0$ 的解的条件是：\n$$ -1 \\leq -\\frac{s_{12}}{\\lambda} \\leq 1 $$\n乘以 $-1$ 会使不等式反向：\n$$ -1 \\leq \\frac{s_{12}}{\\lambda} \\leq 1 $$\n这等价于：\n$$ \\left| \\frac{s_{12}}{\\lambda} \\right| \\leq 1 $$\n因为 $\\lambda \\geq 0$，我们可以乘以 $\\lambda$（如果 $\\lambda=0$，不等式仅在 $s_{12}=0$ 时成立）。假设 $\\lambda0$：\n$$ |s_{12}| \\leq \\lambda $$\n这个不等式定义了使最优解 $\\hat{\\Theta}$ 为对角矩阵（$\\hat{b}=0$）的 $\\lambda$ 值的范围。\n\n如果 $\\lambda  |s_{12}|$，那么 $|s_{12}/\\lambda|  1$，所以不可能找到一个 $z \\in [-1, 1]$ 来满足 $z = -s_{12}/\\lambda$。在这种情况下，解不能有 $\\hat{b}=0$。\n\n因此，满足条件 $\\lambda \\geq |s_{12}|$ 的最小 $\\lambda$ 值，我们称之为 $\\lambda_{\\mathrm{th}}$，恰好是 $|s_{12}|$。对于所有 $\\lambda \\geq |s_{12}|$，最优非对角项 $\\hat{\\theta}_{12}=\\hat{b}$ 为零。\n\n阈值惩罚水平 $\\lambda_{\\mathrm{th}}$ 是产生稀疏性的边界值。\n$$ \\lambda_{\\mathrm{th}} = |s_{12}| $$\n这个结果是 Graphical LASSO 一个更一般性质的特例：一个非对角元素 $\\hat{\\Theta}_{ij}$ 为零，当且仅当 $|S_{ij}| \\leq \\lambda$。将特定元素设置为零的阈值由样本协方差矩阵中相应项的大小决定。", "answer": "$$\n\\boxed{|s_{12}|}\n$$", "id": "3478302"}, {"introduction": "虽然解析解能为我们提供深刻的理论洞察，但解决现实世界中的大多数问题仍需依赖高效的数值算法。本练习将带你完成从理论到实践的关键一跃，任务是为一个在图信号处理中至关重要的核心部件——图总变分（Graph Total Variation, graph-TV）邻近算子——构建求解器。通过运用凸对偶理论并实现一个加速投影梯度算法，你将掌握在通用图上高效求解大规模稀疏优化问题的实用技能。[@problem_id:3478308]", "problem": "给定一个由大小为 $n$ 的节点集 $\\mathcal{V}$ 和大小为 $m$ 的边集 $\\mathcal{E}$ 指定的有限、简单、无向图，以及每条边的一个任意固定的方向。令 $B \\in \\mathbb{R}^{m \\times n}$ 表示有向节点-边关联矩阵，其中对于从 $i$ 指向 $j$ 的边 $e = (i,j)$，$B$ 的第 $e$ 行在第 $i$ 列为 $-1$，在第 $j$ 列为 $+1$，其他位置为 $0$。令 $W \\in \\mathbb{R}^{m \\times m}$ 为一个非负边权重的对角矩阵，其对角线元素为 $w_e  0$。对于节点上的一个信号 $x \\in \\mathbb{R}^n$，各向异性图全变分 (graph-TV) 定义为 $\\|W B x\\|_1 = \\sum_{e \\in \\mathcal{E}} w_e |(B x)_e|$。\n\n对于给定的输入向量 $y \\in \\mathbb{R}^n$ 和正则化参数 $\\lambda \\ge 0$，考虑图-TV泛函的近端映射：\n$$\n\\operatorname{prox}_{\\lambda \\|\\cdot\\|_{\\mathrm{graph-TV}}}(y) \\triangleq \\underset{x \\in \\mathbb{R}^n}{\\arg\\min}\\ \\frac{1}{2}\\|x - y\\|_2^2 + \\lambda \\|W B x\\|_1.\n$$\n要求您：\n\n- 从标准凸对偶和将$\\ell_1$范数定义为支撑函数出发，推导一个对偶形式，其最大化变量 $q \\in \\mathbb{R}^m$ 被约束在半径为1的$\\ell_{\\infty}$球内，即 $\\|q\\|_{\\infty} \\le 1$。然后解释如何通过对$\\ell_{\\infty}$球进行简单的坐标级投影来实现对偶问题上的投影梯度法，以及这如何通过 $x^{\\star} = y - \\lambda B^{\\top} W q^{\\star}$ 实现对近端映射的高效评估。\n\n- 实现将任意边差分向量 $v \\in \\mathbb{R}^m$ 投影到半径为1的$\\ell_{\\infty}$球上的操作，即实现投影映射 $P_{\\infty}(v) = \\underset{\\|q\\|_{\\infty} \\le 1}{\\arg\\min}\\ \\|q - v\\|_2^2$，并在对偶问题的加速投影梯度法中使用它来计算 $x^{\\star} = \\operatorname{prox}_{\\lambda \\|\\cdot\\|_{\\mathrm{graph-TV}}}(y)$。\n\n- 将您的推导基于以下基本事实：$\\ell_1$范数的Fenchel共轭是单位$\\ell_{\\infty}$球的指示函数；用于与线性算子复合的凸函数的Fenchel–Rockafellar对偶性；以及到$\\ell_{\\infty}$球的投影是通过坐标级裁剪完成的这一事实。\n\n您的程序必须实现所述算法，并在以下测试套件上对其进行评估。对于每个测试用例，通过对偶投影梯度法计算原始解 $x^{\\star}$，其恒定步长基于对偶梯度Lipschitz常数的幂迭代估计自动选择。然后，为每个测试用例报告两个浮点数：\n- 对偶间隙 $g = f(x^{\\star}) - d(q)$，其中 $f(x) = \\frac{1}{2}\\|x - y\\|_2^2 + \\lambda \\|W B x\\|_1$ 且 $d(q)$ 是最终对偶迭代变量 $q$ 处的对偶目标值，必须满足 $g \\ge 0$。\n- 一个Karush–Kuhn–Tucker (KKT) 违规度量，定义为两个量的最大值：$\\ell_{\\infty}$-球可行性违规 $\\max(0, \\|q\\|_{\\infty} - 1)$ 和在 $W B x^{\\star}$ 支撑集上的次梯度一致性违规，即 $\\max_{e:\\ |(W B x^{\\star})_e|  \\varepsilon} |q_e - \\operatorname{sign}((W B x^{\\star})_e)|$，其中固定阈值 $\\varepsilon = 10^{-8}$。\n\n测试套件（所有边都是无向的，但假设给定方向为每对中从第一个节点到第二个节点，所有权重按列出顺序对应于边）：\n- 案例1（正常路径）：$n = 5$，$\\mathcal{E} = \\{(0,1),(1,2),(2,3),(3,4)\\}$，$w = [1,1,1,1]$，$y = [1.0, -0.5, 0.3, 2.0, -1.2]$，$\\lambda = 0.7$。\n- 案例2（边界情况 $\\lambda = 0$）：$n = 5$，$\\mathcal{E} = \\{(0,1),(1,2),(2,3),(3,4)\\}$，$w = [1,1,1,1]$，$y = [0.2, -0.1, 0.0, 0.3, -0.4]$，$\\lambda = 0.0$。\n- 案例3（具有异构权重的非连通分量）：$n = 6$，$\\mathcal{E} = \\{(0,1),(2,3),(3,4)\\}$，$w = [1.0, 0.5, 2.0]$，$y = [-1.0, 0.0, 2.5, -2.0, 0.7, 1.3]$，$\\lambda = 0.6$。\n- 案例4（星形图，强正则化）：$n = 6$，$\\mathcal{E} = \\{(0,1),(0,2),(0,3),(0,4),(0,5)\\}$，$w = [1,1,1,1,1]$，$y = [3.0, -1.0, 0.5, -0.5, 2.0, -2.0]$，$\\lambda = 5.0$。\n\n实现细节：\n- 使用对偶形式，其变量 $q \\in \\mathbb{R}^m$ 受 $\\|q\\|_{\\infty} \\le 1$ 约束。\n- 令 $A = W B B^{\\top} W \\in \\mathbb{R}^{m \\times m}$ 和 $b = W B y \\in \\mathbb{R}^m$。用于最小化的平滑对偶目标是 $h(q) = \\frac{1}{2}\\lambda^2 q^{\\top} A q - \\lambda b^{\\top} q$。其梯度为 $\\nabla h(q) = \\lambda^2 A q - \\lambda b$。使用加速投影梯度法，恒定步长为 $1/L$，其中 $L$ 是 $\\nabla h$ 的Lipschitz常数的估计值，等于 $\\lambda^2 \\|A\\|_2$。使用50步幂迭代和 $10^{-10}$ 的相对容差来估计 $\\|A\\|_2$。\n- 到半径为1的$\\ell_{\\infty}$球的投影是坐标级裁剪 $P_{\\infty}(v)_e = \\min\\{\\max\\{v_e,-1\\},1\\}$，对每个坐标 $e \\in \\{1,\\dots,m\\}$。\n- 计算出 $q$ 后，恢复 $x^{\\star} = y - \\lambda B^{\\top} W q$。\n\n您的程序应按指定顺序为四个测试用例输出一行，包含一个扁平列表，其中包含8个浮点数，顺序如下：$[g_1, k_1, g_2, k_2, g_3, k_3, g_4, k_4]$，其中 $g_i$ 是对偶间隙，$k_i$ 是案例 $i$ 的KKT违规。\n\n您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表形式的结果（例如，$[0.001,0.0,0.0,0.0,0.002,0.0001,0.0,0.0]$）。所有数值均为无单位实数。", "solution": "### 步骤 2：对偶形式推导\n\n原始问题是找到图-TV泛函的近端映射，由以下公式给出：\n$$\nx^{\\star} = \\underset{x \\in \\mathbb{R}^n}{\\arg\\min}\\ \\frac{1}{2}\\|x - y\\|_2^2 + \\lambda \\|W B x\\|_1\n$$\n我们用 $f(x)$ 表示目标函数。我们可以通过首先使用其作为单位$\\ell_{\\infty}$球的支撑函数的定义来表示$\\ell_1$范数，从而推导出对偶问题。向量 $z \\in \\mathbb{R}^m$ 的$\\ell_1$范数可以写成：\n$$\n\\|z\\|_1 = \\sup_{\\|q\\|_{\\infty} \\le 1} q^{\\top} z\n$$\n其中 $\\|q\\|_{\\infty} = \\max_e |q_e|$ 是$\\ell_{\\infty}$范数。将此代入原始目标，我们得到一个极小化极大问题：\n$$\n\\min_{x \\in \\mathbb{R}^n} \\left( \\frac{1}{2}\\|x - y\\|_2^2 + \\lambda \\sup_{\\|q\\|_{\\infty} \\le 1} q^{\\top} (W B x) \\right) = \\min_{x \\in \\mathbb{R}^n} \\sup_{\\|q\\|_{\\infty} \\le 1} \\left( \\frac{1}{2}\\|x - y\\|_2^2 + \\lambda q^{\\top} W B x \\right)\n$$\n目标函数对于 $x$ 是凸的，对于 $q$ 是线性的（因此是凹的）。$x$ 的域 ($\\mathbb{R}^n$) 和 $q$ 的域（单位$\\ell_{\\infty}$球）都是凸集。因此，根据Sion的极小化极大定理，我们可以交换 `min` 和 `max` 算子：\n$$\n\\max_{\\|q\\|_{\\infty} \\le 1} \\min_{x \\in \\mathbb{R}^n} \\mathcal{L}(x, q) \\quad \\text{其中} \\quad \\mathcal{L}(x, q) = \\frac{1}{2}\\|x - y\\|_2^2 + \\lambda q^{\\top} W B x\n$$\n为了找到对偶目标，我们首先针对固定的 $q$ 求解关于 $x$ 的内部最小化问题。函数 $\\mathcal{L}(x, q)$ 对 $x$ 是二次且严格凸的。我们通过将其关于 $x$ 的梯度设为零来找到其最小值：\n$$\n\\nabla_x \\mathcal{L}(x, q) = (x - y) + (\\lambda q^{\\top} W B)^{\\top} = (x - y) + \\lambda B^{\\top} W^{\\top} q = 0\n$$\n由于 $W$ 是一个对角矩阵，$W^{\\top} = W$。唯一的最小化子 $x^{\\star}(q)$ 是：\n$$\nx^{\\star}(q) = y - \\lambda B^{\\top} W q\n$$\n这个方程提供了从最优对偶解 $q^{\\star}$ 恢复最优原始解 $x^{\\star}$ 的关系。\n\n将 $x^{\\star}(q)$ 代回 $\\mathcal{L}(x, q)$ 得到对偶目标函数 $d(q)$：\n$$\nd(q) = \\frac{1}{2}\\|(y - \\lambda B^{\\top} W q) - y\\|_2^2 + \\lambda q^{\\top} W B (y - \\lambda B^{\\top} W q)\n$$\n$$\nd(q) = \\frac{1}{2}\\|-\\lambda B^{\\top} W q\\|_2^2 + \\lambda q^{\\top} W B y - \\lambda^2 q^{\\top} W B B^{\\top} W q\n$$\n$$\nd(q) = \\frac{\\lambda^2}{2} q^{\\top} W B B^{\\top} W q + \\lambda (W B y)^{\\top} q - \\lambda^2 q^{\\top} W B B^{\\top} W q\n$$\n$$\nd(q) = \\lambda (W B y)^{\\top} q - \\frac{\\lambda^2}{2} q^{\\top} (W B B^{\\top} W) q\n$$\n对偶问题是在约束集上最大化 $d(q)$：\n$$\n\\underset{q \\in \\mathbb{R}^m}{\\max}\\ d(q) \\quad \\text{subject to} \\quad \\|q\\|_{\\infty} \\le 1\n$$\n这是一个在凸集（超立方体）上最大化凹二次函数的问题。为了使用基于梯度下降的方法实现，通常会求解一个等价的最小化问题。我们定义凸函数 $h(q) = -d(q)$：\n$$\nh(q) = \\frac{\\lambda^2}{2} q^{\\top} (W B B^{\\top} W) q - \\lambda (W B y)^{\\top} q\n$$\n然后，对偶问题被表述为：\n$$\nq^{\\star} = \\underset{q \\in \\mathbb{R}^m}{\\arg\\min}\\ h(q) \\quad \\text{subject to} \\quad \\|q\\|_{\\infty} \\le 1\n$$\n\n### 步骤 3：加速投影梯度法\n\n对偶问题包括在简单凸集 $\\mathcal{C} = \\{q \\in \\mathbb{R}^m : \\|q\\|_{\\infty} \\le 1\\}$ 上最小化一个光滑凸函数 $h(q)$。这种结构非常适合使用投影梯度法。我们将使用加速变体（FISTA）以获得更快的收敛速度。\n\n对偶目标 $h(q)$ 的梯度是：\n$$\n\\nabla h(q) = \\lambda^2 (W B B^{\\top} W) q - \\lambda (W B y)\n$$\n梯度 $\\nabla h(q)$ 是Lipschitz连续的，其常数 $L$ 可以由其Hessian矩阵 $\\nabla^2 h(q) = \\lambda^2 W B B^{\\top} W$ 的谱范数来界定。令 $A = W B B^{\\top} W$。则 $L = \\lambda^2 \\|A\\|_2$。我们可以使用幂迭代法来估计 $\\|A\\|_2 = \\lambda_{\\max}(A)$，因为 $A$ 是对称且半正定的。梯度法的步长设为 $\\alpha = 1/L$。\n\n到单位$\\ell_{\\infty}$球的投影算子 $P_{\\mathcal{C}}(v)$ 是一个简单的坐标级裁剪函数：\n$$\n(P_{\\mathcal{C}}(v))_e = \\min(\\max(v_e, -1), 1)\n$$\nFISTA算法的更新步骤如下，从 $q_0=0$, $z_1=q_0$, $t_1=1$ 开始：\n1.  在动量点 $z_k$ 处计算梯度：$\\nabla h(z_k) = \\lambda^2 A z_k - \\lambda W B y$。\n2.  执行梯度下降步骤并投影：$q_k = P_{\\mathcal{C}}(z_k - \\alpha \\nabla h(z_k))$。\n3.  更新动量项：$t_{k+1} = \\frac{1 + \\sqrt{1 + 4t_k^2}}{2}$。\n4.  更新下一个动量点：$z_{k+1} = q_k + \\frac{t_k - 1}{t_{k+1}}(q_k - q_{k-1})$。\n\n经过足够次数的迭代后，该算法会产生最优对偶解 $q^{\\star}$ 的近似值。然后使用 $x^{\\star} = y - \\lambda B^{\\top} W q^{\\star}$ 恢复最优原始解。\n\n### 步骤 4：对偶间隙与KKT违规\n\n解 $(x^{\\star}, q^{\\star})$ 的质量可以通过两个度量来评估。\n\n**对偶间隙**：根据弱对偶性，对于任何原始可行解 $x$ 和对偶可行解 $q$，我们有 $f(x) \\ge d(q)$。对偶间隙为 $g = f(x^{\\star}) - d(q^{\\star})$。在最优性条件下，强对偶性成立，间隙为零。在数值上，它将是一个小的非负值。使用 $d(q) = -h(q)$，间隙计算为 $g = f(x^{\\star}) + h(q^{\\star})$。\n\n**KKT违规**：最优性的Karush-Kuhn-Tucker（KKT）条件是：\n1.  **原始可行性**：$x^{\\star} \\in \\mathbb{R}^n$（无约束）。\n2.  **对偶可行性**：$\\|q^{\\star}\\|_{\\infty} \\le 1$。\n3.  **平稳性/次梯度一致性**：拉格朗日函数关于 $x$ 的梯度必须为零，这给出了 $x^{\\star} = y - \\lambda B^{\\top} W q^{\\star}$。这也意味着 $q^{\\star}$ 必须是 $\\ell_1$ 范数在 $W B x^{\\star}$ 处的次梯度。这要求对于每条边 $e$：\n    -   如果 $|(W B x^{\\star})_e|  0$，则 $q^{\\star}_e = \\operatorname{sign}((W B x^{\\star})_e)$。\n    -   如果 $(W B x^{\\star})_e = 0$，则 $|q^{\\star}_e| \\le 1$。\n\nKKT违规度量结合了对偶可行性违规和次梯度一致性违规：\n$k = \\max \\left( \\max(0, \\|q^{\\star}\\|_{\\infty} - 1), \\max_{e:\\, |(W B x^{\\star})_e|  \\varepsilon} |q^{\\star}_e - \\operatorname{sign}((W B x^{\\star})_e)| \\right)$，其中 $\\varepsilon  0$ 是一个小容差。", "answer": "```python\nimport numpy as np\n\ndef build_incidence_matrix(n, edges):\n    \"\"\"Constructs the oriented node-edge incidence matrix B.\"\"\"\n    m = len(edges)\n    B = np.zeros((m, n))\n    for i, edge in enumerate(edges):\n        u, v = edge\n        B[i, u] = -1\n        B[i, v] = 1\n    return B\n\ndef power_iteration(A, num_iter=50, tol=1e-10):\n    \"\"\"Estimates the spectral norm of a symmetric matrix A.\"\"\"\n    if A.shape[0] == 0:\n        return 0.0\n    v = np.random.rand(A.shape[1])\n    v = v / np.linalg.norm(v)\n    \n    eigenval_old = 0.0\n    for _ in range(num_iter):\n        Av = A @ v\n        v_norm = np.linalg.norm(Av)\n        if v_norm == 0:\n            return 0.0\n        v = Av / v_norm\n        eigenval = np.dot(v, A @ v)\n        if abs(eigenval - eigenval_old)  tol * (eigenval + 1e-12):\n            break\n        eigenval_old = eigenval\n        \n    return eigenval\n\ndef solve_single_case(n, edges, w, y, lambda_, num_fista_iter=5000, kkt_eps=1e-8):\n    \"\"\"Solves the graph-TV prox problem for a single case.\"\"\"\n    m = len(edges)\n    B = build_incidence_matrix(n, edges)\n    W = np.diag(w)\n    \n    # Handle the special case lambda = 0\n    if lambda_ == 0.0:\n        x_star = y\n        # Choose a dual-optimal q that satisfies KKT. If WBx is non-zero, q must be its sign.\n        # But for lambda=0, dual is max 0, so any q with ||q||_inf = 1 is optimal.\n        # To minimize KKT violation, we need consistency.\n        # x* = y - lambda*B'Wq = y. So WBx* = WBy.\n        # We need q_e = sign((WBy)_e) if (WBy)_e != 0.\n        WBy = W @ B @ y\n        q = np.clip(WBy / (np.abs(WBy) + 1e-12), -1.0, 1.0) # A way to get sign, handles zero\n        \n        # Primal objective value f(x*) = 0\n        f_x_star = 0.5 * np.linalg.norm(x_star - y)**2\n        # Dual objective value d(q) = 0\n        d_q = 0.0\n        gap = f_x_star - d_q\n        \n        # KKT violation\n        feasibility_viol = 0.0 # Our choice of q is feasible\n        \n        active_set = np.abs(WBy) > kkt_eps\n        if np.any(active_set):\n            consistency_viol = np.max(np.abs(q[active_set] - np.sign(WBy[active_set])))\n        else:\n            consistency_viol = 0.0\n        \n        kkt_violation = max(feasibility_viol, consistency_viol)\n        \n        return gap, kkt_violation\n\n    # FISTA for lambda > 0\n    A = W @ B @ B.T @ W\n    b = W @ B @ y\n    lambda_b = lambda_ * b\n\n    # Lipschitz constant of the dual gradient\n    L_A = power_iteration(A)\n    L = lambda_**2 * L_A\n    alpha = 1.0 / L if L > 1e-12 else 1.0\n\n    # FISTA initialization\n    q = np.zeros(m)\n    z = np.zeros(m)\n    t = 1.0\n    \n    # FISTA iterations\n    for k in range(num_fista_iter):\n        grad_h_z = lambda_**2 * (A @ z) - lambda_b\n        q_next = z - alpha * grad_h_z\n        q_next = np.clip(q_next, -1.0, 1.0)  # Projection P_inf\n\n        t_next = (1.0 + np.sqrt(1.0 + 4.0 * t**2)) / 2.0\n        z = q_next + ((t - 1.0) / t_next) * (q_next - q)\n        \n        q = q_next\n        t = t_next\n    \n    # Recover primal solution\n    x_star = y - lambda_ * B.T @ W @ q\n    \n    # Calculate metrics\n    # Primal objective f(x*)\n    WBx_star = W @ B @ x_star\n    f_x_star = 0.5 * np.linalg.norm(x_star - y)**2 + lambda_ * np.linalg.norm(WBx_star, 1)\n\n    # Dual maximization objective d(q)\n    d_q = lambda_b.T @ q - 0.5 * lambda_**2 * q.T @ A @ q\n    \n    # Duality gap g = f(x*) - d(q)\n    gap = f_x_star - d_q\n    \n    # KKT violation\n    # 1. Feasibility violation\n    feasibility_viol = max(0.0, np.max(np.abs(q)) - 1.0)\n    \n    # 2. Subgradient consistency violation\n    active_set = np.abs(WBx_star) > kkt_eps\n    if np.any(active_set):\n        consistency_viol = np.max(np.abs(q[active_set] - np.sign(WBx_star[active_set])))\n    else:\n        consistency_viol = 0.0\n        \n    kkt_violation = max(feasibility_viol, consistency_viol)\n    \n    return gap, kkt_violation\n\ndef solve():\n    \"\"\"Main function to run all test cases and print results.\"\"\"\n    test_cases = [\n        # Case 1 (happy path)\n        (5, [(0, 1), (1, 2), (2, 3), (3, 4)], np.array([1.0, 1.0, 1.0, 1.0]), np.array([1.0, -0.5, 0.3, 2.0, -1.2]), 0.7),\n        # Case 2 (boundary lambda = 0)\n        (5, [(0, 1), (1, 2), (2, 3), (3, 4)], np.array([1.0, 1.0, 1.0, 1.0]), np.array([0.2, -0.1, 0.0, 0.3, -0.4]), 0.0),\n        # Case 3 (disconnected components)\n        (6, [(0, 1), (2, 3), (3, 4)], np.array([1.0, 0.5, 2.0]), np.array([-1.0, 0.0, 2.5, -2.0, 0.7, 1.3]), 0.6),\n        # Case 4 (star graph, strong regularization)\n        (6, [(0, 1), (0, 2), (0, 3), (0, 4), (0, 5)], np.array([1.0, 1.0, 1.0, 1.0, 1.0]), np.array([3.0, -1.0, 0.5, -0.5, 2.0, -2.0]), 5.0)\n    ]\n\n    results = []\n    for case in test_cases:\n        n, edges, w, y, lambda_ = case\n        gap, kkt_viol = solve_single_case(n, edges, w, y, lambda_)\n        results.extend([gap, kkt_viol])\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(f'{r:.12f}' for r in results)}]\")\n\nsolve()\n```", "id": "3478308"}]}