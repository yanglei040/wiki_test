{"hands_on_practices": [{"introduction": "在进行任何显式时间步进的数值模拟之前，首要的考量是其稳定性。一个数值格式如果不稳定，其计算结果会随着时间步进而无限增长，最终变得毫无物理意义。本练习将引导你运用冯·诺依曼 (von Neumann) 分析法，这是一个用于判断数值格式稳定性的基石性工具，通过推导经典声波方程有限差分格式的稳定性条件，你将亲身体验确保模拟结果收敛且可靠的关键一步 ([@problem_id:3592805])。", "problem": "考虑一个标量场 $u(x,t)$ 的一维声波方程，在密度和波速 $c$ 恒定的情况下，该方程由 $u_{tt}(x,t) = c^{2} u_{xx}(x,t)$ 给出。设空间域在均匀网格 $x_{i} = i\\,\\Delta x$ 上离散化，时间离散化为 $t^{n} = n\\,\\Delta t$，其中 $i$ 和 $n$ 为整数，$\\Delta x$ 和 $\\Delta t$ 为正常数。在每个内部网格点上，使用时间和空间上的二阶中心有限差分来构造一个显式更新格式，并在周期性边界条件下进行 von Neumann (傅里叶) 稳定性分析，以确定所有傅里叶模式在时间上有界的条件。定义库朗数 $\\lambda = \\dfrac{c\\,\\Delta t}{\\Delta x}$，并推导形式为 $c\\,\\Delta t / \\Delta x \\le \\lambda_{\\max}$ 的 Courant–Friedrichs–Lewy (CFL) 条件。计算 $\\lambda_{\\max}$ 的精确值。将最终答案表示为一个实数。不需要四舍五入，最终答案中不应包含单位。", "solution": "问题陈述有效。这是一个计算物理学中标准的、适定的问题，它具有科学依据、客观性，并包含了获得唯一解所需的所有必要信息。\n\n一维声波方程由下式给出：\n$$\n\\frac{\\partial^2 u}{\\partial t^2} = c^2 \\frac{\\partial^2 u}{\\partial x^2}\n$$\n其中 $u(x,t)$ 是标量场，$c$ 是恒定的波速。\n\n我们用均匀网格对区域进行离散化，使得 $x_i = i\\,\\Delta x$ 和 $t^n = n\\,\\Delta t$。$u(x_i, t^n)$ 的数值近似值记为 $u_i^n$。我们使用二阶中心有限差分来近似偏导数。\n\n在 $(x_i, t^n)$ 处，关于时间的二阶偏导数 $u_{tt}$ 近似为：\n$$\n\\frac{\\partial^2 u}{\\partial t^2}\\bigg|_{i,n} \\approx \\frac{u_i^{n+1} - 2u_i^n + u_i^{n-1}}{(\\Delta t)^2}\n$$\n在 $(x_i, t^n)$ 处，关于空间的二阶偏导数 $u_{xx}$ 近似为：\n$$\n\\frac{\\partial^2 u}{\\partial x^2}\\bigg|_{i,n} \\approx \\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{(\\Delta x)^2}\n$$\n将这些近似值代入波动方程，得到有限差分方程：\n$$\n\\frac{u_i^{n+1} - 2u_i^n + u_i^{n-1}}{(\\Delta t)^2} = c^2 \\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{(\\Delta x)^2}\n$$\n为了创建一个显式更新格式，我们求解 $u_i^{n+1}$：\n$$\nu_i^{n+1} = 2u_i^n - u_i^{n-1} + \\frac{c^2 (\\Delta t)^2}{(\\Delta x)^2} (u_{i+1}^n - 2u_i^n + u_{i-1}^n)\n$$\n我们引入库朗数 $\\lambda = \\frac{c\\,\\Delta t}{\\Delta x}$。方程变为：\n$$\nu_i^{n+1} = 2u_i^n - u_i^{n-1} + \\lambda^2 (u_{i+1}^n - 2u_i^n + u_{i-1}^n)\n$$\n对于 von Neumann 稳定性分析，我们考虑形如下式的单个傅里叶模式解：\n$$\nu_i^n = \\xi^n e^{j k x_i} = \\xi^n e^{j k i \\Delta x}\n$$\n其中 $k$ 是波数，$j = \\sqrt{-1}$，$\\xi = \\xi(k)$ 是放大因子。为使格式稳定，放大因子的模必须对所有可能的波数 $k$ 满足 $|\\xi| \\le 1$。\n\n将傅里叶模式代入有限差分格式：\n$$\n\\xi^{n+1} e^{j k i \\Delta x} = 2\\xi^n e^{j k i \\Delta x} - \\xi^{n-1} e^{j k i \\Delta x} + \\lambda^2 \\left( \\xi^n e^{j k (i+1) \\Delta x} - 2\\xi^n e^{j k i \\Delta x} + \\xi^n e^{j k (i-1) \\Delta x} \\right)\n$$\n将整个方程除以公因子 $\\xi^{n-1} e^{j k i \\Delta x}$ 得到：\n$$\n\\xi^2 = 2\\xi - 1 + \\lambda^2 \\left( \\xi e^{j k \\Delta x} - 2\\xi + \\xi e^{-j k \\Delta x} \\right)\n$$\n我们可以在右侧提取因子 $\\xi$ 并使用欧拉公式 $e^{j\\theta} + e^{-j\\theta} = 2\\cos(\\theta)$，其中 $\\theta = k\\Delta x$：\n$$\n\\xi^2 = 2\\xi - 1 + \\lambda^2 \\xi (e^{j k \\Delta x} + e^{-j k \\Delta x} - 2)\n$$\n$$\n\\xi^2 = 2\\xi - 1 + \\lambda^2 \\xi (2\\cos(k\\Delta x) - 2)\n$$\n$$\n\\xi^2 = 2\\xi - 1 - 2\\lambda^2 \\xi (1 - \\cos(k\\Delta x))\n$$\n使用半角恒等式 $1 - \\cos(\\theta) = 2\\sin^2(\\theta/2)$：\n$$\n\\xi^2 = 2\\xi - 1 - 4\\lambda^2 \\xi \\sin^2\\left(\\frac{k\\Delta x}{2}\\right)\n$$\n将此式重新整理为关于 $\\xi$ 的标准二次方程：\n$$\n\\xi^2 - \\left( 2 - 4\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\right)\\xi + 1 = 0\n$$\n这是一个形如 $a\\xi^2 + b\\xi + c = 0$ 的二次方程，其中 $a=1$, $b = -2P$, $c=1$, 且 $P = 1 - 2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right)$。其根由二次求根公式给出：\n$$\n\\xi = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a} = P \\pm \\sqrt{P^2 - 1}\n$$\n为使解保持有界，我们需要 $|\\xi| \\le 1$。\n让我们根据 $P$ 的值来分析这些根：\n1. 如果 $P^2 > 1$ (即 $|P| > 1$)，则项 $\\sqrt{P^2-1}$ 为实数且为正。其中一个根的模将大于1。例如，如果 $P > 1$，则 $\\xi_+ = P + \\sqrt{P^2-1} > 1$。如果 $P  -1$，则 $\\xi_- = P - \\sqrt{P^2-1}  -1$，所以 $|\\xi_-| > 1$。在这两种情况下，格式都是不稳定的。\n2. 如果 $P^2 \\le 1$ (即 $|P| \\le 1$)，则项 $P^2-1$ 为非正数。根为 $\\xi = P \\pm j\\sqrt{1-P^2}$。这些复数根的模为：\n$$\n|\\xi| = \\sqrt{P^2 + \\left(\\sqrt{1-P^2}\\right)^2} = \\sqrt{P^2 + 1 - P^2} = \\sqrt{1} = 1\n$$\n在这种情况下，傅里叶模式的振幅是守恒的，格式是稳定的。边界情况 $P^2=1$ 给出一个实根 $\\xi=P$，其模 $|\\xi|=1$，这也是稳定的。\n\n因此，对于所有波数 $k$ 的稳定性条件是 $|P| \\le 1$：\n$$\n\\left| 1 - 2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\right| \\le 1\n$$\n这个不等式可以写成：\n$$\n-1 \\le 1 - 2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\le 1\n$$\n让我们分析不等式的两部分。右侧部分是：\n$$\n1 - 2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\le 1 \\implies -2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\le 0\n$$\n因为 $\\lambda^2 \\ge 0$ 和 $\\sin^2(\\cdot) \\ge 0$，所以这部分总是满足的。\n左侧部分给出了决定性的稳定性约束：\n$$\n-1 \\le 1 - 2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\implies 2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\le 2\n$$\n$$\n\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\le 1\n$$\n这个条件必须对所有波数 $k$ 都成立。为确保这一点，我们必须考虑“最坏情况”，即对应于使项 $\\sin^2\\left(\\frac{k\\Delta x}{2}\\right)$ 最大化的 $k$ 值。$\\sin^2(\\cdot)$ 的最大值是 $1$。这发生在网格上可表示的最高频率模式，即 $k = \\pi / \\Delta x$ 时，此时正弦函数的参数为 $\\pi/2$。\n对这种最坏情况强制施加该条件可得：\n$$\n\\lambda^2 \\cdot \\max_{k}\\left[\\sin^2\\left(\\frac{k\\Delta x}{2}\\right)\\right] \\le 1 \\implies \\lambda^2 \\cdot 1 \\le 1\n$$\n$$\n\\lambda^2 \\le 1\n$$\n由于库朗数 $\\lambda = \\frac{c\\Delta t}{\\Delta x}$ 是由正常数 $\\Delta t$ 和 $\\Delta x$ 定义的，且波速 $c$ 也为正，所以 $\\lambda$ 是一个非负量。因此，稳定性条件简化为：\n$$\n0 \\le \\lambda \\le 1\n$$\n问题要求形式为 $\\frac{c\\,\\Delta t}{\\Delta x} \\le \\lambda_{\\max}$ 的 Courant–Friedrichs–Lewy (CFL) 条件。这对应于 $\\lambda \\le \\lambda_{\\max}$，因此我们可以确定 $\\lambda_{\\max}$ 是稳定范围的上界。\n$$\n\\lambda_{\\max} = 1\n$$", "answer": "$$\\boxed{1}$$", "id": "3592805"}, {"introduction": "为了提升模拟精度，在计算区域内部采用高阶差分格式是一种常用策略，但这会在边界处带来新的挑战。标准的中心差分格式在靠近边界的网格点上无法使用，因此必须设计专门的单边边界格式。本练习将向你展示如何系统地设计这些关键的边界格式，通过匹配泰勒级数展开的各阶导数，确保整个计算区域的离散精度得以保持 ([@problem_id:3592768])。", "problem": "考虑一维恒定密度声波方程 $u_{tt}(x,t)=c^{2}\\,u_{xx}(x,t)$，其定义域为 $x\\in[0,L]$，带有齐次狄利克雷边界条件 $u(0,t)=0$，且对于所有 $t\\ge 0$，解 $u(x,t)$ 是光滑的。令 $x_i=i\\,h$，其中 $h=L/N$ 为均匀网格间距，$i=0,1,\\dots,N$ 为网格索引。假设在内部区域，对于 $i\\ge 2$，空间二阶导数 $u_{xx}(x_i,t)$ 由标准四阶中心五点格式来近似。为保持空间离散化的整体四阶精度且不引入虚拟点，您决定为第一个内部点 $x_1=h$ 构建一个单边边界封闭格式。该格式使用 $\\{u(x_j,t)\\}_{j=0}^{5}$ 的值，并将 $u_{xx}(x_1,t)$ 近似到 $\\mathcal{O}(h^{4})$ 的精度。\n\n您的任务是确定哪组候选系数能达到四阶相容性，特别是能强制执行由泰勒级数设计所隐含的边界“三阶导数匹配”。具体来说，假设一个近似形式为\n$$\nu_{xx}(x_1,t)\\;\\approx\\;\\frac{1}{h^{2}}\\sum_{j=0}^{5} a_j\\,u(x_j,t),\n$$\n其中系数 $a_j$ 是不依赖于时间的常数。对 $u(x_j,t)$ 在 $x_1=h$ 处进行泰勒展开，其中 $x_j=h+s_j h$ 且 $s_j=j-1$（对于 $j=0,1,\\dots,5$），四阶相容性要求截断误差为 $\\mathcal{O}(h^{4})$。证明这等价于以下矩条件\n$$\n\\sum_{j=0}^{5} a_j s_j^{n}=\\begin{cases}\n0,  n=0,1,3,4,5,\\\\\n2,  n=2,\n\\end{cases}\n$$\n并且“三阶导数匹配”精确对应于 $n=3$ 的约束条件 $\\sum_{j=0}^{5} a_j s_j^{3}=0$，该条件消除了泰勒展开三次项对截断误差的贡献。下列哪组候选系数 $\\{a_j\\}_{j=0}^{5}$（按顺序乘以 $\\{u(x_0),u(x_1),u(x_2),u(x_3),u(x_4),u(x_5)\\}$）满足上述所有条件，从而在保持四阶精度的同时，在边界处强制执行三阶导数匹配？\n\nA. $\\left\\{\\dfrac{5}{6},\\;-\\dfrac{5}{4},\\;-\\dfrac{1}{3},\\;\\dfrac{7}{6},\\;-\\dfrac{1}{2},\\;\\dfrac{1}{12}\\right\\}$\n\nB. $\\left\\{\\dfrac{45}{12},\\;-\\dfrac{154}{12},\\;\\dfrac{214}{12},\\;-\\dfrac{156}{12},\\;\\dfrac{61}{12},\\;-\\dfrac{10}{12}\\right\\}$\n\nC. $\\left\\{\\dfrac{3}{2},\\;-\\dfrac{5}{2},\\;1,\\;1,\\;-1,\\;0\\right\\}$\n\nD. $\\left\\{\\dfrac{1}{2},\\;-1,\\;0,\\;\\dfrac{1}{2},\\;0,\\;0\\right\\}$\n\n通过选择正确的选项来回答。", "solution": "用户提供了一个需要解决的问题。根据指示，第一步是验证问题陈述。\n\n### 步骤1：提取已知条件\n\n-   **偏微分方程：** 一维恒定密度声波方程，$u_{tt}(x,t)=c^{2}\\,u_{xx}(x,t)$。\n-   **定义域：** $x\\in[0,L]$。\n-   **边界条件：** 在 $x=0$ 处的齐次狄利克雷条件，即 $u(0,t)=0$。\n-   **网格：** 均匀网格，间距为 $h=L/N$，点为 $x_i=i\\,h$，$i=0,1,\\dots,N$。\n-   **任务：** 在第一个内部点 $x_1=h$ 处，求 $u_{xx}(x_1,t)$ 的单边有限差分近似。\n-   **格式：** 该近似使用网格点 $\\{x_j\\}_{j=0}^{5}$。\n-   **近似形式：** $u_{xx}(x_1,t) \\approx \\frac{1}{h^{2}}\\sum_{j=0}^{5} a_j\\,u(x_j,t)$。\n-   **精度：** 格式必须是四阶精确的，即截断误差为 $\\mathcal{O}(h^{4})$。\n-   **展开点：** 泰勒级数围绕 $x_1=h$ 展开。\n-   **相对模板坐标：** $x_j = x_1 + s_j h$，其中 $s_j = j-1$，$j=0,1,\\dots,5$。\n-   **相容性条件：** 问题陈述指出，$\\mathcal{O}(h^{4})$ 的精度等价于满足以下矩条件：\n    $$\n    \\sum_{j=0}^{5} a_j s_j^{n}=\\begin{cases}\n    0,  n=0,1,3,4,5\\\\\n    2,  n=2\n    \\end{cases}\n    $$\n-   **三阶导数匹配：** 这被定义为 $n=3$ 时的条件，即 $\\sum_{j=0}^{5} a_j s_j^{3}=0$。\n\n### 步骤2：使用提取的已知条件进行验证\n\n该问题在科学上和数学上都是合理的。它描述了数值分析中构建高阶有限差分格式（特别是用于边界封闭格式）的标准流程。从泰勒级数展开推导矩条件是一项基本技巧。\n\n-   **科学依据：** 该问题牢固地植根于计算物理学和偏微分方程数值方法领域。使用泰勒级数确定格式系数是一种标准且有效的方法。\n-   **适定性：** 任务是验证给定的哪组系数满足一个明确定义的线性方程组。这是一个清晰且可解的问题。\n-   **客观性：** 该问题以精确、客观、无歧义的数学语言陈述。\n-   **完整性与一致性：** 所有必要的信息（近似的形式、格式点、要求的精度以及由此产生的代数条件）都已提供。声波方程和边界条件的背景与对此类专门格式的需求是一致的。\n\n问题陈述是有效的。\n\n### 步骤3：进行求解\n\n任务是找到满足问题陈述中给出的六个矩条件的系数集 $\\{a_j\\}_{j=0}^{5}$。该格式通过在 $x_1$ 处展开来近似 $u_{xx}(x_1,t)$。相对模板坐标为 $s_j = j-1$，$j=0, 1, 2, 3, 4, 5$。\n这给出了相对位置的向量：\n$$ s = (s_0, s_1, s_2, s_3, s_4, s_5) = (-1, 0, 1, 2, 3, 4) $$\n我们需要检查哪个候选系数集满足以下六个方程：\n1.  $n=0: \\sum_{j=0}^{5} a_j s_j^0 = \\sum_{j=0}^{5} a_j = 0$\n2.  $n=1: \\sum_{j=0}^{5} a_j s_j^1 = 0$\n3.  $n=2: \\sum_{j=0}^{5} a_j s_j^2 = 2$\n4.  $n=3: \\sum_{j=0}^{5} a_j s_j^3 = 0$ (三阶导数匹配)\n5.  $n=4: \\sum_{j=0}^{5} a_j s_j^4 = 0$\n6.  $n=5: \\sum_{j=0}^{5} a_j s_j^5 = 0$\n\n我们将逐一评估每个选项。\n\n**选项 A：** $a = \\left\\{\\dfrac{5}{6},\\;-\\dfrac{5}{4},\\;-\\dfrac{1}{3},\\;\\dfrac{7}{6},\\;-\\dfrac{1}{2},\\;\\dfrac{1}{12}\\right\\}$。\n为了便于计算，我们使用公分母 $12$：\n$a = \\left\\{\\dfrac{10}{12},\\;-\\dfrac{15}{12},\\;-\\dfrac{4}{12},\\;\\dfrac{14}{12},\\;-\\dfrac{6}{12},\\;\\dfrac{1}{12}\\right\\}$。\n\n-   **n=0:** $\\sum a_j = \\frac{1}{12}(10 - 15 - 4 + 14 - 6 + 1) = \\frac{1}{12}(25 - 25) = 0$。(正确)\n-   **n=1:** $\\sum a_j s_j^1 = \\frac{1}{12}[10(-1) - 15(0) - 4(1) + 14(2) - 6(3) + 1(4)] = \\frac{1}{12}[-10 - 4 + 28 - 18 + 4] = \\frac{1}{12}[-32 + 32] = 0$。(正确)\n-   **n=2:** $\\sum a_j s_j^2 = \\frac{1}{12}[10(-1)^2 - 15(0)^2 - 4(1)^2 + 14(2)^2 - 6(3)^2 + 1(4)^2] = \\frac{1}{12}[10 - 0 - 4 + 14(4) - 6(9) + 16] = \\frac{1}{12}[10 - 4 + 56 - 54 + 16] = \\frac{1}{12}[6 + 2 + 16] = \\frac{24}{12} = 2$。(正确)\n-   **n=3:** $\\sum a_j s_j^3 = \\frac{1}{12}[10(-1)^3 - 4(1)^3 + 14(2)^3 - 6(3)^3 + 1(4)^3] = \\frac{1}{12}[-10 - 4 + 14(8) - 6(27) + 64] = \\frac{1}{12}[-14 + 112 - 162 + 64] = \\frac{1}{12}[-176 + 176] = 0$。(正确)\n-   **n=4:** $\\sum a_j s_j^4 = \\frac{1}{12}[10(-1)^4 - 4(1)^4 + 14(2)^4 - 6(3)^4 + 1(4)^4] = \\frac{1}{12}[10 - 4 + 14(16) - 6(81) + 256] = \\frac{1}{12}[6 + 224 - 486 + 256] = \\frac{1}{12}[486 - 486] = 0$。(正确)\n-   **n=5:** $\\sum a_j s_j^5 = \\frac{1}{12}[10(-1)^5 - 4(1)^5 + 14(2)^5 - 6(3)^5 + 1(4)^5] = \\frac{1}{12}[-10 - 4 + 14(32) - 6(243) + 1024] = \\frac{1}{12}[-14 + 448 - 1458 + 1024] = \\frac{1}{12}[-1472 + 1472] = 0$。(正确)\n\n所有六个条件都得到满足。\n**选项A的结论：正确**\n\n**选项 B：** $a = \\left\\{\\dfrac{45}{12},\\;-\\dfrac{154}{12},\\;\\dfrac{214}{12},\\;-\\dfrac{156}{12},\\;\\dfrac{61}{12},\\;-\\dfrac{10}{12}\\right\\}$。\n让我们检查三阶导数匹配条件 ($n=3$)：\n$\\sum a_j s_j^3 = \\frac{1}{12}[45(-1)^3 - 154(0)^3 + 214(1)^3 - 156(2)^3 + 61(3)^3 - 10(4)^3]$\n$= \\frac{1}{12}[-45 + 214 - 156(8) + 61(27) - 10(64)]$\n$= \\frac{1}{12}[-45 + 214 - 1248 + 1647 - 640] = \\frac{1}{12}[(214+1647) - (45+1248+640)] = \\frac{1}{12}[1861 - 1933] = \\frac{-72}{12} = -6$。\n由于 $\\sum a_j s_j^3 = -6 \\neq 0$，该选项未能满足三阶导数匹配条件，并且不是四阶精确的。\n**选项B的结论：错误**\n\n**选项 C：** $a = \\left\\{\\dfrac{3}{2},\\;-\\dfrac{5}{2},\\;1,\\;1,\\;-1,\\;0\\right\\}$。\n让我们检查 $n=1$ 的条件：\n$\\sum a_j s_j^1 = \\frac{3}{2}(-1) - \\frac{5}{2}(0) + 1(1) + 1(2) - 1(3) + 0(4) = -\\frac{3}{2} + 1 + 2 - 3 = -\\frac{3}{2} + 0 = -\\frac{3}{2}$。\n由于 $\\sum a_j s_j^1 = -\\frac{3}{2} \\neq 0$，该格式会引入一个 $\\mathcal{O}(h^{-1})$ 的误差，未能满足二阶导数近似的一个基本相容性要求。\n**选项C的结论：错误**\n\n**选项 D：** $a = \\left\\{\\dfrac{1}{2},\\;-1,\\;0,\\;\\dfrac{1}{2},\\;0,\\;0\\right\\}$。\n让我们检查 $n=1$ 的条件：\n$\\sum a_j s_j^1 = \\frac{1}{2}(-1) - 1(0) + 0(1) + \\frac{1}{2}(2) + 0(3) + 0(4) = -\\frac{1}{2} + 1 = \\frac{1}{2}$。\n由于 $\\sum a_j s_j^1 = \\frac{1}{2} \\neq 0$，该格式在近似二阶导数方面也根本不相容。\n**选项D的结论：错误**\n\n根据系统性评估，只有选项A中的系数集满足在 $x_1$ 处对二阶导数进行四阶精确近似所需的所有矩条件，包括三阶导数匹配这一特定条件。", "answer": "$$\\boxed{A}$$", "id": "3592768"}, {"introduction": "本章的压轴实践将理论知识与一个完整的计算实验相结合，旨在加深对物理原理与数值算法之间深刻联系的理解。我们将探索互易性原理——一个源于波动方程算子自伴随性的基本物理定律。这项练习要求你编写一个二维声波方程求解器，并用它来实证检验不同的数值算法选择（如差分格式的对称性和边界阻尼层）是如何影响离散系统对这一物理定律的保持或违背的 ([@problem_id:3592795])。", "problem": "考虑均匀介质中压力 $p(\\mathbf{x},t)$ 的二维声波方程，其波速 $c$ 为常数，\n$$\n\\partial_{tt} p(\\mathbf{x},t) - c^2 \\nabla^2 p(\\mathbf{x},t) = s(t)\\,\\delta(\\mathbf{x}-\\mathbf{x}_s),\n$$\n其中 $\\mathbf{x} = (x,y)$ 表示位置，$t$ 表示时间，$c$ 表示波速，$\\nabla^2$ 表示空间拉普拉斯算子，$s(t)$ 表示一个时间上紧致的震源子波，$\\delta(\\cdot)$ 表示狄拉克δ分布。在合适的边界条件下，对于线性、时不变、自伴的空间算子，格林函数 $G(\\mathbf{x}_s,\\mathbf{x}_r,t)$（定义为在 $\\mathbf{x}_s$ 处的脉冲震源在接收点位置 $\\mathbf{x}_r$ 记录到的压力）在震源和接收点互换时是对称的，\n$$\nG(\\mathbf{x}_s,\\mathbf{x}_r,t) = G(\\mathbf{x}_r,\\mathbf{x}_s,t).\n$$\n此性质被称为互易性。在计算地球物理学中，声波方程的有限差分格式化必须保持算子对称性，以维持离散互易性。非对称模板和阻尼层，例如在完美匹配层（PML）边界处理中使用的那些，会破坏互易性，因为它们使离散算子变为非自伴的。\n\n仅从声波方程、互易性的定义和自伴性的概念出发，推导在使用对称中心差分和反射边界条件下，离散互易性应如何成立，并解释在使用非对称模板或模拟PML行为的空间变化一阶阻尼项时，互易性会如何被破坏。然后，实现一个二维时域有限差分求解器来求解声波方程，以在以下三种情况下经验性地测试离散互易性：\n- 情况 A：对称中心差分拉普拉斯算子，无阻尼。\n- 情况 B：非对称前向差分拉普拉斯算子，无阻尼。\n- 情况 C：对称中心差分拉普拉斯算子，带一个边界阻尼层（类PML的海绵边界），在方程中实现为附加项 $+\\sigma(\\mathbf{x})\\,\\partial_t p$。\n\n使用以下科学上自洽的参数和单位：\n- 网格尺寸：$N_x = 64$，$N_y = 64$ 空间样本。\n- 空间采样：$\\Delta x = 10\\,\\mathrm{m}$，$\\Delta y = 10\\,\\mathrm{m}$。\n- 恒定波速：$c = 1500\\,\\mathrm{m/s}$。\n- 时间步长：$\\Delta t = 0.45\\,\\Delta x/(c\\sqrt{2})\\,\\mathrm{s}$。\n- 时间步数：$N_t = 400$。\n- 震源子波：主频为 $f_0 = 5\\,\\mathrm{Hz}$、峰值时间为 $t_0 = 1.5/f_0\\,\\mathrm{s}$ 的里克子波，\n$$\ns(t) = \\left(1 - 2\\pi^2 f_0^2 (t-t_0)^2\\right)\\,\\exp\\left(-\\pi^2 f_0^2 (t-t_0)^2\\right).\n$$\n- 无阻尼情况下的边界条件：均匀狄利克雷边界，通过在每次更新后将计算域边缘的 $p$ 值设为0来实现。\n- 情况 C 的边界阻尼：厚度为 $N_{\\mathrm{pml}} = 12$ 个网格点的海绵边界剖面，\n$$\n\\sigma(\\mathbf{x}) = \\begin{cases}\n\\sigma_{\\max}\\left(1 - \\frac{d(\\mathbf{x})}{N_{\\mathrm{pml}}}\\right)^2  \\text{if } d(\\mathbf{x})  N_{\\mathrm{pml}}, \\\\\n0  \\text{otherwise},\n\\end{cases}\n$$\n其中 $d(\\mathbf{x})$ 是从 $\\mathbf{x}$ 到任意计算域边界的最小距离（以网格点数为单位），且 $\\sigma_{\\max} = 50\\,\\mathrm{s}^{-1}$。\n- 震源和接收点索引对，以网格索引 $(i,j)$ 给出，其中 $i\\in\\{0,\\dots,N_x-1\\}$，$j\\in\\{0,\\dots,N_y-1\\}$：\n    - 情况 A：$\\mathbf{x}_s = (32,20)$，$\\mathbf{x}_r = (42,44)$。\n    - 情况 B：$\\mathbf{x}_s = (32,20)$，$\\mathbf{x}_r = (42,44)$。\n    - 情况 C：$\\mathbf{x}_s = (14,14)$，$\\mathbf{x}_r = (50,40)$。\n\n对时间使用二阶蛙跳格式，对每种情况使用指定的空间模板来实现离散时间步进。对于情况 C，使用一阶后向差分在每个网格点上对阻尼项 $+\\sigma(\\mathbf{x})\\,\\partial_t p$ 进行时间离散化，以获得完全显式的更新方案。\n\n对于每种情况，计算两个接收点时间序列 $g_A[n]$ 和 $g_B[n]$，$n\\in\\{0,\\dots,N_t-1\\}$，分别对应于在 $\\mathbf{x}_s$ 放置震源时在 $\\mathbf{x}_r$ 记录的压力，以及在 $\\mathbf{x}_r$ 放置震源时在 $\\mathbf{x}_s$ 记录的压力。通过归一化残差\n$$\n\\rho = \\frac{\\left\\|\\mathbf{g}_A - \\mathbf{g}_B\\right\\|_2}{\\max\\left(\\left\\|\\mathbf{g}_A\\right\\|_2,\\,\\left\\|\\mathbf{g}_B\\right\\|_2\\right)},\n$$\n来量化互易性，该残差是无量纲的。每种情况报告一个 $\\rho$ 值。\n\n你的程序应产生单行输出，包含三个残差，形式为方括号内用逗号分隔的列表，无空格，单位为无量纲。例如，格式必须与 $[\\rho_A,\\rho_B,\\rho_C]$ 完全一样。输出类型必须是包含三个浮点数的列表。测试套件是上面指定的三种情况，它们共同测试了理想路径（情况 A，对称模板且无阻尼）、一个重要的边缘情况（情况 B，非对称模板破坏自伴性）和边界阻尼效应（情况 C，类PML的 $\\sigma(\\mathbf{x})$ 层通过非自伴性破坏互易性）。不允许用户输入；所有参数均按提供的值固定。", "solution": "该问题要求首先对声波方程有限差分格式中的离散互易性进行理论推导，然后通过数值实现来验证所推导的原理。\n\n均匀介质中压力 $p(\\mathbf{x},t)$ 的二维声波方程由下式给出：\n$$\n\\partial_{tt} p(\\mathbf{x},t) - c^2 \\nabla^2 p(\\mathbf{x},t) = s(t)\\,\\delta(\\mathbf{x}-\\mathbf{x}_s)\n$$\n此处，$\\partial_{tt}$ 是关于时间 $t$ 的二阶偏导数，$c$ 是恒定波速，$\\nabla^2$ 是空间拉普拉斯算子，$s(t)$ 是震源时间函数，$\\delta(\\mathbf{x}-\\mathbf{x}_s)$ 表示位于 $\\mathbf{x}_s$ 的点源。\n\n互易性原理指出，由位于 $\\mathbf{x}_s$ 的震源在接收点位置 $\\mathbf{x}_r$ 记录到的波场，与由位于 $\\mathbf{x}_r$ 的震源在 $\\mathbf{x}_s$ 记录到的波场是相同的。在格林函数 $G(\\mathbf{x}_s, \\mathbf{x}_r, t)$ 的背景下，这表示为：\n$$\nG(\\mathbf{x}_s,\\mathbf{x}_r,t) = G(\\mathbf{x}_r,\\mathbf{x}_s,t)\n$$\n此性质源于空间算子（此处为 $-c^2\\nabla^2$）的自伴性以及波动方程的时间反演对称性。当我们对该方程进行离散化时，这些性质必须在离散算子中得到保留，以维持离散互易性。\n\n设压力场在网格上离散为 $p_{i,j}^n \\approx p(i\\Delta x, j\\Delta y, n\\Delta t)$。一个通用的显式有限差分格式可以写成矩阵向量形式。设 $\\mathbf{p}^n$ 是一个包含时间步 $n$ 时所有网格点上压力值的向量。标准的时间二阶蛙跳离散格式为：\n$$\n\\frac{\\mathbf{p}^{n+1} - 2\\mathbf{p}^n + \\mathbf{p}^{n-1}}{\\Delta t^2} - c^2 \\mathbf{L} \\mathbf{p}^n = \\mathbf{s}^n\n$$\n其中 $\\mathbf{L}$ 是表示离散拉普拉斯算子的矩阵，$\\mathbf{s}^n$ 是离散震源向量。重新整理以得到时间步进更新公式：\n$$\n\\mathbf{p}^{n+1} = 2\\mathbf{p}^n - \\mathbf{p}^{n-1} + c^2 \\Delta t^2 \\mathbf{L} \\mathbf{p}^n + \\Delta t^2 \\mathbf{s}^n\n$$\n当且仅当由矩阵 $\\mathbf{L}$ 表示的离散空间算子是对称的，即 $\\mathbf{L} = \\mathbf{L}^T$ 时，离散互易性成立。这是自伴性质的离散模拟。\n\n让我们分析问题中提出的三种情况。\n\n情况 A：对称中心差分拉普拉斯算子\n在网格点 $(i,j)$ 处拉普拉斯算子的二阶中心差分近似为：\n$$\n(\\nabla^2 p)_{i,j} \\approx \\frac{p_{i+1,j} - 2p_{i,j} + p_{i-1,j}}{\\Delta x^2} + \\frac{p_{i,j+1} - 2p_{i,j} + p_{i,j-1}}{\\Delta y^2}\n$$\n从该模板组装矩阵 $\\mathbf{L}$ 时，表示网格点 $v$ 对网格点 $u$ 处拉普拉斯算子贡献的条目 $L_{uv}$ 仅当 $u$ 和 $v$ 是邻居时才非零。由于模板的对称性，点 $j$ 对点 $i$ 方程的贡献与点 $i$ 对点 $j$ 方程的贡献是相同的。例如，对于两个水平相邻的点 $u=(i,j)$ 和 $v=(i+1,j)$，$u$ 所在行中对应于 $v$ 所在列的系数是 $1/\\Delta x^2$，而 $v$ 所在行中对应于 $u$ 所在列的系数也是 $1/\\Delta x^2$。这确保了矩阵 $\\mathbf{L}$ 是对称的。通过在边界上强制压力为零来实现的均匀狄利克雷边界条件也遵守这种对称性。因此，离散算子是自伴的，我们预期离散互易性在机器精度范围内成立。互易性残差 $\\rho$ 应接近于零。\n\n情况 B：非对称前向差分拉普拉斯算子\n通过应用两次前向差分算子，可以构造出拉普拉斯算子的非对称近似。$x$方向二阶导数的前向差分近似为：\n$$\n(\\partial_{xx} p)_{i,j} \\approx \\frac{p_{i+2,j} - 2p_{i+1,j} + p_{i,j}}{\\Delta x^2}\n$$\n由此产生的离散拉普拉斯算子 $\\mathbf{L}$ 不再对称。$p_{i,j}$ 的方程依赖于 $p_{i,j}$、$p_{i+1,j}$ 和 $p_{i+2,j}$ 的值。在矩阵 $\\mathbf{L}$ 中，对应于点 $(i,j)$ 的行将在对应于点 $(i,j)$、$(i+1,j)$ 和 $(i+2,j)$ 的列上有非零项。然而，对应于点 $(i+1,j)$ 的行将不会以相同方式包含来自点 $(i,j)$ 的相应贡献。最终的矩阵是非对称的（$\\mathbf{L} \\neq \\mathbf{L}^T$），通常是一个带状矩阵，其非零项位于非关于主对角线对称的对角线上。这破坏了离散算子的自伴性，因此，预计离散互易性将被破坏。残差 $\\rho$ 应显著大于零。\n\n情况 C：带阻尼的对称拉普拉斯算子\n波动方程被一个一阶阻尼项修正为：\n$$\n\\partial_{tt} p + \\sigma(\\mathbf{x})\\,\\partial_t p - c^2 \\nabla^2 p = s(t)\\,\\delta(\\mathbf{x}-\\mathbf{x}_s)\n$$\n该项旨在吸收边界处的外向波，模仿完美匹配层（PML）。我们对 $\\nabla^2 p$ 使用对称模板，但新增的项 $\\sigma(\\mathbf{x})\\,\\partial_t p$ 破坏了整体算子的对称性。使用一阶后向差分 $\\partial_t p \\approx (p^n - p^{n-1})/\\Delta t$ 对该项进行离散化，可以保持显式更新格式。点 $(i,j)$ 的完整离散方程为：\n$$\n\\frac{p_{i,j}^{n+1} - 2p_{i,j}^n + p_{i,j}^{n-1}}{\\Delta t^2} + \\sigma_{i,j} \\frac{p_{i,j}^n - p_{i,j}^{n-1}}{\\Delta t} - c^2 (\\nabla^2 p^n)_{i,j} = s_{i,j}^n\n$$\n求解 $p_{i,j}^{n+1}$：\n$$\np_{i,j}^{n+1} = (2 - \\sigma_{i,j}\\Delta t) p_{i,j}^n - (1 - \\sigma_{i,j}\\Delta t) p_{i,j}^{n-1} + c^2 \\Delta t^2 (\\nabla^2 p^n)_{i,j} + \\Delta t^2 s_{i,j}^n\n$$\n阻尼项引入了耗散，这破坏了系统的时间反演对称性。一个有耗散的系统是非保守的。这种时间反演对称性的丧失与自伴性的丧失有根本联系。即使空间拉普拉斯部分 $\\mathbf{L}$ 是对称的，控制演化的算子也不再是自伴的。因此，互易性被破坏。对于与 $\\sigma(\\mathbf{x}) > 0$ 的阻尼层相互作用的波路径，这种破坏将最为明显。我们预计残差 $\\rho$ 将显著不为零。\n\n下面的数值实现将计算这三种情况下的互易性残差 $\\rho$，以证实这些理论预期。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 2D acoustic wave equation using finite differences to test\n    the principle of discrete reciprocity under three different conditions.\n    \"\"\"\n\n    # --- Problem Parameters ---\n    Nx = 64  # Grid points in x\n    Ny = 64  # Grid points in y\n    dx = 10.0  # Spatial step in x (m)\n    dy = 10.0  # Spatial step in y (m)\n    c = 1500.0  # Wave speed (m/s)\n    Nt = 400  # Number of time steps\n    f0 = 5.0  # Peak frequency of Ricker wavelet (Hz)\n    Npml = 12 # Thickness of sponge layer (grid points)\n    sigma_max = 50.0 # Maximum damping coefficient (s^-1)\n\n    # Stability condition (CFL)\n    # dt = dx / (c * sqrt(2)) for dx=dy\n    # A factor of 0.45 is used, well within the stable limit of 1.\n    dt = 0.45 * dx / (c * np.sqrt(2))\n\n    t0 = 1.5 / f0  # Peak time of Ricker wavelet\n\n    # --- Test Case Definitions ---\n    test_cases = [\n        # Case A: Symmetric stencil, no damping\n        ('A', (32, 20), (42, 44)),\n        # Case B: Non-symmetric stencil, no damping\n        ('B', (32, 20), (42, 44)),\n        # Case C: Symmetric stencil, damping\n        ('C', (14, 14), (50, 40)),\n    ]\n\n    # --- Helper Functions ---\n    def ricker_wavelet(t, f0, t0):\n        \"\"\"Generates a Ricker wavelet.\"\"\"\n        arg = (np.pi * f0 * (t - t0))**2\n        return (1.0 - 2.0 * arg) * np.exp(-arg)\n\n    # Pre-calculate source time series\n    time_vec = np.arange(Nt) * dt\n    source_ts = ricker_wavelet(time_vec, f0, t0)\n    \n    # Pre-calculate damping profile for Case C\n    sigma = np.zeros((Nx, Ny), dtype=np.float64)\n    xx, yy = np.meshgrid(np.arange(Nx), np.arange(Ny), indexing='ij')\n    dist_to_left = xx\n    dist_to_right = Nx - 1 - xx\n    dist_to_top = yy\n    dist_to_bottom = Ny - 1 - yy\n    d = np.minimum.reduce([dist_to_left, dist_to_right, dist_to_top, dist_to_bottom])\n    pml_zone = d  Npml\n    sigma[pml_zone] = sigma_max * (1 - d[pml_zone] / Npml)**2\n\n    def run_simulation(src_pos, rec_pos, case_type):\n        \"\"\"\n        Runs a single FDTD simulation for a given setup.\n        \"\"\"\n        p_prev = np.zeros((Nx, Ny), dtype=np.float64)\n        p_now = np.zeros((Nx, Ny), dtype=np.float64)\n        p_next = np.zeros((Nx, Ny), dtype=np.float64)\n        \n        seismogram = np.zeros(Nt, dtype=np.float64)\n        \n        src_ix, src_iy = src_pos\n        rec_ix, rec_iy = rec_pos\n\n        # Source scaling to approximate Dirac delta\n        source_amp_scaled = source_ts / (dx * dy)\n\n        # Time-stepping loop\n        for n in range(Nt):\n            # Record pressure at receiver\n            seismogram[n] = p_now[rec_ix, rec_iy]\n            \n            # --- Calculate Laplacian ---\n            lap_p = np.zeros_like(p_now)\n            if case_type == 'A' or case_type == 'C':\n                # 5-point symmetric central-difference stencil\n                p_ip1 = p_now[2:, 1:-1]\n                p_im1 = p_now[0:-2, 1:-1]\n                p_jp1 = p_now[1:-1, 2:]\n                p_jm1 = p_now[1:-1, 0:-2]\n                p_cen = p_now[1:-1, 1:-1]\n                lap_p[1:-1, 1:-1] = (p_ip1 + p_im1 + p_jp1 + p_jm1 - 4 * p_cen) / dx**2\n            \n            elif case_type == 'B':\n                # Non-symmetric forward-difference for second derivative\n                lap_p_x = np.zeros_like(p_now)\n                lap_p_y = np.zeros_like(p_now)\n                \n                # Apply forward stencil u_xx(i) ~ (u(i+2) - 2u(i+1) + u(i))/h^2\n                # This is computed for i in 0..Nx-3\n                lap_p_x[0:Nx-2, :] = (p_now[2:Nx, :] - 2 * p_now[1:Nx-1, :] + p_now[0:Nx-2, :]) / dx**2\n                # This is computed for j in 0..Ny-3\n                lap_p_y[:, 0:Ny-2] = (p_now[:, 2:Ny] - 2 * p_now[:, 1:Ny-1] + p_now[:, 0:Ny-2]) / dy**2\n                lap_p = lap_p_x + lap_p_y\n\n            # --- Time update ---\n            c_eff = c * dt\n            if case_type == 'C':\n                # Update with damping\n                p_next = (2.0 - sigma * dt) * p_now - (1.0 - sigma * dt) * p_prev + c_eff**2 * lap_p\n            else:\n                # Standard leapfrog update\n                p_next = 2.0 * p_now - p_prev + c_eff**2 * lap_p\n            \n            # --- Add source ---\n            p_next[src_ix, src_iy] += source_amp_scaled[n] * dt**2\n            \n            # --- Apply boundary conditions ---\n            if case_type == 'A' or case_type == 'B':\n                # Homogeneous Dirichlet BC\n                p_next[0, :] = 0.0\n                p_next[-1, :] = 0.0\n                p_next[:, 0] = 0.0\n                p_next[:, -1] = 0.0\n            \n            # --- Update pressure fields ---\n            p_prev, p_now = p_now, p_next\n            \n        return seismogram\n\n    results = []\n    for case, src_pos, rec_pos in test_cases:\n        # Run simulation for (source, receiver)\n        g_A = run_simulation(src_pos, rec_pos, case)\n        \n        # Run simulation for (receiver, source)\n        g_B = run_simulation(rec_pos, src_pos, case)\n        \n        # Calculate normalized residual\n        norm_g_A = np.linalg.norm(g_A)\n        norm_g_B = np.linalg.norm(g_B)\n        norm_diff = np.linalg.norm(g_A - g_B)\n        \n        if max(norm_g_A, norm_g_B) == 0:\n            rho = 0.0\n        else:\n            rho = norm_diff / max(norm_g_A, norm_g_B)\n        \n        results.append(rho)\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```", "id": "3592795"}]}