{"hands_on_practices": [{"introduction": "在解决了基本的狄利克雷（Dirichlet）边界条件后，下一个挑战是如何处理更复杂的边界，例如在地球物理学中常见的流量或通量边界，即诺伊曼（Neumann）条件。这要求我们计算网络输出在边界上的法向导数。[@problem_id:3431045]这个练习将引导你利用水平集函数（level-set function）和自动微分（Automatic Differentiation）技术，为诺伊曼边界条件构建相应的损失项，从而让你能够处理涉及边界通量的更真实的物理问题。", "problem": "考虑一个由物理信息神经网络 (PINN) 表示的标量场 $u_{\\theta}:\\mathbb{R}^{d}\\to\\mathbb{R}$，该网络经过训练以近似有界域 $\\Omega\\subset\\mathbb{R}^{d}$ 及其边界 $\\partial\\Omega$ 内一个偏微分方程 (PDE) 的解。在边界上，模型必须满足诺伊曼边界条件 $\\partial_{n}u=h$ on $\\partial\\Omega$，其中 $h:\\partial\\Omega\\to\\mathbb{R}$ 是一个给定的通量，$\\partial_{n}u$ 表示外法向导数。边界 $\\partial\\Omega$ 由一个光滑函数 $\\phi:\\mathbb{R}^{d}\\to\\mathbb{R}$ 的零水平集隐式给出，其中对于所有 $x\\in\\partial\\Omega$ 都有 $\\nabla\\phi(x)\\neq 0$，单位外法向量为 $n(x)=\\nabla\\phi(x)/\\|\\nabla\\phi(x)\\|$。给定一个边界求积法则 $\\{(x_{i}^{b},w_{i})\\}_{i=1}^{N_{b}}$，其中 $x_{i}^{b}\\in\\partial\\Omega$ 且权重 $w_{i}>0$，该法则用于近似 $\\partial\\Omega$ 上的曲面积分。PINN 的训练通过最小化一个损失泛函来进行，该泛函包含一个边界惩罚项，用于在平方 $L^2$ 意义下强制施加诺伊曼边界条件，并通过给定的求积法则进行近似。可以使用自动微分 (AD) 来计算 $u_{\\theta}$ 关于其输入的空间导数，并且函数 $\\phi$ 的实现方式也使其梯度可以被计算。\n\n从法向导数 $\\partial_{n}u(x)=n(x)^{\\top}\\nabla_{x}u(x)$ 的定义和 $L^2$ 边界失配出发，使用所提供的求积法则，为边界损失 $L_{N}(\\theta)$ 推导一个闭式解析表达式。该损失函数用于惩罚在 $\\partial\\Omega$ 上 $\\partial_{n}u_{\\theta}$ 和 $h$ 之间的差异。将法向导数完全用可通过自动微分 (AD) 计算的量和水平集几何来表示，并将损失写成边界样本上的归一化加权和。\n\n你的最终答案必须是 $L_{N}(\\theta)$ 的一个单一显式解析表达式，用 $\\{x_{i}^{b},w_{i}\\}_{i=1}^{N_{b}}$、$u_{\\theta}$、$\\phi$ 和 $h$ 来表示。最终答案中不要包含任何解释性文字。", "solution": "该问题要求为边界损失 $L_{N}(\\theta)$ 推导一个闭式解析表达式，该损失用于为物理信息神经网络 (PINN) 施加诺伊曼边界条件。推导过程从边界条件失配在合适函数空间中的基本定义开始，然后进行离散化。\n\n首先，我们定义诺伊曼边界条件的残差。该条件由边界 $\\partial\\Omega$ 上的 $\\partial_{n}u = h$ 给出。对于神经网络近似 $u_{\\theta}$，在点 $x \\in \\partial\\Omega$ 处的边界残差由下式给出：\n$$\nR_{N}(x; \\theta) = \\partial_{n}u_{\\theta}(x) - h(x)\n$$\n问题指明，边界惩罚项在平方 $L^2$ 意义下施加。残差在边界 $\\partial\\Omega$ 上的平方 $L^2$ 范数由以下曲面积分定义：\n$$\n\\|R_{N}(\\cdot; \\theta)\\|_{L^{2}(\\partial\\Omega)}^{2} = \\int_{\\partial\\Omega} \\left( \\partial_{n}u_{\\theta}(x) - h(x) \\right)^{2} dS(x)\n$$\n其中 $dS(x)$ 是曲面微元。在机器学习和数值优化的背景下，通常的做法是使用平均误差，这使得损失项与域的大小无关。这可以通过边界的总表面积 $|\\partial\\Omega| = \\int_{\\partial\\Omega} 1 \\, dS(x)$ 进行归一化来实现。因此，均方边界误差为：\n$$\n\\mathcal{E}_{N}(\\theta) = \\frac{1}{|\\partial\\Omega|} \\int_{\\partial\\Omega} \\left( \\partial_{n}u_{\\theta}(x) - h(x) \\right)^{2} dS(x)\n$$\n下一步是将法向导数 $\\partial_{n}u_{\\theta}(x)$ 用可通过自动微分 (AD) 计算的量来表示。问题给出了法向导数的定义，即 $u_{\\theta}$ 的梯度在单位外法向量 $n(x)$ 上的投影：\n$$\n\\partial_{n}u_{\\theta}(x) = n(x)^{\\top}\\nabla_{x}u_{\\theta}(x)\n$$\n单位外法向量 $n(x)$ 是使用水平集函数 $\\phi(x)$ 定义的，其中 $\\partial\\Omega = \\{x \\in \\mathbb{R}^{d} | \\phi(x)=0\\}$。其公式为：\n$$\nn(x) = \\frac{\\nabla\\phi(x)}{\\|\\nabla\\phi(x)\\|}\n$$\n梯度的欧几里得范数是 $\\|\\nabla\\phi(x)\\| = \\sqrt{\\nabla\\phi(x)^{\\top}\\nabla\\phi(x)}$。将 $n(x)$ 的表达式代入法向导数的定义中，得到：\n$$\n\\partial_{n}u_{\\theta}(x) = \\left( \\frac{\\nabla\\phi(x)}{\\|\\nabla\\phi(x)\\|} \\right)^{\\top} \\nabla_{x}u_{\\theta}(x) = \\frac{\\nabla\\phi(x)^{\\top} \\nabla_{x}u_{\\theta}(x)}{\\sqrt{\\nabla\\phi(x)^{\\top}\\nabla\\phi(x)}}\n$$\n根据问题陈述，梯度 $\\nabla_{x}u_{\\theta}(x)$ 和 $\\nabla\\phi(x)$ 都可以通过 AD 计算。\n\n最后一步是使用给定的边界求积法则 $\\{(x_{i}^{b}, w_{i})\\}_{i=1}^{N_{b}}$ 来近似连续均方误差 $\\mathcal{E}_{N}(\\theta)$。求积法则将曲面 $\\mathcal{S}$ 上的积分近似为 $\\int_{\\mathcal{S}} f(x) dS(x) \\approx \\sum_{i} w_{i} f(x_{i})$。将此应用于我们的分子和分母：\n平方残差的积分近似为：\n$$\n\\int_{\\partial\\Omega} \\left( \\partial_{n}u_{\\theta}(x) - h(x) \\right)^{2} dS(x) \\approx \\sum_{i=1}^{N_{b}} w_{i} \\left( \\partial_{n}u_{\\theta}(x_{i}^{b}) - h(x_{i}^{b}) \\right)^{2}\n$$\n总表面积近似为：\n$$\n|\\partial\\Omega| = \\int_{\\partial\\Omega} 1 \\, dS(x) \\approx \\sum_{j=1}^{N_{b}} w_{j}\n$$\n损失 $L_{N}(\\theta)$ 是均方误差 $\\mathcal{E}_{N}(\\theta)$ 的离散近似。结合这些近似，我们得到归一化加权和：\n$$\nL_{N}(\\theta) = \\frac{\\sum_{i=1}^{N_{b}} w_{i} \\left( \\partial_{n}u_{\\theta}(x_{i}^{b}) - h(x_{i}^{b}) \\right)^{2}}{\\sum_{j=1}^{N_{b}} w_{j}}\n$$\n将在每个边界点 $x_{i}^{b}$ 处可通过 AD 计算的法向导数表达式代入此公式，即可得到边界损失的最终闭式表达式：\n$$\nL_{N}(\\theta) = \\frac{\\sum_{i=1}^{N_{b}} w_{i} \\left( \\frac{\\nabla\\phi(x_{i}^{b})^{\\top} \\nabla_{x}u_{\\theta}(x_{i}^{b})}{\\sqrt{\\nabla\\phi(x_{i}^{b})^{\\top}\\nabla\\phi(x_{i}^{b})}} - h(x_{i}^{b}) \\right)^{2}}{\\sum_{j=1}^{N_{b}} w_{j}}\n$$\n该表达式仅取决于网络输出 $u_{\\theta}$ 和水平集函数 $\\phi$（及其梯度）、边界点 $x_{i}^{b}$ 和权重 $w_{i}$，以及给定的通量函数 $h$，所有这些都是已知或可计算的。", "answer": "$$\n\\boxed{\\frac{\\sum_{i=1}^{N_{b}} w_{i} \\left( \\frac{\\nabla\\phi(x_{i}^{b})^{\\top} \\nabla_{x}u_{\\theta}(x_{i}^{b})}{\\sqrt{\\nabla\\phi(x_{i}^{b})^{\\top}\\nabla\\phi(x_{i}^{b})}} - h(x_{i}^{b}) \\right)^{2}}{\\sum_{j=1}^{N_{b}} w_{j}}}\n$$", "id": "3431045"}, {"introduction": "理论上构建了损失函数后，一个常见的实践陷阱是损失函数中不同项（如PDE残差项和边界项）的量级可能相差巨大，导致训练过程不稳定或偏向于优化其中一项而忽略其他物理约束。这个问题在涉及多尺度物理过程（如高佩克莱特数$Pe$下的平流-扩散问题）时尤为突出。[@problem_id:3431051]这个高级练习将指导你使用经典的无量纲化方法，为损失函数的各个部分推导出一套有物理原则的权重，从而确保训练的平衡性和鲁棒性，这是将PINN成功应用于复杂地球物理问题的关键一步。", "problem": "考虑一维空间区间 $x \\in [0,L]$ 和时间 $t \\geq 0$ 上的标量场 $u(x,t)$ 的平流-扩散偏微分方程 $u_t + a u_x = \\nu u_{xx}$，其中 $a$ 是平流速度，$\\nu$ 是扩散率，$L$ 是特征长度。通过最小化一个复合损失函数来训练一个物理信息神经网络 (PINN)，该损失函数由偏微分方程的均方残差以及边界和初始条件下的均方误差组成。在许多实际实现中，残差是在未进行无量纲化的情况下以物理单位计算的，这可能导致梯度不平衡和训练偏差，尤其是在大佩克莱数 $\\mathrm{Pe} = aL/\\nu$ 的情况下。本任务是基于无量纲化，为偏微分方程残差项与边界条件项推导出一个有原则的损失权重选择方法，从而使损失函数中的所有项都是无量纲的，并且量级相当。其目标是避免纯粹因为单位换算而非物理相关性而导致对扩散项或平流项的偏向。\n\n从基本原理出发，使用平流时间尺度 $T = L/a$ 和 $u$ 的特征场尺度 $U$ 对平流-扩散方程进行无量纲化，使得 $x = L \\hat{x}$，$t = T \\hat{t}$，以及 $u = U \\hat{u}$。使用链式法则将有量纲导数表示为无量纲导数的形式，并推导出方程的无量纲形式。据此，确定有量纲残差 $r = u_t + a u_x - \\nu u_{xx}$ 以及狄利克雷和诺伊曼边界条件的边界误差的自然尺度，并提出无量纲的均方损失权重 $w_{\\mathrm{pde}}^{\\mathrm{mean}}$，$w_{\\mathrm{bc,dir}}^{\\mathrm{mean}}$ 和 $w_{\\mathrm{bc,neu}}^{\\mathrm{mean}}$，这些权重在无量纲残差和误差均为一阶的假设下，能使均方损失变为无量纲且量级为一。明确说明当损失计算为平方误差和而非均值时如何调整这些权重（即，提供 $w_{\\mathrm{pde}}^{\\mathrm{sum}}$，$w_{\\mathrm{bc,dir}}^{\\mathrm{sum}}$ 和 $w_{\\mathrm{bc,neu}}^{\\mathrm{sum}}$ 作为各项样本数量的函数）。\n\n您的程序必须实现推导出的公式，并为每个测试用例计算以下输出：\n- 佩克莱数 $\\mathrm{Pe}$。\n- 推荐的均方权重 $w_{\\mathrm{pde}}^{\\mathrm{mean}}$、$w_{\\mathrm{bc,dir}}^{\\mathrm{mean}}$ 和 $w_{\\mathrm{bc,neu}}^{\\mathrm{mean}}$。\n- 相应的平方和权重 $w_{\\mathrm{pde}}^{\\mathrm{sum}}$、$w_{\\mathrm{bc,dir}}^{\\mathrm{sum}}$ 和 $w_{\\mathrm{bc,neu}}^{\\mathrm{sum}}$。\n\n边界条件类型在不同测试用例中有所不同。如果在某个测试用例中缺少某种边界条件类型，您必须为其权重输出 $0.0$。所有权重都是无量纲的，并且必须以浮点数形式输出。输出中不需要物理单位，因为根据构造，这些权重是无量纲的。为求完整，测试套件中的物理参数使用以下单位：$a$ 的单位是米/秒，$\\nu$ 的单位是平方米/秒，$L$ 的单位是米，$U$ 的单位与所选问题中的 $u$ 的单位一致。\n\n测试套件：\n1. 测试用例 A (大 $\\mathrm{Pe}$，仅狄利克雷条件)：$a = 1.0$ m/s，$L = 1.0$ m，$\\nu = 10^{-3}$ m$^2$/s，$U = 1.0$，偏微分方程配置点数 $N_f = 10000$，狄利克雷边界点数 $N_{\\mathrm{b,dir}} = 200$，诺伊曼边界点数 $N_{\\mathrm{b,neu}} = 0$。\n2. 测试用例 B (中等 $\\mathrm{Pe}$，狄利克雷和诺伊曼混合条件)：$a = 0.5$ m/s，$L = 1.0$ m，$\\nu = 0.1$ m$^2$/s，$U = 2.0$，$N_f = 5000$，$N_{\\mathrm{b,dir}} = 60$，$N_{\\mathrm{b,neu}} = 40$。\n3. 测试用例 C (极大 $\\mathrm{Pe}$，仅诺伊曼条件)：$a = 2.0$ m/s，$L = 2.0$ m，$\\nu = 10^{-5}$ m$^2$/s，$U = 1.0$，$N_f = 20000$，$N_{\\mathrm{b,dir}} = 0$，$N_{\\mathrm{b,neu}} = 400$。\n4. 测试用例 D (小域大 $\\mathrm{Pe}$，混合条件)：$a = 1.0$ m/s，$L = 0.1$ m，$\\nu = 10^{-3}$ m$^2$/s，$U = 0.5$，$N_f = 1000$，$N_{\\mathrm{b,dir}} = 50$，$N_{\\mathrm{b,neu}} = 50$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，其中每个元素对应一个测试用例，并且本身是一个包含七个浮点数的列表，顺序为 $[\\mathrm{Pe}, w_{\\mathrm{pde}}^{\\mathrm{mean}}, w_{\\mathrm{bc,dir}}^{\\mathrm{mean}}, w_{\\mathrm{bc,neu}}^{\\mathrm{mean}}, w_{\\mathrm{pde}}^{\\mathrm{sum}}, w_{\\mathrm{bc,dir}}^{\\mathrm{sum}}, w_{\\mathrm{bc,neu}}^{\\mathrm{sum}}]$。", "solution": "用户提供的问题已经过分析，被认为是有效的。它具有科学依据，是适定的、客观的，并且包含推导唯一且有意义的解所需的所有信息。任务是基于控制方程的系统性无量纲化，为应用于平流-扩散方程的物理信息神经网络 (PINN) 推导有原则的损失权重。这是计算物理和数值分析中的一种标准且稳健的技术。\n\n推导过程如下。\n\n一维平流-扩散偏微分方程 (PDE) 如下所示：\n$$\nu_t + a u_x = \\nu u_{xx}\n$$\n其中 $u(x,t)$ 是标量场，$a$ 是平流速度，$\\nu$ 是扩散率，$x \\in [0,L]$ 是空间坐标，$t \\ge 0$ 是时间。\n\n第一步是对方程进行无量纲化。我们引入以下用帽子符号 ($\\hat{\\cdot}$) 表示的无量纲变量：\n$$\nx = L \\hat{x}, \\quad t = T \\hat{t}, \\quad u = U \\hat{u}\n$$\n问题指定使用平流时间尺度 $T = L/a$。变量 $L$ 和 $U$ 分别代表特征长度和特征场尺度。\n\n使用链式法则，我们将有量纲导数用无量纲导数表示：\n时间导数 $u_t$：\n$$\nu_t = \\frac{\\partial u}{\\partial t} = \\frac{\\partial (U \\hat{u})}{\\partial \\hat{t}} \\frac{\\partial \\hat{t}}{\\partial t} = U \\frac{\\partial \\hat{u}}{\\partial \\hat{t}} \\frac{1}{T} = \\frac{U}{T} \\hat{u}_{\\hat{t}} = \\frac{U a}{L} \\hat{u}_{\\hat{t}}\n$$\n一阶空间导数 $u_x$：\n$$\nu_x = \\frac{\\partial u}{\\partial x} = \\frac{\\partial (U \\hat{u})}{\\partial \\hat{x}} \\frac{\\partial \\hat{x}}{\\partial x} = U \\frac{\\partial \\hat{u}}{\\partial \\hat{x}} \\frac{1}{L} = \\frac{U}{L} \\hat{u}_{\\hat{x}}\n$$\n二阶空间导数 $u_{xx}$：\n$$\nu_{xx} = \\frac{\\partial^2 u}{\\partial x^2} = \\frac{\\partial}{\\partial x} \\left( \\frac{U}{L} \\hat{u}_{\\hat{x}} \\right) = \\frac{U}{L} \\frac{\\partial \\hat{u}_{\\hat{x}}}{\\partial \\hat{x}} \\frac{\\partial \\hat{x}}{\\partial x} = \\frac{U}{L^2} \\hat{u}_{\\hat{x}\\hat{x}}\n$$\n\n将这些表达式代回原始偏微分方程中：\n$$\n\\left( \\frac{U a}{L} \\hat{u}_{\\hat{t}} \\right) + a \\left( \\frac{U}{L} \\hat{u}_{\\hat{x}} \\right) = \\nu \\left( \\frac{U}{L^2} \\hat{u}_{\\hat{x}\\hat{x}} \\right)\n$$\n为了获得规范的无量纲形式，我们将整个方程除以平流项的系数 $\\frac{Ua}{L}$：\n$$\n\\frac{U a}{L} \\left( \\hat{u}_{\\hat{t}} + \\hat{u}_{\\hat{x}} \\right) = \\frac{\\nu U}{L^2} \\hat{u}_{\\hat{x}\\hat{x}}\n$$\n$$\n\\hat{u}_{\\hat{t}} + \\hat{u}_{\\hat{x}} = \\frac{\\nu U}{L^2} \\left( \\frac{L}{U a} \\right) \\hat{u}_{\\hat{x}\\hat{x}}\n$$\n$$\n\\hat{u}_{\\hat{t}} + \\hat{u}_{\\hat{x}} = \\frac{\\nu}{aL} \\hat{u}_{\\hat{x}\\hat{x}}\n$$\n我们识别出无量纲的佩克莱数 $\\mathrm{Pe} = \\frac{aL}{\\nu}$，它代表了平流输运速率与扩散输运速率之比。无量纲的平流-扩散方程为：\n$$\n\\hat{u}_{\\hat{t}} + \\hat{u}_{\\hat{x}} = \\frac{1}{\\mathrm{Pe}} \\hat{u}_{\\hat{x}\\hat{x}}\n$$\nPINN 损失函数由 PDE 残差和边界/初始条件的加权均方误差组成。目标是选择权重，使得在假设底层无量纲误差为一阶的情况下，总损失中的每一项都是无量纲的且量级为一。\n\nPDE 残差定义为 $r = u_t + a u_x - \\nu u_{xx}$。其对应的无量纲残差为 $\\hat{r} = \\hat{u}_{\\hat{t}} + \\hat{u}_{\\hat{x}} - \\frac{1}{\\mathrm{Pe}} \\hat{u}_{\\hat{x}\\hat{x}}$。它们之间的关系是：\n$$\nr = \\frac{Ua}{L} \\left( \\hat{u}_{\\hat{t}} + \\hat{u}_{\\hat{x}} - \\frac{\\nu}{aL} \\hat{u}_{\\hat{x}\\hat{x}} \\right) = \\frac{Ua}{L} \\hat{r}\n$$\n假设无量纲残差 $\\hat{r}$ 的量级为一，即 $\\mathcal{O}(1)$，则有量纲残差 $r$ 的特征尺度为 $S_{\\mathrm{pde}} = \\frac{Ua}{L}$。均方 PDE 损失为 $L_{\\mathrm{pde}}^{\\mathrm{mean}} = \\frac{1}{N_f} \\sum_i r_i^2$。为了使加权损失 $w_{\\mathrm{pde}}^{\\mathrm{mean}} L_{\\mathrm{pde}}^{\\mathrm{mean}}$ 无量纲且量级为 $\\mathcal{O}(1)$，权重 $w_{\\mathrm{pde}}^{\\mathrm{mean}}$ 必须是特征尺度的平方的倒数：\n$$\nw_{\\mathrm{pde}}^{\\mathrm{mean}} = \\frac{1}{S_{\\mathrm{pde}}^2} = \\left(\\frac{L}{Ua}\\right)^2\n$$\n\n对于边界条件，我们分析误差的尺度。\n对于狄利克雷边界条件，误差的形式为 $u - g$，其中 $g$ 是指定的边界值。$u$ 的特征尺度是 $U$。因此，误差尺度为 $S_{\\mathrm{bc,dir}} = U$。相应的均方损失权重是：\n$$\nw_{\\mathrm{bc,dir}}^{\\mathrm{mean}} = \\frac{1}{S_{\\mathrm{bc,dir}}^2} = \\frac{1}{U^2}\n$$\n对于诺伊曼边界条件，误差的形式为 $u_x - h$，其中 $h$ 是指定的边界梯度。根据我们之前的推导，$u_x$ 的特征尺度是 $\\frac{U}{L}$。因此，误差尺度为 $S_{\\mathrm{bc,neu}} = \\frac{U}{L}$。相应的均方损失权重是：\n$$\nw_{\\mathrm{bc,neu}}^{\\mathrm{mean}} = \\frac{1}{S_{\\mathrm{bc,neu}}^2} = \\left(\\frac{L}{U}\\right)^2\n$$\n\n如果损失计算为平方误差和 (SSE) 而非均方误差 (MSE)，它们之间的关系是 $L^{\\mathrm{sum}} = N L^{\\mathrm{mean}}$，其中 $N$ 是样本点的数量。为确保加权损失保持不变，即 $w^{\\mathrm{sum}} L^{\\mathrm{sum}} = w^{\\mathrm{mean}} L^{\\mathrm{mean}}$，必须对权重进行调整：\n$$\nw^{\\mathrm{sum}} = \\frac{w^{\\mathrm{mean}}}{N}\n$$\n这给出了平方和损失的以下权重：\n$$\nw_{\\mathrm{pde}}^{\\mathrm{sum}} = \\frac{w_{\\mathrm{pde}}^{\\mathrm{mean}}}{N_f} = \\frac{1}{N_f} \\left(\\frac{L}{Ua}\\right)^2\n$$\n$$\nw_{\\mathrm{bc,dir}}^{\\mathrm{sum}} = \\frac{w_{\\mathrm{bc,dir}}^{\\mathrm{mean}}}{N_{\\mathrm{b,dir}}} = \\frac{1}{N_{\\mathrm{b,dir}}} \\frac{1}{U^2}\n$$\n$$\nw_{\\mathrm{bc,neu}}^{\\mathrm{sum}} = \\frac{w_{\\mathrm{bc,neu}}^{\\mathrm{mean}}}{N_{\\mathrm{b,neu}}} = \\frac{1}{N_{\\mathrm{b,neu}}} \\left(\\frac{L}{U}\\right)^2\n$$\n如果给定问题中不存在某种特定的边界条件类型（即其点数为 $0$），则其对应的损失项不存在，其权重应报告为 $0.0$。\n这些公式将被实现，用以计算给定测试用例所需的值。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef solve():\n    \"\"\"\n    Computes principled loss weights for PINN training of the advection-diffusion equation\n    based on nondimensionalization for a suite of test cases.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Format: (a, L, nu, U, N_f, N_b_dir, N_b_neu)\n    test_cases = [\n        # Test case A\n        (1.0, 1.0, 1e-3, 1.0, 10000, 200, 0),\n        # Test case B\n        (0.5, 1.0, 0.1, 2.0, 5000, 60, 40),\n        # Test case C\n        (2.0, 2.0, 1e-5, 1.0, 20000, 0, 400),\n        # Test case D\n        (1.0, 0.1, 1e-3, 0.5, 1000, 50, 50),\n    ]\n\n    results = []\n    for case in test_cases:\n        a, L, nu, U, N_f, N_b_dir, N_b_neu = case\n\n        # 1. Calculate Péclet number\n        pe = (a * L) / nu\n\n        # 2. Calculate mean-squared weights\n        # w_pde_mean = (L / (U * a))^2\n        # This can be simplified to 1 / ( (U*a/L)^2 )\n        # To avoid potential division by zero if a or U are zero,\n        # although they are not in the test cases.\n        if U == 0.0 or a == 0.0:\n            w_pde_mean = 0.0 # Or handle as an error, but 0 follows the logic for absent terms.\n        else:\n            w_pde_mean = (L / (U * a))**2\n\n        # w_bc,dir_mean = 1 / U^2\n        if N_b_dir == 0 or U == 0.0:\n            w_bc_dir_mean = 0.0\n        else:\n            w_bc_dir_mean = 1.0 / (U**2)\n\n        # w_bc,neu_mean = (L / U)^2\n        if N_b_neu == 0 or U == 0.0:\n            w_bc_neu_mean = 0.0\n        else:\n            w_bc_neu_mean = (L / U)**2\n\n        # 3. Calculate sum-of-squares weights\n        # w_pde_sum = w_pde_mean / N_f\n        if N_f == 0:\n            w_pde_sum = 0.0\n        else:\n            w_pde_sum = w_pde_mean / N_f\n\n        # w_bc,dir_sum = w_bc,dir_mean / N_b_dir\n        if N_b_dir == 0:\n            w_bc_dir_sum = 0.0\n        else:\n            w_bc_dir_sum = w_bc_dir_mean / N_b_dir\n\n        # w_bc,neu_sum = w_bc,neu_mean / N_b_neu\n        if N_b_neu == 0:\n            w_bc_neu_sum = 0.0\n        else:\n            w_bc_neu_sum = w_bc_neu_mean / N_b_neu\n\n        # Collect the results for this case\n        case_results = [\n            pe,\n            w_pde_mean,\n            w_bc_dir_mean,\n            w_bc_neu_mean,\n            w_pde_sum,\n            w_bc_dir_sum,\n            w_bc_neu_sum,\n        ]\n        results.append(f\"[{','.join(map(str, case_results))}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3431051"}]}