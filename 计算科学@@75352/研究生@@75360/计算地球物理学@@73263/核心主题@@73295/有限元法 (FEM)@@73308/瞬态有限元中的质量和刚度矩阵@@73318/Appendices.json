{"hands_on_practices": [{"introduction": "本次练习为理解时变有限元法奠定了基础。通过为一个简单的一维波动问题推导一致质量矩阵和集中质量矩阵，您将探索在数值精度与计算效率之间的基本权衡。这项练习将阐明质量矩阵公式的选择如何直接影响数值色散，以及更关键地，如何影响显式时间积分格式的稳定性约束。[@problem_id:3609807]", "problem": "考虑一根均匀、各向同性的细长地球物理杆中的轴向波传播，其均匀横截面积为 $A$、杨氏模量为 $E$、材料密度为 $\\rho$、总长度为 $L$。在无体力的情况下，轴向位移场 $u(x,t)$ 满足一维 ($1\\mathrm{D}$) 线性动量平衡方程（即轴向波动方程）：$\\rho A \\,\\frac{\\partial^{2}u}{\\partial t^{2}} - E A \\,\\frac{\\partial^{2}u}{\\partial x^{2}} = 0$。使用有限元法 (FEM)，将空间域离散为 $N$ 个长度为 $h = L/N$ 的均匀线性有限元，每个单元上使用标准线性形函数。\n\n(a) 从 Galerkin 弱形式和单元矩阵的定义出发，推导单个长度为 $h$ 的线性单元的单元刚度矩阵 $K_{e}$ 和单元一致质量矩阵 $M_{e}^{\\mathrm{cons}}$。然后，通过执行保持总单元质量的对角质量集中，推导单元集中质量矩阵 $M_{e}^{\\mathrm{lump}}$。\n\n(b) 假设一个均匀无限网格（或等效地，一个具有 $N \\gg 1$ 和周期性边界条件的周期性域），从而使得组装后的算子在内部节点处是平移不变的。组装单元贡献以获得全局半离散方程 $M \\ddot{\\mathbf{u}} + K \\mathbf{u} = \\mathbf{0}$，并通过考虑形式为 $u_{j}(t) = U \\exp(i j \\theta) \\, q(t)$ 的模态解来进行离散傅里叶分析，其中 $j$ 是节点索引，$\\theta \\in [0,\\pi]$ 是无量纲波数，$q(t)$ 是模态振幅。推导一致质量和集中质量两种公式的色散关系 $\\omega^{2}(\\theta)$，其中 $\\omega^{2}(\\theta)$ 是由 $\\theta$ 参数化的广义特征值问题 $K \\phi = \\omega^{2} M \\phi$ 的广义特征值。\n\n(c) 考虑使用中心差分法 (CDM) 对半离散系统进行显式时间积分，这是一种求解 $M \\ddot{\\mathbf{u}} + K \\mathbf{u} = \\mathbf{0}$ 的二阶精度显式格式。对具有频率 $\\omega$ 的单模态的标量更新方程进行线性稳定性分析，推导出时间步长 $\\Delta t$ 关于半离散算子最大模态频率 $\\omega_{\\max}$ 的稳定性条件。然后，使用在(b)部分中求得的色散关系，确定一致质量矩阵和集中质量矩阵的 $\\omega_{\\max}$，并计算最大稳定时间步长之比，\n$$\n\\frac{\\Delta t_{\\max}^{\\mathrm{lump}}}{\\Delta t_{\\max}^{\\mathrm{cons}}}.\n$$\n\n将最终答案表示为单个精确值。无需单位。无需四舍五入。首次使用时需定义所有缩略语，例如有限元法 (FEM) 和中心差分法 (CDM)。", "solution": "用户提供了计算力学领域一个有效且适定的问题陈述。我们开始进行完整解答。\n\n一维 ($1\\mathrm{D}$) 杆中轴向波传播的控制方程如下：\n$$\n\\rho A \\,\\frac{\\partial^{2}u}{\\partial t^{2}} - E A \\,\\frac{\\partial^{2}u}{\\partial x^{2}} = 0\n$$\n其中 $u(x,t)$ 是轴向位移，$\\rho$ 是材料密度，$A$ 是横截面积，$E$ 是杨氏模量。\n\n(a) 单元矩阵的推导\n\n我们首先建立控制方程的 Galerkin 弱形式。用一个试函数 $w(x)$ 乘以方程，并在空间域 $[0, L]$ 上积分，得到：\n$$\n\\int_{0}^{L} w \\left( \\rho A \\,\\frac{\\partial^{2}u}{\\partial t^{2}} - E A \\,\\frac{\\partial^{2}u}{\\partial x^{2}} \\right) dx = 0\n$$\n对第二项进行分部积分，得到：\n$$\n\\int_{0}^{L} \\rho A w \\frac{\\partial^{2}u}{\\partial t^{2}} \\, dx + \\int_{0}^{L} E A \\frac{\\partial w}{\\partial x} \\frac{\\partial u}{\\partial x} \\, dx - \\left[ w E A \\frac{\\partial u}{\\partial x} \\right]_{0}^{L} = 0\n$$\n边界项由边界条件处理。为了推导单元矩阵，我们考虑一个长度为 $h = x_2 - x_1$ 的一般单元 $\\Omega_e = [x_1, x_2]$。\n\n在该单元内，位移场 $u(x,t)$ 使用有限元法 (FEM) 进行近似。对于一个线性单元，我们使用线性形函数 $N_1(x)$ 和 $N_2(x)$：\n$$\nu(x,t) \\approx u_h(x,t) = N_1(x) u_1(t) + N_2(x) u_2(t) = \\mathbf{N}(x) \\mathbf{u}_e(t)\n$$\n其中 $\\mathbf{u}_e(t) = [u_1(t), u_2(t)]^T$ 是节点位移。试函数 $w(x)$ 从相同的函数空间中选取，即 $w(x) = \\mathbf{N}(x) \\mathbf{c}_e$，其中 $\\mathbf{c}_e$ 是一个任意常数向量。\n\n在局部坐标系 $\\xi = (x-x_1)/h \\in [0, 1]$ 中，线性形函数及其关于 $x$ 的导数是：\n$$\nN_1(\\xi) = 1-\\xi, \\quad N_2(\\xi) = \\xi\n$$\n$$\n\\frac{dN_1}{dx} = \\frac{dN_1}{d\\xi}\\frac{d\\xi}{dx} = (-1)\\frac{1}{h}, \\quad \\frac{dN_2}{dx} = \\frac{dN_2}{d\\xi}\\frac{d\\xi}{dx} = (1)\\frac{1}{h}\n$$\n所以形函数导数矩阵为 $\\mathbf{N}'(x) = \\frac{1}{h} \\begin{pmatrix} -1 & 1 \\end{pmatrix}$。\n\n将 FEM 近似代入单个单元的弱形式，得到：\n$$\n\\mathbf{c}_e^T \\left( \\int_{\\Omega_e} \\rho A \\mathbf{N}^T \\mathbf{N} \\, dx \\right) \\ddot{\\mathbf{u}}_e(t) + \\mathbf{c}_e^T \\left( \\int_{\\Omega_e} E A (\\mathbf{N}')^T \\mathbf{N}' \\, dx \\right) \\mathbf{u}_e(t) = \\mathbf{0}\n$$\n由于这对任意 $\\mathbf{c}_e$ 都必须成立，我们得到单元级运动方程 $M_e \\ddot{\\mathbf{u}}_e + K_e \\mathbf{u}_e = \\mathbf{0}$，其中 $K_e$ 是单元刚度矩阵，$M_e$ 是单元质量矩阵。\n\n单元刚度矩阵 $K_e$ 为：\n$$\nK_e = \\int_{0}^{h} E A (\\mathbf{N}')^T \\mathbf{N}' \\, dx = E A \\int_{0}^{h} \\begin{pmatrix} (-1/h)^2 & (-1/h)(1/h) \\\\ (1/h)(-1/h) & (1/h)^2 \\end{pmatrix} dx = \\frac{EA}{h^2} \\int_{0}^{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix} dx\n$$\n$$\nK_e = \\frac{EA}{h} \\begin{pmatrix} 1 & -1 \\\\ -1 & 1 \\end{pmatrix}\n$$\n\n单元一致质量矩阵 $M_e^{\\mathrm{cons}}$ 为：\n$$\nM_e^{\\mathrm{cons}} = \\int_{0}^{h} \\rho A \\mathbf{N}^T \\mathbf{N} \\, dx = \\rho A \\int_{0}^{1} \\begin{pmatrix} (1-\\xi)^2 & \\xi(1-\\xi) \\\\ \\xi(1-\\xi) & \\xi^2 \\end{pmatrix} h \\, d\\xi\n$$\n计算积分：\n$\\int_{0}^{1} (1-\\xi)^2 d\\xi = 1/3$, $\\int_{0}^{1} \\xi^2 d\\xi = 1/3$, $\\int_{0}^{1} \\xi(1-\\xi) d\\xi = 1/6$。\n$$\nM_e^{\\mathrm{cons}} = \\rho A h \\begin{pmatrix} 1/3 & 1/6 \\\\ 1/6 & 1/3 \\end{pmatrix} = \\frac{\\rho A h}{6} \\begin{pmatrix} 2 & 1 \\\\ 1 & 2 \\end{pmatrix}\n$$\n\n为了获得单元集中质量矩阵 $M_e^{\\mathrm{lump}}$，我们执行行和集中法，即将每行各项之和置于对角线上，这能确保总单元质量（$\\rho A h$）守恒。\n第 1 行的和：$\\frac{\\rho A h}{6}(2+1) = \\frac{\\rho A h}{2}$。\n第 2 行的和：$\\frac{\\rho A h}{6}(1+2) = \\frac{\\rho A h}{2}$。\n$$\nM_e^{\\mathrm{lump}} = \\frac{\\rho A h}{2} \\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix}\n$$\n\n(b) 色散关系\n\n对于无限或周期性网格，我们可以通过组装相邻单元 $(j-1, j)$ 和 $(j, j+1)$ 的贡献，来写出一般内部节点 $j$ 的运动方程。\n\n节点 $j$ 处的刚度贡献：\n来自单元 $(j - 1, j)$：$(\\frac{EA}{h}) (-u_{j-1} + u_j)$\n来自单元 $(j, j + 1)$：$(\\frac{EA}{h}) (u_j - u_{j+1})$\n节点 $j$ 的总和：$(K\\mathbf{u})_j = \\frac{EA}{h}(-u_{j-1} + 2u_j - u_{j+1})$。\n\n节点 $j$ 处的一致质量贡献：\n来自单元 $(j - 1, j)$：$\\frac{\\rho A h}{6}(u_{j-1} + 2u_j)$\n来自单元 $(j, j + 1)$：$\\frac{\\rho A h}{6}(2u_j + u_{j+1})$\n节点 $j$ 的总和：$(M^{\\mathrm{cons}}\\mathbf{u})_j = \\frac{\\rho A h}{6}(u_{j-1} + 4u_j + u_{j+1})$。\n\n节点 $j$ 处的集中质量贡献：\n全局集中质量矩阵是对角的，每个对角线元素是来自相邻单元贡献的总和。$(M^{\\mathrm{lump}})_{jj} = \\frac{\\rho A h}{2} + \\frac{\\rho A h}{2} = \\rho A h$。\n节点 $j$ 的总和：$(M^{\\mathrm{lump}}\\mathbf{u})_j = \\rho A h u_j$。\n\n我们考虑形式为 $u_j(t) = U \\exp(i(j\\theta - \\omega t))$ 的模态解，这意味着 $\\ddot{u}_j(t) = -\\omega^2 u_j(t)$ 且 $u_{j \\pm 1} = u_j \\exp(\\pm i\\theta)$。我们将这些代入组装后的节点方程。\n\n对于一致质量公式：\n$M^{\\mathrm{cons}}\\ddot{\\mathbf{u}} + K\\mathbf{u} = \\mathbf{0}$ 在节点 $j$ 处变为：\n$$\n-\\omega_{\\mathrm{cons}}^2 \\frac{\\rho A h}{6}(u_{j-1} + 4u_j + u_{j+1}) + \\frac{EA}{h}(-u_{j-1} + 2u_j - u_{j+1}) = 0\n$$\n除以 $u_j$ 并代入指数关系式：\n$$\n-\\omega_{\\mathrm{cons}}^2 \\frac{\\rho A h}{6}(\\exp(-i\\theta) + 4 + \\exp(i\\theta)) + \\frac{EA}{h}(-\\exp(-i\\theta) + 2 - \\exp(i\\theta)) = 0\n$$\n$$\n-\\omega_{\\mathrm{cons}}^2 \\frac{\\rho A h}{6}(4 + 2\\cos\\theta) + \\frac{EA}{h}(2 - 2\\cos\\theta) = 0\n$$\n定义波速 $c = \\sqrt{E/\\rho}$：\n$$\n\\omega_{\\mathrm{cons}}^2(\\theta) = \\frac{EA}{\\rho A h^2} \\frac{2(1 - \\cos\\theta)}{(4 + 2\\cos\\theta)/6} = \\frac{c^2}{h^2} \\frac{6(1-\\cos\\theta)}{2+\\cos\\theta}\n$$\n\n对于集中质量公式：\n$M^{\\mathrm{lump}}\\ddot{\\mathbf{u}} + K\\mathbf{u} = \\mathbf{0}$ 在节点 $j$ 处变为：\n$$\n-\\omega_{\\mathrm{lump}}^2 (\\rho A h u_j) + \\frac{EA}{h}(-u_{j-1} + 2u_j - u_{j+1}) = 0\n$$\n$$\n-\\omega_{\\mathrm{lump}}^2 \\rho A h + \\frac{EA}{h}(-\\exp(-i\\theta) + 2 - \\exp(i\\theta)) = 0\n$$\n$$\n-\\omega_{\\mathrm{lump}}^2 \\rho A h + \\frac{EA}{h}(2 - 2\\cos\\theta) = 0\n$$\n$$\n\\omega_{\\mathrm{lump}}^2(\\theta) = \\frac{EA}{\\rho A h^2} 2(1-\\cos\\theta) = \\frac{2c^2}{h^2}(1-\\cos\\theta) = \\frac{4c^2}{h^2}\\sin^2\\left(\\frac{\\theta}{2}\\right)\n$$\n\n(c) 稳定性分析和时间步长之比\n\n使用中心差分法 (CDM) 进行时间积分。对于频率为 $\\omega$ 的单模态，控制方程为 $\\ddot{q} + \\omega^2 q = 0$。CDM 离散格式为：\n$$\n\\frac{q^{n+1} - 2q^n + q^{n-1}}{(\\Delta t)^2} + \\omega^2 q^n = 0\n$$\n寻求形式为 $q^n = \\lambda^n$ 的解，得到放大因子 $\\lambda$ 的特征方程：\n$$\n\\lambda^2 - (2 - (\\omega \\Delta t)^2)\\lambda + 1 = 0\n$$\n为保证稳定性，所有根必须满足 $|\\lambda| \\le 1$。这导出了 CDM 众所周知的稳定性条件：\n$$\n|\\omega \\Delta t| \\le 2\n$$\n为使整个系统稳定，时间步长 $\\Delta t$ 必须受系统中的最大频率 $\\omega_{\\max}$ 的限制：\n$$\n\\Delta t \\le \\frac{2}{\\omega_{\\max}} \\quad \\implies \\quad \\Delta t_{\\max} = \\frac{2}{\\omega_{\\max}}\n$$\n我们通过在无量纲波数范围 $\\theta \\in [0, \\pi]$ 上最大化 $\\omega(\\theta)$ 来找到 $\\omega_{\\max}$。\n\n对于一致质量，函数 $\\omega_{\\mathrm{cons}}^2(\\theta) = \\frac{c^2}{h^2} \\frac{6(1-\\cos\\theta)}{2+\\cos\\theta}$ 在 $\\theta \\in [0, \\pi]$ 上是单调递增的。最大值出现在 $\\theta = \\pi$ 处，此时 $\\cos\\pi = -1$。\n$$\n(\\omega_{\\mathrm{cons, max}})^2 = \\omega_{\\mathrm{cons}}^2(\\pi) = \\frac{c^2}{h^2} \\frac{6(1 - (-1))}{2 + (-1)} = \\frac{12c^2}{h^2}\n$$\n$$\n\\omega_{\\mathrm{cons, max}} = \\frac{c}{h}\\sqrt{12} = \\frac{2\\sqrt{3}c}{h}\n$$\n最大稳定时间步长为 $\\Delta t_{\\max}^{\\mathrm{cons}} = \\frac{2}{\\omega_{\\mathrm{cons, max}}} = \\frac{2}{2\\sqrt{3}c/h} = \\frac{h}{\\sqrt{3}c}$。\n\n对于集中质量，函数 $\\omega_{\\mathrm{lump}}^2(\\theta) = \\frac{4c^2}{h^2}\\sin^2(\\theta/2)$ 在 $\\theta \\in [0, \\pi]$ 上也是单调递增的。最大值出现在 $\\theta = \\pi$ 处。\n$$\n(\\omega_{\\mathrm{lump, max}})^2 = \\omega_{\\mathrm{lump}}^2(\\pi) = \\frac{4c^2}{h^2}\\sin^2\\left(\\frac{\\pi}{2}\\right) = \\frac{4c^2}{h^2}\n$$\n$$\n\\omega_{\\mathrm{lump, max}} = \\frac{2c}{h}\n$$\n最大稳定时间步长为 $\\Delta t_{\\max}^{\\mathrm{lump}} = \\frac{2}{\\omega_{\\mathrm{lump, max}}} = \\frac{2}{2c/h} = \\frac{h}{c}$。\n\n最后，我们计算最大稳定时间步长之比：\n$$\n\\frac{\\Delta t_{\\max}^{\\mathrm{lump}}}{\\Delta t_{\\max}^{\\mathrm{cons}}} = \\frac{h/c}{h/(\\sqrt{3}c)} = \\sqrt{3}\n$$", "answer": "$$\\boxed{\\sqrt{3}}$$", "id": "3609807"}, {"introduction": "在掌握了基础知识之后，本次练习将解决一个在实际三维模拟中至关重要的挑战：由减缩积分引起的秩亏问题。您将研究为何这种计算上高效的技术会导致奇异的单元质量矩阵，并探索两种常见的稳定化策略来恢复其正定性。这个动手编程问题展示了如何诊断和修正非物理的“沙漏”模式，这是开发稳健模拟软件的一项关键技能。[@problem_id:3609811]", "problem": "考虑一个用于计算地球物理学的时间相关标量波动方程，通过有限元法（FEM）进行离散化所产生的半离散格式。空间域被划分为四面体单元，并使用线性 Lagrange 形函数。四面体上的单元质量矩阵由基于质量密度的单元双线性形式定义。从标量场的动量平衡弱形式出发，单元质量矩阵的项是形函数与密度乘积在单元体积上的积分。\n\n您的任务：\n\n1) 严格从第一性原理出发，不引用任何预先推导的有限元质量公式，证明对于线性四面体单元，如果使用位于形心的单点缩减积分，所得到的单元质量矩阵对于任何非退化单元都是秩亏的。您的推导必须：\n- 从单元质量双线性形式的定义 $m(u,v) = \\int_{T} \\rho \\, u \\, v \\, \\mathrm{d}V$ 开始，其中 $T$ 是一个四面体，$\\rho$ 在 $T$ 上为常数。\n- 仅使用以下事实：四面体上的线性 Lagrange 形函数 $\\{N_i\\}_{i=1}^{4}$ 满足 $\\sum_{i=1}^{4} N_i = 1$，每个 $N_i$ 是仿射的，并且在四面体的形心处，每个重心坐标都等于 $1/4$。\n- 推断出缩减积分质量矩阵的代数结构及其特征结构。\n\n2) 提出并从数学上证明两种独立的稳定化策略，将秩亏的缩减积分质量矩阵转换为对称正定矩阵，同时保持单元总质量。每种策略必须根据缩减积分矩阵和基本代数算子来定义。对每种策略，提供一个证明概要，说明：\n- 对于任何非零单元体积，修改后的矩阵是对称正定的。\n- 全一向量是与缩减积分矩阵中相同特征值相关联的特征向量，因此单元总质量得以保持。\n\n3) 实现一个算法，对于一个由其顶点坐标 $\\mathbf{x}_1,\\mathbf{x}_2,\\mathbf{x}_3,\\mathbf{x}_4 \\in \\mathbb{R}^3$ 指定的给定四面体，计算：\n- 单元体积 $V = \\frac{1}{6} \\left| \\det\\left([\\mathbf{x}_2-\\mathbf{x}_1,\\mathbf{x}_3-\\mathbf{x}_1,\\mathbf{x}_4-\\mathbf{x}_1]\\right) \\right|$。\n- 具有恒定密度 $\\rho$ 的线性四面体形函数的缩减积分质量矩阵 $M^{\\mathrm{red}}$。\n- 通过对 $M^{\\mathrm{red}}$ 进行行求和集中得到的集中质量矩阵 $M^{\\mathrm{lump}}$。\n- 对用户指定的 $\\gamma \\in (0,1]$ 进行混合稳定化 $M_{\\gamma} = (1-\\gamma) M^{\\mathrm{red}} + \\gamma M^{\\mathrm{lump}}$。\n- 基于投影的沙漏稳定化 $M_{\\beta} = M^{\\mathrm{red}} + \\beta \\rho V P$，其中 $P = I - \\frac{1}{4}\\mathbf{1}\\mathbf{1}^{\\mathsf{T}}$，$\\mathbf{1} = [1,1,1,1]^{\\mathsf{T}}$，$I$ 是 $4\\times 4$ 单位矩阵，且 $\\beta > 0$。\n- $M^{\\mathrm{red}}$、$M_{\\gamma}$ 和 $M_{\\beta}$ 各自的最小特征值。\n- 一个基于 $M^{\\mathrm{red}}$ 的最小特征值是否小于或等于容差 $\\tau$ 的奇异性布尔指标。\n\n假设使用无量纲单位：设置质量密度 $\\rho = 1$，所有坐标均无量纲。不出现角度。\n\n测试套件：\n使用以下四个四面体和稳定化参数。对于每种情况，设置 $\\rho = 1$，混合参数 $\\gamma = 0.1$，投影参数 $\\beta = 0.05$。奇异性容差为 $\\tau = 10^{-14}$。\n\n- 情况 A（形态良好，“理想路径”）：$\\mathbf{x}_1=(0,0,0)$, $\\mathbf{x}_2=(1,0,0)$, $\\mathbf{x}_3=(0,1,0)$, $\\mathbf{x}_4=(0,0,1)$。\n- 情况 B（薄片，中度近共面）：$\\mathbf{x}_1=(0,0,0)$, $\\mathbf{x}_2=(1,0,0)$, $\\mathbf{x}_3=(0,1,0)$, $\\mathbf{x}_4=(10^{-6},10^{-6},10^{-6})$。\n- 情况 C（极端薄片）：$\\mathbf{x}_1=(0,0,0)$, $\\mathbf{x}_2=(1,0,0)$, $\\mathbf{x}_3=(0,1,0)$, $\\mathbf{x}_4=(10^{-12},10^{-12},10^{-12})$。\n- 情况 D（退化边界，共面）：$\\mathbf{x}_1=(0,0,0)$, $\\mathbf{x}_2=(1,0,0)$, $\\mathbf{x}_3=(0,1,0)$, $\\mathbf{x}_4=(0,0,0)$。\n\n要求输出：\n对于每种情况，计算并报告列表 $[\\mathrm{isSingular}, \\lambda_{\\min}(M^{\\mathrm{red}}), \\lambda_{\\min}(M_{\\gamma}), \\lambda_{\\min}(M_{\\beta})]$，其中如果 $\\lambda_{\\min}(M^{\\mathrm{red}}) \\le \\tau$，则 $\\mathrm{isSingular}$ 为 $1$，否则为 $0$。您的程序应生成单行输出，其中包含四个情况的结果，格式为这些列表的逗号分隔列表，并用方括号括起来（例如，$[[ \\cdot,\\cdot,\\cdot,\\cdot],[\\cdot,\\cdot,\\cdot,\\cdot],[\\cdot,\\cdot,\\cdot,\\cdot],[\\cdot,\\cdot,\\cdot,\\cdot]]$）。\n\n科学和数值要求：\n- 所有推理必须与线性动量平衡的弱形式和标准的有限元法定义一致。\n- 您的算法应对 $4 \\times 4$ 矩阵使用对称特征求解器。\n- 设计必须涵盖形态良好和近退化的四面体，并明确包括完全退化的边界情况，以展示失效模式。\n\n所有答案都是无量纲的，并应按规定提供为浮点数和整数。不需要其他单位或角度规格。最终打印的行必须严格遵循上述列表格式，不得包含额外文本。", "solution": "该问题被验证为科学上合理、适定且完整。它涉及偏微分方程计算方法中的一个标准主题，特别是有限元法（FEM）中质量矩阵的性质和稳定化。所有给定条件都是一致的，足以得到唯一解。\n\n解答分为三部分，对应于问题陈述中的任务。\n\n### 第一部分：缩减积分质量矩阵的秩亏性\n\n四面体单元 $T$ 上标量场 $u$ 的单元质量矩阵源于潜在物理原理（如动量平衡）的弱形式。质量矩阵的项 $M_{ij}$ 由涉及有限元基函数 $\\{N_i\\}_{i=1}^4$ 的双线性形式给出。对于单元上恒定的质量密度 $\\rho$，其形式为：\n$$\nM_{ij} = \\int_T \\rho N_i(\\mathbf{x}) N_j(\\mathbf{x}) \\, \\mathrm{d}V\n$$\n其中 $N_i$ 和 $N_j$ 是对应于四面体节点 $i$ 和 $j$ 的线性 Lagrange 形函数。\n\n问题要求使用在单元形心 $\\mathbf{x}_c$ 处的单点缩减积分。这将单元体积 $V$ 上的积分近似为：\n$$\n\\int_T f(\\mathbf{x}) \\, \\mathrm{d}V \\approx V \\cdot f(\\mathbf{x}_c)\n$$\n将此数值求积法则应用于质量矩阵积分，我们得到缩减积分质量矩阵 $M^{\\mathrm{red}}$：\n$$\nM^{\\mathrm{red}}_{ij} = \\rho V N_i(\\mathbf{x}_c) N_j(\\mathbf{x}_c)\n$$\n单形（如四面体）上线性 Lagrange 形函数的一个基本性质是它们与重心坐标相同。四面体的形心是所有重心坐标都相等的点。对于有4个顶点的四面体，形心处的重心坐标是 $(\\frac{1}{4}, \\frac{1}{4}, \\frac{1}{4}, \\frac{1}{4})$。因此，每个形函数在形心处的值是：\n$$\nN_i(\\mathbf{x}_c) = \\frac{1}{4} \\quad \\text{for } i=1, 2, 3, 4\n$$\n将此代入 $M^{\\mathrm{red}}_{ij}$ 的表达式：\n$$\nM^{\\mathrm{red}}_{ij} = \\rho V \\left(\\frac{1}{4}\\right) \\left(\\frac{1}{4}\\right) = \\frac{\\rho V}{16}\n$$\n对于矩阵的所有项 $(i,j)$，这是一个常数。因此，矩阵 $M^{\\mathrm{red}}$ 可以写成代数形式。令 $\\mathbf{1}$ 为 $4 \\times 1$ 的全一列向量，即 $\\mathbf{1} = [1, 1, 1, 1]^{\\mathsf{T}}$。那么 $M^{\\mathrm{red}}$ 是：\n$$\nM^{\\mathrm{red}} = \\frac{\\rho V}{16}\n\\begin{pmatrix}\n1 & 1 & 1 & 1 \\\\\n1 & 1 & 1 & 1 \\\\\n1 & 1 & 1 & 1 \\\\\n1 & 1 & 1 & 1\n\\end{pmatrix}\n= \\frac{\\rho V}{16} \\mathbf{1}\\mathbf{1}^{\\mathsf{T}}\n$$\n这是一个向量 $\\mathbf{1}$ 与自身的标量倍外积。对于任何非零向量 $\\mathbf{v}$，形式为 $\\mathbf{v}\\mathbf{v}^{\\mathsf{T}}$ 的矩阵秩为 $1$。其列空间由向量 $\\mathbf{v}$ 本身张成。由于 $M^{\\mathrm{red}}$ 是一个 $4 \\times 4$ 矩阵，秩为 $1$（假设为非退化单元，其中 $V>0$），其零度（其零空间的维度）为 $4-1=3$。根据定义，具有非平凡零空间的矩阵是奇异的或秩亏的。\n\n为了确定其特征结构，我们求其特征值和特征向量。\n1.  考虑特征向量 $\\mathbf{1}$：\n    $$\n    M^{\\mathrm{red}} \\mathbf{1} = \\left( \\frac{\\rho V}{16} \\mathbf{1}\\mathbf{1}^{\\mathsf{T}} \\right) \\mathbf{1} = \\frac{\\rho V}{16} \\mathbf{1} (\\mathbf{1}^{\\mathsf{T}}\\mathbf{1}) = \\frac{\\rho V}{16} \\mathbf{1} (4) = \\frac{\\rho V}{4} \\mathbf{1}\n    $$\n    因此，$\\mathbf{1}$ 是一个特征向量，其对应的非零特征值为 $\\lambda_1 = \\frac{\\rho V}{4}$。这个特征值代表单元的总质量 $\\rho V$ 分布在节点上（因为 $\\sum_{i,j} M^{\\mathrm{red}}_{ij} = 16 \\times \\frac{\\rho V}{16} = \\rho V$）。\n\n2.  考虑任何与 $\\mathbf{1}$ 正交的向量 $\\mathbf{v}$，即 $\\mathbf{1}^{\\mathsf{T}}\\mathbf{v} = \\sum_{i=1}^4 v_i = 0$。\n    $$\n    M^{\\mathrm{red}} \\mathbf{v} = \\left( \\frac{\\rho V}{16} \\mathbf{1}\\mathbf{1}^{\\mathsf{T}} \\right) \\mathbf{v} = \\frac{\\rho V}{16} \\mathbf{1} (\\mathbf{1}^{\\mathsf{T}}\\mathbf{v}) = \\frac{\\rho V}{16} \\mathbf{1} (0) = \\mathbf{0} = 0 \\cdot \\mathbf{v}\n    $$\n    任何这样的向量 $\\mathbf{v}$ 都是特征值为 $0$ 的特征向量。在 $\\mathbb{R}^4$ 中与 $\\mathbf{1}$ 正交的向量空间是一个 $3$ 维子空间。这是 $M^{\\mathrm{red}}$ 的零空间。这些零特征值模式通常被称为“沙漏模式”或“伪零能模式”，它们可能在数值模拟中引起灾难性的不稳定性。\n\n总之，对于任何非退化四面体（$V>0$），缩减积分质量矩阵 $M^{\\mathrm{red}}$ 有一个特征值 $\\lambda_1 = \\frac{\\rho V}{4}$ 和三个零特征值（$\\lambda_2 = \\lambda_3 = \\lambda_4 = 0$）。零特征值的存在证实了其秩亏性。\n\n### 第二部分：稳定化策略\n\n目标是修改 $M^{\\mathrm{red}}$ 以创建一个对称正定（SPD）矩阵，该矩阵只有正特征值，同时保持单元总质量。这等同于确保修改后的矩阵 $M_{\\mathrm{stab}}$ 满足 $M_{\\mathrm{stab}}\\mathbf{1} = \\lambda_1 \\mathbf{1} = \\frac{\\rho V}{4}\\mathbf{1}$。\n\n#### 策略1：混合稳定化\n\n对于某个参数 $\\gamma \\in (0,1]$，将修改后的矩阵 $M_{\\gamma}$ 定义为缩减积分矩阵 $M^{\\mathrm{red}}$ 和集中质量矩阵 $M^{\\mathrm{lump}}$ 的混合：\n$$\nM_{\\gamma} = (1-\\gamma) M^{\\mathrm{red}} + \\gamma M^{\\mathrm{lump}}\n$$\n集中质量矩阵 $M^{\\mathrm{lump}}$ 是一个对角矩阵，其中每个对角项是原始矩阵对应行的和。对于 $M^{\\mathrm{red}}$，每行的和是 $\\sum_{j=1}^4 M^{\\mathrm{red}}_{ij} = \\sum_{j=1}^4 \\frac{\\rho V}{16} = 4 \\frac{\\rho V}{16} = \\frac{\\rho V}{4}$。因此，\n$$\nM^{\\mathrm{lump}} = \\text{diag}\\left(\\frac{\\rho V}{4}, \\frac{\\rho V}{4}, \\frac{\\rho V}{4}, \\frac{\\rho V}{4}\\right) = \\frac{\\rho V}{4} I\n$$\n其中 $I$ 是 $4 \\times 4$ 单位矩阵。\n\n**证明概要：**\n1.  **对称性**：$M^{\\mathrm{red}}$ 和 $M^{\\mathrm{lump}}$ 是对称的，所以它们的线性组合 $M_{\\gamma}$ 也是对称的。\n2.  **质量保持**：我们测试 $M_{\\gamma}$ 对向量 $\\mathbf{1}$ 的作用：\n    $$\n    M_{\\gamma}\\mathbf{1} = \\left( (1-\\gamma) M^{\\mathrm{red}} + \\gamma M^{\\mathrm{lump}} \\right)\\mathbf{1} = (1-\\gamma)M^{\\mathrm{red}}\\mathbf{1} + \\gamma M^{\\mathrm{lump}}\\mathbf{1} \\\\\n    = (1-\\gamma)\\left(\\frac{\\rho V}{4}\\mathbf{1}\\right) + \\gamma\\left(\\frac{\\rho V}{4}I\\right)\\mathbf{1} = (1-\\gamma)\\frac{\\rho V}{4}\\mathbf{1} + \\gamma\\frac{\\rho V}{4}\\mathbf{1} = \\frac{\\rho V}{4}\\mathbf{1}\n    $$\n    特征向量 $\\mathbf{1}$ 及其特征值 $\\frac{\\rho V}{4}$ 得以保持。\n\n3.  **正定性**：我们检查 $M_{\\gamma}$ 的特征值。我们已经有一个特征值 $\\lambda_1 = \\frac{\\rho V}{4} > 0$（对于 $V>0$）。对于另外三个，考虑任何与 $\\mathbf{1}$ 正交的向量 $\\mathbf{v}$：\n    $$\n    M_{\\gamma}\\mathbf{v} = (1-\\gamma)M^{\\mathrm{red}}\\mathbf{v} + \\gamma M^{\\mathrm{lump}}\\mathbf{v} = (1-\\gamma)\\mathbf{0} + \\gamma \\left(\\frac{\\rho V}{4}I\\right)\\mathbf{v} = \\left(\\gamma\\frac{\\rho V}{4}\\right)\\mathbf{v}\n    $$\n    另外三个特征值均为 $\\lambda_{2,3,4} = \\gamma\\frac{\\rho V}{4}$。由于 $\\gamma \\in (0,1]$ 且 $V>0$，这些特征值是严格为正的。$M_{\\gamma}$ 的所有特征值都是正的，所以它是对称正定矩阵。\n\n#### 策略2：基于投影的沙漏稳定化\n\n对于某个参数 $\\beta > 0$，通过添加一个惩罚沙漏模式的项来定义修改后的矩阵 $M_{\\beta}$：\n$$\nM_{\\beta} = M^{\\mathrm{red}} + \\beta \\rho V P\n$$\n其中 $P = I - \\frac{1}{4}\\mathbf{1}\\mathbf{1}^{\\mathsf{T}}$ 是到与 $\\mathbf{1}$ 正交的子空间上的投影矩阵。\n\n**证明概要：**\n1.  **对称性**：$M^{\\mathrm{red}}$ 是对称的。$P$ 也是对称的，因为 $(I - \\frac{1}{4}\\mathbf{1}\\mathbf{1}^{\\mathsf{T}})^{\\mathsf{T}} = I^{\\mathsf{T}} - \\frac{1}{4}(\\mathbf{1}\\mathbf{1}^{\\mathsf{T}})^{\\mathsf{T}} = I - \\frac{1}{4}\\mathbf{1}\\mathbf{1}^{\\mathsf{T}} = P$。因此，$M_{\\beta}$ 是对称的。\n2.  **质量保持**：我们测试 $M_{\\beta}$ 对向量 $\\mathbf{1}$ 的作用。我们首先注意投影算子 $P$ 对 $\\mathbf{1}$ 的作用：\n    $$\n    P\\mathbf{1} = \\left(I - \\frac{1}{4}\\mathbf{1}\\mathbf{1}^{\\mathsf{T}}\\right)\\mathbf{1} = \\mathbf{1} - \\frac{1}{4}\\mathbf{1}(\\mathbf{1}^{\\mathsf{T}}\\mathbf{1}) = \\mathbf{1} - \\frac{1}{4}\\mathbf{1}(4) = \\mathbf{0}\n    $$\n    然后，\n    $$\n    M_{\\beta}\\mathbf{1} = M^{\\mathrm{red}}\\mathbf{1} + \\beta \\rho V P\\mathbf{1} = \\frac{\\rho V}{4}\\mathbf{1} + \\beta \\rho V (\\mathbf{0}) = \\frac{\\rho V}{4}\\mathbf{1}\n    $$\n    特征向量 $\\mathbf{1}$ 及其特征值 $\\frac{\\rho V}{4}$ 得以保持。\n\n3.  **正定性**：我们检查特征值。$\\lambda_1 = \\frac{\\rho V}{4} > 0$。对于另外三个，考虑任何与 $\\mathbf{1}$ 正交的向量 $\\mathbf{v}$。投影算子 $P$ 在此类向量上作用如单位算子：$P\\mathbf{v} = \\mathbf{v}$。\n    $$\n    M_{\\beta}\\mathbf{v} = M^{\\mathrm{red}}\\mathbf{v} + \\beta \\rho V P\\mathbf{v} = \\mathbf{0} + \\beta \\rho V \\mathbf{v} = (\\beta \\rho V)\\mathbf{v}\n    $$\n    另外三个特征值为 $\\lambda_{2,3,4} = \\beta \\rho V$。由于 $\\beta>0$ 且 $V>0$，这些特征值是严格为正的。$M_{\\beta}$ 的所有特征值都是正的，所以它是对称正定矩阵。\n\n### 第三部分：算法实现\n\n实现过程对每个测试用例包括以下步骤：\n1.  定义四个顶点坐标向量 $\\mathbf{x}_1, \\mathbf{x}_2, \\mathbf{x}_3, \\mathbf{x}_4$。\n2.  计算单元体积 $V$。从一个公共顶点出发，由四面体的边向量构成一个 $3 \\times 3$ 矩阵，例如 $A = [\\mathbf{x}_2-\\mathbf{x}_1, \\mathbf{x}_3-\\mathbf{x}_1, \\mathbf{x}_4-\\mathbf{x}_1]^{\\mathsf{T}}$，并计算 $V = \\frac{1}{6} |\\det(A)|$。\n3.  设置常数 $\\rho=1, \\gamma=0.1, \\beta=0.05, \\tau = 10^{-14}$。\n4.  构建矩阵 $M^{\\mathrm{red}} = \\frac{\\rho V}{16} \\mathbf{1}\\mathbf{1}^{\\mathsf{T}}$。\n5.  构建矩阵 $M^{\\mathrm{lump}} = \\frac{\\rho V}{4} I$。\n6.  构建混合稳定化矩阵 $M_{\\gamma} = (1-\\gamma) M^{\\mathrm{red}} + \\gamma M^{\\mathrm{lump}}$。\n7.  构建投影矩阵 $P = I - \\frac{1}{4}\\mathbf{1}\\mathbf{1}^{\\mathsf{T}}$。\n8.  构建投影稳定化矩阵 $M_{\\beta} = M^{\\mathrm{red}} + \\beta \\rho V P$。\n9.  对于三个矩阵 $M^{\\mathrm{red}}, M_{\\gamma}, M_{\\beta}$ 中的每一个，使用对称特征求解器计算特征值。最小特征值 $\\lambda_{\\min}$ 是排序后特征值列表的第一个元素。\n10. 确定 $M^{\\mathrm{red}}$ 的奇异性指标：如果 $\\lambda_{\\min}(M^{\\mathrm{red}}) \\le \\tau$，则 $\\mathrm{isSingular} = 1$，否则为 $0$。\n11. 对每个测试用例，将四个结果 $[\\mathrm{isSingular}, \\lambda_{\\min}(M^{\\mathrm{red}}), \\lambda_{\\min}(M_{\\gamma}), \\lambda_{\\min}(M_{\\beta})]$ 收集到一个列表中。\n12. 将最终输出格式化为这些列表的逗号分隔列表。\n这个过程将使用 `numpy` 库在 Python 中实现。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and analyzes mass matrices for tetrahedral finite elements.\n    \"\"\"\n    \n    # Define test cases and parameters\n    test_cases = {\n        \"A\": {\n            \"x1\": np.array([0, 0, 0]), \"x2\": np.array([1, 0, 0]),\n            \"x3\": np.array([0, 1, 0]), \"x4\": np.array([0, 0, 1]),\n        },\n        \"B\": {\n            \"x1\": np.array([0, 0, 0]), \"x2\": np.array([1, 0, 0]),\n            \"x3\": np.array([0, 1, 0]), \"x4\": np.array([1e-6, 1e-6, 1e-6]),\n        },\n        \"C\": {\n            \"x1\": np.array([0, 0, 0]), \"x2\": np.array([1, 0, 0]),\n            \"x3\": np.array([0, 1, 0]), \"x4\": np.array([1e-12, 1e-12, 1e-12]),\n        },\n        \"D\": {\n            \"x1\": np.array([0, 0, 0]), \"x2\": np.array([1, 0, 0]),\n            \"x3\": np.array([0, 1, 0]), \"x4\": np.array([0, 0, 0]),\n        },\n    }\n\n    # Parameters\n    rho = 1.0\n    gamma = 0.1\n    beta = 0.05\n    tau = 1e-14\n\n    all_results = []\n    \n    for case_name, coords in test_cases.items():\n        x1, x2, x3, x4 = coords[\"x1\"], coords[\"x2\"], coords[\"x3\"], coords[\"x4\"]\n\n        # 1. Compute element volume V\n        # The volume is 1/6 of the scalar triple product of the edge vectors.\n        # This is equivalent to 1/6 of the absolute value of the determinant of\n        # the matrix formed by the edge vectors.\n        mat = np.array([\n            x2 - x1,\n            x3 - x1,\n            x4 - x1\n        ])\n        V = 1.0 / 6.0 * np.abs(np.linalg.det(mat))\n\n        # Basic algebraic entities\n        ones_vec = np.ones(4)\n        ones_mat = np.outer(ones_vec, ones_vec) # This is 1 * 1^T\n        identity = np.eye(4)\n\n        # 2. Compute reduced-integration mass matrix M^red\n        # M_red = (rho * V / 16) * 1 * 1^T\n        m_red = (rho * V / 16.0) * ones_mat\n        \n        # 3. Compute lumped mass matrix M^lump\n        # M_lump = (rho * V / 4) * I\n        m_lump = (rho * V / 4.0) * identity\n        \n        # 4. Compute blended stabilization M_gamma\n        # M_gamma = (1-gamma) * M_red + gamma * M_lump\n        m_gamma = (1.0 - gamma) * m_red + gamma * m_lump\n        \n        # 5. Compute projection-based hourglass stabilization M_beta\n        # P = I - (1/4) * 1 * 1^T\n        proj_P = identity - 0.25 * ones_mat\n        # M_beta = M_red + beta * rho * V * P\n        m_beta = m_red + beta * rho * V * proj_P\n\n        # 6. Compute smallest eigenvalue of each matrix\n        # np.linalg.eigvalsh is used for symmetric matrices and returns sorted eigenvalues\n        lambda_min_red = np.linalg.eigvalsh(m_red)[0]\n        lambda_min_gamma = np.linalg.eigvalsh(m_gamma)[0] if V > 0 else 0.0\n        lambda_min_beta = np.linalg.eigvalsh(m_beta)[0] if V > 0 else 0.0\n        \n        # 7. Determine singularity of M_red\n        is_singular = 1 if lambda_min_red = tau else 0\n        \n        # Append results for the current case\n        case_results = [\n            is_singular,\n            lambda_min_red,\n            lambda_min_gamma,\n            lambda_min_beta\n        ]\n        all_results.append(case_results)\n\n    # Format the final output string as specified\n    formatted_sublists = [\n        f\"[{res[0]},{res[1]},{res[2]},{res[3]}]\" for res in all_results\n    ]\n    final_output = f\"[{','.join(formatted_sublists)}]\"\n    \n    print(final_output)\n\n# It seems the original code was not runnable in the environment,\n# so I'm replacing it with the full code.\n# The expected output is a single line, so I call solve()\nsolve()\n```", "id": "3609811"}, {"introduction": "最后一个练习展示了单元级矩阵的用途远不止于组装全局系统，它们还能为求解分析提供宝贵的见解。您将使用单元刚度矩阵和质量矩阵推导一个基于能量的指示器，用以估计波场的局部频率成分。通过实现这个指示器，您将学会如何识别计算网格中分辨率不足的区域，这是设计自适应算法，将计算资源集中在最需要地方的关键一步。[@problem_id:3609762]", "problem": "给定杆中纵向运动的一维弹性波偏微分方程 (PDE)，该方程是在小应变、线性弹性假设下对线性动量守恒的表达：对于位移场 $u(x,t)$、密度 $\\rho(x)$ 和杨氏模量 $E(x)$，\n$$\n\\rho(x)\\,\\frac{\\partial^2 u}{\\partial t^2}(x,t) - \\frac{\\partial}{\\partial x}\\left(E(x)\\,\\frac{\\partial u}{\\partial x}(x,t)\\right) = 0,\\quad x\\in \\Omega\\subset \\mathbb{R},\\ t\\ge 0.\n$$\n考虑在具有恒定横截面积 $A$ 和每个单元上分片常数材料属性的线性双节点单元网格上进行标准的伽辽金有限元 (FE) 离散化。对于长度为 $h_e$ 的单个单元 $e$，其节点位移向量为 $u_e \\in \\mathbb{R}^2$，使用映射到物理单元的参考区间 $\\xi\\in[0,1]$ 上的线性形函数 $N_1(\\xi) = 1-\\xi$ 和 $N_2(\\xi)=\\xi$ 来定义单元刚度矩阵 $K_e$ 和单元质量矩阵 $M_e$。局部应变-位移矩阵为 $B = \\begin{bmatrix} \\frac{dN_1}{dx}  \\frac{dN_2}{dx}\\end{bmatrix}$，形函数向量为 $N = \\begin{bmatrix}N_1  N_2\\end{bmatrix}$。单元矩阵通过弱形式由下式获得\n$$\nK_e = \\int_{x_e}^{x_{e+1}} E_e A\\, B^\\top B\\, dx,\\qquad M_e = \\int_{x_e}^{x_{e+1}} \\rho_e A\\, N^\\top N\\, dx,\n$$\n其中 $E_e$ 和 $\\rho_e$ 表示单元 $e$ 上的常数值。\n\n通过单元瑞利商在每个单元上定义一个基于能量的频率指标\n$$\nR_e = \\frac{u_e^\\top K_e\\, u_e}{u_e^\\top M_e\\, u_e}.\n$$\n假设局部波速为 $c_e = \\sqrt{E_e/\\rho_e}$，将 $\\sqrt{R_e}$ 解释为局部角频率的近似值，并用它来构建一个无量纲分辨率指标\n$$\nq_e = \\frac{\\sqrt{R_e}\\, h_e}{\\pi\\, c_e},\n$$\n该指标将单元尺寸 $h_e$ 与局部半波长进行比较。$q_e \\ll 1$ 的值表示相对于网格的低频内容，$q_e \\approx 1$ 表示临界分辨率（单元尺寸与半波长相当），而 $q_e \\gg 1$ 表示分辨率不足，需要进行网格细化。\n\n任务：\n- 从弱形式和上述定义出发，推导双节点线性单元的 $K_e$ 和 $M_e$，并提供它们以 $E_e$、$ \\rho_e$、$A$ 和 $h_e$ 表示的显式形式。\n- 使用这些单元矩阵，为给定网格和节点位移快照 $u(x)$ 的每个单元计算 $R_e$ 和 $q_e$。\n- 对于分母 $u_e^\\top M_e u_e$ 在数值上可忽略不计（例如，低于某个容差）的单元，定义 $R_e=0$ 并因此定义 $q_e=0$，以避免除以零。\n\n您的程序必须实现上述指标，并针对以下测试套件进行评估。所有具有物理量纲的量均使用国际单位制 (SI)：长度单位为米，时间单位为秒，质量单位为千克，杨氏模量单位为帕斯卡，密度单位为千克/立方米，面积单位为平方米。指标 $q_e$ 是无量纲的，必须以浮点数形式报告。\n\n测试套件：\n- 案例 1 (均匀网格，低频)：\n  - 节点：$x=\\{0,\\ 0.25,\\ 0.5,\\ 0.75,\\ 1.0\\}$。\n  - 材料：$E=9.0\\times 10^{9}$，$\\rho=2500$，$A=1.0$。\n  - 位移快照：对于 $x$（单位为米），$u(x)=\\sin(\\pi x)$。\n- 案例 2 (均匀网格，临界频率)：\n  - 节点：$x=\\{0,\\ 0.25,\\ 0.5,\\ 0.75,\\ 1.0\\}$。\n  - 材料：$E=9.0\\times 10^{9}$，$\\rho=2500$，$A=1.0$。\n  - 位移快照：$u(x)=\\sin(4\\pi x)$。\n- 案例 3 (均匀网格，高频)：\n  - 节点：$x=\\{0,\\ 0.25,\\ 0.5,\\ 0.75,\\ 1.0\\}$。\n  - 材料：$E=9.0\\times 10^{9}$，$\\rho=2500$，$A=1.0$。\n  - 位移快照：$u(x)=\\sin(10\\pi x)$。\n- 案例 4 (非均匀网格，可变材料)：\n  - 节点：$x=\\{0.0,\\ 0.1,\\ 0.3,\\ 0.6,\\ 1.0\\}$。\n  - 单元 $e=1,2,3,4$ 上的各单元属性：$E_e=\\{1.0\\times 10^{10},\\ 8.0\\times 10^{9},\\ 5.0\\times 10^{9},\\ 1.2\\times 10^{10}\\}$，$\\rho_e=\\{2600,\\ 2400,\\ 2200,\\ 2800\\}$，$A=1.0$。\n  - 位移快照：$u(x)=\\sin(6\\pi x)$。\n- 案例 5 (零场边界情况)：\n  - 节点：$x=\\{0,\\ 0.25,\\ 0.5,\\ 0.75,\\ 1.0\\}$。\n  - 材料：$E=9.0\\times 10^{9}$，$\\rho=2500$，$A=1.0$。\n  - 位移快照：$u(x)\\equiv 0$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个由五个方括号列表组成的逗号分隔列表，每个案例一个列表，每个内部列表按从左到右的单元顺序包含 $q_e$ 的各单元值，四舍五入到六位小数，所有内容都包含在一对单独的方括号中。例如，一个包含两个案例，每个案例有两个单元的输出将如下所示：$[[0.123456,0.234567],[0.345678,0.456789]]$。", "solution": "问题陈述已经过验证，被认为是科学合理的、适定的和客观的。它为推导和实现基于有限元的一维弹性波方程分辨率指标提供了一个完整且一致的设置。为指定的测试案例提供了所有必要的数据、定义和边界条件。我现在将开始求解。\n\n求解过程需要两个主要步骤：首先，解析推导单元矩阵和由此产生的分辨率指标；其次，针对给定的测试案例进行数值实现和评估。\n\n### 单元矩阵和分辨率指标的推导\n\n推导从为长度为 $h_e$ 的双节点线性单元提供的单元刚度矩阵 $K_e$ 和质量矩阵 $M_e$ 的积分形式开始。单元从物理坐标 $x_1$ 延伸到 $x_2=x_1+h_e$。我们使用从参考坐标 $\\xi \\in [0,1]$ 到物理坐标 $x \\in [x_1, x_2]$ 的线性映射，由 $x(\\xi) = x_1 + h_e\\xi$ 给出。其微分为 $dx = h_e d\\xi$。\n\n参考单元上的线性形函数为 $N_1(\\xi) = 1-\\xi$ 和 $N_2(\\xi) = \\xi$。它们相对于物理坐标 $x$ 的导数使用链式法则求得：\n$$\n\\frac{dN}{dx} = \\frac{dN}{d\\xi}\\frac{d\\xi}{dx} = \\frac{1}{h_e}\\frac{dN}{d\\xi}\n$$\n这得到 $\\frac{dN_1}{dx} = -1/h_e$ 和 $\\frac{dN_2}{dx} = 1/h_e$。因此，应变-位移矩阵 $B_e$ 在单元内是恒定的：\n$$\nB_e = \\begin{bmatrix} \\frac{dN_1}{dx}  \\frac{dN_2}{dx} \\end{bmatrix} = \\frac{1}{h_e} \\begin{bmatrix} -1  1 \\end{bmatrix}\n$$\n\n**1. 单元刚度矩阵 $K_e$**\n\n刚度矩阵定义为 $K_e = \\int_{x_1}^{x_2} E_e A\\, B_e^\\top B_e\\, dx$。由于 $E_e$、$A$ 和 $B_e$ 在单元上是常数，积分简化为：\n$$\nB_e^\\top B_e = \\left(\\frac{1}{h_e}\\begin{bmatrix} -1 \\\\ 1 \\end{bmatrix}\\right) \\left(\\frac{1}{h_e}\\begin{bmatrix} -1  1 \\end{bmatrix}\\right) = \\frac{1}{h_e^2}\\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}\n$$\n$$\nK_e = E_e A\\, (B_e^\\top B_e) \\int_{x_1}^{x_2} dx = E_e A \\left(\\frac{1}{h_e^2}\\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}\\right) h_e\n$$\n因此，单元刚度矩阵的显式形式为：\n$$\nK_e = \\frac{E_e A}{h_e} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix}\n$$\n\n**2. 单元质量矩阵 $M_e$**\n\n一致质量矩阵定义为 $M_e = \\int_{x_1}^{x_2} \\rho_e A\\, N^\\top N\\, dx$。形函数矩阵 $N = \\begin{bmatrix} N_1  N_2 \\end{bmatrix}$ 不是常数。我们在参考单元上进行积分：\n$$\nM_e = \\rho_e A \\int_0^1 N(\\xi)^\\top N(\\xi) \\, h_e d\\xi = \\rho_e A h_e \\int_0^1 \\begin{bmatrix} N_1^2  N_1 N_2 \\\\ N_1 N_2  N_2^2 \\end{bmatrix} d\\xi\n$$\n代入 $N_1=1-\\xi$ 和 $N_2=\\xi$，我们计算所需的积分：\n$$\n\\int_0^1 N_1^2 d\\xi = \\int_0^1 (1-\\xi)^2 d\\xi = \\frac{1}{3}\n$$\n$$\n\\int_0^1 N_2^2 d\\xi = \\int_0^1 \\xi^2 d\\xi = \\frac{1}{3}\n$$\n$$\n\\int_0^1 N_1 N_2 d\\xi = \\int_0^1 \\xi(1-\\xi) d\\xi = \\frac{1}{6}\n$$\n将这些结果代回矩阵积分：\n$$\nM_e = \\rho_e A h_e \\begin{bmatrix} 1/3  1/6 \\\\ 1/6  1/3 \\end{bmatrix} = \\frac{\\rho_e A h_e}{6} \\begin{bmatrix} 2  1 \\\\ 1  2 \\end{bmatrix}\n$$\n这是一致单元质量矩阵的显式形式。\n\n**3. 分辨率指标 $q_e$**\n\n指标 $q_e$ 由单元瑞利商 $R_e = \\frac{u_e^\\top K_e u_e}{u_e^\\top M_e u_e}$ 构建，其中 $u_e=\\begin{bmatrix} u_1  u_2 \\end{bmatrix}^\\top$ 是单元节点位移向量。让我们计算分子和分母中的二次型：\n$$\nu_e^\\top K_e u_e = \\frac{E_e A}{h_e} \\begin{bmatrix} u_1  u_2 \\end{bmatrix} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix} \\begin{bmatrix} u_1 \\\\ u_2 \\end{bmatrix} = \\frac{E_e A}{h_e} (u_1 - u_2)^2\n$$\n$$\nu_e^\\top M_e u_e = \\frac{\\rho_e A h_e}{6} \\begin{bmatrix} u_1  u_2 \\end{bmatrix} \\begin{bmatrix} 2  1 \\\\ 1  2 \\end{bmatrix} \\begin{bmatrix} u_1 \\\\ u_2 \\end{bmatrix} = \\frac{\\rho_e A h_e}{6} (2u_1^2 + 2u_1u_2 + 2u_2^2) = \\frac{\\rho_e A h_e}{3} (u_1^2 + u_1u_2 + u_2^2)\n$$\n那么瑞利商为：\n$$\nR_e = \\frac{\\frac{E_e A}{h_e} (u_1 - u_2)^2}{\\frac{\\rho_e A h_e}{3} (u_1^2 + u_1u_2 + u_2^2)} = \\frac{3 E_e}{\\rho_e h_e^2} \\frac{(u_1 - u_2)^2}{u_1^2 + u_1u_2 + u_2^2}\n$$\n分辨率指标定义为 $q_e = \\frac{\\sqrt{R_e}\\, h_e}{\\pi\\, c_e}$，其中局部波速为 $c_e = \\sqrt{E_e/\\rho_e}$。代入 $R_e$ 的表达式：\n$$\nq_e = \\frac{h_e}{\\pi \\sqrt{E_e/\\rho_e}} \\sqrt{\\frac{3 E_e}{\\rho_e h_e^2} \\frac{(u_1 - u_2)^2}{u_1^2 + u_1u_2 + u_2^2}}\n$$\n我们可以通过合并项来简化此表达式：\n$$\nq_e = \\frac{h_e}{\\pi} \\sqrt{\\frac{\\rho_e}{E_e}} \\frac{\\sqrt{3}\\sqrt{E_e/\\rho_e}}{h_e} \\frac{|u_1 - u_2|}{\\sqrt{u_1^2 + u_1u_2 + u_2^2}}\n$$\n值得注意的是，材料属性 ($E_e, \\rho_e$) 和单元尺寸 ($h_e$) 完全抵消了：\n$$\nq_e = \\frac{\\sqrt{3}}{\\pi} \\frac{|u_1 - u_2|}{\\sqrt{u_1^2 + u_1u_2 + u_2^2}}\n$$\n这个简化公式是精确的，将用于计算。它在数值上具有优势，因为它避免了使用可能非常大或非常小的物理常数进行运算。\n\n问题指出，如果分母 $u_e^\\top M_e u_e$ 可忽略不计，则 $q_e$ 应为 $0$。分母与 $u_1^2 + u_1u_2 + u_2^2$ 成正比，这是一个正定二次型。它当且仅当 $u_1=0$ 和 $u_2=0$ 时为零。因此，如果 $u_1^2 + u_1u_2 + u_2^2$ 低于一个小的数值容差，我们将设置 $q_e=0$，这涵盖了两个节点位移均为零（例如，案例2和5）或数值上非常接近零的情况。\n\n### 算法实现\n该算法通过遍历每个测试案例来进行。对于每个案例，它遍历由节点坐标定义的单元。在每个单元中，它在两个节点处评估给定的位移函数 $u(x)$ 以获得 $u_1$ 和 $u_2$。然后，它应用 $q_e$ 的简化公式，并检查分母接近零的情况。每个案例计算出的 $q_e$ 值被收集并格式化为所需的输出字符串。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the dimensionless resolution indicator q_e for a series of test cases\n    related to the 1D elastic wave equation discretized with linear finite elements.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"name\": \"Case 1 (uniform mesh, low frequency)\",\n            \"nodes\": [0.0, 0.25, 0.5, 0.75, 1.0],\n            \"u_func\": lambda x: np.sin(np.pi * x),\n        },\n        {\n            \"name\": \"Case 2 (uniform mesh, borderline frequency)\",\n            \"nodes\": [0.0, 0.25, 0.5, 0.75, 1.0],\n            \"u_func\": lambda x: np.sin(4 * np.pi * x),\n        },\n        {\n            \"name\": \"Case 3 (uniform mesh, high frequency)\",\n            \"nodes\": [0.0, 0.25, 0.5, 0.75, 1.0],\n            \"u_func\": lambda x: np.sin(10 * np.pi * x),\n        },\n        {\n            \"name\": \"Case 4 (nonuniform mesh, variable material)\",\n            \"nodes\": [0.0, 0.1, 0.3, 0.6, 1.0],\n            \"u_func\": lambda x: np.sin(6 * np.pi * x),\n        },\n        {\n            \"name\": \"Case 5 (zero field edge case)\",\n            \"nodes\": [0.0, 0.25, 0.5, 0.75, 1.0],\n            \"u_func\": lambda x: 0.0,\n        },\n    ]\n\n    all_results = []\n    \n    # Pre-calculate constant factor sqrt(3)/pi\n    sqrt3_over_pi = np.sqrt(3) / np.pi\n    \n    # Define a tolerance for the denominator check\n    tolerance = 1e-15\n\n    for case in test_cases:\n        nodes = case[\"nodes\"]\n        u_func = case[\"u_func\"]\n        \n        q_values_for_case = []\n        for i in range(len(nodes) - 1):\n            x1, x2 = nodes[i], nodes[i+1]\n            # Handle cases where u_func is a constant\n            if isinstance(u_func(x1), (int, float)):\n                u1 = u_func(x1)\n                u2 = u_func(x2)\n            else:\n                u1 = u_func(np.array([x1]))[0]\n                u2 = u_func(np.array([x2]))[0]\n\n            # The simplified formula for q_e is:\n            # q_e = (sqrt(3)/pi) * |u1 - u2| / sqrt(u1^2 + u1*u2 + u2^2)\n\n            denom_q_val = u1**2 + u1*u2 + u2**2\n\n            if abs(denom_q_val)  tolerance:\n                # Denominator is negligible, set q_e to 0 as per problem description.\n                # This occurs when u1 and u2 are both zero (or numerically close).\n                q_e = 0.0\n            else:\n                num_q_val = abs(u1 - u2)\n                q_e = sqrt3_over_pi * num_q_val / np.sqrt(denom_q_val)\n            \n            q_values_for_case.append(q_e)\n        \n        all_results.append(q_values_for_case)\n\n    # Format the final output string according to the specification\n    inner_lists_str = []\n    for case_results in all_results:\n        # Format each float to 6 decimal places\n        formatted_values = [f\"{val:.6f}\" for val in case_results]\n        inner_lists_str.append(f\"[{','.join(formatted_values)}]\")\n    \n    final_output = f\"[{','.join(inner_lists_str)}]\"\n    \n    print(final_output)\n\nsolve()\n```", "id": "3609762"}]}