{"hands_on_practices": [{"introduction": "本练习将引导您手动完成隐式 QR 算法的一个完整步骤，从而揭开其神秘面纱。通过计算威尔金森位移（Wilkinson shift）并使用吉文斯旋转（Givens rotations）执行“凸起追逐”（bulge chasing），您将具体理解算法如何通过一系列正交相似变换来维持上海森堡（Hessenberg）结构。这项基础实践是掌握更高级 QR 策略背后机制的关键。[@problem_id:3577332]", "problem": "考虑实上Hessenberg矩阵\n$$\nH =\n\\begin{pmatrix}\n2  1  0  0\\\\\n1  2  1  0\\\\\n0  1  2  1\\\\\n0  0  1  2\n\\end{pmatrix}.\n$$\n使用从 $H$ 的尾部 $2\\times 2$ 子矩阵定义的 Wilkinson 位移，对 Francis 隐式 $QR$（正交-三角）迭代执行一个单一位移步。完全在实数算术中进行运算。从第一性原理出发：为尾部 $2\\times 2$ 块定义 Wilkinson 位移，从与 $H-\\mu I$ 相关的首部 2-向量构造初始 Givens 旋转，并通过后续的 Givens 旋转来“追逐”凸起，以恢复 Hessenberg 形式。全程使用正交相似变换，不要显式地构造 $H-\\mu I$ 的任何完整 $QR$ 分解。\n\n任务：\n- 从 $H$ 的尾部 $2\\times 2$ 子矩阵确定 Wilkinson 位移 $\\mu$。\n- 应用一个隐式单一位移步以获得更新后的矩阵 $H^{(1)}$，并列出其所有元素，保留四位有效数字。\n- 对于您的最终数值答案，报告 $H^{(1)}$ 的 $(4,3)$ 元素，保留四位有效数字。\n\n将所有数值量表示为四位有效数字。最终提交的答案必须是一个单一实数（指定的矩阵元素），保留四位有效数字。", "solution": "用户希望对一个给定的 $4 \\times 4$ 实上Hessenberg矩阵，使用 Wilkinson 位移执行一步 Francis 隐式 QR 迭代。该矩阵为\n$$\nH =\n\\begin{pmatrix}\n2  1  0  0\\\\\n1  2  1  0\\\\\n0  1  2  1\\\\\n0  0  1  2\n\\end{pmatrix}.\n$$\n实际上，这个矩阵是对称三对角矩阵。对对称矩阵应用单步 QR 算法会保持其对称性。此外，对于对称三对角矩阵，带位移的隐式 QR 步会保持其三对角结构。\n\n**第1步：确定 Wilkinson 位移 $\\mu$**\n\nWilkinson 位移由 $H$ 的尾部 $2 \\times 2$ 子矩阵的特征值确定。该子矩阵为\n$$\nH_{sub} = \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}.\n$$\n该子矩阵的特征值 $\\lambda$ 是其特征多项式的根：\n$$\n\\det(H_{sub} - \\lambda I) = (2-\\lambda)^2 - (1)(1) = 0\n$$\n$$\n\\lambda^2 - 4\\lambda + 4 - 1 = \\lambda^2 - 4\\lambda + 3 = 0\n$$\n$$\n(\\lambda-1)(\\lambda-3) = 0\n$$\n特征值为 $\\lambda_1 = 1$ 和 $\\lambda_2 = 3$。Wilkinson 位移 $\\mu$ 是距离尾部对角元素 $H_{44} = 2$ 更近的那个特征值。我们计算距离：\n$|\\lambda_1 - H_{44}| = |1 - 2| = 1$\n$|\\lambda_2 - H_{44}| = |3 - 2| = 1$\n出现了平局。按照惯例，可以选择任一特征值作为位移。我们将选择较小的值，即 $\\mu = 1$。\n\n**第2步：执行隐式 QR 步**\n\n隐式 QR 步包括构造一系列 Givens 旋转来执行相似变换 $H^{(1)} = Q^T H Q$，其中 $Q$ 是来自因子分解 $H - \\mu I = QR$ 的正交矩阵。\n\n**2a. 初始凸起的创建**\n\n第一步是创建一个 Givens 旋转 $Q_1$，它将 $H - \\mu I$ 第一列的第二个元素置零。$H - \\mu I$ 的第一列由 $x$ 给出：\n$$\nx = \\begin{pmatrix} H_{11} - \\mu \\\\ H_{21} \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 2-1 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix}.\n$$\n我们定义一个作用于前两行的 Givens 旋转 $Q_1$。$2 \\times 2$ 的旋转块是 $\\begin{pmatrix} c_1  s_1 \\\\ -s_1  c_1 \\end{pmatrix}$，其中 $c_1 = \\frac{1}{\\sqrt{1^2+1^2}} = \\frac{1}{\\sqrt{2}}$ 且 $s_1 = \\frac{1}{\\sqrt{1^2+1^2}} = \\frac{1}{\\sqrt{2}}$。\n$$\nQ_1 = \\begin{pmatrix} 1/\\sqrt{2}  1/\\sqrt{2}  0  0 \\\\ -1/\\sqrt{2}  1/\\sqrt{2}  0  0 \\\\ 0  0  1  0 \\\\ 0  0  0  1 \\end{pmatrix}.\n$$\n我们将其作为相似变换应用于 $H$：$H_1 = Q_1 H Q_1^T$。\n$$\nH_1 = Q_1 H Q_1^T = \\begin{pmatrix} 3  0  1/\\sqrt{2}  0 \\\\ 0  1  1/\\sqrt{2}  0 \\\\ 1/\\sqrt{2}  1/\\sqrt{2}  2  1 \\\\ 0  0  1  2 \\end{pmatrix}.\n$$\n这个变换引入了一个“凸起”，即在位置 $(3,1)$（由于对称性，也在 $(1,3)$）处出现了一个非零元素，破坏了三对角结构。\n\n**2b. 追逐凸起：第一次旋转**\n\n为了恢复三对角形式，我们沿着对角线“追逐”这个凸起。我们引入一个作用于第2行和第3行的 Givens 旋转 $Q_2$ 来消除元素 $H_1(3,1)$。参数 $c_2, s_2$ 由向量 $[H_1(2,1), H_1(3,1)]^T = [0, 1/\\sqrt{2}]^T$ 确定。\n这得到 $c_2 = \\frac{0}{\\sqrt{0^2+(1/\\sqrt{2})^2}} = 0$ 且 $s_2 = \\frac{1/\\sqrt{2}}{\\sqrt{0^2+(1/\\sqrt{2})^2}} = 1$。\n$$\nQ_2 = \\begin{pmatrix} 1  0  0  0 \\\\ 0  0  1  0 \\\\ 0  -1  0  0 \\\\ 0  0  0  1 \\end{pmatrix}.\n$$\n我们计算 $H_2 = Q_2 H_1 Q_2^T$：\n$$\nH_2 = \\begin{pmatrix} 3  1/\\sqrt{2}  0  0 \\\\ 1/\\sqrt{2}  2  -1/\\sqrt{2}  1 \\\\ 0  -1/\\sqrt{2}  1  0 \\\\ 0  1  0  2 \\end{pmatrix}.\n$$\n凸起已经从 $(3,1)$ 移动到了 $(4,2)$（并从 $(1,3)$ 移动到了 $(2,4)$）。\n\n**2c. 追逐凸起：第二次旋转**\n\n最后，我们引入一个作用于第3行和第4行的 Givens 旋转 $Q_3$ 来消除在 $H_2(4,2)$ 处的新凸起。参数 $c_3, s_3$ 由向量 $[H_2(3,2), H_2(4,2)]^T = [-1/\\sqrt{2}, 1]^T$ 确定。\n$r = \\sqrt{(-1/\\sqrt{2})^2 + 1^2} = \\sqrt{1/2 + 1} = \\sqrt{3/2}.$\n$c_3 = \\frac{-1/\\sqrt{2}}{\\sqrt{3/2}} = -\\frac{1}{\\sqrt{3}}, \\quad s_3 = \\frac{1}{\\sqrt{3/2}} = \\sqrt{\\frac{2}{3}}.$\n$$\nQ_3 = \\begin{pmatrix} 1  0  0  0 \\\\ 0  1  0  0 \\\\ 0  0  -1/\\sqrt{3}  \\sqrt{2/3} \\\\ 0  0  -\\sqrt{2/3}  -1/\\sqrt{3} \\end{pmatrix}.\n$$\n更新后的矩阵是 $H^{(1)} = Q_3 H_2 Q_3^T$。这个变换恢复了三对角形式。\n$$\nH^{(1)} = \\begin{pmatrix}\n3  1/\\sqrt{2}  0  0 \\\\\n1/\\sqrt{2}  2  \\sqrt{3/2}  0 \\\\\n0  \\sqrt{3/2}  5/3  -\\sqrt{2}/3 \\\\\n0  0  -\\sqrt{2}/3  4/3\n\\end{pmatrix}.\n$$\n\n**第3步：最终数值结果**\n\nWilkinson 位移是 $\\mu=1$。\n\n更新后的矩阵 $H^{(1)}$，其元素保留四位有效数字，为：\n$1/\\sqrt{2} \\approx 0.7071$\n$\\sqrt{3/2} \\approx 1.225$\n$5/3 \\approx 1.667$\n$-\\sqrt{2}/3 \\approx -0.4714$\n$4/3 \\approx 1.333$\n$$\nH^{(1)} \\approx \\begin{pmatrix}\n3.000  0.7071  0  0 \\\\\n0.7071  2.000  1.225  0 \\\\\n0  1.225  1.667  -0.4714 \\\\\n0  0  -0.4714  1.333\n\\end{pmatrix}.\n$$\n问题要求 $H^{(1)}$ 的 $(4,3)$ 元素，保留四位有效数字。\n$H^{(1)}_{4,3} = -\\frac{\\sqrt{2}}{3} \\approx -0.4714045...$\n保留四位有效数字，该值为 $-0.4714$。", "answer": "$$\\boxed{-0.4714}$$", "id": "3577332"}, {"introduction": "在单位移机制的基础上，本练习将探索更巧妙的弗朗西斯（Francis）双位移策略。对于具有复共轭特征值的实矩阵，该技术至关重要，它能在完全避免复数运算的同时高效地找到这些特征值。您将基于一对复数位移构建初始变换，观察它如何产生一个 $2 \\times 2$ 的“凸起”，并将其沿矩阵“追逐”下去，从而揭示这一强大实数算法的核心。[@problem_id:3577273]", "problem": "考虑实上海森堡矩阵\n$$\nH =\n\\begin{pmatrix}\n0  1  0  0\\\\\n1  0  1  0\\\\\n0  1  0  1\\\\\n0  0  1  0\n\\end{pmatrix} \\in \\mathbb{R}^{4\\times 4}.\n$$\n执行一步实数弗朗西斯双步位移，其中复共轭位移对选择为标量矩阵的特征值\n$$\n\\mu = \\mathrm{i}, \\qquad \\overline{\\mu} = -\\mathrm{i},\n$$\n使得实二次位移定义为\n$$\np(z) = z^{2} - \\tau z + \\rho, \\quad \\text{其中} \\quad \\tau = \\mu + \\overline{\\mu} = 0,\\quad \\rho = \\mu\\,\\overline{\\mu} = 1.\n$$\n对该实海森堡矩阵使用弗朗西斯双步位移的隐式正交相似形式，并遵循以下标准约定：\n- 对向量 $p(H)e_{1}$ 的前三个分量构成的向量 $x \\in \\mathbb{R}^{3}$ 构造初始的豪斯霍尔德（Householder）反射变换，使得该反射变换将 $x$ 映射到一个只有第一个分量为非负非零的向量。\n- 从左侧然后从右侧应用每个正交变换，以保持实数运算和海森堡结构，并将“凸起”（bulge）追赶至矩阵底部，以恢复 $4\\times 4$ 的上海森堡形式。\n\n在完成此单次弗朗西斯双步位移的完整“凸起追赶”后，报告更新后的次对角线元素 $h_{21}^{\\text{(new)}}$。给出最终答案的精确解析表达式。无需四舍五入。", "solution": "用户希望对一个给定的 $4 \\times 4$ 实上海森堡矩阵 $H$ 执行一步实数弗朗西斯双步位移QR算法。该过程涉及创建一个“凸起”，然后“追赶”它以恢复海森堡形式。\n\n**步骤1：问题验证**\n\n该问题在数值线性代数的背景下陈述，并描述了一个标准过程，即弗朗西斯双步位移QR步。所有提供的信息都是自洽、一致且有科学依据的。给定的矩阵确实是一个实上海森堡矩阵（更具体地说，是一个对称三对角矩阵）。位移构成一个复共轭对，这产生了一个实二次多项式，正如实数双步位移算法所要求的那样。构建豪斯霍尔德（Householder）反射变换的指令是明确的，并符合一个有效但特定的约定。该问题是适定的、客观的。因此，该问题是有效的，可以推导出解决方案。\n\n**步骤2：弗朗西斯步的设置**\n\n给定的矩阵是：\n$$\nH =\n\\begin{pmatrix}\n0  1  0  0\\\\\n1  0  1  0\\\\\n0  1  0  1\\\\\n0  0  1  0\n\\end{pmatrix}\n$$\n位移为 $\\mu = \\mathrm{i}$ 和 $\\overline{\\mu} = -\\mathrm{i}$。相关的实二次多项式是 $p(z) = (z-\\mu)(z-\\overline{\\mu}) = z^2 - (\\mu+\\overline{\\mu})z + \\mu\\overline{\\mu}$。\n迹为 $\\tau = \\mu + \\overline{\\mu} = \\mathrm{i} - \\mathrm{i} = 0$。\n行列式为 $\\rho = \\mu\\overline{\\mu} = (\\mathrm{i})(-\\mathrm{i}) = 1$。\n所以，该多项式是 $p(z) = z^2+1$。\n\n隐式QR算法始于计算矩阵 $p(H)$ 的第一列，我们将其表示为向量 $x_v$。\n$$x_v = p(H)e_1 = (H^2 + I)e_1 = H^2e_1 + e_1$$\n其中 $e_1 = (1, 0, 0, 0)^T$。\n首先，我们计算 $H e_1$，即 $H$ 的第一列：\n$$\nH e_1 = \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n接下来，我们计算 $H^2 e_1 = H(H e_1)$：\n$$\nH^2 e_1 = H \\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 1 \\\\ 0 \\end{pmatrix} \\quad (\\text{$H$ 的第二列})\n$$\n现在，我们可以求出 $x_v$：\n$$\nx_v = \\begin{pmatrix} 1 \\\\ 0 \\\\ 1 \\\\ 0 \\end{pmatrix} + \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 2 \\\\ 0 \\\\ 1 \\\\ 0 \\end{pmatrix}\n$$\n\n**步骤3：创建凸起**\n\n第一个正交变换 $Q_0$ 是通过一个豪斯霍尔德（Householder）反射变换 $P_0$ 构建的，它作用于 $x_v$ 的前三个分量。设这个 $3$ 维向量为 $x$：\n$$\nx = \\begin{pmatrix} 2 \\\\ 0 \\\\ 1 \\end{pmatrix}\n$$\n问题指定该反射变换应将 $x$ 映射到一个其第一个分量为非负的向量。这意味着目标向量是 $\\|x\\|_2 e_1$。\n$x$ 的范数是 $\\|x\\|_2 = \\sqrt{2^2 + 0^2 + 1^2} = \\sqrt{5}$。\n豪斯霍尔德向量 $v$ 由 $v = x - \\|x\\|_2 e_1$ 给出：\n$$\nv = \\begin{pmatrix} 2 \\\\ 0 \\\\ 1 \\end{pmatrix} - \\sqrt{5} \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 2 - \\sqrt{5} \\\\ 0 \\\\ 1 \\end{pmatrix}\n$$\n这个 $3 \\times 3$ 的反射变换是 $P_0 = I - 2 \\frac{v v^T}{v^T v}$。我们通常在不显式构造矩阵的情况下应用其作用。\n第一个 $4 \\times 4$ 的变换矩阵是 $Q_0 = \\mathrm{diag}(P_0, 1)$。\n我们将其作为相似变换应用于 $H$：\n$H^{(1)} = Q_0 H Q_0^T = Q_0 H Q_0$ （因为 $Q_0$ 是一个对称的反射变换）\n由于 $H$ 是对称的， $H^{(1)}$ 也将是对称的。变换 $Q_0$ 旨在在海森堡结构中创建一个“凸起”。对于对称矩阵，这意味着在三对角带之外创建非零项。让我们计算 $H^{(1)}$ 的第一列：\n$H^{(1)}e_1 = Q_0 H Q_0 e_1$\n首先，我们求 $Q_0 e_1$。这涉及将 $P_0$ 应用于 $e_1 \\in \\mathbb{R}^3$。\n$$P_0 e_1 = e_1 - 2\\frac{v^T e_1}{v^T v}v$$\n$v^T v = (2-\\sqrt{5})^2 + 0^2 + 1^2 = 4 - 4\\sqrt{5} + 5 + 1 = 10 - 4\\sqrt{5}$。\n$v^T e_1 = 2-\\sqrt{5}$。\n所以，$P_0 e_1 = e_1 - 2\\frac{2-\\sqrt{5}}{10-4\\sqrt{5}}v = e_1 - \\frac{2-\\sqrt{5}}{5-2\\sqrt{5}}v$。\n$\\frac{2-\\sqrt{5}}{5-2\\sqrt{5}} = \\frac{2-\\sqrt{5}}{-\\sqrt{5}(2-\\sqrt{5})} = -\\frac{1}{\\sqrt{5}}$。\n$P_0 e_1 = e_1 - (-\\frac{1}{\\sqrt{5}})v = e_1 + \\frac{1}{\\sqrt{5}}v = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\end{pmatrix} + \\frac{1}{\\sqrt{5}}\\begin{pmatrix} 2-\\sqrt{5} \\\\ 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 1 + \\frac{2}{\\sqrt{5}} - 1 \\\\ 0 \\\\ \\frac{1}{\\sqrt{5}} \\end{pmatrix} = \\begin{pmatrix} 2/\\sqrt{5} \\\\ 0 \\\\ 1/\\sqrt{5} \\end{pmatrix}$。\n所以，$Q_0 e_1 = (2/\\sqrt{5}, 0, 1/\\sqrt{5}, 0)^T$。\n现在，我们计算 $H (Q_0 e_1)$：\n$$H(Q_0 e_1) = H \\left( \\frac{2}{\\sqrt{5}}e_1 + \\frac{1}{\\sqrt{5}}e_3 \\right) = \\frac{2}{\\sqrt{5}} H e_1 + \\frac{1}{\\sqrt{5}} H e_3$$\n$He_1$ 是 $H$ 的第一列，$He_3$ 是第三列。\n$$\nH(Q_0 e_1) = \\frac{2}{\\sqrt{5}}\\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 0 \\end{pmatrix} + \\frac{1}{\\sqrt{5}}\\begin{pmatrix} 0 \\\\ 1 \\\\ 0 \\\\ 1 \\end{pmatrix} = \\frac{1}{\\sqrt{5}}\\begin{pmatrix} 0 \\\\ 3 \\\\ 0 \\\\ 1 \\end{pmatrix}\n$$\n最后，我们将 $Q_0$ 应用于此向量：$H^{(1)}e_1 = Q_0 (H Q_0 e_1)$。\n$Q_0$ 作用于前三个分量。要变换的向量是 $(0, 3/\\sqrt{5}, 0)^T$。我们称之为 $u_1$。\n豪斯霍尔德向量 $v$ 的第二个分量为零（$v_2=0$），所以 $v^T u_1 = 0$。\n因此，$P_0 u_1 = u_1$。\n该变换不改变前三个分量。\n$$\nH^{(1)}e_1 = Q_0 \\frac{1}{\\sqrt{5}}\\begin{pmatrix} 0 \\\\ 3 \\\\ 0 \\\\ 1 \\end{pmatrix} = \\frac{1}{\\sqrt{5}} \\begin{pmatrix} P_0 \\begin{pmatrix} 0 \\\\ 3 \\\\ 0 \\end{pmatrix} \\\\ 1 \\end{pmatrix} = \\frac{1}{\\sqrt{5}}\\begin{pmatrix} 0 \\\\ 3 \\\\ 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 3/\\sqrt{5} \\\\ 0 \\\\ 1/\\sqrt{5} \\end{pmatrix}\n$$\n$H^{(1)}$ 的第一列有非零项 $h_{21}^{(1)} = 3/\\sqrt{5}$ 和 $h_{41}^{(1)} = 1/\\sqrt{5}$。元素 $h_{41}^{(1)}$ 是破坏三对角结构的“凸起”。\n\n**步骤4：凸起追赶**\n\n下一步是消除这个凸起。这是通过第二次相似变换 $H^{(2)} = Q_1 H^{(1)} Q_1$ 完成的，其中 $Q_1$ 旨在将不需要的元素置零。为了消除 $h_{41}^{(1)}$，我们需要一个作用于第 $2, 3, 4$ 行和列的正交变换。\n我们构造 $Q_1 = \\mathrm{diag}(1, P_1)$，其中 $P_1$ 是一个 $3 \\times 3$ 的豪斯霍尔德反射变换。\n选择 $P_1$ 作用于 $H^{(1)}$ 第一列中从第二个元素开始的子向量。设这个向量为 $y$：\n$$\ny = \\begin{pmatrix} h_{21}^{(1)} \\\\ h_{31}^{(1)} \\\\ h_{41}^{(1)} \\end{pmatrix} = \\begin{pmatrix} 3/\\sqrt{5} \\\\ 0 \\\\ 1/\\sqrt{5} \\end{pmatrix}\n$$\n按照约定，$P_1$ 将 $y$ 映射到 $\\|y\\|_2 e_1$。\n$\\|y\\|_2 = \\sqrt{(3/\\sqrt{5})^2 + 0^2 + (1/\\sqrt{5})^2} = \\sqrt{9/5 + 1/5} = \\sqrt{10/5} = \\sqrt{2}$。\n因此，$P_1 y = \\sqrt{2} e_1 = (\\sqrt{2}, 0, 0)^T$。\n\n经过这一弗朗西斯步后的最终矩阵是 $H^{(\\text{new})} = H^{(2)} = Q_1 H^{(1)} Q_1$。我们需要找到其 $(2,1)$ 元素，$h_{21}^{(\\text{new})}$。这是 $H^{(2)}$ 第一列的第二个分量。\n$H^{(2)}e_1 = Q_1 H^{(1)} Q_1 e_1$\n由于 $Q_1 = \\mathrm{diag}(1, P_1)$，$Q_1 e_1 = e_1$。\n$$H^{(2)}e_1 = Q_1 (H^{(1)}e_1) = \\begin{pmatrix} 1  0 \\\\ 0  P_1 \\end{pmatrix} \\begin{pmatrix} 0 \\\\ y \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ P_1 y \\end{pmatrix}$$\n根据 $P_1$ 的构造，我们有 $P_1 y = \\sqrt{2} e_1 \\in \\mathbb{R}^3$。\n$$\nH^{(2)}e_1 = \\begin{pmatrix} 0 \\\\ \\sqrt{2} \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n新矩阵 $H^{(\\text{new})}$ 的第一列是 $(0, \\sqrt{2}, 0, 0)^T$。\n更新后的次对角线元素是 $h_{21}^{(\\text{new})} = \\sqrt{2}$。这个变换恢复了海森堡形式（在本例中是三对角形式），从而完成了对一个 $4 \\times 4$ 矩阵的凸起追赶。\n\n最终答案是 $h_{21}^{(\\text{new})}$ 的精确解析值。\n$$h_{21}^{(\\text{new})} = \\sqrt{2}$$", "answer": "$$\\boxed{\\sqrt{2}}$$", "id": "3577273"}, {"introduction": "最后的这项实践将带您从手动计算过渡到计算实验，揭示为何复杂的位移策略在实践中不可或缺。通过实现并比较一个朴素的单位移 QR 算法和一个弗朗西斯双位移策略，您将亲眼观察到糟糕的位移选择如何导致收敛缓慢甚至循环。这个练习为双位移方法在处理正交矩阵或复特征值等挑战性情况时所展现的卓越性能和鲁棒性提供了强有力的证明。[@problem_id:3577262]", "problem": "你的任务是研究正交三角（QR）算法中的位移策略如何影响上Hessenberg矩阵的收敛性。你需要构建一个在较差位移策略下表现出循环或收敛进程极其缓慢的近病态案例，然后展示一种修正方法。你必须基于以下基础理论来推导你的方法：对于一个方阵 $A \\in \\mathbb{R}^{n \\times n}$，使用正交矩阵 $Q$ 进行的相似变换 $A \\mapsto Q^\\top A Q$ 会保持特征值不变；正交三角（QR）分解将一个满秩矩阵 $M$ 写为 $M = Q R$ 的形式，其中 $Q$ 是正交矩阵，$R$ 是上三角矩阵；QR算法迭代地将此类相似变换应用于 $A$（或与 $A$ 相似的上Hessenberg形式 $H$），以将次对角线元素驱动至 $0$ 并在对角线上揭示特征值；而一个带位移的QR步则对 $A - s I$（其中位移量 $s \\in \\mathbb{R}$）应用QR分解，并通过 $A \\leftarrow R Q + s I$ 更新 $A$。你的任务是构建并测试一个案例，其中一个差的单位移选择导致了循环或极慢的收敛进程，并实现一个双位移（Francis）修正法来恢复稳健的收敛性。\n\n具体来说，请在上Hessenberg矩阵上实现两种策略：\n- 差的单位移策略：始终使用固定位移 $s = 0$，因此更新方式为 $H \\leftarrow R Q$，其中 $H - 0 \\cdot I = Q R$。\n- 实数隐式双位移（Francis）策略：令当前 $H$ 矩阵的尾部 $2 \\times 2$ 子块为 $T$，并定义实二次多项式 $p(\\lambda) = \\lambda^2 - \\operatorname{tr}(T) \\lambda + \\det(T)$。通过对 $p(H) = Q R$ 进行QR分解得到的正交因子 $Q$ 实现一个隐式双位移步，然后更新 $H \\leftarrow Q^\\top H Q$。此方法利用隐式Q定理，使用与尾部子块的（可能为复共轭的）特征值对应的两次位移，同时保持在实数运算内。\n\n通过追踪最后一个次对角线元素 $|H_{n,n-1}|$ 的模来衡量进展；当对于某个容差 $\\tau > 0$ 有 $|H_{n,n-1}|  \\tau$ 时，宣布发生一次缩减（deflation），并记录达到首次缩减所需的迭代次数。如果矩阵在开始时就已经缩减（即初始时 $|H_{n,n-1}|  \\tau$），则迭代次数为 $0$。如果在指定的迭代预算 $K$ 内没有发生缩减，则记录次数为 $K$。\n\n构建以下矩阵和参数的测试套件：\n- 测试案例1（近病态正交上Hessenberg矩阵）：通过对一个高斯随机矩阵进行QR分解来生成一个随机正交矩阵 $Q_1 \\in \\mathbb{R}^{12 \\times 12}$，并通过正交相似变换（使用Hessenberg约简）将其约简为上Hessenberg形式 $H_1 = Z^\\top Q_1 Z$。由于 $H_1$ 是正交的，固定的差位移 $s=0$ 将导致 $H \\leftarrow R Q = H$（无变化）的循环。双位移策略应能打破此循环。\n- 测试案例2（带有复共轭对的非正规矩阵）：构建一个 $A_2 \\in \\mathbb{R}^{10 \\times 10}$ 块对角矩阵，其中包含一个 $2 \\times 2$ 的旋转缩放块 $R = r \\begin{bmatrix} \\cos(\\theta)  \\sin(\\theta) \\\\ -\\sin(\\theta)  \\cos(\\theta) \\end{bmatrix}$（其中 $r = 1.01$，$\\theta = 0.3$，角度以弧度为单位），其余对角线元素为 $3.0, 2.5, 2.0, 1.5, 1.0, 0.2, -0.3, -1.0$。通过Hessenberg约简将 $A_2$ 约简为上Hessenberg形式 $H_2$。固定的差位移 $s=0$ 与尾部结构不匹配，而双位移策略应通过针对内嵌的复共轭对来加速收敛进程。\n- 测试案例3（边界对角线案例）：取一个对角矩阵 $A_3 \\in \\mathbb{R}^{5 \\times 5}$，其对角线元素为 $5.0, 4.0, 3.0, 2.0, 1.0$。因为 $A_3$ 已经是缩减形式（所有次对角线元素均为 $0$），两种策略都应报告 $0$ 次迭代。\n\n对所有测试案例使用容差 $\\tau = 10^{-10}$ 和迭代预算 $K = 200$。对于每个矩阵 $H_i$ ($i \\in \\{1,2,3\\}$)，运行差的单位移策略以获得首次缩减前的迭代次数 $N_i^{\\text{poor}}$（如果未发生缩减则为 $K$），并运行实数隐式双位移（Francis）策略以获得迭代次数 $N_i^{\\text{fix}}$。将结果汇总到最终输出中，形式为包含列表 $[N_1^{\\text{poor}}, N_1^{\\text{fix}}, N_2^{\\text{poor}}, N_2^{\\text{fix}}, N_3^{\\text{poor}}, N_3^{\\text{fix}}]$ 的单行。\n\n你的程序必须精确地产生一行此格式的输出。构建过程中的所有角度都必须以弧度为单位。不涉及物理单位。输出仅包含整数。", "solution": "用户的请求是验证一个关于用于特征值计算的QR算法收敛性的数值线性代数问题，并在其有效的情况下予以解决。核心任务是在三个特定的上Hessenberg矩阵上，实现并比较一种差的单位移策略与更稳健的实数隐式双位移（Francis）策略。\n\n该问题是**有效的**。它在科学上基于数值线性代数的既定原则，是适定的，提供了所有必要的数据和参数，并且是客观的。对QR算法、位移策略和测试案例构建的描述是正确和标准的。\n\n解决方案将首先详细说明两种算法策略，然后将它们应用于指定的测试案例，并按指示测量收敛性。\n\n**1. 算法策略**\n\nQR算法迭代地将矩阵 $A$ 精化为一种能够揭示其特征值的形式（准上三角形式，或Schur形式）。为提高效率，$A$ 首先通过相似变换 $H = U^\\top A U$ 被约简为上Hessenberg形式 $H$，该变换保持特征值不变。所有后续的QR迭代都在 $H$ 上执行，这会保持其Hessenberg结构，从而将每次迭代的计算成本从 $O(n^3)$ 降低到 $O(n^2)$。\n\n**1.1. 差的单位移策略**\n\n这是带位移QR算法的最简单版本。一次迭代包括选择一个位移 $s \\in \\mathbb{R}$，对位移后的矩阵进行QR分解，然后反向相乘以完成相似变换。\n\n给定当前Hessenberg矩阵 $H_k$，下一个迭代矩阵 $H_{k+1}$ 的计算方式如下：\n1.  选择一个位移 $s$。问题指定了一个固定的、“差的”位移 $s=0$。\n2.  计算（未位移的）矩阵的QR分解：$H_k = Q_k R_k$。\n3.  更新矩阵：$H_{k+1} = R_k Q_k$。\n\n此更新是一个相似变换，因为 $R_k = Q_k^\\top H_k$，所以 $H_{k+1} = Q_k^\\top H_k Q_k$。因此，特征值得以保留。收敛性通过监控次对角线元素来衡量。具体来说，我们观察元素 $|H_{n,n-1}|$。如果该元素变得可以忽略不计，则最后一个对角元素 $H_{n,n}$ 被视为一个已收敛的特征值，问题可以通过考虑前导的 $(n-1) \\times (n-1)$ 子矩阵来进行“缩减”（deflate）。众所周知，这种策略在某些情况下收敛缓慢或完全失败，例如对于具有相等模的特征值的矩阵（如正交矩阵）或具有复共轭特征值对的矩阵。\n\n**1.2. 实数隐式双位移（Francis）策略**\n\n该策略旨在克服单位移方法的缺点，特别是对于具有复共轭特征值的实矩阵。它隐式地执行两次连续的QR步，其位移量 $s_1$ 和 $s_2$ 是复共轭的，但仅使用实数运算来完成。\n\n关键思想是选择位移量 $s_1$ 和 $s_2$ 为当前Hessenberg矩阵 $H_k$ 尾部 $2 \\times 2$ 子矩阵的特征值：\n$$\nT =\n\\begin{bmatrix}\nH_{n-1, n-1}  H_{n-1, n} \\\\\nH_{n, n-1}  H_{n, n}\n\\end{bmatrix}\n$$\n$T$ 的特征值是实二次多项式 $p(\\lambda) = \\lambda^2 - \\operatorname{tr}(T)\\lambda + \\det(T)$ 的根。这些根 $s_1$ 和 $s_2$ 是绝佳的位移选择，因为它们通常是整个矩阵 $H_k$ 的一对特征值的良好近似。\n\n直接应用两个QR步将是：\n1.  $H_k - s_1 I = Q_1 R_1 \\implies H' = R_1 Q_1 + s_1 I = Q_1^\\top H_k Q_1$\n2.  $H' - s_2 I = Q_2 R_2 \\implies H_{k+1} = R_2 Q_2 + s_2 I = Q_2^\\top H' Q_2$\n\n如果 $s_1$ 和 $s_2$ 是复数，这将需要复数运算。Francis策略避免了这一点。组合变换为 $H_{k+1} = (Q_1 Q_2)^\\top H_k (Q_1 Q_2)$。隐式Q定理指出，正交矩阵 $Q = Q_1 Q_2$ 本质上是由矩阵乘积 $M = (H_k - s_2 I)(H_k - s_1 I) = p(H_k)$ 的第一列决定的。\n\n根据问题描述，这将通过以下方式实现：\n1.  形成矩阵 $M = p(H_k) = H_k^2 - \\operatorname{tr}(T)H_k + \\det(T)I$。\n2.  计算该矩阵的QR分解：$M = QR$。\n3.  使用该正交因子 $Q$ 应用相似变换：$H_{k+1} = Q^\\top H_k Q$。\n\n这个过程正确地应用了双位移变换，并且因为 $p(\\lambda)$ 具有实系数，矩阵 $M$ 是实数矩阵，整个计算都保持在实数运算内。\n\n**2. 测试套件和预期结果**\n\n在第一次满足 $|(H_k)_{n,n-1}|  \\tau$（其中 $\\tau=10^{-10}$）的迭代 $k$ 时，宣布收敛。报告迭代次数，上限为预算 $K=200$。\n\n*   **测试案例1（正交Hessenberg矩阵）：** 将一个随机实正交矩阵 $Q_1 \\in \\mathbb{R}^{12 \\times 12}$ 约简为上Hessenberg形式 $H_1$。由于 $H_1$ 本身是正交的，其特征值位于复平面的单位圆上。对于差的单位移策略（$s=0$），$H_1$ 的QR分解为 $H_1 = Q R$，其中 $Q=H_1$ 且 $R=I$（在符号上可能有差异）。下一个迭代矩阵是 $H_{\\text{new}} = R Q = I H_1 = H_1$。算法没有任何进展并将循环，达到迭代预算 $K=200$。Francis双位移策略将使用从尾部子块派生的非零位移，打破循环并快速收敛。\n\n*   **测试案例2（非正规矩阵）：** 构建一个矩阵 $A_2 \\in \\mathbb{R}^{10 \\times 10}$，其具有一对复共轭特征值 $1.01 e^{\\pm i 0.3}$ 和其他几个实特征值。在约简为Hessenberg形式 $H_2$ 后，差的位移 $s=0$ 远离任何特征值，这预示着缓慢的线性收敛。而Francis策略，根据其设计，能有效针对特征值对（包括复共轭对），预计将表现出非常快速的、近二次的收敛速度。\n\n*   **测试案例3（对角矩阵）：** 一个对角矩阵 $A_3 \\in \\mathbb{R}^{5 \\times 5}$ 已经是上Hessenberg形式，并且是完全缩减的，因为其所有次对角线元素都为零。条件 $|(H_3)_{n,n-1}| = |(A_3)_{5,4}| = 0  \\tau$ 在开始时即被满足。因此，两种算法都应正确识别这一点并报告 $0$ 次迭代。\n\n现在，实现将对指定的测试案例执行这些过程。", "answer": "$$\\boxed{\\text{[200,2,200,4,0,0]}}$$", "id": "3577262"}]}