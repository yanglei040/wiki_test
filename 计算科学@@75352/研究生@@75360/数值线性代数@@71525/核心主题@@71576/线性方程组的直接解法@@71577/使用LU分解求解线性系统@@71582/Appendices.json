{"hands_on_practices": [{"introduction": "首先，我们必须掌握 LU 分解的基本计算方法。第一个练习 [@problem_id:2186375] 提供了一个具体实例，要求使用杜利特尔 (Doolittle) 方法计算一个 $3 \\times 3$ 矩阵的 $L$ 和 $U$ 因子，为后续所有分析奠定计算基础。通过解决这个问题，您将获得高斯消元过程的实践经验，并了解乘数如何直接构成下三角矩阵 $L$ 的元素。", "problem": "在数值线性代数中，将一个矩阵分解为一个下三角矩阵和一个上三角矩阵的乘积是一项基本运算。这种分解被称为 LU 分解，并用于各种算法中，例如求解线性方程组。\n\n考虑矩阵 $A$ 如下：\n$$\nA = \\begin{pmatrix} 3 & -1 & 2 \\\\ 6 & 1 & 9 \\\\ -9 & 5 & -5 \\end{pmatrix}\n$$\n该矩阵可以唯一地分解为乘积 $A = LU$，其中 $L$ 是一个单位下三角矩阵（即对角线上元素为1），$U$ 是一个上三角矩阵。这两个 $3 \\times 3$ 矩阵的一般形式为：\n$$\nL = \\begin{pmatrix} 1 & 0 & 0 \\\\ l_{21} & 1 & 0 \\\\ l_{31} & l_{32} & 1 \\end{pmatrix}, \\quad U = \\begin{pmatrix} u_{11} & u_{12} & u_{13} \\\\ 0 & u_{22} & u_{23} \\\\ 0 & 0 & u_{33} \\end{pmatrix}\n$$\n对于给定的矩阵 $A$，确定矩阵 $L$ 的非对角线元素和矩阵 $U$ 的所有元素的数值。将你的最终答案表示为一个单行矩阵，其中包含这九个值，并按特定顺序 $(l_{21}, l_{31}, l_{32}, u_{11}, u_{12}, u_{13}, u_{22}, u_{23}, u_{33})$ 排列。将所有分数值表示为其最简形式。", "solution": "我们使用 Doolittle LU 分解法，其中 $L$ 是单位下三角矩阵，$U$ 是上三角矩阵，满足 $A=LU$。其中\n$$\nL = \\begin{pmatrix} 1 & 0 & 0 \\\\ l_{21} & 1 & 0 \\\\ l_{31} & l_{32} & 1 \\end{pmatrix}, \\quad U = \\begin{pmatrix} u_{11} & u_{12} & u_{13} \\\\ 0 & u_{22} & u_{23} \\\\ 0 & 0 & u_{33} \\end{pmatrix}\n$$\n乘积 $LU$ 按行计算如下：\n- 第1行：$[u_{11},u_{12},u_{13}]=[3,-1,2]$，因此 $u_{11}=3$，$u_{12}=-1$，$u_{13}=2$。\n- 第2行，第1列：$l_{21}u_{11}=a_{21}=6$，所以 $l_{21}=\\frac{a_{21}}{u_{11}}=\\frac{6}{3}=2$。\n- 第3行，第1列：$l_{31}u_{11}=a_{31}=-9$，所以 $l_{31}=\\frac{a_{31}}{u_{11}}=\\frac{-9}{3}=-3$。\n- 第2行，第2列：$l_{21}u_{12}+u_{22}=a_{22}=1$，所以 $u_{22}=a_{22}-l_{21}u_{12}=1-2(-1)=3$。\n- 第2行，第3列：$l_{21}u_{13}+u_{23}=a_{23}=9$，所以 $u_{23}=a_{23}-l_{21}u_{13}=9-2\\cdot 2=5$。\n- 第3行，第2列：$l_{31}u_{12}+l_{32}u_{22}=a_{32}=5$，所以 $l_{32}=\\frac{a_{32}-l_{31}u_{12}}{u_{22}}=\\frac{5-(-3)(-1)}{3}=\\frac{5-3}{3}=\\frac{2}{3}$。\n- 第3行，第3列：$l_{31}u_{13}+l_{32}u_{23}+u_{33}=a_{33}=-5$，所以\n$$\nu_{33}=a_{33}-l_{31}u_{13}-l_{32}u_{23}=-5-(-3\\cdot 2)-\\left(\\frac{2}{3}\\cdot 5\\right)=-5+6-\\frac{10}{3}=1-\\frac{10}{3}=-\\frac{7}{3}.\n$$\n\n因此，按要求的顺序 $(l_{21}, l_{31}, l_{32}, u_{11}, u_{12}, u_{13}, u_{22}, u_{23}, u_{33})$，这些值为\n$$\n\\begin{pmatrix}\n2 & -3 & \\frac{2}{3} & 3 & -1 & 2 & 3 & 5 & -\\frac{7}{3}\n\\end{pmatrix}.\n$$", "answer": "$$\\boxed{\\begin{pmatrix}2 & -3 & \\frac{2}{3} & 3 & -1 & 2 & 3 & 5 & -\\frac{7}{3}\\end{pmatrix}}$$", "id": "2186375"}, {"introduction": "虽然基本算法看似简单，但理解它在何种条件下可以无需修改地应用至关重要。这个练习 [@problem_id:3578142] 要求您构建一个无主元选择的 LU 分解会失败的场景，从而迫使您更深入地探究算法主元与矩阵结构特性之间的联系。这种理论上的探索将阐明主元选择策略的必要性以及非奇异主子矩阵的重要性。", "problem": "设 $A \\in \\mathbb{R}^{3 \\times 3}$ 是一个实矩阵。考虑在无行置换的情况下计算一个下三角-上三角 (LU) 分解，即找到一个单位下三角矩阵 $L$ 和一个上三角矩阵 $U$ 使得 $A = L U$，使用无主元选取的高斯消元法 (GE) 的行操作。用 $\\Delta_{k}$ 表示 $A$ 的 $k \\times k$ 阶主子矩阵的行列式。\n\n1. 显式构造一个满足 $\\Delta_{1} \\neq 0$ 和 $\\Delta_{2} = 0$ 的实 $3 \\times 3$ 矩阵 $A$，对于该矩阵，无主元选取的高斯消元法的第二步消元需要除以第二个主元。你的构造必须是显式的，并从第一性原理（即高斯消元法的定义和每一步产生的舒尔补）出发进行论证。\n\n2. 仅从高斯消元法和分块矩阵乘法的定义出发，推导无主元选取的 $A = L U$ 分解存在的必要条件，该条件用主子式 $\\Delta_{k}$ 和消元主元 $p_{k}$ 表示。你的推导必须从对一个 $2 \\times 2$ 阶主子块的第一步消元开始，并通过舒尔补进行，并对每一步进行充分论证。\n\n3. 将你的推导应用于你显式构造的矩阵 $A$，以严格解释为什么具有单位对角线 $L$ 且无行置换的 $A = L U$ 分解不存在。此外，确定无主元选取的高斯消元法在你的构造矩阵 $A$ 上会尝试使用的第二个主元 $p_2$ 的数值。\n\n将 $p_2$ 的数值作为你的最终答案。不需要四舍五入。", "solution": "这个问题包含三个部分，都关于矩阵 $A \\in \\mathbb{R}^{3 \\times 3}$ 在无行置换情况下的下三角-上三角 (LU) 分解的存在性。我们依次解决每个部分。\n\n1. 构造矩阵 $A$。\n\n我们的任务是构造一个 $3 \\times 3$ 的实矩阵 $A$，使其主子矩阵的行列式满足 $\\Delta_{1} \\neq 0$ 和 $\\Delta_{2} = 0$，并且无主元选取的高斯消元法 (GE) 在第二步失败。\n\n设矩阵 $A$ 表示为\n$$A = \\begin{pmatrix} a_{11} & a_{12} & a_{13} \\\\ a_{21} & a_{22} & a_{23} \\\\ a_{31} & a_{32} & a_{33} \\end{pmatrix}$$\n$1 \\times 1$ 阶主子矩阵是 $[a_{11}]$，其行列式为 $\\Delta_{1} = a_{11}$。条件 $\\Delta_{1} \\neq 0$ 意味着 $a_{11} \\neq 0$。$a_{11}$ 的值作为第一个主元 $p_1$。为简单起见，我们选择 $a_{11} = 1$。\n\n$2 \\times 2$ 阶主子矩阵是 $\\begin{pmatrix} a_{11} & a_{12} \\\\ a_{21} & a_{22} \\end{pmatrix}$，其行列式为 $\\Delta_{2} = a_{11}a_{22} - a_{12}a_{21}$。条件是 $\\Delta_{2} = 0$。当 $a_{11} = 1$ 时，这变为 $a_{22} - a_{12}a_{21} = 0$。我们可以通过选择，例如，$a_{12} = 1$，$a_{21} = 1$，和 $a_{22} = 1$ 来满足这个条件。\n\n到目前为止，$A$ 的左上角 $2 \\times 2$ 子块是 $\\begin{pmatrix} 1 & 1 \\\\ 1 & 1 \\end{pmatrix}$。我们选择剩下的元素来创建一个简单的、非平凡的矩阵。设 $a_{13}=1, a_{23}=2, a_{31}=1, a_{32}=2, a_{33}=3$。这得到矩阵\n$$A = \\begin{pmatrix} 1 & 1 & 1 \\\\ 1 & 1 & 2 \\\\ 1 & 2 & 3 \\end{pmatrix}$$\n我们来验证这些条件。$\\Delta_{1} = \\det([1]) = 1 \\neq 0$。\n$\\Delta_{2} = \\det \\begin{pmatrix} 1 & 1 \\\\ 1 & 1 \\end{pmatrix} = (1)(1) - (1)(1) = 0$。条件得到满足。\n\n现在，我们必须从第一性原理出发，论证高斯消元法在第二步失败。高斯消元法的第一步使用主元 $p_1 = a_{11} = 1$ 来消去其下方的元素。\n第二行的乘数是 $l_{21} = \\frac{a_{21}}{p_1} = \\frac{1}{1} = 1$。\n第三行的乘数是 $l_{31} = \\frac{a_{31}}{p_1} = \\frac{1}{1} = 1$。\n经过第一步消元后的矩阵 $A^{(1)}$ 是：\n$$A^{(1)} = \\begin{pmatrix} 1 & 1 & 1 \\\\ 1 - (1)(1) & 1 - (1)(1) & 2 - (1)(1) \\\\ 1 - (1)(1) & 2 - (1)(1) & 3 - (1)(1) \\end{pmatrix} = \\begin{pmatrix} 1 & 1 & 1 \\\\ 0 & 0 & 1 \\\\ 0 & 1 & 2 \\end{pmatrix}$$\n第二个主元是 $A^{(1)}$ 的 $(2,2)$ 元素，即 $p_2 = a_{22}^{(1)} = 0$。为了进行高斯消元法的第二步，我们需要使用主元 $p_2$ 来消去元素 $a_{32}^{(1)}=1$。这需要计算一个乘数 $l_{32} = \\frac{a_{32}^{(1)}}{p_2} = \\frac{1}{0}$，其中涉及到除以零。因此，无主元选取的高斯消元法在第二步失败。\n\n为了通过舒尔补来论证这一点，我们将 $A$ 分块：\n$$A = \\begin{pmatrix} a_{11} & \\mathbf{a}_{12}^T \\\\ \\mathbf{a}_{21} & A_{22} \\end{pmatrix} = \\begin{pmatrix} 1 & \\begin{pmatrix} 1 & 1 \\end{pmatrix} \\\\ \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix} & \\begin{pmatrix} 1 & 2 \\\\ 2 & 3 \\end{pmatrix} \\end{pmatrix}$$\n分块 LU 分解的第一步得到：\n$$A = \\begin{pmatrix} 1 & \\mathbf{0}^T \\\\ \\mathbf{l}_{21} & I \\end{pmatrix} \\begin{pmatrix} a_{11} & \\mathbf{a}_{12}^T \\\\ \\mathbf{0} & A_{22} - \\mathbf{l}_{21} \\mathbf{a}_{12}^T \\end{pmatrix}$$\n其中 $\\mathbf{l}_{21} = \\frac{\\mathbf{a}_{21}}{a_{11}} = \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$。右下角块是 $a_{11}$ 在 $A$ 中的舒尔补 $S$：\n$$S = A_{22} - \\frac{\\mathbf{a}_{21} \\mathbf{a}_{12}^T}{a_{11}} = \\begin{pmatrix} 1 & 2 \\\\ 2 & 3 \\end{pmatrix} - \\frac{1}{1}\\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix} \\begin{pmatrix} 1 & 1 \\end{pmatrix} = \\begin{pmatrix} 1 & 2 \\\\ 2 & 3 \\end{pmatrix} - \\begin{pmatrix} 1 & 1 \\\\ 1 & 1 \\end{pmatrix} = \\begin{pmatrix} 0 & 1 \\\\ 1 & 2 \\end{pmatrix}$$\n经过一步高斯消元后的矩阵，其右下部分为舒尔补：$A^{(1)} = \\begin{pmatrix} a_{11} & \\mathbf{a}_{12}^T \\\\ \\mathbf{0} & S \\end{pmatrix}$。高斯消元法的第二个主元是这个舒尔补的 $(1,1)$ 元素，$p_2 = S_{11} = 0$。这证实了失败。\n\n2. 必要条件的推导。\n\n我们被要求用主子式 $\\Delta_k$ 和主元 $p_k$ 来推导 $A=LU$ 分解（无主元选取）存在的必要条件。推导必须从高斯消元法的定义开始。\n\n设 $A$ 是一个 $n \\times n$ 矩阵。无主元选取的高斯消元法产生一系列矩阵 $A=A^{(0)}, A^{(1)}, \\dots, A^{(n-1)}=U$，其中 $U$ 是上三角矩阵。主元是 $p_k = a_{kk}^{(k-1)}$。\n\n为了使第一步可行，第一个主元 $p_1 = a_{11}^{(0)} = a_{11}$ 必须非零。第一个主子式是 $\\Delta_1 = \\det([a_{11}]) = a_{11}$。因此，一个必要条件是 $p_1 = \\Delta_1 \\neq 0$。\n\n现在，我们考虑第二个主元 $p_2$。这是第一步消元后得到的矩阵 $A^{(1)}$ 的 $(2,2)$ 元素。$A^{(1)}$ 的元素由 $a_{ij}^{(1)} = a_{ij}^{(0)} - \\frac{a_{i1}^{(0)}}{a_{11}^{(0)}} a_{1j}^{(0)}$ 给出，其中 $i,j > 1$。特别地，对于第二个主元：\n$$p_2 = a_{22}^{(1)} = a_{22}^{(0)} - \\frac{a_{21}^{(0)}}{a_{11}^{(0)}} a_{12}^{(0)}$$\n使用原始矩阵元素 $a_{ij}^{(0)}=a_{ij}$，我们有：\n$$p_2 = a_{22} - \\frac{a_{21}a_{12}}{a_{11}} = \\frac{a_{11}a_{22} - a_{12}a_{21}}{a_{11}}$$\n分子是 $A$ 的 $2 \\times 2$ 阶主子矩阵的行列式，即 $\\Delta_2$。分母是第一个主子式 $\\Delta_1$。因此，我们有关系式：\n$$p_2 = \\frac{\\Delta_2}{\\Delta_1}$$\n为了进行高斯消元法的第二步，主元 $p_2$ 必须非零。由于我们已经确定了 $\\Delta_1 \\neq 0$ 的必要性，条件 $p_2 \\neq 0$ 等价于 $\\Delta_2 \\neq 0$。\n\n这个论证可以推广。如果 LU 分解存在，即 $A=LU$，那么对于任何 $k \\in \\{1, \\dots, n\\}$，其 $k \\times k$ 阶主子矩阵 $A_k$ 满足 $A_k = L_k U_k$。取行列式，$\\det(A_k) = \\det(L_k) \\det(U_k)$。因为 $L$ 是单位下三角矩阵，$L_k$ 也是，并且 $\\det(L_k) = 1$。上三角矩阵 $U_k$ 的行列式是其对角线元素的乘积，也就是前 $k$ 个主元：$\\det(U_k) = p_1 p_2 \\cdots p_k$。\n因此，$\\Delta_k = p_1 p_2 \\cdots p_k$。\n这对于 $k \\ge 2$ 给出了 $\\Delta_k = \\Delta_{k-1} p_k$，意味着 $p_k = \\frac{\\Delta_k}{\\Delta_{k-1}}$。为了使无主元选取的高斯消元法成功进行到第 $n-1$ 步，所有主元 $p_1, \\dots, p_{n-1}$ 必须非零。这要求对于所有 $k = 1, \\dots, n-1$，都有 $\\Delta_k \\neq 0$。这就是无主元选取 LU 分解存在的必要条件。(注意 $p_n$ 可以为零，这对应于 $\\Delta_n = \\det(A) = 0$；这是允许的，因为不需要用 $p_n$ 作除数)。\n\n3. 应用于构造的矩阵 $A$。\n\n我们将推导出的条件应用于构造的矩阵 $A = \\begin{pmatrix} 1 & 1 & 1 \\\\ 1 & 1 & 2 \\\\ 1 & 2 & 3 \\end{pmatrix}$。\n一个 $3 \\times 3$ 矩阵具有无主元选取 LU 分解的必要条件是 $\\Delta_1 \\neq 0$ 和 $\\Delta_2 \\neq 0$。\n让我们计算我们的矩阵 $A$ 的这些子式：\n$\\Delta_1 = \\det([1]) = 1$。这满足 $\\Delta_1 \\neq 0$。\n$\\Delta_2 = \\det\\begin{pmatrix} 1 & 1 \\\\ 1 & 1 \\end{pmatrix} = (1)(1) - (1)(1) = 0$。\n因为 $\\Delta_2 = 0$，所以必要条件被违反了。因此，对于这个矩阵 $A$，具有单位对角线 $L$ 且无行置换的 LU 分解不存在。\n\n最后，我们必须确定第二个主元 $p_2$ 的数值。使用第 2 部分推导的公式：\n$$p_2 = \\frac{\\Delta_2}{\\Delta_1}$$\n代入我们为矩阵 $A$ 计算的值：\n$$p_2 = \\frac{0}{1} = 0$$\n这与我们在第 1 部分中的直接计算一致，其中矩阵 $A^{(1)}$ 的 $(2,2)$ 元素被发现是 $0$。无主元选取的高斯消元法尝试使用的第二个主元的值恰好是 $0$。", "answer": "$$\\boxed{0}$$", "id": "3578142"}, {"introduction": "计算 LU 分解的主要动机之一是其计算效率，尤其是在求解具有多个右侧向量的线性系统时。这个高级练习 [@problem_id:3578124] 将指导您进行一次性能分析，比较重用单个分解与为每个新问题重新计算分解的计算成本。通过推导算术强度，您将量化在大规模科学计算中将分解步骤与求解步骤分离的巨大实用价值。", "problem": "考虑一个稠密的、非奇异的 $n \\times n$ 实矩阵 $A$ 和一个包含 $m$ 个右端项 (RHS) 的 $n \\times m$ 矩阵 $B$。我们希望使用带部分主元法的 LU 分解（Lower-Upper factorization），然后对每个右端项进行两次三角求解来解方程 $A X = B$。使用以下成本模型和假设：\n\n- 浮点运算 (flop) 计数模型：每次浮点加法、减法、乘法或除法计为一次 flop。在此 flop 计数中忽略比较和数据移动开销。\n- LU 分解是原位执行的，其中 $L$ 的对角线元素为 1；后续矩阵的更新被计为乘减对。\n- 三角求解包括使用单位下三角矩阵 $L$ 进行前向代入和使用上三角矩阵 $U$ 进行回代；在回代中每行包含一次除法。\n- 内存流量模型：处理器和随机存取存储器 (RAM) 之间每次读取或写入一个矩阵或向量元素，计为一个字 (word) 的流量。对于 LU 分解，假设整个矩阵 $A$ 一次性流入，并被原位覆盖为 $L$ 和 $U$，然后一次性流出。对于求解，在“因子重用”策略中，假设 $L$ 和 $U$ 在分解后驻留在快速内存中，因此只有 $B$（读取）和 $X$（写入）需要流式传输。在“重复求解”策略中，假设对每个 RHS 都重新计算分解，每次都流入 $A$ 并流出 $LU$，并且对每个 RHS 都流式传输 $B$ 和 $X$。忽略主元索引向量和任何元数据的流量。\n\n将算术强度 (AI) 定义为 $\\mathrm{AI} = \\text{flops}/\\text{移动的字数}$。令 $\\mathrm{AI}_{\\mathrm{reuse}}$ 表示通过计算一次 LU 分解并在 $m$ 个 RHS 之间重用它来求解 $A X = B$ 的算术强度，令 $\\mathrm{AI}_{\\mathrm{repeat}}$ 表示通过对每个 RHS 独立地重新计算 LU 分解来求解的算术强度。根据上述模型，从第一性原理推导改进因子\n$$\\Phi(n,m) = \\frac{\\mathrm{AI}_{\\mathrm{reuse}}}{\\mathrm{AI}_{\\mathrm{repeat}}}$$\n的精确封闭形式表达式。\n以 $n$ 和 $m$ 的单个简化符号表达式的形式给出最终答案。无需四舍五入，最终表达式中不应包含任何单位。", "solution": "我们从 LU 分解（下三角-上三角分解）和三角求解的定义，以及给定的 flop 和内存流量模型开始。\n\nLU 分解的 flop 计数（原位，部分主元法，$L$ 的对角线元素为 1）：\n在消元步骤 $k$（$1 \\leq k \\leq n-1$），我们通过除法计算 $(n-k)$ 个乘子 $l_{i,k}$，这耗费 $(n-k)$ 次 flop，并更新大小为 $(n-k) \\times (n-k)$ 的后续子矩阵。每个后续矩阵元素的更新形式为 $a_{ij} \\leftarrow a_{ij} - l_{ik} \\, u_{kj}$，耗费 2 次 flop（一次乘法和一次减法）。因此，在步骤 $k$ 的更新成本为 $2 (n-k)^{2}$ 次 flop。对 $k$ 求和，\n\n$$\nF_{\\mathrm{LU}}(n)\n= \\sum_{k=1}^{n-1} \\bigl[(n-k) + 2 (n-k)^{2}\\bigr]\n= \\sum_{r=1}^{n-1} \\bigl[r + 2 r^{2}\\bigr],\n$$\n\n其中 $r = n-k$。使用 $\\sum_{r=1}^{n-1} r = \\frac{n(n-1)}{2}$ 和 $\\sum_{r=1}^{n-1} r^{2} = \\frac{(n-1)n(2n-1)}{6}$，\n\n$$\nF_{\\mathrm{LU}}(n)\n= \\frac{n(n-1)}{2} + 2 \\cdot \\frac{(n-1)n(2n-1)}{6}\n= \\frac{n(n-1)(4n+1)}{6}.\n$$\n\n\n单个 RHS 三角求解的 flop 计数：\n使用单位下三角矩阵 $L$ 的前向代入计算 $y_{i} = b_{i} - \\sum_{j=1}^{i-1} L_{ij} y_{j}$，对于第 $i$ 行耗费 $(i-1)$ 次乘法和 $(i-1)$ 次加法。对 $i$ 求和得到\n\n$$\nF_{\\mathrm{fwd}}(n) = \\sum_{i=1}^{n} 2(i-1) = n(n-1).\n$$\n\n使用上三角矩阵 $U$ 的回代计算 $x_{i} = \\bigl(y_{i} - \\sum_{j=i+1}^{n} U_{ij} x_{j}\\bigr) / U_{ii}$，对于第 $i$ 行耗费 $(n-i)$ 次乘法、$(n-i)$ 次加法和 1 次除法。对 $i$ 求和，\n\n$$\nF_{\\mathrm{bwd}}(n) = \\sum_{i=1}^{n} \\bigl[2(n-i) + 1\\bigr] = n(n-1) + n = n^{2}.\n$$\n\n因此，每个 RHS 的总 flop 计数为\n\n$$\nF_{\\mathrm{solve,\\,per\\,RHS}}(n) = F_{\\mathrm{fwd}}(n) + F_{\\mathrm{bwd}}(n) = n(n-1) + n^{2} = 2n^{2} - n.\n$$\n\n\n两种策略的总 flop 计数：\n- 在 $m$ 个 RHS 之间重用因子：\n\n$$\nF_{\\mathrm{reuse}}(n,m) = F_{\\mathrm{LU}}(n) + m \\, F_{\\mathrm{solve,\\,per\\,RHS}}(n)\n= \\frac{n(n-1)(4n+1)}{6} + m(2n^{2} - n).\n$$\n\n- 对每个 RHS 重复进行分解：\n\n$$\nF_{\\mathrm{repeat}}(n,m) = m \\bigl[F_{\\mathrm{LU}}(n) + F_{\\mathrm{solve,\\,per\\,RHS}}(n)\\bigr]\n= m \\left(\\frac{n(n-1)(4n+1)}{6} + 2n^{2} - n\\right).\n$$\n\n\n在所述模型下的内存流量：\n- 对于 LU 分解，一次性流入矩阵 $A$ 并原位覆盖为 $L$ 和 $U$，然后一次性流出。这耗费 $n^{2}$ 字的读取和 $n^{2}$ 字的写入，即移动了 $2n^{2}$ 个字。\n- 对于因子重用的求解，假设 $L$ 和 $U$ 驻留在快速内存中；只有 $B$ 和 $X$ 需要流式传输。在 $m$ 个 RHS 中读取 $B$ 和写入 $X$ 耗费 $n m$ 字的读取和 $n m$ 字的写入，即移动了 $2 n m$ 个字。\n因此，\n\n$$\nW_{\\mathrm{reuse}}(n,m) = 2 n^{2} + 2 n m = 2n(n+m).\n$$\n\n- 对于重复分解策略，对每个 RHS 都重新计算 LU 分解，每次流入 $A$ 并流出被覆盖的 $LU$，每个 RHS 总共移动 $2 n^{2}$ 个字；每个 RHS 的 $B$ 和 $X$ 流增加了 $2 n$ 个字。在 $m$ 个 RHS 中，\n\n$$\nW_{\\mathrm{repeat}}(n,m) = m \\cdot (2 n^{2} + 2 n) = 2 m n (n+1).\n$$\n\n\n每种策略的算术强度 (AI)：\n\n$$\n\\mathrm{AI}_{\\mathrm{reuse}}(n,m) = \\frac{F_{\\mathrm{reuse}}(n,m)}{W_{\\mathrm{reuse}}(n,m)}\n= \\frac{\\frac{n(n-1)(4n+1)}{6} + m(2n^{2} - n)}{2n(n+m)}.\n$$\n\n\n$$\n\\mathrm{AI}_{\\mathrm{repeat}}(n,m) = \\frac{F_{\\mathrm{repeat}}(n,m)}{W_{\\mathrm{repeat}}(n,m)}\n= \\frac{m \\left(\\frac{n(n-1)(4n+1)}{6} + 2n^{2} - n\\right)}{2 m n (n+1)}\n= \\frac{\\frac{n(n-1)(4n+1)}{6} + 2n^{2} - n}{2 n (n+1)}.\n$$\n\n\n改进因子 $\\Phi(n,m)$：\n\n$$\n\\Phi(n,m) = \\frac{\\mathrm{AI}_{\\mathrm{reuse}}(n,m)}{\\mathrm{AI}_{\\mathrm{repeat}}(n,m)}\n= \\frac{\\frac{n(n-1)(4n+1)}{6} + m(2n^{2} - n)}{2n(n+m)}\n\\cdot\n\\frac{2 n (n+1)}{\\frac{n(n-1)(4n+1)}{6} + 2n^{2} - n}.\n$$\n\n消去 $2n$ 并化简得到\n\n$$\n\\Phi(n,m) = \\frac{n+1}{n+m} \\cdot\n\\frac{\\frac{n(n-1)(4n+1)}{6} + m(2n^{2} - n)}{\\frac{n(n-1)(4n+1)}{6} + 2n^{2} - n}.\n$$\n\n\n这就是在所述模型下的精确封闭形式表达式。作为合理性检查，考虑在 $n$ 固定的情况下 $m \\to \\infty$ 和 $n \\to \\infty$。那么\n\n$$\n\\Phi(n,m) \\sim \\frac{n+1}{n+m} \\cdot \\frac{m(2n^{2} - n)}{\\frac{n(n-1)(4n+1)}{6} + 2n^{2} - n}\n\\sim \\frac{n}{m} \\cdot \\frac{m \\cdot 2n^2}{\\frac{4n^3}{6}} = \\frac{2n^3}{\\frac{2}{3}n^3} = 3.\n$$\n\n对于大的 $n$ 和 $m$，这恢复了直观的改进，即在这个简化的流式模型中，相对于重复分解，重用渐近地将算术强度提高了大约三倍。\n\n因此，所需的最终表达式为\n\n$$\n\\Phi(n,m) = \\frac{n+1}{n+m} \\cdot\n\\frac{\\frac{n(n-1)(4n+1)}{6} + m(2n^{2} - n)}{\\frac{n(n-1)(4n+1)}{6} + 2n^{2} - n}.\n$$", "answer": "$$\\boxed{\\frac{n+1}{n+m}\\cdot\\frac{\\frac{n(n-1)(4n+1)}{6}+m\\left(2n^{2}-n\\right)}{\\frac{n(n-1)(4n+1)}{6}+2n^{2}-n}}$$", "id": "3578124"}]}