{"hands_on_practices": [{"introduction": "在傅里叶谱方法中，选择一组正交归一的基函数是简化计算的关键。正交归一性确保了质量矩阵是对角的，从而极大地简化了求解过程。本练习将指导你从内积的基本定义出发，为周期问题中常用的实三角函数基（常数、余弦和正弦函数）推导其归一化常数，从而加深对函数正交性核心概念的理解 [@problem_id:3387170]。", "problem": "考虑在区间 $[0,2\\pi]$ 上的平方可积、实值、$2\\pi$-周期函数空间，其上配备内积\n$$\\langle f,g\\rangle=\\frac{1}{2\\pi}\\int_{0}^{2\\pi} f(x)\\,g(x)\\,dx.$$\n该内积自然地出现在周期性问题的谱展开中，并且当使用标准正交基时，在间断 Galerkin (DG) 方法中会产生对角质量矩阵。从集合 $\\{\\varphi_{i}\\}$ 的标准正交性定义，即 $\\langle \\varphi_{i},\\varphi_{j}\\rangle=\\delta_{ij}$ 出发，确定一个实三角函数族的乘法归一化常数，该函数族由一个常数函数和一个在固定正整数 $k$ 处的单频对组成。具体来说，求出常数 $A$、$B$ 和 $C$，使得集合\n$$\\{A\\cdot 1,\\;B\\cdot \\cos(kx),\\;C\\cdot \\sin(kx)\\}$$\n关于 $\\frac{1}{2\\pi}\\int_0^{2\\pi}\\cdot\\,dx$ 是标准正交的。你的推导必须从内积定义和基本三角恒等式开始，不得引用任何预先制表的傅里叶正交性结果。将最终答案表示为一个行矩阵，其中包含与 $\\{1,\\cos(kx),\\sin(kx)\\}$ 顺序对应的三个常数。无需四舍五入。", "solution": "该问题是有效的。这是一个良构的数学问题，其基础是泛函分析和傅里叶理论的基本原理，并与偏微分方程的数值方法直接相关。所有定义都清晰且自洽。\n\n任务是找到正的归一化常数 $A$、$B$ 和 $C$，使得对于一个固定的正整数 $k$，由下式给出的实值函数集合 $\\{\\varphi_1(x), \\varphi_2(x), \\varphi_3(x)\\}$\n$$ \\varphi_1(x) = A \\cdot 1 = A $$\n$$ \\varphi_2(x) = B \\cdot \\cos(kx) $$\n$$ \\varphi_3(x) = C \\cdot \\sin(kx) $$\n是一个标准正交集。该函数空间配备有内积\n$$ \\langle f,g\\rangle=\\frac{1}{2\\pi}\\int_{0}^{2\\pi} f(x)\\,g(x)\\,dx. $$\n标准正交性的条件是 $\\langle \\varphi_{i},\\varphi_{j}\\rangle=\\delta_{ij}$，其中 $\\delta_{ij}$ 是克罗内克 δ (Kronecker delta)，当 $i=j$ 时为 $1$，当 $i \\neq j$ 时为 $0$。\n\n我们将通过对 $i=1, 2, 3$ 强制执行归一化条件 $\\langle \\varphi_i, \\varphi_i \\rangle = 1$ 来确定这些常数。然后，我们将验证当 $i \\neq j$ 时，正交性条件 $\\langle \\varphi_i, \\varphi_j \\rangle = 0$ 得到满足。\n\n1.  **常数函数 $\\varphi_1(x) = A$ 的归一化**\n\n归一化条件是 $\\langle \\varphi_1, \\varphi_1 \\rangle = 1$。\n$$ \\langle A, A \\rangle = \\frac{1}{2\\pi}\\int_{0}^{2\\pi} A \\cdot A \\,dx = \\frac{A^2}{2\\pi}\\int_{0}^{2\\pi} 1 \\,dx $$\n积分为 $\\int_{0}^{2\\pi} 1 \\,dx = [x]_0^{2\\pi} = 2\\pi$。\n将此结果代入内积表达式：\n$$ \\langle A, A \\rangle = \\frac{A^2}{2\\pi} (2\\pi) = A^2 $$\n为了归一化，我们必须有 $A^2 = 1$。选择正的常数，我们得到 $A=1$。\n\n2.  **余弦函数 $\\varphi_2(x) = B \\cos(kx)$ 的归一化**\n\n归一化条件是 $\\langle \\varphi_2, \\varphi_2 \\rangle = 1$。\n$$ \\langle B\\cos(kx), B\\cos(kx) \\rangle = \\frac{1}{2\\pi}\\int_{0}^{2\\pi} (B\\cos(kx))^2 \\,dx = \\frac{B^2}{2\\pi}\\int_{0}^{2\\pi} \\cos^2(kx) \\,dx $$\n为计算该积分，我们使用降幂恒等式 $\\cos^2(\\theta) = \\frac{1+\\cos(2\\theta)}{2}$。\n$$ \\int_{0}^{2\\pi} \\cos^2(kx) \\,dx = \\int_{0}^{2\\pi} \\frac{1+\\cos(2kx)}{2} \\,dx = \\frac{1}{2} \\left[ \\int_{0}^{2\\pi} 1 \\,dx + \\int_{0}^{2\\pi} \\cos(2kx) \\,dx \\right] $$\n第一个积分是 $\\int_{0}^{2\\pi} 1 \\,dx = 2\\pi$。第二个积分是：\n$$ \\int_{0}^{2\\pi} \\cos(2kx) \\,dx = \\left[ \\frac{\\sin(2kx)}{2k} \\right]_0^{2\\pi} $$\n由于 $k$ 是一个正整数，$2k$ 也是一个整数。因此，$\\sin(2k \\cdot 2\\pi) = \\sin(4\\pi k) = 0$ 且 $\\sin(0)=0$。该积分计算结果为 $0$。\n因此，$\\int_{0}^{2\\pi} \\cos^2(kx) \\,dx = \\frac{1}{2} [2\\pi + 0] = \\pi$。\n将此结果代入内积表达式：\n$$ \\langle B\\cos(kx), B\\cos(kx) \\rangle = \\frac{B^2}{2\\pi} (\\pi) = \\frac{B^2}{2} $$\n为了归一化，我们令 $\\frac{B^2}{2} = 1$，这得到 $B^2=2$。选择正的常数，我们有 $B=\\sqrt{2}$。\n\n3.  **正弦函数 $\\varphi_3(x) = C \\sin(kx)$ 的归一化**\n\n归一化条件是 $\\langle \\varphi_3, \\varphi_3 \\rangle = 1$。\n$$ \\langle C\\sin(kx), C\\sin(kx) \\rangle = \\frac{1}{2\\pi}\\int_{0}^{2\\pi} (C\\sin(kx))^2 \\,dx = \\frac{C^2}{2\\pi}\\int_{0}^{2\\pi} \\sin^2(kx) \\,dx $$\n使用降幂恒等式 $\\sin^2(\\theta) = \\frac{1-\\cos(2\\theta)}{2}$：\n$$ \\int_{0}^{2\\pi} \\sin^2(kx) \\,dx = \\int_{0}^{2\\pi} \\frac{1-\\cos(2kx)}{2} \\,dx = \\frac{1}{2} \\left[ \\int_{0}^{2\\pi} 1 \\,dx - \\int_{0}^{2\\pi} \\cos(2kx) \\, dx \\right] $$\n如前所计算，$\\int_{0}^{2\\pi} 1 \\,dx = 2\\pi$ 且 $\\int_{0}^{2\\pi} \\cos(2kx) \\,dx = 0$。\n所以，$\\int_{0}^{2\\pi} \\sin^2(kx) \\,dx = \\frac{1}{2} [2\\pi - 0] = \\pi$。\n将此结果代入内积表达式：\n$$ \\langle C\\sin(kx), C\\sin(kx) \\rangle = \\frac{C^2}{2\\pi} (\\pi) = \\frac{C^2}{2} $$\n为了归一化，$\\frac{C^2}{2} = 1$，得到 $C^2=2$。选择正的常数，$C=\\sqrt{2}$。\n\n4.  **正交性验证**\n\n我们必须验证当 $i \\neq j$ 时 $\\langle \\varphi_i, \\varphi_j \\rangle = 0$。\n\n-   $\\langle \\varphi_1, \\varphi_2 \\rangle = \\langle A, B\\cos(kx) \\rangle = \\frac{AB}{2\\pi}\\int_{0}^{2\\pi} \\cos(kx) \\,dx$。由于 $k$ 是一个正整数，\n    $$ \\int_{0}^{2\\pi} \\cos(kx) \\,dx = \\left[\\frac{\\sin(kx)}{k}\\right]_0^{2\\pi} = \\frac{\\sin(2\\pi k) - \\sin(0)}{k} = \\frac{0-0}{k} = 0 $$\n    因此，$\\langle \\varphi_1, \\varphi_2 \\rangle = 0$。\n\n-   $\\langle \\varphi_1, \\varphi_3 \\rangle = \\langle A, C\\sin(kx) \\rangle = \\frac{AC}{2\\pi}\\int_{0}^{2\\pi} \\sin(kx) \\,dx$。由于 $k$ 是一个正整数，\n    $$ \\int_{0}^{2\\pi} \\sin(kx) \\,dx = \\left[-\\frac{\\cos(kx)}{k}\\right]_0^{2\\pi} = -\\frac{\\cos(2\\pi k) - \\cos(0)}{k} = -\\frac{1-1}{k} = 0 $$\n    因此，$\\langle \\varphi_1, \\varphi_3 \\rangle = 0$。\n\n-   $\\langle \\varphi_2, \\varphi_3 \\rangle = \\langle B\\cos(kx), C\\sin(kx) \\rangle = \\frac{BC}{2\\pi}\\int_{0}^{2\\pi} \\cos(kx)\\sin(kx) \\,dx$。使用恒等式 $\\sin(2\\theta) = 2\\sin(\\theta)\\cos(\\theta)$，我们有 $\\cos(kx)\\sin(kx) = \\frac{1}{2}\\sin(2kx)$。\n    $$ \\int_{0}^{2\\pi} \\cos(kx)\\sin(kx) \\,dx = \\frac{1}{2}\\int_{0}^{2\\pi} \\sin(2kx) \\,dx = \\frac{1}{2}\\left[-\\frac{\\cos(2kx)}{2k}\\right]_0^{2\\pi} $$\n    由于 $k$ 是一个正整数，$2k$ 是一个整数，所以 $\\cos(2k \\cdot 2\\pi) = \\cos(4\\pi k) = 1$ 且 $\\cos(0)=1$。\n    $$ \\frac{1}{2} \\left(-\\frac{1-1}{2k}\\right) = 0 $$\n    因此，$\\langle \\varphi_2, \\varphi_3 \\rangle = 0$。\n\n正交性条件得到满足。归一化常数为 $A=1$，$B=\\sqrt{2}$ 和 $C=\\sqrt{2}$。最终答案是这些常数组成的行矩阵。", "answer": "$$ \\boxed{ \\begin{pmatrix} 1  \\sqrt{2}  \\sqrt{2} \\end{pmatrix} } $$", "id": "3387170"}, {"introduction": "在使用谱方法求解非线性偏微分方程时，一个核心挑战是如何准确计算如 $u^p$ 这样的非线性项。有限傅里叶级数的乘积会产生更高频率的模式，如果处理不当，这些高频信息会通过“混叠”效应污染低频模式，导致严重的计算误差。本练习旨在解决这一关键问题，通过分析周期函数梯形求积法则的精确性，你将推导出为避免混叠误差所需的最小求积点数，即所谓的“去混叠”法则 [@problem_id:3387173]。", "problem": "考虑在区间 $[0,2\\pi)$ 上的复指数傅里叶基 $\\{\\phi_{k}(x)\\}_{k\\in\\mathbb{Z}}$，其中 $\\phi_{k}(x)=\\exp(i k x)$。设 $K\\in\\mathbb{N}$，并定义截断的傅里叶-伽辽金空间 $V_{K}=\\mathrm{span}\\{\\phi_{k}:|k|\\le K\\}$，其维度为 $N=2K+1$。设 $u_{N}(x)=\\sum_{|k|\\le K}\\hat{u}_{k}\\,\\exp(i k x)\\in V_{K}$ 是一个 $2\\pi$-周期函数。对于一个固定的整数 $p\\ge 2$，$p$ 次多项式非线性的第 $k$ 个伽辽金系数是精确的内积\n$$\n\\mathcal{I}_{k}=\\int_{0}^{2\\pi} \\big(u_{N}(x)\\big)^{p}\\,\\overline{\\phi_{k}(x)}\\,dx=\\int_{0}^{2\\pi} \\big(u_{N}(x)\\big)^{p}\\,\\exp(-i k x)\\,dx,\\quad |k|\\le K.\n$$\n假设 $\\mathcal{I}_{k}$ 使用复合梯形法则，以 $M$ 个等距节点 $x_{j}=\\tfrac{2\\pi j}{M}$（其中 $j=0,1,\\dots,M-1$）进行计算，即\n$$\n\\mathcal{Q}_{M}\\big[(u_{N})^{p}\\,\\overline{\\phi_{k}}\\big]=\\frac{2\\pi}{M}\\sum_{j=0}^{M-1} \\big(u_{N}(x_{j})\\big)^{p}\\,\\exp(-i k x_{j}).\n$$\n仅使用傅里叶级数和在 $[0,2\\pi)$ 上的复合梯形法则的基本性质，确定最小整数 $M$（作为 $p$ 和 $K$ 的函数），使得对于 $\\{\\hat{u}_{k}\\}_{|k|\\le K}$ 的所有选择以及所有 $|k|\\le K$，求积公式 $\\mathcal{Q}_{M}$ 都能返回精确积分 $\\mathcal{I}_{k}$。定义过采样因子 $\\rho=\\tfrac{M}{N}=\\tfrac{M}{2K+1}$，并以 $p$ 和 $K$ 的闭式符号表达式形式给出最小过采样因子 $\\rho_{\\min}$。你的最终答案必须是 $\\rho_{\\min}$ 的这个表达式。", "solution": "问题要求，对于在 $[0, 2\\pi)$ 上的复合梯形法则，为精确计算多项式非线性项 $(u_N(x))^p$ 在所有模式 $|k| \\le K$ 以及对 $u_N$ 的所有傅里叶系数选择下的伽辽金系数 $\\mathcal{I}_k$，所需的最小求积点数 $M$ 是多少。由此，我们要确定最小过采样因子 $\\rho_{\\min}$。\n\n设 $f(x)$ 是一个 $2\\pi$-周期函数，其收敛的傅里叶级数为 $f(x) = \\sum_{m \\in \\mathbb{Z}} \\hat{f}_m \\exp(imx)$。$f(x)$ 在其周期上的精确积分为\n$$\n\\int_{0}^{2\\pi} f(x) \\,dx = \\int_{0}^{2\\pi} \\left( \\sum_{m \\in \\mathbb{Z}} \\hat{f}_m \\exp(imx) \\right) dx = \\sum_{m \\in \\mathbb{Z}} \\hat{f}_m \\int_{0}^{2\\pi} \\exp(imx) \\,dx = 2\\pi \\hat{f}_0.\n$$\n使用 $M$ 个等距节点 $x_j = \\frac{2\\pi j}{M}$（其中 $j=0, \\dots, M-1$）的复合梯形法则将此积分近似为\n$$\n\\mathcal{Q}_M[f] = \\frac{2\\pi}{M} \\sum_{j=0}^{M-1} f(x_j) = \\frac{2\\pi}{M} \\sum_{j=0}^{M-1} \\sum_{m \\in \\mathbb{Z}} \\hat{f}_m \\exp(imx_j) = \\frac{2\\pi}{M} \\sum_{m \\in \\mathbb{Z}} \\hat{f}_m \\left( \\sum_{j=0}^{M-1} \\exp\\left(im \\frac{2\\pi j}{M}\\right) \\right).\n$$\n内层的求和是一个几何级数，当 $m$ 是 $M$ 的倍数时（即，对于某个 $l \\in \\mathbb{Z}$ 有 $m=lM$），其值为 $M$，否则为 $0$。因此，求积公式的计算结果为\n$$\n\\mathcal{Q}_M[f] = 2\\pi \\sum_{l \\in \\mathbb{Z}} \\hat{f}_{lM}.\n$$\n这就是混叠公式。求积公式 $\\mathcal{Q}_M[f]$ 是精确的，当且仅当所有 $l \\neq 0$ 的混叠项都为零，即 $\\sum_{l \\in \\mathbb{Z}, l \\neq 0} \\hat{f}_{lM} = 0$。如果 $f(x)$ 是一个次数为 $L$ 的三角多项式，意味着其傅里叶系数 $\\hat{f}_m$ 对所有 $|m| > L$ 都为零，那么对于所有非零整数 $l$，若 $|lM| > L$，则该精确性条件得到满足。最严格的情况是 $l = \\pm 1$，这要求 $M > L$。因此，使求积公式精确的最小整数 $M$ 是 $M = L+1$。\n\n在我们的问题中，要计算的积分是 $\\mathcal{I}_k = \\int_{0}^{2\\pi} (u_N(x))^p \\exp(-ikx) dx$。被积函数是 $f_k(x) = (u_N(x))^p \\exp(-ikx)$。我们需要在所有有效的选择中（即，对所有 $|k| \\le K$ 和任意一组系数 $\\{\\hat{u}_k\\}_{|k|\\le K}$），找到 $f_k(x)$ 的最大次数。\n\n函数 $u_N(x) = \\sum_{|k'|\\le K} \\hat{u}_{k'} \\exp(ik'x)$ 是一个次数至多为 $K$ 的三角多项式。在“对于 $\\{\\hat{u}_k\\}$ 的所有选择”的条件下，我们必须假设一种最坏情况，即对应最高和最低频率的系数 $\\hat{u}_K$ 和 $\\hat{u}_{-K}$ 是非零的。因此，$u_N(x)$ 的次数恰好是 $K$。\n\n项 $(u_N(x))^p$ 是 $p$ 个这样的多项式的乘积。根据卷积定理，乘积的傅里叶模式集合是各因子的模式集合的闵可夫斯基和。$u_N(x)$ 中的频率在集合 $\\{-K, -K+1, \\dots, K\\}$ 中。$(u_N(x))^p$ 中的频率是 $p$ 个此类频率的和，因此位于范围 $[-pK, pK]$ 内。由于我们必须考虑所有系数选择，我们可以构造一个 $u_N(x)$（例如，$u_N(x) = \\exp(iKx)$），使其 $(u_N(x))^p = \\exp(ipKx)$，所以最大频率确实是 $pK$。因此，$(u_N(x))^p$ 是一个次数为 $pK$ 的三角多项式。\n\n被积函数是 $f_k(x) = (u_N(x))^p \\exp(-ikx)$。这个函数的频率是 $(u_N(x))^p$ 的频率平移 $-k$ 得到。由于 $(u_N(x))^p$ 的频率在 $[-pK, pK]$ 内，因此 $f_k(x)$ 的频率在范围 $[-pK-k, pK-k]$ 内。\n\n对于固定的 $k$，$f_k(x)$ 的次数是存在的频率的最大绝对值。\n$$\nL_k = \\max(|-pK-k|, |pK-k|).\n$$\n由于 $p \\ge 2$ 且 $K \\ge 1$，所以 $pK$ 是正的。该表达式简化为\n$$\nL_k = \\max(pK+k, pK-k) \\quad \\text{如果 } k \\ge 0, \\quad \\text{或} \\quad \\max(pK-k, pK+k) \\quad \\text{如果 } k  0.\n$$\n一般来说，这是 $pK+|k|$。\n\n求积法则必须对所有的 $|k| \\le K$ 都精确。这要求点数 $M$ 对于次数最高的被积函数是足够的。我们必须在所有被积函数 $f_k(x)$（其中 $|k| \\le K$）中找到最大可能次数 $L_{\\max}$。\n$$\nL_{\\max} = \\max_{|k| \\le K} L_k = \\max_{|k| \\le K} (pK+|k|).\n$$\n当 $|k|$ 最大化时，函数 $pK+|k|$ 也最大化。由于 $|k| \\le K$，最大值在 $|k|=K$ 时取得。\n$$\nL_{\\max} = pK+K = (p+1)K.\n$$\n为了使复合梯形法则对所有这些被积函数都精确，求积点数 $M$ 必须严格大于任何一个被积函数的最大可能次数。\n$$\nM  L_{\\max} \\implies M  (p+1)K.\n$$\n满足此条件的最小整数 $M$ 是\n$$\nM_{\\min} = (p+1)K + 1.\n$$\n问题定义了空间 $V_K$ 的维度为 $N = 2K+1$，过采样因子为 $\\rho = \\frac{M}{N}$。我们被要求求出最小过采样因子 $\\rho_{\\min}$，它对应于 $M_{\\min}$。\n$$\n\\rho_{\\min} = \\frac{M_{\\min}}{N} = \\frac{(p+1)K+1}{2K+1}.\n$$\n这个表达式给出了在计算 $p$ 次多项式非线性的伽辽金投影时，为防止混叠误差所需的最小过采样因子。对于二次非线性（$p=2$）的常见情况，这个因子是 $\\rho_{\\min} = \\frac{3K+1}{2K+1}$，当 $K$ 很大时，它趋近于 $\\frac{3}{2}$，这对应于众所周知的用于去混叠的“3/2法则”。", "answer": "$$\n\\boxed{\\frac{(p+1)K+1}{2K+1}}\n$$", "id": "3387173"}, {"introduction": "在科学计算中，尤其是在模拟解的复杂度随时间演变的动态问题（如激波形成）时，固定的计算资源分配往往效率低下。本实践练习将理论与编程相结合，指导你设计一个自适应傅里叶谱方法的核心逻辑。你将利用帕塞瓦尔定理来估计截断误差，并实现一个带有滞后效应的准则，以动态调整所需的傅里叶模态数量，从而在保证精度的前提下实现计算效率的最大化 [@problem_id:3387179]。", "problem": "考虑空间域 $[0,2\\pi)$ 上的一个周期性问题，其傅里叶基为 $\\{e^{\\mathrm{i}kx}\\}_{k\\in\\mathbb{Z}}$。设一个实值函数 $u(x,t)$ 在 $M$ 个等距点 $x_j=\\frac{2\\pi j}{M}$ (其中 $j=0,1,\\dots,M-1$) 上进行采样。记其在波数 $k\\in\\mathbb{Z}$ 处的离散傅里叶系数为 $\\hat{u}_k(t)$，该系数通过离散傅里叶变换计算得到。定义每模能量为 $\\mathcal{E}_k(t)=|\\hat{u}_k(t)|^2$，总能量为 $\\mathcal{E}_{\\mathrm{tot}}(t)=\\sum_{k\\in\\mathbb{Z}}\\mathcal{E}_k(t)$。对于一个截断波数 $N(t)\\in\\mathbb{N}$，截断谱近似 $u_N(x,t)$ 保留 $|k|\\le N(t)$ 的模式。\n\n您的任务是设计并实现一个自适应截断准则，该准则能够增长或收缩 $N(t)$，以便对于具有时变光滑度的解，在 $L^2$ 范数下保持一个目标相对误差容限 $\\varepsilon$。从以下基础开始：\n\n- $[0,2\\pi)$ 上周期函数的傅里叶级数。\n- 平方可积周期函数的帕塞瓦尔(Parseval)恒等式，它意味着 $L^2$ 范数的平方等于傅里叶系数模的平方和。\n\n利用这些，推导一个选择最小截断指数 $N_{\\min}(t)$ 的规则，使得被忽略的尾部能量相对于总能量足够小。设尾部能量为 $\\mathcal{T}(N,t)=\\sum_{|k|N}\\mathcal{E}_k(t)$，并定义相对尾部份额为 $f(N,t)=\\frac{\\mathcal{T}(N,t)}{\\mathcal{E}_{\\mathrm{tot}}(t)}$（当 $\\mathcal{E}_{\\mathrm{tot}}(t)0$ 时）。在 $\\mathcal{E}_{\\mathrm{tot}}(t)=0$ 的退化情况下，定义 $N_{\\min}(t)=0$ 和一个中性动作。\n\n为避免 $N(t)$ 发生抖动，引入包含两个阈值 $0  \\alpha  \\beta  1$ 的迟滞机制，如下所示：\n- 如果 $f(N(t),t) > \\beta\\,\\varepsilon^2$，选择增长到 $N_{\\min}(t)$。\n- 如果 $f(N(t),t)  \\alpha\\,\\varepsilon^2$，选择收缩到 $N_{\\min}(t)$。\n- 否则，保持 $N(t)$ 不变。\n\n在一个程序中实现此准则，对于一组给定的快照 $u(x)$，根据当前的 $N$ 和容限 $\\varepsilon$，计算 $N_{\\min}$ 和分别表示收缩、保持、增长的动作指示器 $a\\in\\{-1,0,1\\}$。使用 $M$ 个点的等距采样，并按绝对波数 $|k|$ 对能量进行分组，使得每个整数波数处的径向能量是 $k$ 和 $-k$ 上能量的总和。傅里叶变换的离散缩放可能与连续归一化不同，但相对尾部份额 $f(N)$ 的计算必须保持一致，以便公共的缩放因子能够抵消。\n\n角度单位必须是弧度。\n\n测试套件：\n使用 $M=256$，阈值 $\\alpha=0.25$ 和 $\\beta=0.75$，以及以下 5 个测试用例。在每个用例中，程序必须在 $M$ 个点上构建 $u(x)$，计算离散傅里叶变换和能量，然后使用上述规则确定 $N_{\\min}$ 和动作。\n\n- 用例 1：$u_1(x)=\\sin(x)+0.2\\,\\sin(5x)$，$\\varepsilon=10^{-6}$，当前 $N=8$。\n- 用例 2：$u_2(x)=\\sin(x)+0.2\\,\\sin(5x)+0.2\\,\\sin(30x)$，$\\varepsilon=10^{-3}$，当前 $N=8$。\n- 用例 3：$u_3(x)=\\sin(x)$，$\\varepsilon=10^{-4}$，当前 $N=64$。\n- 用例 4：$u_4(x)=0$，$\\varepsilon=10^{-2}$，当前 $N=10$。\n- 用例 5：$u_5(x)=a\\,\\sin(x)+b\\,\\sin(16x)$，其中 $a=1$，$b=\\sqrt{\\frac{\\beta\\,\\varepsilon^2}{1-\\beta\\,\\varepsilon^2}}$，使用 $\\varepsilon=10^{-1}$，当前 $N=8$。\n\n要求的最终输出格式：\n您的程序应生成单行输出，其中包含一个结果列表，每个测试用例一个结果，每个结果是一个列表 $[N_{\\min},a]$，其中 $N_{\\min}\\in\\mathbb{N}$ 且 $a\\in\\{-1,0,1\\}$。输出必须是单个逗号分隔的列表，并用方括号括起来，例如 $[[N_{\\min,1},a_1],[N_{\\min,2},a_2],\\dots,[N_{\\min,5},a_5]]$。", "solution": "该问题要求为周期域上的傅里叶谱方法设计并实现一个自适应截断准则。该准则调整截断波数 $N(t)$，以在 $L^2$ 范数下维持一个指定的相对误差容限 $\\varepsilon$。该自适应方法包含一个迟滞机制，以防止 $N(t)$ 的快速振荡。\n\n### 理论基础与推导\n\n周期域 $[0, 2\\pi)$ 上的一个实值、平方可积函数 $u(x)$ 可以用其傅里叶级数表示：\n$$u(x) = \\sum_{k=-\\infty}^{\\infty} c_k e^{\\mathrm{i}kx}$$\n其中 $c_k = \\frac{1}{2\\pi} \\int_0^{2\\pi} u(x) e^{-\\mathrm{i}kx} dx$ 是傅里叶系数。对于实函数 $u(x)$，这些系数满足对称性 $c_{-k} = \\overline{c_k}$。\n\n帕塞瓦尔(Parseval)定理将函数模平方的积分（其能量）与其傅里叶系数模的平方和联系起来：\n$$\\frac{1}{2\\pi} \\int_0^{2\\pi} |u(x)|^2 dx = \\|u\\|_{L^2}^2 = \\sum_{k=-\\infty}^{\\infty} |c_k|^2$$\n\n谱近似 $u_N(x)$ 是通过截断级数形成的，仅保留绝对波数 $|k| \\le N$ 的模式：\n$$u_N(x) = \\sum_{k=-N}^{N} c_k e^{\\mathrm{i}kx}$$\n截断误差为 $e_N(x) = u(x) - u_N(x) = \\sum_{|k|N} c_k e^{\\mathrm{i}kx}$。根据帕塞瓦尔定理，该误差的 $L^2$ 范数平方为：\n$$\\|e_N\\|_{L^2}^2 = \\sum_{|k|N} |c_k|^2$$\n\n$L^2$ 范数下的相对误差为 $\\frac{\\|e_N\\|_{L^2}}{\\|u\\|_{L^2}}$。该量的平方是谱的截断尾部能量与信号总能量之比：\n$$\\left(\\frac{\\|e_N\\|_{L^2}}{\\|u\\|_{L^2}}\\right)^2 = \\frac{\\sum_{|k|N} |c_k|^2}{\\sum_{k=-\\infty}^{\\infty} |c_k|^2}$$\n\n在数值计算中，函数 $u(x)$ 在 $M$ 个离散的等距点 $x_j = \\frac{2\\pi j}{M}$ 上采样。使用离散傅里叶变换 (DFT) 计算一组离散傅里叶系数 $\\hat{u}_k$，其波数 $k$ 在一个有限范围内（通常为 $|k| \\le M/2$）。虽然 DFT 系数的缩放可能与连续系数 $c_k$ 不同，但能量之比与此缩放无关。\n\n我们将离散的每模能量定义为 $\\mathcal{E}_k = |\\hat{u}_k|^2$，总能量为 $\\mathcal{E}_{\\mathrm{tot}} = \\sum_k \\mathcal{E}_k$，对于截断 $N$ 的尾部能量为 $\\mathcal{T}(N) = \\sum_{|k|N} \\mathcal{E}_k$。平方相对误差的离散模拟是相对尾部份额：\n$$f(N) = \\frac{\\mathcal{T}(N)}{\\mathcal{E}_{\\mathrm{tot}}}$$\n目标是维持相对误差容限 $\\varepsilon$，这转化为保持 $f(N) \\le \\varepsilon^2$。\n\n### 算法设计\n\n任务有两部分：首先，确定满足容限的最小截断指数 $N_{\\min}$；其次，根据迟滞规则，为当前截断指数 $N$ 决定一个动作（增长、收缩或保持）。\n\n**1. 计算最小截断指数 $N_{\\min}$**\n\n$N_{\\min}$ 被定义为满足 $f(N) \\le \\varepsilon^2$ 的最小非负整数 $N$。\n$$f(N) = \\frac{\\sum_{|k|N} \\mathcal{E}_k}{\\mathcal{E}_{\\mathrm{tot}}} \\le \\varepsilon^2$$\n这个不等式可以根据模式 $|k| \\le N$ 内包含的能量重写：\n$$\\mathcal{E}_{\\mathrm{tot}} - \\sum_{|k|\\le N} \\mathcal{E}_k \\le \\varepsilon^2 \\mathcal{E}_{\\mathrm{tot}}$$\n$$\\sum_{|k|\\le N} \\mathcal{E}_k \\ge (1-\\varepsilon^2) \\mathcal{E}_{\\mathrm{tot}}$$\n这给出了一个找到 $N_{\\min}$ 的直接算法：\n1.  使用 FFT 计算采样函数的离散傅里叶系数 $\\hat{u}_k$。\n2.  计算每模能量 $\\mathcal{E}_k = |\\hat{u}_k|^2$ 和总能量 $\\mathcal{E}_{\\mathrm{tot}} = \\sum_k \\mathcal{E}_k$。\n3.  对于实信号，$\\mathcal{E}_k = \\mathcal{E}_{-k}$。按绝对波数 $|k|$ 对能量进行分组，为 $K \\ge 0$ 定义径向能量 $E_K = \\sum_{|k|=K} \\mathcal{E}_k$。\n4.  计算目标累积能量 $E_{\\mathrm{target}} = (1-\\varepsilon^2) \\mathcal{E}_{\\mathrm{tot}}$。\n5.  按递增顺序遍历绝对波数 $K = 0, 1, 2, \\dots$，计算累积能量 $C_K = \\sum_{i=0}^K E_i$。\n6.  $N_{\\min}$ 是第一个使 $C_K \\ge E_{\\mathrm{target}}$ 的 $K$ 值。\n7.  如果 $u(x)=0$，则 $\\mathcal{E}_{\\mathrm{tot}}=0$。问题规定 $N_{\\min}=0$。\n\n**2. 基于迟滞的动作指示器**\n\n给定当前截断指数 $N$，我们计算相对尾部份额 $f(N)$。动作 $a \\in \\{-1, 0, 1\\}$（分别代表收缩、保持、增长）是通过将 $f(N)$ 与基于 $\\varepsilon^2$ 和参数 $0  \\alpha  \\beta  1$ 的两个阈值进行比较来确定的。\n1.  计算 $f(N) = \\mathcal{T}(N) / \\mathcal{E}_{\\mathrm{tot}}$。这最容易通过 $1 - (\\sum_{|k|\\le N} \\mathcal{E}_k) / \\mathcal{E}_{\\mathrm{tot}}$ 来计算。\n2.  应用规则：\n    -   如果 $f(N) > \\beta \\varepsilon^2$，则误差过大。设置 $a=1$（增长）。\n    -   如果 $f(N)  \\alpha \\varepsilon^2$，则分辨率过高，可以降低。设置 $a=-1$（收缩）。\n    -   否则，如果 $\\alpha \\varepsilon^2 \\le f(N) \\le \\beta \\varepsilon^2$，则误差在可接受范围内。设置 $a=0$（保持）。\n3.  在 $u(x)=0$ 的情况下，$\\mathcal{E}_{\\mathrm{tot}}=0$ 且 $f(N)$ 未定义。“否则”的情况适用，导致中性动作 $a=0$。\n\n此过程为每个给定的函数 $u(x)$ 快照提供所需的配对 $[N_{\\min}, a]$。", "answer": "```python\nimport numpy as np\n\ndef analyze_snapshot(u_func, N_current, epsilon, M, alpha, beta):\n    \"\"\"\n    Computes the minimal truncation wavenumber N_min and the adaptation\n    action 'a' for a given function snapshot.\n\n    Args:\n        u_func (callable): Function u(x) to analyze.\n        N_current (int): The current truncation wavenumber.\n        epsilon (float): The target relative L2 error tolerance.\n        M (int): The number of equispaced sample points.\n        alpha (float): The lower hysteresis threshold parameter.\n        beta (float): The upper hysteresis threshold parameter.\n\n    Returns:\n        list: A list [N_min, a] where N_min is the minimal required\n              wavenumber and a is the action {-1: shrink, 0: keep, 1: grow}.\n    \"\"\"\n    # 1. Discretize the function on the domain [0, 2*pi).\n    x = 2 * np.pi * np.arange(M) / M\n    u = u_func(x)\n\n    # 2. Compute the DFT and the per-mode energies.\n    u_hat = np.fft.fft(u)\n    energies = np.abs(u_hat)**2\n    total_energy = np.sum(energies)\n\n    # 3. Handle the zero-energy case as specified.\n    # Use a small tolerance for floating-point comparisons.\n    if total_energy  1e-15:\n        return [0, 0]\n\n    # 4. Group energies by absolute wavenumber |k|.\n    # np.fft.fftfreq(M, d=1.0/M) gives integer wavenumbers directly.\n    wavenums = np.fft.fftfreq(M) * M\n    \n    radial_energies = {}\n    for k, E in zip(wavenums, energies):\n        k_abs = int(round(abs(k)))\n        radial_energies[k_abs] = radial_energies.get(k_abs, 0.0) + E\n\n    # 5. Calculate N_min: the smallest N such that the captured energy is\n    # at least (1 - epsilon^2) of the total energy.\n    target_cumulative_energy = (1 - epsilon**2) * total_energy\n    \n    sorted_abs_k = sorted(radial_energies.keys())\n    max_wavenum = sorted_abs_k[-1] if sorted_abs_k else 0\n    \n    current_cumulative_energy = 0.0\n    N_min = 0\n    \n    # Iterate through all possible integer wavenumbers up to the maximum found.\n    found_N_min = False\n    for N_test in range(max_wavenum + 1):\n        current_cumulative_energy += radial_energies.get(N_test, 0.0)\n        # Use a small tolerance for floating point comparison to be safe\n        if current_cumulative_energy >= target_cumulative_energy - 1e-15:\n            N_min = N_test\n            found_N_min = True\n            break\n            \n    if not found_N_min:\n        # This fallback is reached if even with all modes, the target is\n        # not met due to precision issues with very small epsilon.\n        N_min = max_wavenum\n\n    # 6. Calculate f(N_current), the relative tail fraction for the current N.\n    cumulative_at_N_current = 0.0\n    for N_test in range(N_current + 1):\n        cumulative_at_N_current += radial_energies.get(N_test, 0.0)\n    \n    tail_energy_at_N_current = total_energy - cumulative_at_N_current\n    # Avoid division by zero, although handled by the initial total_energy check.\n    f_N_current = tail_energy_at_N_current / total_energy\n\n    # 7. Apply hysteresis logic to determine the action 'a'.\n    action = 0  # Default: keep\n    if f_N_current > beta * epsilon**2:\n        action = 1  # Grow\n    elif f_N_current  alpha * epsilon**2:\n        action = -1 # Shrink\n    \n    return [N_min, action]\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    M = 256\n    alpha = 0.25\n    beta = 0.75\n\n    # Define test cases\n    epsilon_1 = 1e-6\n    u_1 = lambda x: np.sin(x) + 0.2 * np.sin(5 * x)\n\n    epsilon_2 = 1e-3\n    u_2 = lambda x: np.sin(x) + 0.2 * np.sin(5 * x) + 0.2 * np.sin(30 * x)\n    \n    epsilon_3 = 1e-4\n    u_3 = lambda x: np.sin(x)\n\n    epsilon_4 = 1e-2\n    u_4 = lambda x: np.zeros_like(x)\n\n    epsilon_5 = 1e-1\n    a5, b5 = 1.0, np.sqrt((beta * epsilon_5**2) / (1 - beta * epsilon_5**2))\n    u_5 = lambda x: a5 * np.sin(x) + b5 * np.sin(16*x)\n\n    test_cases = [\n        (u_1, 8, epsilon_1),\n        (u_2, 8, epsilon_2),\n        (u_3, 64, epsilon_3),\n        (u_4, 10, epsilon_4),\n        (u_5, 8, epsilon_5)\n    ]\n\n    results = []\n    for u_func, N_current, epsilon in test_cases:\n        result = analyze_snapshot(u_func, N_current, epsilon, M, alpha, beta)\n        results.append(result)\n\n    # Format the output as a string representing a list of lists.\n    # Ex: [[5, -1], [30, 1], ...]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```", "id": "3387179"}]}