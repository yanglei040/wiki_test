{"hands_on_practices": [{"introduction": "守恒律的弱解不唯一，特别是在出现间断（激波）时。为了筛选出物理上相关的解，我们需要一个额外的准则，即熵条件。这个练习将引导你从最基本的原理出发，推导激波速度的Rankine–Hugoniot条件，并使用Kružkov熵不等式来验证一个解的物理可容许性，从而为数值方法的构建奠定理论基础。[@problem_id:3384188]", "problem": "考虑无粘性 Burgers 方程的标量守恒律，其通量为 $f(u) = \\frac{u^{2}}{2}$，\n$$u_{t} + f(u)_{x} = 0,$$\n以及一个位于界面 $x = s\\,t$ 上的单一间断（激波），该界面分隔了常数左状态 $u_{L}$ 和右状态 $u_{R}$。在为间断伽辽金（Discontinuous Galerkin, DG）方法设计熵相容的界面通量的背景下，从积分形式的守恒律出发，推导激波速度 $s$ 关于 $u_{L}$ 和 $u_{R}$ 的 Rankine–Hugoniot 条件。然后，从 Kružkov 熵的定义\n$$U(u) = |u - k| \\quad \\text{for arbitrary } k \\in \\mathbb{R},$$\n出发，利用相容性条件 $F_{k}'(u) = U'(u)\\,f'(u)$（在分布意义下解释 $U$ 在 $u = k$ 处的不可微性）推导相关的熵通量 $F_{k}(u)$，并以分布形式验证跨激波的熵不等式\n$$s\\,[U(u)] - [F_{k}(u)] \\ge 0,$$\n对于任意 $k \\in \\mathbb{R}$，其中 $[g] := g(u_{R}) - g(u_{L})$ 表示 $g$ 跨越激波的跳跃。最后，给出 Rankine–Hugoniot 激波速度 $s$ 作为 $u_{L}$ 和 $u_{R}$ 函数的闭式表达式。最终答案必须以解析表达式给出；不包含单位，也不要四舍五入。", "solution": "该问题陈述经评估有效。这是一个适定的、有科学依据的客观问题，要求对无粘性 Burgers 方程进行 Rankine-Hugoniot 条件的标准推导，并验证激波解的 Kružkov 熵条件。这些是双曲守恒律理论及其数值近似中的基本概念。\n\n标量守恒律由下式给出\n$$u_{t} + f(u)_{x} = 0$$\n其中无粘性 Burgers 方程的通量函数为 $f(u) = \\frac{u^{2}}{2}$。\n我们考虑一个以单激波形式存在的弱解，其解是分段常数：\n$$u(x,t) = \\begin{cases} u_{L}  \\text{if } x  s\\,t \\\\ u_{R}  \\text{if } x > s\\,t \\end{cases}$$\n这里，$u_{L}$ 和 $u_{R}$ 分别是间断左右两侧的常数状态，而 $s$ 是激波的恒定速度。\n\n首先，我们推导激波速度 $s$ 的 Rankine–Hugoniot 条件。在任意固定的空间区间 $[x_{1}, x_{2}]$ 上，守恒律的积分形式为\n$$\\frac{d}{dt} \\int_{x_{1}}^{x_{2}} u(x,t)\\,dx = f(u(x_{1},t)) - f(u(x_{2},t))$$\n令区间 $[x_{1}, x_{2}]$ 在时间 $t$ 包含激波，即 $x_{1}  s\\,t  x_{2}$。代入分段常数解，左侧变为：\n$$\\frac{d}{dt} \\left( \\int_{x_{1}}^{s\\,t} u_{L}\\,dx + \\int_{s\\,t}^{x_{2}} u_{R}\\,dx \\right) = \\frac{d}{dt} \\left( u_{L}(s\\,t - x_{1}) + u_{R}(x_{2} - s\\,t) \\right)$$\n$$= \\frac{d}{dt} \\left( s\\,t(u_{L} - u_{R}) - u_{L}x_{1} + u_{R}x_{2} \\right) = s(u_{L} - u_{R})$$\n积分形式的右侧是 $f(u(x_{1},t)) - f(u(x_{2},t)) = f(u_{L}) - f(u_{R})$，因为 $x_{1}$ 在激波的左侧，$x_{2}$ 在右侧。\n令两侧相等，得到 Rankine–Hugoniot 条件：\n$$s(u_{L} - u_{R}) = f(u_{L}) - f(u_{R})$$\n这可以用跳跃符号 $[g] := g(u_{R}) - g(u_{L})$ 重写为：\n$$-s[u] = -[f(u)] \\implies s[u] = [f(u)]$$\n$$s = \\frac{[f(u)]}{[u]} = \\frac{f(u_{R}) - f(u_{L})}{u_{R} - u_{L}}$$\n\n接下来，我们推导与 Kružkov 熵 $U(u) = |u - k|$ 相关的熵通量 $F_{k}(u)$，其中 $k \\in \\mathbb{R}$ 为任意常数。熵通量 $F_{k}(u)$ 必须满足相容性条件 $F_{k}'(u) = U'(u)f'(u)$。\n对于 $f(u) = \\frac{u^{2}}{2}$，我们有 $f'(u) = u$。在分布意义下，熵函数的导数为 $U'(u) = \\frac{d}{du}|u-k| = \\text{sgn}(u-k)$。\n因此，相容性条件为 $F_{k}'(u) = u\\,\\text{sgn}(u-k)$。\n我们通过对该表达式积分来求得 $F_{k}(u)$：\n$$F_{k}(u) = \\int u\\,\\text{sgn}(u-k)\\,du$$\n我们可以将被积函数重写为 $u = (u-k) + k$：\n$$F_{k}(u) = \\int ((u-k)+k)\\,\\text{sgn}(u-k)\\,du = \\int (u-k)\\,\\text{sgn}(u-k)\\,du + \\int k\\,\\text{sgn}(u-k)\\,du$$\n第一项是 $\\int |u-k|\\,du$。第二项是 $k \\int \\text{sgn}(u-k)\\,du = k|u-k|$。\n$|z|$ 的积分是 $\\frac{1}{2}z|z|$（其中 $z=u-k$）。所以，\n$$\\int |u-k|\\,du = \\frac{1}{2}(u-k)|u-k|$$\n合并各项，我们得到（忽略任意积分常数，我们将其设为零）：\n$$F_{k}(u) = \\frac{1}{2}(u-k)|u-k| + k|u-k| = \\left(\\frac{u-k}{2} + k\\right)|u-k| = \\frac{u+k}{2}|u-k|$$\n这就是与 Burgers 方程的 Kružkov 熵相关的熵通量。\n\n现在，我们验证跨激波的熵不等式，其分布形式为：\n$$s\\,[U(u)] - [F_{k}(u)] \\ge 0$$ 对于任意 $k \\in \\mathbb{R}$。\n代入 $s$、$U(u)$ 和 $F_{k}(u)$ 的表达式：\n$$s\\,[|u-k|] - \\left[\\frac{u+k}{2}|u-k|\\right] \\ge 0$$\n使用从 Burgers 通量的 Rankine-Hugoniot 条件推导出的激波速度 $s = \\frac{u_{L}+u_{R}}{2}$：\n$$\\frac{u_{L}+u_{R}}{2}\\left(|u_{R}-k| - |u_{L}-k|\\right) - \\left(\\frac{u_{R}+k}{2}|u_{R}-k| - \\frac{u_{L}+k}{2}|u_{L}-k|\\right) \\ge 0$$\n我们将含有 $|u_{R}-k|$ 和 $|u_{L}-k|$ 的项分组：\n$$\\left(\\frac{u_{L}+u_{R}}{2} - \\frac{u_{R}+k}{2}\\right)|u_{R}-k| - \\left(\\frac{u_{L}+u_{R}}{2} - \\frac{u_{L}+k}{2}\\right)|u_{L}-k| \\ge 0$$\n简化系数：\n$$\\left(\\frac{u_{L}-k}{2}\\right)|u_{R}-k| - \\left(\\frac{u_{R}-k}{2}\\right)|u_{L}-k| \\ge 0$$\n乘以 $2$：\n$$(u_{L}-k)|u_{R}-k| - (u_{R}-k)|u_{L}-k| \\ge 0$$\n为了使该不等式对所有 $k \\in \\mathbb{R}$ 成立，必须有 $u_{L} > u_{R}$。这是像 Burgers 方程这样的凸标量守恒律中激波的 Lax 熵条件。我们来验证这一点。假设 $u_{L} > u_{R}$。\n情况1：$k \\le u_{R}$。那么 $k  u_{L}$。$|u_{R}-k| = u_{R}-k$ 且 $|u_{L}-k|=u_{L}-k$。不等式变为 $(u_{L}-k)(u_{R}-k) - (u_{R}-k)(u_{L}-k) = 0 \\ge 0$，成立。\n情况2：$k \\ge u_{L}$。那么 $k > u_{R}$。$|u_{R}-k| = -(u_{R}-k) = k-u_{R}$ 且 $|u_{L}-k|=-(u_{L}-k) = k-u_{L}$。不等式变为 $(u_{L}-k)(k-u_{R}) - (u_{R}-k)(k-u_{L}) = -(k-u_{L})(k-u_{R}) - (-(k-u_{R}))(k-u_{L}) = -(k-u_{L})(k-u_{R}) + (k-u_{R})(k-u_{L}) = 0 \\ge 0$，成立。\n情况3：$u_{R}  k  u_{L}$。$|u_{R}-k| = -(u_{R}-k) = k-u_{R}$ 且 $|u_{L}-k|=u_{L}-k$。不等式变为 $(u_{L}-k)(k-u_{R}) - (u_{R}-k)(u_{L}-k) = (u_{L}-k)(k-u_{R}) + (k-u_{R})(u_{L}-k) = 2(u_{L}-k)(k-u_{R}) \\ge 0$。\n由于 $u_{R}  k  u_{L}$，我们有 $u_{L}-k > 0$ 和 $k-u_{R} > 0$。它们的乘积为正，因此该不等式严格成立。\n当且仅当 $u_{L} > u_{R}$ 时，熵不等式对所有 $k \\in \\mathbb{R}$ 均成立，这定义了一个物理上允许的激波。\n\n最后，我们给出激波速度 $s$ 的闭式表达式。根据 Rankine-Hugoniot 条件：\n$$s = \\frac{f(u_{R}) - f(u_{L})}{u_{R} - u_{L}}$$\n代入 Burgers 方程的通量 $f(u) = \\frac{u^{2}}{2}$：\n$$s = \\frac{\\frac{u_{R}^{2}}{2} - \\frac{u_{L}^{2}}{2}}{u_{R} - u_{L}} = \\frac{\\frac{1}{2}(u_{R} - u_{L})(u_{R} + u_{L})}{u_{R} - u_{L}}$$\n假设 $u_{R} \\neq u_{L}$（这是激波存在的必要条件），我们可以消去项 $(u_{R} - u_{L})$：\n$$s = \\frac{u_{L} + u_{R}}{2}$$\n这就是激波速度的最终表达式。", "answer": "$$\n\\boxed{\\frac{u_{L} + u_{R}}{2}}\n$$", "id": "3384188"}, {"introduction": "一个理想的数值格式应该在离散层面尽可能地模仿连续方程的内在属性，例如对于光滑解的熵守恒。本练习将探讨如何为无粘Burgers方程设计一种特殊的“分裂形式”离散格式，它能精确地在离散意义下保持二次熵守恒。掌握这种构造方法是理解和开发更高级的熵稳定格式（例如在间断伽辽金法中）的关键一步。[@problem_id:3384153]", "problem": "考虑一维无粘伯格斯方程，其定义在坐标为 $x$ 的周期性域上，\n$$\n\\partial_{t} u + \\partial_{x}\\left(\\frac{u^{2}}{2}\\right) = 0,\n$$\n其中 $u = u(x,t)$ 是一个足够光滑的标量场。假设在 $N+1$ 个节点上给定一个节点谱搭配法或节点间断伽辽金 (DG) 离散，其对角质量矩阵为 $M = \\operatorname{diag}(w_{0},\\dots,w_{N})$（其中 $w_{j}$ 为正的求积权重），微分矩阵为 $D$，且满足分部求和 (SBP) 性质。定义 $Q := M D$ 并假设周期性边界条件，使得\n$$\nQ + Q^{T} = 0, \\quad D \\boldsymbol{1} = \\boldsymbol{0},\n$$\n其中 $\\boldsymbol{1}$ 是全一向量。用 $\\odot$ 表示逐点乘积，因此 $(u^{2})$ 应理解为按分量计算。\n\n要求您为非线性平流项构造一个分裂形式的离散格式，该格式混合了斜对称和守恒平均，然后证明二次熵的离散熵守恒。\n\n1. 从平流形式 $\\partial_{x}\\left(\\frac{u^{2}}{2}\\right) = u \\,\\partial_{x} u$ 和上面介绍的 SBP 算子 $(M,D,Q)$ 出发，为 $u \\, u_{x}$ 的离散近似提出一个双参数分裂形式的拟设，其形式为\n$$\n\\mathcal{C}(u) := \\alpha \\, D(u^{2}) + \\beta \\, \\operatorname{diag}(u) \\, D u,\n$$\n其中 $\\alpha$ 和 $\\beta$ 是待确定的实系数。施加以下两个条件：\n- 分裂形式与连续恒等式 $u \\, u_{x} = \\partial_{x}\\left(\\frac{u^{2}}{2}\\right)$ 一致，并且\n- 该离散在周期性边界条件下对于二次熵 $U(u) = \\frac{u^{2}}{2}$ 是熵守恒的。\n\n推导同时满足这两个条件的 $\\alpha$ 和 $\\beta$ 的值，并明确写出最终的分裂形式。\n\n2. 考虑半离散格式\n$$\nM \\, \\dot{u} \\;=\\; - M \\, \\mathcal{C}(u),\n$$\n其中 $\\mathcal{C}(u)$ 由您在第1项中得到的分裂形式给出。仅使用上述 SBP 性质和由 $U(u) = \\frac{u^{2}}{2}$ 及 $F(u) = \\frac{u^{3}}{3}$ 给出的熵对 $(U,F)$，证明离散熵的时间变化率\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t} \\left( \\sum_{j=0}^{N} w_{j} \\, U(u_{j}) \\right)\n$$\n等于一个仅取决于边界贡献的量。然后，使用周期性边界条件，计算此时间变化率的值。\n\n您的最终答案必须是在周期性边界条件下离散熵产生的数值，它是一个实数。无需四舍五入，也无需单位。", "solution": "本题旨在为一维无粘伯格斯方程 $\\partial_{t} u + \\partial_{x}\\left(\\frac{u^{2}}{2}\\right) = 0$ 构建并分析一个熵守恒的分裂形式离散。\n\n该问题分为两部分。首先，我们确定一个分裂形式离散的系数，以确保其一致性和熵守恒性。其次，我们证明关于熵演化的一般性质，并计算周期性边界这一特定情况下的变化率。\n\n**第1部分：分裂形式离散的构造**\n\n本题要求为分裂形式拟设\n$$\n\\mathcal{C}(u) := \\alpha \\, D(u^{2}) + \\beta \\, \\operatorname{diag}(u) \\, D u\n$$\n找到系数 $\\alpha, \\beta \\in \\mathbb{R}$，以满足两个条件：与连续方程的一致性，以及在周期性边界条件下二次熵的熵守恒性。向量 $\\boldsymbol{u}$ 代表在 $N+1$ 个网格节点上的解。矩阵 $D$ 是离散微分算子。\n\n**条件1：一致性**\n连续平流项可以写作 $\\partial_{x}\\left(\\frac{u^{2}}{2}\\right)$，通过链式法则，它等价于 $u \\, \\partial_{x} u$。半离散格式为 $\\dot{\\boldsymbol{u}} = -\\mathcal{C}(\\boldsymbol{u})$（因为质量矩阵 $M$ 是对角的，并出现在等式两边），所以 $\\mathcal{C}(\\boldsymbol{u})$ 必须是 $u \\, \\partial_{x}u$ 的一个一致离散。我们来分析拟设 $\\mathcal{C}(\\boldsymbol{u})$ 中的各项：\n- 项 $D(\\boldsymbol{u}^{2})$ 是 $\\partial_{x}(u^{2}) = 2 u \\, \\partial_{x}u$ 的一个离散近似。注意 $\\boldsymbol{u}^{2}$ 表示按分量平方，即 $\\boldsymbol{u} \\odot \\boldsymbol{u}$。\n- 项 $\\operatorname{diag}(\\boldsymbol{u}) D \\boldsymbol{u}$ 代表向量 $\\boldsymbol{u}$ 与向量 $D\\boldsymbol{u}$ 的乘积，是 $u \\, \\partial_{x}u$ 的一个离散近似。\n\n为了使 $\\mathcal{C}(\\boldsymbol{u})$ 成为 $u \\, \\partial_{x}u$ 的一致近似，它们所代表的连续项的加权和必须等于 $u \\, \\partial_{x}u$。这导致了关于系数的代数条件：\n$$\n\\alpha (2 u \\, \\partial_{x}u) + \\beta (u \\, \\partial_{x}u) = u \\, \\partial_{x}u\n$$\n为使此式对任何非平凡的 $u$ 都成立，我们必须有：\n$$\n2\\alpha + \\beta = 1\n$$\n\n**条件2：熵守恒**\n问题要求该格式在周期性边界条件下对二次熵 $U(u) = \\frac{u^{2}}{2}$ 是熵守恒的。总离散熵是所有节点上的加权和：\n$$\nS(t) := \\sum_{j=0}^{N} w_{j} \\, U(u_{j}) = \\sum_{j=0}^{N} w_{j} \\frac{u_{j}^{2}}{2}\n$$\n使用对角质量矩阵 $M = \\operatorname{diag}(w_{0},\\dots,w_{N})$，用向量表示法，这可以写作：\n$$\nS(t) = \\frac{1}{2} \\boldsymbol{u}^{T} M \\boldsymbol{u}\n$$\n离散熵的变化率通过对时间 $t$ 求导得到：\n$$\n\\frac{\\mathrm{d}S}{\\mathrm{d}t} = \\frac{1}{2} \\left( \\dot{\\boldsymbol{u}}^{T} M \\boldsymbol{u} + \\boldsymbol{u}^{T} M \\dot{\\boldsymbol{u}} \\right)\n$$\n由于 $M$ 是对称的（$M^{T}=M$），这两项相等，因此：\n$$\n\\frac{\\mathrm{d}S}{\\mathrm{d}t} = \\boldsymbol{u}^{T} M \\dot{\\boldsymbol{u}}\n$$\n半离散格式由 $M \\dot{\\boldsymbol{u}} = -M \\mathcal{C}(\\boldsymbol{u})$ 给出。将其代入熵率方程得到：\n$$\n\\frac{\\mathrm{d}S}{\\mathrm{d}t} = \\boldsymbol{u}^{T} (-M \\mathcal{C}(\\boldsymbol{u})) = -\\boldsymbol{u}^{T} M \\mathcal{C}(\\boldsymbol{u})\n$$\n熵守恒意味着这个变化率为零。因此，我们必须施加条件：\n$$\n\\boldsymbol{u}^{T} M \\mathcal{C}(\\boldsymbol{u}) = 0\n$$\n代入 $\\mathcal{C}(\\boldsymbol{u})$ 的拟设：\n$$\n\\boldsymbol{u}^{T} M \\left( \\alpha \\, D(\\boldsymbol{u}^{2}) + \\beta \\, \\operatorname{diag}(\\boldsymbol{u}) \\, D \\boldsymbol{u} \\right) = 0\n$$\n$$\n\\alpha \\, \\boldsymbol{u}^{T} M D(\\boldsymbol{u}^{2}) + \\beta \\, \\boldsymbol{u}^{T} M \\operatorname{diag}(\\boldsymbol{u}) D \\boldsymbol{u} = 0\n$$\n我们来分析这个表达式中的两项。令 $Q = MD$。\n第一项是 $\\alpha \\, \\boldsymbol{u}^{T} Q (\\boldsymbol{u} \\odot \\boldsymbol{u})$。\n第二项可以重写。向量 $\\operatorname{diag}(\\boldsymbol{u}) D \\boldsymbol{u}$ 的分量为 $(\\operatorname{diag}(\\boldsymbol{u}) D \\boldsymbol{u})_j = u_j \\sum_k D_{jk} u_k$。那么第二项是 $\\beta \\sum_{j,k} u_j w_j (u_j \\sum_k D_{jk} u_k) = \\beta \\sum_{j,k} u_j^2 (w_j D_{jk}) u_k$。用向量表示法，即为 $\\beta (\\boldsymbol{u} \\odot \\boldsymbol{u})^{T} Q \\boldsymbol{u}$。\n该条件变为：\n$$\n\\alpha \\, \\boldsymbol{u}^{T} Q (\\boldsymbol{u} \\odot \\boldsymbol{u}) + \\beta (\\boldsymbol{u} \\odot \\boldsymbol{u})^{T} Q \\boldsymbol{u} = 0\n$$\n问题指明了周期性边界条件，在此条件下 SBP 算子满足 $Q + Q^{T} = 0$，意味着 $Q$ 是斜对称的。对于任意向量 $\\boldsymbol{x}$ 和 $\\boldsymbol{y}$，斜对称性意味着 $\\boldsymbol{x}^{T} Q \\boldsymbol{y} = - \\boldsymbol{y}^{T} Q \\boldsymbol{x}$。将此应用于 $\\boldsymbol{x} = \\boldsymbol{u} \\odot \\boldsymbol{u}$ 和 $\\boldsymbol{y} = \\boldsymbol{u}$，我们得到：\n$$\n(\\boldsymbol{u} \\odot \\boldsymbol{u})^{T} Q \\boldsymbol{u} = - \\boldsymbol{u}^{T} Q (\\boldsymbol{u} \\odot \\boldsymbol{u})\n$$\n将此代回熵条件：\n$$\n\\alpha \\, \\boldsymbol{u}^{T} Q (\\boldsymbol{u} \\odot \\boldsymbol{u}) - \\beta \\, \\boldsymbol{u}^{T} Q (\\boldsymbol{u} \\odot \\boldsymbol{u}) = 0\n$$\n$$\n(\\alpha - \\beta) \\, \\boldsymbol{u}^{T} Q (\\boldsymbol{u} \\odot \\boldsymbol{u}) = 0\n$$\n为使该方程对任意状态向量 $\\boldsymbol{u}$（其中 $\\boldsymbol{u}^{T} Q (\\boldsymbol{u} \\odot \\boldsymbol{u})$ 不恒为零）都成立，我们必须有：\n$$\n\\alpha = \\beta\n$$\n\n**求解系数**\n我们现在有一个关于 $\\alpha$ 和 $\\beta$ 的二元线性方程组：\n1. $2\\alpha + \\beta = 1$\n2. $\\alpha = \\beta$\n\n将（2）代入（1）得到 $2\\alpha + \\alpha = 1$，化简为 $3\\alpha = 1$，所以 $\\alpha = \\frac{1}{3}$。\n由（2）可得 $\\beta = \\frac{1}{3}$。\n\n最终的分裂形式离散为：\n$$\n\\mathcal{C}(\\boldsymbol{u}) = \\frac{1}{3} D(\\boldsymbol{u}^{2}) + \\frac{1}{3} \\operatorname{diag}(\\boldsymbol{u}) \\, D \\boldsymbol{u}\n$$\n\n**第2部分：熵耗散结构的证明和最终值**\n\n题目要求我们分析半离散格式 $M \\dot{\\boldsymbol{u}} = -M \\mathcal{C}(\\boldsymbol{u})$ 的离散熵的时间变化率，其中 $\\mathcal{C}(\\boldsymbol{u})$ 是上面推导出的形式。\n\n变化率为 $\\frac{\\mathrm{d}S}{\\mathrm{d}t} = -\\boldsymbol{u}^{T} M \\mathcal{C}(\\boldsymbol{u})$。使用 $\\alpha=\\beta=\\frac{1}{3}$ 的分裂形式：\n$$\n\\frac{\\mathrm{d}S}{\\mathrm{d}t} = -\\frac{1}{3} \\left( \\boldsymbol{u}^{T} M D(\\boldsymbol{u}^{2}) + \\boldsymbol{u}^{T} M \\operatorname{diag}(\\boldsymbol{u}) D \\boldsymbol{u} \\right)\n$$\n如前所示，这等价于：\n$$\n\\frac{\\mathrm{d}S}{\\mathrm{d}t} = -\\frac{1}{3} \\left( \\boldsymbol{u}^{T} Q (\\boldsymbol{u} \\odot \\boldsymbol{u}) + (\\boldsymbol{u} \\odot \\boldsymbol{u})^{T} Q \\boldsymbol{u} \\right)\n$$\n为了证明这个量仅取决于边界贡献，我们考虑一般的 SBP 性质 $Q+Q^T=B$，其中 $B$ 是一个边界算子矩阵，它仅在对应于域边界的索引上非零。使用 $\\boldsymbol{y}^T Q \\boldsymbol{x} = \\boldsymbol{x}^T Q^T \\boldsymbol{y}$：\n$$\n(\\boldsymbol{u} \\odot \\boldsymbol{u})^{T} Q \\boldsymbol{u} = \\boldsymbol{u}^{T} Q^{T} (\\boldsymbol{u} \\odot \\boldsymbol{u})\n$$\n将此代入熵率表达式得到：\n$$\n\\frac{\\mathrm{d}S}{\\mathrm{d}t} = -\\frac{1}{3} \\left( \\boldsymbol{u}^{T} Q (\\boldsymbol{u} \\odot \\boldsymbol{u}) + \\boldsymbol{u}^{T} Q^{T} (\\boldsymbol{u} \\odot \\boldsymbol{u}) \\right)\n= -\\frac{1}{3} \\boldsymbol{u}^{T} (Q + Q^{T}) (\\boldsymbol{u} \\odot \\boldsymbol{u})\n$$\n使用一般 SBP 性质 $Q+Q^{T}=B$：\n$$\n\\frac{\\mathrm{d}S}{\\mathrm{d}t} = -\\frac{1}{3} \\boldsymbol{u}^{T} B (\\boldsymbol{u} \\odot \\boldsymbol{u})\n$$\n对于节点 $j=0, \\dots, N$ 上的一维标准 SBP 算子，边界矩阵为 $B = \\operatorname{diag}(-1, 0, \\dots, 0, 1)$。那么项 $\\boldsymbol{u}^{T} B (\\boldsymbol{u} \\odot \\boldsymbol{u})$ 为：\n$$\n\\boldsymbol{u}^{T} B (\\boldsymbol{u} \\odot \\boldsymbol{u}) = \\sum_{j,k} u_j B_{jk} u_k^2 = -u_0(u_0^2) + u_N(u_N^2) = u_N^3 - u_0^3\n$$\n此表达式仅取决于边界（节点0和N）上 $\\boldsymbol{u}$ 的值，证明完毕。变化率为 $-\\frac{1}{3}(u_N^3 - u_0^3) = -(F(u_N)-F(u_0))$，其中 $F(u)=\\frac{u^3}{3}$ 是熵通量。\n\n最后，我们计算在指定的周期性边界条件下的这个变化率的值。问题指出，对于周期性边界，SBP 性质为 $Q + Q^{T} = 0$。这意味着边界算子 $B$ 是零矩阵，$B = \\boldsymbol{0}$。\n将 $B=\\boldsymbol{0}$ 代入我们已证明的熵变化率结果中：\n$$\n\\frac{\\mathrm{d}S}{\\mathrm{d}t} = -\\frac{1}{3} \\boldsymbol{u}^{T} \\boldsymbol{0} (\\boldsymbol{u} \\odot \\boldsymbol{u}) = 0\n$$\n因此，对于周期性边界条件，离散熵是精确守恒的，其变化率为零。\n\n最终答案就是这个变化率的值。", "answer": "$$\n\\boxed{0}\n$$", "id": "3384153"}, {"introduction": "理论上熵守恒的格式在处理光滑流动时表现优异，但在捕捉激波时仍需引入数值耗散。然而，过多的耗散会降低解的精度，尤其是在光滑区域。这个实践练习要求你实现一个带有熵修正（entropy fix）的间断伽辽金格式，通过对比常数修正参数和自适应修正参数的效果，你将亲身体验到在保证数值稳定性和维持解的高精度之间进行权衡的艺术。[@problem_id:3384135]", "problem": "考虑一个周期性一维域上的标量双曲守恒律，\n$$\n\\partial_t u(x,t) + \\partial_x f(u(x,t)) = 0, \\quad x \\in [0,2\\pi], \\; t \\ge 0,\n$$\n其伯格斯 (Burgers) 通量为 $f(u) = \\tfrac{1}{2} u^2$。我们关注的方法是多项式阶数 $p=1$（每个单元有两个节点自由度）的间断伽辽金 (Discontinuous Galerkin, DG) 方法，该方法使用精确的局部质量矩阵和两点高斯-勒让德 (Gauss-Legendre) 求积来计算体积项。数值通量为 Roe 类型，其中 Roe 速度为 $\\hat{a} = \\tfrac{1}{2}(u_L + u_R)$，耗散使用光滑熵修正。具体而言，绝对值 $\\lvert \\hat{a} \\rvert$ 被一个分段函数 $\\psi(\\lvert \\hat{a} \\rvert;\\delta)$ 替代，其定义为\n$$\n\\psi(\\lvert \\hat{a} \\rvert;\\delta) = \\begin{cases}\n\\lvert \\hat{a} \\rvert,  \\text{if } \\lvert \\hat{a} \\rvert \\ge \\delta,\\\\[4pt]\n\\tfrac{1}{2}\\left( \\tfrac{\\hat{a}^2}{\\delta} + \\delta \\right),  \\text{if } \\lvert \\hat{a} \\rvert  \\delta,\n\\end{cases}\n$$\n其中 $\\delta \\ge 0$ 是一个熵修正参数。对于标量伯格斯方程，特征速度为 $\\lambda(u) = u$。需要考虑两种选择 $\\delta$ 的策略：\n- 在所有界面上选择一个常数 $\\delta = \\delta_{\\mathrm{const}}$。\n- 基于每个界面两侧局部波速的自适应选择，定义为 $\\delta = \\kappa \\max\\{0, \\lambda(u_R) - \\lambda(u_L)\\}$，其中比例参数 $\\kappa \\ge 0$。\n\n时间积分器必须是三阶强保稳定龙格-库塔 (Strong Stability Preserving Runge-Kutta, SSPRK(3)) 格式。半离散 DG 格式将采用一个由库朗-弗里德里希斯-列维 (Courant-Friedrichs-Lewy, CFL) 数条件自适应选择的时间步长 $\\Delta t$ 向前推进\n$$\n\\Delta t = \\min\\left\\{ \\frac{\\mathrm{CFL}\\, h}{(2p+1) \\, s_{\\max}}, \\; \\Delta t_{\\max} \\right\\},\n$$\n其中 $h$ 是均匀的单元尺寸，$s_{\\max}$ 是当前解状态下所有界面上修正后速度 $\\psi(\\lvert \\hat{a} \\rvert;\\delta)$ 的最大值，$\\mathrm{CFL}$ 是一个给定的常数且满足 $0  \\mathrm{CFL}  1$，$\\Delta t_{\\max}$ 是时间步长的给定上限。在 $[0,2\\pi]$ 上使用周期性边界条件，网格由 $N_e$ 个均匀单元构成。\n\n初始条件是一个小振幅的单傅里叶模态\n$$\nu(x,0) = \\varepsilon \\sin(k x),\n$$\n其中 $\\varepsilon > 0$ 很小（因此非线性较弱，在早期线性化波的行为占主导地位），$k$ 是一个正整数。设最终时间为 $T>0$。\n\n您的任务是：\n1. 从双曲守恒律和带数值通量的离散 DG 弱形式的定义出发，解释为什么对于非线性通量函数，在声速点附近 Roe 型通量需要进行熵修正，并说明光滑分段函数 $\\psi(\\lvert \\hat{a} \\rvert;\\delta)$ 如何影响 $\\hat{a} \\approx 0$ 附近小振幅波的耗散。\n2. 实现 $p=1$ 的节点 DG 方法，其中包含 Roe 通量和上述光滑熵修正。包括常数 $\\delta$ 策略和由 $\\delta = \\kappa \\max\\{0, \\lambda(u_R)-\\lambda(u_L)\\}$（其中 $\\lambda(u)=u$）给出的基于自适应波速的 $\\delta$ 策略。\n3. 对于给定的 $(\\varepsilon,k)$ 和指定的 $\\delta$ 策略，将解演化至时间 $T$ 并测量：\n   - 基频模态中的耗散，由振幅比量化\n     $$\n     \\mathcal{A}_{\\mathrm{ratio}} = \\frac{\\sqrt{a_{\\sin}(T)^2 + a_{\\cos}(T)^2}}{\\sqrt{a_{\\sin}(0)^2 + a_{\\cos}(0)^2}},\n     $$\n     其中\n     $$\n     a_{\\sin}(t) = \\frac{1}{\\pi} \\int_0^{2\\pi} u(x,t) \\sin(kx)\\, dx, \\quad\n     a_{\\cos}(t) = \\frac{1}{\\pi} \\int_0^{2\\pi} u(x,t) \\cos(kx)\\, dx,\n     $$\n     通过均匀的黎曼和进行数值近似。\n   - 时间 $T$ 时的相位误差，定义为\n     $\n     \\phi(T) = \\operatorname{atan2}\\big(-a_{\\cos}(T),\\, a_{\\sin}(T)\\big).\n     $\n     以弧度报告 $\\phi(T)$。\n   在 $t=0$ 和 $t=T$ 时使用相同的数值求积方法以最小化系统偏差，从而使分母中的初始振幅为数值测量的结果：$\\sqrt{a_{\\sin}(0)^2 + a_{\\cos}(0)^2}$。\n4. 在小振幅情况下，分析改变 $\\delta$ 如何影响 $\\mathcal{A}_{\\mathrm{ratio}}$ 和 $\\phi(T)$，并实现自适应策略与常数选择进行比较。\n\n所有运行中使用的数值参数：\n- 周期 $L = 2\\pi$，因此定义域为 $[0,2\\pi]$。\n- 多项式阶数 $p=1$。\n- 单元数量 $N_e = 80$。\n- 最终时间 $T = 1.0$。\n- 库朗-弗里德里希斯-列维数 $\\mathrm{CFL} = 0.3$。\n- 最大时间步长 $\\Delta t_{\\max} = 0.1$。\n- 为保证时间步长的安全性，在 $\\Delta t$ 的计算公式中使用 $s_{\\max} \\ge s_{\\mathrm{floor}}$，其中 $s_{\\mathrm{floor}} = 10^{-2}$。\n\n测试套件：\n- 案例 1：$k=1$，$\\varepsilon = 0.001$，常数 $\\delta$ 且 $\\delta_{\\mathrm{const}} = 0$。\n- 案例 2：$k=1$，$\\varepsilon = 0.001$，常数 $\\delta$ 且 $\\delta_{\\mathrm{const}} = 0.1$。\n- 案例 3：$k=3$，$\\varepsilon = 0.001$，自适应 $\\delta$ 且 $\\kappa = 1.0$。\n\n对于每个案例，计算并返回两个浮点值 $(\\mathcal{A}_{\\mathrm{ratio}}, \\phi(T))$。\n\n最终输出规范：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序为\n$$\n\\big[ \\mathcal{A}_{\\mathrm{ratio}}^{(1)},\\, \\phi^{(1)},\\, \\mathcal{A}_{\\mathrm{ratio}}^{(2)},\\, \\phi^{(2)},\\, \\mathcal{A}_{\\mathrm{ratio}}^{(3)},\\, \\phi^{(3)} \\big],\n$$\n其中上标表示测试案例编号。所有角度必须以弧度为单位。所有数字必须以标准十进制浮点格式打印。", "solution": "所提出的问题是偏微分方程数值分析领域中一个适定且科学上合理的问题。它涉及标量、非线性双曲伯格斯方程的间断伽辽金 (DG) 方法的实现与分析。所有参数和方法都已明确指定，是该学科的标准方法，并且不存在矛盾或含糊之处。因此，我们可以进行完整的求解。\n\n该问题围绕一维标量双曲守恒律在周期性定义域上展开，其通量函数为非线性的伯格斯通量。这类非线性方程的一个关键特征是，光滑的初始数据可能会演化成不连续的解，即激波。这使得引入弱解的概念成为必要，弱解满足偏微分方程的积分形式。然而，弱解不唯一。需要一个额外的约束，即熵条件，来选择物理上相关的解。对于像伯格斯方程这样的凸通量，熵条件确保了特征线从两侧进入激波间断，并禁止了像膨胀激波这样的非物理现象。\n\n间断伽辽金 (DG) 方法是一种有限元技术，它在每个单元内用多项式来近似解。与连续有限元方法不同，解在单元边界上可以是间断的。本问题中指定的数值通量是 Roe 型。Roe 通量的一个严重缺陷出现在“声速点”，即特征速度穿过零点的位置。在这些点，与Roe平均速度的绝对值 $|\\hat{a}|$ 成正比的耗散项可能会消失。这使得 Roe 通量退化为简单的中心通量，而中心通量是出了名的不稳定，并且会允许违反熵条件的膨胀激波出现。\n\n“熵修正”通过确保数值耗散在声速点不为零来弥补这一缺陷。问题指定了一个光滑的分段函数 $\\psi(\\lvert \\hat{a} \\rvert;\\delta)$ 来替代 $\\lvert \\hat{a} \\rvert$。该函数保证了最低水平的耗散。当 $|\\hat{a}| \\to 0$ 时，$\\psi \\to \\frac{1}{2}\\delta$。这可以防止耗散消失，并以数值方式强制执行熵条件。对于 $|u|$ 很小的小振幅波，Roe 速度 $\\hat{a}$ 也很小，因此其行为对 $\\delta$ 的选择很敏感。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to orchestrate the solution of the DG-FEM problem for Burgers' equation.\n    It sets up the simulation parameters, iterates through the test cases,\n    runs the simulation for each case, and prints the final results in the specified format.\n    \"\"\"\n    # Global numerical parameters\n    L = 2.0 * np.pi\n    Ne = 80\n    p = 1\n    T_final = 1.0\n    CFL = 0.3\n    dt_max = 0.1\n    s_floor = 1.0e-2\n    h = L / Ne\n\n    # Test suite definition\n    test_cases = [\n        {'k': 1, 'eps': 0.001, 'delta_strategy': 'const', 'delta_param': 0.0},\n        {'k': 1, 'eps': 0.001, 'delta_strategy': 'const', 'delta_param': 0.1},\n        {'k': 3, 'eps': 0.001, 'delta_strategy': 'adaptive', 'delta_param': 1.0},\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        # Run simulation to get the final state U_T\n        U_T = run_simulation(case, Ne, h, p, T_final, CFL, dt_max, s_floor, L)\n        \n        # Post-processing: calculate amplitude ratio and phase error\n        k = case['k']\n        eps = case['eps']\n        \n        # Generate initial state U0 for analysis\n        x_nodes = np.linspace(0, L, Ne + 1)\n        U0 = np.zeros((Ne, 2))\n        for j in range(Ne):\n            U0[j, 0] = eps * np.sin(k * x_nodes[j])\n            U0[j, 1] = eps * np.sin(k * x_nodes[j+1])\n            \n        # Calculate Fourier coefficients for initial and final states\n        a_sin_0, a_cos_0 = calculate_fourier_coeffs(U0, k, Ne, h, L)\n        initial_amplitude = np.sqrt(a_sin_0**2 + a_cos_0**2)\n        \n        a_sin_T, a_cos_T = calculate_fourier_coeffs(U_T, k, Ne, h, L)\n        final_amplitude = np.sqrt(a_sin_T**2 + a_cos_T**2)\n\n        # Compute metrics\n        A_ratio = final_amplitude / initial_amplitude if initial_amplitude  1e-12 else 0.0\n        phi_T = np.arctan2(-a_cos_T, a_sin_T)\n        \n        all_results.extend([A_ratio, phi_T])\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, all_results))}]\")\n\ndef flux_burgers(u):\n    \"\"\"Computes the Burgers flux F(u) = 0.5 * u^2.\"\"\"\n    return 0.5 * u**2\n\ndef calculate_rhs(U, Ne, h, case):\n    \"\"\"\n    Computes the right-hand side (RHS) of the semi-discrete DG system, dU/dt = L(U).\n    \n    Args:\n        U (np.ndarray): The current solution state vector (Ne x 2).\n        Ne (int): Number of elements.\n        h (float): Element size.\n        case (dict): Dictionary defining the current test case parameters.\n        \n    Returns:\n        tuple: A tuple containing:\n            - L_U (np.ndarray): The RHS vector (Ne x 2).\n            - speeds (np.ndarray): The patched wave speeds at each interface.\n    \"\"\"\n    fluxes = np.zeros(Ne)\n    speeds = np.zeros(Ne)\n    \n    # 1. Compute numerical fluxes at all interfaces\n    for j in range(Ne):\n        u_L = U[j-1, 1]  # Value at x_j^- from element j-1\n        u_R = U[j, 0]    # Value at x_j^+ from element j\n        \n        a_hat = 0.5 * (u_L + u_R)\n        \n        # Determine delta for entropy fix\n        delta = 0.0\n        if case['delta_strategy'] == 'const':\n            delta = case['delta_param']\n        elif case['delta_strategy'] == 'adaptive':\n            kappa = case['delta_param']\n            lambda_uR = u_R # Characteristic speed for Burgers' is u\n            lambda_uL = u_L\n            delta = kappa * max(0.0, lambda_uR - lambda_uL)\n\n        # Harten's entropy fix (patched function psi)\n        abs_a_hat = np.abs(a_hat)\n        psi_val = 0.0\n        if abs_a_hat = delta:\n            psi_val = abs_a_hat\n        else:\n            if delta  1e-12: # Avoid division by zero\n                psi_val = 0.5 * (a_hat**2 / delta + delta)\n            else: # delta is zero, so no entropy fix\n                psi_val = abs_a_hat\n\n        speeds[j] = psi_val\n        fluxes[j] = 0.5*(flux_burgers(u_L) + flux_burgers(u_R)) - 0.5*psi_val*(u_R - u_L)\n\n    L_U = np.zeros_like(U)\n    \n    # 2. Compute RHS for each element\n    # Pre-compute matrices and constants for p=1\n    xi_q = np.array([-1.0/np.sqrt(3.0), 1.0/np.sqrt(3.0)])\n    L1_at_q = (1.0 - xi_q) / 2.0\n    L2_at_q = (1.0 + xi_q) / 2.0\n    M_inv_local = (2.0/h) * np.array([[2.0, -1.0], [-1.0, 2.0]])\n\n    for j in range(Ne):\n        # DoFs for element j\n        u_j0, u_j1 = U[j, 0], U[j, 1]\n        \n        # Evaluate u_h at quadrature points\n        u_at_q = u_j0 * L1_at_q + u_j1 * L2_at_q\n        \n        # Approximate volume integral using 2-point Gauss-Legendre quadrature\n        f_at_q = flux_burgers(u_at_q)\n        F_int = 0.5 * np.sum(f_at_q)\n        \n        # Surface fluxes for element j\n        f_j = fluxes[j]\n        f_jp1 = fluxes[(j + 1) % Ne] # Periodicity\n        \n        # Assemble local RHS without mass matrix\n        RHS_local = np.array([-F_int + f_j, F_int - f_jp1])\n        \n        # Multiply by inverse mass matrix to get dU_j/dt\n        L_U[j, :] = M_inv_local @ RHS_local\n        \n    return L_U, speeds\n\ndef run_simulation(case, Ne, h, p, T_final, CFL, dt_max, s_floor, L):\n    \"\"\"\n    Evolves the solution from t=0 to t=T_final using SSPRK(3) time integration.\n    \"\"\"\n    k = case['k']\n    eps = case['eps']\n    \n    # Initial Condition\n    x_nodes = np.linspace(0, L, Ne + 1)\n    U = np.zeros((Ne, 2))\n    for j in range(Ne):\n        U[j, 0] = eps * np.sin(k * x_nodes[j])\n        U[j, 1] = eps * np.sin(k * x_nodes[j+1])\n        \n    t = 0.0\n    while t  T_final:\n        L_U, speeds = calculate_rhs(U, Ne, h, case)\n        \n        s_max = np.max(speeds)\n        s_max = max(s_max, s_floor)\n        \n        dt = CFL * h / ((2*p + 1) * s_max)\n        dt = min(dt, dt_max)\n        if t + dt  T_final:\n            dt = T_final - t\n        \n        # SSPRK(3)\n        U1 = U + dt * L_U\n        L1, _ = calculate_rhs(U1, Ne, h, case)\n        \n        U2 = 0.75 * U + 0.25 * (U1 + dt * L1)\n        L2, _ = calculate_rhs(U2, Ne, h, case)\n        \n        U = (1.0/3.0) * U + (2.0/3.0) * (U2 + dt * L2)\n        \n        t += dt\n        \n    return U\n\ndef calculate_fourier_coeffs(U, k, Ne, h, L, N_pts_per_elem=10):\n    \"\"\"\n    Calculates the sine and cosine Fourier coefficients of the DG solution.\n    The integral is approximated by a uniform Riemann sum over a fine grid.\n    \"\"\"\n    N_pts = Ne * N_pts_per_elem\n    x_eval = np.linspace(0, L, N_pts, endpoint=False)\n    u_eval = np.zeros(N_pts)\n    \n    for i, x in enumerate(x_eval):\n        j = int(np.floor(x / h))\n        j = min(j, Ne - 1)  # Ensure j is a valid index\n        \n        x_j = j * h\n        x_jp1 = (j + 1) * h\n        \n        U_j0, U_j1 = U[j, 0], U[j, 1]\n        \n        # Linear interpolation within the element\n        u_eval[i] = U_j0 * (x_jp1 - x) / h + U_j1 * (x - x_j) / h\n        \n    dx = L / N_pts\n    a_sin = (1.0/np.pi) * np.sum(u_eval * np.sin(k * x_eval)) * dx\n    a_cos = (1.0/np.pi) * np.sum(u_eval * np.cos(k * x_eval)) * dx\n    \n    return a_sin, a_cos\n\nsolve()\n```", "id": "3384135"}]}