{"hands_on_practices": [{"introduction": "要真正掌握质量集中技术，第一步是理解其对角线项是如何从基本原理中推导出来的。本练习将引导你完成寻找高斯-洛巴托-勒让德（GLL）节点和相应求积权重，并利用它们为特定多项式阶数构建集中质量矩阵的全过程。通过这个具体的计算，你将能够把抽象的理论概念落到实处 [@problem_id:3398294]。", "problem": "考虑在区间 $[-1,1]$ 上的参考一维谱元，其拉格朗日插值基函数建立在与多项式阶数 $N=4$ 相关的 Gauss–Lobatto–Legendre (GLL) 节点上。设 $\\{\\phi_i(x)\\}_{i=0}^{N}$ 表示与 $N+1$ 个 GLL 节点 $\\{\\xi_i\\}_{i=0}^{N}$ 相关的节点拉格朗日基函数，其中端点 $x=-1$ 和 $x=1$ 被包含在内，内部节点是 $N$ 阶勒让德多项式导数的根。参考单元上的一致谱元质量矩阵定义为\n$$\nM_{ij} \\;=\\; \\int_{-1}^{1} \\phi_i(x)\\,\\phi_j(x)\\,\\mathrm{d}x.\n$$\n在集中质量谱元和间断 Galerkin (DG) 方法中，通过在相同的 GLL 节点上应用 GLL 求积，可以得到 $M_{ij}$ 的一个常用对角近似，其对角元取决于求积权重。\n\n从勒让德多项式的定义性质和 GLL 构造（包含端点，内部节点由 $N$ 阶勒让德多项式导数的根给出）出发，并仅使用这些基本关系和对多项式的精确积分要求，在参考单元 $[-1,1]$ 上对 $N=4$ 完成以下任务：\n- 确定 $N+1$ 个 GLL 节点 $\\{\\xi_i\\}_{i=0}^{N}$，\n- 计算相应的 GLL 求积权重 $\\{w_i\\}_{i=0}^{N}$，以及\n- 组装集中质量矩阵的对角元，该对角元通过在参考单元上对 $M_{ii}$ 应用 GLL 求积来定义。\n\n将您的最终答案表示为单个有序行向量，列出从最左侧节点 ($x=-1$) 到最右侧节点 ($x=1$) 的五个对角集中质量元。请提供精确的有理数值；无需四舍五入。最终答案必须以单个解析表达式的形式给出。", "solution": "该问题要求确定在参考区间 $[-1, 1]$ 上，使用阶数为 $N=4$ 的多项式基的一维谱元的集中质量矩阵的对角元。此任务涉及三个主要步骤：首先，找到 Gauss-Lobatto-Legendre (GLL) 节点；其次，计算相应的 GLL 求积权重；第三，组装集中质量矩阵的对角元，正如将要展示的，这些对角元与求积权重相同。\n\n对于一个 $N$ 阶多项式，GLL 节点 $\\{\\xi_i\\}_{i=0}^N$ 定义在区间 $[-1, 1]$ 上。该节点集包括端点 $\\xi_0 = -1$ 和 $\\xi_N = 1$。$N-1$ 个内部节点是 $N$ 阶勒让德多项式一阶导数（记为 $P'_N(x)$）的根。对于本问题，$N=4$。\n\n首先，我们必须确定勒让德多项式 $P_4(x)$。勒让德多项式 $P_n(x)$ 可以使用 Bonnet 递推关系生成：\n$$ (n+1)P_{n+1}(x) = (2n+1)xP_n(x) - nP_{n-1}(x) $$\n初始多项式为 $P_0(x) = 1$ 和 $P_1(x) = x$。\n当 n=1 时：\n$2P_2(x) = 3xP_1(x) - 1P_0(x) = 3x(x) - 1 = 3x^2 - 1 \\implies P_2(x) = \\frac{1}{2}(3x^2 - 1)$。\n当 n=2 时：\n$3P_3(x) = 5xP_2(x) - 2P_1(x) = 5x\\left(\\frac{1}{2}(3x^2 - 1)\\right) - 2x = \\frac{15}{2}x^3 - \\frac{5}{2}x - 2x = \\frac{1}{2}(15x^3 - 9x) \\implies P_3(x) = \\frac{1}{2}(5x^3 - 3x)$。\n当 n=3 时：\n$4P_4(x) = 7xP_3(x) - 3P_2(x) = 7x\\left(\\frac{1}{2}(5x^3 - 3x)\\right) - 3\\left(\\frac{1}{2}(3x^2 - 1)\\right) = \\frac{1}{2}(35x^4 - 21x^2 - 9x^2 + 3) = \\frac{1}{2}(35x^4 - 30x^2 + 3)$。\n因此，4 阶勒让德多项式为：\n$$ P_4(x) = \\frac{1}{8}(35x^4 - 30x^2 + 3) $$\n接下来，我们求其导数 $P'_4(x)$：\n$$ P'_4(x) = \\frac{d}{dx}\\left[\\frac{1}{8}(35x^4 - 30x^2 + 3)\\right] = \\frac{1}{8}(140x^3 - 60x) = \\frac{20}{8}x(7x^2 - 3) = \\frac{5}{2}x(7x^2 - 3) $$\n内部 GLL 节点是 $P'_4(x) = 0$ 的根。将导数设为零可得 $x=0$ 和 $7x^2 - 3 = 0$，解得 $x^2 = \\frac{3}{7}$，即 $x = \\pm\\sqrt{\\frac{3}{7}}$。\n$N+1=5$ 个 GLL 节点的集合，从小到大排序为：\n$$ \\xi_0 = -1, \\quad \\xi_1 = -\\sqrt{\\frac{3}{7}}, \\quad \\xi_2 = 0, \\quad \\xi_3 = \\sqrt{\\frac{3}{7}}, \\quad \\xi_4 = 1 $$\n\n第二步是计算 GLL 求积权重 $\\{w_i\\}_{i=0}^N$。权重的公式为：\n$$ w_i = \\frac{2}{N(N+1)[P_N(\\xi_i)]^2} $$\n对于 $N=4$，此式变为 $w_i = \\frac{2}{4(5)[P_4(\\xi_i)]^2} = \\frac{1}{10[P_4(\\xi_i)]^2}$。\n我们在每个 GLL 节点上计算 $P_4(x)$ 的值：\n对于端点 $\\xi_0 = -1$ 和 $\\xi_4 = 1$：\n$P_4(1) = \\frac{1}{8}(35(1)^4 - 30(1)^2 + 3) = \\frac{1}{8}(35 - 30 + 3) = \\frac{8}{8} = 1$。\n$P_4(-1) = \\frac{1}{8}(35(-1)^4 - 30(-1)^2 + 3) = \\frac{1}{8}(35 - 30 + 3) = \\frac{8}{8} = 1$。\n端点的权重为：\n$w_0 = w_4 = \\frac{1}{10[1]^2} = \\frac{1}{10}$。\n对于内部节点 $\\xi_2 = 0$：\n$P_4(0) = \\frac{1}{8}(3) = \\frac{3}{8}$。\n中心节点的权重为：\n$w_2 = \\frac{1}{10[3/8]^2} = \\frac{1}{10(9/64)} = \\frac{64}{90} = \\frac{32}{45}$。\n对于内部节点 $\\xi_1 = -\\sqrt{3/7}$ 和 $\\xi_3 = \\sqrt{3/7}$，我们使用 $\\xi_{1,3}^2 = 3/7$：\n$P_4(\\pm\\sqrt{3/7}) = \\frac{1}{8}\\left(35\\left(\\frac{3}{7}\\right)^2 - 30\\left(\\frac{3}{7}\\right) + 3\\right) = \\frac{1}{8}\\left(35\\frac{9}{49} - \\frac{90}{7} + 3\\right) = \\frac{1}{8}\\left(\\frac{5 \\cdot 9}{7} - \\frac{90}{7} + \\frac{21}{7}\\right) = \\frac{1}{8}\\left(\\frac{45 - 90 + 21}{7}\\right) = \\frac{1}{8}\\left(\\frac{-24}{7}\\right) = -\\frac{3}{7}$。\n这些节点的权重为：\n$w_1 = w_3 = \\frac{1}{10[-3/7]^2} = \\frac{1}{10(9/49)} = \\frac{49}{90}$。\nGLL 求积权重为：\n$w_0 = \\frac{1}{10}$, $w_1 = \\frac{49}{90}$, $w_2 = \\frac{32}{45}$, $w_3 = \\frac{49}{90}$, $w_4 = \\frac{1}{10}$。\n作为验证，权重之和必须等于 $\\int_{-1}^1 1 \\, dx = 2$：\n$\\sum_{i=0}^4 w_i = \\frac{1}{10} + \\frac{49}{90} + \\frac{32}{45} + \\frac{49}{90} + \\frac{1}{10} = \\frac{9}{90} + \\frac{49}{90} + \\frac{64}{90} + \\frac{49}{90} + \\frac{9}{90} = \\frac{9+49+64+49+9}{90} = \\frac{180}{90} = 2$。权重是正确的。\n\n第三步也是最后一步是确定集中质量矩阵的对角元。一致质量矩阵为 $M_{ij} = \\int_{-1}^1 \\phi_i(x)\\phi_j(x) dx$，其中 $\\phi_i(x)$ 是定义在 GLL 节点 $\\{\\xi_k\\}$ 上的拉格朗日基函数，满足 $\\phi_i(\\xi_k) = \\delta_{ik}$。题目中说明，集中质量矩阵是通过将 GLL 求积法则应用于质量矩阵元的积分来获得的。一个积分的 GLL 求积近似为 $\\int_{-1}^1 f(x) dx \\approx \\sum_{k=0}^N w_k f(\\xi_k)$。\n将此应用于质量矩阵的对角元 $M_{ii}$：\n$$ M_{ii}^{\\text{lumped}} = \\sum_{k=0}^{N} w_k \\phi_i(\\xi_k)\\phi_i(\\xi_k) = \\sum_{k=0}^{N} w_k (\\phi_i(\\xi_k))^2 $$\n使用拉格朗日基函数的性质 $\\phi_i(\\xi_k) = \\delta_{ik}$（克罗内克 δ）：\n$$ M_{ii}^{\\text{lumped}} = \\sum_{k=0}^{N} w_k (\\delta_{ik})^2 $$\n由于 $\\delta_{ik}$ 等于 0 或 1，因此 $(\\delta_{ik})^2 = \\delta_{ik}$。该求和仅在 $k=i$ 的项上非零：\n$$ M_{ii}^{\\text{lumped}} = w_i (\\delta_{ii})^2 = w_i(1) = w_i $$\n这表明集中质量矩阵的对角元就是 GLL 求积权重。因此，与节点 $\\xi_0=-1$ 到 $\\xi_4=1$ 对应的五个对角集中质量元的有序列表，就是权重 $\\{w_i\\}_{i=0}^4$ 的有序列表。\n\n最终答案是这些权重的行向量。\n该向量为 $(\\frac{1}{10}, \\frac{49}{90}, \\frac{32}{45}, \\frac{49}{90}, \\frac{1}{10})$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{1}{10}  \\frac{49}{90}  \\frac{32}{45}  \\frac{49}{90}  \\frac{1}{10}\n\\end{pmatrix}\n}\n$$", "id": "3398294"}, {"introduction": "质量集中是一种近似，它在简化计算的同时也引入了误差，其中最重要的后果之一便是数值色散。本练习将通过分析一维波动方程，让你深入探究这一现象。你将推导出使用一致质量矩阵和集中质量矩阵的系统在相速度上的差异，从而量化计算效率与物理保真度之间的权衡 [@problem_id:3398334]。", "problem": "考虑一维标量波动方程在参考域 $[-1,1]$ 上的守恒形式，并带有周期性边界条件，\n$$\nu_{tt}(x,t) \\;=\\; c^{2}\\,u_{xx}(x,t),\n$$\n其中 $c>0$ 是一个恒定的传播速度。在单单元谱元法（SEM）中，使用与 Legendre–Gauss–Lobatto (LGL) 节点 $x_{1}=-1$、$x_{2}=0$ 和 $x_{3}=1$ 相关联的 Lagrange 节点基，将 $u(x,t)$ 近似为一个 2 次多项式。令 $\\{\\ell_{i}(x)\\}_{i=1}^{3}$ 表示相应的 Lagrange 基多项式，满足 $\\ell_{i}(x_{j})=\\delta_{ij}$。通过精确双线性形式定义一致质量矩阵 $M\\in\\mathbb{R}^{3\\times3}$ 和刚度矩阵 $K\\in\\mathbb{R}^{3\\times3}$\n$$\nM_{ij} \\;=\\; \\int_{-1}^{1} \\ell_{i}(x)\\,\\ell_{j}(x)\\,dx,\n\\qquad\nK_{ij} \\;=\\; \\int_{-1}^{1} \\ell'_{i}(x)\\,\\ell'_{j}(x)\\,dx.\n$$\n将集中质量矩阵 $\\tilde{M}\\in\\mathbb{R}^{3\\times3}$ 定义为 $[-1,1]$ 上 LGL 求积权重的对角矩阵，即 $\\tilde{M} = \\mathrm{diag}(w_{1},w_{2},w_{3})$，其中 $w_{1}=\\frac{1}{3}$、$w_{2}=\\frac{4}{3}$ 和 $w_{3}=\\frac{1}{3}$。半离散动力学由以下方程控制\n$$\nM\\,\\ddot{\\mathbf{u}}(t) + c^{2} K\\,\\mathbf{u}(t) = \\mathbf{0}\n\\quad\\text{or}\\quad\n\\tilde{M}\\,\\ddot{\\mathbf{u}}(t) + c^{2} K\\,\\mathbf{u}(t) = \\mathbf{0},\n$$\n具体取决于使用 $M$ 还是 $\\tilde{M}$。对于给定的波数 $k\\in\\mathbb{R}$，考虑在 LGL 节点上对平面波进行采样的复值节点向量，\n$$\n\\mathbf{v}_{k} = \\begin{pmatrix} \\exp(\\mathrm{i}k x_{1}) \\\\ \\exp(\\mathrm{i}k x_{2}) \\\\ \\exp(\\mathrm{i}k x_{3}) \\end{pmatrix}\n= \\begin{pmatrix} \\exp(-\\mathrm{i}k) \\\\ 1 \\\\ \\exp(\\mathrm{i}k) \\end{pmatrix}.\n$$\n在一致和集中情况下，与 $\\mathbf{v}_{k}$ 相关联的角频率平方可以通过 Rayleigh 商来估计，\n$$\n\\omega_{M}^{2}(k) = c^{2}\\,\\frac{\\mathbf{v}_{k}^{\\ast} K\\,\\mathbf{v}_{k}}{\\mathbf{v}_{k}^{\\ast} M\\,\\mathbf{v}_{k}},\n\\qquad\n\\omega_{\\tilde{M}}^{2}(k) = c^{2}\\,\\frac{\\mathbf{v}_{k}^{\\ast} K\\,\\mathbf{v}_{k}}{\\mathbf{v}_{k}^{\\ast} \\tilde{M}\\,\\mathbf{v}_{k}},\n$$\n其中上标 $\\ast$ 表示复共轭转置。定义相速度 $c_{p}(k) = \\omega(k)/k$。仅使用上述定义和 Galerkin 离散化的第一性原理，构造一个反例，证明对于相同的 $\\mathbf{v}_{k}$，$M$ 和 $\\tilde{M}$ 会产生不同的特征频率估计，并推导相对相速度误差的闭式表达式\n$$\n\\delta(k) \\;=\\; \\frac{c_{p,\\tilde{M}}(k) - c_{p,M}(k)}{c_{p,M}(k)}.\n$$\n您的最终答案必须是关于 $k$ 的 $\\delta(k)$ 的单个闭式解析表达式。不需要进行数值计算或四舍五入。", "solution": "该问题是适定的且科学上合理的，其基础是偏微分方程数值分析的原理，特别是谱元法。所有定义和条件都已给出，不存在矛盾或模糊之处。我们可以开始求解。\n\n目标是求出相对相速度误差 $\\delta(k)$，其定义为\n$$\n\\delta(k) = \\frac{c_{p,\\tilde{M}}(k) - c_{p,M}(k)}{c_{p,M}(k)} = \\frac{c_{p,\\tilde{M}}(k)}{c_{p,M}(k)} - 1.\n$$\n相速度由 $c_p(k) = \\omega(k)/k$ 给出。因此，相速度之比等于角频率之比：\n$$\n\\frac{c_{p,\\tilde{M}}(k)}{c_{p,M}(k)} = \\frac{\\omega_{\\tilde{M}}(k)/k}{\\omega_{M}(k)/k} = \\frac{\\omega_{\\tilde{M}}(k)}{\\omega_{M}(k)}.\n$$\n对于非平凡模式，$\\omega(k) > 0$，因此我们可以将此比值写为频率平方之比的平方根：\n$$\n\\frac{\\omega_{\\tilde{M}}(k)}{\\omega_{M}(k)} = \\sqrt{\\frac{\\omega_{\\tilde{M}}^{2}(k)}{\\omega_{M}^{2}(k)}}.\n$$\n使用所提供的角频率平方作为 Rayleigh 商的定义：\n$$\n\\frac{\\omega_{\\tilde{M}}^{2}(k)}{\\omega_{M}^{2}(k)} = \\frac{c^{2}\\,\\frac{\\mathbf{v}_{k}^{\\ast} K\\,\\mathbf{v}_{k}}{\\mathbf{v}_{k}^{\\ast} \\tilde{M}\\,\\mathbf{v}_{k}}}{c^{2}\\,\\frac{\\mathbf{v}_{k}^{\\ast} K\\,\\mathbf{v}_{k}}{\\mathbf{v}_{k}^{\\ast} M\\,\\mathbf{v}_{k}}}.\n$$\n假设模式不是平凡的，$\\mathbf{v}_{k}^{\\ast} K\\,\\mathbf{v}_{k} \\neq 0$，我们可以消去这一项，从而大大简化表达式：\n$$\n\\frac{\\omega_{\\tilde{M}}^{2}(k)}{\\omega_{M}^{2}(k)} = \\frac{\\mathbf{v}_{k}^{\\ast} M\\,\\mathbf{v}_{k}}{\\mathbf{v}_{k}^{\\ast} \\tilde{M}\\,\\mathbf{v}_{k}}.\n$$\n因此，相对误差 $\\delta(k)$ 仅取决于 Rayleigh 商中分母项的比值：\n$$\n\\delta(k) = \\sqrt{\\frac{\\mathbf{v}_{k}^{\\ast} M\\,\\mathbf{v}_{k}}{\\mathbf{v}_{k}^{\\ast} \\tilde{M}\\,\\mathbf{v}_{k}}} - 1.\n$$\n我们的任务简化为计算分母中的两个二次型。\n\n首先，我们计算集中质量矩阵的项 $\\mathbf{v}_{k}^{\\ast} \\tilde{M}\\,\\mathbf{v}_{k}$。集中质量矩阵 $\\tilde{M}$ 是一个对角矩阵，其元素由 3 点的 Legendre-Gauss-Lobatto (LGL) 求积权重给出：$\\tilde{M} = \\mathrm{diag}(w_{1}, w_{2}, w_{3}) = \\mathrm{diag}(\\frac{1}{3}, \\frac{4}{3}, \\frac{1}{3})$。测试向量为 $\\mathbf{v}_{k} = (\\exp(-\\mathrm{i}k), 1, \\exp(\\mathrm{i}k))^T$。\n$$\n\\mathbf{v}_{k}^{\\ast} \\tilde{M}\\,\\mathbf{v}_{k} = \\begin{pmatrix} \\exp(\\mathrm{i}k) & 1 & \\exp(-\\mathrm{i}k) \\end{pmatrix} \\begin{pmatrix} \\frac{1}{3} & 0 & 0 \\\\ 0 & \\frac{4}{3} & 0 \\\\ 0 & 0 & \\frac{1}{3} \\end{pmatrix} \\begin{pmatrix} \\exp(-\\mathrm{i}k) \\\\ 1 \\\\ \\exp(\\mathrm{i}k) \\end{pmatrix}\n$$\n$$\n\\mathbf{v}_{k}^{\\ast} \\tilde{M}\\,\\mathbf{v}_{k} = \\frac{1}{3} \\exp(\\mathrm{i}k)\\exp(-\\mathrm{i}k) + \\frac{4}{3}(1)(1) + \\frac{1}{3}\\exp(-\\mathrm{i}k)\\exp(\\mathrm{i}k) = \\frac{1}{3} + \\frac{4}{3} + \\frac{1}{3} = \\frac{6}{3} = 2.\n$$\n这一项是常数，等于求积权重之和，因为 $\\mathbf{v}_k$ 的所有分量的模都为 1。\n\n接下来，我们计算一致质量矩阵的项 $\\mathbf{v}_{k}^{\\ast} M\\,\\mathbf{v}_{k}$。根据定义，$M_{ij} = \\int_{-1}^{1} \\ell_{i}(x)\\,\\ell_{j}(x)\\,dx$。让我们定义平面波 $\\exp(\\mathrm{i}kx)$ 在 LGL 节点上的 2 次多项式插值 $f_k(x) = \\sum_{j=1}^{3} \\exp(\\mathrm{i}k x_j) \\ell_j(x) = \\sum_{j=1}^{3} (\\mathbf{v}_k)_j \\ell_j(x)$。二次型可以写为：\n$$\n\\mathbf{v}_{k}^{\\ast} M\\,\\mathbf{v}_{k} = \\sum_{i=1}^{3}\\sum_{j=1}^{3} \\overline{(\\mathbf{v}_k)_i} M_{ij} (\\mathbf{v}_k)_j = \\sum_{i=1}^{3}\\sum_{j=1}^{3} \\overline{(\\mathbf{v}_k)_i} \\left(\\int_{-1}^{1} \\ell_{i}(x)\\,\\ell_{j}(x)\\,dx \\right) (\\mathbf{v}_k)_j\n= \\int_{-1}^{1} \\left(\\sum_{i=1}^{3} \\overline{(\\mathbf{v}_k)_i} \\ell_i(x)\\right) \\left(\\sum_{j=1}^{3} (\\mathbf{v}_k)_j \\ell_j(x)\\right) dx = \\int_{-1}^{1} \\overline{f_k(x)}f_k(x)\\,dx = \\int_{-1}^{1} |f_k(x)|^2 dx.\n$$\n为了求得 $f_k(x)$，我们构造节点 $x_1=-1$, $x_2=0$, $x_3=1$ 的 Lagrange 基多项式 $\\{\\ell_j(x)\\}_{j=1}^3$：\n$$\n\\ell_1(x) = \\frac{x(x-1)}{(-1)(-2)} = \\frac{1}{2}(x^2-x)\n$$\n$$\n\\ell_2(x) = \\frac{(x+1)(x-1)}{(1)(-1)} = 1-x^2\n$$\n$$\n\\ell_3(x) = \\frac{(x+1)x}{(2)(1)} = \\frac{1}{2}(x^2+x)\n$$\n现在，我们构造 $f_k(x) = (\\mathbf{v}_k)_1 \\ell_1(x) + (\\mathbf{v}_k)_2 \\ell_2(x) + (\\mathbf{v}_k)_3 \\ell_3(x)$：\n$$\nf_k(x) = \\exp(-\\mathrm{i}k)\\frac{1}{2}(x^2-x) + (1)(1-x^2) + \\exp(\\mathrm{i}k)\\frac{1}{2}(x^2+x)\n$$\n$$\nf_k(x) = \\left(\\frac{\\exp(-\\mathrm{i}k)+\\exp(\\mathrm{i}k)}{2} - 1\\right)x^2 + \\left(\\frac{\\exp(\\mathrm{i}k)-\\exp(-\\mathrm{i}k)}{2}\\right)x + 1\n$$\n使用 Euler 公式，$\\cos(k) = \\frac{\\exp(\\mathrm{i}k)+\\exp(-\\mathrm{i}k)}{2}$ 和 $\\sin(k) = \\frac{\\exp(\\mathrm{i}k)-\\exp(-\\mathrm{i}k)}{2\\mathrm{i}}$：\n$$\nf_k(x) = (\\cos k - 1)x^2 + \\mathrm{i}\\sin(k)x + 1\n$$\n接下来，我们求 $|f_k(x)|^2 = f_k(x)\\overline{f_k(x)}$：\n$$\n|f_k(x)|^2 = \\left( (\\cos k - 1)x^2 + 1 \\right)^2 + (\\sin(k)x)^2\n$$\n$$\n|f_k(x)|^2 = (\\cos k - 1)^2 x^4 + 2(\\cos k - 1)x^2 + 1 + \\sin^2(k)x^2\n$$\n$$\n|f_k(x)|^2 = (\\cos k - 1)^2 x^4 + (2\\cos k - 2 + \\sin^2 k)x^2 + 1\n$$\n使用 $\\sin^2(k) = 1-\\cos^2(k)$：\n$$\n|f_k(x)|^2 = (\\cos k - 1)^2 x^4 + (2\\cos k - 2 + 1 - \\cos^2 k)x^2 + 1\n$$\n$$\n|f_k(x)|^2 = (\\cos k - 1)^2 x^4 - (\\cos^2 k - 2\\cos k + 1)x^2 + 1 = (\\cos k - 1)^2 x^4 - (\\cos k - 1)^2 x^2 + 1\n$$\n现在我们在域 $[-1, 1]$ 上对 $|f_k(x)|^2$ 进行积分：\n$$\n\\mathbf{v}_{k}^{\\ast} M\\,\\mathbf{v}_{k} = \\int_{-1}^{1} \\left( (\\cos k - 1)^2(x^4 - x^2) + 1 \\right) dx = (\\cos k - 1)^2 \\left[\\frac{x^5}{5} - \\frac{x^3}{3}\\right]_{-1}^{1} + [x]_{-1}^{1}\n$$\n$$\n\\mathbf{v}_{k}^{\\ast} M\\,\\mathbf{v}_{k} = (\\cos k - 1)^2 \\left( 2\\left(\\frac{1}{5} - \\frac{1}{3}\\right) \\right) + 2 = (\\cos k - 1)^2 \\left( 2\\left(\\frac{3-5}{15}\\right) \\right) + 2\n$$\n$$\n\\mathbf{v}_{k}^{\\ast} M\\,\\mathbf{v}_{k} = -\\frac{4}{15}(\\cos k - 1)^2 + 2 = 2 - \\frac{4}{15}(\\cos^2 k - 2\\cos k + 1)\n$$\n$$\n\\mathbf{v}_{k}^{\\ast} M\\,\\mathbf{v}_{k} = \\frac{30 - 4\\cos^2 k + 8\\cos k - 4}{15} = \\frac{26 + 8\\cos k - 4\\cos^2 k}{15} = \\frac{2}{15}(13 + 4\\cos k - 2\\cos^2 k).\n$$\n$\\mathbf{v}_{k}^{\\ast} M\\,\\mathbf{v}_{k}$ 依赖于 $k$ 而 $\\mathbf{v}_{k}^{\\ast} \\tilde{M}\\,\\mathbf{v}_{k}$ 不依赖于 $k$ 这一事实提供了一个反例。具体来说，$\\mathbf{v}_{k}^{\\ast} M\\,\\mathbf{v}_{k} = \\mathbf{v}_{k}^{\\ast} \\tilde{M}\\,\\mathbf{v}_{k}$ 仅当 $\\frac{2}{15}(13 + 4\\cos k - 2\\cos^2 k) = 2$ 时成立，这可以简化为 $2(\\cos k - 1)^2 = 0$，意味着 $\\cos k = 1$。对于任何不是 $2\\pi$ 整数倍的 $k$，Rayleigh 商的分母不同，因此 $\\omega_M^2(k) \\ne \\omega_{\\tilde{M}}^2(k)$，这表明特征频率估计是不同的。\n\n现在我们可以计算 $\\delta(k)$ 所需的比值：\n$$\n\\frac{\\mathbf{v}_{k}^{\\ast} M\\,\\mathbf{v}_{k}}{\\mathbf{v}_{k}^{\\ast} \\tilde{M}\\,\\mathbf{v}_{k}} = \\frac{\\frac{2}{15}(13 + 4\\cos k - 2\\cos^2 k)}{2} = \\frac{1}{15}(13 + 4\\cos k - 2\\cos^2 k).\n$$\n最后，我们将其代入 $\\delta(k)$ 的表达式中：\n$$\n\\delta(k) = \\sqrt{\\frac{1}{15}(13 + 4\\cos k - 2\\cos^2 k)} - 1.\n$$\n这就是相对相速度误差的闭式解析表达式。", "answer": "$$ \\boxed{\\sqrt{\\frac{1}{15}(13 + 4\\cos(k) - 2\\cos^{2}(k))} - 1} $$", "id": "3398334"}, {"introduction": "采用质量集中的主要动机是为了提升计算性能，尤其是在显式时间步进格式中。本编程练习将揭示这一改进的一个关键方面：对质量矩阵条件数的影响。你将通过数值实验来研究随着多项式阶次 $p$ 的增加，一致质量矩阵和集中质量矩阵的条件数如何变化，从而揭示质量集中在高阶方法中的实际优势 [@problem_id:3398308]。", "problem": "考虑一维参考区间 $\\left[-1,1\\right]$ 以及在 Gauss–Lobatto–Legendre (GLL) 节点上使用 $p$ 次节点拉格朗日多项式的谱元法。设 $\\left\\{\\ell_i(x)\\right\\}_{i=0}^{p}$ 表示与 $p+1$ 个 GLL 节点相关联的拉格朗日基函数。一致单元质量矩阵 $\\mathbf{M}^{\\text{cons}} \\in \\mathbb{R}^{(p+1)\\times(p+1)}$ 由 $L^2$ 空间的基本内积定义，\n$$\nM^{\\text{cons}}_{ij} \\;=\\; \\int_{-1}^{1} \\ell_i(x)\\,\\ell_j(x)\\,\\mathrm{d}x,\n$$\n为了保持诱导范数，该内积对于最高 $2p$ 次的多项式必须精确计算。集中质量矩阵 $\\mathbf{M}^{\\text{lump}} \\in \\mathbb{R}^{(p+1)\\times(p+1)}$ 是一个对角矩阵，它是通过将 GLL 求积直接应用于与节点基函数相同的 $L^2$ 内积而构造的，其对角线元素等于 GLL 节点处的 GLL 求积权重。\n\n对于任何对称正定矩阵 $\\mathbf{A}$，其二范数条件数定义为\n$$\n\\kappa_2(\\mathbf{A}) \\;=\\; \\frac{\\lambda_{\\max}(\\mathbf{A})}{\\lambda_{\\min}(\\mathbf{A})},\n$$\n其中 $\\lambda_{\\max}$ 和 $\\lambda_{\\min}$ 分别是最大和最小特征值。\n\n从 $L^2$ 内积的基本定义及其通过高斯求积对多项式的精确计算出发，实现一个程序，该程序：\n- 使用对具有合适参数的 Jacobi 多项式进行有数学依据的求根方法，构造 $p$ 阶的 GLL 节点和 GLL 求积权重，确保内部节点与 $p$ 次 Legendre 多项式导数的根重合，并且包含端点 $\\pm 1$。\n- 通过使用足够数量的点以精确积分任何 $2p$ 次多项式的 Gauss–Legendre 求积来计算积分，从而组装 $\\mathbf{M}^{\\text{cons}}$。\n- 使用 GLL 求积权重将 $\\mathbf{M}^{\\text{lump}}$ 组装成一个对角矩阵，以反映谱元法中的质量集中方法。\n- 对测试组的次数 $p \\in \\{4,8,12\\}$ 计算 $\\kappa_2(\\mathbf{M}^{\\text{cons}})$ 和 $\\kappa_2(\\mathbf{M}^{\\text{lump}})$，并额外报告相对于基准 $p=4$ 的增长因子，对每个矩阵族定义如下\n$$\ng^{\\text{cons}}(p) \\;=\\; \\frac{\\kappa_2\\!\\left(\\mathbf{M}^{\\text{cons}}(p)\\right)}{\\kappa_2\\!\\left(\\mathbf{M}^{\\text{cons}}(4)\\right)}, \n\\qquad\ng^{\\text{lump}}(p) \\;=\\; \\frac{\\kappa_2\\!\\left(\\mathbf{M}^{\\text{lump}}(p)\\right)}{\\kappa_2\\!\\left(\\mathbf{M}^{\\text{lump}}(4)\\right)}.\n$$\n\n使用以下测试组参数值以确保覆盖中等和更高阶：$p=4$（基准），$p=8$（更高阶），和 $p=12$（甚至更高阶）。对于每个 $p$：\n- 以实数（浮点数）形式返回条件数 $\\kappa_2(\\mathbf{M}^{\\text{cons}})$ 和 $\\kappa_2(\\mathbf{M}^{\\text{lump}})$。\n- 以实数（浮点数）形式返回增长因子 $g^{\\text{cons}}(p)$ 和 $g^{\\text{lump}}(p)$。\n\n您的程序应生成单行输出，其中包含四个用方括号括起来的列表：\n1. $p\\in\\{4,8,12\\}$ 时 $\\kappa_2(\\mathbf{M}^{\\text{cons}})$ 值的列表。\n2. $p\\in\\{4,8,12\\}$ 时 $\\kappa_2(\\mathbf{M}^{\\text{lump}})$ 值的列表。\n3. $p\\in\\{4,8,12\\}$ 时 $g^{\\text{cons}}(p)$ 值的列表。\n4. $p\\in\\{4,8,12\\}$ 时 $g^{\\text{lump}}(p)$ 值的列表。\n\n因此，所需的确切输出格式是如下所示的单行\n$$\n\\left[\\left[\\kappa_2\\!\\left(\\mathbf{M}^{\\text{cons}}(4)\\right),\\kappa_2\\!\\left(\\mathbf{M}^{\\text{cons}}(8)\\right),\\kappa_2\\!\\left(\\mathbf{M}^{\\text{cons}}(12)\\right)\\right],\\left[\\kappa_2\\!\\left(\\mathbf{M}^{\\text{lump}}(4)\\right),\\kappa_2\\!\\left(\\mathbf{M}^{\\text{lump}}(8)\\right),\\kappa_2\\!\\left(\\mathbf{M}^{\\text{lump}}(12)\\right)\\right],\\left[g^{\\text{cons}}(4),g^{\\text{cons}}(8),g^{\\text{cons}}(12)\\right],\\left[g^{\\text{lump}}(4),g^{\\text{lump}}(8),g^{\\text{lump}}(12)\\right]\\right].\n$$\n此计算不涉及任何物理单位；所有输出都应为无单位的实数。", "solution": "所述问题已经过验证，被认为是正确、适定且科学合理的。它代表了谱元法数值分析中一个标准且富有洞察力的练习。所有定义，包括 Gauss–Lobatto–Legendre (GLL) 节点、一致和集中质量矩阵以及条件数的定义，都与计算科学领域的既有文献一致。该问题是自洽的，并为获得唯一的、可验证的解提供了所有必要信息。因此，我们可以进行有原则的推导和实现。\n\n目标是在一维谱元背景下，比较不同多项式次数 $p$ 的一致质量矩阵 $\\mathbf{M}^{\\text{cons}}$ 和集中质量矩阵 $\\mathbf{M}^{\\text{lump}}$ 的条件数。条件数通过谱条件数 $\\kappa_2$ 来衡量。\n\n### 步骤 1：Gauss–Lobatto–Legendre 节点和求积权重\n\n节点谱元的基础是一组基函数，这些基函数是相对于参考区间 $x \\in [-1, 1]$ 上的一组特定节点定义的。问题指定了 Gauss–Lobatto–Legendre (GLL) 节点。\n\n对于一个 $p$ 次多项式，有 $N+1 = p+1$ 个 GLL 节点，我们将其表示为 $\\{x_j\\}_{j=0}^{p}$。这些节点被定义为多项式 $(1-x^2)P'_p(x)$ 的根，其中 $P_p(x)$ 是 $p$ 次 Legendre 多项式。该定义确保了端点 $x_0 = -1$ 和 $x_p = 1$ 包含在节点集中。$p-1$ 个内部节点是 $P'_p(x)$ 的根。\n\n一种数值稳定的寻找这些内部节点的方法利用了 Legendre 多项式的导数与 Jacobi 多项式之间的关系：\n$$\n\\frac{\\mathrm{d}P_p(x)}{\\mathrm{d}x} \\propto P_{p-1}^{(1,1)}(x)\n$$\n其中 $P_{n}^{(\\alpha,\\beta)}(x)$ 是次数为 $n$、参数为 $\\alpha$ 和 $\\beta$ 的 Jacobi 多项式。因此，$p-1$ 个内部 GLL 节点恰好是 $P_{p-1}^{(1,1)}(x)$ 的根。这些根可以使用成熟的数值例程可靠地计算出来。\n\n与 GLL 节点相关联的是 GLL 求积法则，它将积分近似为节点处函数值的加权和：\n$$\n\\int_{-1}^{1} f(x)\\,\\mathrm{d}x \\approx \\sum_{j=0}^{p} w_j f(x_j)\n$$\n这个使用 $p+1$ 个点的求积法则对所有次数最高为 $2p-1$ 的多项式都是精确的。求积权重 $\\{w_j\\}_{j=0}^{p}$ 由以下公式给出：\n$$\nw_j = \\frac{2}{p(p+1) [P_p(x_j)]^2}, \\quad j=0, 1, \\dots, p\n$$\n对于端点 $x_j = \\pm 1$，由于 $|P_p(\\pm 1)| = 1$，权重简化为 $w_{0} = w_{p} = \\frac{2}{p(p+1)}$。\n\n### 步骤 2：集中质量矩阵及其条件数\n\n集中质量矩阵 $\\mathbf{M}^{\\text{lump}}$ 是通过将 GLL 求积法则应用于定义一致质量矩阵的积分而导出的。基函数是与 GLL 节点 $\\{x_j\\}_{j=0}^{p}$ 相关联的 Lagrange 多项式 $\\{\\ell_i(x)\\}_{i=0}^{p}$。这些基函数具有基本性质 $\\ell_i(x_j) = \\delta_{ij}$，其中 $\\delta_{ij}$ 是 Kronecker delta。\n\n将 GLL 求积应用于质量矩阵积分得到：\n$$\nM_{ij}^{\\text{cons}} = \\int_{-1}^{1} \\ell_i(x) \\ell_j(x)\\,\\mathrm{d}x \\approx \\sum_{k=0}^{p} w_k \\ell_i(x_k) \\ell_j(x_k)\n$$\n代入基本性质 $\\ell_i(x_k) = \\delta_{ik}$ 和 $\\ell_j(x_k) = \\delta_{jk}$：\n$$\nM_{ij}^{\\text{lump}} = \\sum_{k=0}^{p} w_k \\delta_{ik} \\delta_{jk}\n$$\n仅当 $i=j=k$ 时，此和非零，得到 $M_{ii}^{\\text{lump}} = w_i$ 和当 $i \\neq j$ 时 $M_{ij}^{\\text{lump}} = 0$。因此，集中质量矩阵是一个对角矩阵，其对角线上的元素是 GLL 求积权重：\n$$\n\\mathbf{M}^{\\text{lump}} = \\text{diag}(w_0, w_1, \\dots, w_p)\n$$\n对角矩阵的特征值就是其对角线上的元素。由于 $\\mathbf{M}^{\\text{lump}}$ 是对称的，且其元素（权重 $w_j$）为正，因此它是正定的。其特征值为 $\\{\\lambda_j\\}_{j=0}^p = \\{w_j\\}_{j=0}^p$。因此，条件数是最大和最小 GLL 权重的直接比值：\n$$\n\\kappa_2(\\mathbf{M}^{\\text{lump}}) = \\frac{\\lambda_{\\max}(\\mathbf{M}^{\\text{lump}})}{\\lambda_{\\min}(\\mathbf{M}^{\\text{lump}})} = \\frac{\\max_{j} \\{w_j\\}}{\\min_{j} \\{w_j\\}}\n$$\n最小权重出现在端点处，$\\min\\{w_j\\} = \\frac{2}{p(p+1)}$，其尺度为 $\\mathcal{O}(p^{-2})$。最大权重出现在区间中心附近，可以证明其尺度为 $\\mathcal{O}(p^{-1})$。因此，$\\kappa_2(\\mathbf{M}^{\\text{lump}})$ 预计会以 $\\mathcal{O}(p)$ 的速度增长。\n\n### 步骤 3：一致质量矩阵及其条件数\n\n一致质量矩阵 $\\mathbf{M}^{\\text{cons}}$ 由积分的精确计算定义：\n$$\nM_{ij}^{\\text{cons}} = \\int_{-1}^{1} \\ell_i(x) \\ell_j(x)\\,\\mathrm{d}x\n$$\n被积函数 $\\ell_i(x)\\ell_j(x)$ 是两个 $p$ 次多项式的乘积，结果是一个最高为 $2p$ 次的多项式。为了精确计算这个积分，我们必须使用一个对至少该次数的多项式精确的求积法则。具有 $N_q$ 个点的 Gauss-Legendre 求积法则对于次数最高为 $2N_q - 1$ 的多项式是精确的。我们需要 $2N_q - 1 \\ge 2p$，这意味着 $N_q \\ge p + 1/2$。我们选择 $N_q = p+1$，这满足该条件。\n\n设 $\\{x^q_k, w^q_k\\}_{k=0}^{N_q-1}$ 为 $N_q$ 点 Gauss-Legendre 求积的节点和权重。一致质量矩阵的元素计算如下：\n$$\nM_{ij}^{\\text{cons}} = \\sum_{k=0}^{N_q-1} w^q_k \\ell_i(x^q_k) \\ell_j(x^q_k)\n$$\n此计算首先涉及在所有 Gauss-Legendre 求积节点 $x^q_k$ 上计算所有 Lagrange 基函数 $\\ell_i(x)$ 的值。Lagrange 多项式 $\\ell_i(x)$ 由其基于 GLL 节点 $\\{x_j\\}$ 的标准定义给出：\n$$\n\\ell_i(x) = \\prod_{j=0, j \\neq i}^{p} \\frac{x - x_j}{x_i - x_j}\n$$\n一旦矩阵 $\\mathbf{M}^{\\text{cons}}$ 被组装，其特征值将通过数值方法计算。由于该矩阵是实对称的（根据构造），其特征值是实数。又因为它也是正定的，其特征值是正数。然后，条件数计算为最大特征值与最小特征值的比值：\n$$\n\\kappa_2(\\mathbf{M}^{\\text{cons}}) = \\frac{\\lambda_{\\max}(\\mathbf{M}^{\\text{cons}})}{\\lambda_{\\min}(\\mathbf{M}^{\\text{cons}})}\n$$\n理论分析表明，对于 GLL 节点基，一致质量矩阵的条件数由一个与多项式次数 $p$ 无关的常数所界定。我们的数值结果应能证实这一性质。\n\n### 步骤 4：增长因子\n\n最后，为了量化条件数随多项式次数 $p$ 的增长，我们计算相对于 $p=4$ 基准情况的增长因子。对于每个矩阵族（一致和集中），给定 $p$ 的增长因子定义为：\n$$\ng(p) = \\frac{\\kappa_2(\\mathbf{M}(p))}{\\kappa_2(\\mathbf{M}(4))}\n$$\n对于基准情况 $p=4$，根据定义，增长因子 $g^{\\text{cons}}(4)$ 和 $g^{\\text{lump}}(4)$ 等于 $1.0$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import roots_jacobi, legendre, roots_legendre\n\ndef solve():\n    \"\"\"\n    Computes and compares the condition numbers of consistent and lumped mass matrices\n    for 1D spectral elements using GLL nodes for various polynomial degrees.\n    \"\"\"\n    p_values = [4, 8, 12]\n    \n    kappa_cons_list = []\n    kappa_lump_list = []\n\n    for p in p_values:\n        # Step 1: Compute GLL nodes and weights for degree p\n        \n        # Interior GLL nodes are roots of the derivative of P_p(x), which are the\n        # roots of the Jacobi polynomial P_{p-1}^{(1,1)}(x).\n        if p > 1:\n            interior_nodes = roots_jacobi(p - 1, 1, 1)[0]\n        else:\n            interior_nodes = np.array([])\n            \n        # Combine with endpoints to get the full set of p+1 GLL nodes\n        gll_nodes = np.concatenate(([-1.0], interior_nodes, [1.0]))\n        gll_nodes.sort()\n\n        # Compute GLL quadrature weights using the formula:\n        # w_j = 2 / (p * (p+1) * [P_p(x_j)]^2)\n        P_p = legendre(p)\n        gll_weights = 2.0 / (p * (p + 1) * (P_p(gll_nodes)**2))\n\n        # Step 2: Assemble lumped mass matrix and compute its condition number\n        \n        # The lumped mass matrix is diagonal with the GLL weights.\n        # Its eigenvalues are the weights themselves.\n        kappa_lump = np.max(gll_weights) / np.min(gll_weights)\n        kappa_lump_list.append(kappa_lump)\n\n        # Step 3: Assemble consistent mass matrix and compute its condition number\n        \n        # The integrand for M_cons is a polynomial of degree 2p. We need a\n        # quadrature rule exact for this degree. Gauss-Legendre with N_q points\n        # is exact for polynomials of degree 2*N_q - 1.\n        # We need 2*N_q - 1 >= 2p, so N_q >= p + 1/2. We choose N_q = p + 1.\n        n_quad = p + 1\n        gl_nodes, gl_weights = roots_legendre(n_quad)\n\n        # Evaluate all Lagrange basis functions (defined on GLL nodes) at all\n        # Gauss-Legendre quadrature nodes.\n        # L_ki = l_i(x_k^q)\n        L_matrix = np.zeros((n_quad, p + 1))\n        for i in range(p + 1):\n            # Numerator term for l_i(x): product of (x - x_j) for j != i\n            # Vectorized computation for all gl_nodes at once.\n            nodes_without_i = np.delete(gll_nodes, i)\n            # Use np.subtract.outer to create a matrix of differences (gl_nodes_k - nodes_without_i_j)\n            # then take the product along axis 1.\n            num_prods = np.prod(np.subtract.outer(gl_nodes, nodes_without_i), axis=1)\n\n            # Denominator term for l_i(x): product of (x_i - x_j) for j != i\n            denom = np.prod(gll_nodes[i] - nodes_without_i)\n            \n            L_matrix[:, i] = num_prods / denom\n        \n        # Assemble the consistent mass matrix using the rule:\n        # M_cons = L^T * diag(w^q) * L\n        M_cons = L_matrix.T @ np.diag(gl_weights) @ L_matrix\n        \n        # Compute eigenvalues. Use eigvalsh as the matrix is symmetric.\n        eigenvalues_cons = np.linalg.eigvalsh(M_cons)\n        \n        kappa_cons = np.max(eigenvalues_cons) / np.min(eigenvalues_cons)\n        kappa_cons_list.append(kappa_cons)\n\n    # Step 4: Calculate growth factors relative to p=4\n    baseline_kappa_cons = kappa_cons_list[0]\n    baseline_kappa_lump = kappa_lump_list[0]\n    \n    g_cons_list = [k / baseline_kappa_cons for k in kappa_cons_list]\n    g_lump_list = [k / baseline_kappa_lump for k in kappa_lump_list]\n\n    # Combine all results into a list of lists for printing\n    final_results = [\n        kappa_cons_list,\n        kappa_lump_list,\n        g_cons_list,\n        g_lump_list\n    ]\n\n    # Format the output string exactly as required, without spaces.\n    output_str = \"[\" + \",\".join([f\"[{','.join(map(str, sublist))}]\" for sublist in final_results]) + \"]\"\n    \n    print(output_str)\n\nsolve()\n```", "id": "3398308"}]}