{"hands_on_practices": [{"introduction": "谱方法的核心思想在于使用一组特殊的基函数来表示解。对于许多微分算子，其特征函数提供了一个理想的正交基。这项练习将通过求解带有狄利克雷（Dirichlet）边界条件的一维拉普拉斯算子的特征值问题，来探索这一基本概念。通过亲手推导这些特征函数和特征值，您将深刻理解谱方法威力的来源，以及“谱”在“谱方法”中的确切含义。[@problem_id:3379345]", "problem": "考虑区间 $(0,1)$ 上的一维拉普拉斯特征值问题，其常微分方程为 $-u''(x) = \\lambda u(x)$，服从齐次狄利克雷边界条件 $u(0) = 0$ 和 $u(1) = 0$。在谱方法和间断伽辽金方法的框架下，这是一个典型的 Sturm–Liouville 问题，其特征结构是正交展开、稳定性和数值格式收敛性的基础。从以下基本事实出发：狄利克雷拉普拉斯算子是 $L^{2}(0,1)$ 上的自伴算子，其定义域为 $H^{2}(0,1) \\cap H_{0}^{1}(0,1)$；自伴 Sturm–Liouville 算子具有实特征值，其对应的正交特征函数在 $L^{2}(0,1)$ 中构成一个完备集。请执行以下步骤：\n\n1. 求解边值问题 $-u''(x) = \\lambda u(x)$（满足 $u(0) = 0$ 和 $u(1) = 0$），以确定所有的特征对 $(\\lambda_{n}, u_{n})$。证明特征值是实数，且对应于不同特征值的特征函数在 $L^{2}(0,1)$ 中是正交的，并解释为什么这些特征函数在 $L^{2}(0,1)$ 中构成一个完备集。\n2. 对于区间 $(0,1)$ 上的函数 $f(x) = x$，利用 $L^{2}(0,1)$ 内积 $\\langle v, w \\rangle = \\int_{0}^{1} v(x) w(x) \\,\\mathrm{d}x$，在特征函数基 $\\{u_{n}\\}_{n \\ge 1}$ 中构造其傅里叶正弦展开。展开系数 $b_{n}$ 由投影公式 $b_{n} = \\langle f, u_{n} \\rangle / \\langle u_{n}, u_{n} \\rangle$ 定义，请显式地确定所有 $n \\ge 1$ 的 $b_{n}$。\n3. 利用正交性和完备性，应用此展开的帕塞瓦尔恒等式来计算无穷级数\n$$\nS \\;=\\; \\sum_{n=1}^{\\infty} \\frac{1}{2}\\,b_{n}^{2}.\n$$\n的精确值。将 $S$ 的最终结果表示为一个精确的数字。不需要四舍五入。最终答案必须是一个无单位的实数。", "solution": "所述问题是一个标准的、适定的 Sturm-Liouville 特征值问题，是偏微分方程理论和数值方法的基础。所有提供的信息都是一致且充分的，足以确定一个唯一的解。该问题是有效的。\n\n我们按要求分三部分进行求解。\n\n第1部分：特征对的确定与性质证明\n\n特征值问题由常微分方程\n$$\n-u''(x) = \\lambda u(x), \\quad x \\in (0,1)\n$$\n和齐次狄利克雷边界条件 $u(0) = 0$ 和 $u(1) = 0$ 给出。该方程可重写为 $u''(x) + \\lambda u(x) = 0$。我们分析特征值 $\\lambda$ 的性质。\n\n情况1：$\\lambda  0$。令 $\\lambda = -\\mu^2$，其中 $\\mu  0$。方程变为 $u''(x) - \\mu^2 u(x) = 0$，其通解为 $u(x) = A \\cosh(\\mu x) + B \\sinh(\\mu x)$。应用边界条件：\n$u(0) = A \\cosh(0) + B \\sinh(0) = A = 0$。\n解简化为 $u(x) = B \\sinh(\\mu x)$。第二个边界条件给出 $u(1) = B \\sinh(\\mu) = 0$。由于 $\\mu  0$，$\\sinh(\\mu) \\neq 0$，这意味着 $B=0$。这只得到平凡解 $u(x) = 0$，因此没有负特征值。\n\n情况2：$\\lambda = 0$。方程为 $u''(x) = 0$，其通解为 $u(x) = Ax + B$。应用边界条件：\n$u(0) = B = 0$。\n$u(1) = A \\cdot 1 = A = 0$。\n这同样只得到平凡解，因此 $\\lambda=0$ 不是一个特征值。\n\n情况3：$\\lambda  0$。令 $\\lambda = k^2$，其中 $k  0$。方程变为 $u''(x) + k^2 u(x) = 0$，其通解为 $u(x) = A \\cos(k x) + B \\sin(k x)$。应用边界条件：\n$u(0) = A \\cos(0) + B \\sin(0) = A = 0$。\n此时解为 $u(x) = B \\sin(k x)$。第二个边界条件给出 $u(1) = B \\sin(k) = 0$。为获得非平凡解，必须有 $B \\neq 0$，这要求 $\\sin(k) = 0$。对于 $k0$ 的解是 $k = n\\pi$，其中 $n = 1, 2, 3, \\ldots$。\n因此，特征值为 $\\lambda_n = k_n^2 = (n\\pi)^2$，其中 $n \\in \\{1, 2, 3, \\ldots\\}$。\n对应的特征函数为 $u_n(x) = B_n \\sin(n\\pi x)$。为简单起见，我们可以选择常数 $B_n=1$，得到特征对：\n$$\n(\\lambda_n, u_n(x)) = ((n\\pi)^2, \\sin(n\\pi x)) \\quad \\text{for } n=1, 2, 3, \\dots\n$$\n\n性质证明：\n该问题是算子 $L[u] = -u''$ 在区间 $[0,1]$ 上带指定边界条件的正则 Sturm-Liouville 问题。此类系统的性质是公认的。\n1.  实特征值：在给定的边界条件下，算子 $L$ 在 $L^2(0,1)$ 上是自伴的。设 $(\\lambda, u)$ 为一个特征对。则 $\\langle Lu, u \\rangle = \\langle \\lambda u, u \\rangle = \\lambda \\langle u, u \\rangle$。利用分部积分和边界条件 $u(0)=u(1)=0$：\n    $$\n    \\langle Lu, u \\rangle = \\int_{0}^{1} -u''(x) \\overline{u(x)} \\, \\mathrm{d}x = \\left[-u'(x)\\overline{u(x)}\\right]_{0}^{1} + \\int_{0}^{1} u'(x) \\overline{u'(x)} \\, \\mathrm{d}x = \\int_{0}^{1} |u'(x)|^2 \\, \\mathrm{d}x\n    $$\n    这是一个实的非负量。由于对于非平凡特征函数 $u$，$\\langle u, u \\rangle = \\int_{0}^{1} |u(x)|^2 \\, \\mathrm{d}x  0$ 成立，因此 $\\lambda = \\frac{\\int_{0}^{1} |u'(x)|^2 \\, \\mathrm{d}x}{\\int_{0}^{1} |u(x)|^2 \\, \\mathrm{d}x}$ 必须是实数且非负。我们的直接计算证实了这一点。\n2.  特征函数的正交性：设 $(\\lambda_n, u_n)$ 和 $(\\lambda_m, u_m)$ 是两个特征对，且 $\\lambda_n \\neq \\lambda_m$。我们有 $Lu_n = \\lambda_n u_n$ 和 $Lu_m = \\lambda_m u_m$。由于 $L$ 的自伴性：\n    $$\n    \\langle Lu_n, u_m \\rangle = \\langle u_n, Lu_m \\rangle\n    $$\n    代入特征值关系并利用特征值为实数的事实：\n    $$\n    \\langle \\lambda_n u_n, u_m \\rangle = \\langle u_n, \\lambda_m u_m \\rangle \\implies \\lambda_n \\langle u_n, u_m \\rangle = \\lambda_m \\langle u_n, u_m \\rangle\n    $$\n    这得到 $(\\lambda_n - \\lambda_m) \\langle u_n, u_m \\rangle = 0$。因为 $\\lambda_n \\neq \\lambda_m$，我们必有 $\\langle u_n, u_m \\rangle = 0$。因此，特征函数在 $L^2(0,1)$ 中是正交的。\n3.  完备性：Sturm-Liouville 理论的一个核心定理指出，一个正则 Sturm-Liouville 问题的特征函数集构成了该区间上希尔伯特空间 $L^2$ 的一个完备正交基。由于我们的问题是一个正则 Sturm-Liouville 问题，因此特征函数集 $\\{u_n(x) = \\sin(n\\pi x)\\}_{n \\ge 1}$ 是 $L^2(0,1)$ 的一个完备基。\n\n第2部分：傅里叶正弦展开系数\n\n我们希望求出函数 $f(x) = x$ 在特征函数基 $\\{u_n\\}_{n \\ge 1}$ 中的展开系数 $b_n$。所提供的公式为 $b_n = \\frac{\\langle f, u_n \\rangle}{\\langle u_n, u_n \\rangle}$。\n\n首先，我们计算分母，即特征函数 $u_n(x) = \\sin(n\\pi x)$ 的 $L^2$-范数的平方：\n$$\n\\langle u_n, u_n \\rangle = \\int_{0}^{1} \\sin^2(n\\pi x) \\, \\mathrm{d}x = \\int_{0}^{1} \\frac{1 - \\cos(2n\\pi x)}{2} \\, \\mathrm{d}x = \\frac{1}{2} \\left[ x - \\frac{\\sin(2n\\pi x)}{2n\\pi} \\right]_{0}^{1} = \\frac{1}{2} (1 - 0) = \\frac{1}{2}\n$$\n\n接下来，我们计算分子，即 $f(x)=x$ 在 $u_n(x)$ 上的投影：\n$$\n\\langle f, u_n \\rangle = \\int_{0}^{1} x \\sin(n\\pi x) \\, \\mathrm{d}x\n$$\n使用分部积分法，令 $u=x$ 且 $dv = \\sin(n\\pi x)dx$：\n$$\n\\int_{0}^{1} x \\sin(n\\pi x) \\, \\mathrm{d}x = \\left[ x \\left(-\\frac{\\cos(n\\pi x)}{n\\pi}\\right) \\right]_{0}^{1} - \\int_{0}^{1} \\left(-\\frac{\\cos(n\\pi x)}{n\\pi}\\right) \\, \\mathrm{d}x\n$$\n$$\n= \\left( -\\frac{1 \\cdot \\cos(n\\pi)}{n\\pi} - 0 \\right) + \\frac{1}{n\\pi} \\int_{0}^{1} \\cos(n\\pi x) \\, \\mathrm{d}x\n$$\n$$\n= -\\frac{(-1)^n}{n\\pi} + \\frac{1}{n\\pi} \\left[ \\frac{\\sin(n\\pi x)}{n\\pi} \\right]_{0}^{1} = \\frac{(-1)^{n+1}}{n\\pi} + \\frac{1}{(n\\pi)^2}(\\sin(n\\pi) - \\sin(0)) = \\frac{(-1)^{n+1}}{n\\pi}\n$$\n\n现在我们将分子和分母结合起来求 $b_n$：\n$$\nb_n = \\frac{\\frac{(-1)^{n+1}}{n\\pi}}{\\frac{1}{2}} = \\frac{2(-1)^{n+1}}{n\\pi}\n$$\n\n第3部分：使用帕塞瓦尔恒等式计算级数和\n\n问题要求计算级数和 $S = \\sum_{n=1}^{\\infty} \\frac{1}{2}\\,b_{n}^{2}$。我们需要使用帕塞瓦尔恒等式。对于一个在完备正交基 $\\{u_n\\}$ 中展开为 $f(x) = \\sum_{n=1}^{\\infty} c_n u_n(x)$ 的函数 $f$（其中 $c_n = \\frac{\\langle f, u_n \\rangle}{\\langle u_n, u_n \\rangle}$），帕塞瓦尔恒等式表述为：\n$$\n\\langle f, f \\rangle = \\sum_{n=1}^{\\infty} |c_n|^2 \\langle u_n, u_n \\rangle\n$$\n在我们的例子中，$f(x)=x$，系数为 $b_n=c_n$，且特征函数是实数。该恒等式变为：\n$$\n\\int_{0}^{1} (f(x))^2 \\, \\mathrm{d}x = \\sum_{n=1}^{\\infty} b_n^2 \\langle u_n, u_n \\rangle\n$$\n代入已知值 $f(x)=x$ 和 $\\langle u_n, u_n \\rangle = 1/2$：\n$$\n\\int_{0}^{1} x^2 \\, \\mathrm{d}x = \\sum_{n=1}^{\\infty} b_n^2 \\left(\\frac{1}{2}\\right)\n$$\n右边恰好是我们要求解的级数和 $S$。因此，$S$ 的值由左边的积分给出。\n$$\nS = \\int_{0}^{1} x^2 \\, \\mathrm{d}x = \\left[ \\frac{x^3}{3} \\right]_{0}^{1} = \\frac{1^3}{3} - \\frac{0^3}{3} = \\frac{1}{3}\n$$\n该无穷级数的精确值为 $1/3$。", "answer": "$$\n\\boxed{\\frac{1}{3}}\n$$", "id": "3379345"}, {"introduction": "在掌握了理论基础之后，下一步便是着手实现一个数值求解器。切比雪夫配置法（Chebyshev collocation method）是一种高效且精确的谱方法，它通过在特定的网格点上强制满足控制方程来求解问题。这项练习将引导您为一个包含狄利克雷（Dirichlet）和诺伊曼（Neumann）混合边界条件的问题实现此方法。这项实践连接了理论与编程，您将学习如何构建一个可用的谱方法求解器，并掌握在现代科学计算中至关重要的验证技术——“人造解验证法”（Method of Manufactured Solutions）。[@problem_id:3379366]", "problem": "考虑区间 $(0,1)$ 上的一维泊松方程 $-\\Delta u = f$，其中 $\\Delta$ 表示关于 $x$ 的二阶导数算子，服从混合边界条件：在 $x=0$ 处为狄利克雷（Dirichlet）边界条件，在 $x=1$ 处为诺伊曼（Neumann）边界条件。具体来说，施加 $u(0) = g_D$ 和 $\\partial_x u(1) = g_N$。目标是构造解析解 $u$ 及其相应的右端项 $f$，使用 Chebyshev 配点法在 Chebyshev–Gauss–Lobatto 点上对问题进行离散化，并数值验证谱（指数）收敛性。\n\n必须遵循谱配点法的基本定义。使用 $[-1,1]$ 上的 Chebyshev–Gauss–Lobatto 点 $\\{\\xi_j\\}_{j=0}^N$，其由 $\\xi_j = \\cos\\left(\\frac{\\pi j}{N}\\right)$ 给出，以及 $[-1,1]$ 上的标准 Chebyshev 微分矩阵 $D$，其由经过充分检验的显式公式定义，元素为\n$$D_{ij} = \\begin{cases} \\frac{c_i}{c_j}\\frac{(-1)^{i+j}}{\\xi_i - \\xi_j},  \\text{for } i \\neq j, \\\\ -\\sum_{k \\neq i} D_{ik},  \\text{for } i=j, \\end{cases}$$\n其中 $c_0 = 2$, $c_N = 2$，对于 $j=1,\\dots,N-1$，$c_j = 1$。使用 $x = \\frac{\\xi+1}{2}$ 映射计算域，使得 $\\xi = -1$ 对应于 $x=0$，$\\xi=1$ 对应于 $x=1$。在此映射下，$d/dx = 2\\,d/d\\xi$ 且 $d^2/dx^2 = 4\\,d^2/d\\xi^2$。将关于 $x$ 的离散二阶导数算子构建为 $D^{(2)}_x = 4 D^2$。\n\n按如下方式构建配点线性系统。对于内部配点（$j=1,\\dots,N-1$），使用 $-D^{(2)}_x u = f$ 来施加强形式 $-u''(x_j) = f(x_j)$。在右端点（$j=0$，对应于 $x=1$），使用离散算子 $2 D u = g_N$ 施加诺伊曼（Neumann）边界条件 $\\partial_x u(1) = g_N$。在左端点（$j=N$，对应于 $x=0$），通过将相应行替换为单位约束来施加狄利克雷（Dirichlet）边界条件 $u(0) = g_D$。\n\n所有三角函数的角度必须以弧度为单位指定。\n\n构造的解析解：\n- 选择 $u_1(x) = e^{x} \\sin(2\\pi x)$，其 $f_1(x) = -u_1''(x)$，边界数据为 $g_{D,1} = u_1(0)$ 和 $g_{N,1} = u_1'(1)$。\n- 选择 $u_2(x) = \\cosh(3x) + \\cos(5x)$，其 $f_2(x) = -u_2''(x)$，边界数据为 $g_{D,2} = u_2(0)$ 和 $g_{N,2} = u_2'(1)$。\n\n验证目标：\n- 对于解析解 $u$，Chebyshev 配点法预期产生的误差会随 $N$ 呈指数衰减。通过为一系列 $N$ 值计算 $\\log_{10}(\\text{误差})$ 相对于 $N$ 的最小二乘斜率 $b$ 和决定系数 $R^2$ 来对此进行量化。指数收敛在数值上表现为显著的负斜率 $b  0$ 和接近于 $1$ 的高 $R^2$ 值。\n\n误差定义：\n- 在配点网格上使用逐点最大范数：$\\|e\\|_{\\infty} = \\max_j |u_{\\text{num}}(x_j) - u_{\\text{exact}}(x_j)|$。\n\n测试套件和要求输出：\n- 测试用例 $\\mathsf{A}$ (理想情况)：使用 $u_1$ 和 $N \\in \\{8,16,32,64\\}$。计算 $y = \\log_{10}(\\|e\\|_{\\infty})$ 相对于 $N$ 的最小二乘斜率 $b_{\\mathsf{A}}$ 和 $R^2_{\\mathsf{A}}$，并报告最大 $N=64$ 时的 $\\|e\\|_{\\infty}$。\n- 测试用例 $\\mathsf{B}$ (备选解析解)：使用 $u_2$ 和 $N \\in \\{6,12,24,48\\}$。计算 $b_{\\mathsf{B}}$、$R^2_{\\mathsf{B}}$。\n- 测试用例 $\\mathsf{C}$ (边界条件验证)：对于 $u_1$ 和 $N=32$，使用离散算子计算边界上的绝对残差，即 $r_D = |u_{\\text{num}}(0) - g_{D,1}|$ 和 $r_N = |\\partial_x u_{\\text{num}}(1) - g_{N,1}|$，其中 $\\partial_x u_{\\text{num}}(1)$ 在右端点行上计算为 $2\\,D u$。\n- 测试用例 $\\mathsf{D}$ (边缘情况小 $N$)：对于 $u_1$ 和 $N=4$，计算最大范数误差 $\\|e\\|_{\\infty}$。\n\n您的程序必须数值组装和求解配点线性系统，并按此确切顺序生成单行输出，其中包含一个由方括号括起的逗号分隔列表，内含以下八个结果：\n$$[b_{\\mathsf{A}}, R^2_{\\mathsf{A}}, \\|e\\|_{\\infty}\\text{ at }N=64, b_{\\mathsf{B}}, R^2_{\\mathsf{B}}, r_D, r_N, \\|e\\|_{\\infty}\\text{ at }N=4].$$\n所有值必须是实数。$\\sin$ 和 $\\cos$ 中的角度必须是弧度。由于所有量都是无量纲的，因此不需要单位。最终输出必须是确切要求格式的单行。", "solution": "此问题是有效的。它提出了一个清晰、独立且科学上合理的任务：使用 Chebyshev 配点谱方法求解带混合边界条件的一维泊松方程。该方法论，包括使用构造解进行验证，是计算科学与工程领域的标准实践。所有需要的数据、定义和步骤都已明确说明，没有歧义或矛盾。\n\n该方法的核心是在一组配点上对微分方程和边界条件进行离散化，将问题转化为一个线性代数方程组。然后通过求解该方程组获得解。\n\n首先，我们定义计算域和物理域。问题指定物理域为区间 $x \\in [0, 1]$。我们使用一个标准的仿射映射将其关联到标准 Chebyshev 域 $\\xi \\in [-1, 1]$：\n$$x(\\xi) = \\frac{\\xi + 1}{2}$$\n配点是 Chebyshev-Gauss-Lobatto (CGL) 点，由 $\\xi_j = \\cos\\left(\\frac{\\pi j}{N}\\right)$ 给出，其中 $j=0, 1, \\dots, N$。请注意，在此标准索引下，$\\xi_0=1$ 对应于 $x=1$，$\\xi_N=-1$ 对应于 $x=0$。\n\n关于 $x$ 的导数通过链式法则与关于 $\\xi$ 的导数相关联：\n$$ \\frac{d}{dx} = \\frac{d\\xi}{dx} \\frac{d}{d\\xi} = 2 \\frac{d}{d\\xi} $$\n$$ \\frac{d^2}{dx^2} = 4 \\frac{d^2}{d\\xi^2} $$\n在谱配点法中，微分是通过矩阵-向量乘法来执行的。我们在 CGL 网格 $\\{\\xi_j\\}$ 上构建 $(N+1) \\times (N+1)$ 的 Chebyshev 微分矩阵 $D$。问题为其元素 $D_{ij}$ 提供了显式公式。物理域中的离散一阶和二阶导数算子 $D^{(1)}_x$ 和 $D^{(2)}_x$ 则由以下公式给出：\n$$ D^{(1)}_x = 2D $$\n$$ D^{(2)}_x = 4D^2 $$\n\n任务是找到一个近似解值向量 $U$，$U_j \\approx u(x_j)$，其位于配点 $x_j = x(\\xi_j)$ 上。该向量是线性系统 $A U = b$ 的解，其中矩阵 $A$ 和向量 $b$ 在配点上施加控制方程和边界条件。\n\n该系统构建如下：\n1.  **内部点 ($j=1, \\dots, N-1$):** 在这些点上，我们施加泊松方程 $-\\Delta u = f$，即 $-u''(x_j) = f(x_j)$。其离散形式为 $-[D^{(2)}_x U]_j = f(x_j)$。这些方程填充了系统 $A U = b$ 的第 $1$ 行到第 $N-1$ 行。\n2.  **$x=1$ 处的诺伊曼边界 ($j=0$):** 在此点，我们施加条件 $\\partial_x u(1) = g_N$。其离散形式为 $[D^{(1)}_x U]_0 = g_N$。该方程填充了系统的第 $0$ 行。\n3.  **$x=0$ 处的狄利克雷边界 ($j=N$):** 在此点，我们施加 $u(0) = g_D$。这是通过直接设置未知数的值 $U_N = g_D$ 来实现的。施加方式是将矩阵 $A$ 的第 $N$ 行替换为一个单位行（除第 $N$ 列为 $1$ 外全为零），并将右端向量 $b$ 的相应元素设置为 $g_D$。\n\n在组装 $(N+1) \\times (N+1)$ 矩阵 $A$ 和右端向量 $b$ 之后，使用标准线性求解器求解系统 $A U = b$ 以获得未知向量 $U$。\n\n为了验证该方法，我们使用构造解法。我们选择一个光滑函数 $u(x)$，然后推导出相应的源项 $f(x) = -u''(x)$ 以及边界数据 $g_D = u(0)$ 和 $g_N=u'(1)$。然后可以将数值解 $U$ 与在配点上求值的已知精确解 $u(x)$ 进行比较。对于解析解 $u(x)$，谱方法预期会表现出指数收敛性，即误差 $\\|e\\|_\\infty = \\max_j |U_j - u(x_j)|$ 会随 $N$ 指数衰减。通过观察 $\\log_{10}(\\|e\\|_\\infty)$ 近似为 $N$ 的线性函数来验证这一点。我们通过执行最小二乘线性回归来量化这种关系，以找到斜率 $b$ 和决定系数 $R^2$。一个大的负斜率和一个接近 $1$ 的 $R^2$ 值证实了指数收敛性。\n\n指定的测试用例涉及两种不同的构造解、收敛性度量的计算、边界条件残差的检查，以及对小 $N$ 值的误差评估。边界残差 $r_D = |u_{\\text{num}}(0) - g_D|$ 和 $r_N = |\\partial_x u_{\\text{num}}(1) - g_N|$ 作为一项合理性检查，以确保线性系统正确施加了边界条件。鉴于所用的施加方法，这些残差预期会接近机器精度。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n# from scipy import ...\n\ndef linear_regression(x_data, y_data):\n    \"\"\"\n    Performs a linear regression y = a + b*x and calculates R^2.\n    \"\"\"\n    x_data = np.asarray(x_data)\n    y_data = np.asarray(y_data)\n\n    # Use numpy.polyfit to get slope and intercept\n    slope, intercept = np.polyfit(x_data, y_data, 1)\n    \n    # Calculate R-squared value\n    y_mean = np.mean(y_data)\n    y_predicted = slope * x_data + intercept\n    ss_total = np.sum((y_data - y_mean)**2)\n    ss_residual = np.sum((y_data - y_predicted)**2)\n    \n    if ss_total == 0:\n        # Handle case where all y_data points are the same\n        r_squared = 1.0 if ss_residual == 0 else 0.0\n    else:\n        r_squared = 1.0 - (ss_residual / ss_total)\n        \n    return slope, r_squared\n\ndef chebyshev_diff_matrix(N):\n    \"\"\"\n    Constructs the Chebyshev differentiation matrix D on N+1 CGL points.\n    \"\"\"\n    if N == 0:\n        return np.zeros((1, 1))\n    \n    j = np.arange(N + 1)\n    xi = np.cos(np.pi * j / N)\n    \n    c = np.ones(N + 1)\n    c[0] = 2.\n    c[N] = 2.\n    \n    # Off-diagonal entries\n    c_i = c[:, np.newaxis]\n    c_j = c[np.newaxis, :]\n    xi_i = xi[:, np.newaxis]\n    xi_j = xi[np.newaxis, :]\n    d_xi = xi_i - xi_j\n    \n    signs = (-1)**(np.arange(N + 1)[:, np.newaxis] + np.arange(N + 1)[np.newaxis, :])\n    \n    D = (c_i / c_j) * signs / (d_xi + np.eye(N + 1))\n    np.fill_diagonal(D, 0.)\n    \n    # Diagonal entries\n    np.fill_diagonal(D, -np.sum(D, axis=1))\n    \n    return D\n\ndef solve_poisson_1d(N, u_func, f_func, g_D_val, g_N_val):\n    \"\"\"\n    Solves the 1D Poisson BVP using Chebyshev collocation.\n    \"\"\"\n    j = np.arange(N + 1)\n    xi = np.cos(np.pi * j / N)\n    x = (xi + 1.0) / 2.0\n    \n    D = chebyshev_diff_matrix(N)\n    D1x = 2.0 * D\n    D2x = 4.0 * np.dot(D, D)\n\n    A = np.zeros((N + 1, N + 1))\n    b = np.zeros(N + 1)\n    \n    # Interior points: -u'' = f\n    A[1:N, :] = -D2x[1:N, :]\n    b[1:N] = f_func(x[1:N])\n    \n    # Neumann BC at x=1 (j=0)\n    A[0, :] = D1x[0, :]\n    b[0] = g_N_val\n    \n    # Dirichlet BC at x=0 (j=N)\n    A[N, :] = 0.0\n    A[N, N] = 1.0\n    b[N] = g_D_val\n    \n    U_num = np.linalg.solve(A, b)\n    U_exact = u_func(x)\n    \n    error = np.max(np.abs(U_num - U_exact))\n    \n    return {\n        \"error\": error,\n        \"U_num\": U_num,\n        \"D1x\": D1x,\n    }\n\ndef solve():\n    \"\"\"\n    Main function to execute all test cases and print results.\n    \"\"\"\n    # Manufactured solution 1\n    u1 = lambda x: np.exp(x) * np.sin(2. * np.pi * x)\n    u1_prime = lambda x: np.exp(x) * (np.sin(2. * np.pi * x) + 2. * np.pi * np.cos(2. * np.pi * x))\n    f1 = lambda x: -np.exp(x) * ( (1. - 4. * np.pi**2) * np.sin(2. * np.pi * x) + 4. * np.pi * np.cos(2. * np.pi * x) )\n    g_D1 = u1(0.0)\n    g_N1 = u1_prime(1.0)\n\n    # Manufactured solution 2\n    u2 = lambda x: np.cosh(3. * x) + np.cos(5. * x)\n    u2_prime = lambda x: 3. * np.sinh(3. * x) - 5. * np.sin(5. * x)\n    f2 = lambda x: -(9. * np.cosh(3. * x) - 25. * np.cos(5. * x))\n    g_D2 = u2(0.0)\n    g_N2 = u2_prime(1.0)\n    \n    # Test case A: u1, N = {8, 16, 32, 64}\n    Ns_A = np.array([8, 16, 32, 64])\n    errors_A = []\n    for N in Ns_A:\n        result = solve_poisson_1d(N, u1, f1, g_D1, g_N1)\n        errors_A.append(result[\"error\"])\n    log_errors_A = np.log10(np.array(errors_A))\n    b_A, R2_A = linear_regression(Ns_A, log_errors_A)\n    error_N64_A = errors_A[-1]\n\n    # Test case B: u2, N = {6, 12, 24, 48}\n    Ns_B = np.array([6, 12, 24, 48])\n    errors_B = []\n    for N in Ns_B:\n        result = solve_poisson_1d(N, u2, f2, g_D2, g_N2)\n        errors_B.append(result[\"error\"])\n    log_errors_B = np.log10(np.array(errors_B))\n    b_B, R2_B = linear_regression(Ns_B, log_errors_B)\n    \n    # Test case C: u1, N=32, boundary residuals\n    N_C = 32\n    result_C = solve_poisson_1d(N_C, u1, f1, g_D1, g_N1)\n    U_num_C = result_C[\"U_num\"]\n    D1x_C = result_C[\"D1x\"]\n    # Dirichlet residual at x=0 (index N)\n    r_D = np.abs(U_num_C[-1] - g_D1)\n    # Neumann residual at x=1 (index 0)\n    du_dx_at_1_num = (D1x_C @ U_num_C)[0]\n    r_N = np.abs(du_dx_at_1_num - g_N1)\n    \n    # Test case D: u1, N=4, error\n    N_D = 4\n    result_D = solve_poisson_1d(N_D, u1, f1, g_D1, g_N1)\n    error_N4_D = result_D[\"error\"]\n    \n    final_results = [b_A, R2_A, error_N64_A, b_B, R2_B, r_D, r_N, error_N4_D]\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, final_results))}]\")\n\nsolve()\n```", "id": "3379366"}, {"introduction": "许多高级数值框架，特别是伽辽金（Galerkin）类型的谱元法和间断伽辽金方法，其理论和实现通常是针对齐次边界条件设计的。为了处理非齐次狄利克雷（Dirichlet）边界条件，一种标准技巧是将解分解为一个满足非齐次条件的已知“提升函数”（lifting function）和一个满足相应齐次条件的新未知函数之和。这项练习旨在介绍这种至关重要的提升技术，它能将复杂问题转化为更易于处理的标准形式，这是将先进数值方法应用于包含狄利克雷、诺伊曼和罗宾（Robin）边界条件的实际问题的关键一步。[@problem_id:3379353]", "problem": "考虑一个在方形参考谱元上的具有常数传导系数的二阶椭圆模型问题，其灵感来源于谱元法（SEM）和间断Galerkin（DG）方法中使用的多项式框架。设区域为 $\\Omega = [-1,1] \\times [-1,1]$，并考虑方程 $-\\nabla \\cdot (\\kappa \\nabla u) = f$ 在 $\\Omega$ 中，其边界分解为 $\\partial \\Omega = \\Gamma_{D} \\cup \\Gamma_{N} \\cup \\Gamma_{R}$，其中 $\\Gamma_{D} = \\{(x,y) \\in \\partial \\Omega : y = 1\\}$，$\\Gamma_{N} = \\{(x,y) \\in \\partial \\Omega : y = -1\\}$，以及 $\\Gamma_{R} = \\{(x,y) \\in \\partial \\Omega : x = \\pm 1\\}$。边界条件在 $\\Gamma_{D}$ 上为非齐次狄利克雷条件，在 $\\Gamma_{N}$ 上为齐次诺伊曼条件，在 $\\Gamma_{R}$ 上为齐次罗宾条件，即：在 $\\Gamma_{D}$ 上有 $u = g$，在 $\\Gamma_{N}$ 上有 $\\kappa \\nabla u \\cdot n = 0$，在 $\\Gamma_{R}$ 上有 $\\kappa \\nabla u \\cdot n + \\beta u = 0$，其中 $\\beta  0$ 为常数，n 为单位外法向量。假设 $\\kappa  0$ 是一个均匀标量。\n\n在谱元法和对称内罚间断Galerkin（SIPDG）方法中，一个标准技巧是构造一个提升函数，该函数强制施加非齐次狄利克雷数据，同时对于变换后的未知量，保持其他边界段（诺伊曼和罗宾）的齐次形式。从强形式和作为弱形式基础的基本分部积分恒等式出发，考虑分解 $u = v + w$，其中 w 是一个提升函数，它精确地在 $\\Gamma_{D}$ 上施加狄利克雷条件，并且其选择使得代入 $u = v + w$ 后，能在 $\\Gamma_{N}$ 和 $\\Gamma_{R}$ 上分别保持 v 的齐次诺伊曼和罗宾条件。函数 v 随后在区域内部满足一个具有修正右端项的同类型方程。\n\n设非齐次狄利克雷数据为谱多项式 $g(x) = (1 - x^{2})^{2}$ on $\\Gamma_{D}$，并构造一个张量积形式的提升函数 $w(x,y) = g(x) \\, b(y)$，其中 $b(y)$ 是满足 $w(x,1) = g(x)$、在 $\\Gamma_{N}$ 上 $\\nabla w \\cdot n = 0$、以及在 $\\Gamma_{R}$ 上 $w = 0$ 和 $\\nabla w \\cdot n = 0$（这样无论 $\\beta$ 取何值，v 的齐次罗宾条件都得以保持）的最低次数多项式。从第一性原理（强形式方程和边界条件）出发，推导 v 所满足的变换后的内部方程，并计算在体积右端项上引起的显式修正，即函数 $\\delta f(x,y)$，使得在 $\\Omega$ 中有 $-\\nabla \\cdot (\\kappa \\nabla v) = f + \\delta f$。\n\n请提供 $\\delta f(x,y)$ 关于 $x$、$y$ 和 $\\kappa$ 的精确、闭式解析表达式。您的最终答案必须是单一的闭式表达式。无需进行数值舍入。如果出现任何角度，请以弧度表示。", "solution": "用户希望我解决以下问题。\n问题在于，当将一个具有非齐次狄利克雷数据的二阶椭圆问题转换为一个具有齐次数据的问题时，需要找到对右端项的修正 $\\delta f(x,y)$ 的显式表达式。这是通过引入一个提升函数 $w(x,y)$ 来实现的。\n\n原始问题定义在区域 $\\Omega = [-1,1] \\times [-1,1]$ 上：\n$$-\\nabla \\cdot (\\kappa \\nabla u) = f$$\n其中常数传导系数 $\\kappa  0$。边界条件为：\n在 $\\Gamma_{D} = \\{(x,y) \\in \\partial \\Omega : y = 1\\}$ 上，$u = g$。\n在 $\\Gamma_{N} = \\{(x,y) \\in \\partial \\Omega : y = -1\\}$ 上，$\\kappa \\nabla u \\cdot n = 0$。\n在 $\\Gamma_{R} = \\{(x,y) \\in \\partial \\Omega : x = \\pm 1\\}$ 上，$\\kappa \\nabla u \\cdot n + \\beta u = 0$。\n\n我们使用分解 $u = v + w$，其中 w 是提升函数。目标是找到满足形式为 $-\\nabla \\cdot (\\kappa \\nabla v) = f + \\delta f$ 的方程和齐次边界条件的 v。\n\n首先，我们必须确定提升函数 $w(x,y)$。问题陈述其形式为 $w(x,y) = g(x) b(y)$，其中 $g(x) = (1 - x^{2})^{2}$，$b(y)$ 是一个最低次数的多项式。对 w 的条件如下：\n1.  $w(x,1) = g(x)$ 以施加狄利克雷条件。\n2.  在 $\\Gamma_{N}$ 上 $\\nabla w \\cdot n = 0$ 以保持 v 的齐次诺伊曼条件。\n3.  在 $\\Gamma_R$ 上 $w = 0$ 且 $\\nabla w \\cdot n = 0$ 以保持 v 的齐次罗宾条件。\n\n让我们将这些关于 w 的条件转化为关于多项式 $b(y)$ 的条件。\n\n条件 1：在 $\\Gamma_D$ ($y=1$) 上，$w(x,1) = g(x)b(1)$。为使其等于 $g(x)$，我们必须有：\n$$b(1) = 1$$\n\n条件 2：在 $\\Gamma_N$ ($y=-1$) 上，单位外法向量为 $n = (0, -1)$。条件是 $\\nabla w \\cdot n = 0$。\n$$\\nabla w = \\left( \\frac{\\partial w}{\\partial x}, \\frac{\\partial w}{\\partial y} \\right) = \\left( \\frac{dg}{dx} b(y), g(x) \\frac{db}{dy} \\right)$$\n$$\\nabla w \\cdot n = - \\frac{\\partial w}{\\partial y} = -g(x) \\frac{db}{dy}$$\n在 $y=-1$ 处求值，我们需要对所有 $x \\in [-1,1]$ 都有 $-g(x) \\frac{db}{dy}(-1) = 0$。由于 $g(x)$ 不恒为零，这要求：\n$$\\frac{db}{dy}(-1) = 0 \\quad \\text{或} \\quad b'(-1) = 0$$\n\n条件 3：在 $\\Gamma_R$ ($x=\\pm 1$) 上，单位外法向量在 $x=1$ 时为 $n = (1, 0)$，在 $x=-1$ 时为 $n = (-1, 0)$。\n在 $\\Gamma_R$ 上 $w=0$ 的条件意味着 $w(\\pm 1, y) = g(\\pm 1) b(y) = (1 - (\\pm 1)^2)^2 b(y) = 0 \\cdot b(y) = 0$。由于 $g(x)$ 的选择，这个条件对任何 $b(y)$ 都自动满足。\n在 $\\Gamma_R$ 上 $\\nabla w \\cdot n = 0$ 的条件：\n在 $x=1$ 处，$\\nabla w \\cdot n = \\frac{\\partial w}{\\partial x}(1,y) = \\frac{dg}{dx}(1) b(y)$。\n在 $x=-1$ 处，$\\nabla w \\cdot n = -\\frac{\\partial w}{\\partial x}(-1,y) = -\\frac{dg}{dx}(-1) b(y)$。\n由于 $g(x)=(1-x^2)^2$，其导数为 $g'(x) = 2(1-x^2)(-2x) = -4x(1-x^2)$。因此，$g'(\\pm 1)=0$。这个条件对任何 $b(y)$ 也自动满足。\n问题陈述，在 $\\Gamma_R$ 上的这些条件确保 v 的罗宾条件是齐次的，而与 $\\beta$ 无关。让我们验证一下：\n$\\kappa \\nabla u \\cdot n + \\beta u = \\kappa \\nabla(v+w)\\cdot n + \\beta(v+w) = (\\kappa \\nabla v \\cdot n + \\beta v) + (\\kappa \\nabla w \\cdot n + \\beta w)$。\n要使其等于 $\\kappa \\nabla v \\cdot n + \\beta v$，我们需要在 $\\Gamma_R$ 上有 $\\kappa \\nabla w \\cdot n + \\beta w = 0$。根据我们的检查，在 $\\Gamma_R$ 上 $w$ 和 $\\nabla w \\cdot n$ 均为零，因此 $\\kappa(0)+\\beta(0)=0$ 得到满足。\n\n我们需要找到满足 $b(1)=1$ 和 $b'(-1)=0$ 的最低次数多项式 $b(y)$。这两个条件不足以唯一确定一个次数大于0的多项式。必须在标准数值方法的背景下解释这个问题。提升函数的一个典型要求是，它们仅在具有非齐次数据的边界段上非零，而在其他边界段上为零。这避免了引入虚假的边界值。这意味着一个附加条件：在 $\\Gamma_N$ 上 $w(x,-1)=0$。这转化为 $g(x)b(-1)=0$，意味着 $b(-1)=0$。\n\n因此，我们寻找满足以下三个条件的最低次数多项式 $b(y)$：\n(i) $b(1)=1$\n(ii) $b(-1)=0$\n(iii) $b'(-1)=0$\n\n条件 (ii) 和 (iii) 意味着 $b(y)$ 在 $y=-1$ 处有一个二重根。因此，$b(y)$ 必须包含因子 $(y+1)^2$。最低次数的形式是 $b(y) = C(y+1)^2$，其中 C 为某个常数。\n使用条件 (i) 来求 C：\n$b(1) = C(1+1)^2 = 4C = 1 \\implies C = \\frac{1}{4}$。\n满足这些标准提升条件的最低次数多项式是二次多项式：\n$$b(y) = \\frac{1}{4}(y+1)^2$$\n因此，提升函数是：\n$$w(x,y) = g(x) b(y) = (1-x^2)^2 \\frac{1}{4}(y+1)^2$$\n\n接下来，我们推导 v 的方程。我们将 $u = v+w$ 代入原始的偏微分方程（PDE）：\n$$-\\nabla \\cdot (\\kappa \\nabla (v+w)) = f$$\n$$-\\nabla \\cdot (\\kappa \\nabla v) - \\nabla \\cdot (\\kappa \\nabla w) = f$$\n整理得到 v 的方程：\n$$-\\nabla \\cdot (\\kappa \\nabla v) = f + \\nabla \\cdot (\\kappa \\nabla w)$$\n通过与形式 $-\\nabla \\cdot (\\kappa \\nabla v) = f + \\delta f$ 比较，我们确定修正项为：\n$$\\delta f(x,y) = \\nabla \\cdot (\\kappa \\nabla w)$$\n由于 $\\kappa$ 是一个常数标量，这可以简化为：\n$$\\delta f(x,y) = \\kappa \\nabla^2 w = \\kappa \\left( \\frac{\\partial^2 w}{\\partial x^2} + \\frac{\\partial^2 w}{\\partial y^2} \\right)$$\n我们现在计算 $w(x,y)$ 的二阶偏导数。\n设 $g(x) = (1-x^2)^2$ 且 $h(y) = \\frac{1}{4}(y+1)^2$。则 $w(x,y) = g(x)h(y)$。\n拉普拉斯算子是 $\\nabla^2 w = \\frac{d^2 g}{dx^2} h(y) + g(x) \\frac{d^2 h}{dy^2}$。\n\n首先，是关于 x 的导数：\n$g(x) = (1-x^2)^2 = 1 - 2x^2 + x^4$\n$\\frac{dg}{dx} = -4x + 4x^3$\n$\\frac{d^2g}{dx^2} = -4 + 12x^2$\n\n其次，是关于 y 的导数：\n$h(y) = \\frac{1}{4}(y+1)^2 = \\frac{1}{4}(y^2+2y+1)$\n$\\frac{dh}{dy} = \\frac{1}{4}(2y+2) = \\frac{1}{2}(y+1)$\n$\\frac{d^2h}{dy^2} = \\frac{1}{2}$\n\n现在，我们组合 w 的拉普拉斯算子：\n$$\\nabla^2 w = \\left( 12x^2 - 4 \\right) h(y) + g(x) \\left( \\frac{1}{2} \\right)$$\n$$\\nabla^2 w = \\left( 12x^2 - 4 \\right) \\frac{1}{4}(y+1)^2 + (1-x^2)^2 \\frac{1}{2}$$\n$$\\nabla^2 w = (3x^2 - 1)(y+1)^2 + \\frac{1}{2}(1-x^2)^2$$\n\n最后，我们写出 $\\delta f(x,y)$ 的表达式：\n$$\\delta f(x,y) = \\kappa \\nabla^2 w = \\kappa \\left[ (3x^2-1)(y+1)^2 + \\frac{1}{2}(1-x^2)^2 \\right]$$\n这就是对右端项修正的最终闭式解析表达式。", "answer": "$$\n\\boxed{\\kappa \\left[ (3x^2-1)(y+1)^2 + \\frac{1}{2}(1-x^2)^2 \\right]}\n$$", "id": "3379353"}]}