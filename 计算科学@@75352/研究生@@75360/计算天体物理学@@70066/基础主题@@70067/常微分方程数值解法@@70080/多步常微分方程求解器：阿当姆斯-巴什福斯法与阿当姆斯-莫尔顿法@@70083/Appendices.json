{"hands_on_practices": [{"introduction": "在数值积分方法中，我们经常会遇到像四阶Adams-Bashforth（AB4）方法这样包含一系列特定系数的公式。这些系数并非随意设定，而是源于坚实的数学基础。本练习将引导你从第一性原理出发，通过拉格朗日多项式插值来推导AB4方法的系数，从而揭示该方法如何利用历史数据点来外推预测未来状态[@problem_id:3523827]。这个过程将加深你对多步法核心思想——以多项式近似导数函数——的理解。", "problem": "在计算天体物理学中，当力场计算开销较大但解足够光滑时，通常使用多步积分器来对光滑银河系势中的非相对论性测试粒子轨道进行时域积分。考虑常微分方程 (ODE) $y'(t) = f(t,y(t))$，其时间步长为恒定的 $h > 0$。我们使用一个4步线性多步显式 Adams-Bashforth (AB) 方法，该方法根据过去的右端项采样点 $f_{n-j} = f(t_{n-j}, y_{n-j})$（对于 $j \\in \\{0,1,2,3\\}$）来计算 $y_{n+1}$。\n\n从基本积分表示 $y(t_{n+1}) = y(t_n) + \\int_{t_n}^{t_{n+1}} f(\\tau, y(\\tau)) \\, d\\tau$ 出发，用穿过四个等距节点 $\\{t_n, t_{n-1}, t_{n-2}, t_{n-3}\\}$ 及其对应数据 $\\{f_n, f_{n-1}, f_{n-2}, f_{n-3}\\}$ 的唯一的3次 Lagrange 插值多项式来近似区间 $[t_n, t_{n+1}]$ 上的 $f(\\tau, y(\\tau))$。使用仿射变量变换 $s = (\\tau - t_n)/h$，使得 $\\tau \\in [t_n, t_{n+1}]$ 映射到 $s \\in [0,1]$，并且节点映射到 $\\{0, -1, -2, -3\\}$。\n\n通过对 $j \\in \\{0,1,2,3\\}$ 的 Lagrange 基多项式 $L_j(s)$ 在 $s \\in [0,1]$ 上积分，推导出显式 Adams-Bashforth 4步更新公式\n$$\ny_{n+1} = y_n + h \\sum_{j=0}^{3} b_j \\, f_{n-j},\n$$\n并计算系数 $b_0$、$b_1$、$b_2$ 和 $b_3$。通过直接构造 Lagrange 多项式并进行积分，验证这些系数与 Lagrange 积分产生的经典值相匹配。\n\n将最终系数表示为精确有理数，并按 $\\{b_0, b_1, b_2, b_3\\}$ 的顺序排列。无需四舍五入，最终答案中不应包含任何物理单位。", "solution": "该问题要求为求解形式为 $y'(t) = f(t, y(t))$ 的常微分方程 (ODE) 的4步显式 Adams-Bashforth (AB4) 方法推导其系数。\n\n推导始于微积分基本定理，它为在时间步长 $h = t_{n+1} - t_n$ 内从 $y(t_n)$ 到 $y(t_{n+1})$ 的更新提供了一个精确表达式：\n$$y(t_{n+1}) = y(t_n) + \\int_{t_n}^{t_{n+1}} f(\\tau, y(\\tau)) \\, d\\tau$$\nAdams-Bashforth 方法通过用一个插值多项式替换函数 $f(\\tau, y(\\tau))$ 来近似该积分。对于4步法，我们使用一个3次多项式，它穿过最近的四个数据点：$(t_n, f_n)$、$(t_{n-1}, f_{n-1})$、$(t_{n-2}, f_{n-2})$ 和 $(t_{n-3}, f_{n-3})$，其中 $f_k = f(t_k, y_k)$。这个多项式记为 $P_3(\\tau)$，是这些点的唯一 Lagrange 插值多项式。\n\n于是，$y_{n+1}$ 的数值近似由下式给出：\n$$y_{n+1} = y_n + \\int_{t_n}^{t_{n+1}} P_3(\\tau) \\, d\\tau$$\n为方便积分，我们引入仿射变量变换 $s = (\\tau - t_n)/h$。这意味着 $d\\tau = h \\, ds$。$\\tau$ 的积分区间 $[t_n, t_{n+1}]$ 映射为 $s$ 的积分区间 $[0, 1]$。新坐标系中的插值节点为：\n- $t_n \\rightarrow s = (t_n - t_n)/h = 0$\n- $t_{n-1} = t_n - h \\rightarrow s = ((t_n - h) - t_n)/h = -1$\n- $t_{n-2} = t_n - 2h \\rightarrow s = ((t_n - 2h) - t_n)/h = -2$\n- $t_{n-3} = t_n - 3h \\rightarrow s = ((t_n - 3h) - t_n)/h = -3$\n\nLagrange 插值多项式现在是 $s$ 的函数，表示为函数值 $f_{n-j}$ 和对应的 Lagrange 基多项式 $L_j(s)$ 的线性组合：\n$$P_3(s) = f_n L_0(s) + f_{n-1} L_1(s) + f_{n-2} L_2(s) + f_{n-3} L_3(s)$$\n此处，$L_j(s)$ 是对应于节点 $\\{s_0, s_1, s_2, s_3\\} = \\{0, -1, -2, -3\\}$ 的基多项式。积分为：\n$$\\int_{t_n}^{t_{n+1}} P_3(\\tau) \\, d\\tau = \\int_0^1 P_3(s) \\, h \\, ds = h \\int_0^1 \\left(\\sum_{j=0}^{3} f_{n-j} L_j(s)\\right) \\, ds = h \\sum_{j=0}^{3} f_{n-j} \\left( \\int_0^1 L_j(s) \\, ds \\right)$$\nAB4 更新规则的形式为 $y_{n+1} = y_n + h \\sum_{j=0}^{3} b_j f_{n-j}$。通过比较这两个表达式，我们可以将系数 $b_j$ 确定为 Lagrange 基多项式的定积分：\n$$b_j = \\int_0^1 L_j(s) \\, ds$$\n现在我们构造并积分每个基多项式。Lagrange 基多项式的一般形式为 $L_k(s) = \\prod_{i \\neq k} \\frac{s - s_i}{s_k - s_i}$。\n\n1.  **系数 $b_0$（与 $f_n$ 和节点 $s_0=0$ 相关联）：**\n    $L_0(s) = \\frac{(s - (-1))(s - (-2))(s - (-3))}{(0 - (-1))(0 - (-2))(0 - (-3))} = \\frac{(s+1)(s+2)(s+3)}{6} = \\frac{1}{6}(s^3 + 6s^2 + 11s + 6)$。\n    $b_0 = \\int_0^1 L_0(s) \\, ds = \\frac{1}{6} \\int_0^1 (s^3 + 6s^2 + 11s + 6) \\, ds = \\frac{1}{6} \\left[ \\frac{s^4}{4} + 2s^3 + \\frac{11s^2}{2} + 6s \\right]_0^1$。\n    $b_0 = \\frac{1}{6} \\left(\\frac{1}{4} + 2 + \\frac{11}{2} + 6 - 0 \\right) = \\frac{1}{6} \\left(\\frac{1}{4} + \\frac{8}{4} + \\frac{22}{4} + \\frac{24}{4}\\right) = \\frac{1}{6}\\left(\\frac{55}{4}\\right) = \\frac{55}{24}$。\n\n2.  **系数 $b_1$（与 $f_{n-1}$ 和节点 $s_1=-1$ 相关联）：**\n    $L_1(s) = \\frac{(s-0)(s-(-2))(s-(-3))}{(-1-0)(-1-(-2))(-1-(-3))} = \\frac{s(s+2)(s+3)}{(-1)(1)(2)} = -\\frac{1}{2}(s^3 + 5s^2 + 6s)$。\n    $b_1 = \\int_0^1 L_1(s) \\, ds = -\\frac{1}{2} \\int_0^1 (s^3 + 5s^2 + 6s) \\, ds = -\\frac{1}{2} \\left[ \\frac{s^4}{4} + \\frac{5s^3}{3} + 3s^2 \\right]_0^1$。\n    $b_1 = -\\frac{1}{2} \\left(\\frac{1}{4} + \\frac{5}{3} + 3 \\right) = -\\frac{1}{2} \\left(\\frac{3}{12} + \\frac{20}{12} + \\frac{36}{12}\\right) = -\\frac{1}{2}\\left(\\frac{59}{12}\\right) = -\\frac{59}{24}$。\n\n3.  **系数 $b_2$（与 $f_{n-2}$ 和节点 $s_2=-2$ 相关联）：**\n    $L_2(s) = \\frac{(s-0)(s-(-1))(s-(-3))}{(-2-0)(-2-(-1))(-2-(-3))} = \\frac{s(s+1)(s+3)}{(-2)(-1)(1)} = \\frac{1}{2}(s^3 + 4s^2 + 3s)$。\n    $b_2 = \\int_0^1 L_2(s) \\, ds = \\frac{1}{2} \\int_0^1 (s^3 + 4s^2 + 3s) \\, ds = \\frac{1}{2} \\left[ \\frac{s^4}{4} + \\frac{4s^3}{3} + \\frac{3s^2}{2} \\right]_0^1$。\n    $b_2 = \\frac{1}{2} \\left(\\frac{1}{4} + \\frac{4}{3} + \\frac{3}{2} \\right) = \\frac{1}{2} \\left(\\frac{3}{12} + \\frac{16}{12} + \\frac{18}{12}\\right) = \\frac{1}{2}\\left(\\frac{37}{12}\\right) = \\frac{37}{24}$。\n\n4.  **系数 $b_3$（与 $f_{n-3}$ 和节点 $s_3=-3$ 相关联）：**\n    $L_3(s) = \\frac{(s-0)(s-(-1))(s-(-2))}{(-3-0)(-3-(-1))(-3-(-2))} = \\frac{s(s+1)(s+2)}{(-3)(-2)(-1)} = -\\frac{1}{6}(s^3 + 3s^2 + 2s)$。\n    $b_3 = \\int_0^1 L_3(s) \\, ds = -\\frac{1}{6} \\int_0^1 (s^3 + 3s^2 + 2s) \\, ds = -\\frac{1}{6} \\left[ \\frac{s^4}{4} + s^3 + s^2 \\right]_0^1$。\n    $b_3 = -\\frac{1}{6} \\left(\\frac{1}{4} + 1 + 1 \\right) = -\\frac{1}{6} \\left(\\frac{1}{4} + \\frac{8}{4}\\right) = -\\frac{1}{6}\\left(\\frac{9}{4}\\right) = -\\frac{9}{24}$。\n\n因此，4步 Adams-Bashforth 方法的系数集 $\\{b_0, b_1, b_2, b_3\\}$ 被严格地推导为精确有理数。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{55}{24} & -\\frac{59}{24} & \\frac{37}{24} & -\\frac{9}{24}\n\\end{pmatrix}\n}\n$$", "id": "3523827"}, {"introduction": "推导出一种数值方法后，下一个关键步骤是理解其适用范围和局限性，其中最重要的就是数值稳定性。本练习将探讨AB4方法的绝对稳定性，通过分析一个标准测试问题，揭示为何显式方法不能使用任意大的时间步长[@problem_id:3523781]。理解稳定区域的边界对于在天体物理模拟等实际应用中避免得到非物理的、发散的解至关重要。", "problem": "一个在分层恒星包层中经历线性辐射阻尼的天体物理模式振幅 $y(t)$ 遵循标量常微分方程 (ODE) $y'(t)=-\\Lambda\\,y(t)$，其中 $\\Lambda>0$ 是一个由微观物理决定的恒定衰减率。引入 $\\lambda=-\\Lambda<0$ 将此连续演化重塑为线性检验方程 $y'(t)=\\lambda\\,y(t)$，其中 $\\lambda$ 为负实数，这是评估线性多步法绝对稳定性的标准基础。考虑将四步显式 Adams-Bashforth 方法 (AB4) 应用于此检验方程，步长固定为 $h>0$。使用从与 $y_n=\\xi^n$ 相关的特征关系中获得的放大因子 $\\xi$ 的线性多步法稳定性框架，通过在单位圆 $|\\xi|=1$ 上消去 $\\xi$，以无量纲乘积 $z=h\\lambda$ 表示，导出 AB4 的参数化稳定性边界。然后，计算此边界与负实轴的交点，并以精确代数数的形式报告相应的 $h\\lambda$ 值。最后，从物理上解释该交点对于为了稳定地积分衰减的天体物理模式，时间步长 $h$ 的最大允许量级（以 $|\\lambda|$ 表示）意味着什么。您最终报告的值必须是负实轴交点 $h\\lambda$ 的单个精确代数数值。由于 $h\\lambda$ 是无量纲的，因此不需要单位。不需要四舍五入。", "solution": "该问题要求分析四步显式 Adams-Bashforth (AB4) 方法应用于线性检验方程 $y'(t) = \\lambda y(t)$ 时的绝对稳定性，其中 $\\lambda < 0$ 是一个实常数。目标是在 $z = h\\lambda$ 的复平面中，找到该方法的稳定性边界与负实轴的交点，其中 $h$ 是时间步长。\n\n首先，我们写出四步 Adams-Bashforth 方法的公式。对于形式为 $y'(t) = f(t, y(t))$ 的一阶常微分方程，AB4 方法使用前四个步骤的信息来计算第 $n+1$ 步的解：\n$$y_{n+1} = y_n + \\frac{h}{24} \\left( 55 f_n - 59 f_{n-1} + 37 f_{n-2} - 9 f_{n-3} \\right)$$\n其中 $y_k$ 是 $y(t_k)$ 的数值近似值，$f_k = f(t_k, y_k)$。\n\n我们将此方法应用于线性检验方程 $y'(t) = \\lambda y(t)$，对于该方程，$f(t, y) = \\lambda y$，因此 $f_k = \\lambda y_k$。将此代入 AB4 公式，得到一个线性差分方程：\n$$y_{n+1} = y_n + \\frac{h \\lambda}{24} \\left( 55 y_n - 59 y_{n-1} + 37 y_{n-2} - 9 y_{n-3} \\right)$$\n\n为了分析此差分方程的稳定性，我们寻求形式为 $y_n = \\xi^n$ 的解，其中 $\\xi$ 是放大因子。稳定的数值解要求 $|\\xi| \\le 1$。将 $y_k = \\xi^k$（其中 $k \\in \\{n+1, n, n-1, n-2, n-3\\}$）代入方程，得到：\n$$\\xi^{n+1} = \\xi^n + \\frac{h \\lambda}{24} \\left( 55 \\xi^n - 59 \\xi^{n-1} + 37 \\xi^{n-2} - 9 \\xi^{n-3} \\right)$$\n两边同除以 $\\xi^{n-3}$ (假设 $\\xi \\neq 0$)，得到关于 $\\xi$ 的特征方程：\n$$\\xi^4 = \\xi^3 + \\frac{h \\lambda}{24} \\left( 55 \\xi^3 - 59 \\xi^2 + 37 \\xi - 9 \\right)$$\n令 $z = h \\lambda$，即步长和衰减率参数的无量纲乘积。特征方程变为：\n$$\\xi^4 - \\xi^3 = z \\left( \\frac{55 \\xi^3 - 59 \\xi^2 + 37 \\xi - 9}{24} \\right)$$\n该方程的形式为 $\\rho(\\xi) = z \\sigma(\\xi)$，其中 $\\rho(\\xi) = \\xi^4 - \\xi^3$ 和 $\\sigma(\\xi) = \\frac{1}{24}(55 \\xi^3 - 59 \\xi^2 + 37 \\xi - 9)$ 分别是该方法的第一和第二特征多项式。\n\n绝对稳定区域的边界是复平面中点 $z$ 的轨迹，对于这些点，特征方程有一个模为 $|\\xi|=1$ 的根 $\\xi$。我们可以通过令 $\\xi = e^{i\\theta}$（其中 $\\theta \\in [0, 2\\pi)$）并求解 $z$ 来参数化地表示此边界：\n$$z(\\theta) = \\frac{\\rho(e^{i\\theta})}{\\sigma(e^{i\\theta})} = \\frac{24( (e^{i\\theta})^4 - (e^{i\\theta})^3 )}{55(e^{i\\theta})^3 - 59(e^{i\\theta})^2 + 37(e^{i\\theta}) - 9}$$\n问题要求此边界与负实轴的交点。该交点发生在单位圆上的某个 $\\xi$ 值，该值使 $z$ 成为负实数。单位圆上的实数值为 $\\xi = 1$ 和 $\\xi = -1$。\n首先，考虑 $\\xi = 1$：\n$$z = \\frac{24(1^4 - 1^3)}{55(1)^3 - 59(1)^2 + 37(1) - 9} = \\frac{24(0)}{55-59+37-9} = \\frac{0}{24} = 0$$\n这对应于原点的平凡交点，代表 $h \\to 0$ 的极限情况。\n\n接下来，考虑 $\\xi = -1$。该值对应于 $\\theta = \\pi$，并且对于显式方法，通常定义了实轴上稳定区间的最左端点。我们将 $\\xi = -1$ 代入 $z$ 的表达式中：\n$$z = \\frac{24((-1)^4 - (-1)^3)}{55(-1)^3 - 59(-1)^2 + 37(-1) - 9}$$\n我们分别计算分子和分母。\n分子：\n$$24(1 - (-1)) = 24(2) = 48$$\n分母：\n$$55(-1) - 59(1) + 37(-1) - 9 = -55 - 59 - 37 - 9 = -160$$\n因此，该交点处的 $z$ 值为：\n$$z = \\frac{48}{-160}$$\n为了简化这个分数，我们找到 $48$ 和 $160$ 的最大公约数。两者都可以被 $16$ 整除：$48 = 3 \\times 16$，$160 = 10 \\times 16$。\n$$z = -\\frac{3 \\times 16}{10 \\times 16} = -\\frac{3}{10}$$\n这是 AB4 稳定性边界与负实轴交点处的 $h\\lambda$ 值。\n\n对于物理解释，原始的常微分方程 $y'(t) = -\\Lambda y(t)$ 描述了一个指数衰减的物理量，因为 $\\Lambda > 0$。分析是在检验方程 $y'(t) = \\lambda y(t)$ 上进行的，其中 $\\lambda = -\\Lambda < 0$。数值方法的稳定性要求无量纲步长 $z = h\\lambda$ 位于绝对稳定区域内。对于这个问题，负实轴上的稳定区间是 $[-3/10, 0]$。因此，我们必须有：\n$$h\\lambda \\ge -\\frac{3}{10}$$\n代入 $\\lambda = -\\Lambda = -|\\lambda|$：\n$$-h|\\lambda| \\ge -\\frac{3}{10}$$\n两边乘以 $-1$ 并反转不等号，得到对步长 $h$ 的条件：\n$$h|\\lambda| \\le \\frac{3}{10} \\implies h \\le \\frac{3}{10|\\lambda|} = \\frac{0.3}{|\\lambda|} = \\frac{0.3}{\\Lambda}$$\n这意味着，为了让 AB4 方法能够稳定地积分一个衰减率为 $\\Lambda$ 的模式，时间步长 $h$ 必须选择得小于一个由衰减率本身决定的临界值。计算出的值 $h\\lambda = -3/10$ 定义了这个稳定性极限。如果步长太大 (即 $h > 0.3/\\Lambda$)，数值解将表现出非物理的、发散的振荡，这是数值不稳定性的一个标志。问题要求的最终答案是这个交点的具体数值。", "answer": "$$\\boxed{-\\frac{3}{10}}$$", "id": "3523781"}, {"introduction": "理论知识最终需要通过实践来巩固。本练习将理论付诸代码，要求你实现并比较显式的AB4方法与基于隐式AM4方法的预测-校正方案[@problem_id:3523834]。通过在一个模拟天体物理阻尼振荡的常微分方程系统上进行测试，你将亲眼观察到理论概念（如稳定性和精度）在实际计算中的表现，并获得关于何时选择显式或隐式方法的宝贵实践经验。", "problem": "考虑天体物理流体动力学中的线性阻尼谐振子，其中恒星包层的一个单模经历强烈的辐射阻尼。其控制方程源自牛顿第二定律、线性拖曳力和胡克定律，是一个二阶常微分方程 (ODE) $$x''(t) + 2\\zeta\\omega\\,x'(t) + \\omega^2 x(t) = 0,$$ 其中 $x(t)$ 是位移（单位：米），$\\omega$ 是无阻尼自然角频率（单位：$\\mathrm{s}^{-1}$），$\\zeta$ 是无量纲阻尼比。对于过阻尼情况，假定 $\\zeta > 1$。通过定义速度 $v(t) = x'(t)$，将其转换为一个一阶系统以便进行数值积分，即 $$\\frac{d}{dt}\\begin{bmatrix}x(t) \\\\ v(t)\\end{bmatrix} = \\begin{bmatrix} v(t) \\\\ -2\\zeta\\omega\\,v(t) - \\omega^2 x(t)\\end{bmatrix}.$$ 使用初始条件 $x(0) = 1$（单位：米）和 $v(0) = 0$（单位：米/秒）。\n\n为此初值问题实现两种固定步长的多步法：\n- 四阶 Adams–Bashforth 方法 (AB4)，以及\n- 四阶 Adams–Moulton 方法 (AM4)，以单次预测-校正过程应用，使用 AB4 作为预测子，AM4 作为一次校正迭代。\n\n为启动多步法，使用单步四阶 Runge–Kutta 方法生成为 AB4 和 AM4 提供种子所需的前 $3$ 个步长。对于 AM4 方法，每一步执行恰好一次校正迭代。使用一个恒定的时间步长 $h$（单位：秒）并积分到一个固定的最终时间 $T$（单位：秒）。对于每组参数，通过将数值解 $x(T)$ 与过阻尼情况的精确解析解进行比较，计算位置 $x(T)$ 的全局绝对误差（单位：米），然后计算误差比 $$R = \\frac{\\mathrm{err}_{\\mathrm{AB4}}}{\\mathrm{err}_{\\mathrm{AM4}}},$$ 该比值为无量纲。\n\n过阻尼情况（$\\zeta > 1$）的解析解由两个不同的实根 $$r_{1,2} = -\\zeta\\omega \\pm \\omega\\sqrt{\\zeta^2 - 1},$$ 表征，从而得到闭式解 $$x(t) = C_1 e^{r_1 t} + C_2 e^{r_2 t},$$ 其中常数 $C_1$ 和 $C_2$ 由 $x(0)$ 和 $v(0)$ 决定。\n\n您的程序必须在上述系统上实现 AB4 和 AM4（带单次校正），对每组参数在 $t=T$ 处评估精确解，计算误差比 $R$，并为以下测试套件生成结果：\n\n- 测试用例 1 (正常路径)：$\\omega = 25\\,\\mathrm{s}^{-1}$, $\\zeta = 1.1$, $T = 2\\,\\mathrm{s}$, $h = 0.02\\,\\mathrm{s}$。\n- 测试用例 2 (接近显式稳定性边界)：$\\omega = 25\\,\\mathrm{s}^{-1}$, $\\zeta = 1.1$, $T = 2\\,\\mathrm{s}$, $h = 0.05\\,\\mathrm{s}$。\n- 测试用例 3 (轻度刚性模态)：$\\omega = 35\\,\\mathrm{s}^{-1}$, $\\zeta = 1.05$, $T = 2\\,\\mathrm{s}$, $h = 0.05\\,\\mathrm{s}$。\n- 测试用例 4 (小步长基线)：$\\omega = 25\\,\\mathrm{s}^{-1}$, $\\zeta = 1.1$, $T = 2\\,\\mathrm{s}$, $h = 0.005\\,\\mathrm{s}$。\n\n对于每个测试用例，输出必须是按上述方式计算的单个浮点数 $R$。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果（例如 $[r_1,r_2,r_3,r_4]$）。四个输出均为无量纲数（比率），因此打印的值无需附加物理单位。请确保您的实现是自包含的，并且不使用任何外部输入。", "solution": "用户提供了一个有效、适定且具有科学依据的计算天体物理学问题陈述。该问题旨在使用两种不同的四阶多步数值方法求解阻尼谐振子的二阶线性常微分方程，并将其精度与精确解析解进行比较。\n\n控制方程为：\n$$x''(t) + 2\\zeta\\omega\\,x'(t) + \\omega^2 x(t) = 0$$\n初始条件为 $x(0) = 1$ 和 $x'(0) = 0$。问题指定了过阻尼情况，其中阻尼比 $\\zeta > 1$。\n\n首先，我们将二阶常微分方程转换为一个由两个一阶常微分方程组成的系统。设状态向量为 $\\mathbf{y}(t) = [x(t), v(t)]^T$，其中 $v(t) = x'(t)$ 是速度。则该系统由以下公式给出：\n$$ \\frac{d\\mathbf{y}}{dt} = \\frac{d}{dt}\\begin{bmatrix}x \\\\ v\\end{bmatrix} = \\begin{bmatrix} v \\\\ -2\\zeta\\omega v - \\omega^2 x \\end{bmatrix} = F(t, \\mathbf{y}) $$\n系统的初始条件是 $\\mathbf{y}(0) = [1, 0]^T$。\n\n接下来，我们推导该初值问题的精确解析解，该解将作为误差计算的基准。该常微分方程的特征方程是 $r^2 + 2\\zeta\\omega r + \\omega^2 = 0$。对于过阻尼情况（$\\zeta > 1$），其根是不同的实数：\n$$r_{1,2} = -\\zeta\\omega \\pm \\omega\\sqrt{\\zeta^2 - 1}$$\n通解的形式为 $x(t) = C_1 e^{r_1 t} + C_2 e^{r_2 t}$。系数 $C_1$ 和 $C_2$ 由初始条件 $x(0) = 1$ 和 $v(0) = x'(0) = 0$ 确定。\n应用这些条件：\n$$x(0) = C_1 + C_2 = 1$$\n$$v(0) = C_1 r_1 + C_2 r_2 = 0$$\n求解这个关于 $C_1$ 和 $C_2$ 的线性系统可得：\n$$C_1 = \\frac{-r_2}{r_1 - r_2} \\quad \\text{and} \\quad C_2 = \\frac{r_1}{r_1 - r_2}$$\n代入 $r_1$ 和 $r_2$ 的表达式，我们可以写出 $x(t)$ 的完整解析解，该解将用于计算最终时间 $T$ 处的精确值。\n\n问题的核心是实现并比较两种数值方法。由于 Adams-Bashforth (AB4) 和 Adams-Moulton (AM4) 方法都是多步法，它们需要几个历史数据点来启动。问题指定使用四阶 Runge-Kutta (RK4) 方法从初始条件 $t_0=0$ 开始生成前三个步长（即在 $t_1, t_2, t_3$ 处的解）。\n\n从 $t_n$ 到 $t_{n+1}=t_n+h$ 的一步四阶 Runge-Kutta (RK4) 方法由以下公式给出：\n$$\\mathbf{y}_{n+1} = \\mathbf{y}_n + \\frac{h}{6}(\\mathbf{k}_1 + 2\\mathbf{k}_2 + 2\\mathbf{k}_3 + \\mathbf{k}_4)$$\n其中\n$$ \\begin{aligned}\n\\mathbf{k}_1 = F(t_n, \\mathbf{y}_n) \\\\\n\\mathbf{k}_2 = F(t_n + h/2, \\mathbf{y}_n + h/2 \\cdot \\mathbf{k}_1) \\\\\n\\mathbf{k}_3 = F(t_n + h/2, \\mathbf{y}_n + h/2 \\cdot \\mathbf{k}_2) \\\\\n\\mathbf{k}_4 = F(t_n + h, \\mathbf{y}_n + h \\cdot \\mathbf{k}_3)\n\\end{aligned} $$\n这个单步法被应用三次以求得 $\\mathbf{y}_1, \\mathbf{y}_2, \\mathbf{y}_3$，从而提供必要的历史数据 $\\mathbf{y}_0, \\mathbf{y}_1, \\mathbf{y}_2, \\mathbf{y}_3$ 及其对应的导数 $F_0, F_1, F_2, F_3$。\n\n第一种多步法是显式四阶 Adams-Bashforth (AB4) 方法。其更新规则为：\n$$\\mathbf{y}_{n+1} = \\mathbf{y}_n + \\frac{h}{24} (55 F_n - 59 F_{n-1} + 37 F_{n-2} - 9 F_{n-3})$$\n其中 $F_k = F(t_k, \\mathbf{y}_k)$。此公式用于所有后续步长 $n \\ge 3$。\n\n第二种方法是一个预测-校正方案，使用 AB4 作为预测子，隐式四阶 Adams-Moulton (AM4) 方法作为校正子。这是一个采用单次校正过程的 PECE（预测-求值-校正-求值）方案。\n1.  **预测 (P)：** 使用显式 AB4 方法计算 $\\mathbf{y}_{n+1}$ 的一个初始猜测值。我们称之为 $\\mathbf{y}^*_{n+1}$。\n    $$\\mathbf{y}^*_{n+1} = \\mathbf{y}_n + \\frac{h}{24} (55 F_n - 59 F_{n-1} + 37 F_{n-2} - 9 F_{n-3})$$\n2.  **求值 (E)：** 在此预测状态下计算导数。\n    $$F^*_{n+1} = F(t_{n+1}, \\mathbf{y}^*_{n+1})$$\n3.  **校正 (C)：** 使用隐式 AM4 公式计算该步的最终值 $\\mathbf{y}_{n+1}$，并将预测的导数 $F^*_{n+1}$ 用于右侧。\n    $$\\mathbf{y}_{n+1} = \\mathbf{y}_n + \\frac{h}{24} (9 F^*_{n+1} + 19 F_n - 5 F_{n-1} + F_{n-2})$$\n然后使用校正后的状态计算下一步历史记录所需的导数：$F_{n+1} = F(t_{n+1}, \\mathbf{y}_{n+1})$。\n\n对于每个测试用例，流程如下：\n1.  设置参数 $\\omega, \\zeta, T, h$。\n2.  使用 AB4 方法求解从 $t=0$ 到 $t=T$ 的初值问题，以找到数值解 $x_{\\mathrm{AB4}}(T)$。\n3.  再次使用 AM4 预测-校正方法求解从 $t=0$ 到 $t=T$ 的初值问题，以找到 $x_{\\mathrm{AM4}}(T)$。\n4.  使用推导出的解析公式计算精确解 $x_{exact}(T)$。\n5.  计算每种方法在 $t=T$ 时的全局绝对误差：\n    $$\\mathrm{err}_{\\mathrm{AB4}} = |x_{\\mathrm{AB4}}(T) - x_{exact}(T)|$$\n    $$\\mathrm{err}_{\\mathrm{AM4}} = |x_{\\mathrm{AM4}}(T) - x_{exact}(T)|$$\n6.  最后，计算误差比 $R$：\n    $$R = \\frac{\\mathrm{err}_{\\mathrm{AB4}}}{\\mathrm{err}_{\\mathrm{AM4}}}$$\n该实现将对所有指定的参数集执行这些步骤，并报告所得的比率。AM4-PC 方法通常比纯显式的 AB4 方法更精确，且具有更好的稳定性，这预计会反映在误差比 $R$ 中，尤其是在步长较大、接近 AB4 方法的稳定性极限时。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the damped harmonic oscillator ODE using AB4 and AM4-PC methods,\n    and computes the ratio of their global errors.\n    \"\"\"\n\n    test_cases = [\n        # (omega, zeta, T, h)\n        (25.0, 1.1, 2.0, 0.02),\n        (25.0, 1.1, 2.0, 0.05),\n        (35.0, 1.05, 2.0, 0.05),\n        (25.0, 1.1, 2.0, 0.005),\n    ]\n\n    def analytical_solution(t, omega, zeta):\n        \"\"\"\n        Calculates the exact analytical solution for the overdamped harmonic oscillator.\n        x(0) = 1, v(0) = 0.\n        \"\"\"\n        # Calculate roots of the characteristic equation\n        sqrt_term = np.sqrt(zeta**2 - 1)\n        r1 = -zeta * omega + omega * sqrt_term\n        r2 = -zeta * omega - omega * sqrt_term\n        \n        # Calculate coefficients C1 and C2 from initial conditions\n        # C1 = -r2 / (r1 - r2)\n        # C2 = r1 / (r1 - r2)\n        # x(t) = C1*exp(r1*t) + C2*exp(r2*t)\n        # This can be written as:\n        x_t = (1 / (r1 - r2)) * (-r2 * np.exp(r1 * t) + r1 * np.exp(r2 * t))\n        return x_t\n\n    def ode_f(t, y, omega, zeta):\n        \"\"\"\n        Defines the first-order system for the ODE.\n        y = [x, v]\n        \"\"\"\n        x, v = y\n        dxdt = v\n        dvdt = -2 * zeta * omega * v - omega**2 * x\n        return np.array([dxdt, dvdt], dtype=np.float64)\n\n    def rk4_step(f, t, y, h, **f_kwargs):\n        \"\"\"\n        Performs a single step of the fourth-order Runge-Kutta method.\n        \"\"\"\n        k1 = f(t, y, **f_kwargs)\n        k2 = f(t + 0.5 * h, y + 0.5 * h * k1, **f_kwargs)\n        k3 = f(t + 0.5 * h, y + 0.5 * h * k2, **f_kwargs)\n        k4 = f(t + h, y + h * k3, **f_kwargs)\n        return y + (h / 6.0) * (k1 + 2 * k2 + 2 * k3 + k4)\n\n    def solve_ode_multistep(omega, zeta, T, h, method):\n        \"\"\"\n        Solves the ODE using a specified multi-step method (AB4 or AM4-PC).\n        \"\"\"\n        num_steps = int(round(T / h))\n        t = np.linspace(0, T, num_steps + 1)\n        \n        y = np.zeros((num_steps + 1, 2), dtype=np.float64)\n        y[0] = [1.0, 0.0]  # Initial conditions x(0)=1, v(0)=0\n\n        f_kwargs = {'omega': omega, 'zeta': zeta}\n\n        # Startup phase: Use RK4 to generate the first 3 steps\n        for n in range(3):\n            y[n+1] = rk4_step(ode_f, t[n], y[n], h, **f_kwargs)\n            \n        f_vals = np.zeros_like(y)\n        for i in range(4):\n            f_vals[i] = ode_f(t[i], y[i], **f_kwargs)\n\n        # Multi-step phase\n        for n in range(3, num_steps):\n            f_n, f_n_m1, f_n_m2, f_n_m3 = f_vals[n], f_vals[n-1], f_vals[n-2], f_vals[n-3]\n\n            # Predictor step (AB4)\n            y_pred = y[n] + (h / 24.0) * (55.0 * f_n - 59.0 * f_n_m1 + 37.0 * f_n_m2 - 9.0 * f_n_m3)\n            \n            if method == 'AB4':\n                y[n+1] = y_pred\n            elif method == 'AM4_PC':\n                # Evaluate step\n                f_pred = ode_f(t[n+1], y_pred, **f_kwargs)\n                # Corrector step (AM4)\n                y_corr = y[n] + (h / 24.0) * (9.0 * f_pred + 19.0 * f_n - 5.0 * f_n_m1 + f_vals[n-2])\n                y[n+1] = y_corr\n            else:\n                raise ValueError(\"Unknown method specified.\")\n            \n            # Final evaluation for next step's history\n            f_vals[n+1] = ode_f(t[n+1], y[n+1], **f_kwargs)\n            \n        return y[-1, 0] # Return the final position x(T)\n\n    results = []\n    for case in test_cases:\n        omega, zeta, T, h = case\n        \n        # Calculate numerical solutions\n        x_ab4 = solve_ode_multistep(omega, zeta, T, h, 'AB4')\n        x_am4 = solve_ode_multistep(omega, zeta, T, h, 'AM4_PC')\n        \n        # Calculate exact solution\n        x_exact = analytical_solution(T, omega, zeta)\n        \n        # Calculate errors\n        err_ab4 = abs(x_ab4 - x_exact)\n        err_am4 = abs(x_am4 - x_exact)\n        \n        # Calculate error ratio\n        if err_am4 == 0:\n            # This case is unlikely but would imply infinite ratio if err_ab4 > 0\n            ratio = np.inf if err_ab4 > 0 else 1.0\n        else:\n            ratio = err_ab4 / err_am4\n        \n        results.append(ratio)\n    \n    print(f\"[{','.join(f'{r:.10f}' for r in results)}]\")\n\nsolve()\n```", "id": "3523834"}]}