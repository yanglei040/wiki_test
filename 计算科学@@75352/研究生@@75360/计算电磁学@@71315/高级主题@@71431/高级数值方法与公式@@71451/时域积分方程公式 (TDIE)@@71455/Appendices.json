{"hands_on_practices": [{"introduction": "在将麦克斯韦方程组应用于计算电磁学时，一个核心挑战是如何在离散的网格上精确地表示连续的物理定律。本练习旨在通过从基本定义出发，推导连接表面电流和表面电荷的离散电荷守恒方程，从而弥合连续理论与离散计算之间的鸿沟[@problem_id:3355627]。掌握这一推导过程对于理解时域积分方程数值方法的内在结构和稳定性至关重要。", "problem": "考虑一个由包含 $N_{t}$ 个三角形 $\\{T_{m}\\}_{m=1}^{N_{t}}$ 和 $N_{e}$ 条内部边 $\\{e_{n}\\}_{n=1}^{N_{e}}$ 的协调三角网格离散化的理想电导体 (PEC) 闭合曲面。设 Rao–Wilton–Glisson (RWG) 基函数 $\\mathbf{f}_{n}(\\mathbf{r})$ 与长度为 $l_{n}$ 的内部边 $e_{n}$ 相关联，该边由两个相邻的三角形 $T_{n}^{+}$ 和 $T_{n}^{-}$ 共享，其面积分别为 $A_{n}^{+}$ 和 $A_{n}^{-}$。RWG 基函数在 $T_{n}^{+}$ 和 $T_{n}^{-}$ 上分段定义为\n$$\n\\mathbf{f}_{n}(\\mathbf{r}) = \\begin{cases}\n\\dfrac{l_{n}}{2 A_{n}^{+}} \\, \\mathbf{r}_{n}^{+}(\\mathbf{r}),  \\mathbf{r} \\in T_{n}^{+}, \\\\\n-\\dfrac{l_{n}}{2 A_{n}^{-}} \\, \\mathbf{r}_{n}^{-}(\\mathbf{r}),  \\mathbf{r} \\in T_{n}^{-}, \\\\\n\\mathbf{0},  \\text{否则},\n\\end{cases}\n$$\n其中 $\\mathbf{r}_{n}^{+}(\\mathbf{r})$ 是从 $T_{n}^{+}$ 的自由顶点到 $\\mathbf{r}$ 的平面内矢量，$\\mathbf{r}_{n}^{-}(\\mathbf{r})$ 是从 $T_{n}^{-}$ 的自由顶点到 $\\mathbf{r}$ 的平面内矢量。曲面电流密度展开为\n$$\n\\mathbf{J}_{s}(\\mathbf{r},t) = \\sum_{n=1}^{N_{e}} i_{n}(t)\\, \\mathbf{f}_{n}(\\mathbf{r}),\n$$\n其中 $i_{n}(t)$ 是边电流系数（自由度）。在同一网格上，考虑一个支撑在每个三角形 $T_{m}$ 上的脉冲基 $\\{P_{m}(\\mathbf{r})\\}_{m=1}^{N_{t}}$，使得\n$$\nP_{m}(\\mathbf{r}) = \\begin{cases}\n\\dfrac{1}{A_{m}},  \\mathbf{r} \\in T_{m}, \\\\\n0,  \\text{否则},\n\\end{cases}\n$$\n其中 $A_{m}$ 是三角形 $T_{m}$ 的面积，因此 $\\int_{T_{m}} P_{m}(\\mathbf{r}) \\, \\mathrm{d}S = 1$。设曲面电荷密度展开为\n$$\n\\rho_{s}(\\mathbf{r},t) = \\sum_{m=1}^{N_{t}} Q_{m}(t)\\, P_{m}(\\mathbf{r}),\n$$\n其中 $Q_{m}(t)$ 是三角形 $T_{m}$ 上的总电荷。\n\n从麦克斯韦方程组推导出的曲面电荷连续性方程，\n$$\n\\nabla_{s}\\cdot \\mathbf{J}_{s}(\\mathbf{r},t) + \\frac{\\partial \\rho_{s}(\\mathbf{r},t)}{\\partial t} = 0 \\quad \\text{在曲面上},\n$$\n以及上述展开式出发，推导连接电流自由度 $\\{i_{n}(t)\\}_{n=1}^{N_{e}}$ 和电荷自由度 $\\{Q_{m}(t)\\}_{m=1}^{N_{t}}$ 的离散连续性方程。在您的推导中：\n\n- 仅使用所提供的基本定义以及平面三角形上线性矢量场的曲面散度为常数这一事实。\n- 清楚地定义符号 $s_{mn} \\in \\{-1,0,+1\\}$，它表示边 $e_{n}$ 相对于三角形 $T_{m}$ 的朝向，其中如果 $T_{m} = T_{n}^{+}$ 则 $s_{mn} = +1$，如果 $T_{m} = T_{n}^{-}$ 则 $s_{mn} = -1$，否则 $s_{mn} = 0$。\n- 展示如何使用一个关联长度矩阵 $\\mathbf{D}_{\\ell} \\in \\mathbb{R}^{N_{t} \\times N_{e}}$（其元素为 $\\left[\\mathbf{D}_{\\ell}\\right]_{mn} = s_{mn} \\, l_{n}$），将局部的、基于三角形的方程组合成一个紧凑的矩阵关系。\n\n提供与所选归一化一致的 $\\rho_{s}(\\mathbf{r},t)$ 的相关脉冲基展开式，并最终写出电荷系数向量的时间导数 $\\frac{\\mathrm{d}}{\\mathrm{d}t}\\mathbf{Q}(t)$ 以 $\\mathbf{D}_{\\ell}$ 和电流系数向量 $\\mathbf{i}(t)$ 表示的紧凑表达式。\n\n您的最终答案应为 $\\dfrac{\\mathrm{d}}{\\mathrm{d}t}\\mathbf{Q}(t)$ 以 $\\mathbf{D}_{\\ell}$ 和 $\\mathbf{i}(t)$ 表示的单个闭式解析表达式，无需单位。最终答案中不要提供中间方程。无需四舍五入。", "solution": "该问题是有效的，因为它在麦克斯韦理论和计算电磁学方面有科学依据，所有必要的定义都已提供，问题是适定的，并且陈述客观。我们接下来推导离散连续性方程。\n\n推导始于曲面电荷连续性方程，这是麦克斯韦方程组的直接推论：\n$$\n\\nabla_{s}\\cdot \\mathbf{J}_{s}(\\mathbf{r},t) + \\frac{\\partial \\rho_{s}(\\mathbf{r},t)}{\\partial t} = 0\n$$\n为了从这个连续偏微分方程中获得一个离散方程组，我们采用一种测试程序。一个与电荷的脉冲基展开一致的自然选择是，对 $m = 1, \\dots, N_t$ 的每个三角形 $T_m$ 上的方程进行积分。这等效于应用一个在 $T_m$ 上为 $1$、在其他地方为 $0$ 的测试函数。\n$$\n\\int_{T_m} \\left( \\nabla_{s}\\cdot \\mathbf{J}_{s}(\\mathbf{r},t) + \\frac{\\partial \\rho_{s}(\\mathbf{r},t)}{\\partial t} \\right) \\mathrm{d}S = 0\n$$\n我们可以将其分成两项：\n$$\n\\int_{T_m} \\nabla_{s}\\cdot \\mathbf{J}_{s}(\\mathbf{r},t) \\, \\mathrm{d}S + \\int_{T_m} \\frac{\\partial \\rho_{s}(\\mathbf{r},t)}{\\partial t} \\, \\mathrm{d}S = 0\n$$\n\n我们来分析第一项，即散度项。我们代入给定的曲面电流密度展开式 $\\mathbf{J}_{s}(\\mathbf{r},t) = \\sum_{n=1}^{N_{e}} i_{n}(t)\\, \\mathbf{f}_{n}(\\mathbf{r})$。\n$$\n\\int_{T_m} \\nabla_{s}\\cdot \\left( \\sum_{n=1}^{N_{e}} i_{n}(t)\\, \\mathbf{f}_{n}(\\mathbf{r}) \\right) \\mathrm{d}S = \\sum_{n=1}^{N_{e}} i_{n}(t) \\int_{T_m} \\nabla_{s}\\cdot \\mathbf{f}_{n}(\\mathbf{r}) \\, \\mathrm{d}S\n$$\n需要计算积分 $\\int_{T_m} \\nabla_{s}\\cdot \\mathbf{f}_{n}(\\mathbf{r}) \\, \\mathrm{d}S$。基函数 $\\mathbf{f}_{n}(\\mathbf{r})$ 是分段定义的。在三角形 $T_{n}^{+}$ 上，$\\mathbf{f}_{n}(\\mathbf{r}) = \\frac{l_{n}}{2 A_{n}^{+}} \\, \\mathbf{r}_{n}^{+}(\\mathbf{r})$。由于 $\\mathbf{r}_{n}^{+}(\\mathbf{r})$ 是三角形曲面坐标中的线性矢量场，其曲面散度为常数 $\\nabla_s \\cdot \\mathbf{r}_{n}^{+}(\\mathbf{r}) = 2$。因此，基函数的曲面散度在 $T_{n}^{+}$ 上也为常数：\n$$\n\\nabla_{s}\\cdot \\mathbf{f}_{n}(\\mathbf{r}) = \\frac{l_{n}}{2 A_{n}^{+}} \\nabla_{s}\\cdot\\mathbf{r}_{n}^{+}(\\mathbf{r}) = \\frac{l_{n}}{2 A_{n}^{+}} (2) = \\frac{l_{n}}{A_{n}^{+}}, \\quad \\mathbf{r} \\in T_{n}^{+}\n$$\n类似地，在三角形 $T_{n}^{-}$ 上，$\\mathbf{f}_{n}(\\mathbf{r}) = -\\frac{l_{n}}{2 A_{n}^{-}} \\, \\mathbf{r}_{n}^{-}(\\mathbf{r})$，其曲面散度为：\n$$\n\\nabla_{s}\\cdot \\mathbf{f}_{n}(\\mathbf{r}) = -\\frac{l_{n}}{2 A_{n}^{-}} \\nabla_{s}\\cdot\\mathbf{r}_{n}^{-}(\\mathbf{r}) = -\\frac{l_{n}}{2 A_{n}^{-}} (2) = -\\frac{l_{n}}{A_{n}^{-}}, \\quad \\mathbf{r} \\in T_{n}^{-}\n$$\n在其他地方散度为零。现在我们可以计算在 $T_m$ 上的积分：\n\\begin{itemize}\n    \\item 如果 $T_m = T_n^{+}$，积分为 $\\int_{T_m} \\frac{l_{n}}{A_{n}^{+}} \\, \\mathrm{d}S$。由于 $T_m = T_n^{+}$，它们的面积相等，$A_m = A_n^{+}$。积分变为 $\\frac{l_{n}}{A_m} \\int_{T_m} \\mathrm{d}S = \\frac{l_{n}}{A_m} A_m = l_n$。在这种情况下，符号指示符 $s_{mn}$ 定义为 $+1$。\n    \\item 如果 $T_m = T_n^{-}$，积分为 $\\int_{T_m} -\\frac{l_{n}}{A_{n}^{-}} \\, \\mathrm{d}S$。由于 $A_m = A_n^{-}$，结果为 $-l_n$。在这种情况下，$s_{mn} = -1$。\n    \\item 如果 $T_m$ 不与边 $e_n$ 相邻（即 $T_m \\neq T_n^{+}$ 且 $T_m \\neq T_n^{-}$），则在 $T_m$ 上 $\\mathbf{f}_n(\\mathbf{r}) = \\mathbf{0}$，其散度为零，积分为 $0$。在这种情况下，$s_{mn} = 0$。\n\\end{itemize}\n在所有情况下，我们都得到 $\\int_{T_m} \\nabla_{s}\\cdot \\mathbf{f}_{n}(\\mathbf{r}) \\, \\mathrm{d}S = s_{mn} l_n$。\n因此，散度项简化为：\n$$\n\\sum_{n=1}^{N_{e}} i_{n}(t) (s_{mn} l_n)\n$$\n\n接下来，我们分析第二项，即电荷导数项。我们首先确认电荷展开式的一致性。问题给出了展开式 $\\rho_{s}(\\mathbf{r},t) = \\sum_{k=1}^{N_{t}} Q_{k}(t)\\, P_{k}(\\mathbf{r})$ 并指出 $Q_m(t)$ 是三角形 $T_m$ 上的总电荷。我们来验证这一点。$T_m$ 上的总电荷为 $\\int_{T_m} \\rho_s(\\mathbf{r}, t) \\, \\mathrm{d}S$。代入展开式：\n$$\n\\int_{T_m} \\sum_{k=1}^{N_{t}} Q_{k}(t) P_{k}(\\mathbf{r}) \\, \\mathrm{d}S = \\sum_{k=1}^{N_{t}} Q_{k}(t) \\int_{T_m} P_{k}(\\mathbf{r}) \\, \\mathrm{d}S\n$$\n由于 $P_k(\\mathbf{r})$ 仅在 $T_k$ 上非零，所以积分仅在 $k = m$ 时非零。因此，求和简化为一项：$Q_{m}(t) \\int_{T_m} P_{m}(\\mathbf{r}) \\, \\mathrm{d}S$。问题指定了归一化条件 $\\int_{T_{m}} P_{m}(\\mathbf{r}) \\, \\mathrm{d}S = 1$。因此，积分 $\\int_{T_m} \\rho_s(\\mathbf{r}, t) \\, \\mathrm{d}S$ 确实等于 $Q_m(t)$，这确认了一致性。\n\n现在我们计算主方程的第二项：\n$$\n\\int_{T_m} \\frac{\\partial \\rho_{s}(\\mathbf{r},t)}{\\partial t} \\, \\mathrm{d}S = \\frac{\\mathrm{d}}{\\mathrm{d}t} \\int_{T_m} \\rho_{s}(\\mathbf{r},t) \\, \\mathrm{d}S = \\frac{\\mathrm{d}Q_{m}(t)}{\\mathrm{d}t}\n$$\n\n结合这两项，三角形 $T_m$ 的离散连续性方程为：\n$$\n\\sum_{n=1}^{N_{e}} s_{mn} l_n i_{n}(t) + \\frac{\\mathrm{d}Q_{m}(t)}{\\mathrm{d}t} = 0\n$$\n该方程对每个三角形 $m=1, \\dots, N_t$ 都成立。这个由 $N_t$ 个方程组成的方程组可以用紧凑的矩阵形式表示。设 $\\mathbf{i}(t)$ 为电流系数 $\\{i_n(t)\\}$ 的 $N_e \\times 1$ 列向量，$\\mathbf{Q}(t)$ 为电荷系数 $\\{Q_m(t)\\}$ 的 $N_t \\times 1$ 列向量。我们使用关联长度矩阵 $\\mathbf{D}_{\\ell} \\in \\mathbb{R}^{N_{t} \\times N_{e}}$，其元素为 $[\\mathbf{D}_{\\ell}]_{mn} = s_{mn} l_{n}$。求和项 $\\sum_{n=1}^{N_{e}} s_{mn} l_n i_{n}(t)$ 是矩阵向量乘积 $\\mathbf{D}_{\\ell}\\mathbf{i}(t)$ 的第 $m$ 个元素。\n因此，整个方程组可以写成：\n$$\n\\mathbf{D}_{\\ell} \\mathbf{i}(t) + \\frac{\\mathrm{d}}{\\mathrm{d}t}\\mathbf{Q}(t) = \\mathbf{0}\n$$\n其中 $\\mathbf{0}$ 是一个 $N_t \\times 1$ 的零向量。\n求解电荷向量的时间导数，我们得到最终表达式：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}\\mathbf{Q}(t) = - \\mathbf{D}_{\\ell} \\mathbf{i}(t)\n$$\n这就是电荷连续性方程的离散形式，它将三角形上电荷的变化率与流出它们的净电流（通过边电流系数表示）联系起来。", "answer": "$$\\boxed{-\\mathbf{D}_{\\ell} \\mathbf{i}(t)}$$", "id": "3355627"}, {"introduction": "理论推导为我们提供了离散形式的电荷守恒定律，但这条定律在实际的数值模拟中是否被严格遵守呢？本练习将理论付诸实践，要求您编写一个程序来量化数值解对离散电荷守恒定律的遵守程度[@problem_id:3355680]。通过计算“残差”，您将亲身体验如何检验一个时域积分方程求解器的基本物理自洽性。", "problem": "从麦克斯韦方程组和局部电荷守恒定律出发，考虑在三角形剖分表面上对表面电流密度和表面电荷密度进行时域积分方程（TDIE）离散化。使用定义在 $[t_j,t_{j+1}]$ 上的 Rao–Wilton–Glisson (RWG) 散度整合空间基函数 $\\mathbf{f}_i(\\mathbf{r})$ 和分段常数时间基函数 $b_j(t)$ 来构建时空基函数 $\\mathbf{f}_i(\\mathbf{r}) b_j(t)$，用于展开表面电流密度 $\\mathbf{J}(\\mathbf{r},t)$。表面电荷密度 $\\rho(\\mathbf{r},t)$ 在三角形上使用分段常数空间测试函数进行离散，并采用与时间区间 $[t_j,t_{j+1}]$ 对齐的随时间步进表示。\n\n基本原理：从局部电荷连续性定律 $\\nabla \\cdot \\mathbf{J}(\\mathbf{r},t) + \\partial_t \\rho(\\mathbf{r},t) = 0$ 出发，在每个空间单元和时间区间上使用散度定理和时间积分，以获得离散平衡关系。不要假定任何捷径公式；相反，通过将守恒定律投影到与 $b_j(t)$ 一致的逐三角形常数空间测试和时间窗测试上，来推导电荷连续性的离散强制执行。\n\n假设一个三角形剖分表面网格，其中每个 RWG 基函数的支撑域恰好是两个相邻的三角形 $T^{+}$ 和 $T^{-}$，并具有这样的性质：$\\nabla \\cdot \\mathbf{f}_i(\\mathbf{r})$ 在 $T^{+}$ 和 $T^{-}$ 上是分段常数，其值分别为 $+1/A^{+}$ 和 $-1/A^{-}$，其中 $A^{+}$ 和 $A^{-}$ 是三角形的面积。为了在离散层面上验证电荷连续性，利用以下事实：$\\nabla \\cdot \\mathbf{f}_i(\\mathbf{r})$ 在 $T^{+}$ 上的空间积分为 $+1$，在 $T^{-}$ 上的空间积分为 $-1$，在其他地方为零。这定义了三角形与 RWG 边之间的邻接-方向矩阵。设时间基函数 $b_j(t)$ 为在 $[t_j,t_{j+1}]$ 上的单位矩形脉冲，在其他地方为零。\n\n您的程序必须为一组给定的测试用例实现以下验证：\n\n- 构建离散邻接-方向矩阵 $S$，其元素为 $S_{n,i} = \\int_{T_n} \\nabla \\cdot \\mathbf{f}_i(\\mathbf{r}) \\, dS$。如果三角形 $n$ 是边 $i$ 的正侧，则该值为 $+1$；如果是负侧，则为 $-1$；否则为 $0$。\n\n- 对于每个时长为 $\\Delta t$ 的时间区间 $[t_j,t_{j+1}]$，给定与 $\\mathbf{f}_i(\\mathbf{r}) b_j(t)$ 相关联的电流展开系数 $I_{i,j}$ 和在区间 $j$ 末尾给定的三角形积分电荷 $Q_{n,j} = \\int_{T_n} \\rho(\\mathbf{r}, t_{j+1}) \\, dS$，通过在空间和时间上对控制定律进行积分，并将 $Q_{n,j}$ 的变化与 $\\mathbf{J}(\\mathbf{r},t)$ 的散度在 $[t_j,t_{j+1}]$ 上的贡献进行比较，从而形成每个三角形和每个区间上电荷连续性的离散残差。使用提供的数据计算每个区间和每个三角形的残差大小（以库仑 (C) 为单位），然后报告每个测试用例在所有三角形和区间上的最大绝对残差。\n\n物理单位：电流 $I_{i,j}$ 以安培 $(\\mathrm{A})$ 为单位，时间 $t_j$ 以秒 $(\\mathrm{s})$ 为单位，三角形积分电荷 $Q_{n,j}$ 以库仑 $(\\mathrm{C})$ 为单位。最终的残差大小以库仑 $(\\mathrm{C})$ 表示。\n\n角度单位不适用。\n\n百分比不适用。\n\n测试套件和答案规范：\n\n使用以下参数集进行实现和测试。在每种情况下，网格由矩阵 $S$ 编码，时间步长为 $\\Delta t$，电流系数为 $\\{I_{i,j}\\}$，区间末端的三角形积分电荷为 $\\{Q_{n,j}\\}$，时间 $t_0$ 时的初始电荷为 $Q_{n,-1}$。计算所有三角形和区间上的最大绝对残差，并为每个测试用例报告一个浮点数（以 $\\mathrm{C}$ 为单位）。\n\n- 测试用例 1 (正常路径)：\n    - 三角形：$2$；RWG 边：$1$。\n    - 邻接-方向矩阵：$S = \\begin{bmatrix} 1 \\\\ -1 \\end{bmatrix}$。\n    - 时间步长：$\\Delta t = 1.0$。\n    - 每个区间的电流系数：$I_{\\cdot,0} = \\begin{bmatrix} 1.5 \\end{bmatrix}$，$I_{\\cdot,1} = \\begin{bmatrix} -0.5 \\end{bmatrix}$。\n    - 初始电荷：$Q_{\\cdot,-1} = \\begin{bmatrix} 0.0 \\\\ 0.0 \\end{bmatrix}$。\n    - 区间末端的电荷：\n      $Q_{\\cdot,0} = \\begin{bmatrix} -1.5 \\\\ 1.5 \\end{bmatrix}$，\n      $Q_{\\cdot,1} = \\begin{bmatrix} -1.0 \\\\ 1.0 \\end{bmatrix}$。\n\n- 测试用例 2 (有意不匹配以探测残差灵敏度)：\n    - 三角形：$2$；RWG 边：$1$。\n    - 邻接-方向矩阵：$S = \\begin{bmatrix} 1 \\\\ -1 \\end{bmatrix}$。\n    - 时间步长：$\\Delta t = 1.0$。\n    - 每个区间的电流系数：$I_{\\cdot,0} = \\begin{bmatrix} 1.5 \\end{bmatrix}$，$I_{\\cdot,1} = \\begin{bmatrix} -0.5 \\end{bmatrix}$。\n    - 初始电荷：$Q_{\\cdot,-1} = \\begin{bmatrix} 0.0 \\\\ 0.0 \\end{bmatrix}$。\n    - 区间末端的电荷 (扰动后)：\n      $Q_{\\cdot,0} = \\begin{bmatrix} -1.5 \\\\ 1.5 \\end{bmatrix}$，\n      $Q_{\\cdot,1} = \\begin{bmatrix} -1.1 \\\\ 0.9 \\end{bmatrix}$。\n\n- 测试用例 3 (跨三角形的多边耦合)：\n    - 三角形：$3$；RWG 边：$2$。\n    - 邻接-方向矩阵：$S = \\begin{bmatrix} 1  0 \\\\ -1  1 \\\\ 0  -1 \\end{bmatrix}$，意即边 $0$ 将三角形 $0$ 连接到三角形 $1$，在三角形 $0$ 上为正方向；边 $1$ 将三角形 $1$ 连接到三角形 $2$，在三角形 $1$ 上为正方向。\n    - 时间步长：$\\Delta t = 0.5$。\n    - 每个区间的电流系数：\n      $I_{\\cdot,0} = \\begin{bmatrix} 2.0 \\\\ 1.0 \\end{bmatrix}$，\n      $I_{\\cdot,1} = \\begin{bmatrix} 0.0 \\\\ -1.0 \\end{bmatrix}$，\n      $I_{\\cdot,2} = \\begin{bmatrix} -2.0 \\\\ 0.0 \\end{bmatrix}$。\n    - 初始电荷：$Q_{\\cdot,-1} = \\begin{bmatrix} 0.0 \\\\ 0.0 \\\\ 0.0 \\end{bmatrix}$。\n    - 区间末端的电荷：\n      $Q_{\\cdot,0} = \\begin{bmatrix} -1.0 \\\\ 0.5 \\\\ 0.5 \\end{bmatrix}$，\n      $Q_{\\cdot,1} = \\begin{bmatrix} -1.0 \\\\ 1.0 \\\\ 0.0 \\end{bmatrix}$，\n      $Q_{\\cdot,2} = \\begin{bmatrix} 0.0 \\\\ 0.0 \\\\ 0.0 \\end{bmatrix}$。\n\n最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$\\texttt{[result1,result2,result3]}$），每个条目是相应测试用例在所有三角形和区间上的最大绝对残差，以库仑 $(\\mathrm{C})$ 为单位。", "solution": "该问题要求在三角形剖分表面上验证离散电荷守恒。出发点是局部电荷连续性方程，这是麦克斯韦方程组的一个基本推论：\n$$ \\nabla \\cdot \\mathbf{J}(\\mathbf{r},t) + \\frac{\\partial \\rho(\\mathbf{r},t)}{\\partial t} = 0 $$\n其中 $\\mathbf{J}(\\mathbf{r},t)$ 是表面电流密度，$\\rho(\\mathbf{r},t)$ 是表面电荷密度。\n\n为了推导该定律的离散形式，我们采用指定的一个测试程序。我们将连续性方程在一个任意的三角形片 $T_n$ 和一个时长为 $\\Delta t = t_{j+1} - t_j$ 的时间区间 $[t_j, t_{j+1}]$ 上进行积分。这对应于应用一个在空间上是分段常数（在 $T_n$ 上为 $1$，其他地方为 $0$）且在时间上也是分段常数（在 $[t_j, t_{j+1}]$ 上为 $1$，其他地方为 $0$）的测试函数。\n\n测试的方程是：\n$$ \\int_{t_j}^{t_{j+1}} \\int_{T_n} \\left( \\nabla \\cdot \\mathbf{J}(\\mathbf{r},t) + \\frac{\\partial \\rho(\\mathbf{r},t)}{\\partial t} \\right) dS \\, dt = 0 $$\n\n我们可以将其分为两项：\n$$ \\int_{t_j}^{t_{j+1}} \\int_{T_n} \\nabla \\cdot \\mathbf{J}(\\mathbf{r},t) \\, dS \\, dt + \\int_{t_j}^{t_{j+1}} \\int_{T_n} \\frac{\\partial \\rho(\\mathbf{r},t)}{\\partial t} \\, dS \\, dt = 0 $$\n\n让我们分析涉及电流 $\\mathbf{J}$ 的第一项。问题陈述了 $\\mathbf{J}(\\mathbf{r},t)$ 是使用 Rao-Wilton-Glisson (RWG) 空间基函数 $\\mathbf{f}_i(\\mathbf{r})$ 和分段常数时间基函数 $b_j(t)$ 展开的。时间基函数 $b_j(t)$ 是在 $[t_j, t_{j+1}]$ 上的单位矩形脉冲。\n其展开式为：\n$$ \\mathbf{J}(\\mathbf{r},t) = \\sum_{i,k} I_{i,k} \\mathbf{f}_i(\\mathbf{r}) b_k(t) $$\n在特定的时间区间 $[t_j, t_{j+1}]$ 内，我们有 $b_k(t) = \\delta_{kj}$ (克罗内克 δ)，因此电流在时间上是恒定的：\n$$ \\mathbf{J}(\\mathbf{r},t) = \\sum_{i} I_{i,j} \\mathbf{f}_i(\\mathbf{r}) \\quad \\text{for } t \\in [t_j, t_{j+1}] $$\n将此代入第一项：\n$$ \\int_{t_j}^{t_{j+1}} \\int_{T_n} \\nabla \\cdot \\left( \\sum_{i} I_{i,j} \\mathbf{f}_i(\\mathbf{r}) \\right) dS \\, dt $$\n由于被积函数在该区间内随时间是恒定的，时间积分产生一个因子 $\\Delta t$。我们还可以利用散度算子和积分算子的线性性质：\n$$ \\Delta t \\sum_{i} I_{i,j} \\int_{T_n} \\nabla \\cdot \\mathbf{f}_i(\\mathbf{r}) \\, dS $$\n问题定义了邻接-方向矩阵 $S$，其元素为 $S_{n,i} = \\int_{T_n} \\nabla \\cdot \\mathbf{f}_i(\\mathbf{r}) \\, dS$。这些元素的值为 $+1$、$-1$ 或 $0$。因此，第一项简化为：\n$$ \\Delta t \\sum_{i} S_{n,i} I_{i,j} $$\n该项表示在时间区间 $[t_j, t_{j+1}]$ 内，根据电流系数 $I_{i,j}$ 计算出的流出三角形 $T_n$ 的总电荷。\n\n现在，让我们分析涉及电荷密度 $\\rho$ 的第二项。我们可以交换积分顺序：\n$$ \\int_{T_n} \\left( \\int_{t_j}^{t_{j+1}} \\frac{\\partial \\rho(\\mathbf{r},t)}{\\partial t} \\, dt \\right) dS $$\n根据微积分基本定理，内部积分计算得出该区间内电荷密度的变化：\n$$ \\int_{t_j}^{t_{j+1}} \\frac{\\partial \\rho(\\mathbf{r},t)}{\\partial t} \\, dt = \\rho(\\mathbf{r}, t_{j+1}) - \\rho(\\mathbf{r}, t_j) $$\n将其代回，第二项变为：\n$$ \\int_{T_n} \\left( \\rho(\\mathbf{r}, t_{j+1}) - \\rho(\\mathbf{r}, t_j) \\right) dS = \\int_{T_n} \\rho(\\mathbf{r}, t_{j+1}) \\, dS - \\int_{T_n} \\rho(\\mathbf{r}, t_j) \\, dS $$\n问题将区间 $k$ 末尾的三角形积分电荷定义为 $Q_{n,k} = \\int_{T_n} \\rho(\\mathbf{r}, t_{k+1}) \\, dS$。注意区间 $k$ 的末尾是时间 $t_{k+1}$。因此，当前区间 $j$ 末尾（在时间 $t_{j+1}$）的电荷是 $Q_{n,j}$，而区间 $j$ 开始时（在时间 $t_j$，即区间 $j-1$ 的末尾）的电荷是 $Q_{n,j-1}$。\n因此，第二项是存储在三角形 $T_n$ 上的总电荷的变化：\n$$ Q_{n,j} - Q_{n,j-1} $$\n\n结合这两个简化项，我们得到每个三角形 $n$ 和时间区间 $j$ 的离散电荷守恒定律：\n$$ (Q_{n,j} - Q_{n,j-1}) + \\Delta t \\sum_{i} S_{n,i} I_{i,j} = 0 $$\n该方程表明，一个三角形上存储电荷的增加量必须等于流入该三角形的净电荷量。\n\n残差 $R_{n,j}$ 是给定数值数据违反此离散定律的量：\n$$ R_{n,j} = (Q_{n,j} - Q_{n,j-1}) + \\Delta t \\sum_{i} S_{n,i} I_{i,j} $$\n任务是为提供了数据的每个三角形 $n$ 和每个时间区间 $j$ 计算此残差，然后找出所有这些残差中的最大绝对值。\n\n对于给定的时间区间 $j$，使用矩阵-向量表示法，设 $\\mathbf{Q}_j$ 为时间 $t_{j+1}$ 时所有三角形上的电荷列向量，$\\mathbf{I}_j$ 为所有边上的电流系数的列向量，$S$ 为邻接-方向矩阵。区间 $j$ 的残差向量 $\\mathbf{R}_j$ 为：\n$$ \\mathbf{R}_j = (\\mathbf{Q}_j - \\mathbf{Q}_{j-1}) + \\Delta t \\cdot S \\mathbf{I}_j $$\n每个测试用例的最终结果则是 $\\max_{j} (\\max|\\mathbf{R}_j|)$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by calculating the maximum absolute charge continuity residual\n    for a series of test cases based on a discretized time-domain integral equation formulation.\n    \"\"\"\n\n    test_cases = [\n        # Test Case 1: Happy path\n        {\n            \"S\": np.array([[1], [-1]]),\n            \"dt\": 1.0,\n            \"currents\": [np.array([1.5]), np.array([-0.5])],\n            \"charges\": [np.array([0.0, 0.0]), np.array([-1.5, 1.5]), np.array([-1.0, 1.0])]\n        },\n        # Test Case 2: Intentional mismatch\n        {\n            \"S\": np.array([[1], [-1]]),\n            \"dt\": 1.0,\n            \"currents\": [np.array([1.5]), np.array([-0.5])],\n            \"charges\": [np.array([0.0, 0.0]), np.array([-1.5, 1.5]), np.array([-1.1, 0.9])]\n        },\n        # Test Case 3: Multi-edge coupling\n        {\n            \"S\": np.array([[1, 0], [-1, 1], [0, -1]]),\n            \"dt\": 0.5,\n            \"currents\": [np.array([2.0, 1.0]), np.array([0.0, -1.0]), np.array([-2.0, 0.0])],\n            \"charges\": [\n                np.array([0.0, 0.0, 0.0]),\n                np.array([-1.0, 0.5, 0.5]),\n                np.array([-1.0, 1.0, 0.0]),\n                np.array([0.0, 0.0, 0.0])\n            ]\n        }\n    ]\n\n    def calculate_max_residual(case):\n        \"\"\"\n        Calculates the maximum absolute residual for a single test case.\n\n        The residual R_nj for triangle n and interval j is given by:\n        R_nj = (Q_nj - Q_n,j-1) + dt * sum_i(S_ni * I_ij)\n        where Q_nj is the integrated charge on triangle n at the end of interval j,\n        I_ij is the current coefficient for edge i during interval j, and S is the\n        adjacency-orientation matrix.\n        \"\"\"\n        S = case[\"S\"]\n        dt = case[\"dt\"]\n        currents_per_interval = case[\"currents\"]\n        charges_at_time_points = case[\"charges\"]\n        \n        num_intervals = len(currents_per_interval)\n        max_abs_residual = 0.0\n\n        for j in range(num_intervals):\n            # Q_j-1: charge at the start of interval j (time t_j)\n            Q_j_minus_1 = charges_at_time_points[j]\n            # Q_j: charge at the end of interval j (time t_j+1)\n            Q_j = charges_at_time_points[j+1]\n            # I_j: current coefficients during interval j\n            I_j = currents_per_interval[j]\n            \n            # Change in stored charge on each triangle over the interval\n            delta_Q_stored = Q_j - Q_j_minus_1\n            \n            # Total charge flow from currents on each triangle over the interval\n            # S @ I_j calculates the net current flux for each triangle\n            delta_Q_flow = dt * (S @ I_j)\n            \n            # Residual vector for the current interval\n            residual_vector = delta_Q_stored + delta_Q_flow\n            \n            # Update the maximum absolute residual found so far\n            current_max = np.max(np.abs(residual_vector))\n            if current_max > max_abs_residual:\n                max_abs_residual = current_max\n                \n        return max_abs_residual\n\n    results = []\n    for case in test_cases:\n        result = calculate_max_residual(case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.17f}'.rstrip('0').rstrip('.') for r in results)}]\")\n\nsolve()\n```", "id": "3355680"}, {"introduction": "一个稳定可靠的数值方案不仅要能守恒基本物理量，还应能高保真地模拟物理过程。本练习探讨了时域离散化引入的一种常见数值误差——数值色散，它会导致模拟波形与真实波形之间产生相位偏差[@problem_id:3355661]。通过分析和计算不同时间基函数引入的相位误差，您将深入理解数值精度与算法选择之间的关系，并学会量化评估模拟结果的保真度。", "problem": "考虑一个角频率为 $\\omega$ 的单色平面波，垂直入射到一个无限大的完美电导体 (PEC) 平板上。物理边界条件，即 PEC 表面上的切向电场为零，通过时域积分方程 (TDIE) 表示为在所有时间 $t$ 内，表面上的总切向电场等于零，即 $E_{\\text{tan}}(t) = E_{\\text{inc}}(t) + E_{\\text{scat}}(t) = 0$。在连续时间频域极限下，这强制了精确的反射系数为 $-1$，即在表面上，反射场相对于入射场有 $\\pi$ 的相移。\n\n在计算电磁学中，时域步进 (marching-on-in-time) TDIE 公式通常使用时间基函数 $b_j(t)$ 来表示表面电流密度，并在每个时间间隔内以弱（测试）意义上强制执行边界条件。当使用时间基 $b(t)$ 并在其支撑域上测试场时，单色信号 $e^{-i \\omega t}$ 的贡献会由 $b(t)$ 的归一化傅里叶变换进行加权，这会在有效强制执行中引入数值色散和相位误差。本问题要求您推导两种时间基选择所引入的相位误差，并计算和比较指定测试案例下产生的相位误差。\n\n在一维表面法线方向上进行分析，假设时间步长 $\\Delta t > 0$ 是均匀的，并考虑以下时间基函数：\n\n- 单个区间上的分段常数（零阶）基 $b_0(t)$，\n$$\nb_0(t) = \n\\begin{cases}\n1,  0 \\le t  \\Delta t,\\\\\n0,  \\text{其他情况},\n\\end{cases}\n$$\n其归一化傅里叶变换为\n$$\nB_0(\\omega) = \\frac{1}{\\Delta t}\\int_{0}^{\\Delta t} e^{-i \\omega t}\\, dt.\n$$\n\n- 跨越两个连续区间的分段线性（一阶，帽状）基 $b_1(t)$，\n$$\nb_1(t) = \n\\begin{cases}\nt/\\Delta t,  0 \\le t  \\Delta t,\\\\\n2 - t/\\Delta t,  \\Delta t \\le t  2\\Delta t,\\\\\n0,  \\text{其他情况},\n\\end{cases}\n$$\n其归一化傅里叶变换为\n$$\nB_1(\\omega) = \\frac{1}{\\Delta t}\\int_{0}^{2\\Delta t} b_1(t)\\, e^{-i \\omega t}\\, dt.\n$$\n\n任务：\n\n1. 从麦克斯韦方程组和 PEC 边界条件 $E_{\\text{tan}}(t) = 0$ 出发，解释为什么当在一个时间基 $b(t)$ 上以测试方式强制执行边界条件时，数值强制会引入一个等于所选 $b(t)$ 的归一化傅里叶变换 $B(\\omega)$ 的额外复数因子。论证对于单色激励 $e^{-i \\omega t}$ 和精确的空间表示，通过使用 $b(t)$ 进行时间测试所引入的数值相位误差由下式给出\n$$\n\\delta \\phi(\\omega) = \\arg\\left(B(\\omega)\\right),\n$$\n以弧度表示。\n\n2. 推导 $B_0(\\omega)$ 和 $B_1(\\omega)$ 的闭式表达式，并简化它们以表明\n$$\nB_0(\\omega) = e^{-i \\omega \\Delta t/2}\\, \\mathrm{sinc}\\!\\left(\\frac{\\omega \\Delta t}{2}\\right),\n\\qquad\nB_1(\\omega) = e^{-i \\omega \\Delta t}\\, \\mathrm{sinc}^2\\!\\left(\\frac{\\omega \\Delta t}{2}\\right),\n$$\n其中 $\\mathrm{sinc}(x) = \\frac{\\sin x}{x}$。\n\n3. 使用任务2中的表达式和任务1中的定义，分别计算分段常数基和分段线性基的数值相位误差 $\\delta \\phi_0(\\omega)$ 和 $\\delta \\phi_1(\\omega)$。所有相位误差均以弧度表示。\n\n4. 实现一个程序，为以下每个由频率 $f$ 和时间步长 $\\Delta t$ 指定的测试案例计算 $\\delta \\phi_0(\\omega)$ 和 $\\delta \\phi_1(\\omega)$，其中 $\\omega = 2\\pi f$。所有频率必须以赫兹（Hertz）为单位提供，所有时间步长必须以秒（seconds）为单位提供；相位误差以弧度表示。每个测试案例的最终结果应四舍五入到 $12$ 位小数。测试套件如下：\n\n- 测试案例 A（一般情况）：$f = 1\\,\\mathrm{GHz}$，$\\Delta t = 50\\,\\mathrm{ps}$。\n- 测试案例 B（奈奎斯特边界）：$f = 5\\,\\mathrm{GHz}$，$\\Delta t = 100\\,\\mathrm{ps}$。\n- 测试案例 C（低频，小步长）：$f = 100\\,\\mathrm{MHz}$，$\\Delta t = 10\\,\\mathrm{ps}$。\n- 测试案例 D（接近半$\\pi$的适中情况）：$f = 3\\,\\mathrm{GHz}$，$\\Delta t = 75\\,\\mathrm{ps}$。\n- 测试案例 E（接近奈奎斯特的高频）：$f = 4.5\\,\\mathrm{GHz}$，$\\Delta t = 100\\,\\mathrm{ps}$。\n\n5. 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每个测试案例的结果必须是一个包含两个浮点数的列表，单位为弧度，顺序为 $[\\delta \\phi_0, \\delta \\phi_1]$，四舍五入到 $12$ 位小数。例如，整体输出必须类似于\n$$\n[\\,[\\delta \\phi_0^{(A)}, \\delta \\phi_1^{(A)}], [\\delta \\phi_0^{(B)}, \\delta \\phi_1^{(B)}], \\ldots\\,]\n$$\n无任何附加文本。\n\n输入中使用的所有物理单位必须得到遵守，输出必须以弧度为单位。角度必须以弧度表示，而非度。输出中任何地方都不得出现百分比。确保算法在计算 $\\mathrm{sinc}(\\cdot)$ 时能安全地处理 $\\omega \\Delta t \\to 0$ 的极限情况。", "solution": "问题陈述已经过验证，被认为是有效的。它在科学上基于计算电磁学，问题提出得当，提供了所有必要信息，并且其表述是客观的。各项任务逻辑结构清晰，能够导出一个唯一的、可验证的解。\n\n解题过程按顺序处理每个指定的任务。\n\n### 任务 1：相位误差公式的论证\n\n用于完美电导体 (PEC) 散射体的时域积分方程 (TDIE) 方法的核心，是在所有时间 $t$ 内，在导体表面 $S$ 上强制执行总切向电场为零的边界条件：\n$$E_{\\text{tan}}(\\mathbf{r}, t) = E_{\\text{inc,tan}}(\\mathbf{r}, t) + E_{\\text{scat,tan}}(\\mathbf{r}, t) = 0, \\quad \\mathbf{r} \\in S, \\forall t$$\n散射场 $E_{\\text{scat}}$ 是由入射场感应出的表面电流密度 $J_s$ 产生的。这种关系由一个线性积分-微分算子 $\\mathcal{L}$ 表示，使得 $E_{\\text{scat,tan}}(\\mathbf{r}, t) = \\mathcal{L}\\{J_s(\\mathbf{r}, t)\\}$。因此，求解 $J_s$ 的方程为：\n$$\\mathcal{L}\\{J_s(\\mathbf{r}, t)\\} = -E_{\\text{inc,tan}}(\\mathbf{r}, t), \\quad \\mathbf{r} \\in S$$\n在数值矩量法 (MoM) 框架中，未知的连续函数 $J_s$ 由一系列基函数近似。方程不是在空间和时间的每个点上强制执行，而是在“弱”或“测试”意义上强制执行。这涉及将方程投影到一组测试函数上。对于伽辽金 (Galerkin) 方案，测试函数与基函数相同。\n\n问题陈述指出，使用时间基函数 $b(t)$ 进行测试。当我们在 $b(t)$ 的支撑域（或其时移版本）上测试边界条件时，我们强制：\n$$\\int_{-\\infty}^{\\infty} b(t-t_n) \\left[ E_{\\text{inc,tan}}(t) + E_{\\text{scat,tan}}(t) \\right] dt = 0$$\n对于离散的时间步长 $t_n$。让我们考虑一个单色入射场 $E_{\\text{inc,tan}}(t) = E_0 e^{-i\\omega t}$。测试的入射场项是：\n$$\\int_{-\\infty}^{\\infty} b(t-t_n) E_0 e^{-i\\omega t} dt$$\n通过替换 $\\tau = t-t_n$，这变成：\n$$E_0 \\int_{-\\infty}^{\\infty} b(\\tau) e^{-i\\omega (\\tau+t_n)} d\\tau = E_0 e^{-i\\omega t_n} \\int_{-\\infty}^{\\infty} b(\\tau) e^{-i\\omega \\tau} d\\tau$$\n该积分为基函数 $b(t)$ 的标准傅里叶变换。根据问题对归一化傅里叶变换的定义 $B(\\omega) = \\frac{1}{\\Delta t} \\int b(t) e^{-i \\omega t} dt$，该积分等于 $\\Delta t \\cdot B(\\omega)$。因此，在第 $n$ 步的测试入射场为 $(E_0 e^{-i\\omega t_n}) \\cdot (\\Delta t \\cdot B(\\omega))$。\n\n在时间 $t_n$ 的物理入射场就是 $E_0 e^{-i\\omega t_n}$。时间测试过程的效果是将物理场乘以一个复数因子 $\\Delta t \\cdot B(\\omega)$。常实数因子 $\\Delta t$ 通常被吸收到系统矩阵的定义中。剩下的复数因子 $B(\\omega)$ 修改了数值系统所强制的入射场和散射场之间的相位和幅度关系。\n\n对于垂直入射到无限 PEC 平板上的平面波，精确的物理反射过程由反射系数 $R_{\\text{exact}} = -1 = e^{i\\pi}$ 描述。这意味着 $\\pi$ 弧度的相移，且幅度没有变化。然而，数值方案强制执行的条件被复数因子 $B(\\omega)$ 有效地修改了。数值反射系数可以认为是 $R_{\\text{num}}(\\omega) = R_{\\text{exact}} \\cdot B(\\omega) = -B(\\omega)$。\n\n数值反射系数的相位为 $\\arg(R_{\\text{num}}(\\omega)) = \\arg(-1) + \\arg(B(\\omega)) = \\pi + \\arg(B(\\omega))$。相位误差 $\\delta\\phi$ 是数值方法引入的附加相位，即数值相位与精确相位之差：\n$$\\delta\\phi(\\omega) = \\arg(R_{\\text{num}}(\\omega)) - \\arg(R_{\\text{exact}}) = (\\pi + \\arg(B(\\omega))) - \\pi = \\arg(B(\\omega))$$\n这证实了问题陈述中给出的相位误差表达式。\n\n### 任务 2：$B_0(\\omega)$ 和 $B_1(\\omega)$ 的推导\n\n我们现在推导分段常数和分段线性基函数的归一化傅里叶变换的闭式表达式。\n\n对于分段常数（零阶）基 $b_0(t)$：\n$$B_0(\\omega) = \\frac{1}{\\Delta t}\\int_{0}^{\\Delta t} (1) \\cdot e^{-i \\omega t}\\, dt = \\frac{1}{\\Delta t} \\left[ \\frac{e^{-i\\omega t}}{-i\\omega} \\right]_0^{\\Delta t}$$\n$$B_0(\\omega) = \\frac{1}{-i\\omega\\Delta t} (e^{-i\\omega\\Delta t} - 1) = \\frac{1}{i\\omega\\Delta t} (1 - e^{-i\\omega\\Delta t})$$\n为了用 sinc 函数表示，我们从分子中提出一个相位项：\n$$1 - e^{-i\\omega\\Delta t} = e^{-i\\omega\\Delta t/2}(e^{i\\omega\\Delta t/2} - e^{-i\\omega\\Delta t/2}) = e^{-i\\omega\\Delta t/2}(2i\\sin(\\omega\\Delta t/2))$$\n将此代回 $B_0(\\omega)$ 的表达式中：\n$$B_0(\\omega) = \\frac{1}{i\\omega\\Delta t} \\left[ e^{-i\\omega\\Delta t/2}(2i\\sin(\\omega\\Delta t/2)) \\right] = e^{-i\\omega\\Delta t/2} \\frac{2\\sin(\\omega\\Delta t/2)}{\\omega\\Delta t}$$\n使用定义 $\\mathrm{sinc}(x) = (\\sin x)/x$：\n$$B_0(\\omega) = e^{-i\\omega\\Delta t/2} \\frac{\\sin(\\omega\\Delta t/2)}{\\omega\\Delta t/2} = e^{-i \\omega \\Delta t/2}\\, \\mathrm{sinc}\\!\\left(\\frac{\\omega \\Delta t}{2}\\right)$$\n\n对于分段线性（一阶）基 $b_1(t)$，直接积分虽然可行但很繁琐。一种更巧妙的方法是利用卷积定理。三角形帽状函数 $b_1(t)$ 可以构造为矩形窗函数 $b_0(t)$ 的缩放自卷积。设 $b_{0,\\Delta t}(t)$ 为未缩放的窗函数，在 $[0, \\Delta t]$ 上等于 $1$，其他地方为 $0$。其与自身的卷积是：\n$$(b_{0,\\Delta t} * b_{0,\\Delta t})(t) = \\int_{-\\infty}^{\\infty} b_{0,\\Delta t}(\\tau) b_{0,\\Delta t}(t-\\tau) d\\tau = \\begin{cases} t,  0 \\le t  \\Delta t \\\\ 2\\Delta t-t,  \\Delta t \\le t  2\\Delta t \\\\ 0,  \\text{其他情况} \\end{cases}$$\n这是一个在 $t=\\Delta t$ 处高度为 $\\Delta t$ 的三角形函数。基函数 $b_1(t)$ 是这个三角形函数按 $1/\\Delta t$ 缩放以获得单位峰值：\n$$b_1(t) = \\frac{1}{\\Delta t} (b_{0,\\Delta t} * b_{0,\\Delta t})(t)$$\n设 $\\mathcal{F}$ 表示傅里叶变换算子 $\\int(\\cdot)e^{-i\\omega t}dt$。根据卷积定理，$\\mathcal{F}\\{f*g\\} = \\mathcal{F}\\{f\\}\\mathcal{F}\\{g\\}$。\n$$\\mathcal{F}\\{b_1(t)\\} = \\frac{1}{\\Delta t} \\mathcal{F}\\{b_{0,\\Delta t}\\}^2$$\n我们知道 $\\mathcal{F}\\{b_{0,\\Delta t}\\} = \\Delta t \\cdot B_0(\\omega)$。将其代入：\n$$\\mathcal{F}\\{b_1(t)\\} = \\frac{1}{\\Delta t} (\\Delta t \\cdot B_0(\\omega))^2 = \\Delta t \\cdot B_0(\\omega)^2$$\n归一化变换 $B_1(\\omega)$ 定义为 $B_1(\\omega) = \\frac{1}{\\Delta t} \\mathcal{F}\\{b_1(t)\\}$。因此：\n$$B_1(\\omega) = \\frac{1}{\\Delta t} (\\Delta t \\cdot B_0(\\omega)^2) = B_0(\\omega)^2$$\n代入已推导出的 $B_0(\\omega)$ 表达式：\n$$B_1(\\omega) = \\left( e^{-i \\omega \\Delta t/2}\\, \\mathrm{sinc}\\!\\left(\\frac{\\omega \\Delta t}{2}\\right) \\right)^2 = e^{-i \\omega \\Delta t}\\, \\mathrm{sinc}^2\\!\\left(\\frac{\\omega \\Delta t}{2}\\right)$$\n两个推导都与问题陈述中提供的表达式相匹配。\n\n### 任务 3：数值相位误差 $\\delta\\phi_0(\\omega)$ 和 $\\delta\\phi_1(\\omega)$\n\n相位误差 $\\delta\\phi$ 是复函数 $B(\\omega)$ 的辐角。\n对于分段常数基：\n$$\\delta\\phi_0(\\omega) = \\arg(B_0(\\omega)) = \\arg\\left( e^{-i\\omega\\Delta t/2} \\mathrm{sinc}\\!\\left(\\frac{\\omega\\Delta t}{2}\\right) \\right)$$\nsinc 函数 $\\mathrm{sinc}(x)$ 是实值函数。为了保证时域步进方案的数值稳定性，必须选择时间步长 $\\Delta t$ 来解析感兴趣的最高频率 $\\omega_{\\max}$。Courant-Friedrichs-Lewy (CFL) 条件通常要求 $\\Delta t$ 足够小，以至于 $\\omega_{\\max} \\Delta t  \\pi$。在此条件下，sinc 函数的参数 $x = \\omega\\Delta t/2$ 位于区间 $(-\\pi/2, \\pi/2)$ 内，其中 $\\mathrm{sinc}(x)$ 严格为正。对于给定的测试案例，$\\omega\\Delta t$ 的最大值为 $\\pi$（在奈奎斯特极限下），所以 $\\omega\\Delta t/2 \\le \\pi/2$，且 $\\mathrm{sinc}(\\omega\\Delta t/2) \\ge \\mathrm{sinc}(\\pi/2) = 2/\\pi  0$。\n由于 sinc 项为正实数，其辐角为 $0$。$B_0(\\omega)$ 的相位完全由复指数项决定：\n$$\\delta\\phi_0(\\omega) = \\arg(e^{-i\\omega\\Delta t/2}) = -\\frac{\\omega\\Delta t}{2}$$\n\n对于分段线性基：\n$$\\delta\\phi_1(\\omega) = \\arg(B_1(\\omega)) = \\arg\\left( e^{-i\\omega\\Delta t} \\mathrm{sinc}^2\\!\\left(\\frac{\\omega\\Delta t}{2}\\right) \\right)$$\n项 $\\mathrm{sinc}^2(\\omega\\Delta t/2)$ 是一个实数的平方，所以它总为非负数。对于感兴趣的频率，它严格为正。因此，其辐角为 $0$。$B_1(\\omega)$ 的相位完全由复指数决定：\n$$\\delta\\phi_1(\\omega) = \\arg(e^{-i\\omega\\Delta t}) = -\\omega\\Delta t$$\n一阶基的相位误差恰好是零阶基的两倍。这对应于 $b_0(t)$ 的有效数值时间延迟为 $\\Delta t/2$，$b_1(t)$ 的有效数值时间延迟为 $\\Delta t$，这与相应基函数的时间质心相匹配。\n\n### 任务 4  5：实现与输出\n\n使用任务3的结果和关系式 $\\omega = 2\\pi f$，要计算的相位误差为：\n$$\\delta\\phi_0(f, \\Delta t) = -\\frac{(2\\pi f)\\Delta t}{2} = -\\pi f \\Delta t$$\n$$\\delta\\phi_1(f, \\Delta t) = -(2\\pi f)\\Delta t = -2\\pi f \\Delta t$$\n这些简单的表达式在计算上是鲁棒的，并且避免了直接计算 sinc 函数，满足了安全处理 $\\omega\\Delta t \\to 0$ 极限的指令。将实现一个 Python 程序来为指定的测试案例计算这些值，输入 $f$ 以赫兹为单位，$\\Delta t$ 以秒为单位，输出以弧度为单位的相位误差，并四舍五入到 $12$ 位小数。输出将格式化为表示列表的列表的单行字符串。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the numerical phase errors for piecewise-constant and piecewise-linear\n    temporal basis functions in a time-domain integral equation formulation.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Each tuple contains (frequency in Hz, time step in seconds).\n    test_cases = [\n        # Test case A: f = 1 GHz, Δt = 50 ps\n        (1.0e9, 50.0e-12),\n        # Test case B: f = 5 GHz, Δt = 100 ps (Nyquist boundary)\n        (5.0e9, 100.0e-12),\n        # Test case C: f = 100 MHz, Δt = 10 ps\n        (100.0e6, 10.0e-12),\n        # Test case D: f = 3 GHz, Δt = 75 ps\n        (3.0e9, 75.0e-12),\n        # Test case E: f = 4.5 GHz, Δt = 100 ps\n        (4.5e9, 100.0e-12),\n    ]\n\n    results = []\n    for f, dt in test_cases:\n        # The angular frequency is omega = 2 * pi * f.\n        # The phase error for the piecewise-constant (0-order) basis is:\n        # delta_phi_0 = - (omega * dt) / 2 = -pi * f * dt\n        delta_phi_0 = -np.pi * f * dt\n\n        # The phase error for the piecewise-linear (1st-order) basis is:\n        # delta_phi_1 = -omega * dt = -2 * pi * f * dt\n        delta_phi_1 = -2 * np.pi * f * dt\n\n        # Round results to 12 decimal places as required.\n        rounded_phi_0 = round(delta_phi_0, 12)\n        rounded_phi_1 = round(delta_phi_1, 12)\n\n        results.append([rounded_phi_0, rounded_phi_1])\n\n    # Format the output string precisely as required: [[r1_0,r1_1],[r2_0,r2_1],...]\n    # We build the string manually to avoid spaces that `str(list)` might introduce.\n    inner_strs = [f\"[{r[0]},{r[1]}]\" for r in results]\n    final_output_str = f\"[{','.join(inner_strs)}]\"\n\n    print(final_output_str)\n\nsolve()\n```", "id": "3355661"}]}