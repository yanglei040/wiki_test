{"hands_on_practices": [{"introduction": "Nédélec（或称为“边”）单元是计算电磁学中用于 $H(\\mathrm{curl})$ 协调离散化的基石。在深入研究复杂应用之前，至关重要的是从第一性原理理解这些单元的构造。本练习将指导您在一个简单的参考单元（四面体）上推导这些矢量基函数，验证其关键的切向连续性属性，并利用它们对给定的矢量场进行插值[@problem_id:3329964]。", "problem": "考虑一个用于计算电磁学 (CEM) 的有限元方法 (FEM) 中的单个四面体单元。设参考四面体的顶点为 $v_{1} = (0,0,0)$、$v_{2} = (1,0,0)$、$v_{3} = (0,1,0)$ 和 $v_{4} = (0,0,1)$，六条有向边取为 $(1,2)$、$(1,3)$、$(1,4)$、$(2,3)$、$(2,4)$ 和 $(3,4)$，每条边都从低索引顶点指向高索引顶点。设重心坐标为 $\\lambda_{1} = 1 - x - y - z$、$\\lambda_{2} = x$、$\\lambda_{3} = y$ 和 $\\lambda_{4} = z$，其对应的常梯度为 $\\nabla \\lambda_{1}$、$\\nabla \\lambda_{2}$、$\\nabla \\lambda_{3}$ 和 $\\nabla \\lambda_{4}$。\n\n四面体上的 1 阶第一类 Nédélec 边基 $H(\\mathrm{curl})$-协调基的特征在于，与每条边关联的矢量形函数，在其关联的有向边上的切向线积分为 1，而在所有其他边上的切向线积分为 0。仅使用这些定义性质和重心坐标提供的结构，完成以下任务：\n\n1. 为参考四面体的六条有向边构造显式的局部边基矢量形函数。你的构造必须基于重心坐标及其梯度的第一性原理推导得出，并且必须满足第一类 Nédélec 函数的切向积分定义性质。\n\n2. 对每个构造出的形函数，计算其在每条有向边上的切向迹，并证明其切向分量的线积分在所有六条边上满足 Kronecker delta 性质。\n\n3. 设线性矢量场为\n$$\n\\mathbf{E}(x,y,z) = \\begin{pmatrix}\nx + 2y + 3z + 1 \\\\\n2x + 3y + z + 2 \\\\\n3x + y + 2z + 3\n\\end{pmatrix}.\n$$\n通过计算六个边自由度 (DoF)，即对于边 $(i,j) \\in \\{(1,2),(1,3),(1,4),(2,3),(2,4),(3,4)\\}$ 的有向切向线积分 $\\int_{e_{ij}} \\mathbf{E} \\cdot \\hat{\\mathbf{t}}_{ij} \\, \\mathrm{d}s$（其中 $\\hat{\\mathbf{t}}_{ij}$ 表示从顶点 $v_{i}$ 到 $v_{j}$ 的边的单位切向量），来计算其在参考四面体上的第一类 Nédélec 插值。然后将该插值函数表示为您构造的六个边形函数与这些系数的线性组合。\n\n报告由六个插值系数 $(c_{12}, c_{13}, c_{14}, c_{23}, c_{24}, c_{34})$ 组成的有序行矩阵作为您的最终答案，要求使用精确值，不进行四舍五入。本问题不涉及物理单位。", "solution": "用户提供了一个来自计算电磁学领域的有效且适定的问题。该问题要求在参考四面体上构造和验证第一类 Nédélec 基函数，并对给定的矢量场进行插值。\n\n### 基函数与自由度\n参考四面体顶点为 $v_{1}(0,0,0), v_{2}(1,0,0), v_{3}(0,1,0), v_{4}(0,0,1)$。一阶Nédélec基函数 $\\mathbf{N}_{ij}$ 与边 $e_{ij}$ 相关联，其形式为 $\\mathbf{N}_{ij} = \\lambda_i \\nabla\\lambda_j - \\lambda_j \\nabla\\lambda_i$，使用重心坐标 $\\lambda_k$ 及其梯度构造。该构造保证了正确的切向连续性。\n\n插值需要计算六个边自由度 (DOF) $c_{ij} = \\int_{e_{ij}} \\mathbf{E} \\cdot d\\mathbf{l}$，其中 $\\mathbf{E}(x,y,z) = (x + 2y + 3z + 1, 2x + 3y + z + 2, 3x + y + 2z + 3)^T$。\n\n### 插值计算\n对每条有向边进行线积分：\n1.  **边 $e_{12}$**: $\\mathbf{r}(t) = (t,0,0)$, $t\\in[0,1]$.\n    $c_{12} = \\int_0^1 (t+1) dt = \\frac{3}{2}$。\n\n2.  **边 $e_{13}$**: $\\mathbf{r}(t) = (0,t,0)$, $t\\in[0,1]$.\n    $c_{13} = \\int_0^1 (3t+2) dt = \\frac{7}{2}$。\n\n3.  **边 $e_{14}$**: $\\mathbf{r}(t) = (0,0,t)$, $t\\in[0,1]$.\n    $c_{14} = \\int_0^1 (2t+3) dt = 4$。\n\n4.  **边 $e_{23}$**: $\\mathbf{r}(t) = (1-t,t,0)$, $t\\in[0,1]$.\n    $c_{23} = \\int_0^1 2 dt = 2$。\n\n5.  **边 $e_{24}$**: $\\mathbf{r}(t) = (1-t,0,t)$, $t\\in[0,1]$.\n    $c_{24} = \\int_0^1 (-3t+4) dt = \\frac{5}{2}$。\n\n6.  **边 $e_{34}$**: $\\mathbf{r}(t) = (0,1-t,t)$, $t\\in[0,1]$.\n    $c_{34} = \\int_0^1 (3t-1) dt = \\frac{1}{2}$。\n\n这些系数构成了最终答案中的有序行矩阵。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{3}{2} & \\frac{7}{2} & 4 & 2 & \\frac{5}{2} & \\frac{1}{2}\n\\end{pmatrix}\n}\n$$", "id": "3329964"}, {"introduction": "在实际工程问题中，为了高效地对复杂区域进行离散，网格通常包含不同类型的单元（例如四面体和棱柱体）。这项实践旨在解决一个关键的工程挑战：确保在这些混合单元交界面上的切向场连续性。通过实现一个稳健的局部到全局自由度(DOF)映射方案，您将掌握任何实用有限元求解器中的一个核心组件[@problem_id:3329977]。", "problem": "给定一个三维空间中的混合单元网格，由四面体和三棱柱单元组成。未知场是旋度协调子空间中的电场（在有限元法（FEM）中通常通过基于边的 Nédélec 单元实现）。与每个单元相关的自由度（DOF）是电场沿有向边的线积分。全局组装需要一个一致的全局编号和边的方向，以便在麦克斯韦方程组推导的边界条件的意义上，界面上的切向连续性条件得到满足。具体来说，当没有表面电流时，电场的切向分量在材料界面上是连续的，这是通过为相邻单元间的每个几何边共享一个具有一致方向约定的共同全局自由度来强制实现的。\n\n从以下原则出发：\n- 设电场表示为 $\\mathbf{E}(\\mathbf{x})$。对于一个旋度协调的一阶 Nédélec 单元，自由度是 $\\mathbf{E}$ 的边积分：对于一个端点为 $\\mathbf{a}$ 和 $\\mathbf{b}$、切线为 $\\mathbf{t} = \\mathbf{b} - \\mathbf{a}$ 的有向边，其自由度为 $\\int_{0}^{1} \\mathbf{E}(\\mathbf{a} + s(\\mathbf{b} - \\mathbf{a})) \\cdot (\\mathbf{b} - \\mathbf{a}) \\,\\mathrm{d}s$。如果 $\\mathbf{E}$ 是常数 $\\mathbf{E} = \\mathbf{E}_0$，则简化为 $\\mathbf{E}_0 \\cdot (\\mathbf{b} - \\mathbf{a})$。\n- 一个全局边方向约定为每个几何边分配一个唯一的方向，每个单元的局部边方向贡献一个符号 $\\sigma \\in \\{+1,-1\\}$，用于将局部自由度映射到全局自由度，这取决于局部方向是否与全局方向一致。\n\n您的任务是设计并验证一个自由度映射，该映射能够在四面体单元和三棱柱单元之间的界面上保持切向场的连续性，并确保边方向和全局编号的一致性。请使用一种基于上述原则的算法方法，该方法应：\n- 通过为每个几何边分配一个唯一标识符来构建全局边编号，使用由递增的节点索引 $(\\min(i,j) \\rightarrow \\max(i,j))$ 定义的规范方向。\n- 对于每个单元，将其每个局部边自由度映射到其全局边标识符，并关联一个符号 $\\sigma$。如果局部方向与全局方向匹配，则 $\\sigma$ 为 $+1$，否则为 $-1$。\n- 通过检查两个单元之间每个共享几何边的有向边积分（在一个测试场 $\\mathbf{E}$ 下）在应用局部符号并映射到全局自由度后是否一致，来验证界面上的切向连续性。具体来说，对于每个共享边，其局部积分为 $I_{\\mathrm{tet}}$ 和 $I_{\\mathrm{prism}}$，符号为 $\\sigma_{\\mathrm{tet}}$ 和 $\\sigma_{\\mathrm{prism}}$，验证 $\\sigma_{\\mathrm{tet}} I_{\\mathrm{tet}}$ 是否在容差 $\\epsilon$ 内等于 $\\sigma_{\\mathrm{prism}} I_{\\mathrm{prism}}$。\n- 通过检查每个共享几何边是否被两个单元分配了相同的全局边标识符，来验证界面上边方向和编号的一致性。\n\n使用恒定测试场 $\\mathbf{E} = [1,2,3]^\\top$。对于三棱柱单元，使用局部顶点排序 $(v_0,v_1,v_2,v_3,v_4,v_5)$，其中 $(v_0,v_1,v_2)$ 是底部三角形面的顶点，$(v_3,v_4,v_5)$ 是对应的顶部面的顶点。其局部边为：底面边 $(v_0,v_1)$, $(v_1,v_2)$, $(v_2,v_0)$；顶面边 $(v_3,v_4)$, $(v_4,v_5)$, $(v_5,v_3)$；以及垂直边 $(v_0,v_3)$, $(v_1,v_4)$, $(v_2,v_5)$。对于局部顶点排序为 $(w_0,w_1,w_2,w_3)$ 的四面体单元，其局部边为 $(w_0,w_1)$, $(w_1,w_2)$, $(w_2,w_0)$, $(w_0,w_3)$, $(w_1,w_3)$, $(w_2,w_3)$。\n\n实现一个程序，构建全局边编号和局部到全局自由度映射，计算恒定场 $\\mathbf{E}$ 的有向边积分，并在一个固定的测试套件上检查上述两个一致性条件。对于每个测试用例，程序必须输出一个布尔值，该值为 $true$ 当且仅当：\n- 四面体和棱柱单元之间的所有共享几何边都被两个单元映射到相同的全局边标识符，并且\n- 对于每个共享几何边，等式 $\\sigma_{\\mathrm{tet}} I_{\\mathrm{tet}} = \\sigma_{\\mathrm{prism}} I_{\\mathrm{prism}}$ 在容差 $\\epsilon = 10^{-12}$ 内成立。\n\n使用以下节点坐标（抽象单位，无物理单位要求）作为所有测试用例的基础集合，每个用例指定顶面高度参数 $h$：\n- 节点 0：$(0,0,0)$\n- 节点 1：$(1,0,0)$\n- 节点 2：$(0,1,0)$\n- 节点 3：$(0,0,h)$\n- 节点 4：$(1,0,h)$\n- 节点 5：$(0,1,h)$\n- 节点 6：$(0,0,-1)$\n- 节点 7：$(0.5,0.5,-1)$\n\n测试套件：\n- 用例 1 (正常路径)：棱柱局部顺序 $[0,1,2,3,4,5]$，四面体局部顺序 $[0,1,2,6]$，$h=1$，无错误。\n- 用例 2 (棱柱中底面方向反转)：棱柱局部顺序 $[0,2,1,3,5,4]$，四面体局部顺序 $[0,1,2,6]$，$h=1$，无错误。\n- 用例 3 (棱柱上使用有向边键的边编号错误)：棱柱局部顺序 $[0,2,1,3,5,4]$，四面体局部顺序 $[0,1,2,6]$，$h=1$，但棱柱的全局边编号错误地使用有向边对 $(i,j)$ 而不是规范的 $(\\min(i,j),\\max(i,j))$ 来构建；这应该会导致一致性检查失败。\n- 用例 4 (界面简化为单个共享边)：棱柱局部顺序 $[0,1,2,3,4,5]$，四面体局部顺序 $[0,1,6,7]$，$h=1$，无错误。\n- 用例 5 (高度方向上的薄棱柱)：棱柱局部顺序 $[0,1,2,3,4,5]$，四面体局部顺序 $[0,1,2,6]$，$h=10^{-9}$，无错误。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表的结果，例如 $[true_1,true_2,true_3,true_4,true_5]$，其中每个条目都是编程语言原生布尔字面量形式的布尔值。", "solution": "该问题要求为由四面体和三棱柱单元组成的混合网格设计并验证一个局部到全局的自由度（DOF）映射，该映射用于电磁学中的旋度协调有限元方法（FEM）。核心任务是确保由基于边的自由度表示的电场切向分量在四面体和棱柱之间的界面上是连续的。这是通过对给定的测试场 $\\mathbf{E}$ 验证两个条件来实现的：首先，共享的几何边被赋予一致的全局自由度标识符；其次，在映射到全局方向后，有向边积分（即自由度）是相等的。\n\n该算法方法基于 Nédélec 边单元公式的原理。我们将构建一个全局边编号系统，然后为每个单元创建一个从其局部边到该全局系统的映射。此过程为每个局部自由度提供了全局标识符和方向符号。最后，我们将在两个单元之间的界面上验证一致性。\n\n**1. 算法框架**\n\n验证两个单元之间界面上自由度映射的流程如下：\n1.  定义几何形状，包括测试设置中所有顶点的全局节点坐标。\n2.  对于每个测试用例，实例化一个全局边注册表，它将每个唯一的几何边映射到一个全局整数标识符。\n3.  处理第一个单元（例如，棱柱）。对于其每个局部边，计算其对应的自由度，通过查询全局边注册表确定其全局标识符和方向符号，并存储这个局部到全局的映射。\n4.  以相同的方式处理第二个单元（四面体），使用并更新同一个全局边注册表。\n5.  识别两个单元共享的几何边集合。\n6.  对于每个共享边，执行两项检查：\n    a.  **编号一致性**：为该边分配的全局标识符对于两个单元必须相同。\n    b.  **场连续性**：从每个单元的局部自由度计算出的全局定向自由度值必须在指定的容差 $\\epsilon$ 内相等。\n7.  当且仅当所有共享边的所有检查都通过时，该测试用例才被视为有效。\n\n**2. 全局边表示和编号**\n\n网格中的一个几何边由其两个端点节点唯一确定，与其方向无关。为了为每个边创建唯一的键，我们采用一种规范表示。对于连接全局索引为 $i$ 和 $j$ 的节点的边，其规范键是排序后的元组 $(\\min(i, j), \\max(i, j))$。此约定为每个边分配了一个全局方向，即从索引较小的节点指向索引较大的节点。\n\n全局边注册表（实现为字典或哈希表）用于为每个规范边键分配一个唯一的整数标识符。在处理单元时，我们查询此注册表。如果第一次遇到某个边，就将其以一个新的、顺序的标识符添加到注册表中。\n\n**3. 单元处理和自由度映射**\n\n对于一个由其类型（四面体或棱柱）和其全局节点索引列表（连接关系）定义的给定单元，我们生成一个局部到全局的自由度映射。对单元的每个局部边，流程如下：\n\n设一个局部边由局部顶点索引对 $(v_a, v_b)$ 定义。使用单元的连接关系列表，这些索引被映射到全局节点索引 $(n_a, n_b)$。\n- **自由度计算**：问题描述指定了一个恒定测试场 $\\mathbf{E} = \\mathbf{E}_0$。自由度是 $\\mathbf{E}$ 沿局部边的线积分，简化为 $I = \\mathbf{E}_0 \\cdot (\\mathbf{p}_b - \\mathbf{p}_a)$，其中 $\\mathbf{p}_a$ 和 $\\mathbf{p}_b$ 是节点 $n_a$ 和 $n_b$ 的坐标向量。\n- **全局标识符**：该边的规范键是 $k = (\\min(n_a, n_b), \\max(n_a, n_b))$。此键用于在全局边注册表中查找或分配一个 `global_id`。\n- **方向符号**：符号 $\\sigma$ 将局部边方向 $(n_a \\rightarrow n_b)$ 与全局规范方向 $(\\min(n_a, n_b) \\rightarrow \\max(n_a, n_b))$ 对齐。如果 $n_a  n_b$（方向一致），则符号为 $\\sigma = +1$；如果 $n_a > n_b$（方向相反），则为 $\\sigma = -1$。\n- **映射**：对于该单元，我们存储一个从规范键 $k$ 到包含 `global_id`、符号 $\\sigma$ 和计算出的积分 $I$ 的元组的映射。\n\n**4. 界面一致性验证**\n\n在处理完四面体和棱柱后，我们得到两个独立的局部到全局自由度映射。界面一致性验证如下：\n- **识别共享边**：通过取两个单元自由度映射中规范边键集合的交集，找到共享几何边的集合。如果此集合为空，则连续性平凡满足。\n- **执行检查**：对于每个共享的规范边 $k$：\n    1.  检索四面体的映射数据 $(g_{\\mathrm{tet}}, \\sigma_{\\mathrm{tet}}, I_{\\mathrm{tet}})$ 和棱柱的映射数据 $(g_{\\mathrm{prism}}, \\sigma_{\\mathrm{prism}}, I_{\\mathrm{prism}})$。\n    2.  **编号一致性检查**：验证 $g_{\\mathrm{tet}} = g_{\\mathrm{prism}}$。不匹配表示全局编号逻辑存在缺陷，即同一个几何实体被错误地分配了两个不同的自由度索引。\n    3.  **场连续性检查**：一个局部自由度映射到全局系统后的值为 $\\sigma I$。为确保切向连续性，来自两个单元的全局定向自由度必须相等：$\\sigma_{\\mathrm{tet}} I_{\\mathrm{tet}} = \\sigma_{\\mathrm{prism}} I_{\\mathrm{prism}}$。我们检查是否 $|\\sigma_{\\mathrm{tet}} I_{\\mathrm{tet}} - \\sigma_{\\mathrm{prism}} I_{\\mathrm{prism}}| \\le \\epsilon$，其中 $\\epsilon = 10^{-12}$。检查失败意味着在该离散化模型中，场的切向分量在该边上是不连续的。\n\n**5. 模拟编号错误**\n\n测试用例3引入了一个特定的实现错误。对于棱柱单元，用于访问全局边注册表的键是有向的全局节点索引对 $(n_a, n_b)$，而不是规范的、排序后的对 $(\\min(n_a, n_b), \\max(n_a, n_b))$。这种错误的逻辑会为 $n_a > n_b$ 的边 $(n_a, n_b)$ 在全局注册表中创建一个新条目，即使规范边 $(\\min(n_a, n_b), \\max(n_a, n_b))$ 可能已经存在。因此，在与正确处理的四面体进行比较时，这样一个边的 `global_id` 将不匹配，导致编号一致性检查失败，这符合该测试用例的设计意图。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the DOF mapping consistency problem for a tet-prism interface.\n    \"\"\"\n    \n    # Base node coordinates (abstract units) before applying height parameter h\n    BASE_NODES = np.array([\n        [0.0, 0.0, 0.0],   # Node 0\n        [1.0, 0.0, 0.0],   # Node 1\n        [0.0, 1.0, 0.0],   # Node 2\n        [0.0, 0.0, 'h'], # Node 3 - y-coord is placeholder for h\n        [1.0, 0.0, 'h'], # Node 4\n        [0.0, 1.0, 'h'], # Node 5\n        [0.0, 0.0, -1.0],  # Node 6\n        [0.5, 0.5, -1.0],  # Node 7\n    ])\n\n    # Constant test electric field\n    E_FIELD = np.array([1.0, 2.0, 3.0])\n    \n    # Tolerance for floating-point comparisons\n    TOLERANCE = 1e-12\n\n    # Local edge definitions by local vertex indices\n    PRISM_LOCAL_EDGES = [\n        (0, 1), (1, 2), (2, 0),  # Bottom face\n        (3, 4), (4, 5), (5, 3),  # Top face\n        (0, 3), (1, 4), (2, 5)   # Vertical edges\n    ]\n    TET_LOCAL_EDGES = [\n        (0, 1), (1, 2), (2, 0),  # Base face\n        (0, 3), (1, 3), (2, 3)   # Edges to apex\n    ]\n\n    # Test suite from the problem statement\n    test_cases = [\n        # Case 1: Happy path\n        {'prism_conn': [0, 1, 2, 3, 4, 5], 'tet_conn': [0, 1, 2, 6], 'h': 1.0, 'buggy_prism_numbering': False},\n        # Case 2: Reversed bottom face orientation in prism\n        {'prism_conn': [0, 2, 1, 3, 5, 4], 'tet_conn': [0, 1, 2, 6], 'h': 1.0, 'buggy_prism_numbering': False},\n        # Case 3: Edge-numbering bug on prism\n        {'prism_conn': [0, 2, 1, 3, 5, 4], 'tet_conn': [0, 1, 2, 6], 'h': 1.0, 'buggy_prism_numbering': True},\n        # Case 4: Interface reduces to a single shared edge\n        {'prism_conn': [0, 1, 2, 3, 4, 5], 'tet_conn': [0, 1, 6, 7], 'h': 1.0, 'buggy_prism_numbering': False},\n        # Case 5: Thin prism\n        {'prism_conn': [0, 1, 2, 3, 4, 5], 'tet_conn': [0, 1, 2, 6], 'h': 1e-9, 'buggy_prism_numbering': False},\n    ]\n\n    results = []\n\n    for case in test_cases:\n        # --- Setup for the current test case ---\n        h = case['h']\n        nodes = np.copy(BASE_NODES)\n        # Substitute the 'h' placeholder with the actual value\n        nodes[3:6, 2] = h\n        nodes = nodes.astype(float) # Ensure float type after substitution\n\n        global_edge_map = {}\n        next_global_id = 0\n        \n        # --- Process Prism Element ---\n        prism_conn = case['prism_conn']\n        prism_dof_map = {}\n        for v_start, v_end in PRISM_LOCAL_EDGES:\n            n_start, n_end = prism_conn[v_start], prism_conn[v_end]\n            \n            p_start, p_end = nodes[n_start], nodes[n_end]\n            integral = np.dot(E_FIELD, p_end - p_start)\n            \n            canonical_edge = tuple(sorted((n_start, n_end)))\n            \n            if case['buggy_prism_numbering']:\n                key = (n_start, n_end)\n            else:\n                key = canonical_edge\n            \n            if key not in global_edge_map:\n                global_edge_map[key] = next_global_id\n                next_global_id += 1\n            \n            global_id = global_edge_map[key]\n            sign = 1 if n_start  n_end else -1\n            \n            prism_dof_map[canonical_edge] = (global_id, sign, integral)\n\n        # --- Process Tetrahedral Element ---\n        tet_conn = case['tet_conn']\n        tet_dof_map = {}\n        for v_start, v_end in TET_LOCAL_EDGES:\n            n_start, n_end = tet_conn[v_start], tet_conn[v_end]\n            \n            p_start, p_end = nodes[n_start], nodes[n_end]\n            integral = np.dot(E_FIELD, p_end - p_start)\n            \n            canonical_edge = tuple(sorted((n_start, n_end)))\n            key = canonical_edge # Tet is never buggy\n\n            if key not in global_edge_map:\n                global_edge_map[key] = next_global_id\n                next_global_id += 1\n            \n            global_id = global_edge_map[key]\n            sign = 1 if n_start  n_end else -1\n            \n            tet_dof_map[canonical_edge] = (global_id, sign, integral)\n\n        # --- Verification ---\n        is_consistent = True\n        \n        # Find shared edges by intersecting the keys of the DOF maps\n        shared_edges = set(prism_dof_map.keys()).intersection(set(tet_dof_map.keys()))\n\n        if not shared_edges:\n            # If no shared edges, consistency is vacuously true\n            pass\n        else:\n            for edge in shared_edges:\n                prism_gid, prism_sign, prism_integral = prism_dof_map[edge]\n                tet_gid, tet_sign, tet_integral = tet_dof_map[edge]\n                \n                # 1. Check for consistent global numbering\n                if prism_gid != tet_gid:\n                    is_consistent = False\n                    break\n                \n                # 2. Check for field continuity\n                prism_global_dof = prism_sign * prism_integral\n                tet_global_dof = tet_sign * tet_integral\n                if abs(prism_global_dof - tet_global_dof) > TOLERANCE:\n                    is_consistent = False\n                    break\n        \n        results.append(str(is_consistent).lower())\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3329977"}, {"introduction": "许多现代电磁问题，如光子晶体、超材料和天线阵列，都涉及周期性结构。本练习将有限元框架扩展到处理此类问题，通过引入Bloch-Floquet边界条件来实现。您将推导周期性边界上自由度之间的相位关系，并观察这种约束如何修改全局系统矩阵，这是分析这些结构色散特性的关键一步[@problem_id:3329993]。", "problem": "考虑一个在 $x$ 方向上周期性的电磁单元晶胞，其晶格矢量为 $\\mathbf{L} = a\\,\\hat{\\mathbf{x}}$，其中 $a  0$。生成一个采用一阶 Nédélec 边元的保形边元网格，使得左侧周期性边界 $\\Gamma_{L}$ 上的每条边都通过平移 $\\mathbf{L}$ 与右侧周期性边界 $\\Gamma_{R}$ 上的对应边配对。网格生成器为每条配对的边提供配对关系和一个方向标记 $s \\in \\{-1, +1\\}$，其中 $s = +1$ 表示右侧边平移后的有向切线与左侧边的有向切线方向一致，而 $s = -1$ 表示方向相反。\n\n在角频率为 $\\omega$ 的时谐条件下，电场 $\\mathbf{E}(\\mathbf{x})$ 满足布洛赫-弗洛凯 (Bloch-Floquet) 周期性，其布洛赫矢量为 $\\mathbf{k}$，即\n$$\n\\mathbf{E}(\\mathbf{x} + \\mathbf{L}) = \\mathbf{E}(\\mathbf{x}) \\exp\\!\\big(i\\,\\mathbf{k}\\cdot \\mathbf{L}\\big).\n$$\n与网格边 $e$ 相关联的边自由度 (DOF) 定义为\n$$\nu_e = \\int_{e} \\mathbf{E}(\\mathbf{x}) \\cdot \\hat{\\mathbf{t}}_e \\, \\mathrm{d}s,\n$$\n其中 $\\hat{\\mathbf{t}}_e$ 是与全局边方向一致的单位切向量。\n\n1. 从布洛赫-弗洛凯条件和边自由度的定义出发，推导 $\\Gamma_{L}$ 和 $\\Gamma_{R}$ 之间配对边自由度的映射关系，即用 $u_{L}$、方向符号 $s$ 和相位 $\\phi = \\mathbf{k}\\cdot \\mathbf{L}$ 表示 $u_{R}$。\n\n2. 考虑在均匀各向同性材料中，由旋度-旋度项和质量项贡献的 $2 \\times 2$ 局部边界耦合子矩阵，该子矩阵仅限于单个配对的边界边自由度 $(p \\leftrightarrow q)$，其中 $p$ 为左边自由度的索引，$q$ 为其右侧周期性配对边的索引。假设该局部子矩阵是实对称的，\n$$\n\\begin{pmatrix}\nA_{pp}  A_{pq} \\\\\nA_{qp}  A_{qq}\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\alpha  \\beta \\\\\n\\beta  \\alpha\n\\end{pmatrix},\n$$\n其中 $\\alpha  0$ 且 $\\beta  0$。利用第 1 部分的映射关系和基于代换 $u_q = s \\exp(i \\phi)\\,u_p$ 的合同缩减，推导出保留自由度 $p$ 对应的全局矩阵元 $A^{\\mathrm{eff}}_{pp}$ 的约化单自由度有效贡献的闭式解，该解应表示为 $\\alpha$、$\\beta$、$s$ 和 $\\phi$ 的函数。\n\n3. 对于一个单元晶胞，其参数为 $a = 5\\,\\mathrm{mm}$，布洛赫矢量为 $\\mathbf{k} = k_x \\hat{\\mathbf{x}}$ 且 $k_x = \\pi/(3 a)$，取方向标记 $s = -1$。设 $\\alpha = 1.8$ 且 $\\beta = 0.6$（无量纲，因为矩阵已通过适当缩放材料参数和频率进行了无量纲化处理）。计算 $A^{\\mathrm{eff}}_{pp}$ 的数值。答案以无量纲实数表示，无需四舍五入。角度必须以弧度为单位处理。", "solution": "该问题经评估有效，因为它在科学上基于计算电磁学和布洛赫-弗洛凯理论的原理，问题提法适定，设置清晰完整，并以客观、正式的语言表述。我们可以着手解答。\n\n解答分为三部分，对应于问题陈述中的三个任务。\n\n1. 自由度映射关系的推导。\n\n设 $e_L$ 是左侧周期性边界 $\\Gamma_L$ 上的一条边，$e_R$ 是其在右侧周期性边界 $\\Gamma_R$ 上对应的配对边。与这些边相关联的自由度由下式给出：\n$$u_L = \\int_{e_L} \\mathbf{E}(\\mathbf{x}) \\cdot \\hat{\\mathbf{t}}_L \\, \\mathrm{d}s$$\n$$u_R = \\int_{e_R} \\mathbf{E}(\\mathbf{x}') \\cdot \\hat{\\mathbf{t}}_R \\, \\mathrm{d}s'$$\n其中 $\\hat{\\mathbf{t}}_L$ 和 $\\hat{\\mathbf{t}}_R$ 分别是定义边 $e_L$ 和 $e_R$ 方向的单位切向量。\n\n右侧边 $e_R$ 上的点与左侧边 $e_L$ 上的点通过晶格矢量平移 $\\mathbf{L} = a\\,\\hat{\\mathbf{x}}$ 相关联，即对于 $e_L$ 上的每一点 $\\mathbf{x}$，在 $e_R$ 上都有一个对应的点 $\\mathbf{x}' = \\mathbf{x} + \\mathbf{L}$。我们可以将 $u_R$ 的积分重新参数化到路径 $e_L$ 上。微分弧长元在平移下是不变的，因此 $\\mathrm{d}s' = \\mathrm{d}s$。积分变为：\n$$u_R = \\int_{e_L} \\mathbf{E}(\\mathbf{x} + \\mathbf{L}) \\cdot \\hat{\\mathbf{t}}_R \\, \\mathrm{d}s$$\n我们应用布洛赫-弗洛凯周期性条件 $\\mathbf{E}(\\mathbf{x} + \\mathbf{L}) = \\mathbf{E}(\\mathbf{x}) \\exp(i\\,\\mathbf{k}\\cdot \\mathbf{L})$。将其代入 $u_R$ 的积分中：\n$$u_R = \\int_{e_L} \\left[ \\mathbf{E}(\\mathbf{x}) \\exp(i\\,\\mathbf{k}\\cdot \\mathbf{L}) \\right] \\cdot \\hat{\\mathbf{t}}_R \\, \\mathrm{d}s$$\n项 $\\exp(i\\,\\mathbf{k}\\cdot \\mathbf{L})$ 相对于积分变量 $\\mathbf{x}$ 是一个常数标量，可以从积分中提出。令 $\\phi = \\mathbf{k}\\cdot \\mathbf{L}$：\n$$u_R = \\exp(i\\phi) \\int_{e_L} \\mathbf{E}(\\mathbf{x}) \\cdot \\hat{\\mathbf{t}}_R \\, \\mathrm{d}s$$\n接下来，我们关联切向量。边 $e_R$ 是 $e_L$ 的平移。曲线的切向量场在平移下是不变的。然而，边的方向是由网格生成器设定的约定。方向标记 $s \\in \\{-1, +1\\}$ 定义了右侧边的有向切线 $\\hat{\\mathbf{t}}_R$ 与左侧边的有向切线 $\\hat{\\mathbf{t}}_L$ 之间的关系。该关系为 $\\hat{\\mathbf{t}}_R = s\\,\\hat{\\mathbf{t}}_L$。\n将此代入 $u_R$ 的表达式中：\n$$u_R = \\exp(i\\phi) \\int_{e_L} \\mathbf{E}(\\mathbf{x}) \\cdot (s\\,\\hat{\\mathbf{t}}_L) \\, \\mathrm{d}s$$\n标量 $s$ 也可以被提出：\n$$u_R = s \\exp(i\\phi) \\int_{e_L} \\mathbf{E}(\\mathbf{x}) \\cdot \\hat{\\mathbf{t}}_L \\, \\mathrm{d}s$$\n剩余的积分正是左侧边自由度 $u_L$ 的定义。因此，映射关系为：\n$$u_R = s \\exp(i\\phi) u_L$$\n为了与第 2 部分中左自由度用 $p$、右自由度用 $q$ 的记法相匹配，此关系写作 $u_q = s \\exp(i\\phi) u_p$。\n\n2. 有效矩阵元 $A^{\\mathrm{eff}}_{pp}$ 的推导。\n\n与配对自由度 $(u_p, u_q)$ 相关的局部 $2 \\times 2$ 子矩阵的二次型由下式给出：\n$$Q = \\begin{pmatrix} u_p^*  u_q^* \\end{pmatrix} \\begin{pmatrix} A_{pp}  A_{pq} \\\\ A_{qp}  A_{qq} \\end{pmatrix} \\begin{pmatrix} u_p \\\\ u_q \\end{pmatrix}$$\n其中 $*$ 表示复共轭。代入给定的矩阵值：\n$$Q = \\begin{pmatrix} u_p^*  u_q^* \\end{pmatrix} \\begin{pmatrix} \\alpha  \\beta \\\\ \\beta  \\alpha \\end{pmatrix} \\begin{pmatrix} u_p \\\\ u_q \\end{pmatrix} = \\alpha u_p^* u_p + \\beta u_p^* u_q + \\beta u_q^* u_p + \\alpha u_q^* u_q$$\n$$Q = \\alpha |u_p|^2 + \\beta (u_p^* u_q + u_q^* u_p) + \\alpha |u_q|^2$$\n自由度 $u_q$ 不是独立的，而是受第 1 部分推导出的关系 $u_q = s \\exp(i\\phi) u_p$ 约束。其复共轭为 $u_q^* = s \\exp(-i\\phi) u_p^*$，因为 $s$ 是实数。\n\n我们将这些代入二次型以消去 $u_q$ 和 $u_q^*$：\n$$Q = \\alpha|u_p|^2 + \\beta \\left( u_p^* (s \\exp(i\\phi) u_p) + (s \\exp(-i\\phi) u_p^*) u_p \\right) + \\alpha |s \\exp(i\\phi) u_p|^2$$\n我们来简化这些项。注意到 $|s \\exp(i\\phi) u_p|^2 = |s|^2 |\\exp(i\\phi)|^2 |u_p|^2 = (s^2)(1)|u_p|^2 = |u_p|^2$，因为 $s^2=1$。\n$$Q = \\alpha|u_p|^2 + \\beta s \\left( \\exp(i\\phi) u_p^* u_p + \\exp(-i\\phi) u_p^* u_p \\right) + \\alpha |u_p|^2$$\n$$Q = \\alpha|u_p|^2 + \\beta s |u_p|^2 (\\exp(i\\phi) + \\exp(-i\\phi)) + \\alpha |u_p|^2$$\n使用欧拉公式 $\\exp(i\\phi) + \\exp(-i\\phi) = 2\\cos(\\phi)$。\n$$Q = (2\\alpha + 2 s \\beta \\cos(\\phi)) |u_p|^2$$\n这个约化后的二次型为 $Q = A^{\\mathrm{eff}}_{pp} |u_p|^2$。通过比较这两个表达式，我们确定保留自由度 $p$ 的有效矩阵元为：\n$$A^{\\mathrm{eff}}_{pp} = 2\\alpha + 2s\\beta\\cos(\\phi)$$\n\n3. $A^{\\mathrm{eff}}_{pp}$ 的数值计算。\n\n我们已知以下数值：\n-   单元晶胞尺寸参数 $a = 5\\,\\mathrm{mm}$。\n-   布洛赫矢量分量 $k_x = \\frac{\\pi}{3 a}$。\n-   方向标记 $s = -1$。\n-   矩阵参数 $\\alpha = 1.8$ 和 $\\beta = 0.6$。\n\n首先，我们计算相位 $\\phi = \\mathbf{k} \\cdot \\mathbf{L}$。当 $\\mathbf{k} = k_x \\hat{\\mathbf{x}}$ 且 $\\mathbf{L} = a \\hat{\\mathbf{x}}$ 时，点积为：\n$$\\phi = (k_x \\hat{\\mathbf{x}}) \\cdot (a \\hat{\\mathbf{x}}) = k_x a$$\n代入 $k_x$ 的给定表达式：\n$$\\phi = \\left(\\frac{\\pi}{3 a}\\right) a = \\frac{\\pi}{3}$$\n角度必须以弧度处理，这里已满足该要求。现在我们计算 $\\cos(\\phi)$：\n$$\\cos(\\phi) = \\cos\\left(\\frac{\\pi}{3}\\right) = \\frac{1}{2}$$\n最后，我们将所有数值代入第 2 部分推导出的 $A^{\\mathrm{eff}}_{pp}$ 表达式中：\n$$A^{\\mathrm{eff}}_{pp} = 2\\alpha + 2s\\beta\\cos(\\phi)$$\n$$A^{\\mathrm{eff}}_{pp} = 2(1.8) + 2(-1)(0.6)\\left(\\frac{1}{2}\\right)$$\n$$A^{\\mathrm{eff}}_{pp} = 3.6 - 2(0.6)\\left(\\frac{1}{2}\\right)$$\n$$A^{\\mathrm{eff}}_{pp} = 3.6 - (1.2)\\left(\\frac{1}{2}\\right)$$\n$$A^{\\mathrm{eff}}_{pp} = 3.6 - 0.6$$\n$$A^{\\mathrm{eff}}_{pp} = 3.0$$\n所得的有效矩阵元是一个无量纲实数，符合要求。", "answer": "$$\\boxed{3.0}$$", "id": "3329993"}]}