{"hands_on_practices": [{"introduction": "掌握任何数值方法的第一步，都是针对一个具有已知解析解的问题进行实践。这项练习 ([@problem_id:3305813]) 将指导您使用傅里叶级数作为全域基函数，求解二维完美电导体圆柱体的散射问题。这种选择能够使积分算子对角化，从而可以直接与精确的级数解进行比较，为深入理解该方法的正确性和局限性提供了宝贵的机会。", "problem": "您被要求使用解析结果，来为一个计算电磁学中的典型二维散射问题，验证一个全域矩量法解。考虑在自由空间中，一个半径为 $a$ 的理想电导体 (PEC) 圆柱体所产生的时谐横磁 (TM$_z$) 散射问题，其电场沿 $z$ 轴方向。入射场是一个沿 $x$ 轴传播的单位振幅平面波 $E_z^{\\text{inc}}(r,\\phi) = e^{i k r \\cos(\\phi)}$。光速为 $c = 299\\,792\\,458$ 米/秒。所有角度必须以弧度为单位，所有长度以米为单位，所有频率以赫兹为单位，最终的数值输出为无量纲。\n\n从二维的标量亥姆霍兹方程开始，对于 TM$_z$ 散射，\n$$\n\\nabla^2 E_z + k^2 E_z = 0,\n$$\n其中自由空间波数 $k = \\frac{2\\pi f}{c}$，以及在理想电导体上的总场边界条件为\n$$\nE_z^{\\text{tot}}(r=a,\\phi) = 0.\n$$\n使用二维自由空间格林函数 $G(\\mathbf{r},\\mathbf{r}') = \\frac{i}{4} H_0^{(1)}(k|\\mathbf{r}-\\mathbf{r}'|)$，将圆柱体外部的散射场表示为在圆形边界上的单层势，其中 $H_\\nu^{(1)}(\\cdot)$ 是第一类汉克尔函数，\n$$\nE_z^{\\text{scat}}(r,\\phi) = \\frac{i}{4} \\int_0^{2\\pi} q(\\phi') H_0^{(1)}\\!\\left(k\\left|\\mathbf{r} - \\mathbf{r}'\\right|\\right) a\\, d\\phi',\n$$\n其中 $\\mathbf{r}'$ 被限制在半径为 $r'=a$ 的圆上，而 $q(\\phi')$ 是一个未知的等效源密度。使用由所有整数 $n \\in \\mathbb{Z}$ 索引的全域傅里叶基函数 $b_n(\\phi) = e^{i n \\phi}$，在 Galerkin 意义下对 $r = a$ 施加边界条件 $E_z^{\\text{inc}}(a,\\phi) + E_z^{\\text{scat}}(a,\\phi) = 0$。使用 Graf 加法定理来对角化圆上的积分算子，\n$$\nH_0^{(1)}\\!\\left(k\\left|\\mathbf{r} - \\mathbf{r}'\\right|\\right) = \\sum_{m=-\\infty}^{\\infty} H_m^{(1)}(k r_>) J_m(k r_<) e^{i m (\\phi - \\phi')},\n$$\n其中 $r_> = \\max(r,r')$ 和 $r_< = \\min(r,r')$, 且 $J_\\nu(\\cdot)$ 是第一类贝塞尔函数。证明作用于 $b_n(\\phi')$ 的单层算子得到\n$$\n\\mathcal{S}[b_n](\\phi) = \\frac{i}{4} \\int_0^{2\\pi} H_0^{(1)}\\!\\left(k\\left|\\mathbf{r} - \\mathbf{r}'\\right|\\right) a\\, b_n(\\phi') d\\phi' = \\lambda_n b_n(\\phi),\n$$\n其对角特征值为\n$$\n\\lambda_n = \\frac{i \\pi a}{2} J_n(k a) H_n^{(1)}(k a).\n$$\n使用入射场在边界上的 Jacobi–Anger 展开，\n$$\nE_z^{\\text{inc}}(a,\\phi) = \\sum_{n=-\\infty}^{\\infty} i^n J_n(k a) e^{i n \\phi},\n$$\n来推导源密度系数 $q_n$ 的 Galerkin 解，\n$$\n\\lambda_n q_n + i^n J_n(k a) = 0 \\quad \\Rightarrow \\quad q_n = - \\frac{i^n J_n(k a)}{\\lambda_n}.\n$$\n证明圆柱体外部的散射场展开具有以下形式\n$$\nE_z^{\\text{scat}}(r,\\phi) = \\sum_{n=-\\infty}^{\\infty} A_n H_n^{(1)}(k r) e^{i n \\phi},\n$$\n其中单层势的投影得出\n$$\nA_n = \\frac{i}{4} (2\\pi a) q_n J_n(k a) = - \\frac{i^n J_n(k a)}{H_n^{(1)}(k a)}.\n$$\n最后一个等式通过逐个模式地施加狄利克雷边界条件 $E_z^{\\text{inc}}(a,\\phi) + E_z^{\\text{scat}}(a,\\phi) = 0$，得出了散射系数的解析解，并同时通过单层势验证了全域傅里叶-Galerkin矩量法解的正确性。\n\n实现一个程序，计算数值上的全域矩量法系数与解析系数，并进行比较，同时对照解析场验证散射场。使用贝塞尔函数 $J_n(\\cdot)$ 和汉克尔函数 $H_n^{(1)}(\\cdot)$，对于给定的截断阶数 $N$，取 $n$ 从 $-N$ 到 $N$。在评估散射场时，使用\n$$\nE_z^{\\text{scat}}(r,\\phi) \\approx \\sum_{n=-N}^{N} A_n H_n^{(1)}(k r) e^{i n \\phi},\n$$\n其中 $A_n$ 分别使用上述的解析表达式以及通过 $q_n$ 和单层势投影推导的矩量法解。\n\n您的程序必须计算以下三个测试用例，每个用例产生一个浮点数结果，这些结果将汇总并打印为单行：\n\n1.  系数验证（正常路径）。参数：$a = 0.5$ 米，$f = 3.0 \\times 10^8$ 赫兹，截断阶数 $N = 40$。计算在所有模式 $n \\in \\{-N,\\dots,N\\}$ 中，数值全域 $A_n$ 和解析 $A_n$ 之间的最大相对误差，定义为\n$$\n\\max_{-N \\le n \\le N} \\frac{\\left|A_n^{\\text{MoM}} - A_n^{\\text{analytical}}\\right|}{\\max\\left(\\left|A_n^{\\text{analytical}}\\right|, \\varepsilon\\right)},\n$$\n其中 $\\varepsilon = 10^{-15}$。\n\n2.  在有限观测半径处的场验证（超出系数的覆盖范围）。参数：$a = 0.35$ 米，$f = 1.2 \\times 10^9$ 赫兹，截断阶数 $N = 60$，观测半径 $r_{\\text{obs}} = 10 a$，角度 $\\phi_m = \\frac{2\\pi m}{16}$ for $m = 0,1,\\dots,15$（以弧度为单位）。计算在所有角度上，由数值全域 $A_n$ 和解析 $A_n$ 构建的 $E_z^{\\text{scat}}(r_{\\text{obs}},\\phi)$ 之间的最大相对误差，\n$$\n\\max_m \\frac{\\left|E_z^{\\text{scat,MoM}}(r_{\\text{obs}},\\phi_m) - E_z^{\\text{scat,analytical}}(r_{\\text{obs}},\\phi_m)\\right|}{\\max\\left(\\left|E_z^{\\text{scat,analytical}}(r_{\\text{obs}},\\phi_m)\\right|, \\varepsilon\\right)}.\n$$\n\n3.  截断下的边界条件残差（边界情况）。参数：$a = 0.02$ 米，选择 $f$ 使得 $k a = 0.5$（即 $f = \\frac{0.5\\, c}{2\\pi a}$ 赫兹），截断阶数 $N = 5$。使用截断至 $n \\in \\{-N,\\dots,N\\}$ 的解析系数，计算在角度 $\\phi_m = \\frac{2\\pi m}{64}$（其中 $m = 0,1,\\dots,63$）上的边界条件的归一化最大残差，\n$$\n\\max_m \\frac{\\left|E_z^{\\text{inc}}(a,\\phi_m) + \\sum_{n=-N}^{N} A_n^{\\text{analytical}} H_n^{(1)}(k a) e^{i n \\phi_m}\\right|}{\\max_m \\left|E_z^{\\text{inc}}(a,\\phi_m)\\right|}.\n$$\n\n您的程序应生成单行输出，其中包含三个数值结果，以逗号分隔并用方括号括起来（例如，\"[result1,result2,result3]\"）。每个结果都必须是浮点数。使用指定的物理单位（$a$ 使用米，$f$ 使用赫兹），所有角度使用弧度。", "solution": "我们从二维标量亥姆霍兹方程开始，对于横磁极化 (Transverse Magnetic) 下的 $z$ 向电场 $E_z$，在散射体外部有 $\\nabla^2 E_z + k^2 E_z = 0$。对于位于 $r=a$ 的理想电导体 (PEC) 边界，狄利克雷边界条件 (Dirichlet boundary condition) 要求总的切向电场在表面上为零，即 $E_z^{\\text{tot}}(r=a,\\phi) = 0$。总场等于入射场和散射场之和，$E_z^{\\text{tot}} = E_z^{\\text{inc}} + E_z^{\\text{scat}}$。\n\n我们使用边界曲线 $\\Gamma$（半径为 $a$ 的圆）上的单层势来表示散射场，其密度为 $q(\\phi')$，并使用二维自由空间格林函数，\n$$\nE_z^{\\text{scat}}(r,\\phi) = \\frac{i}{4} \\int_{\\Gamma} q(\\phi') H_0^{(1)}\\!\\left(k\\left|\\mathbf{r} - \\mathbf{r}'\\right|\\right) ds' = \\frac{i}{4} \\int_0^{2\\pi} q(\\phi') H_0^{(1)}\\!\\left(k\\left|\\mathbf{r} - \\mathbf{r}'\\right|\\right) a\\, d\\phi',\n$$\n其中 $H_0^{(1)}(\\cdot)$ 是零阶第一类汉克尔函数，$ds' = a\\, d\\phi'$ 是圆上的微分弧长。\n\n在边界 $r=a$ 上，施加 $E_z^{\\text{inc}}(a,\\phi) + E_z^{\\text{scat}}(a,\\phi) = 0$ 得到在单层势表示下的TM$_z$电场积分方程 (EFIE)。为了使用全域基函数求解此方程，我们将未知量 $q(\\phi')$ 展开为傅里叶级数，\n$$\nq(\\phi') = \\sum_{n=-\\infty}^{\\infty} q_n e^{i n \\phi'},\n$$\n并使用相同的函数族 $b_n(\\phi) = e^{i n \\phi}$ 对EFIE进行测试（Galerkin方法）。由于圆对称性，圆上的积分算子被傅里叶谐波对角化。使用 Graf 加法定理，\n$$\nH_0^{(1)}\\!\\left(k\\left|\\mathbf{r} - \\mathbf{r}'\\right|\\right) = \\sum_{m=-\\infty}^{\\infty} H_m^{(1)}(k r_>) J_m(k r_<) e^{i m (\\phi - \\phi')},\n$$\n设 $r=r'=a$ 得\n$$\nH_0^{(1)}\\!\\left(k\\left|\\mathbf{r} - \\mathbf{r}'\\right|\\right)\\bigg|_{r=r'=a} = \\sum_{m=-\\infty}^{\\infty} H_m^{(1)}(k a) J_m(k a) e^{i m (\\phi - \\phi')}.\n$$\n将单层算子作用于 $b_n(\\phi')$ 并对 $\\phi'$ 积分，得到\n$$\n\\mathcal{S}[b_n](\\phi) = \\frac{i}{4} \\int_0^{2\\pi} \\left[\\sum_{m=-\\infty}^{\\infty} H_m^{(1)}(k a) J_m(k a) e^{i m (\\phi - \\phi')}\\right] a\\, e^{i n \\phi'} d\\phi'.\n$$\n交换求和与积分并利用正交性，\n$$\n\\int_0^{2\\pi} e^{i (n - m) \\phi'} d\\phi' = 2\\pi \\delta_{n m},\n$$\n我们发现\n$$\n\\mathcal{S}[b_n](\\phi) = \\frac{i}{4} a \\left[2\\pi H_n^{(1)}(k a) J_n(k a)\\right] e^{i n \\phi} = \\lambda_n b_n(\\phi),\n$$\n其特征值为\n$$\n\\lambda_n = \\frac{i \\pi a}{2} J_n(k a) H_n^{(1)}(k a).\n$$\n因此，投影到 $b_n$ 上的EFIE变为\n$$\n\\lambda_n q_n + \\langle b_n, E_z^{\\text{inc}}(a,\\cdot) \\rangle = 0,\n$$\n其中尖括号表示傅里叶系数提取。使用入射平面波在边界上的 Jacobi–Anger 展开，\n$$\nE_z^{\\text{inc}}(a,\\phi) = e^{i k a \\cos \\phi} = \\sum_{n=-\\infty}^{\\infty} i^n J_n(k a) e^{i n \\phi},\n$$\n我们确定入射傅里叶系数为 $E_{n}^{\\text{inc}} = i^n J_n(k a)$。因此，源密度系数为\n$$\nq_n = - \\frac{i^n J_n(k a)}{\\lambda_n} = - \\frac{i^n J_n(k a)}{\\frac{i \\pi a}{2} J_n(k a) H_n^{(1)}(k a)} = - \\frac{2}{i \\pi a} \\frac{i^n}{H_n^{(1)}(k a)}.\n$$\n\n为了在相同的谐波基中获得远离边界 $(r>a)$ 的散射场，我们使用 Graf 加法定理对单层势进行展开（此时 $r>a$，所以 $r_>=r$, $r_<=a$），得到\n$$\nE_z^{\\text{scat}}(r,\\phi) = \\frac{i}{4} \\int_0^{2\\pi} q(\\phi') \\left[\\sum_{m=-\\infty}^{\\infty} H_m^{(1)}(k r) J_m(k a) e^{i m (\\phi - \\phi')}\\right] a\\, d\\phi' = \\sum_{n=-\\infty}^{\\infty} A_n H_n^{(1)}(k r) e^{i n \\phi},\n$$\n其中散射场模式振幅为\n$$\nA_n = \\frac{i}{4} \\left(2\\pi a\\right) q_n J_n(k a).\n$$\n代入 $q_n$，\n$$\nA_n = \\frac{i}{4} \\left(2\\pi a\\right) \\left( - \\frac{2}{i \\pi a} \\frac{i^n}{H_n^{(1)}(k a)} \\right) J_n(k a) = - \\frac{i^n J_n(k a)}{H_n^{(1)}(k a)}.\n$$\n这最后一个表达式正是在逐个模式地施加边界条件 $E_z^{\\text{inc}}(a,\\phi) + \\sum_n A_n H_n^{(1)}(k a) e^{i n \\phi} = 0$ 时获得的解析系数，因为正交性保证了\n$$\ni^n J_n(k a) + A_n H_n^{(1)}(k a) = 0 \\quad \\Rightarrow \\quad A_n = - \\frac{i^n J_n(k a)}{H_n^{(1)}(k a)}.\n$$\n因此，使用单层势的全域傅里叶-Galerkin矩量法解与PEC圆柱体的精确解析解相符，从而得到验证。\n\n算法设计：\n1.  对于给定的 $a$ 和 $f$，计算 $k = \\frac{2\\pi f}{c}$ 和 $k a$。\n2.  对于截断阶数 $N$，枚举 $n \\in \\{-N, -N+1, \\dots, N\\}$。\n3.  使用可靠的特殊函数库为每个 $n$ 计算 $J_n(k a)$ 和 $H_n^{(1)}(k a)$。\n4.  计算 Galerkin 单层算子特征值 $\\lambda_n = \\frac{i \\pi a}{2} J_n(k a) H_n^{(1)}(k a)$。\n5.  计算源密度系数 $q_n = - \\frac{i^n J_n(k a)}{\\lambda_n}$。\n6.  计算矩量法散射场系数 $A_n^{\\text{MoM}} = \\frac{i}{4} (2\\pi a) q_n J_n(k a)$。\n7.  计算解析系数 $A_n^{\\text{analytical}} = - \\frac{i^n J_n(k a)}{H_n^{(1)}(k a)}$。\n8.  验证：\n   a.  系数验证：使用一个小的 $\\varepsilon$ 来防止除以零，计算 $A_n^{\\text{MoM}}$ 和 $A_n^{\\text{analytical}}$ 之间在所有 $n$ 上的最大相对差异。\n   b.  场验证：对于指定的角度和 $r_{\\text{obs}}$，根据两组 $A_n$ 计算 $E_z^{\\text{scat}}(r_{\\text{obs}},\\phi)$，并取所有角度上的最大相对差异。\n   c.  边界条件残差：对于边界上的角度，计算残差 $E_z^{\\text{inc}}(a,\\phi) + \\sum_{n=-N}^{N} A_n^{\\text{analytical}} H_n^{(1)}(k a) e^{i n \\phi}$，并用所有角度上的最大入射场幅值进行归一化。\n\n数值计算注意事项：\n- 对 $A_n$、$H_n^{(1)}$ 和 $E_z^{\\text{scat}}$ 使用复数运算。\n- 利用对称性 $J_{-n}(x) = (-1)^n J_n(x)$ 和 $H_{-n}^{(1)}(x) = (-1)^n H_n^{(1)}(x)$；然而，对负整数阶直接求值也是可以接受的。\n- 选择 $\\varepsilon = 10^{-15}$ 以在存在接近零的分母时稳定相对误差的除法。\n\n程序将为指定的测试用例计算三个浮点数结果，并将它们以逗号分隔的列表形式打印在单行中，并用方括号括起来，例如，\"[1.0e-15,2.0e-15,0.0123]\"。所有角度以弧度为单位，长度以米为单位，频率以赫兹为单位，输出为无量纲。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import jv, hankel1\n\nc = 299_792_458.0  # speed of light in m/s\n\ndef compute_coefficients(a, f, N):\n    \"\"\"\n    Compute MoM and analytical scattered-field coefficients A_n for n in [-N, N].\n    Returns arrays of n, A_mom, A_analytic, and ka.\n    \"\"\"\n    k = 2.0 * np.pi * f / c\n    ka = k * a\n    ns = np.arange(-N, N+1, dtype=int)\n    # Precompute Bessel and Hankel at ka for all n\n    J = np.array([jv(n, ka) for n in ns], dtype=np.complex128)\n    H = np.array([hankel1(n, ka) for n in ns], dtype=np.complex128)\n    # Eigenvalues of single-layer operator on the circle\n    lam = 1j * np.pi * a / 2.0 * J * H\n    # Incident coefficients: i^n J_n(ka)\n    i_pow_n = np.array([(1j)**n for n in ns], dtype=np.complex128)\n    Einc_n = i_pow_n * J\n    # Source density coefficients q_n from Galerkin EFIE\n    # Guard against division by zero in pathological cases\n    q = -Einc_n / lam\n    # MoM scattered-field coefficients via single-layer projection\n    A_mom = (1j / 4.0) * (2.0 * np.pi * a) * q * J\n    # Analytical coefficients from boundary condition\n    # A_n = - i^n J_n(ka) / H_n^{(1)}(ka)\n    A_analytic = -Einc_n / H\n    return ns, A_mom, A_analytic, ka, k\n\ndef coeff_validation_case(a, f, N, eps=1e-15):\n    ns, A_mom, A_analytic, ka, k = compute_coefficients(a, f, N)\n    denom = np.maximum(np.abs(A_analytic), eps)\n    rel_err = np.abs(A_mom - A_analytic) / denom\n    return float(np.max(rel_err))\n\ndef field_validation_case(a, f, N, r_obs, angles, eps=1e-15):\n    ns, A_mom, A_analytic, ka, k = compute_coefficients(a, f, N)\n    # Compute Hankel at observation radius\n    kr = k * r_obs\n    H_obs = np.array([hankel1(n, kr) for n in ns], dtype=np.complex128)\n    # Evaluate scattered fields for both methods\n    errs = []\n    for phi in angles:\n        exp_nphi = np.array([np.exp(1j * n * phi) for n in ns], dtype=np.complex128)\n        Es_mom = np.sum(A_mom * H_obs * exp_nphi)\n        Es_ana = np.sum(A_analytic * H_obs * exp_nphi)\n        denom = max(np.abs(Es_ana), eps)\n        errs.append(np.abs(Es_mom - Es_ana) / denom)\n    return float(np.max(errs))\n\ndef boundary_residual_case(a, f, N, angles):\n    ns, A_mom, A_analytic, ka, k = compute_coefficients(a, f, N)\n    # Residual using analytical coefficients truncated to N at the boundary\n    # Residual(phi) = E_inc(a,phi) + sum_{n=-N}^N A_n H_n(ka) e^{i n phi}\n    H_boundary = np.array([hankel1(n, ka) for n in ns], dtype=np.complex128)\n    max_inc_mag = 0.0\n    max_resid = 0.0\n    for phi in angles:\n        E_inc = np.exp(1j * ka * np.cos(phi))\n        # Compute truncated field sum at boundary\n        exp_nphi = np.array([np.exp(1j * n * phi) for n in ns], dtype=np.complex128)\n        sum_trunc = np.sum(A_analytic * H_boundary * exp_nphi)\n        resid = E_inc + sum_trunc\n        max_inc_mag = max(max_inc_mag, np.abs(E_inc))\n        max_resid = max(max_resid, np.abs(resid))\n    # Normalize residual by max incident magnitude\n    if max_inc_mag == 0.0:\n        return float(max_resid)\n    return float(max_resid / max_inc_mag)\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1: Coefficient validation (happy path)\n        {\n            \"type\": \"coeff\",\n            \"a\": 0.5,          # meters\n            \"f\": 3.0e8,        # Hz\n            \"N\": 40\n        },\n        # Case 2: Field validation at finite observation radius\n        {\n            \"type\": \"farfield\",\n            \"a\": 0.35,         # meters\n            \"f\": 1.2e9,        # Hz\n            \"N\": 60,\n            \"r_obs_multiplier\": 10.0,\n            \"angles\": [2.0*np.pi*m/16.0 for m in range(16)]\n        },\n        # Case 3: Boundary-condition residual under truncation (edge case)\n        {\n            \"type\": \"boundary\",\n            \"a\": 0.02,         # meters\n            \"ka_target\": 0.5,  # choose f so that k*a = 0.5\n            \"N\": 5,\n            \"angles\": [2.0*np.pi*m/64.0 for m in range(64)]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        if case[\"type\"] == \"coeff\":\n            a = case[\"a\"]\n            f = case[\"f\"]\n            N = case[\"N\"]\n            result = coeff_validation_case(a, f, N)\n            results.append(result)\n        elif case[\"type\"] == \"farfield\":\n            a = case[\"a\"]\n            f = case[\"f\"]\n            N = case[\"N\"]\n            r_obs = case[\"r_obs_multiplier\"] * a\n            angles = case[\"angles\"]\n            result = field_validation_case(a, f, N, r_obs, angles)\n            results.append(result)\n        elif case[\"type\"] == \"boundary\":\n            a = case[\"a\"]\n            ka_target = case[\"ka_target\"]\n            # f = (ka_target * c) / (2*pi*a)\n            f = (ka_target * c) / (2.0 * np.pi * a)\n            N = case[\"N\"]\n            angles = case[\"angles\"]\n            result = boundary_residual_case(a, f, N, angles)\n            results.append(result)\n        else:\n            results.append(float(\"nan\"))\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3305813"}, {"introduction": "在掌握了基础之后，这项实践将探索如何利用全域基函数实现先进的自适应策略。该问题 ([@problem_id:3305820]) 引入了切向连续的矢量球谐函数作为三维问题的分层基，从而可以系统性地丰富解空间（即 $p$-精化）。您将推导并应用一个基于残差的后验误差估计子来量化误差并指导自适应过程，这是现代高效求解器的基石。", "problem": "考虑一个嵌入在自由空间中的光滑闭合曲面 $S$，该曲面为单位球面。一角频率为 $\\omega$、波数为 $k$ 的时谐电磁波对其进行照射。假设该曲面为完美电导体 (PEC)。总电场 $\\mathbf{E}_{\\text{tot}}$ 在 $S$ 上满足 PEC 边界条件 $\\hat{\\mathbf{n}} \\times \\mathbf{E}_{\\text{tot}} = \\mathbf{0}$，其中 $\\hat{\\mathbf{n}}$ 是向外单位法向量。使用电场积分方程 (EFIE)，由切向面电流密度 $\\mathbf{J}$ 产生的散射场可以写作 $\\mathbf{E}_{\\text{scat}} = \\mathcal{L}_k \\mathbf{J}$，其边界方程为 $\\mathcal{L}_k \\mathbf{J} = -\\hat{\\mathbf{n}} \\times \\mathbf{E}_{\\text{inc}}$，其中 $\\mathcal{L}_k$ 是 $S$ 上的 EFIE 边界积分算子，$\\mathbf{E}_{\\text{inc}}$ 是入射场。\n\n您需要为 $S$ 上的 $\\mathbf{J}$ 构建一个切向共形的分层全域基，并推导一个基于残差的后验误差估计子，用于指导整个曲面上的全局阶数提升（即 $p$-细化）。在无量纲归一化单位下进行计算，其中内积经过缩放以使基是标准正交的，并且算子 $\\mathcal{L}_k$ 在所选基上的作用是对角的，具有无量纲特征值。\n\n任务：\n1) 从单位球面上的球谐函数 $Y_{l}^{m}$ 和曲面梯度算子 $\\nabla_{S}$ 出发，定义两族切向全域矢量基函数\n$$\n\\mathbf{T}_{l m} := \\hat{\\mathbf{r}} \\times \\nabla_{S} Y_{l}^{m}, \\qquad\n\\mathbf{P}_{l m} := \\nabla_{S} Y_{l}^{m},\n$$\n对于整数 $l \\geq 1$ 和 $-l \\leq m \\leq l$，其中 $\\hat{\\mathbf{r}}$ 是径向单位矢量。解释为什么这些函数在 $S$ 上是切向的，并描述关于阶数 $l$ 的层次结构，该结构能够实现 $p$-自适应。假设集合 $\\{\\mathbf{T}_{l m}\\}$ 和 $\\{\\mathbf{P}_{l m}\\}$ 在所选内积下是标准正交的，并且随着 $p$ 的增加张成嵌套空间 $V_{p}$。\n\n2) 使用 PEC 边界条件和 EFIE，定义 $\\mathbf{J}_{p} \\in V_{p}$ 的 Galerkin 问题和残差 $\\mathbf{R}_{p} := -\\hat{\\mathbf{n}} \\times \\mathbf{E}_{\\text{inc}} - \\mathcal{L}_k \\mathbf{J}_{p}$。在假设 $\\mathcal{L}_k$ 在上述基中是对角的，其在 $\\mathbf{T}_{l m}$ 上的特征值为 $\\alpha_{l}$，在 $\\mathbf{P}_{l m}$ 上的特征值为 $\\beta_{l}$（两者都依赖于 $k$ 和 $l$）的前提下，从第一性原理出发，推导一个由 $\\mathcal{L}_k$ 导出的能量范数下的误差的后验估计子，该估计子完全用 $\\mathbf{R}_{p}$ 在增广空间 $V_{p+1} \\setminus V_{p}$ 中的展开系数表示。您的推导必须从 EFIE 和边界条件开始，并逐步推导出估计子，不得引入任何目标捷径公式。\n\n3) 考虑 $p = 2$，并假设在 $l = 3$ 阶的非零残差系数仅限于三个环形模和三个极向模：\n$$\nr^{T}_{3,-1} = 0.03,\\quad r^{T}_{3,0} = -0.04,\\quad r^{T}_{3,1} = 0.05,\n$$\n$$\nr^{P}_{3,-1} = 0.02,\\quad r^{P}_{3,0} = -0.01,\\quad r^{P}_{3,1} = 0.00,\n$$\n所有其他的 $r^{T}_{3,m}$ 和 $r^{P}_{3,m}$ 均为 $0$。假设 $\\mathcal{L}_k$ 在 $l=3$ 阶模上的对角作用由下式给出\n$$\n\\mathcal{L}_k \\mathbf{T}_{3 m} = \\alpha_{3} \\mathbf{T}_{3 m},\\quad \\alpha_{3} = 5, \\qquad\n\\mathcal{L}_k \\mathbf{P}_{3 m} = \\beta_{3} \\mathbf{P}_{3 m},\\quad \\beta_{3} = 6.\n$$\n使用您在任务2中得到的估计子，评估将多项式阶数从 $p=2$ 提升到包含 $l=3$ 模时相关的全局后验误差估计子（误差的能量范数）。将您的最终答案四舍五入到四位有效数字。因为所有量都是归一化的，所以将估计子报告为一个无量纲数。", "solution": "### 任务1：基函数与层次结构\n\n问题使用球谐函数 $Y_{l}^{m}$ 在单位球面 $S$ 上定义了两族矢量基函数：\n$$\n\\mathbf{T}_{l m} := \\hat{\\mathbf{r}} \\times \\nabla_{S} Y_{l}^{m}\n$$\n$$\n\\mathbf{P}_{l m} := \\nabla_{S} Y_{l}^{m}\n$$\n其中 $l \\geq 1$ 且 $-l \\leq m \\leq l$。这里，$\\hat{\\mathbf{r}}$ 是径向单位矢量，对于单位球面而言，它等同于向外单位法向量 $\\hat{\\mathbf{n}}$，而 $\\nabla_{S}$ 是曲面梯度算子。这些函数在不考虑归一化常数的情况下，就是矢量球谐函数。\n\n如果一个矢量场 $\\mathbf{V}$ 的径向分量为零，即 $\\hat{\\mathbf{r}} \\cdot \\mathbf{V} = 0$，则该矢量场与球面 $S$ 相切。我们对这两族函数验证此条件。\n\n对于极向函数 $\\mathbf{P}_{l m}$：\n球体上的曲面梯度算子 $\\nabla_{S}$ 应用于标量场时，根据定义，会产生一个处处与球面相切的矢量场。因此，矢量场 $\\mathbf{P}_{l m} = \\nabla_{S} Y_{l}^{m}$ 内在地是切向的，且 $\\hat{\\mathbf{r}} \\cdot \\mathbf{P}_{l m} = 0$。\n\n对于环形函数 $\\mathbf{T}_{l m}$：\n函数 $\\mathbf{T}_{l m}$ 由叉积 $\\hat{\\mathbf{r}} \\times \\mathbf{P}_{l m}$ 定义。叉积产生的矢量与两个原始矢量都正交。因此，$\\mathbf{T}_{l m}$ 必须与 $\\hat{\\mathbf{r}}$ 正交。我们可以使用标量三重积性质明确地证明这一点：\n$$\n\\hat{\\mathbf{r}} \\cdot \\mathbf{T}_{l m} = \\hat{\\mathbf{r}} \\cdot (\\hat{\\mathbf{r}} \\times \\nabla_{S} Y_{l}^{m}) = (\\hat{\\mathbf{r}} \\times \\hat{\\mathbf{r}}) \\cdot \\nabla_{S} Y_{l}^{m} = \\mathbf{0} \\cdot \\nabla_{S} Y_{l}^{m} = 0\n$$\n由于径向分量为零，$\\mathbf{T}_{l m}$ 也是曲面 $S$ 上的一个切向矢量场。\n\n这两族函数 $\\{\\mathbf{T}_{l m}\\}$ 和 $\\{\\mathbf{P}_{l m}\\}$ 构成了球面上切向矢量场的一个完备正交基。\n\n$p$-自适应的层次结构是通过球谐函数的阶数 $l$ 建立的。我们可以通过包含最高阶数为 $p$ 的所有基函数来定义一个嵌套的有限维矢量空间序列 $V_p$。具体来说，对于给定的多项式阶数 $p$，空间 $V_p$ 定义为：\n$$\nV_p = \\text{span} \\left\\{ \\mathbf{T}_{l'm}, \\mathbf{P}_{l'm} \\mid 1 \\leq l' \\leq p, -l' \\leq m \\leq l' \\right\\}\n$$\n这种构造确保了 $V_1 \\subset V_2 \\subset \\dots \\subset V_p \\subset V_{p+1} \\subset \\dots$。$p$-细化（或称阶数提升）的过程包括通过添加对应于阶数 $l = p+1$ 的基函数集合，将近似空间从 $V_p$ 增广到 $V_{p+1}$。将要推导的误差估计子将量化这种增广带来的预期改进。\n\n### 任务2：后验误差估计子的推导\n\n在 PEC 曲面 $S$ 上的面电流 $\\mathbf{J}$ 的电场积分方程 (EFIE) 边界条件由下式给出：\n$$\n\\mathcal{L}_k \\mathbf{J} = -\\hat{\\mathbf{n}} \\times \\mathbf{E}_{\\text{inc}}\n$$\n让我们将右侧项（即已知的强迫函数）表示为 $\\mathbf{f} \\equiv -\\hat{\\mathbf{n}} \\times \\mathbf{E}_{\\text{inc}}$。问题是找到 $\\mathbf{J}$ 使得 $\\mathcal{L}_k \\mathbf{J} = \\mathbf{f}$。\n\n在 Galerkin 方法中，我们在有限维空间 $V_p$ 中寻找一个近似解 $\\mathbf{J}_p$。将方程 Galerkin 投影到 $V_p$ 上，要求残差与试探空间正交。我们将曲面上的内积定义为 $\\langle \\mathbf{A}, \\mathbf{B} \\rangle = \\int_S \\mathbf{A}^*(\\mathbf{r}) \\cdot \\mathbf{B}(\\mathbf{r}) dS$。Galerkin 问题是：找到 $\\mathbf{J}_p \\in V_p$ 使得\n$$\n\\langle \\mathbf{v}_p, \\mathcal{L}_k \\mathbf{J}_p \\rangle = \\langle \\mathbf{v}_p, \\mathbf{f} \\rangle \\qquad \\forall \\mathbf{v}_p \\in V_p\n$$\n近似解 $\\mathbf{J}_p$ 的残差定义为 $\\mathbf{R}_p := \\mathbf{f} - \\mathcal{L}_k \\mathbf{J}_p$。Galerkin 条件等价于声明残差与空间 $V_p$ 正交：\n$$\n\\langle \\mathbf{v}_p, \\mathbf{R}_p \\rangle = 0 \\qquad \\forall \\mathbf{v}_p \\in V_p\n$$\n解的误差为 $\\mathbf{e}_p := \\mathbf{J} - \\mathbf{J}_p$。将算子 $\\mathcal{L}_k$ 应用于误差，得到误差-残差方程：\n$$\n\\mathcal{L}_k \\mathbf{e}_p = \\mathcal{L}_k (\\mathbf{J} - \\mathbf{J}_p) = \\mathcal{L}_k \\mathbf{J} - \\mathcal{L}_k \\mathbf{J}_p = \\mathbf{f} - \\mathcal{L}_k \\mathbf{J}_p = \\mathbf{R}_p\n$$\n误差的能量范数定义为 $\\|\\mathbf{e}_p\\|_{\\mathcal{L}_k}^2 = \\langle \\mathcal{L}_k \\mathbf{e}_p, \\mathbf{e}_p \\rangle$。假设算子 $\\mathcal{L}_k$ 是自伴的，我们可以写成：\n$$\n\\|\\mathbf{e}_p\\|_{\\mathcal{L}_k}^2 = \\langle \\mathbf{R}_p, \\mathbf{e}_p \\rangle\n$$\n后验误差估计的核心原理是使用从已计算解中获得的信息来近似未知误差 $\\mathbf{e}_p$。我们通过将 $\\mathbf{e}_p$ 投影到增广空间 $W_p := V_{p+1} \\ominus V_p$ 上来近似它。设此近似为 $\\delta\\mathbf{J} \\in W_p$。我们通过求解 $W_p$ 中的一个局部问题来确定 $\\delta\\mathbf{J}$，该问题是误差-残差方程在 $W_p$ 上的 Galerkin 投影：\n$$\n\\langle \\mathbf{w}, \\mathcal{L}_k \\delta\\mathbf{J} \\rangle = \\langle \\mathbf{w}, \\mathbf{R}_p \\rangle \\qquad \\forall \\mathbf{w} \\in W_p\n$$\n空间 $W_p$ 由标准正交基函数 $\\{\\mathbf{T}_{(p+1)m}, \\mathbf{P}_{(p+1)m} \\mid - (p+1) \\leq m \\leq p+1\\}$ 张成。让我们通常用 $\\{\\psi_j\\}$ 表示这些基函数。我们在此基中展开误差近似 $\\delta\\mathbf{J}$ 和残差 $\\mathbf{R}_p$：\n$$\n\\delta\\mathbf{J} = \\sum_{j} c_j \\psi_j \\qquad \\text{and} \\qquad \\mathbf{R}_p = \\sum_{j} r_j \\psi_j + (\\text{higher order terms})\n$$\n残差系数 $r_j$ 是可计算的，因为 $\\mathbf{R}_p$ 是已知的：$r_j = \\langle \\psi_j, \\mathbf{R}_p \\rangle$。注意，由于 Galerkin 正交性，$\\mathbf{R}_p$ 的展开式在 $V_p$ 中没有分量。\n\n将展开式代入 $\\delta\\mathbf{J}$ 的局部问题，得到：\n$$\n\\left\\langle \\psi_i, \\mathcal{L}_k \\sum_j c_j \\psi_j \\right\\rangle = \\left\\langle \\psi_i, \\sum_j r_j \\psi_j \\right\\rangle\n$$\n利用内积和算子的线性性质，以及基 $\\{\\psi_j\\}$ 的标准正交性：\n$$\n\\sum_j c_j \\langle \\psi_i, \\mathcal{L}_k \\psi_j \\rangle = \\sum_j r_j \\langle \\psi_i, \\psi_j \\rangle = r_i\n$$\n问题陈述算子 $\\mathcal{L}_k$ 在此基中是对角的，因此 $\\mathcal{L}_k \\psi_j = \\lambda_j \\psi_j$，其中 $\\lambda_j$ 是对应的特征值（$\\alpha_{p+1}$ 或 $\\beta_{p+1}$）。\n$$\n\\sum_j c_j \\lambda_j \\langle \\psi_i, \\psi_j \\rangle = \\sum_j c_j \\lambda_j \\delta_{ij} = c_i \\lambda_i = r_i\n$$\n因此，误差近似的系数为 $c_i = r_i / \\lambda_i$。\n\n后验误差估计子 $\\eta_p$ 定义为该误差近似 $\\delta\\mathbf{J}$ 的能量范数：\n$$\n\\eta_p^2 := \\|\\delta\\mathbf{J}\\|_{\\mathcal{L}_k}^2 = \\langle \\mathcal{L}_k \\delta\\mathbf{J}, \\delta\\mathbf{J} \\rangle = \\left\\langle \\mathcal{L}_k \\sum_j c_j \\psi_j, \\sum_i c_i \\psi_i \\right\\rangle\n$$\n$$\n\\eta_p^2 = \\sum_i \\sum_j c_j c_i^* \\langle \\mathcal{L}_k \\psi_j, \\psi_i \\rangle = \\sum_i \\sum_j c_j c_i^* \\lambda_j \\langle \\psi_j, \\psi_i \\rangle\n$$\n假设特征值为实数，并使用标准正交性：\n$$\n\\eta_p^2 = \\sum_j |c_j|^2 \\lambda_j\n$$\n代入 $c_j = r_j / \\lambda_j$：\n$$\n\\eta_p^2 = \\sum_j \\left| \\frac{r_j}{\\lambda_j} \\right|^2 \\lambda_j = \\sum_j \\frac{|r_j|^2}{\\lambda_j}\n$$\n这个求和是对增广空间 $W_p$ 中所有基函数进行的。将求和分解为来自阶数 $l=p+1$ 的环形和极向贡献：\n$$\n\\eta_p^2 = \\sum_{m=-(p+1)}^{p+1} \\frac{| \\langle \\mathbf{T}_{(p+1)m}, \\mathbf{R}_p \\rangle |^2}{\\alpha_{p+1}} + \\sum_{m=-(p+1)}^{p+1} \\frac{| \\langle \\mathbf{P}_{(p+1)m}, \\mathbf{R}_p \\rangle |^2}{\\beta_{p+1}}\n$$\n使用记号 $r^{T}_{(p+1)m} = \\langle \\mathbf{T}_{(p+1)m}, \\mathbf{R}_p \\rangle$ 和 $r^{P}_{(p+1)m} = \\langle \\mathbf{P}_{(p+1)m}, \\mathbf{R}_p \\rangle$，误差的能量范数平方的估计子为：\n$$\n\\eta_p^2 = \\frac{1}{\\alpha_{p+1}} \\sum_{m=-(p+1)}^{p+1} |r^{T}_{(p+1)m}|^2 + \\frac{1}{\\beta_{p+1}} \\sum_{m=-(p+1)}^{p+1} |r^{P}_{(p+1)m}|^2\n$$\n\n### 任务3：计算\n\n我们被要求计算 $p=2$ 时的全局后验误差估计子 $\\eta_p$。这需要使用投影到增广空间 $W_2$ 上的残差系数，该空间由阶数为 $l=p+1=3$ 的基函数张成。在任务2中推导的公式变为：\n$$\n\\eta_2^2 = \\frac{1}{\\alpha_{3}} \\sum_{m=-3}^{3} |r^{T}_{3m}|^2 + \\frac{1}{\\beta_{3}} \\sum_{m=-3}^{3} |r^{P}_{3m}|^2\n$$\n给定的数据是：\n- $l=3$ 时的非零环形残差系数：$r^{T}_{3,-1} = 0.03$，$r^{T}_{3,0} = -0.04$，$r^{T}_{3,1} = 0.05$。\n- $l=3$ 时的非零极向残差系数：$r^{P}_{3,-1} = 0.02$，$r^{P}_{3,0} = -0.01$，$r^{P}_{3,1} = 0.00$。\n- $l=3$ 时的特征值：$\\alpha_{3} = 5$ 和 $\\beta_{3} = 6$。\n\n首先，我们计算每个族系数的幅值平方和：\n环形模的总和：\n$$\n\\sum_{m=-3}^{3} |r^{T}_{3m}|^2 = |0.03|^2 + |-0.04|^2 + |0.05|^2 = 0.0009 + 0.0016 + 0.0025 = 0.0050\n$$\n极向模的总和：\n$$\n\\sum_{m=-3}^{3} |r^{P}_{3m}|^2 = |0.02|^2 + |-0.01|^2 + |0.00|^2 = 0.0004 + 0.0001 + 0.0000 = 0.0005\n$$\n现在，将这些和代入 $\\eta_2^2$ 的表达式中：\n$$\n\\eta_2^2 = \\frac{0.0050}{5} + \\frac{0.0005}{6} = 0.0010 + 0.00008333\\overline{3} = 0.00108333\\overline{3}\n$$\n误差估计子 $\\eta_2$ 是该值的平方根：\n$$\n\\eta_2 = \\sqrt{0.00108333\\overline{3}} \\approx 0.032914028...\n$$\n将此结果四舍五入到四位有效数字，得到 $0.03291$。", "answer": "$$\\boxed{0.03291}$$", "id": "3305820"}, {"introduction": "尽管积分方程法功能强大，但其数值条件数可能很差。最后的这项实践 ([@problem_id:3305837]) 深入探讨了底层边界积分算子的数学结构。通过在球谐函数基下分析这些算子的特征值，您将理解病态问题的根源，并用数值方法验证 Calderón 预处理带来的显著改善，这是开发稳健高效求解器的一项关键技术。", "problem": "考虑由亥姆霍兹方程所描述的三维时谐标量波散射问题。令 $\\Gamma$ 为半径为 $a>0$ 的球面，令 $k>0$ 为自由空间波数。根据亥姆霍兹格林函数 $G_k(\\mathbf{x},\\mathbf{y}) = \\exp(i k \\lVert \\mathbf{x}-\\mathbf{y} \\rVert)/(4\\pi \\lVert \\mathbf{x}-\\mathbf{y} \\rVert)$，在 $\\Gamma$ 上定义以下边界积分算子：\n\n- 单层算子 $S_k$，通过 $(S_k \\varphi)(\\mathbf{x}) = \\int_{\\Gamma} G_k(\\mathbf{x},\\mathbf{y}) \\,\\varphi(\\mathbf{y}) \\, dS_{\\mathbf{y}}$ 作用于面密度 $\\varphi$。\n- 伴随双层算子 $K_k'$，通过单层位势的平均法向导数作用。\n- 超奇异算子 $W_k$，作用于位势的边界迹。\n\n在球面上，对于 $\\ell \\in \\{0,1,2,\\dots\\}$ 和 $m \\in \\{-\\ell,\\dots,\\ell\\}$，球谐函数 $Y_{\\ell}^m(\\theta,\\phi)$ 构成一个正交全域基，该基可对角化算子 $S_k$、$K_k'$ 和 $W_k$。令 $L$ 为一个非负整数截断指数。记 $v_{\\ell}$ 为 $S_k$ 的特征值，$\\kappa_{\\ell}'$ 为 $K_k'$ 的特征值，它们对应于由所有固定 $\\ell$ 的 $Y_{\\ell}^m$ 张成的子空间（特征值不依赖于 $m$）。Calderón 恒等式指出，在光滑闭曲面上，这些算子满足复合关系，特别是在适当的函数设定中，$W_k S_k = K_k'^2 - \\tfrac{1}{4} I$。\n\n仅从下面列出的基本定律和核心定义出发，您必须从第一性原理推导球体 $\\Gamma$ 上算子的谱形式，并设计一个数值稳定的算法来评估：\n- 截断单层算子的条件数，\n- 由复合算子 $W_k S_k + \\tfrac{1}{4} I$ 构成的 Calderón 正则化算子的条件数。\n\n使用的基本定律和定义集：\n- 亥姆霍兹方程 $\\Delta u + k^2 u = 0$ 的辐射解及其通过由 $G_k$ 构造的边界层位势的表示。\n- 球谐函数的加法定理以及球坐标系下的变量分离法。\n- 层位势法向导数跨越 $\\Gamma$ 的跳跃关系。\n- 作为球坐标系下可分离解的径向部分的球贝塞尔函数和球汉克尔函数，以及它们的基本朗斯基恒等式。\n\n您的程序必须使用在阶数 $L$ 处截断的全域基 $\\{Y_{\\ell}^m\\}$ 来实现以下内容：\n1. 计算半径为 $a$ 的球面上的单层算子 $S_k$ 的特征值 $\\{v_{\\ell}\\}_{\\ell=0}^L$。\n2. 计算同一球面上的伴随双层算子 $K_k'$ 的特征值 $\\{\\kappa_{\\ell}'\\}_{\\ell=0}^L$。\n3. 利用恒等式 $W_k S_k = K_k'^2 - \\tfrac{1}{4} I$ 消去 $W_k$，构建 Calderón 正则化算子，其特征值为 $\\{\\kappa_{\\ell}'^{\\,2}\\}_{\\ell=0}^L$。\n4. 对于下方的每个测试用例，报告：\n   - $S_k$ 在截断基上的条件数，定义为 $\\max_{\\ell \\in \\{0,\\dots,L\\}} |v_{\\ell}| \\big/ \\min_{\\ell \\in \\{0,\\dots,L\\}} |v_{\\ell}|$，\n   - Calderón 正则化算子 $W_k S_k + \\tfrac{1}{4} I = K_k'^2$ 的条件数，定义为 $\\max_{\\ell \\in \\{0,\\dots,L\\}} |\\kappa_{\\ell}'|^2 \\big/ \\min_{\\ell \\in \\{0,\\dots,L\\}} |\\kappa_{\\ell}'|^2$，\n   - 改善因子，定义为两个条件数之比。\n\n本问题中的所有量都是无量纲的，或是以无量纲乘积 $k a$ 形式出现的 $a$ 和 $k$ 的组合，因此输出中无需物理单位。在内部需要时，角度应理解为以弧度为单位。\n\n要实现的测试套件，其中每个测试用例都是一个三元组 $(a,k,L)$：\n- 测试 1 (正常路径): $(1.0,\\,0.3,\\,8)$\n- 测试 2 (中等频率，较大截断): $(1.0,\\,2.0,\\,20)$\n- 测试 3 (高频，更高截断): $(1.0,\\,10.0,\\,35)$\n- 测试 4 (边界截断情况): $(1.0,\\,0.5,\\,0)$\n\n您的程序应生成单行输出，其中包含四个测试用例的结果，格式为方括号括起来的逗号分隔列表的列表，每个内部列表按 [condition_number_S, condition_number_regularized, improvement_factor] 的顺序列出三个浮点数。例如，输出格式必须类似于：\n[[cS1,cR1,imp1],[cS2,cR2,imp2],[cS3,cR3,imp3],[cS4,cR4,imp4]]", "solution": "问题的核心是确定半径为 $a$ 的球体 $\\Gamma$ 上算子 $S_k$ 和 $K_k'$ 的特征值。这些算子可由球谐函数基 $\\{Y_{\\ell}^m\\}$ 对角化。我们从第一性原理推导相应的特征值，记为 $v_{\\ell}$ 和 $\\kappa_{\\ell}'$。\n\n**1. 单层算子 ($S_k$) 的特征值**\n\n单层算子 $S_k$ 作用于面密度 $\\varphi$ 的方式如下：\n$$ (S_k \\varphi)(\\mathbf{x}) = \\int_{\\Gamma} G_k(\\mathbf{x},\\mathbf{y}) \\,\\varphi(\\mathbf{y}) \\, dS_{\\mathbf{y}} $$\n其中 $G_k(\\mathbf{x},\\mathbf{y}) = \\frac{\\exp(i k \\lVert \\mathbf{x}-\\mathbf{y} \\rVert)}{4\\pi \\lVert \\mathbf{x}-\\mathbf{y} \\rVert}$ 是亥姆霍兹方程的自由空间格林函数。为了找到特征值 $v_{\\ell}$，我们令 $\\varphi$ 为一个球谐函数，$\\varphi(\\mathbf{y}) = Y_{\\ell}^m(\\hat{\\mathbf{y}})$，其中 $\\hat{\\mathbf{y}}$ 是球面上点 $\\mathbf{y}$ 的方向向量。\n\n对于球体 $\\Gamma$ 上的点 $\\mathbf{x}$ 和 $\\mathbf{y}$ ($|\\mathbf{x}| = |\\mathbf{y}| = a$)，格林函数可以使用球面波的加法定理展开：\n$$ G_k(\\mathbf{x},\\mathbf{y}) = ik \\sum_{n=0}^{\\infty} \\sum_{p=-n}^{n} j_n(ka) h_n^{(1)}(ka) Y_n^p(\\hat{\\mathbf{x}}) \\overline{Y_n^p(\\hat{\\mathbf{y}})} $$\n其中 $j_n$ 和 $h_n^{(1)}$ 分别是第一类球贝塞尔函数和球汉克尔函数。\n\n将此展开式代入算子定义，其中 $\\varphi(\\mathbf{y}) = Y_{\\ell}^m(\\hat{\\mathbf{y}})$ 且面元 $dS_{\\mathbf{y}} = a^2 d\\Omega_{\\mathbf{y}}$：\n$$ (S_k Y_{\\ell}^m)(\\mathbf{x}) = \\int_{\\Omega} \\left( ik \\sum_{n=0}^{\\infty} \\sum_{p=-n}^{n} j_n(ka) h_n^{(1)}(ka) Y_n^p(\\hat{\\mathbf{x}}) \\overline{Y_n^p(\\hat{\\mathbf{y}})} \\right) Y_{\\ell}^m(\\hat{\\mathbf{y}}) \\, a^2 d\\Omega_{\\mathbf{y}} $$\n其中积分是在单位球的立体角 $\\Omega$ 上进行的。交换求和与积分的顺序：\n$$ (S_k Y_{\\ell}^m)(\\mathbf{x}) = ik a^2 \\sum_{n=0}^{\\infty} \\sum_{p=-n}^{n} j_n(ka) h_n^{(1)}(ka) Y_n^p(\\hat{\\mathbf{x}}) \\int_{\\Omega} \\overline{Y_n^p(\\hat{\\mathbf{y}})} Y_{\\ell}^m(\\hat{\\mathbf{y}}) d\\Omega_{\\mathbf{y}} $$\n根据球谐函数的正交性，$\\int_{\\Omega} \\overline{Y_n^p} Y_{\\ell}^m d\\Omega = \\delta_{n\\ell} \\delta_{pm}$。双重求和坍缩为 $n=\\ell$ 和 $p=m$ 的单项：\n$$ (S_k Y_{\\ell}^m)(\\mathbf{x}) = \\left( ik a^2 j_{\\ell}(ka) h_{\\ell}^{(1)}(ka) \\right) Y_{\\ell}^m(\\hat{\\mathbf{x}}) $$\n因此，单层算子 $S_k$ 的特征值 $v_{\\ell}$（不依赖于指数 $m$）为：\n$$ v_{\\ell} = ik a^2 j_{\\ell}(ka) h_{\\ell}^{(1)}(ka) $$\n\n**2. 伴随双层算子 ($K_k'$) 的特征值**\n\n算子 $K_k'$ 通过单层位势 $u = S_k \\varphi$ 的平均法向导数定义。令 $\\varphi = Y_{\\ell}^m$。位势 $u(\\mathbf{x}) = (S_k Y_{\\ell}^m)(\\mathbf{x})$ 是亥姆霍兹方程在 $|\\mathbf{x}| > a$ 时的辐射解，在 $|\\mathbf{x}| < a$ 时的正则解。使用变量分离法，位势可以表示为：\n$$ u(\\mathbf{x}) = ik a^2 Y_{\\ell}^m(\\hat{\\mathbf{x}}) \\begin{cases} j_{\\ell}(ka) h_{\\ell}^{(1)}(kr) & r > a \\\\ h_{\\ell}^{(1)}(ka) j_{\\ell}(kr) & r < a \\end{cases} $$\n其中 $r=|\\mathbf{x}|$。向外的单位法向量为 $\\mathbf{n} = \\hat{\\mathbf{r}}$，因此法向导数为 $\\frac{\\partial}{\\partial n} = \\frac{\\partial}{\\partial r}$。在 $\\Gamma$ 上，法向导数的外部 (+) 和内部 (-) 极限为：\n$$ \\frac{\\partial u}{\\partial n}\\bigg|_{+} = \\frac{\\partial u}{\\partial r}\\bigg|_{r=a^+} = ik a^2 Y_{\\ell}^m(\\hat{\\mathbf{x}}) j_{\\ell}(ka) \\left[k \\frac{d}{d(kr)} h_{\\ell}^{(1)}(kr)\\right]_{r=a} = ik^2 a^2 j_{\\ell}(ka) h_{\\ell}^{(1)\\prime}(ka) Y_{\\ell}^m(\\hat{\\mathbf{x}}) $$\n$$ \\frac{\\partial u}{\\partial n}\\bigg|_{-} = \\frac{\\partial u}{\\partial r}\\bigg|_{r=a^-} = ik a^2 Y_{\\ell}^m(\\hat{\\mathbf{x}}) h_{\\ell}^{(1)}(ka) \\left[k \\frac{d}{d(kr)} j_{\\ell}(kr)\\right]_{r=a} = ik^2 a^2 h_{\\ell}^{(1)}(ka) j_{\\ell}^{\\prime}(ka) Y_{\\ell}^m(\\hat{\\mathbf{x}}) $$\n其中撇号表示对自变量的微分。算子 $K_k'$ 是这两个极限的平均值：\n$$ (K_k' Y_{\\ell}^m)(\\mathbf{x}) = \\frac{1}{2} \\left(\\frac{\\partial u}{\\partial n}\\bigg|_{+} + \\frac{\\partial u}{\\partial n}\\bigg|_{-}\\right) $$\n代入导数表达式可得：\n$$ (K_k' Y_{\\ell}^m)(\\mathbf{x}) = \\left( \\frac{1}{2} ik^2 a^2 \\left[ j_{\\ell}'(ka) h_{\\ell}^{(1)}(ka) + j_{\\ell}(ka) h_{\\ell}^{(1)\\prime}(ka) \\right] \\right) Y_{\\ell}^m(\\hat{\\mathbf{x}}) $$\n因此，伴随双层算子 $K_k'$ 的特征值 $\\kappa_{\\ell}'$ 为：\n$$ \\kappa_{\\ell}' = \\frac{1}{2} i (ka)^2 \\left[ j_{\\ell}'(ka) h_{\\ell}^{(1)}(ka) + j_{\\ell}(ka) h_{\\ell}^{(1)\\prime}(ka) \\right] $$\n\n**3. Calderón 正则化与条件数**\n\n问题要求分析算子 $W_k S_k + \\frac{1}{4}I$。所提供的 Calderón 恒等式为 $W_k S_k = K_k'^2 - \\frac{1}{4}I$。因此，正则化算子就是 $K_k'^2$。由于 $Y_{\\ell}^m$ 是 $K_k'$ 的特征函数，特征值为 $\\kappa_{\\ell}'$，因此它们也是 $K_k'^2$ 的特征函数，特征值为 $(\\kappa_{\\ell}')^2$。\n\n表示为矩阵的线性算子的条件数是其最大奇异值与最小奇异值之比。在基 $\\{Y_{\\ell}^m\\}_{\\ell=0,..,L}$ 中，算子 $S_k$ 和 $K_k'^2$ 分别由对角矩阵表示，其对角元为 $\\{v_{\\ell}\\}$ 和 $\\{(\\kappa_{\\ell}')^2\\}$（重数为 $2\\ell+1$）。奇异值是这些特征值的模。\n\n截断单层算子 $S_k$ 的条件数为：\n$$ \\text{cond}(S_k) = \\frac{\\max_{\\ell \\in \\{0, \\dots, L\\}} |v_{\\ell}|}{\\min_{\\ell \\in \\{0, \\dots, L\\}} |v_{\\ell}|} $$\n\nCalderón 正则化算子 $K_k'^2$ 的条件数为：\n$$ \\text{cond}(K_k'^2) = \\frac{\\max_{\\ell \\in \\{0, \\dots, L\\}} |(\\kappa_{\\ell}')^2|}{\\min_{\\ell \\in \\{0, \\dots, L\\}} |(\\kappa_{\\ell}')^2|} = \\frac{\\left(\\max_{\\ell \\in \\{0, \\dots, L\\}} |\\kappa_{\\ell}'|\\right)^2}{\\left(\\min_{\\ell \\in \\{0, \\dots, L\\}} |\\kappa_{\\ell}'|\\right)^2} $$\n\n改善因子是这两个条件数之比，即 $\\text{cond}(S_k) / \\text{cond}(K_k'^2)$。\n\n**4. 算法实现**\n\n数值计算过程如下：\n对于每个测试用例 $(a, k, L)$：\n1.  定义自变量 $z = ka$。\n2.  对于从 $0$ 到 $L$ 的每个整数阶 $\\ell$：\n    a. 使用诸如 `scipy.special` 之类的稳健库计算球贝塞尔函数 $j_{\\ell}(z)$、$j_{\\ell}'(z)$ 和球诺伊曼函数 $y_{\\ell}(z)$、$y_{\\ell}'(z)$。\n    b. 构建球汉克尔函数 $h_{\\ell}^{(1)}(z) = j_{\\ell}(z) + i y_{\\ell}(z)$ 及其导数 $h_{\\ell}^{(1)\\prime}(z) = j_{\\ell}'(z) + i y_{\\ell}'(z)$。\n    c. 使用推导出的公式计算特征值 $v_{\\ell}$ 和 $\\kappa_{\\ell}'$。\n3.  构建绝对值数组 $|v_0|, \\dots, |v_L|$ 和 $|\\kappa'_0|^2, \\dots, |\\kappa'_L|^2$。\n4.  通过在这些数组中找到最大值和最小值并计算它们的比率来计算条件数。\n5.  计算改善因子。\n\n对于 $L=0$ 的特殊情况，基仅包含单个函数。生成的算子矩阵是 $1 \\times 1$ 的，其条件数自然为 $1$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import spherical_jn, spherical_yn\n\ndef solve():\n    \"\"\"\n    Solves the problem of computing condition numbers for boundary integral operators on a sphere.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple (a, k, L).\n    test_cases = [\n        (1.0, 0.3, 8),\n        (1.0, 2.0, 20),\n        (1.0, 10.0, 35),\n        (1.0, 0.5, 0),\n    ]\n\n    results = []\n    for a, k, L in test_cases:\n        # For L=0, the basis contains a single function space. The condition\n        # number of any operator represented in this basis is trivially 1.\n        if L == 0:\n            results.append([1.0, 1.0, 1.0])\n            continue\n\n        # Wavenumber-radius product\n        z = k * a\n        # Array of spherical harmonic degrees\n        ells = np.arange(L + 1)\n\n        # Compute spherical Bessel and Neumann functions of orders 0 to L\n        # The sph_jn(L, z) call returns an array of values for n=0..L\n        j_l = spherical_jn(ells, z)\n        y_l = spherical_yn(ells, z)\n\n        # Compute derivatives of spherical Bessel and Neumann functions\n        # The derivative call in scipy requires a loop over orders.\n        j_l_prime = np.array([spherical_jn(l, z, derivative=True) for l in ells])\n        y_l_prime = np.array([spherical_yn(l, z, derivative=True) for l in ells])\n\n        # Construct spherical Hankel functions and their derivatives\n        # h_l^(1)(z) = j_l(z) + i * y_l(z)\n        h1_l = j_l + 1j * y_l\n        h1_l_prime = j_l_prime + 1j * y_l_prime\n\n        # 1. Compute eigenvalues {v_l} of the single-layer operator S_k\n        # v_l = i * k * a^2 * j_l(ka) * h_l^(1)(ka)\n        v_l_vals = 1j * k * a**2 * j_l * h1_l\n\n        # 2. Compute eigenvalues {kappa'_l} of the adjoint double-layer operator K'_k\n        # kappa'_l = 0.5 * i * (ka)^2 * (j_l'(ka)h_l^(1)(ka) + j_l(ka)h_l^(1)'(ka))\n        k_prime_l_vals = 0.5 * 1j * z**2 * (j_l_prime * h1_l + j_l * h1_l_prime)\n        \n        # 3. Form eigenvalues of Calderon-regularized operator, { (kappa'_l)^2 }\n        # These are simply the square of the eigenvalues of K'_k.\n\n        # 4. Compute condition numbers and improvement factor\n        \n        # Magnitudes of eigenvalues of S_k\n        abs_v = np.abs(v_l_vals)\n        # Magnitudes of eigenvalues of K'_k^2, which is |kappa'_l|^2\n        abs_k_sq = np.abs(k_prime_l_vals)**2\n\n        # Condition number of S_k\n        cond_S = np.max(abs_v) / np.min(abs_v)\n        \n        # Condition number of K'_k^2\n        cond_R = np.max(abs_k_sq) / np.min(abs_k_sq)\n        \n        # Improvement factor\n        improvement = cond_S / cond_R\n\n        results.append([cond_S, cond_R, improvement])\n\n    # Format the final output string as specified\n    formatted_results = [f\"[{','.join(map(str, r))}]\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3305837"}]}