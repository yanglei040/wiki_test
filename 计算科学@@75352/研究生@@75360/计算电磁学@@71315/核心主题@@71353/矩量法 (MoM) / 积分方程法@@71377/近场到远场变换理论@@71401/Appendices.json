{"hands_on_practices": [{"introduction": "在深入研究复杂的数值算法之前，回归第一性原理是至关重要的。这项练习旨在通过一个经典的“纸笔”推导来巩固近场-远场变换的理论基石——场等效原理。通过分析一个基本的电偶极子，您将亲手证明，利用包围源的惠更斯面上感应出的等效电流计算出的远场，与直接从源的电流分布计算出的远场完全一致([@problem_id:3333713])。", "problem": "考虑一个嵌入在均匀、各向同性、无源介质中的时谐基本电偶极子源，该介质的特性为：介电常数 $\\epsilon$、磁导率 $\\mu$、波数 $k = \\omega \\sqrt{\\mu \\epsilon}$ 和本征阻抗 $\\eta = \\sqrt{\\mu/\\epsilon}$，时间约定为 $\\exp(\\mathrm{i}\\omega t)$。该源是一个位于原点的点电偶极子，其矩为 $\\mathbf{p} = p_0 \\,\\hat{\\mathbf{z}}$，在频域中由极化电流密度 $\\mathbf{J}(\\mathbf{r}') = -\\mathrm{i}\\omega \\mathbf{p}\\,\\delta(\\mathbf{r}')$ 表示。\n\n从频域中的 Maxwell 方程组和无界均匀介质中辐射电场的并矢格林函数表示出发，推导辐射电场 $\\mathbf{E}^{\\text{ff}}(\\mathbf{r})$ 的远区主阶表达式，并确定其角向依赖性。然后，利用 Love 等效原理，用半径为 $a$ 的球面 Huygens 面 $S$ 包围该偶极子，并在 $S$ 上构建等效面电流 $\\mathbf{J}_s = \\hat{\\mathbf{n}} \\times \\mathbf{H}$ 和 $\\mathbf{M}_s = -\\hat{\\mathbf{n}} \\times \\mathbf{E}$，以再现外部场。利用这些等效电流的标准辐射积分，执行近场到远场变换，以获得辐射场的远区角向依赖性。\n\n验证从并矢格林函数方法获得的角向依赖性与从 Huygens 面近场到远场变换获得的角向依赖性相匹配。将最终结果表示为电场远场幅度的归一化角向依赖性 $f(\\theta,\\phi)$（通过其在所有角度上的最大值进行归一化），其中极角 $\\theta$ 和方位角 $\\phi$ 以弧度为单位。你的最终答案必须是 $f(\\theta,\\phi)$ 的一个单一闭式表达式，不含任何单位，也不含任何径向依赖性。", "solution": "该问题被评估为有效。这是一个电磁理论中的标准、良态问题，基于基本原理（Maxwell 方程组、等效原理），没有歧义或事实错误。虽然所给的时间约定 $\\exp(\\mathrm{i}\\omega t)$ 与物理偶极子在频域中的电流密度的常规符号之间存在微小的不一致，但这只影响最终场的总相位，对我们关心的量——场的幅度或其归一化的角向依赖性没有影响。\n\n该问题要求使用两种不同的方法推导基本电偶极子的远场角向依赖性，并验证其一致性。最终结果是归一化的角向方向图函数 $f(\\theta, \\phi)$。\n\n设球坐标系为 $(\\mathbf{r}, \\mathbf{\\theta}, \\mathbf{\\phi})$。偶极矩沿 z 轴方向，$\\mathbf{p} = p_0 \\hat{\\mathbf{z}}$。观测点为 $\\mathbf{r} = r\\hat{\\mathbf{r}}$，其中 $\\hat{\\mathbf{r}} = \\sin\\theta\\cos\\phi\\,\\hat{\\mathbf{x}} + \\sin\\theta\\sin\\phi\\,\\hat{\\mathbf{y}} + \\cos\\theta\\,\\hat{\\mathbf{z}}$。\n\n**方法一：源电流的直接辐射**\n\n我们从电流密度 $\\mathbf{J}(\\mathbf{r}')$ 产生的矢量势 $\\mathbf{A}(\\mathbf{r})$ 开始。对于给定的时间约定 $\\exp(\\mathrm{i}\\omega t)$，在洛伦兹规范下，$\\mathbf{A}$ 的亥姆霍兹方程为 $(\\nabla^2 + k^2)\\mathbf{A} = -\\mu\\mathbf{J}$。其解由以下积分给出：\n$$\n\\mathbf{A}(\\mathbf{r}) = \\mu \\int_V \\mathbf{J}(\\mathbf{r}') \\frac{\\exp(-\\mathrm{i}k|\\mathbf{r}-\\mathbf{r}'|)}{4\\pi|\\mathbf{r}-\\mathbf{r}'|} dV'\n$$\n格林函数 $\\exp(-\\mathrm{i}kR)/(4\\pi R)$ 确保了出射波。源是位于原点 $\\mathbf{r}'=0$ 的点偶极子，其电流密度为 $\\mathbf{J}(\\mathbf{r}') = -\\mathrm{i}\\omega \\mathbf{p}\\,\\delta(\\mathbf{r}')$。将其代入积分，得到：\n$$\n\\mathbf{A}(\\mathbf{r}) = \\mu \\int_V (-\\mathrm{i}\\omega \\mathbf{p}\\,\\delta(\\mathbf{r}')) \\frac{\\exp(-\\mathrm{i}k|\\mathbf{r}-\\mathbf{r}'|)}{4\\pi|\\mathbf{r}-\\mathbf{r}'|} dV' = -\\frac{\\mathrm{i}\\omega\\mu \\mathbf{p}}{4\\pi} \\frac{\\exp(-\\mathrm{i}kr)}{r}\n$$\n由于 $\\mathbf{p} = p_0 \\hat{\\mathbf{z}}$，矢量势为：\n$$\n\\mathbf{A}(\\mathbf{r}) = -\\frac{\\mathrm{i}\\omega\\mu p_0}{4\\pi} \\frac{\\exp(-\\mathrm{i}kr)}{r} \\hat{\\mathbf{z}}\n$$\n在远场区（$kr \\gg 1$），辐射电场 $\\mathbf{E}^{\\text{ff}}$ 与传播方向 $\\hat{\\mathbf{r}}$ 横向正交，并且与矢量势的横向分量 $\\mathbf{A}_\\perp = \\mathbf{A} - (\\mathbf{A} \\cdot \\hat{\\mathbf{r}})\\hat{\\mathbf{r}}$ 相关，关系如下：\n$$\n\\mathbf{E}^{\\text{ff}}(\\mathbf{r}) \\approx -\\mathrm{i}\\omega \\mathbf{A}_\\perp\n$$\n我们将 $\\hat{\\mathbf{z}}$ 用球坐标表示：$\\hat{\\mathbf{z}} = \\cos\\theta\\,\\hat{\\mathbf{r}} - \\sin\\theta\\,\\hat{\\mathbf{\\theta}}$。$\\hat{\\mathbf{z}}$ 的横向分量为 $\\hat{\\mathbf{z}}_\\perp = \\hat{\\mathbf{z}} - (\\hat{\\mathbf{z}}\\cdot\\hat{\\mathbf{r}})\\hat{\\mathbf{r}} = (\\cos\\theta\\,\\hat{\\mathbf{r}} - \\sin\\theta\\,\\hat{\\mathbf{\\theta}}) - \\cos\\theta\\,\\hat{\\mathbf{r}} = -\\sin\\theta\\,\\hat{\\mathbf{\\theta}}$。因此，横向矢量势为：\n$$\n\\mathbf{A}_\\perp(\\mathbf{r}) = -\\frac{\\mathrm{i}\\omega\\mu p_0}{4\\pi} \\frac{\\exp(-\\mathrm{i}kr)}{r} (-\\sin\\theta\\,\\hat{\\mathbf{\\theta}}) = \\frac{\\mathrm{i}\\omega\\mu p_0}{4\\pi} \\frac{\\exp(-\\mathrm{i}kr)}{r} \\sin\\theta\\,\\hat{\\mathbf{\\theta}}\n$$\n于是远区电场为：\n$$\n\\mathbf{E}^{\\text{ff}}(\\mathbf{r}) = -\\mathrm{i}\\omega \\left( \\frac{\\mathrm{i}\\omega\\mu p_0}{4\\pi} \\frac{\\exp(-\\mathrm{i}kr)}{r} \\sin\\theta\\,\\hat{\\mathbf{\\theta}} \\right) = \\frac{\\omega^2\\mu p_0}{4\\pi} \\frac{\\exp(-\\mathrm{i}kr)}{r} \\sin\\theta\\,\\hat{\\mathbf{\\theta}}\n$$\n使用 $k^2 = \\omega^2\\mu\\epsilon$，我们可以将其写为 $\\mathbf{E}^{\\text{ff}}(\\mathbf{r}) = \\frac{k^2 p_0}{4\\pi\\epsilon} \\frac{\\exp(-\\mathrm{i}kr)}{r} \\sin\\theta\\,\\hat{\\mathbf{\\theta}}$。\n远区电场的幅度为：\n$$\n|\\mathbf{E}^{\\text{ff}}(\\mathbf{r})| = \\left| \\frac{\\omega^2\\mu p_0}{4\\pi} \\right| \\frac{1}{r} |\\sin\\theta|\n$$\n幅度的角向依赖性由函数 $g(\\theta, \\phi) = |\\sin\\theta|$ 给出。由于极角 $\\theta$ 的范围是 $0$ 到 $\\pi$，所以 $\\sin\\theta \\ge 0$，因此我们可以将其写为 $g(\\theta, \\phi) = \\sin\\theta$。\n\n**方法二：通过 Huygens 原理进行近场到远场变换**\n\n此方法包括两个步骤：首先，确定包围源的封闭曲面 $S$ 上的精确电场 $\\mathbf{E}$ 和磁场 $\\mathbf{H}$（即“近场”）；其次，利用这些场定义辐射到外部区域的等效面电流，并从这些电流计算远场。\n\n设 $S$ 是一个以原点为中心、半径为 $a$ 的球面。根据 Love 等效原理， $S$ 外部的场是由 $S$ 上的等效电面电流和磁面电流产生的：\n$$\n\\mathbf{J}_s = \\hat{\\mathbf{n}} \\times \\mathbf{H} \\quad \\text{和} \\quad \\mathbf{M}_s = -\\hat{\\mathbf{n}} \\times \\mathbf{E}\n$$\n其中 $\\hat{\\mathbf{n}} = \\hat{\\mathbf{r}}$ 是 $S$ 的外法向单位矢量，而 $\\mathbf{E}$ 和 $\\mathbf{H}$ 是由偶极子在曲面 $S$ 上产生的精确场。由这些等效电流产生的远区电场由辐射积分给出，这些积分代表了近场到远场变换（NTFF）。\n\n我们不采用辐射积分的强力计算方法，而是使用一个基于球面波展开的更巧妙的论证。\n1.  由位于原点且沿 $\\hat{\\mathbf{z}}$ 轴方向的基本电偶极子辐射的场是相对于 z 轴的纯横磁（TM）模。用矢量球谐函数（VSH）表示，这对应于 $\\mathbf{N}_{e10}^{(2)}$ 模。下标“e”表示偶数 $\\phi$ 依赖性（$\\cos(m\\phi)$），“1”是模式阶数 n，“0”是方位角指数 m，上标“(2)”表示由第二类球汉克尔函数 $h_n^{(2)}(kr)$ 描述的出射波。\n\n2.  因此，球面 $S$ 上（在 $r=a$ 处）的精确场仅由这个 $\\mathbf{N}_{e10}^{(2)}$ 模式描述。场的形式为：\n    $$\n    \\mathbf{E}(\\mathbf{r}') = C_E \\mathbf{N}_{e10}^{(2)}(k\\mathbf{r}') \\quad \\text{和} \\quad \\mathbf{H}(\\mathbf{r}') = C_H \\mathbf{M}_{o10}^{(2)}(k\\mathbf{r}') \\quad \\text{对于 } |\\mathbf{r}'|=a\n    $$\n    其中场之间的关系意味着单个电偶极子模式会同时激励 TM ($\\mathbf{N}$) 和 TE ($\\mathbf{M}$) 模式。对于纯电偶极子源，展开完全是基于矢量势导出的 $\\mathbf{N}$ 模式，然后通过旋度求得磁场。关键的洞察在于，源具有明确的模式特征。\n\n3.  使用辐射积分的近场到远场（NTFF）变换计算是一个线性变换，它将球面 $S$ 上的切向场映射到远区场。矢量球谐函数的一个基本性质是它们是此变换的本征函数。这意味着，如果球面 $S$ 上的场是一个纯粹的矢量球谐函数模式，那么由等效电流辐射的、在所有 $r>a$ 处的场也将是同一个矢量球谐函数模式。\n\n4.  因此，由于 $S$ 上的场纯粹是 $\\mathbf{N}_{e10}^{(2)}$ 类型，通过 NTFF 程序计算出的远区场也必须纯粹是 $\\mathbf{N}_{e10}^{(2)}$ 类型。\n\n5.  我们现在只需要 $\\mathbf{N}_{e10}^{(2)}$ 模式的远场渐近形式。当 $kr \\to \\infty$ 时，矢量球谐函数具有以下渐近行为：\n    $$\n    \\mathbf{N}_{enm}^{(2)}(k\\mathbf{r}) \\sim \\frac{(-\\mathrm{i})^{n+1}}{kr} e^{-\\mathrm{i}kr} \\left[ -\\frac{\\partial P_n^m(\\cos\\theta)}{\\partial\\theta} \\cos(m\\phi) \\hat{\\mathbf{\\theta}} - \\frac{m}{\\sin\\theta} P_n^m(\\cos\\theta) \\sin(m\\phi) \\hat{\\mathbf{\\phi}} \\right]\n    $$\n    对于我们的模式（$n=1, m=0$），我们有 $P_1^0(\\cos\\theta) = \\cos\\theta$。表达式简化为：\n    $$\n    \\mathbf{N}_{e10}^{(2)}(k\\mathbf{r}) \\sim \\frac{(-\\mathrm{i})^2}{kr} e^{-\\mathrm{i}kr} \\left[ -\\frac{\\partial (\\cos\\theta)}{\\partial\\theta} \\hat{\\mathbf{\\theta}} \\right] = -\\frac{e^{-\\mathrm{i}kr}}{kr} [-(-\\sin\\theta)\\hat{\\mathbf{\\theta}}] = -\\frac{e^{-\\mathrm{i}kr}}{kr} \\sin\\theta\\,\\hat{\\mathbf{\\theta}}\n    $$\n    因此，通过 NTFF 方法获得的远区电场幅度与 $|\\sin\\theta|$ 成正比。对于 $\\theta \\in [0, \\pi]$，此值为 $\\sin\\theta$。\n\n**结论与最终答案**\n\n直接辐射计算（方法一）和基于 Huygens 原理的近场到远场变换（方法二）都得出一个远区电场，其幅度的角向依赖性为 $\\sin\\theta$。这证实了两种方法的一致性。\n\n问题要求归一化的角向依赖性 $f(\\theta,\\phi)$。推导出的角函数是 $g(\\theta, \\phi) = \\sin\\theta$。为了归一化它，我们将其除以它在所有角度 $(\\theta, \\phi)$ 上的最大值。\n$$\n\\max_{\\theta, \\phi} g(\\theta, \\phi) = \\max_{\\theta \\in [0,\\pi]} \\sin\\theta = 1 \\quad (\\text{在 } \\theta = \\pi/2 \\text{ 处})\n$$\n因此，归一化的角向依赖性为：\n$$\nf(\\theta, \\phi) = \\frac{g(\\theta, \\phi)}{\\max g(\\theta, \\phi)} = \\frac{\\sin\\theta}{1} = \\sin\\theta\n$$\n该函数与方位角 $\\phi$ 无关，这与源绕 z 轴的旋转对称性相符。", "answer": "$$\n\\boxed{\\sin(\\theta)}\n$$", "id": "3333713"}, {"introduction": "理论联系实际的下一步是将其转化为计算实践。本练习将带领您从连续的理论世界进入离散的数值计算领域，在这里，远场角谱与近场孔径场之间的傅里叶变换关系将通过代码实现。您将直面有限采样带来的挑战，并探索如何通过非均匀采样和窗函数等实用技术来有效抑制频谱泄漏，从而提高远场方向图的计算精度([@problem_id:3333760])。", "problem": "您的任务是为二维横电（TE）极化场景构建并分析一维测量曲线 $\\Gamma$ 上的非均匀近场采样方案，并使用角谱表示法将其变换到远场。目标是设计一个非均匀采样分布，该分布能在最小化混叠的同时保持远场主波束的保真度，并量化施加于近场孔径上的连续窗函数 $w(x)$ 对归一化远场幅度方向图旁瓣电平的影响。\n\n从一个数学上有效的基础出发，该基础由自由空间标量 Green 函数、Huygens 等效原理和平面波（角谱）展开组成，推导在 $z=0$ 处限制在直线段 $\\Gamma = \\{(x,0): x \\in [-L/2, L/2]\\}$ 上的孔径场的远场角谱形式。假设 $\\Gamma$ 上的切向电场分布是一个标量孔径函数 $E(x)$，该函数在孔径上是平方可积且紧支撑的。在不假设任何快捷公式的情况下，从这些基础出发进行推理，以证明大半径观测圆上的远场幅度方向图与孔径分布的连续 Fourier 变换成正比，具体来说，是一个形如下式的积分\n$$\nF(\\theta) \\propto \\int_{-L/2}^{L/2} E(x)\\,w(x)\\,e^{-i k\\,x\\,\\sin\\theta}\\,dx,\n$$\n其中 $k$ 是自由空间波数，$\\theta$ 是相对于视轴的观测角。解释 $w(x)$ 作为一种变迹（apodization）函数的作用，它通过衰减由 $\\Gamma$ 上的有限截断引入的边缘不连续性，来以主瓣增宽换取旁瓣电平的降低。\n\n然后，在 $\\Gamma$ 上设计一个非均匀采样方案，该方案将样本点集中在孔径边缘附近，以减轻由不连续性引起的高空间频率分量，同时保持足够的采样密度以避免直至掠射角的空间混叠。使用受 Chebyshev 节点布局启发的余弦聚类节点分布，并通过讨论边缘聚类如何减少频谱泄漏来证明该选择的合理性。数值远场将通过非均匀求积法进行近似，该方法需与 Riemann 积分一致，并能精确地对振荡核进行积分。具体而言，实现一个基于节点局部间距 $\\Delta x_n$ 的求积法，其中 $\\Delta x_n$ 从最近邻距离计算得出。数值近似必须具有以下形式\n$$\n\\widehat{F}(\\theta) \\approx \\sum_{n=1}^{N} E(x_n)\\,w(x_n)\\,\\Delta x_n\\,e^{-i k\\,x_n\\,\\sin\\theta},\n$$\n其中 $x_n$ 是 $\\Gamma$ 上的采样节点，$\\Delta x_n$ 与非均匀网格上的复合梯形法则一致。\n\n为进行定量评估，请施加以下建模和数值条件，您必须严格遵守这些条件：\n\n- 自由空间传播，光速 $c = 2.99792458\\times 10^8\\,\\mathrm{m/s}$。\n- 频率 $f = 3\\,\\mathrm{GHz}$，因此波长 $\\lambda = c/f$，波数 $k = 2\\pi/\\lambda$，单位为 $\\mathrm{rad/m}$。\n- 孔径长度 $L = 1.0\\,\\mathrm{m}$。\n- 孔径场 $E(x) = 1$ (当 $x \\in [-L/2, L/2]$ 时)，否则 $E(x) = 0$。\n- 角度观测网格 $\\theta \\in [-90, 90]$ 度，以 $0.05$ 度的步长均匀采样。所有角度的输入/输出必须以度为单位，在内部进行三角函数计算时转换为弧度。\n- 在评估旁瓣之前，远场幅度方向图必须归一化，使其峰值为 $1$。\n\n使用衍射极限孔径估计来定义主瓣排除半宽度\n$$\n\\theta_{\\mathrm{ml}} = 1.5\\,\\arcsin\\!\\big(\\lambda/L\\big),\n$$\n以度为单位表示，并将旁瓣电平定义为在主瓣排除区域 $|\\theta| \\le \\theta_{\\mathrm{ml}}$ 之外的归一化幅度方向图的最大值。通过 $20\\log_{10}(\\cdot)$ 以分贝（dB）报告旁瓣电平。\n\n您必须评估并报告以下四个测试案例的旁瓣电平，这些案例构成了测试套件：\n\n- 案例 A（均匀，矩形窗）：在 $[-L/2, L/2]$ 上取 $N=128$ 个均匀间隔的样本点，孔径上使用矩形窗 $w(x)=1$。\n- 案例 B（均匀，Hann 窗）：$N=128$ 个均匀间隔的样本点，使用连续 Hann 窗 $w(x) = \\tfrac{1}{2}\\left(1+\\cos\\left(2\\pi x/L\\right)\\right)$（当 $|x|\\le L/2$ 时），否则 $w(x)=0$。\n- 案例 C（非均匀余弦聚类，矩形窗）：$N=128$ 个节点，由 $x_n = \\tfrac{L}{2}\\cos\\!\\big(\\pi n/(N-1)\\big)$（$n=0,\\dots,N-1$）定义，并按升序排序，孔径上使用 $w(x)=1$。\n- 案例 D（非均匀余弦聚类，Kaiser 窗）：与案例 C 相同的节点，使用连续 Kaiser 窗 $w(x) = I_0\\!\\Big(\\beta \\sqrt{1-(2x/L)^2}\\Big)\\big/I_0(\\beta)$（当 $|x|\\le L/2$ 时），否则 $w(x)=0$，其中 $\\beta = 6$。\n\n在所有案例中，使用非均匀复合梯形求积法来确定 $\\Delta x_n$，使得每个内部节点使用其到两个直接相邻节点距离和的一半，而每个端点使用其到一个唯一相邻节点距离的一半。\n\n您的程序必须输出每个案例的旁瓣电平，格式为单行，包含一个逗号分隔的 Python 列表，内含四个浮点数，单位为分贝，四舍五入到两位小数，顺序为 $[\\mathrm{案例\\ A},\\mathrm{案例\\ B},\\mathrm{案例\\ C},\\mathrm{案例\\ D}]$。按规定，角度的内外表示均使用度，旁瓣电平使用分贝。不应打印任何其他文本。\n\n您的实现必须是一个完整的、可运行的程序，不需要任何外部输入。", "solution": "所提出的问题是计算电磁学中一个明确定义的练习，具体涉及一维孔径在横电（TE）极化条件下的近场到远场变换（NFFT）。它具有科学依据，逻辑上一致，并且为获得唯一的数值解提供了所有必要的参数。因此，该问题被认为是有效的。\n\n问题的核心是计算源自有限孔径上已知电场分布的远场辐射方向图。这建立在 Huygens-Fresnel 原理之上，该原理假设波前上的每一点都可以被视为次级球面子波的源。在电磁学背景下，这一点通过 Kirchhoff-Helmholtz 积分定理或 Stratton-Chu 公式得到了更严格的表述，后者使用了矢量 Green 恒等式。\n\n对于一个二维 TE 极化问题，电场只有一个分量，比如 $E_z$，它满足标量 Helmholtz 方程 $(\\nabla^2 + k^2)E_z = 0$。在无源区域中，观测点 $\\mathbf{r}$ 处的场 $E_z(\\mathbf{r})$ 可以由包围源的闭合曲面上的切向场确定。如果我们将孔径视为 $z=0$ 平面上的一个线段 $\\Gamma = \\{(x, 0) : x \\in [-L/2, L/2]\\}$，那么半空间 $z>0$ 中的场由孔径场分布上的积分给出。辐射积分的一种简化形式是：\n$$\nE_z(\\mathbf{r}) \\approx \\int_{\\Gamma} E(x') \\frac{\\partial G(\\mathbf{r}, \\mathbf{r}')}{\\partial n'} dS'\n$$\n其中 $E(x')$ 是指定的孔径场，$G(\\mathbf{r}, \\mathbf{r}')$ 是二维自由空间 Green 函数，$\\partial/\\partial n'$ 是法向导数。二维 Green 函数是 $G(\\mathbf{r}, \\mathbf{r}') = -\\frac{i}{4} H_0^{(2)}(k|\\mathbf{r} - \\mathbf{r}'|)$，其中 $H_0^{(2)}$ 是零阶第二类 Hankel 函数，$k = 2\\pi/\\lambda$ 是自由空间波数。\n\n在远场区，观测点距离 $r = |\\mathbf{r}|$ 远大于孔径尺寸 $L$ 和波长 $\\lambda$ (即 $r \\gg L^2/\\lambda$)，我们可以使用渐近近似。从孔径上的源点 $\\mathbf{r}' = (x', 0)$ 到观测点 $\\mathbf{r} = (r\\sin\\theta, r\\cos\\theta)$ 的距离近似为 $|\\mathbf{r} - \\mathbf{r}'| \\approx r - x'\\sin\\theta$。这里，$\\theta$ 是从视轴方向（$z$ 轴）测量的角度。对于大的 $\\rho$，Hankel 函数具有渐近形式 $H_0^{(2)}(\\rho) \\sim \\sqrt{2/(\\pi\\rho)} e^{-i(\\rho - \\pi/4)}$。将这些近似代入辐射积分，与距离相关的项 $1/\\sqrt{r}$ 可以被提出来，而主要的角度依赖性来自于指数中的相位项。该积分简化为与孔径分布的 Fourier 变换成正比：\n$$\nF(\\theta) \\propto \\int_{-L/2}^{L/2} E(x') e^{-i k x' \\sin\\theta} dx'\n$$\n这建立了远场角方向图 $F(\\theta)$ 是空间孔径场分布 $E(x')$ 的 Fourier 变换这一基本关系。\n\n问题引入了一个窗函数，或称为变迹函数，$w(x)$。有效孔径分布成为乘积 $E(x)w(x)$。于是远场积分为：\n$$\nF(\\theta) \\propto \\int_{-L/2}^{L/2} E(x) w(x) e^{-i k x \\sin\\theta} dx\n$$\n$w(x)$ 的作用是减轻场在孔径边缘 $x = \\pm L/2$ 处突然截断所造成的影响。对于均匀孔径，其中 $E(x)=1$，该函数是一个矩形脉冲。其 Fourier 变换是 sinc 函数，$\\text{sinc}(u) = \\sin(u)/u$，其特点是主瓣窄，但旁瓣相对较高且衰减缓慢（按 $1/u$）。这些旁瓣是在边缘处不连续性的数学产物。通过应用一个在边缘处将场平滑地渐变到零的窗函数（例如，Hann 窗或 Kaiser 窗），不连续性被消除。空间域中更平滑的函数会导致频率（角度）域中衰减更快的函数。这降低了旁瓣电平，但代价是主波束变宽，这是信号处理和天线理论中的一个基本权衡。\n\n为了数值求解此积分，我们必须将其离散化。问题指定了一种数值求积形式：\n$$\n\\widehat{F}(\\theta) \\approx \\sum_{n=1}^{N} E(x_n) w(x_n) \\Delta x_n e^{-i k x_n \\sin\\theta}\n$$\n这里，$\\{x_n\\}$ 是孔径上的采样点，$\\{\\Delta x_n\\}$ 是求积权重。问题要求对非均匀网格使用复合梯形法则。对于一组排序后的节点 $x_0, x_1, \\ldots, x_{N-1}$，权重由下式给出：\n$$\n\\Delta x_n = \\begin{cases} \\frac{1}{2}(x_1 - x_0) & n=0 \\\\ \\frac{1}{2}(x_{n+1} - x_{n-1}) & 0 < n < N-1 \\\\ \\frac{1}{2}(x_{N-1} - x_{N-2}) & n=N-1 \\end{cases}\n$$\n这种权重的选择源于在标准复合梯形求和 $\\sum \\frac{1}{2}(f_i+f_{i+1})(x_{i+1}-x_i)$ 中按函数值 $f_n$ 重新组合各项。\n\n最后，问题研究了两种采样方案。均匀采样是最直接的方法，但可能不是最优的。非均匀余弦聚类采样，由 $x_n = \\frac{L}{2}\\cos(\\pi n/(N-1))$ 定义（然后排序），将节点更密集地放置在孔径边缘附近。这些是第二类 Chebyshev 节点。该策略的动机是基于这样一种理解：（未加窗的）孔径场的最剧烈变化发生在边缘处。通过在这些区域集中采样点，数值积分可以更准确地捕捉由这些不连续性产生的高空间频率内容，从而在固定的样本数量 $N$ 下，获得更准确的远场预测并减少空间混叠。\n\n指定的四个案例允许对这些效应进行定量比较：均匀采样与非均匀采样，以及无窗（矩形窗）与平滑窗（Hann, Kaiser）。旁瓣电平，计算为在定义的主瓣区域之外的归一化远场幅度的最大值，作为此比较的度量标准。主瓣半宽度 $\\theta_{\\text{ml}} = 1.5 \\arcsin(\\lambda/L)$ 是一个基于衍射极限 $\\sin\\theta \\approx \\lambda/L$ 的合理估计，其中的因子 $1.5$ 确保排除了整个主波束。分析将通过精确地实现所指定的数值模型来进行。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import i0\n\ndef solve():\n    \"\"\"\n    Solves the near-to-far-field transformation problem for four specified test cases.\n    \"\"\"\n\n    # --- Define constants and physical parameters ---\n    C = 2.99792458e8  # Speed of light in m/s\n    F = 3e9           # Frequency in Hz\n    L = 1.0           # Aperture length in m\n    N = 128           # Number of sample points\n    BETA_KAISER = 6.0 # Kaiser window parameter\n\n    # --- Derived physical parameters ---\n    WAVELENGTH = C / F\n    WAVENUMBER = 2 * np.pi / WAVELENGTH\n\n    # --- Define numerical parameters ---\n    # Angular grid: -90 to +90 degrees with 0.05 degree step\n    THETA_DEG = np.arange(-90.0, 90.0 + 0.05, 0.05)\n    THETA_RAD = np.deg2rad(THETA_DEG)\n\n    # Main-lobe exclusion half-width in degrees\n    theta_ml_deg = 1.5 * np.rad2deg(np.arcsin(WAVELENGTH / L))\n\n    # --- Define test cases ---\n    test_cases = [\n        {'name': 'A', 'sampling': 'uniform', 'window': 'rectangular'},\n        {'name': 'B', 'sampling': 'uniform', 'window': 'hann'},\n        {'name': 'C', 'sampling': 'cosine', 'window': 'rectangular'},\n        {'name': 'D', 'sampling': 'cosine', 'window': 'kaiser'},\n    ]\n\n    results_db = []\n\n    # --- Helper function for quadrature weights ---\n    def get_quadrature_weights(x_nodes):\n        \"\"\"\n        Calculates weights for nonuniform composite trapezoid rule.\n        \"\"\"\n        n_pts = len(x_nodes)\n        dx = np.zeros(n_pts)\n        dx[0] = 0.5 * (x_nodes[1] - x_nodes[0])\n        dx[1:-1] = 0.5 * (x_nodes[2:] - x_nodes[:-2])\n        dx[-1] = 0.5 * (x_nodes[-1] - x_nodes[-2])\n        return dx\n\n    # --- Process each test case ---\n    for case in test_cases:\n        # 1. Generate sample nodes (x_n)\n        if case['sampling'] == 'uniform':\n            x_nodes = np.linspace(-L / 2.0, L / 2.0, N)\n        else:  # cosine-clustered\n            # Generate points in descending order as per formula\n            nodes_desc = (L / 2.0) * np.cos(np.pi * np.arange(N) / (N - 1))\n            # Sort into ascending order\n            x_nodes = np.sort(nodes_desc)\n\n        # 2. Define aperture field E(x) = 1\n        e_values = np.ones(N)\n\n        # 3. Generate window function values (w(x_n))\n        if case['window'] == 'rectangular':\n            w_values = np.ones(N)\n        elif case['window'] == 'hann':\n            w_values = 0.5 * (1.0 + np.cos(2.0 * np.pi * x_nodes / L))\n        else:  # kaiser\n            arg = BETA_KAISER * np.sqrt(1.0 - (2.0 * x_nodes / L)**2)\n            w_values = i0(arg) / i0(BETA_KAISER)\n\n        # 4. Calculate quadrature weights (Δx_n)\n        dx_weights = get_quadrature_weights(x_nodes)\n\n        # 5. Form the terms for the summation\n        sum_terms = e_values * w_values * dx_weights\n\n        # 6. Calculate the far-field pattern F(θ)\n        # Using broadcasting via np.outer for efficiency\n        # Kernel: exp(-i * k * sin(theta) * x)\n        kernel = np.exp(-1j * WAVENUMBER * np.outer(np.sin(THETA_RAD), x_nodes))\n        f_theta = kernel @ sum_terms\n\n        # 7. Normalize the magnitude pattern\n        f_mag = np.abs(f_theta)\n        f_norm = f_mag / np.max(f_mag)\n\n        # 8. Find the side-lobe level\n        # A mask to select angles outside the main-lobe region\n        sidelobe_mask = np.abs(THETA_DEG) > theta_ml_deg\n        \n        # Max of the normalized pattern in the sidelobe region\n        max_sidelobe = np.max(f_norm[sidelobe_mask])\n        \n        # Convert to decibels\n        sll_db = 20.0 * np.log10(max_sidelobe)\n        \n        results_db.append(round(sll_db, 2))\n\n    # --- Final print statement in the exact required format ---\n    print(f\"[{','.join(map(str, results_db))}]\")\n\nsolve()\n```", "id": "3333760"}, {"introduction": "在真实的数值模拟中，我们获得的“近场数据”往往并非完美无瑕。这项高级练习模拟了一个在计算电磁学中普遍存在的问题：由完美匹配层（PML）等截断边界引起的寄生反射会污染近场数据。通过引入强大的德拜势（Debye potentials）进行模态分析，并运用双球面测量技术，您不仅能够执行近场到远场的变换，还能主动地滤除这些数值噪声，从而精确地重构出真实的散射场([@problem_id:3333743])。", "problem": "给定一个计算电磁学中的频域散射场景，其中一个球对称散射体嵌入在完美匹配层 (PML) 中。任务是使用 Debye 势，根据在 PML 内部同心球面上进行的近场测量来重构远场散射信息，同时要考虑 PML 反射带来的污染。重构过程必须从第一性原理推导，并实现为一个能够输出定量指标的完整、可运行的程序。\n\n推导的基本依据如下：\n\n- 频域中的麦克斯韦方程组，对于角频率为 $\\omega$、自由空间波数为 $k$ 的时谐场：\n$$\n\\nabla \\times \\mathbf{E} = i \\omega \\mu_0 \\mathbf{H}, \\quad \\nabla \\times \\mathbf{H} = -i \\omega \\varepsilon_0 \\mathbf{E}, \\quad \\nabla \\cdot \\mathbf{E} = 0, \\quad \\nabla \\cdot \\mathbf{H} = 0,\n$$\n其中 $\\varepsilon_0$ 是真空介电常数，$\\mu_0$ 是真空磁导率。\n\n- 对于球对称散射体的 Debye 势：电型 Debye 势 $\\Pi_e$ 和磁型 Debye 势 $\\Pi_m$ 在无源区域中均满足标量亥姆霍兹方程：\n$$\n\\nabla^2 \\Pi + k^2 \\Pi = 0.\n$$\n在具有轴对称性的球对称设置中，每个势都可以展开为勒让德多项式级数：\n$$\n\\Pi_e(r,\\theta) = \\sum_{\\ell=1}^{L_{\\max}} A_\\ell f_\\ell(r) P_\\ell(\\cos\\theta), \\quad \\Pi_m(r,\\theta) = \\sum_{\\ell=1}^{L_{\\max}} C_\\ell f_\\ell(r) P_\\ell(\\cos\\theta),\n$$\n其中 $P_\\ell$ 是 $\\ell$ 阶勒让德多项式，$f_\\ell(r)$ 是标量亥姆霍兹方程的一个径向解，该解可以是出射的或正则的。两个基本的径向解是第一类球贝塞尔函数 $j_\\ell(kr)$（在原点处正则）和第一类球汉克尔函数 $h_\\ell^{(1)}(kr)$（在无穷远处为出射波）。\n\n- 勒让德多项式的正交性：\n$$\n\\int_{-1}^{1} P_\\ell(x) P_{\\ell'}(x) \\, dx = \\frac{2}{2\\ell + 1} \\delta_{\\ell \\ell'}.\n$$\n\nPML 内部的近场测量会受到反射的污染。在本问题中，您将采用一个物理上合理的污染模型：在半径为 $r$ 的球面上测得的近场 Debye 势是出射波贡献和正则波贡献的线性组合，其系数为复数。对于电型势，\n$$\n\\Pi_e(r,\\theta) = \\sum_{\\ell=1}^{L_{\\max}} \\left(A_\\ell h_\\ell^{(1)}(kr) + B_\\ell j_\\ell(kr)\\right) P_\\ell(\\cos\\theta),\n$$\n对于磁型势，\n$$\n\\Pi_m(r,\\theta) = \\sum_{\\ell=1}^{L_{\\max}} \\left(C_\\ell h_\\ell^{(1)}(kr) + D_\\ell j_\\ell(kr)\\right) P_\\ell(\\cos\\theta).\n$$\n未知的出射多极子系数 $\\{A_\\ell\\}$ 和 $\\{C_\\ell\\}$ 决定了远场散射行为，而 $\\{B_\\ell\\}$ 和 $\\{D_\\ell\\}$ 代表由 PML 反射引起的污染。在用于测试的合成数据中，污染被建模为与出射系数成正比，其比例因子为一个复数：\n$$\nB_\\ell = R_e e^{i \\phi_e} A_\\ell, \\quad D_\\ell = R_m e^{i \\phi_m} C_\\ell,\n$$\n其中 $R_e$ 和 $R_m$ 是反射幅度，$\\phi_e$ 和 $\\phi_m$ 是反射相位。\n\n您的任务是：\n\n1. 从上述基础出发，推导一种方法，用于从 PML 内部两个半径为 $r_0$ 和 $r_1$ 的同心球面上的 $\\Pi_e$ 和 $\\Pi_m$ 近场测量值重构出射多极子系数 $\\{A_\\ell\\}$ 和 $\\{C_\\ell\\}$。仅使用所提供的基本事实，不要假设或使用任何预先推导的近场到远场变换的快捷方式。您必须明确说明分离每个角动量通道 $\\ell$ 的投影步骤。\n\n2. 设计并应用一种污染减除策略，该策略利用两个半径逐通道地分离出射波和正则波的贡献。根据 $h_\\ell^{(1)}$ 和 $j_\\ell$ 的性质证明其正确性。\n\n3. 将重构算法实现为一个 Python 程序，该程序：\n   - 使用下面的测试参数集，在 $r_0$ 和 $r_1$ 上生成合成的近场 Debye 势。\n   - 执行勒让德投影以获得两个半径上的通道系数。\n   - 对每个 $\\ell$，独立地从 $\\Pi_e$ 和 $\\Pi_m$ 求解一个 $2 \\times 2$ 的复线性方程组，从而得到 $A_\\ell$ 和 $C_\\ell$ 的估计值。\n   - 对每个测试案例，计算所有 $\\ell$ 在两种势下的最大绝对重构误差，即：\n     $$\n     \\max\\left\\{\\max_{\\ell} \\left| \\hat{A}_\\ell - A_\\ell \\right|, \\ \\max_{\\ell} \\left| \\hat{C}_\\ell - C_\\ell \\right| \\right\\}.\n     $$\n     该指标是无量纲的，必须以浮点数形式输出。\n\n物理和数值单位：$k$ 的单位为 $\\mathrm{m}^{-1}$，半径 $r_0$、$r_1$ 的单位为 $\\mathrm{m}$。Debye 势和多极子系数是无量纲的复数量。最终输出中不需要角度。最终输出格式必须是单行文本，包含一个用方括号括起来的、以逗号分隔的结果列表。\n\n测试集：\n\n- 案例 1 (理想情况):\n  - $k = 20 \\ \\mathrm{m}^{-1}$，$r_0 = 0.35 \\ \\mathrm{m}$，$r_1 = 0.42 \\ \\mathrm{m}$，$L_{\\max} = 4$。\n  - $\\ell=1,2,3,4$ 的电型出射系数 $A_\\ell$：$[0.9 + 0.1 i, \\ -0.4 + 0.2 i, \\ 0.1 - 0.05 i, \\ 0.02 + 0.03 i]$。\n  - $\\ell=1,2,3,4$ 的磁型出射系数 $C_\\ell$：$[0.08 - 0.10 i, \\ 0.03 + 0.02 i, \\ -0.02 + 0.01 i, \\ 0.00 + 0.005 i]$。\n  - PML 反射参数：$R_e = 0.06$，$\\phi_e = 0.8$ (弧度)；$R_m = 0.04$，$\\phi_m = -0.5$ (弧度)。\n\n- 案例 2 (无污染边界):\n  - $k = 35 \\ \\mathrm{m}^{-1}$，$r_0 = 0.25 \\ \\mathrm{m}$，$r_1 = 0.31 \\ \\mathrm{m}$，$L_{\\max} = 3$。\n  - $\\ell=1,2,3$ 的电型出射系数 $A_\\ell$：$[0.6 - 0.3 i, \\ -0.2 + 0.1 i, \\ 0.05 + 0.02 i]$。\n  - $\\ell=1,2,3$ 的磁型出射系数 $C_\\ell$：$[0.10 + 0.05 i, \\ 0.02 - 0.01 i, \\ -0.01 + 0.005 i]$。\n  - PML 反射参数：$R_e = 0.0$，$\\phi_e = 0.0$；$R_m = 0.0$，$\\phi_m = 0.0$。\n\n- 案例 3 (双半径分离中的近奇异几何):\n  - $k = 50 \\ \\mathrm{m}^{-1}$，$r_0 = 0.40 \\ \\mathrm{m}$，$r_1 = 0.405 \\ \\mathrm{m}$，$L_{\\max} = 4$。\n  - $\\ell=1,2,3,4$ 的电型出射系数 $A_\\ell$：$[0.7 + 0.2 i, \\ -0.3 + 0.15 i, \\ 0.08 - 0.04 i, \\ 0.015 + 0.02 i]$。\n  - $\\ell=1,2,3,4$ 的磁型出射系数 $C_\\ell$：$[0.06 - 0.08 i, \\ 0.025 + 0.015 i, \\ -0.015 + 0.008 i, \\ 0.0 + 0.004 i]$。\n  - PML 反射参数：$R_e = 0.12$，$\\phi_e = 1.2$；$R_m = 0.08$，$\\phi_m = -1.0$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表（例如，`[result1,result2,result3]`），其中每个 `resulti` 是案例 `i` 的最大绝对误差，如上文所定义，并且必须是一个浮点数（无量纲）。不应打印任何其他文本。程序必须是自包含的，并且不需要任何用户输入。", "solution": "该问题要求推导并实现一种方法，用于从受反射污染的近场数据中重构远场散射信息，该信息由出射多极子系数 $\\{A_\\ell\\}$ 和 $\\{C_\\ell\\}$ 概括。数据在两个同心球面上提供。推导过程遵循问题陈述中列出的第一性原理。\n\n出发点是 Debye 势的模态展开，该区域内同时包含散射波（出射波）和反射波（在原点处正则，但物理上是从外边界入射的波）。对于电型势 $\\Pi_e$，对于特定的半径 $r$ 和角度 $\\theta$，其表达式为：\n$$\n\\Pi_e(r,\\theta) = \\sum_{\\ell=1}^{L_{\\max}} \\left(A_\\ell h_\\ell^{(1)}(kr) + B_\\ell j_\\ell(kr)\\right) P_\\ell(\\cos\\theta)\n$$\n这里，$A_\\ell$ 是我们期望得到的出射波系数，$B_\\ell$ 是代表入射波的污染系数，$h_\\ell^{(1)}(kr)$ 是描述出射波的第一类球汉克尔函数，$j_\\ell(kr)$ 是描述在原点处正则的波的第一类球贝塞尔函数，$P_\\ell(\\cos\\theta)$ 是 $\\ell$ 阶勒让德多项式。对于磁型势 $\\Pi_m$，存在一个完全类似的表达式，其系数为 $C_\\ell$ 和 $D_\\ell$。\n\n第一步是分离出每个角动量通道 $\\ell$ 的贡献。这可以通过利用勒让德多项式的正交性来实现。其正交关系为：\n$$\n\\int_{-1}^{1} P_\\ell(x) P_{\\ell'}(x) \\, dx = \\frac{2}{2\\ell + 1} \\delta_{\\ell \\ell'}\n$$\n其中 $x = \\cos\\theta$，$\\delta_{\\ell\\ell'}$ 是克罗内克 δ 函数。我们可以定义一个投影操作。我们将 $\\Pi_e(r,\\theta)$ 的展开式乘以 $P_{\\ell'}(\\cos\\theta)$ 并对整个立体角进行积分，对于轴对称函数，这可以简化为在 $\\theta$ 上从 $0$ 到 $\\pi$ 的带权 $\\sin\\theta$ 的积分。通过替换 $x = \\cos\\theta$，这等效于在 $x$ 上从 $-1$ 到 $1$ 进行积分。\n$$\n\\int_{-1}^{1} \\Pi_e(r, \\arccos x) P_{\\ell'}(x) dx = \\int_{-1}^{1} \\sum_{\\ell=1}^{L_{\\max}} \\left(A_\\ell h_\\ell^{(1)}(kr) + B_\\ell j_\\ell(kr)\\right) P_\\ell(x) P_{\\ell'}(x) dx\n$$\n由于正交性，级数中除了 $\\ell = \\ell'$ 的项外，所有项都为零。\n$$\n\\int_{-1}^{1} \\Pi_e(r, \\arccos x) P_{\\ell'}(x) dx = \\left(A_{\\ell'} h_{\\ell'}^{(1)}(kr) + B_{\\ell'} j_{\\ell'}(kr)\\right) \\frac{2}{2\\ell' + 1}\n$$\n这使我们能够将每个模态 $\\ell$ 在半径 $r$ 处的投影径向系数定义为 $\\pi_{e,\\ell}(r)$：\n$$\n\\pi_{e,\\ell}(r) \\equiv \\frac{2\\ell+1}{2} \\int_{-1}^{1} \\Pi_e(r, \\arccos x) P_\\ell(x) dx = A_\\ell h_\\ell^{(1)}(kr) + B_\\ell j_\\ell(kr)\n$$\n在实际实现中，这些投影系数将通过数值积分计算。对于本问题，由于我们生成的是合成数据，我们可以直接从真实系数 $\\{A_\\ell, B_\\ell\\}$ 计算 $\\pi_{e,\\ell}(r)$，而无需模拟整个场 $\\Pi_e(r,\\theta)$。\n\n问题的核心是从近场数据中确定 $2 L_{\\max}$ 个未知数 $\\{A_\\ell\\}$ 和 $\\{B_\\ell\\}$。仅在半径为 $r$ 的一个测量面上，每个模态 $\\ell$ 只能得到一个方程 $\\pi_{e,\\ell}(r) = A_\\ell h_\\ell^{(1)}(kr) + B_\\ell j_\\ell(kr)$。这不足以同时解出 $A_\\ell$ 和 $B_\\ell$。问题提供了第二个关键信息：在半径为 $r_1$ 的第二个同心球面上的测量值。这为每个模态 $\\ell$ 提供了第二个独立的方程。\n\n设两个测量半径为 $r_0$ 和 $r_1$。对于每个电型模态 $\\ell$，我们有以下包含两个未知数 $A_\\ell$ 和 $B_\\ell$ 的二元线性方程组：\n$$\n\\begin{cases}\n\\pi_{e,\\ell}(r_0) = A_\\ell h_\\ell^{(1)}(kr_0) + B_\\ell j_\\ell(kr_0) \\\\\n\\pi_{e,\\ell}(r_1) = A_\\ell h_\\ell^{(1)}(kr_1) + B_\\ell j_\\ell(kr_1)\n\\end{cases}\n$$\n这可以表示为矩阵形式：\n$$\n\\begin{pmatrix}\nh_\\ell^{(1)}(kr_0) & j_\\ell(kr_0) \\\\\nh_\\ell^{(1)}(kr_1) & j_\\ell(kr_1)\n\\end{pmatrix}\n\\begin{pmatrix}\nA_\\ell \\\\\nB_\\ell\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\pi_{e,\\ell}(r_0) \\\\\n\\pi_{e,\\ell}(r_1)\n\\end{pmatrix}\n$$\n这就是污染减除策略。这两个径向函数 $h_\\ell^{(1)}(kr)$ 和 $j_\\ell(kr)$ 是球贝塞尔微分方程的线性无关解。它们不同的径向依赖性确保了只要 $k \\neq 0$ 且 $r_0 \\neq r_1$，系统矩阵就是可逆的，从而可以唯一地分离出射波系数（$A_\\ell$）和入射/污染波系数（$B_\\ell$）。\n\n为了求出所需的出射系数 $A_\\ell$，我们可以求解这个方程组。系统矩阵的行列式为：\n$$\n\\det(\\mathbf{M}_\\ell) = h_\\ell^{(1)}(kr_0) j_\\ell(kr_1) - j_\\ell(kr_0) h_\\ell^{(1)}(kr_1)\n$$\n使用克莱姆法则或显式矩阵求逆，重构系数 $\\hat{A}_\\ell$ 的解为：\n$$\n\\hat{A}_\\ell = \\frac{\\det \\begin{pmatrix} \\pi_{e,\\ell}(r_0) & j_\\ell(kr_0) \\\\ \\pi_{e,\\ell}(r_1) & j_\\ell(kr_1) \\end{pmatrix}}{\\det(\\mathbf{M}_\\ell)} = \\frac{\\pi_{e,\\ell}(r_0) j_\\ell(kr_1) - \\pi_{e,\\ell}(r_1) j_\\ell(kr_0)}{h_\\ell^{(1)}(kr_0) j_\\ell(kr_1) - j_\\ell(kr_0) h_\\ell^{(1)}(kr_1)}\n$$\n对于磁型势 $\\Pi_m$，遵循完全相同的过程来求出重构系数 $\\hat{C}_\\ell$：\n$$\n\\hat{C}_\\ell = \\frac{\\pi_{m,\\ell}(r_0) j_\\ell(kr_1) - \\pi_{m,\\ell}(r_1) j_\\ell(kr_0)}{h_\\ell^{(1)}(kr_0) j_\\ell(kr_1) - j_\\ell(kr_0) h_\\ell^{(1)}(kr_1)}\n$$\n分母与球贝塞尔函数的朗斯基行列式有关，当 $k(r_1 - r_0)$ 很小时，分母会变小，这表明如果测量球面过于接近，系统会变得病态。这在案例 3 中进行了探讨。\n\n总体算法如下：\n1. 对每个测试案例，定义物理参数 $k$、$r_0$、$r_1$、$L_{\\max}$、真实出射系数 $\\{A_\\ell, C_\\ell\\}$ 以及 PML 反射参数 $R_e, \\phi_e, R_m, \\phi_m$。\n2. 对每个模态 $\\ell \\in [1, L_{\\max}]$，计算合成污染系数 $B_\\ell = R_e e^{i\\phi_e} A_\\ell$ 和 $D_\\ell = R_m e^{i\\phi_m} C_\\ell$。\n3. 对每个模态 $\\ell$，使用它们的定义生成两个半径上的“测量”投影近场系数 $\\pi_{e,\\ell}(r_0)$、$\\pi_{e,\\ell}(r_1)$、$\\pi_{m,\\ell}(r_0)$ 和 $\\pi_{m,\\ell}(r_1)$。例如，$\\pi_{e,\\ell}(r_0) = A_\\ell h_\\ell^{(1)}(kr_0) + B_\\ell j_\\ell(kr_0)$。\n4. 对每个模态 $\\ell$，使用推导出的公式求解两个 $2 \\times 2$ 线性方程组（一个用于电型，一个用于磁型），以求出重构系数 $\\hat{A}_\\ell$ 和 $\\hat{C}_\\ell$。这需要计算 $j_\\ell(z)$ 和 $h_\\ell^{(1)}(z) = j_\\ell(z) + i y_\\ell(z)$ 的值，其中 $y_\\ell(z)$ 是第二类球贝塞尔函数。\n5. 计算绝对误差 $|\\hat{A}_\\ell - A_\\ell|$ 和 $|\\hat{C}_\\ell - C_\\ell|$ 对所有 $\\ell$。\n6. 确定该测试案例的最大误差 $\\max\\{\\max_{\\ell} |\\hat{A}_\\ell - A_\\ell|, \\max_{\\ell} |\\hat{C}_\\ell - C_\\ell|\\}$。\n7. 对所有测试案例重复以上步骤并报告结果。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import spherical_jn, spherical_yn\n\ndef solve():\n    \"\"\"\n    Solves the near-to-far-field reconstruction problem for three test cases.\n    \"\"\"\n    \n    # Test suite as defined in the problem statement\n    test_cases = [\n        {\n            \"k\": 20.0, \"r0\": 0.35, \"r1\": 0.42, \"L_max\": 4,\n            \"A_coeffs\": np.array([0.9 + 0.1j, -0.4 + 0.2j, 0.1 - 0.05j, 0.02 + 0.03j], dtype=np.complex128),\n            \"C_coeffs\": np.array([0.08 - 0.10j, 0.03 + 0.02j, -0.02 + 0.01j, 0.00 + 0.005j], dtype=np.complex128),\n            \"R_e\": 0.06, \"phi_e\": 0.8, \"R_m\": 0.04, \"phi_m\": -0.5\n        },\n        {\n            \"k\": 35.0, \"r0\": 0.25, \"r1\": 0.31, \"L_max\": 3,\n            \"A_coeffs\": np.array([0.6 - 0.3j, -0.2 + 0.1j, 0.05 + 0.02j], dtype=np.complex128),\n            \"C_coeffs\": np.array([0.10 + 0.05j, 0.02 - 0.01j, -0.01 + 0.005j], dtype=np.complex128),\n            \"R_e\": 0.0, \"phi_e\": 0.0, \"R_m\": 0.0, \"phi_m\": 0.0\n        },\n        {\n            \"k\": 50.0, \"r0\": 0.40, \"r1\": 0.405, \"L_max\": 4,\n            \"A_coeffs\": np.array([0.7 + 0.2j, -0.3 + 0.15j, 0.08 - 0.04j, 0.015 + 0.02j], dtype=np.complex128),\n            \"C_coeffs\": np.array([0.06 - 0.08j, 0.025 + 0.015j, -0.015 + 0.008j, 0.0 + 0.004j], dtype=np.complex128),\n            \"R_e\": 0.12, \"phi_e\": 1.2, \"R_m\": 0.08, \"phi_m\": -1.0\n        }\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        k = case[\"k\"]\n        r0 = case[\"r0\"]\n        r1 = case[\"r1\"]\n        L_max = case[\"L_max\"]\n        \n        A_true = case[\"A_coeffs\"]\n        C_true = case[\"C_coeffs\"]\n        \n        R_e, phi_e = case[\"R_e\"], case[\"phi_e\"]\n        R_m, phi_m = case[\"R_m\"], case[\"phi_m\"]\n        \n        # Array of orders ell = 1, 2, ..., L_max\n        ells = np.arange(1, L_max + 1)\n        \n        # Wavenumber-radius products\n        kr0 = k * r0\n        kr1 = k * r1\n        \n        # Step 1: Calculate contamination coefficients B_ell and D_ell\n        B_coeffs = R_e * np.exp(1j * phi_e) * A_true\n        D_coeffs = R_m * np.exp(1j * phi_m) * C_true\n\n        # Step 2: Evaluate spherical basis functions at r0 and r1 for all ell\n        j_r0 = spherical_jn(ells, kr0)\n        y_r0 = spherical_yn(ells, kr0)\n        h1_r0 = j_r0 + 1j * y_r0\n\n        j_r1 = spherical_jn(ells, kr1)\n        y_r1 = spherical_yn(ells, kr1)\n        h1_r1 = j_r1 + 1j * y_r1\n\n        # Step 3: Generate synthetic projected near-field data\n        pi_e_r0 = A_true * h1_r0 + B_coeffs * j_r0\n        pi_e_r1 = A_true * h1_r1 + B_coeffs * j_r1\n        \n        pi_m_r0 = C_true * h1_r0 + D_coeffs * j_r0\n        pi_m_r1 = C_true * h1_r1 + D_coeffs * j_r1\n\n        # Step 4: Solve the 2x2 system for each ell to reconstruct A_hat and C_hat\n        # The denominator is the determinant of the system matrix M_ell\n        denominator = h1_r0 * j_r1 - j_r0 * h1_r1\n        \n        # Numerators from Cramer's rule\n        num_A = pi_e_r0 * j_r1 - pi_e_r1 * j_r0\n        num_C = pi_m_r0 * j_r1 - pi_m_r1 * j_r0\n        \n        A_hat = num_A / denominator\n        C_hat = num_C / denominator\n\n        # Step 5: Compute the maximum absolute reconstruction error\n        error_A = np.max(np.abs(A_hat - A_true))\n        error_C = np.max(np.abs(C_hat - C_true))\n        \n        max_error = max(error_A, error_C)\n        results.append(max_error)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3333743"}]}