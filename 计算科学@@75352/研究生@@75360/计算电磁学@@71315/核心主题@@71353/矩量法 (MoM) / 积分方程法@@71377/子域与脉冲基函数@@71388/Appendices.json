{"hands_on_practices": [{"introduction": "在将脉冲基函数应用于矩量法 (Method of Moments) 之前，我们必须首先理解其基本的数学性质。本练习将引导你推导脉冲基函数的质量矩阵，这一过程将揭示它们在不重叠网格上的对角（类正交）特性。通过计算一个具体示例的 $L^2$ 范数，你将亲身体会到非均匀网格剖分如何影响场的离散表示，这对于准确的数值建模至关重要。[@problem_id:3351541]", "problem": "考虑一个理想导电表面 $\\Gamma$，该表面被划分为一个由 $N$ 个不重叠的平面单元 $\\{T_{i}\\}_{i=1}^{N}$ 组成的相容网格，使得当 $i \\neq j$ 时，$T_{i} \\cap T_{j}$ 的面积为零，且 $\\bigcup_{i=1}^{N} T_{i} = \\Gamma$。设 $\\{\\phi_{i}\\}_{i=1}^{N}$ 表示在矩量法 (MoM) 中使用的子域（脉冲）基函数，其定义为：当 $\\mathbf{r} \\in T_{i}$ 时，$\\phi_{i}(\\mathbf{r}) = 1$；否则 $\\phi_{i}(\\mathbf{r}) = 0$。使用 $\\Gamma$ 上的 $L^{2}$ 内积定义，\n$$\\langle f, g \\rangle_{L^{2}(\\Gamma)} = \\int_{\\Gamma} f(\\mathbf{r})\\,g(\\mathbf{r})\\,dS,$$\n推导质量矩阵的元素 $M_{ij}$，\n$$M_{ij} = \\int_{\\Gamma} \\phi_{i}(\\mathbf{r})\\,\\phi_{j}(\\mathbf{r})\\,dS,$$\n并用单元面积表示 $M_{ij}$。然后，从 $L^{2}$ 范数的定义出发，解释非均匀的单元面积如何影响由脉冲函数 $u_{h}(\\mathbf{r}) = \\sum_{i=1}^{N} c_{i}\\,\\phi_{i}(\\mathbf{r})$ 近似的标量表面场 $u(\\mathbf{r})$ 的离散 $L^{2}$ 范数。\n\n最后，对一个由 $N=3$ 个单元组成的特定三角化表面计算此范数，其单元面积分别为 $A_{1} = 8.0 \\times 10^{-3}\\,\\mathrm{m}^{2}$、$A_{2} = 2.0 \\times 10^{-3}\\,\\mathrm{m}^{2}$ 和 $A_{3} = 1.8 \\times 10^{-2}\\,\\mathrm{m}^{2}$，以及一个分段常数的标量表面电流密度近似，其系数分别为 $c_{1} = 5.0\\,\\mathrm{A/m}$、$c_{2} = -3.0\\,\\mathrm{A/m}$ 和 $c_{3} = 1.0\\,\\mathrm{A/m}$。计算\n$$\\|u_{h}\\|_{L^{2}(\\Gamma)} = \\sqrt{\\int_{\\Gamma} |u_{h}(\\mathbf{r})|^{2}\\,dS}.$$\n以安培 $\\mathrm{(A)}$ 为单位表示最终值，并将答案四舍五入到四位有效数字。", "solution": "该问题被验证为自洽、科学基础扎实且定义明确。它是使用矩量法 (MoM) 进行积分方程数值分析的一个标准练习。推导和计算所需的所有定义和数据均已提供，且内部一致。\n\n该问题包括三个部分：推导脉冲基函数的质量矩阵元素，解释网格非均匀性对 $L^{2}$ 范数的影响，以及针对一个具体案例计算此范数。\n\n首先，我们推导质量矩阵的元素 $M_{ij}$。质量矩阵由基函数的 $L^{2}$ 内积定义：\n$$M_{ij} = \\langle \\phi_i, \\phi_j \\rangle_{L^{2}(\\Gamma)} = \\int_{\\Gamma} \\phi_{i}(\\mathbf{r})\\,\\phi_{j}(\\mathbf{r})\\,dS$$\n子域（脉冲）基函数定义为：\n$$\\phi_{k}(\\mathbf{r}) = \\begin{cases} 1  \\mathbf{r} \\in T_{k} \\\\ 0  \\mathbf{r} \\notin T_{k} \\end{cases}$$\n两个此类函数的乘积 $\\phi_{i}(\\mathbf{r})\\,\\phi_{j}(\\mathbf{r})$ 仅在同时属于单元 $T_{i}$ 和单元 $T_{j}$ 的点 $\\mathbf{r}$ 上非零。也就是说，被积函数的支集是交集 $T_{i} \\cap T_{j}$。在此交集上，乘积的值为 $1 \\times 1 = 1$。\n因此，积分变为：\n$$M_{ij} = \\int_{T_{i} \\cap T_{j}} 1 \\,dS = \\text{Area}(T_{i} \\cap T_{j})$$\n我们考虑索引 $i$ 和 $j$ 的两种情况：\n1.  当 $i = j$ 时：交集为 $T_{i} \\cap T_{i} = T_{i}$。该积分的值等于单元 $T_{i}$ 的面积，我们记为 $A_{i}$。\n    $$M_{ii} = \\text{Area}(T_{i}) = A_{i}$$\n2.  当 $i \\neq j$ 时：问题陈述中指出单元 $\\{T_{k}\\}$ 是不重叠的，意味着当 $i \\neq j$ 时，$T_{i} \\cap T_{j}$ 的面积为零。因此，在面积为零的区域上的积分为零。\n    $$M_{ij} = \\text{Area}(T_{i} \\cap T_{j}) = 0 \\quad \\text{for } i \\neq j$$\n使用克罗内克 delta 符号 $\\delta_{ij}$ 组合这两种情况，质量矩阵的元素由下式给出：\n$$M_{ij} = A_{i}\\,\\delta_{ij}$$\n这表明，对于不重叠网格上的脉冲基函数，质量矩阵是一个对角矩阵，其对角线元素是相应网格单元的面积。\n\n其次，我们分析非均匀的单元面积如何影响由 $u_{h}(\\mathbf{r}) = \\sum_{k=1}^{N} c_{k}\\,\\phi_{k}(\\mathbf{r})$ 近似的标量表面场 $u(\\mathbf{r})$ 的离散 $L^{2}$ 范数。$L^{2}$ 范数的平方定义为：\n$$\\|u_{h}\\|_{L^{2}(\\Gamma)}^{2} = \\int_{\\Gamma} |u_{h}(\\mathbf{r})|^{2}\\,dS$$\n代入 $u_h(\\mathbf{r})$ 的展开式：\n$$\\|u_{h}\\|_{L^{2}(\\Gamma)}^{2} = \\int_{\\Gamma} \\left| \\sum_{k=1}^{N} c_{k}\\,\\phi_{k}(\\mathbf{r}) \\right|^{2}\\,dS$$\n由于基函数 $\\phi_{k}$ 的支集是不相交的（单元 $T_k$ 不重叠），在单元 $T_j$ 内的任何点 $\\mathbf{r}$，只有基函数 $\\phi_j(\\mathbf{r})$ 是非零的（等于 $1$）。因此，当 $\\mathbf{r} \\in T_j$ 时，求和简化为 $c_j$。函数 $u_h(\\mathbf{r})$ 是分段常数，其中当 $\\mathbf{r} \\in T_{j}$ 时，$u_{h}(\\mathbf{r}) = c_{j}$。在整个表面 $\\Gamma = \\bigcup_{j=1}^{N} T_{j}$ 上的积分可以写成在每个单元上积分的总和：\n$$\\|u_{h}\\|_{L^{2}(\\Gamma)}^{2} = \\sum_{j=1}^{N} \\int_{T_{j}} |u_{h}(\\mathbf{r})|^{2}\\,dS = \\sum_{j=1}^{N} \\int_{T_{j}} |c_{j}|^{2}\\,dS$$\n由于 $|c_j|^2$ 在单元 $T_j$ 上是常数，我们可以将其从积分中提出：\n$$\\|u_{h}\\|_{L^{2}(\\Gamma)}^{2} = \\sum_{j=1}^{N} |c_{j}|^{2} \\int_{T_{j}} dS = \\sum_{j=1}^{N} |c_{j}|^{2} A_{j}$$\n此表达式表明，近似场的 $L^{2}$ 范数的平方是系数平方 $|c_{j}|^{2}$ 的加权和。每个系数的权重是相应单元的面积 $A_{j}$。因此，如果单元面积 $A_j$ 是非均匀的，与较大单元关联的系数对总范数的贡献要大于与较小单元关联的相同大小的系数。因此，$L^{2}$ 范数直接反映了函数具有特定值的空间范围，通过函数作用的面积对其局部大小进行加权。\n\n最后，我们为给定的具体案例计算此范数。给定 $N=3$ 个单元，其面积分别为 $A_{1} = 8.0 \\times 10^{-3}\\,\\mathrm{m}^{2}$、$A_{2} = 2.0 \\times 10^{-3}\\,\\mathrm{m}^{2}$ 和 $A_{3} = 1.8 \\times 10^{-2}\\,\\mathrm{m}^{2}$。标量表面电流密度近似的系数为 $c_{1} = 5.0\\,\\mathrm{A/m}$、$c_{2} = -3.0\\,\\mathrm{A/m}$ 和 $c_{3} = 1.0\\,\\mathrm{A/m}$。\n范数的平方为：\n$$\\|u_{h}\\|_{L^{2}(\\Gamma)}^{2} = |c_{1}|^{2}A_{1} + |c_{2}|^{2}A_{2} + |c_{3}|^{2}A_{3}$$\n代入给定值：\n$$\\|u_{h}\\|_{L^{2}(\\Gamma)}^{2} = |5.0|^{2}\\,(8.0 \\times 10^{-3}) + |-3.0|^{2}\\,(2.0 \\times 10^{-3}) + |1.0|^{2}\\,(1.8 \\times 10^{-2})$$\n$$\\|u_{h}\\|_{L^{2}(\\Gamma)}^{2} = (25.0)\\,(8.0 \\times 10^{-3}) + (9.0)\\,(2.0 \\times 10^{-3}) + (1.0)\\,(18.0 \\times 10^{-3})$$\n每一项的单位是 $(\\mathrm{A/m})^{2} \\cdot \\mathrm{m}^{2} = \\mathrm{A}^{2}$。\n$$\\|u_{h}\\|_{L^{2}(\\Gamma)}^{2} = (200.0 \\times 10^{-3}) + (18.0 \\times 10^{-3}) + (18.0 \\times 10^{-3})\\,\\mathrm{A}^{2}$$\n$$\\|u_{h}\\|_{L^{2}(\\Gamma)}^{2} = (0.200 + 0.018 + 0.018)\\,\\mathrm{A}^{2}$$\n$$\\|u_{h}\\|_{L^{2}(\\Gamma)}^{2} = 0.236\\,\\mathrm{A}^{2}$$\n$L^{2}$ 范数是该值的平方根：\n$$\\|u_{h}\\|_{L^{2}(\\Gamma)} = \\sqrt{0.236}\\,\\mathrm{A} \\approx 0.48579831\\,\\mathrm{A}$$\n按要求将结果四舍五入到四位有效数字，我们得到 $0.4858\\,\\mathrm{A}$。", "answer": "$$\\boxed{0.4858}$$", "id": "3351541"}, {"introduction": "基函数的核心作用是将连续的物理定律转化为计算机可以求解的离散方程组。本练习将演示如何在一个有限体积框架内，利用脉冲基函数来离散化电磁学中最基本的定律之一——电荷守恒定律。通过推导离散散度并更新电荷，你将掌握处理单元间通量的关键技术，确保数值方案在物理上是保守的。[@problem_id:3351563]", "problem": "考虑麦克斯韦方程组中的电荷连续性方程 $\\frac{\\partial \\rho}{\\partial t} + \\nabla \\cdot \\mathbf{J} = 0$，其中 $\\rho$ 是电荷密度，$\\mathbf{J}$ 是电流密度。在与子域（单元级）脉冲基函数对齐的有限体积离散化中，在一个时间步长内将 $\\mathbf{J}$ 近似为每个单元内的分段常数，并通过面法向通量定义离散散度。\n\n从连续性方程的积分形式出发，并利用散度定理，推导出一个将面法向电流通量密度映射到单元散度的离散散度算子表达式。说明如何处理相邻单元之间的界面通量以保持守恒性，并得出一个时间步长内与连续性方程一致的全离散电荷更新方案。\n\n然后，将您的推导应用于以下三维配置。两个六面体单元沿 $x$ 轴相邻排列。每个单元的尺寸为 $\\Delta x = 0.2$ 米，$\\Delta y = 0.1$ 米，$\\Delta z = 0.05$ 米。因此，每个单元的体积为 $V_c = 0.2 \\times 0.1 \\times 0.05$ 立方米，面面积为 $A_x = 0.1 \\times 0.05$ 平方米，$A_y = 0.2 \\times 0.05$ 平方米，$A_z = 0.2 \\times 0.1$ 平方米。使用的时间步长为 $\\Delta t = 2.5 \\times 10^{-9}$ 秒。所有面法向电流通量密度均在时间中点 $t^{n+\\frac{1}{2}}$ 给出，并定义为 $J_n = \\mathbf{J} \\cdot \\mathbf{n}$，其中 $\\mathbf{n}$ 是所考虑单元的外向单位法向量。\n\n对于单元 1（左侧单元），其外向面法向电流通量密度为：\n- 左侧 $x-$ 面：$J_n = -12$ A m$^{-2}$，\n- 右侧 $x+$ 面（与单元 2 的交界面）：使用相对于单元 1 外法线的单一共享界面通量密度 $J_{n,\\Gamma} = +20$ A m$^{-2}$，\n- 底部 $y-$ 面：$J_n = +5$ A m$^{-2}$，\n- 顶部 $y+$ 面：$J_n = -7$ A m$^{-2}$，\n- 后侧 $z-$ 面：$J_n = +2$ A m$^{-2}$，\n- 前侧 $z+$ 面：$J_n = -2.5$ A m$^{-2}$。\n\n对于单元 2（右侧单元），其左侧 $x-$ 面上的界面通量采用相同的单一共享界面通量大小，但相对于其自身外法线的符号相反（即，其左侧面上的 $J_n = -20$ A m$^{-2}$）。其余外向面法向电流通量密度为：\n- 右侧 $x+$ 面：$J_n = -8$ A m$^{-2}$，\n- 底部 $y-$ 面：$J_n = -4$ A m$^{-2}$，\n- 顶部 $y+$ 面：$J_n = +6$ A m$^{-2}$，\n- 后侧 $z-$ 面：$J_n = -1$ A m$^{-2}$，\n- 前侧 $z+$ 面：$J_n = +2$ A m$^{-2}$。\n\n在时间 $t^n$ 时，两个单元的初始总电荷分别为 $Q_1^n = 3.0 \\times 10^{-9}$ C 和 $Q_2^n = -1.5 \\times 10^{-9}$ C。使用您推导出的离散散度和电荷更新公式，计算在时间 $t^{n+1}$ 时更新后的单元总电荷 $Q_1^{n+1}$ 和 $Q_2^{n+1}$。\n\n将您的最终答案表示为行向量 $\\big[ Q_1^{n+1},\\; Q_2^{n+1} \\big]$，单位为纳库仑，并将每个条目四舍五入至四位有效数字。", "solution": "该问题要求从电荷连续性方程推导出一个离散电荷更新方案，并将其应用于一个特定的双单元配置。对问题陈述的验证确认了其科学上是合理的、适定的，并包含了所有必要的信息。\n\n推导从控制体积 $V$ 上的电荷连续性方程的积分形式开始，\n$$\n\\int_V \\frac{\\partial \\rho}{\\partial t} dV + \\int_V \\nabla \\cdot \\mathbf{J} dV = 0\n$$\n其中 $\\rho$ 是电荷密度，$\\mathbf{J}$ 是电流密度。\n\n应用散度定理 $\\int_V \\nabla \\cdot \\mathbf{J} dV = \\oint_S \\mathbf{J} \\cdot d\\mathbf{S}$，将散度的体积分转换为通量在体积 $V$ 边界表面 $S$ 上的面积分。此处，$d\\mathbf{S} = \\mathbf{n} dS$，其中 $\\mathbf{n}$ 是向外的单位法向量。连续性方程变为：\n$$\n\\int_V \\frac{\\partial \\rho}{\\partial t} dV + \\oint_S \\mathbf{J} \\cdot \\mathbf{n} dS = 0\n$$\n\n我们现在对单个计算单元（即我们的控制体积，记为 $V_c$）离散化此方程。单元内的总电荷为 $Q_c = \\int_{V_c} \\rho dV$。假设体积 $V_c$ 不随时间变化，则第一项变为 $\\frac{d}{dt} \\int_{V_c} \\rho dV = \\frac{dQ_c}{dt}$。因此，单个单元的方程为：\n$$\n\\frac{dQ_c}{dt} + \\oint_{S_c} \\mathbf{J} \\cdot \\mathbf{n} dS = 0\n$$\n其中 $S_c$ 是单元的表面。该方程表明，一个单元内电荷的变化率等于流出其表面的总电流的负值。\n\n问题指定了子域（单元级）脉冲基函数。这意味着在每个单元内，物理量被近似为分段常数。具体来说，电荷密度 $\\rho$ 在 $V_c$ 内是恒定的，因此 $Q_c = \\rho V_c$。电流通量密度 $\\mathbf{J} \\cdot \\mathbf{n}$ 在单元的每个面上被假设为常数。一个六面体单元有 $N_f=6$ 个面。设面 $k$ 的面积为 $A_k$，该面上的恒定外法向电流密度为 $J_{n,k}$。面积分变为对面上的求和：\n$$\n\\oint_{S_c} \\mathbf{J} \\cdot \\mathbf{n} dS = \\sum_{k=1}^{N_f} \\int_{A_k} \\mathbf{J} \\cdot \\mathbf{n} dS = \\sum_{k=1}^{N_f} J_{n,k} A_k\n$$\n将此代入单元方程，得到半离散形式：\n$$\n\\frac{dQ_c}{dt} = - \\sum_{k=1}^{N_f} J_{n,k} A_k\n$$\n\n由此，我们可以确定离散散度的表达式。单元中的平均散度 $(\\nabla \\cdot \\mathbf{J})_c$ 定义为 $(\\nabla \\cdot \\mathbf{J})_c V_c = \\int_{V_c} \\nabla \\cdot \\mathbf{J} dV$。利用散度定理，我们有：\n$$\n(\\nabla \\cdot \\mathbf{J})_c = \\frac{1}{V_c} \\oint_{S_c} \\mathbf{J} \\cdot \\mathbf{n} dS = \\frac{1}{V_c} \\sum_{k=1}^{N_f} J_{n,k} A_k\n$$\n这就是离散散度算子，它将面法向通量密度 $\\{J_{n,k}\\}$ 映射到单元平均散度。\n\n对于共享一个交界面 $\\Gamma$ 的相邻单元（例如，单元 $i$ 和单元 $j$），为保证电荷守恒，通过 $\\Gamma$ 离开单元 $i$ 的通量必须等于通过 $\\Gamma$ 进入单元 $j$ 的通量。设 $\\mathbf{n}_i$ 是单元 $i$ 在 $\\Gamma$ 处的向外法线。单元 $j$ 的向外法线是 $\\mathbf{n}_j = -\\mathbf{n}_i$。流出单元 $i$ 的通量为 $I_i = \\int_\\Gamma (\\mathbf{J} \\cdot \\mathbf{n}_i) dS$。流出单元 $j$ 的通量为 $I_j = \\int_\\Gamma (\\mathbf{J} \\cdot \\mathbf{n}_j) dS = -\\int_\\Gamma (\\mathbf{J} \\cdot \\mathbf{n}_i) dS = -I_i$。对于脉冲基函数，这要求单元 $i$ 和 $j$ 的共享界面通量密度 $J_{n,\\Gamma}$ 必须满足 $J_{n,j} = -J_{n,i}$。问题陈述强制执行此条件，确保了局部和全局的电荷守恒。\n\n为了获得全离散的电荷更新公式，我们将半离散方程在一个时间步长 $\\Delta t = t^{n+1} - t^n$ 上积分：\n$$\n\\int_{t^n}^{t^{n+1}} \\frac{dQ_c}{dt} dt = Q_c(t^{n+1}) - Q_c(t^n) = Q_c^{n+1} - Q_c^n\n$$\n$$\nQ_c^{n+1} - Q_c^n = - \\int_{t^n}^{t^{n+1}} \\left( \\sum_{k=1}^{N_f} J_{n,k}(t) A_k \\right) dt\n$$\n问题在时间中点 $t^{n+\\frac{1}{2}}$ 提供了电流通量密度。我们使用二阶精度的中点法则来近似时间积分：\n$$\n\\int_{t^n}^{t^{n+1}} J_{n,k}(t) dt \\approx J_{n,k}(t^{n+\\frac{1}{2}}) \\Delta t\n$$\n使用符号 $J_{n,k}^{n+\\frac{1}{2}}$ 表示中点通量密度，最终的电荷更新方程为：\n$$\nQ_c^{n+1} = Q_c^n - \\Delta t \\sum_{k=1}^{N_f} J_{n,k}^{n+\\frac{1}{2}} A_k\n$$\n此方程将应用于这两个单元。\n\n给定的参数是：\n-   时间步长：$\\Delta t = 2.5 \\times 10^{-9}$ s。\n-   面面积：$A_x = 0.005$ m$^2$，$A_y = 0.01$ m$^2$，$A_z = 0.02$ m$^2$。\n-   初始电荷：$Q_1^n = 3.0 \\times 10^{-9}$ C，$Q_2^n = -1.5 \\times 10^{-9}$ C。\n\n从一个单元流出的总电流是 $I_{out} = \\sum_{k=1}^{6} J_{n,k} A_k$。\n\n对于单元 1：\n给出了左侧 ($x-$)、右侧 ($x+$)、底部 ($y-$)、顶部 ($y+$)、后侧 ($z-$) 和前侧 ($z+$) 面的外向面法向通量密度 ($J_n$)。\n$I_{out,1} = (J_{n,x-})A_x + (J_{n,x+})A_x + (J_{n,y-})A_y + (J_{n,y+})A_y + (J_{n,z-})A_z + (J_{n,z+})A_z$\n使用为单元 1 提供的值：\n$I_{out,1} = (-12)A_x + (20)A_x + (5)A_y + (-7)A_y + (2)A_z + (-2.5)A_z$\n$I_{out,1} = (20 - 12)A_x + (5 - 7)A_y + (2 - 2.5)A_z$\n$I_{out,1} = (8)A_x - (2)A_y - (0.5)A_z$\n$I_{out,1} = (8)(0.005) - (2)(0.01) - (0.5)(0.02) = 0.04 - 0.02 - 0.01 = 0.01$ A。\n\n单元 1 的电荷变化量是 $\\Delta Q_1 = -I_{out,1} \\Delta t$：\n$\\Delta Q_1 = -(0.01 \\text{ A}) \\times (2.5 \\times 10^{-9} \\text{ s}) = -0.025 \\times 10^{-9}$ C。\n更新后的电荷是 $Q_1^{n+1} = Q_1^n + \\Delta Q_1$：\n$Q_1^{n+1} = 3.0 \\times 10^{-9} \\text{ C} - 0.025 \\times 10^{-9} \\text{ C} = 2.975 \\times 10^{-9}$ C。\n\n对于单元 2：\n使用为单元 2 提供的值：\n$I_{out,2} = (-20)A_x + (-8)A_x + (-4)A_y + (6)A_y + (-1)A_z + (2)A_z$\n$I_{out,2} = (-20 - 8)A_x + (6 - 4)A_y + (2 - 1)A_z$\n$I_{out,2} = (-28)A_x + (2)A_y + (1)A_z$\n$I_{out,2} = (-28)(0.005) + (2)(0.01) + (1)(0.02) = -0.14 + 0.02 + 0.02 = -0.10$ A。\n\n单元 2 的电荷变化量是 $\\Delta Q_2 = -I_{out,2} \\Delta t$：\n$\\Delta Q_2 = -(-0.10 \\text{ A}) \\times (2.5 \\times 10^{-9} \\text{ s}) = 0.25 \\times 10^{-9}$ C。\n更新后的电荷是 $Q_2^{n+1} = Q_2^n + \\Delta Q_2$：\n$Q_2^{n+1} = -1.5 \\times 10^{-9} \\text{ C} + 0.25 \\times 10^{-9} \\text{ C} = -1.25 \\times 10^{-9}$ C。\n\n最终电荷为 $Q_1^{n+1} = 2.975 \\times 10^{-9}$ C 和 $Q_2^{n+1} = -1.25 \\times 10^{-9}$ C。\n以纳库仑 (nC) 为单位，这些值是 $Q_1^{n+1} = 2.975$ nC 和 $Q_2^{n+1} = -1.25$ nC。\n四舍五入到四位有效数字，我们得到 $2.975$ 和 $-1.250$。\n最终答案以纳库仑为单位，表示为行向量 $[Q_1^{n+1}, Q_2^{n+1}]$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2.975  -1.250\n\\end{pmatrix}\n}\n$$", "id": "3351563"}, {"introduction": "一个优秀的数值工程师不仅要会使用工具，更要深刻理解其局限性。脉冲基函数的分段常数特性在单元边界处引入了非物理的跳变，从而可能产生数值伪影。本练习将深入探讨这种不连续性的后果，通过编程实践，你将学会如何量化由电流跳变产生的伪电荷，并理解这种误差对于计算结果可靠性的影响。[@problem_id:3351553]", "problem": "考虑承载时谐电流的细长理想导线的一维子域离散化。在具有复相量和角频率 $\\,\\omega\\,$ 的时谐情况下，电荷守恒得出连续性方程 $\\,\\nabla \\cdot \\mathbf{J} = -j \\omega \\rho\\,$，其中 $\\,\\mathbf{J}\\,$ 是电流密度，$\\,\\rho\\,$ 是电荷密度。在一维线模型中，这简化为 $\\,\\frac{d J(x)}{dx} = -j \\omega \\rho_\\ell(x)\\,$，其中 $\\,J(x)\\,$ 是线电流（单位：安培），$\\,\\rho_\\ell(x)\\,$ 是单位长度的线电荷（单位：库仑/米）。在使用脉冲（分段常数）基函数的子域方法中，离散未知数是定义在长度为 $\\,h_i = x_i - x_{i-1}\\,$ 的区间 $\\,I_i = [x_{i-1}, x_i]\\,$ 上的单元常数 $\\,J_i\\,$（对于 $\\,i=1,\\dots,N\\,$），使得当 $\\,x \\in I_i\\,$ 时，$\\,J(x) = J_i\\,$。在内部界面 $\\,x_k\\,$（$\\,k=1,\\dots,N-1\\,$）处，分段常数近似允许跳变 $\\,\\Delta J_k = J_{k+1} - J_k\\,$。在分布的意义上解释，$\\,\\frac{dJ}{dx} = \\sum_{k=1}^{N-1} \\Delta J_k \\,\\delta(x - x_k)\\,$，通过连续性方程，这意味着在界面处存在集中（点）电荷，其强度为 $\\,Q_k = \\int_{x_k-\\varepsilon}^{x_k+\\varepsilon} \\rho_\\ell(x)\\,dx = -\\frac{\\Delta J_k}{j\\omega}\\,$。这些电荷的量值为 $\\,|Q_k| = \\frac{|\\Delta J_k|}{\\omega}\\,$。除非物理馈源或终端强制产生真实的电荷积累，否则这些都是脉冲离散化产生的数值伪影。\n\n定义两个基于跳变的半范数，用以量化单元间的不连续性：\n- 纯跳变半范数 $\\,S_2 = \\sum_{k=1}^{N-1} |\\Delta J_k|^2\\,$，单位为 $\\,\\mathrm{A}^2\\,$。\n- 网格加权跳变半范数 $\\,S_{2,h} = \\sum_{k=1}^{N-1} \\frac{|\\Delta J_k|^2}{h_k^{\\mathrm{avg}}}\\,$，其中 $\\,h_k^{\\mathrm{avg}} = \\frac{h_k + h_{k+1}}{2}\\,$，单位为 $\\,\\mathrm{A}^2/\\mathrm{m}\\,$。\n\n从守恒定律 $\\,\\frac{d J(x)}{dx} = -j \\omega \\rho_\\ell(x)\\,$ 和脉冲表示 $\\,J(x) = \\sum_{i=1}^N J_i \\chi_{I_i}(x)\\,$ 出发，推导界面跳变 $\\,\\Delta J_k\\,$ 如何产生伪点电荷 $\\,Q_k\\,$，以及半范数 $\\,S_2\\,$ 和 $\\,S_{2,h}\\,$ 如何量化由不连续性引起的误差。然后，实现一个算法，为下面描述的每个测试用例计算：\n- $\\,S_2\\,$，单位为 $\\,\\mathrm{A}^2\\,$。\n- $\\,S_{2,h}\\,$，单位为 $\\,\\mathrm{A}^2/\\mathrm{m}\\,$。\n- $\\,Q_{\\max} = \\max_k |Q_k|\\,$，单位为 $\\,\\mathrm{C}\\,$。\n- $\\,Q_{\\mathrm{sum}} = \\sum_k |Q_k|\\,$，单位为 $\\,\\mathrm{C}\\,$。\n\n给定以下测试套件。每个测试用例提供单元长度 $\\,h_i\\,$（单位：米）、脉冲值 $\\,J_i\\,$（单位：安培）和频率 $\\,f\\,$（单位：赫兹）。使用 $\\,\\omega = 2\\pi f\\,$。在计算跳变和电荷时，仅考虑内部界面 $\\,k=1,\\dots,N-1\\,$。报告电荷（单位：库仑）、$\\,S_2\\,$（单位：$\\,\\mathrm{A}^2\\,$）和 $\\,S_{2,h}\\,$（单位：$\\,\\mathrm{A}^2/\\mathrm{m}\\,$）。\n\n- 测试用例 A (正常路径)：$\\,h = [0.25, 0.25, 0.25, 0.25]\\,$, $\\,J = [1.0, 0.5, 0.5, -0.5]\\,$, $\\,f = 1.0 \\times 10^8\\,$。\n- 测试用例 B (满足连续性)：$\\,h = [0.2, 0.3, 0.1, 0.4]\\,$, $\\,J = [2.0, 2.0, 2.0, 2.0]\\,$, $\\,f = 1.0 \\times 10^9\\,$。\n- 测试用例 C (低频下的单个内部跳变)：$\\,h = [0.1, 0.2, 0.4, 0.3]\\,$, $\\,J = [0.0, 5.0, 5.0, 5.0]\\,$, $\\,f = 1.0 \\times 10^4\\,$。\n- 测试用例 D (非均匀网格上的交替符号)：$\\,h = [0.05, 0.15, 0.10, 0.20, 0.50]\\,$, $\\,J = [1.0, -1.0, 1.0, -1.0, 1.0]\\,$, $\\,f = 2.0 \\times 10^9\\,$。\n\n您的程序应生成单行输出，其中包含结果，格式为以逗号分隔的各用例结果列表，每个用例的结果是方括号括起来的逗号分隔列表 $[S_2, S_{2,h}, Q_{\\max}, Q_{\\mathrm{sum}}]$，整个列表也用方括号括起来。例如：$[[r_{A1}, r_{A2}, r_{A3}, r_{A4}], [r_{B1}, r_{B2}, r_{B3}, r_{B4}], [r_{C1}, r_{C2}, r_{C3}, r_{C4}], [r_{D1}, r_{D2}, r_{D3}, r_{D4}]]$。不应打印其他任何文本。", "solution": "该问题是有效的。它在科学上基于电磁学和数值分析的原理，问题提出得很好，提供了所有必要信息，并且其表述是客观的。\n\n这个问题的核心在于理解在数值方法中（特别是使用脉冲基函数的矩量法）用不连续的分段常数函数来近似一个连续的物理量——电流 $J(x)$ ——所带来的后果。推导始于一维时谐连续性方程，该方程表示电荷守恒：\n$$\n\\frac{d J(x)}{dx} = -j \\omega \\rho_\\ell(x)\n$$\n这里，$J(x)$ 是线电流，$\\rho_\\ell(x)$ 是线电荷密度，$\\omega$ 是角频率，$j$ 是虚数单位。该方程表明，电流的任何空间变化都必须伴随着电荷密度的动态变化。\n\n在子域离散化中，域（一根细导线）被划分为 $N$ 个段或单元，$I_i = [x_{i-1}, x_i]$（对于 $i=1, \\dots, N$）。电流 $J(x)$ 被近似为脉冲基函数 $\\chi_{I_i}(x)$ 的和，这些函数在区间 $I_i$ 上等于 $1$，在其他地方等于 $0$。该近似的形式为：\n$$\nJ(x) \\approx \\sum_{i=1}^N J_i \\chi_{I_i}(x)\n$$\n其中 $J_i$ 是第 $i$ 个单元上电流的恒定值。这种表示在内部界面 $x_k$（对于 $k=1, \\dots, N-1$）处是内在地不连续的。在每个这样的界面处，电流值从 $J_k$ 突变为 $J_{k+1}$。这个跳变的大小定义为 $\\Delta J_k = J_{k+1} - J_k$。\n\n在经典微积分中，这种分段常数函数在不连续点的导数是未定义的。然而，在分布理论（或广义函数理论）中，导数可以被定义。阶跃状不连续点的导数是狄拉克 $\\delta$ 函数 $\\delta(x)$。对于近似电流 $J(x)$，其分布导数由位于每个发生跳变的界面处的狄拉克 $\\delta$ 函数的加权和组成：\n$$\n\\frac{d J(x)}{dx} = \\sum_{k=1}^{N-1} (J_{k+1} - J_k) \\delta(x - x_k) = \\sum_{k=1}^{N-1} \\Delta J_k \\delta(x - x_k)\n$$\n将此表达式代回连续性方程，我们令两种形式的导数相等：\n$$\n\\sum_{k=1}^{N-1} \\Delta J_k \\delta(x - x_k) = -j \\omega \\rho_\\ell(x)\n$$\n求解线电荷密度 $\\rho_\\ell(x)$ 可得：\n$$\n\\rho_\\ell(x) = \\frac{1}{-j\\omega} \\sum_{k=1}^{N-1} \\Delta J_k \\delta(x - x_k) = \\sum_{k=1}^{N-1} \\left( \\frac{j \\Delta J_k}{\\omega} \\right) \\delta(x - x_k)\n$$\n这个表达式表明，电荷密度不是平滑分布的。相反，它是一系列集中在单元界面处的点电荷。界面 $x_k$ 处的点电荷 $Q_k$ 的强度是相应 $\\delta$ 函数的系数：\n$$\nQ_k = \\frac{j \\Delta J_k}{\\omega}\n$$\n这些是使用不连续基函数表示电流所产生的直接数学伪影，它们是非物理的伪电荷。除非在该点明确地模拟了物理机制（如源或间隙），否则它们违反了连续导体的物理原理。每个伪电荷的量值为：\n$$\n|Q_k| = \\left| \\frac{j \\Delta J_k}{\\omega} \\right| = \\frac{|j| |\\Delta J_k|}{|\\omega|} = \\frac{|\\Delta J_k|}{\\omega}\n$$\n该问题要求计算两个半范数，以量化这些不连续性的严重程度。\n纯跳变半范数 $S_2 = \\sum_{k=1}^{N-1} |\\Delta J_k|^2$ 衡量所有电流跳变的平方幅值的总和。它是解中整体“不连续能量”的直接指标。\n网格加权跳变半范数 $S_{2,h} = \\sum_{k=1}^{N-1} \\frac{|\\Delta J_k|^2}{h_k^{\\mathrm{avg}}}$，其中 $h_k^{\\mathrm{avg}} = \\frac{h_k + h_{k+1}}{2}$，当跳变发生在较小单元之间时，它会更严厉地惩罚跳变。这是有限元方法中后验误差估计器的一个共同特征，因为小区域上的大梯度表明该特征未被网格很好地解析。\n\n为每个测试用例计算所需量的算法如下：\n1.  接收单元长度数组 $h = [h_1, \\dots, h_N]$、电流值数组 $J = [J_1, \\dots, J_N]$ 和频率 $f$。\n2.  计算角频率 $\\omega = 2\\pi f$。\n3.  从输入数组的长度确定单元数 $N$。\n4.  遍历内部界面，索引从 $k=1$ 到 $N-1$。在从零开始索引的编程环境中，这对应于索引 $i$ 从 $0$ 到 $N-2$。\n5.  在每个界面 $i$（单元 $i$ 和 $i+1$ 之间）：\n    a. 计算电流跳变：$\\Delta J_i = J_{i+1} - J_i$。\n    b. 计算平均单元长度：$h_i^{\\mathrm{avg}} = (h_i + h_{i+1})/2$。\n    c. 计算伪电荷的量值：$|Q_i| = |\\Delta J_i| / \\omega$。\n    d. 存储跳变平方 $|\\Delta J_i|^2$、加权跳变平方 $|\\Delta J_i|^2 / h_i^{\\mathrm{avg}}$ 和电荷量值 $|Q_i|$。\n6.  将存储的值求和以获得 $S_2 = \\sum_i |\\Delta J_i|^2$ 和 $S_{2,h} = \\sum_i \\frac{|\\Delta J_i|^2}{h_i^{\\mathrm{avg}}}$。\n7.  从存储的电荷量值中，找到最大值 $Q_{\\max} = \\max_i |Q_i|$ 和总和 $Q_{\\mathrm{sum}} = \\sum_i |Q_i|$。\n8.  返回四个计算值：$S_2$、$S_{2,h}$、$Q_{\\max}$ 和 $Q_{\\mathrm{sum}}$。如果没有内部界面（$N \\le 1$）或没有跳变，这些量都为零。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes jump-based seminorms and spurious charge metrics for\n    pulse basis functions in a 1D Method of Moments context.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Test case A (happy path)\n        {'h': np.array([0.25, 0.25, 0.25, 0.25]), 'J': np.array([1.0, 0.5, 0.5, -0.5]), 'f': 1.0e8},\n        # Test case B (continuity satisfied)\n        {'h': np.array([0.2, 0.3, 0.1, 0.4]), 'J': np.array([2.0, 2.0, 2.0, 2.0]), 'f': 1.0e9},\n        # Test case C (single interior jump at low frequency)\n        {'h': np.array([0.1, 0.2, 0.4, 0.3]), 'J': np.array([0.0, 5.0, 5.0, 5.0]), 'f': 1.0e4},\n        # Test case D (alternating signs on a nonuniform mesh)\n        {'h': np.array([0.05, 0.15, 0.10, 0.20, 0.50]), 'J': np.array([1.0, -1.0, 1.0, -1.0, 1.0]), 'f': 2.0e9},\n    ]\n\n    results = []\n    for case in test_cases:\n        h = case['h']\n        J = case['J']\n        f = case['f']\n        \n        N = len(h)\n        if N == 1:\n            # No interior interfaces, so all quantities are zero.\n            results.append([0.0, 0.0, 0.0, 0.0])\n            continue\n\n        # Calculate angular frequency\n        omega = 2.0 * np.pi * f\n\n        # Calculate jumps at interior interfaces k=1,...,N-1\n        # In 0-based indexing, this corresponds to J[i+1] - J[i] for i=0,...,N-2\n        delta_J = J[1:] - J[:-1]\n        \n        # Calculate average mesh sizes at interfaces\n        # h_k_avg = (h_k + h_{k+1}) / 2\n        # In 0-based indexing, h_avg for interface i is (h[i] + h[i+1])/2\n        h_avg = (h[:-1] + h[1:]) / 2.0\n        \n        # Calculate pure jump seminorm S_2\n        # S_2 = sum(|delta_J_k|^2)\n        # abs() is used for generality, though J is real in these cases.\n        S_2 = np.sum(np.abs(delta_J)**2)\n        \n        # Calculate mesh-weighted jump seminorm S_{2,h}\n        # S_{2,h} = sum(|delta_J_k|^2 / h_k_avg)\n        S_2_h = np.sum(np.abs(delta_J)**2 / h_avg)\n        \n        # Calculate magnitudes of spurious point charges\n        # |Q_k| = |delta_J_k| / omega\n        if omega > 0:\n            mag_Q = np.abs(delta_J) / omega\n        else: # Avoid division by zero if frequency is 0\n            mag_Q = np.inf * np.abs(delta_J) if np.any(delta_J != 0) else np.zeros_like(delta_J)\n\n        \n        # Calculate max and sum of charge magnitudes\n        if mag_Q.size > 0:\n            Q_max = np.max(mag_Q)\n            Q_sum = np.sum(mag_Q)\n        else: # Handle cases with N=1 which results in empty mag_Q\n            Q_max = 0.0\n            Q_sum = 0.0\n        \n        # Append this case's results\n        results.append([S_2, S_2_h, Q_max, Q_sum])\n\n    # Format the final output string as specified.\n    # e.g., [[rA1,rA2,rA3,rA4],[rB1,rB2,rB3,rB4],...]\n    case_results_str = [f\"[{r[0]},{r[1]},{r[2]},{r[3]}]\" for r in results]\n    final_output = f\"[{','.join(case_results_str)}]\"\n    \n    print(final_output)\n\nsolve()\n```", "id": "3351553"}]}