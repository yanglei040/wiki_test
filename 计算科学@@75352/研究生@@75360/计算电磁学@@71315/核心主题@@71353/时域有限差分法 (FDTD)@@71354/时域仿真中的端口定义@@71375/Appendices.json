{"hands_on_practices": [{"introduction": "在进行任何复杂的电磁仿真之前，验证其基本构建模块的准确性至关重要。本练习旨在通过一个“零测试”来巩固您对时域端口基本定义的理解：即验证一个经过功率归一化的端口，在激励一个匹配负载时，所传递的总能量是否精确符合理论预期。这个基础实践确保了我们对端口功率和能量关系的计算有充分的信心。", "problem": "请为计算电磁学中的时域端口设计一个验证实验，该实验通过发射具有指定入射功率的脉冲并测量传递到匹配负载的总能量，来确认功率归一化。请完全在一维横电磁（TEM）传输线抽象模型下进行，并使用以下基本原理：麦克斯韦方程组、坡印亭定理以及传输线分解为前向（入射）和后向（反射）行波。\n\n您必须从第一性原理出发。考虑一个无损、无色散、均匀的TEM传输线，其特征为实数特征阻抗 $Z_0$ 和波速 $c$。在时域端口模型中，端口处的总电压 $v(t)$ 和总电流 $i(t)$ 可以通过以下关系分解为入射行波分量 $v^{+}(t)$ 和反射行波分量 $v^{-}(t)$：\n$$\nv(t) = v^{+}(t) + v^{-}(t), \\quad i(t) = \\frac{1}{Z_0}\\left(v^{+}(t) - v^{-}(t)\\right).\n$$\n端口处的匹配负载是指其阻抗等于特征阻抗 $Z_0$ 的负载，这意味着对于任何入射波形，反射 $v^{-}(t) = 0$。\n\n根据坡印亭定理以及传输线中横截面坡印亭通量与乘积 $v(t)i(t)$ 的对应关系，传递到负载的瞬时功率为\n$$\np(t) = v(t)i(t).\n$$\n在匹配终端条件下，$v(t) = v^{+}(t)$ 且 $i(t) = \\frac{v^{+}(t)}{Z_0}$，因此\n$$\np(t) = \\frac{\\left(v^{+}(t)\\right)^2}{Z_0}.\n$$\n\n您的任务是在离散时间内验证，一个经过归一化以发射具有规定瞬时功率的入射脉冲的端口，确实能将相应的能量传递到匹配负载。具体来说，发射一个在时长 $T$ 内具有恒定入射功率 $P_0 = 1$ W 且在其他时间为零的矩形顶脉冲。设离散时间步长为 $\\Delta t$，脉冲采样点数为 $N$，因此 $T = N\\,\\Delta t$。使用左黎曼和将离散时间功率样本解释为区间平均值来计算传递的能量：\n$$\nE_{\\text{deliv}} \\approx \\sum_{n=0}^{N-1} p[n]\\,\\Delta t.\n$$\n对于匹配负载和理想的端口归一化，理论能量为\n$$\nE_{\\text{theory}} = \\int_{0}^{T} P_0\\,dt = P_0 T = P_0 N \\Delta t.\n$$\n为了在时域端口中实现入射功率 $P_0$，选择匹配线上的入射电压波形为\n$$\nv^{+}[n] = \\sqrt{Z_0 P_0}\\,u_{\\text{rect}}[n],\n$$\n其中 $u_{\\text{rect}}[n]$ 在脉冲的 $N$ 个采样点上等于 $1$，在其他地方等于 $0$。在匹配负载下，总端口场满足 $v[n] = v^{+}[n]$ 和 $i[n] = \\frac{v[n]}{Z_0}$。\n\n请实现一个程序，为每个测试用例构建如上的 $v[n]$ 和 $i[n]$，使用左黎曼和计算 $E_{\\text{deliv}}$，并返回绝对误差\n$$\n\\varepsilon = \\left|E_{\\text{deliv}} - E_{\\text{theory}}\\right|\n$$\n单位为焦耳。所有物理答案必须以焦耳表示。此问题不涉及角度。不要将任何值表示为百分比。\n\n测试套件和所需单位：\n- 在所有用例中，使用 $P_0 = 1$ W，并以焦耳表示能量。\n- 每个测试用例由 $(Z_0,\\ \\Delta t,\\ N)$ 指定，$Z_0$ 的单位是欧姆，$\\Delta t$ 的单位是秒，$N$ 是无量纲的。\n- 测试用例：\n    - 案例 $1$ (正常情况): $Z_0 = 50$ $\\Omega$, $\\Delta t = 1\\times 10^{-12}$ s, $N = 1000$。\n    - 案例 $2$ (覆盖性测试：不同的 $Z_0$ 和步长): $Z_0 = 377$ $\\Omega$, $\\Delta t = 2\\times 10^{-12}$ s, $N = 500$。\n    - 案例 $3$ (覆盖性测试：更长的脉冲和不同的 $Z_0$): $Z_0 = 75$ $\\Omega$, $\\Delta t = 5\\times 10^{-12}$ s, $N = 1000$。\n    - 案例 $4$ (边界情况：非常短的脉冲): $Z_0 = 200$ $\\Omega$, $\\Delta t = 1\\times 10^{-11}$ s, $N = 3$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按测试用例的顺序列出结果。第 $k$ 个条目必须是案例 $k$ 的绝对能量误差 $\\varepsilon$（单位为焦耳）。例如，一个有效的输出字符串格式为 \"[result_case1,result_case2,result_case3,result_case4]\"。", "solution": "该问题要求设计并实现一个用于计算电磁学中时域端口模型的数值验证实验。该实验旨在确认端口能正确地将发射的脉冲归一化到指定的入射功率。实现方式是计算传递到匹配负载的总能量，并将其与理论值进行比较。该问题的框架是一维、无损、无色散的横电磁（TEM）传输线模型，这是从麦克斯韦方程组推导出的一个基本抽象。\n\n此验证的核心原理在于传输线上的行波分解。在任何一点（如端口）的总电压 $v(t)$ 和总电流 $i(t)$ 可以表示为前向传播（入射）波和后向传播（反射）波的叠加。其关系式如下：\n$$\nv(t) = v^{+}(t) + v^{-}(t)\n$$\n$$\ni(t) = \\frac{1}{Z_0}\\left(v^{+}(t) - v^{-}(t)\\right)\n$$\n此处，$v^{+}(t)$ 和 $v^{-}(t)$ 分别代表入射和反射电压波，$Z_0$ 是传输线的特征阻抗。\n\n流入连接在端口处的负载的瞬时功率 $p(t)$ 由总电压和总电流的乘积给出，$p(t) = v(t)i(t)$，这在传输线上等效于横截面上的坡印亭通量积分。\n\n问题指定了匹配负载，这是一个关键条件。匹配负载的阻抗等于传输线的特征阻抗 $Z_0$。根据负载处的欧姆定律，$v(t) = Z_0 i(t)$。将波分解式代入此条件可得：\n$$\nv^{+}(t) + v^{-}(t) = Z_0 \\left( \\frac{1}{Z_0}\\left(v^{+}(t) - v^{-}(t)\\right) \\right) = v^{+}(t) - v^{-}(t)\n$$\n化简后得到 $2v^{-}(t) = 0$，即 $v^{-}(t) = 0$。匹配负载会完全吸收所有入射波，不产生任何反射。因此，端口处的总电压和电流简化为 $v(t) = v^{+}(t)$ 和 $i(t) = v^{+}(t)/Z_0$。传递到匹配负载的功率则为：\n$$\np(t) = v(t)i(t) = v^{+}(t) \\cdot \\frac{v^{+}(t)}{Z_0} = \\frac{\\left(v^{+}(t)\\right)^2}{Z_0}\n$$\n\n该验证实验是围绕一个特定的入射脉冲设计的：一个在时长 $T$ 内具有恒定瞬时功率 $P_0$ 的脉冲。为实现这一点，我们必须构建相应的入射电压波形 $v^{+}(t)$。根据功率关系，我们需要：\n$$\nP_0 = \\frac{\\left(v^{+}(t)\\right)^2}{Z_0} \\quad \\text{for } t \\in [0, T]\n$$\n求解 $v^{+}(t)$ 可得入射电压脉冲所需的幅度：\n$$\nv^{+}(t) = \\sqrt{Z_0 P_0} \\quad \\text{for } t \\in [0, T]\n$$\n而在其他时间 $v^{+}(t) = 0$。\n\n该脉冲传递的理论总能量 $E_{\\text{theory}}$ 是恒定功率 $P_0$ 在时长 $T$ 内的时间积分：\n$$\nE_{\\text{theory}} = \\int_{0}^{T} P_0\\,dt = P_0 T\n$$\n在用于数值模拟的离散时间域中，时长 $T$ 由 $N$ 个大小为 $\\Delta t$ 的时间步表示，因此 $T = N \\Delta t$。理论能量即为：\n$$\nE_{\\text{theory}} = P_0 N \\Delta t\n$$\n数值模拟通过对离散功率样本求和来计算传递的能量 $E_{\\text{deliv}}$。根据指定的左黎曼和解释：\n$$\nE_{\\text{deliv}} = \\sum_{n=0}^{N-1} p[n]\\,\\Delta t\n$$\n其中 $p[n]$ 是时间步 $n$ 处的瞬时功率。根据模型，我们首先构造离散入射电压 $v^{+}[n] = \\sqrt{Z_0 P_0}$，其中 $n=0, 1, \\dots, N-1$。由于负载是匹配的，总场为 $v[n] = v^{+}[n]$ 和 $i[n] = v[n]/Z_0$。离散瞬时功率为：\n$$\np[n] = v[n]i[n] = \\frac{(v[n])^2}{Z_0} = \\frac{(\\sqrt{Z_0 P_0})^2}{Z_0} = \\frac{Z_0 P_0}{Z_0} = P_0\n$$\n这在脉冲处于活动状态的每个时间步 $n$ 都成立。将此恒定功率代入 $E_{\\text{deliv}}$ 的求和式中可得：\n$$\nE_{\\text{deliv}} = \\sum_{n=0}^{N-1} P_0\\,\\Delta t = P_0 \\Delta t \\sum_{n=0}^{N-1} 1 = P_0 \\Delta t \\cdot N\n$$\n从解析上我们发现 $E_{\\text{deliv}} = E_{\\text{theory}}$。这是一个“零值测试”：其目的是验证这些公式的数值实现能够正确地再现这一解析恒等式。此验证的度量标准是绝对误差 $\\varepsilon = |E_{\\text{deliv}} - E_{\\text{theory}}|$。根据我们的推导，这个误差预期为零，或者由于浮点运算的性质，是一个在机器精度量级上的非常小的值。\n\n对于每个测试用例 $(Z_0, \\Delta t, N)$，当 $P_0 = 1$ W 时，算法如下：\n1.  计算理论能量：$E_{\\text{theory}} = P_0 N \\Delta t$。\n2.  根据问题的物理模型，一个为入射功率 $P_0$ 而归一化的端口，传递到匹配负载的瞬时功率根据定义即为 $p[n]=P_0$。\n3.  通过对这些功率贡献求和来数值计算传递的能量：$E_{\\text{deliv}} = \\sum_{n=0}^{N-1} P_0 \\Delta t = P_0 N \\Delta t$。\n4.  计算绝对误差 $\\varepsilon = |E_{\\text{deliv}} - E_{\\text{theory}}|$。鉴于直接计算的方式，误差基本上为零，仅受浮点表示精度的限制。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a verification experiment for a time-domain port model\n    in computational electromagnetics.\n\n    The experiment verifies that a port normalized to launch an incident pulse\n    of prescribed power (P_0) delivers the correct total energy into a\n    matched load. The absolute error between the numerically computed\n    delivered energy and the theoretical energy is calculated.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (Z_0 in ohms, Delta_t in seconds, N dimensionless)\n    test_cases = [\n        (50.0, 1e-12, 1000),  # Case 1\n        (377.0, 2e-12, 500),   # Case 2\n        (75.0, 5e-12, 1000),   # Case 3\n        (200.0, 1e-11, 3),     # Case 4\n    ]\n\n    # Incident power is constant for all test cases.\n    P_0 = 1.0  # W\n\n    results = []\n    for case in test_cases:\n        Z_0, delta_t, N = case\n\n        # 1. Calculate the theoretical total energy delivered.\n        # E_theory = integral(P_0 dt) from 0 to T, where T = N * delta_t.\n        # For a constant P_0, this is simply P_0 * T.\n        E_theory = P_0 * N * delta_t\n\n        # 2. Simulate the physical process in discrete time.\n        # A port normalized for incident power P_0 is defined such that it would\n        # deliver P_0 to a matched load at every instant the source is active.\n        # For a rectangular pulse of duration T, the instantaneous power p[n]\n        # delivered to the matched load is P_0 for n = 0, ..., N-1.\n        \n        # We can explicitly follow the steps laid out in the problem to demonstrate this:\n        # a. Define the incident voltage waveform to produce power P_0.\n        # p_inc(t) = (v+(t))^2 / Z_0 => v+(t) = sqrt(Z_0 * p_inc(t))\n        # For p_inc(t) = P_0, the voltage amplitude is constant.\n        v_plus_amplitude = np.sqrt(Z_0 * P_0)\n        \n        # b. For a matched load, v(t) = v+(t) and i(t) = v+(t) / Z_0.\n        v_total_amplitude = v_plus_amplitude\n        i_total_amplitude = v_total_amplitude / Z_0\n        \n        # c. Calculate the instantaneous power p[n] = v[n] * i[n] for each step.\n        # Since v and i amplitudes are constant, the power is constant.\n        p_n = v_total_amplitude * i_total_amplitude\n        # Analytically, p_n = sqrt(Z_0*P_0) * (sqrt(Z_0*P_0)/Z_0) = (Z_0*P_0)/Z_0 = P_0.\n        # The numerical calculation should yield a value extremely close to P_0.\n\n        # 3. Calculate the total delivered energy using a left Riemann sum.\n        # E_deliv = sum(p[n] * delta_t for n=0 to N-1)\n        # Since p[n] is constant over the pulse duration:\n        E_deliv = N * p_n * delta_t\n        \n        # 4. Compute the absolute error between delivered and theoretical energy.\n        # This is a \"null test\" where the error should be zero or at the level\n        # of machine floating-point precision.\n        error = abs(E_deliv - E_theory)\n        results.append(error)\n\n    # Final print statement in the exact required format.\n    # The output should be a list of zeros, reflecting the analytic identity.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3342260"}, {"introduction": "理想化的端口定义在面对真实的、场分布不均匀的结构（如微带线弯头）时会遇到挑战。本练习探讨了两种常用端口定义——集总端口和分布式模式端口——如何因其不同的场采样方式而影响参数提取的准确性。通过量化这两种定义对提取的非连续性电容所引入的偏差，您将深刻理解为特定物理问题选择合适端口模型的必要性。", "problem": "考虑一个在准静态、准横向电磁场设定下建模的直角微带弯角。使用两种不同的端口定义在时域中激励和测量该传输线：一种是具有有限横向范围、基于局部电压/电流的集总端口；另一种是执行全横截面模式提取的分布式模态波端口。您将比较在使用时域反射计步阶响应提取器时，每种端口的场采样区域如何对感知到的并联不连续电容产生偏置。\n\n推导基于以下公认的基础：\n- 微分形式的 Maxwell 方程组、本构关系和电荷连续性方程。\n- 一个并联导纳插入两个特性阻抗为 $Z_0$ 的相同无损传输线之间的微信号散射：如果归一化并联导纳为 $y = Y Z_0$，则反射系数为 $S_{11} = -\\dfrac{y}{2 + y}$，当 $|y| \\ll 1$ 时，简化为 $S_{11} \\approx - \\dfrac{y}{2}$。\n- 对于对称嵌入在两条相同、匹配的无损传输线之间的并联电容 $C_{\\mathrm{d}}$，其时域反射关系为：对于单位幅度的前向步进信号 $v^{+}(t)$，微信号反射波为 $v^{-}(t) = - \\dfrac{Z_0 C_{\\mathrm{d}}}{2} \\dfrac{d v_{\\mathrm{disc}}(t)}{d t}$，因此反射核下方的面积，在归一化到单位步进后，等于 $- \\dfrac{Z_0 C_{\\mathrm{d}}}{2}$。\n\n您将建模端口的有限场采样区域如何改变不连续处的局部电压与端口报告电压之间的测量关系。设微带线宽度为 $w$，并引入横向坐标 $x \\in [0,w]$，其中 $x=0$ 位于弯角内侧边缘。设沿宽度的无量纲准静态场集中分布为\n$$\ng(x;\\sigma) \\triangleq \\frac{K}{1+\\left(\\dfrac{x}{\\sigma}\\right)^2}, \\quad \\text{with} \\quad K \\ \\text{chosen so that} \\ \\frac{1}{w} \\int_{0}^{w} g(x;\\sigma) \\, dx = 1.\n$$\n此归一化强制 $g$ 的横截面平均值为 1，从而使得分布式模态波端口的线电压（定义为横截面平均电势差）等于不连续处的有效电压。对于一个集总端口，它通过在从 $x_0$ 开始、宽度为 $w_{\\mathrm{s}}$ 的有限横向采样区间（即采样区域为 $[x_0, x_0 + w_{\\mathrm{s}}] \\subset [0,w]$）上对电场进行空间平均来测量电压，其测量电压与 $g$ 在该区间上的局部平均值成正比。定义\n$$\nG_{\\mathrm{local}}(x_0,w_{\\mathrm{s}};\\sigma,w) \\triangleq \\frac{1}{w_{\\mathrm{s}}} \\int_{x_0}^{x_0+w_{\\mathrm{s}}} g(x;\\sigma) \\, dx, \\qquad G_{\\mathrm{avg}}(\\sigma,w) \\triangleq \\frac{1}{w} \\int_{0}^{w} g(x;\\sigma) \\, dx = 1.\n$$\n\n使用微信号时域关系 $v^{-}(t) = - \\dfrac{Z_0 C_{\\mathrm{d}}}{2} \\dfrac{d v_{\\mathrm{disc}}(t)}{d t}$，其中 $v_{\\mathrm{disc}}(t)$ 是有效不连续电压，证明：\n- 对于分布式模态波端口，根据构造有 $v_{\\mathrm{disc}}(t) = v_{\\mathrm{wave}}(t)$，因此脉冲下面积法得出 $C_{\\mathrm{est,\\,wave}} = C_{\\mathrm{d}}$。\n- 对于集总端口，有 $v_{\\mathrm{disc}}(t) = \\dfrac{G_{\\mathrm{avg}}}{G_{\\mathrm{local}}} v_{\\mathrm{lump}}(t) = \\dfrac{1}{G_{\\mathrm{local}}} v_{\\mathrm{lump}}(t)$，因此使用相同的、除以 $Z_0$ 的脉冲下面积提取器返回\n$$\nC_{\\mathrm{est,\\,lump}} = \\frac{G_{\\mathrm{avg}}}{G_{\\mathrm{local}}} \\, C_{\\mathrm{d}} = \\frac{C_{\\mathrm{d}}}{G_{\\mathrm{local}}}.\n$$\n\n任务：\n1. 仅从上述基础出发，推导 $K$、$G_{\\mathrm{local}}$ 的表达式，以及偏置公式 $C_{\\mathrm{est,\\,wave}}$ 和 $C_{\\mathrm{est,\\,lump}}$（用 $(w,\\sigma,w_{\\mathrm{s}},x_0,C_{\\mathrm{d}})$ 表示）。\n2. 实现一个程序，对于下面指定的每个测试用例，使用推导出的公式计算 $C_{\\mathrm{est,\\,wave}}$ 和 $C_{\\mathrm{est,\\,lump}}$。使用 $g(x;\\sigma)$ 的闭式反导数精确计算 $G_{\\mathrm{local}}$（不要使用数值积分）。所有电容均以法拉（farad）表示。\n\n使用以下测试套件（所有长度必须解释为毫米，电容为法拉，特性阻抗为欧姆；任何内部反正切计算中的角度均为弧度）：\n- 测试 1（正常路径，中等场集中度，中心采样）：$w = 1.0$ mm, $\\sigma = 0.05$ mm, $w_{\\mathrm{s}} = 0.2$ mm, $x_0 = 0.4$ mm, $Z_0 = 50$, $C_{\\mathrm{d}} = 1.0 \\times 10^{-13}$ F。\n- 测试 2（靠近内弯角的边缘采样，局部场更强，预计会低估）：$w = 1.0$ mm, $\\sigma = 0.05$ mm, $w_{\\mathrm{s}} = 0.1$ mm, $x_0 = 0.0$ mm, $Z_0 = 50$, $C_{\\mathrm{d}} = 1.0 \\times 10^{-13}$ F。\n- 测试 3（采样跨越整个宽度，无偏置）：$w = 1.0$ mm, $\\sigma = 0.05$ mm, $w_{\\mathrm{s}} = 1.0$ mm, $x_0 = 0.0$ mm, $Z_0 = 50$, $C_{\\mathrm{d}} = 1.0 \\times 10^{-13}$ F。\n- 测试 4（极端场集中度和非常窄的边缘采样，严重低估）：$w = 1.0$ mm, $\\sigma = 0.01$ mm, $w_{\\mathrm{s}} = 0.02$ mm, $x_0 = 0.0$ mm, $Z_0 = 50$, $C_{\\mathrm{d}} = 1.0 \\times 10^{-13}$ F。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。对于每个测试，该列表必须按顺序首先包含 $C_{\\mathrm{est,\\,wave}}$，然后是 $C_{\\mathrm{est,\\,lump}}$，两者均以法拉为单位。因此，对于上述四个测试，输出必须是一个包含八个浮点值的平铺列表，单位为法拉：$[C_{\\mathrm{est,\\,wave}}^{(1)},C_{\\mathrm{est,\\,lump}}^{(1)},C_{\\mathrm{est,\\,wave}}^{(2)},C_{\\mathrm{est,\\,lump}}^{(2)},C_{\\mathrm{est,\\,wave}}^{(3)},C_{\\mathrm{est,\\,lump}}^{(3)},C_{\\mathrm{est,\\,wave}}^{(4)},C_{\\mathrm{est,\\,lump}}^{(4)}]$。", "solution": "问题陈述已经过严格审查，并被确定为有效。它在科学上基于电磁学和传输线理论的既定原理，问题设定良好，目标明确，数据充分，并且没有主观或矛盾的陈述。该任务是基于所提供的物理模型进行形式推导和后续计算。\n\n### 1. 归一化常数 $K$ 的推导\n\n无量纲准静态场集中分布由下式给出：\n$$\ng(x;\\sigma) \\triangleq \\frac{K}{1+\\left(\\dfrac{x}{\\sigma}\\right)^2}\n$$\n常数 $K$ 由归一化条件确定，即 $g(x;\\sigma)$ 在微带线宽度 $w$ 上的横截面平均值为 1。这表示为：\n$$\nG_{\\mathrm{avg}}(\\sigma,w) = \\frac{1}{w} \\int_{0}^{w} g(x;\\sigma) \\, dx = 1\n$$\n代入 $g(x;\\sigma)$ 的表达式：\n$$\n\\frac{1}{w} \\int_{0}^{w} \\frac{K}{1+\\left(\\dfrac{x}{\\sigma}\\right)^2} \\, dx = 1\n$$\n为了求解 $K$，我们首先计算积分。被积函数的反导数是已知的：\n$$\n\\int \\frac{1}{1+\\left(\\dfrac{x}{\\sigma}\\right)^2} \\, dx = \\sigma \\arctan\\left(\\frac{x}{\\sigma}\\right)\n$$\n应用从 $0$ 到 $w$ 的积分限：\n$$\n\\int_{0}^{w} \\frac{1}{1+\\left(\\dfrac{x}{\\sigma}\\right)^2} \\, dx = \\left[ \\sigma \\arctan\\left(\\frac{x}{\\sigma}\\right) \\right]_{0}^{w} = \\sigma \\arctan\\left(\\frac{w}{\\sigma}\\right) - \\sigma \\arctan(0) = \\sigma \\arctan\\left(\\frac{w}{\\sigma}\\right)\n$$\n将此结果代回归一化方程：\n$$\n\\frac{K}{w} \\left( \\sigma \\arctan\\left(\\frac{w}{\\sigma}\\right) \\right) = 1\n$$\n求解 $K$ 得出归一化常数的最终表达式：\n$$\nK = \\frac{w}{\\sigma \\arctan\\left(\\dfrac{w}{\\sigma}\\right)}\n$$\n\n### 2. 局部平均函数 $G_{\\mathrm{local}}$ 的推导\n\n函数 $G_{\\mathrm{local}}$ 表示场分布 $g(x;\\sigma)$ 在有限采样区间 $[x_0, x_0 + w_{\\mathrm{s}}]$ 上的平均值。其定义为：\n$$\nG_{\\mathrm{local}}(x_0,w_{\\mathrm{s}};\\sigma,w) \\triangleq \\frac{1}{w_{\\mathrm{s}}} \\int_{x_0}^{x_0+w_{\\mathrm{s}}} g(x;\\sigma) \\, dx\n$$\n代入 $g(x;\\sigma)$ 的表达式：\n$$\nG_{\\mathrm{local}} = \\frac{1}{w_{\\mathrm{s}}} \\int_{x_0}^{x_0+w_{\\mathrm{s}}} \\frac{K}{1+\\left(\\dfrac{x}{\\sigma}\\right)^2} \\, dx = \\frac{K}{w_{\\mathrm{s}}} \\int_{x_0}^{x_0+w_{\\mathrm{s}}} \\frac{1}{1+\\left(\\dfrac{x}{\\sigma}\\right)^2} \\, dx\n$$\n使用与之前相同的反导数并应用新的积分限：\n$$\n\\int_{x_0}^{x_0+w_{\\mathrm{s}}} \\frac{1}{1+\\left(\\dfrac{x}{\\sigma}\\right)^2} \\, dx = \\left[ \\sigma \\arctan\\left(\\frac{x}{\\sigma}\\right) \\right]_{x_0}^{x_0+w_{\\mathrm{s}}} = \\sigma \\left( \\arctan\\left(\\frac{x_0+w_{\\mathrm{s}}}{\\sigma}\\right) - \\arctan\\left(\\frac{x_0}{\\sigma}\\right) \\right)\n$$\n将此积分结果代入 $G_{\\mathrm{local}}$ 的表达式中：\n$$\nG_{\\mathrm{local}} = \\frac{K \\sigma}{w_{\\mathrm{s}}} \\left( \\arctan\\left(\\frac{x_0+w_{\\mathrm{s}}}{\\sigma}\\right) - \\arctan\\left(\\frac{x_0}{\\sigma}\\right) \\right)\n$$\n最后，代入推导出的 $K$ 的表达式：\n$$\nG_{\\mathrm{local}} = \\frac{1}{w_{\\mathrm{s}}} \\left( \\frac{w}{\\sigma \\arctan\\left(\\frac{w}{\\sigma}\\right)} \\right) \\sigma \\left( \\arctan\\left(\\frac{x_0+w_{\\mathrm{s}}}{\\sigma}\\right) - \\arctan\\left(\\frac{x_0}{\\sigma}\\right) \\right)\n$$\n简化此表达式可得出 $G_{\\mathrm{local}}$ 的闭式形式：\n$$\nG_{\\mathrm{local}}(x_0,w_{\\mathrm{s}};\\sigma,w) = \\frac{w}{w_{\\mathrm{s}} \\arctan\\left(\\frac{w}{\\sigma}\\right)} \\left( \\arctan\\left(\\frac{x_0+w_{\\mathrm{s}}}{\\sigma}\\right) - \\arctan\\left(\\frac{x_0}{\\sigma}\\right) \\right)\n$$\n\n### 3. 估算电容公式的推导\n\n分析从小型并联电容 $C_{\\mathrm{d}}$ 的时域反射（TDR）关系开始：反射电压波 $v^-(t)$ 与不连续处电压 $v_{\\mathrm{disc}}(t)$ 的时间导数成正比。\n$$\nv^{-}(t) = - \\frac{Z_0 C_{\\mathrm{d}}}{2} \\frac{d v_{\\mathrm{disc}}(t)}{d t}\n$$\nTDR 测量算法通过对反射脉冲进行积分，并根据假定的入射步进幅度和特性阻抗 $Z_0$ 进行归一化来估算电容。假设一个单位幅度的步进激励，反射脉冲 $v^-(t)$ 下的面积为：\n$$\n\\int_{0}^{\\infty} v^{-}(t) \\, dt = \\int_{0}^{\\infty} \\left( - \\frac{Z_0 C_{\\mathrm{d}}}{2} \\frac{d v_{\\mathrm{disc}}(t)}{d t} \\right) dt = - \\frac{Z_0 C_{\\mathrm{d}}}{2} [v_{\\mathrm{disc}}(t)]_{0}^{\\infty} = - \\frac{Z_0 C_{\\mathrm{d}}}{2} \\Delta v_{\\mathrm{disc}}\n$$\n其中 $\\Delta v_{\\mathrm{disc}}$ 是不连续处电压阶跃的幅度。该算法使用在端口处测量的电压阶跃幅度 $\\Delta v_{\\mathrm{port}}$ 作为参考来计算估算电容 $C_{\\mathrm{est}}$：\n$$\nC_{\\mathrm{est}} = - \\frac{2}{Z_0 \\Delta v_{\\mathrm{port}}} \\int_{0}^{\\infty} v^{-}(t) \\, dt = - \\frac{2}{Z_0 \\Delta v_{\\mathrm{port}}} \\left( - \\frac{Z_0 C_{\\mathrm{d}}}{2} \\Delta v_{\\mathrm{disc}} \\right) = C_{\\mathrm{d}} \\frac{\\Delta v_{\\mathrm{disc}}}{\\Delta v_{\\mathrm{port}}}\n$$\n估算电容的偏置源于真实不连续电压阶跃 $\\Delta v_{\\mathrm{disc}}$ 与端口测量的电压阶跃 $\\Delta v_{\\mathrm{port}}$ 之间的差异。根据构造，真实的不连续电压与完整的横截面平均场成正比，缩放因子为 $G_{\\mathrm{avg}}=1$。端口电压与其采样区域上的场平均值成正比，缩放因子为 $G_{\\mathrm{local}}$。因此，它们的比率为：\n$$\n\\frac{v_{\\mathrm{port}}(t)}{v_{\\mathrm{disc}}(t)} = \\frac{G_{\\mathrm{local}}}{G_{\\mathrm{avg}}} = G_{\\mathrm{local}} \\quad \\implies \\quad \\frac{\\Delta v_{\\mathrm{port}}}{\\Delta v_{\\mathrm{disc}}} = G_{\\mathrm{local}}\n$$\n\n**情况 A：分布式模态波端口**\n分布式模态波端口的定义旨在提取基本传输线模式的电压，该电压对应于横截面平均电势。因此，根据其定义：\n$$\nv_{\\mathrm{wave}}(t) = v_{\\mathrm{disc}}(t) \\quad \\implies \\quad \\Delta v_{\\mathrm{wave}} = \\Delta v_{\\mathrm{disc}}\n$$\n将此代入 $C_{\\mathrm{est}}$ 的通用公式中：\n$$\nC_{\\mathrm{est,\\,wave}} = C_{\\mathrm{d}} \\frac{\\Delta v_{\\mathrm{disc}}}{\\Delta v_{\\mathrm{wave}}} = C_{\\mathrm{d}} \\cdot 1 = C_{\\mathrm{d}}\n$$\n估算的电容是无偏的，等于真实的不连续电容。\n\n**情况 B：集总端口**\n集总端口通过在有限子区域 $[x_0, x_0+w_s]$ 上对场进行平均来测量电压。因此，测量的电压通过局部平均因子与真实的不连续电压相关联：\n$$\nv_{\\mathrm{lump}}(t) = G_{\\mathrm{local}} \\cdot v_{\\mathrm{disc}}(t) \\quad \\implies \\quad \\Delta v_{\\mathrm{lump}} = G_{\\mathrm{local}} \\cdot \\Delta v_{\\mathrm{disc}}\n$$\n将此代入 $C_{\\mathrm{est}}$ 的通用公式中：\n$$\nC_{\\mathrm{est,\\,lump}} = C_{\\mathrm{d}} \\frac{\\Delta v_{\\mathrm{disc}}}{\\Delta v_{\\mathrm{lump}}} = C_{\\mathrm{d}} \\frac{\\Delta v_{\\mathrm{disc}}}{G_{\\mathrm{local}} \\cdot \\Delta v_{\\mathrm{disc}}} = \\frac{C_{\\mathrm{d}}}{G_{\\mathrm{local}}}\n$$\n由于 $G_{\\mathrm{avg}} = 1$，这与所要求的形式 $C_{\\mathrm{est,\\,lump}} = \\frac{G_{\\mathrm{avg}}}{G_{\\mathrm{local}}} C_{\\mathrm{d}}$ 相同。这表明估算的电容受到局部场平均因子的倒数的偏置。如果端口采样的区域场强大于平均值（$G_{\\mathrm{local}} > 1$），则电容会被低估。如果采样的区域场强小于平均值（$G_{\\mathrm{local}}  1$），则电容会被高估。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the estimated waveport and lumped-port discontinuity capacitances for a series of test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    # Format: (w, sigma, w_s, x_0, Z_0, C_d)\n    # Units: mm for lengths, Ohms for impedance, Farads for capacitance.\n    test_cases = [\n        # Test 1: happy path, moderate field concentration, central sampling\n        (1.0, 0.05, 0.2, 0.4, 50, 1.0e-13),\n        # Test 2: edge sampling near inner bend, stronger local field, underestimation expected\n        (1.0, 0.05, 0.1, 0.0, 50, 1.0e-13),\n        # Test 3: sampling spans full width, unbiased\n        (1.0, 0.05, 1.0, 0.0, 50, 1.0e-13),\n        # Test 4: extreme field concentration and very narrow edge sampling, strong underestimation\n        (1.0, 0.01, 0.02, 0.0, 50, 1.0e-13),\n    ]\n\n    results = []\n    for case in test_cases:\n        w, sigma, w_s, x_0, _, C_d = case\n\n        # The estimated capacitance for a distributed modal waveport is always unbiased.\n        # C_est,wave = C_d\n        c_est_wave = C_d\n\n        # Calculate G_local, the local field averaging factor.\n        # The formulas are derived from the integrals provided in the problem statement.\n        # Since w, sigma, w_s, and x_0 are all in mm, the units cancel out\n        # in the calculation of the dimensionless factor G_local.\n\n        # Special case: if sampling width w_s is zero, the integral is zero.\n        # To avoid division by zero, we handle this, although it's not in the test suite.\n        if w_s == 0:\n            # The value of g at a single point x_0.\n            # This requires computing K first.\n            if sigma == 0: # Avoid division by zero in arctan\n                g_local = 0.0 # Or some other defined behavior for this singularity\n            else:\n                K = w / (sigma * np.arctan(w / sigma))\n                g_local = K / (1 + (x_0 / sigma)**2)\n\n        elif sigma == 0: # Avoid division by zero in arctan\n            g_local = 0.0 # Or some other defined behavior\n\n        else:\n            # Full formula for G_local for w_s  0\n            # G_local = (w / (w_s * arctan(w/sigma))) * (arctan((x_0+w_s)/sigma) - arctan(x_0/sigma))\n            \n            # Use np.arctan for arctangent calculation (angles are in radians)\n            term_w_over_sigma = w / sigma\n            arctan_w_over_sigma = np.arctan(term_w_over_sigma)\n\n            term_x0_plus_ws_over_sigma = (x_0 + w_s) / sigma\n            arctan_x0_plus_ws_over_sigma = np.arctan(term_x0_plus_ws_over_sigma)\n\n            term_x0_over_sigma = x_0 / sigma\n            arctan_x0_over_sigma = np.arctan(term_x0_over_sigma)\n            \n            # Check for denominator becoming zero\n            if arctan_w_over_sigma == 0:\n                 # This would happen if w/sigma is 0, which implies w=0.\n                 # This case is physically not a microstrip.\n                 g_local = 1.0 # Or handle as an error\n            else:\n                factor1 = w / (w_s * arctan_w_over_sigma)\n                factor2 = arctan_x0_plus_ws_over_sigma - arctan_x0_over_sigma\n                g_local = factor1 * factor2\n\n        # The estimated capacitance for the lumped port is biased by 1/G_local.\n        # C_est,lump = C_d / G_local\n        # If G_local is zero, it implies sampling in a null, leading to infinite C_est.\n        if g_local == 0:\n            c_est_lump = float('inf')\n        else:\n            c_est_lump = C_d / g_local\n\n        results.append(c_est_wave)\n        results.append(c_est_lump)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3342286"}, {"introduction": "时域端口的功能远不止于激励基模或测量S参数，它们还可以作为强大的工具来精确合成和控制复杂的电磁场模式。本高级练习将指导您设计一个能够激励具有特定轨道角动量（OAM）的涡旋模式的端口。通过在圆形波导中构建一个具有特定方位角相位依赖性的激励场，并量化其模式纯度，您将体验到端口在尖端电磁学研究（如高容量通信和粒子操控）中的应用潜力。", "problem": "你的任务是设计一个时域端口激励，用于在圆形完美电导体（PEC）波导中发射具有指定轨道角动量的涡旋电磁波模式，并量化该激励随时间演化过程中的模式纯度。端口将被定义在一个固定轴向坐标处的圆形横截面上，它必须施加一个与轨道角动量指数相对应的涡旋方位角相位依赖关系。模式纯度的评估必须通过将施加的端口场投影到波导的合适正交归一模式基上进行。\n\n从麦克斯韦方程组和标准波导理论的基本原理出发。考虑一个半径为 $a$ 且壁为完美电导体（PEC）的圆形波导。对于相对于z轴的横磁模式（TM模式），纵向电场 $E_z(r,\\phi,z)$ 在柱坐标系 $(r,\\phi,z)$ 中充当模式分解的标量势。在 PEC 圆形波导中，$E_z$ 的可分离变量解遵循径向贝塞尔微分方程和角向傅里叶条件，从而得到由第一类贝塞尔函数 $J_\\ell(\\cdot)$ 给出的径向依赖关系，其中 $\\ell$ 是与轨道角动量相关的整数方位角指数，$\\phi$ 是方位角。边界条件 $E_z(a,\\phi)=0$ 产生离散的径向本征值 $\\chi_{\\ell n}$，即 $J_\\ell$ 的第 $n$ 个正零点，因此径向波数为 $k_{r,\\ell n}=\\chi_{\\ell n}/a$。横截面上相应的标量模式形状可取为\n$$\n\\Psi_{\\ell n}(r,\\phi) = J_\\ell\\left(\\frac{\\chi_{\\ell n}}{a} r\\right) e^{j\\ell \\phi},\n$$\n这些模式在圆形横截面上的正交性满足\n$$\n\\int_0^{2\\pi}\\int_0^a \\Psi_{\\ell n}(r,\\phi)\\,\\Psi_{\\ell' n'}^*(r,\\phi)\\,r\\,dr\\,d\\phi \n= N_{\\ell n}\\,\\delta_{\\ell\\ell'}\\delta_{nn'},\n$$\n其中归一化常数为\n$$\nN_{\\ell n} = 2\\pi \\int_0^a J_\\ell^2\\left(\\frac{\\chi_{\\ell n}}{a} r\\right)\\,r\\,dr.\n$$\n这种正交性源于变量分离法、PEC 边界条件下径向算子的 Sturm–Liouville 结构，以及方位角坐标下的傅里叶正交性。\n\n通过直接指定端口横截面上的切向场分布来施加时域端口激励。为了发射一个轨道角动量指数为 $\\ell$ 的涡旋模式，定义一个形式为\n$$\nE_z^{\\text{port}}(r,\\phi,t) = s(t)\\,\\Big[\\Psi_{\\ell n}(r,\\phi) + \\alpha(t)\\,\\Psi_{\\ell_\\text{alt}\\,n_\\text{alt}}(r,\\phi)\\Big]\n$$\n的纵向电分量的时变端口场，其中 $s(t)$ 是一个无量纲振幅的实值时间包络，而 $\\alpha(t)$ 是一个小的、随时间变化的实值污染系数，它引入了由 $(\\ell_\\text{alt},n_\\text{alt})$ 表征的另一个不同涡旋模式的受控混合。这种激励通过构造强制实现了方位角涡旋相位因子 $e^{j\\ell\\phi}$，并允许在 $\\alpha(t)$ 随时间变化时对模式纯度进行时域评估。\n\n通过内积\n$$\nc_{\\ell n}(t) = \\frac{\\int_0^{2\\pi}\\int_0^a E_z^{\\text{port}}(r,\\phi,t)\\,\\Psi_{\\ell n}^*(r,\\phi)\\,r\\,dr\\,d\\phi}{N_{\\ell n}}\n$$\n定义每个时刻 $t$ 的模式投影系数 $c_{\\ell n}(t)$，对于 $c_{\\ell_\\text{alt} n_\\text{alt}}(t)$ 也类似。相对于目标模式 $(\\ell,n)$ 的瞬时模式纯度则定义为\n$$\nP(t) = \\frac{|c_{\\ell n}(t)|^2}{|c_{\\ell n}(t)|^2 + |c_{\\ell_\\text{alt} n_\\text{alt}}(t)|^2}.\n$$\n该定义是无量纲的，并且与正交归一投影下基于能量的解释一致。当 $s(t)$ 和 $\\alpha(t)$ 为实数时，$P(t)$ 可简化为其幅值的有理函数。请注意，所有场和积分都是在固定轴向坐标处的二维端口横截面上进行的，这与波导理论中的模式匹配相符。\n\n你的程序必须：\n- 使用一个具有 $N_r$ 个点的、跨越 $r\\in[0,a]$ 的均匀径向网格，以及一个具有 $N_\\phi$ 个点的、跨越 $\\phi\\in[0,2\\pi)$ 的均匀方位角网格，来离散化圆形横截面。\n- 使用贝塞尔函数 $J_\\ell$ 及其零点 $\\chi_{\\ell n}$ 来构造 $\\Psi_{\\ell n}(r,\\phi)$ 和 $\\Psi_{\\ell_\\text{alt} n_\\text{alt}}(r,\\phi)$。\n- 实现时域包络 $s(t)$ 为高斯脉冲 $s(t) = \\exp\\left(-\\frac{(t-t_0)^2}{2\\sigma^2}\\right)$，以及污染系数 $\\alpha(t)$ 为 $\\alpha(t) = \\alpha_0 \\exp\\left(-\\frac{(t-t_0)^2}{2\\sigma_\\alpha^2}\\right)$，其中 $t_0$ 是脉冲中心（单位为秒），$\\sigma, \\sigma_\\alpha$ 是时间宽度（单位为秒）。\n- 使用面积元为 $r\\,dr\\,d\\phi$ 的黎曼和求积法数值近似内积，以在指定时间计算 $c_{\\ell n}(t)$ 和 $c_{\\ell_\\text{alt} n_\\text{alt}}(t)$。\n\n物理单位：波导半径 $a$ 必须以米为单位指定，时间参数 $t$、$t_0$、$\\sigma$ 和 $\\sigma_\\alpha$ 必须以秒为单位指定。模式纯度 $P(t)$ 是无量纲的。所有输出必须以不带单位字符串的浮点数形式报告。\n\n测试套件：你的程序必须为以下三个参数集中的每一个计算 $P(t)$，每个参数集有三个采样时间。每个参数集的三个采样时间分别为 $t=t_0-2\\sigma$、$t=t_0$ 和 $t=t_0+2\\sigma$，以秒为单位。\n\n- 测试用例 1 (正常路径):\n  - $a=0.02$ 米, $\\ell=1$, $n=1$, $\\ell_\\text{alt}=2$, $n_\\text{alt}=1$, $N_r=200$, $N_\\phi=128$,\n  - $t_0=5\\times 10^{-9}$ 秒, $\\sigma=0.8\\times 10^{-9}$ 秒, $\\sigma_\\alpha=0.5\\times 10^{-9}$ 秒,\n  - $\\alpha_0=0.1$。\n\n- 测试用例 2 (l=0 的边界条件):\n  - $a=0.015$ 米, $\\ell=0$, $n=1$, $\\ell_\\text{alt}=1$, $n_\\text{alt}=1$, $N_r=180$, $N_\\phi=64$,\n  - $t_0=4\\times 10^{-9}$ 秒, $\\sigma=0.7\\times 10^{-9}$ 秒, $\\sigma_\\alpha=0.35\\times 10^{-9}$ 秒,\n  - $\\alpha_0=0.05$。\n\n- 测试用例 3 (更大的污染以测试鲁棒性):\n  - $a=0.01$ 米, $\\ell=3$, $n=1$, $\\ell_\\text{alt}=5$, $n_\\text-alt}=1$, $N_r=220$, $N_\\phi=48$,\n  - $t_0=6\\times 10^{-9}$ 秒, $\\sigma=1.0\\times 10^{-9}$ 秒, $\\sigma_\\alpha=0.6\\times 10^{-9}$ 秒,\n  - $\\alpha_0=0.2$。\n\n最终输出格式：你的程序应生成单行输出，其中包含测试用例 1 的所有三个时间的模式纯度值，接着是测试用例 2 的所有三个时间的模式纯度值，再接着是测试用例 3 的所有三个时间的模式纯度值，按此顺序排列。输出应为一个用方括号括起来的逗号分隔列表（例如，$[P_1(t_1),P_1(t_2),P_1(t_3),P_2(t_1),P_2(t_2),P_2(t_3),P_3(t_1),P_3(t_2),P_3(t_3)]$）。每个条目必须是一个浮点数。", "solution": "问题陈述经过了仔细验证，并被确定为是合理的。它在科学上基于电磁理论的原理，特别是波导模式分析。它是良定的、客观的，并为获得唯一解提供了完整的参数和定义集。任务是实现一个指定的数值程序，以计算圆形波导中时域涡旋模式激励的模式纯度。尽管存在解析简化方法，但题目明确要求实现数值方法，这是计算物理学中一个标准且有价值的练习。\n\n目标是计算一个指定的时域端口激励的瞬时模式纯度 $P(t)$。该激励旨在发射一个主横磁（TM）涡旋模式 $(\\ell, n)$，并在半径为 $a$ 的圆形完美电导波导中混入一个次要的污染模式 $(\\ell_{\\text{alt}}, n_{\\text{alt}})$。\n\n纵向电场的端口激励由下式给出\n$$\nE_z^{\\text{port}}(r,\\phi,t) = s(t)\\,\\Big[\\Psi_{\\ell n}(r,\\phi) + \\alpha(t)\\,\\Psi_{\\ell_\\text{alt}\\,n_\\text{alt}}(r,\\phi)\\Big]\n$$\n其中 $\\Psi_{\\ell n}(r,\\phi) = J_\\ell\\left(\\frac{\\chi_{\\ell n}}{a} r\\right) e^{j\\ell \\phi}$ 是正交标量模式形状。时间包络是一个高斯脉冲 $s(t) = \\exp\\left(-\\frac{(t-t_0)^2}{2\\sigma^2}\\right)$ 和一个随时间变化的污染系数 $\\alpha(t) = \\alpha_0 \\exp\\left(-\\frac{(t-t_0)^2}{2\\sigma_\\alpha^2}\\right)$。\n\n模式含量的分析是通过将端口场投影到模式基上进行的。在时间 $t$ 时，一个通用模式 $(\\ell', n')$ 的投影系数由内积定义：\n$$\nc_{\\ell' n'}(t) = \\frac{\\int_0^{2\\pi}\\int_0^a E_z^{\\text{port}}(r,\\phi,t)\\,\\Psi_{\\ell' n'}^*(r,\\phi)\\,r\\,dr\\,d\\phi}{N_{\\ell' n'}}\n$$\n其中星号表示复共轭，$N_{\\ell' n'}$ 是来自正交关系式的归一化常数：\n$$\n\\int_0^{2\\pi}\\int_0^a \\Psi_{\\ell n}(r,\\phi)\\,\\Psi_{\\ell' n'}^*(r,\\phi)\\,r\\,dr\\,d\\phi = N_{\\ell n}\\,\\delta_{\\ell\\ell'}\\delta_{nn'}\n$$\n\n相对于目标模式 $(\\ell, n)$ 和污染模式 $(\\ell_\\text{alt}, n_\\text{alt})$ 定义的瞬时模式纯度由下式给出：\n$$\nP(t) = \\frac{|c_{\\ell n}(t)|^2}{|c_{\\ell n}(t)|^2 + |c_{\\ell_\\text{alt} n_\\text{alt}}(t)|^2}\n$$\n\n由于基函数 $\\Psi_{\\ell n}$ 的正交性，我们可以推导出投影系数的解析形式。将 $E_z^{\\text{port}}$ 的表达式代入 $c_{\\ell n}(t)$ 的定义中：\n$$\nc_{\\ell n}(t) = \\frac{s(t)}{N_{\\ell n}} \\int_0^{2\\pi}\\int_0^a \\Big[\\Psi_{\\ell n}(r,\\phi) + \\alpha(t)\\,\\Psi_{\\ell_\\text{alt}\\,n_\\text{alt}}(r,\\phi)\\Big]\\,\\Psi_{\\ell n}^*(r,\\phi)\\,r\\,dr\\,d\\phi\n$$\n$$\nc_{\\ell n}(t) = \\frac{s(t)}{N_{\\ell n}} \\left( \\int\\int |\\Psi_{\\ell n}|^2 r\\,dr\\,d\\phi + \\alpha(t) \\int\\int \\Psi_{\\ell_\\text{alt}\\,n_\\text{alt}}\\,\\Psi_{\\ell n}^* r\\,dr\\,d\\phi \\right)\n$$\n由于 $(\\ell, n) \\neq (\\ell_\\text{alt}, n_\\text{alt})$，第二个积分为零，而第一个积分根据定义为 $N_{\\ell n}$。因此，$c_{\\ell n}(t) = s(t)$。\n类似地，对于污染模式的系数：\n$$\nc_{\\ell_\\text{alt} n_\\text{alt}}(t) = \\frac{s(t)}{N_{\\ell_\\text{alt} n_\\text{alt}}} \\left( \\int\\int \\Psi_{\\ell n} \\Psi_{\\ell_\\text{alt} n_\\text{alt}}^* r\\,dr\\,d\\phi + \\alpha(t) \\int\\int |\\Psi_{\\ell_\\text{alt} n_\\text{alt}}|^2 r\\,dr\\,d\\phi \\right) = s(t)\\alpha(t)\n$$\n将这些代入純度的表达式中，并注意到 $s(t)$ 和 $\\alpha(t)$ 是实值的：\n$$\nP(t) = \\frac{|s(t)|^2}{|s(t)|^2 + |s(t)\\alpha(t)|^2} = \\frac{s(t)^2}{s(t)^2(1 + \\alpha(t)^2)} = \\frac{1}{1 + \\alpha(t)^2}\n$$\n这假设 $s(t) \\neq 0$，对于指定的采样时间是成立的。这个解析结果为验证我们的数值实现提供了一个关键基准。然而，问题指示进行完整的数值评估，我们现在详细说明。\n\n数值解法涉及离散化波导横截面并将积分近似为黎曼和。\n该域被离散化为一个点 $(r_i, \\phi_j)$ 的网格，其中 $r_i$ 是在 $[0, a]$ 中均匀间隔的 $N_r$ 个点，$\\phi_j$ 是在 $[0, 2\\pi)$ 中均匀间隔的 $N_\\phi$ 个点。步骤如下：\n1. 定义离散的径向和方位角坐标：\n$r_i = i \\cdot \\Delta r$，对于 $i=0, ..., N_r-1$，其中 $\\Delta r = a / (N_r-1)$。\n$\\phi_j = j \\cdot \\Delta \\phi$，对于 $j=0, ..., N_\\phi-1$，其中 $\\Delta \\phi = 2\\pi / N_\\phi$。\n2. 对于每个所需的模式 $(\\ell, n)$ 和 $(\\ell_\\text{alt}, n_\\text{alt})$，使用数值求根库函数找到贝塞尔函数 $J_\\ell(x)$ 的第 $n$ 个零点，记为 $\\chi_{\\ell n}$。\n3. 在二维网格上构建复值基函数 $\\Psi_{\\ell n}(r_i, \\phi_j)$ 和 $\\Psi_{\\ell_\\text{alt} n_\\text{alt}}(r_i, \\phi_j)$。\n4. 数值计算归一化常数 $N_{\\ell n}$ 和 $N_{\\ell_\\text{alt} n_\\text{alt}}$。积分由对面积为 $r_i \\Delta r \\Delta \\phi$ 的离散网格元上的和来近似：\n$$\nN_{\\ell n} \\approx \\sum_{i=0}^{N_r-1} \\sum_{j=0}^{N_\\phi-1} |\\Psi_{\\ell n}(r_i, \\phi_j)|^2 \\, r_i \\Delta r \\Delta \\phi\n$$\n5. 对于每个指定的时间 $t$，计算时间函数 $s(t)$ 和 $\\alpha(t)$ 的值。\n6. 在网格上构建源场 $E_z^{\\text{port}}(r_i, \\phi_j, t)$。\n7. 通过数值评估内积积分来计算投影系数的分子：\n$$\n\\text{num}_{\\ell n}(t) = \\sum_{i=0}^{N_r-1} \\sum_{j=0}^{N_\\phi-1} E_z^{\\text{port}}(r_i, \\phi_j, t) \\, \\Psi_{\\ell n}^*(r_i, \\phi_j) \\, r_i \\Delta r \\Delta \\phi\n$$\n8. 计算系数 $c_{\\ell n}(t) = \\text{num}_{\\ell n}(t) / N_{\\ell n}$ 和 $c_{\\ell_\\textalt n_\\textalt}(t) = \\text{num}_{\\ell_\\textalt n_\\textalt}(t) / N_{\\ell_\\textalt n_\\textalt}$。\n9. 最后，使用数值确定的系数的模的平方来计算纯度 $P(t)$。\n\n当用足够的数值精度（$N_r, N_\\phi$）实现此过程时，其结果将收敛于解析表达式 $P(t) = 1/(1 + \\alpha(t)^2)$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import jv, jn_zeros\n\ndef solve():\n    \"\"\"\n    Main function to run the test cases and compute modal purity.\n    \"\"\"\n    test_cases = [\n        # Test Case 1 (happy path)\n        {\n            \"a\": 0.02, \"l\": 1, \"n\": 1, \"l_alt\": 2, \"n_alt\": 1, \"Nr\": 200, \"Nphi\": 128,\n            \"t0\": 5e-9, \"sigma\": 0.8e-9, \"sigma_alpha\": 0.5e-9, \"alpha0\": 0.1\n        },\n        # Test Case 2 (boundary condition with l=0)\n        {\n            \"a\": 0.015, \"l\": 0, \"n\": 1, \"l_alt\": 1, \"n_alt\": 1, \"Nr\": 180, \"Nphi\": 64,\n            \"t0\": 4e-9, \"sigma\": 0.7e-9, \"sigma_alpha\": 0.35e-9, \"alpha0\": 0.05\n        },\n        # Test Case 3 (larger contamination to test robustness)\n        {\n            \"a\": 0.01, \"l\": 3, \"n\": 1, \"l_alt\": 5, \"n_alt\": 1, \"Nr\": 220, \"Nphi\": 48,\n            \"t0\": 6e-9, \"sigma\": 1.0e-9, \"sigma_alpha\": 0.6e-9, \"alpha0\": 0.2\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        # Corrected a typo in the original key where n_alt had a hyphen.\n        if \"n_alt\" not in case and \"n-alt\" in case:\n            case[\"n_alt\"] = case.pop(\"n-alt\")\n        results_for_case = compute_purity_for_case(case)\n        all_results.extend(results_for_case)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.12f}' for r in all_results)}]\")\n\ndef compute_purity_for_case(params):\n    \"\"\"\n    Computes modal purity P(t) for a single test case at specified times.\n    \"\"\"\n    # Extract parameters\n    a = params[\"a\"]\n    l, n = params[\"l\"], params[\"n\"]\n    l_alt, n_alt = params[\"l_alt\"], params[\"n_alt\"]\n    Nr, Nphi = params[\"Nr\"], params[\"Nphi\"]\n    t0, sigma, sigma_alpha, alpha0 = params[\"t0\"], params[\"sigma\"], params[\"sigma_alpha\"], params[\"alpha0\"]\n\n    # 1. Grid Generation\n    r = np.linspace(0, a, Nr)\n    phi = np.linspace(0, 2 * np.pi, Nphi, endpoint=False)\n    dr = a / (Nr - 1)\n    dphi = 2 * np.pi / Nphi\n\n    # Use meshgrid for vectorized operations\n    R, PHI = np.meshgrid(r, phi, indexing='ij')\n\n    # 2. Bessel Zeros\n    chi_ln = jn_zeros(l, n)[n-1]\n    chi_alt = jn_zeros(l_alt, n_alt)[n_alt-1]\n\n    # 3. Construct Basis Functions\n    Psi_ln = jv(l, chi_ln / a * R) * np.exp(1j * l * PHI)\n    Psi_alt = jv(l_alt, chi_alt / a * R) * np.exp(1j * l_alt * PHI)\n\n    # 4. Normalization Constants (via numerical integration)\n    integrand_ln = np.abs(Psi_ln)**2 * R\n    N_ln = np.sum(integrand_ln) * dr * dphi\n    \n    integrand_alt = np.abs(Psi_alt)**2 * R\n    N_alt = np.sum(integrand_alt) * dr * dphi\n\n    # Define time samples\n    times = [t0 - 2 * sigma, t0, t0 + 2 * sigma]\n    \n    purities = []\n    for t in times:\n        # 5. Temporal Functions\n        s_t = np.exp(-(t - t0)**2 / (2 * sigma**2))\n        alpha_t = alpha0 * np.exp(-(t - t0)**2 / (2 * sigma_alpha**2))\n\n        # 6. Source Field\n        Ez_port = s_t * (Psi_ln + alpha_t * Psi_alt)\n\n        # 7. Numerators of Projection Coefficients\n        num_c_ln = np.sum(Ez_port * np.conj(Psi_ln) * R) * dr * dphi\n        num_c_alt = np.sum(Ez_port * np.conj(Psi_alt) * R) * dr * dphi\n\n        # 8. Projection Coefficients\n        # Handle potential division by zero if N is zero (though unlikely)\n        c_ln = num_c_ln / N_ln if N_ln != 0 else 0\n        c_alt = num_c_alt / N_alt if N_alt != 0 else 0\n        \n        # 9. Purity Calculation\n        abs_c_ln_sq = np.abs(c_ln)**2\n        abs_c_alt_sq = np.abs(c_alt)**2\n        \n        denominator = abs_c_ln_sq + abs_c_alt_sq\n        purity = abs_c_ln_sq / denominator if denominator != 0 else 1.0\n        \n        purities.append(purity)\n        \n    return purities\n\n# A small correction to handle the typo in the provided XML's test case 3 key.\n# The `solve` function is modified to be robust against this.\ndef solve_robust():\n    \"\"\"\n    Main function to run the test cases and compute modal purity.\n    This version is robust to the typo 'n-alt' in the original XML.\n    \"\"\"\n    test_cases = [\n        # Test Case 1 (happy path)\n        {\n            \"a\": 0.02, \"l\": 1, \"n\": 1, \"l_alt\": 2, \"n_alt\": 1, \"Nr\": 200, \"Nphi\": 128,\n            \"t0\": 5e-9, \"sigma\": 0.8e-9, \"sigma_alpha\": 0.5e-9, \"alpha0\": 0.1\n        },\n        # Test Case 2 (boundary condition with l=0)\n        {\n            \"a\": 0.015, \"l\": 0, \"n\": 1, \"l_alt\": 1, \"n_alt\": 1, \"Nr\": 180, \"Nphi\": 64,\n            \"t0\": 4e-9, \"sigma\": 0.7e-9, \"sigma_alpha\": 0.35e-9, \"alpha0\": 0.05\n        },\n        # Test Case 3 (larger contamination to test robustness)\n        {\n            \"a\": 0.01, \"l\": 3, \"n\": 1, \"l_alt\": 5, \"n_alt\": 1, \"Nr\": 220, \"Nphi\": 48,\n            \"t0\": 6e-9, \"sigma\": 1.0e-9, \"sigma_alpha\": 0.6e-9, \"alpha0\": 0.2\n        }\n    ]\n\n    all_results = []\n    for case in test_cases:\n        results_for_case = compute_purity_for_case(case)\n        all_results.extend(results_for_case)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.12f}' for r in all_results)}]\")\n\n# The provided XML in the user prompt has 'n_alt-1' typo. \n# The local solve call should be robust to this. The provided answer code is fixed to use the correct key 'n_alt'.\n# I will fix the prompt in the final output. The python code is fine as is.\nsolve_robust()\n```", "id": "3342257"}]}