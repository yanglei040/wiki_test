{"hands_on_practices": [{"introduction": "要理解显式动力学分析的稳定性，我们首先需要掌握其基本原理。这个练习将指导你完成一个基础的稳定性分析过程。通过一个简单的双自由度系统，你将为中心差分法推导出显式递推关系，并通过分析其放大矩阵的特征值来判断其稳定性。这项实践旨在巩固系统的物理属性（质量和刚度）、其最高固有频率（$\\omega_{\\max}$）与保证数值模拟稳定的最大允许时间步长（$\\Delta t_{\\text{crit}}$）之间的核心联系。", "problem": "一个无阻尼、线性的两自由度（DOF）土柱剪切模型由质量矩阵 $\\mathbf{M}$ 和刚度矩阵 $\\mathbf{K}$ 表示，这两个矩阵是通过对一维剪切连续体进行一致离散化得到的。设平移自由度集中在位移向量 $\\mathbf{u}(t) \\in \\mathbb{R}^{2}$ 中。忽略外力，考虑由牛顿第二定律控制的自由振动。\n\n数据如下：\n- 质量矩阵 $\\mathbf{M} = \\mathrm{diag}(m_{1}, m_{2})$，其中 $m_{1} = 2000~\\mathrm{kg}$ 且 $m_{2} = 1000~\\mathrm{kg}$。\n- 刚度矩阵 $\\mathbf{K} = \\begin{bmatrix} k_{1}+k_{2}  -k_{2} \\\\ -k_{2}  k_{2} \\end{bmatrix}$，其中 $k_{1} = 1.0 \\times 10^{7}~\\mathrm{N/m}$ 且 $k_{2} = 5.0 \\times 10^{6}~\\mathrm{N/m}$。\n\n您使用中心差分法在时间上进行离散化，其中时间二阶导数由在均匀时间步长 $\\Delta t$ 上的中心有限差分来近似。\n\n任务：\n1. 从 $\\mathbf{M}\\,\\ddot{\\mathbf{u}}(t) + \\mathbf{K}\\,\\mathbf{u}(t) = \\mathbf{0}$ 和 $\\ddot{\\mathbf{u}}(t)$ 的中心差分近似出发，写出用 $\\mathbf{u}_{n}$ 和 $\\mathbf{u}_{n-1}$ 表示 $\\mathbf{u}_{n+1}$ 的显式两步递推关系，并构建与状态向量 $\\mathbf{y}_{n} = \\begin{bmatrix} \\mathbf{u}_{n} \\\\ \\mathbf{u}_{n-1} \\end{bmatrix}$ 相关联的 $4 \\times 4$ 放大矩阵 $\\mathbf{G}(\\Delta t)$。\n2. 通过变换到广义特征值问题 $\\mathbf{K}\\boldsymbol{\\phi} = \\omega^{2}\\mathbf{M}\\boldsymbol{\\phi}$ 的模态基，用模态圆频率 $\\omega_{j}$ 和时间步长 $\\Delta t$ 计算 $\\mathbf{G}(\\Delta t)$ 的特征值。明确说明每个模态得到的两个特征值。\n3. 使用给定的 $\\mathbf{M}$ 和 $\\mathbf{K}$，计算模态圆频率 $\\omega_{1}$ 和 $\\omega_{2}$，并确定最大圆频率 $\\omega_{\\max}$。\n4. 从中心差分稳定性条件的第一性原理出发，确定作为 $\\omega_{\\max}$ 函数的临界时间步长 $\\Delta t_{\\text{crit}}$，然后对给定系统进行数值计算。\n\n将您关于 $\\Delta t_{\\text{crit}}$ 的最终答案四舍五入到四位有效数字，并以秒为单位表示。只提供 $\\Delta t_{\\text{crit}}$ 的数值作为您的最终答案。", "solution": "用户提供了一个问题，要求对一个使用中心差分法进行时间离散化的两自由度（2-DOF）系统的数值稳定性进行分析。\n\n### 步骤 1：问题陈述的验证\n该问题是适定的，并且在科学上是合理的。\n*   **提取的已知条件：**\n    *   控制方程：$\\mathbf{M}\\,\\ddot{\\mathbf{u}}(t) + \\mathbf{K}\\,\\mathbf{u}(t) = \\mathbf{0}$，适用于一个无阻尼、线性的 2-DOF 系统。\n    *   质量矩阵：$\\mathbf{M} = \\mathrm{diag}(m_{1}, m_{2})$，其中 $m_{1} = 2000~\\mathrm{kg}$ 且 $m_{2} = 1000~\\mathrm{kg}$。\n    *   刚度矩阵：$\\mathbf{K} = \\begin{bmatrix} k_{1}+k_{2}  -k_{2} \\\\ -k_{2}  k_{2} \\end{bmatrix}$，其中 $k_{1} = 1.0 \\times 10^{7}~\\mathrm{N/m}$ 且 $k_{2} = 5.0 \\times 10^{6}~\\mathrm{N/m}$。\n    *   时间离散化方法：中心差分法，具有均匀时间步长 $\\Delta t$。\n    *   状态向量：$\\mathbf{y}_{n} = \\begin{bmatrix} \\mathbf{u}_{n} \\\\ \\mathbf{u}_{n-1} \\end{bmatrix}$。\n*   **验证结论：**\n    *   该问题具有科学依据，根植于经典力学和微分方程的标准数值分析。\n    *   它是适定的，为求得唯一解提供了所有必要的数据。\n    *   语言客观、精确。\n    *   因此，该问题被认定为**有效**。\n\n### 步骤 2：详细解答\n解答过程将通过完成问题陈述中列出的四个任务来进行。\n\n**任务 1：显式递推关系与放大矩阵**\n\n系统的控制运动方程为：\n$$\n\\mathbf{M}\\,\\ddot{\\mathbf{u}}(t) + \\mathbf{K}\\,\\mathbf{u}(t) = \\mathbf{0}\n$$\n我们在时间上进行离散化，令 $t = t_n = n \\Delta t$，其中 $\\Delta t$ 是时间步长。在时间 $t_n$ 的位移向量表示为 $\\mathbf{u}_n = \\mathbf{u}(t_n)$。时间二阶导数 $\\ddot{\\mathbf{u}}(t_n) = \\ddot{\\mathbf{u}}_n$ 使用二阶中心差分公式进行近似：\n$$\n\\ddot{\\mathbf{u}}_n \\approx \\frac{\\mathbf{u}_{n+1} - 2\\mathbf{u}_n + \\mathbf{u}_{n-1}}{(\\Delta t)^2}\n$$\n将此近似代入控制方程可得：\n$$\n\\mathbf{M} \\left( \\frac{\\mathbf{u}_{n+1} - 2\\mathbf{u}_n + \\mathbf{u}_{n-1}}{(\\Delta t)^2} \\right) + \\mathbf{K}\\,\\mathbf{u}_n = \\mathbf{0}\n$$\n为求得 $\\mathbf{u}_{n+1}$ 的显式递推关系，我们重新整理各项：\n$$\n\\mathbf{M}\\,\\mathbf{u}_{n+1} - 2\\mathbf{M}\\,\\mathbf{u}_n + \\mathbf{M}\\,\\mathbf{u}_{n-1} + (\\Delta t)^2 \\mathbf{K}\\,\\mathbf{u}_n = \\mathbf{0}\n$$\n$$\n\\mathbf{M}\\,\\mathbf{u}_{n+1} = (2\\mathbf{M} - (\\Delta t)^2 \\mathbf{K})\\,\\mathbf{u}_n - \\mathbf{M}\\,\\mathbf{u}_{n-1}\n$$\n由于 $\\mathbf{M}$ 是一个对角矩阵，它是可逆的。左乘 $\\mathbf{M}^{-1}$ 得到显式两步递推关系：\n$$\n\\mathbf{u}_{n+1} = \\mathbf{M}^{-1}(2\\mathbf{M} - (\\Delta t)^2 \\mathbf{K})\\,\\mathbf{u}_n - \\mathbf{M}^{-1}\\mathbf{M}\\,\\mathbf{u}_{n-1}\n$$\n$$\n\\mathbf{u}_{n+1} = (2\\mathbf{I} - (\\Delta t)^2 \\mathbf{M}^{-1}\\mathbf{K})\\,\\mathbf{u}_n - \\mathbf{I}\\,\\mathbf{u}_{n-1}\n$$\n其中 $\\mathbf{I}$ 是 $2 \\times 2$ 单位矩阵。\n\n接下来，我们构建 $4 \\times 4$ 的放大矩阵 $\\mathbf{G}(\\Delta t)$。在第 $n$ 步的状态向量为 $\\mathbf{y}_{n} = \\begin{bmatrix} \\mathbf{u}_{n} \\\\ \\mathbf{u}_{n-1} \\end{bmatrix}$。在第 $n+1$ 步的状态向量为 $\\mathbf{y}_{n+1} = \\begin{bmatrix} \\mathbf{u}_{n+1} \\\\ \\mathbf{u}_{n} \\end{bmatrix}$。我们寻找矩阵 $\\mathbf{G}$ 使得 $\\mathbf{y}_{n+1} = \\mathbf{G}\\,\\mathbf{y}_{n}$。\n使用推导出的递推关系作为 $\\mathbf{y}_{n+1}$ 的上半部分，并使用一个恒等式作为下半部分，我们可以写出：\n$$\n\\begin{bmatrix} \\mathbf{u}_{n+1} \\\\ \\mathbf{u}_{n} \\end{bmatrix} = \\begin{bmatrix} 2\\mathbf{I} - (\\Delta t)^2 \\mathbf{M}^{-1}\\mathbf{K}  -\\mathbf{I} \\\\ \\mathbf{I}  \\mathbf{0} \\end{bmatrix} \\begin{bmatrix} \\mathbf{u}_{n} \\\\ \\mathbf{u}_{n-1} \\end{bmatrix}\n$$\n因此，放大矩阵为：\n$$\n\\mathbf{G}(\\Delta t) = \\begin{bmatrix} 2\\mathbf{I} - (\\Delta t)^2 \\mathbf{M}^{-1}\\mathbf{K}  -\\mathbf{I} \\\\ \\mathbf{I}  \\mathbf{0} \\end{bmatrix}\n$$\n\n**任务 2：放大矩阵的特征值**\n\n为了求出 $4 \\times 4$ 矩阵 $\\mathbf{G}$ 的特征值，我们变换到模态基。广义特征值问题为 $\\mathbf{K}\\boldsymbol{\\phi}_j = \\omega_j^2 \\mathbf{M}\\boldsymbol{\\phi}_j$，其中 $\\omega_j$ 和 $\\boldsymbol{\\phi}_j$ 分别是第 $j$ 阶自振圆频率和振型。这可以改写为 $\\mathbf{M}^{-1}\\mathbf{K}\\boldsymbol{\\phi}_j = \\omega_j^2 \\boldsymbol{\\phi}_j$。\n让我们通过用模态坐标 $q_j(t)$ 表示位移来解耦系统，即 $\\mathbf{u}(t) = \\sum_{j=1}^{2} \\boldsymbol{\\phi}_j q_j(t)$。对于单个模态 $j$，递推关系变为：\n$$\n\\boldsymbol{\\phi}_j q_{j, n+1} = (2\\mathbf{I} - (\\Delta t)^2 \\mathbf{M}^{-1}\\mathbf{K})\\boldsymbol{\\phi}_j q_{j, n} - \\mathbf{I}\\boldsymbol{\\phi}_j q_{j, n-1}\n$$\n使用特征值性质 $\\mathbf{M}^{-1}\\mathbf{K}\\boldsymbol{\\phi}_j = \\omega_j^2 \\boldsymbol{\\phi}_j$：\n$$\n\\boldsymbol{\\phi}_j q_{j, n+1} = (2\\boldsymbol{\\phi}_j - (\\Delta t)^2 \\omega_j^2 \\boldsymbol{\\phi}_j) q_{j, n} - \\boldsymbol{\\phi}_j q_{j, n-1}\n$$\n由于 $\\boldsymbol{\\phi}_j \\neq \\mathbf{0}$，我们可以两边同除以它，得到第 $j$ 阶模态坐标的标量递推关系：\n$$\nq_{j, n+1} = (2 - (\\omega_j \\Delta t)^2) q_{j, n} - q_{j, n-1}\n$$\n该模态的状态向量为 $\\mathbf{z}_{j,n} = \\begin{bmatrix} q_{j,n} \\\\ q_{j,n-1} \\end{bmatrix}$，其递推关系由 $2 \\times 2$ 的模态放大矩阵 $\\mathbf{G}_j$ 控制：\n$$\n\\mathbf{z}_{j, n+1} = \\begin{bmatrix} q_{j, n+1} \\\\ q_{j, n} \\end{bmatrix} = \\begin{bmatrix} 2 - (\\omega_j \\Delta t)^2  -1 \\\\ 1  0 \\end{bmatrix} \\begin{bmatrix} q_{j, n} \\\\ q_{j, n-1} \\end{bmatrix} = \\mathbf{G}_j \\mathbf{z}_{j,n}\n$$\n$\\mathbf{G}_j$ 的特征值 $\\lambda$ 可通过其特征方程 $\\det(\\mathbf{G}_j - \\lambda\\mathbf{I}) = 0$ 求得：\n$$\n\\det \\begin{pmatrix} 2 - (\\omega_j \\Delta t)^2 - \\lambda  -1 \\\\ 1  -\\lambda \\end{pmatrix} = (-\\lambda)(2 - (\\omega_j \\Delta t)^2 - \\lambda) - (-1)(1) = 0\n$$\n$$\n\\lambda^2 - (2 - (\\omega_j \\Delta t)^2) \\lambda + 1 = 0\n$$\n解此关于 $\\lambda$ 的二次方程，得到模态 $j$ 的两个特征值：\n$$\n\\lambda_{j,1,2} = \\frac{(2 - (\\omega_j \\Delta t)^2) \\pm \\sqrt{(2 - (\\omega_j \\Delta t)^2)^2 - 4}}{2}\n$$\n该表达式可以简化为：\n$$\n\\lambda_{j,1,2} = \\frac{2 - (\\omega_j \\Delta t)^2 \\pm \\sqrt{(\\omega_j \\Delta t)^4 - 4(\\omega_j \\Delta t)^2}}{2}\n$$\n\n**任务 3：模态频率**\n\n我们需要求解广义特征值问题 $\\det(\\mathbf{K} - \\omega^2 \\mathbf{M}) = 0$。\n给定的矩阵为：\n$$\n\\mathbf{M} = \\begin{bmatrix} 2000  0 \\\\ 0  1000 \\end{bmatrix}~\\text{kg}\n$$\n$$\n\\mathbf{K} = \\begin{bmatrix} 1.0 \\times 10^7 + 5.0 \\times 10^6  -5.0 \\times 10^6 \\\\ -5.0 \\times 10^6  5.0 \\times 10^6 \\end{bmatrix}~\\text{N/m} = \\begin{bmatrix} 15 \\times 10^6  -5 \\times 10^6 \\\\ -5 \\times 10^6  5 \\times 10^6 \\end{bmatrix}~\\text{N/m}\n$$\n令 $\\lambda_{eig} = \\omega^2$。特征方程为：\n$$\n\\det \\begin{pmatrix} 15 \\times 10^6 - 2000\\lambda_{eig}  -5 \\times 10^6 \\\\ -5 \\times 10^6  5 \\times 10^6 - 1000\\lambda_{eig} \\end{pmatrix} = 0\n$$\n$$\n(15 \\times 10^6 - 2000\\lambda_{eig})(5 \\times 10^6 - 1000\\lambda_{eig}) - (5 \\times 10^6)^2 = 0\n$$\n$75 \\times 10^{12} - 15 \\times 10^9 \\lambda_{eig} - 10 \\times 10^9 \\lambda_{eig} + 2 \\times 10^6 \\lambda_{eig}^2 - 25 \\times 10^{12} = 0$\n$2 \\times 10^6 \\lambda_{eig}^2 - 25 \\times 10^9 \\lambda_{eig} + 50 \\times 10^{12} = 0$\n两边同除以 $2 \\times 10^6$：\n$$\n\\lambda_{eig}^2 - 12500 \\lambda_{eig} + 25 \\times 10^6 = 0\n$$\n解此关于 $\\lambda_{eig} = \\omega^2$ 的二次方程：\n$$\n\\omega^2 = \\frac{12500 \\pm \\sqrt{(-12500)^2 - 4(1)(25 \\times 10^6)}}{2} = \\frac{12500 \\pm \\sqrt{156.25 \\times 10^6 - 100 \\times 10^6}}{2}\n$$\n$$\n\\omega^2 = \\frac{12500 \\pm \\sqrt{56.25 \\times 10^6}}{2} = \\frac{12500 \\pm 7500}{2}\n$$\n$\\omega^2$ 的两个解是：\n$$\n\\omega_1^2 = \\frac{12500 - 7500}{2} = \\frac{5000}{2} = 2500~(\\text{rad/s})^2\n$$\n$$\n\\omega_2^2 = \\frac{12500 + 7500}{2} = \\frac{20000}{2} = 10000~(\\text{rad/s})^2\n$$\n相应的圆频率是：\n$$\n\\omega_1 = \\sqrt{2500} = 50~\\text{rad/s}\n$$\n$$\n\\omega_2 = \\sqrt{10000} = 100~\\text{rad/s}\n$$\n最大圆频率为 $\\omega_{\\max} = \\omega_2 = 100~\\text{rad/s}$。\n\n**任务 4：临界时间步长**\n\n中心差分法是数值稳定的，当且仅当放大矩阵 $\\mathbf{G}$ 的谱半径小于或等于 1，即 $\\rho(\\mathbf{G}) \\le 1$。谱半径是 $\\mathbf{G}$ 特征值绝对值的最大值。$\\mathbf{G}$ 的特征值是所有模态放大矩阵 $\\mathbf{G}_j$ 特征值的集合。\n让我们分析 $\\lambda_{j,1,2}$ 的模。\n如果 $\\lambda_j$ 表达式中平方根下的项为负，即 $(\\omega_j \\Delta t)^2 - 4  0 \\implies \\omega_j \\Delta t  2$，则特征值为一对共轭复数。它们的模为：\n$$\n|\\lambda_j|^2 = \\left(\\frac{2 - (\\omega_j \\Delta t)^2}{2}\\right)^2 + \\left(\\frac{\\sqrt{4 - (\\omega_j \\Delta t)^2}}{2}\\right)^2 = \\frac{4 - 4(\\omega_j \\Delta t)^2 + (\\omega_j \\Delta t)^4 + 4 - (\\omega_j \\Delta t)^2}{4} = 1\n$$\n在这种情况下， $|\\lambda_j| = 1$，格式是稳定的。\n如果 $(\\omega_j \\Delta t)^2 - 4 \\ge 0 \\implies \\omega_j \\Delta t \\ge 2$，则特征值为实数。当 $\\omega_j \\Delta t = 2$ 时，特征值为 $\\lambda_{j,1,2} = -1$。对于 $\\omega_j \\Delta t > 2$，特征值的乘积为 $\\lambda_{j,1}\\lambda_{j,2} = 1$。由于它们是实数且不相等，其中一个的模必定大于 1，从而导致指数增长和数值不稳定性。\n因此，稳定性条件要求对于所有模态 $j$：\n$$\n\\omega_j \\Delta t \\le 2\n$$\n该条件必须对系统中的最高频率成立，以确保对所有频率都成立。因此，稳定性由 $\\omega_{\\max}$ 决定：\n$$\n\\omega_{\\max} \\Delta t \\le 2\n$$\n临界时间步长 $\\Delta t_{\\text{crit}}$ 是使该方法保持稳定的 $\\Delta t$ 的最大可能值。这在不等式的临界点找到：\n$$\n\\Delta t_{\\text{crit}} = \\frac{2}{\\omega_{\\max}}\n$$\n使用在任务 3 中计算出的 $\\omega_{\\max} = 100~\\text{rad/s}$ 的值：\n$$\n\\Delta t_{\\text{crit}} = \\frac{2}{100} = 0.02~\\text{s}\n$$\n问题要求答案四舍五入到四位有效数字。即 $0.02000~\\text{s}$。用标准科学记数法表示，此值为 $2.000 \\times 10^{-2}$。", "answer": "$$\n\\boxed{2.000 \\times 10^{-2}}\n$$", "id": "3562330"}, {"introduction": "在有限元方法（FEM）中，建模选择会直接影响稳定性，其中“质量集中”是显式动力学中一种常见且高效的技术。这个问题 [@problem_id:3562349] 使用一维周期性杆模型，引导你通过解析方法研究质量集中的影响。你将使用布洛赫波分析（Bloch-wave analysis）来推导一致质量和集中质量两种公式下的色散关系，从而揭示这两种方法是如何近似波传播的。这项练习从根本上解释了为什么质量集中虽然是一种近似，但在显式计算中却备受青睐：它降低了系统的最高频率，从而允许使用更大、更经济的时间步长。", "problem": "一根长度为 $L$ 的一维弹性杆，使用 $N$ 个尺寸为 $h = L/N$ 的均匀双节点线性单元，通过有限元法 (FEM) 进行建模。该杆的杨氏模量为 $E$，质量密度为 $\\rho$，横截面积为 $A$。通过在网格上施加周期性边界条件（即网格无限重复），将该杆理想化为一个无限周期点阵，使其半离散运动方程具有以下形式\n$$\n\\mathbf{M}\\,\\ddot{\\mathbf{u}}(t) + \\mathbf{K}\\,\\mathbf{u}(t) = \\mathbf{0},\n$$\n其中 $\\mathbf{K}$ 是由标准线性杆单元组装的刚度矩阵，$\\mathbf{M}$ 是组装后的一致质量矩阵 $\\mathbf{M}_{\\mathrm{c}}$ 或集中（行和）质量矩阵 $\\mathbf{M}_{\\mathrm{l}}$。你需要分析质量集中对半离散系统最大固有圆频率 $\\omega_{\\max}$ 的影响，并从第一性原理出发，推断其对显式中心差分格式稳定性极限的影响。\n\n仅从适用于所述背景的第一性原理和核心定义出发，按以下步骤进行：对节点索引 $j \\in \\mathbb{Z}$ 使用布洛赫波拟设 $u_j(t) = U(t)\\,\\mathrm{e}^{\\mathrm{i}k j h}$，为离散波数 $k \\in [0,\\pi/h]$ 写出广义特征值问题。求出与 $\\mathbf{M}_{\\mathrm{c}}$ 和 $\\mathbf{M}_{\\mathrm{l}}$ 相关联的色散关系 $\\omega(k)$，并确定在第一布里渊区内的相应 $\\omega_{\\max}$。然后，对于频率为 $\\omega$ 的单个无阻尼模态，推导显式中心差分格式的稳定性条件，并推断将 $\\mathbf{M}_{\\mathrm{c}}$ 替换为 $\\mathbf{M}_{\\mathrm{l}}$ 如何改变显式临界时间步长 $\\Delta t_{\\mathrm{cr}}$。\n\n哪个陈述是正确的？\n\nA. 将 $\\mathbf{M}_{\\mathrm{c}}$ 替换为 $\\mathbf{M}_{\\mathrm{l}}$ 会使 $\\omega_{\\max}$ 严格增加 $\\sqrt{3}$ 倍，从而使 $\\Delta t_{\\mathrm{cr}}$ 减少相同的倍数。\n\nB. 在周期性杆中，将 $\\mathbf{M}_{\\mathrm{c}}$ 替换为 $\\mathbf{M}_{\\mathrm{l}}$ 会使 $\\omega_{\\max}$ 从 $\\sqrt{12}\\,c/h$ 严格减少到 $2\\,c/h$，从而使 $\\Delta t_{\\mathrm{cr}}$ 增加 $\\sqrt{3}$ 倍，其中 $c = \\sqrt{E/\\rho}$ 是弹性波速。\n\nC. $\\omega_{\\max}$ 不受质量集中的影响而改变；然而，隐式 Newmark 方法会变得不稳定，除非 $\\Delta t \\le 2/\\omega_{\\max}$。\n\nD. 质量集中会同时减少 $\\omega_{\\max}$ 和临界时间步长，因为对角占优使得系统更刚硬。", "solution": "问题陈述是有效的，因为它涉及计算力学中一个标准的、适定的问题，并且在科学上是合理的。我们按照指示从第一性原理开始推导。\n\n一个长度为 $h$、杨氏模量为 $E$、密度为 $\\rho$、面积为 $A$ 的双节点线性弹性杆单元具有以下单元刚度矩阵和质量矩阵。刚度矩阵为：\n$$ \\mathbf{K}^e = \\frac{EA}{h} \\begin{bmatrix} 1  -1 \\\\ -1  1 \\end{bmatrix} $$\n一致质量矩阵是从单元形函数推导出来的，由下式给出：\n$$ \\mathbf{M}_{\\mathrm{c}}^e = \\frac{\\rho A h}{6} \\begin{bmatrix} 2  1 \\\\ 1  2 \\end{bmatrix} $$\n集中质量矩阵是通过对一致质量矩阵的行求和并将结果放在对角线上（行和集中）得到的，这等效于将单元质量 $\\rho A h$ 平均分配到其两个节点上：\n$$ \\mathbf{M}_{\\mathrm{l}}^e = \\frac{\\rho A h}{2} \\begin{bmatrix} 1  0 \\\\ 0  1 \\end{bmatrix} $$\n\n对于由这些单元组成的无限周期点阵，一个通用节点 $j$ 的运动方程是由单元 $(j-1, j)$ 和单元 $(j, j+1)$ 的贡献组装而成的。\n控制半离散方程为 $\\mathbf{M}\\,\\ddot{\\mathbf{u}} + \\mathbf{K}\\,\\mathbf{u} = \\mathbf{0}$。对于节点 $j$，这可以转化为：\n$$ \\sum_l M_{jl} \\ddot{u}_l(t) + \\sum_l K_{jl} u_l(t) = 0 $$\n组装节点 $j$ 的刚度项：\n$$ (K u)_j = \\frac{EA}{h}(-u_{j-1} + 2u_j - u_{j+1}) $$\n使用一致质量矩阵 $\\mathbf{M}_{\\mathrm{c}}$ 组装节点 $j$ 的惯性项：\n$$ (M_c \\ddot{u})_j = \\frac{\\rho A h}{6}(\\ddot{u}_{j-1} + 4\\ddot{u}_j + \\ddot{u}_{j+1}) $$\n使用集中质量矩阵 $\\mathbf{M}_{\\mathrm{l}}$：\n$$ (M_l \\ddot{u})_j = (\\frac{\\rho A h}{2} + \\frac{\\rho A h}{2})\\ddot{u}_j = \\rho A h \\ddot{u}_j $$\n\n我们寻求形式为 $u_j(t) = U_0 \\mathrm{e}^{\\mathrm{i}(k j h - \\omega t)}$ 的平面波解（布洛赫波）。将此拟设代入节点 $j$ 的运动方程，并消去公因子 $U_0 \\mathrm{e}^{\\mathrm{i}(k j h - \\omega t)}$，即可得到色散关系 $\\omega(k)$。\n注意到 $u_{j\\pm 1}(t) = u_j(t) \\mathrm{e}^{\\pm \\mathrm{i} k h}$ 且 $\\ddot{u}_j(t) = -\\omega^2 u_j(t)$。\n\n对于一致质量矩阵情况（$\\mathbf{M}_{\\mathrm{c}}$）：\n$$ -\\omega_{\\mathrm{c}}^2 \\frac{\\rho A h}{6}(\\mathrm{e}^{-\\mathrm{i}kh} + 4 + \\mathrm{e}^{\\mathrm{i}kh}) + \\frac{EA}{h}(-\\mathrm{e}^{-\\mathrm{i}kh} + 2 - \\mathrm{e}^{\\mathrm{i}kh}) = 0 $$\n使用 $\\mathrm{e}^{\\mathrm{i}\\theta} + \\mathrm{e}^{-\\mathrm{i}\\theta} = 2\\cos(\\theta)$，我们得到：\n$$ -\\omega_{\\mathrm{c}}^2 \\frac{\\rho A h}{6}(4 + 2\\cos(kh)) + \\frac{EA}{h}(2 - 2\\cos(kh)) = 0 $$\n$$ \\omega_{\\mathrm{c}}^2 \\frac{\\rho A h}{3}(2 + \\cos(kh)) = \\frac{2EA}{h}(1 - \\cos(kh)) $$\n求解 $\\omega_{\\mathrm{c}}^2$ 并使用连续介质弹性波速的定义 $c = \\sqrt{E/\\rho}$：\n$$ \\omega_{\\mathrm{c}}^2(k) = \\frac{6EA}{\\rho A h^2} \\frac{1 - \\cos(kh)}{2 + \\cos(kh)} = \\frac{6c^2}{h^2} \\frac{1 - \\cos(kh)}{2 + \\cos(kh)} $$\n最大频率 $\\omega_{\\max}$ 出现在第一布里渊区的边界，即 $k = \\pi/h$ 处。在此波数下，$kh=\\pi$ 且 $\\cos(kh)=-1$。\n$$ \\omega_{\\mathrm{c},\\max}^2 = \\frac{6c^2}{h^2} \\frac{1 - (-1)}{2 + (-1)} = \\frac{6c^2}{h^2} \\frac{2}{1} = \\frac{12c^2}{h^2} $$\n$$ \\omega_{\\mathrm{c},\\max} = \\sqrt{12} \\frac{c}{h} $$\n\n对于集中质量矩阵情况（$\\mathbf{M}_{\\mathrm{l}}$）：\n$$ -\\omega_{\\mathrm{l}}^2 (\\rho A h) + \\frac{EA}{h}(-\\mathrm{e}^{-\\mathrm{i}kh} + 2 - \\mathrm{e}^{\\mathrm{i}kh}) = 0 $$\n$$ -\\omega_{\\mathrm{l}}^2 \\rho A h + \\frac{2EA}{h}(1 - \\cos(kh)) = 0 $$\n$$ \\omega_{\\mathrm{l}}^2(k) = \\frac{2EA}{\\rho A h^2}(1 - \\cos(kh)) = \\frac{2c^2}{h^2}(1 - \\cos(kh)) $$\n再次，在 $k=\\pi/h$ 处求值：\n$$ \\omega_{\\mathrm{l},\\max}^2 = \\frac{2c^2}{h^2}(1 - (-1)) = \\frac{4c^2}{h^2} $$\n$$ \\omega_{\\mathrm{l},\\max} = 2 \\frac{c}{h} $$\n\n比较最大频率，我们可以看到，将一致质量矩阵替换为集中质量矩阵会降低半离散系统的最大固有频率。\n频率之比为 $\\omega_{\\mathrm{c},\\max} / \\omega_{\\mathrm{l},\\max} = (\\sqrt{12}c/h) / (2c/h) = \\sqrt{12}/2 = 2\\sqrt{3}/2 = \\sqrt{3}$。\n因此，质量集中使 $\\omega_{\\max}$ 减少了 $\\sqrt{3}$ 倍。\n\n接下来，我们分析显式中心差分格式的稳定性。对于单自由度振子 $\\ddot{u} + \\omega^2 u = 0$，该格式稳定的充要条件是 $\\omega \\Delta t \\le 2$。对于方程组，其稳定性由最高频率模态 $\\omega_{\\max}$ 控制。因此，临界时间步长 $\\Delta t_{\\mathrm{cr}}$ 为：\n$$ \\Delta t_{\\mathrm{cr}} = \\frac{2}{\\omega_{\\max}} $$\n这是半离散化系统的 Courant-Friedrichs-Lewy (CFL) 条件。\n\n使用推导出的 $\\omega_{\\max}$ 的值：\n对于一致质量矩阵：$\\Delta t_{\\mathrm{cr,c}} = \\frac{2}{\\omega_{\\mathrm{c},\\max}} = \\frac{2}{\\sqrt{12}c/h} = \\frac{2h}{2\\sqrt{3}c} = \\frac{h}{\\sqrt{3}c}$。\n对于集中质量矩阵：$\\Delta t_{\\mathrm{cr,l}} = \\frac{2}{\\omega_{\\mathrm{l},\\max}} = \\frac{2}{2c/h} = \\frac{h}{c}$。\n\n比较临界时间步长，我们发现将 $\\mathbf{M}_{\\mathrm{c}}$ 替换为 $\\mathbf{M}_{\\mathrm{l}}$ 时的变化：\n$$ \\frac{\\Delta t_{\\mathrm{cr,l}}}{\\Delta t_{\\mathrm{cr,c}}} = \\frac{h/c}{h/(\\sqrt{3}c)} = \\sqrt{3} $$\n因此，将一致质量矩阵替换为集中质量矩阵会使临界时间步长增加 $\\sqrt{3}$ 倍。\n\n现在我们评估给出的选项：\n\nA. 将 $\\mathbf{M}_{\\mathrm{c}}$ 替换为 $\\mathbf{M}_{\\mathrm{l}}$ 会使 $\\omega_{\\max}$ 严格增加 $\\sqrt{3}$ 倍，从而使 $\\Delta t_{\\mathrm{cr}}$ 减少相同的倍数。\n该陈述不正确。将 $\\mathbf{M}_{\\mathrm{c}}$ 替换为 $\\mathbf{M}_{\\mathrm{l}}$ 会*减少* $\\omega_{\\max}$，因此会*增加* $\\Delta t_{\\mathrm{cr}}$。\n\nB. 在周期性杆中，将 $\\mathbf{M}_{\\mathrm{c}}$ 替换为 $\\mathbf{M}_{\\mathrm{l}}$ 会使 $\\omega_{\\max}$ 从 $\\sqrt{12}\\,c/h$ 严格减少到 $2\\,c/h$，从而使 $\\Delta t_{\\mathrm{cr}}$ 增加 $\\sqrt{3}$ 倍，其中 $c = \\sqrt{E/\\rho}$ 是弹性波速。\n该陈述准确地反映了我们所有的发现。最大频率从 $\\omega_{\\mathrm{c},\\max} = \\sqrt{12}c/h$ 减少到 $\\omega_{\\mathrm{l},\\max} = 2c/h$。这导致临界时间步长 $\\Delta t_{\\mathrm{cr}}$ 增加了 $\\sqrt{3}$ 倍。$c$ 的定义也是正确的。\n\nC. $\\omega_{\\max}$ 不受质量集中的影响而改变；然而，隐式 Newmark 方法会变得不稳定，除非 $\\Delta t \\le 2/\\omega_{\\max}$。\n该陈述不正确。首先，$\\omega_{\\max}$ 会因质量集中而改变。其次，稳定性条件 $\\Delta t \\le 2/\\omega_{\\max}$ 适用于显式中心差分格式，而不适用于像无条件稳定的 Newmark 平均加速度法这样的常用隐式方法。\n\nD. 质量集中会同时减少 $\\omega_{\\max}$ 和临界时间步长，因为对角占优使得系统更刚硬。\n该陈述不正确。虽然质量集中确实减少了 $\\omega_{\\max}$，但它*增加*了临界时间步长 $\\Delta t_{\\mathrm{cr}}$。所提供的推理也是有缺陷的；一个具有较低 $\\omega_{\\max}$ 的系统在谱上被认为是“更软”的，而不是“更刚硬”的，从而允许使用更大的时间步长。\n\n基于分析的最终结论：选项 B 是唯一正确的陈述。\n\n基于以上推导的最终答案：\n- 将 $\\mathbf{M}_{\\mathrm{c}}$ 替换为 $\\mathbf{M}_{\\mathrm{l}}$ 将 $\\omega_{\\max}$ 从 $\\sqrt{12}\\,c/h$ 改变为 $2\\,c/h$。这是一个减少。\n- 这一变化使 $\\Delta t_{\\mathrm{cr}}$ 增加了 $\\sqrt{3}$ 倍。\n- 选项 B 正确地陈述了这些事实。\n\n最终验证：\n- $\\omega_{\\mathrm{c},\\max} = \\sqrt{12}\\,c/h$\n- $\\omega_{\\mathrm{l},\\max} = 2\\,c/h$\n- $\\omega_{\\mathrm{l},\\max}  \\omega_{\\mathrm{c},\\max}$ （减少）\n- $\\Delta t_{\\mathrm{cr,l}} / \\Delta t_{\\mathrm{cr,c}} = \\omega_{\\mathrm{c},\\max} / \\omega_{\\mathrm{l},\\max} = \\sqrt{3}$ （增加 $\\sqrt{3}$ 倍）\n分析和结论是可靠的。选项 B 是正确的。", "answer": "$$\\boxed{B}$$", "id": "3562349"}, {"introduction": "在真实的岩土力学模型中，网格很少是均匀的，这带来了工程上的关键挑战：如何在非均匀网格的显式模拟中管理时间步长。这个编程练习 [@problem_id:3562397] 要求你设计一个具有稳定性意识的自适应网格细化算法。你将根据给定的评分标准来细化网格，但同时要施加一个关键约束，以防止由少数过小单元引起的“时间步崩溃”（即全局稳定时间步的过度减小）。这个问题将理论分析提升到算法设计层面，教你如何应用 Courant-Friedrichs-Lewy（CFL）条件，为显式动力学开发智能高效的计算流程。", "problem": "您被要求为一维线性弹性动力学（计算岩土力学的典型代表）设计并实现一种考虑稳定性的网格加密策略。该策略能够在自适应选择时间步长的同时，选择在何处加密网格，以确保显式时间积分的稳定性，同时避免全局时间步坍缩。其基本原理包括牛顿第二定律、一维波传播模型以及用于显式时间积分的 Courant–Friedrichs–Lewy (CFL) 稳定性概念。在一个由索引 $i$ 标记单元格的一维网格中，每个单元格的长度为 $h_i$（单位：米），波速为 $c_i$（单位：米/秒），以及一个无量纲的加密分数 $s_i$，该分数表示对该单元格进行加密的期望程度。对于全局时间步长 $\\Delta t$（单位：秒），局部 Courant 数定义为 $\\theta_i = c_i \\Delta t / h_i$。显式稳定性的条件是，对于所有的 $i$，$\\theta_i$ 都存在一个上界，且该策略必须选择与此界限一致的最大 $\\Delta t$。为避免全局时间步坍缩，您需要强制施加一个约束，该约束限制了最小局部时间尺度 $\\tau_i = h_i / c_i$ 相对于整个网格时间尺度中位数的最小值。对一个单元格的加密操作最多将其 $h_i$ 减半一次（每个单元格只分裂一次），每次接受的加密都会从给定的加密预算中消耗一个单位。算法要求如下：\n\n- 每个测试用例的输入：列表 $[h_i]$（米）、$[c_i]$（米/秒）、$[s_i]$（无量纲加密分数）、最大允许 Courant 数 $\\theta_{\\max}$（无量纲）、避免坍缩的比率阈值 $\\beta$（无量纲），以及一个整数加密预算 $B \\ge 0$。\n\n- 算法使用的定义：\n  - 局部时间尺度为 $\\tau_i = h_i / c_i$（秒）。\n  - 坍缩比为 $r = \\min_i \\tau_i \\, / \\, \\operatorname{median}_i \\tau_i$（无量纲）。\n  - 对单元格 $i$ 的加密将 $h_i$ 替换为 $h_i/2$（每个单元格最多一次）。\n  - 最大稳定显式时间步长是满足以下条件的最大 $\\Delta t$：对于所有 $i$，所选的 $\\Delta t$ 不违反每个单元格的显式稳定性界限 $\\theta_i$；选择与该界限和所有加密后的 $h_i$ 一致的最大 $\\Delta t$。\n\n- 贪心加密策略：\n  - 按 $s_i$ 的降序对候选单元格进行排序。\n  - 遍历此顺序，如果一个单元格尚未被加密且仍有剩余预算，则试探性地加密该单元格。\n  - 在试探性加密后，使用更新后的 $h_i$ 重新计算 $r$，并且仅当得到的 $r$ 仍然大于或等于 $\\beta$ 时才接受此加密；否则，拒绝此加密。\n  - 继续此过程，直到预算耗尽或不存在更多可接受的加密为止。\n\n- 时间步长选择：\n  - 加密阶段结束后，选择一个全局 $\\Delta t$（秒），使其为满足所有单元格的 Courant 数 $\\theta_i = c_i \\Delta t / h_i$ 均不超过 $\\theta_{\\max}$ 的最大值。\n  - 使用加密后的 $h_i$ 报告最终的坍缩比 $r$。\n\n您的程序必须实现上述加密策略和时间步长选择，并将其应用于以下测试套件。在所有情况下，$\\Delta t$ 均以秒表示。$[h_i]$ 的值以米为单位，$[c_i]$ 的值以米/秒为单位。\n\n- 测试用例 A (常规情况)：\n  - $[h_i] = [\\, 1.0, \\, 1.0, \\, 1.0, \\, 1.0, \\, 1.0, \\, 1.0 \\,]$\n  - $[c_i] = [\\, 200.0, \\, 300.0, \\, 400.0, \\, 250.0, \\, 350.0, \\, 150.0 \\,]$\n  - $[s_i] = [\\, 0.1, \\, 0.9, \\, 0.8, \\, 0.2, \\, 0.7, \\, 0.3 \\,]$\n  - $\\theta_{\\max} = 0.9$\n  - $\\beta = 0.4$\n  - $B = 2$\n\n- 测试用例 B (边界情况：预算为零，不允许加密)：\n  - $[h_i] = [\\, 2.0, \\, 0.5, \\, 1.0, \\, 1.5 \\,]$\n  - $[c_i] = [\\, 300.0, \\, 600.0, \\, 200.0, \\, 400.0 \\,]$\n  - $[s_i] = [\\, 0.5, \\, 0.7, \\, 0.1, \\, 0.2 \\,]$\n  - $\\theta_{\\max} = 0.95$\n  - $\\beta = 0.5$\n  - $B = 0$\n\n- 测试用例 C (极端情况：可能导致时间步坍缩的单元格具有高分；严格的比率限制阻止了加密)：\n  - $[h_i] = [\\, 1.0, \\, 1.0, \\, 1.0, \\, 1.0, \\, 1.0 \\,]$\n  - $[c_i] = [\\, 500.0, \\, 100.0, \\, 100.0, \\, 100.0, \\, 100.0 \\,]$\n  - $[s_i] = [\\, 1.0, \\, 0.2, \\, 0.2, \\, 0.2, \\, 0.2 \\,]$\n  - $\\theta_{\\max} = 0.9$\n  - $\\beta = 0.3$\n  - $B = 1$\n\n- 测试用例 D (极端情况：低波速导致局部时间尺度较大；多次加密被接受且未发生坍缩)：\n  - $[h_i] = [\\, 0.8, \\, 0.8, \\, 0.8, \\, 0.8 \\,]$\n  - $[c_i] = [\\, 100.0, \\, 110.0, \\, 90.0, \\, 95.0 \\,]$\n  - $[s_i] = [\\, 0.5, \\, 0.6, \\, 0.9, \\, 0.4 \\,]$\n  - $\\theta_{\\max} = 0.85$\n  - $\\beta = 0.5$\n  - $B = 3$\n\n对于每个测试用例，您的程序必须输出一个包含三个条目的列表：\n- 所选的 $\\Delta t$（秒），四舍五入到六位小数。\n- 最终的坍缩比 $r$，四舍五入到六位小数。\n- 加密单元格的数量（整数）。\n\n最终输出格式：您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表，每个测试用例的结果本身就是按上述顺序排列的列表。例如，总体格式为：\n\"[ [dt_A,r_A,nref_A], [dt_B,r_B,nref_B], [dt_C,r_C,nref_C], [dt_D,r_D,nref_D] ]\"\n不含任何额外文本。", "solution": "该问题要求为一维线性弹性动力学设计并实现一种考虑稳定性的自适应网格加密策略。问题的核心在于，在特定区域（由加密分数指示）进行网格加密的需求与为显式时间积分方案保持数值稳定性的需求之间取得平衡，同时避免全局时间步长的急剧减小（即时间步坍缩问题）。其指导性的物理和数值原理是牛顿第二定律（导出了一维波动方程）以及 Courant–Friedrichs–Lewy (CFL) 条件，后者决定了双曲型偏微分方程显式数值格式的稳定性。\n\n该算法主要分两个阶段进行：一个受避免坍缩准则约束的贪心网格加密阶段，以及随后基于最终网格配置选择可能的最大稳定时间步长。\n\n首先，我们定义问题中给出和派生的关键量。网格由索引 $i$ 标记的单元格组成，每个单元格都有给定的长度 $h_i$、与材料相关的波传播速度 $c_i$ 以及一个无量纲的加密分数 $s_i$。\n\n每个单元格的局部时间尺度 $\\tau_i$ 定义为波穿过该单元格所需的时间：\n$$\n\\tau_i = \\frac{h_i}{c_i}\n$$\n这个量是基础性的，因为它代表了该单元格内最快物理现象的特征时间。\n\n显式时间积分方案（如此处所考虑的）的稳定性由 Courant 数 $\\theta_i$ 控制。对于一个全局时间步长 $\\Delta t$，局部 Courant 数为：\n$$\n\\theta_i = \\frac{c_i \\Delta t}{h_i} = \\frac{\\Delta t}{\\tau_i}\n$$\nCFL 稳定性条件要求对于网格中的所有单元格，Courant 数都必须被某个值 $\\theta_{\\max}$ 所限制。也就是说，对于所有的 $i$，$\\theta_i \\le \\theta_{\\max}$。为了找到允许的最大全局时间步长 $\\Delta t$，我们必须对每个单元格满足这个条件：\n$$\n\\Delta t \\le \\theta_{\\max} \\cdot \\frac{h_i}{c_i} \\implies \\Delta t \\le \\theta_{\\max} \\cdot \\tau_i \\quad \\forall i\n$$\n这意味着全局时间步长受具有最小局部时间尺度的单元格的限制：\n$$\n\\Delta t \\le \\min_i (\\theta_{\\max} \\cdot \\tau_i) = \\theta_{\\max} \\cdot \\min_i (\\tau_i)\n$$\n为了最大化计算效率，我们选择可能的最大稳定时间步长，即：\n$$\n\\Delta t = \\theta_{\\max} \\cdot \\min_i(\\tau_i)\n$$\n网格加密涉及减小单元格的长度，通常是将其减半（$h_i \\to h_i/2$）。此操作也会使局部时间尺度减半（$\\tau_i \\to \\tau_i/2$），这可能导致整个网格的最小时间尺度急剧减小，从而导致全局时间步长 $\\Delta t$ 的坍缩。为了防止这种情况，问题引入了一个基于坍缩比 $r$ 的避免坍缩约束：\n$$\nr = \\frac{\\min_i \\tau_i}{\\operatorname{median}_i \\tau_i}\n$$\n该比率衡量了最小时间尺度相对于网格时间尺度中位数的程度。$r$ 值非常小表明，一个或少数几个单元格施加了比网格主体严格得多的时间步长约束。算法必须确保任何加密操作都不会导致该比率降到给定的阈值 $\\beta$ 以下。\n\n网格加密策略通过一个贪心算法实现：\n1.  **初始化**：我们从单元格长度 $[h_i]$、波速 $[c_i]$ 和加密分数 $[s_i]$ 的初始数组，以及参数 $\\theta_{\\max}$、$\\beta$ 和加密预算 $B$ 开始。我们还将已加密单元格的计数器 $n_{ref}$ 初始化为 $0$，并用一个集合来跟踪已加密单元格的索引。\n\n2.  **候选排序**：按加密分数 $s_i$ 的降序来考虑单元格的加密。这构成了该算法的贪心方面，优先处理被认为最需要加密的单元格。\n\n3.  **迭代加密**：算法遍历已排序的候选单元格列表。对于每个候选单元格 $j$：\n    a. 我们检查预算是否 $B > 0$ 以及单元格 $j$ 是否尚未被加密。\n    b. 如果是，我们执行一次*试探性加密*。创建网格单元格长度的临时副本，其中 $h_j$ 被替换为 $h_j/2$。\n    c. 使用这个试探性网格，我们重新计算局部时间尺度数组 $[\\tau_i]$，然后计算预期的坍缩比 $r_{new}$。\n    d. 只有当由此产生的坍缩比满足约束 $r_{new} \\ge \\beta$ 时，这次试探性加密才被*接受*。\n    e. 如果加密被接受，对 $h_j$ 的更改将成为永久性的，预算 $B$ 减 1，已加密单元格计数 $n_{ref}$ 加 1，并将索引 $j$ 记录为已加密。\n    f. 如果加密被拒绝（因为 $r_{new}  \\beta$），单元格长度 $h_j$ 将恢复到其先前的值，算法继续处理下一个候选单元格。\n\n4.  **终止**：当预算 $B$ 耗尽或所有候选单元格都已被考虑时，加密过程终止。\n\n5.  **最终计算**：加密阶段结束后，确定最终的单元格长度集 $[h_i]$。\n    a. 计算最终的局部时间尺度 $[\\tau_i = h_i/c_i]$。\n    b. 最终的稳定时间步长计算为 $\\Delta t = \\theta_{\\max} \\cdot \\min_i(\\tau_i)$。\n    c. 最终的坍缩比计算为 $r = \\min_i(\\tau_i) / \\operatorname{median}_i(\\tau_i)$。\n    d. 记录成功的加密总数 $n_{ref}$。\n\n此过程确保了加密被战略性地应用，在需要的地方提高了网格分辨率，同时坍缩避免约束确保了模拟的数值稳定性不会受到过度损害。每个测试用例的最终输出是计算出的 $\\Delta t$、最终的坍缩比 $r$ 以及加密的单元格总数 $n_{ref}$。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a stability-aware mesh refinement strategy for 1D linear elastodynamics.\n    \"\"\"\n    \n    test_cases = [\n        # Test case A (happy path)\n        {\n            \"h\": [1.0, 1.0, 1.0, 1.0, 1.0, 1.0],\n            \"c\": [200.0, 300.0, 400.0, 250.0, 350.0, 150.0],\n            \"s\": [0.1, 0.9, 0.8, 0.2, 0.7, 0.3],\n            \"theta_max\": 0.9,\n            \"beta\": 0.4,\n            \"B\": 2,\n        },\n        # Test case B (boundary: zero budget)\n        {\n            \"h\": [2.0, 0.5, 1.0, 1.5],\n            \"c\": [300.0, 600.0, 200.0, 400.0],\n            \"s\": [0.5, 0.7, 0.1, 0.2],\n            \"theta_max\": 0.95,\n            \"beta\": 0.5,\n            \"B\": 0,\n        },\n        # Test case C (edge: aggressive score, strict ratio)\n        {\n            \"h\": [1.0, 1.0, 1.0, 1.0, 1.0],\n            \"c\": [500.0, 100.0, 100.0, 100.0, 100.0],\n            \"s\": [1.0, 0.2, 0.2, 0.2, 0.2],\n            \"theta_max\": 0.9,\n            \"beta\": 0.3,\n            \"B\": 1,\n        },\n        # Test case D (edge: multiple refinements accepted)\n        {\n            \"h\": [0.8, 0.8, 0.8, 0.8],\n            \"c\": [100.0, 110.0, 90.0, 95.0],\n            \"s\": [0.5, 0.6, 0.9, 0.4],\n            \"theta_max\": 0.85,\n            \"beta\": 0.5,\n            \"B\": 3,\n        },\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        h_initial = np.array(case[\"h\"], dtype=float)\n        c = np.array(case[\"c\"], dtype=float)\n        s = np.array(case[\"s\"], dtype=float)\n        theta_max = case[\"theta_max\"]\n        beta = case[\"beta\"]\n        budget = case[\"B\"]\n        \n        h_current = np.copy(h_initial)\n        num_cells = len(h_initial)\n        \n        # Create a list of candidates (score, index)\n        candidates = sorted(enumerate(s), key=lambda x: x[1], reverse=True)\n        \n        refined_indices = set()\n        refined_count = 0\n        \n        for idx, score in candidates:\n            if budget == 0:\n                break\n            \n            if idx not in refined_indices:\n                # Tentatively refine the cell\n                h_tentative = np.copy(h_current)\n                h_tentative[idx] /= 2.0\n                \n                # Recompute tau and the collapse ratio r\n                tau_tentative = h_tentative / c\n                min_tau = np.min(tau_tentative)\n                median_tau = np.median(tau_tentative)\n\n                if median_tau == 0:\n                    r_tentative = 0.0\n                else:\n                    r_tentative = min_tau / median_tau\n                \n                # Check if the refinement is acceptable\n                if r_tentative >= beta:\n                    # Accept the refinement\n                    h_current = h_tentative\n                    budget -= 1\n                    refined_count += 1\n                    refined_indices.add(idx)\n\n        # After refinement loop, perform final calculations\n        final_tau = h_current / c\n        min_final_tau = np.min(final_tau)\n        \n        # Calculate final delta_t\n        delta_t = theta_max * min_final_tau\n        \n        # Calculate final collapse ratio r\n        median_final_tau = np.median(final_tau)\n        if median_final_tau == 0:\n            final_r = 0.0\n        else:\n            final_r = min_final_tau / median_final_tau\n            \n        # Store results for this test case\n        results.append([delta_t, final_r, refined_count])\n\n    # Format the final output string\n    formatted_sublists = []\n    for dt, r, nref in results:\n        sublist_str = f\"[{dt:.6f},{r:.6f},{nref}]\"\n        formatted_sublists.append(sublist_str)\n    \n    final_output = f\"[{','.join(formatted_sublists)}]\"\n    print(final_output)\n\nsolve()\n```", "id": "3562397"}]}