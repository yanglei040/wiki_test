{"hands_on_practices": [{"introduction": "在深入探讨两种拉格朗日列式的实现差异之前，确认它们在理论上的等价性至关重要。本练习 [@problem_id:3568041] 将引导您通过数值计算来验证一个基本事实：内力虚功 $\\delta W_{int}$ 的值是唯一的。无论是在参考构型中采用第二Piola-Kirchhoff应力 ($\\mathbf{S}$) 与Green-Lagrange应变变分 ($\\delta\\mathbf{E}$) 这对功共轭量进行计算，还是在当前构型中使用Kirchhoff应力 ($\\boldsymbol{\\tau}$) 与变形率张量 ($\\mathbf{d}$)，其结果都应当相同。通过这一动手实践，您将加深对“两种框架仅是对同一物理过程的不同数学描述”这一核心思想的理解。", "problem": "考虑一个代表岩土材料固体骨架的超弹性连续体，正在经历有限变形。令参考构型由 $\\Omega_0$ 表示，当前构型由 $\\Omega_t$ 表示。该运动由变形梯度 $\\mathbf{F} = \\frac{\\partial \\mathbf{x}}{\\partial \\mathbf{X}}$、右柯西-格林张量 $\\mathbf{C} = \\mathbf{F}^\\top \\mathbf{F}$、格林-拉格朗日应变 $\\mathbf{E} = \\frac{1}{2}(\\mathbf{C} - \\mathbf{I})$、雅可比行列式 $J = \\det(\\mathbf{F})$ 以及左柯西-格林张量 $\\mathbf{b} = \\mathbf{F}\\mathbf{F}^\\top$ 来表征。令第二皮奥拉-基尔霍夫应力为 $\\mathbf{S}$，基尔霍夫应力为 $\\boldsymbol{\\tau}$。考虑一个具有恒定空间梯度 $\\mathbf{h} = \\nabla_{\\mathbf{x}} \\delta \\mathbf{v}$ 的虚速度场，及其对称部分 $\\mathrm{sym}(\\mathbf{h}) = \\frac{1}{2}(\\mathbf{h} + \\mathbf{h}^\\top)$。\n\n仅从以下基本原则出发：\n- 有限变形运动学（$\\mathbf{F}$、$\\mathbf{C}$、$\\mathbf{E}$、$J$、$\\mathbf{b}$），以及应力和应变度量的功共轭性。\n- 超弹性本构假设，即存在一个应变能密度函数 $W$，使得应力可以从适当的能量共轭中导出。\n- 虚功原理，指出当使用功共轭度量和一致的域表示时，总拉格朗日描述中的内虚功等于任何等效更新描述中的内虚功。\n\n对于一个具有拉梅参数 $\\mu$ 和 $\\lambda$（单位为帕斯卡）的可压缩Neo-Hookean超弹性骨架，推导计算内虚功所需的表达式，分别是在总拉格朗日形式下使用 $\\mathbf{S}$ 和 $\\delta \\mathbf{E}$ 在 $\\Omega_0$ 上计算，以及在更新拉格朗日形式下适当使用 $\\boldsymbol{\\tau}$ 和 $\\mathrm{sym}(\\mathbf{h})$ 计算。然后，针对给定的测试套件，数值验证使用 $\\mathbf{S}$ 的总拉格朗日描述计算的内虚功，与使用 $\\boldsymbol{\\tau}$ 的更新拉格朗日描述计算的内虚功相等，前提是后者的积分与所选度量保持一致。使用参考体积 $V_0 = 1\\,\\mathrm{m}^3$。应力以 $\\mathrm{Pa}$ 表示，内虚功以 $\\mathrm{J}$ 表示。验证标准是两个内虚功值之间的绝对差小于容差 $\\varepsilon = 10^{-9}\\,\\mathrm{J}$。\n\n实现一个完整的、可运行的程序，对于每个测试用例，返回一个布尔值，指示在指定容差下等效性是否成立。您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果（例如，$[\\text{result}_1,\\text{result}_2,\\text{result}_3]$）。\n\n测试套件规范：\n- 使用应变能密度为 $W(\\mathbf{C}, J)$ 且拉梅参数为 $\\mu$ 和 $\\lambda$（单位 $\\mathrm{Pa}$）的可压缩Neo-Hookean超弹性模型。\n- 对于每个案例，在单元上使用恒定的变形梯度 $\\mathbf{F}$ 和恒定的空间虚速度梯度 $\\mathbf{h}$。\n\n为以下五个案例提供数值验证：\n1. 一般剪切-拉伸：\n   - $\\mathbf{F} = \\begin{bmatrix} 1.3  0.2  0.0 \\\\ 0.1  1.1  0.0 \\\\ 0.0  0.0  0.9 \\end{bmatrix}$，\n   - $\\mu = 3.0 \\times 10^{7}\\,\\mathrm{Pa}$，$\\lambda = 5.0 \\times 10^{7}\\,\\mathrm{Pa}$，\n   - $\\mathbf{h} = \\begin{bmatrix} 0.02  0.01  -0.005 \\\\ 0.00  -0.01  0.003 \\\\ 0.004  0.00  0.015 \\end{bmatrix}$。\n2. 绕 $z$ 轴纯旋转，角度 $\\theta = \\pi/3$（弧度）：\n   - $\\mathbf{F} = \\begin{bmatrix} \\cos\\theta  -\\sin\\theta  0 \\\\ \\sin\\theta  \\cos\\theta  0 \\\\ 0  0  1 \\end{bmatrix}$，\n   - $\\mu = 2.5 \\times 10^{7}\\,\\mathrm{Pa}$，$\\lambda = 4.0 \\times 10^{7}\\,\\mathrm{Pa}$，\n   - $\\mathbf{h} = \\begin{bmatrix} 0.01  -0.02  0.00 \\\\ 0.02  0.01  0.00 \\\\ 0.00  0.00  -0.01 \\end{bmatrix}$。\n3. 各向异性体积-剪切：\n   - $\\mathbf{F} = \\mathrm{diag}(1.2, 0.8, 1.1)$，\n   - $\\mu = 3.5 \\times 10^{7}\\,\\mathrm{Pa}$，$\\lambda = 2.0 \\times 10^{7}\\,\\mathrm{Pa}$，\n   - $\\mathbf{h} = \\begin{bmatrix} -0.015  0.005  0.00 \\\\ 0.00  0.02  -0.004 \\\\ 0.003  0.00  -0.01 \\end{bmatrix}$。\n4. 近不可压缩等容剪切：\n   - $\\mathbf{F} = \\begin{bmatrix} 1.0  0.5  0.0 \\\\ 0.0  1.0  0.0 \\\\ 0.0  0.0  1.0 \\end{bmatrix}$，\n   - $\\mu = 3.0 \\times 10^{7}\\,\\mathrm{Pa}$，$\\lambda = 1.0 \\times 10^{10}\\,\\mathrm{Pa}$，\n   - $\\mathbf{h} = \\begin{bmatrix} 0.005  0.015  0.00 \\\\ -0.01  0.004  0.00 \\\\ 0.00  0.00  0.002 \\end{bmatrix}$。\n5. 各向同性膨胀：\n   - $\\mathbf{F} = 1.1\\,\\mathbf{I} = \\begin{bmatrix} 1.1  0.0  0.0 \\\\ 0.0  1.1  0.0 \\\\ 0.0  0.0  1.1 \\end{bmatrix}$，\n   - $\\mu = 4.5 \\times 10^{7}\\,\\mathrm{Pa}$，$\\lambda = 6.0 \\times 10^{7}\\,\\mathrm{Pa}$，\n   - $\\mathbf{h} = \\begin{bmatrix} 0.02  0.00  0.00 \\\\ 0.00  0.01  0.00 \\\\ 0.00  0.00  -0.005 \\end{bmatrix}$。\n\n您的实现必须：\n- 根据第一性原理推导可压缩Neo-Hookean模型的 $\\mathbf{S}$ 和 $\\boldsymbol{\\tau}$，并用它们来评估总拉格朗日和更新拉格朗日描述中的内虚功。\n- 使用一致的度量配对，使得使用 $\\boldsymbol{\\tau}$ 的更新拉格朗日虚功在 $\\Omega_t$ 上的表达式能够与在 $\\Omega_0$ 上的总拉格朗日表达式直接比较。\n- 返回一个布尔值列表，每个测试用例对应一个布尔值，如果两个虚功的绝对差小于 $\\varepsilon = 10^{-9}\\,\\mathrm{J}$，则为 $\\mathrm{True}$，否则为 $\\mathrm{False}$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，例如 $[\\mathrm{True},\\mathrm{False},\\mathrm{True},\\mathrm{True},\\mathrm{True}]$。", "solution": "该问题要求对有限变形超弹性连续体中，内虚功的总拉格朗日（TL）表达式和更新拉格朗日（UL）表达式之间的等效性进行数值验证。\n\n### 1. 理论框架\n\n虚功原理假定内虚功 $\\delta W_{int}$ 是标架无关的。只要使用功共轭的应力和应变度量，并在相应的域上进行积分，其值必须与表达时所用的构型（参考构型或当前构型）无关。\n\n#### 总拉格朗日（TL）表述\n在总拉格朗日表述中，所有量都参照参考构型 $\\Omega_0$。内虚功表示为第二皮奥拉-基尔霍夫应力张量 $\\mathbf{S}$ 与格林-拉格朗日应变张量变分 $\\delta\\mathbf{E}$ 的点积在参考体积 $V_0$ 上的积分：\n$$ \\delta W_{int}^{TL} = \\int_{\\Omega_0} \\mathbf{S} : \\delta\\mathbf{E} \\, dV_0 $$\n由于问题指定变形梯度 $\\mathbf{F}$ 和空间虚速度梯度 $\\mathbf{h}$ 在整个连续体中是恒定的，因此应力和应变场也是均匀的。积分简化为：\n$$ \\delta W_{int}^{TL} = (\\mathbf{S} : \\delta\\mathbf{E}) V_0 $$\n其中 $V_0 = 1\\,\\mathrm{m}^3$ 是参考体积。\n\n必须推导出量 $\\mathbf{S}$ 和 $\\delta\\mathbf{E}$。\n格林-拉格朗日应变张量的变分 $\\delta\\mathbf{E}$ 通过一次拉回操作与空间虚速度梯度的对称部分 $\\delta\\mathbf{d} = \\mathrm{sym}(\\mathbf{h})$ 相关联：\n$$ \\delta\\mathbf{E} = \\mathbf{F}^\\top \\delta\\mathbf{d} \\mathbf{F} = \\mathbf{F}^\\top \\left( \\frac{1}{2}(\\mathbf{h} + \\mathbf{h}^\\top) \\right) \\mathbf{F} $$\n\n第二皮奥拉-基尔霍夫应力 $\\mathbf{S}$ 由给定的可压缩Neo-Hookean应变能密度函数 $W$ 推导得出：\n$$ W(I_1, J) = \\frac{\\mu}{2}(I_1 - 3) - \\mu \\ln(J) + \\frac{\\lambda}{2}(\\ln(J))^2 $$\n其中 $I_1 = \\mathrm{tr}(\\mathbf{C})$ 是右柯西-格林张量 $\\mathbf{C} = \\mathbf{F}^\\top\\mathbf{F}$ 的第一不变量，$J = \\det(\\mathbf{F})$ 是变形的雅可比行列式，$\\mu$ 和 $\\lambda$ 是拉梅参数。应力由 $\\mathbf{S} = 2 \\frac{\\partial W}{\\partial \\mathbf{C}}$ 给出。进行微分可得：\n$$ \\mathbf{S} = 2 \\left( \\frac{\\mu}{2} \\frac{\\partial I_1}{\\partial \\mathbf{C}} + \\left(-\\frac{\\mu}{J} + \\frac{\\lambda \\ln(J)}{J}\\right) \\frac{\\partial J}{\\partial \\mathbf{C}} \\right) $$\n使用恒等式 $\\frac{\\partial I_1}{\\partial \\mathbf{C}} = \\mathbf{I}$ 和 $\\frac{\\partial J}{\\partial \\mathbf{C}} = \\frac{1}{2} J \\mathbf{C}^{-1}$，我们得到：\n$$ \\mathbf{S} = \\mu \\mathbf{I} + (-\\mu + \\lambda \\ln(J)) \\mathbf{C}^{-1} = \\mu(\\mathbf{I} - \\mathbf{C}^{-1}) + \\lambda \\ln(J) \\mathbf{C}^{-1} $$\n\n#### 更新拉格朗日（UL）表述\n\n在更新拉格朗日表述中，积分通常在当前构型 $\\Omega_t$ 上表示：\n$$ \\delta W_{int}^{UL} = \\int_{\\Omega_t} \\boldsymbol{\\sigma} : \\delta\\mathbf{d} \\, dV_t $$\n其中 $\\boldsymbol{\\sigma}$ 是柯西（真实）应力。基尔霍夫应力定义为 $\\boldsymbol{\\tau} = J\\boldsymbol{\\sigma}$。代入 $\\boldsymbol{\\sigma} = J^{-1}\\boldsymbol{\\tau}$ 和体积微分变换 $dV_t = J dV_0$，我们可以将内虚功表示为在参考域 $\\Omega_0$ 上的积分：\n$$ \\delta W_{int}^{UL} = \\int_{\\Omega_0} (J^{-1}\\boldsymbol{\\tau}) : \\delta\\mathbf{d} \\, (J dV_0) = \\int_{\\Omega_0} \\boldsymbol{\\tau} : \\delta\\mathbf{d} \\, dV_0 $$\n这表明，在参考体积上积分时，与空间变形率 $\\delta\\mathbf{d}$ 功共轭的对偶量是基尔霍夫应力 $\\boldsymbol{\\tau}$。问题要求使用 $\\boldsymbol{\\tau}$ 和 $\\mathrm{sym}(\\mathbf{h})$ 来验证等效性。因此，相应的虚功表达式为：\n$$ \\delta W_{int}^{UL-equiv} = (\\boldsymbol{\\tau} : \\delta\\mathbf{d}) V_0 = (\\boldsymbol{\\tau} : \\mathrm{sym}(\\mathbf{h})) V_0 $$\n基尔霍夫应力 $\\boldsymbol{\\tau}$ 是通过对 $\\mathbf{S}$ 进行一次推前操作获得的：\n$$ \\boldsymbol{\\tau} = \\mathbf{F} \\mathbf{S} \\mathbf{F}^\\top = \\mathbf{F} \\left(\\mu(\\mathbf{I} - \\mathbf{C}^{-1}) + \\lambda \\ln(J) \\mathbf{C}^{-1}\\right) \\mathbf{F}^\\top $$\n使用 $\\mathbf{F}\\mathbf{I}\\mathbf{F}^\\top = \\mathbf{F}\\mathbf{F}^\\top = \\mathbf{b}$ 和 $\\mathbf{F}\\mathbf{C}^{-1}\\mathbf{F}^\\top = \\mathbf{F}(\\mathbf{F}^{-1}(\\mathbf{F}^\\top)^{-1})\\mathbf{F}^\\top = \\mathbf{I}$，表达式简化为：\n$$ \\boldsymbol{\\tau} = \\mu(\\mathbf{b} - \\mathbf{I}) + \\lambda \\ln(J) \\mathbf{I} $$\n其中 $\\mathbf{b} = \\mathbf{F}\\mathbf{F}^\\top$ 是左柯西-格林张量。\n\n### 2. 数值验证\n\n核心任务是针对给定的测试用例，在容差 $\\varepsilon = 10^{-9}\\,\\mathrm{J}$ 内数值验证 $\\delta W_{int}^{TL} = \\delta W_{int}^{UL-equiv}$。由于 $V_0 = 1\\,\\mathrm{m}^3$，这等价于验证：\n$$ |(\\mathbf{S} : \\delta\\mathbf{E}) - (\\boldsymbol{\\tau} : \\mathrm{sym}(\\mathbf{h}))|   \\varepsilon $$\n恒等式 $\\mathbf{S} : \\delta\\mathbf{E} = \\boldsymbol{\\tau} : \\delta\\mathbf{d}$ 在数学上是精确的。数值实现将测试推导公式的正确性，并评估浮点运算在两条不同计算路径上的影响。\n\n每个测试用例的算法如下：\n1.  给定 $\\mathbf{F}$、$\\mathbf{h}$、$\\mu$ 和 $\\lambda$。令 $\\mathbf{I}$ 为 $3 \\times 3$ 单位矩阵。\n2.  计算运动学张量：$J = \\det(\\mathbf{F})$，$\\mathbf{C} = \\mathbf{F}^\\top\\mathbf{F}$，$\\mathbf{b} = \\mathbf{F}\\mathbf{F}^\\top$，$\\mathbf{C}^{-1} = (\\mathbf{F}^\\top\\mathbf{F})^{-1}$。\n3.  计算虚应变度量：$\\delta\\mathbf{d} = \\frac{1}{2}(\\mathbf{h} + \\mathbf{h}^\\top)$ 和 $\\delta\\mathbf{E} = \\mathbf{F}^\\top \\delta\\mathbf{d} \\mathbf{F}$。\n4.  计算 TL 量：\n    -   应力：$\\mathbf{S} = \\mu(\\mathbf{I} - \\mathbf{C}^{-1}) + \\lambda \\ln(J) \\mathbf{C}^{-1}$。\n    -   虚功：$W_{TL} = \\sum_{i,j} S_{ij} (\\delta E)_{ij}$。\n5.  计算 UL 量：\n    -   应力：$\\boldsymbol{\\tau} = \\mu(\\mathbf{b} - \\mathbf{I}) + \\lambda \\ln(J) \\mathbf{I}$。\n    -   虚功：$W_{UL} = \\sum_{i,j} \\tau_{ij} (\\delta d)_{ij}$。\n6.  比较结果：判断 $|W_{TL} - W_{UL}|  10^{-9}$ 是否成立。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes and verifies the equivalence of Total and Updated Lagrangian\n    formulations for internal virtual work in a hyperelastic material.\n    \"\"\"\n\n    def check_equivalence(F_mat, h_mat, mu, lambda_val):\n        \"\"\"\n        Performs the numerical verification for a single test case.\n\n        Args:\n            F_mat (list): The 3x3 deformation gradient tensor F.\n            h_mat (list): The 3x3 spatial virtual velocity gradient h.\n            mu (float): The first Lamé parameter.\n            lambda_val (float): The second Lamé parameter.\n\n        Returns:\n            bool: True if the absolute difference between the two virtual work\n                  calculations is within tolerance, False otherwise.\n        \"\"\"\n        # Convert inputs to numpy arrays for matrix operations\n        F = np.array(F_mat, dtype=np.float64)\n        h = np.array(h_mat, dtype=np.float64)\n        I = np.identity(3, dtype=np.float64)\n        \n        # --- Kinematic Quantities ---\n        J = np.linalg.det(F)\n        # Right Cauchy-Green tensor C = F^T * F\n        C = F.T @ F\n        # Left Cauchy-Green tensor b = F * F^T\n        b = F @ F.T\n\n        # --- Virtual Strain Measures ---\n        # Spatial virtual rate of deformation d_delta = sym(h)\n        d_delta = 0.5 * (h + h.T)\n        # Variation of Green-Lagrange strain dE = F^T * d_delta * F\n        E_delta = F.T @ d_delta @ F\n        \n        # --- Path 1: Total Lagrangian (TL) Formulation ---\n        # Inverse of C\n        C_inv = np.linalg.inv(C)\n        \n        # Second Piola-Kirchhoff stress S\n        S = mu * (I - C_inv) + lambda_val * np.log(J) * C_inv\n        \n        # Internal virtual work (density, since V0=1) in TL form\n        # The double dot product S:dE is the sum of element-wise products\n        W_tl = np.sum(S * E_delta)\n        \n        # --- Path 2: \"Updated\" Lagrangian (UL) Formulation using Kirchhoff Stress ---\n        # Kirchhoff stress tau\n        tau = mu * (b - I) + lambda_val * np.log(J) * I\n        \n        # Internal virtual work (density, since V0=1) in UL-equivalent form\n        # The double dot product tau:d_delta\n        W_ul = np.sum(tau * d_delta)\n        \n        # --- Verification ---\n        tolerance = 1e-9\n        is_equivalent = np.abs(W_tl - W_ul)  tolerance\n        \n        return is_equivalent\n\n    # Define the test cases from the problem statement.\n    theta = np.pi / 3\n    test_cases = [\n        # Case 1: General shear-stretch\n        {\n            'F': [[1.3, 0.2, 0.0], [0.1, 1.1, 0.0], [0.0, 0.0, 0.9]],\n            'h': [[0.02, 0.01, -0.005], [0.00, -0.01, 0.003], [0.004, 0.00, 0.015]],\n            'mu': 3.0e7, 'lambda': 5.0e7\n        },\n        # Case 2: Pure rotation\n        {\n            'F': [[np.cos(theta), -np.sin(theta), 0], [np.sin(theta), np.cos(theta), 0], [0, 0, 1]],\n            'h': [[0.01, -0.02, 0.00], [0.02, 0.01, 0.00], [0.00, 0.00, -0.01]],\n            'mu': 2.5e7, 'lambda': 4.0e7\n        },\n        # Case 3: Anisotropic volumetric-shear\n        {\n            'F': [[1.2, 0.0, 0.0], [0.0, 0.8, 0.0], [0.0, 0.0, 1.1]],\n            'h': [[-0.015, 0.005, 0.00], [0.00, 0.02, -0.004], [0.003, 0.00, -0.01]],\n            'mu': 3.5e7, 'lambda': 2.0e7\n        },\n        # Case 4: Nearly incompressible isochoric shear\n        {\n            'F': [[1.0, 0.5, 0.0], [0.0, 1.0, 0.0], [0.0, 0.0, 1.0]],\n            'h': [[0.005, 0.015, 0.00], [-0.01, 0.004, 0.00], [0.00, 0.00, 0.002]],\n            'mu': 3.0e7, 'lambda': 1.0e10\n        },\n        # Case 5: Isotropic expansion\n        {\n            'F': [[1.1, 0.0, 0.0], [0.0, 1.1, 0.0], [0.0, 0.0, 1.1]],\n            'h': [[0.02, 0.00, 0.00], [0.00, 0.01, 0.00], [0.00, 0.00, -0.005]],\n            'mu': 4.5e7, 'lambda': 6.0e7\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        result = check_equivalence(case['F'], case['h'], case['mu'], case['lambda'])\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    # Capital 'T' in 'True' and 'F' in 'False' is standard for str(bool).\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3568041"}, {"introduction": "大变形分析，特别是更新拉格朗日（UL）列式，面临的一个关键挑战是保证材料客观性，即材料的本构响应不应受到刚体运动的影响。本练习 [@problem_id:3568053] 通过对一个物体施加纯转动（不产生真实应变）来深入探究此概念。您将亲眼见证，总拉格朗日（TL）列式如何天然地满足这一要求，而一个简化的UL实现则会产生虚假的非物理应力，从而突显出采用如Jaumann率这样的客观应力率的必要性。", "problem": "考虑一个均质连续体，它代表一个三轴试样，正在经历一个具有恒定角速度的指定刚体转动。目标是使用全拉格朗日（TL）和更新拉格朗日（UL）列式来验证刚体运动下应力测度的不变性，并评估使用客观与非客观应力率的后果。推导和实现必须从基本运动学和平衡原理出发，并且不得依赖于超出第一性原理定义的简化公式。\n\n从连续体的运动学开始。令运动由变形梯度 $F$ 描述，其中 $F = \\partial x / \\partial X$。对于无拉伸的刚体转动，极分解简化为 $F = R$，其中 $R$ 是一个正常正交旋转张量，满足 $R^{\\mathsf{T}} R = I$ 和 $\\det R = +1$。Green-Lagrange 应变张量为 $E = \\tfrac{1}{2} \\left( C - I \\right)$，其中 $C = F^{\\mathsf{T}} F$。对于刚性旋转，$C = I$，因此 $E = 0$。在全拉格朗日列式中，采用参考构型中的线弹性本构关系，第二 Piola-Kirchhoff 应力 $S$ 满足 $S = \\mathbb{C} : E$，其中 $\\mathbb{C}$ 是各向同性线弹性材料的四阶弹性张量。Cauchy 应力 $\\sigma$ 通过前推操作得到，$\\sigma = \\tfrac{1}{J} R S R^{\\mathsf{T}}$，且 $J = \\det F$。对于刚性旋转，$J = 1$。因此，在无拉伸的纯刚性旋转下，从无应力状态开始，正确实现的全拉格朗日更新必须处处产生 $\\sigma = 0$。\n\n在更新拉格朗日设定中，考虑空间速度梯度 $L = \\dot{F} F^{-1}$，它被分解为对称的变形率张量 $D = \\tfrac{1}{2} \\left( L + L^{\\mathsf{T}} \\right)$ 和反对称的自旋张量 $W = \\tfrac{1}{2} \\left( L - L^{\\mathsf{T}} \\right)$。对于角速度矢量为 $\\omega$ 的刚体转动，$D = 0$，$W$ 代表与 $\\omega$ 相关的斜张量，即对于任意矢量 $v$，有 $W v = \\omega \\times v$。应力率的客观性要求本构率形式必须根据客观应力率来定义。例如，Cauchy 应力的 Jaumann 率为 $\\sigma^{\\nabla \\mathrm{J}} = \\dot{\\sigma} - W \\sigma + \\sigma W$。对于 $D = 0$ 的刚性旋转，客观率意味着 $\\sigma^{\\nabla \\mathrm{J}} = 0$，因此空间坐标系中的精确演化满足 $\\dot{\\sigma} = W \\sigma - \\sigma W$，得到 $\\sigma(t) = R(t) \\, \\sigma(0) \\, R(t)^{\\mathsf{T}}$，其中 $R(t)$ 解出 $\\dot{R}(t) = W R(t)$ 且 $R(0) = I$。相反，由简单的物质时间导数 $\\dot{\\sigma}$ 给出且不含同旋项的非客观率，在初始应力不为零时，无法正确表示刚体旋转；它不会保持 $\\sigma$ 的正确同旋，因此在旋转体坐标系中评估或与正确的旋转后应力比较时会引入伪应力分量。\n\n任务：\n- 实现一个程序，使用上述原理对三维物体执行以下验证：\n  1. 有限刚性旋转下的全拉格朗日不变性测试：对于一个有限旋转，构造 $F = R$ 并计算 Green-Lagrange 应变 $E$。使用参考构型中的各向同性线弹性定律，杨氏模量为 $E_{\\mathrm{Y}}$，泊松比为 $\\nu$，计算 $S = \\mathbb{C} : E$ 并将其前推得到 $\\sigma = R S R^{\\mathsf{T}}$ (其中 $J = 1$)。报告 $\\sigma$ 的 Frobenius 范数是否低于容差 $T_{\\mathrm{tol}}$。\n  2. 使用客观率（Jaumann）的更新拉格朗日不变性测试：从指定的初始 Cauchy 应力 $\\sigma_0$ 开始，在恒定自旋张量 $W$（等效于恒定角速度矢量 $\\omega$）的刚性旋转下，对时间 $T$ 内的应力演化进行积分，每一步使用精确的同旋更新 $\\sigma_{n+1} = R(\\Delta t) \\, \\sigma_{n} \\, R(\\Delta t)^{\\mathsf{T}}$。将数值结果与精确解 $\\sigma_{\\mathrm{exact}}(T) = R(T) \\, \\sigma_0 \\, R(T)^{\\mathsf{T}}$ 进行比较，并报告误差的 Frobenius 范数。这实现了 $D = 0$ 时的客观 Jaumann 率。\n  3. 使用非客观率的更新拉格朗日失效测试：对于相同的刚性旋转，当 $D = 0$ 时设置 $\\dot{\\sigma} = 0$（即忽略同旋输运项）。那么 $\\sigma(t) \\equiv \\sigma_0$。将此非客观结果与 $\\sigma_{\\mathrm{exact}}(T)$ 进行比较，并报告误差的 Frobenius 范数，该范数用于量化伪应力。\n  4. 零自旋的边界情况：验证当 $\\omega = 0$ 时，基于 Jaumann 率的更新能精确地再现 $\\sigma(t) = \\sigma_0$，产生的误差低于容差 $T_{\\mathrm{tol}}$。\n\n使用以下基本基底和参数值（测试套件）：\n- 全拉格朗日测试的材料参数：杨氏模量 $E_{\\mathrm{Y}} = 10000 \\, \\mathrm{kPa}$ 和泊松比 $\\nu = 0.25$。这些值定义了关系式 $S = \\mathbb{C} : E$ 中参考构型的各向同性弹性张量 $\\mathbb{C}$。\n- 旋转运动学：\n  - 对于全拉格朗日测试，使用绕 $z$ 轴的有限旋转，角度为 $\\theta = \\pi / 3 \\, \\mathrm{rad}$，因此 $F = R(\\theta)$ 且 $J = 1$。\n  - 对于更新拉格朗日测试，使用恒定角速度矢量 $\\omega = \\left[ 0, 0, \\omega_z \\right]^{\\mathsf{T}}$，其中 $\\omega_z = \\pi \\, \\mathrm{rad}/\\mathrm{s}$，在时间 $T = 0.5 \\, \\mathrm{s}$ 内积分，总旋转角为 $\\theta = \\omega_z T = \\pi / 2 \\, \\mathrm{rad}$。在 Jaumann 实现的分步更新中，使用统一的时间步长 $\\Delta t = 0.01 \\, \\mathrm{s}$。角度必须以弧度处理。\n- 更新拉格朗日测试的初始 Cauchy 应力：$\\sigma_0 = \\mathrm{diag}(120, 80, 60) \\, \\mathrm{kPa}$，这代表具有不同主值的一般三轴状态。\n- 容差：$T_{\\mathrm{tol}} = 10^{-10} \\, \\mathrm{kPa}$。\n\n精确计算要求：\n- 计算绕 $z$ 轴旋转角度 $\\theta$ 的旋转矩阵为\n$$\nR(\\theta) =\n\\begin{bmatrix}\n\\cos \\theta  - \\sin \\theta  0 \\\\\n\\sin \\theta  \\cos \\theta  0 \\\\\n0  0  1\n\\end{bmatrix}.\n$$\n- 对于全拉格朗日测试，计算 $E = \\tfrac{1}{2} \\left( R^{\\mathsf{T}} R - I \\right)$，然后 $S = \\mathbb{C} : E$，最后计算 $\\sigma = R S R^{\\mathsf{T}}$。\n- 对于使用 Jaumann 率和 $D = 0$ 的更新拉格朗日测试，在每个时间步长 $\\Delta t$ 实现精确的同旋更新：$\\sigma_{n+1} = R(\\omega_z \\Delta t) \\, \\sigma_n \\, R(\\omega_z \\Delta t)^{\\mathsf{T}}$。经过 $N = T / \\Delta t$ 步后，获得数值解 $\\sigma_{\\mathrm{J}}(T)$ 并与精确解 $\\sigma_{\\mathrm{exact}}(T) = R(\\omega_z T) \\, \\sigma_0 \\, R(\\omega_z T)^{\\mathsf{T}}$ 进行比较。报告 Frobenius 范数 $\\lVert \\sigma_{\\mathrm{J}}(T) - \\sigma_{\\mathrm{exact}}(T) \\rVert_{\\mathrm{F}}$（单位为 $\\mathrm{kPa}$）。\n- 对于更新拉格朗日的非客观测试，设置 $\\sigma_{\\mathrm{NO}}(T) = \\sigma_0$。报告 Frobenius 范数 $\\lVert \\sigma_{\\mathrm{NO}}(T) - \\sigma_{\\mathrm{exact}}(T) \\rVert_{\\mathrm{F}}$（单位为 $\\mathrm{kPa}$）。\n- 边界情况：设置 $\\omega_z = 0$ 和 $T = 0.5 \\, \\mathrm{s}$，并验证基于 Jaumann 率的更新产生的误差低于 $T_{\\mathrm{tol}}$。\n\n单位和格式：\n- 所有应力单位必须为 $\\mathrm{kPa}$，时间单位为 $\\mathrm{s}$，角度单位为 $\\mathrm{rad}$。\n- 您的程序必须输出一行，包含一个列表，列表有四个条目，分别对应于：\n  - 条目 $1$：一个布尔值，用于全拉格朗日不变性测试，如果 $\\lVert \\sigma \\rVert_{\\mathrm{F}} \\le T_{\\mathrm{tol}}$ 则为 $\\mathrm{True}$，否则为 $\\mathrm{False}$。\n  - 条目 $2$：一个浮点数，等于在 Jaumann 更新拉格朗日测试中，当 $\\omega_z = \\pi \\, \\mathrm{rad}/\\mathrm{s}$ 且 $T = 0.5 \\, \\mathrm{s}$ 时的 $\\lVert \\sigma_{\\mathrm{J}}(T) - \\sigma_{\\mathrm{exact}}(T) \\rVert_{\\mathrm{F}}$（单位为 $\\mathrm{kPa}$）。\n  - 条目 $3$：一个浮点数，等于在非客观更新拉格朗日测试中，使用相同 $\\omega_z$ 和 $T$ 时的 $\\lVert \\sigma_{\\mathrm{NO}}(T) - \\sigma_{\\mathrm{exact}}(T) \\rVert_{\\mathrm{F}}$（单位为 $\\mathrm{kPa}$）。\n  - 条目 $4$：一个布尔值，用于零自旋边界情况，如果基于 Jaumann 率的误差 $\\le T_{\\mathrm{tol}}$ 则为 $\\mathrm{True}$，否则为 $\\mathrm{False}$。\n- 程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表，例如 $[ \\mathrm{True}, e_1, e_2, \\mathrm{True} ]$，其中 $e_1$ 和 $e_2$ 是单位为 $\\mathrm{kPa}$ 的浮点数。最终打印输出时，将浮点数四舍五入到 $ 6 $ 位小数。\n\n不允许用户输入；所有数据必须嵌入程序中。解决方案必须严格遵循上述定义和定律，不得引入超出这些基础知识的任何简化公式。", "solution": "该问题要求使用全拉格朗日（TL）和更新拉格朗日（UL）列式来验证连续介质力学中与物质坐标系无关性（也称为客观性）相关的基本原理。我们将分析一个经历纯刚体旋转（其中不发生实际变形）的连续体的应力响应。一个客观的列式必须能够正确预测无应力体中不会产生应力，以及现有应力场的正确同旋，而不会引入伪应力。\n\n分析分为四个独立的计算任务。我们将对每个任务先陈述其基本原理，然后详细说明计算过程。\n\n**1. 全拉格朗日（TL）不变性测试**\n\n在全拉格朗日列式中，所有运动学和力学变量都参照初始的、未变形的参考构型。变形由变形梯度 $F = \\partial x / \\partial X$ 来衡量，其中 $X$ 是参考构型中的物质坐标，$x$ 是当前构型中的空间坐标。\n\n对于没有任何拉伸的纯刚体旋转，变形梯度是一个正常正交旋转张量，$F = R$，其中 $R$ 满足 $R^{\\mathsf{T}} R = I$ 和 $\\det R = +1$。\n\n应变由 Green-Lagrange 应变张量 $E$ 来量化，其定义为：\n$$E = \\frac{1}{2} (F^{\\mathsf{T}} F - I)$$\n将刚性旋转的 $F=R$ 代入，我们发现：\n$$E = \\frac{1}{2} (R^{\\mathsf{T}} R - I) = \\frac{1}{2} (I - I) = 0$$\n应变张量恰好为零。问题指定了一个线弹性本构定律，通过四阶弹性张量 $\\mathbb{C}$ 将第二 Piola-Kirchhoff 应力 $S$ 与 Green-Lagrange 应变 $E$ 联系起来：$S = \\mathbb{C} : E$。由于 $E$ 是零张量，因此无论 $\\mathbb{C}$ 的具体分量（其取决于杨氏模量 $E_{\\mathrm{Y}}$ 和泊松比 $\\nu$）如何，得到的应力 $S$ 也必须是零张量，$S=0$。\n\nCauchy 应力 $\\sigma$ 代表当前（变形后）构型中的真实应力，它是通过对 $S$ 进行前推操作获得的：\n$$\\sigma = \\frac{1}{J} R S R^{\\mathsf{T}}$$\n其中 $J = \\det F$。对于刚性旋转，$F=R$，所以 $J = \\det R = 1$。由于 $S=0$，Cauchy 应力为：\n$$\\sigma = R (0) R^{\\mathsf{T}} = 0$$\n这表明 TL 列式在这种情况下内在地满足客观性；对无应力体进行刚性旋转不会产生应力。第一个任务是数值上验证这一点。我们基于给定的旋转 $R(\\theta = \\pi/3)$ 计算 $\\sigma$，并确认其 Frobenius 范数 $\\lVert \\sigma \\rVert_{\\mathrm{F}}$ 在数值容差 $T_{\\mathrm{tol}} = 10^{-10} \\, \\mathrm{kPa}$ 范围内接近于零。\n\n**2. 更新拉格朗日（UL）列式与客观应力率**\n\n在更新拉格朗日列式中，参考状态是当前构型，我们处理的是各种量的率。一个关键挑战是定义一个客观的应力率，即不随观察者参考系变化的率。Cauchy 应力的简单物质时间导数 $\\dot{\\sigma}$ 不是客观的。本构模型中必须使用客观应力率。本问题考虑了 Jaumann 率，其定义为：\n$$\\sigma^{\\nabla \\mathrm{J}} = \\dot{\\sigma} - W \\sigma + \\sigma W$$\n其中 $W$ 是自旋张量，即速度梯度 $L$ 的反对称部分。对于刚体运动，变形率张量 $D$（$L$ 的对称部分）为零。当 $D=0$ 时，客观的本构定律必须预测客观应力率为零。因此，我们设 $\\sigma^{\\nabla \\mathrm{J}} = 0$，这导致了 Cauchy 应力的以下演化方程：\n$$\\dot{\\sigma} = W \\sigma - \\sigma W$$\n对于恒定的角速度 $\\omega$，自旋张量 $W$ 是恒定的。该微分方程的精确解是：\n$$\\sigma(t) = R(t) \\sigma_0 R(t)^{\\mathsf{T}}$$\n其中 $\\sigma_0$ 是 $t=0$ 时的初始应力，$R(t)$ 是对应于该运动的旋转张量，它解出 $\\dot{R}(t) = W R(t)$ 且 $R(0) = I$。\n\n**2a. 使用客观（Jaumann）率的 UL 不变性**\n\n第二个任务是验证基于客观 Jaumann 率的数值方案能正确处理刚性旋转。我们从初始应力 $\\sigma_0$ 开始，使用离散时间步长 $\\Delta t$ 对时间 $T$ 内的应力演化进行积分。在一个小时间增量 $\\Delta t$ 上的精确解是 $\\sigma_{n+1} = R(\\Delta t) \\sigma_n R(\\Delta t)^{\\mathsf{T}}$，其中 $R(\\Delta t)$ 是增量旋转。从 $\\sigma_0$ 开始，应用此更新 $N = T / \\Delta t$ 步：\n$$\\sigma_N = R(\\Delta t) \\sigma_{N-1} R(\\Delta t)^{\\mathsf{T}} = \\dots = [R(\\Delta t)]^N \\sigma_0 ([R(\\Delta t)]^N)^{\\mathsf{T}}$$\n由于绕固定轴的旋转可以通过角度相加来复合，$[R(\\Delta t)]^N = R(N \\Delta t) = R(T)$。因此，最终数值计算出的应力 $\\sigma_{\\mathrm{J}}(T)$ 为：\n$$\\sigma_{\\mathrm{J}}(T) = R(T) \\sigma_0 R(T)^{\\mathsf{T}}$$\n这与精确的解析解 $\\sigma_{\\mathrm{exact}}(T)$ 完全相同。数值误差 $\\lVert \\sigma_{\\mathrm{J}}(T) - \\sigma_{\\mathrm{exact}}(T) \\rVert_{\\mathrm{F}}$ 预计在浮点精度范围内为零。\n\n**2b. 使用非客观率的 UL 失效**\n\n第三个任务展示了非客观列式的失败。一种幼稚的方法可能会假设，如果变形率 $D=0$，那么应力不应改变，即 $\\dot{\\sigma}=0$。这错误地忽略了应力张量随材料的输运和旋转。这导致预测结果为 $\\sigma_{\\mathrm{NO}}(T) = \\sigma_0$。这种非客观列式所犯的误差是这个不正确结果与真实的、旋转后的应力之间的差异：\n$$\\mathrm{Error} = \\sigma_{\\mathrm{NO}}(T) - \\sigma_{\\mathrm{exact}}(T) = \\sigma_0 - R(T) \\sigma_0 R(T)^{\\mathsf{T}}$$\n这个误差的 Frobenius 范数 $\\lVert \\sigma_{\\mathrm{NO}}(T) - \\sigma_{\\mathrm{exact}}(T) \\rVert_{\\mathrm{F}}$ 量化了产生的伪应力。对于一个非平凡的旋转 $R(T)$ 和一个不与单位矩阵成比例的初始应力 $\\sigma_0$，这个误差将不为零。\n\n**2c. 零自旋的边界情况**\n\n最后一个任务验证了零自旋情况下的行为，其中 $\\omega=0$。此时，$W=0$ 并且对于所有 $t$，$R(t)=I$。\nJaumann 演化方程 $\\dot{\\sigma} = W \\sigma - \\sigma W$ 变为 $\\dot{\\sigma}=0$。精确解是 $\\sigma_{\\mathrm{exact}}(T) = \\sigma_0$。\n使用增量旋转 $R(\\Delta t) = R(0) = I$ 的数值方案得出 $\\sigma_{n+1} = I \\sigma_n I^{\\mathsf{T}} = \\sigma_n$，所以最终的数值应力也是 $\\sigma_{\\mathrm{J}}(T) = \\sigma_0$。\n数值解与精确解之间的误差为零，这证实了该列式的一致性。测试是检查这个误差范数是否低于容差 $T_{\\mathrm{tol}}$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Performs verifications of Total and Updated Lagrangian formulations\n    under rigid body rotation as specified in the problem statement.\n    \"\"\"\n    # Define problem parameters\n    \n    # Material parameters (for conceptual completeness in TL, but not used in calculation)\n    # E_Y_val = 10000.0  # kPa\n    # nu_val = 0.25\n    \n    # Tolerance\n    T_tol = 1e-10  # kPa\n    \n    # Initial stress for UL tests\n    sigma_0_ul = np.diag([120.0, 80.0, 60.0])  # kPa\n\n    def get_R_z(theta_rad):\n        \"\"\"\n        Computes the 3D rotation matrix about the z-axis.\n        \n        Args:\n            theta_rad (float): Rotation angle in radians.\n            \n        Returns:\n            numpy.ndarray: The 3x3 rotation matrix.\n        \"\"\"\n        c = np.cos(theta_rad)\n        s = np.sin(theta_rad)\n        return np.array([\n            [c, -s, 0.0],\n            [s,  c, 0.0],\n            [0.0, 0.0, 1.0]\n        ])\n\n    results = []\n\n    # --- Task 1: Total Lagrangian Invariance Test ---\n    # A rigid rotation should induce no stress in a stress-free body.\n    theta_tl = np.pi / 3.0  # rad\n    R_tl = get_R_z(theta_tl)\n    \n    # Deformation gradient for rigid rotation\n    F_tl = R_tl\n    \n    # Right Cauchy-Green deformation tensor\n    C_tl = F_tl.T @ F_tl\n    \n    # Green-Lagrange strain tensor\n    I = np.identity(3)\n    E_tl = 0.5 * (C_tl - I)\n    \n    # Second Piola-Kirchhoff stress. Since E=0, S=C:E=0.\n    S_tl = np.zeros((3, 3))\n    \n    # Cauchy stress (push-forward). J = det(F) = det(R) = 1.\n    sigma_tl = R_tl @ S_tl @ R_tl.T\n    \n    # Check if the norm of the resulting stress is below tolerance\n    norm_sigma_tl = np.linalg.norm(sigma_tl)\n    results.append(norm_sigma_tl = T_tol)\n\n    # --- UL Test Parameters ---\n    omega_z_ul = np.pi      # rad/s\n    T_ul = 0.5              # s\n    dt_ul = 0.01            # s\n\n    # --- Task 2: Updated Lagrangian Objective Rate Test (Jaumann) ---\n    # Integrate stress evolution using an objective corotational update.\n    num_steps = int(round(T_ul / dt_ul))\n    d_theta_ul = omega_z_ul * dt_ul\n    R_dt_ul = get_R_z(d_theta_ul)\n\n    sigma_j_numerical = np.copy(sigma_0_ul)\n    for _ in range(num_steps):\n        sigma_j_numerical = R_dt_ul @ sigma_j_numerical @ R_dt_ul.T\n\n    # Calculate the exact solution for comparison\n    theta_total_ul = omega_z_ul * T_ul\n    R_T_ul = get_R_z(theta_total_ul)\n    sigma_exact = R_T_ul @ sigma_0_ul @ R_T_ul.T\n\n    # Calculate the Frobenius norm of the error\n    error_j = sigma_j_numerical - sigma_exact\n    norm_error_j = np.linalg.norm(error_j)\n    results.append(norm_error_j)\n\n    # --- Task 3: Updated Lagrangian Non-Objective Rate Test ---\n    # Assume stress does not change (incorrect, non-objective formulation).\n    sigma_no = sigma_0_ul\n    \n    # Calculate the Frobenius norm of the error against the exact solution\n    error_no = sigma_no - sigma_exact\n    norm_error_no = np.linalg.norm(error_no)\n    results.append(norm_error_no)\n\n    # --- Task 4: Edge Case with Zero Spin ---\n    # Verify that the Jaumann update correctly handles the case of no rotation.\n    omega_z_zero = 0.0\n    \n    d_theta_zero = omega_z_zero * dt_ul  # This is 0\n    R_dt_zero = get_R_z(d_theta_zero)  # This is the identity matrix\n\n    sigma_j_zero_numerical = np.copy(sigma_0_ul)\n    for _ in range(num_steps): # This loop is for completeness, R is identity\n        sigma_j_zero_numerical = R_dt_zero @ sigma_j_zero_numerical @ R_dt_zero.T\n\n    # Exact solution for zero spin is the initial stress\n    sigma_exact_zero = np.copy(sigma_0_ul)\n\n    # Calculate the Frobenius norm of the error\n    error_j_zero = sigma_j_zero_numerical - sigma_exact_zero\n    norm_error_j_zero = np.linalg.norm(error_j_zero)\n    results.append(norm_error_j_zero = T_tol)\n    \n    # Format and print the final output\n    formatted_results = [\n        str(results[0]),\n        f\"{results[1]:.6f}\",\n        f\"{results[2]:.6f}\",\n        str(results[3])\n    ]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3568053"}, {"introduction": "在岩土力学中，对不排水土体或某些岩石等近不可压材料进行建模时，会遇到一个被称为“体积锁定”的严重数值问题。这种现象导致标准的有限元列表现得异常刚硬，从而得出不准确的预测。这个高级练习 [@problem_id:3568031] 将带您探索并比较为克服锁定问题而设计的多种先进技术，例如选择性减缩积分（SRI）和位移-压力（$u/p$）混合格式。通过分析每种情况下刚度矩阵的条件数，您将掌握为复杂岩土材料开发稳健模拟的实用技能。", "problem": "您的任务是设计并实现一个计算实验，用以研究与近不可压缩地质力学材料相关的大变形格式中的数值病态问题，特别是更新拉格朗日（UL）格式中的体积锁定现象。您需要提出并实现一种用于UL的​​选择性减缩积分（SRI）策略，并将其条件数行为与总拉格朗日（TL）框架下的位移-压力混合格式进行比较。您的程序必须是一个完整、可运行的实现，能够计算出可供直接比较的量化指标。\n\n物理和数学设置如下。考虑一个处于平面应变状态下的二维四节点双线性四边形有限元（通常称为Q4单元），其节点在参考构型中位于边长为 $L$ 的正方形的角点上。设参考构型中的节点坐标为 $\\left(0,0\\right)$、$\\left(L,0\\right)$、$\\left(L,L\\right)$ 和 $\\left(0,L\\right)$，单位为米。考虑一种各向同性、线弹性、近不可压缩的材料。令 $\\nu$ 表示泊松比，$\\mu$ 表示剪切模量，$\\lambda$ 表示第一拉梅参数。各向同性材料在平面应变下的本构张量可以使用拉梅参数表示，其中 $\\mu$ 直接为剪切模量，而 $\\lambda$ 与 $\\nu$ 和 $\\mu$ 的关系为 $\\lambda = \\dfrac{2\\mu\\nu}{1-2\\nu}$。平面应变下的体积模量 $\\kappa$ 为 $\\kappa = \\lambda + \\mu$。所有材料参数的单位均为帕斯卡（Pascals）。\n\n您的推导必须从虚功原理以及从参考单元到物理单元的运动学映射开始。您必须使用并明确遵循的基本原则包括：\n- 虚功原理：$\\delta W = \\int_{\\Omega_0} \\mathbf{S} : \\delta \\mathbf{E} \\,\\mathrm{d}\\Omega_0 - \\delta W_{\\mathrm{ext}} = 0$，其中 $\\mathbf{S}$ 是第二类Piola-Kirchhoff应力张量，$\\mathbf{E}$ 是Green-Lagrange应变张量（开始时不要假设小应变；在指定单元矩阵时可以进行线性化）。\n- 有限元离散：在自然坐标 $\\xi,\\eta \\in [-1,1]$ 的参考正方形上使用双线性形函数，并通过雅可比矩阵的精确映射构造标准的应变-位移矩阵 $B$。\n- 平面应变假设：面外应变为零，面内本构行为简化为一个关联 $\\left(\\varepsilon_{xx},\\varepsilon_{yy},\\gamma_{xy}\\right)$ 与 $\\left(\\sigma_{xx},\\sigma_{yy},\\tau_{xy}\\right)$ 的 $3\\times3$ 张量。\n\n您必须实现并比较以下格式：\n1. 采用完全积分的总拉格朗日（TL）纯位移格式。使用在 $[-1,1]^2$ 上的完全 $2\\times2$ 高斯求积来组装单元刚度矩阵 $K^{\\mathrm{TL}}$。\n2. 采用选择性减缩积分（SRI）的更新拉格朗日（UL）纯位移格式。将材料张量分解为体积部分（与 $\\lambda$ 成正比）和偏量部分（与 $\\mu$ 成正比），并组装\n   $$K^{\\mathrm{UL,SRI}} = \\int B^\\top D_{\\mu} B \\,\\mathrm{d}\\Omega + \\int B^\\top D_{\\lambda} B \\,\\mathrm{d}\\Omega,$$\n   其中偏量贡献 $\\int B^\\top D_{\\mu} B \\,\\mathrm{d}\\Omega$ 必须使用完全 $2\\times2$ 高斯求积进行积分，而体积贡献 $\\int B^\\top D_{\\lambda} B \\,\\mathrm{d}\\Omega$ 必须在单元中心使用带适当权重的减缩 $1\\times1$ 高斯求积进行积分。对于小的增量步，一致地处理UL映射；为了在单个单元上进行条件数研究，您可以在参考构型中进行线性化。\n3. 总拉格朗日（TL）位移-压力（$u/p$）混合格式，每个单元带有一个常数压力自由度（记为 $p$）和双线性位移。使用压力场，通过鞍点结构替换体积能。构建分块系统\n   $$\\begin{bmatrix} K_{\\mathrm{dev}}  H^\\top \\\\ H  -\\frac{1}{\\kappa} M \\end{bmatrix} \\begin{bmatrix} \\mathbf{u} \\\\ p \\end{bmatrix} = \\begin{bmatrix} \\mathbf{f}_u \\\\ f_p \\end{bmatrix},$$\n   其中 $K_{\\mathrm{dev}}$ 是使用完全积分组装的偏量刚度， $H$ 是从体积应变算子 $\\mathrm{tr}_2(\\varepsilon) = \\varepsilon_{xx} + \\varepsilon_{yy}$ 和常数压力形函数得到的耦合矩阵， $M$ 是标量类质量项 $\\int 1\\cdot1\\,\\mathrm{d}\\Omega$，等于单元面积。$H$ 和 $M$ 的积分必须使用完全 $2\\times2$ 高斯求积。不施加外部荷载；目标是研究内部算子的条件数。\n\n为消除刚体模态，通过固定以下节点自由度来施加本质边界条件（单位：米）：\n- 位于 $\\left(0,0\\right)$ 的节点：固定 $u_x$ 和 $u_y$。\n- 位于 $\\left(L,0\\right)$ 的节点：仅固定 $u_y$。\n- 位于 $\\left(0,L\\right)$ 的节点：仅固定 $u_x$。\n这些约束必须相同地应用于所有三种格式。在混合格式中，压力自由度不受边界条件约束，并保留为算子的一部分。\n\n对于每个组装好的算子，计算其在谱范数下的矩阵条件数（最大奇异值与最小奇异值之比）。对于混合格式，分块矩阵是不定的；使用奇异值分解来定义条件数。\n\n您的程序必须为以下参数测试套件实现上述内容，所有参数均量纲一致且科学上合理：\n- 测试用例1（正常可压缩）：$\\nu = 0.3$，$\\mu = 1.0\\times 10^6$ Pa，$L = 1$ m。\n- 测试用例2（近不可压缩）：$\\nu = 0.499$，$\\mu = 1.0\\times 10^6$ Pa，$L = 1$ m。\n- 测试用例3（非常近不可压缩）：$\\nu = 0.4999$，$\\mu = 1.0\\times 10^6$ Pa，$L = 1$ m。\n- 测试用例4（软剪切，可压缩）：$\\nu = 0.3$，$\\mu = 1.0\\times 10^3$ Pa，$L = 1$ m。\n\n对于每个测试用例，您的程序必须按以下顺序输出一个包含三个浮点数的列表：\n$[\\mathrm{cond}(K^{\\mathrm{TL}}), \\mathrm{cond}(K^{\\mathrm{UL,SRI}}), \\mathrm{cond}(\\text{mixed TL block})]$。\n最后，将所有测试用例的结果汇总到单行输出中，格式为由逗号分隔的各用例列表，并用方括号括起来，例如：\n\"[[1.23,4.56,7.89],[...],[...],[...]]\"。\n不得打印任何额外文本。\n\n不需要外部数据。不涉及角度。所有输出都是无量纲的，因此条件数不需要单位。请遵循此指令块中其他地方指定的约束，用Python实现完整的程序。其正确性将通过评估整个测试套件中算子的数值条件数来评定。", "solution": "用户的要求是执行一个计算实验，以比较单个Q4平面应变单元在三种不同有限元格式下的条件数，特别关注在近不可压缩条件下的行为。这三种格式是：\n1. 采用完全（$2 \\times 2$）高斯求积的标准总拉格朗日（TL）纯位移格式。\n2. 采用选择性减缩积分（SRI）的更新拉格朗日（UL）格式，其中刚度矩阵被分为一个用 $2 \\times 2$ 求积积分的偏量部分和一个用 $1 \\times 1$ 求积积分的体积部分。\n3. 每个单元具有恒定压力场的位移-压力（$u/p$）混合总拉格朗日格式。\n\n目标是在施加边界条件以消除刚体模态后，计算每种格式所得单元刚度矩阵的条件数。此比较将针对一套旨在测试可压缩和近不可压缩材料的材料参数进行。\n\n该问题被判定为**有效**。它在科学上基于计算连续介质力学的原理，问题设定良好，包含所有必要的数据和边界条件，并提出了一个非平凡但可行的计算任务。\n\n以下是分步推导和实现计划。\n\n### **1. 有限元预备知识**\n\n我们考虑一个边长为 $L$ 的方形4节点四边形单元。在参考构型 $\\Omega_0$ 中的节点坐标为 $(0,0)$, $(L,0)$, $(L,L)$, 和 $(0,L)$。从自然坐标系 $(\\xi, \\eta) \\in [-1,1]^2$ 到物理坐标系 $(x,y)$ 的映射由 $x = \\sum N_i(\\xi, \\eta) x_i$ 和 $y = \\sum N_i(\\xi, \\eta) y_i$ 给出，其中 $N_i$ 是双线性形函数：\n$$\n\\begin{aligned}\nN_1(\\xi, \\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta) \\\\\nN_2(\\xi, \\eta) = \\frac{1}{4}(1+\\xi)(1-\\eta) \\\\\nN_3(\\xi, \\eta) = \\frac{1}{4}(1+\\xi)(1+\\eta) \\\\\nN_4(\\xi, \\eta) = \\frac{1}{4}(1-\\xi)(1+\\eta)\n\\end{aligned}\n$$\n对于指定的几何形状，此映射简化为 $x = \\frac{L}{2}(1+\\xi)$ 和 $y = \\frac{L}{2}(1+\\eta)$。该变换的雅可比矩阵是一个常数对角矩阵：\n$$\n\\mathbf{J} = \\begin{bmatrix} \\partial x / \\partial \\xi  \\partial y / \\partial \\xi \\\\ \\partial x / \\partial \\eta  \\partial y / \\partial \\eta \\end{bmatrix} = \\begin{bmatrix} L/2  0 \\\\ 0  L/2 \\end{bmatrix}\n$$\n雅可比矩阵的行列式是 $\\det(\\mathbf{J}) = L^2/4$。\n\n应变-位移矩阵 $\\mathbf{B}$ 将节点位移向量 $\\mathbf{u}$ 与应变向量 $\\boldsymbol{\\varepsilon} = [\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}]^T$ 关联起来，即 $\\boldsymbol{\\varepsilon} = \\mathbf{B}\\mathbf{u}$。对于位移为 $(u_{ix}, u_{iy})$ 的单个节点 $i$，其对 $\\mathbf{B}$ 的贡献为：\n$$\n\\mathbf{B}_i = \\begin{bmatrix} \\partial N_i / \\partial x  0 \\\\ 0  \\partial N_i / \\partial y \\\\ \\partial N_i / \\partial y  \\partial N_i / \\partial x \\end{bmatrix}\n$$\n其中相对于物理坐标的导数使用链式法则求得：$\\begin{pmatrix} \\partial/\\partial x \\\\ \\partial/\\partial y \\end{pmatrix} = \\mathbf{J}^{-1} \\begin{pmatrix} \\partial/\\partial \\xi \\\\ \\partial/\\partial \\eta \\end{pmatrix}$。完整的 $\\mathbf{B}$ 矩阵是一个 $3 \\times 8$ 的矩阵，由 $i=1, \\dots, 4$ 的 $\\mathbf{B}_i$ 拼接而成。\n\n### **2. 本构关系**\n\n对于平面应变下的各向同性线弹性材料，应力-应变关系 $\\boldsymbol{\\sigma} = \\mathbf{D}\\boldsymbol{\\varepsilon}$ 由本构矩阵 $\\mathbf{D}$ 定义：\n$$\n\\mathbf{D} = \\begin{bmatrix} \\lambda + 2\\mu  \\lambda  0 \\\\ \\lambda  \\lambda + 2\\mu  0 \\\\ 0  0  \\mu \\end{bmatrix}\n$$\n这里，$\\mu$ 是剪切模量，$\\lambda$ 是第一拉梅参数，由 $\\lambda = \\frac{2\\mu\\nu}{1-2\\nu}$ 给出，其中 $\\nu$ 是泊松比。当 $\\nu \\to 0.5$ 时，$\\lambda \\to \\infty$，这在标准的纯位移格式中会导致数值问题，这种现象被称为体积锁定。\n\n### **3. 格式实现**\n\n单元刚度矩阵 $\\mathbf{K}$ 源自虚功原理，通常通过在单元体积（或二维中的面积）上积分计算得出：$\\mathbf{K} = \\int_{\\Omega} \\mathbf{B}^T \\mathbf{D} \\mathbf{B} \\, \\mathrm{d}\\Omega$。在自然坐标系下，这变为：\n$$\n\\mathbf{K} = \\int_{-1}^{1}\\int_{-1}^{1} \\mathbf{B}(\\xi, \\eta)^T \\mathbf{D} \\mathbf{B}(\\xi, \\eta) \\det(\\mathbf{J}) \\, \\mathrm{d}\\xi \\mathrm{d}\\eta\n$$\n该积分使用高斯求积进行数值计算。\n\n**格式1：采用完全积分的总拉格朗日格式 ($K^{\\mathrm{TL}}$)**\n这是标准格式。刚度矩阵使用完整的本构矩阵 $\\mathbf{D}$ 进行组装，并使用 $2 \\times 2$ 高斯求积进行积分。\n\n**格式2：采用SRI的更新拉格朗日格式 ($K^{\\mathrm{UL,SRI}}$)**\n此格式旨在缓解体积锁定。刚度矩阵被分为两部分。根据问题描述，我们将 $\\mathbf{D}$ 分解为 $\\mathbf{D} = \\mathbf{D}_{\\mu} + \\mathbf{D}_{\\lambda}$，其中：\n$$\n\\mathbf{D}_{\\lambda} = \\lambda \\begin{bmatrix} 1  1  0 \\\\ 1  1  0 \\\\ 0  0  0 \\end{bmatrix}, \\quad \\mathbf{D}_{\\mu} = \\begin{bmatrix} 2\\mu  0  0 \\\\ 0  2\\mu  0 \\\\ 0  0  \\mu \\end{bmatrix}\n$$\n总刚度为 $K^{\\mathrm{UL,SRI}} = K_{\\mu} + K_{\\lambda}$，其中：\n- $K_{\\mu} = \\int \\mathbf{B}^T \\mathbf{D}_{\\mu} \\mathbf{B} \\, \\mathrm{d}\\Omega$ 使用完全 $2\\times2$ 求积进行积分。\n- $K_{\\lambda} = \\int \\mathbf{B}^T \\mathbf{D}_{\\lambda} \\mathbf{B} \\, \\mathrm{d}\\Omega$ 使用减缩 $1\\times1$ 求积（在单元中心）进行积分。\n\n**格式3：混合总拉格朗日格式 ($u/p$)**\n该格式引入一个独立的压力场 $p$（假设在单元上为常数）来处理体积约束。得到的线性系统具有鞍点结构：\n$$\n\\begin{bmatrix} \\mathbf{K}_{\\mathrm{dev}}  \\mathbf{H}^\\top \\\\ \\mathbf{H}  -\\frac{1}{\\kappa} M \\end{bmatrix} \\begin{bmatrix} \\mathbf{u} \\\\ p \\end{bmatrix} = \\mathbf{f}\n$$\n- $\\mathbf{K}_{\\mathrm{dev}} = \\int \\mathbf{B}^T \\mathbf{D}_{\\mu} \\mathbf{B} \\, \\mathrm{d}\\Omega$ 是偏量刚度，使用完全 $2 \\times 2$ 积分计算，与SRI格式一致。\n- $\\mathbf{H} = \\int [1, 1, 0] \\mathbf{B} \\, \\mathrm{d}\\Omega$ 是 $1 \\times 8$ 的耦合矩阵，使用 $2 \\times 2$ 求积进行积分。\n- $M = \\int 1 \\cdot 1 \\, \\mathrm{d}\\Omega = \\text{面积} = L^2$ 是一个标量项。\n- 平面应变下的体积模量为 $\\kappa = \\lambda + \\mu$。\n\n### **4. 边界条件与分析**\n为确保矩阵可逆，通过固定自由度（DOF）来抑制刚体运动：节点 $(0,0)$ 处的 $u_x, u_y$；节点 $(L,0)$ 处的 $u_y$；以及节点 $(0,L)$ 处的 $u_x$。对于纯位移格式，剩余的自由度为 $u_{2x}, u_{3x}, u_{3y}, u_{4y}$。对于混合格式，压力自由度也是自由的，从而得到一个具有5个自由度的系统。\n\n对于三个得到的缩减矩阵中的每一个，条件数计算为最大奇异值与最小奇异值之比。这提供了矩阵条件数的一个量化度量，预计当 $\\nu \\to 0.5$ 时，标准格式的条件数会恶化。\n\n实现将循环遍历指定的测试用例，为每个用例计算三个条件数，并将输出格式化为列表的列表。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef get_B_matrix(xi, eta, L):\n    \"\"\"\n    Computes the strain-displacement matrix B for a Q4 element at a given\n    natural coordinate (xi, eta).\n    \n    Nodes are ordered: (0,0), (L,0), (L,L), (0,L) for nodes 1,2,3,4.\n    \"\"\"\n    \n    # Derivatives of shape functions w.r.t. natural coordinates (xi, eta)\n    # Shape: (4, 2), where rows are nodes 1-4, cols are d/dxi, d/deta\n    dN_dxi_deta = 0.25 * np.array([\n        [-(1 - eta), -(1 - xi)],  # Node 1\n        [ (1 - eta), -(1 + xi)],  # Node 2\n        [ (1 + eta),  (1 + xi)],  # Node 3\n        [-(1 + eta),  (1 - xi)]   # Node 4\n    ])\n    \n    # Jacobian for the square element [0,L]x[0,L] is constant.\n    # J_inv = [[2/L, 0], [0, 2/L]].\n    # Derivatives w.r.t physical coordinates (x,y) are obtained by scaling.\n    dN_dx_dy = dN_dxi_deta * (2.0 / L) # Uses broadcasting\n    \n    # Assemble the 3x8 strain-displacement matrix B for plane strain\n    B = np.zeros((3, 8))\n    for i in range(4):\n        # B_i = [[dNi_dx, 0], [0, dNi_dy], [dNi_dy, dNi_dx]]\n        B[0, 2 * i]     = dN_dx_dy[i, 0]  # strain_xx contribution from ux_i\n        B[1, 2 * i + 1] = dN_dx_dy[i, 1]  # strain_yy contribution from uy_i\n        B[2, 2 * i]     = dN_dx_dy[i, 1]  # strain_xy contribution from ux_i\n        B[2, 2 * i + 1] = dN_dx_dy[i, 0]  # strain_xy contribution from uy_i\n        \n    return B\n\ndef solve_case(nu, mu, L):\n    \"\"\"\n    Computes condition numbers for the three FE formulations for one test case.\n    \"\"\"\n    # 1. Preliminaries\n    # Material parameters\n    if nu >= 0.5:\n        # Avoid division by zero for the incompressible limit\n        # A large number will suffice to show locking\n        lambda_ = 1e12 * mu \n    else:\n        lambda_ = (2.0 * mu * nu) / (1.0 - 2.0 * nu)\n    \n    # Plane strain bulk modulus\n    kappa_ps = lambda_ + mu\n    \n    # Constitutive matrices for plane strain\n    D_full = np.array([\n        [lambda_ + 2 * mu, lambda_, 0],\n        [lambda_         , lambda_ + 2 * mu, 0],\n        [0               , 0,                mu]\n    ])\n    \n    D_lambda = np.array([\n        [lambda_, lambda_, 0],\n        [lambda_, lambda_, 0],\n        [0,       0,       0]\n    ])\n    \n    D_mu = np.array([\n        [2 * mu, 0,    0],\n        [0,    2 * mu, 0],\n        [0,    0,    mu]\n    ])\n    \n    # Geometry and Integration\n    detJ = (L / 2.0)**2\n    gp_val = 1.0 / np.sqrt(3.0)\n    gauss_points_2x2 = [(-gp_val, -gp_val), (gp_val, -gp_val), (gp_val, gp_val), (-gp_val, gp_val)]\n    gauss_weights_2x2 = [1.0, 1.0, 1.0, 1.0]\n\n    # 2. Assemble Stiffness Matrices\n    # Formulation 1: TL Full Integration\n    K_tl_full = np.zeros((8, 8))\n    for i, (xi, eta) in enumerate(gauss_points_2x2):\n        w = gauss_weights_2x2[i]\n        B = get_B_matrix(xi, eta, L)\n        K_tl_full += B.T @ D_full @ B * detJ * w\n        \n    # Formulation 2: UL SRI\n    K_ul_sri_mu = np.zeros((8, 8))\n    for i, (xi, eta) in enumerate(gauss_points_2x2):\n        w = gauss_weights_2x2[i]\n        B = get_B_matrix(xi, eta, L)\n        K_ul_sri_mu += B.T @ D_mu @ B * detJ * w\n    \n    B_center = get_B_matrix(0.0, 0.0, L)\n    K_ul_sri_lambda = B_center.T @ D_lambda @ B_center * detJ * 4.0\n    K_ul_sri = K_ul_sri_mu + K_ul_sri_lambda\n    \n    # Formulation 3: TL Mixed u/p\n    K_dev = K_ul_sri_mu\n    H = np.zeros((1, 8))\n    vol_op = np.array([[1.0, 1.0, 0.0]])\n    for i, (xi, eta) in enumerate(gauss_points_2x2):\n        w = gauss_weights_2x2[i]\n        B = get_B_matrix(xi, eta, L)\n        H += vol_op @ B * detJ * w\n        \n    M = L**2\n    \n    K_mixed = np.zeros((9, 9))\n    K_mixed[0:8, 0:8] = K_dev\n    K_mixed[0:8, 8] = H.T.flatten()\n    K_mixed[8, 0:8] = H.flatten()\n    K_mixed[8, 8] = -M / kappa_ps if abs(kappa_ps) > 1e-12 else 0.0\n    \n    # 3. Apply BCs and Compute Condition Numbers\n    dofs_free = [2, 4, 5, 7] # Corresponds to u2x, u3x, u3y, u4y\n    ix_disp = np.ix_(dofs_free, dofs_free)\n    \n    # Cond(K_TL_full)\n    K_tl_reduced = K_tl_full[ix_disp]\n    cond_tl = np.linalg.cond(K_tl_reduced)\n    \n    # Cond(K_UL_SRI)\n    K_sri_reduced = K_ul_sri[ix_disp]\n    cond_sri = np.linalg.cond(K_sri_reduced)\n    \n    # Cond(K_mixed)\n    dofs_mixed_free = [2, 4, 5, 7, 8] # u2x, u3x, u3y, u4y, p\n    ix_mixed = np.ix_(dofs_mixed_free, dofs_mixed_free)\n    K_mixed_reduced = K_mixed[ix_mixed]\n    \n    s = np.linalg.svd(K_mixed_reduced, compute_uv=False)\n    cond_mixed = s[0] / s[-1] if abs(s[-1]) > 1e-15 else np.inf\n    \n    return [cond_tl, cond_sri, cond_mixed]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (0.3,    1.0e6, 1.0), # Case 1: Compressible\n        (0.499,  1.0e6, 1.0), # Case 2: Near incompressible\n        (0.4999, 1.0e6, 1.0), # Case 3: Very near incompressible\n        (0.3,    1.0e3, 1.0), # Case 4: Soft shear, compressible\n    ]\n\n    all_results = []\n    for case in test_cases:\n        nu, mu, L = case\n        result = solve_case(nu, mu, L)\n        all_results.append(result)\n\n    # Final print statement in the exact required format.\n    # Use str() and replace spaces to match the required '[[...],[...]]' format.\n    print(str(all_results).replace(\" \", \"\"))\n\nsolve()\n```", "id": "3568031"}]}