{"hands_on_practices": [{"introduction": "数值模拟的有效性取决于其对基本物理定律的遵守程度。本实践聚焦于一个关键的验证步骤：质量守恒检查。您将从理查兹方程出发，利用散度定理推导质量平衡的积分形式，然后将其应用于一个假设数据集以量化数值误差[@problem_id:3557197]。这项练习加强了连续偏微分方程与其离散形式之间的联系，为评估数值求解器的质量提供了一个切实的度量标准。", "problem": "考虑一个一维、刚性、均质的多孔柱，其占据的空间域为 $\\Omega = [0,L]$，横截面积恒为 $A$。该柱体中存在瞬态非饱和流，由理查兹方程（Richards' equation）模拟，其中体积含水量为 $\\theta(\\mathbf{x},t)$，达西通量（Darcy flux）为 $\\mathbf{q}(\\mathbf{x},t)$，单位总体积的体积源/汇项由 $S(\\mathbf{x},t)$ 表示。假设流体不可压缩且密度恒定，固体骨架不变形，因此质量守恒由连续性关系控制。在有限时间区间 $[0,T]$ 内，水相的累积质量平衡应在净边界流入/流出、内部源/汇以及储水量变化之间保持一致。从质量守恒原理和散度定理出发，推导时空积分平衡式，并定义在 $[0,T]$ 上的累积质量平衡误差残差 $E$，对于一个完全守恒的计算，该残差应恒为零。然后，对于以下具体的、科学上真实的情景，计算 $E$ 和归一化误差 $\\varepsilon$ 以评估质量守恒性。\n\n几何与数据：\n- 域长度 $L = 10\\,\\mathrm{m}$，横截面积 $A = 5\\,\\mathrm{m}^{2}$，因此总体积为 $V = A L$。\n- 最终时间 $T = 3600\\,\\mathrm{s}$。\n- 在 $[0,T]$ 时间内，边界通量在每个端面上均匀分布且不随时间变化。使用边界处的外向单位法向量 $\\mathbf{n}$：\n  - 在 $x=0$ 处：$\\mathbf{q}\\cdot\\mathbf{n} = -1.2 \\times 10^{-5}\\,\\mathrm{m/s}$（负号表示流入 $\\Omega$）。\n  - 在 $x=L$ 处：$\\mathbf{q}\\cdot\\mathbf{n} = +4.0 \\times 10^{-6}\\,\\mathrm{m/s}$（正号表示流出 $\\Omega$）。\n- 源项在空间上均匀且在时间上恒定：在 $\\Omega \\times [0,T]$ 上，$S(\\mathbf{x},t) = 1.0 \\times 10^{-7}\\,\\mathrm{s}^{-1}$。\n- 体积含水量在初始和最终时刻在空间上是均匀的：$\\theta(\\mathbf{x},0) = 0.20$ 和 $\\theta(\\mathbf{x},T) = 0.203$。\n\n任务：\n1. 使用质量守恒原理和散度定理，写出在 $[0,T]$ 上的时空积分水量平衡式，并确定理想值为零的累积质量平衡误差残差 $E$。\n2. 对于给定的数据，明确计算以下量值：\n   - 净边界水体积交换量 $\\displaystyle \\int_{0}^{T}\\int_{\\partial\\Omega} \\mathbf{q}\\cdot\\mathbf{n}\\, d\\Gamma\\, dt$。\n   - 累积源贡献量 $\\displaystyle \\int_{0}^{T}\\int_{\\Omega} S\\, d\\Omega\\, dt$。\n   - 储水量变化 $\\displaystyle \\int_{\\Omega}\\theta(\\mathbf{x},T)\\, d\\Omega - \\int_{\\Omega}\\theta(\\mathbf{x},0)\\, d\\Omega$。\n   - 使用你推导的表达式计算累积质量平衡误差残差 $E$。\n3. 定义一个无量纲的归一化误差 $\\varepsilon$，它通过将 $|E|$ 用一个有意义的正参考体积 $M_{\\mathrm{ref}}$（由物理上可加和的流入量和源项构成）进行归一化来得出，适用于报告瞬态模拟中的累积质量守恒性能（不要使用任何百分比表示法）。为给定数据计算 $\\varepsilon$。\n4. 阐述在非饱和流的高级计算岩土力学模拟中，一个科学上合理的 $\\varepsilon$ 可接受容差范围，并评估计算出的 $\\varepsilon$ 是否可接受。\n\n仅报告 $\\varepsilon$ 的值作为你的最终数值答案。将你的最终数值答案四舍五入到四位有效数字。以无量纲分数形式（无单位）表示最终答案。", "solution": "问题陈述已经过验证，被认为是科学上合理的、适定的、客观的和自洽的。所有提供的数据在物理上是现实的，并且足以进行所需的计算。\n\n分析始于不可压缩流体在不变形多孔介质中的质量守恒原理。在偏微分形式下，连续性方程（在此情境下也称为理查兹方程）表示为：\n$$\n\\frac{\\partial \\theta}{\\partial t} + \\nabla \\cdot \\mathbf{q} = S\n$$\n其中 $\\theta$ 是体积含水量（无量纲），$\\mathbf{q}$ 是达西通量矢量 [L/T]， $S$ 是体积源/汇项 [1/T]， $t$ 是时间 [T]， $\\nabla \\cdot$ 是散度算子 [1/L]。\n\n1. 累积质量平衡误差残差 $E$ 的推导\n\n为了推导时空积分水量平衡，我们首先将连续性方程在整个空间域 $\\Omega$ 上积分：\n$$\n\\int_{\\Omega} \\frac{\\partial \\theta}{\\partial t} \\,d\\Omega + \\int_{\\Omega} \\nabla \\cdot \\mathbf{q} \\,d\\Omega = \\int_{\\Omega} S \\,d\\Omega\n$$\n对通量项应用散度定理，我们将体积分转换成在边界 $\\partial\\Omega$ 上的面积分：\n$$\n\\int_{\\Omega} \\nabla \\cdot \\mathbf{q} \\,d\\Omega = \\int_{\\partial\\Omega} \\mathbf{q} \\cdot \\mathbf{n} \\,d\\Gamma\n$$\n其中 $\\mathbf{n}$ 是边界表面 $\\partial\\Omega$ 上的外向单位法向量。由于域 $\\Omega$ 是刚性的（不变形），时间导数可以移到空间积分之外（莱布尼茨积分法则）：\n$$\n\\int_{\\Omega} \\frac{\\partial \\theta}{\\partial t} \\,d\\Omega = \\frac{d}{dt} \\int_{\\Omega} \\theta \\,d\\Omega\n$$\n将这些代回，得到整个域的瞬时质量平衡：\n$$\n\\frac{d}{dt} \\int_{\\Omega} \\theta \\,d\\Omega + \\int_{\\partial\\Omega} \\mathbf{q} \\cdot \\mathbf{n} \\,d\\Gamma = \\int_{\\Omega} S \\,d\\Omega\n$$\n接下来，我们在时间区间 $[0, T]$ 上对该方程进行积分：\n$$\n\\int_{0}^{T} \\left( \\frac{d}{dt} \\int_{\\Omega} \\theta \\,d\\Omega \\right) dt + \\int_{0}^{T} \\left( \\int_{\\partial\\Omega} \\mathbf{q} \\cdot \\mathbf{n} \\,d\\Gamma \\right) dt = \\int_{0}^{T} \\left( \\int_{\\Omega} S \\,d\\Omega \\right) dt\n$$\n根据微积分基本定理，第一项的计算结果是从 $t=0$ 到 $t=T$ 域中总储水量的变化：\n$$\n\\int_{0}^{T} \\left( \\frac{d}{dt} \\int_{\\Omega} \\theta \\,d\\Omega \\right) dt = \\left[ \\int_{\\Omega} \\theta \\,d\\Omega \\right]_{t=0}^{t=T} = \\int_{\\Omega} \\theta(\\mathbf{x}, T) \\,d\\Omega - \\int_{\\Omega} \\theta(\\mathbf{x}, 0) \\,d\\Omega\n$$\n对于一个完全守恒的数值模拟或解析解，积分平衡必须精确成立。累积质量平衡误差残差 $E$ 定义为将所有项移到一边时表达式的值。一个非零的 $E$ 量化了整个模拟期间的总质量守恒误差。\n$$\nE = \\left( \\int_{\\Omega}\\theta(\\mathbf{x},T)\\, d\\Omega - \\int_{\\Omega}\\theta(\\mathbf{x},0)\\, d\\Omega \\right) + \\int_{0}^{T}\\int_{\\partial\\Omega} \\mathbf{q}\\cdot\\mathbf{n}\\, d\\Gamma\\, dt - \\int_{0}^{T}\\int_{\\Omega} S\\, d\\Omega\\, dt\n$$\n该表达式定义了理想值为零的残差 $E$。它代表（储量变化）+（净流出量）-（总源量）= $0$。\n\n2. 对给定数据计算各量值\n\n问题是一维的，域为 $\\Omega = [0,L]$，长度 $L = 10\\,\\mathrm{m}$，横截面积 $A = 5\\,\\mathrm{m}^{2}$。总体积为 $V = A L = 50\\,\\mathrm{m}^{3}$。边界 $\\partial\\Omega$ 由 $x=0$ 和 $x=L$ 处的两个面组成。\n\n- **净边界水体积交换量：**\n边界通量不随时间变化，且在各个面上是均匀的。积分可简化为：\n$$\n\\int_{0}^{T}\\int_{\\partial\\Omega} \\mathbf{q}\\cdot\\mathbf{n}\\, d\\Gamma\\, dt = \\int_{0}^{T} \\left[ (\\mathbf{q}\\cdot\\mathbf{n}|_{x=L})A + (\\mathbf{q}\\cdot\\mathbf{n}|_{x=0})A \\right] dt\n$$\n根据给定值，$(\\mathbf{q}\\cdot\\mathbf{n}|_{x=L}) = 4.0 \\times 10^{-6}\\,\\mathrm{m/s}$ 和 $(\\mathbf{q}\\cdot\\mathbf{n}|_{x=0}) = -1.2 \\times 10^{-5}\\,\\mathrm{m/s}$，以及 $T = 3600\\,\\mathrm{s}$：\n$$\nM_{\\text{boundary}} = A T \\left( (\\mathbf{q}\\cdot\\mathbf{n}|_{x=L}) + (\\mathbf{q}\\cdot\\mathbf{n}|_{x=0}) \\right) \\\\\nM_{\\text{boundary}} = (5\\,\\mathrm{m}^2)(3600\\,\\mathrm{s}) \\left( 4.0 \\times 10^{-6}\\,\\mathrm{m/s} - 1.2 \\times 10^{-5}\\,\\mathrm{m/s} \\right) \\\\\nM_{\\text{boundary}} = 18000 \\left( -8.0 \\times 10^{-6} \\right) \\mathrm{m}^3 = -0.144\\,\\mathrm{m}^3\n$$\n该项代表在时间段 $[0, T]$ 内从域中流出的净体积量。负号表示净流入。\n\n- **累积源贡献量：**\n源项 $S = 1.0 \\times 10^{-7}\\,\\mathrm{s}^{-1}$ 在空间和时间上是均匀的。\n$$\nM_{\\text{source}} = \\int_{0}^{T}\\int_{\\Omega} S\\, d\\Omega\\, dt = S \\cdot V \\cdot T \\\\\nM_{\\text{source}} = (1.0 \\times 10^{-7}\\,\\mathrm{s}^{-1})(50\\,\\mathrm{m}^3)(3600\\,\\mathrm{s}) = 0.018\\,\\mathrm{m}^3\n$$\n\n- **储水量变化：**\n初始和最终含水量 $\\theta(\\mathbf{x},0) = 0.20$ 和 $\\theta(\\mathbf{x},T) = 0.203$ 在空间上是均匀的。\n$$\n\\Delta M_{\\text{storage}} = \\int_{\\Omega}\\theta(\\mathbf{x},T)\\, d\\Omega - \\int_{\\Omega}\\theta(\\mathbf{x},0)\\, d\\Omega = (\\theta(T) - \\theta(0))V \\\\\n\\Delta M_{\\text{storage}} = (0.203 - 0.20)(50\\,\\mathrm{m}^3) = (0.003)(50\\,\\mathrm{m}^3) = 0.15\\,\\mathrm{m}^3\n$$\n\n- **累积质量平衡误差残差 $E$：**\n将计算出的值代入 $E$ 的表达式：\n$$\nE = \\Delta M_{\\text{storage}} + M_{\\text{boundary}} - M_{\\text{source}} \\\\\nE = 0.15\\,\\mathrm{m}^3 + (-0.144\\,\\mathrm{m}^3) - 0.018\\,\\mathrm{m}^3 = -0.012\\,\\mathrm{m}^3\n$$\n\n3. 归一化误差 $\\varepsilon$ 的定义与计算\n\n无量纲归一化误差 $\\varepsilon$ 是通过将残差的绝对值 $|E|$ 用一个参考体积 $M_{\\text{ref}}$ 进行归一化来定义的。问题规定 $M_{\\text{ref}}$ 是一个由可加和的流入量和源项构成的物理上有意义的体积。系统的水输入是在 $x=0$ 处的流入量和内部源 $S$。\n\n- **总流入体积：** $x=0$ 处的流入通量由 $\\mathbf{q}\\cdot\\mathbf{n} = -1.2 \\times 10^{-5}\\,\\mathrm{m/s}$ 给出。负号表示流入。体积速率为 $|-1.2 \\times 10^{-5}\\,\\mathrm{m/s}| \\times A = (1.2 \\times 10^{-5}\\,\\mathrm{m/s}) \\times (5\\,\\mathrm{m}^2) = 6.0 \\times 10^{-5}\\,\\mathrm{m}^3/\\mathrm{s}$。\n在时间 $T$ 内，该流入产生的总体积为：\n$$ V_{\\text{inflow}} = (6.0 \\times 10^{-5}\\,\\mathrm{m}^3/\\mathrm{s}) \\times (3600\\,\\mathrm{s}) = 0.216\\,\\mathrm{m}^3 $$\n- **总源体积：** 这就是先前计算的 $M_{\\text{source}} = 0.018\\,\\mathrm{m}^3$。\n\n参考体积 $M_{\\text{ref}}$ 是所有输入的总和：\n$$\nM_{\\text{ref}} = V_{\\text{inflow}} + M_{\\text{source}} = 0.216\\,\\mathrm{m}^3 + 0.018\\,\\mathrm{m}^3 = 0.234\\,\\mathrm{m}^3\n$$\n归一化误差 $\\varepsilon$ 为：\n$$\n\\varepsilon = \\frac{|E|}{M_{\\text{ref}}} = \\frac{|-0.012\\,\\mathrm{m}^3|}{0.234\\,\\mathrm{m}^3} = \\frac{0.012}{0.234} \\approx 0.05128205...\n$$\n四舍五入到四位有效数字，$\\varepsilon \\approx 0.05128$。\n\n4. 归一化误差评估\n\n在高级计算岩土力学和水文地质学中，保持较低的质量平衡误差对于确保模拟结果的物理真实性和可靠性至关重要。归一化误差 $\\varepsilon$ 为此提供了一个定量度量。$\\varepsilon$ 的可接受容差取决于具体应用，但对于高保真度的科学和工程模拟，通常期望误差非常小。\n- $\\varepsilon  10^{-4}$（或 $0.01\\%$）的值通常被认为是优秀的。\n- $\\varepsilon  10^{-3}$（或 $0.1\\%$）的值通常被认为是良好的。\n- $\\varepsilon  10^{-2}$（或 $1\\%$）的值对于某些筛选级模型可能是可接受的，但对于严谨的分析来说则偏高。\n\n计算值为 $\\varepsilon \\approx 0.05128$，相当于约 $5.1\\%$ 的质量平衡误差。该值显著高于高级模拟的典型容差水平。这样的误差将被认为是不可接受的，需要审查数值模型的参数，如时间步长、空间离散化（网格细化）以及非线性求解器的收敛标准，以改善计算的守恒性质。\n\n最终要求的答案是四舍五入到四位有效数字的 $\\varepsilon$ 数值。\n$$ \\varepsilon \\approx 0.05128 $$", "answer": "$$\\boxed{0.05128}$$", "id": "3557197"}, {"introduction": "将理论转化为一个可工作的模拟，需要仔细实现控制方程和边界条件。本练习将指导您构建一个理查兹方程的一维求解器，特别关注如何处理动态渗流面边界条件[@problem_id:3557198]。实现这类根据解的状态切换边界条件的逻辑，是计算岩土力学中的一个常见挑战，它能提供宝贵的动手编程经验。", "problem": "考虑在均质多孔介质中由Richards方程控制的一维水平非饱和水流。设 $x \\in [0,L]$ 表示水平坐标，其中 $x=0$ 为左边界，$x=L$ 为右边界。主要未知量是压力水头 $h(x,t)$，单位为米。体积含水量 $\\theta(h)$ 和非饱和导水率 $K(h)$ 由van Genuchten–Mualem模型给出，其参数为 $\\theta_r$、$\\theta_s$、$\\alpha$、$n$ 和 $K_s$，其中 $m=1-1/n$。控制方程为\n$$\nC(h)\\,\\frac{\\partial h}{\\partial t} \\;=\\; \\frac{\\partial}{\\partial x}\\left( K(h)\\,\\frac{\\partial h}{\\partial x}\\right),\n$$\n其中 $C(h)=\\frac{d\\theta}{dh}$ 是比持水能力。\n\n边界条件：\n- 在 $x=0$（左边界），施加一个恒定水头边界条件 $h(0,t)=h_{\\text{left}}$，对所有 $t$ 成立。\n- 在 $x=L$（右边界），施加一个动态边界，该边界在以下两种情况之间切换：\n  1) 当与边界相邻的单元中的水头 $h$ 超过阈值 $h_{\\text{thr}}$ 时，施加恒定水头边界 $h(L,t)=h_{\\text{const}}$，以及\n  2) 一个渗出面边界，定义如下：如果计算出的边界水头 $h(L,t)$ 变为正值，则设置 $h(L,t)=0$；否则，在边界上强制施加零通量（Neumann）条件。\n\n初始条件：\n- $h(x,0)=h_0$，对所有 $x \\in [0,L]$ 成立。\n\n本构关系 (van Genuchten–Mualem模型)：\n- 有效饱和度 $S_e(h)$ 定义为\n$$\nS_e(h) \\;=\\; \n\\begin{cases}\n\\left[1+(\\alpha |h|)^n\\right]^{-m},  h0,\\\\\n1,  h\\ge 0.\n\\end{cases}\n$$\n- 含水量 $\\theta(h)$ 为\n$$\n\\theta(h) \\;=\\; \\theta_r + (\\theta_s-\\theta_r)\\,S_e(h).\n$$\n- 比持水能力 $C(h)=\\frac{d\\theta}{dh}$ 为\n$$\nC(h) \\;=\\;\n\\begin{cases}\n(\\theta_s-\\theta_r)\\,m\\,n\\,\\alpha^n\\,|h|^{n-1}\\left[1+(\\alpha |h|)^n\\right]^{-m-1},  h0,\\\\\n\\varepsilon,  h\\ge 0,\n\\end{cases}\n$$\n其中 $\\varepsilon$ 是一个小的正则化常数，以防止在完全饱和状态下出现奇异行为。\n- 导水率 $K(h)$ 为\n$$\nK(h) \\;=\\;\n\\begin{cases}\nK_s\\,S_e(h)^{1/2}\\left[1-\\left(1-S_e(h)^{1/m}\\right)^m\\right]^2,  h0,\\\\\nK_s,  h\\ge 0.\n\\end{cases}\n$$\n\n数值离散化：\n- 使用具有 $N$ 个节点的均匀空间网格，间距为 $\\Delta x = L/(N-1)$，并采用步长为 $\\Delta t$ 的隐式后向欧拉时间步进法。\n- 对于节点 $i$ ($1 \\le i \\le N-2$)，使用界面导水率 $K_{i\\pm 1/2}$（相邻节点值的算术平均值）和中心差分格式来离散化散度项，以处理空间导数。\n- 对于左边界节点 ($i=0$)，强制 $h_0^{n+1}=h_{\\text{left}}$。\n- 对于右边界节点 ($i=N-1$)，强制执行以下条件之一：\n  - 恒定水头：$h_{N-1}^{n+1}=h_{\\text{const}}$。\n  - 渗出面：\n    - 如果边界水头变为正值，强制 $h_{N-1}^{n+1}=0$。\n    - 否则强制零通量：在 $x=L$ 处 $\\partial h/\\partial x=0$，这在最后一个控制体积中转化为一个单边离散平衡，即没有流出量穿过 $x=L$。\n\n动态边界算法 (移动边界逻辑)：\n- 在每个时间步内，使用定点迭代法对右边界进行分类：\n  1) 如果相邻节点水头 $h_{N-2}$ 超过阈值，即 $h_{N-2} \\ge h_{\\text{thr}}$，则将右边界设置为恒定水头：$h_{N-1}=h_{\\text{const}}$。\n  2) 否则，尝试渗出面逻辑：\n     - 在 $x=L$ 处以零通量条件求解，并评估边界水头 $h_{N-1}$。\n     - 如果 $h_{N-1}>0$，则强制 $h_{N-1}=0$（Dirichlet渗出面）并重新求解。\n     - 如果 $h_{N-1}\\le 0$，则保持零通量条件。\n- 将分类与非线性求解一起迭代，直到边界分类不再改变且水头更新的范数低于容差为止。\n\n通量计算与单位：\n- 在 $x=L$ 处的出流通量（单位为 $\\mathrm{m/s}$）应报告为\n$$\nq_{\\text{out}} \\;=\\;\n\\begin{cases}\n0,  \\text{如果在 } x=L \\text{ 处为零通量},\\\\\n-\\,K_{N-3/2}\\,\\dfrac{h_{N-1}-h_{N-2}}{\\Delta x},  \\text{如果在 } x=L \\text{ 处为Dirichlet条件},\n\\end{cases}\n$$\n其中 $K_{N-3/2}$ 是节点 $N-2$ 和 $N-1$ 之间内部界面的导水率。\n\n基本原理和推导要求：\n- 从质量守恒和Darcy定律出发，推导一维Richards方程。\n- 展示本构定律如何定义 $C(h)$ 和 $K(h)$。\n- 推导内部节点和边界节点的离散平衡方程，包括零通量和Dirichlet边界条件如何修改代数系统。\n- 解释动态边界分类逻辑，以及为什么它与物理上的渗出面概念和下游淹没条件相一致。\n\n测试套件：\n使用以下三个测试用例。所有参数值必须精确使用，所有量均采用国际单位制（SI units）。\n\n- 案例A（理想路径，下游水激活恒定水头）：\n  - $L = 1.0\\,\\mathrm{m}$，$N=50$，$\\Delta t = 10.0\\,\\mathrm{s}$，$T_{\\text{end}} = 600.0\\,\\mathrm{s}$。\n  - 土壤：$\\theta_r=0.10$，$\\theta_s=0.45$，$\\alpha=1.60\\,\\mathrm{m}^{-1}$，$n=1.60$，$K_s = 1.0\\times 10^{-5}\\,\\mathrm{m/s}$，$\\varepsilon=1.0\\times 10^{-8}$。\n  - 初始水头：$h_0=-1.0\\,\\mathrm{m}$。\n  - 左边界水头：$h_{\\text{left}}=0.5\\,\\mathrm{m}$。\n  - 右边界常数：$h_{\\text{const}}=0.2\\,\\mathrm{m}$，$h_{\\text{thr}}=-0.30\\,\\mathrm{m}$。\n\n- 案例B（渗出面启用，无下游水）：\n  - $L = 1.0\\,\\mathrm{m}$，$N=50$，$\\Delta t = 10.0\\,\\mathrm{s}$，$T_{\\text{end}} = 600.0\\,\\mathrm{s}$。\n  - 土壤：$\\theta_r=0.10$，$\\theta_s=0.45$，$\\alpha=1.60\\,\\mathrm{m}^{-1}$，$n=1.60$，$K_s = 1.0\\times 10^{-5}\\,\\mathrm{m/s}$，$\\varepsilon=1.0\\times 10^{-8}$。\n  - 初始水头：$h_0=-1.0\\,\\mathrm{m}$。\n  - 左边界水头：$h_{\\text{left}}=0.3\\,\\mathrm{m}$。\n  - 右边界常数：$h_{\\text{const}}=0.2\\,\\mathrm{m}$，$h_{\\text{thr}}=0.20\\,\\mathrm{m}$。\n\n- 案例C（边界情况，保持零通量）：\n  - $L = 1.0\\,\\mathrm{m}$，$N=50$，$\\Delta t = 10.0\\,\\mathrm{s}$，$T_{\\text{end}} = 600.0\\,\\mathrm{s}$。\n  - 土壤：$\\theta_r=0.10$，$\\theta_s=0.45$，$\\alpha=1.60\\,\\mathrm{m}^{-1}$，$n=1.60$，$K_s = 1.0\\times 10^{-5}\\,\\mathrm{m/s}$，$\\varepsilon=1.0\\times 10^{-8}$。\n  - 初始水头：$h_0=-1.0\\,\\mathrm{m}$。\n  - 左边界水头：$h_{\\text{left}}=-0.2\\,\\mathrm{m}$。\n  - 右边界常数：$h_{\\text{const}}=0.2\\,\\mathrm{m}$，$h_{\\text{thr}}=0.20\\,\\mathrm{m}$。\n\n最终输出格式：\n- 对于每个案例，生成一个三元组：最终的右边界分类代码（整数：$0$ 表示零通量，$1$ 表示渗出面 $h=0$，$2$ 表示恒定水头 $h=h_{\\text{const}}$），在 $x=L$ 处的最终出流通量（浮点数，单位 $\\mathrm{m/s}$），以及最终的右边界水头 $h(L,T_{\\text{end}})$（浮点数，单位米）。\n- 你的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表，按案例A、案例B、案例C的顺序连接结果，即 $[c_A,q_A,h_A,c_B,q_B,h_B,c_C,q_C,h_C]$。", "solution": "起点是可变形多孔介质中水的质量守恒，并将其特化为机械变形可忽略的一维水平流动。水的质量平衡表明，含水量的变化率等于Darcy通量的负散度。设 $\\theta(h)$ 为体积含水量，$q(h)$ 为Darcy通量，$C(h)=d\\theta/dh$。那么守恒方程变为\n$$\n\\frac{\\partial \\theta}{\\partial t} \\;=\\; -\\frac{\\partial q}{\\partial x}.\n$$\n在一维水平几何结构中，本构定律（Darcy定律）为\n$$\nq \\;=\\; -K(h)\\,\\frac{\\partial h}{\\partial x},\n$$\n其中 $K(h)$ 是非饱和导水率，$h$ 是压力水头。将 $q$ 代入守恒方程得到\n$$\n\\frac{\\partial \\theta}{\\partial t} \\;=\\; \\frac{\\partial}{\\partial x}\\left( K(h)\\,\\frac{\\partial h}{\\partial x}\\right).\n$$\n使用链式法则 $\\partial \\theta/\\partial t = C(h)\\,\\partial h/\\partial t$，我们得到一维Richards方程：\n$$\nC(h)\\,\\frac{\\partial h}{\\partial t} \\;=\\; \\frac{\\partial}{\\partial x}\\left( K(h)\\,\\frac{\\partial h}{\\partial x}\\right).\n$$\n\n对于van Genuchten–Mualem模型，有效饱和度 $S_e(h)$ 描述了毛细管持水特性：\n$$\nS_e(h)=\n\\begin{cases}\n\\left[1+(\\alpha |h|)^n\\right]^{-m},  h0,\\\\\n1,  h\\ge 0,\n\\end{cases}\n\\quad\nm=1-\\frac{1}{n},\\ \\alpha0,\\ n1.\n$$\n含水量为\n$$\n\\theta(h)=\\theta_r+(\\theta_s-\\theta_r)\\,S_e(h),\n$$\n比持水能力（含水量对水头的导数）为\n$$\nC(h)=\\frac{d\\theta}{dh}=\n\\begin{cases}\n(\\theta_s-\\theta_r)\\,m\\,n\\,\\alpha^n\\,|h|^{n-1}\\left[1+(\\alpha |h|)^n\\right]^{-m-1},  h0,\\\\\n\\varepsilon,  h\\ge 0,\n\\end{cases}\n$$\n其中 $\\varepsilon$ 是一个小的常数，用于在饱和条件下的数值正则化。Mualem导水率模型给出\n$$\nK(h)=\n\\begin{cases}\nK_s\\,S_e(h)^{\\tfrac{1}{2}}\\Big[1-\\big(1-S_e(h)^{1/m}\\big)^m\\Big]^2,  h0,\\\\\nK_s,  h\\ge 0.\n\\end{cases}\n$$\n\n我们使用 $N$ 个均匀间隔的节点对区域进行离散化，节点间距为 $\\Delta x = L/(N-1)$。设 $h_i^n$ 表示在节点 $i$ 和时间层 $n$ 的水头。Richards方程在节点 $i$ 的后向欧拉时间离散格式为\n$$\nC_i(h^k)\\,\\frac{h_i^{n+1}-h_i^n}{\\Delta t} \\;=\\; \\frac{1}{\\Delta x}\\left[ K_{i+\\tfrac{1}{2}}(h^k)\\,\\frac{h_{i+1}^{n+1} - h_i^{n+1}}{\\Delta x} - K_{i-\\tfrac{1}{2}}(h^k)\\,\\frac{h_{i}^{n+1} - h_{i-1}^{n+1}}{\\Delta x} \\right],\n$$\n其中 $h^k$ 是当前迭代的估计值（Picard线性化），$C_i(h^k)$ 是节点 $i$ 的持水能力，$K_{i\\pm \\tfrac{1}{2}}(h^k)$ 是通过算术平均近似的界面导水率\n$$\nK_{i+\\tfrac{1}{2}}(h^k) \\approx \\frac{K(h_i^k)+K(h_{i+1}^k)}{2}.\n$$\n重新整理后得到关于 $h^{n+1}$ 的线性系统：\n$$\n\\left( C_i/\\Delta t + \\frac{K_{i-\\tfrac{1}{2}}}{\\Delta x^2} + \\frac{K_{i+\\tfrac{1}{2}}}{\\Delta x^2} \\right) h_i^{n+1}\n- \\frac{K_{i-\\tfrac{1}{2}}}{\\Delta x^2} h_{i-1}^{n+1}\n- \\frac{K_{i+\\tfrac{1}{2}}}{\\Delta x^2} h_{i+1}^{n+1}\n\\;=\\; \\frac{C_i}{\\Delta t} h_i^n.\n$$\n\n边界条件嵌入到离散系统中：\n- 左边界 ($i=0$)：通过将第一行设置为单位矩阵，并将右侧项等于 $h_{\\text{left}}$，来强制施加Dirichlet条件 $h_0^{n+1}=h_{\\text{left}}$。\n- 右边界 ($i=N-1$)：\n  - 恒定水头：类似地，通过一个单位行来强制施加 $h_{N-1}^{n+1}=h_{\\text{const}}$。\n  - 渗出面：\n    - 如果 $h_{N-1}^{n+1}0$，强制施加 $h_{N-1}^{n+1}=0$（Dirichlet），对应于与大气接触。\n    - 否则，强制零通量：在 $x=L$ 处 $\\partial h/\\partial x=0$，其对于最后一个控制体积的离散形式将出流通量项设置为零。最后一个节点的平衡方程变为\n      $$\n      C_{N-1}\\,\\frac{h_{N-1}^{n+1}-h_{N-1}^n}{\\Delta t}\n      \\;=\\;\\frac{1}{\\Delta x}\\left[ K_{N-\\tfrac{3}{2}}\\,\\frac{h_{N-1}^{n+1}-h_{N-2}^{n+1}}{\\Delta x} - 0 \\right],\n      $$\n      从而产生一个单边模板，其系数 $K_{N-\\tfrac{3}{2}}/\\Delta x^2$ 将节点 $N-1$ 与节点 $N-2$ 连接起来，再加上持水能力项。\n\n每个时间步内的动态右边界分类算法：\n- 使用Picard迭代来处理非线性问题。初始化 $h^{n+1,(0)}=h^n$ 和一个初始的边界分类（从上一个时间步继承）。\n- 在每次Picard迭代 $k$ 中：\n  1) 计算节点上的 $C(h^{n+1,(k)})$ 和 $K(h^{n+1,(k)})$，以及界面导水率。\n  2) 试探性地对右边界进行如下分类：\n     - 如果相邻节点水头 $h_{N-2}^{n+1,(k)} \\ge h_{\\text{thr}}$，则设置为恒定水头：$h_{N-1}^{n+1}=h_{\\text{const}}$。\n     - 否则，以零通量条件求解。如果得到的边界水头 $h_{N-1}^{n+1,(k+1)}0$，则切换为Dirichlet渗出面 $h_{N-1}^{n+1}=0$ 并重新求解。如果 $h_{N-1}^{n+1,(k+1)}\\le 0$，则保持零通量。\n  3) 组装并求解关于 $h^{n+1,(k+1)}$ 的线性系统。\n  4) 检查收敛性：如果边界分类没有改变，并且 $\\|h^{n+1,(k+1)}-h^{n+1,(k)}\\|_\\infty$ 低于容差，则接受 $h^{n+1}=h^{n+1,(k+1)}$。\n  5) 如果未收敛，则使用更新后的分类重复迭代。\n- 此过程确保了移动边界（在恒定水头和渗出面形式之间切换）得到稳健处理：只有当分类与当前状态一致时才最终确定，从而避免了振荡。\n\n出流通量：\n- 在获得接受的 $h^{n+1}$ 后，报告在 $x=L$ 处的 $q_{\\text{out}}$（单位 $\\mathrm{m/s}$）：\n  $$\n  q_{\\text{out}} \\;=\\;\n  \\begin{cases}\n  0,  \\text{对于零通量分类},\\\\\n  -\\,K_{N-\\tfrac{3}{2}}\\,\\dfrac{h_{N-1}-h_{N-2}}{\\Delta x},  \\text{对于在 } x=L \\text{ 处的Dirichlet条件 (即 } h=0 \\text{ 或 } h=h_{\\text{const}} \\text{)}.\n  \\end{cases}\n  $$\n  该表达式使用最后一个界面上的内部通量，在离散有限体积意义上，当边界是Dirichlet条件时，该通量等于穿过边界的出流量。\n\n单位和输出：\n- 长度使用 $\\mathrm{m}$，时间使用 $\\mathrm{s}$，通量使用 $\\mathrm{m/s}$。\n- 对于每个测试用例，输出三元组 $(c,q,h)$，其中 $c \\in \\{0,1,2\\}$ 对边界分类进行编码（$0$ 表示零通量，$1$ 表示渗出面 $h=0$，$2$ 表示恒定水头），$q$ 是在 $x=L$ 处的最终出流通量（单位 $\\mathrm{m/s}$），$h$ 是最终的边界水头 $h(L,T_{\\text{end}})$（单位米）。\n- 将结果汇总为单行：$[c_A,q_A,h_A,c_B,q_B,h_B,c_C,q_C,h_C]$。\n\n算法考虑和稳健性：\n- 使用当前的 $C(h)$ 和 $K(h)$ 进行Picard线性化，避免了通过Newton方法求解完全非线性系统，并且对于一维问题中的中等时间步长是稳健的。\n- 边界分类在Picard循环内更新，并且只有当分类和水头增量都稳定时，循环才终止，这降低了移动边界发生非物​​理振荡的风险。\n- 饱和持水能力中的正则化项 $\\varepsilon$ 确保了当区域部分变为饱和（$h\\ge 0$）时，系统矩阵保持良态。", "answer": "```python\nimport numpy as np\n\ndef van_genuchten_theta(h, theta_r, theta_s, alpha, n):\n    m = 1.0 - 1.0 / n\n    theta = np.empty_like(h)\n    neg = h  0.0\n    Se = (1.0 + (alpha * np.abs(h[neg]))**n)**(-m)\n    theta[neg] = theta_r + (theta_s - theta_r) * Se\n    theta[~neg] = theta_s\n    return theta\n\ndef van_genuchten_C(h, theta_r, theta_s, alpha, n, eps):\n    m = 1.0 - 1.0 / n\n    C = np.empty_like(h)\n    neg = h  0.0\n    abs_h = np.abs(h[neg])\n    xi = (alpha * abs_h)**n\n    dSe_dh = m * n * alpha**n * abs_h**(n - 1.0) * (1.0 + xi)**(-m - 1.0)\n    C[neg] = (theta_s - theta_r) * dSe_dh\n    C[~neg] = eps\n    return C\n\ndef van_genuchten_K(h, Ks, alpha, n, theta_r, theta_s):\n    m = 1.0 - 1.0 / n\n    K = np.empty_like(h)\n    neg = h  0.0\n    Se = (1.0 + (alpha * np.abs(h[neg]))**n)**(-m)\n    term = 1.0 - (1.0 - Se**(1.0/m))**m\n    K[neg] = Ks * np.sqrt(Se) * term**2\n    K[~neg] = Ks\n    return K\n\ndef assemble_system(h_prev, h_iter, dx, dt, N, K_params, soil_params, left_head, bc_right_type, right_bc_value):\n    theta_r, theta_s, alpha, n, Ks, eps = soil_params\n    # Compute C and K at nodes\n    C = van_genuchten_C(h_iter, theta_r, theta_s, alpha, n, eps)\n    Knode = van_genuchten_K(h_iter, Ks, alpha, n, theta_r, theta_s)\n    # Face conductivities (arithmetic average)\n    Kface = np.empty(N-1)\n    Kface[:] = 0.5 * (Knode[:-1] + Knode[1:])\n    # Initialize system\n    A = np.zeros((N, N))\n    b = np.zeros(N)\n    # Left Dirichlet\n    A[0, 0] = 1.0\n    b[0] = left_head\n    # Interior nodes\n    for i in range(1, N-1):\n        a = Kface[i-1] / dx**2\n        c = Kface[i] / dx**2\n        A[i, i] = C[i] / dt + a + c\n        A[i, i-1] = -a\n        A[i, i+1] = -c\n        b[i] = C[i] / dt * h_prev[i]\n    # Right boundary\n    if bc_right_type == 'dirichlet':\n        A[N-1, N-1] = 1.0\n        b[N-1] = right_bc_value\n    elif bc_right_type == 'neumann_zero':\n        # Zero-flux: one-sided stencil for last control volume\n        a = Kface[N-2] / dx**2\n        A[N-1, N-1] = C[N-1] / dt + a\n        A[N-1, N-2] = -a\n        b[N-1] = C[N-1] / dt * h_prev[N-1]\n    else:\n        raise ValueError(\"Unknown right boundary type\")\n    return A, b, Kface\n\ndef solve_case(params):\n    # Unpack parameters\n    L = params['L']\n    N = params['N']\n    dt = params['dt']\n    T_end = params['T_end']\n    theta_r = params['theta_r']\n    theta_s = params['theta_s']\n    alpha = params['alpha']\n    n = params['n']\n    Ks = params['Ks']\n    eps = params['eps']\n    h0 = params['h0']\n    h_left = params['h_left']\n    h_const = params['h_const']\n    h_thr = params['h_thr']\n    dx = L / (N - 1)\n    soil_params = (theta_r, theta_s, alpha, n, Ks, eps)\n    # Initial condition\n    h = np.full(N, h0, dtype=float)\n    nsteps = int(np.round(T_end / dt))\n    # Right boundary classification codes: 0=zero-flux, 1=seepage Dirichlet (h=0), 2=constant head (h=h_const)\n    classification_code = 0\n    # For tracking in the last step\n    final_flux = 0.0\n    final_head_right = h[-1]\n    for step in range(nsteps):\n        h_prev = h.copy()\n        # Picard iteration with dynamic classification\n        max_iter = 50\n        tol = 1e-8\n        # Initialize classification guess based on neighbor threshold\n        # Use previous solution neighbor head\n        if h_prev[-2] >= h_thr:\n            bc_type = 'dirichlet'\n            bc_value = h_const\n        else:\n            bc_type = 'neumann_zero'\n            bc_value = None\n        # Iteration\n        last_bc_type = None\n        for k in range(max_iter):\n            # Assemble with current bc\n            A, b, Kface = assemble_system(h_prev, h, dx, dt, N, (Ks,), soil_params, h_left, bc_type, (bc_value if bc_type=='dirichlet' else 0.0))\n            # Solve linear system\n            h_new = np.linalg.solve(A, b)\n            # Determine updated classification\n            updated_bc_type = bc_type\n            updated_bc_value = bc_value\n            # Check constant head activation by neighbor threshold\n            if h_new[-2] >= h_thr:\n                updated_bc_type = 'dirichlet'\n                updated_bc_value = h_const\n            else:\n                # Seepage face logic\n                # If boundary head becomes positive, enforce atmospheric Dirichlet h=0\n                if bc_type == 'neumann_zero':\n                    # Using current neumann solve, evaluate boundary head\n                    if h_new[-1] > 0.0:\n                        updated_bc_type = 'dirichlet'\n                        updated_bc_value = 0.0\n                elif bc_type == 'dirichlet' and bc_value is not None and np.isclose(bc_value, 0.0):\n                    # Already seepage Dirichlet\n                    updated_bc_type = 'dirichlet'\n                    updated_bc_value = 0.0\n                else:\n                    # Keep zero-flux if not exceeding threshold and boundary head non-positive\n                    updated_bc_type = 'neumann_zero'\n                    updated_bc_value = None\n            # Check if classification changed; if so, rebuild and resolve in next iteration\n            h_diff_inf = np.max(np.abs(h_new - h))\n            classification_changed = (updated_bc_type != bc_type) or ((updated_bc_type == 'dirichlet') and (updated_bc_value != bc_value))\n            # Update iterate\n            h = h_new\n            bc_type = updated_bc_type\n            bc_value = updated_bc_value\n            # Convergence check: both classification stable and iterate small change\n            if (not classification_changed) and (h_diff_inf  tol):\n                break\n        # Store classification code for last step\n        if bc_type == 'neumann_zero':\n            classification_code = 0\n        elif bc_type == 'dirichlet':\n            if bc_value is not None and np.isclose(bc_value, 0.0):\n                classification_code = 1\n            else:\n                classification_code = 2\n        else:\n            classification_code = -1  # should not occur\n        # Compute final flux at right boundary\n        Knode = van_genuchten_K(h, Ks, alpha, n, theta_r, theta_s)\n        Kface = 0.5 * (Knode[:-1] + Knode[1:])\n        if classification_code == 0:\n            final_flux = 0.0\n        else:\n            # Dirichlet at right boundary: use interior face flux at N-3/2\n            final_flux = - Kface[-1] * ( (h[-1] - h[-2]) / dx )\n        final_head_right = h[-1]\n    return classification_code, float(final_flux), float(final_head_right)\n\ndef solve():\n    test_cases = [\n        # Case A\n        {\n            'L': 1.0, 'N': 50, 'dt': 10.0, 'T_end': 600.0,\n            'theta_r': 0.10, 'theta_s': 0.45, 'alpha': 1.60, 'n': 1.60,\n            'Ks': 1.0e-5, 'eps': 1.0e-8,\n            'h0': -1.0, 'h_left': 0.5, 'h_const': 0.2, 'h_thr': -0.30\n        },\n        # Case B\n        {\n            'L': 1.0, 'N': 50, 'dt': 10.0, 'T_end': 600.0,\n            'theta_r': 0.10, 'theta_s': 0.45, 'alpha': 1.60, 'n': 1.60,\n            'Ks': 1.0e-5, 'eps': 1.0e-8,\n            'h0': -1.0, 'h_left': 0.3, 'h_const': 0.2, 'h_thr': 0.20\n        },\n        # Case C\n        {\n            'L': 1.0, 'N': 50, 'dt': 10.0, 'T_end': 600.0,\n            'theta_r': 0.10, 'theta_s': 0.45, 'alpha': 1.60, 'n': 1.60,\n            'Ks': 1.0e-5, 'eps': 1.0e-8,\n            'h0': -1.0, 'h_left': -0.2, 'h_const': 0.2, 'h_thr': 0.20\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        c, q, hR = solve_case(case)\n        results.extend([c, q, hR])\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3557198"}, {"introduction": "高度非线性的问题，例如水向干土中的入渗，常常导致标准的牛顿求解器失效。本实践介绍了一种先进的数值技术——荷载延续法，以确保即使在处理陡峭湿润锋时也能实现稳健的收敛[@problem_id:3557205]。通过增量施加边界通量并根据求解器性能自适应步长，该方法为应对挑战性的物理情景和提高模拟的可靠性提供了一个强有力的策略。", "problem": "考虑高度为 $L$ 的均质、各向同性的非饱和土柱中的一维垂直入渗，该过程由混合形式的理查兹方程控制，写为质量守恒和达西-白金汉通量形式：\n$$\nC(\\psi)\\,\\frac{\\partial \\psi}{\\partial t} - \\frac{\\partial}{\\partial z}\\left(K(\\psi)\\left(\\frac{\\partial \\psi}{\\partial z} - 1\\right)\\right) = 0,\n$$\n其中，$z$ 轴正方向向上，$\\psi$ 是压力水头，$K(\\psi)$ 是导水率，$C(\\psi) = \\frac{\\partial \\theta}{\\partial \\psi}$ 是毛管容量，$\\theta$ 是体积含水量。在顶部边界 $z = 0$ 处，施加一个强度为 $q_{\\mathrm{tar}}$（向下为正）的降雨作为诺伊曼边界条件；在底部边界 $z = -L$ 处，施加自由排水条件。为了使用全隐式后向欧拉离散从时间 $t^{n}$ 推进到 $t^{n+1} = t^n + \\Delta t$，得到的非线性有限元残差可以抽象地表示为\n$$\n\\mathbf{R}(\\mathbf{u};\\lambda) = \\mathbf{0},\n$$\n其中 $\\mathbf{u}$ 是近似 $\\psi^{n+1}$ 的节点未知量向量，$\\lambda \\in [0,1]$ 是一个荷载-连续参数，使得顶部施加的边界通量为 $q(\\lambda) = \\lambda\\, q_{\\mathrm{tar}}$。当 $\\lambda = 1$ 时，目标降雨强度被完全施加。由于 $K(\\psi)$ 和 $C(\\psi)$ 在干端附近是高度非线性的，如果突然施加全部边界通量，陡峭的湿润锋可能导致牛顿法发散。\n\n从牛顿法收敛的基本要求（解附近的局部收缩、足够小的初始残差和局部利普希茨的雅可比矩阵）出发，并认识到离散质量残差范数 $\\|\\mathbf{R}(\\mathbf{u};\\lambda)\\|_{2}$ 衡量了在该时间步内对水量守恒的违反程度，请提出一个科学上合理的荷载-连续方案，该方案能够自适应地增加 $\\lambda$，以避免在陡峭湿润锋下发散。该方案必须明确说明：\n\n- 如何增加并可能回溯 $\\lambda$（即如何选择和更新 $\\Delta \\lambda$）。\n- 一个以非线性残差范数和任何线搜索条件表述的、定量的、可检查的步长接受准则。\n- 一个基于观测到的非线性求解难度来增加或减少下一个 $\\Delta \\lambda$ 的定量规则。\n- 您认为必要的任何额外的、基于物理动机的保障措施，以防止含水量出现非物理的过冲。\n\n下列哪个选项是最严谨且科学上最现实的提议？\n\nA. 引入连续参数 $\\lambda \\in [0,1]$，其中 $q(\\lambda) = \\lambda\\, q_{\\mathrm{tar}}$。在连续步 $k$，尝试 $\\lambda_{k+1} = \\lambda_k + \\Delta \\lambda_k$。定义非线性残差 $\\mathbf{R}(\\mathbf{u};\\lambda_{k+1})$，并使用带回溯 Armijo 线搜索的牛顿法求解。如果牛顿法产生一个迭代解 $\\mathbf{u}^{(i^\\star)}$ 满足以下条件，则接受该连续步：\n$$\n\\|\\mathbf{R}(\\mathbf{u}^{(i^\\star)};\\lambda_{k+1})\\|_{2} \\le \\tau_{\\mathrm{abs}} + \\tau_{\\mathrm{rel}}\\,\\|\\mathbf{R}(\\mathbf{u}^{(0)};\\lambda_{k+1})\\|_{2},\n$$\n其中 $\\tau_{\\mathrm{rel}} = 10^{-6}$ 且 $\\tau_{\\mathrm{abs}} = 10^{-12}\\,\\|\\mathbf{b}\\|_{2}$，$\\mathbf{b}$ 是由时间离散的质量项组装的荷载向量。在每次牛顿迭代中，仅当线搜索步长 $s \\in (0,1]$ 满足充分下降条件时才接受它：\n$$\n\\|\\mathbf{R}(\\mathbf{u}^{(i)} + s\\,\\delta \\mathbf{u}^{(i)};\\lambda_{k+1})\\|_{2} \\le \\left(1 - \\alpha\\, s\\right)\\,\\|\\mathbf{R}(\\mathbf{u}^{(i)};\\lambda_{k+1})\\|_{2},\\quad \\alpha = 10^{-4},\n$$\n并且如果在求解过程中接受的最小 $s$ 值低于 $s_{\\min} = 10^{-3}$，则拒绝该连续步并将 $\\Delta \\lambda_k$ 减小为 $\\Delta \\lambda_k \\leftarrow \\max\\{0.1\\,\\Delta \\lambda_k,\\,10^{-4}\\}$。作为一种基于物理动机的保障措施，通过线性化 $|\\Delta \\theta| \\approx |C(\\psi)\\,\\Delta \\psi|$ 来限制每次牛顿迭代步中预测的含水量变化，强制执行：\n$$\n\\| \\mathbf{C}^{1/2}\\,\\delta \\mathbf{u}^{(i)} \\|_{2} \\le \\eta_\\theta\\,\\sqrt{N_{\\mathrm{dof}}},\\quad \\eta_\\theta = 5 \\times 10^{-2},\n$$\n其中 $\\mathbf{C}$ 是对角集总毛管容量矩阵，$N_{\\mathrm{dof}}$ 是自由度数量；如果违反此条件，则进一步回溯线搜索或拒绝该连续步。如果该步被接受且牛顿法在 $N_{\\mathrm{it}}$ 次迭代内收敛，则使用一个以 $N_{\\mathrm{tar}} = 6$ 次迭代为目标的控制器来更新下一个荷载增量：\n$$\n\\Delta \\lambda_{k+1} = \\Delta \\lambda_k \\,\\min\\!\\left\\{ \\gamma_{\\max},\\,\\max\\!\\left(\\gamma_{\\min},\\,\\left(\\frac{N_{\\mathrm{tar}}}{N_{\\mathrm{it}}+1}\\right)^{1/2}\\right)\\right\\},\\quad \\gamma_{\\min} = 0.5,\\ \\gamma_{\\max} = 2.0,\n$$\n并受限于 $\\lambda_{k+1} \\le 1$。从 $\\lambda_0 = 0$ 和 $\\Delta \\lambda_0 = 0.1$ 开始初始化，并持续进行直到 $\\lambda = 1$。\n\nB. 保持 $\\lambda$ 固定为 $\\lambda = 1$，一次性施加全部降雨。如果牛顿法发散，则从后向欧拉切换到显式前向欧拉时间积分器，进行一个大小为 $\\Delta t^\\star = 10^{-3}\\,\\Delta t$ 的单个子步，然后返回隐式积分。当最大压力水头更新量满足 $\\|\\delta \\mathbf{u}\\|_{\\infty} \\le 10^{-1}$ 时接受该步，而不管残差范数如何，并将下一个时间步加倍。不使用线搜索或荷载回溯，因为假定显式子步法可以使锋面正则化。\n\nC. 引入 $\\lambda$ 且 $q(\\lambda) = \\lambda\\,q_{\\mathrm{tar}}$，但根据达西速度计算的 Courant–Friedrichs–Lewy 条件来选择 $\\Delta \\lambda$，就像该方案是显式的一样：\n$$\n\\Delta \\lambda_k = \\min\\left\\{ 1-\\lambda_k,\\, \\mathrm{CFL}\\,\\min_e \\frac{\\Delta z_e}{|v_e|\\,\\Delta t} \\right\\},\\quad v_e = -K(\\psi_e)\\left(\\frac{\\partial \\psi}{\\partial z}\\bigg|_e - 1\\right),\\ \\mathrm{CFL} = 0.5,\n$$\n且不使用牛顿线搜索。如果在最多3次牛顿迭代后，相对残差减小了至少 $10^{-2}$ 倍，则接受该步，否则保持相同的 $\\Delta \\lambda_k$ 并重试。\n\nD. 仅对解使用弧长约束，在每个连续步强制 $\\|\\delta \\mathbf{u}\\|_{2} = 10^{-2}$，同时不管残差行为如何，都设置 $\\lambda_{k+1} = \\min\\{1,\\,\\lambda_k + 0.2\\}$。如果最后一次牛顿修正量的欧几里得范数满足 $\\|\\delta \\mathbf{u}^{(i^\\star)}\\|_{2} \\le 10^{-3}$，则接受该步，即使残差范数不小，因为小的修正量表示接近平衡。不使用线搜索；如果牛顿法发散，则通过将空间网格尺寸减小为原来的一半来继续进行。\n\n选择最能满足从控制方程导出的收敛要求，并能确保针对理查兹方程中陡峭湿润锋的鲁棒且定量的荷载-连续策略的选项。", "solution": "用户提供了一个关于非饱和流一维理查兹方程数值解的问题，重点是开发一种鲁棒的荷载-连续方案来处理陡峭的湿润锋。任务是验证问题陈述，然后从给定选项中选择最严谨和科学上最现实的提议。\n\n### 问题验证\n\n首先，我将验证问题陈述。\n\n**步骤1：提取已知条件**\n- **控制方程**：$C(\\psi)\\,\\frac{\\partial \\psi}{\\partial t} - \\frac{\\partial}{\\partial z}\\left(K(\\psi)\\left(\\frac{\\partial \\psi}{\\partial z} - 1\\right)\\right) = 0$，其中 $z$ 轴正方向向上，$\\psi$ 是压力水头，$K(\\psi)$ 是导水率，$C(\\psi) = \\frac{\\partial \\theta}{\\partial \\psi}$ 是毛管容量。\n- **区域**：高度为 $L$ 的一维垂直土柱。\n- **边界条件**：在 $z = 0$ 处，诺伊曼条件（降雨），强度为 $q_{\\mathrm{tar}}$（向下为正）。在 $z = -L$ 处，自由排水。\n- **数值离散**：时间上采用全隐式后向欧拉法，空间上采用有限元法。\n- **非线性系统**：离散系统写为 $\\mathbf{R}(\\mathbf{u};\\lambda) = \\mathbf{0}$，其中 $\\mathbf{u}$ 是近似 $\\psi^{n+1}$ 的节点压力向量。\n- **荷载连续**：施加的通量为 $q(\\lambda) = \\lambda\\, q_{\\mathrm{tar}}$，其中 $\\lambda \\in [0,1]$。\n- **问题动机**：突然施加全部通量（$\\lambda=1$）会因 $K(\\psi)$ 和 $C(\\psi)$ 的高度非线性相关的陡峭湿润锋而导致牛顿法发散。\n- **任务要求**：提出一个荷载-连续方案，明确说明：（1）如何增加和回溯 $\\lambda$，（2）一个定量的步长接受准则，（3）一个调整下一个 $\\Delta \\lambda$ 的定量规则，以及（4）任何必要的物理保障措施。\n\n**步骤2：使用提取的已知条件进行验证**\n问题陈述是科学上合理且适定的。\n- **科学基础**：使用理查兹方程描述非饱和流是土壤物理学和水文学的基石。相关的数值挑战，特别是牛顿法在处理陡峭锋面时的收敛性问题，在科学文献中有充分的记载。使用荷载-连续（或同伦）方法是计算力学中克服此类困难的标准而严谨的技术。\n- **适定性与客观性**：该问题以精确的数学和计算术语表述。控制方程、边界条件和离散系统的抽象形式都是标准的。通过要求一个包含四个具体的、定量组成部分的方案，任务被客观地定义了。\n- **完整性与一致性**：问题陈述是内容完整的。它提供了评估所提出的数值方案所需的所有必要背景。物理学、数值方法（隐式有限元）和求解策略（荷载连续）都是相互一致的。符号约定被明确说明，并在控制方程中正确反映，其中通量中的‘-1’项代表在z轴向上的坐标系中的单位重力势梯度。\n\n**步骤3：结论与行动**\n该问题是有效的。这是一个在计算岩土力学领域中适定的、有科学依据的问题。我将通过对照非线性偏微分方程的数值分析原理来分析每个选项，以推导出正确答案。\n\n### 解答与选项分析\n\n目标是设计一个鲁棒的算法来求解非线性系统 $\\mathbf{R}(\\mathbf{u};\\lambda) = \\mathbf{0}$，其中 $\\lambda$ 参数化了边界强迫项。根据要求，一个针对此类问题的鲁棒方案必须结合几个关键要素：一个针对固定荷载的可靠的非线性求解器，一个增加荷载的策略，以及一个根据求解器性能调整荷载增量的反馈机制。\n\n对于一个固定的 $\\lambda$，求解 $\\mathbf{R}(\\mathbf{u};\\lambda) = \\mathbf{0}$ 的标准牛顿法迭代形式如下：\n1.  求解修正量 $\\delta \\mathbf{u}^{(i)}$：$\\mathbf{J}(\\mathbf{u}^{(i)}) \\delta \\mathbf{u}^{(i)} = -\\mathbf{R}(\\mathbf{u}^{(i)};\\lambda)$，其中 $\\mathbf{J} = \\frac{\\partial \\mathbf{R}}{\\partial \\mathbf{u}}$ 是雅可比矩阵。\n2.  更新解：$\\mathbf{u}^{(i+1)} = \\mathbf{u}^{(i)} + s\\,\\delta \\mathbf{u}^{(i)}$。\n\n为了使该方法具有鲁棒性，尤其是在理查兹方程陡峭锋面的背景下，以下几个组成部分至关重要：\n- **牛顿法的全局化**：原始牛顿步（$s=1$）通常过大，可能导致发散。需要一个线搜索算法来找到一个步长 $s \\in (0,1]$，以确保向解的方向取得充分进展，这通常通过满足像 Armijo 准则这样的关于残差范数的条件来实现。\n- **收敛准则**：只有当残差范数 $\\|\\mathbf{R}\\|$ 低于指定的容差时，才能宣告收敛。残差代表了离散质量守恒方程中的不平衡，因此最小化它是至关重要的。仅基于更新量大小 $\\|\\delta \\mathbf{u}\\|$ 的准则是不足的，因为它们可能表示过早停滞。\n- **自适应荷载增量**：荷载步的大小 $\\Delta \\lambda$ 应根据非线性求解的难度进行调整。容易的求解（少量牛顿迭代）表明下一步可以采用更大的 $\\Delta \\lambda$。困难的求解（多次迭代或线搜索失败）则需要减小 $\\Delta \\lambda$。这通常由一个旨在使每步的牛顿迭代次数达到最优的控制器来管理。\n- **物理保障措施**：更新步 $\\delta \\mathbf{u}^{(i)}$ 有时会提出非物理状态（例如，极大的压力变化导致负含水量）。限制每次迭代中状态变量变化幅度的保障措施对鲁棒性至关重要。\n\n牢记这些原则，我将评估每个选项。\n\n**A. 选项A的评估：**\n该选项提出了一个全面且代表当前最高水平的方案。\n- **$\\lambda$ 的增加/回溯**：它使用自适应增量 $\\Delta \\lambda_k$ 和一个鲁棒的回溯规则：如果线搜索需要一个非常小的步长（$s  s_{\\min}$），则减小荷载增量并重试该步。这正确地将内层牛顿循环中的失败与外层连续循环的控制联系起来。\n- **步长接受准则**：它使用标准的 Armijo 线搜索来全局化牛顿法，确保每次迭代中残差有充分的下降。最终的收敛准则 $\\|\\mathbf{R}(\\mathbf{u}^{(i^\\star)})\\|_{2} \\le \\tau_{\\mathrm{abs}} + \\tau_{\\mathrm{rel}}\\,\\|\\mathbf{R}(\\mathbf{u}^{(0)})\\|_{2}$ 是一个对残差范数进行的鲁棒的、标准的混合相对/绝对容差检查。这正确地将重点放在满足控制方程上。\n- **$\\Delta \\lambda$ 的自适应性**：更新 $\\Delta \\lambda_{k+1}$ 的规则是基于一个以特定牛顿迭代次数（$N_{\\mathrm{tar}}=6$）为目标的控制器。这在时间步进和连续方法中都是一种平衡效率和鲁棒性的经典且有效的策略。所提供的公式是此类控制器的标准实现。\n- **物理保障措施**：约束 $\\| \\mathbf{C}^{1/2}\\,\\delta \\mathbf{u}^{(i)} \\|_{2} \\le \\eta_\\theta\\,\\sqrt{N_{\\mathrm{dof}}}$ 是一个精密的、基于物理动机的保障措施。由于含水量的变化 $\\Delta \\boldsymbol{\\theta}$ 近似为 $\\mathbf{C}\\,\\delta \\mathbf{u}$，该约束有效地限制了单元集总上的含水量均方根变化，并根据变化最敏感的地方（$C$ 值大）进行加权。这直接防止了困扰理查兹方程求解器的非物理过冲。\n**结论：正确。** 该选项描述了一个科学上合理、严谨且完整的算法，满足了问题陈述的所有要求，并代表了计算科学中的最佳实践。\n\n**B. 选项B的评估：**\n该选项根本上是有缺陷的。\n- 它放弃了所要求的荷载-连续策略（$\\lambda = 1$ 总是成立）。相反，它提出了使用显式子步的“修复”方法。众所周知，显式欧拉法在理查兹方程上受到稳定性的严重限制，因此这不是一个鲁棒的修复方法。\n- 接受准则 $\\|\\delta \\mathbf{u}\\|_{\\infty} \\le 10^{-1}$ “不管残差范数如何”，这在科学上是不可接受的。这意味着即使解严重违反质量守恒也可以被接受。小的更新量表示停滞，而非收敛。\n- 自适应逻辑（失败后将时间步加倍）是反直觉的，并且容易导致紧随其后的失败。\n**结论：不正确。** 该提议是临时拼凑的、科学上不合理的，并且忽略了满足控制方程（即最小化残差）的基本原则。\n\n**C. 选项C的评估：**\n该选项表现出对显式和隐式方案方法的概念混淆。\n- 它建议根据 Courant–Friedrichs–Lewy (CFL) 条件选择荷载增量 $\\Delta \\lambda$。CFL 条件决定了*显式*时间积分器的稳定步长。该问题使用的是*全隐式*方法，该方法不受此限制。将时间步进稳定性条件应用于荷载参数是一个范畴错误。\n- 提议的求解器缺少线搜索。对于这样一个高度非线性的问题，使用原始牛顿步（$s=1$）是导致发散的根源。\n- 用相同的 $\\Delta \\lambda_k$ 重试失败的步骤是一种低效的策略；失败的步骤表明增量太大，因此应该减小。\n**结论：不正确。** 该方案基于对数值稳定性理论的误解，并忽略了鲁棒非线性迭代的一个关键组成部分（线搜索）。\n\n**D. 选项D的评估：**\n该选项错误地混合了概念，并使用了有缺陷的逻辑。\n- 它试图将固定的荷载增量（$\\Delta \\lambda = 0.2$）与“弧长”约束（$||\\delta\\mathbf{u}||_2 = 10^{-2}$）结合起来。在正确的弧长方法中，弧长约束决定了步长，而 $\\lambda$ 成为一个待求解的变量。同时应用固定的 $\\lambda$ 增量和解范数约束通常是不一致的，并且会过度约束问题。\n- 基于最后一次牛顿修正量的大小 $\\|\\delta \\mathbf{u}^{(i^\\star)}\\|_{2}$ 而忽略残差范数的接受准则是不正确的，原因与选项B中相同。\n- 针对发散的建议对策——细化空间网格——是不恰当的。虽然空间分辨率很重要，但牛顿法发散通常是由过大的荷载或时间步引起的，正确的响应是减小该步长，而不是进行昂贵的网格细化。\n**结论：不正确。** 该选项是对数值术语的混淆杂糅，具有不正确的收敛准则和错误的自适应策略。\n\n基于这一详细分析，选项A是唯一一个为解决所述问题提供了科学严谨、全面且正确的算法的选项。它符合非线性偏微分方程计算方法的既定最佳实践。", "answer": "$$\\boxed{A}$$", "id": "3557205"}]}