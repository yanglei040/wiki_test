{"hands_on_practices": [{"introduction": "在深入研究 B-bar 方法这一解决方案之前，我们首先必须从根本上理解它旨在解决的问题。这项实践通过分析单元刚度矩阵的条件数，为体积锁定现象提供了一种定量的诊断。通过这个练习，你将推导出条件数如何随着材料趋于不可压缩而增长，从而揭示标准有限元公式中潜在的数值病态问题。[@problem_id:3502468]", "problem": "考虑一个各向同性、均匀、线性弹性的平面应变四节点双线性四边形单元 (Q4)，该单元占据一个边长为 $h$ 且厚度为单位1的正方形区域。该单元采用 $2 \\times 2$ 高斯积分法则进行积分。假设材料的特性由体积模量 $\\kappa$ 和剪切模量 $G$ 描述，其拉梅参数定义为 $\\mu = G$ 和 $\\lambda = \\kappa - \\frac{2}{3}G$。单元刚度由基本有限元定律 $K_{e} = \\int_{\\Omega_{e}} B^{\\top} D B \\,\\mathrm{d}\\Omega$ 定义，其中 $B$ 是协调应变-位移矩阵，$D$ 是 Voigt 记法下对应于平面应变的材料刚度，作用于应变向量 $[\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}]^{\\top}$，其中工程剪切应变 $\\gamma_{xy} = 2 \\varepsilon_{xy}$。\n\n刚体运动使得完整的单元刚度矩阵奇异。为了定义一个有意义的条件数，将 $K_{e}$ 的作用限制在双线性 Q4 单元能够精确再现的协调常应变子空间上，即均匀的 $\\varepsilon_{xx}$、均匀的 $\\varepsilon_{yy}$ 和均匀的 $\\gamma_{xy}$。在此子空间中，$K_{e}$ 的能量贡献仅由材料刚度 $D$ 决定，两者相差一个由单元面积决定的正常数缩放因子。\n\n从第一性原理出发，推导该单元刚度在常应变子空间中的条件数（最大特征值与最小特征值之比），并将其表示为关于无量纲比 $\\kappa/G$ 的闭式解析表达式。然后，简要解释该条件数相对于 $\\kappa/G$ 的增长率，以此作为标准全积分 Q4 单元中体积锁定的定量证据。你的最终答案必须是条件数作为 $\\kappa/G$ 函数的精确解析表达式；无需四舍五入，且答案是无量纲的。", "solution": "该问题要求在平面应变条件下，推导一个四节点双线性四边形单元 (Q4) 在常应变子空间内受限的刚度矩阵的条件数。该条件数需用体积模量 $\\kappa$ 与剪切模量 $G$ 之比来表示。\n\n根据问题陈述，对于常应变状态，单元的能量响应由材料刚度矩阵 $D$ 决定，并按单元面积进行缩放。单元刚度矩阵由 $K_{e} = \\int_{\\Omega_{e}} B^{\\top} D B \\,\\mathrm{d}\\Omega$ 给出。对于一个常应变场 $\\boldsymbol{\\varepsilon}$，应变-位移矩阵 $B$ 成为一个常数矩阵，它将节点位移与此应变状态关联起来，而积分结果就是单元面积 $A_e = h^2$（对于单位厚度）。应变能为 $U_e = \\frac{1}{2} A_e \\boldsymbol{\\varepsilon}^{\\top} D \\boldsymbol{\\varepsilon}$。因此，该子空间中的刚度特性与材料矩阵 $D$ 成正比。此子空间中刚度算子的条件数与矩阵 $D$ 的条件数相同，因为任何像面积 $A_e$ 这样的标量前置因子在特征值的比率中都会被抵消。一个对称正定矩阵的条件数是其最大特征值与最小特征值之比，即 $\\text{cond}(D) = \\lambda_{\\max}(D) / \\lambda_{\\min}(D)$。因此，我们的任务简化为求平面应变材料刚度矩阵 $D$ 的特征值。\n\n对于各向同性线性弹性材料，Voigt 记法下的平面应变本构关系通过 $\\boldsymbol{\\sigma} = D \\boldsymbol{\\varepsilon}$ 将应力向量 $\\boldsymbol{\\sigma} = [\\sigma_{xx}, \\sigma_{yy}, \\sigma_{xy}]^{\\top}$ 与工程应变向量 $\\boldsymbol{\\varepsilon} = [\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}]^{\\top}$ 联系起来。矩阵 $D$ 如下所示：\n$$\nD = \\begin{pmatrix} \\lambda + 2\\mu  \\lambda  0 \\\\ \\lambda  \\lambda + 2\\mu  0 \\\\ 0  0  \\mu \\end{pmatrix}\n$$\n问题中给出了用体积模量 $\\kappa$ 和剪切模量 $G$ 表示的拉梅参数：\n$$ \\mu = G $$\n$$ \\lambda = \\kappa - \\frac{2}{3}G $$\n将这些代入矩阵 $D$ 中：\n$$ \\lambda + 2\\mu = \\left(\\kappa - \\frac{2}{3}G\\right) + 2G = \\kappa + \\frac{4}{3}G $$\n因此，材料刚度矩阵变为：\n$$\nD = \\begin{pmatrix} \\kappa + \\frac{4}{3}G  \\kappa - \\frac{2}{3}G  0 \\\\ \\kappa - \\frac{2}{3}G  \\kappa + \\frac{4}{3}G  0 \\\\ 0  0  G \\end{pmatrix}\n$$\n为了求 $D$ 的特征值，我们可以利用其块对角结构。从右下角的 $1 \\times 1$ 块中可以立即看出一个特征值：\n$$ \\lambda_1 = G $$\n这个特征值对应于与 $\\gamma_{xy}$ 相关的纯剪切变形模式。\n\n另外两个特征值可以从左上角的 $2 \\times 2$ 子矩阵中求得，我们将其记为 $D_{sub}$：\n$$\nD_{sub} = \\begin{pmatrix} \\kappa + \\frac{4}{3}G  \\kappa - \\frac{2}{3}G \\\\ \\kappa - \\frac{2}{3}G  \\kappa + \\frac{4}{3}G \\end{pmatrix}\n$$\n$D_{sub}$ 的特征值 $\\eta$ 是特征方程 $\\det(D_{sub} - \\eta I) = 0$ 的根：\n$$\n\\det \\begin{pmatrix} \\kappa + \\frac{4}{3}G - \\eta  \\kappa - \\frac{2}{3}G \\\\ \\kappa - \\frac{2}{3}G  \\kappa + \\frac{4}{3}G - \\eta \\end{pmatrix} = 0\n$$\n$$\n\\left(\\kappa + \\frac{4}{3}G - \\eta\\right)^2 - \\left(\\kappa - \\frac{2}{3}G\\right)^2 = 0\n$$\n这给出了两种可能性：\n1. $\\kappa + \\frac{4}{3}G - \\eta = \\kappa - \\frac{2}{3}G$\n$$ \\eta = \\left(\\kappa + \\frac{4}{3}G\\right) - \\left(\\kappa - \\frac{2}{3}G\\right) = \\frac{4}{3}G + \\frac{2}{3}G = 2G $$\n设此为 $\\lambda_2 = 2G$。这个特征值对应于一个偏（体积保持）应变状态，具体地说是 $\\varepsilon_{xx} = -\\varepsilon_{yy}$ 的情况。\n\n2. $\\kappa + \\frac{4}{3}G - \\eta = -\\left(\\kappa - \\frac{2}{3}G\\right)$\n$$ \\eta = \\left(\\kappa + \\frac{4}{3}G\\right) + \\left(\\kappa - \\frac{2}{3}G\\right) = 2\\kappa + \\frac{2}{3}G $$\n设此为 $\\lambda_3 = 2\\kappa + \\frac{2}{3}G$。这个特征值对应于一个纯体积应变状态，即 $\\varepsilon_{xx} = \\varepsilon_{yy}$ 的情况。\n\n因此，材料矩阵 $D$ 的三个特征值为：\n$$ \\{ \\lambda_1, \\lambda_2, \\lambda_3 \\} = \\left\\{ G, 2G, 2\\kappa + \\frac{2}{3}G \\right\\} $$\n对于物理上稳定的材料，$\\kappa$ 和 $G$ 均为正值。因此，所有三个特征值也都是正的。\n\n条件数是最大特征值与最小特征值之比：\n$$ \\text{cond}(D) = \\frac{\\lambda_{\\max}}{\\lambda_{\\min}} $$\n最小的特征值显然是 $\\lambda_{\\min} = G$。\n最大的特征值是 $\\lambda_{\\max} = \\max\\left(2G, 2\\kappa + \\frac{2}{3}G\\right)$。\n\n体积锁定现象发生在近不可压缩极限下，此时泊松比 $\\nu \\to 0.5$。这个极限对应于体积模量远大于剪切模量，即 $\\kappa/G \\to \\infty$。对于任何 $\\nu > 0$ 的材料，我们有 $\\kappa > \\frac{2}{3}G$，这意味着 $2\\kappa + \\frac{2}{3}G > 2\\kappa > \\frac{4}{3}G$。我们必须将 $2\\kappa + \\frac{2}{3}G$ 与 $2G$进行比较。不等式 $2\\kappa + \\frac{2}{3}G > 2G$ 简化为 $2\\kappa > \\frac{4}{3}G$，或 $\\kappa/G > 2/3$。这对任何具有正泊松比的材料都成立。由于上下文是关于体积锁定的，我们关心的是这种情况。因此，最大特征值为：\n$$ \\lambda_{\\max} = 2\\kappa + \\frac{2}{3}G $$\n于是，条件数为：\n$$ \\text{cond}(D) = \\frac{2\\kappa + \\frac{2}{3}G}{G} = 2\\frac{\\kappa}{G} + \\frac{2}{3} $$\n这就是所要求的闭式表达式。\n\n为了进行解释，我们分析该条件数相对于比值 $R = \\kappa/G$ 的增长率。条件数为 $\\text{cond}(D) = 2R + 2/3$。增长率为 $\\frac{\\mathrm{d}}{\\mathrm{d}R}(\\text{cond}(D)) = 2$。这种线性增长表明，随着材料趋于不可压缩（$\\kappa/G \\to \\infty$），矩阵 $D$（以及常应变模式下的单元刚度）会变得越来越病态。体积锁定是一种数值假象，即单元对体积变形表现出过度刚性的响应。条件数量化了这种差异：单元在体积模式下的刚度（与 $2\\kappa + \\frac{2}{3}G$ 成正比）与其在剪切模式下的刚度（与 $G$ 和 $2G$ 成正比）相比，会无界地增大。特征值之间的这种巨大差异导致了较差的数值性能和全局系统的人为刚化，这正是体积锁定的标志。线性增长率提供了一个精确的定量度量，说明了这种数值病态如何随着材料的不可压缩性而恶化。", "answer": "$$\n\\boxed{2\\frac{\\kappa}{G} + \\frac{2}{3}}\n$$", "id": "3502468"}, {"introduction": "在认识到体积锁定的数值挑战后，我们现在转向其经典的解决方案——B-bar 方法。这项实践通过推导一个简单矩形单元的常数体积投影向量 $\\bar{b}_v$，让你直接接触到该方法的核心思想。这个推导过程将“投影”这一抽象概念具体化，展示了如何通过单元平均来构造修正后的体积应变-位移关系。[@problem_id:3502521]", "problem": "考虑在小应变二维设定下的一个四节点双线性四边形单元 (Q4)，该单元用于计算岩土力学中的有限元法 (FEM)。单元占据一个边长为 $L_x$ 和 $L_y$ 的矩形物理域 $\\Omega_e$，与笛卡尔坐标轴对齐，节点从左下角开始逆时针编号。设从自然坐标 $(\\xi, \\eta) \\in [-1,1] \\times [-1,1]$ 到物理坐标 $(x,y)$ 的等参映射是仿射的，由 $x = x_c + \\frac{L_x}{2}\\,\\xi$ 和 $y = y_c + \\frac{L_y}{2}\\,\\eta$ 给出，其中 $(x_c,y_c)$ 是矩形的中心。双线性形函数为\n$$\nN_1(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1-\\eta),\\quad\nN_2(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1-\\eta),\\quad\nN_3(\\xi,\\eta) = \\frac{1}{4}(1+\\xi)(1+\\eta),\\quad\nN_4(\\xi,\\eta) = \\frac{1}{4}(1-\\xi)(1+\\eta).\n$$\n设节点位移向量为 $d = [u_1, v_1, u_2, v_2, u_3, v_3, u_4, v_4]^{\\top}$，插值位移场为 $u(x,y) = \\sum_{i=1}^{4} N_i(\\xi,\\eta)\\,u_i$，$v(x,y) = \\sum_{i=1}^{4} N_i(\\xi,\\eta)\\,v_i$。在小应变运动学下，体积应变定义为 $\\epsilon_v(x,y) = \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y}$。\n\n所谓的 $B$ bar 方法（也写作 $\\,\\bar{B}\\,$ 方法）通过将体积应变替换为其单元常数投影来缓解近不可压缩材料中的体积锁定问题，该方法使用常体积投影向量 $\\bar{b}_v$，使得投影体积应变为 $\\bar{\\epsilon}_v = \\bar{b}_v\\,d$，其中\n$$\n\\bar{b}_v = \\frac{1}{\\Omega_e}\\int_{\\Omega_e} b_v(\\mathbf{x})\\,d\\Omega,\\quad \\Omega_e = L_x L_y,\n$$\n其中 $b_v(\\mathbf{x})$ 是满足 $\\epsilon_v(\\mathbf{x}) = b_v(\\mathbf{x})\\,d$ 的体积应变-位移算子。\n\n从小应变运动学和上述等参插值出发，推导此矩形 Q4 单元的常体积投影向量 $\\bar{b}_v$ 的显式闭合形式表达式，该表达式仅用 $L_x$ 和 $L_y$ 表示，并按 $[u_1, v_1, u_2, v_2, u_3, v_3, u_4, v_4]$ 的顺序列出。然后，将投影体积应变写成 $\\bar{\\epsilon}_v = \\bar{b}_v\\,d$ 的形式。您的最终答案必须是 $\\bar{b}_v$ 的单一闭合形式解析表达式。不需要数值近似，最终方框内的表达式中不应包含单位。", "solution": "本题的目标是计算矩形Q4单元的常体积投影向量 $\\bar{b}_v$，其定义为体积应变-位移算子 $b_v(\\mathbf{x})$ 在单元域 $\\Omega_e$ 上的平均值：\n$$\n\\bar{b}_v = \\frac{1}{\\Omega_e}\\int_{\\Omega_e} b_v(\\mathbf{x})\\,d\\Omega\n$$\n首先，我们确定 $b_v(\\mathbf{x})$。根据小应变运动学，体积应变 $\\epsilon_v$ 是位移场 $(u, v)$ 的散度。将位移场用形函数 $N_i$ 和节点位移 $(u_i, v_i)$ 表示：\n$$\n\\epsilon_v = \\frac{\\partial u}{\\partial x} + \\frac{\\partial v}{\\partial y} = \\frac{\\partial}{\\partial x}\\left(\\sum_{i=1}^{4} N_i u_i\\right) + \\frac{\\partial}{\\partial y}\\left(\\sum_{i=1}^{4} N_i v_i\\right) = \\sum_{i=1}^{4} \\left(\\frac{\\partial N_i}{\\partial x} u_i + \\frac{\\partial N_i}{\\partial y} v_i\\right)\n$$\n因此，体积应变-位移算子 $b_v$ 是一个行向量，其分量为形函数对物理坐标 $(x,y)$ 的偏导数：\n$$\nb_v = \\begin{bmatrix} \\frac{\\partial N_1}{\\partial x}  \\frac{\\partial N_1}{\\partial y}  \\frac{\\partial N_2}{\\partial x}  \\frac{\\partial N_2}{\\partial y}  \\frac{\\partial N_3}{\\partial x}  \\frac{\\partial N_3}{\\partial y}  \\frac{\\partial N_4}{\\partial x}  \\frac{\\partial N_4}{\\partial y} \\end{bmatrix}\n$$\n为了计算这些导数，我们使用链式法则和等参映射关系。对于给定的仿射映射 $x = x_c + \\frac{L_x}{2}\\xi$ 和 $y = y_c + \\frac{L_y}{2}\\eta$，雅可比矩阵 $J$ 是一个常数对角矩阵：\n$$\nJ = \\begin{bmatrix} \\frac{\\partial x}{\\partial \\xi}  \\frac{\\partial y}{\\partial \\xi} \\\\ \\frac{\\partial x}{\\partial \\eta}  \\frac{\\partial y}{\\partial \\eta} \\end{bmatrix} = \\begin{bmatrix} \\frac{L_x}{2}  0 \\\\ 0  \\frac{L_y}{2} \\end{bmatrix}\n$$\n物理坐标系下的导数可以通过雅可比矩阵的逆求得：$\\frac{\\partial N_i}{\\partial x} = \\frac{2}{L_x} \\frac{\\partial N_i}{\\partial \\xi}$ 和 $\\frac{\\partial N_i}{\\partial y} = \\frac{2}{L_y} \\frac{\\partial N_i}{\\partial \\eta}$。\n\n现在，我们可以对 $b_v$ 进行积分。积分从物理域 $\\Omega_e$ 转换到父域 $[-1,1] \\times [-1,1]$：\n$$\n\\bar{b}_v = \\frac{1}{\\Omega_e} \\int_{-1}^1 \\int_{-1}^1 b_v(\\xi, \\eta) \\det(J) \\,d\\xi d\\eta\n$$\n由于雅可比行列式 $\\det(J) = \\frac{L_x L_y}{4} = \\frac{\\Omega_e}{4}$ 是常数，积分简化为：\n$$\n\\bar{b}_v = \\frac{1}{4} \\int_{-1}^1 \\int_{-1}^1 b_v(\\xi, \\eta) \\,d\\xi d\\eta\n$$\n这等价于对 $b_v$ 的每个分量求其在父域上的平均值。$b_v$ 的分量是 $\\xi$ 和 $\\eta$ 的线性函数。例如，对于节点1，$\\frac{\\partial N_1}{\\partial x} = \\frac{2}{L_x} \\frac{\\partial N_1}{\\partial \\xi} = \\frac{2}{L_x} [-\\frac{1}{4}(1-\\eta)] = -\\frac{1}{2L_x} + \\frac{\\eta}{2L_x}$。在对称区间 $[-1,1]$ 上对线性函数的积分，只有常数项有贡献。因此，我们只需要计算 $b_v$ 每个分量的常数部分。\n\n-   $\\text{avg}(\\frac{\\partial N_1}{\\partial x}) = -\\frac{1}{2L_x}$, $\\text{avg}(\\frac{\\partial N_1}{\\partial y}) = -\\frac{1}{2L_y}$\n-   $\\text{avg}(\\frac{\\partial N_2}{\\partial x}) = \\frac{1}{2L_x}$, $\\text{avg}(\\frac{\\partial N_2}{\\partial y}) = -\\frac{1}{2L_y}$\n-   $\\text{avg}(\\frac{\\partial N_3}{\\partial x}) = \\frac{1}{2L_x}$, $\\text{avg}(\\frac{\\partial N_3}{\\partial y}) = \\frac{1}{2L_y}$\n-   $\\text{avg}(\\frac{\\partial N_4}{\\partial x}) = -\\frac{1}{2L_x}$, $\\text{avg}(\\frac{\\partial N_4}{\\partial y}) = \\frac{1}{2L_y}$\n\n将这些平均值按节点位移顺序 $[u_1, v_1, \\dots, u_4, v_4]$ 组装起来，便得到常体积投影向量 $\\bar{b}_v$：\n$$\n\\bar{b}_v = \\begin{bmatrix} -\\frac{1}{2L_x}  -\\frac{1}{2L_y}  \\frac{1}{2L_x}  -\\frac{1}{2L_y}  \\frac{1}{2L_x}  \\frac{1}{2L_y}  -\\frac{1}{2L_x}  \\frac{1}{2L_y} \\end{bmatrix}\n$$\n提出公因子后，最终表达式为：\n$$\n\\bar{b}_v = \\frac{1}{2L_x L_y} \\begin{bmatrix} -L_y  -L_x  L_y  -L_x  L_y  L_x  -L_y  L_x \\end{bmatrix}\n$$\n由此，投影体积应变可以简洁地写为 $\\bar{\\epsilon}_v = \\bar{b}_v d$。", "answer": "$$\n\\boxed{\\frac{1}{2L_x L_y} \\begin{bmatrix} -L_y  -L_x  L_y  -L_x  L_y  L_x  -L_y  L_x \\end{bmatrix}}\n$$", "id": "3502521"}, {"introduction": "对数值方法进行任何修改都可能带来意想不到的副作用。因此，在应用 B-bar 方法后，进行稳定性验证至关重要。这项计算实践要求你通过特征值分析来检验 B-bar 修正是否会引入虚假的零能模式，这些模式可能导致非物理的结构失稳。通过完成这个练习，你将确认该方法在解决体积锁定的同时，保持了单元的数值稳定性。[@problem_id:3502461]", "problem": "您需要分析B-bar（表示为 $\\bar{B}$）修正是否在平面应变的小应变线性弹性条件下，为四节点双线性四边形单元（Q4）引入任何伪零能模式。您的分析必须从第一性原理出发，并编写一个程序来构建单元刚度矩阵，执行特征分析，并定量比较标准公式和 $\\bar{B}$ 修正公式的零空间性质。\n\n基本理论和建模假设：\n- 运动学：小应变，因此对称无穷小应变张量 $\\boldsymbol{\\varepsilon}$ 定义为 $\\varepsilon_{ij} = \\tfrac{1}{2}\\left(u_{i,j} + u_{j,i}\\right)$。\n- 离散化：在凸四边形上使用双线性形函数的等参Q4单元。位移场插值为 $\\mathbf{u}(\\mathbf{x}) = \\sum_{a=1}^{4} N_a(\\xi,\\eta)\\,\\mathbf{u}_a$，其中 $(\\xi,\\eta)\\in[-1,1]^2$ 是自然坐标。\n- 数值积分：使用 $2\\times 2$ 点的标准高斯积分。\n- 材料：均质、各向同性、线性弹性的平面应变材料，其杨氏模量为 $E$（单位：帕斯卡），泊松比为 $\\nu$。设拉梅参数为 $\\lambda = \\dfrac{E\\nu}{(1+\\nu)(1-2\\nu)}$ 和 $\\mu = \\dfrac{E}{2(1+\\nu)}$。在 $(\\sigma_{xx},\\sigma_{yy},\\tau_{xy})$–$(\\varepsilon_{xx},\\varepsilon_{yy},\\gamma_{xy})$ 表示法中，本构矩阵为\n$$\n\\mathbf{D} \\;=\\;\n\\begin{bmatrix}\n\\lambda + 2\\mu  \\lambda  0 \\\\\n\\lambda  \\lambda + 2\\mu  0 \\\\\n0  0  \\mu\n\\end{bmatrix}.\n$$\n- 标准单元刚度：对于每个权重为 $w_i$、雅可比行列式为 $J_i$ 的高斯点 $i$，组集 $\\mathbf{K} = \\sum_i w_i\\, J_i\\, \\mathbf{B}_i^\\mathsf{T}\\,\\mathbf{D}\\,\\mathbf{B}_i$，其中 $\\mathbf{B}_i$ 将节点位移映射到应变 $\\boldsymbol{\\varepsilon}_i = \\mathbf{B}_i \\mathbf{u}_e$，其中包含工程剪应变 $\\gamma_{xy}$。\n- $\\bar{B}$ 修正单元刚度：使用平面内体积应变 $e_{\\mathrm{vol}} = \\varepsilon_{xx} + \\varepsilon_{yy}$ 将平面内应变分解为体积部分和偏量部分。将在任意高斯点上的逐点 $e_{\\mathrm{vol}}$ 替换为其单元面积平均值 $\\bar{e}_{\\mathrm{vol}}$（即在单元上投影到常数空间上的 $L^2$ 投影），同时保持偏应变部分不变。然后使用修正的应变-位移算子组集刚度矩阵。\n\n您的程序必须：\n1. 为三个独立的测试案例构建标准Q4单元刚度矩阵 $\\mathbf{K}$。\n2. 通过将平面内体积应变 $e_{\\mathrm{vol}} = \\varepsilon_{xx} + \\varepsilon_{yy}$ 投影到其单元平均值，为相同的三个测试案例构建 $\\bar{B}$ 修正的刚度矩阵 $\\mathbf{K}_{\\bar{B}}$。\n3. 对每个矩阵执行特征分析并确定：\n   - 数值上接近零的特征值的数量（解释为零能模式）。使用如下定义的相对阈值：设 $\\lambda_{\\max}$ 为最大特征值；如果任何特征值 $\\lambda$ 满足 $\\lambda \\le \\max\\left(10^{-8}\\,\\lambda_{\\max},\\,10^{-12}\\right)$，则将其分类为接近零。\n   - 由最小的三个特征值对应的特征向量所张成的子空间与由两个平移和一个平面内转动生成的刚体运动子空间之间的最大主夹角（以弧度为单位）。刚体运动子空间基向量根据节点坐标 $(x_a,y_a)$ 构建如下：\n     - $x$ 方向的刚性平移：$\\mathbf{r}_1 = [1,0,1,0,1,0,1,0]^\\mathsf{T}$，\n     - $y$ 方向的刚性平移：$\\mathbf{r}_2 = [0,1,0,1,0,1,0,1]^\\mathsf{T}$，\n     - 绕原点以单位旋转量进行的刚性转动：$\\mathbf{r}_3 = [-y_1,x_1,-y_2,x_2,-y_3,x_3,-y_4,x_4]^\\mathsf{T}$。\n   使用标准欧几里得内积，计算由 $\\{\\mathbf{r}_1,\\mathbf{r}_2,\\mathbf{r}_3\\}$ 张成的子空间与由三个最小特征值对应的特征向量张成的子空间之间的最大主夹角。将此角度表示为浮点数（单位：弧度）。\n\n测试套件：\n为以下三个测试案例提供结果。在所有案例中，使用平面应变条件，且 $E$ 的单位为帕斯卡。\n- 案例A（名义可压缩、无畸变）：节点坐标（单位：米）\n  $$\n  (x_1,y_1)=(0,0),\\quad (x_2,y_2)=(1,0),\\quad (x_3,y_3)=(1,1),\\quad (x_4,y_4)=(0,1),\n  $$\n  且 $E = 3.0\\times 10^{7}$，$\\nu = 0.25$。\n- 案例B（近不可压缩、无畸变）：与案例A相同的坐标，但 $E = 3.0\\times 10^{7}$，$\\nu = 0.499999$。\n- 案例C（可压缩、畸变凸四边形）：节点坐标（单位：米）\n  $$\n  (x_1,y_1)=(0.0,0.0),\\;\n  (x_2,y_2)=(2.0,0.2),\\;\n  (x_3,y_3)=(1.8,1.2),\\;\n  (x_4,y_4)=(-0.1,1.0),\n  $$\n  且 $E = 3.0\\times 10^{7}$，$\\nu = 0.25$。\n\n对于每个案例，您的程序必须输出一个包含四个条目的列表：\n- 标准公式的近零特征值整数数量，\n- $\\bar{B}$ 公式的近零特征值整数数量，\n- 标准公式的最大主夹角（以弧度为单位的浮点数），\n- $\\bar{B}$ 公式的最大主夹角（以弧度为单位的浮点数）。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含一个由三个列表（每个案例一个）组成的逗号分隔列表，并用方括号括起来。每个内部列表必须具有以下形式：\n  $[n_{\\mathrm{std}},n_{\\bar{B}},\\theta_{\\mathrm{std}},\\theta_{\\bar{B}}]$，\n  其中 $n_{\\mathrm{std}}$ 和 $n_{\\bar{B}}$ 是整数，$\\theta_{\\mathrm{std}}$ 和 $\\theta_{\\bar{B}}$ 是以弧度为单位的浮点数，每个都采用科学记数法格式化，小数点后保留六位数字（例如，$1.234567\\mathrm{e}{-08}$）。例如：\n  $[[3,3,1.000000\\mathrm{e}{-12},1.000000\\mathrm{e}{-12}],[\\dots],[\\dots]]$。\n\n科学真实性与预期：\n- 标准Q4刚度矩阵是对称半正定的，在二维空间中恰好有三个刚体模态，因此对于单个无约束单元，其秩预计为 $5$。$\\bar{B}$ 修正不应引入额外的伪零能模式。您的数值证据应证实，标准和 $\\bar{B}$ 修正的刚度矩阵都具有相同数量的近零特征值，并且由三个最小特征值对应的特征向量构成的子空间与刚体运动子空间对齐（即最大主夹角很小）。", "solution": "该问题要求分析 B-bar ($\\bar{B}$) 方法对平面应变线性弹性条件下四节点双线性四边形（Q4）单元稳定性的影响。具体来说，我们必须确定此修正是否会引入非物理的，或称“伪”零能模式。分析过程包括构建标准刚度矩阵 $\\mathbf{K}$ 和 $\\bar{B}$ 修正的刚度矩阵 $\\mathbf{K}_{\\bar{B}}$，对两者进行特征值分析，并将其零空间与刚体运动子空间进行比较。\n\n### 1. 等参Q4单元公式\n\n分析的基础是等参Q4单元。单元内的几何形状和位移场使用同一组双线性形函数 $N_a(\\xi, \\eta)$ 从节点值插值得到，其中 $(\\xi, \\eta)$ 是参考方形域 $[-1,1]^2$ 中的自然坐标。\n\n单元内一点 $(x,y)$ 处的位移场 $\\mathbf{u}$ 由下式给出：\n$$ \\mathbf{u}(x,y) = \\sum_{a=1}^{4} N_a(\\xi,\\eta) \\mathbf{u}_a $$\n其中 $\\mathbf{u}_a = \\{u_{xa}, u_{ya}\\}^T$ 是节点 $a$ 的位移向量。所有 $8$ 个节点自由度的向量表示为 $\\mathbf{u}_e$。\n\n在小应变假设下，工程应变向量 $\\boldsymbol{\\varepsilon} = \\{\\varepsilon_{xx}, \\varepsilon_{yy}, \\gamma_{xy}\\}^T$ 通过应变-位移矩阵 $\\mathbf{B}$ 与节点位移相关联：\n$$ \\boldsymbol{\\varepsilon} = \\mathbf{B} \\mathbf{u}_e $$\n矩阵 $\\mathbf{B}$ 由节点块 $\\mathbf{B}_a$ 组成：\n$$ \\mathbf{B} = [\\mathbf{B}_1, \\mathbf{B}_2, \\mathbf{B}_3, \\mathbf{B}_4], \\quad \\text{其中} \\quad \\mathbf{B}_a = \\begin{bmatrix} \\frac{\\partial N_a}{\\partial x}  0 \\\\ 0  \\frac{\\partial N_a}{\\partial y} \\\\ \\frac{\\partial N_a}{\\partial y}  \\frac{\\partial N_a}{\\partial x} \\end{bmatrix} $$\n形函数对物理坐标 $(x,y)$ 的导数是通过其对自然坐标 $(\\xi, \\eta)$ 的导数与雅可比矩阵 $\\mathbf{J}$ 的逆矩阵得到的。\n\n### 2. 标准单元刚度矩阵 $\\mathbf{K}$\n\n单元刚度矩阵 $\\mathbf{K}$ 关联了节点力与节点位移。它由单元的应变能导出，并通过在单元面积 $A$ 上积分计算得出：\n$$ \\mathbf{K} = \\int_A \\mathbf{B}^T \\mathbf{D} \\mathbf{B} \\, dA $$\n这里，$\\mathbf{D}$ 是平面应变的本构矩阵，它关联了应力与应变：$\\boldsymbol{\\sigma} = \\mathbf{D}\\boldsymbol{\\varepsilon}$。问题给出了各向同性材料的矩阵：\n$$ \\mathbf{D} = \\begin{bmatrix} \\lambda + 2\\mu  \\lambda  0 \\\\ \\lambda  \\lambda + 2\\mu  0 \\\\ 0  0  \\mu \\end{bmatrix} $$\n其中 $\\lambda$ 和 $\\mu$ 是拉梅参数。该积分使用 $2 \\times 2$ 高斯积分进行数值计算：\n$$ \\mathbf{K} \\approx \\sum_{i=1}^{4} w_i \\mathbf{B}_i^T \\mathbf{D} \\mathbf{B}_i \\det(\\mathbf{J}_i) $$\n其中索引 $i$ 遍历四个高斯点，$w_i=1$ 是权重，$\\mathbf{B}_i$ 和 $\\det(\\mathbf{J}_i)$ 是在第 $i$ 个高斯点处计算的 B 矩阵和雅可比行列式。\n\n### 3. 用于解决体积锁定的 $\\bar{B}$ 方法\n\n采用完全积分（$2 \\times 2$）的标准Q4单元在模拟近不可压缩材料（即泊松比 $\\nu \\to 0.5$）时会表现出“体积锁定”。双线性近似的有限运动学模式无法在每一点都满足等体积约束，导致了伪刚度响应。\n\n$\\bar{B}$ 方法通过修改体积应变的计算方式来缓解这一问题。应变张量被分解为偏量（改变形状）部分和体积（改变体积）部分。在二维中，体积应变或平面内体积应变为 $e_{\\mathrm{vol}} = \\varepsilon_{xx} + \\varepsilon_{yy}$。\n\n其核心思想是施加一个较弱的、平均化的体积约束。它不要求在每个高斯点都精确表示体积应变，而是使用其单元平均值 $\\bar{e}_{\\mathrm{vol}}$：\n$$ \\bar{e}_{\\mathrm{vol}} = \\frac{1}{A} \\int_A e_{\\mathrm{vol}} \\, dA $$\n将体积应变投影到单元上的常数函数空间，这足以捕捉主要的体积行为，而不会过度约束单元。这导致了修正的应变-位移关系，并因此产生了修正的刚度矩阵 $\\mathbf{K}_{\\bar{B}}$。\n\n构建 $\\mathbf{K}_{\\bar{B}}$ 的一种计算上高效的方法是将本构矩阵 $\\mathbf{D}$ 分解为体积部分和偏量部分，即 $\\mathbf{D} = \\mathbf{D}_{\\mathrm{vol}} + \\mathbf{D}_{\\mathrm{dev}}$。对于平面应变，体积模量为 $K = \\lambda+\\mu$。分解如下：\n$$ \\mathbf{D}_{\\mathrm{vol}} = K \\begin{bmatrix} 1  1  0 \\\\ 1  1  0 \\\\ 0  0  0 \\end{bmatrix}, \\quad \\mathbf{D}_{\\mathrm{dev}} = \\mu \\begin{bmatrix} 1  -1  0 \\\\ -1  1  0 \\\\ 0  0  1 \\end{bmatrix} $$\n刚度矩阵的偏量部分使用完全积分计算：\n$$ \\mathbf{K}_{\\mathrm{dev}} = \\int_A \\mathbf{B}^T \\mathbf{D}_{\\mathrm{dev}} \\mathbf{B} \\, dA \\approx \\sum_{i=1}^{4} w_i \\mathbf{B}_i^T \\mathbf{D}_{\\mathrm{dev}} \\mathbf{B}_i \\det(\\mathbf{J}_i) $$\n体积部分基于平均运动学。设 $\\mathbf{m} = \\{1, 1, 0\\}^T$。平均体积应变算子是一个列向量 $\\bar{\\mathbf{b}}$：\n$$ \\bar{\\mathbf{b}} = \\frac{1}{A} \\int_A \\mathbf{B}^T \\mathbf{m} \\, dA \\approx \\frac{1}{\\sum_j w_j \\det(\\mathbf{J}_j)} \\sum_i w_i (\\mathbf{B}_i^T \\mathbf{m}) \\det(\\mathbf{J}_i) $$\n然后，体积刚度构建为：\n$$ \\mathbf{K}_{\\bar{\\mathrm{vol}}} = A \\, K \\, \\bar{\\mathbf{b}} \\bar{\\mathbf{b}}^T $$\n总的修正刚度矩阵是这两个分量的和：\n$$ \\mathbf{K}_{\\bar{B}} = \\mathbf{K}_{\\mathrm{dev}} + \\mathbf{K}_{\\bar{\\mathrm{vol}}} $$\n该公式在正确处理近不可压缩情况的同时，也保留了可压缩材料的正确行为。\n\n### 4. 稳定性分析：零能模式\n\n单元公式的稳定性通过检查其刚度矩阵的特征值来评估。具有零特征值的特征向量对应于“零能模式”——即不产生应变能的节点位移模式。对于二维空间中任何无约束的单元，必须恰好有三种这样的模式，对应于刚体运动（两个平移和一个平面内转动）。\n\n超过三个零能模式的存在表明单元不稳定，因为它可以在没有抵抗的情况下变形，这种现象称为“伪模态”或“机构”。对任何新公式（如 $\\bar{B}$ 方法）的一个关键测试是验证它不会引入此类伪模态。我们通过计算 $\\mathbf{K}$ 和 $\\mathbf{K}_{\\bar{B}}$ 的特征值并计算有多少个在数值上接近于零来进行此测试。\n\n### 5. 通过主夹角进行子空间比较\n\n为确认计算出的零能模式确实是正确的刚体模态（RBMs），我们将对应于三个最小特征值的特征空间与解析定义的RBM子空间进行比较。两个子空间之间的主夹角提供了它们对齐程度的度量。如果最大主夹角接近于零，则两个子空间几乎相同。\n\nRBM子空间由x方向平移（$\\mathbf{r}_1$）、y方向平移（$\\mathbf{r}_2$）和绕原点旋转（$\\mathbf{r}_3$）的向量张成。我们为该子空间形成一个标准正交基 $\\mathbf{Q}_R$。对应于刚度矩阵三个最小特征值的特征向量构成另一个标准正交基 $\\mathbf{Q}_U$。主夹角的余弦是矩阵乘积 $\\mathbf{Q}_R^T \\mathbf{Q}_U$ 的奇异值。最大主夹角是最小奇异值的反余弦。该角度的微小值证实了单元的零空间正确地代表了刚体运动。\n\n以下程序实现了这整个过程，以提供关于 $\\bar{B}$ 公式稳定性的定量证据。标准单元和修正单元都应具有恰好三个零能模式，这些模式对应于刚体模态。", "answer": "```python\nimport numpy as np\nfrom scipy.linalg import eigh, svd, qr\n\ndef solve():\n    \"\"\"\n    Main function to run the analysis for all test cases.\n    \"\"\"\n    \n    # Test Cases: (node_coords, E, nu)\n    test_cases = [\n        # Case A: Square, compressible\n        (np.array([[0.0, 0.0], [1.0, 0.0], [1.0, 1.0], [0.0, 1.0]]), \n         3.0e7, 0.25),\n        # Case B: Square, nearly incompressible\n        (np.array([[0.0, 0.0], [1.0, 0.0], [1.0, 1.0], [0.0, 1.0]]), \n         3.0e7, 0.499999),\n        # Case C: Distorted, compressible\n        (np.array([[0.0, 0.0], [2.0, 0.2], [1.8, 1.2], [-0.1, 1.0]]), \n         3.0e7, 0.25)\n    ]\n\n    results = []\n    for nodes, E, nu in test_cases:\n        case_results = []\n        \n        # Standard formulation\n        n_std, theta_std = analyze_element(nodes, E, nu, use_b_bar=False)\n        \n        # B-bar formulation\n        n_bbar, theta_bbar = analyze_element(nodes, E, nu, use_b_bar=True)\n        \n        case_results.extend([n_std, n_bbar, theta_std, theta_bbar])\n        results.append(case_results)\n\n    # Format output\n    output_str = \"[\"\n    for i, res in enumerate(results):\n        n_s, n_b, t_s, t_b = res\n        output_str += f\"[{n_s},{n_b},{t_s:.6e},{t_b:.6e}]\"\n        if i  len(results) - 1:\n            output_str += \",\"\n    output_str += \"]\"\n    \n    print(output_str)\n\ndef analyze_element(nodes, E, nu, use_b_bar):\n    \"\"\"\n    Analyzes a single element configuration.\n    \n    Args:\n        nodes: Nodal coordinates (4x2 array).\n        E: Young's modulus.\n        nu: Poisson's ratio.\n        use_b_bar: Boolean flag to use the B-bar method.\n        \n    Returns:\n        A tuple containing:\n        - The number of near-zero eigenvalues.\n        - The largest principal angle with the RBM subspace in radians.\n    \"\"\"\n    K = build_stiffness_matrix(nodes, E, nu, use_b_bar)\n    \n    # Eigenanalysis\n    evals, evecs = eigh(K)\n    \n    # Count near-zero eigenvalues\n    lambda_max = evals[-1]\n    threshold = max(1e-8 * lambda_max, 1e-12)\n    num_zero_modes = np.sum(evals = threshold)\n    \n    # Principal angle calculation\n    # Subspace from 3 smallest eigenvalues\n    Q_U = evecs[:, :3]\n    \n    # Rigid Body Mode (RBM) subspace\n    r1 = np.array([1, 0, 1, 0, 1, 0, 1, 0], dtype=float)\n    r2 = np.array([0, 1, 0, 1, 0, 1, 0, 1], dtype=float)\n    x, y = nodes.flatten(order='C')[::2], nodes.flatten(order='C')[1::2]\n    r3 = np.ravel(np.vstack([-y, x]).T)\n    \n    RBM_matrix = np.vstack([r1, r2, r3]).T\n    Q_R, _ = qr(RBM_matrix) # Orthonormal basis for RBM subspace\n    \n    # Singular values of the correlation matrix\n    M = Q_U.T @ Q_R\n    s = svd(M, compute_uv=False)\n    \n    # Smallest singular value corresponds to the largest principal angle\n    s_min = s[-1]\n    # np.clip for numerical stability with arccos\n    largest_principal_angle = np.arccos(np.clip(s_min, -1.0, 1.0))\n    \n    return num_zero_modes, largest_principal_angle\n\ndef get_shape_functions_and_derivs(xi, eta):\n    \"\"\"Returns shape functions and their derivatives w.r.t. natural coords.\"\"\"\n    N = 0.25 * np.array([(1-xi)*(1-eta), (1+xi)*(1-eta), (1+xi)*(1+eta), (1-xi)*(1+eta)])\n    \n    dN_dxi = 0.25 * np.array([-(1-eta), (1-eta), (1+eta), -(1+eta)])\n    dN_deta = 0.25 * np.array([-(1-xi), -(1+xi), (1+xi), (1-xi)])\n    \n    return N, np.vstack([dN_dxi, dN_deta])\n\ndef build_stiffness_matrix(nodes, E, nu, use_b_bar):\n    \"\"\"\n    Constructs the 8x8 element stiffness matrix for a Q4 element.\n    \"\"\"\n    # Material properties for plane strain\n    lame_lambda = (E * nu) / ((1 + nu) * (1 - 2 * nu))\n    lame_mu = E / (2 * (1 + nu))\n    \n    if not use_b_bar:\n        D = np.array([\n            [lame_lambda + 2 * lame_mu, lame_lambda, 0],\n            [lame_lambda, lame_lambda + 2 * lame_mu, 0],\n            [0, 0, lame_mu]\n        ])\n    else:\n        # For B-bar, we need D_dev and bulk modulus K\n        K_bulk = lame_lambda + lame_mu\n        D_dev = lame_mu * np.array([[1, -1, 0], [-1, 1, 0], [0, 0, 1]])\n\n    # 2x2 Gauss quadrature\n    gauss_points = 1.0 / np.sqrt(3) * np.array([[-1, -1], [1, -1], [1, 1], [-1, 1]])\n    gauss_weights = np.array([1, 1, 1, 1])\n\n    K = np.zeros((8, 8))\n    \n    # Pre-compute B matrices and Jacobians at all Gauss points\n    B_matrices = []\n    J_dets = []\n    for xi, eta in gauss_points:\n        _, dN_dnat = get_shape_functions_and_derivs(xi, eta)\n        \n        J = dN_dnat @ nodes\n        det_J = np.linalg.det(J)\n        if det_J = 0:\n            raise ValueError(\"Jacobian is non-positive. Element may be distorted or incorrectly numbered.\")\n        \n        J_inv = np.linalg.inv(J)\n        dN_dxy = J_inv @ dN_dnat\n        \n        B = np.zeros((3, 8))\n        for i in range(4):\n            B[0, 2*i] = dN_dxy[0, i]\n            B[1, 2*i+1] = dN_dxy[1, i]\n            B[2, 2*i] = dN_dxy[1, i]\n            B[2, 2*i+1] = dN_dxy[0, i]\n        \n        B_matrices.append(B)\n        J_dets.append(det_J)\n\n    if not use_b_bar:\n        # Standard formulation\n        for B_i, det_J_i, w_i in zip(B_matrices, J_dets, gauss_weights):\n            K += B_i.T @ D @ B_i * det_J_i * w_i\n    else:\n        # B-bar formulation\n        # K_bbar = K_dev + K_vol_bar\n        # K_dev = sum(w_i * J_i * B_i.T @ D_dev @ B_i)\n        K_dev = np.zeros((8, 8))\n        for B_i, det_J_i, w_i in zip(B_matrices, J_dets, gauss_weights):\n            K_dev += B_i.T @ D_dev @ B_i * det_J_i * w_i\n        \n        # K_vol_bar = A * K * b_bar @ b_bar.T\n        m = np.array([1, 1, 0])\n        element_area = sum(w * J for w, J in zip(gauss_weights, J_dets))\n        \n        b_bar_sum = np.zeros(8)\n        for B_i, det_J_i, w_i in zip(B_matrices, J_dets, gauss_weights):\n            b_bar_sum += m @ B_i * det_J_i * w_i\n        \n        b_bar = (1.0 / element_area) * b_bar_sum\n        \n        K_vol_bar = element_area * K_bulk * np.outer(b_bar, b_bar)\n        \n        K = K_dev + K_vol_bar\n\n    return K\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3502461"}]}