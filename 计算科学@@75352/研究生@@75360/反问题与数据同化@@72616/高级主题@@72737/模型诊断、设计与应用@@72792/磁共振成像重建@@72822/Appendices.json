{"hands_on_practices": [{"introduction": "要掌握磁共振成像（MRI）重建，我们必须首先理解其物理和数学基础。本实践将引导您从第一性原理出发，推导决定图像质量的两个最关键参数：采样间隔和空间分辨率。通过这个练习，您将深入理解傅里叶采样理论如何直接应用于MRI，并学会量化视场（Field of View, FOV）与混叠（aliasing）伪影之间的关系，以及k空间覆盖范围与图像清晰度之间的权衡。[@problem_id:3399736]", "problem": "考虑在一维磁共振成像 (MRI) 中，使用标准的非幺正傅里叶变换约定进行图像重建，其中物体 $x(r)$ 及其 $k$ 空间变换 $X(k)$ 满足：\n$$\nX(k) = \\int_{-\\infty}^{\\infty} x(r)\\,\\exp(-i\\,2\\pi\\,k\\,r)\\,dr,\\qquad\nx(r) = \\int_{-\\infty}^{\\infty} X(k)\\,\\exp(i\\,2\\pi\\,k\\,r)\\,dk.\n$$\n假设物体 $x(r)$ 具有有限支撑模型：存在一个有限长度 $L>0$，使得当 $|r|>\\frac{L}{2}$ 时，$x(r)=0$。假设 $k$ 空间在笛卡尔网格上以采样间隔 $\\Delta k>0$ 进行均匀采样，即在位置 $k_n=n\\,\\Delta k$（其中 $n$ 为整数）处采样，并假设采集的样本数量为 $N$，使得 $k$ 空间窗口对称且大致覆盖 $[-K_{\\max},K_{\\max}]$，其中 $K_{\\max}\\approx \\frac{N\\,\\Delta k}{2}$。重建的图像通过与所选采样相对应的离散傅里叶逆变换获得。\n\n从上述傅里叶变换定义和基本采样理论（狄拉克梳状函数采样和泊松求和公式）出发，符号化地推导出在 $k$ 空间中允许的最大采样间隔，记为 $\\Delta k^{\\star}$，以在 $x(r)$ 的有限支撑模型下避免混叠。然后，使用基于有限 $k$ 空间窗口引起的点扩散函数 (PSF) 的主瓣零点交叉这一物理上有意义的分辨率度量，推导出标称空间分辨率 $\\delta r$ 关于视场 (FOV) 和样本数量 $N$ 的解析表达式。此处，根据上述傅里叶约定，将视场定义为 $\\mathrm{FOV} = \\frac{1}{\\Delta k}$。\n\n最后，对以下参数进行数值计算：支撑长度 $L = 0.18\\,\\mathrm{m}$，视场 $\\mathrm{FOV} = 0.25\\,\\mathrm{m}$，以及样本数量 $N=256$。将 $\\Delta k^{\\star}$ 以 $\\mathrm{m}^{-1}$ 为单位表示，$\\delta r$ 以 $\\mathrm{mm}$ 为单位表示。将每个数值四舍五入至四位有效数字。\n\n你的最终答案必须是数对 $\\left(\\Delta k^{\\star},\\,\\delta r\\right)$。", "solution": "该问题陈述经评估具有科学依据、适定、客观且自洽，不含逻辑矛盾或事实错误。因此，我们可以进行形式求解。\n\n此问题分为两个主要部分：第一部分，基于基本采样理论推导避免混叠的条件，从而得出最大允许的 $k$ 空间采样间隔 $\\Delta k^{\\star}$；第二部分，基于有限 $k$ 空间采集窗口产生的点扩散函数 (PSF) 推导空间分辨率 $\\delta r$。\n\n**第一部分：最大采样间隔 $\\Delta k^{\\star}$ 的推导**\n\n一维物体 $x(r)$ 与其 $k$ 空间表示 $X(k)$ 之间的关系由傅里叶变换对给出：\n$$X(k) = \\int_{-\\infty}^{\\infty} x(r) \\exp(-i 2\\pi kr) dr$$\n$$x(r) = \\int_{-\\infty}^{\\infty} X(k) \\exp(i 2\\pi kr) dk$$\n在 $k$ 空间中以离散位置 $k_n = n \\Delta k$（$n$ 为整数）进行采样，可以建模为将连续信号 $X(k)$ 乘以一个狄拉克梳状函数 $S(k) = \\sum_{n=-\\infty}^{\\infty} \\delta(k - n\\Delta k)$，其中 $\\delta(\\cdot)$ 是狄拉克 delta 函数。因此，采样后的 $k$ 空间信号为 $X_s(k) = X(k) \\cdot S(k)$。\n\n重建的图像，我们记为 $x_{rep}(r)$，是采样数据 $X_s(k)$ 的傅里叶逆变换：\n$$x_{rep}(r) = \\mathcal{F}^{-1}\\{X_s(k)\\} = \\mathcal{F}^{-1}\\{X(k) \\cdot S(k)\\}$$\n卷积定理指出，频域中的乘法等价于时域中的卷积（此处分别为 $k$ 域和 $r$ 域）。\n$$x_{rep}(r) = \\left(\\mathcal{F}^{-1}\\{X(k)\\}\\right) * \\left(\\mathcal{F}^{-1}\\{S(k)\\}\\right) = x(r) * s(r)$$\n其中 $s(r)$ 是采样函数 $S(k)$ 的傅里叶逆变换。我们计算 $s(r)$：\n$$s(r) = \\mathcal{F}^{-1}\\left\\{\\sum_{n=-\\infty}^{\\infty} \\delta(k - n\\Delta k)\\right\\} = \\int_{-\\infty}^{\\infty} \\left(\\sum_{n=-\\infty}^{\\infty} \\delta(k - n\\Delta k)\\right) \\exp(i 2\\pi kr) dk$$\n根据线性性质，我们可以交换积分和求和的顺序：\n$$s(r) = \\sum_{n=-\\infty}^{\\infty} \\int_{-\\infty}^{\\infty} \\delta(k - n\\Delta k) \\exp(i 2\\pi kr) dk$$\n利用狄拉克 delta 函数的筛选性质 $\\int f(\\xi)\\delta(\\xi - \\xi_0)d\\xi = f(\\xi_0)$，我们得到：\n$$s(r) = \\sum_{n=-\\infty}^{\\infty} \\exp(i 2\\pi (n\\Delta k) r)$$\n这是一个周期性狄拉克 delta 函数脉冲串的傅里叶级数表示。根据泊松求和公式，此和等价于：\n$$s(r) = \\frac{1}{\\Delta k} \\sum_{m=-\\infty}^{\\infty} \\delta\\left(r - \\frac{m}{\\Delta k}\\right)$$\n将此代入 $x_{rep}(r)$ 的表达式中：\n$$x_{rep}(r) = x(r) * \\left(\\frac{1}{\\Delta k} \\sum_{m=-\\infty}^{\\infty} \\delta\\left(r - \\frac{m}{\\Delta k}\\right)\\right)$$\n与一个移位的 delta 函数卷积会得到一个移位的函数，所以：\n$$x_{rep}(r) = \\frac{1}{\\Delta k} \\sum_{m=-\\infty}^{\\infty} x\\left(r - \\frac{m}{\\Delta k}\\right)$$\n这个结果表明，重建的图像由无穷多个原始物体 $x(r)$ 的复制品组成，它们以 $r_m = m/\\Delta k$ 为中心，并按 $1/\\Delta k$ 的比例缩放。\n\n混叠是这些复制品的重叠。问题陈述指出，物体 $x(r)$ 的有限支撑长度为 $L$，即当 $|r| > L/2$ 时 $x(r) = 0$。中心复制品 ($m=0$) 的支撑区间为 $[-L/2, L/2]$。相邻复制品 ($m=1$) 的支撑区间为 $[1/\\Delta k - L/2, 1/\\Delta k + L/2]$。为防止混叠，这些支撑区间不得重叠。条件是中心复制品支撑区间的上界必须小于或等于相邻复制品支撑区间的下界：\n$$\\frac{L}{2} \\le \\frac{1}{\\Delta k} - \\frac{L}{2} \\implies L \\le \\frac{1}{\\Delta k}$$\n这意味着采样间隔必须满足 $\\Delta k \\le 1/L$。允许的最大采样间隔 $\\Delta k^{\\star}$ 是满足此条件极限的值：\n$$\\Delta k^{\\star} = \\frac{1}{L}$$\n\n**第二部分：标称空间分辨率 $\\delta r$ 的推导**\n\n在总宽度为 $2K_{\\max}$ 的对称 $k$ 空间窗口内采集了有限数量的 $N$ 个样本。这可以建模为将理想的 $k$ 空间数据 $X(k)$ 乘以一个矩形窗函数 $W(k) = \\mathrm{rect}(k/(2K_{\\max}))$，该函数在 $|k| \\le K_{\\max}$ 时为 $1$，否则为 $0$。重建图像 $x_{recon}(r)$ 则是真实物体 $x(r)$ 与点扩散函数 (PSF) 的卷积，而 PSF 是窗口函数 $W(k)$ 的傅里叶逆变换：\n$$x_{recon}(r) = x(r) * \\mathrm{PSF}(r)$$\nPSF 计算如下：\n$$\\mathrm{PSF}(r) = \\mathcal{F}^{-1}\\{W(k)\\} = \\int_{-K_{\\max}}^{K_{\\max}} 1 \\cdot \\exp(i 2\\pi kr) dk$$\n$$\\mathrm{PSF}(r) = \\left[ \\frac{\\exp(i 2\\pi kr)}{i 2\\pi r} \\right]_{-K_{\\max}}^{K_{\\max}} = \\frac{\\exp(i 2\\pi K_{\\max} r) - \\exp(-i 2\\pi K_{\\max} r)}{i 2\\pi r}$$\n使用欧拉恒等式 $\\sin(\\theta) = (\\exp(i\\theta) - \\exp(-i\\theta))/(2i)$，我们简化表达式：\n$$\\mathrm{PSF}(r) = \\frac{2i\\sin(2\\pi K_{\\max} r)}{i 2\\pi r} = \\frac{\\sin(2\\pi K_{\\max} r)}{\\pi r}$$\n这是一个未归一化的 sinc 函数。标称分辨率 $\\delta r$ 由主瓣零点交叉定义，即从 $r=0$ 处的中心峰值到 PSF 第一个零点的距离。当正弦函数的参数是 $\\pi$ 的整数倍时，出现零点。第一个非零点交叉发生在：\n$$|2\\pi K_{\\max} r| = \\pi \\implies |r| = \\frac{1}{2K_{\\max}}$$\n因此，分辨率为 $\\delta r = 1/(2K_{\\max})$。\n$k$ 空间采集的总宽度给出为 $2K_{\\max} \\approx N \\Delta k$。将此代入 $\\delta r$ 的表达式中：\n$$\\delta r = \\frac{1}{N \\Delta k}$$\n问题将视场定义为 $\\mathrm{FOV} = 1/\\Delta k$。使用此定义，我们得到标称空间分辨率的最终表达式：\n$$\\delta r = \\frac{\\mathrm{FOV}}{N}$$\n\n**第三部分：数值计算**\n\n给定参数：$L = 0.18\\,\\mathrm{m}$，$\\mathrm{FOV} = 0.25\\,\\mathrm{m}$，以及 $N=256$。\n\n1.  **$\\Delta k^{\\star}$ 的计算**：\n    $$\\Delta k^{\\star} = \\frac{1}{L} = \\frac{1}{0.18\\,\\mathrm{m}} \\approx 5.5555... \\,\\mathrm{m}^{-1}$$\n    四舍五入到四位有效数字，我们得到 $\\Delta k^{\\star} = 5.556\\,\\mathrm{m}^{-1}$。\n\n2.  **$\\delta r$ 的计算**：\n    $$\\delta r = \\frac{\\mathrm{FOV}}{N} = \\frac{0.25\\,\\mathrm{m}}{256} = 0.0009765625\\,\\mathrm{m}$$\n    问题要求结果以毫米为单位 ($1\\,\\mathrm{m} = 1000\\,\\mathrm{mm}$):\n    $$\\delta r = 0.0009765625 \\times 1000\\,\\mathrm{mm} = 0.9765625\\,\\mathrm{mm}$$\n    四舍五入到四位有效数字，我们得到 $\\delta r = 0.9766\\,\\mathrm{mm}$。\n\n所得数对 $(\\Delta k^{\\star}, \\delta r)$ 包含了推导出的数值。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n5.556  0.9766\n\\end{pmatrix}\n}\n$$", "id": "3399736"}, {"introduction": "在掌握了理论基础之后，下一步是将其付诸实践。本练习将指导您编写一个程序，模拟完整的二维MRI重建流程，这如同建立一个“虚拟扫描仪”。您将创建一个数字“体模”（phantom），在傅里叶域（即k空间）中对其进行采样，并探索不同的采样轨迹——例如笛卡尔网格、放射状和螺旋状——如何影响最终的图像质量。通过亲手实现并观察不同采样策略（包括欠采样）所产生的混叠和模糊等伪影，您将对k空间数据的性质及其在成像中的核心作用获得直观而深刻的理解。[@problem_id:2391669]", "problem": "构建一个程序，通过在离散网格上沿指定的采样集填充二维离散傅里叶域（通常称为“k空间”），然后通过二维逆变换进行重建，从而执行磁共振成像（MRI）重建的离散模拟。该程序必须实现以下数学上精确的定义，并为固定的测试套件生成定量的误差度量。\n\n定义：\n- 令 $N$ 为一个正偶数。对于 $n \\in \\{0,\\dots,N-1\\}$ 和 $m \\in \\{0,\\dots,N-1\\}$，定义离散图像 $g[n,m]$ 为\n$$\nx_n = \\frac{n - N/2}{N}, \\quad y_m = \\frac{m - N/2}{N},\n$$\n和\n$$\ng[n,m] = \\exp\\!\\left(-\\frac{(x_n - a_1)^2 + (y_m - b_1)^2}{2 \\sigma_1^2}\\right) + \\alpha \\exp\\!\\left(-\\frac{(x_n - a_2)^2 + (y_m - b_2)^2}{2 \\sigma_2^2}\\right),\n$$\n参数固定为 $a_1 = 0.15$，$b_1 = -0.10$，$\\sigma_1 = 0.08$，$\\alpha = 0.8$，$a_2 = -0.20$，$b_2 = 0.25$，$\\sigma_2 = 0.12$。所有量均为无量纲。\n- 定义 $g[n,m]$ 的二维离散傅里叶变换（DFT）为\n$$\nG[k,\\ell] = \\sum_{n=0}^{N-1}\\sum_{m=0}^{N-1} g[n,m] \\exp\\!\\left(-2\\pi i \\left(\\frac{k n}{N} + \\frac{\\ell m}{N}\\right)\\right),\n$$\n其中 $k,\\ell \\in \\{0,\\dots,N-1\\}$。\n- 通过索引平移定义“中心化”傅里叶数组 $K[p,q]$\n$$\nK[p,q] = G[(p + N/2) \\bmod N,\\; (q + N/2) \\bmod N],\n$$\n其中 $p,q \\in \\{0,\\dots,N-1\\}$。在此表示中，零空间频率位于数组索引 $(p,q) = (N/2, N/2)$ 处。\n- 令采样集 $S \\subseteq \\{0,\\dots,N-1\\}^2$ 指定中心化数组中要保留的索引。采样后的中心化傅里叶数组为\n$$\n\\widetilde{K}[p,q] = \\begin{cases}\nK[p,q],  \\text{如果 } (p,q) \\in S,\\\\\n0,  \\text{否则,}\n\\end{cases}\n$$\n并通过逆平移获得非中心化的采样数组\n$$\n\\widetilde{G}[k,\\ell] = \\widetilde{K}[(k - N/2) \\bmod N,\\; (\\ell - N/2) \\bmod N]。\n$$\n- 重建的图像是逆DFT\n$$\n\\widetilde{g}[n,m] = \\frac{1}{N^2} \\sum_{k=0}^{N-1}\\sum_{\\ell=0}^{N-1} \\widetilde{G}[k,\\ell] \\exp\\!\\left(2\\pi i \\left(\\frac{k n}{N} + \\frac{\\ell m}{N}\\right)\\right)。\n$$\n- 将归一化均方根误差（NRMSE）定义为无量纲标量\n$$\n\\mathrm{NRMSE} = \\frac{\\left\\| \\widetilde{g} - g \\right\\|_2}{\\left\\| g \\right\\|_2},\n$$\n其中 $\\|\\cdot\\|_2$ 表示所有 $N^2$ 像素上的欧几里得范数，并且在差值计算中仅使用 $\\widetilde{g}$ 的实部。\n\n采样集构建规则：\n- 令 $c = N/2$（一个整数）表示中心索引。所有角度均以弧度为单位。\n- 舍入规则：每当需要将一个实值坐标映射到离散索引时，必须使用“四舍六入五成双”（ties go to the nearest even integer）的规则将其舍入到最近的整数。\n- 定义 $R_{\\max} = \\lfloor N/2 \\rfloor$。\n\n指定以下四个测试用例，其中 $N = 64$：\n1. 全笛卡尔采样：\n   - 采样集 $S_{\\mathrm{full}} = \\{0,\\dots,N-1\\} \\times \\{0,\\dots,N-1\\}$，意味着所有中心化的傅里叶系数都被保留。\n2. 穿过中心的径向辐条：\n   - 令 $M = 16$。对于每个 $j \\in \\{0,\\dots,M-1\\}$，定义 $\\theta_j = j \\pi / M$。对于每个半径 $r \\in \\{0,1,\\dots,R_{\\max}\\}$，生成一个点\n   $$\n   p = c + \\operatorname{round}\\!\\left(r \\cos \\theta_j\\right), \\quad q = c + \\operatorname{round}\\!\\left(r \\sin \\theta_j\\right),\n   $$\n   使用指定的舍入规则，如果 $0 \\le p  N$ 且 $0 \\le q  N$，则将 $(p,q)$ 包含在 $S_{\\mathrm{rad}}$ 中。最终的采样集是所有 $j$ 和 $r$ 的并集（若有重复，则不影响结果）。\n3. 穿过中心的阿基米德螺旋线：\n   - 令 $L = 3$（圈数）且 $\\Delta\\theta = \\pi/128$。对于 $s \\in \\{0,1,\\dots,S\\}$，其中 $S = \\left\\lfloor \\frac{2\\pi L}{\\Delta\\theta} \\right\\rfloor$，定义 $\\theta_s = s \\Delta \\theta$ 和半径\n   $$\n   r_s = \\frac{R_{\\max}}{2\\pi L} \\theta_s.\n   $$\n   生成\n   $$\n   p = c + \\operatorname{round}\\!\\left(r_s \\cos \\theta_s\\right), \\quad q = c + \\operatorname{round}\\!\\left(r_s \\sin \\theta_s\\right),\n   $$\n   如果 $0 \\le p  N$ 且 $0 \\le q  N$，则将 $(p,q)$ 包含在 $S_{\\mathrm{spi}}$ 中。\n4. 中心化的方形低通区域：\n   - 令 $K_c = 8$。将所有满足 $|p - c| \\le K_c$ 和 $|q - c| \\le K_c$ 的 $(p,q)$ 包含在 $S_{\\mathrm{lp}}$ 中。\n\n对于每个测试用例 $t \\in \\{\\mathrm{full}, \\mathrm{rad}, \\mathrm{spi}, \\mathrm{lp}\\}$：\n- 根据给定的参数为 $N=64$ 构建 $g[n,m]$。\n- 计算 $G[k,\\ell]$、$K[p,q]$，通过应用指定的采样集 $S_t$ 形成 $\\widetilde{K}$，通过逆平移获得 $\\widetilde{G}[k,\\ell]$，最后计算 $\\widetilde{g}[n,m]$。\n- 计算如上定义的NRMSE。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含与测试用例 $\\left[\\mathrm{full}, \\mathrm{rad}, \\mathrm{spi}, \\mathrm{lp}\\right]$ 顺序对应的四个 NRMSE 值，格式为方括号内以逗号分隔的列表，例如，“[$x_1,x_2,x_3,x_4$]”。每个条目必须是一个浮点数。\n\n角度单位说明：所有角度均以弧度为单位。不需要物理单位；所有量均为无量纲。", "solution": "问题陈述已经过评估，并被认定为有效。它在科学上基于磁共振成像和数字信号处理的原理，在数学上是适定的，并且没有歧义。所有定义、参数和程序都已足够严谨地指定，以确保能够得出一个唯一且可验证的解。\n\n该任务是从傅里叶域数据中模拟二维图像的重建，这些数据已根据各种模式进行了子采样。这个过程是磁共振成像（MRI）的核心，其中傅里叶域数据（称为k空间）是按顺序采集的。重建图像的质量关键取决于采集了哪些k空间样本。我们将计算归一化均方根误差（NRMSE）来量化四种不同采样方案下的图像质量。\n\n步骤如下：\n\n1.  **体模图像生成**：\n    首先，我们构建原始的离散图像 $g[n,m]$，它作为“基准真相”（ground truth）。该图像定义在大小为 $N \\times N$ 的网格上，其中 $N=64$。空间坐标 $(x_n, y_m)$ 被归一化到域 $[-0.5, 0.5)$。图像本身是两个高斯函数的叠加，代表一个简化的生物结构。\n    坐标由以下公式给出：\n    $$\n    x_n = \\frac{n - N/2}{N}, \\quad y_m = \\frac{m - N/2}{N} \\quad \\text{for } n,m \\in \\{0, \\dots, N-1\\}\n    $$\n    图像强度为：\n    $$\n    g[n,m] = \\exp\\!\\left(-\\frac{(x_n - a_1)^2 + (y_m - b_1)^2}{2 \\sigma_1^2}\\right) + \\alpha \\exp\\!\\left(-\\frac{(x_n - a_2)^2 + (y_m - b_2)^2}{2 \\sigma_2^2}\\right)\n    $$\n    使用提供的参数： $a_1 = 0.15$，$b_1 = -0.10$，$\\sigma_1 = 0.08$，$\\alpha = 0.8$，$a_2 = -0.20$，$b_2 = 0.25$，以及 $\\sigma_2 = 0.12$。由于 $g[n,m]$ 是实值指数函数的和，它是一个实值数组。\n\n2.  **傅里叶变换（k空间生成）**：\n    MRI信号采集过程对图像的傅里叶变换进行采样。我们通过计算 $g[n,m]$ 的二维离散傅里叶变换（DFT）来模拟完整的傅里叶系数集：\n    $$\n    G[k,\\ell] = \\sum_{n=0}^{N-1}\\sum_{m=0}^{N-1} g[n,m] \\exp\\!\\left(-2\\pi i \\left(\\frac{k n}{N} + \\frac{\\ell m}{N}\\right)\\right)\n    $$\n    这可以使用快速傅里叶变换（FFT）算法高效计算。根据数字信号处理的惯例，零频分量（$k=0, \\ell=0$）位于数组 `G` 的原点。为了便于处理和可视化，通常的做法是将该分量移到数组的中心。这个中心化的数组表示为 $K[p,q]$：\n    $$\n    K[p,q] = G[(p + N/2) \\bmod N,\\; (q + N/2) \\bmod N]\n    $$\n    此操作将低空间频率置于k空间数组的中心，高空间频率置于其外围，这反映了MRI中通常如何概念化k空间。\n\n3.  **k空间采样**：\n    然后，我们通过创建一个对应于采样集 $S$ 的二进制掩码来模拟部分k空间采集。对于四个测试用例中的每一个，我们都构建一个唯一的集合 $S$。采样后的k空间 $\\widetilde{K}[p,q]$ 是通过将完整的k空间 $K[p,q]$ 与此掩码进行逐元素相乘得到的：\n    $$\n    \\widetilde{K}[p,q] = \\begin{cases}\n    K[p,q],  \\text{如果 } (p,q) \\in S,\\\\\n    0,  \\text{否则。}\n    \\end{cases}\n    $$\n    四个采样集 $S_t$ 根据提供的规则构建：\n    -   $S_{\\mathrm{full}}$：一个平凡的情况，其中掩码全为1，表示完整的数据采集。\n    -   $S_{\\mathrm{rad}}$：一组穿过k空间中心的 $M=16$ 条径向线（辐条）。\n    -   $S_{\\mathrm{spi}}$：一条具有 $L=3$ 圈的阿基米德螺旋轨迹。\n    -   $S_{\\mathrm{lp}}$：一个方形低通滤波器，仅保留k空间中心的 $17 \\times 17$ 区域。\n    对于径向和螺旋线情况，浮点坐标使用“四舍六入五成双”规则映射到离散网格索引，这是Python 3的 `round()` 函数的默认行为。\n\n4.  **图像重建**：\n    为了从采样的k空间数据重建图像，我们必须首先反转中心化操作：\n    $$\n    \\widetilde{G}[k,\\ell] = \\widetilde{K}[(k - N/2) \\bmod N,\\; (\\ell - N/2) \\bmod N]\n    $$\n    这将零频分量放回数组的原点，这是标准逆DFT算法所要求的。然后通过逆DFT计算重建的图像 $\\widetilde{g}[n,m]$：\n    $$\n    \\widetilde{g}[n,m] = \\frac{1}{N^2} \\sum_{k=0}^{N-1}\\sum_{\\ell=0}^{N-1} \\widetilde{G}[k,\\ell] \\exp\\!\\left(2\\pi i \\left(\\frac{k n}{N} + \\frac{\\ell m}{N}\\right)\\right)\n    $$\n    $1/N^2$ 的因子是逆DFT的标准归一化。这也可以使用逆FFT算法高效计算。由于k空间中的数据被丢弃，$\\widetilde{K}$ 通常不具备其逆傅里叶变换为纯实数所需的共轭对称性。因此，$\\widetilde{g}[n,m]$ 将是一个复值数组。\n\n5.  **误差量化**：\n    最后，我们量化由于不完整采样导致的图像质量下降。计算归一化均方根误差（NRMSE）。根据规定，误差是在原始实值图像 $g$ 和重建的复值图像 $\\widetilde{g}$ 的实部之间计算的：\n    $$\n    \\mathrm{NRMSE} = \\frac{\\left\\| \\mathrm{Re}(\\widetilde{g}) - g \\right\\|_2}{\\left\\| g \\right\\|_2}\n    $$\n    此处，$\\|\\cdot\\|_2$ 是欧几里得（或弗罗贝尼乌斯）范数，在所有 $N^2$ 个像素值上计算。该度量提供了一个无量纲的平均重建误差度量，由原始图像的“能量”进行归一化。\n\n将对四种指定的k空间采样策略中的每一种执行整个过程，并报告所得的NRMSE值。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Simulates MRI reconstruction for different k-space sampling patterns\n    and calculates the Normalized Root-Mean-Square Error (NRMSE) for each.\n    \"\"\"\n    # Define problem parameters\n    N = 64\n    params_g = {\n        'a1': 0.15, 'b1': -0.10, 'sigma1': 0.08,\n        'alpha': 0.8,\n        'a2': -0.20, 'b2': 0.25, 'sigma2': 0.12\n    }\n    \n    # 1. Phantom Image Generation\n    def create_phantom(N, params):\n        n = np.arange(N)\n        m = np.arange(N)\n        x_n = (n - N / 2) / N\n        y_m = (m - N / 2) / N\n        xx, yy = np.meshgrid(x_n, y_m, indexing='ij')\n\n        g1 = np.exp(-((xx - params['a1'])**2 + (yy - params['b1'])**2) / (2 * params['sigma1']**2))\n        g2 = params['alpha'] * np.exp(-((xx - params['a2'])**2 + (yy - params['b2'])**2) / (2 * params['sigma2']**2))\n        \n        return g1 + g2\n\n    # 3. k-space Sampling Mask Generation\n    def get_sampling_mask(sampling_type, N):\n        mask = np.zeros((N, N), dtype=bool)\n        c = N / 2\n        R_max = np.floor(N / 2)\n\n        if sampling_type == 'full':\n            mask[:, :] = True\n            \n        elif sampling_type == 'rad':\n            M = 16\n            for j in range(M):\n                theta_j = j * np.pi / M\n                cos_theta = np.cos(theta_j)\n                sin_theta = np.sin(theta_j)\n                for r in range(int(R_max) + 1):\n                    p_float = c + r * cos_theta\n                    q_float = c + r * sin_theta\n                    p = int(round(p_float))\n                    q = int(round(q_float))\n                    if 0 = p  N and 0 = q  N:\n                        mask[p, q] = True\n\n        elif sampling_type == 'spi':\n            L = 3\n            delta_theta = np.pi / 128\n            S = int(np.floor(2 * np.pi * L / delta_theta))\n            for s_idx in range(S + 1):\n                theta_s = s_idx * delta_theta\n                r_s = (R_max / (2 * np.pi * L)) * theta_s\n                p_float = c + r_s * np.cos(theta_s)\n                q_float = c + r_s * np.sin(theta_s)\n                p = int(round(p_float))\n                q = int(round(q_float))\n                if 0 = p  N and 0 = q  N:\n                    mask[p, q] = True\n        \n        elif sampling_type == 'lp':\n            K_c = 8\n            c_int = int(c)\n            p_start, p_end = c_int - K_c, c_int + K_c\n            q_start, q_end = c_int - K_c, c_int + K_c\n            mask[p_start : p_end + 1, q_start : q_end + 1] = True\n        \n        else:\n            raise ValueError(\"Unknown sampling type\")\n            \n        return mask\n\n    # Execute simulation for each test case\n    g_true = create_phantom(N, params_g)\n    norm_g_true = np.linalg.norm(g_true)\n    \n    # 2. Fourier Transformation\n    G = np.fft.fft2(g_true)\n    K = np.fft.fftshift(G)\n    \n    results = []\n    test_cases = ['full', 'rad', 'spi', 'lp']\n\n    for case_name in test_cases:\n        # 3. Apply Sampling\n        sampling_mask = get_sampling_mask(case_name, N)\n        K_tilde = K * sampling_mask\n        \n        # 4. Image Reconstruction\n        G_tilde = np.fft.ifftshift(K_tilde)\n        g_tilde = np.fft.ifft2(G_tilde)\n        \n        # 5. Error Quantification\n        g_tilde_real = np.real(g_tilde)\n        nrmse = np.linalg.norm(g_tilde_real - g_true) / norm_g_true\n        results.append(nrmse)\n\n    # Format and print the final output\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "2391669"}, {"introduction": "常规MRI重建遵循奈奎斯特采样定理，但这往往耗时较长。压缩感知（Compressed Sensing, CS）技术通过稀疏性先验，允许从远低于传统要求的k空间数据中重建出高质量图像，从而彻底改变了快速成像。本实践旨在揭开压缩感知理论中一个核心但抽象的概念——“受限等距性质”（Restricted Isometry Property, RIP）。您将通过一个具体、可计算的小规模示例，亲手计算一个特定欠采样模式下的互相关性（mutual coherence），并以此为基础估算RIP常数 $\\delta_2$。这个练习将理论与计算紧密结合，帮助您理解我们如何量化并确保在严重欠采样条件下重建的稳定性和准确性。[@problem_id:3399804]", "problem": "考虑一维磁共振成像 (MRI) 采集，其模型为在 $k$ 空间中使用变密度采样掩模的部分离散傅里叶变换 (DFT)。设图像表示为一个复值向量 $x \\in \\mathbb{C}^{N}$，其中 $N = 8$。编码算子是酉 DFT 矩阵 $F \\in \\mathbb{C}^{8 \\times 8}$，其元素为 $F_{k,n} = \\frac{1}{\\sqrt{8}}\\exp\\!\\left(- i \\frac{2\\pi}{8} k n\\right)$，其中 $k,n \\in \\{0,1,\\dots,7\\}$。一个变密度采样掩模选择了 $M = 4$ 个频率索引 $S = \\{0,1,3,6\\}$。测量算子 $A \\in \\mathbb{C}^{4 \\times 8}$ 是通过取 $F$ 中由 $S$ 索引的行构成的。为确保列的范数为单位1，该算子按因子 $\\sqrt{\\frac{N}{M}}$ 进行列归一化，因此归一化后的传感矩阵为 $\\tilde{A} = \\sqrt{\\frac{N}{M}}\\,A$。\n\n定义 $\\tilde{A}$ 的互相关性为 $\\mu(\\tilde{A}) = \\max_{i \\neq j} |\\langle \\tilde{a}_{i}, \\tilde{a}_{j} \\rangle|$，其中 $\\tilde{a}_{i}$ 表示 $\\tilde{A}$ 的第 $i$ 个列，其范数为单位1。阶数为 $s$ 的受限等距性质 (RIP) 常数，记为 $\\delta_{s}$，是满足以下条件的最小常数：对于每个 $s$-稀疏向量 $z \\in \\mathbb{C}^{8}$，都有 $(1 - \\delta_{s})\\|z\\|_{2}^{2} \\le \\|\\tilde{A}z\\|_{2}^{2} \\le (1 + \\delta_{s})\\|z\\|_{2}^{2}$。使用基于与 $s$-稀疏支撑集相关的 Gram 子矩阵的互相关性估计，为给定的掩模 $S = \\{0,1,3,6\\}$ 计算 $\\delta_{2}$ 的一个上界。\n\n具体来说，从第一性原理精确推导出 $\\mu(\\tilde{A})$，然后使用一个有效的互相关性到 RIP 的界来获得此次采集的 $\\delta_{2}$ 的数值上界。将你最终的数值上界四舍五入到四位有效数字。最终答案不需要单位。\n\n此外，从逆问题和压缩感知理论的第一性原理出发，解释在促进稀疏性的正则化下，$\\delta_{s}$ 的大小如何影响 MRI 重建中稳定且鲁棒的恢复保证的存在性。", "solution": "首先根据指定标准验证问题陈述。\n\n**步骤 1：提取已知条件**\n-   图像向量：$x \\in \\mathbb{C}^{N}$，其中 $N = 8$。\n-   DFT 矩阵：$F \\in \\mathbb{C}^{8 \\times 8}$，其元素为 $F_{k,n} = \\frac{1}{\\sqrt{8}}\\exp(- i \\frac{2\\pi}{8} k n)$，其中 $k,n \\in \\{0,1,\\dots,7\\}$。\n-   采样掩模：$M = 4$ 个频率索引 $S = \\{0,1,3,6\\}$。\n-   测量算子：$A \\in \\mathbb{C}^{4 \\times 8}$ 是通过取 $F$ 中由 $S$ 索引的行构成的。\n-   归一化传感矩阵：$\\tilde{A} = \\sqrt{\\frac{N}{M}}\\,A = \\sqrt{\\frac{8}{4}}\\,A = \\sqrt{2}\\,A$。\n-   互相关性：$\\mu(\\tilde{A}) = \\max_{i \\neq j} |\\langle \\tilde{a}_{i}, \\tilde{a}_{j} \\rangle|$，其中 $\\tilde{a}_{i}$ 是 $\\tilde{A}$ 的第 $i$ 个列。问题断言这些列是单位范数的。\n-   阶数为 $s$ 的受限等距性质 (RIP) 常数：$\\delta_{s}$ 是满足 $(1 - \\delta_{s})\\|z\\|_{2}^{2} \\le \\|\\tilde{A}z\\|_{2}^{2} \\le (1 + \\delta_{s})\\|z\\|_{2}^{2}$ 对任意 $s$-稀疏向量 $z \\in \\mathbb{C}^{8}$ 成立的最小常数。\n-   目标 1：通过首先精确推导 $\\mu(\\tilde{A})$，然后使用基于相关性的界来计算 $\\delta_{2}$ 的一个上界。\n-   目标 2：将最终的数值上界四舍五入到四位有效数字。\n-   目标 3：解释在促进稀疏性的 MRI 重建中，$\\delta_{s}$ 对恢复保证的影响。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据，提法恰当且客观。它提供了一个使用部分傅里叶矩阵的 MRI 采集的标准压缩感知模型。互相关性和受限等距性质是该领域的核心概念。所有必要的参数（$N, M, S$）和定义都已提供，使得问题是自洽且数学上一致的。归一化因子 $\\sqrt{N/M}$ 正确地确保了传感矩阵 $\\tilde{A}$ 的列是单位范数的，因为 $\\|\\tilde{a}_j\\|_2^2 = (\\sqrt{N/M})^2 \\sum_{k \\in S} |F_{k,j}|^2 = (N/M) \\sum_{k \\in S} (1/N) = (N/M)(M/N) = 1$。该问题是一个现实世界问题的可处理的小规模版本，并且可以按所述方式求解。\n\n**步骤 3：结论与行动**\n问题有效。将提供完整解答。\n\n**求解推导**\n\n求解过程分为三部分：首先，精确计算互相关性 $\\mu(\\tilde{A})$；其次，利用该相关性值推导 RIP 常数 $\\delta_{2}$ 的上界；第三，概念性地解释 RIP 在逆问题中的作用。\n\n**第一部分：计算互相关性 $\\mu(\\tilde{A})$**\n互相关性 $\\mu(\\tilde{A})$ 定义为归一化传感矩阵 $\\tilde{A}$ 不同列之间内积绝对值的最大值。$\\tilde{A}$ 的列由 $\\tilde{a}_j = \\sqrt{N/M} \\, a_j$ 给出，其中 $a_j$ 是子采样傅里叶矩阵 $A$ 的列。两个不同列 $\\tilde{a}_i$ 和 $\\tilde{a}_j$（其中 $i, j \\in \\{0, 1, \\dots, 7\\}$ 且 $i \\neq j$）之间的内积是：\n$$\n\\langle \\tilde{a}_{i}, \\tilde{a}_{j} \\rangle = \\left(\\sqrt{\\frac{N}{M}} a_i\\right)^H \\left(\\sqrt{\\frac{N}{M}} a_j\\right) = \\frac{N}{M} \\sum_{k \\in S} (F_{k,i})^* F_{k,j}\n$$\n代入 DFT 矩阵元素的定义 $F_{k,n} = \\frac{1}{\\sqrt{N}}\\exp(-i\\frac{2\\pi}{N}kn)$，我们得到：\n$$\n(F_{k,i})^* F_{k,j} = \\left(\\frac{1}{\\sqrt{N}}\\exp\\left(-i\\frac{2\\pi}{N}ki\\right)\\right)^* \\left(\\frac{1}{\\sqrt{N}}\\exp\\left(-i\\frac{2\\pi}{N}kj\\right)\\right) = \\frac{1}{N}\\exp\\left(i\\frac{2\\pi}{N}ki\\right)\\exp\\left(-i\\frac{2\\pi}{N}kj\\right) = \\frac{1}{N}\\exp\\left(i\\frac{2\\pi}{N}k(i-j)\\right)\n$$\n内积变为：\n$$\n\\langle \\tilde{a}_{i}, \\tilde{a}_{j} \\rangle = \\frac{N}{M} \\sum_{k \\in S} \\frac{1}{N}\\exp\\left(i\\frac{2\\pi}{N}k(i-j)\\right) = \\frac{1}{M} \\sum_{k \\in S} \\exp\\left(i\\frac{2\\pi}{N}k(i-j)\\right)\n$$\n这个表达式仅依赖于差值 $\\ell = i-j$。我们必须对所有可能的非零 $\\ell \\pmod N$ 值计算其大小。当 $N=8$, $M=4$, $S=\\{0,1,3,6\\}$ 时，我们有：\n$$\n|\\langle \\tilde{a}_{i}, \\tilde{a}_{j} \\rangle| = \\frac{1}{4} \\left| \\sum_{k \\in \\{0,1,3,6\\}} \\exp\\left(i\\frac{2\\pi}{8}k\\ell\\right) \\right| = \\frac{1}{4} \\left| \\sum_{k \\in \\{0,1,3,6\\}} \\exp\\left(i\\frac{\\pi}{4}k\\ell\\right) \\right|\n$$\n对于 $\\ell = i-j \\in \\{1, 2, \\dots, 7\\}$。我们对每个 $\\ell$ 计算这个和：\n-   对于 $\\ell=1$：和为 $1 + \\exp(i\\frac{\\pi}{4}) + \\exp(i\\frac{3\\pi}{4}) + \\exp(i\\frac{6\\pi}{4}) = 1 + (\\frac{\\sqrt{2}}{2}+i\\frac{\\sqrt{2}}{2}) + (-\\frac{\\sqrt{2}}{2}+i\\frac{\\sqrt{2}}{2}) + (-i) = 1 + i(\\sqrt{2}-1)$。其模为 $\\sqrt{1^2 + (\\sqrt{2}-1)^2} = \\sqrt{1 + 2 - 2\\sqrt{2} + 1} = \\sqrt{4 - 2\\sqrt{2}}$。\n-   对于 $\\ell=2$：和为 $1 + \\exp(i\\frac{2\\pi}{4}) + \\exp(i\\frac{6\\pi}{4}) + \\exp(i\\frac{12\\pi}{4}) = 1 + i - i - 1 = 0$。其模为 $0$。\n-   对于 $\\ell=3$：和为 $1 + \\exp(i\\frac{3\\pi}{4}) + \\exp(i\\frac{9\\pi}{4}) + \\exp(i\\frac{18\\pi}{4}) = 1 + \\exp(i\\frac{3\\pi}{4}) + \\exp(i\\frac{\\pi}{4}) + \\exp(i\\frac{\\pi}{2}) = 1 + (-\\frac{\\sqrt{2}}{2}+i\\frac{\\sqrt{2}}{2}) + (\\frac{\\sqrt{2}}{2}+i\\frac{\\sqrt{2}}{2}) + i = 1 + i(\\sqrt{2}+1)$。其模为 $\\sqrt{1^2 + (\\sqrt{2}+1)^2} = \\sqrt{1 + 2 + 2\\sqrt{2} + 1} = \\sqrt{4 + 2\\sqrt{2}}$。\n-   对于 $\\ell=4$：和为 $1 + \\exp(i\\pi) + \\exp(i3\\pi) + \\exp(i6\\pi) = 1 - 1 - 1 + 1 = 0$。其模为 $0$。\n对于 $\\ell=5=8-3$ 的和，其模与 $\\ell=3$ 的情况相等。对于 $\\ell=6=8-2$ 的和，其模为 $0$。对于 $\\ell=7=8-1$ 的和，其模与 $\\ell=1$ 的情况相等。和的模的最大值在 $\\ell=3$ 和 $\\ell=5$ 时取得，为 $\\sqrt{4 + 2\\sqrt{2}}$。\n\n互相关性是这些内积绝对值的最大值：\n$$\n\\mu(\\tilde{A}) = \\max_{\\ell \\in \\{1,...,7\\}} \\frac{1}{4} \\left|\\sum_{k \\in S} \\exp\\left(i\\frac{\\pi}{4}k\\ell\\right)\\right| = \\frac{1}{4} \\sqrt{4 + 2\\sqrt{2}}\n$$\n\n**第二部分：RIP 常数 $\\delta_2$ 的上界**\nRIP 常数 $\\delta_s$ 与所有 $s \\times s$ Gram 子矩阵 $\\tilde{A}_T^H \\tilde{A}_T$ 的特征值有关，其中 $T$ 是一个大小为 $s$ 的支撑集。具体来说，$\\delta_s = \\max_{|T|=s} \\|\\tilde{A}_T^H \\tilde{A}_T - I_s\\|_{2 \\to 2}$。对于 $s=2$，子矩阵是 $2 \\times 2$ 的：\n$$\nG_T = \\begin{pmatrix} \\|\\tilde{a}_i\\|_2^2  \\langle \\tilde{a}_j, \\tilde{a}_i \\rangle \\\\ \\langle \\tilde{a}_i, \\tilde{a}_j \\rangle  \\|\\tilde{a}_j\\|_2^2 \\end{pmatrix} = \\begin{pmatrix} 1  \\langle \\tilde{a}_j, \\tilde{a}_i \\rangle \\\\ \\langle \\tilde{a}_i, \\tilde{a}_j \\rangle  1 \\end{pmatrix}\n$$\n该矩阵的特征值 $\\lambda$ 满足 $(1-\\lambda)^2 - |\\langle \\tilde{a}_i, \\tilde{a}_j \\rangle|^2 = 0$，这给出 $\\lambda = 1 \\pm |\\langle \\tilde{a}_i, \\tilde{a}_j \\rangle|$。\nRIP 条件要求对于所有大小为 2 的支撑集，都有 $1 - \\delta_2 \\le \\lambda_{\\min}$ 和 $\\lambda_{\\max} \\le 1 + \\delta_2$。\n这意味着 $1 - \\delta_2 \\le \\min_{i \\neq j} (1 - |\\langle \\tilde{a}_i, \\tilde{a}_j \\rangle|) = 1 - \\max_{i \\neq j} |\\langle \\tilde{a}_i, \\tilde{a}_j \\rangle| = 1 - \\mu(\\tilde{A})$。\n并且 $1 + \\delta_2 \\ge \\max_{i \\neq j} (1 + |\\langle \\tilde{a}_i, \\tilde{a}_j \\rangle|) = 1 + \\max_{i \\neq j} |\\langle \\tilde{a}_i, \\tilde{a}_j \\rangle| = 1 + \\mu(\\tilde{A})$。\n两个不等式都意味着 $\\delta_2 \\ge \\mu(\\tilde{A})$。由于 $\\delta_2$ 被定义为满足 RIP 的最小可能常数，因此对于 $s=2$ 的情况，RIP 常数恰好等于互相关性：$\\delta_2 = \\mu(\\tilde{A})$。\n因此，$\\delta_2$ 的一个有效（实际上是最紧的）上界就是 $\\mu(\\tilde{A})$ 本身。\n$$\n\\delta_2 = \\frac{\\sqrt{4 + 2\\sqrt{2}}}{4}\n$$\n数值上，这个值为：\n$$\n\\delta_2 = \\frac{\\sqrt{4 + 2(1.41421356...)}}{4} = \\frac{\\sqrt{6.82842712...}}{4} \\approx \\frac{2.6131259...}{4} \\approx 0.6532814...\n$$\n四舍五入到四位有效数字得到 $0.6533$。\n\n**第三部分：$\\delta_s$ 在 MRI 重建中的作用**\n在像 MRI 重建这样的逆问题中，目标是从欠采样的测量值 $y = Ax$ 中恢复图像 $x$。当 $x$ 是稀疏的，或在某个变换域（例如，小波）中具有稀疏表示时，可以使用促进稀疏性的正则化，例如求解 $\\min_z \\|z\\|_1$ 约束于 $y = A_{eff} z$，其中 $z$ 是稀疏系数向量。传感矩阵 $A_{eff}$ 的受限等距性质 (RIP) 是保证此类方法成功的基石。\n\nRIP 常数 $\\delta_s$ 量化了传感矩阵在多大程度上保持了稀疏信号的欧几里得范数（或能量）。一个接近 0 的 $\\delta_s$ 值意味着该矩阵在所有 $s$-稀疏向量的集合上几乎像一个等距映射，保持了距离和几何结构。$\\delta_s$ 的大小从三个基本方面直接影响恢复保证：\n\n1.  **稀疏解的存在性和唯一性：** 条件 $\\delta_{2s}  1$ 是一个充分条件，保证任何 $s$-稀疏信号 $z$ 是线性系统 $y = A_{eff} z$ 的唯一最稀疏解。它确保了测量算子在 $2s$-稀疏信号集合上是单射的，这意味着两个不同的 $s$-稀疏信号不会产生相同的测量向量。这避免了模糊性，并保证在无噪声的情况下，真实的 $s$-稀疏信号可以被完美恢复。\n\n2.  **对测量噪声的稳定性：** 在任何实际采集中，测量都会受到噪声污染：$y = A_{eff} z + e$。一个好的重建算法必须是稳定的，这意味着测量中的小噪声应该导致恢复图像中的相应小误差。如果 RIP 以 $\\delta_{2s}  1$（或其他类似阈值）成立，那么重建信号中的误差 $\\|z_{rec} - z_{true}\\|_2$ 就保证被噪声水平 $\\|e\\|_2$ 的一个常数倍所界定。这些误差界中的常数依赖于 $\\delta_{2s}$，通常随着 $\\delta_{2s}$ 接近 1 而恶化（变大）。因此，一个更小的 $\\delta_{2s}$ 意味着更稳定的重建。\n\n3.  **对模型失配的鲁棒性：** 完美稀疏性的假设通常是一种理想化。现实世界的图像更适合被描述为“可压缩的”，这意味着它们可以被稀疏信号很好地近似。RIP 在这种情况下也提供了鲁棒性。如果一个信号 $z_{true}$ 不是严格稀疏的，但接近一个 $s$-稀疏信号，恢复算法保证能找到一个与真实信号接近的重建 $z_{rec}$。重建误差将由一个与噪声水平相关的项加上一个与真实信号能被 $s$-稀疏信号近似的程度相关的项所界定。同样，这个界的质量（所涉及的常数）关键取决于 $\\delta_{2s}$ 的值。\n\n总之，一个小的 RIP 常数 $\\delta_s$（特别是 $\\delta_{2s} \\ll 1$）是一个强有力的指标，表明促进稀疏性的重建将会成功，提供的解是唯一的、对噪声是稳定的，并且对图像并非完全稀疏的情况是鲁棒的。相反，如果 $\\delta_{2s} \\ge 1$，则不存在这样的保证，重建算法可能会灾难性地失败。", "answer": "$$\\boxed{0.6533}$$", "id": "3399804"}]}