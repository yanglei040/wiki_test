{"hands_on_practices": [{"introduction": "观测误差协方差矩阵 $R$ 是数据同化的核心，它编码了误差的大小及其相互依赖性。为了使同化问题良态（well-posed）且具有物理意义，$R$ 必须是对称正定的。本实践 [@problem_id:3406348] 提供了一个基础练习，通过直接计算一个给定的 $R$ 矩阵的逆、特征值和条件数，来验证这些属性并评估其数值稳定性。", "problem": "考虑一个变分数据同化系统中的线性观测模型，该模型用于单一地球物理状态变量，由两个具有相关误差的同位传感器同时观测。设观测误差向量被建模为一个零均值高斯随机向量，其协方差矩阵为 $R \\in \\mathbb{R}^{2 \\times 2}$。在科学上真实的观测误差协方差建模中，$R$ 必须是对称和正定的，以反映物理上有意义的方差和协方差，并确保在同化成本函数中对 $R$ 求逆时的适定性。假设报告的观测误差协方差矩阵为\n$$\nR = \\begin{pmatrix}\n4  1\\\\\n1  1\n\\end{pmatrix},\n$$\n其中矩阵元素的单位是观测量的平方（为具体起见，设为开尔文平方, $\\mathrm{K}^{2}$）。\n\n严格从概率论和线性代数的基本定义出发——即高斯随机向量的协方差矩阵的定义、对称矩阵的性质、通过特征值表征正定性以及谱条件数的定义——回答以下问题：\n\n1. 精确计算逆矩阵 $R^{-1}$，确保结果是对称的，正如对称正定矩阵的逆矩阵所要求的那样。\n2. 精确计算 $R$ 的特征值 $\\lambda_{1}$ 和 $\\lambda_{2}$，并用它们来验证正定性。\n3. 使用二范数谱条件数的定义，精确计算谱条件数 $\\kappa_{2}(R)$，以评估与同化成本函数中求逆相关的数值条件。\n\n所有结果均以精确的符号形式表示（无四舍五入）。关于单位报告：$R^{-1}$ 的元素单位应为 $\\mathrm{K}^{-2}$，特征值 $\\lambda_{1}, \\lambda_{2}$ 的单位应为 $\\mathrm{K}^{2}$。提供的最终特征值应按 $\\lambda_{1} \\geq \\lambda_{2} > 0$ 的顺序排列。最终答案必须是一个单一表达式，包含 $R^{-1}$ 的四个元素，后跟 $\\lambda_{1}$、$\\lambda_{2}$ 和 $\\kappa_{2}(R)$，使用 $\\text{pmatrix}$ 环境排列成一行，并以精确形式给出。", "solution": "对所述问题进行验证。\n\n### 步骤1：提取已知条件\n- **模型背景**：变分数据同化中的线性观测模型。\n- **状态变量**：单一地球物理状态变量。\n- **观测设置**：两个具有相关误差的同位传感器。\n- **误差模型**：观测误差向量是零均值高斯随机向量。\n- **协方差矩阵**：观测误差协方差矩阵表示为 $R \\in \\mathbb{R}^{2 \\times 2}$。\n- **$R$ 的性质**：$R$ 必须是对称和正定的。\n- **给定矩阵**：具体的协方差矩阵为 $R = \\begin{pmatrix} 4  1\\\\ 1  1 \\end{pmatrix}$。\n- **单位**：$R$ 的元素单位为开尔文平方, $\\mathrm{K}^{2}$。因此，$R^{-1}$ 的元素单位为 $\\mathrm{K}^{-2}$，$R$ 的特征值单位为 $\\mathrm{K}^{2}$。\n- **任务**：\n    1. 计算逆矩阵 $R^{-1}$。\n    2. 计算 $R$ 的特征值 $\\lambda_{1}, \\lambda_{2}$ 并验证正定性。特征值必须按 $\\lambda_{1} \\geq \\lambda_{2}$ 排序。\n    3. 使用二范数计算精确的谱条件数 $\\kappa_{2}(R)$。\n- **输出格式**：一个单行矩阵，包含 $R^{-1}$ 的四个元素，后跟 $\\lambda_{1}$、$\\lambda_{2}$ 和 $\\kappa_{2}(R)$。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据**：该问题在数据同化和反演问题的既定理论中有充分依据。协方差矩阵必须是对称和正定的，这是一项基本要求。对称性（$R_{ij} = \\text{cov}(e_i, e_j) = \\text{cov}(e_j, e_i) = R_{ji}$）源于协方差的定义。正定性确保了观测误差的任何线性组合的方差为正，这在物理上是必须的，并且它保证了同化成本函数中的二次型 $(\\mathbf{y} - H\\mathbf{x})^T R^{-1} (\\mathbf{y} - H\\mathbf{x})$ 具有唯一的最小值。给定矩阵是对称的，其对角元素（方差）为正，这是正定性的一个必要但不充分条件。该问题在科学上和数学上都是合理的。\n- **适定性**：这些任务涉及对给定非奇异矩阵进行线性代数中的标准、明确定义的计算（矩阵求逆、特征值计算、条件数计算）。存在唯一解。\n- **客观性**：问题以精确、客观的数学术语陈述。\n\n### 步骤3：结论与行动\n该问题被判定为**有效**。它自成体系、科学合理且适定。可以继续进行求解过程。\n\n---\n\n按要求分三部分进行求解。\n\n### 第1部分：计算逆矩阵 $R^{-1}$\n设给定矩阵为 $R = \\begin{pmatrix} a  b \\\\ c  d \\end{pmatrix} = \\begin{pmatrix} 4  1 \\\\ 1  1 \\end{pmatrix}$。由于 $b=c$，该矩阵是对称的。\n一个 $2 \\times 2$ 矩阵的逆由以下公式给出：\n$$\nR^{-1} = \\frac{1}{ad - bc} \\begin{pmatrix} d  -b \\\\ -c  a \\end{pmatrix}\n$$\n首先，我们计算 $R$ 的行列式，记为 $\\det(R)$。\n$$\n\\det(R) = (4)(1) - (1)(1) = 4 - 1 = 3\n$$\n由于 $\\det(R) \\neq 0$，逆矩阵存在。将数值代入公式：\n$$\nR^{-1} = \\frac{1}{3} \\begin{pmatrix} 1  -1 \\\\ -1  4 \\end{pmatrix}\n$$\n将标量因子 $\\frac{1}{3}$ 分配到矩阵中，得到逆矩阵的最终形式：\n$$\nR^{-1} = \\begin{pmatrix} \\frac{1}{3}  -\\frac{1}{3} \\\\ -\\frac{1}{3}  \\frac{4}{3} \\end{pmatrix}\n$$\n按要求，逆矩阵 $R^{-1}$ 也是一个对称矩阵。\n\n### 第2部分：计算特征值并验证正定性\n$R$ 矩阵的特征值 $\\lambda$ 是特征方程 $\\det(R - \\lambda I) = 0$ 的解，其中 $I$ 是 $2 \\times 2$ 单位矩阵。\n$$\nR - \\lambda I = \\begin{pmatrix} 4  1 \\\\ 1  1 \\end{pmatrix} - \\lambda \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} = \\begin{pmatrix} 4-\\lambda  1 \\\\ 1  1-\\lambda \\end{pmatrix}\n$$\n行列式为：\n$$\n\\det(R - \\lambda I) = (4-\\lambda)(1-\\lambda) - (1)(1) = 0\n$$\n展开此方程得到关于 $\\lambda$ 的二次方程：\n$$\n4 - 4\\lambda - \\lambda + \\lambda^2 - 1 = 0\n$$\n$$\n\\lambda^2 - 5\\lambda + 3 = 0\n$$\n我们使用二次公式 $\\lambda = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}$ 求解 $\\lambda$，其中 $a=1$, $b=-5$, $c=3$。\n$$\n\\lambda = \\frac{-(-5) \\pm \\sqrt{(-5)^2 - 4(1)(3)}}{2(1)} = \\frac{5 \\pm \\sqrt{25 - 12}}{2} = \\frac{5 \\pm \\sqrt{13}}{2}\n$$\n这给出了两个特征值。按照要求将它们排序为 $\\lambda_{1} \\geq \\lambda_{2}$：\n$$\n\\lambda_{1} = \\frac{5 + \\sqrt{13}}{2}\n$$\n$$\n\\lambda_{2} = \\frac{5 - \\sqrt{13}}{2}\n$$\n为验证 $R$ 是正定的，我们必须证明其所有特征值都严格为正。\n对于 $\\lambda_{1}$，$5$ 和 $\\sqrt{13}$ 都是正数，所以 $\\lambda_{1} > 0$。\n对于 $\\lambda_{2}$，我们需要检查是否 $5 - \\sqrt{13} > 0$。这等价于检查是否 $5 > \\sqrt{13}$，这又等价于 $5^2 > 13$，即 $25 > 13$。这是成立的。\n由于 $\\lambda_{1}$ 和 $\\lambda_{2}$ 都严格为正，对称矩阵 $R$ 是正定的。这证实了问题陈述的前提。\n\n### 第3部分：计算谱条件数 $\\kappa_{2}(R)$\n矩阵 $R$ 的谱条件数（使用矩阵 $2$-范数）定义为 $\\kappa_{2}(R) = \\|R\\|_{2} \\|R^{-1}\\|_{2}$。\n对于对称正定矩阵，其 $2$-范数等于其最大特征值 ($\\lambda_{\\max}$)。因此，$\\|R\\|_{2} = \\lambda_{\\max}(R)$。\n逆矩阵 $R^{-1}$ 的特征值是 $R$ 的特征值的倒数。因此，$R^{-1}$ 的最大特征值是 $R$ 的最小特征值的倒数，即 $\\lambda_{\\max}(R^{-1}) = 1/\\lambda_{\\min}(R)$。\n因此，对于对称正定矩阵，条件数简化为最大特征值与最小特征值的比值：\n$$\n\\kappa_{2}(R) = \\frac{\\lambda_{\\max}(R)}{\\lambda_{\\min}(R)} = \\frac{\\lambda_{1}}{\\lambda_{2}}\n$$\n代入计算出的特征值：\n$$\n\\kappa_{2}(R) = \\frac{\\frac{5 + \\sqrt{13}}{2}}{\\frac{5 - \\sqrt{13}}{2}} = \\frac{5 + \\sqrt{13}}{5 - \\sqrt{13}}\n$$\n为了以简化形式表示，我们通过将分子和分母乘以分母的共轭数 $5 + \\sqrt{13}$ 来使分母有理化：\n$$\n\\kappa_{2}(R) = \\frac{5 + \\sqrt{13}}{5 - \\sqrt{13}} \\times \\frac{5 + \\sqrt{13}}{5 + \\sqrt{13}} = \\frac{(5 + \\sqrt{13})^2}{5^2 - (\\sqrt{13})^2}\n$$\n分子展开为：\n$$\n(5 + \\sqrt{13})^2 = 5^2 + 2(5)(\\sqrt{13}) + (\\sqrt{13})^2 = 25 + 10\\sqrt{13} + 13 = 38 + 10\\sqrt{13}\n$$\n分母是：\n$$\n5^2 - (\\sqrt{13})^2 = 25 - 13 = 12\n$$\n结合这些结果：\n$$\n\\kappa_{2}(R) = \\frac{38 + 10\\sqrt{13}}{12}\n$$\n通过将分子和分母除以它们的最大公约数 $2$ 来简化分数：\n$$\n\\kappa_{2}(R) = \\frac{19 + 5\\sqrt{13}}{6}\n$$\n这就是精确的谱条件数。高条件数表明矩阵是病态的，意味着其逆矩阵对矩阵元素的微小扰动很敏感，这会在成本函数最小化中带来数值挑战。\n\n最终结果是：$R^{-1}$ 的元素、特征值 $\\lambda_1, \\lambda_2$ 和条件数 $\\kappa_2(R)$。将这些结果收集到所需的最终格式中。\n$R^{-1}$ 的四个元素是 $(R^{-1})_{11} = \\frac{1}{3}$，$(R^{-1})_{12} = -\\frac{1}{3}$，$(R^{-1})_{21} = -\\frac{1}{3}$，和 $(R^{-1})_{22} = \\frac{4}{3}$。\n$\\lambda_{1} = \\frac{5+\\sqrt{13}}{2}$。\n$\\lambda_{2} = \\frac{5-\\sqrt{13}}{2}$。\n$\\kappa_{2}(R) = \\frac{19+5\\sqrt{13}}{6}$。", "answer": "$$\\boxed{\\begin{pmatrix} \\frac{1}{3}  -\\frac{1}{3}  -\\frac{1}{3}  \\frac{4}{3}  \\frac{5 + \\sqrt{13}}{2}  \\frac{5 - \\sqrt{13}}{2}  \\frac{19 + 5\\sqrt{13}}{6} \\end{pmatrix}}$$", "id": "3406348"}, {"introduction": "尽管真实的观测误差协方差矩阵 $R$ 通常是稠密的，但一个常见的简化是假设它是对角矩阵，从而忽略了误差相关性。本实践 [@problem_id:3406328] 从抽象属性转向量化这种假设的具体影响。通过解析推导后验（分析）方差中的误差，你将清楚地理解在何种情况下忽略相关性会对数据同化系统的准确性造成损害。", "problem": "考虑一个线性高斯逆问题，其中单个标量状态 $x$ 是根据 $m \\geq 2$ 个同位观测值来估计的。$x$ 的先验是均值为 $\\mu_{b}$、方差为 $p_{b} > 0$ 的高斯分布。观测模型为 $\\mathbf{y} = x \\mathbf{1}_{m} + \\boldsymbol{\\epsilon}$，其中 $\\mathbf{1}_{m}$ 是 $m$ 维全1向量，$\\boldsymbol{\\epsilon}$ 是零均值高斯观测误差，其协方差矩阵为 $R \\in \\mathbb{R}^{m \\times m}$。假设 $R$ 的对角线上具有恒定方差 $\\sigma^{2} > 0$，非对角线上具有恒定相关系数 $\\rho$，即\n$$\nR = \\sigma^{2}\\left[(1-\\rho) I_{m} + \\rho\\, \\mathbf{1}_{m}\\mathbf{1}_{m}^{\\top}\\right],\n$$\n其中 $-\\frac{1}{m-1}  \\rho  1$ 以确保正定性，而 $I_{m}$ 是 $m \\times m$ 单位矩阵。\n\n从高斯先验和高斯似然的定义出发，推导在以下两种情况下的分析（后验）方差 $\\operatorname{Var}(x \\mid \\mathbf{y})$：\n(i) 使用上面给出的精确协方差 $R$，以及\n(ii) 使用忽略了交叉相关性的对角近似 $R_{d} = \\sigma^{2} I_{m}$。\n\n将分析方差中对角近似的相对误差定义为\n$$\n\\mathrm{RE}(\\rho) \\equiv \\frac{P_{a}^{\\mathrm{diag}} - P_{a}^{\\mathrm{true}}}{P_{a}^{\\mathrm{true}}},\n$$\n其中 $P_{a}^{\\mathrm{true}}$ 是用精确 $R$ 计算的分析方差，而 $P_{a}^{\\mathrm{diag}}$ 是用 $R_{d}$ 计算的分析方差。计算 $\\mathrm{RE}(\\rho)$，将其表示为以 $\\rho$、$m$、$\\sigma^{2}$ 和 $p_{b}$ 表示的闭式解析表达式。你的最终答案应该是一个单一的解析表达式；不需要数值近似，也不需要单位。", "solution": "### 第1步：提取已知条件\n- 单个标量状态变量：$x$。\n- 观测数量：$m \\geq 2$。\n- $x$ 的先验：均值为 $\\mu_{b}$、方差为 $p_{b}  0$ 的高斯分布，记为 $p(x) = \\mathcal{N}(x | \\mu_{b}, p_{b})$。\n- 观测模型：$\\mathbf{y} = x \\mathbf{1}_{m} + \\boldsymbol{\\epsilon}$，其中 $\\mathbf{1}_{m}$ 是 $m$ 维全1向量。\n- 观测误差 $\\boldsymbol{\\epsilon}$：零均值高斯分布，协方差矩阵为 $R \\in \\mathbb{R}^{m \\times m}$。\n- 精确协方差矩阵 $R$ 的结构：\n$$\nR = \\sigma^{2}\\left[(1-\\rho) I_{m} + \\rho\\, \\mathbf{1}_{m}\\mathbf{1}_{m}^{\\top}\\right]\n$$\n其中 $\\sigma^2  0$ 是方差，$\\rho$ 是相关系数，$I_m$ 是 $m \\times m$ 单位矩阵。\n- $\\rho$ 的约束条件：$-\\frac{1}{m-1}  \\rho  1$ 以确保 $R$ 是正定的。\n- 协方差矩阵的对角近似：$R_{d} = \\sigma^{2} I_{m}$。\n- 使用精确 $R$ 的分析（后验）方差的定义：$P_{a}^{\\mathrm{true}} = \\operatorname{Var}(x \\mid \\mathbf{y})$。\n- 使用近似 $R_d$ 的分析（后验）方差的定义：$P_{a}^{\\mathrm{diag}}$。\n- 相对误差的定义：\n$$\n\\mathrm{RE}(\\rho) \\equiv \\frac{P_{a}^{\\mathrm{diag}} - P_{a}^{\\mathrm{true}}}{P_{a}^{\\mathrm{true}}}\n$$\n\n### 第2步：使用提取的已知条件进行验证\n根据指定标准对问题进行验证。\n\n- **科学依据**：该问题设置在线性高斯模型的贝叶斯推断的标准框架内，这是统计学、数据同化和逆问题中的一个基础课题。所有概念（高斯先验、似然、后验、协方差矩阵）都是标准的且定义明确。协方差矩阵 $R$ 的结构对应于众所周知的等相关或复合对称模型。条件 $-\\frac{1}{m-1}  \\rho  1$ 是确保该矩阵正定性的正确数学条件。该问题在科学上是合理的。\n- **适定性**：该问题要求基于一套完整且一致的定义和方程来推导特定量（$P_{a}^{\\mathrm{true}}$、$P_{a}^{\\mathrm{diag}}$ 和 $\\mathrm{RE}(\\rho)$）。存在一个唯一、稳定且有意义的解，并且可以从所提供的信息中推导出来。\n- **客观性**：该问题使用精确的数学语言和定义进行陈述。它没有歧义、主观性或基于观点的论断。\n\n### 第3步：结论与行动\n该问题是**有效的**，因为它具有科学依据、适定性和客观性。开始求解。\n\n### 推导\n这是一个线性高斯逆问题。状态 $x$ 的先验分布由 $p(x) = \\mathcal{N}(x | \\mu_b, p_b)$ 给出。似然函数由观测模型 $\\mathbf{y} = x \\mathbf{1}_{m} + \\boldsymbol{\\epsilon}$（其中 $\\boldsymbol{\\epsilon} \\sim \\mathcal{N}(\\mathbf{0}, R)$）导出，为 $p(\\mathbf{y}|x) = \\mathcal{N}(\\mathbf{y} | x\\mathbf{1}_m, R)$。在标准形式 $\\mathbf{y} = Hx + \\boldsymbol{\\epsilon}$ 中，将标量状态 $x$ 映射到观测空间的观测算子 $H$ 是 $m$ 维全1向量，即 $H = \\mathbf{1}_{m} \\in \\mathbb{R}^{m \\times 1}$。\n\n后验分布 $p(x|\\mathbf{y})$ 也是高斯分布，其均值（分析状态）为 $x_a$，方差（分析方差）为 $P_a$。分析方差的逆由标准公式给出：\n$$\nP_a^{-1} = p_b^{-1} + H^{\\top}R^{-1}H\n$$\n将先验方差替换为 $p_b$ 并代入 $H = \\mathbf{1}_{m}$，上式变为：\n$$\nP_a^{-1} = \\frac{1}{p_b} + \\mathbf{1}_{m}^{\\top}R^{-1}\\mathbf{1}_{m}\n$$\n问题的核心是针对 $R$ 的两种不同选择，计算项 $\\mathbf{1}_{m}^{\\top}R^{-1}\\mathbf{1}_{m}$。\n\n**(i) 使用精确协方差 $R$ 的分析方差 ($P_{a}^{\\mathrm{true}}$)**\n\n精确协方差矩阵为 $R = \\sigma^{2}\\left[(1-\\rho) I_{m} + \\rho\\, \\mathbf{1}_{m}\\mathbf{1}_{m}^{\\top}\\right]$。为了计算 $\\mathbf{1}_{m}^{\\top}R^{-1}\\mathbf{1}_{m}$，我们可以利用 $R$ 的结构。向量 $\\mathbf{1}_{m}$ 是 $R$ 的一个特征向量。我们来验证这一点并找出对应的特征值 $\\lambda$：\n$$\nR\\mathbf{1}_{m} = \\sigma^{2}\\left[(1-\\rho) I_{m} + \\rho\\, \\mathbf{1}_{m}\\mathbf{1}_{m}^{\\top}\\right]\\mathbf{1}_{m}\n$$\n$$\nR\\mathbf{1}_{m} = \\sigma^{2}\\left((1-\\rho) I_{m}\\mathbf{1}_{m} + \\rho\\, \\mathbf{1}_{m}(\\mathbf{1}_{m}^{\\top}\\mathbf{1}_{m})\\right)\n$$\n由于 $I_{m}\\mathbf{1}_{m} = \\mathbf{1}_{m}$ 且 $\\mathbf{1}_{m}^{\\top}\\mathbf{1}_{m} = \\sum_{i=1}^{m} 1 = m$，上式可简化为：\n$$\nR\\mathbf{1}_{m} = \\sigma^{2}\\left((1-\\rho)\\mathbf{1}_{m} + \\rho m \\mathbf{1}_{m}\\right) = \\sigma^{2}(1 - \\rho + m\\rho)\\mathbf{1}_{m} = \\sigma^{2}(1 + (m-1)\\rho)\\mathbf{1}_{m}\n$$\n因此，$\\mathbf{1}_{m}$ 是 $R$ 的一个特征向量，其特征值为 $\\lambda = \\sigma^{2}(1 + (m-1)\\rho)$。\n对于一个可逆矩阵 $A$，如果其特征向量为 $v$，特征值为 $\\lambda$，那么其逆矩阵 $A^{-1}$ 具有相同的特征向量 $v$，但特征值为 $1/\\lambda$。因此，$R^{-1}\\mathbf{1}_{m} = \\frac{1}{\\lambda}\\mathbf{1}_{m}$。\n现在我们可以计算所需的项：\n$$\n\\mathbf{1}_{m}^{\\top}R^{-1}\\mathbf{1}_{m} = \\mathbf{1}_{m}^{\\top}\\left( \\frac{1}{\\sigma^{2}(1 + (m-1)\\rho)} \\mathbf{1}_{m} \\right) = \\frac{1}{\\sigma^{2}(1 + (m-1)\\rho)} (\\mathbf{1}_{m}^{\\top}\\mathbf{1}_{m}) = \\frac{m}{\\sigma^{2}(1 + (m-1)\\rho)}\n$$\n真实情况下的逆分析方差为：\n$$\n(P_a^{\\mathrm{true}})^{-1} = \\frac{1}{p_b} + \\frac{m}{\\sigma^{2}(1 + (m-1)\\rho)}\n$$\n因此，真实的分析方差为：\n$$\nP_a^{\\mathrm{true}} = \\left( \\frac{1}{p_b} + \\frac{m}{\\sigma^{2}(1 + (m-1)\\rho)} \\right)^{-1}\n$$\n\n**(ii) 使用对角近似 $R_d$ 的分析方差 ($P_{a}^{\\mathrm{diag}}$)**\n\n近似的对角协方差矩阵为 $R_d = \\sigma^2 I_m$。其逆矩阵就是 $R_d^{-1} = \\frac{1}{\\sigma^2}I_m$。\n我们计算项 $\\mathbf{1}_{m}^{\\top}R_d^{-1}\\mathbf{1}_{m}$：\n$$\n\\mathbf{1}_{m}^{\\top}R_d^{-1}\\mathbf{1}_{m} = \\mathbf{1}_{m}^{\\top}\\left(\\frac{1}{\\sigma^2}I_m\\right)\\mathbf{1}_{m} = \\frac{1}{\\sigma^2}(\\mathbf{1}_{m}^{\\top}\\mathbf{1}_{m}) = \\frac{m}{\\sigma^2}\n$$\n对角近似情况下的逆分析方差为：\n$$\n(P_a^{\\mathrm{diag}})^{-1} = \\frac{1}{p_b} + \\frac{m}{\\sigma^2}\n$$\n因此，在对角近似下的分析方差为：\n$$\nP_a^{\\mathrm{diag}} = \\left( \\frac{1}{p_b} + \\frac{m}{\\sigma^2} \\right)^{-1}\n$$\n\n**相对误差 $\\mathrm{RE}(\\rho)$ 的计算**\n\n相对误差定义为 $\\mathrm{RE}(\\rho) = \\frac{P_{a}^{\\mathrm{diag}} - P_{a}^{\\mathrm{true}}}{P_{a}^{\\mathrm{true}}} = \\frac{P_{a}^{\\mathrm{diag}}}{P_{a}^{\\mathrm{true}}} - 1$。\n方差之比等于其逆的逆比：\n$$\n\\frac{P_{a}^{\\mathrm{diag}}}{P_{a}^{\\mathrm{true}}} = \\frac{(P_a^{\\mathrm{true}})^{-1}}{(P_a^{\\mathrm{diag}})^{-1}} = \\frac{\\frac{1}{p_b} + \\frac{m}{\\sigma^{2}(1 + (m-1)\\rho)}}{\\frac{1}{p_b} + \\frac{m}{\\sigma^2}}\n$$\n将此代入 $\\mathrm{RE}(\\rho)$ 的表达式中：\n$$\n\\mathrm{RE}(\\rho) = \\frac{\\frac{1}{p_b} + \\frac{m}{\\sigma^{2}(1 + (m-1)\\rho)}}{\\frac{1}{p_b} + \\frac{m}{\\sigma^2}} - 1\n$$\n$$\n\\mathrm{RE}(\\rho) = \\frac{\\left(\\frac{1}{p_b} + \\frac{m}{\\sigma^{2}(1 + (m-1)\\rho)}\\right) - \\left(\\frac{1}{p_b} + \\frac{m}{\\sigma^2}\\right)}{\\frac{1}{p_b} + \\frac{m}{\\sigma^2}}\n$$\n$$\n\\mathrm{RE}(\\rho) = \\frac{\\frac{m}{\\sigma^2(1 + (m-1)\\rho)} - \\frac{m}{\\sigma^2}}{\\frac{1}{p_b} + \\frac{m}{\\sigma^2}} = \\frac{\\frac{m}{\\sigma^2}\\left(\\frac{1}{1 + (m-1)\\rho} - 1\\right)}{\\frac{1}{p_b} + \\frac{m}{\\sigma^2}}\n$$\n简化分子括号中的项：\n$$\n\\frac{1}{1 + (m-1)\\rho} - 1 = \\frac{1 - (1 + (m-1)\\rho)}{1 + (m-1)\\rho} = \\frac{-(m-1)\\rho}{1 + (m-1)\\rho}\n$$\n将其代回：\n$$\n\\mathrm{RE}(\\rho) = \\frac{\\frac{m}{\\sigma^2}\\left(\\frac{-(m-1)\\rho}{1 + (m-1)\\rho}\\right)}{\\frac{\\sigma^2 + m p_b}{p_b \\sigma^2}}\n$$\n$$\n\\mathrm{RE}(\\rho) = \\frac{m}{\\sigma^2} \\frac{-(m-1)\\rho}{1 + (m-1)\\rho} \\cdot \\frac{p_b \\sigma^2}{\\sigma^2 + m p_b}\n$$\n$$\n\\mathrm{RE}(\\rho) = \\frac{m p_b (-(m-1)\\rho)}{(\\sigma^2 + m p_b)(1 + (m-1)\\rho)}\n$$\n相对误差的最终表达式为：\n$$\n\\mathrm{RE}(\\rho) = - \\frac{m p_b (m-1)\\rho}{(\\sigma^2 + m p_b)(1 + (m-1)\\rho)}\n$$\n该表达式按要求用 $\\rho$、$m$、$\\sigma^2$ 和 $p_b$ 表示。", "answer": "$$\\boxed{- \\frac{m p_{b} (m-1)\\rho}{(\\sigma^{2} + m p_{b})(1 + (m-1)\\rho)}}$$", "id": "3406328"}, {"introduction": "在大型系统中，估计完整的观测误差协方差矩阵 $R$ 通常是困难的，且样本协方差可能包含虚假的远距离相关。协方差局地化是一项至关重要的实用技术，它通过对协方差矩阵进行锥削（tapering）以保留物理上合理的短程相关性来解决此问题。最后一个动手练习 [@problem_id:3406395] 要求你通过编程实现局地化，并量化其对分析协方差的影响，从而架起理论与实际应用之间的桥梁。", "problem": "考虑一个具有有限网格的一维空间线性高斯逆问题。设未知状态向量为 $x \\in \\mathbb{R}^n$，其高斯先验为 $x \\sim \\mathcal{N}(x_b, B)$，观测值 $y \\in \\mathbb{R}^m$ 由线性模型 $y = H x + \\varepsilon$ 生成，其中 $H \\in \\mathbb{R}^{m \\times n}$ 是观测算子，观测误差 $\\varepsilon \\sim \\mathcal{N}(0, R)$ 与 $x$ 无关。网格点的位置为 $x_i = i$，$i \\in \\{0,1,\\dots,n-1\\}$。先验协方差 $B \\in \\mathbb{R}^{n \\times n}$ 是平稳的，具有指数核；真实观测误差协方差 $R \\in \\mathbb{R}^{m \\times m}$ 也是平稳的，具有指数核，两者都具有有限的相关长度。\n\n基本原理：\n- 线性高斯贝叶斯法则意味着后验（分析）是高斯的，并且它源于先验二次型和似然二次型的组合。由此，可以通过配方法推导出分析协方差。\n- 舒尔乘积定理指出，两个半正定矩阵的逐元素（哈达玛）乘积是半正定的。\n\n观测误差协方差建模与局地化：\n- 真实观测误差协方差的元素为\n$$\nR_{ij}^{\\text{true}} = \\sigma_r^2 \\exp\\!\\left(-\\frac{|s_i - s_j|}{L_r}\\right),\n$$\n其中 $s_i$ 和 $s_j$ 是被观测分量的空间位置，$\\sigma_r^2$ 是方差，$L_r$ 是相关长度。\n- 局地化观测误差协方差构造如下\n$$\nR_{\\text{loc}} = R_{\\text{true}} \\odot C,\n$$\n其中 $\\odot$ 表示哈达玛乘积，$C$ 是一个由紧支集正定函数定义的锥化矩阵。使用 Wendland $C^2$ 锥化函数\n$$\n\\phi(q) =\n\\begin{cases}\n(1 - q)^4 (1 + 4 q),  0 \\le q \\le 1,\\\\\n0,  q  1,\n\\end{cases}\n$$\n其中 $q = \\frac{|s_i - s_j|}{L_{\\text{loc}}}$ 且矩阵元素为 $C_{ij} = \\phi\\!\\left(\\frac{|s_i - s_j|}{L_{\\text{loc}}}\\right)$。按照惯例，$L_{\\text{loc}} = \\infty$ 表示对所有 $i,j$ 都有 $C_{ij} = 1$（无局地化），而 $L_{\\text{loc}} = 0$ 表示 $C = I$（对角化）。\n\n任务：\n1. 仅使用上述基本原理，推导使用真实 $R_{\\text{true}}$ 的分析协方差 $A_\\star$ 和使用局地化 $R_{\\text{loc}}$ 的分析协方差 $A_{\\text{loc}}$。\n2. 通过相对弗罗贝尼乌斯范数量化由局地化引起的分析协方差偏差\n$$\n\\beta = \\frac{\\|A_{\\text{loc}} - A_\\star\\|_F}{\\|A_\\star\\|_F}.\n$$\n3. 实现一个程序，为下面的测试套件中的每个测试用例计算 $\\beta$。该程序应根据给定的参数构造 $B$、$H$、$R_{\\text{true}}$ 和 $R_{\\text{loc}}$，然后计算 $A_\\star$ 和 $A_{\\text{loc}}$，最后输出 $\\beta$ 值的列表。\n\n协方差构造细节：\n- 对于先验，\n$$\nB_{ij} = \\sigma_b^2 \\exp\\!\\left(-\\frac{|x_i - x_j|}{L_b}\\right), \\quad i,j \\in \\{0,1,\\dots,n-1\\}.\n$$\n- 对于 $R_{\\text{true}}$，计算被观测索引 $s_i$ 的位置，并使用与上述相同的指数形式以及参数 $(\\sigma_r, L_r)$。\n- 对于 $R_{\\text{loc}}$，如上所述将 Wendland $C^2$ 锥化函数应用于 $R_{\\text{true}}$。\n\n不涉及角度单位。不需要物理单位。所有输出必须是实数。\n\n测试套件：\n- 用例 $1$（理想情况，无局地化）：\n  - $n = 20$，观测索引 $\\{0,1,2,\\dots,19\\}$。\n  - $\\sigma_b = 1$, $L_b = 2$。\n  - $\\sigma_r = 0.5$, $L_r = 3$。\n  - $L_{\\text{loc}} = \\infty$。\n- 用例 $2$（中等局地化）：\n  - $n = 20$，观测索引 $\\{0,1,2,\\dots,19\\}$。\n  - $\\sigma_b = 1$, $L_b = 2$。\n  - $\\sigma_r = 0.5$, $L_r = 3$。\n  - $L_{\\text{loc}} = 2$。\n- 用例 $3$（强局地化至对角）：\n  - $n = 20$，观测索引 $\\{0,1,2,\\dots,19\\}$。\n  - $\\sigma_b = 1$, $L_b = 2$。\n  - $\\sigma_r = 0.5$, $L_r = 3$。\n  - $L_{\\text{loc}} = 0$。\n- 用例 $4$（带局地化的稀疏观测）：\n  - $n = 20$，观测索引 $\\{0,2,4,6,8,10,12,14,16,18\\}$。\n  - $\\sigma_b = 1$, $L_b = 2$。\n  - $\\sigma_r = 0.5$, $L_r = 3$。\n  - $L_{\\text{loc}} = 1$。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含按用例 $1$ 到 $4$ 顺序排列的结果，形式为方括号内以逗号分隔的列表，例如 $[\\beta_1,\\beta_2,\\beta_3,\\beta_4]$。", "solution": "该问题经评估有效。其科学基础是成熟的贝叶斯逆问题理论，问题陈述清晰，提供了所有必要信息，并且以客观、正式的语言表述。我们可以开始求解。\n\n任务是为一个线性高斯逆问题，在两种不同的观测误差协方差假设下，推导其分析协方差矩阵，然后量化由此产生的分析协方差偏差。\n\n### 第 1 部分：分析协方差的推导\n\n求解的基础在于贝叶斯定理，它将给定观测值 $y$ 时状态 $x$ 的后验概率 $p(x|y)$ 与似然 $p(y|x)$ 和先验 $p(x)$ 联系起来：\n$$\np(x|y) \\propto p(y|x) p(x)\n$$\n问题指定了在线性模型 $y = Hx + \\varepsilon$ 中，高斯先验为 $x \\sim \\mathcal{N}(x_b, B)$，高斯观测误差为 $\\varepsilon \\sim \\mathcal{N}(0, R)$。相应的概率密度函数为：\n- 先验: $p(x) \\propto \\exp\\left(-\\frac{1}{2}(x - x_b)^T B^{-1} (x - x_b)\\right)$\n- 似然: $p(y|x) \\propto \\exp\\left(-\\frac{1}{2}(y - Hx)^T R^{-1} (y - Hx)\\right)$\n\n由于两个关于 $x$ 的高斯函数之积仍为高斯函数，因此后验 $p(x|y)$ 也是高斯的。我们可以将其写为 $x|y \\sim \\mathcal{N}(x_a, A)$，其中 $x_a$ 是分析状态（后验均值），$A$ 是分析协方差（后验协方差）。\n\n后验密度的指数是先验和似然指数之和。该指数的负数定义了代价函数 $J(x)$，它与负对数后验成正比：\n$$\nJ(x) = \\frac{1}{2}(x - x_b)^T B^{-1} (x - x_b) + \\frac{1}{2}(y - Hx)^T R^{-1} (y - Hx)\n$$\n对于高斯分布 $\\mathcal{N}(\\mu, \\Sigma)$，指数中的二次型为 $\\frac{1}{2}(x-\\mu)^T \\Sigma^{-1}(x-\\mu)$。协方差矩阵的逆 $\\Sigma^{-1}$ 是该二次型相对于 $x$ 的海森矩阵。因此，分析协方差的逆 $A^{-1}$ 是 $J(x)$ 相对于 $x$ 的海森矩阵。\n\n为了求海森矩阵，我们首先展开 $J(x)$：\n$$\nJ(x) = \\frac{1}{2}(x^T B^{-1} x - 2x_b^T B^{-1} x + \\text{const}) + \\frac{1}{2}(x^T H^T R^{-1} H x - 2y^T R^{-1} H x + \\text{const})\n$$\n$J(x)$ 相对于 $x$ 的梯度为：\n$$\n\\nabla_x J(x) = B^{-1}(x - x_b) - H^T R^{-1}(y - Hx) = (B^{-1} + H^T R^{-1} H)x - (B^{-1}x_b + H^T R^{-1}y)\n$$\n海森矩阵是 $\\nabla_x J(x)$ 相对于 $x$ 的梯度：\n$$\n\\nabla_x^2 J(x) = A^{-1} = B^{-1} + H^T R^{-1} H\n$$\n对该表达式求逆，即可得到分析协方差 $A$ 的公式：\n$$\nA = \\left(B^{-1} + H^T R^{-1} H\\right)^{-1}\n$$\n此推导仅使用了问题陈述中指定的基本原理。\n\n现在我们可以定义所需的两种分析协方差：\n1.  真实的分析协方差 $A_\\star$ 是使用真实观测误差协方差 $R_{\\text{true}}$ 推导得出：\n    $$\n    A_\\star = \\left(B^{-1} + H^T R_{\\text{true}}^{-1} H\\right)^{-1}\n    $$\n2.  局地化的分析协方差 $A_{\\text{loc}}$ 是使用局地化观测误差协方差 $R_{\\text{loc}} = R_{\\text{true}} \\odot C$ 推导得出：\n    $$\n    A_{\\text{loc}} = \\left(B^{-1} + H^T R_{\\text{loc}}^{-1} H\\right)^{-1}\n    $$\n舒尔乘积定理指出，两个半正定矩阵的哈达玛乘积是半正定的，这确保了 $R_{\\text{col}}$ 是一个有效的协方差矩阵，因为 $R_{\\text{true}}$ 和 $C$ 都是由正定函数构造的，因此是正定的（对于 $C$ 可能是半正定的）。\n\n### 第 2 部分：偏差量化\n\n使用 $R_{\\text{loc}}$ 而非 $R_{\\text{true}}$ 所引起的偏差，通过所得分析协方差之间差异的相对弗罗贝尼乌斯范数来量化：\n$$\n\\beta = \\frac{\\|A_{\\text{loc}} - A_\\star\\|_F}{\\|A_\\star\\|_F}\n$$\n一个 $n \\times n$ 矩阵 $M$ 的弗罗贝尼乌斯范数定义为 $\\|M\\|_F = \\sqrt{\\sum_{i=1}^n \\sum_{j=1}^n |M_{ij}|^2}$。\n\n### 第 3 部分：算法实现\n\n每个测试用例的 $\\beta$ 计算过程如下：\n\n1.  **参数初始化**：对每个用例，设置 $n$、观测索引、$\\sigma_b$、$L_b$、$\\sigma_r$、$L_r$ 和 $L_{\\text{loc}}$ 的值。\n2.  **矩阵构造**：\n    -   生成网格点位置向量 $x_{pos} = [0, 1, \\dots, n-1]$。\n    -   使用公式 $B_{ij} = \\sigma_b^2 \\exp(-\\frac{|x_i - x_j|}{L_b})$ 构造 $n \\times n$ 的先验协方差矩阵 $B$。\n    -   确定观测数量 $m$，并构造 $m \\times n$ 的观测算子 $H$ 作为一个选择矩阵，将状态向量分量映射到观测分量。\n    -   根据 $x_{pos}$ 和观测索引生成观测位置向量 $s_{pos}$。\n    -   使用 $R_{ij}^{\\text{true}} = \\sigma_r^2 \\exp(-\\frac{|s_i - s_j|}{L_r})$ 构造 $m \\times m$ 的真实观测误差协方差 $R_{\\text{true}}$。\n    -   构造 $m \\times m$ 的局地化观测误差协方差 $R_{\\text{loc}}$：\n        -   如果 $L_{\\text{loc}} = \\infty$，则设置 $R_{\\text{loc}} = R_{\\text{true}}$。\n        -   如果 $L_{\\text{loc}} = 0$，则将 $R_{\\text{loc}}$ 设置为对角矩阵，其对角元素与 $R_{\\text{true}}$ 的对角元素相等，这可简化为 $\\sigma_r^2 I$。\n        -   否则，使用 Wendland $C^2$ 函数 $C_{ij} = \\phi(\\frac{|s_i - s_j|}{L_{\\text{loc}}})$ 构造 $m \\times m$ 的锥化矩阵 $C$，并计算哈达玛乘积 $R_{\\text{loc}} = R_{\\text{true}} \\odot C$。\n3.  **分析协方差计算**：\n    -   计算矩阵的逆 $B^{-1}$、$R_{\\text{true}}^{-1}$ 和 $R_{\\text{loc}}^{-1}$。\n    -   计算 $A_\\star = (B^{-1} + H^T R_{\\text{true}}^{-1} H)^{-1}$。\n    -   计算 $A_{\\text{loc}} = (B^{-1} + H^T R_{\\text{loc}}^{-1} H)^{-1}$。\n4.  **偏差计算**：\n    -   计算弗罗贝尼乌斯范数 $\\|A_{\\text{loc}} - A_\\star\\|_F$ 和 $\\|A_\\star\\|_F$。\n    -   计算它们的比率 $\\beta$。对于 $L_{\\text{loc}} = \\infty$ 的情况，$A_{\\text{loc}} = A_\\star$，因此 $\\beta$ 恰好为 0。\n5.  **输出**：将所有测试用例的 $\\beta$ 值收集到一个列表中，并按要求格式化输出。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_beta(n, observed_indices, sigma_b, L_b, sigma_r, L_r, L_loc):\n    \"\"\"\n    Calculates the bias in analysis covariance due to localization.\n\n    Args:\n        n (int): Dimension of the state vector.\n        observed_indices (list): Indices of the observed state components.\n        sigma_b (float): Standard deviation for the prior covariance.\n        L_b (float): Correlation length for the prior covariance.\n        sigma_r (float): Standard deviation for the observation error covariance.\n        L_r (float): Correlation length for the observation error covariance.\n        L_loc (float): Correlation length for the localization taper.\n\n    Returns:\n        float: The relative Frobenius norm of the bias, beta.\n    \"\"\"\n    # 1. Define grid and observation operator H\n    x_pos = np.arange(n, dtype=float)\n    obs_indices_arr = np.array(observed_indices, dtype=int)\n    m = len(obs_indices_arr)\n    H = np.zeros((m, n), dtype=float)\n    if m > 0:\n        H[np.arange(m), obs_indices_arr] = 1.0\n\n    # 2. Construct prior covariance B\n    dist_matrix_b = np.abs(x_pos[:, None] - x_pos[None, :])\n    B = sigma_b**2 * np.exp(-dist_matrix_b / L_b)\n\n    # 3. Construct true observation error covariance R_true\n    s_pos = x_pos[obs_indices_arr]\n    dist_matrix_r = np.abs(s_pos[:, None] - s_pos[None, :])\n    R_true = sigma_r**2 * np.exp(-dist_matrix_r / L_r)\n\n    # 4. Construct localized observation error covariance R_loc\n    if np.isinf(L_loc):\n        R_loc = R_true\n    elif L_loc == 0.0:\n        R_loc = np.diag(np.diag(R_true))\n    else:\n        q = dist_matrix_r / L_loc\n        # Wendland C^2 taper function: phi(q) = (1-q)^4 * (1+4q) for 0 = q = 1\n        phi = np.zeros_like(q, dtype=float)\n        mask = (q >= 0)  (q = 1)\n        q_masked = q[mask]\n        phi[mask] = (1 - q_masked)**4 * (1 + 4 * q_masked)\n        C = phi\n        R_loc = R_true * C  # Hadamard product\n\n    # 5. Compute analysis covariances A_star and A_loc\n    # Formula: A = (B_inv + H.T @ R_inv @ H)^-1\n    try:\n        B_inv = np.linalg.inv(B)\n        H_T = H.T\n\n        R_true_inv = np.linalg.inv(R_true)\n        A_star_inv = B_inv + H_T @ R_true_inv @ H\n        A_star = np.linalg.inv(A_star_inv)\n        \n        # When L_loc=inf, A_loc is A_star, so beta=0.\n        if np.isinf(L_loc):\n            return 0.0\n\n        R_loc_inv = np.linalg.inv(R_loc)\n        A_loc_inv = B_inv + H_T @ R_loc_inv @ H\n        A_loc = np.linalg.inv(A_loc_inv)\n\n    except np.linalg.LinAlgError:\n        # Should not happen with given parameters, but robust code handles it.\n        return np.nan\n\n    # 6. Quantify bias beta\n    diff_norm = np.linalg.norm(A_loc - A_star, 'fro')\n    star_norm = np.linalg.norm(A_star, 'fro')\n    \n    if star_norm == 0:\n        return np.inf if diff_norm > 0 else 0.0\n    \n    beta = diff_norm / star_norm\n    return beta\n\ndef solve():\n    \"\"\"\n    Solves the problem for all test cases and prints the results.\n    \"\"\"\n    test_cases = [\n        # Case 1 (happy path, no localization)\n        {'n': 20, 'observed_indices': list(range(20)), 'sigma_b': 1.0, 'L_b': 2.0, 'sigma_r': 0.5, 'L_r': 3.0, 'L_loc': np.inf},\n        # Case 2 (moderate localization)\n        {'n': 20, 'observed_indices': list(range(20)), 'sigma_b': 1.0, 'L_b': 2.0, 'sigma_r': 0.5, 'L_r': 3.0, 'L_loc': 2.0},\n        # Case 3 (strong localization to diagonal)\n        {'n': 20, 'observed_indices': list(range(20)), 'sigma_b': 1.0, 'L_b': 2.0, 'sigma_r': 0.5, 'L_r': 3.0, 'L_loc': 0.0},\n        # Case 4 (sparser observations with localization)\n        {'n': 20, 'observed_indices': list(range(0, 20, 2)), 'sigma_b': 1.0, 'L_b': 2.0, 'sigma_r': 0.5, 'L_r': 3.0, 'L_loc': 1.0}\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_beta(**case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3406395"}]}