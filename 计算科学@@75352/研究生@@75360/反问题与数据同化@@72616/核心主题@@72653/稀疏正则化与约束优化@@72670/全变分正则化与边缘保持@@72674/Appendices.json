{"hands_on_practices": [{"introduction": "为了在实践中（例如在数字图像上）应用全变分 (TV) 正则化，我们必须首先将 TV 的连续定义转化为离散公式。本练习将指导您从第一性原理出发，构建最常见的离散 TV 泛函，并分析它们的几何性质，如旋转不变性和网格偏置。理解这些细节对于为特定应用选择合适的正则化器至关重要 ([@problem_id:3427997])。", "problem": "考虑一个在矩形网格上定义的二维离散场 $u$，该网格在水平方向上有 $N_x$ 个节点，在垂直方向上有 $N_y$ 个节点，均匀间距分别为 $h_x$ 和 $h_y$。指数 $(i,j)$ 的范围是 $\\{0,1,\\dots,N_x-1\\} \\times \\{0,1,\\dots,N_y-1\\}$。要求您使用带有周期性边界条件的前向差分来构建离散全变分 (TV) 泛函，并分析它们的旋转不变性和网格偏向。目标是从第一性原理出发进行推导：对于足够平滑的函数，连续全变分 (TV) 是其梯度范数的积分，而有限差分近似加上黎曼和可用于构建离散近似。带有周期性环绕的前向差分强制要求离散梯度通过与前向邻居的差分来计算，其中邻居的索引对网格大小取模。全变分 (TV) 指的是梯度范数的积分，范数的选择决定了各向同性或各向异性：欧几里得范数产生各向同性的泛函，而分量绝对值之和产生各向异性的泛函。周期性边界条件 (PBC) 将边界边等同起来，以便在定义域边界处使用 $(i+1)\\bmod N_x$ 和 $(j+1)\\bmod N_y$ 作为前向邻居。\n\n选择所有正确定使用带有周期性边界条件的前向差分来定义离散各向同性和各向异性TV，并正确描述其旋转不变性和网格偏向属性的选项。\n\nA. 在所述网格上，带有前向差分和周期性边界条件的各向异性离散TV由下式给出\n$$\n\\mathrm{TV}_{\\mathrm{aniso}}(u) \\;=\\; \\sum_{i=0}^{N_x-1} \\sum_{j=0}^{N_y-1} h_x h_y \\left( \\left| \\frac{u_{(i+1)\\bmod N_x,\\, j} - u_{i,j}}{h_x} \\right| \\;+\\; \\left| \\frac{u_{i,\\, (j+1)\\bmod N_y} - u_{i,j}}{h_y} \\right| \\right).\n$$\n\nB. 在所述网格上，带有前向差分和周期性边界条件的各向同性离散TV由下式给出\n$$\n\\mathrm{TV}_{\\mathrm{iso}}(u) \\;=\\; \\sum_{i=0}^{N_x-1} \\sum_{j=0}^{N_y-1} h_x h_y \\,\\sqrt{ \\left( \\frac{u_{(i+1)\\bmod N_x,\\, j} - u_{i,j}}{h_x} \\right)^2 \\;+\\; \\left( \\frac{u_{i,\\, (j+1)\\bmod N_y} - u_{i,j}}{h_y} \\right)^2 }.\n$$\n\nC. 由前向差分构建的各向同性离散TV对于任何有限的 $N_x$ 和 $N_y$ 都是精确旋转不变的，这意味着将底层函数旋转任意角度都不会改变离散TV的值。\n\nD. 由前向差分构建的各向异性离散TV不是旋转不变的，并且与各向同性离散化相比，它对与坐标轴对齐的边缘表现出更强的网格偏向。\n\nE. 施加周期性边界条件可以消除网格偏向；在周期性边界条件下，各向异性和各向同性离散TV都变得旋转不变。\n\nF. 当 $h_x,h_y \\to 0$ 且 $N_x h_x$ 和 $N_y h_y$ 保持固定时（即细化网格），各向同性离散TV收敛于旋转不变的连续TV泛函（基于梯度的欧几里得范数），而各向异性离散TV收敛于一个非旋转不变的连续各向异性泛函（基于梯度分量的绝对值之和）。", "solution": "用户希望我验证问题陈述，如果有效，则推导出正确答案并评估所有选项。\n\n### 问题验证\n\n**步骤1：提取给定条件**\n- 一个在矩形网格上定义的二维离散场 $u$。\n- 网格节点：水平方向 $N_x$ 个，垂直方向 $N_y$ 个。\n- 网格间距：均匀，分别为 $h_x$ 和 $h_y$。\n- 指数：$(i,j)$ 的范围是 $\\{0,1,\\dots,N_x-1\\} \\times \\{0,1,\\dots,N_y-1\\}$。\n- 构建离散全变分 (TV) 泛函的方法：带有周期性边界条件的前向差分。\n- 连续TV定义：梯度范数的积分。\n- 离散TV构建：有限差分近似加上黎曼和。\n- 带有周期性环绕的前向差分：前向邻居的索引对网格大小取模，例如 $(i+1)\\bmod N_x$ 和 $(j+1)\\bmod N_y$。\n- 各向同性TV：基于梯度的欧几里得范数。\n- 各向异性TV：基于梯度分量的绝对值之和。\n\n**步骤2：使用提取的给定条件进行验证**\n1.  **科学上成立**：该问题牢固地植根于数值分析、图像处理和反问题的标准概念中。全变分正则化、有限差分、周期性边界条件以及各向同性与各向异性形式之间的区别都是成熟的数学和计算工具。\n2.  **适定性**：问题陈述清晰。它要求根据给定的原理给出离散TV泛函的正确定义，并分析其性质。有足够的信息来执行此任务。\n3.  **客观性**：术语在该领域内是精确且标准的。定义和描述是客观的，没有歧义或主观论断。\n4.  **不完整或矛盾的设置**：问题陈述是自洽且一致的。它提供了所有必要的组成部分：连续原理、离散化方法（前向差分）、边界条件（周期性）和网格结构。\n5.  **不现实或不可行**：该设置描述了一个标准的计算场景。它完全是现实和可行的。\n6.  **不适定或结构不良**：问题结构良好，可以导出一组唯一的正确选项。诸如“各向同性”、“各向异性”、“网格偏向”和“旋转不变性”等术语在此上下文中具有明确、公认的含义。\n7.  **伪深刻、琐碎或同义反复**：该问题需要对连续和离散微积分之间的联系、离散化选择的几何含义以及收敛性质有实质性的理解。它不是琐碎的。\n\n**步骤3：结论与行动**\n问题陈述有效。我现在将进行求解。\n\n### 推导与分析\n\n一个足够平滑的函数 $u(x, y)$ 在定义域 $\\Omega$ 上的连续全变分 (TV) 由下式给出\n$$\n\\mathrm{TV}(u) = \\int_{\\Omega} \\| \\nabla u(x,y) \\| \\, dx \\, dy\n$$\n其中 $\\nabla u = (\\frac{\\partial u}{\\partial x}, \\frac{\\partial u}{\\partial y})$ 是 $u$ 的梯度。范数 $\\|\\cdot\\|$ 的选择决定了泛函的性质。\n\n-   **连续各向同性TV**：范数是欧几里得 ($L_2$) 范数：\n    $$\n    \\mathrm{TV}_{\\mathrm{iso}}(u) = \\int_{\\Omega} \\sqrt{ \\left(\\frac{\\partial u}{\\partial x}\\right)^2 + \\left(\\frac{\\partial u}{\\partial y}\\right)^2 } \\, dx \\, dy\n    $$\n    这个泛函是旋转不变的，因为向量的欧几里得范数在旋转下保持不变。\n\n-   **连续各向异性TV**：范数是 $L_1$ 范数：\n    $$\n    \\mathrm{TV}_{\\mathrm{aniso}}(u) = \\int_{\\Omega} \\left( \\left|\\frac{\\partial u}{\\partial x}\\right| + \\left|\\frac{\\partial u}{\\partial y}\\right| \\right) \\, dx \\, dy\n    $$\n    这个泛函不是旋转不变的。例如，梯度向量 $(c, 0)$ 的范数是 $|c|$，而它旋转 $45^\\circ$ 后的向量 $(c/\\sqrt{2}, c/\\sqrt{2})$ 的范数是 $2|c|/\\sqrt{2} = \\sqrt{2}|c|$。\n\n为了离散化这些泛函，我们用网格单元上的黎曼和代替积分，用有限差分代替偏导数。面积元 $dx \\, dy$ 由网格单元的面积 $h_x h_y$ 近似。问题指定了带有周期性边界条件的前向差分。\n\n在网格点 $(i,j)$ 处的离散偏导数为：\n$$\n(\\nabla u)_{i,j} \\approx \\left( \\frac{u_{(i+1)\\bmod N_x, j} - u_{i,j}}{h_x}, \\frac{u_{i, (j+1)\\bmod N_y} - u_{i,j}}{h_y} \\right)\n$$\n周期性边界条件通过对索引使用取模运算符来处理。\n\n将这些代入黎曼和结构，得到离散TV泛函。\n\n-   **离散各向异性TV**：\n    $$\n    \\mathrm{TV}_{\\mathrm{aniso}}(u) = \\sum_{i=0}^{N_x-1} \\sum_{j=0}^{N_y-1} h_x h_y \\left( \\left| \\frac{u_{(i+1)\\bmod N_x, j} - u_{i,j}}{h_x} \\right| + \\left| \\frac{u_{i, (j+1)\\bmod N_y} - u_{i,j}}{h_y} \\right| \\right)\n    $$\n\n-   **离散各向同性TV**：\n    $$\n    \\mathrm{TV}_{\\mathrm{iso}}(u) = \\sum_{i=0}^{N_x-1} \\sum_{j=0}^{N_y-1} h_x h_y \\sqrt{ \\left( \\frac{u_{(i+1)\\bmod N_x, j} - u_{i,j}}{h_x} \\right)^2 + \\left( \\frac{u_{i, (j+1)\\bmod N_y} - u_{i,j}}{h_y} \\right)^2 }\n    $$\n\n现在我们评估给定的选项。\n\n**A. 在所述网格上，带有前向差分和周期性边界条件的各向异性离散TV由下式给出...**\n给出的公式是：\n$$\n\\mathrm{TV}_{\\mathrm{aniso}}(u) \\;=\\; \\sum_{i=0}^{N_x-1} \\sum_{j=0}^{N_y-1} h_x h_y \\left( \\left| \\frac{u_{(i+1)\\bmod N_x,\\, j} - u_{i,j}}{h_x} \\right| \\;+\\; \\left| \\frac{u_{i,\\, (j+1)\\bmod N_y} - u_{i,j}}{h_y} \\right| \\right).\n$$\n此表达式与我们上面使用前向差分梯度的 $L_1$ 范数和黎曼和推导出的离散各向异性TV完全匹配。\n**结论：正确。**\n\n**B. 在所述网格上，带有前向差分和周期性边界条件的各向同性离散TV由下式给出...**\n给出的公式是：\n$$\n\\mathrm{TV}_{\\mathrm{iso}}(u) \\;=\\; \\sum_{i=0}^{N_x-1} \\sum_{j=0}^{N_y-1} h_x h_y \\,\\sqrt{ \\left( \\frac{u_{(i+1)\\bmod N_x,\\, j} - u_{i,j}}{h_x} \\right)^2 \\;+\\; \\left( \\frac{u_{i,\\, (j+1)\\bmod N_y} - u_{i,j}}{h_y} \\right)^2 }.\n$$\n此表达式与我们上面使用前向差分梯度的 $L_2$ 范数和黎曼和推导出的离散各向同性TV完全匹配。\n**结论：正确。**\n\n**C. 由前向差分构建的各向同性离散TV对于任何有限的 $N_x$ 和 $N_y$ 都是精确旋转不变的，这意味着将底层函数旋转任意角度都不会改变离散TV的值。**\n这个陈述是错误的。离散化过程本身，通过在固定的网格轴（$x$ 和 $y$）上定义导数，破坏了连续泛函的完美旋转不变性。考虑一个包含一条清晰直边的连续图像。如果边缘与坐标轴对齐（例如，垂直），其离散表示将仅在 $x$ 方向上沿着单个像素列具有非零梯度。如果将同一条边旋转，例如 $45^\\circ$，其离散表示将变成一个“阶梯状”，在 $x$ 和 $y$ 方向上都有非零梯度分布在阶梯上。这些离散梯度范数的总和通常不会与轴对齐情况下的相同。这种对方向的依赖性被称为网格偏向或各向异性。因此，对于有限网格，离散泛函不是精确旋转不变的。\n**结论：不正确。**\n\n**D. 由前向差分构建的各向异性离散TV不是旋转不变的，并且与各向同性离散化相比，它对与坐标轴对齐的边缘表现出更强的网格偏向。**\n这个陈述包含两个部分。\n1.  *不是旋转不变的*：这是正确的。连续的各向异性泛函本身就不是旋转不变的，在网格上的离散化并不能恢复这种对称性。\n2.  *表现出更强的网格偏向...*：这也是正确的。赋给梯度的“成本”取决于其方向。对于各向异性 ($L_1$) 范数，成本 $|\\delta_x u| + |\\delta_y u|$ 在给定变化幅度的情况下，当变化纯粹是水平或垂直时最小化。对于对角线方向的变化，它被最大化。这意味着各向异性泛函相对于与轴对齐的边缘，会更重地惩罚对角线边缘。各向同性 ($L_2$) 范数 $\\sqrt{(\\delta_x u)^2 + (\\delta_y u)^2}$，虽然其离散形式不是完全各向同性的，但对不同方向的处理更为均匀。它对方向的响应比 $L_1$ 范数的菱形形状更“圆”。因此，各向异性离散化对轴对齐的结构表现出更强的偏好，即更强的网格偏向。\n**结论：正确。**\n\n**E. 施加周期性边界条件可以消除网格偏向；在周期性边界条件下，各向异性和各向同性离散TV都变得旋转不变。**\n这个陈述是错误的。周期性边界条件通过将网格有效地“包裹”成一个环面来处理域的拓扑结构。这决定了如何计算索引范围 $\\{0, \\dots, N-1\\}$ 边界处像素的差分。然而，网格偏向的来源是有限差分算子本身，它是相对于固定的笛卡尔网格方向定义的。这种局部几何属性不受全局边界条件的影响。因此，PBC并不能消除网格偏向或恢复旋转不变性。\n**结论：不正确。**\n\n**F. 当 $h_x,h_y \\to 0$ 且 $N_x h_x$ 和 $N_y h_y$ 保持固定时（即细化网格），各向同性离散TV收敛于旋转不变的连续TV泛函（基于梯度的欧几里得范数），而各向异性离散TV收敛于一个非旋转不变的连续各向异性泛函（基于梯度分量的绝对值之和）。**\n这个陈述准确地描述了离散泛函的收敛性质。A和B中的离散TV公式是它们各自连续积分的一致的一阶黎曼和近似。对于足够正则的函数 $u$，当网格间距趋于零（$h_x, h_y \\to 0$）时，这些和收敛到相应的积分。\n- 离散各向同性TV的极限是连续各向同性TV，它是一个旋转不变的泛函。\n- 离散各向异性TV的极限是连续各向异性TV，它不是一个旋转不变的泛函。\n该陈述正确地指出了这些极限连续泛函的性质。\n**结论：正确。**", "answer": "$$\\boxed{ABDF}$$", "id": "3427997"}, {"introduction": "解决像 Rudin-Osher-Fatemi (ROF) 模型这样的 TV 正则化问题时的主要挑战在于 TV 项的不可微性。一个克服此问题的有效策略是处理该问题的对偶形式。本练习将展示如何使用凸分析的基本原理推导 ROF 模型的对偶问题，以及如何构建一个原始-对偶间隙函数，这对于验证解的最优性至关重要 ([@problem_id:3428023])。", "problem": "考虑一个在具有 $n$ 个像素的矩形网格上用于去噪的 Rudin–Osher–Fatemi (ROF) 模型。令 $f \\in \\mathbb{R}^{n}$ 表示观测数据，$u \\in \\mathbb{R}^{n}$ 表示待估计的未知图像。令 $\\nabla : \\mathbb{R}^{n} \\to \\mathbb{R}^{n \\times d}$ 表示在 $d \\in \\{1,2\\}$ 空间维度上带有齐次 Neumann 边界条件的离散前向差分梯度算子，并令 $\\mathrm{div} : \\mathbb{R}^{n \\times d} \\to \\mathbb{R}^{n}$ 为其负伴随算子，因此对于所有 $u \\in \\mathbb{R}^{n}$ 和 $p \\in \\mathbb{R}^{n \\times d}$ 都有 $\\langle \\nabla u, p \\rangle = - \\langle u, \\mathrm{div}\\, p \\rangle$。各向同性全变分 (TV) 半范数定义为\n$$\n\\mathrm{TV}(u) = \\sum_{i=1}^{n} \\| (\\nabla u)_{i} \\|_{2},\n$$\n其中 $(\\nabla u)_{i} \\in \\mathbb{R}^{d}$ 是像素 $i$ 处的局部离散梯度，$\\| \\cdot \\|_{2}$ 表示 $\\mathbb{R}^{d}$ 中的欧几里得范数。ROF 问题为\n$$\n\\min_{u \\in \\mathbb{R}^{n}} \\left\\{ \\frac{1}{2} \\| u - f \\|_{2}^{2} + \\lambda \\, \\mathrm{TV}(u) \\right\\},\n$$\n其中正则化参数 $\\lambda > 0$。对偶可行集为\n$$\n\\mathcal{C} = \\left\\{ p \\in \\mathbb{R}^{n \\times d} \\,:\\, \\| p \\|_{\\infty} \\leq 1 \\right\\}, \\quad \\text{其中} \\quad \\| p \\|_{\\infty} := \\max_{i} \\| p_{i} \\|_{2}。\n$$\n仅从这些定义、凸函数及其支撑函数的基本性质以及线性算子的伴随关系出发，完成以下任务：\n\n1. 推导 ROF 问题的对偶形式\n$$\n\\min_{p \\in \\mathcal{C}} \\frac{1}{2} \\left\\| f + \\lambda \\, \\mathrm{div}\\, p \\right\\|_{2}^{2},\n$$\n确保与 $p$ 无关的常数得到正确处理，并明确指出其与通常的凹对偶最大化问题的等价性。\n\n2. 构建一个原始-对偶间隙函数 $\\mathcal{G}(u,p)$，该函数当且仅当 $p \\in \\mathcal{C}$ 时为有限值，对于所有 $u \\in \\mathbb{R}^{n}$ 和所有 $p \\in \\mathcal{C}$ 均非负，且当且仅当 $(u,p)$ 满足 ROF 模型的最优性条件时等于零。您的推导必须从 ROF 原始目标、第1部分中获得的对偶目标、凸函数的基本不等式（如 Fenchel–Young 不等式）以及伴随恒等式出发，不得引用任何现成的原始-对偶间隙公式。\n\n您的最终答案必须是原始-对偶间隙 $\\mathcal{G}(u,p)$ 关于 $u$、$p$、$f$、$\\lambda$、$\\nabla$ 和 $\\mathrm{div}$ 的单一、明确的解析表达式。不需要进行数值评估，也不应进行四舍五入。如果最终表达式中出现对偶可行集的指示函数，请明确标出，并始终使用内积符号 $\\langle \\cdot, \\cdot \\rangle$。", "solution": "用户提供的问题经评估为**有效**。该问题在科学上基于凸优化和数学图像处理的原理，特别是 Rudin–Osher–Fatemi (ROF) 模型。该问题是适定的、客观的且自洽的，提供了执行所要求的推导所需的所有必要定义。它需要严格应用 Fenchel-Rockafellar 对偶性或等效的拉格朗日方法，这是该领域中一项不平凡但标准的任务。\n\n### 第1部分：对偶形式的推导\n\n原始 ROF 问题由下式给出\n$$\n\\min_{u \\in \\mathbb{R}^{n}} \\left\\{ \\frac{1}{2} \\| u - f \\|_{2}^{2} + \\lambda \\, \\mathrm{TV}(u) \\right\\}\n$$\n其中 $\\lambda > 0$。全变分 (TV) 半范数定义为 $\\mathrm{TV}(u) = \\sum_{i=1}^{n} \\| (\\nabla u)_{i} \\|_{2}$。这可以用对偶范数的定义来表示。令梯度场空间为 $V = \\mathbb{R}^{n \\times d}$。TV 项是该空间上的一个混合范数，通常写作 $\\lambda \\| \\nabla u \\|_{1,2}$。$\\| \\cdot \\|_{1,2}$ 范数的对偶范数是 $\\| \\cdot \\|_{\\infty,2}$ 范数，这正是问题陈述中给出的范数 $\\| p \\|_{\\infty} := \\max_{i} \\| p_{i} \\|_{2}$。范数的对偶形式表明\n$$\n\\| v \\|_{1,2} = \\sup_{\\|p\\|_{\\infty,2} \\leq 1} \\langle v, p \\rangle\n$$\n在我们的例子中，$v = \\nabla u$，而集合 $\\{ p \\in \\mathbb{R}^{n \\times d} \\,:\\, \\| p \\|_{\\infty} \\leq 1 \\}$ 正是给定的可行集 $\\mathcal{C}$。因此，我们可以写出\n$$\n\\mathrm{TV}(u) = \\sup_{p \\in \\mathcal{C}} \\langle \\nabla u, p \\rangle\n$$\n将此代入原始问题，我们得到一个极小极大公式：\n$$\n\\min_{u \\in \\mathbb{R}^{n}} \\left\\{ \\frac{1}{2} \\| u - f \\|_{2}^{2} + \\lambda \\sup_{p \\in \\mathcal{C}} \\langle \\nabla u, p \\rangle \\right\\} = \\min_{u \\in \\mathbb{R}^{n}} \\sup_{p \\in \\mathcal{C}} \\left\\{ \\frac{1}{2} \\| u - f \\|_{2}^{2} + \\lambda \\langle \\nabla u, p \\rangle \\right\\}\n$$\n令拉格朗日函数为 $L(u,p) = \\frac{1}{2} \\| u - f \\|_{2}^{2} + \\lambda \\langle \\nabla u, p \\rangle$。原始问题是 $P = \\min_u \\sup_{p \\in \\mathcal{C}} L(u,p)$。对偶问题是 $D = \\sup_{p \\in \\mathcal{C}} \\min_u L(u,p)$。该问题满足强对偶性，即 $P=D$。\n\n为了找到对偶目标函数，我们首先关于 $u$ 最小化 $L(u,p)$。使用给定的伴随关系 $\\langle \\nabla u, p \\rangle = - \\langle u, \\mathrm{div}\\, p \\rangle$，我们将拉格朗日函数重写为：\n$$\nL(u,p) = \\frac{1}{2} \\| u - f \\|_{2}^{2} - \\lambda \\langle u, \\mathrm{div}\\, p \\rangle\n$$\n这是一个关于 $u$ 的凸二次函数。通过将其关于 $u$ 的梯度设为零来找到最小值：\n$$\n\\nabla_u L(u,p) = (u - f) - \\lambda \\, \\mathrm{div}\\, p = 0\n$$\n这给出了唯一的极小化子 $u^*(p) = f + \\lambda \\, \\mathrm{div}\\, p$。\n\n将这个最优的 $u^*(p)$ 代回 $L(u,p)$，得到对偶目标函数，我们记为 $\\mathcal{D}_{\\text{concave}}(p)$:\n$$\n\\mathcal{D}_{\\text{concave}}(p) = \\min_u L(u,p) = \\frac{1}{2} \\| (f + \\lambda \\, \\mathrm{div}\\, p) - f \\|_{2}^{2} - \\lambda \\langle f + \\lambda \\, \\mathrm{div}\\, p, \\mathrm{div}\\, p \\rangle\n$$\n$$\n= \\frac{1}{2} \\| \\lambda \\, \\mathrm{div}\\, p \\|_{2}^{2} - \\lambda \\langle f, \\mathrm{div}\\, p \\rangle - \\lambda^2 \\langle \\mathrm{div}\\, p, \\mathrm{div}\\, p \\rangle\n$$\n$$\n= \\frac{1}{2} \\lambda^2 \\| \\mathrm{div}\\, p \\|_{2}^{2} - \\lambda \\langle f, \\mathrm{div}\\, p \\rangle - \\lambda^2 \\| \\mathrm{div}\\, p \\|_{2}^{2}\n$$\n$$\n= -\\frac{1}{2} \\lambda^2 \\| \\mathrm{div}\\, p \\|_{2}^{2} - \\lambda \\langle f, \\mathrm{div}\\, p \\rangle\n$$\n对偶问题是在可行集 $\\mathcal{C}$ 上最大化这个凹函数：\n$$\nD = \\sup_{p \\in \\mathcal{C}} \\left\\{ -\\frac{1}{2} \\lambda^2 \\| \\mathrm{div}\\, p \\|_{2}^{2} - \\lambda \\langle f, \\mathrm{div}\\, p \\rangle \\right\\}\n$$\n这就是“通常的凹对偶最大化”。为了将其转换为所要求的最小化问题，我们使用恒等式 $\\sup_x g(x) = -\\inf_x (-g(x))$。对偶问题等价于：\n$$\nD = -\\min_{p \\in \\mathcal{C}} \\left\\{ \\frac{1}{2} \\lambda^2 \\| \\mathrm{div}\\, p \\|_{2}^{2} + \\lambda \\langle f, \\mathrm{div}\\, p \\rangle \\right\\}\n$$\n我们对最小化内部的目标函数进行配方：\n$$\n\\frac{1}{2} \\lambda^2 \\| \\mathrm{div}\\, p \\|_{2}^{2} + \\lambda \\langle f, \\mathrm{div}\\, p \\rangle = \\frac{1}{2} \\left( \\|\\lambda \\, \\mathrm{div}\\, p\\|_2^2 + 2\\langle f, \\lambda \\, \\mathrm{div}\\, p \\rangle \\right)\n$$\n$$\n= \\frac{1}{2} \\left( \\|\\lambda \\, \\mathrm{div}\\, p\\|_2^2 + 2\\langle f, \\lambda \\, \\mathrm{div}\\, p \\rangle + \\|f\\|_2^2 - \\|f\\|_2^2 \\right)\n$$\n$$\n= \\frac{1}{2} \\left( \\| f + \\lambda \\, \\mathrm{div}\\, p \\|_{2}^{2} - \\|f\\|_{2}^{2} \\right)\n$$\n将其代回，对偶问题的值为：\n$$\nD = -\\min_{p \\in \\mathcal{C}} \\left\\{ \\frac{1}{2} \\| f + \\lambda \\, \\mathrm{div}\\, p \\|_{2}^{2} - \\frac{1}{2} \\|f\\|_{2}^{2} \\right\\} = \\max_{p \\in \\mathcal{C}} \\left\\{ -\\frac{1}{2} \\| f + \\lambda \\, \\mathrm{div}\\, p \\|_{2}^{2} + \\frac{1}{2} \\|f\\|_{2}^{2} \\right\\}\n$$\n花括号内表达式的极小化子与 $\\frac{1}{2} \\| f + \\lambda \\, \\mathrm{div}\\, p \\|_{2}^{2}$ 的极小化子相同，因为 $\\frac{1}{2}\\|f\\|_2^2$ 是一个关于 $p$ 的常数。因此，对偶问题可以表述为通过以下方式找到极小化子 $p^*$：\n$$\n\\min_{p \\in \\mathcal{C}} \\frac{1}{2} \\left\\| f + \\lambda \\, \\mathrm{div}\\, p \\right\\|_{2}^{2}\n$$\n这样就完成了对偶形式的推导。\n\n### 第2部分：原始-对偶间隙函数的构建\n\n对于原始变量 $u$ 和对偶变量 $p$，原始-对偶间隙 $\\mathcal{G}(u,p)$ 是原始目标在 $u$ 处的值与对偶目标在 $p$ 处的值之差。令 $\\mathcal{P}(u)$ 为原始目标，$\\mathcal{D}(p)$ 为定义在 $p \\in \\mathcal{C}$ 上的凹对偶目标。\n$$\n\\mathcal{P}(u) = \\frac{1}{2} \\| u - f \\|_{2}^{2} + \\lambda \\, \\mathrm{TV}(u)\n$$\n$$\n\\mathcal{D}(p) = -\\frac{1}{2} \\lambda^2 \\| \\mathrm{div}\\, p \\|_{2}^{2} - \\lambda \\langle f, \\mathrm{div}\\, p \\rangle\n$$\n根据弱对偶性，对于任意 $u \\in \\mathbb{R}^n$ 和 $p \\in \\mathcal{C}$，都有 $\\mathcal{P}(u) \\ge \\mathcal{D}(p)$。间隙为 $\\mathcal{G}(u,p) = \\mathcal{P}(u) - \\mathcal{D}(p)$，对于可行对，该值非负。为了构建一个当且仅当 $p \\in \\mathcal{C}$ 时为有限值的间隙函数，我们引入指示函数 $\\iota_{\\mathcal{C}}(p)$，当 $p \\in \\mathcal{C}$ 时其值为 $0$，否则为 $+\\infty$。扩展的对偶目标是 $\\mathcal{D}_{ext}(p) = \\mathcal{D}(p) - \\iota_{\\mathcal{C}}(p)$。那么间隙函数为：\n$$\n\\mathcal{G}(u,p) = \\mathcal{P}(u) - (\\mathcal{D}(p) - \\iota_{\\mathcal{C}}(p)) = \\mathcal{P}(u) - \\mathcal{D}(p) + \\iota_{\\mathcal{C}}(p)\n$$\n$$\n\\mathcal{G}(u,p) = \\left( \\frac{1}{2} \\| u - f \\|_{2}^{2} + \\lambda \\, \\mathrm{TV}(u) \\right) - \\left( -\\frac{1}{2}\\lambda^2 \\|\\mathrm{div}\\, p\\|_2^2 - \\lambda \\langle f, \\mathrm{div}\\, p \\rangle \\right) + \\iota_{\\mathcal{C}}(p)\n$$\n$$\n= \\frac{1}{2} \\| u - f \\|_{2}^{2} + \\lambda \\, \\mathrm{TV}(u) + \\frac{1}{2}\\lambda^2 \\|\\mathrm{div}\\, p\\|_2^2 + \\lambda \\langle f, \\mathrm{div}\\, p \\rangle + \\iota_{\\mathcal{C}}(p)\n$$\n我们现在重新整理这个表达式以揭示其结构。我们引入平稳性条件的残差，$r = u - f - \\lambda \\, \\mathrm{div}\\, p$。则 $u-f = r + \\lambda \\, \\mathrm{div}\\, p$。将此代入 $\\|u-f\\|_2^2$ 项：\n$$\n\\|u-f\\|_2^2 = \\|r + \\lambda \\, \\mathrm{div}\\, p\\|_2^2 = \\|r\\|_2^2 + 2\\lambda\\langle r, \\mathrm{div}\\, p \\rangle + \\lambda^2 \\|\\mathrm{div}\\, p\\|_2^2\n$$\n间隙函数变为：\n$$\n\\mathcal{G}(u,p) = \\frac{1}{2} \\left( \\|r\\|_2^2 + 2\\lambda\\langle r, \\mathrm{div}\\, p \\rangle + \\lambda^2 \\|\\mathrm{div}\\, p\\|_2^2 \\right) + \\lambda \\, \\mathrm{TV}(u) + \\frac{1}{2}\\lambda^2 \\|\\mathrm{div}\\, p\\|_2^2 + \\lambda \\langle f, \\mathrm{div}\\, p \\rangle + \\iota_{\\mathcal{C}}(p)\n$$\n将 $r = u-f-\\lambda\\,\\mathrm{div}\\,p$ 代回 $\\langle r, \\cdot \\rangle$ 项：\n$$\n= \\frac{1}{2} \\|r\\|_2^2 + \\lambda\\langle u-f-\\lambda\\,\\mathrm{div}\\,p, \\mathrm{div}\\, p \\rangle + \\lambda^2 \\|\\mathrm{div}\\, p\\|_2^2 + \\lambda \\, \\mathrm{TV}(u) + \\lambda \\langle f, \\mathrm{div}\\, p \\rangle + \\iota_{\\mathcal{C}}(p)\n$$\n$$\n= \\frac{1}{2} \\|r\\|_2^2 + \\lambda\\langle u, \\mathrm{div}\\, p \\rangle - \\lambda\\langle f, \\mathrm{div}\\, p \\rangle - \\lambda^2\\|\\mathrm{div}\\, p\\|_2^2 + \\lambda^2 \\|\\mathrm{div}\\, p\\|_2^2 + \\lambda \\, \\mathrm{TV}(u) + \\lambda \\langle f, \\mathrm{div}\\, p \\rangle + \\iota_{\\mathcal{C}}(p)\n$$\n几项相互抵消：\n$$\n\\mathcal{G}(u,p) = \\frac{1}{2} \\|r\\|_2^2 + \\lambda \\langle u, \\mathrm{div}\\, p \\rangle + \\lambda \\, \\mathrm{TV}(u) + \\iota_{\\mathcal{C}}(p)\n$$\n使用伴随恒等式 $\\langle u, \\mathrm{div}\\, p \\rangle = -\\langle \\nabla u, p \\rangle$ 并代入 $r=u-f-\\lambda\\,\\mathrm{div}\\,p$：\n$$\n\\mathcal{G}(u,p) = \\frac{1}{2} \\| u - f - \\lambda \\, \\mathrm{div}\\, p \\|_{2}^{2} + \\lambda \\left( \\mathrm{TV}(u) - \\langle \\nabla u, p \\rangle \\right) + \\iota_{\\mathcal{C}}(p)\n$$\n这就是原始-对偶间隙的最终表达式。\n我们来验证它的性质：\n1.  **有限性**：$\\mathcal{G}(u,p)$ 是有限的当且仅当 $\\iota_{\\mathcal{C}}(p) = 0$，即 $p \\in \\mathcal{C}$。\n2.  **非负性**：对于 $p \\in \\mathcal{C}$，第一项 $\\frac{1}{2} \\| u - f - \\lambda \\, \\mathrm{div}\\, p \\|_{2}^{2}$ 是非负的。对于第二项，我们知道 $\\mathrm{TV}(u) = \\sup_{q \\in \\mathcal{C}} \\langle \\nabla u, q \\rangle$。由于 $p \\in \\mathcal{C}$，我们必有 $\\langle \\nabla u, p \\rangle \\le \\mathrm{TV}(u)$。因此，$\\mathrm{TV}(u) - \\langle \\nabla u, p \\rangle \\ge 0$。由于 $\\lambda > 0$，整个表达式对于 $p \\in \\mathcal{C}$ 是非负的。\n3.  **零条件**：$\\mathcal{G}(u,p) = 0$ 当且仅当所有非负项都为零。这要求 $p \\in \\mathcal{C}$ 并且\n    -   $u - f - \\lambda \\, \\mathrm{div}\\, p = 0$（平稳性条件）。\n    -   $\\mathrm{TV}(u) = \\langle \\nabla u, p \\rangle$（互补松弛条件）。\n    这些是 ROF 问题的 Karush-Kuhn-Tucker (KKT) 最优性条件。\n\n推导出的 $\\mathcal{G}(u,p)$ 表达式满足所有要求的性质。", "answer": "$$\n\\boxed{\\mathcal{G}(u,p) = \\frac{1}{2} \\| u - f - \\lambda \\, \\mathrm{div}\\, p \\|_{2}^{2} + \\lambda \\left( \\sum_{i=1}^{n} \\| (\\nabla u)_{i} \\|_{2} - \\langle \\nabla u, p \\rangle \\right) + \\iota_{\\mathcal{C}}(p)}\n$$", "id": "3428023"}, {"introduction": "我们先前推导出的对偶公式不仅仅是一个理论上的奇思妙想；它是开发高效数值算法的门户。本练习直接建立在该基础之上，推导出一个解决 ROF 模型的开创性算法：Chambolle 的投影梯度下降法。通过分析对偶目标函数，您将构建迭代更新步骤并确定其收敛条件，从而将理论转化为一个实用的求解器 ([@problem_id:3428015])。", "problem": "考虑用于图像去噪的 Rudin–Osher–Fatemi (ROF) 模型，该模型定义在有界域 $\\,\\Omega \\subset \\mathbb{R}^{2}\\,$ 上，并带有齐次诺伊曼边界条件 (NBC)。设观测图像为 $\\,f \\in L^{2}(\\Omega)\\,$，并考虑具有单位保真度权重的 ROF 原始问题：\n$$\n\\min_{u \\in BV(\\Omega)} \\left\\{ \\mathrm{TV}(u) + \\frac{1}{2} \\int_{\\Omega} (u - f)^{2} \\, dx \\right\\},\n$$\n其中 $\\mathrm{TV}(u)$ 表示 $\\,u$ 的全变分 (TV)，$\\,BV(\\Omega)\\,$ 是有界变分函数空间。使用以下基本依据：\n- 全变分的对偶表示：对于光滑向量场 $\\,p \\in C^{1}(\\Omega;\\mathbb{R}^{2})\\,$，在 $\\,\\partial \\Omega$ 上满足 $\\,p \\cdot n = 0\\,$ 且几乎处处满足 $\\,|p(x)| \\le 1\\,$，有\n$$\n\\mathrm{TV}(u) = \\sup_{\\substack{p \\in C^{1}(\\Omega;\\mathbb{R}^{2}) \\\\ p \\cdot n = 0,\\, |p|\\le 1}} \\int_{\\Omega} u \\,\\mathrm{div}\\, p \\, dx.\n$$\n- 在齐次诺伊曼边界条件下散度与梯度之间的伴随关系：对于合适的 $\\,v\\,$ 和 $\\,p\\,$，\n$$\n\\int_{\\Omega} v \\,\\mathrm{div}\\, p \\, dx \\;=\\; - \\int_{\\Omega} p \\cdot \\nabla v \\, dx.\n$$\n\n(a) 从上述给出的原始表述出发，通过经典凸对偶性推导 ROF 对偶问题。然后，推导对偶变量 $\\,p\\,$（解释为向量场）的梯度下降更新，以及到凸集 $\\,\\{p: \\|p\\|_{\\infty} \\le 1\\}\\,$ 上的正交投影，其中 $\\,\\|p\\|_{\\infty} := \\operatorname*{ess\\,sup}_{x \\in \\Omega} |p(x)|\\,$，且 $\\,|\\cdot|\\,$ 是 $\\,\\mathbb{R}^{2}$ 中的欧几里得范数。\n\n(b) 考虑一个在矩形 $\\,N \\times M\\,$ 网格上的标准离散设置，其中离散梯度算子 $\\,\\nabla\\,$ 使用前向差分，其负转置作为离散散度 $\\,\\mathrm{div}\\,$，并附带齐次诺伊曼边界条件。利用这些离散算子的算子范数界，确定能保证对偶问题上的投影梯度下降法收敛的最大允许常数步长 $\\,\\tau\\,$。以对偶目标函数梯度的 Lipschitz 常数来陈述收敛条件，然后将最大常数步长作为一个实数给出。\n\n你最终报告的答案必须是 (b) 部分中以精确形式表示的最大允许常数步长。不需要四舍五入。", "solution": "此问题经评估是有效的，因为它在科学上基于凸优化和数学图像处理的成熟理论，特别是 Rudin–Osher–Fatemi (ROF) 模型。该问题是适定的、客观的，并包含进行严格推导所需的所有必要信息。\n\n(a) 对偶问题、梯度更新和投影的推导。\n\nROF 原始问题由下式给出：\n$$\n\\min_{u \\in BV(\\Omega)} \\left\\{ \\mathrm{TV}(u) + \\frac{1}{2} \\int_{\\Omega} (u - f)^{2} \\, dx \\right\\}\n$$\n我们使用所提供的全变分 (TV) 泛函的对偶表示：\n$$\n\\mathrm{TV}(u) = \\sup_{p \\in K} \\int_{\\Omega} u \\,\\mathrm{div}\\, p \\, dx\n$$\n其中 $K$ 是向量场的凸集 $K = \\{ p \\in C^{1}(\\Omega;\\mathbb{R}^{2}) : |p(x)| \\le 1 \\text{ a.e. and } p \\cdot n =\n0 \\text{ on } \\partial\\Omega \\}$。将此代入原始问题，我们构造一个鞍点（最小-最大）问题：\n$$\n\\min_{u \\in BV(\\Omega)} \\sup_{p \\in K} \\left\\{ \\int_{\\Omega} u \\,\\mathrm{div}\\, p \\, dx + \\frac{1}{2} \\int_{\\Omega} (u - f)^{2} \\, dx \\right\\}\n$$\n设拉格朗日函数为 $L(u,p) = \\int_{\\Omega} u \\,\\mathrm{div}\\, p \\, dx + \\frac{1}{2} \\int_{\\Omega} (u - f)^{2} \\, dx$。\n通过交换最小化和最大化的顺序来获得对偶问题：\n$$\n\\sup_{p \\in K} \\min_{u \\in BV(\\Omega)} L(u,p)\n$$\n为了找到内部的最小值，我们求 $L(u,p)$ 关于 $u$ 的驻点。泛函 $L(u,p)$ 关于 $u$ 是凸的，因此其最小化子可以通过将其关于 $u$ 的泛函导数设为零来找到：\n$$\n\\frac{\\delta L}{\\delta u} = \\mathrm{div}\\, p + (u - f) = 0\n$$\n这给出了给定 $p$ 下的最优 $u$：\n$$\nu^*(p) = f - \\mathrm{div}\\, p\n$$\n将此代回拉格朗日函数，得到对偶目标函数 $J(p)$：\n$$\nJ(p) = L(u^*(p), p) = \\int_{\\Omega} (f - \\mathrm{div}\\, p) \\,\\mathrm{div}\\, p \\, dx + \\frac{1}{2} \\int_{\\Omega} ((f - \\mathrm{div}\\, p) - f)^{2} \\, dx\n$$\n$$\nJ(p) = \\int_{\\Omega} f \\,\\mathrm{div}\\, p \\, dx - \\int_{\\Omega} (\\mathrm{div}\\, p)^2 \\, dx + \\frac{1}{2} \\int_{\\Omega} (-\\mathrm{div}\\, p)^2 \\, dx\n$$\n$$\nJ(p) = \\int_{\\Omega} f \\,\\mathrm{div}\\, p \\, dx - \\frac{1}{2} \\int_{\\Omega} (\\mathrm{div}\\, p)^2 \\, dx\n$$\n对偶问题是在凸集 $K$ 上最大化这个凹泛函：\n$$\n\\max_{p \\in K} \\left\\{ \\int_{\\Omega} f \\,\\mathrm{div}\\, p \\, dx - \\frac{1}{2} \\|\\mathrm{div}\\, p\\|_{L^2}^2 \\right\\}\n$$\n对于梯度下降更新，我们考虑对偶目标函数负值的等价最小化问题。令 $H(p) = -J(p)$：\n$$\n\\min_{p \\in K} H(p) = \\min_{p \\in K} \\left\\{ \\frac{1}{2} \\|\\mathrm{div}\\, p\\|_{L^2}^2 - \\int_{\\Omega} f \\,\\mathrm{div}\\, p \\, dx \\right\\}\n$$\n$H(p)$ 是一个凸泛函。梯度下降更新需要 $H(p)$ 的梯度。我们计算 $H(p)$ 沿着向量场 $q$ 方向的 Gateaux 导数：\n$$\n\\delta H(p; q) = \\left. \\frac{d}{d\\epsilon} H(p+\\epsilon q) \\right|_{\\epsilon=0} = \\int_{\\Omega} (\\mathrm{div}\\, p - f) \\mathrm{div}\\, q \\, dx\n$$\n使用伴随关系 $\\int_{\\Omega} v \\,\\mathrm{div}\\, q \\, dx = -\\int_{\\Omega} \\nabla v \\cdot q \\, dx$，该关系成立是因为 $q$（作为 $p$ 的一个变分）也必须在 $\\partial\\Omega$ 上满足 $q \\cdot n = 0$：\n$$\n\\delta H(p; q) = -\\int_{\\Omega} \\nabla(\\mathrm{div}\\, p - f) \\cdot q \\, dx = \\int_{\\Omega} \\nabla(f - \\mathrm{div}\\, p) \\cdot q \\, dx\n$$\n这必须等于 $\\langle \\nabla_p H(p), q \\rangle_{L^2}$。因此，$H(p)$ 的梯度是：\n$$\n\\nabla_p H(p) = \\nabla(f - \\mathrm{div}\\, p)\n$$\n对偶变量 $p$ 的投影梯度下降更新（步长为 $\\tau > 0$）为：\n$$\np_{k+1} = \\Pi_{K} \\left( p_k - \\tau \\nabla_p H(p_k) \\right) = \\Pi_{K} \\left( p_k - \\tau \\nabla(f - \\mathrm{div}\\, p_k) \\right)\n$$\n其中 $\\Pi_{K}$ 是到凸集 $K$ 上的正交投影。约束 $|p(x)| \\le 1$ 是逐点的。因此，投影可以对每个 $x \\in \\Omega$ 逐点计算。对于一个向量 $q \\in \\mathbb{R}^2$，到单位球 $\\{v \\in \\mathbb{R}^2 : |v| \\le 1\\}$ 上的投影是：\n$$\n\\Pi(q) = \\begin{cases} q  \\text{if } |q| \\le 1 \\\\ \\frac{q}{|q|}  \\text{if } |q| > 1 \\end{cases}\n$$\n这可以紧凑地写为：\n$$\n\\Pi(q) = \\frac{q}{\\max(1, |q|)}\n$$\n因此，向量场 $p$ 上的投影算子是逐点应用的：$(\\Pi_K(p))(x) = \\frac{p(x)}{\\max(1, |p(x)|)}$。\n\n(b) 最大允许步长的确定。\n\n我们在凸集 $K$ 上对凸泛函 $H(p)$ 执行投影梯度下降。如果梯度 $\\nabla_p H(p)$ 是 Lipschitz 连续的，并且步长 $\\tau$ 被恰当地选择，则该方法的收敛性得到保证。\n投影梯度下降的收敛条件是 $0  \\tau  2/L$，其中 $L$ 是梯度 $\\nabla_p H(p)$ 的 Lipschitz 常数。\n\n首先，我们求 Lipschitz 常数 $L$。我们分析梯度在两点 $p_1$ 和 $p_2$ 处的差：\n$$\n\\nabla_p H(p_1) - \\nabla_p H(p_2) = \\nabla(f - \\mathrm{div}\\, p_1) - \\nabla(f - \\mathrm{div}\\, p_2) = -\\nabla(\\mathrm{div}(p_1 - p_2))\n$$\nLipschitz 常数 $L$ 是线性映射 $p \\mapsto -\\nabla(\\mathrm{div}\\, p)$ 的算子范数。\n$$\nL = \\|-\\nabla \\circ \\mathrm{div}\\| = \\|\\nabla \\circ \\mathrm{div}\\|\n$$\n使用伴随关系 $\\mathrm{div} = -\\nabla^*$，其中 $\\nabla^*$ 是梯度算子 $\\nabla$ 的伴随算子：\n$$\nL = \\|\\nabla \\circ (-\\nabla^*)\\| = \\|-\\nabla \\nabla^*\\| = \\|\\nabla \\nabla^*\\|\n$$\n根据算子理论中的一个标准结果，对于任何线性算子 $\\mathcal{A}$，都有 $\\|\\mathcal{A}\\mathcal{A}^*\\| = \\|\\mathcal{A}\\|^2$。因此，\n$$\nL = \\|\\nabla\\|^2\n$$\n该问题考虑的是一个离散设置，其中梯度算子 $\\nabla$ 使用前向差分。对于单位间距的二维网格，算子范数 $\\|\\nabla\\|$ 是有界的。算子 $\\|\\nabla\\|^2$ 对应于带有齐次诺伊曼边界条件的离散负拉普拉斯算子 $-\\Delta_N = \\nabla^*\\nabla$ 的最大特征值。\n对于前向差分，一维离散梯度算子的范数平方以 $4$ 为界。对于二维梯度 $\\nabla = (\\nabla_x, \\nabla_y)$，其范数平方是其分量范数平方之和（因为它们作用于正交方向）：\n$$\n\\|\\nabla\\|^2 = \\|\\nabla_x\\|^2 + \\|\\nabla_y\\|^2\n$$\n使用前向差分的离散梯度的标准算子范数界为 $\\|\\nabla\\|^2 \\le 8$。我们使用这个已确立的界，所以 $L=8$。\n\n步长 $\\tau$ 的收敛条件是：\n$$\n0  \\tau  \\frac{2}{L}\n$$\n代入 $L=8$，我们得到：\n$$\n0  \\tau  \\frac{2}{8} \\quad \\implies \\quad 0  \\tau  \\frac{1}{4}\n$$\n问题要求的是最大允许常数步长。这对应于 $\\tau$ 的稳定区间的上界。\n$$\n\\tau_{\\text{max}} = \\frac{2}{L} = \\frac{2}{8} = \\frac{1}{4}\n$$\n该步长标志着投影梯度下降法保证收敛区域的边界。", "answer": "$$\\boxed{\\frac{1}{4}}$$", "id": "3428015"}]}