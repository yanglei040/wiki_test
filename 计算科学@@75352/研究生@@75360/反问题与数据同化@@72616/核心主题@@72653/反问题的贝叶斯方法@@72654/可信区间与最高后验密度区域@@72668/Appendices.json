{"hands_on_practices": [{"introduction": "本练习旨在为您打下坚实的分析基础，要求您为一个伽马后验分布推导并比较两种类型的置信区间。通过完成等尾区间和最高后验密度（HPD）区间的推导[@problem_id:3373872]，您将亲身体会到为何HPD区间被视为给定置信水平下的最优选择，即最短区间。此练习将加深您对基本定义的理解，并揭示后验密度的形状（单峰与单调）如何决定区间的结构。", "problem": "考虑一个贝叶斯逆问题，其中一个正标量参数 $\\theta$ 控制着数据似然，并产生形为 $\\theta \\mid y \\sim \\mathrm{Ga}(a,b)$ 的共轭后验分布，其形状参数为 $a>0$，率参数为 $b>0$，因此后验密度在 $(0,\\infty)$ 上与 $\\theta^{a-1}\\exp(-b\\theta)$ 成正比。在数据同化情境中，例如，当在Gamma先验下汇总独立的指数等待时间数据或泊松过程计数时，就可能出现这种后验分布，但此处不需要具体的数据模型。令 $F(\\theta)$ 表示参数为 $(a,b)$ 的伽马分布的累积分布函数 (CDF)，令 $P(a,x)$ 表示正则化下不完全伽马函数 $P(a,x) \\equiv \\gamma(a,x)/\\Gamma(a)$，其中 $\\gamma(a,x)$ 是下不完全伽马函数，$\\Gamma(a)$ 是伽马函数。我们知道，对于 $\\theta \\sim \\mathrm{Ga}(a,b)$，有 $F(\\theta) = P(a,b\\theta)$。定义 $P^{-1}(a,q)$ 为映射 $x \\mapsto P(a,x)$ 在水平 $q \\in (0,1)$ 处的反函数，即 $P(a,P^{-1}(a,q)) = q$。\n\n从单峰和单调后验密度的等尾 $(1-\\alpha)$ 置信区间和最高后验密度 (HPD) $(1-\\alpha)$ 置信区间的定义出发，完成以下任务：\n\n1. 推导等尾 $(1-\\alpha)$ 置信区间的端点 $\\theta_{\\mathrm{L}}^{\\mathrm{ET}}$ 和 $\\theta_{\\mathrm{U}}^{\\mathrm{ET}}$，并用 $P^{-1}(a,\\cdot)$ 和 $b$ 显式地表示其长度 $L_{\\mathrm{ET}}(a,b,\\alpha)$。\n\n2. 推导 HPD $(1-\\alpha)$ 置信区间的端点 $\\theta_{\\mathrm{L}}^{\\mathrm{HPD}}$ 和 $\\theta_{\\mathrm{U}}^{\\mathrm{HPD}}$，并清楚地区分 $a \\leq 1$（后验密度单调递减，众数在 $0$）和 $a>1$（后验密度为单峰，内部众数在 $\\theta^{\\star} = (a-1)/b$）两种情况。对于 $a \\leq 1$ 的情况，用 $P^{-1}(a,\\cdot)$ 和 $b$ 显式地表示 HPD 区间长度 $L_{\\mathrm{HPD}}(a,b,\\alpha)$。对于 $a>1$ 的情况，证明 HPD 端点满足等密度条件 $\\theta_{\\mathrm{L}}^{a-1}\\exp(-b\\theta_{\\mathrm{L}}) = \\theta_{\\mathrm{U}}^{a-1}\\exp(-b\\theta_{\\mathrm{U}})$ 和概率含量条件 $F(\\theta_{\\mathrm{U}}) - F(\\theta_{\\mathrm{L}}) = 1 - \\alpha$，并用这些方程的唯一解来表示 $L_{\\mathrm{HPD}}(a,b,\\alpha)$。\n\n3. 通过构造比值 $R(a,b,\\alpha) \\equiv L_{\\mathrm{HPD}}(a,b,\\alpha) / L_{\\mathrm{ET}}(a,b,\\alpha)$ 来比较长度，并尽可能地简化该比值，以展示其对 $(a,\\alpha)$ 的依赖性以及率参数 $b$ 被消去的情况。\n\n你的最终答案必须是 $R(a,b,\\alpha)$ 的单个解析表达式，不需要进行数值计算。", "solution": "该问题要求推导和比较参数 $\\theta$ 的等尾 (ET) 置信区间和最高后验密度 (HPD) 置信区间，其中 $\\theta$ 的后验分布为伽马分布，即 $\\theta \\mid y \\sim \\mathrm{Ga}(a,b)$。后验概率密度函数 (PDF) 为 $p(\\theta \\mid y) = \\frac{b^a}{\\Gamma(a)}\\theta^{a-1}\\exp(-b\\theta)$ (对于 $\\theta > 0$)。对应的累积分布函数 (CDF) 是 $F(\\theta) = P(a,b\\theta)$，其中 $P(a,x)$ 是正则化下不完全伽马函数。\n\n首先，我将验证问题陈述。\n**第1步：提取已知条件**\n- 关注的参数：$\\theta$，一个正标量。\n- 后验分布：$\\theta \\mid y \\sim \\mathrm{Ga}(a,b)$，形状参数 $a>0$，率参数 $b>0$。\n- 后验PDF正比性：在 $(0,\\infty)$ 上，$p(\\theta \\mid y) \\propto \\theta^{a-1}\\exp(-b\\theta)$。\n- CDF表示法：$F(\\theta)$。\n- 正则化下不完全伽马函数：$P(a,x) \\equiv \\gamma(a,x)/\\Gamma(a)$。\n- CDF公式：$F(\\theta) = P(a,b\\theta)$。\n- 反函数表示法：$P^{-1}(a,q)$ 是 $x \\mapsto P(a,x)$ 的反函数。\n- 置信水平：$(1-\\alpha)$。\n- 任务：(1) 推导 $(1-\\alpha)$ ET 区间的端点和长度。(2) 推导 $a \\leq 1$ 和 $a>1$ 两种情况下 $(1-\\alpha)$ HPD 区间的端点和长度。(3) 计算长度之比 $R(a,b,\\alpha) = L_{\\mathrm{HPD}}/L_{\\mathrm{ET}}$。\n\n**第2步：使用提取的已知条件进行验证**\n该问题在科学上基于贝叶斯统计和概率论。伽马分布、置信区间（ET 和 HPD）以及正则化不完全伽马函数都是标准的、定义明确的概念。问题是适定的，提供了进行推导所需的所有必要定义。区分 $a \\le 1$（单调递减的后验 PDF）和 $a > 1$（单峰后验 PDF）两种情况是正确且至关重要的，这对于确定 HPD 区间至关重要，表明问题结构良好。它需要实质性的推导，并非易事。所有术语都是客观且定义精确的。该问题是有效的。\n\n**第3步：结论和行动**\n该问题是有效的。我将开始解题。\n\n**第1部分：等尾 (ET) 置信区间**\n等尾 $(1-\\alpha)$ 置信区间 $[\\theta_{\\mathrm{L}}^{\\mathrm{ET}}, \\theta_{\\mathrm{U}}^{\\mathrm{ET}}]$ 的定义是在每个尾部分布 $\\alpha/2$ 的后验概率。\n下界 $\\theta_{\\mathrm{L}}^{\\mathrm{ET}}$ 满足 $P(\\theta  \\theta_{\\mathrm{L}}^{\\mathrm{ET}}) = F(\\theta_{\\mathrm{L}}^{\\mathrm{ET}}) = \\alpha/2$。\n使用给定关系 $F(\\theta) = P(a,b\\theta)$，我们有：\n$$P(a, b\\theta_{\\mathrm{L}}^{\\mathrm{ET}}) = \\frac{\\alpha}{2}$$\n对两边应用反函数 $P^{-1}(a,\\cdot)$ 得到 $b\\theta_{\\mathrm{L}}^{\\mathrm{ET}} = P^{-1}(a, \\alpha/2)$。因此，下端点为：\n$$\\theta_{\\mathrm{L}}^{\\mathrm{ET}} = \\frac{1}{b} P^{-1}\\left(a, \\frac{\\alpha}{2}\\right)$$\n上界 $\\theta_{\\mathrm{U}}^{\\mathrm{ET}}$ 满足 $P(\\theta > \\theta_{\\mathrm{U}}^{\\mathrm{ET}}) = 1 - F(\\theta_{\\mathrm{U}}^{\\mathrm{ET}}) = \\alpha/2$，这意味着 $F(\\theta_{\\mathrm{U}}^{\\mathrm{ET}}) = 1 - \\alpha/2$。\n$$P(a, b\\theta_{\\mathrm{U}}^{\\mathrm{ET}}) = 1 - \\frac{\\alpha}{2}$$\n解出 $\\theta_{\\mathrm{U}}^{\\mathrm{ET}}$ 得到：\n$$\\theta_{\\mathrm{U}}^{\\mathrm{ET}} = \\frac{1}{b} P^{-1}\\left(a, 1-\\frac{\\alpha}{2}\\right)$$\n等尾区间的长度 $L_{\\mathrm{ET}}(a,b,\\alpha)$ 是端点之差：\n$$L_{\\mathrm{ET}}(a,b,\\alpha) = \\theta_{\\mathrm{U}}^{\\mathrm{ET}} - \\theta_{\\mathrm{L}}^{\\mathrm{ET}} = \\frac{1}{b} \\left[ P^{-1}\\left(a, 1-\\frac{\\alpha}{2}\\right) - P^{-1}\\left(a, \\frac{\\alpha}{2}\\right) \\right]$$\n\n**第2部分：最高后验密度 (HPD) 置信区间**\nHPD 区间是在给定置信水平下可能的最短区间。其构造取决于后验 PDF ($p(\\theta \\mid y) \\propto \\theta^{a-1}\\exp(-b\\theta)$) 的峰态。为了确定其形状，我们检查对数-PDF $g(\\theta) = (a-1)\\ln\\theta - b\\theta + \\text{const}$ 导数的符号。其导数为 $g'(\\theta) = (a-1)/\\theta - b$。\n\n情况 $a \\leq 1$：\n如果 $a \\leq 1$，则 $a-1 \\leq 0$。因为 $b0$ 且 $\\theta0$，所以对于所有 $\\theta \\in (0,\\infty)$ 都有 $g'(\\theta)  0$。因此，后验 PDF 是 $\\theta$ 的单调递减函数。对于这样的密度，捕获 $(1-\\alpha)$ 概率的最短区间必须从支撑集的左边界开始，即 $\\theta=0$。\nHPD 区间的形式为 $[0, \\theta_{\\mathrm{U}}^{\\mathrm{HPD}}]$。下端点是 $\\theta_{\\mathrm{L}}^{\\mathrm{HPD}} = 0$。\n上端点 $\\theta_{\\mathrm{U}}^{\\mathrm{HPD}}$ 由概率含量条件确定：\n$$P(0 \\leq \\theta \\leq \\theta_{\\mathrm{U}}^{\\mathrm{HPD}}) = F(\\theta_{\\mathrm{U}}^{\\mathrm{HPD}}) - F(0) = 1-\\alpha$$\n由于伽马分布的 $F(0)=0$，这可以简化为 $F(\\theta_{\\mathrm{U}}^{\\mathrm{HPD}}) = 1-\\alpha$。使用 CDF 公式：\n$$P(a, b\\theta_{\\mathrm{U}}^{\\mathrm{HPD}}) = 1-\\alpha$$\n解出 $\\theta_{\\mathrm{U}}^{\\mathrm{HPD}}$ 得到：\n$$\\theta_{\\mathrm{U}}^{\\mathrm{HPD}} = \\frac{1}{b} P^{-1}(a, 1-\\alpha)$$\n对于 $a \\leq 1$ 的情况，HPD 区间的长度为：\n$$L_{\\mathrm{HPD}}(a,b,\\alpha) = \\theta_{\\mathrm{U}}^{\\mathrm{HPD}} - \\theta_{\\mathrm{L}}^{\\mathrm{HPD}} = \\frac{1}{b} P^{-1}(a, 1-\\alpha)$$\n\n情况 $a  1$：\n如果 $a  1$，则 $a-1  0$。通过设 $g'(\\theta)=0$ 可找到分布的众数，解得 $\\theta^{\\star} = (a-1)/b  0$。后验 PDF 是单峰的，在 $\\theta=0$ 时从 $0$ 开始，在 $\\theta^{\\star}$ 处增加到最大值，然后随着 $\\theta \\to \\infty$ 递减至 $0$。\n对于单峰分布，$(1-\\alpha)$ HPD 区间 $[\\theta_{\\mathrm{L}}^{\\mathrm{HPD}}, \\theta_{\\mathrm{U}}^{\\mathrm{HPD}}]$ 具有其端点处后验密度相等的性质：\n$$p(\\theta_{\\mathrm{L}}^{\\mathrm{HPD}} \\mid y) = p(\\theta_{\\mathrm{U}}^{\\mathrm{HPD}} \\mid y)$$\n使用 PDF 的正比关系，这给出了所要求的第一个条件：\n$$(\\theta_{\\mathrm{L}}^{\\mathrm{HPD}})^{a-1}\\exp(-b\\theta_{\\mathrm{L}}^{\\mathrm{HPD}}) = (\\theta_{\\mathrm{U}}^{\\mathrm{HPD}})^{a-1}\\exp(-b\\theta_{\\mathrm{U}}^{\\mathrm{HPD}})$$\n第二个条件是该区间必须包含 $(1-\\alpha)$ 的后验概率质量：\n$$\\int_{\\theta_{\\mathrm{L}}^{\\mathrm{HPD}}}^{\\theta_{\\mathrm{U}}^{\\mathrm{HPD}}} p(\\theta \\mid y) d\\theta = 1-\\alpha$$\n用 CDF $F$ 表示，这是所要求的第二个条件：\n$$F(\\theta_{\\mathrm{U}}^{\\mathrm{HPD}}) - F(\\theta_{\\mathrm{L}}^{\\mathrm{HPD}}) = 1-\\alpha$$\n端点 $\\theta_{\\mathrm{L}}^{\\mathrm{HPD}}$ 和 $\\theta_{\\mathrm{U}}^{\\mathrm{HPD}}$ 是这个二元非线性方程组的唯一解。HPD 区间的长度则用这个唯一解表示：\n$$L_{\\mathrm{HPD}}(a,b,\\alpha) = \\theta_{\\mathrm{U}}^{\\mathrm{HPD}} - \\theta_{\\mathrm{L}}^{\\mathrm{HPD}}$$\n\n**第3部分：长度之比**\n比值为 $R(a,b,\\alpha) = L_{\\mathrm{HPD}}(a,b,\\alpha) / L_{\\mathrm{ET}}(a,b,\\alpha)$。为简化此式并显示其与 $b$ 无关，我们引入缩放的无量纲端点。令 $x = b\\theta$。$x$ 的分布是 $\\mathrm{Ga}(a,1)$，其 CDF 为 $P(a,x)$。\n\n在缩放变量下，ET 区间的长度是 $P^{-1}(a, 1-\\alpha/2) - P^{-1}(a, \\alpha/2)$。\n因此， $L_{\\mathrm{ET}}(a,b,\\alpha) = \\frac{1}{b} \\left[ P^{-1}\\left(a, 1-\\frac{\\alpha}{2}\\right) - P^{-1}\\left(a, \\frac{\\alpha}{2}\\right) \\right]$。\n\nHPD 区间的长度取决于 $a$。我们定义缩放的 HPD 端点 $x_{\\mathrm{L}}(a,\\alpha)$ 和 $x_{\\mathrm{U}}(a,\\alpha)$，使得 $\\theta_{\\mathrm{L}}^{\\mathrm{HPD}} = x_{\\mathrm{L}}/b$ 且 $\\theta_{\\mathrm{U}}^{\\mathrm{HPD}} = x_{\\mathrm{U}}/b$。\n- 对于 $a \\leq 1$:\n$x_{\\mathrm{L}}(a,\\alpha) = 0$\n$x_{\\mathrm{U}}(a,\\alpha) = P^{-1}(a, 1-\\alpha)$\n- 对于 $a  1$, $x_{\\mathrm{L}}(a,\\alpha)$ 和 $x_{\\mathrm{U}}(a,\\alpha)$ 是以下方程组的唯一解：\n1. $(x_{\\mathrm{L}})^{a-1}\\exp(-x_{\\mathrm{L}}) = (x_{\\mathrm{U}})^{a-1}\\exp(-x_{\\mathrm{U}})$\n2. $P(a, x_{\\mathrm{U}}) - P(a, x_{\\mathrm{L}}) = 1-\\alpha$\n\n在所有情况下，HPD 区间的长度可以写为 $L_{\\mathrm{HPD}}(a,b,\\alpha) = \\frac{1}{b} (x_{\\mathrm{U}}(a,\\alpha) - x_{\\mathrm{L}}(a,\\alpha))$。\n\n现在我们构造比值 $R(a,b,\\alpha)$:\n$$R(a,b,\\alpha) = \\frac{L_{\\mathrm{HPD}}(a,b,\\alpha)}{L_{\\mathrm{ET}}(a,b,\\alpha)} = \\frac{\\frac{1}{b}(x_{\\mathrm{U}}(a,\\alpha) - x_{\\mathrm{L}}(a,\\alpha))}{\\frac{1}{b}\\left[ P^{-1}\\left(a, 1-\\frac{\\alpha}{2}\\right) - P^{-1}\\left(a, \\frac{\\alpha}{2}\\right) \\right]}$$\n如预期的那样，率参数 $b$ 被消去了。得到的表达式仅取决于 $a$ 和 $\\alpha$:\n$$R(a,\\alpha) = \\frac{x_{\\mathrm{U}}(a,\\alpha) - x_{\\mathrm{L}}(a,\\alpha)}{P^{-1}\\left(a, 1-\\frac{\\alpha}{2}\\right) - P^{-1}\\left(a, \\frac{\\alpha}{2}\\right)}$$\n这就是所要求的单个解析表达式，其中函数 $x_{\\mathrm{L}}(a,\\alpha)$ 和 $x_{\\mathrm{U}}(a,\\alpha)$ 根据上面确定的 $a$ 的值分段定义。该表达式表示在缩放坐标中，HPD 区域的宽度与 ET 区域宽度的比值。", "answer": "$$\\boxed{\\frac{x_{\\mathrm{U}}(a,\\alpha) - x_{\\mathrm{L}}(a,\\alpha)}{P^{-1}\\left(a, 1-\\frac{\\alpha}{2}\\right) - P^{-1}\\left(a, \\frac{\\alpha}{2}\\right)}}$$", "id": "3373872"}, {"introduction": "在许多实际场景中（如数据同化），我们无法获得后验分布的解析形式，而是通过粒子滤波等方法得到一组带权重的粒子近似。这个编程练习[@problem_id:3373825]要求您连接理论与实践的鸿沟，实现一种算法，从这种离散表示中构建经验HPD区域。这项任务不仅需要您开发核心算法，还需要您实现关键的诊断工具，用以评估粒子退化程度和探测后验分布的多峰性。", "problem": "给定一个贝叶斯滤波上下文，其中时间步 $k$ 的后验分布 $p(x_k \\mid y_{1:k})$ 由一个离散加权粒子集 $\\{(w_i, x_k^{(i)})\\}_{i=1}^N$ 近似，该粒子集的权重为非负且总和为一。从最高后验密度 (HPD) 区域的基本定义（即形式为 $\\{x : p(x \\mid y_{1:k}) \\ge \\lambda\\}$ 的集合，其中阈值 $\\lambda$ 的选择使得该集合的后验概率质量等于一个指定的置信水平）出发，推导一种使用加权粒子构造 HPD 区域的经验方法。您的推导必须从 HPD 区域的定义和由粒子近似所引出的离散测度开始。您还必须推导一个一维最短区间可信集，该方法基于按状态值对粒子排序并聚合权重。最后，您必须量化权重退化，并分析其对经验 HPD 区域的稳定性和覆盖率的影响。\n\n您的程序必须实现以下基于定义的内容：\n\n1.  通过对离散近似进行阈值处理得到的经验 HPD 集：\n    -   使用离散近似 $p(x \\mid y_{1:k}) \\approx \\sum_{i=1}^N w_i \\, \\delta(x - x^{(i)})$，证明一个水平为 $\\alpha \\in (0,1)$ 的经验 HPD 区域可以通过选择一个累积权重至少为 $\\alpha$ 的最小基数粒子子集来构造。这通过将粒子按权重降序排序并取其权重和超过 $\\alpha$ 的最小前缀来实现。设此集合达到的概率质量为 $M_{\\mathrm{HPD}} \\ge \\alpha$，并将超出量定义为 $M_{\\mathrm{HPD}} - \\alpha$。\n\n2.  一维最短区间可信集：\n    -   当 $x_k$ 是标量且粒子按其状态值 $x^{(i)}$ 排序时，推导出一个具有最小宽度 $b-a$ 且承载至少为 $\\alpha$ 的概率质量的最短区间 $[a,b]$，可以通过扫描索引对并识别其累积权重至少为 $\\alpha$ 的最小宽度索引窗口来找到。这种滑动窗口构造在经验测度上是有效的，并且在单峰情况下与连续 HPD 区间一致。\n\n3.  权重的退化量化度量：\n    -   使用为归一化权重定义的有效样本量 (ESS) $\\mathrm{ESS} = 1 / \\sum_{i=1}^N w_i^2$ 作为退化指标，并报告归一化有效样本量 $\\mathrm{ESS}/N$。\n\n4.  用于多峰性的经验连续性诊断：\n    -   将第 1 项中的经验 HPD 集映射到按状态排序的顺序上，并计算该集合中所代表的连续索引段的数量。大于 1 的值表示非连续性，这在多峰后验分布中是典型的。\n\n对于每个测试用例，您的程序必须按此确切顺序生成一个包含以下六个条目的列表：\n-   经验 HPD 集达到的概率质量 $M_{\\mathrm{HPD}}$ (浮点数)。\n-   超出量 $M_{\\mathrm{HPD}} - \\alpha$ (浮点数)。\n-   归一化有效样本量 $\\mathrm{ESS}/N$ (浮点数)。\n-   经验 HPD 集中的粒子数量 (整数)。\n-   最短区间可信集的宽度 $b-a$ (浮点数；当单个粒子已超过 $\\alpha$ 时允许为零)。\n-   当粒子按其状态值排序时，经验 HPD 集所跨越的连续段数量 (整数)。\n\n所有浮点数在输出中必须四舍五入到恰好 $6$ 位小数。\n\n测试套件。您的程序必须为以下四个独立的案例计算结果，每个案例都以纯数学术语提出，不带物理单位：\n\n-   案例 A (良好解析的单峰后验)：$N = 801$ 个粒子，位于从 $-4$ 到 $4$ (含) 的均匀网格 $x^{(i)}$ 上，步长为 $0.01$。权重与标准正态密度成正比，$w_i \\propto \\exp(-\\tfrac{1}{2} (x^{(i)})^2)$，并归一化以使总和为 $1$。使用 $\\alpha = 0.9$。\n-   案例 B (严重退化)：$N = 100$ 个粒子，在从 $0$ 到 $1$ (含) 的区间上均匀分布 $x^{(i)}$。设 $w_1 = 0.91$，对于 $i \\in \\{2,\\dots,N\\}$，设 $w_i = 0.09 / (N-1)$。使用 $\\alpha = 0.9$。\n-   案例 C (具有偏斜质量的单调后验)：$N = 500$ 个粒子，位于从 $0$ 到 $5$ (含) 的均匀网格 $x^{(i)}$ 上。权重与 $\\exp(-x^{(i)})$ 成正比，并归一化以使总和为 $1$。使用 $\\alpha = 0.8$。\n-   案例 D (双峰后验)：$N = 1201$ 个粒子，位于从 $-6$ 到 $6$ (含) 的均匀网格 $x^{(i)}$ 上。权重与平衡高斯混合 $0.5 \\exp(-\\tfrac{1}{2}(x^{(i)}+2)^2) + 0.5 \\exp(-\\tfrac{1}{2}(x^{(i)}-2)^2)$ 成正比，并归一化以使总和为 $1$。使用 $\\alpha = 0.5$。\n\n最终输出格式。您的程序应生成单行输出，其中包含四个案例的结果，形式为方括号括起来的逗号分隔列表，顺序为 A、B、C、D。每个内部列表必须包含上述六个数字，其中浮点数四舍五入到恰好 $6$ 位小数。例如：\n\"[[M_A,overshoot_A,essnorm_A,k_A,width_A,segments_A],[M_B,overshoot_B,essnorm_B,k_B,width_B,segments_B],[M_C,overshoot_C,essnorm_C,k_C,width_C,segments_C],[M_D,overshoot_D,essnorm_D,k_D,width_D,segments_D]]\"。", "solution": "该问题要求推导并实现几种诊断工具，用于分析由离散加权粒子集 $\\{(w_i, x_k^{(i)})\\}_{i=1}^N$ 近似的后验分布。该离散测度由 $\\hat{p}(x) = \\sum_{i=1}^N w_i \\, \\delta(x - x^{(i)})$ 给出，其中权重非负，$w_i \\ge 0$，且归一化为一，$\\sum_{i=1}^N w_i = 1$。置信水平表示为 $\\alpha \\in (0,1)$。\n\n### 1. 经验最高后验密度 (HPD) 集\n\n对于连续概率密度函数 $p(x)$，最高后验密度 (HPD) 区域定义为集合 $R_\\alpha = \\{x : p(x) \\ge \\lambda\\}$，其中阈值 $\\lambda$ 的选择使得该区域中的概率质量恰好为 $\\alpha$，即 $\\int_{R_\\alpha} p(x) dx = \\alpha$。这意味着 HPD 区域包含后验密度最高的所有点。\n\n对于我们的离散测度 $\\hat{p}(x)$，由于狄拉克δ函数 $\\delta(\\cdot)$ 的存在，“密度”仅在粒子位置 $x^{(i)}$ 处非零，且在该处为无穷大。直接应用密度阈值 $\\lambda$ 是不明确的。相反，我们可以调整 HPD 区域的核心原则：从分布的“最密集”部分组建一个具有给定概率质量 $\\alpha$ 的集合。在粒子表示中，概率质量集中在粒子位置上，每个位置的概率质量大小由该粒子的权重 $w_i$ 给出。因此，离散分布的“最密集”部分对应于具有最大权重的粒子。\n\n这导致了以下构造经验 HPD 集的方法：\n1.  根据权重将粒子按降序排序。设排序后的权重为 $w_{(1)} \\ge w_{(2)} \\ge \\dots \\ge w_{(N)}$，对应的粒子为 $x^{((1))}, x^{((2))}, \\dots, x^{((N))}$。\n2.  找到最小的整数 $k_{\\mathrm{HPD}}$，使得最大权重的累积和至少为 $\\alpha$。即，找到满足以下条件的最小 $k$：\n    $$ \\sum_{j=1}^{k} w_{(j)} \\ge \\alpha $$\n3.  经验 HPD 集是具有最高权重的 $k_{\\mathrm{HPD}}$ 个粒子的集合：$\\{x^{((j))}\\}_{j=1}^{k_{\\mathrm{HPD}}}$。这种构造自然地产生具有达到所需概率质量的最小粒子数（最小基数）的集合。\n4.  该集合的实际概率质量，记为 $M_{\\mathrm{HPD}}$，是所选粒子权重的总和：\n    $$ M_{\\mathrm{HPD}} = \\sum_{j=1}^{k_{\\mathrm{HPD}}} w_{(j)} $$\n    由于权重的离散性，$M_{\\mathrm{HPD}}$ 通常会大于或等于 $\\alpha$。\n5.  超出量定义为超出的概率质量：$M_{\\mathrm{HPD}} - \\alpha$。\n\n### 2. 一维最短区间可信集\n\n对于一维标量状态 $x_k$，可信区间是一个区间 $[a, b]$，使得状态位于该区间内的后验概率至少为 $\\alpha$。一个常见且理想的选择是满足此条件的最短区间，对于单峰分布，这通常是 HPD 区间。\n\n给定离散粒子近似，我们寻求一个具有最小宽度 $b-a$ 的区间 $[a, b]$，使得 $\\mathbb{P}(x_k \\in [a, b]) \\ge \\alpha$。对于我们的离散测度，这个概率是 $\\sum_{i: x^{(i)} \\in [a, b]} w_i$。为了使区间最小，其端点必须与粒子位置重合。因此，任务是找到一对粒子 $(x^{(i)}, x^{(j)})$，以最小化宽度 $x^{(j)} - x^{(i)}$，同时其包含的粒子的总权重和至少为 $\\alpha$。\n\n该算法的推导如下：\n1.  首先，按状态值对粒子进行排序：$x_{(1)} \\le x_{(2)} \\le \\dots \\le x_{(N)}$。设相应的权重为 $\\{w'_{(i)}\\}_{i=1}^N$。\n2.  问题是找到索引 $i$ 和 $j$ ($1 \\le i \\le j \\le N$)，它们在约束 $\\sum_{k=i}^{j} w'_{(k)} \\ge \\alpha$ 下最小化宽度 $x_{(j)} - x_{(i)}$。\n3.  如果任何单个粒子的权重 $w_i \\ge \\alpha$，则会出现特殊情况。在这种情况下，最短区间塌陷为单点，宽度为 $0$。\n4.  如果没有单个粒子满足条件，我们可以采用高效的双指针（或滑动窗口）算法。初始化一个起始指针 $i=1$ 和一个结束指针 $j=1$。维护一个从 $i$ 到 $j$ 的权重运行总和。\n    -   通过递增 $j$ 来扩展窗口，直到累积权重 $\\sum_{k=i}^{j} w'_{(k)} \\ge \\alpha$。\n    -   一旦满足条件，计算宽度 $x_{(j)} - x_{(i)}$，如果它小于迄今为止找到的最小宽度，则记录它。\n    -   然后，通过递增 $i$ 并从运行总和中减去 $w'_{(i)}$ 来从左侧收缩窗口。重复此过程，直到所有可能的起始点都已考虑。\n该过程保证能找到全局最小宽度的区间。\n\n### 3. 退化的量化度量：有效样本量 (ESS)\n\n当少数粒子具有非常大的权重，而其余粒子的权重可以忽略不计时，就会发生粒子退化。这意味着粒子集的多样性很低，后验分布的近似效果很差。有效样本量 (ESS) 是一个广泛用于量化此现象的指标。对于归一化的权重 $\\sum_{i=1}^N w_i = 1$，ESS 定义为：\n$$ \\mathrm{ESS} = \\frac{1}{\\sum_{i=1}^N w_i^2} $$\nESS 的值范围从 $1$（完全退化，一个粒子权重为 $1$）到 $N$（无退化，所有权重相等，$w_i = 1/N$）。为了提供一个与尺度无关的度量，ESS 通常通过总粒子数 $N$ 进行归一化。归一化的 ESS，即 $\\mathrm{ESS}/N$，范围从 $1/N$ 到 $1$，使得无论总粒子数如何，都易于解释退化程度。一个低值（例如，小于 $0.5$）通常是粒子滤波器中需要重采样的信号。\n\n### 4. 用于多峰性的经验连续性诊断\n\nHPD 集识别了高概率质量的区域。在一维单峰后验分布中，该区域将是一个单一的连续区间。在多峰后验分布中，HPD 集可能由几个不相交的区间组成。我们可以利用此属性来诊断我们的粒子近似中的多峰性。\n\n诊断算法如下：\n1.  识别属于第 1 节中推导的经验 HPD 集的粒子集合。设 $I_{\\mathrm{HPD}}$ 为这些粒子的原始索引集。\n2.  按状态值对所有粒子进行排序：$x_{(1)} \\le x_{(2)} \\le \\dots \\le x_{(N)}$。在此排序列表中跟踪每个粒子的原始索引。\n3.  创建一个长度为 $N$ 的布尔序列。如果按状态排序列表中的第 $j$ 个位置的粒子（即 $x_{(j)}$）是 HPD 集的成员，则该序列的第 $j$ 个元素为真，否则为假。\n4.  计算此布尔序列中 `true` 值的连续块的数量。这可以通过遍历序列并计算 `true` 值跟在 `false` 值之后的次数来完成。例如，序列 `[F, T, T, F, T, T, T, F]` 包含两个这样的块或段。\n5.  计数为 $1$ 表明高密度区域是连续的，这对于单峰分布是典型的。计数大于 $1$ 表示 HPD 集在状态空间中是不相交的，为多峰后验分布提供了强有力的证据。", "answer": "```python\nimport numpy as np\n\ndef calculate_diagnostics(x_particles, weights, alpha):\n    \"\"\"\n    Calculates various diagnostics for a particle approximation of a posterior.\n\n    Args:\n        x_particles (np.ndarray): 1D array of particle states.\n        weights (np.ndarray): 1D array of corresponding particle weights.\n        alpha (float): The credibility level.\n\n    Returns:\n        list: A list containing six diagnostic values in a specific order.\n    \"\"\"\n    N = len(weights)\n\n    # 1. Empirical HPD Set\n    w_sorted_indices = np.argsort(weights)[::-1]\n    w_sorted_cumsum = np.cumsum(weights[w_sorted_indices])\n    \n    # Find the smallest number of particles whose cumulative weight is = alpha\n    hpd_k_idx = np.searchsorted(w_sorted_cumsum, alpha)\n    num_particles_hpd = hpd_k_idx + 1\n    \n    achieved_mass_hpd = w_sorted_cumsum[hpd_k_idx]\n    overshoot_hpd = achieved_mass_hpd - alpha\n    \n    hpd_original_indices = w_sorted_indices[:num_particles_hpd]\n\n    # 2. Normalized Effective Sample Size (ESS)\n    sum_w_sq = np.sum(weights**2)\n    ess_normalized = (1.0 / sum_w_sq) / N if sum_w_sq  0 else 0.0\n\n    # 3. One-dimensional Shortest-Interval Credible Set\n    x_sorted_indices = np.argsort(x_particles)\n    x_sorted = x_particles[x_sorted_indices]\n    w_sorted_by_x = weights[x_sorted_indices]\n    \n    # Check for a single particle with weight = alpha\n    if np.any(w_sorted_by_x = alpha):\n        shortest_interval_width = 0.0\n    else:\n        min_width = np.inf\n        # Efficient two-pointer sliding window algorithm\n        current_weight = 0.0\n        i = 0\n        for j in range(N):\n            current_weight += w_sorted_by_x[j]\n            while current_weight = alpha:\n                width = x_sorted[j] - x_sorted[i]\n                if width  min_width:\n                    min_width = width\n                current_weight -= w_sorted_by_x[i]\n                i += 1\n        shortest_interval_width = min_width\n\n    # 4. Empirical Contiguity Diagnostic\n    is_in_hpd = np.zeros(N, dtype=bool)\n    is_in_hpd[hpd_original_indices] = True\n    \n    # Reorder the HPD membership mask according to the state-sorted particles\n    in_hpd_sorted_by_x = is_in_hpd[x_sorted_indices]\n    \n    # Pad with False to handle edges correctly when using diff\n    padded_mask = np.concatenate(([False], in_hpd_sorted_by_x, [False]))\n    \n    # A segment starts where the diff is 1 (False - True transition)\n    diff_mask = np.diff(padded_mask.astype(int))\n    num_segments = np.sum(diff_mask == 1)\n\n    return [\n        round(achieved_mass_hpd, 6),\n        round(overshoot_hpd, 6),\n        round(ess_normalized, 6),\n        num_particles_hpd,\n        round(shortest_interval_width, 6),\n        num_segments\n    ]\n\ndef solve():\n    \"\"\"\n    Main function to define test cases, run calculations, and print results.\n    \"\"\"\n    test_cases = [\n        # Case A: Well-resolved unimodal posterior\n        {\n            'name': 'A', 'N': 801, 'alpha': 0.9,\n            'x_gen': lambda n: np.linspace(-4, 4, n),\n            'w_gen': lambda x: np.exp(-0.5 * x**2)\n        },\n        # Case B: Severe degeneracy\n        {\n            'name': 'B', 'N': 100, 'alpha': 0.9,\n            'x_gen': lambda n: np.linspace(0, 1, n),\n            'w_gen': lambda x: np.array([0.91] + [0.09 / (len(x) - 1)] * (len(x) - 1))\n        },\n        # Case C: Monotone posterior with skewed mass\n        {\n            'name': 'C', 'N': 500, 'alpha': 0.8,\n            'x_gen': lambda n: np.linspace(0, 5, n),\n            'w_gen': lambda x: np.exp(-x)\n        },\n        # Case D: Bimodal posterior\n        {\n            'name': 'D', 'N': 1201, 'alpha': 0.5,\n            'x_gen': lambda n: np.linspace(-6, 6, n),\n            'w_gen': lambda x: 0.5 * np.exp(-0.5 * (x + 2)**2) + 0.5 * np.exp(-0.5 * (x - 2)**2)\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        N = case['N']\n        alpha = case['alpha']\n        \n        x_particles = case['x_gen'](N)\n        raw_weights = case['w_gen'](x_particles)\n        \n        # Normalize weights if they don't sum to 1 (Case B weights are pre-normalized)\n        if not np.isclose(np.sum(raw_weights), 1.0):\n            weights = raw_weights / np.sum(raw_weights)\n        else:\n            weights = raw_weights\n\n        case_results = calculate_diagnostics(x_particles, weights, alpha)\n        results.append(case_results)\n    \n    # Format the final output string as specified\n    result_strings = []\n    for R in results:\n        # R[0], R[1], R[2], R[4] are floats, R[3], R[5] are ints\n        s = f\"[{R[0]:.6f},{R[1]:.6f},{R[2]:.6f},{R[3]},{R[4]:.6f},{R[5]}]\"\n        result_strings.append(s)\n        \n    print(f\"[{','.join(result_strings)}]\")\n\nsolve()\n```", "id": "3373825"}, {"introduction": "在识别出HPD区域后，我们可能希望更深入地探索该区域，但如果后验是多峰的且HPD区域不连通，这项任务将变得极具挑战性。这个问题[@problem_id:3373821]侧重于高级算法设计，要求您设计一个稳健的马尔可夫链蒙特卡洛（MCMC）方法，以便从截断在HPD区域内的后验分布中进行采样。要成功解决此问题，您需要采用一个两阶段策略：首先估计HPD阈值，然后构建一个遍历性的采样器，使其能够有效地在复杂且可能不相连的高概率空间中穿行。", "problem": "考虑一个贝叶斯逆问题，其观测模型为 $y = \\mathcal{G}(\\theta) + \\varepsilon$，其中 $\\theta \\in \\mathbb{R}^{d}$ 是一个未知参数，$\\mathcal{G}:\\mathbb{R}^{d}\\to \\mathbb{R}^{m}$ 是一个已知的正向算子，$\\varepsilon \\sim \\mathcal{N}(0,\\Gamma)$ 是协方差矩阵为 $\\Gamma \\in \\mathbb{R}^{m \\times m}$ 的高斯噪声。假设一个高斯先验 $\\theta \\sim \\mathcal{N}(m_{0},C_{0})$，其均值为 $m_{0} \\in \\mathbb{R}^{d}$，协方差为正定矩阵 $C_{0} \\in \\mathbb{R}^{d \\times d}$。根据贝叶斯定理，后验密度 $\\pi(\\theta \\mid y)$ 在忽略归一化常数的情况下是已知的。\n\n将在置信水平 $1-\\alpha \\in (0,1)$ 上的最高后验密度（HPD）区域定义为水平集 $L_{c} = \\{\\theta \\in \\mathbb{R}^{d} : \\pi(\\theta \\mid y) \\ge c\\}$，其中阈值 $c0$ 的选择使得 $L_{c}$ 的后验质量恰好为 $1-\\alpha$。在多峰后验分布中，HPD 区域 $L_{c}$ 可能是不连通的。\n\n您的任务是开发一种算法方法，用于从截断后验 $\\pi_{c}(\\theta) \\propto \\pi(\\theta \\mid y)\\,\\mathbb{I}\\{\\pi(\\theta \\mid y) \\ge c\\}$ 中采样，并指定用于选择 $c$ 的诊断方法，以使 $L_{c}$ 的后验质量近似为 $1-\\alpha$，同时保持马尔可夫链在 $\\pi_{c}$ 的（可能不连通的）支撑集上的遍历性。您唯一可以假设的基础工具是：HPD 区域的定义；马尔可夫链遍历性的定义；以及标准的马尔可夫链蒙特卡罗（MCMC）的 Metropolis–Hastings 细致平衡条件。\n\n以下哪个选项正确地提出了这样一种算法及相关的诊断方法，这些方法基于上述原则且在实践中具有科学合理性？\n\nA. 运行一个针对完整后验 $\\pi(\\theta \\mid y)$ 且具有遍历性的引导 MCMC。使用后验样本 $\\{\\theta_{i}\\}_{i=1}^{N}$ 通过蒙特卡罗估计量 $\\widehat{S}_{N}(c) = \\frac{1}{N}\\sum_{i=1}^{N} \\mathbb{I}\\{\\pi(\\theta_{i} \\mid y) \\ge c\\}$ 来估计生存函数 $S(c) = \\mathbb{P}_{\\pi(\\cdot \\mid y)}(\\pi(\\theta \\mid y) \\ge c)$。选择 $\\widehat{c}$ 使得 $\\widehat{S}_{N}(\\widehat{c}) \\approx 1-\\alpha$（例如，通过选择 $\\{\\pi(\\theta_{i} \\mid y)\\}$ 的经验 $(1-\\alpha)$-分数阈值）。然后运行一个 Metropolis–Hastings 采样器，该采样器使 $\\pi_{\\widehat{c}}(\\theta) \\propto \\pi(\\theta \\mid y)\\,\\mathbb{I}\\{\\pi(\\theta \\mid y) \\ge \\widehat{c}\\}$ 保持不变，使用混合提议：以概率 $p \\in (0,1)$ 提议一个局部移动（例如，高斯随机游走）并拒绝任何在 $L_{\\widehat{c}}$ 之外的提议；以概率 $1-p$ 从一个使用引导样本在 $L_{\\widehat{c}}$ 上拟合的高斯混合分布中提议一个独立样本。使用针对 $\\pi_{\\widehat{c}}$ 的常规 Metropolis–Hastings 比率接受或拒绝。诊断方法：验证 $\\widehat{S}_{N}(\\widehat{c})$ 在二项标准误 $\\sqrt{(1-\\alpha)\\alpha/N}$ 的范围内接近 $1-\\alpha$；将 $\\pi_{\\widehat{c}}$ 链的模态占据率与将引导后验样本限制在 $L_{\\widehat{c}}$ 内所引出的占据率进行比较；监控接受率、积分自相关时间，并从分散的初始点运行多个链，以检查 $L_{\\widehat{c}}$ 的所有连通分量都曾被访问。\n\nB. 任意初始化 $c_{0}$，并构建一个在第 $n$ 次迭代时针对 $\\pi_{c_{n}}(\\theta) \\propto \\pi(\\theta \\mid y)\\,\\mathbb{I}\\{\\pi(\\theta \\mid y) \\ge c_{n}\\}$ 的马尔可夫链。通过 Robbins–Monro 递推 $c_{n+1} = c_{n} + \\gamma_{n}\\left(\\mathbb{I}\\{\\pi(\\theta_{n} \\mid y) \\ge c_{n}\\} - (1-\\alpha)\\right)$ 在线自适应调整 $c_{n}$，步长为 $\\gamma_{n} = n^{-1/2}$。这确保了 $\\mathbb{I}\\{\\pi(\\theta_{n} \\mid y) \\ge c_{n}\\}$ 的时间平均收敛到 $1-\\alpha$，并且因为 $\\gamma_{n} \\to 0$，通过递减的自适应过程，极限分布 $\\pi_{c_{\\infty}}$ 的遍历性得以保持。诊断方法：验证 $c_{n}$ 随时间的稳定性，以及集合内状态的经验分数等于 $1-\\alpha$。\n\nC. 通过增广一个辅助变量 $u$ 并从与 $\\mathbb{I}\\{0 \\le u \\le \\pi(\\theta \\mid y)\\}$ 成比例的联合密度中采样，对完整后验使用切片采样。将 $c$ 设置为切片采样器路径上实现的 $u$ 值的经验 $(1-\\alpha)$-分位数；然后通过对 $u \\ge c$ 进行条件化，从 $\\pi_{c}$ 中采样，以使状态位于 HPD 区域内。诊断方法：由于在 $\\pi(\\theta \\mid y)$ 下的垂直切片上 $u$ 是均匀分布的，选择 $c$ 使得 $\\mathbb{P}(u \\ge c) = 1-\\alpha$ 可以确保 HPD 区域具有所需的质量。\n\nD. 在从 $\\pi_{c}$ 采样的过程中，使用 $c_{n+1} = \\mathrm{median}\\left(c_{n},\\,\\pi(\\theta_{n} \\mid y)\\right)$ 自适应地选择 $c$，以便链能够自我调整到正确的 HPD 质量。为保持在不连通分量间的遍历性，交错执行从完整后验 $\\pi(\\theta \\mid y)$ 中精确采样的步骤，如果抽取的样本落在 $L_{c_{n}}$ 内，则自动接受。诊断方法：检查 $c_{n}$ 的中位数是否稳定，以及每 $K$ 次迭代，链是否至少访问每个检测到的模态一次。\n\nE. 首先通过调和平均估计量估计边际似然，将未归一化的后验纵坐标转换为归一化的概率，然后通过求解 $\\mathbb{E}_{\\pi(\\cdot \\mid y)}[\\mathbb{I}\\{\\log \\pi(\\theta \\mid y) \\ge \\log c\\}] = 1-\\alpha$ 来估计 $c$。然后运行一个限制在 $L_{c}$ 内的随机游走 Metropolis，并依赖高接受率作为主要的混合诊断指标。\n\n选择整体上都正确的选项，包括算法及其诊断方法。", "solution": "首先对问题陈述进行严格的验证过程。\n\n### 第 1 步：提取已知条件\n\n-   **观测模型**：$y = \\mathcal{G}(\\theta) + \\varepsilon$，其中 $y \\in \\mathbb{R}^{m}$。\n-   **未知参数**：$\\theta \\in \\mathbb{R}^{d}$。\n-   **正向算子**：$\\mathcal{G}:\\mathbb{R}^{d}\\to \\mathbb{R}^{m}$ 是一个已知函数。\n-   **噪声模型**：$\\varepsilon \\sim \\mathcal{N}(0,\\Gamma)$，其中 $\\Gamma \\in \\mathbb{R}^{m \\times m}$ 是协方差矩阵。\n-   **先验分布**：$\\theta \\sim \\mathcal{N}(m_{0},C_{0})$，均值为 $m_{0} \\in \\mathbb{R}^{d}$，协方差矩阵 $C_{0} \\in \\mathbb{R}^{d \\times d}$ 为正定矩阵。\n-   **后验密度**：$\\pi(\\theta \\mid y)$ 在忽略归一化常数的情况下是已知的。\n-   **最高后验密度 (HPD) 区域**：定义为 $L_{c} = \\{\\theta \\in \\mathbb{R}^{d} : \\pi(\\theta \\mid y) \\ge c\\}$，置信水平为 $1-\\alpha \\in (0,1)$，其中阈值 $c0$ 的选择使得 $L_{c}$ 的后验质量恰好为 $1-\\alpha$。\n-   **问题特性**：后验分布可能是多峰的，导致 HPD 区域 $L_c$ 不连通。\n-   **任务**：提出一种算法，从截断后验 $\\pi_{c}(\\theta) \\propto \\pi(\\theta \\mid y)\\,\\mathbb{I}\\{\\pi(\\theta \\mid y) \\ge c\\}$ 中采样，并指定用于选择 $c$ 和确保马尔可夫链在 $\\pi_c$ 支撑集上遍历性的诊断方法。\n-   **假设工具**：HPD 区域的定义，遍历性的定义，以及 Metropolis–Hastings 细致平衡条件。\n\n### 第 2 步：使用提取的已知条件进行验证\n\n-   **科学依据**：该问题是在贝叶斯逆问题的标准框架内提出的。所有概念——高斯先验和噪声、贝叶斯定理、后验分布、最高后验密度 (HPD) 区域、马尔可夫链蒙特卡罗 (MCMC)、遍历性以及 Metropolis-Hastings 算法——都是统计学、机器学习和计算科学中的基础且公认的概念。该设置具有科学严谨性。\n-   **适定性**：问题要求从一系列选项中确定一个正确的算法策略及其相关的诊断方法。目标明确，提供的信息足以评估所提出方法的理论合理性。\n-   **客观性**：语言精确、技术性强，没有任何主观或模棱两可的术语。\n-   **缺陷清单**：该问题不违反任何无效标准。它科学合理、可形式化、对其目的而言是完备的、现实的、适定的且非平凡的。核心挑战——从一个可能不连通的 HPD 区域中采样——是计算统计学中一个众所周知的难题，这使得该问题具有实质性。\n\n### 第 3 步：结论与行动\n\n问题陈述是**有效的**。现在将通过评估每个选项来推导出一个完整的解决方案。\n\n### 推导与选项分析\n\n该任务涉及两个耦合的子问题：\n1.  **估计 HPD 阈值 `c`**：我们必须找到一个值 $c$，使得 $\\int_{L_c} \\pi(\\theta \\mid y) \\, d\\theta = 1-\\alpha$，其中 $L_c = \\{\\theta : \\pi(\\theta \\mid y) \\ge c\\}$。由于 $\\pi(\\theta \\mid y)$ 仅在忽略一个常数的情况下是已知的，这通常需要来自完整后验分布的样本。\n2.  **从截断后验 `pi_c` 中采样**：我们需要一个迭代算法（一个 MCMC 采样器），该算法收敛到分布 $\\pi_{c}(\\theta) \\propto \\pi(\\theta \\mid y)\\,\\mathbb{I}\\{\\pi(\\theta \\mid y) \\ge c\\}$。一个关键要求是，该采样器必须在 $\\pi_c$ 的整个支撑集上是遍历的，而这个支撑集可能由几个不连通的集合组成（对应于后验分布中足够“高”以至于处于 HPD 区域内的多个模态）。\n\n我们现在根据这些要求和 MCMC 的基本原则来评估每个选项。\n\n**A. 运行一个针对完整后验的引导 MCMC ...**\n\n-   **算法**：该选项提出了一个两阶段方法。\n    1.  **阶段 1 (寻找 $\\widehat{c}$)**：运行一个标准的、遍历的 MCMC 采样器，针对完整后验 $\\pi(\\theta \\mid y)$ 生成一组样本 $\\{\\theta_{i}\\}_{i=1}^{N}$。这是一个标准且必要的前置步骤。然后，对每个样本 $\\theta_i$，评估（未归一化的）后验密度 $\\pi(\\theta_i \\mid y)$。将值 $\\widehat{c}$ 选为这些密度值的经验 $\\alpha$-分位数。这等同于找到 $\\widehat{c}$，使得生存函数的蒙特卡罗估计 $\\widehat{S}_{N}(\\widehat{c}) = \\frac{1}{N}\\sum_{i=1}^{N} \\mathbb{I}\\{\\pi(\\theta_{i} \\mid y) \\ge \\widehat{c}\\}$ 近似等于 $1-\\alpha$。这是一种统计上合理且标准的估计 HPD 阈值的方法。\n    2.  **阶段 2 (从 $\\pi_{\\widehat{c}}$ 中采样)**：为目标分布 $\\pi_{\\widehat{c}}(\\theta)$ 构建一个 Metropolis-Hastings 采样器。提议机制是两种移动的混合：一种是局部移动（如高斯随机游走），用于在 $L_{\\widehat{c}}$ 的一个连通分量内高效探索；另一种是全局移动（从一个拟合于引导样本的高斯混合模型中进行独立抽取），旨在在不连通的分量之间跳跃。这种混合提议直接解决了多峰后验带来的遍历性挑战。Metropolis-Hastings 接受规则确保了生成的马尔可夫链以 $\\pi_{\\widehat{c}}$ 为其平稳分布。\n-   **诊断方法**：所提出的诊断方法全面且恰当。\n    -   使用二项标准误来验证估计质量（$1-\\alpha$）的准确性是正确的，因为估计量是指示变量的和。\n    -   比较引导链（限制在 $L_{\\widehat{c}}$ 内）和新链之间的模态占据率，是评估采样器是否在模态之间正确混合的有效诊断方法。\n    -   对于任何严肃的 MCMC 应用，监控标准的 MCMC 诊断指标，如接受率、积分自相关时间，以及使用从分散的起始点出发的多个链，都是必不可少的。专门检查所有检测到的连通分量是否都被访问，直接验证了遍历性。\n-   **结论**：**正确**。该选项描述了一个完整、理论上合理且实用的先进算法。它正确地识别了子问题，并为每个问题提出了稳健的解决方案和详尽的诊断方法。\n\n**B. 任意初始化 $c_{0}$，并构建一个针对 $\\pi_{c_{n}}(\\theta) \\ldots$ 的马尔可夫链**\n\n-   **算法**：这提出了一个自适应 MCMC 算法，其中阈值 $c_n$ 在第 $n$ 次迭代时通过 Robbins-Monro（随机近似）方案进行更新。更新规则为 $c_{n+1} = c_{n} + \\gamma_{n}\\left(\\mathbb{I}\\{\\pi(\\theta_{n} \\mid y) \\ge c_{n}\\} - (1-\\alpha)\\right)$。\n-   **缺陷**：根本性缺陷在于更新规则。项 $\\mathbb{I}\\{\\pi(\\theta_{n} \\mid y) \\ge c_{n}\\}$ 的期望是关于当前样本 $\\theta_n$ 的，而 $\\theta_n$ 是从截断分布 $\\pi_{c_n}$ 中抽取的。根据 $\\pi_{c_n}$ 的定义，从中抽取的任何样本 $\\theta_n$ 都必须满足 $\\pi(\\theta_n \\mid y) \\ge c_n$。因此，$\\mathbb{I}\\{\\pi(\\theta_{n} \\mid y) \\ge c_{n}\\}$ 恒等于 $1$。更新步骤变为 $c_{n+1} = c_{n} + \\gamma_{n}(1 - (1-\\alpha)) = c_{n} + \\gamma_{n}\\alpha$。由于 $\\gamma_n  0$ 且 $\\alpha  0$，$c_n$ 将单调增加并发散，而不是收敛到正确的阈值。该算法基于一个根本性的逻辑错误。\n-   **结论**：**不正确**。\n\n**C. 对完整后验使用切片采样...**\n\n-   **算法**：这建议对完整后验使用切片采样。切片采样通过在后验密度函数图像下方的区域 $\\{(\\theta, u) : 0 \\le u \\le \\pi(\\theta \\mid y)\\}$ 上均匀采样来工作。该方法建议将 $c$ 设置为辅助变量样本 $\\{u_i\\}$ 的经验 $(1-\\alpha)$-分位数。\n-   **缺陷**：这种确定 $c$ 的方法是不正确的。目标是找到 $c$，使得 $\\mathbb{P}_{\\pi(\\cdot \\mid y)}(\\pi(\\theta \\mid y) \\ge c) = 1-\\alpha$。该提议是找到 $c$，使得 $\\mathbb{P}(u \\ge c) = 1-\\alpha$，其中 $u$ 是来自切片采样器的辅助变量。 $u$ 的边际分布不是均匀的，并且其分布与 $\\pi(\\theta|y)$ 的分布之间没有所需的那种简单关系。概率 $\\mathbb{P}(u \\ge c)$ 由 $\\int \\mathbb{P}(u \\ge c \\mid \\theta) \\pi(\\theta \\mid y) d\\theta = \\int_{L_c} \\frac{\\pi(\\theta \\mid y) - c}{\\pi(\\theta \\mid y)} \\pi(\\theta \\mid y) d\\theta$ 给出。这个积分不等于 HPD 区域的实际质量 $\\int_{L_c} \\pi(\\theta \\mid y) d\\theta$。因此，找到 $c$ 的方法是无效的。\n-   **结论**：**不正确**。\n\n**D. 在从 $\\pi_{c}$ 采样的过程中，使用 $c_{n+1} = \\mathrm{median}\\left(c_{n},\\,\\pi(\\theta_{n} \\mid y)\\right) \\ldots$ 自适应地选择 c**\n\n-   **算法**：这提出了另一种自适应方案，更新规则为 $c_{n+1} = \\mathrm{median}\\left(c_{n},\\,\\pi(\\theta_{n} \\mid y)\\right)$。\n-   **缺陷**：这个更新规则是一种没有理论依据的特设启发式方法。它不是从旨在寻找特定分位数的有原则的框架（如随机近似）中推导出来的。不清楚这个过程会收敛到什么（如果会收敛的话）。交错执行从完整后验 $\\pi(\\theta \\mid y)$ 中采样的步骤以改善混合（与并行退火相关）是一个有效的想法，但“自动接受它们”部分通常是不正确的，并且会违反细致平衡，除非提议是以一种此处未描述的非常特定的方式构建的。选择 $c$ 的方法是不合理的。\n-   **结论**：**不正确**。\n\n**E. 首先通过调和平均估计量估计边际似然... 然后通过求解 $\\mathbb{E}_{\\pi(\\cdot \\mid y)}[\\mathbb{I}\\{\\log \\pi(\\theta \\mid y) \\ge \\log c\\}] = 1-\\alpha$ 来估计 c**\n\n-   **算法**：这个选项包含多个严重缺陷。\n    1.  **调和平均估计量**：它建议通过首先使用调和平均估计量来估计边际似然（模型证据，$Z = \\int \\pi(y|\\theta)\\pi(\\theta) d\\theta$），从而对后验密度值进行归一化。调和平均估计量是众所周知的病态差的估计量。它在许多情况下是不一致的，通常具有无穷方差，并且对先验分布的低概率区域中的样本高度敏感。在一个需要相当高精度的任务中依赖它是判断上的一个严重错误。\n    2.  **采样算法**：它提出了一个简单的“限制在 $L_c$ 内的随机游走 Metropolis”。这意味着如果提议落在 $L_c$ 之外就会被拒绝。这种简单的机制没有为在 $L_c$ 的不连通分量之间跳跃做出特殊规定。如果 HPD 区域是不连通的，这样的采样器不保证是遍历的，并且几乎肯定会被困在单个分量中。这未能解决问题陈述中强调的一个关键挑战。\n    3.  **诊断方法**：它建议依赖“高接受率作为主要的混合诊断指标”。这是一个糟糕的建议。对于随机游走 Metropolis 采样器，高接受率（例如， 50%）通常表明提议步长太小，导致对状态空间的探索非常缓慢（混合差），而不是混合好。\n-   **结论**：**不正确**。", "answer": "$$\\boxed{A}$$", "id": "3373821"}]}