{"hands_on_practices": [{"introduction": "理论上完美的卡尔曼滤波器在实际应用中可能会遇到数值稳定性问题。本练习探讨了一种由观测算子病态（ill-conditioned）所引发的常见情况，这种情况在观测信息冗余时经常出现。通过本练习，你将通过分析特征值来诊断问题，并探索一种称为“特征值裁剪”的正则化方法，从而学习到数据同化系统数值鲁棒性的重要一课。[@problem_id:3379778]", "problem": "考虑一个线性高斯数据同化设定，其状态维数 $n = 2$，观测维数 $m = 2$。预报（先验）状态由均值 $x^{f} \\in \\mathbb{R}^{2}$ 和协方差 $P^{f} \\in \\mathbb{R}^{2 \\times 2}$ 表征。观测模型是线性的，其算子为 $H \\in \\mathbb{R}^{2 \\times 2}$，观测值为 $y \\in \\mathbb{R}^{2}$，观测误差协方差为 $R \\in \\mathbb{R}^{2 \\times 2}$。假设预报误差和观测误差服从高斯分布。分析（后验）均值 $x^{a}$ 和协方差 $P^{a}$ 由卡尔曼增益决定的经典线性高斯更新定义。在集合变换卡尔曼滤波 (Ensemble Transform Kalman Filter, ETKF) 中，用于更新集合异常的变换 $T$ 的条件数继承自新息协方差 $S = H P^{f} H^{\\top} + R$。\n\n给定以下具体情况：\n- $x^{f} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$，\n- $y = \\begin{pmatrix} 2 \\\\ 2 \\end{pmatrix}$，\n- $P^{f} = \\begin{pmatrix} 1  0.99 \\\\ 0.99  1 \\end{pmatrix}$，\n- $H = \\begin{pmatrix} 1  1 \\\\ 1  1 \\end{pmatrix}$ (近似秩亏)，\n- $R = r I_{2}$，其中 $r = 10^{-4}$。\n\n1. 使用线性高斯数据同化框架（不调用任何 ETKF 特定的快捷公式），推导出新息协方差 $S = H P^{f} H^{\\top} + R$，并计算其特征值。基于第一性原理，解释为何对于给定的 $H$ 和 $R$，依赖于 $S$ 谱的 ETKF 变换 $T$ 会是病态的。\n\n2. 提出对新息协方差进行特征值裁剪，定义为将 $S$ 的任何严格小于 $\\varepsilon = 10^{-3}$ 的特征值替换为 $\\varepsilon$，以获得一个裁剪后的矩阵 $S_{\\text{clip}}$。定义裁剪后的卡尔曼增益 $K_{\\text{clip}} = P^{f} H^{\\top} S_{\\text{clip}}^{-1}$，并计算相应的分析均值 $x^{a}_{\\text{clip}}$ 和分析协方差 $P^{a}_{\\text{clip}}$。\n\n3. 定义影响度量\n$$\nI \\;=\\; \\| x^{a}_{\\text{clip}} - x^{a} \\|_{2}^{2} \\;+\\; \\| P^{a}_{\\text{clip}} - P^{a} \\|_{F}^{2},\n$$\n其中 $\\| \\cdot \\|_{2}$ 是欧几里得范数，$\\| \\cdot \\|_{F}$ 是弗罗贝尼乌斯范数。对指定的数值计算 $I$。将最终答案表示为一个无单位的实数。", "solution": "根据要求，本问题将分三部分解答。问题的核心在于在一个标准的卡尔曼滤波更新框架内，分析特征值裁剪对新息协方差矩阵的影响。\n\n给定的参数如下：\n状态维数 $n = 2$，观测维数 $m = 2$。\n预报均值：$x^{f} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$。\n预报协方差：$P^{f} = \\begin{pmatrix} 1  0.99 \\\\ 0.99  1 \\end{pmatrix}$。\n观测算子：$H = \\begin{pmatrix} 1  1 \\\\ 1  1 \\end{pmatrix}$。\n观测向量：$y = \\begin{pmatrix} 2 \\\\ 2 \\end{pmatrix}$。\n观测误差协方差：$R = r I_{2}$，其中 $r = 10^{-4}$。\n裁剪阈值：$\\varepsilon = 10^{-3}$。\n\n在线性高斯框架中，均值和协方差的分析更新方程为：\n$$x^{a} = x^{f} + K(y - Hx^{f})$$\n$$P^{a} = (I - KH)P^{f}$$\n其中 $K$ 是卡尔曼增益 $K = P^{f} H^{\\top} S^{-1}$，而 $S$ 是新息协方差 $S = H P^{f} H^{\\top} + R$。\n\n### 第1部分：新息协方差与病态问题\n\n首先，我们计算新息协方差矩阵 $S$。\n预报协方差的投影为：\n$$H P^{f} = \\begin{pmatrix} 1  1 \\\\ 1  1 \\end{pmatrix} \\begin{pmatrix} 1  0.99 \\\\ 0.99  1 \\end{pmatrix} = \\begin{pmatrix} 1.99  1.99 \\\\ 1.99  1.99 \\end{pmatrix}$$\n$$H P^{f} H^{\\top} = \\begin{pmatrix} 1.99  1.99 \\\\ 1.99  1.99 \\end{pmatrix} \\begin{pmatrix} 1  1 \\\\ 1  1 \\end{pmatrix} = \\begin{pmatrix} 3.98  3.98 \\\\ 3.98  3.98 \\end{pmatrix}$$\n现在，我们加上观测误差协方差 $R$：\n$$S = H P^{f} H^{\\top} + R = \\begin{pmatrix} 3.98  3.98 \\\\ 3.98  3.98 \\end{pmatrix} + \\begin{pmatrix} 10^{-4}  0 \\\\ 0  10^{-4} \\end{pmatrix} = \\begin{pmatrix} 3.9801  3.98 \\\\ 3.98  3.9801 \\end{pmatrix}$$\n为了求 $S$ 的特征值，我们求解特征方程 $\\det(S - \\lambda I) = 0$：\n$$(3.9801 - \\lambda)^{2} - (3.98)^{2} = 0$$\n$$(3.9801 - \\lambda - 3.98)(3.9801 - \\lambda + 3.98) = 0$$\n$$(0.0001 - \\lambda)(7.9601 - \\lambda) = 0$$\n特征值为 $\\lambda_1 = 10^{-4}$ 和 $\\lambda_2 = 7.9601$。\n\nETKF 变换矩阵 $T$ 用于更新集合异常，且与 $S^{-1/2}$ 相关。这种变换的条件数取决于 $S$ 的条件数，即其最大特征值与最小特征值之比：\n$$\\kappa(S) = \\frac{|\\lambda_{\\max}|}{|\\lambda_{\\min}|} = \\frac{7.9601}{10^{-4}} = 79601$$\n大的条件数表明该矩阵是病态的。变换 $T$ 会涉及这些特征值的负二分之一次方，即 $\\lambda_1^{-1/2} = (10^{-4})^{-1/2} = 100$ 和 $\\lambda_2^{-1/2} = (7.9601)^{-1/2} \\approx 0.354$。变换矩阵中这些数值的巨大差异会放大集合更新过程中的数值误差，导致滤波器不稳定。病态问题源于观测算子 $H$ 是秩亏的（秩为1）。它将状态空间投影到一个一维子空间上。因此，$H P^f H^\\top$ 也是秩为1的，有一个零特征值和一个非零特征值（$7.96$）。加上小的各向同性误差协方差 $R = rI_2$ 会轻微扰动这些特征值，将零特征值移动到大约 $r = 10^{-4}$，这个值非常接近零，从而造成了病态问题。\n\n### 第2部分：裁剪后的分析\n\n特征值裁剪过程将任何小于 $\\varepsilon$ 的特征值 $\\lambda$ 替换为 $\\varepsilon$。这里，$\\lambda_1 = 10^{-4}  \\varepsilon = 10^{-3}$，因此我们替换它。裁剪后的特征值为：\n$$\\lambda_{1, \\text{clip}} = \\varepsilon = 10^{-3}$$\n$$\\lambda_{2, \\text{clip}} = \\lambda_2 = 7.9601$$\n设 $S_{\\text{clip}}$ 是具有这些裁剪后特征值的矩阵。裁剪后的卡尔曼增益为 $K_{\\text{clip}} = P^{f} H^{\\top} S_{\\text{clip}}^{-1}$。我们计算相应的分析均值 $x^{a}_{\\text{clip}}$ 和协方差 $P^{a}_{\\text{clip}}$。\n\n首先，我们必须计算 $K_{\\text{clip}}$。为此，我们计算 $S_{\\text{clip}}^{-1}$。$S$ 的特征向量不受裁剪影响。对于形如 $\\begin{pmatrix} a  b \\\\ b  a \\end{pmatrix}$ 的矩阵，其归一化特征向量为 $u_1 = \\frac{1}{\\sqrt{2}}\\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$ (对应特征值 $a-b$) 和 $u_2 = \\frac{1}{\\sqrt{2}}\\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$ (对应特征值 $a+b$)。对于 $S$， $u_1$ 对应于 $\\lambda_1$，$u_2$ 对应于 $\\lambda_2$。\n矩阵 $S_{\\text{clip}}^{-1}$ 可以通过其谱分解表示：\n$$S_{\\text{clip}}^{-1} = \\frac{1}{\\lambda_{1, \\text{clip}}} u_1 u_1^\\top + \\frac{1}{\\lambda_{2, \\text{clip}}} u_2 u_2^\\top = \\frac{1}{10^{-3}} u_1 u_1^\\top + \\frac{1}{7.9601} u_2 u_2^\\top$$\n现在我们计算 $K_{\\text{clip}} = P^f H^\\top S_{\\text{clip}}^{-1}$。我们先分析 $P^f H^\\top$ 这一项：\n$$P^{f} H^{\\top} = \\begin{pmatrix} 1  0.99 \\\\ 0.99  1 \\end{pmatrix} \\begin{pmatrix} 1  1 \\\\ 1  1 \\end{pmatrix} = \\begin{pmatrix} 1.99  1.99 \\\\ 1.99  1.99 \\end{pmatrix} = 1.99 H$$\n$H$ 的一个关键性质是它对 $S$ 的特征向量的作用：\n$$H u_1 = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1  1 \\\\ 1  1 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$$\n$$H u_2 = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1  1 \\\\ 1  1 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 2 \\\\ 2 \\end{pmatrix} = \\sqrt{2} \\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}$$\n因此，矩阵 $H$ 将任意向量投影到 $u_2$ 的方向上，并消除 $u_1$ 方向上的任何分量。它完全位于 $u_1 u_1^\\top$ 的零空间中。\n我们现在可以计算 $H S_{\\text{clip}}^{-1}$ 这一项：\n$$H S_{\\text{clip}}^{-1} = H \\left( \\frac{1}{\\varepsilon} u_1 u_1^\\top + \\frac{1}{\\lambda_2} u_2 u_2^\\top \\right) = \\frac{1}{\\varepsilon} (H u_1) u_1^\\top + \\frac{1}{\\lambda_2} (H u_2) u_2^\\top = \\mathbf{0} + \\frac{1}{\\lambda_2} (\\sqrt{2}\\begin{pmatrix} 1 \\\\ 1 \\end{pmatrix}) \\frac{1}{\\sqrt{2}}\\begin{pmatrix} 1  1 \\end{pmatrix} = \\frac{1}{\\lambda_2}H$$\n所以，$K_{\\text{clip}} = (1.99 H) S_{\\text{clip}}^{-1} = 1.99 (H S_{\\text{clip}}^{-1}) = \\frac{1.99}{\\lambda_2} H$。\n$$K_{\\text{clip}} = \\frac{1.99}{7.9601} \\begin{pmatrix} 1  1 \\\\ 1  1 \\end{pmatrix} = \\begin{pmatrix} \\frac{1.99}{7.9601}  \\frac{1.99}{7.9601} \\\\ \\frac{1.99}{7.9601}  \\frac{1.99}{7.9601} \\end{pmatrix}$$\n那么分析均值为：\n$$x^{a}_{\\text{clip}} = x^{f} + K_{\\text{clip}}(y - Hx^{f}) = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} + \\frac{1.99}{7.9601} \\begin{pmatrix} 1  1 \\\\ 1  1 \\end{pmatrix} \\begin{pmatrix} 2 \\\\ 2 \\end{pmatrix} = \\frac{1.99}{7.9601} \\begin{pmatrix} 4 \\\\ 4 \\end{pmatrix} = \\begin{pmatrix} \\frac{7.96}{7.9601} \\\\ \\frac{7.96}{7.9601} \\end{pmatrix}$$\n数值上，$\\frac{7.96}{7.9601} = \\frac{79600}{79601}$。\n$$x^{a}_{\\text{clip}} = \\begin{pmatrix} \\frac{79600}{79601} \\\\ \\frac{79600}{79601} \\end{pmatrix}$$\n分析协方差为：\n$$P^{a}_{\\text{clip}} = (I - K_{\\text{clip}}H)P^{f}$$\n$$K_{\\text{clip}}H = \\frac{1.99}{7.9601} H^2 = \\frac{1.99}{7.9601} \\begin{pmatrix} 2  2 \\\\ 2  2 \\end{pmatrix} = \\frac{3.98}{7.9601} H$$\n令 $c = \\frac{3.98}{7.9601}$。\n$$P^{a}_{\\text{clip}} = \\left( I - c \\begin{pmatrix} 1  1 \\\\ 1  1 \\end{pmatrix} \\right) \\begin{pmatrix} 1  0.99 \\\\ 0.99  1 \\end{pmatrix} = \\begin{pmatrix} 1-c  -c \\\\ -c  1-c \\end{pmatrix} \\begin{pmatrix} 1  0.99 \\\\ 0.99  1 \\end{pmatrix}$$\n$$P^{a}_{\\text{clip}} = \\begin{pmatrix} 1 - c - 0.99c  0.99(1-c) - c \\\\ -c + 0.99(1-c)  -0.99c + 1-c \\end{pmatrix} = \\begin{pmatrix} 1-1.99c  0.99-1.99c \\\\ 0.99-1.99c  1-1.99c \\end{pmatrix}$$\n$1.99c = 1.99 \\frac{3.98}{7.9601} = \\frac{7.9202}{7.9601}$。\n对角元素：$1-\\frac{7.9202}{7.9601} = \\frac{0.0399}{7.9601}=\\frac{399}{79601}$。\n非对角元素：$0.99 - \\frac{7.9202}{7.9601} = \\frac{0.99 \\times 7.9601 - 7.9202}{7.9601} = \\frac{7.880499 - 7.9202}{7.9601} = \\frac{-0.039701}{7.9601}=\\frac{-397.01}{79601}$。\n$$P^{a}_{\\text{clip}} = \\frac{1}{79601} \\begin{pmatrix} 399  -397.01 \\\\ -397.01  399 \\end{pmatrix}$$\n\n### 第3部分：影响度量\n\n为了评估影响度量 $I = \\| x^{a}_{\\text{clip}} - x^{a} \\|_{2}^{2} + \\| P^{a}_{\\text{clip}} - P^{a} \\|_{F}^{2}$，我们必须首先计算未裁剪的分析状态 $x^a$ 和协方差 $P^a$。这些是通过使用原始的新息协方差 $S$ 及其逆 $S^{-1}$ 来计算标准的卡尔曼增益 $K$ 得到的。\n$$K = P^{f} H^{\\top} S^{-1} = 1.99 H S^{-1}$$\n$H S^{-1}$ 的计算逻辑与 $H S_{\\text{clip}}^{-1}$ 的相同，只是将 $\\varepsilon$ 替换为 $\\lambda_1$：\n$$S^{-1} = \\frac{1}{\\lambda_1} u_1 u_1^\\top + \\frac{1}{\\lambda_2} u_2 u_2^\\top$$\n$$H S^{-1} = H \\left( \\frac{1}{\\lambda_1} u_1 u_1^\\top + \\frac{1}{\\lambda_2} u_2 u_2^\\top \\right) = \\mathbf{0} + \\frac{1}{\\lambda_2} H = \\frac{1}{\\lambda_2}H$$\n因此，未裁剪的卡尔曼增益为：\n$$K = 1.99 (H S^{-1}) = \\frac{1.99}{\\lambda_2} H$$\n这与 $K_{\\text{clip}}$ 的表达式相同。\n$$K = K_{\\text{clip}}$$\n这个关键结果源于问题的特定结构，其中：\n1.  $P^{f} H^{\\top}$ 与 $H$ 成正比。\n2.  裁剪是沿着位于 H 零空间中的特征向量方向 $u_1$ 进行的。\n\n由于卡尔曼增益相同，分析更新也相同：\n$$x^{a} = x^f + K(y-Hx^f) = x^f + K_{\\text{clip}}(y-Hx^f) = x^{a}_{\\text{clip}}$$\n$$P^{a} = (I-KH)P^f = (I-K_{\\text{clip}}H)P^f = P^{a}_{\\text{clip}}$$\n因此，影响度量中的两项都为零：\n$$\\| x^{a}_{\\text{clip}} - x^{a} \\|_{2}^{2} = 0$$\n$$\\| P^{a}_{\\text{clip}} - P^{a} \\|_{F}^{2} = 0$$\n总影响为：\n$$I = 0 + 0 = 0$$\n在这种特定情况下，对小特征值的裁剪对最终的分析状态和协方差没有影响。这是因为观测向量 y 和观测算子 H 仅携带沿 $u_2$ 方向的信息，该方向与大的、未被裁剪的特征值 $\\lambda_2$ 相关联。数值敏感的 $u_1$ 方向没有被观测所更新，因此在新息协方差模型中修改其关联的特征值不会改变卡尔曼更新的结果。", "answer": "$$\\boxed{0}$$", "id": "3379778"}, {"introduction": "解决了基本的数值稳定性后，我们转向滤波器性能的调优。集合卡尔曼滤波器一个常见的失效模式是“集合坍缩”，即集合离散度变得过小，导致滤波器对观测的响应不足。本练习介绍了一种强大的应对技术——自适应乘性方差膨胀（adaptive multiplicative inflation）。你将通过最大化新息（innovations）的对数似然函数来推导一个最优膨胀因子，为滤波器调优提供一个坚实的统计学基础。[@problem_id:3379826]", "problem": "考虑一个线性高斯数据同化周期，其状态空间模型包含观测算子 $H \\in \\mathbb{R}^{m \\times n}$，集合预报均值 $\\bar{x}^f \\in \\mathbb{R}^n$ 和观测值 $y \\in \\mathbb{R}^m$。观测误差协方差为 $R \\in \\mathbb{R}^{m \\times m}$，是一个对称正定矩阵。将新息表示为 $v = y - H \\bar{x}^f$，白化新息表示为 $z = R^{-1/2} v$。令 $P^f \\in \\mathbb{R}^{n \\times n}$ 表示由集合所代表的预报误差协方差。在集合变换卡尔曼滤波（Ensemble Transform Kalman Filter, ETKF）中，一个乘性膨胀因子 $\\alpha  0$ 在分析前对预报协方差进行缩放，$P^f \\mapsto \\alpha P^f$，这等效于在观测空间中对其投影进行缩放。\n\n假设在此周期中，观测空间中的白化预报-观测协方差是各向同性的，即\n$$\nA \\equiv R^{-1/2} H P^f H^{\\top} R^{-1/2} = c I_m,\n$$\n其中 $c  0$ 为已知标量，$I_m$ 为单位矩阵。在乘性膨胀 $\\alpha$ 下，预测的白化新息协方差为\n$$\nS(\\alpha) = I_m + \\alpha A = \\left(1 + \\alpha c\\right) I_m.\n$$\n将白化新息 $z$ 视为均值为 $0$、协方差为 $S(\\alpha)$ 的高斯变量，并考虑高斯对数似然\n$$\n\\ell(\\alpha \\, ; \\, z) = -\\tfrac{1}{2}\\Big( m \\ln(2\\pi) + \\ln \\det S(\\alpha) + z^{\\top} S(\\alpha)^{-1} z \\Big).\n$$\n通过在上述高斯模型下最大化新息 $z$ 的期望对数似然，设计一个自适应的乘性膨胀 $\\alpha$，并推导出一个与 ETKF 变换兼容的 $\\alpha$ 的闭式更新（即，它确保在 ETKF 分析步骤中需要开平方根的对称矩阵保持正定）。然后，对以下具体实例进行该更新的数值评估：\n- 观测维度 $m = 3$。\n- 观测误差协方差 $R = \\mathrm{diag}(1, 4, 9)$。\n- 新息 $v = \\begin{pmatrix} 1.0 \\\\ 2.0 \\\\ 5.020 \\end{pmatrix}$。\n- 各向同性水平 $c = \\tfrac{1}{2}$，因此 $A = \\tfrac{1}{2} I_3$。\n\n此外，通过验证解处的对数似然二阶导数为负，并且 ETKF 变换保持实值，来检验最大化器的稳定性。仅报告此实例中膨胀因子 $\\alpha$ 的数值。将答案四舍五入至三位有效数字。膨胀因子是无量纲的；最终答案中不要包含单位。", "solution": "该问题被评估为有效。它在科学上基于数据同化和集合变换卡尔曼滤波（ETKF）的理论，数学上是适定的、客观的且自洽的。通过最大化似然函数来推导自适应膨胀因子是统计估计中的标准程序。所有必要的数据和定义都已提供。\n\n目标是找到乘性膨胀因子 $\\alpha  0$，以最大化给定白化新息 $z$ 的高斯对数似然 $\\ell(\\alpha \\, ; \\, z)$。对数似然函数由下式给出：\n$$\n\\ell(\\alpha \\, ; \\, z) = -\\frac{1}{2}\\Big( m \\ln(2\\pi) + \\ln \\det S(\\alpha) + z^{\\top} S(\\alpha)^{-1} z \\Big)\n$$\n在白化预报-观测协方差 $A = c I_m$ 是各向同性的假设下，问题指定了预测的白化新息协方差 $S(\\alpha)$ 的结构：\n$$\nS(\\alpha) = I_m + \\alpha A = I_m + \\alpha (c I_m) = (1 + \\alpha c) I_m\n$$\n其中 $I_m$ 是 $m \\times m$ 的单位矩阵。\n\n现在我们可以将对数似然中的各项表示为 $\\alpha$ 的函数。\n行列式项为：\n$$\n\\ln \\det S(\\alpha) = \\ln \\det((1 + \\alpha c) I_m) = \\ln((1 + \\alpha c)^m) = m \\ln(1 + \\alpha c)\n$$\n$S(\\alpha)$ 的逆矩阵是：\n$$\nS(\\alpha)^{-1} = ((1 + \\alpha c) I_m)^{-1} = \\frac{1}{1 + \\alpha c} I_m\n$$\n对数似然中的二次型变为：\n$$\nz^{\\top} S(\\alpha)^{-1} z = z^{\\top} \\left(\\frac{1}{1 + \\alpha c} I_m\\right) z = \\frac{1}{1 + \\alpha c} z^{\\top}z\n$$\n将这些代入对数似然表达式，我们得到 $\\ell$ 作为 $\\alpha$ 的函数：\n$$\n\\ell(\\alpha) = -\\frac{1}{2}\\left( m \\ln(2\\pi) + m \\ln(1 + \\alpha c) + \\frac{z^{\\top}z}{1 + \\alpha c} \\right)\n$$\n为了最大化 $\\ell(\\alpha)$，我们对其关于 $\\alpha$ 求导并令其为零。为使最大化有意义，我们必须有 $1+\\alpha c  0$。给定 $\\alpha0$ 和 $c0$，此条件得到满足。\n$$\n\\frac{d\\ell}{d\\alpha} = -\\frac{1}{2} \\left( m \\frac{c}{1 + \\alpha c} - \\frac{c(z^{\\top}z)}{(1 + \\alpha c)^2} \\right)\n$$\n将导数设为零：\n$$\n-\\frac{1}{2} \\left( \\frac{mc}{1 + \\alpha c} - \\frac{c(z^{\\top}z)}{(1 + \\alpha c)^2} \\right) = 0\n$$\n由于 $c  0$，我们可以简化：\n$$\n\\frac{m}{1 + \\alpha c} = \\frac{z^{\\top}z}{(1 + \\alpha c)^2}\n$$\n两边同乘以 $(1 + \\alpha c)^2$（非零）得到：\n$$\nm(1 + \\alpha c) = z^{\\top}z\n$$\n解出 $\\alpha$：\n$$\n1 + \\alpha c = \\frac{z^{\\top}z}{m}\n$$\n$$\n\\alpha c = \\frac{z^{\\top}z}{m} - 1\n$$\n$$\n\\alpha = \\frac{1}{c} \\left( \\frac{z^{\\top}z}{m} - 1 \\right)\n$$\n这就是通过最大化对数似然推导出的 $\\alpha$ 的闭式更新。\n\n我们必须通过检查二阶导数来验证此解的稳定性。\n$$\n\\frac{d^2\\ell}{d\\alpha^2} = -\\frac{1}{2} \\frac{d}{d\\alpha} \\left( \\frac{mc}{1 + \\alpha c} - \\frac{c(z^{\\top}z)}{(1 + \\alpha c)^2} \\right) = -\\frac{1}{2} \\left( -\\frac{mc^2}{(1 + \\alpha c)^2} + \\frac{2c^2(z^{\\top}z)}{(1 + \\alpha c)^3} \\right)\n$$\n$$\n\\frac{d^2\\ell}{d\\alpha^2} = \\frac{c^2}{2(1 + \\alpha c)^3} \\left( m(1 + \\alpha c) - 2z^{\\top}z \\right)\n$$\n在解点处，我们有 $m(1 + \\alpha c) = z^{\\top}z$。将此代入二阶导数：\n$$\n\\frac{d^2\\ell}{d\\alpha^2}\\Big|_{\\alpha=\\alpha^*} = \\frac{c^2}{2(1 + \\alpha^* c)^3} \\left( z^{\\top}z - 2z^{\\top}z \\right) = -\\frac{c^2 z^{\\top}z}{2(1 + \\alpha^* c)^3}\n$$\n在解处，我们还有 $1 + \\alpha^* c = z^{\\top}z/m$。对于任何非零新息向量 $z$，$z^{\\top}z  0$，这意味着 $1 + \\alpha^* c  0$。由于 $c  0$，我们有 $c^2  0$。因此，二阶导数为负，证实该解确实是一个局部最大值。\n\n如果需要开平方根的矩阵 $(I_m + \\alpha A)^{-1/2}$ 是实数，则推导出的更新与 ETKF 变换兼容。这要求 $I_m + \\alpha A$ 是正定的。在本例中，$I_m + \\alpha A = (1+\\alpha c)I_m$，如果 $1+\\alpha c  0$，它就是正定的。在我们的解中，$1+\\alpha c = z^{\\top}z/m$。由于 $z$ 是一个实向量，$z^{\\top}z \\ge 0$。只要 $z$ 不是零向量，$z^{\\top}z  0$，该条件就满足。\n问题还指定了 $\\alpha0$。根据我们的公式，这要求 $\\frac{z^{\\top}z}{m} - 1  0$，或 $z^{\\top}z  m$。这意味着只有当观测到的白化新息方差（由 $z^{\\top}z$ 代表）超过其在无膨胀模型下的期望值（$\\mathbb{E}[z^{\\top}z] = \\text{tr}(I_m) = m$）时，才应用膨胀。\n\n现在，我们对给定的数值实例评估此更新：\n- $m = 3$\n- $R = \\mathrm{diag}(1, 4, 9)$\n- $v = \\begin{pmatrix} 1.0 \\\\ 2.0 \\\\ 5.020 \\end{pmatrix}$\n- $c = \\frac{1}{2}$\n\n首先，我们计算白化新息 $z = R^{-1/2} v$。矩阵 $R^{-1/2}$ 是一个对角矩阵，其对角线元素是 $R$ 对应元素平方根的倒数：\n$$\nR^{1/2} = \\mathrm{diag}(\\sqrt{1}, \\sqrt{4}, \\sqrt{9}) = \\mathrm{diag}(1, 2, 3)\n$$\n$$\nR^{-1/2} = \\mathrm{diag}(1^{-1}, 2^{-1}, 3^{-1}) = \\mathrm{diag}(1, \\tfrac{1}{2}, \\tfrac{1}{3}) = \\begin{pmatrix} 1  0  0 \\\\ 0  \\frac{1}{2}  0 \\\\ 0  0  \\frac{1}{3} \\end{pmatrix}\n$$\n现在我们计算 $z$：\n$$\nz = R^{-1/2} v = \\begin{pmatrix} 1  0  0 \\\\ 0  \\frac{1}{2}  0 \\\\ 0  0  \\frac{1}{3} \\end{pmatrix} \\begin{pmatrix} 1.0 \\\\ 2.0 \\\\ 5.020 \\end{pmatrix} = \\begin{pmatrix} 1.0 \\times 1 \\\\ 2.0 \\times \\frac{1}{2} \\\\ 5.020 \\times \\frac{1}{3} \\end{pmatrix} = \\begin{pmatrix} 1.0 \\\\ 1.0 \\\\ \\frac{5.020}{3} \\end{pmatrix}\n$$\n接下来，我们计算平方范数 $z^{\\top}z$：\n$$\nz^{\\top}z = (1.0)^2 + (1.0)^2 + \\left(\\frac{5.020}{3}\\right)^2 = 1.0 + 1.0 + \\frac{25.2004}{9} = 2.0 + \\frac{25.2004}{9}\n$$\n$$\nz^{\\top}z = \\frac{18.0}{9} + \\frac{25.2004}{9} = \\frac{43.2004}{9}\n$$\n其值约为 $z^{\\top}z \\approx 4.800044...$\n\n现在我们将 $m$、$c$ 和 $z^{\\top}z$ 的值代入 $\\alpha$ 的公式中：\n$$\n\\alpha = \\frac{1}{c} \\left( \\frac{z^{\\top}z}{m} - 1 \\right) = \\frac{1}{1/2} \\left( \\frac{43.2004/9}{3} - 1 \\right)\n$$\n$$\n\\alpha = 2 \\left( \\frac{43.2004}{27} - 1 \\right) = 2 \\left( \\frac{43.2004 - 27}{27} \\right) = 2 \\left( \\frac{16.2004}{27} \\right)\n$$\n$$\n\\alpha = \\frac{32.4008}{27} \\approx 1.2000296...\n$$\n条件 $\\alpha  0$ 得到满足，因为 $z^{\\top}z \\approx 4.8  m=3$。\n将答案四舍五入到三位有效数字，我们得到 $1.20$。", "answer": "$$\\boxed{1.20}$$", "id": "3379826"}, {"introduction": "对于像天气预报这样的大尺度空间系统，局部化（localization）是应用集合变换卡尔曼滤波器的必要工具。本练习将通过一个简单的一维网格系统，让你从第一性原理出发，构建一个局部观测算子，从而揭开局部化的神秘面纱。你将把局部化半径这一物理概念与集合变换卡尔曼滤波器（ETKF）的变换矩阵的数学构造直接联系起来，揭示局部信息是如何被同化的。[@problem_id:3379789]", "problem": "考虑集成变换卡尔曼滤波器 (ETKF)，它是在集成子空间中对卡尔曼滤波器更新的一种平方根实现。给定一个一维网格，由位于 $x = -\\Delta$、$x = 0$ 和 $x = \\Delta$ 的三个等间距点组成。一个单一标量观测位于 $x = 0$ 处，该仪器的足迹为高斯分布，局地化半径为 $r$，因此只有最近邻的点有贡献。有效的局地观测算子 $H_{\\text{loc}}$ 通过对这三个网格点进行归一化高斯加权，将状态 $x \\in \\mathbb{R}^{3}$ 映射到观测：\n$$\nw_{-} = \\exp\\!\\left(-\\frac{\\Delta^{2}}{2 r^{2}}\\right), \\quad w_{0} = \\exp(0) = 1, \\quad w_{+} = \\exp\\!\\left(-\\frac{\\Delta^{2}}{2 r^{2}}\\right),\n$$\n且\n$$\nH_{\\text{loc}} = \\frac{1}{w_{0} + w_{-} + w_{+}}\\begin{pmatrix} w_{-}  w_{0}  w_{+} \\end{pmatrix}.\n$$\n你有一个由 $N = 3$ 个预报成员组成的集合。设 $X^{f} \\in \\mathbb{R}^{3 \\times 3}$ 表示预报扰动（其列向量之和为零向量），ETKF 使用的缩放扰动矩阵为 $A^{f} = X^{f}/\\sqrt{N-1}$。观测误差协方差是标量 $R = \\sigma^{2}$。假设预报扰动为\n$$\nX^{f} = \\begin{pmatrix}\n1  -1  0 \\\\\n0  1  -1 \\\\\n-1  0  1\n\\end{pmatrix}.\n$$\n从卡尔曼滤波器的第一性原理和集成变换的定义出发，完成以下任务：\n\n1. 推导 $H_{\\text{loc}}$ 对局地化半径 $r$ 和网格间距 $\\Delta$ 的显式依赖关系。\n2. 计算观测空间中的局地投影集成扰动，\n$$\nY^{f} = H_{\\text{loc}}\\,A^{f} \\in \\mathbb{R}^{1 \\times 3}.\n$$\n3. 推导集成空间中的对称 ETKF 变换 $T \\in \\mathbb{R}^{3 \\times 3}$，该变换将预报扰动映射到分析扰动。推导过程需强制使集成子空间中的分析协方差与给定单一观测和误差协方差 $R$ 条件下的卡尔曼后验协方差相匹配。\n\n你的最终答案必须是变换矩阵 $T$ 的行列式关于 $r$、$\\Delta$ 和 $\\sigma$ 的单一闭式解析表达式。无需四舍五入。最终答案以无单位形式表示。", "solution": "首先验证问题，以确保其具有科学依据、提法明确且客观。\n\n**步骤 1：提取已知条件**\n- 网格点：$x = -\\Delta$，$x = 0$，$x = \\Delta$。\n- 状态向量：$x \\in \\mathbb{R}^{3}$。\n- 位于 $x=0$ 的单一标量观测。\n- 局地化半径为 $r$ 的高斯足迹。\n- 局地观测算子的权重：$w_{-} = \\exp(-\\frac{\\Delta^{2}}{2 r^{2}})$，$w_{0} = 1$，$w_{+} = \\exp(-\\frac{\\Delta^{2}}{2 r^{2}})$。\n- 局地观测算子：$H_{\\text{loc}} = \\frac{1}{w_{0} + w_{-} + w_{+}}\\begin{pmatrix} w_{-}  w_{0}  w_{+} \\end{pmatrix}$。\n- 集合大小：$N = 3$。\n- 预报扰动矩阵：$X^{f} \\in \\mathbb{R}^{3 \\times 3}$，$X^{f} = \\begin{pmatrix} 1  -1  0 \\\\ 0  1  -1 \\\\ -1  0  1 \\end{pmatrix}$。\n- 缩放预报扰动矩阵：$A^{f} = X^{f}/\\sqrt{N-1}$。\n- 观测误差协方差：$R = \\sigma^{2}$。\n- 任务：推导对称集成变换卡尔曼滤波器 (ETKF) 变换矩阵 T 并求其行列式 $\\det(T)$。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据：** 该问题使用了数据同化领域的标准定义和概念，特别是带局地化的 ETKF。其数学设定与既有文献一致。\n- **提法明确：** 提供了所有必要信息。集合成员数 ($N=3$) 等于状态维数，并且扰动矩阵 $X^f$ 被正确指定，其列向量之和为零向量，这是扰动矩阵的一个要求。问题要求一个具体的、可推导的量。\n- **客观性：** 问题使用精确的数学语言陈述，没有歧义或主观因素。\n\n**步骤 3：结论与行动**\n问题有效。将提供完整解答。\n\n**解题推导**\n\n解题过程按题目要求分为三个部分。\n\n**1. $H_{\\text{loc}}$ 的显式形式**\n\n局地观测算子 $H_{\\text{loc}}$ 由一组归一化权重定义。我们定义非中心点的共同权重为\n$$w = w_{-} = w_{+} = \\exp\\left(-\\frac{\\Delta^{2}}{2 r^{2}}\\right)。$$\n中心权重为 $w_{0} = 1$。权重之和作为归一化因子，其值为\n$$S = w_{0} + w_{-} + w_{+} = 1 + 2w = 1 + 2\\exp\\left(-\\frac{\\Delta^{2}}{2 r^{2}}\\right)。$$\n因此，局地观测算子 $H_{\\text{loc}} \\in \\mathbb{R}^{1 \\times 3}$ 的显式形式为：\n$$H_{\\text{loc}} = \\frac{1}{S} \\begin{pmatrix} w  1  w \\end{pmatrix} = \\frac{1}{1 + 2\\exp\\left(-\\frac{\\Delta^{2}}{2 r^{2}}\\right)} \\begin{pmatrix} \\exp\\left(-\\frac{\\Delta^{2}}{2 r^{2}}\\right)  1  \\exp\\left(-\\frac{\\Delta^{2}}{2 r^{2}}\\right) \\end{pmatrix}。$$\n\n**2. 投影集成扰动 $Y^{f}$ 的计算**\n\n首先，我们计算缩放预报扰动矩阵 $A^{f}$。给定集合大小 $N=3$，缩放因子为 $1/\\sqrt{N-1} = 1/\\sqrt{2}$。\n$$A^{f} = \\frac{X^{f}}{\\sqrt{N-1}} = \\frac{1}{\\sqrt{2}} \\begin{pmatrix} 1  -1  0 \\\\ 0  1  -1 \\\\ -1  0  1 \\end{pmatrix}。$$\n接下来，我们使用 $H_{\\text{loc}}$ 将这些缩放扰动投影到观测空间，得到 $Y^{f} = H_{\\text{loc}} A^{f} \\in \\mathbb{R}^{1 \\times 3}$。\n$$Y^{f} = \\frac{1}{S\\sqrt{2}} \\begin{pmatrix} w  1  w \\end{pmatrix} \\begin{pmatrix} 1  -1  0 \\\\ 0  1  -1 \\\\ -1  0  1 \\end{pmatrix}。$$\n执行矩阵乘法：\n$$Y^{f} = \\frac{1}{S\\sqrt{2}} \\begin{pmatrix} (w)(1) + (1)(0) + (w)(-1)  (w)(-1) + (1)(1) + (w)(0)  (w)(0) + (1)(-1) + (w)(1) \\end{pmatrix}$$\n$$Y^{f} = \\frac{1}{S\\sqrt{2}} \\begin{pmatrix} 0  1-w  w-1 \\end{pmatrix}。$$\n\n**3. 变换矩阵 $T$ 及其行列式的推导**\n\nETKF 通过集成空间中的线性变换将缩放预报扰动 $A^{f}$ 更新为缩放分析扰动 $A^{a}$：$A^{a} = A^{f} T$。选择对称变换矩阵 $T \\in \\mathbb{R}^{3 \\times 3}$，使得分析协方差 $P^{a} = A^{a}(A^{a})^{T}$ 与理论卡尔曼后验协方差相匹配。\n\n集成空间中的分析误差协方差，记为 $P^{a}_{\\text{ens}}$，由以下公式给出：\n$$P^{a}_{\\text{ens}} = \\left( I + (Y^{f})^{T} R^{-1} Y^{f} \\right)^{-1},$$\n其中 $I$ 是 $N \\times N$ 的单位矩阵（此处为 $3 \\times 3$）。对称变换矩阵 $T$ 是 $P^{a}_{\\text{ens}}$ 的主平方根：\n$$T = (P^{a}_{\\text{ens}})^{1/2} = \\left( I + (Y^{f})^{T} R^{-1} Y^{f} \\right)^{-1/2}。$$\n我们的目标是求 $\\det(T)$。利用性质 $\\det(M^{a}) = (\\det(M))^{a}$：\n$$\\det(T) = \\det\\left( \\left( I + (Y^{f})^{T} R^{-1} Y^{f} \\right)^{-1/2} \\right) = \\left( \\det\\left(I + (Y^{f})^{T} R^{-1} Y^{f} \\right) \\right)^{-1/2}。$$\n让我们计算矩阵 $M = (Y^{f})^{T} R^{-1} Y^{f}$。观测误差协方差为 $R=\\sigma^2$，所以其逆为 $R^{-1} = 1/\\sigma^2$。\n$$(Y^{f})^{T} = \\frac{1}{S\\sqrt{2}} \\begin{pmatrix} 0 \\\\ 1-w \\\\ w-1 \\end{pmatrix}。$$\n$$M = \\left( \\frac{1}{S\\sqrt{2}} \\begin{pmatrix} 0 \\\\ 1-w \\\\ w-1 \\end{pmatrix} \\right) \\left( \\frac{1}{\\sigma^2} \\right) \\left( \\frac{1}{S\\sqrt{2}} \\begin{pmatrix} 0  1-w  w-1 \\end{pmatrix} \\right)$$\n$$M = \\frac{1}{2S^2\\sigma^2} \\begin{pmatrix} 0 \\\\ 1-w \\\\ w-1 \\end{pmatrix} \\begin{pmatrix} 0  1-w  w-1 \\end{pmatrix} = \\frac{1}{2S^2\\sigma^2} \\begin{pmatrix} 0  0  0 \\\\ 0  (1-w)^2  -(1-w)^2 \\\\ 0  -(1-w)^2  (1-w)^2 \\end{pmatrix}。$$\n我们定义一个标量常数 $\\alpha$ 来简化表示：\n$$\\alpha = \\frac{(1-w)^2}{2S^2\\sigma^2}。$$\n矩阵 $M$ 可以写成：\n$$M = \\alpha \\begin{pmatrix} 0  0  0 \\\\ 0  1  -1 \\\\ 0  -1  1 \\end{pmatrix}。$$\n现在我们计算 $I+M$ 的行列式：\n$$I+M = \\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  1 \\end{pmatrix} + \\begin{pmatrix} 0  0  0 \\\\ 0  \\alpha  -\\alpha \\\\ 0  -\\alpha  \\alpha \\end{pmatrix} = \\begin{pmatrix} 1  0  0 \\\\ 0  1+\\alpha  -\\alpha \\\\ 0  -\\alpha  1+\\alpha \\end{pmatrix}。$$\n$$\\det(I+M) = 1 \\cdot \\det\\begin{pmatrix} 1+\\alpha  -\\alpha \\\\ -\\alpha  1+\\alpha \\end{pmatrix} - 0 + 0 = (1+\\alpha)^2 - (-\\alpha)^2 = 1+2\\alpha+\\alpha^2-\\alpha^2 = 1+2\\alpha。$$\n现在我们求 $\\det(T)$：\n$$\\det(T) = (1+2\\alpha)^{-1/2}。$$\n代入 $\\alpha$ 的表达式：\n$$1+2\\alpha = 1 + 2\\left(\\frac{(1-w)^2}{2S^2\\sigma^2}\\right) = 1 + \\frac{(1-w)^2}{S^2\\sigma^2}。$$\n最后，我们用问题参数 $r$、$\\Delta$ 和 $\\sigma$ 代入 $w$ 和 $S$ 的表达式：\n$$w = \\exp\\left(-\\frac{\\Delta^{2}}{2r^{2}}\\right)$$\n$$S = 1+2w = 1+2\\exp\\left(-\\frac{\\Delta^{2}}{2r^{2}}\\right)$$\n变换矩阵 $T$ 的行列式为：\n$$\\det(T) = \\left( 1 + \\frac{\\left(1-\\exp\\left(-\\frac{\\Delta^{2}}{2r^{2}}\\right)\\right)^2}{\\left(1+2\\exp\\left(-\\frac{\\Delta^{2}}{2r^{2}}\\right)\\right)^2 \\sigma^2} \\right)^{-1/2}。$$\n这就是所求的 $T$ 的行列式的闭式解析表达式。", "answer": "$$\n\\boxed{\\left( 1 + \\frac{\\left(1-\\exp\\left(-\\frac{\\Delta^{2}}{2r^{2}}\\right)\\right)^{2}}{\\left(1+2\\exp\\left(-\\frac{\\Delta^{2}}{2r^{2}}\\right)\\right)^{2} \\sigma^{2}} \\right)^{-1/2}}\n$$", "id": "3379789"}]}