{"hands_on_practices": [{"introduction": "要真正理解集合卡尔曼滤波器 (EnKF)，最好的方法莫过于亲手完成一次完整的分析更新步骤。这个练习将通过一个低维度的具体示例，指导你完成从计算集合统计量到更新每个集合成员的全过程。通过这个实践 [@problem_id:3380063]，你将对 EnKF 如何融合观测信息以减少不确定性获得一个具体而深入的认识。", "problem": "考虑一个线性数据同化设置，其状态维数为 $n=2$，观测维数为 $p=1$。观测算子为 $H = [\\,1\\;\\;1\\,]$，观测误差协方差为 $R = 0.25$。在当前同化时刻，有一个标量观测 $y$ 可用，并使用一个大小为 $N=3$ 的集合。先验（预报）集合状态明确由以下给出\n$$\nx_{1}^{f}=\\begin{pmatrix}0\\\\ 1\\end{pmatrix},\\quad\nx_{2}^{f}=\\begin{pmatrix}1\\\\ 0\\end{pmatrix},\\quad\nx_{3}^{f}=\\begin{pmatrix}2\\\\ 1\\end{pmatrix}.\n$$\n假设观测值为 $y=2$。使用带扰动观测的随机集合卡尔曼滤波器（EnKF），其中三个独立的观测扰动固定为 $\\epsilon_{1}=0$、$\\epsilon_{2}=1/2$ 和 $\\epsilon_{3}=-1/2$。也就是说，每个集合成员使用 $y+\\epsilon_{i}$ 进行更新。\n\n仅使用集合平均和样本协方差的基本定义，以及卡尔曼滤波器底层的标准线性高斯贝叶斯更新结构，执行一个 EnKF 分析步骤：\n- 从先验集合构建有限样本预报协方差。\n- 使用线性观测算子和有限样本预报协方差构成卡尔曼增益。\n- 用其扰动观测更新每个集合成员。\n\n然后计算：\n1) 分析集合平均向量，以及\n2) 定义为如下的标量分析离散度\n$$\ns \\equiv \\sqrt{\\frac{1}{N}\\sum_{i=1}^{N}\\left\\|x_{i}^{a}-\\bar{x}^{a}\\right\\|^{2}},\n$$\n其中 $x_{i}^{a}$ 是分析集合成员，$\\bar{x}^{a}$ 是它们的欧几里得平均，$\\|\\cdot\\|$ 是欧几里得范数。\n\n以包含三个条目的行的形式报告您的最终答案，依次为分析平均向量的两个分量和标量离散度。无需四舍五入。", "solution": "问题陈述为标准的随机集合卡尔曼滤波器（EnKF）分析步骤提供了一个完整且一致的设置。它具有科学依据，是适定的、客观的。计算所需量所必需的所有数据和定义均已提供。因此，该问题是有效的，我将继续进行求解。\n\n问题要求执行随机 EnKF 的单个分析步骤。给定的参数如下：\n状态维数 $n=2$。\n观测维数 $p=1$。\n集合大小 $N=3$。\n观测算子 $H = [\\,1\\;\\;1\\,]$。\n观测误差协方差 $R = 0.25 = \\frac{1}{4}$。\n观测值 $y=2$。\n观测扰动 $\\epsilon_{1}=0$，$\\epsilon_{2}=\\frac{1}{2}$，$\\epsilon_{3}=-\\frac{1}{2}$。\n先验（预报）集合成员为：\n$$\nx_{1}^{f}=\\begin{pmatrix}0\\\\ 1\\end{pmatrix},\\quad\nx_{2}^{f}=\\begin{pmatrix}1\\\\ 0\\end{pmatrix},\\quad\nx_{3}^{f}=\\begin{pmatrix}2\\\\ 1\\end{pmatrix}.\n$$\n\n该过程按要求包括三个主要阶段：构建预报统计量、计算卡尔曼增益以及更新集合成员。\n\n首先，我们通过计算预报集合成员的平均值来计算预报集合平均 $\\bar{x}^{f}$：\n$$\n\\bar{x}^{f} = \\frac{1}{N}\\sum_{i=1}^{N}x_{i}^{f} = \\frac{1}{3}\\left(\\begin{pmatrix}0\\\\ 1\\end{pmatrix} + \\begin{pmatrix}1\\\\ 0\\end{pmatrix} + \\begin{pmatrix}2\\\\ 1\\end{pmatrix}\\right) = \\frac{1}{3}\\begin{pmatrix}0+1+2\\\\ 1+0+1\\end{pmatrix} = \\frac{1}{3}\\begin{pmatrix}3\\\\ 2\\end{pmatrix} = \\begin{pmatrix}1\\\\ \\frac{2}{3}\\end{pmatrix}.\n$$\n\n接下来，我们构建有限样本预报协方差矩阵 $P^f$。这是预报集合的样本协方差：\n$$\nP^f = \\frac{1}{N-1}\\sum_{i=1}^{N}(x_{i}^{f}-\\bar{x}^{f})(x_{i}^{f}-\\bar{x}^{f})^T.\n$$\n我们首先计算预报扰动向量 $x_i'^f = x_i^f - \\bar{x}^f$：\n$$\nx_1'^f = \\begin{pmatrix}0\\\\ 1\\end{pmatrix} - \\begin{pmatrix}1\\\\ \\frac{2}{3}\\end{pmatrix} = \\begin{pmatrix}-1\\\\ \\frac{1}{3}\\end{pmatrix}\n$$\n$$\nx_2'^f = \\begin{pmatrix}1\\\\ 0\\end{pmatrix} - \\begin{pmatrix}1\\\\ \\frac{2}{3}\\end{pmatrix} = \\begin{pmatrix}0\\\\ -\\frac{2}{3}\\end{pmatrix}\n$$\n$$\nx_3'^f = \\begin{pmatrix}2\\\\ 1\\end{pmatrix} - \\begin{pmatrix}1\\\\ \\frac{2}{3}\\end{pmatrix} = \\begin{pmatrix}1\\\\ \\frac{1}{3}\\end{pmatrix}\n$$\n现在，我们计算 $P^f$：\n$$\nP^f = \\frac{1}{3-1}\\left[ \\begin{pmatrix}-1\\\\ \\frac{1}{3}\\end{pmatrix}\\begin{pmatrix}-1  \\frac{1}{3}\\end{pmatrix} + \\begin{pmatrix}0\\\\ -\\frac{2}{3}\\end{pmatrix}\\begin{pmatrix}0  -\\frac{2}{3}\\end{pmatrix} + \\begin{pmatrix}1\\\\ \\frac{1}{3}\\end{pmatrix}\\begin{pmatrix}1  \\frac{1}{3}\\end{pmatrix} \\right]\n$$\n$$\nP^f = \\frac{1}{2}\\left[ \\begin{pmatrix}1  -\\frac{1}{3}\\\\ -\\frac{1}{3}  \\frac{1}{9}\\end{pmatrix} + \\begin{pmatrix}0  0\\\\ 0  \\frac{4}{9}\\end{pmatrix} + \\begin{pmatrix}1  \\frac{1}{3}\\\\ \\frac{1}{3}  \\frac{1}{9}\\end{pmatrix} \\right] = \\frac{1}{2}\\begin{pmatrix}2  0\\\\ 0  \\frac{6}{9}\\end{pmatrix} = \\frac{1}{2}\\begin{pmatrix}2  0\\\\ 0  \\frac{2}{3}\\end{pmatrix} = \\begin{pmatrix}1  0\\\\ 0  \\frac{1}{3}\\end{pmatrix}.\n$$\n\n第二，我们使用标准公式构成卡尔曼增益 $K$：\n$$\nK = P^f H^T (H P^f H^T + R)^{-1}.\n$$\n对于 $H = [\\,1\\;\\;1\\,]$，我们有 $H^T = \\begin{pmatrix}1\\\\ 1\\end{pmatrix}$。\n各项计算如下：\n$$\nP^f H^T = \\begin{pmatrix}1  0\\\\ 0  \\frac{1}{3}\\end{pmatrix}\\begin{pmatrix}1\\\\ 1\\end{pmatrix} = \\begin{pmatrix}1\\\\ \\frac{1}{3}\\end{pmatrix}.\n$$\n$$\nH P^f H^T = [\\,1\\;\\;1\\,]\\begin{pmatrix}1\\\\ \\frac{1}{3}\\end{pmatrix} = 1 + \\frac{1}{3} = \\frac{4}{3}.\n$$\n分母项是一个标量：\n$$\nH P^f H^T + R = \\frac{4}{3} + \\frac{1}{4} = \\frac{16+3}{12} = \\frac{19}{12}.\n$$\n其逆为 $(H P^f H^T + R)^{-1} = \\frac{12}{19}$。\n因此，卡尔曼增益为：\n$$\nK = \\begin{pmatrix}1\\\\ \\frac{1}{3}\\end{pmatrix}\\left(\\frac{12}{19}\\right) = \\begin{pmatrix}\\frac{12}{19}\\\\ \\frac{4}{19}\\end{pmatrix}.\n$$\n\n第三，我们使用各自的扰动观测 $y_i = y + \\epsilon_i$ 更新每个集合成员。更新方程为：\n$$\nx_i^a = x_i^f + K (y_i - H x_i^f).\n$$\n扰动观测为 $y_1 = 2+0=2$，$y_2 = 2+\\frac{1}{2}=\\frac{5}{2}$ 和 $y_3=2-\\frac{1}{2}=\\frac{3}{2}$。\n我们为每个成员计算投影的预报 $H x_i^f$：\n$H x_1^f = [\\,1\\;\\;1\\,]\\begin{pmatrix}0\\\\ 1\\end{pmatrix} = 1$。\n$H x_2^f = [\\,1\\;\\;1\\,]\\begin{pmatrix}1\\\\ 0\\end{pmatrix} = 1$。\n$H x_3^f = [\\,1\\;\\;1\\,]\\begin{pmatrix}2\\\\ 1\\end{pmatrix} = 3$。\n\n现在我们更新每个成员：\n对于 $i=1$： $x_1^a = \\begin{pmatrix}0\\\\ 1\\end{pmatrix} + \\begin{pmatrix}\\frac{12}{19}\\\\ \\frac{4}{19}\\end{pmatrix}(2-1) = \\begin{pmatrix}0\\\\ 1\\end{pmatrix} + \\begin{pmatrix}\\frac{12}{19}\\\\ \\frac{4}{19}\\end{pmatrix} = \\begin{pmatrix}\\frac{12}{19}\\\\ \\frac{23}{19}\\end{pmatrix}$。\n对于 $i=2$： $x_2^a = \\begin{pmatrix}1\\\\ 0\\end{pmatrix} + \\begin{pmatrix}\\frac{12}{19}\\\\ \\frac{4}{19}\\end{pmatrix}(\\frac{5}{2}-1) = \\begin{pmatrix}1\\\\ 0\\end{pmatrix} + \\begin{pmatrix}\\frac{12}{19}\\\\ \\frac{4}{19}\\end{pmatrix}(\\frac{3}{2}) = \\begin{pmatrix}1\\\\ 0\\end{pmatrix} + \\begin{pmatrix}\\frac{18}{19}\\\\ \\frac{6}{19}\\end{pmatrix} = \\begin{pmatrix}\\frac{37}{19}\\\\ \\frac{6}{19}\\end{pmatrix}$。\n对于 $i=3$： $x_3^a = \\begin{pmatrix}2\\\\ 1\\end{pmatrix} + \\begin{pmatrix}\\frac{12}{19}\\\\ \\frac{4}{19}\\end{pmatrix}(\\frac{3}{2}-3) = \\begin{pmatrix}2\\\\ 1\\end{pmatrix} + \\begin{pmatrix}\\frac{12}{19}\\\\ \\frac{4}{19}\\end{pmatrix}(-\\frac{3}{2}) = \\begin{pmatrix}2\\\\ 1\\end{pmatrix} - \\begin{pmatrix}\\frac{18}{19}\\\\ \\frac{6}{19}\\end{pmatrix} = \\begin{pmatrix}\\frac{20}{19}\\\\ \\frac{13}{19}\\end{pmatrix}$。\n\n分析集合为 $x_{1}^{a}=\\begin{pmatrix}\\frac{12}{19}\\\\ \\frac{23}{19}\\end{pmatrix}$，$x_{2}^{a}=\\begin{pmatrix}\\frac{37}{19}\\\\ \\frac{6}{19}\\end{pmatrix}$，$x_{3}^{a}=\\begin{pmatrix}\\frac{20}{19}\\\\ \\frac{13}{19}\\end{pmatrix}$。\n\n利用分析集合，我们计算所需的两个量。\n1) 分析集合平均 $\\bar{x}^{a}$：\n$$\n\\bar{x}^{a} = \\frac{1}{3}\\left(\\begin{pmatrix}\\frac{12}{19}\\\\ \\frac{23}{19}\\end{pmatrix} + \\begin{pmatrix}\\frac{37}{19}\\\\ \\frac{6}{19}\\end{pmatrix} + \\begin{pmatrix}\\frac{20}{19}\\\\ \\frac{13}{19}\\end{pmatrix}\\right) = \\frac{1}{3}\\begin{pmatrix}\\frac{12+37+20}{19}\\\\ \\frac{23+6+13}{19}\\end{pmatrix} = \\frac{1}{3}\\begin{pmatrix}\\frac{69}{19}\\\\ \\frac{42}{19}\\end{pmatrix} = \\begin{pmatrix}\\frac{23}{19}\\\\ \\frac{14}{19}\\end{pmatrix}.\n$$\n\n2) 标量分析离散度 $s$，定义为 $s \\equiv \\sqrt{\\frac{1}{N}\\sum_{i=1}^{N}\\left\\|x_{i}^{a}-\\bar{x}^{a}\\right\\|^{2}}$。\n首先，我们找到分析扰动 $x_i'^a = x_i^a - \\bar{x}^a$：\n$x_1'^a = \\begin{pmatrix}\\frac{12}{19}\\\\ \\frac{23}{19}\\end{pmatrix} - \\begin{pmatrix}\\frac{23}{19}\\\\ \\frac{14}{19}\\end{pmatrix} = \\begin{pmatrix}-\\frac{11}{19}\\\\ \\frac{9}{19}\\end{pmatrix}$。\n$x_2'^a = \\begin{pmatrix}\\frac{37}{19}\\\\ \\frac{6}{19}\\end{pmatrix} - \\begin{pmatrix}\\frac{23}{19}\\\\ \\frac{14}{19}\\end{pmatrix} = \\begin{pmatrix}\\frac{14}{19}\\\\ -\\frac{8}{19}\\end{pmatrix}$。\n$x_3'^a = \\begin{pmatrix}\\frac{20}{19}\\\\ \\frac{13}{19}\\end{pmatrix} - \\begin{pmatrix}\\frac{23}{19}\\\\ \\frac{14}{19}\\end{pmatrix} = \\begin{pmatrix}-\\frac{3}{19}\\\\ -\\frac{1}{19}\\end{pmatrix}$。\n接下来，我们计算每个扰动的欧几里得范数的平方：\n$\\|x_1'^a\\|^2 = (-\\frac{11}{19})^2 + (\\frac{9}{19})^2 = \\frac{121+81}{361} = \\frac{202}{361}$。\n$\\|x_2'^a\\|^2 = (\\frac{14}{19})^2 + (-\\frac{8}{19})^2 = \\frac{196+64}{361} = \\frac{260}{361}$。\n$\\|x_3'^a\\|^2 = (-\\frac{3}{19})^2 + (-\\frac{1}{19})^2 = \\frac{9+1}{361} = \\frac{10}{361}$。\n范数平方和为：\n$$\n\\sum_{i=1}^{3}\\left\\|x_{i}^{a}-\\bar{x}^{a}\\right\\|^{2} = \\frac{202+260+10}{361} = \\frac{472}{361}.\n$$\n最后，我们计算离散度 $s$：\n$$\ns = \\sqrt{\\frac{1}{3} \\cdot \\frac{472}{361}} = \\sqrt{\\frac{472}{1083}}.\n$$\n所需的三个值为 $\\bar{x}^{a}$ 的两个分量和离散度 $s$。\n$\\bar{x}^{a}$ 的分量 1： $\\frac{23}{19}$。\n$\\bar{x}^{a}$ 的分量 2： $\\frac{14}{19}$。\n标量离散度 $s$： $\\sqrt{\\frac{472}{1083}}$。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{23}{19} & \\frac{14}{19} & \\sqrt{\\frac{472}{1083}} \\end{pmatrix}}\n$$", "id": "3380063"}, {"introduction": "在处理高维系统（例如天气或海洋模型）时，集合方法的有效性面临着一个根本性的限制，即“秩亏损”问题。这个练习将引导你通过基本的线性代数原理，推导出集合协方差矩阵的最大可能秩。理解这一限制对于认识集合方法为何会产生虚假的长程相关性，以及为何需要协方差局地化等技术至关重要 [@problem_id:3380093]。", "problem": "考虑一个高维线性状态估计问题，其中模型状态由一个向量 $x \\in \\mathbb{R}^{n}$ 表示，不确定性通过一个由 $N$ 个模型状态组成的集合 $\\{x^{(i)}\\}_{i=1}^{N}$ 进行传播。集合均值 $\\bar{x}$ 是该集合的算术平均值，无偏样本协方差矩阵 $\\hat{C}$ 由集合相对于 $\\bar{x}$ 的距平（anomalies）构成。仅使用无偏样本协方差矩阵的核心定义以及关于矩阵乘积和子空间的秩的基本线性代数知识，确定 $\\hat{C}$ 作为 $n$ 和 $N$ 的函数的最大可能秩，然后对 $n=1000$ 和 $N=50$ 的情况进行求值。此外，简要论证在 $n \\gg N$ 的高维地球物理系统中，该秩界对于表示远程相关性的意义。\n\n最终数值答案以单个不带单位的整数形式给出。", "solution": "问题要求我们求出由模型状态集合推导出的无偏样本协方差矩阵 $\\hat{C}$ 的最大可能秩，并对一个具体案例计算该秩，然后讨论其意义。\n\n首先，我们来形式化给定的量。模型状态是一个向量 $x \\in \\mathbb{R}^{n}$。我们有一个由 $N$ 个这样的状态组成的集合，记为 $\\{x^{(i)}\\}_{i=1}^{N}$。状态空间的维度是 $n$，集合大小是 $N$。\n\n集合均值 $\\bar{x}$ 定义为集合成员的算术平均值：\n$$ \\bar{x} = \\frac{1}{N} \\sum_{i=1}^{N} x^{(i)} $$\n\n无偏样本协方差矩阵 $\\hat{C}$ 由集合距平构成。对于集合成员 $i$，其距平是它与集合均值的偏差，记为 $x'^{(i)} = x^{(i)} - \\bar{x}$。那么矩阵 $\\hat{C}$ 由下式给出：\n$$ \\hat{C} = \\frac{1}{N-1} \\sum_{i=1}^{N} (x^{(i)} - \\bar{x}) (x^{(i)} - \\bar{x})^T = \\frac{1}{N-1} \\sum_{i=1}^{N} x'^{(i)} (x'^{(i)})^T $$\n$\\hat{C}$ 是一个 $n \\times n$ 的矩阵。\n\n为了确定 $\\hat{C}$ 的秩，我们可以将求和表示为矩阵乘积。我们定义一个 $n \\times N$ 的矩阵 $A$，其列是集合的距平向量：\n$$ A = \\begin{pmatrix} x'^{(1)}  x'^{(2)}  \\cdots  x'^{(N)} \\end{pmatrix} $$\n根据这个定义，求和项可以写成矩阵乘积 $A A^T$：\n$$ \\sum_{i=1}^{N} x'^{(i)} (x'^{(i)})^T = A A^T $$\n因此，样本协方差矩阵为：\n$$ \\hat{C} = \\frac{1}{N-1} A A^T $$\n由于用一个非零标量（这里是 $\\frac{1}{N-1}$，假设 $N > 1$）乘以一个矩阵不会改变它的秩，我们有：\n$$ \\text{rank}(\\hat{C}) = \\text{rank}(A A^T) $$\n线性代数中的一个基本定理指出，对于任何实矩阵 $A$，$\\text{rank}(A A^T) = \\text{rank}(A^T A) = \\text{rank}(A) = \\text{rank}(A^T)$。因此，问题简化为求距平矩阵 $A$ 的最大可能秩。\n$$ \\text{rank}(\\hat{C}) = \\text{rank}(A) $$\n矩阵 $A$ 的维度是 $n \\times N$。任何矩阵的秩都不能超过其行数或列数。因此，$A$ 的秩的第一个界限是：\n$$ \\text{rank}(A) \\leq \\min(n, N) $$\n然而，对 $A$ 的列还有一个额外的约束。这些距平向量不是线性无关的。让我们计算一下 $A$ 的列向量之和：\n$$ \\sum_{i=1}^{N} x'^{(i)} = \\sum_{i=1}^{N} (x^{(i)} - \\bar{x}) = \\left(\\sum_{i=1}^{N} x^{(i)}\\right) - \\sum_{i=1}^{N} \\bar{x} $$\n根据均值 $\\bar{x}$ 的定义，我们有 $\\sum_{i=1}^{N} x^{(i)} = N \\bar{x}$。将此代入方程中得到：\n$$ \\sum_{i=1}^{N} x'^{(i)} = N \\bar{x} - N \\bar{x} = 0 $$\n$A$ 的列向量之和是零向量。这表明这 $N$ 个列向量是线性相关的。这种相关性意味着由这些向量张成的子空间的维度最多为 $N-1$。例如，最后一个列向量可以表示为前 $N-1$ 个列向量的线性组合：$x'^{(N)} = -\\sum_{i=1}^{N-1} x'^{(i)}$。\n因此，$A$ 的秩被进一步约束：\n$$ \\text{rank}(A) \\leq N-1 $$\n结合这两个约束，$A$ 的秩必须小于或等于其维度和 $N-1$ 中的最小值。\n$$ \\text{rank}(A) \\leq \\min(n, N, N-1) $$\n由于当 $N \\geq 1$ 时，$N-1  N$，这可以简化为：\n$$ \\text{rank}(\\hat{C}) = \\text{rank}(A) \\leq \\min(n, N-1) $$\n问题要求的是最大可能秩。这个最大值 $\\min(n, N-1)$ 是可以达到的。只要 $N-1 \\leq n$，我们就可以构造一个集合，使其前 $N-1$ 个距平向量是线性无关的。例如，可以选择前 $N-1$ 个成员 $x^{(i)}$，使得它们产生的距平 $x'^{(i)}$ 是 $\\mathbb{R}^n$ 中的线性无关向量。只要空间维度足够（即 $n \\geq N-1$），这总是可能的。因此，$\\hat{C}$ 的最大可能秩恰好是 $\\min(n, N-1)$。\n\n接下来，我们对给定的 $n=1000$ 和 $N=50$ 的情况进行求值。\n最大秩为：\n$$ \\max \\text{rank}(\\hat{C}) = \\min(1000, 50-1) = \\min(1000, 49) = 49 $$\n所以，对于一个在 1000 维状态空间中大小为 50 的集合，其样本协方差矩阵的秩最多为 49。\n\n最后，我们讨论在 $n \\gg N$ 的高维地球物理系统中，这个秩界的意义。\n在这些系统中，状态维度 $n$ 可能非常大（$10^6$ 到 $10^9$），而集合大小 $N$ 因计算成本所限，通常很小（例如 50 到 100）。$n \\gg N$ 这个条件是强成立的。\n系统的真实误差协方差矩阵是一个 $n \\times n$ 矩阵，通常被认为是满秩的，能够表示所有 $n$ 个状态变量之间复杂的误差关系。\n然而，我们基于集合的估计 $\\hat{C}$ 的秩最多为 $N-1$。由于 $N-1 \\ll n$，矩阵 $\\hat{C}$ 是严重秩亏的。这会带来一些关键的影响：\n1.  **零空间**：矩阵 $\\hat{C}$ 的零空间维度至少为 $n - (N-1)$。对于这个零空间中的任何向量 $v$，都有 $\\hat{C}v=0$。这意味着基于集合的系统在这些零空间向量所定义的方向上具有零方差（即零不确定性）。系统对于存在于这个巨大子空间中的任何真实误差结构都是“盲目”的。\n2.  **伪相关**：整个 $n$ 维空间的协方差信息被限制在由集合距平张成的子空间内，该子空间的维度最多为 $N-1$。这少数的基向量（$\\hat{C}$ 的非零特征值对应的特征向量）必须表示所有的不确定性。这些基向量通常是全局性的，意味着它们在整个模型域上都有非零元素。因此，在某个位置的局部扰动或观测更新会投影到这些全局模态上，从而错误地修改了物理上遥远且不相关位置的状态。这种效应会产生统计上显著但物理上无意义的远程相关性，即所谓的伪相关。这是标准集合数据同化方法的一个主要局限，因此需要使用协方差局地化等技术来抑制这些不符合物理规律的相关性。\n总之，秩亏问题 $\\text{rank}(\\hat{C}) \\leq N-1 \\ll n$ 从根本上限制了集合表示真实高维误差结构的能力，导致了可能降低分析质量的伪远程相关性。", "answer": "$$\n\\boxed{49}\n$$", "id": "3380093"}, {"introduction": "除了秩亏损，集合方法的另一个核心挑战是源于有限样本量的采样误差。我们用集合估算的协方差矩阵本身就是一个随机变量，其精度直接影响滤波性能。这个练习要求你推导样本协方差估计量中单个元素的方差，从而精确地量化这种采样误差 [@problem_id:3380082]。这个结果为理解集合大小 $N$ 对不确定性传播的影响提供了坚实的理论基础。", "problem": "在基于集合的数据同化中，基于样本的二阶统计量的不确定性对于量化不确定性并通过模型进行传播至关重要。考虑一个大小为 $N$ 的状态向量集合 $\\{x^{(n)}\\}_{n=1}^{N}$，其中每个向量在 $\\mathbb{R}^{p}$ 中，从均值为 $ \\mu \\in \\mathbb{R}^{p} $、协方差矩阵为 $ C \\in \\mathbb{R}^{p \\times p} $ 的多元高斯分布中独立同分布地抽取。令无偏集合样本协方差估计量定义为\n$$\n\\hat{C} \\;=\\; \\frac{1}{N-1} \\sum_{n=1}^{N} \\left( x^{(n)} - \\bar{x} \\right)\\left( x^{(n)} - \\bar{x} \\right)^{\\top},\n$$\n其中\n$$\n\\bar{x} \\;=\\; \\frac{1}{N} \\sum_{n=1}^{N} x^{(n)}.\n$$\n对于固定的索引 $j,k \\in \\{1,\\dots,p\\}$，推导抽样方差 $ \\operatorname{Var}\\!\\left(\\hat{C}_{jk}\\right) $，使其成为 $N$ 和真实协方差矩阵 $C$ 的元素的解析函数。您的最终结果必须是包含 $N$ 和 $C$ 的元素的单一封闭形式表达式。不需要数值近似，也不涉及单位。将最终答案表示为单个解析表达式。", "solution": "用户提供了一个有效的、适定的多元统计学问题。我们的任务是，对于从多元高斯分布中抽取的大小为 $N$ 的样本，推导无偏样本协方差矩阵的元素 $\\hat{C}_{jk}$ 的抽样方差。\n\n需要推导的量是 $\\operatorname{Var}(\\hat{C}_{jk})$。根据定义，随机变量 $X$ 的方差为 $\\operatorname{Var}(X) = \\mathbb{E}[X^2] - (\\mathbb{E}[X])^2$。在我们的问题中，即为：\n$$\n\\operatorname{Var}(\\hat{C}_{jk}) = \\mathbb{E}[\\hat{C}_{jk}^2] - (\\mathbb{E}[\\hat{C}_{jk}])^2\n$$\n问题指出 $\\hat{C}$ 是无偏样本协方差估计量。这意味着其期望值是真实协方差矩阵 $C$：\n$$\n\\mathbb{E}[\\hat{C}] = C\n$$\n取该矩阵方程的第 $(j,k)$ 个元素，我们得到：\n$$\n\\mathbb{E}[\\hat{C}_{jk}] = C_{jk}\n$$\n因此，方差表达式中的第二项是 $(\\mathbb{E}[\\hat{C}_{jk}])^2 = C_{jk}^2$。问题现在简化为计算估计量平方的期望值，即 $\\mathbb{E}[\\hat{C}_{jk}^2]$。\n\n为了继续推导，我们利用多元统计学中的一个基本结果。样本协方差矩阵是由与样本均值的偏差 $x^{(n)} - \\bar{x}$ 构建的。因为原始数据向量 $x^{(n)}$ 是从多元高斯分布 $\\mathcal{N}(\\mu, C)$ 中抽取的，所以矩阵 $S = (N-1)\\hat{C}$（称为样本散布矩阵）服从自由度为 $N-1$、尺度矩阵为 $C$ 的 Wishart 分布。我们将其表示为：\n$$\nS = \\sum_{n=1}^{N} \\left( x^{(n)} - \\bar{x} \\right)\\left( x^{(n)} - \\bar{x} \\right)^{\\top} \\sim W_p(N-1, C)\n$$\n其中 $p$ 是状态向量的维度。令自由度为 $\\nu = N-1$。因此，$S \\sim W_p(\\nu, C)$。\n\n由于 $\\hat{C} = \\frac{1}{\\nu}S$，我们可以将其元素的方差写为：\n$$\n\\operatorname{Var}(\\hat{C}_{jk}) = \\operatorname{Var}\\left(\\frac{1}{\\nu}S_{jk}\\right) = \\frac{1}{\\nu^2}\\operatorname{Var}(S_{jk})\n$$\n现在问题变成了求一个 Wishart 分布矩阵 $S$ 的元素的方差。对于 Wishart 矩阵 $A \\sim W_p(\\nu, C)$ 的任意两个元素之间的协方差，存在一个通用公式：\n$$\n\\operatorname{Cov}(A_{ab}, A_{cd}) = \\nu(C_{ac}C_{bd} + C_{ad}C_{bc})\n$$\n这个公式是由底层高斯分布的四阶矩推导出来的。具体来说，如果 $y \\sim \\mathcal{N}(0, C)$，对于零均值高斯变量的 Isserlis' theorem (或 Wick's theorem) 指出，对于任意四个分量 $y_i, y_j, y_k, y_l$：\n$$\n\\mathbb{E}[y_i y_j y_k y_l] = \\mathbb{E}[y_i y_j]\\mathbb{E}[y_k y_l] + \\mathbb{E}[y_i y_k]\\mathbb{E}[y_j y_l] + \\mathbb{E}[y_i y_l]\\mathbb{E}[y_j y_k] = C_{ij}C_{kl} + C_{ik}C_{jl} + C_{il}C_{jk}\n$$\n利用这个，可以推导出 Wishart 矩阵的协方差公式。\n\n为了求方差 $\\operatorname{Var}(S_{jk})$，我们在通用协方差公式中设置索引，以计算 $\\operatorname{Cov}(S_{jk}, S_{jk})$。这对应于在 $\\operatorname{Cov}(A_{ab}, A_{cd})$ 的公式中设置 $a=j, b=k, c=j, d=k$：\n$$\n\\operatorname{Var}(S_{jk}) = \\operatorname{Cov}(S_{jk}, S_{jk}) = \\nu(C_{jj}C_{kk} + C_{jk}C_{kj})\n$$\n由于 $C$ 是一个协方差矩阵，它是对称的，这意味着 $C_{jk} = C_{kj}$。该表达式简化为：\n$$\n\\operatorname{Var}(S_{jk}) = \\nu(C_{jj}C_{kk} + C_{jk}^2)\n$$\n现在，我们将此结果代回到 $\\operatorname{Var}(\\hat{C}_{jk})$ 的表达式中，并回顾 $\\nu = N-1$：\n$$\n\\operatorname{Var}(\\hat{C}_{jk}) = \\frac{1}{\\nu^2}\\operatorname{Var}(S_{jk}) = \\frac{1}{(N-1)^2} \\left[ (N-1)(C_{jj}C_{kk} + C_{jk}^2) \\right]\n$$\n简化此表达式可得出最终结果：\n$$\n\\operatorname{Var}(\\hat{C}_{jk}) = \\frac{1}{N-1}(C_{jj}C_{kk} + C_{jk}^2)\n$$\n这就是无偏样本协方差矩阵第 $(j,k)$ 个元素的抽样方差。它取决于集合大小 $N$ 和真实协方差矩阵 $C$ 的相应元素。$C_{jj}$ 和 $C_{kk}$ 分别是状态向量第 $j$ 个和第 $k$ 个分量的真实方差，而 $C_{jk}$ 是它们的真实协方差。", "answer": "$$\\boxed{\\frac{1}{N-1}\\left(C_{jj}C_{kk} + C_{jk}^{2}\\right)}$$", "id": "3380082"}]}