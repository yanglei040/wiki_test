{"hands_on_practices": [{"introduction": "在机械嵌入方案中，一个核心挑战是如何处理量子力学（QM）区域和分子力学（MM）区域之间的边界，以避免对被纳入QM区域的原子进行重复计费。本练习将引导您设计并应用一种电荷重分布方案，通过重新分配被移除的MM点电荷，来保持系统的远场静电势。您将学习如何确保这一过程守恒总电荷（单极矩）和偶极矩，这是构建可靠QM/MM模型的关键一步。[@problem_id:3482067]", "problem": "在计算材料科学中，考虑一个量子力学/分子力学 (QM/MM) 嵌入的情景：其中一部分原子在量子力学水平上处理，而相应的分子力学 (MM) 点电荷被移除以避免重复计算。目标是通过使用一种能够保持被移除电荷的单极矩和偶极矩的电荷转移方案，将被移除的 MM 电荷重新分配到附近的 MM 原子上，从而在 MM 原子被量子区域取代时，维持 MM 环境的远场静电势。\n\n假设在三维空间中有一组 MM 点电荷 $\\{q_i\\}$，其位置为 $\\{\\mathbf{r}_i\\}$，距离单位为埃（Angstrom）。两个标记为 $A$ 和 $B$ 的 MM 原子被量子区域取代。它们原来的位置和电荷为：$\\mathbf{r}_A = (0,0,0)$，电荷 $q_A = 0.8$（以基本电荷单位 $e$ 计）；以及 $\\mathbf{r}_B = (2,0,0)$，电荷 $q_B = -0.4$（以 $e$ 计）。为了在 QM 区域外将远场势保持到 $1/R$ 的一阶，您将构建并应用一种电荷转移方案，将 $q_A$ 和 $q_B$ 重新分配到指定的附近 MM 原子上。\n\n给定以下八个 MM 相邻原子及其位置和初始 MM 电荷，所有距离单位为埃，电荷单位为 $e$：\n- 对于 $A$：邻近原子 $N_1, N_2, N_3, N_4$，其位置为 $\\mathbf{R}_1 = (1,0,0)$、$\\mathbf{R}_2 = (0,1,0)$、$\\mathbf{R}_3 = (0,0,1)$、$\\mathbf{R}_4 = (-1,-1,-1)$，初始电荷为 $q_{N_1} = -0.1$、$q_{N_2} = 0.2$、$q_{N_3} = -0.05$、$q_{N_4} = 0.0$。\n- 对于 $B$：邻近原子 $M_1, M_2, M_3, M_4$，其位置为 $\\mathbf{S}_1 = (3,0,0)$、$\\mathbf{S}_2 = (2,1,0)$、$\\mathbf{S}_3 = (2,0,1)$、$\\mathbf{S}_4 = (1,-1,-1)$，初始电荷为 $q_{M_1} = 0.1$、$q_{M_2} = -0.15$、$q_{M_3} = 0.0$、$q_{M_4} = 0.05$。\n\n从局域电荷分布的库仑势及其标准多极展开出发，推导保证被移除 MM 电荷的总电荷（单极矩）和偶极矩守恒的重分布权重条件。然后，对于给定的几何结构，求解重分布权重，将 $q_A$ 分配到 $N_1$–$N_4$ 上，将 $q_B$ 分配到 $M_1$–$M_4$ 上，以保持 $q_A$ 在 $\\mathbf{r}_A$ 处和 $q_B$ 在 $\\mathbf{r}_B$ 处的单极矩和偶极矩。使用这些权重计算 $N_1, N_2, N_3, N_4, M_1, M_2, M_3, M_4$ 上更新后的 MM 电荷。\n\n最后，分析验证该方案能够守恒电荷并保持由 $A$ 和 $B$ 对远场势贡献的偶极矩（至 $1/R$ 的一阶）。将最终的八个更新后 MM 电荷表示为以基本电荷单位 ($e$) 计的精确十进制数。请以单行矩阵的形式提供您的最终答案，顺序为 $(q_{N_1}^{\\mathrm{new}}, q_{N_2}^{\\mathrm{new}}, q_{N_3}^{\\mathrm{new}}, q_{N_4}^{\\mathrm{new}}, q_{M_1}^{\\mathrm{new}}, q_{M_2}^{\\mathrm{new}}, q_{M_3}^{\\mathrm{new}}, q_{M_4}^{\\mathrm{new}})$。", "solution": "该问题陈述已经过严格验证，并被认为是合理的。它在科学上基于静电势理论的原理及其在计算材料科学中的应用，特别是在 QM/MM 嵌入方案的背景下。该问题设定良好，提供了一套完整且一致的数据，从而可以推导出一个唯一且有意义的解。术语精确客观。因此，我将继续提供完整的解。\n\n任务是为 QM/MM 模拟设计并应用一个电荷重分布方案。当 MM 原子被提升到 QM 区域时，它们的 MM 点电荷必须被移除以避免重复计算静电相互作用。为最小化对周围 MM 环境的扰动，这些被移除的电荷被重新分配到邻近的 MM 原子上。该方案必须保持远场静电势。距离局域电荷分布 $\\{q_i\\}$（位于位置 $\\{\\mathbf{r}_i\\}$）很远的 $\\mathbf{R}$ 处的静电势 $\\Phi(\\mathbf{R})$ 可通过多极展开表示：\n$$ \\Phi(\\mathbf{R}) = \\frac{1}{4\\pi\\epsilon_0} \\left( \\frac{Q}{|\\mathbf{R}|} + \\frac{\\mathbf{p} \\cdot \\mathbf{R}}{|\\mathbf{R}|^3} + O\\left(\\frac{1}{|\\mathbf{R}|^3}\\right) \\right) $$\n其中 $Q = \\sum_i q_i$ 是总电荷（单极矩），$\\mathbf{p} = \\sum_i q_i \\mathbf{r}_i$ 是相对于所选原点的分布的偶极矩。问题要求“将势保持到 $1/R$ 的一阶”，同时明确要求偶极矩守恒。这意味着展开式中的单极矩项（$1/R$）和偶极矩项（$1/R^2$）都必须守恒。\n\n设一个被移除的 MM 电荷为 $q_k$，位于位置 $\\mathbf{r}_k$。该电荷被重新分配到一组位置为 $\\{\\mathbf{R}_j\\}$ 的邻近 MM 原子上。添加到邻近原子 $j$ 上的电荷量为 $\\Delta q_j$。为保持单极矩和偶极矩，必须满足以下条件：\n1.  **单极矩守恒**：重分布的总电荷必须等于原始电荷。\n    $$ \\sum_j \\Delta q_j = q_k $$\n2.  **偶极矩守恒**：重分布电荷的偶极矩必须等于原始电荷的偶极矩。\n    $$ \\sum_j \\Delta q_j \\mathbf{R}_j = q_k \\mathbf{r}_k $$\n我们引入一组无量纲权重 $\\{w_j\\}$，使得 $\\Delta q_j = w_j q_k$。将此代入守恒方程，得到：\n$$ \\sum_j w_j q_k = q_k \\implies \\sum_j w_j = 1 $$\n$$ \\sum_j (w_j q_k) \\mathbf{R}_j = q_k \\mathbf{r}_k \\implies \\sum_j w_j \\mathbf{R}_j = \\mathbf{r}_k $$\n这两个方程，一个用于电荷守恒的标量方程和一个用于偶极矩守恒的矢量方程（产生三个标量方程），构成了一个关于权重 $\\{w_j\\}$ 的线性方程组。问题给出了两个这样的重分布任务，我们将独立求解。\n\n**第 1 部分：电荷 $q_A$ 的重分布**\n\n位于位置 $\\mathbf{r}_A = (0, 0, 0)$ 的电荷 $q_A = 0.8$ 被重新分配到四个邻近原子 $N_1, N_2, N_3, N_4$ 上，其位置分别为 $\\mathbf{R}_1 = (1, 0, 0)$、$\\mathbf{R}_2 = (0, 1, 0)$、$\\mathbf{R}_3 = (0, 0, 1)$ 和 $\\mathbf{R}_4 = (-1, -1, -1)$。设相应的权重为 $w_{A1}, w_{A2}, w_{A3}, w_{A4}$。方程组为：\n$$ \\sum_{i=1}^{4} w_{Ai} = 1 $$\n$$ \\sum_{i=1}^{4} w_{Ai} \\mathbf{R}_i = \\mathbf{r}_A = (0, 0, 0) $$\n将矢量方程展开为其三个标量分量：\n1.  $w_{A1} + w_{A2} + w_{A3} + w_{A4} = 1$\n2.  $w_{A1}(1) + w_{A2}(0) + w_{A3}(0) + w_{A4}(-1) = 0 \\implies w_{A1} - w_{A4} = 0$\n3.  $w_{A1}(0) + w_{A2}(1) + w_{A3}(0) + w_{A4}(-1) = 0 \\implies w_{A2} - w_{A4} = 0$\n4.  $w_{A1}(0) + w_{A2}(0) + w_{A3}(1) + w_{A4}(-1) = 0 \\implies w_{A3} - w_{A4} = 0$\n\n从方程 (2)、(3) 和 (4) 中，我们发现 $w_{A1} = w_{A2} = w_{A3} = w_{A4}$。将此代入方程 (1) 得到 $4w_{A1} = 1$，因此 $w_{A1} = 1/4$。\n因此，所有权重都相等：$w_{A1} = w_{A2} = w_{A3} = w_{A4} = 0.25$。\n\n每个邻近原子的电荷增量为 $\\Delta q_{N_i} = w_{Ai} q_A = 0.25 \\times 0.8 = 0.2$。\nA 的邻近原子上的新电荷为 $q_{N_i}^{\\mathrm{new}} = q_{N_i}^{\\mathrm{initial}} + \\Delta q_{N_i}$：\n$q_{N_1}^{\\mathrm{new}} = -0.1 + 0.2 = 0.1$\n$q_{N_2}^{\\mathrm{new}} = 0.2 + 0.2 = 0.4$\n$q_{N_3}^{\\mathrm{new}} = -0.05 + 0.2 = 0.15$\n$q_{N_4}^{\\mathrm{new}} = 0.0 + 0.2 = 0.2$\n\n**第 2 部分：电荷 $q_B$ 的重分布**\n\n位于位置 $\\mathbf{r}_B = (2, 0, 0)$ 的电荷 $q_B = -0.4$ 被重新分配到四个邻近原子 $M_1, M_2, M_3, M_4$ 上，其位置分别为 $\\mathbf{S}_1 = (3, 0, 0)$、$\\mathbf{S}_2 = (2, 1, 0)$、$\\mathbf{S}_3 = (2, 0, 1)$ 和 $\\mathbf{S}_4 = (1, -1, -1)$。设相应的权重为 $w_{B1}, w_{B2}, w_{B3}, w_{B4}$。方程组为：\n$$ \\sum_{i=1}^{4} w_{Bi} = 1 $$\n$$ \\sum_{i=1}^{4} w_{Bi} \\mathbf{S}_i = \\mathbf{r}_B = (2, 0, 0) $$\n将矢量方程展开为其三个标量分量：\n1.  $w_{B1} + w_{B2} + w_{B3} + w_{B4} = 1$\n2.  $w_{B1}(3) + w_{B2}(2) + w_{B3}(2) + w_{B4}(1) = 2$\n3.  $w_{B1}(0) + w_{B2}(1) + w_{B3}(0) + w_{B4}(-1) = 0 \\implies w_{B2} - w_{B4} = 0$\n4.  $w_{B1}(0) + w_{B2}(0) + w_{B3}(1) + w_{B4}(-1) = 0 \\implies w_{B3} - w_{B4} = 0$\n\n从方程 (3) 和 (4) 中，我们发现 $w_{B2} = w_{B3} = w_{B4}$。设这个共同值为 $w$。\n代入方程 (1) 和 (2)：\n$w_{B1} + 3w = 1$\n$3w_{B1} + 2w + 2w + w = 2 \\implies 3w_{B1} + 5w = 2$\n从第一个方程中，得到 $w_{B1} = 1 - 3w$。代入第二个方程：\n$3(1 - 3w) + 5w = 2 \\implies 3 - 9w + 5w = 2 \\implies 3 - 4w = 2 \\implies 4w = 1 \\implies w = 1/4$。\n所以，$w_{B2} = w_{B3} = w_{B4} = 0.25$。\n然后，$w_{B1} = 1 - 3(0.25) = 1 - 0.75 = 0.25$。\n同样，所有权重都相等：$w_{B1} = w_{B2} = w_{B3} = w_{B4} = 0.25$。\n\n每个邻近原子的电荷增量为 $\\Delta q_{M_i} = w_{Bi} q_B = 0.25 \\times (-0.4) = -0.1$。\nB 的邻近原子上的新电荷为 $q_{M_i}^{\\mathrm{new}} = q_{M_i}^{\\mathrm{initial}} + \\Delta q_{M_i}$：\n$q_{M_1}^{\\mathrm{new}} = 0.1 + (-0.1) = 0.0$\n$q_{M_2}^{\\mathrm{new}} = -0.15 + (-0.1) = -0.25$\n$q_{M_3}^{\\mathrm{new}} = 0.0 + (-0.1) = -0.1$\n$q_{M_4}^{\\mathrm{new}} = 0.05 + (-0.1) = -0.05$\n\n**验证**\n\n单极矩和偶极矩的守恒是由权重的线性系统的构造所保证的。我们可以通过数值进行验证。\n\n对于 A：\n总重分布电荷：$\\sum \\Delta q_{N_i} = 4 \\times 0.2 = 0.8$，等于 $q_A$。\n新偶极矩：$\\sum (\\Delta q_{N_i} \\mathbf{R}_i) = 0.2(\\mathbf{R}_1 + \\mathbf{R}_2 + \\mathbf{R}_3 + \\mathbf{R}_4)$。\n$\\mathbf{R}_1+\\mathbf{R}_2+\\mathbf{R}_3+\\mathbf{R}_4 = (1,0,0) + (0,1,0) + (0,0,1) + (-1,-1,-1) = (0,0,0)$。\n新偶极矩为 $\\mathbf{0}$，等于原始偶极矩 $q_A\\mathbf{r}_A = \\mathbf{0}$。\n\n对于 B：\n总重分布电荷：$\\sum \\Delta q_{M_i} = 4 \\times (-0.1) = -0.4$，等于 $q_B$。\n新偶极矩：$\\sum (\\Delta q_{M_i} \\mathbf{S}_i) = -0.1(\\mathbf{S}_1 + \\mathbf{S}_2 + \\mathbf{S}_3 + \\mathbf{S}_4)$。\n$\\mathbf{S}_1+\\mathbf{S}_2+\\mathbf{S}_3+\\mathbf{S}_4 = (3,0,0) + (2,1,0) + (2,0,1) + (1,-1,-1) = (8,0,0)$。\n新偶极矩为 $-0.1(8,0,0) = (-0.8, 0, 0)$。\n原始偶极矩为 $q_B\\mathbf{r}_B = -0.4(2,0,0) = (-0.8, 0, 0)$。\n偶极矩守恒。\n\n该方案已得到分析验证。最终更新的电荷收集如下。\n\n八个指定 MM 原子的最终更新电荷为：\n$q_{N_1}^{\\mathrm{new}} = 0.1$\n$q_{N_2}^{\\mathrm{new}} = 0.4$\n$q_{N_3}^{\\mathrm{new}} = 0.15$\n$q_{N_4}^{\\mathrm{new}} = 0.2$\n$q_{M_1}^{\\mathrm{new}} = 0.0$\n$q_{M_2}^{\\mathrm{new}} = -0.25$\n$q_{M_3}^{\\mathrm{new}} = -0.1$\n$q_{M_4}^{\\mathrm{new}} = -0.05$\n\n这些值在最终答案中以所需的矩阵格式呈现。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.1  0.4  0.15  0.2  0.0  -0.25  -0.1  -0.05\n\\end{pmatrix}\n}\n$$", "id": "3482067"}, {"introduction": "在任何QM/MM计算中，一个至关重要的问题是确定QM区域需要多大才能获得收敛的结果。本练习提供了一种量化嵌入误差收敛性的实践方法，您将对一个物理上合理的衰减模型进行拟合。通过这个过程，您不仅可以评估收敛性，还能提取出一个特征“屏蔽长度”$ \\xi $，它深刻地揭示了MM环境如何响应QM区域的电子结构。[@problem_id:3482089]", "problem": "考虑一个复合体系，其中一个氢键化溶质通过量子力学/分子力学 (QM/MM) 嵌入方法，被描述为一个嵌入在分子力学 (MM) 环境中的量子力学 (QM) 区域。设通过完全量子力学方式计算得到的体系总能量为 $E_{\\mathrm{QM}}$，嵌入能为 $E_{\\mathrm{QM/MM}}(R)$，其中 $R$ 是从溶质中心测量的 QM 区域的特征半径。将嵌入误差定义为 $\\Delta E(R) = E_{\\mathrm{QM/MM}}(R) - E_{\\mathrm{QM}}$，并约定正的 $\\Delta E(R)$ 表示嵌入方法高估了完全量子力学的能量。假设 MM 环境是一个氢键网络，其特征是在 QM 区域存在的情况下，由分子极化引起的线性响应和有限范围相关性。\n\n从适用于计算材料科学的第一性原理出发，使用以下内容作为符合上下文的基本依据：\n- QM 区域与外场相互作用的定态薛定谔方程，\n- 根据线性响应定义的电介质中的极化响应，\n- 无序氢键网络在小扰动下存在特征相关长度。\n\n基于这些依据，论证存在一个特征屏蔽长度 $\\xi$，它决定了 QM/MM 嵌入误差随 $R$ 增大而发生空间衰减的规律，并构建一个与有限相关长度屏蔽相符、具有物理解释的 $\\Delta E(R)$ 单调衰减函数形式。然后，实现一个算法，通过带有物理意义约束的非线性最小二乘法来拟合所推导的衰减模型参数，从而从离散数据点 $\\{(R_i,\\Delta E_i)\\}$ 中估计 $\\xi$。\n\n物理单位：\n- QM 区域半径 $R$ 必须以埃 (Å) 为单位。\n- 嵌入误差 $\\Delta E$ 必须以千焦/摩尔 (kJ/mol) 为单位。\n- 屏蔽长度 $\\xi$ 必须以埃 (Å) 为单位报告。\n\n您的程序必须处理以下数据集测试套件，每个数据集均以 $\\{R_i,\\Delta E_i\\}$ 对的形式给出，其中 $R$ 的单位为 Å，$\\Delta E$ 的单位为 kJ/mol：\n\n- 测试用例 1 (无噪声，代表性氢键强度标度):\n  - $R$: $[2,4,6,8,10]$\n  - $\\Delta E$: $[6.161005,3.163166,1.624023,0.833801,0.428088]$\n\n- 测试用例 2 (中等噪声，更宽的 $R$ 范围):\n  - $R$: $[3,5,7,9,12,15]$\n  - $\\Delta E$: $[11.076233,7.307589,5.011939,3.185978,1.864359,0.905741]$\n\n- 测试用例 3 (边界情况，最少数据):\n  - $R$: $[1,2]$\n  - $\\Delta E$: $[4.852245,2.943036]$\n\n- 测试用例 4 (强屏蔽，快速衰减):\n  - $R$: $[1,2,3,4,5]$\n  - $\\Delta E$: $[1.839397,0.676676,0.248935,0.091578,0.033690]$\n\n算法要求：\n- 根据指定的依据，提出并论证 $\\Delta E(R)$ 的衰减模型，推导拟合策略，并实现一个带约束的非线性最小二乘估计器，用于提取模型参数 $\\xi$。\n- 将拟合约束在具有物理意义的参数范围内。\n- 为保证数值稳定性，确保拟合过程能够无故障地处理最少数据集和轻度噪声。\n- 对每个数据集，输出估计的 $\\xi$ 值，单位为 Å，并四舍五入到 4 位小数。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按测试用例 1 到 4 的顺序排列结果，例如 $[\\xi_1,\\xi_2,\\xi_3,\\xi_4]$，其中每个 $\\xi_i$ 是一个浮点数，单位为 Å，并四舍五入到 4 位小数。", "solution": "该问题经评估有效。它在科学上基于计算材料科学的原理，特别是量子力学/分子力学 (QM/MM) 嵌入理论。问题是适定的、客观的，并包含推导模型和实现数值解所需的所有必要信息。不存在矛盾、事实错误或含糊之处。\n\n### 衰减模型的理论论证\n\n问题要求为嵌入误差 $\\Delta E(R) = E_{\\mathrm{QM/MM}}(R) - E_{\\mathrm{QM}}$ 构建一个具有物理解释的函数形式，该函数是量子力学 (QM) 区域半径 $R$ 的函数。\n\n1.  **嵌入误差的来源**：体系的总能量 $E_{\\mathrm{QM}}$ 是参考标准。QM/MM 能量 $E_{\\mathrm{QM/MM}}(R)$ 将半径为 $R$ 的球形区域用 QM 水平处理，而将其周围环境用更简单的分子力学 (MM) 力场处理。嵌入误差 $\\Delta E(R)$ 源于对 QM 球外部区域（即距离 $r > R$）的 MM 模型的近似处理。在常见的静电嵌入方案中，主要的误差来源是忽略了 MM 区域中的电子极化和电荷转移等量子效应。\n\n2.  **作为积分量的误差**：总误差 $\\Delta E(R)$ 可被看作是误差密度 $\\delta\\epsilon(\\mathbf{r})$ 在整个 MM 区域上的积分：\n    $$ \\Delta E(R) = \\int_{|\\mathbf{r}| > R} \\delta\\epsilon(\\mathbf{r}) \\, d^3\\mathbf{r} $$\n    误差对半径 $R$ 的变化率与 QM 区域球形边界上的误差密度有关。对 $R$ 求导（使用莱布尼茨积分法则）可得：\n    $$ \\frac{d(\\Delta E)}{dR} = - \\int_{S(R)} \\delta\\epsilon(\\mathbf{r}) \\, dS $$\n    其中 $S(R)$ 是半径为 $R$ 的球面。假设效应是各向同性的，那么在球面上的积分与该半径处的误差密度值 $\\delta\\epsilon(R)$ 乘以表面积 $4\\pi R^2$ 成正比。然而，可以提出一个更简单、更直接的物理论证。\n\n3.  **屏蔽和相关长度的作用**：问题指出，MM 环境是一个氢键网络，其特征是线性响应和有限的相关长度。QM 溶质对 MM 环境起到了扰动作用（例如，一个电场源）。在电介质中，扰动的影响会被屏蔽。“特征相关长度”的存在意味着介质对原点处局域扰动的响应会以一个特征长度尺度衰减，问题要求我们将其表示为 $\\xi$。\n\n4.  **函数形式的推导**：对于具有有限范围相关性的体系，最基本的屏蔽模型是指数衰减。因此，来自半径为 $r$ 的壳层的误差贡献应与 $e^{-r/\\xi}$ 成正比。让我们对总误差的变化率 $d(\\Delta E)/dR$ 进行建模。当我们增加 $R$ 时，我们正在将 QM/MM 边界向外移动。误差的变化量 $d(\\Delta E)$ 是通过将半径为 $R$ 的薄壳层 MM 原子转换为 QM 原子而消除的误差。因此，$d(\\Delta E)/dR$ 必须与半径 $R$ 处误差密度的负值成正比。考虑到屏蔽效应，我们可以假定：\n    $$ \\frac{d(\\Delta E)}{dR} = -k' e^{-R/\\xi} $$\n    其中 $k'$ 是一个正的比例常数，它包含了相互作用强度和介质密度，$\\xi$ 是特征屏蔽长度。负号表示总误差 $\\Delta E$ 随着 $R$ 的增大而减小，这与通过扩大 QM 区域来改进模型是一致的。\n\n5.  **积分求 $\\Delta E(R)$**：我们可以通过对此微分方程进行积分来求得 $\\Delta E(R)$。我们必须使用物理边界条件，即当 QM 区域包含整个体系时，误差消失，即 $\\Delta E(R \\to \\infty) = 0$。\n    $$ \\int_{\\Delta E(R)}^{0} d(\\Delta E') = \\int_{R}^{\\infty} (-k' e^{-r'/\\xi}) \\, dr' $$\n    $$ 0 - \\Delta E(R) = -k' \\left[ -\\xi e^{-r'/\\xi} \\right]_{R}^{\\infty} $$\n    $$ -\\Delta E(R) = -k' (0 - (-\\xi e^{-R/\\xi})) $$\n    $$ -\\Delta E(R) = -k' \\xi e^{-R/\\xi} $$\n    定义一个新的振幅参数 $A = k' \\xi$，我们得到最终的函数形式：\n    $$ \\Delta E(R) = A e^{-R/\\xi} $$\n    该模型是一个单调衰减函数，具有两个有物理意义的参数：\n    -   $A$：振幅，代表在 $R=0$ 处外推得到的总误差。其单位为能量 (kJ/mol)。它必须是正数。\n    -   $\\xi$：特征屏蔽长度，代表嵌入误差衰减为 $e$ 分之一的距离。其单位为长度 (Å)。它必须是正数。\n\n### 参数估计算法\n\n为了从离散数据点 $\\{(R_i, \\Delta E_i)\\}$ 中估计屏蔽长度 $\\xi$，我们将使用非线性最小二乘法。\n\n1.  **目标函数**：目标是找到参数 $A$ 和 $\\xi$，以最小化观测数据 $\\Delta E_i$ 与模型预测值之间的残差平方和 ($S$)：\n    $$ S(A, \\xi) = \\sum_{i} \\left[ \\Delta E_i - A e^{-R_i/\\xi} \\right]^2 $$\n\n2.  **初始猜测值**：非线性优化算法需要参数的初始猜测值。一种获得这些值的稳健方法是将模型线性化。对我们的模型方程取自然对数可得：\n    $$ \\ln(\\Delta E(R)) = \\ln(A) - \\frac{1}{\\xi} R $$\n    这是一个 $y = c + m x$ 形式的线性方程，其中 $y = \\ln(\\Delta E)$，$x = R$，截距为 $c = \\ln(A)$，斜率为 $m = -1/\\xi$。我们可以对变换后的数据点 $(R_i, \\ln(\\Delta E_i))$ 进行标准线性回归，以找到最佳拟合斜率 $m_0$ 和截距 $c_0$。由此，我们推导出用于非线性拟合的初始猜测值：\n    -   $\\xi_0 = -1/m_0$\n    -   $A_0 = e^{c_0}$\n\n3.  **带约束的非线性优化**：参数的物理性质要求约束条件 $A > 0$ 和 $\\xi > 0$。我们将使用 `scipy.optimize.curve_fit` 中实现的 Levenberg-Marquardt 算法来执行非线性最小二乘最小化。该函数允许指定参数的边界，确保最终的拟合具有物理意义。我们将为 $A$ 和 $\\xi$ 设置一个小的正数下界（例如 $10^{-9}$）和一个无穷大的上界。\n\n4.  **实现**：该算法将使用 Python 语言以及 NumPy 和 SciPy 库来实现。对于每个提供的数据集，代码将： a. 对对数变换后的数据使用线性回归计算初始猜测值 $A_0$ 和 $\\xi_0$。 b. 使用 `scipy.optimize.curve_fit` 执行带约束的非线性拟合，以找到最优参数 $A_{\\text{fit}}$ 和 $\\xi_{\\text{fit}}$。 c. 提取拟合得到的屏蔽长度 $\\xi_{\\text{fit}}$，将其四舍五入到 4 位小数，并报告结果。此过程是稳健的，利用了成熟数值库的强大功能，并遵守了模型的物理约束。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import curve_fit\n\ndef solve():\n    \"\"\"\n    Derives and fits a decay model for QM/MM embedding error to estimate\n    the characteristic screening length xi for several datasets.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each test case is a tuple of two lists: (R_values, DeltaE_values).\n    test_cases = [\n        (\n            [2, 4, 6, 8, 10],\n            [6.161005, 3.163166, 1.624023, 0.833801, 0.428088]\n        ),\n        (\n            [3, 5, 7, 9, 12, 15],\n            [11.076233, 7.307589, 5.011939, 3.185978, 1.864359, 0.905741]\n        ),\n        (\n            [1, 2],\n            [4.852245, 2.943036]\n        ),\n        (\n            [1, 2, 3, 4, 5],\n            [1.839397, 0.676676, 0.248935, 0.091578, 0.033690]\n        )\n    ]\n\n    results = []\n\n    # Define the physically justified monotonic decay model\n    # Delta_E(R) = A * exp(-R / xi)\n    def decay_model(R, A, xi):\n        \"\"\"\n        Theoretical model for the embedding error.\n        A: Amplitude (kJ/mol)\n        xi: Screening length (Angstrom)\n        \"\"\"\n        return A * np.exp(-R / xi)\n\n    for R_data, E_data in test_cases:\n        # Convert lists to numpy arrays for numerical operations.\n        R_vals = np.array(R_data, dtype=float)\n        E_vals = np.array(E_data, dtype=float)\n\n        # --- Step 1: Obtain robust initial guesses via linearization ---\n        # The model is ln(E) = ln(A) - (1/xi) * R. This is a linear equation y = c + m*x.\n        # We perform a linear fit on the log-transformed data to find initial A and xi.\n        \n        # Ensure all energy values are positive before taking the log.\n        if np.any(E_vals <= 0):\n            # Fallback initial guesses if data is not suitable for log transform.\n            # This case is not expected with the given problem data.\n            A0, xi0 = 1.0, 1.0\n        else:\n            log_E_vals = np.log(E_vals)\n            \n            # Use np.polyfit for linear regression (degree 1 polynomial)\n            # m = slope, c = intercept\n            try:\n                m, c = np.polyfit(R_vals, log_E_vals, 1)\n\n                # From m = -1/xi, we get xi = -1/m\n                # From c = ln(A), we get A = exp(c)\n                if m < 0:\n                    xi0 = -1.0 / m\n                    A0 = np.exp(c)\n                else:\n                    # If slope is non-negative, the decay model is invalid.\n                    # Provide a default guess. This is unlikely for the given problem.\n                    A0, xi0 = np.mean(E_vals), np.mean(R_vals)\n\n            except np.linalg.LinAlgError:\n                 # Fallback for cases where polyfit might fail\n                 A0, xi0 = 1.0, 1.0\n\n        # --- Step 2: Perform constrained nonlinear least-squares fitting ---\n        # Define physical constraints: A > 0 and xi > 0.\n        # Use a small positive number instead of 0 for numerical stability.\n        bounds = ([1e-9, 1e-9], [np.inf, np.inf])\n        \n        # Initial guesses vector\n        p0 = [A0, xi0]\n\n        try:\n            # Use curve_fit to find the optimal parameters for the decay_model\n            popt, pcov = curve_fit(decay_model, R_vals, E_vals, p0=p0, bounds=bounds)\n            \n            # The optimized screening length is the second parameter\n            xi_fit = popt[1]\n\n        except (RuntimeError, ValueError):\n            # If the fit fails, an indicator should be returned.\n            # For this problem, fits are expected to converge.\n            xi_fit = np.nan\n\n        results.append(xi_fit)\n\n    # --- Step 3: Format and print the final output ---\n    # The output must be a single line with comma-separated values in brackets,\n    # with each value rounded to 4 decimal places.\n    formatted_results = [f\"{res:.4f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n\n```", "id": "3482089"}, {"introduction": "现在，我们将注意力转向计算材料科学中的一个常见应用：在周期性晶体中研究带电缺陷。在周期性边界条件下进行的模拟会引入人为的、非物理的相互作用，这必须得到纠正才能获得准确的能量。本练习将指导您推导并计算带电QM/MM体系中的主导阶有限尺寸校正项，这是从周期性模型中获得准确缺陷形成能的关键步骤。[@problem_id:3482082]", "problem": "考虑一个使用量子力学/分子力学 (QM/MM) 方法，在三维周期性边界条件下嵌入的带电点缺陷。QM 区域带有以基本电荷 $e$ 为单位的净电荷 $q$，并嵌入在一个均匀的分子力学 (MM) 环境中，该环境被建模为一个相对介电常数为 $\\varepsilon_{r}$ 的线性、各向同性的介电连续体。模拟晶胞是一个边长为 $L$ 的简单立方盒子，具有周期性镜像，并施加了均匀的中和背景电荷密度 $-\\rho_{\\mathrm{b}}=-q e / L^{3}$，以使 Ewald 求和有明确定义。总静电能包含一个 Ewald 项 $E_{\\mathrm{Ewald}}$，该项解释了周期性电荷阵列与中和背景之间的长程相互作用。\n\n从物质中静电学的 Maxwell 方程组（特别是均匀介质中的 Poisson 方程）和带有均匀中和背景的周期性净电荷晶胞的 Ewald 求和定义出发，推导每个晶胞静电能的有限尺寸修正主导项，该修正仅由净电荷与其周期性镜像和背景之间的虚假相互作用引起。证明对于大的 $L$，该修正与 $\\mathcal{O}(1/L)$ 成比例，并依赖于一个与晶格相关的、依赖于形状的常数。使用对 MM 电介质的线性响应假设（因此介质中的库仑相互作用与 $1/\\varepsilon_{r}$ 成比例），假设“锡箔”边界条件（无穷远处的导电边界），并取简单立方马德隆常数为 $\\alpha_{\\mathrm{M}}=2.837297$。\n\n在推导出 $\\mathcal{O}(1/L)$ 项的解析形式后，使用以下参数计算其数值：\n- 净电荷 $q=+1$，\n- 盒子长度 $L=25\\,\\mathrm{\\AA}$，\n- MM 相对介电常数 $\\varepsilon_{r}=10$，\n- 基本库仑前因子 $e^{2}/(4\\pi \\varepsilon_{0})=14.3996\\,\\mathrm{eV}\\cdot\\mathrm{\\AA}$。\n\n以电子伏特 (eV) 表示最终的能量修正值，并将您的答案四舍五入到四位有效数字。最终答案必须是单个实数值。", "solution": "该问题已经过分析，被认为是有效的。它在科学上基于静电学和计算材料科学的原理，提法得当，信息充分且一致，措辞客观。\n\n**第一部分：有限尺寸修正的推导**\n\n我们考虑一个计算晶胞，它被描述为一个边长为 $L$ 的简单立方盒子。在此晶胞内，有一个 QM 区域，其净电荷为 $Q=qe$，其中 $q$ 是以基本电荷 $e$ 为单位的净电荷。该系统在三维空间中周期性复制。整个系统嵌入在一个均匀、线性、各向同性的介电介质中，其相对介电常数为 $\\varepsilon_r$，代表 MM 环境。为了处理非中性晶胞的长程静电相互作用，在整个模拟体积中引入了均匀的中和背景电荷密度 $\\rho_{\\mathrm{b}} = -Q/L^3$。\n\n为这个人造周期性系统计算的总能量 $E_{\\mathrm{periodic}}(L)$，与无限大介质中相应孤立缺陷的能量 $E_{\\mathrm{iso}}$ 不同。其差值 $\\Delta E(L) = E_{\\mathrm{periodic}}(L) - E_{\\mathrm{iso}}$ 即为有限尺寸误差。我们需要找到对于大的 $L$ 该误差的主导项。\n\n该误差的主要来源是中心晶胞中的电荷分布与其所有周期性镜像之间的虚假静电相互作用，包括与中和背景电荷的相互作用。对于一个带有净电荷 $Q$ 的系统，对这个虚假能量的主要、主导阶贡献是单极-单极相互作用项。\n\n该项对应于一个无限点电荷 $Q$ 晶格的马德隆能量，这些点电荷放置在周期性晶格的格点上，并浸没在均匀的补偿背景电荷中。问题陈述模拟晶胞是简单立方的，对此类系统的 Ewald 求和定义给出了每个晶胞的能量。对于在真空中、间距为 $L$ 的简单立方排列的点电荷 $Q$ 晶格，该能量由下式给出：\n$$E_{\\mathrm{Madelung, vac}} = \\frac{\\alpha_{\\mathrm{M}} Q^2}{2L(4\\pi\\varepsilon_0)}$$\n此处，$\\alpha_{\\mathrm{M}}$ 是马德隆常数，一个依赖于晶格几何形状的无量纲量。对于简单立方晶格，其值为 $\\alpha_{\\mathrm{M}} = 2.837297$。\n\n问题指明整个系统嵌入在相对介电常数为 $\\varepsilon_r$ 的介电连续体中。在线性介电响应的假设下，所有静电相互作用都被因子 $1/\\varepsilon_r$ 屏蔽。因此，真空介电常数 $\\varepsilon_0$ 必须被介质的介电常数 $\\varepsilon = \\varepsilon_r \\varepsilon_0$ 替代。将此应用于马德隆能量表达式，我们得到在介电介质中的虚假相互作用能：\n$$\\Delta E = \\frac{\\alpha_{\\mathrm{M}} Q^2}{2L(4\\pi\\varepsilon_0\\varepsilon_r)}$$\n代入 $Q=qe$，我们得到有限尺寸修正主导项的最终表达式：\n$$\\Delta E = \\frac{\\alpha_{\\mathrm{M}} (qe)^2}{2L(4\\pi\\varepsilon_0\\varepsilon_r)}$$\n使用给定的基本库仑前因子 $e^2/(4\\pi\\varepsilon_0)$，该表达式可以方便地重写为：\n$$\\Delta E = \\frac{\\alpha_{\\mathrm{M}} q^2}{2L\\varepsilon_r} \\left(\\frac{e^2}{4\\pi\\varepsilon_0}\\right)$$\n这就是所求的结果。它清楚地表明，主导项修正与 $\\mathcal{O}(1/L)$ 成比例，其大小由晶格几何通过依赖于形状的常数 $\\alpha_{\\mathrm{M}}$ 决定。\n\n**第二部分：数值计算**\n\n现在我们需要使用推导出的公式和给定的参数来计算该修正能量 $\\Delta E$ 的数值：\n- 净电荷：$q=+1$\n- 马德隆常数（简单立方）：$\\alpha_{\\mathrm{M}} = 2.837297$\n- 盒子长度：$L = 25\\,\\mathrm{\\AA}$\n- MM 相对介电常数：$\\varepsilon_{r} = 10$\n- 库仑前因子：$\\frac{e^2}{4\\pi\\varepsilon_0} = 14.3996\\,\\mathrm{eV}\\cdot\\mathrm{\\AA}$\n\n将这些值代入 $\\Delta E$ 的表达式中：\n$$\\Delta E = \\frac{(2.837297) \\cdot (1)^2}{2 \\cdot (25\\,\\mathrm{\\AA}) \\cdot (10)} \\left(14.3996\\,\\mathrm{eV}\\cdot\\mathrm{\\AA}\\right)$$\n首先，我们计算分母：\n$$2 \\cdot 25 \\cdot 10 = 500$$\n表达式简化为：\n$$\\Delta E = \\frac{2.837297 \\cdot 14.3996}{500} \\, \\mathrm{eV}$$\n现在，我们计算分子中的乘积：\n$$2.837297 \\cdot 14.3996 \\approx 40.8558257$$\n最后，我们进行除法运算：\n$$\\Delta E \\approx \\frac{40.8558257}{500} \\, \\mathrm{eV} \\approx 0.08171165\\,\\mathrm{eV}$$\n问题要求答案四舍五入到四位有效数字。\n$$\\Delta E \\approx 0.08171\\,\\mathrm{eV}$$\n这个正值表示由人为的周期性边界条件添加到系统中的能量。为了获得孤立系统的能量，应从为周期性系统计算的总能量中减去该值。", "answer": "$$\\boxed{0.08171}$$", "id": "3482082"}]}