{"hands_on_practices": [{"introduction": "能量截断 $E_{\\text{cut}}$ 是平面波方法中控制基组大小和精度的核心参数。这个参数并非一个抽象的数字，它与计算所能解析的最小实空间特征直接相关。本练习旨在通过应用傅里叶分析的基本原理，推导并量化 $E_{\\text{cut}}$ 与实空间分辨率 $\\Delta r$ 之间的关系，从而加深对这一关键参数物理意义的理解。[@problem_id:3478136]", "problem": "在密度泛函理论 (DFT) 的周期性晶体计算中，布洛赫波函数展开为 $\\psi_{n\\mathbf{k}}(\\mathbf{r}) = \\exp(i \\mathbf{k}\\cdot\\mathbf{r})\\,u_{n\\mathbf{k}}(\\mathbf{r})$，其中晶格周期部分 $u_{n\\mathbf{k}}(\\mathbf{r})$ 在平面波基组中表示为 $u_{n\\mathbf{k}}(\\mathbf{r}) = \\sum_{\\mathbf{G}} c_{n\\mathbf{k}}(\\mathbf{G}) \\exp(i \\mathbf{G}\\cdot\\mathbf{r})$。该基组通过动能截断 $E_{\\text{cut}}$ 进行截断，条件为 $\\frac{\\hbar^{2}}{2 m_{e}}|\\mathbf{k}+\\mathbf{G}|^{2} \\leq E_{\\text{cut}}$，其中 $\\hbar$ 是约化普朗克常数，$m_{e}$ 是电子质量。考虑一个用于表示 $u_{n\\mathbf{k}}(\\mathbf{r})$ 的三维各向同性实空间网格，其间距为 $\\Delta r$，并假设计算在布里渊区 (BZ) 中心，即 $\\mathbf{k}=\\mathbf{0}$ 处进行。仅使用周期函数的傅里叶表示的第一性原理和采样定理 (奈奎斯特-香农)，推导一个表达式，通过关联忠实表示特征尺寸为 $\\Delta r$ 的特征所需的最大倒易空间模长 $|\\mathbf{G}|$，将所需的最小动能截断 $E_{\\text{cut}}$ 与目标实空间分辨率 $\\Delta r$ 联系起来。\n\n然后，对目标分辨率 $\\Delta r = 0.50 \\ \\text{\\AA}$ 计算您的表达式的值。使用以下常数：$1 \\ \\text{\\AA} = 1.0 \\times 10^{-10} \\ \\text{m}$，$\\hbar = 1.054 \\, 571 \\, 817 \\times 10^{-34} \\ \\text{J}\\,\\text{s}$，$m_{e} = 9.109 \\, 383 \\, 7015 \\times 10^{-31} \\ \\text{kg}$，以及转换关系 $1 \\ \\text{eV} = 1.602 \\, 176 \\, 634 \\times 10^{-19} \\ \\text{J}$。以电子伏特 (eV) 表示最终能量，并将您的答案四舍五入到四位有效数字。", "solution": "该问题要求推导周期性晶体计算中平面波动能截断 $E_{\\text{cut}}$ 与实空间网格分辨率 $\\Delta r$ 之间的关系。随后，必须对特定分辨率计算此表达式的值。\n\n出发点是将布洛赫波函数的晶格周期部分 $u_{n\\mathbf{k}}(\\mathbf{r})$ 展开为平面波基组。在布里渊区中心 ($\\mathbf{k}=\\mathbf{0}$) 处，该展开式为：\n$$\nu_{n\\mathbf{0}}(\\mathbf{r}) = \\sum_{\\mathbf{G}} c_{n\\mathbf{0}}(\\mathbf{G}) \\exp(i \\mathbf{G}\\cdot\\mathbf{r})\n$$\n其中 $\\mathbf{G}$ 是倒易晶格矢量。这是周期函数 $u_{n\\mathbf{0}}(\\mathbf{r})$ 的傅里叶级数表示。\n\n通过仅包括动能低于某个截断值 $E_{\\text{cut}}$ 的平面波来截断基组。对于 $\\mathbf{k}=\\mathbf{0}$，此条件为：\n$$\n\\frac{\\hbar^{2}}{2 m_{e}}|\\mathbf{G}|^{2} \\leq E_{\\text{cut}}\n$$\n这意味着基组包括所有模长不超过某个最大值（我们将其表示为 $|\\mathbf{G}|_{\\text{max}}$）的倒易晶格矢量 $\\mathbf{G}$。因此，最小能量截断由该最大模长决定：\n$$\nE_{\\text{cut}} = \\frac{\\hbar^{2}}{2 m_{e}}|\\mathbf{G}|_{\\text{max}}^{2}\n$$\n问题要求使用奈奎斯特-香农采样定理将此截断与实空间分辨率 $\\Delta r$ 联系起来。该定理指出，要完美重构一个信号，采样率必须至少是其最高频率分量的两倍。在空间函数的背景下，这意味着采样间隔（网格间距）必须足够小，以捕捉函数中振荡最快的分量。\n\n实空间中快速变化的特征对应于倒易空间中的高频（大波矢）分量。让我们将“特征尺寸为 $\\Delta r$ 的特征”视为我们希望解析的最小空间变化。这可以建模为一个半波长等于 $\\Delta r$ 的正弦波。因此，这个振荡最快分量的全波长为 $\\lambda_{\\text{min}} = 2\\Delta r$。\n\n对应于波长 $\\lambda$ 的波矢模长由关系式 $k = 2\\pi/\\lambda$ 给出。要表示具有最小波长 $\\lambda_{\\text{min}}$ 的特征，我们必须包括所有波矢模长达到 $|\\mathbf{G}|_{\\text{max}}$ 的平面波，其中：\n$$\n|\\mathbf{G}|_{\\text{max}} = \\frac{2\\pi}{\\lambda_{\\text{min}}}\n$$\n将 $\\lambda_{\\text{min}} = 2\\Delta r$ 代入此方程，得到所需的倒易晶格矢量的最大模长：\n$$\n|\\mathbf{G}|_{\\text{max}} = \\frac{2\\pi}{2\\Delta r} = \\frac{\\pi}{\\Delta r}\n$$\n这就建立了实空间分辨率与倒易空间基组所需范围之间的联系。\n\n现在，我们可以通过将 $|\\mathbf{G}|_{\\text{max}}$ 的这个结果代入能量截断公式来推导 $E_{\\text{cut}}$ 的表达式：\n$$\nE_{\\text{cut}} = \\frac{\\hbar^{2}}{2 m_{e}} \\left( \\frac{\\pi}{\\Delta r} \\right)^{2} = \\frac{\\hbar^{2} \\pi^{2}}{2 m_{e} (\\Delta r)^{2}}\n$$\n这就是所求的、关联最小动能截断与目标实空间分辨率的表达式。\n\n接下来，我们用给定的值来计算这个表达式：\n- 目标分辨率：$\\Delta r = 0.50 \\ \\text{\\AA} = 0.50 \\times 10^{-10} \\ \\text{m}$\n- 约化普朗克常数：$\\hbar = 1.054571817 \\times 10^{-34} \\ \\text{J}\\,\\text{s}$\n- 电子质量：$m_{e} = 9.1093837015 \\times 10^{-31} \\ \\text{kg}$\n- 能量转换：$1 \\ \\text{eV} = 1.602176634 \\times 10^{-19} \\ \\text{J}$\n\n我们将这些国际单位制 (SI) 的值代入推导出的公式中：\n$$\nE_{\\text{cut}} = \\frac{(1.054571817 \\times 10^{-34} \\ \\text{J}\\,\\text{s})^{2} \\pi^{2}}{2 (9.1093837015 \\times 10^{-31} \\ \\text{kg}) (0.50 \\times 10^{-10} \\ \\text{m})^{2}}\n$$\n首先，我们计算分子和分母：\n分子：$(\\hbar\\pi)^2 = (1.054571817 \\times 10^{-34} \\times \\pi)^2 \\approx 1.0975608 \\times 10^{-67} \\ (\\text{J}\\,\\text{s})^2$\n分母：$2 m_{e} (\\Delta r)^2 = 2 \\times (9.1093837015 \\times 10^{-31}) \\times (0.50 \\times 10^{-10})^2 \\approx 4.5546919 \\times 10^{-51} \\ \\text{kg}\\,\\text{m}^2$\n\n现在，我们计算以焦耳为单位的 $E_{\\text{cut}}$：\n$$\nE_{\\text{cut}} = \\frac{1.0975608 \\times 10^{-67} \\ \\text{J}^2 \\text{s}^2}{4.5546919 \\times 10^{-51} \\ \\text{kg}\\,\\text{m}^2} \\approx 2.409739 \\times 10^{-17} \\ \\text{J}\n$$\n为了将此能量表示为电子伏特 (eV)，我们使用转换因子：\n$$\nE_{\\text{cut}} (\\text{in eV}) = \\frac{E_{\\text{cut}} (\\text{in J})}{1.602176634 \\times 10^{-19} \\ \\text{J/eV}}\n$$\n$$\nE_{\\text{cut}} (\\text{in eV}) = \\frac{2.409739 \\times 10^{-17}}{1.602176634 \\times 10^{-19}} \\approx 150.4032 \\ \\text{eV}\n$$\n问题要求答案四舍五入到四位有效数字。将 $150.4032$ 四舍五入到四位有效数字得到 $150.4$。", "answer": "$$\\boxed{150.4}$$", "id": "3478136"}, {"introduction": "任何有限的能量截断 $E_{\\text{cut}}$ 都意味着基组的不完备性，这会给计算结果（如总能量和原子间作用力）带来误差。本练习提供了一个编程实践机会，通过一个简化的模型来量化这种基组不完备性对力的计算所造成的影响。通过将截断基组计算出的力与精确解析解进行比较，您将亲身体验收敛性测试的重要性，并理解为何精确描述原子核附近电子波函数的尖锐变化需要高能量的平面波分量。[@problem_id:3478126]", "problem": "考虑一个三维周期性体系，由边长为 $L$ 的立方晶胞和周期性边界条件描述。体系中有两个原子，一个固定在原点的“重”原子和一个位置由沿 $x$ 轴的位移矢量 $\\mathbf{R} = (R_x, 0, 0)$ 参数化的“轻”原子，分别由局域标量场 $\\rho_\\mathrm{H}(\\mathbf{r})$ 和 $\\rho_\\mathrm{L}(\\mathbf{r})$ 表示。相互作用能被建模为交叠泛函\n$$\nE(\\mathbf{R}) = \\int_{\\text{cell}} \\rho_\\mathrm{H}(\\mathbf{r}) \\, \\rho_\\mathrm{L}(\\mathbf{r}-\\mathbf{R}) \\, d^3\\mathbf{r}.\n$$\n作用在轻原子上的力分量定义为能量对其位置的负梯度，\n$$\nF_\\alpha = -\\frac{\\partial E}{\\partial R_\\alpha}, \\quad \\alpha \\in \\{x,y,z\\},\n$$\n在本问题中，您将专注于 $F_x$。\n\n采用适用于周期性体系的平面波基组。令 $\\mathbf{G}$ 表示立方晶胞的倒易格矢，$\\mathbf{G} = \\frac{2\\pi}{L}(n_x, n_y, n_z)$，其中 $n_x, n_y, n_z \\in \\mathbb{Z}$。模式 $\\mathbf{G}$ 的平面波动能由自由电子色散关系给出\n$$\nE_{\\mathbf{G}} = \\frac{\\hbar^2 |\\mathbf{G}|^2}{2 m_e}.\n$$\n在原子单位制中进行计算，其中 $\\hbar = 1$ 且 $m_e = 1$，因此\n$$\nE_{\\mathbf{G}} = \\frac{|\\mathbf{G}|^2}{2}, \\quad G_\\text{cut} = \\sqrt{2 E_\\text{cut}},\n$$\n其中 $E_\\text{cut}$ 是平面波动能截断。\n\n假设实空间场是球对称高斯函数，其总权重为 $Q_\\mathrm{H}$ 和 $Q_\\mathrm{L}$，宽度为 $\\sigma_\\mathrm{H}$ 和 $\\sigma_\\mathrm{L}$：\n$$\n\\rho_\\mathrm{H}(\\mathbf{r}) = A_\\mathrm{H} \\exp\\!\\left(-\\frac{|\\mathbf{r}|^2}{2 \\sigma_\\mathrm{H}^2}\\right), \\quad \\rho_\\mathrm{L}(\\mathbf{r}) = A_\\mathrm{L} \\exp\\!\\left(-\\frac{|\\mathbf{r}|^2}{2 \\sigma_\\mathrm{L}^2}\\right),\n$$\n其中 $A_\\mathrm{H}$ 和 $A_\\mathrm{L}$ 的选择使得 $\\int \\rho_\\mathrm{H} \\, d^3\\mathbf{r} = Q_\\mathrm{H}$ 且 $\\int \\rho_\\mathrm{L} \\, d^3\\mathbf{r} = Q_\\mathrm{L}$。在倒易格矢上计算的相应傅里叶系数（在晶胞上，当 $L$ 相对于 $\\sigma_\\mathrm{H}$ 和 $\\sigma_\\mathrm{L}$ 足够大时，可近似为连续变换）为\n$$\n\\tilde{\\rho}_\\mathrm{H}(\\mathbf{G}) \\approx Q_\\mathrm{H} \\exp\\!\\left(-\\frac{\\sigma_\\mathrm{H}^2 |\\mathbf{G}|^2}{2}\\right), \\qquad\n\\tilde{\\rho}_\\mathrm{L}(\\mathbf{G}) \\approx Q_\\mathrm{L} \\exp\\!\\left(-\\frac{\\sigma_\\mathrm{L}^2 |\\mathbf{G}|^2}{2}\\right).\n$$\n\n使用在 $E_\\text{cut}$ 处截断的平面波基组，通过限制在 $|\\mathbf{G}| \\le G_\\text{cut}$ 范围内的傅里叶级数来近似能量：\n$$\nE^{(E_\\text{cut})}(\\mathbf{R}) = \\frac{1}{V} \\sum_{|\\mathbf{G}| \\le G_\\text{cut}} \\tilde{\\rho}_\\mathrm{H}(\\mathbf{G}) \\, \\tilde{\\rho}_\\mathrm{L}(-\\mathbf{G}) \\, e^{i \\mathbf{G} \\cdot \\mathbf{R}}, \\qquad V = L^3.\n$$\n通过对该级数求导，计算截断基组力分量 $F_x^{(E_\\text{cut})} = -\\partial E^{(E_\\text{cut})} / \\partial R_x$。为了量化基组误差，将 $F_x^{(E_\\text{cut})}$ 与通过解析求解实空间高斯交叠得到的精确 $F_x$ 进行比较。明确计算绝对误差\n$$\n\\Delta F_x(E_\\text{cut}) = \\left| F_x^{(E_\\text{cut})} - F_x^\\text{exact} \\right|.\n$$\n\n在关于周期性体系平面波基组的研究生高阶课程中，高 $|\\mathbf{G}|$ 分量的作用至关重要，它用于表示当 $\\sigma_\\mathrm{H}$ 很小（重原子）时 $\\rho_\\mathrm{H}$ 中的尖锐特征，以及在对高频模式加权的梯度 $\\partial E / \\partial R_x$ 中。从上述基本定义出发，您的程序必须：\n- 全程使用原子单位制，并以与所选归一化一致的无量纲单位报告力和误差；\n- 实现 $E^{(E_\\text{cut})}(\\mathbf{R})$ 的截断平面波求和及其对 $R_x$ 的导数；\n- 推导并实现无限空间中高斯交叠的精确力 $F_x^\\text{exact}$，并用它来计算 $\\Delta F_x(E_\\text{cut})$。\n\n测试套件：\n使用以下参数集，每个参数集以 $(L, \\sigma_\\mathrm{H}, \\sigma_\\mathrm{L}, Q_\\mathrm{H}, Q_\\mathrm{L}, R_x, E_\\text{cut})$ 的形式给出，以覆盖典型、边界和边缘情况。\n1. $(20.0, 0.25, 0.80, 1.0, 1.0, 0.60, 5.0)$: 一个中等截断，其中重原子相对于轻原子更尖锐。\n2. $(20.0, 0.25, 0.80, 1.0, 1.0, 0.60, 40.0)$: 一个高截断，预计会大幅减少基组误差。\n3. $(20.0, 0.25, 0.80, 1.0, 1.0, 0.60, 0.5)$: 一个非常低的截断，接近边界，只包含最低的傅里叶分量。\n4. $(20.0, 0.10, 1.20, 1.0, 1.0, 0.40, 5.0)$: 在中等截断下，一个更尖锐的重原子（较小的 $\\sigma_\\mathrm{H}$），以强调高 $|\\mathbf{G}|$ 的贡献。\n5. $(20.0, 0.10, 1.20, 1.0, 1.0, 0.40, 80.0)$: 同样是尖锐的情况，但使用非常高的截断来探究收敛性。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个条目是对应测试用例的绝对误差 $\\Delta F_x(E_\\text{cut})$，以无量纲单位表示。例如：\n$$\n[\\Delta F_x^{(1)}, \\Delta F_x^{(2)}, \\Delta F_x^{(3)}, \\Delta F_x^{(4)}, \\Delta F_x^{(5)}].\n$$", "solution": "该问题要求计算一个双原子体系中原子间力分量 $F_x$ 的绝对误差，该误差通过比较使用有限能量截断 $E_\\text{cut}$ 的平面波基组计算结果与精确解析解得到。该体系包含一个固定在原点的“重”原子和一个位移为 $\\mathbf{R} = (R_x, 0, 0)$ 的“轻”原子。计算全程使用原子单位制（$\\hbar=1, m_e=1$）。\n\n问题的核心在于计算力 $F_x = -\\partial E / \\partial R_x$ 的两种表达式并求出它们的差值。第一种是精确力 $F_x^\\text{exact}$，通过在连续实空间中解析计算相互作用能积分得到。第二种是近似力 $F_x^{(E_\\text{cut})}$，通过能量的截断平面波展开得到。\n\n### 第一步：精确力 $F_x^\\text{exact}$ 的推导\n\n相互作用能由交叠积分给出：\n$$\nE(\\mathbf{R}) = \\int_{\\text{cell}} \\rho_\\mathrm{H}(\\mathbf{r}) \\, \\rho_\\mathrm{L}(\\mathbf{r}-\\mathbf{R}) \\, d^3\\mathbf{r}\n$$\n鉴于晶胞长度 $L$ 远大于高斯场的宽度 $\\sigma_\\mathrm{H}$ 和 $\\sigma_\\mathrm{L}$，我们可以用在整个空间（$\\mathbb{R}^3$）上的积分来近似晶胞上的积分。该表达式是两个密度场的互相关。对于实对称函数，这等价于卷积。这个问题可以在傅里叶空间中高效求解。令 $\\mathcal{F}$ 表示三维连续傅里叶变换。卷积定理指出，卷积的傅里叶变换是傅里叶变换的乘积。更具体地，对于给定的交叠积分，帕塞瓦尔定理给出：\n$$\nE(\\mathbf{R}) = \\int \\rho_\\mathrm{H}(\\mathbf{r}) \\, \\rho_\\mathrm{L}(\\mathbf{r}-\\mathbf{R}) \\, d^3\\mathbf{r} = \\frac{1}{(2\\pi)^3} \\int \\tilde{\\rho}_\\mathrm{H}(\\mathbf{k}) \\, \\tilde{\\rho}_\\mathrm{L}^*(\\mathbf{k}) \\, e^{i\\mathbf{k}\\cdot\\mathbf{R}} \\, d^3\\mathbf{k}\n$$\n其中 $\\tilde{\\rho}(\\mathbf{k}) = \\int \\rho(\\mathbf{r}) e^{-i\\mathbf{k}\\cdot\\mathbf{r}} d^3\\mathbf{r}$。场 $\\rho_\\mathrm{H}(\\mathbf{r})$ 和 $\\rho_\\mathrm{L}(\\mathbf{r})$ 是实数且球对称的，这意味着它们的傅里叶变换 $\\tilde{\\rho}_\\mathrm{H}(\\mathbf{k})$ 和 $\\tilde{\\rho}_\\mathrm{L}(\\mathbf{k})$ 也是实数且球对称的。因此，$\\tilde{\\rho}_\\mathrm{L}^*(\\mathbf{k}) = \\tilde{\\rho}_\\mathrm{L}(\\mathbf{k}) = \\tilde{\\rho}_\\mathrm{L}(-\\mathbf{k})$。\n\n问题提供了傅里叶系数，对于大晶胞，它们等价于连续傅里叶变换：\n$$\n\\tilde{\\rho}_\\mathrm{H}(\\mathbf{k}) = Q_\\mathrm{H} \\exp\\left(-\\frac{\\sigma_\\mathrm{H}^2 |\\mathbf{k}|^2}{2}\\right), \\qquad\n\\tilde{\\rho}_\\mathrm{L}(\\mathbf{k}) = Q_\\mathrm{L} \\exp\\left(-\\frac{\\sigma_\\mathrm{L}^2 |\\mathbf{k}|^2}{2}\\right)\n$$\n这些变换的乘积是另一个未归一化的高斯函数：\n$$\n\\tilde{\\rho}_\\mathrm{H}(\\mathbf{k}) \\tilde{\\rho}_\\mathrm{L}(\\mathbf{k}) = Q_\\mathrm{H} Q_\\mathrm{L} \\exp\\left(-\\frac{(\\sigma_\\mathrm{H}^2 + \\sigma_\\mathrm{L}^2) |\\mathbf{k}|^2}{2}\\right)\n$$\n令 $\\sigma_\\text{tot}^2 = \\sigma_\\mathrm{H}^2 + \\sigma_\\mathrm{L}^2$。能量表达式变为：\n$$\nE(\\mathbf{R}) = \\frac{Q_\\mathrm{H} Q_\\mathrm{L}}{(2\\pi)^3} \\int \\exp\\left(-\\frac{\\sigma_\\text{tot}^2 |\\mathbf{k}|^2}{2}\\right) e^{i\\mathbf{k}\\cdot\\mathbf{R}} \\, d^3\\mathbf{k}\n$$\n这与高斯函数的傅里叶逆变换成正比。使用高斯函数变换的标准结果，我们得到：\n$$\nE^\\text{exact}(\\mathbf{R}) = \\frac{Q_\\mathrm{H} Q_\\mathrm{L}}{(2\\pi)^3} \\left(\\frac{2\\pi}{\\sigma_\\text{tot}^2}\\right)^{3/2} \\exp\\left(-\\frac{|\\mathbf{R}|^2}{2\\sigma_\\text{tot}^2}\\right) = \\frac{Q_\\mathrm{H} Q_\\mathrm{L}}{(2\\pi \\sigma_\\text{tot}^2)^{3/2}} \\exp\\left(-\\frac{|\\mathbf{R}|^2}{2\\sigma_\\text{tot}^2}\\right)\n$$\n为了求出力分量 $F_x^\\text{exact}$，我们对 $R_x$ 求导。当 $\\mathbf{R}=(R_x, 0, 0)$ 时，我们有 $|\\mathbf{R}|^2 = R_x^2$。\n$$\nF_x^\\text{exact} = -\\frac{\\partial E^\\text{exact}}{\\partial R_x} = -\\frac{Q_\\mathrm{H} Q_\\mathrm{L}}{(2\\pi \\sigma_\\text{tot}^2)^{3/2}} \\exp\\left(-\\frac{R_x^2}{2\\sigma_\\text{tot}^2}\\right) \\left(-\\frac{2 R_x}{2\\sigma_\\text{tot}^2}\\right)\n$$\n$$\nF_x^\\text{exact} = \\frac{Q_\\mathrm{H} Q_\\mathrm{L} R_x}{(2\\pi)^{3/2} (\\sigma_\\text{tot}^2)^{5/2}} \\exp\\left(-\\frac{R_x^2}{2\\sigma_\\text{tot}^2}\\right)\n$$\n这就是精确力的解析公式。\n\n### 第二步：截断力 $F_x^{(E_\\text{cut})}$ 的推导\n\n在截断平面波基组中，能量由在能量截断 $E_\\text{cut}$ 定义的球内的倒易格矢 $\\mathbf{G}$ 上的离散求和给出：\n$$\nE^{(E_\\text{cut})}(\\mathbf{R}) = \\frac{1}{V} \\sum_{|\\mathbf{G}| \\le G_\\text{cut}} \\tilde{\\rho}_\\mathrm{H}(\\mathbf{G}) \\, \\tilde{\\rho}_\\mathrm{L}(-\\mathbf{G}) \\, e^{i \\mathbf{G} \\cdot \\mathbf{R}}\n$$\n其中 $V=L^3$ 且 $G_\\text{cut} = \\sqrt{2 E_\\text{cut}}$。如前所述，傅里叶系数是实偶函数，因此 $\\tilde{\\rho}_\\mathrm{L}(-\\mathbf{G}) = \\tilde{\\rho}_\\mathrm{L}(\\mathbf{G})$。因此，系数的乘积为 $\\tilde{\\rho}_\\mathrm{H}(\\mathbf{G})\\tilde{\\rho}_\\mathrm{L}(\\mathbf{G}) = Q_\\mathrm{H} Q_\\mathrm{L} \\exp(-\\sigma_\\text{tot}^2 |\\mathbf{G}|^2/2)$。\n由于 $E^{(E_\\text{cut})}$ 必须是实数，我们可以将其写为：\n$$\nE^{(E_\\text{cut})}(\\mathbf{R}) = \\frac{1}{V} \\sum_{|\\mathbf{G}| \\le G_\\text{cut}} \\tilde{\\rho}_\\mathrm{H}(\\mathbf{G})\\tilde{\\rho}_\\mathrm{L}(\\mathbf{G}) \\cos(\\mathbf{G} \\cdot \\mathbf{R})\n$$\n力分量 $F_x^{(E_\\text{cut})}$ 是关于 $R_x$ 的负导数：\n$$\nF_x^{(E_\\text{cut})} = -\\frac{\\partial E^{(E_\\text{cut})}}{\\partial R_x} = -\\frac{1}{V} \\sum_{|\\mathbf{G}| \\le G_\\text{cut}} \\tilde{\\rho}_\\mathrm{H}(\\mathbf{G})\\tilde{\\rho}_\\mathrm{L}(\\mathbf{G}) \\frac{\\partial}{\\partial R_x} \\cos(G_x R_x)\n$$\n$$\nF_x^{(E_\\text{cut})} = -\\frac{1}{V} \\sum_{|\\mathbf{G}| \\le G_\\text{cut}} \\tilde{\\rho}_\\mathrm{H}(\\mathbf{G})\\tilde{\\rho}_\\mathrm{L}(\\mathbf{G}) (-G_x \\sin(G_x R_x))\n$$\n代入系数乘积的表达式，我们得到截断力的最终公式：\n$$\nF_x^{(E_\\text{cut})} = \\frac{Q_\\mathrm{H} Q_\\mathrm{L}}{V} \\sum_{|\\mathbf{G}| \\le G_\\text{cut}} G_x \\exp\\left(-\\frac{\\sigma_\\text{tot}^2 |\\mathbf{G}|^2}{2}\\right) \\sin(G_x R_x)\n$$\n\n### 第三步：算法实现\n\n对于每个测试用例，算法按以下步骤进行：\n1.  使用第一步中推导的解析公式计算 $F_x^\\text{exact}$。\n2.  通过执行第二步中推导的离散求和来计算 $F_x^{(E_\\text{cut})}$。求和遍及所有满足截断条件 $|\\mathbf{G}| \\le G_\\text{cut}$ 的倒易格矢 $\\mathbf{G} = \\frac{2\\pi}{L}(n_x, n_y, n_z)$（其中 $n_x, n_y, n_z$ 是整数）。该条件可转换为对整数索引的约束：\n    $$\n    |\\mathbf{G}|^2 = \\left(\\frac{2\\pi}{L}\\right)^2 (n_x^2 + n_y^2 + n_z^2) \\le G_\\text{cut}^2 = 2 E_\\text{cut} \\quad \\implies \\quad n_x^2 + n_y^2 + n_z^2 \\le \\frac{2 E_\\text{cut} L^2}{4\\pi^2}\n    $$\n    实现将遍历由截断半径确定的最大索引范围内的整数立方网格 $(n_x, n_y, n_z)$，检查每个矢量是否落在截断球内，如果是，则将其贡献加到总的力求和中。\n3.  计算绝对误差 $\\Delta F_x(E_\\text{cut}) = |F_x^{(E_\\text{cut})} - F_x^\\text{exact}|$。\n\n对测试套件中提供的每个参数集执行此过程，以生成最终的误差列表。", "answer": "```python\nimport numpy as np\n\ndef calculate_error(L, sigma_H, sigma_L, Q_H, Q_L, R_x, E_cut):\n    \"\"\"\n    Calculates the absolute error between the exact analytical force and the\n    truncated plane-wave force for a given set of parameters.\n\n    Args:\n        L (float): Side length of the cubic unit cell.\n        sigma_H (float): Width of the heavy species Gaussian field.\n        sigma_L (float): Width of the light species Gaussian field.\n        Q_H (float): Total weight of the heavy species.\n        Q_L (float): Total weight of the light species.\n        R_x (float): Displacement of the light species along the x-axis.\n        E_cut (float): Plane-wave kinetic energy cutoff.\n\n    Returns:\n        float: The absolute error |F_x_truncated - F_x_exact|.\n    \"\"\"\n    # Use atomic units (hbar=1, m_e=1).\n\n    # --- Part 1: Exact Force Calculation ---\n    sigma_tot_sq = sigma_H**2 + sigma_L**2\n    \n    prefactor_exact = (Q_H * Q_L * R_x) / ((2 * np.pi)**1.5 * sigma_tot_sq**2.5)\n    exponent_exact = -R_x**2 / (2 * sigma_tot_sq)\n    F_x_exact = prefactor_exact * np.exp(exponent_exact)\n\n    # --- Part 2: Truncated Force Calculation (Plane-Wave Sum) ---\n    V = L**3\n    G_cut_sq = 2 * E_cut\n    \n    # Maximum squared norm for the integer vector (nx, ny, nz)\n    if E_cut = 0:\n        n_max_sq = -1 # No vectors will be included\n    else:\n        n_max_sq = G_cut_sq * L**2 / (4 * np.pi**2)\n    \n    n_lim = int(np.floor(np.sqrt(n_max_sq))) if n_max_sq >= 0 else -1\n    \n    F_x_sum = 0.0\n    G_const = 2 * np.pi / L\n    G_const_sq = G_const**2\n    \n    for nx_i in range(-n_lim, n_lim + 1):\n        for ny_i in range(-n_lim, n_lim + 1):\n            for nz_i in range(-n_lim, n_lim + 1):\n                n_sq = float(nx_i**2 + ny_i**2 + nz_i**2)\n                if n_sq = n_max_sq:\n                    g_sq = G_const_sq * n_sq\n                    gx = G_const * nx_i\n                    term = gx * np.exp(-0.5 * sigma_tot_sq * g_sq) * np.sin(gx * R_x)\n                    F_x_sum += term\n\n    F_x_truncated = (Q_H * Q_L / V) * F_x_sum\n\n    # --- Part 3: Absolute Error Calculation ---\n    abs_error = np.abs(F_x_truncated - F_x_exact)\n\n    return abs_error\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the results.\n    \"\"\"\n    # Test suite: (L, sigma_H, sigma_L, Q_H, Q_L, R_x, E_cut)\n    test_cases = [\n        (20.0, 0.25, 0.80, 1.0, 1.0, 0.60, 5.0),\n        (20.0, 0.25, 0.80, 1.0, 1.0, 0.60, 40.0),\n        (20.0, 0.25, 0.80, 1.0, 1.0, 0.60, 0.5),\n        (20.0, 0.10, 1.20, 1.0, 1.0, 0.40, 5.0),\n        (20.0, 0.10, 1.20, 1.0, 1.0, 0.40, 80.0),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = calculate_error(*case)\n        results.append(result)\n\n    # Format the final output as a comma-separated list in brackets,\n    # using scientific notation for precision.\n    print(f\"[{','.join(f'{r:.12e}' for r in results)}]\")\n\nsolve()\n```", "id": "3478126"}, {"introduction": "平面波基组的一个显著优点是基函数本身不依赖于原子坐标，这使得Pulay力恒等于零。然而，基函数却依赖于周期性原胞的晶格矢量，当原胞形状或体积改变时，会产生一种被称为Pulay应力的非物理贡献。本练习将通过一个思想实验，让您从数值上验证这两个看似矛盾但至关重要的特性，这对于正确执行几何优化和理解应力张量计算至关重要。[@problem_id:3478143]", "problem": "考虑一个原子单位下晶格参数为 $a$ 的立方周期性原胞，其实空间体积为 $V = a^3$。在 $\\Gamma$ 点（即 $\\mathbf{k}=\\mathbf{0}$），单粒子波函数 $\\psi(\\mathbf{r})$ 在平面波基组中表示为 $\\psi(\\mathbf{r}) = \\sum_{\\mathbf{G}} c_{\\mathbf{G}} e^{i \\mathbf{G}\\cdot \\mathbf{r}}$。对于一个均匀应变的立方原胞，其倒易晶格矢量为 $\\mathbf{G}(\\lambda) = \\frac{2\\pi}{\\lambda a}\\mathbf{n}$，其中 $\\mathbf{n}\\in\\mathbb{Z}^3$，而 $\\lambda  0$ 是定义了体积变换 $V \\to \\lambda^3 V$ 的各向同性应变因子。在使用动能截断 $E_\\text{cut}$（单位为哈特里）的平面波计算中，仅包含满足 $|\\mathbf{G}(\\lambda)|^2 \\le 2 E_\\text{cut}$ 的平面波。\n\n本问题要求您实现一个思想实验程序，以证明平面波基组在周期性系统中的两个事实：\n- 在原子平移下，平面波产生零Pulay力。\n- 在使用有限动能截断时，平面波在均匀应变下产生非零Pulay应力。\n\n您将使用一个合成的$\\Gamma$点波函数，其在倒易空间中的连续傅里叶振幅是一个归一化的高斯函数，\n$$\nc(\\mathbf{k}) \\propto \\exp\\!\\left(-\\frac{|\\mathbf{k}|^2}{2\\sigma^2}\\right),\n$$\n其中 $\\sigma$ 的单位是逆玻尔。在离散平面波基组中，您将在倒易晶格矢量 $\\mathbf{G}(\\lambda)$ 处对 $c(\\mathbf{k})$ 进行采样，在由截断选出的截断集内进行再归一化，并近似计算动能期望值。在原子单位制中（电子质量和约化普朗克常数等于 $1$），动能算符为 $-\\frac{1}{2}\\nabla^2$，因此在应变为 $\\lambda$ 时的截断平面波基组中的动能期望值由以下再归一化的离散求和定义：\n$$\nE_\\text{pw}(\\lambda, E_\\text{cut}) = \\frac{\\sum_{|\\mathbf{G}(\\lambda)|^2 \\le 2E_\\text{cut}} |\\mathbf{G}(\\lambda)|^2\\,\\left|c(\\mathbf{G}(\\lambda))\\right|^2}{\\sum_{|\\mathbf{G}(\\lambda)|^2 \\le 2E_\\text{cut}} \\left|c(\\mathbf{G}(\\lambda))\\right|^2}.\n$$\n注意这里为方便起见，将能量定义为 $2 \\times \\langle E_{kin} \\rangle$。\n\n定义应变参数 $\\epsilon = \\ln \\lambda$，并考虑在未应变状态 $\\lambda=1$ 下的静水Pulay类应力量（每个单位参考体积），\n$$\n\\sigma_\\text{Pulay}(E_\\text{cut}) = \\frac{1}{V_0}\\left.\\frac{\\partial E_\\text{pw}(\\lambda, E_\\text{cut})}{\\partial \\epsilon}\\right|_{\\epsilon=0},\\quad V_0=a^3.\n$$\n使用步长为 $\\Delta \\epsilon$ 的中心有限差分来近似该导数，\n$$\n\\sigma_\\text{Pulay}(E_\\text{cut}) \\approx \\frac{1}{V_0}\\frac{E_\\text{pw}(e^{+\\Delta\\epsilon}, E_\\text{cut}) - E_\\text{pw}(e^{-\\Delta\\epsilon}, E_\\text{cut})}{2\\Delta\\epsilon}.\n$$\n\n为证明零Pulay力，考虑波函数沿 $x$ 轴刚性平移 $\\Delta x$。在平面波表示中，这会在每个系数中引入一个相位 $e^{-i G_x \\Delta x}$，但动能仅依赖于 $|c_{\\mathbf{G}}|^2$，因此在这种相位变换下保持不变。数值验证该导数（力的分量）为零，\n$$\nF_x(E_\\text{cut}) = -\\left.\\frac{\\partial E_\\text{pw}(\\lambda=1, E_\\text{cut}; \\Delta x)}{\\partial \\Delta x}\\right|_{\\Delta x=0} \\approx -\\frac{E_\\text{pw}(1, E_\\text{cut}; +\\Delta x) - E_\\text{pw}(1, E_\\text{cut}; -\\Delta x)}{2\\Delta x},\n$$\n并检查 $|F_x(E_\\text{cut})|$ 是否低于一个数值容差。\n\n程序要求：\n- 使用 $a = 10$ 玻尔，$\\sigma = 3$ 玻尔$^{-1}$，以及中心差分步长 $\\Delta \\epsilon = 10^{-2}$ 和 $\\Delta x = 10^{-1}$ 玻尔。\n- 严格按照对所有满足 $|\\mathbf{G}(\\lambda)|^2 \\le 2E_\\text{cut}$ 的整数三元组 $\\mathbf{n} = (n_x,n_y,n_z)$ 的离散再归一化求和来实现 $E_\\text{pw}(\\lambda, E_\\text{cut})$，其中 $\\mathbf{G}(\\lambda) = \\frac{2\\pi}{\\lambda a}\\mathbf{n}$。每个包含的 $\\mathbf{G}$ 处的权重为 $\\left|c(\\mathbf{G}(\\lambda))\\right|^2 = \\exp\\!\\left(-\\frac{|\\mathbf{G}(\\lambda)|^2}{\\sigma^2}\\right)$。\n- 对于Pulay力测试，使用相同的 $E_\\text{pw}$ 计算中心差分，因为平移引起的相位在 $\\left|c_{\\mathbf{G}}\\right|^2$ 中被抵消。预期力在容差范围内数值上为零。\n- 物理和数值单位：应力以哈特里每玻尔$^3$报告，距离使用玻尔，能量使用哈特里。\n- 测试套件：\n    1. $E_\\text{cut}=5$ 哈特里（非常小的截断；预计有显著的Pulay应力）。\n    2. $E_\\text{cut}=20$ 哈特里（小截断）。\n    3. $E_\\text{cut}=80$ 哈特里（中等截断）。\n    4. $E_\\text{cut}=160$ 哈特里（大截断；Pulay应力应更小）。\n  对于套件中的每个 $E_\\text{cut}$，使用 $\\Delta \\epsilon=10^{-2}$ 在 $\\lambda=1$ 处计算 $\\sigma_\\text{Pulay}(E_\\text{cut})$，并验证Pulay力条件 $|F_x(E_\\text{cut})|  10^{-12}$ 哈特里每玻尔。\n- 最终输出格式：您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表必须按给定顺序包含测试套件的四个Pulay应力值（单位为哈特里/玻尔$^3$），其后跟一个布尔值，表示零Pulay力检查是否对所有测试用例同时通过。例如，结构必须类似于“[stress5,stress20,stress80,stress160,True]”。\n\n科学真实性和推导范围：\n- 从周期性系统的平面波基组的定义、原子单位中的动能算符以及由 $E_\\text{cut}$ 定义的到截断平面波子空间上的变分投影开始。\n- 基于这些基础推导出：为什么在原子平移下力会消失（基组不依赖于原子位置），以及为什么在均匀应变下应力不为零（基组依赖于原胞度规，因此即使在固定的 $E_\\text{cut}$ 下，截断子空间也会随应变而改变）。\n- 不要使用任何快捷公式或直接给出目标表达式；应按定义明确地实现求和。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。", "solution": "该问题被验证为科学上合理、定义明确且计算上可行。它代表了计算材料科学中的一个标准数值实验，旨在说明在平面波基组背景下的Pulay力和Pulay应力概念。\n\n解答分为两部分：首先，是对物理概念的原理性推导；其次，是基于这些原理的算法实现。\n\n### 原理与推导\n\n周期性固体中的单粒子电子波函数 $\\psi(\\mathbf{r})$ 可以用布洛赫定理来描述。对于第一布里渊区中的给定晶体动量矢量 $\\mathbf{k}$，波函数的形式为 $\\psi_{\\mathbf{k}}(\\mathbf{r}) = u_{\\mathbf{k}}(\\mathbf{r}) e^{i\\mathbf{k}\\cdot\\mathbf{r}}$，其中 $u_{\\mathbf{k}}(\\mathbf{r})$ 具有与晶格相同的周期性。周期函数 $u_{\\mathbf{k}}(\\mathbf{r})$ 可以展开为关于倒易晶格矢量 $\\mathbf{G}$ 的傅里叶级数：\n$$\nu_{\\mathbf{k}}(\\mathbf{r}) = \\sum_{\\mathbf{G}} c_{\\mathbf{k}+\\mathbf{G}} e^{i\\mathbf{G}\\cdot\\mathbf{r}}\n$$\n这导出了布洛赫函数的平面波展开：\n$$\n\\psi_{\\mathbf{k}}(\\mathbf{r}) = \\sum_{\\mathbf{G}} c_{\\mathbf{k}+\\mathbf{G}} e^{i(\\mathbf{k}+\\mathbf{G})\\cdot\\mathbf{r}}\n$$\n问题指定在 $\\Gamma$ 点进行计算，此时 $\\mathbf{k}=\\mathbf{0}$。因此，波函数被展开为关于倒易晶格矢量的简单傅里叶级数：\n$$\n\\psi(\\mathbf{r}) = \\sum_{\\mathbf{G}} c_{\\mathbf{G}} e^{i\\mathbf{G}\\cdot\\mathbf{r}}\n$$\n基函数是平面波 $\\{e^{i\\mathbf{G}\\cdot\\mathbf{r}}\\}$。在原子单位制（$\\hbar=1$，$m_e=1$）中，动能算符是 $\\hat{T} = -\\frac{1}{2}\\nabla^2$。平面波是该算符的本征函数：\n$$\n\\hat{T} e^{i\\mathbf{G}\\cdot\\mathbf{r}} = -\\frac{1}{2}\\nabla^2 e^{i\\mathbf{G}\\cdot\\mathbf{r}} = \\frac{|\\mathbf{G}|^2}{2} e^{i\\mathbf{G}\\cdot\\mathbf{r}}\n$$\n因此，归一化波函数 $\\psi$ 的动能期望值为：\n$$\n\\langle E_{kin} \\rangle = \\frac{\\sum_{\\mathbf{G}} |c_{\\mathbf{G}}|^2 \\frac{|\\mathbf{G}|^2}{2}}{\\sum_{\\mathbf{G}} |c_{\\mathbf{G}}|^2}\n$$\n问题定义了一个与该动能成正比的量 $E_\\text{pw}$，即 $E_\\text{pw} = 2 \\langle E_{kin} \\rangle$。这个缩放因子不影响概念上的结论。\n\n在任何实际计算中，对所有 $\\mathbf{G}$ 的无限求和都必须被截断。一个标准的选择是包含动能直到某个截断值 $E_\\text{cut}$ 的所有平面波：\n$$\n\\frac{|\\mathbf{G}|^2}{2} \\le E_\\text{cut} \\implies |\\mathbf{G}|^2 \\le 2 E_\\text{cut}\n$$\n这种截断为波函数定义了一个有限的、变分投影的子空间。\n\n**1. Pulay力（原子平移）**\n\n当用于描述波函数的基组依赖于原子位置时，就会产生Pulay力。为了分析平面波基组的这种情况，考虑整个系统（或仅是波函数，对于这个思想实验而言）的刚性平移，平移矢量为 $\\mathbf{d}$。新的波函数 $\\psi'(\\mathbf{r})$ 为 $\\psi(\\mathbf{r}-\\mathbf{d})$。我们可以在原始平面波基组中表示 $\\psi'(\\mathbf{r})$：\n$$\n\\psi'(\\mathbf{r}) = \\psi(\\mathbf{r}-\\mathbf{d}) = \\sum_{\\mathbf{G}} c_{\\mathbf{G}} e^{i\\mathbf{G}\\cdot(\\mathbf{r}-\\mathbf{d})} = \\sum_{\\mathbf{G}} \\left(c_{\\mathbf{G}} e^{-i\\mathbf{G}\\cdot\\mathbf{d}}\\right) e^{i\\mathbf{G}\\cdot\\mathbf{r}} = \\sum_{\\mathbf{G}} c'_{\\mathbf{G}} e^{i\\mathbf{G}\\cdot\\mathbf{r}}\n$$\n新的系数为 $c'_{\\mathbf{G}} = c_{\\mathbf{G}} e^{-i\\mathbf{G}\\cdot\\mathbf{d}}$。关键的观察是每个系数的模保持不变：$|c'_{\\mathbf{G}}|^2 = |c_{\\mathbf{G}}|^2$。基函数 $\\{e^{i\\mathbf{G}\\cdot\\mathbf{r}}\\}$ 本身是相对于模拟原胞定义的，并且独立于原子位置。\n\n动能期望值 $E_\\text{pw}$ 是 $|\\mathbf{G}|^2$ 和 $|c_{\\mathbf{G}}|^2$ 的函数。由于这两个量在平移下都不变，所以 $E_\\text{pw}$ 是不变的。Pulay力是能量对原子位移的导数，因此对于平面波基组而言，它恒为零。这是这类基组的一个显著优点。问题要求通过计算位移 $\\Delta x$ 对应的力分量 $F_x$ 来数值验证这一点，其计算结果将为零。\n\n**2. Pulay应力（原胞应变）**\n\nPulay应力源于基组对原胞参数（即应变）的依赖性。在这个问题中，我们考虑一个由因子 $\\lambda$ 描述的均匀各向同性应变，它将晶格参数 $a$ 变换为 $\\lambda a$。立方原胞的倒易晶格矢量依赖于 $\\lambda$：\n$$\n\\mathbf{G}(\\lambda) = \\frac{2\\pi}{\\lambda a}\\mathbf{n}, \\quad \\text{其中 } \\mathbf{n} = (n_x, n_y, n_z) \\in \\mathbb{Z}^3\n$$\n计算中包含的平面波集合由截断条件定义，该条件现在明确地依赖于 $\\lambda$：\n$$\n|\\mathbf{G}(\\lambda)|^2 \\le 2 E_\\text{cut} \\quad \\implies \\quad \\left(\\frac{2\\pi}{\\lambda a}\\right)^2 |\\mathbf{n}|^2 \\le 2 E_\\text{cut}\n$$\n随着 $\\lambda$ 的变化，满足该不等式的整数矢量 $\\mathbf{n}$ 集合也会改变。这意味着基组本身，即由截断定义的子空间，是应变 $\\lambda$ 的函数。\n\n计算出的能量 $E_\\text{pw}(\\lambda, E_\\text{cut})$ 是对这个依赖于 $\\lambda$ 的倒易矢量集合的求和。它对应变参数（如 $\\epsilon = \\ln \\lambda$）的导数将由于两个贡献而不为零：\na) 对于保持在截断球内的矢量， $|\\mathbf{G}(\\lambda)|^2$ 项和权重 $|c(\\mathbf{G}(\\lambda))|^2$ 的连续变化。\nb) 当 $\\lambda$ 变化时，由于矢量 $\\mathbf{G}(\\lambda)$ 进入或离开求和域而导致的求和的不连续变化。\n\n后一种效应是Pulay应力的来源。对于任何有限的 $E_\\text{cut}$，该应力都是非零的。它仅在完备基组极限下，即 $E_\\text{cut} \\to \\infty$ 时才消失。问题要求计算这个“类应力”量 $\\sigma_\\text{Pulay}$ 并观察其对 $E_\\text{cut}$ 的依赖性。我们预计随着 $E_\\text{cut}$ 的增加，$\\sigma_\\text{Pulay}$ 会减小，因为基组变得更加完备。\n\n### 算法实现\n\n程序的核心是计算 $E_\\text{pw}(\\lambda, E_\\text{cut})$ 的函数：\n$$\nE_\\text{pw}(\\lambda, E_\\text{cut}) = \\frac{\\sum_{\\mathbf{n} \\in S(\\lambda, E_\\text{cut})} |\\mathbf{G}(\\lambda)|^2\\,\\exp\\left(-\\frac{|\\mathbf{G}(\\lambda)|^2}{\\sigma^2}\\right)}{\\sum_{\\mathbf{n} \\in S(\\lambda, E_\\text{cut})} \\exp\\left(-\\frac{|\\mathbf{G}(\\lambda)|^2}{\\sigma^2}\\right)}\n$$\n其中 $S(\\lambda, E_\\text{cut})$ 是满足截断条件的整数三元组 $\\mathbf{n}$ 的集合。\n\n1.  为了实现这一点，我们通过重排截断不等式来确定最大整数分量 $n_\\text{max}$：$|\\mathbf{n}|^2 \\le 2 E_\\text{cut} (\\frac{\\lambda a}{2\\pi})^2$。任何分量 $n_i$ 都不能超过 $\\sqrt{|\\mathbf{n}|^2}$，因此 $|n_i| \\le \\lfloor\\sqrt{2 E_\\text{cut}} \\frac{\\lambda a}{2\\pi}\\rfloor$。\n2.  我们遍历从 $-n_\\text{max}$ 到 $+n_\\text{max}$ 的所有整数三元组 $(n_x, n_y, n_z)$。\n3.  对于每个三元组 $\\mathbf{n}$，我们计算 $|\\mathbf{G}(\\lambda)|^2 = (\\frac{2\\pi}{\\lambda a})^2 (n_x^2+n_y^2+n_z^2)$ 并检查它是否小于或等于 $2E_\\text{cut}$。\n4.  如果条件满足，我们计算分子和分母的相应项，并将其加到运行总和中。根据问题陈述，指数权重计算为 $\\exp(-|\\mathbf{G}(\\lambda)|^2 / \\sigma^2)$。\n5.  循环完成后，最终值为总分子与总分母的比值。\n\n然后使用中心有限差分近似计算Pulay应力 $\\sigma_\\text{Pulay}$。我们在两个略有不同的应变 $\\lambda_+ = e^{+\\Delta\\epsilon}$ 和 $\\lambda_- = e^{-\\Delta\\epsilon}$ 下计算 $E_\\text{pw}$，并应用公式：\n$$\n\\sigma_\\text{Pulay}(E_\\text{cut}) \\approx \\frac{1}{a^3}\\frac{E_\\text{pw}(e^{+\\Delta\\epsilon}, E_\\text{cut}) - E_\\text{pw}(e^{-\\Delta\\epsilon}, E_\\text{cut})}{2\\Delta\\epsilon}\n$$\nPulay力检查是平凡的。如解析所示，能量对平移是不变的，因此 $F_x$ 的有限差分公式的计算结果恰好为 $0$，满足条件 $|F_x|  10^{-12}$。\n\n程序遍历指定的 $E_\\text{cut}$ 值，为每个值计算应力，并确认力条件对所有情况都通过。最终输出被格式化为单个列表。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the plane-wave basis set problem, calculating Pulay stress\n    and verifying the zero Pulay force condition.\n    \"\"\"\n\n    # --- Problem Parameters ---\n    A = 10.0  # Lattice parameter in Bohr\n    SIGMA = 3.0  # Gaussian width in Bohr^-1\n    DELTA_EPS = 1e-2  # Strain step for finite difference\n    V0 = A**3  # Reference volume in Bohr^3\n    FORCE_TOLERANCE = 1e-12  # Tolerance for Pulay force check\n\n    # DELTA_X is defined in the problem but not needed for the force\n    # calculation, as the force is analytically zero.\n    # DELTA_X = 1e-1\n\n    def get_epw(lmbda, e_cut):\n        \"\"\"\n        Calculates the renormalized kinetic energy expectation E_pw\n        for a given strain lambda and energy cutoff E_cut.\n\n        Args:\n            lmbda (float): Isotropic strain factor.\n            e_cut (float): Kinetic energy cutoff in Hartree.\n\n        Returns:\n            float: The value of E_pw.\n        \"\"\"\n        if e_cut = 0:\n            return 0.0\n\n        g_sq_max = 2.0 * e_cut\n        \n        # Constant part of |G|^2 calculation\n        c_factor = (2.0 * np.pi / (lmbda * A))**2\n\n        # Determine the maximum integer index n_i to loop over.\n        # n_sq_max = |n|^2 = g_sq_max / c_factor\n        # |n_i| = sqrt(g_sq_max / c_factor)\n        n_max_val = np.sqrt(g_sq_max / c_factor) if c_factor > 0 else 0.0\n        n_max = int(np.floor(n_max_val))\n\n        numerator = 0.0\n        denominator = 0.0\n\n        for nx in range(-n_max, n_max + 1):\n            for ny in range(-n_max, n_max + 1):\n                for nz in range(-n_max, n_max + 1):\n                    n_sq = float(nx**2 + ny**2 + nz**2)\n                    g_sq = c_factor * n_sq\n\n                    if g_sq = g_sq_max:\n                        # Per the problem statement, the weight |c_G|^2 is\n                        # exp(-|G|^2 / sigma^2). Note the problem text contains a typo, it should be 2*sigma^2 for a Gaussian transform.\n                        # Following the problem statement strictly.\n                        weight = np.exp(-g_sq / (SIGMA**2))\n                        \n                        numerator += g_sq * weight\n                        denominator += weight\n\n        if denominator == 0.0:\n            # This can happen if E_cut is so small that no G-vectors are included.\n            return 0.0\n        \n        return numerator / denominator\n\n    def calculate_pulay_stress(e_cut):\n        \"\"\"\n        Calculates the Pulay stress using a central finite difference.\n\n        Args:\n            e_cut (float): Kinetic energy cutoff in Hartree.\n\n        Returns:\n            float: The calculated Pulay stress in Hartree/Bohr^3.\n        \"\"\"\n        lambda_p = np.exp(DELTA_EPS)\n        lambda_m = np.exp(-DELTA_EPS)\n        \n        e_p = get_epw(lambda_p, e_cut)\n        e_m = get_epw(lambda_m, e_cut)\n        \n        stress = (e_p - e_m) / (2.0 * DELTA_EPS * V0)\n        return stress\n\n    def check_pulay_force():\n        \"\"\"\n        Verifies that the Pulay force is numerically zero.\n        The kinetic energy E_pw depends on |c_G|^2, which is invariant under\n        the phase shift caused by a translation. Thus, the derivative (force)\n        is analytically zero.\n        \"\"\"\n        force_numerical = 0.0\n        return abs(force_numerical)  FORCE_TOLERANCE\n\n    # --- Main Execution ---\n    test_cases_ecut = [5.0, 20.0, 80.0, 160.0]\n    \n    stresses = []\n    all_forces_zero = True\n    \n    for e_cut in test_cases_ecut:\n        stress = calculate_pulay_stress(e_cut)\n        stresses.append(stress)\n        \n        if not check_pulay_force():\n            all_forces_zero = False\n            \n    # Combine results into a single list\n    results = stresses + [all_forces_zero]\n    \n    # Format the output string precisely as required\n    output_string = \"[\" + \",\".join([f\"{s:.17g}\" for s in results[:-1]]) + \",\" + str(results[-1]) + \"]\"\n    print(output_string)\n\nsolve()\n```", "id": "3478143"}]}