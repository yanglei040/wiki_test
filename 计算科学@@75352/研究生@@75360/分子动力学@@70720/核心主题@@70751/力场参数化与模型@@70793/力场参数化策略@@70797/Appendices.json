{"hands_on_practices": [{"introduction": "力场中最基本的组成部分是描述键长和键角的谐振子势。这个练习将指导你如何从量子化学计算得出的势能面（PES）扫描数据中，推导并估算这些谐振子项的力常数。掌握这项技能是构建分子模型“骨架”的基础，它将理论计算与经典力场参数直接联系起来。[@problem_id:3432394]", "problem": "考虑一个三原子分子，其价力场模型（在分子动力学（MD）中）使用一个键长 $r$ 和一个键角 $\\theta$ 作为相关的内坐标。在平衡几何构型 $(r_0,\\theta_0)$ 下，进行了一次约束电子结构扫描，每次只移动一个内坐标，而另一个则保持其平衡值。相对于最小值的势能差 $\\Delta E \\equiv E(r,\\theta)-E(r_0,\\theta_0)$ 报告如下。\n\n键长扫描（固定 $\\theta=\\theta_0$）：\n- $\\Delta r = r-r_0 = \\pm 0.010$ nm 得到 $\\Delta E = 0.0750$ kJ mol$^{-1}$，\n- $\\Delta r = \\pm 0.020$ nm 得到 $\\Delta E = 0.3000$ kJ mol$^{-1}$，\n- $\\Delta r = \\pm 0.030$ nm 得到 $\\Delta E = 0.6750$ kJ mol$^{-1}$。\n\n键角扫描（固定 $r=r_0$）：\n- $\\Delta \\theta = \\theta-\\theta_0 = \\pm 0.05$ rad 得到 $\\Delta E = 0.4375$ kJ mol$^{-1}$，\n- $\\Delta \\theta = \\pm 0.08$ rad 得到 $\\Delta E = 1.1200$ kJ mol$^{-1}$，\n- $\\Delta \\theta = \\pm 0.10$ rad 得到 $\\Delta E = 1.7500$ kJ mol$^{-1}$。\n\n从势能 $E(r,\\theta)$ 在内坐标最小值点附近的泰勒展开式的定义以及梯度在最小值点为零的条件出发，推导沿 $r$ 的曲率和沿 $\\theta$ 的曲率如何定义价力场中使用的内坐标表示下的简谐价力场力常数。在通常的小位移假设下，根据上述数据估算键伸缩力常数 $k_b$ 和角弯曲力常数 $k_{\\theta}$。\n\n讨论进行这些估算时所涉及的物理近似，包括关于内坐标之间耦合和泰勒级数截断的任何假设。\n\n将您的数值估算结果四舍五入至四位有效数字。以 kJ mol$^{-1}$ nm$^{-2}$ 为单位报告 $k_b$，以 kJ mol$^{-1}$ rad$^{-2}$ 为单位报告 $k_{\\theta}$。在最终答案中，使用 LaTeX $\\texttt{pmatrix}$ 环境，按 $(k_b, k_{\\theta})$ 的顺序将两个值以行矩阵的形式提供。", "solution": "首先根据既定标准对问题进行验证。\n\n### 问题验证\n\n**步骤1：提取已知信息**\n\n*   **系统**：一个三原子分子，其内坐标为一个键长 $r$ 和一个键角 $\\theta$。\n*   **平衡几何构型**：$(r_0, \\theta_0)$。\n*   **势能定义**：$\\Delta E \\equiv E(r,\\theta)-E(r_0,\\theta_0)$。\n*   **键长扫描数据**（固定 $\\theta=\\theta_0$）：\n    *   对于位移 $\\Delta r = r-r_0 = \\pm 0.010$ nm，能量变化为 $\\Delta E = 0.0750$ kJ mol$^{-1}$。\n    *   对于位移 $\\Delta r = \\pm 0.020$ nm，能量变化为 $\\Delta E = 0.3000$ kJ mol$^{-1}$。\n    *   对于位移 $\\Delta r = \\pm 0.030$ nm，能量变化为 $\\Delta E = 0.6750$ kJ mol$^{-1}$。\n*   **键角扫描数据**（固定 $r=r_0$）：\n    *   对于位移 $\\Delta \\theta = \\theta-\\theta_0 = \\pm 0.05$ rad，能量变化为 $\\Delta E = 0.4375$ kJ mol$^{-1}$。\n    *   对于位移 $\\Delta \\theta = \\pm 0.08$ rad，能量变化为 $\\Delta E = 1.1200$ kJ mol$^{-1}$。\n    *   对于位移 $\\Delta \\theta = \\pm 0.10$ rad，能量变化为 $\\Delta E = 1.7500$ kJ mol$^{-1}$。\n*   **要求任务**：\n    1.  推导势能曲率与简谐力常数之间的关系。\n    2.  估算键伸缩力常数 $k_b$（单位 kJ mol$^{-1}$ nm$^{-2}$）和角弯曲力常数 $k_{\\theta}$（单位 kJ mol$^{-1}$ rad$^{-2}$）。\n    3.  讨论所涉及的物理近似。\n    4.  将数值估算结果四舍五入至四位有效数字。\n    5.  以行矩阵 $(k_b, k_{\\theta})$ 的形式报告最终答案。\n\n**步骤2：使用提取的已知信息进行验证**\n\n*   **科学依据**：该问题基于从量子力学势能面扫描参数化经典分子力学力场的标准和基本程序。泰勒展开、简谐近似和力常数等概念是物理化学和计算建模的核心。数据值在物理上是合理的。\n*   **问题定义明确**：该问题提供了充分、一致的数据，以在指定的简谐近似下确定所要求的参数。存在唯一解。\n*   **客观性**：问题以精确、定量且无偏见的语言陈述。\n\n**步骤3：结论与行动**\n\n该问题具有科学合理性、定义明确且客观。判定为**有效**。将提供完整解答。\n\n### 解题过程\n\n三原子分子的势能面 $E(r, \\theta)$ 可以在平衡几何构型 $(r_0, \\theta_0)$ 附近通过泰勒级数展开来近似。设 $\\Delta r = r-r_0$ 和 $\\Delta \\theta = \\theta-\\theta_0$。展开式为：\n$$\nE(r, \\theta) = E(r_0, \\theta_0) + \\left(\\frac{\\partial E}{\\partial r}\\right)_0 \\Delta r + \\left(\\frac{\\partial E}{\\partial \\theta}\\right)_0 \\Delta \\theta + \\frac{1}{2}\\left(\\frac{\\partial^2 E}{\\partial r^2}\\right)_0 (\\Delta r)^2 + \\frac{1}{2}\\left(\\frac{\\partial^2 E}{\\partial \\theta^2}\\right)_0 (\\Delta \\theta)^2 + \\left(\\frac{\\partial^2 E}{\\partial r \\partial \\theta}\\right)_0 \\Delta r \\Delta \\theta + \\mathcal{O}(3)\n$$\n其中下标 $0$ 表示在平衡点 $(r_0, \\theta_0)$ 处取值，$\\mathcal{O}(3)$ 代表位移的三阶及更高阶项。\n\n根据定义，平衡几何构型对应于势能面上的一个极小值点。在极小值点，势能的梯度为零。因此，一阶导数项为零：\n$$\n\\left(\\frac{\\partial E}{\\partial r}\\right)_0 = 0 \\quad \\text{和} \\quad \\left(\\frac{\\partial E}{\\partial \\theta}\\right)_0 = 0\n$$\n重排泰勒级数以表示能量差 $\\Delta E = E(r, \\theta) - E(r_0, \\theta_0)$，并在二阶项处截断（简谐近似），我们得到：\n$$\n\\Delta E \\approx \\frac{1}{2}\\left(\\frac{\\partial^2 E}{\\partial r^2}\\right)_0 (\\Delta r)^2 + \\frac{1}{2}\\left(\\frac{\\partial^2 E}{\\partial \\theta^2}\\right)_0 (\\Delta \\theta)^2 + \\left(\\frac{\\partial^2 E}{\\partial r \\partial \\theta}\\right)_0 \\Delta r \\Delta \\theta\n$$\n一个简单的价力场使用简谐函数来模拟与键伸缩和角弯曲相关的势能：\n$$\nE_{VFF} = E_0 + \\frac{1}{2} k_b (r-r_0)^2 + \\frac{1}{2} k_{\\theta} (\\theta-\\theta_0)^2\n$$\n或者用位移表示，$\\Delta E_{VFF} = \\frac{1}{2} k_b (\\Delta r)^2 + \\frac{1}{2} k_{\\theta} (\\Delta \\theta)^2$。\n\n通过比较截断的泰勒展开式与价力场的能量表达式，我们可以将力常数确定为势能面在平衡几何构型处的二阶导数（曲率）：\n$$\nk_b = \\left(\\frac{\\partial^2 E}{\\partial r^2}\\right)_0 \\quad \\text{和} \\quad k_{\\theta} = \\left(\\frac{\\partial^2 E}{\\partial \\theta^2}\\right)_0\n$$\n此推导明确假设耦合项（由混合偏导数 $\\left(\\frac{\\partial^2 E}{\\partial r \\partial \\theta}\\right)_0$ 表征）可以忽略不计。\n\n现在我们使用所提供的数据来估算这些力常数。\n\n**估算键伸缩力常数 $k_b$**\n\n键长扫描是在 $\\theta = \\theta_0$ 的条件下进行的，这意味着 $\\Delta \\theta = 0$。在此条件下，能量表达式简化为：\n$$\n\\Delta E = \\frac{1}{2} k_b (\\Delta r)^2\n$$\n可以重排该式以求解 $k_b$：\n$$\nk_b = \\frac{2 \\Delta E}{(\\Delta r)^2}\n$$\n我们可以使用提供的任何数据点来计算 $k_b$。让我们使用第一个数据点：$\\Delta r = 0.010$ nm 和 $\\Delta E = 0.0750$ kJ mol$^{-1}$。\n$$\nk_b = \\frac{2 \\times (0.0750 \\text{ kJ mol}^{-1})}{(0.010 \\text{ nm})^2} = \\frac{0.1500 \\text{ kJ mol}^{-1}}{0.0001 \\text{ nm}^2} = 1500 \\text{ kJ mol}^{-1} \\text{nm}^{-2}\n$$\n检验其他数据点可以证实这个值：\n对于 $\\Delta r = 0.020$ nm: $k_b = \\frac{2 \\times 0.3000}{0.0004} = 1500$ kJ mol$^{-1}$ nm$^{-2}$。\n对于 $\\Delta r = 0.030$ nm: $k_b = \\frac{2 \\times 0.6750}{0.0009} = 1500$ kJ mol$^{-1}$ nm$^{-2}$。\n数据完美地符合二次势，因此我们对 $k_b$ 的估算值为 $1500$ kJ mol$^{-1}$ nm$^{-2}$。表示为四位有效数字，即 $1.500 \\times 10^3$ kJ mol$^{-1}$ nm$^{-2}$。\n\n**估算角弯曲力常数 $k_{\\theta}$**\n\n键角扫描是在 $r = r_0$ 的条件下进行的，这意味着 $\\Delta r = 0$。能量表达式简化为：\n$$\n\\Delta E = \\frac{1}{2} k_{\\theta} (\\Delta \\theta)^2\n$$\n重排以求解 $k_{\\theta}$：\n$$\nk_{\\theta} = \\frac{2 \\Delta E}{(\\Delta \\theta)^2}\n$$\n使用第一个数据点：$\\Delta \\theta = 0.05$ rad 和 $\\Delta E = 0.4375$ kJ mol$^{-1}$。\n$$\nk_{\\theta} = \\frac{2 \\times (0.4375 \\text{ kJ mol}^{-1})}{(0.05 \\text{ rad})^2} = \\frac{0.875 \\text{ kJ mol}^{-1}}{0.0025 \\text{ rad}^2} = 350 \\text{ kJ mol}^{-1} \\text{rad}^{-2}\n$$\n检验其他数据点：\n对于 $\\Delta \\theta = 0.08$ rad: $k_{\\theta} = \\frac{2 \\times 1.1200}{0.0064} = 350$ kJ mol$^{-1}$ rad$^{-2}$。\n对于 $\\Delta \\theta = 0.10$ rad: $k_{\\theta} = \\frac{2 \\times 1.7500}{0.01} = 350$ kJ mol$^{-1}$ rad$^{-2}$。\n同样，数据完美地表示了一个简谐势。我们对 $k_{\\theta}$ 的估算值为 $350$ kJ mol$^{-1}$ rad$^{-2}$。保留四位有效数字，即 $350.0$ kJ mol$^{-1}$ rad$^{-2}$。\n\n**物理近似的讨论**\n\n1.  **简谐近似**：主要的近似是在二次项处截断泰勒级数。真实的分子势是非简谐的。例如，键伸缩势能更好地由莫尔斯势等函数描述，这些函数考虑了大分离距离下的键解离。简谐势仅在离平衡位置非常小的位移时才准确。所提供的数据显示出完美的二次关系（$\\Delta E \\propto (\\text{位移})^2$）是一个理想化的情况；真实的电子结构数据会显示出与此行为的偏差，表明存在更高阶（三次、四次等）项。\n\n2.  **忽略耦合**：简单的价力场和计算方法假设键伸缩和角弯曲运动是独立的。这对应于将混合导数项 $\\left(\\frac{\\partial^2 E}{\\partial r \\partial \\theta}\\right)_0$（也称为伸缩-弯曲耦合常数 $k_{r\\theta}$）设为零。实际上，这些运动是耦合的。例如，当一个三原子分子的键角减小时，两个末端原子之间的排斥力增加，这反过来又会影响连接到中心原子的键的平衡长度。这种扫描一个坐标同时将另一个坐标固定在其平衡值的实验设计，是专门为探测Hessian矩阵（二阶导数矩阵）的对角元素而设计的，它不提供关于非对角（耦合）项的信息。\n\n3.  **理想化数据**：问题提供的数据中，正位移和负位移（例如 $\\Delta r = \\pm 0.010$ nm）的能量是相同的。这意味着势能关于最小值是完全对称的，这仅在泰勒展开式中所有奇次幂项都为零时才成立。虽然一阶导数在最小值点为零，但三阶导数通常不为零，这导致了非对称的势阱。因此，所提供的数据是人为对称且完全二次的，这是为了本练习的方便，并不反映真实势能面的复杂性。", "answer": "$$\n\\boxed{\\begin{pmatrix} 1.500 \\times 10^3 & 350.0 \\end{pmatrix}}\n$$", "id": "3432394"}, {"introduction": "在真实的分子动力学模拟中，为了计算效率，像Lennard-Jones这样的长程非键相互作用通常会被截断。这个计算练习旨在探究不同的截断方案（能量平移与平滑切换）如何系统性地影响非键参数的拟合结果。你会发现，为了补偿被截断的长程相互作用，拟合出的参数会产生系统性偏差，这揭示了物理模型与计算算法之间深刻的相互作用。[@problem_id:3432370]", "problem": "考虑一种由Lennard-Jones (LJ)势建模的成对相加非键相互作用，该模型广泛应用于分子动力学 (MD)。对于分离距离为 $r$ 的粒子对，其LJ能量定义为\n$$\nV_{\\mathrm{LJ}}(r;\\epsilon,\\sigma) = 4\\,\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^{6}\\right],\n$$\n其中 $\\epsilon$ 是势阱深度，$\\sigma$ 是势能为零时的特征距离。在力场的高级参数化策略中，对 $V_{\\mathrm{LJ}}$ 应用截断方案可能会使拟合参数 $\\epsilon$ 和 $\\sigma$ 产生偏差。两种广泛使用的截断方案是：\n\n1. 在截断半径 $r_c$ 处进行能量平移：\n$$\nV_{\\mathrm{shift}}(r;\\epsilon,\\sigma,r_c) = \n\\begin{cases}\nV_{\\mathrm{LJ}}(r;\\epsilon,\\sigma) - V_{\\mathrm{LJ}}(r_c;\\epsilon,\\sigma), & r < r_c,\\\\\n0, & r \\ge r_c,\n\\end{cases}\n$$\n这确保了能量在 $r_c$ 处的连续性。\n\n2. 在 $r_s$ 和 $r_c$ 之间进行平滑切换：\n$$\nV_{\\mathrm{switch}}(r;\\epsilon,\\sigma,r_s,r_c) = S(r;r_s,r_c)\\,V_{\\mathrm{LJ}}(r;\\epsilon,\\sigma),\n$$\n其中切换函数 $S(r;r_s,r_c)$ 满足：当 $r \\le r_s$ 时 $S(r)=1$；当 $r \\ge r_c$ 时 $S(r)=0$；在 $r_s < r < r_c$ 范围内平滑过渡。一个常用的保证函数及其一阶和二阶导数在 $r_s$ 和 $r_c$ 处连续的五次多项式是\n$$\nS(r;r_s,r_c) = \n\\begin{cases}\n1, & r \\le r_s,\\\\\n1 - 10x^3 + 15x^4 - 6x^5, & r_s < r < r_c,\\\\\n0, & r \\ge r_c,\n\\end{cases}\n$$\n其中约化坐标为\n$$\nx = \\frac{r - r_s}{r_c - r_s}.\n$$\n\n假设无限程参考数据是由具有已知参数 $(\\epsilon_0,\\sigma_0)$ 的 $V_{\\mathrm{LJ}}(r;\\epsilon_0,\\sigma_0)$ 生成的。我们希望量化在相同数据范围内使用截断模型 $V_{\\mathrm{shift}}$ 或 $V_{\\mathrm{switch}}$ 拟合 $\\epsilon$ 和 $\\sigma$ 会对参数产生多大的偏差。您的推导和实现必须从基本原理出发：成对相加的势能表示、Lennard-Jones势的定义，以及将参数估计表述为最小二乘 (LS) 问题。\n\n您必须通过最小化截断模型与无限程参考能量在一组训练距离 $\\{r_i\\}$ 上的未加权残差平方和来估计 $(\\epsilon,\\sigma)$，\n$$\n\\min_{\\epsilon>0,\\ \\sigma>0} \\sum_{i=1}^{N} \\left[V_{\\mathrm{trunc}}(r_i;\\epsilon,\\sigma) - V_{\\mathrm{LJ}}(r_i;\\epsilon_0,\\sigma_0)\\right]^2,\n$$\n其中 $V_{\\mathrm{trunc}}$ 根据截断方案的不同，可以是 $V_{\\mathrm{shift}}$ 或 $V_{\\mathrm{switch}}$。使用在区间 $[r_{\\min}, r_c]$ 上均匀分布的距离进行训练。所有量都必须用约化的无量纲单位表示：距离以 $\\sigma_0$ 为单位，能量以 $\\epsilon_0$ 为单位。\n\n将补偿偏差定义为相对偏差\n$$\n\\Delta_\\epsilon = \\frac{\\epsilon^\\ast - \\epsilon_0}{\\epsilon_0},\\qquad\n\\Delta_\\sigma = \\frac{\\sigma^\\ast - \\sigma_0}{\\sigma_0},\n$$\n其中 $(\\epsilon^\\ast,\\sigma^\\ast)$ 是拟合后的参数。您的程序必须为每个指定的测试用例计算 $(\\Delta_\\epsilon,\\Delta_\\sigma)$ 并报告它们。\n\n约束和实现细节：\n- 使用 $N=200$ 个在 $[r_{\\min}, r_c]$ 区间内均匀分布的训练距离，其中 $r_{\\min}=0.9\\,\\sigma_0$。\n- 在约化单位下使用 $(\\epsilon_0,\\sigma_0)=(1.0,1.0)$。\n- 当选择切换方案时，确保 $r_s < r_c$ 并使用上面定义的五次切换函数。\n- 通过带有正值约束 $\\epsilon>0$ 和 $\\sigma>0$ 的有界约束最小二乘法拟合参数 $(\\epsilon,\\sigma)$。\n- 为每个测试用例计算并返回保留 $6$ 位小数的 $(\\Delta_\\epsilon,\\Delta_\\sigma)$。\n\n测试套件：\n- 用例1：能量平移方案，$r_c=1.6$。\n- 用例2：切换方案，$r_s=1.2$, $r_c=1.6$。\n- 用例3：能量平移方案，$r_c=3.0$ (弱截断，接近无限程)。\n- 用例4：切换方案，$r_s=2.5$, $r_c=3.0$ (延迟切换，弱截断)。\n- 用例5：能量平移方案，$r_c=1.3$ (强截断)。\n\n您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表，每个测试用例的结果本身是一个双元素列表 $[\\Delta_\\epsilon,\\Delta_\\sigma]$，每个数字都四舍五入到 $6$ 位小数。例如，生成以下形式的输出\n$$\n[[\\Delta_{\\epsilon}^{(1)},\\Delta_{\\sigma}^{(1)}],[\\Delta_{\\epsilon}^{(2)},\\Delta_{\\sigma}^{(2)}],\\dots]\n$$\n其中上标表示用例索引。所有输出都必须使用上文指定的约化无量纲单位。", "solution": "该问题要求量化因截断Lennard-Jones (LJ)势而引入的参数拟合偏差。具体来说，我们需要将一个截断LJ模型的参数 $(\\epsilon, \\sigma)$ 拟合到由一个具有已知参数 $(\\epsilon_0, \\sigma_0)$ 的完整、无限程LJ势 $V_{\\mathrm{LJ}}(r;\\epsilon_0,\\sigma_0)$ 生成的参考数据。拟合参数 $(\\epsilon^\\ast, \\sigma^\\ast)$ 与真实参数 $(\\epsilon_0, \\sigma_0)$ 的偏差揭示了特定截断方案引入的系统性偏差。\n\n此问题被表述为一个非线性最小二乘 (NLS) 优化问题。目标是找到参数 $(\\epsilon, \\sigma)$，以最小化在一组离散的粒子间距离 $\\{r_i\\}$ 上，截断模型势与参考势之间的残差平方和。\n\n需要最小化的目标函数是：\n$$\nL(\\epsilon, \\sigma) = \\sum_{i=1}^{N} \\left[ V_{\\mathrm{trunc}}(r_i; \\epsilon, \\sigma, ...) - V_{\\mathrm{ref}}(r_i) \\right]^2\n$$\n其中 $V_{\\mathrm{trunc}}$ 是截断模型势（$V_{\\mathrm{shift}}$ 或 $V_{\\mathrm{switch}}$），而 $V_{\\mathrm{ref}}$ 是参考数据。\n\n该问题是在一个约化的无量纲单位体系中定义的。参考参数为 $\\epsilon_0=1.0$ 和 $\\sigma_0=1.0$。所有能量都隐含地以 $\\epsilon_0$ 为单位，所有距离都以 $\\sigma_0$ 为单位。\n\n参考势能值是使用标准LJ公式生成的：\n$$\nV_{\\mathrm{ref}}(r_i) = V_{\\mathrm{LJ}}(r_i; \\epsilon_0, \\sigma_0) = 4\\epsilon_0 \\left[ \\left(\\frac{\\sigma_0}{r_i}\\right)^{12} - \\left(\\frac{\\sigma_0}{r_i}\\right)^{6} \\right] = 4 \\left( r_i^{-12} - r_i^{-6} \\right)\n$$\n训练数据包含 $N=200$ 个在区间 $[r_{\\min}, r_c]$ 上均匀分布的距离 $\\{r_i\\}$，其中 $r_{\\min}=0.9\\sigma_0=0.9$。\n\n两种截断模型是：\n1.  **能量平移 ($V_{\\mathrm{shift}}$):** 此模型通过减去在截断半径 $r_c$ 处的势能值，来确保势能在 $r_c$ 处为零。\n    $$\n    V_{\\mathrm{shift}}(r; \\epsilon, \\sigma, r_c) = V_{\\mathrm{LJ}}(r; \\epsilon, \\sigma) - V_{\\mathrm{LJ}}(r_c; \\epsilon, \\sigma) \\quad \\text{for } r < r_c\n    $$\n    代入LJ形式，我们得到：\n    $$\n    V_{\\mathrm{shift}}(r; \\epsilon, \\sigma, r_c) = 4\\epsilon \\left[ \\left( \\left(\\frac{\\sigma}{r}\\right)^{12} - \\left(\\frac{\\sigma}{r}\\right)^{6} \\right) - \\left( \\left(\\frac{\\sigma}{r_c}\\right)^{12} - \\left(\\frac{\\sigma}{r_c}\\right)^{6} \\right) \\right]\n    $$\n\n2.  **平滑切换 ($V_{\\mathrm{switch}}$):** 此模型使用切换函数 $S(r)$ 在距离 $r_s$ 和 $r_c$ 之间将LJ势平滑地衰减至零。\n    $$\n    V_{\\mathrm{switch}}(r; \\epsilon, \\sigma, r_s, r_c) = S(r; r_s, r_c) \\cdot V_{\\mathrm{LJ}}(r; \\epsilon, \\sigma)\n    $$\n    五次切换函数 $S(r)$ 是分段定义的：\n    $$\n    S(r;r_s,r_c) =\n    \\begin{cases}\n    1 & r \\le r_s \\\\\n    1 - 10x^3 + 15x^4 - 6x^5 & r_s < r < r_c \\\\\n    0 & r \\ge r_c\n    \\end{cases}\n    \\quad \\text{with} \\quad x = \\frac{r - r_s}{r_c - r_s}\n    $$\n    这种形式确保了势及其一阶和二阶导数的连续性。\n\n对于每个测试用例，我们求解NLS问题以找到最优参数 $(\\epsilon^\\ast, \\sigma^\\ast)$。优化过程受物理约束 $\\epsilon > 0$ 和 $\\sigma > 0$ 的限制。我们将使用 `scipy.optimize.least_squares` 函数，它非常适合此类有界约束的非线性问题。优化的初始猜测值将是真实参数 $(\\epsilon, \\sigma) = (1.0, 1.0)$。\n\n最后，我们计算补偿偏差，即拟合参数与真实值之间的相对偏差：\n$$\n\\Delta_\\epsilon = \\frac{\\epsilon^\\ast - \\epsilon_0}{\\epsilon_0} = \\epsilon^\\ast - 1.0\n$$\n$$\n\\Delta_\\sigma = \\frac{\\sigma^\\ast - \\sigma_0}{\\sigma_0} = \\sigma^\\ast - 1.0\n$$\n\n每个测试用例的求解算法如下：\n1.  定义用例的参数（截断类型、$r_c$，以及适用的 $r_s$）。\n2.  从 $r_{\\min}=0.9$ 到 $r_c$ 生成包含 $N=200$ 个训练距离的数组 $r_i$。\n3.  使用 $V_{\\mathrm{LJ}}(r_i; 1.0, 1.0)$ 计算参考能量数组 $V_{\\mathrm{ref},i}$。\n4.  定义一个残差函数，该函数接受参数向量 $[\\epsilon, \\sigma]$ 并返回差值向量 $[V_{\\mathrm{trunc}}(r_i) - V_{\\mathrm{ref},i}]$。此函数将特定于截断方案（`shift` 或 `switch`）。\n5.  使用残差函数、初始猜测值 $[1.0, 1.0]$ 和正值边界 $([0, 0], [\\infty, \\infty])$ 调用 `scipy.optimize.least_squares`。\n6.  从求解器的结果中提取优化后的参数 $(\\epsilon^\\ast, \\sigma^\\ast)$。\n7.  计算 $\\Delta_\\epsilon$ 和 $\\Delta_\\sigma$。\n8.  存储结果，四舍五入到 $6$ 位小数。\n\n对所有五个测试用例重复此过程，并将结果汇总为指定的输出格式。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import least_squares\n\ndef V_LJ(r, epsilon, sigma):\n    \"\"\"Calculates the Lennard-Jones potential.\"\"\"\n    # Ensure r and sigma are positive to avoid errors.\n    r = np.maximum(r, 1e-12)\n    sigma = np.maximum(sigma, 1e-12)\n    \n    sig_r = sigma / r\n    sig_r6 = sig_r**6\n    sig_r12 = sig_r6**2\n    return 4.0 * epsilon * (sig_r12 - sig_r6)\n\ndef V_shift(r, epsilon, sigma, rc):\n    \"\"\"Calculates the energy-shifted Lennard-Jones potential.\"\"\"\n    v_r = V_LJ(r, epsilon, sigma)\n    v_rc = V_LJ(rc, epsilon, sigma)\n    # The potential is defined for r  rc. For r >= rc, it is 0.\n    # The training points are all r = rc. The linspace includes rc.\n    # We must handle the endpoint where r=rc, V_shift should be 0.\n    potential = v_r - v_rc\n    potential[r >= rc] = 0.0\n    return potential\n\ndef S_quintic(r, rs, rc):\n    \"\"\"Calculates the quintic switching function S(r).\"\"\"\n    s_vals = np.zeros_like(r, dtype=float)\n    \n    # Condition: r = rs\n    cond1 = r = rs\n    s_vals[cond1] = 1.0\n    \n    # Condition: rs  r  rc\n    cond2 = (r > rs)  (r  rc)\n    if np.any(cond2):\n        r_middle = r[cond2]\n        x = (r_middle - rs) / (rc - rs)\n        s_vals[cond2] = 1.0 - 10 * x**3 + 15 * x**4 - 6 * x**5\n    \n    # Condition: r >= rc -> s_vals remains 0.0\n    \n    return s_vals\n\ndef V_switch(r, epsilon, sigma, rs, rc):\n    \"\"\"Calculates the smoothly switched Lennard-Jones potential.\"\"\"\n    s_r = S_quintic(r, rs, rc)\n    v_lj_r = V_LJ(r, epsilon, sigma)\n    return s_r * v_lj_r\n\ndef solve_case(case_params):\n    \"\"\"\n    Solves a single parameter fitting case.\n    \"\"\"\n    model_type = case_params['type']\n    rc = case_params['rc']\n    rs = case_params.get('rs') # Will be None if not provided\n    \n    # Constants and reference parameters\n    epsilon_0 = 1.0\n    sigma_0 = 1.0\n    N = 200\n    r_min = 0.9 * sigma_0\n\n    # Generate training data: distances and reference energies\n    r_train = np.linspace(r_min, rc, N)\n    V_ref = V_LJ(r_train, epsilon_0, sigma_0)\n\n    # Define residual function for the optimizer\n    if model_type == 'shift':\n        def residuals(params):\n            epsilon, sigma = params\n            V_model = V_shift(r_train, epsilon, sigma, rc)\n            return V_model - V_ref\n    elif model_type == 'switch':\n        if rs is None or rs >= rc:\n            raise ValueError(\"Switching scheme requires rs  rc.\")\n        def residuals(params):\n            epsilon, sigma = params\n            V_model = V_switch(r_train, epsilon, sigma, rs, rc)\n            return V_model - V_ref\n    else:\n        raise ValueError(f\"Unknown model type: {model_type}\")\n\n    # Initial guess and bounds for the parameters (epsilon, sigma)\n    p0 = [1.0, 1.0]\n    bounds = ([1e-9, 1e-9], [np.inf, np.inf]) # Strictly positive bounds\n\n    # Perform the non-linear least squares optimization\n    result = least_squares(residuals, p0, bounds=bounds, method='trf')\n    \n    # Extract optimal parameters\n    epsilon_star, sigma_star = result.x\n\n    # Calculate compensation biases\n    delta_epsilon = (epsilon_star - epsilon_0) / epsilon_0\n    delta_sigma = (sigma_star - sigma_0) / sigma_0\n\n    return [round(delta_epsilon, 6), round(delta_sigma, 6)]\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    test_cases = [\n        {'type': 'shift', 'rc': 1.6},\n        {'type': 'switch', 'rs': 1.2, 'rc': 1.6},\n        {'type': 'shift', 'rc': 3.0},\n        {'type': 'switch', 'rs': 2.5, 'rc': 3.0},\n        {'type': 'shift', 'rc': 1.3},\n    ]\n\n    results = []\n    for case in test_cases:\n        biases = solve_case(case)\n        # The str() of a list gives the desired format, e.g., '[0.1, 0.2]'\n        results.append(str(biases))\n    \n    # Final print statement must match the required format exactly.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3432370"}, {"introduction": "本章最后一部分将关注最复杂的键合项之一：扭转势。由于其固有的灵活性和参数之间可能存在的耦合，扭转参数的拟合极具挑战性。这个高级练习将引入Fisher信息矩阵这一强大的统计工具，用于量化实验数据对每个参数提供了多少信息，以及参数之间的耦合强度。通过这个练习，你将从简单的参数拟合迈向对参数不确定性和可靠性的严格分析。[@problem_id:3432389]", "problem": "考虑经典分子力学力场中单个可旋转键的扭转贡献参数化。扭转能被建模为一个截断的傅里叶级数，这是受常见固定电荷力场的启发。设二面角为$\\phi$（以弧度表示），并定义扭转能函数\n$$\nE(\\phi;\\theta) = k_1 \\left(1 - \\cos(3\\phi)\\right) + k_2 \\left(1 - \\cos(\\phi - \\pi)\\right),\n$$\n其中参数矢量为$\\theta = (k_1,k_2)$，$k_1$和$k_2$的单位是千焦/摩尔（kJ/mol）。该形式使用了一个相位为零的三重项和一个相位为$\\pi$的单重项，这些选择通常用于反映化学二面角的周期性。\n\n参数化过程考虑两种互补的数据类型。\n\n1. 气相二面角扫描能量：在$[0,2\\pi)$范围内均匀分布的$M$个扫描点$\\{\\phi_j\\}_{j=1}^M$处，观测到的能量$\\{Y_j\\}_{j=1}^M$被建模为独立的高斯测量\n$$\nY_j \\sim \\mathcal{N}\\left(E(\\phi_j; \\theta), \\sigma_E^2\\right),\n$$\n其中噪声标准差$\\sigma_E$已知，单位为千焦/摩尔。\n\n2. 凝聚相构象异构体布居：考虑以角度$\\phi_c \\in \\{0, 2\\pi/3, 4\\pi/3\\}$为中心的三个构象盆，这代表了sp$^3$–sp$^3$扭转典型的三重对称性。在绝对温度$T$（单位为开尔文）下，假设从$N$个独立样本中观测到的计数$n = (n_1,n_2,n_3)$服从多项分布，其类别概率由玻尔兹曼权重给出，该权重是在构象盆中心评估的扭转能得到的：\n$$\np_c(\\theta) = \\frac{\\exp\\left(-\\beta E(\\phi_c;\\theta)\\right)}{\\sum_{d=1}^{3} \\exp\\left(-\\beta E(\\phi_d;\\theta)\\right)}, \\quad \\beta = \\frac{1}{k_{\\mathrm{B}} T},\n$$\n其中$k_{\\mathrm{B}}$是玻尔兹曼常数，单位为千焦/摩尔/开尔文（kJ/(mol·K)），且$n \\sim \\mathrm{Multinomial}(N; p_1(\\theta), p_2(\\theta), p_3(\\theta))$。\n\n假设在给定$\\theta$的情况下，这两个数据集是统计独立的。$\\theta$的可辨识性可以通过费雪信息矩阵来量化，其定义为\n$$\nI_{ij}(\\theta) = \\mathbb{E}\\left[\\frac{\\partial}{\\partial \\theta_i} \\log p(D \\mid \\theta) \\cdot \\frac{\\partial}{\\partial \\theta_j} \\log p(D \\mid \\theta)\\right],\n$$\n其中$D$表示来自两个数据源的联合数据，期望是关于$p(D \\mid \\theta)$计算的。对于独立的数据源，总费雪信息是各数据源特定贡献之和。\n\n从高斯似然和构象异构体概率的玻尔兹曼分布的基本定义出发，推导气相二面角扫描和凝聚相多项分布布居对期望费雪信息的贡献表达式。然后，构建一个算法，对于给定的参数矢量$\\theta$、扫描设计$\\{\\phi_j\\}$、测量噪声$\\sigma_E$、温度$T$、样本量$N$和构象异构体中心$\\{\\phi_c\\}$，计算总费雪信息矩阵$I(\\theta)$。\n\n根据计算出的费雪信息矩阵，评估两个定量可辨识性指标：\n- 条件数$\\kappa(\\theta)$，定义为$\\kappa(\\theta) = \\lambda_{\\max}(I(\\theta)) / \\lambda_{\\min}(I(\\theta))$，其中$\\lambda_{\\max}$和$\\lambda_{\\min}$分别是$I(\\theta)$的最大和最小特征值。\n- 耦合系数$\\rho(\\theta)$，定义为$\\rho(\\theta) = I_{12}(\\theta) / \\sqrt{I_{11}(\\theta) I_{22}(\\theta)}$，它量化了参数耦合的程度，当$I(\\theta)$为正定时，其值在区间$[-1,1]$内。\n\n所有角度必须以弧度处理。所有能量及与能量相关的量必须以千焦/摩尔为单位。温度$T$必须以开尔文为单位。玻尔兹曼常数$k_{\\mathrm{B}}$必须使用千焦/摩尔/开尔文为单位，以便$\\beta$的单位为每千焦/摩尔。\n\n您的程序必须实现推导出的表达式，计算$I(\\theta)$，并报告以下三个测试用例的$\\kappa(\\theta)$和$\\rho(\\theta)$，每个用例由$(k_1,k_2,M,\\sigma_E,T,N,\\{\\phi_c\\})$指定：\n- 用例1（理想情况）：$(k_1,k_2) = (2.0, 1.0)$ kJ/mol，$M = 12$个点均匀分布在$[0,2\\pi)$，$\\sigma_E = 0.1$ kJ/mol，$T = 300$ K，$N = 1000$，$\\{\\phi_c\\} = \\{0, 2\\pi/3, 4\\pi/3\\}$。\n- 用例2（近简并设计）：$(k_1,k_2) = (2.0, 1.0)$ kJ/mol，$M = 2$个点均匀分布在$[0,2\\pi)$，$\\sigma_E = 5.0$ kJ/mol，$T = 5000$ K，$N = 10$，$\\{\\phi_c\\} = \\{0, 2\\pi/3, 4\\pi/3\\}$。\n- 用例3（凝聚相布居的低温极限）：$(k_1,k_2) = (2.0, 1.0)$ kJ/mol，$M = 12$个点均匀分布在$[0,2\\pi)$，$\\sigma_E = 0.5$ kJ/mol，$T = 150$ K，$N = 10000$，$\\{\\phi_c\\} = \\{0, 2\\pi/3, 4\\pi/3\\}$。\n\n您的程序应生成单行输出，包含一个由方括号括起来的逗号分隔列表，其中每个条目对应一个用例，并且本身是一个按顺序包含$[\\kappa,\\rho]$的二元列表。例如，输出格式必须是\n$$\n\\texttt{[[\\kappa_1,\\rho_1],[\\kappa_2,\\rho_2],[\\kappa_3,\\rho_3]]},\n$$\n用数值替换符号。不应打印任何附加文本。", "solution": "用户在计算化学和统计推断领域提供了一个定义明确的问题。任务是使用费雪信息矩阵（FIM）分析扭转能模型的参数可辨识性。\n\n### 问题验证\n首先对问题陈述进行严格验证。\n- **提取已知信息**：已提取扭转能函数$E(\\phi;\\theta) = k_1 \\left(1 - \\cos(3\\phi)\\right) + k_2 \\left(1 - \\cos(\\phi - \\pi)\\right)$、参数矢量$\\theta = (k_1, k_2)$、气相扫描能量的统计模型($Y_j \\sim \\mathcal{N}(E(\\phi_j; \\theta), \\sigma_E^2)$)和凝聚相计数的统计模型($n \\sim \\mathrm{Multinomial}(N; \\{p_c(\\theta)\\})$)、构象异构体概率$p_c(\\theta)$的定义、费雪信息矩阵$I_{ij}(\\theta)$的定义，以及可辨识性指标$\\kappa(\\theta)$和$\\rho(\\theta)$的定义。三个测试用例的所有参数都已明确提供。\n- **验证结论**：该问题是**有效的**。它在科学上基于分子力学、统计力学和信息论的既定原理。问题陈述清晰、客观、自洽，提供了推导和计算唯一解所需的所有数据和定义。它没有违反任何指定的无效标准。\n\n### 费雪信息矩阵的推导\n\n总费雪信息矩阵$I(\\theta)$是来自独立的气相和凝聚相数据源的贡献之和：\n$$\nI(\\theta) = I^E(\\theta) + I^N(\\theta)\n$$\n其中$I^E(\\theta)$来自二面角扫描，$I^N(\\theta)$来自构象异构体布居。参数为$\\theta_1=k_1$和$\\theta_2=k_2$。\n\n#### 第1部分：气相二面角扫描数据的贡献($I^E(\\theta)$)\n\n对于$M$个独立的高斯测量$\\{Y_j\\}_{j=1}^M$，其对数似然函数为\n$$\n\\log p(D_E \\mid \\theta) = \\sum_{j=1}^M \\left( -\\frac{1}{2}\\log(2\\pi\\sigma_E^2) - \\frac{(Y_j - E(\\phi_j; \\theta))^2}{2\\sigma_E^2} \\right)\n$$\n费雪信息的定义是$I_{ij}(\\theta) = -\\mathbb{E}\\left[\\frac{\\partial^2}{\\partial \\theta_i \\partial \\theta_j} \\log p(D \\mid \\theta)\\right]$。对于带有加性高斯噪声的线性模型（就参数$\\theta$而言，本模型即是如此），这可以简化为一个众所周知的形式。或者，使用梯度的定义：\n$$\nI^E_{ij}(\\theta) = \\mathbb{E}\\left[ \\left(\\frac{\\partial \\log p(D_E \\mid \\theta)}{\\partial \\theta_i}\\right) \\left(\\frac{\\partial \\log p(D_E \\mid \\theta)}{\\partial \\theta_j}\\right) \\right]\n$$\n对数似然的导数为：\n$$\n\\frac{\\partial}{\\partial \\theta_i} \\log p(D_E \\mid \\theta) = \\sum_{j=1}^M \\frac{(Y_j - E_j)}{\\sigma_E^2} \\frac{\\partial E_j}{\\partial \\theta_i}\n$$\n其中$E_j = E(\\phi_j; \\theta)$。取期望，并使用$\\mathbb{E}[Y_j - E_j] = 0$和$\\mathbb{E}[(Y_j - E_j)(Y_k - E_k)] = \\delta_{jk} \\sigma_E^2$，我们得到：\n$$\nI^E_{ij}(\\theta) = \\frac{1}{\\sigma_E^2} \\sum_{j=1}^M \\frac{\\partial E(\\phi_j; \\theta)}{\\partial \\theta_i} \\frac{\\partial E(\\phi_j; \\theta)}{\\partial \\theta_j}\n$$\n能量函数$E(\\phi; k_1, k_2) = k_1(1 - \\cos(3\\phi)) + k_2(1 + \\cos(\\phi))$的偏导数为：\n$$\n\\frac{\\partial E}{\\partial k_1} = 1 - \\cos(3\\phi) \\quad\\quad \\frac{\\partial E}{\\partial k_2} = 1 + \\cos(\\phi)\n$$\n因此，$2 \\times 2$矩阵$I^E$的元素为：\n$$\nI^E_{11} = \\frac{1}{\\sigma_E^2} \\sum_{j=1}^M (1 - \\cos(3\\phi_j))^2\n$$\n$$\nI^E_{22} = \\frac{1}{\\sigma_E^2} \\sum_{j=1}^M (1 + \\cos(\\phi_j))^2\n$$\n$$\nI^E_{12} = I^E_{21} = \\frac{1}{\\sigma_E^2} \\sum_{j=1}^M (1 - \\cos(3\\phi_j))(1 + \\cos(\\phi_j))\n$$\n扫描点$\\{\\phi_j\\}_{j=1}^M$在$[0, 2\\pi)$上均匀分布。\n\n#### 第2部分：凝聚相布居数据的贡献($I^N(\\theta)$)\n\n数据服从多项分布。对于具有$N$次试验和$K$个类别的多项分布，其FIM由下式给出：\n$$\nI^N_{ij}(\\theta) = N \\sum_{c=1}^K \\frac{1}{p_c(\\theta)} \\frac{\\partial p_c(\\theta)}{\\partial \\theta_i} \\frac{\\partial p_c(\\theta)}{\\partial \\theta_j}\n$$\n这里，$K=3$。概率为$p_c(\\theta) = \\exp(-\\beta E_c)/Z$，其中$E_c = E(\\phi_c; \\theta)$，$Z=\\sum_{d=1}^3 \\exp(-\\beta E_d)$。$p_c$关于$\\theta_i$的导数为：\n$$\n\\frac{\\partial p_c}{\\partial \\theta_i} = -\\beta p_c \\left( \\frac{\\partial E_c}{\\partial \\theta_i} - \\sum_{d=1}^3 p_d \\frac{\\partial E_d}{\\partial \\theta_i} \\right) = -\\beta p_c \\left( \\frac{\\partial E_c}{\\partial \\theta_i} - \\left\\langle \\frac{\\partial E}{\\partial \\theta_i} \\right\\rangle \\right)\n$$\n其中$\\langle \\cdot \\rangle$表示在构象异构体状态上的玻尔兹曼加权平均。将此代入FIM公式，得到：\n$$\nI^N_{ij}(\\theta) = N \\beta^2 \\sum_{c=1}^3 p_c(\\theta) \\left( \\frac{\\partial E_c}{\\partial \\theta_i} - \\left\\langle \\frac{\\partial E}{\\partial \\theta_i} \\right\\rangle \\right) \\left( \\frac{\\partial E_c}{\\partial \\theta_j} - \\left\\langle \\frac{\\partial E}{\\partial \\theta_j} \\right\\rangle \\right)\n$$\n这是$N\\beta^2$乘以能量梯度分量的协方差，该协方差是在离散的构象异构体分布上计算的。令$g_{1c} = \\partial E_c / \\partial k_1$和$g_{2c} = \\partial E_c / \\partial k_2$。矩阵元素为：\n$$\nI^N_{11} = N\\beta^2 \\sum_{c=1}^3 p_c (g_{1c} - \\langle g_1 \\rangle)^2\n$$\n$$\nI^N_{22} = N\\beta^2 \\sum_{c=1}^3 p_c (g_{2c} - \\langle g_2 \\rangle)^2\n$$\n$$\nI^N_{12} = I^N_{21} = N\\beta^2 \\sum_{c=1}^3 p_c (g_{1c} - \\langle g_1 \\rangle)(g_{2c} - \\langle g_2 \\rangle)\n$$\n其中$\\beta=1/(k_B T)$。\n\n### 算法与可辨识性指标\n\n算法流程如下：\n1. 对于给定的测试用例$(k_1, k_2, M, \\sigma_E, T, N, \\{\\phi_c\\})$，使用推导出的公式计算矩阵$I^E(\\theta)$和$I^N(\\theta)$。\n2. 将它们相加得到总费雪信息矩阵$I(\\theta) = I^E(\\theta) + I^N(\\theta)$。\n3. 计算对称矩阵$I(\\theta)$的特征值，记为$\\lambda_{\\min}$和$\\lambda_{\\max}$。\n4. 计算条件数$\\kappa(\\theta) = \\lambda_{\\max} / \\lambda_{\\min}$。接近1的$\\kappa$值表示参数以相似的精度被辨识，而大的$\\kappa$值表示病态条件。如果$\\lambda_{\\min} \\approx 0$，则参数无法从数据中辨识，$\\kappa$趋于无穷。\n5. 计算耦合系数$\\rho(\\theta) = I_{12}(\\theta) / \\sqrt{I_{11}(\\theta) I_{22}(\\theta)}$。$|\\rho|$值接近1表示参数估计之间存在强线性依赖，而接近0的值表示它们是解耦的。\n\n对三个指定的测试用例分别执行此过程。对于给定的构象异构体中心$\\{\\phi_c\\} = \\{0, 2\\pi/3, 4\\pi/3\\}$，一个关键的观察是导数$\\partial E / \\partial k_1 = 1 - \\cos(3\\phi)$在这三个点上都恰好为零。因此，布居数据不提供关于$k_1$的任何信息，导致$I^N_{11}=I^N_{12}=0$。关于$k_1$的所有信息都必须来自气相扫描数据。", "answer": "```python\nimport numpy as np\n\n# Boltzmann constant in kJ/(mol·K)\nKB_KJ_MOL_K = 8.31446261815324 / 1000.0\n\ndef energy_torsion(phi, k1, k2):\n    \"\"\"\n    Calculates the torsional energy.\n    E(phi) = k_1(1 - cos(3*phi)) + k_2(1 - cos(phi - pi))\n    cos(phi - pi) = -cos(phi), so E(phi) = k_1(1 - cos(3*phi)) + k_2(1 + cos(phi))\n    \"\"\"\n    return k1 * (1.0 - np.cos(3.0 * phi)) + k2 * (1.0 + np.cos(phi))\n\ndef energy_derivatives(phi):\n    \"\"\"\n    Calculates the partial derivatives of the energy function with respect to k1 and k2.\n    \"\"\"\n    # Partial derivative of E with respect to k1: dE/dk1 = 1 - cos(3*phi)\n    g1 = 1.0 - np.cos(3.0 * phi)\n    # Partial derivative of E with respect to k2: dE/dk2 = 1 + cos(phi)\n    g2 = 1.0 + np.cos(phi)\n    return g1, g2\n\ndef compute_fim_from_scan(M, sigma_E):\n    \"\"\"\n    Computes the Fisher Information Matrix contribution from the gas-phase dihedral scan data.\n    \"\"\"\n    if M == 0 or sigma_E = 0:\n        return np.zeros((2, 2))\n        \n    phi_scan = np.linspace(0, 2 * np.pi, M, endpoint=False)\n    \n    g1_scan, g2_scan = energy_derivatives(phi_scan)\n    \n    I_E = np.zeros((2, 2))\n    I_E[0, 0] = np.sum(g1_scan**2)\n    I_E[1, 1] = np.sum(g2_scan**2)\n    I_E[0, 1] = I_E[1, 0] = np.sum(g1_scan * g2_scan)\n    \n    return I_E / (sigma_E**2)\n\ndef compute_fim_from_population(k1, k2, T, N, phi_c):\n    \"\"\"\n    Computes the Fisher Information Matrix contribution from the condensed-phase population data.\n    \"\"\"\n    if T = 0 or N == 0:\n        return np.zeros((2, 2))\n        \n    beta = 1.0 / (KB_KJ_MOL_K * T)\n    \n    E_conf = energy_torsion(phi_c, k1, k2)\n    g1_conf, g2_conf = energy_derivatives(phi_c)\n    \n    boltzmann_factors = np.exp(-beta * E_conf)\n    Z = np.sum(boltzmann_factors)\n    if Z == 0:\n        return np.zeros((2, 2))\n    p_conf = boltzmann_factors / Z\n    \n    avg_g1 = np.sum(p_conf * g1_conf)\n    avg_g2 = np.sum(p_conf * g2_conf)\n    \n    dev_g1 = g1_conf - avg_g1\n    dev_g2 = g2_conf - avg_g2\n    \n    I_N = np.zeros((2, 2))\n    I_N[0, 0] = np.sum(p_conf * dev_g1**2)\n    I_N[1, 1] = np.sum(p_conf * dev_g2**2)\n    I_N[0, 1] = I_N[1, 0] = np.sum(p_conf * dev_g1 * dev_g2)\n    \n    return N * beta**2 * I_N\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for all test cases.\n    \"\"\"\n    test_cases = [\n        # Case 1: (k1, k2, M, sigma_E, T, N, {phi_c})\n        (2.0, 1.0, 12, 0.1, 300, 1000, [0, 2 * np.pi / 3, 4 * np.pi / 3]),\n        # Case 2\n        (2.0, 1.0, 2, 5.0, 5000, 10, [0, 2 * np.pi / 3, 4 * np.pi / 3]),\n        # Case 3\n        (2.0, 1.0, 12, 0.5, 150, 10000, [0, 2 * np.pi / 3, 4 * np.pi / 3]),\n    ]\n\n    results = []\n    for case_params in test_cases:\n        k1, k2, M, sigma_E, T, N, phi_c_list = case_params\n        phi_c = np.array(phi_c_list)\n        \n        # Compute FIM contributions\n        I_E = compute_fim_from_scan(M, sigma_E)\n        I_N = compute_fim_from_population(k1, k2, T, N, phi_c)\n        \n        # Total FIM\n        I_total = I_E + I_N\n        \n        # Calculate Identifiability Metrics\n        \n        # Condition Number (kappa)\n        try:\n            eigenvalues = np.linalg.eigvalsh(I_total)\n            lambda_min, lambda_max = eigenvalues[0], eigenvalues[1]\n            # Use a small tolerance for numerical stability\n            if lambda_min = 1e-12 * lambda_max or lambda_min = 1e-12:\n                kappa = np.inf\n            else:\n                kappa = lambda_max / lambda_min\n        except np.linalg.LinAlgError:\n            kappa = np.inf\n\n        # Coupling Coefficient (rho)\n        denom = np.sqrt(I_total[0, 0] * I_total[1, 1])\n        if denom == 0:\n            # Undefined if diagonal elements are zero, implying complete non-identifiability.\n            rho = np.nan \n        else:\n            rho = I_total[0, 1] / denom\n            \n        results.append([kappa, rho])\n\n    # Format the final output as specified\n    print(f\"[{','.join(str(res) for res in results)}]\")\n\nsolve()\n```", "id": "3432389"}]}