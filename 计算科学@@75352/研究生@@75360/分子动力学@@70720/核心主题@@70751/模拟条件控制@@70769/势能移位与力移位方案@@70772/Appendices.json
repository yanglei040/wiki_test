{"hands_on_practices": [{"introduction": "动手实践是检验理论理解的最好方法。第一个练习将引导你开发一个诊断工具，以直观地揭示在分子动力学模拟中使用势能截断所产生的核心问题。通过分析力大小的分布，你将能够“看到”势能移动方案中由力不连续性引起的伪影，并验证力移动方案如何有效地消除这一问题 [@problem_id:3436470]。", "problem": "考虑一个三维空间中的全同点粒子系统，这些粒子通过 Lennard-Jones 对势 $u(r)$ 相互作用，其中 $r$ 是两个粒子之间的标量分离距离。Lennard-Jones 势定义为 $u(r)=4\\varepsilon\\left[\\left(\\dfrac{\\sigma}{r}\\right)^{12}-\\left(\\dfrac{\\sigma}{r}\\right)^{6}\\right]$，其中 $\\varepsilon$ 是能量标度，$\\sigma$ 是特征长度。保守对力的大小为 $|\\mathbf{F}(r)|=|-u'(r)|$，其中 $u'(r)=\\dfrac{du}{dr}$，其方向沿着连接粒子中心的直线。\n\n在分子动力学中，为了降低计算成本，通常会在一个截断距离 $r_c$ 处截断相互作用。两种广泛使用的方案定义如下：\n\n1.  **势能移位 (PS)**：当 $r  r_c$ 时，$u_{\\mathrm{ps}}(r) = u(r) - u(r_c)$。力是未修正的，$F_{\\mathrm{ps}}(r) = -u'(r)$。\n2.  **力移位 (FS)**：当 $r  r_c$ 时，$u_{\\mathrm{fs}}(r) = u(r) - u(r_c) - (r - r_c) u'(r_c)$。力也相应修正为 $F_{\\mathrm{fs}}(r) = -u'(r) + u'(r_c)$。\n\n对于两种方案，当 $r \\ge r_c$ 时，势和力都为零。在 PS 方案中，力在 $r_c$ 处不连续，从 $-u'(r_c)$ 跳到 $0$。在 FS 方案中，力在 $r_c$ 处是连续的。\n\n您的任务是：\n\n1.  设计并实现一种计算诊断方法，用于检测和区分这两种方案产生的力场伪影。该诊断应基于力大小的统计分布 $P(|F|)$。\n2.  具体来说，您的方法应该能够生成一个人为的粒子分离距离数据集，该数据集旨在通过在 $r_c$ 附近富集采样点来凸显 PS 方案中的力不连续性。\n3.  实现一个尖峰检测算法，该算法分析力大小的直方图，并量化在预期值 $|\\mathbf{F}_{\\mathrm{discontinuity}}| = |-u'(r_c)|$ 处是否存在异常尖峰。\n4.  将此诊断应用于给定的测试用例，并为每种方案输出一个布尔值，指示是否检测到尖峰（`True` 或 `False`）。", "solution": "该问题要求开发并实现一种计算诊断工具，用于检测分子动力学模拟中的力场截断伪影。具体来说，我们要区分势能移位方案和力移位方案。前者在截断半径 $r_c$ 处引入了力的不连续性，而后者旨在确保力的连续性。该诊断将基于力的大小的统计分布 $P(|\\mathbf{F}|)$，并通过一个尖峰检测统计量进行量化。\n\n首先，我们建立数学框架。系统由通过 Lennard-Jones (LJ) 势相互作用的粒子组成。在能量标度 $\\varepsilon=1$ 和长度标度 $\\sigma=1$ 的约化单位中，势 $u(r)$ 由以下公式给出：\n$$u(r) = 4 \\left( r^{-12} - r^{-6} \\right)$$\n其中 $r$ 是粒子间的分离距离。\n\n一对粒子间的保守力由势的负梯度导出，$F(r) = -u'(r)$，其中 $u'(r) = \\frac{du}{dr}$。其导数为：\n$$u'(r) = 4 \\left( -12r^{-13} - (-6)r^{-7} \\right) = 24 \\left( 2r^{-13} - r^{-7} \\right)$$\n力的大小为 $|\\mathbf{F}(r)| = |-u'(r)| = |u'(r)|$。\n\n为了提高计算效率，模拟中常使用截断距离 $r_c$。我们所考虑的两种方案修改了 $r  r_c$ 时的势和力，并将其在 $r \\ge r_c$ 时设为零。\n\n1.  **势能移位 (PS):** 势被移动以在截断处为零，$u_{\\mathrm{ps}}(r) = u(r) - u(r_c)$（对于 $r  r_c$）。在截断距离内，力是 $u(r)$ 的导数，而不是 $u_{\\mathrm{ps}}(r)$ 的导数。关键的是，这导致了在 $r_c$ 处的一个不连续性：\n    $$\n    F_{\\mathrm{ps}}(r) = \\begin{cases} -u'(r)  \\text{若 } r  r_c \\\\ 0  \\text{若 } r \\ge r_c \\end{cases}\n    $$\n    当 $r$ 从下方趋近 $r_c$ 时，力 $F_{\\mathrm{ps}}(r)$ 趋近于 $-u'(r_c)$，而对于 $r \\ge r_c$，力突然变为零。这种不连续性会在模拟中引入伪影。\n\n2.  **力移位 (FS):** 该方案同时修改势和力，以确保力是连续的并在 $r_c$ 处为零。势定义为 $u_{\\mathrm{fs}}(r) = u(r) - u(r_c) - (r - r_c)u'(r_c)$（对于 $r  r_c$）。相应的力为：\n    $$F_{\\mathrm{fs}}(r) = -u'_{\\mathrm{fs}}(r) = - \\left( u'(r) - u'(r_c) \\right) = -u'(r) + u'(r_c) \\quad \\text{for } r  r_c$$\n    完整的力定义为：\n    $$\n    F_{\\mathrm{fs}}(r) = \\begin{cases} -u'(r) + u'(r_c)  \\text{若 } r  r_c \\\\ 0  \\text{若 } r \\ge r_c \\end{cases}\n    $$\n    当 $r$ 从下方趋近 $r_c$ 时，$F_{\\mathrm{fs}}(r)$ 趋近于 $-u'(r_c) + u'(r_c) = 0$，与 $r \\ge r_c$ 时的值相匹配。因此力是连续的。\n\n该诊断方法的核心是生成一个专门设计用于暴露力不连续性的粒子分离距离数据集 $\\{r_i\\}$。我们使用混合模型来描述分离距离的概率密度，$p(r) = w\\,p_{\\text{peak}}(r) + (1-w)\\,p_{\\text{bulk}}(r)$。体分量 $p_{\\text{bulk}}(r) \\propto r^2$ 模拟了三维理想气体分布。峰值分量 $p_{\\text{peak}}(r)$ 是一个截断正态分布，集中在截断距离的正下方，均值为 $r_c - \\delta$。通过选择一个非零权重 $w$，我们确保在 $r \\to r_c^-$ 区域内有大量的分离距离。\n\n在势能移位方案下，这些靠近 $r_c$ 的高密度分离距离将被全部映射到接近非零值 $|-u'(r_c)| = |u'(r_c)|$ 的力的大小。这会在力大小的直方图中于该特定值处产生一个异常尖峰。相比之下，在力移位方案下，这些靠近 $r_c$ 的相同分离距离将被映射到接近 $|-u'(r_c) + u'(r_c)| = 0$ 的力的大小。因此，位于 $|u'(r_c)|$ 处的尖峰被消除。\n\n实现此诊断的算法流程如下：\n1.  **样本生成：** 对于给定的测试用例及其参数 $N, w, r_{\\min}, r_{\\max}, r_c, \\delta, s, \\epsilon$，生成 $N$ 个粒子分离距离 $\\{r_i\\}$。这涉及从为 $p_{\\text{peak}}(r)$ 指定的截断正态分布中抽取 $N_p = \\text{round}(wN)$ 个样本，以及通过逆变换采样从 $p_{\\text{bulk}}(r) \\propto r^2$ 分布中抽取 $N_b = N - N_p$ 个样本。\n2.  **力计算：** 对于每个采样到的分离距离 $r_i$，根据其定义计算力的大小 $|F_{\\mathrm{ps}}(r_i)|$ 和 $|F_{\\mathrm{fs}}(r_i)|$。这会产生两组力数据数组。\n3.  **直方图分析：** 对两组力数据数组中的每一组进行以下操作：\n    a.  构建一个有 $M$ 个箱的直方图。直方图的范围 $[0, F_{\\max}]$ 由观测到的最大力值确定，以确保所有数据都被捕捉。为保持一致性，在同一测试用例中，两种方案使用相同的 $F_{\\max}$（从势能移位数据中导出）。\n    b.  计算力不连续点的值 $F_{\\text{target}} = |u'(r_c)|$。\n    c.  识别出包含 $F_{\\text{target}}$ 的直方图箱，并记录其计数 $C_0$。\n    d.  计算局部基线计数 $B$，作为目标箱两侧各 $h$ 个、共 $2h$ 个相邻箱中计数的中位数。\n    e.  计算尖峰比率 $S = C_0 / \\max(B, 1)$。使用 $\\max(B,1)$ 可以防止除以零，并确保只有当一个尖峰的计数显著大于一个非零基线时才被记录。\n4.  **决策：** 通过将比率 $S$ 与阈值 $\\tau$ 进行比较来确定是否存在尖峰。如果 $S \\ge \\tau$，则检测到尖峰。此过程对势能移位和力移位两种方案都执行，每个测试用例产生两个布尔结果。\n\n通过对所提供的测试套件执行此流程，我们可以定量地验证预期行为：当分离距离集中在截断附近时，势能移位方案会产生一个可检测的尖峰，而力移位方案则成功地抑制了这种伪影。在截断附近没有集中的测试用例在两种方案下都不应产生尖峰。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import truncnorm\n\ndef solve():\n    \"\"\"\n    Main function to run the analysis for all test cases and print the final result.\n    \"\"\"\n    test_cases = [\n        # Test case 1 (general case with pronounced near-cutoff sampling)\n        {\n            \"N\": 200000, \"r_min\": 0.9, \"r_max\": 4.0, \"r_c\": 2.5, \"w\": 0.6,\n            \"delta\": 0.002, \"s\": 0.005, \"epsilon\": 1e-6,\n            \"M\": 150, \"h\": 4, \"tau\": 3.0\n        },\n        # Test case 2 (bulk-only sampling without near-cutoff concentration)\n        {\n            \"N\": 200000, \"r_min\": 0.9, \"r_max\": 4.0, \"r_c\": 2.5, \"w\": 0.0,\n            \"delta\": 0.0, \"s\": 0.005, \"epsilon\": 1e-6,\n            \"M\": 150, \"h\": 4, \"tau\": 3.0\n        },\n        # Test case 3 (different cutoff with pronounced near-cutoff sampling)\n        {\n            \"N\": 200000, \"r_min\": 0.9, \"r_max\": 4.0, \"r_c\": 2.2, \"w\": 0.7,\n            \"delta\": 0.001, \"s\": 0.004, \"epsilon\": 1e-6,\n            \"M\": 150, \"h\": 4, \"tau\": 3.0\n        },\n    ]\n\n    all_results = []\n    for params in test_cases:\n        results = run_test_case(**params)\n        all_results.append(results)\n    \n    # Format the final output string exactly as specified.\n    formatted_results = [f\"[{res[0]},{res[1]}]\" for res in all_results]\n    print(f\"[{','.join(formatted_results)}]\")\n\ndef u_prime(r):\n    \"\"\"\n    Calculates the derivative of the Lennard-Jones potential u'(r)\n    in reduced units (epsilon=1, sigma=1).\n    u'(r) = 24 * (2/r^13 - 1/r^7)\n    \"\"\"\n    r_inv = 1.0 / r\n    r7_inv = r_inv**7\n    r13_inv = r_inv**13\n    return 24.0 * (2.0 * r13_inv - r7_inv)\n\ndef sample_separations(N, w, r_min, r_max, r_c, delta, s, epsilon):\n    \"\"\"\n    Generates N samples from the mixture distribution p(r).\n    \"\"\"\n    num_peak = int(round(w * N))\n    num_bulk = N - num_peak\n    \n    samples = []\n    \n    # Sample from the peak distribution (truncated normal)\n    if num_peak > 0:\n        mu_peak = r_c - delta\n        a, b = r_min, r_c - epsilon\n        a_std, b_std = (a - mu_peak) / s, (b - mu_peak) / s\n        peak_rvs = truncnorm.rvs(a_std, b_std, loc=mu_peak, scale=s, size=num_peak)\n        samples.append(peak_rvs)\n        \n    # Sample from the bulk distribution (p(r) ~ r^2)\n    if num_bulk > 0:\n        y = np.random.uniform(0, 1, size=num_bulk)\n        r_min_cubed = r_min**3\n        r_max_cubed = r_max**3\n        bulk_rvs = (y * (r_max_cubed - r_min_cubed) + r_min_cubed)**(1./3.)\n        samples.append(bulk_rvs)\n        \n    return np.concatenate(samples)\n\ndef detect_spike(forces, r_c, M, h, tau, F_max):\n    \"\"\"\n    Performs the spike detection analysis on a given array of force magnitudes.\n    \"\"\"\n    if F_max == 0: # Handle cases with no forces\n        return False\n\n    F_target = np.abs(u_prime(r_c))\n    \n    # Create histogram\n    bins = np.linspace(0, F_max, M + 1)\n    counts, _ = np.histogram(forces, bins=bins)\n    \n    # Find the bin index for the target force\n    if F_target  0 or F_target >= F_max:\n        # If target is outside the histogram range, no spike can be detected at its location.\n        # The bin for it would have a count of 0.\n        C0 = 0\n        bin_idx = -1 # Sentinel value\n    else:\n        bin_idx = np.digitize(F_target, bins) - 1\n        # np.digitize can return M for values equal to the last edge, clip to valid index\n        bin_idx = np.clip(bin_idx, 0, M - 1)\n        C0 = counts[bin_idx]\n\n    # Define the local baseline from neighbor bins\n    neighbor_indices = list(range(max(0, bin_idx - h), bin_idx)) + \\\n                       list(range(bin_idx + 1, min(M, bin_idx + h + 1)))\n\n    if not neighbor_indices:\n        B = 0.0\n    else:\n        neighbor_counts = counts[neighbor_indices]\n        B = np.median(neighbor_counts)\n        \n    # Calculate spike ratio and check against threshold\n    S = C0 / max(B, 1.0)\n    \n    return S >= tau\n\ndef run_test_case(N, r_min, r_max, r_c, w, delta, s, epsilon, M, h, tau):\n    \"\"\"\n    Runs the full simulation and diagnostic for a single test case.\n    \"\"\"\n    r_samples = sample_separations(N, w, r_min, r_max, r_c, delta, s, epsilon)\n    \n    u_prime_rc = u_prime(r_c)\n    \n    # Calculate forces for both schemes\n    r_lt_rc = r_samples[r_samples  r_c]\n    \n    # Potential Shifting forces\n    forces_ps = np.zeros(N)\n    indices_lt_rc = np.where(r_samples  r_c)[0]\n    forces_ps[indices_lt_rc] = np.abs(-u_prime(r_lt_rc))\n    \n    # Force Shifting forces\n    forces_fs = np.zeros(N)\n    forces_fs[indices_lt_rc] = np.abs(-u_prime(r_lt_rc) + u_prime_rc)\n    \n    # Determine a common F_max for both histograms\n    F_max = np.max(forces_ps) if forces_ps.size > 0 else 1.0\n\n    # Perform spike detection for each scheme\n    spike_ps = detect_spike(forces_ps, r_c, M, h, tau, F_max)\n    spike_fs = detect_spike(forces_fs, r_c, M, h, tau, F_max)\n    \n    return [spike_ps, spike_fs]\n\n\nif __name__ == '__main__':\n    solve()\n\n```", "id": "3436470"}, {"introduction": "在理解了力移位方案对动力学的重要性之后，我们进而探讨这些计算方案如何影响对平衡热力学性质的计算。本练习聚焦于一个关键的溶剂化热力学量——Kirkwood-Buff积分，并指导你推导一个“无偏估计量”。你将学会如何从一个使用了截断势能的模拟中，通过理论校正来精确地恢复真实的物理量 [@problem_id:3436422]。", "problem": "要求您从第一性原理出发，研究在分子动力学中使用有限截断的势能移位和力移位方案如何影响 Kirkwood–Buff 积分的计算。考虑无限稀释极限下的单组分流体，此时对相关函数由 Boltzmann 因子给出。设对势函数表示为 $u(r)$，逆温度为 $\\beta = 1/(k_{\\mathrm{B}} T)$，其中 $k_{\\mathrm{B}}$ 是 Boltzmann 常数，$T$ 是温度。Kirkwood–Buff 积分 $G$ 定义为\n$$\nG \\equiv 4\\pi \\int_{0}^{\\infty} r^2 \\left[g(r) - 1\\right] \\, dr,\n$$\n其中 $g(r)$ 是径向分布函数。在无限稀释极限下，有 $g(r) = \\exp\\left(-\\beta u(r)\\right)$。\n\n在实际模拟中，会引入一个截断半径 $r_c$，对于 $r \\le r_c$ 的相互作用进行修正，而对于 $r > r_c$ 的相互作用则设为零。两种常见的方案是：\n\n- 势能移位 (PS)：当 $r \\le r_c$ 时，$u_{\\mathrm{ps}}(r) = u(r) - u(r_c)$；当 $r > r_c$ 时，$u_{\\mathrm{ps}}(r) = 0$。\n- 力移位 (FS)：当 $r \\le r_c$ 时，$u_{\\mathrm{fs}}(r) = u(r) - u(r_c) - (r - r_c) u'(r_c)$；当 $r > r_c$ 时，$u_{\\mathrm{fs}}(r) = 0$，其中 $u'(r_c)$ 表示 $u(r)$ 在 $r = r_c$ 处的导数。这确保了修正后的势能 $u_{\\mathrm{fs}}(r)$ 及其导数在 $r_c$ 处是连续的。\n\n假设您在无限稀释极限下测量由这些修正相互作用产生的径向分布函数，即\n$$\ng_{\\mathrm{ps}}(r) = \\exp\\left(-\\beta u_{\\mathrm{ps}}(r)\\right), \\quad g_{\\mathrm{fs}}(r) = \\exp\\left(-\\beta u_{\\mathrm{fs}}(r)\\right).\n$$\n\n您的任务是：\n\n1. 从以上定义出发，分别使用测得的 $g_{\\mathrm{ps}}(r)$ 和 $g_{\\mathrm{fs}}(r)$，为无限稀释极限下的真实 Kirkwood–Buff 积分 $G$ 推导一个无偏估计量。推导必须从正则系综中的基本统计力学以及 $G$ 和 $g(r)$ 的定义开始，并且必须明确说明 $u(r_c)$ 和 $u'(r_c)$ 如何进入公式。最终的估计量必须完全用关于 $r$ 的一维积分形式表示，其中包含已知函数、测得的 $g_{\\mathrm{ps}}(r)$ 或 $g_{\\mathrm{fs}}(r)$，以及 $u(r_c)$ 和 $u'(r_c)$，并且必须在无限稀释条件下有效。\n\n2. 实现一个程序，为每个测试用例计算以下五个量：\n   - 真实的 Kirkwood–Buff 积分 $G_{\\mathrm{true}} = 4\\pi \\int_{0}^{\\infty} r^2 \\left[\\exp\\left(-\\beta u(r)\\right) - 1\\right] dr$。\n   - 使用 PS 数据的朴素截断估计量 $G_{\\mathrm{cut}}^{\\mathrm{PS}} = 4\\pi \\int_{0}^{r_c} r^2 \\left[g_{\\mathrm{ps}}(r) - 1\\right] dr$。\n   - 您在第 1 部分中推导出的使用 PS 数据的修正估计量 $G_{\\mathrm{corr}}^{\\mathrm{PS}}$。\n   - 使用 FS 数据的朴素截断估计量 $G_{\\mathrm{cut}}^{\\mathrm{FS}} = 4\\pi \\int_{0}^{r_c} r^2 \\left[g_{\\mathrm{fs}}(r) - 1\\right] dr$。\n   - 您在第 1 部分中推导出的使用 FS 数据的修正估计量 $G_{\\mathrm{corr}}^{\\mathrm{FS}}$。\n\n3. 使用 Lennard–Jones 势 $u(r) = 4\\varepsilon \\left[\\left(\\sigma/r\\right)^{12} - \\left(\\sigma/r\\right)^6\\right]$，并采用简约单位 $\\varepsilon = 1$, $\\sigma = 1$, $k_{\\mathrm{B}} = 1$。所有结果必须以简约 Lennard–Jones 单位（无量纲数）表示。角度单位不适用。您必须对所有积分进行数值计算。\n\n4. 程序必须对构成测试套件的以下每个测试用例评估上述五个量：\n   - A 例（理想路径）：$\\left(T, r_c\\right) = \\left(1.5, 2.5\\right)$。\n   - B 例（边界条件敏感性）：$\\left(T, r_c\\right) = \\left(0.8, 1.3\\right)$。\n   - C 例（大截断）：$\\left(T, r_c\\right) = \\left(3.0, 5.0\\right)$。\n\n5. 最终输出格式：您的程序应生成单行输出，包含形如\n   $$\n   \\left[\\left[G_{\\mathrm{true}}^{(A)}, G_{\\mathrm{cut}}^{\\mathrm{PS},(A)}, G_{\\mathrm{corr}}^{\\mathrm{PS},(A)}, G_{\\mathrm{cut}}^{\\mathrm{FS},(A)}, G_{\\mathrm{corr}}^{\\mathrm{FS},(A)}\\right], \\left[G_{\\mathrm{true}}^{(B)}, \\ldots\\right], \\left[G_{\\mathrm{true}}^{(C)}, \\ldots\\right]\\right].\n   $$\n   的列表的列表形式的结果。该行必须只包含这个带有浮点数的类 Python 列表字面量。\n\n所有计算和答案都必须采用简约 Lennard–Jones 单位（无量纲）。除 Newton 运动定律、正则系综对 $g(r)$ 的定义、Kirkwood–Buff 积分的定义以及 Lennard–Jones 势的标准形式外，不得假定任何先验知识。除了这些基础知识，您不得使用任何快捷公式。请确保您的推导和实现具有科学真实性和内部一致性。", "solution": "任务是在使用带截断的势能移位和力移位方案时，为无限稀释极限下的 Kirkwood–Buff 积分（KBI）推导无偏估计量，然后使用 Lennard-Jones 势对这些估计量进行数值计算实现。\n\n真实的 Kirkwood–Buff 积分 $G_{\\mathrm{true}}$ 定义为：\n$$\nG_{\\mathrm{true}} = 4\\pi \\int_{0}^{\\infty} r^2 \\left[g(r) - 1\\right] \\, dr\n$$\n在无限稀释极限下，径向分布函数 $g(r)$ 由 Boltzmann 因子给出，$g(r) = \\exp(-\\beta u(r))$，其中 $u(r)$ 是对势函数，$\\beta = (k_{\\mathrm{B}} T)^{-1}$。\n\n积分可以在截断半径 $r_c$ 处拆分：\n$$\nG_{\\mathrm{true}} = 4\\pi \\int_{0}^{r_c} r^2 \\left[g(r) - 1\\right] \\, dr + 4\\pi \\int_{r_c}^{\\infty} r^2 \\left[g(r) - 1\\right] \\, dr\n$$\n第一项是截断球内部的贡献，第二项是尾部修正，我们将其表示为 $G_{\\mathrm{tail}}$。\n$$\nG_{\\mathrm{tail}} = 4\\pi \\int_{r_c}^{\\infty} r^2 \\left[\\exp(-\\beta u(r)) - 1\\right] \\, dr\n$$\n我们的目标是使用“测量”得到的径向分布函数 $g_{\\mathrm{ps}}(r)$ 和 $g_{\\mathrm{fs}}(r)$ 来表示第一项 $4\\pi \\int_{0}^{r_c} r^2 [g(r) - 1] \\, dr$，这些函数是通过使用修正势的模拟获得的。\n\n**1. 势能移位（PS）方案的推导**\n\n势能移位的势函数为：当 $r \\le r_c$ 时，$u_{\\mathrm{ps}}(r) = u(r) - u(r_c)$。\n模拟中测得的相应径向分布函数为 $g_{\\mathrm{ps}}(r) = \\exp(-\\beta u_{\\mathrm{ps}}(r))$。\n对于 $r \\le r_c$，我们可以将真实的 $g(r)$ 与测得的 $g_{\\mathrm{ps}}(r)$ 联系起来：\n$$\ng_{\\mathrm{ps}}(r) = \\exp(-\\beta [u(r) - u(r_c)]) = \\exp(-\\beta u(r)) \\exp(\\beta u(r_c)) = g(r) \\exp(\\beta u(r_c))\n$$\n由此，我们可以用测得的 $g_{\\mathrm{ps}}(r)$ 表示 $r \\le r_c$ 时的真实 $g(r)$：\n$$\ng(r) = g_{\\mathrm{ps}}(r) \\exp(-\\beta u(r_c))\n$$\n现在，我们将其代入截至 $r_c$ 的积分中：\n$$\n4\\pi \\int_{0}^{r_c} r^2 \\left[g(r) - 1\\right] \\, dr = 4\\pi \\int_{0}^{r_c} r^2 \\left[g_{\\mathrm{ps}}(r) \\exp(-\\beta u(r_c)) - 1\\right] \\, dr\n$$\n为了得到用朴素截断 KBI $G_{\\mathrm{cut}}^{\\mathrm{PS}} = 4\\pi \\int_{0}^{r_c} r^2 [g_{\\mathrm{ps}}(r) - 1] \\, dr$ 表示的估计量，我们重排被积函数：\n$$\ng_{\\mathrm{ps}}(r) \\exp(-\\beta u(r_c)) - 1 = \\left(g_{\\mathrm{ps}}(r) - 1\\right)\\exp(-\\beta u(r_c)) + \\exp(-\\beta u(r_c)) - 1\n$$\n将其代回积分：\n$$\n\\int_{0}^{r_c} r^2 \\left[g(r) - 1\\right] \\, dr = \\exp(-\\beta u(r_c)) \\int_{0}^{r_c} r^2 \\left[g_{\\mathrm{ps}}(r) - 1\\right] \\, dr + \\left(\\exp(-\\beta u(r_c)) - 1\\right) \\int_{0}^{r_c} r^2 \\, dr\n$$\n乘以 $4\\pi$ 并识别出 $G_{\\mathrm{cut}}^{\\mathrm{PS}} = 4\\pi \\int_{0}^{r_c} r^2 [g_{\\mathrm{ps}}(r) - 1] \\, dr$ 以及 $\\int_{0}^{r_c} r^2 \\, dr = r_c^3/3$：\n$$\n4\\pi \\int_{0}^{r_c} r^2 \\left[g(r) - 1\\right] \\, dr = \\exp(-\\beta u(r_c)) G_{\\mathrm{cut}}^{\\mathrm{PS}} + 4\\pi \\frac{r_c^3}{3} \\left(\\exp(-\\beta u(r_c)) - 1\\right)\n$$\n完整 KBI 的无偏估计量 $G_{\\mathrm{corr}}^{\\mathrm{PS}}$ 是这个修正项与尾部修正 $G_{\\mathrm{tail}}$ 的和：\n$$\nG_{\\mathrm{corr}}^{\\mathrm{PS}} = \\exp(-\\beta u(r_c)) G_{\\mathrm{cut}}^{\\mathrm{PS}} + 4\\pi \\frac{r_c^3}{3} \\left(\\exp(-\\beta u(r_c)) - 1\\right) + G_{\\mathrm{tail}}\n$$\n该估计量使用了朴素计算的积分 $G_{\\mathrm{cut}}^{\\mathrm{PS}}$、已知的 $u(r_c)$ 和 $r_c$ 值，以及理论计算的尾部修正。\n\n**2. 力移位（FS）方案的推导**\n\n力移位的势函数为：当 $r \\le r_c$ 时，$u_{\\mathrm{fs}}(r) = u(r) - u(r_c) - (r - r_c) u'(r_c)$。\n测得的 RDF 为 $g_{\\mathrm{fs}}(r) = \\exp(-\\beta u_{\\mathrm{fs}}(r))$。\n对于 $r \\le r_c$，我们将 $g(r)$ 与 $g_{\\mathrm{fs}}(r)$ 联系起来：\n$$\ng_{\\mathrm{fs}}(r) = \\exp(-\\beta [u(r) - u(r_c) - (r - r_c) u'(r_c)]) = g(r) \\exp(\\beta [u(r_c) + (r - r_c) u'(r_c)])\n$$\n因此，对于 $r \\le r_c$，真实的 $g(r)$ 是：\n$$\ng(r) = g_{\\mathrm{fs}}(r) \\exp(-\\beta [u(r_c) + (r - r_c) u'(r_c)])\n$$\nKBI 在 $r \\in [0, r_c]$ 区间的贡献为：\n$$\n4\\pi \\int_{0}^{r_c} r^2 \\left[g(r) - 1\\right] \\, dr = 4\\pi \\int_{0}^{r_c} r^2 \\left\\{ g_{\\mathrm{fs}}(r) \\exp(-\\beta [u(r_c) + (r - r_c) u'(r_c)]) - 1 \\right\\} \\, dr\n$$\n与 PS 情况不同，修正因子依赖于 $r$ 并且不能从积分中提出。因此，修正估计量不能写成朴素估计量 $G_{\\mathrm{cut}}^{\\mathrm{FS}}$ 的简单代数函数。相反，该估计量本身是测得的 $g_{\\mathrm{fs}}(r)$ 的积分变换。\n完整的修正估计量 $G_{\\mathrm{corr}}^{\\mathrm{FS}}$ 是：\n$$\nG_{\\mathrm{corr}}^{\\mathrm{FS}} = 4\\pi \\int_{0}^{r_c} r^2 \\left\\{ g_{\\mathrm{fs}}(r) \\exp(-\\beta [u(r_c) + (r - r_c) u'(r_c)]) - 1 \\right\\} \\, dr + G_{\\mathrm{tail}}\n$$\n这是无偏估计量。在这个问题中，我们给出了 $g_{\\mathrm{fs}}(r) = \\exp(-\\beta u_{\\mathrm{fs}}(r))$ 的解析形式。将其代入被积函数可以发现，修正项恰好恢复了 $r \\le r_c$ 时的真实被积函数：\n$$\ng_{\\mathrm{fs}}(r) \\exp(-\\beta [u(r_c) + (r - r_c) u'(r_c)]) = \\exp(-\\beta u_{\\mathrm{fs}}(r)) \\exp(-\\beta [u(r_c) + (r - r_c) u'(r_c)]) = \\exp(-\\beta u(r)) = g(r)\n$$\n因此，对于这个理想化问题，修正估计量的积分变为 $4\\pi \\int_{0}^{r_c} r^2 \\left[g(r) - 1\\right] \\, dr$。加上尾部修正 $G_{\\mathrm{tail}}$ 意味着 $G_{\\mathrm{corr}}^{\\mathrm{FS}}$ 在数值上将与 $G_{\\mathrm{true}}$ 相同。这为力移位修正方案提供了有力的验证。类似的检查也证实了 $G_{\\mathrm{corr}}^{\\mathrm{PS}}$ 同样能正确地计算出 $G_{\\mathrm{true}}$。\n\n**3. 实现摘要**\n\n对于每个测试用例 $(T, r_c)$：\na. 我们通过对 $4\\pi r^2 (\\exp(-\\beta u(r)) - 1)$ 从 $0$ 到 $\\infty$ 进行数值积分来计算 $G_{\\mathrm{true}}$。\nb. 我们通过对相应的表达式积分到 $r_c$ 来计算朴素估计量 $G_{\\mathrm{cut}}^{\\mathrm{PS}}$ 和 $G_{\\mathrm{cut}}^{\\mathrm{FS}}$。\nc. 我们通过对 $4\\pi r^2 (\\exp(-\\beta u(r)) - 1)$ 从 $r_c$ 到 $\\infty$ 进行积分来计算尾部修正 $G_{\\mathrm{tail}}$。\nd. 我们使用推导出的公式计算修正估计量 $G_{\\mathrm{corr}}^{\\mathrm{PS}}$ 和 $G_{\\mathrm{corr}}^{\\mathrm{FS}}$。由于此问题的解析性质，两者预计在数值上都等于 $G_{\\mathrm{true}}$。\n所有计算都使用简约单位（$\\varepsilon = 1$，$\\sigma = 1$，$k_{\\mathrm{B}} = 1$）下的 Lennard-Jones 势，$u(r) = 4(r^{-12} - r^{-6})$。", "answer": "```python\nimport numpy as np\nfrom scipy.integrate import quad\n\ndef solve():\n    \"\"\"\n    Computes Kirkwood-Buff integrals for different potential modification schemes.\n    \"\"\"\n\n    # Lennard-Jones potential and its derivative in reduced units (sigma=1, epsilon=1).\n    def u_lj(r):\n        \"\"\"Lennard-Jones potential.\"\"\"\n        if r == 0:\n            return np.inf\n        r_inv = 1.0 / r\n        r_inv6 = r_inv**6\n        return 4.0 * (r_inv6**2 - r_inv6)\n\n    def u_lj_prime(r):\n        \"\"\"Derivative of the Lennard-Jones potential.\"\"\"\n        if r == 0:\n            return np.inf\n        r_inv = 1.0 / r\n        r_inv7 = r_inv**7\n        r_inv13 = r_inv**13\n        return 4.0 * (-12.0 * r_inv13 + 6.0 * r_inv7)\n\n    def calculate_kbi_quantities(T, rc):\n        \"\"\"\n        Calculates the five specified KBI-related quantities for a given\n        temperature T and cutoff radius rc.\n        \"\"\"\n        beta = 1.0 / T\n\n        # Pre-calculate potential and its derivative at the cutoff\n        uc = u_lj(rc)\n        uc_prime = u_lj_prime(rc)\n\n        # Integrand for the true KBI\n        def integrand_true(r):\n            potential = u_lj(r)\n            # Avoid overflow for large potential at r -> 0\n            if beta * potential > 700:\n                g_r = 0.0\n            else:\n                g_r = np.exp(-beta * potential)\n            return 4.0 * np.pi * r**2 * (g_r - 1.0)\n\n        # 1. True KBI (G_true)\n        # The integral is over [0, inf).\n        G_true, _ = quad(integrand_true, 0, np.inf)\n\n        # Integrand for the naive potential-shifted KBI\n        def integrand_cut_ps(r):\n            # g_ps(r) = exp(-beta * (u(r) - u(rc)))\n            g_ps_r = np.exp(-beta * (u_lj(r) - uc))\n            return 4.0 * np.pi * r**2 * (g_ps_r - 1.0)\n\n        # 2. Naive KBI with Potential Shifting (G_cut_ps)\n        # The integral is over [0, rc].\n        G_cut_ps, _ = quad(integrand_cut_ps, 0, rc)\n\n        # 3. Corrected KBI with Potential Shifting (G_corr_ps)\n        # This requires the tail correction\n        G_tail, _ = quad(integrand_true, rc, np.inf)\n        # G_corr^PS = exp(-beta*u(rc))*G_cut^PS + 4*pi*(rc^3/3)*(exp(-beta*u(rc))-1) + G_tail\n        term1 = np.exp(-beta * uc) * G_cut_ps\n        term2 = 4.0 * np.pi * (rc**3 / 3.0) * (np.exp(-beta * uc) - 1.0)\n        G_corr_ps = term1 + term2 + G_tail\n\n        # Integrand for the naive force-shifted KBI\n        def integrand_cut_fs(r):\n            # g_fs(r) = exp(-beta * (u(r) - u(rc) - (r-rc)*u'(rc)))\n            potential_fs = u_lj(r) - uc - (r - rc) * uc_prime\n            g_fs_r = np.exp(-beta * potential_fs)\n            return 4.0 * np.pi * r**2 * (g_fs_r - 1.0)\n\n        # 4. Naive KBI with Force Shifting (G_cut_fs)\n        # The integral is over [0, rc].\n        G_cut_fs, _ = quad(integrand_cut_fs, 0, rc)\n\n        # 5. Corrected KBI with Force Shifting (G_corr_fs)\n        # As shown in the derivation, for an ideal system with an analytical g_fs(r),\n        # the corrected estimator exactly reconstructs the true KBI.\n        # G_corr^FS = integral from 0 to rc of the corrected integrand + G_tail\n        # The corrected integrand is identical to integrand_true.\n        G_true_le_rc, _ = quad(integrand_true, 0, rc)\n        G_corr_fs = G_true_le_rc + G_tail\n        # Due to properties of integration, this will be numerically identical to G_true.\n\n        return [G_true, G_cut_ps, G_corr_ps, G_cut_fs, G_corr_fs]\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (1.5, 2.5),  # Case A: happy path\n        (0.8, 1.3),  # Case B: boundary condition sensitivity\n        (3.0, 5.0),  # Case C: large cutoff\n    ]\n\n    all_results = []\n    for T, rc in test_cases:\n        results_for_case = calculate_kbi_quantities(T, rc)\n        all_results.append(results_for_case)\n\n    # Python's default print for a list of lists matches the required format.\n    print(all_results)\n    \nsolve()\n```", "id": "3436422"}, {"introduction": "最后一个练习将带你深入分析势能修正方案带来的更细微的二次效应。即使力移位解决了截断半径处的力不连续问题，修正后的势能本身仍会轻微改变流体的结构，其影响甚至会延伸到截断半径之外。通过对径向分布函数 $g(r)$ 的长程行为进行建模，本练习旨在量化这种结构上的微小变化对标准能量“尾部校正”所引入的误差，从而让你对模拟方案的精度有更深刻的认识 [@problem_id:3436473]。", "problem": "一个均匀、各向同性的流体通过分子动力学（MD）进行模拟，使用了成对的 Lennard-Jones (LJ) $12$–$6$ 势 $u(r)=4\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12}-\\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$，该势在截断半径 $r_c$ 处进行了截断和力移位。在每个粒子的势能的标准尾部校正中，来自距离 $r>r_c$ 的贡献通过假设径向分布函数 (RDF) $g(r)=1$（对于 $r>r_c$）来近似。然而，在存在力移位的情况下，对于 $r>r_c$ 的实际 $g(r)$ 可能会偏离 $1$。在热力学极限下进行推导，并假设流体数密度为 $\\rho$，且 $r_c \\ge 2^{1/6}\\sigma$ 以至于对于所有 $r\\ge r_c$ 都有 $u(r) \\le 0$，并且测得对于 $r\\ge r_c$ 的 $g(r)$ 具有 $g(r)=1+a\\left(\\frac{r_c}{r}\\right)^{q}$ 形式的衰减，其中 $a$ 是无量纲的且 $q>0$。同时假设从测量的衰减的统计分析中可以得到不确定性界限 $|a|\\le a_{\\max}$。\n\n从第一性原理（牛顿定律导出成对可加能量，以及系综平均能量根据 RDF 的定义）出发，完成以下任务：\n\n1. 当真实 $g(r)$ 为 $1+a\\left(\\frac{r_c}{r}\\right)^{q}$ (对于 $r\\ge r_c$) 时，推导因假设 $g(r)=1$ 而产生的标准能量尾部校正的绝对误差的解析上界。你的界限必须明确依赖于 $\\rho$、$\\epsilon$、$\\sigma$、$r_c$、$q$ 和 $|a|$。\n\n2. 提出并推导一个考虑了测量的衰减 $g(r)=1+a\\left(\\frac{r_c}{r}\\right)^{q}$ 的修正后的每个粒子的能量尾部校正积分，并对上述 LJ 势以闭合形式求值。\n\n将最终的每个粒子的能量尾部校正仅用符号 $\\rho$、$\\epsilon$、$\\sigma$、$r_c$、$a$ 和 $q$ 表示为一个闭合形式的解析表达式。不要代入数值。无需四舍五入。在最终的方框答案中不要包含物理单位；单位被理解为能量单位。", "solution": "在一个数密度为 $\\rho$ 的均匀、各向同性流体中，每个粒子的势能 $\\frac{\\langle U \\rangle}{N}$ 由对偶势 $u(r)$ 乘以径向分布函数 $g(r)$ 的积分给出：\n$$\n\\frac{\\langle U \\rangle}{N} = \\frac{1}{2}\\rho \\int_{0}^{\\infty} u(r) g(r) 4\\pi r^2 dr = 2\\pi\\rho \\int_{0}^{\\infty} u(r) g(r) r^2 dr\n$$\n在具有截断半径 $r_c$ 的模拟中，来自距离 $r>r_c$ 的能量贡献被忽略。尾部校正 $E_{\\mathrm{tail}}$ 旨在将这部分贡献加回，以恢复对应于全势的能量。\n$$\nE_{\\mathrm{tail}} = 2\\pi\\rho \\int_{r_c}^{\\infty} u(r) g(r) r^2 dr\n$$\n标准尾部校正 $E_{\\mathrm{std}}$ 做了近似，即对于 $r > r_c$，$g(r) \\approx 1$，因为假设在长距离下相关性可以忽略不计。\n$$\nE_{\\mathrm{std}} = 2\\pi\\rho \\int_{r_c}^{\\infty} u(r) r^2 dr\n$$\n\n#### 1. 绝对误差的上界\n\n问题为 RDF 提供了一个更精确的形式：对于 $r \\ge r_c$，$g(r) = 1+a\\left(\\frac{r_c}{r}\\right)^{q}$。因此，真实的尾部校正 $E_{\\mathrm{true}}$ 为：\n$$\nE_{\\mathrm{true}} = 2\\pi\\rho \\int_{r_c}^{\\infty} u(r) \\left[1+a\\left(\\frac{r_c}{r}\\right)^{q}\\right] r^2 dr\n$$\n标准尾部校正中的误差 $\\Delta E$ 是 $E_{\\mathrm{true}} - E_{\\mathrm{std}}$ 的差值：\n$$\n\\Delta E = 2\\pi\\rho \\int_{r_c}^{\\infty} u(r) \\left[1+a\\left(\\frac{r_c}{r}\\right)^{q}\\right] r^2 dr - 2\\pi\\rho \\int_{r_c}^{\\infty} u(r) r^2 dr\n$$\n$$\n\\Delta E = 2\\pi\\rho \\int_{r_c}^{\\infty} u(r) \\left[a\\left(\\frac{r_c}{r}\\right)^{q}\\right] r^2 dr = 2\\pi\\rho a r_c^q \\int_{r_c}^{\\infty} u(r) r^{2-q} dr\n$$\n我们需要绝对误差 $|\\Delta E|$ 的一个上界。\n$$\n|\\Delta E| = \\left| 2\\pi\\rho a r_c^q \\int_{r_c}^{\\infty} u(r) r^{2-q} dr \\right| = 2\\pi\\rho |a| r_c^q \\left| \\int_{r_c}^{\\infty} u(r) r^{2-q} dr \\right|\n$$\n已知 $r_c \\ge 2^{1/6}\\sigma$，对于所有 $r \\ge r_c$，势 $u(r) \\le 0$。由于 $r^{2-q}$ 是正的，被积函数 $u(r)r^{2-q}$ 是非正的。因此，积分为负，其绝对值是其相反数：\n$$\n|\\Delta E| = -2\\pi\\rho |a| r_c^q \\int_{r_c}^{\\infty} u(r) r^{2-q} dr\n$$\n代入 Lennard-Jones 势 $u(r)=4\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12}-\\left(\\frac{\\sigma}{r}\\right)^{6}\\right]$：\n$$\n|\\Delta E| = -2\\pi\\rho |a| r_c^q \\int_{r_c}^{\\infty} 4\\epsilon\\left[\\sigma^{12}r^{-12} - \\sigma^6 r^{-6}\\right] r^{2-q} dr\n$$\n$$\n|\\Delta E| = -8\\pi\\rho\\epsilon |a| r_c^q \\int_{r_c}^{\\infty} \\left(\\sigma^{12}r^{-10-q} - \\sigma^6 r^{-4-q}\\right) dr\n$$\n由于 $q>0$，积分收敛。计算该积分：\n$$\n\\int_{r_c}^{\\infty} \\left(\\sigma^{12}r^{-10-q} - \\sigma^6 r^{-4-q}\\right) dr = \\left[ \\frac{\\sigma^{12}r^{-9-q}}{-9-q} - \\frac{\\sigma^6 r^{-3-q}}{-3-q} \\right]_{r_c}^{\\infty}\n$$\n$$\n= (0-0) - \\left( \\frac{\\sigma^{12}r_c^{-9-q}}{-9-q} - \\frac{\\sigma^6 r_c^{-3-q}}{-3-q} \\right) = \\frac{\\sigma^{12}r_c^{-9-q}}{9+q} - \\frac{\\sigma^6 r_c^{-3-q}}{3+q}\n$$\n将此结果代回 $|\\Delta E|$ 的表达式中：\n$$\n|\\Delta E| = -8\\pi\\rho\\epsilon |a| r_c^q \\left[ \\frac{\\sigma^{12}r_c^{-9-q}}{9+q} - \\frac{\\sigma^6 r_c^{-3-q}}{3+q} \\right]\n$$\n$$\n|\\Delta E| = 8\\pi\\rho\\epsilon |a| r_c^q \\left[ \\frac{\\sigma^6 r_c^{-3-q}}{3+q} - \\frac{\\sigma^{12}r_c^{-9-q}}{9+q} \\right]\n$$\n通过分配 $r_c^q$ 项来简化：\n$$\n|\\Delta E| = 8\\pi\\rho\\epsilon |a| \\left[ \\frac{\\sigma^6 r_c^{-3}}{3+q} - \\frac{\\sigma^{12}r_c^{-9}}{9+q} \\right]\n$$\n这就是所要求的绝对误差关于 $|a|$ 的上界。\n\n#### 2. 修正后的能量尾部校正\n\n修正后的每个粒子的能量尾部校正是我们之前定义的 $E_{\\mathrm{true}}$。它可以计算为标准校正 $E_{\\mathrm{std}}$ 和误差项 $\\Delta E$ 的和。\n$$\nE_{\\mathrm{corr}} = E_{\\mathrm{std}} + \\Delta E\n$$\n首先，我们计算标准尾部校正 $E_{\\mathrm{std}}$，这对应于在我们之前的计算中设置 $q \\to \\infty$ 和 $a=1$，或者更直接地，对 $u(r)r^2$ 进行积分：\n$$\nE_{\\mathrm{std}} = 2\\pi\\rho \\int_{r_c}^{\\infty} 4\\epsilon\\left[\\left(\\frac{\\sigma}{r}\\right)^{12}-\\left(\\frac{\\sigma}{r}\\right)^{6}\\right] r^2 dr = 8\\pi\\rho\\epsilon \\int_{r_c}^{\\infty} \\left( \\sigma^{12}r^{-10} - \\sigma^6 r^{-4} \\right) dr\n$$\n$$\nE_{\\mathrm{std}} = 8\\pi\\rho\\epsilon \\left[ \\frac{\\sigma^{12}r^{-9}}{-9} - \\frac{\\sigma^6 r^{-3}}{-3} \\right]_{r_c}^{\\infty} = 8\\pi\\rho\\epsilon \\left[ (0-0) - \\left( \\frac{\\sigma^{12}r_c^{-9}}{-9} - \\frac{\\sigma^6 r_c^{-3}}{-3} \\right) \\right]\n$$\n$$\nE_{\\mathrm{std}} = 8\\pi\\rho\\epsilon \\left[ \\frac{\\sigma^{12}}{9r_c^9} - \\frac{\\sigma^6}{3r_c^3} \\right]\n$$\n误差项 $\\Delta E$ 在上一节中已计算（不带绝对值）：\n$$\n\\Delta E = 2\\pi\\rho a r_c^q \\int_{r_c}^{\\infty} u(r) r^{2-q} dr = 8\\pi\\rho\\epsilon a r_c^q \\left[ \\frac{\\sigma^{12}r_c^{-9-q}}{9+q} - \\frac{\\sigma^6 r_c^{-3-q}}{3+q} \\right]\n$$\n修正后的尾部校正 $E_{\\mathrm{corr}}$ 是这两项的和：\n$$\nE_{\\mathrm{corr}} = 8\\pi\\rho\\epsilon \\left[ \\frac{\\sigma^{12}}{9r_c^9} - \\frac{\\sigma^6}{3r_c^3} \\right] + 8\\pi\\rho\\epsilon a \\left[ \\frac{\\sigma^{12}}{r_c^9(9+q)} - \\frac{\\sigma^6}{r_c^3(3+q)} \\right]\n$$\n合并具有公因式 $\\sigma^{12}/r_c^9$ 和 $\\sigma^6/r_c^3$ 的项：\n$$\nE_{\\mathrm{corr}} = 8\\pi\\rho\\epsilon \\left[ \\left(\\frac{\\sigma^{12}}{9r_c^9} + \\frac{a\\sigma^{12}}{r_c^9(9+q)}\\right) - \\left(\\frac{\\sigma^6}{3r_c^3} + \\frac{a\\sigma^6}{r_c^3(3+q)}\\right) \\right]\n$$\n$$\nE_{\\mathrm{corr}} = 8\\pi\\rho\\epsilon \\left[ \\frac{\\sigma^{12}}{r_c^9} \\left(\\frac{1}{9} + \\frac{a}{9+q}\\right) - \\frac{\\sigma^6}{r_c^3} \\left(\\frac{1}{3} + \\frac{a}{3+q}\\right) \\right]\n$$\n这就是修正后的每个粒子的能量尾部校正的最终闭合形式表达式。", "answer": "$$\n\\boxed{8\\pi\\rho\\epsilon \\left[ \\frac{\\sigma^{12}}{r_c^{9}} \\left(\\frac{1}{9} + \\frac{a}{9+q}\\right) - \\frac{\\sigma^{6}}{r_c^{3}} \\left(\\frac{1}{3} + \\frac{a}{3+q}\\right) \\right]}\n$$", "id": "3436473"}]}