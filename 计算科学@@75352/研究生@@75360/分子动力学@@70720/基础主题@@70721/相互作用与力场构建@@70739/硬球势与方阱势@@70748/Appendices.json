{"hands_on_practices": [{"introduction": "理论的美妙之处在于，它能将微观世界的相互作用与宏观世界的可测属性联系起来。本练习将通过一个经典的统计力学计算，让您亲身体验这一过程。我们将从方阱势的基本定义出发，推导气体的玻意耳温度 $T_B$——在此温度下，真实气体的行为最接近理想气体。通过求解这个问题，您将深入理解分子间吸引和排斥的平衡如何决定了气体的热力学行为，并熟练掌握如何将统计力学的第一性原理应用于具体的物理模型。[@problem_id:3415440]", "problem": "一种单原子流体由一个两两相加的方阱（SW）势来描述，该势具有直径为 $\\sigma$ 的硬核、吸引阱深度 $\\varepsilon>0$ 以及相对范围参数 $\\lambda>1$。对势 $u(r)$ 作为中心间距 $r$ 的函数为\n$$\nu(r)=\n\\begin{cases}\n+\\infty,  0 \\le r  \\sigma,\\\\\n-\\varepsilon,  \\sigma \\le r  \\lambda\\sigma,\\\\\n0,  r \\ge \\lambda\\sigma.\n\\end{cases}\n$$\n第二维里系数 $B_{2}(T)$ 由迈耶f函数 $f(r)=\\exp\\!\\big(-\\beta u(r)\\big)-1$ 定义，其中 $\\beta=1/(k_{B}T)$，其形式如下\n$$\nB_{2}(T)=-2\\pi\\int_{0}^{\\infty} f(r)\\,r^{2}\\,dr,\n$$\n其中 $k_{B}$ 是玻尔兹曼常数。玻意耳温度 $T_{B}$ 由条件 $B_{2}(T_{B})=0$ 隐式定义。\n\n从上述定义和 $u(r)$ 的分段形式出发，推导一个用 $\\varepsilon$、$\\lambda$ 和 $k_{B}$ 表示的 $T_{B}$ 的显式闭合表达式。你的最终答案必须是单一的解析表达式。以开尔文为单位表示温度。不要代入数值。", "solution": "该问题要求推导由方阱势描述的单原子流体的玻意耳温度 $T_B$。玻意耳温度定义为第二维里系数 $B_2(T)$ 等于零时的温度。\n\n第二维里系数 $B_2(T)$ 由以下积分给出：\n$$\nB_2(T) = -2\\pi \\int_{0}^{\\infty} f(r)\\,r^2\\,dr\n$$\n其中迈耶f函数定义为 $f(r) = \\exp(-\\beta u(r)) - 1$，且 $\\beta = 1/(k_B T)$。\n\n首先，我们必须对给定的分段方阱势 $u(r)$ 计算迈耶f函数：\n$$\nu(r)=\n\\begin{cases}\n+\\infty,  0 \\le r  \\sigma,\\\\\n-\\varepsilon,  \\sigma \\le r  \\lambda\\sigma,\\\\\n0,  r \\ge \\lambda\\sigma.\n\\end{cases}\n$$\n\n在每个区域中，$f(r)$函数具有以下形式：\n1.  对于 $0 \\le r  \\sigma$：$u(r) = +\\infty$。因此，$\\exp(-\\beta u(r)) = \\exp(-\\infty) = 0$，这得到 $f(r) = 0 - 1 = -1$。\n2.  对于 $\\sigma \\le r  \\lambda\\sigma$：$u(r) = -\\varepsilon$。因此，$\\exp(-\\beta u(r)) = \\exp(-\\beta(-\\varepsilon)) = \\exp(\\beta\\varepsilon)$，这得到 $f(r) = \\exp(\\beta\\varepsilon) - 1$。\n3.  对于 $r \\ge \\lambda\\sigma$：$u(r) = 0$。因此，$\\exp(-\\beta u(r)) = \\exp(0) = 1$，这得到 $f(r) = 1 - 1 = 0$。\n\n现在，我们可以将此分段函数代入 $B_2(T)$ 的积分中，将积分分成三个区域：\n$$\nB_2(T) = -2\\pi \\left[ \\int_{0}^{\\sigma} (-1) r^2 dr + \\int_{\\sigma}^{\\lambda\\sigma} (\\exp(\\beta\\varepsilon) - 1) r^2 dr + \\int_{\\lambda\\sigma}^{\\infty} (0) r^2 dr \\right]\n$$\n\n让我们计算每个积分：\n第一个积分对应于硬核排斥：\n$$\n\\int_{0}^{\\sigma} (-1) r^2 dr = - \\left[ \\frac{r^3}{3} \\right]_0^\\sigma = -\\frac{\\sigma^3}{3}\n$$\n\n第二个积分对应于吸引阱。项 $(\\exp(\\beta\\varepsilon) - 1)$ 相对于积分变量 $r$ 是常数：\n$$\n\\int_{\\sigma}^{\\lambda\\sigma} (\\exp(\\beta\\varepsilon) - 1) r^2 dr = (\\exp(\\beta\\varepsilon) - 1) \\int_{\\sigma}^{\\lambda\\sigma} r^2 dr = (\\exp(\\beta\\varepsilon) - 1) \\left[ \\frac{r^3}{3} \\right]_\\sigma^{\\lambda\\sigma}\n$$\n$$\n= (\\exp(\\beta\\varepsilon) - 1) \\left( \\frac{(\\lambda\\sigma)^3}{3} - \\frac{\\sigma^3}{3} \\right) = (\\exp(\\beta\\varepsilon) - 1) \\frac{\\sigma^3}{3} (\\lambda^3 - 1)\n$$\n\n第三个积分等于零，因为被积函数为零：\n$$\n\\int_{\\lambda\\sigma}^{\\infty} (0) r^2 dr = 0\n$$\n\n结合这些结果，我们得到 $B_2(T)$ 的表达式：\n$$\nB_2(T) = -2\\pi \\left[ -\\frac{\\sigma^3}{3} + (\\exp(\\beta\\varepsilon) - 1) \\frac{\\sigma^3}{3} (\\lambda^3 - 1) \\right]\n$$\n提出公因式 $2\\pi\\sigma^3/3$：\n$$\nB_2(T) = \\frac{2\\pi\\sigma^3}{3} \\left[ 1 - (\\exp(\\beta\\varepsilon) - 1) (\\lambda^3 - 1) \\right]\n$$\n\n玻意耳温度 $T_B$ 由条件 $B_2(T_B) = 0$ 定义。令 $\\beta_B = 1/(k_B T_B)$。将 $B_2(T)$ 的表达式设为零，我们有：\n$$\n\\frac{2\\pi\\sigma^3}{3} \\left[ 1 - (\\exp(\\beta_B\\varepsilon) - 1) (\\lambda^3 - 1) \\right] = 0\n$$\n由于 $\\sigma$ 是一个物理直径，$\\sigma > 0$，所以前置因子 $2\\pi\\sigma^3/3$ 非零。因此，方括号中的项必须为零：\n$$\n1 - (\\exp(\\beta_B\\varepsilon) - 1) (\\lambda^3 - 1) = 0\n$$\n\n我们现在求解这个方程以得到 $T_B$。重新整理各项可得：\n$$\n1 = (\\exp(\\beta_B\\varepsilon) - 1) (\\lambda^3 - 1)\n$$\n问题陈述中指明 $\\lambda > 1$，这意味着 $\\lambda^3 - 1 \\neq 0$。我们可以除以该项：\n$$\n\\frac{1}{\\lambda^3 - 1} = \\exp(\\beta_B\\varepsilon) - 1\n$$\n分离指数项：\n$$\n\\exp(\\beta_B\\varepsilon) = 1 + \\frac{1}{\\lambda^3 - 1}\n$$\n将右侧的项合并到一个公分母上：\n$$\n\\exp(\\beta_B\\varepsilon) = \\frac{(\\lambda^3 - 1) + 1}{\\lambda^3 - 1} = \\frac{\\lambda^3}{\\lambda^3 - 1}\n$$\n为了求解 $\\beta_B$，我们对两边取自然对数：\n$$\n\\beta_B\\varepsilon = \\ln\\left(\\frac{\\lambda^3}{\\lambda^3 - 1}\\right)\n$$\n代入 $\\beta_B = 1/(k_B T_B)$：\n$$\n\\frac{\\varepsilon}{k_B T_B} = \\ln\\left(\\frac{\\lambda^3}{\\lambda^3 - 1}\\right)\n$$\n最后，求解 $T_B$ 得到显式的闭合形式表达式。已知 $\\varepsilon > 0$，我们可以将方程重新整理为：\n$$\nT_B = \\frac{\\varepsilon}{k_B \\ln\\left(\\frac{\\lambda^3}{\\lambda^3-1}\\right)}\n$$\n如果阱深 $\\varepsilon$ 的单位是焦耳，玻尔兹曼常数 $k_B$ 的单位是焦耳/开尔文，则此表达式给出了以开尔文为单位的玻意耳温度。", "answer": "$$\n\\boxed{\\frac{\\varepsilon}{k_{B} \\ln\\left(\\frac{\\lambda^{3}}{\\lambda^{3} - 1}\\right)}}\n$$", "id": "3415440"}, {"introduction": "从静态属性转向动态行为，硬球和方阱这类不连续势函数的模拟需要一种特殊而精确的方法：事件驱动分子动力学（EDMD）。与基于固定时间步长的积分方法不同，EDMD 的核心在于精确预测并处理离散的“事件”，例如粒子碰撞或穿越势阱边界。本练习将挑战您像设计算法一样思考物理过程，要求您为硬球-方阱系统设计一个稳健的事件处理方案。您需要运用牛顿运动定律和能量、动量守恒定律，来精确地检测事件发生的时间并正确更新粒子的速度。掌握这一逻辑对于精确模拟硬相互作用系统至关重要，它也揭示了事件驱动与时间步进这两种模拟范式之间的根本区别。[@problem_id:3415442]", "problem": "考虑一个双粒子分子动力学 (MD) 系统，其遵循由 $u(r) = +\\infty$（对于 $r  \\sigma$）、$u(r) = -\\varepsilon$（对于 $\\sigma \\le r  \\lambda \\sigma$）和 $u(r) = 0$（对于 $r \\ge \\lambda \\sigma$）定义的硬球-方阱 (HS+SW) 对势，其中 $r$ 是标量距离，$\\sigma$ 是硬核直径，$\\lambda > 1$ 是方阱范围因子，$\\varepsilon > 0$ 是阱深。在 $r = \\sigma$ 和 $r = \\lambda \\sigma$ 的不连续面之间，力为零，粒子做自由流运动。不连续性在表面上产生瞬时的中心相互作用。您需要设计一个大小为 $\\Delta t$ 的单次有限时间步长的步进方案，该方案对于穿越 $r = \\sigma$ 和 $r = \\lambda \\sigma$ 的情况具有鲁棒性。\n\n从瞬时作用之间自由运动的牛顿定律（对于直到事件发生的 $\\tau$，有 $\\mathbf{r}_i(t + \\tau) = \\mathbf{r}_i(t) + \\tau \\mathbf{v}_i(t)$，$\\mathbf{v}_i(t + \\tau) = \\mathbf{v}_i(t)$）以及瞬时中心相互作用下的守恒定律（实验室坐标系中的线性动量守恒、绕对中心的角动量守恒，以及考虑相应势阶的总能量守恒）出发，选择一个能够提供科学上一致且计算上鲁棒的方案的选项，该方案能够：\n\n- 对于任意初始相对位置 $\\mathbf{r}_{ij}(t)$ 和速度 $\\mathbf{v}_{ij}(t)$（其中 $\\mathbf{r}_{ij} = \\mathbf{r}_i - \\mathbf{r}_j$ 和 $\\mathbf{v}_{ij} = \\mathbf{v}_i - \\mathbf{v}_j$），检测在单个有限时间步长 $\\Delta t$ 内可能发生的对 $r = \\sigma$ 和 $r = \\lambda \\sigma$ 的穿越。\n- 使用正确的自由流运动学，在步长内插值到事件时间 $t^*$。\n- 在 $r = \\sigma$ 和 $r = \\lambda \\sigma$ 处应用速度更新，这些更新在给定 HS+SW 势的情况下遵守线性动量、角动量和能量守恒。\n- 通过首先执行最早的事件，子步进到 $t^*$，进行更新，然后在剩余的时间步长内继续（可能会遇到另一个事件），从而正确地对多个可能的事件进行排序。\n\n哪个选项是正确的？\n\nA. 对于每一对粒子，仅在自由流中演化位置直到发生事件，方法是通过求解二次方程得到最早的穿越时间 $t^* \\in (0, \\Delta t]$，该穿越的目标为 $r(t) = b \\in \\{\\sigma, \\lambda \\sigma\\}$：找到 $(\\mathbf{r}_{ij}\\cdot \\mathbf{r}_{ij}) + 2 t (\\mathbf{r}_{ij}\\cdot \\mathbf{v}_{ij}) + t^2 (\\mathbf{v}_{ij}\\cdot \\mathbf{v}_{ij}) = b^2$ 的最小正根。如果两个表面都可能被穿越，计算两个候选时间并选择最小的允许值 $t^*$。用 $\\mathbf{r}_k(t + t^*) = \\mathbf{r}_k(t) + t^* \\mathbf{v}_k(t)$ 将所有粒子推进 $t^*$，在 $t^*$ 之前 $\\mathbf{v}_k$ 保持不变。在 $r = \\sigma$ 处，沿 $\\hat{\\mathbf{n}} = \\mathbf{r}_{ij}(t^*)/b$ 施加一个中心冲量，进行弹性硬球碰撞更新，该更新在保持线性动量守恒的同时反转相对法向分量：设质量为 $m_i, m_j$，计算冲量大小 $J = - \\dfrac{2 (\\mathbf{v}_{ij}\\cdot \\hat{\\mathbf{n}})}{\\frac{1}{m_i} + \\frac{1}{m_j}}$ （恢复系数 $e=1$），然后设置 $\\mathbf{v}_i' = \\mathbf{v}_i + \\dfrac{J}{m_i} \\hat{\\mathbf{n}}$ 和 $\\mathbf{v}_j' = \\mathbf{v}_j - \\dfrac{J}{m_j} \\hat{\\mathbf{n}}$。在 $r = \\lambda \\sigma$ 处，保留 $\\mathbf{v}_{ij}$ 的切向分量，并通过跨越大小为 $\\Delta U = \\pm \\varepsilon$ 的势阶的能量连续性仅更新法向分量：使用约化质量 $\\mu = \\dfrac{m_i m_j}{m_i + m_j}$，强制 $\\dfrac{\\mu}{2} v_{\\parallel}'^{\\,2} = \\dfrac{\\mu}{2} v_{\\parallel}^{\\,2} - \\Delta U$，其中 $v_{\\parallel} = \\mathbf{v}_{ij}\\cdot \\hat{\\mathbf{n}}$，取与穿越方向一致的 $v_{\\parallel}'$ 符号；如果试图离开势阱且 $\\dfrac{\\mu}{2} v_{\\parallel}^{\\,2}  \\varepsilon$，则通过设置 $v_{\\parallel}' = - v_{\\parallel}$ 进行反射（转折点），并且不发生穿越。事件发生后，在剩余的 $\\Delta t - t^*$ 时间内恢复自由流，如果发生更多事件则重复此过程；始终首先处理最早的事件。这保证了能量、线性和角动量守恒以及鲁棒的检测。\n\nB. 在一个时间步长内，将标量距离 $r(t)$ 线性插值为 $r(t) \\approx r_0 + \\dfrac{t}{\\Delta t} (r_1 - r_0)$，其中 $r_0 = \\|\\mathbf{r}_{ij}(t)\\|$ 和 $r_1 = \\|\\mathbf{r}_{ij}(t + \\Delta t)\\|$，以检测是否穿越了 $r = \\sigma$ 或 $r = \\lambda \\sigma$。如果检测到穿越，通过对 $r$ 的线性插值将事件置于 $t^*$，然后在任一表面上，简单地反转相对法向速度分量 $v_{\\parallel}$，同时保持切向分量对于 $r = \\sigma$ 和 $r = \\lambda \\sigma$ 都不变。在时间步长的剩余部分继续，而不重新计算候选的穿越事件。\n\nC. 使用标准的速度-Verlet积分器处理 $\\Delta t$，并使用一个连续的代理力，该力通过在 $r = \\sigma$ 和 $r = \\lambda \\sigma$ 附近设置陡峭的排斥力和吸引力来近似硬核和方阱；不执行事件检测。在步长结束时，如果 $r  \\sigma$ 或 $r$ 跳过了 $\\lambda \\sigma$，则通过最小化地调整位置以消除重叠，并对速度施加小的阻尼以使其稳定来进行校正。\n\nD. 仅通过求解法向投影的线性方程来检测事件：$(\\mathbf{r}_{ij}\\cdot \\hat{\\mathbf{n}}) + t (\\mathbf{v}_{ij}\\cdot \\hat{\\mathbf{n}}) = b$，其中 $b \\in \\{\\sigma, \\lambda \\sigma\\}$ 且 $\\hat{\\mathbf{n}}$ 从步长开始时取为 $\\hat{\\mathbf{n}} = \\mathbf{r}_{ij}(t)/\\|\\mathbf{r}_{ij}(t)\\|$。即使切向运动很大，也使用得到的时间作为 $t^*$。在 $r = \\sigma$ 处反转整个相对速度矢量 $\\mathbf{v}_{ij}$；在 $r = \\lambda \\sigma$ 处保持 $\\mathbf{v}_{ij}$ 不变，因为除了 $r = \\sigma$ 外力为零。按发现事件的顺序处理它们，而不比较它们的时间。", "solution": "问题陈述在科学上是合理的且定义明确的。它描述了计算统计力学中的一个经典问题：模拟通过硬球-方阱 (HS+SW) 势相互作用的粒子。处理此类不连续势的正确方法是事件驱动的分子动力学算法。该问题要求识别对此算法的正确描述。核心原则是事件之间的精确传播（自由流）和事件（碰撞）时的瞬时更新，这些更新遵守基本守恒定律：线性动量守恒、角动量守恒和总能量守恒。\n\n让我们从第一性原理推导正确的程序。\n\n**1. 事件检测**\n在事件之间，粒子 $i$ 和 $j$ 以恒定速度 $\\mathbf{v}_i$ 和 $\\mathbf{v}_j$ 运动。它们的相对位置矢量随时间线性演化：\n$$ \\mathbf{r}_{ij}(t' ) = \\mathbf{r}_{ij}(t) + (t'-t) \\mathbf{v}_{ij}(t) $$\n其中 $\\mathbf{r}_{ij} = \\mathbf{r}_i - \\mathbf{r}_j$ 且 $\\mathbf{v}_{ij} = \\mathbf{v}_i - \\mathbf{v}_j$。令 $\\tau = t'-t$ 为从一个自由流区间开始所经过的时间。当粒子间距 $r_{ij} = |\\mathbf{r}_{ij}|$ 等于势的不连续半径之一 $b \\in \\{\\sigma, \\lambda\\sigma\\}$ 时，发生一个事件。为了找到事件的时间 $\\tau = t^*$，我们必须求解 $r_{ij}^2(t^*) = b^2$：\n$$ |\\mathbf{r}_{ij}(0) + t^* \\mathbf{v}_{ij}(0)|^2 = b^2 $$\n$$ (\\mathbf{r}_{ij}(0) + t^* \\mathbf{v}_{ij}(0)) \\cdot (\\mathbf{r}_{ij}(0) + t^* \\mathbf{v}_{ij}(0)) = b^2 $$\n展开此式得到一个关于 $t^*$ 的二次方程：\n$$ |\\mathbf{v}_{ij}|^2 (t^*)^2 + 2(\\mathbf{r}_{ij} \\cdot \\mathbf{v}_{ij}) t^* + (|\\mathbf{r}_{ij}|^2 - b^2) = 0 $$\n物理上相关的解是落在当前模拟时间步长内的最小正实根 $t^*$，即 $t^* \\in (0, \\Delta t]$。这个计算必须对 $b=\\sigma$ 和 $b=\\lambda\\sigma$ 都进行。这些有效时间中最早的一个决定了下一个事件。\n\n**2. 事件时的状态更新**\n在事件时间 $t^*$，系统中的所有粒子都被推进到它们的新位置：$\\mathbf{r}_k(t+t^*) = \\mathbf{r}_k(t) + t^* \\mathbf{v}_k(t)$。到此点为止，速度 $\\mathbf{v}_k$ 保持不变。然后，相互作用对 $(i, j)$ 的速度根据守恒定律被瞬时更新。\n相互作用是瞬时的和中心的，沿着中心线 $\\hat{\\mathbf{n}} = \\mathbf{r}_{ij}(t+t^*) / b$ 作用。\n- **线性动量**：总线性动量 $m_i \\mathbf{v}_i + m_j \\mathbf{v}_j$ 的守恒通过对两个粒子施加大小相等、方向相反的冲量来保证。\n- **角动量**：轨道角动量 $\\mathbf{L} = \\mu \\mathbf{r}_{ij} \\times \\mathbf{v}_{ij}$（其中约化质量 $\\mu = \\frac{m_i m_j}{m_i+m_j}$）的守恒由于冲量是中心的而得到保证。这意味着相对速度的切向分量 $\\mathbf{v}_{ij, t} = \\mathbf{v}_{ij} - (\\mathbf{v}_{ij} \\cdot \\hat{\\mathbf{n}})\\hat{\\mathbf{n}}$ 是守恒的。\n- **总能量**：总能量 $E = K + U$ 是守恒的。速度的变化仅限于相对速度的法向分量 $v_{ij,n} = \\mathbf{v}_{ij} \\cdot \\hat{\\mathbf{n}}$。\n\n**在 $r = \\sigma$ 处的更新（硬核碰撞）：**\n势能上升到 $+\\infty$，因此粒子不能穿透。这是一次弹性碰撞。碰撞前后势能相同（都在核的无穷小外部），因此动能守恒。由于 $v_{ij,t}$ 守恒，动能守恒意味着 $v_{ij,n}'^2 = v_{ij,n}^2$。要发生碰撞，粒子必须相互接近 ($v_{ij,n}  0$) 然后分离 ($v_{ij,n}' > 0$)。唯一的物理解决方案是 $v_{ij,n}' = -v_{ij,n}$。\n\n**在 $r = \\lambda \\sigma$ 处的更新（阱边界穿越）：**\n势能发生一个有限的阶跃 $\\Delta U$。总能量守恒意味着动能的变化为 $\\Delta K = -\\Delta U$。由于只有相对法向运动对变化有贡献，我们有：\n$$ \\frac{1}{2} \\mu (v_{ij,n}'^2 - v_{ij,n}^2) = -\\Delta U $$\n$$ v_{ij,n}'^2 = v_{ij,n}^2 - \\frac{2\\Delta U}{\\mu} $$\n- **进入势阱**：$r$ 减小并穿过 $\\lambda\\sigma$。$U$ 从 $0$ 变为 $-\\varepsilon$，所以 $\\Delta U = -\\varepsilon$。粒子正在接近 ($v_{ij,n}  0$)。那么 $v_{ij,n}'^2 = v_{ij,n}^2 + \\frac{2\\varepsilon}{\\mu}$，它们继续向内移动，所以 $v_{ij,n}'  0$。\n- **离开势阱**：$r$ 增大并穿过 $\\lambda\\sigma$。$U$ 从 $-\\varepsilon$ 变为 $0$，所以 $\\Delta U = +\\varepsilon$。粒子正在分离 ($v_{ij,n} > 0$)。那么 $v_{ij,n}'^2 = v_{ij,n}^2 - \\frac{2\\varepsilon}{\\mu}$。\n    - 如果相对法向动能 $\\frac{1}{2}\\mu v_{ij,n}^2 > \\varepsilon$，则 $v_{ij,n}'^2 > 0$，粒子逃离势阱。新速度为 $v_{ij,n}' = +\\sqrt{v_{ij,n}^2 - 2\\varepsilon/\\mu}$。\n    - 如果 $\\frac{1}{2}\\mu v_{ij,n}^2  \\varepsilon$，则 $v_{ij,n}'^2  0$，这是不可能的。粒子缺乏逃离势阱的能量。它们在边界处被反射（一个经典转折点）。在这次反射中，总能量守恒，势能不变（保持在 $-\\varepsilon$）。因此，动能也守恒，这意味着 $v_{ij,n}' = -v_{ij,n}$。\n\n**3. 算法结构**\n持续时间为 $\\Delta t$ 的正确时间步进方案是：\n1. 找到在 $(0, \\Delta t]$ 内任何粒子对的最早事件时间 $t^*$。\n2. 如果没有事件发生，将所有粒子推进 $\\Delta t$。\n3. 如果在 $t^*$ 处发现事件，将所有粒子推进 $t^*$。更新相互作用对的速度。\n4. 对剩余时间 $\\Delta t' = \\Delta t - t^*$ 重复此过程。\n\n建立了这个正确的程序后，我们来评估各个选项。\n\n**选项 A - 评估：**\n该选项正确地描述了通过求解自由流运动学导出的二次方程来检测事件。它正确地规定了通过比较候选时间来找到最早的允许事件时间。它正确地描述了所有粒子的自由流推进。在 $r=\\sigma$ 处的硬球碰撞速度更新被正确地表述为使用一个冲量 $J$ 来反转相对速度的法向分量，同时守恒动量和能量。$J$ 的公式是标准的。在方阱边界 $r=\\lambda\\sigma$ 处的速度更新通过方程 $\\frac{1}{2}\\mu v_{\\parallel}'^{\\,2} = \\frac{1}{2}\\mu v_{\\parallel}^{\\,2} - \\Delta U$ 正确地将能量守恒应用于法向速度分量（如选项中所定义，使用 $v_\\parallel$ 表示法向分量）。它正确地指出了离开势阱时发生反射的条件（$\\frac{1}{2}\\mu v_{\\parallel}^{\\,2}  \\varepsilon$）以及相应的速度更新（$v_{\\parallel}' = -v_{\\parallel}$）。最后，它正确地指明，模拟应在时间步长的剩余部分进行子步进，并始终首先处理最早的事件。此选项是对正确的事件驱动算法的完整而准确的描述。\n**结论：正确**\n\n**选项 B - 评估：**\n该选项建议对标量距离 $r(t)$ 进行线性插值。这在根本上是错误的。矢量 $\\mathbf{r}_{ij}$ 随时间线性变化，但其大小 $r_{ij}(t)$ 并非如此，除非运动是完全径向的。这种近似会导致错误的事件时间，并可能完全错过事件（例如，掠射碰撞）。速度更新规则——在两个表面都反转法向相对速度——对于方阱边界是错误的，因为它没有考虑势能的变化，从而违反了能量守恒。在一次碰撞后不重新计算后续事件时间的建议也是一个关键缺陷，因为第一次事件引起的速度变化会改变相关粒子未来的轨迹。\n**结论：错误**\n\n**选项 C - 评估：**\n该选项建议使用速度-Verlet积分器和连续的代理力。这是一种时间步进方法，而不是事件驱动方法。这是一种从根本上改变了相互作用性质的近似。势是不连续的，而不是连续的。所提出的针对重叠 ($r  \\sigma$) 的*临时*校正以及使用速度阻尼都是违反能量守恒的非物理修复。这种方法没有遵守问题前提所要求的 HS+SW 势的精确动力学，即科学一致性。\n**结论：错误**\n\n**选项 D - 评估：**\n该选项提出了一种基于投影分离的线性方程的事件检测方法。这是错误的，因为它假设中心线矢量 $\\hat{\\mathbf{n}}$ 是恒定的，而这仅在纯径向运动中才成立。对于任何具有切向速度分量的轨迹，它都会失败。所提出的速度更新也是错误的：在 $r=\\sigma$ 处反转整个相对速度矢量 $\\mathbf{v}_{ij}$ 违反了角动量守恒，而在 $r=\\lambda\\sigma$ 处保持 $\\mathbf{v}_{ij}$ 不变违反了能量守恒。最后，按“发现的顺序”处理事件而不比较它们的时间，是事件驱动模拟逻辑中的一个致命缺陷，该模拟必须始终处理按时间顺序最早的事件。\n**结论：错误**", "answer": "$$\\boxed{A}$$", "id": "3415442"}, {"introduction": "掌握了基本势函数和动力学模拟方法后，我们可以探索更高级、更复杂的现象，其中最重要的应用之一便是研究相变，例如气体如何凝结成液体。本练习将引导您了解吉布斯系综蒙特卡罗（GEMC）方法，这是一种专门用于计算相平衡的强大模拟技术。通过在一个代表气相、一个代表液相的模拟盒子之间交换粒子和调整体积，GEMC 能够驱动系统达到热力学平衡，从而直接确定两相共存的条件。通过推导和应用 GEMC 移动的接受概率，您将学会如何直接模拟相图，并理解控制这些高级算法的细致平衡原理。[@problem_id:3415378]", "problem": "考虑一个经典的双箱体系，用于描述通过硬球加方阱对势相互作用的单组分流体的相共存。该对势由具有硬核的方阱模型定义：对于粒子间距 $r$，$u(r) = +\\infty$ 如果 $r  \\sigma$，$u(r) = -\\epsilon$ 如果 $\\sigma \\le r  \\lambda \\sigma$，以及 $u(r) = 0$ 如果 $r \\ge \\lambda \\sigma$。其中 $\\sigma$ 是硬球直径，$\\epsilon$ 是阱深，$\\lambda > 1$ 是阱的相对范围。两个标记为 $1$ 和 $2$ 的立方模拟箱分别包含 $N_1$ 和 $N_2$ 个粒子，体积分别为 $V_1$ 和 $V_2$，并假定使用周期性边界条件。总粒子数 $N = N_1 + N_2$ 和总体积 $V = V_1 + V_2$ 是固定的。我们在无量纲的约化单位下工作，其中玻尔兹曼常数 $k_\\mathrm{B}$、硬球直径 $\\sigma$ 和阱深 $\\epsilon$ 都设为 $1$，因此约化温度为 $T^\\star = T$，约化能量以 $\\epsilon$ 为单位；体积以 $\\sigma^3$ 为单位。在此设定中，所有角度都是无关的，因此不需要角度单位。\n\n推导的起点必须是经典不可区分粒子的正则系综和细致平衡原理。在正则系综中，对于具有粒子数 $N_1, N_2$、体积 $V_1, V_2$ 和总势能 $U = U_1 + U_2$ 的微观态，其平衡概率密度的经典构型贡献正比于\n$$\n\\frac{V_1^{N_1} V_2^{N_2}}{N_1! \\, N_2!} \\, e^{-\\beta U},\n$$\n其中 $\\beta = 1/T^\\star$ 是约化逆温。为了计算 Metropolis 接受概率，您必须在吉布斯系综蒙特卡罗方案中，对以下两种移动类型使用带有对称提议分布的细致平衡：\n\n- 粒子转移移动：从箱 $1$ 中均匀随机地选择一个粒子删除，并将其插入到箱 $2$ 的一个均匀随机位置（即，$1 \\to 2$ 转移）。假设提议是对称的，即反向的 $2 \\to 1$ 移动以类似方式构建。必须强制执行硬球（无限）排斥：任何导致重叠（与任何现有粒子的距离 $r  \\sigma$）的提议插入都必须以零接受概率被拒绝。对于方阱部分，在约化单位中，从箱 $1$ 中移除一个在吸引阱内有 $m_1$ 个邻居的粒子所贡献的能量变化为 $\\Delta U_\\text{remove,1} = + m_1$，而将其插入到吸引阱内有 $m_2$ 个邻居的箱 $2$ 中，在不发生硬球重叠的情况下，产生的能量变化为 $\\Delta U_\\text{insert,2} = - m_2$。则该转移的总约化能量变化为 $\\Delta U = \\Delta U_\\text{remove,1} + \\Delta U_\\text{insert,2}$。\n\n- 对数体积交换移动：将体积更改为新值 $V_1'$ 和 $V_2'$，满足 $V_1' + V_2' = V$（总体积守恒），这是通过对变量 $\\xi = \\ln\\left(V_1/V_2\\right)$ 进行对称提议来构建的，同时对每个箱中的所有粒子坐标进行仿射重标度，以使约化坐标保持在单位立方体内。由该体积移动引起的约化能量变化表示为 $\\Delta U_\\text{vol} = (U_1' + U_2') - (U_1 + U_2)$。为了解决此问题，对于每个测试用例，$\\Delta U_\\text{vol}$ 将作为数值输入给出。\n\n任务：\n1. 从正则系综权重和细致平衡出发，推导上述粒子转移移动的 Metropolis 接受概率，用 $N_1, N_2, V_1, V_2, \\beta$ 和 $\\Delta U$ 表示，并明确说明对用于删除的粒子的均匀选择和均匀随机插入位置的处理方式。清楚说明硬球排斥如何影响接受概率。\n2. 基于相同的原理，推导对数体积交换移动的 Metropolis 接受概率，用 $N_1, N_2, V_1, V_2, V_1', V_2'$, $\\beta$ 和 $\\Delta U_\\text{vol}$ 表示。\n\n实现要求：\n- 实现一个程序，为每个提供的测试用例评估两个接受概率：$1 \\to 2$ 转移的粒子转移接受概率和对数体积交换接受概率。使用标准的 Metropolis 规则，即接受概率是 $1$ 和由细致平衡所蕴含的相应接受比率中的较小者。如果对于 $1 \\to 2$ 转移，$N_1  1$，则该移动不可能发生，接受概率必须为 $0$。\n- 使用约化单位：$k_\\mathrm{B} = 1$，$\\sigma = 1$，$\\epsilon = 1$，因此 $\\beta = 1/T^\\star$，能量以 $\\epsilon$ 为单位。\n- 对于粒子转移的能量变化，使用给定的整数 $m_1$ 和 $m_2$，分别描述被破坏和形成的方阱邻居数量，并如果指定，则强制执行硬球排斥。当没有重叠发生时，约化能量变化为 $\\Delta U = m_1 - m_2$；如果插入时会产生硬球重叠，则接受概率必须为 $0$。\n- 对于体积移动，使用提供的标量 $\\Delta U_\\text{vol}$ 和满足 $V_1' + V_2' = V_1 + V_2$ 的提议体积 $V_1', V_2'$。\n\n您的程序必须计算以下测试套件的接受概率，该套件探测了一个典型案例、一个重叠拒绝案例、一个供体箱为空的边缘案例，以及一个在低温下有利转移的案例：\n- 测试用例 A：\n  - $T^\\star = 1.2$, $N_1 = 150$, $N_2 = 50$, $V_1 = 100$, $V_2 = 100$。\n  - 粒子转移：$m_1 = 5$, $m_2 = 3$，并且插入到箱 $2$ 时没有硬球重叠。\n  - 体积移动：$V_1' = 105$, $V_2' = 95$, $\\Delta U_\\text{vol} = 7.5$。\n- 测试用例 B：\n  - $T^\\star = 0.8$, $N_1 = 80$, $N_2 = 120$, $V_1 = 150$, $V_2 = 50$。\n  - 粒子转移：$m_1 = 2$, $m_2 = 4$，并且插入到箱 $2$ 时会发生硬球重叠。\n  - 体积移动：$V_1' = 100$, $V_2' = 100$, $\\Delta U_\\text{vol} = -1.0$。\n- 测试用例 C：\n  - $T^\\star = 1.5$, $N_1 = 0$, $N_2 = 200$, $V_1 = 120$, $V_2 = 80$。\n  - 粒子转移：$m_1 = 0$, $m_2 = 1$，并且插入到箱 $2$ 时没有硬球重叠；但请注意 $N_1 = 0$。\n  - 体积移动：$V_1' = 60$, $V_2' = 140$, $\\Delta U_\\text{vol} = 0$。\n- 测试用例 D：\n  - $T^\\star = 0.5$, $N_1 = 60$, $N_2 = 140$, $V_1 = 90$, $V_2 = 110$。\n  - 粒子转移：$m_1 = 1$, $m_2 = 5$，并且插入到箱 $2$ 时没有硬球重叠。\n  - 体积移动：$V_1' = 70$, $V_2' = 130$, $\\Delta U_\\text{vol} = 3.0$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，包含所有测试用例结果的逗号分隔列表，其中每个测试用例的结果本身是一个双元素列表，顺序为 [粒子转移接受概率, 体积移动接受概率]。每个接受概率必须是四舍五入到六位小数的浮点数。整个输出必须是单行，格式如下：\n  - 例如，如果有两个测试用例，结果分别为 $x_1, y_1$ 和 $x_2, y_2$，输出格式将是 [[x_1,y_1],[x_2,y_2]]，不含空格。", "solution": "该问题要求推导和实现吉布斯系综蒙特卡罗（GEMC）模拟中粒子转移和体积交换移动的 Metropolis 接受概率。推导必须基于统计力学原理，特别是正则系综概率分布和马尔可夫链蒙特卡罗过程的细致平衡原理。\n\nMetropolis-Hastings 算法的基础是细致平衡条件，它确保模拟的轨迹能正确地对期望的平衡概率分布进行抽样。对于从状态 $i$ 到状态 $j$ 的一个跃迁，该条件为：\n$$\nP(i) \\, T(i \\to j) = P(j) \\, T(j \\to i)\n$$\n其中 $P(i)$ 是状态 $i$ 的平衡概率，$T(i \\to j)$ 是转移概率。转移概率是提议概率 $\\alpha(i \\to j)$ 和接受概率 $A(i \\to j)$ 的乘积。这导出了接受概率的一般形式：\n$$\nA(i \\to j) = \\min \\left( 1, \\frac{P(j) \\, \\alpha(j \\to i)}{P(i) \\, \\alpha(i \\to j)} \\right)\n$$\n问题指明，对于由粒子数（$N_1, N_2$）、体积（$V_1, V_2$）和总势能（$U=U_1+U_2$）定义的状态，其平衡概率的构型贡献正比于：\n$$\nP(N_1, V_1, N_2, V_2, U) \\propto \\frac{V_1^{N_1} V_2^{N_2}}{N_1! \\, N_2!} e^{-\\beta U}\n$$\n其中 $\\beta = 1/T^\\star$ 是约化逆温。我们将此作为系统宏观态的平衡概率 $P$。\n\n**1. 粒子转移接受概率的推导**\n\n考虑一个从箱 $1$ 到箱 $2$ 的粒子转移移动。\n初始状态，即状态 $i$，其特征为箱 $1$ 中有 $(N_1, V_1)$，箱 $2$ 中有 $(N_2, V_2)$，总势能为 $U_i$。\n提议的最终状态，即状态 $j$，其特征为箱 $1$ 中有 $(N_1-1, V_1)$，箱 $2$ 中有 $(N_2+1, V_2)$，总势能为 $U_j$。势能的变化量为 $\\Delta U = U_j - U_i$。\n\n这两种状态的平衡概率之比为：\n$$\n\\frac{P(j)}{P(i)} = \\frac{\\frac{V_1^{N_1-1} V_2^{N_2+1}}{(N_1-1)! \\, (N_2+1)!} e^{-\\beta U_j}}{\\frac{V_1^{N_1} V_2^{N_2}}{N_1! \\, N_2!} e^{-\\beta U_i}}\n$$\n简化各项可得：\n$$\n\\frac{P(j)}{P(i)} = \\frac{V_1^{N_1-1}}{V_1^{N_1}} \\cdot \\frac{V_2^{N_2+1}}{V_2^{N_2}} \\cdot \\frac{N_1!}{(N_1-1)!} \\cdot \\frac{N_2!}{(N_2+1)!} \\cdot \\frac{e^{-\\beta U_j}}{e^{-\\beta U_i}}\n$$\n$$\n\\frac{P(j)}{P(i)} = \\frac{1}{V_1} \\cdot V_2 \\cdot N_1 \\cdot \\frac{1}{N_2+1} \\cdot e^{-\\beta (U_j - U_i)} = \\frac{N_1 V_2}{(N_2+1) V_1} e^{-\\beta \\Delta U}\n$$\n接下来，我们考虑提议概率。问题指定一个移动，即从箱 $1$ 中均匀选择一个粒子并将其插入到箱 $2$ 的一个随机位置。一个标准的 GEMC 方案会以 $0.5$ 的概率尝试 $1 \\to 2$ 转移，以 $0.5$ 的概率尝试 $2 \\to 1$ 转移。问题陈述“假设提议是对称的，即反向的 $2 \\to 1$ 移动以类似方式构建”。这意味着尝试正向移动（$i \\to j$）与尝试反向移动（$j \\to i$）的选择概率相等。因此，宏观态之间整个跃迁的提议概率是相等的，即 $\\alpha(i \\to j) = \\alpha(j \\to i)$，它们的比值为 $1$。\n\n将这些部分代入 Metropolis 接受规则，得到接受比率：\n$$\n\\text{ratio} = \\frac{P(j)}{P(i)} \\frac{\\alpha(j \\to i)}{\\alpha(i \\to j)} = \\frac{N_1 V_2}{(N_2+1) V_1} e^{-\\beta \\Delta U}\n$$\n在约化单位下，破坏箱 $1$ 中 $m_1$ 个邻居相互作用并形成箱 $2$ 中 $m_2$ 个相互作用的能量变化是 $\\Delta U = m_1 - m_2$。因此，接受概率为：\n$$\nA_{\\text{transfer}}(1 \\to 2) = \\min \\left( 1, \\frac{N_1 V_2}{(N_2+1) V_1} e^{-\\beta (m_1 - m_2)} \\right)\n$$\n问题定义了特定的拒绝条件：\n- 如果提议的插入导致硬球重叠（$r  \\sigma$），能量变化实际上是无限的（$\\Delta U = +\\infty$）。这使得指数项以及接受概率都为零。\n- 如果 $N_1  1$，则无法从箱 $1$ 中移除粒子。该移动不可能发生。分子中的因子 $N_1$ 正确地得出接受概率为 $0$。\n\n**2. 对数体积交换接受概率的推导**\n\n考虑一个体积交换移动。\n初始状态，即状态 $i$，其特征为 $(N_1, V_1)$ 和 $(N_2, V_2)$，总能量为 $U_i = U_1+U_2$。\n提议的最终状态，即状态 $j$，其体积为 $(V_1', V_2')$，满足 $V_1' + V_2' = V_1 + V_2 = V$，总能量为 $U_j = U_1' + U_2'$。粒子数 $(N_1, N_2)$ 保持不变。能量变化量为 $\\Delta U_{\\text{vol}} = U_j - U_i$。\n\n平衡概率之比为：\n$$\n\\frac{P(j)}{P(i)} = \\frac{\\frac{(V_1')^{N_1} (V_2')^{N_2}}{N_1! \\, N_2!} e^{-\\beta U_j}}{\\frac{V_1^{N_1} V_2^{N_2}}{N_1! \\, N_2!} e^{-\\beta U_i}}\n$$\n阶乘项相互抵消，剩下：\n$$\n\\frac{P(j)}{P(i)} = \\left(\\frac{V_1'}{V_1}\\right)^{N_1} \\left(\\frac{V_2'}{V_2}\\right)^{N_2} e^{-\\beta \\Delta U_{\\text{vol}}}\n$$\n该移动是通过对变量 $\\xi = \\ln(V_1/V_2)$ 提议一个变化来生成的。具体来说，从一个对称概率分布 $g(\\delta\\xi)$（其中 $g(\\delta\\xi) = g(-\\delta\\xi)$）中抽取一个随机值 $\\delta\\xi$，并提议新状态为 $\\xi' = \\xi + \\delta\\xi$。要逆转该移动，必须抽取 $-\\delta\\xi$，其提议概率为 $g(-\\delta\\xi)$。由于 $g$ 的对称性，提议正向移动的概率与提议反向移动的概率相同。因此，$\\alpha(i \\to j) = \\alpha(j \\to i)$，它们的比值为 $1$。\n\n因此，接受比率等于状态概率之比：\n$$\n\\text{ratio} = \\left(\\frac{V_1'}{V_1}\\right)^{N_1} \\left(\\frac{V_2'}{V_2}\\right)^{N_2} e^{-\\beta \\Delta U_{\\text{vol}}}\n$$\n为了数值稳定性，这个表达式可以用对数重写：\n$$\n\\text{ratio} = \\exp\\left( N_1 \\ln\\left(\\frac{V_1'}{V_1}\\right) + N_2 \\ln\\left(\\frac{V_2'}{V_2}\\right) - \\beta \\Delta U_{\\text{vol}} \\right)\n$$\n最终的接受概率为：\n$$\nA_{\\text{vol}} = \\min(1, \\text{ratio}) = \\min\\left(1, \\exp\\left( N_1 \\ln\\frac{V_1'}{V_1} + N_2 \\ln\\frac{V_2'}{V_2} - \\beta \\Delta U_{\\text{vol}} \\right)\\right)\n$$\n至此完成了解决问题所需的推导。实现部分将包括将这两个最终公式应用于给定的测试用例。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Calculates Metropolis acceptance probabilities for particle transfer and volume\n    exchange moves in a Gibbs Ensemble Monte Carlo simulation for a series of test cases.\n    \"\"\"\n    test_cases = [\n        # Test case A\n        {'T_star': 1.2, 'N1': 150, 'N2': 50, 'V1': 100, 'V2': 100,\n         'm1': 5, 'm2': 3, 'no_overlap': True,\n         'V1_p': 105, 'V2_p': 95, 'dU_vol': 7.5},\n        # Test case B\n        {'T_star': 0.8, 'N1': 80, 'N2': 120, 'V1': 150, 'V2': 50,\n         'm1': 2, 'm2': 4, 'no_overlap': False,\n         'V1_p': 100, 'V2_p': 100, 'dU_vol': -1.0},\n        # Test case C\n        {'T_star': 1.5, 'N1': 0, 'N2': 200, 'V1': 120, 'V2': 80,\n         'm1': 0, 'm2': 1, 'no_overlap': True,\n         'V1_p': 60, 'V2_p': 140, 'dU_vol': 0.0},\n        # Test case D\n        {'T_star': 0.5, 'N1': 60, 'N2': 140, 'V1': 90, 'V2': 110,\n         'm1': 1, 'm2': 5, 'no_overlap': True,\n         'V1_p': 70, 'V2_p': 130, 'dU_vol': 3.0}\n    ]\n\n    results = []\n    for case in test_cases:\n        # Unpack parameters\n        T_star = case['T_star']\n        N1, N2 = case['N1'], case['N2']\n        V1, V2 = case['V1'], case['V2']\n        m1, m2 = case['m1'], case['m2']\n        no_overlap = case['no_overlap']\n        V1_p, V2_p = case['V1_p'], case['V2_p']\n        dU_vol = case['dU_vol']\n        \n        beta = 1.0 / T_star\n\n        # --- Particle Transfer Acceptance Probability ---\n        # Move is impossible if donor box is empty (N1  1) or if insertion causes overlap\n        if N1  1 or not no_overlap:\n            p_transfer = 0.0\n        else:\n            dU_transfer = float(m1 - m2)\n            # The acceptance ratio is based on the derived formula\n            ratio_transfer = (N1 * V2) / ((N2 + 1) * V1) * np.exp(-beta * dU_transfer)\n            p_transfer = min(1.0, ratio_transfer)\n\n        # --- Volume Exchange Acceptance Probability ---\n        # The volumes must be positive to take logarithms\n        if V1 = 0 or V2 = 0 or V1_p = 0 or V2_p = 0:\n            # Physically this should not occur in a valid simulation state\n            p_volume = 0.0\n        else:\n            # The argument of the exponential in the acceptance ratio\n            exponent = N1 * np.log(V1_p / V1) + N2 * np.log(V2_p / V2) - beta * dU_vol\n            ratio_volume = np.exp(exponent)\n            p_volume = min(1.0, ratio_volume)\n        \n        results.append([p_transfer, p_volume])\n\n    # Format the final output string exactly as specified.\n    case_strings = [f\"[{p1:.6f},{p2:.6f}]\" for p1, p2 in results]\n    final_output = f\"[{','.join(case_strings)}]\"\n    \n    print(final_output)\n\nsolve()\n```", "id": "3415378"}]}