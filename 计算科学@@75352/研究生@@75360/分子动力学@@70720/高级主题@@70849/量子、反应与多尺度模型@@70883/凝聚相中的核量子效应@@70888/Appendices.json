{"hands_on_practices": [{"introduction": "量子谐振子是理解凝聚相中振动的基本模型。通过从第一性原理出发推导其热力学性质，我们可以直接揭示核量子效应的两个核心来源：零点能和低温下振动模式的“冻结”。这项练习 [@problem_id:3430050] 旨在巩固路径积分模拟所依赖的理论基础，让你亲手量化这些纯粹的量子现象。", "problem": "考虑凝聚相中的单个局域核振动模式，该模式被建模为质量为 $m$、角频率为 $\\omega$ 的各向同性三维量子谐振子。其哈密顿算符为\n$$\n\\hat{H} \\;=\\; \\sum_{\\alpha \\in \\{x,y,z\\}} \\left[ \\frac{\\hat{p}_{\\alpha}^{2}}{2m} \\;+\\; \\frac{1}{2} m \\omega^{2} \\hat{q}_{\\alpha}^{2} \\right].\n$$\n假设该模式在正则系综中处于温度 $T$ 的热平衡状态。从正则配分函数定义 $Z \\,=\\, \\mathrm{Tr}\\left[\\exp(-\\beta \\hat{H})\\right]$（其中 $\\beta \\,=\\, 1/(k_{B} T)$）出发，利用基础的统计力学和量子力学原理，推导该模式动能 $\\langle \\hat{E}_{\\mathrm{kin}} \\rangle$ 和势能 $\\langle \\hat{E}_{\\mathrm{pot}} \\rangle$ 的热期望值的解析表达式。将这些量子结果与经典均分极限进行比较，并解释核量子效应（NQE）如何在有限温度下表现为零点贡献和热抑制，并说明其对 $\\omega$ 和 $T$ 的依赖性。\n\n将您的最终答案表示为单行矩阵中的一对值 $\\big(\\langle \\hat{E}_{\\mathrm{kin}} \\rangle,\\langle \\hat{E}_{\\mathrm{pot}} \\rangle\\big)$。不要进行数值计算。", "solution": "所述问题具有科学依据，提法恰当且客观。它代表了量子统计力学中一个标准的、可解的问题，没有内部矛盾或信息缺失。因此，我们可以进行推导。\n\n该系统是一个各向同性三维量子谐振子（QHO）。其哈密顿算符 $\\hat{H}$ 由下式给出\n$$\n\\hat{H} = \\sum_{\\alpha \\in \\{x,y,z\\}} \\left[ \\frac{\\hat{p}_{\\alpha}^{2}}{2m} + \\frac{1}{2} m \\omega^{2} \\hat{q}_{\\alpha}^{2} \\right]\n$$\n该哈密顿量是可分离的，意味着它是三个独立的一维（1D）量子谐振子哈密顿量之和，即 $\\hat{H} = \\hat{H}_x + \\hat{H}_y + \\hat{H}_z$，其中 $\\hat{H}_{\\alpha} = \\frac{\\hat{p}_{\\alpha}^{2}}{2m} + \\frac{1}{2} m \\omega^{2} \\hat{q}_{\\alpha}^{2}$。由于这种独立性和谐振子的各向同性（三个维度上的 $\\omega$ 相同），总动能和势能的期望值就是一维量子谐振子相应期望值的三倍：\n$$\n\\langle \\hat{E}_{\\mathrm{kin}} \\rangle = 3 \\left\\langle \\frac{\\hat{p}^2}{2m} \\right\\rangle_{1D} \\quad \\text{和} \\quad \\langle \\hat{E}_{\\mathrm{pot}} \\rangle = 3 \\left\\langle \\frac{1}{2} m \\omega^2 \\hat{q}^2 \\right\\rangle_{1D}\n$$\n因此，我们将在逆温度 $\\beta = 1/(k_B T)$ 的正则系综中，计算单个自由度的热期望值 $\\langle \\hat{p}^2 \\rangle_{1D}$ 和 $\\langle \\hat{q}^2 \\rangle_{1D}$。\n\n对于一维量子谐振子，用下降（$\\hat{a}$）和上升（$\\hat{a}^{\\dagger}$）算符来表示位置算符 $\\hat{q}$ 和动量算符 $\\hat{p}$ 会很方便：\n$$\n\\hat{q} = \\sqrt{\\frac{\\hbar}{2m\\omega}}(\\hat{a} + \\hat{a}^{\\dagger})\n$$\n$$\n\\hat{p} = i\\sqrt{\\frac{\\hbar m\\omega}{2}}(\\hat{a}^{\\dagger} - \\hat{a})\n$$\n一维量子谐振子的哈密顿量可以写为 $\\hat{H}_{1D} = \\hbar\\omega(\\hat{a}^{\\dagger}\\hat{a} + \\frac{1}{2})$，其中 $\\hat{n} = \\hat{a}^{\\dagger}\\hat{a}$ 是数算符，其本征值为 $n = 0, 1, 2, \\dots$。算符 $\\hat{O}$ 的热平均值由 $\\langle \\hat{O} \\rangle = \\mathrm{Tr}[\\hat{O} \\exp(-\\beta \\hat{H}_{1D})] / Z_{1D}$ 给出，其中 $Z_{1D} = \\mathrm{Tr}[\\exp(-\\beta \\hat{H}_{1D})]$。\n\n数算符的热平均值 $\\langle \\hat{n} \\rangle$ 对应于谐振子模式的平均占据数，它遵循单个玻色子模式的玻色-爱因斯坦分布：\n$$\n\\langle \\hat{n} \\rangle = \\frac{1}{\\exp(\\beta\\hbar\\omega) - 1}\n$$\n\n现在我们计算 $\\hat{q}^2$ 和 $\\hat{p}^2$ 的期望值。\n我们从 $\\langle \\hat{q}^2 \\rangle_{1D}$ 开始：\n$$\n\\hat{q}^2 = \\frac{\\hbar}{2m\\omega}(\\hat{a} + \\hat{a}^{\\dagger})^2 = \\frac{\\hbar}{2m\\omega}(\\hat{a}^2 + \\hat{a}\\hat{a}^{\\dagger} + \\hat{a}^{\\dagger}\\hat{a} + (\\hat{a}^{\\dagger})^2)\n$$\n使用对易关系 $[\\hat{a}, \\hat{a}^{\\dagger}] = 1$，我们有 $\\hat{a}\\hat{a}^{\\dagger} = \\hat{a}^{\\dagger}\\hat{a} + 1$。将此代入 $\\hat{q}^2$ 的表达式中：\n$$\n\\hat{q}^2 = \\frac{\\hbar}{2m\\omega}(\\hat{a}^2 + (\\hat{a}^{\\dagger}\\hat{a} + 1) + \\hat{a}^{\\dagger}\\hat{a} + (\\hat{a}^{\\dagger})^2) = \\frac{\\hbar}{2m\\omega}(\\hat{a}^2 + (\\hat{a}^{\\dagger})^2 + 2\\hat{a}^{\\dagger}\\hat{a} + 1)\n$$\n在取热平均（即在能量本征基 $|n\\rangle$ 上取迹）时，项 $\\hat{a}^2$ 和 $(\\hat{a}^{\\dagger})^2$ 的对角元素为零，因此它们的迹为零。所以，只有包含 $\\hat{a}^{\\dagger}\\hat{a} = \\hat{n}$ 的项和常数项有贡献：\n$$\n\\langle \\hat{q}^2 \\rangle_{1D} = \\frac{\\hbar}{2m\\omega} \\langle 2\\hat{n} + 1 \\rangle = \\frac{\\hbar}{m\\omega} \\left(\\langle \\hat{n} \\rangle + \\frac{1}{2}\\right)\n$$\n代入 $\\langle \\hat{n} \\rangle$ 的表达式：\n$$\n\\langle \\hat{q}^2 \\rangle_{1D} = \\frac{\\hbar}{m\\omega} \\left(\\frac{1}{\\exp(\\beta\\hbar\\omega) - 1} + \\frac{1}{2}\\right) = \\frac{\\hbar}{2m\\omega} \\left(\\frac{2 + \\exp(\\beta\\hbar\\omega) - 1}{\\exp(\\beta\\hbar\\omega) - 1}\\right) = \\frac{\\hbar}{2m\\omega} \\frac{\\exp(\\beta\\hbar\\omega) + 1}{\\exp(\\beta\\hbar\\omega) - 1}\n$$\n这个表达式可以使用双曲余切函数的定义来简化，$\\coth(x) = \\frac{\\exp(x) + \\exp(-x)}{\\exp(x) - \\exp(-x)} = \\frac{\\exp(2x) + 1}{\\exp(2x) - 1}$：\n$$\n\\langle \\hat{q}^2 \\rangle_{1D} = \\frac{\\hbar}{2m\\omega} \\coth\\left(\\frac{\\beta\\hbar\\omega}{2}\\right)\n$$\n那么，三维各向同性量子谐振子的平均势能为：\n$$\n\\langle \\hat{E}_{\\mathrm{pot}} \\rangle = 3 \\left\\langle \\frac{1}{2} m\\omega^2 \\hat{q}^2 \\right\\rangle_{1D} = 3 \\cdot \\frac{1}{2} m\\omega^2 \\left[ \\frac{\\hbar}{2m\\omega} \\coth\\left(\\frac{\\beta\\hbar\\omega}{2}\\right) \\right] = \\frac{3\\hbar\\omega}{4} \\coth\\left(\\frac{\\beta\\hbar\\omega}{2}\\right)\n$$\n\n类似地，我们计算 $\\langle \\hat{p}^2 \\rangle_{1D}$：\n$$\n\\hat{p}^2 = (i)^2 \\frac{\\hbar m\\omega}{2}(\\hat{a}^{\\dagger} - \\hat{a})^2 = -\\frac{\\hbar m\\omega}{2}((\\hat{a}^{\\dagger})^2 - \\hat{a}^{\\dagger}\\hat{a} - \\hat{a}\\hat{a}^{\\dagger} + \\hat{a}^2)\n$$\n使用 $\\hat{a}\\hat{a}^{\\dagger} = \\hat{a}^{\\dagger}\\hat{a} + 1$：\n$$\n\\hat{p}^2 = -\\frac{\\hbar m\\omega}{2}((\\hat{a}^{\\dagger})^2 - \\hat{a}^{\\dagger}\\hat{a} - (\\hat{a}^{\\dagger}\\hat{a} + 1) + \\hat{a}^2) = \\frac{\\hbar m\\omega}{2}(-(\\hat{a}^{\\dagger})^2 - \\hat{a}^2 + 2\\hat{a}^{\\dagger}\\hat{a} + 1)\n$$\n取热平均值，非对角项再次消失：\n$$\n\\langle \\hat{p}^2 \\rangle_{1D} = \\frac{\\hbar m\\omega}{2} \\langle 2\\hat{n} + 1 \\rangle = \\hbar m\\omega \\left(\\langle \\hat{n} \\rangle + \\frac{1}{2}\\right) = \\frac{\\hbar m\\omega}{2} \\coth\\left(\\frac{\\beta\\hbar\\omega}{2}\\right)\n$$\n三维各向同性量子谐振子的平均动能为：\n$$\n\\langle \\hat{E}_{\\mathrm{kin}} \\rangle = 3 \\left\\langle \\frac{\\hat{p}^2}{2m} \\right\\rangle_{1D} = 3 \\cdot \\frac{1}{2m} \\left[ \\frac{\\hbar m\\omega}{2} \\coth\\left(\\frac{\\beta\\hbar\\omega}{2}\\right) \\right] = \\frac{3\\hbar\\omega}{4} \\coth\\left(\\frac{\\beta\\hbar\\omega}{2}\\right)\n$$\n这个结果证实了谐振子的量子维里定理，该定理规定 $\\langle \\hat{E}_{\\mathrm{kin}} \\rangle = \\langle \\hat{E}_{\\mathrm{pot}} \\rangle$。\n\n现在，我们在核量子效应（NQE）的背景下分析这些结果。\n\n1.  **经典极限（$T \\to \\infty$，或 $\\beta \\to 0$）：**\n    在此极限下，余切函数的自变量 $x = \\beta\\hbar\\omega/2$ 趋近于零。当 $x$ 很小时，$\\coth(x)$ 的泰勒展开为 $\\coth(x) \\approx 1/x$。\n    $$\n    \\langle \\hat{E}_{\\mathrm{kin}} \\rangle = \\langle \\hat{E}_{\\mathrm{pot}} \\rangle \\approx \\frac{3\\hbar\\omega}{4} \\left( \\frac{1}{\\beta\\hbar\\omega/2} \\right) = \\frac{3\\hbar\\omega}{4} \\frac{2}{\\beta\\hbar\\omega} = \\frac{3}{2\\beta} = \\frac{3}{2}k_B T\n    $$\n    这正是经典能量均分定理的结果，即三个动能和三个势能的二次自由度各对平均能量贡献 $\\frac{1}{2}k_B T$，动能和势能总贡献分别为 $\\frac{3}{2}k_B T$。\n\n2.  **量子极限与 NQE（$T \\to 0$，或 $\\beta \\to \\infty$）：**\n    在此极限下，$x = \\beta\\hbar\\omega/2 \\to \\infty$，且 $\\coth(x) \\to 1$。\n    $$\n    \\lim_{T\\to 0} \\langle \\hat{E}_{\\mathrm{kin}} \\rangle = \\lim_{T\\to 0} \\langle \\hat{E}_{\\mathrm{pot}} \\rangle = \\frac{3\\hbar\\omega}{4}\n    $$\n    这揭示了即使在绝对零度下也存在非零能量。总能量 $\\langle \\hat{H} \\rangle = \\langle \\hat{E}_{\\mathrm{kin}} \\rangle + \\langle \\hat{E}_{\\mathrm{pot}} \\rangle$ 趋近于 $\\frac{3\\hbar\\omega}{2}$，这是三维各向同性量子谐振子的基态能，或称零点能（ZPE）。这个零点能是 NQE 的直接体现，源于海森堡不确定性原理。在经典情况下，$T=0$ 时的能量应为零。\n\n3.  **有限温度下的 NQE：** 无量纲参数 $\\hbar\\omega/(k_B T)$ 决定了量子效应的重要性。\n    -   **零点贡献：** 我们可以重写能量表达式以明确显示零点能的贡献：\n        $$\n        \\coth\\left(\\frac{x}{2}\\right) = 1 + \\frac{2}{\\exp(x)-1}\n        $$\n        因此，\n        $$\n        \\langle \\hat{E}_{\\mathrm{kin}} \\rangle = \\langle \\hat{E}_{\\mathrm{pot}} \\rangle = \\frac{3\\hbar\\omega}{4} \\left[ 1 + \\frac{2}{\\exp(\\beta\\hbar\\omega) - 1} \\right] = \\frac{3\\hbar\\omega}{4} + \\frac{3\\hbar\\omega}{2(\\exp(\\beta\\hbar\\omega) - 1)}\n        $$\n        第一项 $\\frac{3\\hbar\\omega}{4}$ 是对动能和势能的恒定零点贡献。第二项是热贡献。\n    -   **热抑制：** 量子能量的热学部分总是小于经典热能。经典预测是 $\\frac{3}{2}k_B T$，可以写成 $\\frac{3}{2 \\beta}$。动能/势能的量子热贡献是 $\\frac{3\\hbar\\omega}{2(\\exp(\\beta\\hbar\\omega) - 1)}$。比较表明，对于任何有限温度 ($T>0$)，$\\exp(\\beta\\hbar\\omega) - 1 > \\beta\\hbar\\omega$，这意味着 $\\frac{3\\hbar\\omega}{2(\\exp(\\beta\\hbar\\omega) - 1)} < \\frac{3}{2\\beta} = \\frac{3}{2}k_B T$。当 $k_B T \\ll \\hbar\\omega$ 时，这种抑制作用非常显著。在这种情况下，热能不足以布居到更高的振动能级，导致自由度被“冻结”。这使得热容在 $T \\to 0$ 时趋于零，与经典理论中恒定的热容 $3k_B$ 形成鲜明对比。\n\n总之，NQE 表现为相对于经典值的一个恒定的正能量偏移（ZPE），这在低温（$T \\ll \\hbar\\omega/k_B$）下尤为明显；同时，在所有有限温度下，与经典预测相比，系统吸收热能的能力受到抑制。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{3 \\hbar \\omega}{4} \\coth\\left(\\frac{\\beta \\hbar \\omega}{2}\\right) & \\frac{3 \\hbar \\omega}{4} \\coth\\left(\\frac{\\beta \\hbar \\omega}{2}\\right) \\end{pmatrix}}\n$$", "id": "3430050"}, {"introduction": "路径积分模拟将量子粒子映射为经典的环状聚合物，其模拟精度直接取决于“珠子”数量 $P$ 的选择。这项计算实践 [@problem_id:3430035] 解决了一个关键的实际问题：对于一个给定的体系和温度，到底需要多少珠子才能获得可靠的结果？你将通过编程实现一个确定性的方法来检验能量随 $P$ 的收敛性，并评估一个广泛使用的“经验法则”在模拟液态水和甲烷等不同体系时的有效性。", "problem": "您必须编写一个完整且可运行的程序，该程序使用振动模式的谐振子近似，对凝聚相中核量子效应的路径积分珠子数进行第一性原理收敛性研究。该程序必须实现一个基于不等式 $P_{\\text{beads}} \\gtrsim \\beta \\hbar \\omega_{\\max}$ 的判据，并测试其在代表液态水和甲烷的非均匀模式谱上的充分性。该研究必须基于以下基础和要求构建。\n\n从一组角频率为 $\\{\\omega_i\\}$ 的独立一维谐振子的正则量子配分函数 $Z = \\mathrm{Tr}\\left[e^{-\\beta \\hat{H}}\\right]$ 开始。每个模式的精确量子平均能量可以从量子统计力学的公认原理中获得。对于使用路径积分分子动力学 (PIMD) 的收敛路径积分离散化，珠子数 $P_{\\text{beads}}$ 控制着 Trotter 分解误差。使用虚时路径积分在 $P$ 个切片中的原始 Trotter 分解以及环状聚合物表示。谐振子的离散化配分函数可以表示为珠子坐标的多维高斯函数，该函数可通过对角化为环状聚合物简正模式来精确积分。对于有限的 $P$，平均能量必须通过对离散化配分函数对 $\\beta$ 求导来计算，而不能采用随机抽样。除了二次型的对角化和 $\\ln Z$ 对 $\\beta$ 的求导法则外，不要假设任何快捷公式。您必须使用国际单位制（SI units）中的常数 $\\hbar$ 和玻尔兹曼常数 $k_{\\mathrm{B}}$。\n\n您的程序必须为每个测试用例执行以下步骤。\n1. 使用 $\\omega = 2\\pi c \\tilde{\\nu}$（其中 $c$ 的单位为 $\\mathrm{cm}\\,\\mathrm{s}^{-1}$），将所有以波数（$\\mathrm{cm}^{-1}$）为单位的振动模式输入转换为以角频率（$\\mathrm{rad}\\,\\mathrm{s}^{-1}$）为单位的输入。\n2. 对于给定的温度 $T$（单位为开尔文），计算 $\\beta = 1/(k_{\\mathrm{B}} T)$，单位为 $\\mathrm{J}^{-1}$。\n3. 通过对所有模式的精确谐振子能量求和，计算独立模式系统的精确总量子平均能量 $E_{\\text{exact,tot}}$。\n4. 通过计算环状聚合物表示的离散化高斯积分并对 $-\\partial \\ln Z_P/\\partial \\beta$ 求导，计算总能量的有限-$P$ 离散近似 $E_{P,\\text{tot}}$。您必须对任何正整数 $P$ 确定性地获得 $E_{P,\\text{tot}}$，而无需进行蒙特卡洛抽样。\n5. 将经验法则珠子数定义为 $P_{\\text{rule}} = \\lceil \\beta \\hbar \\omega_{\\max} \\rceil$，其中 $\\omega_{\\max}$ 是模式集中的最大角频率，$\\lceil \\cdot \\rceil$ 表示向上取整到下一个整数。强制要求 $P_{\\text{rule}} \\ge 1$。\n6. 对于指定的总相对误差容差 $\\delta_{\\text{tot}}$ 和指定的最差单模式相对误差容差 $\\delta_{\\text{single}}$，确定：\n   a. 满足 $\\left|E_{P,\\text{tot}} - E_{\\text{exact,tot}}\\right|/E_{\\text{exact,tot}} \\le \\delta_{\\text{tot}}$ 的最小珠子数 $P_{\\text{tot}}$。\n   b. 满足 $\\max_i \\left( \\left|E_{P}(\\omega_i) - E_{\\text{exact}}(\\omega_i)\\right|/E_{\\text{exact}}(\\omega_i) \\right) \\le \\delta_{\\text{single}}$ 的最小珠子数 $P_{\\text{worst}}$。\n7. 通过检查 $P = P_{\\text{rule}}$ 时对应的相对误差，评估两个布尔值：经验法则珠子数 $P_{\\text{rule}}$ 是否满足总误差标准以及是否满足最差模式标准。\n8. 报告一个过量因子 $\\mathcal{O} = P_{\\text{rule}}/P_{\\text{tot}}$，其形式为浮点数。\n\n所有物理常数必须采用国际单位制：$\\hbar$ 的单位为 $\\mathrm{J}\\cdot\\mathrm{s}$，$k_{\\mathrm{B}}$ 的单位为 $\\mathrm{J}\\cdot\\mathrm{K}^{-1}$，$c$ 的单位为 $\\mathrm{cm}\\cdot\\mathrm{s}^{-1}$。输入中的所有频率均以 $\\mathrm{cm}^{-1}$ 给出，使用前必须转换为 $\\mathrm{rad}\\,\\mathrm{s}^{-1}$ 的角频率。温度以开尔文给出。\n\n测试套件包含四个案例，每个案例由一个元组 $(T, \\{\\tilde{\\nu}_i\\}, \\delta_{\\text{tot}}, \\delta_{\\text{single}})$ 定义，其中 $T$ 是温度（单位为开尔文），$\\{\\tilde{\\nu}_i\\}$ 是波数列表（单位为 $\\mathrm{cm}^{-1}$），容差是无量纲的小数。\n1. 案例 1（类液态水，300 开尔文）：$T = 300$, $\\{\\tilde{\\nu}_i\\} = [3600, 3600, 1645, 600, 600, 600, 200, 200, 200, 80, 80, 80]$, $\\delta_{\\text{tot}} = 0.01$, $\\delta_{\\text{single}} = 0.01$。\n2. 案例 2（类甲烷，300 开尔文）：$T = 300$, $\\{\\tilde{\\nu}_i\\} = [3000, 3000, 3000, 3000, 1500, 1500, 750, 750, 750, 200, 200, 200]$, $\\delta_{\\text{tot}} = 0.01$, $\\delta_{\\text{single}} = 0.01$。\n3. 案例 3（类液态水，100 开尔文）：$T = 100$, $\\{\\tilde{\\nu}_i\\} = [3600, 3600, 1645, 600, 600, 600, 200, 200, 200, 80, 80, 80]$, $\\delta_{\\text{tot}} = 0.01$, $\\delta_{\\text{single}} = 0.01$。\n4. 案例 4（低频边界，300 开尔文）：$T = 300$, $\\{\\tilde{\\nu}_i\\} = [100, 200, 300, 400, 500, 600]$, $\\delta_{\\text{tot}} = 0.01$, $\\delta_{\\text{single}} = 0.01$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。对于每个测试用例，输出一个包含六个元素的列表，顺序为 $[P_{\\text{tot}}, P_{\\text{worst}}, P_{\\text{rule}}, \\text{pass}_{\\text{tot}}, \\text{pass}_{\\text{worst}}, \\mathcal{O}]$，其中前三个是整数，接下来两个是布尔值，最后一个是浮点数。因此，总输出应该是包含四个此类列表（对应四个测试用例）的列表，打印为单行，例如 $[[\\cdots],[\\cdots],[\\cdots],[\\cdots]]$。不应打印任何额外文本。根据设计，所有角度都以弧度为单位，并且输出中不出现其他单位，因为报告的量是无量纲的或计数。所有百分比类型的比较必须按规定处理为小数（例如，百分之一为 $0.01$）。", "solution": "该解决方案围绕量子统计力学原理和量子系统的路径积分表述构建。问题的核心是确定独立谐振子系统的路径积分表示相对于离散化中使用的珠子数 $P$ 的收敛性。\n\n**1. 基础理论**\n\n**1.1. 谐振子的精确量子能量**\n\n对于角频率为 $\\omega$ 的单个量子谐振子，其能级由 $E_n = \\hbar\\omega(n + 1/2)$ 给出，其中 $n=0, 1, 2, \\dots$。在逆温 $\\beta = 1/(k_B T)$ 下，正则配分函数 $Z_{\\text{exact}}$ 是对所有状态的求和：\n$$ Z_{\\text{exact}}(\\omega) = \\sum_{n=0}^{\\infty} e^{-\\beta E_n} = \\sum_{n=0}^{\\infty} e^{-\\beta\\hbar\\omega(n+1/2)} = \\frac{e^{-\\beta\\hbar\\omega/2}}{1 - e^{-\\beta\\hbar\\omega}} = \\frac{1}{2\\sinh(\\beta\\hbar\\omega/2)} $$\n平均能量 $E_{\\text{exact}}(\\omega)$ 通过对配分函数的对数就 $\\beta$ 求导得到：\n$$ E_{\\text{exact}(\\omega)} = -\\frac{\\partial \\ln Z_{\\text{exact}}(\\omega)}{\\partial \\beta} = \\frac{\\hbar\\omega}{2} \\coth\\left(\\frac{\\beta\\hbar\\omega}{2}\\right) $$\n该表达式给出了单个谐振子模式的精确量子力学平均能量。对于具有频率 $\\{\\omega_i\\}$ 的独立振子系统，总精确能量就是所有模式能量的总和：\n$$ E_{\\text{exact,tot}} = \\sum_i E_{\\text{exact}}(\\omega_i) $$\n\n**1.2. 路径积分离散化能量**\n\n路径积分表述将一个量子粒子表示为一个由 $P$ 个珠子组成的经典“环状聚合物”。使用谐振子的原始 Trotter 分解，离散化的配分函数 $Z_P$ 可以写成关于珠子位置 $\\mathbf{x} = (x_1, \\dots, x_P)$ 的多维高斯积分。该积分可以通过对指数中的二次型进行对角化来精确求解，这对应于到环状聚合物简正模式的变换。\n\n根据要求，推导过程是通过对得到的 $\\ln Z_P$ 的闭合形式表达式进行微分。在谐势中，质量为 $m$ 的粒子的离散化配分函数为：\n$$ Z_P = \\left( \\frac{mP}{2\\pi\\beta\\hbar^2} \\right)^{P/2} \\int d\\mathbf{x} \\exp\\left( -\\sum_{s=1}^P \\left[ \\frac{mP}{2\\beta\\hbar^2}(x_s - x_{s+1})^2 + \\frac{\\beta m\\omega^2}{2P}x_s^2 \\right] \\right) $$\n其中 $x_{P+1} \\equiv x_1$。指数中的项是一个二次型 $-\\frac{1}{2}\\mathbf{x}^T \\mathbf{A} \\mathbf{x}$。矩阵 $\\mathbf{A}$ 是一个循环矩阵，其特征值 $\\lambda_k$（对于 $k=0, \\dots, P-1$）为：\n$$ \\lambda_k = \\frac{4mP}{\\beta\\hbar^2}\\sin^2\\left(\\frac{\\pi k}{P}\\right) + \\frac{\\beta m \\omega^2}{P} $$\n该积分的计算结果为 $(2\\pi)^{P/2}(\\det \\mathbf{A})^{-1/2} = (2\\pi)^{P/2} (\\prod_k \\lambda_k)^{-1/2}$。这导出了配分函数的表达式：\n$$ Z_P = \\left(\\frac{mP}{\\beta\\hbar^2}\\right)^{P/2} \\left(\\prod_{k=0}^{P-1} \\lambda_k\\right)^{-1/2} $$\n取对数可得：\n$$ \\ln Z_P = \\frac{P}{2}\\ln\\left(\\frac{mP}{\\beta\\hbar^2}\\right) - \\frac{1}{2} \\sum_{k=0}^{P-1} \\ln\\left( \\frac{4mP}{\\beta\\hbar^2}\\sin^2\\left(\\frac{\\pi k}{P}\\right) + \\frac{\\beta m \\omega^2}{P} \\right) $$\n能量 $E_P(\\omega)$ 通过计算 $-\\partial(\\ln Z_P)/\\partial\\beta$ 得到。在执行微分和简化后，可以获得“热力学”能量估计量：\n$$ E_P(\\omega) = \\frac{P}{2\\beta} + \\frac{1}{2} \\sum_{k=0}^{P-1} \\frac{\\frac{\\omega^2}{P} - \\frac{4P}{\\beta^2\\hbar^2}\\sin^2\\left(\\frac{\\pi k}{P}\\right)}{\\frac{\\beta \\omega^2}{P} + \\frac{4P}{\\beta\\hbar^2}\\sin^2\\left(\\frac{\\pi k}{P}\\right)} $$\n注意，质量 $m$ 被消掉了，这对于仅依赖于 $\\omega$ 的谐振子性质是符合预期的。该公式是确定性的，允许在不使用随机抽样的情况下计算任何有限珠子数 $P$ 的能量。一组模式的总能量是总和 $E_{P,\\text{tot}} = \\sum_i E_P(\\omega_i)$。\n\n**2. 算法实现**\n\n该程序实现了上述理论框架，以执行所要求的收敛性研究。\n\n**步骤 1：初始化**\n根据规定，物理常数在国际单位制中定义：$\\hbar = 1.054571817 \\times 10^{-34} \\, \\mathrm{J}\\cdot\\mathrm{s}$，$k_{\\mathrm{B}} = 1.380649 \\times 10^{-23} \\, \\mathrm{J}\\cdot\\mathrm{K}^{-1}$，$c = 2.99792458 \\times 10^{10} \\, \\mathrm{cm}\\cdot\\mathrm{s}^{-1}$。\n\n**步骤 2：输入转换**\n对于每个测试用例，温度 $T$ 用于计算 $\\beta = 1/(k_B T)$。振动波数 $\\{\\tilde{\\nu}_i\\}$（单位 $\\mathrm{cm}^{-1}$）通过关系式 $\\omega = 2\\pi c \\tilde{\\nu}$ 转换为角频率 $\\{\\omega_i\\}$（单位 $\\mathrm{rad}\\,\\mathrm{s}^{-1}$）。\n\n**步骤 3：精确和近似能量计算**\n使用推导出的公式实现计算 $E_{\\text{exact}}(\\omega)$ 和 $E_P(\\omega)$ 的函数。这些函数使用 `numpy` 进行向量化，以高效地同时计算整个频率集 $\\{\\omega_i\\}$ 的能量。\n\n**步骤 4：收敛性分析**\n启动一个从 $P=1$ 开始的搜索循环。在每次迭代中，程序计算总 PIMD 能量 $E_{P,\\text{tot}} = \\sum_i E_P(\\omega_i)$ 和各个模式的能量 $E_P(\\omega_i)$。然后计算相对误差：\n- 总相对误差：$\\epsilon_{\\text{tot}}(P) = |E_{P,\\text{tot}} - E_{\\text{exact,tot}}| / E_{\\text{exact,tot}}$\n- 最差模式相对误差：$\\epsilon_{\\text{worst}}(P) = \\max_i(|E_P(\\omega_i) - E_{\\text{exact}}(\\omega_i)| / E_{\\text{exact}}(\\omega_i))$\n\n循环继续进行，递增 $P$，直到找到满足 $\\epsilon_{\\text{tot}}(P_{\\text{tot}}) \\le \\delta_{\\text{tot}}$ 和 $\\epsilon_{\\text{worst}}(P_{\\text{worst}}) \\le \\delta_{\\text{single}}$ 的最小 $P_{\\text{tot}}$ 和 $P_{\\text{worst}}$ 值为止。\n\n**步骤 5：经验法则评估**\n启发式珠子数 $P_{\\text{rule}}$ 计算为 $P_{\\text{rule}} = \\lceil \\beta \\hbar \\omega_{\\max} \\rceil$，其中 $\\omega_{\\max}$ 是集合中的最高频率。强制最小值为 1。然后通过计算 $P=P_{\\text{rule}}$ 时的总相对误差和最差模式相对误差，并检查它们是否满足指定的容差（$\\delta_{\\text{tot}}$ 和 $\\delta_{\\text{single}}$），来测试此规则的性能。\n\n**步骤 6：报告**\n最后，收集每个测试用例的结果——$P_{\\text{tot}}$、$P_{\\text{worst}}$、$P_{\\text{rule}}$、两个布尔通过/失败检查以及过量因子 $\\mathcal{O} = P_{\\text{rule}}/P_{\\text{tot}}$——并将其格式化为最终输出所需的列表的列表结构。", "answer": "```python\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Main function to run the PIMD convergence study for all test cases.\n    \"\"\"\n    \n    # Physical constants in SI units, except for c as specified\n    HBAR = 1.054571817e-34  # J.s\n    KB = 1.380649e-23        # J/K\n    C_CMS = 2.99792458e10   # cm/s\n\n    test_cases = [\n        # Case 1 (water-like at 300 K)\n        (300, [3600, 3600, 1645, 600, 600, 600, 200, 200, 200, 80, 80, 80], 0.01, 0.01),\n        # Case 2 (methane-like at 300 K)\n        (300, [3000, 3000, 3000, 3000, 1500, 1500, 750, 750, 750, 200, 200, 200], 0.01, 0.01),\n        # Case 3 (water-like at 100 K)\n        (100, [3600, 3600, 1645, 600, 600, 600, 200, 200, 200, 80, 80, 80], 0.01, 0.01),\n        # Case 4 (low-frequency at 300 K)\n        (300, [100, 200, 300, 400, 500, 600], 0.01, 0.01),\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        T_kelvin, nu_cm_inv, delta_tot, delta_single = case\n        \n        # 1. Convert inputs\n        beta = 1.0 / (KB * T_kelvin)\n        omegas = 2.0 * np.pi * C_CMS * np.array(nu_cm_inv)\n        \n        # 3. Compute exact energies\n        def calc_E_exact(omega_arr, beta_val, hbar_val):\n            x = beta_val * hbar_val * omega_arr / 2.0\n            # Handle potential overflow in np.exp(2*x) for coth(x)\n            large_x_mask = x > 35\n            coth_x = np.zeros_like(x)\n            # For large x, coth(x) is 1\n            coth_x[large_x_mask] = 1.0\n            # For other x, use standard definition\n            non_large_x = ~large_x_mask\n            # Avoid division by zero if x is very small sinh(x->0) -> 0\n            x_safe = np.copy(x[non_large_x])\n            x_safe[x_safe  1e-8] = 1e-8 # Prevent division by zero, coth(x) ~ 1/x for small x\n            coth_x[non_large_x] = np.cosh(x_safe) / np.sinh(x_safe)\n            return (hbar_val * omega_arr / 2.0) * coth_x\n\n        E_exact_per_mode = calc_E_exact(omegas, beta, HBAR)\n        E_exact_tot = np.sum(E_exact_per_mode)\n\n        # 4. PIMD energy calculator\n        def calc_E_P(omega_arr, beta_val, P, hbar_val):\n            k = np.arange(P)\n            sin_k = np.sin(np.pi * k / P)\n            sin_k_sq = sin_k**2\n            \n            omega_arr_sq = omega_arr[:, np.newaxis]**2\n\n            num_part1 = omega_arr_sq / P\n            num_part2 = (4 * P / (beta_val**2 * hbar_val**2)) * sin_k_sq[np.newaxis, :]\n            numerator = num_part1 - num_part2\n            \n            den_part1 = (beta_val / P) * omega_arr_sq\n            den_part2 = (4 * P / (beta_val * hbar_val**2)) * sin_k_sq[np.newaxis, :]\n            denominator = den_part1 + den_part2\n            \n            sum_term = np.sum(numerator / denominator, axis=1)\n            \n            E_p_per_mode = P / (2 * beta_val) + 0.5 * sum_term\n            return E_p_per_mode, np.sum(E_p_per_mode)\n\n        # 5. Rule-of-thumb bead count\n        omega_max = np.max(omegas) if omegas.size > 0 else 0\n        P_rule_float = beta * HBAR * omega_max\n        P_rule = max(1, math.ceil(P_rule_float))\n\n        # 6. Find minimal P_tot and P_worst\n        P = 1\n        P_tot, P_worst = None, None\n        \n        while P_tot is None or P_worst is None:\n            E_p_per_mode, E_p_tot = calc_E_P(omegas, beta, P, HBAR)\n            \n            if P_tot is None:\n                rel_err_tot = np.abs(E_p_tot - E_exact_tot) / E_exact_tot\n                if rel_err_tot = delta_tot:\n                    P_tot = P\n            \n            if P_worst is None:\n                rel_err_per_mode = np.abs(E_p_per_mode - E_exact_per_mode) / E_exact_per_mode\n                max_rel_err = np.max(rel_err_per_mode)\n                if max_rel_err = delta_single:\n                    P_worst = P\n\n            P += 1\n            if P > 500:\n                 if P_tot is None: P_tot = -1\n                 if P_worst is None: P_worst = -1\n                 break\n\n        # 7. Evaluate P_rule\n        E_prule_per_mode, E_prule_tot = calc_E_P(omegas, beta, P_rule, HBAR)\n        \n        err_tot_at_prule = np.abs(E_prule_tot - E_exact_tot) / E_exact_tot\n        pass_tot = err_tot_at_prule = delta_tot\n        \n        err_worst_at_prule = np.max(np.abs(E_prule_per_mode - E_exact_per_mode) / E_exact_per_mode)\n        pass_worst = err_worst_at_prule = delta_single\n        \n        # 8. Overkill factor\n        overkill = float(P_rule) / P_tot if P_tot != 0 else float('inf')\n\n        all_results.append([P_tot, P_worst, P_rule, pass_tot, pass_worst, overkill])\n\n    # Format output string manually to match the exact requirement\n    # \"[[item1,item2,...],[item1,item2,...]]\" with no spaces.\n    list_of_list_strs = []\n    for res_list in all_results:\n        str_items = [str(x) for x in res_list]\n        list_str = \"[\" + \",\".join(str_items) + \"]\"\n        list_of_list_strs.append(list_str)\n    final_output_str = \"[\" + \",\".join(list_of_list_strs) + \"]\"\n    \n    print(final_output_str)\n\nsolve()\n```", "id": "3430035"}, {"introduction": "虽然路径积分分子动力学（PIMD）擅长计算静态性质，但为了近似模拟量子动力学，研究者开发了如恒温环状聚合物分子动力学（TRPMD）等更先进的方法。然而，这些技术可能引入人为的“伪影”，例如在体系的真实振动与环状聚合物的内部模式之间产生虚假共振。这项练习 [@problem_id:3430101] 通过一个简化模型，让你学习如何诊断和量化这些共振现象，这是批判性地评估和信任高级PIMD模拟结果的一项关键技能。", "problem": "实现一个完整的、可运行的程序，通过扫描摩擦参数并测量简化线性模型中环状聚合物内禀模式与物理振动模式之间的能量转移，来检测和量化恒温环状聚合物分子动力学 (Thermostatted Ring Polymer Molecular Dynamics, TRPMD) 在低温下的伪共振。该程序必须是独立的，使用无量纲单位，并为指定的测试套件生成结果。\n\n定义与基本原理：\n- 从一组耦合谐振自由度的经典朗之万方程出发，这与恒温环状聚合物分子动力学 (TRPMD) 的线性响应模型一致，其中恒温器仅作用于环状聚合物的内禀模式。考虑一个单一的物理振动坐标 $q$，其自然角频率为 $\\omega_0$，与一个单一的环状聚合物内禀模式坐标 $x$ 线性耦合，其角频率为 $\\omega_k$。\n- 内禀模式 $x$ 受到系数为 $\\gamma$（TRPMD 中的一个自由参数）的线性摩擦，而物理坐标 $q$ 不被直接恒温。忽略热噪声以模拟低温极限，在该极限下，噪声引起的涨落远小于确定性的能量交换。\n- 运动方程是以下耦合线性常微分方程组：\n$$\n\\dot{q} = v_q, \\quad \\dot{v}_q = -\\omega_0^2 \\, q - c \\, x,\n$$\n$$\n\\dot{x} = v_x, \\quad \\dot{v}_x = -\\gamma \\, v_x - \\omega_k^2 \\, x - c \\, q,\n$$\n其中耦合强度为 $c$。\n- 对于一个在逆温度 $\\beta$ 下具有 $N$ 个珠子的环状聚合物，其自由环内禀模式的角频率（在无量纲单位下，约化普朗克常数设为 $\\hbar = 1$）为\n$$\n\\omega_k = 2 \\, \\omega_P \\, \\sin \\left(\\frac{\\pi k}{N}\\right), \\quad \\text{其中} \\quad \\omega_P = \\frac{1}{\\beta \\hbar} = \\frac{1}{\\beta}.\n$$\n- 在 $t=0$ 时通过仅激发物理模式来初始化系统：$q(0) = A$, $v_q(0) = 0$, $x(0) = 0$, $v_x(0) = 0$，其中 $A = 1$。\n\n共振量化：\n- 定义与每个坐标相关的能量（不包括双线性耦合项）为\n$$\nE_q(t) = \\tfrac{1}{2} \\left( v_q(t)^2 + \\omega_0^2 q(t)^2 \\right), \\qquad E_x(t) = \\tfrac{1}{2} \\left( v_x(t)^2 + \\omega_k^2 x(t)^2 \\right).\n$$\n- 定义从物理模式到内禀模式的瞬时能量转移分数为\n$$\nf(t) = \\frac{E_x(t)}{E_q(t) + E_x(t)},\n$$\n并将给定摩擦系数 $\\gamma$ 的共振度量定义为在有限时间区间 $[0, T_{\\text{final}}]$ 内观测到的最大分数，\n$$\nM(\\gamma) = \\max_{t \\in [0, T_{\\text{final}}]} f(t).\n$$\n- 将 $M(\\gamma)$ 解释为伪共振的定量度量：较大的 $M(\\gamma)$ 表示从物理模式到内禀环模式的能量转移更强。在 TRPMD 中，当 $\\omega_0 \\approx \\omega_k$ 且 $\\gamma$ 很小时，伪共振预计最为显著，并随着 $\\gamma$ 增加到接近内禀模式的临界阻尼时被抑制。\n\n数值方法：\n- 使用四阶龙格-库塔方法，在长度为\n$$\nT_{\\text{final}} = n_{\\text{per}} \\times \\frac{2\\pi}{\\omega_0},\n$$\n的时间区间内，以固定的时间步长 $\\Delta t$ 确定性地（无噪声）积分耦合常微分方程。\n- 对于每个测试案例，扫描一个指定的摩擦系数列表 $\\{\\gamma_j\\}$，并为每个系数计算 $M(\\gamma_j)$。从这些值中，找出使 $M(\\gamma)$ 最大化的最差情况摩擦值 $\\gamma_\\star$，并记录在扫描中观测到的最小 $M(\\gamma)$。\n\n测试套件：\n使用以下四个测试案例，每个案例由元组 $(N, \\beta, k, \\omega_0, \\{ \\gamma \\}, c, \\Delta t, n_{\\text{per}})$ 定义：\n\n- 案例1 (近共振，低温):\n  - $N = 16$, $\\beta = 50$, $k = 1$, $\\omega_0 = 0.008$, $\\{ \\gamma \\} = [0.0, 0.005, 0.01, 0.02, 0.05]$, $c = 0.005$, $\\Delta t = 1.0$, $n_{\\text{per}} = 15$.\n- 案例2 (失谐，低温):\n  - $N = 16$, $\\beta = 50$, $k = 1$, $\\omega_0 = 0.05$, $\\{ \\gamma \\} = [0.0, 0.005, 0.01, 0.02, 0.05]$, $c = 0.005$, $\\Delta t = 1.0$, $n_{\\text{per}} = 15$.\n- 案例3 (近共振，更低温度):\n  - $N = 32$, $\\beta = 100$, $k = 1$, $\\omega_0 = 0.002$, $\\{ \\gamma \\} = [0.0, 0.001, 0.002, 0.004, 0.01]$, $c = 0.003$, $\\Delta t = 1.0$, $n_{\\text{per}} = 15$.\n- 案例4 (近共振，低温区内的较高温度):\n  - $N = 16$, $\\beta = 20$, $k = 1$, $\\omega_0 = 0.0195$, $\\{ \\gamma \\} = [0.0, 0.01, 0.02, 0.04, 0.1]$, $c = 0.004$, $\\Delta t = 1.0$, $n_{\\text{per}} = 15$.\n\n所有量都是无量纲的；不需要物理单位，也不应报告任何物理单位。\n\n要求输出：\n- 对每个测试案例，计算三元组\n$$\n\\left[ \\gamma_\\star, \\max_{\\gamma} M(\\gamma), \\min_{\\gamma} M(\\gamma) \\right],\n$$\n其中 $\\gamma_\\star$ 是在给定扫描中产生最大 $M(\\gamma)$ 的摩擦系数，其他两项是在扫描中找到的 $M(\\gamma)$ 的相应最大值和最小值。将所有报告的浮点值四舍五入到六位小数。\n- 你的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表，其中每个元素对应一个测试案例，并且本身是一个包含三个浮点数的列表。例如：“[[g1,mx1,mn1],[g2,mx2,mn2],[g3,mx3,mn3],[g4,mx4,mn4]]”。", "solution": "我们从一对线性耦合谐振自由度的经典运动方程开始，其中一个环状聚合物内禀模式 $x$ 受到摩擦力作用，而一个物理振动坐标 $q$ 不被直接恒温。恒温环状聚合物分子动力学 (TRPMD) 方法对内禀环模式施加恒温器以减轻伪影，同时保持质心（物理坐标）不受恒温。在简化的双模描述中，这产生了确定性方程\n$$\n\\dot{q} = v_q, \\quad \\dot{v}_q = -\\omega_0^2 q - c x,\n$$\n$$\n\\dot{x} = v_x, \\quad \\dot{v}_x = -\\gamma v_x - \\omega_k^2 x - c q,\n$$\n其中 $\\omega_0$ 是物理振动角频率，$\\omega_k$ 是内禀环模式角频率， $c$ 是一个小的线性耦合常数，$\\gamma$ 是摩擦系数，代表 TRPMD 恒温器在内禀模式上的强度。我们忽略随机力来模拟低温区，在该区域热噪声很弱，我们专注于确定性能量交换。\n\n对于一个在逆温度 $\\beta$ 下具有 $N$ 个珠子的自由环状聚合物，其内禀模式频率 $\\omega_k$ 由著名的简正模谱给出\n$$\n\\omega_k = 2 \\, \\omega_P \\, \\sin\\left( \\frac{\\pi k}{N} \\right),\n\\quad \\omega_P = \\frac{1}{\\beta \\hbar},\n$$\n在无量纲化下我们设定 $\\hbar = 1$，因此 $\\omega_P = 1/\\beta$。此表达式源于对环状聚合物的离散化虚时动能作用量进行对角化，是路径积分分子动力学理论中的一个标准结果。\n\n我们感兴趣的是识别伪共振，这里指从物理坐标 $q$ 到内禀环模式 $x$ 的强烈非物理能量转移。在线性耦合振子理论中，当固有频率相近时，即 $\\omega_0 \\approx \\omega_k$，会出现近共振行为，这促进了通过耦合 $c$ 的能量交换。$x$ 模式上的阻尼 $\\gamma$ 会抵消这种交换。在 TRPMD 实践中，一种常见的启发式方法是选择接近内禀模式临界阻尼的 $\\gamma$ 值来减轻伪影；然而，为了量化这一点，我们扫描 $\\gamma$ 并测量能量转移的严重程度。\n\n为了量化能量转移，我们监测非耦合能量\n$$\nE_q(t) = \\tfrac{1}{2}\\left(v_q^2 + \\omega_0^2 q^2\\right), \\qquad\nE_x(t) = \\tfrac{1}{2}\\left(v_x^2 + \\omega_k^2 x^2\\right),\n$$\n并定义瞬时分数\n$$\nf(t) = \\frac{E_x(t)}{E_q(t) + E_x(t)}.\n$$\n请注意，当耦合 $c \\neq 0$ 时，真实总能量还包含一个与 $c q x$ 成正比的双线性项，但如此定义的 $f(t)$ 可作为一个实用的局域化度量，指示振子能量中存储在内禀模式中的分数。由于阻尼会消耗能量，$E_q$ 和 $E_x$ 都会随时间衰减；因此，我们在有限的观测窗口内定义一个鲁棒的共振度量：\n$$\nM(\\gamma) = \\max_{t \\in [0,T_{\\text{final}}]} f(t).\n$$\n较大的 $M(\\gamma)$ 表示在窗口内的某个时间点有更强的能量流入 $x$。\n\n我们最初通过 $q(0)=A, v_q(0)=0$ 激发物理模式，并使 $x$ 保持静止，$x(0)=0, v_x(0)=0$，其中 $A=1$。如果 $\\omega_0 \\approx \\omega_k$ 且 $\\gamma$ 很小，我们预计会发生高效的确定性能量交换（拍频），$M(\\gamma)$ 将通过一个较大的最大值来捕捉到这一点。随着 $\\gamma$ 增加，内禀模式变得更受强阻尼，从而减小 $M(\\gamma)$ 并抑制伪共振。\n\n算法设计：\n1. 对于每个具有 $(N,\\beta,k,\\omega_0,\\{\\gamma\\},c,\\Delta t,n_{\\text{per}})$ 的测试案例，计算 $\\omega_k = 2 (1/\\beta) \\sin(\\pi k/N)$。\n2. 根据物理频率确定最终时间，$T_{\\text{final}} = n_{\\text{per}} \\cdot 2\\pi/\\omega_0$，以确保我们能观测到多个振荡周期和能量交换动力学。\n3. 对于给定扫描中的每个 $\\gamma$：\n   - 使用固定时间步长 $\\Delta t$ 的四阶龙格-库塔方法在 $[0, T_{\\text{final}}]$ 上积分常微分方程。\n   - 在每一步，计算 $E_q(t)$、$E_x(t)$ 和 $f(t) = E_x/(E_q+E_x)$；为避免当能量衰减后在轨迹末端出现除以零的情况，可以通过跳过更新或添加一个可忽略的正则化项来处理非常小的分母（该实现使用一个小的阈值来确保数值稳定性，而不会在非零能量时偏置最大值）。\n   - 将积分窗口内的最大 $f(t)$ 记录为 $M(\\gamma)$。\n4. 在集合 $\\{\\gamma\\}$ 上，报告：\n   - $\\gamma_\\star = \\operatorname*{arg\\,max}_{\\gamma} M(\\gamma)$，\n   - $\\max_{\\gamma} M(\\gamma)$,\n   - $\\min_{\\gamma} M(\\gamma)$。\n5. 将所有报告的数字四舍五入到六位小数。\n\n基本原理与预期：\n- 在案例1和案例3中，我们选择 $\\omega_0$ 接近计算出的 $\\omega_k$，这会在小 $\\gamma$ 值时导致强烈的能量交换；因此，预计 $M(\\gamma)$ 在最小的 $\\gamma$ 值附近最大，并随着 $\\gamma$ 接近或超过线性振子内禀模式的临界阻尼（约 $2 \\omega_k$）而减小。\n- 在案例2中，$\\omega_0$ 与 $\\omega_k$ 失谐，因此能量转移应该不大，并且在测试范围内对 $\\gamma$ 相对不敏感，从而产生较小的 $M(\\gamma)$ 值且变化平缓。\n- 在案例4中，不同温度和耦合下的近共振条件在不同的频率尺度上展示了相同的现象。\n\n该程序精确地实现了这个过程，并输出单行，其中包含四个测试案例中每个案例的三数值摘要列表，格式完全符合要求。所有计算均在无量纲单位下进行；因此，不报告任何物理单位。所有角度都是角频率，而不是角度，因此不需要指定角度单位。输出为四舍五入到六位小数的浮点数。", "answer": "```python\nimport numpy as np\n\ndef ring_internal_frequency(beta, N, k):\n    # hbar = 1 in nondimensional units\n    omega_P = 1.0 / beta\n    return 2.0 * omega_P * np.sin(np.pi * k / N)\n\ndef rhs(y, omega0, omegak, gamma, c):\n    # y = [q, vq, x, vx]\n    q, vq, x, vx = y\n    dq = vq\n    dvq = - (omega0**2) * q - c * x\n    dx = vx\n    dvx = - gamma * vx - (omegak**2) * x - c * q\n    return np.array([dq, dvq, dx, dvx], dtype=float)\n\ndef rk4_step(y, dt, omega0, omegak, gamma, c):\n    k1 = rhs(y, omega0, omegak, gamma, c)\n    k2 = rhs(y + 0.5*dt*k1, omega0, omegak, gamma, c)\n    k3 = rhs(y + 0.5*dt*k2, omega0, omegak, gamma, c)\n    k4 = rhs(y + dt*k3, omega0, omegak, gamma, c)\n    return y + (dt/6.0)*(k1 + 2*k2 + 2*k3 + k4)\n\ndef simulate_metric(omega0, omegak, gamma, c, dt, nper):\n    # Initial conditions: excite only q\n    q0 = 1.0\n    y = np.array([q0, 0.0, 0.0, 0.0], dtype=float)\n    # Total time: nper periods of the physical mode\n    if omega0 = 0:\n        raise ValueError(\"omega0 must be positive\")\n    Tfinal = nper * (2.0 * np.pi / omega0)\n    steps = int(np.ceil(Tfinal / dt))\n    max_frac = 0.0\n    # Small threshold to avoid division by zero\n    eps = 1e-14\n    for _ in range(steps):\n        # Compute energies\n        q, vq, x, vx = y\n        Eq = 0.5 * (vq*vq + (omega0**2) * q*q)\n        Ex = 0.5 * (vx*vx + (omegak**2) * x*x)\n        denom = Eq + Ex\n        if denom > eps:\n            frac = Ex / denom\n            if frac > max_frac:\n                max_frac = frac\n        # Advance integrator\n        y = rk4_step(y, dt, omega0, omegak, gamma, c)\n    return max_frac\n\ndef solve():\n    # Define the test cases as specified\n    test_cases = [\n        # (N, beta, k, omega0, gamma_list, c, dt, nper)\n        (16, 50.0, 1, 0.008, [0.0, 0.005, 0.01, 0.02, 0.05], 0.005, 1.0, 15),\n        (16, 50.0, 1, 0.05,  [0.0, 0.005, 0.01, 0.02, 0.05], 0.005, 1.0, 15),\n        (32, 100.0, 1, 0.002, [0.0, 0.001, 0.002, 0.004, 0.01], 0.003, 1.0, 15),\n        (16, 20.0, 1, 0.0195, [0.0, 0.01, 0.02, 0.04, 0.1], 0.004, 1.0, 15),\n    ]\n\n    results = []\n    for N, beta, k, omega0, gamma_list, c, dt, nper in test_cases:\n        omegak = ring_internal_frequency(beta, N, k)\n        metrics = []\n        for gamma in gamma_list:\n            M = simulate_metric(omega0, omegak, gamma, c, dt, nper)\n            metrics.append((gamma, M))\n        # Find gamma that maximizes M\n        gamma_star, Mmax = max(metrics, key=lambda gm: gm[1])\n        # Find minimal M\n        Mmin = min(m for _, m in metrics)\n        # Round to six decimals\n        out_triplet = [round(gamma_star, 6), round(Mmax, 6), round(Mmin, 6)]\n        results.append(out_triplet)\n\n    # Final print statement in the exact required format without spaces.\n    list_of_list_strs = []\n    for res_list in results:\n        str_items = [str(item) for item in res_list]\n        list_str = \"[\" + \",\".join(str_items) + \"]\"\n        list_of_list_strs.append(list_str)\n    final_output_str = \"[\" + \",\".join(list_of_list_strs) + \"]\"\n    print(final_output_str)\n\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3430101"}]}