{"hands_on_practices": [{"introduction": "选择正确的集体变量（Collective Variable, CV）是元动力学模拟成功的基石。然而，当我们对一个简单的坐标$s$进行非线性变换得到新的变量$\\tilde{s} = f(s)$时，我们必须小心处理偏置势的形式，以确保在两个坐标系中物理意义的一致性。这个练习将引导你推导在该变换下自由能曲面受到的影响，并揭示了为保持偏置核函数形状一致性而必须进行的几何校正，这是保证偏置优化有效性的一个关键理论步骤 ([@problem_id:3461459])。", "problem": "在一个由适温元动力学（WTMetaD）增强的分子动力学（MD）模拟中，监测一个单一的集合变量（CV）$s(\\mathbf{q})$，其中$\\mathbf{q}$表示一个$N$粒子系统的$3N$维笛卡尔坐标。沿着$s$的平均力势（PMF）由边缘概率密度$P_{s}(s)$定义，公式为$F(s) = -k_{B} T \\ln P_{s}(s) + C$，其中$k_{B}$是玻尔兹曼常数，$T$是绝对温度，$C$是一个加性常数。考虑一个光滑、严格单调、可微的一一对应变换$\\tilde{s} = f(s)$，其逆变换为$s = f^{-1}(\\tilde{s})$。在 WTMetaD 中，偏置是通过在 CV 空间中沉积高斯核来构建的。在原始的$s$空间中，一个以$s_{0}$为中心、高度为$w$、宽度参数为$\\sigma_{s}$的单一高斯核的形式为$G_{s}(s; s_{0}) = w \\exp\\!\\left(-\\frac{(s - s_{0})^{2}}{2 \\sigma_{s}^{2}}\\right)$。在变换后的$\\tilde{s}$空间中，一个类似的高斯核为$G_{\\tilde{s}}(\\tilde{s}; \\tilde{s}_{0}) = w \\exp\\!\\left(-\\frac{(\\tilde{s} - \\tilde{s}_{0})^{2}}{2 \\tilde{\\sigma}^{2}}\\right)$，其宽度参数为$\\tilde{\\sigma}$，中心为$\\tilde{s}_{0} = f(s_{0})$。假设适温调节因子仅通过累积偏置的指数函数影响随时间变化的振幅，并且在沉积瞬间不改变单个核的空间形状。\n\n从边缘密度的定义和概率密度的变量替换定理出发，并仅对核的形状使用关于$s_{0}$的一阶局域线性化$f$，完成以下任务：\n\n- 推导在变量变换下 PMF 如何变换，以$F(s)$和$f'(s)$的形式表示$F_{\\tilde{s}}(\\tilde{s})$，结果可相差一个加性常数。\n- 在$s_{0}$附近的窄核近似下，确定在$s$空间中必须如何选择高斯核的形状，才能在$\\tilde{s}$空间中表示一个宽度为常数$\\tilde{\\sigma}$的目标高斯函数。你可以假设$f'(s_{0}) \\neq 0$并且$f$在核的支撑集上是严格递增或严格递减的。\n- 简要说明为什么适温振幅前置因子在瞬时沉积下不改变所需的宽度空间重缩放。\n\n为了使核在$\\tilde{s}$空间中局部对应于一个恒定的宽度$\\tilde{\\sigma}$，必须使用的$s$空间宽度$\\sigma_s(s)$的显式位置依赖表达式是什么？请仅用$\\tilde{\\sigma}$和$f'(s)$来提供你的最终答案，形式为一个单一的解析表达式。如果引入任何常数，请保持其符号形式。不要引入任何数值。最终答案必须是一个无单位的单一闭式表达式。不要进行任何四舍五入；提供精确的符号关系。", "solution": "对问题陈述进行有效性分析。\n\n**第1步：提取已知条件**\n- 系统：一个具有$3N$维笛卡尔坐标$\\mathbf{q}$的$N$粒子系统。\n- 集合变量 (CV)：$s(\\mathbf{q})$。\n- 平均力势 (PMF)：$F(s) = -k_{B} T \\ln P_{s}(s) + C$，其中$P_{s}(s)$是边缘概率密度，$k_{B}$是玻尔兹曼常数，$T$是绝对温度，$C$是一个常数。\n- CV 变换：$\\tilde{s} = f(s)$，这是一个光滑、严格单调、可微的一一对应函数，其逆函数为$s = f^{-1}(\\tilde{s})$。\n- $s$空间中的高斯核：$G_{s}(s; s_{0}) = w \\exp\\!\\left(-\\frac{(s - s_{0})^{2}}{2 \\sigma_{s}^{2}}\\right)$，以$s_{0}$为中心，高度为$w$，宽度为$\\sigma_{s}$。\n- $\\tilde{s}$空间中的高斯核：$G_{\\tilde{s}}(\\tilde{s}; \\tilde{s}_{0}) = w \\exp\\!\\left(-\\frac{(\\tilde{s} - \\tilde{s}_{0})^{2}}{2 \\tilde{\\sigma}^{2}}\\right)$，以$\\tilde{s}_{0} = f(s_{0})$为中心，宽度为$\\tilde{\\sigma}$。\n- 适温元动力学 (WTMetaD) 假设：调节因子仅影响随时间变化的振幅$w$，而不影响新沉积核的空间形状。\n- 近似：使用关于点$s_{0}$的$f$的一阶局域线性化。\n- 条件：$f'(s_{0}) \\neq 0$。\n\n**第2步：使用提取的已知条件进行验证**\n- **科学上合理**：该问题基于统计力学、概率论以及分子动力学中增强采样方法（特别是元动力学）的既定原理。所有概念（PMF、CV、变量替换、高斯核）都是标准的并且表述正确。\n- **问题定义明确**：该问题定义清晰。它提供了足够的信息和明确的假设（例如，$f(s)$的性质，线性化的使用），以推导出所要求量的唯一解。\n- **客观性**：该问题以精确、客观、形式化的科学语言陈述，没有歧义或主观论断。\n\n**第3步：结论与行动**\n该问题有效。它是元动力学模拟研究中的一个标准理论练习。将提供完整解答。\n\n**推导**\n\n该问题需要完成三个主要任务：推导 PMF 的变换规则，确定高斯核宽度的所需缩放，以及说明适温前置因子的作用。\n\n**1. 平均力势 (PMF) 的变换**\n\nPMF 与边缘概率密度有关。要找出 PMF 如何变换，我们必须首先找出概率密度在变量变换$\\tilde{s} = f(s)$下如何变换。概率守恒原理指出，系统处于无穷小区间内的概率在坐标变换下必须保持不变。\n$$\nP_{s}(s) |ds| = P_{\\tilde{s}}(\\tilde{s}) |d\\tilde{s}|\n$$\n由于$f$是严格单调的，我们可以暂时去掉微分的绝对值，并通过雅可比式重新引入它们。这给出了概率密度之间的关系：\n$$\nP_{\\tilde{s}}(\\tilde{s}) = P_{s}(s) \\left|\\frac{ds}{d\\tilde{s}}\\right|\n$$\n导数$\\frac{ds}{d\\tilde{s}}$是从$\\tilde{s}$到$s$的变换的雅可比式。使用反函数定理，并给定$\\tilde{s} = f(s)$，我们有：\n$$\n\\frac{ds}{d\\tilde{s}} = \\frac{d}{d\\tilde{s}} f^{-1}(\\tilde{s}) = \\frac{1}{f'(s)}\n$$\n其中$s$在$f^{-1}(\\tilde{s})$处取值。将此代入密度变换规则：\n$$\nP_{\\tilde{s}}(\\tilde{s}) = P_{s}(f^{-1}(\\tilde{s})) \\left|\\frac{1}{f'(f^{-1}(\\tilde{s}))}\\right|\n$$\n现在，我们使用各自空间中 PMF 的定义：\n$$\nF(s) = -k_{B} T \\ln P_{s}(s) + C_{s} \\implies P_{s}(s) = \\exp\\left(-\\frac{F(s) - C_{s}}{k_{B} T}\\right)\n$$\n$$\nF_{\\tilde{s}}(\\tilde{s}) = -k_{B} T \\ln P_{\\tilde{s}}(\\tilde{s}) + C_{\\tilde{s}}\n$$\n将$P_{\\tilde{s}}(\\tilde{s})$的表达式代入其 PMF 定义中：\n$$\nF_{\\tilde{s}}(\\tilde{s}) = -k_{B} T \\ln \\left( P_{s}(f^{-1}(\\tilde{s})) \\left|\\frac{1}{f'(f^{-1}(\\tilde{s}))}\\right| \\right) + C_{\\tilde{s}}\n$$\n使用对数的性质$\\ln(ab) = \\ln(a) + \\ln(b)$：\n$$\nF_{\\tilde{s}}(\\tilde{s}) = -k_{B} T \\ln P_{s}(f^{-1}(\\tilde{s})) - k_{B} T \\ln \\left( \\left| \\frac{1}{f'(f^{-1}(\\tilde{s}))} \\right| \\right) + C_{\\tilde{s}}\n$$\n注意到$-k_{B} T \\ln P_{s}(s) = F(s) - C_{s}$且$\\ln(1/x) = -\\ln(x)$：\n$$\nF_{\\tilde{s}}(\\tilde{s}) = \\left( F(f^{-1}(\\tilde{s})) - C_{s} \\right) + k_{B} T \\ln \\left| f'(f^{-1}(\\tilde{s})) \\right| + C_{\\tilde{s}}\n$$\n将常数$C_s$和$C_{\\tilde{s}}$合并为一个新的常数$C'$，我们得到 PMF 的变换规则，结果可相差一个任意的加性常数：\n$$\nF_{\\tilde{s}}(\\tilde{s}) = F(s(\\tilde{s})) + k_{B} T \\ln |f'(s(\\tilde{s}))| + C'\n$$\n这一项，有时被称为“雅可比势”或“熵贡献”，校正了由非线性变量变换引起的相空间体积变化对自由能的影响。\n\n**2. 高斯核形状的变换**\n\n我们希望选择在$s$空间中沉积的高斯核的宽度$\\sigma_s$，使其在变换后的$\\tilde{s}$空间中对应于一个具有固定、恒定宽度$\\tilde{\\sigma}$的高斯核。这需要在变换下匹配核的函数形式，并使用指定的局域线性化。\n\n假设一个高斯函数在$s_0$处沉积。在变换后的空间中，其中心为$\\tilde{s}_0 = f(s_0)$。我们对变换$f(s)$在$s_0$周围进行一阶泰勒展开：\n$$\n\\tilde{s} = f(s) \\approx f(s_0) + f'(s_0)(s - s_0)\n$$\n这意味着与中心的偏差存在一个局域线性关系：\n$$\n\\tilde{s} - \\tilde{s}_0 \\approx f'(s_0)(s - s_0)\n$$\n在$\\tilde{s}$空间中的目标核形状是一个宽度为常数$\\tilde{\\sigma}$的高斯函数：\n$$\nG_{\\tilde{s}}(\\tilde{s}; \\tilde{s}_{0}) = w \\exp\\left(-\\frac{(\\tilde{s} - \\tilde{s}_{0})^{2}}{2 \\tilde{\\sigma}^{2}}\\right)\n$$\n将线性化关系代入指数中：\n$$\n-\\frac{(\\tilde{s} - \\tilde{s}_{0})^{2}}{2 \\tilde{\\sigma}^{2}} \\approx -\\frac{\\left[f'(s_0)(s - s_0)\\right]^{2}}{2 \\tilde{\\sigma}^{2}} = -\\frac{(f'(s_0))^2 (s - s_0)^2}{2 \\tilde{\\sigma}^2}\n$$\n我们希望这个表达式等同于在$s$空间中沉积的高斯核的指数部分：\n$$\nG_{s}(s; s_{0}) = w \\exp\\left(-\\frac{(s - s_{0})^{2}}{2 \\sigma_{s}^{2}}\\right)\n$$\n指数部分为：\n$$\n-\\frac{(s - s_0)^2}{2 \\sigma_s^2}\n$$\n通过比较两个指数的自变量，我们强制要求$s$空间中的核在局域变换后与$\\tilde{s}$空间中的目标形状相匹配。\n$$\n\\frac{(s - s_0)^2}{2 \\sigma_s^2} = \\frac{(f'(s_0))^2 (s - s_0)^2}{2 \\tilde{\\sigma}^2}\n$$\n这个等式必须在$s_0$附近对$s$成立。消去公因子得到：\n$$\n\\frac{1}{\\sigma_s^2} = \\frac{(f'(s_0))^2}{\\tilde{\\sigma}^2}\n$$\n求解$\\sigma_s$：\n$$\n\\sigma_s^2 = \\frac{\\tilde{\\sigma}^2}{(f'(s_0))^2} \\implies \\sigma_s = \\sqrt{\\frac{\\tilde{\\sigma}^2}{(f'(s_0))^2}} = \\frac{\\tilde{\\sigma}}{|f'(s_0)|}\n$$\n由于这个逻辑必须适用于任何可能沉积高斯函数的位置$s$，我们将$s_0$推广到一个一般位置$s$。这得出了在变换空间中维持恒定有效宽度$\\tilde{\\sigma}$所需的位置依赖宽度$\\sigma_s(s)$：\n$$\n\\sigma_s(s) = \\frac{\\tilde{\\sigma}}{|f'(s)|}\n$$\n这个结果表明，在变换$f(s)$陡峭（$|f'(s)|$大）的区域，需要在原始空间中使用更窄的核$\\sigma_s$才能在变换空间中产生所需的宽度。相反，在$f(s)$平坦（$|f'(s)|$小）的区域，则需要更宽的核。\n\n**3. 关于适温前置因子的说明**\n\n在适温元动力学中，在时间$t_n$沉积的高斯函数的高度$w$不是一个常数$w_0$，而是受到已累积的偏置势$V_G$的调节：\n$$\nw(t_n) = w_0 \\exp\\left(-\\frac{V_G(s(t_n), t_{n-1})}{k_B \\Delta T}\\right)\n$$\n其中$\\Delta T$是一个具有温度单位的参数，用于控制调节过程。\n\n第 2 部分的推导关注的是核的空间形状，它由指数函数的自变量决定，即与$(s-s_0)^2$成正比的项。高度$w(t_n)$是一个指数前因子，或称为振幅。核形状的匹配是通过令指数部分相等来实现的：\n$$\n\\text{exponent}_s \\leftrightarrow \\text{exponent}_{\\tilde{s}}\n$$\n振幅$w$只是对整个函数进行缩放，并被视为一个公共因子：\n$$\nw \\exp(\\text{exponent}_s) \\leftrightarrow w \\exp(\\text{exponent}_{\\tilde{s}})\n$$\n$\\sigma_s$和$\\tilde{\\sigma}$之间的关系完全是从核的空间部分推导出来的，这与振幅前置因子$w$无关。因此，在 WTMetaD 中$w$随时间和位置变化这一事实，并不会改变在沉积时刻所需的核宽度的几何缩放。适温协议影响的是添加*多少*偏置，而我们推导出的宽度缩放影响的是所添加偏置的*形状*。\n\n总之，在$s$空间中所需的位置依赖宽度的表达式是目标宽度$\\tilde{\\sigma}$和变换函数$f(s)$的局域导数的函数。", "answer": "$$\\boxed{\\frac{\\tilde{\\sigma}}{|f'(s)|}}$$", "id": "3461459"}, {"introduction": "理论知识的最终检验在于实践应用。这个练习将带你从理论走向实践，通过编写代码来解决一个核心问题：如何判断一个增强抽样模拟已经“收敛”？你将亲手实现一个基于重要性采样和自举法（bootstrap）的统计学鲁棒的收敛判据 ([@problem_id:3461487])，这不仅能让你深入理解如何从有偏的轨迹中重构无偏的自由能，还能让你掌握评估模拟结果统计不确定性的强大工具。", "problem": "给定一个一维集体变量$s \\in \\mathbb{R}$和一个潜在的无偏平均力势$U(s)$，该势通过玻尔兹曼定律在绝对温度$T$下决定了平衡分布。在诸如适温元动力学（well-tempered metadynamics）之类的有偏分子动力学方案中，一个随时变化的偏置$V(s,t)$被加到势能上，从而改变了采样分布。假设在两个连续的时间窗口$[t-\\Delta t, t)$和$[t, t+\\Delta t)$内，偏置是准静态的，可以分别近似为$V_{\\text{old}}(s) = -b_{\\text{old}} U(s)$和$V_{\\text{new}}(s) = -b_{\\text{new}} U(s)$，其中$b_{\\text{old}}, b_{\\text{new}} \\in [0,1)$。这与适温元动力学一致，在适温元动力学中，偏置与按小于一的因子缩放的自由能成正比。设无偏自由能剖面（在一个可加常数的范围内）定义为$F(s) = -\\beta^{-1} \\ln P(s)$，其中$\\beta = 1/(k_{\\mathrm{B}} T)$，$P(s)$是$s$的平衡概率密度。通过选择一个参考值$s_{\\mathrm{ref}}$，使得$F(s_{\\mathrm{ref}}) = 0$，来固定该可加常数。\n\n您的任务是设计并实现一个概率性停止规则，当两个时间窗口之间的剖面收敛时，该规则将停止运行。此规则仅基于以下原则：\n\n- 一个构型的玻尔兹曼权重与$\\exp(-\\beta U)$成正比。\n- 在一个可加偏置$V(s,t)$下，采样权重变为与$\\exp(-\\beta(U+V))$成正比。\n- 重要性采样允许通过对来自另一个分布的样本进行重新加权，来重构某个分布下的期望值。\n\n基于这些原则，推导并实现：\n\n1. 通过在$s$的观测支撑集上使用一个包含$M$个区间的均匀网格，并利用重要性采样，从有偏样本$(s_i, V_i)$中得到无偏自由能剖面$F(s)$的一致估计量。您必须推导出如何使用作为$V_i$函数的权重来构建$P(s)$的归一化估计，然后得到在可加常数范围内的$F(s)$。通过强制在$s_{\\mathrm{ref}}=0$时$F(s_{\\mathrm{ref}})=0$来对齐剖面。\n2. 两个连续剖面的收敛度量，由网格上的均匀范数给出：$d_{\\infty} = \\max_k |F_{\\text{new}}(s_k) - F_{\\text{old}}(s_k)|$，其中$\\{s_k\\}_{k=1}^M$是区间中心。\n3. 一个基于 bootstrap 的置信度估计器，用于评估事件$d_{\\infty} < \\varepsilon$，其中$\\varepsilon$是给定的容差，单位为千焦/摩尔（kJ/mol）。在每个时间窗口中，使用有放回重采样观测到的$s$值，其选择概率与您从基本原则中推导出的重要性权重成正比，从而生成$F_{\\text{old}}$和$F_{\\text{new}}$的 bootstrap 复制。对于每个 bootstrap 复制，使用完全相同的网格和参考对齐方式重新计算$d_{\\infty}$。估计的置信度是满足$d_{\\infty} < \\varepsilon$的 bootstrap 复制所占的比例。停止决策是：当且仅当估计的置信度大于或等于指定的阈值$c \\in (0,1)$时停止。\n\n实现细节和约束：\n\n- 潜在的无偏势是一个对称双阱$U(s) = k (s^2 - a^2)^2$，其中$k$和$a$是给定的。\n- 每个窗口内的采样应通过使用 Metropolis–Hastings 随机游走，从与$\\exp(-\\beta[U(s)+V(s)])$成正比的有偏玻尔兹曼分布中进行。该随机游走使用具有固定标准差的高斯提议分布。使用预烧（burn-in）和稀疏化（thinning）策略以获得近似独立的样本，然后分别为旧窗口和新窗口收集确切数量为$N_{\\text{old}}$和$N_{\\text{new}}$的样本。\n- 自由能网格应在每个测试案例中构建一次，方法是汇集两个窗口的$s$样本以确定观测到的最小值和最大值，然后在此区间上创建$M$个等宽区间。参考值$s_{\\mathrm{ref}}=0$必须对齐到最近的区间中心。\n- 为避免未定义的对数，应实现一个数值稳定的策略，以确保在计算对数之前所有区间中的估计概率都严格为正。由此产生的调整必须在原始估计和 bootstrap 估计中保持一致。\n\n物理单位和常数：\n\n- 温度$T$以开尔文（K）为单位。使用玻尔兹曼常数的摩尔形式，即通用气体常数$R$，单位为千焦/摩尔·开尔文：$R = 0.00831446261815324$ kJ/(mol·K)。因此，$\\beta = 1/(R T)$，单位为 mol/kJ。\n- 容差$\\varepsilon$以千焦/摩尔（kJ/mol）报告。自由能剖面$F(s)$及其差异也以千焦/摩尔（kJ/mol）为单位。\n- 本问题不使用角度。\n\n测试套件和要求的输出：\n\n实现您的程序，以在以下四个测试案例上评估停止决策。对于每个测试案例，您必须使用一个独立的随机种子以使结果具有确定性。每个测试案例是一个元组：\n(seed, T_K, k_kJ_per_mol, a, b_old, b_new, N_old, N_new, M_bins, epsilon_kJ_per_mol, confidence_threshold, B_bootstrap)\n\n使用以下测试案例列表：\n1. (42, 300.0, 5.0, 1.0, 0.30, 0.50, 4000, 4000, 80, 0.50, 0.95, 200)\n2. (7, 300.0, 5.0, 1.0, 0.30, 0.50, 500, 500, 80, 0.05, 0.95, 200)\n3. (123, 300.0, 5.0, 1.0, 0.00, 0.80, 1200, 1200, 100, 0.12, 0.90, 200)\n4. (2021, 300.0, 5.0, 1.0, 0.40, 0.60, 2500, 2500, 90, 0.40, 0.90, 150)\n\n您的程序应产生单行输出，其中包含一个以逗号分隔的 Python 风格的布尔值列表，顺序与测试案例的顺序相同。例如，输出行必须如下所示：\n[True,False,True,False]\n\n不应打印任何其他文本。决策规则是：如果$d_{\\infty} < \\varepsilon$的估计 bootstrap 置信度大于或等于指定的置信度阈值，则停止；否则不停止。所有计算都必须使用双精度浮点算术完成。", "solution": "用户提供了一个在计算统计力学领域中定义明确的问题。\n\n### 步骤 1：提取已知条件\n- **系统**：一个一维集体变量$s \\in \\mathbb{R}$。\n- **无偏势**：$U(s) = k (s^2 - a^2)^2$。\n- **温度**：$T$，单位为开尔文（K）。\n- **玻尔兹曼常数（摩尔）**：通用气体常数$R = 0.00831446261815324 \\text{ kJ/(mol·K)}$。\n- **逆温度**：$\\beta = 1/(R T)$。\n- **有偏势**：\n  - 在窗口$[t-\\Delta t, t)$中，$V_{\\text{old}}(s) = -b_{\\text{old}} U(s)$，其中$b_{\\text{old}} \\in [0,1)$。\n  - 在窗口$[t, t+\\Delta t)$中，$V_{\\text{new}}(s) = -b_{\\text{new}} U(s)$，其中$b_{\\text{new}} \\in [0,1)$。\n- **无偏自由能**：$F(s) = -\\beta^{-1} \\ln P(s)$，其中$P(s)$是平衡概率密度。\n- **参考条件**：在$s_{\\text{ref}}=0$时，$F(s_{\\mathrm{ref}}) = 0$。\n- **任务**：实现一个基于两个窗口间自由能剖面收敛性的概率性停止规则。\n- **方法**：\n  1.  **自由能估计器**：对有偏样本$(s_i, V_i)$使用重要性采样，重新加权至无偏分布$P(s)$，然后在包含$M$个区间的均匀网格上计算$F(s)$。\n  2.  **收敛度量**：$d_{\\infty} = \\max_k |F_{\\text{new}}(s_k) - F_{\\text{old}}(s_k)|$。\n  3.  **Bootstrap 置信度**：使用有放回重采样来估计$d_{\\infty} < \\varepsilon$的置信度。重采样的选择概率必须与重要性权重成正比。如果置信度$\\geq c$，则停止。\n- **实现约束**：\n  - **采样**：使用高斯提议分布、预烧和稀疏化的 Metropolis-Hastings 随机游走。收集$N_{\\text{old}}$和$N_{\\text{new}}$个样本。\n  - **网格**：在汇集的样本范围上设置$M$个区间。将参考点$s_{\\text{ref}}=0$对齐到最近的区间中心。\n  - **数值稳定性**：在取对数前确保概率严格为正。\n- **测试案例**：提供了四个元组：`(seed, T_K, k, a, b_old, b_new, N_old, N_new, M_bins, epsilon_kJ_per_mol, confidence_threshold, B_bootstrap)`。\n- **输出**：单行 Python 风格的布尔值列表，例如 `[True,False,True,False]`。\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学基础**：该问题在统计力学和计算物理学原理方面有坚实的基础。它利用了标准技术，如玻尔兹曼分布、元动力学、Metropolis-Hastings 采样、重要性采样和 bootstrap 分析。对于适温元动力学中的准静态，近似$V(s) = -b U(s)$是一个合理的简化，其中偏置势预期会收敛到自由能的缩放版本，而对于一维系统，$F(s) \\approx U(s) + \\text{const}$。\n- **适定性**：该问题是适定的。它提供了所有必要的参数、清晰的算法步骤以及固定的随机种子，以确保结果是确定且唯一的。采样参数（提议宽度、预烧、稀疏化）未指定，这意味着应做出标准、合理的选择，这是常见做法。\n- **客观性**：该问题以精确、客观和数学化的语言陈述，没有任何主观因素。\n- **缺陷清单**：该问题不违反任何无效性标准。它在科学上是合理的、可形式化的、完整的、可行的、结构良好的、非平凡的且可验证的。\n\n### 步骤 3：结论与行动\n该问题是**有效的**。将开发并实现一个分步解决方案。\n\n### 基于原则的设计\n该解决方案是对问题陈述中概述的原则和程序的直接实现。\n\n**1. 基础：玻尔兹曼统计与有偏采样**\n无偏系统的平衡概率密度为$P_{\\text{unbiased}}(s) \\propto \\exp(-\\beta U(s))$，其中$\\beta = 1/(RT)$。模拟在有偏势$E(s) = U(s) + V(s)$下进行，产生有偏采样分布$P_{\\text{biased}}(s) \\propto \\exp(-\\beta(U(s) + V(s)))$。给定的偏置形式为$V(s) = -b U(s)$，因此采样的有效势为$E(s) = (1-b)U(s)$。使用 Metropolis-Hastings 算法从$P_{\\text{biased}}(s)$生成样本。\n\n**2. 通过重要性采样重建自由能**\n为了从来自$P_{\\text{biased}}(s)$的样本$\\{s_i\\}$中恢复无偏分布$P_{\\text{unbiased}}(s)$，我们采用重要性采样。每个样本$s_i$被赋予一个权重$w_i$来校正偏置：\n$$ w_i = \\frac{P_{\\text{unbiased}}(s_i)}{P_{\\text{biased}}(s_i)} = \\frac{\\exp(-\\beta U(s_i))}{\\exp(-\\beta(U(s_i) + V(s_i)))} = \\exp(\\beta V(s_i)) $$\n对于特定的偏置$V(s_i) = -b U(s_i)$，权重变为$w_i = \\exp(-\\beta b U(s_i))$。\n\n**3. 离散化与剖面估计**\n集体变量$s$在其观测范围内被离散化为$M$个区间。对于一组给定的有偏样本$\\{s_i\\}$及其对应的权重$\\{w_i\\}$，系统处于区间$k$的概率$P_k$可通过落入该区间的样本权重的归一化总和来估计：\n$$ \\hat{P}_k = \\frac{\\sum_{i \\text{ where } s_i \\in \\text{bin } k} w_i}{\\sum_{j=1}^N w_j} $$\n然后，在每个区间中心$s_k$处估计自由能剖面$F(s)$。在参考区间$k_{\\text{ref}}$处对齐后，表达式简化为：\n$$ F(s_k) = -\\beta^{-1} \\ln(\\hat{P}_k) - (-\\beta^{-1} \\ln(\\hat{P}_{k_{\\text{ref}}})) = -\\beta^{-1} \\ln\\left(\\frac{\\hat{P}_k}{\\hat{P}_{k_{\\text{ref}}}}\\right) $$\n区间宽度项在对齐过程中抵消。为确保数值稳定性，在归一化之前向每个区间的计数中添加一个小的正常数（例如，机器精度），以防止出现零的对数。\n\n**4. 用于收敛性评估的 Bootstrap 置信度估计**\n自由能剖面的统计不确定性通过 bootstrap 程序进行评估。问题指定了采样-重要性-重采样（SIR）方法：\n1.  对于每个窗口（'old' 和 'new'），在原始样本$\\{s_i\\}$上创建一个新的概率分布，其中选择$s_i$的概率与其重要性权重成正比，$p_i = w_i / \\sum_j w_j$。\n2.  通过根据这些概率$\\{p_i\\}$从原始集合中有放回地抽取$N$个样本，来生成一个 bootstrap 复制。这个新集合$\\{s'_{j}\\}$是目标无偏分布的一个近似无权重样本。\n3.  对于每个 bootstrap 复制，通过构建 bootstrap 样本$\\{s'_{j}\\}_{\\text{old}}$和$\\{s'_{j}\\}_{\\text{new}}$的标准（无权重）直方图，进行归一化以找到概率，取对数，并在参考区间处对齐，来计算自由能剖面$F_{\\text{old}}^{\\text{boot}}(s_k)$和$F_{\\text{new}}^{\\text{boot}}(s_k)$。\n4.  计算该 bootstrap 复制的收敛度量：$d_{\\infty}^{\\text{boot}} = \\max_k |F_{\\text{new}}^{\\text{boot}}(s_k) - F_{\\text{old}}^{\\text{boot}}(s_k)|$。\n5.  对$B_{\\text{bootstrap}}$个复制重复此过程。置信度是满足$d_{\\infty}^{\\text{boot}} < \\varepsilon$的复制所占的比例。\n\n**5. 停止规则**\n如果估计的置信度大于或等于指定的阈值$c$，则认为模拟已收敛，过程停止（返回 `True`）。否则，继续进行（返回 `False`）。对每个指定的测试案例都将实现这整个算法。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem, executing the probabilistic stopping rule\n    for each specified test case.\n    \"\"\"\n\n    # Universal gas constant in kJ/(mol·K)\n    R_KJ_MOL_K = 0.00831446261815324\n    \n    # Small constant for numerical stability to avoid log(0)\n    TINY = np.finfo(np.float64).tiny\n\n    # Test cases as defined in the problem statement.\n    test_cases = [\n        # (seed, T_K, k, a, b_old, b_new, N_old, N_new, M_bins, epsilon_kJ_per_mol, confidence_threshold, B_bootstrap)\n        (42, 300.0, 5.0, 1.0, 0.30, 0.50, 4000, 4000, 80, 0.50, 0.95, 200),\n        (7, 300.0, 5.0, 1.0, 0.30, 0.50, 500, 500, 80, 0.05, 0.95, 200),\n        (123, 300.0, 5.0, 1.0, 0.00, 0.80, 1200, 1200, 100, 0.12, 0.90, 200),\n        (2021, 300.0, 5.0, 1.0, 0.40, 0.60, 2500, 2500, 90, 0.40, 0.90, 150)\n    ]\n\n    def _process_case(seed, T_K, k, a, b_old, b_new, N_old, N_new, M_bins,\n                      epsilon_kJ_per_mol, confidence_threshold, B_bootstrap):\n        \"\"\"\n        Processes a single test case, from sampling to the final stopping decision.\n        \"\"\"\n        \n        np.random.seed(seed)\n        \n        # --- 1. Setup Potentials and Constants ---\n        beta = 1.0 / (R_KJ_MOL_K * T_K)\n\n        def U(s):\n            return k * (s**2 - a**2)**2\n\n        def E_old(s):\n            # Total potential for the 'old' window's biased sampling\n            return (1.0 - b_old) * U(s)\n\n        def E_new(s):\n            # Total potential for the 'new' window's biased sampling\n            return (1.0 - b_new) * U(s)\n        \n        def V_old(s):\n            # Bias potential for the 'old' window\n            return -b_old * U(s)\n\n        def V_new(s):\n            # Bias potential for the 'new' window\n            return -b_new * U(s)\n\n        # --- 2. MCMC Sampling ---\n        def run_mcmc(potential_func, n_samples):\n            # MCMC parameters are chosen to be reasonable for typical molecular simulations.\n            proposal_std = 0.2\n            burn_in_steps = 5000\n            thinning_interval = 20\n            total_steps = burn_in_steps + n_samples * thinning_interval\n            \n            samples = np.zeros(n_samples, dtype=np.float64)\n            current_s = 0.0  # Start walker at s=0.0\n            current_E = potential_func(current_s)\n            \n            sample_idx = 0\n            for step in range(total_steps):\n                proposed_s = current_s + np.random.normal(0.0, proposal_std)\n                proposed_E = potential_func(proposed_s)\n                \n                # Metropolis acceptance criterion\n                delta_E = proposed_E - current_E\n                if delta_E < 0 or np.random.rand() < np.exp(-beta * delta_E):\n                    current_s = proposed_s\n                    current_E = proposed_E\n                \n                # Collect sample after burn-in and at thinning intervals\n                if step >= burn_in_steps:\n                    if (step - burn_in_steps) % thinning_interval == 0:\n                        if sample_idx < n_samples:\n                            samples[sample_idx] = current_s\n                            sample_idx += 1\n            return samples\n\n        samples_old = run_mcmc(E_old, N_old)\n        samples_new = run_mcmc(E_new, N_new)\n\n        # --- 3. Grid Construction ---\n        all_samples = np.concatenate((samples_old, samples_new))\n        s_min, s_max = np.min(all_samples), np.max(all_samples)\n        bins = np.linspace(s_min, s_max, M_bins + 1, dtype=np.float64)\n        bin_centers = (bins[:-1] + bins[1:]) / 2.0\n        ref_idx = np.argmin(np.abs(bin_centers - 0.0))\n\n        # --- 4. Free Energy Calculation Logic (for bootstrap samples) ---\n        def calculate_F_from_unweighted(samples, bins, beta, ref_idx):\n            counts, _ = np.histogram(samples, bins=bins)\n            # Add TINY for numerical stability, then normalize to get probability\n            prob = (counts + TINY) / np.sum(counts + TINY)\n            F_raw = - (1.0 / beta) * np.log(prob)\n            # Align profile to reference\n            F_aligned = F_raw - F_raw[ref_idx]\n            return F_aligned\n\n        # --- 5. Bootstrap Analysis ---\n        # Calculate importance weights and resampling probabilities for SIR\n        weights_old = np.exp(beta * V_old(samples_old))\n        p_old = weights_old / np.sum(weights_old)\n        \n        weights_new = np.exp(beta * V_new(samples_new))\n        p_new = weights_new / np.sum(weights_new)\n\n        converged_count = 0\n        for _ in range(B_bootstrap):\n            # Generate bootstrap samples via Sampling-Importance-Resampling (SIR)\n            s_boot_old = np.random.choice(samples_old, size=N_old, replace=True, p=p_old)\n            s_boot_new = np.random.choice(samples_new, size=N_new, replace=True, p=p_new)\n            \n            # These bootstrap samples are now unweighted draws from the target distribution.\n            # Calculate FE profiles directly from their unweighted histograms.\n            F_boot_old = calculate_F_from_unweighted(s_boot_old, bins, beta, ref_idx)\n            F_boot_new = calculate_F_from_unweighted(s_boot_new, bins, beta, ref_idx)\n            \n            # Calculate convergence metric for this bootstrap replicate\n            d_infty_boot = np.max(np.abs(F_boot_new - F_boot_old))\n            \n            if d_infty_boot < epsilon_kJ_per_mol:\n                converged_count += 1\n                \n        confidence = converged_count / B_bootstrap\n        \n        # --- 6. Final Decision ---\n        return confidence >= confidence_threshold\n\n    results = []\n    for case in test_cases:\n        decision = _process_case(*case)\n        results.append(decision)\n\n    # Final print statement must match the required format exactly.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3461487"}, {"introduction": "元动力学方法的理论根基，建立在一个核心假设之上：所选的集体变量$s$的演化过程可以近似为简单的扩散过程。但如果由于存在“隐藏”的慢变量，导致$s$的动力学行为出现非扩散特征（如滞后或系统性漂移），会发生什么？这个练习 [@problem_id:3461537] 提出了一个高级诊断挑战，它将迫使你从第一性原理出发，分析当这一基本假设被违背时，元动力学模拟将如何失效，并思考如何通过选择更优的变量或扩展变量空间等高级技巧来解决这一棘手问题。", "problem": "考虑一个分子系统，其微观坐标为$q \\in \\mathbb{R}^N$，在温度$T$下遵循欠阻尼朗之万动力学演化，质量矩阵为$\\mathbf{M}$，保守势为$U(q)$，摩擦系数为$\\gamma$。一个标量集体变量 (CV) $s(q)$被用于通过含时偏置$V_{\\mathrm{bias}}(s,t)$来偏置采样。在没有偏置的情况下，微观运动方程为\n$$\n\\mathbf{M} \\ddot{q}(t) = - \\nabla U(q(t)) - \\gamma \\mathbf{M} \\dot{q}(t) + \\xi(t),\n$$\n其中$\\xi(t)$是一个高斯随机力，其均值为零，协方差与涨落-耗散关系一致。在适温元动力学 (WTMetaD) 中，人们假设偏置变量$s(q(t))$的演化在投影后可以被建模为一个等效的扩散、近似马尔可夫过程，因此概率密度$\\rho(s,t)$遵循一个福克-普朗克方程，其流$J_s(s,t)$由与有效自由能梯度成正比的漂移和扩散系数决定。\n\n然而，假设由于隐藏的慢变量$u(q)$或构型空间区域中的结构滞后，$s(q(t))$的投影动力学表现出非扩散特征：条件平均速率$\\langle \\dot{s} \\mid s \\rangle$具有一个持续的、依赖于构型的确定性分量，并且投影噪声表现出记忆效应。这可以通过为$s(t)$写下一个广义朗之万方程 (GLE) 来描述，形式如下\n$$\nm_s \\ddot{s}(t) = - \\partial_s F(s) - \\partial_s V_{\\mathrm{bias}}(s,t) - \\int_0^t K(t-\\tau) \\dot{s}(\\tau) \\, \\mathrm{d}\\tau + \\eta_s(t) + \\delta f(s,u),\n$$\n其中$F(s)$是作为$s$的函数的自由能，$K(t)$是一个记忆核，$\\eta_s(t)$是与 GLE 的涨落-耗散关系一致的有色高斯噪声，而$\\delta f(s,u)$是由隐藏变量$u$引起的额外确定性漂移，它不能表示为仅与$s$有关的状态函数的$- \\partial_s$。因此，边际$\\rho(s,t)$的概率流形式为\n$$\nJ_s(s,t) = v(s) \\, \\rho(s,t) - D(s) \\, \\partial_s \\rho(s,t),\n$$\n其中有一个由$\\delta f(s,u)$产生的非零系统性漂移$v(s)$和一个受记忆效应修正的有效扩散$D(s)$。\n\nWTMetaD 根据对$s$的访问情况来沉积偏置，并采用一个调温方案，旨在实现一个稳态的、目标边际分布，同时防止过度填充。请基于随机投影和概率连续性的第一性原理，分析投影动力学中非零$v(s)$和记忆效应的存在如何影响 WTMetaD 的马尔可夫性和扩散行为假设，以及在偏置沉积下零流稳态的存在性。根据您的分析，选择所有正确的陈述。\n\nA. 非扩散的 CV 动力学不影响适温元动力学中渐近偏置的推导；即使存在持续的确定性漂移$v(s) \\neq 0$，WTMetaD 偏置仍会收敛到真实自由能的一个按比例缩放的版本，该版本仅依赖于$s$。\n\nB. 非零的系统性漂移$v(s)$意味着一个非零的概率流$J_s(s,t)$；除非偏置通过$s$的梯度精确地抵消$v(s)$，否则 WTMetaD 中假设的零流稳态不存在，导致偏置持续增长和重构的自由能失真。\n\nC. 一种补救方法是引入一个与$s$耦合的辅助扩展变量$\\zeta$，赋予其过阻尼朗之万动力学，并对$\\zeta$应用 WTMetaD；通过适当的时间尺度分离和摩擦，这可以为偏置变量恢复近似的马尔可夫、扩散行为，并减轻滞后效应。\n\nD. 增加 WTMetaD 中的高斯沉积高度或速率足以消除滞后和确定性漂移，确保尽管存在非扩散的 CV 动力学，偏置仍能收敛到正确的自由能。\n\nE. 构建一个局域正交化的偏置坐标$\\tilde{s}(q) = s(q) - \\lambda(q) \\, u(q)$，其中选择$\\lambda(q)$使得在每个构型下$\\nabla \\tilde{s}(q) \\cdot \\mathbf{M}^{-1} \\nabla u(q) = 0$，这会抑制由$u$引起的$s$的确定性漂移，并为$\\tilde{s}$恢复更具扩散性的行为，从而改善 WTMetaD 偏置优化。\n\nF. 对物理自由度应用速度重标恒温器保证了在 CV 层面上的白噪声驱动，因此即使在投影动力学中存在滞后和记忆效应，也能验证 WTMetaD 的假设。\n\n选择所有正确的选项。", "solution": "该问题提法恰当、有科学依据且客观。它准确地描述了增强采样模拟中的一个已知挑战，即所选的集体变量 (CV) 并未表现出理想的、马尔可夫扩散动力学。引入一个带有记忆核和非势漂移项的广义朗之万方程 (GLE) 是分析此类投影动力学的标准理论框架（可从 Mori-Zwanzig 形式理论推导）。该问题是有效的，可以从第一性原理解决。\n\n适温元动力学 (WTMetaD) 的收敛性基于这样一个假设：集体变量$s$的偏置动力学可以用一个在势能面上的简单扩散过程来描述。总有效势是内在自由能$F(s)$和沉积的偏置势$V_{\\mathrm{bias}}(s,t)$的和。在这个理想化的图像中，过阻尼极限下的概率流由下式给出：\n$$\nJ_s(s,t) = -\\frac{D(s)}{k_B T} \\rho(s,t) \\frac{\\partial}{\\partial s} \\left( F(s) + V_{\\mathrm{bias}}(s,t) \\right)\n$$\n其中$D(s)$是扩散系数，$T$是温度，$k_B$是玻尔兹曼常数，$\\rho(s,t)$是 CV 的概率密度。WTMetaD 的设计目标是达到一个准稳态，此时概率流消失，$J_s(s,t) \\to 0$。这个条件意味着总的金兹堡-朗道自由能是平坦的，即$F(s) + V_{\\mathrm{bias}}(s,t) = \\text{常数}$。该算法的构造使得偏置收敛到自由能的一个按比例缩放的版本，即$V_{\\mathrm{bias}}(s,t \\to \\infty) = - \\frac{\\gamma_{WT}-1}{\\gamma_{WT}} F(s)$，其中$\\gamma_{WT}$是偏置因子。\n\n问题引入了一个复杂情况：投影动力学是非扩散的。概率流被给出为：\n$$\nJ_s(s,t) = v(s) \\, \\rho(s,t) - D(s) \\, \\partial_s \\rho(s,t)\n$$\n在这里，$v(s)$是一个系统性的、确定性的漂移速度，它不是从关于$s$的势函数的梯度推导出来的。它源于与隐藏的慢变量$u(q)$的耦合，这在投影到$s$的动力学中引入了一个非保守“力”。项$- D(s) \\, \\partial_s \\rho(s,t)$是标准的菲克扩散流。偏置系统的总流应该包含来自$F(s)+V_{\\mathrm{bias}}(s,t)$的保守力和非保守漂移$v(s)$。福克-普朗克方程中总漂移速度（平流项）的一个更完整的形式将导致一个流：\n$$\nJ_s(s,t) = \\left[ -\\mu(s) \\frac{\\partial}{\\partial s}(F(s)+V_{\\mathrm{bias}}(s,t)) + v(s) \\right] \\rho(s,t) - D(s) \\partial_s \\rho(s,t)\n$$\n其中$\\mu(s)$是迁移率，通过爱因斯坦关系$D(s) = \\mu(s) k_B T$与$D(s)$相关。\nWTMetaD 的基本假设是达到一个零流稳态，$J_s(s,t \\to \\infty) = 0$。让我们检验这个条件。对于一个稳态分布$\\rho_{final}(s)$，条件$J_s = 0$意味着：\n$$\nD(s) \\frac{\\partial \\rho_{final}(s)}{\\partial s} = \\left[ -\\frac{D(s)}{k_B T} \\frac{\\partial}{\\partial s}(F(s)+V_{\\mathrm{bias}}(s)) + v(s) \\right] \\rho_{final}(s)\n$$\n$$\n\\frac{1}{\\rho_{final}(s)}\\frac{\\partial \\rho_{final}(s)}{\\partial s} = -\\frac{1}{k_B T} \\frac{\\partial}{\\partial s}(F(s)+V_{\\mathrm{bias}}(s)) + \\frac{v(s)}{D(s)}\n$$\n现在，WTMetaD 被设计用来产生一个特定的稳态分布，即$\\rho_{final}(s) \\propto \\exp\\left(-\\frac{F(s)+V_{\\mathrm{bias}}(s)}{k_B(T+\\Delta T)}\\right)$。对其对数取空间导数得到：\n$$\n\\frac{1}{\\rho_{final}(s)}\\frac{\\partial \\rho_{final}(s)}{\\partial s} = -\\frac{1}{k_B(T+\\Delta T)} \\frac{\\partial}{\\partial s}(F(s)+V_{\\mathrm{bias}}(s))\n$$\n将两个关于$\\partial_s \\ln \\rho_{final}(s)$的表达式相等，我们得到：\n$$\n-\\frac{1}{k_B(T+\\Delta T)} \\frac{\\partial}{\\partial s}(F(s)+V_{\\mathrm{bias}}(s)) = -\\frac{1}{k_B T} \\frac{\\partial}{\\partial s}(F(s)+V_{\\mathrm{bias}}(s)) + \\frac{v(s)}{D(s)}\n$$\n整理各项：\n$$\n\\left( \\frac{1}{k_B T} - \\frac{1}{k_B(T+\\Delta T)} \\right) \\frac{\\partial}{\\partial s}(F(s)+V_{\\mathrm{bias}}(s)) = \\frac{v(s)}{D(s)}\n$$\n$$\n\\left( \\frac{\\Delta T}{k_B T (T+\\Delta T)} \\right) \\frac{\\partial}{\\partial s}(F(s)+V_{\\mathrm{bias}}(s)) = \\frac{v(s)}{D(s)}\n$$\n这个方程显示了一个根本性的矛盾。WTMetaD 的收敛要求项$\\frac{\\partial}{\\partial s}(F(s)+V_{\\mathrm{bias}}(s))$非零（这是驱动非平坦景观变平坦的动力）。如果$v(s) \\neq 0$，原则上这个方程可以被满足。然而，WTMetaD 自身的机制导致$V_{bias}$具有一个特定形式$V_{bias} \\propto -F(s)$，这使得$\\frac{\\partial}{\\partial s}(F(s)+V_{\\mathrm{bias}}(s)) \\propto \\frac{\\partial F(s)}{\\partial s}$。\n$v(s) \\neq 0$的存在意味着稳态本质上是一个非平衡态。零流状态不能与 WTMetaD 的目标分布同时实现。这种不匹配阻止了偏置的正确收敛。\n\n---\n\n**A. 非扩散的 CV 动力学不影响适温元动力学中渐近偏置的推导；即使存在持续的确定性漂移$v(s) \\neq 0$，WTMetaD 偏置仍会收敛到真实自由能的一个按比例缩放的版本，该版本仅依赖于$s$。**\n这个陈述是不正确的。如上所述，非零系统性漂移$v(s)$的存在与 WTMetaD 收敛到自由能$F(s)$的按比例缩放版本所需满足的条件是根本不相容的。作为 WTMetaD 收敛性证明基础的零流稳态假设被违反了。\n\n**B. 非零的系统性漂移$v(s)$意味着一个非零的概率流$J_s(s,t)$；除非偏置通过$s$的梯度精确地抵消$v(s)$，否则 WTMetaD 中假设的零流稳态不存在，导致偏置持续增长和重构的自由能失真。**\n这个陈述是正确的。漂移$v(s)$源于一个项$\\delta f(s,u)$，该项不是仅与$s$有关的函数的梯度，这意味着它在$s$空间中代表一个非保守力。一个偏置势$V_{\\mathrm{bias}}(s)$，作为$s$的标量函数，只能产生一个保守力$-\\partial_s V_{\\mathrm{bias}}(s)$。它通常不能抵消一个非保守漂移。因此，一个零概率流状态 ($J_s=0$) 是无法达到的。系统被永久驱动，导致持续的流。WTMetaD 将不断沉积偏置以试图抵消这个流，从而阻止收敛并导致重构的自由能失真。\n\n**C. 一种补救方法是引入一个与$s$耦合的辅助扩展变量$\\zeta$，赋予其过阻尼朗之万动力学，并对$\\zeta$应用 WTMetaD；通过适当的时间尺度分离和摩擦，这可以为偏置变量恢复近似的马尔可夫、扩散行为，并减轻滞后效应。**\n这个陈述是正确的。它描述了扩展拉格朗日方法背后的核心思想，例如某种形式的扩展拉格朗日元动力学或即时概率增强采样 (OPES)。通过将物理 CV $s(q)$与一个虚拟变量$\\zeta$耦合（例如，通过一个谐振势$V_{cpl} = \\frac{k}{2}(s(q)-\\zeta)^2$）并对$\\zeta$施加偏置，可以减轻非马尔可夫动力学的问题。如果$\\zeta$的动力学变得非常慢（高摩擦/大质量），$\\zeta$会响应$s(q)$的时间平均特性，从而有效地滤除复杂的记忆效应和滞后。由于$\\zeta$本身遵循一个简单的、预设的朗之万方程，其动力学是马尔可夫和扩散的，使其成为 WTMetaD 的合适目标。\n\n**D. 增加 WTMetaD 中的高斯沉积高度或速率足以消除滞后和确定性漂移，确保尽管存在非扩散的 CV 动力学，偏置仍能收敛到正确的自由能。**\n这个陈述是不正确的。增加偏置沉积速率（通过增加高斯函数的高度或更频繁地沉积它们）并不能解决根本问题，即非保守漂移$v(s)$。更快的沉积会更积极地推动系统，但它不会使底层动力学更具扩散性或消除漂移。事实上，对于远离平衡的系统，已知更高的沉积速率会加剧误差并导致重构自由能中出现更大的系统性失真。\n\n**E. 构建一个局域正交化的偏置坐标$\\tilde{s}(q) = s(q) - \\lambda(q) \\, u(q)$，其中选择$\\lambda(q)$使得在每个构型下$\\nabla \\tilde{s}(q) \\cdot \\mathbf{M}^{-1} \\nabla u(q) = 0$，这会抑制由$u$引起的$s$的确定性漂移，并为$\\tilde{s}$恢复更具扩散性的行为，从而改善 WTMetaD 偏置优化。**\n这个陈述是正确的。有问题的漂移$v(s)$源于所选 CV $s$和隐藏慢变量$u$之间的动态耦合。条件$\\nabla \\tilde{s}(q) \\cdot \\mathbf{M}^{-1} \\nabla u(q) = 0$在新 CV $\\tilde{s}$和隐藏变量$u$之间强制实现动能正交性。这个正交性条件旨在解耦它们的动力学。通过最小化$u$的运动在$\\tilde{s}$方向上的投影，可以抑制$u$施加在 CV 动力学上的非势能。这会产生一个新的 CV $\\tilde{s}$，其动力学更“理想”——即更具扩散性，且系统性漂移要小得多，$v_{\\tilde{s}}(\\tilde{s}) \\approx 0$。这是一种寻找最优反应坐标的复杂策略，该坐标更适合像 WTMetaD 这样的方法。\n\n**F. 对物理自由度应用速度重标恒温器保证了在 CV 层面上的白噪声驱动，因此即使在投影动力学中存在滞后和记忆效应，也能验证 WTMetaD 的假设。**\n这个陈述是不正确的。恒温器的选择（例如，朗之万、Nosé-Hoover、速度重标）控制整个$N$维系统的温度。CV 空间中的记忆效应和系统性漂移是将高维动力学投影到由$s(q)$定义的低维流形上的结果。这是投影算符理论（例如，Mori-Zwanzig 形式理论）的一个基本结论。即使整个系统动力学是完全正则的并由白噪声驱动，在任意 CV 上的投影动力学通常也是非马尔可夫的（具有记忆核和有色噪声）。恒温器的选择不会改变这个数学事实。滞后和记忆的问题是势能面和 CV 选择所固有的，而不是恒温器的问题。", "answer": "$$\\boxed{BCE}$$", "id": "3461537"}]}