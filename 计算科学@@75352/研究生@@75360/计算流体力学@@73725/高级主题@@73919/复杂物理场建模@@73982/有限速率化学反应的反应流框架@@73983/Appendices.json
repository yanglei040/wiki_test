{"hands_on_practices": [{"introduction": "该练习为反应流建立了热力学基础。在构建复杂的数值求解器之前，必须掌握基本物理定律的应用。此实践 [@problem_id:3356521] 要求您从热力学第一定律和理想气体假设出发，推导绝热反应流团的压力演化方程，从而将压力变化与温度和组分的变化直接联系起来。这个过程将加深您对化学反应如何驱动系统热力学状态动态演化的理解。", "problem": "考虑一个由 $N$ 种化学组分（索引为 $k=1,\\dots,N$）组成的理想气体混合物的空间均匀、绝热、无粘性、不导热的拉格朗日流体质点。设各组分的质量分数为 $Y_k$ 且满足 $\\sum_{k=1}^{N} Y_k = 1$，混合物密度为 $\\rho$，压力为 $p$，温度为 $T$。每种组分 $k$ 具有分子量 $W_k$、单一气体常数 $R_k = R_u/W_k$（其中 $R_u$ 为普适气体常数）、依赖于温度的定压比热 $c_{p,k}(T)$ 和定容比热 $c_{v,k}(T)$，以及服从理想气体热物性关系 $h_k(T) = e_k(T) + R_k T$ 的温度热化学函数 $h_k(T)$ 和 $e_k(T)$。通过质量加权和定义混合物性质：\n$$\nc_p(T,\\mathbf{Y}) = \\sum_{k=1}^{N} Y_k\\,c_{p,k}(T),\\quad\nc_v(T,\\mathbf{Y}) = \\sum_{k=1}^{N} Y_k\\,c_{v,k}(T),\\quad\nR(\\mathbf{Y}) = \\sum_{k=1}^{N} Y_k\\,R_k,\n$$\n以及混合物比热比\n$$\n\\gamma(T,\\mathbf{Y}) = \\frac{c_p(T,\\mathbf{Y})}{c_v(T,\\mathbf{Y})}.\n$$\n假设混合物服从理想气体状态方程 $p = \\rho\\,R(\\mathbf{Y})\\,T$，并且由于有限速率化学反应，该流体质点经历组分变化 $\\dot{Y}_k = dY_k/dt$ 和温度变化率 $\\dot{T} = dT/dt$。仅使用理想气体混合物假设和第一性原理（运动流体质点的热力学第一定律和质量守恒），完成以下任务：\n\n- 解释混合物的 $c_p$、$c_v$ 和 $\\gamma$ 如何依赖于 $Y_k$ 和 $T$。\n- 为该拉格朗日反应流体质点推导压力的物质时间导数 $\\frac{dp}{dt}$ 的闭式表达式，该表达式应完全用 $\\dot{T}$、$\\dot{Y}_k$ 和 $T$ 的热化学函数来表示。\n\n您最终的 $\\frac{dp}{dt}$ 表达式必须写成一个单一解析公式，用 $\\rho$、$c_p(T,\\mathbf{Y})$、$h_k(T)$、$\\dot{T}$ 和 $\\dot{Y}_k$ 表示。不需要进行数值计算，也不需要四舍五入。请将最终答案表示为所要求的单一解析表达式。", "solution": "在进行求解之前，对问题进行验证。\n\n### 第1步：提取已知条件\n- **系统：** 一个空间均匀、绝热、无粘性、不导热的理想气体混合物拉格朗日流体质点。\n- **组分：** $N$ 种化学组分，索引为 $k=1,\\dots,N$。\n- **状态变量：** 组分质量分数 $Y_k$ 且满足 $\\sum_{k=1}^{N} Y_k = 1$，混合物密度 $\\rho$，压力 $p$，温度 $T$。\n- **组分性质：** 分子量 $W_k$，单一气体常数 $R_k = R_u/W_k$，依赖于温度的定压比热 $c_{p,k}(T)$，依赖于温度的定容比热 $c_{v,k}(T)$，比焓 $h_k(T)$，以及比内能 $e_k(T)$。\n- **本构关系：** 理想气体热物性关系 $h_k(T) = e_k(T) + R_k T$。\n- **混合物性质：**\n  - $c_p(T,\\mathbf{Y}) = \\sum_{k=1}^{N} Y_k\\,c_{p,k}(T)$\n  - $c_v(T,\\mathbf{Y}) = \\sum_{k=1}^{N} Y_k\\,c_{v,k}(T)$\n  - $R(\\mathbf{Y}) = \\sum_{k=1}^{N} Y_k\\,R_k$\n  - $\\gamma(T,\\mathbf{Y}) = \\frac{c_p(T,\\mathbf{Y})}{c_v(T,\\mathbf{Y})}$\n- **控制方程：** 混合物理想气体状态方程 $p = \\rho\\,R(\\mathbf{Y})\\,T$。\n- **过程信息：** 有限速率化学反应导致组分变化 $\\dot{Y}_k = dY_k/dt$ 和温度变化率 $\\dot{T} = dT/dt$。\n- **目标：**\n  1. 解释混合物性质 $c_p$、$c_v$ 和 $\\gamma$ 如何依赖于 $Y_k$ 和 $T$。\n  2. 推导压力的物质时间导数 $dp/dt$ 的闭式表达式，用 $\\rho$、$c_p(T,\\mathbf{Y})$、$h_k(T)$、$\\dot{T}$ 和 $\\dot{Y}_k$ 表示。\n\n### 第2步：使用提取的已知条件进行验证\n对问题进行有效性检查：\n- **科学基础：** 该问题基于应用于理想气体混合物的热力学和化学动力学的基本原理。所有定义和方程（例如，理想气体定律、混合物性质的定义）在反应流和燃烧领域都是标准的。该设置在科学上是合理的。\n- **适定性：** 该问题要求基于一组给定的原理和定义进行推导。所有必要的信息似乎都已提供。目标明确，预期会得到一个唯一的解析结果。\n- **客观性：** 该问题以精确、客观的语言陈述，没有主观性陈述或含糊不清之处。\n- **完整性和一致性：** 该问题提供了一套自洽的假设（绝热、无粘性、理想气体等）和定义。没有明显的矛盾。空间均匀的拉格朗日流体质点的概念是化学动力学建模中的一种标准简化（例如，零维反应器模型）。\n- **可行性：** 在反应流的理论和计算建模背景下，该场景是物理上可信的。\n- **结构：** 问题结构良好，不包含任何琐碎或循环论证。推导过程需要多步应用第一性原理。\n\n### 第3步：结论和行动\n该问题被判定为**有效**。这是理论反应流物理学中一个标准的、适定的问题。将提供解答。\n\n### 解答\n\n按照题目要求，解答分为两部分。\n\n**第一部分：热化学性质的依赖关系**\n\n混合物的热化学性质被定义为各组分性质的质量加权平均值。\n\n- 混合物的定压比热 $c_p(T,\\mathbf{Y})$ 定义为 $c_p(T,\\mathbf{Y}) = \\sum_{k=1}^{N} Y_k c_{p,k}(T)$。各组分的比热 $c_{p,k}$ 是温度 $T$ 的函数。混合物性质 $c_p$ 是这些函数的线性组合，其系数为质量分数 $Y_k$。因此，$c_p$ 同时依赖于温度 $T$ 和组分向量 $\\mathbf{Y} = (Y_1, \\dots, Y_N)$。\n\n- 类似地，混合物的定容比热 $c_v(T,\\mathbf{Y})$ 定义为 $c_v(T,\\mathbf{Y}) = \\sum_{k=1}^{N} Y_k c_{v,k}(T)$。与 $c_p$ 的原因相同，混合物性质 $c_v$ 同时依赖于温度 $T$（通过 $c_{v,k}(T)$）和组分 $\\mathbf{Y}$（通过权重 $Y_k$）。\n\n- 比热比 $\\gamma(T,\\mathbf{Y})$ 定义为 $\\gamma(T,\\mathbf{Y}) = \\frac{c_p(T,\\mathbf{Y})}{c_v(T,\\mathbf{Y})}$。由于其分子和分母都依赖于 $T$ 和 $\\mathbf{Y}$，比值 $\\gamma$ 也同时是温度和组分的函数。\n\n**第二部分：压力导数的推导**\n\n目标是推导压力的物质时间导数 $dp/dt$ 的表达式。最直接的路径是将压力的演化与混合物比焓的演化联系起来。\n\n首先，我们为指定系统推导一个基本的热力学关系。对于一个质量恒为 $m$ 的封闭拉格朗日流体质点，热力学第一定律为：\n$$ dE = \\delta Q - \\delta W $$\n其中 $E$ 是总内能，$\\delta Q$ 是系统吸收的热量，$\\delta W$ 是系统对外做的功。题目说明流体质点是绝热的，因此 $\\delta Q=0$。膨胀做的功为 $\\delta W = p dV$，其中 $V$ 是流体质点的体积。\n因此，第一定律简化为 $dE = -p dV$。\n用比量来表示，$E = m e$ 且 $V = m v = m/\\rho$，其中 $e$ 是比内能，$v$ 是比容，$\\rho$ 是密度。由于质量 $m$ 恒定：\n$$ m \\, de = -p \\, d(m/\\rho) = -pm \\, d(\\rho^{-1}) = -pm (-\\rho^{-2} d\\rho) = \\frac{mp}{\\rho^2} d\\rho $$\n两边除以 $m$，我们得到流体质点的比能方程：\n$$ de = \\frac{p}{\\rho^2} d\\rho $$\n混合物的比焓 $h$ 定义为 $h = e + p/\\rho$。其微分为：\n$$ dh = de + d(p/\\rho) = de + \\frac{1}{\\rho}dp - \\frac{p}{\\rho^2}d\\rho $$\n代入 $de$ 的表达式：\n$$ dh = \\left(\\frac{p}{\\rho^2} d\\rho\\right) + \\frac{1}{\\rho}dp - \\frac{p}{\\rho^2}d\\rho = \\frac{1}{\\rho}dp $$\n这就得出了一个简洁而有力的关系式 $dp = \\rho dh$。对于拉格朗日流体质点，这意味着物质时间导数之间的关系为：\n$$ \\frac{dp}{dt} = \\rho \\frac{dh}{dt} $$\n现在我们必须找到 $dh/dt$ 的表达式。混合物比焓是各组分比焓的质量加权和：\n$$ h(T, \\mathbf{Y}) = \\sum_{k=1}^{N} Y_k h_k(T) $$\n我们取物质时间导数，并应用乘法法则：\n$$ \\frac{dh}{dt} = \\frac{d}{dt} \\left( \\sum_{k=1}^{N} Y_k h_k(T) \\right) = \\sum_{k=1}^{N} \\left( \\frac{dY_k}{dt} h_k(T) + Y_k \\frac{dh_k(T)}{dt} \\right) $$\n项 $dY_k/dt$ 是组分生成速率，记为 $\\dot{Y}_k$。对于 $h_k(T)$ 的导数，我们使用链式法则：$dh_k(T)/dt = (dh_k/dT)(dT/dt)$。\n根据定义，组分 $k$ 的定压比热是 $c_{p,k}(T) = dh_k/dT$。温度变化率由 $\\dot{T} = dT/dt$ 给出。\n将这些代入 $dh/dt$ 的表达式：\n$$ \\frac{dh}{dt} = \\sum_{k=1}^{N} \\dot{Y}_k h_k(T) + \\sum_{k=1}^{N} Y_k c_{p,k}(T) \\frac{dT}{dt} $$\n提出 $dT/dt$：\n$$ \\frac{dh}{dt} = \\sum_{k=1}^{N} \\dot{Y}_k h_k(T) + \\left( \\sum_{k=1}^{N} Y_k c_{p,k}(T) \\right) \\dot{T} $$\n括号中的项是混合物定压比热 $c_p(T, \\mathbf{Y})$ 的定义。\n$$ \\frac{dh}{dt} = \\sum_{k=1}^{N} \\dot{Y}_k h_k(T) + c_p(T, \\mathbf{Y}) \\dot{T} $$\n最后，我们将此结果代回压力演化方程 $\\frac{dp}{dt} = \\rho \\frac{dh}{dt}$：\n$$ \\frac{dp}{dt} = \\rho \\left( c_p(T, \\mathbf{Y}) \\dot{T} + \\sum_{k=1}^{N} \\dot{Y}_k h_k(T) \\right) $$\n重新整理得到压力的物质导数的最终表达式，显示了它对温度变化率和因化学反应引起的组分变化率的依赖关系：\n$$ \\frac{dp}{dt} = \\rho c_p(T, \\mathbf{Y}) \\dot{T} + \\rho \\sum_{k=1}^{N} \\dot{Y}_k h_k(T) $$\n该表达式符合要求的形式，完全由指定的变量和热化学函数定义。", "answer": "$$\n\\boxed{\\rho c_p(T, \\mathbf{Y}) \\dot{T} + \\rho \\sum_{k=1}^{N} \\dot{Y}_k h_k(T)}\n$$", "id": "3356521"}, {"introduction": "模拟有限速率化学反应通常涉及求解常微分方程的刚性系统，对此隐式数值方法是必不可少的。这些方法的核心是化学源项的雅可比矩阵，它描述了每种物质的生成速率对其他物质浓度变化的敏感度。此实践 [@problem_id:3356493] 将引导您完成该雅可比矩阵的解析推导，包括由第三方反应和压力依赖的衰减反应引起的复杂性。成功完成此推导对于构建高效准确的化学求解器至关重要。", "problem": "考虑一个在计算流体力学 (CFD) 中描述的均匀、等温反应混合物，其物种摩尔浓度为 $C_{i}$，$i \\in \\{1,\\dots,N_{s}\\}$，温度 $T$ 和体积恒定。该混合物经历 $N_{r}$ 个可逆基元反应，索引为 $r \\in \\{1,\\dots,N_{r}\\}$，其反应物化学计量系数为 $\\nu_{ir}^{\\prime}$，产物化学计量系数为 $\\nu_{ir}^{\\prime\\prime}$，净化学计量系数为 $\\nu_{ir} \\equiv \\nu_{ir}^{\\prime\\prime} - \\nu_{ir}^{\\prime}$。物种 $k$ 的摩尔生成速率，记为 $\\dot{\\omega}_{k}$，由以下化学计量求和给出\n$$\n\\dot{\\omega}_{k} \\;=\\; \\sum_{r=1}^{N_{r}} \\nu_{kr}\\, q_{r},\n$$\n其中反应进程速率 $q_{r}$ 为\n$$\nq_{r} \\;=\\; R_{r}^{+} \\;-\\; R_{r}^{-}.\n$$\n假设所有反应均遵循质量作用动力学，并在适用的情况下进行第三体和压力衰减修正，因此\n$$\nR_{r}^{+} \\;=\\; k_{f,r}^{*}(T,C)\\,\\prod_{i=1}^{N_{s}} C_{i}^{\\nu_{ir}^{\\prime}}, \\qquad\nR_{r}^{-} \\;=\\; k_{r,r}^{*}(T,C)\\,\\prod_{i=1}^{N_{s}} C_{i}^{\\nu_{ir}^{\\prime\\prime}},\n$$\n并通过基于浓度的平衡常数 $K_{c,r}(T)$ 强制执行细致平衡，即 $k_{r,r}^{*}(T,C) = k_{f,r}^{*}(T,C)/K_{c,r}(T)$。此处 $k_{f,r}^{*}(T,C)$ 是一个有效的正向反应速率系数，对于第三体和压力衰减反应，它依赖于浓度，但对于普通反应，它仅依赖于温度 $T$。将反应 $r$ 的有效碰撞物浓度定义为\n$$\n[M]_{r} \\;=\\; \\sum_{i=1}^{N_{s}} \\alpha_{ir}\\, C_{i},\n$$\n其中给出了第三体效率 $\\alpha_{ir}$（如果未指定，则默认为 $\\alpha_{ir}=1$）。对于普通反应，$k_{f,r}^{*}(T,C)=k_{f,r}(T)$。对于第三体反应（非压力衰减），$k_{f,r}^{*}(T,C)=k_{f,r}(T)\\,[M]_{r}$。对于压力衰减反应，令低压极限为 $k_{0,r}(T)$，高压极限为 $k_{\\infty,r}(T)$，折合压力为\n$$\n\\Pr_{r} \\;=\\; \\frac{k_{0,r}(T)\\,[M]_{r}}{k_{\\infty,r}(T)}.\n$$\n令压力衰减展宽因子为 $F_{r}(\\Pr_{r},T)$（例如，Troe 类型），因此\n$$\nk_{f,r}^{*}(T,C) \\;=\\; k_{\\infty,r}(T)\\;F_{r}(\\Pr_{r},T)\\;\\frac{\\Pr_{r}}{1+\\Pr_{r}}.\n$$\n假设 $T$ 是固定的，因此 $k_{f,r}(T)$、$k_{0,r}(T)$、$k_{\\infty,r}(T)$ 和 $K_{c,r}(T)$ 相对于 $C$ 是常数，只有 $[M]_{r}$（因此通过 $\\Pr_{r}$ 引入了 $\\Pr_{r}$ 和 $F_{r}$）将浓度依赖性引入 $k_{f,r}^{*}(T,C)$。\n\n引入反应类型指示函数 $\\chi_{r}^{\\mathrm{ord}}$、$\\chi_{r}^{\\mathrm{TB}}$ 和 $\\chi_{r}^{\\mathrm{FO}}$，如果反应 $r$ 分别是普通反应、第三体反应（非压力衰减）或压力衰减反应，则其值为 $1$，否则为 $0$，且 $\\chi_{r}^{\\mathrm{ord}}+\\chi_{r}^{\\mathrm{TB}}+\\chi_{r}^{\\mathrm{FO}}=1$。\n\n从这些定义和基本的质量作用动力学出发，推导在固定温度 $T$ 下物种雅可比矩阵的解析项 $\\partial \\dot{\\omega}_{k}/\\partial C_{j}$，并明确考虑第三体和压力衰减的依赖性。您的推导必须明确应用乘法法则和链式法则，并确定 $[M]_{r}$ 和 $\\Pr_{r}$ 对 $\\partial k_{f,r}^{*}/\\partial C_{j}$ 的贡献。您可以将 $\\partial F_{r}/\\partial \\Pr_{r}$ 保留为符号形式。然后，根据推导出的结构，简要解释哪些索引对 $(k,j)$ 可以产生非零的雅可比矩阵项，以及与普通机理相比，第三体效率 $\\alpha_{ir}$ 和压力衰减反应如何改变稀疏性。\n\n以一个单一的封闭形式解析表达式提供 $\\partial \\dot{\\omega}_{k}/\\partial C_{j}$ 的最终结果，该表达式用 $\\nu_{ir}^{\\prime}$、$\\nu_{ir}^{\\prime\\prime}$、$\\nu_{ir}$、$k_{f,r}(T)$、$k_{0,r}(T)$、$k_{\\infty,r}(T)$、$K_{c,r}(T)$、$F_{r}(\\Pr_{r},T)$、$\\partial F_{r}/\\partial \\Pr_{r}$、$\\alpha_{ir}$ 和 $C_{i}$ 表示。不需要进行数值计算，也不需要四舍五入。最终答案必须是单一的解析表达式。", "solution": "目标是为一个均匀、等温、等容的反应体系推导物种雅可比矩阵项 $\\frac{\\partial \\dot{\\omega}_{k}}{\\partial C_{j}}$ 的解析表达式，其中 $\\dot{\\omega}_{k}$ 是物种 $k$ 的摩尔生成速率，$C_{j}$ 是物种 $j$ 的摩尔浓度。推导过程必须考虑普通反应、第三体反应以及压力依赖的压力衰减反应。\n\n物种 $k$ 的摩尔生成速率由下式给出\n$$\n\\dot{\\omega}_{k} = \\sum_{r=1}^{N_{r}} \\nu_{kr}\\, q_{r}\n$$\n其中 $\\nu_{kr}$ 是物种 $k$ 在反应 $r$ 中的净化学计量系数，$q_{r}$ 是反应 $r$ 的进程速率。对 $C_{j}$ 的导数通过对该求和进行逐项微分得到：\n$$\n\\frac{\\partial \\dot{\\omega}_{k}}{\\partial C_{j}} = \\sum_{r=1}^{N_{r}} \\nu_{kr} \\frac{\\partial q_{r}}{\\partial C_{j}}\n$$\n进程速率 $q_{r}$ 是正向和逆向速率之差，$q_{r} = R_{r}^{+} - R_{r}^{-}$。因此，其导数为：\n$$\n\\frac{\\partial q_{r}}{\\partial C_{j}} = \\frac{\\partial R_{r}^{+}}{\\partial C_{j}} - \\frac{\\partial R_{r}^{-}}{\\partial C_{j}}\n$$\n正向和逆向速率由质量作用动力学给出：\n$$\nR_{r}^{+} = k_{f,r}^{*}(T,C)\\,\\prod_{i=1}^{N_{s}} C_{i}^{\\nu_{ir}^{\\prime}} \\quad \\text{和} \\quad R_{r}^{-} = k_{r,r}^{*}(T,C)\\,\\prod_{i=1}^{N_{s}} C_{i}^{\\nu_{ir}^{\\prime\\prime}}\n$$\n利用细致平衡原理，$k_{r,r}^{*} = k_{f,r}^{*} / K_{c,r}(T)$，逆向速率为 $R_{r}^{-} = \\frac{k_{f,r}^{*}(T,C)}{K_{c,r}(T)}\\,\\prod_{i=1}^{N_{s}} C_{i}^{\\nu_{ir}^{\\prime\\prime}}$。由于温度 $T$ 是固定的，平衡常数 $K_{c,r}(T)$ 相对于浓度变化是常数。\n\n应用乘法法则对 $R_{r}^{+}$ 关于 $C_{j}$ 进行微分：\n$$\n\\frac{\\partial R_{r}^{+}}{\\partial C_{j}} = \\left(\\frac{\\partial k_{f,r}^{*}}{\\partial C_{j}}\\right) \\left(\\prod_{i=1}^{N_{s}} C_{i}^{\\nu_{ir}^{\\prime}}\\right) + k_{f,r}^{*} \\left(\\frac{\\partial}{\\partial C_{j}}\\prod_{i=1}^{N_{s}} C_{i}^{\\nu_{ir}^{\\prime}}\\right)\n$$\n浓度乘积项的导数为：\n$$\n\\frac{\\partial}{\\partial C_{j}}\\prod_{i=1}^{N_{s}} C_{i}^{\\nu_{ir}^{\\prime}} = \\frac{\\nu_{jr}^{\\prime}}{C_{j}} \\prod_{i=1}^{N_{s}} C_{i}^{\\nu_{ir}^{\\prime}}\n$$\n这里假设 $C_j  0$。将其代回得到：\n$$\n\\frac{\\partial R_{r}^{+}}{\\partial C_{j}} = \\frac{\\partial k_{f,r}^{*}}{\\partial C_{j}} \\frac{R_{r}^{+}}{k_{f,r}^{*}} + k_{f,r}^{*} \\frac{\\nu_{jr}^{\\prime}}{C_{j}} \\frac{R_{r}^{+}}{k_{f,r}^{*}} = \\left( \\frac{1}{k_{f,r}^{*}}\\frac{\\partial k_{f,r}^{*}}{\\partial C_{j}} + \\frac{\\nu_{jr}^{\\prime}}{C_{j}} \\right) R_{r}^{+}\n$$\n类似地，对于逆向速率 $R_{r}^{-}$：\n$$\n\\frac{\\partial R_{r}^{-}}{\\partial C_{j}} = \\left( \\frac{1}{k_{f,r}^{*}}\\frac{\\partial k_{f,r}^{*}}{\\partial C_{j}} + \\frac{\\nu_{jr}^{\\prime\\prime}}{C_{j}} \\right) R_{r}^{-}\n$$\n结合这些结果，得到进程速率的导数：\n$$\n\\frac{\\partial q_{r}}{\\partial C_{j}} = \\left( \\frac{1}{k_{f,r}^{*}}\\frac{\\partial k_{f,r}^{*}}{\\partial C_{j}} + \\frac{\\nu_{jr}^{\\prime}}{C_{j}} \\right) R_{r}^{+} - \\left( \\frac{1}{k_{f,r}^{*}}\\frac{\\partial k_{f,r}^{*}}{\\partial C_{j}} + \\frac{\\nu_{jr}^{\\prime\\prime}}{C_{j}} \\right) R_{r}^{-}\n$$\n整理各项可得：\n$$\n\\frac{\\partial q_{r}}{\\partial C_{j}} = \\frac{1}{k_{f,r}^{*}}\\frac{\\partial k_{f,r}^{*}}{\\partial C_{j}}(R_{r}^{+} - R_{r}^{-}) + \\frac{1}{C_{j}}(\\nu_{jr}^{\\prime}R_{r}^{+} - \\nu_{jr}^{\\prime\\prime}R_{r}^{-}) = \\frac{q_r}{k_{f,r}^{*}}\\frac{\\partial k_{f,r}^{*}}{\\partial C_{j}} + \\frac{1}{C_{j}}(\\nu_{jr}^{\\prime}R_{r}^{+} - \\nu_{jr}^{\\prime\\prime}R_{r}^{-})\n$$\n剩下的任务是推导 $\\frac{\\partial k_{f,r}^{*}}{\\partial C_{j}}$。速率系数 $k_{f,r}^{*}$ 仅通过有效碰撞物浓度 $[M]_{r} = \\sum_{i=1}^{N_{s}} \\alpha_{ir}\\, C_{i}$ 依赖于浓度。使用链式法则：\n$$\n\\frac{\\partial k_{f,r}^{*}}{\\partial C_{j}} = \\frac{\\partial k_{f,r}^{*}}{\\partial [M]_{r}} \\frac{\\partial [M]_{r}}{\\partial C_{j}}\n$$\n$[M]_r$ 对 $C_j$ 的导数就是第三体效率 $\\alpha_{jr}$：\n$$\n\\frac{\\partial [M]_{r}}{\\partial C_{j}} = \\frac{\\partial}{\\partial C_{j}} \\sum_{i=1}^{N_s} \\alpha_{ir} C_i = \\alpha_{jr}\n$$\n导数 $\\frac{\\partial k_{f,r}^{*}}{\\partial [M]_{r}}$ 取决于反应类型：\n1. 对于普通反应 ($\\chi_{r}^{\\mathrm{ord}}=1$)，$k_{f,r}^{*} = k_{f,r}(T)$，它相对于 $[M]_r$ 是常数。因此，$\\frac{\\partial k_{f,r}^{*}}{\\partial [M]_{r}} = 0$。\n2. 对于第三体反应 ($\\chi_{r}^{\\mathrm{TB}}=1$)，$k_{f,r}^{*} = k_{f,r}(T)\\,[M]_{r}$。因此，$\\frac{\\partial k_{f,r}^{*}}{\\partial [M]_{r}} = k_{f,r}(T)$。\n3. 对于压力衰减反应 ($\\chi_{r}^{\\mathrm{FO}}=1$)，$k_{f,r}^{*} = k_{\\infty,r}(T)\\;F_{r}(\\Pr_{r},T)\\;\\frac{\\Pr_{r}}{1+\\Pr_{r}}$，其中折合压力为 $\\Pr_{r} = \\frac{k_{0,r}(T)\\,[M]_{r}}{k_{\\infty,r}(T)}$。我们再次应用链式法则：$\\frac{\\partial k_{f,r}^{*}}{\\partial [M]_{r}} = \\frac{\\partial k_{f,r}^{*}}{\\partial \\Pr_{r}}\\frac{\\partial \\Pr_{r}}{\\partial [M]_{r}}$。\n    首先，$\\frac{\\partial \\Pr_{r}}{\\partial [M]_{r}} = \\frac{k_{0,r}}{k_{\\infty,r}}$。\n    接下来，对 $k_{f,r}^{*}(\\Pr_r)$ 使用乘法法则：\n    $$\n    \\frac{\\partial k_{f,r}^{*}}{\\partial \\Pr_{r}} = \\frac{\\partial}{\\partial \\Pr_{r}} \\left( k_{\\infty,r} F_r \\frac{\\Pr_r}{1+\\Pr_r} \\right) = k_{\\infty,r} \\left[ \\frac{\\partial F_r}{\\partial \\Pr_r} \\frac{\\Pr_r}{1+\\Pr_r} + F_r \\frac{\\partial}{\\partial \\Pr_r}\\left(\\frac{\\Pr_r}{1+\\Pr_r}\\right)\\right]\n    $$\n    Lindemann-Hinshelwood 因子的导数为 $\\frac{\\partial}{\\partial \\Pr_r}(\\frac{\\Pr_r}{1+\\Pr_r}) = \\frac{1}{(1+\\Pr_r)^2}$。\n    代入此式可得：\n    $$\n    \\frac{\\partial k_{f,r}^{*}}{\\partial \\Pr_{r}} = k_{\\infty,r} \\left[ \\frac{\\partial F_r}{\\partial \\Pr_r} \\frac{\\Pr_r}{1+\\Pr_r} + \\frac{F_r}{(1+\\Pr_r)^2} \\right]\n    $$\n    所以，对于压力衰减反应：\n    $$\n    \\frac{\\partial k_{f,r}^{*}}{\\partial [M]_{r}} = \\left( k_{\\infty,r} \\left[ \\frac{\\partial F_r}{\\partial \\Pr_r} \\frac{\\Pr_r}{1+\\Pr_r} + \\frac{F_r}{(1+\\Pr_r)^2} \\right] \\right) \\left( \\frac{k_{0,r}}{k_{\\infty,r}} \\right) = k_{0,r} \\left[ \\frac{\\partial F_r}{\\partial \\Pr_r} \\frac{\\Pr_r}{1+\\Pr_r} + \\frac{F_r}{(1+\\Pr_r)^2} \\right]\n    $$\n使用指示函数合并这些情况：\n$$\n\\frac{\\partial k_{f,r}^{*}}{\\partial C_{j}} = \\alpha_{jr} \\left( \\chi_{r}^{\\mathrm{TB}} k_{f,r} + \\chi_{r}^{\\mathrm{FO}} k_{0,r} \\left[ \\frac{\\partial F_r}{\\partial \\Pr_r} \\frac{\\Pr_r}{1+\\Pr_r} + \\frac{F_r}{(1+\\Pr_r)^2} \\right] \\right)\n$$\n将所有表达式代回到 $\\frac{\\partial \\dot{\\omega}_{k}}{\\partial C_{j}}$ 的方程中，并用基本量表示 $R_r^{\\pm}$ 和 $q_r$，我们得到了雅可比矩阵项的最终解析形式。\n\n推导出的雅可比矩阵的结构揭示了物种之间的耦合关系。如果存在至少一个反应 $r$ 产生依赖关系，则雅可比矩阵项 $\\frac{\\partial \\dot{\\omega}_{k}}{\\partial C_{j}}$ 为非零。\n如果物种 $k$ 参与反应 $r$（即 $\\nu_{kr} \\neq 0$），并且满足以下任一条件，则该反应会贡献一个非零项：\n1. 物种 $j$ 作为反应物或产物参与反应 $r$（即 $\\nu_{jr}' \\neq 0$ 或 $\\nu_{jr}'' \\neq 0$）。这是标准的“直接”耦合。\n2. 反应 $r$ 是第三体或压力衰减反应，且物种 $j$ 作为具有非零效率的第三体碰撞物（即 $\\alpha_{jr} \\neq 0$）。这是“间接”耦合。\n\n在仅包含普通反应的机理中，雅可比矩阵是稀疏的。仅当物种 $k$ 和 $j$ 出现在同一反应中时，才会存在非零项 $\\frac{\\partial \\dot{\\omega}_{k}}{\\partial C_{j}}$。第三体和压力衰减反应的引入显著降低了这种稀疏性。如果物种 $j$ 对于反应 $r$ 具有非零的第三体效率 $\\alpha_{jr}$（通常情况下，默认 $\\alpha_{jr}=1$），它会在物种 $j$ 和参与反应 $r$ 的每个物种 $k$ 之间建立耦合，即使 $j$ 不是反应物或产物。这意味着单个第三体反应可以为许多 $(k,j)$ 对创建非零项，可能使雅可比矩阵的行变得稠密，从而增加求解系统的计算成本。\n\n雅可比矩阵项的完整解析表达式如下所示。", "answer": "$$\n\\boxed{\\frac{\\partial \\dot{\\omega}_{k}}{\\partial C_{j}} = \\sum_{r=1}^{N_{r}} \\nu_{kr} \\left\\{ \\begin{array}{l} \\frac{1}{C_j} \\left( \\chi_{r}^{\\mathrm{ord}}k_{f,r} + \\chi_{r}^{\\mathrm{TB}}k_{f,r}\\sum_{i=1}^{N_s}\\alpha_{ir}C_i + \\chi_{r}^{\\mathrm{FO}}k_{\\infty,r}F_r\\frac{\\Pr_r}{1+\\Pr_r} \\right) \\left( \\nu_{jr}^{\\prime} \\prod_{i=1}^{N_s} C_i^{\\nu_{ir}^{\\prime}} - \\frac{\\nu_{jr}^{\\prime\\prime}}{K_{c,r}} \\prod_{i=1}^{N_s} C_i^{\\nu_{ir}^{\\prime\\prime}} \\right) \\\\ + \\alpha_{jr} \\left( \\prod_{i=1}^{N_s} C_i^{\\nu_{ir}^{\\prime}} - \\frac{1}{K_{c,r}} \\prod_{i=1}^{N_s} C_i^{\\nu_{ir}^{\\prime\\prime}} \\right) \\left( \\chi_{r}^{\\mathrm{TB}}k_{f,r} + \\chi_{r}^{\\mathrm{FO}}k_{0,r} \\left[ \\frac{\\partial F_r}{\\partial \\Pr_r}\\frac{\\Pr_r}{1+\\Pr_r} + \\frac{F_r}{(1+\\Pr_r)^2} \\right] \\right) \\end{array} \\right\\}}\n$$", "id": "3356493"}, {"introduction": "从理论推导到实际编码，确保数值模型的物理一致性是关键一步。一个稳健的反应流求解器，无论其内部选择何种热力学状态变量，例如使用焓-温（$h-T$）对还是内能-温（$e-T$）对，都应产生相同的物理结果。这项动手编码实践 [@problem_id:3356511] 要求您实现并比较这两种公式，通过模拟验证它们确实是一致的，并且能正确守恒总焓。该练习在模型实现、验证和确认方面提供了宝贵的经验。", "problem": "考虑一个在有限速率化学作用下演化的均质、零维、绝热的反应理想气体混合物，其控制框架可以存储和推进显焓-温度对（$h$–$T$）或显内能-温度对（$e$–$T$）。无论存储何种热力学变量集，物理模型都必须保持一致，任何差异都应仅源于所用热力学关系的代数形式，而非物理学的改变。任务是通过受控重启，在模拟中途从 $h$–$T$ 公式切换到 $e$–$T$ 公式时，测试其一致性和守恒性。\n\n推导和建模的基本依据：\n- 该混合物为恒压、均质、绝热的理想气体。\n- 组分反应遵循有限速率化学（FRC），包含一个单一的不可逆反应 $A \\rightarrow B$ 和 Arrhenius 动力学 $k(T) = A \\exp\\left(-\\frac{E}{R_u T}\\right)$。\n- 组分质量分数 $Y_A$ 和 $Y_B$ 满足守恒关系，$dY_A/dt = -\\omega$ 和 $dY_B/dt = +\\omega$，其中 $\\omega = k(T) Y_A$。\n- 显热力学函数使用恒定的组分比定压热容 $c_{p,A}$ 和 $c_{p,B}$（单位为 $\\mathrm{J}/(\\mathrm{kg}\\cdot\\mathrm{K})$）。显焓为 $h_\\text{sensible}(T,Y) = \\sum_k Y_k c_{p,k} T$，显内能为 $e_\\text{sensible}(T,Y) = \\sum_k Y_k c_{v,k} T$，其中 $c_{v,k} = c_{p,k} - R_k$ 且 $R_k = \\frac{R_u}{W_k}$，$W_k$ 是摩尔质量（单位为 $\\mathrm{kg}/\\mathrm{mol}$），$R_u$ 是普适气体常数（单位为 $\\mathrm{J}/(\\mathrm{mol}\\cdot\\mathrm{K})$）。\n- 每单位质量的组分 $A$ 被消耗所释放的热量为一个常数 $Q$（单位为 $\\mathrm{J}/\\mathrm{kg}$）。在绝热恒压条件下，物理守恒量是显焓与以 $H_\\text{total}(t) = h_\\text{sensible}(t) + Q Y_A(t)$ 形式表示的 $A$ 的剩余化学能储备之和。\n\n您必须：\n1. 从基本原理出发，推导出一个在 $h$–$T$ 和 $e$–$T$ 公式中均可使用的一致的温度演化方程，该方程为理想气体、恒压、绝热反应器保持了相同的物理特性。确保这些公式对于理想气体在代数上是等价的，并且仅在变量集表示上有所不同。\n2. 实现一个程序，为每个测试用例执行两次模拟：\n   - 一次参考运行，使用 $h$–$T$ 公式从 $t=0$ 到 $t=t_f$。\n   - 一次受控重启运行：使用 $h$–$T$ 公式从 $t=0$ 积分到 $t=t_\\text{switch}$，然后在 $t=t_\\text{switch}$ 处重启，并使用 $e$–$T$ 公式继续积分到 $t=t_f$。\n3. 为每个测试用例计算两个度量指标：\n   - 一个一致性度量，定义为参考运行的最终状态与受控重启运行的最终状态之间的最大相对差异，该差异取自 $T$、$Y_A$ 和 $Y_B$。对于温度，使用 $\\frac{|T_\\text{ref} - T_\\text{restart}|}{\\max(1, |T_\\text{ref}|)}$；对于组分质量分数，使用绝对差异，因为它们是无量纲的。通过取三者中的最大值，得出一个单一的无量纲浮点数。\n   - 一个守恒性度量，定义为在整个受控重启轨迹（两个阶段）中，$H_\\text{total}(t)$ 相对于其初始值 $H_\\text{total}(0)$ 的最大相对偏差，即 $\\max_t \\frac{|H_\\text{total}(t) - H_\\text{total}(0)|}{|H_\\text{total}(0)|}$，这是一个无量纲浮点数。\n\n物理常数和单位：\n- 使用 $R_u = 8.314462618$ $\\mathrm{J}/(\\mathrm{mol}\\cdot\\mathrm{K})$。\n- 所有温度必须以开尔文（Kelvin）为单位。\n- 所有热容 $c_{p,k}$ 必须以 $\\mathrm{J}/(\\mathrm{kg}\\cdot\\mathrm{K})$ 为单位。\n- 所有摩尔质量 $W_k$ 必须以 $\\mathrm{kg}/\\mathrm{mol}$ 为单位。\n- 所有指前因子 $A$ 必须以 $\\mathrm{s}^{-1}$ 为单位，活化能 $E$ 必须以 $\\mathrm{J}/\\mathrm{mol}$ 为单位，热释放 $Q$ 必须以 $\\mathrm{J}/\\mathrm{kg}$ 为单位。\n- 时间必须以秒为单位。\n\n测试套件：\n提供以下五个测试用例。每个用例指定了 $(W_A, W_B, c_{p,A}, c_{p,B}, A, E, Q, Y_A(0), Y_B(0), T(0), t_f, t_\\text{switch})$ 的单位和值：\n- 用例 1（正常路径，显著的热释放和混合效应）：\n  - $W_A = 2.8 \\times 10^{-2}$ $\\mathrm{kg}/\\mathrm{mol}$, $W_B = 3.2 \\times 10^{-2}$ $\\mathrm{kg}/\\mathrm{mol}$,\n  - $c_{p,A} = 1000$ $\\mathrm{J}/(\\mathrm{kg}\\cdot\\mathrm{K})$, $c_{p,B} = 1400$ $\\mathrm{J}/(\\mathrm{kg}\\cdot\\mathrm{K})$,\n  - $A = 1.0 \\times 10^{7}$ $\\mathrm{s}^{-1}$, $E = 1.2 \\times 10^{5}$ $\\mathrm{J}/\\mathrm{mol}$, $Q = 8.0 \\times 10^{5}$ $\\mathrm{J}/\\mathrm{kg}$,\n  - $Y_A(0) = 0.7$, $Y_B(0) = 0.3$, $T(0) = 1100$ $\\mathrm{K}$,\n  - $t_f = 5.0 \\times 10^{-2}$ $\\mathrm{s}$, $t_\\text{switch} = 2.5 \\times 10^{-2}$ $\\mathrm{s}$。\n- 用例 2（边缘情况，零热释放）：\n  - 与用例 1 相同，除了 $Q = 0$ $\\mathrm{J}/\\mathrm{kg}$。\n- 用例 3（边缘情况，由于非常高的活化能垒导致反应可忽略不计）：\n  - $W_A = 2.8 \\times 10^{-2}$ $\\mathrm{kg}/\\mathrm{mol}$, $W_B = 3.2 \\times 10^{-2}$ $\\mathrm{kg}/\\mathrm{mol}$,\n  - $c_{p,A} = 900$ $\\mathrm{J}/(\\mathrm{kg}\\cdot\\mathrm{K})$, $c_{p,B} = 1500$ $\\mathrm{J}/(\\mathrm{kg}\\cdot\\mathrm{K})$,\n  - $A = 1.0 \\times 10^{12}$ $\\mathrm{s}^{-1}$, $E = 3.0 \\times 10^{5}$ $\\mathrm{J}/\\mathrm{mol}$, $Q = 5.0 \\times 10^{5}$ $\\mathrm{J}/\\mathrm{kg}$,\n  - $Y_A(0) = 0.6$, $Y_B(0) = 0.4$, $T(0) = 900$ $\\mathrm{K}$,\n  - $t_f = 1.0 \\times 10^{-1}$ $\\mathrm{s}$, $t_\\text{switch} = 5.0 \\times 10^{-2}$ $\\mathrm{s}$。\n- 用例 4（边界情况，相等的热容和较晚的切换）：\n  - $W_A = 2.8 \\times 10^{-2}$ $\\mathrm{kg}/\\mathrm{mol}$, $W_B = 3.2 \\times 10^{-2}$ $\\mathrm{kg}/\\mathrm{mol}$,\n  - $c_{p,A} = 1200$ $\\mathrm{J}/(\\mathrm{kg}\\cdot\\mathrm{K})$, $c_{p,B} = 1200$ $\\mathrm{J}/(\\mathrm{kg}\\cdot\\mathrm{K})$,\n  - $A = 5.0 \\times 10^{6}$ $\\mathrm{s}^{-1}$, $E = 1.0 \\times 10^{5}$ $\\mathrm{J}/\\mathrm{mol}$, $Q = 6.0 \\times 10^{5}$ $\\mathrm{J}/\\mathrm{kg}$,\n  - $Y_A(0) = 0.9$, $Y_B(0) = 0.1$, $T(0) = 1000$ $\\mathrm{K}$,\n  - $t_f = 2.0 \\times 10^{-2}$ $\\mathrm{s}$, $t_\\text{switch} = 1.9 \\times 10^{-2}$ $\\mathrm{s}$。\n- 用例 5（边界情况，立即切换和快速反应）：\n  - $W_A = 2.8 \\times 10^{-2}$ $\\mathrm{kg}/\\mathrm{mol}$, $W_B = 3.2 \\times 10^{-2}$ $\\mathrm{kg}/\\mathrm{mol}$,\n  - $c_{p,A} = 1300$ $\\mathrm{J}/(\\mathrm{kg}\\cdot\\mathrm{K})$, $c_{p,B} = 1000$ $\\mathrm{J}/(\\mathrm{kg}\\cdot\\mathrm{K})$,\n  - $A = 1.0 \\times 10^{8}$ $\\mathrm{s}^{-1}$, $E = 9.0 \\times 10^{4}$ $\\mathrm{J}/\\mathrm{mol}$, $Q = 1.0 \\times 10^{6}$ $\\mathrm{J}/\\mathrm{kg}$,\n  - $Y_A(0) = 0.95$, $Y_B(0) = 0.05$, $T(0) = 1200$ $\\mathrm{K}$,\n  - $t_f = 1.0 \\times 10^{-4}$ $\\mathrm{s}$, $t_\\text{switch} = 0$ $\\mathrm{s}$。\n\n最终输出格式：\n您的程序应生成单行输出，包含一个逗号分隔的列表，其中有五个元素。每个元素是一个双浮点数列表 $[d_i, c_i]$，其中 $d_i$ 是一致性度量，$c_i$ 是第 $i$ 个（从 1 到 5）测试用例的守恒性度量。例如：[[d1,c1],[d2,c2],[d3,c3],[d4,c4],[d5,c5]]。所有报告的值必须是无量纲浮点数。", "solution": "用户提供的问题陈述已经过分析，并被确定为**有效**。它在科学上是合理的、适定的、客观的和自洽的，提出了一个计算化学动力学和热力学中的标准问题。唯一解所需的所有必要数据和条件均已提供。\n\n### 1. 温度演化方程的推导\n\n支配均质、绝热、恒压反应系统的基本物理原理是总比焓 $H_\\text{total}$ 的守恒。问题将这个守恒量定义为显焓 $h_\\text{sensible}$ 和与反应物 $A$ 相关的化学能之和：\n$$H_\\text{total}(t) = h_\\text{sensible}(t) + Q Y_A(t) = \\text{常数}$$\n其中 $Q$ 是每单位质量的 $A$ 反应所释放的热量，$Y_A(t)$ 是组分 $A$ 的质量分数。\n\n对这个守恒定律关于时间 $t$ 求导，得到：\n$$\\frac{d H_\\text{total}}{dt} = \\frac{d h_\\text{sensible}}{dt} + Q \\frac{d Y_A}{dt} = 0$$\n组分 $A$ 质量分数的变化率由 $dY_A/dt = -\\omega$ 给出，其中 $\\omega$ 是反应速率。将此代入方程，得到显焓的演化：\n$$\\frac{d h_\\text{sensible}}{dt} = -Q(-\\omega) = Q\\omega$$\n该方程是该系统热力学第一定律的直接推论。\n\n理想气体混合物的显焓定义为 $h_\\text{sensible} = \\sum_k Y_k c_{p,k} T$，其中 $Y_k$ 是组分 $k$ 的质量分数，$c_{p,k}$ 是其比定压热容，$T$ 是温度。对于双组分系统 $A \\rightarrow B$，这表示为：\n$$h_\\text{sensible} = (Y_A c_{p,A} + Y_B c_{p,B})T = c_p(Y)T$$\n其中 $c_p(Y)$ 是混合物平均比热。\n\n使用乘法法则对 $h_\\text{sensible}$ 关于时间求导：\n$$\\frac{d h_\\text{sensible}}{dt} = c_p(Y) \\frac{dT}{dt} + T \\frac{d c_p(Y)}{dt}$$\n混合物热容的导数为：\n$$\\frac{d c_p(Y)}{dt} = c_{p,A} \\frac{dY_A}{dt} + c_{p,B} \\frac{dY_B}{dt} = c_{p,A}(-\\omega) + c_{p,B}(\\omega) = \\omega(c_{p,B} - c_{p,A})$$\n将此代回，得到：\n$$\\frac{d h_\\text{sensible}}{dt} = c_p(Y) \\frac{dT}{dt} + T\\omega(c_{p,B} - c_{p,A})$$\n通过令 $d h_\\text{sensible}/dt$ 的两个表达式相等，我们发现：\n$$Q\\omega = c_p(Y) \\frac{dT}{dt} + T\\omega(c_{p,B} - c_{p,A})$$\n求解 $dT/dt$，我们得到温度演化的控制方程：\n$$\\frac{dT}{dt} = \\frac{\\omega [Q - T(c_{p,B} - c_{p,A})]}{c_p(Y)} = \\frac{\\omega [Q - T(c_{p,B} - c_{p,A})]}{Y_A c_{p,A} + Y_B c_{p,B}}$$\n这个方程是从基于焓（$h$-$T$）的角度推导出来的。\n\n为了证明一致性，我们现在从基于内能（$e$-$T$）的角度推导相同的方程。显内能为 $e_\\text{sensible} = \\sum_k Y_k c_{v,k} T = c_v(Y)T$，其中 $c_{v,k} = c_{p,k} - R_k$ 是比定容热容，$R_k = R_u/W_k$ 是比气体常数。\n\n理想气体混合物的显焓和显内能之间的关系是 $h_\\text{sensible} = e_\\text{sensible} + RT$，其中 $R = \\sum_k Y_k R_k$。\n对这个关系求导：\n$$\\frac{de_\\text{sensible}}{dt} = \\frac{dh_\\text{sensible}}{dt} - \\frac{d(RT)}{dt}$$\n我们已经知道 $dh_\\text{sensible}/dt = Q\\omega$。我们展开右边的第二项：\n$$\\frac{d(RT)}{dt} = R(Y)\\frac{dT}{dt} + T\\frac{dR(Y)}{dt} = R(Y)\\frac{dT}{dt} + T\\omega(R_B - R_A)$$\n因此，我们得到显内能变化率的表达式：\n$$\\frac{de_\\text{sensible}}{dt} = Q\\omega - \\left[ R(Y)\\frac{dT}{dt} + T\\omega(R_B - R_A) \\right]$$\n现在，我们直接对 $e_\\text{sensible} = c_v(Y)T$ 求导：\n$$\\frac{de_\\text{sensible}}{dt} = c_v(Y)\\frac{dT}{dt} + T\\frac{dc_v(Y)}{dt} = c_v(Y)\\frac{dT}{dt} + T\\omega(c_{v,B} - c_{v,A})$$\n令 $de_\\text{sensible}/dt$ 的两个表达式相等：\n$$c_v(Y)\\frac{dT}{dt} + T\\omega(c_{v,B} - c_{v,A}) = Q\\omega - R(Y)\\frac{dT}{dt} - T\\omega(R_B - R_A)$$\n合并 $dT/dt$ 项：\n$$(c_v(Y) + R(Y))\\frac{dT}{dt} = Q\\omega - T\\omega[(c_{v,B} - c_{v,A}) + (R_B - R_A)]$$\n使用理想气体关系 $c_p(Y) = c_v(Y) + R(Y)$ 和 $c_{p,k} = c_{v,k} + R_k$，方程简化为：\n$$c_p(Y)\\frac{dT}{dt} = Q\\omega - T\\omega(c_{p,B} - c_{p,A})$$\n这得到了与从 $h$-$T$ 公式推导出的完全相同的温度演化方程。这证实了底层的物理学与热力学变量的选择无关，并且任一公式的一致实现都必须对原始变量 $(Y_k, T)$ 产生相同的结果。\n\n### 2. 数值实现与模拟策略\n\n基于以上推导，我们可以构建两个不同但物理上等效的数值方案。区别在于随时间积分的状态变量。\n\n**h-T 公式：**\n状态向量为 $\\vec{u}_h = [Y_A, h_\\text{sensible}]$。常微分方程组（ODEs）为：\n$$\\frac{dY_A}{dt} = -\\omega$$\n$$\\frac{dh_\\text{sensible}}{dt} = Q\\omega$$\n在积分的每一步，评估反应速率 $\\omega = A \\exp(-E/R_u T) Y_A$ 所需的温度 $T$ 通过代数方法恢复：\n$$T = \\frac{h_\\text{sensible}}{Y_A c_{p,A} + (1-Y_A)c_{p,B}}$$\n\n**e-T 公式：**\n状态向量为 $\\vec{u}_e = [Y_A, e_\\text{sensible}]$。$Y_A$ 的常微分方程相同。$e_\\text{sensible}$ 的常微分方程从其定义 $e_\\text{sensible} = c_v(Y)T$ 推导：\n$$\\frac{de_\\text{sensible}}{dt} = c_v(Y)\\frac{dT}{dt} + T\\frac{dc_v(Y)}{dt} = c_v(Y)\\frac{dT}{dt} + T\\omega(c_{v,B} - c_{v,A})$$\n这里的 $dT/dt$ 是先前推导出的唯一的、物理上正确的演化方程。温度 $T$ 从以下公式恢复：\n$$T = \\frac{e_\\text{sensible}}{Y_A c_{v,A} + (1-Y_A)c_{v,B}}$$\n\n**模拟流程：**\n对于每个测试用例，使用数值常微分方程求解器（`scipy.integrate.solve_ivp`）执行两次模拟：\n1.  **参考运行：** 使用 $h$-$T$ 公式从 $t=0$到 $t=t_f$ 积分状态 $\\vec{u}_h$。\n2.  **受控重启运行：**\n    - 从 $t=0$到 $t=t_\\text{switch}$，使用 $h$-$T$ 公式积分 $\\vec{u}_h$。\n    - 在 $t=t_\\text{switch}$ 时，转换状态。从最终状态 $[Y_A(t_\\text{switch}), h_\\text{sensible}(t_\\text{switch})]$ 计算温度 $T(t_\\text{switch})$。然后，计算相应的显内能 $e_\\text{sensible}(t_\\text{switch})$。\n    - 从 $t=t_\\text{switch}$ 到 $t=t_f$，使用 $e$-$T$ 公式，从转换后的状态开始积分状态 $\\vec{u}_e = [Y_A, e_\\text{sensible}]$。\n\n### 3. 度量计算\n\n-   **一致性度量 ($d$)：** 在两次运行都在 $t=t_f$ 完成后，比较最终的原始变量（$T$、$Y_A$、$Y_B$）。度量 $d$ 是温度的相对误差和质量分数的绝对误差中的最大值。小的、非零的值反映了浮点和积分误差的累积，这在两种公式之间可能略有不同。\n-   **守恒性度量 ($c$)：** 对于受控重启运行，在整个轨迹 $[0, t_f]$ 上的多个点计算总焓 $H_\\text{total}(t) = h_\\text{sensible}(t) + Q Y_A(t)$。对于模拟的第二段（$t  t_\\text{switch}$），这需要将积分的状态变量 $e_\\text{sensible}(t)$ 转换回 $h_\\text{sensible}(t)$。度量 $c$ 是 $H_\\text{total}(t)$ 相对于其初始值 $H_\\text{total}(0)$ 的最大相对偏差。这衡量了数值方案在多大程度上保持了基本守恒量。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the results.\n    \"\"\"\n    R_u = 8.314462618  # J/(mol.K)\n\n    test_cases = [\n        # Case 1: happy path\n        (2.8e-2, 3.2e-2, 1000.0, 1400.0, 1.0e7, 1.2e5, 8.0e5, 0.7, 0.3, 1100.0, 5.0e-2, 2.5e-2),\n        # Case 2: zero heat release\n        (2.8e-2, 3.2e-2, 1000.0, 1400.0, 1.0e7, 1.2e5, 0.0, 0.7, 0.3, 1100.0, 5.0e-2, 2.5e-2),\n        # Case 3: negligible reaction\n        (2.8e-2, 3.2e-2, 900.0, 1500.0, 1.0e12, 3.0e5, 5.0e5, 0.6, 0.4, 900.0, 1.0e-1, 5.0e-2),\n        # Case 4: equal heat capacities\n        (2.8e-2, 3.2e-2, 1200.0, 1200.0, 5.0e6, 1.0e5, 6.0e5, 0.9, 0.1, 1000.0, 2.0e-2, 1.9e-2),\n        # Case 5: immediate switch\n        (2.8e-2, 3.2e-2, 1300.0, 1000.0, 1.0e8, 9.0e4, 1.0e6, 0.95, 0.05, 1200.0, 1.0e-4, 0.0),\n    ]\n\n    results = []\n    for params in test_cases:\n        metrics = _run_one_case(params, R_u)\n        results.append(metrics)\n    \n    # Format the final output string as specified.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef _run_one_case(params, R_u):\n    \"\"\"\n    Runs a single test case with both reference and restart simulations and computes metrics.\n    \"\"\"\n    Wa, Wb, cpa, cpb, A, E, Q, Ya0, Yb0, T0, tf, t_switch = params\n\n    Ra = R_u / Wa\n    Rb = R_u / Wb\n    cva = cpa - Ra\n    cvb = cpb - Rb\n    \n    # Pack parameters for ODE functions\n    ode_params = (A, E, Q, R_u, cpa, cpb, cva, cvb)\n\n    # --- ODE System Definitions ---\n\n    def ode_h_form(t, y, p):\n        A, E, Q, R_u, cpa, cpb, _,_ = p\n        Ya, h_sens = y\n        Yb = 1.0 - Ya\n        \n        cp_mix = Ya * cpa + Yb * cpb\n        if cp_mix == 0: return [0.0, 0.0]\n        T = h_sens / cp_mix\n        \n        # Avoid underflow/overflow with temperature bounds\n        if T  250: return [0.0, 0.0]\n        \n        k = A * np.exp(-E / (R_u * T))\n        omega = k * Ya\n        \n        dYa_dt = -omega\n        dh_dt = Q * omega\n        return [dYa_dt, dh_dt]\n\n    def ode_e_form(t, y, p):\n        A, E, Q, R_u, cpa, cpb, cva, cvb = p\n        Ya, e_sens = y\n        Yb = 1.0 - Ya\n\n        cv_mix = Ya * cva + Yb * cvb\n        if cv_mix == 0: return [0.0, 0.0]\n        T = e_sens / cv_mix\n        \n        if T  250: return [0.0, 0.0]\n\n        k = A * np.exp(-E / (R_u * T))\n        omega = k * Ya\n        dYa_dt = -omega\n        \n        # Calculate dT/dt from the consistent physical model\n        cp_mix = Ya * cpa + Yb * cpb\n        if cp_mix == 0:\n            dT_dt = 0.0\n        else:\n            dT_dt = (omega * (Q - T * (cpb - cpa))) / cp_mix\n        \n        # Calculate de/dt using chain rule: de/dt = d(cv*T)/dt\n        de_dt = cv_mix * dT_dt + T * omega * (cvb - cva)\n        \n        return [dYa_dt, de_dt]\n\n    # --- Simulation Runs ---\n    rtol, atol = 1e-12, 1e-15 # Use tight tolerances for high precision\n\n    # 1. Reference Run (h-formulation for the whole duration)\n    h_sens0 = (Ya0 * cpa + Yb0 * cpb) * T0\n    y0_h = [Ya0, h_sens0]\n    \n    sol_ref = solve_ivp(ode_h_form, [0, tf], y0_h, args=(ode_params,), dense_output=True, rtol=rtol, atol=atol)\n    \n    Ya_ref_f, h_sens_ref_f = sol_ref.y[:, -1]\n    Yb_ref_f = 1.0 - Ya_ref_f\n    cp_mix_ref_f = Ya_ref_f * cpa + Yb_ref_f * cpb\n    T_ref_f = h_sens_ref_f / cp_mix_ref_f\n\n    # 2. Controlled-Restart Run (h-form then e-form)\n    all_t_samples = []\n    all_H_total = []\n    H_total_0 = h_sens0 + Q * Ya0\n\n    # Part 1: Integrate with h-formulation until t_switch\n    if t_switch > 0:\n        sol1 = solve_ivp(ode_h_form, [0, t_switch], y0_h, args=(ode_params,), dense_output=True, rtol=rtol, atol=atol)\n        Ya_sw, h_sens_sw = sol1.y[:, -1]\n\n        # Sample for conservation check\n        t_samples1 = np.linspace(0, t_switch, 100, endpoint=False)\n        y_samples1 = sol1.sol(t_samples1)\n        H_total1 = y_samples1[1] + Q * y_samples1[0]\n        all_t_samples.append(t_samples1)\n        all_H_total.append(H_total1)\n    else: # Immediate switch\n        Ya_sw, h_sens_sw = Ya0, h_sens0\n\n    # State conversion for restart\n    Yb_sw = 1.0 - Ya_sw\n    cp_mix_sw = Ya_sw * cpa + Yb_sw * cpb\n    T_sw = h_sens_sw / cp_mix_sw\n    e_sens_sw = (Ya_sw * cva + Yb_sw * cvb) * T_sw\n    y0_e_restart = [Ya_sw, e_sens_sw]\n\n    # Part 2: Integrate with e-formulation from t_switch to tf\n    if t_switch  tf:\n        sol2 = solve_ivp(ode_e_form, [t_switch, tf], y0_e_restart, args=(ode_params,), dense_output=True, rtol=rtol, atol=atol)\n        Ya_res_f, e_sens_res_f = sol2.y[:, -1]\n        \n        # Sample for conservation check\n        t_samples2 = np.linspace(t_switch, tf, 101)\n        y_samples2 = sol2.sol(t_samples2)\n        Ya_at_t = y_samples2[0]\n        e_sens_at_t = y_samples2[1]\n        Yb_at_t = 1.0 - Ya_at_t\n        \n        cv_mix_at_t = (Ya_at_t * cva + Yb_at_t * cvb)\n        # handle division by zero\n        T_at_t = np.divide(e_sens_at_t, cv_mix_at_t, out=np.zeros_like(e_sens_at_t), where=cv_mix_at_t!=0)\n        h_sens_at_t = (Ya_at_t * cpa + Yb_at_t * cpb) * T_at_t\n        H_total2 = h_sens_at_t + Q * Ya_at_t\n        all_t_samples.append(t_samples2)\n        all_H_total.append(H_total2)\n\n    else: # Switch is at the end, final state is from Part 1\n        Ya_res_f, h_sens_res_f = Ya_sw, h_sens_sw\n        # Convert to e-framework variables to get T_res_f\n        cv_mix_res_f = Ya_res_f * cva + (1.0 - Ya_res_f) * cvb\n        # Correctly get T_res_f for final state comparison\n        Yb_res_f = 1.0 - Ya_res_f\n        cp_mix_res_f = Ya_res_f * cpa + Yb_res_f * cpb\n        T_res_f = h_sens_res_f / cp_mix_res_f\n    \n    # Final state of restart run in primitive variables\n    Yb_res_f = 1.0 - Ya_res_f\n    cv_mix_res_f = Ya_res_f * cva + Yb_res_f * cvb\n    if t_switch  tf:\n        T_res_f = e_sens_res_f / cv_mix_res_f\n    \n    # --- Metric Calculation ---\n\n    # 1. Consistency Metric\n    temp_err = np.abs(T_ref_f - T_res_f) / np.maximum(1.0, np.abs(T_ref_f))\n    ya_err = np.abs(Ya_ref_f - Ya_res_f)\n    yb_err = np.abs(Yb_ref_f - Yb_res_f)\n    consistency_metric = np.max([temp_err, ya_err, yb_err])\n\n    # 2. Conservation Metric\n    if not all_H_total:\n         conservation_metric = 0.0\n    else:\n        H_total_trajectory = np.concatenate(all_H_total)\n        if H_total_0 == 0:\n            if np.all(H_total_trajectory == 0):\n                conservation_metric = 0.0\n            else:\n                conservation_metric = np.inf\n        else:\n            conservation_metric = np.max(np.abs(H_total_trajectory - H_total_0) / np.abs(H_total_0))\n            \n    return [float(consistency_metric), float(conservation_metric)]\n\nif __name__ == '__main__':\n    solve()\n```", "id": "3356511"}]}