{"hands_on_practices": [{"introduction": "谱元法 (SEM) 的核心在于使用高阶多项式在特定节点上逼近解。本练习将通过在 Gauss–Lobatto–Legendre (GLL) 节点上使用拉格朗日多项式进行插值，帮助您动手实践这一基本概念。通过计算插值和分析误差，您将加深对谱元法如何表示物理场的理解。", "problem": "在参考区间 $[-1,1]$ 上的标量场的一维谱元离散化中，考虑使用高斯-洛巴托-勒让德 (GLL) 点进行 $N=4$ 次多项式插值。$N=4$ 时的 GLL 节点是区间的端点以及 4 次勒让德多项式导数的根，即\n$$x_{0}=-1,\\quad x_{1}=-\\sqrt{\\frac{3}{7}},\\quad x_{2}=0,\\quad x_{3}=\\sqrt{\\frac{3}{7}},\\quad x_{4}=1.$$\n假设这些节点上的节点数据（例如，守恒变量的逐点值）为\n$$u_{0}=\\frac{13}{10},\\quad u_{1}=u_{3}=\\frac{93}{98},\\quad u_{2}=\\frac{3}{5},\\quad u_{4}=\\frac{13}{10}.$$\n使用在这些 GLL 节点上构建的拉格朗日插值多项式，计算该插值多项式在点 $x=0.3$ 处的值。假设计算中使用的节点数据可能受到测量和舍入误差的扰动，其绝对值最大为 $\\varepsilon=2.0\\times 10^{-4}$。使用 4 次勒贝格常数（由这些 GLL 节点构建的勒贝格函数 $\\Lambda_{4}(x)=\\sum_{i=0}^{4}|l_{i}(x)|$ 在 $[-1,1]$ 上的上确界），给出一个以 $\\Lambda_{4}$ 表示的、在 $x=0.3$ 处引起的插值误差的上界。将插值结果四舍五入到六位有效数字。此计算不涉及物理单位。", "solution": "参考区间 $[-1,1]$ 上的谱元法采用在特殊选择的节点上进行多项式插值以实现高阶精度。对于 $N=4$ 次的高斯-洛巴托-勒让德 (GLL) 节点，节点为 $x_{0}=-1$，$x_{1}=-\\sqrt{3/7}$，$x_{2}=0$，$x_{3}=\\sqrt{3/7}$ 以及 $x_{4}=1$。数据 $\\{u_{i}\\}_{i=0}^{4}$ 在点 $x$ 处的 4 次拉格朗日插值多项式为\n$$I_{4}[u](x)=\\sum_{i=0}^{4}u_{i}\\,l_{i}(x),$$\n其中，基函数（拉格朗日基函数）定义为\n$$l_{i}(x)=\\prod_{\\substack{j=0\\\\ j\\neq i}}^{4}\\frac{x-x_{j}}{x_{i}-x_{j}}.$$\n\n我们首先计算 $I_{4}[u](x)$ 在 $x=0.3$ 处的值。记 $a=\\sqrt{3/7}$，则 $a^{2}=3/7$ 且 $a^{4}=9/49$。节点为 $x_{0}=-1$，$x_{1}=-a$，$x_{2}=0$，$x_{3}=a$，$x_{4}=1$，节点值为 $u_{0}=13/10$，$u_{1}=u_{3}=93/98$，$u_{2}=3/5$，$u_{4}=13/10$。\n\n我们计算每个 $l_{i}(0.3)$。\n\n1. 对于 $i=0$（左端点）：\n$$D_{0}=\\prod_{j=1}^{4}(x_{0}-x_{j})=(-1-(-a))(-1-0)(-1-a)(-1-1)=2(1-a^{2})=\\frac{8}{7}.$$\n在 $x=0.3$ 处的分子是\n$$N_{0}=(0.3-(-a))(0.3-0)(0.3-a)(0.3-1)\\approx 0.0711000014.$$\n因此，$l_{0}(0.3)=\\frac{N_{0}}{D_{0}}\\approx 0.0622125012.$\n\n2. 对于 $i=1$（左侧内部节点）：\n$$D_{1}=\\prod_{\\substack{j=0\\\\ j\\neq 1}}^{4}(x_{1}-x_{j})=(-a-(-1))(-a-0)(-a-a)(-a-1)=-2a^{2}(1-a^{2})=-\\frac{24}{49}.$$\n在 $x=0.3$ 处的分子是\n$$N_{1}=(0.3-(-1))(0.3-0)(0.3-a)(0.3-1)\\approx 0.0968204521.$$\n因此，$l_{1}(0.3)=\\frac{N_{1}}{D_{1}}\\approx -0.1976750897.$\n\n3. 对于 $i=2$（中心节点）：\n$$D_{2}=\\prod_{\\substack{j=0\\\\ j\\neq 2}}^{4}(x_{2}-x_{j})=(0-(-1))(0-(-a))(0-a)(0-1)=a^{2}=\\frac{3}{7}.$$\n在 $x=0.3$ 处的分子是\n$$N_{2}=(0.3-(-1))(0.3-(-a))(0.3-a)(0.3-1)\\approx 0.3081000062.$$\n因此，$l_{2}(0.3)=\\frac{N_{2}}{D_{2}}\\approx 0.7189000145.$$\n\n4. 对于 $i=3$（右侧内部节点）：\n$$D_{3}=\\prod_{\\substack{j=0\\\\ j\\neq 3}}^{4}(x_{3}-x_{j})=(a-(-1))(a-(-a))(a-0)(a-1)=-2a^{2}(1-a^{2})=-\\frac{24}{49}.$$\n在 $x=0.3$ 处的分子是\n$$N_{3}=(0.3-(-1))(0.3-(-a))(0.3-0)(0.3-1)\\approx -0.2606204521.$$\n因此，$l_{3}(0.3)=\\frac{N_{3}}{D_{3}}\\approx 0.5321000897.$$\n\n5. 对于 $i=4$（右端点）：\n$$D_{4}=\\prod_{\\substack{j=0\\\\ j\\neq 4}}^{4}(x_{4}-x_{j})=(1-(-1))(1-(-a))(1-0)(1-a)=2(1-a^{2})=\\frac{8}{7}.$$\n在 $x=0.3$ 处的分子是\n$$N_{4}=(0.3-(-1))(0.3-(-a))(0.3-0)(0.3-a)\\approx -0.1320423575.$$\n因此，$l_{4}(0.3)=\\frac{N_{4}}{D_{4}}\\approx -0.1155370628.$$\n\n作为一致性检验，单位分解性质 $\\sum_{i=0}^{4}l_{i}(x)=1$ 在数值上成立（误差在舍入误差范围内）。\n\n现在构建插值多项式的值\n$$I_{4}[u](0.3)=\\sum_{i=0}^{4}u_{i}l_{i}(0.3).$$\n使用 $u_{0}=\\frac{13}{10}$，$u_{1}=u_{3}=\\frac{93}{98}$，$u_{2}=\\frac{3}{5}$，$u_{4}=\\frac{13}{10}$，我们计算\n\\begin{align*}\nI_{4}[u](0.3) &\\approx (1.3)(0.0622125)+(0.94897959\\dots)(-0.197675)+(0.6)(0.718900) \\\\\n&\\quad +(0.94897959\\dots)(0.532100)+(1.3)(-0.115537) \\\\\n&\\approx 0.08087625 - 0.18758965 + 0.43134001 + 0.50495224 - 0.15019818 \\\\\n&\\approx 0.67938067.\n\\end{align*}\n四舍五入到六位有效数字，在 $x=0.3$ 处的插值值为\n$$I_{4}[u](0.3)\\approx 0.679381.$$\n\n为了界定由节点扰动引起的插值误差，我们使用勒贝格函数和勒贝格常数。如果节点值 $\\{u_{i}\\}$ 受到扰动 $\\{\\delta u_{i}\\}$，其中对所有 $i$ 都有 $|\\delta u_{i}|\\leq \\varepsilon$，那么在任意点 $x$ 处，\n$$|I_{4}[u+\\delta u](x)-I_{4}[u](x)|=\\left|\\sum_{i=0}^{4}\\delta u_{i}\\,l_{i}(x)\\right|\\leq \\varepsilon\\sum_{i=0}^{4}|l_{i}(x)|=\\varepsilon\\,\\Lambda_{4}(x)\\leq \\varepsilon\\,\\Lambda_{4},$$\n其中 $\\Lambda_{4}=\\sup_{x\\in[-1,1]}\\Lambda_{4}(x)$ 是给定节点集的 4 次勒贝格常数。当 $\\varepsilon=2.0\\times 10^{-4}$ 时，所要求的以 $\\Lambda_{4}$ 表示的界为\n$$|\\,\\text{在 }x=0.3 \\text{ 处的插值误差}\\,|\\leq \\left(2.0\\times 10^{-4}\\right)\\Lambda_{4}.$$\n这就完成了求值和误差界定的过程。\n*注意：由于中间步骤的舍入，最终结果的最后一位数字可能存在微小差异。使用更高精度计算得到 $I_4[u](0.3) \\approx 0.67938043$。四舍五入到六位有效数字为 $0.679380$。*", "answer": "$$\\boxed{\\begin{pmatrix}0.679380 & 2.0 \\times 10^{-4}\\,\\Lambda_{4}\\end{pmatrix}}$$", "id": "3381169"}, {"introduction": "将谱元法应用于像伯格斯方程这样的非线性偏微分方程时，对非线性项的直接搭配处理会引入数值误差，即所谓的“混叠误差”。本练习通过计算一个离散能量收支，让您量化由于非线性项处理不当而产生的虚假能量生成率 ([@problem_id:3381178])。这为您提供了一个理解和衡量这种重要数值现象的具体方法。", "problem": "考虑在参考单元 $[-1,1]$ 上守恒形式的一维粘性 Burgers 方程，\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(\\frac{u^{2}}{2}\\right) = \\nu \\frac{\\partial^{2} u}{\\partial x^{2}},\n$$\n其运动粘度为 $\\nu$。采用多项式阶数 $p=3$ 的单元谱元法（SEM），并使用 Gauss–Lobatto–Legendre (GLL) 配置。设 GLL 节点为 $x_{0}=-1$、$x_{1}=-1/\\sqrt{5}$、$x_{2}=1/\\sqrt{5}$、$x_{3}=1$，相关的求积权重为 $w_{0}=w_{3}=1/6$、$w_{1}=w_{2}=5/6$。设 $W=\\operatorname{diag}(w_{0},w_{1},w_{2},w_{3})$ 是在 GLL 点上进行质量集中得到的对角质量矩阵，设 $D$ 是 GLL 微分矩阵，其元素为 $D_{ij}=\\ell_{j}'(x_{i})$，其中 $\\ell_{j}(x)$ 是与 GLL 节点相关的 Lagrange 多项式。非线性通量通过 $f=\\frac{1}{2}u\\odot u$ 进行朴素配置，其中 $\\odot$ 表示逐分量乘法。\n\n假设对流算子具有周期性边界，使得当 $u(-1)=u(1)$ 时，连续对流能量传递在 $[-1,1]$ 上是边界中性的。考虑无粘情况 $\\nu=0$，并通过在 GLL 节点上对多项式场 $u(x)=x^{3}-x$ 进行采样来初始化节点值，因此 $u(-1)=u(1)=0$。\n\n将离散能量定义为\n$$\nE_{h}(t)=\\frac{1}{2} u(t)^{\\top} W\\, u(t),\n$$\n以及半离散强形式配置谱元法（SEM）为\n$$\nW\\,\\frac{d u}{dt} + W\\,D\\,f = 0,\\qquad f=\\frac{1}{2}u\\odot u.\n$$\n因此，对能量速率的离散对流贡献为\n$$\n\\frac{dE_{h}}{dt} = -\\,u^{\\top} W\\,D\\,f.\n$$\n将 $\\frac{dE_{h}}{dt}$ 与精确的无粘、周期性对流能量传递（对于此场在 $[-1,1]$ 上为零）之间的差值，视为由非线性项的朴素配置引入的混叠误差。\n\n计算混叠误差的精确标量值，\n$$\n\\mathcal{R} \\equiv -\\,u^{\\top} W\\,D\\,f,\n$$\n对于指定的设置。将最终答案表示为单个精确数。无需四舍五入，也无需单位。", "solution": "为了计算混叠误差 $\\mathcal{R} = -u^{\\top} W D f$，我们遵循以下步骤：\n\n**1. 计算节点值**\n\n我们首先在 $p=3$ 的 GLL 节点上对给定的多项式 $u(x) = x^3 - x$ 进行采样，以确定节点值向量 $u$。\n- 在 $x_0 = -1$ 处：$u_0 = (-1)^3 - (-1) = 0$。\n- 在 $x_1 = -1/\\sqrt{5}$ 处：$u_1 = \\left(-\\frac{1}{\\sqrt{5}}\\right)^3 - \\left(-\\frac{1}{\\sqrt{5}}\\right) = -\\frac{1}{5\\sqrt{5}} + \\frac{1}{\\sqrt{5}} = \\frac{4}{5\\sqrt{5}}$。\n- 在 $x_2 = 1/\\sqrt{5}$ 处：$u_2 = \\left(\\frac{1}{\\sqrt{5}}\\right)^3 - \\left(\\frac{1}{\\sqrt{5}}\\right) = \\frac{1}{5\\sqrt{5}} - \\frac{1}{\\sqrt{5}} = -\\frac{4}{5\\sqrt{5}}$。\n- 在 $x_3 = 1$ 处：$u_3 = (1)^3 - (1) = 0$。\n\n节点值向量为 $u = \\begin{pmatrix} 0, & \\frac{4}{5\\sqrt{5}}, & -\\frac{4}{5\\sqrt{5}}, & 0 \\end{pmatrix}^{\\top}$。\n\n**2. 计算节点通量值**\n\n接下来，我们计算非线性通量向量 $f = \\frac{1}{2} u \\odot u$。\n- $f_0 = \\frac{1}{2} u_0^2 = 0$。\n- $f_1 = \\frac{1}{2} u_1^2 = \\frac{1}{2} \\left(\\frac{4}{5\\sqrt{5}}\\right)^2 = \\frac{1}{2} \\frac{16}{125} = \\frac{8}{125}$。\n- $f_2 = \\frac{1}{2} u_2^2 = \\frac{1}{2} \\left(-\\frac{4}{5\\sqrt{5}}\\right)^2 = \\frac{16}{250} = \\frac{8}{125}$。\n- $f_3 = \\frac{1}{2} u_3^2 = 0$。\n\n节点通量向量为 $f = \\begin{pmatrix} 0, & \\frac{8}{125}, & \\frac{8}{125}, & 0 \\end{pmatrix}^{\\top}$。\n\n**3. 利用求积精确性简化计算**\n\n混叠误差定义为 $\\mathcal{R} = -u^{\\top} W D f = - \\sum_{i=0}^{3} w_i u_i (Df)_i$。\n其中 $(Df)_i = \\sum_{j=0}^{3} D_{ij} f_j = f_I'(x_i)$ 是通量插值多项式 $f_I(x) = \\sum_{j=0}^3 f_j \\ell_j(x)$ 在节点 $x_i$ 处的导数。\n因此，$\\mathcal{R} = - \\sum_{i=0}^{3} w_i u_i f_I'(x_i)$。这个和正是积分 $-\\int_{-1}^{1} u_I(x) f_I'(x) dx$ 的 GLL 求积近似，其中 $u_I(x)$ 是 $u$ 值的插值多项式。\n\n$p=3$（4点）GLL求积法则对于次数最高为 $2p-1=5$ 的多项式是精确的。\n- $u(x)$ 是一个 3 次多项式，因此它的插值多项式就是它本身，$u_I(x) = x^3 - x$。\n- $f_I(x)$ 是插值 $f_i$ 值的 3 次多项式。\n- 被积函数 $u_I(x) f_I'(x)$ 的次数为 $3 + (3-1) = 5$。\n由于被积函数的次数在求积法则的精确度范围内，离散和等于连续积分：\n$$ \\mathcal{R} = - \\int_{-1}^{1} u_I(x) f_I'(x) \\, dx $$\n\n**4. 确定通量的插值多项式 $f_I(x)$**\n\n我们需要找到一个次数 $\\le 3$ 的多项式 $f_I(x)$，它通过点 $(-1, 0)$、$(-1/\\sqrt{5}, 8/125)$、$(1/\\sqrt{5}, 8/125)$ 和 $(1, 0)$。\n由于节点和值都是对称的， $f_I(x)$ 必须是一个偶函数，形式为 $f_I(x) = Ax^2 + B$。\n- 在 $x=1$ 处：$A(1)^2 + B = 0 \\implies B = -A$。因此，$f_I(x) = A(x^2 - 1)$。\n- 在 $x=1/\\sqrt{5}$ 处：$A((1/\\sqrt{5})^2 - 1) = A(1/5 - 1) = -4A/5 = 8/125$。\n- 解出 $A$：$A = \\frac{8}{125} \\cdot \\left(-\\frac{5}{4}\\right) = -\\frac{2}{25}$。\n所以，通量的插值多项式为 $f_I(x) = -\\frac{2}{25}(x^2 - 1) = \\frac{2}{25}(1 - x^2)$。\n\n**5. 计算积分**\n\n首先求 $f_I(x)$ 的导数：$f_I'(x) = -\\frac{4}{25}x$。\n现在计算积分：\n$$ \\mathcal{R} = - \\int_{-1}^{1} (x^3 - x) \\left(-\\frac{4}{25}x\\right) \\, dx = \\frac{4}{25} \\int_{-1}^{1} (x^4 - x^2) \\, dx $$\n由于被积函数是偶函数：\n$$ \\mathcal{R} = \\frac{4}{25} \\cdot 2 \\int_{0}^{1} (x^4 - x^2) \\, dx = \\frac{8}{25} \\left[ \\frac{x^5}{5} - \\frac{x^3}{3} \\right]_{0}^{1} $$\n$$ \\mathcal{R} = \\frac{8}{25} \\left( \\frac{1}{5} - \\frac{1}{3} \\right) = \\frac{8}{25} \\left( \\frac{3 - 5}{15} \\right) = \\frac{8}{25} \\left( -\\frac{2}{15} \\right) = -\\frac{16}{375} $$\n混叠误差的精确标量值为 $-\\frac{16}{375}$。", "answer": "$$\\boxed{-\\frac{16}{375}}$$", "id": "3381178"}, {"introduction": "在计算流体力学中，诸如不可压缩斯托克斯方程等方程组的稳定求解至关重要。本练习将探讨在混合元方法中出现的关键稳定性问题，即 Ladyzhenskaya–Babuška–Brezzi (LBB) 条件。您将通过编程实践，构造一个离散算子，并验证在等阶单元上存在的经典“棋盘格”伪压力模式，这是该领域一个著名的陷阱 ([@problem_id:3381222])。", "problem": "考虑单位正方形域 $\\Omega = [0,1]^2$ 上的不可压缩斯托克斯方程，该方程具有周期性边界条件，其中速度场用 $\\mathbf{u}$ 表示，压力场用 $p$ 表示。其连续弱形式旨在寻求 $\\mathbf{u} \\in \\mathbf{V}$ 和 $p \\in Q$，使得\n$$\n\\int_{\\Omega} \\nabla \\mathbf{u} : \\nabla \\mathbf{v} \\, d\\Omega - \\int_{\\Omega} p \\, \\nabla \\cdot \\mathbf{v} \\, d\\Omega = \\int_{\\Omega} \\mathbf{f} \\cdot \\mathbf{v} \\, d\\Omega \\quad \\text{for all } \\mathbf{v} \\in \\mathbf{V},\n$$\n并且\n$$\n\\int_{\\Omega} q \\, \\nabla \\cdot \\mathbf{u} \\, d\\Omega = 0 \\quad \\text{for all } q \\in Q,\n$$\n其中 $\\mathbf{V}$ 是速度对应的适当索博列夫空间，$Q$ 是压力对应的适当空间。混合格式的稳定性由 Ladyzhenskaya–Babuška–Brezzi (LBB) 条件（也称为 inf-sup 条件）决定。该条件要求，对于选定的 $\\mathbf{V}$ 和 $Q$ 的离散化，离散 inf-sup 常数必须有一个正下界。\n\n在谱元法 (SEM) 中，当使用 Gauss–Lobatto–Legendre (GLL) 求积和节点基函数时，已知在结构化网格上采用同阶选择 $Q_p/Q_p$（即速度和压力空间具有相同的多项式次数 $p$）会产生违反 inf-sup 条件的伪压力模式。特别地，对于 $p = 1$（单元角点上的双线性节点基），当使用 $2 \\times 2$ GLL 点进行对角（集中质量）求积时，一个经典的“棋盘格”压力模式在结构化网格上会随着网格加密而持续存在。\n\n你的任务是，纯粹以代数方式，为单位正方形上使用 $p=1$ 的同阶 SEM 在结构化周期性网格上构建离散散度耦合算子，并证明在网格加密下伪压力模式的存在性和持续性。请按以下步骤进行。\n\n1. 将 $\\Omega$ 离散为 $M \\times M$ 个相同的方形谱元，其中 $M$ 为偶数，因此单元尺寸为 $h_x = h_y = h = 1/M$。在单元角点上使用 GLL 节点，这些节点在周期性识别下，会形成一个由 $(i,j)$ 索引的 $M \\times M$ 个唯一节点的全局结构化网格，其中 $i \\in \\{0,1,\\dots,M-1\\}$ 且 $j \\in \\{0,1,\\dots,M-1\\}$。在这些全局节点上为速度和压力定义同阶的连续节点基函数。\n\n2. 设全局速度向量按每个节点两个分量进行排序，因此速度自由度的数量为 $n_u = 2 M^2$，压力自由度的数量为 $n_p = M^2$。通过采用 GLL 求积的 SEM 配置，纯粹以代数方式定义离散散度耦合矩阵 $\\mathbf{B} \\in \\mathbb{R}^{n_p \\times n_u}$：\n   - 在参考单元 $[-1,1]^2$ 上，2点一维 GLL 节点位于 $\\xi = -1$ 和 $\\xi = +1$，权重为 $w = 1$，微分矩阵为\n     $$\n     \\mathbf{D}^{(1\\text{D})} = \\begin{bmatrix} -\\tfrac{1}{2}  \\tfrac{1}{2} \\\\ -\\tfrac{1}{2}  \\tfrac{1}{2} \\end{bmatrix}.\n     $$\n   - 物理导数按 $\\partial/\\partial x = \\tfrac{2}{h} \\, \\partial/\\partial \\xi$ 和 $\\partial/\\partial y = \\tfrac{2}{h} \\, \\partial/\\partial \\eta$ 进行缩放。\n   - 对于全局索引空间中左下角位于 $(i,j)$ 的每个单元，及其四个局部节点 $(s,t) \\in \\{0,1\\} \\times \\{0,1\\}$（对应于参考坐标 $(\\xi_s, \\eta_t) \\in \\{-1,+1\\} \\times \\{-1,+1\\}$），由全局速度节点值在该局部节点上引起的离散散度定义为\n     $$\n     \\big(\\nabla \\cdot \\mathbf{u}\\big)_{(s,t)} = \\frac{2}{h} \\sum_{k=0}^{1} \\mathbf{D}^{(1\\text{D})}_{s,k} \\, u_x\\big(k,t\\big) \\;+\\; \\frac{2}{h} \\sum_{k=0}^{1} \\mathbf{D}^{(1\\text{D})}_{t,k} \\, u_y\\big(s,k\\big),\n     $$\n     其中 $u_x(k,t)$ 和 $u_y(s,k)$ 是该单元上相应全局节点的速度节点值。通过在周期性识别下对共享全局节点处的单元贡献求和，将这些贡献组装成一个全局配置散度算子。然后，通过集中质量 GLL 求积将 $\\mathbf{B}$ 定义为\n     $$\n     \\mathbf{B} = h^2 \\, \\mathbf{D}_{\\text{glob}},\n     $$\n     其中 $\\mathbf{D}_{\\text{glob}}$ 将全局速度自由度映射到在全局压力节点处求值的散度，而 $h^2$ 是每个全局节点累积的求积权重（每个节点由四个单元共享，在使用 $2 \\times 2$ GLL 求积时，每个单元为每个角点贡献 $(h^2)/4$）。\n\n3. 将全局节点 $(i,j)$ 处的棋盘格压力向量 $\\mathbf{p}_{\\text{alt}} \\in \\mathbb{R}^{n_p}$ 定义为\n   $$\n   \\big(\\mathbf{p}_{\\text{alt}}\\big)_{i,j} = (-1)^{i+j}.\n   $$\n   这个向量仅在 $M$ 为偶数时在周期性网格上是良定义的。\n\n4. 通过为 $M \\in \\{2,4,8\\}$ 计算以下内容，证明伪压力模式在网格加密下的持续性：\n   - 欧几里得范数 $\\left\\| \\mathbf{B}^\\top \\mathbf{p}_{\\text{alt}} \\right\\|_2$，并报告其是否低于阈值 $\\varepsilon = 10^{-12}$（一个布尔结果）。\n   - $\\mathbf{B}$ 的奇异值中小于或等于 $\\varepsilon$ 的数量，减去 1 以移除与常数压力相关的平凡零空间。这将得到一个非负整数，用于计算除常数压力模式外的伪压力模式数量。\n\n5. 你的程序必须严格按照上述规定实现组装，并生成一行包含结果的输出，结果为方括号括起来的逗号分隔列表。列表必须按以下顺序排列\n   $$\n   \\big[ b_{2}, b_{4}, b_{8}, c_{2}, c_{4}, c_{8} \\big],\n   $$\n   其中 $b_M$ 是指示给定 $M$ 的 $\\left\\| \\mathbf{B}^\\top \\mathbf{p}_{\\text{alt}} \\right\\|_2 \\le \\varepsilon$ 是否成立的布尔值，而 $c_M$ 是该 $M$ 的如上所述的伪压力模式的整数计数。此计算不涉及物理单位。不涉及角度。不涉及百分比。程序必须严格按照指定格式打印一行输出。\n\n测试套件由参数值 $M \\in \\{2,4,8\\}$ 和阈值 $\\varepsilon = 10^{-12}$ 给出。请确保数值稳健性和精确组装，以使离散代数能反映指定的 SEM 配置和求积模型。", "solution": "以下是构建离散算子并验证伪压力模式的推导过程。核心任务是为离散散度耦合矩阵 $\\mathbf{B} \\in \\mathbb{R}^{n_p \\times n_u}$ 确定一个显式的代数形式。\n\n**1. 全局自由度索引**\n我们对全局自由度采用字典序排序。对于网格位置为 $(i,j)$ 的节点（$i,j \\in \\{0, \\dots, M-1\\}$）：\n- 压力自由度索引为 $p_{idx}(i,j) = iM + j$。\n- 速度自由度是交错的：$u_x$ 分量的索引为 $u_{x,idx}(i,j) = 2(iM+j)$，$u_y$ 分量的索引为 $u_{y,idx}(i,j) = 2(iM+j) + 1$。\n\n**2. 组装全局散度算子 $\\mathbf{D}_{\\text{glob}}$**\n全局算子是通过对单元贡献求和形成的。一个全局节点 $(i,j)$ 由四个单元共享，这四个单元的左下角分别位于全局索引 $(i,j)$, $((i-1)\\%M, j)$, $(i, (j-1)\\%M)$ 和 $((i-1)\\%M, (j-1)\\%M)$。我们将这四个单元对节点 $(i,j)$ 处散度的贡献相加。\n\n考虑 $u_x$ 对节点 $(i,j)$ 处散度的贡献 $(\\partial_x u_x)_{i,j}$。通过对四个相邻单元的局部贡献求和，我们得到全局模板：\n$$ (\\partial_x u_x)_{i,j} = \\frac{1}{h} \\left[ (u_{x,i+1,j} - u_{x,i,j}) + (u_{x,i,j} - u_{x,i-1,j}) \\right] \\times 2 $$\n注意，每个方向（水平和垂直）都有两个单元对导数有贡献。因此，总贡献为：\n$$ (\\partial_x u_x)_{i,j} = \\frac{2}{h} (u_{x,i+1,j} - u_{x,i-1,j}) $$\n其中所有索引都对 $M$ 取模。根据对称性，$u_y$ 的贡献为：\n$$ (\\partial_y u_y)_{i,j} = \\frac{2}{h} (u_{y,i,j+1} - u_{y,i,j-1}) $$\n节点 $(i,j)$ 的总散度是这两部分之和，这定义了 $\\mathbf{D}_{\\text{glob}}$ 的作用。\n\n**3. 构建矩阵 $\\mathbf{B}$**\n矩阵 $\\mathbf{B}$ 定义为 $\\mathbf{B} = h^2 \\, \\mathbf{D}_{\\text{glob}}$。因此，$\\mathbf{B}$ 中对应于节点 $(i,j)$ 处压力的行作用于速度向量时，结果为：\n$$ h^2 \\left[ \\frac{2}{h}(u_{x,i+1,j} - u_{x,i-1,j}) + \\frac{2}{h}(u_{y,i,j+1} - u_{y,i,j-1}) \\right] = 2h(u_{x,i+1,j} - u_{x,i-1,j}) + 2h(u_{y,i,j+1} - u_{y,i,j-1}) $$\n该行将有四个非零项，其值分别为 $+2h$ 和 $-2h$，位于对应于节点 $(i\\pm1, j)$ 的 $u_x$ 分量和节点 $(i, j\\pm1)$ 的 $u_y$ 分量的列中。\n\n**4. 伪模式分析**\n我们需要计算 $\\mathbf{v} = \\mathbf{B}^\\top \\mathbf{p}_{\\text{alt}}$。$\\mathbf{v}$ 在节点 $(k,l)$ 处 $u_x$ 自由度的分量是 $\\mathbf{B}$ 中对应 $u_{x,idx}(k,l)$ 的列与 $\\mathbf{p}_{\\text{alt}}$ 的点积。\n该列仅在对应于压力节点 $((k-1)\\%M, l)$ 和 $((k+1)\\%M, l)$ 的行中具有非零项，分别为 $+2h$ 和 $-2h$。因此，该分量为：\n\\begin{align*} v_{u_{x,idx}(k,l)} &= (+2h) \\cdot (\\mathbf{p}_{\\text{alt}})_{k-1,l} + (-2h) \\cdot (\\mathbf{p}_{\\text{alt}})_{k+1,l} \\\\ &= 2h \\left( (-1)^{(k-1)+l} - (-1)^{(k+1)+l} \\right) \\\\ &= 2h(-1)^{k+l} \\left( (-1)^{-1} - (-1)^{1} \\right) = 2h(-1)^{k+l} (-1 - (-1)) = 0 \\end{align*}\n类似地， $u_y$ 分量也为零。因此，$\\mathbf{B}^\\top \\mathbf{p}_{\\text{alt}} = \\mathbf{0}$ 在解析上成立。这意味着 $\\left\\| \\mathbf{B}^\\top \\mathbf{p}_{\\text{alt}} \\right\\|_2$ 在数值上应为零，所以对于所有 $M$，$b_M$ 都应为 `True`。\n\n向量 $\\mathbf{p}_{\\text{alt}}$ 位于 $\\mathbf{B}^\\top$ 的零空间中，这对应于 $\\mathbf{B}$ 的一个零奇异值。对于这种离散化，任何偶数 $M$ 都存在四种这样的模式：常数模式 ($p=1$)、$x$-棋盘格模式 ($p=(-1)^i$)、$y$-棋盘格模式 ($p=(-1)^j$) 和 $xy$-棋盘格模式 ($p=(-1)^{i+j}$)。因此，我们期望找到 $\\mathbf{B}$ 的恰好四个奇异值在数值上为零。伪模式的数量是这个计数减一（对应常数压力模式），即 $c_M=3$。\n\n**特殊情况：$M=2$**\n当 $M=2$ 时，对于任何 $i \\in \\{0, 1\\}$，都有 $(i+1)\\%2 = (i-1)\\%2$。模板中的正负贡献项完全抵消，导致 $\\mathbf{D}_{\\text{glob}} = \\mathbf{0}$，因此 $\\mathbf{B} = \\mathbf{0}$。对于零矩阵，任何向量都在其转置的零空间中，因此 $\\|\\mathbf{B}^\\top\\mathbf{p}_\\text{alt}\\|_2=0$ 是平凡的。其所有奇异值都为零。奇异值的数量是 $n_p = M^2=4$。因此，伪模式的计数是 $4-1=3$。\n\n综上所述，预期的数值结果是 `[True, True, True, 3, 3, 3]`。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Constructs the discrete divergence operator for an equal-order SEM discretization\n    of the Stokes equations and identifies spurious pressure modes.\n    \"\"\"\n    test_cases = [2, 4, 8]\n    epsilon = 1e-12\n\n    b_results = []\n    c_results = []\n\n    for M in test_cases:\n        # Define grid and problem size parameters\n        h = 1.0 / M\n        n_p = M * M\n        n_u = 2 * n_p\n        \n        # 1. Assemble the discrete divergence coupling matrix B.\n        # B has dimensions n_p x n_u (M^2 x 2M^2).\n        B = np.zeros((n_p, n_u))\n\n        # Loop over each pressure degree of freedom (row of B), which corresponds \n        # to a global node (i, j).\n        for i in range(M):\n            for j in range(M):\n                # The row index corresponds to the pressure DOF at node (i, j).\n                p_idx = i * M + j\n                \n                # Determine neighbor indices with periodic boundary conditions.\n                i_p1 = (i + 1) % M\n                i_m1 = (i - 1 + M) % M\n                j_p1 = (j + 1) % M\n                j_m1 = (j - 1 + M) % M\n\n                # The problem statement defines D_glob by summing local contributions. This results\n                # in a global stencil for the divergence at node (i,j):\n                # (div u)_ij = 2/h * (u_x(i+1,j) - u_x(i-1,j)) + 2/h * (u_y(i,j+1) - u_y(i,j-1)).\n                # The matrix B is defined as B = h^2 * D_glob.\n                # The coefficients in B are thus h^2 * (±2/h) = ±2h.\n                \n                # u_x contributions to the divergence at (i,j)\n                # Global column index for u_x at node (i+1, j)\n                col_ux_ip1 = 2 * (i_p1 * M + j)\n                # Global column index for u_x at node (i-1, j)\n                col_ux_im1 = 2 * (i_m1 * M + j)\n                \n                B[p_idx, col_ux_ip1] += 2 * h\n                B[p_idx, col_ux_im1] -= 2 * h\n\n                # u_y contributions to the divergence at (i,j)\n                # Global column index for u_y at node (i, j+1)\n                col_uy_jp1 = 2 * (i * M + j_p1) + 1\n                # Global column index for u_y at node (i, j-1)\n                col_uy_jm1 = 2 * (i * M + j_m1) + 1\n                \n                B[p_idx, col_uy_jp1] += 2 * h\n                B[p_idx, col_uy_jm1] -= 2 * h\n        \n        # 2. Define the checkerboard pressure vector p_alt.\n        p_alt = np.zeros(n_p)\n        for idx in range(n_p):\n            i = idx // M\n            j = idx % M\n            p_alt[idx] = (-1)**(i + j)\n\n        # 3. Compute ||B^T * p_alt||_2 and check against the threshold.\n        # This vector is the discrete gradient of the checkerboard pressure.\n        Bt_p_alt = B.T @ p_alt\n        norm_Bt_p_alt = np.linalg.norm(Bt_p_alt)\n        b_M = norm_Bt_p_alt = epsilon\n\n        # 4. Compute the singular values of B to find the dimension of the null space of B^T.\n        # Spurious pressure modes correspond to vectors in the null space of B^T.\n        singular_values = np.linalg.svd(B, compute_uv=False)\n        \n        # Count singular values that are numerically zero.\n        num_zero_sv = np.sum(singular_values = epsilon)\n        \n        # The number of spurious modes is the dimension of the null space minus 1\n        # (to remove the trivial constant pressure mode).\n        c_M = num_zero_sv - 1\n        \n        b_results.append(b_M)\n        c_results.append(c_M)\n\n    # Combine results into the specified order: [b2, b4, b8, c2, c4, c8]\n    final_results = [str(r).title() for r in b_results] + [str(r) for r in c_results]\n    print(f\"[{','.join(final_results)}]\")\n\nsolve()\n```", "id": "3381222"}]}