{"hands_on_practices": [{"introduction": "在将任何数值格式应用于实际问题之前，我们必须首先理解其基本特性。本练习将采用冯·诺依曼稳定性分析——这是计算流体力学中的一种基石技术——来深入研究麦考马克格式。通过推导其放大因子，我们将确定该格式保持稳定的条件，并量化其引入的数值误差，即耗散（振幅误差）和色散（相位误差）。[@problem_id:3342546]", "problem": "考虑一维线性平流方程 $\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0$，该方程设置在均匀周期性网格上，空间步长为 $\\Delta x$，时间步长为 $\\Delta t$，其中 $a>0$ 是一个恒定的平流速度。用节点 $x_j = j \\Delta x$ 对 $x$ 进行离散，用时间层 $t^n = n \\Delta t$ 对 $t$ 进行离散。MacCormack 预测-校正格式由以下两步定义：\n预测步：$u_j^{*} = u_j^n - \\nu \\left(u_{j+1}^n - u_j^n\\right)$，\n校正步：$u_j^{n+1} = \\frac{1}{2} \\left(u_j^n + u_j^{*} - \\nu \\left(u_j^{*} - u_{j-1}^{*}\\right)\\right)$，\n其中 Courant–Friedrichs–Lewy (CFL) 数为 $\\nu = \\frac{a \\Delta t}{\\Delta x}$。\n\n从平流方程和这些离散更新公式出发，通过假设一个傅里叶模式 $u_j^n = \\hat{u}^n \\exp(i j \\theta)$ 来进行 von Neumann 稳定性分析，并推导 MacCormack 格式的放大因子 $G(\\theta;\\nu)$。然后，在 $\\theta = \\frac{\\pi}{2}$ 处计算放大因子，以确定其每个时间步的模 $|G|$ 和相位 $\\phi = \\arg(G)$。假设 $0  \\nu  1$，这样相位的主值可以明确定义而没有分支模糊性。评估此模式是被衰减还是被放大，并以弧度为单位量化每时间步的相移。\n\n以有序对 $\\left(|G|,\\phi\\right)$ 的形式给出你的最终答案，用 $a$、$\\Delta x$ 和 $\\Delta t$ 表示，并以弧度给出相位。不需要数值四舍五入；请提供一个闭合形式的解析表达式。", "solution": "问题陈述经过严格验证并被确定为有效。它在科学上基于计算流体动力学的原理，问题设定良好，目标明确，数据充分，语言客观。任务是对应用于线性平流方程的 MacCormack 格式进行标准的 von Neumann 稳定性分析。\n\n分析始于考虑数值解 $u_j^n$ 在离散时间层 $n$ 和空间节点 $j$ 上的单个傅里叶模式：\n$$u_j^n = \\hat{u}^n \\exp(i j \\theta)$$\n其中 $\\hat{u}^n$ 是在时间层 $n$ 的模式振幅，$i = \\sqrt{-1}$ 是虚数单位，$\\theta = k \\Delta x$ 是无量纲波数，其中 $k$ 是物理波数，$\\Delta x$ 是空间网格间距。放大因子 $G$ 由关系式 $\\hat{u}^{n+1} = G \\cdot \\hat{u}^n$ 定义。我们的目标是找到 $G(\\theta; \\nu)$ 的表达式。\n\n我们将傅里叶模式代入 MacCormack 格式的两个步骤中。\n\n首先，对于预测步：\n$$u_j^{*} = u_j^n - \\nu \\left(u_{j+1}^n - u_j^n\\right)$$\n代入傅里叶模式得到：\n$$\\hat{u}^* \\exp(i j \\theta) = \\hat{u}^n \\exp(i j \\theta) - \\nu \\left(\\hat{u}^n \\exp(i (j+1) \\theta) - \\hat{u}^n \\exp(i j \\theta)\\right)$$\n两边同除以 $\\exp(i j \\theta)$：\n$$\\hat{u}^* = \\hat{u}^n - \\nu \\left(\\hat{u}^n \\exp(i \\theta) - \\hat{u}^n\\right)$$\n$$\\hat{u}^* = \\hat{u}^n \\left(1 - \\nu (\\exp(i \\theta) - 1)\\right)$$\n这给出了预测振幅 $\\hat{u}^*$ 与初始振幅 $\\hat{u}^n$ 之间的关系。\n\n接下来，对于校正步：\n$$u_j^{n+1} = \\frac{1}{2} \\left(u_j^n + u_j^{*} - \\nu \\left(u_j^{*} - u_{j-1}^{*}\\right)\\right)$$\n我们为 $u_j^{n+1}$、$u_j^n$ 以及预测值 $u_j^*$ 和 $u_{j-1}^*$ 代入相应的傅里叶模式：\n$$\\hat{u}^{n+1} \\exp(i j \\theta) = \\frac{1}{2} \\left(\\hat{u}^n \\exp(i j \\theta) + \\hat{u}^* \\exp(i j \\theta) - \\nu \\left(\\hat{u}^* \\exp(i j \\theta) - \\hat{u}^* \\exp(i (j-1) \\theta)\\right)\\right)$$\n两边同除以 $\\exp(i j \\theta)$：\n$$\\hat{u}^{n+1} = \\frac{1}{2} \\left(\\hat{u}^n + \\hat{u}^* - \\nu \\left(\\hat{u}^* - \\hat{u}^* \\exp(-i \\theta)\\right)\\right)$$\n$$\\hat{u}^{n+1} = \\frac{1}{2} \\left(\\hat{u}^n + \\hat{u}^* \\left(1 - \\nu (1 - \\exp(-i \\theta))\\right)\\right)$$\n为了找到放大因子 $G = \\hat{u}^{n+1}/\\hat{u}^n$，我们两边同除以 $\\hat{u}^n$：\n$$G = \\frac{1}{2} \\left(1 + \\frac{\\hat{u}^*}{\\hat{u}^n} \\left(1 - \\nu (1 - \\exp(-i \\theta))\\right)\\right)$$\n从预测步代入 $\\hat{u}^*/\\hat{u}^n$ 的表达式：\n$$G = \\frac{1}{2} \\left(1 + \\left(1 - \\nu (\\exp(i \\theta) - 1)\\right) \\left(1 - \\nu (1 - \\exp(-i \\theta))\\right)\\right)$$\n展开乘积项：\n$$(1 - \\nu (\\exp(i \\theta) - 1)) (1 - \\nu (1 - \\exp(-i \\theta))) = 1 - \\nu(1-\\exp(-i\\theta)) - \\nu(\\exp(i\\theta)-1) + \\nu^2(\\exp(i\\theta)-1)(1-\\exp(-i\\theta))$$\n$$= 1 - \\nu + \\nu\\exp(-i\\theta) - \\nu\\exp(i\\theta) + \\nu + \\nu^2(\\exp(i\\theta) - 1 - 1 + \\exp(-i\\theta))$$\n$$= 1 - \\nu(\\exp(i\\theta) - \\exp(-i\\theta)) + \\nu^2(\\exp(i\\theta) + \\exp(-i\\theta) - 2)$$\n使用欧拉恒等式 $\\exp(i\\theta) - \\exp(-i\\theta) = 2i\\sin(\\theta)$ 和 $\\exp(i\\theta) + \\exp(-i\\theta) = 2\\cos(\\theta)$：\n$$= 1 - 2i\\nu\\sin(\\theta) + \\nu^2(2\\cos(\\theta) - 2) = 1 - 2i\\nu\\sin(\\theta) - 2\\nu^2(1-\\cos(\\theta))$$\n将此结果代回 $G$ 的表达式中：\n$$G = \\frac{1}{2} \\left(1 + 1 - 2i\\nu\\sin(\\theta) - 2\\nu^2(1-\\cos(\\theta))\\right)$$\n$$G(\\theta; \\nu) = 1 - \\nu^2(1-\\cos(\\theta)) - i\\nu\\sin(\\theta)$$\n使用半角恒等式 $1-\\cos(\\theta) = 2\\sin^2(\\theta/2)$，这也可以写成：\n$$G(\\theta; \\nu) = 1 - 2\\nu^2\\sin^2(\\frac{\\theta}{2}) - i\\nu\\sin(\\theta)$$\n这是 MacCormack 格式的一般放大因子。\n\n现在，我们在特定波数 $\\theta = \\frac{\\pi}{2}$ 处计算 $G$：\n$$\\sin\\left(\\frac{\\pi}{2}\\right) = 1$$\n$$\\sin\\left(\\frac{\\theta}{2}\\right) = \\sin\\left(\\frac{\\pi}{4}\\right) = \\frac{\\sqrt{2}}{2} \\implies \\sin^2\\left(\\frac{\\theta}{2}\\right) = \\frac{1}{2}$$\n将这些值代入 $G$ 的表达式中：\n$$G\\left(\\frac{\\pi}{2}; \\nu\\right) = 1 - 2\\nu^2\\left(\\frac{1}{2}\\right) - i\\nu(1) = 1 - \\nu^2 - i\\nu$$\n这是一个复数，表示指定模式的放大因子。\n\n接下来，我们计算其模 $|G|$：\n$$|G| = \\left|1 - \\nu^2 - i\\nu\\right| = \\sqrt{\\left(1 - \\nu^2\\right)^2 + (-\\nu)^2}$$\n$$|G| = \\sqrt{1 - 2\\nu^2 + \\nu^4 + \\nu^2}$$\n$$|G| = \\sqrt{1 - \\nu^2 + \\nu^4}$$\n对于给定的条件 $0  \\nu  1$，我们有 $\\nu^2 > \\nu^4$，所以 $\\nu^2 - \\nu^4 > 0$。因此，$1 - (\\nu^2 - \\nu^4)  1$，这意味着 $|G|  1$。这表示该模式是衰减的，这对于一个稳定的格式是符合预期的。\n\n最后，我们计算相位 $\\phi = \\arg(G)$。实部为 $\\text{Re}(G) = 1 - \\nu^2$，虚部为 $\\text{Im}(G) = -\\nu$。由于 $0  \\nu  1$，实部为正，虚部为负，该复数位于第四象限。\n$$\\phi = \\arctan\\left(\\frac{\\text{Im}(G)}{\\text{Re}(G)}\\right) = \\arctan\\left(\\frac{-\\nu}{1 - \\nu^2}\\right)$$\n$$\\phi = -\\arctan\\left(\\frac{\\nu}{1 - \\nu^2}\\right)$$\n这个相位 $\\phi$ 是每个时间步的数值相移，以弧度为单位。\n\n问题要求最终答案用 $a$、$\\Delta x$ 和 $\\Delta t$ 表示。我们将 CFL 数 $\\nu = \\frac{a \\Delta t}{\\Delta x}$ 代入 $|G|$ 和 $\\phi$ 的表达式中。\n$$|G| = \\sqrt{1 - \\left(\\frac{a \\Delta t}{\\Delta x}\\right)^2 + \\left(\\frac{a \\Delta t}{\\Delta x}\\right)^4}$$\n$$\\phi = -\\arctan\\left(\\frac{\\frac{a \\Delta t}{\\Delta x}}{1 - \\left(\\frac{a \\Delta t}{\\Delta x}\\right)^2}\\right) = -\\arctan\\left(\\frac{\\frac{a \\Delta t}{\\Delta x}}{\\frac{(\\Delta x)^2 - (a \\Delta t)^2}{(\\Delta x)^2}}\\right) = -\\arctan\\left(\\frac{a \\Delta t \\Delta x}{(\\Delta x)^2 - (a \\Delta t)^2}\\right)$$\n\n最终结果是有序对 $(|G|, \\phi)$。", "answer": "$$\\boxed{\\left(\\sqrt{1 - \\left(\\frac{a \\Delta t}{\\Delta x}\\right)^2 + \\left(\\frac{a \\Delta t}{\\Delta x}\\right)^4}, -\\arctan\\left(\\frac{a \\Delta t \\Delta x}{(\\Delta x)^2 - (a \\Delta t)^2}\\right)\\right)}$$", "id": "3342546"}, {"introduction": "现实世界中的流体力学问题常常涉及空间变化的属性，例如在非均匀介质中的流动。本练习挑战我们将麦考马克格式推广到变系数平流方程。我们将首先分析为何一个“朴素”的非守恒形式应用会导致精度下降，然后基于控制方程的守恒形式，构建一个“系数感知”的改进版本——这是稳健CFD模拟中的一项关键原则。[@problem_id:3342575]", "problem": "考虑一个由守恒律 $u_{t} + (a(x) u)_{x} = 0$ 描述的、具有空间变化输运系数的标量场的线性平流问题，其中 $a(x)$ 是一个光滑且不随时间变化的函数，$u(x,t)$ 足够光滑。设空间域在均匀网格上离散化，节点为 $x_{i} = x_{0} + i \\,\\Delta x$，时间离散化为 $t_{n} = t_{0} + n \\,\\Delta t$。定义库朗数（Courant ratio） $\\lambda = \\Delta t / \\Delta x$。假设采用周期性边界条件，并关注一个通用的内部节点 $x_{i}$。\n\n从上述偏微分方程以及前向和后向离散差分的定义出发。分析一个“朴素”的MacCormack预测-校正格式在 $x_i$ 处的局部截断误差。该格式通过在预测步和校正步中都使用 $a_{i} = a(x_{i})$ 乘以 $u$ 的单边离散差分，来离散化非守恒形式 $u_{t} + a(x) u_{x} = 0$。通过在 $x_{i}$ 和 $t_{n}$ 处进行泰勒展开，并利用守恒律 $u_{t} = - (a u)_{x}$，推导由于忽略系数梯度而产生的局部截断误差中的最低阶非零项。解释该项如何导致二阶精度的损失。\n\n然后，构造一个考虑了系数变化的、以守恒形式表示的MacCormack预测-校正格式，在预测步和校正步中均使用单元中心的离散通量 $f_{i}^{n} = a_{i} \\, u_{i}^{n}$。消去中间的预测状态，将 $u_{i}^{n+1}$ 的单步组合更新明确地表示为 $u_{i-1}^{n}$、$u_{i}^{n}$、$u_{i+1}^{n}$ 和 $a_{i-1}$、$a_{i}$、$a_{i+1}$ 以及 $\\lambda$ 的函数。该表达式必须是代数封闭的，不包含任何预测量，并且在 $a(x)$ 和 $u(x,t)$ 光滑的条件下必须与二阶精度相符。你的最终答案应该是这个考虑了系数变化的守恒型MacCormack格式所产生的 $u_{i}^{n+1}$ 的单一封闭形式解析表达式。不需要进行数值计算。", "solution": "我们从守恒律 $u_{t} + (a u)_{x} = 0$ 开始，其中 $a(x)$ 是光滑且不随时间变化的函数，$u(x,t)$ 也光滑。基本依据是守恒形式及其乘法法则展开式 $(a u)_{x} = a u_{x} + a_{x} u$，以及在网格点处进行的关于空间和时间的泰勒展开。\n\n对朴素非守恒MacCormack格式及其二阶精度损失的分析：\n\n考虑通过将 $u$ 的单边差分乘以 $a_{i} = a(x_{i})$ 来离散化 $u_{t} + a(x) u_{x} = 0$ 的朴素MacCormack预测-校正格式。其在节点 $i$ 的预测步和校正步为\n$$\nu_{i}^{*} = u_{i}^{n} - \\lambda \\, a_{i} \\left(u_{i+1}^{n} - u_{i}^{n}\\right),\n$$\n$$\nu_{i}^{n+1} = \\frac{1}{2} \\left[ u_{i}^{n} + u_{i}^{*} - \\lambda \\, a_{i} \\left( u_{i}^{*} - u_{i-1}^{*} \\right) \\right].\n$$\n为了评估其与守恒律的一致性，我们将精确解 $u(x,t)$ 代入 $(x_{i},t_{n})$ 点，并展开至 $\\Delta x$ 和 $\\Delta t$ 的最低阶。为简洁起见，将 $\\Delta x$ 记为 $\\Delta$。对空间值进行泰勒展开：\n$$\nu_{i+1}^{n} = u + u_{x} \\Delta + \\frac{1}{2} u_{xx} \\Delta^{2} + \\frac{1}{6} u_{xxx} \\Delta^{3} + \\mathcal{O}(\\Delta^{4}),\n$$\n$$\nu_{i-1}^{n} = u - u_{x} \\Delta + \\frac{1}{2} u_{xx} \\Delta^{2} - \\frac{1}{6} u_{xxx} \\Delta^{3} + \\mathcal{O}(\\Delta^{4}),\n$$\n以及 $a_{i-1} = a - a_{x} \\Delta + \\frac{1}{2} a_{xx} \\Delta^{2} + \\mathcal{O}(\\Delta^{3})$，其中所有导数均在 $(x_{i},t_{n})$ 处取值。预测步得到\n$$\nu_{i}^{*} = u - \\lambda \\, a \\left( u_{x} \\Delta + \\frac{1}{2} u_{xx} \\Delta^{2} + \\frac{1}{6} u_{xxx} \\Delta^{3} \\right) + \\mathcal{O}(\\Delta^{4}).\n$$\n在 $i-1$ 处进行类似的展开得到\n\\begin{align*}\nu_{i-1}^{*} = \\left[ u - u_{x} \\Delta + \\frac{1}{2} u_{xx} \\Delta^{2} - \\frac{1}{6} u_{xxx} \\Delta^{3} \\right] \\\\\n\\quad - \\lambda \\left[ a u_{x} \\Delta + \\left( -\\frac{1}{2} a u_{xx} - a_{x} u_{x} \\right) \\Delta^{2} + \\left( \\frac{1}{6} a u_{xxx} + \\frac{1}{2} a_{x} u_{xx} + \\frac{1}{2} a_{xx} u_{x} \\right) \\Delta^{3} \\right] + \\mathcal{O}(\\Delta^{4}).\n\\end{align*}\n相减得到\n\\begin{align*}\nu_{i}^{*} - u_{i-1}^{*} = u_{x} \\Delta - \\frac{1}{2} u_{xx} \\Delta^{2} + \\frac{1}{6} u_{xxx} \\Delta^{3} \\\\\n\\quad + \\lambda \\left[ \\left( - a u_{xx} - a_{x} u_{x} \\right) \\Delta^{2} + \\left( \\frac{1}{2} a_{x} u_{xx} + \\frac{1}{2} a_{xx} u_{x} \\right) \\Delta^{3} \\right] + \\mathcal{O}(\\Delta^{4}).\n\\end{align*}\n现在构造校正步：\n\\begin{align*}\nu_{i}^{n+1} = \\frac{1}{2} \\left\\{ \\left[ u + u_{i}^{*} \\right] - \\lambda a \\left[ u_{i}^{*} - u_{i-1}^{*} \\right] \\right\\} \\\\\n= \\frac{1}{2} \\left\\{ 2 u - \\lambda a \\left( u_{x} \\Delta + \\frac{1}{2} u_{xx} \\Delta^{2} + \\frac{1}{6} u_{xxx} \\Delta^{3} \\right) - \\lambda a \\left[ u_{x} \\Delta - \\frac{1}{2} u_{xx} \\Delta^{2} + \\frac{1}{6} u_{xxx} \\Delta^{3} \\right] \\right. \\\\\n\\qquad \\left. - \\lambda^{2} a \\left[ \\left( - a u_{xx} - a_{x} u_{x} \\right) \\Delta^{2} + \\left( \\frac{1}{2} a_{x} u_{xx} + \\frac{1}{2} a_{xx} u_{x} \\right) \\Delta^{3} \\right] \\right\\} + \\mathcal{O}(\\Delta^{4}).\n\\end{align*}\n简化主导项：\n$$\nu_{i}^{n+1} = u - \\lambda a \\, u_{x} \\Delta - \\frac{1}{6} \\lambda a \\, u_{xxx} \\Delta^{3} - \\frac{1}{2} \\lambda^{2} a \\left( - a u_{xx} - a_{x} u_{x} \\right) \\Delta^{2} + \\mathcal{O}(\\Delta^{3}, \\lambda^{2} \\Delta^{3}).\n$$\n由于 $\\lambda \\Delta = \\Delta t$，该格式生成的最低阶时间增量为 $- a u_{x} \\Delta t$。然而，根据守恒律，真实的时间导数为 $u_{t} = - (a u)_{x} = - a u_{x} - a_{x} u$。因此，在 $\\Delta t$ 阶的局部截断误差中包含一个未被抵消的项 $+ a_{x} u \\, \\Delta t$。这是一个一阶项，表明当 $a_{x} \\neq 0$ 时，使用朴素MacCormack格式离散化非守恒形式 $u_{t} + a(x) u_{x} = 0$ 会失去与守恒律的一致性，因此在存在系数梯度的情况下无法达到二阶精度。\n\n构造考虑了系数变化的守恒型MacCormack格式及其组合更新：\n\n为了恢复二阶精度和与守恒律的一致性，我们使用单元中心的通量 $f_{i}^{n} = a_{i} \\, u_{i}^{n}$，以守恒形式进行离散化。预测-校正格式为\n$$\nu_{i}^{*} = u_{i}^{n} - \\lambda \\left( f_{i+1}^{n} - f_{i}^{n} \\right) = u_{i}^{n} - \\lambda \\left( a_{i+1} u_{i+1}^{n} - a_{i} u_{i}^{n} \\right),\n$$\n$$\nu_{i}^{n+1} = \\frac{1}{2} \\left[ u_{i}^{n} + u_{i}^{*} - \\lambda \\left( f_{i}^{*} - f_{i-1}^{*} \\right) \\right],\n$$\n其中 $f_{i}^{*} = a_{i} \\, u_{i}^{*}$（因为 $a$ 不随时间变化）。消去预测变量，我们得到\n\\begin{align*}\nf_{i}^{*} = a_{i} u_{i}^{*} = a_{i} u_{i}^{n} - \\lambda a_{i} \\left( a_{i+1} u_{i+1}^{n} - a_{i} u_{i}^{n} \\right), \\\\\nf_{i-1}^{*} = a_{i-1} u_{i-1}^{*} = a_{i-1} u_{i-1}^{n} - \\lambda a_{i-1} \\left( a_{i} u_{i}^{n} - a_{i-1} u_{i-1}^{n} \\right).\n\\end{align*}\n将其代入校正步，并与预测步结合，以写出单步更新式。首先计算 $u_{i}^{n} + u_{i}^{*}$：\n$$\nu_{i}^{n} + u_{i}^{*} = 2 u_{i}^{n} - \\lambda \\left( a_{i+1} u_{i+1}^{n} - a_{i} u_{i}^{n} \\right).\n$$\n接着计算 $f_{i}^{*} - f_{i-1}^{*}$：\n\\begin{align*}\nf_{i}^{*} - f_{i-1}^{*} = \\left( a_{i} u_{i}^{n} - a_{i-1} u_{i-1}^{n} \\right) - \\lambda \\left[ a_{i} \\left( a_{i+1} u_{i+1}^{n} - a_{i} u_{i}^{n} \\right) - a_{i-1} \\left( a_{i} u_{i}^{n} - a_{i-1} u_{i-1}^{n} \\right) \\right].\n\\end{align*}\n因此，\n\\begin{align*}\nu_{i}^{n+1} = \\frac{1}{2} \\left\\{ 2 u_{i}^{n} - \\lambda \\left( a_{i+1} u_{i+1}^{n} - a_{i} u_{i}^{n} \\right) - \\lambda \\left[ \\left( a_{i} u_{i}^{n} - a_{i-1} u_{i-1}^{n} \\right) - \\lambda \\left( a_{i} \\left( a_{i+1} u_{i+1}^{n} - a_{i} u_{i}^{n} \\right) - a_{i-1} \\left( a_{i} u_{i}^{n} - a_{i-1} u_{i-1}^{n} \\right) \\right) \\right] \\right\\} \\\\\n= u_{i}^{n} - \\frac{\\lambda}{2} \\left( a_{i+1} u_{i+1}^{n} - a_{i-1} u_{i-1}^{n} \\right) + \\frac{\\lambda^{2}}{2} \\left[ a_{i} a_{i+1} u_{i+1}^{n} - \\left( a_{i}^{2} + a_{i-1} a_{i} \\right) u_{i}^{n} + a_{i-1}^{2} u_{i-1}^{n} \\right].\n\\end{align*}\n这个显式更新仅使用 $i-1$、$i$ 和 $i+1$ 处的值以及局部系数 $a_{i-1}$、$a_{i}$、$a_{i+1}$，并且与守恒形式相符。一个与上述类似的泰勒分析（但这次是对通量 $f = a u$ 进行）表明，一阶时间增量为 $- \\Delta t (a u)_{x}$（正确），并且在光滑性条件下，主导的局部截断误差为 $\\mathcal{O}(\\Delta t^{2}, \\Delta x^{2})$ 阶，从而恢复了二阶精度。\n\n所要求的考虑了系数变化的守恒型MacCormack组合更新的最终表达式就是上面给出的 $u_{i}^{n+1}$ 的封闭形式解析更新式。", "answer": "$$\\boxed{u_{i}^{n+1} = u_{i}^{n} - \\frac{\\lambda}{2}\\left(a_{i+1} u_{i+1}^{n} - a_{i-1} u_{i-1}^{n}\\right) + \\frac{\\lambda^{2}}{2}\\left[a_{i} a_{i+1} u_{i+1}^{n} - \\left(a_{i}^{2} + a_{i-1} a_{i}\\right) u_{i}^{n} + a_{i-1}^{2} u_{i-1}^{n}\\right]}$$", "id": "3342575"}, {"introduction": "一个双曲方程求解器的真正考验在于其处理激波等不连续性的能力，而激波是可压缩流动的核心特征。这个实践性的编程练习使用无粘性伯格斯方程作为非线性现象的模型。通过比较守恒形式与非守恒形式的麦考马克格式的实现，我们将直接观察到为何只有守恒形式才能正确捕捉激波的速度和位置，从而生动地展示计算物理学中的一个基本概念。[@problem_id:3342598]", "problem": "考虑守恒形式的一维无粘性 Burgers 方程，由 $u_t + \\left(\\frac{u^2}{2}\\right)_x = 0$ 给出，其中 $u = u(x,t)$ 表示周期性域上的标量速度场，空间坐标为 $x$。该守恒律在弱解意义下理解，因此可能出现间断解，并遵循由守恒原理推导出的积分平衡。通量函数为 $f(u) = \\frac{u^2}{2}$。对于满足 $u_L > u_R$ 的 Riemann 型初值数据，该方程允许出现激波，由 Rankine–Hugoniot 跳跃条件决定的激波速度为 $s = \\frac{f(u_L) - f(u_R)}{u_L - u_R} = \\frac{u_L + u_R}{2}$。\n\nMacCormack 预测-校正格式用于推进双曲型偏微分方程的求解。在守恒律形式下，MacCormack 方法通过使用通量的向前空间差分进行预测，并使用预测通量的向后差分进行校正来推进求解。一种非守恒变体则使用非守恒微分形式 $u_t + u\\,u_x = 0$ 来推进变量，将向前和向后差分应用于 $u$ 而不是通量 $f(u)$。对于间断解，只有守恒格式能确保从积分守恒律推导出的正确激波运动，而非守恒格式不保证能以正确的速度传播激波。\n\n你的任务是构造一个反例，证明对于无粘性 Burgers 方程，与守恒的 MacCormack 更新和 Rankine–Hugoniot 解析速度相比，非守恒的 MacCormack 更新会产生不正确的激波位置。请按以下步骤进行：\n\n1. 使用长度为 $L = 2$ 的周期性域，等同于区间 $[-1,1)$。设 $N$ 为均匀分布的网格点数，则 $\\Delta x = L/N$。在单元中心 $x_i = -L/2 + i\\,\\Delta x$（其中 $i = 0,1,\\dots,N-1$）处表示数值。\n\n2. 在时间 $t=0$ 时，初始化一个在 $x = x_0$ 处具有单个间断的 Riemann 数据，定义为\n   $$\n   u(x,0) = \n   \\begin{cases}\n   u_L,  x  x_0, \\\\\n   u_R,  x \\ge x_0,\n   \\end{cases}\n   $$\n   在区间 $[-1,1)$ 外进行周期性延拓。\n\n3. 实现两个显式 MacCormack 预测-校正格式，使用恒定时间步长 $\\Delta t$，该步长满足基于最大特征速度的 Courant–Friedrichs–Lewy 条件。使用无量纲 Courant 数 $\\text{CFL}$ 并设置 $\\Delta t = \\text{CFL}\\,\\Delta x / \\max(|u_L|,|u_R|)$。\n   - 守恒 MacCormack：使用通量函数 $f(u) = \\frac{u^2}{2}$ 的向前和向后差分进行预测和校正，确保离散化与守恒律一致。\n   - 非守恒 MacCormack：在非守恒形式 $u_t + u\\,u_x = 0$ 中，使用原始变量 $u$ 的向前和向后差分进行预测和校正。\n\n4. 对每个格式推进 $n$ 步，其中 $n = \\lceil T/\\Delta t \\rceil$，得到最终时间 $t_{\\text{end}} = n\\,\\Delta t$。\n\n5. 对于每个格式，在 $t_{\\text{end}}$ 时刻估算数值激波位置。方法是找出解在相邻网格点之间穿过中点值 $m = \\frac{u_L + u_R}{2}$ 的位置 $x$，并使用单元中心之间的线性插值。如果由于周期性或数值振荡存在多个穿越点，则选择其位置与解析激波位置的周期性距离最小的那个穿越点。如果未检测到穿越点，则通过离散梯度的最大幅值位置来近似激波位置，然后使用局部插值进行精化。\n\n6. 使用 Rankine–Hugoniot 速度 $s = \\frac{u_L + u_R}{2}$ 计算解析激波位置，即 $x_{\\text{exact}}(t_{\\text{end}}) = x_0 + s\\,t_{\\text{end}}$，并对域长度 $L$ 取模将位置解释在 $[-1,1)$ 内。\n\n7. 对于每个测试用例，分别报告守恒和非守恒 MacCormack 格式在 $t_{\\text{end}}$ 时刻的数值激波位置与解析激波位置之间的绝对周期性距离。\n\n使用以下测试套件，其中包括一个清晰的激波传播、一个中等强度的激波和一个静止激波：\n- 案例 1：$u_L = 2.0$, $u_R = 0.0$, $x_0 = 0.0$, $N = 1000$, $T = 0.3$, $\\text{CFL} = 0.4$。\n- 案例 2：$u_L = 1.5$, $u_R = 0.5$, $x_0 = -0.2$, $N = 1000$, $T = 0.5$, $\\text{CFL} = 0.4$。\n- 案例 3：$u_L = 1.0$, $u_R = -1.0$, $x_0 = 0.3$, $N = 1000$, $T = 0.4$, $\\text{CFL} = 0.4$。\n\n所有量均为无量纲；不需要物理单位。你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按每个案例的守恒误差后跟非守恒误差的顺序排列结果，即 $[e_{\\text{cons},1},e_{\\text{noncons},1},e_{\\text{cons},2},e_{\\text{noncons},2},e_{\\text{cons},3},e_{\\text{noncons},3}]$，其中每个 $e$ 是一个浮点数，表示相应格式和案例在最终时刻计算出的激波位置与解析激波位置之间的绝对周期性距离。", "solution": "该问题要求构造一个数值反例，以证明与守恒格式不同，非守恒有限差分格式无法正确计算无粘性 Burgers 方程的激波速度。这将通过实现和比较 MacCormack 方法的两种变体来完成。\n\n一维无粘性 Burgers 方程的守恒律形式为\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial}{\\partial x} \\left( \\frac{u^2}{2} \\right) = 0\n$$\n其中 $u(x,t)$ 是速度，通量函数为 $f(u) = \\frac{u^2}{2}$。对于导数存在的光滑解，可以应用链式法则得到非守恒形式：\n$$\n\\frac{\\partial u}{\\partial t} + u \\frac{\\partial u}{\\partial x} = 0\n$$\n然而，像 Burgers 方程这样的双曲守恒律，即使从光滑的初值数据出发，也会产生间断（激波）。对于间断解，微分形式没有明确定义，必须参考守恒律的积分形式。间断的动力学由 Rankine–Hugoniot 跳跃条件决定，该条件是积分形式的直接推论。对于一个以速度 $s$ 移动、分隔两个常数状态 $u_L$（左）和 $u_R$（右）的激波，该条件为：\n$$\ns = \\frac{f(u_L) - f(u_R)}{u_L - u_R}\n$$\n对于 Burgers 方程，这给出了解析激波速度：\n$$\ns = \\frac{\\frac{1}{2}u_L^2 - \\frac{1}{2}u_R^2}{u_L - u_R} = \\frac{u_L + u_R}{2}\n$$\n数值格式必须以“守恒形式”构建，以确保其解收敛到满足此跳跃条件的弱解。非守恒格式不遵守积分平衡，通常会收敛到一个具有不正确激波速度的解。\n\n我们将使用 $N$ 个均匀间隔的单元中心 $x_i = -L/2 + i \\Delta x$（其中 $i = 0, \\dots, N-1$，$\\Delta x = L/N$）来离散化长度为 $L=2$ 的空间域 $x \\in [-1, 1)$。时间步长 $\\Delta t$ 由 Courant–Friedrichs–Lewy (CFL) 条件决定，$\\Delta t = \\text{CFL} \\Delta x / \\max(|u_L|, |u_R|)$，以确保数值稳定性。\n\n初始条件是一个在 $x=x_0$ 处具有阶跃间断的 Riemann 问题：\n$$\nu(x,0) = \n\\begin{cases}\nu_L,  x  x_0, \\\\\nu_R,  x \\ge x_0,\n\\end{cases}\n$$\n我们将解推进到最终时间 $t_{\\text{end}} = n \\Delta t$，其中 $n = \\lceil T/\\Delta t \\rceil$。\n\n两种 MacCormack 格式的实现如下。设 $u_i^n$ 为网格点 $i$ 和时间 $t^n = n \\Delta t$ 处的数值解。\n\n**1. 守恒 MacCormack 格式**\n该格式离散化守恒律 $u_t + f(u)_x=0$。\n*   预测步（对通量使用向前差分）：\n    $$\n    u_i^* = u_i^n - \\frac{\\Delta t}{\\Delta x} \\left( f(u_{i+1}^n) - f(u_i^n) \\right)\n    $$\n*   校正步（对预测通量使用向后差分）：\n    $$\n    u_i^{n+1} = \\frac{1}{2} \\left( u_i^n + u_i^* - \\frac{\\Delta t}{\\Delta x} \\left( f(u_i^*) - f(u_{i-1}^*) \\right) \\right)\n    $$\n此处，索引按周期性处理，例如 $u_{N} = u_0$ 和 $u_{-1} = u_{N-1}$。该格式是守恒形式的，在网格加密的极限情况下，有望计算出正确的激波速度。\n\n**2. 非守恒 MacCormack 格式**\n该格式离散化非守恒形式 $u_t + u u_x=0$。\n*   预测步（对 $u$ 使用向前差分）：\n    $$\n    u_i^* = u_i^n - u_i^n \\frac{\\Delta t}{\\Delta x} (u_{i+1}^n - u_i^n)\n    $$\n*   校正步（对预测的 $u$ 使用向后差分）：\n    $$\n    u_i^{n+1} = \\frac{1}{2} \\left( u_i^n + u_i^* - u_i^* \\frac{\\Delta t}{\\Delta x} (u_i^* - u_{i-1}^*) \\right)\n    $$\n这种构造没有在单元界面上离散化通量差分，因此不强制执行局部守恒性质。结果是，它不能保证捕捉到正确的激波动力学。\n\n在用两种格式将解演化到 $t_{\\text{end}}$ 后，我们确定数值激波位置。这是通过找到数值解剖面穿过中点值 $m = (u_L + u_R)/2$ 的位置来完成的。我们使用包围穿越点的两个网格点进行线性插值。如果由于数值振荡出现多个穿越点，我们选择在周期性域上离解析激波位置 $x_{\\text{analytical}}(t_{\\text{end}}) = x_0 + s \\cdot t_{\\text{end}}$ 最近的那个。在长度为 $L$ 的域上，两点 $p_1$ 和 $p_2$ 之间的绝对周期性距离由 $\\min(|p_1 - p_2|, L - |p_1 - p_2|)$ 给出。\n\n然后，将每个格式的误差计算为其计算出的数值激波位置 $x_{\\text{numerical}}$ 与最终时间 $t_{\\text{end}}$ 的解析激波位置 $x_{\\text{analytical}}$ 之间的绝对周期性距离。三个测试用例的结果将表明，非守恒格式的误差远大于守恒格式的误差，从而证实前者计算出了不正确的激波速度。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nimport math\n\ndef solve():\n    \"\"\"\n    Solves the 1D inviscid Burgers' equation using conservative and nonconservative\n    MacCormack schemes to demonstrate the importance of conservation form\n    for shock capturing.\n    \"\"\"\n    test_cases = [\n        # (u_L, u_R, x_0, N, T, CFL)\n        (2.0, 0.0, 0.0, 1000, 0.3, 0.4),\n        (1.5, 0.5, -0.2, 1000, 0.5, 0.4),\n        (1.0, -1.0, 0.3, 1000, 0.4, 0.4),\n    ]\n\n    results = []\n\n    for u_L, u_R, x_0, N, T, CFL in test_cases:\n        L = 2.0\n        dx = L / N\n        x = -L/2 + np.arange(N) * dx\n        \n        # CFL condition and time steps\n        max_speed = max(abs(u_L), abs(u_R))\n        if max_speed == 0:\n            # Avoid division by zero if max speed is zero, choose a reasonable dt\n            max_speed = 1.0\n        dt = CFL * dx / max_speed\n        num_steps = math.ceil(T / dt)\n        t_end = num_steps * dt\n\n        # Initial condition\n        u0 = np.full(N, u_R, dtype=np.float64)\n        u0[x  x_0] = u_L\n        \n        u_cons = u0.copy()\n        u_noncons = u0.copy()\n\n        # --- Time evolution ---\n        for _ in range(num_steps):\n            # Conservative MacCormack\n            f = 0.5 * u_cons**2\n            # Predictor\n            u_star_c = u_cons - (dt / dx) * (np.roll(f, -1) - f)\n            # Corrector\n            f_star = 0.5 * u_star_c**2\n            u_cons = 0.5 * (u_cons + u_star_c - (dt / dx) * (f_star - np.roll(f_star, 1)))\n\n            # Nonconservative MacCormack\n            # Predictor\n            u_star_nc = u_noncons - u_noncons * (dt / dx) * (np.roll(u_noncons, -1) - u_noncons)\n            # Corrector\n            u_noncons = 0.5 * (u_noncons + u_star_nc - u_star_nc * (dt / dx) * (u_star_nc - np.roll(u_star_nc, 1)))\n        \n        # --- Analysis ---\n        # Analytical shock location\n        s = (u_L + u_R) / 2.0\n        x_analytical = x_0 + s * t_end\n        # Map to periodic domain [-L/2, L/2)\n        x_analytical = -L/2 + (x_analytical - (-L/2)) % L\n\n        midpoint_val = (u_L + u_R) / 2.0\n        \n        def find_shock_location(u_final, x_grid, L_domain, analytical_pos, dx_grid):\n            \"\"\"\n            Finds the numerical shock location by looking for a crossing of the\n            midpoint value, refined by linear interpolation.\n            \"\"\"\n            crossings = []\n            # Find all crossings of midpoint_val\n            for i in range(N):\n                u_i = u_final[i]\n                u_i_plus_1 = u_final[(i + 1) % N]\n                if (u_i - midpoint_val) * (u_i_plus_1 - midpoint_val) = 0 and u_i != u_i_plus_1:\n                    x_i = x_grid[i]\n                    x_cross = x_i + dx_grid * (midpoint_val - u_i) / (u_i_plus_1 - u_i)\n                    crossings.append(x_cross)\n\n            if crossings:\n                # Find crossing closest to analytical solution\n                min_dist = float('inf')\n                best_pos = crossings[0]\n                for pos in crossings:\n                    dist = abs(pos - analytical_pos)\n                    periodic_dist = min(dist, L_domain - dist)\n                    if periodic_dist  min_dist:\n                        min_dist = periodic_dist\n                        best_pos = pos\n                return best_pos\n            else:\n                # Fallback: max gradient\n                grad = np.abs(np.roll(u_final, -1) - u_final)\n                max_grad_idx = np.argmax(grad)\n                \n                u_a = u_final[max_grad_idx]\n                u_b = u_final[(max_grad_idx + 1) % N]\n                x_a = x_grid[max_grad_idx]\n                \n                if abs(u_b - u_a)  1e-9: # Avoid division by zero\n                    return x_a + dx_grid / 2.0\n                \n                x_pos = x_a + dx_grid * (midpoint_val - u_a) / (u_b - u_a)\n                return x_pos\n\n        def periodic_map(pos, length):\n            \"\"\"Maps a position to the periodic interval [-length/2, length/2).\"\"\"\n            return -length/2 + (pos - (-length/2)) % length\n\n        x_num_cons = find_shock_location(u_cons, x, L, x_analytical, dx)\n        x_num_noncons = find_shock_location(u_noncons, x, L, x_analytical, dx)\n        \n        x_num_cons = periodic_map(x_num_cons, L)\n        x_num_noncons = periodic_map(x_num_noncons, L)\n        \n        def periodic_distance(p1, p2, length):\n            \"\"\"Calculates the absolute periodic distance between two points.\"\"\"\n            dist = abs(p1 - p2)\n            return min(dist, length - dist)\n\n        error_cons = periodic_distance(x_num_cons, x_analytical, L)\n        error_noncons = periodic_distance(x_num_noncons, x_analytical, L)\n\n        results.extend([error_cons, error_noncons])\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3342598"}]}