{"hands_on_practices": [{"introduction": "在计算流体力学中，任何新数值格式的第一步都是验证其理论准确性。本练习将指导您实现一个二阶迎风格式，并采用一种标准的验证技术——“人造解方法”（Method of Manufactured Solutions）——来确认其收敛阶。通过在逐渐加密的网格上运行仿真并测量误差，我们可以计算出数值收敛率，并检验它是否符合理论预期的二阶精度 [@problem_id:3360956]。这项实践不仅能构建基本的编码能力，还介绍了在整个计算科学领域中至关重要的验证与确认（VV）技术。", "problem": "考虑一维线性平流方程 $u_t + a u_x = 0$，其定义在周期性域 $[0,L)$ 上，并具有恒定的平流速度 $a \\in \\mathbb{R}\\setminus\\{0\\}$。您将使用制造解方法（Method of Manufactured Solutions）来设计一个光滑的周期性精确解，然后对一个全离散格式进行网格加密研究。该格式在空间上使用二阶迎风离散，并使用一个高阶显式时间积分器，其时间步长足够小，以使时间误差相对于空间离散误差可以忽略不计。\n\n从基本守恒定律和常系数平流模型出发，利用周期性边界条件和光滑周期函数的定义，构造一个在所有 $t \\ge 0$ 时都满足 $u_t + a u_x = 0$ 的制造解：\n- 选择制造的初始条件 $u(x,0) = \\sin\\!\\big(2\\pi x/L\\big) + \\tfrac{1}{4}\\cos\\!\\big(6\\pi x/L\\big)$，其中所有三角函数参数均以弧度为单位。那么，在周期性条件下，对于任意 $t \\ge 0$，其精确解为 $u_{\\text{exact}}(x,t) = \\sin\\!\\big(2\\pi (x - a t)/L\\big) + \\tfrac{1}{4}\\cos\\!\\big(6\\pi (x - a t)/L\\big)$。\n\n在均匀网格 $x_i = i \\Delta x$（$i=0,\\dots,N-1$）上进行空间离散，其中 $\\Delta x = L/N$，并使用周期性环绕索引。使用二阶迎风有限差分算子来离散空间导数 $u_x$：\n- 对于 $a > 0$，\n$$\n\\left(D_x u\\right)_i \\;=\\; \\frac{3 u_i - 4 u_{i-1} + u_{i-2}}{2\\,\\Delta x}.\n$$\n- 对于 $a < 0$，\n$$\n\\left(D_x u\\right)_i \\;=\\; \\frac{-3 u_i + 4 u_{i+1} - u_{i+2}}{2\\,\\Delta x}.\n$$\n对所有 $i$ 使用周期性边界条件来定义 $u_{i\\pm 1}$ 和 $u_{i\\pm 2}$。\n\n使用三阶强稳定性保持（SSP）Runge–Kutta 方法（也称为 Shu–Osher 形式）进行时间推进，对于半离散系统 $u_t = -a\\,D_x u$，其形式为\n$$\n\\begin{aligned}\nu^{(1)} = u^n + \\Delta t\\,\\mathcal{L}(u^n),\\\\\nu^{(2)} = \\tfrac{3}{4}u^n + \\tfrac{1}{4}\\left(u^{(1)} + \\Delta t\\,\\mathcal{L}(u^{(1)})\\right),\\\\\nu^{n+1} = \\tfrac{1}{3}u^n + \\tfrac{2}{3}\\left(u^{(2)} + \\Delta t\\,\\mathcal{L}(u^{(2)})\\right),\n\\end{aligned}\n$$\n其中 $\\mathcal{L}(u) = -a\\,D_x u$。选择时间步长 $\\Delta t = \\text{CFL}\\,\\Delta x/|a|$，Courant–Friedrichs–Lewy (CFL) 数为 $\\text{CFL} = 0.3$，这样当 $\\Delta x \\to 0$ 时，$\\mathcal{O}(\\Delta t^3)$ 阶的时间误差与 $\\mathcal{O}(\\Delta x^2)$ 阶的空间误差相比可以忽略不计。\n\n对于给定的最终时间 $T>0$，计算数值解 $u^N_i \\approx u(x_i,T)$，并测量离散 $L^2$ 误差\n$$\nE(N) \\;=\\; \\left(\\sum_{i=0}^{N-1}\\left(u^N_i - u_{\\text{exact}}(x_i,T)\\right)^2\\Delta x\\right)^{1/2}.\n$$\n使用加密比 $r=2$ 和连续的网格 $N, 2N, 4N, 8N$，通过对相继网格进行 Richardson 外推来估计观测到的空间阶 $p$，\n$$\np(N \\to 2N) \\;=\\; \\frac{\\ln\\!\\left(\\dfrac{E(N)}{E(2N)}\\right)}{\\ln(2)}.\n$$\n为最小化粗网格前渐近效应可能带来的任何影响，请报告每个测试用例中最细网格对的估计值 $p(4N \\to 8N)$ 作为观测阶。\n\n将上述内容实现为一个完整、可运行的程序，该程序：\n- 使用上述的制造解。\n- 采用指定的二阶迎风空间离散和三阶 SSP Runge–Kutta 时间积分器。\n- 使用带周期性边界条件的均匀网格。\n- 使用 $\\Delta t = 0.3\\,\\Delta x/|a|$。\n- 计算 $N \\in \\{64,128,256,512\\}$ 时的 $E(N)$，并输出基于 $E(256)$ 和 $E(512)$ 的 Richardson 估计值。\n\n测试套件：\n提供以下三个参数集的结果，这三个参数集共同测试了一个代表性用例、一个负平流用例和一个单周期输运用例：\n- 用例 A（代表性用例）：$a = 1.3$, $L = 1.0$, $T = 0.3$。\n- 用例 B（负平流）：$a = -0.7$, $L = 1.0$, $T = 0.25$。\n- 用例 C（单周期）：$a = 1.0$, $L = 1.0$, $T = 1.0$。\n\n角度单位：所有三角函数均使用弧度。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含对应于用例 A、B 和 C 的三个观测阶，形式为用方括号括起来的逗号分隔的十进制数列表，例如 $[p_A,p_B,p_C]$。这些值应为十进制浮点数。不应打印任何额外文本。", "solution": "在尝试求解之前，需对问题进行验证。\n\n### 步骤 1：提取已知条件\n- **控制方程**：一维线性平流方程，$u_t + a u_x = 0$。\n- **域**：周期性，$[0, L)$。\n- **平流速度**：恒定，$a \\in \\mathbb{R}\\setminus\\{0\\}$。\n- **方法论**：制造解方法。\n- **初始条件**：$u(x,0) = \\sin(2\\pi x/L) + \\tfrac{1}{4}\\cos(6\\pi x/L)$。所有三角函数参数均以弧度为单位。\n- **精确解**：$u_{\\text{exact}}(x,t) = \\sin(2\\pi (x - a t)/L) + \\tfrac{1}{4}\\cos(6\\pi (x - a t)/L)$。\n- **空间网格**：均匀网格 $x_i = i \\Delta x$（$i=0,\\dots,N-1$），其中 $\\Delta x = L/N$。\n- **空间离散**：二阶迎风有限差分算子。\n  - 对于 $a > 0$：$\\left(D_x u\\right)_i = \\frac{3 u_i - 4 u_{i-1} + u_{i-2}}{2\\,\\Delta x}$。\n  - 对于 $a < 0$：$\\left(D_x u\\right)_i = \\frac{-3 u_i + 4 u_{i+1} - u_{i+2}}{2\\,\\Delta x}$。\n- **边界条件**：模板运算采用周期性边界。\n- **时间积分**：三阶强稳定性保持（SSP）Runge–Kutta，又名 Shu–Osher 形式，用于 $u_t = \\mathcal{L}(u) = -a\\,D_x u$：\n  $$\n  \\begin{aligned}\n  u^{(1)} = u^n + \\Delta t\\,\\mathcal{L}(u^n),\\\\\n  u^{(2)} = \\tfrac{3}{4}u^n + \\tfrac{1}{4}\\left(u^{(1)} + \\Delta t\\,\\mathcal{L}(u^{(1)})\\right),\\\\\n  u^{n+1} = \\tfrac{1}{3}u^n + \\tfrac{2}{3}\\left(u^{(2)} + \\Delta t\\,\\mathcal{L}(u^{(2)})\\right).\n  \\end{aligned}\n  $$\n- **时间步长**：$\\Delta t = \\text{CFL}\\,\\Delta x/|a|$，其中 $\\text{CFL} = 0.3$。\n- **误差度量**：离散 $L^2$ 误差，$E(N) = \\left(\\sum_{i=0}^{N-1}\\left(u^N_i - u_{\\text{exact}}(x_i,T)\\right)^2\\Delta x\\right)^{1/2}$。\n- **收敛性分析**：\n  - 使用 $N \\in \\{64, 128, 256, 512\\}$ 进行网格加密研究。\n  - 观测阶估计：$p(N \\to 2N) = \\frac{\\ln(E(N)/E(2N))}{\\ln(2)}$。\n  - 报告的阶：最细网格对的估计值，$p(256 \\to 512)$。\n- **测试用例**：\n  - 用例 A：$a = 1.3$, $L = 1.0$, $T = 0.3$。\n  - 用例 B：$a = -0.7$, $L = 1.0$, $T = 0.25$。\n  - 用例 C：$a = 1.0$, $L = 1.0$, $T = 1.0$。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题在科学上和数学上是合理的。\n1.  **科学依据**：该问题涉及线性平流方程的数值解，这是输运现象中的一个基本模型。所有指定的组成部分——制造解方法、迎风有限差分格式和 SSP Runge-Kutta 方法——都是计算物理和数值分析中标准且有据可查的技术。所提供的公式是这些方法的正确表示。\n2.  **适定性**：该问题是适定的。具有光滑、周期性初始条件的线性平流方程存在唯一、稳定的解析解。数值格式也定义良好，并指定了稳定的时间步长（CFL 数为 $0.3$，完全在组合格式的稳定性极限内）。任务是计算一个特定、唯一定义的数值量（即观测到的精度阶）。\n3.  **完整性和一致性**：该问题是自洽的。它提供了所有必要的参数（$a, L, T$）、函数（$u_{\\text{exact}}$）、离散格式、误差度量和分析步骤。其中没有矛盾之处。\n4.  **客观性**：该问题以精确、客观和定量的术语陈述，没有任何模糊性或主观因素。\n\n### 步骤 3：结论与行动\n该问题被认为是**有效的**。将提供一个解决方案。\n\n### 解决方案\n\n该问题要求为周期域上的一维线性平流方程 $u_t + a u_x = 0$ 实现数值模拟。目标是使用制造解方法验证二阶迎风格式的空间精度阶。\n\n**1. 制造解**\n提供的精确解为 $u_{\\text{exact}}(x,t) = \\sin(k_1(x-at)) + \\tfrac{1}{4}\\cos(k_2(x-at))$，其中 $k_1 = 2\\pi/L$ 和 $k_2 = 6\\pi/L$。该函数是两个行波的叠加，这是线性平流方程解的特征形式。我们可以验证它满足该偏微分方程（PDE）：\n$$ \\frac{\\partial u_{\\text{exact}}}{\\partial t} = -a k_1 \\cos(k_1(x-at)) + \\frac{1}{4} a k_2 \\sin(k_2(x-at)) $$\n$$ \\frac{\\partial u_{\\text{exact}}}{\\partial x} = k_1 \\cos(k_1(x-at)) - \\frac{1}{4} k_2 \\sin(k_2(x-at)) $$\n将这些代入 PDE 得到 $u_t + a u_x = (-a k_1 \\cos(\\cdot) + a k_1 \\cos(\\cdot)) + (\\tfrac{1}{4} a k_2 \\sin(\\cdot) - \\tfrac{1}{4} a k_2 \\sin(\\cdot)) = 0$。波数 $k_1$ 和 $k_2$ 是 $2\\pi/L$ 的整数倍，确保解在域 $[0, L)$ 上是周期性的。\n\n**2. 半离散化**\n域 $[0, L)$ 被离散化为一个包含 $N$ 个点的均匀网格，$x_i = i \\Delta x$（$i = 0, \\dots, N-1$），其中 $\\Delta x = L/N$。在给定时间，这些网格点上的解由向量 $u(t) = [u_0(t), u_1(t), \\dots, u_{N-1}(t)]^T$ 表示。\n空间导数 $u_x$ 由有限差分算子 $D_x$ 近似。问题指定了一个二阶迎风格式，其模板取决于平流速度 $a$ 的符号，以确保信息从波的传播方向提取。\n\n对于 $a > 0$（信息从左向右传播），算子为：\n$$ (D_x u)_i = \\frac{3 u_i - 4 u_{i-1} + u_{i-2}}{2 \\Delta x} $$\n对于 $a < 0$（信息从右向左传播），算子为：\n$$ (D_x u)_i = \\frac{-3 u_i + 4 u_{i+1} - u_{i+2}}{2 \\Delta x} $$\n通过对索引使用模运算来施加周期性边界条件。例如，$u_{-1}$ 被理解为 $u_{N-1}$，$u_{N}$ 被理解为 $u_0$。\n\n这导出了一个常微分方程组（ODEs），称为半离散形式：\n$$ \\frac{d u}{d t} = -a (D_x u) \\equiv \\mathcal{L}(u) $$\n\n**3. 时间离散化**\n该常微分方程组使用指定的三阶强稳定性保持 Runge-Kutta (SSP3) 方法从 $t=0$ 积分到 $t=T$。给定时间 $t^n$ 的解向量 $u^n$，在时间 $t^{n+1} = t^n + \\Delta t$ 的解 $u^{n+1}$ 通过三个阶段计算：\n$$\n\\begin{aligned}\nu^{(1)} = u^n + \\Delta t\\,\\mathcal{L}(u^n) \\\\\nu^{(2)} = \\frac{3}{4}u^n + \\frac{1}{4}\\left(u^{(1)} + \\Delta t\\,\\mathcal{L}(u^{(1)})\\right) \\\\\nu^{n+1} = \\frac{1}{3}u^n + \\frac{2}{3}\\left(u^{(2)} + \\Delta t\\,\\mathcal{L}(u^{(2)})\\right)\n\\end{aligned}\n$$\n时间步长选择为 $\\Delta t = 0.3 \\Delta x / |a|$。由于空间格式是 $\\mathcal{O}(\\Delta x^2)$，时间格式是 $\\mathcal{O}(\\Delta t^3)$，并且 $\\Delta t \\propto \\Delta x$，因此当 $\\Delta x \\to 0$ 时，时间误差项 $\\mathcal{O}(\\Delta x^3)$ 将比空间误差项 $\\mathcal{O}(\\Delta x^2)$ 衰减得更快。因此，对于足够小的 $\\Delta x$，总误差将由空间离散误差主导，从而可以清晰地测量其收敛率。\n\n**4. 收敛性分析**\n模拟针对一系列网格分辨率 $N \\in \\{64, 128, 256, 512\\}$ 运行。对于每个 $N$，计算最终时间 $T$ 的数值解，记为 $u^N_i$。计算与精确解相比的离散 $L^2$ 误差：\n$$ E(N) = \\sqrt{\\Delta x \\sum_{i=0}^{N-1} (u^N_i - u_{\\text{exact}}(x_i, T))^2} $$\n假设误差遵循 $E(N) \\approx C (\\Delta x)^p = C (L/N)^p$ 的形式，其中 $C$ 为某个常数，$p$ 为精度阶，我们可以通过比较来自两个不同分辨率 $N_1$ 和 $N_2=r N_1$（其中 $r$ 是加密比）的误差来求得 $p$。\n$$ \\frac{E(N_1)}{E(N_2)} \\approx \\frac{C (L/N_1)^p}{C (L/(rN_1))^p} = r^p $$\n对两边取对数得到 $\\ln(E(N_1)/E(N_2)) \\approx p \\ln(r)$。问题指定 $r=2$，从而得到观测收敛阶的公式：\n$$ p = \\frac{\\ln(E(N)/E(2N))}{\\ln(2)} $$\n为了获得渐近阶的更准确估计，我们使用最细网格的结果，即 $N=256$ 和 $2N=512$。\n\n总体算法如下：\n1. 对于每个测试用例 $(a, L, T)$，创建一个字典或列表来存储误差。\n2. 对于每个网格尺寸 $N \\in \\{64, 128, 256, 512\\}$：\n    a. 定义计算网格 $x$ 和空间步长 $\\Delta x$。\n    b. 从 $u_{\\text{exact}}(x, 0)$ 设置初始条件 $u$。\n    c. 根据 CFL 条件设置时间步长 $\\Delta t$。\n    d. 使用 SSP3 积分器将解从 $t=0$ 演化到 $t=T$，确保最后的时间步长正好落在 $T$ 上。\n    e. 通过将最终数值解与 $u_{\\text{exact}}(x, T)$ 进行比较来计算 $L^2$ 误差 $E(N)$。存储此误差。\n3. 使用存储的 $N=256$ 和 $N=512$ 的误差计算观测阶 $p$。\n4. 收集所有三个测试用例的阶 $p$ 并格式化输出。\n此过程将在提供的 Python 脚本中实现。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D linear advection equation using a second-order upwind scheme\n    and third-order SSP Runge-Kutta time integration. It performs a grid\n    refinement study to measure the observed order of spatial accuracy.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case A (representative)\n        {'a': 1.3, 'L': 1.0, 'T': 0.3, 'label': 'A'},\n        # Case B (negative advection)\n        {'a': -0.7, 'L': 1.0, 'T': 0.25, 'label': 'B'},\n        # Case C (one period)\n        {'a': 1.0, 'L': 1.0, 'T': 1.0, 'label': 'C'},\n    ]\n\n    # Grid sizes for the refinement study\n    N_values = [64, 128, 256, 512]\n    \n    # Courant–Friedrichs–Lewy (CFL) number\n    CFL = 0.3\n\n    results = []\n\n    def exact_solution(x, t, L, a):\n        \"\"\"Computes the manufactured exact solution.\"\"\"\n        k1 = 2.0 * np.pi / L\n        k2 = 6.0 * np.pi / L\n        return np.sin(k1 * (x - a * t)) + 0.25 * np.cos(k2 * (x - a * t))\n\n    def spatial_derivative(u, dx, a):\n        \"\"\"\n        Computes the second-order upwind spatial derivative on a periodic grid.\n        np.roll(u, k) shifts elements, effectively accessing u[i-k].\n        \"\"\"\n        if a > 0:\n            # Stencil uses points i, i-1, i-2. \n            # np.roll(u, 1) -> u_{i-1}, np.roll(u, 2) -> u_{i-2}\n            du_dx = (3.0 * u - 4.0 * np.roll(u, 1) + 1.0 * np.roll(u, 2)) / (2.0 * dx)\n        else: # a  0\n            # Stencil uses points i, i+1, i+2.\n            # np.roll(u, -1) - u_{i+1}, np.roll(u, -2) - u_{i+2}\n            du_dx = (-3.0 * u + 4.0 * np.roll(u, -1) - 1.0 * np.roll(u, -2)) / (2.0 * dx)\n        return du_dx\n\n    def l2_error(u_num, u_exact, dx):\n        \"\"\"Computes the discrete L2-error.\"\"\"\n        return np.sqrt(dx * np.sum((u_num - u_exact)**2))\n\n    for case in test_cases:\n        a = case['a']\n        L = case['L']\n        T = case['T']\n        \n        errors = {}\n\n        for N in N_values:\n            # 1. Setup grid and initial condition\n            dx = L / N\n            x = np.linspace(0.0, L, num=N, endpoint=False)\n            u = exact_solution(x, 0.0, L, a)\n\n            # 2. Setup time integration\n            dt = CFL * dx / np.abs(a)\n            t = 0.0\n\n            # 3. Main time-stepping loop\n            while t  T:\n                # Ensure the final time step hits T exactly\n                dt_effective = min(dt, T - t)\n                \n                # Define the spatial operator for the RK stages\n                def L_op(v):\n                    return -a * spatial_derivative(v, dx, a)\n\n                # SSP(3,3) Runge-Kutta stages\n                u1 = u + dt_effective * L_op(u)\n                u2 = 0.75 * u + 0.25 * (u1 + dt_effective * L_op(u1))\n                u = (1.0/3.0) * u + (2.0/3.0) * (u2 + dt_effective * L_op(u2))\n                \n                t += dt_effective\n\n            # 4. Compute and store the final error\n            u_ex_final = exact_solution(x, T, L, a)\n            errors[N] = l2_error(u, u_ex_final, dx)\n\n        # 5. Calculate the observed order of accuracy using the finest grid pair\n        E_256 = errors[256]\n        E_512 = errors[512]\n        \n        # p = log(E(N)/E(2N)) / log(2)\n        p = np.log(E_256 / E_512) / np.log(2.0)\n        results.append(p)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3360956"}, {"introduction": "在验证了格式的精度之后，我们必须理解其稳定性。显式时间推进方法对时间步长有限制，这受信著名的Courant–Friedrichs–Lewy (CFL) 条件制约。本练习将运用冯·诺依曼（von Neumann）稳定性分析来推导这些CFL极限 [@problem_id:3360952]。此过程涉及研究数值格式如何放大或衰减解的每个傅里叶模式，从而揭示其稳定性边界。这项练习让您深入了解离散算子的谱特性，并阐明为何迎风格式在稳定性方面与中心格式有根本不同——这是开发稳健CFD求解器的关键概念。", "problem": "考虑常平流速度 $a0$ 的一维线性平流方程，\n$$\nu_{t} + a\\,u_{x} = 0,\n$$\n该方程定义在周期性域上，并在间距为 $\\Delta x$ 的均匀网格上进行离散。令 Courant–Friedrichs–Lewy (CFL) 数为 $C \\equiv a\\,\\Delta t/\\Delta x$，其中 $\\Delta t$ 是时间步长。平流导数将使用两种空间离散格式：\n\n- 在网格点 $i$ 处，用于 $a0$ 的二阶迎风离散导数，\n$$\n\\left(u_{x}\\right)_{i} \\approx \\frac{3 u_{i} - 4 u_{i-1} + u_{i-2}}{2\\,\\Delta x},\n$$\n- 二阶中心离散导数，\n$$\n\\left(u_{x}\\right)_{i} \\approx \\frac{u_{i+1} - u_{i-1}}{2\\,\\Delta x}.\n$$\n\n时间积分采用显式两步 Runge–Kutta (RK2) 和显式三步 Runge–Kutta (RK3) 方法。对半离散系统使用 von Neumann (Fourier) 稳定性分析，并结合应用于线性测试方程的显式 Runge–Kutta 方法的线性稳定性函数，确定以下四种组合的最大稳定 CFL 数 $C_{\\max}$：\n1. RK2 与二阶迎风格式，\n2. RK3 与二阶迎风格式，\n3. RK2 与二阶中心格式，\n4. RK3 与二阶中心格式。\n\n您的推导必须从半离散算子的 Fourier 符号和 Runge–Kutta 稳定性多项式开始。然后，对于每种组合，确定使得相应稳定性条件对所有 Fourier 波数都成立的最大 $C$ 值。最后，按照上述顺序列出四个 $C_{\\max}$ 值，形式为单行矩阵。将您的答案四舍五入到四位有效数字。最终答案以无量纲数表示。", "solution": "我们从线性平流方程 $u_{t} + a\\,u_{x} = 0$ 开始，在均匀周期性网格上，该方程产生一个半离散的常微分方程组 (ODEs)。对于 von Neumann (Fourier) 分析，我们考虑形如 $u_{i}(t) = \\hat{u}(t)\\,\\exp\\!\\left(\\mathrm{i}\\,i\\,\\theta\\right)$ 的 Fourier 模，其中 $\\theta \\in [-\\pi,\\pi]$ 是无量纲波数。空间离散格式在 Fourier 模上是对角作用的，并由其符号来表征。\n\n1) 空间符号。\n\n- 对于二阶迎风导数（用于 $a0$），\n$$\n\\left(u_{x}\\right)_{i} \\approx \\frac{3 u_{i} - 4 u_{i-1} + u_{i-2}}{2\\,\\Delta x}.\n$$\n应用于 $u_{i} = \\hat{u}\\,\\exp(\\mathrm{i} i \\theta)$，我们得到符号\n$$\nD_{\\mathrm{up}}(\\theta) \\equiv \\frac{3 - 4\\,\\exp(-\\mathrm{i}\\theta) + \\exp(-2\\mathrm{i}\\theta)}{2\\,\\Delta x}.\n$$\n半离散常微分方程为 $u_{t} = -a\\,D_{\\mathrm{up}}(\\theta)\\,u$，因此特征值为\n$$\n\\sigma_{\\mathrm{up}}(\\theta) = -a\\,D_{\\mathrm{up}}(\\theta) = -\\frac{a}{\\Delta x}\\,\\frac{3 - 4\\,\\exp(-\\mathrm{i}\\theta) + \\exp(-2\\mathrm{i}\\theta)}{2}.\n$$\n定义 CFL 数 $C \\equiv a\\,\\Delta t/\\Delta x$，无量纲时间放大参数为\n$$\nz_{\\mathrm{up}}(\\theta) \\equiv \\Delta t\\,\\sigma_{\\mathrm{up}}(\\theta) = -C\\,S_{\\mathrm{up}}(\\theta), \\quad S_{\\mathrm{up}}(\\theta) \\equiv \\frac{3 - 4\\,\\exp(-\\mathrm{i}\\theta) + \\exp(-2\\mathrm{i}\\theta)}{2}.\n$$\n\n- 对于二阶中心导数，\n$$\n\\left(u_{x}\\right)_{i} \\approx \\frac{u_{i+1} - u_{i-1}}{2\\,\\Delta x}.\n$$\n应用于 $u_{i} = \\hat{u}\\,\\exp(\\mathrm{i} i \\theta)$，符号为\n$$\nD_{\\mathrm{c}}(\\theta) \\equiv \\frac{\\exp(\\mathrm{i}\\theta) - \\exp(-\\mathrm{i}\\theta)}{2\\,\\Delta x} = \\frac{\\mathrm{i}\\,\\sin\\theta}{\\Delta x}.\n$$\n因此，\n$$\n\\sigma_{\\mathrm{c}}(\\theta) = -a\\,D_{\\mathrm{c}}(\\theta) = -\\frac{a}{\\Delta x}\\,\\mathrm{i}\\,\\sin\\theta, \\quad\nz_{\\mathrm{c}}(\\theta) \\equiv \\Delta t\\,\\sigma_{\\mathrm{c}}(\\theta) = -\\mathrm{i}\\,C\\,\\sin\\theta.\n$$\n\n2) Runge–Kutta 稳定性多项式。\n\n对于线性常微分方程 $y'=\\lambda y$，应用一个显式 $s$ 步 Runge–Kutta 方法得到 $y^{n+1} = R(z)\\,y^{n}$，其中 $z\\equiv \\lambda\\,\\Delta t$，$R(z)$ 是一个多项式稳定性函数。对于显式两步 Runge–Kutta 方法（RK2，包括标准的强稳定性保持两步格式），稳定性多项式为\n$$\nR_{2}(z) = 1 + z + \\frac{z^{2}}{2}.\n$$\n对于显式三步 Runge–Kutta 方法（RK3，包括标准的强稳定性保持三步格式），线性问题的稳定性多项式为\n$$\nR_{3}(z) = 1 + z + \\frac{z^{2}}{2} + \\frac{z^{3}}{6}.\n$$\n稳定性要求对于半离散算子谱中的所有相关 $z$，$|R(z)| \\leq 1$。\n\n3) 稳定性分析与 $C_{\\max}$。\n\n- 迎风格式 + RK2 和 RK3：\n我们首先分析 $S_{\\mathrm{up}}(\\theta)$。其实部为\n$$\n\\Re\\{S_{\\mathrm{up}}(\\theta)\\} = \\frac{1}{2}\\bigl(3 - 4\\cos\\theta + \\cos 2\\theta\\bigr).\n$$\n对 $\\theta \\in [0,\\pi]$ 求导：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}\\theta}\\Re\\{S_{\\mathrm{up}}(\\theta)\\} = \\frac{1}{2}\\bigl(4\\sin\\theta - 2\\sin 2\\theta\\bigr) = 2\\sin\\theta\\,(1 - \\cos\\theta) \\ge 0,\n$$\n仅在 $\\theta=0$ 时等号成立。因此 $\\Re\\{S_{\\mathrm{up}}(\\theta)\\}$ 是递增的，并在 $\\theta=\\pi$ 处达到其最大值：\n$$\nS_{\\mathrm{up}}(\\pi) = \\frac{3 - 4(-1) + 1}{2} = 4, \\quad z_{\\mathrm{up}}(\\pi) = -4\\,C.\n$$\n因此，迎风格式半离散谱包含纯实负点 $z=-4C$，这是负实轴方向上的极值点。对于 $R_{2}$ 和 $R_{3}$，绝对稳定区域与负实轴相交于某点 $z=-\\alpha$，其中 $|R(-\\alpha)|=1$；最大允许 $C$ 值通过要求 $-4C$ 保持在该交集区间内来确定。因此\n$$\nC_{\\max,\\mathrm{up}} = \\frac{\\alpha}{4},\n$$\n其中 $\\alpha$ 是 Runge–Kutta 稳定区域在负实轴上的（正）范围。\n\n对于 RK2，沿负实轴设 $z=-x$，$x\\ge 0$：\n$$\nR_{2}(-x) = 1 - x + \\frac{x^{2}}{2}.\n$$\n边界 $|R_{2}(-x)|=1$ 出现在 $R_{2}(-x)=1$ 处，这给出 $-x + \\frac{x^{2}}{2}=0 \\Rightarrow x=0$ 或 $x=2$。因此 $\\alpha_{2}=2$ 且\n$$\nC_{\\max,\\mathrm{up}}^{\\mathrm{(RK2)}} = \\frac{\\alpha_{2}}{4} = \\frac{2}{4} = \\frac{1}{2}.\n$$\n\n对于 RK3，沿负实轴设 $z=-x$，\n$$\nR_{3}(-x) = 1 - x + \\frac{x^{2}}{2} - \\frac{x^{3}}{6}.\n$$\n边界 $|R_{3}(-x)|=1$ 在 $R_{3}(-x)=-1$ 处达到（因为 $R_{3}(-x)$ 从 $1$ 开始减小，穿过 $-1$ 一次后其绝对值开始增大），这给出\n$$\n1 - x + \\frac{x^{2}}{2} - \\frac{x^{3}}{6} = -1 \\;\\;\\Longleftrightarrow\\;\\; x^{3} - 3x^{2} + 6x - 12 = 0.\n$$\n设 $\\alpha_{3}$ 是此三次方程的唯一正根；则\n$$\nC_{\\max,\\mathrm{up}}^{\\mathrm{(RK3)}} = \\frac{\\alpha_{3}}{4}.\n$$\n数值求解 $x^{3} - 3x^{2} + 6x - 12 = 0$（例如通过 Newton 法，注意 $f'(x)=3(x-1)^{2}+30$，因此根是唯一的），得到 $\\alpha_{3} \\approx 2.51277$，因此\n$$\nC_{\\max,\\mathrm{up}}^{\\mathrm{(RK3)}} \\approx \\frac{2.51277}{4} \\approx 0.62819.\n$$\n\n- 中心格式 + RK2 和 RK3：\n对于中心格式，\n$$\nz_{\\mathrm{c}}(\\theta) = -\\mathrm{i}\\,C\\,\\sin\\theta,\n$$\n所以整个半离散谱位于虚轴上，满足 $|z| \\le C$，极值点在 $z = \\pm \\mathrm{i}\\,C$。\n\n对于 RK2，将 $z=\\mathrm{i}y$ 代入 $R_{2}$：\n$$\nR_{2}(\\mathrm{i}y) = 1 + \\mathrm{i}y - \\frac{y^{2}}{2}, \\quad |R_{2}(\\mathrm{i}y)|^{2} = \\bigl(1 - \\tfrac{y^{2}}{2}\\bigr)^{2} + y^{2} = 1 + \\frac{y^{4}}{4} \\ge 1,\n$$\n仅当 $y=0$ 时等号成立。因此，RK2 稳定区域内不包含任何非零的虚数 $z$，这意味着\n$$\nC_{\\max,\\mathrm{c}}^{\\mathrm{(RK2)}} = 0.\n$$\n\n对于 RK3，将 $z=\\mathrm{i}y$ 代入 $R_{3}$：\n$$\nR_{3}(\\mathrm{i}y) = 1 + \\mathrm{i}y - \\frac{y^{2}}{2} - \\mathrm{i}\\frac{y^{3}}{6},\n$$\n所以\n$$\n|R_{3}(\\mathrm{i}y)|^{2} = \\bigl(1 - \\tfrac{y^{2}}{2}\\bigr)^{2} + \\bigl(y - \\tfrac{y^{3}}{6}\\bigr)^{2} = 1 - \\frac{y^{4}}{12} + \\frac{y^{6}}{36}.\n$$\n边界 $|R_{3}(\\mathrm{i}y)|=1$ 满足\n$$\n-\\frac{y^{4}}{12} + \\frac{y^{6}}{36} = 0 \\;\\;\\Longleftrightarrow\\;\\; y^{4}\\Bigl(\\frac{y^{2}}{36} - \\frac{1}{12}\\Bigr) = 0 \\;\\;\\Longleftrightarrow\\;\\; y^{2} = 3.\n$$\n因此与虚轴的交点在 $|y|=\\sqrt{3}$。由于中心离散的极值特征值满足 $|z|=C$，稳定性要求 $C \\le \\sqrt{3}$，即，\n$$\nC_{\\max,\\mathrm{c}}^{\\mathrm{(RK3)}} = \\sqrt{3}.\n$$\n\n4) 通过特征值进行解释。\n\n二阶迎风符号 $S_{\\mathrm{up}}(\\theta)$ 严格位于复平面的右半部分（因此 $z=-C S_{\\mathrm{up}}(\\theta)$ 位于左半平面），并在 $\\theta=\\pi$ 处达到一个纯实负极值，该极值通过 Runge–Kutta 稳定区域在负实轴上的范围来决定稳定性极限。相比之下，对于所有 $\\theta$，二阶中心符号都是纯虚数，因此稳定性取决于 Runge–Kutta 稳定区域包含多大的虚轴范围：对于 RK2 是没有的（除了原点），对于 RK3 是一个有限线段 $|y|\\le \\sqrt{3}$。这些谱的几何形状解释了为什么中心格式与 RK2 组合不允许非零的 $C$，而与 RK3 组合却允许一个相对较大的 $C_{\\max}$，以及为什么迎风格式的 $C_{\\max}$ 与负实轴截距除以极端谱因子 $4$ 成比例。\n\n5) 数值与四舍五入。\n\n四舍五入到四位有效数字：\n- $C_{\\max,\\mathrm{up}}^{\\mathrm{(RK2)}} = 1/2 = 0.5000$,\n- $C_{\\max,\\mathrm{up}}^{\\mathrm{(RK3)}} \\approx 0.6282$,\n- $C_{\\max,\\mathrm{c}}^{\\mathrm{(RK2)}} = 0.0000$,\n- $C_{\\max,\\mathrm{c}}^{\\mathrm{(RK3)}} = \\sqrt{3} \\approx 1.732$.\n\n所要求的行矩阵，按指定顺序为\n$$\n\\bigl[C_{\\max,\\mathrm{up}}^{\\mathrm{(RK2)}},\\; C_{\\max,\\mathrm{up}}^{\\mathrm{(RK3)}},\\; C_{\\max,\\mathrm{c}}^{\\mathrm{(RK2)}},\\; C_{\\max,\\mathrm{c}}^{\\mathrm{(RK3)}}\\bigr].\n$$", "answer": "$$\\boxed{\\begin{pmatrix}0.5000  0.6282  0.0000  1.732\\end{pmatrix}}$$", "id": "3360952"}, {"introduction": "在许多工程应用中，我们更关心的是问题的稳态解，这通常需要求解大规模的线性代数方程组。本练习将探讨一种高效的迭代策略——“缺陷校正法”（defect-correction method），该方法利用一个简单且稳定的一阶迎风格式来辅助求解更精确的二阶系统。我们将分析该迭代方法的收敛性，并找出最优松弛因子以加速收敛 [@problem_id:3361016]。这项高级实践介绍了一种求解高阶离散化线性系统的强大技术，展示了如何融合不同阶的格式以同时实现计算的稳健性和结果的准确性。", "problem": "考虑计算流体力学 (CFD) 中的稳态一维线性平流方程，在长度为 $L$ 的周期性域上，速度 $a$ 为正常数，该方程由 $a \\,\\partial \\phi / \\partial x = s(x)$ 给出，其中 $s(x)$ 是一个已知的源项。在一个间距为 $h = L/N$、节点为 $x_i = i h$（$i \\in \\{0,1,\\dots,N-1\\}$）的均匀网格上，令 $L_1$ 表示 $a \\,\\partial \\phi / \\partial x$ 的一阶迎风（后向）离散格式，令 $L_2$ 表示其二阶迎风（后向）离散格式。对于 $a0$ 的情况，在均匀网格上，$L_1$ 和 $L_2$ 在节点 $i$ 上的作用如下：$L_1 \\phi_i = \\dfrac{a}{h}(\\phi_i - \\phi_{i-1})$ 和 $L_2 \\phi_i = \\dfrac{a}{2h}\\big(3 \\phi_i - 4 \\phi_{i-1} + \\phi_{i-2}\\big)$，模板的索引采用周期性边界条件。您将设计并分析一种缺陷修正（也称延迟修正）策略，该策略将 $L_1$ 与一个由 $L_2$ 构建的修正项相结合，并研究其用于稳态求解的线性稳定性及收敛加速效果。\n\n您的任务是：\n\n$1.$ 从上述定义出发，推导一个以二阶迎风稳态解 $L_2 \\phi = b$ 为目标的不动点迭代，其中 $b$ 是 $s(x)$ 的离散形式。在第 $k$ 次迭代中，通过求解以下线性系统来定义一个临时更新量 $\\phi^{k+1,\\sharp}$\n$$\nL_1 \\,\\phi^{k+1,\\sharp} \\;=\\; b \\;-\\;\\big(L_2 \\phi^k - L_1 \\phi^k\\big).\n$$\n然后应用参数为 $\\alpha \\in (0,2)$ 的欠松弛来获得\n$$\n\\phi^{k+1} \\;=\\; (1-\\alpha)\\,\\phi^k \\;+\\; \\alpha\\,\\phi^{k+1,\\sharp}.\n$$\n证明误差 $e^k = \\phi^k - \\phi^\\star$（其中 $\\phi^\\star$ 满足 $L_2 \\phi^\\star = b$）遵循以下齐次线性迭代格式\n$$\ne^{k+1} \\;=\\; \\Big(I \\;-\\; \\alpha\\, L_1^{-1} L_2\\Big)\\, e^k,\n$$\n假设 $L_1$ 在与常数函数正交的子空间上是非奇异的。\n\n$2.$ 在均匀周期性网格上进行冯·诺依曼（傅里叶）线性稳定性分析。对于一个傅里叶模态 $\\phi_i = \\exp(\\mathrm{i}\\,i\\,\\theta)$，其中 $\\theta \\in [0,2\\pi)$（以弧度为单位），计算 $L_1$ 和 $L_2$ 的符号 $\\lambda_1(\\theta)$ 和 $\\lambda_2(\\theta)$，并推导出误差放大因子\n$$\ng(\\theta,\\alpha) \\;=\\; 1 \\;-\\; \\alpha\\, \\frac{\\lambda_2(\\theta)}{\\lambda_1(\\theta)}.\n$$\n以闭式解的形式确定谱半径 $\\rho(\\alpha) = \\max_{\\theta \\in [0,2\\pi)} |g(\\theta,\\alpha)|$。\n\n$3.$ 使用您得到的 $\\rho(\\alpha)$ 的闭式表达式，确定能使 $\\rho(\\alpha)$ 最小化的最优松弛参数 $\\alpha_{\\mathrm{opt}} \\in (0,2)$ 以及相应的最小谱半径 $\\rho_{\\mathrm{opt}} = \\rho(\\alpha_{\\mathrm{opt}})$。\n\n$4.$ 为一个人造稳态问题实现缺陷修正方法，该问题具有周期性源项 $s(x) = \\sin(2\\pi x/L)$、速度 $a=1$ 和域长度 $L=1$。使用一个具有 $N=128$ 个节点的均匀网格。为了消除周期性平流下与常数相关的零空间，通过将每个线性系统的第一行替换为单位行并将 $b$ 的第一个元素置零来强制施加约束 $\\phi_0=0$。求解二阶迎风离散系统 $L_2 \\phi^\\star = b$（使用相同约束）以获得参考解 $\\phi^\\star$，并从 $\\phi^0 \\equiv 0$ 开始进行缺陷修正迭代。对于每个选定的 $\\alpha$，计算使误差的欧几里得范数满足以下条件所需的迭代次数\n$$\n\\frac{\\|\\phi^k - \\phi^\\star\\|_2}{\\|\\phi^0 - \\phi^\\star\\|_2} \\;\\le\\; 10^{-8}.\n$$\n\n$5.$ 测试套件和要求输出：\n- 测试 A (正常情况)：计算 $\\alpha = 0.8$ 时的 $\\rho(\\alpha)$，并将其报告为一个四舍五入到 $6$ 位小数的浮点数。\n- 测试 B (边界情况)：计算 $\\alpha = 1.0$ 时的 $\\rho(\\alpha)$，并将其报告为一个四舍五入到 $6$ 位小数的浮点数。\n- 测试 C (最优设计)：计算 $\\alpha_{\\mathrm{opt}}$ 和 $\\rho_{\\mathrm{opt}}$，并将这对值报告为一个列表 $[\\alpha_{\\mathrm{opt}}, \\rho_{\\mathrm{opt}}]$，其中每个条目都四舍五入到 $6$ 位小数。\n- 测试 D (算法收敛性)：对于 $N=128$，$L=1$，$a=1$，以及带有约束 $\\phi_0=0$ 的源项 $s(x)=\\sin(2\\pi x/L)$，从 $\\phi^0=0$ 开始运行缺陷修正方案，并将迭代次数报告为一个列表 $[n_{1.0}, n_{\\alpha_{\\mathrm{opt}}}]$，其中 $n_{1.0}$ 是 $\\alpha=1.0$ 时的次数，$n_{\\alpha_{\\mathrm{opt}}}$ 是 $\\alpha=\\alpha_{\\mathrm{opt}}$ 时的次数。\n\n您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表（例如，\"[resultA,resultB,[alpha_opt,rho_opt],[n1,n2]]\"）。所有角度必须以弧度处理。最终答案中不需要物理单位。所有报告的浮点数必须四舍五入到 $6$ 位小数。输出类型必须严格按照上述规定，为浮点数以及浮点数或整数的列表，不得打印任何其他文本。", "solution": "用户提供的问题是偏微分方程数值分析领域一个有效、包含多个部分的练习。每个部分都将得到系统性的解答。\n\n### 第 1 部分：误差迭代的推导\n\n缺陷修正格式由两个方程定义。首先，通过求解以下方程计算临时更新量 $\\phi^{k+1,\\sharp}$：\n$$\nL_1 \\,\\phi^{k+1,\\sharp} \\;=\\; b \\;-\\;\\big(L_2 \\phi^k - L_1 \\phi^k\\big)\n$$\n其次，通过欠松弛获得新的迭代值 $\\phi^{k+1}$：\n$$\n\\phi^{k+1} \\;=\\; (1-\\alpha)\\,\\phi^k \\;+\\; \\alpha\\,\\phi^{k+1,\\sharp}\n$$\n其中 $\\alpha \\in (0,2)$ 是松弛参数。我们假设算子 $L_1$ 在相关函数空间上是可逆的，这使我们可以写出 $\\phi^{k+1,\\sharp} = L_1^{-1} \\left( b - (L_2 - L_1)\\phi^k \\right)$。将此代入第二个方程得到：\n$$\n\\phi^{k+1} = (1-\\alpha)\\phi^k + \\alpha L_1^{-1} \\left( b - L_2\\phi^k + L_1\\phi^k \\right)\n$$\n展开各项，我们得到：\n$$\n\\phi^{k+1} = \\phi^k - \\alpha\\phi^k + \\alpha L_1^{-1}b - \\alpha L_1^{-1}L_2\\phi^k + \\alpha L_1^{-1}L_1\\phi^k\n$$\n由于 $L_1^{-1}L_1 = I$（单位算子），上式可简化为：\n$$\n\\phi^{k+1} = \\phi^k + \\alpha L_1^{-1}b - \\alpha L_1^{-1}L_2\\phi^k\n$$\n$$\n\\phi^{k+1} = \\left(I - \\alpha L_1^{-1}L_2\\right)\\phi^k + \\alpha L_1^{-1}b\n$$\n这是解向量 $\\phi^k$ 的更新规则。为了找到误差 $e^k = \\phi^k - \\phi^\\star$ 的更新规则，我们从两边减去精确解 $\\phi^\\star$。精确解满足 $L_2\\phi^\\star = b$。\n$$\n\\phi^{k+1} - \\phi^\\star = \\left(I - \\alpha L_1^{-1}L_2\\right)\\phi^k + \\alpha L_1^{-1}b - \\phi^\\star\n$$\n代入 $\\phi^{k+1} - \\phi^\\star = e^{k+1}$ 和 $\\phi^k = e^k + \\phi^\\star$：\n$$\ne^{k+1} = \\left(I - \\alpha L_1^{-1}L_2\\right)(e^k + \\phi^\\star) + \\alpha L_1^{-1}b - \\phi^\\star\n$$\n$$\ne^{k+1} = \\left(I - \\alpha L_1^{-1}L_2\\right)e^k + \\left(I - \\alpha L_1^{-1}L_2\\right)\\phi^\\star + \\alpha L_1^{-1}b - \\phi^\\star\n$$\n$$\ne^{k+1} = \\left(I - \\alpha L_1^{-1}L_2\\right)e^k + \\phi^\\star - \\alpha L_1^{-1}L_2\\phi^\\star + \\alpha L_1^{-1}b - \\phi^\\star\n$$\n$$\ne^{k+1} = \\left(I - \\alpha L_1^{-1}L_2\\right)e^k - \\alpha L_1^{-1}(L_2\\phi^\\star) + \\alpha L_1^{-1}b\n$$\n利用 $L_2\\phi^\\star = b$ 的性质，最后两项相互抵消：\n$$\ne^{k+1} = \\left(I - \\alpha L_1^{-1}L_2\\right)e^k - \\alpha L_1^{-1}b + \\alpha L_1^{-1}b\n$$\n这就得到了我们想要的误差的齐次线性迭代格式：\n$$\ne^{k+1} \\;=\\; \\Big(I \\;-\\; \\alpha\\, L_1^{-1} L_2\\Big)\\, e^k\n$$\n矩阵 $G = I - \\alpha L_1^{-1}L_2$ 是迭代矩阵，其谱半径决定了该方法的收敛性。假设 $L_1$ 在与常数函数正交的子空间上非奇异是至关重要的，因为周期性平流算子的零空间包含常数函数，必须处理好这一点才能使逆算子 $L_1^{-1}$ 有良好定义。\n\n### 第 2 部分：冯·诺依曼稳定性分析\n\n我们通过考虑单个傅里叶模态 $\\phi_j = \\exp(\\mathrm{i}\\,j\\,\\theta)$ 来分析均匀周期网格上的迭代，其中 $j$ 是网格索引，$\\theta \\in [0, 2\\pi)$ 是无量纲波数。像 $L_1$ 或 $L_2$ 这样的线性平移不变算子作用于此模态的结果是将其乘以一个复数，该复数即为算子的符号。\n\n一阶迎风算子 $L_1\\phi_j = \\frac{a}{h}(\\phi_j - \\phi_{j-1})$ 的符号是：\n$$\n\\lambda_1(\\theta) = \\frac{a}{h} (1 - e^{-\\mathrm{i}\\theta})\n$$\n二阶迎风算子 $L_2\\phi_j = \\frac{a}{2h}(3\\phi_j - 4\\phi_{j-1} + \\phi_{j-2})$ 的符号是：\n$$\n\\lambda_2(\\theta) = \\frac{a}{2h} (3 - 4e^{-\\mathrm{i}\\theta} + e^{-2\\mathrm{i}\\theta})\n$$\n$\\lambda_2(\\theta)$ 中的二次项可以因式分解：$e^{-2\\mathrm{i}\\theta} - 4e^{-\\mathrm{i}\\theta} + 3 = (e^{-\\mathrm{i}\\theta}-1)(e^{-\\mathrm{i}\\theta}-3)$。所以：\n$$\n\\lambda_2(\\theta) = \\frac{a}{2h} (e^{-\\mathrm{i}\\theta}-1)(e^{-\\mathrm{i}\\theta}-3)\n$$\n误差放大因子 $g(\\theta, \\alpha)$ 是迭代矩阵 $G$ 的符号。对于一个傅里叶模态，这等于：\n$$\ng(\\theta, \\alpha) = 1 - \\alpha \\frac{\\lambda_2(\\theta)}{\\lambda_1(\\theta)}\n$$\n我们计算符号的比率：\n$$\n\\frac{\\lambda_2(\\theta)}{\\lambda_1(\\theta)} = \\frac{\\frac{a}{2h} (e^{-\\mathrm{i}\\theta}-1)(e^{-\\mathrm{i}\\theta}-3)}{\\frac{a}{h} (1 - e^{-\\mathrm{i}\\theta})} = \\frac{\\frac{a}{2h} (e^{-\\mathrm{i}\\theta}-1)(e^{-\\mathrm{i}\\theta}-3)}{-\\frac{a}{h} (e^{-\\mathrm{i}\\theta}-1)} = -\\frac{1}{2}(e^{-\\mathrm{i}\\theta}-3) = \\frac{1}{2}(3 - e^{-\\mathrm{i}\\theta})\n$$\n该比率在 $\\theta \\ne 0$ 时有效，此时 $\\lambda_1(\\theta) \\ne 0$。将其代回 $g(\\theta, \\alpha)$ 的表达式中：\n$$\ng(\\theta, \\alpha) = 1 - \\frac{\\alpha}{2}(3 - e^{-\\mathrm{i}\\theta}) = \\left(1 - \\frac{3\\alpha}{2}\\right) + \\frac{\\alpha}{2}e^{-\\mathrm{i}\\theta}\n$$\n该表达式描述了复平面上的一个圆，其圆心为 $C = 1 - \\frac{3\\alpha}{2}$，半径为 $R = \\frac{\\alpha}{2}$（因为 $\\alpha0$）。谱半径 $\\rho(\\alpha)$ 是 $|g(\\theta, \\alpha)|$ 在所有 $\\theta \\in [0, 2\\pi)$ 上的最大模。这发生在圆上的点离原点最远时，其值为圆心到原点的距离与半径之和：\n$$\n\\rho(\\alpha) = \\max_{\\theta \\in [0, 2\\pi)} |g(\\theta, \\alpha)| = |C| + R = \\left|1 - \\frac{3\\alpha}{2}\\right| + \\frac{\\alpha}{2}\n$$\n\n### 第 3 部分：最优松弛参数\n\n我们旨在找到使 $\\rho(\\alpha) = \\left|1 - \\frac{3\\alpha}{2}\\right| + \\frac{\\alpha}{2}$ 最小化的 $\\alpha_{\\mathrm{opt}} \\in (0,2)$。当绝对值内的参数为零时，即 $1 - \\frac{3\\alpha}{2} = 0$（解得 $\\alpha = 2/3$），该函数的行为会发生变化。我们在两个区间内分析 $\\rho(\\alpha)$。\n\n情况 1：$0  \\alpha \\le 2/3$。在此区间内，$1 - \\frac{3\\alpha}{2} \\ge 0$。\n$$\n\\rho(\\alpha) = \\left(1 - \\frac{3\\alpha}{2}\\right) + \\frac{\\alpha}{2} = 1 - \\frac{2\\alpha}{2} = 1 - \\alpha\n$$\n这是关于 $\\alpha$ 的线性递减函数。它在此区间内的最小值出现在 $\\alpha = 2/3$ 处，值为 $\\rho(2/3) = 1 - 2/3 = 1/3$。\n\n情况 2：$2/3  \\alpha  2$。在此区间内，$1 - \\frac{3\\alpha}{2}  0$。\n$$\n\\rho(\\alpha) = -\\left(1 - \\frac{3\\alpha}{2}\\right) + \\frac{\\alpha}{2} = -1 + \\frac{3\\alpha}{2} + \\frac{\\alpha}{2} = -1 + \\frac{4\\alpha}{2} = 2\\alpha - 1\n$$\n这是关于 $\\alpha$ 的线性递增函数。它在此区间内的最小值在 $\\alpha \\to (2/3)^+$ 时趋近，值为 $\\lim_{\\alpha\\to(2/3)^+} (2\\alpha-1) = 4/3 - 1 = 1/3$。\n\n对于 $\\alpha \\in (0,2)$，$\\rho(\\alpha)$ 的全局最小值位于两条线性分段相交的点。因此，最优松弛参数和相应的最小谱半径是：\n$$\n\\alpha_{\\mathrm{opt}} = \\frac{2}{3}\n$$\n$$\n\\rho_{\\mathrm{opt}} = \\rho(\\alpha_{\\mathrm{opt}}) = \\frac{1}{3}\n$$\n\n### 第 4 部分：数值结果与分析\n\n基于推导出的公式，我们可以计算所需的理论值。缺陷修正算法的实现将提供迭代次数。\n\n对于测试 A，当 $\\alpha = 0.8$ 时，我们处于第二种情况（$0.8  2/3$）。谱半径为：\n$$\n\\rho(0.8) = 2(0.8) - 1 = 1.6 - 1 = 0.6\n$$\n\n对于测试 B，当 $\\alpha = 1.0$ 时，我们也处于第二种情况（$1.0  2/3$）。谱半径为：\n$$\n\\rho(1.0) = 2(1.0) - 1 = 1.0\n$$\n谱半径为 $1$ 表明对于某些误差模态（在此情况下为高频模态），迭代将不会收敛。\n\n对于测试 C，最优值已在第 3 部分找到：\n$$\n\\alpha_{\\mathrm{opt}} = 2/3 \\approx 0.666667, \\quad \\rho_{\\mathrm{opt}} = 1/3 \\approx 0.333333\n$$\n\n对于测试 D，根据问题规范进行数值模拟。为 $N=128$，$L=1$ 和 $a=1$ 构建算子 $L_1$ 和 $L_2$ 的矩阵，并包含周期性边界条件。为确保线性系统非奇异，通过修改矩阵和右端向量来强制执行约束 $\\phi_0=0$。通过求解带约束的二阶系统计算参考解 $\\phi^\\star$。然后，对于 $\\alpha=1.0$ 和 $\\alpha=\\alpha_{\\mathrm{opt}}=2/3$，从 $\\phi^0=0$ 开始运行缺陷修正迭代，直到相对误差范数小于 $10^{-8}$。记录迭代次数。尽管 $\\rho(1.0)=1.0$ 预测了最坏情况误差下的不收敛性，但该特定问题的误差是光滑的（由源项 $s(x)$ 的低波数模态主导），对于这种误差，放大因子 $|g(\\theta, 1.0)|$ 很小，从而导致快速收敛。相反，$\\alpha_{\\mathrm{opt}}$ 是为最坏情况（高频）误差而优化的，对于光滑误差而言是次优的，因此对于这个特定问题会导致更多的迭代次数。最终答案中的数值实现计算了这些次数。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the multi-part CFD problem.\n    1. Computes theoretical spectral radii rho(alpha) for given alpha.\n    2. Computes the optimal relaxation alpha_opt and rho_opt.\n    3. Implements the defect-correction scheme to find iteration counts for convergence.\n    \"\"\"\n\n    # --- Part 3 Analytical Results ---\n    alpha_opt_val = 2.0 / 3.0\n    rho_opt_val = 1.0 / 3.0\n\n    # --- Test A: rho(0.8) ---\n    alpha_A = 0.8\n    # Since alpha_A  2/3, use rho(alpha) = 2*alpha - 1\n    rho_A = round(2 * alpha_A - 1, 6)\n\n    # --- Test B: rho(1.0) ---\n    alpha_B = 1.0\n    # Since alpha_B  2/3, use rho(alpha) = 2*alpha - 1\n    rho_B = round(2 * alpha_B - 1, 6)\n    \n    # --- Test C: [alpha_opt, rho_opt] ---\n    alpha_opt_rounded = round(alpha_opt_val, 6)\n    rho_opt_rounded = round(rho_opt_val, 6)\n    result_C = [alpha_opt_rounded, rho_opt_rounded]\n\n    # --- Test D: Iteration Counts ---\n    # Setup problem parameters\n    N = 128\n    L = 1.0\n    a = 1.0\n    h = L / N\n\n    # Construct operator matrices\n    M1 = np.zeros((N, N))\n    M2 = np.zeros((N, N))\n    for i in range(N):\n        # L1 operator\n        M1[i, i] = a / h\n        M1[i, (i - 1 + N) % N] = -a / h\n        # L2 operator\n        M2[i, i] = 3 * a / (2 * h)\n        M2[i, (i - 1 + N) % N] = -4 * a / (2 * h)\n        M2[i, (i - 2 + N) % N] = a / (2 * h)\n\n    # Define source term vector\n    x = np.arange(N) * h\n    b = np.sin(2 * np.pi * x / L)\n\n    def apply_constraint(M, f):\n        \"\"\"Modifies a matrix and a vector to enforce the phi_0=0 constraint.\"\"\"\n        M_mod = M.copy()\n        f_mod = f.copy()\n        M_mod[0, :] = 0.0\n        M_mod[0, 0] = 1.0\n        f_mod[0] = 0.0\n        return M_mod, f_mod\n\n    # Solve for the reference solution phi_star\n    M2_mod, b_mod = apply_constraint(M2, b)\n    phi_star = np.linalg.solve(M2_mod, b_mod)\n\n    def count_iterations(alpha, M1, M2, b, phi_star):\n        \"\"\"Runs the defect-correction iteration and counts steps to convergence.\"\"\"\n        phi_k = np.zeros(N)\n        initial_error_norm = np.linalg.norm(phi_k - phi_star)\n        \n        if initial_error_norm  1e-15:\n            return 0\n        \n        M1_mod, _ = apply_constraint(M1, b) # Constrained L1 matrix for solver\n        M_diff = M2 - M1\n\n        # Max iterations to prevent infinite loop\n        max_iter = 500\n        for k in range(1, max_iter + 1):\n            # Calculate defect correction RHS\n            d_k = b - M_diff @ phi_k\n            \n            # Apply constraint to RHS\n            d_k[0] = 0.0\n            \n            # Solve for provisional update\n            phi_k_sharp = np.linalg.solve(M1_mod, d_k)\n            \n            # Apply relaxation\n            phi_k_next = (1 - alpha) * phi_k + alpha * phi_k_sharp\n            phi_k = phi_k_next\n\n            # Check for convergence\n            current_error_norm = np.linalg.norm(phi_k - phi_star)\n            if (current_error_norm / initial_error_norm) = 1e-8:\n                return k\n        return -1 # Indicate failure to converge\n\n    n_1_0 = count_iterations(1.0, M1, M2, b, phi_star)\n    n_alpha_opt = count_iterations(alpha_opt_val, M1, M2, b, phi_star)\n    result_D = [n_1_0, n_alpha_opt]\n\n    # --- Format and Print Final Output ---\n    # Construct the final list of results\n    final_results = [rho_A, rho_B, result_C, result_D]\n\n    # Custom string formatting to match the required output style\n    # [float,float,[float,float],[int,int]]\n    result_strings = [\n        f\"{final_results[0]}\",\n        f\"{final_results[1]}\",\n        f\"[{final_results[2][0]},{final_results[2][1]}]\",\n        f\"[{final_results[3][0]},{final_results[3][1]}]\"\n    ]\n    \n    print(f\"[{','.join(result_strings)}]\")\n\nsolve()\n```", "id": "3361016"}]}