{"hands_on_practices": [{"introduction": "本练习提供了一个解析地执行亥姆霍兹分解的基础实践。通过将傅里叶空间投影算子手动应用于一个给定的矢量场 [@problem_id:3328644]，您将具体理解不可压缩条件（在傅里叶空间中表示为 $k \\cdot \\hat{u}(k) = 0$）如何允许将流场分离为其无散度（螺线）和无旋（势）部分。这种纸笔计算将巩固构建和调试数值求解器所必需的理论基础。", "problem": "考虑在具有周期性边界条件 (BCs) 的双周期域 $[0,2\\pi] \\times [0,2\\pi]$ 上定义的二维速度场 $u(x,y) = \\left( \\cos x \\sin y,\\ -\\sin x \\cos y \\right)$。在计算流体力学中，亥姆霍兹分解将一个足够光滑的矢量场表示为一个无旋（梯度）分量和一个螺线（无散度）分量之和。在周期域上，这种分解可以在傅里叶空间中通过以下方式来表征：将每个傅里叶模态分别投影到与波矢正交的子空间（对应螺线部分）和平行于波矢的子空间（对应无旋部分），并为保证唯一性施加适当的零均值条件。\n\n从不可压缩性约束和周期场的傅里叶级数表示出发，推导与无散度子空间相关的模态投影算子。然后，使用此傅里叶空间投影计算 $u(x,y)$ 的亥姆霍兹分解：显式计算 $u(x,y)$ 的傅里叶系数，应用推导出的投影来分离每个模态的螺线和无旋分量，并重构得到的物理空间场。最后，通过 $u_{\\mathrm{sol}} = \\nabla^{\\perp} \\psi = \\left( \\partial_{y}\\psi,\\ -\\partial_{x}\\psi \\right)$ 用流函数 $\\psi(x,y)$ 表示螺线分量，通过 $u_{\\mathrm{irr}} = \\nabla \\phi$ 用标量势 $\\phi(x,y)$ 表示无旋分量，并对 $\\psi$ 和 $\\phi$ 施加零均值条件以确保唯一性。\n\n以标量势的有序对 $(\\psi(x,y),\\ \\phi(x,y))$ 的形式给出您的最终答案。最终表达式无需四舍五入，也不涉及物理单位。", "solution": "该问题要求使用傅里叶空间投影方法，将给定在双周期域上的二维矢量场 $u(x,y)$ 分解为其螺线（无散度）和无旋（无旋度）分量。最终目标是找到相关的流函数 $\\psi(x,y)$ 和标量势 $\\phi(x,y)$。\n\n首先，我们推导用于无散度子空间的通用模态投影算子。周期域 $[0, 2\\pi] \\times [0, 2\\pi]$ 上的矢量场 $v(x,y)$ 可由其复傅里叶级数表示：\n$$ v(x,y) = \\sum_{k \\in \\mathbb{Z}^2} \\hat{v}(k) \\exp(i k \\cdot x) $$\n其中 $x = (x,y)$ 是位置矢量，$k = (k_x, k_y)$ 是具有整数分量的波矢，$\\hat{v}(k)$ 是模态 $k$ 的傅里叶系数矢量。物理空间中的散度算子 $\\nabla \\cdot$ 对应于傅里叶空间中的乘法 $i k \\cdot$。如果 $\\nabla \\cdot v = 0$，则矢量场 $v$ 是螺线场。在傅里叶空间中，该条件变为：\n$$ \\widehat{\\nabla \\cdot v}(k) = i k \\cdot \\hat{v}(k) = 0 $$\n此方程表明，对于每个波矢 $k \\neq (0,0)$，螺线场的傅里叶系数矢量 $\\hat{v}(k)$ 必须与 $k$ 正交。\n\n亥姆霍兹分解定理指出，任何足够光滑的矢量场 $u$ 都可以写成一个无旋部分 $u_{\\mathrm{irr}}$ 和一个螺线部分 $u_{\\mathrm{sol}}$ 的和：$u = u_{\\mathrm{irr}} + u_{\\mathrm{sol}}$。在傅里叶空间中，这表示为 $\\hat{u}(k) = \\hat{u}_{\\mathrm{irr}}(k) + \\hat{u}_{\\mathrm{sol}}(k)$。无旋分量是标量势的梯度，$u_{\\mathrm{irr}} = \\nabla \\phi$，在傅里叶空间中为 $\\hat{u}_{\\mathrm{irr}}(k) = i k \\hat{\\phi}(k)$。这意味着 $\\hat{u}_{\\mathrm{irr}}(k)$ 平行于波矢 $k$。\n\n给定一个任意傅里叶模态 $\\hat{u}(k)$，我们可以将其投影到与 $k$ 平行的子空间上以找到其无旋分量。到 $k$ 方向的投影算子由 $\\frac{k \\otimes k}{|k|^2}$ 给出，其中 $\\otimes$ 表示外积。\n$$ \\hat{u}_{\\mathrm{irr}}(k) = \\left( \\frac{k \\otimes k}{|k|^2} \\right) \\hat{u}(k) = \\frac{k \\cdot \\hat{u}(k)}{|k|^2} k $$\n螺线分量是剩余的部分，它与 $k$ 正交：\n$$ \\hat{u}_{\\mathrm{sol}}(k) = \\hat{u}(k) - \\hat{u}_{\\mathrm{irr}}(k) = \\hat{u}(k) - \\frac{k \\cdot \\hat{u}(k)}{|k|^2} k $$\n因此，与无散度（螺线）子空间相关的模态投影算子是 $P_S(k) = I - \\frac{k \\otimes k}{|k|^2}$，其中 $I$ 是单位矩阵。该算子将矢量 $\\hat{u}(k)$ 投影到与 $k$ 垂直的空间上。此推导对 $k \\ne (0,0)$ 有效。对于代表平均流的 $k=(0,0)$，其散度平凡地为零。\n\n接下来，我们计算给定速度场 $u(x,y) = (\\cos x \\sin y, -\\sin x \\cos y)$ 的傅里叶系数。我们使用三角函数的欧拉公式：$\\cos\\theta = \\frac{1}{2}(\\exp(i\\theta) + \\exp(-i\\theta))$ 和 $\\sin\\theta = \\frac{1}{2i}(\\exp(i\\theta) - \\exp(-i\\theta))$。\n速度场的第一个分量是：\n$$ u_x(x,y) = \\cos x \\sin y = \\frac{1}{2}(\\exp(ix) + \\exp(-ix)) \\frac{1}{2i}(\\exp(iy) - \\exp(-iy)) $$\n$$ u_x(x,y) = \\frac{1}{4i} \\left( \\exp(i(x+y)) - \\exp(i(x-y)) + \\exp(i(-x+y)) - \\exp(i(-x-y)) \\right) $$\n第二个分量是：\n$$ u_y(x,y) = -\\sin x \\cos y = -\\frac{1}{2i}(\\exp(ix) - \\exp(-ix)) \\frac{1}{2}(\\exp(iy) + \\exp(-iy)) $$\n$$ u_y(x,y) = \\frac{-1}{4i} \\left( \\exp(i(x+y)) + \\exp(i(x-y)) - \\exp(i(-x+y)) - \\exp(i(-x-y)) \\right) $$\n根据这些表达式，我们识别出波矢 $k = (k_x, k_y)$ 的非零傅里叶系数 $\\hat{u}(k) = (\\hat{u}_x(k), \\hat{u}_y(k))$：\n对于 $k=(1,1)$: $\\hat{u}(1,1) = (\\frac{1}{4i}, \\frac{-1}{4i}) = -\\frac{i}{4}(1, -1)$。\n对于 $k=(1,-1)$: $\\hat{u}(1,-1) = (\\frac{-1}{4i}, \\frac{-1}{4i}) = \\frac{i}{4}(1, 1)$。\n对于 $k=(-1,1)$: $\\hat{u}(-1,1) = (\\frac{1}{4i}, \\frac{1}{4i}) = -\\frac{i}{4}(1, 1)$。\n对于 $k=(-1,-1)$: $\\hat{u}(-1,-1) = (\\frac{-1}{4i}, \\frac{1}{4i}) = \\frac{i}{4}(1, -1)$。\n所有其他系数 $\\hat{u}(k)$ 均为零。平均流 $\\hat{u}(0,0)$ 为零。\n\n现在我们应用投影。对于每个非零模态，我们计算点积 $k \\cdot \\hat{u}(k)$：\n对于 $k=(1,1)$: $k \\cdot \\hat{u}(1,1) = (1,1) \\cdot (-\\frac{i}{4}(1, -1)) = -\\frac{i}{4}(1-1) = 0$。\n对于 $k=(1,-1)$: $k \\cdot \\hat{u}(1,-1) = (1,-1) \\cdot (\\frac{i}{4}(1, 1)) = \\frac{i}{4}(1-1) = 0$。\n对于 $k=(-1,1)$: $k \\cdot \\hat{u}(-1,1) = (-1,1) \\cdot (-\\frac{i}{4}(1, 1)) = -\\frac{i}{4}(-1+1) = 0$。\n对于 $k=(-1,-1)$: $k \\cdot \\hat{u}(-1,-1) = (-1,-1) \\cdot (\\frac{i}{4}(1, -1)) = \\frac{i}{4}(-1+1) = 0$。\n由于对所有波矢 $k$ 都有 $k \\cdot \\hat{u}(k) = 0$，因此 $\\hat{u}(k)$ 在 $k$ 上的投影对所有模态都为零。\n$$ \\hat{u}_{\\mathrm{irr}}(k) = \\frac{k \\cdot \\hat{u}(k)}{|k|^2} k = 0 \\quad \\text{for all } k $$\n这意味着该场的无旋分量为零，$u_{\\mathrm{irr}}(x,y) = 0$。因此，整个场都是螺线场：$u_{\\mathrm{sol}}(x,y) = u(x,y)$。这可以通过直接计算散度来验证：\n$$ \\nabla \\cdot u = \\partial_x(\\cos x \\sin y) + \\partial_y(-\\sin x \\cos y) = -\\sin x \\sin y + \\sin x \\sin y = 0 $$\n由于 $u_{\\mathrm{irr}} = \\nabla \\phi = 0$，标量势 $\\phi(x,y)$ 必须是一个常数。问题要求对势施加零均值条件以保证唯一性。如果 $\\phi(x,y) = C$，其在域上的平均值是 $C$。因此，我们必须有 $C=0$，这得到 $\\phi(x,y) = 0$。\n\n接下来，我们为螺线分量 $u_{\\mathrm{sol}} = u$ 寻找流函数 $\\psi(x,y)$。流函数由 $u_{\\mathrm{sol}} = \\nabla^{\\perp} \\psi = (\\partial_y \\psi, -\\partial_x \\psi)$ 定义。这提供了一个偏微分方程组：\n1) $\\partial_y \\psi = u_{x} = \\cos x \\sin y$\n2) $-\\partial_x \\psi = u_{y} = -\\sin x \\cos y \\implies \\partial_x \\psi = \\sin x \\cos y$\n\n将第一个方程对 $y$ 积分：\n$$ \\psi(x,y) = \\int \\cos x \\sin y \\, dy = \\cos x \\int \\sin y \\, dy = -\\cos x \\cos y + f(x) $$\n其中 $f(x)$ 是一个关于 $y$ 的积分“常数”。\n现在，将这个 $\\psi$ 的表达式对 $x$ 求导，并与第二个方程进行比较：\n$$ \\partial_x \\psi = \\partial_x(-\\cos x \\cos y + f(x)) = \\sin x \\cos y + f'(x) $$\n将其与 $\\partial_x \\psi = \\sin x \\cos y$ 比较，我们发现 $f'(x) = 0$。这意味着 $f(x)$ 是一个常数，我们记为 $C_0$。\n所以，流函数的通解是 $\\psi(x,y) = -\\cos x \\cos y + C_0$。\n\n为确保唯一解，问题对 $\\psi(x,y)$ 施加了零均值条件。我们计算 $\\psi$ 在域 $[0, 2\\pi] \\times [0, 2\\pi]$ 上的平均值：\n$$ \\langle \\psi \\rangle = \\frac{1}{(2\\pi)^2} \\int_0^{2\\pi} \\int_0^{2\\pi} (-\\cos x \\cos y + C_0) \\, dx \\, dy $$\n$$ \\langle \\psi \\rangle = -\\left(\\frac{1}{2\\pi}\\int_0^{2\\pi} \\cos x \\, dx\\right) \\left(\\frac{1}{2\\pi}\\int_0^{2\\pi} \\cos y \\, dy\\right) + \\frac{1}{(2\\pi)^2}\\int_0^{2\\pi} \\int_0^{2\\pi} C_0 \\, dx \\, dy $$\n由于 $\\int_0^{2\\pi} \\cos\\theta \\, d\\theta = [\\sin\\theta]_0^{2\\pi} = 0$，第一项为零。第二项的计算结果为 $C_0$。\n因此，$\\langle \\psi \\rangle = C_0$。零均值条件要求 $C_0 = 0$。\n唯一的流函数是 $\\psi(x,y) = -\\cos x \\cos y$。\n\n最终答案是标量势的有序对 $(\\psi(x,y), \\phi(x,y))$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix} -\\cos x \\cos y & 0 \\end{pmatrix}\n}\n$$", "id": "3328644"}, {"introduction": "从理论走向实践，本练习将指导您使用谱方法数值实现亥姆霍兹分解 [@problem_id:3328665]。您将编写一个利用快速傅里叶变换 (FFT) 的程序，以高效地将一个矢量场投影到其无散度分量和无旋分量上。通过对一个构造解验证这些分量的正交性以及能量的毕达哥拉斯恒等式，您将为代码的正确性提供一个强有力的检验，这是计算科学中称为“验证与确认”的标准实践。", "problem": "给定一个在方形域 $[0,2\\pi]^2$ 上的光滑、$2$ 维周期向量场 $u(x,y)$，其具有周期性边界条件，定义为\n$$\nu(x,y)=\\begin{pmatrix}\\sin x\\\\ \\sin y\\end{pmatrix},\n$$\n其中角度以弧度为单位。亥姆霍兹分解（Helmholtz decomposition）指出，在周期域上的适当条件下，任何向量场都可以唯一地（在势函数的加性常数范围内）分解为一个无散（螺线）部分和一个无旋（势）部分之和：\n$$\nu = w + \\nabla \\phi,\n$$\n其中 $w$ 是无散的，$\\nabla \\phi$ 是无旋的。在周期性盒子中，这些子空间的正交性意味着 $w$ 和 $\\nabla \\phi$ 的 $L^2$ 内积为零，并且 $L^2$ 范数遵循毕达哥拉斯恒等式（Pythagorean identity）\n$$\n\\|u\\|_{L^2}^2 = \\|w\\|_{L^2}^2 + \\|\\nabla \\phi\\|_{L^2}^2.\n$$\n\n从不可压缩性约束和 $[0,2\\pi]^2$ 上的 $L^2$ 内积的定义出发，在一个均匀的 $N\\times N$ 网格上，实现一个基于谱方法（快速傅里叶变换，FFT）的投影，将 $u$ 投影到无散子空间及其正交梯度补空间上，其中 $N$ 是一个整数分辨率参数。使用均匀网格点 $(x_i,y_j)$，其中 $x_i=\\frac{2\\pi i}{N}$，$y_j=\\frac{2\\pi j}{N}$，对于 $i,j\\in\\{0,1,\\ldots,N-1\\}$。\n\n你的程序必须：\n- 在网格上离散化 $u$，计算其离散傅里叶表示，并构建到无散子空间上的正交投影，该投影对每个非零傅里叶模式都满足不可压缩性约束。\n- 通过逆变换恢复无散部分 $w$ 和无旋部分 $\\nabla \\phi$。\n- 使用周期网格上的梯形法则计算 $L^2$ 范数 $\\|w\\|_{L^2}$ 和 $\\|\\nabla \\phi\\|_{L^2}$ 的离散近似值。具体来说，近似\n$$\n\\|v\\|_{L^2}^2 \\approx \\int_{[0,2\\pi]^2} \\|v(x,y)\\|^2\\,\\mathrm{d}x\\,\\mathrm{d}y \\approx (2\\pi)^2 \\cdot \\frac{1}{N^2}\\sum_{i,j}\\|v(x_i,y_j)\\|^2,\n$$\n然后取平方根得到范数。\n- 计算 $w$ 和 $\\nabla \\phi$ 之间的离散 $L^2$ 内积，\n$$\n\\langle w,\\nabla \\phi\\rangle \\approx (2\\pi)^2 \\cdot \\frac{1}{N^2}\\sum_{i,j} w(x_i,y_j)\\cdot (\\nabla \\phi)(x_i,y_j).\n$$\n- 在给定的容差 $\\varepsilon>0$ 内，数值上验证正交性 $\\lvert\\langle w,\\nabla \\phi\\rangle\\rvert  \\varepsilon$ 和毕达哥拉斯恒等式 $\\left|\\|u\\|_{L^2}^2 - \\|w\\|_{L^2}^2 - \\|\\nabla \\phi\\|_{L^2}^2\\right|  \\varepsilon$。\n\n测试套件：\n- 使用以下网格分辨率和容差 $(N,\\varepsilon)$：\n  - $(2,10^{-12})$，\n  - $(3,10^{-12})$，\n  - $(8,10^{-12})$，\n  - $(16,10^{-12})$，\n  - $(64,10^{-12})$。\n\n对于每个测试用例 $(N,\\varepsilon)$，你的程序必须按顺序输出一个列表，其中包含以下条目：\n- $\\|w\\|_{L^2}$ 的浮点数值，\n- $\\|\\nabla \\phi\\|_{L^2}$ 的浮点数值，\n- 一个布尔值，指示是否满足 $\\lvert\\langle w,\\nabla \\phi\\rangle\\rvert  \\varepsilon$，\n- 一个布尔值，指示是否满足 $\\left|\\|u\\|_{L^2}^2 - \\|w\\|_{L^2}^2 - \\|\\nabla \\phi\\|_{L^2}^2\\right|  \\varepsilon$。\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含所有测试用例的结果，形式为一个逗号分隔的列表，并用方括号括起来。其中每个元素是对应测试用例的列表，顺序与上文相同。例如，一个有效的输出形式为\n$$\n\\bigl[\\,[a_1,b_1,c_1,d_1],[a_2,b_2,c_2,d_2],\\ldots,[a_5,b_5,c_5,d_5]\\,\\bigr]\n$$\n其中每个 $a_k,b_k$ 是浮点数，$c_k,d_k$ 是布尔值。", "solution": "我们从周期域上的亥姆霍兹分解定义和不可压缩性约束开始。在方环面 $[0,2\\pi]^2$ 上，任何足够光滑、均值为零的向量场 $u$ 都允许唯一分解（在势函数的加性常数范围内）为 $u=w+\\nabla\\phi$，其中螺线部分 $w$ 满足 $\\nabla\\cdot w=0$，无旋部分 $\\nabla\\phi$ 满足 $\\nabla\\times(\\nabla\\phi)=0$。向量场上的 $L^2$ 内积为 $\\langle a,b\\rangle=\\int_{[0,2\\pi]^2} a\\cdot b\\,\\mathrm{d}x\\,\\mathrm{d}y$，其范数为 $\\|a\\|_{L^2}=\\sqrt{\\langle a,a\\rangle}$。分解的正交性可通过在周期域上进行分部积分得出：\n$$\n\\langle w,\\nabla\\phi\\rangle = \\int w\\cdot \\nabla\\phi\\,\\mathrm{d}x\\,\\mathrm{d}y = -\\int (\\nabla\\cdot w)\\,\\phi\\,\\mathrm{d}x\\,\\mathrm{d}y = 0,\n$$\n因为 $\\nabla\\cdot w=0$ 并且周期性边界条件消除了边界项。因此，$\\|u\\|_{L^2}^2=\\|w\\|_{L^2}^2+\\|\\nabla\\phi\\|_{L^2}^2$。\n\n为了数值计算该分解，我们使用基于快速傅里叶变换 (FFT) 的谱方法。在一个均匀的 $N\\times N$ 网格上，其中 $x_i=\\frac{2\\pi i}{N}$，$y_j=\\frac{2\\pi j}{N}$，对于 $i,j\\in\\{0,\\ldots,N-1\\}$，我们对 $u(x_i,y_j)=(\\sin x_i,\\sin y_j)^{\\top}$ 进行采样。令 $\\widehat{u}(k_x,k_y)$ 表示离散傅里叶系数。对于每个非零波数 $k=(k_x,k_y)$，将向量傅里叶系数 $\\widehat{u}(k)$ 写成一个与 $k$ 平行的分量和一个与 $k$ 正交的分量之和，这里的正交性是相对于 $\\mathbb{C}^2$ 中的欧几里得点积而言的。具体来说，傅里叶空间中的梯度部分与 $k$ 对齐，因为 $\\nabla \\phi$ 的傅里叶变换是 $i\\,k\\,\\widehat{\\phi}(k)$，而无散部分必须满足 $k\\cdot \\widehat{w}(k)=0$。向量 $v\\in\\mathbb{C}^2$ 到与 $k$ 正交的子空间上的唯一正交投影由矩阵给出\n$$\nP(k) = I - \\frac{k\\,k^{\\top}}{|k|^2},\\quad \\text{for } k\\neq 0,\n$$\n因此 $\\widehat{w}(k)=P(k)\\,\\widehat{u}(k)$ 且 $\\widehat{\\nabla\\phi}(k) = \\widehat{u}(k)-\\widehat{w}(k)$。对于零模式 $k=0$，我们取 $\\widehat{w}(0)=0$ 和 $\\widehat{\\nabla\\phi}(0)=0$，因为 $u$ 在周期盒子上的均值为零。这种构造在设计上强制了不可压缩性约束 $k\\cdot \\widehat{w}(k)=0$，并确保了对于每个 $k\\neq 0$，$P(k)$ 都是一个正交投影。\n\n算法步骤如下：\n- 构建网格并计算采样场 $u_1(x_i,y_j)=\\sin x_i$，$u_2(x_i,y_j)=\\sin y_j$。\n- 通过 FFT 计算二维离散傅里叶变换 $\\widehat{u}_1(k_x,k_y)$ 和 $\\widehat{u}_2(k_x,k_y)$。\n- 构建与 $2\\pi$ 周期网格上的离散傅里叶级数一致的整数波数数组 $(k_x,k_y)$。使用 $\\mathrm{fftfreq}(N,1/N)$ 会产生整数波数 $k\\in\\{-\\lfloor N/2\\rfloor,\\ldots,\\lfloor (N-1)/2\\rfloor\\}$，并具有适当的排序。形成平方模 $|k|^2=k_x^2+k_y^2$。\n- 对于每个 $(k_x,k_y)\\neq(0,0)$，构建 $P(k)=I-\\frac{k\\,k^{\\top}}{|k|^2}$，即，\n$$\nP_{11}=1-\\frac{k_x^2}{k_x^2+k_y^2},\\quad P_{22}=1-\\frac{k_y^2}{k_x^2+k_y^2},\\quad P_{12}=P_{21}=-\\frac{k_x k_y}{k_x^2+k_y^2},\n$$\n对于 $(k_x,k_y)=(0,0)$，设置 $P(0)=I$，但请注意在这种情况下 $\\widehat{u}(0)=0$。应用 $\\widehat{w}_1=P_{11}\\widehat{u}_1+P_{12}\\widehat{u}_2$ 和 $\\widehat{w}_2=P_{21}\\widehat{u}_1+P_{22}\\widehat{u}_2$，并设置 $\\widehat{\\nabla\\phi}=\\widehat{u}-\\widehat{w}$。\n- 逆 FFT 得到物理空间场 $w$ 和 $\\nabla\\phi$。\n- 使用周期网格上的梯形法则近似 $L^2$ 范数：\n$$\n\\|v\\|_{L^2}^2\\approx (2\\pi)^2\\frac{1}{N^2}\\sum_{i,j} (v_1(x_i,y_j)^2+v_2(x_i,y_j)^2),\\quad \\|v\\|_{L^2}=\\sqrt{\\cdot},\n$$\n以及内积 $\\langle w,\\nabla\\phi\\rangle\\approx (2\\pi)^2\\frac{1}{N^2}\\sum_{i,j} w\\cdot \\nabla\\phi$。\n- 验证 $\\lvert\\langle w,\\nabla\\phi\\rangle\\rvert  \\varepsilon$ 和 $\\left|\\|u\\|_{L^2}^2 - \\|w\\|_{L^2}^2 - \\|\\nabla \\phi\\|_{L^2}^2\\right|  \\varepsilon$。\n\n对于给定场 $u(x,y)=(\\sin x,\\sin y)^{\\top}$，一个解析上的观察是 $u=-\\nabla(\\cos x+\\cos y)$，因此无散分量 $w$ 恒为零，无旋分量等于 $u$，并且精确范数满足\n$$\n\\|w\\|_{L^2}=0,\\quad \\|\\nabla\\phi\\|_{L^2}=\\|u\\|_{L^2}=\\sqrt{\\int_{0}^{2\\pi}\\int_{0}^{2\\pi}(\\sin^2 x+\\sin^2 y)\\,\\mathrm{d}x\\,\\mathrm{d}y} = \\sqrt{4\\pi^2}=2\\pi.\n$$\n数值方法应能在离散化和舍入误差范围内恢复这些结果，对于网格上可表示的模式，结果应是精确的。值得注意的是，对于 $N=2$，$x\\in\\{0,\\pi\\}$ 处的 $\\sin$ 采样值为零，因此离散场恒为零；这是一个边界情况，其中所有范数在数值上均为零，但仍然满足正交性和毕达哥拉斯恒等式。\n\n该实现仅使用 NumPy 库来计算 FFT 和数组操作。每个测试用例 $(N,\\varepsilon)$ 的结果是一个列表 $[\\|w\\|_{L^2},\\|\\nabla\\phi\\|_{L^2},\\text{ortho\\_ok},\\text{energy\\_ok}]$，程序会打印一行包含所有指定测试用例的这些列表的列表。", "answer": "```python\nimport numpy as np\n\ndef helmholtz_project_and_metrics(N, tol):\n    # Domain and grid\n    L = 2.0 * np.pi\n    x = np.linspace(0.0, L, N, endpoint=False)\n    y = np.linspace(0.0, L, N, endpoint=False)\n    X, Y = np.meshgrid(x, y, indexing='ij')\n\n    # Manufactured field u = (sin x, sin y)\n    u1 = np.sin(X)\n    u2 = np.sin(Y)\n\n    # FFTs of components\n    U1_hat = np.fft.fft2(u1)\n    U2_hat = np.fft.fft2(u2)\n\n    # Integer wavenumbers corresponding to 2π-periodic grid\n    k_vals = np.fft.fftfreq(N, d=1.0 / N)  # integers\n    KX, KY = np.meshgrid(k_vals, k_vals, indexing='ij')\n    K2 = KX**2 + KY**2\n\n    # Build projection matrix P(k) = I - k k^T / |k|^2 for k != 0\n    # Use float arrays for P, then rely on casting to complex in multiplications\n    Pxx = np.ones_like(K2, dtype=float)\n    Pyy = np.ones_like(K2, dtype=float)\n    Pxy = np.zeros_like(K2, dtype=float)\n\n    mask = K2 > 0\n    # Avoid division by zero at k=0; values at k=0 won't matter since U_hat at k=0 is zero for this field.\n    Pxx[mask] = 1.0 - (KX[mask]**2) / K2[mask]\n    Pyy[mask] = 1.0 - (KY[mask]**2) / K2[mask]\n    Pxy[mask] = - (KX[mask] * KY[mask]) / K2[mask]\n\n    # Apply projection in Fourier space\n    W1_hat = Pxx * U1_hat + Pxy * U2_hat\n    W2_hat = Pxy * U1_hat + Pyy * U2_hat\n\n    # Gradient (irrotational) complement\n    G1_hat = U1_hat - W1_hat\n    G2_hat = U2_hat - W2_hat\n\n    # Inverse FFT to get physical-space fields (take real parts due to numerical roundoff)\n    w1 = np.real(np.fft.ifft2(W1_hat))\n    w2 = np.real(np.fft.ifft2(W2_hat))\n    g1 = np.real(np.fft.ifft2(G1_hat))\n    g2 = np.real(np.fft.ifft2(G2_hat))\n\n    # L2 norms via trapezoidal rule on periodic grid\n    area = L * L\n    def l2_norm(v1, v2):\n        sq = v1*v1 + v2*v2\n        mean_sq = np.mean(sq)\n        return np.sqrt(area * mean_sq)\n\n    norm_w = l2_norm(w1, w2)\n    norm_g = l2_norm(g1, g2)\n    norm_u = l2_norm(u1, u2)\n\n    # Inner product\n    def l2_inner_product(v1, w1, v2, w2):\n        dot_product = v1 * w1 + v2 * w2\n        mean_dot = np.mean(dot_product)\n        return area * mean_dot\n\n    inner_prod_wg = l2_inner_product(w1, g1, w2, g2)\n    \n    # Check conditions\n    ortho_ok = np.abs(inner_prod_wg)  tol\n    energy_sq_diff = norm_u**2 - (norm_w**2 + norm_g**2)\n    energy_ok = np.abs(energy_sq_diff)  tol\n\n    return [norm_w, norm_g, ortho_ok, energy_ok]\n\ndef solve_all_and_print():\n    test_cases = [\n        (2, 1e-12),\n        (3, 1e-12),\n        (8, 1e-12),\n        (16, 1e-12),\n        (64, 1e-12),\n    ]\n    \n    all_results = []\n    for N, tol in test_cases:\n        result = helmholtz_project_and_metrics(N, tol)\n        all_results.append(result)\n    \n    # Format output as a single line string representing a list of lists.\n    formatted_lists = []\n    for res in all_results:\n        # Format numbers and lowercase booleans\n        list_items = f\"{res[0]},{res[1]},{str(bool(res[2])).lower()},{str(bool(res[3])).lower()}\"\n        formatted_lists.append(f\"[{list_items}]\")\n    \n    print(f\"[{','.join(formatted_lists)}]\")\n\nif __name__ == \"__main__\":\n    solve_all_and_print()\n```", "id": "3328665"}, {"introduction": "最后一个练习探讨了谱方法中的一个关键数值伪影：混叠误差 (aliasing error) [@problem_id:3328699]。虽然谱方法精度很高，但这仅对被良好解析的场成立。本实践将展示当网格过于粗糙，无法表示流场的高频分量时会发生什么，从而导致混叠现象。通过分析一个含有欠解析分量的合成场，您将量化这种效应如何导致理论上正交的螺线子空间和势流子空间之间发生“泄漏”，这是任何谱方法CFD实际应用中都必须考虑的关键问题。", "problem": "考虑一个边长为 $L_x = 2\\pi$ 和 $L_y = 2\\pi$ 的二维周期性计算域。您将使用谱方法，在不可压缩约束下，为一个合成速度场实现、验证和分析亥姆霍兹分解。该分解旨在将一个矢量场 $\\mathbf{u}(\\mathbf{x})$ 表示为一个在周期性盒子上的无散（散度为零）部分和一个无旋（旋度为零）部分之和。您必须构造一个具有已知无散和无旋分量的合成场，使用基于快速傅里叶变换 (FFT) 的泊松求解器将其数值投影到无散子空间上，并量化由欠解析采样引起的混叠污染。\n\n推导和实现必须从基本原理和经过充分检验的事实出发：\n- 不可压缩约束为 $\\nabla \\cdot \\mathbf{u} = 0$。\n- 周期域上的亥姆霍兹分解（对于足够光滑的场）保证了矢量场可以唯一地分裂为一个无旋（梯度）分量和一个无散（散度为零）分量，其差值为不影响梯度或散度的相加常数。\n- 周期域上的傅里叶基函数可以对角化常系数线性微分算子。在均匀离散化并以谱方法处理的域上，导数对应于在傅里叶空间中乘以相应的波数。\n\n您将按以下步骤进行：\n1) 在一个均匀的 $N \\times N$ 网格上（其中 $x \\in [0, 2\\pi)$, $y \\in [0, 2\\pi)$）构造一个合成速度场 $\\mathbf{u}(\\mathbf{x}) = \\mathbf{u}_{\\mathrm{sol}}(\\mathbf{x}) + \\mathbf{u}_{\\mathrm{irr}}(\\mathbf{x})$。使用以下势函数：\n- 一个流函数 $\\psi(\\mathbf{x})$，通过 $\\mathbf{u}_{\\mathrm{sol}} = \\nabla \\times (\\psi \\,\\hat{\\mathbf{e}}_z) = \\left(\\partial_y \\psi, -\\partial_x \\psi\\right)$ 生成无散部分，\n- 一个标量势 $\\phi(\\mathbf{x})$，通过 $\\mathbf{u}_{\\mathrm{irr}} = \\nabla \\phi = \\left(\\partial_x \\phi, \\partial_y \\phi\\right)$ 生成无旋部分，\n其中势函数由单平面波模式定义：\n$$\n\\psi(\\mathbf{x}) = \\sin\\!\\left(k_{s,x} x + k_{s,y} y\\right), \\qquad\n\\phi(\\mathbf{x}) = \\sin\\!\\left(k_{i,x} x + k_{i,y} y\\right).\n$$\n振幅是无量纲的，并设置为1。\n\n2) 从不可压缩约束和亥姆霍兹分解的定义出发，推导一个谱投影，该投影通过求解与无旋分量相关的标量势的泊松方程，将任意矢量场 $\\mathbf{u}$ 映射到周期性网格上的无散分量。使用快速傅里叶变换 (FFT) 在物理空间和谱空间之间转换，并利用拉普拉斯算子和梯度/散度算子在谱空间中的对角结构来实现此投影。\n\n3) 对于下面指定的每个测试用例，计算三个诊断量：\n- 投影场的相对散度，\n$$\nr_{\\mathrm{div}} = \\frac{\\|\\nabla \\cdot \\mathbf{u}_{\\mathrm{proj}}\\|_{2}}{\\|\\mathbf{u}_{\\mathrm{proj}}\\|_{2}},\n$$\n- 无散部分的相对恢复误差，\n$$\nr_{\\mathrm{rec}} = \\frac{\\|\\mathbf{u}_{\\mathrm{proj}} - \\mathbf{u}_{\\mathrm{sol,ref}}\\|_{2}}{\\|\\mathbf{u}_{\\mathrm{sol,ref}}\\|_{2}},\n$$\n- 无旋部分泄漏到无散子空间中的相对量，\n$$\nr_{\\mathrm{leak}} = \\frac{\\|\\mathcal{P}\\,\\mathbf{u}_{\\mathrm{irr,ref}}\\|_{2}}{\\|\\mathbf{u}_{\\mathrm{irr,ref}}\\|_{2}},\n$$\n其中 $\\|\\cdot\\|_{2}$ 是在 $N \\times N$ 网格上的离散均方根范数（即，数值平方的平均值的平方根），$\\mathbf{u}_{\\mathrm{proj}}$ 是从总场 $\\mathbf{u}$ 获得的数值投影的无散场，$\\mathcal{P}$ 表示无散投影算子，参考场 $\\mathbf{u}_{\\mathrm{sol,ref}}$ 和 $\\mathbf{u}_{\\mathrm{irr,ref}}$ 是在相同网格上直接由上述势函数构造的场，并应用了与投影前对总场应用的相同预处理（在本问题中，不应用滤波；因此参考场就是相应的采样场）。\n\n4) 通过比较指定波数被采样网格良好解析的情况与指定波数超过奈奎斯特极限的情况，来分析混叠引起的污染。在欠解析的情况下，在网格点上对高波数平面波进行采样会产生一个具有不同波矢量的混叠波。因为采样场的矢量振幅由真实（未混叠）的波矢量决定，所以它未必与离散算子使用的混叠波矢量正交或平行。因此，离散亥姆霍兹投影将无法完美恢复原始的无散分量，也无法完美剔除无旋分量；您的诊断量将量化此效应。\n\n需遵循的数值和实现细节：\n- 使用均匀网格，其中 $x_j = 2\\pi\\, j / N$, $y_\\ell = 2\\pi\\, \\ell / N$，对于 $j,\\ell \\in \\{0,1,\\dots,N-1\\}$。\n- 使用与 $L_x = L_y = 2\\pi$ 选择一致的谱微分，使得物理波数是由 FFT 频率规定生成的整数数组，并且傅里叶空间中的导数对应于乘以 $\\mathrm{i} k$。\n- 单独处理零波矢量，以避免在对拉普拉斯算子求逆时除以零。零模式的精确约定不影响此处定义的场的诊断，因为它们的空间平均值为零。\n- 所有量都是无量纲的；不需要物理单位。\n\n测试套件：\n您的程序必须运行以下四个测试用例，并将结果汇总到单个输出中。\n- 情况 1：$N = 64$, $\\mathbf{k}_s = (2,3)$, $\\mathbf{k}_i = (1,4)$。\n- 情况 2：$N = 64$, $\\mathbf{k}_s = (31,30)$, $\\mathbf{k}_i = (29,1)$。\n- 情况 3：$N = 32$, $\\mathbf{k}_s = (25,7)$, $\\mathbf{k}_i = (22,5)$。\n- 情况 4：$N = 64$, $\\mathbf{k}_s = (25,7)$, $\\mathbf{k}_i = (22,5)$。\n\n对于每种情况，计算并报告列表 $[r_{\\mathrm{div}}, r_{\\mathrm{rec}}, r_{\\mathrm{leak}}]$，每个值四舍五入到六位小数。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含四个案例结果的嵌套、逗号分隔的列表，没有空格，并且每个浮点值都四舍五入到六位小数。例如，输出必须具有以下形式：\n$[[a_{11},a_{12},a_{13}],[a_{21},a_{22},a_{23}],[a_{31},a_{32},a_{33}],[a_{41},a_{42},a_{43}]]$\n其中每个 $a_{ij}$ 是一个四舍五入到六位小数的浮点数。\n\n您提交的内容必须是一个完整的、可运行的程序，该程序无需任何外部输入即可执行所有计算，并仅以上述确切格式打印最后一行。", "solution": "该问题要求使用谱方法在二维周期域上实现和验证亥姆霍兹分解。目标是将给定矢量场分离为其无散（散度为零）和无旋（旋度为零）分量，并分析数值误差，特别是那些由混叠引起的误差。\n\n### 理论基础：亥姆霍兹分解与泊松方程\n\n亥姆霍兹分解定理指出，任何在周期域上足够光滑的矢量场 $\\mathbf{u}$ 都可以唯一地（在相差一个常数的范围内）表示为一个无旋场 $\\mathbf{u}_{\\mathrm{irr}}$ 和一个无散场 $\\mathbf{u}_{\\mathrm{sol}}$ 的和：\n$$\n\\mathbf{u} = \\mathbf{u}_{\\mathrm{irr}} + \\mathbf{u}_{\\mathrm{sol}}\n$$\n根据定义，无旋分量是无旋的，$\\nabla \\times \\mathbf{u}_{\\mathrm{irr}} = \\mathbf{0}$，这意味着它可以写成一个标量势的梯度，即 $\\mathbf{u}_{\\mathrm{irr}} = \\nabla \\phi$。无散分量是散度为零的，$\\nabla \\cdot \\mathbf{u}_{\\mathrm{sol}} = 0$。在二维情况下，这使得它可以表示为一个流函数的旋度，即 $\\mathbf{u}_{\\mathrm{sol}} = \\nabla \\times (\\psi \\hat{\\mathbf{e}}_z)$。\n\n为了找到 $\\mathbf{u}$ 到无散子空间上的投影，我们必须找到并减去其无旋部分。我们可以通过对分解式取散度来推导标量势 $\\phi$ 的方程：\n$$\n\\nabla \\cdot \\mathbf{u} = \\nabla \\cdot (\\nabla \\phi + \\mathbf{u}_{\\mathrm{sol}})\n$$\n利用散度算子的线性和无散场的定义属性 $\\nabla \\cdot \\mathbf{u}_{\\mathrm{sol}} = 0$，我们得到：\n$$\n\\nabla \\cdot \\mathbf{u} = \\nabla \\cdot (\\nabla \\phi) = \\nabla^2 \\phi\n$$\n这是一个关于标量势 $\\phi$ 的泊松方程，其源项是原始场 $\\mathbf{u}$ 的散度。一旦我们解出此方程得到 $\\phi$，我们就可以构造无旋分量 $\\mathbf{u}_{\\mathrm{irr}} = \\nabla \\phi$。然后，通过相减得到所需的无散分量，我们称之为投影场 $\\mathbf{u}_{\\mathrm{proj}}$：\n$$\n\\mathbf{u}_{\\mathrm{proj}} = \\mathcal{P}(\\mathbf{u}) = \\mathbf{u} - \\mathbf{u}_{\\mathrm{irr}} = \\mathbf{u} - \\nabla \\phi\n$$\n这里，$\\mathcal{P}$ 代表到无散场空间的投影算子。\n\n### 谱方法实现\n\n该问题设定在大小为 $L_x = 2\\pi$ x $L_y = 2\\pi$ 的周期域上，这对于基于快速傅里叶变换 (FFT) 的谱方法是理想的。在傅里叶空间中，微分算子变为代数算子。对于函数 $f(\\mathbf{x})$，其傅里叶变换为 $\\hat{f}(\\mathbf{k}) = \\mathcal{F}\\{f(\\mathbf{x})\\}$，其中 $\\mathbf{k} = (k_x, k_y)$ 是整数波矢量。关键属性如下：\n- 梯度：$\\mathcal{F}\\{\\nabla f\\} = i\\mathbf{k} \\hat{f}(\\mathbf{k})$\n- 散度：$\\mathcal{F}\\{\\nabla \\cdot \\mathbf{u}\\} = i\\mathbf{k} \\cdot \\hat{\\mathbf{u}}(\\mathbf{k})$\n- 拉普拉斯算子：$\\mathcal{F}\\{\\nabla^2 f\\} = -|\\mathbf{k}|^2 \\hat{f}(\\mathbf{k})$，其中 $|\\mathbf{k}|^2 = k_x^2 + k_y^2$。\n\n将泊松方程 $\\nabla^2 \\phi = \\nabla \\cdot \\mathbf{u}$ 转换到傅里叶空间，得到：\n$$\n-|\\mathbf{k}|^2 \\hat{\\phi}(\\mathbf{k}) = i\\mathbf{k} \\cdot \\hat{\\mathbf{u}}(\\mathbf{k})\n$$\n我们可以解出标量势的傅里叶系数 $\\hat{\\phi}(\\mathbf{k})$：\n$$\n\\hat{\\phi}(\\mathbf{k}) = -\\frac{i\\mathbf{k} \\cdot \\hat{\\mathbf{u}}(\\mathbf{k})}{|\\mathbf{k}|^2}\n$$\n对于零波数模式 $\\mathbf{k} = (0, 0)$，其中 $|\\mathbf{k}|^2 = 0$，此表达式无定义。该模式对应于势的空间平均值 $\\phi_0$。由于常数的梯度为零，$\\phi_0$ 是任意的，不影响速度场。我们按照惯例设置 $\\hat{\\phi}(\\mathbf{0}) = 0$。\n\n对场 $\\mathbf{u}=(u_x, u_y)$ 进行投影的完整数值算法如下：\n1.  计算速度分量的二维 FFT：$\\hat{u}_x(\\mathbf{k}) = \\mathcal{F}\\{u_x(\\mathbf{x})\\}$ 和 $\\hat{u}_y(\\mathbf{k}) = \\mathcal{F}\\{u_y(\\mathbf{x})\\}$。\n2.  在傅里叶空间中计算散度的 FFT：$\\widehat{\\nabla \\cdot \\mathbf{u}}(\\mathbf{k}) = i k_x \\hat{u}_x(\\mathbf{k}) + i k_y \\hat{u}_y(\\mathbf{k})$。\n3.  在傅里叶空间中求解势：对于 $\\mathbf{k} \\neq \\mathbf{0}$，$\\hat{\\phi}(\\mathbf{k}) = \\widehat{\\nabla \\cdot \\mathbf{u}}(\\mathbf{k}) / (-|\\mathbf{k}|^2)$，并设 $\\hat{\\phi}(\\mathbf{0}) = 0$。\n4.  计算无旋速度分量的 FFT：$\\hat{\\mathbf{u}}_{\\mathrm{irr}}(\\mathbf{k}) = (i k_x \\hat{\\phi}(\\mathbf{k}), i k_y \\hat{\\phi}(\\mathbf{k}))$。\n5.  在傅里叶空间中减去无旋分量以获得投影场：$\\hat{\\mathbf{u}}_{\\mathrm{proj}}(\\mathbf{k}) = \\hat{\\mathbf{u}}(\\mathbf{k}) - \\hat{\\mathbf{u}}_{\\mathrm{irr}}(\\mathbf{k})$。\n6.  计算二维逆 FFT 以获得物理空间中的投影场：$\\mathbf{u}_{\\mathrm{proj}}(\\mathbf{x}) = \\mathcal{F}^{-1}\\{\\hat{\\mathbf{u}}_{\\mathrm{proj}}(\\mathbf{k})\\}$。\n\n### 合成场和混叠分析\n\n我们从一个已知的无散部分 $\\mathbf{u}_{\\mathrm{sol,ref}}$ 和无旋部分 $\\mathbf{u}_{\\mathrm{irr,ref}}$ 构造一个合成速度场。\n给定 $\\psi(\\mathbf{x}) = \\sin(\\mathbf{k}_s \\cdot \\mathbf{x})$ 和 $\\phi(\\mathbf{x}) = \\sin(\\mathbf{k}_i \\cdot \\mathbf{x})$，解析场为：\n$$\n\\mathbf{u}_{\\mathrm{sol,ref}} = \\nabla \\times (\\psi \\hat{\\mathbf{e}}_z) = (k_{s,y}, -k_{s,x}) \\cos(\\mathbf{k}_s \\cdot \\mathbf{x})\n$$\n$$\n\\mathbf{u}_{\\mathrm{irr,ref}} = \\nabla \\phi = (k_{i,x}, k_{i,y}) \\cos(\\mathbf{k}_i \\cdot \\mathbf{x})\n$$\n该问题的一个关键方面是分析混叠。大小为 $N$ 的离散网格只能表示奈奎斯特极限以内的波数，即 $|k|  N/2$。当一个波数为 $|k_x| \\ge N/2$ 或 $|k_y| \\ge N/2$ 的函数在网格上采样时，它被混叠了：它变得与一个在可表示范围内具有更低波数 $k'$ 的波无法区分，其中 $k' \\equiv k \\pmod{N}$。\n\n这种混叠污染了亥姆霍兹分解。例如，解析无散场 $\\mathbf{u}_{\\mathrm{sol,ref}}$ 的矢量振幅 $(k_{s,y}, -k_{s,x})$ 与其波矢量 $\\mathbf{k}_s$ 正交。当 $\\mathbf{k}_s$ 混叠为 $\\mathbf{k}'_s$ 时，离散梯度和散度算子的作用就好像波矢量是 $\\mathbf{k}'_s$。然而，采样振幅 $(k_{s,y}, -k_{s,x})$ 通常不与*混叠*波矢量 $\\mathbf{k}'_s$ 正交。因此，采样的“无散”场的离散散度非零，即 $\\nabla_h \\cdot \\mathbf{u}_{\\mathrm{sol,ref}} \\neq 0$。类似地，采样的“无旋”场的离散旋度也变为非零。基于这些离散算子的投影算子将因此无法完美地分离这些分量。这导致非零的恢复误差 $r_{\\mathrm{rec}}$ 和泄漏误差 $r_{\\mathrm{leak}}$。\n\n测试用例旨在说明这一点。情况 1、2 和 4 使用的波数能被网格很好地解析（$|\\mathbf{k}_{s,i}|  N/2$），因此误差预计接近机器精度。情况 3 使用的波数超过其网格（$N=32$）的奈奎斯特极限，导致显著的混叠，从而产生更大的、可量化的误差。诊断量 $r_{\\mathrm{div}}$ 用于测量最终投影场的散度，预计在所有情况下都接近于零，因为投影算子的构造目的就是为了产生一个相对于离散散度算子本身是无散的场。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final result.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, (ksx, ksy), (kix, kiy))\n        (64, (2, 3), (1, 4)),\n        (64, (31, 30), (29, 1)),\n        (32, (25, 7), (22, 5)),\n        (64, (25, 7), (22, 5)),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, ks, ki = case\n        result_case = run_single_case(N, ks, ki)\n        results.append(result_case)\n\n    # Format the final output string exactly as specified.\n    outer_list = []\n    for result_case in results:\n        inner_list_str = '[' + ','.join([f'{x:.6f}' for x in result_case]) + ']'\n        outer_list.append(inner_list_str)\n    final_output = '[' + ','.join(outer_list) + ']'\n    \n    print(final_output)\n\ndef run_single_case(N, ks, ki):\n    \"\"\"\n    Performs the Helmholtz decomposition and computes diagnostics for a single test case.\n\n    Args:\n        N (int): Grid size (N x N).\n        ks (tuple): Wavenumber vector (kx, ky) for the solenoidal part.\n        ki (tuple): Wavenumber vector (kx, ky) for the irrotational part.\n\n    Returns:\n        list: A list containing [r_div, r_rec, r_leak] rounded to 6 decimal places.\n    \"\"\"\n    # 1. Setup Grid and Wavenumbers\n    x = (2 * np.pi / N) * np.arange(N)\n    y = (2 * np.pi / N) * np.arange(N)\n    X, Y = np.meshgrid(x, y, indexing='ij')\n\n    kx = np.fft.fftfreq(N) * N\n    ky = np.fft.fftfreq(N) * N\n    Kx, Ky = np.meshgrid(kx, ky, indexing='ij')\n    K2 = Kx**2 + Ky**2\n    \n    # Pre-calculate inverse Laplacian, handling the k=0 case\n    K2_inv = np.zeros_like(K2, dtype=float)\n    K2_inv[K2 > 0] = 1.0 / K2[K2 > 0]\n\n    # 2. Construct Reference Fields\n    # Solenoidal part: u = curl(psi * ez) = (d(psi)/dy, -d(psi)/dx)\n    # psi = sin(ksx*x + ksy*y)\n    arg_s = ks[0] * X + ks[1] * Y\n    cos_s = np.cos(arg_s)\n    u_sol_ref_x = ks[1] * cos_s\n    u_sol_ref_y = -ks[0] * cos_s\n    \n    # Irrotational part: u = grad(phi) = (d(phi)/dx, d(phi)/dy)\n    # phi = sin(kix*x + kiy*y)\n    arg_i = ki[0] * X + ki[1] * Y\n    cos_i = np.cos(arg_i)\n    u_irr_ref_x = ki[0] * cos_i\n    u_irr_ref_y = ki[1] * cos_i\n    \n    # Total synthetic field\n    u_total_x = u_sol_ref_x + u_irr_ref_x\n    u_total_y = u_sol_ref_y + u_irr_ref_y\n\n    # Helper functions for projection, divergence, and norms\n    def project(ux, uy):\n        ux_hat = np.fft.fft2(ux)\n        uy_hat = np.fft.fft2(uy)\n        \n        # phi_hat = -(i*Kx*ux_hat + i*Ky*uy_hat) / K2\n        phi_hat = -1j * (Kx * ux_hat + Ky * uy_hat) * K2_inv\n        \n        # u_irr_hat = (i*Kx*phi_hat, i*Ky*phi_hat)\n        u_irr_hat_x = 1j * Kx * phi_hat\n        u_irr_hat_y = 1j * Ky * phi_hat\n        \n        # u_proj_hat = u_hat - u_irr_hat\n        u_proj_hat_x = ux_hat - u_irr_hat_x\n        u_proj_hat_y = uy_hat - u_irr_hat_y\n        \n        u_proj_x = np.fft.ifft2(u_proj_hat_x).real\n        u_proj_y = np.fft.ifft2(u_proj_hat_y).real\n        \n        return u_proj_x, u_proj_y\n\n    def spectral_divergence(ux, uy):\n        ux_hat = np.fft.fft2(ux)\n        uy_hat = np.fft.fft2(uy)\n        div_hat = 1j * Kx * ux_hat + 1j * Ky * uy_hat\n        return np.fft.ifft2(div_hat).real\n\n    def rms_norm_scalar(field):\n        return np.sqrt(np.mean(field**2))\n    \n    def rms_norm_vector(field_x, field_y):\n        return np.sqrt(np.mean(field_x**2 + field_y**2))\n\n    # 3. Compute Projected Field and Diagnostics\n    \n    # A. Compute r_div\n    u_proj_x, u_proj_y = project(u_total_x, u_total_y)\n    div_u_proj = spectral_divergence(u_proj_x, u_proj_y)\n    norm_div_proj = rms_norm_scalar(div_u_proj)\n    norm_u_proj = rms_norm_vector(u_proj_x, u_proj_y)\n    r_div = norm_div_proj / norm_u_proj if norm_u_proj > 1e-15 else 0.0\n\n    # B. Compute r_rec\n    norm_sol_ref = rms_norm_vector(u_sol_ref_x, u_sol_ref_y)\n    norm_diff = rms_norm_vector(u_proj_x - u_sol_ref_x, u_proj_y - u_sol_ref_y)\n    r_rec = norm_diff / norm_sol_ref if norm_sol_ref > 1e-15 else 0.0\n    \n    # C. Compute r_leak\n    # Project the irrotational part to see how much \"leaks\" through\n    u_irr_proj_x, u_irr_proj_y = project(u_irr_ref_x, u_irr_ref_y)\n    norm_leak = rms_norm_vector(u_irr_proj_x, u_irr_proj_y)\n    norm_irr_ref = rms_norm_vector(u_irr_ref_x, u_irr_ref_y)\n    r_leak = norm_leak / norm_irr_ref if norm_irr_ref > 1e-15 else 0.0\n    \n    return [r_div, r_rec, r_leak]\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3328699"}]}