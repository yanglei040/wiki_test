{"hands_on_practices": [{"introduction": "在同位网格（collocated grid）上进行不可压缩流的数值模拟时，一个经典的问题是压力-速度解耦。这种解耦现象可能导致非物理的、高频的“棋盘格”压力振荡，而动量方程对此却几乎没有响应。本实践旨在通过一个精心设计的数值实验，从根本上理解 Rhie-Chow 动量插值法如何解决这一问题。我们将通过理论推导和编程实践，量化 Rhie-Chow 插值对虚假压力模态的阻尼效应，从而深刻揭示其核心工作原理。", "problem": "要求你分析、推导并数值验证 Rhie–Chow 动量插值 (Rhie–Chow (RC)) 在一维、均匀、同位网格有限体积离散化中对稳态不可压缩流动的伪压力-速度解耦模式的阻尼作用。从牛顿、常密度流体的稳态一维动量平衡方程开始，其连续形式为 $0 = -\\partial p/\\partial x + f(x) + \\nu \\, \\partial^2 u/\\partial x^2$，其中，$p$ 是压力，$u$ 是与 $x$ 轴平行的速度分量，$f(x)$ 是单位体积的体积力，$\\nu$ 是运动粘度。通过指定一个振荡压力 $p(x)=p_0+\\epsilon \\cos(k x)$ 并选择 $f(x)$ 使得在连续方程中 $-\\partial p/\\partial x + f(x) = 0$ 精确成立，构造一个容许均匀目标速度 $u^\\star$ 的人造解。考虑一个无量纲长度为 $L=2\\pi$ 的均匀周期性域，该域被 $N$ 个具有均匀间距 $\\Delta x = L/N$ 和周期性边界条件的同位控制体离散化。\n\n在同位网格上，定义以下离散量：单元中心由整数 $j\\in \\{0,1,\\dots,N-1\\}$ 索引，面位于 $x_{j+1/2} = x_j + \\Delta x/2$，并采用周期性索引。设离散压力场为 $p_j = p_0 + \\epsilon \\cos(k x_j)$，其中 $k$ 是一个整数空间频率，使得 $kL$ 是 $2\\pi$ 的倍数。只考虑源于离散压力梯度的面法向速度贡献，忽略所有其他项（即，假设齐次解的贡献为常数且可被精确插值）。为简单起见，使用无量纲的 Rhie–Chow 标度因子 $D=1$，这对应于单位逆动量系数。然后：\n- 在面 $f=j+1/2$ 上，将朴素（非 RC）面速度贡献定义为 $u^{\\mathrm{naive}}_f = - D \\, (p_{j+1}-p_j)/\\Delta x$。\n- 将使用相邻单元中心梯度平均值的 Rhie–Chow 面速度贡献定义为 $u^{\\mathrm{RC}}_f = - D \\, \\tfrac{1}{2}\\left(g_j + g_{j+1}\\right)$，其中 $g_j = (p_{j+1} - p_{j-1})/(2\\Delta x)$ 是单元 $j$ 处的中心差分梯度。\n\n此处，RC 引起的伪模式阻尼被量化为 RC 在归因于压力梯度的面速度分量中引入的变化，即修正项 $u^{\\mathrm{RC}}_f - u^{\\mathrm{naive}}_f$。对于给定的 $\\epsilon$ 和波数 $k$，将阻尼幅值定义为 $A_{\\mathrm{corr}}(k,\\epsilon) = \\max_f \\left|u^{\\mathrm{RC}}_f - u^{\\mathrm{naive}}_f\\right|$，并将归一化阻尼比定义为 $R(k,\\epsilon) = A_{\\mathrm{corr}}(k,\\epsilon)/\\epsilon$。令 $\\theta = k \\Delta x$ 表示基于单元的无量纲波数。\n\n你的任务是：\n- 从第一性原理出发，推导为什么在同位网格上，$u^{\\mathrm{naive}}_f$ 和 $u^{\\mathrm{RC}}_f$ 是压力梯度对面试速度贡献的恰当离散对应项，以及 RC 修正项如何起到阻尼伪棋盘格模式的作用。仅使用稳态动量平衡、均匀网格上的中心有限体积差分和线性插值概念。\n- 解析地展示 RC 修正项如何随无量纲波数 $\\theta$ 缩放，并确定在小 $\\theta$ 情况下，$R(k,\\epsilon)$ 相对于 $k \\Delta x$ 和 $\\epsilon$ 的渐近缩放关系。\n\n然后实现一个程序，对于 $L=2\\pi$ 和 $N=128$ 的单域配置，在人造压力场 $p_j = p_0 + \\epsilon \\cos(k x_j)$ 下，对以下整数模式集 $m \\in \\{1,4,16,64\\}$（其中 $k=m$）和两个幅值 $\\epsilon \\in \\{10^{-6}, 10^{-3}\\}$ 数值评估 RC 修正。使用周期性索引。对于每对 $(m,\\epsilon)$：\n- 计算朴素面速度 $u^{\\mathrm{naive}}_f$ 和 RC 面速度 $u^{\\mathrm{RC}}_f$。\n- 通过取所有面上最大绝对修正值除以 $\\epsilon$ 来计算归一化阻尼比 $R(m,\\epsilon)=A_{\\mathrm{corr}}(m,\\epsilon)/\\epsilon$。\n\n通过对仅使用模式 $m \\in \\{1,4,16\\}$（不包括 $m=64$）的 $\\log R$ 与 $\\log(k \\Delta x)$ 进行最小二乘拟合，估计在小 $k\\Delta x$ 处满足 $R \\propto (k\\Delta x)^n$ 的缩放指数 $n$。对每个 $\\epsilon$ 值各执行一次，共两次。\n\n此外，通过计算四个模式中与完美线性的最大相对偏差，来量化 RC 修正项相对于 $\\epsilon$ 的线性度：\n$$\n\\delta_{\\mathrm{lin}} = \\max_{m \\in \\{1,4,16,64\\}} \\left| \\frac{A_{\\mathrm{corr}}(m,10^{-3})}{A_{\\mathrm{corr}}(m,10^{-6})} \\cdot \\frac{10^{-6}}{10^{-3}} - 1 \\right|.\n$$\n\n测试套件和要求输出：\n- 使用 $N=128$, $L=2\\pi$, $D=1$, $m \\in \\{1,4,16,64\\}$ 以及 $\\epsilon \\in \\{10^{-6},10^{-3}\\}$。\n- 你的程序必须输出一行，其中包含一个用方括号括起来的逗号分隔列表，按顺序包含以下项目：\n    $[ n(10^{-6}), \\, n(10^{-3}), \\, R(1,10^{-6}), \\, R(4,10^{-6}), \\, R(16,10^{-6}), \\, R(64,10^{-6}), \\, R(1,10^{-3}), \\, R(4,10^{-3}), \\, R(16,10^{-3}), \\, R(64,10^{-3}), \\, \\delta_{\\mathrm{lin}} ]$。\n- 所有量都是无量纲的，角度默认为弧度。最终输出应为浮点数。\n\n你的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表形式的结果（例如 $[r_1,r_2,\\dots]$）。", "solution": "该问题被评估为有效。这是一个在计算流体动力学 (CFD) 标准技术 Rhie–Chow 动量插值方案的数值分析方面，提法恰当、具有科学依据的练习。问题陈述是自洽的，为完成理论推导和数值验证提供了所有必要的参数和定义。\n\n### Rhie–Chow 阻尼的理论分析\n\n#### 1. 同位网格上的压力-速度解耦\n稳态一维动量方程为 $0 = -\\partial p/\\partial x + f(x) + \\nu \\, \\partial^2 u/\\partial x^2$。在同位网格上的有限体积法中，所有变量（压力 $p$，速度 $u$）都存储在单元中心 $x_j$ 处，其中 $j \\in \\{0, 1, \\dots, N-1\\}$。离散动量方程将单元中心速度 $u_j$ 与压力梯度的数值近似以及其他项联系起来。单元 $j$ 处压力梯度的标准中心差分近似为 $(\\nabla p)_j = (p_{j+1} - p_{j-1})/(2\\Delta x)$。\n\n不可压缩流体的连续性方程 $\\partial u/\\partial x = 0$ 通过在控制体（单元 $j$）上积分进行离散化，得到 $u_{j+1/2} - u_{j-1/2} = 0$，其中 $u_{j\\pm 1/2}$ 是单元面上的速度。同位网格布置的核心问题是，单元中心的压力梯度 $(\\nabla p)_j$ 对压力场中的奇偶（棋盘格）振荡不敏感。例如，形式为 $p_j = C(-1)^j$ 的压力场对所有 $j$ 均产生 $(\\nabla p)_j = (C(-1)^{j+1} - C(-1)^{j-1})/(2\\Delta x) = (C(-1)^{j+1} - C(-1)^{j+1})/(2\\Delta x) = 0$。这样的压力场在离散动量方程中不会产生任何力，但它本身是非均匀的。这允许伪非物理解压力模式存在于解中，而动量方程无法检测或修正它们，这种现象被称为压力-速度解耦。网格上可解析的最高频率模式，其无量纲波数为 $k\\Delta x = \\pi$，对应于这种棋盘格模式。\n\n#### 2. 朴素面速度与 Rhie–Chow 面速度\n为满足连续性方程，需要面速度 $u_f$。这些速度必须从单元中心量插值得到。问题定义了两种计算压力梯度对位于面 $f=j+1/2$ 的面速度贡献的方法：\n\n- **朴素插值**：此方法使用最局部的离散压力梯度，该梯度定义在面本身的两侧：\n$$ u^{\\mathrm{naive}}_f = - D \\frac{p_{j+1}-p_j}{\\Delta x} $$\n虽然简单，但当此方法在完整的压力修正算法中使用时，并不能抑制伪压力模式。\n\n- **Rhie–Chow (RC) 插值**：Rhie–Chow 方法以一种明确引入阻尼机制的方式构造面速度。压力梯度对面试速度的贡献是通过首先计算单元中心压力梯度 $g_j = (p_{j+1}-p_{j-1})/(2\\Delta x)$ 和 $g_{j+1}$，然后将它们插值到面上来计算的：\n$$ u^{\\mathrm{RC}}_f = - D \\frac{g_j + g_{j+1}}{2} $$\n这个过程有效地将一个点的压力与更宽的模板耦合起来，从而防止了解耦。\n\nRC 方案的基本阻尼机制体现在这两种公式的差异中。RC 修正项定义为差值 $\\Delta u_f = u^{\\mathrm{RC}}_f - u^{\\mathrm{naive}}_f$。在给定的逆动量系数 $D=1$ 的情况下：\n$$ \\Delta u_{j+1/2} = \\left( -\\frac{1}{2} \\left[ \\frac{p_{j+1}-p_{j-1}}{2\\Delta x} + \\frac{p_{j+2}-p_j}{2\\Delta x} \\right] \\right) - \\left( -\\frac{p_{j+1}-p_j}{\\Delta x} \\right) $$\n在公分母 $4\\Delta x$ 上合并各项：\n$$ \\Delta u_{j+1/2} = \\frac{1}{4\\Delta x} \\left[ -(p_{j+1}-p_{j-1}) - (p_{j+2}-p_j) + 4(p_{j+1}-p_j) \\right] $$\n$$ \\Delta u_{j+1/2} = \\frac{1}{4\\Delta x} \\left[ -p_{j+2} + 3p_{j+1} - 3p_j + p_{j-1} \\right] $$\n这可以重写为：\n$$ \\Delta u_{j+1/2} = -\\frac{\\Delta x^2}{4} \\left[ \\frac{p_{j+2} - 3p_{j+1} + 3p_j - p_{j-1}}{\\Delta x^3} \\right] $$\n括号中的项是压力三阶导数 $\\partial^3 p/\\partial x^3$ 的一个有限差分近似。因此，RC 修正项等效于在面速度上增加一个与 $\\Delta x^2 (\\partial^3 p / \\partial x^3)$ 成比例的项。在完整的压力修正方程（如 SIMPLE 算法）的背景下，此项有效地引入了一个四阶压力导数项，它对压力场起到人工耗散的作用，从而阻尼高频振荡。\n\n#### 3. 正弦模式的解析缩放\n我们分析给定压力场 $p(x) = p_0 + \\epsilon \\cos(kx)$ 的修正项，其在离散点上为 $p_j = p_0 + \\epsilon\\cos(kx_j)$。通过使用三角恒等式可以简化分析。令 $\\theta = k\\Delta x$ 为基于单元的无量纲波数。\n\n朴素速度为：\n$$ u^{\\mathrm{naive}}_{j+1/2} = -\\frac{\\epsilon}{\\Delta x}[\\cos(k(x_j+\\Delta x)) - \\cos(kx_j)] = \\frac{2\\epsilon}{\\Delta x}\\sin(k(x_j+\\Delta x/2))\\sin(k\\Delta x/2) $$\nRC 速度为：\n$$ u^{\\mathrm{RC}}_{j+1/2} = -\\frac{1}{2}(g_j + g_{j+1}) $$\n其中 $g_j = -\\frac{\\epsilon}{\\Delta x}\\sin(kx_j)\\sin(k\\Delta x)$。和 $g_j+g_{j+1}$ 变为：\n$$ g_j+g_{j+1} = -\\frac{\\epsilon}{\\Delta x}\\sin(k\\Delta x)[\\sin(kx_j) + \\sin(k(x_j+\\Delta x))] = -\\frac{2\\epsilon}{\\Delta x}\\sin(k\\Delta x)\\sin(k(x_j+\\Delta x/2))\\cos(k\\Delta x/2) $$\n所以，\n$$ u^{\\mathrm{RC}}_{j+1/2} = \\frac{\\epsilon}{\\Delta x}\\sin(k\\Delta x)\\sin(k(x_j+\\Delta x/2))\\cos(k\\Delta x/2) $$\n使用 $\\sin(k\\Delta x) = 2\\sin(k\\Delta x/2)\\cos(k\\Delta x/2)$，上式简化为：\n$$ u^{\\mathrm{RC}}_{j+1/2} = \\frac{2\\epsilon}{\\Delta x}\\sin(k\\Delta x/2)\\cos^2(k\\Delta x/2)\\sin(k(x_j+\\Delta x/2)) $$\n修正项为 $\\Delta u_{j+1/2} = u^{\\mathrm{RC}}_{j+1/2} - u^{\\mathrm{naive}}_{j+1/2}: $:\n$$ \\Delta u_{j+1/2} = \\frac{2\\epsilon}{\\Delta x}\\sin(k(x_j+\\Delta x/2))\\sin(k\\Delta x/2)[\\cos^2(k\\Delta x/2) - 1] $$\n使用 $\\cos^2\\alpha - 1 = -\\sin^2\\alpha$：\n$$ \\Delta u_{j+1/2} = -\\frac{2\\epsilon}{\\Delta x}\\sin(k(x_j+\\Delta x/2))\\sin^3(k\\Delta x/2) $$\n阻尼幅值是此修正项在所有面上的最大绝对值：\n$$ A_{\\mathrm{corr}}(k, \\epsilon) = \\max_f |\\Delta u_f| = \\frac{2\\epsilon}{\\Delta x}|\\sin^3(k\\Delta x/2)| $$\n因此，归一化阻尼比 $R(k,\\epsilon) = A_{\\mathrm{corr}}(k,\\epsilon)/\\epsilon$ 为：\n$$ R(k, \\epsilon) = \\frac{2}{\\Delta x}|\\sin^3(k\\Delta x/2)| $$\n\n#### 4. 渐近缩放与线性度\n$R(k, \\epsilon)$ 的表达式与压力幅值 $\\epsilon$ 无关。这表明，在这种理想化的形式下，RC 修正机制相对于 $\\epsilon$ 是完全线性的。因此，用于线性度测试的 $\\delta_{\\mathrm{lin}}$ 预期为零（或在机器精度范围内）。\n\n对于小无量纲波数 $\\theta = k\\Delta x \\ll 1$ 的渐近缩放，我们使用小 $z$ 的泰勒展开 $\\sin(z) \\approx z$。\n$$ R(k, \\epsilon) \\approx \\frac{2}{\\Delta x} \\left| \\left(\\frac{k\\Delta x}{2}\\right)^3 \\right| = \\frac{2}{\\Delta x} \\frac{k^3\\Delta x^3}{8} = \\frac{k^3\\Delta x^2}{4} $$\n为了找到在固定网格（$\\Delta x$ 为常数）下满足 $R \\propto (k\\Delta x)^n$ 的缩放指数 $n$，我们将 $R$ 作为 $k$ 的函数进行分析：\n$$ R(k) \\propto k^3 $$\n或者，将 $R$ 表示为 $\\theta=k\\Delta x$ 的函数：\n$$ R(\\theta) \\approx \\frac{(k\\Delta x)^3}{4\\Delta x} = \\frac{1}{4\\Delta x} \\theta^3 $$\n由于 $\\Delta x$ 是常数，所以 $R(\\theta) \\propto \\theta^3 = (k\\Delta x)^3$。因此，缩放指数为 $n=3$。对最小波数的数值拟合应得到一个接近 3 的值。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import linregress\n\ndef solve():\n    \"\"\"\n    Analyzes, derives, and numerically verifies the Rhie–Chow momentum interpolation\n    damping for a 1D steady incompressible flow problem.\n    \"\"\"\n    \n    # Define problem parameters\n    N = 128\n    L = 2 * np.pi\n    dx = L / N\n    modes = [1, 4, 16, 64]\n    epsilons = [1e-6, 1e-3]\n    \n    # Generate grid coordinates for cell centers\n    x_j = np.arange(N) * dx\n    \n    # Dictionaries to store results\n    all_R = {}\n    all_A_corr = {}\n\n    # Iterate over epsilon values and modes\n    for eps in epsilons:\n        all_R[eps] = {}\n        all_A_corr[eps] = {}\n        for m in modes:\n            k = m\n            \n            # --- Numerical Computation of RC Correction ---\n            \n            # Pressure field at cell centers using periodic indexing\n            p_j = eps * np.cos(k * x_j)\n            \n            # Use np.roll for efficient periodic boundary handling\n            p_j_plus_1 = np.roll(p_j, -1)\n            p_j_minus_1 = np.roll(p_j, 1)\n\n            # 1. Naive face velocity contribution from pressure gradient\n            # This is computed for each face j+1/2 between cells j and j+1\n            u_naive = -(p_j_plus_1 - p_j) / dx\n            \n            # 2. Rhie-Chow face velocity contribution\n            # First, compute cell-centered gradients\n            g_j = (p_j_plus_1 - p_j_minus_1) / (2 * dx)\n            g_j_plus_1 = np.roll(g_j, -1)\n            \n            # Then, interpolate gradients to the face\n            u_rc = -0.5 * (g_j + g_j_plus_1)\n            \n            # 3. Compute the correction term, its amplitude, and normalized ratio\n            correction = u_rc - u_naive\n            A_corr = np.max(np.abs(correction))\n            R = A_corr / eps\n            \n            # Store results\n            all_R[eps][m] = R\n            all_A_corr[eps][m] = A_corr\n\n    # --- Post-processing and Analysis ---\n    \n    # 1. Estimate the scaling exponent n\n    fit_modes = [1, 4, 16]\n    log_kdx = np.log([m * dx for m in fit_modes])\n    \n    # Fit for epsilon = 1e-6\n    log_R_eps1 = np.log([all_R[1e-6][m] for m in fit_modes])\n    res1 = linregress(log_kdx, log_R_eps1)\n    n1 = res1.slope\n    \n    # Fit for epsilon = 1e-3\n    log_R_eps2 = np.log([all_R[1e-3][m] for m in fit_modes])\n    res2 = linregress(log_kdx, log_R_eps2)\n    n2 = res2.slope\n\n    # 2. Quantify linearity deviation delta_lin\n    devs = []\n    for m in modes:\n        # The ratio should be 1 for perfect linearity.\n        ratio = (all_A_corr[1e-3][m] / all_A_corr[1e-6][m]) * (1e-6 / 1e-3)\n        dev = np.abs(ratio - 1)\n        devs.append(dev)\n    delta_lin = np.max(devs)\n    \n    # 3. Assemble the final list of results in the required order\n    results = [\n        n1, \n        n2,\n        all_R[1e-6][1], \n        all_R[1e-6][4], \n        all_R[1e-6][16], \n        all_R[1e-6][64],\n        all_R[1e-3][1], \n        all_R[1e-3][4], \n        all_R[1e-3][16], \n        all_R[1e-3][64],\n        delta_lin\n    ]\n\n    # Print the final output in the specified format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3358660"}, {"introduction": "理解了 Rhie-Chow 插值法抑制压力振荡的基本功能后，一个自然的问题是：它在不同流动条件下的表现如何？本实践将探讨该方法在不同对流强度下的稳健性，这是评估任何数值格式实用价值的关键一步。我们将引入无量纲的佩克莱数（Peclet number, $Pe$）来区分以扩散为主和以对流为主的流动状态，并通过一个一维平流-扩散问题，系统地评估 Rhie-Chow 插值相对于简单线性插值的重构误差，从而揭示其在强对流环境下的性能特点。", "problem": "考虑一个长度为 $L$ 的一维均匀周期性网格，该网格被离散为 $N$ 个控制体，其单元中心位于位置 $x_i = \\left(i + \\tfrac{1}{2}\\right)\\Delta x$（其中 $i \\in \\{0,1,\\dots,N-1\\}$），且 $\\Delta x = L/N$。设单元 $i$ 和 $i+1$ 之间（索引以 $N$ 为模进行周期性环绕）的界面位于 $x_{i+\\tfrac{1}{2}} = (i+1)\\Delta x$。工作在完全无量纲的环境下：所有物理量均为无量纲，且密度归一化为1。设人造场由光滑周期函数 $u(x) = U_0 + U_1 \\sin\\left(2\\pi x/L\\right)$ 和 $p(x) = P_0 + P_1 \\cos\\left(2\\pi x/L\\right)$ 给出，其中 $U_0$、$U_1$、$P_0$ 和 $P_1$ 是常数。定义参考速度 $U_{\\mathrm{ref}} = \\max_{x \\in [0,L]} |u(x)|$。对于一个目标网格佩克莱特数 (Peclet number) $Pe$，设定运动粘度 $\\nu$ 以满足 $Pe = U_{\\mathrm{ref}} \\Delta x / \\nu$，即 $\\nu = U_{\\mathrm{ref}} \\Delta x / Pe$。\n\n从稳态一维对流-扩散算子出发，对流项采用一阶迎风离散，扩散项采用中心差分，单元 $i$ 处的标准有限体积法相邻系数是使用精确的界面质量通量构建的。对于单元 $i$ 的东、西界面，定义 $F_e = u(x_{i+\\tfrac{1}{2}})$，$F_w = u(x_{i-\\tfrac{1}{2}})$，以及 $D = \\nu/\\Delta x$。然后定义\n- $a_E = D + \\max(-F_e, 0)$，\n- $a_W = D + \\max(F_w, 0)$，\n- $a_P = a_E + a_W + (F_e - F_w)$，\n以及辅助系数 $d_i = 1/a_P$。在界面 $i+\\tfrac{1}{2}$ 处，将 $d_{i+\\tfrac{1}{2}}$ 定义为算术平均值 $d_{i+\\tfrac{1}{2}} = \\tfrac{1}{2}(d_i + d_{i+1})$。\n\n定义在 $x_{i+\\tfrac{1}{2}}$ 处界面速度 $u$ 的以下重构方法：\n- 线性插值：$u^{\\mathrm{lin}}_{i+\\tfrac{1}{2}} = \\tfrac{1}{2}\\left(u(x_i) + u(x_{i+1})\\right)$。\n- Rhie–Chow 动量插值 (RCMI)：$u^{\\mathrm{RC}}_{i+\\tfrac{1}{2}} = u^{\\mathrm{lin}}_{i+\\tfrac{1}{2}} - d_{i+\\tfrac{1}{2}}\\left(p(x_{i+1}) - p(x_i)\\right)$。\n\n对于每个界面，设 $u^{\\mathrm{exact}}_{i+\\tfrac{1}{2}} = u(x_{i+\\tfrac{1}{2}})$。对于给定的 $Pe$，使用所有界面上的均方根相对误差来量化每种方法的重构误差：\n$$\n\\varepsilon_{\\mathrm{lin}}(Pe) = \\sqrt{\\frac{1}{N}\\sum_{i=0}^{N-1}\\left(\\frac{u^{\\mathrm{lin}}_{i+\\tfrac{1}{2}} - u^{\\mathrm{exact}}_{i+\\tfrac{1}{2}}}{U_{\\mathrm{ref}}}\\right)^2}, \\quad\n\\varepsilon_{\\mathrm{RC}}(Pe) = \\sqrt{\\frac{1}{N}\\sum_{i=0}^{N-1}\\left(\\frac{u^{\\mathrm{RC}}_{i+\\tfrac{1}{2}} - u^{\\mathrm{exact}}_{i+\\tfrac{1}{2}}}{U_{\\mathrm{ref}}}\\right)^2}.\n$$\n\n您的任务是实现一个程序，针对指定的人造场和离散化方法，通过计算佩克莱特数变化时的上述误差，来评估 Rhie–Chow 动量插值的鲁棒性，从而探索强对流区域。\n\n对所有测试用例使用以下固定参数：\n- 域长度 $L = 1$，\n- 控制体数量 $N = 128$，\n- 人造场振幅 $U_0 = 1$，$U_1 = 0.2$，$P_0 = 0$，$P_1 = 0.1$。\n\n测试组：\n- 佩克莱特数 (Peclet numbers) $Pe \\in \\{0.1, 1, 10, 100, 1000\\}$。\n\n对于测试组中的每个 $Pe$，计算如上定义的误差对 $\\varepsilon_{\\mathrm{RC}}(Pe)$ 和 $\\varepsilon_{\\mathrm{lin}}(Pe)$。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，条目按 $[\\varepsilon_{\\mathrm{RC}}(0.1), \\varepsilon_{\\mathrm{lin}}(0.1), \\varepsilon_{\\mathrm{RC}}(1), \\varepsilon_{\\mathrm{lin}}(1), \\varepsilon_{\\mathrm{RC}}(10), \\varepsilon_{\\mathrm{lin}}(10), \\varepsilon_{\\mathrm{RC}}(100), \\varepsilon_{\\mathrm{lin}}(100), \\varepsilon_{\\mathrm{RC}}(1000), \\varepsilon_{\\mathrm{lin}}(1000)]$ 的顺序排列。所有误差根据构造都是无量纲的，并且必须以浮点数形式返回。", "solution": "该问题要求对 Rhie–Chow 动量插值 (RCMI) 格式进行定量评估，方法是将其重构误差与简单线性插值的误差进行比较。此评估在人造解方法的框架内进行，该方法为底层的连续场提供了精确的解析形式，从而可以进行精确的误差分析。评估在一系列网格佩克莱特数上进行，以评估其在扩散主导和对流主导区域的性能。\n\n首先，我们定义计算域及相关参数。长度为 $L=1$ 的一维周期性域被离散为 $N=128$ 个控制体。因此，网格间距为 $\\Delta x = L/N = 1/128$。单元中心位于位置 $x_i = (i + \\frac{1}{2})\\Delta x$，单元界面位于 $x_{i+\\frac{1}{2}} = (i+1)\\Delta x$，其中 $i \\in \\{0, 1, \\dots, N-1\\}$。所有计算均使用无量纲量。\n\n速度 $u(x)$ 和压力 $p(x)$ 的人造解以具有指定振幅的光滑周期函数形式给出：\n$$u(x) = U_0 + U_1 \\sin\\left(\\frac{2\\pi x}{L}\\right) \\quad \\text{其中 } U_0 = 1, U_1 = 0.2$$\n$$p(x) = P_0 + P_1 \\cos\\left(\\frac{2\\pi x}{L}\\right) \\quad \\text{其中 } P_0 = 0, P_1 = 0.1$$\n用于归一化误差的参考速度 $U_{\\mathrm{ref}}$ 是整个域上的最大绝对速度。鉴于 $U_0 > 0$ 和 $U_1 > 0$，其值为：\n$$U_{\\mathrm{ref}} = \\max_{x \\in [0,L]} |u(x)| = |U_0| + |U_1| = 1 + 0.2 = 1.2$$\n运动粘度 $\\nu$ 通过关系式 $\\nu = U_{\\mathrm{ref}} \\Delta x / Pe$ 与网格佩克莱特数 $Pe$ 相关联。这使我们能够系统地研究改变对流与扩散之比的影响。\n\nRCMI 公式依赖于离散化动量方程中的系数。我们使用标准的有限体积离散化方法，对流项采用一阶迎风格式，扩散项采用中心差分格式。对于每个单元 $i$，关键系数的构建如下：\n1.  **界面通量**：使用单元 $i$ 的东、西界面上的精确人造速度定义：$F_e = u(x_{i+\\frac{1}{2}})$ 和 $F_w = u(x_{i-\\frac{1}{2}})$。由于周期性，单元 $0$ 的西界面即为单元 $N-1$ 的东界面。\n2.  **扩散传导系数**：$D = \\nu/\\Delta x$。代入 $\\nu$ 的表达式，我们得到 $D = (U_{\\mathrm{ref}} \\Delta x / Pe) / \\Delta x = U_{\\mathrm{ref}} / Pe$。\n3.  **离散化系数**：\n    - 东邻系数：$a_E = D + \\max(-F_e, 0)$\n    - 西邻系数：$a_W = D + \\max(F_w, 0)$\n    - 中心系数：$a_P = a_E + a_W + (F_e - F_w)$\n4.  **辅助系数**：RCMI 压力修正项所需的系数为 $d_i = 1/a_P$。\n\nRCMI 格式需要在单元界面上使用此系数，该系数通过对相邻单元中心值的算术平均获得：\n$$d_{i+\\frac{1}{2}} = \\frac{1}{2}(d_i + d_{i+1})$$\n为处理最后一个界面的周期性边界，索引 $i+1$ 以 $N$ 为模进行计算。\n\n有了这些组件，我们可以在每个界面 $i+\\frac{1}{2}$ 处定义两种速度重构格式：\n- **线性插值**：两个相邻单元 $i$ 和 $i+1$ 中心速度的简单平均值。\n    $$u^{\\mathrm{lin}}_{i+\\frac{1}{2}} = \\frac{1}{2}\\left(u(x_i) + u(x_{i+1})\\right)$$\n- **Rhie–Chow 动量插值**：该格式使用一个与单元间压力差成比例的项来修正线性插值，从而抑制数值振荡。\n    $$u^{\\mathrm{RC}}_{i+\\frac{1}{2}} = u^{\\mathrm{lin}}_{i+\\frac{1}{2}} - d_{i+\\frac{1}{2}}\\left(p(x_{i+1}) - p(x_i)\\right)$$\n\n为量化每种格式的误差，我们将重构速度与精确速度 $u^{\\mathrm{exact}}_{i+\\frac{1}{2}} = u(x_{i+\\frac{1}{2}})$进行比较。误差使用相对差异的均方根 (RMS) 来衡量，该值在域中所有 $N$ 个界面上计算：\n$$\\varepsilon_{\\mathrm{lin}}(Pe) = \\sqrt{\\frac{1}{N}\\sum_{i=0}^{N-1}\\left(\\frac{u^{\\mathrm{lin}}_{i+\\tfrac{1}{2}} - u^{\\mathrm{exact}}_{i+\\tfrac{1}{2}}}{U_{\\mathrm{ref}}}\\right)^2}$$\n$$\\varepsilon_{\\mathrm{RC}}(Pe) = \\sqrt{\\frac{1}{N}\\sum_{i=0}^{N-1}\\left(\\frac{u^{\\mathrm{RC}}_{i+\\tfrac{1}{2}} - u^{\\mathrm{exact}}_{i+\\tfrac{1}{2}}}{U_{\\mathrm{ref}}}\\right)^2}$$\n\n整个过程是为测试组 $\\{0.1, 1, 10, 100, 1000\\}$ 中的每个 $Pe$ 执行以下步骤：\n1.  计算 $\\Delta x$ 和 $U_{\\mathrm{ref}}$ 的数值。\n2.  定义代表网格点 $x_i$ 和 $x_{i+\\frac{1}{2}}$ 的数组。\n3.  在所有单元中心和界面上评估人造场 $u(x)$ 和 $p(x)$，以获得必要的离散值。\n4.  对于给定的 $Pe$，计算 $D$。\n5.  组装系数数组 $a_E$、$a_W$、$a_P$，然后是 $d_i$。\n6.  计算界面中心系数 $d_{i+\\frac{1}{2}}$。\n7.  计算界面速度场 $u^{\\mathrm{lin}}_{i+\\frac{1}{2}}$ 和 $u^{\\mathrm{RC}}_{i+\\frac{1}{2}}$。\n8.  计算并存储 RMS 误差 $\\varepsilon_{\\mathrm{lin}}(Pe)$ 和 $\\varepsilon_{\\mathrm{RC}}(Pe)$。\n9.  最后，将收集到的误差对格式化为单个输出列表。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef calculate_errors_for_pe(Pe, L, N, U0, U1, P0, P1):\n    \"\"\"\n    Computes the reconstruction errors for a single Peclet number.\n    \"\"\"\n    # 1. Define grid parameters and reference velocity.\n    dx = L / N\n    # For U0 > 0 and U1 > 0, max|u(x)| = U0 + U1.\n    U_ref = U0 + U1\n\n    # 2. Define grid locations for cell centers and faces.\n    i = np.arange(N)\n    x_i = (i + 0.5) * dx      # Cell centers\n    x_face = (i + 1.0) * dx   # Cell east faces\n\n    # 3. Evaluate the manufactured fields at the required locations.\n    u_cell = U0 + U1 * np.sin(2 * np.pi * x_i / L)\n    p_cell = P0 + P1 * np.cos(2 * np.pi * x_i / L)\n    u_exact_face = U0 + U1 * np.sin(2 * np.pi * x_face / L)\n\n    # 4. Compute coefficients for the Rhie-Chow interpolation.\n    # The diffusion conductance term D.\n    D = U_ref / Pe\n\n    # Face mass fluxes F_e and F_w are the exact velocities at the faces.\n    F_e = u_exact_face\n    # F_w for cell i is F_e for cell i-1. np.roll handles periodicity.\n    F_w = np.roll(u_exact_face, 1)\n\n    # Discretization coefficients for first-order upwind + central diffusion.\n    a_E = D + np.maximum(-F_e, 0)\n    a_W = D + np.maximum(F_w, 0)\n    a_P = a_E + a_W + (F_e - F_w)\n    \n    # Auxiliary coefficient d_i = 1/a_P.\n    d_i = 1.0 / a_P\n\n    # 5. Reconstruct face velocities using both schemes.\n    # Cell i+1 values are obtained by a left shift of cell i values.\n    u_cell_i_plus_1 = np.roll(u_cell, -1)\n    p_cell_i_plus_1 = np.roll(p_cell, -1)\n    d_i_plus_1 = np.roll(d_i, -1)\n\n    # Linear interpolation for face velocity.\n    u_lin_face = 0.5 * (u_cell + u_cell_i_plus_1)\n\n    # Rhie-Chow momentum interpolation.\n    # First, get face-centered d.\n    d_face = 0.5 * (d_i + d_i_plus_1)\n    # RCMI formula.\n    pressure_correction = d_face * (p_cell_i_plus_1 - p_cell)\n    u_rc_face = u_lin_face - pressure_correction\n\n    # 6. Calculate the root-mean-square relative errors.\n    err_lin_sq_normalized = ((u_lin_face - u_exact_face) / U_ref)**2\n    epsilon_lin = np.sqrt(np.mean(err_lin_sq_normalized))\n\n    err_rc_sq_normalized = ((u_rc_face - u_exact_face) / U_ref)**2\n    epsilon_rc = np.sqrt(np.mean(err_rc_sq_normalized))\n\n    return epsilon_rc, epsilon_lin\n\ndef solve():\n    \"\"\"\n    Main function to drive the computation for all test cases.\n    \"\"\"\n    # Define the fixed parameters from the problem statement.\n    L = 1.0\n    N = 128\n    U0 = 1.0\n    U1 = 0.2\n    P0 = 0.0\n    P1 = 0.1\n\n    # Define the test suite for Peclet numbers.\n    test_cases = [0.1, 1, 10, 100, 1000]\n\n    results = []\n    for pe in test_cases:\n        # Calculate errors for the current Pe.\n        err_rc, err_lin = calculate_errors_for_pe(pe, L, N, U0, U1, P0, P1)\n        # Append results in the required order.\n        results.append(err_rc)\n        results.append(err_lin)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3358670"}, {"introduction": "本节将探讨一个更高级但至关重要的概念：压力稳健性（pressure-robustness）。在处理由梯度力（如浮力）主导的流动时，非稳健的数值格式会因压力场的巨大变化而产生严重的伪速度，从而污染计算结果。这个实践通过一个二维斯托克斯流（Stokes flow）问题，展示了 Rhie-Chow 思想的精髓——即保持离散算子之间的一致性——是如何实现压力稳健性的。通过对比“一致”与“朴素”的离散化方案，本练习将揭示严谨的数值格式设计对于获得物理上可靠解的重要性。", "problem": "要求您设计、分析并实现一个二维稳态不可压缩斯托克斯方程的周期性同位网格有限体积离散化方法，该方法在面法向质量通量层面引入 Rhie–Chow 动量插值概念。目标是在梯度主导的强迫项下评估其压力鲁棒性，通过验证离散速度误差如何随粘性系数变化，以及是否独立于强迫项的幅值。推导必须从基本守恒定律和均匀周期性网格上的标准离散算子定义出发；您的推导不应假定任何已有的 Rhie–Chow 公式。\n\n连续问题是在单位周期性方形域上、平均压力为零的稳态不可压缩斯托克斯系统，由下式给出\n$$\n-\\nabla p + \\mu \\Delta \\mathbf{u} + \\mathbf{f} = \\mathbf{0}, \\qquad \\nabla \\cdot \\mathbf{u} = 0,\n$$\n其中粘性系数 $\\mu>0$，强迫项 $\\mathbf{f} = \\nabla \\phi$，$\\phi$ 是一个光滑标量势。基于任何纯梯度强迫项都可以被吸收到压力项中的基本事实，对于周期性边界条件，精确速度解为 $\\mathbf{u} \\equiv \\mathbf{0}$，无论 $\\phi$ 的幅值如何。在离散层面，压力鲁棒性要求离散螺线管投影算子能够湮灭离散梯度，从而使计算出的速度不会伪相关于 $\\|\\phi\\|$。\n\n考虑一个大小为 $1 \\times 1$ 的周期性域上的均匀同位网格，该网格具有 $N_x \\times N_y$ 个单元中心的标量未知数。令 $\\Delta x = 1/N_x$ 和 $\\Delta y = 1/N_y$。定义以下标准离散算子：\n- 一个从单元中心到面中心的离散梯度算子 $G$，它在 $x$ 和 $y$ 方向上独立作用，在以索引 $(i+\\tfrac{1}{2}, j)$ 为中心的 $x$ 面上，\n$$\n(G_x p)_{i+\\frac{1}{2},j} = \\frac{p_{i+1,j} - p_{i,j}}{\\Delta x},\n$$\n采用周期性环绕处理，类似地，对于 $y$ 面，通过 $(G_y p)_{i, j+\\frac{1}{2}} = \\frac{p_{i,j+1} - p_{i,j}}{\\Delta y}$ 得到。\n\n- 一个从面中心到单元中心的离散散度算子 $D$，使得在 $(i,j)$ 处的单元中心散度为\n$$\n(D \\mathbf{u})_{i,j} = \\frac{u_{x,i+\\frac{1}{2},j} - u_{x,i-\\frac{1}{2},j}}{\\Delta x} + \\frac{u_{y,i, j+\\frac{1}{2}} - u_{y,i, j-\\frac{1}{2}}}{\\Delta y}.\n$$\n\n- 一个作用于单元中心 $\\phi$ 的单元中心中心差分梯度算子 $\\mathcal{G}$，通过\n$$\n(\\mathcal{G}_x \\phi)_{i,j} = \\frac{\\phi_{i+1,j} - \\phi_{i-1,j}}{2\\Delta x}, \\qquad (\\mathcal{G}_y \\phi)_{i,j} = \\frac{\\phi_{i,j+1} - \\phi_{i,j-1}}{2\\Delta y}.\n$$\n\n- 一个从单元中心到面中心的平均算子 $\\mathcal{A}$，它通过对相邻单元进行算术平均，将单元中心矢量场映射到面上。\n\n受 Rhie–Chow 动量插值的启发，定义将进入连续性方程的面法向预测通量，其形式为一个面上投影的体积力贡献和一个压力梯度迁移率项之和。对于均匀网格上的纯扩散线性化，取面上的动量迁移率为常数 $1/\\mu$。那么，面法向速度被建模为\n$$\n\\mathbf{u}_f = \\frac{1}{\\mu}\\,\\mathbf{f}_{\\mathrm{pred},f} - \\frac{1}{\\mu}\\,G p,\n$$\n其中 $\\mathbf{f}_{\\mathrm{pred},f}$ 是梯度强迫项在面中心的近似。离散连续性方程 $D \\mathbf{u}_f = 0$ 产生了压力方程\n$$\nD G p = D \\,\\mathbf{f}_{\\mathrm{pred},f}.\n$$\n需要实现并对比 $\\mathbf{f}_{\\mathrm{pred},f}$ 的两种选择：\n\n- 一致的、保持梯度的选择：$\\mathbf{f}_{\\mathrm{pred},f} = G \\phi$，即，使用与压力 $p$ 相同的面梯度算子来计算面上的 $\\mathbf{f}$。\n\n- 一种朴素的、不保持梯度的选择：通过中心差分 $\\mathcal{G}\\phi$ 在单元中心计算 $\\mathbf{f}$，然后通过 $\\mathcal{A}$ 平均到面上，得到 $\\mathbf{f}_{\\mathrm{pred},f} = \\mathcal{A}(\\mathcal{G}\\phi)$。\n\n对于每种选择，在周期性零平均值约束下（即将 $p$ 的空间平均值设为零），求解 $D G p = D \\,\\mathbf{f}_{\\mathrm{pred},f}$ 以获得单元中心的 $p$，然后计算得到的面速度\n$$\n\\mathbf{u}_f = \\frac{1}{\\mu}\\,\\left(\\mathbf{f}_{\\mathrm{pred},f} - G p\\right).\n$$\n将速度误差定义为面上离散均方根，\n$$\ne = \\left( \\frac{1}{N_x N_y} \\sum_{i,j} \\left(u_{x,i+\\frac{1}{2},j}^2 + u_{y,i, j+\\frac{1}{2}}^2 \\right) \\right)^{1/2}.\n$$\n\n使用一个构造的标量势\n$$\n\\phi(x,y) = A \\sin(2\\pi k_x x)\\cos(2\\pi k_y y),\n$$\n其中幅值 $A>0$，波数 $k_x, k_y \\in \\mathbb{Z}$ 为整数。注意，对于所有的 $A$ 和 $\\mu$，精确的连续速度解都是 $\\mathbf{u} \\equiv \\mathbf{0}$。\n\n您的任务：\n- 从基本定律（动量平衡和质量守恒）和上述离散算子定义出发，为 $\\mathbf{f}_{\\mathrm{pred},f}$ 的两种选择推导压力方程和最终的面速度公式，不假设任何已知的 Rhie–Chow 公式。\n- 使用离散傅里叶变换实现离散泊松算子 $D G$ 的周期性快速求解器，并强制零空间平均压力。\n- 对一致和朴素两种选择，在一个小型测试套件上计算误差 $e$，并按下述要求汇总结果。\n\n测试套件规格：\n- 使用 $N_x = 64, N_y = 64$，周期性域大小为 $1\\times 1$。\n- 使用波数 $(k_x,k_y) = (3,2)$。\n- 粘性系数：$\\mu \\in \\{0.1, 0.05\\}$。\n- 幅值：$A \\in \\{1.0, 10.0\\}$。\n\n计算并报告以下五个量：\n1. 一致选择下，$A=10.0$ 和 $\\mu=0.1$ 时的误差 $e$。\n2. 一致选择下，$A=1000.0$ 和 $\\mu=0.1$ 时的误差 $e$。\n3. 朴素选择下，$A=1.0$ 和 $\\mu=0.1$ 时的缩放误差 $e/A$。\n4. 朴素选择下，$A=10.0$ 和 $\\mu=0.1$ 时的缩放误差 $e/A$。\n5. 朴素选择下，在固定幅值 $A=10.0$ 时的粘性缩放比 $r$，定义为\n$$\nr = \\frac{(e/A)\\ \\text{at}\\ \\mu=0.1}{(e/A)\\ \\text{at}\\ \\mu=0.05}.\n$$\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，按上述顺序列出结果，例如 `\"[result1,result2,result3,result4,result5]\"`。\n- 所有值必须是标准浮点数。此无量纲化公式无需报告物理单位，也不涉及角度。请确保您的实现是自包含的，不使用任何外部输入。", "solution": "该问题要求设计和分析一种用于稳态不可压缩斯托克斯方程的周期性同位网格有限体积方法，重点关注受 Rhie–Chow 动量插值概念启发的两种不同实现的压力鲁棒性。\n\n### 问题验证\n\n**第1步：提取给定信息**\n\n- **连续方程**：单位周期性方形域上的稳态不可压缩斯托克斯方程：\n  $$-\\nabla p + \\mu \\Delta \\mathbf{u} + \\mathbf{f} = \\mathbf{0}, \\qquad \\nabla \\cdot \\mathbf{u} = 0$$\n- **强迫项**：一个纯梯度场，$\\mathbf{f} = \\nabla \\phi$。\n- **势场**：$\\phi(x,y) = A \\sin(2\\pi k_x x)\\cos(2\\pi k_y y)$。\n- **精确解**：$\\mathbf{u} \\equiv \\mathbf{0}$，且对 $p$ 施加零平均压力条件。\n- **网格**：$1 \\times 1$ 域上的均匀同位网格，包含 $N_x \\times N_y$ 个单元。单元尺寸为 $\\Delta x = 1/N_x$，$\\Delta y = 1/N_y$。\n- **离散算子**：\n  - 从单元到面的梯度算子 $G$：$(G_x p)_{i+\\frac{1}{2},j} = (p_{i+1,j} - p_{i,j})/\\Delta x$。\n  - 从面到单元的散度算子 $D$：$(D \\mathbf{u})_{i,j} = (u_{x,i+\\frac{1}{2},j} - u_{x,i-\\frac{1}{2},j})/\\Delta x + (u_{y,i, j+\\frac{1}{2}} - u_{y,i, j-\\frac{1}{2}})/\\Delta y$。\n  - 单元中心梯度算子 $\\mathcal{G}$：$(\\mathcal{G}_x \\phi)_{i,j} = (\\phi_{i+1,j} - \\phi_{i-1,j})/(2\\Delta x)$。\n  - 从单元到面的平均算子 $\\mathcal{A}$。\n- **面速度模型**：$\\mathbf{u}_f = \\frac{1}{\\mu}\\,\\mathbf{f}_{\\mathrm{pred},f} - \\frac{1}{\\mu}\\,G p$。\n- **面强迫项 $\\mathbf{f}_{\\mathrm{pred},f}$ 的选择**：\n  1.  **一致性选择**：$\\mathbf{f}_{\\mathrm{pred},f} = G \\phi$。\n  2.  **朴素选择**：$\\mathbf{f}_{\\mathrm{pred},f} = \\mathcal{A}(\\mathcal{G}\\phi)$。\n- **离散压力方程**：由 $D \\mathbf{u}_f = 0$ 推导得出，$D G p = D \\,\\mathbf{f}_{\\mathrm{pred},f}$。\n- **速度误差度量**：$e = \\left( \\frac{1}{N_x N_y} \\sum_{i,j} \\left(u_{x,i+\\frac{1}{2},j}^2 + u_{y,i, j+\\frac{1}{2}}^2 \\right) \\right)^{1/2}$。\n- **求解器规格**：使用快速傅里叶变换 (FFT) 求解周期性泊松问题 $DG p = S$。\n- **测试参数**：$N_x=64, N_y=64$，$(k_x, k_y)=(3,2)$，$\\mu \\in \\{0.1, 0.05\\}$，$A \\in \\{1.0, 10.0\\}$。\n- **要求输出**：与误差 $e$ 相关的五个特定数值结果。\n\n**第2步：使用提取的信息进行验证**\n\n该问题具有科学依据、适定且客观。它概述了计算流体动力学中的一个标准数值实验，用以研究压力鲁棒性。所给出的方程、算子定义和数值方法均为标准且明确。使用带有纯梯度强迫项的构造解是为此目的的典型测试。离散压力方程是周期域上的泊松方程；由于周期性网格上离散散度算子 $D$ 的结构，其相容性条件（右端项平均值为零）是满足的，而规定零平均压力则确保了解的唯一性。该问题是自包含的，为其求解提供了所有必要信息。不存在科学、逻辑或事实上的缺陷。\n\n**第3步：结论与行动**\n\n问题有效。将提供完整的解决方案。\n\n### 推导与算法设计\n\n该方法的核心在于在离散层面上耦合动量和质量守恒定律。问题为面法向速度 $\\mathbf{u}_f$ 提供了一个简化的线性化模型，其灵感来自于对动量方程的求逆：\n$$\n\\mathbf{u}_f = \\frac{1}{\\mu} \\left( \\mathbf{f}_{\\mathrm{pred},f} - G p \\right)\n$$\n在这里，$\\mathbf{u}_f$ 代表垂直于单元面的速度矢量，$\\mathbf{f}_{\\mathrm{pred},f}$ 是体积力 $\\mathbf{f}$ 的面心近似，$G p$ 是面上的离散压力梯度，标量 $1/\\mu$ 是从粘性项 $\\mu \\Delta \\mathbf{u}$ 推导出的恒定迁移率因子。\n\n稳态不可压缩流体的离散质量守恒方程为 $\\nabla \\cdot \\mathbf{u} = 0$，在单元中心离散为 $D \\mathbf{u}_f = 0$。将 $\\mathbf{u}_f$ 的模型代入此连续性方程，得到：\n$$\nD \\left( \\frac{1}{\\mu} \\left( \\mathbf{f}_{\\mathrm{pred},f} - G p \\right) \\right) = 0\n$$\n由于粘性系数 $\\mu$ 是一个非零常数，可以将其提出并消去。根据散度算子 $D$ 的线性性质，我们得到：\n$$\nD(\\mathbf{f}_{\\mathrm{pred},f}) - D(G p) = 0\n$$\n整理后可得到离散的压力泊松方程 (PPE)：\n$$\nD G p = D (\\mathbf{f}_{\\mathrm{pred},f})\n$$\n算子 $L = DG$ 构成一个离散拉普拉斯算子。在零平均值约束下求解该方程得到压力场 $p$ 后，将 $p$ 代入其定义表达式即可恢复最终的面速度：\n$$\n\\mathbf{u}_f = \\frac{1}{\\mu} \\left( \\mathbf{f}_{\\mathrm{pred},f} - G p \\right)\n$$\n我们现在分析两种给定的强迫项近似选择 $\\mathbf{f}_{\\mathrm{pred},f} = (G\\phi)_{\\mathrm{pred}, f}$。\n\n**情况1：一致性强迫项，$\\mathbf{f}_{\\mathrm{pred},f} = G \\phi$**\n这种选择对压力 $p$ 和势 $\\phi$ 使用了相同的离散梯度算子 $G$。PPE 变为：\n$$\nD G p = D (G \\phi) \\implies DG(p-\\phi) = 0\n$$\n在周期域上，齐次离散泊松方程 $Lq = 0$ 的解是任意常数场 $q=C$。因此，$p - \\phi = C$，这意味着 $p = \\phi + C$。为了满足零平均压力约束 $\\langle p \\rangle = 0$，我们需要 $\\langle \\phi + C \\rangle = \\langle \\phi \\rangle + C = 0$，从而确定常数 $C = -\\langle \\phi \\rangle$。因此，唯一的压力解是 $p = \\phi - \\langle \\phi \\rangle$。\n将此压力代回速度公式，得到：\n$$\n\\mathbf{u}_f = \\frac{1}{\\mu} \\left( G \\phi - G(\\phi - \\langle \\phi \\rangle) \\right) = \\frac{1}{\\mu} \\left( G \\phi - G \\phi + G(\\langle \\phi \\rangle) \\right)\n$$\n由于 $\\langle \\phi \\rangle$ 是一个常数，而梯度算子 $G$ 会湮灭常数场，因此 $G(\\langle \\phi \\rangle) = \\mathbf{0}$。这导致：\n$$\n\\mathbf{u}_f = \\mathbf{0}\n$$\n最终得到的速度恒为零（在机器精度范围内），与幅值 $A$ 或粘性系数 $\\mu$ 无关。这表明该格式是压力鲁棒的；离散螺线管投影算子完美地湮灭了离散梯度强迫项，正确地再现了解析解 $\\mathbf{u} \\equiv \\mathbf{0}$。速度误差 $e$ 预计将接近于零。\n\n**情况2：朴素强迫项，$\\mathbf{f}_{\\mathrm{pred},f} = \\mathcal{A}(\\mathcal{G}\\phi)$**\n这种选择首先计算单元中心的梯度 $\\mathcal{G}\\phi$，然后使用 $\\mathcal{A}$ 将其平均到面上。离散算子 $\\mathcal{A}$ 和 $\\mathcal{G}$ 的定义使得通常情况下 $\\mathcal{A}(\\mathcal{G}\\phi) \\neq G\\phi$。这种差异，一种“对易子误差”的形式，破坏了在情况1中观察到的结构一致性。现在的 PPE 是：\n$$\nD G p = D \\left( \\mathcal{A}(\\mathcal{G}\\phi) \\right)\n$$\n解 $p$ 将不再是 $\\phi$ 的简单平移。计算出的速度为：\n$$\n\\mathbf{u}_f = \\frac{1}{\\mu} \\left( \\mathcal{A}(\\mathcal{G}\\phi) - G p \\right) = \\frac{1}{\\mu} \\left( \\mathcal{A}(\\mathcal{G}\\phi) - G \\left( (DG)^{-1} D(\\mathcal{A}(\\mathcal{G}\\phi)) \\right) \\right)\n$$\n项 $P_G = G(DG)^{-1}D$ 是一个投影到离散梯度空间（无旋场空间）的投影算子。速度正比于 $(\\mathbf{I} - P_G)(\\mathcal{A}(\\mathcal{G}\\phi))$，这是将 $\\mathcal{A}(\\mathcal{G}\\phi)$ 投影到离散无散场空间的结果。因为在算子 $G$ 的意义下，$\\mathcal{A}(\\mathcal{G}\\phi)$ 不是一个离散梯度，所以这个投影非零，从而导致了伪速度。\n这个伪速度的大小与势 $\\phi$ 的幅值 $A$ 成线性关系，与粘性系数 $\\mu$ 成反比关系。因此，误差 $e$ 预计表现为 $e \\propto A/\\mu$。这意味着缩放误差 $e/A$ 应独立于 $A$，并且在两个不同粘性系数 $\\mu_1$ 和 $\\mu_2$ 下的缩放误差之比应为 $(\\text{e}/A)_1 / (\\text{e}/A)_2 \\approx \\mu_2/\\mu_1$。\n\n**实现：基于 FFT 的泊松求解器**\n周期性 PPE $DGp=S$ 可以使用快速傅里叶变换高效求解。对该方程应用二维离散傅里叶变换（$\\mathcal{F}$）可得：\n$$\n\\mathcal{F}(DGp) = \\mathcal{F}(S) \\implies \\widehat{DG}(\\mathbf{m}) \\hat{p}(\\mathbf{m}) = \\hat{S}(\\mathbf{m})\n$$\n其中 $\\hat{p}$ 和 $\\hat{S}$ 是变换后的场，而 $\\widehat{DG}(\\mathbf{m})$ 是离散拉普拉斯算子的符号（或传递函数），$\\mathbf{m}=(m_x, m_y)$ 是离散频率指数。在间距为 $\\Delta x, \\Delta y$ 的网格上，指定算子的符号为：\n$$\n\\widehat{DG}(m_x, m_y) = -\\frac{4}{\\Delta x^2} \\sin^2\\left(\\frac{\\pi m_x}{N_x}\\right) - \\frac{4}{\\Delta y^2} \\sin^2\\left(\\frac{\\pi m_y}{N_y}\\right)\n$$\n压力的傅里叶系数通过逐点相除找到：\n$$\n\\hat{p}(\\mathbf{m}) = \\frac{\\hat{S}(\\mathbf{m})}{\\widehat{DG}(\\mathbf{m})} \\quad \\text{for } \\mathbf{m} \\neq \\mathbf{0}\n$$\n符号 $\\widehat{DG}(\\mathbf{0}) = 0$ 对应于算子的零空间。通过设置零频分量 $\\hat{p}(\\mathbf{0})_ = 0$ 来强制执行零平均压力约束 $\\langle p \\rangle=0$。然后通过应用逆傅里叶变换恢复压力场 $p$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the simulation and compute the required results.\n    \"\"\"\n\n    def compute_error(A, mu, choice, kx, ky, Nx, Ny):\n        \"\"\"\n        Computes the velocity error for a given set of parameters.\n\n        Args:\n            A (float): Amplitude of the potential phi.\n            mu (float): Viscosity.\n            choice (str): 'consistent' or 'naive' for the forcing term.\n            kx, ky (int): Wave numbers for the potential.\n            Nx, Ny (int): Grid dimensions.\n\n        Returns:\n            float: The computed velocity error 'e'.\n        \"\"\"\n        dx = 1.0 / Nx\n        dy = 1.0 / Ny\n\n        # Create cell-centered grid coordinates (origin at corner)\n        x_cc = (np.arange(Nx) + 0.5) * dx\n        y_cc = (np.arange(Ny) + 0.5) * dy\n        XX_cc, YY_cc = np.meshgrid(x_cc, y_cc, indexing='ij')\n\n        # Define the scalar potential phi at cell centers\n        phi_cc = A * np.sin(2 * np.pi * kx * XX_cc) * np.cos(2 * np.pi * ky * YY_cc)\n\n        # --- Define discrete operators using np.roll for periodic boundaries ---\n        \n        # G: cell-center to face-center gradient\n        def G(p_cc):\n            gxp_f = (np.roll(p_cc, -1, axis=0) - p_cc) / dx\n            gyp_f = (np.roll(p_cc, -1, axis=1) - p_cc) / dy\n            return gxp_f, gyp_f\n\n        # D: face-center to cell-center divergence\n        def D(u_f):\n            ux_f, uy_f = u_f\n            div_x = (ux_f - np.roll(ux_f, 1, axis=0)) / dx\n            div_y = (uy_f - np.roll(uy_f, 1, axis=1)) / dy\n            return div_x + div_y\n\n        # G_central: cell-center central-difference gradient\n        def G_central(p_cc):\n            gx_cc = (np.roll(p_cc, -1, axis=0) - np.roll(p_cc, 1, axis=0)) / (2 * dx)\n            gy_cc = (np.roll(p_cc, -1, axis=1) - np.roll(p_cc, 1, axis=1)) / (2 * dy)\n            return gx_cc, gy_cc\n\n        # A: cell-center to face-center averaging\n        def A_op(f_cc):\n            fx_cc, fy_cc = f_cc\n            fx_f = (fx_cc + np.roll(fx_cc, -1, axis=0)) / 2.0\n            fy_f = (fy_cc + np.roll(fy_cc, -1, axis=1)) / 2.0\n            return fx_f, fy_f\n\n        # --- Compute forcing term and solve for pressure ---\n\n        if choice == 'consistent':\n            f_pred_f = G(phi_cc)\n            p_cc = phi_cc - np.mean(phi_cc)\n        elif choice == 'naive':\n            f_cc = G_central(phi_cc)\n            f_pred_f = A_op(f_cc)\n            \n            # Solve Poisson equation DG*p = D*f_pred_f using FFT\n            S = D(f_pred_f)\n            S_hat = np.fft.fft2(S)\n            \n            # Wavenumbers for FFT\n            mx = np.fft.fftfreq(Nx, d=dx) * Nx\n            my = np.fft.fftfreq(Ny, d=dy) * Ny\n            MX, MY = np.meshgrid(mx, my, indexing='ij')\n\n            # Symbol of the discrete Laplacian DG\n            DG_hat = -4.0 / (dx*dx) * np.sin(np.pi * MX / Nx)**2 - \\\n                     -4.0 / (dy*dy) * np.sin(np.pi * MY / Ny)**2\n            \n            # Avoid division by zero at the zero frequency\n            DG_hat[0, 0] = 1.0 # Will be multiplied by S_hat[0,0] which is ~0\n\n            # Solve for pressure in Fourier space\n            p_hat = S_hat / DG_hat\n            p_hat[0, 0] = 0.0 # Enforce zero mean pressure\n            \n            # Inverse FFT to get pressure field\n            p_cc = np.real(np.fft.ifft2(p_hat))\n        else:\n            raise ValueError(\"Invalid choice\")\n\n        # --- Compute face velocities and error ---\n        \n        Gp = G(p_cc)\n        ux_f = (f_pred_f[0] - Gp[0]) / mu\n        uy_f = (f_pred_f[1] - Gp[1]) / mu\n\n        # RMS error (note normalization is by N_x*N_y)\n        error_sq_sum = np.sum(ux_f**2) + np.sum(uy_f**2)\n        e = np.sqrt(error_sq_sum / (Nx * Ny))\n        \n        return e\n\n    # Test suite parameters\n    Nx, Ny = 64, 64\n    kx, ky = 3, 2\n\n    # 1. Consistent, A=10.0, mu=0.1\n    e1 = compute_error(A=10.0, mu=0.1, choice='consistent', kx=kx, ky=ky, Nx=Nx, Ny=Ny)\n\n    # 2. Consistent, A=1000.0, mu=0.1\n    e2 = compute_error(A=1000.0, mu=0.1, choice='consistent', kx=kx, ky=ky, Nx=Nx, Ny=Ny)\n    \n    # 3. Naive, A=1.0, mu=0.1 (scaled)\n    e3_raw = compute_error(A=1.0, mu=0.1, choice='naive', kx=kx, ky=ky, Nx=Nx, Ny=Ny)\n    e3 = e3_raw / 1.0\n\n    # 4. Naive, A=10.0, mu=0.1 (scaled)\n    e4_raw = compute_error(A=10.0, mu=0.1, choice='naive', kx=kx, ky=ky, Nx=Nx, Ny=Ny)\n    e4 = e4_raw / 10.0\n\n    # 5. Naive, viscous scaling ratio r\n    e_mu01 = e4 # We already have e/A for mu=0.1, A=10.0\n    e_mu005_raw = compute_error(A=10.0, mu=0.05, choice='naive', kx=kx, ky=ky, Nx=Nx, Ny=Ny)\n    e_mu005 = e_mu005_raw / 10.0\n    r = e_mu01 / e_mu005\n\n    results = [e1, e2, e3, e4, r]\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3358724"}]}