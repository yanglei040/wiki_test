{"hands_on_practices": [{"introduction": "广义最小残差法（GMRES）的核心在于为克里洛夫子空间构建一个标准正交基。本练习将通过一个具体的计算任务，引导您手动执行其核心机制——阿诺尔迪过程。通过亲手实践，您将深刻理解作为GMRES最小化步骤基础的Hessenberg矩阵是如何构建的，从而为掌握整个算法打下坚实的基础。[@problem_id:3374306]", "problem": "考虑广义最小残差法 (GMRES)，其定义为通过使用欧几里得内积和经典格拉姆-施密特正交化的阿诺德过程来构建克里洛夫子空间的标准正交基，该方法不经预处理地应用于一个对称正定矩阵。该矩阵来源于计算流体力学中对带混合边界条件的一维椭圆算子进行的二阶有限体积离散化。设线性系统为 $A x = b$，初始残差为 $r_0 = b - A x_0$，其中 $x_0$ 是初始猜测值。在阿诺德过程中，定义基向量为 $v_1 = r_0 / \\| r_0 \\|_2$，然后递归执行\n$$\nw = A v_j,\\quad h_{i,j} = v_i^{\\top} w \\text{ for } i = 1,\\dots,j,\\quad w \\leftarrow w - \\sum_{i=1}^{j} h_{i,j} v_i,\\quad h_{j+1,j} = \\| w \\|_2,\\quad v_{j+1} = \\frac{w}{h_{j+1,j}},\n$$\n以获得$m$步阿诺德分解 $A V_m = V_{m+1} \\bar H_m$，其中 $V_m$ 的列是标准正交的，而 $\\bar H_m$ 是一个带有一条额外次对角线的上Hessenberg矩阵。\n\n现在，对于具体情况\n$$\nA = \\begin{pmatrix}\n4  -1  0  0 \\\\\n-1  4  -1  0 \\\\\n0  -1  4  -1 \\\\\n0  0  -1  3\n\\end{pmatrix},\\qquad\nr_0 = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix},\n$$\n执行两步阿诺德过程来显式构造 $V_2$ 和 $\\bar H_2$，展示正交化中使用的所有内积 $h_{i,j}$ 和所有归一化常数 $h_{j+1,j}$。使用上述的欧几里得内积和经典格拉姆-施密特过程，报告第二步的归一化常数 $h_{3,2}$ 作为您的最终答案。无需四舍五入。将最终答案表示为一个不带单位的纯数。", "solution": "问题陈述已经过严格验证，被认为是具有科学依据、适定且客观的。它提出了一个标准的数值线性代数任务——对给定的矩阵和初始向量执行阿诺德迭代，这是GMRES方法的核心组成部分。所提供的矩阵 $A$ 被描述为对称正定矩阵，这与其结构以及从计算流体力学中一个合理的物理模型推导出的性质是一致的。获得唯一解所需的所有数据和定义均已提供。因此，该问题是有效的，可以继续进行求解。\n\n任务是按照问题中的定义，对给定的矩阵 $A$ 和初始残差 $r_0$ 执行两步阿诺德迭代。目标是求出归一化常数 $h_{3,2}$ 的值。\n\n给定的矩阵 $A$ 和初始残差 $r_0$ 如下：\n$$\nA = \\begin{pmatrix}\n4  -1  0  0 \\\\\n-1  4  -1  0 \\\\\n0  -1  4  -1 \\\\\n0  0  -1  3\n\\end{pmatrix},\\qquad\nr_0 = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n\n阿诺德过程首先对初始残差 $r_0$ 进行归一化，以获得第一个基向量 $v_1$。\n\n第 $0$ 步：初始化\n计算 $r_0$ 的欧几里得范数：\n$$\n\\|r_0\\|_2 = \\sqrt{1^2 + 0^2 + 0^2 + 0^2} = 1\n$$\n那么第一个标准正交基向量 $v_1$ 是：\n$$\nv_1 = \\frac{r_0}{\\|r_0\\|_2} = \\frac{1}{1} \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n\n第 $1$ 步：第一次阿诺德迭代 ($j=1$)\n首先，我们将矩阵 $A$ 应用于基向量 $v_1$ 来计算向量 $w$：\n$$\nw = A v_1 = \\begin{pmatrix}\n4  -1  0  0 \\\\\n-1  4  -1  0 \\\\\n0  -1  4  -1 \\\\\n0  0  -1  3\n\\end{pmatrix}\n\\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 4 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n接下来，我们通过将 $w$ 投影到 $v_1$ 上来计算系数 $h_{1,1}$：\n$$\nh_{1,1} = v_1^{\\top} w = \\begin{pmatrix} 1  0  0  0 \\end{pmatrix} \\begin{pmatrix} 4 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix} = 4\n$$\n然后，我们将 $w$ 相对于 $v_1$ 进行正交化：\n$$\nw \\leftarrow w - h_{1,1} v_1 = \\begin{pmatrix} 4 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix} - 4 \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n归一化常数 $h_{2,1}$ 是更新后向量 $w$ 的欧几里得范数：\n$$\nh_{2,1} = \\|w\\|_2 = \\sqrt{0^2 + (-1)^2 + 0^2 + 0^2} = 1\n$$\n最后，我们计算第二个基向量 $v_2$：\n$$\nv_2 = \\frac{w}{h_{2,1}} = \\frac{1}{1} \\begin{pmatrix} 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n\n第 $2$ 步：第二次阿诺德迭代 ($j=2$)\n我们将 $A$ 应用于最新的基向量 $v_2$ 来计算新的向量 $w$：\n$$\nw = A v_2 = \\begin{pmatrix}\n4  -1  0  0 \\\\\n-1  4  -1  0 \\\\\n0  -1  4  -1 \\\\\n0  0  -1  3\n\\end{pmatrix}\n\\begin{pmatrix} 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ -4 \\\\ 1 \\\\ 0 \\end{pmatrix}\n$$\n现在，我们通过将 $w$ 投影到现有的基向量 $v_1$ 和 $v_2$ 上来计算系数 $h_{i,2}$（其中 $i=1, 2$）。\n$$\nh_{1,2} = v_1^{\\top} w = \\begin{pmatrix} 1  0  0  0 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ -4 \\\\ 1 \\\\ 0 \\end{pmatrix} = 1\n$$\n$$\nh_{2,2} = v_2^{\\top} w = \\begin{pmatrix} 0  -1  0  0 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ -4 \\\\ 1 \\\\ 0 \\end{pmatrix} = 4\n$$\n我们将 $w$ 相对于 $v_1$ 和 $v_2$ 进行正交化：\n$$\nw \\leftarrow w - h_{1,2} v_1 - h_{2,2} v_2 = \\begin{pmatrix} 1 \\\\ -4 \\\\ 1 \\\\ 0 \\end{pmatrix} - 1 \\begin{pmatrix} 1 \\\\ 0 \\\\ 0 \\\\ 0 \\end{pmatrix} - 4 \\begin{pmatrix} 0 \\\\ -1 \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n$$\nw = \\begin{pmatrix} 1 - 1 - 0 \\\\ -4 - 0 - (-4) \\\\ 1 - 0 - 0 \\\\ 0 - 0 - 0 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\\\ 0 \\end{pmatrix}\n$$\n第二步的归一化常数 $h_{3,2}$ 是这个最终向量 $w$ 的欧几里得范数：\n$$\nh_{3,2} = \\|w\\|_2 = \\sqrt{0^2 + 0^2 + 1^2 + 0^2} = 1\n$$\n这就是所要求的值。\n\n为求完整性，问题要求构造 $V_2$ 和 $\\bar H_2$。根据计算：\n矩阵 $V_2$ 包含前两个标准正交向量作为其列：\n$$\nV_2 = \\begin{pmatrix} v_1  v_2 \\end{pmatrix} = \\begin{pmatrix} 1  0 \\\\ 0  -1 \\\\ 0  0 \\\\ 0  0 \\end{pmatrix}\n$$\n上Hessenberg矩阵 $\\bar H_2$ 是一个由计算出的系数 $h_{i,j}$ 构成的 $3 \\times 2$ 矩阵：\n$$\n\\bar H_2 = \\begin{pmatrix} h_{1,1}  h_{1,2} \\\\ h_{2,1}  h_{2,2} \\\\ 0  h_{3,2} \\end{pmatrix} = \\begin{pmatrix} 4  1 \\\\ 1  4 \\\\ 0  1 \\end{pmatrix}\n$$\n作为最终答案要求的具体值是 $h_{3,2}$。", "answer": "$$\\boxed{1}$$", "id": "3374306"}, {"introduction": "在计算流体力学（CFD）中，一个关键挑战是离散化流体流动方程后得到的矩阵通常是“非正规”的，这会严重影响GMRES的收敛速度。本练习将从一个典型的对流-扩散方程出发，构建相应的离散矩阵，并量化其非正规性。这个实践将抽象的矩阵性质与具体的物理问题联系起来，帮助您直观地理解非正规性对求解器性能的影响。[@problem_id:3374344]", "problem": "考虑在区间 $[0,1]$ 上的稳态一维线性对流扩散算子 $L u := -D\\,u'' + a\\,u'$，其边界条件为齐次狄利克雷边界条件 $u(0)=u(1)=0$。取一个包含 $n$ 个内部点的均匀网格，网格间距为 $h = \\frac{1}{n+1}$。对于 $a>0$，使用一阶迎风差分 $(u_i - u_{i-1})/h$ 来近似内部节点 $i$ 处的一阶导数，并使用中心差分 $(u_{i+1} - 2u_i + u_{i-1})/h^2$ 来近似二阶导数。组装作用于内部值 $\\{u_i\\}_{i=1}^n$ 的离散线性系统 $A \\in \\mathbb{R}^{n \\times n}$。\n\n使用 $n=4$、$D=1$ 和 $a=10$，显式地构造矩阵 $A$，并计算由交换子的弗罗贝尼乌斯范数\n$$\\|A A^{\\ast} - A^{\\ast} A\\|_F,$$\n度量的偏离正规性，其中 $A^{\\ast}$ 表示共轭转置。将最终答案表示为无舍入的精确值。\n\n然后，基于第一性原理，定性地解释与对称的纯扩散情况（$a=0$）相比，在求解具有一般右端项的 $A x = b$ 时，这种偏离正规性的大小预期将如何影响广义最小残差（GMRES）方法的行为。此定性部分不需要数值。你的最终答案必须是 $\\|A A^{\\ast} - A^{\\ast} A\\|_F$ 的精确形式的单个实数值，不带单位。", "solution": "问题要求从一个一维对流扩散方程构造一个离散线性系统，计算其偏离正规性，并定性解释这种非正规性如何影响GMRES方法的收敛性。\n\n首先，我们验证问题陈述。已知条件如下：\n-   微分算子：$L u := -D\\,u'' + a\\,u'$，在区间 $[0,1]$ 上。\n-   边界条件：$u(0)=0$，$u(1)=0$（齐次狄利克雷）。\n-   网格：均匀，有 $n$ 个内部点，间距为 $h = \\frac{1}{n+1}$。\n-   离散化格式：\n    -   $u' \\approx \\frac{u_i - u_{i-1}}{h}$（对于 $a>0$ 的一阶迎风）。\n    -   $u'' \\approx \\frac{u_{i+1} - 2u_i + u_{i-1}}{h^2}$（二阶中心差分）。\n-   特定参数：$n=4$, $D=1$, $a=10$。\n-   任务1：计算 $\\|A A^{\\ast} - A^{\\ast} A\\|_F$。\n-   任务2：定性解释非正规性对GMRES的影响。\n\n该问题在科学上基于数值分析，是适定的，提供了所有必要信息，并且陈述客观。其设置是自洽且一致的。因此，该问题是有效的，我们可以继续进行求解。\n\n内部节点 $i$ 处的离散方程是通过将给定的有限差分近似应用于算子方程 $L u_i = f_i$ 得到的：\n$$ (L_h u)_i = -D \\left(\\frac{u_{i+1} - 2u_i + u_{i-1}}{h^2}\\right) + a \\left(\\frac{u_i - u_{i-1}}{h}\\right) = f_i $$\n我们重排各项，以对 $u_{i-1}$、$u_i$ 和 $u_{i+1}$ 的系数进行分组：\n$$ \\left(-\\frac{D}{h^2} - \\frac{a}{h}\\right) u_{i-1} + \\left(\\frac{2D}{h^2} + \\frac{a}{h}\\right) u_i - \\left(\\frac{D}{h^2}\\right) u_{i+1} = f_i $$\n这个方程定义了矩阵 $A$ 的第 $i$ 行。齐次狄利克雷边界条件意味着 $u_0 = 0$ 和 $u_{n+1} = 0$。\n\n给定 $n=4$, $D=1$ 和 $a=10$。网格间距为 $h = \\frac{1}{n+1} = \\frac{1}{4+1} = \\frac{1}{5}$。\n我们来计算系数：\n$$ \\frac{D}{h^2} = \\frac{1}{(1/5)^2} = 25 $$\n$$ \\frac{a}{h} = \\frac{10}{1/5} = 50 $$\n矩阵 $A$ 将是一个三对角矩阵，其 $i=1, \\dots, n$ 的元素如下：\n-   主对角线：$A_{i,i} = \\frac{2D}{h^2} + \\frac{a}{h} = 2(25) + 50 = 100$。\n-   下对角线：$A_{i,i-1} = -\\frac{D}{h^2} - \\frac{a}{h} = -25 - 50 = -75$。\n-   上对角线：$A_{i,i+1} = -\\frac{D}{h^2} = -25$。\n\n对于 $n=4$，矩阵 $A \\in \\mathbb{R}^{4 \\times 4}$ 为：\n$$ A = \\begin{pmatrix} 100  -25  0  0 \\\\ -75  100  -25  0 \\\\ 0  -75  100  -25 \\\\ 0  0  -75  100 \\end{pmatrix} $$\n由于 $A$ 是一个实矩阵，其共轭转置 $A^{\\ast}$ 就是其转置 $A^T$：\n$$ A^{\\ast} = A^T = \\begin{pmatrix} 100  -75  0  0 \\\\ -25  100  -75  0 \\\\ 0  -25  100  -75 \\\\ 0  0  -25  100 \\end{pmatrix} $$\n如果一个矩阵与其共轭转置可交换，即 $A A^{\\ast} = A^{\\ast} A$，则该矩阵是正规的。我们计算交换子 $C = A A^{\\ast} - A^{\\ast} A$。\n\n首先，我们计算 $A A^{\\ast}$：\n$$ A A^{\\ast} = \\begin{pmatrix} 100  -25  0  0 \\\\ -75  100  -25  0 \\\\ 0  -75  100  -25 \\\\ 0  0  -75  100 \\end{pmatrix} \\begin{pmatrix} 100  -75  0  0 \\\\ -25  100  -75  0 \\\\ 0  -25  100  -75 \\\\ 0  0  -25  100 \\end{pmatrix} $$\n$$ A A^{\\ast} = \\begin{pmatrix} 100^2 + (-25)^2  & 100(-75) + (-25)100  & (-25)(-75)  & 0 \\\\ (-75)100 + 100(-25)  & (-75)^2 + 100^2 + (-25)^2  & 100(-75) + (-25)100  & (-25)(-75) \\\\ (-75)(-25)  & (-75)100 + 100(-75)  & (-75)^2 + 100^2 + (-25)^2  & 100(-75) + (-25)100 \\\\ 0  & (-75)(-25)  & (-75)100 + 100(-75)  & (-75)^2 + 100^2 \\end{pmatrix} $$\n$$ A A^{\\ast} = \\begin{pmatrix} 10625  & -10000  & 1875  & 0 \\\\ -10000  & 16250  & -10000  & 1875 \\\\ 1875  & -10000  & 16250  & -10000 \\\\ 0  & 1875  & -10000  & 15625 \\end{pmatrix} $$\n接下来，我们计算 $A^{\\ast} A$：\n$$ A^{\\ast} A = \\begin{pmatrix} 100  -75  0  0 \\\\ -25  100  -75  0 \\\\ 0  -25  100  -75 \\\\ 0  0  -25  100 \\end{pmatrix} \\begin{pmatrix} 100  -25  0  0 \\\\ -75  100  -25  0 \\\\ 0  -75  100  -25 \\\\ 0  0  -75  100 \\end{pmatrix} $$\n$$ A^{\\ast} A = \\begin{pmatrix} 100^2 + (-75)^2  & 100(-25) + (-75)100  & (-75)(-25)  & 0 \\\\ (-25)100 + 100(-75)  & (-25)^2 + 100^2 + (-75)^2  & 100(-25) + (-75)100  & (-75)(-25) \\\\ (-25)(-75)  & (-25)100 + 100(-75)  & (-25)^2 + 100^2 + (-75)^2  & 100(-25) + (-75)100 \\\\ 0  & (-25)(-75)  & (-25)100 + 100(-75)  & (-25)^2 + 100^2 \\end{pmatrix} $$\n$$ A^{\\ast} A = \\begin{pmatrix} 15625  & -10000  & 1875  & 0 \\\\ -10000  & 16250  & -10000  & 1875 \\\\ 1875  & -10000  & 16250  & -10000 \\\\ 0  & 1875  & -10000  & 10625 \\end{pmatrix} $$\n现在，我们计算交换子 $C = A A^{\\ast} - A^{\\ast} A$：\n$$ C = \\begin{pmatrix} 10625-15625  & -10000-(-10000)  & 1875-1875  & 0-0 \\\\ -10000-(-10000)  & 16250-16250  & -10000-(-10000)  & 1875-1875 \\\\ 1875-1875  & -10000-(-10000)  & 16250-16250  & -10000-(-10000) \\\\ 0-0  & 1875-1875  & -10000-(-10000)  & 15625-10625 \\end{pmatrix} $$\n$$ C = \\begin{pmatrix} -5000  & 0  & 0  & 0 \\\\ 0  & 0  & 0  & 0 \\\\ 0  & 0  & 0  & 0 \\\\ 0  & 0  & 0  & 5000 \\end{pmatrix} $$\n偏离正规性由该交换子的弗罗贝尼乌斯范数度量，$\\|C\\|_F = \\sqrt{\\sum_{i,j=1}^n |C_{ij}|^2}$。\n$$ \\|A A^{\\ast} - A^{\\ast} A\\|_F = \\sqrt{(-5000)^2 + 0^2 + \\dots + 0^2 + 5000^2} = \\sqrt{25000000 + 25000000} $$\n$$ \\|A A^{\\ast} - A^{\\ast} A\\|_F = \\sqrt{2 \\cdot (5000)^2} = 5000\\sqrt{2} $$\n\n现在进行定性解释。GMRES 算法是求解 $Ax=b$ 的一种迭代方法。其收敛行为受到矩阵 $A$ 性质的强烈影响。\n\n在对称的纯扩散情况（$a=0$）下，矩阵 $A$ 是对称（且正定）的，这是正规矩阵的一个特例。对于正规矩阵，GMRES 的收敛性完全由 $A$ 的特征值分布决定。残差范数单调递减，收敛通常很快。对于对称正定矩阵，共轭梯度法甚至更有效，但 GMRES 的表现也会非常好。\n\n相比之下，给定 $a=10$ 的矩阵是非正规的，这由非零的交换子范数 $\\|A A^{\\ast} - A^{\\ast} A\\|_F=5000\\sqrt{2}$ 所证明。对于非正规矩阵，仅凭特征值无法提供算子行为或算法收敛性的全貌。非正规矩阵的一个关键特征是可能出现瞬态增长，即对于任意特征值 $\\lambda$，矩阵幂的范数 $\\|A^k\\|$ 可能远大于 $|\\lambda|^k$。\n\n这种非正规性对 GMRES 的收敛有不利影响。具体来说：\n1.  **残差停滞：** 与正规矩阵所见的单调下降不同，对于一个高度非正规的系统，残差范数 $\\|r_k\\|$ 在初始的一些迭代中可能会停滞甚至增加。这个“前渐近”阶段可能相当长，其持续时间通常与偏离正规性的大小相关。\n2.  **误导性的特征值：** 即使非正规矩阵 $A$ 的特征值位置有利（例如，聚集在远离原点的地方），收敛仍然可能非常慢。需要像伪谱或值域这样更高级的工具来准确预测 GMRES 的行为。GMRES 多项式不仅要在特征值上取值小，而且要在复平面的一个更大区域上取值小，这需要更高次数的多项式，因而需要更多次迭代。\n\n总而言之，与对称情况（$a=0$）的快速、单调收敛相比，非正规的对流主导情况（$a=10$）将导致 GMRES 方法收敛得慢得多，在达到渐近收敛速率之前，会表现出停滞或进展缓慢的典型初始阶段。偏离正规性的显著大小，即 $\\|A A^{\\ast} - A^{\\ast} A\\|_F = 5000\\sqrt{2}$，表明这种影响将会很明显。", "answer": "$$ \\boxed{5000\\sqrt{2}} $$", "id": "3374344"}, {"introduction": "从理论走向实践，解决真实的CFD问题需要有效地管理计算资源。本练习模拟了一项关键的规划任务：在一个严格的内存预算下，为大规模线性系统确定最优的GMRES重启参数 $m$。这个过程将迫使您权衡算法性能（由 $m$ 控制）与硬件限制（内存），这是计算科学家必须面对的基本挑战。[@problem_id:3374308]", "problem": "您正在为一个从计算流体动力学离散化中产生的大型稀疏线性系统规划一种带重启的广义最小残差方法 (GMRES) 的内存占用，其重启长度为 $m$。系统规模为 $n=5\\times 10^7$ 个未知数。目标是选择一个重启参数 $m$ 和一种稀疏矩阵存储格式，使得存储系数矩阵、一个预处理器以及所有 GMRES($m$) 工作数据所需的总内存不超过 $64$ gibibyte (GiB) 的内存预算，其中 $1$ GiB $=2^{30}$ 字节。所有内存必须以 GiB 表示。\n\n建模的基础源于以下广泛使用且经过充分测试的事实：\n- 诸如 Navier–Stokes 方程等偏微分方程的离散化会产生大型稀疏线性系统，由于局部模板操作，每行的非零元素数量有界。\n- 广义最小残差方法 (GMRES) 使用 Arnoldi 过程构建一个维度为 $m$ 的克里洛夫子空间，该过程需要存储 $m+1$ 个基向量和一个小的 $(m+1)\\times m$ 上 Hessenberg 矩阵。\n- 诸如压缩稀疏行 (CSR)、压缩稀疏列 (CSC) 和 ELLPACK (ELL) 等稀疏存储格式存储值和整数索引数组，每个非零元素的内存使用量是可预测的，此外还有一些小的指针数组。\n- 双精度浮点值为 $8$ 字节。32 位整数为 $4$ 字节。对于 $n=5\\times 10^7$，$32$ 位索引是足够的。\n\n内存使用模型如下：\n- 令 $k_{\\text{avg}}$ 表示每行的平均非零元素数，令 $k_{\\max}$ 表示每行的最大非零元素数。\n- 令 $nz = n \\cdot k_{\\text{avg}}$ 为矩阵中的非零元素总数。\n- 对于稀疏矩阵存储，使用以下格式之一，附带整数代码：\n  - $0$：压缩稀疏行 (CSR)。内存（字节）：$M_{\\text{CSR}} = nz\\cdot(8+4) + (n+1)\\cdot 4$。\n  - $1$：压缩稀疏列 (CSC)。内存（字节）：$M_{\\text{CSC}} = nz\\cdot(8+4) + (n+1)\\cdot 4$。\n  - $2$：ELLPACK (ELL)，填充至 $k_{\\max}$。内存（字节）：$M_{\\text{ELL}} = n\\cdot k_{\\max}\\cdot(8+4)$。\n- 对于预处理器，附带整数代码：\n  - $0$：无，内存 $M_{\\text{prec}}=0$。\n  - $1$：对角 (Jacobi)，内存 $M_{\\text{prec}} = n\\cdot 8$。\n  - $2$：零填充不完全 LU 分解 (ILU($0$))，近似为以类似 CSR 的形式存储 L 和 U，其稀疏模式与矩阵相同。内存 $M_{\\text{prec}} = 2\\cdot\\big(nz\\cdot(8+4) + (n+1)\\cdot 4\\big)$。\n- GMRES($m$) 内存模型：\n  - 存储 $m+1$ 个长度为 $n$ 的基向量：$M_{\\text{basis}}(m) = (m+1)\\cdot n\\cdot 8$ 字节。\n  - 以双精度存储 $(m+1)\\times m$ 的上 Hessenberg 矩阵：$M_{\\text{Hess}}(m) = (m+1)\\cdot m \\cdot 8$ 字节。\n  - 以双精度存储少量额外的长度为 $n$ 的 Krylov 和工作向量：设 $c_w=3$，得到 $M_{\\text{work}} = c_w\\cdot n\\cdot 8$ 字节。\n  - 存储解向量和右端项向量：$M_{x,b} = 2\\cdot n\\cdot 8$ 字节。\n  - 存储 Givens 旋转系数：$M_{\\text{givens}}(m) = 2\\cdot m\\cdot 8$ 字节。\n\n总内存（字节）为\n$$\nM_{\\text{total}}(m, \\text{format}, \\text{prec}) = M_{\\text{matrix}}(\\text{format}) + M_{\\text{prec}}(\\text{prec}) + M_{\\text{basis}}(m) + M_{\\text{Hess}}(m) + M_{\\text{work}} + M_{x,b} + M_{\\text{givens}}(m).\n$$\n\n规划任务如下：\n- 给定 $n=5\\times 10^7$、每行平均非零元素数 $k_{\\text{avg}}$、每行最大非零元素数 $k_{\\max}}$ 以及预处理器类型代码，从 $\\{0,1,2\\}$ 中选择矩阵存储格式代码，使得对于给定的 $(n,k_{\\text{avg}},k_{\\max})$，$M_{\\text{matrix}}$ 最小化，然后找出满足 $M_{\\text{total}}(m,\\text{format},\\text{prec}) \\le 64$ GiB 的最大整数 $m\\geq 1$。\n- 如果即使 $m=1$ 也超出了所有三种格式的 $64$ GiB 预算，则报告不可行，令 $m=-1$，并仍然报告最小化 $M_{\\text{matrix}}$ 的格式代码，以及使用 $m=0$（表示没有任何 Krylov 基的基础分配）对应的最小 $M_{\\text{total}}$。\n\n使用以下包含四个典型和边缘场景的测试套件：\n- 案例 $1$：$(k_{\\text{avg}}=7,\\,k_{\\max}=7,\\,\\text{prec}=1)$。\n- 案例 $2$：$(k_{\\text{avg}}=27,\\,k_{\\max}=27,\\,\\text{prec}=0)$。\n- 案例 $3$：$(k_{\\text{avg}}=27,\\,k_{\\max}=42,\\,\\text{prec}=2)$。\n- 案例 $4$：$(k_{\\text{avg}}=81,\\,k_{\\max}=81,\\,\\text{prec}=2)$。\n\n不涉及角度单位。内存必须以 GiB 表示。您的程序必须为每种情况计算三元组 $(m^\\star, f^\\star, M_{\\text{total}}^\\star)$，其中 $m^\\star$ 是所选的重启长度，$f^\\star$ 是所选的格式代码，$M_{\\text{total}}^\\star$ 是总内存（以 GiB 为单位）。对于不可行的情况，输出 $m^\\star=-1$，$f^\\star$ 等于具有最小矩阵内存的格式代码，以及 $M_{\\text{total}}^\\star$ 等于使用 $m=0$ 时的总内存（以 GiB 为单位）。您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。将四个案例的结果通过连接三元组进行聚合，形成一个包含 12 个数字的扁平列表，例如 $[m_1,f_1,M_1,m_2,f_2,M_2,m_3,f_3,M_3,m_4,f_4,M_4]$。$M_i$ 必须四舍五入到 GiB 的三位小数。", "solution": "该问题要求我们确定应用于规模为 $n=5\\times 10^7$ 的稀疏线性系统的 GMRES($m$) 方法的最大可行重启参数 $m$，总内存预算为 $64$ GiB。这涉及到选择一个最优的稀疏矩阵存储格式，并考虑所有内存消耗的来源。\n\n首先，我们形式化总内存模型。总内存 $M_{\\text{total}}$ 是稀疏矩阵内存 ($M_{\\text{matrix}}$)、预处理器内存 ($M_{\\text{prec}}$) 和 GMRES 算法本身内存 ($M_{\\text{GMRES}}$) 的总和。问题为每个部分提供了具体的公式。设 $1$ GiB $= 2^{30}$ 字节。所有浮点数均为双精度（$8$ 字节），索引为 $32$ 位整数（$4$ 字节）。\n\n总内存由下式给出：\n$$\nM_{\\text{total}}(m, \\text{format}, \\text{prec}) = M_{\\text{matrix}}(\\text{format}) + M_{\\text{prec}}(\\text{prec}) + M_{\\text{GMRES}}(m)\n$$\n其中 $M_{\\text{GMRES}}(m)$ 是基向量、Hessenberg 矩阵、工作向量、解/右端项向量和 Givens 旋转系数的内存总和：\n$$\nM_{\\text{GMRES}}(m) = M_{\\text{basis}}(m) + M_{\\text{Hess}}(m) + M_{\\text{work}} + M_{x,b} + M_{\\text{givens}}(m)\n$$\n代入给定的表达式：\n$$\nM_{\\text{GMRES}}(m) = (m+1)n \\cdot 8 + (m+1)m \\cdot 8 + c_w n \\cdot 8 + 2n \\cdot 8 + 2m \\cdot 8\n$$\n使用指定的常数 $c_w=3$：\n$$\nM_{\\text{GMRES}}(m) = (m+1)n \\cdot 8 + (m+1)m \\cdot 8 + 3n \\cdot 8 + 2n \\cdot 8 + 2m \\cdot 8\n$$\n为了分析对 $m$ 的依赖性，我们可以将内存表达式分为静态部分（与 $m$ 无关）和动态部分（与 $m$ 相关）。让我们重新组合 $M_{\\text{total}}(m)$ 中的各项：\n$$\nM_{\\text{total}}(m) = \\underbrace{M_{\\text{matrix}} + M_{\\text{prec}} + (1+3+2)n \\cdot 8}_{\\text{静态部分}} + \\underbrace{m \\cdot n \\cdot 8 + (m^2+m) \\cdot 8 + 2m \\cdot 8}_{\\text{动态部分}}\n$$\n令 $M_{\\text{static}} = M_{\\text{matrix}} + M_{\\text{prec}} + 6n \\cdot 8$。这表示 $m=0$ 时的基线内存分配，包括矩阵、预处理器和总共 $6$ 个大小为 $n$ 的向量（初始基向量 $v_1$、$3$ 个工作向量、解向量 $x$ 和右端项向量 $b$）的内存。\n随 $m$ 增长的动态部分可以简化为关于 $m$ 的二次式：\n$$\nM_{\\text{dynamic}}(m) = 8nm + 8m^2 + 8m + 16m = 8m^2 + (8n+24)m\n$$\n因此，总内存是关于 $m$ 的二次函数：\n$$\nM_{\\text{total}}(m) = M_{\\text{static}} + 8m^2 + (8n+24)m\n$$\n该问题需要一个两步优化过程。首先，选择存储格式以最小化 $M_{\\text{matrix}}$。其次，找到满足内存预算的最大整数 $m \\ge 1$。\n\n**步骤 1：最优矩阵格式选择**\n我们必须在 CSR（代码 $0$）、CSC（代码 $1$）和 ELL（代码 $2$）之间进行选择。CSR 和 CSC 的内存模型是相同的。设 $nz = n \\cdot k_{\\text{avg}}$ 为非零元素的数量。\n- $M_{\\text{CSR}}(k_{\\text{avg}}) = n \\cdot k_{\\text{avg}} \\cdot (8+4) + (n+1) \\cdot 4 = 12nk_{\\text{avg}} + 4(n+1)$\n- $M_{\\text{ELL}}(k_{\\max}) = n \\cdot k_{\\max} \\cdot (8+4) = 12nk_{\\max}$\n我们选择内存最小的格式。我们比较 $12nk_{\\text{avg}} + 4(n+1)$ 和 $12nk_{\\max}$。\n- 如果 $k_{\\text{avg}} = k_{\\max}}$，则 $M_{\\text{CSR}} = 12nk_{\\text{avg}} + 4(n+1) > 12nk_{\\text{avg}} = M_{\\text{ELL}}$。因此，ELL（代码 $2$）更优。\n- 如果 $k_{\\text{avg}} < k_{\\max}}$，CSR（代码 $0$）通常更优，因为 $k_{\\max}$ 的填充会超过 CSR 的少量开销，尤其是当 $k_{\\max}$ 显著大于 $k_{\\text{avg}}$ 时。\n\n**步骤 2：确定最大重启长度 $m$**\n在选择了最优格式 $f^\\star$ 并计算了相应的 $M_{\\text{matrix}}$ 和 $M_{\\text{prec}}$ 之后，我们确定静态内存成本 $M_{\\text{static}}$。问题是找到最大的整数 $m \\ge 1$ 使得 $M_{\\text{total}}(m) \\le B$，其中 $B=64 \\text{ GiB} = 64 \\cdot 2^{30}$ 字节。这可以转化为求解二次不等式：\n$$\n8m^2 + (8n+24)m + (M_{\\text{static}} - B) \\le 0\n$$\n关于 $m$ 的二次函数是一个开口向上的抛物线。该不等式在 $8m^2 + (8n+24)m + (M_{\\text{static}} - B) = 0$ 的两个根之间成立。由于 $n>0$，线性系数为正。如果存在解，$M_{\\text{static}}$ 必须小于 $B$，使得常数项为负，这保证了一个正根和一个负根。我们关心的是正根 $m_{\\text{root}}$：\n$$\nm_{\\text{root}} = \\frac{-(8n+24) + \\sqrt{(8n+24)^2 - 4 \\cdot 8 \\cdot (M_{\\text{static}} - B)}}{2 \\cdot 8}\n$$\n允许的最大整数值为 $m^\\star = \\lfloor m_{\\text{root}} \\rfloor$。\n\n如果 $M_{\\text{total}}(m=1) > B$，则不存在 $m \\ge 1$ 的解。在这种情况下，问题被视为不可行，我们报告 $m^\\star = -1$。此时要求的内存输出是 $M_{\\text{total}}(m=0) = M_{\\text{static}}$，使用最佳选择的格式 $f^\\star$ 计算。\n\n对于每个测试用例 $(k_{\\text{avg}}, k_{\\max}, \\text{prec})$ 的总体算法如下：\n1.  通过比较 $M_{\\text{CSR}}(k_{\\text{avg}})$ 和 $M_{\\text{ELL}}(k_{\\max})$，确定最优格式代码 $f^\\star$ 和 $M_{\\text{matrix}}$。\n2.  根据预处理器代码计算 $M_{\\text{prec}}$。对于 ILU($0$)，使用公式 $2 \\cdot (12nk_{\\text{avg}} + 4(n+1))$。\n3.  计算总静态内存 $M_{\\text{static}} = M_{\\text{matrix}} + M_{\\text{prec}} + 6n \\cdot 8$。\n4.  检查可行性。如果 $M_{\\text{total}}(m=1) = M_{\\text{static}} + 8(1)^2+(8n+24)(1) > B$，则设 $m^\\star = -1$ 且 $M^\\star_{\\text{total}} = M_{\\text{static}}$。\n5.  如果可行，求解二次不等式得到 $m_{\\text{root}}$ 并设 $m^\\star = \\lfloor m_{\\text{root}} \\rfloor$。然后计算最终内存使用量 $M^\\star_{\\text{total}} = M_{\\text{total}}(m^\\star)$。\n6.  将最终内存（字节）转换为 GiB 并四舍五入到 $3$ 位小数。\n7. 此过程应用于所有四个测试用例。", "answer": "$$\\boxed{\\text{[10, 2, 63.978, 3, 2, 63.992, -1, 0, 84.184, -1, 2, 159.084]}}$$", "id": "3374308"}]}