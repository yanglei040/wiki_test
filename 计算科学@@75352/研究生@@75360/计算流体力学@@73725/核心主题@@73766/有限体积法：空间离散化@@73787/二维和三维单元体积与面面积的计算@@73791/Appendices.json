{"hands_on_practices": [{"introduction": "现代计算流体动力学（CFD）模拟中经常遇到几何形状复杂、甚至非凸的计算网格单元。精确计算这些单元的体积对于保证离散格式的守恒性至关重要。本实践基于高斯散度定理，引导你构建一个优雅而稳健的算法，该算法将任意多面体的体积分解为一系列带符号的四面体体积之和，并证明计算结果与所选参考点无关。通过这个练习 [@problem_id:3303150]，你不仅能掌握一个通用的体积计算方法，还能深入理解其背后的数学原理，特别是对于封闭曲面其结果与参考点选择无关的特性。", "problem": "您的任务是设计、论证并实现一个适用于计算流体动力学 (CFD) 的算法，用于计算一个一般非凸多面体的体积。该多面体的边界由一组有限的、具有一致朝向的平面三角面表示。您必须从第一性原理出发，构建一种方法，将体积剖分为由一个固定参考点和每个定向面构成的带符号四面体，然后证明，只要曲面是闭合且不自交的，所得总体积与参考点的选择无关。\n\n您必须使用的基本原理是：\n- 平面面的有向面积矢量定义和标量三重积恒等式，即对于矢量 $\\mathbf{u}, \\mathbf{v}, \\mathbf{w} \\in \\mathbb{R}^{3}$，标量三重积满足 $\\det[\\mathbf{u},\\mathbf{v},\\mathbf{w}] = \\mathbf{u} \\cdot (\\mathbf{v} \\times \\mathbf{w})$。\n- 散度定理 (高斯定理)，该定理指出，对于区域 $\\Omega \\subset \\mathbb{R}^{3}$ 上的一个足够光滑的矢量场 $\\mathbf{F}$，其边界为 $\\partial \\Omega$，外向单位法线为 $\\mathbf{n}$，则有 $\\displaystyle \\int_{\\Omega} \\nabla \\cdot \\mathbf{F}\\, dV = \\oint_{\\partial \\Omega} \\mathbf{F} \\cdot \\mathbf{n}\\, dS$。\n- 对于顶点为 $\\mathbf{p}_{0}, \\mathbf{p}_{1}, \\mathbf{p}_{2}, \\mathbf{p}_{3}$ 的四面体，其带符号体积的定义为 $V_{\\text{tet}} = \\frac{1}{6}\\det[\\mathbf{p}_{1}-\\mathbf{p}_{0}, \\mathbf{p}_{2}-\\mathbf{p}_{0}, \\mathbf{p}_{3}-\\mathbf{p}_{0}]$。\n\n您的算法设计必须：\n1. 使用一个固定的参考点 $\\mathbf{r} \\in \\mathbb{R}^{3}$ (不一定位于多面体内部)，定义每个三角面对总体积的带符号贡献。每个具有有序顶点 $(\\mathbf{a},\\mathbf{b},\\mathbf{c})$ 的三角形贡献了由顶点 $(\\mathbf{r},\\mathbf{a},\\mathbf{b},\\mathbf{c})$ 构成的四面体的带符号体积。\n2. 汇总所有面的带符号贡献，得到总体积 $V(\\mathbf{r})$。\n3. 从第一性原理证明，如果曲面是闭合的、不自交的且具有一致的朝向，则 $V(\\mathbf{r})$ 与参考点 $\\mathbf{r}$ 的选择无关。\n4. 解释为什么对于开放曲面，独立性会失效，并提供一个具体示例。\n\n您必须将该算法实现为一个完整、可运行的程序，该程序以立方米为单位生成体积。所有体积均以 $\\mathrm{m}^{3}$ 表示，并四舍五入到十位小数。程序必须是自包含的，且不得读取任何输入。\n\n测试套件描述和要求输出：\n实现该算法并在以下四种情况下进行评估。对于每种情况，使用两个不同的参考点计算体积，并返回这两个体积值以及一个布尔值，该布尔值指示两个体积在数值容差内是否相等（当绝对差小于 $10^{-10}$ 时视为相等）。最终程序输出必须是一行，其中包含一个用方括号括起来的逗号分隔列表，按顺序汇总所有案例的结果。\n\n- 案例 1 (闭合、凸面、理想情况): 单位立方体，通过将 xy 平面中顶点为 $\\{(0,0),(1,0),(1,1),(0,1)\\}$ 的正方形多边形沿 z 轴方向从 $z=0$ 拉伸到 $z=1$ 获得。使用 $\\mathbf{r}_{1}=(0.2,0.3,0.4)$ 和 $\\mathbf{r}_{2}=(-1,-1,-1)$。真实体积为 $1.0\\,\\mathrm{m}^{3}$。\n\n- 案例 2 (闭合、凸面四面体): 顶点为 $\\mathbf{v}_{0}=(0,0,0)$, $\\mathbf{v}_{1}=(1,0,0)$, $\\mathbf{v}_{2}=(0,1,0)$, $\\mathbf{v}_{3}=(0,0,1)$ 的四面体，其三角面构成一个闭合的、外向的曲面。使用 $\\mathbf{r}_{1}=(0,0,0)$ 和 $\\mathbf{r}_{2}=(5,5,5)$。真实体积为 $\\frac{1}{6}\\,\\mathrm{m}^{3}$。\n\n- 案例 3 (闭合、非凸): 将 xy 平面中由有序顶点 $\\{(0,0),(2,0),(2,1),(1,1),(1,2),(0,2)\\}$ 给出的凹“L形”多边形从 $z=0$ 拉伸到 $z=1$。底面积为 $3$，因此真实体积为 $3.0\\,\\mathrm{m}^{3}$。使用 $\\mathbf{r}_{1}=(0.5,0.5,0.5)$ 和 $\\mathbf{r}_{2}=(10,-1,0)$。\n\n- 案例 4 (开放曲面、边界情况): 位于 $z=0$ 平面上的单个正方形面片，顶点为 $\\{(0,0,0),(1,0,0),(1,1,0),(0,1,0)\\}$，被三角化为两个三角形。使用 $\\mathbf{r}_{1}=(0,0,1)$ 和 $\\mathbf{r}_{2}=(0,0,-1)$。该曲面是开放的；预计独立性会失效。\n\n对于每种情况，您的程序应输出三个值：第一个体积，单位为 $\\mathrm{m}^{3}$，四舍五入到十位小数；第二个体积，单位为 $\\mathrm{m}^{3}$，四舍五入到十位小数；以及一个布尔值，指示体积在容差范围内是否一致。最终输出格式必须是单行，包含所有案例结果串联而成的逗号分隔列表，并用方括号括起来；即 $[\\text{V1\\_case1},\\text{V2\\_case1},\\text{agree\\_case1},\\text{V1\\_case2},\\dots]$。", "solution": "问题要求设计、论证并实现一个算法，用于计算由一组具有一致朝向的三角面定义的通用多面体的体积。该算法基于将多面体体积分解为一系列带符号体积的四面体之和，这些四面体由每个面的顶点和一个公共的、任意的参考点构成。任务的核心是证明，对于一个闭合且不自交的曲面，最终计算出的总体积与该参考点的选择无关。\n\n### 算法设计\n\n设多面体的体积为 $\\Omega \\subset \\mathbb{R}^3$，其边界面为 $\\partial \\Omega$。边界是由一组 $N$ 个三角面 $\\{f_1, f_2, \\ldots, f_N\\}$ 组成的网格。每个面 $f_i$ 由一个有序的顶点三元组 $(\\mathbf{a}_i, \\mathbf{b}_i, \\mathbf{c}_i)$ 定义。所有面的顶点顺序是一致的，这意味着由叉积（如 $(\\mathbf{b}_i - \\mathbf{a}_i) \\times (\\mathbf{c}_i - \\mathbf{a}_i)$）导出的法向量要么始终指向体积内部，要么始终指向体积外部。按照惯例，我们假设法线朝向为向外。\n\n1.  **选择参考点**：我们选择一个任意的参考点 $\\mathbf{r} \\in \\mathbb{R}^3$。该点可以位于空间中的任何位置，包括多面体的内部、外部或边界上。\n\n2.  **基于面的四面体带符号体积**：对于每个具有顶点 $(\\mathbf{a}_i, \\mathbf{b}_i, \\mathbf{c}_i)$ 的三角面 $f_i$，我们构建一个由顶点 $(\\mathbf{r}, \\mathbf{a}_i, \\mathbf{b}_i, \\mathbf{c}_i)$ 组成的四面体。此四面体的带符号体积 $V_i$ 由标量三重积给出：\n    $$ V_i(\\mathbf{r}) = \\frac{1}{6} \\det\\begin{bmatrix} \\mathbf{a}_i - \\mathbf{r}  \\mathbf{b}_i - \\mathbf{r}  \\mathbf{c}_i - \\mathbf{r} \\end{bmatrix} $$\n    其中矢量被视为矩阵的列。这等同于：\n    $$ V_i(\\mathbf{r}) = \\frac{1}{6} (\\mathbf{a}_i - \\mathbf{r}) \\cdot \\left( (\\mathbf{b}_i - \\mathbf{r}) \\times (\\mathbf{c}_i - \\mathbf{r}) \\right) $$\n    $V_i$ 的符号取决于面顶点 $(\\mathbf{a}_i, \\mathbf{b}_i, \\mathbf{c}_i)$ 相对于参考点 $\\mathbf{r}$ 的朝向。\n\n3.  **聚合带符号体积**：多面体的总体积 $V(\\mathbf{r})$ 通过将所有这些四面体的带符号体积相加来计算：\n    $$ V(\\mathbf{r}) = \\sum_{i=1}^{N} V_i(\\mathbf{r}) = \\sum_{i=1}^{N} \\frac{1}{6} \\det\\begin{bmatrix} \\mathbf{a}_i - \\mathbf{r}  \\mathbf{b}_i - \\mathbf{r}  \\mathbf{c}_i - \\mathbf{r} \\end{bmatrix} $$\n    如果曲面法线（由顶点顺序确定）指向外部，那么对于那些参考点 $\\mathbf{r}$ 位于面“内侧”的四面体，其将贡献正体积；而对于那些 $\\mathbf{r}$ 位于“外侧”的四面体，其将贡献负体积。对于凸多面体和内部参考点，所有贡献均为正值。对于非凸形状或外部参考点，会发生抵消，但最终总和仍能正确得出净体积。\n\n### 关于独立于参考点 $\\mathbf{r}$ 的证明\n\n为了证明计算出的体积 $V(\\mathbf{r})$ 对于闭合曲面而言与 $\\mathbf{r}$ 的选择无关，我们必须证明 $V(\\mathbf{r})$ 相对于 $\\mathbf{r}$ 的梯度是零向量，即 $\\nabla_{\\mathbf{r}} V(\\mathbf{r}) = \\mathbf{0}$。\n\n让我们计算单个面 $f_i$ 的贡献的梯度：\n$$ \\nabla_{\\mathbf{r}} V_i(\\mathbf{r}) = \\frac{1}{6} \\nabla_{\\mathbf{r}} \\det\\begin{bmatrix} \\mathbf{a}_i - \\mathbf{r}  \\mathbf{b}_i - \\mathbf{r}  \\mathbf{c}_i - \\mathbf{r} \\end{bmatrix} $$\n使用行列式导数的链式法则 (雅可比公式) 并注意到 $\\nabla_{\\mathbf{r}} (\\mathbf{k} - \\mathbf{r}) = -\\mathbf{I}$ (其中 $\\mathbf{k}$ 是常数矢量，$\\mathbf{I}$ 是单位张量)，行列式相对于其矢量参数的梯度可以被计算出来。一个更直接的方法是关于 $\\mathbf{r}$ 的一个分量（例如 $r_k$）求偏导数。\n$$ \\frac{\\partial}{\\partial r_k} \\det[\\mathbf{u}_1, \\mathbf{u}_2, \\mathbf{u}_3] = \\det\\left[\\frac{\\partial \\mathbf{u}_1}{\\partial r_k}, \\mathbf{u}_2, \\mathbf{u}_3\\right] + \\det\\left[\\mathbf{u}_1, \\frac{\\partial \\mathbf{u}_2}{\\partial r_k}, \\mathbf{u}_3\\right] + \\det\\left[\\mathbf{u}_1, \\mathbf{u}_2, \\frac{\\partial \\mathbf{u}_3}{\\partial r_k}\\right] $$\n这里，$\\mathbf{u}_1 = \\mathbf{a}_i - \\mathbf{r}$，$\\mathbf{u}_2 = \\mathbf{b}_i - \\mathbf{r}$，$\\mathbf{u}_3 = \\mathbf{c}_i - \\mathbf{r}$。偏导数 $\\frac{\\partial \\mathbf{u}_j}{\\partial r_k}$ 是矢量 $-\\mathbf{e}_k$，其中 $\\mathbf{e}_k$ 是第 $k$ 个坐标的标准基矢量。\n因此，梯度的第 $k$ 个分量是：\n$$ \\frac{\\partial V_i}{\\partial r_k} = \\frac{1}{6} \\left( \\det[-\\mathbf{e}_k, \\mathbf{u}_2, \\mathbf{u}_3] + \\det[\\mathbf{u}_1, -\\mathbf{e}_k, \\mathbf{u}_3] + \\det[\\mathbf{u}_1, \\mathbf{u}_2, -\\mathbf{e}_k] \\right) $$\n使用标量三重积恒等式，这变为：\n$$ \\frac{\\partial V_i}{\\partial r_k} = \\frac{1}{6} \\left( -\\mathbf{e}_k \\cdot (\\mathbf{u}_2 \\times \\mathbf{u}_3) - \\mathbf{e}_k \\cdot (\\mathbf{u}_3 \\times \\mathbf{u}_1) - \\mathbf{e}_k \\cdot (\\mathbf{u}_1 \\times \\mathbf{u}_2) \\right) $$\n由于这对每个分量 $k$ 都必须成立，我们可以写出完整的梯度矢量：\n$$ \\nabla_{\\mathbf{r}} V_i(\\mathbf{r}) = -\\frac{1}{6} \\left( (\\mathbf{u}_2 \\times \\mathbf{u}_3) + (\\mathbf{u}_3 \\times \\mathbf{u}_1) + (\\mathbf{u}_1 \\times \\mathbf{u}_2) \\right) $$\n代回 $\\mathbf{u}_1, \\mathbf{u}_2, \\mathbf{u}_3$:\n$$ \\nabla_{\\mathbf{r}} V_i(\\mathbf{r}) = -\\frac{1}{6} \\left( ((\\mathbf{b}_i - \\mathbf{r}) \\times (\\mathbf{c}_i - \\mathbf{r})) + ((\\mathbf{c}_i - \\mathbf{r}) \\times (\\mathbf{a}_i - \\mathbf{r})) + ((\\mathbf{a}_i - \\mathbf{r}) \\times (\\mathbf{b}_i - \\mathbf{r})) \\right) $$\n括号内的叉积之和可以使用恒等式 $(\\mathbf{v}-\\mathbf{u})\\times(\\mathbf{w}-\\mathbf{u}) = \\mathbf{v}\\times\\mathbf{w} + \\mathbf{w}\\times\\mathbf{u} + \\mathbf{u}\\times\\mathbf{v}$ 进行简化。\n令 $\\mathbf{u}=\\mathbf{r}$, $\\mathbf{v}=\\mathbf{c}_i$, $\\mathbf{w}=\\mathbf{b}_i$ 并置换项，我们发现该和等价于 $(\\mathbf{b}_i - \\mathbf{a}_i) \\times (\\mathbf{c}_i - \\mathbf{a}_i)$。\n因此：\n$$ \\nabla_{\\mathbf{r}} V_i(\\mathbf{r}) = -\\frac{1}{6} ((\\mathbf{b}_i - \\mathbf{a}_i) \\times (\\mathbf{c}_i - \\mathbf{a}_i)) $$\n项 $\\frac{1}{2} (\\mathbf{b}_i - \\mathbf{a}_i) \\times (\\mathbf{c}_i - \\mathbf{a}_i)$ 是三角面 $f_i$ 的矢量面积 $\\mathbf{S}_i$。因此：\n$$ \\nabla_{\\mathbf{r}} V_i(\\mathbf{r}) = -\\frac{1}{3} \\mathbf{S}_i $$\n总体积的梯度是每个面梯度的总和：\n$$ \\nabla_{\\mathbf{r}} V(\\mathbf{r}) = \\sum_{i=1}^{N} \\nabla_{\\mathbf{r}} V_i(\\mathbf{r}) = -\\frac{1}{3} \\sum_{i=1}^{N} \\mathbf{S}_i $$\n对于任何闭合曲面 $\\partial\\Omega$ (即包围一个没有孔洞的体积的曲面)，其所有面的矢量面积之和为零向量：$\\sum_{i=1}^{N} \\mathbf{S}_i = \\oint_{\\partial\\Omega} d\\mathbf{S} = \\mathbf{0}$。这是将散度定理应用于一个常数矢量场的结果。\n因此，对于闭合曲面：\n$$ \\nabla_{\\mathbf{r}} V(\\mathbf{r}) = \\mathbf{0} $$\n这证明了计算出的体积 $V(\\mathbf{r})$ 不随参考点 $\\mathbf{r}$ 的位置而改变，从而确立了该算法的稳健性。\n\n### 对于开放曲面，独立性失效的原因\n\n独立性的证明关键依赖于**闭合**曲面上所有面矢量面积之和为零的性质。如果曲面是开放的，则不满足此条件。开放曲面的矢量面积之和通常不为零。\n$$ \\nabla_{\\mathbf{r}} V(\\mathbf{r}) = -\\frac{1}{3} \\sum_{i \\in \\text{open surface}} \\mathbf{S}_i \\neq \\mathbf{0} $$\n这个非零梯度意味着计算出的“体积” $V(\\mathbf{r})$ 依赖于参考点 $\\mathbf{r}$ 的选择。\n\n**具体示例 (案例 4):**\n考虑一个位于 $z=0$ 平面内，由顶点 $\\{(0,0,0),(1,0,0),(1,1,0),(0,1,0)\\}$ 定义的正方形面片。假设它被三角化为两个三角形，具有向上朝向（法线沿 $+z$ 方向）：\n$f_1$ 的顶点为 $(\\mathbf{a}_1, \\mathbf{b}_1, \\mathbf{c}_1) = ((0,0,0), (1,0,0), (1,1,0))$。\n$f_2$ 的顶点为 $(\\mathbf{a}_2, \\mathbf{b}_2, \\mathbf{c}_2) = ((0,0,0), (1,1,0), (0,1,0))$。\n\n面积矢量为：\n$\\mathbf{S}_1 = \\frac{1}{2}(\\mathbf{b}_1 - \\mathbf{a}_1) \\times (\\mathbf{c}_1 - \\mathbf{a}_1) = \\frac{1}{2}(1,0,0) \\times (1,1,0) = \\frac{1}{2}(0,0,1)$。\n$\\mathbf{S}_2 = \\frac{1}{2}(\\mathbf{b}_2 - \\mathbf{a}_2) \\times (\\mathbf{c}_2 - \\mathbf{a}_2) = \\frac{1}{2}(1,1,0) \\times (0,1,0) = \\frac{1}{2}(0,0,1)$。\n\n面积矢量之和为 $\\sum \\mathbf{S}_i = \\mathbf{S}_1 + \\mathbf{S}_2 = (0,0,1)$。\n计算出的“体积”的梯度为 $\\nabla_{\\mathbf{r}} V(\\mathbf{r}) = -\\frac{1}{3}(0,0,1)$。这表明当 $\\mathbf{r}$ 的 $z$ 坐标改变时，其值也会改变。\n让我们为这个曲面计算 $V(\\mathbf{r})$。注意，对于任何位于 $xy$ 平面内的面，$\\det[\\mathbf{a}_i, \\mathbf{b}_i, \\mathbf{c}_i]=0$。\n我们使用展开式 $V_i(\\mathbf{r}) = \\frac{1}{6} (\\det[\\mathbf{a}_i,\\mathbf{b}_i,\\mathbf{c}_i] - \\mathbf{r}\\cdot(2\\mathbf{S}_i))$。\n所以，$V(\\mathbf{r}) = \\sum_i \\frac{1}{6} (0 - \\mathbf{r}\\cdot(2\\mathbf{S}_i)) = -\\frac{1}{3} \\mathbf{r} \\cdot \\sum_i \\mathbf{S}_i$。\n$V(\\mathbf{r}) = -\\frac{1}{3} (r_x, r_y, r_z) \\cdot (0,0,1) = -\\frac{r_z}{3}$。\n对于案例 4 中指定的两个参考点：\n- $\\mathbf{r}_1 = (0,0,1)$: $V(\\mathbf{r}_1) = -1/3$。\n- $\\mathbf{r}_2 = (0,0,-1)$: $V(\\mathbf{r}_2) = -(-1)/3 = 1/3$。\n计算出的值不同，这证实了对于开放曲面，独立性属性会失效。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the polyhedron volume problem for all test cases.\n    \"\"\"\n\n    def compute_volume(faces, ref_point):\n        \"\"\"\n        Computes the volume of a polyhedron defined by triangular faces.\n\n        Args:\n            faces (list of tuples): A list of triangular faces. Each face is a \n                                    tuple of 3 vertices, and each vertex is a \n                                    numpy array of shape (3,).\n            ref_point (numpy.ndarray): The reference point as a numpy array of \n                                       shape (3,).\n\n        Returns:\n            float: The computed volume of the polyhedron.\n        \"\"\"\n        total_volume = 0.0\n        r = np.array(ref_point, dtype=np.float64)\n\n        for face in faces:\n            p1 = np.array(face[0], dtype=np.float64)\n            p2 = np.array(face[1], dtype=np.float64)\n            p3 = np.array(face[2], dtype=np.float64)\n            \n            # Form the matrix with columns (p1-r), (p2-r), (p3-r)\n            mat = np.array([p1 - r, p2 - r, p3 - r]).T\n            \n            # The signed volume of the tetrahedron is (1/6) * det(mat)\n            total_volume += np.linalg.det(mat)\n        \n        return total_volume / 6.0\n\n    # Test Case 1: Unit cube\n    v = [\n        (0.0, 0.0, 0.0), (1.0, 0.0, 0.0), (1.0, 1.0, 0.0), (0.0, 1.0, 0.0),\n        (0.0, 0.0, 1.0), (1.0, 0.0, 1.0), (1.0, 1.0, 1.0), (0.0, 1.0, 1.0)\n    ]\n    # Faces with outward pointing normals\n    case1_faces = [\n        # Bottom face (z=0, normal -k)\n        (v[0], v[2], v[1]), (v[0], v[3], v[2]),\n        # Top face (z=1, normal +k)\n        (v[4], v[5], v[6]), (v[4], v[6], v[7]),\n        # Front face (y=0, normal -j)\n        (v[0], v[1], v[5]), (v[0], v[5], v[4]),\n        # Back face (y=1, normal +j)\n        (v[3], v[6], v[2]), (v[3], v[7], v[6]),\n        # Left face (x=0, normal -i)\n        (v[0], v[4], v[7]), (v[0], v[7], v[3]),\n        # Right face (x=1, normal +i)\n        (v[1], v[2], v[6]), (v[1], v[6], v[5])\n    ]\n    r1_case1 = (0.2, 0.3, 0.4)\n    r2_case1 = (-1.0, -1.0, -1.0)\n\n    # Test Case 2: Tetrahedron\n    v_tet = [\n        (0.0, 0.0, 0.0), (1.0, 0.0, 0.0), (0.0, 1.0, 0.0), (0.0, 0.0, 1.0)\n    ]\n    # Faces with outward pointing normals\n    case2_faces = [\n        (v_tet[0], v_tet[2], v_tet[1]), # Bottom face, normal -k\n        (v_tet[0], v_tet[1], v_tet[3]), # Side face, normal -j\n        (v_tet[0], v_tet[3], v_tet[2]), # Side face, normal -i\n        (v_tet[1], v_tet[2], v_tet[3]), # Slanted top face\n    ]\n    r1_case2 = (0.0, 0.0, 0.0)\n    r2_case2 = (5.0, 5.0, 5.0)\n\n    # Test Case 3: L-shaped prism\n    p_base = [\n        (0.0, 0.0), (2.0, 0.0), (2.0, 1.0), (1.0, 1.0), (1.0, 2.0), (0.0, 2.0)\n    ]\n    v_lshape_bottom = [(x, y, 0.0) for x, y in p_base]\n    v_lshape_top = [(x, y, 1.0) for x, y in p_base]\n    \n    # Triangulation of L-shape base polygon using a fan from v0=(0,0,0)\n    case3_faces = [\n        # Bottom face (z=0, normal -k, CW)\n        (v_lshape_bottom[0], v_lshape_bottom[2], v_lshape_bottom[1]),\n        (v_lshape_bottom[0], v_lshape_bottom[3], v_lshape_bottom[2]),\n        (v_lshape_bottom[0], v_lshape_bottom[4], v_lshape_bottom[3]),\n        (v_lshape_bottom[0], v_lshape_bottom[5], v_lshape_bottom[4]),\n        # Top face (z=1, normal +k, CCW)\n        (v_lshape_top[0], v_lshape_top[1], v_lshape_top[2]),\n        (v_lshape_top[0], v_lshape_top[2], v_lshape_top[3]),\n        (v_lshape_top[0], v_lshape_top[3], v_lshape_top[4]),\n        (v_lshape_top[0], v_lshape_top[4], v_lshape_top[5]),\n    ]\n    # Side faces (6 rectangles -> 12 triangles)\n    for i in range(6):\n        p_curr_b = v_lshape_bottom[i]\n        p_next_b = v_lshape_bottom[(i + 1) % 6]\n        p_curr_t = v_lshape_top[i]\n        p_next_t = v_lshape_top[(i + 1) % 6]\n        \n        # CCW from outside gives outward normal\n        case3_faces.append((p_curr_b, p_next_b, p_next_t))\n        case3_faces.append((p_curr_b, p_next_t, p_curr_t))\n        \n    r1_case3 = (0.5, 0.5, 0.5)\n    r2_case3 = (10.0, -1.0, 0.0)\n\n    # Test Case 4: Open square patch\n    v_sq = [(0,0,0), (1,0,0), (1,1,0), (0,1,0)]\n    # Upward normal (+k)\n    case4_faces = [\n        (v_sq[0], v_sq[1], v_sq[2]),\n        (v_sq[0], v_sq[2], v_sq[3])\n    ]\n    r1_case4 = (0.0, 0.0, 1.0)\n    r2_case4 = (0.0, 0.0, -1.0)\n\n    test_cases = [\n        (case1_faces, r1_case1, r2_case1),\n        (case2_faces, r1_case2, r2_case2),\n        (case3_faces, r1_case3, r2_case3),\n        (case4_faces, r1_case4, r2_case4)\n    ]\n    \n    results = []\n    tolerance = 1e-10\n\n    for faces, r1, r2 in test_cases:\n        v1 = compute_volume(faces, r1)\n        v2 = compute_volume(faces, r2)\n        \n        v1_rounded = round(v1, 10)\n        v2_rounded = round(v2, 10)\n        \n        # Format -0.0 as 0.0\n        if v1_rounded == -0.0: v1_rounded = 0.0\n        if v2_rounded == -0.0: v2_rounded = 0.0\n\n        agree = abs(v1 - v2)  tolerance\n        \n        results.extend([f\"{v1_rounded:.10f}\", f\"{v2_rounded:.10f}\", str(agree)])\n\n    # Format the final string as required\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3303150"}, {"introduction": "在掌握了通用的体积计算方法后，我们将注意力转向其关键组成部分——单元面的面积。对于理想的几何形状，面积计算很简单，但当单元面发生扭曲或非平面时，精确计算其面积就变得至关重要。本实践 [@problem_id:3303160] 将引导你对比两种计算方法：一种是通过参数化曲面积分得到的精确面积，另一种是基于顶点坐标的简化代数近似。通过推导两者之间的相对偏差，你将深刻体会到，看似直观的几何近似公式可能引入不可忽略的系统性误差，这对于保证数值模拟的精度至关重要。", "problem": "在计算流体力学 (CFD) 中，一般六面体单元的面面积通常通过两种方式计算：一种是通过参数曲面积分进行精确计算，另一种是通过基于顶点位置的代数公式进行近似计算。考虑一个三线性六面体单元，其顶面位于平面 $z=0$ 上，顶点为\n$$\n\\mathbf{r}_{--}=(0,0,0),\\quad \\mathbf{r}_{+-}=(L,0,0),\\quad \\mathbf{r}_{++}=(L+\\alpha,H,0),\\quad \\mathbf{r}_{-+}=(\\alpha,H,0),\n$$\n其中 $L0$，$H0$ 且 $\\alpha\\neq 0$。该面是一个斜平面平行四边形，由标准的双线性曲面映射表示\n$$\n\\mathbf{x}(\\xi,\\eta)=\\sum_{i,j\\in\\{-1,+1\\}} \\mathbf{r}_{ij}\\,N_{ij}(\\xi,\\eta),\\quad N_{ij}(\\xi,\\eta)=\\frac{1}{4}(1+i\\xi)(1+j\\eta),\\quad (\\xi,\\eta)\\in[-1,1]^2,\n$$\n该映射是三线性六面体等参映射在该面上的限制。\n\n需要比较两种面面积的计算方法：\n- 由参数曲面积分基本定义的精确面积 $A_{\\mathrm{exact}}$\n$$\nA_{\\mathrm{exact}}=\\int_{-1}^{1}\\int_{-1}^{1} \\left\\|\\frac{\\partial\\mathbf{x}}{\\partial \\xi}(\\xi,\\eta)\\times \\frac{\\partial\\mathbf{x}}{\\partial \\eta}(\\xi,\\eta)\\right\\|\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta.\n$$\n- 边中点对角线叉积近似\n$$\nA_{\\mathrm{diag}}=\\frac{1}{2}\\left\\|\\mathbf{d}_1\\times \\mathbf{d}_2\\right\\|,\n$$\n其中 $\\mathbf{d}_1$ 是连接边 $\\mathbf{r}_{--}$ 到 $\\mathbf{r}_{+-}$ 的中点与边 $\\mathbf{r}_{-+}$ 到 $\\mathbf{r}_{++}$ 的中点的向量，而 $\\mathbf{d}_2$ 是连接边 $\\mathbf{r}_{+-}$ 到 $\\mathbf{r}_{++}$ 的中点与边 $\\mathbf{r}_{--}$ 到 $\\mathbf{r}_{-+}$ 的中点的向量。\n\n仅从上述定义和参数曲面的基本微分几何恒等式出发，计算此面的相对偏差\n$$\nB=\\frac{A_{\\mathrm{diag}}}{A_{\\mathrm{exact}}}-1\n$$\n结果表示为一个精确的数值。不需要四舍五入。最终答案必须是一个不带单位的实数。", "solution": "本问题要求计算一个六面体单元特定平面四边形面的相对偏差 $B = \\frac{A_{\\mathrm{diag}}}{A_{\\mathrm{exact}}} - 1$。为此，我们必须首先使用给定的参数曲面积分定义计算精确面积 $A_{\\mathrm{exact}}$，然后使用给定的代数公式计算近似面积 $A_{\\mathrm{diag}}$。\n\n首先，我们计算精确面积 $A_{\\mathrm{exact}}$。该曲面由双线性等参映射定义：\n$$\n\\mathbf{x}(\\xi,\\eta)=\\sum_{i,j\\in\\{-1,+1\\}} \\mathbf{r}_{ij}\\,N_{ij}(\\xi,\\eta) = \\frac{1}{4}\\sum_{i,j\\in\\{-1,+1\\}} \\mathbf{r}_{ij}(1+i\\xi)(1+j\\eta)\n$$\n其中 $(\\xi,\\eta) \\in [-1,1]^2$。顶点由下式给出：\n$$\n\\mathbf{r}_{--}=(0,0,0),\\quad \\mathbf{r}_{+-}=(L,0,0),\\quad \\mathbf{r}_{++}=(L+\\alpha,H,0),\\quad \\mathbf{r}_{-+}=(\\alpha,H,0)\n$$\n其中 $L0$，$H0$ 且 $\\alpha\\neq 0$。\n\n我们展开 $\\mathbf{x}(\\xi,\\eta)$ 的表达式：\n$$\n\\mathbf{x}(\\xi,\\eta) = \\frac{1}{4} \\left[ \\mathbf{r}_{--}(1-\\xi)(1-\\eta) + \\mathbf{r}_{+-}(1+\\xi)(1-\\eta) + \\mathbf{r}_{++}(1+\\xi)(1+\\eta) + \\mathbf{r}_{-+}(1-\\xi)(1+\\eta) \\right]\n$$\n由于 $\\mathbf{r}_{--}=(0,0,0)$，第一项为零。\n为计算面积分，我们需要求 $\\mathbf{x}(\\xi,\\eta)$ 关于 $\\xi$ 和 $\\eta$ 的偏导数。\n\n关于 $\\xi$ 的偏导数是：\n$$\n\\frac{\\partial\\mathbf{x}}{\\partial \\xi} = \\frac{1}{4} \\left[ -\\mathbf{r}_{--}(1-\\eta) + \\mathbf{r}_{+-}(1-\\eta) + \\mathbf{r}_{++}(1+\\eta) - \\mathbf{r}_{-+}(1+\\eta) \\right]\n$$\n$$\n\\frac{\\partial\\mathbf{x}}{\\partial \\xi} = \\frac{1}{4} \\left[ (\\mathbf{r}_{+-}-\\mathbf{r}_{--})(1-\\eta) + (\\mathbf{r}_{++}-\\mathbf{r}_{-+})(1+\\eta) \\right]\n$$\n我们计算表示四边形边的向量：\n$$\n\\mathbf{r}_{+-}-\\mathbf{r}_{--} = (L,0,0)-(0,0,0) = (L,0,0)\n$$\n$$\n\\mathbf{r}_{++}-\\mathbf{r}_{-+} = (L+\\alpha,H,0)-(\\alpha,H,0) = (L,0,0)\n$$\n将这些代入 $\\frac{\\partial\\mathbf{x}}{\\partial \\xi}$ 的表达式中：\n$$\n\\frac{\\partial\\mathbf{x}}{\\partial \\xi} = \\frac{1}{4} \\left[ (L,0,0)(1-\\eta) + (L,0,0)(1+\\eta) \\right] = \\frac{1}{4} (L,0,0)(1-\\eta+1+\\eta) = \\frac{1}{4}(L,0,0)(2) = \\left(\\frac{L}{2}, 0, 0\\right)\n$$\n\n关于 $\\eta$ 的偏导数是：\n$$\n\\frac{\\partial\\mathbf{x}}{\\partial \\eta} = \\frac{1}{4} \\left[ -\\mathbf{r}_{--}(1-\\xi) - \\mathbf{r}_{+-}(1+\\xi) + \\mathbf{r}_{++}(1+\\xi) + \\mathbf{r}_{-+}(1-\\xi) \\right]\n$$\n$$\n\\frac{\\partial\\mathbf{x}}{\\partial \\eta} = \\frac{1}{4} \\left[ (\\mathbf{r}_{-+}-\\mathbf{r}_{--})(1-\\xi) + (\\mathbf{r}_{++}-\\mathbf{r}_{+-})(1+\\xi) \\right]\n$$\n我们计算另一对边的向量：\n$$\n\\mathbf{r}_{-+}-\\mathbf{r}_{--} = (\\alpha,H,0)-(0,0,0) = (\\alpha,H,0)\n$$\n$$\n\\mathbf{r}_{++}-\\mathbf{r}_{+-} = (L+\\alpha,H,0)-(L,0,0) = (\\alpha,H,0)\n$$\n将这些代入 $\\frac{\\partial\\mathbf{x}}{\\partial \\eta}$ 的表达式中：\n$$\n\\frac{\\partial\\mathbf{x}}{\\partial \\eta} = \\frac{1}{4} \\left[ (\\alpha,H,0)(1-\\xi) + (\\alpha,H,0)(1+\\xi) \\right] = \\frac{1}{4} (\\alpha,H,0)(1-\\xi+1+\\xi) = \\frac{1}{4}(\\alpha,H,0)(2) = \\left(\\frac{\\alpha}{2}, \\frac{H}{2}, 0\\right)\n$$\n切向量是常数，这证实了该曲面是平面的。现在我们计算它们的叉积：\n$$\n\\frac{\\partial\\mathbf{x}}{\\partial \\xi} \\times \\frac{\\partial\\mathbf{x}}{\\partial \\eta} = \\left(\\frac{L}{2}, 0, 0\\right) \\times \\left(\\frac{\\alpha}{2}, \\frac{H}{2}, 0\\right) = \\begin{vmatrix} \\mathbf{i}  \\mathbf{j}  \\mathbf{k} \\\\ \\frac{L}{2}  0  0 \\\\ \\frac{\\alpha}{2}  \\frac{H}{2}  0 \\end{vmatrix} = \\left(0, 0, \\frac{L}{2}\\frac{H}{2} - 0\\right) = \\left(0, 0, \\frac{LH}{4}\\right)\n$$\n该向量的模是：\n$$\n\\left\\|\\frac{\\partial\\mathbf{x}}{\\partial \\xi} \\times \\frac{\\partial\\mathbf{x}}{\\partial \\eta}\\right\\| = \\left|\\frac{LH}{4}\\right| = \\frac{LH}{4}\n$$\n因为 $L0$ 且 $H0$。被积函数是常数。\n精确面积 $A_{\\mathrm{exact}}$ 是在参数域上的积分：\n$$\nA_{\\mathrm{exact}} = \\int_{-1}^{1}\\int_{-1}^{1} \\frac{LH}{4}\\,\\mathrm{d}\\xi\\,\\mathrm{d}\\eta = \\frac{LH}{4} \\int_{-1}^{1}\\mathrm{d}\\xi \\int_{-1}^{1}\\mathrm{d}\\eta = \\frac{LH}{4} \\cdot (2) \\cdot (2) = LH\n$$\n\n接下来，我们计算近似面积 $A_{\\mathrm{diag}}$。这需要计算向量 $\\mathbf{d}_1$ 和 $\\mathbf{d}_2$。\n$\\mathbf{d}_1$ 是连接边 $\\mathbf{r}_{--}$ 到 $\\mathbf{r}_{+-}$ 的中点与边 $\\mathbf{r}_{-+}$ 到 $\\mathbf{r}_{++}$ 的中点的向量。\n设 $M_1$ 是边 $(\\mathbf{r}_{--}, \\mathbf{r}_{+-})$ 的中点，$M_3$ 是边 $(\\mathbf{r}_{-+}, \\mathbf{r}_{++})$ 的中点。\n$$\nM_1 = \\frac{1}{2}(\\mathbf{r}_{--} + \\mathbf{r}_{+-}) = \\frac{1}{2}((0,0,0) + (L,0,0)) = \\left(\\frac{L}{2}, 0, 0\\right)\n$$\n$$\nM_3 = \\frac{1}{2}(\\mathbf{r}_{-+} + \\mathbf{r}_{++}) = \\frac{1}{2}((\\alpha,H,0) + (L+\\alpha,H,0)) = \\left(\\frac{L+2\\alpha}{2}, H, 0\\right)\n$$\n因此，$\\mathbf{d}_1 = M_3 - M_1$：\n$$\n\\mathbf{d}_1 = \\left(\\frac{L+2\\alpha}{2}, H, 0\\right) - \\left(\\frac{L}{2}, 0, 0\\right) = \\left(\\frac{L+2\\alpha-L}{2}, H, 0\\right) = (\\alpha, H, 0)\n$$\n\n$\\mathbf{d}_2$ 是连接边 $\\mathbf{r}_{+-}$ 到 $\\mathbf{r}_{++}$ 的中点与边 $\\mathbf{r}_{--}$ 到 $\\mathbf{r}_{-+}$ 的中点的向量。\n设 $M_2$ 是边 $(\\mathbf{r}_{+-}, \\mathbf{r}_{++})$ 的中点，$M_4$ 是边 $(\\mathbf{r}_{--}, \\mathbf{r}_{-+})$ 的中点。\n$$\nM_2 = \\frac{1}{2}(\\mathbf{r}_{+-} + \\mathbf{r}_{++}) = \\frac{1}{2}((L,0,0) + (L+\\alpha,H,0)) = \\left(\\frac{2L+\\alpha}{2}, \\frac{H}{2}, 0\\right)\n$$\n$$\nM_4 = \\frac{1}{2}(\\mathbf{r}_{--} + \\mathbf{r}_{-+}) = \\frac{1}{2}((0,0,0) + (\\alpha,H,0)) = \\left(\\frac{\\alpha}{2}, \\frac{H}{2}, 0\\right)\n$$\n因此，$\\mathbf{d}_2 = M_4 - M_2$：\n$$\n\\mathbf{d}_2 = \\left(\\frac{\\alpha}{2}, \\frac{H}{2}, 0\\right) - \\left(\\frac{2L+\\alpha}{2}, \\frac{H}{2}, 0\\right) = \\left(\\frac{\\alpha-(2L+\\alpha)}{2}, \\frac{H-H}{2}, 0\\right) = (-L, 0, 0)\n$$\n\n现在我们为 $A_{\\mathrm{diag}}$ 计算叉积：\n$$\n\\mathbf{d}_1 \\times \\mathbf{d}_2 = (\\alpha, H, 0) \\times (-L, 0, 0) = \\begin{vmatrix} \\mathbf{i}  \\mathbf{j}  \\mathbf{k} \\\\ \\alpha  H  0 \\\\ -L  0  0 \\end{vmatrix} = (0, 0, \\alpha \\cdot 0 - H(-L)) = (0, 0, LH)\n$$\n近似面积是该向量模的一半：\n$$\nA_{\\mathrm{diag}} = \\frac{1}{2}\\left\\|\\mathbf{d}_1 \\times \\mathbf{d}_2\\right\\| = \\frac{1}{2}\\left\\|(0, 0, LH)\\right\\| = \\frac{1}{2}LH\n$$\n\n最后，我们计算相对偏差 $B$：\n$$\nB = \\frac{A_{\\mathrm{diag}}}{A_{\\mathrm{exact}}} - 1 = \\frac{\\frac{1}{2}LH}{LH} - 1 = \\frac{1}{2} - 1 = -\\frac{1}{2}\n$$\n相对偏差是一个常数值，与几何参数 $L$、$H$ 和 $\\alpha$ 无关。", "answer": "$$\\boxed{-\\frac{1}{2}}$$", "id": "3303160"}, {"introduction": "几何计算的最终目的是服务于物理模型的精确求解。本节实践将几何计算与CFD应用直接联系起来，探讨网格质量对模拟结果的实际影响。本练习 [@problem_id:3303108] 聚焦于一个关键的网格质量指标——非正交性，并分析它如何给有限体积法中扩散通量的计算带来误差。通过推导误差的解析表达式，你将定量地理解为什么高质量的网格（特别是正交性好的网格）对于获得可靠的CFD模拟结果是不可或缺的。", "problem": "在采用有限体积法 (FVM) 的计算流体力学 (CFD) 离散化中，两个凸控制体 $P$ 和 $N$ 共享一个面积为 $A_f$ 的平面单元面 $f$。设单元面单位法向量为 $\\boldsymbol{n}_f$，其方向由 $P$ 指向 $N$。单元中心的位置分别为 $\\boldsymbol{r}_P$ 和 $\\boldsymbol{r}_N$，连接单元中心的向量为 $\\boldsymbol{d} = \\boldsymbol{r}_N - \\boldsymbol{r}_P$，其长度为 $d = \\|\\boldsymbol{d}\\|$。定义 $\\boldsymbol{d}$ 和 $\\boldsymbol{n}_f$ 之间的非正交角 $\\theta_f \\in [0,\\pi]$ 为 $\\cos\\theta_f = (\\boldsymbol{d}\\cdot \\boldsymbol{n}_f)/d$。考虑一个标量场 $\\phi$ 的稳态各向同性扩散，其扩散系数 $\\Gamma$ 为常数，并且 $\\phi$ 在这两个单元间是局部线性的，因此有 $\\phi_P = \\phi(\\boldsymbol{r}_P)$ 和 $\\phi_N = \\phi(\\boldsymbol{r}_N)$。\n\n从通过单元面的扩散通量定义 $F_f = -\\Gamma A_f \\left(\\nabla \\phi \\cdot \\boldsymbol{n}_f\\right)$ 出发，考虑一种常见的两点近似方法，该方法用基于两个单元中心值的差商来代替法向导数。单元中心之间沿面法向的距离为 $d_n = \\boldsymbol{d}\\cdot \\boldsymbol{n}_f = d \\cos\\theta_f$。精确的两点法向差分表示会在分母中使用 $d_n$，而一种常用的近似方法则用单元中心间的直线距离 $d$ 来代替 $d_n$。\n\n请仅根据这些定义和几何关系，推导在基于 $(\\phi_N - \\phi_P)$ 的两点通量公式中用 $d$ 代替 $d_n$ 所引入的通过单元面 $f$ 的扩散通量的绝对误差的闭式表达式。最终答案应仅用 $A_f$、$\\Gamma$、$d$、$\\theta_f$ 和 $(\\phi_N - \\phi_P)$ 表示，并明确显示单元面面积和非正交性如何影响误差。请以单一的闭式符号表达式给出您的答案；不要代入任何数值，也不要包含单位。", "solution": "任务是推导在一个两点通量近似中，当使用单元中心直线距离 $d$ 代替沿面法向的距离 $d_n$ 时，通过单元面 $f$ 的扩散通量的绝对误差的闭式表达式。\n\n设通过单元面 $f$ 的扩散通量表示为 $F_f$。问题陈述为此通量提供了两种不同的两点近似。\n\n首先，我们定义参考通量计算，问题中称之为“精确的两点法向差分表示”。我们将此通量表示为 $F_{\\text{ref}}$，它在梯度有限差分商的分母中使用沿面法向的距离 $d_n$：\n$$\nF_{\\text{ref}} = -\\Gamma A_f \\left( \\frac{\\phi_N - \\phi_P}{d_n} \\right)\n$$\n此处，$\\Gamma$ 是常数扩散系数，$A_f$ 是单元面 $f$ 的面积，$(\\phi_N - \\phi_P)$ 是相邻单元 $N$ 和 $P$ 中心处标量值 $\\phi$ 的差值。项 $d_n$ 是连接单元中心向量 $\\boldsymbol{d}$ 在面法向 $\\boldsymbol{n}_f$ 上的分量，由 $d_n = \\boldsymbol{d} \\cdot \\boldsymbol{n}_f$ 给出。\n\n其次，我们定义近似通量，表示为 $F_{\\text{approx}}$，它用单元中心间的直线距离 $d = \\|\\boldsymbol{d}\\|$ 来代替 $d_n$：\n$$\nF_{\\text{approx}} = -\\Gamma A_f \\left( \\frac{\\phi_N - \\phi_P}{d} \\right)\n$$\n\n由此近似引入的绝对误差 $E$ 是 $F_{\\text{approx}}$ 和 $F_{\\text{ref}}$ 之差的绝对值：\n$$\nE = |F_{\\text{approx}} - F_{\\text{ref}}|\n$$\n代入两种通量的表达式：\n$$\nE = \\left| \\left(-\\Gamma A_f \\frac{\\phi_N - \\phi_P}{d}\\right) - \\left(-\\Gamma A_f \\frac{\\phi_N - \\phi_P}{d_n}\\right) \\right|\n$$\n我们可以提取公因式 $-\\Gamma A_f (\\phi_N - \\phi_P)$：\n$$\nE = \\left| -\\Gamma A_f (\\phi_N - \\phi_P) \\left( \\frac{1}{d} - \\frac{1}{d_n} \\right) \\right|\n$$\n由于扩散系数 $\\Gamma$ 和单元面面积 $A_f$ 是正的物理量，我们可以将它们移到绝对值符号之外：\n$$\nE = \\Gamma A_f \\left| (\\phi_N - \\phi_P) \\left( \\frac{1}{d_n} - \\frac{1}{d} \\right) \\right|\n$$\n现在，我们使用问题陈述中提供的几何关系，该关系将 $d_n$、$d$ 和非正交角 $\\theta_f$ 联系起来：\n$$\nd_n = d \\cos\\theta_f\n$$\n将此关系代入误差表达式中：\n$$\nE = \\Gamma A_f \\left| (\\phi_N - \\phi_P) \\left( \\frac{1}{d \\cos\\theta_f} - \\frac{1}{d} \\right) \\right|\n$$\n我们可以从括号中提取项 $1/d$：\n$$\nE = \\Gamma A_f \\left| \\frac{\\phi_N - \\phi_P}{d} \\left( \\frac{1}{\\cos\\theta_f} - 1 \\right) \\right|\n$$\n注意到 $1/\\cos\\theta_f = \\sec\\theta_f$，表达式简化为：\n$$\nE = \\frac{\\Gamma A_f}{d} \\left| (\\phi_N - \\phi_P) (\\sec\\theta_f - 1) \\right|\n$$\n这就是绝对误差的最终闭式表达式。\n\n该表达式明确显示了误差如何依赖于单元面面积和非正交性。误差与单元面面积 $A_f$ 成正比。非正交性的影响由项 $|\\sec\\theta_f - 1|$ 体现。在正交网格中，连接单元中心的向量 $\\boldsymbol{d}$ 与面法向 $\\boldsymbol{n}_f$ 对齐，此时角度 $\\theta_f = 0$。在这种情况下，$\\cos\\theta_f = 1$ 且 $\\sec\\theta_f = 1$，这使得误差项为零，正如预期的那样，因为 $d = d_n$。随着非正交性增加，$\\theta_f$ 偏离 $0$，项 $|\\sec\\theta_f - 1|$ 增大，表明近似误差增加。当 $\\theta_f \\to \\pi/2$ 时，参考通量的分母 $d_n$ 趋近于零，误差变为奇异的。这种奇异性突显了在极端非正交情况下，两点通量格式的基本假设的失效。", "answer": "$$\n\\boxed{\\frac{\\Gamma A_f}{d} \\left| (\\phi_N - \\phi_P) (\\sec\\theta_f - 1) \\right|}\n$$", "id": "3303108"}]}