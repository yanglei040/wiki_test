{"hands_on_practices": [{"introduction": "第一个练习提供了对局部时间步进（LTS）的基本认识。通过分析一个简单的一维线性平流问题，你将从CFL条件推导出局部时间步长，并了解由此产生的格式如何被解释为经典的加权雅可比迭代。这个练习巩固了求解稳态问题的时间推进法与迭代线性代数之间的联系，揭示了LTS加速收敛的内在机制 [@problem_id:3341489]。", "problem": "考虑具有恒定平流速度 $a>0$ 的一维线性平流方程，\n$$\n\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0,\n$$\n该方程在三个长度分别为 $\\Delta x_1$、$\\Delta x_2$ 和 $\\Delta x_3$ 的连续控制体（单元）上通过有限体积法进行离散。假设采用与 $a>0$ 一致的一阶迎风数值通量，并在左边界施加入流狄利克雷边界条件。令 $u_i(t)$ 表示单元 $i$ 中的单元平均值。单元 $i$ 中的半离散残差是其各个面上数值通量的差值。为将解推向稳态，考虑采用具有单元局部时间步长 $\\Delta t_i$ 的显式前向欧拉伪时间推进：\n$$\nu_i^{n+1} \\;=\\; u_i^n \\;-\\; \\frac{\\Delta t_i}{\\Delta x_i}\\, R_i\\!\\left(u^n\\right),\n$$\n其中 $R_i(u)$ 是有限体积残差，$\\Delta x_i$ 是一维情况下的单元体积。\n\n从基本原理（使用迎风通量且 $a>0$ 的线性平流方程的有限体积平衡）出发，推导残差 $R_i(u)$，然后使用库朗-弗里德里希斯-列维 (CFL) 稳定性准则，并选择一个库朗-弗里德里希斯-列维 (CFL) 数 $C \\in (0,1]$，来确定以 $(\\Delta x_i, a, C)$ 表示的局部时间步长 $\\Delta t_i$。利用该迭代对应的线性误差传播形式，将此伪时间步进建模为稳态线性系统的加权雅可比松弛，并以 $C$ 来估计单次伪时间迭代的收缩因子 $\\rho$。\n\n将时间步长以秒为单位表示，收缩因子表示为无量纲小数。以单行矩阵的形式提供您的最终答案，其中按顺序包含 $\\Delta t_1$、$\\Delta t_2$、$\\Delta t_3$ 和 $\\rho$。无需对 $(\\Delta x_i, a, C)$ 进行数值代入。最终答案必须是单一的解析表达式。", "solution": "首先验证该问题，以确保其在科学上是合理的、适定的和客观的。\n\n给定条件如下：\n- 控制方程：$\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0$，具有恒定平流速度 $a>0$。\n- 空间离散：在三个长度分别为 $\\Delta x_1$、$\\Delta x_2$、$\\Delta x_3$ 的连续单元上采用有限体积法。\n- 数值通量：一阶迎风，与 $a>0$ 一致。\n- 边界条件：左边界为入流狄利克雷条件。\n- 时间离散（伪时间）：采用单元局部时间步长 $\\Delta t_i$ 的显式前向欧拉法。\n- 更新公式：$u_i^{n+1} = u_i^n - \\frac{\\Delta t_i}{\\Delta x_i} R_i(u^n)$，其中 $u_i$ 是单元平均值，$R_i(u)$ 是有限体积残差。\n- 稳定性准则：使用库朗-弗里德里希斯-列维 (CFL) 条件，CFL 数 $C \\in (0,1]$。\n\n该问题具有科学依据，是对一个基本偏微分方程数值方法的标准分析。它是适定的，有足够的信息来推导所要求的量。术语精确客观。因此，该问题被认为是有效的。\n\n求解过程分三步：推导残差 $R_i$，确定局部时间步长 $\\Delta t_i$，以及估计收缩因子 $\\rho$。\n\n步骤 1：推导残差 $R_i(u)$\n将有限体积法应用于一维守恒律 $\\frac{\\partial u}{\\partial t} + \\frac{\\partial f(u)}{\\partial x} = 0$ 在长度为 $\\Delta x_i = x_{i+1/2} - x_{i-1/2}$ 的控制体（单元）$\\Omega_i = [x_{i-1/2}, x_{i+1/2}]$ 上，可得：\n$$\n\\frac{d}{dt} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t) \\,dx + f(u(x_{i+1/2},t)) - f(u(x_{i-1/2},t)) = 0\n$$\n定义单元平均值 $u_i(t) = \\frac{1}{\\Delta x_i} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t) \\,dx$，方程变为：\n$$\n\\Delta x_i \\frac{du_i}{dt} + F_{i+1/2} - F_{i-1/2} = 0\n$$\n其中 $F_{i \\pm 1/2}$ 是单元交界面上的数值通量。线性平流方程的物理通量是 $f(u) = au$。半离散形式为：\n$$\n\\frac{du_i}{dt} = -\\frac{1}{\\Delta x_i} (F_{i+1/2} - F_{i-1/2})\n$$\n问题给出的显式欧拉时间推进格式为 $u_i^{n+1} = u_i^n - \\frac{\\Delta t_i}{\\Delta x_i} R_i(u^n)$。将时间导数近似为 $\\frac{du_i}{dt} \\approx \\frac{u_i^{n+1}-u_i^n}{\\Delta t_i}$（针对单个单元的更新），我们可以将半离散形式与更新公式联系起来：\n$$\nu_i^{n+1} - u_i^n \\approx - \\frac{\\Delta t_i}{\\Delta x_i} (F_{i+1/2} - F_{i-1/2})\n$$\n将其与给定的更新公式进行比较，我们确定残差 $R_i(u)$ 为数值通量之差：\n$$\nR_i(u) = F_{i+1/2} - F_{i-1/2}\n$$\n问题指定了 $a>0$ 时的一阶迎风通量。这意味着交界面上的通量由该交界面上游（左侧）单元的状态确定。\n对于单元 $i$ 和 $i+1$ 之间的交界面 $x_{i+1/2}$，上游单元是单元 $i$。因此，数值通量为 $F_{i+1/2} = f(u_i) = a u_i$。\n对于单元 $i-1$ 和 $i$ 之间的交界面 $x_{i-1/2}$，上游单元是单元 $i-1$。因此，数值通量为 $F_{i-1/2} = f(u_{i-1}) = a u_{i-1}$。\n内部单元 $i$ 的残差为：\n$$\nR_i(u) = a u_i - a u_{i-1} = a(u_i - u_{i-1})\n$$\n该系统由三个单元组成，$i=1, 2, 3$。对于第一个单元 $i=1$，左边界是入流狄利克雷边界。设其值为 $u_L$。该值决定了 $x_{1/2}$ 交界面处通量计算的状态，实际上充当了 $u_0$ 的角色。所以，$F_{1/2} = a u_L$。这三个单元的残差为：\n$R_1(u) = F_{3/2} - F_{1/2} = a u_1 - a u_L = a(u_1 - u_L)$\n$R_2(u) = F_{5/2} - F_{3/2} = a u_2 - a u_1 = a(u_2 - u_1)$\n$R_3(u) = F_{7/2} - F_{5/2} = a u_3 - a u_2 = a(u_3 - u_2)$\n\n步骤 2：确定局部时间步长 $\\Delta t_i$\n将推导出的残差代入给定的更新公式：\n$$\nu_i^{n+1} = u_i^n - \\frac{\\Delta t_i}{\\Delta x_i} a (u_i^n - u_{i-1}^n)\n$$\n对 $u_i^{n+1}$ 的项进行重新排列：\n$$\nu_i^{n+1} = \\left(1 - \\frac{a \\Delta t_i}{\\Delta x_i}\\right) u_i^n + \\frac{a \\Delta t_i}{\\Delta x_i} u_{i-1}^n\n$$\n这是一阶显式迎风格式的更新方程。为使该格式稳定（例如，满足正定性条件，确保不产生新的极值），右侧状态的系数必须为非负。这要求：\n$$\n1 - \\frac{a \\Delta t_i}{\\Delta x_i} \\ge 0 \\implies \\frac{a \\Delta t_i}{\\Delta x_i} \\le 1\n$$\n这就是库朗-弗里德里希斯-列维 (CFL) 稳定性条件。量 $\\frac{a \\Delta t_i}{\\Delta x_i}$ 是局部库朗数。问题指出，选择一个 CFL 数 $C \\in (0,1]$ 来设定时间步长。这意味着我们将每个单元的局部库朗数设为此值 $C$：\n$$\n\\frac{a \\Delta t_i}{\\Delta x_i} = C\n$$\n求解局部时间步长 $\\Delta t_i$ 可得：\n$$\n\\Delta t_i = \\frac{C \\Delta x_i}{a}\n$$\n将此应用于三个单元中的每一个，我们得到：\n$\\Delta t_1 = \\frac{C \\Delta x_1}{a}$\n$\\Delta t_2 = \\frac{C \\Delta x_2}{a}$\n$\\Delta t_3 = \\frac{C \\Delta x_3}{a}$\n\n步骤 3：估计收缩因子 $\\rho$\n伪时间步进是求解稳态解的一种迭代方法，稳态解由 $\\frac{\\partial u}{\\partial t} = 0$ 定义。这意味着半离散残差必须为零：$R_i(u) = 0$。\n稳态线性系统为：\n$a(u_1 - u_L) = 0$\n$a(u_2 - u_1) = 0$\n$a(u_3 - u_2) = 0$\n解为 $u_1 = u_2 = u_3 = u_L$。\n求解该系统的迭代格式由更新公式给出，其中 $\\frac{a \\Delta t_i}{\\Delta x_i} = C$：\n$u_1^{n+1} = (1-C) u_1^n + C u_L$\n$u_2^{n+1} = (1-C) u_2^n + C u_1^n$\n$u_3^{n+1} = (1-C) u_3^n + C u_2^n$\n该系统可以写成矩阵形式 $\\mathbf{u}^{n+1} = G \\mathbf{u}^n + \\mathbf{c}$，其中 $\\mathbf{u}^n = [u_1^n, u_2^n, u_3^n]^T$：\n$$\n\\begin{pmatrix} u_1^{n+1} \\\\ u_2^{n+1} \\\\ u_3^{n+1} \\end{pmatrix} =\n\\begin{pmatrix} 1-C  0  0 \\\\ C  1-C  0 \\\\ 0  C  1-C \\end{pmatrix}\n\\begin{pmatrix} u_1^n \\\\ u_2^n \\\\ u_3^n \\end{pmatrix} +\n\\begin{pmatrix} C u_L \\\\ 0 \\\\ 0 \\end{pmatrix}\n$$\n矩阵 $G$ 是迭代矩阵。迭代的收敛速率由 $G$ 的谱半径决定，即收缩因子 $\\rho$。\n$$\nG = \\begin{pmatrix} 1-C  0  0 \\\\ C  1-C  0 \\\\ 0  C  1-C \\end{pmatrix}\n$$\n由于 $G$ 是一个下三角矩阵，其特征值是其对角线元素。\n$$\n\\lambda_1 = \\lambda_2 = \\lambda_3 = 1-C\n$$\n谱半径 $\\rho(G)$ 是特征值绝对值的最大值：\n$$\n\\rho = \\rho(G) = \\max_i |\\lambda_i| = |1-C|\n$$\n问题指定 $C \\in (0, 1]$。对于此范围的 $C$，$1-C$ 的值在 $[0, 1)$ 范围内。因此，$|1-C| = 1-C$。\n收缩因子为：\n$$\n\\rho = 1-C\n$$\n该格式是用于稳态系统的加权雅可比迭代，松弛因子为 $\\omega = C$。对于任何 $C \\in (0,1)$，迭代都收敛，并且当 $C \\to 1$ 时收敛最快，此时 $\\rho \\to 0$。\n\n最终答案汇总\n所需的量是 $\\Delta t_1$、$\\Delta t_2$、$\\Delta t_3$ 和 $\\rho$。\n$\\Delta t_1 = \\frac{C \\Delta x_1}{a}$\n$\\Delta t_2 = \\frac{C \\Delta x_2}{a}$\n$\\Delta t_3 = \\frac{C \\Delta x_3}{a}$\n$\\rho = 1-C$\n根据要求，将这些量组合成一个单行矩阵。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{C \\Delta x_1}{a}  \\frac{C \\Delta x_2}{a}  \\frac{C \\Delta x_3}{a}  1 - C \\end{pmatrix}}\n$$", "id": "3341489"}, {"introduction": "在基础之上，我们现在探讨将局部时间步进与更高级的时间积分格式相结合，特别是强稳定性保持（SSP）龙格-库塔方法。这个问题要求你推导在使用逐单元时间步长时，为保持关键的SSP性质所必须满足的条件，这对于确保含有激波或其他间断的模拟的数值稳定性至关重要 [@problem_id:3341502]。这一分析突显了在实践中应用高阶LTS方法时必须遵循的理论约束。", "problem": "考虑计算流体动力学 (CFD) 中非线性双曲守恒律的一种半离散形式，对每个网格单元按分量写成如下的常微分方程组\n$$\n\\frac{d u_{i}}{d t} = L_{i}\\!\\left(u\\right),\n$$\n其中 $u$ 表示所有网格单元平均解值的向量，$L_{i}$ 是为网格单元 $i$ 构建的空间离散算子，该算子使用单调通量构建，从而使得前向欧拉 (FE) 时间步进在逐网格单元的稳定性界限下是可允许的。假设将 FE 方法应用于整个半离散系统，并采用逐网格单元的时间步长 $\\tau_{i}$，在选定的单调范数或半范数（例如，总变差或正性范数）中是强稳定的，只要\n$$\n0 \\le \\tau_{i} \\le \\Delta t_{\\mathrm{FE},i},\n$$\n其中 $\\Delta t_{\\mathrm{FE},i} > 0$ 表示在给定的空间离散和当前阶段状态下，网格单元 $i$ 的最大允许 FE 步长。\n\n我们希望通过局部时间步进加速收敛到稳态：应用一种强稳定性保持 (SSP) 三阶三级龙格-库塔方法，记为 SSP(3,3)，其逐网格单元的时间步长为 $\\Delta t_{i}$，并在所有网格单元间进行阶段同步。SSP(3,3) 方法的 Shu–Osher 形式更新如下：\n- 阶段 1：\n$$\nu^{(1)} = u^{n} + \\Delta t \\, L\\!\\left(u^{n}\\right),\n$$\n- 阶段 2：\n$$\nu^{(2)} = \\frac{3}{4}\\,u^{n} + \\frac{1}{4}\\left(u^{(1)} + \\Delta t \\, L\\!\\left(u^{(1)}\\right)\\right),\n$$\n- 阶段 3 (解更新)：\n$$\nu^{n+1} = u^{(3)} = \\frac{1}{3}\\,u^{n} + \\frac{2}{3}\\left(u^{(2)} + \\Delta t \\, L\\!\\left(u^{(2)}\\right)\\right).\n$$\n\n在局部时间步进下，将 $\\Delta t$ 按分量进行解释，以便对于每个网格单元 $i$，每个阶段中的类 FE 增量均使用 $\\Delta t_{i}$。为使 SSP 成立，对于每个网格单元 $i$，每个阶段必须能表示为 FE 步 $u_{i}^{(m)} + \\tau_{i}^{(m)} L_{i}\\!\\left(u^{(m)}\\right)$ 的凸组合，其非负权重之和为一，并且每个 $\\tau_{i}^{(m)}$ 都是可允许的，即 $0 \\le \\tau_{i}^{(m)} \\le \\Delta t_{\\mathrm{FE},i}$。\n\n(a) 对固定的网格单元索引 $i$，重写 SSP(3,3) 的各个阶段，使得每个阶段 $u_{i}^{(k)}$ 都明确表示为 FE 步的凸组合，并指出出现的所有逐网格单元的 FE 子步 $\\tau_{i}^{(m)}$。\n\n(b) 根据此表达式，推导关于 $\\Delta t_{i}$ 的必要且充分的逐网格单元不等式，以确保每个阶段对于网格单元 $i$ 而言都保持为可允许 FE 步的凸组合。\n\n(c) 假设选择对局部 FE 界限进行均匀缩放 $\\Delta t_{i} = s \\, \\Delta t_{\\mathrm{FE},i}$，其中标量 $s \\in \\mathbb{R}$ 对所有网格单元都相同。确定最大允许缩放因子 $s_{\\max}$，使得采用局部时间步进的 SSP(3,3) 方法在所述意义下保持 SSP。将最终的缩放因子表示为一个精确的数值（无量纲）。\n\n(d) 在不改变所要求的计算的情况下，简要讨论在一个多网格单元 CFD 计算中满足所推导约束的实际可行性，其中 $L_{i}$ 耦合了相邻网格单元，并考虑局部时间步进下的阶段同步和界面通量一致性。", "solution": "该问题要求分析一种三阶强稳定性保持 (SSP) 龙格-库塔方法 SSP(3,3)，该方法采用局部时间步进应用于由非线性双曲守恒律的半离散化产生的常微分方程组 (ODEs)。分析将按要求分四个部分进行。\n\n半离散系统对每个网格单元 $i$ 给出如下：\n$$\n\\frac{d u_{i}}{d t} = L_{i}\\!\\left(u\\right)\n$$\n其中 $u$ 是所有网格单元平均解的向量。对于时间步长 $\\tau_i$，只要满足 $0 \\le \\tau_{i} \\le \\Delta t_{\\mathrm{FE},i}$，前向欧拉 (FE) 方法就是强稳定的，其中 $\\Delta t_{\\mathrm{FE},i}$ 是在当前状态下网格单元 $i$ 的最大允许 FE 步长。SSP 性质依赖于将龙格-库塔方法的每个阶段分解为一系列可允许 FE 步的凸组合。\n\nSSP(3,3) 方法以 Shu-Osher 形式给出：\n- 阶段 1：$u^{(1)} = u^{n} + \\Delta t \\, L\\!\\left(u^{n}\\right)$\n- 阶段 2：$u^{(2)} = \\frac{3}{4}\\,u^{n} + \\frac{1}{4}\\left(u^{(1)} + \\Delta t \\, L\\!\\left(u^{(1)}\\right)\\right)$\n- 阶段 3：$u^{n+1} = u^{(3)} = \\frac{1}{3}\\,u^{n} + \\frac{2}{3}\\left(u^{(2)} + \\Delta t \\, L\\!\\left(u^{(2)}\\right)\\right)$\n\n在局部时间步进的背景下，全局的 $\\Delta t$ 被依赖于网格单元的 $\\Delta t_i$ 所取代。\n\n**(a) 将各阶段重写为 FE 步的显式凸组合，并确定 FE 子步**\n\nSSP 性质由 Shu-Osher 形式的结构保证，该结构将每个阶段的更新表示为先前阶段结果和类 FE 步的凸组合。从状态 $w_i$ 开始的一个 FE 步定义为 $w_i + \\tau_i L_i(w)$。\n\n- **阶段 1：** 对于网格单元 $i$，更新为：\n$$\nu_{i}^{(1)} = u_{i}^{n} + \\Delta t_{i} L_{i}\\!\\left(u^{n}\\right)\n$$\n这已经是自 $u_i^n$ 开始的单个 FE 步的形式。我们可以将其表示为一个只有一个项且权重为 $1$ 的平凡凸组合：\n$$\nu_{i}^{(1)} = 1 \\cdot \\left( u_{i}^{n} + \\tau_{i}^{(0)} L_{i}\\!\\left(u^{n}\\right) \\right)\n$$\n逐网格单元的 FE 子步是 $\\tau_{i}^{(0)} = \\Delta t_{i}$。\n\n- **阶段 2：** 对于网格单元 $i$，更新为：\n$$\nu_{i}^{(2)} = \\frac{3}{4}\\,u_{i}^{n} + \\frac{1}{4}\\left(u_{i}^{(1)} + \\Delta t_{i} L_{i}\\!\\left(u^{(1)}\\right)\\right)\n$$\n该方程将 $u_i^{(2)}$ 表示为状态 $u_i^n$（权重为 $\\frac{3}{4}$）和项 $(u_{i}^{(1)} + \\Delta t_{i} L_{i}(u^{(1)}))$（权重为 $\\frac{1}{4}$）的凸组合。权重为非负且总和为 $1$。第二项是应用于状态 $u_i^{(1)}$ 的一个 FE 步。与此步相关的 FE 子步是：\n$$\n\\tau_{i}^{(1)} = \\Delta t_{i}\n$$\n\n- **阶段 3：** 网格单元 $i$ 的最终更新是：\n$$\nu_{i}^{n+1} = u_{i}^{(3)} = \\frac{1}{3}\\,u_{i}^{n} + \\frac{2}{3}\\left(u_{i}^{(2)} + \\Delta t_{i} L_{i}\\!\\left(u^{(2)}\\right)\\right)\n$$\n这将 $u_i^{n+1}$ 表示为状态 $u_i^n$（权重为 $\\frac{1}{3}$）和项 $(u_{i}^{(2)} + \\Delta t_{i} L_{i}(u^{(2)}))$（权重为 $\\frac{2}{3}$）的凸组合。第二项是应用于状态 $u_i^{(2)}$ 的一个 FE 步。与此步相关的 FE 子步是：\n$$\n\\tau_{i}^{(2)} = \\Delta t_{i}\n$$\n\n总之，该方法由一系列操作（FE 步和凸组合）组成，在每个阶段的公式中出现的显式 FE 子步是 $\\tau_{i}^{(0)} = \\Delta t_{i}$、$\\tau_{i}^{(1)} = \\Delta t_{i}$ 和 $\\tau_{i}^{(2)} = \\Delta t_{i}$。\n\n**(b) 推导关于 $\\Delta t_i$ 的必要且充分的逐网格单元不等式**\n\nSSP 性质要求格式中涉及的每个 FE 步都必须是可允许的。从状态 $w$ 开始，子步长为 $\\tau_i$ 的一个 FE 步是可允许的，如果 $0 \\le \\tau_i \\le \\Delta t_{\\mathrm{FE},i}(w)$，其中 $\\Delta t_{\\mathrm{FE},i}(w)$ 是在状态 $w$ 下网格单元 $i$ 的最大稳定 FE 步长。\n\n为使 SSP(3,3) 方法成为 SSP 方法，(a) 部分中确定的每个 FE 子步都必须在其出现的阶段的背景下是可允许的。\n\n1.  对于阶段 1，子步是 $\\tau_i^{(0)} = \\Delta t_i$，应用于状态 $u^n$。可允许性条件是：\n    $$\n    0 \\le \\Delta t_i \\le \\Delta t_{\\mathrm{FE},i}(u^n)\n    $$\n2.  对于阶段 2，子步是 $\\tau_i^{(1)} = \\Delta t_i$，应用于状态 $u^{(1)}$。可允许性条件是：\n    $$\n    0 \\le \\Delta t_i \\le \\Delta t_{\\mathrm{FE},i}(u^{(1)})\n    $$\n3.  对于阶段 3，子步是 $\\tau_i^{(2)} = \\Delta t_i$，应用于状态 $u^{(2)}$。可允许性条件是：\n    $$\n    0 \\le \\Delta t_i \\le \\Delta t_{\\mathrm{FE},i}(u^{(2)})\n    $$\n\n为了使从 $n$ 到 $n+1$ 的单个时间步是 SSP 的，所选的 $\\Delta t_i$ 必须同时满足所有这些条件。因此，必要条件是：\n$$\n\\Delta t_i \\le \\min\\left( \\Delta t_{\\mathrm{FE},i}(u^n), \\Delta t_{\\mathrm{FE},i}(u^{(1)}), \\Delta t_{\\mathrm{FE},i}(u^{(2)}) \\right)\n$$\n为了确定该方法的内在 SSP 系数，标准做法是假设 $\\Delta t_{\\mathrm{FE},i}$ 在单个时间步的各个阶段内没有显著变化。这是由问题陈述引导的，其中可允许性条件 $0 \\le \\tau_{i}^{(m)} \\le \\Delta t_{\\mathrm{FE},i}$ 并未明确显示出状态依赖性。在这个标准简化假设下，我们设定 $\\Delta t_{\\mathrm{FE},i}(u^n) \\approx \\Delta t_{\\mathrm{FE},i}(u^{(1)}) \\approx \\Delta t_{\\mathrm{FE},i}(u^{(2)}) \\approx \\Delta t_{\\mathrm{FE},i}$（其中后者在状态 $u^n$ 处计算）。\n\n在此假设下，三个不等式合并为一个条件。在给定的 SSP 定义和假设 $\\Delta t_{\\mathrm{FE},i}$ 在各个子阶段保持不变的情况下，此条件是必要且充分的：\n$$\n0 \\le \\Delta t_i \\le \\Delta t_{\\mathrm{FE},i}\n$$\n\n**(c) 确定最大允许缩放因子 $s_{\\max}$**\n\n我们被告知局部时间步长是局部 FE 界限的均匀缩放：$\\Delta t_i = s \\cdot \\Delta t_{\\mathrm{FE},i}$，其中 $s$ 是一个对所有网格单元都相同的标量常数，而 $\\Delta t_{\\mathrm{FE},i}$ 是网格单元 $i$ 的最大允许 FE 步长（在状态 $u^n$ 处计算）。\n\n将此代入 (b) 部分推导出的不等式中：\n$$\ns \\cdot \\Delta t_{\\mathrm{FE},i} \\le \\Delta t_{\\mathrm{FE},i}\n$$\n问题陈述 $\\Delta t_{\\mathrm{FE},i} > 0$。因此，我们可以在不等式两边同时除以 $\\Delta t_{\\mathrm{FE},i}$ 而不改变不等式的方向：\n$$\ns \\le 1\n$$\n由于 $s$ 在前向时间积分中通常被选为非负值，所以其完整范围是 $0 \\le s \\le 1$。因此，最大允许缩放因子是：\n$$\ns_{\\max} = 1\n$$\n这个值是 SSP(3,3) 方法众所周知的 SSP 系数。\n\n**(d) 关于实际可行性的讨论**\n\n(b) 和 (c) 部分的推导依赖于一个假设，即逐网格单元的 FE 稳定性界限 $\\Delta t_{\\mathrm{FE},i}$ 在龙格-库塔步的三个阶段中保持有效恒定。在实际的多网格单元 CFD 计算中，有几个因素使情况变得复杂：\n\n1.  **状态相关的稳定性：** 稳定性界限 $\\Delta t_{\\mathrm{FE},i}$（例如，来自 CFL 条件）是局部解状态的函数，例如 $\\Delta t_{\\mathrm{FE},i} \\propto 1 / (|\\mathbf{v}_i| + c_i)$。当解通过阶段 $u^{(1)}$ 和 $u^{(2)}$ 演化时，局部速度 $\\mathbf{v}_i$ 和声速 $c_i$ 会发生变化，从而改变 $\\Delta t_{\\mathrm{FE},i}(u^{(k)})$ 的真实值。如果在某个阶段稳定性界限显著减小（例如，由于激波增强），即使基于初始状态 $u^n$ 设定 $s=1$，条件 $\\Delta t_i \\le \\Delta t_{\\mathrm{FE},i}(u^{(k)})$ 也可能被违反。\n\n2.  **界面通量一致性：** 网格单元 $i$ 的空间算子 $L_i(u)$ 通常依赖于相邻网格单元中的解，例如，通过数值通量 $F_{i+1/2}(u_i, u_{i+1})$。在局部时间步进中，相邻网格单元 $i, j$ 的中间阶段值 $u_i^{(k)}$ 和 $u_{j}^{(k)}$ 是使用它们各自的时间步长 $\\Delta t_i$ 和 $\\Delta t_j$ 计算的。如果 $\\Delta t_i \\neq \\Delta t_j$，阶段值集合 $u^{(k)}$ 并不对应于半离散系统在任何单一中间时刻的解。这种在网格单元界面处的不一致性可能导致瞬态问题形式精度阶的降低。对于稳态收敛问题，这种瞬态精度的损失通常被认为是为实现加速而付出的可接受的代价。\n\n3.  **严格的 SSP 性质：** 由于状态相关的稳定性和不一致的界面状态的共同影响，严格证明的 SSP 性质在实践中可能会受到损害。相邻网格单元之间 $\\Delta t_i / \\Delta t_j$ 的大比率会加剧这些问题。因此，实践者通常使用更保守的缩放因子（$s  1$）和/或限制相邻网格单元之间时间步长的最大比率，以保持鲁棒性并防止振荡的增长。", "answer": "$$\n\\boxed{1}\n$$", "id": "3341502"}, {"introduction": "理论最终必须付诸实践。这个编程练习要求你为一个标量守恒律实现一个多速率格式，使用一种守恒的通量插值方法来处理不同时间步长的单元。通过验证该格式的守恒性和总变差递减（TVD）特性，你将获得构建稳健且准确的LTS求解器所需的算法细节方面的实践经验 [@problem_id:3341536]。", "problem": "考虑在长度为 $L$ 的周期性域上的一维标量双曲守恒律 $u_t + f(u)_x = 0$，该方程通过有限体积法在 $N$ 个宽度为 $\\Delta x = L/N$ 的均匀单元上进行离散。设通量为线性平流通量 $f(u) = a u$，其中平流速度为正常数 $a > 0$。单元平均值 $u_i(t)$ 的半离散有限体积更新定义为\n$$\n\\frac{d u_i}{d t} = -\\frac{1}{\\Delta x}\\left(F_{i+\\frac{1}{2}}(t) - F_{i-\\frac{1}{2}}(t)\\right),\n$$\n其中，对于 $a>0$，数值通量为单调迎风通量，由下式给出\n$$\nF_{i+\\frac{1}{2}}(t) = a\\, u_i(t).\n$$\n已知一阶强稳定性保持（SSP）龙格-库塔格式（即前向欧拉法），在满足 Courant–Friedrichs–Lewy (CFL) 条件 $a\\,\\Delta t / \\Delta x \\le 1$ 的情况下，对于单调通量是总变差不增（TVD）的。在局部时间步进中，为每个单元 $i$ 分配一个整数 $m_i \\in \\mathbb{N}$，表示每个宏观步 $\\Delta t$ 内的子步数，其局部子步长为\n$$\n\\Delta t_i = \\frac{\\Delta t}{m_i}.\n$$\n为了在存在不同局部子步长的情况下确保守恒性和保持 TVD 性质，我们通过根据所有单元子步边界的有序并集对宏观步区间 $[t^n, t^n+\\Delta t]$ 进行划分，在每个界面 $(i+\\frac{1}{2})$ 处构造一个守恒通量插值\n$$\n\\mathcal{T} = \\bigcup_{j=1}^N \\left\\{ t^n + k \\frac{\\Delta t}{m_j} \\,:\\, k=1,2,\\dots,m_j \\right\\},\n$$\n将其升序排序并在开头增加 $t^n$。将连续的时间点记为 $t^n = \\tau_0  \\tau_1  \\cdots  \\tau_K = t^n+\\Delta t$，并定义子区间长度 $\\delta t_k = \\tau_k - \\tau_{k-1}$，其中 $k=1,\\dots,K$。在每个子区间 $[\\tau_{k-1}, \\tau_k)$ 上，冻结状态 $u(\\tau_{k-1})$ 并计算分段常数界面通量 $F_{i+\\frac{1}{2}}(\\tau_{k-1}) = a\\, u_i(\\tau_{k-1})$。然后用步长为 $\\delta t_k$ 的前向欧拉步更新所有单元：\n$$\nu_i(\\tau_k) = u_i(\\tau_{k-1}) - \\frac{\\delta t_k}{\\Delta x}\\left(F_{i+\\frac{1}{2}}(\\tau_{k-1}) - F_{i-\\frac{1}{2}}(\\tau_{k-1})\\right).\n$$\n这在 $[t^n, t^n+\\Delta t]$ 上产生了一个守恒的时间积分，因为在每个界面和子区间上，相同的通量贡献 $F_{i+\\frac{1}{2}}\\delta t_k$ 从左侧单元减去并加到右侧单元。并且，只要对所有 $k$ 都满足 $a\\,\\delta t_k/\\Delta x \\le 1$，该方法就是 TVD 的。为强制执行此条件，取宏观步长为\n$$\n\\Delta t = \\frac{\\Delta x}{a},\n$$\n因为 $\\delta t_k \\le \\Delta t$，这确保了 $a\\,\\delta t_k/\\Delta x \\le 1$。\n\n任务：通过所述的守恒通量插值格式，实现上述带有单元子步 $m_i$ 的多速率强稳定性保持龙格-库塔（SSPRK(1)）格式。使用周期性域 $[0,1]$，其中 $L=1$，平流速度 $a=1$，单元数 $N$ 在每个测试案例中指定。初始条件按每个测试指定。将解推进指定的宏观步数，每步时长为 $\\Delta t = \\Delta x/a$。时间积分后，计算：\n\n1. 离散质量\n$$\nM = \\sum_{i=0}^{N-1} u_i\\,\\Delta x,\n$$\n并在测试指定的积分时间内验证质量守恒（误差容限为 $10^{-12}$）（为质量守恒返回一个布尔值）。\n2. 离散总变差\n$$\n\\mathrm{TV}(u) = \\sum_{i=0}^{N-1} \\left| u_{i+1} - u_i \\right|,\n$$\n其中使用周期性索引 $u_N \\equiv u_0$，并验证其在指定的积分时间内不增加（为 TVD 返回一个布尔值，即 $\\mathrm{TV}(u^{\\text{final}}) \\le \\mathrm{TV}(u^{\\text{initial}})$）。\n3. 对于均匀子步测试，计算使用均匀 $m_i$ 的时间并集多速率方法与使用宏观步 $\\Delta t$ 的单步前向欧拉法产生的解之间的最大绝对差；将此差值作为浮点数返回。\n\n测试套件：\n- 测试1（正常情况）：$N=200$，初始条件为在单元中心采样的 $u(x) = 0.5 + 0.5\\sin(2\\pi x)$，对于中心 $x \\in [0.4, 0.6]$ 的单元，单元子步 $m_i = 3$，其他单元 $m_i = 1$，推进 $3$ 个宏观步。返回两个布尔值：质量守恒和 TVD。\n- 测试2（均匀情况）：$N=200$，初始条件 $u(x) = \\sin(2\\pi x)$，所有 $i$ 的子步均为均匀的 $m_i = 1$，推进 $1$ 个宏观步。返回一个浮点数：时间并集多速率方法与单步前向欧拉法（步长 $\\Delta t$）之间的最大绝对差。\n- 测试3（边界情况）：$N=200$，初始条件为 $u(x) = \\mathbf{1}_{[0.25,0.5]}(x)$（区间 $[0.25,0.5]$ 的指示函数，在单元中心采样），单元子步交替为 $m_i = 1$ 和 $m_i = 4$（即，如果 $i$ 是偶数，则 $m_i = 1$；如果 $i$ 是奇数，则 $m_i = 4$），推进 $5$ 个宏观步。返回两个布尔值：质量守恒和 TVD。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表。输出必须按顺序汇总测试1、测试2和测试3的结果：$[\\text{mass\\_T1},\\text{TVD\\_T1},\\text{maxdiff\\_T2},\\text{mass\\_T3},\\text{TVD\\_T3}]$。由于问题是无量纲的，因此无需报告物理单位。", "solution": "我们从标量双曲守恒律 $u_t + f(u)_x = 0$ 开始，其中 $f(u) = a u$ 且 $a>0$。在均匀网格上，使用单元平均值 $u_i(t)$ 的有限体积半离散格式为\n$$\n\\frac{d u_i}{d t} = -\\frac{1}{\\Delta x}\\left(F_{i+\\frac{1}{2}}(t) - F_{i-\\frac{1}{2}}(t)\\right).\n$$\n对于单调数值通量，在 Courant–Friedrichs–Lewy (CFL) 限制条件 $a\\,\\Delta t / \\Delta x \\le 1$ 下，前向欧拉格式是总变差不增（TVD）的。具体来说，对于 $a>0$ 的线性平流，迎风通量为 $F_{i+\\frac{1}{2}} = a u_i$。在均匀时间步长 $\\delta t$ 上的前向欧拉更新可写为\n$$\nu_i^{n+1} = u_i^n - \\lambda\\,(u_i^n - u_{i-1}^n),\\quad\\text{with}\\quad \\lambda = \\frac{a\\,\\delta t}{\\Delta x}.\n$$\n这是一个凸组合，因为 $u_i^{n+1} = (1-\\lambda) u_i^n + \\lambda u_{i-1}^n$ 且 $\\lambda \\in [0,1]$，因此它不会产生新的极值，并且是 TVD 的。\n\n局部时间步进通过整数 $m_i$ 和局部子步长 $\\Delta t_i = \\Delta t/m_i$ 引入了每个单元时间增量的异质性。在单个阶段内直接应用不同的 $\\Delta t_i$ 会在界面处破坏守恒性，因为通量贡献在两侧会被不同地缩放。为了保持守恒性和 TVD，我们如下构造一个时间上的守恒通量插值。\n\n定义每个单元 $i$ 的子步边界集合：\n$$\n\\mathcal{T}_i = \\left\\{ t^n + k \\frac{\\Delta t}{m_i} : k=1,2,\\dots,m_i \\right\\}.\n$$\n令 $\\mathcal{T} = \\bigcup_{i=0}^{N-1} \\mathcal{T}_i$ 并将 $\\mathcal{T}$ 升序排序，在开头增加 $t^n$；记 $\\tau_0 = t^n$，则有 $\\tau_1  \\cdots  \\tau_K = t^n+\\Delta t$。在每个长度为 $\\delta t_k = \\tau_k - \\tau_{k-1}$ 的子区间 $[\\tau_{k-1},\\tau_k)$ 上，我们冻结状态 $u(\\tau_{k-1})$ 并计算界面通量 $F_{i+\\frac{1}{2}}(\\tau_{k-1}) = a\\,u_i(\\tau_{k-1})$。然后应用一个前向欧拉更新：\n$$\nu_i(\\tau_k) = u_i(\\tau_{k-1}) - \\frac{\\delta t_k}{\\Delta x}\\left(F_{i+\\frac{1}{2}}(\\tau_{k-1}) - F_{i-\\frac{1}{2}}(\\tau_{k-1})\\right).\n$$\n守恒性得以保证，因为在 $[\\tau_{k-1},\\tau_k)$ 上，每个界面通量 $F_{i+\\frac{1}{2}}(\\tau_{k-1})$ 对左侧单元的贡献是 $- \\frac{\\delta t_k}{\\Delta x} F_{i+\\frac{1}{2}}$，对右侧单元的贡献是 $+ \\frac{\\delta t_k}{\\Delta x} F_{i+\\frac{1}{2}}$，因此单元平均值乘以 $\\Delta x$ 的总和保持不变：\n$$\n\\sum_{i} u_i(\\tau_k)\\Delta x = \\sum_{i} u_i(\\tau_{k-1})\\Delta x.\n$$\nTVD 性质得以保持，因为每个子区间的更新都是一个前向欧拉步，其中 $\\lambda_k = a\\,\\delta t_k/\\Delta x$。如果我们取宏观步长 $\\Delta t = \\Delta x / a$，则 $\\delta t_k \\le \\Delta t$ 意味着 $\\lambda_k \\le 1$。因此，更新在每个子区间内都是相邻状态的凸组合，而 TVD 步骤的复合仍然是 TVD 的：\n$$\n\\mathrm{TV}\\big(u(\\tau_k)\\big) \\le \\mathrm{TV}\\big(u(\\tau_{k-1})\\big)\\quad\\Rightarrow\\quad \\mathrm{TV}\\big(u(t^n+\\Delta t)\\big) \\le \\mathrm{TV}\\big(u(t^n)\\big).\n$$\n这种构造是一个一阶多速率强稳定性保持龙格-库塔格式（SSPRK(1)），因为它可以被解释为一系列具有可变子区间长度 $\\delta t_k$ 的前向欧拉步，这些子区间长度源于局部子步边界的并集。由于 CFL 限制，每个子区间都满足 SSP 条件。界面通量插值在每个 $[\\tau_{k-1},\\tau_k)$ 上是分段常数，确保了相同的通量积分应用于相邻的两个单元，从而保证了守恒性。\n\n算法上：\n- 在单元中心 $x_i = (i+0.5)\\Delta x$ 处，根据给定的初始条件初始化 $u_i$。\n- 对于每个宏观步，从所有 $m_i$ 构建集合 $\\mathcal{T}$，对其元素进行排序，并形成子区间 $\\delta t_k$。\n- 对于每个 $\\delta t_k$，使用在子区间开始时冻结的状态计算通量 $F_{i+\\frac{1}{2}} = a u_i$，并通过前向欧拉公式更新所有 $u_i$。\n- 在指定的宏观步数之后，计算离散质量 $M$ 和总变差 $\\mathrm{TV}(u)$，与初始值进行比较，并生成所要求的输出。\n\n测试1在平滑初始条件下使用非均匀的 $m_i$ 模式，以验证多个宏观步上的守恒性和 TVD。测试2使用均匀的 $m_i=1$；在这种情况下，$\\mathcal{T}$ 只包含一个边界 $\\tau_1 = t^n+\\Delta t$，因此该方法简化为单个前向欧拉宏观步，与标准前向欧拉宏观步的最大绝对差预计在浮点运算精度内为零。测试3采用具有交替 $m_i$ 的不连续初始条件，以评估在极端多速率划分下守恒性和 TVD 的鲁棒性。\n\n所有量都是无量纲的；没有物理单位需要报告。输出是测试1和3的两个布尔值，以及测试2的一个浮点数，按指定的单行格式汇总。", "answer": "```python\nimport numpy as np\n\ndef build_union_subintervals(m_vec, dt):\n    # Build the union of substep boundary times from all cells.\n    times = set()\n    for m in m_vec:\n        for k in range(1, m + 1):\n            times.add(k * dt / m)\n    # Include start time 0 and sort\n    sorted_times = sorted(times)\n    # Build subintervals between consecutive times, starting from 0\n    prev = 0.0\n    deltas = []\n    for t in sorted_times:\n        deltas.append(t - prev)\n        prev = t\n    # If the last time is less than dt due to floating tolerance, add the remainder\n    if prev  dt - 1e-16:\n        deltas.append(dt - prev)\n    return deltas\n\ndef forward_euler_union(u, m_vec, dx, a, dt, n_macrosteps):\n    # Advance solution using union-of-times conservative flux interpolation\n    u = u.copy()\n    for _ in range(n_macrosteps):\n        deltas = build_union_subintervals(m_vec, dt)\n        for dtk in deltas:\n            lam = a * dtk / dx\n            # Upwind flux for a0: F_{i+1/2} = a*u_i; update becomes u_i -= lam*(u_i - u_{i-1})\n            u = u - lam * (u - np.roll(u, 1))\n    return u\n\ndef forward_euler_single(u, dx, a, dt):\n    lam = a * dt / dx\n    return u - lam * (u - np.roll(u, 1))\n\ndef mass(u, dx):\n    return dx * np.sum(u)\n\ndef total_variation(u):\n    return np.sum(np.abs(np.roll(u, -1) - u))\n\ndef initial_condition_sine(N):\n    x = (np.arange(N) + 0.5) / N\n    return 0.5 + 0.5 * np.sin(2 * np.pi * x)\n\ndef initial_condition_sine_zero_mean(N):\n    x = (np.arange(N) + 0.5) / N\n    return np.sin(2 * np.pi * x)\n\ndef initial_condition_indicator(N, a=0.25, b=0.5):\n    x = (np.arange(N) + 0.5) / N\n    return ((x = a)  (x = b)).astype(float)\n\ndef solve():\n    # Common parameters\n    L = 1.0\n    a = 1.0\n\n    results = []\n\n    # Test 1: mixed m_i, smooth sine, 3 macro-steps\n    N1 = 200\n    dx1 = L / N1\n    dt1 = dx1 / a  # CFL 1\n    u0_1 = initial_condition_sine(N1)\n    # m_i = 3 in [0.4, 0.6], else 1\n    x1 = (np.arange(N1) + 0.5) / N1\n    m_vec1 = np.where((x1 = 0.4)  (x1 = 0.6), 3, 1).astype(int)\n\n    M0_1 = mass(u0_1, dx1)\n    TV0_1 = total_variation(u0_1)\n    u1 = forward_euler_union(u0_1, m_vec1, dx1, a, dt1, n_macrosteps=3)\n    M1 = mass(u1, dx1)\n    TV1 = total_variation(u1)\n    mass_ok_1 = bool(abs(M1 - M0_1) = 1e-12)\n    tvd_ok_1 = bool(TV1 = TV0_1 + 1e-12)\n    results.append(mass_ok_1)\n    results.append(tvd_ok_1)\n\n    # Test 2: uniform m_i=1, compare to single FE macro-step\n    N2 = 200\n    dx2 = L / N2\n    dt2 = dx2 / a\n    u0_2 = initial_condition_sine_zero_mean(N2)\n    m_vec2 = np.ones(N2, dtype=int)\n    u2_union = forward_euler_union(u0_2, m_vec2, dx2, a, dt2, n_macrosteps=1)\n    u2_single = forward_euler_single(u0_2, dx2, a, dt2)\n    maxdiff_2 = float(np.max(np.abs(u2_union - u2_single)))\n    results.append(maxdiff_2)\n\n    # Test 3: alternating m_i = 1 and 4, indicator initial condition, 5 macro-steps\n    N3 = 200\n    dx3 = L / N3\n    dt3 = dx3 / a\n    u0_3 = initial_condition_indicator(N3, a=0.25, b=0.5)\n    m_vec3 = np.where((np.arange(N3) % 2) == 0, 1, 4).astype(int)\n\n    M0_3 = mass(u0_3, dx3)\n    TV0_3 = total_variation(u0_3)\n    u3 = forward_euler_union(u0_3, m_vec3, dx3, a, dt3, n_macrosteps=5)\n    M3 = mass(u3, dx3)\n    TV3 = total_variation(u3)\n    mass_ok_3 = bool(abs(M3 - M0_3) = 1e-12)\n    tvd_ok_3 = bool(TV3 = TV0_3 + 1e-12)\n    results.append(mass_ok_3)\n    results.append(tvd_ok_3)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3341536"}]}