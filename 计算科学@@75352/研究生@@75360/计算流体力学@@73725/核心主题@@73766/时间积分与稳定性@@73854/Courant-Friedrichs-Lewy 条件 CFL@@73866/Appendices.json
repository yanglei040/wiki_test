{"hands_on_practices": [{"introduction": "本练习是理解CFL条件的基石。通过对简单的一维迎风格式应用傅里叶（冯·诺依曼）稳定性分析，我们可以严格推导出其稳定性限制 [@problem_id:3372287]。这项实践旨在构建分析数值格式所需的基础数学技能，并让您理解CFL数是如何从离散方程的放大因子中自然产生的。", "problem": "考虑一维线性平流偏微分方程 (PDE) $\\partial_t u + a\\,\\partial_x u = 0$，其中波速 $a  0$ 为常数。该方程在一个空间间距为 $\\Delta x$ 的均匀网格上离散，并使用针对 $a0$ 的显式一阶迎风格式以时间步长 $\\Delta t$ 进行时间推进。使用傅里叶（冯·诺依曼）稳定性分析，从第一性原理出发，推导傅里叶模态的放大因子的模，并由此推断出确保该格式 $\\ell^2$-稳定的无量纲库朗-弗里德里希斯-路维 (CFL) 数（定义为 $C = a\\,\\Delta t/\\Delta x$）的容许范围。然后，对于 $a = 2$ m/s，$\\Delta x = 0.01$ m，以及目标库朗数 $C_{\\mathrm{target}} = 0.8$，选择一个时间步长 $\\Delta t_{\\mathrm{adopt}}$，使得在容许的情况下它能达到目标库朗数，否则它等于由你的稳定性判据所施加的最大容许时间步长。计算 $\\Delta t_{\\mathrm{adopt}}$ 的值，并将你的最终结果以秒为单位表示，保留四位有效数字。", "solution": "一维线性平流偏微分方程由下式给出：\n$$\n\\partial_t u + a\\,\\partial_x u = 0\n$$\n其中波速 $a$ 是一个正常数 ($a  0$)。\n\n我们在均匀网格上离散化该方程，其中 $x_j = j\\Delta x$ 且 $t_n = n\\Delta t$。令 $u_j^n$ 表示解 $u(x_j, t_n)$ 的数值近似。显式一阶迎风格式通过使用时间上的向前差分和空间上的向后差分来构建，对于 $a0$ 这就是“迎风”方向：\n$$\n\\frac{u_j^{n+1} - u_j^n}{\\Delta t} + a \\frac{u_j^n - u_{j-1}^n}{\\Delta x} = 0\n$$\n为了进行傅里叶（冯·诺依曼）稳定性分析，我们考虑将单个傅里叶模态作为有限差分方程的解：\n$$\nu_j^n = \\hat{u}^n(k) e^{i k x_j} = \\hat{u}^n(k) e^{i k j \\Delta x}\n$$\n此处，$k$ 是波数，$i = \\sqrt{-1}$。下一时间步的解通过放大因子 $G(k)$ 与当前时间步的解相关联，使得 $\\hat{u}^{n+1}(k) = G(k) \\hat{u}^n(k)$。因此，$u_j^{n+1} = G(k) u_j^n$。\n\n将傅里叶模态代入离散方程：\n$$\n\\frac{G(k) \\hat{u}^n(k) e^{i k j \\Delta x} - \\hat{u}^n(k) e^{i k j \\Delta x}}{\\Delta t} + a \\frac{\\hat{u}^n(k) e^{i k j \\Delta x} - \\hat{u}^n(k) e^{i k (j-1) \\Delta x}}{\\Delta x} = 0\n$$\n项 $\\hat{u}^n(k) e^{i k j \\Delta x}$ 是一个公共因子，并且由于其非零可以被约去：\n$$\n\\frac{G(k) - 1}{\\Delta t} + a \\frac{1 - e^{-i k \\Delta x}}{\\Delta x} = 0\n$$\n求解放大因子 $G(k)$：\n$$\nG(k) - 1 = - \\frac{a \\Delta t}{\\Delta x} (1 - e^{-i k \\Delta x})\n$$\n我们引入无量纲库朗-弗里德里希斯-路维 (CFL) 数，$C = \\frac{a \\Delta t}{\\Delta x}$。\n$$\nG(k) = 1 - C (1 - e^{-i k \\Delta x})\n$$\n为了保证 $\\ell^2$-稳定性，对所有波数 $k$，放大因子的模必须小于或等于 1：$|G(k)| \\le 1$。我们定义无量纲波数 $\\theta = k \\Delta x$。那么，\n$$\nG(\\theta) = 1 - C (1 - e^{-i \\theta}) = 1 - C (1 - (\\cos\\theta - i\\sin\\theta)) = (1 - C(1 - \\cos\\theta)) + i C\\sin\\theta\n$$\n模的平方 $|G(\\theta)|^2$ 是实部和虚部平方的和：\n$$\n|G(\\theta)|^2 = (1 - C(1 - \\cos\\theta))^2 + (C\\sin\\theta)^2\n$$\n$$\n|G(\\theta)|^2 = 1 - 2C(1 - \\cos\\theta) + C^2(1 - \\cos\\theta)^2 + C^2\\sin^2\\theta\n$$\n$$\n|G(\\theta)|^2 = 1 - 2C(1 - \\cos\\theta) + C^2(1 - 2\\cos\\theta + \\cos^2\\theta + \\sin^2\\theta)\n$$\n使用恒等式 $\\cos^2\\theta + \\sin^2\\theta = 1$：\n$$\n|G(\\theta)|^2 = 1 - 2C(1 - \\cos\\theta) + C^2(1 - 2\\cos\\theta + 1) = 1 - 2C(1 - \\cos\\theta) + C^2(2 - 2\\cos\\theta)\n$$\n$$\n|G(\\theta)|^2 = 1 - 2C(1 - \\cos\\theta) + 2C^2(1 - \\cos\\theta)\n$$\n$$\n|G(\\theta)|^2 = 1 + (2C^2 - 2C)(1 - \\cos\\theta) = 1 + 2C(C - 1)(1 - \\cos\\theta)\n$$\n稳定性条件是 $|G(\\theta)|^2 \\le 1$：\n$$\n1 + 2C(C - 1)(1 - \\cos\\theta) \\le 1\n$$\n$$\n2C(C - 1)(1 - \\cos\\theta) \\le 0\n$$\n参数 $a$、$\\Delta t$ 和 $\\Delta x$ 都是正的，因此 CFL 数 $C$ 是正的。项 $(1 - \\cos\\theta)$ 总是非负的，因为 $-1 \\le \\cos\\theta \\le 1$。为了使该不等式对所有可能的 $\\theta$ 值都成立，项 $2C(C-1)$ 必须是非正的。由于 $C0$，这要求：\n$$\nC - 1 \\le 0 \\implies C \\le 1\n$$\n结合物理约束 $C \\ge 0$，确保稳定性的 CFL 数的容许范围是：\n$$\n0 \\le C \\le 1\n$$\n现在，我们将此结果应用于给定的具体情况。给定参数为：\n$a = 2$ m/s\n$\\Delta x = 0.01$ m\n$C_{\\mathrm{target}} = 0.8$\n\n推导出的稳定性判据是 $0 \\le C \\le 1$。目标库朗数 $C_{\\mathrm{target}} = 0.8$ 在此容许范围内。根据问题陈述，我们应该选择一个时间步长 $\\Delta t_{\\mathrm{adopt}}$ 来达到这个目标库朗数。\n\n库朗数的定义是 $C = \\frac{a \\Delta t}{\\Delta x}$。我们令 $C = C_{\\mathrm{target}}$ 并求解 $\\Delta t = \\Delta t_{\\mathrm{adopt}}$：\n$$\nC_{\\mathrm{target}} = \\frac{a \\Delta t_{\\mathrm{adopt}}}{\\Delta x}\n$$\n$$\n\\Delta t_{\\mathrm{adopt}} = \\frac{C_{\\mathrm{target}} \\Delta x}{a}\n$$\n代入数值：\n$$\n\\Delta t_{\\mathrm{adopt}} = \\frac{(0.8)(0.01\\ \\text{m})}{2\\ \\text{m/s}} = \\frac{0.008}{2}\\ \\text{s} = 0.004\\ \\text{s}\n$$\n问题要求将结果四舍五入到四位有效数字。为了用四位有效数字表示 $0.004$，我们将其写成科学记数法形式 $4.000 \\times 10^{-3}$。", "answer": "$$\n\\boxed{4.000 \\times 10^{-3}}\n$$", "id": "3372287"}, {"introduction": "现实世界中的流体动力学问题很少是一维的，因此将稳定性分析推广到多维至关重要。本练习探讨了二维线性平流问题的CFL条件，并引入了一种基于系数非负性的直观分析方法 [@problem_id:3372303]。确保更新格式是一种凸组合可以防止产生新的极值，这为保证数值解的稳定性提供了一种强大的物理约束。", "problem": "考虑二维常系数线性平流方程\n$$\\frac{\\partial u}{\\partial t} + a\\,\\frac{\\partial u}{\\partial x} + b\\,\\frac{\\partial u}{\\partial y} = 0,$$\n该方程建立在间距为 $\\Delta x$ 和 $\\Delta y$ 的均匀笛卡尔网格上，并使用大小为 $\\Delta t$ 的显式前向欧拉步长进行时间推进。空间离散化采用一阶、维度非分裂的迎风有限体积法。假设速度分量 $a$ 和 $b$ 是已知常数。Courant–Friedrichs–Lewy (CFL) 条件通过确保数值依赖域包含偏微分方程的依赖域来保证稳定性。\n\n从在单元 $(i,j)$ 上应用与 $a$ 和 $b$ 符号一致的迎风差分得到的离散守恒更新出发，推导保证所有更新系数非负并构成相邻值凸组合的条件。利用此条件，得到维度非分裂迎风法的最大稳定时间步长 $\\Delta t$（用 $a$、$b$、$\\Delta x$ 和 $\\Delta y$ 表示）。\n\n然后，对于具体数值 $a=1$ m/s，$b=-0.5$ m/s，$\\Delta x=0.01$ m，以及 $\\Delta y=0.005$ m，计算最大稳定时间步长 $\\Delta t$。将最终数值答案四舍五入到 3 位有效数字，并以秒为单位表示 $\\Delta t$。", "solution": "### 推导与求解\n给定的偏微分方程可以写成守恒形式：\n$$ \\frac{\\partial u}{\\partial t} + \\frac{\\partial F}{\\partial x} + \\frac{\\partial G}{\\partial y} = 0 $$\n其中通量为 $F = au$ 和 $G = bu$，因为 $a$ 和 $b$ 是常数。\n\n我们通过将该方程在一个以 $(x_i, y_j)$ 为中心、尺寸为 $\\Delta x \\times \\Delta y$ 的控制体积（单元）$V_{i,j}$ 上积分来应用有限体积法。令 $u_{i,j}(t)$ 为在时间 $t$ 单元 $(i,j)$ 中 $u$ 的单元平均值。守恒律的半离散形式为：\n$$ \\frac{du_{i,j}}{dt} + \\frac{F_{i+1/2,j} - F_{i-1/2,j}}{\\Delta x} + \\frac{G_{i,j+1/2} - G_{i,j-1/2}}{\\Delta y} = 0 $$\n这里，$F_{i+1/2,j}$ 和 $G_{i,j+1/2}$ 是单元界面上的数值通量。\n\n对于一阶迎风格式，界面上的通量由“迎风”单元中的值确定。风向由平流速度 $a$ 和 $b$ 的符号给出。\n数值通量函数为：\n$$ F_{i+1/2,j} = \\begin{cases} a u_{i,j}  \\text{if } a  0 \\\\ a u_{i+1,j} \\text{if } a  0 \\end{cases} $$\n$$ G_{i,j+1/2} = \\begin{cases} b u_{i,j}  \\text{if } b  0 \\\\ b u_{i,j+1} \\text{if } b  0 \\end{cases} $$\n我们可以使用定义 $v^+ = \\frac{1}{2}(v+|v|) = \\max(v,0)$ 和 $v^- = \\frac{1}{2}(v-|v|) = \\min(v,0)$ 更普遍地表达这一点。注意 $v = v^+ + v^-$。\n数值通量 $F_{i+1/2,j}$ 由下式给出：\n$$ F_{i+1/2,j} = a^+ u_{i,j} + a^- u_{i+1,j} $$\n类似地，通量 $G_{i,j+1/2}$ 为：\n$$ G_{i,j+1/2} = b^+ u_{i,j} + b^- u_{i,j+1} $$\n穿过单元 $(i,j)$ 的通量差为：\n$$ F_{i+1/2,j} - F_{i-1/2,j} = (a^+ u_{i,j} + a^- u_{i+1,j}) - (a^+ u_{i-1,j} + a^- u_{i,j}) = a^+(u_{i,j} - u_{i-1,j}) + a^-(u_{i+1,j} - u_{i,j}) $$\n$$ G_{i,j+1/2} - G_{i,j-1/2} = (b^+ u_{i,j} + b^- u_{i,j+1}) - (b^+ u_{i,j-1} + b^- u_{i,j}) = b^+(u_{i,j} - u_{i,j-1}) + b^-(u_{i,j+1} - u_{i,j}) $$\n将这些代入半离散方程：\n$$ \\frac{du_{i,j}}{dt} = -\\frac{1}{\\Delta x} \\left[ a^+(u_{i,j} - u_{i-1,j}) + a^-(u_{i+1,j} - u_{i,j}) \\right] - \\frac{1}{\\Delta y} \\left[ b^+(u_{i,j} - u_{i,j-1}) + b^-(u_{i,j+1} - u_{i,j}) \\right] $$\n现在，我们应用显式前向欧拉时间步进格式：$\\frac{u_{i,j}^{n+1} - u_{i,j}^n}{\\Delta t} = \\left(\\frac{du_{i,j}}{dt}\\right)^n$。令 $u_{i,j}^n$ 表示在时间 $t_n$ 的值。\n$$ u_{i,j}^{n+1} = u_{i,j}^n - \\frac{\\Delta t}{\\Delta x} \\left[ a^+(u_{i,j}^n - u_{i-1,j}^n) + a^-(u_{i+1,j}^n - u_{i,j}^n) \\right] - \\frac{\\Delta t}{\\Delta y} \\left[ b^+(u_{i,j}^n - u_{i,j-1}^n) + b^-(u_{i,j+1}^n - u_{i,j}^n) \\right] $$\n我们重新排列各项，将 $u_{i,j}^{n+1}$ 表示为在时间 $n$ 值的线性组合：\n$$ u_{i,j}^{n+1} = u_{i,j}^n - \\frac{\\Delta t}{\\Delta x}(a^+ - a^-)u_{i,j}^n - \\frac{\\Delta t}{\\Delta y}(b^+ - b^-)u_{i,j}^n + \\frac{\\Delta t}{\\Delta x} a^+ u_{i-1,j}^n - \\frac{\\Delta t}{\\Delta x} a^- u_{i+1,j}^n + \\frac{\\Delta t}{\\Delta y} b^+ u_{i,j-1}^n - \\frac{\\Delta t}{\\Delta y} b^- u_{i,j+1}^n $$\n使用恒等式 $|v| = v^+ - v^-$、$v^+ \\ge 0$ 和 $v^- \\le 0$：\n$$ u_{i,j}^{n+1} = \\left(1 - \\frac{|a|\\Delta t}{\\Delta x} - \\frac{|b|\\Delta t}{\\Delta y}\\right) u_{i,j}^n + \\left(\\frac{a^+\\Delta t}{\\Delta x}\\right) u_{i-1,j}^n + \\left(\\frac{-a^-\\Delta t}{\\Delta x}\\right) u_{i+1,j}^n + \\left(\\frac{b^+\\Delta t}{\\Delta y}\\right) u_{i,j-1}^n + \\left(\\frac{-b^-\\Delta t}{\\Delta y}\\right) u_{i,j+1}^n $$\n这是完整的更新方程。为使更新成为一个凸组合，所有 $u^n$ 值的系数必须非负且总和为 1。\n我们来检查系数：\n- $u_{i-1,j}^n$ 的系数：$\\frac{a^+\\Delta t}{\\Delta x}$。由于 $a^+ \\ge 0$，$\\Delta t  0$ 且 $\\Delta x  0$，该系数是非负的。\n- $u_{i+1,j}^n$ 的系数：$\\frac{-a^-\\Delta t}{\\Delta x}$。由于 $a^- \\le 0$，该系数是非负的。\n- $u_{i,j-1}^n$ 的系数：$\\frac{b^+\\Delta t}{\\Delta y}$。由于 $b^+ \\ge 0$，该系数是非负的。\n- $u_{i,j+1}^n$ 的系数：$\\frac{-b^-\\Delta t}{\\Delta y}$。由于 $b^- \\le 0$，该系数是非负的。\n- $u_{i,j}^n$ 的系数：$1 - \\frac{|a|\\Delta t}{\\Delta x} - \\frac{|b|\\Delta t}{\\Delta y}$。为使其非负，我们必须有：\n$$ 1 - \\frac{|a|\\Delta t}{\\Delta x} - \\frac{|b|\\Delta t}{\\Delta y} \\ge 0 $$\n这导出了稳定性条件：\n$$ \\frac{|a|\\Delta t}{\\Delta x} + \\frac{|b|\\Delta t}{\\Delta y} \\le 1 $$\n我们来验证系数之和为 1。总和是：\n$$ \\left(1 - \\frac{|a|\\Delta t}{\\Delta x} - \\frac{|b|\\Delta t}{\\Delta y}\\right) + \\frac{a^+\\Delta t}{\\Delta x} - \\frac{a^-\\Delta t}{\\Delta x} + \\frac{b^+\\Delta t}{\\Delta y} - \\frac{b^-\\Delta t}{\\Delta y} $$\n$$ = 1 - \\left(\\frac{|a| - (a^+ - a^-)}{\\Delta x}\\right)\\Delta t - \\left(\\frac{|b| - (b^+ - b^-)}{\\Delta y}\\right)\\Delta t $$\n由于对于任何 $v$ 都有 $|v| = v^+ - v^-$，括号中的项为零。系数之和恰好为 1。\n因此，凸组合更新的条件（也即该格式的稳定性条件）是：\n$$ \\Delta t \\left( \\frac{|a|}{\\Delta x} + \\frac{|b|}{\\Delta y} \\right) \\le 1 $$\n当等式成立时，找到最大稳定时间步长 $\\Delta t_{max}$：\n$$ \\Delta t_{max} = \\frac{1}{\\frac{|a|}{\\Delta x} + \\frac{|b|}{\\Delta y}} $$\n\n### 数值计算\n现在我们代入给定值：$a=1$ m/s，$b=-0.5$ m/s，$\\Delta x=0.01$ m，以及 $\\Delta y=0.005$ m。\n首先，我们求速度的绝对值：\n$$ |a| = |1| = 1 \\text{ m/s} $$\n$$ |b| = |-0.5| = 0.5 \\text{ m/s} $$\n接下来，我们计算分母中的各项：\n$$ \\frac{|a|}{\\Delta x} = \\frac{1 \\text{ m/s}}{0.01 \\text{ m}} = 100 \\text{ s}^{-1} $$\n$$ \\frac{|b|}{\\Delta y} = \\frac{0.5 \\text{ m/s}}{0.005 \\text{ m}} = 100 \\text{ s}^{-1} $$\n最后，我们计算 $\\Delta t_{max}$：\n$$ \\Delta t_{max} = \\frac{1}{100 \\text{ s}^{-1} + 100 \\text{ s}^{-1}} = \\frac{1}{200 \\text{ s}^{-1}} = 0.005 \\text{ s} $$\n题目要求答案四舍五入到 3 位有效数字。\n$$ \\Delta t_{max} = 0.00500 \\text{ s} = 5.00 \\times 10^{-3} \\text{ s} $$", "answer": "$$ \\boxed{5.00 \\times 10^{-3}} $$", "id": "3372303"}, {"introduction": "CFL条件不仅是一个数学上的要求，它更具有深刻的物理内涵，即数值依赖域必须包含物理依赖域。本编码练习旨在将这一抽象原理具体化，通过实验揭示违反CFL条件的后果 [@problem_id:3372295]。通过对比数值解与精确解的演化，您将亲眼观察到当信息在数值上的传播速度超过其物理传播速度时，如何导致非物理的、不稳定的结果。", "problem": "考虑一维线性平流方程 $u_t + a\\,u_x = 0$，其中 $u(x,t)$ 为被动标量，常数平流速度 $a  0$。在长度为 $L$ 的周期性空间域上，点 $(x,t)$ 处的物理解依赖域由特征线 $x(t) = x_0 + a\\,t$ 决定，这意味着 $(x,t)$ 处的值取决于 $(x - a\\,t, 0)$ 处的初始值。在具有均匀网格和显式一阶迎风有限差分格式的离散计算环境中，数值更新仅使用前一时间层的相邻信息。当重复应用此显式模板时，数值依赖域在每个时间步长内扩展有限数量的网格间距。物理依赖域和数值依赖域之间的差异可以被构造和量化，并且这种差异与双曲守恒律显式格式的稳定性以及 Courant–Friedrichs–Lewy 条件密切相关。\n\n您的任务是实现一个数值实验，以展示平流问题的物理依赖域和数值依赖域之间的不匹配，并提供一个可控的非局域影响增长度量。使用以下设置和定义。\n\n基本原理：\n- 周期性区间 $[0,L)$ 上的平流方程 $u_t + a\\,u_x = 0$ 及初始条件 $u(x,0)$。\n- 平流方程的特征线以速度 $a$ 移动信息，因此物理精确解无失真地平移：$u(x,t) = u_0(x - a\\,t)$，其中 $u_0$ 是初始条件。\n\n离散化：\n- 使用具有 $N$ 个点和间距 $\\Delta x = L/N$ 的均匀网格，网格点为 $x_i = i\\,\\Delta x$，$i \\in \\{0,1,\\dots,N-1\\}$，并采用周期性边界条件。\n- 对 $a0$ 使用显式一阶迎风格式：\n$$\nu_i^{n+1} = u_i^n - C\\left(u_i^n - u_{i-1}^n\\right),\n$$\n其中 $C = \\dfrac{a\\,\\Delta t}{\\Delta x}$ 是 Courant 数，$\\Delta t$ 是时间步长，$n$ 是时间层，下标因周期性而对 $N$ 取模。\n- 演化 $n$ 个时间步，使最终时间为 $T = n\\,\\Delta t$。\n\n物理解依赖域和精确解区域：\n- 选择一个以 $x_0$ 为中心、宽度为 $W$、幅值为 $1$ 的紧支集帽形初始条件：\n$$\nu_0(x) = \n\\begin{cases}\n1,  \\text{如果 } x \\text{ 到 } x_0 \\text{ 的周期性距离 } \\le \\dfrac{W}{2},\\\\\n0,  \\text{其他情况}。\n\\end{cases}\n$$\n- 时刻 $T$ 的物理精确解是平移了 $a\\,T$ 的同一个帽形函数。因此，时刻 $T$ 的物理影响区域（精确非零区域）是在周期域上以 $x_0 + a\\,T$ 为中心、长度为 $W$ 的区间。\n\n数值依赖域长度：\n- 对于在均匀网格上应用 $n$ 次的显式迎风格式，值 $u_i^n$ 仅依赖于初始值 $\\{u_{i-k}^0\\}_{k=0}^n$。因此，物理空间中的数值依赖域最多跨越上游长度 $n\\,\\Delta x$。\n\n需要计算的可控度量：\n1. 计算时刻 $T$ 的非局域影响增长比，\n$$\nR_{\\text{nonlocal}} = \\frac{\\sum_{i=0}^{N-1} \\left|u_i^n\\right| \\,\\mathbf{1}_{\\text{outside exact support at } T}}{\\sum_{i=0}^{N-1} \\left|u_i^n\\right|},\n$$\n其中，如果 $x_i$ 位于时刻 $T$ 的精确平移帽形支集之外，则 $\\mathbf{1}_{\\text{outside exact support at } T}$ 为 $1$，否则为 $0$。该比率量化了有多少数值影响位于物理允许区域之外，并由总数值质量的绝对值进行归一化；它是无量纲的。\n2. 计算包含误差比，\n$$\n\\mu_{\\text{contain}} = \\frac{\\max\\left(0,\\,a\\,T - n\\,\\Delta x\\right)}{W},\n$$\n它量化了物理解依赖域长度中未被数值依赖域长度覆盖的部分所占的比例；它是无量纲的。\n\n实现细节：\n- 使用周期性边界条件。\n- 完全按照所述使用 $a0$ 的迎风格式。\n- 使用时刻 $T$ 的精确平移帽形函数来确定物理允许区域。\n\n单位：\n- 所有物理参数必须在国际单位制（SI）中处理：米（$\\text{m}$）和秒（$\\text{s}$）。报告的比率 $R_{\\text{nonlocal}}$ 和 $\\mu_{\\text{contain}}$ 是无量纲量；请以小数形式报告它们。\n\n测试套件：\n使用四个测试用例来探究“理想路径”、边界和违规情景：\n- 用例 1：$L = 1.0\\,\\text{m}$，$N = 400$，$a = 1.0\\,\\text{m/s}$，$W = 0.1\\,\\text{m}$，$x_0 = 0.25\\,L$，$n = 60$，$C = 0.5$。\n- 用例 2：$L = 1.0\\,\\text{m}$，$N = 400$，$a = 1.0\\,\\text{m/s}$，$W = 0.1\\,\\text{m}$，$x_0 = 0.25\\,L$，$n = 60$，$C = 1.0$。\n- 用例 3：$L = 1.0\\,\\text{m}$，$N = 400$，$a = 1.0\\,\\text{m/s}$，$W = 0.1\\,\\text{m}$，$x_0 = 0.25\\,L$，$n = 60$，$C = 1.3$。\n- 用例 4：$L = 1.0\\,\\text{m}$，$N = 400$，$a = 1.0\\,\\text{m/s}$，$W = 0.1\\,\\text{m}$，$x_0 = 0.25\\,L$，$n = 60$，$C = 2.0$。\n\n对每个用例，设置 $\\Delta x = L/N$ 和 $\\Delta t = C\\,\\Delta x/a$。然后演化 $n$ 步到达 $T = n\\,\\Delta t$，计算 $R_{\\text{nonlocal}}$ 和 $\\mu_{\\text{contain}}$。\n\n要求的最终输出格式：\n- 您的程序应生成单行输出，其中包含结果，格式为方括号内的逗号分隔列表，顺序如下\n$$\n\\left[ R_{\\text{nonlocal}}^{(1)}, \\mu_{\\text{contain}}^{(1)}, R_{\\text{nonlocal}}^{(2)}, \\mu_{\\text{contain}}^{(2)}, R_{\\text{nonlocal}}^{(3)}, \\mu_{\\text{contain}}^{(3)}, R_{\\text{nonlocal}}^{(4)}, \\mu_{\\text{contain}}^{(4)} \\right].\n$$\n换句话说，对于每个测试用例，按顺序首先输出 $R_{\\text{nonlocal}}$，然后输出 $\\mu_{\\text{contain}}$，所有值均以指定列表格式在一行上显示为小数。", "solution": "本练习的目的是通过编写一个 Python 程序，来直观地展示 Courant-Friedrichs-Lewy (CFL) 条件的重要性。我们将模拟一维线性平流方程，并观察当 Courant 数 $C$ 不同时，数值解的行为如何变化，特别是与物理真实解的偏离程度。\n\n### 算法实现\n\n代码的核心是模拟一个初始为“帽形”的波在周期性区域内的平流过程。\n\n1.  **初始化**:\n    -   我们设置一个包含 `N` 个点的均匀网格，并根据物理参数定义一个“帽形”初始条件 `u0`。这个函数在中心区域值为1，其他区域为0。\n\n2.  **时间演化**:\n    -   `upwind_evolve` 函数是模拟的核心。它通过循环 `n_steps` 次来推进时间。在每一步中，它都应用一阶迎风格式的更新规则：`u_new = (1 - C) * u_old + C * u_left`。这里的 `np.roll(u, 1)`巧妙地利用周期性边界条件实现了 `u_left`（即 $u_{i-1}$）的获取。\n\n3.  **度量计算**:\n    -   **包含误差比 (`mu_contain`)**: 此度量计算物理波传播的距离（`a * T`）超出数值信息传播距离（`n_steps * dx`）的部分。当 $C \\le 1$ 时，`a * T = a * n * C*dx/a = n*C*dx = n*dx`，因此 `mu_contain` 为0，表示数值依赖域“包含”了物理依赖域。当 $C > 1$ 时，`mu_contain` 大于0，量化了CFL条件的违反程度。\n    -   **非局域影响增长比 (`R_nonlocal`)**: 此度量计算在最终时刻 $T$，数值解的“质量”（绝对值之和）有多少泄漏到了物理上波应该存在的精确区域之外。一个理想的解该比率应为0。数值弥散会导致较小的非零值，而数值不稳定则会导致该值急剧增大至接近1。\n\n### 结果分析\n\n通过运行四个不同 `C` 值的测试用例，我们可以观察到：\n-   **用例 1 (C=0.5)**: CFL 条件满足，格式稳定。`mu_contain` 为 0。由于一阶迎风格式存在数值弥散（numerical diffusion），部分波形会“模糊化”，导致少量能量泄漏到精确区域外，因此 `R_nonlocal` 是一个较小的正数。\n-   **用例 2 (C=1.0)**: 这是边界情况。更新公式变为 `u_i^{n+1} = u_{i-1}^n`，这表示在每个时间步，波形在网格上精确地向右平移一个格点。因此，数值解与精确解几乎完全吻合，`mu_contain` 和 `R_nonlocal` 都接近0。\n-   **用例 3 (C=1.3) 和用例 4 (C=2.0)**: CFL 条件被违反，`mu_contain` 为正。更新系数 `(1-C)` 为负，破坏了凸组合性质，导致格式不稳定。数值解会出现剧烈的非物理振荡并迅速增长，其大部分“能量”都会出现在物理区域之外，导致 `R_nonlocal` 的值非常大，接近1，表示模拟结果已完全失效。\n\n这个实验清晰地揭示了CFL条件作为显式格式稳定性的“守护者”的关键作用。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef periodic_distance(x, x0, L):\n    \"\"\"Compute the minimal periodic distance on [0,L).\"\"\"\n    d = np.abs(x - x0)\n    return np.minimum(d, L - d)\n\ndef initialize_top_hat(x, x0, W, L):\n    \"\"\"Top-hat initial condition: 1 inside periodic distance = W/2, else 0.\"\"\"\n    dist = periodic_distance(x, x0, L)\n    return (dist = (W / 2.0)).astype(float)\n\ndef upwind_evolve(u0, C, n_steps):\n    \"\"\"Evolve using explicit first-order upwind scheme for a > 0 with periodic BC.\"\"\"\n    u = u0.copy()\n    for _ in range(n_steps):\n        # u^{n+1} = (1 - C) * u^n + C * u_{i-1}^n, with periodic shift by +1 index\n        u = (1.0 - C) * u + C * np.roll(u, 1)\n    return u\n\ndef exact_support_mask(x, x_center, W, L):\n    \"\"\"Mask for exact support (1 inside top-hat centered at x_center, else 0).\"\"\"\n    dist = periodic_distance(x, x_center, L)\n    return (dist = (W / 2.0)).astype(float)\n\ndef nonlocal_influence_ratio(u, mask):\n    \"\"\"Compute R_nonlocal = mass outside exact support / total mass (absolute).\"\"\"\n    abs_u = np.abs(u)\n    total_mass = abs_u.sum()\n    if total_mass == 0.0 or np.isinf(total_mass) or np.isnan(total_mass):\n        return 1.0 # If it blows up, all mass is non-local\n    outside = (mask == 0.0)\n    nonlocal_mass = abs_u[outside].sum()\n    return float(nonlocal_mass / total_mass)\n\ndef containment_error_ratio(a, T, n_steps, dx, W):\n    \"\"\"Compute mu_contain = max(0, a T - n dx) / W.\"\"\"\n    reach_phys = a * T\n    reach_num = n_steps * dx\n    return float(max(0.0, reach_phys - reach_num) / W)\n\ndef run_case(L, N, a, W, x0, n_steps, C):\n    # Grid and steps\n    dx = L / N\n    dt = C * dx / a\n    T = n_steps * dt\n\n    # Initialize grid and top-hat\n    x = np.arange(N) * dx\n    u0 = initialize_top_hat(x, x0, W, L)\n\n    # Evolve numerically\n    uN = upwind_evolve(u0, C, n_steps)\n\n    # Exact support at time T\n    x_center_T = (x0 + a * T) % L\n    mask_exact = exact_support_mask(x, x_center_T, W, L)\n\n    # Measures\n    R_nonlocal = nonlocal_influence_ratio(uN, mask_exact)\n    mu_contain = containment_error_ratio(a, T, n_steps, dx, W)\n    return R_nonlocal, mu_contain\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (L [m], N, a [m/s], W [m], x0 [m], n_steps, C)\n    L = 1.0\n    N = 400\n    a = 1.0\n    W = 0.1\n    x0 = 0.25 * L\n    n_steps = 60\n\n    test_cases = [\n        (L, N, a, W, x0, n_steps, 0.5),  # Case 1: happy path\n        (L, N, a, W, x0, n_steps, 1.0),  # Case 2: boundary\n        (L, N, a, W, x0, n_steps, 1.3),  # Case 3: violation\n        (L, N, a, W, x0, n_steps, 2.0),  # Case 4: strong violation\n    ]\n\n    results = []\n    for case in test_cases:\n        R_nonlocal, mu_contain = run_case(*case)\n        # Format to a reasonable precision\n        results.append(f\"{R_nonlocal:.6f}\")\n        results.append(f\"{mu_contain:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3372295"}]}