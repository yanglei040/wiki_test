{"hands_on_practices": [{"introduction": "在验证数值求解器之前，我们首先需要一个已知精确解的基准问题。本练习将介绍在计算科学中用于软件验证的强大工具——“人造解方法”(Method of Manufactured Solutions, MMS)。你将从一个预先设定的解析函数出发，反向推导出使其成为控制偏微分方程精确解所必需的源项和边界条件，从而深刻理解一个解与问题定义之间是如何紧密关联的。[@problem_id:3333209]", "problem": "考虑一个有限区间上的一维热传导问题，其位置坐标为 $x \\in [0,L]$，时间为 $t \\ge 0$，该问题由能量守恒和傅里叶热传导定律控制。设热扩散系数为正常数 $\\kappa  0$。包含一个（待定）体积源项的控制方程为\n$$\n\\frac{\\partial u}{\\partial t} - \\kappa \\frac{\\partial^{2} u}{\\partial x^{2}} = s(x,t),\n$$\n在 $x=0$ 处为混合（罗宾）边界条件，在 $x=L$ 处为诺伊曼边界条件，\n$$\n\\kappa \\frac{\\partial u}{\\partial x}(0,t) + \\beta\\, u(0,t) = r(t), \\qquad \\kappa \\frac{\\partial u}{\\partial x}(L,t) = q_{N}(t),\n$$\n其中 $\\beta0$ 是一个给定的常数。为了检验罗宾边界实现中的两项并确保一个非平凡的诺伊曼通量，采用人工解方法，并选择如下解：\n$$\nu(x,t) = \\exp(\\sigma t)\\,\\cos(a x) + x\\,\\exp(\\gamma t),\n$$\n其中 $a0$，$\\sigma \\in \\mathbb{R}$ 和 $\\gamma \\in \\mathbb{R}$ 是常数，且 $\\sigma \\ne \\gamma$。从热方程和边界条件的定义出发，以闭合形式计算源项 $s(x,t)$、罗宾边界数据 $r(t)$、诺伊曼边界数据 $q_{N}(t)$ 以及初始条件 $u(x,0)$，使得该人工解对所有 $x \\in [0,L]$ 和所有 $t \\ge 0$ 都满足此问题。将您的最终答案表示为一个单行矩阵，按顺序包含 $s(x,t)$、$r(t)$、$q_{N}(t)$ 和 $u(x,0)$。不要进行任何数值取整；答案需保留精确的解析形式。所有符号代表物理量，其量纲由热方程所隐含；本问题不需要具体单位。", "solution": "在尝试求解之前，对问题进行验证。\n\n### 步骤 1：提取已知条件\n- **控制方程**：$\\frac{\\partial u}{\\partial t} - \\kappa \\frac{\\partial^{2} u}{\\partial x^{2}} = s(x,t)$，对于 $x \\in [0,L]$ 和 $t \\ge 0$。\n- **热扩散系数**：$\\kappa$ 是一个正常数，$\\kappa  0$。\n- **$x=0$ 处的罗宾边界条件**：$\\kappa \\frac{\\partial u}{\\partial x}(0,t) + \\beta\\, u(0,t) = r(t)$，其中 $\\beta$ 是一个正常数，$\\beta  0$。\n- **$x=L$ 处的诺伊曼边界条件**：$\\kappa \\frac{\\partial u}{\\partial x}(L,t) = q_{N}(t)$。\n- **人工解**：$u(x,t) = \\exp(\\sigma t)\\,\\cos(a x) + x\\,\\exp(\\gamma t)$。\n- **常数**：$a0$，$\\sigma \\in \\mathbb{R}$，$\\gamma \\in \\mathbb{R}$，且 $\\sigma \\ne \\gamma$。\n- **目标**：计算源项 $s(x,t)$、罗宾边界数据 $r(t)$、诺伊曼边界数据 $q_{N}(t)$ 和初始条件 $u(x,0)$。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据验证标准评估问题陈述。\n- **有科学依据**：该问题基于一维热方程，这是输运现象的基石。人工解方法是用于验证偏微分方程数值算法的一种标准的、数学上可靠的技术。该设置在科学和数学上都是有效的。\n- **适定性**：该问题要求确定与给定解一致的源项和边界项。这是一个直接计算，而不是求解反问题。任务定义明确，对于给定的人工解 $u(x,t)$，可以得到一组唯一的函数（$s(x,t)$, $r(t)$, $q_N(t)$, $u(x,0)$）。\n- **客观性**：问题使用精确的数学语言陈述，没有歧义或主观论断。\n- **完整性和一致性**：所有必要的组成部分——控制偏微分方程、边界条件的形式以及人工解——都已提供。没有内部矛盾。例如，陈述了条件 $\\sigma \\ne \\gamma$，这确保了解的两个时间分量是不同的，尽管对于接下来的计算，这个条件并非严格必要。所有参数都已明确定义。\n\n### 步骤 3：结论与行动\n该问题是**有效的**，因为它有科学依据、适定、客观且自洽。将提供解答。\n\n人工解方法涉及将所选的解析函数 $u(x,t)$ 代入控制偏微分方程及其边界条件中，以推导出必要的源项和边界数据。\n\n给定的人工解是：\n$$\nu(x,t) = \\exp(\\sigma t)\\,\\cos(a x) + x\\,\\exp(\\gamma t)\n$$\n为了继续，我们必须计算 $u(x,t)$ 的相关偏导数。\n\n首先，关于时间 $t$ 的偏导数：\n$$\n\\frac{\\partial u}{\\partial t} = \\frac{\\partial}{\\partial t} \\left( \\exp(\\sigma t)\\,\\cos(a x) + x\\,\\exp(\\gamma t) \\right) = \\sigma \\exp(\\sigma t)\\,\\cos(a x) + \\gamma x\\,\\exp(\\gamma t)\n$$\n\n接下来，关于位置 $x$ 的一阶偏导数：\n$$\n\\frac{\\partial u}{\\partial x} = \\frac{\\partial}{\\partial x} \\left( \\exp(\\sigma t)\\,\\cos(a x) + x\\,\\exp(\\gamma t) \\right) = -a \\exp(\\sigma t)\\,\\sin(a x) + \\exp(\\gamma t)\n$$\n\n最后，关于位置 $x$ 的二阶偏导数：\n$$\n\\frac{\\partial^{2} u}{\\partial x^{2}} = \\frac{\\partial}{\\partial x} \\left( -a \\exp(\\sigma t)\\,\\sin(a x) + \\exp(\\gamma t) \\right) = -a^2 \\exp(\\sigma t)\\,\\cos(a x)\n$$\n\n有了这些导数，我们就可以确定每个所需的项。\n\n**1. 源项 $s(x,t)$**\n将导数代入控制方程，得到源项 $s(x,t)$：\n$$\ns(x,t) = \\frac{\\partial u}{\\partial t} - \\kappa \\frac{\\partial^{2} u}{\\partial x^{2}}\n$$\n$$\ns(x,t) = \\left( \\sigma \\exp(\\sigma t)\\,\\cos(a x) + \\gamma x\\,\\exp(\\gamma t) \\right) - \\kappa \\left( -a^2 \\exp(\\sigma t)\\,\\cos(a x) \\right)\n$$\n合并各项，我们得到：\n$$\ns(x,t) = (\\sigma + \\kappa a^2) \\exp(\\sigma t)\\,\\cos(a x) + \\gamma x\\,\\exp(\\gamma t)\n$$\n\n**2. 罗宾边界数据 $r(t)$**\n在 $x=0$ 处的罗宾边界数据 $r(t)$ 由以下公式给出：\n$$\nr(t) = \\kappa \\frac{\\partial u}{\\partial x}(0,t) + \\beta\\, u(0,t)\n$$\n我们需要在 $x=0$ 处计算 $u(x,t)$ 和 $\\frac{\\partial u}{\\partial x}(x,t)$ 的值：\n$$\nu(0,t) = \\exp(\\sigma t)\\,\\cos(a \\cdot 0) + 0 \\cdot \\exp(\\gamma t) = \\exp(\\sigma t)\\,\\cos(0) = \\exp(\\sigma t)\n$$\n$$\n\\frac{\\partial u}{\\partial x}(0,t) = -a \\exp(\\sigma t)\\,\\sin(a \\cdot 0) + \\exp(\\gamma t) = -a \\exp(\\sigma t)\\,\\sin(0) + \\exp(\\gamma t) = \\exp(\\gamma t)\n$$\n将这些代入 $r(t)$ 的表达式中：\n$$\nr(t) = \\kappa (\\exp(\\gamma t)) + \\beta (\\exp(\\sigma t)) = \\beta \\exp(\\sigma t) + \\kappa \\exp(\\gamma t)\n$$\n\n**3. 诺伊曼边界数据 $q_{N}(t)$**\n在 $x=L$ 处的诺伊曼边界数据 $q_{N}(t)$ 定义为：\n$$\nq_{N}(t) = \\kappa \\frac{\\partial u}{\\partial x}(L,t)\n$$\n我们在 $x=L$ 处计算 $\\frac{\\partial u}{\\partial x}(x,t)$ 的值：\n$$\n\\frac{\\partial u}{\\partial x}(L,t) = -a \\exp(\\sigma t)\\,\\sin(a L) + \\exp(\\gamma t)\n$$\n因此，$q_N(t)$ 为：\n$$\nq_{N}(t) = \\kappa \\left( \\exp(\\gamma t) - a \\sin(a L) \\exp(\\sigma t) \\right)\n$$\n\n**4. 初始条件 $u(x,0)$**\n初始条件是解在时间 $t=0$ 时的值：\n$$\nu(x,0) = u(x,t)\\big|_{t=0} = \\exp(\\sigma \\cdot 0)\\,\\cos(a x) + x\\,\\exp(\\gamma \\cdot 0)\n$$\n$$\nu(x,0) = \\exp(0)\\,\\cos(a x) + x\\,\\exp(0) = 1 \\cdot \\cos(a x) + x \\cdot 1\n$$\n$$\nu(x,0) = \\cos(a x) + x\n$$\n\n四个所需的量都已以闭合形式确定。将它们收集起来形成最终答案。", "answer": "$$\n\\boxed{\\begin{pmatrix} (\\sigma + \\kappa a^2) \\exp(\\sigma t)\\cos(a x) + \\gamma x\\exp(\\gamma t) \\quad \\beta \\exp(\\sigma t) + \\kappa \\exp(\\gamma t) \\quad \\kappa (\\exp(\\gamma t) - a \\sin(a L) \\exp(\\sigma t)) \\quad \\cos(a x) + x \\end{pmatrix}}\n$$", "id": "3333209"}, {"introduction": "像有限体积法（FVM）这样的数值方法操作的是离散的代数方程，而非连续函数。计算流体动力学中的一个关键步骤，就是将边界上的连续物理定律转化为这种离散语言。在本练习中，你将推导在施加了Robin条件的边界上，通过一个面的扩散通量的离散形式——这是传热问题中的常见情景。这一实践揭示了连续的边界条件是如何直接影响求解器最终将组装和求解的离散线性系统系数的。[@problem_id:3333247]", "problem": "考虑一个有界域内由纯扩散物理主导的标量输运问题，该问题通过有限体积法（FVM）进行离散。设 $\\Omega_P$ 表示一个控制体，其形心位于 $\\mathbf{x}_P$，设 $\\Gamma_f$ 为一个平面边界网格面，其面积为 $A_f$，外向单位法向量为 $\\hat{\\mathbf{n}}_f$，形心位于 $\\mathbf{x}_f$。假设扩散系数 $\\kappa0$ 为各向同性的常数，并且在 $\\Gamma_f$ 上施加 Robin 边界条件，其形式为 $\\kappa\\,\\partial u/\\partial n + \\beta\\,u = \\beta\\,g$，其中 $\\beta \\ge 0$，$g$ 是给定的面数据。外法向导数定义为在 $\\mathbf{x}_f$ 处计算的 $\\partial u/\\partial n = \\nabla u \\cdot \\hat{\\mathbf{n}}_f$。\n\n在有限体积法实现中，使用单元形心和面形心之间沿法向的线性外推来近似 $\\mathbf{x}_f$ 处的法向导数，即 $\\partial u/\\partial n \\approx (u_f - u_P)/\\delta_{Pf}$，其中 $u_P$ 是位于 $\\mathbf{x}_P$ 的单元中心值，$u_f$ 是位于 $\\mathbf{x}_f$ 的面中心值，$\\delta_{Pf} = (\\mathbf{x}_f - \\mathbf{x}_P)\\cdot \\hat{\\mathbf{n}}_f$ 是从 $\\mathbf{x}_P$ 到 $\\mathbf{x}_f$ 的带符号法向距离。\n\n从扩散通量的定义（本构关系的面积分）出发，推导穿过 $\\Gamma_f$ 的离散扩散通量，使其仅用 $u_P$、$g$、$\\kappa$、$\\beta$、$\\delta_{Pf}$ 和 $A_f$ 表示。然后通过 $\\Phi_f = C_f\\,(u_P - g)$ 定义有效面系数 $C_f$，其中 $\\Phi_f$ 是与 $\\Omega_P$ 相关的、穿过 $\\Gamma_f$ 的外向扩散通量。计算 $C_f$ 的闭式表达式。\n\n你的最终答案必须是 $C_f$ 的单个闭式解析表达式。不需要进行数值计算。", "solution": "该问题要求在有限体积法（FVM）的框架下，推导由 Robin 边界条件控制的、穿过边界面的扩散通量的有效面系数 $C_f$。\n\n穿过控制体 $\\Omega_P$ 边界网格面 $\\Gamma_f$ 的外向扩散通量 $\\Phi_f$ 定义为通量矢量的面积分。各向同性扩散的本构关系（菲克定律或傅里叶定律）指出，通量矢量为 $\\mathbf{q} = -\\kappa \\nabla u$，其中 $\\kappa$ 是扩散系数，$u$ 是标量场。因此，总外向通量为：\n$$\n\\Phi_f = \\int_{\\Gamma_f} (-\\kappa \\nabla u) \\cdot \\hat{\\mathbf{n}}_f \\, dS\n$$\n其中 $\\hat{\\mathbf{n}}_f$ 是面 $\\Gamma_f$ 的外向单位法向量，$dS$ 是面元。\n\n在有限体积法中，我们对该积分进行近似。鉴于面 $\\Gamma_f$ 是面积为 $A_f$ 的平面，且扩散系数 $\\kappa$ 为常数，我们可以假设被积函数在整个面上为常数，且等于其在面形心 $\\mathbf{x}_f$ 处的值，从而近似该积分。这得到：\n$$\n\\Phi_f \\approx A_f (-\\kappa \\nabla u \\cdot \\hat{\\mathbf{n}}_f)\\big|_{\\mathbf{x}_f}\n$$\n项 $\\nabla u \\cdot \\hat{\\mathbf{n}}_f$ 是法向导数 $\\partial u / \\partial n$ 的定义。因此，离散通量为：\n$$\n\\Phi_f \\approx -A_f \\kappa \\left(\\frac{\\partial u}{\\partial n}\\right)\\bigg|_{\\mathbf{x}_f}\n$$\n该表达式依赖于面上的法向导数，而法向导数必须通过边界条件和有限体积法离散格式来确定。\n\n我们有两个涉及面法向导数的关键信息：\n1.  在面形心 $\\mathbf{x}_f$ 处计算的 Robin 边界条件：\n    $$\n    \\kappa \\left(\\frac{\\partial u}{\\partial n}\\right)\\bigg|_{\\mathbf{x}_f} + \\beta u_f = \\beta g\n    $$\n    其中 $u_f$ 是标量场 $u$ 在面形心处的值。由此，我们可以将 $\\kappa (\\partial u/\\partial n)$ 项表示为：\n    $$\n    \\kappa \\left(\\frac{\\partial u}{\\partial n}\\right)\\bigg|_{\\mathbf{x}_f} = \\beta (g - u_f)\n    $$\n2.  基于单元中心值 $u_P$ 和面中心值 $u_f$ 之间线性外推的法向导数的有限体积法近似：\n    $$\n    \\left(\\frac{\\partial u}{\\partial n}\\right)\\bigg|_{\\mathbf{x}_f} \\approx \\frac{u_f - u_P}{\\delta_{Pf}}\n    $$\n    其中 $\\delta_{Pf} = (\\mathbf{x}_f - \\mathbf{x}_P)\\cdot \\hat{\\mathbf{n}}_f$ 是从单元形心到面形心的带符号法向距离。两边乘以 $\\kappa$ 得到：\n    $$\n    \\kappa \\left(\\frac{\\partial u}{\\partial n}\\right)\\bigg|_{\\mathbf{x}_f} \\approx \\frac{\\kappa}{\\delta_{Pf}} (u_f - u_P)\n    $$\n我们的目标是找到通量 $\\Phi_f$ 的一个表达式，该表达式仅依赖于单元中心值 $u_P$、边界数据 $g$ 以及已知的几何和物理参数。面值 $u_f$ 是一个必须消去的未知数。我们可以通过令 $\\kappa (\\partial u / \\partial n)|_{\\mathbf{x}_f}$ 的两个表达式相等来实现这一点：\n$$\n\\beta (g - u_f) = \\frac{\\kappa}{\\delta_{Pf}} (u_f - u_P)\n$$\n现在，我们求解这个方程以得到 $u_f$：\n$$\n\\beta g - \\beta u_f = \\frac{\\kappa}{\\delta_{Pf}} u_f - \\frac{\\kappa}{\\delta_{Pf}} u_P\n$$\n$$\n\\beta g + \\frac{\\kappa}{\\delta_{Pf}} u_P = u_f \\left( \\beta + \\frac{\\kappa}{\\delta_{Pf}} \\right)\n$$\n$$\nu_f = \\frac{\\beta g + \\frac{\\kappa}{\\delta_{Pf}} u_P}{\\beta + \\frac{\\kappa}{\\delta_{Pf}}}\n$$\n为了简化，我们将分子和分母同乘以 $\\delta_{Pf}$：\n$$\nu_f = \\frac{\\beta \\delta_{Pf} g + \\kappa u_P}{\\beta \\delta_{Pf} + \\kappa}\n$$\n现在我们可以用已知量来表示通量 $\\Phi_f$。我们将 $u_f$ 的表达式代入有限体积法近似的通量方程 $\\Phi_f \\approx -A_f \\frac{\\kappa}{\\delta_{Pf}} (u_f - u_P)$：\n$$\n\\Phi_f = -A_f \\frac{\\kappa}{\\delta_{Pf}} \\left( \\frac{\\beta \\delta_{Pf} g + \\kappa u_P}{\\beta \\delta_{Pf} + \\kappa} - u_P \\right)\n$$\n为了简化括号中的项，我们进行通分：\n$$\n\\frac{\\beta \\delta_{Pf} g + \\kappa u_P}{\\beta \\delta_{Pf} + \\kappa} - u_P = \\frac{(\\beta \\delta_{Pf} g + \\kappa u_P) - u_P(\\beta \\delta_{Pf} + \\kappa)}{\\beta \\delta_{Pf} + \\kappa}\n$$\n$$\n= \\frac{\\beta \\delta_{Pf} g + \\kappa u_P - \\beta \\delta_{Pf} u_P - \\kappa u_P}{\\beta \\delta_{Pf} + \\kappa}\n$$\n$$\n= \\frac{\\beta \\delta_{Pf} g - \\beta \\delta_{Pf} u_P}{\\beta \\delta_{Pf} + \\kappa} = \\frac{\\beta \\delta_{Pf} (g - u_P)}{\\kappa + \\beta \\delta_{Pf}}\n$$\n将这个简化后的表达式代回 $\\Phi_f$ 的方程中：\n$$\n\\Phi_f = -A_f \\frac{\\kappa}{\\delta_{Pf}} \\left( \\frac{\\beta \\delta_{Pf} (g - u_P)}{\\kappa + \\beta \\delta_{Pf}} \\right)\n$$\n分子和分母中的 $\\delta_{Pf}$ 项相互抵消：\n$$\n\\Phi_f = -A_f \\kappa \\left( \\frac{\\beta (g - u_P)}{\\kappa + \\beta \\delta_{Pf}} \\right)\n$$\n为了匹配先验形式 $\\Phi_f = C_f(u_P - g)$，我们将负号吸收到括号项中：\n$$\n\\Phi_f = A_f \\kappa \\left( \\frac{\\beta (u_P - g)}{\\kappa + \\beta \\delta_{Pf}} \\right)\n$$\n重新整理以分离出 $(u_P - g)$ 的系数：\n$$\n\\Phi_f = \\left( \\frac{A_f \\kappa \\beta}{\\kappa + \\beta \\delta_{Pf}} \\right) (u_P - g)\n$$\n通过与所要求的形式 $\\Phi_f = C_f(u_P - g)$ 直接比较，我们可以确定有效面系数 $C_f$：\n$$\nC_f = \\frac{A_f \\kappa \\beta}{\\kappa + \\beta \\delta_{Pf}}\n$$\n该表达式仅依赖于给定的物理和几何参数，符合要求。", "answer": "$$\n\\boxed{\\frac{A_f \\kappa \\beta}{\\kappa + \\beta \\delta_{Pf}}}\n$$", "id": "3333247"}, {"introduction": "仅仅施加边界条件是不够的；它们必须在物理上和数学上都与控制方程相容。这个高级实践将一个简单的一维Stokes流求解器作为“实验室”，来探究“适定性”(well-posedness)的概念。通过分析因施加了过多的边界条件而导致的不适定问题，你将学会如何通过分析生成的线性系统的秩来诊断数学上的不相容性，这是一项调试复杂不可压缩流模拟的实用技能。[@problem_id:3333246]", "problem": "要求您实现并分析一个用于稳态一维不可压缩斯托克斯方程的最小有限差分求解器，以验证狄利克雷（Dirichlet）、诺伊曼（Neumann）和罗宾（Robin）边界条件的实现，并诊断由过定入流条件引发的不适定性。数学模型是定义在长度为 $L$ 的域上的稳态一维不可压缩斯托克斯（Stokes）系统，其运动粘度为 $\\nu$，由连续性方程和动量方程组成，\n$$\n\\frac{d u}{d x} = 0, \\quad -\\nu \\frac{d^2 u}{d x^2} + \\frac{d p}{d x} = 0,\n$$\n其中 $u(x)$ 是速度，$p(x)$ 是压力。假设所有量均为无量纲。您的实现应在具有 $N$ 个节点、间距为 $h = L/(N-1)$ 的均匀网格上，对内部节点使用二阶中心有限差分，并通过将边界条件与内部有限差分方程一起组装成代数方程来施加，从而使方程总数等于未知数总数。未知量向量的顺序是所有节点的速度，后跟所有节点的压力，即 $x = [u_0,\\dots,u_{N-1}, p_0,\\dots,p_{N-1}]^\\top$。\n\n从以下基本概念开始：\n- 不可压缩性约束 $\\frac{d u}{d x} = 0$。\n- 无体力情况下的线性动量平衡 $-\\nu \\frac{d^2 u}{d x^2} + \\frac{d p}{d x} = 0$。\n- 边界条件的分类：\n  - 场 $q$ 的狄利克雷（Dirichlet）条件：在边界点上 $q = q_D$。\n  - 场 $q$ 的诺伊曼（Neumann）条件：在边界点上 $\\frac{d q}{d n} = q_N$，在一维中通过左边界的单边差分 $\\frac{q_1 - q_0}{h}$ 和右边界的 $\\frac{q_{N-1} - q_{N-2}}{h}$ 实现。\n  - $u$ 的罗宾（Robin）条件：在边界点上 $\\alpha u + \\beta \\frac{d u}{d n} = \\gamma$，其中系数 $\\alpha$、$\\beta$ 和数据 $\\gamma$ 已知。\n- 需要单一压力参考点以消除常数压力零空间。\n- 代数秩诊断：对于线性系统 $A x = b$，如果 $\\operatorname{rank}(A)  \\operatorname{rank}([A \\mid b])$，则系统不一致（无解）。如果 $\\operatorname{rank}(A)$ 严格小于未知数的数量，则系统欠定（非唯一解）。数值秩必须使用奇异值分解和一个小容差来计算。\n\n使用以下公式对内部节点 $i = 1,\\dots,N-2$ 上的方程进行离散化：\n- 连续性方程：$(u_{i+1} - u_{i-1})/(2h) = 0$。\n- 动量方程：$-\\nu (u_{i-1} - 2 u_{i} + u_{i+1})/h^2 + (p_{i+1} - p_{i-1})/(2 h) = 0$。\n\n通过包含所有内部方程和恰好四个边界（或参考）方程来组装一个方阵线性系统 $A x = b$，以使系统是方阵。根据上面给出的代数形式实现狄利克雷（Dirichlet）、诺伊曼（Neumann）和罗宾（Robin）边界条件。\n\n构建一个验证案例，该案例由于过定的入流条件（在入流处同时对 $u$ 和 $p$ 施加狄利克雷条件）而表现出不适定性，并通过证明数值秩亏或不一致性来诊断这种不适定性。然后，展示一个与特征相容的、简化为适定狄利克雷/诺伊曼混合问题的方案：在入流速度上施加狄利克雷条件，在入流压力上施加诺伊曼（零梯度）条件，并除了在出流处为 $u$ 施加适当条件（使用罗宾条件）之外，还包括一个单一压力参考点（在单个点上的狄利克雷条件）。\n\n您的程序必须实现以下具有指定参数的测试套件，并以指定格式生成结果。所有量均为无量纲。\n\n令 $L = 1$，$\\nu = 1$，$N = 10$，入流速度 $U_0 = 1$，压力值 $P_0 = 0$，$P_1 = 1$。对于罗宾（Robin）边界条件，使用单边有限差分计算导数。对于数值秩计算，使用奇异值容差 $\\tau = 10^{-10}$。\n\n定义四个测试案例：\n\n- 测试 1（适定的狄利克雷/诺伊曼/罗宾混合条件）：施加 $u(0) = U_0$，在 $x = L$ 处施加罗宾条件，参数为 $\\alpha = 1$, $\\beta = 0$, $\\gamma = U_0$（这实际上强制 $u(L) = U_0$），施加诺伊曼条件 $\\frac{d p}{d x}(0) = 0$，并施加单一压力参考 $p(0) = 0$。求解该系统，并返回残差的欧几里得范数 $\\|A x - b\\|_2$，结果为浮点数。\n\n- 测试 2（入流过定且出流处压力狄利克雷条件不相容）：施加 $u(0) = U_0$、$p(0) = P_0$、$u(L) = U_0$（通过参数为 $\\alpha = 1$, $\\beta = 0$, $\\gamma = U_0$ 的罗宾条件）以及 $p(L) = P_1$（其中 $P_1 \\neq P_0$）。组装系统并使用给定容差计算数值秩 $r_A = \\operatorname{rank}(A)$ 和 $r_{aug} = \\operatorname{rank}([A \\mid b])$。返回布尔值 $r_{aug}  r_A$ 以指示不一致性。\n\n- 测试 3（测试2的特征相容简化）：将测试2中的入流压力狄利克雷条件 $p(0) = P_0$ 替换为入流压力诺伊曼条件 $\\frac{d p}{d x}(0) = 0$。保持 $u(0) = U_0$ 和 $u(L) = U_0$（通过参数为 $\\alpha = 1$, $\\beta = 0$, $\\gamma = U_0$ 的罗宾条件），并设置单一压力参考 $p(0) = 0$。求解该系统，并返回残差的欧几里得范数 $\\|A x - b\\|_2$，结果为浮点数。\n\n- 测试 4（出流处为真实罗宾条件的边缘案例）：施加 $u(0) = U_0$，在 $x=L$ 处施加参数为 $\\alpha = 0$, $\\beta = 1$, $\\gamma = 0$ 的罗宾条件（这强制 $\\frac{d u}{d x}(L) = 0$），施加 $\\frac{d p}{d x}(0) = 0$，并施加单一压力参考 $p(0) = 0$。求解该系统，并返回平均绝对离散速度梯度 $\\frac{1}{N-1} \\sum_{i=0}^{N-2} \\left|\\frac{u_{i+1} - u_i}{h}\\right|$，结果为浮点数。由于不可压缩性约束，该值应很小。\n\n最终输出格式：您的程序应生成单行输出，其中包含四个测试的结果，格式为逗号分隔的列表，并用方括号括起来（例如，`[res1,res2,res3,res4]`）。第一、三、四项必须是浮点数；第二项必须是布尔值。所有计算都是无量纲的。不涉及角度。不使用百分比。", "solution": "该问题要求实现一个用于稳态不可压缩斯托克斯方程的一维有限差分求解器，该方程定义在长度为 $L$ 的域上。控制方程为连续性方程 $\\frac{d u}{d x} = 0$ 和动量方程 $-\\nu \\frac{d^2 u}{d x^2} + \\frac{d p}{d x} = 0$，其中 $u(x)$ 是速度，$p(x)$ 是压力，$\\nu$ 是运动粘度。我们构建一个线性代数系统 $A x = b$，并分析其在不同边界条件下的性质，以理解适定性。\n\n该域使用具有 $N$ 个节点的均匀网格进行离散化，节点索引为 $i=0, 1, \\dots, N-1$。网格间距为 $h = L/(N-1)$。未知量向量 $x$ 的大小为 $2N$，其结构是通过连接速度未知量和压力未知量构成的：\n$$\nx = [u_0, u_1, \\dots, u_{N-1}, p_0, p_1, \\dots, p_{N-1}]^\\top\n$$\n线性系统 $A x = b$ 由 $2N$ 个方程构成。其中，$2(N-2)$ 个方程来自对内部节点（$i=1, \\dots, N-2$）的控制偏微分方程进行离散化，其余 4 个方程源自边界条件和压力参考条件。\n\n内部方程使用二阶中心差分进行离散化：\n1.  **连续性方程**：对于 $i = 1, \\dots, N-2$，方程 $\\frac{d u}{d x} = 0$ 被离散化为：\n    $$\n    \\frac{u_{i+1} - u_{i-1}}{2h} = 0\n    $$\n    该方程影响矩阵 $A$ 中对应于未知量 $u_{i-1}$ 和 $u_{i+1}$ 的项。对于 $A$ 中代表该方程的行，我们将 $u_{i-1}$ 的系数设为 $-1/(2h)$，将 $u_{i+1}$ 的系数设为 $1/(2h)$。\n\n2.  **动量方程**：对于 $i = 1, \\dots, N-2$，方程 $-\\nu \\frac{d^2 u}{d x^2} + \\frac{d p}{d x} = 0$ 被离散化为：\n    $$\n    -\\nu \\frac{u_{i-1} - 2u_i + u_{i+1}}{h^2} + \\frac{p_{i+1} - p_{i-1}}{2h} = 0\n    $$\n    该方程涉及未知量 $u_{i-1}, u_i, u_{i+1}$ 和 $p_{i-1}, p_{i+1}$。对于 $A$ 中代表该方程的行，系数为：\n    - 对于 $u_{i-1}$：$-\\nu/h^2$\n    - 对于 $u_i$：$2\\nu/h^2$\n    - 对于 $u_{i+1}$：$-\\nu/h^2$\n    - 对于 $p_{i-1}$（在列索引 $N+i-1$ 处）：$-1/(2h)$\n    - 对于 $p_{i+1}$（在列索引 $N+i+1$ 处）：$1/(2h)$\n\n边界条件作为代数方程实现，构成系统的最后 4 行。\n-   **狄利克雷（Dirichlet）条件**：在节点 $k$ 上的场 $q$，$q_k = q_D$，得到的方程在对应 $q_k$ 的列中为 1，在 $b$ 的相应条目中为值 $q_D$。\n-   **诺伊曼（Neumann）条件**：$\\frac{dq}{dn} = q_N$ 使用一阶单边差分进行离散化。在左边界（$i=0$），这表示为 $\\frac{q_1 - q_0}{h} = q_N$。在右边界（$i=N-1$），这表示为 $\\frac{q_{N-1} - q_{N-2}}{h} = q_N$。\n-   **罗宾（Robin）条件**：在边界节点上的 $\\alpha u + \\beta \\frac{du}{dn} = \\gamma$ 也类似地进行离散化。在左边界（$i=0$），它变为 $\\alpha u_0 + \\beta \\frac{u_1 - u_0}{h} = \\gamma$。在右边界（$i=N-1$），它变为 $\\alpha u_{N-1} + \\beta \\frac{u_{N-1} - u_{N-2}}{h} = \\gamma$。\n\n控制方程的解析解为 $u(x) = C_1$ 和 $p(x) = C_2$，其中 $C_1$ 和 $C_2$ 是常数。这意味着速度场是恒定的，压力场也是恒定的。压力仅能确定到一个相加常数，这产生了一个零空间。为了获得唯一解，需要一个单一的压力参考点，例如将压力在某一点的值固定（如 $p_0=0$）。\n\n现在我们使用参数 $L=1$, $\\nu=1$, $N=10$, $U_0=1$, $P_0=0$, $P_1=1$ 以及用于秩计算的奇异值容差 $\\tau=10^{-10}$ 来分析四个指定的测试案例。网格间距为 $h=1/(10-1) = 1/9$。\n\n**测试 1（适定的狄利克雷/诺伊曼/罗宾混合条件）：**\n四个边界/参考条件是：\n1.  $u(0) = U_0 \\implies u_0 = 1$（在 $x=0$ 处对 $u$ 的狄利克雷条件）\n2.  在 $x=L$ 处的罗宾条件，参数为 $\\alpha=1, \\beta=0, \\gamma=U_0$: $1 \\cdot u_{N-1} + 0 \\cdot (\\dots) = 1 \\implies u_9=1$（实际上是在 $x=L$ 处对 $u$ 的狄利克雷条件）\n3.  $\\frac{dp}{dx}(0) = 0 \\implies \\frac{p_1-p_0}{h} = 0$（在 $x=0$ 处对 $p$ 的诺伊曼条件）\n4.  $p(0) = P_0 \\implies p_0 = 0$（压力参考）\n该系统是适定的。与这些条件相容的解析解是 $u(x)=1$ 和 $p(x)=0$。离散系统应得到一个非常接近此解的结果，因此残差 $\\|Ax-b\\|_2$ 预计接近机器精度。\n\n**测试 2（入流过定且出流处压力狄利克雷条件不相容）：**\n四个边界条件是：\n1.  $u(0) = U_0 \\implies u_0 = 1$\n2.  $p(0) = P_0 \\implies p_0 = 0$\n3.  $u(L) = U_0 \\implies u_9 = 1$\n4.  $p(L) = P_1 \\implies p_9 = 1$\n该系统是不适定的。动量方程在速度恒定时意味着 $\\frac{dp}{dx}=0$，即压力必须是常数。条件 $p(0)=0$ 和 $p(L)=1$ 是矛盾的。这导致了一个不一致的线性系统。秩亏诊断应该能揭示这一点：我们期望 $\\operatorname{rank}(A)  \\operatorname{rank}([A \\mid b])$，其中 $[A \\mid b]$ 是增广矩阵。\n\n**测试 3（测试2的特征相容简化）：**\n边界/参考条件是：\n1.  $u(0) = U_0 \\implies u_0 = 1$\n2.  $u(L) = U_0 \\implies u_9 = 1$\n3.  $\\frac{dp}{dx}(0)=0 \\implies \\frac{p_1-p_0}{h} = 0$\n4.  $p(0)=0$（压力参考）\n这组条件与测试1相同。它代表了对测试2中不适定系统的一种适定替代方案，通过用一个与恒定压力场的物理特性一致的入流压力诺伊曼条件替换了有问题的出流压力狄利克雷条件。预期的结果与测试1相同：一个接近零的残差。\n\n**测试 4（出流处为真实罗宾条件的边缘案例）：**\n四个边界/参考条件是：\n1.  $u(0) = U_0 \\implies u_0 = 1$\n2.  在 $x=L$ 处的罗宾条件，参数为 $\\alpha=0, \\beta=1, \\gamma=0$: $0 \\cdot u_{N-1} + 1 \\cdot \\frac{u_{N-1}-u_{N-2}}{h} = 0 \\implies \\frac{du}{dx}(L)=0$（在 $x=L$ 处对 $u$ 的诺伊曼条件）\n3.  $\\frac{dp}{dx}(0)=0 \\implies \\frac{p_1-p_0}{h} = 0$\n4.  $p(0)=0$（压力参考）\n该系统也是适定的。解析解 $u(x)=1, p(x)=0$ 满足所有条件。离散解应为对所有 $i$ 都有 $u_i \\approx 1$。不可压缩性约束 $\\frac{du}{dx}=0$ 由连续性方程强制执行。因此，平均绝对离散速度梯度 $\\frac{1}{N-1}\\sum_{i=0}^{N-2} |\\frac{u_{i+1}-u_i}{h}|$ 应该非常接近于 $0$。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and analyzes a finite difference solver for 1D steady\n    incompressible Stokes flow to validate boundary condition implementations.\n    \"\"\"\n\n    # Global parameters from the problem statement\n    L = 1.0\n    nu = 1.0\n    N = 10\n    U0 = 1.0\n    P0 = 0.0\n    P1 = 1.0\n    tau = 1e-10\n    h = L / (N - 1)\n    \n    # Store results for each test case\n    results = []\n\n    # --- Helper function to build the system ---\n    def build_system(bcs):\n        \"\"\"\n        Assembles the matrix A and vector b for the system Ax=b.\n        \n        Args:\n            bcs (list): A list of tuples, each defining a boundary condition.\n                        Format: (type, variable, index, value)\n                        type: 'dirichlet', 'neumann', 'robin'\n                        variable: 'u' or 'p'\n                        index: 0 for left boundary, N-1 for right\n                        value: float for dirichlet/neumann, dict for robin\n        \n        Returns:\n            A (np.ndarray): The system matrix.\n            b (np.ndarray): The right-hand-side vector.\n        \"\"\"\n        A = np.zeros((2 * N, 2 * N))\n        b = np.zeros(2 * N)\n        row = 0\n\n        # Interior equations: Continuity (N-2 equations)\n        for i in range(1, N - 1):\n            A[row, i - 1] = -1.0 / (2.0 * h)\n            A[row, i + 1] = 1.0 / (2.0 * h)\n            b[row] = 0.0\n            row += 1\n\n        # Interior equations: Momentum (N-2 equations)\n        for i in range(1, N - 1):\n            # u part\n            A[row, i - 1] = -nu / (h**2)\n            A[row, i]     = 2.0 * nu / (h**2)\n            A[row, i + 1] = -nu / (h**2)\n            # p part (indices shifted by N)\n            A[row, N + i - 1] = -1.0 / (2.0 * h)\n            A[row, N + i + 1] = 1.0 / (2.0 * h)\n            b[row] = 0.0\n            row += 1\n            \n        # Boundary/Reference conditions (4 equations)\n        for bc in bcs:\n            bc_type, var, idx, val = bc\n            var_offset = 0 if var == 'u' else N\n            \n            if bc_type == 'dirichlet':\n                A[row, var_offset + idx] = 1.0\n                b[row] = val\n            elif bc_type == 'neumann':\n                if idx == 0:  # Left boundary (forward difference)\n                    # (q_1 - q_0)/h = val\n                    A[row, var_offset + 0] = -1.0 / h\n                    A[row, var_offset + 1] = 1.0 / h\n                    b[row] = val\n                else:  # Right boundary (backward difference)\n                    # (q_{N-1} - q_{N-2})/h = val\n                    A[row, var_offset + N - 2] = -1.0 / h\n                    A[row, var_offset + N - 1] = 1.0 / h\n                    b[row] = val\n            elif bc_type == 'robin':\n                alpha, beta, gamma = val['alpha'], val['beta'], val['gamma']\n                if idx == 0: # Left boundary\n                    # alpha*u_0 + beta*(u_1-u_0)/h = gamma\n                    A[row, 0] = alpha - beta/h\n                    A[row, 1] = beta/h\n                    b[row] = gamma\n                else: # Right boundary\n                    # alpha*u_{N-1} + beta*(u_{N-1}-u_{N-2})/h = gamma\n                    A[row, N-2] = -beta/h\n                    A[row, N-1] = alpha + beta/h\n                    b[row] = gamma\n            row += 1\n            \n        return A, b\n\n    # --- Test 1: Well-posed mix ---\n    bc_test1 = [\n        ('dirichlet', 'u', 0, U0),\n        ('robin', 'u', N-1, {'alpha': 1, 'beta': 0, 'gamma': U0}),\n        ('neumann', 'p', 0, 0.0),\n        ('dirichlet', 'p', 0, P0),\n    ]\n    A1, b1 = build_system(bc_test1)\n    x1 = np.linalg.solve(A1, b1)\n    res1 = np.linalg.norm(A1 @ x1 - b1)\n    results.append(res1)\n\n    # --- Test 2: Over-specified inflow ---\n    bc_test2 = [\n        ('dirichlet', 'u', 0, U0),\n        ('dirichlet', 'p', 0, P0),\n        ('robin', 'u', N-1, {'alpha': 1, 'beta': 0, 'gamma': U0}),\n        ('dirichlet', 'p', N-1, P1),\n    ]\n    A2, b2 = build_system(bc_test2)\n    A_aug2 = np.c_[A2, b2]\n    rank_A = np.linalg.matrix_rank(A2, tol=tau)\n    rank_aug = np.linalg.matrix_rank(A_aug2, tol=tau)\n    res2 = rank_aug > rank_A\n    results.append(res2)\n\n    # --- Test 3: Characteristic-compatible reduction ---\n    bc_test3 = [\n        ('dirichlet', 'u', 0, U0),\n        ('robin', 'u', N-1, {'alpha': 1, 'beta': 0, 'gamma': U0}),\n        ('neumann', 'p', 0, 0.0),\n        ('dirichlet', 'p', 0, P0),\n    ]\n    A3, b3 = build_system(bc_test3)\n    x3 = np.linalg.solve(A3, b3)\n    res3 = np.linalg.norm(A3 @ x3 - b3)\n    results.append(res3)\n\n    # --- Test 4: Genuine Robin at outflow ---\n    bc_test4 = [\n        ('dirichlet', 'u', 0, U0),\n        ('robin', 'u', N-1, {'alpha': 0, 'beta': 1, 'gamma': 0.0}), # du/dx(L) = 0\n        ('neumann', 'p', 0, 0.0),\n        ('dirichlet', 'p', 0, P0),\n    ]\n    A4, b4 = build_system(bc_test4)\n    x4 = np.linalg.solve(A4, b4)\n    u4 = x4[:N]\n    \n    # Compute mean absolute discrete velocity gradient\n    grad_sum = 0.0\n    for i in range(N - 1):\n        grad_sum += np.abs((u4[i + 1] - u4[i]) / h)\n    res4 = grad_sum / (N - 1)\n    results.append(res4)\n\n    # Final print statement in the exact required format.\n    # The boolean for Test 2 needs to be a string in the final list.\n    formatted_results = [f\"{r:.15e}\" if isinstance(r, float) else str(r) for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3333246"}]}