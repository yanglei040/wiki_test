{"hands_on_practices": [{"introduction": "对流是流体动力学的基本过程之一。这个练习将带你分析求解线性对流方程的最基本也是最经典的数值格式之一——显式迎风格式。通过 von Neumann 稳定性分析，你将亲手推导出保证数值解不会发散的关键条件，即著名的CFL (Courant–Friedrichs–Lewy) 条件，这是理解显式时间积分方法稳定性的基石。", "problem": "考虑一维线性平流方程 $u_{t} + a\\,u_{x} = 0$，其中波速 $a \\in \\mathbb{R}$ 为常数，定义在周期性空间域 $x \\in [0,L]$ 上。设空间网格是均匀的，间距为 $h > 0$，时间步长为 $\\Delta t > 0$。定义与 $a$ 符号一致的显式迎风有限差分格式如下：\n对于 $a > 0$：$u_{j}^{n+1} = u_{j}^{n} - \\frac{a\\,\\Delta t}{h}\\left(u_{j}^{n} - u_{j-1}^{n}\\right)$，\n对于 $a  0$：$u_{j}^{n+1} = u_{j}^{n} - \\frac{a\\,\\Delta t}{h}\\left(u_{j+1}^{n} - u_{j}^{n}\\right)$，\n其中 $u_{j}^{n}$ 近似 $u(x_{j}, t^{n})$，且 $x_{j} = j h$，$t^{n} = n \\Delta t$。从控制方程 $u_{t} + a\\,u_{x} = 0$ 和上述离散更新式出发，通过假设一个波数为 $\\kappa \\in \\mathbb{R}$ 的离散傅里叶模 $u_{j}^{n} = \\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,x_{j})$ 和周期性边界条件，进行 von Neumann 稳定性分析（也称为傅里叶或 von Neumann 稳定性分析）。推导相应的放大因子 $G(\\kappa)$，并对所有允许的波数施加稳定性要求 $|G(\\kappa)| \\leq 1$。利用此结果，确定对于 $a$ 的每一种符号能确保稳定性的所有时间步长 $\\Delta t$，然后将这些结果整合成一个通过 Courant 数表示的单一稳定性限制，并与 Courant–Friedrichs–Lewy (CFL) 条件一致。最后，以 $|a|$ 和 $h$ 的函数形式，将最大稳定时间步长 $\\Delta t_{\\max}$ 写成一个单一的闭式符号表达式。将最终答案表示为一个闭式表达式；不要将其写成不等式形式，也不要包含任何物理单位。", "solution": "偏微分方程 $u_{t} + a\\,u_{x} = 0$ 模拟了以恒定速度 $a$ 进行的纯平流过程。对于周期域上的线性常系数有限差分格式，von Neumann 稳定性分析的步骤是：将一个离散傅里叶模代入更新式中，并研究得到的放大因子。\n\n我们考虑均匀网格 $x_{j} = j h$ 和时间层 $t^{n} = n \\Delta t$。显式迎风格式的定义方式使得空间差分与传播方向一致：对于 $a  0$，迎风导数使用后向差分；对于 $a  0$，使用前向差分。引入 Courant 数 $\\nu = \\frac{a\\,\\Delta t}{h}$。\n\n情况 $a  0$。格式为\n$$\nu_{j}^{n+1} = u_{j}^{n} - \\nu\\left(u_{j}^{n} - u_{j-1}^{n}\\right).\n$$\n假设傅里叶模 $u_{j}^{n} = \\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,x_{j})$，其中 $x_{j} = j h$，并记 $\\theta = \\kappa h$。那么 $u_{j-1}^{n} = \\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,x_{j-1}) = \\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,(x_{j} - h)) = \\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,x_{j})\\,\\exp(-i\\,\\theta)$。将其代入更新式可得\n$$\n\\hat{u}^{n+1}\\,\\exp(i\\,\\kappa\\,x_{j}) = \\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,x_{j}) - \\nu\\left[\\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,x_{j}) - \\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,x_{j})\\,\\exp(-i\\,\\theta)\\right].\n$$\n两边同除以 $\\exp(i\\,\\kappa\\,x_{j})$ 得到放大关系 $\\hat{u}^{n+1} = G(\\theta)\\,\\hat{u}^{n}$，其中\n$$\nG(\\theta) = 1 - \\nu\\left(1 - \\exp(-i\\,\\theta)\\right).\n$$\n我们计算 $G(\\theta)$ 的模。写出 $\\exp(-i\\,\\theta) = \\cos(\\theta) - i \\sin(\\theta)$，于是\n$$\nG(\\theta) = 1 - \\nu + \\nu\\cos(\\theta) - i\\,\\nu\\sin(\\theta).\n$$\n模的平方为\n\\begin{align*}\n|G(\\theta)|^{2} = \\left(1 - \\nu + \\nu\\cos(\\theta)\\right)^{2} + \\left(\\nu\\sin(\\theta)\\right)^{2} \\\\\n= (1 - \\nu)^{2} + 2\\nu(1 - \\nu)\\cos(\\theta) + \\nu^{2}\\cos^{2}(\\theta) + \\nu^{2}\\sin^{2}(\\theta) \\\\\n= (1 - \\nu)^{2} + 2\\nu(1 - \\nu)\\cos(\\theta) + \\nu^{2} \\\\\n= 1 - 2\\nu + 2\\nu^{2} + 2\\nu(1 - \\nu)\\cos(\\theta).\n\\end{align*}\n对于固定的 $\\nu \\in \\mathbb{R}$，对 $\\theta$ 的依赖仅通过 $\\cos(\\theta) \\in [-1, 1]$ 体现。当 $0 \\leq \\nu \\leq 1$ 时，系数 $2\\nu(1 - \\nu)$ 是非负的，因此关于 $\\theta$ 的最大值在 $\\cos(\\theta) = 1$ 时取得，得到 $|G(\\theta)|^{2} = 1$。最小值在 $\\cos(\\theta) = -1$ 时取得，给出 $|G(\\theta)|^{2} = 1 - 4\\nu + 4\\nu^{2} = (1 - 2\\nu)^{2} \\leq 1$。因此，对于 $a  0$，von Neumann 意义下的稳定性（即对所有 $\\theta$ 都有 $|G(\\theta)| \\leq 1$）当且仅当 $0 \\leq \\nu \\leq 1$ 时成立，也就是 $0 \\leq \\frac{a\\,\\Delta t}{h} \\leq 1$，等价于 $0 \\leq \\Delta t \\leq \\frac{h}{a}$。\n\n情况 $a  0$。格式为\n$$\nu_{j}^{n+1} = u_{j}^{n} - \\nu\\left(u_{j+1}^{n} - u_{j}^{n}\\right),\n$$\n其中 $\\nu = \\frac{a\\,\\Delta t}{h}  0$。使用傅里葉模 $u_{j+1}^{n} = \\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,x_{j+1}) = \\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,x_{j})\\,\\exp(i\\,\\theta)$，代入可得\n$$\n\\hat{u}^{n+1}\\,\\exp(i\\,\\kappa\\,x_{j}) = \\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,x_{j}) - \\nu\\left[\\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,x_{j})\\,\\exp(i\\,\\theta) - \\hat{u}^{n}\\,\\exp(i\\,\\kappa\\,x_{j})\\right].\n$$\n两边同除以 $\\exp(i\\,\\kappa\\,x_{j})$ 得到\n$$\n\\hat{u}^{n+1} = \\left(1 - \\nu\\left(\\exp(i\\,\\theta) - 1\\right)\\right)\\hat{u}^{n}, \\quad G(\\theta) = 1 - \\nu\\left(\\exp(i\\,\\theta) - 1\\right).\n$$\n写出 $\\exp(i\\,\\theta) = \\cos(\\theta) + i \\sin(\\theta)$，我们有\n$$\nG(\\theta) = 1 + \\nu - \\nu\\cos(\\theta) - i\\,\\nu\\sin(\\theta),\n$$\n以及\n\\begin{align*}\n|G(\\theta)|^{2} = \\left(1 + \\nu - \\nu\\cos(\\theta)\\right)^{2} + \\left(\\nu\\sin(\\theta)\\right)^{2} \\\\\n= (1 + \\nu)^{2} - 2\\nu(1 + \\nu)\\cos(\\theta) + \\nu^{2}\\cos^{2}(\\theta) + \\nu^{2}\\sin^{2}(\\theta) \\\\\n= (1 + \\nu)^{2} - 2\\nu(1 + \\nu)\\cos(\\theta) + \\nu^{2} \\\\\n= 1 + 2\\nu + 2\\nu^{2} - 2\\nu(1 + \\nu)\\cos(\\theta).\n\\end{align*}\n对于 $\\nu \\in [-1, 0]$，系数 $-2\\nu(1 + \\nu)$ 是非负的（因为 $\\nu \\leq 0$ 且 $1 + \\nu \\geq 0$），因此关于 $\\theta$ 的最大值在 $\\cos(\\theta) = 1$ 时取得，得到 $|G(\\theta)|^{2} = 1$。最小值在 $\\cos(\\theta) = -1$ 时取得，给出 $|G(\\theta)|^{2} = 1 + 4\\nu + 4\\nu^{2} = (1 + 2\\nu)^{2} \\leq 1$。因此，对于 $a  0$，稳定性当且仅当 $-1 \\leq \\nu \\leq 0$ 时成立，即 $0 \\leq \\Delta t \\leq \\frac{h}{|a|}$。\n\n综合两种情况，显式迎风格式的 von Neumann 稳定性条件为 $|\\nu| \\leq 1$，等价于 $\\Delta t \\leq \\frac{h}{|a|}$。因此，最大稳定时间步长为\n$$\n\\Delta t_{\\max} = \\frac{h}{|a|}.\n$$\n这与单调迎风平流的 Courant–Friedrichs–Lewy (CFL) 限制是一致的：数值依赖域必须包含物理依赖域，在这里即强制要求一个时间步内平流经过的距离 $|a|\\,\\Delta t$ 与网格间距 $h$ 的比率不超过 $1$。\n\n因此，所要求的最大稳定时间步长的单一闭式符号表达式是 $\\Delta t_{\\max} = \\frac{h}{|a|}$。", "answer": "$$\\boxed{\\frac{h}{|a|}}$$", "id": "3337490"}, {"introduction": "在探索了显式格式的稳定性之后，我们将目光转向隐式格式。本练习聚焦于求解扩散问题的经典隐式方法——Crank–Nicolson格式。你将通过分析其放大因子来理解“无条件稳定”或“A-稳定”的深刻含义，并发现即使是稳定的格式，在时间步长较大时也可能产生非物理的振荡，这对于培养批判性思维和评估数值解质量至关重要。", "problem": "考虑一维热方程，这是一个典型的抛物型偏微分方程 (PDE)，由 $u_{t} = \\nu u_{xx}$ 给出，其中运动粘度常数 $\\nu  0$。该方程定义在空间步长为 $h$、时间步长为 $\\Delta t$ 的均匀网格上。令 $u_{j}^{n}$ 表示在网格索引 $j \\in \\mathbb{Z}$ 和时间层 $n \\in \\mathbb{N}$ 上对 $u(x_{j}, t^{n})$ 的数值近似。使用标准二阶中心有限差分算子 $D u_{j}^{n} = h^{-2} \\left(u_{j+1}^{n} - 2 u_{j}^{n} + u_{j-1}^{n}\\right)$ 对空间二阶导数进行离散化，并采用由下式定义的 Crank–Nicolson (CN) 格式进行时间推进：\n$$\n\\frac{u_{j}^{n+1} - u_{j}^{n}}{\\Delta t} = \\frac{\\nu}{2} \\left(D u_{j}^{n+1} + D u_{j}^{n}\\right).\n$$\n通过假设解的形式为 $u_{j}^{n} = \\hat{u}^{n} \\exp\\!\\left(i j \\theta\\right)$（其中模态角 $\\theta \\in [-\\pi, \\pi]$）来进行 von Neumann 傅里叶模态分析。从上述基本定义出发，推导放大因子 $g(\\theta, \\alpha)$，其中 $\\alpha := \\nu \\Delta t / h^{2}$，使得 $\\hat{u}^{n+1} = g(\\theta, \\alpha) \\, \\hat{u}^{n}$。然后，使用线性标量检验方程 $y' = \\lambda y$（其中 $\\operatorname{Re}(\\lambda) \\le 0$）和 CN 稳定性函数，论证 CN 格式是否是 A-稳定的（绝对稳定），并确定对于任意固定的 $\\theta \\neq 0$，当 $\\alpha \\to \\infty$ 时 $|g(\\theta, \\alpha)|$ 的行为，解释当使用大的时间步长时这对非物理振荡的影响。\n\n提供放大因子 $g(\\theta, \\alpha)$ 的闭式表达式作为您的最終答案。", "solution": "本问题要求推导和分析应用于一维热方程 $u_{t} = \\nu u_{xx}$（其中 $\\nu  0$）的 Crank-Nicolson (CN) 格式的放大因子。\n\nCN 格式如下：\n$$\n\\frac{u_{j}^{n+1} - u_{j}^{n}}{\\Delta t} = \\frac{\\nu}{2} \\left(D u_{j}^{n+1} + D u_{j}^{n}\\right)\n$$\n此处，$u_{j}^{n}$ 是解 $u(x_j, t^n)$ 在网格点 $j$ 和时间层 $n$ 的近似值。空间算子 $D$ 是二阶中心有限差分：\n$$\nD u_{j}^{n} = \\frac{u_{j+1}^{n} - 2 u_{j}^{n} + u_{j-1}^{n}}{h^2}\n$$\n将算子 $D$ 代入 CN 格式，得到：\n$$\n\\frac{u_{j}^{n+1} - u_{j}^{n}}{\\Delta t} = \\frac{\\nu}{2h^2} \\left[ (u_{j+1}^{n+1} - 2u_{j}^{n+1} + u_{j-1}^{n+1}) + (u_{j+1}^{n} - 2u_{j}^{n} + u_{j-1}^{n}) \\right]\n$$\n我们定义扩散数 $\\alpha := \\nu \\Delta t / h^2$。两边乘以 $\\Delta t$ 并重新整理各项，以分离时间层 $n+1$ 和 $n$：\n$$\nu_{j}^{n+1} - \\frac{\\alpha}{2} (u_{j+1}^{n+1} - 2u_{j}^{n+1} + u_{j-1}^{n+1}) = u_{j}^{n} + \\frac{\\alpha}{2} (u_{j+1}^{n} - 2u_{j}^{n} + u_{j-1}^{n})\n$$\n为了进行 von Neumann 稳定性分析，我们代入傅里叶模态假设 $u_{j}^{n} = \\hat{u}^{n} \\exp(i j \\theta)$，其中 $i = \\sqrt{-1}$，$\\theta = k h$ 是无量纲波数或模态角。这一代换意味着：\n$$\nu_{j \\pm 1}^{n} = \\hat{u}^{n} \\exp(i (j \\pm 1) \\theta) = \\hat{u}^{n} \\exp(i j \\theta) \\exp(\\pm i \\theta) = u_{j}^{n} \\exp(\\pm i \\theta)\n$$\n将此应用于整理后格式的左侧 (LHS)（在时间层 $n+1$）：\n$$\n\\text{LHS} = \\hat{u}^{n+1} \\exp(i j \\theta) - \\frac{\\alpha}{2} \\left[ \\hat{u}^{n+1} \\exp(i (j+1) \\theta) - 2\\hat{u}^{n+1} \\exp(i j \\theta) + \\hat{u}^{n+1} \\exp(i (j-1) \\theta) \\right]\n$$\n提出公因子 $\\hat{u}^{n+1} \\exp(i j \\theta)$：\n$$\n\\text{LHS} = \\hat{u}^{n+1} \\exp(i j \\theta) \\left[ 1 - \\frac{\\alpha}{2} \\left( \\exp(i \\theta) - 2 + \\exp(-i \\theta) \\right) \\right]\n$$\n类似地，对于时间层 $n$ 的右侧 (RHS)：\n$$\n\\text{RHS} = \\hat{u}^{n} \\exp(i j \\theta) \\left[ 1 + \\frac{\\alpha}{2} \\left( \\exp(i \\theta) - 2 + \\exp(-i \\theta) \\right) \\right]\n$$\n括号中的项可以使用欧拉公式 $\\exp(i\\theta) + \\exp(-i\\theta) = 2\\cos(\\theta)$ 进行简化：\n$$\n\\exp(i \\theta) - 2 + \\exp(-i \\theta) = 2\\cos(\\theta) - 2 = -2(1 - \\cos(\\theta))\n$$\n使用半角恒等式 $1 - \\cos(\\theta) = 2\\sin^2(\\theta/2)$，上式变为：\n$$\n\\exp(i \\theta) - 2 + \\exp(-i \\theta) = -4\\sin^2\\left(\\frac{\\theta}{2}\\right)\n$$\n将这个简化后的表达式代回 LHS 和 RHS，并令两者相等：\n$$\n\\hat{u}^{n+1} \\left[ 1 - \\frac{\\alpha}{2} \\left(-4\\sin^2\\left(\\frac{\\theta}{2}\\right)\\right) \\right] = \\hat{u}^{n} \\left[ 1 + \\frac{\\alpha}{2} \\left(-4\\sin^2\\left(\\frac{\\theta}{2}\\right)\\right) \\right]\n$$\n$$\n\\hat{u}^{n+1} \\left[ 1 + 2\\alpha\\sin^2\\left(\\frac{\\theta}{2}\\right) \\right] = \\hat{u}^{n} \\left[ 1 - 2\\alpha\\sin^2\\left(\\frac{\\theta}{2}\\right) \\right]\n$$\n放大因子 $g(\\theta, \\alpha)$ 由 $\\hat{u}^{n+1} = g(\\theta, \\alpha) \\hat{u}^{n}$ 定义。解出 $g(\\theta, \\alpha)$ 得到：\n$$\ng(\\theta, \\alpha) = \\frac{1 - 2\\alpha\\sin^2\\left(\\frac{\\theta}{2}\\right)}{1 + 2\\alpha\\sin^2\\left(\\frac{\\theta}{2}\\right)}\n$$\n这就是所求的闭式表达式。\n\n接下来，我们分析其稳定性。对于线性标量检验方程 $y' = \\lambda y$，其中 $\\operatorname{Re}(\\lambda) \\le 0$，CN 方法（即梯形法则的应用）为：\n$$\n\\frac{y^{n+1} - y^{n}}{\\Delta t} = \\frac{1}{2}(\\lambda y^{n+1} + \\lambda y^{n})\n$$\n令 $z = \\lambda \\Delta t$。整理以求稳定性函数 $R(z) = y^{n+1} / y^{n}$：\n$$\ny^{n+1}(1 - z/2) = y^{n}(1 + z/2) \\implies R(z) = \\frac{1 + z/2}{1 - z/2}\n$$\n如果对于所有满足 $\\operatorname{Re}(z) \\le 0$ 的 $z \\in \\mathbb{C}$ 都有 $|R(z)| \\le 1$，则该方法是 A-稳定的。令 $z = x+iy$，其中 $x \\le 0$。\n$$\n|R(z)|^2 = \\left| \\frac{1 + (x+iy)/2}{1 - (x+iy)/2} \\right|^2 = \\frac{|(1+x/2) + i(y/2)|^2}{|(1-x/2) - i(y/2)|^2} = \\frac{(1+x/2)^2 + (y/2)^2}{(1-x/2)^2 + (y/2)^2}\n$$\n条件 $|R(z)|^2 \\le 1$ 变为 $(1+x/2)^2 \\le (1-x/2)^2$，可简化为 $1+x \\le 1-x$，即 $2x \\le 0$，也就是 $x \\le 0$。这对左半平面中所有的 $z$（即 $\\operatorname{Re}(z) \\le 0$）都成立。因此，Crank-Nicolson 方法是 A-稳定的。\n\n对于热方程，$z$ 的值对应于离散化空间算子的特征值乘以 $\\Delta t$。$\\nu D$ 的特征值为 $\\lambda_{\\theta} = \\nu \\left(\\frac{\\exp(i\\theta) - 2 + \\exp(-i\\theta)}{h^2}\\right) = -\\frac{4\\nu}{h^2}\\sin^2(\\theta/2)$。由于 $\\nu  0$，这些特征值是实数且非正的，因此 $\\operatorname{Re}(\\lambda_{\\theta}\\Delta t) \\le 0$。对应的 $z$ 值为：\n$$\nz = \\lambda_{\\theta}\\Delta t = -\\frac{4\\nu\\Delta t}{h^2}\\sin^2\\left(\\frac{\\theta}{2}\\right) = -4\\alpha\\sin^2\\left(\\frac{\\theta}{2}\\right)\n$$\n将此代入稳定性函数 $R(z)$ 得到：\n$$\nR(z) = \\frac{1 + (-4\\alpha\\sin^2(\\theta/2))/2}{1 - (-4\\alpha\\sin^2(\\theta/2))/2} = \\frac{1 - 2\\alpha\\sin^2(\\theta/2)}{1 + 2\\alpha\\sin^2(\\theta/2)} = g(\\theta, \\alpha)\n$$\n这表明 A-稳定性意味着应用于热方程的 CN 格式是无条件稳定的，即对于所有 $\\alpha  0$ 和所有 $\\theta \\in [-\\pi, \\pi]$ 都有 $|g(\\theta, \\alpha)| \\le 1$。\n\n最后，我们考察当 $\\alpha \\to \\infty$ 时，对于固定的 $\\theta \\neq 0$ 的行为。对于除了 $\\theta=0$ 之外的任意 $\\theta \\in [-\\pi, \\pi]$，项 $\\sin^2(\\theta/2)$ 是一个正常数。\n$$\n\\lim_{\\alpha \\to \\infty} g(\\theta, \\alpha) = \\lim_{\\alpha \\to \\infty} \\frac{1 - 2\\alpha\\sin^2\\left(\\frac{\\theta}{2}\\right)}{1 + 2\\alpha\\sin^2\\left(\\frac{\\theta}{2}\\right)} = \\lim_{\\alpha \\to \\infty} \\frac{1/\\alpha - 2\\sin^2(\\frac{\\theta}{2})}{1/\\alpha + 2\\sin^2(\\frac{\\theta}{2})} = \\frac{-2\\sin^2(\\frac{\\theta}{2})}{+2\\sin^2(\\frac{\\theta}{2})} = -1\n$$\n这意味着对于大的时间步长（大的 $\\alpha$），任何非零频率模态的放大因子都趋近于 $-1$。因此，$|g(\\theta, \\alpha)| \\to 1$。虽然傅里葉模态的幅值不会增长（确保了稳定性），但它们的符号在每个时间步都会交替变化，因为 $\\hat{u}^{n+1} \\approx -\\hat{u}^{n}$。这在数值解中表现为虚假的、非物理的高频振荡。解虽然不会“爆炸”，但其质量会严重下降。这说明 CN 格式不是 L-稳定的，L-稳定性要求放大因子对于高度刚性的分量（即当 $\\operatorname{Re}(z) \\to -\\infty$ 时）要趋于零，这对于有效衰减高频数值误差是理想的。", "answer": "$$\n\\boxed{\\frac{1 - 2\\alpha\\sin^2\\left(\\frac{\\theta}{2}\\right)}{1 + 2\\alpha\\sin^2\\left(\\frac{\\theta}{2}\\right)}}\n$$", "id": "3337428"}, {"introduction": "理论分析是基础，但真正的挑战在于将理论应用于解决实际问题。本练习是一个编程实践，旨在解决对流占主导的复杂流动问题，此时数值解极易产生非物理振荡。你将通过代码验证，当网格佩克莱数（cell Peclet number）$Pe_h$ 较高时，朴素的中心差分格式为何会违反离散极值原理，并动手实现一个现代计算流体力学中常用的TVD（总变差递减）通量限制器格式来修复这一问题，从而获得关于数值格式保单调性的宝贵实践经验。", "problem": "考虑一个周期性区域上的一维对流-扩散方程，该方程由质量守恒和菲克定律推导得出，即标量偏微分方程 $u_t + a\\,u_x - \\nu\\,u_{xx} = 0$，其中 $x \\in [0,1]$，周期为 $1$。这里，$u(x,t)$ 是守恒标量，$a$ 是恒定对流速度，$\\nu$ 是恒定扩散率。该连续方程满足极值原理，即如果 $u(x,0)$ 的值界于一个最小值和一个最大值之间，那么对于 $t \\ge 0$，不会出现新的极值点。\n\n您将研究在何种条件下，两种空间半离散化方法与时间上的前向欧拉法耦合后，离散极值原理能够成立。您还将通过经验构造一个高单元格佩克莱特数下的反例，以证明其不成立的情况，并展示一种能够恢复单调性的流量限制器修正方法。\n\n在您的推导和实现中请使用以下定义：\n- 均匀网格包含 $N$ 个点，间距为 $\\Delta x = 1/N$，单元格中心位于 $x_i = (i+1/2)\\Delta x$（其中 $i=0,\\dots,N-1$），并采用周期性索引。\n- 离散极值原理（DMP）应按以下方式进行数值检验：设 $u^0$ 为初始离散状态，$u^n$ 为 $n$ 个时间步后的解。如果在所有时间步 $n$，不等式 $\\min_i u^n_i \\ge \\min_i u^0_i - \\tau$ 和 $\\max_i u^n_i \\le \\max_i u^0_i + \\tau$（容差 $\\tau = 10^{-8}$）均得到满足，则宣告 DMP 成立。\n- 单元格佩克莱特数定义为 $Pe_h = |a|\\Delta x/\\nu$。\n\n需要实现的方案：\n- 有限差分中心格式（FD-central）：在均匀网格上使用中心差分来离散化 $u_x$，并使用标准的二阶中心差分来离散化 $u_{xx}$。通过时间步长为 $\\Delta t$ 的前向欧拉法对方法线法得到的常微分方程进行积分。\n- 带有 minmod 斜率限制器的有限体积迎风格式（FV-upwind-limited）：使用迎风的分段线性重构来计算单元格间对流通量，其中 minmod 斜率限制器应用于单边差分，以保持标量对流的总变差递减特性。扩散通量是面上的中心梯度。通过通量差分和步长为 $\\Delta t$ 的前向欧拉时间步进更新单元格平均值。\n\n需要使用的初始条件：\n- 光滑情况：$u(x,0) = \\tfrac{1}{2} + \\tfrac{1}{2}\\sin(2\\pi x)$。\n- 反例情况（陡峭前缘）：当 $x \\in [0.4,0.6)$ 时 $u(x,0) = 1$，在 $[0,1)$ 的其他位置 $u(x,0) = 0$，进行周期性解释。\n\n任务：\n- 从以上守恒律和定义出发，推导使 FD-central 前向欧拉更新成为保证一维空间中离散极值原理的 M-矩阵类型凸组合的离散系数条件。同样地，推导使 FV-upwind-limited 前向欧拉更新保持单调的充分步长和系数条件。利用这些条件预测中心差分在何时可能在高 $Pe_h$ 下不满足条件，并解释为什么迎风限制通量可以修正此问题。\n- 实现这两种方案，并通过运行下面指定的测试套件并在每个时间步检查 DMP 条件（容差为 $\\tau$），为不满足条件的情况和修正方法构建数值证据。\n\n测试套件：\n- 情况 1（理想路径，光滑且扩散）：$N=100$, $a=1.0$, $\\nu=0.1$, $\\Delta t=2.5\\times 10^{-4}$, $T=0.05$, 方案 FD-central，光滑初始条件。预期行为：DMP 成立。\n- 情况 2（反例，高 $Pe_h$ 下的中心差分）：$N=100$, $a=5.0$, $\\nu=10^{-3}$, $\\Delta t=2.0\\times 10^{-4}$, $T=0.02$, 方案 FD-central，陡峭前缘初始条件。预期行为：由于色散振荡，DMP 不成立。\n- 情况 3（在高 $Pe_h$ 下使用限制器进行修正）：$N=100$, $a=5.0$, $\\nu=10^{-3}$, $\\Delta t=10^{-3}$, $T=0.02$, 方案 FV-upwind-limited，陡峭前缘初始条件。预期行为：DMP 成立。\n- 情况 4（临界 $Pe_h$ 下的中心差分）：$N=100$, $a=1.0$, $\\nu=10^{-2}$, $\\Delta t=2.5\\times 10^{-3}$, $T=0.05$, 方案 FD-central，陡峭前缘初始条件。预期行为：若系数和步长约束得到满足，则 DMP 成立。\n\n计算和输出要求：\n- 使用双精度算术。该区域是无量纲的；不需要物理单位。\n- 对于每种情况，使用指定的方案和参数，将数值解从 $t=0$ 推进到 $t=T$，并强制执行周期性边界条件。\n- 对于每种情况，输出一个布尔值，指示在该情况下，所有时间步的 DMP 是否在容差 $\\tau = 10^{-8}$ 下成立。\n- 您的程序应生成单行输出，其中包含四个情况的结果，格式为用方括号括起来的逗号分隔列表，例如 $[true,false,true,true]$。使用宿主语言的原生布尔字面量。\n\n注意事项：\n- 不涉及角度；不需要角度单位。\n- 确保实现是自包含的，不需外部数据。", "solution": "用户提供了一个计算流体动力学领域的适定问题，该问题既需要对离散极值原理（DMP）的条件进行理论推导，也需要通过数值实现来验证这些条件。该问题具有科学依据，内部一致，并包含了所有必要信息。我们开始解答。\n\n控制方程为一维对流-扩散方程，这是一个由下式给出的守恒律：\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial}{\\partial x} \\left( a u - \\nu \\frac{\\partial u}{\\partial x} \\right) = 0\n$$\n其中 $u(x,t)$ 是一个标量，$a$ 是恒定对流速度，$\\nu$ 是恒定扩散率。对于恒定的 $a$，该方程展开为 $u_t + a u_x - \\nu u_{xx} = 0$。我们将在一个包含 $N$ 个单元格（宽度为 $\\Delta x = 1/N$）、单元格中心为 $x_i = (i+1/2)\\Delta x$ 的均匀周期性网格上分析两种空间离散化方法。时间积分采用步长为 $\\Delta t$ 的显式前向欧拉法。\n\n如果对于一个初始条件 $u^0$，在任意时间步 $n$ 的解 $u^n$ 都保持在初始最小值和最大值所限定的范围内，即 $\\min_i u_i^n \\ge \\min_i u_i^0$ 和 $\\max_i u_i^n \\le \\max_i u_i^0$，则称该数值格式满足离散极值原理。一个充分条件是，每个网格点 $u_i^{n+1}$ 的更新是前一时间步 $u^n$ 各值的凸组合。也就是说，如果格式可以写成 $u_i^{n+1} = \\sum_{j} C_j u_j^n$，那么只要所有系数 $C_j \\ge 0$ 且它们的和 $\\sum_j C_j = 1$，DMP 就得到保证。\n\n**有限差分中心（FD-central）格式分析**\n\nFD-central 格式将空间导数离散化为：\n$$\nu_x \\approx \\frac{u_{i+1}^n - u_{i-1}^n}{2\\Delta x} \\quad \\text{和} \\quad u_{xx} \\approx \\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{\\Delta x^2}\n$$\n将这些代入控制方程，并使用前向欧拉时间步进，得到更新公式：\n$$\n\\frac{u_i^{n+1} - u_i^n}{\\Delta t} + a \\left(\\frac{u_{i+1}^n - u_{i-1}^n}{2\\Delta x}\\right) - \\nu \\left(\\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{\\Delta x^2}\\right) = 0\n$$\n解出 $u_i^{n+1}$ 并按时间 $n$ 的空间索引对项进行分组：\n$$\nu_i^{n+1} = u_i^n - \\Delta t \\left[ a \\frac{u_{i+1}^n - u_{i-1}^n}{2\\Delta x} - \\nu \\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{\\Delta x^2} \\right]\n$$\n$$\nu_i^{n+1} = \\left(\\frac{\\nu \\Delta t}{\\Delta x^2} - \\frac{a \\Delta t}{2\\Delta x}\\right) u_{i+1}^n + \\left(1 - \\frac{2\\nu \\Delta t}{\\Delta x^2}\\right) u_i^n + \\left(\\frac{\\nu \\Delta t}{\\Delta x^2} + \\frac{a \\Delta t}{2\\Delta x}\\right) u_{i-1}^n\n$$\n我们用 $C_{i+1}$、$C_i$ 和 $C_{i-1}$ 分别表示 $u_{i+1}^n$、$u_i^n$ 和 $u_{i-1}^n$ 的系数。系数之和为 $C_{i+1} + C_i + C_{i-1} = (\\frac{\\nu \\Delta t}{\\Delta x^2} - \\frac{a \\Delta t}{2\\Delta x}) + (1 - \\frac{2\\nu \\Delta t}{\\Delta x^2}) + (\\frac{\\nu \\Delta t}{\\Delta x^2} + \\frac{a \\Delta t}{2\\Delta x}) = 1$。因此，当且仅当所有系数都非负时，该格式才构成凸组合。\n1.  $C_i \\ge 0 \\implies 1 - \\frac{2\\nu \\Delta t}{\\Delta x^2} \\ge 0 \\implies \\Delta t \\le \\frac{\\Delta x^2}{2\\nu}$。这是标准的扩散项 CFL 稳定性条件。\n2.  $C_{i+1} \\ge 0 \\implies \\frac{\\nu \\Delta t}{\\Delta x^2} - \\frac{a \\Delta t}{2\\Delta x} \\ge 0$。假设 $\\Delta t  0$，这简化为 $\\frac{\\nu}{\\Delta x} \\ge \\frac{a}{2}$。\n3.  $C_{i-1} \\ge 0 \\implies \\frac{\\nu \\Delta t}{\\Delta x^2} + \\frac{a \\Delta t}{2\\Delta x} \\ge 0$。假设 $\\Delta t  0$，这简化为 $\\frac{\\nu}{\\Delta x} \\ge -\\frac{a}{2}$。\n\n结合关于 $C_{i+1}$ 和 $C_{i-1}$ 的条件可得 $|\\frac{a}{2}| \\le \\frac{\\nu}{\\Delta x}$，这等价于 $\\frac{|a|\\Delta x}{\\nu} \\le 2$。这对单元格佩克莱特数 $Pe_h = \\frac{|a|\\Delta x}{\\nu}$ 引入了一个限制。\n因此，采用前向欧拉法的 FD-central 格式在满足以下两个条件时满足 DMP：\n$$\n\\Delta t \\le \\frac{\\Delta x^2}{2\\nu} \\quad \\text{(抛物线型 CFL 条件)} \\quad \\text{和} \\quad Pe_h = \\frac{|a|\\Delta x}{\\nu} \\le 2 \\quad \\text{(单元格佩克莱特条件)}\n$$\n当 $Pe_h  2$ 时，其中一个非对角系数变为负数。这意味着 $u_i^{n+1}$ 不再是其邻近点的凸组合。负系数允许产生新的极值点（伪振荡或下冲/过冲），从而不满足 DMP。当对流主导扩散（$Pe_h \\gg 1$）且解具有陡峭梯度时，这一点尤其明显。\n\n**有限体积迎风限制（FV-upwind-limited）格式分析**\n\n有限体积法根据单元格边界（界面）处的通量来更新单元格平均值 $\\bar{u}_i$：\n$$\n\\frac{d\\bar{u}_i}{dt} = -\\frac{1}{\\Delta x} (F_{i+1/2} - F_{i-1/2})\n$$\n数值通量 $F_{i+1/2}$ 由对流部分和扩散部分组成：$F_{i+1/2} = F_{i+1/2}^{conv} + F_{i+1/2}^{diff}$。扩散通量通过中心差分来近似：$F_{i+1/2}^{diff} = -\\nu \\frac{\\bar{u}_{i+1} - \\bar{u}_i}{\\Delta x}$。\n\n对于对流通量，该格式在每个单元格 $i$ 内使用分段线性重构，$u(x) = \\bar{u}_i + \\sigma_i (x - x_i)$，其中 $\\sigma_i$ 是一个受限斜率。在单边差分上指定的 minmod 限制器为：\n$$\n\\sigma_i = \\text{minmod}\\left(\\frac{\\bar{u}_i - \\bar{u}_{i-1}}{\\Delta x}, \\frac{\\bar{u}_{i+1} - \\bar{u}_i}{\\Delta x}\\right)\n$$\n其中 $\\text{minmod}(a,b) = \\frac{1}{2}(\\text{sgn}(a)+\\text{sgn}(b))\\min(|a|,|b|)$。限制器的目的是使重构非振荡，即在单元格边缘重构的值 $\\bar{u}_i \\pm \\sigma_i \\frac{\\Delta x}{2}$ 不超过相邻单元格平均值。此属性对于满足 DMP 至关重要。\n\n然后，基于 $a$ 的符号使用迎风选择来确定对流通量。在界面 $i+1/2$ 处：\n- 如果 $a  0$，流动方向是从左到右，因此我们使用来自单元格 $i$ 的重构：$F_{i+1/2}^{conv} = a \\left(\\bar{u}_i + \\sigma_i \\frac{\\Delta x}{2}\\right)$。\n- 如果 $a  0$，流动方向是从右到左，因此我们使用来自单元格 $i+1$ 的重构：$F_{i+1/2}^{conv} = a \\left(\\bar{u}_{i+1} - \\sigma_{i+1} \\frac{\\Delta x}{2}\\right)$。\n\n根据设计，对于纯对流情况，这种迎风限制格式是总变差递减（TVD）的，这意味着它是保单调的，因此在合适的 CFL 条件下（通常是 $|a|\\Delta t/\\Delta x \\le 1/2$）满足 DMP。为了分析完整的对流-扩散方程，考虑更简单的一阶迎风格式（$\\sigma_i=0$）。对于 $a0$，更新公式为：\n$$\n\\bar{u}_i^{n+1} = \\bar{u}_i^n - \\frac{\\Delta t}{\\Delta x}\\left[ a\\bar{u}_i - \\nu\\frac{\\bar{u}_{i+1}-\\bar{u}_i}{\\Delta x} \\right] + \\frac{\\Delta t}{\\Delta x}\\left[ a\\bar{u}_{i-1} - \\nu\\frac{\\bar{u}_i-\\bar{u}_{i-1}}{\\Delta x} \\right]\n$$\n$$\n\\bar{u}_i^{n+1} = \\left(\\frac{\\nu\\Delta t}{\\Delta x^2}\\right)\\bar{u}_{i+1}^n + \\left(1 - \\frac{a\\Delta t}{\\Delta x} - \\frac{2\\nu\\Delta t}{\\Delta x^2}\\right)\\bar{u}_i^n + \\left(\\frac{a\\Delta t}{\\Delta x} + \\frac{\\nu\\Delta t}{\\Delta x^2}\\right)\\bar{u}_{i-1}^n\n$$\n为使其成为凸组合，系数必须非负。对于 $a0, \\nu0$，这简化为关于 $\\bar{u}_i^n$ 系数的单个条件：\n$$\n1 - \\frac{a\\Delta t}{\\Delta x} - \\frac{2\\nu\\Delta t}{\\Delta x^2} \\ge 0 \\implies \\Delta t \\left( \\frac{a}{\\Delta x} + \\frac{2\\nu}{\\Delta x^2} \\right) \\le 1\n$$\n此条件保证了一阶格式的单调性，而对单元格佩克莱特数 $Pe_h$ 没有任何限制。带斜率限制器的二阶格式行为类似；限制器在陡峭梯度或极值点附近基本上将格式降为一阶精度以抑制振荡，从而保持单调性，同时在光滑区域提供更高的精度。这就是为什么 FV-upwind-limited 格式即使在高 $Pe_h$ 下也有望满足 DMP，从而修正了 FD-central 格式失效的问题。", "answer": "```python\nimport numpy as np\n\ndef minmod(a, b):\n    \"\"\"Vectorized minmod function.\"\"\"\n    # Ensure inputs are numpy arrays for vectorized operations\n    a = np.asarray(a)\n    b = np.asarray(b)\n    # The sign check correctly handles the case where signs differ (result is 0)\n    # and where they are the same (result has the same sign).\n    return 0.5 * (np.sign(a) + np.sign(b)) * np.minimum(np.abs(a), np.abs(b))\n\ndef run_fd_central(N, a, nu, dt, T, ic_type, tau):\n    \"\"\"\n    Solves the 1D advection-diffusion equation using FD-central in space\n    and Forward Euler in time.\n    \"\"\"\n    dx = 1.0 / N\n    x = (np.arange(N) + 0.5) * dx\n\n    if ic_type == 'smooth':\n        u = 0.5 + 0.5 * np.sin(2 * np.pi * x)\n    elif ic_type == 'sharp':\n        u = np.zeros(N, dtype=np.float64)\n        mask = (x >= 0.4)  (x  0.6)\n        u[mask] = 1.0\n    else:\n        raise ValueError(\"Invalid initial condition type\")\n        \n    u = u.astype(np.float64)\n\n    u_min_0 = np.min(u)\n    u_max_0 = np.max(u)\n    \n    num_steps = int(round(T / dt))\n    \n    dmp_holds = True\n    for _ in range(num_steps):\n        u_plus_1 = np.roll(u, -1)\n        u_minus_1 = np.roll(u, 1)\n        \n        u_x = (u_plus_1 - u_minus_1) / (2.0 * dx)\n        u_xx = (u_plus_1 - 2.0 * u + u_minus_1) / (dx**2)\n        \n        u = u - dt * (a * u_x - nu * u_xx)\n        \n        if np.min(u)  u_min_0 - tau or np.max(u) > u_max_0 + tau:\n            dmp_holds = False\n            break\n            \n    return dmp_holds\n\ndef run_fv_upwind_limited(N, a, nu, dt, T, ic_type, tau):\n    \"\"\"\n    Solves the 1D advection-diffusion equation using a second-order TVD\n    finite volume scheme with a minmod limiter.\n    \"\"\"\n    dx = 1.0 / N\n    x = (np.arange(N) + 0.5) * dx\n\n    if ic_type == 'smooth':\n        u = 0.5 + 0.5 * np.sin(2 * np.pi * x)\n    elif ic_type == 'sharp':\n        u = np.zeros(N, dtype=np.float64)\n        mask = (x >= 0.4)  (x  0.6)\n        u[mask] = 1.0\n    else:\n        raise ValueError(\"Invalid initial condition type\")\n\n    u = u.astype(np.float64)\n\n    u_min_0 = np.min(u)\n    u_max_0 = np.max(u)\n\n    num_steps = int(round(T / dt))\n\n    dmp_holds = True\n    for _ in range(num_steps):\n        # Calculate slopes with minmod limiter\n        du_bwd = (u - np.roll(u, 1)) / dx\n        du_fwd = (np.roll(u, -1) - u) / dx\n        slopes = minmod(du_bwd, du_fwd)\n\n        # Reconstruct values at interfaces i+1/2\n        # u_L is the value from cell i at its right edge\n        u_L = u + slopes * dx / 2.0\n        # u_R is the value from cell i+1 at its left edge\n        u_R = np.roll(u, -1) - np.roll(slopes, -1) * dx / 2.0\n\n        # Convective flux (upwind)\n        # flux = a * u_upwind\n        # a>0: u_upwind = u_L. a0: u_upwind = u_R\n        flux_conv = (a + np.abs(a)) / 2.0 * u_L + (a - np.abs(a)) / 2.0 * u_R\n\n        # Diffusive flux (centered)\n        flux_diff = -nu * (np.roll(u, -1) - u) / dx\n        \n        # Total flux at interfaces i+1/2\n        total_flux = flux_conv + flux_diff\n        \n        # Update cell averages using flux differences\n        u = u - (dt / dx) * (total_flux - np.roll(total_flux, 1))\n\n        if np.min(u)  u_min_0 - tau or np.max(u) > u_max_0 + tau:\n            dmp_holds = False\n            break\n\n    return dmp_holds\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # DMP tolerance\n    tau = 1.0e-8\n\n    test_cases = [\n        # Case 1: happy path, smooth and diffusive\n        {'N': 100, 'a': 1.0, 'nu': 0.1, 'dt': 2.5e-4, 'T': 0.05, 'scheme': 'FD-central', 'ic_type': 'smooth'},\n        # Case 2: counterexample, high Pe_h with centered differences\n        {'N': 100, 'a': 5.0, 'nu': 1.0e-3, 'dt': 2.0e-4, 'T': 0.02, 'scheme': 'FD-central', 'ic_type': 'sharp'},\n        # Case 3: remedy with limiter at high Pe_h\n        {'N': 100, 'a': 5.0, 'nu': 1.0e-3, 'dt': 1.0e-3, 'T': 0.02, 'scheme': 'FV-upwind-limited', 'ic_type': 'sharp'},\n        # Case 4: borderline Pe_h with centered differences\n        {'N': 100, 'a': 1.0, 'nu': 1.0e-2, 'dt': 2.5e-3, 'T': 0.05, 'scheme': 'FD-central', 'ic_type': 'sharp'},\n    ]\n    \n    results = []\n    \n    for case in test_cases:\n        if case['scheme'] == 'FD-central':\n            result = run_fd_central(case['N'], case['a'], case['nu'], case['dt'], case['T'], case['ic_type'], tau)\n        elif case['scheme'] == 'FV-upwind-limited':\n            result = run_fv_upwind_limited(case['N'], case['a'], case['nu'], case['dt'], case['T'], case['ic_type'], tau)\n        else:\n            raise ValueError(f\"Unknown scheme: {case['scheme']}\")\n        results.append(str(result).lower())\n        \n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3337479"}]}