{"hands_on_practices": [{"introduction": "傅里叶分析是评估有限差分格式性能的基本工具。通过将离散算子作用于单个傅里叶模态，我们可以推导出其离散符号，这揭示了该格式在不同波长下的行为。这项练习 [@problem_id:3310598] 将指导您分析一个标准的混合偏导数中心差分格式，以确定其精度阶数和各向异性，这些是衡量其在实际CFD模拟中可靠性的关键指标。", "problem": "考虑一个在 $x$ 和 $y$ 方向上间距分别为 $h_x$ 和 $h_y$ 的均匀笛卡尔网格，以及一个足够光滑的标量场 $u(x,y)$。在计算流体力学中，混合正应力和旋转扩散通量经常会引入混合二阶导数算子 $\\frac{\\partial^2 u}{\\partial x \\partial y}$。在网格上，使用一个9点中心差分格式来近似内部节点 $(i,j)$ 处的此算子，该格式的非零系数仅位于四个对角相邻点上：\n$$\n\\left(D_{xy}^{h} u\\right)_{i,j} \\;=\\; \\frac{1}{4 h_x h_y} \\left( u_{i+1,j+1} \\;-\\; u_{i+1,j-1} \\;-\\; u_{i-1,j+1} \\;+\\; u_{i-1,j-1} \\right).\n$$\n你的任务是：\n- 使用作用于离散傅里叶模态 $u_{i,j} = \\exp\\!\\big(i(k_x\\, i\\, h_x + k_y\\, j\\, h_y)\\big)$ 的线性、位移不变算子的离散傅里叶符号的定义，推导出 $D_{xy}^{h}$ 的精确离散傅里叶符号 $\\sigma_h(k_x,k_y)$。\n- 从与作用于 $u(x,y) = \\exp\\!\\big(i(k_x x + k_y y)\\big)$ 的连续算子 $\\frac{\\partial^2}{\\partial x \\partial y}$ 相关联的连续符号 $\\sigma_c(k_x,k_y)$ 出发，通过小波数展开比较 $\\sigma_h(k_x,k_y)$ 和 $\\sigma_c(k_x,k_y)$，并确定关于 $h_x$ 和 $h_y$ 的主阶截断误差和相应的形式精度阶。\n- 为了评估方向各向异性，将问题特化到各向同性网格，其中 $h_x = h_y = h$，并引入极坐标波数坐标 $k_x = k \\cos\\theta$ 和 $k_y = k \\sin\\theta$，其中 $k \\ge 0$ 且 $\\theta \\in [0,2\\pi)$。定义精确相对符号\n$$\nR(kh,\\theta) \\;=\\; \\frac{\\sigma_h(k\\cos\\theta,\\,k\\sin\\theta)}{\\sigma_c(k\\cos\\theta,\\,k\\sin\\theta)}.\n$$\n对于小的 $kh$，解释 $R(kh,\\theta)$ 的角度依赖性，以量化各向异性。\n\n答案格式要求：作为你的最终答案，请提供 $R(kh,\\theta)$ 关于 $k$、$h$ 和 $\\theta$ 的单一闭式解析表达式。不包含任何单位。无需进行数值四舍五入。", "solution": "所给问题要求对混合偏导数 $\\frac{\\partial^2 u}{\\partial x \\partial y}$ 的一个有限差分格式进行多部分分析。该分析涉及使用傅里叶分析来确定该格式的离散符号、精度阶和方向各向异性。该问题是适定的且在科学上是合理的，因此我们可以进行求解。\n\n### 第1部分：离散傅里叶符号的推导\n\n问题给出了作用于网格函数 $u_{i,j}$ 的离散算子 $(D_{xy}^{h})$：\n$$ (D_{xy}^{h} u)_{i,j} = \\frac{1}{4 h_x h_y} ( u_{i+1,j+1} - u_{i+1,j-1} - u_{i-1,j+1} + u_{i-1,j-1} ) $$\n离散傅里叶符号 $\\sigma_h(k_x,k_y)$ 是通过该算子作用于单个傅里叶模态 $u_{i,j} = \\exp(i(k_x i h_x + k_y j h_y))$ 来定义的，使得 $(D_{xy}^{h} u)_{i,j} = \\sigma_h(k_x, k_y) u_{i,j}$。\n\n为了求出 $\\sigma_h$，我们首先计算给定傅里叶模态下差分格式中的各项。任何位移项 $u_{i+m, j+n}$ 都可以写成：\n$$ u_{i+m,j+n} = \\exp(i(k_x(i+m)h_x + k_y(j+n)h_y)) = \\exp(i(k_x i h_x + k_y j h_y)) \\exp(i(m k_x h_x + n k_y h_y)) = u_{i,j} \\exp(i(m k_x h_x + n k_y h_y)) $$\n将此应用于差分格式中的四个点，得到：\n$u_{i+1,j+1} = u_{i,j} \\exp(i(k_x h_x + k_y h_y))$\n$u_{i+1,j-1} = u_{i,j} \\exp(i(k_x h_x - k_y h_y))$\n$u_{i-1,j+1} = u_{i,j} \\exp(i(-k_x h_x + k_y h_y))$\n$u_{i-1,j-1} = u_{i,j} \\exp(i(-k_x h_x - k_y h_y))$\n\n将这些代入算子定义中：\n$$ (D_{xy}^{h} u)_{i,j} = \\frac{u_{i,j}}{4 h_x h_y} \\left[ \\exp(i(k_x h_x + k_y h_y)) - \\exp(i(k_x h_x - k_y h_y)) - \\exp(i(-k_x h_x + k_y h_y)) + \\exp(i(-k_x h_x - k_y h_y)) \\right] $$\n让我们通过因式分解来简化方括号中的表达式：\n$$ \\exp(ik_xh_x)(\\exp(ik_yh_y) - \\exp(-ik_yh_y)) - \\exp(-ik_xh_x)(\\exp(ik_yh_y) - \\exp(-ik_yh_y)) $$\n$$ = (\\exp(ik_xh_x) - \\exp(-ik_xh_x))(\\exp(ik_yh_y) - \\exp(-ik_yh_y)) $$\n使用欧拉恒等式 $\\exp(i\\phi) - \\exp(-i\\phi) = 2i\\sin(\\phi)$，该表达式变为：\n$$ (2i \\sin(k_x h_x)) (2i \\sin(k_y h_y)) = 4i^2 \\sin(k_x h_x) \\sin(k_y h_y) = -4 \\sin(k_x h_x) \\sin(k_y h_y) $$\n将此结果代回到 $(D_{xy}^{h} u)_{i,j}$ 的方程中：\n$$ (D_{xy}^{h} u)_{i,j} = \\frac{u_{i,j}}{4 h_x h_y} [-4 \\sin(k_x h_x) \\sin(k_y h_y)] = \\left( -\\frac{\\sin(k_x h_x) \\sin(k_y h_y)}{h_x h_y} \\right) u_{i,j} $$\n由此，我们确定离散傅里叶符号为：\n$$ \\sigma_h(k_x, k_y) = -\\frac{\\sin(k_x h_x) \\sin(k_y h_y)}{h_x h_y} $$\n\n### 第2部分：截断误差和精度阶\n\n首先，我们确定作用于连续模态 $u(x,y) = \\exp(i(k_x x + k_y y))$ 的连续算子 $L = \\frac{\\partial^2}{\\partial x \\partial y}$ 的连续符号 $\\sigma_c(k_x, k_y)$。\n$$ \\frac{\\partial^2 u}{\\partial x \\partial y} = \\frac{\\partial}{\\partial x} \\left( \\frac{\\partial u}{\\partial y} \\right) = \\frac{\\partial}{\\partial x} (ik_y u) = (ik_y)(ik_x) u = -k_x k_y u $$\n根据定义，$L u = \\sigma_c u$，所以连续符号是：\n$$ \\sigma_c(k_x, k_y) = -k_x k_y $$\n为了确定截断误差，我们对 $\\sigma_h(k_x, k_y)$ 进行关于小波数（即小的 $k_x h_x$ 和 $k_y h_y$）的泰勒级数展开。正弦函数的泰勒级数是 $\\sin(z) = z - z^3/6 + O(z^5)$。\n$$ \\sigma_h(k_x, k_y) = -\\frac{1}{h_x h_y} \\left( k_x h_x - \\frac{(k_x h_x)^3}{6} + \\dots \\right) \\left( k_y h_y - \\frac{(k_y h_y)^3}{6} + \\dots \\right) $$\n$$ \\sigma_h(k_x, k_y) = -\\left( k_x - \\frac{k_x^3 h_x^2}{6} + \\dots \\right) \\left( k_y - \\frac{k_y^3 h_y^2}{6} + \\dots \\right) $$\n$$ \\sigma_h(k_x, k_y) = -\\left( k_x k_y - \\frac{k_x k_y^3 h_y^2}{6} - \\frac{k_y k_x^3 h_x^2}{6} + \\text{h.o.t.} \\right) $$\n$$ \\sigma_h(k_x, k_y) = -k_x k_y + \\frac{k_x k_y}{6}(k_x^2 h_x^2 + k_y^2 h_y^2) + \\text{h.o.t.} $$\n离散符号和连续符号之间的差为 $\\sigma_h - \\sigma_c$：\n$$ \\sigma_h - \\sigma_c = \\left( -k_x k_y + \\frac{k_x k_y}{6}(k_x^2 h_x^2 + k_y^2 h_y^2) + \\dots \\right) - (-k_x k_y) = \\frac{k_x k_y}{6}(k_x^2 h_x^2 + k_y^2 h_y^2) + \\dots $$\n主阶截断误差的符号是 $\\frac{k_x k_y}{6}(k_x^2 h_x^2 + k_y^2 h_y^2)$。由于误差与 $h_x^2$ 和 $h_y^2$ 成正比，该离散算子的形式精度阶是二阶的，记作 $O(h_x^2, h_y^2)$。\n\n### 第3部分：方向各向异性\n\n我们现在将问题特化到各向同性网格，其中 $h_x = h_y = h$。离散和连续符号变为：\n$$ \\sigma_h(k_x, k_y) = -\\frac{\\sin(k_x h) \\sin(k_y h)}{h^2} $$\n$$ \\sigma_c(k_x, k_y) = -k_x k_y $$\n相对符号 $R$ 定义为比率 $\\sigma_h / \\sigma_c$：\n$$ R(k_x, k_y) = \\frac{\\sigma_h(k_x, k_y)}{\\sigma_c(k_x, k_y)} = \\frac{-\\sin(k_x h) \\sin(k_y h)/h^2}{-k_x k_y} = \\frac{\\sin(k_x h) \\sin(k_y h)}{h^2 k_x k_y} = \\left(\\frac{\\sin(k_x h)}{k_x h}\\right) \\left(\\frac{\\sin(k_y h)}{k_y h}\\right) $$\n接下来，我们引入极坐标波数坐标 $k_x = k \\cos\\theta$ 和 $k_y = k \\sin\\theta$。将它们代入 $R$ 的表达式中：\n$$ R(kh, \\theta) = \\left(\\frac{\\sin((k \\cos\\theta) h)}{(k \\cos\\theta) h}\\right) \\left(\\frac{\\sin((k \\sin\\theta) h)}{(k \\sin\\theta) h}\\right) $$\n这个表达式表示离散放大因子与连续放大因子之比，它是无量纲波数 $kh$ 和波传播角 $\\theta$ 的函数。这就是所要求的最终解析表达式。\n\n为了解释各向异性，我们可以对小的 $kh$ 展开 $R(kh, \\theta)$。令 $\\xi = kh$。\n$$ R(\\xi, \\theta) = \\left(1 - \\frac{(\\xi \\cos\\theta)^2}{6} + \\dots\\right) \\left(1 - \\frac{(\\xi \\sin\\theta)^2}{6} + \\dots\\right) \\approx 1 - \\frac{\\xi^2}{6}(\\cos^2\\theta + \\sin^2\\theta) = 1 - \\frac{\\xi^2}{6} $$\n在主阶上，误差仅取决于波数的大小（$k$），而不取决于其方向（$\\theta$）。这表明该格式在主阶误差上是各向同性的。然而，展开到下一阶则揭示了其各向异性：\n$$ R(kh, \\theta) \\approx 1 - \\frac{(kh)^2}{6} + (kh)^4 \\frac{7 - \\cos(4\\theta)}{720} $$\n$O((kh)^4)$ 项通过 $\\cos(4\\theta)$ 依赖于 $\\theta$，表明该格式的精度在更高阶上是方向相关的。对于与网格轴对齐的波（$\\theta = n\\pi/2$），误差最小；而对于与网格对角线对齐的波（$\\theta = \\pi/4 + n\\pi/2$），误差最大。\n\n最终答案只需要 $R(kh, \\theta)$ 的闭式表达式。\n$$ R(kh, \\theta) = \\frac{\\sin(kh \\cos\\theta)}{kh \\cos\\theta} \\frac{\\sin(kh \\sin\\theta)}{kh \\sin\\theta} $$", "answer": "$$\n\\boxed{\\frac{\\sin(kh \\cos\\theta)}{kh \\cos\\theta} \\frac{\\sin(kh \\sin\\theta)}{kh \\sin\\theta}}\n$$", "id": "3310598"}, {"introduction": "在连续介质中，混合偏导数的求导次序可以互换，即 $\\frac{\\partial^2 u}{\\partial x \\partial y} = \\frac{\\partial^2 u}{\\partial y \\partial x}$，但这一性质在离散世界中并不总是成立。在计算流体力学中广泛使用的非均匀网格上，离散微分算子的非对易性是一个微妙但至关重要的概念。这项练习 [@problem_id:3310685] 通过一个具体的反例，让您亲手计算离散算子对易子，并将其与网格拉伸率联系起来，从而揭示这种“对易误差”的来源。", "problem": "考虑一个二维物理域上的光滑标量场 $u(x,y)$，并回想一个连续性事实：对于足够光滑的 $u$，混合偏导数是可交换的，即 $\\frac{\\partial^{2} u}{\\partial x \\partial y} = \\frac{\\partial^{2} u}{\\partial y \\partial x}$。在计算流体动力学中，偏导数在网格上通过离散算子进行近似。在非均匀网格上，这样的离散算子不一定可交换。\n\n设网格是结构化的，索引为 $(i,j)$，并定义节点 $(i,j)$ 的物理位置为 $x_{i,j} = \\alpha_{j}\\, i\\, h$ 和 $y_{i,j} = \\beta_{i}\\, j\\, h$，其中 $(\\alpha_{j})_{j\\in\\mathbb{Z}}$ 和 $(\\beta_{i})_{i\\in\\mathbb{Z}}$ 分别是编码 $x$ 方向和 $y$ 方向网格拉伸的严格正序列，而 $h>0$ 是一个参考间距。因此，沿坐标线的局部间距为 $h^{x}_{i-1/2}(j) = x_{i,j} - x_{i-1,j} = \\alpha_{j}\\, h$ 和 $h^{y}_{j+1/2}(i) = y_{i,j+1} - y_{i,j} = \\beta_{i}\\, h$。在 $(i,j)$ 处定义离散一阶导数算子，采用 $x$ 方向的一阶后向差分和 $y$ 方向的一阶前向差分：\n$$\nD_{x} u(i,j) = \\frac{u_{i,j} - u_{i-1,j}}{h^{x}_{i-1/2}(j)} = \\frac{u_{i,j} - u_{i-1,j}}{\\alpha_{j}\\, h}, \n\\qquad\nD_{y} u(i,j) = \\frac{u_{i,j+1} - u_{i,j}}{h^{y}_{j+1/2}(i)} = \\frac{u_{i,j+1} - u_{i,j}}{\\beta_{i}\\, h}.\n$$\n这些选择代表了在通量守恒离散化中常用的单边离散梯度。\n\n设测试场为双线性函数 $u(x,y) = x\\, y$，因此 $u_{i,j} = u(x_{i,j}, y_{i,j}) = x_{i,j}\\, y_{i,j}$。考虑一个内部节点 $(i,j)$，其邻居 $(i-1,j)$ 和 $(i,j+1)$ 是可用的。\n\n定义网格拉伸比\n$$\nr_{x}(j) = \\frac{\\alpha_{j+1}}{\\alpha_{j}}, \n\\qquad\nr_{y}(i) = \\frac{\\beta_{i-1}}{\\beta_{i}},\n$$\n它们量化了在横向方向上移动一个索引时，间距如何变化。\n\n任务：从上述定义出发，不使用任何预先推导的离散对易子恒等式，计算在通用内部节点 $(i,j)$ 处的 $D_{x} D_{y} u(i,j)$ 和 $D_{y} D_{x} u(i,j)$，并简化它们的差 $[D_{x}, D_{y}]\\, u(i,j) := D_{x} D_{y} u(i,j) - D_{y} D_{x} u(i,j)$。将您的最终答案仅表示为包含 $i$、$j$、$r_{x}(j)$ 和 $r_{y}(i)$ 的封闭形式解析表达式。不需要进行数值计算。", "solution": "该问题是有效的，因为它具有科学依据、提法恰当、客观，并包含一套完整且一致的定义。它展示了偏微分方程数值分析领域中一个标准但详细的计算。我们可以开始求解。\n\n任务是计算在给定的非均匀网格上，对于指定的测试场 $u(x,y) = x\\,y$，离散导数算子的对易子 $[D_{x}, D_{y}]\\, u(i,j) = D_{x} D_{y} u(i,j) - D_{y} D_{x} u(i,j)$。\n\n首先，我们使用网格坐标的定义 $x_{i,j} = \\alpha_{j}\\,i\\,h$ 和 $y_{i,j} = \\beta_{i}\\,j\\,h$ 来表示离散场 $u_{i,j}$。\n$$\nu_{i,j} = u(x_{i,j}, y_{i,j}) = x_{i,j} y_{i,j} = (\\alpha_{j}\\,i\\,h)(\\beta_{i}\\,j\\,h) = i\\,j\\,\\alpha_{j}\\,\\beta_{i}\\,h^{2}\n$$\n我们将分别计算对易子的两个项，$D_{x} D_{y} u(i,j)$ 和 $D_{y} D_{x} u(i,j)$。\n\n让我们从计算 $D_{x} D_{y} u(i,j)$ 开始。我们首先计算内部运算，$v(i,j) = D_{y} u(i,j)$。\n算子 $D_{y}$ 定义为：\n$$\nD_{y} u(i,j) = \\frac{u_{i,j+1} - u_{i,j}}{\\beta_{i}\\,h}\n$$\n我们需要节点 $(i, j+1)$ 处的 $u$ 值：\n$$\nu_{i,j+1} = x_{i,j+1} y_{i,j+1} = (\\alpha_{j+1}\\,i\\,h)(\\beta_{i}\\,(j+1)\\,h) = i\\,(j+1)\\,\\alpha_{j+1}\\,\\beta_{i}\\,h^{2}\n$$\n将 $u_{i,j}$ 和 $u_{i,j+1}$ 代入 $D_{y} u(i,j)$ 的表达式中：\n$$\nv(i,j) = D_{y} u(i,j) = \\frac{i\\,(j+1)\\,\\alpha_{j+1}\\,\\beta_{i}\\,h^{2} - i\\,j\\,\\alpha_{j}\\,\\beta_{i}\\,h^{2}}{\\beta_{i}\\,h}\n$$\n提取公因式：\n$$\nv(i,j) = \\frac{i\\,\\beta_{i}\\,h^{2} \\left((j+1)\\,\\alpha_{j+1} - j\\,\\alpha_{j}\\right)}{\\beta_{i}\\,h} = i\\,h \\left((j+1)\\,\\alpha_{j+1} - j\\,\\alpha_{j}\\right)\n$$\n现在，我们将 $D_{x}$ 算子应用于 $v(i,j)$。算子 $D_{x}$ 定义为：\n$$\nD_{x} v(i,j) = \\frac{v(i,j) - v(i-1,j)}{\\alpha_{j}\\,h}\n$$\n我们需要 $v(i-1,j)$，这可以通过将 $v(i,j)$ 表达式中的 $i$ 替换为 $i-1$ 来获得：\n$$\nv(i-1,j) = (i-1)\\,h \\left((j+1)\\,\\alpha_{j+1} - j\\,\\alpha_{j}\\right)\n$$\n将 $v(i,j)$ 和 $v(i-1,j)$ 代入 $D_{x}v(i,j)$ 的表达式中：\n$$\nD_{x} D_{y} u(i,j) = \\frac{i\\,h \\left((j+1)\\,\\alpha_{j+1} - j\\,\\alpha_{j}\\right) - (i-1)\\,h \\left((j+1)\\,\\alpha_{j+1} - j\\,\\alpha_{j}\\right)}{\\alpha_{j}\\,h}\n$$\n提取分子中的公因式：\n$$\nD_{x} D_{y} u(i,j) = \\frac{(i - (i-1))\\,h \\left((j+1)\\,\\alpha_{j+1} - j\\,\\alpha_{j}\\right)}{\\alpha_{j}\\,h} = \\frac{\\left((j+1)\\,\\alpha_{j+1} - j\\,\\alpha_{j}\\right)}{\\alpha_{j}}\n$$\n$$\nD_{x} D_{y} u(i,j) = (j+1)\\,\\frac{\\alpha_{j+1}}{\\alpha_{j}} - j\n$$\n使用给定的网格拉伸比 $r_{x}(j) = \\frac{\\alpha_{j+1}}{\\alpha_{j}}$，我们得到：\n$$\nD_{x} D_{y} u(i,j) = (j+1)\\,r_{x}(j) - j\n$$\n\n接下来，我们计算 $D_{y} D_{x} u(i,j)$。我们首先计算内部运算，$w(i,j) = D_{x} u(i,j)$。\n$$\nD_{x} u(i,j) = \\frac{u_{i,j} - u_{i-1,j}}{\\alpha_{j}\\,h}\n$$\n我们需要节点 $(i-1, j)$ 处的 $u$ 值：\n$$\nu_{i-1,j} = x_{i-1,j} y_{i-1,j} = (\\alpha_{j}\\,(i-1)\\,h)(\\beta_{i-1}\\,j\\,h) = j\\,(i-1)\\,\\alpha_{j}\\,\\beta_{i-1}\\,h^{2}\n$$\n将 $u_{i,j}$ 和 $u_{i-1,j}$ 代入 $D_{x} u(i,j)$ 的表达式中：\n$$\nw(i,j) = D_{x} u(i,j) = \\frac{i\\,j\\,\\alpha_{j}\\,\\beta_{i}\\,h^{2} - j\\,(i-1)\\,\\alpha_{j}\\,\\beta_{i-1}\\,h^{2}}{\\alpha_{j}\\,h}\n$$\n提取公因式：\n$$\nw(i,j) = \\frac{j\\,\\alpha_{j}\\,h^{2} \\left(i\\,\\beta_{i} - (i-1)\\,\\beta_{i-1}\\right)}{\\alpha_{j}\\,h} = j\\,h \\left(i\\,\\beta_{i} - (i-1)\\,\\beta_{i-1}\\right)\n$$\n现在，我们将 $D_{y}$ 算子应用于 $w(i,j)$：\n$$\nD_{y} w(i,j) = \\frac{w(i,j+1) - w(i,j)}{\\beta_{i}\\,h}\n$$\n我们需要 $w(i,j+1)$，这可以通过将 $w(i,j)$ 表达式中的 $j$ 替换为 $j+1$ 来获得：\n$$\nw(i,j+1) = (j+1)\\,h \\left(i\\,\\beta_{i} - (i-1)\\,\\beta_{i-1}\\right)\n$$\n将 $w(i,j)$ 和 $w(i,j+1)$ 代入 $D_{y}w(i,j)$ 的表达式中：\n$$\nD_{y} D_{x} u(i,j) = \\frac{(j+1)\\,h \\left(i\\,\\beta_{i} - (i-1)\\,\\beta_{i-1}\\right) - j\\,h \\left(i\\,\\beta_{i} - (i-1)\\,\\beta_{i-1}\\right)}{\\beta_{i}\\,h}\n$$\n提取分子中的公因式：\n$$\nD_{y} D_{x} u(i,j) = \\frac{((j+1) - j)\\,h \\left(i\\,\\beta_{i} - (i-1)\\,\\beta_{i-1}\\right)}{\\beta_{i}\\,h} = \\frac{i\\,\\beta_{i} - (i-1)\\,\\beta_{i-1}}{\\beta_{i}}\n$$\n$$\nD_{y} D_{x} u(i,j) = i - (i-1)\\,\\frac{\\beta_{i-1}}{\\beta_{i}}\n$$\n使用给定的网格拉伸比 $r_{y}(i) = \\frac{\\beta_{i-1}}{\\beta_{i}}$，我们得到：\n$$\nD_{y} D_{x} u(i,j) = i - (i-1)\\,r_{y}(i)\n$$\n\n最后，我们计算差值以求得对易子：\n$$\n[D_{x}, D_{y}]\\, u(i,j) = D_{x} D_{y} u(i,j) - D_{y} D_{x} u(i,j) = \\left((j+1)\\,r_{x}(j) - j\\right) - \\left(i - (i-1)\\,r_{y}(i)\\right)\n$$\n$$\n[D_{x}, D_{y}]\\, u(i,j) = (j+1)\\,r_{x}(j) - j - i + (i-1)\\,r_{y}(i)\n$$\n这个表达式可以通过分离与均匀网格（其中 $r_x=1$ 和 $r_y=1$）的偏差来重排成一个更具洞察力的形式。\n我们将第一项重写为：\n$$\n(j+1)\\,r_{x}(j) - j = (j+1)\\,r_{x}(j) - (j+1) + 1 = (j+1)(r_x(j) - 1) + 1\n$$\n我们将第二项重写为：\n$$\ni - (i-1)\\,r_{y}(i) = i - (i-1) - (i-1)(r_y(i) - 1) = 1 - (i-1)(r_y(i) - 1) = 1 + (i-1)(1 - r_y(i))\n$$\n从重写的第一项中减去重写的第二项：\n$$\n[D_{x}, D_{y}]\\, u(i,j) = \\left( (j+1)(r_x(j) - 1) + 1 \\right) - \\left( 1 + (i-1)(1 - r_y(i)) \\right)\n$$\n$$\n[D_{x}, D_{y}]\\, u(i,j) = (j+1)(r_x(j) - 1) - (i-1)(1 - r_y(i))\n$$\n$$\n[D_{x}, D_{y}]\\, u(i,j) = (j+1)(r_x(j) - 1) + (i-1)(r_y(i) - 1)\n$$\n这个最终形式清楚地表明，如果网格在两个方向上都是均匀的（即 $r_x(j)=1$ 和 $r_y(i)=1$），则对易子为零。", "answer": "$$\n\\boxed{(j+1)(r_x(j) - 1) + (i-1)(r_y(i) - 1)}\n$$", "id": "3310685"}, {"introduction": "理论分析和代码实现是相辅相成的，验证数值代码的正确性是科学计算的基石。制造解方法（Method of Manufactured Solutions, MMS）是验证数值模拟代码收敛阶的最严格和通用的技术之一。在此练习 [@problem_id:3310638] 中，您将构造一个解析解，推导出一个偏微分方程必须满足的源项，并实现一个完整的网格加密研究，以定量地验证您的离散格式是否达到了理论预测的精度。", "problem": "考虑一个在二维空间上的常系数线性椭圆算子，其对称形式为 $a\\,\\partial_{xx} + 2 b\\,\\partial_{xy} + c\\,\\partial_{yy}$，作用于一个定义在周期性单位正方形 $[0,1]\\times[0,1]$ 上的足够光滑的标量场 $u(x,y)$。目标是通过精确解方法（Method of Manufactured Solutions, MMS）来验证混合导数项在均匀笛卡尔网格上的二阶有限差分格式的观测精度阶。所有三角函数参数均以弧度为单位。\n\n您的任务是：\n\n- 从网格点周围的 $x$ 和 $y$ 的泰勒级数展开以及偏导数和混合偏导数的定义出发，推导在间距为 $h_x$ 和 $h_y$ 的均匀网格上，算子 $\\partial_{xx}$、$\\partial_{yy}$ 和 $\\partial_{xy}$ 各自的形式上二阶精确的中心有限差分近似。\n\n- 构造一个形式为\n  $$\n  u(x,y) \\;=\\; \\sin(k_x x)\\,\\sin(k_y y) \\;+\\; \\gamma\\,\\sin\\!\\big(k_m(x+y)\\big),\n  $$\n  的精确解，其中 $k_x$、$k_y$ 和 $k_m$ 是空间频率，$\\gamma$ 是一个标量振幅。利用链式法则和微分的线性性质，推导出精确源项 $f(x,y)$，使得偏微分方程\n  $$\n  a\\,u_{xx}(x,y) \\;+\\; 2 b\\,u_{xy}(x,y) \\;+\\; c\\,u_{yy}(x,y) \\;=\\; f(x,y)\n  $$\n  在定义域 $[0,1]\\times[0,1]$ 上恒成立，并满足周期性边界条件。\n\n- 在一个覆盖 $[0,1]\\times[0,1]$ 的均匀 $N\\times N$ 网格上，实现所推导的算子 $a\\,\\partial_{xx} + 2 b\\,\\partial_{xy} + c\\,\\partial_{yy}$ 的二阶精确有限差分格式，并在网格大小为 $N\\in\\{16,32,64,128\\}$ 的网格上，计算应用于精确解 $u(x,y)$ 上的离散算子。对于每个 $N$，计算由下式定义的残差（或相容性误差）的离散 $L^2$ 范数：\n  $$\n  E(N) \\;=\\; \\left(\\int_{0}^{1}\\!\\int_{0}^{1} \\big( \\mathcal{L}_h[u](x,y) - f(x,y) \\big)^2 \\,\\mathrm{d}x\\,\\mathrm{d}y \\right)^{1/2},\n  $$\n  其中 $\\mathcal{L}_h$ 表示您的离散算子，该积分通过网格上的一致求积法则进行近似。使用周期性索引来施加边界条件。\n\n- 通过对四个网格层级的数据 $\\{(\\log h, \\log E(N))\\}$（其中 $h = 1/N$）进行最小二乘法直线拟合，估算观测到的精度阶 $p$。报告下面每个测试案例的 $p$ 值。\n\n测试套件规格：使用以下四组参数集，其中 $k_x = 2\\pi \\times \\kappa_x$，$k_y = 2\\pi \\times \\kappa_y$，$k_m = 2\\pi \\times \\kappa_m$，并使用整数倍数以保持周期性：\n\n- 案例 1（存在混合项，各向异性主部）：$a = 1$，$b = 0.3$，$c = 2$，$\\kappa_x = 3$，$\\kappa_y = 2$，$\\gamma = 0.5$，$\\kappa_m = 1$。\n\n- 案例 2（无混合项）：$a = 1$，$b = 0$，$c = 1$，$\\kappa_x = 2$，$\\kappa_y = 1$，$\\gamma = 0.25$，$\\kappa_m = 3$。\n\n- 案例 3（椭圆性内的强混合耦合）：$a = 1$，$b = 0.49$，$c = 1$，$\\kappa_x = 4$，$\\kappa_y = 3$，$\\gamma = 1$，$\\kappa_m = 2$。\n\n- 案例 4（具有显著混合项的各向异性系数）：$a = 3$，$b = 0.9$，$c = 5$，$\\kappa_x = 5$，$\\kappa_y = 4$，$\\gamma = 0.75$，$\\kappa_m = 1$。\n\n最终输出规格：\n\n- 对于四个案例中的每一个，使用网格大小 $N\\in\\{16,32,64,128\\}$ 计算观测精度阶 $p$ 的最小二乘估计。\n\n- 您的程序应生成单行输出，其中包含案例 1 到 4 的四个 $p$ 值，按顺序排列，每个值四舍五入到恰好 $3$ 位小数，格式为方括号内以逗号分隔的列表（例如，$[1.997,2.003,2.001,1.999]$）。\n\n此问题不涉及任何物理单位。三角函数中使用的角度单位为弧度。答案必须以指定的单行格式给出。", "solution": "该问题要求推导并实现一个通用线性椭圆算子的二阶精确有限差分格式，并使用精确解方法（MMS）来验证其精度阶。该过程详述如下。\n\n### 有限差分近似的推导\n\n我们在间距为 $h_x = h_y = h$ 的均匀笛卡尔网格上推导偏导数 $\\partial_{xx}$、$\\partial_{yy}$ 和 $\\partial_{xy}$ 的二阶精确中心有限差分近似。设 $u_{i,j} = u(x_i, y_j) = u(ih, jh)$。\n\n$u$ 在点 $(x_i, y_j)$ 周围沿 $x$ 方向的泰勒级数展开为：\n$$\nu_{i+1,j} = u(x_i+h, y_j) = u_{i,j} + h \\frac{\\partial u}{\\partial x} + \\frac{h^2}{2} \\frac{\\partial^2 u}{\\partial x^2} + \\frac{h^3}{6} \\frac{\\partial^3 u}{\\partial x^3} + \\frac{h^4}{24} \\frac{\\partial^4 u}{\\partial x^4} + O(h^5)\n$$\n$$\nu_{i-1,j} = u(x_i-h, y_j) = u_{i,j} - h \\frac{\\partial u}{\\partial x} + \\frac{h^2}{2} \\frac{\\partial^2 u}{\\partial x^2} - \\frac{h^3}{6} \\frac{\\partial^3 u}{\\partial x^3} + \\frac{h^4}{24} \\frac{\\partial^4 u}{\\partial x^4} - O(h^5)\n$$\n将这两个方程相加可以消去奇数阶导数项：\n$$\nu_{i+1,j} + u_{i-1,j} = 2u_{i,j} + h^2 \\frac{\\partial^2 u}{\\partial x^2} + \\frac{h^4}{12} \\frac{\\partial^4 u}{\\partial x^4} + O(h^6)\n$$\n解出 $\\frac{\\partial^2 u}{\\partial x^2}$，得到中心差分近似：\n$$\n\\frac{\\partial^2 u}{\\partial x^2} \\bigg|_{i,j} = \\frac{u_{i+1,j} - 2u_{i,j} + u_{i-1,j}}{h^2} - \\frac{h^2}{12} \\frac{\\partial^4 u}{\\partial x^4} + O(h^4)\n$$\n该近似是二阶精确的，截断误差为 $O(h^2)$。根据对称性，$\\frac{\\partial^2 u}{\\partial y^2}$ 的近似为：\n$$\n\\frac{\\partial^2 u}{\\partial y^2} \\bigg|_{i,j} = \\frac{u_{i,j+1} - 2u_{i,j} + u_{i,j-1}}{h^2} + O(h^2)\n$$\n对于混合偏导数 $\\frac{\\partial^2 u}{\\partial x \\partial y}$，我们可以组合一阶导数的二阶中心差分算子。$\\partial_x$ 和 $\\partial_y$ 的中心差分算子为：\n$$\nD_{2x}[u]_{i,j} = \\frac{u_{i+1,j} - u_{i-1,j}}{2h} = \\frac{\\partial u}{\\partial x} + O(h^2)\n$$\n$$\nD_{2y}[u]_{i,j} = \\frac{u_{i,j+1} - u_{i,j-1}}{2h} = \\frac{\\partial u}{\\partial y} + O(h^2)\n$$\n依次应用这些算子，我们得到 $\\frac{\\partial^2 u}{\\partial x \\partial y}$ 的一个近似：\n$$\n\\frac{\\partial^2 u}{\\partial x \\partial y} \\bigg|_{i,j} \\approx D_{2x}[D_{2y}[u]]_{i,j} = D_{2x}\\left[\\frac{u_{i,j+1} - u_{i,j-1}}{2h}\\right] = \\frac{D_{2x}[u]_{i,j+1} - D_{2x}[u]_{i,j-1}}{2h}\n$$\n$$\n= \\frac{1}{4h^2} \\left( (u_{i+1,j+1} - u_{i-1,j+1}) - (u_{i+1,j-1} - u_{i-1,j-1}) \\right)\n$$\n$$\n= \\frac{u_{i+1,j+1} - u_{i-1,j+1} - u_{i+1,j-1} + u_{i-1,j-1}}{4h^2}\n$$\n泰勒级数分析表明，此近似的截断误差中的主导项为 $\\frac{h^2}{6}\\left(\\frac{\\partial^4 u}{\\partial x^3 \\partial y} + \\frac{\\partial^4 u}{\\partial x \\partial y^3}\\right)$，因此该格式是形式上二阶精确的。\n\n### 精确解与源项\n\n给定的精确解为：\n$$\nu(x,y) = \\sin(k_x x)\\,\\sin(k_y y) + \\gamma\\,\\sin(k_m(x+y))\n$$\n为了找到使该函数成为偏微分方程 $a\\,u_{xx} + 2 b\\,u_{xy} + c\\,u_{yy} = f(x,y)$ 精确解的源项 $f(x,y)$，我们计算 $u(x,y)$ 的解析偏导数：\n$$\nu_{xx}(x,y) = -k_x^2 \\sin(k_x x)\\sin(k_y y) - \\gamma k_m^2 \\sin(k_m(x+y))\n$$\n$$\nu_{yy}(x,y) = -k_y^2 \\sin(k_x x)\\sin(k_y y) - \\gamma k_m^2 \\sin(k_m(x+y))\n$$\n$$\nu_{xy}(x,y) = k_x k_y \\cos(k_x x)\\cos(k_y y) - \\gamma k_m^2 \\sin(k_m(x+y))\n$$\n将这些表达式代入偏微分方程，得到源项 $f(x,y)$：\n$$\nf(x,y) = a u_{xx} + 2b u_{xy} + c u_{yy}\n$$\n$$\n= a \\left( -k_x^2 S_k - \\gamma k_m^2 S_m \\right) + 2b \\left( k_x k_y C_k - \\gamma k_m^2 S_m \\right) + c \\left( -k_y^2 S_k - \\gamma k_m^2 S_m \\right)\n$$\n其中 $S_k = \\sin(k_x x)\\sin(k_y y)$，$C_k = \\cos(k_x x)\\cos(k_y y)$，$S_m = \\sin(k_m(x+y))$。\n整理各项，我们得到源项的最终表达式：\n$$\nf(x,y) = -(a k_x^2 + c k_y^2) \\sin(k_x x)\\sin(k_y y) + 2b k_x k_y \\cos(k_x x)\\cos(k_y y) - \\gamma k_m^2 (a + 2b + c) \\sin(k_m(x+y))\n$$\n\n### 数值验证过程\n\n验证在域 $[0,1] \\times [0,1]$ 上的一个均匀 $N \\times N$ 网格上进行。网格点为 $(x_i, y_j) = (ih, jh)$，其中 $i,j = 0, \\ldots, N-1$，网格间距为 $h=1/N$。\n\n离散算子 $\\mathcal{L}_h$ 由推导出的有限差分公式构成：\n$$\n(\\mathcal{L}_h[u])_{i,j} = a \\frac{u_{i+1,j} - 2u_{i,j} + u_{i-1,j}}{h^2} + 2b \\frac{u_{i+1,j+1} - u_{i-1,j+1} - u_{i+1,j-1} + u_{i-1,j-1}}{4h^2} + c \\frac{u_{i,j+1} - 2u_{i,j} + u_{i,j-1}}{h^2}\n$$\n通过对所有网格索引取模 $N$ 来施加周期性边界条件。\n\n数值验证步骤如下：\n1. 对于每个网格分辨率 $N \\in \\{16, 32, 64, 128\\}$，在所有网格点上计算精确解 $u(x_i, y_j)$ 和精确源项 $f(x_i, y_j)$。\n2. 将离散算子 $\\mathcal{L}_h$ 应用于 $u$ 的网格值，得到 $(\\mathcal{L}_h[u])_{i,j}$。\n3. 在每个网格点上计算残差（或截断误差）：$R_{ij} = (\\mathcal{L}_h[u])_{i,j} - f(x_i, y_j)$。\n4. 计算残差的离散 $L^2$ 范数，它通过均匀求積法则（每个单元上的中点法则）来近似积分 $\\left(\\int_0^1\\int_0^1 R(x,y)^2 dx dy\\right)^{1/2}$：\n$$\nE(N) = \\left( \\sum_{i=0}^{N-1} \\sum_{j=0}^{N-1} R_{ij}^2 h^2 \\right)^{1/2} = h \\sqrt{\\sum_{i=0}^{N-1} \\sum_{j=0}^{N-1} R_{ij}^2}\n$$\n对于一个精度阶为 $p$ 的方法，误差预计表现为 $E(N) \\approx C h^p = C (1/N)^p$，其中 $C$ 是一个常数。取对数后得到线性关系：\n$$\n\\log(E(N)) \\approx p \\log(h) + \\log(C)\n$$\n观测到的精度阶 $p$ 被估算为使用最小二乘法对四个网格分辨率的数据点 $\\{(\\log h, \\log E(N))\\}$ 进行直线拟合的斜率。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem of verifying the order of accuracy of a finite difference\n    scheme for a 2D linear elliptic PDE using the Method of Manufactured Solutions.\n    \"\"\"\n    test_cases = [\n        # Case 1 (mixed term present, anisotropic principal part)\n        {'a': 1, 'b': 0.3, 'c': 2, 'kappa_x': 3, 'kappa_y': 2, 'gamma': 0.5, 'kappa_m': 1},\n        # Case 2 (no mixed term)\n        {'a': 1, 'b': 0, 'c': 1, 'kappa_x': 2, 'kappa_y': 1, 'gamma': 0.25, 'kappa_m': 3},\n        # Case 3 (strong mixed coupling within ellipticity)\n        {'a': 1, 'b': 0.49, 'c': 1, 'kappa_x': 4, 'kappa_y': 3, 'gamma': 1, 'kappa_m': 2},\n        # Case 4 (anisotropic coefficients with significant mixed term)\n        {'a': 3, 'b': 0.9, 'c': 5, 'kappa_x': 5, 'kappa_y': 4, 'gamma': 0.75, 'kappa_m': 1},\n    ]\n\n    grid_sizes = [16, 32, 64, 128]\n    estimated_orders = []\n\n    for case in test_cases:\n        a, b, c = case['a'], case['b'], case['c']\n        gamma = case['gamma']\n        \n        # Wavenumbers\n        k_x = 2 * np.pi * case['kappa_x']\n        k_y = 2 * np.pi * case['kappa_y']\n        k_m = 2 * np.pi * case['kappa_m']\n        \n        log_h_vals = []\n        log_E_vals = []\n\n        for N in grid_sizes:\n            h = 1.0 / N\n            \n            # Create grid\n            # Grid points are x_i = i*h, y_j = j*h for i,j=0..N-1\n            grid_coord = np.arange(N) * h\n            X, Y = np.meshgrid(grid_coord, grid_coord)\n            \n            # --- Evaluate manufactured solution and source term on the grid ---\n            # Manufactured solution u(x,y)\n            term1_u = np.sin(k_x * X) * np.sin(k_y * Y)\n            term2_u = gamma * np.sin(k_m * (X + Y))\n            U = term1_u + term2_u\n            \n            # Source term f(x,y)\n            term1_f = -(a * k_x**2 + c * k_y**2) * np.sin(k_x * X) * np.sin(k_y * Y)\n            term2_f = 2 * b * k_x * k_y * np.cos(k_x * X) * np.cos(k_y * Y)\n            term3_f = -gamma * k_m**2 * (a + 2*b + c) * np.sin(k_m * (X + Y))\n            F = term1_f + term2_f + term3_f\n\n            # --- Apply discrete operator L_h[u] ---\n            # Note: numpy's meshgrid output has Y on axis 0, X on axis 1.\n            # So, axis=0 corresponds to y-derivatives, axis=1 to x-derivatives.\n            h2 = h**2\n            \n            # Second derivative in x\n            U_xp1 = np.roll(U, -1, axis=1)\n            U_xm1 = np.roll(U, 1, axis=1)\n            discrete_uxx = (U_xp1 - 2*U + U_xm1) / h2\n            \n            # Second derivative in y\n            U_yp1 = np.roll(U, -1, axis=0)\n            U_ym1 = np.roll(U, 1, axis=0)\n            discrete_uyy = (U_yp1 - 2*U + U_ym1) / h2\n            \n            # Mixed partial derivative\n            # Stencil: (u(i+1,j+1) - u(i-1,j+1) - u(i+1,j-1) + u(i-1,j-1))/(4h^2)\n            U_xp1_yp1 = np.roll(U_xp1, -1, axis=0)\n            U_xm1_yp1 = np.roll(U_xm1, -1, axis=0)\n            U_xp1_ym1 = np.roll(U_xp1, 1, axis=0)\n            U_xm1_ym1 = np.roll(U_xm1, 1, axis=0)\n            \n            discrete_uxy = (U_xp1_yp1 - U_xm1_yp1 - U_xp1_ym1 + U_xm1_ym1) / (4 * h2)\n            \n            Lh_U = a * discrete_uxx + 2 * b * discrete_uxy + c * discrete_uyy\n            \n            # --- Compute residual and L2-norm of error ---\n            R = Lh_U - F\n            \n            # E(N) = (h^2 * sum(R_ij^2))^(1/2) = h * norm(R_ij)\n            E = h * np.linalg.norm(R)\n            \n            log_h_vals.append(np.log(h))\n            log_E_vals.append(np.log(E))\n\n        # --- Estimate order of accuracy using least squares ---\n        # Fit log(E) = p * log(h) + const\n        p, _ = np.polyfit(log_h_vals, log_E_vals, 1)\n        estimated_orders.append(p)\n    \n    # Format and print the final result\n    formatted_results = [f\"{res:.3f}\" for res in estimated_orders]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```", "id": "3310638"}]}