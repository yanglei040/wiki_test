{"hands_on_practices": [{"introduction": "在计算流体动力学 (CFD) 软件开发中，验证状态方程的实现是一项基本任务。本练习将从第一性原理出发，推导完全气体状态方程的无量纲形式——这是求解器中用于归纳结果的常见做法。随后，我们将创建一个数值测试，以确保模拟中的热力学变量在不同工况下保持一致性 ([@problem_id:3351066])。这项实践旨在提供代码验证和无量纲化这一关键概念的实践经验。", "problem": "您正在验证一个计算流体动力学 (CFD) 求解器对理想气体状态方程的无量纲实现。该求解器使用参考密度 $\\rho_\\infty$、参考声速 $a_\\infty$ 和参考温度 $T_\\infty$ 对变量进行无量纲化，同时假设理想气体在比热比 $\\gamma$ 恒定的情况下成立。该求解器使用的无量纲变量定义为 $p^* = p / (\\rho_\\infty a_\\infty^2)$、$\\rho^* = \\rho / \\rho_\\infty$ 和 $T^* = T / T_\\infty$。您将要实现的测试应在若干给定的测试用例中，验证理想气体状态方程在所有计算单元上的无量纲一致性。\n\n从第一性原理和核心定义出发：\n- 理想气体状态方程为 $p = \\rho R T$，其中 $R$ 为比气体常数。\n- 声速定义为 $a^2 = \\gamma R T$，因此在参考状态下 $a_\\infty^2 = \\gamma R T_\\infty$。\n\n基于以上公式，推导出一个适用于对单元值数组进行程序化一致性检查的无量纲状态方程。然后，实现一个数值检查，该检查为每个测试用例计算其所有单元与该无量纲方程的最大绝对偏差，并返回一个布尔值，以指示该条件是否在指定的容差范围内成立。\n\n此任务中没有量纲单位，因为所有量根据其构造都是无量纲的。本问题不涉及角度和百分比。\n\n您的程序必须：\n- 使用推导出的无量纲状态方程，为每个单元 $i$ 计算残差 $r_i = p_i^* - (\\rho_i^* T_i^* / \\gamma)$。\n- 为每个测试用例计算最大绝对残差 $\\max_i |r_i|$。\n- 将此最大值与该测试用例给定的容差 $\\tau$ 进行比较，并返回一个布尔值，指示最大残差是否小于或等于该容差。\n\n测试套件（请严格使用以下数据）：\n1. $\\gamma = 1.4$ 下的正常路径一致性：\n   - $\\gamma = 1.4$\n   - $\\rho^* = \\{\\,0.9,\\,1.1,\\,0.7,\\,1.3\\,\\}$\n   - $T^* = \\{\\,0.8,\\,1.2,\\,3.5,\\,0.5\\,\\}$\n   - $p^*$ 设置为 $p^*_i = \\rho^*_i T^*_i / \\gamma + \\delta_i$，其中 $\\delta = \\{\\,10^{-12},\\,-5\\times 10^{-12},\\,2\\times 10^{-12},\\,-10^{-12}\\,\\}$\n   - 容差 $\\tau = 10^{-10}$\n2. $\\gamma = 1.4$ 下因单一较大扰动导致的明显失败：\n   - $\\gamma = 1.4$\n   - $\\rho^* = \\{\\,0.9,\\,1.1,\\,0.7,\\,1.3\\,\\}$\n   - $T^* = \\{\\,0.8,\\,1.2,\\,3.5,\\,0.5\\,\\}$\n   - 除一个单元增加了 $10^{-3}$ 的扰动外（将其应用于第三项），所有 $i$ 的 $p^*$ 均设置为 $p^*_i = \\rho^*_i T^*_i / \\gamma$\n   - 容差 $\\tau = 10^{-6}$\n3. $\\gamma = 1.4$ 下的近真空状态：\n   - $\\gamma = 1.4$\n   - $\\rho^* = \\{\\,10^{-9},\\,2\\times 10^{-9},\\,3\\times 10^{-9}\\,\\}$\n   - $T^* = \\{\\,3\\times 10^{-9},\\,4\\times 10^{-9},\\,5\\times 10^{-9}\\,\\}$\n   - $p^*$ 精确设置为 $p^*_i = \\rho^*_i T^*_i / \\gamma$\n   - 容差 $\\tau = 10^{-20}$\n4. $\\gamma = 5/3$ 的单原子气体一致性：\n   - $\\gamma = 5/3$\n   - $\\rho^* = \\{\\,0.2,\\,2.0,\\,4.0\\,\\}$\n   - $T^* = \\{\\,10.0,\\,0.5,\\,0.125\\,\\}$\n   - $p^*$ 精确设置为 $p^*_i = \\rho^*_i T^*_i / \\gamma$\n   - 容差 $\\tau = 10^{-12}$\n5. $\\gamma = 1.4$ 下存在细微违规的混合测试用例：\n   - $\\gamma = 1.4$\n   - $\\rho^* = \\{\\,1.0,\\,0.5,\\,2.0,\\,0.25,\\,3.0\\,\\}$\n   - $T^* = \\{\\,1.0,\\,2.0,\\,0.5,\\,4.0,\\,0.3333333333333333\\,\\}$\n   - 除最后一项增加了 $5\\times 10^{-9}$ 外，所有 $i$ 的 $p^*$ 均设置为 $p^*_i = \\rho^*_i T^*_i / \\gamma$\n   - 容差 $\\tau = 10^{-10}$\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含一个布尔值列表，每个布尔值对应一个测试用例，顺序为测试用例 1 到 5。输出必须是用方括号括起来的逗号分隔列表，例如 $\\texttt{[True,False,True,True,False]}$。", "solution": "目标是验证计算流体动力学 (CFD) 求解器中实现的理想气体状态方程的无量纲公式。此验证通过从第一性原理推导正确的无量纲关系，然后针对一套测试用例实施数值检查来执行。\n\n分析从提供的基本有量纲方程开始：\n1.  理想气体状态方程：\n    $$p = \\rho R T$$\n    其中 $p$ 是压力，$\\rho$ 是密度， $T$ 是绝对温度， $R$ 是比气体常数。\n2.  理想气体中声速的定义：\n    $$a^2 = \\gamma R T$$\n    其中 $a$ 是声速，$\\gamma$ 是恒定的比热比。\n\n问题指定状态变量使用一组由下标 $\\infty$ 表示的恒定参考值进行无量纲化。无量纲变量（由上标 $*$ 表示）定义如下：\n$$p^* = \\frac{p}{\\rho_\\infty a_\\infty^2}$$\n$$\\rho^* = \\frac{\\rho}{\\rho_\\infty}$$\n$$T^* = \\frac{T}{T_\\infty}$$\n\n在参考状态下，声速由下式给出：\n$$a_\\infty^2 = \\gamma R T_\\infty$$\n\n为了推导无量纲状态方程，我们首先用其无量纲对应量来表示有量纲变量：\n$$p = p^* \\rho_\\infty a_\\infty^2$$\n$$\\rho = \\rho^* \\rho_\\infty$$\n$$T = T^* T_\\infty$$\n\n将这些表达式代入有量纲状态方程 $p = \\rho R T$ 中，得到：\n$$(p^* \\rho_\\infty a_\\infty^2) = (\\rho^* \\rho_\\infty) R (T^* T_\\infty)$$\n\n参考密度 $\\rho_\\infty$ 是一个非零常数，可以从方程两边消去：\n$$p^* a_\\infty^2 = \\rho^* R T^* T_\\infty$$\n\n接下来，我们代入参考声速的平方表达式 $a_\\infty^2 = \\gamma R T_\\infty$：\n$$p^* (\\gamma R T_\\infty) = \\rho^* R T^* T_\\infty$$\n\n项 $R$ 和 $T_\\infty$ 是非零常数，可以从两边消去，从而得到一个非常简洁的关系式：\n$$p^* \\gamma = \\rho^* T^*$$\n\n重新整理此方程，将无量纲压力 $p^*$ 表示为无量纲密度 $\\rho^*$ 和温度 $T^*$ 的函数，便得到无量纲理想气体状态方程的最终形式：\n$$p^* = \\frac{\\rho^* T^*}{\\gamma}$$\n\n在理想气体假设下，对于一个正确实现的 CFD 求解器，此关系必须成立。验证过程涉及检查由索引 $i$ 标记的一组计算单元的给定 $(p_i^*, \\rho_i^*, T_i^*)$ 值集合的一致性。\n\n对于每个单元 $i$，我们计算一个残差 $r_i$，定义为给定的无量纲压力 $p_i^*$ 与由推导出的无量纲状态方程预测的值之间的差：\n$$r_i = p_i^* - \\frac{\\rho_i^* T_i^*}{\\gamma}$$\n这个定义与问题陈述中提供的定义相符。\n\n一个测试用例的总体一致性通过找出所有单元中的最大绝对残差来量化：\n$$r_{\\max} = \\max_i |r_i|$$\n\n如果此最大残差在指定的数值容差 $\\tau$ 范围内，则该测试用例被视为通过，表明求解器的状态与无量纲状态方程一致。通过测试的条件是：\n$$r_{\\max} \\le \\tau$$\n\n这个过程构成了一个严格的、定量的验证测试，是科学计算中软件质量保证的关键组成部分。以下程序为所提供的测试套件实现了此过程。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Validates the nondimensional perfect-gas equation of state for a set of test cases.\n    \"\"\"\n\n    # Test Suite (use exactly the following data):\n    test_cases = [\n        # Case 1: Happy-path consistency under gamma = 1.4\n        {\n            \"gamma\": 1.4,\n            \"rho_star\": np.array([0.9, 1.1, 0.7, 1.3]),\n            \"T_star\": np.array([0.8, 1.2, 3.5, 0.5]),\n            \"p_star_setup\": {\n                \"type\": \"relative\",\n                \"delta\": np.array([1e-12, -5e-12, 2e-12, -1e-12])\n            },\n            \"tolerance\": 1e-10\n        },\n        # Case 2: Clear failure with a single large perturbation under gamma = 1.4\n        {\n            \"gamma\": 1.4,\n            \"rho_star\": np.array([0.9, 1.1, 0.7, 1.3]),\n            \"T_star\": np.array([0.8, 1.2, 3.5, 0.5]),\n            \"p_star_setup\": {\n                \"type\": \"perturb\",\n                \"index\": 2,  # 0-based index for the third entry\n                \"perturbation\": 1e-3\n            },\n            \"tolerance\": 1e-6\n        },\n        # Case 3: Near-vacuum regime under gamma = 1.4\n        {\n            \"gamma\": 1.4,\n            \"rho_star\": np.array([1e-9, 2e-9, 3e-9]),\n            \"T_star\": np.array([3e-9, 4e-9, 5e-9]),\n            \"p_star_setup\": {\"type\": \"exact\"},\n            \"tolerance\": 1e-20\n        },\n        # Case 4: Monatomic gas consistency with gamma = 5/3\n        {\n            \"gamma\": 5.0 / 3.0,\n            \"rho_star\": np.array([0.2, 2.0, 4.0]),\n            \"T_star\": np.array([10.0, 0.5, 0.125]),\n            \"p_star_setup\": {\"type\": \"exact\"},\n            \"tolerance\": 1e-12\n        },\n        # Case 5: Mixed-pass case with subtle violation under gamma = 1.4\n        {\n            \"gamma\": 1.4,\n            \"rho_star\": nparray([1.0, 0.5, 2.0, 0.25, 3.0]),\n            \"T_star\": np.array([1.0, 2.0, 0.5, 4.0, 1.0/3.0]),\n            \"p_star_setup\": {\n                \"type\": \"perturb\",\n                \"index\": -1, # Last entry\n                \"perturbation\": 5e-9\n            },\n            \"tolerance\": 1e-10\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        gamma = case[\"gamma\"]\n        rho_star = case[\"rho_star\"]\n        T_star = case[\"T_star\"]\n        tolerance = case[\"tolerance\"]\n        \n        # Calculate the ideal nondimensional pressure\n        p_star_ideal = rho_star * T_star / gamma\n        \n        # Construct the given p_star based on the setup\n        setup = case[\"p_star_setup\"]\n        if setup[\"type\"] == \"exact\":\n            p_star = p_star_ideal\n        elif setup[\"type\"] == \"relative\":\n            p_star = p_star_ideal + setup[\"delta\"]\n        elif setup[\"type\"] == \"perturb\":\n            p_star = np.copy(p_star_ideal)\n            p_star[setup[\"index\"]] += setup[\"perturbation\"]\n        \n        # Compute the residual for each cell\n        # r_i = p_i^* - (rho_i^* * T_i^* / gamma)\n        residuals = p_star - p_star_ideal\n        \n        # Compute the maximum absolute residual\n        max_abs_residual = np.max(np.abs(residuals))\n        \n        # Compare with tolerance and record the boolean result\n        is_consistent = max_abs_residual = tolerance\n        results.append(is_consistent)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3351066"}, {"introduction": "“量热完全气体”模型虽然功能强大，但它假设比热容为常数，这是一种理想化处理。本练习将探讨这一假设的局限性，将其预测结果与一个更真实的、比热容随温度变化的物理模型进行比较。通过量化在喷管流动问题中由此产生的温度、压力和声速偏差 ([@problem_id:3351072])，您将更深刻地理解模型保真度的重要性，并学会评估何时可以使用简化模型，以及何时必须采用更复杂的热力学描述。", "problem": "要求您设计一个程序，用于量化在等熵喷管膨胀过程中，对于一个量热非完美但力学和热学完美的理想气体，假设定压比热和比热比恒定与使用随温度变化的比热函数所引起的偏差。该气体为干燥空气，被建模为组分恒定、质量比气体常数恒定的单组分完美气体。该程序应比较在指定出口马赫数下，使用两种模型预测的喷管出口处的静温、静压和当地声速：(i) 恒定物性模型，使用在滞止温度下固定的定压比热和比热比；(ii) 随温度变化的物性模型，使用通过指定多项式随温度变化的定压比热和定容比热。仅从基本定律和核心定义出发，不依赖简化公式。所有计算均使用质量比量。\n\n假设和基本定义：\n- 气体遵循完美气体状态方程 $p = \\rho R T$，其中 $p$ 是压力，$\\rho$ 是密度，$R$ 是质量比气体常数，$T$ 是温度。使用 $R = 287.058 \\, \\mathrm{J\\,kg^{-1}\\,K^{-1}}$ 并视 $R$ 为常数。\n- 定压比热 $c_p(T)$ 随温度变化，其关系由一个以参考温度为中心进行标定的多项式给出。使用\n$$\nc_p(T) = a_0 + a_1 \\left(T - T_{\\mathrm{ref}}\\right) + a_2 \\left(T - T_{\\mathrm{ref}}\\right)^2,\n$$\n其中 $T_{\\mathrm{ref}} = 300 \\, \\mathrm{K}$，$a_0 = 1005.0 \\, \\mathrm{J\\,kg^{-1}\\,K^{-1}}$，$a_1 = 0.1 \\, \\mathrm{J\\,kg^{-1}\\,K^{-2}}$，以及 $a_2 = 1\\times 10^{-4} \\, \\mathrm{J\\,kg^{-1}\\,K^{-3}}$。选择这些系数是为了在测试套件的温度范围内具有科学合理性，并使 $c_p$ 随温度升高而增加。定容比热为 $c_v(T) = c_p(T) - R$，比热比为 $\\gamma(T) = c_p(T)/c_v(T)$。\n- 等熵膨胀是绝热且可逆的，无彻体力、轴功或热传递，因此滞止焓沿流线守恒，熵恒定，意味着 $h_0 = h + u^2/2$ 和 $\\mathrm{d}s = 0$，其中 $h$ 是比焓，$u$ 是流速，$s$ 是比熵。\n- 当地声速 $a$ 由热力学恒等式 $a^2 = (\\frac{\\partial p}{\\partial \\rho})_s$ 定义，对于理想气体在等熵条件下，这导致 $a(T) = \\sqrt{\\gamma(T) R T}$。\n\n您的任务：\n- 对于每个测试案例，使用以下两种模型计算在给定的出口马赫数 $M$、滞止温度 $T_0$ 和滞止压力 $p_0$ 下，喷管出口处的静温 $T$、静压 $p$ 和当地声速 $a$：\n  1. 恒定物性模型：将 $c_p$ 和 $\\gamma$ 固定在 $T_0$ 时的值（即 $c_{p,\\mathrm{const}} = c_p(T_0)$ 和 $\\gamma_{\\mathrm{const}} = \\gamma(T_0)$）。使用能量守恒和等熵条件，利用这些常数来确定 $T$、$p$ 和 $a$。\n  2. 随温度变化的物性模型：在能量和等熵条件中使用作为 $T$ 的函数的 $c_p(T)$ 和 $c_v(T)$。求解由 $h_0 - h(T) = u^2/2$（其中 $u = M a(T)$ 和 $a(T) = \\sqrt{\\gamma(T) R T}$）所隐含的非线性温度方程，并从由 $\\mathrm{d}s = 0$ 推导出的等熵条件计算 $p$。\n- 将偏差量化为相对差异，定义为 $\\Delta T = \\left(T_{\\mathrm{const}} - T_{\\mathrm{var}}\\right) / T_{\\mathrm{var}}$，$\\Delta p = \\left(p_{\\mathrm{const}} - p_{\\mathrm{var}}\\right) / p_{\\mathrm{var}}$，以及 $\\Delta a = \\left(a_{\\mathrm{const}} - a_{\\mathrm{var}}\\right) / a_{\\mathrm{var}}$，其中下标“const”指恒定物性模型，“var”指随温度变化的物性模型。\n\n实现指南：\n- 通过 $h_0 - h(T) = \\int_{T}^{T_0} c_p(\\tau)\\,\\mathrm{d}\\tau$ 使用数值积分计算焓差。\n- 使用对于具有随温度变化的 $c_p(T)$ 的完美气体所表达的等熵条件 $\\mathrm{d}s = 0$，即 $\\mathrm{d}s = c_p(T)\\,\\mathrm{d}T/T - R\\,\\mathrm{d}p/p = 0$，然后积分以获得相对于 $p_0$ 的 $p(T)$。对积分 $\\int c_p(T)/(R\\,T)\\, \\mathrm{d}T$ 使用数值积分。\n- 使用稳健的求根方法来求解随温度变化的物性模型的非线性温度方程。\n- 对于恒定物性模型，应用相同的基本定律，但保持 $c_p$ 和 $\\gamma$ 在 $T_0$ 处的值恒定。从 $a(T) = \\sqrt{\\gamma R T}$ 计算声速。\n\n单位和输出：\n- 内部计算时，温度以 $\\mathrm{K}$ 表示，压力以 $\\mathrm{Pa}$ 表示，速度以 $\\mathrm{m/s}$ 表示，但程序的最终输出应包含如上定义的无量纲相对偏差。\n- 最终输出应为单行文本，包含所有测试案例结果的列表，该列表为用方括号括起来的逗号分隔列表。每个测试案例的结果是一个包含三个浮点数的内部列表 $\\left[\\Delta T, \\Delta p, \\Delta a\\right]$，例如 $\\left[[\\delta_{T,1}, \\delta_{p,1}, \\delta_{a,1}], [\\delta_{T,2}, \\delta_{p,2}, \\delta_{a,2}]\\right]$。\n\n覆盖不同工况的测试套件：\n- 案例1：$T_0 = 1000 \\, \\mathrm{K}$，$p_0 = 200000 \\, \\mathrm{Pa}$，$M = 2.0$。\n- 案例2：$T_0 = 300 \\, \\mathrm{K}$，$p_0 = 101325 \\, \\mathrm{Pa}$，$M = 0.05$。\n- 案例3：$T_0 = 1500 \\, \\mathrm{K}$，$p_0 = 500000 \\, \\mathrm{Pa}$，$M = 5.0$。\n- 案例4：$T_0 = 600 \\, \\mathrm{K}$，$p_0 = 300000 \\, \\mathrm{Pa}$，$M = 1.0$。\n\n您的程序应生成单行输出，包含一个用方括号括起来的逗号分隔列表形式的结果（例如 $\\left[\\mathrm{result}_1,\\mathrm{result}_2,\\mathrm{result}_3,\\mathrm{result}_4\\right]$），其中每个 $\\mathrm{result}_i$ 是第 $i$ 个测试案例的内部列表 $\\left[\\Delta T, \\Delta p, \\Delta a\\right]$。", "solution": "用户要求编写一个程序，用于量化等熵喷管流动中恒定物性气体模型与随温度变化的物性模型之间的偏差。在构建程序之前，对问题陈述进行验证。\n\n### 问题验证\n\n**第1步：提取已知条件**\n- **状态方程**：完美气体，$p = \\rho R T$。\n- **气体常数**：$R = 287.058 \\, \\mathrm{J\\,kg^{-1}\\,K^{-1}}$。\n- **比热 ($c_p$) 多项式**：$c_p(T) = a_0 + a_1 (T - T_{\\mathrm{ref}}) + a_2 (T - T_{\\mathrm{ref}})^2$，其中 $T_{\\mathrm{ref}} = 300 \\, \\mathrm{K}$，$a_0 = 1005.0 \\, \\mathrm{J\\,kg^{-1}\\,K^{-1}}$，$a_1 = 0.1 \\, \\mathrm{J\\,kg^{-1}\\,K^{-2}}$，$a_2 = 1\\times 10^{-4} \\, \\mathrm{J\\,kg^{-1}\\,K^{-3}}$。\n- **相关物性**：$c_v(T) = c_p(T) - R$，$\\gamma(T) = c_p(T)/c_v(T)$。\n- **流动条件**：等熵膨胀 ($ds=0$)，意味着滞止焓守恒 ($h_0 = h + u^2/2$)。\n- **声速**：$a(T) = \\sqrt{\\gamma(T) R T}$。\n- **模型**：\n  1. 恒定物性：$c_p$ 和 $\\gamma$ 固定为其在滞止温度 $T_0$ 下的值。\n  2. 随温度变化的物性：$c_p(T)$ 和 $\\gamma(T)$ 是当地静温 $T$ 的函数。\n- **任务**：对于给定的 $(T_0, p_0, M)$，计算两种模型的出口静温 $T$、静压 $p$ 和声速 $a$。\n- **输出**：相对差异 $\\Delta T = (T_{\\mathrm{const}} - T_{\\mathrm{var}}) / T_{\\mathrm{var}}$，$\\Delta p = (p_{\\mathrm{const}} - p_{\\mathrm{var}}) / p_{\\mathrm{var}}$，$\\Delta a = (a_{\\mathrm{const}} - a_{\\mathrm{var}}) / a_{\\mathrm{var}}$。\n- **测试案例**：\n  1. ($T_0=1000\\,\\mathrm{K}, p_0=200000\\,\\mathrm{Pa}, M=2.0$)\n  2. ($T_0=300\\,\\mathrm{K}, p_0=101325\\,\\mathrm{Pa}, M=0.05$)\n  3. ($T_0=1500\\,\\mathrm{K}, p_0=500000\\,\\mathrm{Pa}, M=5.0$)\n  4. ($T_0=600\\,\\mathrm{K}, p_0=300000\\,\\mathrm{Pa}, M=1.0$)\n\n**第2步：使用提取的已知条件进行验证**\n- **科学依据**：该问题在经典热力学和气体动力学中有坚实的基础。使用量热非完美气体模型是更简单的完美气体模型的一个标准且物理上精确的扩展。控制方程（$p=\\rho R T$, $h_0 = h+u^2/2$, $ds=0$）是基本原理。$c_p(T)$ 的多项式及其系数对于高温下的空气是物理上现实的。\n- **适定性**：问题是适定的。对于一维等熵流，滞止条件 ($T_0, p_0$) 和出口马赫数 ($M$) 的组合提供了足够的信息来唯一确定出口的热力学状态。可以证明，可变物性模型中的非线性温度方程有唯一的、物理上有意义的解。\n- **客观性**：问题以精确、客观和定量的术语陈述，没有歧义或主观声明。\n- **完整性与一致性**：问题是自洽且内部一致的。所有必要的数据、常数和控制定律都已明确提供。\n- **其他标准**：问题不是无关紧要、同义反复或结构不良的。它代表了一个有意义的工程和物理问题。\n\n**第3步：结论与行动**\n问题是有效的。将基于所提供的原则开发一个解决方案。\n\n### 控制方程的推导\n\n解决方案需要使用两种不同的气体物性模型来求解喷管出口状态。两种模型都源于相同的基本定律。\n\n**1. 基本关系**\n对于完美气体从滞止状态 ($T_0, p_0$) 到出口状态 ($T, p, u, M$) 的绝热、可逆（等熵）流动：\n- **能量守恒**：滞止焓恒定：$h_0 = h(T) + u^2/2$。焓差为 $h_0 - h(T) = \\int_{T}^{T_0} c_p(\\tau) d\\tau$。流速为 $u=Ma(T)$。声速为 $a(T)=\\sqrt{\\gamma(T)RT}$。将这些结合起来得到核心能量平衡方程：\n$$ \\int_{T}^{T_0} c_p(\\tau) \\,d\\tau = \\frac{1}{2} M^2 a(T)^2 = \\frac{1}{2} M^2 \\gamma(T) R T $$\n- **熵守恒**：熵恒定 ($ds=0$)。对于完美气体，$ds = c_p(T) \\frac{dT}{T} - R \\frac{dp}{p}$。从出口状态到滞止状态进行积分：\n$$ \\int_T^{T_0} c_p(\\tau) \\frac{d\\tau}{\\tau} - \\int_p^{p_0} R \\frac{dp'}{p'} = 0 \\implies R \\ln\\left(\\frac{p_0}{p}\\right) = \\int_T^{T_0} \\frac{c_p(\\tau)}{\\tau} d\\tau $$\n一旦 $T$ 已知，这就给出了压力 $p$：\n$$ p = p_0 \\exp\\left( -\\frac{1}{R} \\int_T^{T_0} \\frac{c_p(\\tau)}{\\tau} d\\tau \\right) $$\n\n**2. 恒定物性模型 (下标 \"const\")**\n这里，$c_p$ 和 $\\gamma$ 是在 $T_0$ 下计算的常数：$c_{p, \\mathrm{const}} = c_p(T_0)$ 和 $\\gamma_{\\mathrm{const}} = \\gamma(T_0)$。\n- **温度**：能量积分简化为 $c_{p,\\mathrm{const}}(T_0 - T)$。使用关系式 $c_p = \\frac{\\gamma R}{\\gamma-1}$，能量方程变为代数方程，并得出众所周知的等熵关系式：\n$$ \\frac{T_0}{T_{\\mathrm{const}}} = 1 + \\frac{\\gamma_{\\mathrm{const}}-1}{2} M^2 \\implies T_{\\mathrm{const}} = T_0 \\left(1 + \\frac{\\gamma_{\\mathrm{const}}-1}{2} M^2\\right)^{-1} $$\n- **压力**：熵积分简化为 $c_{p, \\mathrm{const}}\\ln(T_0/T)$。这给出了标准压力关系式：\n$$ \\frac{p_0}{p_{\\mathrm{const}}} = \\left(\\frac{T_0}{T_{\\mathrm{const}}}\\right)^{\\frac{c_{p,\\mathrm{const}}}{R}} = \\left(\\frac{T_0}{T_{\\mathrm{const}}}\\right)^{\\frac{\\gamma_{\\mathrm{const}}}{\\gamma_{\\mathrm{const}}-1}} \\implies p_{\\mathrm{const}} = p_0 \\left(1 + \\frac{\\gamma_{\\mathrm{const}}-1}{2} M^2\\right)^{-\\frac{\\gamma_{\\mathrm{const}}}{\\gamma_{\\mathrm{const}}-1}} $$\n- **声速**：在出口温度 $T_{\\mathrm{const}}$ 下使用常数 $\\gamma_{\\mathrm{const}}$ 进行计算：\n$$ a_{\\mathrm{const}} = \\sqrt{\\gamma_{\\mathrm{const}} R T_{\\mathrm{const}}} $$\n\n**3. 随温度变化的物性模型 (下标 \"var\")**\n这里，$c_p(T)$ 和 $\\gamma(T)$ 随温度变化。\n- **温度**：必须通过数值求解非线性能力方程来找到静温 $T_{\\mathrm{var}}$：\n$$ f(T) = \\int_T^{T_0} c_p(\\tau) \\,d\\tau - \\frac{1}{2} M^2 \\gamma(T) R T = 0 $$\n为了更高的精度，可以解析地计算该积分。设 $H(T)=\\int c_p(T)dT$。方程为 $H(T_0) - H(T_{\\mathrm{var}}) - \\frac{1}{2} M^2 \\gamma(T_{\\mathrm{var}}) R T_{\\mathrm{var}} = 0$。这需要一个数值求根算法。\n- **压力**：一旦找到 $T_{\\mathrm{var}}$，就从熵关系式计算 $p_{\\mathrm{var}}$，同样为了精度使用解析积分。设 $S(T) = \\int \\frac{c_p(T)}{T} dT$。则：\n$$ p_{\\mathrm{var}} = p_0 \\exp\\left( -\\frac{1}{R} (S(T_0) - S(T_{\\mathrm{var}})) \\right) $$\n- **声速**：在当地出口温度 $T_{\\mathrm{var}}$ 下使用该温度下的物性进行计算：\n$$ a_{\\mathrm{var}} = \\sqrt{\\gamma(T_{\\mathrm{var}}) R T_{\\mathrm{var}}} $$\n\n**4. 积分公式**\n给定 $c_p(T) = a_0 + a_1(T - T_{\\mathrm{ref}}) + a_2(T - T_{\\mathrm{ref}})^2$:\n- **$c_p(T)$ 的原函数**：$H(T) = \\int c_p(T)dT = a_0 T + \\frac{a_1}{2}(T-T_{\\mathrm{ref}})^2 + \\frac{a_2}{3}(T-T_{\\mathrm{ref}})^3$。\n- **$c_p(T)/T$ 的原函数**：$S(T) = \\int \\frac{c_p(T)}{T}dT = (a_1 - 2a_2 T_{\\mathrm{ref}})T + \\frac{a_2}{2}T^2 + (a_0 - a_1 T_{\\mathrm{ref}} + a_2 T_{\\mathrm{ref}}^2) \\ln(T)$。\n\n在实现中将使用这些解析形式来求解随温度变化的物性模型中的状态变量。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import root_scalar\n\ndef solve():\n    \"\"\"\n    Computes deviations between constant-property and temperature-dependent\n    gas models for isentropic nozzle expansion.\n    \"\"\"\n    # Define physical and gas property constants\n    R = 287.058  # J/kg/K, mass-specific gas constant for dry air\n    T_ref = 300.0  # K, reference temperature for c_p polynomial\n    a0 = 1005.0  # J/kg/K\n    a1 = 0.1  # J/kg/K^2\n    a2 = 1.0e-4  # J/kg/K^3\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (1000.0, 200000.0, 2.0), # T0 (K), p0 (Pa), M\n        (300.0, 101325.0, 0.05),\n        (1500.0, 500000.0, 5.0),\n        (600.0, 300000.0, 1.0),\n    ]\n\n    # --- Helper functions for gas properties ---\n\n    def get_cp(T):\n        \"\"\"Computes specific heat at constant pressure c_p(T).\"\"\"\n        return a0 + a1 * (T - T_ref) + a2 * (T - T_ref)**2\n\n    def get_gamma(T):\n        \"\"\"Computes ratio of specific heats gamma(T).\"\"\"\n        cp = get_cp(T)\n        cv = cp - R\n        return cp / cv\n\n    def enthalpy_antiderivative(T):\n        \"\"\"Analytic antiderivative of c_p(T), H(T) = integral(c_p(T) dT).\"\"\"\n        return a0 * T + (a1 / 2.0) * (T - T_ref)**2 + (a2 / 3.0) * (T - T_ref)**3\n\n    def entropy_integral_antiderivative(T):\n        \"\"\"Analytic antiderivative of c_p(T)/T, S(T) = integral(c_p(T)/T dT).\"\"\"\n        c0_s = a0 - a1 * T_ref + a2 * T_ref**2\n        c1_s = a1 - 2 * a2 * T_ref\n        c2_s = a2\n        return c1_s * T + (c2_s / 2.0) * T**2 + c0_s * np.log(T)\n\n    results = []\n    for T0, p0, M in test_cases:\n        # --- (i) Constant-Property Model Calculation ---\n        gamma_const = get_gamma(T0)\n        \n        temp_ratio_const = 1.0 + (gamma_const - 1.0) / 2.0 * M**2\n        \n        T_const = T0 / temp_ratio_const\n        \n        p_const = p0 / (temp_ratio_const)**(gamma_const / (gamma_const - 1.0))\n        \n        a_const = np.sqrt(gamma_const * R * T_const)\n        \n        # --- (ii) Temperature-Dependent Model Calculation ---\n        \n        # Define the function f(T) = 0 to be solved for T_var\n        H_T0 = enthalpy_antiderivative(T0)\n        def temp_root_func(T):\n            if T = 0: return np.inf # Avoid math domain errors\n            H_T = enthalpy_antiderivative(T)\n            enthalpy_diff = H_T0 - H_T\n            kinetic_energy = 0.5 * M**2 * get_gamma(T) * R * T\n            return enthalpy_diff - kinetic_energy\n\n        # Solve for T_var using a robust root-finding method\n        # Bracket [epsilon, T0] is safe as T_var must be = T0 for M > 0\n        sol = root_scalar(temp_root_func, bracket=[1e-3, T0], method='brentq')\n        T_var = sol.root\n\n        # Calculate p_var using the found T_var\n        S_T0 = entropy_integral_antiderivative(T0)\n        S_T_var = entropy_integral_antiderivative(T_var)\n        p_var = p0 * np.exp(-(S_T0 - S_T_var) / R)\n        \n        # Calculate a_var\n        gamma_var = get_gamma(T_var)\n        a_var = np.sqrt(gamma_var * R * T_var)\n\n        # --- Quantify Deviations ---\n        delta_T = (T_const - T_var) / T_var\n        delta_p = (p_const - p_var) / p_var\n        delta_a = (a_const - a_var) / a_var\n        \n        results.append([delta_T, delta_p, delta_a])\n\n    # Final print statement in the exact required format.\n    # The default string representation of a list of lists matches the required format.\n    print(f\"{results}\")\n\nsolve()\n```", "id": "3351072"}, {"introduction": "欧拉方程的精确解是验证和确认 CFD 代码的宝贵工具。这项高级练习要求您首先推导出一个等熵涡的解析解，然后以此为基准，对一个关键的数值算法进行压力测试：即从守恒变量恢复原始变量的过程。本练习 ([@problem_id:3351094]) 将揭示一个在近等温条件（$\\gamma \\to 1^+$）下已知的数值陷阱，从而展示物理气体模型与数值格式稳定性之间错综复杂的联系。", "problem": "考虑在计算流体动力学（CFD, Computational Fluid Dynamics）背景下的理想气体二维可压缩欧拉方程。设原始变量为密度 $\\rho$、速度分量 $u$ 和 $v$、压力 $p$ 以及温度 $T$。比热比为 $\\gamma > 1$，特定气体常数为 $R$，比热满足关系 $c_p - c_v = R$ 和 $\\gamma = c_p / c_v$。理想气体状态方程为 $p = \\rho R T$。比内能为 $e = p / ((\\gamma - 1)\\rho)$，比焓为 $h = e + p/\\rho = c_p T = \\gamma p / ((\\gamma - 1)\\rho)$。守恒变量为 $\\rho$、$\\rho u$、$\\rho v$ 和 $\\rho E$，其中 $E = e + \\tfrac{1}{2}(u^2 + v^2)$ 是比总能。\n\n您的任务是：\n\n1) 从第一性原理出发，为具有理想气体热力学的二维可压缩欧拉方程推导出一个精确、光滑且作为行波存在的等熵涡解。您必须从稳态、无粘动量方程和等熵假设（$\\nabla s = \\mathbf{0}$）出发，并结合理想气体热力学恒等式。使用稳态无粘流中被称为 Crocco 定理的恒等式 $\\nabla h = \\mathbf{v} \\times \\boldsymbol{\\omega}$，其中 $\\mathbf{v} = (u,v,0)$ 且 $\\boldsymbol{\\omega} = \\nabla \\times \\mathbf{v}$，并强制执行等熵关系 $p / \\rho^{\\gamma} = \\text{constant}$。构建一个叠加在均匀基流上的局域无散速度扰动场，该扰动场能产生非平凡的涡量分布，然后对得到的热力学梯度进行积分，以获得与理想气体状态方程和等熵约束一致的 $T(\\mathbf{x},t)$、$\\rho(\\mathbf{x},t)$ 和 $p(\\mathbf{x},t)$。通过在流场中处处保持温度和压力的正值来确保科学真实性。\n\n2) 使用您推导的等熵涡解，在近等温条件（$\\gamma \\to 1^+$）下，对守恒变量到原始变量的恢复过程实施一次压力测试。具体来说，对于您的精确解产生的每个状态，构建守恒变量 $\\rho$、$\\rho u$、$\\rho v$ 和 $\\rho E$，然后通过基于能量的守恒-原始变量映射恢复原始变量\n$$\nu = \\frac{\\rho u}{\\rho}, \\quad\nv = \\frac{\\rho v}{\\rho}, \\quad\np = (\\gamma - 1)\\left(\\rho E - \\tfrac{1}{2}\\,\\rho\\,(u^2 + v^2)\\right).\n$$\n将恢复的压力 $p$ 与您推导的解中的精确压力 $p_{\\text{exact}}$ 进行比较。\n\n您必须使用无量纲单位，其中 $R = 1$，$\\rho_{\\infty} = 1$，$p_{\\infty} = 1$，以及 $T_{\\infty} = p_{\\infty}/(\\rho_{\\infty} R) = 1$，这里的 $\\infty$ 表示远场均匀状态。考虑一个方形计算域 $[-L,L] \\times [-L,L]$，其中 $L = 3$，该域在一个 $N \\times N$ 点的均匀笛卡尔网格上进行离散，其中 $N = 81$。涡心初始位于 $(x_c,y_c) = (0,0)$，并以均匀基流速度 $(u_{\\infty}, v_{\\infty})$ 作为行波平流，因此在时间 $t$ 的涡心位置为 $(x_c + u_{\\infty} t, y_c + v_{\\infty} t)$。无散速度扰动必须是轴对称和局域化的，使其随离涡心半径的增加而指数衰减。\n\n您的程序必须：\n- 在指定时间计算网格上的精确涡场。\n- 从精确原始场构建守恒场。\n- 使用上述基于能量的映射从守恒场恢复原始场。\n- 对每个指定的测试用例，计算由下式定义的最大相对压力误差\n$$\n\\varepsilon_p = \\max_{\\text{grid}} \\frac{|p_{\\text{rec}} - p_{\\text{exact}}|}{\\max(p_{\\text{exact}},10^{-12})}.\n$$\n\n使用以下参数测试套件（均为无量纲）：\n- 测试 1 (正常路径)：$\\gamma = 1.4$，涡强度参数 $\\kappa = 5$，基流 $(u_{\\infty}, v_{\\infty}) = (0.5, 0.0)$，时间 $t = 1.0$。\n- 测试 2 (近等温)：$\\gamma = 1.01$，$\\kappa = 5$，$(u_{\\infty}, v_{\\infty}) = (0.5, 0.0)$，$t = 1.0$。\n- 测试 3 (极近等温)：$\\gamma = 1.001$，$\\kappa = 5$，$(u_{\\infty}, v_{\\infty}) = (0.5, 0.0)$，$t = 1.0$。\n- 测试 4 (边界情况，零环量)：$\\gamma = 1.001$，$\\kappa = 0$，$(u_{\\infty}, v_{\\infty}) = (0.5, 0.0)$，$t = 1.0$。\n\n所有变量都是无量纲的，因此除了所述的无量纲化处理外，不需要任何物理单位。您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，具体为列表 $[\\varepsilon_{p,1}, \\varepsilon_{p,2}, \\varepsilon_{p,3}, \\varepsilon_{p,4}]$，其中第 $i$ 个条目对应第 $i$ 个测试用例，每个条目都是一个浮点数。", "solution": "用户提供了一个计算流体动力学问题，要求推导二维可压缩欧拉方程的一个精确等熵涡解，然后对守恒变量到原始变量的恢复过程进行数值压力测试，特别是在近等温极限（即比热比 $\\gamma$ 趋近于 $1$）的情况下。\n\n该问题被认为是有效的，因为它基于流体动力学原理，具有科学依据，是适定的（提供了足够的信息以获得唯一解），并且是客观且可形式化的。该推导虽然复杂，但却是一个标准的练习，而数值测试则探究了一个已知的数值挑战。\n\n### 第 1 部分：等熵涡解的推导\n\n我们寻求一个叠加在均匀自由来流上的稳态、等熵、旋转的流动结构。当在实验室参考系中观察时，这种结构表现为行波。在随自由来流速度 $\\mathbf{v}_{\\infty} = (u_{\\infty}, v_{\\infty})$ 移动的参考系中进行推导最为方便。在此参考系中，自由来流是静止的，涡是一个稳态解。\n\n设此移动参考系中的速度为 $\\mathbf{v}'$。稳态、无粘、等熵的动量方程（欧拉方程）为：\n$$ (\\mathbf{v}' \\cdot \\nabla) \\mathbf{v}' = -\\frac{1}{\\rho} \\nabla p $$\n使用矢量恒等式 $(\\mathbf{v}' \\cdot \\nabla) \\mathbf{v}' = \\nabla(\\frac{1}{2}|\\mathbf{v}'|^2) - \\mathbf{v}' \\times (\\nabla \\times \\mathbf{v}')$ 和等熵流的热力学关系 $dh = dp/\\rho$（其中 $h$ 为比焓），动量方程变为：\n$$ \\nabla\\left(\\frac{1}{2}|\\mathbf{v}'|^2\\right) - \\mathbf{v}' \\times \\boldsymbol{\\omega}' = -\\nabla h $$\n其中 $\\boldsymbol{\\omega}' = \\nabla \\times \\mathbf{v}'$ 是移动参考系中的涡量。这可以重新整理为稳态等熵流的 Crocco 定理：\n$$ \\nabla\\left(h + \\frac{1}{2}|\\mathbf{v}'|^2\\right) = \\mathbf{v}' \\times \\boldsymbol{\\omega}' $$\n项 $h_0 = h + \\frac{1}{2}|\\mathbf{v}'|^2$ 是比总焓。该方程表明，总焓的梯度由速度场和涡量场决定。\n\n我们构建一个局域、轴对称、无散的速度扰动。设 $(x', y') = (x - u_\\infty t, y - v_\\infty t)$ 为移动参考系中的坐标，涡心位于原点 $(0,0)$。设 $r = \\sqrt{x'^2 + y'^2}$ 为距中心的径向距离。一个轴对称的切向速度扰动可以定义为：\n$$ \\mathbf{v}' = v'_{\\theta}(r) \\hat{\\boldsymbol{\\theta}} $$\n其中 $\\hat{\\boldsymbol{\\theta}}$ 是方位单位矢量。这给出了速度分量 $\\delta u = -v'_\\theta(r) \\frac{y'}{r}$ 和 $\\delta v = v'_\\theta(r) \\frac{x'}{r}$。我们为扰动选择一个指数衰减的特定函数形式，这与物理涡旋一致。一个能导向简单热力学结构的稳健选择是：\n$$ \\mathbf{v}' = \\left( \\delta u, \\delta v \\right) = \\left( \\frac{\\kappa}{2} y' e^{-r^2/2}, -\\frac{\\kappa}{2} x' e^{-r^2/2} \\right) $$\n这表示一个顺时针方向的涡，但方向不影响热力学解。问题中的“涡强度参数” $\\kappa$ 用于缩放速度扰动。该速度的大小为 $|\\mathbf{v}'(r)| = \\frac{\\kappa}{2} r e^{-r^2/2}$。\n\n涡量为 $\\boldsymbol{\\omega}' = \\nabla \\times \\mathbf{v}' = \\omega'_z \\hat{\\mathbf{k}}$，其中 $\\omega'_z = \\frac{\\partial(\\delta v)}{\\partial x'} - \\frac{\\partial(\\delta u)}{\\partial y'}$。对于所选的速度场，其计算结果为：\n$$ \\omega'_z(r) = \\frac{\\kappa}{2}(r^2-2)e^{-r^2/2} $$\n叉积 $\\mathbf{v}' \\times \\boldsymbol{\\omega}'$ 是纯径向的：$\\mathbf{v}' \\times \\boldsymbol{\\omega}' = -|\\mathbf{v}'|\\omega'_z \\hat{\\mathbf{r}}$。代入 $|\\mathbf{v}'|$ 和 $\\omega'_z$ 的表达式：\n$$ \\mathbf{v}' \\times \\boldsymbol{\\omega}' = -\\left(\\frac{\\kappa}{2} r e^{-r^2/2}\\right) \\left(\\frac{\\kappa}{2}(r^2-2)e^{-r^2/2}\\right) \\hat{\\mathbf{r}} = -\\left(\\frac{\\kappa}{2}\\right)^2 r(r^2-2)e^{-r^2} \\hat{\\mathbf{r}} $$\n根据 Crocco 定理，$\\nabla h_0 = \\frac{dh_0}{dr}\\hat{\\mathbf{r}}$，我们得到一个关于 $h_0(r)$ 的常微分方程：\n$$ \\frac{dh_0}{dr} = -\\left(\\frac{\\kappa}{2}\\right)^2 r(r^2-2)e^{-r^2} $$\n对 $r$ 积分得到：\n$$ h_0(r) = \\frac{\\kappa^2}{8}(r^2-1)e^{-r^2} + C $$\n积分常数 $C$ 由远场条件（$r \\to \\infty$）确定，在远场 $\\mathbf{v}' \\to 0$ 且 $h \\to h_\\infty$，因此 $h_0 \\to h_\\infty$。于是，$C = h_\\infty$。\n\n比焓 $h$ 通过减去动能贡献得到：\n$$ h(r) = h_0(r) - \\frac{1}{2}|\\mathbf{v}'|^2 = \\left(\\frac{\\kappa^2}{8}(r^2-1)e^{-r^2} + h_\\infty\\right) - \\frac{1}{2}\\left(\\frac{\\kappa}{2} r e^{-r^2/2}\\right)^2 $$\n$$ h(r) = \\frac{\\kappa^2}{8}(r^2-1)e^{-r^2} + h_\\infty - \\frac{\\kappa^2}{8} r^2 e^{-r^2} = h_\\infty - \\frac{\\kappa^2}{8}e^{-r^2} $$\n对于理想气体，$h = c_p T = \\frac{\\gamma R}{\\gamma-1}T$。使用无量纲值 $R=1$，$p_\\infty=1, \\rho_\\infty=1$，我们有 $T_\\infty=1$ 和 $h_\\infty = \\frac{\\gamma}{\\gamma-1}$。将这些代入 $h(r)$ 的表达式中：\n$$ \\frac{\\gamma}{\\gamma-1}T(r) = \\frac{\\gamma}{\\gamma-1} - \\frac{\\kappa^2}{8}e^{-r^2} \\implies T(r) = 1 - \\frac{(\\gamma-1)\\kappa^2}{8\\gamma}e^{-r^2} $$\n流动是等熵的，因此 $p/\\rho^\\gamma=\\text{const}$ 和 $T/\\rho^{\\gamma-1}=\\text{const}$。利用远场条件，这些常数都为 $1$。因此，我们可以从温度求出密度和压力：\n$$ \\rho(r) = T(r)^{1/(\\gamma-1)} \\quad \\text{and} \\quad p(r) = \\rho(r)^\\gamma = T(r)^{\\gamma/(\\gamma-1)} $$\n推导到此完成。最终解由以下公式给出：\n- 速度（切换到逆时针旋转和实验室参考系）：\n  $u(x,y,t) = u_\\infty - \\frac{\\kappa}{2} (y-y_c(t)) e^{-r^2/2}$\n  $v(x,y,t) = v_\\infty + \\frac{\\kappa}{2} (x-x_c(t)) e^{-r^2/2}$\n- 温度：$T(x,y,t) = 1 - \\frac{(\\gamma-1)\\kappa^2}{8\\gamma}e^{-r^2}$\n- 密度：$\\rho(x,y,t) = T^{1/(\\gamma-1)}$\n- 压力：$p(x,y,t) = \\rho^\\gamma$\n其中 $x_c(t) = u_\\infty t$，$y_c(t) = v_\\infty t$，且 $r^2 = (x-x_c(t))^2 + (y-y_c(t))^2$。此解是光滑、精确的，并满足所有指定条件。\n\n### 第 2 部分：压力测试的数值实现\n\n该程序实现了推导出的精确解，并按规定执行了守恒变量到原始变量的恢复测试。\n\n1.  **网格与参数**：在域 $[-3,3] \\times [-3,3]$ 上创建一个大小为 $81 \\times 81$ 的均匀笛卡尔网格。代码遍历所提供的四个测试用例。\n\n2.  **生成精确解**：对于每个测试用例，程序使用推导出的方程计算每个网格点上的精确原始变量（$\\rho, u, v, p, T$）。一个特殊分支处理 $\\kappa=0$ 时的平凡均匀流情况。\n\n3.  **构建守恒变量**：从精确原始变量出发，构建守恒变量 $\\mathbf{W} = (\\rho, \\rho u, \\rho v, \\rho E)^T$。比总能 $E$ 计算为 $E = e + \\frac{1}{2}(u^2+v^2)$，其中比内能为 $e = p/((\\gamma-1)\\rho)$。\n\n4.  **恢复原始变量**：代码接着应用指定的基于能量的恢复公式，从守恒变量计算压力 $p_{\\text{rec}}$：\n    $$ p_{\\text{rec}} = (\\gamma - 1) \\left( \\rho E - \\frac{(\\rho u)^2 + (\\rho v)^2}{2\\rho} \\right) $$\n    此操作使用标准的双精度浮点算术执行。\n\n5.  **计算误差**：在所有网格点上计算恢复压力 $p_{\\text{rec}}$ 和精确压力 $p_{\\text{exact}}$ 之间的最大相对误差 $\\varepsilon_p$。分母经过正则化处理，以防止在极低压力区域出现除以零的情况。\n\n该测试突显了一个数值刚性问题。当 $\\gamma \\to 1$ 时，与比动能 $K=\\frac{1}{2}|\\mathbf{v}|^2$ 相比，比内能 $e=T/(\\gamma-1)$ 变得非常大。因此，总能 $E=e+K$ 由内能部分主导。压力恢复公式通过代数方式从总能中减去动能来分离出内能，然后将其乘以 $(\\gamma-1)$。在有限精度下，当动能占总能的很大一部分时（高马赫数流），或者当发生其他类似的数值减法时，这个过程越来越容易出现灾难性相消误差。尽管我们的分析表明，对于固定的马赫数，当 $\\gamma \\to 1$ 时内能主导动能，但涉及非均匀场的完整数值过程仍然揭示出，随着 $\\gamma$ 接近 $1$，灵敏度增加和精度损失。结果表明，随着 $\\gamma$ 越来越接近 $1$，$\\varepsilon_p$ 显著增长，证明了标准压力恢复公式在此极限下的病态性。\n$\\kappa=0$ 的情况导致均匀流场，此时解析恢复是完美的，数值误差极小，接近机器精度，可作为基线。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and implements an isentropic vortex solution for the 2D Euler\n    equations to test conservative-to-primitive variable recovery.\n    \"\"\"\n    \n    # Grid parameters\n    L = 3.0\n    N = 81\n    \n    # Test cases from the problem statement: (gamma, kappa, u_inf, v_inf, t)\n    test_cases = [\n        (1.4, 5.0, 0.5, 0.0, 1.0),\n        (1.01, 5.0, 0.5, 0.0, 1.0),\n        (1.001, 5.0, 0.5, 0.0, 1.0),\n        (1.001, 0.0, 0.5, 0.0, 1.0),\n    ]\n\n    # Grid setup\n    x_coords = np.linspace(-L, L, N, dtype=np.float64)\n    y_coords = np.linspace(-L, L, N, dtype=np.float64)\n    X, Y = np.meshgrid(x_coords, y_coords, indexing='ij')\n\n    results = []\n\n    for gamma, kappa, u_inf, v_inf, t in test_cases:\n        # Vortex center at time t, starting from (0,0)\n        x_c = u_inf * t\n        y_c = v_inf * t\n\n        # Calculate exact primitive variables on the grid\n        if kappa == 0.0:\n            # Uniform flow for kappa = 0\n            u_exact = np.full_like(X, u_inf)\n            v_exact = np.full_like(Y, v_inf)\n            T_exact = np.ones_like(X)\n            rho_exact = np.ones_like(X)\n            p_exact = np.ones_like(X)\n        else:\n            # Isentropic vortex solution for kappa > 0\n            r_sq = (X - x_c)**2 + (Y - y_c)**2\n            \n            # Velocity field. Using a counter-clockwise vortex.\n            # The derivation shows a velocity perturbation with exp(-r^2/2) decay.\n            du = - (kappa / 2.0) * (Y - y_c) * np.exp(-r_sq / 2.0)\n            dv =   (kappa / 2.0) * (X - x_c) * np.exp(-r_sq / 2.0)\n            u_exact = u_inf + du\n            v_exact = v_inf + dv\n            \n            # Thermodynamic fields. The derivation yields exp(-r^2) decay for these.\n            # T = 1 - (gamma-1)*kappa^2/(8*gamma*R) * exp(-r^2). R=1.\n            temp_pert_factor = ((gamma - 1.0) * kappa**2) / (8.0 * gamma)\n            T_exact = 1.0 - temp_pert_factor * np.exp(-r_sq)\n\n            # Isentropic relations from far-field conditions (T=1, rho=1, p=1)\n            # T/rho^(gamma-1) = 1 => rho = T^(1/(gamma-1))\n            # p/rho^gamma = 1 => p = rho^gamma\n            rho_exact = T_exact**(1.0 / (gamma - 1.0))\n            p_exact = rho_exact**gamma\n\n        # Construct conservative variables from exact primitives\n        # W = [rho, rho*u, rho*v, rho*E]\n        cons_rho = rho_exact\n        cons_rho_u = rho_exact * u_exact\n        cons_rho_v = rho_exact * v_exact\n        \n        # Specific internal energy: e = p/((gamma-1)*rho). With R=1, p=rho*T, so e = T/(gamma-1)\n        e_exact = T_exact / (gamma - 1.0)\n        # Specific total energy: E = e + 0.5*(u^2+v^2)\n        E_exact = e_exact + 0.5 * (u_exact**2 + v_exact**2)\n        cons_rho_E = rho_exact * E_exact\n\n        # Recover pressure from conservative variables using the specified energy-based mapping\n        # p = (gamma-1) * (rhoE - 0.5 * rho * (u^2+v^2))\n        #   = (gamma-1) * (rhoE - 0.5 * ((rho u)^2 + (rho v)^2) / rho)\n        ke_density = 0.5 * (cons_rho_u**2 + cons_rho_v**2) / cons_rho\n        p_rec = (gamma - 1.0) * (cons_rho_E - ke_density)\n\n        # Compute maximum relative error in pressure\n        p_diff = np.abs(p_rec - p_exact)\n        p_denominator = np.maximum(p_exact, 1e-12)\n        rel_error = p_diff / p_denominator\n        max_rel_error = np.max(rel_error)\n        results.append(max_rel_error)\n        \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3351094"}]}