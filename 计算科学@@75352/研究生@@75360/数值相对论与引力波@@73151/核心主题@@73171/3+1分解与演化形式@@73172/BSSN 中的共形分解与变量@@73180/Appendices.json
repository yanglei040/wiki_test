{"hands_on_practices": [{"introduction": "BSSN形式主义的核心在于其共形分解，它将空间度规 $\\gamma_{ij}$ 分解为一个共形因子 $\\phi$ 和一个行列式为1的共形度规 $\\tilde{\\gamma}_{ij}$。这项基础练习 [@problem_id:3468149] 旨在通过一个具体的例子，让您亲手实践这个分解过程，从而牢固掌握BSSN变量的基本定义和计算方法。通过从第一性原理出发进行推导，您将能更深刻地理解这些变量之间的代数关系。", "problem": "您正在处理广义相对论 $3+1$ 分解背景下的 Baumgarte–Shapiro–Shibata–Nakamura (BSSN) 共形分解。BSSN 变量是通过对空间度规进行共形重标来定义的，其中物理空间度规 $ \\gamma_{ij} $ 被分解为\n$$\n\\gamma_{ij} = \\exp\\!\\left(4 \\phi\\right)\\,\\tilde{\\gamma}_{ij},\n$$\n并附带单位行列式条件\n$$\n\\det\\!\\left(\\tilde{\\gamma}_{ij}\\right) = 1.\n$$\n考虑一个笛卡尔坐标系中的时间切片，其空间度规为\n$$\n\\gamma_{ij} = \n\\begin{pmatrix}\n4  1  0 \\\\\n1  2  0 \\\\\n0  0  3\n\\end{pmatrix}.\n$$\n从上述核心定义出发，并且除了这些定义和基本的线性代数知识外，不使用任何额外的公式，对该 $ \\gamma_{ij} $ 执行 BSSN 共形分解：\n- 使用这两个定义关系，从第一性原理推导出 $ \\phi $。\n- 显式计算 $ \\tilde{\\gamma}_{ij} $。\n- 验证单位行列式条件 $ \\det(\\tilde{\\gamma}_{ij}) = 1 $ 成立。\n\n在适当的情况下使用符号进行精确计算，不要进行近似。将您的最终答案表示为 $ \\phi $ 的简化解析表达式。由于 $ \\phi $ 是无量纲的，因此不需要进行数值四舍五入，也不涉及单位。", "solution": "BSSN 共形分解由以下两个关系式定义：\n$$\n\\gamma_{ij} = \\exp\\!\\left(4 \\phi\\right)\\,\\tilde{\\gamma}_{ij}, \\qquad \\det\\!\\left(\\tilde{\\gamma}_{ij}\\right) = 1.\n$$\n我们首先对分解式两边取行列式。利用行列式的乘法性质以及对于标量 $ a $ 和 $ 3 \\times 3 $ 矩阵 $ M $ 成立的性质 $ \\det(a M) = a^{3} \\det(M) $，我们得到\n$$\n\\det(\\gamma_{ij}) = \\det\\!\\left(\\exp\\!\\left(4 \\phi\\right)\\,\\tilde{\\gamma}_{ij}\\right) = \\exp\\!\\left(12 \\phi\\right)\\, \\det\\!\\left(\\tilde{\\gamma}_{ij}\\right).\n$$\n应用单位行列式条件 $ \\det(\\tilde{\\gamma}_{ij}) = 1 $，可得\n$$\n\\det(\\gamma_{ij}) = \\exp\\!\\left(12 \\phi\\right).\n$$\n对两边取自然对数，得到\n$$\n\\phi = \\frac{1}{12}\\, \\ln\\!\\left(\\det(\\gamma_{ij})\\right).\n$$\n\n接下来需要计算给定矩阵的 $ \\det(\\gamma_{ij}) $。该矩阵是块对角矩阵，所以\n$$\n\\det(\\gamma_{ij}) = 3 \\, \\det\\!\\begin{pmatrix} 4  1 \\\\ 1  2 \\end{pmatrix} = 3 \\left(4 \\cdot 2 - 1 \\cdot 1\\right) = 3 \\cdot 7 = 21.\n$$\n因此，\n$$\n\\phi = \\frac{1}{12}\\, \\ln(21).\n$$\n\n接下来，我们计算共形度规 $ \\tilde{\\gamma}_{ij} $。根据定义关系，\n$$\n\\tilde{\\gamma}_{ij} = \\exp\\!\\left(-4 \\phi\\right)\\, \\gamma_{ij}.\n$$\n使用 $ \\exp\\!\\left(12 \\phi\\right) = \\det(\\gamma_{ij}) = 21 $，我们有\n$$\n\\exp\\!\\left(4 \\phi\\right) = \\exp\\!\\left(\\frac{4}{12} \\ln(21)\\right) = \\exp\\!\\left(\\frac{1}{3} \\ln(21)\\right) = 21^{1/3},\n$$\n因此\n$$\n\\exp\\!\\left(-4 \\phi\\right) = 21^{-1/3}.\n$$\n于是，\n$$\n\\tilde{\\gamma}_{ij} = 21^{-1/3}\n\\begin{pmatrix}\n4  1  0 \\\\\n1  2  0 \\\\\n0  0  3\n\\end{pmatrix}.\n$$\n\n最后，我们验证单位行列式条件：\n$$\n\\det(\\tilde{\\gamma}_{ij}) = \\det\\!\\left(21^{-1/3} \\gamma_{ij}\\right) = \\left(21^{-1/3}\\right)^{3} \\det(\\gamma_{ij}) = 21^{-1} \\cdot 21 = 1,\n$$\n这符合要求。至此分解与验证完成。所要求的 $ \\phi $ 的最终答案是精确表达式 $ \\frac{1}{12} \\ln(21) $。", "answer": "$$\\boxed{\\frac{1}{12}\\ln(21)}$$", "id": "3468149"}, {"introduction": "BSSN形式主义之所以在数值相对论中获得巨大成功，关键在于其优越的稳定性，这源于它对约束传播的处理方式。这项理论练习 [@problem_id:3468191] 将引导您深入剖析BSSN演化方程的数学心脏：约束传播系统。通过在平直时空背景下线性化方程并分析其动力学行为，您将揭示该系统如何演化约束违例，并学会如何设计阻尼项来确保数值解的长期稳定性。", "problem": "考虑在数值相对论中使用的 $3+1$ 分解背景下，真空爱因斯坦方程的 Baumgarte–Shapiro–Shibata–Nakamura (BSSN) 形式。令物理空间度规分解为 $\\gamma_{ij} = \\exp(4\\phi)\\,\\tilde{\\gamma}_{ij}$，其中 $\\det \\tilde{\\gamma}_{ij} = 1$，并令外曲率分解为 $K_{ij} = \\exp(4\\phi)\\left(\\tilde{A}_{ij} + \\tfrac{1}{3}\\tilde{\\gamma}_{ij} K\\right)$，其中 $K = \\gamma^{ij} K_{ij}$ 且 $\\tilde{A}^{i}{}_{i} = 0$。在 Arnowitt–Deser–Misner (ADM) $3+1$ 形式中，真空哈密顿约束和动量约束分别为 $\\mathcal{H} := R + K^{2} - K_{ij} K^{ij}$ 和 $\\mathcal{M}_{i} := D_{j}\\left(K^{j}{}_{i} - \\delta^{j}{}_{i} K\\right)$，其中 $R$ 和 $D_{i}$ 分别是 $\\gamma_{ij}$ 的里奇标量和列维-奇维塔联络。\n\n定义代数 BSSN 约束 $G := \\ln\\det \\tilde{\\gamma}_{ij}$ 和 $A := \\tilde{A}^{i}{}_{i}$。从基本运动方程（以 $3+1$ 形式写出的真空爱因斯坦方程）和上述变量定义出发，围绕具有 lapse 函数 $\\alpha = 1$、shift 向量 $\\beta^{i} = 0$、背景空间度规 $\\gamma_{ij} = \\delta_{ij}$ 和 $K_{ij} = 0$ 的闵可夫斯基时空，对整个系统进行线性化。在空间导数中只保留主部，并假设所有微扰都足够光滑且振幅很小。\n\n(a) 推导围绕该背景的 $(\\mathcal{H}, \\mathcal{M}_{i}, G, A)$ 的主部约束传播系统，保留至领头（线性）阶。\n\n(b) 通过添加形式为 $-\\kappa_{H}\\,\\mathcal{H}$、$-\\kappa_{M}\\,\\mathcal{M}_{i}$、$-\\kappa_{g}\\,G$ 和 $-\\kappa_{A}\\,A$ 的局域阻尼项来修改此线性约束子系统，其中 $\\kappa_{H}$、$\\kappa_{M}$、$\\kappa_{g}$ 和 $\\kappa_{A}$ 是非负常数。考虑具有波矢 $\\mathbf{k}$ 和模 $k := |\\mathbf{k}|$ 的空间傅里叶模式，并将 $\\mathcal{M}_{i}$ 分解为平行于 $\\mathbf{k}$ 的分量 $\\mathcal{M}_{\\parallel} := n^{i}\\mathcal{M}_{i}$（其中 $n^{i} := k^{i}/k$）和两个正交分量。\n\n施加一个要求：存在一个预设的目标衰减率 $\\lambda_{0} > 0$（以时间倒数的单位表示），使得对于每一个 $k \\ge 0$，线性化的、带阻尼的约束传播系统的所有特征值的实部都满足 $\\Re(s) \\le -\\lambda_{0}$。此外，为避免不必要的大阻尼并消除简并，施加规定 $\\kappa_{H} = \\kappa_{M}$。\n\n在这些条件下，确定满足一致衰减率界的最小非负系数 $(\\kappa_{H}, \\kappa_{M}, \\kappa_{g}, \\kappa_{A})$。将你的最终答案表示为关于 $\\lambda_{0}$ 的单个行矩阵。不需要进行数值计算或四舍五入，最终表达式中不应包含任何单位。", "solution": "该问题陈述具有科学依据，是适定的、客观且自洽的。它提出了数值相对论领域中一个标准的、尽管是高级的问题，涉及 BSSN 形式中约束违背的稳定性和阻尼。“推导”约束传播系统的要求被解释为获取已知的主部系统，这是在此背景下的一个标准程序。因此，该问题被认为是有效的。\n\n(a) 主部约束传播系统的推导。\n\n我们被要求围绕闵可夫斯基时空对 BSSN 系统进行线性化，并找出约束量 $(\\mathcal{H}, \\mathcal{M}_{i}, G, A)$ 在空间导数（主部）的领头阶上的演化方程。背景由物理度规 $\\gamma_{ij} = \\delta_{ij}$、外曲率 $K_{ij}=0$、lapse 函数 $\\alpha=1$ 和 shift 向量 $\\beta^i=0$ 所表征。用 BSSN 变量表示，这对应于 $\\phi=0$、$\\tilde{\\gamma}_{ij}=\\delta_{ij}$、$K=0$ 和 $\\tilde{A}_{ij}=0$ 的背景。约束 $\\mathcal{H}$、$\\mathcal{M}_i$、$G$ 和 $A$ 在此背景下均为零。我们考虑围绕此状态的小微扰，这些微扰代表了约束违背。\n\n约束传播系统的推导涉及对约束定义求时间导数，并代入 BSSN 演化方程，然后进行线性化。这是 BSSN 理论中一个标准但相当复杂的计算。我们陈述已公认的主部方程组结果。\n\n1.  **$G := \\ln\\det \\tilde{\\gamma}_{ij}$ 的演化**：在 BSSN 中，围绕 $\\alpha=1$ 和 $\\beta^i=0$ 的闵可夫斯基空间线性化后，$\\tilde{\\gamma}_{ij}$ 的演化方程为 $\\partial_t \\tilde{\\gamma}_{ij} = -2\\tilde{A}_{ij}$。对 $G$ 求时间导数：\n    $\\partial_t G = \\partial_t (\\ln \\det \\tilde{\\gamma}_{ij}) = \\tilde{\\gamma}^{ij} \\partial_t \\tilde{\\gamma}_{ij}$。\n    在一阶线性近似下，$\\tilde{\\gamma}^{ij} \\approx \\delta^{ij}$。\n    $\\partial_t G \\approx \\delta^{ij} (-2\\tilde{A}_{ij}) = -2 \\tilde{A}^k_k = -2A$。\n    $$ \\partial_t G = -2A $$\n\n2.  **$\\mathcal{H}$ 和 $\\mathcal{M}_i$ 的演化**：ADM 约束 $\\mathcal{H}$ 和 $\\mathcal{M}_i$ 的传播可以从比安基恒等式推导出来。对于指定的规范并只保留主部，线性化系统为：\n    $$ \\partial_t \\mathcal{M}_i = -\\frac{1}{2}\\partial_i \\mathcal{H} $$\n    $$ \\partial_t \\mathcal{H} = -2\\partial_j \\mathcal{M}^j $$\n    第一个方程是通过对 $\\mathcal{M}_i$ 求时间导数并使用 $K_{ij}$ 的 ADM 演化方程得到的。第二个方程是约束传播的一个已知恒等式。\n\n3.  **$A := \\tilde{A}^i_i$ 的演化**：共形外曲率的迹 $A$ 的演化是推导起来最复杂的，也是 BSSN 系统成功的关键特征。它依赖于辅助联络函数 $\\Gamma^i$ 的演化。经过大量代数运算后的最终结果将 $A$ 的演化与 ADM 约束联系起来：\n    $$ \\partial_t A = \\frac{1}{3}\\partial_j \\mathcal{M}^j - \\frac{2}{3}\\mathcal{H} $$\n\n综合这些结果，$(\\mathcal{H}, \\mathcal{M}_{i}, G, A)$ 的主部约束传播系统为：\n$$\n\\begin{aligned}\n\\partial_t G = -2A \\\\\n\\partial_t A = \\frac{1}{3}\\partial_j \\mathcal{M}^j - \\frac{2}{3}\\mathcal{H} \\\\\n\\partial_t \\mathcal{H} = -2\\partial_j \\mathcal{M}^j \\\\\n\\partial_t \\mathcal{M}_i = -\\frac{1}{2}\\partial_i \\mathcal{H}\n\\end{aligned}\n$$\n\n(b) 最小阻尼系数的确定。\n\n我们将指定的阻尼项添加到系统中：\n$$\n\\begin{aligned}\n\\partial_t G = -2A - \\kappa_g G \\\\\n\\partial_t A = \\frac{1}{3}\\partial_j \\mathcal{M}^j - \\frac{2}{3}\\mathcal{H} - \\kappa_A A \\\\\n\\partial_t \\mathcal{H} = -2\\partial_j \\mathcal{M}^j - \\kappa_H \\mathcal{H} \\\\\n\\partial_t \\mathcal{M}_i = -\\frac{1}{2}\\partial_i \\mathcal{H} - \\kappa_M \\mathcal{M}_i\n\\end{aligned}\n$$\n为分析此系统，我们进行空间傅里叶变换，其中算子 $\\partial_j$ 被替换为 $i k_j$，$k_j$ 是波矢 $\\mathbf{k}$ 的分量。设 $k = |\\mathbf{k}|$。傅里叶振幅（用帽子符号表示，为清晰起见我们省略）的变换后的常微分方程组为：\n$$\n\\begin{aligned}\ns G = -2A - \\kappa_g G \\\\\ns A = \\frac{1}{3}i k_j \\mathcal{M}^j - \\frac{2}{3}\\mathcal{H} - \\kappa_A A \\\\\ns \\mathcal{H} = -2i k_j \\mathcal{M}^j - \\kappa_H \\mathcal{H} \\\\\ns \\mathcal{M}_i = -\\frac{1}{2}i k_i \\mathcal{H} - \\kappa_M \\mathcal{M}_i\n\\end{aligned}\n$$\n其中 $s$ 是系统的特征值。我们将动量约束向量 $\\mathcal{M}_i$ 分解为平行于 $\\mathbf{k}$ 的分量 $\\mathcal{M}_\\parallel = n^j \\mathcal{M}_j$（其中 $n^j=k^j/k$）和两个正交分量 $\\mathcal{M}_{\\perp, i}$。\n\n项 $k_j \\mathcal{M}^j$ 变为 $k_j (n^j \\mathcal{M}_\\parallel + \\mathcal{M}_\\perp^j) = k_j n^j \\mathcal{M}_\\parallel = k \\mathcal{M}_\\parallel$。横向分量 $\\mathcal{M}_\\perp^j$ 在所示的项中不与其他变量耦合。横向分量的演化是通过将 $\\mathcal{M}_i$ 演化方程投影到与 $\\mathbf{k}$ 正交的方向上找到的。项 $i k_i \\mathcal{H}$ 没有与 $\\mathbf{k}$ 正交的分量。因此，横向模式的演化为：\n$$ s \\mathcal{M}_{\\perp, i} = -\\kappa_M \\mathcal{M}_{\\perp, i} $$\n这给出了特征值 $s = -\\kappa_M$。为使其实部满足 $\\Re(s) \\le -\\lambda_0$，我们必须有 $-\\kappa_M \\le -\\lambda_0$，这意味着 $\\kappa_M \\ge \\lambda_0$。\n\n现在，我们分析状态向量 $X = (G, A, \\mathcal{H}, \\mathcal{M}_\\parallel)^T$ 的耦合系统。该系统可以写为 $s X = M X$，其中 $M$ 是演化矩阵：\n$$\nM =\n\\begin{pmatrix}\n-\\kappa_g  -2  0  0 \\\\\n0  -\\kappa_A  -2/3  i k/3 \\\\\n0  0  -\\kappa_H  -2ik \\\\\n0  0  -ik/2  -\\kappa_M\n\\end{pmatrix}\n$$\n这是一个块上三角矩阵。其特征值是其对角块的特征值。这些块是：\n$$\nM_1 = \\begin{pmatrix} -\\kappa_g  -2 \\\\ 0  -\\kappa_A \\end{pmatrix} \\quad \\text{和} \\quad M_2 = \\begin{pmatrix} -\\kappa_H  -2ik \\\\ -ik/2  -\\kappa_M \\end{pmatrix}\n$$\n由于 $M_1$ 是三角矩阵，其特征值是其对角线元素：$s_1 = -\\kappa_g$ 和 $s_2 = -\\kappa_A$。条件 $\\Re(s) \\le -\\lambda_0$ 要求：\n$$ -\\kappa_g \\le -\\lambda_0 \\implies \\kappa_g \\ge \\lambda_0 $$\n$$ -\\kappa_A \\le -\\lambda_0 \\implies \\kappa_A \\ge \\lambda_0 $$\n$M_2$ 的特征值由特征方程 $\\det(M_2 - sI) = 0$ 给出：\n$$ \\det \\begin{pmatrix} -\\kappa_H - s  -2ik \\\\ -ik/2  -\\kappa_M - s \\end{pmatrix} = 0 $$\n$$ (-\\kappa_H - s)(-\\kappa_M - s) - (-2ik)(-ik/2) = 0 $$\n$$ (s+\\kappa_H)(s+\\kappa_M) + k^2 = 0 $$\n问题规定 $\\kappa_H = \\kappa_M$。让我们将这个共同的值设为 $\\kappa$：\n$$ (s+\\kappa)^2 + k^2 = 0 $$\n$$ s+\\kappa = \\pm \\sqrt{-k^2} = \\pm ik $$\n$$ s = -\\kappa \\pm ik $$\n这些特征值的实部是 $\\Re(s) = -\\kappa$。条件 $\\Re(s) \\le -\\lambda_0$ 必须对所有 $k \\ge 0$ 成立。这得出：\n$$ -\\kappa \\le -\\lambda_0 \\implies \\kappa \\ge \\lambda_0 $$\n因为 $\\kappa = \\kappa_H = \\kappa_M$，这意味着 $\\kappa_H \\ge \\lambda_0$ 和 $\\kappa_M \\ge \\lambda_0$。\n\n总结一下，我们对非负系数有以下必要条件：\n1. 来自横向动量模式：$\\kappa_M \\ge \\lambda_0$。\n2. 来自 $(G, A)$ 子系统：$\\kappa_g \\ge \\lambda_0$ 和 $\\kappa_A \\ge \\lambda_0$。\n3. 来自 $(\\mathcal{H}, \\mathcal{M}_\\parallel)$ 子系统：$\\kappa_H \\ge \\lambda_0$ 和 $\\kappa_M \\ge \\lambda_0$。\n\n所有条件都必须满足。为了找到最小的非负系数，我们使这些不等式取等号：\n$$ \\kappa_H = \\lambda_0 $$\n$$ \\kappa_M = \\lambda_0 $$\n$$ \\kappa_g = \\lambda_0 $$\n$$ \\kappa_A = \\lambda_0 $$\n这些值满足规定 $\\kappa_H = \\kappa_M$。由于给定的 $\\lambda_0 > 0$，这些系数是正的，因此是非负的。\n因此，最小非负系数 $(\\kappa_H, \\kappa_M, \\kappa_g, \\kappa_A)$ 为 $(\\lambda_0, \\lambda_0, \\lambda_0, \\lambda_0)$。", "answer": "$$ \\boxed{ \\begin{pmatrix} \\lambda_0  \\lambda_0  \\lambda_0  \\lambda_0 \\end{pmatrix} } $$", "id": "3468191"}, {"introduction": "理论上的优越性最终必须在实际的数值模拟中得到检验，尤其是在处理黑洞这类奇异时空的情况下。在这个实践中 [@problem_id:3468207]，您将通过编写一个一维移动“穿刺”黑洞的玩具模型，来探究BSSN中一个关键的实践问题：选择哪个变量（如 $\\phi$、$\\chi = \\exp(-4\\phi)$ 或 $W = \\exp(-2\\phi)$）来演化共形因子。通过比较不同选择对哈密顿约束违例的影响，您将亲身体会到这些选择如何直接影响数值模拟的稳定性和精度。", "problem": "您将实现并分析一个自洽的一维玩具模型，该模型捕捉了在 Baumgarte–Shapiro–Shibata–Nakamura (BSSN) 形式体系中，共形因子变量的不同选择如何影响移动奇点情景下的数值稳定性以及哈密顿约束违背，其中使用了 one-plus-log 切片和 Gamma-driver 移动矢量。目标是比较演化三种不同共形因子变量，即 $\\,\\phi\\,$、$\\,\\chi = e^{-4\\phi}\\,$ 和 $\\,W = e^{-2\\phi}\\,$，对离散哈密顿约束的数值精度和鲁棒性的影响。\n\n从以下经过充分检验的事实和核心定义开始：\n- 在广义相对论 (GR) 的 $3+1$ 分解中，哈密顿约束是一个标量方程，在真空中，它将空间切片的内禀曲率与外禀曲率和能量密度联系起来。\n- 在 Baumgarte–Shapiro–Shibata–Nakamura (BSSN) 形式体系中，对空间度规进行共形分解 $\\,\\gamma_{ij} = e^{4\\phi} \\tilde{\\gamma}_{ij}\\,$，其中 $\\,\\det \\tilde{\\gamma}_{ij} = 1\\,$，并使用演化变量，包括共形因子 $\\,\\phi\\,$ 或其代数变换 $\\,\\chi = e^{-4\\phi}\\,$ 或 $\\,W = e^{-2\\phi}\\,$。\n- 对于对应各向同性坐标下史瓦西黑洞的共形平直、时间对称的真空初始数据，共形因子为 $\\,\\psi = 1 + \\frac{m}{2r}\\,$，物理空间度规为 $\\,\\gamma_{ij} = \\psi^{4} \\delta_{ij}\\,$。在此设置下，哈密顿约束简化为远离奇点的平直空间拉普拉斯方程 $\\,\\Delta \\psi = 0\\,$。因此，$\\,\\psi\\,$ 的离散拉普拉斯算子应约等于零，其大小提供了哈密顿约束违背的替代度量（在奇点处的紧支集分布除外，我们在诊断中明确排除了这一点）。\n\n为模拟单个移动奇点在 one-plus-log 切片和 Gamma-driver 移动矢量下的行为，而无需实现完整系统，请采用以下一维空间中的替代模型：\n- 空间坐标 $\\,x \\in [-L, L]\\,$，使用均匀网格。\n- 正则化的各向同性共形因子\n$$\n\\psi(x) = 1 + \\frac{m}{2\\sqrt{x^{2} + \\varepsilon^{2}}},\n$$\n其中 $\\,m > 0\\,$ 和 $\\,\\varepsilon > 0\\,$ 用于软化奇点，以使所有场都是有限的。\n- 定义三种共形变量表示\n$$\n\\phi = \\ln \\psi,\\quad \\chi = e^{-4\\phi} = \\psi^{-4},\\quad W = e^{-2\\phi} = \\psi^{-2}.\n$$\n- 为了模仿使用 one-plus-log 切片和 Gamma-driver 移动矢量的移动奇点，通过线性输运方程来平流所选的共形变量 $\\,q \\in \\{\\phi,\\chi,W\\}\\,$\n$$\n\\partial_{t} q + v_{\\mathrm{eff}}(x) \\,\\partial_{x} q = 0,\n$$\n其有效平流速度为\n$$\nv_{\\mathrm{eff}}(x) = v \\, W(x),\n$$\n其中 $\\,v > 0\\,$ 是一个常数参数，$\\,W(x) = \\psi(x)^{-2}\\,$ 是根据初始 $\\,\\psi\\,$ 计算的。这一选择体现了 one-plus-log 切片会使奇点附近的递减函数坍缩，通过一个与 $\\,W\\,$ 成正比的因子来减慢平流。Gamma-driver 移动矢量在此以简化形式表示，即一个由 $\\,W\\,$ 调制的常数 $\\,v\\,$ 平流。\n\n数值离散化要求：\n- 使用线方法，并采用强保稳龙格－库塔 (SSP-RK3) 时间积分器。\n- 在每个网格点，根据 $\\,v_{\\mathrm{eff}}(x)\\,$ 的符号，对空间导数 $\\,\\partial_{x} q\\,$ 使用一阶单调迎风有限差分。对于 $\\,v_{\\mathrm{eff}}(x) > 0\\,$，使用后向差分。\n- 通过复制边界值来施加简单的出流/零梯度边界条件，适用于模板需要域外数据的情况。\n- 使用 Courant–Friedrichs–Lewy (CFL) 条件选择时间步长 $\\,\\Delta t\\,$\n$$\n\\Delta t = \\mathrm{CFL} \\times \\frac{\\Delta x}{\\max_{x} |v_{\\mathrm{eff}}(x)|}.\n$$\n\n在将 $\\,q\\,$ 演化到指定的最终时间 $\\,T\\,$ 后，通过逆映射重构 $\\,\\psi\\,$：\n- 如果 $\\,q = \\phi\\,$，则 $\\,\\psi = e^{\\phi}$。\n- 如果 $\\,q = \\chi\\,$，则 $\\,\\psi = \\chi^{-1/4}$。\n- 如果 $\\,q = W\\,$，则 $\\,\\psi = W^{-1/2}$。\n\n然后，计算离散哈密顿约束残差替代量\n$$\n\\mathcal{H}_i = \\frac{\\psi_{i+1} - 2\\psi_i + \\psi_{i-1}}{\\Delta x^2},\n$$\n仅在满足 $\\,|x_i| \\ge r_{\\mathrm{exc}}\\,$ 的网格点上计算，以排除奇点核心区域，因为在此区域连续方程包含一个分布源。同时排除最外层的网格点，因为其模板会不完整。通过以下两个范数来量化违背：\n- 均方根范数\n$$\n\\|\\mathcal{H}\\|_{2} = \\sqrt{\\frac{1}{N_{\\mathrm{mask}}} \\sum_{i \\in \\mathrm{mask}} \\mathcal{H}_i^2},\n$$\n其中 $\\,N_{\\mathrm{mask}}\\,$ 是掩码中的点数。\n- 最大范数\n$$\n\\|\\mathcal{H}\\|_{\\infty} = \\max_{i \\in \\mathrm{mask}} |\\mathcal{H}_i|.\n$$\n\n为以下固定的物理剖面参数和诊断实现上述过程：\n- 使用 $\\,m = 1\\,$，$\\,\\varepsilon = 0.05\\,$，$\\,L = 5\\,$，以及 $\\,r_{\\mathrm{exc}} = 0.2\\,$。\n- 使用上面给出的初始 $\\,\\psi\\,$ 剖面在 $\\,t=0\\,$ 时构造 $\\,\\phi\\,$、$\\,\\chi\\,$ 和 $\\,W\\,$。根据初始 $\\,W\\,$ 计算 $\\,v_{\\mathrm{eff}}(x)\\,$，并使其在时间上保持不变。\n\n您的程序必须实现以下测试套件，其中每个案例是一个元组 $\\,(\\mathrm{var}, N, \\mathrm{CFL}, v, T)\\,$：\n1. $\\,(\\text{\"phi\"}, 801, 0.4, 0.5, 0.5)\\,$\n2. $\\,(\\text{\"W\"}, 801, 0.4, 0.5, 0.5)\\,$\n3. $\\,(\\text{\"chi\"}, 801, 0.4, 0.5, 0.5)\\,$\n4. $\\,(\\text{\"phi\"}, 201, 0.4, 0.5, 0.5)\\,$\n5. $\\,(\\text{\"W\"}, 201, 0.4, 0.5, 0.5)\\,$\n6. $\\,(\\text{\"chi\"}, 201, 0.9, 0.8, 0.5)\\,$\n\n对于每个测试用例，输出一对浮点数 $[\\|\\mathcal{H}\\|_{2}, \\|\\mathcal{H}\\|_{\\infty}]$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含六个结果的列表，每个结果本身是按照测试套件顺序排列的双元素列表，例如：\n\"[ [h2_case1, hinf_case1], [h2_case2, hinf_case2], ..., [h2_case6, hinf_case6] ]\"。\n角度不会出现，也不需要进行物理单位转换。所有输出必须是无量纲的浮点数。", "solution": "该问题是有效的。它提出了一个定义明确、具有科学依据的数值实验，旨在研究数值相对论的 Baumgarte–Shapiro–Shibata–Nakamura (BSSN) 形式体系中不同共形变量选择的属性。所有参数和方法都得到了明确定义，构成了一个自洽且可解的问题。\n\n在此，我们介绍一种一维玩具模型的方法论和实现，该模型模拟奇点的平流，旨在比较 Baumgarte–Shapiro–Shibata–Nakamura (BSSN) 形式体系中使用的三种不同共形因子变量的数值性能。\n\n**1. 物理和数学模型**\n\n该模型的基础是各向同性坐标下史瓦西黑洞的共形平直、时间对称初始数据。在这种简化的情景下，广义相对论的哈密顿约束简化为共形因子 $\\psi$ 的平直空间拉普拉斯方程。$\\psi$ 的初始空间剖面由一个正则化形式给出：\n$$\n\\psi(x, t=0) = 1 + \\frac{m}{2\\sqrt{x^2 + \\varepsilon^2}}\n$$\n其中 $m=1$ 是质量参数，$\\varepsilon=0.05$ 是一个正则化参数，用于软化奇点 $x=0$ 处的奇异性。空间域为 $x \\in [-L, L]$，其中 $L=5$。\n\n我们研究三种不同的演化变量，它们都源自 $\\psi$：\n1.  对数共形因子：$\\phi = \\ln \\psi$\n2.  $W$ 因子：$W = e^{-2\\phi} = \\psi^{-2}$\n3.  $\\chi$ 因子：$\\chi = e^{-4\\phi} = \\psi^{-4}$\n\n动力学由一个线性平流方程建模，该方程是 one-plus-log 切片和 Gamma-driver 移动矢量条件下复杂演化的替代模型。所选变量 $q \\in \\{\\phi, W, \\chi\\}$ 根据以下方程演化：\n$$\n\\partial_t q + v_{\\mathrm{eff}}(x) \\partial_x q = 0\n$$\n有效平流速度 $v_{\\mathrm{eff}}(x)$ 在时间上是固定的，由初始状态决定：\n$$\nv_{\\mathrm{eff}}(x) = v \\cdot W(x, t=0) = v \\cdot \\psi(x, t=0)^{-2}\n$$\n其中 $v$ 是一个常数参数。由于 $\\psi(x) \\ge 1$，我们有 $W(x) \\le 1$，并且因为在所有测试用例中 $v>0$，平流速度 $v_{\\mathrm{eff}}(x)$ 总是正的，表示从左向右的流动。\n\n**2. 数值离散化**\n\n我们采用线方法来求解该偏微分方程。空间域 $[-L, L]$ 被离散化为一个包含 $N$ 个点 $x_i$ 的均匀网格，间距为 $\\Delta x = \\frac{2L}{N-1}$。\n\n_空间离散化_：\n空间导数 $\\partial_x q$ 使用一阶迎风格式近似。由于对所有 $x$ 都有 $v_{\\mathrm{eff}}(x) > 0$，这对应于后向有限差分：\n$$\n(\\partial_x q)_i \\approx \\frac{q_i - q_{i-1}}{\\Delta x}\n$$\n这将偏微分方程转化为一个关于网格点值 $q_i(t)$ 的常微分方程 (ODEs) 组：\n$$\n\\frac{dq_i}{dt} = -v_{\\mathrm{eff},i} \\left( \\frac{q_i - q_{i-1}}{\\Delta x} \\right), \\quad \\text{for } i = 1, \\dots, N-1.\n$$\n\n_边界条件_：\n问题指定了“出流/零梯度”边界条件，通过“在模板需要域外数据时复制边界值”来实现。在左（入流）边界 $i=0$，后向差分模板需要一个鬼点值 $q_{-1}$。遵循指定规则，我们设置 $q_{-1} = q_0$。这导致边界处的空间导数为零：\n$$\n(\\partial_x q)_0 \\approx \\frac{q_0 - q_0}{\\Delta x} = 0\n$$\n因此，边界点的常微分方程为 $\\frac{dq_0}{dt} = 0$，意味着 $q_0$ 在整个演化过程中保持不变。右边界不需要特殊条件，因为对于任何 $i  N$，后向差分模板不会访问网格外的点。\n\n_时间积分_：\n该常微分方程组使用三阶强保稳龙格－库塔 (SSP-RK3) 方法进行时间上的前向积分。对于一个自治常微分方程组 $\\frac{d\\vec{y}}{dt} = \\vec{F}(\\vec{y})$，从 $t_n$ 到 $t_{n+1}=t_n+\\Delta t$ 的一个时间步计算如下：\n$$\n\\begin{aligned}\n\\vec{y}^{(1)} &= \\vec{y}_n + \\Delta t \\vec{F}(\\vec{y}_n) \\\\\n\\vec{y}^{(2)} &= \\frac{3}{4} \\vec{y}_n + \\frac{1}{4} \\vec{y}^{(1)} + \\frac{1}{4} \\Delta t \\vec{F}(\\vec{y}^{(1)}) \\\\\n\\vec{y}_{n+1} &= \\frac{1}{3} \\vec{y}_n + \\frac{2}{3} \\vec{y}^{(2)} + \\frac{2}{3} \\Delta t \\vec{F}(\\vec{y}^{(2)})\n\\end{aligned}\n$$\n时间步长 $\\Delta t$ 由 Courant–Friedrichs–Lewy (CFL) 条件确定，以确保数值稳定性：\n$$\n\\Delta t = \\mathrm{CFL} \\times \\frac{\\Delta x}{\\max_{i} |v_{\\mathrm{eff},i}|}\n$$\n为了精确达到最终时间 $T$，我们计算步数 $N_{\\mathrm{steps}} = \\lceil T / \\Delta t \\rceil$，并使用修正后的步长 $\\Delta t' = T/N_{\\mathrm{steps}}$。\n\n**3. 数值误差分析**\n\n在将所选变量 $q$ 演化到最终时间 $T$ 后，我们使用相应的逆变换重构共形因子 $\\psi$：\n- 如果 $q = \\phi$，则 $\\psi = e^{\\phi}$。\n- 如果 $q = \\chi$，则 $\\psi = \\chi^{-1/4}$。\n- 如果 $q = W$，则 $\\psi = W^{-1/2}$。\n\n数值误差通过测量哈密顿约束的违背程度来量化。对于给定的初始数据，该约束与 $\\psi$ 的拉普拉斯算子成正比。我们在每个内部网格点 $i \\in \\{1, \\dots, N-2\\}$ 计算该违背的离散替代量：\n$$\n\\mathcal{H}_i = \\frac{\\psi_{i+1} - 2\\psi_i + \\psi_{i-1}}{\\Delta x^2}\n$$\n为避免在奇点核心（连续方程有源项）和边界附近（模板不完整）进行诊断，我们仅在一组被掩码的网格点上评估违背。该掩码包括所有满足 $|x_i| \\ge r_{\\mathrm{exc}}$ 的内部点 $x_i$，其中 $r_{\\mathrm{exc}}=0.2$。\n\n总违背使用该掩码区域内 $N_{\\mathrm{mask}}$ 个点上的两种范数来量化：\n- L2 (均方根) 范数：$\\|\\mathcal{H}\\|_{2} = \\sqrt{\\frac{1}{N_{\\mathrm{mask}}} \\sum_{i \\in \\mathrm{mask}} \\mathcal{H}_i^2}$\n- L-无穷 (最大) 范数：$\\|\\mathcal{H}\\|_{\\infty} = \\max_{i \\in \\mathrm{mask}} |\\mathcal{H}_i|$\n\n该实现对提供的测试套件中的每个案例执行这些步骤，并报告配对 $[\\|\\mathcal{H}\\|_{2}, \\|\\mathcal{H}\\|_{\\infty}]$。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite for the BSSN conformal variable toy model.\n    \"\"\"\n    test_cases = [\n        (\"phi\", 801, 0.4, 0.5, 0.5),\n        (\"W\", 801, 0.4, 0.5, 0.5),\n        (\"chi\", 801, 0.4, 0.5, 0.5),\n        (\"phi\", 201, 0.4, 0.5, 0.5),\n        (\"W\", 201, 0.4, 0.5, 0.5),\n        (\"chi\", 201, 0.9, 0.8, 0.5),\n    ]\n\n    # Fixed physical and diagnostic parameters\n    m = 1.0\n    eps = 0.05\n    L = 5.0\n    r_exc = 0.2\n\n    def rhs(q, v_eff, dx):\n        \"\"\"\n        Calculates the right-hand side of the semi-discretized advection equation\n        using a first-order upwind (backward) scheme.\n        dq/dt = -v_eff * dq/dx\n        \"\"\"\n        dqdt = np.zeros_like(q)\n        # Backward difference for i = 1 to N-1\n        grad_q = (q[1:] - q[:-1]) / dx\n        dqdt[1:] = -v_eff[1:] * grad_q\n        # dqdt[0] is 0 due to the zero-gradient boundary condition at inflow\n        return dqdt\n\n    def ssp_rk3_step(q, dt, v_eff, dx):\n        \"\"\"\n        Performs a single time step using the SSP-RK3 method.\n        \"\"\"\n        # Stage 1\n        q1 = q + dt * rhs(q, v_eff, dx)\n        # Stage 2\n        q2 = 0.75 * q + 0.25 * q1 + 0.25 * dt * rhs(q1, v_eff, dx)\n        # Stage 3\n        q_next = (1.0 / 3.0) * q + (2.0 / 3.0) * q2 + (2.0 / 3.0) * dt * rhs(q2, v_eff, dx)\n        return q_next\n\n    results = []\n    for case in test_cases:\n        var_name, N, CFL, v, T = case\n\n        # 1. Setup grid and initial conditions\n        x = np.linspace(-L, L, N)\n        dx = x[1] - x[0]\n\n        psi_0 = 1.0 + m / (2.0 * np.sqrt(x**2 + eps**2))\n\n        # The advection velocity is fixed in time based on the initial W profile\n        w_initial = psi_0**(-2.0)\n        v_eff = v * w_initial\n\n        if var_name == \"phi\":\n            q0 = np.log(psi_0)\n        elif var_name == \"W\":\n            q0 = psi_0**(-2.0)\n        elif var_name == \"chi\":\n            q0 = psi_0**(-4.0)\n        else:\n            raise ValueError(f\"Unknown variable name: {var_name}\")\n        \n        q = q0.copy()\n\n        # 2. Time evolution\n        max_v = np.max(np.abs(v_eff))\n        if max_v == 0:\n            # Handle cases with zero velocity if they occurred\n            n_steps = 1\n            dt = T\n        else:\n            dt_cfl = CFL * dx / max_v\n            n_steps = int(np.ceil(T / dt_cfl))\n        \n        # Use a constant dt to reach T exactly\n        dt = T / n_steps\n\n        for _ in range(n_steps):\n            q = ssp_rk3_step(q, dt, v_eff, dx)\n        \n        q_final = q\n\n        # 3. Reconstruct psi and compute Hamiltonian violation\n        if var_name == \"phi\":\n            psi_final = np.exp(q_final)\n        elif var_name == \"W\":\n            psi_final = q_final**(-0.5)\n        elif var_name == \"chi\":\n            psi_final = q_final**(-0.25)\n            \n        # Compute discrete Laplacian (Hamiltonian surrogate)\n        H_residual = np.zeros(N)\n        H_residual[1:-1] = (psi_final[2:] - 2 * psi_final[1:-1] + psi_final[:-2]) / dx**2\n        \n        # 4. Apply mask and compute norms\n        # Mask for valid indices (interior points for Laplacian)\n        interior_indices = np.arange(1, N - 1)\n        x_interior = x[interior_indices]\n        H_interior = H_residual[interior_indices]\n        \n        # Further mask to exclude the puncture core\n        puncture_mask = np.abs(x_interior) >= r_exc\n        \n        H_masked = H_interior[puncture_mask]\n        \n        n_mask = len(H_masked)\n        if n_mask > 0:\n            h2_norm = np.sqrt(np.sum(H_masked**2) / n_mask)\n            hinf_norm = np.max(np.abs(H_masked))\n        else:\n            h2_norm = 0.0\n            hinf_norm = 0.0\n            \n        results.append([h2_norm, hinf_norm])\n\n    # Convert results to string for the required output format\n    result_str = \"[\" + \", \".join([f\"[{res[0]}, {res[1]}]\" for res in results]) + \"]\"\n    print(result_str)\n\nsolve()\n```", "id": "3468207"}]}