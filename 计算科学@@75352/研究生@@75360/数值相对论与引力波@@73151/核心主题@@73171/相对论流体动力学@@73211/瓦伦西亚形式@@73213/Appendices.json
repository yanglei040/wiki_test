{"hands_on_practices": [{"introduction": "掌握任何物理公式的第一步是理解其内在的代数结构。在巴伦西亚表述中，一个核心的数值挑战是从守恒变量（如 $D, S_i, \\tau$）中恢复原始变量（如 $\\rho, p, v^i$）。这个过程被称为“守恒量到原始量”的恢复，是每个演化步长的关键。这个练习 ([@problem_id:3496801]) 将引导你通过纯粹的代数推导，从基本定义出发，得出一个只包含压强 $p$ 和已知守恒量的方程，从而加深你对该理论核心的理解。", "problem": "考虑在闵可夫斯基时空上进行 $3+1$ 分解的广义相对论流体动力学 (GRHD)，其中垂直函数 $\\alpha=1$，移位矢量 $\\beta^{i}=0$，空间度规 $\\gamma_{ij}=\\delta_{ij}$。在几何化代码单位制下，光速 $c$ 和引力常数 $G$ 均为1。在巴伦西亚格式中，守恒变量由静止质量密度 $D$、动量密度 $S_{i}$ 和能量变量 $\\tau$ 定义，这些变量由原始变量——静止质量密度 $\\rho$、欧拉三维速度 $v^{i}$、压力 $p$、比内能 $\\epsilon$ 以及洛伦兹因子 $W$——构建而成。核心定义如下：\n$$\nD = \\rho W,\\quad S_{i} = \\rho h W^{2} v_{i},\\quad \\tau = \\rho h W^{2} - p - D,\n$$\n其中比焓 $h$ 由状态方程 (EOS) 给出。采用伽马律状态方程，\n$$\np = (\\Gamma - 1)\\,\\rho\\,\\epsilon,\\quad h = 1 + \\epsilon + \\frac{p}{\\rho}.\n$$\n仅从这些定义出发，不引入任何额外的专门公式，完成以下任务：\n\n1. 消去原始变量 $\\rho$ 和 $v^{i}$，导出一个单一的标量代数关系，该关系通过标量 $D$、$\\tau$ 和 $S^{2} \\equiv \\gamma^{ij} S_{i} S_{j}$ 以及洛伦兹因子 $W$ 将未知压力 $p$ 与守恒变量联系起来。然后进一步消去 $W$，得到一个仅包含 $p$ 和已知守恒量 $D$、$\\tau$、$S^{2}$ 以及绝热指数 $\\Gamma$ 的方程。\n\n2. 对于由以下参数指定的特定守恒状态：\n$$\nD = 2,\\quad S_{x} = 6\\sqrt{3},\\quad S_{y} = 0,\\quad S_{z} = 0,\\quad \\tau = 9,\\quad \\Gamma = 2,\n$$\n求解你导出的方程以恢复该状态下的压力 $p$。以无量纲代码单位表示最终压力。如果任何步骤需要近似，请说明理由；否则，给出精确值。除非进行了近似，否则不需要进行四舍五入。", "solution": "该问题被评估为有效，因为它在广义相对论流体动力学方面有科学依据，是自洽的、适定的和客观的。它在指定的理论框架内提出了一个标准但非平凡的推导和计算。\n\n解答按要求分两部分进行。\n\n第1部分：压力 $p$ 的代数方程的推导。\n\n我们已知在平坦背景下（$\\gamma_{ij} = \\delta_{ij}$，$\\alpha=1$，$\\beta^i=0$）巴伦西亚格式中守恒变量的定义：\n$$\nD = \\rho W\n$$\n$$\nS_{i} = \\rho h W^{2} v_{i}\n$$\n$$\n\\tau = \\rho h W^{2} - p - D\n$$\n以及伽马律状态方程：\n$$\np = (\\Gamma - 1)\\,\\rho\\,\\epsilon\n$$\n$$\nh = 1 + \\epsilon + \\frac{p}{\\rho}\n$$\n这里，$\\rho$ 是静止质量密度，$W$ 是洛伦兹因子，$h$ 是比焓，$v_i$ 是三维速度，$p$ 是压力，$\\epsilon$ 是比内能，$\\Gamma$ 是绝热指数。\n\n首先，我们用 $p$、$\\rho$ 和 $\\Gamma$ 表示比焓 $h$。根据状态方程，我们有 $\\epsilon = \\frac{p}{(\\Gamma-1)\\rho}$。将其代入 $h$ 的定义中：\n$$\nh = 1 + \\frac{p}{(\\Gamma - 1)\\rho} + \\frac{p}{\\rho} = 1 + \\frac{p}{\\rho} \\left( \\frac{1}{\\Gamma-1} + 1 \\right) = 1 + \\frac{p}{\\rho} \\left( \\frac{\\Gamma}{\\Gamma-1} \\right)\n$$\n这给了我们一个 $h$、$p$ 和 $\\rho$ 之间的直接关系：\n$$\n\\rho h = \\rho + \\frac{\\Gamma p}{\\Gamma-1}\n$$\n\n接下来，我们处理守恒变量的定义。为方便起见，我们定义一个辅助变量 $A$：\n$$\nA \\equiv \\tau + D + p\n$$\n从 $\\tau$ 的定义可以看出：\n$$\nA = (\\rho h W^2 - p - D) + D + p = \\rho h W^2\n$$\n现在考虑动量密度 $S_i$。其大小的平方为 $S^2 \\equiv S_i S^i = \\delta^{ij} S_i S_j = S_i S_i$。\n$$\nS^2 = (\\rho h W^2 v_i) (\\rho h W^2 v_i) = (\\rho h W^2)^2 (v_i v_i) = A^2 v^2\n$$\n其中 $v^2 = v_i v_i$。洛伦兹因子定义为 $W = (1-v^2)^{-1/2}$，这意味着 $v^2 = 1 - W^{-2}$。将此代入 $S^2$ 的表达式中：\n$$\nS^2 = A^2 (1 - W^{-2})\n$$\n重新整理这个方程，我们得到所要求的 $p$、守恒标量 $D, \\tau, S^2$（它们是 $A$ 的一部分）以及洛伦兹因子 $W$ 之间的关系：\n$$\nS^2 = (\\tau + D + p)^2 \\left(1 - \\frac{1}{W^2}\\right)\n$$\n该方程满足了第1部分的第一项要求。\n\n为了消去 $W$，我们需要另一个关系。我们可以从定义中推导出 $W$ 的表达式。从 $S^2 = A^2(1 - W^{-2})$，我们可以解出 $W$：\n$$\n\\frac{S^2}{A^2} = 1 - \\frac{1}{W^2} \\implies \\frac{1}{W^2} = 1 - \\frac{S^2}{A^2} = \\frac{A^2 - S^2}{A^2}\n$$\n由于 $W \\ge 1$，我们必须有 $A^2 - S^2 \\ge 0$。此外，由于相对论性速度要求 $|v|1$，所以 $A > |S|$，所以 $A$ 和 $\\sqrt{A^2-S^2}$ 都是实数且非负。取正平方根：\n$$\nW = \\frac{A}{\\sqrt{A^2 - S^2}}\n$$\n现在，我们找到一个涉及状态方程的 $W$ 的替代表达式。我们结合 $A = \\rho h W^2$ 和 $D=\\rho W$：\n$$\nh = \\frac{A}{\\rho W^2} = \\frac{A}{(D/W) W^2} = \\frac{A}{DW}\n$$\n现在我们令我们得到的两个 $h$ 的表达式相等：\n$$\n1 + \\frac{\\Gamma}{\\Gamma-1} \\frac{p}{\\rho} = \\frac{A}{DW}\n$$\n代入 $\\rho = D/W$：\n$$\n1 + \\frac{\\Gamma}{\\Gamma-1} \\frac{p}{D/W} = \\frac{A}{DW} \\implies 1 + \\frac{\\Gamma p W}{(\\Gamma-1)D} = \\frac{A}{DW}\n$$\n两边乘以 $DW$：\n$$\nDW + \\frac{\\Gamma p}{\\Gamma-1} W^2 = A\n$$\n现在我们将表达式 $W = A/\\sqrt{A^2 - S^2}$ 代入此方程以消去 $W$：\n$$\nD \\left(\\frac{A}{\\sqrt{A^2 - S^2}}\\right) + \\frac{\\Gamma p}{\\Gamma-1} \\left(\\frac{A^2}{A^2 - S^2}\\right) = A\n$$\n假设 $A \\neq 0$（这是物理上所要求的），我们两边除以 $A$：\n$$\n\\frac{D}{\\sqrt{A^2-S^2}} + \\frac{\\Gamma p A}{(\\Gamma-1)(A^2 - S^2)} = 1\n$$\n为了消去分母项，将整个方程乘以 $A^2 - S^2$：\n$$\nD \\sqrt{A^2 - S^2} + \\frac{\\Gamma p A}{\\Gamma-1} = A^2 - S^2\n$$\n整理后得到仅包含 $p$、已知量 $D, \\tau, S^2$ 和 $\\Gamma$（其中 $A = \\tau+D+p$）的最终方程：\n$$\n(\\tau+D+p)^2 - S^2 - D\\sqrt{(\\tau+D+p)^2 - S^2} - \\frac{\\Gamma p (\\tau+D+p)}{\\Gamma-1} = 0\n$$\n这就是所求的关于 $p$ 的代数方程。\n\n第2部分：求解压力 $p$。\n\n我们已知特定的守恒状态：\n$D = 2$\n$S_x = 6\\sqrt{3}$，$S_y = 0$，$S_z = 0$。所以，$S^2 = S_x^2 + S_y^2 + S_z^2 = (6\\sqrt{3})^2 = 36 \\times 3 = 108$。\n$\\tau = 9$\n$\\Gamma = 2$\n\n对于 $\\Gamma=2$，项 $\\frac{\\Gamma}{\\Gamma-1} = \\frac{2}{2-1} = 2$。\n辅助量 $A$ 为 $A = \\tau+D+p = 9+2+p = 11+p$。\n将这些值代入导出的方程：\n$$\n((11+p)^2 - 108) - 2\\sqrt{(11+p)^2 - 108} - 2p(11+p) = 0\n$$\n我们来简化括号和平方根内的项：\n$$\n(11+p)^2 - 108 = (121 + 22p + p^2) - 108 = p^2 + 22p + 13\n$$\n项 $2p(11+p) = 22p + 2p^2$。\n方程变为：\n$$\n(p^2 + 22p + 13) - 2\\sqrt{p^2 + 22p + 13} - (22p + 2p^2) = 0\n$$\n合并同类项进行简化：\n$$\n-p^2 + 13 - 2\\sqrt{p^2 + 22p + 13} = 0\n$$\n$$\n13 - p^2 = 2\\sqrt{p^2 + 22p + 13}\n$$\n为了求解 $p$，我们对方程两边进行平方。这可能会引入增根。一个有效解的必要条件是右侧非负，即 $13-p^2 \\ge 0$。由于压力必须为非负值（$p \\ge 0$），这将潜在解限制在范围 $0 \\le p \\le \\sqrt{13}$ 内。\n两边平方后得到：\n$$\n(13-p^2)^2 = 4(p^2 + 22p + 13)\n$$\n$$\n169 - 26p^2 + p^4 = 4p^2 + 88p + 52\n$$\n整理成标准多项式形式：\n$$\np^4 - 30p^2 - 88p + 117 = 0\n$$\n我们寻找这个四次多项式的根。我们来测试简单的整数根。对于 $p=1$：\n$$\n(1)^4 - 30(1)^2 - 88(1) + 117 = 1 - 30 - 88 + 117 = 118 - 118 = 0\n$$\n所以，$p=1$ 是一个根。我们来检验它是否有效。它在要求的范围 $0 \\le 1 \\le \\sqrt{13}$ 内。我们必须在平方前的方程中进行验证：\n左边：$13-p^2 = 13 - 1^2 = 12$。\n右边：$2\\sqrt{p^2+22p+13} = 2\\sqrt{1^2+22(1)+13} = 2\\sqrt{1+22+13} = 2\\sqrt{36} = 2(6) = 12$。\n由于 $12=12$，所以 $p=1$ 是一个有效解。\n\n为检查其他解，我们将多项式 $p^4 - 30p^2 - 88p + 117$ 除以 $(p-1)$ 以得到三次因式：\n$$\n(p-1)(p^3 + p^2 - 29p - 117) = 0\n$$\n设 $g(p) = p^3 + p^2 - 29p - 117$。我们寻找其他实根。$g(p)$ 的分析表明它只有一个实根，该根位于 $p=6$ 和 $p=7$ 之间。任何大于 $\\sqrt{13} \\approx 3.606$ 的根都会违反条件 $13-p^2 \\ge 0$，因此是平方运算引入的增根。因此，不存在其他有效的物理解。\n\n唯一物理上可接受的压力是 $p=1$。", "answer": "$$\n\\boxed{1}\n$$", "id": "3496801"}, {"introduction": "理论推导是基础，但数值实现的稳健性决定了模拟的成败。上一个练习 ([@problem_id:3496801]) 中推导出的代数关系式，在数值求解时可以有多种不同的策略。这个动手编程练习 ([@problem_id:3496824]) 要求你实现两种不同的“守恒量到原始量”恢复算法，一种直接求解比焓 $h$，另一种直接求解压强 $p$。通过在超相对论喷流等极端物理场景下对这两种方法进行基准测试，你将亲身体验数值算法选择对计算相对论流体动力学模拟的准确性和鲁棒性的深刻影响。", "problem": "考虑在狭义相对论极限下的巴伦西亚(Valencia)表述中的广义相对论流体动力学(GRHD)系统，该系统具有闵可夫斯基度规、单位直减函数、零移位函数和笛卡尔空间度规。在光速为1的几何化单位制下进行计算。在一维空间中，巴伦西亚守恒变量由以下基本关系从原始变量定义：静止质量密度$\\,\\rho\\,$、流体三维速度$\\,v\\,$、压力$\\,p\\,$、比内能$\\,\\epsilon\\,$、洛伦兹因子$\\,W = 1/\\sqrt{1 - v^2}\\,$以及比焓$\\,h = 1 + \\epsilon + p/\\rho\\,$。守恒变量为$\\,D = \\rho W\\,$、$\\,S = \\rho h W^2 v\\,$和$\\,\\tau = \\rho h W^2 - p - D\\,$。假设采用伽马律状态方程(EOS)，即$\\,p = (\\Gamma - 1)\\rho \\epsilon\\,$，对于一个常数绝热指数$\\,\\Gamma\\,$，这意味着$\\,h = 1 + \\Gamma p / \\big((\\Gamma - 1)\\rho\\big)\\,$。\n\n您的任务是实现两种与这些基本关系一致的不同原始变量恢复算法：\n\n- 方法A（直接求解比焓$\\,h\\,$）：直接求解$\\,h\\,$作为主要未知数，通过守恒变量代数消去洛伦兹因子$\\,W\\,$，然后根据状态方程一致地恢复$\\,v\\,$、$\\,\\rho\\,$和$\\,p\\,$。此构造必须严格地从上述基本定义中推导得出。\n\n- 方法B（直接求解压力$\\,p\\,$）：仅使用基本定义求解$\\,p\\,$作为主要未知数，从一个守恒变量关系中获得$\\,v\\,$，然后通过状态方程恢复$\\,W\\,$、$\\,\\rho\\,$和$\\,h\\,$。\n\n对于这两种方法，您的算法必须能稳健地处理具有大洛伦兹因子$\\,W\\,$的超相对论情况。数值求解器必须强制物理可容许性，即$\\,p \\ge 0\\,$, $\\,\\rho \\ge 0\\,$和$\\,|v|  1\\,$。\n\n构建一个基准测试套件，代表撞击中子星壳的超相对论射流和一个硬物质边缘案例。对于每个测试，首先使用基本定义从给定的原始变量构建内部一致的守恒变量，然后用两种方法执行原始变量恢复。使用以下测试：\n\n- 测试$\\,1\\,$（超相对论射流，类辐射气体）：$\\,\\Gamma = 4/3\\,$, $\\,\\rho = 10^{-4}\\,$, $\\,v = 0.999\\,$, $\\,p = 10^{-2}\\,$。\n- 测试$\\,2\\,$（极端超相对论射流）：$\\,\\Gamma = 4/3\\,$, $\\,\\rho = 5 \\times 10^{-5}\\,$, $\\,v = 0.999999\\,$, $\\,p = 2\\times 10^{-2}\\,$。\n- 测试$\\,3\\,$（类壳硬物质）：$\\,\\Gamma = 2\\,$, $\\,\\rho = 10^{-1}\\,$, $\\,v = 10^{-1}\\,$, $\\,p = 10^{-3}\\,$。\n\n对于每个测试，使用以下度量计算两种方法在恢复的原始变量集合 $\\{\\rho, v, p, h\\}$ 上的最大相对差异\n$$\n\\Delta_{\\max} \\equiv \\max_{x \\in \\{\\rho, v, p, h\\}} \\frac{|x_A - x_B|}{\\max(|x_A|, |x_B|, 10^{-14})},\n$$\n其中下标$\\,A\\,$指方法A，$\\,B\\,$指方法B。\n\n所有量在几何化单位制下均为无量纲。您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，例如$\\,\\big[\\Delta_1,\\Delta_2,\\Delta_3\\big]\\,$，其中$\\,\\Delta_i\\,$是测试$\\,i\\,$的$\\,\\Delta_{\\max}\\,$值。输出必须是严格符合$\\,\\big[\\Delta_1,\\Delta_2,\\Delta_3\\big]\\,$形式的单行。不应打印任何其他文本。", "solution": "用户希望解决一个相对论流体动力学问题，具体关注巴伦西亚(Valencia)表述中从守恒变量到原始变量的转换。这是演化广义相对论流体动力学(GRHD)方程的数值程序中的关键一步。\n\n该问题设定在平坦时空背景下的狭义相对论这一简化情境中。\n\n### 问题验证\n\n首先，对问题陈述进行细致的验证。\n\n**第1步：提取给定条件**\n- **系统**：巴伦西亚(Valencia)表述中的广义相对论流体动力学(GRHD)，特化为狭义相对论(SR)极限。\n- **时空**：闵可夫斯基度规($\\eta_{\\mu\\nu}$)、单位直减函数($\\alpha=1$)、零移位矢量($\\beta^i=0$)和笛卡尔空间度规($\\gamma_{ij}=\\delta_{ij}$)。\n- **单位**：光速$c=1$的几何化单位制。\n- **原始变量**：静止质量密度$\\rho$、流体三维速度$v$和压力$p$。\n- **辅助变量**：洛伦兹因子$W = 1/\\sqrt{1 - v^2}$、比内能$\\epsilon$和比焓$h = 1 + \\epsilon + p/\\rho$。\n- **守恒变量**：\n  - $D = \\rho W$ (守恒静止质量密度)\n  - $S = \\rho h W^2 v$ (守恒动量密度)\n  - $\\tau = \\rho h W^2 - p - D$ (守恒总能量密度减去静止质量密度)\n- **状态方程(EOS)**：伽马律，$p = (\\Gamma - 1)\\rho \\epsilon$，这意味着关系式$h = 1 + \\frac{\\Gamma p}{(\\Gamma - 1)\\rho}$。\n- **任务**：实现两种不同的恢复算法：\n  - **方法A**：求解比焓$h$作为主要未知数。\n  - **方法B**：求解压力$p$作为主要未知数。\n- **物理可容许性**：解必须满足$\\rho \\ge 0$、 $p \\ge 0$和$|v|1$。\n- **基准测试**：\n  - 测试 1: $\\Gamma = 4/3, \\rho = 10^{-4}, v = 0.999, p = 10^{-2}$。\n  - 测试 2: $\\Gamma = 4/3, \\rho = 5 \\times 10^{-5}, v = 0.999999, p = 2\\times 10^{-2}$。\n  - 测试 3: $\\Gamma = 2, \\rho = 10^{-1}, v = 10^{-1}, p = 10^{-3}$。\n- **误差度量**：对于每个测试案例，计算方法A($x_A$)和方法B($x_B$)结果之间的最大相对差异：\n  $$ \\Delta_{\\max} \\equiv \\max_{x \\in \\{\\rho, v, p, h\\}} \\frac{|x_A - x_B|}{\\max(|x_A|, |x_B|, 10^{-14})} $$\n- **输出**：包含三个$\\Delta_{\\max}$值的单行逗号分隔列表，并用方括号括起来。\n\n**第2步：使用提取的给定条件进行验证**\n根据验证标准对问题进行评估。\n- **科学依据**：该问题是计算相对论天体物理学的核心，并基于标准且完善的SRHD巴伦西亚表述。所有定义和伽马律状态方程都是该领域的标准。\n- **适定性**：已知对于伽马律状态方程，关联守恒变量与原始变量的方程组存在唯一的物理有理解。该问题要求实现两种标准的数值方法来找到这个解。\n- **客观性**：问题以精确的数学术语陈述，没有主观或含糊的语言。\n- **结论**：该问题在科学上是合理的、适定的、完整的并且是可形式化的。没有矛盾、事实错误或不可行的要求。\n\n**第3步：判断与行动**\n该问题是**有效的**。将着手开发一个解决方案。\n\n### 恢复算法的推导\n\n任务的核心是为原始变量恢复推导并实现两个单变量求根问题。\n\n**方法A：求解比焓($h$)**\n\n目标是仅使用守恒变量$D, S, \\tau$和常数$\\Gamma$找到一个关于$h$的方程。\n\n1.  从$D$和$S$的定义出发，我们可以用$h$和$W$表示速度$v$：\n    $$ \\frac{S}{D} = \\frac{\\rho h W^2 v}{\\rho W} = h W v \\implies v = \\frac{S}{D h W} $$\n2.  将此代入洛伦兹因子定义，$W^{-2} = 1 - v^2$：\n    $$ W^{-2} = 1 - \\frac{S^2}{D^2 h^2 W^2} \\implies 1 = W^2 - \\frac{S^2}{D^2 h^2} $$\n    这产生了一个$W$和$h$之间的关键关系：\n    $$ W^2 = 1 + \\frac{S^2}{D^2 h^2} $$\n3.  接下来，使用$\\tau$的定义。为消去$p$，我们使用状态方程关系$h-1 = \\frac{\\Gamma p}{(\\Gamma-1)\\rho}$，得到$p = \\frac{(\\Gamma-1)\\rho(h-1)}{\\Gamma}$。\n    $$ \\tau = \\rho h W^2 - p - D = \\rho h W^2 - \\frac{(\\Gamma-1)\\rho(h-1)}{\\Gamma} - D $$\n4.  代入$\\rho = D/W$：\n    $$ \\tau = \\frac{D}{W} h W^2 - \\frac{(\\Gamma-1)D(h-1)}{\\Gamma W} - D = D h W - \\frac{D(\\Gamma-1)(h-1)}{\\Gamma W} - D $$\n5.  重排方程：\n    $$ \\frac{\\tau+D}{D} = h W - \\frac{(\\Gamma-1)(h-1)}{\\Gamma W} $$\n6.  两边乘以$W$以消去分母，并代入步骤2中得到的$W^2$的表达式：\n    $$ \\frac{(\\tau+D)W}{D} = h W^2 - \\frac{\\Gamma-1}{\\Gamma}(h-1) = h \\left(1 + \\frac{S^2}{D^2 h^2}\\right) - \\frac{\\Gamma-1}{\\Gamma}(h-1) $$\n    $$ \\frac{(\\tau+D)W}{D} = h + \\frac{S^2}{D^2 h} - \\frac{\\Gamma-1}{\\Gamma}(h-1) $$\n7.  为消去左侧剩余的$W$，我们将两边平方并再次代入$W^2$：\n    $$ \\frac{(\\tau+D)^2}{D^2} W^2 = \\left( h + \\frac{S^2}{D^2 h} - \\frac{\\Gamma-1}{\\Gamma}(h-1) \\right)^2 $$\n    $$ \\frac{(\\tau+D)^2}{D^2} \\left(1 + \\frac{S^2}{D^2 h^2}\\right) = \\left( \\frac{h}{\\Gamma} + \\frac{S^2}{D^2 h} + \\frac{\\Gamma-1}{\\Gamma} \\right)^2 $$\n8.  这产生一个非线性代数方程$f(h)=0$。设$j^2=(S/D)^2$和$Y=(\\tau+D)/D$。该方程为：\n    $$ f(h) = \\left( \\frac{h}{\\Gamma} + \\frac{j^2}{h} + \\frac{\\Gamma-1}{\\Gamma} \\right)^2 - Y^2\\left(1 + \\frac{j^2}{h^2}\\right) = 0 $$\n    这个方程可以使用数值求根器求解$h \\ge 1$。一旦找到$h$，其他原始变量可按如下方式恢复：$W = \\sqrt{1+j^2/h^2}$, $\\rho=D/W$, $v=S/(DhW)$以及$p=\\rho(h-1)(\\Gamma-1)/\\Gamma$。\n\n**方法B：求解压力($p$)**\n\n目标是找到一个关于$p$的方程。\n\n1.  通过组合$S$和$\\tau$的定义，可以找到一个关于$v$的关键关系：\n    $$ \\tau+p+D = \\rho h W^2 \\implies S = (\\tau+p+D)v \\implies v = \\frac{S}{\\tau+p+D} $$\n2.  由此，我们用$p$来表示$W$和$W^2$：\n    $$ W = \\frac{1}{\\sqrt{1-v^2}} = \\frac{\\tau+p+D}{\\sqrt{(\\tau+p+D)^2 - S^2}} $$\n    $$ W^2 = \\frac{(\\tau+p+D)^2}{(\\tau+p+D)^2 - S^2} $$\n3.  我们从方法A步骤4中推导出的关系开始，但这次我们消去$\\rho$和$h$：\n    $$ (\\tau+D) = D h W - \\frac{\\Gamma-1}{\\Gamma}\\frac{D(h-1)}{W} $$\n    方程$\\rho h W^2 = \\tau+p+D$更直接。使用$h = 1 + \\frac{\\Gamma p}{(\\Gamma-1)\\rho}$：\n    $$ \\rho \\left(1 + \\frac{\\Gamma p}{(\\Gamma-1)\\rho}\\right) W^2 = \\tau+p+D \\implies \\left(\\rho + \\frac{\\Gamma p}{\\Gamma-1}\\right)W^2 = \\tau+p+D $$\n4.  代入$\\rho=D/W$：\n    $$ \\left(\\frac{D}{W} + \\frac{\\Gamma p}{\\Gamma-1}\\right)W^2 = \\tau+p+D \\implies D W + \\frac{\\Gamma p}{\\Gamma-1} W^2 = \\tau+p+D $$\n5.  设$A = \\tau+D$。方程变为：$DW + \\frac{\\Gamma p}{\\Gamma-1}W^2 = A+p$。现在，我们代入步骤2中$W$和$W^2$的表达式：\n    $$ D \\frac{A+p}{\\sqrt{(A+p)^2-S^2}} + \\frac{\\Gamma p}{\\Gamma-1} \\frac{(A+p)^2}{(A+p)^2-S^2} = A+p $$\n    对于任何物理速度$|v|1$，我们有$(A+p)^2 > S^2$，因此我们可以除以因子$(A+p)$（对于非平凡的$p$, $A$）。或者更直接地，重排以形成一个求根问题$f(p)=0$：\n    $$ f(p) = (A+p)^2 - S^2 - \\frac{\\Gamma p(A+p)}{\\Gamma-1} - D\\sqrt{(A+p)^2 - S^2} = 0 $$\n    这个方程可以使用数值求根器求解$p \\ge 0$（且$A+p>|S|$）。一旦$p$已知，其他原始变量为：$v=S/(A+p)$, $W=1/\\sqrt{1-v^2}$, $\\rho=D/W$以及$h=1+\\Gamma p/((\\Gamma-1)\\rho)$。\n\n### 实现策略\n\n需要一个数值求根算法。`scipy.optimize.root_scalar`函数与Brent方法(`brentq`)是一个稳健的选择，前提是可以建立一个根的包围区间$[a, b]$（其中$f(a)$和$f(b)$异号）。\n- 对于方法A（$h$-求解器），物理定义域是$h \\in [1, \\infty)$。我们可以证明$f_h(1) \\le 0$且$f_h(h \\to \\infty) > 0$，因此像$[1, 10^{12}]$这样的区间是安全的。\n- 对于方法B（$p$-求解器），物理定义域要求$p \\ge 0$且$\\tau+D+p > |S|$。因此最小压力为$p_{\\min} = \\max(0, |S|-(\\tau+D))$。我们可以证明$f_p(p_{\\min}) \\ge 0$且$f_p(p \\to \\infty)  0$。因此，像$[p_{\\min}+\\epsilon, \\tau+D+|S|]$这样的区间是合适的。\n- 两种方法都将被实现，并且对于每个测试案例，首先从给定的原始变量计算守恒变量。然后，应用两种恢复方法，并计算它们输出之间的最大相对差异。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import root_scalar\n\ndef compute_conserved_variables(gamma, rho, v, p):\n    \"\"\"\n    Computes conserved variables (D, S, tau) from given primitive variables.\n    All quantities are dimensionless in geometrized units (c=1).\n    \"\"\"\n    if rho  0 or p  0 or abs(v) >= 1:\n        raise ValueError(\"Invalid primitive variables: non-physical values.\")\n    \n    # Handle the rho=0 case explicitly to avoid division by zero.\n    if rho == 0.0:\n        return 0.0, 0.0, 0.0\n    \n    W = 1.0 / np.sqrt(1.0 - v**2)\n    epsilon = p / ((gamma - 1.0) * rho)\n    h = 1.0 + epsilon + p / rho\n    \n    D = rho * W\n    S = rho * h * W**2 * v\n    # This definition of tau is standard\n    tau = rho * h * W**2 - p - D\n    \n    return D, S, tau\n\ndef recover_primitives_A(D, S, tau, gamma):\n    \"\"\"\n    Recovers primitive variables using Method A (solving for specific enthalpy h).\n    \"\"\"\n    # Handle the vacuum case where D is numerically zero.\n    if D  1e-16:\n        return 0.0, 0.0, 0.0, 1.0\n\n    j_sq = (S / D)**2\n    Y = (tau + D) / D\n\n    def f_h(h):\n        # The equation f(h)=0 to be solved.\n        # Derived from the Valencia SRHD equations and gamma-law EOS.\n        if h  1.0:\n            # Physical domain for specific enthalpy is h >= 1.\n            h = 1.0\n        \n        term1 = h / gamma + j_sq / h + (gamma - 1.0) / gamma\n        term2 = Y**2 * (1.0 + j_sq / h**2)\n        return term1**2 - term2\n    \n    # Find the root for h. Based on analysis, the root is bracketed.\n    # f(1) = 0 and f(h->inf) > 0.\n    h_min_bracket = 1.0\n    h_max_bracket = 1e12  # A sufficiently large number.\n    \n    try:\n        sol = root_scalar(f_h, bracket=[h_min_bracket, h_max_bracket], method='brentq')\n        h = sol.root\n    except ValueError:\n        return np.nan, np.nan, np.nan, np.nan\n\n    # Recover other primitives from h\n    W_sq = 1.0 + j_sq / h**2\n    W = np.sqrt(W_sq)\n    v = S / (D * h * W)\n    rho = D / W\n    p = rho * (h - 1.0) * (gamma - 1.0) / gamma\n\n    return rho, v, p, h\n\n\ndef recover_primitives_B(D, S, tau, gamma):\n    \"\"\"\n    Recovers primitive variables using Method B (solving for pressure p).\n    \"\"\"\n    # Handle the vacuum case.\n    if D  1e-16:\n        return 0.0, 0.0, 0.0, 1.0\n        \n    A = tau + D\n    S_sq = S**2\n\n    # Physicality requires (A+p)^2 > S^2 and p >= 0.\n    p_min = max(0.0, abs(S) - A)\n    \n    def f_p(p):\n        # The equation f(p)=0 to be solved.\n        if p  p_min:\n            p = p_min\n        \n        Ap = A + p\n        X = Ap**2 - S_sq\n\n        # This should not be triggered if p is in the valid domain.\n        if X  0.0:\n            return np.inf  # Return a large number to guide solver\n            \n        sqrt_X = np.sqrt(X)\n        \n        # f(p) = X - (gamma*p*Ap)/(gamma-1) - D*sqrt(X)\n        term1 = X\n        term2 = (gamma * p * Ap) / (gamma - 1.0)\n        term3 = D * sqrt_X\n        \n        return term1 - term2 - term3\n\n    # Find the root for p. Analysis shows f(p_min) >= 0 and f(p->inf)  0.\n    # Add a small epsilon to the lower bound for safety with the solver.\n    p_min_bracket = p_min * (1.0 + 1e-10) + 1e-14\n    # Heuristic but safely large upper bound.\n    p_max_bracket = tau + D + abs(S)\n    \n    try:\n        sol = root_scalar(f_p, bracket=[p_min_bracket, p_max_bracket], method='brentq')\n        p = sol.root\n    except ValueError:\n        return np.nan, np.nan, np.nan, np.nan\n\n    # Recover other primitives from p\n    v = S / (A + p)\n    W = 1.0 / np.sqrt(1.0 - v**2)\n    rho = D / W\n    \n    if rho > 1e-16:\n        h = 1.0 + p * gamma / ((gamma - 1.0) * rho)\n    else:\n        h = 1.0\n\n    return rho, v, p, h\n\ndef solve():\n    \"\"\"\n    Main function to run test cases and produce the final output.\n    \"\"\"\n    test_cases = [\n        # Test 1 (ultra-relativistic jet, radiation-like gas)\n        {\"gamma\": 4.0/3.0, \"rho\": 1e-4, \"v\": 0.999, \"p\": 1e-2},\n        # Test 2 (extremely ultra-relativistic jet)\n        {\"gamma\": 4.0/3.0, \"rho\": 5e-5, \"v\": 0.999999, \"p\": 2e-2},\n        # Test 3 (stiff crust-like matter)\n        {\"gamma\": 2.0, \"rho\": 1e-1, \"v\": 1e-1, \"p\": 1e-3},\n    ]\n\n    delta_max_results = []\n    \n    for case in test_cases:\n        # 1. Compute conserved variables from the initial primitives.\n        D, S, tau = compute_conserved_variables(case[\"gamma\"], case[\"rho\"], case[\"v\"], case[\"p\"])\n        \n        # 2. Recover primitives using both methods.\n        prims_A = recover_primitives_A(D, S, tau, case[\"gamma\"])\n        prims_B = recover_primitives_B(D, S, tau, case[\"gamma\"])\n        \n        # Unpack for comparison\n        rho_A, v_A, p_A, h_A = prims_A\n        rho_B, v_B, p_B, h_B = prims_B\n        \n        primitives_set_A = {'rho': rho_A, 'v': v_A, 'p': p_A, 'h': h_A}\n        primitives_set_B = {'rho': rho_B, 'v': v_B, 'p': p_B, 'h': h_B}\n\n        # 3. Compute the maximum relative difference.\n        max_rel_diff = 0.0\n        floor = 1e-14\n        \n        for key in primitives_set_A.keys():\n            xA = primitives_set_A[key]\n            xB = primitives_set_B[key]\n            \n            diff = abs(xA - xB)\n            # Use a floor in the denominator for robustness against small numbers\n            norm = max(abs(xA), abs(xB), floor)\n            rel_diff = diff / norm\n            \n            if rel_diff > max_rel_diff:\n                max_rel_diff = rel_diff\n        \n        delta_max_results.append(max_rel_diff)\n\n    # 4. Print the final results in the specified format. The default string representation\n    # of a float will be used.\n    print(f\"[{','.join(map(str, delta_max_results))}]\")\n\n# Execute the solution\nsolve()\n\n```", "id": "3496824"}, {"introduction": "将巴伦西亚表述从平直时空推广到弯曲时空，我们必须考虑时空几何本身对数值演化的影响。演化方程中的传输速度取决于时空的 $3+1$ 分解，特别是直减函数 $\\alpha$ 和移位矢量 $\\beta^i$。这个高级练习 ([@problem_id:3496811]) 探讨了一个在黑洞模拟中至关重要的问题：在史瓦西坐标这类导致 $\\alpha \\to 0$ 的坐标系中，朴素的CFL条件会如何失效，以及如何通过坐标变换的思想，设计一个基于物理速度的、在视界附近依然稳健的有效时间步长。", "problem": "考虑在时空的 $3+1$ 分解下的广义相对论流体动力学 (GRHD) 巴伦西亚格式，其线元可写作 $$ds^2 = -\\alpha^2 dt^2 + \\gamma_{ij}\\left(dx^i + \\beta^i dt\\right)\\left(dx^j + \\beta^j dt\\right),$$ 其中 $\\alpha$ 是 lapse 函数，$\\beta^i$ 是 shift 向量，$\\gamma_{ij}$ 是空间度规。巴伦西亚格式演化守恒量，其通量依赖于输运速度 $\\tilde{v}^i = \\alpha v^i - \\beta^i$，其中 $v^i$ 是由正常观测者测量的欧拉三维速度。在对角空间度规中，定义速度的正交归一（物理）分量为 $v_{\\hat{i}} = \\sqrt{\\gamma_{ii}}\\, v^i$（对 $i$ 不求和）。\n\n在类史瓦西切片中，靠近黑洞视界时，lapse 函数 $\\alpha$ 会坍缩到 $0$，而在穿透视界的坐标系（如 Painlevé–Gullstrand 坐标）中，lapse 函数可以保持有限值。如果时间步长仅基于坐标特征速度，这将对 Courant–Friedrichs–Lewy (CFL) 稳定性构成数值挑战。你的任务是从第一性原理出发，完成以下步骤：\n\n1. 从 $3+1$ 分解和欧拉观测者的定义出发，推导沿单一空间方向 $i$ 的巴伦西亚通量的坐标输运速度，用 $\\alpha$、$\\beta^i$ 和 $v_{\\hat{i}}$ 表示。\n2. 展示坐标输运速度与在正交归一参考系中测量的物理速度之间的关系，并推导一个重标定方法，以得到一个基于物理分量 $v_{\\hat{i}}$ 而非坐标分量 $v^i$ 的有效输运速度，使得有效 CFL 条件由物理速度决定。你的重标定必须通过映射到穿透视界的坐标系并证明其在该坐标系下的等价性来加以证明。\n3. 特化到球对称时空和纯径向流。提供以下坐标系的度规系数：\n   - 史瓦西坐标，其质量参数为 $M$，径向坐标为 $r$，lapse 函数为 $\\alpha = \\sqrt{1 - 2M/r}$，shift 向量为零即 $\\beta^r = 0$，空间度规分量为 $\\gamma_{rr} = 1/\\left(1 - 2M/r\\right)$；\n   - Painlevé–Gullstrand 坐标，其 $\\alpha = 1$，径向 shift 为 $\\beta^r = \\sqrt{2M/r}$，且 $\\gamma_{rr} = 1$。\n4. 设径向数值网格的均匀间距为 $\\Delta r$，坐标时间步长的 CFL 限制形式为 $$\\Delta t_{\\mathrm{coord}} \\le \\mathcal{C}\\,\\frac{\\Delta r}{\\max |\\lambda|},$$ 其中 $\\mathcal{C}$ 是 Courant 因子，$\\lambda$ 是沿 $r$ 方向的坐标输运速度。使用你的重标定方法，定义一个有效物理输运速度以及相应的基于物理速度的有效 CFL 时间步长 $\\Delta t_{\\mathrm{phys}}$。你必须用 $\\alpha$、$\\beta^r$、$\\gamma_{rr}$ 和 $v_{\\hat{r}}$ 表示所有步骤和量。\n5. 实现一个程序，对下述每个测试案例，计算 $\\Delta t_{\\mathrm{coord}}$ 和 $\\Delta t_{\\mathrm{phys}}$，并返回比率 $\\Delta t_{\\mathrm{phys}} / \\Delta t_{\\mathrm{coord}}$。\n\n使用无量纲几何单位制，其中 $G = c = M = 1$，因此所有长度和时间都以 $M$ 为单位表示。不涉及角度。你的最终程序必须以浮点数形式产生结果。不允许使用百分比。\n\n测试套件：\n- 案例 1：史瓦西切片，位于 $r = 2.1$，$v_{\\hat{r}} = 0.5$，$\\Delta r = 0.01$，$\\mathcal{C} = 0.4$。\n- 案例 2：史瓦西切片，位于 $r = 2.01$，$v_{\\hat{r}} = 0.5$，$\\Delta r = 0.01$，$\\mathcal{C} = 0.4$。\n- 案例 3：史瓦西切片，位于 $r = 10.0$，$v_{\\hat{r}} = 0.5$，$\\Delta r = 0.01$，$\\mathcal{C} = 0.4$。\n- 案例 4：Painlevé–Gullstrand 切片，位于 $r = 2.01$，$v_{\\hat{r}} = 0.5$，$\\Delta r = 0.01$，$\\mathcal{C} = 0.4$。\n- 案例 5：Painlevé–Gullstrand 切片，位于 $r = 5.0$，$v_{\\hat{r}} = 0.0$，$\\Delta r = 0.01$，$\\mathcal{C} = 0.4$。\n\n最终输出格式：\n你的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，$[result1,result2,result3]$），其中每个 $result$ 是对应测试案例的浮点数比率 $\\Delta t_{\\mathrm{phys}} / \\Delta t_{\\mathrm{coord}}$，顺序与上面给定的一致。", "solution": "该问题要求分析在强引力场中，特别是黑洞视界附近，广义相对论流体动力学 (GRHD) 的巴伦西亚格式的 Courant–Friedrichs–Lewy (CFL) 稳定性条件。核心任务是对比一个基于坐标相关输运速度的朴素 CFL 条件与一个基于有效物理速度的更稳健的条件，并量化它们之间的差异。\n\n作为初步步骤，我们必须验证问题的陈述。该问题基于标准时空 $3+1$ 分解和巴伦西亚格式，正确地指明了 lapse 函数 $\\alpha$、shift 向量 $\\beta^i$ 和空间度规 $\\gamma_{ij}$。输运速度 $\\tilde{v}^i = \\alpha v^i - \\beta^i$ 和正交归一速度分量 $v_{\\hat{i}} = \\sqrt{\\gamma_{ii}} v^i$ 的定义是标准的。提供的史瓦西坐标和 Painlevé–Gullstrand 坐标的度规分量是正确的。核心问题——在史瓦西坐标中，lapse 函数 $\\alpha$ 在视界附近坍缩及其对朴素 CFL 条件的有害影响——是数值相对论中一个众所周知的挑战。该问题做了一个显著的简化，没有在特征速度计算中明确包含声速 $c_s$，而只关注流体的平流输运。这隔离了坐标系对时间步长的几何效应，而这正是所要测试的主要概念点。鉴于这一焦点，该问题在其指定范围内是适定的、自洽的，并且在科学上是合理的。\n\n我们现在按照问题中概述的步骤进行求解。对于所有计算，我们使用几何单位制，其中 $G=c=M=1$。\n\n**1. 坐标输运速度的推导**\n\n巴伦西亚格式演化守恒量，其通量是输运速度 $\\tilde{v}^i$ 的函数。该双曲系统的特征速度与 $\\tilde{v}^i$ 相关。对于这个问题，我们考虑特征谱的平流部分，它由输运速度本身给出。这就是我们记为 $\\lambda_{\\text{coord}}$ 的“坐标输运速度”。该问题将沿空间方向 $i$ 的输运速度定义为：\n$$ \\tilde{v}^i = \\alpha v^i - \\beta^i $$\n此处，$v^i$ 是欧拉三维速度。该问题还通过以下关系定义了对角空间度规下速度的物理（正交归一）分量 $v_{\\hat{i}}$：\n$$ v_{\\hat{i}} = \\sqrt{\\gamma_{ii}} \\, v^i \\quad (\\text{对 } i \\text{ 不求和}) $$\n我们可以用物理速度分量 $v_{\\hat{i}}$ 来表示坐标速度分量 $v^i$：\n$$ v^i = \\frac{v_{\\hat{i}}}{\\sqrt{\\gamma_{ii}}} $$\n将此代入输运速度的定义，我们得到用 $\\alpha$、$\\beta^i$、$\\gamma_{ii}$ 和 $v_{\\hat{i}}$ 表示的巴伦西亚通量的坐标输运速度：\n$$ \\lambda_{\\text{coord}}^{(i)} = \\alpha \\frac{v_{\\hat{i}}}{\\sqrt{\\gamma_{ii}}} - \\beta^i $$\n在本分析的其余部分，我们特化到纯径向流，因此我们只关心分量 $i=r$。\n$$ \\lambda_{\\text{coord}} \\equiv \\lambda_{\\text{coord}}^{(r)} = \\alpha \\frac{v_{\\hat{r}}}{\\sqrt{\\gamma_{rr}}} - \\beta^r $$\n\n**2. 有效物理输运速度及重标定的推导**\n\nCFL 条件根据网格间距 $\\Delta r$ 和最大坐标速度 $|\\lambda|$ 来限制时间步长 $\\Delta t$：\n$$ \\Delta t_{\\mathrm{coord}} \\le \\mathcal{C} \\frac{\\Delta r}{\\max|\\lambda_{\\text{coord}}|} $$\n其中 $\\mathcal{C}$ 是 Courant 因子。我们来分析一下 $\\lambda_{\\text{coord}}$ 在指定坐标系中的行为。\n\n在史瓦西坐标中，我们有 $\\beta^r = 0$，$\\alpha = \\sqrt{1 - 2M/r}$，以及 $\\gamma_{rr} = 1/(1 - 2M/r)$。设 $M=1$，则：\n$$ \\alpha = \\sqrt{1 - 2/r}, \\quad \\beta^r = 0, \\quad \\gamma_{rr} = \\frac{1}{1 - 2/r} = \\frac{1}{\\alpha^2} $$\n坐标输运速度为：\n$$ \\lambda_{\\text{coord, Schw}} = \\alpha \\frac{v_{\\hat{r}}}{\\sqrt{1/\\alpha^2}} - 0 = \\alpha^2 v_{\\hat{r}} = \\left(1 - \\frac{2}{r}\\right) v_{\\hat{r}} $$\n当径向坐标 $r$ 接近位于 $r=2M=2$ 的事件视界时，lapse 函数 $\\alpha \\to 0$ 且 $\\lambda_{\\text{coord, Schw}} \\to 0$。这意味着 $\\Delta t_{\\mathrm{coord}}$ 将变得任意大，这在数值上是不稳定的，在物理上也是不正确的，因为流体可以以显著的物理速度 $v_{\\hat{r}}$ 运动。\n\n为了修正这个问题，我们需要一个保持良好行为的“有效物理输运速度” $\\lambda_{\\text{phys-eff}}$。该问题建议我们可以通过考虑一个穿透视界的坐标系，例如 Painlevé–Gullstrand (PG) 坐标，来找到它。在 PG 坐标中（$M=1$）：\n$$ \\alpha = 1, \\quad \\beta^r = \\sqrt{2/r}, \\quad \\gamma_{rr} = 1 $$\n在 PG 坐标中的坐标输运速度是：\n$$ \\lambda_{\\text{coord, PG}} = (1) \\frac{v_{\\hat{r}}}{\\sqrt{1}} - \\sqrt{2/r} = v_{\\hat{r}} - \\beta^r $$\n这个表达式在视界处是良好行为的。例如，在 $r=2$ 处，$\\lambda_{\\text{coord, PG}} = v_{\\hat{r}} - 1$。由于有质量粒子的物理速度 $|v_{\\hat{r}}|$ 必须小于 1，所以这个分母永远不会为零。\n\n$\\lambda_{\\text{coord, PG}}$ 具有良好行为这一事实，启发我们将有效物理输运速度 $\\lambda_{\\text{phys-eff}}$ 定义为此量，但以适用于任何切片的通用形式表示。我们提出有效物理速度的以下定义：\n$$ \\lambda_{\\text{phys-eff}} = v_{\\hat{r}} - \\beta^r $$\n这个选择是合理的，因为在“良好”的 PG 坐标中，它与坐标输运速度 $\\lambda_{\\text{coord, PG}}$ 是相同的。因此，“重标定”就是用 1 替换 $\\lambda_{\\text{coord}}$ 通用表达式中有问题的因子 $\\alpha/\\sqrt{\\gamma_{rr}}$。这有效地从 CFL 计算中移除了由坐标奇异性引起的病态问题。\n\n**3. 时间步长定义与最终比率**\n\n现在我们有两个不同的输运速度定义可用于 CFL 条件。\n\n朴素的坐标时间步长 $\\Delta t_{\\mathrm{coord}}$ 基于 $\\lambda_{\\text{coord}}$：\n$$ \\Delta t_{\\mathrm{coord}} = \\mathcal{C} \\frac{\\Delta r}{|\\lambda_{\\text{coord}}|} = \\mathcal{C} \\frac{\\Delta r}{\\left|\\alpha \\frac{v_{\\hat{r}}}{\\sqrt{\\gamma_{rr}}} - \\beta^r\\right|} $$\n\n有效物理时间步长 $\\Delta t_{\\mathrm{phys}}$ 基于我们推导的 $\\lambda_{\\text{phys-eff}}$：\n$$ \\Delta t_{\\mathrm{phys}} = \\mathcal{C} \\frac{\\Delta r}{|\\lambda_{\\text{phys-eff}}|} = \\mathcal{C} \\frac{\\Delta r}{|v_{\\hat{r}} - \\beta^r|} $$\n\n问题要求计算比率 $\\Delta t_{\\mathrm{phys}} / \\Delta t_{\\mathrm{coord}}$。它由下式给出：\n$$ \\frac{\\Delta t_{\\mathrm{phys}}}{\\Delta t_{\\mathrm{coord}}} = \\frac{\\mathcal{C} \\frac{\\Delta r}{|v_{\\hat{r}} - \\beta^r|}}{\\mathcal{C} \\frac{\\Delta r}{\\left|\\alpha \\frac{v_{\\hat{r}}}{\\sqrt{\\gamma_{rr}}} - \\beta^r\\right|}} = \\frac{\\left|\\alpha \\frac{v_{\\hat{r}}}{\\sqrt{\\gamma_{rr}}} - \\beta^r\\right|}{|v_{\\hat{r}} - \\beta^r|} $$\n\n**4. 测试案例的计算**\n\n现在我们将此公式应用于所提供的测试案例，并设 $M=1$。\n\n*   **对于史瓦西切片**：$\\beta^r = 0$，$\\alpha = \\sqrt{1-2/r}$，$\\sqrt{\\gamma_{rr}} = 1/\\alpha$。项 $\\alpha/\\sqrt{\\gamma_{rr}} = \\alpha^2 = 1-2/r$。\n    该比率简化为：\n    $$ \\frac{|(1-2/r)v_{\\hat{r}} - 0|}{|v_{\\hat{r}} - 0|} = \\frac{|(1-2/r)v_{\\hat{r}}|}{|v_{\\hat{r}}|} = 1 - \\frac{2}{r} $$\n    （假设 $r>2$ 且 $v_{\\hat{r}} \\ne 0$）。\n\n    *   **案例 1**：$r=2.1$。比率 = $1 - 2/2.1 = 1/2.1 \\approx 0.47619047619$。\n    *   **案例 2**：$r=2.01$。比率 = $1 - 2/2.01 = 0.01/2.01 \\approx 0.004975124378$。\n    *   **案例 3**：$r=10.0$。比率 = $1 - 2/10.0 = 0.8$。\n\n*   **对于 Painlevé–Gullstrand 切片**：$\\alpha=1$，$\\gamma_{rr}=1$。\n    该比率为：\n    $$ \\frac{\\left|1 \\cdot \\frac{v_{\\hat{r}}}{\\sqrt{1}} - \\beta^r\\right|}{|v_{\\hat{r}} - \\beta^r|} = \\frac{|v_{\\hat{r}} - \\beta^r|}{|v_{\\hat{r}} - \\beta^r|} = 1 $$\n\n    *   **案例 4**：$r=2.01$。比率 = $1.0$。\n    *   **案例 5**：$r=5.0$。比率 = $1.0$。\n\n这些计算证实，有效物理时间步长修正了史瓦西坐标中基于坐标的时间步长的病态问题，尤其是在事件视界附近，同时在行为良好的 Painlevé–Gullstrand 坐标系中与之等价。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the ratio of the effective physical CFL timestep to the naive coordinate\n    CFL timestep for several test cases in GRHD.\n    \"\"\"\n\n    # Test suite format: (slicing_type, r, v_hat_r, delta_r, C)\n    # The parameters delta_r and C are not needed for the ratio calculation\n    # but are included for completeness based on the problem description.\n    test_cases = [\n        (\"schwarzschild\", 2.1, 0.5, 0.01, 0.4),\n        (\"schwarzschild\", 2.01, 0.5, 0.01, 0.4),\n        (\"schwarzschild\", 10.0, 0.5, 0.01, 0.4),\n        (\"painleve-gullstrand\", 2.01, 0.5, 0.01, 0.4),\n        (\"painleve-gullstrand\", 5.0, 0.0, 0.01, 0.4),\n    ]\n\n    results = []\n    \n    # Set geometric units G = c = M = 1\n    M = 1.0\n\n    for case in test_cases:\n        slicing, r, v_hat_r, _, _ = case\n\n        # Initialize metric components\n        alpha, beta_r, gamma_rr = 0.0, 0.0, 0.0\n\n        if slicing == \"schwarzschild\":\n            # Schwarzschild metric components in geometric units (M=1)\n            # Ensure r > 2M to avoid division by zero or sqrt of negative\n            if r = 2 * M:\n                raise ValueError(\"Radial coordinate r must be outside the event horizon for Schwarzschild.\")\n            \n            alpha = np.sqrt(1 - 2 * M / r)\n            beta_r = 0.0\n            gamma_rr = 1.0 / (1 - 2 * M / r)\n\n        elif slicing == \"painleve-gullstrand\":\n            # Painlevé-Gullstrand metric components in geometric units (M=1)\n            alpha = 1.0\n            beta_r = np.sqrt(2 * M / r)\n            gamma_rr = 1.0\n        \n        else:\n            raise ValueError(f\"Unknown slicing type: {slicing}\")\n            \n        # Denominator of the ratio: |lambda_phys-eff| = |v_hat_r - beta_r|\n        # This is the magnitude of the effective physical transport speed.\n        # Handle the case where v_hat_r = beta_r to avoid division by zero.\n        # In the given test cases, this condition is not met where it matters.\n        # If v_hat_r is 0.0, both numerator and denominator can be zero in Schw.\n        # The limit of the ratio should be taken. For Schw, ratio is independent of v_hat_r.\n        # For PG, if v_hat_r = beta_r, the timestep is infinite for both methods. The ratio is indeterminate (0/0).\n        # We assume for such physical edge cases, the ratio would be defined as 1.\n        \n        denominator_speed = v_hat_r - beta_r\n\n        # Numerator of the ratio: |lambda_coord| = |alpha * v_hat_r / sqrt(gamma_rr) - beta_r|\n        # This is the magnitude of the naive coordinate transport speed.\n        numerator_speed = alpha * v_hat_r / np.sqrt(gamma_rr) - beta_r\n        \n        # Calculate the ratio.\n        # If the effective physical speed is zero, it implies the fluid is stationary\n        # with respect to the \"river of space\", making the coordinate transport speed\n        # also zero. The ratio is ill-defined (0/0), but physically it means both\n        # timesteps are infinite, so their ratio can be taken as 1.\n        if abs(denominator_speed)  1e-15:\n            # Check if numerator is also zero\n            if abs(numerator_speed)  1e-15:\n                ratio = 1.0\n            else:\n                # This case (non-zero numerator, zero denominator) shouldn't occur\n                # with the chosen definitions but is handled for robustness.\n                ratio = np.inf\n        else:\n            ratio = abs(numerator_speed / denominator_speed)\n            \n        results.append(ratio)\n\n    # Format the final output as specified\n    print(f\"[{','.join(f'{res:.12f}'.rstrip('0').rstrip('.') for res in results)}]\")\n\nsolve()\n```", "id": "3496811"}]}