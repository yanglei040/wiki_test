{"hands_on_practices": [{"introduction": "符号回归的第一步是构建一个候选函数库，这个库的质量直接决定了模型发现的成败。一个精心设计的库应该包含所有潜在的机理项，但同时也要避免函数之间的冗余或高度相关性，因为这会导致模型参数难以辨识，使得回归结果不稳定且难以解释。本实践将指导你如何诊断和处理库中的冗余问题，这是确保后续稀疏回归算法（如SINDy）能够得出可靠和可解释模型的关键预处理步骤 ([@problem_id:3353792])。", "problem": "非线性动力学的稀疏辨识 (SINDy) 旨在通过将测量的时间导数回归到候选基函数的库上，来寻找简约的机理模型。考虑一个单状态系统，其状态为 $x(t)$，在 $N=5$ 个时间点进行测量，观测值为 $x=\\{0,1,2,3,4\\}$。一个候选库由三个基函数 $\\phi_1(x)=1$、$\\phi_2(x)=x$ 和 $\\phi_3(x)=1+0.99\\,x$ 构建，生成了 $N\\times 3$ 的库矩阵 $\\Theta=[\\theta_1\\,\\,\\theta_2\\,\\,\\theta_3]$，其列是求值结果\n$\\theta_1=[1,1,1,1,1]^\\top$、$\\theta_2=[0,1,2,3,4]^\\top$ 和 $\\theta_3=[1.00,1.99,2.98,3.97,4.96]^\\top$。\n假设在回归之前，我们用欧几里得 ($\\ell_2$) 范数对列进行归一化。\n\n稀疏回归中两个标准的可辨识性度量是：\n- 互相关性 $\\mu(\\Theta)$，对于归一化库定义为 $\\mu(\\Theta)=\\max_{i\\neq j}\\left|\\langle \\theta_i,\\theta_j\\rangle\\right|$，其中 $\\langle \\cdot,\\cdot\\rangle$ 表示欧几里得内积。高 $\\mu(\\Theta)$ 会增加稀疏解非唯一性的风险。\n- 格拉姆 (Gram) 矩阵 $G=\\Theta^\\top\\Theta$ 的条件数 $\\kappa(G)$，定义为 $\\kappa(G)=\\lambda_{\\max}(G)/\\lambda_{\\min}(G)$，其中 $\\lambda_{\\max}$ 和 $\\lambda_{\\min}$ 是最大和最小特征值。大的 $\\kappa(G)$ 表示病态问题和对噪声的敏感性。\n\n你被告知，由于实验设计和噪声，你的可辨识性控制策略是在应用最小绝对收缩和选择算子 (LASSO) 进行稀疏估计之前，强制执行 $\\mu(\\Theta)\\le \\tau$（阈值 $\\tau=0.95$）和 $\\kappa(G)\\le \\kappa_{\\max}$（$\\kappa_{\\max}=50$）。你还采用了一个机理可解释性先验：在拆分高度相关的函数对时，优先保留基本基函数（例如 $\\phi_1(x)=1$ 和 $\\phi_2(x)=x$），而不是复合混合函数（例如 $\\phi_3(x)=1+0.99\\,x$），除非这样做会违反可辨识性策略。\n\n基于第一性原理和所提供的数据，分析将 $\\phi_3$ 包含在 SINDy 库中所带来的可辨识性影响，并选择在遵守机理可解释性的同时，最能强制执行可辨识性策略的剪枝策略。\n\n哪个选项是正确的？\n\nA. 归一化 $\\Theta$；计算成对内积以获得 $\\mu(\\Theta)$。由于函数对 $\\{\\phi_2,\\phi_3\\}$ 的互相关性超过 $\\tau=0.95$，剪枝 $\\phi_3$（复合混合函数）。剪枝后，剩余的库 $\\{\\phi_1,\\phi_2\\}$ 同时满足 $\\mu(\\Theta)\\le 0.95$ 和 $\\kappa(G)\\le 50$，并且该选择遵守了机理可解释性先验。\n\nB. 保留所有三个基函数，并依靠最小绝对收缩和选择算子 (LASSO) 正则化来解决冗余问题；当使用 $\\ell_1$ 惩罚时，高互相关性不会从根本上影响可辨识性。\n\nC. 剪枝 $\\phi_2$ 而不是 $\\phi_3$，因为函数对 $\\{\\phi_1,\\phi_3\\}$ 产生的 $\\mu(\\Theta)\\le 0.95$ 且 $\\kappa(G)\\le 50$；在可辨识性策略下，复合混合函数是基本基函数的可接受替代品。\n\nD. 不进行剪枝；而是对库进行格拉姆-施密特 (Gram–Schmidt) 正交化，将互相关性降至 $0$ 并将条件数减小到一个小值，从而在不改变回归中考虑的基函数集的情况下强制执行可辨识性策略。", "solution": "### 问题分析与已知条件\n- **系统**：一个具有状态 $x(t)$ 的单状态系统。\n- **数据**：在 $N=5$ 个时间点测量的状态，值为 $x=\\{0, 1, 2, 3, 4\\}$。\n- **基函数**：$\\phi_1(x)=1$, $\\phi_2(x)=x$, $\\phi_3(x)=1+0.99\\,x$。\n- **库矩阵**：$\\Theta=[\\theta_1\\,\\,\\theta_2\\,\\,\\theta_3]$，其中各列是在测量点处对基函数的求值。\n  - $\\theta_1=[1,1,1,1,1]^\\top$\n  - $\\theta_2=[0,1,2,3,4]^\\top$\n  - $\\theta_3=[1.00,1.99,2.98,3.97,4.96]^\\top$\n- **归一化**：在回归和分析之前，$\\Theta$ 的列将通过其欧几里得 ($\\ell_2$) 范数进行归一化。\n- **可辨识性度量与策略**：\n  - 归一化库的互相关性，$\\mu(\\Theta)=\\max_{i\\neq j}\\left|\\langle \\hat{\\theta}_i,\\hat{\\theta}_j\\rangle\\right|$，必须 $\\le \\tau=0.95$。\n  - 格拉姆矩阵 $G=\\Theta^\\top\\Theta$ 的条件数，$\\kappa(G)=\\lambda_{\\max}(G)/\\lambda_{\\min}(G)$，必须 $\\le \\kappa_{\\max}=50$。（这将针对归一化库进行计算，这是标准做法，并且问题陈述中也暗含了这一点）。\n- **可解释性先验**：在解决高相关性问题时，优先保留基本基函数（如 $\\phi_1, \\phi_2$）而非复合函数（如 $\\phi_3$），除非这样做会违反可辨识性策略。\n\n### 推导\n\n核心任务是评估给定库 $\\{\\phi_1, \\phi_2, \\phi_3\\}$ 的可辨识性，并应用所述的剪枝策略。这需要计算归一化库的互相关性 $\\mu(\\Theta)$ 和条件数 $\\kappa(G)$。\n\n**1. 库列的归一化**\n\n首先，我们计算每个列向量 $\\theta_i$ 的 $\\ell_2$-范数。\n- 对于 $\\theta_1 = [1, 1, 1, 1, 1]^\\top$:\n$$||\\theta_1||_2 = \\sqrt{1^2 + 1^2 + 1^2 + 1^2 + 1^2} = \\sqrt{5}$$\n- 对于 $\\theta_2 = [0, 1, 2, 3, 4]^\\top$:\n$$||\\theta_2||_2 = \\sqrt{0^2 + 1^2 + 2^2 + 3^2 + 4^2} = \\sqrt{0+1+4+9+16} = \\sqrt{30}$$\n- 对于 $\\theta_3 = [1.00, 1.99, 2.98, 3.97, 4.96]^\\top$:\n我们注意到 $\\phi_3(x) = 1 + 0.99x$，这意味着 $\\theta_3 = \\theta_1 + 0.99\\,\\theta_2$。我们可以这样计算范数：\n$$||\\theta_3||_2^2 = ||\\theta_1 + 0.99\\,\\theta_2||_2^2 = \\langle \\theta_1 + 0.99\\,\\theta_2, \\theta_1 + 0.99\\,\\theta_2 \\rangle$$\n$$||\\theta_3||_2^2 = ||\\theta_1||_2^2 + 2(0.99)\\langle \\theta_1, \\theta_2 \\rangle + (0.99)^2||\\theta_2||_2^2$$\n我们需要内积 $\\langle \\theta_1, \\theta_2 \\rangle$：\n$$\\langle \\theta_1, \\theta_2 \\rangle = 1(0) + 1(1) + 1(2) + 1(3) + 1(4) = 10$$\n代入数值：\n$$||\\theta_3||_2^2 = 5 + 2(0.99)(10) + (0.99)^2(30) = 5 + 19.8 + (0.9801)(30) = 24.8 + 29.403 = 54.203$$\n$$||\\theta_3||_2 = \\sqrt{54.203} \\approx 7.362$$\n归一化后的列向量为 $\\hat{\\theta}_i = \\theta_i / ||\\theta_i||_2$。\n\n**2. 计算完整库的互相关性**\n\n互相关性需要归一化向量的成对内积。这些是归一化库 $\\hat{\\Theta} = [\\hat{\\theta}_1, \\hat{\\theta}_2, \\hat{\\theta}_3]$ 的格拉姆矩阵 $G = \\hat{\\Theta}^\\top \\hat{\\Theta}$ 的非对角线元素。\n\n- $G_{12} = \\langle \\hat{\\theta}_1, \\hat{\\theta}_2 \\rangle = \\frac{\\langle \\theta_1, \\theta_2 \\rangle}{||\\theta_1||_2 ||\\theta_2||_2} = \\frac{10}{\\sqrt{5}\\sqrt{30}} = \\frac{10}{\\sqrt{150}} = \\frac{10}{5\\sqrt{6}} = \\frac{2}{\\sqrt{6}} \\approx 0.8165$\n- $G_{13} = \\langle \\hat{\\theta}_1, \\hat{\\theta}_3 \\rangle = \\frac{\\langle \\theta_1, \\theta_3 \\rangle}{||\\theta_1||_2 ||\\theta_3||_2}$。首先，$\\langle \\theta_1, \\theta_3 \\rangle = \\langle \\theta_1, \\theta_1 + 0.99\\,\\theta_2 \\rangle = ||\\theta_1||_2^2 + 0.99\\langle \\theta_1, \\theta_2 \\rangle = 5 + 0.99(10) = 14.9$。\n$$G_{13} = \\frac{14.9}{\\sqrt{5}\\sqrt{54.203}} \\approx \\frac{14.9}{2.236 \\times 7.362} \\approx \\frac{14.9}{16.46} \\approx 0.9052$$\n- $G_{23} = \\langle \\hat{\\theta}_2, \\hat{\\theta}_3 \\rangle = \\frac{\\langle \\theta_2, \\theta_3 \\rangle}{||\\theta_2||_2 ||\\theta_3||_2}$。首先，$\\langle \\theta_2, \\theta_3 \\rangle = \\langle \\theta_2, \\theta_1 \\rangle + 0.99||\\theta_2||_2^2 = 10 + 0.99(30) = 39.7$。\n$$G_{23} = \\frac{39.7}{\\sqrt{30}\\sqrt{54.203}} \\approx \\frac{39.7}{5.477 \\times 7.362} \\approx \\frac{39.7}{40.32} \\approx 0.9846$$\n\n互相关性是最大的非对角线元素绝对值：\n$$\\mu(\\Theta) = \\max(|G_{12}|, |G_{13}|, |G_{23}|) = \\max(0.8165, 0.9052, 0.9846) = 0.9846$$\n该值超过了策略阈值 $\\tau=0.95$。因此，完整的库是不可接受的。问题最严重的一对是 $\\{\\phi_2, \\phi_3\\}$。\n\n**3. 计算完整库的条件数**\n\n基函数是线性相关的：$\\phi_3(x) = \\phi_1(x) + 0.99\\,\\phi_2(x)$。这意味着库矩阵 $\\Theta$ 的列也是线性相关的：$\\theta_3 = \\theta_1 + 0.99\\,\\theta_2$。矩阵 $\\Theta$ 的秩为 $2$，而不是 $3$。因此，格拉姆矩阵 $G = \\Theta^\\top\\Theta$（无论是由归一化还是未归一化的列构成）也将是秩亏的（秩为 $2$）。对于一个 $3 \\times 3$ 矩阵，这意味着它的一个特征值必须为零。\n$\\lambda_{\\min}(G) = 0$。\n条件数为 $\\kappa(G) = \\lambda_{\\max}(G) / \\lambda_{\\min}(G) = \\lambda_{\\max}(G) / 0$，即无穷大。无穷大的条件数远远超过了策略阈值 $\\kappa_{\\max}=50$。\n完整的库未能通过两项可辨识性检查。必须进行剪枝。\n\n**4. 评估剪枝策略**\n\n问题的根源在于包含了 $\\phi_3$，它是 $\\phi_1$ 和 $\\phi_2$ 的复合函数。可解释性先验建议剪枝 $\\phi_3$ 并保留基本函数 $\\phi_1$ 和 $\\phi_2$，前提是这样做满足可辨识性策略。\n\n**策略 1：剪枝 $\\phi_3$。保留 $\\{\\phi_1, \\phi_2\\}$。**\n- **新库**：$\\Theta' = [\\theta_1, \\theta_2]$。\n- **互相关性**：唯一的值是 $|\\langle \\hat{\\theta}_1, \\hat{\\theta}_2 \\rangle| = |G_{12}| \\approx 0.8165$。由于 $0.8165 \\le 0.95$，相关性策略得到满足。\n- **条件数**：新的格拉姆(Gram)矩阵是一个 $2 \\times 2$ 矩阵：\n$$G' = \\begin{pmatrix} 1 & G_{12} \\\\ G_{12} & 1 \\end{pmatrix} = \\begin{pmatrix} 1 & 0.8165 \\\\ 0.8165 & 1 \\end{pmatrix}$$\n这样一个矩阵的特征值是 $\\lambda = 1 \\pm |G_{12}|$。\n$$\\lambda_{\\max} = 1 + 0.8165 = 1.8165$$\n$$\\lambda_{\\min} = 1 - 0.8165 = 0.1835$$\n条件数为：\n$$\\kappa(G') = \\frac{\\lambda_{\\max}}{\\lambda_{\\min}} = \\frac{1.8165}{0.1835} \\approx 9.899$$\n由于 $9.899 \\le 50$，条件数策略也得到满足。\n- **可解释性先验**：此策略移除了复合函数，遵守了先验。\n此策略完全符合所有规则。\n\n**策略 2：剪枝 $\\phi_2$。保留 $\\{\\phi_1, \\phi_3\\}$。**\n只有在策略 1 失败时才会考虑此策略。\n- **新库**：$\\Theta'' = [\\theta_1, \\theta_3]$。\n- **互相关性**：值为 $|\\langle \\hat{\\theta}_1, \\hat{\\theta}_3 \\rangle| = |G_{13}| \\approx 0.9052$。由于 $0.9052 \\le 0.95$，相关性策略得到满足。\n- **条件数**：特征值为 $1 \\pm |G_{13}|$。\n$$\\kappa(G'') = \\frac{1+|G_{13}|}{1-|G_{13}|} \\approx \\frac{1+0.9052}{1-0.9052} = \\frac{1.9052}{0.0948} \\approx 20.097$$\n由于 $20.097 \\le 50$，条件数策略得到满足。\n- **可解释性先验**：此策略在数值上是有效的，但违反了先验。先验规定优先选择基本函数，除非该路径被阻断。由于策略 1（保留基本函数）有效，没有理由选择这条路径。\n\n基于此分析，正确的做法是剪枝 $\\phi_3$。\n\n### 逐项分析\n\n**A. 归一化 $\\Theta$；计算成对内积以获得 $\\mu(\\Theta)$。由于函数对 $\\{\\phi_2,\\phi_3\\}$ 的互相关性超过 $\\tau=0.95$，剪枝 $\\phi_3$（复合混合函数）。剪枝后，剩余的库 $\\{\\phi_1,\\phi_2\\}$ 同时满足 $\\mu(\\Theta)\\le 0.95$ 和 $\\kappa(G)\\le 50$，并且该选择遵守了机理可解释性先验。**\n该选项正确地遵循了上面推导的整个逻辑链。它正确地识别出问题对 $\\{\\phi_2,\\phi_3\\}$ 的相关性约为 $0.9846 > 0.95$。它引用了可解释性先验来剪枝复合函数 $\\phi_3$。它正确地指出，所得到的库 $\\{\\phi_1,\\phi_2\\}$ 同时满足相关性策略（$\\mu \\approx 0.8165 \\le 0.95$）和条件数策略（$\\kappa \\approx 9.9 \\le 50$）。\n**结论：正确。**\n\n**B. 保留所有三个基函数，并依靠最小绝对收缩和选择算子(LASSO)正则化来解决冗余问题；当使用 $\\ell_1$ 惩罚时，高互相关性不会从根本上影响可辨识性。**\n该选项包含一个错误的前提。虽然 LASSO 是稀疏回归的强大工具，但其理论保证和实际性能在存在高度相关变量（高互相关性）时会严重下降。在这种情况下，LASSO 可能会在一组相关变量中任意选择一个，导致模型不稳定且不可解释。此外，该选项忽略了问题中给出的明确策略，该策略要求在应用 LASSO *之前* 进行预处理以确保 $\\mu(\\Theta) \\le 0.95$ 和 $\\kappa(G) \\le 50$。我们的分析表明，完整的库违反了此策略。\n**结论：错误。**\n\n**C. 剪枝 $\\phi_2$ 而不是 $\\phi_3$，因为函数对 $\\{\\phi_1,\\phi_3\\}$ 产生的 $\\mu(\\Theta)\\le 0.95$ 且 $\\kappa(G)\\le 50$；在可辨识性策略下，复合混合函数是基本基函数的可接受替代品。**\n我们对“策略 2”的分析证实，剪枝 $\\phi_2$ 确实会得到一个满足数值可辨识性阈值的库。然而，该选项忽略了“机理可解释性先验”。该先验规定我们优先保留基本函数而不是复合函数，*除非* 这样做会违反策略。由于保留基本函数 $\\{\\phi_1, \\phi_2\\}$（通过剪枝 $\\phi_3$）是一个满足所有策略的有效解决方案，因此根据既定规则，没有理由选择这个可解释性较差的选项。\n**结论：错误。**\n\n**D. 不进行剪枝；而是对库进行格拉姆-施密特(Gram–Schmidt)正交化，将互相关性降至 $0$ 并将条件数减小到一个小值，从而在不改变回归中考虑的基函数集的情况下强制执行可辨识性策略。**\n在机理模型发现的背景下，这是一个不合适的解决方案。格拉姆-施密特正交化将原始的、可解释的基函数（如 $\\phi_1(x)=1$, $\\phi_2(x)=x$）替换为新的正交函数，这些函数是原始函数的线性组合（例如 $q_2(x) = a\\phi_2(x) + b\\phi_1(x)$）。虽然这解决了相关性和条件数的数值问题，但它破坏了模型系数的机理可解释性。SINDy 的目标是找到一个在*原始*候选函数方面稀疏的模型。该选项从根本上误解了该方法的目的以及可解释性先验的重要性。\n**结论：错误。**", "answer": "$$\\boxed{A}$$", "id": "3353792"}, {"introduction": "构建了一个良好的候选库之后，下一步是利用实验数据来评估和比较其中包含的不同机理假设。本实践将演示如何在严谨的贝叶斯框架下完成这一任务，这超越了简单的曲线拟合，因为它通过计算边缘似然（marginal likelihood）来量化整个模型家族的证据，从而自然地惩罚了模型复杂度，并允许我们融入先验的生物学知识 ([@problem_id:3353773])。通过这个编码挑战，你将实现一个完整的贝叶斯模型选择流程，以确定最能解释模拟基因激活数据的调控函数。", "problem": "实现一个完整的、可运行的程序，该程序使用贝叶斯先验对机制性基因激活模型进行符号回归（SR），以根据模拟的时间序列数据推断候选表达族的后验概率。其机制基础是在无量纲设定下的常微分方程 $dx/dt = f(S) - \\gamma x$，其中 $x$ 是无量纲的基因产物水平，$S$ 是无量纲的输入信号，$\\gamma$ 是一个正的降解速率常数。该程序必须枚举一个包含候选调控表达式 $f(S)$ 的小语法，为离散的 Hill 指数和连续的生化参数分配具有科学依据的先验，通过对参数进行边缘化来计算表达族的贝叶斯后验，然后报告在多个测试案例中分配给真实生成族的后验概率。所有数学实体必须在下方以 LaTeX 格式书写。\n\n推导必须从以下基础开始：\n- 基因调控动力学模型 $dx/dt = f(S) - \\gamma x$，其中 $\\gamma > 0$。\n- 生物化学中使用的典型激活和抑制 Hill 函数：\n  - Hill 激活：$f_{\\mathrm{HA}}(S;V,K,n) = \\dfrac{V S^n}{K^n + S^n}$。\n  - Hill 抑制：$f_{\\mathrm{HR}}(S;V,K,n) = \\dfrac{V K^n}{K^n + S^n}$。\n  - 线性质量作用激活：$f_{\\mathrm{LM}}(S;k) = k S$。\n- 使用贝叶斯定理进行贝叶斯模型选择：$p(M \\mid D) \\propto p(D \\mid M) \\, p(M)$，其中 $M$ 是一个模型族，$D$ 是观测数据。边缘似然为 $p(D \\mid M) = \\int p(D \\mid \\theta, M) \\, p(\\theta \\mid M) \\, d\\theta$，其中 $\\theta$ 是模型参数。\n\n您必须实现边缘似然的一个有限、确定性的近似，方法是（通过参数对数上的均匀网格）对在机制模型下模拟观测的高斯似然进行积分，同时对 Hill 指数 $n$ 编码有信息的先验。程序必须按以下步骤进行：\n- 要枚举的候选表达族：\n  1. Hill 激活族：$f_{\\mathrm{HA}}(S;V,K,n)$，其中 Hill 指数 $n \\in \\{1,2,3,4\\}$。\n  2. Hill 抑制族：$f_{\\mathrm{HR}}(S;V,K,n)$，其中 Hill 指数 $n \\in \\{1,2,3,4\\}$。\n  3. 线性质量作用激活族：$f_{\\mathrm{LM}}(S;k)$。\n- 结构先验：$p(M)$ 在三个族上是均匀的，每个族的 $p(M) = 1/3$。\n- Hill 指数先验：$p(n=1) = 0.4$，$p(n=2) = 0.3$，$p(n=3) = 0.2$，$p(n=4) = 0.1$。\n- 参数先验（均为无量纲）：\n  - 对于 Hill 族，$V$ 和 $K$ 分别在 $[V_{\\min},V_{\\max}]$ 和 $[K_{\\min},K_{\\max}]$ 上具有对数均匀先验，其中 $V_{\\min} = 0.3$，$V_{\\max} = 3.0$，$K_{\\min} = 0.2$，$K_{\\max} = 2.0$。\n  - 对于线性质量作用，$k$ 在 $[k_{\\min},k_{\\max}]$ 上具有对数均匀先验，其中 $k_{\\min} = 0.2$，$k_{\\max} = 2.0$。\n- 数值边缘化：\n  - 对 Hill 族（对于 $V$ 和 $K$）使用对数空间中均匀的网格，点数为 $N_V = 6$ 和 $N_K = 6$；对线性质量作用族（对于 $k$）使用点数为 $N_k = 6$ 的网格。将网格点视为对数均匀先验下的等权重样本，因此边缘似然近似为网格上似然的均值。\n- 似然模型：\n  - 观测值被模拟为带噪声的时间序列 $x_{\\mathrm{obs}}(t_i) = x_{\\mathrm{true}}(t_i) + \\varepsilon_i$，其中 $\\varepsilon_i \\sim \\mathcal{N}(0,\\sigma_x^2)$ 是独立高斯噪声，$\\sigma_x$ 对每个测试案例已知。给定参数 $\\theta$ 和族 $M$，预测轨迹 $x_{\\theta,M}(t)$ 解算 $dx/dt = f_M(S(t);\\theta) - \\gamma x$；似然为\n    $$\\log p(D \\mid \\theta, M) = \\sum_{i=1}^{N} \\left[ -\\dfrac{\\left(x_{\\mathrm{obs}}(t_i) - x_{\\theta,M}(t_i)\\right)^2}{2\\sigma_x^2} - \\dfrac{1}{2}\\log\\left(2\\pi\\sigma_x^2\\right) \\right].$$\n  - 对于动力学的数值积分，在 $N$ 个点上使用步长为 $\\Delta t$ 的稳定的前向欧拉离散化：\n    $$x_{i+1} = x_i + \\Delta t \\left( f_M(S(t_i);\\theta) - \\gamma x_i \\right), \\quad x_0 \\text{ 给定.}$$\n- 族的后验：\n  - 对于每个族 $M$，通过在对数空间网格上对 $p(D \\mid \\theta, M)$ 进行平均来计算边缘似然 $p(D \\mid M)$；对于 Hill 族，分别为每个 $n$ 计算平均值以得到 $p(D \\mid n, M)$，然后与 $p(n)$ 结合以得到 $p(D \\mid M) = \\sum_{n} p(n) \\, p(D \\mid n, M)$。\n  - 与均匀结构先验结合，以获得归一化后验 $p(M \\mid D) = \\dfrac{p(D \\mid M) p(M)}{\\sum_{M'} p(D \\mid M') p(M')}$。\n\n测试套件规范（所有量均为无量纲）：\n- 时间离散化使用在 $[0,T]$ 上均匀分布的 $N$ 个点，$\\Delta t = T/(N-1)$。每个案例指定初始条件 $x_0$。\n- 为每个案例定义输入信号 $S(t)$：\n  1. 案例 A（顺利路径 Hill 激活）：$T = 20$，$N = 201$，当 $t  5$ 时 $S(t) = 0$，当 $t \\ge 5$ 时 $S(t) = 1$，$\\gamma = 0.7$，$\\sigma_x = 0.05$，$x_0 = 0.0$。真实生成模型：Hill 激活，参数为 $V = 1.5, K = 0.5, n = 2$。\n  2. 案例 B（边界低指数）：$T = 15$，$N = 151$，$S(t) = \\min\\left(2 \\, t / T, 2\\right)$，$\\gamma = 1.0$，$\\sigma_x = 0.08$，$x_0 = 0.0$。真实生成模型：Hill 激活，参数为 $V = 1.0, K = 1.0, n = 1$。\n  3. 案例 C（高阶跃下的抑制）：$T = 18$，$N = 181$，当 $t  3$ 时 $S(t) = 0.2$，当 $t \\ge 3$ 时 $S(t) = 2.0$，$\\gamma = 0.6$，$\\sigma_x = 0.05$。真实生成模型：Hill 抑制，参数为 $V = 2.0, K = 0.3, n = 3$。使用 $x_0 = f_{\\mathrm{HR}}(0.2;V,K,n)/\\gamma$ 以在阶跃前从接近稳态开始。\n  4. 案例 D（正弦输入下的线性质量作用）：$T = 20$，$N = 201$，$S(t) = 0.5\\left[\\sin\\left(6\\pi t/T\\right) + 1\\right]$，$\\gamma = 0.5$，$\\sigma_x = 0.03$，$x_0 = 0.0$。真实生成模型：线性质量作用，参数为 $k = 0.8$。\n\n实现要求：\n- 使用前向欧拉方案从真实生成模型为每个案例模拟 $x_{\\mathrm{true}}(t)$，然后添加独立高斯噪声 $\\mathcal{N}(0,\\sigma_x^2)$ 以获得 $x_{\\mathrm{obs}}(t)$。\n- 对于推断，遵循上述贝叶斯边缘化方法，为每个候选族 $M \\in \\{\\mathrm{HA}, \\mathrm{HR}, \\mathrm{LM}\\}$ 计算 $p(M \\mid D)$，使用指定的对数空间网格：\n  - Hill 族：$V \\in [0.3,3.0]$ 和 $K \\in [0.2,2.0]$，每个都有 $N_V = N_K = 6$ 个对数间隔值，以及 $n \\in \\{1,2,3,4\\}$，使用给定的先验。\n  - 线性质量作用族：$k \\in [0.2,2.0]$，有 $N_k = 6$ 个对数间隔值。\n- 程序的最终输出必须是一行，包含一个由方括号括起来的逗号分隔列表，其中包含四个数字，每个测试案例一个，按顺序代表为案例 A、B、C 和 D 的真实生成族分配的后验概率。例如，输出格式应精确地像 $[p_A,p_B,p_C,p_D]$，其中每个 $p_\\bullet$ 是标准十进制表示的浮点数。\n\n所有变量都是无量纲的；不需要物理单位转换。正弦输入中的角度以弧度为单位。程序必须是确定性的和自包含的，不需要外部输入或文件，并且必须只使用指定的运行时环境库。", "solution": "该问题要求实现一个贝叶斯模型选择框架，以便在给定模拟时间序列数据的情况下，从一组预定义的候选函数中发现最可能的基因调控函数。此任务是一种由机制原理指导的符号回归形式，是计算系统生物学中的一个常见问题。解决方案涉及从已知模型中模拟数据，然后使用贝叶斯推断来计算每个候选模型族的后验概率，最终报告分配给真实生成族的概率。\n\n分析的核心是控制基因产物浓度 $x$ 的无量纲常微分方程（ODE）：\n$$\n\\frac{dx}{dt} = f(S) - \\gamma x\n$$\n这里，$x(t)$ 代表随时间变化的基因产物水平，$S(t)$ 是一个输入信号，$\\gamma$ 是一阶降解速率常数（$\\gamma  0$），而 $f(S)$ 是生产速率函数，它依赖于信号 $S$。目标是从一个离散的候选库中确定 $f(S)$ 最合理的函数形式。\n\n$f(S)$ 的候选函数是标准的生化模型：\n1.  **Hill 激活 (HA)**: $f_{\\mathrm{HA}}(S;V,K,n) = \\dfrac{V S^n}{K^n + S^n}$。此函数描述了一个协同激活过程，其中 $V$ 是最大生产速率，$K$ 是激活常数（半最大激活时的信号水平），$n$ 是 Hill 指数，用于量化协同性。HA 的模型族由 $n \\in \\{1, 2, 3, 4\\}$ 的子模型组成。\n2.  **Hill 抑制 (HR)**: $f_{\\mathrm{HR}}(S;V,K,n) = \\dfrac{V K^n}{K^n + S^n}$。此函数描述了协同抑制。参数 $V$、$K$ 和 $n$ 具有类似的解释。HR 的模型族也包括 $n \\in \\{1, 2, 3, 4\\}$ 的子模型。\n3.  **线性质量作用 (LM)**: $f_{\\mathrm{LM}}(S;k) = k S$。这是最简单的模型，代表信号和生产速率之间非饱和的、直接成比例的关系，其中 $k$ 是速率常数。\n\n模型选择在贝叶斯框架内进行。根据贝叶斯定理，给定观测数据 $D$ 的模型族 $M$ 的后验概率，与该模型下数据的边缘似然和模型的先验概率的乘积成正比：\n$$\np(M \\mid D) \\propto p(D \\mid M) \\, p(M)\n$$\n术语 $p(M)$ 是结构先验，它反映了对每个模型族似然性的任何现有信念。该问题指定了一个均匀的结构先验，即对于三个族（HA、HR、LM）中的每一个，$p(M) = 1/3$，表示没有初始偏好。\n\n需要计算的关键量是边缘似然，或称为证据，$p(D \\mid M)$。它是通过对模型参数 $\\theta$ 的所有可能值积分似然 $p(D \\mid \\theta, M)$，并由其先验分布 $p(\\theta \\mid M)$ 加权得到的：\n$$\np(D \\mid M) = \\int p(D \\mid \\theta, M) \\, p(\\theta \\mid M) \\, d\\theta\n$$\n似然函数 $p(D \\mid \\theta, M)$ 量化了具有特定参数 $\\theta$ 的模型解释数据的优劣程度。数据 $D$ 由离散时间点的观测值 $x_{\\mathrm{obs}}(t_i)$ 组成，这些观测值被假定为真实轨迹 $x_{\\theta,M}(t_i)$ 加上独立的 高斯噪声：$x_{\\mathrm{obs}}(t_i) = x_{\\theta,M}(t_i) + \\varepsilon_i$，其中 $\\varepsilon_i \\sim \\mathcal{N}(0, \\sigma_x^2)$。整个时间序列的对数似然为：\n$$\n\\log p(D \\mid \\theta, M) = \\sum_{i=1}^{N} \\left[ -\\dfrac{\\left(x_{\\mathrm{obs}}(t_i) - x_{\\theta,M}(t_i)\\right)^2}{2\\sigma_x^2} - \\dfrac{1}{2}\\log\\left(2\\pi\\sigma_x^2\\right) \\right]\n$$\n参数的先验分布指定如下：\n- 对于 Hill 族，$V$ 和 $K$ 分别在 $[0.3, 3.0]$ 和 $[0.2, 2.0]$ 上具有对数均匀先验。\n- 对于 LM 族，$k$ 在 $[0.2, 2.0]$ 上具有对数均匀先验。\n- 对于 Hill 族，指数 $n$ 具有指定的离散先验：$p(n=1)=0.4$，$p(n=2)=0.3$，$p(n=3)=0.2$ 和 $p(n=4)=0.1$。\n\n算法实现过程如下：\n首先，对于每个测试案例，通过使用前向欧拉方案 $x_{i+1} = x_i + \\Delta t (f(S(t_i)) - \\gamma x_i)$ 解算真实模型的 ODE 来生成合成数据 $x_{\\mathrm{obs}}$，并添加具有指定标准差 $\\sigma_x$ 的高斯噪声。\n\n其次，对每个候选族的边缘似然进行数值近似。积分被替换为在参数值的离散网格上的求和。问题指定使用在对数空间中对参数 $V$、$K$ 和 $k$ 均匀的网格（点数为 $N_V=6, N_K=6, N_k=6$），这将边缘化简化为网格点上似然的算术平均值。这种简化等同于一种蒙特卡洛近似，其中网格点被视为来自对数均匀先验的样本。为避免在将对数似然转换回似然进行平均时出现数值下溢，使用了一种数值稳定的方法：\n$$\np(D \\mid M) \\approx \\frac{1}{N_{\\text{grid}}} \\sum_{j} p(D \\mid \\theta_j, M) = \\frac{1}{N_{\\text{grid}}} \\exp(\\ell_{\\max}) \\sum_{j} \\exp(\\log p(D \\mid \\theta_j, M) - \\ell_{\\max})\n$$\n其中 $\\ell_{\\max}$ 是网格上的最大对数似然值。\n\n对于具有离散参数 $n$ 的 Hill 族（HA 和 HR），边缘化是一个两步过程。首先，对于 $n \\in \\{1, 2, 3, 4\\}$ 的每个值，通过在 $(V, K)$ 网格上平均来计算边缘似然 $p(D \\mid n, M)$。然后，使用关于 $n$ 的先验，将该族的总边缘似然计算为加权和：\n$$\np(D \\mid M_{\\text{Hill}}) = \\sum_{n \\in \\{1,2,3,4\\}} p(n) \\, p(D \\mid n, M_{\\text{Hill}})\n$$\n\n最后，在计算出三个族的边缘似然（证据）$E_{HA}, E_{HR}, E_{LM}$ 后，通过归一化找到后验概率。由于结构先验 $p(M)$ 是均匀的，它会抵消掉，因此一个族 $M$ 的后验就是其证据除以总证据：\n$$\np(M \\mid D) = \\frac{E_M}{E_{HA} + E_{HR} + E_{LM}}\n$$\n对于每个测试案例，算法计算这些后验，并报告与实际生成数据的族相对应的值。此过程为每个候选调控机制提供了一个定量的、有原则的置信度度量。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements Symbolic Regression with Bayesian priors to infer gene activation models.\n    \"\"\"\n    # Set a deterministic seed for noise generation as required by the problem.\n    RNG = np.random.default_rng(seed=0)\n\n    # --- Define candidate model functions ---\n    def f_ha(S, V, K, n):\n        \"\"\"Hill activation function.\"\"\"\n        # Add a small epsilon to prevent division by zero in edge cases.\n        S_n = S**n\n        K_n = K**n\n        return (V * S_n) / (K_n + S_n + 1e-12)\n\n    def f_hr(S, V, K, n):\n        \"\"\"Hill repression function.\"\"\"\n        S_n = S**n\n        K_n = K**n\n        return (V * K_n) / (K_n + S_n + 1e-12)\n\n    def f_lm(S, k):\n        \"\"\"Linear mass-action function.\"\"\"\n        return k * S\n\n    # --- Define ODE solver ---\n    def euler_solver(f_prod_func, s_signal, gamma, x0, t_points, params):\n        \"\"\"Solves dx/dt = f(S) - gamma*x using forward Euler.\"\"\"\n        dt = t_points[1] - t_points[0]\n        n_points = len(t_points)\n        x = np.zeros(n_points)\n        x[0] = x0\n        for i in range(n_points - 1):\n            production = f_prod_func(s_signal[i], **params)\n            degradation = gamma * x[i]\n            x[i+1] = x[i] + dt * (production - degradation)\n        return x\n\n    # --- Define Likelihood and Evidence functions ---\n    def log_likelihood(x_obs, x_pred, sigma_x):\n        \"\"\"Computes the log-likelihood of observations given a prediction.\"\"\"\n        n_obs = len(x_obs)\n        sse = np.sum((x_obs - x_pred)**2)\n        log_lik = -0.5 * n_obs * np.log(2 * np.pi * sigma_x**2) - sse / (2 * sigma_x**2)\n        return log_lik\n\n    def average_likelihood_from_logs(log_likelihoods):\n        \"\"\"Calculates the mean of likelihoods from a list of log-likelihoods stably.\"\"\"\n        if not log_likelihoods:\n            return 0.0\n        log_lik_array = np.array(log_likelihoods)\n        max_log_lik = np.max(log_lik_array)\n        \n        # If all log-likelihoods are very small, the likelihoods are effectively zero.\n        if max_log_lik  -700:\n            return 0.0\n        \n        # Use log-sum-exp trick for the sum, then average.\n        sum_of_likelihoods = np.sum(np.exp(log_lik_array - max_log_lik))\n        avg_lik = np.exp(max_log_lik) * sum_of_likelihoods / len(log_likelihoods)\n        return avg_lik\n\n    # --- Define test cases from problem statement ---\n    test_cases = [\n        # Case A: Hill activation\n        {'T': 20.0, 'N': 201, 'S_func': lambda t: np.where(t  5.0, 0.0, 1.0), 'gamma': 0.7, 'sigma_x': 0.05, 'x0': 0.0,\n         'true_model': {'type': 'HA', 'params': {'V': 1.5, 'K': 0.5, 'n': 2.0}, 'func': f_ha}},\n        # Case B: Hill activation, low exponent\n        {'T': 15.0, 'N': 151, 'S_func': lambda t: np.minimum(2.0 * t / 15.0, 2.0), 'gamma': 1.0, 'sigma_x': 0.08, 'x0': 0.0,\n         'true_model': {'type': 'HA', 'params': {'V': 1.0, 'K': 1.0, 'n': 1.0}, 'func': f_ha}},\n        # Case C: Hill repression\n        {'T': 18.0, 'N': 181, 'S_func': lambda t: np.where(t  3.0, 0.2, 2.0), 'gamma': 0.6, 'sigma_x': 0.05, 'x0': 'from_true_params',\n         'true_model': {'type': 'HR', 'params': {'V': 2.0, 'K': 0.3, 'n': 3.0}, 'func': f_hr}},\n        # Case D: Linear mass-action\n        {'T': 20.0, 'N': 201, 'S_func': lambda t: 0.5 * (np.sin(6.0 * np.pi * t / 20.0) + 1.0), 'gamma': 0.5, 'sigma_x': 0.03, 'x0': 0.0,\n         'true_model': {'type': 'LM', 'params': {'k': 0.8}, 'func': f_lm}}\n    ]\n    \n    # --- Define parameter grids and priors for inference ---\n    V_grid = np.logspace(np.log10(0.3), np.log10(3.0), 6)\n    K_grid = np.logspace(np.log10(0.2), np.log10(2.0), 6)\n    k_grid = np.logspace(np.log10(0.2), np.log10(2.0), 6)\n    n_values = [1, 2, 3, 4]\n    n_priors = np.array([0.4, 0.3, 0.2, 0.1])\n\n    final_results = []\n    \n    # --- Main Loop over Test Cases ---\n    for case in test_cases:\n        # Generate time series data\n        t_points = np.linspace(0, case['T'], case['N'])\n        s_signal = case['S_func'](t_points)\n        x0 = case['x0']\n        if x0 == 'from_true_params': # Special handling for case C initial condition\n            s_initial = s_signal[0]\n            true_params = case['true_model']['params']\n            x0 = case['true_model']['func'](s_initial, **true_params) / case['gamma']\n\n        x_true = euler_solver(case['true_model']['func'], s_signal, case['gamma'], x0, t_points, case['true_model']['params'])\n        noise = RNG.normal(0, case['sigma_x'], size=case['N'])\n        x_obs = x_true + noise\n\n        # --- Inference Stage: Compute Evidence for each model family ---\n        evidences = {}\n\n        # 1. Hill Activation (HA)\n        evidence_per_n_ha = []\n        for n in n_values:\n            log_liks = [log_likelihood(x_obs, euler_solver(f_ha, s_signal, case['gamma'], x0, t_points, {'V': v, 'K': k, 'n': float(n)}), case['sigma_x'])\n                        for v in V_grid for k in K_grid]\n            evidence_per_n_ha.append(average_likelihood_from_logs(log_liks))\n        evidences['HA'] = np.sum(n_priors * np.array(evidence_per_n_ha))\n\n        # 2. Hill Repression (HR)\n        evidence_per_n_hr = []\n        for n in n_values:\n            log_liks = [log_likelihood(x_obs, euler_solver(f_hr, s_signal, case['gamma'], x0, t_points, {'V': v, 'K': k, 'n': float(n)}), case['sigma_x'])\n                        for v in V_grid for k in K_grid]\n            evidence_per_n_hr.append(average_likelihood_from_logs(log_liks))\n        evidences['HR'] = np.sum(n_priors * np.array(evidence_per_n_hr))\n        \n        # 3. Linear Mass-Action (LM)\n        log_liks_lm = [log_likelihood(x_obs, euler_solver(f_lm, s_signal, case['gamma'], x0, t_points, {'k': k_val}), case['sigma_x'])\n                       for k_val in k_grid]\n        evidences['LM'] = average_likelihood_from_logs(log_liks_lm)\n        \n        # --- Calculate Posteriors ---\n        total_evidence = sum(evidences.values())\n        if total_evidence > 0:\n            posteriors = {model: ev / total_evidence for model, ev in evidences.items()}\n        else: # Handle unlikely case where all evidences are zero\n            posteriors = {'HA': 1./3., 'HR': 1./3., 'LM': 1./3.}\n        \n        # Append the posterior of the true model for this case\n        true_model_type = case['true_model']['type']\n        final_results.append(posteriors[true_model_type])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.8f}' for r in final_results)}]\")\n\nsolve()\n```", "id": "3353773"}, {"introduction": "一个能够完美拟合数据但违反了基本物理定律的模型，不能算作一个有效的机理模型。例如，在生物化学系统中，物种的浓度不能为负。本节的最后一个实践将探讨如何确保我们发现的模型具有物理上的合理性，这是保证模型预测能力和现实世界相关性的关键一步 ([@problem_id:3353725])。你将推导出一个关键物理约束——浓度非负性——所需的数学条件，并设计一个惩罚函数，以便在符号回归的优化过程中强制执行此约束。", "problem": "考虑一个已发现的关于 $n$ 种生物化学物种的常微分方程（ODE）系统，其浓度为 $x \\in \\mathbb{R}_{\\geq 0}^{n}$，写作 $\\dot{x} = f(x)$，其中 $f : \\mathbb{R}_{\\geq 0}^{n} \\to \\mathbb{R}^{n}$ 是局部利普希茨函数，表示净生产速率。在质量作用定律下的机理化学反应网络模型中，$f(x)$ 可以表示为 $f(x) = S\\,v(x)$，其中 $S \\in \\mathbb{R}^{n \\times m}$ 是化学计量矩阵，$v : \\mathbb{R}_{\\geq 0}^{n} \\to \\mathbb{R}_{\\geq 0}^{m}$ 是基元反应倾向（通量）的向量，它们是 $\\mathbb{R}_{\\geq 0}^{n}$ 上的非负函数，并在任何所需反应物浓度为零时消失。在用于机理模型发现的符号回归中，$f$ 和 $v$ 的候选形式可能会违反物理约束，例如浓度和通量的非负性。\n\n从浓度非负和质量作用定律下反应倾向非负的物理约束出发，并根据常微分方程闭集的前向不变性定义，推导确保状态空间 $\\Omega = \\mathbb{R}_{\\geq 0}^{n}$ 正不变性的条件；也就是说，在该条件下，从 $\\Omega$ 出发的轨迹在所有未来时间内都保持在 $\\Omega$ 内。然后，为正则化符号回归，构建一个单一的可微惩罚泛函，以抑制对以下条件的候选违规：\n- $\\Omega$ 在每个坐标超面 $\\{x \\in \\Omega : x_{i} = 0\\}$ 上的指向内部的边界条件，以及\n- 在 $\\Omega$ 上每个候选基元反应倾向 $v_{r}(x)$ 的非负性。\n\n设评估区域为有界超立方体 $\\mathcal{D}_{L} = [0,L]^{n}$，其中 $L  0$，并设超面为 $\\mathcal{F}_{i}(L) = \\{x \\in \\mathcal{D}_{L} : x_{i} = 0\\}$，其中 $i \\in \\{1,\\dots,n\\}$。在 $\\mathcal{F}_{i}(L)$ 和 $\\mathcal{D}_{L}$ 上使用均匀权重，并设 $\\alpha  0$ 和 $\\beta  0$ 为超参数，分别用于平衡边界违规和通量负值的惩罚。仅使用绝对值重新参数化的正部算子来表示边界违规惩罚，并对通量非负性惩罚执行相同的操作。您的惩罚项必须通过每个超面的 $(n-1)$ 维体积和 $\\mathcal{D}_{L}$ 的 $n$ 维体积进行归一化。\n\n以一个仅包含代数运算、绝对值和积分的单一闭式解析表达式的形式，提供关于 $f$、$v$、$L$、$\\alpha$ 和 $\\beta$ 的最终惩罚泛函。您的最终答案必须是单一的解析表达式。不需要数值舍入，最终答案中也不应报告单位。", "solution": "该问题要求两个主要部分：首先，推导确保物种浓度随时间非负的条件；其次，构建一个惩罚泛函，以在用于模型发现的符号回归框架内强制执行这些条件。\n\n首先，我们推导正不变性的条件。浓度的状态空间是非负象限 $\\Omega = \\mathbb{R}_{\\geq 0}^{n}$，它是 $\\mathbb{R}^{n}$ 中的一个闭凸集。系统的动力学由常微分方程（ODE）$\\dot{x} = f(x)$ 给出。对于从 $\\Omega$ 出发（即 $x(0) \\in \\Omega$）的轨迹，要在所有未来时间 $t  0$ 内都保持在 $\\Omega$ 中，集合 $\\Omega$ 必须是前向不变的。\n\n闭凸集 $\\Omega$ 的前向不变性的一个充分条件由 Nagumo 定理（也称为相切条件）给出。该定理指出，$\\Omega$ 是前向不变的，当且仅当对于 $\\Omega$ 边界 $\\partial \\Omega$ 上的每个点 $x$，向量场 $f(x)$ 与 $\\Omega$ 相切或指向 $\\Omega$ 的内部。\n\n非负象限 $\\Omega = \\mathbb{R}_{\\geq 0}^{n}$ 的边界是至少有一个浓度为零的坐标超面的并集：$\\partial \\Omega = \\bigcup_{i=1}^{n} \\{x \\in \\mathbb{R}_{\\geq 0}^{n} : x_i = 0\\}$。\n\n我们考虑这些超面上的一个点 $x$，对于某个特定索引 $i \\in \\{1, \\dots, n\\}$，有 $x_i = 0$，并且对于所有 $j \\neq i$，有 $x_j \\ge 0$。在此点，指向边界超面外部的法向量是 $-e_i$，其中 $e_i$ 是第 $i$ 个标准基向量。相切条件要求向量场 $f(x)$ 在外指法向量方向上没有分量。在数学上，这表示为 $f(x) \\cdot (-e_i) \\le 0$。此点积简化为 $-f_i(x) \\le 0$，这等价于 $f_i(x) \\ge 0$。\n\n因此，状态空间 $\\Omega = \\mathbb{R}_{\\geq 0}^{n}$ 保持正不变性的条件是，对于每个物种 $i=1, \\dots, n$，只要该物种的浓度为零，其净变化率 $f_i(x)$ 就必须是非负的。形式上：\n对于每个 $i \\in \\{1, \\dots, n\\}$，我们必须有 $f_i(x) \\ge 0$ 对所有满足 $x_i = 0$ 的 $x \\in \\Omega$ 成立。\n这就是问题中提到的“指向内部的边界条件”。对于一个基于质量作用定律的机理模型，其中 $f(x)=S v(x)$，如果反应倾向 $v_r(x)$ 是非负的，并且在必要反应物浓度为零时消失，则此条件自然满足。然而，通过符号回归发现的模型可能不会自动满足这些物理约束。\n\n接下来，我们构建惩罚泛函 $J(f, v)$ 来正则化符号回归。该泛函应抑制在有界测试域 $\\mathcal{D}_L = [0,L]^n$ 上对两个条件的违规：\n1. 指向内部的边界条件：在超面 $\\mathcal{F}_i(L) = \\{x \\in \\mathcal{D}_L : x_i=0\\}$ 上，$f_i(x) \\ge 0$。\n2. 反应倾向的非负性：在域 $\\mathcal{D}_L$ 上，$v_r(x) \\ge 0$。\n\n总惩罚泛函 $J(f, v)$ 是两项 $J_{boundary}$ 和 $J_{flux}$ 的和，由超参数 $\\alpha  0$ 和 $\\beta  0$ 加权。\n\n对于边界违规惩罚，如果 $f_i(x)  0$，则在点 $x \\in \\mathcal{F}_i(L)$ 处发生对物种 $i$ 的违规。我们希望惩罚这种违规。一个能捕捉到这一点的函数是 $-f_i(x)$ 的正部，即 $\\max(0, -f_i(x))$。问题指定使用仅涉及绝对值的等效表示。正部函数 $(z)_+ = \\max(0, z)$ 的一个恒等式是 $(z+|z|)/2$。将其应用于 $-f_i(x)$，在点 $x$ 处的惩罚是：\n$$ p_i(x) = \\max(0, -f_i(x)) = \\frac{-f_i(x) + |-f_i(x)|}{2} = \\frac{|f_i(x)| - f_i(x)}{2} $$\n如果 $f_i(x) \\ge 0$，该函数为零；如果 $f_i(x)  0$，则等于 $-f_i(x)$。为获得第 $i$ 个超面的总惩罚，我们将此量在 $\\mathcal{F}_i(L)$ 上积分。问题要求通过 $\\mathcal{F}_i(L)$ 的 $(n-1)$ 维体积进行归一化，该体积为 $L^{n-1}$。总边界惩罚 $J_{boundary}$ 是所有超面上的总和，由 $\\alpha$ 加权：\n$$ J_{boundary} = \\alpha \\sum_{i=1}^{n} \\left( \\frac{1}{L^{n-1}} \\int_{\\mathcal{F}_i(L)} \\frac{|f_i(x)| - f_i(x)}{2} \\, d\\sigma_i \\right) $$\n其中 $d\\sigma_i$ 是 $\\mathcal{F}_i(L)$ 上的 $(n-1)$ 维曲面测度。\n\n对于通量非负性惩罚，如果 $v_r(x)  0$，则在点 $x \\in \\mathcal{D}_L$ 处发生对反应 $r$ 的违规。类似地，我们用函数 $\\max(0, -v_r(x))$ 来惩罚它，表示为：\n$$ q_r(x) = \\max(0, -v_r(x)) = \\frac{-v_r(x) + |-v_r(x)|}{2} = \\frac{|v_r(x)| - v_r(x)}{2} $$\n为获得第 $r$ 个反应的总惩罚，我们将此量在整个域 $\\mathcal{D}_L$ 上积分。然后通过 $\\mathcal{D}_L$ 的 $n$ 维体积进行归一化，该体积为 $L^n$。总通量惩罚 $J_{flux}$ 是所有反应上的总和，由 $\\beta$ 加权：\n$$ J_{flux} = \\beta \\sum_{r=1}^{m} \\left( \\frac{1}{L^n} \\int_{\\mathcal{D}_L} \\frac{|v_r(x)| - v_r(x)}{2} \\, dV \\right) $$\n其中 $dV$ 是 $n$ 维体积元。\n\n最终的惩罚泛函是和 $J(f, v) = J_{boundary} + J_{flux}$。合并表达式并提出常数，我们得到单一的闭式解析表达式：\n$$ J(f, v) = \\frac{\\alpha}{2L^{n-1}} \\sum_{i=1}^{n} \\int_{\\mathcal{F}_i(L)} \\left(|f_i(x)| - f_i(x)\\right) d\\sigma_i + \\frac{\\beta}{2L^n} \\sum_{r=1}^{m} \\int_{\\mathcal{D}_L} \\left(|v_r(x)| - v_r(x)\\right) dV $$\n该泛函关于 $f$ 和 $v$ 的参数几乎处处可微，适用于符号回归中的基于梯度的优化。", "answer": "$$ \\boxed{ \\frac{\\alpha}{2 L^{n-1}} \\sum_{i=1}^{n} \\int_{\\mathcal{F}_i(L)} (|f_i(x)| - f_i(x)) \\, d\\sigma_i + \\frac{\\beta}{2 L^n} \\sum_{r=1}^{m} \\int_{\\mathcal{D}_L} (|v_r(x)| - v_r(x)) \\, dV } $$", "id": "3353725"}]}