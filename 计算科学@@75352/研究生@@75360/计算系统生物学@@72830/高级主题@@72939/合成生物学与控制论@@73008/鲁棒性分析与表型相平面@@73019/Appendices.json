{"hands_on_practices": [{"introduction": "理解细胞代谢策略的第一步是将其可视化。本练习将指导您如何从一个简单的化学计量模型出发，构建一个完整的表型相平面。通过这项实践[@problem_id:3346773]，您将学会如何根据不同的营养物可用性，识别限制细胞生长的关键因素，这是所有后续分析的基础技能。", "problem": "给定一个包含两个交换反应和一个生物量反应的最小通量平衡分析（FBA）模型。目标是形式化该线性规划问题，分析其关于摄取边界的参数最优解，并在 $(a,b)$ 参数空间中计算表型相平面，其中 $a$ 和 $b$ 是最大摄取能力。\n\n基本原理：\n- 在稳态下，胞内代谢物浓度满足质量平衡约束 $S v = 0$，其中 $S$ 是化学计量矩阵，$v$ 是反应通量向量。\n- 交换反应将系统与环境相连，并受到代表运输或可用性限制的边界约束。\n- FBA 的目标是最大化生物量生产速率。\n\n模型规格：\n- 代谢物：$A_c$，$B_c$。\n- 反应（按 $v_{ex,A}$、$v_{ex,B}$、$v_{bio}$ 顺序）：\n  1. A 的摄取：从外部来源到 $A_c$，表示为 $v_{ex,A}$，其化学计量关系为生成 $A_c$。\n  2. B 的摄取：从外部来源到 $B_c$，表示为 $v_{ex,B}$，其化学计量关系为生成 $B_c$。\n  3. 生物量形成：$A_c + 2 B_c \\rightarrow \\text{biomass}$，表示为消耗 $A_c$ 和 $B_c$ 的 $v_{bio}$。\n- 关于代谢物 $[A_c, B_c]$ 和反应 $[v_{ex,A}, v_{ex,B}, v_{bio}]$ 的化学计量矩阵 $S$：\n$$\nS = \\begin{bmatrix}\n1  0  -1 \\\\\n0  1  -2\n\\end{bmatrix}.\n$$\n- 目标：最大化 $v_{bio}$，即 $\\max c^\\top v$，其中 $c = [0, 0, 1]^\\top$。\n- 边界：$0 \\le v_{ex,A} \\le a$, $0 \\le v_{ex,B} \\le b$ 及 $0 \\le v_{bio} \\le \\infty$。\n- 所有通量的单位均为毫摩尔每克干重每小时 (mmol gDW$^{-1}$ h$^{-1}$)。在适用的情况下，所有答案都必须用这些单位表示。\n\n任务：\n1. 构建满足 $S v = 0$ 和上述边界约束的线性规划问题 $\\max c^\\top v$。\n2. 确定作为 $(a,b)$ 函数的表型相平面划分，该划分表征了在最优解下哪个交换边界是生长限制性的。你的分析必须仅基于模型规格和稳态质量平衡。\n3. 实现一个程序，对于下面测试套件中的每个参数对 $(a,b)$，求解该线性规划并输出：\n   - 最优生物量通量 $v_{bio}^\\star(a,b)$，四舍五入到九位小数。\n   - 一个整数形式的状态码，用于编码最优解下的限制状态：\n     - $0$ 如果 $v_{ex,A}$ 的上界是约束性的，而 $v_{ex,B}$ 的上界不是约束性的（A-限制区域）。\n     - $1$ 如果 $v_{ex,B}$ 的上界是约束性的，而 $v_{ex,A}$ 的上界不是约束性的（B-限制区域）。\n     - $2$ 如果两个上界都是约束性的（共限制边界）。\n     - $3$ 如果 $v_{bio}^\\star(a,b) = 0$（无生长；这包括 $a=0$ 或 $b=0$ 的情况）。\n   约束性和相等性比较必须使用数值容差 $\\varepsilon = 10^{-9}$ 来判断。\n\n测试套件：\n- 情况 $1$：$(a,b) = (10.0, 30.0)$\n- 情况 $2$：$(a,b) = (10.0, 15.0)$\n- 情况 $3$：$(a,b) = (0.0, 10.0)$\n- 情况 $4$：$(a,b) = (5.0, 0.0)$\n- 情况 $5$：$(a,b) = (8.0, 16.0)$\n- 情况 $6$：$(a,b) = (10^{-6}, 10^{-6})$\n- 情况 $7$：$(a,b) = (100.0, 1.0)$\n\n最终输出格式：\n- 你的程序应生成单行输出，其中包含一个扁平列表，列表中的条目按顺序交替出现每个测试用例的四舍五入后的最优生物量通量和状态码。具体来说，打印\n  $[v_1^\\star,code_1,v_2^\\star,code_2,\\dots,v_7^\\star,code_7]$\n  ，形式为一个用方括号括起来的逗号分隔列表，其中每个 $v_i^\\star$ 四舍五入到九位小数，每个 $code_i$ 是一个整数。", "solution": "用户希望分析一个最小通量平衡分析（FBA）模型，并实现一个程序来计算其表型相平面。\n\n### 1. 问题验证与形式化\n\n问题陈述为一个简单的 FBA 模型提供了完整且一致的定义。它包括化学计量矩阵 $S$、目标函数 $c$ 以及由变量 $a$ 和 $b$ 参数化的通量边界。任务陈述清晰，数学上定义明确，并基于标准的系统生物学原理。该问题是有效的。\n\n线性规划（LP）的公式化如下：\n- **变量**：通量向量 $v = [v_{ex,A}, v_{ex,B}, v_{bio}]^\\top$。\n- **目标**：最大化生物量生产速率 $v_{bio}$。这等同于 $\\max c^\\top v$，其中 $c = [0, 0, 1]^\\top$。\n- **约束条件**：\n    1.  **稳态质量平衡**：$S v = 0$。\n    2.  **通量边界**：\n        -   $0 \\le v_{ex,A} \\le a$\n        -   $0 \\le v_{ex,B} \\le b$\n        -   $0 \\le v_{bio} \\le \\infty$\n\n给定化学计量矩阵：\n$$\nS = \\begin{bmatrix}\n1  0  -1 \\\\\n0  1  -2\n\\end{bmatrix}\n$$\n质量平衡约束 $S v = 0$ 转化为以下线性方程组：\n$$\n\\begin{cases}\n1 \\cdot v_{ex,A} + 0 \\cdot v_{ex,B} - 1 \\cdot v_{bio} = 0 \\\\\n0 \\cdot v_{ex,A} + 1 \\cdot v_{ex,B} - 2 \\cdot v_{bio} = 0\n\\end{cases}\n$$\n该系统意味着在稳态下，通量之间存在固定的关系：\n$$\nv_{ex,A} = v_{bio}\n$$\n$$\nv_{ex,B} = 2 v_{bio}\n$$\n\n### 2. 解析解与表型相平面\n\n从质量平衡条件推导出的关系使我们能够仅用我们希望最大化的变量 $v_{bio}$ 来表示该线性规划问题。我们将这些关系代入通量边界约束中：\n1.  约束 $0 \\le v_{ex,A} \\le a$ 变为 $0 \\le v_{bio} \\le a$。\n2.  约束 $0 \\le v_{ex,B} \\le b$ 变为 $0 \\le 2 v_{bio} \\le b$，简化为 $0 \\le v_{bio} \\le \\frac{b}{2}$。\n\n为了最大化 $v_{bio}$，我们必须同时满足这两个推导出的约束。因此，最优生物量通量 $v_{bio}^\\star$ 是同时满足 $v_{bio} \\le a$ 和 $v_{bio} \\le \\frac{b}{2}$ 的最大值。这由下式给出：\n$$\nv_{bio}^\\star(a,b) = \\min\\left(a, \\frac{b}{2}\\right)\n$$\n\n表型相平面根据哪种资源（$A$ 或 $B$）限制生长速率来划分为不同区域。这取决于在最优解下哪个摄取通量的上界是激活的（或“约束性的”）。对于通量 $v_i$，如果其最优通量 $v_i^\\star$ 与其上界 $u_i$ 在数值容差 $\\varepsilon = 10^{-9}$ 范围内相等，即 $u_i - v_i^\\star \\le \\varepsilon$，则该上界被认为是约束性的。\n\n最优摄取通量为：\n-   $v_{ex,A}^\\star = v_{bio}^\\star = \\min(a, b/2)$\n-   $v_{ex,B}^\\star = 2 v_{bio}^\\star = 2 \\min(a, b/2)$\n\n状态定义如下：\n-   **状态 3 (无生长)**：当 $v_{bio}^\\star(a,b) = 0$ 时发生。考虑容差，检查条件为 $v_{bio}^\\star \\le \\varepsilon$。如果 $a=0$ 或 $b=0$，则该条件成立。\n-   **状态 0 (A-限制)**：$v_{ex,A}$ 的边界是约束性的，但 $v_{ex,B}$ 的边界不是。\n    -   约束性条件：$a - v_{ex,A}^\\star \\le \\varepsilon$。\n    -   非约束性条件：$b - v_{ex,B}^\\star > \\varepsilon$。\n    这对应于 $a  b/2$ 的区域。\n-   **状态 1 (B-限制)**：$v_{ex,B}$ 的边界是约束性的，但 $v_{ex,A}$ 的边界不是。\n    -   约束性条件：$b - v_{ex,B}^\\star \\le \\varepsilon$。\n    -   非约束性条件：$a - v_{ex,A}^\\star  \\varepsilon$。\n    这对应于 $a  b/2$ 的区域。\n-   **状态 2 (共限制)**：$v_{ex,A}$ 和 $v_{ex,B}$ 的边界都是约束性的。\n    -   约束性条件：$a - v_{ex,A}^\\star \\le \\varepsilon$ 且 $b - v_{ex,B}^\\star \\le \\varepsilon$。\n    这对应于 $a = b/2$ 的边界线。\n\n### 3. 算法实现\n\n该程序实现了此解析解。对于每个测试用例对 $(a,b)$：\n1.  计算最优生物量通量 $v_{bio}^\\star = \\min(a, b/2)$。\n2.  首先检查无生长条件 ($v_{bio}^\\star \\le \\varepsilon$) 以分配状态码 $3$。\n3.  如果有生长，则计算相应的最优摄取通量 $v_{ex,A}^\\star$ 和 $v_{ex,B}^\\star$。\n4.  然后，通过使用容差 $\\varepsilon$ 将最优通量与其最大允许值（$a$ 和 $b$）进行比较，来确定哪些边界是约束性的。\n5.  根据约束性和非约束性条件的组合，分配相应的状态码（$0$、$1$ 或 $2$）。\n6.  计算出的 $v_{bio}^\\star$ 被格式化为九位小数，结果对 ($v_{bio}^\\star$, code) 被附加到列表中以供最终输出。\n这种对约束性条件的直接实现是稳健的，并能正确划分 $(a,b)$ 参数空间。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the FBA problem for a series of test cases, determining the optimal\n    biomass flux and the limiting growth regime for each.\n    \"\"\"\n    test_cases = [\n        (10.0, 30.0),  # Case 1\n        (10.0, 15.0),  # Case 2\n        (0.0, 10.0),   # Case 3\n        (5.0, 0.0),    # Case 4\n        (8.0, 16.0),   # Case 5\n        (10**-6, 10**-6), # Case 6\n        (100.0, 1.0)   # Case 7\n    ]\n\n    epsilon = 1e-9\n    results = []\n\n    for a, b in test_cases:\n        # Step 1: Calculate the analytical solution for the optimal biomass flux.\n        # v_bio_star = min(a, b/2)\n        v_bio_star = min(a, b / 2.0)\n\n        code = -1 # Initialize with a sentinel value.\n\n        # Step 2: Determine the regime code based on the binding constraints.\n        \n        # Regime 3: No growth. This occurs if v_bio_star is effectively zero.\n        if v_bio_star = epsilon:\n            code = 3\n        else:\n            # For growth cases, determine optimal uptake fluxes.\n            # v_ex_A_star = v_bio_star\n            # v_ex_B_star = 2 * v_bio_star\n            v_ex_A_star = v_bio_star\n            v_ex_B_star = 2.0 * v_bio_star\n\n            # Determine if the upper bounds on uptake are binding.\n            # A flux is binding if its optimal value is within epsilon of its bound.\n            is_A_binding = (a - v_ex_A_star) = epsilon\n            is_B_binding = (b - v_ex_B_star) = epsilon\n\n            if is_A_binding and is_B_binding:\n                # Regime 2: Co-limited (both bounds are active).\n                code = 2\n            elif is_A_binding:\n                # Regime 0: A-limited (only bound 'a' is active).\n                code = 0\n            elif is_B_binding:\n                # Regime 1: B-limited (only bound 'b' is active).\n                code = 1\n            # Note: The case where neither is binding is impossible if v_bio_star > 0,\n            # as the optimum of a linear program must lie on the boundary of the\n            # feasible set.\n\n        # Step 3: Format results as required.\n        # Format the biomass flux to nine decimal places.\n        formatted_v_bio = f\"{v_bio_star:.9f}\"\n        \n        results.append(formatted_v_bio)\n        results.append(code)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3346773"}, {"introduction": "一旦定义了相平面，我们就可以利用它来回答定量的生物学问题。本练习引入了“鲁棒性”的概念，通过计算特定表型区域（例如，溢流代谢）的面积来衡量，并探讨这种鲁棒性如何受细胞内部能力（如呼吸能力）变化的影响。这项实践[@problem_id:3346780]将定性的“代谢地图”与定量的生物学度量联系起来。", "problem": "考虑一个表现出溢流代谢的单细胞生物的粗粒度代谢模型。该生物通过两条集总途径（呼吸途径和分泌乙酸的发酵途径）吸收葡萄糖和氧气以产生生物质。表型相平面（Phenotypic Phase Plane, PPP）涵盖了葡萄糖摄取和氧气摄取的矩形区域，用 $(a,b)$ 表示，其中 $a \\in [0,A_{\\max}]$ 且 $b \\in [0,B_{\\max}]$，$a$ 和 $b$ 是以毫摩尔/克干重/小时（mmol gDW$^{-1}$ h$^{-1}$）为单位测量的通量。溢流在操作上定义为乙酸的产生，而鲁棒性则量化为该PPP区域内乙酸分泌为严格正值的区域面积。\n\n假设存在以下粗粒度通量变量：$v_{R}$ 代表呼吸途径，$v_{F}$ 代表发酵途径，$v_{\\text{Ac}}$ 代表任何乙酸浪费途径（即产生乙酸但不产生生物质）。呼吸途径需要氧气，其化学计量需求为 $r_{o}$（每毫摩尔呼吸消耗的葡萄糖需要 $r_{o}$ 毫摩尔 O$_2$）。生物质产率分别为 $y_{R}$（呼吸）和 $y_{F}$（发酵），且满足 $y_{R} > y_{F} > 0$。最大呼吸能力施加了约束 $v_{R} \\leq R_{\\max}$。葡萄糖摄取满足分配约束 $v_{R} + v_{F} + v_{\\text{Ac}} = a$，氧气摄取满足 $r_{o} \\, v_{R} \\leq b$。该生物在这些约束条件下最大化生物质产量，乙酸分泌量与 $v_{F}$（因为发酵通量分泌乙酸）以及可能的 $v_{\\text{Ac}}$（它不增加生物质，因此在生物质最大化目标下不会被使用）成正比。\n\n从这些定义和约束出发，在给定 $R_{\\max}$ 的情况下，当 $a$ 和 $b$ 的分配以最大化生物质为目标时，乙酸分泌为严格正值的充要条件是发酵通量 $v_{F}$ 为严格正值。对溢流的鲁棒性由集合 $\\{(a,b) \\in [0,A_{\\max}] \\times [0,B_{\\max}] : v_{F}(a,b; R_{\\max}) > 0\\}$ 的勒贝格测度（面积）量化，单位为 $(\\text{mmol gDW}^{-1} \\text{ h}^{-1})^{2}$。\n\n您的任务是编写一个完整的、可运行的程序，该程序针对一组指定的参数，计算 $(a,b)$ 平面中的鲁棒性（产乙酸区域的面积），并报告该面积如何随最大呼吸能力 $R_{\\max}$ 的变化而变化。您必须遵守以下要求：\n\n- 使用上述基本约束和逻辑，除了从生物质最大化分配中得出的结论外，不引入任何额外的简化公式。\n- 使用的参数为 $A_{\\max} = 10$ mmol gDW$^{-1}$ h$^{-1}$，$B_{\\max} = 10$ mmol gDW$^{-1}$ h$^{-1}$，以及 $r_{o} = 2$ mmol O$_2$ / mmol 呼吸消耗的葡萄糖。生物质产率满足 $y_{R} > y_{F} > 0$，但只要生物体以最大化生物质为目标，它们就不会影响产生乙酸的条件。\n- 程序必须使用基于约束和生物质最大化目标的数学上合理的推导来计算产乙酸区域的面积。\n- 将最终面积以 $(\\text{mmol gDW}^{-1} \\text{ h}^{-1})^{2}$ 为单位表示为实数（浮点数）。\n- 测试套件：\n    1. $R_{\\max} = 0.0$ mmol gDW$^{-1}$ h$^{-1}$（零呼吸能力的边界情况）。\n    2. $R_{\\max} = 1.0$ mmol gDW$^{-1}$ h$^{-1}$（低能力）。\n    3. $R_{\\max} = 2.5$ mmol gDW$^{-1}$ h$^{-1}$（中等能力）。\n    4. $R_{\\max} = 10.0$ mmol gDW$^{-1}$ h$^{-1}$（高能力）。\n- 最终输出格式：您的程序应生成单行输出，其中包含四个测试用例的面积，格式为方括号内以逗号分隔的列表，例如，“[area1,area2,area3,area4]”。每个面积都必须是浮点数。\n\n解决方案必须在科学上是合理的，并从核心约束和目标推导得出。程序不接受任何外部输入，并且必须按原样确定性地运行。", "solution": "用户提供了一个来自计算系统生物学领域的、科学上合理且定义明确的问题陈述。该问题的验证过程如下：\n- **已知条件提取**：\n  - 分析域：表型相平面（PPP），一个由葡萄糖摄取通量 $a \\in [0,A_{\\max}]$ 和氧气摄取通量 $b \\in [0,B_{\\max}]$ 定义的矩形区域。\n  - 问题变量：呼吸通量 $v_{R}$，发酵通量 $v_{F}$，以及乙酸浪费通量 $v_{\\text{Ac}}$。\n  - 目标：生物体最大化其生物质生产速率。\n  - 约束条件：\n    1. 葡萄糖平衡：$v_{R} + v_{F} + v_{\\text{Ac}} = a$。\n    2. 氧气平衡：$r_{o} \\, v_{R} \\leq b$，其中 $r_{o}$ 是化学计量系数。\n    3. 呼吸能力：$v_{R} \\leq R_{\\max}$。\n    4. 非负性：$v_{R} \\geq 0$，$v_{F} \\geq 0$，$v_{\\text{Ac}} \\geq 0$。\n  - 生物质生产：总生物质通量是途径通量的线性组合，$\\mu = y_{R}v_{R} + y_{F}v_{F}$，产率满足 $y_{R}  y_{F}  0$。通量 $v_{\\text{Ac}}$ 对生物质没有贡献。\n  - 乙酸生产条件：乙酸分泌为严格正值的充要条件是 $v_{F}  0$。\n  - 鲁棒性度量：PPP 中 $v_{F}  0$ 的区域面积。\n  - 参数：$A_{\\max} = 10$，$B_{\\max} = 10$，$r_{o} = 2$。\n  - 测试用例：$R_{\\max} \\in \\{0.0, 1.0, 2.5, 10.0\\}$。\n\n- **验证**：该问题在科学上植根于代谢建模，定义明确，具有清晰的目标和约束，并以客观、精确的语言表述。关于生物质产率 $y_R$ 和 $y_F$ 不影响乙酸分泌条件（除了 $y_R  y_F$）的陈述是正确的，因为在此条件下最大化生物质等同于最大化通过更高产率途径 $v_R$ 的通量。所有参数在物理上都是一致的。因此，该问题是有效的。\n\n求解过程首先推导乙酸分泌的条件，然后计算 $(a,b)$ 平面中相应区域的面积。\n\n**步骤 1：最优通量分布的推导**\n目标是最大化生物质生产速率 $\\mu = y_{R}v_{R} + y_{F}v_{F}$。乙酸浪费途径 $v_{\\text{Ac}}$ 不产生生物质且消耗葡萄糖底物；因此，在生物质最大化目标下，其通量将为零（$v_{\\text{Ac}} = 0$）。葡萄糖平衡约束简化为 $v_{R} + v_{F} = a$。我们可以将 $v_{F}$ 表示为 $v_{F} = a - v_{R}$ 并将其代入目标函数：\n$$ \\mu = y_{R}v_{R} + y_{F}(a - v_{R}) = (y_{R} - y_{F})v_{R} + y_{F}a $$\n鉴于 $y_{R}  y_{F}$，项 $(y_{R} - y_{F})$ 是正的。对于固定的葡萄糖摄取量 $a$，最大化 $\\mu$ 等同于最大化呼吸通量 $v_{R}$。\n\n因此，生物体将选择与所有约束条件一致的 $v_{R}$ 的最大可能值。$v_{R}$ 的约束条件是：\n1. $v_{R} \\geq 0$（非负性）\n2. 从 $v_{F} = a - v_{R} \\geq 0$ 可得 $v_{R} \\leq a$。\n3. $v_{R} \\leq R_{\\max}$（呼吸能力）\n4. $r_{o} v_{R} \\leq b$，这意味着 $v_{R} \\leq \\frac{b}{r_{o}}$（氧气可用性）\n\n综合这些，最优呼吸通量 $v_{R}^{\\text{opt}}$ 是满足所有上界的最大值：\n$$ v_{R}^{\\text{opt}}(a, b) = \\min\\left(a, R_{\\max}, \\frac{b}{r_{o}}\\right) $$\n相应的最优发酵通量为 $v_{F}^{\\text{opt}} = a - v_{R}^{\\text{opt}}$。\n\n**步骤 2：乙酸分泌的条件**\n当 $v_{F}^{\\text{opt}}  0$ 时发生乙酸分泌。这意味着：\n$$ a - v_{R}^{\\text{opt}}  0 \\implies a  v_{R}^{\\text{opt}} $$\n代入 $v_{R}^{\\text{opt}}$ 的表达式：\n$$ a  \\min\\left(a, R_{\\max}, \\frac{b}{r_{o}}\\right) $$\n因为 $a$ 是 $\\min$ 函数的参数之一，所以最小值永远不会严格大于 $a$。当且仅当其他参数之一严格小于 $a$ 时，严格不等式才成立。因此，乙酸分泌的条件（$v_F  0$）简化为：\n$$ a  R_{\\max} \\quad \\lor \\quad a  \\frac{b}{r_{o}} $$\n\n**步骤 3：计算鲁棒性（乙酸分泌区域的面积）**\n鲁棒性是区域 $[0, A_{\\max}] \\times [0, B_{\\max}]$ 内乙酸分泌区域的面积。更简单的方法是首先计算互补区域——即不分泌乙酸（$v_{F} = 0$）的区域——的面积，然后从总区域面积 $A_{\\max}B_{\\max}$ 中减去它。\n\n不分泌乙酸的条件是分泌条件的否定：\n$$ v_F = 0 \\iff \\neg \\left( a  R_{\\max} \\lor a  \\frac{b}{r_{o}} \\right) \\iff a \\leq R_{\\max} \\land a \\leq \\frac{b}{r_{o}} $$\n第二个不等式可以重写为 $b \\geq a \\cdot r_{o}$。因此，不分泌乙酸的区域是域 $[0, A_{\\max}] \\times [0, B_{\\max}]$ 中满足以下条件的点 $(a,b)$ 的集合：\n1. $a \\leq R_{\\max}$\n2. $b \\geq a \\cdot r_{o}$\n\n这个不分泌区域的面积 $\\mathcal{A}_{\\text{no-acetate}}$ 由这些不等式定义的子域上的积分给出。$a$ 的积分界限是从 $0$到 $\\min(A_{\\max}, R_{\\max})$。$b$ 的界限是从 $a \\cdot r_{o}$ 到 $B_{\\max}$。只有当 $b$ 的下界不超过上界时，即 $a \\cdot r_{o} \\leq B_{\\max}$ 或 $a \\leq B_{\\max}/r_{o}$，该区域才非空。\n因此，对 $a$ 积分的有效上限是 $a_{\\text{lim}} = \\min(A_{\\max}, R_{\\max}, B_{\\max}/r_{o})$。\n\n面积通过以下积分计算：\n$$ \\mathcal{A}_{\\text{no-acetate}} = \\int_{0}^{a_{\\text{lim}}} \\left( \\int_{a \\cdot r_{o}}^{B_{\\max}} db \\right) da = \\int_{0}^{a_{\\text{lim}}} (B_{\\max} - a \\cdot r_{o}) \\, da $$\n计算该积分得到：\n$$ \\mathcal{A}_{\\text{no-acetate}} = \\left[ B_{\\max} a - \\frac{1}{2} r_{o} a^2 \\right]_0^{a_{\\text{lim}}} = B_{\\max} a_{\\text{lim}} - \\frac{1}{2} r_{o} a_{\\text{lim}}^2 $$\n鲁棒性，即产乙酸区域的面积，则为：\n$$ \\mathcal{A}_{\\text{robustness}} = (A_{\\max} B_{\\max}) - \\mathcal{A}_{\\text{no-acetate}} $$\n\n**步骤 4：测试用例的计算**\n我们使用给定的参数：$A_{\\max}=10$，$B_{\\max}=10$，$r_{o}=2$。\nPPP的总面积是 $10 \\times 10 = 100$。\n积分的上限是 $a_{\\text{lim}} = \\min(10, R_{\\max}, 10/2) = \\min(R_{\\max}, 5)$。\n不分泌区域的面积是 $\\mathcal{A}_{\\text{no-acetate}} = 10 \\cdot a_{\\text{lim}} - \\frac{1}{2}(2) a_{\\text{lim}}^2 = 10 a_{\\text{lim}} - a_{\\text{lim}}^2$。\n鲁棒性是 $\\mathcal{A}_{\\text{robustness}} = 100 - (10 a_{\\text{lim}} - a_{\\text{lim}}^2)$。\n\n1.  **$R_{\\max} = 0.0$**：\n    $a_{\\text{lim}} = \\min(0.0, 5) = 0.0$。\n    $\\mathcal{A}_{\\text{no-acetate}} = 10(0.0) - (0.0)^2 = 0.0$。\n    $\\mathcal{A}_{\\text{robustness}} = 100.0 - 0.0 = 100.0$。\n\n2.  **$R_{\\max} = 1.0$**：\n    $a_{\\text{lim}} = \\min(1.0, 5) = 1.0$。\n    $\\mathcal{A}_{\\text{no-acetate}} = 10(1.0) - (1.0)^2 = 9.0$。\n    $\\mathcal{A}_{\\text{robustness}} = 100.0 - 9.0 = 91.0$。\n\n3.  **$R_{\\max} = 2.5$**：\n    $a_{\\text{lim}} = \\min(2.5, 5) = 2.5$。\n    $\\mathcal{A}_{\\text{no-acetate}} = 10(2.5) - (2.5)^2 = 25.0 - 6.25 = 18.75$。\n    $\\mathcal{A}_{\\text{robustness}} = 100.0 - 18.75 = 81.25$。\n\n4.  **$R_{\\max} = 10.0$**：\n    $a_{\\text{lim}} = \\min(10.0, 5) = 5.0$。\n    $\\mathcal{A}_{\\text{no-acetate}} = 10(5.0) - (5.0)^2 = 50.0 - 25.0 = 25.0$。\n    $\\mathcal{A}_{\\text{robustness}} = 100.0 - 25.0 = 75.0$。\n\n这些计算在以下程序中实现。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the robustness to overflow metabolism for different respiratory capacities.\n\n    The robustness is defined as the area of the region in the Phenotypic Phase Plane (PPP)\n    where acetate secretion is strictly positive. The PPP is the space of glucose uptake (a)\n    and oxygen uptake (b).\n\n    The derivation shows that the area of the non-secreting region is given by:\n    Area_no_acetate = B_max * a_lim - 0.5 * r_o * a_lim^2\n    where a_lim = min(A_max, R_max, B_max / r_o).\n\n    The robustness area is then TotalArea - Area_no_acetate.\n    \"\"\"\n    # Define the parameters from the problem statement.\n    A_max = 10.0  # mmol gDW^-1 h^-1\n    B_max = 10.0  # mmol gDW^-1 h^-1\n    r_o = 2.0     # mmol O2 per mmol glucose\n    \n    # Test cases for maximum respiratory capacity.\n    test_cases_R_max = [0.0, 1.0, 2.5, 10.0]\n\n    results = []\n    \n    # Total area of the Phenotypic Phase Plane domain.\n    total_area = A_max * B_max\n    \n    # Pre-calculate the limit imposed by oxygen availability.\n    oxygen_limit_on_a = B_max / r_o\n\n    for R_max in test_cases_R_max:\n        # Determine the effective upper limit for 'a' in the non-secreting region.\n        # This limit is the minimum of the maximum glucose uptake, the respiratory capacity,\n        # and the constraint imposed by maximum oxygen uptake.\n        a_lim = np.min([A_max, R_max, oxygen_limit_on_a])\n        \n        # Calculate the area of the region where NO acetate is secreted.\n        # This corresponds to the region where metabolism is purely respiratory.\n        # Formula: B_max * a_lim - 0.5 * r_o * a_lim^2\n        area_no_acetate = B_max * a_lim - 0.5 * r_o * (a_lim ** 2)\n        \n        # The robustness is the area of the total domain minus the non-secreting area.\n        robustness_area = total_area - area_no_acetate\n        \n        results.append(robustness_area)\n\n    # Format the output as a comma-separated list of floats inside square brackets.\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str)\n\nsolve()\n```", "id": "3346780"}, {"introduction": "连接不同代谢状态的相边界具有独特的数学性质。本练习利用数值微分方法，探索了在这些边界上最优生长速率的不可微性，揭示了在进行灵敏度分析时可能遇到的陷阱，并突出了线性规划求解的分段特性。对于正确解释参数研究而言，理解这一点至关重要[@problem_id:3346751]。", "problem": "考虑一个简化的流平衡分析 (FBA, Flux Balance Analysis) 问题，该问题针对一个双底物玩具代谢网络，并抓住了表型相平面的本质。令 $v_1$ 和 $v_2$ 分别表示两种底物的摄取通量，其上限分别为 $a$ 和 $b$，令 $v_B$ 表示生物质生成速率。假设在一个稳态线性资源分配近似模型中，生物质速率与摄取通量成正比，产率分别为 $y_1$ 和 $y_2$，且总摄取量存在一个全局容量约束 $c$。该优化问题是在线性和容量限制下最大化生物质速率：\n最大化 $y_1 v_1 + y_2 v_2$，约束条件为 $0 \\le v_1 \\le a$，$0 \\le v_2 \\le b$，以及 $v_1 + v_2 \\le c$。在此模型中，$(a,b)$ 空间中的表型相平面是分段线性的，在 $b = c - a$ 处存在一个相边界，活性约束的身份在此发生改变。在此边界上，最优生物质速率关于 $a$ 和 $b$ 是连续但不可微的。\n\n从流平衡的基本观点出发，细胞在稳态下的生长可以被建模为一个线性规划问题，其线性约束源于资源界限和化学计量可行性，并且当参数变化时，线性规划会产生分段线性的最优值函数。您的任务是，在相边界附近及跨越相边界处，数值估算最优生物质速率 $f(a,b)$ 关于 $a$ 和 $b$ 的有限差分敏感度。具体来说，请使用以下经过充分测试的设置：\n- 令 $y_1 = 1.0$，$y_2 = 0.8$，$c = 1.0$。\n- 将 $f(a,b)$ 定义为以下线性规划的最优目标值：$\\max_{v_1,v_2} \\; y_1 v_1 + y_2 v_2$ 约束条件为 $0 \\le v_1 \\le a$，$0 \\le v_2 \\le b$，$v_1 + v_2 \\le c$。\n- 使用一个小的步长 $h = 10^{-6}$ 计算偏导数 $\\partial f/\\partial a$ 和 $\\partial f/\\partial b$ 的有限差分近似值：\n  - 关于 $a$ 的前向差分：$\\frac{f(a+h,b) - f(a,b)}{h}$；关于 $a$ 的后向差分：$\\frac{f(a,b) - f(a-h,b)}{h}$；关于 $a$ 的中心差分：$\\frac{f(a+h,b) - f(a-h,b)}{2h}$。\n  - 关于 $b$ 的前向差分：$\\frac{f(a,b+h) - f(a,b)}{h}$；关于 $b$ 的后向差分：$\\frac{f(a,b) - f(a,b-h)}{h}$；关于 $b$ 的中心差分：$\\frac{f(a,b+h) - f(a,b-h)}{2h}$。\n\n程序必须在每次计算 $f(a,b)$ 时求解该线性规划问题。\n\n在您的解题说明中，解释在相边界 $b = c - a$ 处的不可微性如何导致中心差分估计中出现数值伪影，以及前向和后向差分如何与单侧导数相关联。您的实现必须为以下参数对 $(a,b)$ 的测试套件计算有限差分：\n1. $a = 0.3$, $b = 0.5$ (摄取受限内部区域，$a + b  c$ 且 $b  c - a$)。\n2. $a = 0.6$, $b = 0.5$ (容量受限的混合分配机制区域，$b  c - a$)。\n3. $a = 0.49$, $b = 0.51$ (恰好在相边界 $b = c - a$ 上)。\n4. $a = 1.2$, $b = 0.8$ (单一来源即令容量饱和，$a \\ge c$)。\n5. $a = 0.2$, $b = 0.3$ (两者均受摄取限制，容量有余，$a + b \\le c$)。\n6. $a = 0.49$, $b = 0.50$ (靠近边界，在 $b  c - a$ 一侧)。\n7. $a = 0.49$, $b = 0.515$ (靠近边界，在 $b  c - a$ 一侧)。\n\n所有量均为无量纲。程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。对于上述顺序的每个测试用例，返回一个包含七个浮点数的内部列表：\n$[$中心-$\\partial f/\\partial a$, 前向-$\\partial f/\\partial a$, 后向-$\\partial f/\\partial a$, 中心-$\\partial f/\\partial b$, 前向-$\\partial f/\\partial b$, 后向-$\\partial f/\\partial b$, $f(a,b)$$]$。\n因此，最终输出应是一个包含七个测试用例的七元素列表的单一列表，以单行打印，例如：$[[\\dots],[\\dots],\\dots]$。", "solution": "该问题陈述已经过验证，并且在科学上是合理、适定且客观的。它提出了一个计算系统生物学中简化但典型的问​​题，特别是流平衡分析 (FBA)，该问题基于线性规划和代谢化学计量的原理。所有参数和条件都已明确定义，从而可以得出一个唯一且有意义的解。\n\n此问题的核心是分析最优代谢目标（生物质生产）对营养物可用性变化的敏感度。这被建模为一个线性规划 (LP) 问题，其中最优值是定义约束的参数的函数。任务要求计算该最优值函数 $f(a,b)$ 关于营养物摄取上限 $a$ 和 $b$ 的偏导数的有限差分近似值。\n\n该优化问题被表述为：\n$$\n\\text{最大化 } Z = y_1 v_1 + y_2 v_2\n$$\n受以下约束：\n$$\n\\begin{align*}\n0 \\le v_1 \\le a \\\\\n0 \\le v_2 \\le b \\\\\nv_1 + v_2 \\le c\n\\end{align*}\n$$\n给定参数 $y_1 = 1.0$、$y_2 = 0.8$ 和 $c = 1.0$，目标是最大化 $Z = 1.0 v_1 + 0.8 v_2$。在 $(v_1, v_2)$ 通量空间中的可行域是一个凸多边形，由矩形 $[0, a] \\times [0, b]$ 和半平面 $v_1 + v_2 \\le 1$ 的交集定义。\n\n线性规划的解出现在可行域的一个顶点上。最大化方向由目标函数的梯度向量 $\\nabla Z = (y_1, y_2) = (1.0, 0.8)$ 给出。由于 $y_1  y_2$，优化过程将始终优先增加 $v_1$ 而非 $v_2$。这使得我们可以通过为任意给定的参数对 $(a,b)$ 确定最优顶点，从而对最优生物质函数 $f(a,b) = \\max Z$ 进行解析表征。参数空间 $(a,b)$ 根据在最优点处哪组约束是活性的，而被划分为不同的区域或“表型相”。\n\n1.  **区域 I (摄取受限):** 如果 $a+b \\le c$，则总容量约束 $v_1+v_2 \\le c$ 是非活性的。最优点出现在顶点 $(v_1^*, v_2^*) = (a, b)$ 处，此时两个摄取上限均已达到。最优生物质为：\n    $$\n    f(a,b) = y_1 a + y_2 b = 1.0a + 0.8b\n    $$\n    在此区域，函数是线性的，其偏导数为常数：\n    $$\n    \\frac{\\partial f}{\\partial a} = y_1 = 1.0, \\quad \\frac{\\partial f}{\\partial b} = y_2 = 0.8\n    $$\n\n2.  **区域 II (容量受限，混合摄取):** 如果 $a+b  c$ 且 $a \\le c$，最优点同时受底物1的摄取 ($v_1 \\le a$) 和总容量 ($v_1+v_2 = c$) 的限制。为最大化目标，我们将 $v_1$ 设为其最大可能值，$v_1^* = a$，因此 $v_2^* = c-a$。只要 $v_2^* \\ge 0$ (即 $a \\le c$) 且 $v_2^* \\le b$ (即 $c-a \\le b$，或 $a+b \\ge c$)，该顶点就是可行的。最优生物质为：\n    $$\n    f(a,b) = y_1 a + y_2 (c-a) = (y_1 - y_2)a + y_2 c = 0.2a + 0.8\n    $$\n    在此区域，最优值仅取决于 $a$ 和 $c$，而与 $b$ 无关。偏导数为：\n    $$\n    \\frac{\\partial f}{\\partial a} = y_1 - y_2 = 0.2, \\quad \\frac{\\partial f}{\\partial b} = 0\n    $$\n\n3.  **区域 III (容量受限，单一底物):** 如果 $a  c$，则界限 $v_1 \\le a$ 是冗余的。$v_1$ 的可行域是 $[0, c]$。为最大化 $Z$，我们取最大可能的 $v_1$，即 $v_1^*=c$，此时 $v_2^*=0$。最优生物质为常数：\n    $$\n    f(a,b) = y_1 c = 1.0\n    $$\n    偏导数均为零：\n    $$\n    \\frac{\\partial f}{\\partial a} = 0, \\quad \\frac{\\partial f}{\\partial b} = 0\n    $$\n\n直线 $a+b=c$ 构成了一个**表型相边界**。当参数 $(a,b)$ 穿过这条线时，最优点处的活性约束的身份发生改变，导致 $f(a,b)$ 的解析形式发生变化。虽然函数 $f(a,b)$ 在此边界上是连续的，但其偏导数并非如此。这就是不可微性的定义。在直线 $a+b=c$ 上的任何一点，梯度 $\\nabla f$ 都是未定义的。\n\n这种不可微性对数值微分有可预见的影响：\n-   **前向差分**导数，例如 $(f(a+h, b) - f(a,b))/h$，探测了该点“右侧”的函数行为。在边界上，如果 $a$ 的步进移动到区域 II，这将估算出右导数，即 $\\partial f_{II}/\\partial a = 0.2$。\n-   **后向差分**，$(f(a, b) - f(a-h,b))/h$，探测了“左侧”。如果 $a$ 的后退步移动到区域 I，这将估算出左导数，即 $\\partial f_{I}/\\partial a = 1.0$。\n-   **中心差分**，$(f(a+h, b) - f(a-h,b))/(2h)$，跨越了不可微点。它实际上对两侧的斜率进行平均，得出的值不代表任何一侧的导数，而是一个插值。对于在边界处的 $\\partial f/\\partial a$，它将近似于 $(1.0 + 0.2)/2 = 0.6$。\n\n实现将使用 `scipy.optimize.linprog` 为每次所需的 $f(a,b)$ 求值求解指定的线性规划问题。对于每个测试用例 $(a,b)$，我们用 $h = 10^{-6}$ 计算在 $(a,b)$、$(a \\pm h, b)$ 和 $(a, b \\pm h)$ 处的 $f$。根据这些值，我们计算关于 $a$ 和 $b$ 的偏导数的前向、后向和中心差分近似，并将它们与目标值 $f(a,b)$ 一起报告。", "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves the FBA sensitivity analysis problem for a suite of test cases.\n    \"\"\"\n    \n    # Define constants from the problem statement\n    y1 = 1.0\n    y2 = 0.8\n    c_cap = 1.0\n    h = 1e-6\n\n    # Test cases for parameter pairs (a, b)\n    test_cases = [\n        (0.3, 0.5),    # Case 1: Uptake-limited interior\n        (0.6, 0.5),    # Case 2: Capacity-limited, mixed allocation\n        (0.49, 0.51),  # Case 3: Exactly at the phase boundary\n        (1.2, 0.8),    # Case 4: Substrate 1 saturates capacity\n        (0.2, 0.3),    # Case 5: Both uptake-limited, slack capacity\n        (0.49, 0.50),  # Case 6: Near boundary, uptake-limited side\n        (0.49, 0.515), # Case 7: Near boundary, capacity-limited side\n    ]\n\n    # Pre-compile LP parameters that do not change\n    c_obj = np.array([-y1, -y2])\n    A_ub = np.array([[1, 1]])\n    b_ub = np.array([c_cap])\n\n    memo = {}\n\n    def f_objective(a, b):\n        \"\"\"\n        Solves the LP to find the maximum biomass rate f(a,b).\n        Uses memoization to avoid re-computing for the same (a,b) tuple.\n        \"\"\"\n        if (a, b) in memo:\n            return memo[(a, b)]\n\n        bounds = ((0, a), (0, b))\n        \n        # Method 'highs-ds' is the default in recent SciPy versions and is robust.\n        res = linprog(c=c_obj, A_ub=A_ub, b_ub=b_ub, bounds=bounds, method='highs-ds')\n\n        if not res.success:\n            # This should not happen for this well-behaved LP\n            # Fallback or error for robustness in a real application\n            # For this problem, we can assume success\n            raise RuntimeError(f\"LP solver failed for a={a}, b={b}. Message: {res.message}\")\n        \n        # linprog minimizes, so we negate the result to get the maximum\n        result = -res.fun\n        memo[(a, b)] = result\n        return result\n\n    final_results = []\n    for a, b in test_cases:\n        # Evaluate the function at the center point and neighboring points\n        f_center = f_objective(a, b)\n        f_a_plus = f_objective(a + h, b)\n        f_a_minus = f_objective(a - h, b)\n        f_b_plus = f_objective(a, b + h)\n        f_b_minus = f_objective(a, b - h)\n\n        # Calculate finite differences for partial derivative w.r.t. 'a'\n        central_da = (f_a_plus - f_a_minus) / (2 * h)\n        forward_da = (f_a_plus - f_center) / h\n        backward_da = (f_center - f_a_minus) / h\n\n        # Calculate finite differences for partial derivative w.r.t. 'b'\n        central_db = (f_b_plus - f_b_minus) / (2 * h)\n        forward_db = (f_b_plus - f_center) / h\n        backward_db = (f_center - f_b_minus) / h\n\n        # Assemble the result list for the current test case\n        case_results = [\n            central_da, forward_da, backward_da,\n            central_db, forward_db, backward_db,\n            f_center\n        ]\n        final_results.append(case_results)\n\n    # Format the final output string to match the required format `[[...],[...],...]`\n    # without any whitespace.\n    output_str = str(final_results).replace(\" \", \"\")\n    print(output_str)\n\nsolve()\n```", "id": "3346751"}]}