{"hands_on_practices": [{"introduction": "任何基于约束的建模分析都始于将代谢网络转化为数学形式。化学计量矩阵 $S$ 是这一转化的核心，它精确地描述了网络中每个反应的物质变化。本练习将指导你从一个简单的线性通路入手，亲手构建其化学计量矩阵，并通过计算矩阵的秩和零空间维度，来理解这些线性代数属性如何揭示代谢网络内在的约束和自由度。[@problem_id:3339838]", "problem": "考虑一个最小的内部代谢网络，其包含三个不可逆反应 $R_1: A \\rightarrow B$、$R_2: B \\rightarrow C$ 和 $R_3: C \\rightarrow \\text{biomass}$，其中生物量是一个伪代谢物，不包括在内部质量平衡的代谢物中。内部代谢物是 $A$、$B$ 和 $C$。在基于约束的建模中，稳态下的质量平衡由 $S v = 0$ 给出，其中 $S$ 是化学计量矩阵（行由内部代谢物索引，列由反应索引），$v$ 是通量向量。\n\n从第一性原理出发，即化学计量系数的定义（消耗的底物为负，生成的产物为正）和稳态质量平衡 $S v = 0$，使用代谢物排序 $(A, B, C)$ 和反应排序 $(R_1, R_2, R_3)$ 为该网络构建化学计量矩阵 $S$，计算矩阵的秩 $\\mathrm{rank}(S)$ 和零空间维度 $\\dim(\\ker S)$，并根据稳态通量解空间的结构自由度来解释这些量。\n\n将你的最终答案表示为一个行矩阵，第一个条目等于 $\\mathrm{rank}(S)$，第二个条目等于 $\\dim(\\ker S)$。无需四舍五入。", "solution": "该问题要求构建和分析给定最小代谢网络的化学计量矩阵。分析需从第一性原理出发，基于化学计量的定义和稳态质量平衡条件。\n\n该网络由三个不可逆反应定义，涉及三个内部质量平衡的代谢物：\n反应 $1$ ($R_1$): $A \\rightarrow B$\n反应 $2$ ($R_2$): $B \\rightarrow C$\n反应 $3$ ($R_3$): $C \\rightarrow \\text{biomass}$\n\n指定的内部代谢物是 $A$、$B$ 和 $C$。生物量是一个伪代謝物，不包含在内部代谢物的质量平衡方程中。稳态条件由线性系统 $S v = 0$ 给出，其中 $S$ 是化学计量矩阵，$v$ 是反应通量向量。\n\n第一步是构建化学计量矩阵 $S$。$S$ 的维度是 $m \\times n$，其中 $m$ 是内部代谢物的数量，$n$ 是反应的数量。根据问题陈述，我们有 $m=3$ 和 $n=3$。$S$ 的行对应于代谢物，按 $(A, B, C)$ 排序；列对应于反应，按 $(R_1, R_2, R_3)$ 排序。矩阵中的一个条目 $S_{ij}$ 表示代谢物 $i$ 在反应 $j$ 中的化学计量系数。按照惯例，底物（被消耗）的系数为负，产物（被生成）的系数为正。\n\n让我们逐一确定 $S$ 的各列。\n\n对于反应 $R_1: A \\rightarrow B$：\n- 代谢物 $A$ 被消耗，化学计量为 $1$。因此，$S_{11} = -1$。\n- 代谢物 $B$ 被生成，化学计量为 $1$。因此，$S_{21} = 1$。\n- 代谢物 $C$ 未参与。因此，$S_{31} = 0$。\n$S$ 的第一列是 $\\begin{pmatrix} -1 \\\\ 1 \\\\ 0 \\end{pmatrix}$。\n\n对于反应 $R_2: B \\rightarrow C$：\n- 代谢物 $A$ 未参与。因此，$S_{12} = 0$。\n- 代谢物 $B$ 被消耗，化学计量为 $1$。因此，$S_{22} = -1$。\n- 代谢物 $C$ 被生成，化学计量为 $1$。因此，$S_{32} = 1$。\n$S$ 的第二列是 $\\begin{pmatrix} 0 \\\\ -1 \\\\ 1 \\end{pmatrix}$。\n\n对于反应 $R_3: C \\rightarrow \\text{biomass}$：\n- 代谢物 $A$ 未参与。因此，$S_{13} = 0$。\n- 代谢物 $B$ 未参与。因此，$S_{23} = 0$。\n- 代谢物 $C$ 被消耗，化学计量为 $1$。因此，$S_{33} = -1$。\n（生物量是一个外部汇，在 $S$ 中没有对应的行）。\n$S$ 的第三列是 $\\begin{pmatrix} 0 \\\\ 0 \\\\ -1 \\end{pmatrix}$。\n\n结合这些列，化学计量矩阵 $S$ 是：\n$$ S = \\begin{pmatrix} -1  0  0 \\\\ 1  -1  0 \\\\ 0  1  -1 \\end{pmatrix} $$\n\n下一个任务是计算 $S$ 的秩，记为 $\\mathrm{rank}(S)$。矩阵的秩是由其列（或行）所张成的向量空间的维度，等价于线性无关的列（或行）的最大数量。矩阵 $S$ 是一个 $3 \\times 3$ 的方阵。它也是一个下三角矩阵。三角矩阵的行列式是其对角线元素的乘积。\n$$ \\det(S) = S_{11} \\times S_{22} \\times S_{33} = (-1) \\times (-1) \\times (-1) = -1 $$\n由于 $S$ 的行列式非零（$\\det(S) = -1 \\neq 0$），该矩阵是可逆的并且满秩。对于一个 $3 \\times 3$ 矩阵，满秩为 $3$。\n因此，$\\mathrm{rank}(S) = 3$。\n\n接下来的任务是计算 $S$ 的零空间维度，记为 $\\dim(\\ker S)$。$S$ 的零空间（或核）是满足方程 $S v = 0$ 的所有向量 $v$ 的集合。零空间的维度与矩阵的秩通过秩-零度定理相关联，该定理指出：\n$$ \\mathrm{rank}(S) + \\dim(\\ker S) = n $$\n其中 $n$ 是矩阵 $S$ 的列数。在这种情况下，$n=3$，对应于反应的数量。\n代入计算出的秩：\n$$ 3 + \\dim(\\ker S) = 3 $$\n$$ \\dim(\\ker S) = 3 - 3 = 0 $$\n因此，$S$ 的零空间维度为 $0$。\n\n最后，我们必须解释这些结果。\n方程 $S v = 0$ 代表稳态下的一组质量平衡约束。代谢物的生成速率和消耗速率必须相等。秩 $\\mathrm{rank}(S) = 3$ 表明，对于三个通量，存在三个线性无关的质量平衡约束，每个内部代谢物对应一个。这意味着没有一个代谢物平衡是冗余的。\n\n零空间 $\\ker S$ 代表所有可能的稳态通量分布 $v = (v_1, v_2, v_3)^T$ 的空间。零空间的维度 $\\dim(\\ker S)$ 给出了系统中的自由度数量。它是在满足稳态约束的同时可以自由选择的独立通量值的数量。非零维度意味着网络中存在内部循环或多个独立的通路。\n\n在这种情况下，$\\dim(\\ker S) = 0$。这表明自由度为零。系统 $S v = 0$ 的唯一解是零解 $v = (0, 0, 0)^T$。这意味着对于所建模的这个网络，唯一可能的稳态通量分布是所有通量都为零的分布。从结构角度来看，这是因为该网络是一个没有代谢物 $A$ 输入的简单线性链。为了使 $A$ 的浓度处于稳态，其通过 $R_1$ 的消耗速率必须为零，意味着 $v_1=0$。这反过来意味着 $v_2=0$ 以平衡代谢物 $B$，随后 $v_3=0$ 以平衡代谢物 $C$。这种特定的网络结构不允许任何非平凡的稳态通量。\n\n最终答案要求表示为一个包含 $\\mathrm{rank}(S)$ 和 $\\dim(\\ker S)$ 的行矩阵。\n$\\mathrm{rank}(S) = 3$\n$\\dim(\\ker S) = 0$\n该行矩阵是 $(3, 0)$。", "answer": "$$\n\\boxed{\\begin{pmatrix} 3  0 \\end{pmatrix}}\n$$", "id": "3339838"}, {"introduction": "在构建了化学计量矩阵之后，下一步是应用通量平衡分析（FBA）来预测细胞在特定目标（如最大化生长）下的代谢通量分布。本练习通过一个极简的双反应网络，让你能够解析地求解一个完整的FBA问题，从而直观地理解可行解空间、目标函数的优化过程，以及最优解的唯一性和简并性等核心概念。[@problem_id:3339878]", "problem": "考虑一个最小代谢网络，其中包含两个不可逆反应：$R_1: A \\rightarrow B$ 和 $R_2: B \\rightarrow \\varnothing$，其中 $\\varnothing$ 表示一个外部汇。假设代谢物 $A$ 是外部的，不受胞内质量平衡的约束，而代谢物 $B$ 是唯一受稳态约束的内源代谢物。因此，内源代谢物 $B$ 的化学计量矩阵为 $S \\in \\mathbb{R}^{1 \\times 2}$，其元素为 $S_{B,R_1} = 1$ 和 $S_{B,R_2} = -1$。在流平衡分析 (Flux Balance Analysis, FBA) 中，该方法寻求一个通量向量 $v \\in \\mathbb{R}^2$，使得线性目标函数 $c^{\\top} v$ 在稳态约束 $S v = 0$ 和边界 $l \\leq v \\leq u$ 的条件下最大化。\n\n给定目标权重 $c = (0, 1)$、下界 $l = (0, 0)$ 和上界 $u = (10, 10)$，请解析地求解该 FBA 问题。报告最优通量向量 $v^{\\star}$ 和最优目标值 $z^{\\star} = c^{\\top} v^{\\star}$。通过从 $S v = 0$ 和边界条件推导出可行集，从第一性原理明确论证你的解，并说明目标函数如何达到其最大值。然后，分析最优解是否唯一，并根据线性规划约束讨论最优解处的任何简并性。通量以 $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$（克干重 (gDW)）为单位表示，目标值也以 $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$ 为单位表示。由于最优值是精确值，因此无需四舍五入。", "solution": "该问题陈述是一个适定的线性规划问题，是流平衡分析 (FBA) 中的标准公式。所有必要信息均已提供，各组成部分在计算系统生物学领域内是自洽且有科学依据的。因此，该问题是有效的，我们可以继续进行求解。\n\n任务是解析地求解以下线性规划 (LP) 问题：\n最大化 $z = c^{\\top} v$\n约束条件：\n$S v = 0$\n$l \\leq v \\leq u$\n\n给定的参数如下：\n通量向量为 $v = \\begin{pmatrix} v_1 \\\\ v_2 \\end{pmatrix}$，对应于反应 $R_1$ 和 $R_2$ 的通量。\n单个内源代谢物 $B$ 的化学计量矩阵为 $S = \\begin{pmatrix} 1  -1 \\end{pmatrix}$。\n目标函数权重由向量 $c = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$ 给出。\n通量的下界和上界分别为 $l = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$ 和 $u = \\begin{pmatrix} 10 \\\\ 10 \\end{pmatrix}$。\n\n首先，我们明确写出目标函数和约束条件。\n需要最大化的目标函数是：\n$$z = c^{\\top} v = \\begin{pmatrix} 0  1 \\end{pmatrix} \\begin{pmatrix} v_1 \\\\ v_2 \\end{pmatrix} = 0 \\cdot v_1 + 1 \\cdot v_2 = v_2$$\n\n约束条件如下：\n$1$. 稳态质量平衡约束，$S v = 0$：\n$$\\begin{pmatrix} 1  -1 \\end{pmatrix} \\begin{pmatrix} v_1 \\\\ v_2 \\end{pmatrix} = 0$$\n$$v_1 - v_2 = 0 \\implies v_1 = v_2$$\n该约束意味着任何可行的通量分布都必须使反应 $R_1$（$B$ 的产生）和反应 $R_2$（$B$ 的消耗）的通量相等，这是维持代谢物 $B$ 浓度处于稳态所必需的。\n\n$2$. 通量边界，$l \\leq v \\leq u$:\n$$ \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} \\leq \\begin{pmatrix} v_1 \\\\ v_2 \\end{pmatrix} \\leq \\begin{pmatrix} 10 \\\\ 10 \\end{pmatrix} $$\n这可以展开为四个独立的不等式：\n$$v_1 \\geq 0$$\n$$v_2 \\geq 0$$\n$$v_1 \\leq 10$$\n$$v_2 \\leq 10$$\n\n为了找到最优解，我们必须首先定义满足所有约束条件的、所有可能通量向量 $v$ 的可行集。\n根据稳态约束，我们有 $v_1 = v_2$。将此代入边界不等式中：\n由于 $v_1 = v_2$，约束条件 $v_1 \\geq 0$ 和 $v_2 \\geq 0$ 是等价的。\n同样，约束条件 $v_1 \\leq 10$ 和 $v_2 \\leq 10$ 也是等价的。\n综合这些，我们发现可行集由所有满足以下条件的点 $(v_1, v_2)$ 描述：\n$$v_1 = v_2$$\n和\n$$0 \\leq v_1 \\leq 10$$\n在几何上，这个可行集是 $v_1$-$v_2$ 平面中从原点 $(0, 0)$ 开始到点 $(10, 10)$ 结束的线段。\n\n现在，我们来解决这个优化问题。我们希望在这个可行集上最大化目标函数 $z = v_2$。由于任何可行点都必须满足 $v_1 = v_2$，我们可以说对于任何可行的通量分布，都有 $z = v_2 = v_1$。在可行集上，$v_2$ 的值受 $0 \\leq v_2 \\leq 10$ 的约束。因此，$v_2$ 的最大可能值为 $10$。\n当 $v_2 = 10$ 时达到这个最大值。\n根据稳态约束，如果 $v_2 = 10$，那么 $v_1$ 也必须等于 $10$。\n因此，最优通量向量为：\n$$v^{\\star} = \\begin{pmatrix} v_1^{\\star} \\\\ v_2^{\\star} \\end{pmatrix} = \\begin{pmatrix} 10 \\\\ 10 \\end{pmatrix}$$\n最优目标值为：\n$$z^{\\star} = c^{\\top} v^{\\star} = v_2^{\\star} = 10$$\n根据问题陈述，通量和目标值以 $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$ 为单位表示。因此，$v_1^{\\star} = 10\\,\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$，$v_2^{\\star} = 10\\,\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$，以及 $z^{\\star} = 10\\,\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$。\n\n接下来，我们分析解的唯一性。可行集是连接 $(0,0)$ 和 $(10,10)$ 的线段。目标函数 $z = v_2$ 通过找到该线段上具有最大 $v_2$ 坐标的点来最大化。这明确地发生在端点 $(10, 10)$ 处。由于可行集中只有一个点可以达到最大目标值，因此最优解 $v^{\\star} = \\begin{pmatrix} 10 \\\\ 10 \\end{pmatrix}$ 是唯一的。\n\n最后，我们分析简并性。如果一个线性规划 (LP) 的顶点解中，起作用的约束（即等式成立的约束）数量多于空间的维度，则该解是简并的。变量空间 $(v_1, v_2)$ 是二维的 ($n=2$)。我们来检查最优解 $v^{\\star} = (10, 10)$ 处的约束条件：\n1. 质量平衡：$v_1 - v_2 = 10-10 = 0$。此约束起作用。\n2. $v_1$ 的下界：$v_1 \\geq 0$。即 $10 \\geq 0$，不起作用。\n3. $v_2$ 的下界：$v_2 \\geq 0$。即 $10 \\geq 0$，不起作用。\n4. $v_1$ 的上界：$v_1 \\leq 10$。即 $10 \\leq 10$，因此约束 $v_1 = 10$ 起作用。\n5. $v_2$ 的上界：$v_2 \\leq 10$。即 $10 \\leq 10$，因此约束 $v_2 = 10$ 起作用。\n\n在最优点 $(10, 10)$ 处，有三个起作用的约束：$v_1 - v_2 = 0$，$v_1 = 10$ 和 $v_2 = 10$。由于在二维空间中有三个约束起作用（即多于 $n=2$），因此最优解是简并的。在几何上，最优顶点 $(10, 10)$ 是三条线的交点，而在二维平面中的非简并顶点则恰好是两条线的交点。这种对顶点的过度确定性是简并性的标志。\n\n总之，最优通量向量是 $v^{\\star} = \\begin{pmatrix} 10 \\\\ 10 \\end{pmatrix}$，最优目标值是 $z^{\\star} = 10$，解是唯一的，并且是简并的。最终答案应报告 $v^{\\star}$ 的分量（$v_1^{\\star}$，$v_2^{\\star}$）的数值，后跟 $z^{\\star}$。", "answer": "$$\\boxed{\\begin{pmatrix} 10  10  10 \\end{pmatrix}}$$", "id": "3339878"}, {"introduction": "在真实的代谢网络中，最大化生长速率的最优解往往不是唯一的，这种现象被称为简并性。简约通量平衡分析（parsimonious Flux Balance Analysis, pFBA）是一种常用的高级技术，它通过在实现最大化主目标后，进一步最小化总通量消耗，从而在众多最优解中挑选出一个最高效的、生物学上更合理的解。这个计算练习将让你亲手实现pFBA的两步优化过程，体验如何利用计算方法处理简 nutty性问题，并获得对网络行为更精确的洞察。[@problem_id:3339908]", "problem": "给定一个以经典基于约束的建模形式表达的线性稳态代谢模型族。该模型由一个化学计量矩阵 $\\mathbf{S} \\in \\mathbb{R}^{m \\times n}$、一个通量向量 $\\mathbf{v} \\in \\mathbb{R}^{n}$、下界和上界 $\\mathbf{l}, \\mathbf{u} \\in \\mathbb{R}^{n}$（满足 $\\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}$）以及一个线性生物质目标向量 $\\mathbf{c} \\in \\mathbb{R}^{n}$ 组成。稳态（质量平衡）约束为 $\\mathbf{S}\\mathbf{v} = \\mathbf{0}$。主要目标是在约束条件下最大化生长速率 $\\mu = \\mathbf{c}^{\\top}\\mathbf{v}$。\n\n您的任务是实现一个称为简约通量平衡分析（parsimonious Flux Balance Analysis, pFBA）的字典序目标：首先，最大化 $\\mu$；其次，在所有实现最大生长速率 $\\mu^\\star$ 的通量向量中，最小化 $\\ell_1$ 范数 $\\lVert \\mathbf{v} \\rVert_1 = \\sum_{i=1}^{n} |v_i|$。在下述所有测试案例中，通量边界均为非负，因此 $|v_i| = v_i$，$\\ell_1$ 目标简化为最小化 $\\sum_{i=1}^{n} v_i$。\n\n从基于约束的建模的核心定义（稳态 $\\mathbf{S}\\mathbf{v}=\\mathbf{0}$、边界 $\\mathbf{l}\\le \\mathbf{v}\\le \\mathbf{u}$ 和线性目标 $\\mathbf{c}^{\\top}\\mathbf{v}$）出发，检验最优生长解的简并性：识别一个生长最优点位于高维面上的网络，然后使用 pFBA 来选择一个独特的表型。为了使之具有内在可测试性，请实现并求解以下三个案例。对于每个案例，您必须执行两阶段字典序优化，并计算“输出”下列出的量。所有计算必须是纯数值的；无需物理单位。\n\n基本设置（适用于所有案例）：\n- 稳态质量平衡：$\\mathbf{S}\\mathbf{v} = \\mathbf{0}$。\n- 边界：$\\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}$（逐分量不等式）。\n- 主要目标：最大化 $\\mu = \\mathbf{c}^{\\top}\\mathbf{v}$。\n- 次要目标（简约步骤）：最小化 $\\sum_{i=1}^{n} v_i$，约束条件为 $\\mathbf{S}\\mathbf{v} = \\mathbf{0}$，$\\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}$，以及 $\\mathbf{c}^{\\top}\\mathbf{v} = \\mu^\\star$，其中 $\\mu^\\star$ 是在主要步骤中实现的最大值。\n\n测试套件（三个案例）：\n- 案例 A（具有内部循环的简并生长最优点；pFBA 解析为独特的表型）。代谢物为内部的 $A, B, C$（外部池和生物质汇未进行平衡）。反应 $V_1,\\dots,V_6$：\n  1. $V_1$：摄取 $A_\\text{ext} \\to A$，\n  2. $V_2$：$A \\to \\text{生物质}$，\n  3. $V_3$：$A \\to B$，\n  4. $V_4$：$B \\to A$，\n  5. $V_5$：$A \\to C$，\n  6. $V_6$：$C \\to \\text{生物质}$。\n  化学计量矩阵 $\\mathbf{S} \\in \\mathbb{R}^{3 \\times 6}$，其行按 $(A,B,C)$ 顺序排列，列按 $(V_1,\\dots,V_6)$ 顺序排列，为\n  $$\n  \\mathbf{S} =\n  \\begin{bmatrix}\n  1  -1  -1  1  -1  0 \\\\\n  0  0  1  -1  0  0 \\\\\n  0  0  0  0  1  -1\n  \\end{bmatrix}.\n  $$\n  边界（逐分量）：$\\mathbf{l} = \\mathbf{0}$，$\\mathbf{u} = [10, 1000, 1000, 1000, 1000, 1000]^{\\top}$。生物质目标：$\\mathbf{c} = [0, 1, 0, 0, 0, 1]^{\\top}$，因此 $\\mu = v_2 + v_6$。\n\n- 案例 B（零摄取的边界情况）。与案例 A 相同的 $\\mathbf{S}$ 和 $\\mathbf{c}$，但 $\\mathbf{u} = [0, 1000, 1000, 1000, 1000, 1000]^{\\top}$（即 $V_1$ 的上界为 $0$，而所有其他反应的上界仍为 $1000$）。下界保持为 $\\mathbf{l} = \\mathbf{0}$。\n\n- 案例 C（具有重复并行生物质途径的简并生长最优点；pFBA 未能完全解析唯一性）。在案例 A 的基础上增加第七个反应 $V_7$：$A \\to \\text{生物质}$，该反应是 $V_2$ 的一个副本。化学计量矩阵 $\\mathbf{S} \\in \\mathbb{R}^{3 \\times 7}$ 为\n  $$\n  \\mathbf{S} =\n  \\begin{bmatrix}\n  1  -1  -1  1  -1  0  -1 \\\\\n  0  0  1  -1  0  0  0 \\\\\n  0  0  0  0  1  -1  0\n  \\end{bmatrix}.\n  $$\n  边界（逐分量）：$\\mathbf{l} = \\mathbf{0}$，$\\mathbf{u} = [10, 1000, 1000, 1000, 1000, 1000, 1000]^{\\top}$。生物质目标：$\\mathbf{c} = [0, 1, 0, 0, 0, 1, 1]^{\\top}$，因此 $\\mu = v_2 + v_6 + v_7$。\n\n每个案例所需的输出：\n- 计算主要最优点 $\\mu^\\star = \\max\\{\\mathbf{c}^{\\top}\\mathbf{v}: \\mathbf{S}\\mathbf{v} = \\mathbf{0}, \\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}\\}$ 并将其报告为四舍五入到 $6$ 位小数的浮点数。\n- 计算只考虑等式约束时最优面的维度 $d$，其定义为\n  $$\n  d \\equiv n - \\operatorname{rank}(\\mathbf{A}_\\text{eq}), \\quad \\text{其中 } \\mathbf{A}_\\text{eq} =\n  \\begin{bmatrix}\n  \\mathbf{S} \\\\\n  \\mathbf{c}^{\\top}\n  \\end{bmatrix}.\n  $$\n  将 $d$ 报告为整数。此处的 $d$ 计算了仿射子空间 $\\{\\mathbf{v}: \\mathbf{S}\\mathbf{v}=\\mathbf{0}, \\mathbf{c}^{\\top}\\mathbf{v}=\\mu^\\star\\}$ 的自由度，忽略了哪些边界不等式恰好是激活的。\n- 计算 pFBA 次要最优点值 $z^\\star = \\min\\{\\sum_{i=1}^{n} v_i: \\mathbf{S}\\mathbf{v}=\\mathbf{0}, \\mathbf{l}\\le \\mathbf{v}\\le \\mathbf{u}, \\mathbf{c}^{\\top}\\mathbf{v}=\\mu^\\star\\}$ 及其对应的通量向量 $\\mathbf{v}^\\star$。将 $z^\\star$ 报告为四舍五入到 $6$ 位小数的浮点数，并将 $\\mathbf{v}^\\star$ 报告为四舍五入到 $6$ 位小数的浮点数列表。\n- 确定 pFBA 解是否唯一，通过测试是否存在一个非零方向 $\\mathbf{h} \\neq \\mathbf{0}$，该方向保持所有等式和 pFBA 目标不变，即：\n  $$\n  \\mathbf{S}\\mathbf{h} = \\mathbf{0}, \\quad \\mathbf{c}^{\\top}\\mathbf{h} = 0, \\quad \\mathbf{1}^{\\top}\\mathbf{h} = 0,\n  $$\n  并且可以被一个足够小的 $\\delta > 0$ 缩放，从而使 $\\mathbf{l} \\le \\mathbf{v}^\\star \\pm \\delta \\mathbf{h} \\le \\mathbf{u}$ 仍然满足。如果存在这样的方向，则输出布尔值 false；否则，输出 true。步长测试使用 $10^{-9}$ 的数值公差。\n- 最终输出格式：您的程序应生成单行输出，其中包含三个案例的结果，结果为用方括号括起来的逗号分隔列表。每个案例的结果本身必须是结构化的列表，格式为\n  $$\n  [\\mu^\\star, z^\\star, d, \\text{is\\_unique}, \\mathbf{v}^\\star],\n  $$\n  其中 $\\mu^\\star$ 和 $z^\\star$ 是浮点数（四舍五入到 $6$ 位小数），$d$ 是整数，is_unique 是一个布尔值，$\\mathbf{v}^\\star$ 是浮点数列表（四舍五入到 $6$ 位小数）。例如，一个语法有效的三案例输出行看起来像\n  $$\n  [[0.000000,0.000000,0,true,[0.000000,0.000000]], [\\dots], [\\dots]].\n  $$\n\n您的实现必须求解指定的线性规划问题，使用标准数值线性代数计算矩阵的秩，并实现上述小步长可行性测试以评估唯一性。输出必须使用所描述的精确格式，所有浮点数四舍五入到 $6$ 位小数。", "solution": "该解决方案需要一个两阶段线性规划方法来实现简约通量平衡分析（pFBA），然后分析解的唯一性。\n\n**阶段 1：最大化生长速率**\n\n第一步是找到最大可能的生长速率 $\\mu^\\star$。这通过求解以下线性规划（LP）问题来实现：\n$$\n\\begin{aligned}\n\\text{maximize} \\quad  \\mu = \\mathbf{c}^{\\top}\\mathbf{v} \\\\\n\\text{subject to} \\quad  \\mathbf{S}\\mathbf{v} = \\mathbf{0} \\\\\n \\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}\n\\end{aligned}\n$$\n这是一个标准的 LP 问题。最大化 $\\mathbf{c}^{\\top}\\mathbf{v}$ 等价于最小化 $(-\\mathbf{c})^{\\top}\\mathbf{v}$。\n\n**阶段 2：最小化总通量（简约性）**\n\n第二步是从所有实现最大生长速率 $\\mu^\\star$ 的通量分布集合中，选择一个使总通量绝对值之和最小的分布。由于所有通量都被约束为非负（$\\mathbf{l}=\\mathbf{0}$），这简化为最小化所有通量之和。这可表述为第二个 LP：\n$$\n\\begin{aligned}\n\\text{minimize} \\quad  z = \\sum_{i=1}^{n} v_i = \\mathbf{1}^{\\top}\\mathbf{v} \\\\\n\\text{subject to} \\quad  \\mathbf{S}\\mathbf{v} = \\mathbf{0} \\\\\n \\mathbf{c}^{\\top}\\mathbf{v} = \\mu^\\star \\\\\n \\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}\n\\end{aligned}\n$$\n此 LP 的解给出了简约通量总和 $z^\\star$ 和对应的最优通量向量 $\\mathbf{v}^\\star$。请注意，对于非唯一的 pFBA 解，求解器将从最优解集中返回一个特定的点。\n\n**最优面维度 $d$ 的计算**\n\n问题将 $d$ 定义为满足稳态和最大生长等式约束的通量向量仿射子空间的维度，忽略边界。这等价于组合约束矩阵 $\\mathbf{A}_{\\text{eq}} = \\begin{bmatrix} \\mathbf{S} \\\\ \\mathbf{c}^{\\top} \\end{bmatrix}$ 的零空间维度。该维度计算如下：\n$$\nd = n - \\operatorname{rank}(\\mathbf{A}_{\\text{eq}})\n$$\n其中 $n$ 是通量的数量（$\\mathbf{S}$ 的列数）。\n\n**唯一性检验**\n\npFBA 解 $\\mathbf{v}^\\star$ 的唯一性是根据提供的特定标准来评估的。如果存在一个非零方向向量 $\\mathbf{h} \\in \\mathbb{R}^n$，使得从 $\\mathbf{v}^\\star$ 沿 $\\mathbf{h}$（正向和负向）移动时保持可行性和最优性，则解被认为是不唯一的。这需要满足：\n1.  $\\mathbf{S}\\mathbf{h} = \\mathbf{0}$（保持稳态）\n2.  $\\mathbf{c}^{\\top}\\mathbf{h} = 0$（保持最大生长）\n3.  $\\mathbf{1}^{\\top}\\mathbf{h} = 0$（保持最小总通量）\n4.  对于某个足够小的标量 $\\delta > 0$，$\\mathbf{l} \\le \\mathbf{v}^\\star \\pm \\delta \\mathbf{h} \\le \\mathbf{u}$ 仍然成立。\n\n条件 4 是最具限制性的。要使其成立，$\\mathbf{h}$ 的任何非零分量 $h_i$ 都必须对应一个严格介于其下界和上界之间的通量 $v_i^\\star$（$l_i  v_i^\\star  u_i$）。如果 $v_i^\\star$ 处于边界上，我们无法在两个方向上移动，因此必须有 $h_i=0$。\n\n因此，唯一性检验可以通过算法实现如下：\n1.  识别通量指数集 $I_{active}$，其中 $\\mathbf{v}^\\star$ 中对应的通量位于其下界或上界：$I_{active} = \\{ i \\mid v_i^\\star = l_i \\text{ or } v_i^\\star = u_i \\}$。\n2.  通过将条件 1-3 中的矩阵与强制所有 $i \\in I_{active}$ 的 $h_i=0$ 的约束进行增广，来构造矩阵 $\\mathbf{A}_{\\text{test}}$。$\\mathbf{A}_{\\text{test}}$ 的行是 $\\mathbf{S}$ 的行、$\\mathbf{c}^{\\top}$、$\\mathbf{1}^{\\top}$ 以及每个 $i \\in I_{active}$ 的标准基向量 $\\mathbf{e}_i^\\top$。\n3.  我们正在寻找 $\\mathbf{A}_{\\text{test}}\\mathbf{h} = \\mathbf{0}$ 的一个非零解。是否存在这样的解取决于 $\\mathbf{A}_{\\text{test}}$ 的零度。零度由 $n - \\operatorname{rank}(\\mathbf{A}_{\\text{test}})$ 给出。\n4.  如果零度大于 0，则存在一个有效的非零 $\\mathbf{h}$，根据指定标准，解 $\\mathbf{v}^\\star$ 不是唯一的。否则，解是唯一的。\n\n此过程将应用于三个测试案例中的每一个，使用数值方法求解 LP 和计算矩阵秩。使用内点法 LP 求解器非常重要，因为它倾向于在最优面的中心找到解，这对于简并情况（如案例 C）下的唯一性检验至关重要。\n\n---\n### Python 实现\n\n```python\nimport numpy as np\nfrom scipy.optimize import linprog\nfrom scipy.linalg import null_space\n\ndef solve_pfba_problem():\n    \"\"\"\n    Solves the pFBA problem for the three specified test cases and returns the final formatted string.\n    \"\"\"\n    \n    # --- Define Test Cases ---\n\n    # Case A\n    S_A = np.array([\n        [1., -1., -1., 1., -1., 0.],\n        [0., 0., 1., -1., 0., 0.],\n        [0., 0., 0., 0., 1., -1.]\n    ])\n    c_A = np.array([0., 1., 0., 0., 0., 1.])\n    l_A = np.zeros(6)\n    u_A = np.array([10., 1000., 1000., 1000., 1000., 1000.])\n    case_A = (\"A\", S_A, c_A, l_A, u_A)\n\n    # Case B\n    u_B = np.array([0., 1000., 1000., 1000., 1000., 1000.])\n    case_B = (\"B\", S_A, c_A, l_A, u_B)\n\n    # Case C\n    S_C = np.array([\n        [1., -1., -1., 1., -1., 0., -1.],\n        [0., 0., 1., -1., 0., 0., 0.],\n        [0., 0., 0., 0., 1., -1., 0.]\n    ])\n    c_C = np.array([0., 1., 0., 0., 0., 1., 1.])\n    l_C = np.zeros(7)\n    u_C = np.array([10., 1000., 1000., 1000., 1000., 1000., 1000.])\n    case_C = (\"C\", S_C, c_C, l_C, u_C)\n\n    test_cases = [case_A, case_B, case_C]\n    results_str_list = []\n\n    for name, S, c_biomass, l, u in test_cases:\n        result = run_case(S, c_biomass, l, u)\n        results_str_list.append(format_result(result))\n\n    return f\"[{','.join(results_str_list)}]\"\n\n\ndef run_case(S, c_biomass, l, u):\n    \"\"\"\n    Performs pFBA and associated analysis for a single case.\n    \"\"\"\n    m, n = S.shape\n    bounds = list(zip(l, u))\n    tol = 1e-9\n\n    # --- Step 1: Maximize biomass (Primary Objective) ---\n    res_1 = linprog(c=-c_biomass, A_eq=S, b_eq=np.zeros(m), bounds=bounds, method='highs')\n    \n    if res_1.success:\n        mu_star = -res_1.fun\n    else:\n        # Handle cases where the only solution is trivial (v=0)\n        if np.all(l = tol) and np.all(u >= -tol) and np.allclose(S @ np.zeros(n), 0):\n             mu_star = c_biomass @ np.zeros(n)\n        else:\n            raise RuntimeError(f\"LP1 (FBA) failed to solve: {res_1.message}\")\n\n    # --- Step 2: Calculate dimension d ---\n    A_eq_d = np.vstack([S, c_biomass.reshape(1, -1)])\n    rank_A_eq_d = np.linalg.matrix_rank(A_eq_d, tol=tol)\n    d = n - rank_A_eq_d\n\n    # --- Step 3: Minimize sum of fluxes (Secondary Objective) ---\n    A_eq_2 = np.vstack([S, c_biomass.reshape(1, -1)])\n    b_eq_2 = np.concatenate([np.zeros(m), [mu_star]])\n    c_pfba = np.ones(n)\n\n    res_2 = linprog(c=c_pfba, A_eq=A_eq_2, b_eq=b_eq_2, bounds=bounds, method='highs')\n    \n    if res_2.success:\n        z_star = res_2.fun\n        v_star = res_2.x\n    else:\n        # Handle trivial zero solution if solver fails\n        if abs(mu_star)  tol and np.allclose(l, 0):\n            z_star = 0.0\n            v_star = np.zeros(n)\n        else:\n            raise RuntimeError(f\"LP2 (pFBA) failed to solve: {res_2.message}\")\n\n    # --- Step 4: Check uniqueness of the pFBA solution ---\n    A_unq = np.vstack([S, c_biomass.reshape(1, -1), np.ones(n).reshape(1, -1)])\n    \n    active_indices = [\n        i for i in range(n) \n        if np.isclose(v_star[i], l[i], atol=tol) or np.isclose(v_star[i], u[i], atol=tol)\n    ]\n\n    A_test_rows = [A_unq]\n    if active_indices:\n        E = np.zeros((len(active_indices), n))\n        for i, idx in enumerate(active_indices):\n            E[i, idx] = 1.0\n        A_test_rows.append(E)\n    A_test = np.vstack(A_test_rows)\n    \n    rank_A_test = np.linalg.matrix_rank(A_test, tol=tol)\n    nullity = n - rank_A_test\n    is_unique = (nullity == 0)\n    \n    return [mu_star, z_star, d, is_unique, v_star]\n\n\ndef format_result(result):\n    \"\"\"\n    Formats a single case's result into the required string format.\n    \"\"\"\n    mu_star, z_star, d, is_unique, v_star = result\n    \n    mu_str = f\"{mu_star:.6f}\"\n    z_str = f\"{z_star:.6f}\"\n    d_str = str(d)\n    unique_str = str(is_unique).lower()\n    \n    v_list_str = [f\"{v:.6f}\" for v in v_star]\n    v_str = f\"[{','.join(v_list_str)}]\"\n    \n    return f\"[{mu_str},{z_str},{d_str},{unique_str},{v_str}]\"\n```", "answer": "[[10.000000,20.000000,2,true,[10.000000,10.000000,0.000000,0.000000,0.000000,0.000000]],[0.000000,0.000000,2,true,[0.000000,0.000000,0.000000,0.000000,0.000000,0.000000]],[10.000000,20.000000,3,false,[10.000000,0.000000,0.000000,0.000000,0.000000,0.000000,10.000000]]]", "id": "3339908"}]}