{"hands_on_practices": [{"introduction": "理论学习的下一步是将其应用于更复杂的几何结构。这个练习将引导我们超越简单的笛卡尔网格，直接将散度定理应用于极坐标系中的几何控制体。通过从第一性原理出发，你将学会如何正确处理曲线坐标系下的度量项，以确保离散格式严格保持守恒性，这是在非结构网格或复杂几何域上进行数值模拟的关键一步 [@problem_id:3409398]。", "problem": "考虑一个在欧几里得平面中用极坐标表示的稳态守恒律，该守恒律描述了一个标量被一个通量场所输运的过程。设 $\\mathbf{f}(r,\\theta)=f_{r}(r,\\theta)\\,\\mathbf{e}_{r}+f_{\\theta}(r,\\theta)\\,\\mathbf{e}_{\\theta}$ 是一个足够光滑的通量矢量场，其中 $\\mathbf{e}_{r}$ 和 $\\mathbf{e}_{\\theta}$ 是极坐标单位基向量。以散度定理为基本出发点，为极坐标控制体 $\\mathcal{C}_{i,j}=[r_{i-\\frac{1}{2}},r_{i+\\frac{1}{2}}]\\times[\\theta_{j-\\frac{1}{2}},\\theta_{j+\\frac{1}{2}}]$ 上的单元平均散度推导一个度量一致的有限体积法（Finite Volume Method, FVM）离散格式。您的推导必须从适用于极坐标的积分守恒形式 $\\iint_{\\mathcal{C}_{i,j}} \\nabla\\cdot\\mathbf{f}\\, \\mathrm{d}A=\\oint_{\\partial\\mathcal{C}_{i,j}} \\mathbf{f}\\cdot \\mathbf{n}\\,\\mathrm{d}s$ 开始，并且必须明确展示在面上和面积中正确的 $r$ 加权度量。不要假设任何关于曲线坐标的“快捷”公式；相反，应从极坐标中控制体的几何形状出发进行推导。\n\n然后，对于一个具有 $r$ 边 $R_{1}=r_{i-\\frac{1}{2}}$ 和 $R_{2}=r_{i+\\frac{1}{2}}$ 以及角边 $\\Theta_{1}=\\theta_{j-\\frac{1}{2}}$ 和 $\\Theta_{2}=\\theta_{j+\\frac{1}{2}}$ 的单个环扇形控制体，将您推导的度量一致的 FVM 公式（使用精确的面积分）应用于通量场\n$$\nf_{r}(r,\\theta)=a\\,r^{2}\\cos\\theta,\\qquad f_{\\theta}(r,\\theta)=b\\,r^{3}\\sin\\!\\bigl(2\\theta\\bigr),\n$$\n其中 $a$ 和 $b$ 是常数。请给出离散单元平均散度 $\\langle \\nabla\\cdot\\mathbf{f}\\rangle_{i,j}$ 关于 $a$、$b$、$R_{1}$、$R_{2}$、$\\Theta_{1}$ 和 $\\Theta_{2}$ 的最终闭式表达式。最终答案必须是单个解析表达式。不需要进行数值取整。请明确写出最终表达式。缩略词在首次使用时必须进行定义，例如，偏微分方程（Partial Differential Equation, PDE）和有限体积法（Finite Volume Method, FVM）。", "solution": "该问题具有科学依据，提法得当，客观，并包含了推导唯一解析解所需的所有必要信息。这是求解偏微分方程（Partial Differential Equations, PDEs）的一个标准练习。因此，该问题是有效的，并将提供解答。\n\n有限体积法（Finite Volume Method, FVM）的核心是守恒律积分形式的离散化。我们得到控制体 $\\mathcal{C}_{i,j}$ 上的稳态守恒律积分形式为：\n$$\n\\iint_{\\mathcal{C}_{i,j}} \\nabla\\cdot\\mathbf{f}\\, \\mathrm{d}A = \\oint_{\\partial\\mathcal{C}_{i,j}} \\mathbf{f}\\cdot \\mathbf{n}\\,\\mathrm{d}s\n$$\n其中 $\\mathbf{f}$ 是通量矢量，$\\mathbf{n}$ 是边界 $\\partial\\mathcal{C}_{i,j}$ 的外指单位法向量，$\\mathrm{d}A$ 是微分面积元，$\\mathrm{d}s$ 是沿边界的微分线元。\n\n单元平均散度，记作 $\\langle \\nabla\\cdot\\mathbf{f}\\rangle_{i,j}$，定义为单元内的总散度除以单元面积 $A_{i,j}$：\n$$\n\\langle \\nabla\\cdot\\mathbf{f}\\rangle_{i,j} = \\frac{1}{A_{i,j}} \\iint_{\\mathcal{C}_{i,j}} \\nabla\\cdot\\mathbf{f}\\, \\mathrm{d}A\n$$\n代入散度定理，得到基本的 FVM 公式：\n$$\n\\langle \\nabla\\cdot\\mathbf{f}\\rangle_{i,j} = \\frac{1}{A_{i,j}} \\oint_{\\partial\\mathcal{C}_{i,j}} \\mathbf{f}\\cdot \\mathbf{n}\\,\\mathrm{d}s\n$$\n\n我们的任务是计算极坐标下控制体公式的右侧。控制体 $\\mathcal{C}_{i,j}$ 是一个由 $r \\in [r_{i-\\frac{1}{2}}, r_{i+\\frac{1}{2}}]$ 和 $\\theta \\in [\\theta_{j-\\frac{1}{2}}, \\theta_{j+\\frac{1}{2}}]$ 定义的环扇形区域。边界 $\\partial\\mathcal{C}_{i,j}$ 由四个面组成：\n$1$. 位于 $r = r_{i+\\frac{1}{2}}$ 的外面，$\\theta$ 从 $\\theta_{j-\\frac{1}{2}}$ 变化到 $\\theta_{j+\\frac{1}{2}}$。此处，外法线为 $\\mathbf{n} = \\mathbf{e}_r$，微分弧长为 $\\mathrm{d}s = r_{i+\\frac{1}{2}}\\mathrm{d}\\theta$。\n$2$. 位于 $r = r_{i-\\frac{1}{2}}$ 的内面，$\\theta$ 在此变化。外法线为 $\\mathbf{n} = -\\mathbf{e}_r$，弧长为 $\\mathrm{d}s = r_{i-\\frac{1}{2}}\\mathrm{d}\\theta$。\n$3$. 位于 $\\theta = \\theta_{j+\\frac{1}{2}}$ 的顺时针方向的面， $r$ 从 $r_{i-\\frac{1}{2}}$ 变化到 $r_{i+\\frac{1}{2}}$。外法线为 $\\mathbf{n} = \\mathbf{e}_\\theta$，线元为 $\\mathrm{d}s = \\mathrm{d}r$。\n$4$. 位于 $\\theta = \\theta_{j-\\frac{1}{2}}$ 的逆时针方向的面，$r$ 在此变化。外法线为 $\\mathbf{n} = -\\mathbf{e}_\\theta$，线元为 $\\mathrm{d}s = \\mathrm{d}r$。\n\n通量矢量以极坐标分量形式给出为 $\\mathbf{f} = f_r \\mathbf{e}_r + f_\\theta \\mathbf{e}_\\theta$。通过边界的总通量 $\\oint \\mathbf{f}\\cdot\\mathbf{n}\\,\\mathrm{d}s$ 是通过这四个面的通量之和：\n\\begin{align*}\n\\oint_{\\partial\\mathcal{C}_{i,j}} \\mathbf{f}\\cdot \\mathbf{n}\\,\\mathrm{d}s = \\int_{\\theta_{j-\\frac{1}{2}}}^{\\theta_{j+\\frac{1}{2}}} \\mathbf{f}(r_{i+\\frac{1}{2}}, \\theta) \\cdot \\mathbf{e}_r \\, (r_{i+\\frac{1}{2}} \\mathrm{d}\\theta) \\\\\n+ \\int_{\\theta_{j-\\frac{1}{2}}}^{\\theta_{j+\\frac{1}{2}}} \\mathbf{f}(r_{i-\\frac{1}{2}}, \\theta) \\cdot (-\\mathbf{e}_r) \\, (r_{i-\\frac{1}{2}} \\mathrm{d}\\theta) \\\\\n+ \\int_{r_{i-\\frac{1}{2}}}^{r_{i+\\frac{1}{2}}} \\mathbf{f}(r, \\theta_{j+\\frac{1}{2}}) \\cdot \\mathbf{e}_\\theta \\, \\mathrm{d}r \\\\\n+ \\int_{r_{i-\\frac{1}{2}}}^{r_{i+\\frac{1}{2}}} \\mathbf{f}(r, \\theta_{j-\\frac{1}{2}}) \\cdot (-\\mathbf{e}_\\theta) \\, \\mathrm{d}r\n\\end{align*}\n计算点积可得：\n\\begin{align*}\n\\oint_{\\partial\\mathcal{C}_{i,j}} \\mathbf{f}\\cdot \\mathbf{n}\\,\\mathrm{d}s = \\int_{\\theta_{j-\\frac{1}{2}}}^{\\theta_{j+\\frac{1}{2}}} f_r(r_{i+\\frac{1}{2}}, \\theta) r_{i+\\frac{1}{2}} \\mathrm{d}\\theta - \\int_{\\theta_{j-\\frac{1}{2}}}^{\\theta_{j+\\frac{1}{2}}} f_r(r_{i-\\frac{1}{2}}, \\theta) r_{i-\\frac{1}{2}} \\mathrm{d}\\theta \\\\\n+ \\int_{r_{i-\\frac{1}{2}}}^{r_{i+\\frac{1}{2}}} f_\\theta(r, \\theta_{j+\\frac{1}{2}}) \\mathrm{d}r - \\int_{r_{i-\\frac{1}{2}}}^{r_{i+\\frac{1}{2}}} f_\\theta(r, \\theta_{j-\\frac{1}{2}}) \\mathrm{d}r\n\\end{align*}\n此表达式正确地展示了径向通量分量的 $r$ 加权度量，因为弧长元为 $\\mathrm{d}s = r \\mathrm{d}\\theta$。通量分量 $f_r$ 乘以面长 $r \\mathrm{d}\\theta$，从而得到项 $r f_r$。\n\n控制体 $A_{i,j}$ 的面积通过对极坐标面积元 $\\mathrm{d}A = r\\,\\mathrm{d}r\\,\\mathrm{d}\\theta$ 积分得到：\n$$\nA_{i,j} = \\int_{\\theta_{j-\\frac{1}{2}}}^{\\theta_{j+\\frac{1}{2}}} \\int_{r_{i-\\frac{1}{2}}}^{r_{i+\\frac{1}{2}}} r\\,\\mathrm{d}r\\,\\mathrm{d}\\theta = \\left(\\int_{\\theta_{j-\\frac{1}{2}}}^{\\theta_{j+\\frac{1}{2}}} \\mathrm{d}\\theta\\right) \\left(\\int_{r_{i-\\frac{1}{2}}}^{r_{i+\\frac{1}{2}}} r\\,\\mathrm{d}r\\right) = (\\theta_{j+\\frac{1}{2}} - \\theta_{j-\\frac{1}{2}}) \\left[\\frac{1}{2}r^2\\right]_{r_{i-\\frac{1}{2}}}^{r_{i+\\frac{1}{2}}} = \\frac{1}{2}(\\theta_{j+\\frac{1}{2}} - \\theta_{j-\\frac{1}{2}})(r_{i+\\frac{1}{2}}^2 - r_{i-\\frac{1}{2}}^2)\n$$\n结合这些结果，得到基于精确面积分的单元平均散度的一般度量一致 FVM 离散格式：\n$$\n\\langle \\nabla\\cdot\\mathbf{f}\\rangle_{i,j} = \\frac{1}{A_{i,j}} \\left[ \\int_{\\theta_{j-\\frac{1}{2}}}^{\\theta_{j+\\frac{1}{2}}} \\left(r f_r\\right)|_{r=r_{i+\\frac{1}{2}}} \\mathrm{d}\\theta - \\int_{\\theta_{j-\\frac{1}{2}}}^{\\theta_{j+\\frac{1}{2}}} \\left(r f_r\\right)|_{r=r_{i-\\frac{1}{2}}} \\mathrm{d}\\theta + \\int_{r_{i-\\frac{1}{2}}}^{r_{i+\\frac{1}{2}}} f_\\theta|_{\\theta=\\theta_{j+\\frac{1}{2}}} \\mathrm{d}r - \\int_{r_{i-\\frac{1}{2}}}^{r_{i+\\frac{1}{2}}} f_\\theta|_{\\theta=\\theta_{j-\\frac{1}{2}}} \\mathrm{d}r \\right]\n$$\n\n现在，我们将此公式应用于特定的通量场和控制体。\n边界为 $r_{i-\\frac{1}{2}} = R_1$，$r_{i+\\frac{1}{2}} = R_2$，$\\theta_{j-\\frac{1}{2}} = \\Theta_1$ 和 $\\theta_{j+\\frac{1}{2}} = \\Theta_2$。通量分量为 $f_r(r,\\theta) = a r^2 \\cos\\theta$ 和 $f_\\theta(r,\\theta) = b r^3 \\sin(2\\theta)$。\n\n控制体的面积为：\n$$\nA = \\frac{1}{2}(\\Theta_2 - \\Theta_1)(R_2^2 - R_1^2)\n$$\n\n接下来，我们精确计算四个边界积分：\n$1$. 在外面 $r=R_2$ 上的积分：\n$$\n\\int_{\\Theta_1}^{\\Theta_2} (r f_r)|_{r=R_2} \\mathrm{d}\\theta = \\int_{\\Theta_1}^{\\Theta_2} R_2 (a R_2^2 \\cos\\theta) \\mathrm{d}\\theta = a R_2^3 \\int_{\\Theta_1}^{\\Theta_2} \\cos\\theta \\mathrm{d}\\theta = a R_2^3 [\\sin\\theta]_{\\Theta_1}^{\\Theta_2} = a R_2^3 (\\sin\\Theta_2 - \\sin\\Theta_1)\n$$\n$2$. 在内面 $r=R_1$ 上的积分：\n$$\n\\int_{\\Theta_1}^{\\Theta_2} (r f_r)|_{r=R_1} \\mathrm{d}\\theta = \\int_{\\Theta_1}^{\\Theta_2} R_1 (a R_1^2 \\cos\\theta) \\mathrm{d}\\theta = a R_1^3 \\int_{\\Theta_1}^{\\Theta_2} \\cos\\theta \\mathrm{d}\\theta = a R_1^3 (\\sin\\Theta_2 - \\sin\\Theta_1)\n$$\n来自径向面的净通量是这两者之差：$a (R_2^3 - R_1^3)(\\sin\\Theta_2 - \\sin\\Theta_1)$。\n\n$3$. 在顺时针面 $\\theta=\\Theta_2$ 上的积分：\n$$\n\\int_{R_1}^{R_2} f_\\theta|_{\\theta=\\Theta_2} \\mathrm{d}r = \\int_{R_1}^{R_2} b r^3 \\sin(2\\Theta_2) \\mathrm{d}r = b \\sin(2\\Theta_2) \\left[\\frac{1}{4}r^4\\right]_{R_1}^{R_2} = \\frac{b}{4} \\sin(2\\Theta_2) (R_2^4 - R_1^4)\n$$\n$4$. 在逆时针面 $\\theta=\\Theta_1$ 上的积分：\n$$\n\\int_{R_1}^{R_2} f_\\theta|_{\\theta=\\Theta_1} \\mathrm{d}r = \\int_{R_1}^{R_2} b r^3 \\sin(2\\Theta_1) \\mathrm{d}r = b \\sin(2\\Theta_1) \\left[\\frac{1}{4}r^4\\right]_{R_1}^{R_2} = \\frac{b}{4} \\sin(2\\Theta_1) (R_2^4 - R_1^4)\n$$\n来自角向面的净通量是其差值：$\\frac{b}{4} (R_2^4 - R_1^4)(\\sin(2\\Theta_2) - \\sin(2\\Theta_1))$。\n\n总出射通量是径向面和角向面净通量之和：\n$$\n\\oint \\mathbf{f}\\cdot \\mathbf{n}\\,\\mathrm{d}s = a(R_2^3 - R_1^3)(\\sin\\Theta_2 - \\sin\\Theta_1) + \\frac{b}{4}(R_2^4 - R_1^4)(\\sin(2\\Theta_2) - \\sin(2\\Theta_1))\n$$\n最后，离散单元平均散度是该总通量除以单元面积：\n$$\n\\langle \\nabla\\cdot\\mathbf{f}\\rangle_{i,j} = \\frac{a(R_2^3 - R_1^3)(\\sin\\Theta_2 - \\sin\\Theta_1) + \\frac{b}{4}(R_2^4 - R_1^4)(\\sin(2\\Theta_2) - \\sin(2\\Theta_1))}{\\frac{1}{2}(\\Theta_2 - \\Theta_1)(R_2^2 - R_1^2)}\n$$\n通过将分母中的因子 $\\frac{1}{2}$ 移到分子上变为因子 $2$，可将此表达式重写为：\n$$\n\\langle \\nabla\\cdot\\mathbf{f}\\rangle_{i,j} = \\frac{2}{(\\Theta_2 - \\Theta_1)(R_2^2 - R_1^2)} \\left[ a(R_2^3 - R_1^3)(\\sin\\Theta_2 - \\sin\\Theta_1) + \\frac{b}{4}(R_2^4 - R_1^4)(\\sin(2\\Theta_2) - \\sin(2\\Theta_1)) \\right]\n$$\n这就是最终的闭式表达式。", "answer": "$$\n\\boxed{\\frac{2}{(\\Theta_2 - \\Theta_1)(R_2^2 - R_1^2)} \\left[ a(R_2^3 - R_1^3)(\\sin\\Theta_2 - \\sin\\Theta_1) + \\frac{b}{4}(R_2^4 - R_1^4)(\\sin(2\\Theta_2) - \\sin(2\\Theta_1)) \\right]}\n$$", "id": "3409398"}, {"introduction": "在掌握了通量离散化的基本思想后，是时候构建一个完整的求解器来处理含时问题了。本练习将聚焦于经典的非线性守恒律——无粘伯格斯方程，它以其有限时间内形成激波的特性而闻名。你将亲手实现并比较两种在计算流体力学中至关重要的数值通量格式：Lax-Friedrichs分裂格式和HLL格式，并定量分析数值熵耗散，以验证解的物理正确性 [@problem_id:3409438]。", "problem": "考虑一维无粘 Burgers 方程的标量守恒律，其偏微分方程 (PDE) 如下\n$$\n\\partial_t u + \\partial_x f(u) = 0,\\quad f(u) = \\frac{u^2}{2},\n$$\n该方程定义在周期为 $1$ 的周期性区域 $[0,1)$ 上。从控制体上的积分守恒律出发，即\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d} t} \\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} u(x,t)\\,\\mathrm{d}x + \\left[f\\big(u(x_{i+\\frac{1}{2}}^{-},t)\\big) - f\\big(u(x_{i-\\frac{1}{2}}^{+},t)\\big)\\right] = 0,\n$$\n并将空间域离散为 $N$ 个宽度为 $\\Delta x = 1/N$ 的均匀控制体，单元平均未知量为\n$$\nu_i(t) \\approx \\frac{1}{\\Delta x} \\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} u(x,t)\\,\\mathrm{d}x,\\quad i=0,1,\\dots,N-1,\n$$\n使用模 $N$ 的周期性索引。用数值通量 $\\widehat{f}(u_L,u_R)$ 来近似界面通量，得到半离散控制体格式\n$$\n\\frac{\\mathrm{d}u_i}{\\mathrm{d}t} = -\\frac{1}{\\Delta x}\\left(\\widehat{f}(u_i,u_{i+1}) - \\widehat{f}(u_{i-1},u_i)\\right).\n$$\n使用强稳定性保持 (Strong Stability Preserving Runge–Kutta, SSP-RK) 三阶方法对半离散格式进行时间演化，时间步长 $\\Delta t$ 由 Courant–Friedrichs–Lewy (CFL) 条件确定\n$$\n\\Delta t = \\mathrm{CFL} \\cdot \\frac{\\Delta x}{\\max_i |u_i|},\n$$\n其中 $\\mathrm{CFL} = 0.4$，并且约定分母由 $\\max\\{\\max_i |u_i|, 10^{-12}\\}$ 替换以避免除以零。\n\n定义 Burgers 方程的凸数学熵和熵通量为\n$$\nU(u) = \\frac{u^2}{2},\\qquad \\Psi(u) = \\frac{u^3}{3}.\n$$\n在时间 $t$ 的离散总熵为\n$$\n\\mathcal{E}(t) = \\sum_{i=0}^{N-1} U(u_i(t))\\,\\Delta x.\n$$\n在周期性区域上，通过边界的熵通量为零。因此，满足离散熵不等式的离散格式将使得 $\\mathcal{E}(t)$ 随时间非增，而在时间区间 $[0,T]$ 上的离散熵耗散可以通过差值来量化\n$$\n\\Delta \\mathcal{E} = \\mathcal{E}(T) - \\mathcal{E}(0),\n$$\n该值应小于或等于零。\n\n实现并比较两种熵稳定有限体积通量：\n- Lax–Friedrichs 分裂通量。使用 Burgers 方程的两点熵守恒通量\n$$\n\\widehat{f}^{\\mathrm{EC}}(u_L,u_R) = \\frac{1}{6}\\left(u_L^2 + u_L u_R + u_R^2\\right),\n$$\n并附加 Lax–Friedrichs 耗散项\n$$\n\\widehat{f}^{\\mathrm{LF}}(u_L,u_R) = \\widehat{f}^{\\mathrm{EC}}(u_L,u_R) - \\frac{1}{2}\\,\\alpha^{\\mathrm{LF}}(u_R - u_L),\\quad \\alpha^{\\mathrm{LF}} = \\max\\{|u_L|,|u_R|\\}.\n$$\n- Harten–Lax–van Leer (HLL) 通量。使用 Burgers 方程的特征信号速度，即局部特征速度的最小值和最大值 $s_L = \\min\\{u_L,u_R\\}$ 和 $s_R = \\max\\{u_L,u_R\\}$，来定义\n$$\n\\widehat{f}^{\\mathrm{HLL}}(u_L,u_R) = \n\\begin{cases}\nf(u_L),  s_L \\ge 0 \\\\\nf(u_R),  s_R \\le 0 \\\\\n\\dfrac{s_R f(u_L) - s_L f(u_R) + s_L s_R (u_R - u_L)}{s_R - s_L},  \\text{otherwise}\n\\end{cases}\n$$\n\n时间积分必须使用三阶 SSP-RK 方法和上述的 $\\Delta t$。对于下面的每个测试用例，计算两种数值通量的离散熵耗散 $\\Delta \\mathcal{E}$ 并报告其值。\n\n测试套件。对以下三种情况进行计算，每种情况都有其自己的参数。所有运行都使用 $\\mathrm{CFL} = 0.4$ 和 $[0,1)$ 上的周期性边界条件。\n- 情况 A（光滑，激波前）：$N = 400$，最终时间 $T = 0.12$，初始条件 $u(x,0) = \\sin(2\\pi x)$，其中 $x$ 是单元中心 $x_i = (i+1/2)\\Delta x$。\n- 情况 B（间断，激波和稀疏波）：$N = 400$，最终时间 $T = 0.10$，初始条件为 $x \\in [0,0.5)$ 时 $u(x,0) = 1$，$x \\in [0.5,1)$ 时 $u(x,0) = -1$，并采用周期性环绕。\n- 情况 C（常数状态）：$N = 200$，最终时间 $T = 0.10$，对于所有 $x$，初始条件为 $u(x,0) = 0.7$。\n\n答案规格与输出格式。对于每种情况，计算离散熵耗散值 $\\Delta \\mathcal{E}^{\\mathrm{LF}}$ 和 $\\Delta \\mathcal{E}^{\\mathrm{HLL}}$，它们是实数（无量纲），并按此顺序排列。您的程序应生成单行输出，其中包含结果，形式为以逗号分隔的列表，并用方括号括起来，顺序如下\n$$\n\\left[\\Delta \\mathcal{E}^{\\mathrm{LF}}_{\\text{A}},\\ \\Delta \\mathcal{E}^{\\mathrm{HLL}}_{\\text{A}},\\ \\Delta \\mathcal{E}^{\\mathrm{LF}}_{\\text{B}},\\ \\Delta \\mathcal{E}^{\\mathrm{HLL}}_{\\text{B}},\\ \\Delta \\mathcal{E}^{\\mathrm{LF}}_{\\text{C}},\\ \\Delta \\mathcal{E}^{\\mathrm{HLL}}_{\\text{C}}\\right].\n$$\n每个数字都应打印为小数点后恰好有八位的小数。不应打印任何其他文本。由于所有量都是无量纲的，因此不需要物理单位。", "solution": "我们从控制体的积分守恒律开始。对于控制体 $[x_{i-\\frac{1}{2}}, x_{i+\\frac{1}{2}}]$ 上的标量守恒律 $\\partial_t u + \\partial_x f(u) = 0$，进行积分并使用微积分基本定理可得\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}t}\\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} u(x,t)\\,\\mathrm{d}x + f\\big(u(x_{i+\\frac{1}{2}}^{-},t)\\big) - f\\big(u(x_{i-\\frac{1}{2}}^{+},t)\\big) = 0.\n$$\n定义单元平均值 $u_i(t) = \\frac{1}{\\Delta x}\\int_{x_{i-\\frac{1}{2}}}^{x_{i+\\frac{1}{2}}} u(x,t)\\,\\mathrm{d}x$ 并用一个相容的数值通量 $\\widehat{f}(u_L,u_R)$ 近似通量，便得到半离散有限体积格式\n$$\n\\frac{\\mathrm{d}u_i}{\\mathrm{d}t} = -\\frac{1}{\\Delta x}\\left(\\widehat{f}(u_i,u_{i+1}) - \\widehat{f}(u_{i-1},u_i)\\right).\n$$\n这个过程在离散层面上直接体现了守恒性，因为当对所有控制体求和时，内部通量会相互抵消。\n\n对于 Burgers 方程，$f(u) = \\frac{u^2}{2}$，特征速度为 $a(u) = f'(u) = u$。一个凸数学熵及其熵通量由下式给出\n$$\nU(u) = \\frac{u^2}{2},\\qquad \\Psi(u) = \\int^u a(v)\\,U'(v)\\,\\mathrm{d}v = \\int^u v \\cdot v\\,\\mathrm{d}v = \\frac{u^3}{3}.\n$$\n我们将离散总熵度量为 $\\mathcal{E}(t) = \\sum_i U(u_i(t))\\Delta x$。在周期性区域上，对于熵解，连续熵平衡可写为 $\\frac{\\mathrm{d}}{\\mathrm{d}t}\\int U(u)\\,\\mathrm{d}x \\le 0$；在离散层面上，一个熵稳定有限体积通量 $\\widehat{f}$ 满足一个单元不等式，求和后意味着 $\\mathcal{E}(t)$ 是非增的。\n\n熵稳定通量的构造过程是将其分裂为一个熵守恒的中心通量和一个熵耗散项。对于 Burgers 方程，两点熵守恒通量（Tadmor 通量）是\n$$\n\\widehat{f}^{\\mathrm{EC}}(u_L,u_R) = \\frac{1}{6}\\left(u_L^2 + u_L u_R + u_R^2\\right).\n$$\n仅使用此通量是无耗散的，并且在离散层面上守恒熵，但在存在激波时不稳定。添加一个形式为 $-\\frac{1}{2} d(u_L,u_R)(u_R - u_L)$ 的对称正耗散系数 $d(u_L,u_R) \\ge 0$ 可以得到一个熵稳定通量。一个典型的选择是 Lax–Friedrichs（也称为 Rusanov）耗散\n$$\n\\alpha^{\\mathrm{LF}}(u_L,u_R) = \\max\\{|a(u_L)|,|a(u_R)|\\} = \\max\\{|u_L|,|u_R|\\},\n$$\n从而得到 Lax–Friedrichs 分裂通量\n$$\n\\widehat{f}^{\\mathrm{LF}}(u_L,u_R) = \\widehat{f}^{\\mathrm{EC}}(u_L,u_R) - \\frac{1}{2}\\alpha^{\\mathrm{LF}}(u_R - u_L).\n$$\n这个选择是熵稳定的：每个界面上的离散熵产生是非负的，并且求和后得到一个非增的 $\\mathcal{E}(t)$。\n\n另一种熵稳定的离散化方法是使用近似 Riemann 求解器。Harten–Lax–van Leer (HLL) 通量采用包络信号速度 $s_L$ 和 $s_R$ 来包围所有局部特征速度。对于 Burgers 方程，局部特征速度就是状态本身，因此一个方便的选择是 $s_L = \\min\\{u_L,u_R\\}$ 和 $s_R = \\max\\{u_L,u_R\\}$。HLL 通量为\n$$\n\\widehat{f}^{\\mathrm{HLL}}(u_L,u_R) = \n\\begin{cases}\nf(u_L),  s_L \\ge 0 \\\\\nf(u_R),  s_R \\le 0 \\\\\n\\dfrac{s_R f(u_L) - s_L f(u_R) + s_L s_R (u_R - u_L)}{s_R - s_L},  \\text{otherwise}\n\\end{cases}\n$$\n对于标量凸通量，这与 Godunov 通量一致，并且是熵耗散的；因此它也产生一个非增的 $\\mathcal{E}(t)$。\n\n时间积分使用强稳定性保持 (Strong Stability Preserving Runge–Kutta, SSP-RK) 三阶格式，当与一个单调（总变差递减）的空间离散化在合适的 Courant–Friedrichs–Lewy (CFL) 条件下结合使用时，可以保持强稳定性。该方法通过以下步骤将 $u^n$ 更新为 $u^{n+1}$：\n$$\n\\begin{aligned}\nu^{(1)} = u^n + \\Delta t\\,\\mathcal{L}(u^n),\\\\\nu^{(2)} = \\frac{3}{4}u^n + \\frac{1}{4}\\left(u^{(1)} + \\Delta t\\,\\mathcal{L}(u^{(1)})\\right),\\\\\nu^{n+1} = \\frac{1}{3}u^n + \\frac{2}{3}\\left(u^{(2)} + \\Delta t\\,\\mathcal{L}(u^{(2)})\\right),\n\\end{aligned}\n$$\n其中 $\\mathcal{L}(u)$ 是有限体积空间算子\n$$\n[\\mathcal{L}(u)]_i = -\\frac{1}{\\Delta x}\\left(\\widehat{f}(u_i,u_{i+1}) - \\widehat{f}(u_{i-1},u_i)\\right).\n$$\n时间步长选择为\n$$\n\\Delta t = \\mathrm{CFL}\\cdot \\frac{\\Delta x}{\\max_i |u_i|},\n$$\n其中 $\\mathrm{CFL} = 0.4$，并且最大模通过取 $\\max\\{\\max_i |u_i|,10^{-12}\\}$ 来保证安全。\n\n为量化离散熵耗散，我们计算\n$$\n\\Delta \\mathcal{E} = \\sum_{i=0}^{N-1} \\frac{u_i(T)^2}{2}\\,\\Delta x - \\sum_{i=0}^{N-1} \\frac{u_i(0)^2}{2}\\,\\Delta x.\n$$\n对于周期性边界，熵平衡没有边界贡献，因此任何单调或熵稳定的通量都应满足 $\\Delta \\mathcal{E} \\le 0$。我们对 Lax–Friedrichs 分裂通量和 HLL 通量在三个测试用例上评估 $\\Delta \\mathcal{E}$：\n- 情况 A：光滑的 $\\sin(2\\pi x)$ 初始数据，最终时间 $T = 0.12$， $N = 400$。这个时间点接近但早于精确的激波形成时间 $t_s = 1/(2\\pi)$，因此预计耗散会很小，但由于数值扩散而不是零。\n- 情况 B：间断阶跃数据，在 $[0,0.5)$ 上 $u=1$，在 $[0.5,1)$ 上 $u=-1$，最终时间 $T = 0.10$， $N = 400$。这包含激波和稀疏波；预计耗散会更大，尽管两者都是熵耗散的，但在无接触的标量问题上，HLL 通常比 Lax–Friedrichs 的扩散性小。\n- 情况 C：常数状态 $u=0.7$，最终时间 $T = 0.10$， $N = 200$。在周期性网格上使用相容数值通量的有限体积法能够精确地保持常数，所以 $\\Delta \\mathcal{E}$ 应该精确为零，直到舍入误差。\n\n算法流程如下：\n- 将区域离散为 $N$ 个单元，其中心为 $x_i = (i+\\tfrac{1}{2})\\Delta x$，\n- 从指定的初始条件初始化 $u_i(0)$，\n- 使用 SSP-RK 方法、所选通量以及根据 CFL 规则的自适应 $\\Delta t$ 进行时间演化，\n- 计算在 $t=0$ 和 $t=T$ 时的 $\\Delta \\mathcal{E}$，\n- 对两种通量和所有三个测试用例重复上述步骤，\n- 并按要求的顺序和格式打印六个值。\n\n该设计从积分守恒律出发，并采用有限体积控制体离散化。熵框架为通量选择和将 $\\Delta \\mathcal{E}$ 作为离散熵耗散的可量化度量提供了理论依据。周期性边界确保了边界熵通量为零，从而将观测到的 $\\mathcal{E}$ 变化直接与数值耗散联系起来。", "answer": "```python\nimport numpy as np\n\ndef flux_physical(u):\n    return 0.5 * u * u\n\ndef flux_entropy_conservative(uL, uR):\n    # Tadmor EC flux for Burgers: (uL^2 + uL*uR + uR^2)/6\n    return (uL*uL + uL*uR + uR*uR) / 6.0\n\ndef flux_LF_split(uL, uR):\n    f_ec = flux_entropy_conservative(uL, uR)\n    alpha = max(abs(uL), abs(uR))\n    return f_ec - 0.5 * alpha * (uR - uL)\n\ndef flux_HLL(uL, uR):\n    fL = flux_physical(uL)\n    fR = flux_physical(uR)\n    sL = min(uL, uR)\n    sR = max(uL, uR)\n    if sL >= 0.0:\n        return fL\n    elif sR = 0.0:\n        return fR\n    else:\n        # denom > 0 because sR > sL when sL  0  sR\n        denom = sR - sL\n        return (sR * fL - sL * fR + sL * sR * (uR - uL)) / denom\n\ndef compute_fluxes(u, flux_func):\n    N = len(u)\n    # Periodic indexing\n    fluxes = np.zeros(N, dtype=float)\n    for i in range(N):\n        uL = u[i]\n        uR = u[(i + 1) % N]\n        fluxes[i] = flux_func(uL, uR)\n    return fluxes\n\ndef spatial_operator(u, dx, flux_func):\n    N = len(u)\n    F = compute_fluxes(u, flux_func)\n    # Residual: -(F_{i+1/2} - F_{i-1/2})/dx\n    # Here F[i] corresponds to interface between i and i+1 (i+1/2)\n    # So F_imh for cell i is F[i-1], F_iph is F[i]\n    res = -(F - np.roll(F, 1)) / dx\n    return res\n\ndef ssp_rk3(u0, T, dx, CFL, flux_func):\n    u = u0.copy()\n    t = 0.0\n    while t  T - 1e-14:\n        umax = np.max(np.abs(u))\n        denom = max(umax, 1e-12)\n        dt = CFL * dx / denom\n        # Do not step beyond T\n        if t + dt > T:\n            dt = T - t\n        # Stage 1\n        L1 = spatial_operator(u, dx, flux_func)\n        u1 = u + dt * L1\n        # Stage 2\n        L2 = spatial_operator(u1, dx, flux_func)\n        u2 = 0.75 * u + 0.25 * (u1 + dt * L2)\n        # Stage 3\n        L3 = spatial_operator(u2, dx, flux_func)\n        u = (1.0/3.0) * u + (2.0/3.0) * (u2 + dt * L3)\n        t += dt\n    return u\n\ndef total_entropy(u, dx):\n    return np.sum(0.5 * u * u) * dx\n\ndef init_case_A(N):\n    dx = 1.0 / N\n    x = (np.arange(N) + 0.5) * dx\n    return np.sin(2.0 * np.pi * x)\n\ndef init_case_B(N):\n    dx = 1.0 / N\n    x = (np.arange(N) + 0.5) * dx\n    u = np.empty(N, dtype=float)\n    u[x  0.5] = 1.0\n    u[x >= 0.5] = -1.0\n    return u\n\ndef init_case_C(N, c=0.7):\n    return np.full(N, c, dtype=float)\n\ndef run_case(u0, T, flux_func, CFL=0.4):\n    N = len(u0)\n    dx = 1.0 / N\n    E0 = total_entropy(u0, dx)\n    uT = ssp_rk3(u0, T, dx, CFL, flux_func)\n    ET = total_entropy(uT, dx)\n    return ET - E0\n\ndef solve():\n    # Test suite parameters\n    CFL = 0.4\n    # Case A\n    N_A = 400\n    T_A = 0.12\n    u0_A = init_case_A(N_A)\n    # Case B\n    N_B = 400\n    T_B = 0.10\n    u0_B = init_case_B(N_B)\n    # Case C\n    N_C = 200\n    T_C = 0.10\n    u0_C = init_case_C(N_C, c=0.7)\n\n    results = []\n\n    # Case A: LF split and HLL\n    dE_A_LF = run_case(u0_A, T_A, flux_func=lambda a,b: flux_LF_split(a,b), CFL=CFL)\n    dE_A_HLL = run_case(u0_A, T_A, flux_func=lambda a,b: flux_HLL(a,b), CFL=CFL)\n    results.extend([dE_A_LF, dE_A_HLL])\n\n    # Case B: LF split and HLL\n    dE_B_LF = run_case(u0_B, T_B, flux_func=lambda a,b: flux_LF_split(a,b), CFL=CFL)\n    dE_B_HLL = run_case(u0_B, T_B, flux_func=lambda a,b: flux_HLL(a,b), CFL=CFL)\n    results.extend([dE_B_LF, dE_B_HLL])\n\n    # Case C: LF split and HLL\n    dE_C_LF = run_case(u0_C, T_C, flux_func=lambda a,b: flux_LF_split(a,b), CFL=CFL)\n    dE_C_HLL = run_case(u0_C, T_C, flux_func=lambda a,b: flux_HLL(a,b), CFL=CFL)\n    results.extend([dE_C_LF, dE_C_HLL])\n\n    # Format with exactly 8 digits after decimal point\n    formatted = \",\".join(f\"{val:.8f}\" for val in results)\n    print(f\"[{formatted}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3409438"}, {"introduction": "许多物理系统遵循形如 $\\partial_t u + \\partial_x f(u) = s(x)$ 的平衡律，其中源项 $s(x)$ 的存在会导致非平凡的平衡态。一个标准的离散格式可能无法在数值上精确维持这些平衡，从而产生非物理的振荡。本练习将指导你设计和实现一种“良好平衡”格式，通过将源项的离散化与通量散度的离散化巧妙地协调起来，使其能够在离散层面上精确地保持这些重要的物理平衡态 [@problem_id:3409361]。", "problem": "考虑周期性域上的一维平衡律的积分守恒形式，\n$$\n\\frac{\\partial}{\\partial t} u(x,t) + \\frac{\\partial}{\\partial x} f(u(x,t)) = s(u(x,t),x), \\quad x \\in [0,1), \\ t \\ge 0,\n$$\n其通量由单位映射给出\n$$\nf(u) = u,\n$$\n并假设源项不依赖于未知量，\n$$\ns(u,x) \\equiv s(x),\n$$\n因此非平凡的空间变化稳态满足\n$$\n\\frac{\\partial}{\\partial x} f(u^\\star(x)) = s(x) \\quad \\Longleftrightarrow \\quad \\frac{\\partial}{\\partial x} u^\\star(x) = s(x).\n$$\n在一个具有 $N$ 个控制体的均匀网格上进行计算，网格宽度为 $\\Delta x = 1/N$，周期性索引为 $i \\in \\{0,1,\\dots,N-1\\}$，并将时间层 $n$ 的网格平均近似表示为 $U_i^n \\approx \\frac{1}{\\Delta x}\\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t^n)\\,dx$。使用显式前向欧拉有限体积更新\n$$\nU_i^{n+1} \\;=\\; U_i^n \\;-\\; \\frac{\\Delta t}{\\Delta x}\\Big(F_{i+1/2}^n - F_{i-1/2}^n\\Big) \\;+\\; \\Delta t \\, S_i,\n$$\n其中 $F_{i+1/2}^n$ 是一个相容的数值通量，$S_i$ 是一个离散源项。对于齐次通量，采用标准的右行平流迎风数值通量，\n$$\nF_{i+1/2}^n \\;=\\; U_i^n.\n$$\n\n您的任务：\n\n1) 从控制体上的积分守恒形式和上述数值通量的定义出发，推导出一个离散源项 $S_i$，该源项能够产生一个良好平衡格式，该格式能够精确保持一个非平凡的离散稳态族。具体来说，构建一个离散反导数序列 $\\{G_i\\}_{i=0}^{N-1}$，它逼近一个势函数 $G(x)$，其中 $\\frac{d}{dx}G(x)=s(x)$，并定义 $S_i$ 以使该格式能精确保持任何形如 $U_i^\\star = G_i + C$ 的离散状态，其中 $C$ 是任意常数。证明对于您的选择，对于满足 $U_i^n = G_i + C$ 的任何初始数据，单步更新会产生 $U_i^{n+1}=U_i^n$。\n\n2) 基于您的推导，实现一个程序，该程序：\n- 使用周期性边界条件。\n- 通过强制执行离散差分关系来构造离散势 $\\{G_i\\}$\n$$\n\\frac{G_i - G_{i-1}}{\\Delta x} \\approx s\\big(x_{i-1/2}\\big),\n$$\n对于 $i=0,1,\\dots,N-1$，使用周期性索引（索引模 $N$），其中 $x_{i-1/2} = i\\,\\Delta x$。\n- 将离散源项定义为\n$$\nS_i = \\frac{G_i - G_{i-1}}{\\Delta x}.\n$$\n- 使用迎风数值通量，针对给定的库朗数 $\\lambda = \\Delta t / \\Delta x$，推进一个显式前向欧拉时间步。\n\n3) 使用您的实现计算以下每个测试用例的最大绝对单步变化\n$$\n\\max_{0 \\le i \\le N-1} \\left|U_i^{n+1} - U_i^n\\right|.\n$$\n所有测试均使用 $N=200$ 和周期性边界条件。定义域为 $[0,1)$，每个测试用例均指定了库朗数 $\\lambda$。\n- 测试 1 (光滑稳态，理想情况): 设 $s(x) = 2\\pi \\cos(2\\pi x)$。根据上述离散条件构造 $G_i$，设置 $U_i^0 = G_i$ (即选择常数 $C=0$)，并使用 $\\lambda = 0.9$。\n- 测试 2 (与网格对齐的间断源项): 设 $s(x) = 1$ 对于 $x \\in [0,0.5)$ 且 $s(x) = -1$ 对于 $x \\in [0.5,1)$。相应地构造 $G_i$，设置 $U_i^0 = G_i$，并使用 $\\lambda = 0.9$。\n- 测试 3 (稳态的扰动): 使用与测试 1 相同的 $s(x)$，构造 $G_i$，并设置 $U_i^0 = G_i + \\varepsilon \\sin(4\\pi x_i)$，其中 $\\varepsilon = 10^{-3}$ 且 $x_i = (i+\\tfrac{1}{2})\\Delta x$。使用 $\\lambda = 0.9$。\n- 测试 4 (常数偏移不变性，库朗数极限下的边缘情况): 使用与测试 2 相同的 $s(x)$，构造 $G_i$，并设置 $U_i^0 = G_i + C$，其中 $C = 2.0$。使用 $\\lambda = 1.0$。\n\n所有计算都是无量纲的；不涉及物理单位。三角函数内的角度以弧度为单位。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表（例如，“[result1,result2,result3,result4]”），结果按测试 1 到测试 4 的顺序排列。每个结果必须是如上定义的浮点数，等于最大绝对单步变化。", "solution": "我们从一维平衡律在控制体 $\\left[x_{i-1/2}, x_{i+1/2}\\right]$ 上的积分守恒形式开始，\n$$\n\\frac{d}{dt} \\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t)\\,dx \\;+\\; \\left(f(u(x_{i+1/2},t)) - f(u(x_{i-1/2},t))\\right) \\;=\\; \\int_{x_{i-1/2}}^{x_{i+1/2}} s(u(x,t),x)\\,dx.\n$$\n令 $\\Delta x = x_{i+1/2} - x_{i-1/2}$ 表示网格间距，而 $U_i(t)$ 表示网格平均值 $U_i(t) = \\frac{1}{\\Delta x}\\int_{x_{i-1/2}}^{x_{i+1/2}} u(x,t)\\,dx$。一个时间步长为 $\\Delta t$ 的一阶显式有限体积方法在时间层 $t^n$ 用数值通量 $F_{i\\pm 1/2}^n$ 评估通过网格界面的通量，并用一个离散量 $\\Delta x\\, S_i$ 来近似源项积分。前向欧拉更新可写为\n$$\nU_i^{n+1} \\;=\\; U_i^n \\;-\\; \\frac{\\Delta t}{\\Delta x}\\left(F_{i+1/2}^n - F_{i-1/2}^n\\right) \\;+\\; \\Delta t\\, S_i.\n$$\n在我们的设定中，通量为 $f(u) = u$，这是单位速度的线性平流通量。对于右行流，迎风数值通量为\n$$\nF_{i+1/2}^n = U_i^n,\n$$\n这与物理通量相容，并在 Courant–Friedrichs–Lewy (CFL) 条件 $\\lambda=\\Delta t/\\Delta x \\le 1$ 下是稳定的。源项被假定为仅依赖于空间变量，$s(u,x)\\equiv s(x)$，并且稳态必须满足\n$$\n\\frac{d}{dx} u^\\star(x) = s(x).\n$$\n为确保对于一个离散稳态族方案是精确良好平衡的，我们引入一个离散反导数 $\\{G_i\\}$，它逼近一个势函数 $G(x)$，其中 $G'(x) = s(x)$。我们不需要 $G$ 的解析形式；相反，我们直接通过离散条件从 $s(x)$ 构建 $G_i$\n$$\n\\frac{G_i - G_{i-1}}{\\Delta x} = s\\left(x_{i-1/2}\\right), \\quad i=0,1,\\dots,N-1,\n$$\n使用周期性索引，其中 $x_{i-1/2} = i \\Delta x$ 表示网格 $i-1$ 和 $i$ 之间的界面位置。这个递推关系定义了 $G$，只差一个加性常数，这对稳态保持无关紧要。\n\n给定 $\\{G_i\\}$，我们选择离散源项为\n$$\nS_i = \\frac{G_i - G_{i-1}}{\\Delta x}.\n$$\n使用库朗数 $\\lambda = \\Delta t/\\Delta x$，带有迎风通量的前向欧拉更新可以写成\n$$\nU_i^{n+1} = U_i^n - \\lambda \\left(U_i^n - U_{i-1}^n\\right) + \\lambda \\left(G_i - G_{i-1}\\right).\n$$\n为了证明该格式对于离散族 $U_i^\\star = G_i + C$（其中 $C$ 是任意常数）是良好平衡的，代入 $U_i^n = U_i^\\star$：\n\n$$\n\\begin{aligned}\nU_i^{n+1} = \\left(G_i + C\\right) - \\lambda \\left((G_i + C) - (G_{i-1} + C)\\right) + \\lambda \\left(G_i - G_{i-1}\\right) \\\\\n= \\left(G_i + C\\right) - \\lambda \\left(G_i - G_{i-1}\\right) + \\lambda \\left(G_i - G_{i-1}\\right) \\\\\n= G_i + C \\\\\n= U_i^n.\n\\end{aligned}\n$$\n\n因此，对于任何可以写成 $G_i + C$ 的 $U_i^n$，该更新对所有 $i$ 都精确地得到 $U_i^{n+1} = U_i^n$。这证明了该格式对于由常数偏移 $C$ 参数化的非平凡离散稳态族是精确良好平衡的。\n\n算法设计细节：\n- 网格和周期性：设 $N$ 为网格数量，$\\Delta x = 1/N$。定义界面位置 $x_{i-1/2} = i\\,\\Delta x$ 和网格中心 $x_i = (i + \\tfrac{1}{2})\\Delta x$。索引采用模 $N$ 运算以强制周期性。\n- 离散势的构建：给定函数 $s(x)$，在界面处采样得到 $s_{i-1/2} = s(x_{i-1/2})$。任意固定 $G_0$（例如 $G_0 = \\Delta x\\, s_{-1/2}$ 或 $G_0 = 0$）并构造\n$$\nG_i = G_{i-1} + \\Delta x\\, s_{i-1/2}, \\quad i=1,2,\\dots,N-1.\n$$\n这确保了差商能够恢复 $s(x)$ 的界面采样值，\n$$\n\\frac{G_i - G_{i-1}}{\\Delta x} = s_{i-1/2}.\n$$\n- 源项：设置 $S_i = (G_i - G_{i-1}) / \\Delta x$。\n- 单步更新：使用库朗数 $\\lambda$，计算\n$$\nU_i^{n+1} = U_i^n - \\lambda \\left(U_i^n - U_{i-1}^n\\right) + \\lambda \\left(G_i - G_{i-1}\\right),\n$$\n其中索引算术采用模 $N$ 来实现周期性边界条件。对于 $\\lambda \\le 1$，这对于齐次部分是稳定的。\n- 诊断量：报告最大绝对单步变化，\n$$\n\\max_i |U_i^{n+1} - U_i^n|.\n$$\n\n测试套件设计和预期：\n- 测试 1: $s(x) = 2\\pi \\cos(2\\pi x)$, $U_i^0 = G_i$, $\\lambda=0.9$。根据良好平衡属性，最大绝对单步变化在浮点运算中必须精确为零，因为更新中的抵消是逐项发生的。\n- 测试 2: $s(x) = 1$ 在 $[0,0.5)$ 上，$s(x) = -1$ 在 $[0.5,1)$ 上，$U_i^0 = G_i$, $\\lambda=0.9$。对于偶数 $N$，不连续性与网格界面对齐。$G$ 的离散构造仍然确保了精确的抵消和零单步变化。\n- 测试 3: 与测试 1 相同的 $s(x)$，$U_i^0 = G_i + \\varepsilon \\sin(4\\pi x_i)$, $\\varepsilon=10^{-3}$, $\\lambda=0.9$。扰动根据应用于扰动本身的迎风步骤演化：\n$$\nV_i^{n+1} = V_i^n - \\lambda (V_i^n - V_{i-1}^n), \\quad V_i^n = U_i^n - G_i,\n$$\n所以单步变化不为零，并由正弦模式的迎风传播决定。程序计算并报告产生的最大变化。\n- 测试 4: 与测试 2 相同的 $s(x)$，$U_i^0 = G_i + C$，其中 $C=2.0$，且 $\\lambda=1.0$。常数偏移被精确保持，因为齐次更新仅依赖于差分 $U_i - U_{i-1}$，而源项使用 $G$ 的差分。单步变化精确为零。\n\n最终输出格式是包含四个浮点结果的单行列表，按测试 1 到测试 4 的顺序排列，用逗号分隔并用方括号括起来，例如\n$$\n[\\text{result1},\\text{result2},\\text{result3},\\text{result4}].\n$$", "answer": "```python\nimport numpy as np\n\ndef build_grid(N: int):\n    dx = 1.0 / N\n    # Cell centers and interfaces (periodic domain [0,1))\n    x_centers = (np.arange(N) + 0.5) * dx\n    x_interfaces = (np.arange(N) * dx) % 1.0\n    return dx, x_centers, x_interfaces\n\ndef s_smooth(x):\n    # s(x) = 2*pi*cos(2*pi*x)\n    return 2.0 * np.pi * np.cos(2.0 * np.pi * x)\n\ndef s_step(x):\n    # s(x) = 1 on [0,0.5), -1 on [0.5,1)\n    return np.where((x >= 0.5)  (x  1.0), -1.0, 1.0)\n\ndef construct_G_from_s(N, dx, s_at_interfaces):\n    # Construct G_i such that (G_i - G_{i-1})/dx = s(x_{i-1/2})\n    G = np.zeros(N, dtype=np.float64)\n    # Set G[0] arbitrarily; using the recurrence ensures the desired differences\n    for i in range(1, N):\n        G[i] = G[i-1] + dx * s_at_interfaces[i]\n    return G\n\ndef upwind_one_step(U, G, lam):\n    # Periodic shift by one cell (i-1)\n    U_im1 = np.roll(U, 1)\n    G_im1 = np.roll(G, 1)\n    # Forward Euler update with upwind flux and well-balanced source\n    U_new = U - lam * (U - U_im1) + lam * (G - G_im1)\n    return U_new\n\ndef max_one_step_change(U, G, lam):\n    U_new = upwind_one_step(U, G, lam)\n    return float(np.max(np.abs(U_new - U)))\n\ndef run_tests():\n    results = []\n\n    # Common grid\n    N = 200\n    dx, x_centers, x_interfaces = build_grid(N)\n\n    # Test 1: smooth steady state, lambda = 0.9\n    lam1 = 0.9\n    s_intf_1 = s_smooth(x_interfaces)\n    G1 = construct_G_from_s(N, dx, s_intf_1)\n    U0_1 = G1.copy()  # steady state (C=0)\n    res1 = max_one_step_change(U0_1, G1, lam1)\n    results.append(res1)\n\n    # Test 2: discontinuous source aligned with grid, lambda = 0.9\n    lam2 = 0.9\n    s_intf_2 = s_step(x_interfaces)\n    G2 = construct_G_from_s(N, dx, s_intf_2)\n    U0_2 = G2.copy()  # steady state (C=0)\n    res2 = max_one_step_change(U0_2, G2, lam2)\n    results.append(res2)\n\n    # Test 3: perturbation of steady state, lambda = 0.9, epsilon=1e-3\n    lam3 = 0.9\n    s_intf_3 = s_smooth(x_interfaces)\n    G3 = construct_G_from_s(N, dx, s_intf_3)\n    epsilon = 1e-3\n    U0_3 = G3 + epsilon * np.sin(4.0 * np.pi * x_centers)\n    res3 = max_one_step_change(U0_3, G3, lam3)\n    results.append(res3)\n\n    # Test 4: constant offset invariance at Courant limit, lambda = 1.0\n    lam4 = 1.0\n    s_intf_4 = s_step(x_interfaces)\n    G4 = construct_G_from_s(N, dx, s_intf_4)\n    C = 2.0\n    U0_4 = G4 + C\n    res4 = max_one_step_change(U0_4, G4, lam4)\n    results.append(res4)\n\n    return results\n\ndef solve():\n    results = run_tests()\n    print(f\"[{','.join(map(str, results))}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```", "id": "3409361"}]}