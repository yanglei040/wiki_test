{"hands_on_practices": [{"introduction": "在计算建模中，精确表示弯曲边界是一项基本挑战。本练习将超越简单的直边单元，探索强大的等参映射技术。您将构建一个二次三角形单元，以精确拟合一段圆弧——这是许多工程应用中的常见场景 ([@problem_id:3380293])。通过这个实践，您将深化对形函数如何定义复杂几何形状，以及雅可比行列式如何用于评估最终网格单元质量的理解。", "problem": "考虑一个用于偏微分方程（PDEs）数值解的域边界离散化的单一边界弯曲的六节点（$6$-node）等参三角单元。参考单元是$(\\xi,\\eta)$平面上的单位直角三角形，其顶点位于$(0,0)$、$(1,0)$和$(0,1)$。从参考三角形到物理三角形的等参映射$\\mathbf{x}(\\xi,\\eta)$使用与三个顶点和三个边中节点相关的标准二次三角形形函数。\n\n你需要构造一个二次等参映射，使其对应于节点$1$和$2$之间参考边的物理边插值为一个圆弧。该圆形边界的半径为$R>0$，圆心在原点。弯曲边的两个端点（节点$1$和$2$）的物理坐标选在圆上，其极角分别为$-\\theta$和$+\\theta$，其中$0<\\theta<\\pi$。此边上的边中节点（节点$4$）放置在极角为$0$的位置。因此，弯曲边上的三个物理点是\n- 节点 $1$：$(R\\cos\\theta,\\,-R\\sin\\theta)$，\n- 节点 $4$：$(R,\\,0)$，\n- 节点 $2$：$(R\\cos\\theta,\\,R\\sin\\theta)$。\n对于剩下的三个节点（与弯曲边相对的节点$3$以及位于直边上的边中节点$5$和$6$），将它们放置在使单元的另外两条边成为直线段的位置；为明确起见，将节点$3$置于$(0,0)$，并将节点$5$和$6$分别置于连接节点$2$与节点$3$以及节点$3$与节点$1$的直线段的中点。\n\n从重心坐标和二次六节点三角形形函数的定义出发，构造等参映射$\\mathbf{x}(\\xi,\\eta)$，通过将第三个重心坐标设为零将其限制在弯曲边上，并用一个从节点$1$到节点$2$、范围在$t\\in[0,1]$的标量参数$t$来参数化这条边。\n\n使用此构造，推导沿弯曲边的一维雅可比行列式，其定义为边度量因子$J_{e}(t)=\\left\\|\\dfrac{\\partial \\mathbf{x}}{\\partial t}\\right\\|$，并将其表示为关于$R$、$\\theta$和$t$的闭式解析表达式。你的最终答案必须是$J_{e}(t)$的单个闭式表达式。不要提供不等式或需要求解的方程；请提供显式表达式。不需要进行数值四舍五入。", "solution": "该问题需要进行验证。\n\n### 第一步：提取已知条件\n- **单元类型**：单边界弯曲的六节点（$6$-node）等参三角单元。\n- **参考单元**：$(\\xi,\\eta)$平面上的单位直角三角形，顶点位于$(0,0)$、$(1,0)$和$(0,1)$。\n- **映射**：等参映射，使用标准二次三角形形函数。\n- **弯曲边**：对应于节点$1$和$2$之间参考边的物理边插值为一个半径为$R>0$、圆心在原点的圆弧。\n- **弯曲边上的物理坐标**：\n    - 节点 $1$：$\\mathbf{x}_1 = (R\\cos\\theta, -R\\sin\\theta)$。\n    - 节点 $4$（边中节点）：$\\mathbf{x}_4 = (R, 0)$。\n    - 节点 $2$：$\\mathbf{x}_2 = (R\\cos\\theta, R\\sin\\theta)$。\n- **角度约束**：$0 < \\theta < \\pi$。\n- **其他节点的物理坐标**：\n    - 节点 $3$：$\\mathbf{x}_3 = (0, 0)$。\n    - 节点 $5$（边2-3的中点）：$\\mathbf{x}_5 = \\frac{1}{2}(\\mathbf{x}_2 + \\mathbf{x}_3)$。\n    - 节点 $6$（边3-1的中点）：$\\mathbf{x}_6 = \\frac{1}{2}(\\mathbf{x}_3 + \\mathbf{x}_1)$。\n    这些放置确保了另外两条边是直的。\n- **任务**：\n    1. 构造等参映射$\\mathbf{x}(\\xi,\\eta)$。\n    2. 将其限制在弯曲边上。\n    3. 用一个从节点$1$到节点$2$、范围在$t \\in [0,1]$的参数$t$来参数化该边。\n    4. 推导一维雅可比行列式（边度量因子）$J_{e}(t) = \\left\\|\\frac{\\partial \\mathbf{x}}{\\partial t}\\right\\|$，并将其表示为关于$R$、$\\theta$和$t$的闭式表达式。\n\n### 第二步：使用提取的已知条件进行验证\n- **科学依据**：该问题是有限元法（FEM）用于离散化带弯曲边界的域的一个标准应用。等参映射、形函数和雅可比行列式的概念是偏微分方程数值分析的基础。\n- **适定性**：该问题是完全指定的。参考单元和物理单元的几何形状、插值类型以及所有节点的坐标都是直接或作为其他已知条件的函数给出的。这足以唯一确定参数映射及其导数。\n- **客观性**：该问题以精确的数学语言陈述，没有主观或含糊的术语。\n- **缺陷清单**：该问题没有违反任何无效性标准。它在科学上是合理的、可形式化的、完整的、一致的、现实的并且是适定的。这是一个非平凡的推导，是计算力学和有限元法的核心内容。\n\n### 第三步：结论与行动\n该问题是**有效的**。将推导解答。\n\n### 解答推导\n解答过程首先定义形函数，然后构造等参映射，对指定的边进行参数化，最后推导雅可比行列式。\n\n对于一个6节点三角形，标准的节点编号将顶点置于节点$1, 2, 3$，边中节点置于$4$（边1-2）、$5$（边2-3）和$6$（边3-1）。我们将这些节点与参考$(\\xi, \\eta)$平面中的点相关联。我们采用一个常见的约定，即使用重心坐标$L_1, L_2, L_3$，对于顶点在$(0,0)$、$(1,0)$和$(0,1)$的参考三角形，它们与$(\\xi, \\eta)$相关。我们将节点$3$映射到$(\\xi, \\eta)=(0,0)$，节点$1$映射到$(\\xi, \\eta)=(1,0)$，节点$2$映射到$(\\xi, \\eta)=(0,1)$。\n那么重心坐标为$L_1 = \\xi$、$L_2 = \\eta$和$L_3 = 1-\\xi-\\eta$。\n重心坐标空间中的节点坐标为：\n- 节点 $1$：$(L_1, L_2, L_3) = (1,0,0)$\n- 节点 $2$：$(L_1, L_2, L_3) = (0,1,0)$\n- 节点 $3$：$(L_1, L_2, L_3) = (0,0,1)$\n- 节点 $4$（1-2的中点）：$(1/2, 1/2, 0)$\n- 节点 $5$（2-3的中点）：$(0, 1/2, 1/2)$\n- 节点 $6$（3-1的中点）：$(1/2, 0, 1/2)$\n\n用重心坐标表示的二次形函数$N_i$为：\n- 顶点节点 $(i=1, 2, 3)$：$N_i = L_i(2L_i - 1)$\n- 边中节点：$N_4 = 4L_1L_2$, $N_5 = 4L_2L_3$, $N_6 = 4L_3L_1$\n\n等参映射由$\\mathbf{x}(\\xi, \\eta) = \\sum_{i=1}^6 N_i(L_1, L_2, L_3) \\mathbf{x}_i$给出。我们关心的是连接节点$1$和$2$的边。这条边由$L_3=0$定义，这意味着$1-\\xi-\\eta=0$，即$\\eta=1-\\xi$。\n在这条边上，唯一非零的形函数是$N_1$、$N_2$和$N_4$：\n- $N_1 = L_1(2L_1-1) = \\xi(2\\xi-1)$\n- $N_2 = L_2(2L_2-1) = \\eta(2\\eta-1) = (1-\\xi)(2(1-\\xi)-1) = (1-\\xi)(1-2\\xi)$\n- $N_4 = 4L_1L_2 = 4\\xi\\eta = 4\\xi(1-\\xi)$\n所有其他形函数（$N_3, N_5, N_6$）都为零，因为它们包含因子$L_3$。\n这条边上的映射为$\\mathbf{x}(\\xi) = N_1(\\xi)\\mathbf{x}_1 + N_2(\\xi)\\mathbf{x}_2 + N_4(\\xi)\\mathbf{x}_4$。\n\n我们需要用一个从节点$1$到节点$2$、范围在$t \\in [0,1]$的参数$t$来参数化这条边。\n在节点$1$处，$(L_1,L_2,L_3)=(1,0,0)$，所以$\\xi = 1$。\n在节点$2$处，$(L_1,L_2,L_3)=(0,1,0)$，所以$\\xi = 0$。\n当我们从节点$1$移动到节点$2$时，参数$\\xi$从$1$变到$0$。我们选择变换$t = 1-\\xi$，因此$\\xi = 1-t$。\n当$\\xi$从$1$变到$0$时，$t$从$0$变到$1$。\n将$\\xi = 1-t$代入形函数：\n- $L_1 = \\xi = 1-t$\n- $L_2 = \\eta = 1-\\xi = t$\n- $N_1(t) = (1-t)(2(1-t)-1) = (1-t)(1-2t)$\n- $N_2(t) = t(2t-1)$\n- $N_4(t) = 4(1-t)t$\n\n现在这条边由$t$参数化：\n$\\mathbf{x}(t) = N_1(t)\\mathbf{x}_1 + N_2(t)\\mathbf{x}_2 + N_4(t)\\mathbf{x}_4$\n$\\mathbf{x}(t) = (1-t)(1-2t)\\mathbf{x}_1 + t(2t-1)\\mathbf{x}_2 + 4t(1-t)\\mathbf{x}_4$\n\n为了求雅可比行列式$J_e(t)$，我们首先计算切向量$\\frac{\\partial\\mathbf{x}}{\\partial t}$：\n$\\frac{\\partial\\mathbf{x}}{\\partial t} = \\frac{\\partial N_1}{\\partial t}\\mathbf{x}_1 + \\frac{\\partial N_2}{\\partial t}\\mathbf{x}_2 + \\frac{\\partial N_4}{\\partial t}\\mathbf{x}_4$\n形函数关于$t$的导数是：\n- $\\frac{\\partial N_1}{\\partial t} = \\frac{\\partial}{\\partial t}(1 - 3t + 2t^2) = 4t-3$\n- $\\frac{\\partial N_2}{\\partial t} = \\frac{\\partial}{\\partial t}(2t^2 - t) = 4t-1$\n- $\\frac{\\partial N_4}{\\partial t} = \\frac{\\partial}{\\partial t}(4t - 4t^2) = 4-8t$\n\n所以，切向量是：\n$\\frac{\\partial\\mathbf{x}}{\\partial t} = (4t-3)\\mathbf{x}_1 + (4t-1)\\mathbf{x}_2 + (4-8t)\\mathbf{x}_4$\n\n现在我们代入物理坐标$\\mathbf{x}_1 = (R\\cos\\theta, -R\\sin\\theta)$、$\\mathbf{x}_2 = (R\\cos\\theta, R\\sin\\theta)$和$\\mathbf{x}_4 = (R, 0)$。设$\\frac{\\partial\\mathbf{x}}{\\partial t} = (x'(t), y'(t))$。\n$x$分量是：\n$x'(t) = (4t-3)(R\\cos\\theta) + (4t-1)(R\\cos\\theta) + (4-8t)(R)$\n$x'(t) = R [ (4t-3+4t-1)\\cos\\theta + (4-8t) ]$\n$x'(t) = R [ (8t-4)\\cos\\theta - (8t-4) ]$\n$x'(t) = R(8t-4)(\\cos\\theta-1) = 4R(2t-1)(\\cos\\theta-1)$\n\n$y$分量是：\n$y'(t) = (4t-3)(-R\\sin\\theta) + (4t-1)(R\\sin\\theta) + (4-8t)(0)$\n$y'(t) = R\\sin\\theta [ -(4t-3) + (4t-1) ]$\n$y'(t) = R\\sin\\theta [ -4t+3+4t-1 ] = 2R\\sin\\theta$\n\n雅可比行列式是该切向量的模：\n$J_e(t) = \\left\\| \\frac{\\partial\\mathbf{x}}{\\partial t} \\right\\| = \\sqrt{(x'(t))^2 + (y'(t))^2}$\n$J_e(t)^2 = [4R(2t-1)(\\cos\\theta-1)]^2 + [2R\\sin\\theta]^2$\n$J_e(t)^2 = 16R^2(2t-1)^2(\\cos\\theta-1)^2 + 4R^2\\sin^2\\theta$\n\n为了简化，我们使用半角恒等式：\n$\\cos\\theta-1 = -2\\sin^2\\left(\\frac{\\theta}{2}\\right)$\n$\\sin\\theta = 2\\sin\\left(\\frac{\\theta}{2}\\right)\\cos\\left(\\frac{\\theta}{2}\\right)$\n\n将这些代入$J_e(t)^2$的表达式中：\n$J_e(t)^2 = 16R^2(2t-1)^2 \\left(-2\\sin^2\\left(\\frac{\\theta}{2}\\right)\\right)^2 + 4R^2 \\left(2\\sin\\left(\\frac{\\theta}{2}\\right)\\cos\\left(\\frac{\\theta}{2}\\right)\\right)^2$\n$J_e(t)^2 = 16R^2(2t-1)^2 \\left(4\\sin^4\\left(\\frac{\\theta}{2}\\right)\\right) + 4R^2 \\left(4\\sin^2\\left(\\frac{\\theta}{2}\\right)\\cos^2\\left(\\frac{\\theta}{2}\\right)\\right)$\n$J_e(t)^2 = 64R^2(2t-1)^2\\sin^4\\left(\\frac{\\theta}{2}\\right) + 16R^2\\sin^2\\left(\\frac{\\theta}{2}\\right)\\cos^2\\left(\\frac{\\theta}{2}\\right)$\n\n提取公因式$16R^2\\sin^2\\left(\\frac{\\theta}{2}\\right)$：\n$J_e(t)^2 = 16R^2\\sin^2\\left(\\frac{\\theta}{2}\\right) \\left[ 4(2t-1)^2\\sin^2\\left(\\frac{\\theta}{2}\\right) + \\cos^2\\left(\\frac{\\theta}{2}\\right) \\right]$\n\n取平方根求$J_e(t)$：\n$J_e(t) = \\sqrt{16R^2\\sin^2\\left(\\frac{\\theta}{2}\\right)} \\sqrt{4(2t-1)^2\\sin^2\\left(\\frac{\\theta}{2}\\right) + \\cos^2\\left(\\frac{\\theta}{2}\\right)}$\n因为$R>0$且$0<\\theta<\\pi$，我们有$0<\\frac{\\theta}{2}<\\frac{\\pi}{2}$，这意味着$\\sin\\left(\\frac{\\theta}{2}\\right)>0$。\n$J_e(t) = 4R\\sin\\left(\\frac{\\theta}{2}\\right) \\sqrt{4(2t-1)^2\\sin^2\\left(\\frac{\\theta}{2}\\right) + \\cos^2\\left(\\frac{\\theta}{2}\\right)}$\n\n这就是沿弯曲边的雅可比行列式的最终闭式表达式。", "answer": "$$ \\boxed{4R\\sin\\left(\\frac{\\theta}{2}\\right) \\sqrt{4(2t-1)^2\\sin^2\\left(\\frac{\\theta}{2}\\right) + \\cos^2\\left(\\frac{\\theta}{2}\\right)}} $$", "id": "3380293"}, {"introduction": "许多现实世界的问题涉及多种材料或物理现象，需要在不同的子域中使用不同的网格分辨率。这导致在交界面上出现非匹配网格，标准的有限元方法在此会失效。本练习将介绍砂浆法（mortar method），这是一种通过变分原理耦合非匹配网格的精密技术 ([@problem_id:3380250])。通过为一个椭圆交界面问题实现一个求解器，您将获得关于拉格朗日乘子、鞍点系统以及将乘子物理解释为界面通量的实践经验。", "problem": "考虑定义在区间 $[0,1]$ 上的一个一维椭圆界面问题，其中在一个固定的界面位置 $x_0 \\in (0,1)$ 存在系数跳跃。设扩散系数为分段常数，记为当 $x \\in [0,x_0]$ 时 $a(x) = a_1$，当 $x \\in [x_0,1]$ 时 $a(x) = a_2$。控制偏微分方程 (PDE) 为\n$$\n- \\frac{d}{dx}\\left( a(x)\\,\\frac{du}{dx} \\right) = 0 \\quad \\text{on } (0,1),\n$$\n服从狄利克雷边界条件\n$$\nu(0) = 0, \\quad u(1) = 1.\n$$\n在 $x = x_0$ 处需要施加的界面条件是解的连续性和法向通量的连续性，\n$$\nu(x_0^-)=u(x_0^+), \\quad a_1\\,u'(x_0^-)=a_2\\,u'(x_0^+).\n$$\n您必须使用两个不匹配的均匀网格对区域进行离散化：一个是在 $[0,x_0]$ 上的左网格，包含 $N_L$ 个单元；另一个是在 $[x_0,1]$ 上的右网格，包含 $N_R$ 个单元，其中两个网格的内部节点不对齐。在每个子区域上使用连续分片线性基函数的有限元法 (FEM)，并引入一个带有单个拉格朗日乘子的砂浆法 (MM) 来跨越不匹配的网格弱施加界面条件。目标是开发并实现一个离散鞍点格式，该格式通过一个约束来确保解的连续性，并通过拉格朗日乘子将通量连续性表示为界面上的离散牵引力。\n\n从两个子区域上的弱形式出发，利用变分法和界面牵引力平衡的基本原理，推导出耦合两个子区域解（其中狄利克雷边界条件施加在 $x=0$ 和 $x=1$ 上）和单个界面乘子的离散代数系统。您的实现必须：\n- 为带有给定狄利克雷边界条件的 $- \\frac{d}{dx}\\left( a\\,u' \\right) = 0$ 组装子区域的刚度矩阵和载荷向量。\n- 通过强制迹连续性的拉格朗日乘子来整合界面耦合，并在弱形式中表示界面牵引力。\n- 求解得到的鞍点系统，以获得左子区域的节点值、右子区域的节点值和界面乘子。\n\n定义以下定量诊断指标来分析一致性和通量连续性：\n- 界面处的连续性残差，\n$$\ne_c = \\left| u_L(x_0) - u_R(x_0) \\right|,\n$$\n其中 $u_L(x_0)$ 和 $u_R(x_0)$ 分别是左、右子区域中界面节点的离散节点值。\n- 界面处的通量连续性残差，\n$$\ne_f = \\left| a_1\\,u_L'(x_0^-) - a_2\\,u_R'(x_0^+) \\right|,\n$$\n其中 $u_L'(x_0^-)$ 是从左网格上最后一个单元计算出的单边离散导数，而 $u_R'(x_0^+)$ 是从右网格上第一个单元计算出的单边离散导数。\n- 界面牵引力的相对误差，\n$$\ne_J = \\frac{\\left| \\lambda - J_{\\text{exact}} \\right|}{\\left| J_{\\text{exact}} \\right|},\n$$\n其中 $\\lambda$ 是计算出的拉格朗日乘子（解释为离散界面牵引力），$J_{\\text{exact}}$ 是针对给定的 PDE、系数、界面位置和狄利克雷边界条件解析得到的精确常数通量。\n\n使用以下测试套件，每个套件由元组 $(x_0, a_1, a_2, N_L, N_R)$ 指定：\n- 测试 $1$（中等对比度和不匹配网格的一般情况）：$(0.3, 1, 2, 20, 35)$。\n- 测试 $2$（$a_1/a_2 \\gg 1$ 的高对比度情况）：$(0.7, 10^6, 1, 5, 9)$。\n- 测试 $3$（$a_1/a_2 \\ll 1$ 的高对比度情况）：$(0.4, 10^{-6}, 1, 8, 12)$。\n\n您的程序必须实现推导和计算，然后为每个测试用例评估 $(e_c, e_f, e_J)$。最终输出必须是单行，包含每个测试用例的三元素列表，顺序与测试套件中给出的一致。格式必须严格为\n$$\n\\text{[}[e_{c,1},e_{f,1},e_{J,1}],[e_{c,2},e_{f,2},e_{J,2}],[e_{c,3},e_{f,3},e_{J,3}]\\text{]},\n$$\n其中所有条目都是实数。此问题中不需要物理单位。角度单位不适用。百分比必须表示为小数。程序必须是自包含的，不需要用户输入，并严格产生指定的单行输出。确保您的设计在 $a_1/a_2 \\gg 1$ 的情况下测试了解的一致性、通量连续性和鲁棒性。", "solution": "用户提供了一个问题，要求使用有限元法 (FEM) 和不匹配网格，通过带有单个拉格朗日乘子的砂浆法进行耦合，来数值求解一个一维椭圆界面问题。\n\n### 第 1 步：提取已知条件\n- **PDE**：在区域 $\\Omega = (0,1)$ 上，$- \\frac{d}{dx}\\left( a(x)\\,\\frac{du}{dx} \\right) = 0$。\n- **系数**：$a(x)$ 是分段常数：当 $x \\in [0,x_0]$ 时，$a(x) = a_1$；当 $x \\in [x_0,1]$ 时，$a(x) = a_2$，其中 $x_0 \\in (0,1)$ 是界面位置。\n- **边界条件 (BCs)**：$u(0) = 0$ 和 $u(1) = 1$。\n- **界面条件**：在 $x=x_0$ 处，解 $u(x)$ 和通量 $a(x)u'(x)$ 是连续的。\n  - $u(x_0^-) = u(x_0^+)$ (解的连续性)\n  - $a_1 u'(x_0^-) = a_2 u'(x_0^+)$ (通量/牵引力的连续性)\n- **离散化**：区域被分解为 $\\Omega_L = [0, x_0]$ 和 $\\Omega_R = [x_0, 1]$。\n  - $\\Omega_L$ 用一个包含 $N_L$ 个单元的均匀网格进行划分。\n  - $\\Omega_R$ 用一个包含 $N_R$ 个单元的均匀网格进行划分。\n- **数值方法**：\n  - 在每个子区域上使用连续分片线性基函数的有限元法。\n  - 使用单个拉格朗日乘子 $\\lambda$ 来弱施加界面条件，从而得到一个鞍点系统。\n- **诊断指标**：\n  - 连续性残差：$e_c = | u_L(x_0) - u_R(x_0) |$。\n  - 通量连续性残差：$e_f = | a_1 u_L'(x_0^-) - a_2 u_R'(x_0^+) |$。\n  - 界面牵引力的相对误差：$e_J = \\frac{| \\lambda - J_{\\text{exact}} |}{| J_{\\text{exact}} |}$，其中 $\\lambda$ 是拉格朗日乘子，$J_{\\text{exact}}$ 是精确的解析通量。\n- **测试套件**：元组 $(x_0, a_1, a_2, N_L, N_R)$。\n  - 测试 1：$(0.3, 1, 2, 20, 35)$\n  - 测试 2：$(0.7, 10^6, 1, 5, 9)$\n  - 测试 3：$(0.4, 10^{-6}, 1, 8, 12)$\n\n### 第 2 步：使用提取的已知条件进行验证\n所提供的问题是偏微分方程数值方法领域一个公认的标准练习，特别涉及区域分解和不匹配网格耦合。\n\n- **科学基础（关键）**：该问题基于椭圆偏微分方程和有限元法的基本原理。使用拉格朗日乘子来施加约束是变分法和数值分析中的标准技术。\n- **适定的**：连续问题是适定的，存在唯一解。使用鞍点系统的离散格式对于此类问题也是适定且标准的。\n- **目标明确（关键）**：问题以精确的数学语言陈述，定义和目标清晰。\n\n问题陈述是自洽的、一致的，并且没有违反任何无效标准。它是一个可形式化的科学问题，与指定主题相关。\n\n### 第 3 步：结论与行动\n该问题是 **有效的**。将提供一个完整的、有理有据的解决方案。\n\n### 基于原理的设计：推导与离散化\n\n解决方法是将问题表述为弱变分形式，使用有限元进行离散化，并求解得到的代数系统。\n\n**1. 带拉格朗日乘子的弱形式**\n\n我们将问题分解为两个子区域 $\\Omega_L = (0, x_0)$ 和 $\\Omega_R = (x_0, 1)$。通过将 PDE 乘以一个检验函数 $v(x)$ 并在每个子区域上积分来推导弱形式。\n\n对于 $\\Omega_L$，设 $v_L$ 为一个满足 $v_L(0)=0$ 的检验函数：\n$$ -\\int_0^{x_0} \\frac{d}{dx}\\left( a_1 \\frac{du_L}{dx} \\right) v_L dx = 0 $$\n分部积分得到：\n$$ \\int_0^{x_0} a_1 \\frac{du_L}{dx} \\frac{dv_L}{dx} dx - \\left[ a_1 \\frac{du_L}{dx} v_L \\right]_0^{x_0} = 0 $$\n$$ \\int_0^{x_0} a_1 u_L' v_L' dx = a_1 u_L'(x_0^-) v_L(x_0) $$\n类似地，对于 $\\Omega_R$，使用一个满足 $v_R(1)=0$ 的检验函数 $v_R$：\n$$ \\int_{x_0}^1 a_2 u_R' v_R' dx = -a_2 u_R'(x_0^+) v_R(x_0) $$\n\n我们引入一个拉格朗日乘子 $\\lambda$ 来表示界面牵引力（通量）。我们将牵引力定义为 $T(x) = a(x) u'(x)$。界面条件是 $u_L(x_0)=u_R(x_0)$ 和 $T_L(x_0) = T_R(x_0)$。让 $\\lambda$ 近似这个共同的牵引力值。弱形式变为：找到 $u_L, u_R, \\lambda$ 使得\n$$ \\int_0^{x_0} a_1 u_L' v_L' dx = \\lambda v_L(x_0) \\quad \\forall v_L \\in H^1_0(0, x_0) $$\n$$ \\int_{x_0}^1 a_2 u_R' v_R' dx = -\\lambda v_R(x_0) \\quad \\forall v_R \\text{ with } v_R(1)=0 $$\n$$ u_L(x_0) = u_R(x_0) $$\n第二个方程使用 $-\\lambda$ 是因为在 $x_0$ 处 $\\Omega_R$ 的法向量指向 $-x$ 方向。这个公式正确地施加了 $a_1 u_L'(x_0^-) = a_2 u_R'(x_0^+) = \\lambda$。\n\n**2. 有限元离散化**\n\n我们用 $N_L$ 个尺寸为 $h_L = x_0/N_L$ 的线性单元对 $\\Omega_L$ 进行离散化，用 $N_R$ 个尺寸为 $h_R = (1-x_0)/N_R$ 的线性单元对 $\\Omega_R$ 进行离散化。每个子区域上的解由分片线性基（帽）函数 $\\phi_i(x)$ 的和来近似：\n- $u_L(x) \\approx \\sum_{j=0}^{N_L} U_{L,j} \\phi_{L,j}(x)$，其中 $U_{L,0}=0$。未知量是 $\\mathbf{U}_L = [U_{L,1}, \\dots, U_{L,N_L}]^T$。\n- $u_R(x) \\approx \\sum_{j=0}^{N_R} U_{R,j} \\phi_{R,j}(x)$，其中 $U_{R,N_R}=1$。未知量是 $\\mathbf{U}_R = [U_{R,0}, \\dots, U_{R,N_R-1}]^T$。\n\n将这些代入弱形式，并选择基函数作为检验函数，得到一个块矩阵系统。对于尺寸为 $h$、系数为 $a$ 的单元，其单元刚度矩阵为 $k^e = \\frac{a}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}$。对每个子区域组装这些单元矩阵，并考虑边界条件，得到子区域刚度矩阵 $A_L$（$N_L \\times N_L$）和 $A_R$（$N_R \\times N_R$）。\n\n离散系统是关于未知向量 $\\mathbf{U}_L$、$\\mathbf{U}_R$ 和标量乘子 $\\lambda$ 的一个鞍点问题：\n$$\n\\begin{pmatrix}\nA_L  \\mathbf{0}  -B_L \\\\\n\\mathbf{0}  A_R  B_R \\\\\nB_L^T  -B_R^T  0\n\\end{pmatrix}\n\\begin{pmatrix}\n\\mathbf{U}_L \\\\\n\\mathbf{U}_R \\\\\n\\lambda\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n\\mathbf{0} \\\\\n\\mathbf{F}_{BC} \\\\\n0\n\\end{pmatrix}\n$$\n- $A_L$ 是在 $\\Omega_L$ 上施加了 $x=0$ 处狄利克雷边界条件后的 $N_L \\times N_L$ 刚度矩阵。\n- $A_R$ 是在 $\\Omega_R$ 上的 $N_R \\times N_R$ 刚度矩阵，暂时假设为齐次边界条件。\n- $B_L = [0, \\dots, 0, 1]^T$ 是一个 $N_L \\times 1$ 的向量，用于从 $\\mathbf{U}_L$ 中提取界面节点 $x_0$ 处的值。\n- $B_R = [1, 0, \\dots, 0]^T$ 是一个 $N_R \\times 1$ 的向量，用于从 $\\mathbf{U}_R$ 中提取界面节点 $x_0$ 处的值。\n- $\\mathbf{F}_{BC}$ 是处理非齐次边界条件 $u(1)=1$ 的向量。从组装过程可知，$\\mathbf{F}_{BC} = [0, \\dots, 0, a_2/h_R]^T$。\n\n第一块行 $A_L \\mathbf{U}_L - \\lambda B_L = \\mathbf{0}$ 在界面处施加了 $a_1 u_L'(x_0^-) = \\lambda$。\n第二块行 $A_R \\mathbf{U}_R + \\lambda B_R = \\mathbf{F}_{BC}$ 在界面处施加了 $a_2 u_R'(x_0^+) = \\lambda$。\n第三块行 $B_L^T \\mathbf{U}_L - B_R^T \\mathbf{U}_R = 0$ 施加了连续性条件 $U_{L,N_L} = U_{R,0}$。\n\n**3. 解析解与诊断**\n\nPDE 意味着牵引力 $T(x) = a(x)u'(x)$ 是一个常数。设这个常数为 $J_{\\text{exact}}$。\n$$ u'(x) = \\frac{J_{\\text{exact}}}{a(x)} $$\n从 $x=0$ 到 $x=1$ 积分：\n$$ u(1) - u(0) = \\int_0^1 \\frac{J_{\\text{exact}}}{a(x)} dx = J_{\\text{exact}} \\left( \\int_0^{x_0} \\frac{1}{a_1} dx + \\int_{x_0}^1 \\frac{1}{a_2} dx \\right) $$\n$$ 1 - 0 = J_{\\text{exact}} \\left( \\frac{x_0}{a_1} + \\frac{1-x_0}{a_2} \\right) $$\n因此，精确的常数牵引力（通量）是：\n$$ J_{\\text{exact}} = \\left( \\frac{x_0}{a_1} + \\frac{1-x_0}{a_2} \\right)^{-1} $$\n拉格朗日乘子 $\\lambda$ 是我们对这个量的数值近似。\n\n诊断指标计算如下：\n- $e_c = | U_{L,N_L} - U_{R,0} |$：左解的最后一个节点值与右解的第一个节点值之差的绝对值。根据我们系统的构造，这个值应该在机器精度内为零。\n- $e_f = | a_1 u_L'(x_0^-) - a_2 u_R'(x_0^+) |$：离散单边导数为 $u_L'(x_0^-) = (U_{L,N_L} - U_{L,N_L-1}) / h_L$ 和 $u_R'(x_0^+) = (U_{R,1} - U_{R,0}) / h_R$。我们的公式意味着 $a_1 u_L' \\approx \\lambda$ 和 $a_2 u_R' \\approx \\lambda$，所以这个残差也应该接近于零。\n- $e_J = \\frac{| \\lambda - J_{\\text{exact}} |}{| J_{\\text{exact}} |}$：计算出的拉格朗日乘子与精确解析牵引力之间的相对误差。这衡量了该方法的离散误差。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve_mortar_fem(x0, a1, a2, NL, NR):\n    \"\"\"\n    Solves the 1D elliptic interface problem using a mortar FEM formulation.\n\n    Args:\n        x0 (float): Interface location.\n        a1 (float): Diffusion coefficient on the left subdomain [0, x0].\n        a2 (float): Diffusion coefficient on the right subdomain [x0, 1].\n        NL (int): Number of elements in the left subdomain.\n        NR (int): Number of elements in the right subdomain.\n\n    Returns:\n        tuple[float, float, float]: A tuple containing the diagnostics (ec, ef, eJ).\n    \"\"\"\n    # 1. Define mesh parameters\n    hL = x0 / NL\n    hR = (1 - x0) / NR\n\n    # 2. Assemble subdomain stiffness matrices (A_L, A_R)\n    # A_L is an NL x NL matrix for unknowns U_{L,1}, ..., U_{L,NL}\n    # It corresponds to rows/cols 1 to NL of the full (NL+1)x(NL+1) matrix\n    val_L = a1 / hL\n    AL_diag_vals = np.full(NL, 2.0 * val_L)\n    AL_diag_vals[-1] = 1.0 * val_L  # Modification for interface node\n    AL = np.diag(AL_diag_vals)\n    AL_offdiag_vals = np.full(NL - 1, -1.0 * val_L)\n    AL += np.diag(AL_offdiag_vals, k=1)\n    AL += np.diag(AL_offdiag_vals, k=-1)\n\n    # A_R is an NR x NR matrix for unknowns U_{R,0}, ..., U_{R,NR-1}\n    # It corresponds to rows/cols 0 to NR-1 of the full (NR+1)x(NR+1) matrix\n    val_R = a2 / hR\n    AR_diag_vals = np.full(NR, 2.0 * val_R)\n    AR_diag_vals[0] = 1.0 * val_R  # Modification for interface node\n    AR = np.diag(AR_diag_vals)\n    AR_offdiag_vals = np.full(NR - 1, -1.0 * val_R)\n    AR += np.diag(AR_offdiag_vals, k=1)\n    AR += np.diag(AR_offdiag_vals, k=-1)\n\n    # 3. Assemble coupling vectors and block system\n    # B_L selects the last unknown of U_L (U_L,NL)\n    BL = np.zeros((NL, 1))\n    BL[-1, 0] = 1.0\n\n    # B_R selects the first unknown of U_R (U_R,0)\n    BR = np.zeros((NR, 1))\n    BR[0, 0] = 1.0\n\n    # Assemble the full saddle-point matrix K\n    K = np.block([\n        [AL,                 np.zeros((NL, NR)), -BL],\n        [np.zeros((NR, NL)), AR,                  BR],\n        [BL.T,              -BR.T,                0.0]\n    ])\n\n    # 4. Assemble the right-hand side vector F\n    F = np.zeros(NL + NR + 1)\n    # The non-homogeneous Dirichlet BC u(1)=1 affects the equation for U_R,NR-1.\n    # The term from the full stiffness matrix is (A_R_full)_{NR-1, NR} * u(1),\n    # which is (-a2/hR) * 1. Moved to the RHS, it becomes a2/hR.\n    # This entry corresponds to the last row of the A_R block.\n    F[NL + NR - 1] = a2 / hR\n\n    # 5. Solve the linear system\n    try:\n        solution_vec = np.linalg.solve(K, F)\n    except np.linalg.LinAlgError:\n         # Handle potential singularity for ill-conditioned cases, though not expected here\n         return (float('nan'), float('nan'), float('nan'))\n\n    # 6. Extract results from the solution vector\n    U_L = solution_vec[:NL]          # Nodal values U_{L,1}, ..., U_{L,NL}\n    U_R = solution_vec[NL:NL + NR] # Nodal values U_{R,0}, ..., U_{R,NR-1}\n    lmbda = solution_vec[-1]         # Lagrange multiplier lambda\n\n    # 7. Calculate diagnostics\n    # Continuity residual ec\n    # U_L[-1] is the nodal value U_L,NL at x0 from the left.\n    # U_R[0] is the nodal value U_R,0 at x0 from the right.\n    ec = abs(U_L[-1] - U_R[0])\n\n    # Flux continuity residual ef\n    # Get previous nodal value on the left; U_L,0 is 0.\n    U_L_prev = U_L[-2] if NL > 1 else 0.0\n    u_prime_L = (U_L[-1] - U_L_prev) / hL\n    \n    # Get next nodal value on the right; U_R,NR is 1.0\n    U_R_next = U_R[1] if NR > 1 else 1.0\n    u_prime_R = (U_R_next - U_R[0]) / hR\n    \n    ef = abs(a1 * u_prime_L - a2 * u_prime_R)\n\n    # Relative error in interface traction eJ\n    # The exact traction/flux, J = a(x)u'(x), is constant.\n    J_exact = 1.0 / (x0 / a1 + (1 - x0) / a2)\n    eJ = abs(lmbda - J_exact) / abs(J_exact) if J_exact != 0 else abs(lmbda)\n\n    return (ec, ef, eJ)\n\n\ndef solve():\n    \"\"\"Main function to run the test suite and print results.\"\"\"\n    test_cases = [\n        (0.3, 1, 2, 20, 35),\n        (0.7, 10**6, 1, 5, 9),\n        (0.4, 10**-6, 1, 8, 12),\n    ]\n\n    results = []\n    for case in test_cases:\n        x0, a1, a2, N_L, N_R = case\n        ec, ef, eJ = solve_mortar_fem(x0, a1, a2, N_L, N_R)\n        results.append(f\"[{ec:.16e},{ef:.16e},{eJ:.16e}]\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```", "id": "3380250"}]}