{"hands_on_practices": [{"introduction": "在宇宙学$N$体模拟中，利用快速傅里叶变换（FFT）求解引力泊松方程是一种核心技术。该方法的第一步是将离散粒子的质量分配到规则的网格上，这一过程会不可避免地平滑真实的密度场。本练习将引导您从第一性原理出发，推导最近邻点（NGP）、云中云（CIC）和三角云（TSC）这三种常用质量分配方案的傅里叶空间窗口函数([@problem_id:3495428])，从而定量理解它们如何影响不同尺度上的功率谱测量。", "problem": "考虑一个用于宇宙学 $N$ 体模拟中粒子-网格（Particle-Mesh）方法的均匀笛卡尔网格。设沿每个笛卡尔坐标轴的网格间距为 $\\Delta$。粒子到网格的质量分配方案可以通过一个实空间一维分配核 $A(x)$ 来描述，该核在维度上是可分离的，因此三维核为 $A(x)A(y)A(z)$。网格化超密度场的测量傅里叶振幅 $\\tilde{\\delta}(\\mathbf{k})$ 与真实的连续傅里叶振幅 $\\delta(\\mathbf{k})$ 之间的关系为 $\\tilde{\\delta}(\\mathbf{k}) = W(\\mathbf{k}) \\, \\delta(\\mathbf{k})$，其中 $W(\\mathbf{k})$ 是由 $A(x)$ 和可分离性决定的傅里叶空间窗函数。假设函数 $f(\\mathbf{x})$ 的傅里叶变换定义为 $f(\\mathbf{k}) = \\int_{\\mathbb{R}^{3}} f(\\mathbf{x}) \\exp(-\\mathrm{i} \\mathbf{k}\\cdot \\mathbf{x}) \\, d^{3}\\mathbf{x}$。\n\n从适用于快速傅里叶变换（FFT）分析和卷积定理的第一性原理出发，将以下一维分配核的构造作为基本基础：\n\n- 最近邻点（NGP）：$A_{\\mathrm{NGP}}(x)$ 是一个宽度为 $\\Delta$ 的归一化顶帽函数，即当 $|x|\\le \\Delta/2$ 时 $A_{\\mathrm{NGP}}(x) = \\Delta^{-1}$，否则 $A_{\\mathrm{NGP}}(x)=0$。\n\n- 云中云（CIC）：$A_{\\mathrm{CIC}}(x)$ 是两个宽度为 $\\Delta$ 的 NGP 顶帽函数的卷积。\n\n- 三角云（TSC）：$A_{\\mathrm{TSC}}(x)$ 是三个宽度为 $\\Delta$ 的 NGP 顶帽函数的卷积。\n\n使用这些定义和三维核的可分离性，推导出对应的三维傅里叶空间窗函数 $W_{\\mathrm{NGP}}(\\mathbf{k})$、$W_{\\mathrm{CIC}}(\\mathbf{k})$ 和 $W_{\\mathrm{TSC}}(\\mathbf{k})$，表示为关于 $\\mathbf{k}$ 和 $\\Delta$ 的解析表达式。然后，定义功率抑制因子 $S(\\mathbf{k}) \\equiv |W(\\mathbf{k})|^{2}$，并在与 $x$ 轴对齐的一维奈奎斯特波数矢量处，即在 $\\mathbf{k} = (k_{\\mathrm{N}}, 0, 0)$ 且 $k_{\\mathrm{N}} \\equiv \\pi/\\Delta$ 时，评估抑制因子 $S_{\\mathrm{NGP}}$、$S_{\\mathrm{CIC}}$ 和 $S_{\\mathrm{TSC}}$。\n\n以包含 $\\pi$ 的精确解析形式，将最终的抑制因子 $S_{\\mathrm{NGP}}(k_{\\mathrm{N}}\\hat{\\mathbf{x}})$、$S_{\\mathrm{CIC}}(k_{\\mathrm{N}}\\hat{\\mathbf{x}})$ 和 $S_{\\mathrm{TSC}}(k_{\\mathrm{N}}\\hat{\\mathbf{x}})$ 表示为单个行矩阵。不需要四舍五入，并且您的答案必须是无量纲的。", "solution": "用户希望通过以下步骤解决问题。\n1.  **验证问题陈述**：检查其科学合理性、适定性和客观性。这个问题在计算宇宙学中是标准的，因此可以认为是有效的。\n2.  **理解核心概念**：\n    *   **粒子-网格（PM）**：一种在 $N$ 体模拟中计算引力的方法。\n    *   **分配核 $A(x)$**：描述粒子质量如何分布到网格点上的函数。\n    *   **傅里叶空间窗函数 $W(\\mathbf{k})$**：分配核的傅里叶变换，描述了对密度场傅里叶模式的修正。\n    *   **可分离性**：三维核是可分离的，这意味着三维傅里叶变换是一维变换的乘积。\n    *   **NGP, CIC, TSC**：特定的分配核。\n    *   **奈奎斯特波数 $k_\\mathrm{N}$**：在间距为 $\\Delta$ 的网格上可表示的最高频率。\n    *   **功率抑制因子 $S(\\mathbf{k})$**：量化功率谱的抑制程度。\n3.  **分步推导**：\n    *   **步骤 A**：求出 NGP 的一维窗函数 $W_\\mathrm{NGP}(k_x)$。\n    *   **步骤 B**：使用卷积定理求出 CIC 和 TSC 的一维窗函数。\n    *   **步骤 C**：利用可分离性构造三维窗函数 $W(\\mathbf{k})$。\n    *   **步骤 D**：定义功率抑制因子 $S(\\mathbf{k})$。\n    *   **步骤 E**：在指定的波数矢量 $\\mathbf{k} = (k_\\mathrm{N}, 0, 0)$ 处评估抑制因子。\n    *   **步骤 F**：计算最终的数值。\n4.  **最终检查与格式化**：确保解答使用 LaTeX 正确格式化，并且最终答案以行矩阵形式呈现。\n\n所述问题是数值宇宙学领域中一个完全标准的计算，基于傅里叶分析和信号处理的基本原理。所有术语都有明确定义，前提条件科学合理且内部一致。该问题是有效的。\n\n求解过程首先计算最近邻点（NGP）方案的一维傅里叶空间窗函数，它作为基本构建块。窗函数 $W(k)$ 是实空间分配核 $A(x)$ 的傅里叶变换。对于一维情况，我们将波数记为 $k_x$。傅里叶变换定义为 $W(k_x) = \\int_{-\\infty}^{\\infty} A(x) \\exp(-\\mathrm{i} k_x x) \\, dx$。\n\nNGP 分配核被给定为一个归一化顶帽函数：\n$$\nA_{\\mathrm{NGP}}(x) = \n\\begin{cases} \n\\frac{1}{\\Delta}  \\text{for } |x| \\le \\frac{\\Delta}{2} \\\\\n0  \\text{otherwise}\n\\end{cases}\n$$\nNGP 的一维窗函数 $W_{\\mathrm{NGP}}(k_x)$ 是其傅里叶变换：\n$$\nW_{\\mathrm{NGP}}(k_x) = \\int_{-\\Delta/2}^{\\Delta/2} \\frac{1}{\\Delta} \\exp(-\\mathrm{i} k_x x) \\, dx\n$$\n$$\nW_{\\mathrm{NGP}}(k_x) = \\frac{1}{\\Delta} \\left[ \\frac{\\exp(-\\mathrm{i} k_x x)}{-\\mathrm{i} k_x} \\right]_{-\\Delta/2}^{\\Delta/2} = \\frac{1}{\\Delta} \\left( \\frac{\\exp(-\\mathrm{i} k_x \\Delta/2) - \\exp(\\mathrm{i} k_x \\Delta/2)}{-\\mathrm{i} k_x} \\right)\n$$\n使用欧拉公式 $\\sin(\\theta) = \\frac{\\exp(\\mathrm{i}\\theta) - \\exp(-\\mathrm{i}\\theta)}{2\\mathrm{i}}$，括号中的表达式变为 $\\frac{-2\\mathrm{i} \\sin(k_x \\Delta/2)}{-\\mathrm{i} k_x} = \\frac{2 \\sin(k_x \\Delta/2)}{k_x}$。\n$$\nW_{\\mathrm{NGP}}(k_x) = \\frac{1}{\\Delta} \\frac{2 \\sin(k_x \\Delta/2)}{k_x} = \\frac{\\sin(k_x \\Delta/2)}{k_x \\Delta/2}\n$$\n这是一种未归一化的 sinc 函数形式。为简洁起见，令 $u_x = k_x \\Delta/2$。则 $W_{\\mathrm{NGP}}(k_x) = \\frac{\\sin(u_x)}{u_x}$。\n\n云中云（CIC）和三角云（TSC）核被定义为 NGP 核的卷积。卷积定理指出，两个函数卷积的傅里叶变换是它们各自傅里叶变换的乘积。\n$$\n\\mathcal{F}[f * g] = \\mathcal{F}[f] \\cdot \\mathcal{F}[g]\n$$\n给定 $A_{\\mathrm{CIC}}(x) = A_{\\mathrm{NGP}}(x) * A_{\\mathrm{NGP}}(x)$，其窗函数为：\n$$\nW_{\\mathrm{CIC}}(k_x) = W_{\\mathrm{NGP}}(k_x) \\cdot W_{\\mathrm{NGP}}(k_x) = \\left( \\frac{\\sin(u_x)}{u_x} \\right)^2\n$$\n类似地，对于 TSC，$A_{\\mathrm{TSC}}(x) = A_{\\mathrm{NGP}}(x) * A_{\\mathrm{NGP}}(x) * A_{\\mathrm{NGP}}(x)$，所以其窗函数为：\n$$\nW_{\\mathrm{TSC}}(k_x) = \\left( W_{\\mathrm{NGP}}(k_x) \\right)^3 = \\left( \\frac{\\sin(u_x)}{u_x} \\right)^3\n$$\n问题陈述三维核是可分离的，即 $A(\\mathbf{x}) = A(x)A(y)A(z)$。相应地，三维傅里叶变换也是可分离的：\n$$\nW(\\mathbf{k}) = W(k_x) W(k_y) W(k_z)\n$$\n令 $u_i = k_i \\Delta/2$ (对于 $i \\in \\{x, y, z\\}$)，我们得到：\n$$\nW_{\\mathrm{NGP}}(\\mathbf{k}) = \\left(\\frac{\\sin(u_x)}{u_x}\\right) \\left(\\frac{\\sin(u_y)}{u_y}\\right) \\left(\\frac{\\sin(u_z)}{u_z}\\right)\n$$\n$$\nW_{\\mathrm{CIC}}(\\mathbf{k}) = \\left(\\frac{\\sin(u_x)}{u_x}\\right)^2 \\left(\\frac{\\sin(u_y)}{u_y}\\right)^2 \\left(\\frac{\\sin(u_z)}{u_z}\\right)^2\n$$\n$$\nW_{\\mathrm{TSC}}(\\mathbf{k}) = \\left(\\frac{\\sin(u_x)}{u_x}\\right)^3 \\left(\\frac{\\sin(u_y)}{u_y}\\right)^3 \\left(\\frac{\\sin(u_z)}{u_z}\\right)^3\n$$\n功率抑制因子定义为 $S(\\mathbf{k}) = |W(\\mathbf{k})|^2$。由于推导出的所有窗函数都是实数值的，这可简化为 $S(\\mathbf{k}) = W(\\mathbf{k})^2$。\n$$\nS_{\\mathrm{NGP}}(\\mathbf{k}) = \\left[ \\left(\\frac{\\sin(u_x)}{u_x}\\right) \\left(\\frac{\\sin(u_y)}{u_y}\\right) \\left(\\frac{\\sin(u_z)}{u_z}\\right) \\right]^2\n$$\n$$\nS_{\\mathrm{CIC}}(\\mathbf{k}) = \\left[ \\left(\\frac{\\sin(u_x)}{u_x}\\right)^2 \\left(\\frac{\\sin(u_y)}{u_y}\\right)^2 \\left(\\frac{\\sin(u_z)}{u_z}\\right)^2 \\right]^2 = \\left[ \\left(\\frac{\\sin(u_x)}{u_x}\\right) \\left(\\frac{\\sin(u_y)}{u_y}\\right) \\left(\\frac{\\sin(u_z)}{u_z}\\right) \\right]^4\n$$\n$$\nS_{\\mathrm{TSC}}(\\mathbf{k}) = \\left[ \\left(\\frac{\\sin(u_x)}{u_x}\\right)^3 \\left(\\frac{\\sin(u_y)}{u_y}\\right)^3 \\left(\\frac{\\sin(u_z)}{u_z}\\right)^3 \\right]^2 = \\left[ \\left(\\frac{\\sin(u_x)}{u_x}\\right) \\left(\\frac{\\sin(u_y)}{u_y}\\right) \\left(\\frac{\\sin(u_z)}{u_z}\\right) \\right]^6\n$$\n我们必须在一维奈奎斯特波数矢量 $\\mathbf{k} = (k_{\\mathrm{N}}, 0, 0)$ 处评估这些抑制因子，其中 $k_{\\mathrm{N}} = \\pi/\\Delta$。\n波数矢量的分量为 $k_x = k_{\\mathrm{N}} = \\pi/\\Delta$，$k_y = 0$ 和 $k_z = 0$。\n我们评估相应的 $u_i$ 项：\n对于 $x$ 分量：\n$$\nu_x = k_x \\frac{\\Delta}{2} = \\left(\\frac{\\pi}{\\Delta}\\right) \\frac{\\Delta}{2} = \\frac{\\pi}{2}\n$$\n所以，$x$ 分量的项为：\n$$\n\\frac{\\sin(u_x)}{u_x} = \\frac{\\sin(\\pi/2)}{\\pi/2} = \\frac{1}{\\pi/2} = \\frac{2}{\\pi}\n$$\n对于 $y$ 和 $z$ 分量，$k_y = 0$ 和 $k_z = 0$，这意味着 $u_y = 0$ 和 $u_z = 0$。我们必须取其极限：\n$$\n\\lim_{u \\to 0} \\frac{\\sin(u)}{u} = 1\n$$\n因此，对于 $\\mathbf{k} = (k_{\\mathrm{N}}, 0, 0)$，这三项的乘积变为：\n$$\n\\left(\\frac{\\sin(u_x)}{u_x}\\right) \\left(\\frac{\\sin(u_y)}{u_y}\\right) \\left(\\frac{\\sin(u_z)}{u_z}\\right) \\rightarrow \\left(\\frac{2}{\\pi}\\right) \\cdot 1 \\cdot 1 = \\frac{2}{\\pi}\n$$\n现在我们可以计算在这个特定波数下的抑制因子：\n对于 NGP：\n$$\nS_{\\mathrm{NGP}}(k_{\\mathrm{N}}\\hat{\\mathbf{x}}) = \\left( \\frac{2}{\\pi} \\right)^2 = \\frac{4}{\\pi^2}\n$$\n对于 CIC：\n$$\nS_{\\mathrm{CIC}}(k_{\\mathrm{N}}\\hat{\\mathbf{x}}) = \\left( \\frac{2}{\\pi} \\right)^4 = \\frac{16}{\\pi^4}\n$$\n对于 TSC：\n$$\nS_{\\mathrm{TSC}}(k_{\\mathrm{N}}\\hat{\\mathbf{x}}) = \\left( \\frac{2}{\\pi} \\right)^6 = \\frac{64}{\\pi^6}\n$$\n这些是最终答案，按要求以行矩阵形式呈现。", "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{4}{\\pi^2}  \\frac{16}{\\pi^4}  \\frac{64}{\\pi^6} \\end{pmatrix}}\n$$", "id": "3495428"}, {"introduction": "在获得了网格化的密度场（并理解了其如何被分配窗口函数影响）之后，下一步便是计算其功率谱——宇宙学中描述结构形成的关键统计量。然而，从FFT直接输出的离散傅里叶模式的数值，并不能直接等同于理论上的连续功率谱$P(k)$。这项实践将要求您处理这一核心的归一化问题([@problem_id:3495401])，确保在有限体积和离散化条件下，我们测量的统计量能准确地估计物理现实，并最终推导出在对数尺度上衡量功率的无量纲功率谱$\\Delta^2(k)$。", "problem": "考虑一个统计上均匀且各向同性的宇宙学物质密度对比度场 $\\delta(\\mathbf{x})$，该场定义在一个边长为 $L$、体积为 $V=L^{3}$ 的周期性立方体域中。该场在一个 $N^{3}$ 的均匀网格上进行采样，以应用快速傅里叶变换 (FFT)，其中快速傅里叶变换 (FFT) 指的是在网格上对离散傅里叶变换进行的算法计算。令 $\\mathbf{k}$ 表示由周期性允许的离散波矢量，$\\mathbf{k} = \\frac{2\\pi}{L}\\mathbf{n}$，其中 $\\mathbf{n}\\in\\mathbb{Z}^{3}$。傅里叶模式的系综统计特性被假定为由连续场的功率谱 $P(k)$ 来表征，其中 $k=|\\mathbf{k}|$。\n\n从连续统中均匀各向同性场的功率谱的基本定义出发，并要求 FFT 产生的离散傅里叶振幅在大体积极限下能一致地估计连续统模式，请执行以下操作：\n\n- 为 $\\delta(\\mathbf{x})$ 到 $\\delta(\\mathbf{k})$ 的傅里叶变换选择一种归一化方式，使得在周期性盒子中的离散模式下，傅里叶振幅平方的系综平均等于功率谱。你的选择必须从第一性原理出发，始于功率谱的连续统定义和周期性盒子的离散化。\n- 验证 $P(k)$ 的物理单位，已知 $\\delta(\\mathbf{x})$ 是无量纲的，并且你选择的归一化与在体积 $V$ 上的 FFT 一致。\n- 定义每对数 k 区间的无量纲功率，记为 $\\Delta^{2}(k)$，其要求是 $\\delta(\\mathbf{x})$ 的方差可以写成 $\\Delta^{2}(k)$ 对 $\\ln k$ 的积分，并明确推导出 $\\Delta^{2}(k)$ 关于 $P(k)$ 的表达式。\n\n将你的最终答案表示为 $\\Delta^{2}(k)$ 关于 $P(k)$ 的单个闭合形式解析表达式。无需进行数值计算。最终的方框表达式中不要包含单位。", "solution": "首先将对问题陈述的科学合理性、清晰度和完整性进行验证。\n\n### 第 1 步：提取已知条件\n-   **场**：$\\delta(\\mathbf{x})$，一个统计上均匀且各向同性的宇宙学物质密度对比度场。\n-   **域**：一个边长为 $L$、体积为 $V=L^{3}$ 的周期性立方体域。\n-   **离散化**：该场在一个 $N^{3}$ 的均匀网格上进行采样。\n-   **傅里叶变换**：使用快速傅里叶变换 (FFT) 来计算离散傅里叶变换。\n-   **波矢量**：离散波矢量为 $\\mathbf{k} = \\frac{2\\pi}{L}\\mathbf{n}$，其中 $\\mathbf{n}\\in\\mathbb{Z}^{3}$。\n-   **统计性质**：系综统计由连续场的功率谱 $P(k)$ 描述，其中 $k=|\\mathbf{k}|$。\n-   **任务 1**：为 $\\delta(\\mathbf{x})$ 到 $\\delta(\\mathbf{k})$ 的傅里叶变换选择一种归一化方式，使得傅里叶振幅平方的系综平均等于功率谱，即 $\\langle |\\delta(\\mathbf{k})|^2 \\rangle = P(k)$。\n-   **任务 2**：验证 $P(k)$ 的物理单位，已知 $\\delta(\\mathbf{x})$ 是无量纲的。\n-   **任务 3**：通过关系式 $\\sigma^2 = \\int \\Delta^{2}(k) d(\\ln k)$（其中 $\\sigma^2$ 是 $\\delta(\\mathbf{x})$ 的方差）来定义每对数区间的无量纲功率 $\\Delta^{2}(k)$，并推导出 $\\Delta^{2}(k)$ 关于 $P(k)$ 的显式表达式。\n\n### 第 2 步：使用提取的已知条件进行验证\n该问题在科学上是合理的、良构的且客观的。\n\n-   **科学合理性**：该问题涉及现代宇宙学中的标准概念，特别是大尺度结构的统计描述。密度对比度场 $\\delta(\\mathbf{x})$、功率谱 $P(k)$ 以及在周期性模拟盒子中使用 FFT 都是数值宇宙学中的基本工具。所有前提和定义在事实上都是正确的，并且基于已建立的物理和数学原理。\n-   **良构性**：问题陈述清晰，包含了进行所需推导的所有必要信息。它要求推导标准宇宙学量之间的基本关系。每个任务都存在一个唯一的、有意义的解。\n-   **客观性**：语言精确，没有任何主观或模糊的术语。\n\n该问题不违反任何无效性标准。它是理论和计算宇宙学中一个标准的、可形式化的问题。\n\n### 第 3 步：结论与行动\n该问题是 **有效的**。将提供完整解答。\n\n### 解答推导\n解答过程按顺序处理三个任务。\n\n**1. 傅里叶变换的归一化**\n\n我们从傅里叶空间中连续随机场 $\\delta(\\mathbf{x})$ 的两点相关函数的定义开始。设连续傅里叶变换定义为 $\\delta_C(\\mathbf{k}) = \\int d^3x \\, \\delta(\\mathbf{x}) e^{-i\\mathbf{k}\\cdot\\mathbf{x}}$。对于一个统计上均匀且各向同性的场，两个傅里叶模式乘积的系综平均由下式给出：\n$$\n\\langle \\delta_C(\\mathbf{k}) \\delta_C^*(\\mathbf{k'}) \\rangle = (2\\pi)^3 P(k) \\delta_D(\\mathbf{k} - \\mathbf{k'})\n$$\n其中 $\\delta_D(\\mathbf{k} - \\mathbf{k'})$ 是三维狄拉克δ函数，而 $P(k)$ 是功率谱，仅依赖于模 $k=|\\mathbf{k}|$。\n\n当场被限制在体积为 $V=L^3$ 的有限周期性盒子中时，波矢量 $\\mathbf{k}$ 变为离散的，傅里叶变换定义为此体积上的积分：\n$$\n\\delta_V(\\mathbf{k}) = \\int_V d^3x \\, \\delta(\\mathbf{x}) e^{-i\\mathbf{k}\\cdot\\mathbf{x}}\n$$\n涉及狄拉克δ函数的关系被其有限体积的对应物所取代，即涉及克罗内克δ函数 $\\delta^K_{\\mathbf{k},\\mathbf{k'}}$。对于盒子中的离散模式，该关系变为：\n$$\n\\langle \\delta_V(\\mathbf{k}) \\delta_V^*(\\mathbf{k'}) \\rangle = V P(k) \\delta^K_{\\mathbf{k},\\mathbf{k'}}\n$$\n这意味着对于 $\\mathbf{k}=\\mathbf{k'}$，振幅平方的系综平均为 $\\langle |\\delta_V(\\mathbf{k})|^2 \\rangle = V P(k)$。\n\n问题要求我们为傅里叶变换选择一种归一化，我们将其记为 $\\delta(\\mathbf{k})$，使得其振幅平方的系综平均等于功率谱本身：\n$$\n\\langle |\\delta(\\mathbf{k})|^2 \\rangle = P(k)\n$$\n将此要求与 $\\delta_V(\\mathbf{k})$ 的结果进行比较，我们可以将我们归一化的傅里葉振幅 $\\delta(\\mathbf{k})$ 定义为：\n$$\n\\delta(\\mathbf{k}) = \\frac{\\delta_V(\\mathbf{k})}{\\sqrt{V}}\n$$\n代入 $\\delta_V(\\mathbf{k})$ 的积分定义，所选的傅里叶变换归一化为：\n$$\n\\delta(\\mathbf{k}) = \\frac{1}{\\sqrt{V}} \\int_V d^3x \\, \\delta(\\mathbf{x}) e^{-i\\mathbf{k}\\cdot\\mathbf{x}}\n$$\n这种归一化与 FFT 的使用是一致的。使用 $N^3$ 网格上的场值 $\\delta_j$ 对积分进行的离散近似是 $\\int_V d^3x \\to \\sum_j (V/N^3)$。FFT 算法的原始输出 $C_{\\mathbf{k}} = \\sum_j \\delta_j e^{-i\\mathbf{k}\\cdot\\mathbf{x}_j}$，与我们定义的 $\\delta(\\mathbf{k})$ 通过 $\\delta(\\mathbf{k}) = \\frac{\\sqrt{V}}{N^3} C_{\\mathbf{k}}$ 相关联。\n\n**2. 功率谱 $P(k)$ 的物理单位**\n\n物质密度对比度场 $\\delta(\\mathbf{x}) = (\\rho(\\mathbf{x}) - \\bar{\\rho})/\\bar{\\rho}$ 是密度的比值，使其成为一个无量纲的量。波矢量 $\\mathbf{k}$ 的单位是长度的倒数，我们记为 $[L]^{-1}$。体积 $V$ 的单位是长度的立方，$[L]^3$。\n\n根据第 1 部分中选择的归一化，我们有：\n$$\n\\delta(\\mathbf{k}) = \\frac{1}{\\sqrt{V}} \\int_V d^3x \\, \\delta(\\mathbf{x}) e^{-i\\mathbf{k}\\cdot\\mathbf{x}}\n$$\n我们来分析其物理单位。我们用 $[Q]$ 表示量 $Q$ 的单位。\n$$\n[\\delta(\\mathbf{x})] = 1 \\quad (\\text{无量纲})\n$$\n$$\n[d^3x] = [L]^3\n$$\n$$\n[\\sqrt{V}] = ([L]^3)^{1/2} = [L]^{3/2}\n$$\n因此，傅里叶振幅 $\\delta(\\mathbf{k})$ 的单位是：\n$$\n[\\delta(\\mathbf{k})] = \\frac{1}{[\\sqrt{V}]} [\\int_V d^3x] [\\delta(\\mathbf{x})] = \\frac{1}{[L]^{3/2}} [L]^3 \\cdot 1 = [L]^{3/2}\n$$\n功率谱 $P(k)$ 由关系 $\\langle |\\delta(\\mathbf{k})|^2 \\rangle = P(k)$ 定义。因此，其单位必须是 $\\delta(\\mathbf{k})$ 单位的平方：\n$$\n[P(k)] = [\\delta(\\mathbf{k})]^2 = ([L]^{3/2})^2 = [L]^3\n$$\n功率谱 $P(k)$ 的单位是体积。\n\n**3. 无量纲功率谱 $\\Delta^2(k)$ 的推导**\n\n场 $\\delta(\\mathbf{x})$ 的方差定义为 $\\sigma^2 = \\langle \\delta^2(\\mathbf{x}) \\rangle$。由于统计均匀性，该值与位置 $\\mathbf{x}$ 无关。方差可以表示为在零分离处 ($\\mathbf{r}=0$) 求值的两点相关函数 $\\xi(\\mathbf{r}) = \\langle \\delta(\\mathbf{x}+\\mathbf{r})\\delta(\\mathbf{x}) \\rangle$。相关函数是功率谱的傅里叶变换：\n$$\n\\xi(\\mathbf{r}) = \\int \\frac{d^3k}{(2\\pi)^3} P(k) e^{i\\mathbf{k}\\cdot\\mathbf{r}}\n$$\n令 $\\mathbf{r}=0$ 得到方差：\n$$\n\\sigma^2 = \\xi(0) = \\int \\frac{d^3k}{(2\\pi)^3} P(k)\n$$\n由于统计各向同性，功率谱 $P(k)$ 仅依赖于模 $k=|\\mathbf{k}|$。因此，我们可以转换到k空间中的球坐标，其中体积元为 $d^3k = k^2 dk d\\Omega_k$，其中 $d\\Omega_k$ 是立体角元。\n$$\n\\sigma^2 = \\int_0^\\infty \\left( \\int_{S^2} d\\Omega_k \\right) \\frac{k^2}{(2\\pi)^3} P(k) dk\n$$\n对立体角的积分得到 $4\\pi$。\n$$\n\\sigma^2 = \\int_0^\\infty \\frac{4\\pi k^2}{(2\\pi)^3} P(k) dk = \\int_0^\\infty \\frac{k^2}{2\\pi^2} P(k) dk\n$$\n问题通过关系式 $\\sigma^2 = \\int \\Delta^2(k) d(\\ln k)$ 定义了无量纲功率谱 $\\Delta^2(k)$。为了找到 $\\Delta^2(k)$，我们在 $\\sigma^2$ 的表达式中将积分变量从 $k$ 更改为 $\\ln k$。\n令 $u = \\ln k$。这意味着 $k = \\exp(u)$，因此 $dk = \\exp(u) du = k du = k d(\\ln k)$。将 $dk = k d(\\ln k)$ 代入 $\\sigma^2$ 的积分中：\n$$\n\\sigma^2 = \\int_0^\\infty \\frac{k^2}{2\\pi^2} P(k) \\cdot (k \\, d(\\ln k)) = \\int_{-\\infty}^\\infty \\frac{k^3 P(k)}{2\\pi^2} d(\\ln k)\n$$\n（$\\ln k$ 的积分限从 $-\\infty$ 到 $\\infty$，对应于 $k$ 从 $0$ 到 $\\infty$）。\n\n通过将此表达式与定义关系式 $\\sigma^2 = \\int \\Delta^2(k) d(\\ln k)$ 进行比较，我们可以直接确定被积函数：\n$$\n\\Delta^2(k) = \\frac{k^3 P(k)}{2\\pi^2}\n$$\n此表达式定义了每对数波数区间的无量纲功率 $\\Delta^2(k)$，以功率谱 $P(k)$ 表示。", "answer": "$$\\boxed{\\frac{k^3 P(k)}{2\\pi^2}}$$", "id": "3495401"}, {"introduction": "当密度场的演化进入非线性阶段时，小尺度模式的耦合会产生新的、更高频率的模式。在离散网格上，超出奈奎斯特频率的功率并不会消失，而是会“混叠”回较低频率，对我们测量的功率谱和高阶谱（如角谱）造成污染。本练习是一个数值实验([@problem_id:3495462])，您将通过编程人为地激发超奈奎斯特频率的模式，亲手量化混叠效应，并评估交错采样和“三分之二规则”等反混叠技术在抑制这种数值污染方面的有效性。", "problem": "您的任务是使用快速傅里叶变换 (FFT) 在周期性立方体域中构建和分析合成的三维密度场。目标是演示并量化在有意激发高于奈奎斯特波数的傅里叶模式时产生的混叠现象，并测量交叉采样和三分之二去混叠规则对恢复的功率谱和双谱的影响。\n\n从以下基础开始：\n- 采样与混叠：一个边长为 $L$ 的周期性立方体域，在大小为 $N \\times N \\times N$ 的均匀立方网格上采样，其网格间距为 $\\Delta x = L/N$，奈奎斯特波数值为 $k_{\\mathrm{Ny}} = \\pi / \\Delta x$。当一个连续场包含波数大小 $|\\mathbf{k}| > k_{\\mathrm{Ny}}$ 的傅里叶分量时，均匀采样会产生混叠，这些分量会作为低波数分量折叠回离散谱中。\n- 离散傅里叶变换：离散傅里叶变换将采样场 $\\delta(\\mathbf{x})$ 转换为在离散波矢 $\\mathbf{k} = (2\\pi/L) \\mathbf{n}$ 处的复系数 $\\tilde{\\delta}(\\mathbf{k})$，其中 $\\mathbf{n}$ 是一个带符号整数三元组。在实践中，通过体素体积 $(\\Delta x)^3$ 进行均匀缩放，可以为不同分辨率下的系数提供一致的物理尺度。\n- 统计谱定义：功率谱 $P(\\mathbf{k})$ 定义为 $|\\tilde{\\delta}(\\mathbf{k})|^2$ 的二次平均值，而双谱 $B(\\mathbf{k}_1,\\mathbf{k}_2,\\mathbf{k}_3)$ 则量化了满足 $\\mathbf{k}_1+\\mathbf{k}_2+\\mathbf{k}_3=\\mathbf{0}$ 的三联点的三阶模式耦合。\n\n您的程序必须根据以下说明构建、处理和分析场：\n1. 几何与采样：\n   - 使用一个边长为 $L$ 的周期性立方体和一个大小为 $N \\times N \\times N$ 的均匀网格。所有量都是无量纲的（没有物理单位）。\n   - 将连续基础场 $f(\\mathbf{x})$ 定义为两个平面波之和，其整数索引向量为 $(n_x,n_y,n_z)$，使得每个波中至少有一个分量满足 $|n_i| > N/2$，以确保 $|\\mathbf{k}| > k_{\\mathrm{Ny}}$。\n   - 将合成密度场定义为 $\\delta(\\mathbf{x}) = f(\\mathbf{x}) + \\beta f(\\mathbf{x})^2$，其中 $\\beta$ 是一个给定的无量纲非线性参数。\n2. 处理方法：\n   - 普通采样：在网格上对 $\\delta(\\mathbf{x})$ 进行采样，不进行额外处理，并计算其 FFT 以获得 $\\tilde{\\delta}(\\mathbf{k})$。\n   - 交叉采样：在每个轴上偏移半个单元的网格上计算 $\\delta(\\mathbf{x})$ 的两个样本，即在 $\\mathbf{x}$ 和 $\\mathbf{x} + (\\Delta x/2,\\Delta x/2,\\Delta x/2)$ 处，在实空间中对这两个采样场进行平均，然后计算平均场的 FFT。\n   - 三分之二去混叠规则：在计算普通采样场的 FFT 后，将任何整数索引分量在任一轴上满足 $|n_i| > N/3$ 的模式设置为零，其余模式保持不变。\n3. 谱测量：\n   - 令 $\\mathbf{k} = (2\\pi/L)\\mathbf{n}$ 表示对应于整数索引三元组 $\\mathbf{n} = (n_x,n_y,n_z)$ 的离散波矢。\n   - 对于每个指定的测试用例，评估并报告以下量：\n     - 在指定的单个目标模式向量 $\\mathbf{k}_{\\mathrm{v}}$ 处恢复的离散功率值 $P(\\mathbf{k}_{\\mathrm{v}}) = |\\tilde{\\delta}(\\mathbf{k}_{\\mathrm{v}})|^2$，该向量对应于一个激发的高波数模式的混叠低波数镜像。\n     - 为指定的单个闭合三联点 $(\\mathbf{k}_1,\\mathbf{k}_2,\\mathbf{k}_3)$（满足 $\\mathbf{k}_1+\\mathbf{k}_2+\\mathbf{k}_3=\\mathbf{0}$）恢复的双谱大小 $|B(\\mathbf{k}_1,\\mathbf{k}_2,\\mathbf{k}_3)| = |\\tilde{\\delta}(\\mathbf{k}_1)\\tilde{\\delta}(\\mathbf{k}_2)\\tilde{\\delta}(\\mathbf{k}_3)|$，选择该三联点以探测混叠驱动的模式耦合。\n   - 在所有方法中，通过在形成任何乘积之前将计算出的复数 FFT 乘以 $(\\Delta x)^3 = (L/N)^3$，来使用相同的、一致的 FFT 归一化。\n4. 测试套件：\n   - 情况 1：$N=32$, $L=1$，两个激发模式的整数索引向量为 $(20,0,0)$ 和 $(0,22,0)$，$f(\\mathbf{x})$ 中振幅相等，非线性参数 $\\beta=0.3$。测量：\n     - 在 $\\mathbf{n}_{\\mathrm{v}}=(12,0,0)$ 处的功率。\n     - 双谱三联点 $(\\mathbf{n}_1,\\mathbf{n}_2,\\mathbf{n}_3) = (12,0,0)$, $(0,10,0)$, $(-12,-10,0)$。\n   - 情况 2：$N=24$, $L=1$，模式为 $(14,0,0)$ 和 $(0,14,0)$，$\\beta=0.5$。测量：\n     - 在 $\\mathbf{n}_{\\mathrm{v}}=(10,0,0)$ 处的功率。\n     - 双谱三联点 $(10,0,0)$, $(0,10,0)$, $(-10,-10,0)$。\n   - 情况 3：$N=16$, $L=1$，模式为 $(13,0,0)$ 和 $(0,9,0)$，$\\beta=0.4$。测量：\n     - 在 $\\mathbf{n}_{\\mathrm{v}}=(3,0,0)$ 处的功率。\n     - 双谱三联点 $(3,0,0)$, $(0,7,0)$, $(-3,-7,0)$。\n5. 输出规格：\n   - 对于每个情况，按以下顺序计算并返回六个值：使用普通采样的 $P(\\mathbf{k}_{\\mathrm{v}})$，使用交叉采样的 $P(\\mathbf{k}_{\\mathrm{v}})$，使用三分之二去混叠规则的 $P(\\mathbf{k}_{\\mathrm{v}})$，使用普通采样的 $|B(\\mathbf{k}_1,\\mathbf{k}_2,\\mathbf{k}_3)|$，使用交叉采样的 $|B(\\mathbf{k}_1,\\mathbf{k}_2,\\mathbf{k}_3)|$，以及使用三分之二去混叠规则的 $|B(\\mathbf{k}_1,\\mathbf{k}_2,\\mathbf{k}_3)|$。\n   - 所有报告的量必须是无量纲的浮点数。\n   - 您的程序应生成单行输出，其中包含结果，格式为一个逗号分隔的列表，包含三个列表（每个测试用例一个），并用方括号括起来，例如 $[\\,[r_1,r_2,r_3,r_4,r_5,r_6],\\,[\\dots],\\,[\\dots]\\,]$。\n\n确保您实现中的科学真实性和内部一致性。程序必须是自包含的，并且不得要求任何用户输入。实现必须遵守指定的环境和库约束。最终的数值答案必须根据提供的测试套件进行确定性计算。", "solution": "用户提供的问题在科学上是合理的、适定的、客观的且内部一致的。它描述了宇宙学和物理学中一个关于傅里叶分析中混叠效应的标准数值实验。所有参数和步骤都已明确指定，从而可以得到一个确定性且可验证的解。因此，该问题被认为是有效的。\n\n这个问题的核心是在离散网格上非线性场演化的背景下研究数值混叠，这是计算科学中一个普遍存在的问题，尤其是在用于模拟宇宙大尺度结构的数值宇宙学中。给定一个边长为 $L$ 的三维周期性盒子中的连续一维密度场 $\\delta(\\mathbf{x})$，然后在大小为 $N \\times N \\times N$ 的均匀立方网格上对其进行采样。\n\n基本要素定义如下：\n- 网格间距为 $\\Delta x = L/N$。\n- 网格点坐标为 $\\mathbf{x}_{\\mathbf{j}} = (j_x, j_y, j_z)\\Delta x$，其中 $j_x, j_y, j_z \\in \\{0, 1, \\dots, N-1\\}$。\n- 在傅里叶空间中，对应的离散波矢为 $\\mathbf{k}_{\\mathbf{n}} = (2\\pi/L)(n_x, n_y, n_z)$，其中 $n_x, n_y, n_z$ 是整数。\n- 奈奎斯特波数 $k_{\\mathrm{Ny}} = \\pi/\\Delta x$ 定义了在网格上可以表示而不产生混叠的最高频率。用整数索引 $\\mathbf{n}$ 表示，这对应于每个分量 $i \\in \\{x,y,z\\}$ 都满足条件 $|n_i| \\le N/2$。\n\n合成场由一个包含两个平面波的基础场 $f(\\mathbf{x})$ 构建。为确保场是实值的，我们使用余弦函数。如无另外说明，按照标准假设单位振幅，基础场为：\n$$f(\\mathbf{x}) = \\cos(\\mathbf{k}_a \\cdot \\mathbf{x}) + \\cos(\\mathbf{k}_b \\cdot \\mathbf{x})$$\n这里，$\\mathbf{k}_a = (2\\pi/L)\\mathbf{n}_a$ 和 $\\mathbf{k}_b = (2\\pi/L)\\mathbf{n}_b$ 是两个初始模式的波矢，其整数向量 $\\mathbf{n}_a$ 和 $\\mathbf{n}_b$ 的选择使得至少有一个分量 $|n_i| > N/2$。这有意地引入了高于奈奎斯特极限的频率。\n\n通过一个二次项引入非线性分量，得到完整的密度场：\n$$\\delta(\\mathbf{x}) = f(\\mathbf{x}) + \\beta f(\\mathbf{x})^2$$\n其中 $\\beta$ 是一个非线性参数。二次项 $f(\\mathbf{x})^2$ 会生成新的傅里叶模式，这些模式对应于初始波矢的谐波和组合，例如 $2\\mathbf{k}_a$、$2\\mathbf{k}_b$、$\\mathbf{k}_a+\\mathbf{k}_b$ 和 $\\mathbf{k}_a-\\mathbf{k}_b$。\n\n当这个连续场 $\\delta(\\mathbf{x})$ 在离散网格上被采样时，任何傅里叶模式 $\\mathbf{k}_{\\mathbf{n}}$，只要其任一分量 $i$ 满足 $|n_i| > N/2$，就会发生混叠。它会被错误地表示为主值范围 $|n'_i| \\le N/2$ 内的一个低波数模式 $\\mathbf{k}_{\\mathbf{n}'}$。混叠索引 $n'_i$ 与真实索引 $n_i$ 的关系为 $n'_i = n_i - N \\cdot \\text{round}(n_i/N)$。对于本问题中的模式，其中 $N/2  |n_i| \\le N$，这可以简化为 $n'_i = n_i - N \\cdot \\text{sign}(n_i)$。\n\n计算采样场 $\\delta(\\mathbf{x}_{\\mathbf{j}})$ 的离散傅里叶变换 (DFT) 并进行归一化，以近似连续傅里叶变换：\n$$\\tilde{\\delta}(\\mathbf{k}_{\\mathbf{n}}) = (\\Delta x)^3 \\sum_{\\mathbf{j}} \\delta(\\mathbf{x}_{\\mathbf{j}}) e^{-i \\mathbf{k}_{\\mathbf{n}} \\cdot \\mathbf{x}_{\\mathbf{j}}}$$\n因子 $(\\Delta x)^3 = (L/N)^3$ 确保得到的傅里叶系数 $\\tilde{\\delta}(\\mathbf{k})$ 无论网格分辨率 $N$ 如何，都具有一致的物理量纲（在这个无量纲设置中为体积）。\n\n我们评估三种处理方法来处理或观察混叠：\n1.  **普通采样**：在网格点 $\\mathbf{x}_{\\mathbf{j}}$ 处对场 $\\delta(\\mathbf{x})$ 进行采样，并直接计算其 DFT。预计此方法将显示最严重的混叠效应。\n2.  **交叉采样**：这是一种简单的抗混叠技术。生成两个场：一个在主网格上采样，$\\delta(\\mathbf{x}_{\\mathbf{j}})$；另一个在移动了半个单元的网格上采样，$\\delta(\\mathbf{x}_{\\mathbf{j}} + \\frac{1}{2}\\boldsymbol{\\Delta x})$。这两个采样场在实空间中被平均，然后对平均后的场进行 DFT。平均操作充当一个低通滤波器，应该能抑制高频模式，从而减少混叠。\n3.  **三分之二去混叠规则**：此方法在傅里叶空间中应用一个锐截止滤波器。在计算普通采样场的 DFT 后，如果任何傅里叶系数 $\\tilde{\\delta}(\\mathbf{k}_{\\mathbf{n}})$ 的整数索引向量 $\\mathbf{n}=(n_x,n_y,n_z)$ 的任一分量超过阈值，即如果 $|n_x| > N/3$ 或 $|n_y| > N/3$ 或 $|n_z| > N/3$，则将其设置为零。此过程旨在移除源自二次相互作用的混叠功率，但在此处的应用方式下，它充当了对已经混叠的谱的后处理滤波器。\n\n最后，我们测量两个关键的统计量来量化混叠的影响：\n- 在特定混叠波矢 $\\mathbf{k}_{\\mathrm{v}}$ 处恢复的功率谱：$P(\\mathbf{k}_{\\mathrm{v}}) = |\\tilde{\\delta}(\\mathbf{k}_{\\mathrm{v}})|^2$。这测量了由于高波数模式的混叠而出现在低波数处的虚假功率。\n- 为特定闭合三联点 $(\\mathbf{k}_1, \\mathbf{k}_2, \\mathbf{k}_3)$（其中 $\\mathbf{k}_1+\\mathbf{k}_2+\\mathbf{k}_3 = \\mathbf{0}$）恢复的双谱大小：$|B(\\mathbf{k}_1, \\mathbf{k}_2, \\mathbf{k}_3)| = |\\tilde{\\delta}(\\mathbf{k}_1)\\tilde{\\delta}(\\mathbf{k}_2)\\tilde{\\delta}(\\mathbf{k}_3)|$。这探测了由基模和耦合模式的混叠产生的虚假三点相关性。\n\n实现过程是为每个指定的测试用例构建这些场并计算谱，将整数模式索引 $\\mathbf{n}$ 映射到 DFT 输出的适当数组索引，然后报告每个用例所需的六个量。对于实值场 $\\delta(\\mathbf{x})$，其 DFT 满足厄米对称性 $\\tilde{\\delta}(\\mathbf{k}_{\\mathbf{n}}) = \\tilde{\\delta}^{*}(-\\mathbf{k}_{\\mathbf{n}})$，这意味着 $P(\\mathbf{k}_{\\mathbf{n}}) = P(-\\mathbf{k}_{\\mathbf{n}})$。这一点是相关的，因为混叠模式可能出现在负索引处，而测量要求在正索引处进行。", "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Constructs and analyzes synthetic 3D density fields to demonstrate and quantify\n    aliasing effects using the Fast Fourier Transform (FFT).\n    \"\"\"\n\n    test_cases = [\n        # Case 1: N=32, L=1, modes (20,0,0), (0,22,0), beta=0.3\n        # Power at (12,0,0), Bispectrum at ((12,0,0), (0,10,0), (-12,-10,0))\n        {\n            \"N\": 32, \"L\": 1.0, \"n_a\": (20, 0, 0), \"n_b\": (0, 22, 0), \"beta\": 0.3,\n            \"n_v\": (12, 0, 0),\n            \"n_b_triad\": ((12, 0, 0), (0, 10, 0), (-12, -10, 0))\n        },\n        # Case 2: N=24, L=1, modes (14,0,0), (0,14,0), beta=0.5\n        # Power at (10,0,0), Bispectrum at ((10,0,0), (0,10,0), (-10,-10,0))\n        {\n            \"N\": 24, \"L\": 1.0, \"n_a\": (14, 0, 0), \"n_b\": (0, 14, 0), \"beta\": 0.5,\n            \"n_v\": (10, 0, 0),\n            \"n_b_triad\": ((10, 0, 0), (0, 10, 0), (-10, -10, 0))\n        },\n        # Case 3: N=16, L=1, modes (13,0,0), (0,9,0), beta=0.4\n        # Power at (3,0,0), Bispectrum at ((3,0,0), (0,7,0), (-3,-7,0))\n        {\n            \"N\": 16, \"L\": 1.0, \"n_a\": (13, 0, 0), \"n_b\": (0, 9, 0), \"beta\": 0.4,\n            \"n_v\": (3, 0, 0),\n            \"n_b_triad\": ((3, 0, 0), (0, 7, 0), (-3, -7, 0))\n        }\n    ]\n\n    all_results = []\n\n    for case in test_cases:\n        N = case[\"N\"]\n        L = case[\"L\"]\n        n_a = np.array(case[\"n_a\"])\n        n_b = np.array(case[\"n_b\"])\n        beta = case[\"beta\"]\n        n_v = case[\"n_v\"]\n        n_b_triad = [np.array(n) for n in case[\"n_b_triad\"]]\n\n        delta_x = L / N\n        voxel_volume = delta_x**3\n\n        # 1. Geometry and Field Definition\n        j = np.arange(N)\n        # Primary grid\n        x = j * delta_x\n        xx, yy, zz = np.meshgrid(x, x, x, indexing='ij')\n\n        # Shifted grid for interlacing\n        x_shifted = (j + 0.5) * delta_x\n        xx_s, yy_s, zz_s = np.meshgrid(x_shifted, x_shifted, x_shifted, indexing='ij')\n\n        k_a = (2 * np.pi / L) * n_a\n        k_b = (2 * np.pi / L) * n_b\n\n        def calculate_field(c_xx, c_yy, c_zz):\n            f_x = (np.cos(k_a[0]*c_xx + k_a[1]*c_yy + k_a[2]*c_zz) +\n                   np.cos(k_b[0]*c_xx + k_b[1]*c_yy + k_b[2]*c_zz))\n            return f_x + beta * f_x**2\n\n        # 2. Processing Methods\n        # Plain sampling\n        delta_plain = calculate_field(xx, yy, zz)\n        fft_plain = np.fft.fftn(delta_plain) * voxel_volume\n        \n        # Interlacing\n        delta_shifted = calculate_field(xx_s, yy_s, zz_s)\n        delta_interlaced = 0.5 * (delta_plain + delta_shifted)\n        fft_interlaced = np.fft.fftn(delta_interlaced) * voxel_volume\n\n        # Two-thirds de-aliasing rule\n        fft_2_3 = fft_plain.copy()\n        freq_indices = np.fft.fftfreq(N, d=1.0) * N\n        nx, ny, nz = np.meshgrid(freq_indices, freq_indices, freq_indices, indexing='ij')\n        \n        k_max_2_3 = N / 3.0\n        mask = (np.abs(nx) > k_max_2_3) | \\\n               (np.abs(ny) > k_max_2_3) | \\\n               (np.abs(nz) > k_max_2_3)\n        fft_2_3[mask] = 0.0\n\n        # Helper to get value at a specific mode vector n\n        def get_val(fft_grid, n_vec):\n            indices = tuple(int(i % N) for i in n_vec)\n            return fft_grid[indices]\n\n        # 3. Spectral Measurements\n        case_results = []\n        fft_methods = [fft_plain, fft_interlaced, fft_2_3]\n        \n        # Power spectrum values\n        for fft in fft_methods:\n            power = np.abs(get_val(fft, n_v))**2\n            case_results.append(power)\n        \n        # Bispectrum values\n        n1, n2, n3 = n_b_triad\n        for fft in fft_methods:\n            bispectrum = np.abs(get_val(fft, n1) * get_val(fft, n2) * get_val(fft, n3))\n            case_results.append(bispectrum)\n        \n        all_results.append(case_results)\n\n    # 5. Output Specification\n    # Convert lists to strings in the required format\n    inner_lists = [f\"[{','.join(f'{v:.10e}' for v in res)}]\" for res in all_results]\n    print(f\"[{','.join(inner_lists)}]\")\n\nsolve()\n```", "id": "3495462"}]}