{"hands_on_practices": [{"introduction": "投掷法蒙特卡罗方法的效率不仅取决于样本数量，还取决于我们如何设定采样区域。这个练习将引导你推导出估计量方差与边界框体积之间的精确关系[@problem_id:3312364]。通过这个推导，你将能从数量上理解为什么一个“更紧”的边界框会带来更优的估计性能，从而深化对算法效率核心的理解。", "problem": "考虑一个具有紧支撑集 $S\\subset\\mathbb{R}^{d}$ 的非负可积函数 $g:\\mathbb{R}^{d}\\to[0,\\infty)$，并定义积分 $I=\\int_{\\mathbb{R}^{d}} g(x)\\,\\mathrm{d}x=\\int_{S} g(x)\\,\\mathrm{d}x$。设 $D_{1}$ 和 $D_{2}$ 是 $\\mathbb{R}^{d}$ 中的两个轴对齐边界框（超矩形），使得 $S\\subset D_{1}$ 且 $S\\subset D_{2}$，其体积满足 $|D_{1}|  |D_{2}|$，其中 $|\\cdot|$ 表示勒贝格测度。假设存在一个已知的有限常数 $H$ 满足 $H\\ge \\sup_{x\\in\\mathbb{R}^{d}} g(x)$，并且对于 $D_{1}$ 和 $D_{2}$，该常数 $H$ 是相同的。\n\n对于每个 $k\\in\\{1,2\\}$，通过抽取 $M$ 个独立同分布 (i.i.d.) 的样本 $(X_{i}^{(k)},U_{i}^{(k)})$（$i=1,\\dots,M$）来构造 $I$ 的一个命中或脱靶蒙特卡洛（hit-or-miss Monte Carlo, MC）估计量，其中 $X_{i}^{(k)}$ 在 $D_{k}$ 上均匀分布，$U_{i}^{(k)}$ 在 $[0,H]$ 上均匀分布，且与 $X_{i}^{(k)}$ 独立。定义 $Y_{i}^{(k)}=\\mathbf{1}\\{U_{i}^{(k)}\\le g(X_{i}^{(k)})\\}$ 及估计量\n$$\n\\widehat{I}_{k} = |D_{k}|\\,H\\,\\frac{1}{M}\\sum_{i=1}^{M} Y_{i}^{(k)}.\n$$\n\n从概率论的第一性原理（指示函数的期望和独立伯努利随机变量样本均值的方差）出发，推导方差之比 $\\mathrm{Var}(\\widehat{I}_{1})/\\mathrm{Var}(\\widehat{I}_{2})$ 关于 $|D_{1}|$、$|D_{2}|$、$H$ 和 $I$ 的闭式表达式。将你的最终答案表示为单个解析表达式。无需四舍五入。", "solution": "首先验证该问题，以确保其具有科学依据、是适定的且客观的。\n\n### 步骤 1：提取已知条件\n- 一个具有紧支撑集 $S\\subset\\mathbb{R}^{d}$ 的非负可积函数 $g:\\mathbb{R}^{d}\\to[0,\\infty)$。\n- 积分 $I=\\int_{\\mathbb{R}^{d}} g(x)\\,\\mathrm{d}x=\\int_{S} g(x)\\,\\mathrm{d}x$。\n- $\\mathbb{R}^{d}$ 中的两个轴对齐边界框 $D_{1}$ 和 $D_{2}$，使得 $S\\subset D_{1}$ 且 $S\\subset D_{2}$。\n- 体积满足 $|D_{1}|  |D_{2}|$，其中 $|\\cdot|$ 表示勒贝格测度。\n- 一个已知的有限常数 $H$ 满足 $H\\ge \\sup_{x\\in\\mathbb{R}^{d}} g(x)$。\n- 对于每个 $k\\in\\{1,2\\}$，抽取 $M$ 个独立同分布 (i.i.d.) 的样本 $(X_{i}^{(k)},U_{i}^{(k)})$，其中 $i=1,\\dots,M$。\n- $X_{i}^{(k)}$ 在 $D_{k}$ 上均匀分布。\n- $U_{i}^{(k)}$ 在 $[0,H]$ 上均匀分布，且与 $X_{i}^{(k)}$ 独立。\n- 随机变量 $Y_{i}^{(k)}=\\mathbf{1}\\{U_{i}^{(k)}\\le g(X_{i}^{(k)})\\}$。\n- $I$ 的估计量为 $\\widehat{I}_{k} = |D_{k}|\\,H\\,\\frac{1}{M}\\sum_{i=1}^{M} Y_{i}^{(k)}$。\n- 任务是推导方差之比 $\\mathrm{Var}(\\widehat{I}_{1})/\\mathrm{Var}(\\widehat{I}_{2})$ 的闭式表达式。\n\n### 步骤 2：使用提取的已知条件进行验证\n问题陈述描述了一个标准的命中或脱靶蒙特卡洛积分场景。\n- **有科学依据**：该问题基于蒙特卡洛方法的成熟数学理论，这是数值分析和计算科学中的一个核心课题。所有原理都是合理的。\n- **适定的**：该问题提供了推导估计量方差及其比值所需的所有必要定义和条件。所有量都有明确定义，并且预期会有一个唯一解。\n- **客观的**：该问题使用精确的数学语言陈述，没有歧义或主观内容。\n\n该问题不存在任何无效性缺陷。它是随机模拟领域中一个有效且适定的问题。\n\n### 步骤 3：结论和行动\n问题是有效的。将提供一个完整的解答。\n\n### 推导\n我们的目标是计算比率 $\\mathrm{Var}(\\widehat{I}_{1})/\\mathrm{Var}(\\widehat{I}_{2})$。我们首先为 $k \\in \\{1, 2\\}$ 推导 $\\mathrm{Var}(\\widehat{I}_{k})$ 的一般表达式。\n\n估计量由下式给出\n$$\n\\widehat{I}_{k} = |D_{k}|\\,H\\,\\frac{1}{M}\\sum_{i=1}^{M} Y_{i}^{(k)}\n$$\n该估计量的方差可以通过方差的性质求得。由于 $Y_{i}^{(k)}$（$i=1,\\dots,M$）是独立同分布的，\n$$\n\\mathrm{Var}(\\widehat{I}_{k}) = \\mathrm{Var}\\left( |D_{k}|\\,H\\,\\frac{1}{M}\\sum_{i=1}^{M} Y_{i}^{(k)} \\right) = \\left( \\frac{|D_{k}|\\,H}{M} \\right)^2 \\mathrm{Var}\\left( \\sum_{i=1}^{M} Y_{i}^{(k)} \\right) = \\frac{(|D_{k}|\\,H)^2}{M^2} \\sum_{i=1}^{M} \\mathrm{Var}(Y_{i}^{(k)})\n$$\n由于变量是同分布的，对所有 $i$ 都有 $\\mathrm{Var}(Y_{i}^{(k)}) = \\mathrm{Var}(Y_{1}^{(k)})$。为简单起见，我们将 $Y_1^{(k)}$ 表示为 $Y^{(k)}$。\n$$\n\\mathrm{Var}(\\widehat{I}_{k}) = \\frac{(|D_{k}|\\,H)^2}{M^2} \\cdot M \\cdot \\mathrm{Var}(Y^{(k)}) = \\frac{(|D_{k}|\\,H)^2}{M} \\mathrm{Var}(Y^{(k)})\n$$\n随机变量 $Y^{(k)} = \\mathbf{1}\\{U^{(k)} \\le g(X^{(k)})\\}$ 是一个指示变量。因此，它服从参数为 $p_k = P(Y^{(k)}=1)$ 的伯努利分布。伯努利随机变量的方差由 $\\mathrm{Var}(Y^{(k)}) = p_k(1-p_k)$ 给出。\n\n我们必须求出 $p_k$。参数 $p_k$ 是“命中”的概率，即 $p_k = P(U^{(k)} \\le g(X^{(k)}))$。我们可以通过在区域 $u \\le g(x)$ 上对 $(X^{(k)}, U^{(k)})$ 的联合概率密度函数 (PDF) 进行积分来计算这个概率。\n\n随机变量 $X^{(k)}$ 在 $D_k$ 上均匀分布，所以其 PDF 为 $f_{X^{(k)}}(x) = \\frac{1}{|D_k|}$（当 $x \\in D_k$ 时），否则为 $0$。\n随机变量 $U^{(k)}$ 在 $[0,H]$ 上均匀分布，所以其 PDF 为 $f_{U^{(k)}}(u) = \\frac{1}{H}$（当 $u \\in [0,H]$ 时），否则为 $0$。\n由于 $X^{(k)}$ 和 $U^{(k)}$ 是独立的，它们的联合 PDF 为 $f_{X^{(k)},U^{(k)}}(x,u) = f_{X^{(k)}}(x)f_{U^{(k)}}(u) = \\frac{1}{|D_k|H}$（当 $(x,u) \\in D_k \\times [0,H]$ 时），否则为 $0$。\n\n现在我们计算 $p_k$：\n$$\np_k = P(U^{(k)} \\le g(X^{(k)})) = \\int_{\\mathbb{R}^d} \\int_{\\mathbb{R}} \\mathbf{1}\\{u \\le g(x)\\} f_{X^{(k)},U^{(k)}}(x,u) \\,\\mathrm{d}u \\,\\mathrm{d}x\n$$\n该积分仅在域 $D_k \\times [0,H]$ 上非零：\n$$\np_k = \\int_{D_k} \\int_{0}^{H} \\mathbf{1}\\{u \\le g(x)\\} \\frac{1}{|D_k|H} \\,\\mathrm{d}u \\,\\mathrm{d}x = \\frac{1}{|D_k|H} \\int_{D_k} \\left( \\int_{0}^{H} \\mathbf{1}\\{u \\le g(x)\\} \\,\\mathrm{d}u \\right) \\,\\mathrm{d}x\n$$\n内层积分计算结果为 $\\int_{0}^{g(x)} 1 \\,\\mathrm{d}u = g(x)$。这是有效的，因为我们已知 $g(x) \\ge 0$ 且 $g(x) \\le \\sup g \\le H$。\n$$\np_k = \\frac{1}{|D_k|H} \\int_{D_k} g(x) \\,\\mathrm{d}x\n$$\n我们已知 $g$ 的支撑集是 $S$，且 $S \\subset D_k$。这意味着对于任何 $x \\in D_k \\setminus S$，$g(x)=0$。因此，$g(x)$ 在 $D_k$ 上的积分等于其在整个 $\\mathbb{R}^d$ 上的积分：\n$$\n\\int_{D_k} g(x) \\,\\mathrm{d}x = \\int_{S} g(x) \\,\\mathrm{d}x = I\n$$\n将此代入 $p_k$ 的表达式，我们得到：\n$$\np_k = \\frac{I}{|D_k|H}\n$$\n现在我们可以用问题参数来表示 $Y^{(k)}$ 的方差：\n$$\n\\mathrm{Var}(Y^{(k)}) = p_k(1-p_k) = \\frac{I}{|D_k|H} \\left( 1 - \\frac{I}{|D_k|H} \\right)\n$$\n将此代回估计量 $\\widehat{I}_k$ 的方差公式中：\n$$\n\\mathrm{Var}(\\widehat{I}_{k}) = \\frac{(|D_k|\\,H)^2}{M} \\mathrm{Var}(Y^{(k)}) = \\frac{(|D_k|\\,H)^2}{M} \\left[ \\frac{I}{|D_k|H} \\left( 1 - \\frac{I}{|D_k|H} \\right) \\right]\n$$\n简化表达式：\n$$\n\\mathrm{Var}(\\widehat{I}_{k}) = \\frac{|D_k|\\,H \\cdot I}{M} \\left( 1 - \\frac{I}{|D_k|H} \\right) = \\frac{|D_k|\\,H \\cdot I}{M} \\left( \\frac{|D_k|\\,H - I}{|D_k|\\,H} \\right)\n$$\n$$\n\\mathrm{Var}(\\widehat{I}_{k}) = \\frac{I}{M} (|D_k|\\,H - I)\n$$\n这是给定边界框 $D_k$ 的估计量的方差。现在我们可以构建 $k=1$ 和 $k=2$ 的方差之比。\n$$\n\\frac{\\mathrm{Var}(\\widehat{I}_{1})}{\\mathrm{Var}(\\widehat{I}_{2})} = \\frac{\\frac{I}{M} (|D_{1}|\\,H - I)}{\\frac{I}{M} (|D_{2}|\\,H - I)}\n$$\n假设 $I  0$，则 $\\frac{I}{M}$ 项可以消去。如果 $I=0$，则 $g(x)$ 几乎处处为零，两个方差都为零，该比值不确定。对于一个非平凡问题，我们假设 $I0$。\n$$\n\\frac{\\mathrm{Var}(\\widehat{I}_{1})}{\\mathrm{Var}(\\widehat{I}_{2})} = \\frac{|D_{1}|\\,H - I}{|D_{2}|\\,H - I}\n$$\n此表达式是最终结果，完全由 $|D_{1}|$、$|D_{2}|$、$H$ 和 $I$ 表示，符合要求。", "answer": "$$\n\\boxed{\\frac{|D_{1}|\\,H - I}{|D_{2}|\\,H - I}}\n$$", "id": "3312364"}, {"introduction": "蒙特卡罗方法的理论根基在于能够获得理想的独立同分布随机数。然而，在实际应用中，我们使用的是伪随机数生成器（PRNG），其质量直接影响模拟结果的准确性[@problem_id:3253644]。本练习是一个编码实践，旨在揭示一个设计不佳的PRNG（如简单的线性同余生成器）会如何引入系统性偏差和相关性，从而破坏蒙特卡罗方法的基本假设。", "problem": "考虑通过命中脱靶蒙特卡洛方法估计数学常数 $\\pi$，该方法在单位正方形 $[0,1]^2$ 中采样点，并计算落在单位四分之一圆 $\\{(x,y)\\in[0,1]^2 \\mid x^2+y^2\\le 1\\}$ 内的点的比例。将具有 $n$ 个点的估计量定义为\n$$\n\\widehat{\\pi}_n \\;=\\; \\frac{4}{n}\\sum_{k=1}^{n}\\mathbf{1}\\big\\{X_k^2+Y_k^2\\le 1\\big\\},\n$$\n其中每个 $(X_k,Y_k)$ 是 $[0,1]^2$ 中的一个点。对于独立同分布（i.i.d.）的均匀输入，在标准条件下，已知此过程是一致且无偏的。\n\n在本问题中，您将：\n- 推导当点由线性同余生成器（LCG）生成时估计量的偏差，该 LCG 定义为 $U_{k+1}=(aU_k+c)\\bmod m$，其中 $U_k\\in\\{0,1,\\dots,m-1\\}$，$a,c,m$ 是整数且 $m\\ge 2$，到单位正方形的映射为 $X_k=U_k/m$，$Y_k=U_{k+1}/m$。\n- 使用基于原理的数值诊断方法检测生成的点集中的相关性伪影。\n\n从以下基本基础开始：\n- 对于在 $[0,1]^2$ 上独立同分布的均匀变量 $(X_k,Y_k)$，指示函数 $\\mathbf{1}\\{X_k^2+Y_k^2\\le 1\\}$ 的期望值等于四分之一圆的面积，即 $\\pi/4$。\n- 对于一个在 $U\\in\\{0,1,\\dots,m-1\\}$ 上完整遍历的 LCG，点对 $(X,Y)=(U/m,((aU+c)\\bmod m)/m)$ 的诱导二维分布是在 $m$ 个点组成的集合 $\\mathcal{S}_m=\\{(U/m,((aU+c)\\bmod m)/m):U\\in\\{0,1,\\dots,m-1\\}\\}$ 上的离散均匀分布。\n\n任务：\n1. 从第一性原理推导，对于在 $[0,1]^2$ 上独立同分布的均匀变量 $(X_k,Y_k)$，$\\widehat{\\pi}_n$ 的期望值，并判断在该设置下估计量是否无偏，并说明其原因。\n2. 对于 LCG 在 $\\mathcal{S}_m$ 上诱导的离散分布，纯粹根据在有限集 $\\mathcal{S}_m$ 上的期望定义，推导精确的全周期偏差公式\n$$\nb_m \\;=\\; \\frac{4}{m}\\sum_{U=0}^{m-1}\\mathbf{1}\\Big\\{\\Big(\\frac{U}{m}\\Big)^2+\\Big(\\frac{(aU+c)\\bmod m}{m}\\Big)^2\\le 1\\Big\\}\\;-\\;\\pi,\n$$\n并解释该偏差如何以及为何会不等于 $0$。\n3. 提出并论证两种数值诊断方法，用于检测经验点集 $\\{(X_k,Y_k)\\}_{k=1}^n$ 中的相关性伪影：\n   - $X_k$ 和 $Y_k$ 之间的样本 Pearson 相关系数，定义为\n   $$\n   r \\;=\\; \\frac{\\operatorname{Cov}(X,Y)}{\\sqrt{\\operatorname{Var}(X)}\\sqrt{\\operatorname{Var}(Y)}},\n   $$\n   从 $n$ 个点计算，约定当 $n2$ 时 $r=0$，如果任一经验标准差为 $0$，则设 $r=1$ 以反映完全的简并性。\n   - 使用在 $[0,1]^2$ 上 $B\\times B$ 网格上的 $\\chi^2$ 统计量进行二维均匀性检验：\n   $$\n   \\chi^2 \\;=\\; \\sum_{i=1}^{B}\\sum_{j=1}^{B}\\frac{(O_{ij}-E)^2}{E},\n   $$\n   其中 $O_{ij}$ 是在单元格 $(i,j)$ 中的观测计数，$E=n/B^2$ 是在均匀性假设下的期望计数。使用 $B=20$。将自由度视为 $\\nu=B^2-1$。如果 $|r|0.05$ 或 $\\chi^2  \\nu + 3\\sqrt{2\\nu}$，则声明存在伪影。\n\n实现要求：\n- 实现一个 LCG 点生成器，具有给定的 $(a,c,m)$、种子 $U_0$ 和 $n$ 个点，通过 $X_k=U_k/m$，$Y_k=U_{k+1}/m$ 生成 $(X_k,Y_k)$。\n- 计算样本估计值 $\\widehat{\\pi}_n$、样本偏差 $b_n=\\widehat{\\pi}_n-\\pi$、如上定义的全周期格点偏差 $b_m$，以及使用指定的诊断方法和决策规则的伪影标志（布尔值）。\n- 本问题中不使用角度，因此不需要指定角度单位。\n\n测试套件：\n使用以下参数集进行评估和报告结果。每个测试用例是一个元组 $(a,c,m,U_0,n)$。\n- 用例 1：$(6137,17,9973,42,10000)$。\n- 用例 2：$(1,1,9973,0,5000)$。\n- 用例 3：$(5,1,64,1,64)$。\n- 用例 4：$(1,0,100,7,100)$。\n- 用例 5：$(6137,17,9973,123,1)$。\n\n答案规范：\n- 对于每个用例，按顺序计算并输出四个值：估计量 $\\widehat{\\pi}_n$、样本偏差 $b_n$、全周期格点偏差 $b_m$ 以及伪影标志（布尔值）。\n- 您的程序应生成单行输出，包含所有用例结果，格式为方括号内的逗号分隔列表，按顺序将各用例结果聚合为一个扁平列表，即 $[\\widehat{\\pi}_n^{(1)},b_n^{(1)},b_m^{(1)},\\text{artifact}^{(1)},\\widehat{\\pi}_n^{(2)},b_n^{(2)},b_m^{(2)},\\text{artifact}^{(2)},\\dots]$。\n\n执行约束：\n- 最终答案必须是一个完整的、可运行的 Python 程序，版本为 3.12，仅使用标准库和 Numerical Python (NumPy) 库版本 1.23.5。\n- 程序必须是自包含的，并且不得要求任何输入。", "solution": "该问题是有效的。它在科学上基于蒙特卡洛方法和伪随机数生成器分析的原理。该问题是适定的，提供了所有必要的定义、常数和测试用例，以便推导和计算出唯一且有意义的解。所有任务都可以在概率论、统计学和数值分析领域内形式化。\n\n我们通过解决三个指定的任务来继续求解。\n\n### 任务1：对于独立同分布均匀点的估计量的无偏性\n\n$\\pi$ 的估计量定义为\n$$\n\\widehat{\\pi}_n = \\frac{4}{n}\\sum_{k=1}^{n}\\mathbf{1}\\big\\{X_k^2+Y_k^2\\le 1\\big\\}\n$$\n其中 $(X_k, Y_k)$ 被假定为独立同分布（i.i.d.）的随机变量，从单位正方形 $[0,1]^2$ 中均匀采样。\n\n为了确定估计量是否无偏，我们必须计算其期望值 $E[\\widehat{\\pi}_n]$，并检查它是否等于真值 $\\pi$。\n\n根据期望的线性性质，我们有：\n$$\nE[\\widehat{\\pi}_n] = E\\left[\\frac{4}{n}\\sum_{k=1}^{n}\\mathbf{1}\\{X_k^2+Y_k^2\\le 1\\}\\right] = \\frac{4}{n}\\sum_{k=1}^{n}E\\left[\\mathbf{1}\\{X_k^2+Y_k^2\\le 1\\}\\right]\n$$\n\n由于点 $(X_k, Y_k)$ 是独立同分布的，指示函数的期望值对于所有 $k \\in \\{1, \\dots, n\\}$ 都是相同的。让我们将一个通用点表示为 $(X, Y)$。指示函数的期望是它所指示事件的概率：\n$$\nE\\left[\\mathbf{1}\\{X^2+Y^2\\le 1\\}\\right] = P(X^2+Y^2 \\le 1)\n$$\n\n点 $(X, Y)$ 是从单位正方形 $[0,1]^2$ 中均匀抽取的，其面积为 $1^2=1$。对于 $(X,Y) \\in [0,1]^2$，事件 $X^2+Y^2 \\le 1$ 描述了位于第一象限的单位圆的面积，即半径为 $1$ 的四分之一圆。这个四分之一圆的面积是 $\\frac{1}{4}\\pi r^2 = \\frac{1}{4}\\pi (1)^2 = \\frac{\\pi}{4}$。\n\n一个均匀抽取的点落入该区域的概率是面积之比：\n$$\nP(X^2+Y^2 \\le 1) = \\frac{\\text{四分之一圆的面积}}{\\text{单位正方形的面积}} = \\frac{\\pi/4}{1} = \\frac{\\pi}{4}\n$$\n\n将这个恒定的期望值代回到 $E[\\widehat{\\pi}_n]$ 的表达式中：\n$$\nE[\\widehat{\\pi}_n] = \\frac{4}{n}\\sum_{k=1}^{n}\\left(\\frac{\\pi}{4}\\right) = \\frac{4}{n} \\cdot n \\cdot \\frac{\\pi}{4} = \\pi\n$$\n\n由于 $E[\\widehat{\\pi}_n] = \\pi$，在独立同分布均匀随机点的假设下，该估计量是无偏的。\n\n### 任务2：线性同余生成器（LCG）的全周期偏差\n\n对于一个周期长度为 $m$ 的全周期 LCG，生成的点对 $(X,Y)$ 的集合不是一个连续均匀分布，而是在 $m$ 个点的有限集上的离散均匀分布：\n$$\n\\mathcal{S}_m = \\left\\{\\left(\\frac{U}{m}, \\frac{(aU+c)\\bmod m}{m}\\right) : U \\in \\{0, 1, \\dots, m-1\\}\\right\\}\n$$\n$\\mathcal{S}_m$ 中的每个点出现的概率为 $1/m$。\n\n在此离散分布上估计量的期望，我们称之为 $E_m[\\widehat{\\pi}]$，代表了估计量在一个完整周期内的平均值。这是通过考虑从 $\\mathcal{S}_m$ 中均匀抽取单个点 $(X,Y)$ 来计算的。\n$$\nE_m[\\widehat{\\pi}] = E_m\\left[4 \\cdot \\mathbf{1}\\{X^2+Y^2\\le 1\\}\\right] = 4 \\cdot E_m\\left[\\mathbf{1}\\{X^2+Y^2\\le 1\\}\\right]\n$$\n\n指示函数在离散集 $\\mathcal{S}_m$ 上的期望是其在每个点上的值的总和，并按每个点的概率（$1/m$）加权：\n$$\nE_m\\left[\\mathbf{1}\\{X^2+Y^2\\le 1\\}\\right] = \\sum_{(x,y) \\in \\mathcal{S}_m} P((X,Y)=(x,y)) \\cdot \\mathbf{1}\\{x^2+y^2\\le 1\\} = \\frac{1}{m}\\sum_{(x,y) \\in \\mathcal{S}_m} \\mathbf{1}\\{x^2+y^2\\le 1\\}\n$$\n代入 $\\mathcal{S}_m$ 中点的显式形式：\n$$\nE_m\\left[\\mathbf{1}\\{X^2+Y^2\\le 1\\}\\right] = \\frac{1}{m}\\sum_{U=0}^{m-1}\\mathbf{1}\\left\\{\\left(\\frac{U}{m}\\right)^2 + \\left(\\frac{(aU+c)\\bmod m}{m}\\right)^2 \\le 1\\right\\}\n$$\n因此，估计量在一个完整周期内的期望值为：\n$$\nE_m[\\widehat{\\pi}] = \\frac{4}{m}\\sum_{U=0}^{m-1}\\mathbf{1}\\left\\{\\left(\\frac{U}{m}\\right)^2 + \\left(\\frac{(aU+c)\\bmod m}{m}\\right)^2 \\le 1\\right\\}\n$$\n偏差 $b_m$ 定义为估计量的期望值减去真值 $\\pi$。这就得到了指定的公式：\n$$\nb_m = E_m[\\widehat{\\pi}] - \\pi = \\frac{4}{m}\\sum_{U=0}^{m-1}\\mathbf{1}\\left\\{\\left(\\frac{U}{m}\\right)^2 + \\left(\\frac{(aU+c)\\bmod m}{m}\\right)^2 \\le 1\\right\\} - \\pi\n$$\n这个偏差 $b_m$ 可能非零，因为 LCG 生成的点并不能均匀地覆盖单位正方形。相反，它们位于一个确定性的网格或格点结构上。公式中的求和是对此特定、高度结构化网格的数值积分（积分的近似）。与真实的连续均匀分布相比，点的离散性质和规则模式可能导致对四分之一圆内点的系统性高估或低估，从而产生一个结构性偏差 $b_m \\neq 0$。\n\n### 任务3：数值诊断方法的论证\n\n该问题提出了两种诊断方法来检测 LCG 固有的相关性伪影，这些伪影违反了独立同分布的均匀性假设。\n\n1.  **样本 Pearson 相关系数 ($r$)**：\n    LCG 生成的点对 $(X_k, Y_k)$ 是 $(U_k/m, U_{k+1}/m)$。LCG 的递推关系是 $U_{k+1} = (aU_k+c) \\bmod m$。这意味着 $Y_k = ((a m X_k + c) \\bmod m) / m$。这是 $X_k$ 和 $Y_k$ 之间的一个分段线性关系。真正的独立同分布均匀变量具有零相关性。LCG 中的确定性、类线性关系会诱导非零相关性。样本 Pearson 相关系数 $r$ 是量化两个变量之间线性关联强度的标准统计度量。一个显著大于零的 $|r|$ 值（此处为 $|r|  0.05$）是一个直接而有力的指标，表明样本不是独立的，揭示了生成器潜在的序列依赖性。\n\n2.  **二维均匀性检验（$\\chi^2$ 统计量）**：\n    $[0,1]^2$ 上独立同分布均匀样本的一个基本特性是空间均匀性；点应该均匀地分布在整个正方形内。然而，LCG 生成的点被限制在平行超平面的格点上。在二维空间中，这意味着所有点 $(X_k, Y_k)$ 都位于少数几条平行的直线上。因此，单位正方形内将有大片区域完全不包含任何点。$\\chi^2$ 拟合优度检验旨在检测这种与假设分布（此处为均匀分布）的偏差。通过将正方形划分为 $B \\times B$ 的网格，并比较每个单元格中的观测计数（$O_{ij}$）与期望计数（$E=n/B^2$），$\\chi^2$ 统计量可以量化与均匀性的偏离程度。LCG 的格点结构将导致许多单元格为空（$O_{ij}=0$），而其他单元格则点数过多，从而导致一个大的 $\\chi^2$ 值。这标志着空间均匀性假设不成立。阈值 $\\nu + 3\\sqrt{2\\nu}$ 是一个标记显著偏差的合理标准，对于自由度 $\\nu$ 很大的 $\\chi^2$ 分布，该值对应于比均值大三个标准差以上的值。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the Monte Carlo problem for all specified test cases.\n    \"\"\"\n    # Define the constant pi for bias calculations.\n    PI = np.pi\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (a, c, m, U0, n)\n        (6137, 17, 9973, 42, 10000),\n        (1, 1, 9973, 0, 5000),\n        (5, 1, 64, 1, 64),\n        (1, 0, 100, 7, 100),\n        (6137, 17, 9973, 123, 1),\n    ]\n\n    results = []\n    for a, c, m, u0, n in test_cases:\n        # --- 1. Generate LCG points ---\n        # U_vals stores the sequence U_0, U_1, ..., U_n\n        # Use np.int64 to prevent overflow on intermediate products (a * U_k)\n        u_vals = np.zeros(n + 1, dtype=np.int64)\n        u_vals[0] = u0\n        for k in range(n):\n            u_vals[k+1] = (a * u_vals[k] + c) % m\n        \n        # Create n points (X_k, Y_k) where X_k = U_k/m, Y_k = U_{k+1}/m\n        # X is from U_0, ..., U_{n-1}\n        # Y is from U_1, ..., U_{n}\n        X = u_vals[:-1] / m\n        Y = u_vals[1:] / m\n\n        # --- 2. Compute estimator and sample bias ---\n        pi_hat_n = 0.0\n        b_n = -PI\n        if n > 0:\n            is_inside_sample = (X**2 + Y**2) = 1\n            pi_hat_n = 4 * np.sum(is_inside_sample) / n\n            b_n = pi_hat_n - PI\n\n        # --- 3. Compute full-period lattice bias ---\n        # Generate all m points of the LCG lattice\n        U_full = np.arange(m, dtype=np.int64)\n        Y_full_ints = (a * U_full + c) % m\n        \n        X_full = U_full / m\n        Y_full = Y_full_ints / m\n        \n        is_inside_full = (X_full**2 + Y_full**2) = 1\n        pi_hat_full = 4 * np.sum(is_inside_full) / m\n        b_m = pi_hat_full - PI\n\n        # --- 4. Compute artifact flag ---\n        # 4a. Pearson correlation artifact\n        r = 0.0\n        if n >= 2:\n            # Using population variance (ddof=0) as per numpy default.\n            # The definition of Pearson r is invariant to ddof.\n            var_X = np.var(X)\n            var_Y = np.var(Y)\n            if var_X == 0 or var_Y == 0:\n                r = 1.0  # As per problem specification for degenerate cases\n            else:\n                # Manual calculation of covariance for clarity\n                cov_XY = np.mean((X - np.mean(X)) * (Y - np.mean(Y)))\n                r = cov_XY / np.sqrt(var_X * var_Y)\n\n        corr_artifact = abs(r) > 0.05\n        \n        # 4b. Chi-squared uniformity artifact\n        B = 20\n        chi2_artifact = False\n        if n > 0:\n            E = n / (B**2)\n            # np.histogram2d bins the data into a 2D grid\n            O, _, _ = np.histogram2d(X, Y, bins=B, range=[[0, 1], [0, 1]])\n            \n            # The formula is valid for E > 0, which holds for n > 0\n            chi2_val = np.sum((O - E)**2 / E)\n            \n            nu = B**2 - 1  # Degrees of freedom\n            chi2_threshold = nu + 3 * np.sqrt(2 * nu)\n            \n            chi2_artifact = chi2_val > chi2_threshold\n\n        # 4c. Combine flags for final verdict\n        artifact = corr_artifact or chi2_artifact\n\n        results.extend([pi_hat_n, b_n, b_m, artifact])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```", "id": "3253644"}, {"introduction": "基础的投掷法蒙特卡罗方法在处理“稀有事件”积分时会遇到严重的效率问题，即被积函数只在一个非常小的区域内非零。当事件发生的概率 $p$ 趋近于零时，标准估计量的相对误差会急剧增大，使得该方法失去实用价值[@problem_id:3312383]。这个练习将促使你从根本上分析该方法的失效原因，并评估如重要性抽样和分层抽样等高级方差缩减技术，这些技术是解决实际应用中复杂模拟问题的关键。", "problem": "考虑估计稀有事件积分（一个体积）$$p \\;=\\; \\int_{[0,1]^d} \\mathbf{1}_A(x)\\,dx,$$ 其中 $A \\subset [0,1]^d$ 是超矩形 $A \\;=\\; [0,\\varepsilon]^d$，$\\varepsilon \\in (0,1)$ 且维度 $d \\in \\mathbb{N}$。标准的击中或脱靶蒙特卡洛估计量使用固定数量 $n \\in \\mathbb{N}$ 的独立同分布样本 $X_1,\\dots,X_n \\sim \\text{Uniform}([0,1]^d)$，其形式为 $$\\widehat{p}_{\\text{HM}} \\;=\\; \\frac{1}{n}\\sum_{i=1}^n \\mathbf{1}_A(X_i).$$ 仅使用期望、方差、伯努利随机变量和强大数定律的基本定义，论证为何当 $\\varepsilon \\to 0$ 时（因此 $p = \\varepsilon^d \\to 0$），固定样本量 $n$ 的击中或脱靶策略变得不切实际。然后，从以下两个方面评估下面提出的每种修改方案：(i) 对 $p$ 的无偏性，以及 (ii) 在固定 $n$ 且 $p \\to 0$ 的情况下，它是否通过实现一个不按 $p^{-1}$ 的正幂次缩放的相对误差，从而缓解了稀有事件中相对误差的激增。\n\n选择所有既正确解释了固定样本量 $n$ 的击中或脱靶法在稀有事件情景下的不切实际性，又提出了一种有效的无偏修改方案的选项，该方案能实现一个与 $p$ 无关的 $O(n^{-1/2})$ 相对误差，或（在阶数上）严格小于基准 $O((n p)^{-1/2})$ 的相对误差。\n\nA. 通过双组分混合进行重要性抽样。令 $u_D$ 表示 $[0,1]^d$ 上的均匀密度（在 $[0,1]^d$ 上密度为 $1$），$u_A$ 表示 $A$ 上的均匀密度（在 $A$ 上密度为 $1/p$，其他地方为 $0$）。对于一个固定的 $\\alpha \\in (0,1)$，定义建议密度 $$q(x) \\;=\\; \\alpha\\,u_A(x) \\,+\\, (1-\\alpha)\\,u_D(x).$$ 从 $q$ 中抽取独立同分布样本 $X_1,\\dots,X_n \\overset{\\text{i.i.d.}}{\\sim} q$，并使用重要性加权估计量 $$\\widehat{p}_{\\text{IS}} \\;=\\; \\frac{1}{n}\\sum_{i=1}^n \\mathbf{1}_A(X_i)\\,\\frac{1}{q(X_i)}.$$ 该估计量对 $p$ 是无偏的，并且当 $p \\to 0$ 时，其相对误差阶为 $O(n^{-1/2})$，与 $p$ 无关。\n\nB. 使用稀有事件覆盖的知识进行双层分层抽样。假设可以在一个体积已知为 $s \\in (0,1)$ 的可测集 $S \\subset [0,1]^d$ 内均匀抽样，使得 $A \\subseteq S$（例如，$S = [0,\\varepsilon']^d$，其中 $\\varepsilon' \\in (\\varepsilon,1)$，因此 $s = \\varepsilon'^d$）。构造两个层 $S$ 和 $S^c$，将 $n_S \\in \\{1,\\dots,n\\}$ 个样本分配给 $S$，将 $n-n_S$ 个样本分配给 $S^c$，并估计 $$\\widehat{p}_{\\text{STR}} \\;=\\; s \\cdot \\frac{1}{n_S}\\sum_{i=1}^{n_S} \\mathbf{1}_A(X_i^{(S)}) \\;+\\; (1-s)\\cdot \\frac{1}{n-n_S}\\sum_{j=1}^{n-n_S} \\mathbf{1}_A(X_j^{(S^c)}),$$ 其中 $X_i^{(S)} \\sim \\text{Uniform}(S)$ 且 $X_j^{(S^c)} \\sim \\text{Uniform}(S^c)$。该估计量是无偏的；当 $A \\subseteq S$ 时，在 $S^c$ 上有 $\\mathbf{1}_A \\equiv 0$，因此第二项的期望为零。如果 $S = A$（因此 $s=p$），估计量的方差为零；更一般地，如果 $s \\in (p,1)$ 并且所有样本都分配给 $S$（即 $n_S = n$），那么相对误差的缩放阶为 $O\\!\\left(\\sqrt{s/(n p)}\\right)$，这比基准 $O((n p)^{-1/2})$ 严格改进了因子 $\\sqrt{s}$，并且当 $s \\asymp p$ 时变为 $O(n^{-1/2})$。\n\nC. 使用常数参考函数的控制变量法。在 $[0,1]^d$ 上取 $g(x) \\equiv 1$（因此已知 $\\int g = 1$），并构造控制变量估计量 $\\widehat{p}_{\\text{CV}} = \\widehat{p}_{\\text{HM}} - \\beta(\\widehat{G} - 1)$，其中 $\\widehat{G} = (1/n)\\sum_{i=1}^n g(X_i)$ 且某个 $\\beta \\in \\mathbb{R}$。这足以减小方差以消除稀有事件困难，并产生与 $p$ 无关的 $O(n^{-1/2})$ 相对误差。\n\nD. 对稀有集进行无加权过采样。从 $A$ 中均匀抽取 $m \\in \\{1,\\dots,n-1\\}$ 个样本，从 $[0,1]^d$ 中均匀抽取 $n-m$ 个样本，并估计 $$\\widehat{p}_{\\text{UNW}} \\;=\\; \\frac{1}{n}\\left(\\sum_{i=1}^m \\mathbf{1}_A(X_i^{(A)}) \\;+\\; \\sum_{j=1}^{n-m} \\mathbf{1}_A(X_j^{(D)})\\right).$$ 即使没有使用重要性权重，该估计量对 $p$ 也是无偏的，并且当 $p \\to 0$ 时，享有与 $p$ 无关的 $O(n^{-1/2})$ 相对误差。\n\nE. 使用朴素比率的负二项停止。不固定 $n$，而是持续对 $X_i \\sim \\text{Uniform}([0,1]^d)$ 进行独立同分布抽样，直到在 $A$ 中观察到恰好 $K \\in \\mathbb{N}$ 次击中（一个负二项停止法则），在随机时间 $N$ 停止，并报告 $\\widehat{p}_{\\text{NB}} = K/N$。当 $K$ 固定且 $p \\to 0$ 时，这是无偏的，并达到与 $p$ 无关的 $O(n^{-1/2})$ 相对误差。", "solution": "该问题要求分析用于估计稀有事件概率的标准击中或脱靶蒙特卡洛方法，并评估几种提出的修改方案。\n\n首先，我们来验证问题陈述。该问题是随机模拟和蒙特卡洛方法领域中一个明确定义的问题。它涉及估计一个积分 $$p \\;=\\; \\int_{[0,1]^d} \\mathbf{1}_A(x)\\,dx,$$ 其中 $A = [0,\\varepsilon]^d$ 是单位超立方体 $[0,1]^d$ 内的一个超矩形。这个集合的体积显然是 $p = \\varepsilon^d$。问题给出了标准的击中或脱靶估计量，任务是分析当 $p \\to 0$ 时其行为，然后根据无偏性和缓解相对误差激增的标准来评估替代方法。所有术语都是标准的，问题在科学上和数学上是合理的、适定的和客观的。因此，我们可以着手解决。\n\n**标准击中或脱靶估计量（$\\widehat{p}_{\\text{HM}}$）的分析**\n\n该估计量是 $\\widehat{p}_{\\text{HM}} = \\frac{1}{n}\\sum_{i=1}^n Y_i$，其中 $Y_i = \\mathbf{1}_A(X_i)$ 且 $X_i \\sim \\text{Uniform}([0,1]^d)$。每个 $Y_i$ 是一个独立同分布的伯努利随机变量。成功的概率（即 $X_i \\in A$）是\n$$ \\mathbb{P}(Y_i=1) = \\mathbb{P}(X_i \\in A) = \\int_{[0,1]^d} \\mathbf{1}_A(x) \\,dx = p. $$\n估计量的期望是\n$$ \\mathbb{E}[\\widehat{p}_{\\text{HM}}] = \\frac{1}{n}\\sum_{i=1}^n \\mathbb{E}[Y_i] = \\frac{1}{n} \\sum_{i=1}^n p = p. $$\n该估计量是无偏的。单个伯努利试验的方差是 $\\text{Var}(Y_i) = p(1-p)$。由于样本是独立同分布的，估计量的方差是\n$$ \\text{Var}(\\widehat{p}_{\\text{HM}}) = \\frac{1}{n^2}\\sum_{i=1}^n \\text{Var}(Y_i) = \\frac{n p (1-p)}{n^2} = \\frac{p(1-p)}{n}. $$\n衡量估计量效率的一个关键指标是其相对误差，定义为其标准差与其均值的比率：\n$$ \\text{RE}(\\widehat{p}_{\\text{HM}}) = \\frac{\\sqrt{\\text{Var}(\\widehat{p}_{\\text{HM}})}}{\\mathbb{E}[\\widehat{p}_{\\text{HM}}]} = \\frac{\\sqrt{p(1-p)/n}}{p} = \\frac{\\sqrt{1-p}}{\\sqrt{np}}. $$\n在稀有事件情景下，当 $\\varepsilon \\to 0$ 时，我们有 $p = \\varepsilon^d \\to 0$。相对误差的极限行为是\n$$ \\lim_{p \\to 0} \\text{RE}(\\widehat{p}_{\\text{HM}}) = \\lim_{p \\to 0} \\frac{\\sqrt{1-p}}{\\sqrt{np}} = \\frac{1}{\\sqrt{np}}. $$\n相对误差的缩放阶为 $O((np)^{-1/2})$。对于固定数量的样本 $n$，当 $p \\to 0$ 时，相对误差会激增。为了达到一个恒定的相对误差 $\\delta$，需要 $\\frac{1}{\\sqrt{np}} \\approx \\delta$，这意味着 $n \\approx \\frac{1}{p\\delta^2}$。所需样本数量随着 $p^{-1}$ 增长，这对于非常小的 $p$ 来说在计算上是不可行的。这就是固定样本量 $n$ 的击中或脱靶策略对于稀有事件的根本不切实际之处。\n\n现在，我们评估每个提出的修改方案。\n\n**选项 A：重要性抽样**\n\n建议密度是 $q(x) = \\alpha\\,u_A(x) + (1-\\alpha)\\,u_D(x)$。对于 $x \\in A$，$u_A(x) = 1/p$ 且 $u_D(x) = 1$，所以 $q(x) = \\alpha/p + 1-\\alpha$。对于 $x \\in [0,1]^d \\setminus A$，$u_A(x) = 0$ 且 $u_D(x)=1$，所以 $q(x) = 1-\\alpha$。$q(x)$ 在 $[0,1]^d$ 上的积分是 $\\int_A (\\frac{\\alpha}{p} + 1-\\alpha)dx + \\int_{[0,1]^d\\setminus A} (1-\\alpha)dx = p(\\frac{\\alpha}{p} + 1-\\alpha) + (1-p)(1-\\alpha) = \\alpha + p(1-\\alpha) + (1-p)(1-\\alpha) = \\alpha + (1-\\alpha) = 1$。该密度是有效的。\n\n估计量是 $\\widehat{p}_{\\text{IS}} = \\frac{1}{n}\\sum_{i=1}^n \\mathbf{1}_A(X_i)\\,\\frac{1}{q(X_i)}$，其中 $X_i \\sim q$。\n- **无偏性**：期望是 $\\mathbb{E}_q[\\widehat{p}_{\\text{IS}}] = \\mathbb{E}_q\\left[\\mathbf{1}_A(X)\\frac{1}{q(X)}\\right] = \\int_{[0,1]^d} \\mathbf{1}_A(x)\\frac{1}{q(x)} q(x) dx = \\int_A 1\\,dx = p$。该估计量是无偏的。\n- **相对误差**：方差是 $\\frac{1}{n}\\text{Var}_q\\left(\\mathbf{1}_A(X)\\frac{1}{q(X)}\\right)$。二阶矩是 $M_2 = \\mathbb{E}_q\\left[\\left(\\mathbf{1}_A(X)\\frac{1}{q(X)}\\right)^2\\right] = \\int_{[0,1]^d} \\left(\\mathbf{1}_A(x)\\frac{1}{q(x)}\\right)^2 q(x) dx = \\int_A \\frac{1}{q(x)} dx$。对于 $x \\in A$，$q(x) = \\frac{\\alpha}{p} + 1-\\alpha$。\n$$ M_2 = \\int_A \\frac{1}{\\frac{\\alpha}{p} + 1-\\alpha} dx = p \\frac{p}{\\alpha + p(1-\\alpha)} = \\frac{p^2}{\\alpha + p(1-\\alpha)}. $$\n单项的方差是 $M_2 - (\\mathbb{E}[\\cdot])^2 = M_2 - p^2 = p^2\\left(\\frac{1}{\\alpha + p(1-\\alpha)} - 1\\right) = p^2 \\frac{1-\\alpha-p(1-\\alpha)}{\\alpha+p(1-\\alpha)}$。\n估计量的方差是 $\\text{Var}(\\widehat{p}_{\\text{IS}}) = \\frac{p^2}{n} \\frac{1-\\alpha-p(1-\\alpha)}{\\alpha+p(1-\\alpha)}$。\n相对误差是 $\\text{RE}(\\widehat{p}_{\\text{IS}}) = \\frac{\\sqrt{\\text{Var}(\\widehat{p}_{\\text{IS}})}}{p} = \\frac{1}{\\sqrt{n}}\\sqrt{\\frac{1-\\alpha-p(1-\\alpha)}{\\alpha+p(1-\\alpha)}}$。\n当 $p \\to 0$ 时，这收敛于 $\\frac{1}{\\sqrt{n}}\\sqrt{\\frac{1-\\alpha}{\\alpha}}$。这是 $O(n^{-1/2})$ 阶的，并且与 $p$ 无关。该方法成功地缓解了相对误差的激增。\n该选项的陈述完全正确。\n\n对 A 的结论：**正确**。\n\n**选项 B：分层抽样**\n\n估计量是 $\\widehat{p}_{\\text{STR}} = s \\widehat{p}_S + (1-s) \\widehat{p}_{S^c}$，其中 $\\widehat{p}_S$ 和 $\\widehat{p}_{S^c}$ 分别是条件概率 $p_S = \\mathbb{P}(X \\in A | X \\in S)$ 和 $p_{S^c} = \\mathbb{P}(X \\in A | X \\in S^c)$ 的估计量。\n- **无偏性**：由于 $A \\subseteq S$，任何来自 $S^c$ 的样本 $X_j^{(S^c)}$ 都不可能在 $A$ 中。因此，对所有 $j$，$\\mathbf{1}_A(X_j^{(S^c)}) = 0$，使得 $\\widehat{p}_{S^c}=0$。估计量简化为 $\\widehat{p}_{\\text{STR}} = s \\cdot \\frac{1}{n_S}\\sum_{i=1}^{n_S} \\mathbf{1}_A(X_i^{(S)})$。期望是 $\\mathbb{E}[\\widehat{p}_{\\text{STR}}] = s \\cdot \\mathbb{E}\\left[\\frac{1}{n_S}\\sum \\mathbf{1}_A(X_i^{(S)})\\right] = s \\cdot \\mathbb{P}(X^{(S)} \\in A) = s \\cdot \\frac{\\text{vol}(A)}{\\text{vol}(S)} = s \\cdot \\frac{p}{s} = p$。该估计量是无偏的。\n- **相对误差**：方差是 $\\text{Var}(\\widehat{p}_{\\text{STR}}) = s^2 \\text{Var}\\left(\\frac{1}{n_S}\\sum \\mathbf{1}_A(X_i^{(S)})\\right)$。项 $\\mathbf{1}_A(X_i^{(S)})$ 是一个参数为 $p/s$ 的伯努利随机变量。其方差是 $\\frac{p}{s}(1-\\frac{p}{s})$。\n$$ \\text{Var}(\\widehat{p}_{\\text{STR}}) = s^2 \\frac{\\frac{p}{s}(1-\\frac{p}{s})}{n_S} = \\frac{s^2}{n_S}\\frac{p(s-p)}{s^2} = \\frac{p(s-p)}{n_S}. $$\n相对误差是 $\\text{RE}(\\widehat{p}_{\\text{STR}}) = \\frac{\\sqrt{p(s-p)/n_S}}{p} = \\sqrt{\\frac{s-p}{p n_S}} = \\sqrt{\\frac{s/p - 1}{n_S}}$。\n该选项考虑将所有样本分配到 $n_S=n$ 的情况。相对误差是 $\\sqrt{\\frac{s/p - 1}{n}}$。与基准相对误差 $\\sqrt{\\frac{1-p}{np}} \\approx \\sqrt{\\frac{1}{np}}$ 相比，这是一个因子为 $\\sqrt{s(1-p/s)/(1-p)} \\approx \\sqrt{s}$ 的改进。由于 $s  1$，这如其所声称的是一个严格的改进。如果可以选择 $S$ 使得 $s \\asymp p$（即，对于某个常数 $C>1$ 有 $s=Cp$），则相对误差变为 $\\sqrt{\\frac{C-1}{n}}$，这是 $O(n^{-1/2})$ 阶的并且与 $p$ 无关。该选项的陈述是正确的。\n\n对 B 的结论：**正确**。\n\n**选项 C：控制变量法**\n\n控制变量是 $g(x) \\equiv 1$。其均值的估计量是 $\\widehat{G} = \\frac{1}{n}\\sum_{i=1}^n g(X_i) = \\frac{1}{n}\\sum_{i=1}^n 1 = 1$。$g(x)$ 的已知均值是 $\\int_{[0,1]^d} 1\\,dx = 1$。\n控制变量估计量是 $\\widehat{p}_{\\text{CV}} = \\widehat{p}_{\\text{HM}} - \\beta(\\widehat{G} - 1)$。由于 $\\widehat{G}=1$，修正项是 $\\beta(1-1) = 0$。\n因此，$\\widehat{p}_{\\text{CV}} = \\widehat{p}_{\\text{HM}}$。该估计量与标准的击中或脱靶估计量相比没有变化。因此，其方差也没有变化。一个控制变量必须与被积函数相关才能实现方差缩减。$\\mathbf{1}_A(X)$ 和常数 $g(X)=1$ 之间的协方差是 $\\text{Cov}(\\mathbf{1}_A(X), 1) = \\mathbb{E}[\\mathbf{1}_A(X) \\cdot 1] - \\mathbb{E}[\\mathbf{1}_A(X)]\\mathbb{E}[1] = p - p \\cdot 1 = 0$。最优系数 $\\beta^*$ 与此协方差成正比，因此为 $0$。对于任何 $\\beta$，方差都不会减小，因为 $\\text{Var}(g(X))=0$。声称此方法可以减小方差并消除稀有事件困难是错误的。\n\n对 C 的结论：**不正确**。\n\n**选项 D：无加权过采样**\n\n估计量是 $\\widehat{p}_{\\text{UNW}} = \\frac{1}{n}\\left(\\sum_{i=1}^m \\mathbf{1}_A(X_i^{(A)}) + \\sum_{j=1}^{n-m} \\mathbf{1}_A(X_j^{(D)})\\right)$。\n$X_i^{(A)} \\sim \\text{Uniform}(A)$，所以 $\\mathbf{1}_A(X_i^{(A)})$ 恒等于 $1$。第一个和就是 $m$。\n$X_j^{(D)} \\sim \\text{Uniform}([0,1]^d)$，所以 $\\mathbb{E}[\\mathbf{1}_A(X_j^{(D)})] = p$。\n- **无偏性**：我们来计算期望。\n$$ \\mathbb{E}[\\widehat{p}_{\\text{UNW}}] = \\frac{1}{n}\\left( \\mathbb{E}\\left[\\sum_{i=1}^m 1\\right] + \\mathbb{E}\\left[\\sum_{j=1}^{n-m} \\mathbf{1}_A(X_j^{(D)})\\right] \\right) = \\frac{1}{n}(m + (n-m)p) = \\frac{m}{n} + p - \\frac{m}{n}p = p + \\frac{m}{n}(1-p). $$\n由于 $m \\in \\{1,\\dots,n-1\\}$ 并且我们处于 $p \\in (0,1)$ 的情景中，我们有 $\\frac{m}{n}(1-p) > 0$。因此，$\\mathbb{E}[\\widehat{p}_{\\text{UNW}}] \\neq p$。该估计量是有偏的。此方法是混合抽样的一种形式，但未能使用必要的的重要性权重来校正有偏的抽样方案，导致最终的估计量是有偏的。该选项关于无偏性的说法是错误的。\n\n对 D 的结论：**不正确**。\n\n**选项 E：负二项停止**\n\n当在样本 $N$ 处观察到 $K$ 次击中时，抽样停止。估计量是 $\\widehat{p}_{\\text{NB}} = K/N$。\n- **无偏性**：试验次数 $N$ 是一个服从负二项分布的随机变量。其支撑集是 $\\{K, K+1, \\dots\\}$。函数 $f(x)=K/x$ 在 $x>0$ 时是严格凸的。根据 Jensen 不等式，对于任何非常数的随机变量 $N$：\n$$ \\mathbb{E}[\\widehat{p}_{\\text{NB}}] = \\mathbb{E}[K/N] > K/\\mathbb{E}[N]. $$\n参数为 $K$ 和 $p$ 的负二项随机变量 $N$ 的期望是 $\\mathbb{E}[N] = K/p$。\n因此，$\\mathbb{E}[\\widehat{p}_{\\text{NB}}] > K/(K/p) = p$。该估计量是有偏的（它高估了 $p$）。声称它是无偏的是错误的。（注意：对于此抽样方案，一个无偏估计量是 $\\widehat{p} = (K-1)/(N-1)$，当 $K \\ge 2$ 时。）\n\n对 E 的结论：**不正确**。\n\n**结论**\n\n只有选项 A 和 B 正确地描述了一种对标准蒙特卡洛方法的有效、无偏的修改，该修改成功地缓解了稀有事件情景下相对误差的激增。重要性抽样（A）和分层抽样（B），如果实施得当，都可以实现一个与 $p$ 无关的 $O(n^{-1/2})$ 阶相对误差，从而解决稀有事件问题。", "answer": "$$\\boxed{AB}$$", "id": "3312383"}]}