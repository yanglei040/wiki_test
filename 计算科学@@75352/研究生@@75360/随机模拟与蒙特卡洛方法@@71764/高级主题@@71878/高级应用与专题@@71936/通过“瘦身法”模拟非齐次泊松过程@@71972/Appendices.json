{"hands_on_practices": [{"introduction": "在应用任何算法之前，我们必须首先理解其工作原理。第一个练习 [@problem_id:3343295] 提供了一个绝佳的实践机会，让您从第一性原理出发，推导稀疏算法的基本性质。通过处理概率生成函数，您将严格证明由稀疏法生成的最终过程确实服从正确的泊松分布，从而为使用该方法打下坚实的理论基础。", "problem": "考虑在区间 $[0,T]$ 上的一个非齐次泊松过程 (NHPP)，其局部可积的强度函数为 $t \\mapsto \\lambda(t)$，且对所有 $t \\in [0,T]$ 满足 $0 \\leq \\lambda(t) \\leq M$，其中 $M$ 是一个有限常数。假设你通过经典的稀疏法来模拟这个 NHPP：首先在 $[0,T]$ 上生成一个速率为 $M$ 的齐次泊松过程，产生建议到达时间 $S_{1}, S_{2}, \\dots, S_{N_{M}(T)}$，其中 $N_{M}(T)$ 表示在 $[0,T]$ 内的建议点数量。然后，以建议时间为条件，以概率 $p(t) = \\lambda(t)/M$ 独立地接受每个在时间 $t$ 的点。令 $N(T)$ 表示在 $[0,T]$ 内被接受的点的数量。\n\n仅从以下基本事实出发：\n- 对于在 $[0,T]$ 上速率为 $M$ 的齐次泊松过程，总计数 $N_{M}(T)$ 服从参数为 $MT$ 的泊松分布，并且在 $N_{M}(T) = n$ 的条件下，无序的建议时间是独立同分布的，服从 $[0,T]$ 上的均匀分布。\n- 对每个在时间 $t$ 的建议点以概率 $p(t)$ 独立接受，会将该点对概率生成函数 (PGF) 的贡献乘以 $(1 - p(t)) + z\\,p(t)$，其中一个非负整数值随机变量 $X$ 的 PGF 定义为 $G_{X}(z) = \\mathbb{E}[z^{X}]$。\n\n推导稀疏后计数 $N(T)$ 的 PGF $G_{N}(z) = \\mathbb{E}[z^{N(T)}]$，并由此计算期望值 $\\mathbb{E}[N(T)]$ 和方差 $\\mathrm{Var}(N(T))$。用累积速率\n$$\n\\Lambda(T) = \\int_{0}^{T} \\lambda(s)\\, ds\n$$\n来表示你的最终答案。\n你的最终答案必须是 $\\mathbb{E}[N(T)]$ 和 $\\mathrm{Var}(N(T))$ 的单一闭式解析表达式，写成一个行矩阵。不需要进行数值四舍五入。", "solution": "目标是推导通过稀疏过程得到的接受点计数 $N(T)$ 的概率生成函数 (PGF)，并随后计算其期望 $\\mathbb{E}[N(T)]$ 和方差 $\\mathrm{Var}(N(T))$。推导过程将通过条件化、使用全期望定律以及利用问题陈述中提供的基本事实来进行。\n\n令 $N(T)$ 为区间 $[0, T]$ 内被接受的点的数量。令 $N_M(T)$ 为由速率为 $M$ 的齐次泊松过程 (HPP) 生成的建议点的数量。$N(T)$ 的 PGF 定义为 $G_N(z) = \\mathbb{E}[z^{N(T)}]$。我们可以使用全期望定律来计算它，首先以建议点的数量 $N_M(T)$ 及其位置 $S_1, S_2, \\dots, S_{N_M(T)}$ 为条件。\n\n我们首先以有 $n$ 个建议点 $N_M(T)=n$ 且位于特定时间 $s_1, \\dots, s_n$ 的事件为条件。对于每个在时间 $s_i$ 的建议点，都会执行一次稀疏操作，这是一个独立的伯努利试验。令 $I_i$ 为第 $i$ 个点被接受的指示随机变量。接受的概率为 $p(s_i) = \\lambda(s_i)/M$。因此，$I_i \\sim \\text{Bernoulli}(p(s_i))$。在给定建议点的条件下，被接受的点的总数是 $N(T) = \\sum_{i=1}^n I_i$。\n\n由于稀疏试验是独立的，它们之和的 PGF 是它们各自 PGF 的乘积。一个成功概率为 $p(s_i)$ 的伯努利变量 $I_i$ 的 PGF 是 $G_{I_i}(z) = \\mathbb{E}[z^{I_i}] = (1 - p(s_i)) \\cdot z^0 + p(s_i) \\cdot z^1 = 1 - p(s_i) + z p(s_i)$。这与“基本事实2”中给出的结构一致。\n\n在给定 $N_M(T)=n$ 和位置 $S_1=s_1, \\dots, S_n=s_n$ 的条件下，$N(T)$ 的条件 PGF 是：\n$$\n\\mathbb{E}[z^{N(T)} | N_M(T)=n, S_1=s_1, \\dots, S_n=s_n] = \\mathbb{E}\\left[z^{\\sum_{i=1}^n I_i}\\right] = \\prod_{i=1}^n \\mathbb{E}[z^{I_i}] = \\prod_{i=1}^n (1 - p(s_i) + z p(s_i))\n$$\n\n接下来，我们必须对这个表达式关于建议点的随机位置取平均。根据“基本事实1”，在 $N_M(T)=n$ 的条件下，无序的点位置 $S_1, \\dots, S_n$ 是来自 $[0, T]$ 上均匀分布的独立同分布 (i.i.d.) 随机变量。我们将其记为 $S_i \\sim U[0, T]$。由于 $S_i$ 的独立性，乘积的期望是期望的乘积：\n$$\n\\mathbb{E}[z^{N(T)} | N_M(T)=n] = \\mathbb{E}_{S_1,\\dots,S_n} \\left[ \\prod_{i=1}^n (1 - p(S_i) + z p(S_i)) \\right] = \\prod_{i=1}^n \\mathbb{E}_{S_i} [1 - p(S_i) + z p(S_i)]\n$$\n由于 $S_i$ 是同分布的，乘积中的每个期望都相同。令 $S$ 是一个满足 $S \\sim U[0, T]$ 的一般随机变量。其期望为：\n$$\n\\psi(z) = \\mathbb{E}_S [1 - p(S) + z p(S)] = \\int_{0}^{T} (1 - p(s) + z p(s)) f_S(s) \\, ds\n$$\n其中对于 $s \\in [0, T]$，$f_S(s) = 1/T$。代入 $p(s) = \\lambda(s)/M$：\n$$\n\\psi(z) = \\frac{1}{T} \\int_{0}^{T} \\left(1 - \\frac{\\lambda(s)}{M} + z \\frac{\\lambda(s)}{M}\\right) ds = \\frac{1}{T} \\int_{0}^{T} \\left(1 + (z-1)\\frac{\\lambda(s)}{M}\\right) ds\n$$\n$$\n\\psi(z) = \\frac{1}{T} \\left( \\int_{0}^{T} 1 \\, ds + \\frac{z-1}{M} \\int_{0}^{T} \\lambda(s) \\, ds \\right) = \\frac{1}{T} \\left( T + \\frac{z-1}{M} \\Lambda(T) \\right) = 1 + \\frac{\\Lambda(T)}{MT}(z-1)\n$$\n其中 $\\Lambda(T) = \\int_0^T \\lambda(s) \\, ds$。\n因此，在 $N_M(T)=n$ 的条件下，$N(T)$ 的 PGF 是 $(\\psi(z))^n$。\n\n最后，我们对建议点的数量 $N_M(T)$ 取平均。根据“基本事实1”，$N_M(T)$ 服从参数为 $MT$ 的泊松分布，即 $N_M(T) \\sim \\text{Poisson}(MT)$。$N(T)$ 的无条件 PGF 是：\n$$\nG_N(z) = \\mathbb{E}[z^{N(T)}] = \\mathbb{E}_{N_M(T)}[\\mathbb{E}[z^{N(T)} | N_M(T)]] = \\mathbb{E}_{N_M(T)} [(\\psi(z))^{N_M(T)}]\n$$\n这是 $N_M(T)$ 的 PGF 在点 $w = \\psi(z)$ 处的值，即 $G_N(z) = G_{N_M(T)}(\\psi(z))$。参数为 $\\mu$ 的泊松分布的 PGF 是 $G(w) = \\exp(\\mu(w-1))$。这里，$\\mu=MT$。\n$$\nG_N(z) = \\exp(MT(\\psi(z) - 1))\n$$\n代入 $\\psi(z)$ 的表达式：\n$$\nG_N(z) = \\exp\\left(MT\\left(\\left(1 + \\frac{\\Lambda(T)}{MT}(z-1)\\right) - 1\\right)\\right) = \\exp\\left(MT \\cdot \\frac{\\Lambda(T)}{MT}(z-1)\\right)\n$$\n$$\nG_N(z) = \\exp(\\Lambda(T)(z-1))\n$$\n这是参数为 $\\Lambda(T)$ 的泊松分布的 PGF。因此，被接受的点的数量 $N(T)$ 服从泊松分布，其均值和方差都等于 $\\Lambda(T)$。\n\n我们现在从其 PGF 计算 $N(T)$ 的期望值和方差。\n期望值由 PGF 在 $z=1$ 处的一阶导数给出：\n$$\n\\mathbb{E}[N(T)] = G'_N(z) \\Big|_{z=1}\n$$\n$$\nG'_N(z) = \\frac{d}{dz} \\exp(\\Lambda(T)(z-1)) = \\Lambda(T) \\exp(\\Lambda(T)(z-1))\n$$\n$$\n\\mathbb{E}[N(T)] = \\Lambda(T) \\exp(\\Lambda(T)(1-1)) = \\Lambda(T) \\exp(0) = \\Lambda(T)\n$$\n为了求方差，我们首先计算二阶阶乘矩 $\\mathbb{E}[N(T)(N(T)-1)]$，它由 PGF 在 $z=1$ 处的二阶导数给出：\n$$\n\\mathbb{E}[N(T)(N(T)-1)] = G''_N(z) \\Big|_{z=1}\n$$\n$$\nG''_N(z) = \\frac{d}{dz} \\left( \\Lambda(T) \\exp(\\Lambda(T)(z-1)) \\right) = (\\Lambda(T))^2 \\exp(\\Lambda(T)(z-1))\n$$\n$$\n\\mathbb{E}[N(T)(N(T)-1)] = (\\Lambda(T))^2 \\exp(\\Lambda(T)(1-1)) = (\\Lambda(T))^2\n$$\n方差由 $\\mathrm{Var}(N(T)) = \\mathbb{E}[N(T)(N(T)-1)] + \\mathbb{E}[N(T)] - (\\mathbb{E}[N(T)])^2$ 给出：\n$$\n\\mathrm{Var}(N(T)) = (\\Lambda(T))^2 + \\Lambda(T) - (\\Lambda(T))^2 = \\Lambda(T)\n$$\n稀疏后计数 $N(T)$ 的期望值和方差都等于累积速率 $\\Lambda(T)$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\Lambda(T)  \\Lambda(T)\n\\end{pmatrix}\n}\n$$", "id": "3343295"}, {"introduction": "确认了稀疏法的正确性之后，一个实际的问题随之而来：与其他技术相比，它的效率如何？这个问题 [@problem_id:3343303] 对稀疏法与逆变换法（另一种模拟非齐次泊松过程的常用方法）进行了直接比较。您将推导出一个关于相对效率的解析表达式，从而深入理解控制过程的选择对计算成本的影响。", "problem": "考虑一个非齐次泊松过程 (NHPP)，其强度函数为 $\\lambda(t)=\\alpha t$，其中 $t\\geq 0$ 且 $\\alpha0$。您希望模拟事件时间，直到接受了固定数量 $n$ 个事件为止。\n\n一种方法是使用稀疏法，该方法利用一个控制性 NHPP，其强度函数为 $m(t)=\\beta t$，其中 $\\beta\\geq \\alpha$ 是一个已知常数。在稀疏法中，来自控制过程的在时间 $t$ 提议的事件以概率 $\\lambda(t)/m(t)$ 被接受。另一种方法是逆变换法，该方法基于时间变换和累积率，直接求取 NHPP 的第 $n$ 个到达时间 $T_n$。\n\n从 NHPP 的定义、稀疏法构造以及通过累积率函数的时间变换特征出发，推导稀疏法为获得 $n$ 个接受事件所需的提议事件总数的期望值的显式解析表达式。然后，定义一个效率比 $R(\\alpha,\\beta,n)$，其值为稀疏法下的期望提议数除以执行逆变换法所需的指数随机抽样次数。逆变换法通过对变换后的到达间隔时间进行抽样并映射回时钟时间来直接求取 $T_n$。假设逆变换法使用 $n$ 个速率为 1 的独立指数随机变量之和来构建变换后的第 $n$ 个到达，并进行一次逆累积率映射的应用。在效率比的定义中，忽略计算 $\\lambda(t)$ 或 $m(t)$ 以及逆映射本身的成本。\n\n以 $\\alpha$、$\\beta$ 和 $n$ 的形式，为 $R(\\alpha,\\beta,n)$ 提供一个单一的闭式解析表达式。不需要数值近似，也不涉及单位。最终答案必须是单一表达式。", "solution": "我们首先分析稀疏法的成本。该方法使用一个强度为 $m(t) = \\beta t$ 的控制过程来提议事件，目标过程的强度为 $\\lambda(t) = \\alpha t$。在任意时间 $t$，一个提议事件被接受的概率是：\n$$ p(t) = \\frac{\\lambda(t)}{m(t)} = \\frac{\\alpha t}{\\beta t} = \\frac{\\alpha}{\\beta} $$\n这个接受概率 $p = \\alpha/\\beta$ 是一个常数。模拟过程将持续进行，直到累积了 $n$ 个被接受的事件。这在统计学上等价于进行一系列独立的伯努利试验，直到获得第 $n$ 次成功。\n所需提议的总数（即试验次数）$K$ 服从参数为 $n$ 和 $p$ 的负二项分布。该分布的期望值为：\n$$ E[K] = \\frac{n}{p} = \\frac{n}{\\alpha/\\beta} = \\frac{n\\beta}{\\alpha} $$\n这就是使用稀疏法获得 $n$ 个事件所需的期望提议数。\n\n接下来，我们分析逆变换法的成本。该方法通过时间变换定理，首先在“操作时间”尺度上生成事件。标准齐次泊松过程的第 $n$ 个到达时间 $\\tau_n$ 可以通过对 $n$ 个独立的、速率为 1 的指数随机变量求和得到。问题明确规定，此方法的成本是所需的指数随机抽样次数。因此，逆变换法的成本是 $n$。\n\n最后，我们计算效率比 $R(\\alpha, \\beta, n)$，即稀疏法的期望成本与逆变换法成本之比：\n$$ R(\\alpha, \\beta, n) = \\frac{\\text{稀疏法的期望提议数}}{\\text{逆变换法的抽样次数}} = \\frac{n\\beta/\\alpha}{n} = \\frac{\\beta}{\\alpha} $$\n这个比率仅取决于控制强度与目标强度的比例，与所需事件数 $n$ 无关。", "answer": "$$\\boxed{\\frac{\\beta}{\\alpha}}$$", "id": "3343303"}, {"introduction": "现实世界的模拟通常需要比简单地运行到某个固定时间点 $T$ 更复杂的逻辑。最后一个练习 [@problem_id:3343293] 向您提出了一个挑战：在一个模拟需要根据过程的内部“运行时间”（由积分强度函数 $\\Lambda(t)$ 定义）来停止的场景中，设计一个可实现的停止规则。这需要您对日历时间与积分强度函数之间的联系，以及这种联系如何转化为稀疏算法的逻辑，有深刻的概念性理解。", "problem": "考虑一个在 $[0,\\infty)$ 上具有局部可积强度函数 $\\lambda(t)$ 的非齐次泊松过程 (NHPP)，并令累积强度为 $\\Lambda(t) = \\int_{0}^{t} \\lambda(s)\\,ds$。假设 $\\lambda(t)$ 被一个已知常数 $M  0$ 所界定，因此对于所有 $t \\ge 0$ 都有 $\\lambda(t) \\le M$。您使用一个速率为 $M$ 的占优齐次泊松过程进行稀疏：从速率为 $M$ 的齐次过程中提出事件时间 $T_1, T_2, \\dots$，并在每个提议时间 $T_i$，以概率 $\\lambda(T_i)/M$ 接受它作为目标事件，此过程对不同的 $i$ 独立。\n\n固定一个确定性阈值 $L  0$，并定义随机日历时间 $\\tau_L := \\inf\\{t \\ge 0 : \\Lambda(t) \\ge L\\}$。您需要一个可实现的停止规则，该规则用模拟的提议时间和易于计算的量来表述，并保证在停止时，您已经生成了所有且仅有的、不晚于随机日历时间 $\\tau_L$ 发生的目标事件。\n\n哪个选项正确地指定了这样一个停止规则并提供了有效的理由？\n\nA. 在第一个满足 $\\Lambda(T_{i_\\star})  L$ 的提议索引 $i_\\star$ 处停止，并精确输出 $\\{T_1,\\dots,T_{i_\\star-1}\\}$ 中的已接受提议。理由：由于 $\\Lambda$ 是非递减且连续的，$\\Lambda(T_{i_\\star-1}) \\le L \\le \\Lambda(T_{i_\\star})$ 意味着 $T_{i_\\star-1} \\le \\tau_L \\le T_{i_\\star}$；通过稀疏法，所有直到 $\\tau_L$ 的目标事件都必须是严格先于 $T_{i_\\star}$ 的提议中的已接受提议。\n\nB. 当提议的运行计数首次达到 $\\lfloor L \\rfloor$ 时停止，并输出到该点为止的所有已接受提议。理由：在累积强度时间内，提议近似于单位速率泊松过程，因此 $\\lfloor L \\rfloor$ 个提议足以跨过阈值 $L$。\n\nC. 开始时，从 $K \\sim \\mathrm{Poisson}(L)$ 中抽样；然后运行稀疏法，当已接受提议的数量首次等于 $K$ 时停止。输出那 $K$ 个已接受的时间。理由：直到 $\\tau_L$ 的目标事件总数服从 $\\mathrm{Poisson}(L)$ 分布，因此当已接受计数达到 $K$ 时停止，可以再现正确的数量，从而再现直到 $\\tau_L$ 的正确事件集合。\n\nD. 继续进行稀疏法，直到最后一个已接受时间的累积强度首次超过 $L$，即直到第一个满足 $\\Lambda(T_{j_\\star})  L$ 的已接受索引 $j_\\star$，然后输出所有直到并包括 $T_{j_\\star}$ 的已接受提议。理由：已接受时间 $T_{j_\\star}$ 是不晚于 $\\tau_L$ 的最后一个目标事件，因为它的累积强度跨过了 $L$。\n\n只有一个选项是正确的。选择它，并准备好基于 NHPP 的基本原理和稀疏法构造来捍卫该停止规则及其理由的有效性，而不对 $\\Lambda$ 或其逆函数作任何特殊解析形式的假设。", "solution": "为了找到一个正确的停止规则，我们必须确保模拟过程能够生成在随机时间区间 $[0, \\tau_L]$ 内发生的所有事件，并且只生成该区间内的事件。随机时间 $\\tau_L$ 的定义是 $\\tau_L := \\inf\\{t \\ge 0 : \\Lambda(t) \\ge L\\}$。由于累积强度函数 $\\Lambda(t)$ 是连续且非递减的，我们有 $\\Lambda(\\tau_L) = L$。\n\n让我们逐一分析各个选项：\n\n**选项 A**: 该规则建议在第一个满足 $\\Lambda(T_{i_\\star}) > L$ 的提议时间 $T_{i_\\star}$ 处停止模拟，并输出在 $T_{i_\\star}$ 之前被接受的所有提议。\n- **覆盖所有事件（“All”条件）**: 由于 $\\Lambda(t)$ 是非递减的，$\\Lambda(T_{i_\\star}) > L = \\Lambda(\\tau_L)$ 意味着 $T_{i_\\star} \\ge \\tau_L$（几乎必然是 $T_{i_\\star} > \\tau_L$）。这意味着任何在 $T_{i_\\star}$ 或之后发生的提议都不可能落在目标区间 $[0, \\tau_L]$ 内。因此，$[0, \\tau_L]$ 内的所有目标事件必然源自于 $T_{i_\\star}$ 之前的提议。该规则确保了对目标区间的完全覆盖。\n- **仅包含目标事件（“Only”条件）**: 对于任何在 $T_{i_\\star}$ 之前被接受的提议 $T_j$（即 $j  i_\\star$），根据停止规则的定义，必然有 $\\Lambda(T_j) \\le L$。由于 $\\Lambda(t)$ 非递减，这又意味着 $T_j \\le \\tau_L$。因此，所有输出的事件都确保在目标时间区间内。\n该规则是可实现的（因为它仅依赖于提议时间和 $\\Lambda(t)$ 的计算）且在数学上是正确的。\n\n**选项 B**: 该规则建议在提议数量达到 $\\lfloor L \\rfloor$ 时停止。这是不正确的。$L$ 的单位与累积强度有关（可理解为期望事件数），而提议数量取决于主导过程的速率 $M$。两者之间没有固定的比例关系。\n\n**选项 C**: 该规则建议先从泊松分布 $\\mathrm{Poisson}(L)$ 中抽取一个数 $K$，然后运行模拟直到接受了 $K$ 个事件。虽然在 $[0, \\tau_L]$ 内的事件总数确实服从 $\\mathrm{Poisson}(L)$ 分布，但这个算法只是从正确的分布中生成一个样本。它不能保证对于给定的某次模拟路径，生成的事件集合与实际落在 $[0, \\tau_L]$ 内的事件集合完全相同。\n\n**选项 D**: 该规则建议在第一个被*接受*的事件 $T_{j_\\star}$ 满足 $\\Lambda(T_{j_\\star}) > L$ 时停止。这是有缺陷的。模拟过程可能会在跨越 $\\tau_L$ 时拒绝一长串的提议。该规则可能会过早或过晚地停止。例如，如果最后一个落在 $[0, \\tau_L]$ 内的事件之后紧跟着一连串被拒绝的提议，该规则将无法生成下一个被接受的事件，从而无法触发停止条件。反之，如果它停止于某个 $T_{j_\\star}$，而 $\\Lambda(T_{j_\\star}) > L$，则 $T_{j_\\star} > \\tau_L$，将此事件包含在输出中违反了“仅有”条件。\n\n综上所述，只有选项A提供了正确且可实现的停止规则。", "answer": "$$\\boxed{A}$$", "id": "3343293"}]}