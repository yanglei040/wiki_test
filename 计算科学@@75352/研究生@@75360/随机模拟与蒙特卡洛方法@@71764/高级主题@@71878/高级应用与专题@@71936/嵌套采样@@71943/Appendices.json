{"hands_on_practices": [{"introduction": "运行像嵌套采样这样的任何迭代算法时，一个关键的方面是决定何时停止。过早终止会导致证据估计不准确，而运行时间过长则会浪费计算资源。本练习 [@problem_id:3323429] 探讨了一种实用的终止准则，该准则基于监测最近迭代中增加的证据量，帮助您培养关于算法何时已捕获大部分后验质量的直觉。", "problem": "考虑贝叶斯模型比较，其中贝叶斯证据（边缘似然）定义为 $Z=\\int L(\\theta)\\,\\pi(\\theta)\\,d\\theta$，其中 $L(\\theta)$ 是似然，$\\pi(\\theta)$ 是参数 $\\theta$ 上的先验密度。嵌套采样通过先验质量 $X(\\lambda)=\\int \\mathbb{I}\\{L(\\theta)>\\lambda\\}\\,\\pi(\\theta)\\,d\\theta$ 对该积分进行重参数化，得到恒等式 $Z=\\int_{0}^{1} L(X)\\,dX$，其中 $L(X)$ 是逆似然等高线函数。一个标准的嵌套采样运行维护 $n_{\\mathrm{live}}$ 个活点，并产生一个递减的先验体积序列 $\\{X_k\\}_{k\\ge 0}$（其中 $X_0=1$ 且 $X_k  X_{k-1}$），以及一个似然序列 $\\{L_k\\}_{k\\ge 1}$。在第 $k$ 次迭代时，先验体积从 $X_{k-1}$ 收缩到 $X_k$，而 $L_k$ 是被移除点的似然。证据估计量为 $\\hat Z_k=\\sum_{i=1}^{k} L_i\\,w_i$，其中求积权重为 $w_i=X_{i-1}-X_i$。运行窗口诊断定义为 $\\Delta \\hat Z_k=\\hat Z_{k}-\\hat Z_{k-m}$（对于 $k\\ge m$ 和窗口宽度 $m\\in\\mathbb{N}$）。观察到的稳定条件为 $|\\Delta \\hat Z_k-\\Delta \\hat Z_{k-1}|  \\varepsilon$ 和 $\\Delta \\hat Z_k/\\hat Z_k  \\eta$（对于小容差 $\\varepsilon0$ 和 $\\eta0$）。期望的先验体积收缩为 $E[X_k]\\approx e^{-k/n_{\\mathrm{live}}}$。窗口 $m$ 的期望乘性收缩为 $\\rho\\approx e^{-m/n_{\\mathrm{live}}}$。\n\n根据 $X_k$ 已收缩过“后验主体”这一原理，以下哪项最佳地验证了为什么 $\\Delta \\hat{Z}_k$ 的稳定可以作为运行终止的理由？", "solution": "### 第 1 步：提取已知条件\n问题陈述为嵌套采样算法提供了以下定义和条件：\n-   贝叶斯证据：$Z=\\int L(\\theta)\\,\\pi(\\theta)\\,d\\theta$，其中 $L(\\theta)$ 是似然，$\\pi(\\theta)$ 是先验密度。\n-   通过先验质量进行重参数化：$X(\\lambda)=\\int \\mathbb{I}\\{L(\\theta)\\lambda\\}\\,\\pi(\\theta)\\,d\\theta$。\n-   证据恒等式：$Z=\\int_{0}^{1} L(X)\\,dX$，其中 $L(X)$ 是 $X(\\lambda)$ 的逆。\n-   算法参数：$n_{\\mathrm{live}}$ 个活点。\n-   算法输出：一个先验体积序列 $\\{X_k\\}_{k\\ge 0}$（其中 $X_0=1$ 且 $X_k  X_{k-1}$），以及一个似然序列 $\\{L_k\\}_{k\\ge 1}$。在第 $k$ 次迭代时，先验体积从 $X_{k-1}$ 收缩到 $X_k$，而 $L_k$ 是被移除点的似然。\n-   证据估计量：$\\hat Z_k=\\sum_{i=1}^{k} L_i\\,w_i$，其中求积权重为 $w_i=X_{i-1}-X_i$。\n-   运行窗口诊断：$\\Delta \\hat Z_k=\\hat Z_{k}-\\hat Z_{k-m}$（对于 $k\\ge m$ 和窗口宽度 $m\\in\\mathbb{N}$）。\n-   观察到的稳定条件：$|\\Delta \\hat Z_k-\\Delta \\hat Z_{k-1}|  \\varepsilon$ 和 $\\Delta \\hat Z_k/\\hat Z_k  \\eta$（对于小容差 $\\varepsilon0$ 和 $\\eta0$）。\n-   期望的先验体积收缩：$E[X_k]\\approx e^{-k/n_{\\mathrm{live}}}$。\n-   窗口 $m$ 的期望乘性收缩：$\\rho\\approx e^{-m/n_{\\mathrm{live}}}$。\n\n任务是根据 $X_k$ 已收缩过“后验主体”这一原理，找出为什么 $\\Delta \\hat Z_k$ 的稳定可以验证运行终止的最佳理由。\n\n### 第 2 步：使用提取的已知条件进行验证\n问题陈述是对嵌套采样算法和一个合理的终止启发式方法的在技术上准确且自洽的描述。\n-   **科学依据：**所有定义和关系，如证据恒等式 $Z = \\int_0^1 L(X)dX$ 和数值估计量 $\\hat{Z}_k$，在嵌套采样的文献中都是标准的。期望收缩 $E[X_k] \\approx e^{-k/n_{\\mathrm{live}}}$ 是该算法的一个众所周知的属性。所提出的诊断是基于这些原理的逻辑构造。\n-   **适定性：**该问题要求一个基于所提供的基本原理的概念性论证。它是适定的，因为它寻求将一个观察（$\\Delta \\hat{Z}_k$ 的稳定）与一个结论（终止是有效的）联系起来的正确逻辑推理链。\n-   **客观性：**语言是正式的，没有主观性陈述。条件是用数学方式指定的。\n-   **完整性和一致性：**该问题提供了所有必要的信息来推断诊断、证据积分和终止条件之间的关系。没有内部矛盾。\n\n该问题被认为是**有效的**。\n\n### 第 3 步：推导与选项分析\n\n问题的核心是理解诊断 $\\Delta \\hat{Z}_k$ 的稳定对证据积分的剩余未计算部分意味着什么。\n\n总证据是 $Z=\\int_{0}^{1}L(X)\\,dX$。$k$ 次迭代后的数值估计量 $\\hat Z_k = \\sum_{i=1}^{k} L_i(X_{i-1}-X_i)$ 是部分积分 $\\int_{X_k}^{1}L(X)\\,dX$ 的一个右黎曼和近似。总证据估计的误差主要由未采样的尾部 $Z_{\\mathrm{rem}} = \\int_{0}^{X_k} L(X)\\,dX$ 决定。一个有效的终止准则必须确保这个剩余证据 $Z_{\\mathrm{rem}}$ 与已累积的证据 $\\hat{Z}_k$ 相比可以忽略不计。\n\n运行窗口诊断定义为 $\\Delta \\hat Z_k = \\hat Z_k - \\hat Z_{k-m}$。让我们展开它：\n$$ \\Delta \\hat Z_k = \\left(\\sum_{i=1}^{k} L_i w_i\\right) - \\left(\\sum_{i=1}^{k-m} L_i w_i\\right) = \\sum_{i=k-m+1}^{k} L_i w_i = \\sum_{i=k-m+1}^{k} L_i (X_{i-1} - X_i) $$\n这个和代表了算法最后 $m$ 次迭代中累积的证据。它是 $L(X)$ 在先验体积区间 $[X_k, X_{k-m}]$ 上的积分的数值近似：\n$$ \\Delta \\hat Z_k \\approx \\int_{X_k}^{X_{k-m}} L(X)\\,dX $$\n问题指出该诊断稳定，意味着满足两个条件：\n1.  $|\\Delta \\hat Z_k - \\Delta \\hat Z_{k-1}|  \\varepsilon$：由连续的 $m$ 步窗口贡献的证据量变得几乎恒定。\n2.  $\\Delta \\hat Z_k / \\hat Z_k  \\eta$：最近一个窗口贡献的证据量是迄今为止累积的总证据的一小部分。\n\n“后验主体”对应于先验体积 $X$ 的区域，在该区域中，被积函数 $L(X)$ 很大，并对总积分 $Z$ 做出主要贡献。随着算法的进行，$k$ 增加，$X_k$ 减小，$L_k$ 增加。一旦算法经过了这个主体区域，$L(X)$ 在接近其最大值 $L_{\\max}$ 时开始趋于平坦。在这个阶段，剩余的先验体积 $X_k$ 非常小。\n\n条件 $\\Delta \\hat Z_k / \\hat Z_k  \\eta$ 是最关键的部分。它表明，来自最近的先验体积“壳层” $[X_k, X_{k-m}]$ 的贡献相对于所有先前壳层 $[X_k, 1]$ 的总贡献来说很小。如果来自这个最近壳层的贡献已经可以忽略不计，那么可以合理地推断，来自剩余的、甚至更小的尾部 $[0, X_k]$ 的贡献也将可以忽略不计。这是因为对于减小的 $X$，$L(X)$ 是一个非递减函数，因此在尾部它被 $L_{\\max}$ 上界。因此，$Z_{\\mathrm{rem}} = \\int_0^{X_k} L(X)dX \\le L_{\\max} X_k$。几何收缩属性 $E[X_k] \\approx e^{-k/n_{\\mathrm{live}}}$ 确保了 $X_k$ 呈指数级变小，使得尾部证据的上界 $L_{\\max}X_k$ 也呈指数级收缩。$\\Delta \\hat{Z}_k$ 在一个小的相对值上稳定下来，是一个强有力的指标，表明我们已经进入了这个尾部区域，在这里进一步的采样收益递减。\n\n现在，我们基于这个推理来评估各个选项。\n\n**A. 从 $Z=\\int_{0}^{1}L(X)\\,dX$ 出发，在求积误差范围内，最后一个窗口中累积的证据为 $\\Delta \\hat Z_k\\approx \\int_{X_k}^{X_{k-m}} L(X)\\,dX$。因为 $E[X_{k}]\\approx e^{-k/n_{\\mathrm{live}}}$，一个固定的 $m$ 产生一个期望的恒定因子收缩 $X_{k-m}\\approx \\rho^{-1}X_k$，其中 $\\rho\\approx e^{-m/n_{\\mathrm{live}}}$。如果 $\\Delta \\hat Z_k$ 在一个小的相对尺度上稳定下来，那么在连续的乘性壳层 $\\left[X_{k},X_{k-m}\\right],\\left[X_{k+m},X_{k}\\right],\\dots$ 上的积分近似是平稳且小的，这意味着测度 $L(X)\\,dX$ 在 $\\left[0,X_k\\right]$ 上可以忽略不计。等价地，剩余的尾部 $Z-\\hat Z_k=\\int_{0}^{X_k}L(X)\\,dX$ 与 $\\hat Z_k$ 相比很小，因此关于 $L(X)\\,dX$ 的后验质量主体已经被捕获（即，$X_k$ 位于后验主体之下），在第 k 次迭代时终止是有效的。**\n-   **分析：**该陈述正确地将 $\\Delta \\hat Z_k$ 识别为 $\\int_{X_k}^{X_{k-m}} L(X)\\,dX$ 的一个近似。它正确地使用了几何收缩的属性，将问题框定在先验体积的乘性壳层方面。关键是，它做出了正确的逻辑跳跃：如果来自当前壳层的贡献 $\\Delta \\hat Z_k$ 相对于累积的总证据 $\\hat Z_k$ 很小，那么来自剩余尾部 $\\int_{0}^{X_k}L(X)\\,dX$ 的贡献也预期会很小。这证明了终止的合理性。这个推理是健全的，并且直接建立在所提供的基本原理之上。\n-   **结论：**正确。\n\n**B. 当 $X_k=1-e^{-k/n_{\\mathrm{live}}}$ 时，$\\Delta \\hat Z_k$ 发生稳定，因为 $\\Delta \\hat Z_k$ 仅由 $X_k$ 的收缩动态决定，而不依赖于似然 $L$。因此，终止的有效性总是可以仅从先验体积收缩来判断，而与 $L(X)$ 无关。**\n-   **分析：**这个陈述在多个方面都是不正确的。首先，先验体积收缩的公式是 $E[X_k] \\approx e^{-k/n_{\\mathrm{live}}}$，而不是 $X_k = 1 - e^{-k/n_{\\mathrm{live}}}$。后者描述了一个从 0 增长到 1 的量。其次，声称 $\\Delta \\hat Z_k$ 不依赖于似然 $L$ 是根本错误的。其定义是 $\\Delta \\hat Z_k = \\sum_{i=k-m+1}^{k} L_i w_i$，这明确地涉及到似然值 $L_i$。似然函数 $L(\\theta)$ 的形状决定了“后验主体”的位置，不考虑它就无法决定终止。\n-   **结论：**不正确。\n\n**C. 只有当达到最大似然 $L_{\\max}$ 时，$\\Delta \\hat Z_k$ 才会稳定，因此必须将终止延迟到 $L_k=L_{\\max}$。一旦 $L_k=L_{\\max}$，证据就不再改变，因为被积函数 $L(X)$ 停止增加。**\n-   **分析：**这个陈述是有缺陷的。$\\Delta \\hat Z_k$ 的稳定可能在达到绝对最大似然之前发生，例如，在一个宽广的高似然高原区。更重要的是，“证据不再改变”的说法是错误的。证据估计量 $\\hat Z_k$ 是一个累积和。即使对于所有后续步骤 $L_i$ 都恒定为 $L_{\\max}$，$\\hat Z_k$ 在每一步 $i$ 仍将增加 $L_{\\max} w_i$。终止的目标不是等待证据停止变化，而是确定何时剩余的未计算证据可以忽略不计。\n-   **结论：**不正确。\n\n**D. 如果活点中似然值的方差变小，那么 $\\Delta \\hat Z_k$ 就会稳定，这意味着 $X_k$ 已经收缩过了后验主体部分。因此，终止可以仅基于 $\\{L_i\\}$ 的离散度，而无需参考求积权重 $\\{w_i\\}$ 或尾部积分 $\\int_{0}^{X_k}L(X)\\,dX$。**\n-   **分析：**虽然活点中似然的低方差通常与处于似然高原区域相关，并可能导致一个稳定的 $\\Delta \\hat Z_k$，但这并不是终止的充分条件。终止准则的一个关键部分是相对大小条件 $\\Delta \\hat Z_k / \\hat Z_k  \\eta$，而这个选项忽略了这一点。此外，声称可以“不参考求积权重 $\\{w_i\\}$”来决定终止是一个严重的错误。证据 $Z=\\int L(X)dX$ 本质上是一个积分，其中 $dX$（由 $w_i$ 近似）是测度。忽略权重等同于忽略先验体积，这将使整个方法无效。\n-   **结论：**不正确。", "answer": "$$\\boxed{A}$$", "id": "3323429"}, {"introduction": "由于其随机性，单次嵌套采样运行只提供了证据的一个估计值。验证结果的一个关键步骤是检查多个独立运行之间的一致性。本实践 [@problem_id:3323388] 将指导您设计并应用一个统计检验，以确定两次运行的结果是否在其估计的不确定性范围内达成一致，这是确保您结论的可复现性和可靠性的基本技术。", "problem": "考虑通过嵌套采样进行贝叶斯证据估计，其中证据定义为 $Z = \\int L(\\theta)\\,\\pi(\\theta)\\,d\\theta$，其中 $L(\\theta)$ 表示似然，$ \\pi(\\theta)$ 表示先验密度。每次独立的嵌套采样运行都会产生一个估计量 $\\hat{Z}$，以及证据对数 $\\ln \\hat{Z}$ 的内部方差估计。假设对于足够多的活点和行为良好的似然函数，中心极限定理（CLT）确保单次运行的对数证据估计量 $\\ln \\hat{Z}^{(i)}$ 近似服从均值为 $\\ln Z$、方差为 $V^{(i)}$ 的正态分布，并且两次运行是独立的。\n\n给定对同一后验目标的两次独立运行，其输出如下：\n- 运行 $1$：$\\ln \\hat{Z}^{(1)} = -123.45$，方差估计 $V^{(1)} = 0.04$。\n- 运行 $2$：$\\ln \\hat{Z}^{(2)} = -123.90$，方差估计 $V^{(2)} = 0.0625$。\n\n设计一个配对运行一致性检验，在假设 $H_0:\\ln Z^{(1)}=\\ln Z^{(2)}$（运行一致）下，仅使用独立性和方差估计来推导 $z$-分数。然后，使用双边显著性水平 $\\alpha = 0.05$，对上述数据评估该检验统计量。为进行决策，您可以使用双边标准正态临界值 $c_{0.05} = 1.959964$。计算 $z$-分数，并根据检验规则说明两次运行是否一致，但最终答案只报告 $z$-分数的数值。将最终的 $z$-分数四舍五入到四位有效数字。", "solution": "该问题要求设计并应用一种统计检验，以检查两次独立嵌套采样运行之间的一致性。该检验基于贝叶斯证据的对数估计值 $\\ln \\hat{Z}$ 及其相关方差。\n\n令 $X_1 = \\ln \\hat{Z}^{(1)}$ 和 $X_2 = \\ln \\hat{Z}^{(2)}$ 分别为代表运行 $1$ 和运行 $2$ 的对数证据估计量的随机变量。问题陈述，根据中心极限定理，这些估计量近似服从正态分布。设它们的真实均值为 $\\mu_1$ 和 $\\mu_2$，真实方差为 $\\sigma_1^2$ 和 $\\sigma_2^2$。\n问题提供了以下假设和数据：\n$1$. 估计量服从正态分布：$X_1 \\sim \\mathcal{N}(\\mu_1, \\sigma_1^2)$ 和 $X_2 \\sim \\mathcal{N}(\\mu_2, \\sigma_2^2)$。\n$2$. 运行是独立的。\n$3$. 观测值为 $x_1 = -123.45$ 和 $x_2 = -123.90$。\n$4$. 方差估计为 $\\sigma_1^2 \\approx V^{(1)} = 0.04$ 和 $\\sigma_2^2 \\approx V^{(2)} = 0.0625$。\n\n一致性检验的原假设 $H_0$ 是两次运行都是从具有相同真实证据 $Z$ 的后验分布中采样的。这意味着对数证据估计量的真实均值相等：\n$$H_0: \\mu_1 = \\mu_2$$\n为了检验这个假设，我们考虑两个估计量之差 $\\Delta X = X_1 - X_2$ 的分布。\n\n在原假设 $H_0$ 下，差值的期望值为：\n$$E[\\Delta X] = E[X_1 - X_2] = E[X_1] - E[X_2] = \\mu_1 - \\mu_2 = 0$$\n因为两次运行是独立的，所以差值的方差是它们各自方差的和：\n$$\\text{Var}(\\Delta X) = \\text{Var}(X_1 - X_2) = \\text{Var}(X_1) + \\text{Var}(X_2) = \\sigma_1^2 + \\sigma_2^2$$\n由于 $X_1$ 和 $X_2$ 是正态随机变量，它们的差 $\\Delta X$ 也是一个正态随机变量。因此，在 $H_0$ 下，差值的分布为：\n$$\\Delta X \\sim \\mathcal{N}(0, \\sigma_1^2 + \\sigma_2^2)$$\n检验统计量是观测差值 $\\Delta x = x_1 - x_2$ 的标准分数（$z$-分数）。$z$-分数定义为观测值减去均值，再除以标准差。\n$$z = \\frac{\\Delta x - E[\\Delta X]}{\\sqrt{\\text{Var}(\\Delta X)}} = \\frac{(x_1 - x_2) - 0}{\\sqrt{\\sigma_1^2 + \\sigma_2^2}}$$\n我们将观测值和给定的方差估计值代入此公式：\n$$x_1 = -123.45$$\n$$x_2 = -123.90$$\n$$\\sigma_1^2 = V^{(1)} = 0.04$$\n$$\\sigma_2^2 = V^{(2)} = 0.0625$$\n分子是观测到的对数证据值的差：\n$$\\Delta x = -123.45 - (-123.90) = -123.45 + 123.90 = 0.45$$\n总方差是各个方差的和：\n$$\\sigma_1^2 + \\sigma_2^2 = 0.04 + 0.0625 = 0.1025$$\n差值的标准差是总方差的平方根：\n$$\\sqrt{\\sigma_1^2 + \\sigma_2^2} = \\sqrt{0.1025}$$\n现在，我们计算 $z$-分数：\n$$z = \\frac{0.45}{\\sqrt{0.1025}} \\approx \\frac{0.45}{0.3201562} \\approx 1.405565$$\n问题要求将结果四舍五入到四位有效数字。\n$$z \\approx 1.406$$\n为了做出决策，我们将计算出的 $z$-分数的绝对值与在显著性水平 $\\alpha = 0.05$ 下的双边检验的临界值 $c_{0.05} = 1.959964$ 进行比较。\n$$|z| \\approx 1.406$$\n由于 $|z|  c_{0.05}$（即 $1.406  1.959964$），我们没有足够的证据拒绝原假设 $H_0$。这意味着在指定的显著性水平上，两次运行被认为是一致的。然而，问题只要求提供 $z$-分数的数值。", "answer": "$$\\boxed{1.406}$$", "id": "3323388"}, {"introduction": "嵌套采样运行产生的丰富输出不仅可以用于估计证据。这个高级练习 [@problem_id:3323423] 展示了如何重新利用废弃点序列及其相关权重来进行灵敏度分析。通过计算在不同先验下证据会如何变化，您可以在不运行新的、代价高昂的模拟的情况下，评估模型结论的稳健性。", "problem": "设 $y$ 为观测数据，$\\Theta \\subset \\mathbb{R}^{d}$ 为参数空间，$\\pi(\\theta)$ 为 $\\Theta$ 上的先验密度， $L(\\theta) = p(y \\mid \\theta)$ 为严格为正的似然函数。贝叶斯证据为 $Z = \\int_{\\Theta} L(\\theta) \\,\\pi(\\theta)\\,\\mathrm{d}\\theta$。考虑一个沿指数倾斜分数方向的先验扰动，定义为\n$$\n\\pi_{\\epsilon}(\\theta) = \\pi(\\theta)\\,\\exp\\!\\big(\\epsilon\\,h(\\theta) - \\kappa(\\epsilon)\\big),\n$$\n其中 $h:\\Theta \\to \\mathbb{R}$ 在 $\\pi$ 下可积，并且 $\\kappa(\\epsilon) = \\ln \\int_{\\Theta} \\pi(\\theta)\\,\\exp\\!\\big(\\epsilon\\,h(\\theta)\\big)\\,\\mathrm{d}\\theta$ 确保了对于所有足够小的 $\\epsilon$，$\\pi_{\\epsilon}$ 都是归一化的。定义 $Z(\\epsilon) = \\int_{\\Theta} L(\\theta)\\,\\pi_{\\epsilon}(\\theta)\\,\\mathrm{d}\\theta$。假设 $h$ 在 $\\epsilon=0$ 时的先验下是中心化的，即 $\\int_{\\Theta} h(\\theta)\\,\\pi(\\theta)\\,\\mathrm{d}\\theta = 0$，因此 $\\kappa'(0) = 0$。\n\n一次具有 $n_{\\mathrm{live}} \\in \\mathbb{N}$ 个活点的嵌套采样运行，会产生一个由 $m \\in \\mathbb{N}$ 个死点组成的序列 $\\{(\\theta_{i}, L_{i})\\}_{i=1}^{m}$，其中 $L_{1} \\leq L_{2} \\leq \\cdots \\leq L_{m}$，以及相关的求积权重 $\\{w_{i}\\}_{i=1}^{m}$，由 $w_{i} = X_{i-1} - X_{i}$ 给出，其中 $X_{0} = 1$，$X_{i} = \\prod_{j=1}^{i} T_{j}$，且 $T_{j} \\sim \\mathrm{Beta}(n_{\\mathrm{live}}, 1)$ 是独立的收缩因子。证据的标准嵌套采样估计量为 $\\widehat{Z} = \\sum_{i=1}^{m} w_{i}\\,L_{i}$。\n\n仅从上述定义以及 Gâteaux 导数和期望的基本性质出发，推导 $Z(\\epsilon)$ 在 $\\epsilon=0$ 时沿方向 $h$ 的一阶敏感度（Gâteaux 导数），然后仅使用死点 $\\{(\\theta_{i}, L_{i})\\}_{i=1}^{m}$ 及其权重 $\\{w_{i}\\}_{i=1}^{m}$ 来表示该导数的嵌套采样蒙特卡洛估计量。您的最终答案必须是一个仅用 $\\{(\\theta_{i}, L_{i}, w_{i})\\}_{i=1}^{m}$ 和 $h(\\cdot)$ 表示的单一闭式解析表达式。不要引入任何额外的量。不需要四舍五入，也不涉及单位。请按要求提供最终表达式。", "solution": "该问题需要一个分为两部分的解答：首先，推导贝叶斯证据 $Z(\\epsilon)$ 在 $\\epsilon=0$ 时关于先验扰动的 Gâteaux 导数；其次，利用嵌套采样算法的输出为该导数构建一个蒙特卡洛估计量。\n\n### 第一部分：证据的 Gâteaux 导数\n\n贝叶斯证据 $Z$ 定义为数据 $y$ 的边际似然：\n$$\nZ = \\int_{\\Theta} L(\\theta) \\,\\pi(\\theta)\\,\\mathrm{d}\\theta\n$$\n其中 $L(\\theta)$ 是似然函数，$\\pi(\\theta)$ 是参数空间 $\\Theta$ 上的先验概率密度。\n\n问题引入了一个扰动后的先验密度 $\\pi_{\\epsilon}(\\theta)$，它通过对基准先验 $\\pi(\\theta)$ 进行指数倾斜来定义：\n$$\n\\pi_{\\epsilon}(\\theta) = \\pi(\\theta)\\,\\exp\\!\\big(\\epsilon\\,h(\\theta) - \\kappa(\\epsilon)\\big)\n$$\n此处，$h(\\theta)$ 是一个分数函数，$\\epsilon$ 是一个小的扰动参数，而 $\\kappa(\\epsilon)$ 是 $h(\\theta)$ 在 $\\pi(\\theta)$ 下的累积量生成函数，它充当归一化常数：\n$$\n\\kappa(\\epsilon) = \\ln \\int_{\\Theta} \\pi(\\theta)\\,\\exp\\!\\big(\\epsilon\\,h(\\theta)\\big)\\,\\mathrm{d}\\theta\n$$\n扰动后的证据 $Z(\\epsilon)$ 是用扰动后的先验计算出的证据：\n$$\nZ(\\epsilon) = \\int_{\\Theta} L(\\theta)\\,\\pi_{\\epsilon}(\\theta)\\,\\mathrm{d}\\theta = \\int_{\\Theta} L(\\theta) \\pi(\\theta)\\,\\exp\\!\\big(\\epsilon\\,h(\\theta) - \\kappa(\\epsilon)\\big)\\,\\mathrm{d}\\theta\n$$\n我们可以通过提出不依赖于积分变量 $\\theta$ 的项来重写此式：\n$$\nZ(\\epsilon) = \\exp\\!\\big(-\\kappa(\\epsilon)\\big) \\int_{\\Theta} L(\\theta) \\pi(\\theta)\\,\\exp\\!\\big(\\epsilon\\,h(\\theta)\\big)\\,\\mathrm{d}\\theta\n$$\n$Z(\\epsilon)$ 关于 $\\epsilon$ 的一阶敏感度是其 Gâteaux 导数，我们通过对 $Z(\\epsilon)$ 关于 $\\epsilon$ 求导来得到。假设有足够的正则性可以在积分号下进行微分（莱布尼茨积分法则），我们应用乘法法则：\n$$\n\\frac{\\mathrm{d}Z}{\\mathrm{d}\\epsilon} = \\frac{\\mathrm{d}}{\\mathrm{d}\\epsilon} \\Big( \\exp\\!\\big(-\\kappa(\\epsilon)\\big) \\Big) \\left( \\int_{\\Theta} L(\\theta) \\pi(\\theta)\\,\\exp\\!\\big(\\epsilon\\,h(\\theta)\\big)\\,\\mathrm{d}\\theta \\right) + \\exp\\!\\big(-\\kappa(\\epsilon)\\big) \\frac{\\mathrm{d}}{\\mathrm{d}\\epsilon} \\left( \\int_{\\Theta} L(\\theta) \\pi(\\theta)\\,\\exp\\!\\big(\\epsilon\\,h(\\theta)\\big)\\,\\mathrm{d}\\theta \\right)\n$$\n让我们计算各个部分的导数。\n归一化因子的导数是：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}\\epsilon} \\exp\\!\\big(-\\kappa(\\epsilon)\\big) = -\\kappa'(\\epsilon)\\,\\exp\\!\\big(-\\kappa(\\epsilon)\\big)\n$$\n积分项的导数是：\n$$\n\\frac{\\mathrm{d}}{\\mathrm{d}\\epsilon} \\int_{\\Theta} L(\\theta) \\pi(\\theta)\\,\\exp\\!\\big(\\epsilon\\,h(\\theta)\\big)\\,\\mathrm{d}\\theta = \\int_{\\Theta} L(\\theta) \\pi(\\theta) h(\\theta)\\,\\exp\\!\\big(\\epsilon\\,h(\\theta)\\big)\\,\\mathrm{d}\\theta\n$$\n将这些代回 $\\frac{\\mathrm{d}Z}{\\mathrm{d}\\epsilon}$ 的表达式中：\n$$\n\\frac{\\mathrm{d}Z}{\\mathrm{d}\\epsilon} = -\\kappa'(\\epsilon)\\,\\exp\\!\\big(-\\kappa(\\epsilon)\\big) \\int_{\\Theta} L(\\theta) \\pi(\\theta)\\,\\exp\\!\\big(\\epsilon\\,h(\\theta)\\big)\\,\\mathrm{d}\\theta + \\exp\\!\\big(-\\kappa(\\epsilon)\\big) \\int_{\\Theta} L(\\theta) \\pi(\\theta) h(\\theta)\\,\\exp\\!\\big(\\epsilon\\,h(\\theta)\\big)\\,\\mathrm{d}\\theta\n$$\n我们可以看出第一个积分与 $Z(\\epsilon)$ 相关：\n$$\n\\int_{\\Theta} L(\\theta) \\pi(\\theta)\\,\\exp\\!\\big(\\epsilon\\,h(\\theta)\\big)\\,\\mathrm{d}\\theta = Z(\\epsilon) / \\exp\\!\\big(-\\kappa(\\epsilon)\\big)\n$$\n代入此式可简化第一项：\n$$\n\\frac{\\mathrm{d}Z}{\\mathrm{d}\\epsilon} = -\\kappa'(\\epsilon) Z(\\epsilon) + \\int_{\\Theta} L(\\theta) h(\\theta) \\left( \\pi(\\theta)\\,\\exp\\!\\big(\\epsilon\\,h(\\theta) - \\kappa(\\epsilon)\\big) \\right) \\mathrm{d}\\theta\n$$\n括号中的项就是扰动后的先验 $\\pi_{\\epsilon}(\\theta)$。所以，\n$$\n\\frac{\\mathrm{d}Z}{\\mathrm{d}\\epsilon} = -\\kappa'(\\epsilon) Z(\\epsilon) + \\int_{\\Theta} L(\\theta) h(\\theta) \\pi_{\\epsilon}(\\theta) \\mathrm{d}\\theta\n$$\n题目要求我们求在 $\\epsilon=0$ 处的导数。我们在 $\\epsilon=0$ 处计算该表达式。此时：\n1.  $\\pi_{0}(\\theta) = \\pi(\\theta)\\,\\exp(0 - \\kappa(0))$。因为 $\\kappa(0) = \\ln \\int \\pi(\\theta)\\,\\exp(0)\\,\\mathrm{d}\\theta = \\ln(1) = 0$，我们有 $\\pi_{0}(\\theta) = \\pi(\\theta)$。\n2.  $Z(0) = \\int L(\\theta)\\pi(\\theta)\\mathrm{d}\\theta = Z$。\n3.  问题陈述了 $h$ 在先验下是中心化的，即 $\\int_{\\Theta} h(\\theta)\\,\\pi(\\theta)\\,\\mathrm{d}\\theta = 0$。这意味着 $\\kappa'(0)=0$，这一点也已给出。要证明这一点：$\\kappa'(\\epsilon) = \\frac{\\int \\pi(\\theta)h(\\theta)\\exp(\\epsilon h(\\theta)) d\\theta}{\\int \\pi(\\theta)\\exp(\\epsilon h(\\theta)) d\\theta} = \\mathbb{E}_{\\pi_\\epsilon}[h(\\theta)]$。在 $\\epsilon=0$ 时，$\\kappa'(0) = \\mathbb{E}_{\\pi_0}[h(\\theta)] = \\mathbb{E}_{\\pi}[h(\\theta)] = 0$。\n\n将这些条件代入导数的表达式：\n$$\n\\left. \\frac{\\mathrm{d}Z}{\\mathrm{d}\\epsilon} \\right|_{\\epsilon=0} = -\\kappa'(0) Z(0) + \\int_{\\Theta} L(\\theta) h(\\theta) \\pi_{0}(\\theta) \\mathrm{d}\\theta\n$$\n$$\n\\left. \\frac{\\mathrm{d}Z}{\\mathrm{d}\\epsilon} \\right|_{\\epsilon=0} = -0 \\cdot Z + \\int_{\\Theta} L(\\theta) h(\\theta) \\pi(\\theta) \\mathrm{d}\\theta\n$$\n因此，证据在方向 $h$ 上的一阶敏感度由以下积分给出：\n$$\n\\left. \\frac{\\mathrm{d}Z}{\\mathrm{d}\\epsilon} \\right|_{\\epsilon=0} = \\int_{\\Theta} L(\\theta) h(\\theta) \\pi(\\theta) \\mathrm{d}\\theta\n$$\n\n### 第二部分：嵌套采样估计量\n\n嵌套采样算法为估计形如 $\\int_{\\Theta} g(\\theta)\\,\\pi(\\theta)\\,\\mathrm{d}\\theta$ 的积分提供了一个框架。该算法生成一个由 $m$ 个死点组成的序列 $\\{\\theta_i\\}_{i=1}^m$ 及其相关的似然 $\\{L_i\\}_{i=1}^m$，并按 $L_1 \\leq L_2 \\leq \\cdots \\leq L_m$ 排序。这些点定义了一个嵌套的先验体积序列 $X_i = \\int_{L(\\theta)L_i} \\pi(\\theta)\\,\\mathrm{d}\\theta$，其中 $X_0=1  X_1  \\cdots  X_m$。\n\n该积分被重写为参数空间中不相交壳层上的和。参数空间 $\\Theta$ 被划分为多个壳层 $\\mathcal{C}_i = \\{\\theta \\in \\Theta \\mid L_{i-1}  L(\\theta) \\ge L_i\\}$（对于 $i=1,\\ldots,m$，其中 $L_0 \\equiv \\infty$），外加活点所占的剩余体积。函数 $g(\\theta)$ 在先验上的积分可以写为：\n$$\n\\int_{\\Theta} g(\\theta) \\pi(\\theta) \\mathrm{d}\\theta = \\sum_{i=1}^m \\int_{\\mathcal{C}_i} g(\\theta) \\pi(\\theta) \\mathrm{d}\\theta + \\int_{L(\\theta) \\ge L_m} g(\\theta) \\pi(\\theta) \\mathrm{d}\\theta\n$$\n嵌套采样估计量近似计算每个壳层 $\\mathcal{C}_i$ 上的积分。壳层 $\\mathcal{C}_i$ 的先验质量为 $\\int_{\\mathcal{C}_i} \\pi(\\theta) \\mathrm{d}\\theta = X_{i-1} - X_i$，这恰好是求积权重 $w_i$ 的定义。点 $\\theta_i$（其似然为 $L_i$）被视为壳层 $\\mathcal{C}_i$ 的一个代表性样本。因此，$g(\\theta)$ 在该壳层上的积分近似为：\n$$\n\\int_{\\mathcal{C}_i} g(\\theta) \\pi(\\theta) \\mathrm{d}\\theta \\approx g(\\theta_i) \\int_{\\mathcal{C}_i} \\pi(\\theta) \\mathrm{d}\\theta = g(\\theta_i) w_i\n$$\n对所有与死点对应的壳层求和（并通常忽略最后一组活点的微小贡献），我们得到 $g(\\theta)$ 积分的通用嵌套采样估计量：\n$$\n\\widehat{I}_g = \\sum_{i=1}^m w_i g(\\theta_i)\n$$\n在本例中，我们需要估计敏感度导数，它是函数 $g(\\theta) = L(\\theta)h(\\theta)$ 的积分。\n$$\nS = \\left. \\frac{\\mathrm{d}Z}{\\mathrm{d}\\epsilon} \\right|_{\\epsilon=0} = \\int_{\\Theta} L(\\theta) h(\\theta) \\pi(\\theta) \\mathrm{d}\\theta\n$$\n应用嵌套采样估计公式，并令 $g(\\theta_i) = L(\\theta_i)h(\\theta_i) = L_i h(\\theta_i)$，我们得到 $S$ 的估计量：\n$$\n\\widehat{S} = \\sum_{i=1}^{m} w_i L_i h(\\theta_i)\n$$\n该表达式仅使用了嵌套采样运行中可获得的量：死点 $\\{\\theta_i\\}_{i=1}^m$、它们的似然 $\\{L_i\\}_{i=1}^m$、求积权重 $\\{w_i\\}_{i=1}^m$ 以及分数函数 $h(\\cdot)$。这就是所求的蒙特卡洛估计量。", "answer": "$$\n\\boxed{\\sum_{i=1}^{m} w_{i} L_{i} h(\\theta_{i})}\n$$", "id": "3323423"}]}