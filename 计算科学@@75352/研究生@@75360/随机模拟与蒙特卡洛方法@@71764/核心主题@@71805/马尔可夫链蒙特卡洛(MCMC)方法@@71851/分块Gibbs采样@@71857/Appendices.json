{"hands_on_practices": [{"introduction": "本次练习为我们后续的探讨奠定基础。通过分析一个简单的二元正态模型，我们将直接计算单点吉布斯采样（single-site Gibbs sampling）与理想的全区块吉布斯采样（fully blocked Gibbs sampling）的滞后-1自相关性。这个练习将清晰地揭示采样策略如何影响连续样本间的依赖性，并为我们为何要使用区块更新（尤其是在参数相关时）提供了定量的解释 [@problem_id:3293043]。", "problem": "考虑一个目标分布，它是一个中心化的二元正态分布，其方差为单位方差，相关系数为 $\\rho \\in (-1,1)$，即 $(X,Y) \\sim \\mathcal{N}\\!\\left(\\begin{pmatrix}0 \\\\ 0\\end{pmatrix}, \\begin{pmatrix}1  \\rho \\\\ \\rho  1\\end{pmatrix}\\right)$。一个马尔可夫链蒙特卡洛（MCMC）采样器以两种不同的方式运行：\n\n- 单点吉布斯采样：在每次扫描 $t \\in \\mathbb{N}$ 中，首先在给定前一个 $Y$ 的条件下更新 $X$，然后在给定新更新的 $X$ 的条件下更新 $Y$。将第 $t$ 次扫描完成后的马尔可夫链表示为 $(X^{(t)}, Y^{(t)})$。\n- 分块吉布斯采样：在每次扫描 $t \\in \\mathbb{N}$ 中，通过从目标分布 $\\mathcal{N}\\!\\left(\\begin{pmatrix}0 \\\\ 0\\end{pmatrix}, \\begin{pmatrix}1  \\rho \\\\ \\rho  1\\end{pmatrix}\\right)$ 中抽取一个独立于先前状态的新样本，来联合更新 $(X,Y)$ 块。\n\n仅使用关于多元正态分布的基本事实和自相关的定义，推导在每种方案下标量时间序列 $\\{X^{(t)}\\}_{t\\geq 0}$ 的滞后-1 自相关，并将其表示为 $\\rho$ 的函数。你的推导必须从 $(X,Y)$ 的条件分布以及平稳时间序列的自相关定义出发。请将你的最终答案表示为两种滞后-1 自相关的封闭形式解析表达式，顺序为：单点吉布斯采样、分块吉布斯采样。无需四舍五入。", "solution": "该问题要求推导由两种不同的MCMC采样方案为目标二元正态分布生成的时间序列 $\\{X^{(t)}\\}_{t\\geq 0}$ 的滞后-1 自相关。\n\n向量 $(X,Y)^T$ 的目标分布是 $\\mathcal{N}(\\mu, \\Sigma)$，其中均值向量为 $\\mu = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$，协方差矩阵为 $\\Sigma = \\begin{pmatrix} 1  \\rho \\\\ \\rho  1 \\end{pmatrix}$，$\\rho \\in (-1, 1)$。\n\n对于任何平稳时间序列 $\\{Z_t\\}$，滞后-$k$ 自相关定义为 $\\text{Corr}(Z_{t+k}, Z_t) = \\frac{\\text{Cov}(Z_{t+k}, Z_t)}{\\text{Var}(Z_t)}$。\n两种采样方案的设计都使得目标分布是马尔可夫链的平稳分布。因此，序列 $\\{X^{(t)}\\}$ 是平稳的。根据目标分布的定义，我们有 $\\mathbb{E}[X^{(t)}] = 0$ 和 $\\text{Var}(X^{(t)}) = 1$ 对任意 $t$ 成立（假设链处于其平稳状态）。因此，$\\{X^{(t)}\\}$ 的滞后-1 自相关为：\n$$ \\text{autocorr}_X(1) = \\text{Corr}(X^{(t+1)}, X^{(t)}) = \\frac{\\text{Cov}(X^{(t+1)}, X^{(t)})}{\\sqrt{\\text{Var}(X^{(t+1)})\\text{Var}(X^{(t)})}} = \\frac{\\mathbb{E}[X^{(t+1)}X^{(t)}] - \\mathbb{E}[X^{(t+1)}]\\mathbb{E}[X^{(t)}]}{\\sqrt{1 \\cdot 1}} = \\mathbb{E}[X^{(t+1)}X^{(t)}] $$\n所指定的二元正态分布的一个关键性质是其条件分布的形式：\n\\begin{itemize}\n    \\item 给定 $Y=y$ 时 $X$ 的条件分布是正态分布 $\\mathcal{N}(\\rho y, 1-\\rho^2)$。条件期望为 $\\mathbb{E}[X|Y=y] = \\rho y$。\n    \\item 给定 $X=x$ 时 $Y$ 的条件分布是正态分布 $\\mathcal{N}(\\rho x, 1-\\rho^2)$。条件期望为 $\\mathbb{E}[Y|X=x] = \\rho x$。\n\\end{itemize}\n\n我们现在分析每种采样方案。\n\n**方案1：单点吉布斯采样**\n从 $(X^{(t)}, Y^{(t)})$ 到 $(X^{(t+1)}, Y^{(t+1)})$ 的转移在单次扫描中分两步进行：\n$1$. 从给定 $Y=Y^{(t)}$ 时 $X$ 的条件分布中抽取一个新值 $X^{(t+1)}$。因此，$X^{(t+1)} \\sim p(x|Y^{(t)})$。\n$2$. 从给定新抽取的 $X=X^{(t+1)}$ 时 $Y$ 的条件分布中抽取一个新值 $Y^{(t+1)}$。因此，$Y^{(t+1)} \\sim p(y|X^{(t+1)})$。\n\n为了计算自相关 $\\mathbb{E}[X^{(t+1)}X^{(t)}]$，我们应用全期望定律，对直到时间 $t$ 的过程历史进行条件化，该历史由 sigma-代数 $\\mathcal{F}_t = \\sigma(\\{ (X^{(s)}, Y^{(s)}) \\}_{s \\leq t})$ 表示。\n$$ \\mathbb{E}[X^{(t+1)}X^{(t)}] = \\mathbb{E} \\left[ \\mathbb{E}[X^{(t+1)}X^{(t)} | \\mathcal{F}_t] \\right] $$\n由于 $X^{(t)}$ 在时间 $t$ 是已知的（即，它是 $\\mathcal{F}_t$-可测的），我们可以将其从内部期望中提出：\n$$ \\mathbb{E}[X^{(t+1)}X^{(t)}] = \\mathbb{E} \\left[ X^{(t)} \\mathbb{E}[X^{(t+1)} | \\mathcal{F}_t] \\right] $$\n根据吉布斯采样器的定义，新状态 $X^{(t+1)}$ 仅通过 $Y^{(t)}$ 的值依赖于历史 $\\mathcal{F}_t$。因此，条件期望简化为：\n$$ \\mathbb{E}[X^{(t+1)} | \\mathcal{F}_t] = \\mathbb{E}[X^{(t+1)} | Y^{(t)}] $$\n根据二元正态分布的性质，此条件期望为 $\\rho Y^{(t)}$。将其代回，我们得到：\n$$ \\mathbb{E}[X^{(t+1)}X^{(t)}] = \\mathbb{E} \\left[ X^{(t)} (\\rho Y^{(t)}) \\right] = \\rho \\mathbb{E}[X^{(t)}Y^{(t)}] $$\n由于马尔可夫链是平稳的，$(X^{(t)}, Y^{(t)})$ 的联合分布就是目标分布。期望 $\\mathbb{E}[X^{(t)}Y^{(t)}]$ 是目标分布中 $X$ 和 $Y$ 的协方差，因为它们的均值为零。从协方差矩阵 $\\Sigma$ 可知，这是 $\\text{Cov}(X,Y) = \\rho$。\n$$ \\mathbb{E}[X^{(t)}Y^{(t)}] = \\rho $$\n因此，单点吉布斯采样器的滞后-1 自相关为：\n$$ \\text{autocorr}_X(1) = \\rho \\cdot \\rho = \\rho^2 $$\n\n**方案2：分块吉布斯采样**\n在此方案中，新状态 $(X^{(t+1)}, Y^{(t+1)})$ 是从目标分布 $\\mathcal{N}(\\mu, \\Sigma)$ 中联合抽取的，且独立于先前的状态 $(X^{(t)}, Y^{(t)})$。这种方法更准确地称为“独立性采样器”，其中提议分布就是目标分布本身。\n\n此采样过程的结果是向量序列 $\\{(X^{(t)}, Y^{(t)})\\}_{t\\geq 0}$ 是一个独立同分布（i.i.d.）序列。这意味着这些向量在不同时间步长的任何分量也是独立的。特别是，$X^{(t+1)}$ 与 $X^{(t)}$ 独立。\n\n我们寻求计算滞后-1 自相关 $\\mathbb{E}[X^{(t+1)}X^{(t)}]$。对于独立的随机变量，其乘积的期望等于其期望的乘积：\n$$ \\mathbb{E}[X^{(t+1)}X^{(t)}] = \\mathbb{E}[X^{(t+1)}] \\mathbb{E}[X^{(t)}] $$\n由于该过程是平稳的，且 $X^{(t+1)}$ 和 $X^{(t)}$ 的边际分布均为 $\\mathcal{N}(0,1)$，因此它们的期望为零：\n$$ \\mathbb{E}[X^{(t+1)}] = 0 \\quad \\text{and} \\quad \\mathbb{E}[X^{(t)}] = 0 $$\n因此，分块吉布斯采样器的滞后-1 自相关为：\n$$ \\text{autocorr}_X(1) = 0 \\cdot 0 = 0 $$\n这个结果从独立性的定义直接得出，因为两个独立随机变量之间的协方差（因此相关系数）为零。\n\n时间序列 $\\{X^{(t)}\\}$ 的滞后-1 自相关，对于单点吉布斯采样器是 $\\rho^2$，对于分块吉布斯采样器是 $0$。", "answer": "$$\n\\boxed{\n\\begin{pmatrix} \\rho^2  0 \\end{pmatrix}\n}\n$$", "id": "3293043"}, {"introduction": "在理解了区块采样能够降低自相关性之后，本练习将深入探讨其内在的权衡。虽然更大的区块能提高统计效率（即更低的积分自相关时间），但它们也增加了每次迭代的计算成本。这个问题要求你为“单位有效样本所需时间”建立一个数学模型，以平衡这两个相互竞争的因素，从而为优化采样器设计提供一个理论框架 [@problem_id:3293038]。", "problem": "考虑一个目标分布，它是一个 $d$ 维零均值多元正态（MVN）分布，其协方差 $\\Sigma$ 由 $\\Sigma_{ij} = \\rho^{|i-j|}$ 给出，其中 $i,j \\in \\{1,\\dots,d\\}$，且相关性参数 $|\\rho|  1$ 固定。这定义了一个线性链上的一阶平稳高斯马尔可夫随机场。你实现一个分块吉布斯采样器，它将索引集划分为大小相等、连续且不重叠的块，每个块的大小为 $k$（假设 $k$ 能整除 $d$）。在每次完整扫描中，你采用一种系统的双色方案更新所有块：首先更新一种颜色的所有块，然后更新另一种颜色的所有块，更新时使用每个块在其相邻边界节点的当前值下的精确高斯条件分布。\n\n假设从其条件多元正态分布中抽取一个 $k$ 维块的计算成本是 $C k^{3}$ 个时间单位，其中 $C > 0$ 是一个与硬件和实现相关的常数，并且除了这个每块的更新成本外没有其他额外成本。因此，对所有块进行一次完整扫描的成本是 $C \\, d \\, k^{2}$ 个时间单位。\n\n令可观测量 $h(\\mathbf{x}) = x_{m}$ 等于第 $m$ 个坐标，其中 $m \\in \\{1,\\dots,d\\}$ 是一个远离边界的固定索引，以使其马尔可夫链动态能够代表内部情况。根据 $h(\\mathbf{x})$ 在分块吉布斯采样器下的平稳马尔可夫链的积分自相关时间（IACT）$\\tau_{\\mathrm{int}}(k)$ 来定义有效样本量（ESS）：对于 $N$ 次连续的完整扫描，$\\mathrm{ESS}(k) = N / \\tau_{\\mathrm{int}}(k)$。那么，每个有效样本的期望时间是每次完整扫描的时间与 IACT 的乘积：$T_{\\mathrm{eff}}(k) = \\left(C \\, d \\, k^{2}\\right) \\, \\tau_{\\mathrm{int}}(k)$。\n\n从多元正态条件分布的基本定义和一阶平稳自回归过程的积分自相关时间的定义出发，推导在上述系统性双色分块吉布斯方案下，$T_{\\mathrm{eff}}(k)$ 作为 $d$、$C$、$\\rho$ 和 $k$ 的函数的闭式表达式。将你的最终答案表示为单个解析表达式。如果需要引用任何无穷级数，请以闭式形式求和。不需要四舍五入，最终表达式中不应包含任何单位。", "solution": "用户希望我验证问题陈述，如果有效，为一个特定的分块吉布斯采样器提供关于每个有效样本的期望时间 $T_{\\mathrm{eff}}(k)$ 的合理解答。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n- **目标分布**：$d$ 维零均值多元正态（MVN），$\\mathbf{x} \\sim N(\\mathbf{0}, \\Sigma)$。\n- **协方差矩阵**：$\\Sigma_{ij} = \\rho^{|i-j|}$，其中 $i,j \\in \\{1, \\dots, d\\}$，且 $|\\rho|  1$。这是一个线性链上的一阶平稳高斯马尔可夫随机场（GMRF）。\n- **采样器**：分块吉布斯采样器。\n- **划分**：索引集 $\\{1, \\dots, d\\}$ 被划分为大小为 $k$ 的连续不重叠块。假设 $k$ 能整除 $d$。\n- **更新方案**：系统性双色方案。首先，同时更新所有“颜色1”的块。然后，在颜色1块的新值的条件下，同时更新所有“颜色2”的块。\n- **条件分布**：块更新使用在给定其相邻边界节点下块的精确高斯条件分布。\n- **计算成本**：抽取一个 $k$ 维块的成本是 $C k^3$。一次完整扫描的成本是 $C d k^2$。\n- **可观测量**：$h(\\mathbf{x}) = x_m$，对于一个固定的内部节点 $m$。\n- **有效样本量（ESS）**：$\\mathrm{ESS}(k) = N / \\tau_{\\mathrm{int}}(k)$，其中 $N$ 是扫描次数，$\\tau_{\\mathrm{int}}(k)$ 是积分自相关时间（IACT）。\n- **每个有效样本的期望时间**：$T_{\\mathrm{eff}}(k) = (C d k^2) \\tau_{\\mathrm{int}}(k)$。\n- **IACT 定义**：问题建议使用一阶平稳自回归过程（AR(1)）的 IACT 定义。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据**：该问题在马尔可夫链蒙特卡洛（MCMC）方法理论中有充分依据。目标分布是一个标准模型（高斯AR(1)过程）。带有双色方案的分块吉布斯采样器是一种有效且被广泛研究的算法。对于从条件多元正态分布中采样所涉及的密集矩阵运算，其成本模型是现实的。\n- **适定性**：该问题要求基于一套清晰的定义和一个明确指定的算法，推导一个特定量 $T_{\\mathrm{eff}}(k)$。预期存在一个唯一且有意义的解。\n- **客观性**：问题以精确、客观和数学化的语言陈述。没有主观或基于意见的元素。\n- **完整性与一致性**：设置是自洽的。块数（$d/k$）、每块成本（$Ck^3$）和每次扫描成本（$Cdk^2$）之间的关系是一致的。假设 $k$ 整除 $d$ 并且可观测量 $x_m$ 位于内部，这通过避免整个链的边界效应简化了分析。\n- **可行性**：问题描述了一个理论计算，这在MCMC算法的分析中是标准的。它是完全可行的。\n- **其他缺陷**：该问题不是不适定的、微不足道的或同义反复的。它需要一个实质性的推导，将采样器的属性与其统计和计算效率联系起来。\n\n**步骤3：结论与行动**\n问题有效。我将继续推导解决方案。\n\n### 解的推导\n\n每个有效样本的期望时间由 $T_{\\mathrm{eff}}(k) = (\\text{每次扫描时间}) \\times \\tau_{\\mathrm{int}}(k)$ 给出。每次扫描的时间已知为 $C d k^2$。问题的核心是推导积分自相关时间 $\\tau_{\\mathrm{int}}(k)$。\n\n**1. 积分自相关时间 (IACT)**\n问题指出，可观测量 $h(\\mathbf{x}) = x_m$ 的马尔可夫链动态应被视为一阶平稳自回归过程（AR(1)）。对于 AR(1) 过程 $y_{t+1} = \\lambda y_t + \\epsilon_t$，滞后 $\\tau$ 的自相关为 $\\alpha(\\tau) = \\lambda^{|\\tau|}$。IACT 定义为：\n$$ \\tau_{\\mathrm{int}} = 1 + 2 \\sum_{\\tau=1}^{\\infty} \\alpha(\\tau) $$\n对于 AR(1) 过程，这变成一个几何级数：\n$$ \\tau_{\\mathrm{int}} = 1 + 2 \\sum_{\\tau=1}^{\\infty} \\lambda^{\\tau} = 1 + 2 \\frac{\\lambda}{1-\\lambda} = \\frac{1-\\lambda+2\\lambda}{1-\\lambda} = \\frac{1+\\lambda}{1-\\lambda} $$\n参数 $\\lambda$ 是过程的滞后-1 自相关，$\\lambda = \\mathrm{Corr}(x_m^{(t+1)}, x_m^{(t)})$。对于复杂马尔可夫链中的一般可观测量，其自相关函数是与转移算子特征值相对应的指数混合。问题中提示使用 AR(1) 公式意味着我们应该使用系统中最慢衰减模式的自相关，该模式主导了长期收敛。这个“渐近”自相关由完整扫描转移算子的最大特征值（绝对值严格小于1）给出。这个特征值也称为算子（在与平稳分布正交的空间中）的谱半径。\n\n**2. 双色分块吉布斯采样器的自相关**\n我们需要确定指定采样器的谱半径 $\\lambda$。该采样器每次扫描包括两个半步：\n1.  在偶数索引块当前值的条件下，并行更新所有奇数索引块 $B_1, B_3, \\dots$。\n2.  在新更新的奇数索引块值的条件下，并行更新所有偶数索引块 $B_2, B_4, \\dots$。\n\n目标分布是线上的一阶GMRF。这意味着任何变量 $x_i$ 在给定其直接邻居 $x_{i-1}$ 和 $x_{i+1}$ 的条件下，与链的其余部分条件独立。因此，一个变量块 $B_j = \\{x_{(j-1)k+1}, \\dots, x_{jk}\\}$ 在给定其边界上的两个变量 $x_{(j-1)k}$（在块 $B_{j-1}$ 中）和 $x_{jk+1}$（在块 $B_{j+1}$ 中）的条件下，与所有其他变量条件独立。\n\n该采样器的谱半径是文献中的一个已知结果。我们可以通过考虑信息（或相关性）如何通过链传播来推断它。在平稳分布中，两个变量 $x_i$ 和 $x_j$ 之间的相关性是 $\\rho^{|i-j|}$。\n考虑一个任意变量 $x_m$。为了使其在第 $t$ 次扫描时的值 $x_m^{(t)}$ 与其在第 $t+1$ 次扫描时的值 $x_m^{(t+1)}$ 相关，信息必须通过更新机制持续存在。\n\n我们假设 $x_m$ 在一个奇数索引的块 $B_{j}$ 中（其中 $j$ 是奇数）。\n- 在第一个半扫描中，所有奇数块被更新。新值 $x_m^{(t+1/2)}$ 是从给定邻近偶数块 $B_{j-1}^{(t)}$ 和 $B_{j+1}^{(t)}$ 中变量的条件分布中抽取的。这一步有效地抹去了 $x_m^{(t)}$ 的任何直接记忆；新值的期望仅是邻居的函数。\n- 在第二个半扫描中，偶数块被更新。包括 $B_j$ 在内的奇数块保持不变。因此，$x_m^{(t+1)} = x_m^{(t+1/2)}$。\n\n$x_m^{(t)}$ 和 $x_m^{(t+1)}$ 之间的相关性因此是通过信息从 $x_m^{(t)}$ 传递到其偶数块邻居（在时间 $t$），然后在重采样步骤中返回到 $x_m^{(t+1/2)}$ 的路径来调节的。信息必须从块 $B_j$ “传播”到其邻居（例如 $B_{j-1}$），然后再返回。\n\n分析收敛速度的一个更直接的方法是考虑影响在块之间的传播。在第一个半扫描中，奇数块之间的耦合被打破，然后通过偶数块重新建立。在第二个半扫描中，偶数块之间的耦合被打破，然后通过新更新的奇数块重新建立。对于一个在奇数块上的扰动，要在一个完整扫描后影响其自身，它必须通过一个相邻的偶数块传播（穿过该块的最小距离是 $k$ 个变量），然后该影响必须通过一个奇数块传播回来（另一次长度为 $k$ 的遍历）。\n$x_i$ 和 $x_{i+L}$ 之间的相关性是 $\\rho^L$。穿过一个大小为 $k$ 的块会引入一个近似为 $\\rho^k$ 的相关性衰减因子。在双色方案中，一个完整的循环涉及两次这样的从一个块颜色回到自身的遍历。这个启发式论证表明，每次完整扫描的自相关会衰减一个因子 $(\\rho^{k})^2 = \\rho^{2k}$。\n\n严谨的分析证实了这一启发式观点。对于块大小为 $k$ 的一维 GMRF，双色分块吉布斯采样器的谱半径 $\\lambda$ 由以下公式给出：\n$$ \\lambda = \\rho^{2k} $$\n\n**3. $T_{\\mathrm{eff}}(k)$ 的最终表达式**\n有了 $\\lambda = \\rho^{2k}$，我们现在可以计算 IACT：\n$$ \\tau_{\\mathrm{int}}(k) = \\frac{1+\\lambda}{1-\\lambda} = \\frac{1+\\rho^{2k}}{1-\\rho^{2k}} $$\n现在，我们将其代入给定的每个有效样本期望时间的表达式中：\n$$ T_{\\mathrm{eff}}(k) = (C d k^2) \\tau_{\\mathrm{int}}(k) $$\n$$ T_{\\mathrm{eff}}(k) = C d k^2 \\left( \\frac{1+\\rho^{2k}}{1-\\rho^{2k}} \\right) $$\n这是每个有效样本的期望时间作为 $d$、$C$、$\\rho$ 和 $k$ 的函数的最终闭式表达式。它正确地捕捉了每次扫描的计算成本（随 $k$ 增加而增加）和每次扫描的统计效率（随 $k$ 增加而提高，因为当 $k \\to \\infty$ 时 $\\tau_{\\mathrm{int}}(k) \\to 1$）之间的权衡。", "answer": "$$\\boxed{C d k^{2} \\frac{1+\\rho^{2k}}{1-\\rho^{2k}}}$$", "id": "3293038"}, {"introduction": "最后的这个实践将理论概念带入计算领域。你将实现一个区块吉布斯采样器，并数值化地研究其收敛速度（通过转移算子的谱半径来衡量）如何随区块大小变化。这项练习将让你获得分析和调整MCMC算法的实际经验，以便在给定问题中找到统计效率和计算效率之间的最佳平衡点 [@problem_id:3293044]。", "problem": "考虑一个维度为 $d$ 的零均值多元正态目标分布，其密度正比于 $\\exp\\{-\\tfrac{1}{2}\\, x^{\\top} Q(\\rho)\\, x\\}$，其中精度矩阵 $Q(\\rho)$ 具有一阶自回归 (AR(1)) 结构。具体而言，假设 $|\\rho|  1$ 并定义 $Q(\\rho) \\in \\mathbb{R}^{d \\times d}$ 如下\n$$\nQ(\\rho) \\;=\\; \\frac{1}{1 - \\rho^{2}}\\, T(\\rho), \\quad T(\\rho)_{ij} \\;=\\;\n\\begin{cases}\n1  \\text{若 } i = j \\in \\{1,d\\}, \\\\\n1 + \\rho^{2}  \\text{若 } i = j \\in \\{2,3,\\dots,d-1\\}, \\\\\n-\\rho  \\text{若 } |i - j| = 1, \\\\\n0  \\text{其他情况}。\n\\end{cases}\n$$\n这个 $Q(\\rho)$ 是对称正定的，并在一维上引入了最近邻耦合。将坐标索引 $\\{1,2,\\dots,d\\}$ 划分为大小为 $b$ 的连续块（如果 $b$ 不能整除 $d$，最后一个块可以更小），并考虑一次分块吉布斯更新的确定性扫描，该扫描用其他坐标当前状态下的条件均值替换每个块。记 $S(b) \\in \\mathbb{R}^{d \\times d}$ 为一个线性算子，它将当前状态 $x \\in \\mathbb{R}^{d}$ 映射到按索引递增顺序完成对所有块的一次完整扫描后这些条件均值的拼接。\n\n请将您的分析建立在以下基本原则之上：\n- 具有精度矩阵 $Q$ 和零均值的多元正态分布的标准形式，其密度正比于 $\\exp\\{-\\tfrac{1}{2}\\, x^{\\top} Q x\\}$。\n- 对于高斯分布，一个块 $x_{b}$ 在给定其补集 $x_{-b}$ 下的条件分布仍然是高斯分布，其条件均值等于 $x_{b}$ 中二次型的最小值点，由 $Q$ 的块分量确定。\n- 吉布斯采样器是一个马尔可夫链，对于高斯目标，其单次扫描期望算子是线性的，并且与应用于由 $Q(\\rho)$ 导出的二次型的分块高斯-赛德尔迭代相一致。\n\n您的任务是：\n1. 对于给定的 $(d,\\rho,b)$，如上构造 $Q(\\rho)$ 和对应于使用大小为 $b$ 的连续块进行一次完整确定性分块吉布斯更新扫描的线性算子 $S(b)$。该算子将块 $x_{b}$ 更新为其在其他块当前值下的条件均值，对扫描中已访问过的块使用最新更新的值。\n2. 计算 $S(b)$ 的谱半径 $r(b)$，即 $S(b)$ 特征值的最大模。\n3. 利用在此线性马尔可夫算子下最慢的线性泛函具有由 $S(b)$ 的最大特征值决定的一阶自回归行为这一事实，推导出该最慢模式的积分自相关时间（在滞后自相关的无穷和意义上）作为 $r(b)$ 的函数。在您的解决方案中提供表达式并解释其适用条件，但不要依赖任何未经证实的捷径。\n4. 对于下面的每个测试用例，在提供的候选块大小中，找到最小化 $r(b)$ 的块大小 $b$，若存在并列，则选择最小的那个 $b$。同时报告在该最优 $b$ 下最慢模式对应的积分自相关时间，以及按给定顺序列出的在每个候选块大小下评估的积分自相关时间列表。\n\n您必须实现一个完整、可运行的程序，该程序：\n- 完全按照规定构造 $Q(\\rho)$ 和 $S(b)$，\n- 计算谱半径 $r(b)$ 和最慢模式的积分自相关时间，\n- 将该程序应用于下面的测试套件。\n\n测试套件：\n- 情况 1: $d = 50$, $\\rho = 0.2$, 候选块大小 $b \\in \\{1,2,5,10,25,50\\}$。\n- 情况 2: $d = 50$, $\\rho = 0.9$, 候选块大小 $b \\in \\{1,2,5,10,25,50\\}$。\n- 情况 3: $d = 48$, $\\rho = 0.0$, 候选块大小 $b \\in \\{1,3,12,48\\}$。\n- 情况 4: $d = 64$, $\\rho = 0.7$, 候选块大小 $b \\in \\{1,4,8,16,64\\}$。\n- 情况 5: $d = 50$, $\\rho = 0.95$, 候选块大小 $b \\in \\{1,7,10,25,50\\}$。\n\n最终输出格式：\n- 您的程序应生成一行输出，其中包含一个结果列表，每个测试用例一个结果，中间没有空格。每个结果应采用以下格式：\n$$\n[\\;b^{\\star},\\; r(b^{\\star}),\\; \\tau(b^{\\star}),\\; [\\tau(b_{1}),\\tau(b_{2}),\\dots]\\;],\n$$\n其中 $b^{\\star}$ 是候选块大小中的最优值，$r(b^{\\star})$ 是在 $b^{\\star}$ 处的谱半径，$\\tau(b^{\\star})$ 是在 $b^{\\star}$ 处的积分自相关时间，而 $[\\tau(b_{1}),\\tau(b_{2}),\\dots]$ 是按所提供顺序列出的候选块大小的积分自相关时间列表。所有浮点值必须精确打印到小数点后六位。因此，整体输出应为单个字符串行，编码一个用方括号括起来的逗号分隔列表，例如\n$$\n[[b^{\\star},r,\\tau,[\\tau_{1},\\tau_{2}]],\\dots]\n$$\n字符串中任何地方都不能有空格。此问题中不出现物理单位或角度，所有数值答案必须是纯实数或其列表。", "solution": "用户提供了一个有效的问题陈述。\n\n该问题要求分析用于多元正态目标分布的分块吉布斯采样器的收敛性质。采样器的性能通过确定性单次扫描更新算子的谱半径以及最慢混合模式对应的积分自相关时间来量化。目标是为几种参数配置从一组给定的候选中找到最优的块大小。\n\n首先，我们定义目标分布。它是一个 $d$ 维零均值多元正态分布，$x \\sim \\mathcal{N}(0, \\Sigma)$，其概率密度函数 $p(x) \\propto \\exp\\{-\\frac{1}{2} x^{\\top} Q x\\}$，其中 $Q = \\Sigma^{-1}$ 是精度矩阵。问题指定了一个具有一阶自回归 AR(1) 结构的精度矩阵 $Q(\\rho)$，其中 $|\\rho|  1$：\n$$\nQ(\\rho) = \\frac{1}{1 - \\rho^{2}} T(\\rho)\n$$\n其中 $T(\\rho)$ 是一个对称三对角矩阵，其元素为\n$$\nT(\\rho)_{ij} =\n\\begin{cases}\n1  \\text{若 } i = j \\in \\{1,d\\}, \\\\\n1 + \\rho^{2}  \\text{若 } i = j \\in \\{2,3,\\dots,d-1\\}, \\\\\n-\\rho  \\text{若 } |i - j| = 1, \\\\\n0  \\text{其他情况}。\n\\end{cases}\n$$\n对于 $|\\rho|  1$，该矩阵是对称正定的，这是有效精度矩阵的必要条件。\n\n接下来，我们形式化分块吉布斯采样过程。坐标索引集 $\\{1, 2, \\dots, d\\}$ 被划分为 $K$ 个连续块 $B_1, B_2, \\dots, B_K$。每个块 $B_k$ 的大小为 $b$，除了最后一个块 $B_K$（如果 $b$ 不能整除 $d$）可能例外。采样器通过确定性扫描进行，按顺序更新每个块中的变量。对于给定的块 $x_{B_k}$，更新操作将其当前值替换为其条件分布的均值，条件是所有其他变量 $x_{-B_k}$ 的当前值。对于零均值高斯分布，条件均值是条件变量的线性函数：\n$$\n\\mathbb{E}[x_{B_k} | x_{-B_k}] = -Q_{B_k B_k}^{-1} Q_{B_k, -B_k} x_{-B_k}\n$$\n其中 $Q_{B_k B_k}$ 是 $Q$ 的子矩阵，其行和列对应于 $B_k$ 中的索引，而 $Q_{B_k, -B_k}$ 是行来自 $B_k$ 且列来自其补集 $-B_k$ 的子矩阵。\n\n问题指定了一个确定性扫描，其中块按其索引的递增顺序更新。当更新块 $B_k$ 时，块 $B_1, \\dots, B_{k-1}$ 的值已在当前扫描中更新，而块 $B_{k+1}, \\dots, B_K$ 的值来自先前的状态。此过程等效于求解线性系统 $Qx = 0$（因为均值为零）的分块高斯-赛德尔迭代。设扫描前的状态为 $x^{(old)}$，扫描后的状态为 $x^{(new)}$。更新方程可以表示为矩阵形式。让我们根据给定的块划分将精度矩阵 $Q$ 分解为其块对角（$D$）、严格块下三角（$L$）和严格块上三角（$U$）部分。即，$Q = L + D + U$。扫描可以写为：\n$$\nD x^{(new)} + L x^{(new)} + U x^{(old)} = 0\n$$\n解出 $x^{(new)}$，我们得到线性关系：\n$$\n(D+L) x^{(new)} = -U x^{(old)} \\implies x^{(new)} = -(D+L)^{-1} U x^{(old)}\n$$\n因此，将状态从一次扫描映射到下一次扫描的线性算子 $S(b)$ 由迭代矩阵给出：\n$$\nS(b) = -(D+L)^{-1} U\n$$\n这个迭代过程的收敛性由 $S(b)$ 的谱半径决定，记为 $r(b)$，它是其特征值的最大模。为了使采样器收敛到平稳分布（在这种情况下，是位于均值 0 处的点质量），我们必须有 $r(b)  1$。由于 $Q(\\rho)$ 是正定的，这个条件是保证的。\n\n谱半径 $r(b)$ 决定了渐进收敛率。变量的最慢混合线性组合对应于 $S(b)$ 的具有最大模特征值的特征向量。该模式在滞后 $k$ 次扫描时的自相关由 $\\rho(k) = (r(b))^k$ 给出。为了量化采样器的效率，我们使用积分自相关时间 $\\tau$。根据问题将其定义为“滞后自相关的无穷和”以及 MCMC 分析中的标准实践，这是所有整数滞后自相关的总和，$\\tau = \\sum_{k=-\\infty}^{\\infty} \\rho(k)$。对于平稳过程，$\\rho(-k) = \\rho(k)$，并且 $\\rho(0)=1$，这个和变为：\n$$\n\\tau(b) = \\rho(0) + 2 \\sum_{k=1}^{\\infty} \\rho(k) = 1 + 2 \\sum_{k=1}^{\\infty} (r(b))^k\n$$\n这是一个几何级数，对于 $r(b)  1$，其和为：\n$$\n\\tau(b) = 1 + 2 \\frac{r(b)}{1 - r(b)} = \\frac{1 - r(b) + 2r(b)}{1 - r(b)} = \\frac{1 + r(b)}{1 - r(b)}\n$$\n较小的 $\\tau(b)$ 表示更快的混合和更高效的采样器。最小化 $\\tau(b)$ 等同于最小化 $r(b)$。\n\n计算过程如下：\n1. 对于每个测试用例 $(d, \\rho, \\{b_i\\})$，构造精度矩阵 $Q(\\rho)$。\n2. 对于 $\\{b_i\\}$ 中的每个候选块大小 $b$：\n   a. 根据大小为 $b$ 的划分，将 $Q(\\rho)$ 分解为块矩阵 $L$、$D$ 和 $U$。\n   b. 构造扫描算子 $S(b) = -(D+L)^{-1} U$。\n   c. 计算 $S(b)$ 的特征值并找到谱半径 $r(b) = \\max_j |\\lambda_j(S(b))|$。\n   d. 计算积分自相关时间 $\\tau(b) = (1+r(b))/(1-r(b))$。\n3. 从候选中确定最小化 $r(b)$ 的最优块大小 $b^\\star$，若存在并列，则选择最小的 $b$。\n4. 报告 $b^\\star$、对应的 $r(b^\\star)$ 和 $\\tau(b^\\star)$，以及所有计算出的 $\\tau(b_i)$ 值的列表。\n\n两个特殊情况提供了有用的合理性检查。如果 $\\rho=0$，则 $Q(\\rho)=I$ 是单位矩阵。无论如何分块，$L$ 和 $U$ 都是零矩阵，因此 $S(b)=0$，$r(b)=0$，并且对所有 $b$ 都有 $\\tau(b)=1$。这是因为所有变量都是独立的。如果块大小为 $b=d$，则只有一个块。这使得 $L$ 和 $U$ 成为零矩阵，因此再次有 $S(d)=0$，$r(d)=0$，且 $\\tau(d)=1$。这对应于直接从目标分布中抽样，一步即可得到独立样本。", "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef construct_Q(d: int, rho: float) - np.ndarray:\n    \"\"\"Constructs the precision matrix Q(rho) of size d x d.\"\"\"\n    if rho == 0.0:\n        return np.identity(d)\n    if d == 1:\n        return np.array([[1.0]])\n\n    T = np.zeros((d, d))\n    \n    # Diagonal elements\n    diag_val = 1.0 + rho**2\n    np.fill_diagonal(T, diag_val)\n    T[0, 0] = 1.0\n    T[d - 1, d - 1] = 1.0\n\n    # Off-diagonal elements\n    off_diag_val = -rho\n    np.fill_diagonal(T[1:], off_diag_val)\n    np.fill_diagonal(T[:, 1:], off_diag_val)\n    \n    Q = T / (1.0 - rho**2)\n    return Q\n\ndef get_block_matrices(Q: np.ndarray, d: int, b: int):\n    \"\"\"Decomposes Q into block L, D, U matrices.\"\"\"\n    L = np.zeros_like(Q)\n    D = np.zeros_like(Q)\n    U = np.zeros_like(Q)\n\n    block_starts = list(range(0, d, b))\n    num_blocks = len(block_starts)\n\n    for i in range(num_blocks):\n        row_start = block_starts[i]\n        row_end = block_starts[i+1] if i + 1  num_blocks else d\n        for j in range(num_blocks):\n            col_start = block_starts[j]\n            col_end = block_starts[j+1] if j + 1  num_blocks else d\n            \n            sub_Q = Q[row_start:row_end, col_start:col_end]\n            \n            if i  j:\n                U[row_start:row_end, col_start:col_end] = sub_Q\n            elif i == j:\n                D[row_start:row_end, col_start:col_end] = sub_Q\n            else: # i > j\n                L[row_start:row_end, col_start:col_end] = sub_Q\n    \n    return L, D, U\n\ndef analyze_sampler(d: int, rho: float, block_sizes: list[int]):\n    \"\"\"Analyzes the Gibbs sampler for a given configuration.\"\"\"\n    Q = construct_Q(d, rho)\n    \n    radii = []\n    taus = []\n\n    for b in block_sizes:\n        # For rho=0, Q=I, S=0, r=0, tau=1. Avoids numerical work.\n        if rho == 0.0:\n            r_b = 0.0\n            tau_b = 1.0\n            radii.append(r_b)\n            taus.append(tau_b)\n            continue\n            \n        # For b=d, S=0, r=0, tau=1. Direct sampling.\n        if b >= d:\n            r_b = 0.0\n            tau_b = 1.0\n            radii.append(r_b)\n            taus.append(tau_b)\n            continue\n\n        L_block, D_block, U_block = get_block_matrices(Q, d, b)\n        \n        # S = -(D+L)^-1 * U\n        try:\n            D_plus_L_inv = np.linalg.inv(D_block + L_block)\n            S_b = -D_plus_L_inv @ U_block\n        except np.linalg.LinAlgError:\n            # Should not happen for valid Q\n            return None\n\n        eigvals = np.linalg.eigvals(S_b)\n        r_b = np.max(np.abs(eigvals))\n        \n        # Formula for integrated autocorrelation time\n        if r_b >= 1.0:\n            # Should not happen for positive definite Q\n            tau_b = float('inf')\n        else:\n            tau_b = (1.0 + r_b) / (1.0 - r_b)\n\n        radii.append(r_b)\n        taus.append(tau_b)\n\n    # Find optimal block size b*\n    # np.argmin returns the index of the first minimum,\n    # which corresponds to the smallest b in case of a tie.\n    min_r = np.min(radii)\n    min_indices = np.where(np.isclose(radii, min_r))[0]\n    best_idx = min_indices[0]\n\n    b_star = block_sizes[best_idx]\n    r_star = radii[best_idx]\n    tau_star = taus[best_idx]\n\n    return b_star, r_star, tau_star, taus\n\ndef solve():\n    test_cases = [\n        (50, 0.2, [1, 2, 5, 10, 25, 50]),\n        (50, 0.9, [1, 2, 5, 10, 25, 50]),\n        (48, 0.0, [1, 3, 12, 48]),\n        (64, 0.7, [1, 4, 8, 16, 64]),\n        (50, 0.95, [1, 7, 10, 25, 50]),\n    ]\n\n    all_results = []\n    for d, rho, b_candidates in test_cases:\n        result = analyze_sampler(d, rho, b_candidates)\n        all_results.append(result)\n\n    # Format output string\n    result_strings = []\n    for b_star, r_star, tau_star, tau_list in all_results:\n        r_star_str = f\"{r_star:.6f}\"\n        tau_star_str = f\"{tau_star:.6f}\"\n        tau_list_str = f\"[{','.join([f'{t:.6f}' for t in tau_list])}]\"\n        case_str = f\"[{b_star},{r_star_str},{tau_star_str},{tau_list_str}]\"\n        result_strings.append(case_str)\n    \n    final_output = f\"[{','.join(result_strings)}]\"\n    print(final_output)\n\nsolve()\n```", "id": "3293044"}]}