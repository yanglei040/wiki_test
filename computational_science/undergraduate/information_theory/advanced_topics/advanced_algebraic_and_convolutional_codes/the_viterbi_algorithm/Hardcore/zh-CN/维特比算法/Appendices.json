{
    "hands_on_practices": [
        {
            "introduction": "要真正掌握维特비算法，最好的方法莫过于亲手进行一次计算。这个练习将带你逐步完成算法的核心部分——前向传播过程。我们将为一个假设的隐马尔可夫模型计算路径概率 $\\delta_t(j)$ 和回溯指针 $\\psi_t(j)$，从而构建出算法赖以决策的“篱笆网络”(trellis)。通过这个实践，你将能深刻理解算法是如何在每一步中，基于当前观测值和前一步的最优结果，来动态地寻找最优解的 。",
            "id": "1664342",
            "problem": "一个监测大气颗粒物的系统被建模为隐马尔可夫模型 (HMM)。该系统可以处于三个隐状态之一，$S_1, S_2, S_3$，分别对应低、中、高污染水平。在每个时间步，系统会转移到一个新状态（或停留在同一状态）并发出一个观测，观测可以是“晴朗”(C) 或“雾霾”(H)。\n\n该HMM的参数如下：\n\n1.  **初始状态概率** ($\\pi$): 时间 $t=1$ 时状态的概率分布。\n    $$ \\pi = P(q_1=S_i) = \\begin{pmatrix} 0.7  0.2  0.1 \\end{pmatrix} $$\n    其中 $\\pi_i$ 是从状态 $S_i$ 开始的概率。\n\n2.  **状态转移概率** ($A$): 从状态 $S_i$ 转移到状态 $S_j$ 的概率。\n    $$ A = \\{a_{ij}\\} = P(q_t=S_j | q_{t-1}=S_i) = \\begin{pmatrix} 0.6  0.3  0.1 \\\\ 0.2  0.5  0.3 \\\\ 0.1  0.2  0.7 \\end{pmatrix} $$\n\n3.  **观测发射概率** ($B$): 在给定当前状态下，观测到特定发射的概率。\n    $$ b_j(O_k) = P(O_k | q_t=S_j) $$\n    其值由下式给出：\n    -   在状态 $S_1$ 中：$P(\\text{C} | S_1) = 0.8$, $P(\\text{H} | S_1) = 0.2$\n    -   在状态 $S_2$ 中：$P(\\text{C} | S_2) = 0.5$, $P(\\text{H} | S_2) = 0.5$\n    -   在状态 $S_3$ 中：$P(\\text{C} | S_3) = 0.1$, $P(\\text{H} | S_3) = 0.9$\n\n记录了一个包含三个观测的序列：$O = (\\text{C}, \\text{H}, \\text{H})$。\n\n为了找到产生这些观测的最可能隐状态序列，需要计算维特比路径变量。令 $\\delta_t(j)$ 为在给定前 $t$ 个观测的情况下，在时间 $t$ 结束于状态 $S_j$ 的任何单条路径的最大概率。令 $\\psi_t(j)$ 为在时间 $t-1$ 时，作为这条最可能路径一部分的状态。\n\n您的任务是计算所有状态 $j \\in \\{1, 2, 3\\}$ 的 $\\delta_3(j)$ 和 $\\psi_3(j)$ 的值。状态由1、2、3索引。回溯指针 $\\psi_t(j)$ 也应由这些状态索引表示。\n\n请以一个包含六个条目的单行矩阵形式呈现您的答案，格式为 $(\\delta_3(1), \\delta_3(2), \\delta_3(3), \\psi_3(1), \\psi_3(2), \\psi_3(3))$。将 $\\delta_3(j)$ 的值四舍五入到四位有效数字。",
            "solution": "我们使用维特比递归算法。对于观测序列 $O=(\\text{C},\\text{H},\\text{H})$，定义 $\\delta_{t}(j)=\\max_{q_{1:t-1}}P(q_{1:t-1},q_{t}=S_{j},O_{1:t})$ 和 $\\psi_{t}(j)=\\arg\\max_{i}\\{\\delta_{t-1}(i)a_{ij}\\}$。递推公式为：\n$$\n\\delta_{1}(j)=\\pi_{j}b_{j}(O_{1}),\\quad \\psi_{1}(j)\\text{ 未定义},\n$$\n$$\n\\delta_{t}(j)=\\left[\\max_{i}\\delta_{t-1}(i)a_{ij}\\right]b_{j}(O_{t}),\\quad \\psi_{t}(j)=\\arg\\max_{i}\\{\\delta_{t-1}(i)a_{ij}\\}.\n$$\n\n在 $t=1$ 时的初始化，观测为 $O_{1}=\\text{C}$：\n$$\n\\delta_{1}(1)=0.7\\cdot 0.8=0.56,\\quad \\delta_{1}(2)=0.2\\cdot 0.5=0.1,\\quad \\delta_{1}(3)=0.1\\cdot 0.1=0.01.\n$$\n\n递推到 $t=2$，观测为 $O_{2}=\\text{H}$：\n- 对于 $j=1$：\n$$\n\\max_{i}\\{\\delta_{1}(i)a_{i1}\\}=\\max\\{0.56\\cdot 0.6,\\,0.1\\cdot 0.2,\\,0.01\\cdot 0.1\\}=0.336,\n$$\n$$\n\\delta_{2}(1)=0.336\\cdot 0.2=0.0672,\\quad \\psi_{2}(1)=1.\n$$\n- 对于 $j=2$：\n$$\n\\max_{i}\\{\\delta_{1}(i)a_{i2}\\}=\\max\\{0.56\\cdot 0.3,\\,0.1\\cdot 0.5,\\,0.01\\cdot 0.2\\}=0.168,\n$$\n$$\n\\delta_{2}(2)=0.168\\cdot 0.5=0.084,\\quad \\psi_{2}(2)=1.\n$$\n- 对于 $j=3$：\n$$\n\\max_{i}\\{\\delta_{1}(i)a_{i3}\\}=\\max\\{0.56\\cdot 0.1,\\,0.1\\cdot 0.3,\\,0.01\\cdot 0.7\\}=0.056,\n$$\n$$\n\\delta_{2}(3)=0.056\\cdot 0.9=0.0504,\\quad \\psi_{2}(3)=1.\n$$\n\n递推到 $t=3$，观测为 $O_{3}=\\text{H}$：\n- 对于 $j=1$：\n$$\n\\max_{i}\\{\\delta_{2}(i)a_{i1}\\}=\\max\\{0.0672\\cdot 0.6,\\,0.084\\cdot 0.2,\\,0.0504\\cdot 0.1\\}=0.04032,\n$$\n$$\n\\delta_{3}(1)=0.04032\\cdot 0.2=0.008064,\\quad \\psi_{3}(1)=1.\n$$\n- 对于 $j=2$：\n$$\n\\max_{i}\\{\\delta_{2}(i)a_{i2}\\}=\\max\\{0.0672\\cdot 0.3,\\,0.084\\cdot 0.5,\\,0.0504\\cdot 0.2\\}=0.042,\n$$\n$$\n\\delta_{3}(2)=0.042\\cdot 0.5=0.021,\\quad \\psi_{3}(2)=2.\n$$\n- 对于 $j=3$：\n$$\n\\max_{i}\\{\\delta_{2}(i)a_{i3}\\}=\\max\\{0.0672\\cdot 0.1,\\,0.084\\cdot 0.3,\\,0.0504\\cdot 0.7\\}=0.03528,\n$$\n$$\n\\delta_{3}(3)=0.03528\\cdot 0.9=0.031752,\\quad \\psi_{3}(3)=3.\n$$\n\n将 $\\delta_{3}(j)$ 四舍五入到四位有效数字，得到：\n$$\n\\delta_{3}(1)=0.008064,\\quad \\delta_{3}(2)=0.02100,\\quad \\delta_{3}(3)=0.03175.\n$$\n\n因此，所要求的行矩阵为 $(\\delta_{3}(1),\\delta_{3}(2),\\delta_{3}(3),\\psi_{3}(1),\\psi_{3}(2),\\psi_{3}(3))$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 0.008064  0.02100  0.03175  1  2  3 \\end{pmatrix}}$$"
        },
        {
            "introduction": "在前一个练习中，我们通过前向传播计算了所有可能路径的概率。现在，是时候揭晓最终的答案了。这个练习专注于维特比算法的第二阶段——回溯。假设前向过程已经完成，我们已经拥有了一个完整的回溯指针矩阵 $\\psi$，本练习将向你展示如何利用这个矩阵，从已知的最优终点状态开始，一步步反向追踪，最终重建出完整的、概率最大的隐藏状态序列 。",
            "id": "863125",
            "problem": "在隐马尔可夫模型 (HMM) 的背景下，维特比算法是一种动态规划算法，用于寻找最有可能的隐藏状态序列，即维特比路径，该路径产生一个观测事件序列。\n\n考虑一个 HMM，其具有 $K=4$ 个隐藏状态，由集合 $\\{1, 2, 3, 4\\}$ 索引，以及一个长度为 $T=6$ 的观测序列。维特比算法的前向传播过程已经完成。此过程计算了一个反向指针矩阵（以及其他信息），我们在此用元素 $\\psi_t(j)$ 表示，其中时间步长为 $t \\in \\{2, ..., T\\}$，状态为 $j \\in \\{1, ..., K\\}$。$\\psi_t(j)$ 的值是在时间 $t-1$ 时，处于通往时间 $t$ 状态 $j$ 的最可能路径上的状态的索引。\n\n计算出的反向指针值如下表所示：\n\n| 当前状态 ($j$) | $\\psi_2(j)$ | $\\psi_3(j)$ | $\\psi_4(j)$ | $\\psi_5(j)$ | $\\psi_6(j)$ |\n|:---:|:---:|:---:|:---:|:---:|:---:|\n| 1 | 1 | 3 | 4 | 1 | 2 |\n| 2 | 1 | 1 | 2 | 3 | 4 |\n| 3 | 2 | 2 | 1 | 3 | 3 |\n| 4 | 3 | 2 | 3 | 4 | 4 |\n\n此外，算法确定在最后一个时间步长 $T=6$ 时，最可能的隐藏状态是状态 3。令 $Q^* = (q^*_1, q^*_2, q^*_3, q^*_4, q^*_5, q^*_6)$ 为最可能的隐藏状态序列。我们已知 $q^*_6 = 3$。\n\n使用提供的反向指针表和最终状态，执行维特比算法的回溯步骤，以确定初始时间步长 $t=1$ 时最可能隐藏状态的索引。求出 $q^*_1$ 的值。",
            "solution": "我们使用维特比路径的回溯递推公式：\n$$\nq^*_t = \\psi_{t+1}\\bigl(q^*_{t+1}\\bigr).\n$$\n已知 $q^*_6=3$，向后计算：\n$$\nq^*_5 = \\psi_6(3) = 3,\n$$\n$$\nq^*_4 = \\psi_5(3) = 3,\n$$\n$$\nq^*_3 = \\psi_4(3) = 1,\n$$\n$$\nq^*_2 = \\psi_3(1) = 3,\n$$\n$$\nq^*_1 = \\psi_2(3) = 2.\n$$\n因此，\n$$\nq^*_1 = 2.\n$$",
            "answer": "$$\\boxed{2}$$"
        },
        {
            "introduction": "维特比算法的标准用途是寻找“最”可能的隐藏状态序列，但这并非其能力的全部。这项挑战性的实践将引导我们思考如何对算法进行巧妙的改造，以解决一个截然相反的问题：找出“最不”可能的状态序列。通过对概率进行一次聪明的数学变换，我们可以将一个最小化问题转化为一个最大化问题，从而利用标准的维特比算法框架来求解。这个练习不仅能加深你对算法本质的理解，更能展示动态规划思想的强大灵活性与普适性 。",
            "id": "1664317",
            "problem": "在网络安全领域，隐马尔可夫模型（HMM）常用于对系统的“正常”行为进行建模，例如服务器的 CPU 负载状态序列。异常检测因此可以被描述为识别在该正常行为模型下极不可能出现的操作序列。你的任务是开发一种方法，用于寻找能够生成给定观测序列的*概率最小*的隐藏状态序列。\n\n考虑一个由一组隐藏状态 $S = \\{S_1, S_2\\}$、一组观测符号 $O = \\{O_1, O_2, O_3\\}$ 和以下参数定义的 HMM：\n\n1.  **初始状态概率 ($\\pi$):** 系统以特定状态开始的概率。\n    $P(x_1 = S_1) = 0.6$\n    $P(x_1 = S_2) = 0.4$\n\n2.  **状态转移概率矩阵 ($A$):** 从状态 $S_i$ 转移到状态 $S_j$ 的概率，记作 $P(x_t = S_j | x_{t-1} = S_i)$。\n    $$\n    A = \\begin{pmatrix} 0.7  0.3 \\\\ 0.5  0.5 \\end{pmatrix}\n    $$\n    其中 $A_{ij}$ 是从状态 $S_i$ 转移到状态 $S_j$ 的概率。\n\n3.  **观测发射概率矩阵 ($B$):** 在系统处于状态 $S_j$ 的条件下，观测到符号 $O_k$ 的概率，记作 $P(y_t = O_k | x_t = S_j)$。\n    $$\n    B = \\begin{pmatrix} 0.2  0.5  0.3 \\\\ 0.6  0.1  0.3 \\end{pmatrix}\n    $$\n    其中 $B_{jk}$ 是从状态 $S_j$ 观测到 $O_k$ 的概率。\n\n给定观测序列 $Y = (O_1, O_3, O_2)$，找出隐藏状态序列 $X = (x_1, x_2, x_3)$，使得联合概率 $P(X, Y)$ 最小。你必须使用基于动态规划的系统性方法；不允许通过暴力枚举所有可能路径来求解。将你的答案表示为一个状态索引序列，其中 $S_1$ 对应索引 1，$S_2$ 对应索引 2。",
            "solution": "问题要求找到一个隐藏状态序列 $X = (x_1, x_2, x_3)$，以最小化给定观测序列 $Y = (y_1, y_2, y_3)$ 的联合概率 $P(X, Y)$。标准的 Viterbi 算法旨在找到*最大化*此概率的序列 $X$。然而，我们可以通过执行一个转换来调整问题，以便使用标准的 Viterbi 算法。\n\n状态序列 $X=(x_1, \\dots, x_T)$ 和观测序列 $Y=(y_1, \\dots, y_T)$ 的联合概率由下式给出：\n$$P(X, Y) = \\pi_{x_1} B_{x_1}(y_1) \\prod_{t=2}^{T} A_{x_{t-1}, x_t} B_{x_t}(y_t)$$\n其中 $\\pi_{x_1}$ 是状态 $x_1$ 的初始概率，$A_{ij}$ 是从状态 $i$到状态 $j$ 的转移概率，而 $B_j(y_t)$ 是从状态 $j$ 发射观测值 $y_t$ 的概率。\n\n我们想要找到 $\\arg\\min_{X} P(X, Y)$。由于所有概率均为正数，最小化 $P(X, Y)$ 等价于最大化其倒数 $1/P(X, Y)$。\n$$ \\frac{1}{P(X, Y)} = \\frac{1}{\\pi_{x_1} B_{x_1}(y_1) \\prod_{t=2}^{T} A_{x_{t-1}, x_t} B_{x_t}(y_t)} = \\left(\\frac{1}{\\pi_{x_1}}\\right) \\left(\\frac{1}{B_{x_1}(y_1)}\\right) \\prod_{t=2}^{T} \\left(\\frac{1}{A_{x_{t-1}, x_t}}\\right) \\left(\\frac{1}{B_{x_t}(y_t)}\\right) $$\n这个表达式与原始概率具有相同的乘法结构。因此，我们可以定义一组新的“伪概率”（或代价），它们是原始概率的倒数：\n-   初始代价：$\\pi'_i = 1/\\pi_i$\n-   转移代价：$A'_{ij} = 1/A_{ij}$\n-   发射代价：$B'_{j}(k) = 1/B_{j}(k)$\n\n现在，问题转化为找到一个状态序列 $X$，该序列*最大化*这些代价的乘积。这是一个可以使用这些新代价值并直接通过 Viterbi 算法解决的问题。\n\n让我们为我们的“逆”问题定义参数：\n-   状态：$S_1, S_2$\n-   观测序列：$Y = (O_1, O_3, O_2)$\n-   初始代价：$\\pi' = [1/0.6, 1/0.4] \\approx [1.667, 2.5]$\n-   转移代价：$A' = \\begin{pmatrix} 1/0.7  1/0.3 \\\\ 1/0.5  1/0.5 \\end{pmatrix} \\approx \\begin{pmatrix} 1.429  3.333 \\\\ 2.0  2.0 \\end{pmatrix}$\n-   给定序列 $Y=(O_1, O_3, O_2)$ 的发射代价 $B'$：\n    -   $t=1 (O_1)$: $B'_{S_1}(O_1) = 1/0.2 = 5$, $B'_{S_2}(O_1) = 1/0.6 \\approx 1.667$\n    -   $t=2 (O_3)$: $B'_{S_1}(O_3) = 1/0.3 \\approx 3.333$, $B'_{S_2}(O_3) = 1/0.3 \\approx 3.333$\n    -   $t=3 (O_2)$: $B'_{S_1}(O_2) = 1/0.5 = 2$, $B'_{S_2}(O_2) = 1/0.1 = 10$\n\n我们现在应用 Viterbi 算法。令 $\\delta_t(i)$ 为在时间 $t$ 结束于状态 $S_i$ 的任何路径的最大代价，令 $\\psi_t(i)$ 为该路径上指向前一个状态的回溯指针。\n\n**步骤 1：初始化 (t=1)**\n观测值为 $y_1 = O_1$。\n$\\delta_1(S_1) = \\pi'_{S_1} \\times B'_{S_1}(O_1) = \\frac{1}{0.6} \\times \\frac{1}{0.2} = \\frac{1}{0.12} \\approx 8.333$\n$\\delta_1(S_2) = \\pi'_{S_2} \\times B'_{S_2}(O_1) = \\frac{1}{0.4} \\times \\frac{1}{0.6} = \\frac{1}{0.24} \\approx 4.167$\n$\\psi_1(S_1) = \\text{null}$, $\\psi_1(S_2) = \\text{null}$\n\n**步骤 2：递归 (t=2)**\n观测值为 $y_2 = O_3$。\n对于状态 $S_1$:\n$\\delta_2(S_1) = \\max \\left( \\delta_1(S_1) \\times A'_{S_1,S_1}, \\delta_1(S_2) \\times A'_{S_2,S_1} \\right) \\times B'_{S_1}(O_3)$\n$\\delta_2(S_1) = \\max \\left( \\frac{1}{0.12} \\times \\frac{1}{0.7}, \\frac{1}{0.24} \\times \\frac{1}{0.5} \\right) \\times \\frac{1}{0.3} = \\max \\left( \\frac{1}{0.084}, \\frac{1}{0.12} \\right) \\times \\frac{1}{0.3}$\n$\\delta_2(S_1) = \\max(11.905, 8.333) \\times 3.333 = 11.905 \\times 3.333 = \\frac{1}{0.084 \\times 0.3} = \\frac{1}{0.0252} \\approx 39.683$\n最大值来自状态 $S_1$，因此 $\\psi_2(S_1) = S_1$。\n\n对于状态 $S_2$:\n$\\delta_2(S_2) = \\max \\left( \\delta_1(S_1) \\times A'_{S_1,S_2}, \\delta_1(S_2) \\times A'_{S_2,S_2} \\right) \\times B'_{S_2}(O_3)$\n$\\delta_2(S_2) = \\max \\left( \\frac{1}{0.12} \\times \\frac{1}{0.3}, \\frac{1}{0.24} \\times \\frac{1}{0.5} \\right) \\times \\frac{1}{0.3} = \\max \\left( \\frac{1}{0.036}, \\frac{1}{0.12} \\right) \\times \\frac{1}{0.3}$\n$\\delta_2(S_2) = \\max(27.778, 8.333) \\times 3.333 = 27.778 \\times 3.333 = \\frac{1}{0.036 \\times 0.3} = \\frac{1}{0.0108} \\approx 92.593$\n最大值来自状态 $S_1$，因此 $\\psi_2(S_2) = S_1$。\n\n**步骤 3：递归 (t=3)**\n观测值为 $y_3 = O_2$。\n对于状态 $S_1$:\n$\\delta_3(S_1) = \\max \\left( \\delta_2(S_1) \\times A'_{S_1,S_1}, \\delta_2(S_2) \\times A'_{S_2,S_1} \\right) \\times B'_{S_1}(O_2)$\n$\\delta_3(S_1) = \\max \\left( \\frac{1}{0.0252} \\times \\frac{1}{0.7}, \\frac{1}{0.0108} \\times \\frac{1}{0.5} \\right) \\times \\frac{1}{0.5} = \\max \\left( \\frac{1}{0.01764}, \\frac{1}{0.0054} \\right) \\times 2$\n$\\delta_3(S_1) = \\max(56.69, 185.185) \\times 2 = 185.185 \\times 2 = \\frac{1}{0.0054 \\times 0.5} = \\frac{1}{0.0027} \\approx 370.37$\n最大值来自状态 $S_2$，因此 $\\psi_3(S_1) = S_2$。\n\n对于状态 $S_2$:\n$\\delta_3(S_2) = \\max \\left( \\delta_2(S_1) \\times A'_{S_1,S_2}, \\delta_2(S_2) \\times A'_{S_2,S_2} \\right) \\times B'_{S_2}(O_2)$\n$\\delta_3(S_2) = \\max \\left( \\frac{1}{0.0252} \\times \\frac{1}{0.3}, \\frac{1}{0.0108} \\times \\frac{1}{0.5} \\right) \\times \\frac{1}{0.1} = \\max \\left( \\frac{1}{0.00756}, \\frac{1}{0.0054} \\right) \\times 10$\n$\\delta_3(S_2) = \\max(132.275, 185.185) \\times 10 = 185.185 \\times 10 = \\frac{1}{0.0054 \\times 0.1} = \\frac{1}{0.00054} \\approx 1851.85$\n最大值来自状态 $S_2$，因此 $\\psi_3(S_2) = S_2$。\n\n**步骤 4：终止与回溯**\n最高的最终代价是 $\\delta_3(S_2) \\approx 1851.85$。\n因此，最不可能路径的最终状态是 $x_3 = S_2$。\n\n我们现在进行回溯以找到完整路径：\n-   $x_3 = S_2$\n-   $x_2 = \\psi_3(x_3) = \\psi_3(S_2) = S_2$\n-   $x_1 = \\psi_2(x_2) = \\psi_2(S_2) = S_1$\n\n最不可能的状态序列是 $(S_1, S_2, S_2)$。\n用状态索引表示（其中 $S_1=1, S_2=2$），该序列是 $(1, 2, 2)$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 1  2  2 \\end{pmatrix}}$$"
        }
    ]
}