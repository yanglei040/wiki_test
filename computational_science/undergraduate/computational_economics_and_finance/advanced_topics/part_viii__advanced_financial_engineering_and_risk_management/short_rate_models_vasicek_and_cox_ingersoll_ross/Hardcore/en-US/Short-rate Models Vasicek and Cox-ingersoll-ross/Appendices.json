{
    "hands_on_practices": [
        {
            "introduction": "To begin, let's explore the versatility of the Vasicek model beyond its typical financial applications. This problem demonstrates that any process exhibiting mean-reversion—a tendency to drift back towards a long-term average—can be described by this framework. By modeling a hypothetical political approval rating, you will practice calculating the probability of future events, a fundamental skill that hinges on understanding the model's core properties, such as its Gaussian nature and time-dependent variance .",
            "id": "2429522",
            "problem": "A political leader’s approval rating is modeled in continuous time as a Vasicek process, that is, an Ornstein–Uhlenbeck diffusion on the unit interval treated as real-valued for modeling purposes. Let the approval rating process be denoted by $A_t$, satisfying the stochastic differential equation\n$$\n\\mathrm{d}A_t = \\kappa \\left(\\theta - A_t\\right)\\mathrm{d}t + \\sigma \\mathrm{d}W_t,\n$$\nwhere $\\kappa0$ is the mean-reversion speed, $\\theta \\in \\mathbb{R}$ is the long-run level, $\\sigma0$ is the volatility parameter, and $(W_t)_{t\\ge 0}$ is a standard Brownian motion. Suppose the initial approval is exactly at the long-run level, so $A_0=\\theta$. Polls are conducted only twice before the election: at time $t=\\tau$ and at the election date $t=T$. The polling schedule is fixed by $\\kappa \\tau = \\tfrac{1}{2}\\ln 3$ and $T=2\\tau$. A policy analyst defines a critical approval threshold equal to the long-run level, $L=\\theta$, and is interested in the probability that the approval rating falls below $L$ at least once at the two polling dates before or on the election day.\n\nUnder this model and polling schedule, compute the probability that $A_tL$ for at least one of $t=\\tau$ or $t=T$. Express your final answer as an exact fraction in simplest terms. Do not round your answer. The answer must be a single real number.",
            "solution": "The problem asks for the probability that the approval rating $A_t$ is below the critical threshold $L=\\theta$ at least once at the two polling dates $t=\\tau$ and $t=T$. This probability is formally written as $P(A_\\tau  \\theta \\text{ or } A_T  \\theta)$.\n\nUsing the inclusion-exclusion principle for probabilities, we have:\n$$\nP(A_\\tau  \\theta \\text{ or } A_T  \\theta) = P(A_\\tau  \\theta) + P(A_T  \\theta) - P(A_\\tau  \\theta \\text{ and } A_T  \\theta)\n$$\n\nThe approval rating process $A_t$ follows the Vasicek model, which is an Ornstein-Uhlenbeck process described by the stochastic differential equation:\n$$\n\\mathrm{d}A_t = \\kappa (\\theta - A_t)\\mathrm{d}t + \\sigma \\mathrm{d}W_t\n$$\nwith initial condition $A_0 = \\theta$. The solution to this SDE for $t > s$ given $A_s$ is:\n$$\nA_t = A_s e^{-\\kappa(t-s)} + \\theta(1 - e^{-\\kappa(t-s)}) + \\sigma \\int_s^t e^{-\\kappa(t-u)} \\mathrm{d}W_u\n$$\nFor a fixed time $t$, the random variable $A_t$ conditioned on $A_s$ is normally distributed. Its conditional mean is:\n$$\nE[A_t | A_s] = A_s e^{-\\kappa(t-s)} + \\theta(1 - e^{-\\kappa(t-s)})\n$$\nAnd its conditional variance, using Itô isometry, is:\n$$\nVar(A_t | A_s) = \\sigma^2 \\int_s^t e^{-2\\kappa(t-u)} \\mathrm{d}u = \\frac{\\sigma^2}{2\\kappa}(1 - e^{-2\\kappa(t-s)})\n$$\n\nWith the initial condition $A_0 = \\theta$, the distribution of $A_t$ at any time $t > 0$ is normal.\nThe mean is $E[A_t] = E[A_t | A_0 = \\theta] = \\theta e^{-\\kappa t} + \\theta(1 - e^{-\\kappa t}) = \\theta$.\nThe variance is $Var(A_t) = Var(A_t | A_0 = \\theta) = \\frac{\\sigma^2}{2\\kappa}(1 - e^{-2\\kappa t})$.\n\nFirst, we calculate the individual probabilities $P(A_\\tau  \\theta)$ and $P(A_T  \\theta)$.\nFor $t=\\tau$, $A_\\tau$ is normally distributed with mean $E[A_\\tau] = \\theta$ and variance $Var(A_\\tau) = \\frac{\\sigma^2}{2\\kappa}(1 - e^{-2\\kappa\\tau}) > 0$. Since the normal distribution is symmetric about its mean, the probability of being less than the mean is exactly $\\frac{1}{2}$.\n$$\nP(A_\\tau  \\theta) = \\frac{1}{2}\n$$\nSimilarly, for $t=T$, $A_T$ is normally distributed with mean $E[A_T] = \\theta$. Thus,\n$$\nP(A_T  \\theta) = \\frac{1}{2}\n$$\n\nNext, we must calculate the joint probability $P(A_\\tau  \\theta \\text{ and } A_T  \\theta)$. This requires the joint distribution of $(A_\\tau, A_T)$. Since the process is Gaussian, the vector $(A_\\tau, A_T)$ is bivariate normal with mean vector $(\\theta, \\theta)$ and a covariance matrix we need to determine.\nThe variances are:\n$$\nVar(A_\\tau) = \\frac{\\sigma^2}{2\\kappa}(1 - e^{-2\\kappa\\tau}) \\quad \\text{and} \\quad Var(A_T) = \\frac{\\sigma^2}{2\\kappa}(1 - e^{-2\\kappa T})\n$$\nThe covariance $Cov(A_\\tau, A_T)$ for $\\tau  T$ can be found using the Markov property of the process:\n$$\nCov(A_\\tau, A_T) = Cov(A_\\tau, E[A_T | A_\\tau]) = Cov(A_\\tau, A_\\tau e^{-\\kappa(T-\\tau)} + \\theta(1 - e^{-\\kappa(T-\\tau)}))\n$$\n$$\nCov(A_\\tau, A_T) = e^{-\\kappa(T-\\tau)} Var(A_\\tau)\n$$\nThe correlation coefficient $\\rho$ between $A_\\tau$ and $A_T$ is:\n$$\n\\rho = \\frac{Cov(A_\\tau, A_T)}{\\sqrt{Var(A_\\tau)Var(A_T)}} = \\frac{e^{-\\kappa(T-\\tau)} Var(A_\\tau)}{\\sqrt{Var(A_\\tau)Var(A_T)}} = e^{-\\kappa(T-\\tau)} \\sqrt{\\frac{Var(A_\\tau)}{Var(A_T)}}\n$$\nSubstituting the expressions for the variances (the term $\\frac{\\sigma^2}{2\\kappa}$ cancels):\n$$\n\\rho = e^{-\\kappa(T-\\tau)} \\sqrt{\\frac{1 - e^{-2\\kappa\\tau}}{1 - e^{-2\\kappa T}}}\n$$\nWe are given the polling schedule: $\\kappa \\tau = \\frac{1}{2}\\ln 3$ and $T=2\\tau$.\nFrom $\\kappa \\tau = \\frac{1}{2}\\ln 3 = \\ln \\sqrt{3}$, we have $e^{\\kappa\\tau} = \\sqrt{3}$, so $e^{-\\kappa\\tau} = \\frac{1}{\\sqrt{3}}$.\nThis implies $e^{-2\\kappa\\tau} = (e^{-\\kappa\\tau})^2 = \\frac{1}{3}$.\nSince $T=2\\tau$, we have $\\kappa T = 2\\kappa\\tau = \\ln 3$, so $e^{-\\kappa T} = \\frac{1}{3}$.\nThis implies $e^{-2\\kappa T} = (e^{-\\kappa T})^2 = \\frac{1}{9}$.\nAlso, $T-\\tau = \\tau$, so $e^{-\\kappa(T-\\tau)} = e^{-\\kappa\\tau} = \\frac{1}{\\sqrt{3}}$.\nSubstituting these values into the expression for $\\rho$:\n$$\n\\rho = \\frac{1}{\\sqrt{3}} \\sqrt{\\frac{1 - \\frac{1}{3}}{1 - \\frac{1}{9}}} = \\frac{1}{\\sqrt{3}} \\sqrt{\\frac{\\frac{2}{3}}{\\frac{8}{9}}} = \\frac{1}{\\sqrt{3}} \\sqrt{\\frac{2}{3} \\cdot \\frac{9}{8}} = \\frac{1}{\\sqrt{3}} \\sqrt{\\frac{18}{24}} = \\frac{1}{\\sqrt{3}} \\sqrt{\\frac{3}{4}} = \\frac{1}{\\sqrt{3}} \\frac{\\sqrt{3}}{2} = \\frac{1}{2}\n$$\nNow we compute $P(A_\\tau  \\theta \\text{ and } A_T  \\theta)$. Let $Z_\\tau = \\frac{A_\\tau-\\theta}{\\sqrt{Var(A_\\tau)}}$ and $Z_T = \\frac{A_T-\\theta}{\\sqrt{Var(A_T)}}$. The vector $(Z_\\tau, Z_T)$ follows a standard bivariate normal distribution with correlation $\\rho = \\frac{1}{2}$. The desired probability is $P(Z_\\tau  0 \\text{ and } Z_T  0)$. For a standard bivariate normal distribution, this probability is given by Sheppard's formula:\n$$\nP(Z_\\tau  0, Z_T  0) = \\frac{1}{4} + \\frac{\\arcsin(\\rho)}{2\\pi}\n$$\nSubstituting $\\rho = \\frac{1}{2}$ and using $\\arcsin(\\frac{1}{2}) = \\frac{\\pi}{6}$ radians:\n$$\nP(A_\\tau  \\theta, A_T  \\theta) = \\frac{1}{4} + \\frac{\\frac{\\pi}{6}}{2\\pi} = \\frac{1}{4} + \\frac{1}{12} = \\frac{3}{12} + \\frac{1}{12} = \\frac{4}{12} = \\frac{1}{3}\n$$\nFinally, we substitute all the component probabilities back into the inclusion-exclusion formula:\n$$\nP(A_\\tau  \\theta \\text{ or } A_T  \\theta) = P(A_\\tau  \\theta) + P(A_T  \\theta) - P(A_\\tau  \\theta, A_T  \\theta)\n$$\n$$\nP(A_\\tau  \\theta \\text{ or } A_T  \\theta) = \\frac{1}{2} + \\frac{1}{2} - \\frac{1}{3} = 1 - \\frac{1}{3} = \\frac{2}{3}\n$$\nThe probability that the approval rating falls below the long-run level at least once at the two polling dates is $\\frac{2}{3}$.",
            "answer": "$$\n\\boxed{\\frac{2}{3}}\n$$"
        },
        {
            "introduction": "Having explored the Vasicek model, we now turn to the Cox-Ingersoll-Ross (CIR) model and a more complex pricing challenge: valuing an option on a coupon-bearing bond. This problem introduces Jamshidian's decomposition, an elegant and powerful technique that transforms an option on a portfolio of bonds into a portfolio of options on zero-coupon bonds. This method relies on the monotonic relationship between bond prices and the short rate, a key feature of single-factor models like CIR, and is indispensable for pricing a wide range of interest rate derivatives .",
            "id": "2429604",
            "problem": "Consider a one-factor short-rate model under the risk-neutral measure where the short rate $r_s$ follows the Cox–Ingersoll–Ross (CIR) stochastic differential equation (SDE)\n$$\n\\mathrm{d}r_s = \\kappa(\\theta - r_s)\\,\\mathrm{d}s + \\sigma \\sqrt{r_s}\\,\\mathrm{d}W_s,\n$$\nwith strictly positive parameters $\\kappa$, $\\theta$, and $\\sigma$, and Brownian motion $W_s$. Let the current time be $t=0$ and the current short rate be $r_00$. A default-free zero-coupon bond price for maturity $T$ is denoted $P(0,T)$, and in the CIR model it admits an exponential–affine form\n$$\nP(0,T) = A(0,T)\\exp(-B(0,T)r_0),\n$$\nwhere $A(0,T)$ and $B(0,T)$ are the standard CIR affine coefficients. Likewise, for $T \\leq U$, the time-$T$ price $P(T,U)$ is $A(T,U)\\exp(-B(T,U) r_T)$. Assume all standard technical conditions ensuring absence of arbitrage and integrability hold.\n\nYou are given a European call option written on a default-free coupon-bearing bond that pays deterministic cash flows $\\{c_i\\}_{i=1}^{N}$ at times $\\{T_i\\}_{i=1}^{N}$ with $0TT_1\\cdotsT_N$. The option expires at time $T$ and has strike $K0$. Its time-$T$ payoff is\n$$\n\\left(\\sum_{i=1}^{N} c_i P(T,T_i) - K\\right)^{+}.\n$$\nStarting from the risk-neutral valuation principle and the one-factor structure of the CIR model, and without assuming any option-pricing formula as given, derive an analytic expression for the time-$0$ price of this option by decomposing the coupon bond into a portfolio of zero-coupon bonds. Your derivation should rely on:\n\n- The risk-neutral pricing definition of time-$0$ prices as discounted expectations under the risk-neutral measure.\n- The monotonicity in the one-factor short-rate setting that justifies Jamshidian’s decomposition.\n- The known exponential–affine form of zero-coupon bond prices in the CIR model and the fact that the conditional law of $r_T$ is non-central chi-square, so that expectations of functions of $r_T$ can be expressed via the cumulative distribution function (CDF) of a non-central chi-square random variable.\n\nExpress your final answer as a single closed-form analytic expression in terms of $A(\\cdot,\\cdot)$, $B(\\cdot,\\cdot)$, $\\kappa$, $\\theta$, $\\sigma$, $r_0$, $\\{c_i,T_i\\}_{i=1}^{N}$, $T$, $K$, and the non-central chi-square CDF. Do not evaluate any special functions numerically. No rounding is required. Clearly state any intermediate quantities you introduce, but the final answer must be a single analytic expression.",
            "solution": "The time-$0$ price, $C(0)$, of the European call option is given by the risk-neutral valuation principle. This states that the price is the discounted expectation of the payoff under the risk-neutral measure $Q$.\n$$\nC(0) = E^Q_0 \\left[ \\exp\\left(-\\int_0^T r_s ds\\right) \\left( \\sum_{i=1}^{N} c_i P(T,T_i) - K \\right)^{+} \\right]\n$$\nwhere $E^Q_0[\\cdot]$ denotes the expectation conditional on the information at time $t=0$.\n\nThe price of the underlying coupon-bearing bond at the option's expiration time $T$ is the sum of the prices of the zero-coupon bonds corresponding to each future cash flow:\n$$\nV_B(T) = \\sum_{i=1}^{N} c_i P(T, T_i)\n$$\nIn the CIR model, the price of a zero-coupon bond $P(T, T_i)$ is an exponential-affine function of the short rate $r_T$:\n$$\nP(T, T_i) = A(T, T_i) \\exp(-B(T, T_i) r_T)\n$$\nThe parameters of the CIR model, $\\kappa, \\theta, \\sigma$, are positive. The standard CIR bond pricing functions $A(t,T)$ and $B(t,T)$ are strictly positive for $t  T$. We assume the cash flows $c_i$ are also positive, as is standard for coupon payments.\n\nTo apply Jamshidian's decomposition, we must establish that the price of the coupon bond at time $T$, $V_B(T)$, is a monotonic function of the single state variable, $r_T$. Taking the derivative of $V_B(T)$ with respect to $r_T$:\n$$\n\\frac{\\partial V_B(T)}{\\partial r_T} = \\sum_{i=1}^{N} c_i \\frac{\\partial}{\\partial r_T} \\left[ A(T, T_i) \\exp(-B(T, T_i) r_T) \\right] = \\sum_{i=1}^{N} c_i A(T, T_i) \\exp(-B(T, T_i) r_T) \\left( -B(T, T_i) \\right)\n$$\nSince $c_i > 0$, $A(T,T_i) > 0$, and $B(T,T_i) > 0$, each term in the sum is negative. Therefore, $\\frac{\\partial V_B(T)}{\\partial r_T}  0$, which means $V_B(T)$ is a strictly decreasing function of $r_T$.\n\nBecause of this strict monotonicity, there exists a unique critical value of the short rate, which we denote $r_T^*$, such that the bond price equals the strike price:\n$$\nV_B(r_T^*) = \\sum_{i=1}^{N} c_i A(T, T_i) \\exp(-B(T, T_i) r_T^*) = K\n$$\nThis equation defines $r_T^*$. While an analytical solution for $r_T^*$ is generally not available, its existence is guaranteed. The option is in-the-money if $V_B(T) > K$, which is equivalent to $r_T  r_T^*$. The payoff can thus be written using an indicator function $\\mathbb{I}(\\cdot)$:\n$$\n\\left( V_B(T) - K \\right)^{+} = \\left( \\sum_{i=1}^{N} c_i P(T,T_i) - K \\right) \\mathbb{I}(r_T  r_T^*)\n$$\nSubstituting this into the pricing formula and using the linearity of expectation:\n$$\nC(0) = E^Q_0 \\left[ \\exp\\left(-\\int_0^T r_s ds\\right) \\left( \\sum_{i=1}^{N} c_i P(T,T_i) - K \\right) \\mathbb{I}(r_T  r_T^*) \\right]\n$$\n$$\nC(0) = \\sum_{i=1}^{N} c_i E^Q_0 \\left[ \\exp\\left(-\\int_0^T r_s ds\\right) P(T,T_i) \\mathbb{I}(r_T  r_T^*) \\right] - K E^Q_0 \\left[ \\exp\\left(-\\int_0^T r_s ds\\right) \\mathbb{I}(r_T  r_T^*) \\right]\n$$\nThis decomposes the option on a portfolio into a portfolio of digital-style options. We now analyze each term using a change of numeraire technique.\n\nFor the $i$-th term in the sum, we use the zero-coupon bond $P(t, T_i)$ as the numeraire. The corresponding forward measure is denoted $Q^{T_i}$. The Radon-Nikodym derivative is $\\frac{dQ^{T_i}}{dQ} |_{\\mathcal{F}_t} = \\frac{\\exp(-\\int_0^t r_s ds) P(t, T_i)}{P(0, T_i)}$. The term becomes:\n$$\nc_i E^Q_0 [ \\exp(-\\int_0^T r_s ds) P(T,T_i) \\mathbb{I}(r_T  r_T^*) ] = c_i P(0, T_i) E^{Q^{T_i}}_0 [ \\mathbb{I}(r_T  r_T^*) ] = c_i P(0, T_i) Q^{T_i}(r_T  r_T^*)\n$$\nFor the second part of the expression involving the strike $K$, we use the zero-coupon bond $P(t, T)$ as the numeraire. The corresponding forward measure is $Q^T$. The term becomes:\n$$\nK E^Q_0 [ \\exp(-\\int_0^T r_s ds) \\mathbb{I}(r_T  r_T^*) ] = K P(0, T) E^{Q^T}_0 [ \\mathbb{I}(r_T  r_T^*) ] = K P(0, T) Q^T(r_T  r_T^*)\n$$\nCombining these results, the option price is:\n$$\nC(0) = \\sum_{i=1}^{N} c_i P(0, T_i) Q^{T_i}(r_T  r_T^*) - K P(0, T) Q^T(r_T  r_T^*)\n$$\nThe problem now reduces to computing the probabilities $Q^S(r_T  r_T^*)$ for $S \\in \\{T_1, \\dots, T_N, T\\}$. It is a known result for the CIR model that such probabilities under any forward measure can be expressed in terms of the non-central chi-square CDF.\n\nLet us define a generic function $\\mathbb{P}(t, T, S, z)$ for the time-$t$ conditional probability that $r_T  z$ under the $S$-forward measure $Q^S$:\n$$\n\\mathbb{P}(t, T, S, z) := Q^S(r_T  z | \\mathcal{F}_t)\n$$\nThis probability is given by the CDF of a non-central chi-square distribution. Let $\\chi^2_{\\text{cdf}}(x; d, \\lambda)$ denote this CDF with $x$ as the variable, $d$ degrees of freedom, and $\\lambda$ the non-centrality parameter. We define the following quantities:\n-   $\\gamma = \\sqrt{\\kappa^2 + 2\\sigma^2}$\n-   $d = \\frac{4\\kappa\\theta}{\\sigma^2}$ (degrees of freedom)\n-   $\\phi(t,T) = \\frac{2\\gamma}{\\sigma^2(\\exp(\\gamma(T-t))-1)}$\n-   $\\psi = \\frac{\\kappa+\\gamma}{\\sigma^2}$\n\nWith these definitions, the probability function is given by:\n$$\n\\mathbb{P}(t, T, S, z) = \\chi^2_{\\text{cdf}}\\left( 2z \\left(\\phi(t,T)+\\psi+B(T,S)\\right); d; \\frac{2(\\phi(t,T))^2 r_t \\exp(\\gamma(T-t))}{\\phi(t,T)+\\psi+B(T,S)} \\right)\n$$\nFor our problem, $t=0$. The option price can be written as:\n$$\nC(0) = \\sum_{i=1}^{N} c_i P(0, T_i) \\mathbb{P}(0, T, T_i, r_T^*) - K P(0, T) \\mathbb{P}(0, T, T, r_T^*)\n$$\nNote that for the last term, the numeraire maturity $S$ is equal to the option expiry $T$. In this case, $B(T,T)=0$. The formula remains valid.\n\nThe final expression is constructed by letting:\n-   $\\phi_T = \\frac{2\\gamma}{\\sigma^2(\\exp(\\gamma T)-1)}$\n-   $\\mathbb{P}_i = \\chi^2_{\\text{cdf}}\\left( 2r_T^*(\\phi_T+\\psi+B(T,T_i)); d; \\frac{2\\phi_T^2 r_0 \\exp(\\gamma T)}{\\phi_T+\\psi+B(T,T_i)} \\right)$ for $i=1, \\dots, N$.\n-   $\\mathbb{P}_K = \\chi^2_{\\text{cdf}}\\left( 2r_T^*(\\phi_T+\\psi); d; \\frac{2\\phi_T^2 r_0 \\exp(\\gamma T)}{\\phi_T+\\psi} \\right)$ (since $B(T,T)=0$).\n\nThe option price is $C(0) = \\sum_{i=1}^{N} c_i P(0, T_i) \\mathbb{P}_i - K P(0, T) \\mathbb{P}_K$.",
            "answer": "$$\n\\boxed{\\sum_{i=1}^{N} c_i P(0, T_i) \\chi^2_{\\text{cdf}}\\left( 2r_T^*\\left(\\phi_T+\\psi+B(T,T_i)\\right); d; \\frac{2\\phi_T^2 r_0 \\exp(\\gamma T)}{\\phi_T+\\psi+B(T,T_i)} \\right) - K P(0, T) \\chi^2_{\\text{cdf}}\\left( 2r_T^*\\left(\\phi_T+\\psi\\right); d; \\frac{2\\phi_T^2 r_0 \\exp(\\gamma T)}{\\phi_T+\\psi} \\right)}\n$$"
        },
        {
            "introduction": "A critical task in quantitative finance is ensuring that theoretical models are consistent with observed market prices. This exercise addresses this challenge by showing you how to calibrate an extended Vasicek model, known as the Hull-White model, to perfectly match a given term structure of interest rates. By implementing a numerical solution, you will determine the time-varying market price of risk, $\\lambda(t)$, that bridges the gap between the model's physical dynamics and the risk-neutral world of pricing, a crucial skill for the practical application of any short-rate model .",
            "id": "2429542",
            "problem": "You must write a complete program that, given a time-varying market price of risk, enforces perfect pricing of a specified initial term structure within the Vasicek short-rate framework. The Vasicek model under the physical measure (denoted by the probability measure $\\mathbb{P}$) is given by the stochastic differential equation $dr_t = \\kappa (\\mu - r_t) \\, dt + \\sigma \\, dW_t^{\\mathbb{P}}$, where $\\kappa  0$ is the speed of mean reversion, $\\mu$ is the long-run level under $\\mathbb{P}$, $\\sigma  0$ is the volatility, and $W_t^{\\mathbb{P}}$ is a standard Brownian motion. Assume a deterministic, time-varying market price of risk $\\lambda(t)$ that changes the drift under the risk-neutral measure (denoted by the probability measure $\\mathbb{Q}$) according to $dr_t = [\\kappa (\\mu - r_t) - \\sigma \\lambda(t)] \\, dt + \\sigma \\, dW_t^{\\mathbb{Q}}$, where $W_t^{\\mathbb{Q}}$ is a standard Brownian motion under $\\mathbb{Q}$. The requirement is that the model under $\\mathbb{Q}$ should perfectly price a given initial, non-affine term structure specified by an instantaneous forward rate curve $f(0,T)$.\n\nThe initial instantaneous forward rate curve $f(0,T)$ for maturity $T \\ge 0$ is defined as $f(0,T) = c_0 + c_1 e^{-b T} + c_2 T e^{-b T}$ with parameters $c_0 = 0.02$, $c_1 = 0.01$, $c_2 = 0.005$, and $b = 0.5$. The Vasicek parameters are $\\kappa = 0.7$, $\\mu = 0.03$, and $\\sigma = 0.01$. Time is measured in years, and all rates are annualized and continuously compounded. Your task is to numerically compute the values of the time-varying market price of risk $\\lambda(t)$ that force the model to perfectly price the given initial term structure.\n\nUse the following test suite of evaluation times (in years): $t \\in \\{0.0, 0.25, 1.0, 5.0, 20.0\\}$. For each $t$ in this set, compute the corresponding value of $\\lambda(t)$ as a real number. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, ordered exactly as the times are given. For example: $[x_1,x_2,x_3,x_4,x_5]$. The required outputs are real numbers (floats). No other text should be printed.\n\nAll inputs are fixed as stated above; your program must be self-contained and must not read any input from the user or from external files. The functional form provided for $f(0,T)$ and the parameter values constitute the complete specification required to compute $\\lambda(t)$ at the evaluation times. The final answers must be returned in the specified single-line format.",
            "solution": "The problem requires the determination of a time-varying market price of risk, $\\lambda(t)$, for the Vasicek short-rate model such that it perfectly reproduces a given initial term structure of interest rates. The term structure is specified by an instantaneous forward rate curve, $f(0,T)$.\n\nThe Vasicek model dynamics for the short rate $r_t$ under the risk-neutral measure $\\mathbb{Q}$ are given by the stochastic differential equation (SDE):\n$$dr_t = [\\kappa (\\mu - r_t) - \\sigma \\lambda(t)] \\, dt + \\sigma \\, dW_t^{\\mathbb{Q}}$$\nwhere $\\kappa$ is the speed of mean reversion, $\\mu$ is the long-run mean under the physical measure $\\mathbb{P}$, $\\sigma$ is the volatility, and $\\lambda(t)$ is the deterministic market price of risk. This SDE can be rewritten in the standard Hull-White form:\n$$dr_t = \\kappa (\\theta(t) - r_t) \\, dt + \\sigma \\, dW_t^{\\mathbb{Q}}$$\nwhere $\\theta(t)$ is a time-dependent mean-reversion level under $\\mathbb{Q}$, defined as:\n$$\\theta(t) = \\mu - \\frac{\\sigma}{\\kappa} \\lambda(t)$$\nOur primary goal is to determine $\\theta(t)$, from which we can easily find $\\lambda(t)$.\n\nThe calibration condition is that the model-implied instantaneous forward rate at time $t=0$ for maturity $T$, denoted $f_{model}(0, T)$, must match the given market instantaneous forward rate, $f_{market}(0, T)$, for all maturities $T \\ge 0$.\n$$f_{model}(0, T) = f_{market}(0, T), \\quad \\forall T \\ge 0$$\nFor a Hull-White model, the price at time $t$ of a zero-coupon bond maturing at $T$, $P(t, T)$, is known to have an affine form $P(t, T) = A(t, T) e^{-B(t, T) r_t}$. The instantaneous forward rate is defined as $f(t, T) = -\\frac{\\partial \\ln P(t, T)}{\\partial T}$. The general expression for the model's forward rate is a standard result:\n$$f_{model}(t, T) = e^{-\\kappa(T-t)} r_t + \\int_t^T \\kappa \\theta(s) e^{-\\kappa(T-s)} ds - \\frac{\\sigma^2}{2\\kappa^2} (1 - e^{-\\kappa(T-t)})^2$$\nTo calibrate at time $t=0$, we set $t=0$ in the above formula. The initial short rate $r_0$ is given by the initial forward curve at inception, $r_0 = f_{market}(0, 0)$.\n$$f_{model}(0, T) = e^{-\\kappa T} r_0 + \\int_0^T \\kappa \\theta(s) e^{-\\kappa(T-s)} ds - \\frac{\\sigma^2}{2\\kappa^2} (1 - e^{-\\kappa T})^2$$\nApplying the calibration condition, we obtain an integral equation for $\\theta(s)$:\n$$f_{market}(0, T) = e^{-\\kappa T} r_0 + e^{-\\kappa T}\\int_0^T \\kappa \\theta(s) e^{\\kappa s} ds - \\frac{\\sigma^2}{2\\kappa^2} (1 - e^{-\\kappa T})^2$$\nLet's define a function $G(T)$ for brevity:\n$$G(T) = f_{market}(0, T) - e^{-\\kappa T} r_0 + \\frac{\\sigma^2}{2\\kappa^2} (1 - e^{-\\kappa T})^2$$\nThe integral equation becomes:\n$$\\int_0^T \\kappa \\theta(s) e^{\\kappa s} ds = e^{\\kappa T} G(T)$$\nTo solve for $\\theta(t)$, we differentiate both sides with respect to $T$ and then substitute $t$ for $T$. Applying the Fundamental Theorem of Calculus to the left side and the product rule to the right side, we get:\n$$\\kappa \\theta(T) e^{\\kappa T} = \\frac{d}{dT} \\left[ e^{\\kappa T} G(T) \\right] = \\kappa e^{\\kappa T} G(T) + e^{\\kappa T} G'(T)$$\nSolving for $\\theta(T)$ yields:\n$$\\theta(T) = G(T) + \\frac{1}{\\kappa} G'(T)$$\nSubstituting the expression for $G(T)$ and its derivative $G'(T)$ and simplifying leads to the well-known formula for the calibrated mean-reversion level:\n$$\\theta(t) = f_{market}(0, t) + \\frac{1}{\\kappa} \\frac{\\partial f_{market}(0, t)}{\\partial t} + \\frac{\\sigma^2}{2\\kappa^2}(1 - e^{-2\\kappa t})$$\nHere, we have replaced the variable $T$ with $t$ to represent the time-dependency. The market forward curve is given as:\n$$f_{market}(0, t) = c_0 + c_1 e^{-b t} + c_2 t e^{-b t}$$\nIts derivative with respect to time $t$ is:\n$$\\frac{\\partial f_{market}(0, t)}{\\partial t} = -b c_1 e^{-b t} + c_2 e^{-b t} - b c_2 t e^{-b t} = (c_2 - b c_1) e^{-b t} - b c_2 t e^{-b t}$$\nSubstituting these into the expression for $\\theta(t)$:\n$$\\theta(t) = c_0 + \\left( c_1 + \\frac{c_2 - b c_1}{\\kappa} \\right) e^{-b t} + \\left( c_2 - \\frac{b c_2}{\\kappa} \\right) t e^{-b t} + \\frac{\\sigma^2}{2\\kappa^2}(1 - e^{-2\\kappa t})$$\nThis can be simplified to:\n$$\\theta(t) = c_0 + \\left( c_1(1-\\frac{b}{\\kappa}) + \\frac{c_2}{\\kappa} \\right) e^{-b t} + c_2(1-\\frac{b}{\\kappa}) t e^{-b t} + \\frac{\\sigma^2}{2\\kappa^2}(1 - e^{-2\\kappa t})$$\nFinally, we find the market price of risk $\\lambda(t)$ by rearranging its definition:\n$$\\lambda(t) = \\frac{\\kappa}{\\sigma} (\\mu - \\theta(t))$$\nWe will now implement this final formula using the provided parameters to compute $\\lambda(t)$ at the specified evaluation times.\n\nThe given parameters are:\n- Model parameters: $\\kappa = 0.7$, $\\mu = 0.03$, $\\sigma = 0.01$.\n- Forward curve parameters: $c_0 = 0.02$, $c_1 = 0.01$, $c_2 = 0.005$, $b = 0.5$.\n- Evaluation times: $t \\in \\{0.0, 0.25, 1.0, 5.0, 20.0\\}$.\n\nThe program will compute $\\theta(t)$ and then $\\lambda(t)$ for each of these time points.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the time-varying market price of risk lambda(t) that makes the\n    Vasicek model perfectly price a given initial term structure.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (kappa, mu, sigma, c0, c1, c2, b, evaluation_times)\n        (0.7, 0.03, 0.01, 0.02, 0.01, 0.005, 0.5, [0.0, 0.25, 1.0, 5.0, 20.0])\n    ]\n\n    results = []\n    # There is only one set of parameters in this problem.\n    kappa, mu, sigma, c0, c1, c2, b, eval_times = test_cases[0]\n\n    for t in eval_times:\n        # This implementation follows the derived formula for theta(t).\n        # theta(t) = f_market(0, t) + (1/kappa) * f_market'(0, t) + (sigma^2 / (2*kappa^2)) * (1 - exp(-2*kappa*t))\n        #\n        # f_market(0, t) = c0 + c1*exp(-b*t) + c2*t*exp(-b*t)\n        # f_market'(0, t) = (c2 - b*c1)*exp(-b*t) - b*c2*t*exp(-b*t)\n        #\n        # Combining these gives a simplified expression for theta(t), which is implemented here.\n\n        # Calculate common terms\n        exp_bt = np.exp(-b * t)\n        exp_2kt = np.exp(-2 * kappa * t)\n        \n        # Term 1: from c0\n        term1 = c0\n        \n        # Term 2: coefficient of exp(-b*t)\n        # This combines c1*exp(-b*t) from f_market and parts of f_market'\n        term2_coeff = c1 * (1 - b / kappa) + c2 / kappa\n        term2 = term2_coeff * exp_bt\n        \n        # Term 3: coefficient of t*exp(-b*t)\n        # This combines c2*t*exp(-b*t) from f_market and parts of f_market'\n        term3_coeff = c2 * (1 - b / kappa)\n        term3 = term3_coeff * t * exp_bt\n        \n        # Term 4: the volatility adjustment term\n        term4 = (sigma**2 / (2 * kappa**2)) * (1 - exp_2kt)\n        \n        # Sum the terms to get theta(t)\n        theta_t = term1 + term2 + term3 + term4\n        \n        # Calculate lambda(t) from theta(t)\n        # lambda(t) = (kappa/sigma) * (mu - theta(t))\n        lambda_t = (kappa / sigma) * (mu - theta_t)\n        \n        results.append(lambda_t)\n\n    # Final print statement in the exact required format.\n    # The format specified is a list of floats, comma-separated, inside square brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}