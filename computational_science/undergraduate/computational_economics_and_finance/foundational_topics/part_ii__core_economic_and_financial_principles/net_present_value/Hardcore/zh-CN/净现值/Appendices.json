{
    "hands_on_practices": [
        {
            "introduction": "现实世界中的投资项目通常具有复杂的现金流模式，无法用单一的简单公式来概括。本练习旨在挑战您通过将一个现实投资项目的现金流分解为不同部分来对其进行建模：包括初始成本、过渡期亏损、永续增长年金和有限期年金。掌握这种分解方法是评估复杂资本项目的关键实用技能 。",
            "id": "2413633",
            "problem": "一家多元化的谷物农场正在考虑从传统耕作方式永久转型为再生农业。请仅使用以下数据，评估与继续传统经营相比，该转型的增量净现值 (NPV)。所有现金流均以实际价值计算，以美元 (USD) 为单位，并且除非另有说明，均在每年年底发生。适用的经风险调整的恒定实际年折现率为 $r=0.07$，采用离散复利。\n\n数据：\n- 在时间 $t=0$ 时，农场产生一笔 $\\$220{,}000$ 的即时转换支出。\n- 在过渡期内，由于产量损失和再培训，增量净现金流（相对于继续传统经营）为负：\n  - 第 $t=1$ 年末：$-\\$90{,}000$，\n  - 第 $t=2$ 年末：$-\\$50{,}000$。\n- 从第 $t=3$ 年末起，由于价格溢价和投入成本降低，农场实现了永久性的增量净经营现金流。第 $t=3$ 年末的增量净现金流为 $\\$95{,}000$，并以每年 $g=0.025$ 的恒定实际增长率永久增长。\n- 此外，从第 $t=4$ 年末开始，一直持续到第 $t=13$ 年末（总共 $10$ 笔付款），农场每年收到 $\\$12{,}000$ 的增量碳信用收入（以实际价值计算）。\n\n假设没有其他增量效应（例如，无残值，税费已包含在给定的净现金流中，且无额外营运资本需求）。计算在 $t=0$ 时该转型的增量净现值 (NPV)。以美元表示最终答案，并四舍五入至四位有效数字。",
            "solution": "所给问题是资本预算中的一个标准练习，这是计算金融学的一个主题。该问题提法明确，内部一致，并包含得出唯一解所需的所有信息。我们将开始计算净现值 (NPV)。\n\n一项投资的净现值 (NPV) 是其增量现金流的现值之和，按指定利率折现。对于离散的、期末现金流的公式为：\n$$\n\\text{NPV} = \\sum_{t=0}^{\\infty} \\frac{CF_t}{(1+r)^t}\n$$\n其中，$CF_t$ 代表第 $t$ 年末的净现金流，$r$ 是恒定的实际年折现率，给定为 $r=0.07$。分析在时间 $t=0$ 进行。\n\n该项目的增量现金流可以分为四个不同的组成部分进行分析：\n1.  在 $t=0$ 时的初始投资支出。\n2.  第 $t=1$ 和 $t=2$ 年的过渡期净现金流。\n3.  从第 $t=3$ 年开始的增长型永续经营现金流。\n4.  从第 $t=4$ 年到第 $t=13$ 年的有限期年金形式的碳信用收入。\n\n我们将分别计算每个组成部分的现值，然后将它们相加得到总 NPV。\n\n组成部分 1：初始支出\n问题陈述了一笔 $220,000$ 的即时转换支出。这是在 $t=0$ 时的一笔现金流出，所以 $CF_0 = -220,000$。其现值就是其本身：\n$$\nPV_0 = -220,000\n$$\n\n组成部分 2：过渡期现金流\n该项目在头两年产生净现金流出：$CF_1 = -90,000$ 和 $CF_2 = -50,000$。这两笔现金流的现值通过将每笔折现至 $t=0$ 来计算：\n$$\nPV_{trans} = \\frac{CF_1}{(1+r)^1} + \\frac{CF_2}{(1+r)^2} = \\frac{-90,000}{1+0.07} + \\frac{-50,000}{(1+0.07)^2}\n$$\n\n组成部分 3：增长型永续经营现金流\n从第 $t=3$ 年起，该项目产生永续的经营现金流。第 $t=3$ 年的第一笔现金流是 $CF_{op,3} = 95,000$，之后以每年 $g=0.025$ 的恒定增长率增长。增长型永续年金的现值可以在第一笔现金流发生前一个时期计算。因此，我们首先计算该现金流在 $t=2$ 时的价值：\n$$\nV_{op, t=2} = \\frac{CF_{op,3}}{r-g}\n$$\n该公式适用，因为折现率 $r=0.07$ 大于增长率 $g=0.025$。\n为了求得在 $t=0$ 时的现值，我们必须将 $V_{op, t=2}$ 向后折现两年：\n$$\nPV_{op} = \\frac{V_{op, t=2}}{(1+r)^2} = \\frac{1}{(1+r)^2} \\left( \\frac{CF_{op,3}}{r-g} \\right) = \\frac{95,000}{(1+0.07)^2 (0.07 - 0.025)}\n$$\n\n组成部分 4：碳信用年金\n农场从第 $t=4$ 年末到第 $t=13$ 年末每年收到一笔 $A=12,000$ 的年金。这构成了一系列 $N=13-4+1=10$ 笔付款。普通年金的现值是在其第一笔付款前一个时期计算的。因此，我们首先计算该年金在 $t=3$ 时的价值：\n$$\nV_{cc, t=3} = A \\left( \\frac{1 - (1+r)^{-N}}{r} \\right) = 12,000 \\left( \\frac{1 - (1+0.07)^{-10}}{0.07} \\right)\n$$\n然后将这个在 $t=3$ 时的价值折现回 $t=0$：\n$$\nPV_{cc} = \\frac{V_{cc, t=3}}{(1+r)^3} = \\frac{1}{(1+0.07)^3} \\left[ 12,000 \\left( \\frac{1 - (1+0.07)^{-10}}{0.07} \\right) \\right]\n$$\n\n总净现值\n总 NPV 是所有组成部分现值的代数和：\n$$\n\\text{NPV} = PV_0 + PV_{trans} + PV_{op} + PV_{cc}\n$$\n代入表达式：\n$$\n\\text{NPV} = -220,000 + \\left(\\frac{-90,000}{1.07} + \\frac{-50,000}{1.07^2}\\right) + \\frac{95,000}{(1.07)^2(0.045)} + \\frac{12,000}{(1.07)^3} \\left( \\frac{1 - (1.07)^{-10}}{0.07} \\right)\n$$\n我们现在计算每一项的数值：\n$$\nPV_0 = -220,000\n$$\n$$\nPV_{trans} = -84,112.1495... - 43,671.9364... = -127,784.086...\n$$\n$$\nPV_{op} = \\frac{95,000}{1.1449 \\times 0.045} = \\frac{95,000}{0.0515205} = 1,843,941.130...\n$$\n$$\nPV_{cc} = \\frac{12,000}{1.225043...} \\left( \\frac{1 - 0.508349...}{0.07} \\right) = 9795.59... \\times 7.02358... = 68,799.801...\n$$\n将这些值相加：\n$$\n\\text{NPV} = -220,000 - 127,784.086 + 1,843,941.130 + 68,799.801 = 1,564,956.845\n$$\n问题要求最终答案四舍五入至四位有效数字。计算出的值为 $1,564,956.845$。前四位有效数字是 $1, 5, 6, 4$。第五位数字是 $9$，所以我们将第四位数字 $4$ 向上取整为 $5$。结果值为 $1,565,000$。按要求以科学记数法表示，即为 $1.565 \\times 10^6$。",
            "answer": "$$\\boxed{1.565 \\times 10^{6}}$$"
        },
        {
            "introduction": "尽管净现值（$NPV$）是投资评估的黄金标准，但内部收益率（$IRR$）等其他指标也十分常用，但有时可能会产生误导。本练习展示了一个非传统现金流项目，在这种情况下，$IRR$ 规则变得模棱两可，甚至会给出相互矛盾的决策信号。通过分析这个案例，您将学会批判性地评估不同的投资标准，并理解为何 $NPV$ 规则在理论上更为优越 。",
            "id": "2413634",
            "problem": "一家资本机会成本为 $r$ 的公司正在评估一个具有以下按时间标记的现金流（以货币单位计）的项目：时间 $t=0$ 时为 $-100$；时间 $t=1$ 时为 $+233$；时间 $t=2$ 时为 $-135$。这是一种具有多次符号变化的非常规现金流模式。该公司的门槛收益率为 $r=0.15$（即 $15\\%$）。仅使用现值、净现值 (NPV) 和内部收益率 (IRR) 的定义，并且不借助任何经验法则公式，确定哪个陈述最能描述此项目的 NPV 和 IRR 标准所隐含的决策。\n\nA. 当 $r=0.15$ 时，该项目的 $\\text{NPV}0$（接受），而内部收益率 (IRR) 不唯一（有两个不同的 IRR），因此 IRR 法则无法得出唯一的接受/拒绝决策。\n\nB. 当 $r=0.15$ 时，该项目的 $\\text{NPV}0$（拒绝），尽管 IRR 标准因存在多个 IRR 而不明确。\n\nC. 当 $r=0.15$ 时，该项目的 $\\text{NPV}0$（接受），并且只有一个 IRR，该 IRR 大于 $15\\%$ 的门槛收益率。\n\nD. 该项目的 NPV 总是负的，因为其现金流模式有两次符号变化，这总是导致负的净现值。",
            "solution": "问题陈述已提交以供验证。\n\n**步骤 1：提取已知条件**\n-   时间 $t=0$ 时的现金流：$C_0 = -100$。\n-   时间 $t=1$ 时的现金流：$C_1 = +233$。\n-   时间 $t=2$ 时的现金流：$C_2 = -135$。\n-   资本机会成本（门槛收益率）：$r = 0.15$。\n-   该问题涉及一个具有非常规现金流模式（两次符号变化：$-, +, -$）的项目。\n-   分析必须仅基于净现值 (NPV) 和内部收益率 (IRR) 的定义。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据、提法明确且客观。它为金融经济学中的一个标准问题提供了一套完整且一致的数据。NPV 和 IRR 的概念是基础性的，所指定的现金流模式是一个众所周知的案例，它展示了 IRR 法则的潜在局限性。所述条件是现实的，没有违反任何数学或经济学原理。\n\n**步骤 3：结论和行动**\n问题陈述有效。现在将推导一个严谨的解决方案。\n\n一个项目的净现值 (NPV) 定义为其贴现现金流的总和：\n$$ \\text{NPV} = \\sum_{t=0}^{n} \\frac{C_t}{(1+r)^t} $$\n对于给定的 $n=2$ 的项目，NPV 作为贴现率 $r$ 的函数是：\n$$ \\text{NPV}(r) = C_0 + \\frac{C_1}{1+r} + \\frac{C_2}{(1+r)^2} $$\n代入给定的现金流：\n$$ \\text{NPV}(r) = -100 + \\frac{233}{1+r} - \\frac{135}{(1+r)^2} $$\nNPV 决策法则是，如果一个项目在公司的资本机会成本下计算出的 NPV 为正，则接受该项目。我们给定的门槛收益率为 $r = 0.15$。让我们计算在该利率下的 NPV。\n$$ \\text{NPV}(0.15) = -100 + \\frac{233}{1+0.15} - \\frac{135}{(1+0.15)^2} $$\n$$ \\text{NPV}(0.15) = -100 + \\frac{233}{1.15} - \\frac{135}{(1.15)^2} $$\n$$ \\text{NPV}(0.15) = -100 + 202.60869... - \\frac{135}{1.3225} $$\n$$ \\text{NPV}(0.15) = -100 + 202.60869... - 102.07939... $$\n$$ \\text{NPV}(0.15) \\approx 0.5293 $$\n由于 $\\text{NPV}(0.15)  0$，NPV 标准要求该项目应被接受。\n\n内部收益率 (IRR) 定义为使 NPV恰好为零的贴现率 $r_{\\text{IRR}}$。\n$$ \\text{NPV}(r_{\\text{IRR}}) = -100 + \\frac{233}{1+r_{\\text{IRR}}} - \\frac{135}{(1+r_{\\text{IRR}})^2} = 0 $$\n为了找到 IRR，我们必须解这个关于 $r_{\\text{IRR}}$ 的方程。让我们定义一个变量 $x = 1+r_{\\text{IRR}}$。方程变为：\n$$ -100 + \\frac{233}{x} - \\frac{135}{x^2} = 0 $$\n为了消去分母，我们将整个方程乘以 $-x^2$（假设 $x \\neq 0$，这是因为要求 $r_{\\text{IRR}} \\neq -1$）：\n$$ 100x^2 - 233x + 135 = 0 $$\n这是一个形式为 $ax^2 + bx + c = 0$ 的标准二次方程，其中 $a=100$，$b=-233$，$c=135$。我们使用二次公式来求 $x$ 的根：\n$$ x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a} $$\n$$ x = \\frac{233 \\pm \\sqrt{(-233)^2 - 4(100)(135)}}{2(100)} $$\n$$ x = \\frac{233 \\pm \\sqrt{54289 - 54000}}{200} $$\n$$ x = \\frac{233 \\pm \\sqrt{289}}{200} $$\n$289$ 的平方根是 $17$。\n$$ x = \\frac{233 \\pm 17}{200} $$\n这给出了 $x$ 的两个不同的实数根：\n$$ x_1 = \\frac{233 + 17}{200} = \\frac{250}{200} = 1.25 $$\n$$ x_2 = \\frac{233 - 17}{200} = \\frac{216}{200} = 1.08 $$\n由于 $r_{\\text{IRR}} = x - 1$，我们找到相应的 IRR 值：\n$$ r_{\\text{IRR},1} = x_1 - 1 = 1.25 - 1 = 0.25 \\quad (\\text{或 } 25\\%) $$\n$$ r_{\\text{IRR},2} = x_2 - 1 = 1.08 - 1 = 0.08 \\quad (\\text{或 } 8\\%) $$\n该项目有两个不同的 IRR。IRR 决策法则规定，如果项目的 IRR 大于门槛收益率，则接受该项目，但在这种情况下，该法则是模糊不清的。一个 IRR ($25\\%$) 大于 $15\\%$ 的门槛收益率，建议接受。另一个 IRR ($8\\%$) 小于门槛收益率，建议拒绝。因此，IRR 法则没有提供一个单一、明确的决策。\n\n现在我们根据这些发现评估每个选项。\n\n**选项 A：** 当 $r=0.15$ 时，该项目的 $\\text{NPV}0$（接受），而内部收益率 (IRR) 不唯一（有两个不同的 IRR），因此 IRR 法则无法得出唯一的接受/拒绝决策。\n-   我们的计算显示 $\\text{NPV}(0.15) \\approx 0.53  0$，因此根据 NPV 标准，该项目是可接受的。这部分是正确的。\n-   我们的计算显示有两个不同的 IRR，$r_{\\text{IRR},1} = 0.25$ 和 $r_{\\text{IRR},2}=0.08$。IRR 不唯一。这部分是正确的。\n-   由于一个 IRR 高于门槛收益率而另一个低于门槛收益率，IRR 法则导致了矛盾的结论，因此“无法得出唯一的接受/拒绝决策”。这部分也是正确的。\n结论：**正确**。\n\n**选项 B：** 当 $r=0.15$ 时，该项目的 $\\text{NPV}0$（拒绝），尽管 IRR 标准因存在多个 IRR 而不明确。\n-   我们的计算显示 $\\text{NPV}(0.15) > 0$。因此，该选项是错误的。\n\n**选项 C：** 当 $r=0.15$ 时，该项目的 $\\text{NPV}0$（接受），并且只有一个 IRR，该 IRR 大于 $15\\%$ 的门槛收益率。\n-   我们的计算显示有两个 IRR。因此，该选项是错误的。\n\n**选项 D：** 该项目的 NPV 总是负的，因为其现金流模式有两次符号变化，这总是导致负的净现值。\n-   这是一个错误的直觉。我们的计算显示 $\\text{NPV}(0.15) > 0$。因此，该选项是错误的。\n\n基于分析，选项 A 是唯一完全正确的陈述。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "在现实世界中，确定性的财务预测几乎不存在。这个高级练习将向您介绍一种强大的计算技术——蒙特卡洛模拟，用于分析项目风险。通过将初始投资成本和现金流增长率等关键输入参数建模为随机变量，您将能够估算项目 $NPV$ 的整个概率分布，从而超越单一的点估计，对潜在结果形成更丰富的理解 。",
            "id": "2413588",
            "problem": "您的任务是编写一个完整、可运行的程序，使用蒙特卡洛模拟来估计一个项目在不确定性下的净现值 (NPV) 的概率分布。该项目有一个不确定的初始投资和一个在其有限期限内现金流的不确定恒定增长率。您的程序必须模拟这些不确定参数的抽样，基于基本的贴现现金流定义计算每次抽样的NPV，然后用指定的统计数据为一小组参数集总结模拟出的NPV分布。\n\n假设存在以下经济模型和定义：\n- 一个项目的初始投资在时间 $t=0$ 时为 $C_0$，具有恒定的折现率 $r$、恒定的现金流增长率 $g$、在时间 $t=1$ 时的初始单期现金流为 $F_1$、以及有限期限 $T$ 个周期，其净现值 (NPV) 为\n$$\n\\mathrm{NPV} \\;=\\; -\\,C_0 \\;+\\; \\sum_{t=1}^{T} \\frac{F_1\\,(1+g)^{t-1}}{(1+r)^t}.\n$$\n- 初始投资 $C_0$ 是严格为正的，并被建模为对数正态随机变量，$ \\ln C_0 \\sim \\mathcal{N}(\\mu_C, \\sigma_C^2)$，其参数 $(\\mu_C,\\sigma_C)$ 为每个测试用例给定。\n- 现金流增长率 $g$ 被建模为一个有下界 $-1$（因此 $1+g \\ge 0$）且无上界的截断正态随机变量，其截断前均值为 $\\mu_g$，标准差为 $\\sigma_g$；即 $g \\sim \\mathcal{N}(\\mu_g,\\sigma_g^2)$ 截断于 $[-1,\\infty)$。\n- 折现率 $r$ 是确定性的，且严格大于或等于 $0$。\n- 所有比率和概率必须以小数表示，而不是百分比。\n\n对于下方的每个测试用例，您的程序必须：\n1. 根据上述指定的分布，使用提供的种子以确保可复现性，生成 $K$ 个独立同分布的 $(C_0,g)$ 抽样。\n2. 对于每次抽样，使用上述定义计算相应的 $\\mathrm{NPV}$。\n3. 计算模拟出的 $\\mathrm{NPV}$ 分布的以下汇总统计数据：\n   - 样本均值，\n   - 样本标准差，定义为平方偏差的样本均值的平方根（即使用除数 $K$），\n   - $\\mathrm{NPV}  0$ 的经验概率，\n   - 水平为 $\\alpha = 0.05$ 时的风险价值 (VaR)，定义为经验 $\\alpha$-分位数，通过对 $K$ 个模拟值进行排序，并在相邻顺序统计量之间的分数索引 $(K-1)\\alpha$ 处进行线性插值计算得出。\n4. 将四个统计数据中的每一个都四舍五入到 $4$ 位小数。\n\n蒙特卡洛配置和可复现性要求：\n- 对每个测试用例使用 $K = 200000$ 次模拟抽样。\n- 使用每个测试用例指定的种子。如果伪随机数生成器每个独立流需要一个单独的种子，则对该测试用例的所有随机抽样使用提供的种子。\n\n测试套件：\n- 测试用例 1 (正常路径)：\n  - 期限 $T = 10$，\n  - 折现率 $r = 0.08$，\n  - 在 $t=1$ 时的单期现金流：$F_1 = 100$，\n  - 对数正态分布参数：$\\mu_C = \\ln(850)$，$\\sigma_C = 0.1$，\n  - $g$ 的截断正态分布参数：$\\mu_g = 0.03$，$\\sigma_g = 0.05$，\n  - 种子 $s_1 = 13579$。\n- 测试用例 2 (单周期和零折现率的边界条件)：\n  - 期限 $T = 1$，\n  - 折现率 $r = 0$，\n  - 在 $t=1$ 时的单期现金流：$F_1 = 100$，\n  - 对数正态分布参数：$\\mu_C = \\ln(100)$，$\\sigma_C = 0$，\n  - $g$ 的截断正态分布参数：$\\mu_g = 0$，$\\sigma_g = 0.1$，\n  - 种子 $s_2 = 24680$。\n- 测试用例 3 (高折现率，长期限)：\n  - 期限 $T = 20$，\n  - 折现率 $r = 0.20$，\n  - 在 $t=1$ 时的单期现金流：$F_1 = 80$，\n  - 对数正态分布参数：$\\mu_C = \\ln(500)$，$\\sigma_C = 0.2$，\n  - $g$ 的截断正态分布参数：$\\mu_g = 0.04$，$\\sigma_g = 0.02$，\n  - 种子 $s_3 = 11223$。\n- 测试用例 4 (负平均增长，大离散度)：\n  - 期限 $T = 5$，\n  - 折现率 $r = 0.05$，\n  - 在 $t=1$ 时的单期现金流：$F_1 = 120$，\n  - 对数正态分布参数：$\\mu_C = \\ln(300)$，$\\sigma_C = 0.5$，\n  - $g$ 的截断正态分布参数：$\\mu_g = -0.20$，$\\sigma_g = 0.30$，\n  - 种子 $s_4 = 33445$。\n\n最终输出格式：\n- 您的程序应产生单行输出，其中包含一个用方括号括起来的逗号分隔列表。每个测试用例的结果必须是列表 $[\\text{mean}, \\text{std}, \\text{prob\\_positive}, \\text{VaR}_{0.05}]$，其中每个值都四舍五入到 $4$ 位小数。因此，整体输出必须是按测试用例顺序列出的列表的列表。例如，输出必须类似于\n\"[ [m1,s1,p1,v1], [m2,s2,p2,v2], [m3,s3,p3,v3], [m4,s4,p4,v4] ]\"\n但逗号后没有空格，也没有额外文本。具体来说，您的程序必须精确打印单行，格式为\n\"[[m1,s1,p1,v1],[m2,s2,p2,v2],[m3,s3,p3,v3],[m4,s4,p4,v4]]\"。",
            "solution": "该问题是有效的，因为它在科学上基于标准的金融经济学理论，定义明确，提供了所有必要信息，并且其表述是客观的。任务是通过蒙特卡洛模拟估算项目净现值 ($NPV$) 的概率分布，这是计算金融学中的一种标准技术。\n\n解决方案通过实现一个基于所提供模型的数值模拟来推进。该方法的核心是为不确定参数生成大量随机情景，然后为每个情景计算项目的 $NPV$。由此产生的 $NPV$ 值的集合可作为真实底层 $NPV$ 分布的经验样本，我们可以从中计算所需的汇总统计数据。\n\n净现值定义为：\n$$\n\\mathrm{NPV} \\;=\\; -\\,C_0 \\;+\\; \\sum_{t=1}^{T} \\frac{F_1\\,(1+g)^{t-1}}{(1+r)^t}\n$$\n对于每个测试用例，参数 $T$、$r$ 和 $F_1$ 是确定性的。初始成本 $C_0$ 和增长率 $g$ 是随机变量。\n\n每个测试用例的模拟包括以下步骤：\n1.  **随机变量生成**：用指定的种子初始化一个随机数生成器，以确保可复现性。我们为 $C_0$ 和 $g$ 生成 $K=200000$ 个独立抽样。\n    -   初始投资 $C_0$ 服从对数正态分布，使得 $\\ln C_0 \\sim \\mathcal{N}(\\mu_C, \\sigma_C^2)$。我们可以生成 $K$ 个标准正态变量 $Z_i \\sim \\mathcal{N}(0, 1)$ 的抽样，其中 $i=1, \\dots, K$，然后将每个 $C_0$ 的抽样计算为 $C_{0,i} = \\exp(\\mu_C + \\sigma_C Z_i)$。这可以直接使用 `numpy.random.Generator.lognormal` 完成，该函数接受底层正态分布的均值 $\\mu_C$ 和标准差 $\\sigma_C$ 作为参数。\n    -   增长率 $g$ 从截断于区间 $[-1, \\infty)$ 的正态分布 $\\mathcal{N}(\\mu_g, \\sigma_g^2)$ 中抽取。这确保了现金流的增长率不低于 $-100\\%$。`scipy.stats.truncnorm` 类用于此目的。底层标准正态变量的标准边界 $a$ 和 $b$ 计算为 $a = (-1 - \\mu_g) / \\sigma_g$ 和 $b = \\infty$。然后，使用指定的位置参数 $\\mu_g$ 和尺度参数 $\\sigma_g$ 抽取 $K$ 个随机变量。\n\n2.  **NPV 计算**：为了高效地计算所有 $K$ 个情景的 $NPV$，采用了向量化操作。设 $\\mathbf{g}$ 为增长率的 $K$ 个抽样的向量，$\\mathbf{C_0}$ 为初始成本的 $K$ 个抽样的向量。计算每个情景的未来现金流现值 ($PVCF$)。求和项 $\\sum_{t=1}^{T} \\dots$ 对所有抽样同时计算。\n    -   创建一个时间向量 $\\mathbf{t} = [1, 2, \\dots, T]$。\n    -   计算一个折现因子向量 $\\mathbf{d} = [(1+r)^{-1}, (1+r)^{-2}, \\dots, (1+r)^{-T}]$。\n    -   构建一个大小为 $K \\times T$ 的增长因子矩阵 $\\mathbf{G}$，其中每个元素 $G_{i,t} = (1+g_i)^{t-1}$。这是通过将形状为 $(K,)$ 的向量 $\\mathbf{g}$ 和形状为 $(T,)$ 的时间索引向量广播成一个形状为 $(K, T)$ 的矩阵来实现的。\n    -   通过对每个抽样 $i$ 随时间贴现的现金流求和来计算其现金流现值。所有 $K$ 个抽样的 $PVCF$ 向量计算如下：\n        $$ \\mathbf{PVCF}_{i} = \\sum_{t=1}^{T} F_1 \\cdot (1+g_i)^{t-1} \\cdot (1+r)^{-t} $$\n        在 `NumPy` 中，这可以通过广播一次性高效地为所有抽样计算：`(F_1 * growth_factors * discount_factors).sum(axis=1)`。\n    -   最后，通过逐元素减去初始成本得到 $NPV$ 值的向量：$\\mathbf{NPV} = \\mathbf{PVCF} - \\mathbf{C_0}$。\n\n3.  **统计分析**：从得到的 $K$ 个模拟值的向量 $\\mathbf{NPV}$ 中，计算以下统计数据：\n    -   **均值**：样本均值 $\\frac{1}{K}\\sum_{i=1}^{K} \\mathrm{NPV}_i$，使用 `numpy.mean()` 计算。\n    -   **标准差**：使用 $K$ 作为除数的样本标准差，$\\sqrt{\\frac{1}{K}\\sum_{i=1}^{K} (\\mathrm{NPV}_i - \\overline{\\mathrm{NPV}})^2}$，使用 `numpy.std()` 并采用默认的 `ddof=0` 计算。\n    -   **正 NPV 的概率**：$\\mathrm{NPV}_i  0$ 的抽样比例，计算为 `numpy.mean(NPV_draws  0)`。\n    -   **风险价值 (VaR)**：$5\\%$ 的 VaR 是模拟 $NPV$ 分布的经验 $0.05$-分位数。这是通过对 $\\mathbf{NPV}$ 向量进行排序，并使用线性插值在分数索引 $(K-1) \\times 0.05$ 处找到值来计算的。`numpy.quantile()` 函数以 $q=0.05$ 实现了这一定义。\n\n4.  **格式化**：每个测试用例的四个计算出的统计数据四舍五入到 $4$ 位小数，并格式化为指定的列表的列表的字符串表示，不含空格。\n\n这种结构化的方法确保了正确性、可复现性和计算效率。该实现正确处理了边界条件，例如测试用例 2 中的确定性情况，其中 $T=1$，$r=0$ 和 $\\sigma_C=0$ 必须产生 $NPV$ 为 $0$。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import truncnorm\n\ndef calculate_npv_stats(T, r, F1, mu_C, sigma_C, mu_g, sigma_g, K, seed):\n    \"\"\"\n    Simulates NPV distribution and computes summary statistics for one test case.\n    \"\"\"\n    # 1. Set up random number generator for reproducibility.\n    rng = np.random.default_rng(seed)\n\n    # 2. Generate K random draws for the stochastic variables C0 and g.\n    # C0 is drawn from a lognormal distribution.\n    if sigma_C  0:\n        C0_draws = rng.lognormal(mean=mu_C, sigma=sigma_C, size=K)\n    else:  # Deterministic case if sigma_C is 0\n        C0_draws = np.full(K, np.exp(mu_C), dtype=np.float64)\n\n    # g is drawn from a truncated normal distribution.\n    if sigma_g  0:\n        a_std = (-1.0 - mu_g) / sigma_g\n        b_std = np.inf\n        # Use random_state for reproducibility with SciPy\n        g_draws = truncnorm.rvs(a=a_std, b=b_std, loc=mu_g, scale=sigma_g, size=K, random_state=rng)\n    else: # Deterministic case if sigma_g is 0\n        g_draws = np.full(K, mu_g, dtype=np.float64)\n\n    # 3. Calculate NPV for each of the K draws using vectorization.\n    # Time vector t = [1, 2, ..., T]\n    t = np.arange(1, T + 1, dtype=np.float64)\n\n    # Discount factors for each time period\n    discount_factors = (1.0 + r) ** -t\n\n    # Growth factors for each draw over time (K x T matrix)\n    # This uses broadcasting: g_draws (K,) and t (T,) - (K, T)\n    growth_factors = (1.0 + g_draws[:, np.newaxis]) ** (t - 1)\n\n    # Present Value of Cash Flows for each draw (sum over time)\n    # F1 * growth_factors * discount_factors also uses broadcasting\n    PVCF_draws = (F1 * growth_factors * discount_factors).sum(axis=1)\n\n    # Net Present Value for each draw\n    NPV_draws = PVCF_draws - C0_draws\n\n    # 4. Compute the required summary statistics.\n    mean_npv = np.mean(NPV_draws)\n    \n    # Standard deviation with divisor K (ddof=0 is the default)\n    std_npv = np.std(NPV_draws)\n    \n    # Empirical probability that NPV  0\n    prob_positive = np.mean(NPV_draws  0)\n    \n    # Value-at-Risk at alpha=0.05\n    # np.quantile uses linear interpolation by default at index (K-1)*alpha\n    var_05 = np.quantile(NPV_draws, 0.05)\n\n    # 5. Round results to 4 decimal places.\n    return [\n        round(mean_npv, 4),\n        round(std_npv, 4),\n        round(prob_positive, 4),\n        round(var_05, 4)\n    ]\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print the final result.\n    \"\"\"\n    # Monte Carlo simulation configuration\n    K = 200000\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # T, r, F1, mu_C, sigma_C, mu_g, sigma_g, seed\n        (10, 0.08, 100, np.log(850), 0.1, 0.03, 0.05, 13579),\n        (1, 0.00, 100, np.log(100), 0.0, 0.0, 0.1, 24680),\n        (20, 0.20, 80, np.log(500), 0.2, 0.04, 0.02, 11223),\n        (5, 0.05, 120, np.log(300), 0.5, -0.20, 0.30, 33445)\n    ]\n\n    results = []\n    for case in test_cases:\n        T, r, F1, mu_C, sigma_C, mu_g, sigma_g, seed = case\n        result_list = calculate_npv_stats(T, r, F1, mu_C, sigma_C, mu_g, sigma_g, K, seed)\n        results.append(result_list)\n\n    # Final print statement in the exact required format.\n    # Example: [[m1,s1,p1,v1],[m2,s2,p2,v2]]\n    # Using str().replace() is a robust way to get the format without spaces.\n    print(str(results).replace(\" \", \"\"))\n\nsolve()\n```"
        }
    ]
}