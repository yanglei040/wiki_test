{
    "hands_on_practices": [
        {
            "introduction": "循环是编程中的基本结构，其分支行为具有高度的可预测性。第一个练习将让我们在一个经典的嵌套循环结构上，分析和量化1位和2位预测器的性能。通过追踪预测器的状态，我们将具体理解为什么2位方案的额外状态对于有效处理循环出口至关重要。",
            "id": "3637231",
            "problem": "考虑由以下伪代码定义的嵌套循环：\nfor $i = 1$ to $m$:\n    for $j = 1$ to $n$:\n        body\n将控制这些循环的两个条件后向分支建模如下：内循环的退出测试在每次外循环迭代中精确执行 $n$ 次，并产生结果序列 $\\mathrm{T}, \\mathrm{T}, \\dots, \\mathrm{T}, \\mathrm{NT}$（即 $\\mathrm{T}$ 重复 $n-1$ 次，然后是 $\\mathrm{NT}$ 一次），而外循环的退出测试在整个运行过程中精确执行 $m$ 次，并产生结果序列 $\\mathrm{T}$ 重复 $m-1$ 次，然后是 $\\mathrm{NT}$ 一次。假设每个静态分支都有其专用的预测器条目（无别名效应），并且没有其他分支。假设 $n \\geq 2$ 且 $m \\geq 2$。\n\n考虑两种动态分支预测器，每种都为每个静态分支维护状态：\n1) 一个1位预测器，它总是预测上次观测到的结果，并在每次错误预测时翻转其位。两个分支的初始状态均为“预测 $\\mathrm{NT}$”。\n2) 一个2位饱和计数器预测器，具有4个状态：强不跳转 ($00$)、弱不跳转 ($01$)、弱跳转 ($10$)、强跳转 ($11$)。最高有效位决定预测结果（$0$ 代表 $\\mathrm{NT}$，$1$ 代表 $\\mathrm{T}$）。当结果为 $\\mathrm{T}$ 时，计数器加1，直到在 $11$ 饱和；当结果为 $\\mathrm{NT}$ 时，计数器减1，直到在 $00$ 饱和。两个分支的初始状态均为弱不跳转 ($01$)。\n\n从这些定义和循环结果模式出发，从基本原理推导每种预测器在嵌套循环整个执行过程中的错误预测总数，将内循环和外循环退出分支的贡献相加。将您的最终答案表示为一个单行矩阵，其第一个条目是1位预测器下的总错误预测数，第二个条目是2位预测器下的总错误预测数。不需要四舍五入。您的最终表达式应为关于 $m$ 和 $n$ 的闭式形式。",
            "solution": "该问题已经过验证，在计算机组成与体系结构领域被认为是合理、适定且具有科学依据的。它提供了一套完整且一致的定义和约束来推导出唯一的解。我们继续进行分析。\n\n错误预测的总数是内循环分支和外循环分支的错误预测数之和。我们将分别分析每种预测器。\n\n### 1位预测器分析\n\n1位预测器有两个状态：预测跳转（$\\mathrm{P_T}$）和预测不跳转（$\\mathrm{P_{NT}}$）。预测器在发生错误预测时翻转其状态。对于内循环和外循环分支，初始状态均被指定为“预测 $\\mathrm{NT}$”，对应于状态 $\\mathrm{P_{NT}}$。\n\n#### 使用1位预测器的内循环分支\n内循环的结果序列 $\\mathrm{T}, \\mathrm{T}, \\dots, \\mathrm{T}, \\mathrm{NT}$（$n-1$ 次 $\\mathrm{T}$，然后是一次 $\\mathrm{NT}$），被执行 $m$ 次。我们分析该序列一次完整执行的行为。\n\n我们来追踪第一次外循环迭代（$i=1$）：\n- 内循环分支的预测器从状态 $\\mathrm{P_{NT}}$ 开始。\n- **第1次执行：** 结果是 $\\mathrm{T}$。预测是 $\\mathrm{NT}$。这是一次 **错误预测**。状态翻转为 $\\mathrm{P_T}$。\n- **第2次到第 $n-1$ 次执行：** 结果总是 $\\mathrm{T}$。现在的预测是 $\\mathrm{T}$。这些都是正确预测。状态保持为 $\\mathrm{P_T}$。\n- **第 $n$ 次执行：** 结果是 $\\mathrm{NT}$。预测是 $\\mathrm{T}$。这是一次 **错误预测**。状态翻转回 $\\mathrm{P_{NT}}$。\n\n对于外循环的第一次迭代，内循环分支产生2次错误预测。在这次迭代结束时，预测器状态为 $\\mathrm{P_{NT}}$。\n\n对于每一次后续的外循环迭代（从 $i=2$ 到 $m$），内循环分支的预测器都再次从状态 $\\mathrm{P_{NT}}$ 开始。因此，对于 $m$ 次外循环迭代中的每一次，分析都是相同的。每次执行内循环时，它都会产生恰好2次错误预测。\n\n在 $m$ 次外循环迭代中，内循环分支的总错误预测数 = $2 \\times m = 2m$。\n\n#### 使用1位预测器的外循环分支\n外循环分支的结果序列是 $\\mathrm{T}, \\mathrm{T}, \\dots, \\mathrm{T}, \\mathrm{NT}$（$m-1$ 次 $\\mathrm{T}$，然后是一次 $\\mathrm{NT}$）。这个序列被执行一次。\n\n- 外循环分支的预测器从状态 $\\mathrm{P_{NT}}$ 开始。\n- **第1次执行：** 结果是 $\\mathrm{T}$。预测是 $\\mathrm{NT}$。这是一次 **错误预测**。状态翻转为 $\\mathrm{P_T}$。\n- **第2次到第 $m-1$ 次执行：** 结果总是 $\\mathrm{T}$。预测是 $\\mathrm{T}$。这些都是正确预测。状态保持为 $\\mathrm{P_T}$。\n- **第 $m$ 次执行：** 结果是 $\\mathrm{NT}$。预测是 $\\mathrm{T}$。这是一次 **错误预测**。状态翻转回 $\\mathrm{P_{NT}}$。\n\n外循环分支的错误预测总数为2。\n\n#### 1位预测器的总错误预测数\n总错误预测数 $M_1$ 是两个分支的错误预测数之和。\n$$M_1 = (\\text{内循环错误预测数}) + (\\text{外循环错误预测数}) = 2m + 2$$\n\n### 2位饱和计数器预测器分析\n\n2位预测器使用一个4状态饱和计数器：$00$（强不跳转，$\\mathrm{SN}$）、$01$（弱不跳转，$\\mathrm{WN}$）、$10$（弱跳转，$\\mathrm{WT}$）和 $11$（强跳转，$\\mathrm{ST}$）。对于状态 $00$ 和 $01$（MSB为 $0$），预测为 $\\mathrm{NT}$；对于状态 $10$ 和 $11$（MSB为 $1$），预测为 $\\mathrm{T}$。当结果为 $\\mathrm{T}$ 时，计数器递增（在 $11$ 饱和）；当结果为 $\\mathrm{NT}$ 时，计数器递减（在 $00$ 饱和）。两个分支的初始状态均为 $01$（$\\mathrm{WN}$）。\n\n#### 使用2位预测器的内循环分支\n我们追踪第一次及后续外循环迭代的行为。\n\n对于第一次外循环迭代（$i=1$）：\n- 预测器从状态 $01$（$\\mathrm{WN}$）开始，预测为 $\\mathrm{NT}$。\n- **第1次执行：** 结果是 $\\mathrm{T}$。预测是 $\\mathrm{NT}$。这是一次 **错误预测**。状态递增到 $10$（$\\mathrm{WT}$）。\n- **第2次执行：** 结果是 $\\mathrm{T}$。状态是 $10$（$\\mathrm{WT}$），预测为 $\\mathrm{T}$。这是一次正确预测。状态递增到 $11$（$\\mathrm{ST}$）。\n- **第3次到第 $n-1$ 次执行：** 结果是 $\\mathrm{T}$。状态是 $11$（$\\mathrm{ST}$），预测为 $\\mathrm{T}$。这些都是正确预测。由于饱和，状态保持为 $11$。\n- **第 $n$ 次执行：** 结果是 $\\mathrm{NT}$。状态是 $11$（$\\mathrm{ST}$），预测为 $\\mathrm{T}$。这是一次 **错误预测**。状态递减到 $10$（$\\mathrm{WT}$）。\n\n对于外循环的第一次迭代（$i=1$），内循环分支产生2次错误预测。在这次迭代结束时，预测器状态为 $10$（$\\mathrm{WT}$）。\n\n对于第二次外循环迭代（$i=2$）：\n- 预测器从上一次迭代遗留的状态开始，即 $10$（$\\mathrm{WT}$），预测为 $\\mathrm{T}$。\n- **第1次执行：** 结果是 $\\mathrm{T}$。预测是 $\\mathrm{T}$。这是一次正确预测。状态递增到 $11$（$\\mathrm{ST}$）。\n- **第2次到第 $n-1$ 次执行：** 结果是 $\\mathrm{T}$。状态是 $11$（$\\mathrm{ST}$），预测为 $\\mathrm{T}$。这些都是正确预测。状态保持为 $11$。\n- **第 $n$ 次执行：** 结果是 $\\mathrm{NT}$。状态是 $11$（$\\mathrm{ST}$），预测为 $\\mathrm{T}$。这是一次 **错误预测**。状态递减到 $10$（$\\mathrm{WT}$）。\n\n对于第二次迭代（$i=2$），只有1次错误预测。在结束时，预测器状态再次为 $10$（$\\mathrm{WT}$）。\n这种模式对于从 $i=2$ 到 $m$ 的所有后续迭代都会重复。这 $m-1$ 次迭代中的每一次都将从状态 $10$ 开始，并产生恰好1次错误预测。\n\n内循环分支的总错误预测数：\n$$(\\text{i=1时的错误预测数}) + (\\text{i=2 到 m时的错误预测数})$$\n$$2 + (m-1) \\times 1 = 2 + m - 1 = m+1$$\n\n#### 使用2位预测器的外循环分支\n结果序列是 $\\mathrm{T}, \\mathrm{T}, \\dots, \\mathrm{T}, \\mathrm{NT}$（$m-1$ 次 $\\mathrm{T}$，一次 $\\mathrm{NT}$）。\n- 预测器从状态 $01$（$\\mathrm{WN}$）开始，预测为 $\\mathrm{NT}$。\n- **第1次执行：** 结果是 $\\mathrm{T}$。预测是 $\\mathrm{NT}$。这是一次 **错误预测**。状态递增到 $10$（$\\mathrm{WT}$）。\n- **第2次执行：** 结果是 $\\mathrm{T}$。状态是 $10$（$\\mathrm{WT}$），预测为 $\\mathrm{T}$。这是一次正确预测。状态递增到 $11$（$\\mathrm{ST}$）。这是成立的，因为 $m \\geq 2$。\n- **第3次到第 $m-1$ 次执行：** 结果是 $\\mathrm{T}$。状态是 $11$（$\\mathrm{ST}$），预测为 $\\mathrm{T}$。这些都是正确预测。状态保持为 $11$。\n- **第 $m$ 次执行：** 结果是 $\\mathrm{NT}$。状态是 $11$（$\\mathrm{ST}$），预测为 $\\mathrm{T}$。这是一次 **错误预测**。状态递减到 $10$（$\\mathrm{WT}$）。\n\n外循环分支的错误预测总数为2。\n\n#### 2位预测器的总错误预测数\n总错误预测数 $M_2$ 是两个分支的错误预测数之和。\n$$M_2 = (\\text{内循环错误预测数}) + (\\text{外循环错误预测数}) = (m+1) + 2 = m+3$$\n\n### 总结\n- 1位预测器的总错误预测数：$M_1 = 2m + 2$。\n- 2位预测器的总错误预测数：$M_2 = m + 3$。\n\n最终答案以行矩阵 $[M_1, M_2]$ 的形式呈现。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2m+2 & m+3\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "尽管循环很常见，但分支行为可以表现出许多其他类型的规则模式。这个练习将我们的分析推广到由“跳转”（Taken）和“不跳转”（Not Taken）结果组成的任意周期性序列。这促使我们使用更形式化的稳态分析，并揭示 $2$ 位饱和计数器的性能如何与分支模式的具体结构紧密相连。",
            "id": "3637265",
            "problem": "一个程序中反复遇到一个单一的静态条件分支。其结果遵循一个周期性模式：分支连续 $a$ 次执行为“跳转”（Taken），然后连续 $b$ 次执行为“不跳转”（Not Taken），并且这个 $T^{a}N^{b}$ 模式无限重复。假设 $a$ 和 $b$ 是正整数。考虑两种动态分支预测器：\n\n1. 一个1位最后结果预测器，它总是预测下一次的结果与最近一次的结果相同。将其初始化，使得在第一次实际结果出现之前的首次预测为“不跳转”。\n\n2. 一个2位饱和计数器预测器，具有四种状态：强不跳转（$0$）、弱不跳转（$1$）、弱跳转（$2$）和强跳转（$3$）。当处于状态 $0$ 或 $1$ 时，预测器预测“不跳转”；当处于状态 $2$ 或 $3$ 时，预测器预测“跳转”。当实际结果为“跳转”时，计数器加 $1$，除非已经达到 $3$；当实际结果为“不跳转”时，计数器减 $1$，除非已经为 $0$。在第一次实际结果出现之前，将计数器初始化为“强不跳转”（$0$）。\n\n从这些初始状态开始，并让该模式无限重复，以至于任何初始瞬态都可以忽略不计，请为这两种预测器推导出一个完整周期内每个结果的稳态平均误预测率的闭式解析表达式，该表达式应为关于 $a$ 和 $b$ 的函数。将每个误预测率表示为关于 $a$ 和 $b$ 的无量纲分数。最终答案必须是一个计算过程，并包含两个表达式，每种预测器各一个。不需要四舍五入。",
            "solution": "该问题要求针对给定的周期性分支结果模式，为两种类型的动态分支预测器推导稳态平均误预测率。该模式包含连续 $a$ 次“跳转”（$T$）结果，随后是连续 $b$ 次“不跳转”（$N$）结果，以 $T^aN^b$ 的形式重复。一个完整周期内的总结果数为 $a+b$。平均误预测率是一个稳态周期内的总误预测次数除以该周期内的总结果数。\n\n**1. 1位最后结果预测器分析**\n\n该预测器有两种状态，可以用最后一次的结果来表示：$T$ 或 $N$。对下一个分支的预测是重复上一次的结果。题目要求的是稳态率，这意味着我们可以分析单个 $T^aN^b$ 周期，并假设系统已经度过了任何初始瞬态。一个周期开始时预测器的状态由前一个周期的最后结果决定。\n\n我们来分析一个稳态周期 $T_1, T_2, \\dots, T_a, N_1, N_2, \\dots, N_b$。\n该周期之前的上一个结果是前一轮的 $N_b$。因此，在观察到 $T_1$ 之前，预测器的状态是 $N$。\n\n- **对于 $T^a$ 序列：**\n  - 第一个分支是 $T_1$。预测器状态为 $N$，因此它预测“不跳转”。实际结果是“跳转”。这是一次 **误预测**。预测器状态更新为 $T$。\n  - 对于随后的 $a-1$ 个分支（$T_2, \\dots, T_a$），预测器状态为 $T$。它对这些分支中的每一个都正确预测为“跳转”。\n  - $T^a$ 序列中的误预测次数为：$1$。这对任何正整数 $a \\ge 1$ 都成立。\n\n- **对于 $N^b$ 序列：**\n  - 该序列在最后一个“跳转”分支 $T_a$ 之后开始。此时预测器的状态是 $T$。\n  - 该序列的第一个分支是 $N_1$。预测器状态为 $T$，因此它预测“跳转”。实际结果是“不跳转”。这是一次 **误预测**。预测器状态更新为 $N$。\n  - 对于随后的 $b-1$ 个分支（$N_2, \\dots, N_b$），预测器状态为 $N$。它对这些分支中的每一个都正确预测为“不跳转”。\n  - $N^b$ 序列中的误预测次数为：$1$。这对任何正整数 $b \\ge 1$ 都成立。\n\n在一个完整的稳态周期中，“跳转”块的开始处有一次误预测，“不跳转”块的开始处也有一次误预测。\n每个周期的总误预测次数为 $M_1 = 1 + 1 = 2$。\n每个周期的总结果数为 $a+b$。\n1位预测器的稳态误预测率 $R_1$ 为：\n$$R_1 = \\frac{M_1}{a+b} = \\frac{2}{a+b}$$\n\n**2. 2位饱和计数器预测器分析**\n\n该预测器使用一个4状态计数器：$0$（强不跳转，SN）、$1$（弱不跳转，WN）、$2$（弱跳转，WT）和 $3$（强跳转，ST）。\n- 预测：状态为 $0, 1$ 时预测“不跳转”；状态为 $2, 3$ 时预测“跳转”。\n- 状态更新：当结果为“跳转”时，状态 $C$ 变为 $\\min(C+1, 3)$。当结果为“不跳转”时，状态 $C$ 变为 $\\max(C-1, 0)$。\n\n为了找到稳态误预测率，我们必须首先确定一个周期开始时计数器的状态。设 $C_{start}$ 为 $T^a$ 序列开始时计数器的状态。在稳态下，这必定是前一个 $N^b$ 序列完成后的状态。设 $C_{mid}$ 为 $T^a$ 序列结束后的状态。\n\n一个完整周期内的状态转换如下：\n1. 经过 $a$ 次“跳转”结果后，状态从 $C_{start}$ 转换到 $C_{mid} = \\min(3, C_{start} + a)$。\n2. 经过 $b$ 次“不跳转”结果后，状态从 $C_{mid}$ 转换回 $C_{start} = \\max(0, C_{mid} - b)$。\n\n将这些结合起来，得到稳态起始状态 $C_{start}$ 的不动点方程：\n$$C_{start} = \\max(0, \\min(3, C_{start} + a) - b)$$\n我们通过考虑 $a$ 和 $b$ 的不同情况来求解 $C_{start}$（它必须是 $\\{0, 1, 2, 3\\}$ 中的一个整数）。如果 $C_{start}' = \\max(0, \\min(3, C_{start} + a) - b)$ 意味着 $C_{start}' = C_{start}$，则达到了一个稳定的不动点 $C_{start}$。\n对该方程的分析得出以下稳态起始状态：\n- 若 $b=1, a \\ge 2$：$C_{start}=2$。\n- 若 $b=2, a \\ge 3$：$C_{start}=1$。\n- 其他情况：$C_{start}=0$。这涵盖了 ($a=1, \\forall b \\ge 1$)、($a=2, b \\ge 2$) 和 ($a \\ge 3, b \\ge 3$) 的情况。\n\n确定了 $C_{start}$ 后，我们就可以计算周期中每个部分的误预测次数。\n- $T^a$ 序列期间的误预测 ($M_T$)：当预测器状态为 $0$ 或 $1$ 时发生。从 $C_{start}$ 开始，每次“跳转”分支后状态递增。误预测的次数是状态达到 $2$ 所需的步数。\n  - 若 $C_{start}=0$，状态为 $0 \\to 1 \\to 2 \\dots$。前两个分支会发生误预测（如果 $a \\ge 2$）。$M_T = \\min(a, 2)$。\n  - 若 $C_{start}=1$，状态为 $1 \\to 2 \\to 3 \\dots$。第一个分支会发生一次误预测。$M_T = 1$（因为 $a \\ge 1$）。\n  - 若 $C_{start} \\ge 2$，预测器已处于“跳转”状态，因此没有误预测。$M_T = 0$。\n\n- $N^b$ 序列期间的误预测 ($M_N$)：当预测器状态为 $2$ 或 $3$ 时发生。此序列开始时的状态是 $C_{mid} = \\min(3, C_{start}+a)$。误预测的次数是状态递减到 $1$ 所需的步数。\n  - 若 $C_{mid}=3$，状态为 $3 \\to 2 \\to 1 \\dots$。前两个分支会发生误预测（如果 $b \\ge 2$）。$M_N = \\min(b, 2)$。\n  - 若 $C_{mid}=2$，状态为 $2 \\to 1 \\to 0 \\dots$。第一个分支会发生一次误预测。$M_N = 1$（因为 $b \\ge 1$）。\n  - 若 $C_{mid} \\le 1$，预测器已处于“不跳转”状态，因此没有误预测。$M_N = 0$。\n\n现在我们计算每种 $(a,b)$ 情况下的总误预测次数 $M_2 = M_T+M_N$：\n\n- **情况A：$a=1, \\forall b \\ge 1$。**\n  $C_{start}=0$，所以 $C_{mid}=\\min(3, 0+1)=1$。\n  $M_T = \\min(1,2)=1$。$M_N=0$ 因为 $C_{mid}=1$。\n  $M_2 = 1+0=1$。\n\n- **情况B：$b=1, a \\ge 2$。**\n  $C_{start}=2$，所以 $C_{mid}=\\min(3, 2+a)=3$ (因为 $a\\ge2$)。\n  $M_T = 0$ 因为 $C_{start}=2$。$M_N=\\min(1,2)=1$。\n  $M_2 = 0+1=1$。\n\n- **情况C：$a=2, b \\ge 2$。**\n  $C_{start}=0$，所以 $C_{mid}=\\min(3, 0+2)=2$。\n  $M_T = \\min(2,2)=2$。$M_N=1$ 因为 $C_{mid}=2$。\n  $M_2 = 2+1=3$。\n\n- **情况D：$a \\ge 3, b=2$。**\n  $C_{start}=1$，所以 $C_{mid}=\\min(3, 1+a)=3$ (因为 $a\\ge3$)。\n  $M_T=1$ 因为 $C_{start}=1$。$M_N=\\min(2,2)=2$。\n  $M_2 = 1+2=3$。\n\n- **情况E：$a \\ge 3, b \\ge 3$。**\n  $C_{start}=0$，所以 $C_{mid}=\\min(3, 0+a)=3$ (因为 $a\\ge3$)。\n  $M_T=\\min(a,2)=2$。$M_N=\\min(b,2)=2$。\n  $M_2 = 2+2=4$。\n\n总误预测次数 $M_2$ 可以总结为关于 $a$ 和 $b$ 的分段函数：\n$$M_2(a,b) = \\begin{cases} 1  \\text{if } a=1 \\text{ or } b=1 \\\\ 3  \\text{if } (a=2, b \\ge 2) \\text{ or } (a \\ge 3, b=2) \\\\ 4  \\text{if } a \\ge 3 \\text{ and } b \\ge 3 \\end{cases}$$\n因此，2位预测器的误预测率 $R_2$ 为：\n$$R_2 = \\frac{M_2(a,b)}{a+b}$$\n\n所需的两个表达式是 $R_1$ 和 $R_2$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{2}{a+b} \\\\\n\\frac{1}{a+b} \\times \\begin{cases} 1  & \\text{if } a=1 \\text{ or } b=1 \\\\ 3  & \\text{if } (a=2 \\text{ and } b \\ge 2) \\text{ or } (a \\ge 3 \\text{ and } b=2) \\\\ 4  & \\text{if } a \\ge 3 \\text{ and } b \\ge 3 \\end{cases}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "预测器的性能取决于它能学习到的模式。这最后一个练习探讨了一个关键的理论情景：一个结果完全随机的分支。这个思想实验揭示了任何基于历史的预测方案的根本局限性，并强调了当没有模式可供学习时，动态预测器相比简单的静态猜测没有任何优势。",
            "id": "3637335",
            "problem": "考虑一个条件分支，其跳转方向由一个输入字的奇偶性决定，该输入字在每个动态实例上都是均匀随机的。将动态分支结果建模为一个独立同分布 (i.i.d.) 序列 $\\{X_{n}\\}_{n \\ge 1}$，其中 $X_{n} \\in \\{0,1\\}$，$X_{n}=1$ 表示“跳转”(Taken)，$X_{n}=0$ 表示“不跳转”(Not Taken)，并且对于所有 $n$，都有 $\\Pr(X_{n}=1)=\\Pr(X_{n}=0)=\\frac{1}{2}$。设错误预测率为前 $N$ 个结果中错误预测所占比例的极限（如果存在），其中 $N \\to \\infty$。\n\n对此单一分支使用三种预测器：\n1. 一个1位预测器，它存储上一次观测到的结果，并总是预测下一次实例的结果与上次观测结果相同。观测到 $X_{n}$ 后，存储位更新为 $X_{n}$。\n2. 一个2位饱和计数器，有 4 个状态，索引为 0、1、2、3。其中状态 0 和 1 预测“不跳转”，状态 2 和 3 预测“跳转”。当观测到“跳转”结果时，计数器加 1，除非它已经是 3；当观测到“不跳转”结果时，计数器减 1，除非它已经是 0。\n3. 一个静态恒“跳转”预测器，它总是预测“跳转”。\n\n假设任何预测器的初始状态是任意但固定的，并考虑在所述 i.i.d. 分支结果模型下的稳态行为。计算1位预测器、2位饱和计数器预测器和静态恒“跳转”预测器的期望稳态错误预测率。将您的最终答案表示为单行矩阵 $\\bigl[m_{1\\text{-bit}} \\; m_{2\\text{-bit}} \\; m_{\\text{static}}\\bigr]$，其中每个条目是相应错误预测率的精确值，写成最简分数。无需四舍五入。",
            "solution": "该问题要求在一种特定的分支结果随机模型下，计算三种不同分支预测器的稳态错误预测率。分支结果形成一个独立同分布 (i.i.d.) 序列 $\\{X_n\\}_{n \\ge 1}$，其中 $X_n=1$ (跳转) 和 $X_n=0$ (不跳转) 发生的概率均为 $\\Pr(X_n=1) = \\Pr(X_n=0) = \\frac{1}{2}$。错误预测率定义为错误预测的长期平均比例。对于一个遍历系统，这等同于稳态下发生错误预测的期望概率。\n\n我们将分别分析每种预测器。\n\n1.  **1位预测器 ($m_{1\\text{-bit}}$)**\n\n    该预测器有两个状态，对应于上一次观测到的结果。设时间步 $t$ 的状态 $S_t$ 是时间步 $t-1$ 的分支结果，即 $S_t = X_{t-1}$。\n    - 状态 $S_{p,0}$：上一次结果为“不跳转” ($X_{t-1}=0$)。对 $X_t$ 的预测为“不跳转” ($0$)。\n    - 状态 $S_{p,1}$：上一次结果为“跳转” ($X_{t-1}=1$)。对 $X_t$ 的预测为“跳转” ($1$)。\n\n    这些状态之间的转换构成一个马尔可夫链。设 $\\pi_0$ 和 $\\pi_1$ 分别为处于状态 $S_{p,0}$ 和 $S_{p,1}$ 的稳态概率。\n    如果下一个结果是 $0$，系统从任何状态转换到 $S_{p,0}$，其发生概率为 $\\frac{1}{2}$。\n    如果下一个结果是 $1$，系统从任何状态转换到 $S_{p,1}$，其发生概率为 $\\frac{1}{2}$。\n\n    稳态平衡方程为：\n    $$ \\pi_0 = (\\pi_0 + \\pi_1) \\cdot \\Pr(X_n=0) = 1 \\cdot \\frac{1}{2} = \\frac{1}{2} $$\n    $$ \\pi_1 = (\\pi_0 + \\pi_1) \\cdot \\Pr(X_n=1) = 1 \\cdot \\frac{1}{2} = \\frac{1}{2} $$\n    总和为 $\\pi_0 + \\pi_1 = \\frac{1}{2} + \\frac{1}{2} = 1$，符合要求。因此，在稳态下，预测器处于任一状态的概率是相等的。\n\n    错误预测率 $m_{1\\text{-bit}}$ 是每个状态下错误预测概率的加权平均。\n    - 在状态 $S_{p,0}$，预测为 $0$。如果结果为 $1$，则发生错误预测。其概率为 $\\Pr(X_n=1) = \\frac{1}{2}$。\n    - 在状态 $S_{p,1}$，预测为 $1$。如果结果为 $0$，则发生错误预测。其概率为 $\\Pr(X_n=0) = \\frac{1}{2}$。\n\n    总错误预测率为：\n    $$ m_{1\\text{-bit}} = \\pi_0 \\cdot \\Pr(\\text{mispredict}|S_{p,0}) + \\pi_1 \\cdot \\Pr(\\text{mispredict}|S_{p,1}) $$\n    $$ m_{1\\text{-bit}} = \\frac{1}{2} \\cdot \\frac{1}{2} + \\frac{1}{2} \\cdot \\frac{1}{2} = \\frac{1}{4} + \\frac{1}{4} = \\frac{1}{2} $$\n\n2.  **2位饱和计数器预测器 ($m_{2\\text{-bit}}$)**\n\n    该预测器使用一个具有 $\\{0, 1, 2, 3\\}$ 索引状态的 4 状态机。\n    - 预测规则：状态 0、1 预测“不跳转” ($0$)。状态 2、3 预测“跳转” ($1$)。\n    - 更新规则：当结果为“跳转” ($1$) 时，状态 $i$ 转换到 $\\min(i+1, 3)$。当结果为“不跳转” ($0$) 时，状态 $i$ 转换到 $\\max(i-1, 0)$。\n\n    设 $\\pi_i$ 是处于状态 $i$ 的稳态概率。“跳转”和“不跳转”的转换概率均为 $\\frac{1}{2}$。稳态平衡方程为（令流入一个状态的流量等于流出该状态的流量）：\n    - 对于状态 $0$：流出为 $\\pi_0 \\cdot \\frac{1}{2}$ (到状态 $1$)。流入为 $\\pi_1 \\cdot \\frac{1}{2}$ (从状态 $1$) 和 $\\pi_0 \\cdot \\frac{1}{2}$ (从状态 $0$)。\n      $$ \\pi_0 \\cdot \\frac{1}{2} + \\pi_0 \\cdot \\frac{1}{2} = \\pi_0 \\cdot \\frac{1}{2} + \\pi_1 \\cdot \\frac{1}{2} \\implies \\pi_0 \\cdot \\frac{1}{2} = \\pi_1 \\cdot \\frac{1}{2} \\implies \\pi_0 = \\pi_1 $$\n    - 对于状态 $1$：流出为 $\\pi_1 \\cdot \\frac{1}{2} + \\pi_1 \\cdot \\frac{1}{2} = \\pi_1$。流入为从状态 $0$ ($\\pi_0 \\cdot \\frac{1}{2}$) 和状态 $2$ ($\\pi_2 \\cdot \\frac{1}{2}$)。\n      $$ \\pi_1 = \\pi_0 \\cdot \\frac{1}{2} + \\pi_2 \\cdot \\frac{1}{2} $$\n      代入 $\\pi_0 = \\pi_1$，我们得到 $\\pi_1 = \\pi_1 \\cdot \\frac{1}{2} + \\pi_2 \\cdot \\frac{1}{2}$，化简为 $\\pi_1 \\cdot \\frac{1}{2} = \\pi_2 \\cdot \\frac{1}{2}$，所以 $\\pi_1 = \\pi_2$。\n    - 对于状态 $3$：与状态 0 对称，流出为 $\\pi_3 \\cdot \\frac{1}{2}$ (到状态 $2$)。流入为从状态 $2$ ($\\pi_2 \\cdot \\frac{1}{2}$) 和从状态 $3$ ($\\pi_3 \\cdot \\frac{1}{2}$)。\n      $$ \\pi_3 = \\pi_2 \\cdot \\frac{1}{2} + \\pi_3 \\cdot \\frac{1}{2} \\implies \\pi_3 \\cdot \\frac{1}{2} = \\pi_2 \\cdot \\frac{1}{2} \\implies \\pi_3 = \\pi_2 $$\n\n    综合这些结果，我们得到 $\\pi_0 = \\pi_1 = \\pi_2 = \\pi_3$。\n    使用归一化条件 $\\sum_{i=0}^{3} \\pi_i = 1$：\n    $$ \\pi_0 + \\pi_1 + \\pi_2 + \\pi_3 = 4\\pi_0 = 1 \\implies \\pi_0 = \\frac{1}{4} $$\n    因此，$\\pi_0 = \\pi_1 = \\pi_2 = \\pi_3 = \\frac{1}{4}$。预测器处于四个状态中任何一个的概率都相等。\n\n    现在，我们计算错误预测率 $m_{2\\text{-bit}}$。\n    - 在状态 $0$ 和 $1$，预测为“不跳转” ($0$)。如果结果为“跳转” ($1$)，则发生错误预测，其概率为 $\\frac{1}{2}$。\n    - 在状态 $2$ 和 $3$，预测为“跳转” ($1$)。如果结果为“不跳转” ($0$)，则发生错误预测，其概率为 $\\frac{1}{2}$。\n\n    总错误预测率为：\n    $$ m_{2\\text{-bit}} = \\sum_{i=0}^{3} \\pi_i \\cdot \\Pr(\\text{mispredict}|\\text{state } i) $$\n    $$ m_{2\\text{-bit}} = (\\pi_0 + \\pi_1) \\cdot \\Pr(X_n=1) + (\\pi_2 + \\pi_3) \\cdot \\Pr(X_n=0) $$\n    $$ m_{2\\text{-bit}} = \\left(\\frac{1}{4} + \\frac{1}{4}\\right) \\cdot \\frac{1}{2} + \\left(\\frac{1}{4} + \\frac{1}{4}\\right) \\cdot \\frac{1}{2} $$\n    $$ m_{2\\text{-bit}} = \\frac{1}{2} \\cdot \\frac{1}{2} + \\frac{1}{2} \\cdot \\frac{1}{2} = \\frac{1}{4} + \\frac{1}{4} = \\frac{1}{2} $$\n\n3.  **静态恒“跳转”预测器 ($m_{\\text{static}}$)**\n\n    该预测器没有动态状态。它总是预测“跳转” ($1$)。\n    当且仅当实际分支结果为“不跳转” ($0$) 时，才会发生错误预测。\n    “不跳转”结果的概率为 $\\Pr(X_n=0) = \\frac{1}{2}$。\n    由于分支结果是独立同分布的，根据大数定律，错误预测的长期比例将收敛到这个概率。\n    因此，稳态错误预测率为：\n    $$ m_{\\text{static}} = \\Pr(X_n=0) = \\frac{1}{2} $$\n\n    最终结果是这三个率的整合。该问题突显了一个基本概念：对于一个概率相等的完全随机 i.i.d. 分支流，任何基于历史的预测器都无法比静态预测或随机猜测表现得更好，因为没有可供学习的模式。\n\n最终结果汇总：\n- $m_{1\\text{-bit}} = \\frac{1}{2}$\n- $m_{2\\text{-bit}} = \\frac{1}{2}$\n- $m_{\\text{static}} = \\frac{1}{2}$\n\n要求的答案是行矩阵 $\\bigl[m_{1\\text{-bit}} \\; m_{2\\text{-bit}} \\; m_{\\text{static}}\\bigr]$。\n$$ \\begin{pmatrix} \\frac{1}{2} & \\frac{1}{2} & \\frac{1}{2} \\end{pmatrix} $$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1}{2} & \\frac{1}{2} & \\frac{1}{2} \\end{pmatrix}}\n$$"
        }
    ]
}