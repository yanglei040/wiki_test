{
    "hands_on_practices": [
        {
            "introduction": "Loops form the backbone of many algorithms, and their branch-control instructions follow highly predictable patterns. This practice problem provides a foundational analysis of how 1-bit and 2-bit predictors handle the classic nested loop structure. By working through it, you will see precisely why the additional state in a 2-bit predictor significantly improves accuracy for loop-exit branches. ",
            "id": "3637231",
            "problem": "Consider the nested loops defined by the pseudo-code\nfor $i = 1$ to $m$:\n    for $j = 1$ to $n$:\n        body\nModel the two conditional backward branches that control these loops as follows: the inner loop’s exit test executes exactly $n$ times per outer iteration and produces the outcome sequence $\\mathrm{T}, \\mathrm{T}, \\dots, \\mathrm{T}, \\mathrm{NT}$ (that is, $\\mathrm{T}$ repeated $n-1$ times followed by $\\mathrm{NT}$ once), and the outer loop’s exit test executes exactly $m$ times over the full run and produces the outcome sequence $\\mathrm{T}$ repeated $m-1$ times followed by $\\mathrm{NT}$ once. Assume each static branch has its own dedicated predictor entry (no aliasing), and that there are no other branches. Assume $n \\geq 2$ and $m \\geq 2$.\n\nTwo dynamic branch predictors are considered, each maintaining state per static branch:\n1) A $1$-bit predictor that always predicts the last observed outcome and flips its bit on every misprediction. Its initial state for both branches is “predict $\\mathrm{NT}$.”\n2) A $2$-bit saturating counter predictor with $4$ states: Strongly Not Taken ($00$), Weakly Not Taken ($01$), Weakly Taken ($10$), Strongly Taken ($11$). The most significant bit determines the prediction ($0$ for $\\mathrm{NT}$, $1$ for $\\mathrm{T}$). On outcome $\\mathrm{T}$ the counter increments by $1$ up to saturation at $11$; on outcome $\\mathrm{NT}$ it decrements by $1$ down to saturation at $00$. Its initial state for both branches is Weakly Not Taken ($01$).\n\nStarting from these definitions and the loop outcome patterns, derive from first principles the total number of mispredictions over the entire execution of the nested loops for each predictor, summing the contributions from both the inner-loop and the outer-loop exit branches. Express your final answer as a single row matrix whose first entry is the total mispredictions under the $1$-bit predictor and whose second entry is the total mispredictions under the $2$-bit predictor. No rounding is required. Your final expressions should be in closed form in terms of $m$ and $n$.",
            "solution": "The problem has been validated and is deemed sound, well-posed, and scientifically grounded within the domain of computer organization and architecture. It provides a complete and consistent set of definitions and constraints to derive a unique solution. We proceed with the analysis.\n\nThe total number of mispredictions is the sum of mispredictions from the inner-loop branch and the outer-loop branch. We will analyze each predictor separately.\n\n### Analysis of the $1$-bit Predictor\n\nThe $1$-bit predictor has two states: Predict Taken ($\\mathrm{P_T}$) and Predict Not-Taken ($\\mathrm{P_{NT}}$). The predictor flips its state upon a misprediction. For both the inner and outer loop branches, the initial state is given as \"predict $\\mathrm{NT}$\", which corresponds to the state $\\mathrm{P_{NT}}$.\n\n#### Inner-Loop Branch with $1$-bit Predictor\nThe outcome sequence for the inner loop, $\\mathrm{T}, \\mathrm{T}, \\dots, \\mathrm{T}, \\mathrm{NT}$ ($n-1$ times $\\mathrm{T}$, followed by one $\\mathrm{NT}$), is executed $m$ times. We analyze the behavior for one full execution of this sequence.\n\nLet's trace the first outer-loop iteration ($i=1$):\n- The predictor for the inner loop branch starts in state $\\mathrm{P_{NT}}$.\n- **Execution 1:** The outcome is $\\mathrm{T}$. The prediction is $\\mathrm{NT}$. This is a **misprediction**. The state flips to $\\mathrm{P_T}$.\n- **Executions 2 to $n-1$:** The outcome is always $\\mathrm{T}$. The prediction is now $\\mathrm{T}$. These are all correct predictions. The state remains $\\mathrm{P_T}$.\n- **Execution $n$:** The outcome is $\\mathrm{NT}$. The prediction is $\\mathrm{T}$. This is a **misprediction**. The state flips back to $\\mathrm{P_{NT}}$.\n\nFor the first iteration of the outer loop, the inner-loop branch incurs $2$ mispredictions. At the end of this iteration, the predictor state is $\\mathrm{P_{NT}}$.\n\nFor every subsequent outer-loop iteration (from $i=2$ to $m$), the predictor for the inner-loop branch begins again in the state $\\mathrm{P_{NT}}$. The analysis is therefore identical for each of the $m$ outer-loop iterations. Each time the inner loop is executed, it produces exactly $2$ mispredictions.\n\nTotal mispredictions for the inner-loop branch over $m$ outer-loop iterations = $2 \\times m = 2m$.\n\n#### Outer-Loop Branch with $1$-bit Predictor\nThe outcome sequence for the outer-loop branch is $\\mathrm{T}, \\mathrm{T}, \\dots, \\mathrm{T}, \\mathrm{NT}$ ($m-1$ times $\\mathrm{T}$, followed by one $\\mathrm{NT}$). This sequence is executed once.\n\n- The predictor for the outer-loop branch starts in state $\\mathrm{P_{NT}}$.\n- **Execution 1:** The outcome is $\\mathrm{T}$. The prediction is $\\mathrm{NT}$. This is a **misprediction**. The state flips to $\\mathrm{P_T}$.\n- **Executions 2 to $m-1$:** The outcome is always $\\mathrm{T}$. The prediction is $\\mathrm{T}$. These are all correct predictions. The state remains $\\mathrm{P_T}$.\n- **Execution $m$:** The outcome is $\\mathrm{NT}$. The prediction is $\\mathrm{T}$. This is a **misprediction**. The state flips back to $\\mathrm{P_{NT}}$.\n\nThe total number of mispredictions for the outer-loop branch is $2$.\n\n#### Total Mispredictions for the $1$-bit Predictor\nThe total number of mispredictions, $M_1$, is the sum of mispredictions from both branches.\n$$M_1 = (\\text{inner-loop mispredictions}) + (\\text{outer-loop mispredictions}) = 2m + 2$$\n\n### Analysis of the $2$-bit Saturating Counter Predictor\n\nThe $2$-bit predictor uses a $4$-state saturating counter: $00$ (Strongly Not Taken, $\\mathrm{SN}$), $01$ (Weakly Not Taken, $\\mathrm{WN}$), $10$ (Weakly Taken, $\\mathrm{WT}$), and $11$ (Strongly Taken, $\\mathrm{ST}$). The prediction is $\\mathrm{NT}$ for states $00$ and $01$ (MSB is $0$), and $\\mathrm{T}$ for states $10$ and $11$ (MSB is $1$). On a $\\mathrm{T}$ outcome, the counter increments (saturating at $11$); on an $\\mathrm{NT}$ outcome, it decrements (saturating at $00$). The initial state for both branches is $01$ ($\\mathrm{WN}$).\n\n#### Inner-Loop Branch with $2$-bit Predictor\nWe trace the behavior for the first and subsequent outer-loop iterations.\n\nFor the first outer-loop iteration ($i=1$):\n- The predictor starts in state $01$ ($\\mathrm{WN}$), predicting $\\mathrm{NT}$.\n- **Execution 1:** Outcome is $\\mathrm{T}$. Prediction is $\\mathrm{NT}$. This is a **misprediction**. The state increments to $10$ ($\\mathrm{WT}$).\n- **Execution 2:** Outcome is $\\mathrm{T}$. The state is $10$ ($\\mathrm{WT}$), predicting $\\mathrm{T}$. This is a correct prediction. The state increments to $11$ ($\\mathrm{ST}$).\n- **Executions 3 to $n-1$:** Outcome is $\\mathrm{T}$. The state is $11$ ($\\mathrm{ST}$), predicting $\\mathrm{T}$. These are all correct predictions. The state remains $11$ due to saturation.\n- **Execution $n$:** Outcome is $\\mathrm{NT}$. The state is $11$ ($\\mathrm{ST}$), predicting $\\mathrm{T}$. This is a **misprediction**. The state decrements to $10$ ($\\mathrm{WT}$).\n\nFor the first iteration of the outer loop ($i=1$), the inner-loop branch incurs $2$ mispredictions. The predictor state at the end of this iteration is $10$ ($\\mathrm{WT}$).\n\nFor the second outer-loop iteration ($i=2$):\n- The predictor starts in the state left from the previous iteration, which is $10$ ($\\mathrm{WT}$), predicting $\\mathrm{T}$.\n- **Execution 1:** Outcome is $\\mathrm{T}$. Prediction is $\\mathrm{T}$. This is a correct prediction. The state increments to $11$ ($\\mathrm{ST}$).\n- **Executions 2 to $n-1$:** Outcome is $\\mathrm{T}$. State is $11$ ($\\mathrm{ST}$), predicting $\\mathrm{T}$. These are all correct predictions. State remains $11$.\n- **Execution $n$:** Outcome is $\\mathrm{NT}$. State is $11$ ($\\mathrm{ST}$), predicting $\\mathrm{T}$. This is a **misprediction**. The state decrements to $10$ ($\\mathrm{WT}$).\n\nFor the second iteration ($i=2$), there is only $1$ misprediction. The predictor state is again $10$ ($\\mathrm{WT}$) at the end.\nThis pattern repeats for all subsequent iterations from $i=2$ to $m$. Each of these $m-1$ iterations will start in state $10$ and incur exactly $1$ misprediction.\n\nTotal mispredictions for the inner-loop branch:\n$$(\\text{mispredictions for } i=1) + (\\text{mispredictions for } i=2 \\text{ to } m)$$\n$$2 + (m-1) \\times 1 = 2 + m - 1 = m+1$$\n\n#### Outer-Loop Branch with $2$-bit Predictor\nThe outcome sequence is $\\mathrm{T}, \\mathrm{T}, \\dots, \\mathrm{T}, \\mathrm{NT}$ ($m-1$ times $\\mathrm{T}$, one $\\mathrm{NT}$).\n- The predictor starts in state $01$ ($\\mathrm{WN}$), predicting $\\mathrm{NT}$.\n- **Execution 1:** Outcome is $\\mathrm{T}$. Prediction is $\\mathrm{NT}$. This is a **misprediction**. The state increments to $10$ ($\\mathrm{WT}$).\n- **Execution 2:** Outcome is $\\mathrm{T}$. State is $10$ ($\\mathrm{WT}$), predicting $\\mathrm{T}$. This is a correct prediction. The state increments to $11$ ($\\mathrm{ST}$). This holds because $m \\geq 2$.\n- **Executions 3 to $m-1$:** Outcome is $\\mathrm{T}$. State is $11$ ($\\mathrm{ST}$), predicting $\\mathrm{T}$. These are all correct predictions. State remains $11$.\n- **Execution $m$:** Outcome is $\\mathrm{NT}$. State is $11$ ($\\mathrm{ST}$), predicting $\\mathrm{T}$. This is a **misprediction**. The state decrements to $10$ ($\\mathrm{WT}$).\n\nThe total number of mispredictions for the outer-loop branch is $2$.\n\n#### Total Mispredictions for the $2$-bit Predictor\nThe total number of mispredictions, $M_2$, is the sum of mispredictions from both branches.\n$$M_2 = (\\text{inner-loop mispredictions}) + (\\text{outer-loop mispredictions}) = (m+1) + 2 = m+3$$\n\n### Summary\n- Total mispredictions for the $1$-bit predictor: $M_1 = 2m + 2$.\n- Total mispredictions for the $2$-bit predictor: $M_2 = m + 3$.\n\nThe final answer is presented as a row matrix $[M_1, M_2]$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2m+2 & m+3\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Beyond simple loops, branches can exhibit various repeating behaviors, creating predictable streams of outcomes. This exercise challenges you to generalize your analysis to any periodic pattern of 'Taken' and 'Not Taken' results. Mastering this problem will equip you to calculate steady-state misprediction rates for any regular branch stream, revealing the fundamental learning capabilities of 1-bit and 2-bit predictors. ",
            "id": "3637265",
            "problem": "A single static conditional branch is encountered repeatedly in a program. Its outcomes follow a periodic pattern: the branch is Taken for $a$ consecutive executions, then Not Taken for $b$ consecutive executions, and this pattern $T^{a}N^{b}$ repeats indefinitely. Assume $a$ and $b$ are positive integers. Consider two dynamic branch predictors:\n\n1. A $1$-bit last-outcome predictor that always predicts the next outcome to be equal to the most recent outcome. Initialize it so that its first prediction before the very first outcome is Not Taken.\n\n2. A $2$-bit saturating counter predictor with four states: Strongly Not Taken ($0$), Weakly Not Taken ($1$), Weakly Taken ($2$), and Strongly Taken ($3$). The predictor predicts Not Taken when in states $0$ or $1$, and predicts Taken when in states $2$ or $3$. On an actual Taken outcome, the counter is incremented by $1$ unless already at $3$; on an actual Not Taken outcome, the counter is decremented by $1$ unless already at $0$. Initialize the counter at Strongly Not Taken ($0$) before the very first outcome.\n\nStarting from these initializations and allowing the pattern to repeat indefinitely so that any initial transient is negligible, derive closed-form analytic expressions for the steady-state average misprediction rate per outcome over one full period, as functions of $a$ and $b$, for both predictors. Express each misprediction rate as a dimensionless fraction in terms of $a$ and $b$. The final answer must be a calculation and consist of the two expressions, one for each predictor. No rounding is required.",
            "solution": "The problem requires the derivation of steady-state average misprediction rates for two types of dynamic branch predictors given a periodic branch outcome pattern. The pattern consists of $a$ consecutive Taken ($T$) outcomes followed by $b$ consecutive Not Taken ($N$) outcomes, repeating as $T^aN^b$. The total number of outcomes in one full period is $a+b$. The average misprediction rate is the total number of mispredictions in one steady-state period divided by the total number of outcomes in that period.\n\n**1. Analysis of the $1$-bit Last-Outcome Predictor**\n\nThis predictor has two states, which can be represented by the last outcome: $T$ or $N$. The prediction for the next branch is a repeat of the last outcome. We are asked for the steady-state rate, which means we can analyze a single $T^aN^b$ cycle assuming the system has already passed through any initial transients. The state of the predictor at the beginning of a cycle is determined by the last outcome of the previous cycle.\n\nLet's analyze a single steady-state period $T_1, T_2, \\dots, T_a, N_1, N_2, \\dots, N_b$.\nThe outcome preceding this period is $N_b$ from the previous cycle. Thus, the predictor's state before observing $T_1$ is $N$.\n\n- **For the $T^a$ sequence:**\n  - The first branch is $T_1$. The predictor state is $N$, so it predicts Not Taken. The actual outcome is Taken. This is a **misprediction**. The predictor's state updates to $T$.\n  - For the subsequent $a-1$ branches ($T_2, \\dots, T_a$), the predictor state is $T$. It correctly predicts Taken for each of these branches.\n  - Number of mispredictions in the $T^a$ sequence: $1$. This holds for any positive integer $a \\ge 1$.\n\n- **For the $N^b$ sequence:**\n  - This sequence begins after the last Taken branch, $T_a$. The predictor's state is now $T$.\n  - The first branch of this sequence is $N_1$. The predictor state is $T$, so it predicts Taken. The actual outcome is Not Taken. This is a **misprediction**. The predictor's state updates to $N$.\n  - For the subsequent $b-1$ branches ($N_2, \\dots, N_b$), the predictor state is $N$. It correctly predicts Not Taken for each of these branches.\n  - Number of mispredictions in the $N^b$ sequence: $1$. This holds for any positive integer $b \\ge 1$.\n\nIn one full steady-state period, there is exactly one misprediction at the start of the Taken block and one at the start of the Not Taken block.\nTotal mispredictions per period, $M_1 = 1 + 1 = 2$.\nThe total number of outcomes per period is $a+b$.\nThe steady-state misprediction rate for the $1$-bit predictor, $R_1$, is:\n$$R_1 = \\frac{M_1}{a+b} = \\frac{2}{a+b}$$\n\n**2. Analysis of the $2$-bit Saturating Counter Predictor**\n\nThis predictor uses a $4$-state counter: $0$ (Strongly Not Taken, SN), $1$ (Weakly Not Taken, WN), $2$ (Weakly Taken, WT), and $3$ (Strongly Taken, ST).\n- Prediction: Not Taken for states $0, 1$; Taken for states $2, 3$.\n- State update: On a Taken outcome, state $C$ becomes $\\min(C+1, 3)$. On a Not Taken outcome, state $C$ becomes $\\max(C-1, 0)$.\n\nTo find the steady-state misprediction rate, we first must determine the state of the counter at the beginning of a period. Let $C_{start}$ be the counter's state at the start of the $T^a$ sequence. In a steady state, this must be the state after the preceding $N^b$ sequence has completed. Let $C_{mid}$ be the state after the $T^a$ sequence.\n\nThe state transitions over a full cycle are:\n1. After $a$ Taken outcomes, the state transitions from $C_{start}$ to $C_{mid} = \\min(3, C_{start} + a)$.\n2. After $b$ Not Taken outcomes, the state transitions from $C_{mid}$ back to $C_{start} = \\max(0, C_{mid} - b)$.\n\nCombining these gives a fixed-point equation for the steady-state starting state $C_{start}$:\n$$C_{start} = \\max(0, \\min(3, C_{start} + a) - b)$$\nWe solve for $C_{start}$ (which must be an integer in $\\{0, 1, 2, 3\\}$) by considering cases for $a$ and $b$. A stable fixed point $C_{start}$ is reached if $C_{start}' = \\max(0, \\min(3, C_{start} + a) - b)$ implies $C_{start}' = C_{start}$.\nAnalysis of this equation yields the following steady-state starting states:\n- If $b=1, a \\ge 2$: $C_{start}=2$.\n- If $b=2, a \\ge 3$: $C_{start}=1$.\n- Otherwise: $C_{start}=0$. This covers the cases ($a=1, \\forall b \\ge 1$), ($a=2, b \\ge 2$), and ($a \\ge 3, b \\ge 3$).\n\nWith $C_{start}$ determined, we can calculate the number of mispredictions in each part of the cycle.\n- Mispredictions during the $T^a$ sequence ($M_T$): These occur when the predictor state is $0$ or $1$. Starting from $C_{start}$, the state increments with each Taken branch. The number of mispredictions is the number of steps it takes for the state to reach $2$.\n  - If $C_{start}=0$, states are $0 \\to 1 \\to 2 \\dots$. Mispredictions occur for the first two branches (if $a \\ge 2$). $M_T = \\min(a, 2)$.\n  - If $C_{start}=1$, states are $1 \\to 2 \\to 3 \\dots$. One misprediction occurs for the first branch. $M_T = 1$ (since $a \\ge 1$).\n  - If $C_{start} \\ge 2$, the predictor is already in a \"Taken\" state, so there are no mispredictions. $M_T = 0$.\n\n- Mispredictions during the $N^b$ sequence ($M_N$): These occur when the predictor state is $2$ or $3$. The state at the start of this sequence is $C_{mid} = \\min(3, C_{start}+a)$. The number of mispredictions is the number of steps it takes for the state to decrement to $1$.\n  - If $C_{mid}=3$, states are $3 \\to 2 \\to 1 \\dots$. Mispredictions occur for the first two branches (if $b \\ge 2$). $M_N = \\min(b, 2)$.\n  - If $C_{mid}=2$, states are $2 \\to 1 \\to 0 \\dots$. One misprediction occurs for the first branch. $M_N = 1$ (since $b \\ge 1$).\n  - If $C_{mid} \\le 1$, the predictor is already in a \"Not Taken\" state, so there are no mispredictions. $M_N = 0$.\n\nNow we compute the total mispredictions, $M_2 = M_T+M_N$, for each case of $(a,b)$:\n\n- **Case A: $a=1, \\forall b \\ge 1$.**\n  $C_{start}=0$, so $C_{mid}=\\min(3, 0+1)=1$.\n  $M_T = \\min(1,2)=1$. $M_N=0$ since $C_{mid}=1$.\n  $M_2 = 1+0=1$.\n\n- **Case B: $b=1, a \\ge 2$.**\n  $C_{start}=2$, so $C_{mid}=\\min(3, 2+a)=3$ (since $a\\ge2$).\n  $M_T = 0$ since $C_{start}=2$. $M_N=\\min(1,2)=1$.\n  $M_2 = 0+1=1$.\n\n- **Case C: $a=2, b \\ge 2$.**\n  $C_{start}=0$, so $C_{mid}=\\min(3, 0+2)=2$.\n  $M_T = \\min(2,2)=2$. $M_N=1$ since $C_{mid}=2$.\n  $M_2 = 2+1=3$.\n\n- **Case D: $a \\ge 3, b=2$.**\n  $C_{start}=1$, so $C_{mid}=\\min(3, 1+a)=3$ (since $a\\ge3$).\n  $M_T=1$ since $C_{start}=1$. $M_N=\\min(2,2)=2$.\n  $M_2 = 1+2=3$.\n\n- **Case E: $a \\ge 3, b \\ge 3$.**\n  $C_{start}=0$, so $C_{mid}=\\min(3, 0+a)=3$ (since $a\\ge3$).\n  $M_T=\\min(a,2)=2$. $M_N=\\min(b,2)=2$.\n  $M_2 = 2+2=4$.\n\nThe total number of mispredictions, $M_2$, can be summarized as a piecewise function of $a$ and $b$:\n$$M_2(a,b) = \\begin{cases} 1 & \\text{if } a=1 \\text{ or } b=1 \\\\ 3 & \\text{if } (a=2, b \\ge 2) \\text{ or } (a \\ge 3, b=2) \\\\ 4 & \\text{if } a \\ge 3 \\text{ and } b \\ge 3 \\end{cases}$$\nThe misprediction rate for the $2$-bit predictor, $R_2$, is therefore:\n$$R_2 = \\frac{M_2(a,b)}{a+b}$$\n\nThe two required expressions are $R_1$ and $R_2$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\frac{2}{a+b} \\\\\n\\frac{1}{a+b} \\times \\begin{cases} 1 & \\text{if } a=1 \\text{ or } b=1 \\\\ 3 & \\text{if } (a=2 \\text{ and } b \\ge 2) \\text{ or } (a \\ge 3 \\text{ and } b=2) \\\\ 4 & \\text{if } a \\ge 3 \\text{ and } b \\ge 3 \\end{cases}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "Real-world branch predictors have finite history tables, leading to multiple branch instructions sharing the same prediction entry—a phenomenon known as aliasing. This exercise simulates this critical effect, where two perfectly periodic branches interfere with each other in a single predictor entry. Analyzing this scenario demonstrates how resource contention can degrade performance and underscores that predictor accuracy depends on both the prediction algorithm and its interaction with the code's structure. ",
            "id": "3637242",
            "problem": "Consider a bimodal dynamic branch predictor whose Pattern History Table (PHT) consists of a single entry shared by two static conditional branches, denoted $B_1$ and $B_2$. The processor executes these two branches in strict alternation: $B_1, B_2, B_1, B_2, \\ldots$, and the predictor uses only the shared PHT entry’s current state to predict each branch and then updates that same state after each branch resolves. Two predictor designs are to be compared:\n\n- A $1$-bit predictor that stores the last observed outcome: it predicts $T$ (taken) if the bit is $1$ and $N$ (not taken) if the bit is $0$, and sets the bit to $1$ on a $T$ outcome and to $0$ on an $N$ outcome.\n\n- A $2$-bit saturating-counter predictor with four states: $\\{00, 01, 10, 11\\}$ interpreted as strongly-not-taken, weakly-not-taken, weakly-taken, strongly-taken, respectively. It predicts $T$ if the most significant bit is $1$ and $N$ otherwise, increments the counter by $1$ on a $T$ outcome and decrements by $1$ on an $N$ outcome, saturating at the extremes.\n\nBranch $B_1$ is periodic with period $1$ and has outcome $T$ on every occurrence. Branch $B_2$ is periodic with period $3$ and has outcomes repeating as $T, N, N$. Both branches alias to the same single PHT entry. Define the phase of $B_2$ as the index in its period to which its first dynamic instance is aligned in the alternating execution.\n\nStarting from any initial PHT state, consider the steady-state (long-run) behavior ignoring cold-start transients. Over one superperiod of the interleaved execution, defined as $2 \\times \\mathrm{lcm}(1, 3)$ dynamic branches, choose the phase of $B_2$ that maximizes the steady-state misprediction rate of the $1$-bit predictor (if multiple phases tie, any maximizing phase may be chosen). Under that worst-case phase alignment, compute the exact ratio $R$ of the steady-state misprediction rate of the $1$-bit predictor to that of the $2$-bit predictor. Express $R$ as a simplified fraction with no units. No rounding is required.",
            "solution": "First, we establish the framework for the analysis. The execution pattern is a strict alternation of branches $B_1$ and $B_2$. The outcome of $B_1$ is always Taken ($T$). The outcome of $B_2$ follows a repeating pattern of $(T, N, N)$, where $N$ is Not-Taken. The combined behavior is periodic. The length of one superperiod, over which the combined pattern of branch outcomes repeats, is given by $2 \\times \\mathrm{lcm}(P_1, P_2)$, where $P_1=1$ is the period of $B_1$ and $P_2=3$ is the period of $B_2$. Thus, the superperiod consists of $2 \\times \\mathrm{lcm}(1, 3) = 6$ dynamic branch executions: $(B_1, B_2, B_1, B_2, B_1, B_2)$.\n\nThe phase of $B_2$ determines which outcome from its $(T, N, N)$ cycle corresponds to its first appearance in the superperiod. There are three possible phases, leading to three distinct 6-branch outcome sequences.\n- Phase $0$: $B_2$ outcomes are $(T, N, N)$. The full sequence is $(B_1:T, B_2:T, B_1:T, B_2:N, B_1:T, B_2:N)$.\n- Phase $1$: $B_2$ outcomes are $(N, T, N)$. The full sequence is $(B_1:T, B_2:N, B_1:T, B_2:T, B_1:T, B_2:N)$.\n- Phase $2$: $B_2$ outcomes are $(N, N, T)$. The full sequence is $(B_1:T, B_2:N, B_1:T, B_2:N, B_1:T, B_2:T)$.\n\nThe problem requires us to first find the phase that maximizes the misprediction rate of a $1$-bit predictor. A $1$-bit predictor has two states, which we can label $0$ (for $N$) and $1$ (for $T$). The prediction is equal to the current state, and the state is updated to reflect the actual outcome of the branch. We analyze the steady-state behavior, which implies we must find a repeating cycle of predictor states. Let $S_i$ be the state of the predictor before branch $i$.\n\nAnalysis of the $1$-bit predictor:\n- Phase $0$: Outcome sequence $(T, T, T, N, T, N)$.\n    Let's find the steady-state cycle. The state before the next branch is the outcome of the previous branch. The outcome before the superperiod starts is the last outcome of the previous superperiod, which is $N$. So the starting state is $0$.\n    The steady-state sequence of predictor states before each prediction is $(0, 1, 1, 1, 0, 1)$.\n    The predictions are $(N, T, T, T, N, T)$.\n    The actual outcomes are $(T, T, T, N, T, N)$.\n    Comparing predictions to outcomes: Mispredictions on branches 1, 4, 5, 6. Total mispredictions: $4$. Rate: $\\frac{4}{6} = \\frac{2}{3}$.\n\n- Phase $1$: Outcome sequence $(T, N, T, T, T, N)$.\n    The steady-state starting state is $0$ (from previous outcome $N$).\n    The steady-state sequence of predictor states is $(0, 1, 0, 1, 1, 1)$.\n    The predictions are $(N, T, N, T, T, T)$.\n    The actual outcomes are $(T, N, T, T, T, N)$.\n    Mispredictions on branches 1, 2, 3, 6. Total mispredictions: $4$. Rate: $\\frac{4}{6} = \\frac{2}{3}$.\n\n- Phase $2$: Outcome sequence $(T, N, T, N, T, T)$.\n    The steady-state starting state is $1$ (from previous outcome $T$).\n    The steady-state sequence of predictor states is $(1, 1, 0, 1, 0, 1)$.\n    The predictions are $(T, T, N, T, N, T)$.\n    The actual outcomes are $(T, N, T, N, T, T)$.\n    Mispredictions on branches 2, 3, 4, 5. Total mispredictions: $4$. Rate: $\\frac{4}{6} = \\frac{2}{3}$.\n\nFor all three phases, the steady-state misprediction rate of the $1$-bit predictor is $\\frac{2}{3}$. Therefore, the maximum rate is $\\frac{2}{3}$, and we can choose any phase for the next step. Let's select Phase $0$. The misprediction rate for the $1$-bit predictor is $P_{\\text{1-bit}} = \\frac{2}{3}$.\n\nNext, we analyze the $2$-bit saturating-counter predictor for Phase $0$. The outcome sequence is $(T, T, T, N, T, N)$. The predictor has four states, which we represent numerically as $\\{0, 1, 2, 3\\}$ for $\\{00, 01, 10, 11\\}$ (SNT, WNT, WT, ST). A prediction is $N$ for states $\\{0, 1\\}$ and $T$ for states $\\{2, 3\\}$. The state is incremented for a $T$ outcome (saturating at $3$) and decremented for an $N$ outcome (saturating at $0$).\n\nAnalysis of the $2$-bit predictor with Phase $0$ outcomes $(T, T, T, N, T, N)$:\nWe must find the steady-state cycle of a state $S \\in \\{0, 1, 2, 3\\}$. Let $S_i$ be the state before branch $i$. $S_{i+1} = \\min(3, S_i+1)$ if outcome is $T$, and $S_{i+1} = \\max(0, S_i-1)$ if outcome is $N$. Let's trace the state transitions to find a cycle where $S_0 = S_6$.\nStart with $S_0=0$:\n$S_1 = \\min(3, 0+1) = 1$ (after 1st $T$)\n$S_2 = \\min(3, 1+1) = 2$ (after 2nd $T$)\n$S_3 = \\min(3, 2+1) = 3$ (after 3rd $T$)\n$S_4 = \\max(0, 3-1) = 2$ (after 1st $N$)\n$S_5 = \\min(3, 2+1) = 3$ (after 4th $T$)\n$S_6 = \\max(0, 3-1) = 2$ (after 2nd $N$)\nSince $S_6=2 \\neq S_0=0$, this was a transient. Let's start the next cycle with $S'_0 = S_6 = 2$.\n$S'_1 = \\min(3, 2+1) = 3$\n$S'_2 = \\min(3, 3+1) = 3$\n$S'_3 = \\min(3, 3+1) = 3$\n$S'_4 = \\max(0, 3-1) = 2$\n$S'_5 = \\min(3, 2+1) = 3$\n$S'_6 = \\max(0, 3-1) = 2$\nHere, $S'_6 = 2 = S'_0$. This is the steady-state cycle. The sequence of states before each prediction is $(2, 3, 3, 3, 2, 3)$.\n\nNow we count mispredictions for this steady-state cycle:\nThe state sequence is $(2, 3, 3, 3, 2, 3)$.\nThe prediction is $T$ if state is $2$ or $3$. So, all predictions are $T$.\nThe prediction sequence is $(T, T, T, T, T, T)$.\nThe actual outcome sequence is $(T, T, T, N, T, N)$.\nComparing predictions to outcomes: Mispredictions on branches 4 and 6. Total mispredictions: $2$. The misprediction rate for the $2$-bit predictor is $P_{\\text{2-bit}} = \\frac{2}{6} = \\frac{1}{3}$.\n\nFinally, we compute the ratio $R$ of the steady-state misprediction rate of the $1$-bit predictor to that of the $2$-bit predictor under the worst-case phase alignment for the $1$-bit predictor.\n$$R = \\frac{P_{\\text{1-bit}}}{P_{\\text{2-bit}}} = \\frac{2/3}{1/3}$$\n$$R = 2$$\nThe ratio is $2$. Expressed as a simplified fraction, this is simply $2$.",
            "answer": "$$\\boxed{2}$$"
        }
    ]
}