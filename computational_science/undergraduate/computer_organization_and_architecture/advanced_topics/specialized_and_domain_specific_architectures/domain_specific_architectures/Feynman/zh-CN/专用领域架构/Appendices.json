{
    "hands_on_practices": [
        {
            "introduction": "脉动阵列是专用领域架构（DSA）中的一个关键构件，尤其适用于加速矩阵运算。本练习将引导你分析将一个通用矩阵乘法（GEMM）问题映射到固定大小的脉动阵列上时的计算效率 。通过推导处理器单元（PE）的利用率，你将学会如何量化问题规模与硬件尺寸不匹配时所带来的性能损失，这是评估和优化加速器性能的一项基本技能。",
            "id": "3636753",
            "problem": "领域特定架构（Domain-Specific Architecture, DSA）通过塑造其数据路径和存储层次结构以适应计算的结构，从而专门用于加速一类狭义定义的计算。考虑一个固定空间维度为 $m \\times n$ 的 Systolic Array (SA)，用于加速 General Matrix–Matrix Multiply (GEMM)，其中 $C = A \\cdot B$，$A \\in \\mathbb{R}^{r \\times k}$ 且 $B \\in \\mathbb{R}^{k \\times c}$。该 SA 由 $m \\times n$ 个相同的处理单元（Processing Elements, PEs）组成。在标准数据流中，每个 PE 在 $k$ 个乘累加步骤中累加 $C$ 的一个元素，并且该阵列执行一系列空间分块（spatial tiles），直到产生 $C$ 的所有 $r \\times c$ 个输出。假设 $r$ 和 $c$ 分别不是 $m$ 和 $n$ 的倍数。\n\n将时间平均 PE 利用率定义为所有 PE 执行的有效乘累加操作数与调度 SA 执行整个 GEMM 过程中所消耗的总乘累加能力之比。假设以下条件成立，这与广泛使用的 SA GEMM 映射一致：\n- 每个空间分块都会为整个 $m \\times n$ 阵列调度 $k$ 个累加周期，无论在部分边缘分块中某些 PE 是否没有有效的输出要产生。\n- 在 $k$ 个累加周期之外的控制和重配置开销与 $k$ 相比可以忽略不计。\n- 数据传输的调度方式使得每个分块的 $k$ 个累加周期不会因跨分块的流水线填充和排空效应而缩短或延长。\n\n从这些定义和 GEMM 的基本结构出发，推导在 $r$ 和 $c$ 不是 $m$ 和 $n$ 的倍数的情况下的利用率。提出一种在固定的 $m \\times n$ SA 下最大化 PE 利用率的填充或分块方法，并将可实现的最大利用率表示为关于 $r, c, m, n$ 的单一闭式解析表达式。你的最终答案必须是单一表达式。不要在最终答案中提供中间公式。不需要四舍五入，最终答案中也不报告单位。",
            "solution": "该问题要求推导执行 General Matrix-Matrix Multiply (GEMM) 的 Systolic Array (SA) 的时间平均 Processing Element (PE) 利用率，并确定一种最大化此利用率的策略。\n\n首先，对给定问题进行验证。\n\n**步骤 1：提取已知条件**\n- **架构**：一个固定空间维度为 $m \\times n$ 的 Systolic Array (SA)。它由 $m \\times n$ 个相同的 Processing Elements (PEs) 组成。\n- **计算**：General Matrix-Matrix Multiply (GEMM)，$C = A \\cdot B$。\n- **矩阵维度**：$A \\in \\mathbb{R}^{r \\times k}$ 且 $B \\in \\mathbb{R}^{k \\times c}$，得到 $C \\in \\mathbb{R}^{r \\times c}$。\n- **条件**：$r$ 不是 $m$ 的倍数，且 $c$ 不是 $n$ 的倍数。\n- **数据流**：每个 PE 在 $k$ 个乘累加（MAC）步骤中累加 $C$ 的一个元素。\n- **分块**：SA 通过执行一系列大小为 $m \\times n$ 的空间分块来计算 $r \\times c$ 的输出矩阵 $C$。\n- **利用率的定义**：时间平均 PE 利用率是有效 MAC 操作数与消耗的总 MAC 能力之比。\n- **假设 1**：每个空间分块，包括边缘的部分分块，都为整个 $m \\times n$ 阵列调度整整 $k$ 个累加周期。\n- **假设 2**：控制和重配置开销可以忽略不计。\n- **假设 3**：跨分块的数据传输流水线效应不会改变每个分块的 $k$ 个累加周期。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据**：该问题具有科学依据。用于 GEMM 的、采用输出固定式分块（output-stationary tiling）的脉动阵列模型是计算机体系结构和高性能计算中的一个典型例子。关于调度部分分块和忽略开销的假设是对此类加速器进行性能建模时使用的标准简化。\n- **适定性**：该问题是适定的。定义、变量和约束都已明确说明，可以导出一个唯一的解析解。目标定义清晰。\n- **客观性**：问题以精确、客观的语言陈述，没有歧义或主观论断。\n\n**步骤 3：结论与行动**\n- **结论**：该问题有效。它是领域特定架构分析中的一个标准的、可形式化的问题。\n- **行动**：继续推导解答。\n\n**PE 利用率的推导**\n\n时间平均 PE 利用率 $U$ 定义为：\n$$U = \\frac{\\text{总有效 MAC 操作数}}{\\text{消耗的总 MAC 能力}}$$\n\n我们将分别推导分子和分母的表达式。\n\n**分子：总有效 MAC 操作数**\n计算是矩阵乘积 $C = A \\cdot B$，其中 $A$ 是一个 $r \\times k$ 矩阵，$B$ 是一个 $k \\times c$ 矩阵。结果矩阵 $C$ 的维度为 $r \\times c$。矩阵 $C$ 的每个元素 $C_{ij}$ 是 $A$ 的第 $i$ 行与 $B$ 的第 $j$ 列的内积：\n$$C_{ij} = \\sum_{p=1}^{k} A_{ip} B_{pj}$$\n对于输出矩阵 $C$ 中的 $r \\times c$ 个元素中的每一个，该计算需要 $k$ 次乘法和 $k-1$ 次加法。这对应于 $k$ 次乘累加（MAC）操作。\n因此，计算整个矩阵 $C$ 所需的有效 MAC 操作总数为：\n$$\\text{Total Useful MACs} = (r \\times c) \\times k = rck$$\n\n**分母：消耗的总 MAC 能力**\n该 SA 的维度为 $m \\times n$，它通过将 $r \\times c$ 的输出矩阵分解为大小为 $m \\times n$ 的分块来处理。\n为了用高度为 $m$ 的分块覆盖矩阵 $C$ 的 $r$ 行，沿行维度所需的分块数量为 $\\lceil \\frac{r}{m} \\rceil$。\n同样，为了用宽度为 $n$ 的分块覆盖矩阵 $C$ 的 $c$ 列，沿列维度所需的分块数量为 $\\lceil \\frac{c}{n} \\rceil$。\n覆盖整个 $r \\times c$ 输出空间所需的空间分块总数 $N_{\\text{tiles}}$ 是这两个量的乘积：\n$$N_{\\text{tiles}} = \\left\\lceil \\frac{r}{m} \\right\\rceil \\times \\left\\lceil \\frac{c}{n} \\right\\rceil$$\n根据问题的明确假设，每个分块都会占用整个 $m \\times n$ 的 PE 阵列，持续 $k$ 个 MAC 周期，无论它是完整分块还是部分边缘分块。\nSA 执行单个分块的 MAC 能力是 PE 数量乘以周期数：\n$$\\text{Capacity per Tile} = (m \\times n) \\times k = mnk$$\n整个 GEMM 操作消耗的总 MAC 能力是每个分块的能力乘以总分块数：\n$$\\text{Total MAC Capacity Consumed} = N_{\\text{tiles}} \\times (\\text{Capacity per Tile}) = \\left( \\left\\lceil \\frac{r}{m} \\right\\rceil \\left\\lceil \\frac{c}{n} \\right\\rceil \\right) (mnk)$$\n\n**利用率表达式与最大化**\n将分子和分母的表达式代入利用率公式：\n$$U = \\frac{rck}{mnk \\left\\lceil \\frac{r}{m} \\right\\rceil \\left\\lceil \\frac{c}{n} \\right\\rceil}$$\n代表累加深度的项 $k$ 在有效工作量和每个分块消耗的能力中都是共有的，因此可以消去：\n$$U = \\frac{rc}{mn \\left\\lceil \\frac{r}{m} \\right\\rceil \\left\\lceil \\frac{c}{n} \\right\\rceil}$$\n问题要求提出一种填充或分块方法来最大化此利用率。分子 $r \\times c$ 是给定问题实例的固定有效工作量。SA 的维度 $m$ 和 $n$ 也是固定的。为了最大化 $U$，必须最小化分母。这等同于最小化与总分块数对应的项 $N_{\\text{tiles}} = \\lceil \\frac{r}{m} \\rceil \\lceil \\frac{c}{n} \\rceil$。\n\n覆盖 $r \\times c$ 区域所需的 $m \\times n$ 分块数量不能少于 $\\lceil \\frac{r}{m} \\rceil \\times \\lceil \\frac{c}{n} \\rceil$。任何“分块”方案都必须覆盖所有 $r \\times c$ 个输出，而将问题“填充”到新的维度 $r' \\ge r$ 和 $c' \\ge c$ 将导致分块数为 $\\lceil \\frac{r'}{m} \\rceil \\lceil \\frac{c'}{n} \\rceil \\ge \\lceil \\frac{r}{m} \\rceil \\lceil \\frac{c}{n} \\rceil$。因此，超出向上取整函数所隐含边界的填充不会减少分块数量，因此不能提高利用率。\n\n因此，最优策略是分块公式所隐含的标准策略：在概念上将矩阵填充到 SA 维度的下一个整数倍。也就是说，计算的结构就好像我们在计算一个大小为 $(m \\lceil \\frac{r}{m} \\rceil) \\times (n \\lceil \\frac{c}{n} \\rceil)$ 的输出矩阵。这种方法使用了最少数量的分块，从而最小化了消耗的总能力。\n\n因此，上面推导出的 $U$ 表达式已经代表了在所述约束下可实现的最大利用率。\n\n可实现的最大利用率的最终闭式解析表达式为：\n$$U_{\\text{max}} = \\frac{rc}{mn \\left\\lceil \\frac{r}{m} \\right\\rceil \\left\\lceil \\frac{c}{n} \\right\\rceil}$$\n这可以被因式分解以显示每个维度上不匹配的独立影响：\n$$U_{\\text{max}} = \\left( \\frac{r}{m \\left\\lceil \\frac{r}{m} \\right\\rceil} \\right) \\left( \\frac{c}{n \\left\\lceil \\frac{c}{n} \\right\\rceil} \\right)$$\n项 $m \\lceil \\frac{r}{m} \\rceil$ 是“填充后”的行维度，项 $n \\lceil \\frac{c}{n} \\rceil$ 是“填充后”的列维度。利用率是真实面积 $rc$ 与填充后面积 $(m \\lceil \\frac{r}{m} \\rceil)(n \\lceil \\frac{c}{n} \\rceil)$ 的比值。",
            "answer": "$$\\boxed{\\frac{rc}{mn \\left\\lceil \\frac{r}{m} \\right\\rceil \\left\\lceil \\frac{c}{n} \\right\\rceil}}$$"
        },
        {
            "introduction": "在专用加速器设计中，数据移动的开销（无论是功耗还是延迟）往往远超计算本身。本练习聚焦于一种核心的内存层次结构优化技术——分块（tiling），旨在通过最大化片上高速缓存（SRAM）中的数据重用，来最小化与片外主存（DRAM）之间昂贵的数据传输 。通过从第一性原理出发建立数据移动模型，你将推导出在给定的片上内存容量下，能最小化总数据传输量的最优分块尺寸，深刻理解性能优化的关键权衡。",
            "id": "3636754",
            "problem": "考虑一个专为维度为 $N$ 的大型方形问题上的稠密矩阵乘法设计的专用领域架构 (DSA)，计算 $C = A B$，其中 $A$、$B$ 和 $C$ 是由 8 位整数组成的 $N \\times N$ 矩阵。该加速器拥有一个容量为 $S$ 字节的片上静态随机存取存储器 (SRAM) 高速暂存器，并与片外动态随机存取存储器 (DRAM) 通信。计算核心采用单级方形分块方案，块边长为 $T$，使得形状为 $T \\times T$ 的 $A$、$B$ 和 $C$ 的块被调入高速暂存器并进行复用，同时一个 $T \\times T$ 的 $C$ 输出块被累加。假设以下条件：\n\n- 每个元素为 $1$ 字节，因此 $A$、$B$ 和 $C$ 的每个块的占用空间均为 $T^{2}$ 字节。\n- 在生成一个 $T \\times T$ 的 $C$ 输出块时，算法以块为单位流式处理 $k$ 维度，在每个 $k$ 步加载一个来自 $A$ 的 $T \\times T$ 块和一个来自 $B$ 的 $T \\times T$ 块，并将相应的 $C$ 的 $T \\times T$ 块驻留在 SRAM 中，直到其累加完成。\n- 输出块 $C$ 在片上初始化（无需从片外初始读取），并在累加完成后每个块写回片外存储器一次。\n- 忽略控制开销、$N$ 不可整除时的边界块以及双缓冲；将 $T$ 视为必须满足 SRAM 容量约束的正整数。\n\n从矩阵乘法的定义和单级分块下数据复用的第一性原理出发，推导出以字节为单位的片外数据移动量 $B(T)$ 作为 $T$ 的函数，并证明 $B(T)$ 在所有可行的 $T$ 上的单調性。利用 SRAM 容量约束和你的单调性论证，确定最小化总片外字节数的最优整数块边长 $T$。將你的最终答案表示为关于 $S$ 的单个闭式解析表达式。无需四舍五入，你的答案应为无量纲的。",
            "solution": "该问题要求推导最优整数块边长 $T$，以最小化在专用领域架构 (DSA) 上执行分块矩阵乘法算法时的片外数据移动。推导必须从第一性原理出发。\n\n首先，我们建立总数据移动量 $B(T)$ 作为块边长 $T$ 的函数。计算是两个稠密 $N \\times N$ 矩阵的乘法，$C = AB$。元素是 8 位整数，这意味着每个元素占用 1 字节。\n\n该算法使用单级方形分块方案。$N \\times N$ 矩阵被划分为大小为 $T \\times T$ 的块。根据题目说明，假设 $N$ 可以被 $T$ 整除，那么矩阵 $A$、$B$ 或 $C$ 中任意一个的总块数为 $\\left(\\frac{N}{T}\\right) \\times \\left(\\frac{N}{T}\\right) = \\left(\\frac{N}{T}\\right)^2$。\n\n题目指定了一种“输出驻留”数据流。这意味着当输出矩阵 $C$ 的一个 $T \\times T$ 块在累加时，它会一直驻留在片上 SRAM 高速暂存器中。让我们分析计算这样一个输出块所需的数据移动。\n\n$C$ 的单个 $T \\times T$ 块（例如 $C_{ii,jj}$）的计算由对块索引 $kk$ 的求和给出：\n$$C_{ii,jj} = \\sum_{kk=0}^{(N/T)-1} A_{ii,kk} B_{kk,jj}$$\n其中 $A_{ii,kk}$ 和 $B_{kk,jj}$ 是相应的 $T \\times T$ 输入块。\n\n根据题目描述：\n$1.$ $C$ 的 $T \\times T$ 输出块在片上初始化。在对所有 $N/T$ 个 $kk$ 值完成完全累加后，它会被一次性写回到片外 DRAM。由于每个元素是 1 字节，一个块的大小是 $T^2$ 字节。这对这一个输出块的总写流量贡献了 $T^2$ 字节。\n$2.$ 在累加的每一步（即，对于从 $0$ 到 $(N/T)-1$ 的每个 $kk$ 值），一个 $A$ 的 $T \\times T$ 块和一个 $B$ 的 $T \\times T$ 块从 DRAM 加载到 SRAM 中。\n计算一个 $C$ 块所需的此类步骤总数为 $N/T$。\n为一个 $C$ 块从 DRAM 读取的数据量是步骤数乘以每步加载的数据量：\n$$ \\text{Read traffic per C tile} = \\frac{N}{T} \\times (\\text{size of A tile} + \\text{size of B tile}) = \\frac{N}{T} \\times (T^2 + T^2) = \\frac{N}{T} \\times 2T^2 = 2NT \\text{ bytes} $$\n因此，计算一个 $T \\times T$ 的 $C$ 块所需的总片外数据移动（读 + 写）为 $2NT + T^2$ 字节。\n\n整个矩阵 $C$ 由 $(N/T)^2$ 个这样的块组成。总数据移动量 $B(T)$ 是每个块的移动量乘以总块数：\n$$ B(T) = \\left(\\frac{N}{T}\\right)^2 \\times (2NT + T^2) $$\n$$ B(T) = \\frac{N^2}{T^2} (2NT) + \\frac{N^2}{T^2} (T^2) = \\frac{2N^3}{T} + N^2 $$\n\n接下来，我们必须考虑由片上 SRAM 容量 $S$ 施加的约束。该算法要求，在累加一个 $C$ 块的任何时刻，高速暂存器必须存放用于 $C$ 的 $T \\times T$ 累加器、一个 $A$ 的 $T \\times T$ 块和一个 $B$ 的 $T \\times T$ 块。所需的总容量是这三个块大小的总和。\n$$ \\text{SRAM requirement} = \\text{size}(A_{\\text{tile}}) + \\text{size}(B_{\\text{tile}}) + \\text{size}(C_{\\text{tile}}) $$\n$$ \\text{SRAM requirement} = T^2 + T^2 + T^2 = 3T^2 \\text{ bytes} $$\n这个所需容量不能超过可用的 SRAM 大小 $S$：\n$$ 3T^2 \\le S $$\n\n我们的目标是找到一个整数 $T$，它能在 $3T^2 \\le S$ 和 $T$ 为正整数的约束下，最小化 $B(T) = \\frac{2N^3}{T} + N^2$。\n\n为了确定 $B(T)$ 如何随 $T$ 变化，我们分析其单调性。为此，我们可以将 $T$ 视为一个连续的正变量。$B(T)$ 关于 $T$ 的导数是：\n$$ \\frac{dB}{dT} = \\frac{d}{dT} \\left( \\frac{2N^3}{T} + N^2 \\right) = \\frac{d}{dT} (2N^3 T^{-1}) + \\frac{d}{dT} (N^2) $$\n$$ \\frac{dB}{dT} = -1 \\cdot 2N^3 T^{-2} + 0 = -\\frac{2N^3}{T^2} $$\n因为 $N$ 是问题维度，$N > 0$，而 $T$ 是块边长，$T > 0$。因此，$N^3 > 0$ 且 $T^2 > 0$。所以，导数 $\\frac{dB}{dT}$ 对所有可行的 $T$ 都是严格为负的。这证明了 $B(T)$ 是一个关于 $T$ 的严格单调递减函数。\n\n为了最小化一个单调递减函数，必须为其参数选择可能的最大值。$T$ 的可行范围由 SRAM 容量约束 $3T^2 \\le S$ 定义。\n$$ T^2 \\le \\frac{S}{3} $$\n$$ T \\le \\sqrt{\\frac{S}{3}} $$\n由于 $T$ 必須是整数，因此 $T$ 的最优值是满足此不等式的最大整数。这是右侧表达式的向下取整（底函数）。\n$$ T_{\\text{optimal}} = \\left\\lfloor \\sqrt{\\frac{S}{3}} \\right\\rfloor $$\n这个表达式给出了最优整数块边长 $T$ 作为关于 SRAM 容量 $S$ 的闭式解析表达式。",
            "answer": "$$\\boxed{\\left\\lfloor \\sqrt{\\frac{S}{3}} \\right\\rfloor}$$"
        },
        {
            "introduction": "对于图像处理等流式应用，维持计算单元的数据供给、避免流水线停顿是实现高吞吐率的关键。本练习模拟了一个典型的流式计算场景：使用双缓冲（double buffering）技术来处理需要“光环”（halo）区域的模板计算（stencil computation）。你的任务是分析计算、数据输入和结果输出之间的时间关系，通过精确调度直接内存访问（DMA）来隐藏数据传输延迟，并确定能够实现计算与通信完全重叠的最小处理单元尺寸，从而掌握设计高效流式数据通路的核心方法。",
            "id": "3636696",
            "problem": "一个具有软件管理的便笺式内存的专用领域架构（DSA）使用一个模板来处理二维网格，该模板要求每个计算瓦片周围有一个宽度为 $h$ 的光环。该 DSA 有两个独立的直接内存访问（DMA）通道（一个用于输入，一个用于输出），每个通道的持续带宽为 $b$，每次传输的设置延迟为 $t_0$。便笺式内存被组织为双缓冲，因此当一个缓冲区用于计算时，另一个缓冲区用于下一瓦片的输入数据和前一瓦片的输出数据的 DMA 传输。每个网格点更新的计算受吞吐量限制，为每秒 $r$ 次更新。每个网格元素是一个大小为 $s$ 字节的字。模板要求瓦片输入区域包括计算区域以及其所有四个侧面的光环。\n\n考虑在一个维度为 $N_x \\times N_y$ 的大网格上流式处理固定宽度为 $W$ 个元素的瓦片（其中 $N_x$ 和 $N_y$ 足够大，以至于为了稳态调度的目的可以忽略边界效应）。每个瓦片处理 $W \\times H$ 个计算元素，并且必须读取 $(W + 2h) \\times (H + 2h)$ 个输入元素（以覆盖光环）并写入 $W \\times H$ 个输出元素。假设每个瓦片的输入和输出传输都是通过每个通道的单个 DMA 事务来执行的。\n\n参数：\n- 网格维度：$N_x = 8192$, $N_y = 8192$。\n- 光环宽度：$h = 2$。\n- 元素大小：$s = 8$ 字节。\n- 瓦片宽度：$W = 512$。\n- 每通道 DMA 带宽：$b = 25 \\times 10^{9}$ 字节/秒。\n- 每次传输的 DMA 设置延迟：$t_0 = 2 \\times 10^{-6}$ 秒。\n- 计算吞吐量：$r = 2 \\times 10^{9}$ 元素更新/秒。\n\n任务：\n1. 使用第一性原理，推导保证在双缓冲下 DMA 传输与计算完全重叠的不等式，并求解满足该不等式的最小瓦片高度 $H_{\\min}$。将一个瓦片的输入传输时间建模为 $T_{\\text{in}} = t_0 + \\frac{s (W + 2h)(H + 2h)}{b}$，输出传输时间建模为 $T_{\\text{out}} = t_0 + \\frac{s W H}{b}$。将计算时间建模为 $T_{\\text{comp}} = \\frac{W H}{r}$。完全重叠要求 $T_{\\text{comp}} \\ge \\max\\{T_{\\text{in}}, T_{\\text{out}}\\}$。\n2. 对于 $H = H_{\\min}$，量化每个缓冲区在计算期间同时容纳输入区域（包括光环）和输出区域所需的便笺式内存容量，即 $S_{\\text{buffer}} = s \\left[ (W + 2h)(H + 2h) + W H \\right]$ 字节。同时报告双缓冲的总便笺式内存容量 $S_{\\text{total}} = 2 S_{\\text{buffer}}$。\n3. 将 $H_{\\min}$ 表示为一个无量纲整数，并将便笺式内存容量以千字节表示，其中一千字节定义为 $1024$ 字节。将所有数值结果四舍五入到四位有效数字。\n\n您的最终答案必须是一个单行矩阵，按顺序包含 $H_{\\min}$、$S_{\\text{buffer}}$（以千字节为单位）和 $S_{\\text{total}}$（以千字节为单位）。",
            "solution": "该问题已经过验证，被认为是有效的。它具有科学依据，定义良好，并且为获得完整解决方案提供了所有必要的参数和模型。\n\n核心任务是找到最小瓦片高度 $H_{\\min}$，以使计算能够与 DMA 传输完全重叠。该架构使用双缓冲，这意味着当处理器在一个缓冲区中的数据上进行计算时，DMA 引擎可以将下一个瓦片的数据传入和传出另一个缓冲区。为实现完全重叠，一个瓦片的计算时间 $T_{\\text{comp}}$ 必须大于或等于数据传输所需的时间。不同瓦片的输入和输出传输与计算同时发生，并且由于输入和输出有独立的通道，总传输时间由两次传输中较慢的一次决定。因此，完全重叠的条件给出如下：\n$$\nT_{\\text{comp}} \\ge \\max\\{T_{\\text{in}}, T_{\\text{out}}\\}\n$$\n\n时间的表达式提供如下：\n- 计算时间：$T_{\\text{comp}} = \\frac{W H}{r}$\n- 输入传输时间：$T_{\\text{in}} = t_0 + \\frac{s (W + 2h)(H + 2h)}{b}$\n- 输出传输时间：$T_{\\text{out}} = t_0 + \\frac{s W H}{b}$\n\n这里，$W$ 是瓦片宽度，$H$ 是瓦片高度，$r$ 是计算吞吐量，$t_0$ 是 DMA 设置延迟，$s$ 是元素大小，$h$ 是光环宽度，$b$ 是 DMA 通道带宽。\n\n首先，我们确定 $T_{\\text{in}}$ 和 $T_{\\text{out}}$ 哪个更大。让我们比较正在传输的数据的大小。输入区域是 $(W + 2h) \\times (H + 2h)$ 个元素，而输出区域是 $W \\times H$ 个元素。由于 $W, H, h$ 都是正整数，我们有：\n$$\n(W + 2h)(H + 2h) = WH + 2hW + 2hH + 4h^2 > WH\n$$\n这意味着输入数据的量严格大于输出数据的量。因此，输入数据的传输时间将比输出数据的传输时间长，因为两者具有相同的设置延迟 $t_0$。\n$$\nT_{\\text{in}} > T_{\\text{out}}\n$$\n因此，完全重叠的条件简化为：\n$$\nT_{\\text{comp}} \\ge T_{\\text{in}}\n$$\n\n代入 $T_{\\text{comp}}$ 和 $T_{\\text{in}}$ 的表达式，我们得到主导不等式：\n$$\n\\frac{W H}{r} \\ge t_0 + \\frac{s (W + 2h)(H + 2h)}{b}\n$$\n我们需要求解这个关于 $H$ 的不等式。让我们展开右边的项，并将包含 $H$ 的项分组：\n$$\n\\frac{W H}{r} \\ge t_0 + \\frac{s}{b} (WH + 2hW + 2hH + 4h^2) \\\\\n\\frac{W H}{r} \\ge t_0 + \\frac{sWH}{b} + \\frac{2shH}{b} + \\frac{s(2hW + 4h^2)}{b}\n$$\n现在，我们将所有含 $H$ 的项收集到不等式的一侧：\n$$\n\\frac{W H}{r} - \\frac{sWH}{b} - \\frac{2shH}{b} \\ge t_0 + \\frac{s(2hW + 4h^2)}{b} \\\\\nH \\left( \\frac{W}{r} - \\frac{sW}{b} - \\frac{2sh}{b} \\right) \\ge t_0 + \\frac{s}{b}(2hW + 4h^2)\n$$\n该不等式的形式为 $H \\cdot C_1 \\ge C_2$。为了求解 $H$，我们必须首先确定系数 $C_1 = \\frac{W}{r} - \\frac{sW}{b} - \\frac{2sh}{b}$ 的符号。让我们代入给定的数值：\n- $W = 512$\n- $h = 2$\n- $s = 8 \\, \\text{字节}$\n- $b = 25 \\times 10^9 \\, \\text{字节/秒}$\n- $t_0 = 2 \\times 10^{-6} \\, \\text{秒}$\n- $r = 2 \\times 10^9 \\, \\text{更新/秒}$\n\n我们计算系数 $C_1$ 中的各项：\n$$\n\\frac{1}{r} = \\frac{1}{2 \\times 10^9} \\, \\text{秒/更新} = 0.5 \\times 10^{-9} \\, \\text{秒} \\\\\n\\frac{s}{b} = \\frac{8 \\, \\text{字节}}{25 \\times 10^9 \\, \\text{字节/秒}} = 0.32 \\times 10^{-9} \\, \\text{秒}\n$$\n由于 $\\frac{1}{r} > \\frac{s}{b}$，项 $W(\\frac{1}{r} - \\frac{s}{b})$ 为正，表明在每个元素的基础上，计算比数据传输慢，这使得重叠成为可能。\n$H$ 的系数是：\n$$\nC_1 = W\\left(\\frac{1}{r} - \\frac{s}{b}\\right) - \\frac{2sh}{b} = 512(0.5 \\times 10^{-9} - 0.32 \\times 10^{-9}) - \\frac{2(8)(2)}{25 \\times 10^9} \\\\\nC_1 = 512(0.18 \\times 10^{-9}) - \\frac{32}{25 \\times 10^9} = (92.16 \\times 10^{-9}) - (1.28 \\times 10^{-9}) = 90.88 \\times 10^{-9} \\, \\text{秒}\n$$\n由于 $C_1$ 为正，我们可以用它相除而不改变不等式的方向：\n$$\nH \\ge \\frac{t_0 + \\frac{s}{b}(2hW + 4h^2)}{C_1}\n$$\n让我们计算分子 $C_2 = t_0 + \\frac{s}{b}(2hW + 4h^2)$：\n$$\nC_2 = 2 \\times 10^{-6} + (0.32 \\times 10^{-9})(2(2)(512) + 4(2^2)) \\\\\nC_2 = 2 \\times 10^{-6} + (0.32 \\times 10^{-9})(2048 + 16) \\\\\nC_2 = 2 \\times 10^{-6} + (0.32 \\times 10^{-9})(2064) = 2 \\times 10^{-6} + 660.48 \\times 10^{-9} \\\\\nC_2 = 2000 \\times 10^{-9} + 660.48 \\times 10^{-9} = 2660.48 \\times 10^{-9} \\, \\text{秒}\n$$\n现在我们求 $H$ 的下界：\n$$\nH \\ge \\frac{2660.48 \\times 10^{-9}}{90.88 \\times 10^{-9}} \\approx 29.2768\n$$\n由于瓦片高度 $H$ 必须是网格元素的整数倍，因此 $H$ 的最小值是大于或等于此下界的最小整数。\n$$\nH_{\\min} = \\lceil 29.2768 \\rceil = 30\n$$\n\n接下来，我们使用 $H = H_{\\min} = 30$ 计算每个缓冲区所需的便笺式内存容量 $S_{\\text{buffer}}$ 和双缓冲的总容量 $S_{\\text{total}}$。单个缓冲区的容量公式给出如下：\n$$\nS_{\\text{buffer}} = s \\left[ (W + 2h)(H + 2h) + W H \\right]\n$$\n代入已知值：\n$$\nW + 2h = 512 + 2(2) = 516 \\\\\nH_{\\min} + 2h = 30 + 2(2) = 34\n$$\n输入区域中的元素数量为 $(516)(34) = 17544$。输出区域中的元素数量为 $W H_{\\min} = 512 \\times 30 = 15360$。\n$$\nS_{\\text{buffer}} = 8 \\, \\text{字节} \\times (17544 + 15360) = 8 \\times 32904 = 263232 \\, \\text{字节}\n$$\n总便笺式内存容量是用于两个这样的缓冲区：\n$$\nS_{\\text{total}} = 2 \\times S_{\\text{buffer}} = 2 \\times 263232 = 526464 \\, \\text{字节}\n$$\n\n最后，我们将容量转换为千字节（其中 $1 \\, \\text{KB} = 1024 \\, \\text{字节}$）并四舍五入到四位有效数字。\n$$\nS_{\\text{buffer}} = \\frac{263232}{1024} \\, \\text{KB} = 257.0625 \\, \\text{KB} \\approx 257.1 \\, \\text{KB}\n$$\n$$\nS_{\\text{total}} = \\frac{526464}{1024} \\, \\text{KB} = 514.125 \\, \\text{KB} \\approx 514.1 \\, \\text{KB}\n$$\n所要求的三个值是 $H_{\\min}=30$，$S_{\\text{buffer}} \\approx 257.1 \\, \\text{KB}$，以及 $S_{\\text{total}} \\approx 514.1 \\, \\text{KB}$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n30 & 257.1 & 514.1\n\\end{pmatrix}\n}\n$$"
        }
    ]
}