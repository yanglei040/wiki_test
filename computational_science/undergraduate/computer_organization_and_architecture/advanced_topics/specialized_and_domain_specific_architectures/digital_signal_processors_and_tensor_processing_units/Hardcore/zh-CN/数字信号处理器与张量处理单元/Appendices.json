{
    "hands_on_practices": [
        {
            "introduction": "要深入理解专用处理器的设计，一个绝佳的起点是分析它们如何管理内存。虽然数字信号处理器（DSP）和张量处理单元（TPU）都能执行卷积等计算，但它们迥异的架构哲学决定了数据在内存中的组织方式也大相径庭。本练习将引导你量化这两种架构在执行相同信号处理任务时的内存占用差异，特别是考虑到内存对齐和填充等实际因素的影响。通过这个练习，你将亲身体会到以通道为中心的DSP数据布局与以张量为核心的TPU数据布局在内存效率上的具体表现，从而理解硬件设计如何影响基础资源的使用 。",
            "id": "3634514",
            "problem": "一个实验室正在比较同一种一维有限冲激响应卷积的两种实现，一种在数字信号处理器（DSP）上，另一种在张量处理单元（TPU）上。任务是对离散时间信号进行实时、多通道的有限冲激响应滤波，使用重叠保留法，帧大小为 $N_{f}$，滤波器长度为 $L$，并独立应用于 $C$ 个通道。每个通道每帧处理 $N_{f}$ 个输出样本，并使用一个长度为 $L$ 的共享滤波器。\n\n假设以下经过充分测试的事实和核心定义：\n- 对于有限冲激响应滤波器的重叠保留法，每个通道需要访问最近的 $N_{f} + L - 1$ 个输入样本，以产生 $N_{f}$ 个连续的有效输出。\n- 内存占用等于元素数量乘以每个元素的字节数，任何由分配器施加的填充都会将分配向上取整到其所需的对齐粒度。\n- Brain 浮点 $16$ 位（$bfloat16$）和定点 $Q1.15$ 每个样本都使用 $16$ 位存储，即每个元素 $2$ 字节。\n\n使用以下特定于场景的细节：\n- DSP 侧（定点 $Q1.15$）：\n  1) $C$ 个通道中的每一个都将其输入历史存储在一个独立的循环缓冲区中，长度为 $N_{f}+L-1$ 个样本。\n  2) $C$ 个通道中的每一个都将其输出帧存储在一个独立的缓冲区中，长度为 $N_{f}$ 个样本。\n  3) 滤波器系数在各通道间共享，并作为 $L$ 个样本存储一次。\n  4) 上述所有三种类型的缓冲区都独立分配，并由分配器填充到不小于其未填充大小的最小的 $32$ 字节倍数。\n- TPU 侧（$bfloat16$）：\n  1) 输入激活张量连续地打包所有通道，并包含 $C\\,(N_{f}+L-1)$ 个样本。\n  2) 输出激活张量连续地打包所有通道，并包含 $C\\,N_{f}$ 个样本。\n  3) 内核张量包含共享的 $L$ 个抽头值。\n  4) TPU 分配器将这三个张量中每一个的总字节大小向上取整：对于输入和输出张量，取整到 $256$ 字节的最小倍数；对于内核张量，取整到 $128$ 字节的最小倍数。\n\n假设除了上述的缓冲区和张量外，没有额外的临时工作空间，并且两个系统上每个元素都以 $2$ 字节存储。设 $C = 96$，$N_{f} = 1023$，$L = 257$。\n\n将有符号内存占用差异 $\\Delta$（以字节为单位）定义为\n$$\n\\Delta = \\text{DSP 总字节数} - \\text{TPU 总字节数}。\n$$\n\n精确计算 $\\Delta$。将最终答案表示为单个有符号整数字节数。无需四舍五入。",
            "solution": "问题要求精确计算多通道有限冲激响应（FIR）滤波器在数字信号处理器（DSP）实现和张量处理单元（TPU）实现之间的有符号内存占用差异 $\\Delta$。该差异定义为 $\\Delta = M_{DSP} - M_{TPU}$，其中 $M_{DSP}$ 和 $M_{TPU}$ 分别是两个系统的总内存占用（以字节为单位）。\n\n首先，我们确定给定的参数：\n- 通道数，$C = 96$。\n- 帧大小，$N_{f} = 1023$ 个样本。\n- 滤波器长度，$L = 257$ 个样本。\n- 每个样本的字节数，$S_{elem} = 2$。\n\n两个系统的内存占用计算都必须考虑填充。我们定义一个运算符 $P(s, a)$，表示将原始大小 $s$（以字节为单位）向上填充到对齐粒度 $a$（以字节为单位）的下一个倍数。这可以用向上取整函数表示：\n$$\nP(s, a) = a \\cdot \\left\\lceil \\frac{s}{a} \\right\\rceil\n$$\n\n现在我们将计算每个系统的总内存占用。\n\n**1. DSP 内存占用 ($M_{DSP}$)**\n\nDSP 系统使用三种类型的缓冲区，每种都独立分配和填充。\n\n- **输入缓冲区**：有 $C$ 个独立的循环缓冲区用于存储输入历史。每个缓冲区存储 $N_{f} + L - 1$ 个样本。\n  - 每个输入缓冲区的样本数为 $N_{f} + L - 1 = 1023 + 257 - 1 = 1279$。\n  - 一个输入缓冲区的未填充大小（以字节为单位）为 $s_{DSP,in} = (N_{f} + L - 1) \\cdot S_{elem} = 1279 \\cdot 2 = 2558$。\n  - DSP 分配器将每个缓冲区填充到 $32$ 字节的倍数。一个输入缓冲区的填充后大小为 $S_{DSP,in} = P(s_{DSP,in}, 32) = 32 \\cdot \\left\\lceil \\frac{2558}{32} \\right\\rceil = 32 \\cdot \\lceil 79.9375 \\rceil = 32 \\cdot 80 = 2560$ 字节。\n  - 所有 $C$ 个输入缓冲区的总内存为 $M_{DSP,in} = C \\cdot S_{DSP,in} = 96 \\cdot 2560 = 245760$ 字节。\n\n- **输出缓冲区**：有 $C$ 个独立的缓冲区用于存储输出帧。每个缓冲区存储 $N_{f}$ 个样本。\n  - 每个输出缓冲区的样本数为 $N_{f} = 1023$。\n  - 一个输出缓冲区的未填充大小（以字节为单位）为 $s_{DSP,out} = N_{f} \\cdot S_{elem} = 1023 \\cdot 2 = 2046$。\n  - 一个输出缓冲区的填充后大小为 $S_{DSP,out} = P(s_{DSP,out}, 32) = 32 \\cdot \\left\\lceil \\frac{2046}{32} \\right\\rceil = 32 \\cdot \\lceil 63.9375 \\rceil = 32 \\cdot 64 = 2048$ 字节。\n  - 所有 $C$ 个输出缓冲区的总内存为 $M_{DSP,out} = C \\cdot S_{DSP,out} = 96 \\cdot 2048 = 196608$ 字节。\n\n- **滤波器缓冲区**：有一个共享缓冲区用于存储滤波器系数，包含 $L$ 个样本。\n  - 样本数为 $L = 257$。\n  - 滤波器缓冲区的未填充大小（以字节为单位）为 $s_{DSP,filt} = L \\cdot S_{elem} = 257 \\cdot 2 = 514$。\n  - 滤波器缓冲区的填充后大小为 $M_{DSP,filt} = P(s_{DSP,filt}, 32) = 32 \\cdot \\left\\lceil \\frac{514}{32} \\right\\rceil = 32 \\cdot \\lceil 16.0625 \\rceil = 32 \\cdot 17 = 544$ 字节。\n\nDSP 的总内存占用是这些部分的总和：\n$$\nM_{DSP} = M_{DSP,in} + M_{DSP,out} + M_{DSP,filt} = 245760 + 196608 + 544 = 442912 \\text{ 字节}\n$$\n\n**2. TPU 内存占用 ($M_{TPU}$)**\n\nTPU 系统使用三个张量，每个张量都有自己的填充规则。\n\n- **输入激活张量**：这个单一的张量打包了所有通道，包含 $C \\cdot (N_{f} + L - 1)$ 个样本。\n  - 总样本数为 $C \\cdot (N_{f} + L - 1) = 96 \\cdot 1279 = 122784$。\n  - 输入张量的未填充大小（以字节为单位）为 $s_{TPU,in} = C \\cdot (N_{f} + L - 1) \\cdot S_{elem} = 122784 \\cdot 2 = 245568$。\n  - TPU 分配器将此张量填充到 $256$ 字节的倍数。填充后的大小为 $M_{TPU,in} = P(s_{TPU,in}, 256) = 256 \\cdot \\left\\lceil \\frac{245568}{256} \\right\\rceil = 256 \\cdot \\lceil 959.25 \\rceil = 256 \\cdot 960 = 245760$ 字节。\n\n- **输出激活张量**：这个单一的张量打包了所有通道，包含 $C \\cdot N_{f}$ 个样本。\n  - 总样本数为 $C \\cdot N_{f} = 96 \\cdot 1023 = 98208$。\n  - 输出张量的未填充大小（以字节为单位）为 $s_{TPU,out} = C \\cdot N_{f} \\cdot S_{elem} = 98208 \\cdot 2 = 196416$。\n  - 此张量也被填充到 $256$ 字节的倍数。填充后的大小为 $M_{TPU,out} = P(s_{TPU,out}, 256) = 256 \\cdot \\left\\lceil \\frac{196416}{256} \\right\\rceil = 256 \\cdot \\lceil 767.25 \\rceil = 256 \\cdot 768 = 196608$ 字节。\n\n- **内核张量**：此张量存储共享的滤波器系数，包含 $L$ 个样本。\n  - 样本数为 $L = 257$。\n  - 内核张量的未填充大小（以字节为单位）为 $s_{TPU,kern} = L \\cdot S_{elem} = 257 \\cdot 2 = 514$。\n  - TPU 分配器将内核张量填充到 $128$ 字节的倍数。填充后的大小为 $M_{TPU,kern} = P(s_{TPU,kern}, 128) = 128 \\cdot \\left\\lceil \\frac{514}{128} \\right\\rceil = 128 \\cdot \\lceil 4.015625 \\rceil = 128 \\cdot 5 = 640$ 字节。\n\nTPU 的总内存占用是这些部分的总和：\n$$\nM_{TPU} = M_{TPU,in} + M_{TPU,out} + M_{TPU,kern} = 245760 + 196608 + 640 = 443008 \\text{ 字节}\n$$\n\n**3. 内存占用差异 ($\\Delta$)**\n\n最后，我们计算有符号内存占用差异 $\\Delta$。\n$$\n\\Delta = M_{DSP} - M_{TPU} = 442912 - 443008 = -96 \\text{ 字节}\n$$\n结果是一个负值，表明在这些特定条件下，DSP 实现的总内存占用比 TPU 实现的总内存占用小 $96$ 字节。这种差异完全源于两种架构不同的内存分配和填充策略。",
            "answer": "$$\n\\boxed{-96}\n$$"
        },
        {
            "introduction": "在了解了静态的内存布局之后，我们自然会转向动态的数据流。强大的计算核心需要持续的数据供给，而内存带宽往往是决定性能的瓶颈。本练习将带你分析和比较DSP的流式处理与TPU的块状处理在动态随机存取存储器（DRAM）带宽需求上的根本区别。你将通过计算每个输出所需的数据流量，来评估两种架构的数据重用效率，并判断哪种架构在给定的带宽条件下更容易达到其计算极限。这项实践是高性能计算领域的一项核心技能，它揭示了算法与硬件协同设计以优化数据移动的重要性 。",
            "id": "3634524",
            "problem": "数字信号处理器 (DSP) 将对一个长输入流进行一维有限脉冲响应 (FIR) 卷积计算。该 DSP 为输入使用一个长度为 $L$ 的循环缓冲区，并在初始化时将 $L$ 个系数预加载到片上静态随机存取存储器 (SRAM) 中。输入样本的位宽为八位 ($8$-bit) 或十六位 ($16$-bit)，具体取决于模式；对于本问题，假设采用以下稳态模式：输入样本为十六位 ($16$-bit)，系数为十六位 ($16$-bit)，输出为三十二位 ($32$-bit)。循环缓冲区的维护方式是：每个输出样本从动态随机存取存储器 (DRAM) 中读取一个最新的输入样本，并丢弃最旧的样本，而在稳态期间，所有系数都被重用，无需进一步访问 DRAM。每个输出样本都会被写回 DRAM。该 DSP 必须维持 $f_{\\text{DSP}} = 1.5 \\times 10^{9}$ 样本/秒的目标采样率。DSP 的可用 DRAM 带宽为 $B_{\\text{DSP}} = 6.0 \\times 10^{9}$ 字节/秒。\n\n张量处理单元 (TPU) 执行通用矩阵乘法 (GEMM) $C = A B$，其中 $A \\in \\mathbb{R}^{M \\times K}$，$B \\in \\mathbb{R}^{K \\times N}$，$C \\in \\mathbb{R}^{M \\times N}$。该 TPU 使用权重固定的脉动处理方法，并带有片上累加器和分块技术。考虑一个大小为 $T_{m} \\times T_{n}$ 的输出分块，其中 $T_{m} = 128$，$T_{n} = 128$，且完整的内积维度 $K = 1024$ 被分割成大小为 $T_{k} = 256$ 的 $K$-块。对于每个 $K$-块，TPU 从 DRAM 流式传输一个激活子分块 $A_{\\text{tile}} \\in \\mathbb{R}^{T_{m} \\times T_{k}}$ 和一个权重子分块 $B_{\\text{tile}} \\in \\mathbb{R}^{T_{k} \\times T_{n}}$ 到片上 SRAM；$C_{\\text{tile}} \\in \\mathbb{R}^{T_{m} \\times T_{n}}$ 的部分和保留在片上，直到整个 $K$ 维度处理完毕，此时完成的 $C_{\\text{tile}}$ 将被一次性写入 DRAM。假设 $A$ 和 $B$ 的元素为八位 ($8$-bit)，最终存储的 $C$ 的元素为十六位 ($16$-bit)。TPU 的脉动阵列可维持每秒 $P = 4.096 \\times 10^{12}$ 次乘法累加 (MAC) 运算。TPU 的可用 DRAM 带宽为 $B_{\\text{TPU}} = 3.0 \\times 10^{11}$ 字节/秒。对于本问题，将千兆字节/秒 (GB/s) 理解为 $10^{9}$ 字节/秒。\n\n仅使用基于卷积的滑动窗口模型和矩阵乘法的三重嵌套循环解释的基本容量和重用论证，完成以下任务：\n\n1. 推导每个 DSP 输出样本的稳态 DRAM 流量，记为 $T_{\\text{DSP}}$ (单位为字节)，明确计入每个输出获取一个新输入样本以及每个输出存储一个输出样本。系数重用不应产生稳态 DRAM 流量。\n2. 推导每个 TPU 输出分块的 DRAM 流量，记为 $T_{\\text{TPU}}$ (单位为字节)，计算所有在 $K$-块上流式传输的激活和权重子分块以及 $C$ 分块的一次最终写入。\n3. 通过计算比率 $r_{\\text{DSP}}$ 和 $r_{\\text{TPU}}$ 来识别带宽瓶颈，其中 $r_{\\text{DSP}}$ 是维持 $f_{\\text{DSP}}$ 所需的 DRAM 带宽除以 $B_{\\text{DSP}}$，$r_{\\text{TPU}}$ 是维持计算受限的分块速率所需的 DRAM 带宽除以 $B_{\\text{TPU}}$。\n\n将您的最终答案表示为单行矩阵 $\\begin{pmatrix} T_{\\text{DSP}}  T_{\\text{TPU}}  r_{\\text{DSP}}  r_{\\text{TPU}} \\end{pmatrix}$。$T_{\\text{DSP}}$ 和 $T_{\\text{TPU}}$ 以字节表示，$r_{\\text{DSP}}$ 和 $r_{\\text{TPU}}$ 以小数表示。将 $r_{\\text{DSP}}$ 和 $r_{\\text{TPU}}$ 四舍五入到四位有效数字。最终的方框答案中不要包含单位。",
            "solution": "解决方案需要计算四个量：DSP 每个输出样本的稳态 DRAM 流量 $T_{\\text{DSP}}$；TPU 每个输出分块的 DRAM 流量 $T_{\\text{TPU}}$；DSP 的所需 DRAM 带宽与可用 DRAM 带宽之比 $r_{\\text{DSP}}$；以及 TPU 的相应比率 $r_{\\text{TPU}}$。\n\n**1. DSP DRAM 流量 ($T_{\\text{DSP}}$) 的推导**\n\n问题指明，在稳态操作中，DSP 对于生成的每个输出，从 DRAM 获取一个新输入样本，并向 DRAM 写入一个完成的输出样本。有限脉冲响应 (FIR) 滤波器的系数被预加载并保存在片上 SRAM 中，因此不产生稳态 DRAM 流量。\n\n一个输入样本的大小 $S_{\\text{in}}$ 给定为十六位 ($16$-bit)。以字节为单位的大小是：\n$$S_{\\text{in}} = \\frac{16 \\text{ bits}}{8 \\text{ bits/byte}} = 2 \\text{ bytes}$$\n一个输出样本的大小 $S_{\\text{out}}$ 给定为三十二位 ($32$-bit)。以字节为单位的大小是：\n$$S_{\\text{out}} = \\frac{32 \\text{ bits}}{8 \\text{ bits/byte}} = 4 \\text{ bytes}$$\n每个输出样本的总 DRAM 流量 $T_{\\text{DSP}}$ 是输入读取流量和输出写入流量的总和。\n$$T_{\\text{DSP}} = S_{\\text{in}} + S_{\\text{out}} = 2 \\text{ bytes} + 4 \\text{ bytes} = 6 \\text{ bytes}$$\n\n**2. TPU DRAM 流量 ($T_{\\text{TPU}}$) 的推导**\n\nTPU 计算输出矩阵 $C$ 的一个大小为 $T_{m} \\times T_{n}$ 的分块，其中 $T_{m} = 128$，$T_{n} = 128$。这是通过将内积维度 $K=1024$ 按大小为 $T_{k}=256$ 的分块来处理完成的。对于内积维度的每个分块，TPU 从 DRAM 流式传输一个激活子分块和一个权重子分块。完成的输出分块被一次性写入 DRAM。\n\n内积维度的分块数量 $N_k$ 是：\n$$N_k = \\frac{K}{T_k} = \\frac{1024}{256} = 4$$\n对于这 $N_k$ 个分块中的每一个，从 DRAM 读取以下数据：\n- 一个大小为 $T_{m} \\times T_{k} = 128 \\times 256$ 的激活子分块 $A_{\\text{sub}}$，其元素为八位 ($8$-bit) ($1$ 字节/元素)。其大小为 $S_{A_{\\text{sub}}} = 128 \\times 256 \\times 1 = 32768$ 字节。\n- 一个大小为 $T_{k} \\times T_{n} = 256 \\times 128$ 的权重子分块 $B_{\\text{sub}}$，其元素为八位 ($8$-bit) ($1$ 字节/元素)。其大小为 $S_{B_{\\text{sub}}} = 256 \\times 128 \\times 1 = 32768$ 字节。\n\n总读取流量 $T_{\\text{read}}$ 是所有 $N_k$ 个分块上所有子分块的流量总和：\n$$T_{\\text{read}} = N_k \\times (S_{A_{\\text{sub}}} + S_{B_{\\text{sub}}}) = 4 \\times (32768 \\text{ bytes} + 32768 \\text{ bytes}) = 4 \\times 65536 \\text{ bytes} = 262144 \\text{ bytes}$$\n完成的输出分块 $C_{\\text{tile}}$ 被一次性写入 DRAM。其维度为 $T_{m} \\times T_{n} = 128 \\times 128$，元素为十六位 ($16$-bit) ($2$ 字节/元素)。写入流量 $T_{\\text{write}}$ 为：\n$$T_{\\text{write}} = T_{m} \\times T_{n} \\times 2 \\text{ bytes} = 128 \\times 128 \\times 2 = 16384 \\times 2 = 32768 \\text{ bytes}$$\n每个输出分块的总流量 $T_{\\text{TPU}}$ 是读取和写入流量的总和。\n$$T_{\\text{TPU}} = T_{\\text{read}} + T_{\\text{write}} = 262144 \\text{ bytes} + 32768 \\text{ bytes} = 294912 \\text{ bytes}$$\n\n**3. DSP 带宽瓶颈比率 ($r_{\\text{DSP}}$) 的推导**\n\n该比率是所需 DRAM 带宽 ($B_{\\text{req, DSP}}$) 除以可用 DRAM 带宽 ($B_{\\text{DSP}}$)。所需带宽是每个样本的流量 ($T_{\\text{DSP}}$) 与目标采样率 ($f_{\\text{DSP}}$) 的乘积。\n$$B_{\\text{req, DSP}} = T_{\\text{DSP}} \\times f_{\\text{DSP}} = (6 \\text{ bytes/sample}) \\times (1.5 \\times 10^{9} \\text{ samples/s}) = 9.0 \\times 10^{9} \\text{ bytes/s}$$\n可用带宽给定为 $B_{\\text{DSP}} = 6.0 \\times 10^{9}$ 字节/秒。比率 $r_{\\text{DSP}}$ 为：\n$$r_{\\text{DSP}} = \\frac{B_{\\text{req, DSP}}}{B_{\\text{DSP}}} = \\frac{9.0 \\times 10^{9} \\text{ bytes/s}}{6.0 \\times 10^{9} \\text{ bytes/s}} = 1.5$$\n表示为四位有效数字，此值为 $1.500$。\n\n**4. TPU 带宽瓶颈比率 ($r_{\\text{TPU}}$) 的推导**\n\n该比率是维持计算受限的分块速率所需的 DRAM 带宽 ($B_{\\text{req, TPU}}$) 除以可用 DRAM 带宽 ($B_{\\text{TPU}}$)。\n\n首先，我们求出每个输出分块的乘法累加 (MAC) 运算次数 $N_{\\text{ops}}$：\n$$N_{\\text{ops}} = T_{m} \\times T_{n} \\times K = 128 \\times 128 \\times 1024 = 2^7 \\times 2^7 \\times 2^{10} = 2^{24} = 16777216 \\text{ MACs}$$\n计算受限的分块速率 $f_{\\text{tile}}$ 是峰值性能 $P = 4.096 \\times 10^{12}$ MACs/秒除以 $N_{\\text{ops}}$：\n$$f_{\\text{tile}} = \\frac{P}{N_{\\text{ops}}} = \\frac{4.096 \\times 10^{12} \\text{ MACs/s}}{16777216 \\text{ MACs/tile}} = 244140.625 \\text{ tiles/s}$$\n所需带宽是每个分块的流量 ($T_{\\text{TPU}}$) 与此速率的乘积：\n$$B_{\\text{req, TPU}} = T_{\\text{TPU}} \\times f_{\\text{tile}} = 294912 \\text{ bytes/tile} \\times 244140.625 \\text{ tiles/s}$$\n为保持精度，我们使用精确表示：$T_{\\text{TPU}} = 9 \\times 2^{15}$ 字节 和 $f_{\\text{tile}} = \\frac{4.096 \\times 10^{12}}{2^{24}} = \\frac{2^{12} \\times 10^9}{2^{24}} = \\frac{10^9}{2^{12}}$ 分块/秒。\n$$B_{\\text{req, TPU}} = (9 \\times 2^{15}) \\times \\left(\\frac{10^9}{2^{12}}\\right) = 9 \\times 2^{3} \\times 10^9 = 72 \\times 10^9 \\text{ bytes/s}$$\n可用的 TPU 带宽给定为 $B_{\\text{TPU}} = 3.0 \\times 10^{11}$ 字节/秒。比率 $r_{\\text{TPU}}$ 为：\n$$r_{\\text{TPU}} = \\frac{B_{\\text{req, TPU}}}{B_{\\text{TPU}}} = \\frac{72 \\times 10^9 \\text{ bytes/s}}{3.0 \\times 10^{11} \\text{ bytes/s}} = \\frac{72}{300} = 0.24$$\n表示为四位有效数字，此值为 $0.2400$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 6  294912  1.500  0.2400 \\end{pmatrix}}$$"
        },
        {
            "introduction": "超越了内存布局与数据流，我们最终要关注计算本身的核心——算术精度。在数字硬件中，使用有限位宽表示数字会不可避免地引入量化误差。本练习将探讨这一基本物理限制在不同应用领域如何产生截然不同的影响。你将使用标准的量化噪声模型，分别计算系数和权重精度对DSP输出信噪比（SNR）以及TPU模型分类准确率的影响。这个练习巧妙地将底层的硬件约束与顶层的应用性能指标联系起来，让你学会如何建模并预测一个微观层面的设计决策（如位宽选择）将如何影响宏观的系统表现 。",
            "id": "3634533",
            "problem": "一个数字信号处理器（DSP）实现了一个长度为$M$的有限冲激响应（FIR）滤波器，其系数为$\\{h_k\\}_{k=0}^{M-1}$。输入信号$x[n]$为零均值、宽平稳的白噪声，方差为$\\sigma_x^2 = 1$。未量化的系数能量为$\\sum_{k=0}^{M-1} h_k^2 = E_h$。每个系数都使用步长$\\Delta_{\\mathrm{DSP}}$进行均匀量化，产生的系数误差$\\epsilon_k$被建模为在$[-\\Delta_{\\mathrm{DSP}}/2,\\ \\Delta_{\\mathrm{DSP}}/2]$上独立的、零均值的均匀分布，且与$x[n]$及彼此之间相互独立。在这些假设下，将由系数 quantization 引起的信噪比（SNR）定义为使用理想系数的输出功率与仅由系数 quantization 引起的输出误差功率之比。\n\n另外，考虑在一个张量处理单元（TPU）上执行的单个全连接层，其扇入为$n$，权重为$\\{w_i\\}_{i=1}^{n}$，输入激活值为$\\{a_i\\}_{i=1}^{n}$。假设$a_i$是独立的、零均值的，方差为$\\sigma_a^2$；$w_i$是独立的、零均值的，方差为$\\sigma_w^2 = 1/n$，因此激活前的信号方差为$n \\sigma_w^2 \\sigma_a^2 = \\sigma_a^2$。假设TPU使用步长$\\Delta_{\\mathrm{TPU}}$对权重进行均匀量化，产生独立的、零均值的权重误差$\\varepsilon_i$，这些误差在$[-\\Delta_{\\mathrm{TPU}}/2,\\ \\Delta_{\\mathrm{TPU}}/2]$上均匀分布，且与$a_i$及彼此之间相互独立。在小噪声情况下，将每层的测试准确率下降量$\\delta_{\\mathrm{acc}}$建模为与该层在激活前的噪信比（NSR）成正比：$\\delta_{\\mathrm{acc}} = \\kappa \\times \\mathrm{NSR}$，其中$\\kappa$是一个给定的无量纲灵敏度常数。\n\n对于以下参数：\n- $M = 64$，$E_h = 2.0$，$\\Delta_{\\mathrm{DSP}} = 2^{-12}$，\n- $n = 1024$，$\\sigma_a^2 = 0.5$，$\\kappa = 0.25$，\n\n仅使用均匀量化器的加性白量化噪声模型（在$[-\\Delta/2,\\ \\Delta/2]$上的均匀随机变量的方差等于$\\Delta^2/12$）和白噪声输入的线性时不变滤波来：\n1) 推导DSP因系数 quantization 引起的信噪比，并将其倒数解释为DSP的相对输出噪声功率$r$，\n2) 确定$\\Delta_{\\mathrm{TPU}}$的值，使得TPU的每层准确率下降量$\\delta_{\\mathrm{acc}}$等于$r$。\n\n仅报告$\\Delta_{\\mathrm{TPU}}$的最终数值，四舍五入到四位有效数字。",
            "solution": "该问题要求找到张量处理单元（TPU）的量化步长$\\Delta_{\\mathrm{TPU}}$，使得其预测的准确率下降量$\\delta_{\\mathrm{acc}}$等于数字信号处理器（DSP）的相对输出噪声功率$r$。解题过程分两部分：首先，我们分析DSP以求得$r$；其次，我们分析TPU以求得$\\delta_{\\mathrm{acc}}$的表达式，然后令其等于$r$来解出$\\Delta_{\\mathrm{TPU}}$。\n\n**第一部分：DSP相对输出噪声功率**\n\n理想有限冲激响应（FIR）滤波器的输出由卷积给出：$y[n] = \\sum_{k=0}^{M-1} h_k x[n-k]$。输出端的信号功率$P_{y_h}$是$y[n]$的方差。由于输入$x[n]$是零均值，输出$y[n]$也是零均值。\n$$P_{y_h} = E[y[n]^2] = E\\left[\\left(\\sum_{k=0}^{M-1} h_k x[n-k]\\right)^2\\right] = \\sum_{k=0}^{M-1} \\sum_{j=0}^{M-1} h_k h_j E[x[n-k]x[n-j]]$$\n输入信号$x[n]$是白噪声且宽平稳，因此其自相关函数为$R_x[m] = E[x[l]x[l-m]] = \\sigma_x^2 \\delta[m]$，其中$\\delta[m]$是Kronecker δ函数。给定$\\sigma_x^2 = 1$。\n$$E[x[n-k]x[n-j]] = R_x[k-j] = \\sigma_x^2 \\delta[k-j] = 1 \\cdot \\delta[k-j]$$\n将此代入功率表达式，双重求和将简化为单一求和：\n$$P_{y_h} = \\sum_{k=0}^{M-1} h_k^2 \\sigma_x^2 = \\sigma_x^2 \\sum_{k=0}^{M-1} h_k^2 = 1 \\cdot E_h = E_h$$\n其中$E_h = \\sum_{k=0}^{M-1} h_k^2$是给定的系数能量。\n\n接下来，我们求由系数 quantization 引起的输出误差功率$P_e$。量化后的系数为$\\hat{h}_k = h_k + \\epsilon_k$，其中$\\epsilon_k$是量化误差。输出误差信号为$e[n] = \\sum_{k=0}^{M-1} \\epsilon_k x[n-k]$。误差功率是其方差：\n$$P_e = E[e[n]^2] = E\\left[\\left(\\sum_{k=0}^{M-1} \\epsilon_k x[n-k]\\right)^2\\right] = \\sum_{k=0}^{M-1} \\sum_{j=0}^{M-1} E[\\epsilon_k \\epsilon_j x[n-k]x[n-j]]$$\n系数误差$\\epsilon_k$与输入$x[n]$以及彼此之间相互独立。它们也是零均值。因此，$E[\\epsilon_k \\epsilon_j] = E[\\epsilon_k^2]\\delta[k-j] = \\sigma_\\epsilon^2 \\delta[k-j]$。\n$$P_e = \\sum_{k=0}^{M-1} \\sum_{j=0}^{M-1} E[\\epsilon_k \\epsilon_j] E[x[n-k]x[n-j]] = \\sum_{k=0}^{M-1} \\sum_{j=0}^{M-1} (\\sigma_\\epsilon^2 \\delta[k-j]) (\\sigma_x^2 \\delta[k-j])$$\n这可以简化为：\n$$P_e = \\sum_{k=0}^{M-1} \\sigma_\\epsilon^2 \\sigma_x^2 = M \\sigma_\\epsilon^2 \\sigma_x^2$$\n量化误差$\\epsilon_k$在$[-\\Delta_{\\mathrm{DSP}}/2, \\Delta_{\\mathrm{DSP}}/2]$上均匀分布。该分布的方差是$\\sigma_\\epsilon^2 = \\Delta_{\\mathrm{DSP}}^2 / 12$。代入$\\sigma_x^2=1$：\n$$P_e = M \\cdot 1 \\cdot \\frac{\\Delta_{\\mathrm{DSP}}^2}{12} = \\frac{M \\Delta_{\\mathrm{DSP}}^2}{12}$$\n信噪比为$\\mathrm{SNR}_{\\mathrm{DSP}} = P_{y_h} / P_e$。相对输出噪声功率$r$是其倒数：\n$$r = \\frac{1}{\\mathrm{SNR}_{\\mathrm{DSP}}} = \\frac{P_e}{P_{y_h}} = \\frac{M \\Delta_{\\mathrm{DSP}}^2 / 12}{E_h} = \\frac{M \\Delta_{\\mathrm{DSP}}^2}{12 E_h}$$\n\n**第二部分：TPU准确率下降量与最终解**\n\n对于TPU，一个神经元的激活前值为$z = \\sum_{i=1}^{n} w_i a_i$。问题陈述激活前信号方差（功率）为$P_S = \\sigma_a^2$。\n\n权重$w_i$的量化引入了误差$\\varepsilon_i$，因此量化后的权重为$\\hat{w}_i = w_i + \\varepsilon_i$。激活前的噪声为$z_{\\mathrm{noise}} = \\sum_{i=1}^{n} \\varepsilon_i a_i$。该噪声的功率$P_N$为：\n$$P_N = E[z_{\\mathrm{noise}}^2] = E\\left[\\left(\\sum_{i=1}^{n} \\varepsilon_i a_i\\right)^2\\right] = \\sum_{i=1}^{n} \\sum_{j=1}^{n} E[\\varepsilon_i \\varepsilon_j] E[a_i a_j]$$\n权重误差$\\varepsilon_i$是独立的且为零均值，所以$E[\\varepsilon_i \\varepsilon_j] = \\sigma_\\varepsilon^2 \\delta[i-j]$。输入激活值$a_i$是独立的且为零均值，所以$E[a_i a_j] = \\sigma_a^2 \\delta[i-j]$。\n$$P_N = \\sum_{i=1}^{n} \\sum_{j=1}^{n} (\\sigma_\\varepsilon^2 \\delta[i-j]) (\\sigma_a^2 \\delta[i-j]) = \\sum_{i=1}^{n} \\sigma_\\varepsilon^2 \\sigma_a^2 = n \\sigma_\\varepsilon^2 \\sigma_a^2$$\n权重误差$\\varepsilon_i$在$[-\\Delta_{\\mathrm{TPU}}/2, \\Delta_{\\mathrm{TPU}}/2]$上均匀分布，因此其方差为$\\sigma_\\varepsilon^2 = \\Delta_{\\mathrm{TPU}}^2 / 12$。\n$$P_N = n \\sigma_a^2 \\frac{\\Delta_{\\mathrm{TPU}}^2}{12}$$\n激活前的噪信比为$\\mathrm{NSR}_{\\mathrm{TPU}} = P_N / P_S$。\n$$\\mathrm{NSR}_{\\mathrm{TPU}} = \\frac{n \\sigma_a^2 \\Delta_{\\mathrm{TPU}}^2 / 12}{\\sigma_a^2} = \\frac{n \\Delta_{\\mathrm{TPU}}^2}{12}$$\n准确率下降量被建模为$\\delta_{\\mathrm{acc}} = \\kappa \\times \\mathrm{NSR}_{\\mathrm{TPU}}$。\n$$\\delta_{\\mathrm{acc}} = \\kappa \\frac{n \\Delta_{\\mathrm{TPU}}^2}{12}$$\n我们需要找到$\\Delta_{\\mathrm{TPU}}$使得$\\delta_{\\mathrm{acc}} = r$。\n$$\\kappa \\frac{n \\Delta_{\\mathrm{TPU}}^2}{12} = \\frac{M \\Delta_{\\mathrm{DSP}}^2}{12 E_h}$$\n解出$\\Delta_{\\mathrm{TPU}}^2$：\n$$\\Delta_{\\mathrm{TPU}}^2 = \\frac{M \\Delta_{\\mathrm{DSP}}^2}{\\kappa n E_h}$$\n对步长取正平方根：\n$$\\Delta_{\\mathrm{TPU}} = \\sqrt{\\frac{M \\Delta_{\\mathrm{DSP}}^2}{\\kappa n E_h}} = \\Delta_{\\mathrm{DSP}} \\sqrt{\\frac{M}{\\kappa n E_h}}$$\n现在，我们代入给定的数值：$M = 64$，$E_h = 2.0$，$\\Delta_{\\mathrm{DSP}} = 2^{-12}$，$n = 1024$，以及$\\kappa = 0.25$。\n$$\\Delta_{\\mathrm{TPU}} = 2^{-12} \\sqrt{\\frac{64}{0.25 \\cdot 1024 \\cdot 2.0}}$$\n平方根内的项为：\n$$\\frac{64}{0.25 \\cdot 1024 \\cdot 2.0} = \\frac{64}{256 \\cdot 2.0} = \\frac{64}{512} = \\frac{2^6}{2^9} = 2^{-3} = \\frac{1}{8}$$\n所以，我们有：\n$$\\Delta_{\\mathrm{TPU}} = 2^{-12} \\sqrt{\\frac{1}{8}} = 2^{-12} \\frac{1}{\\sqrt{2^3}} = 2^{-12} \\cdot 2^{-3/2} = 2^{-12-1.5} = 2^{-13.5}$$\n为将其表示为一个数值，我们计算其值：\n$$\\Delta_{\\mathrm{TPU}} = 2^{-13.5} \\approx 8.631608 \\times 10^{-5}$$\n按要求四舍五入到四位有效数字：\n$$\\Delta_{\\mathrm{TPU}} \\approx 8.632 \\times 10^{-5}$$",
            "answer": "$$\\boxed{8.632 \\times 10^{-5}}$$"
        }
    ]
}