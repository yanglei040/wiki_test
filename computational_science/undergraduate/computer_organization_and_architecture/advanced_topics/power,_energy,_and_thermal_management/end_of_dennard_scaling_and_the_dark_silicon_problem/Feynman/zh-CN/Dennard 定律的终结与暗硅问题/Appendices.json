{
    "hands_on_practices": [
        {
            "introduction": "登纳德缩放定律的终结带来了一个直接的后果：芯片的功率密度不再随晶体管尺寸的缩小而保持恒定。为了防止芯片过热，现代处理器必须遵守严格的散热设计功耗（$TDP$）上限。这个练习将引导你通过计算，具体量化在一个给定的功率预算内，到底可以同时激活多少个计算核心，从而首次直观地理解“暗硅”现象。",
            "id": "3639241",
            "problem": "一个拥有 $N=128$ 个相同计算单元的多核片上系统，由于 Dennard 缩放定律的终结，在恒定的电源电压 $V$ 下运行，因此每次转换的动态开关能耗不随频率降低。在参考频率 $f_{0} = 1$ GHz 下，每个活动计算单元测得的动态功耗为 $P_{\\mathrm{dyn},0} = 2$ W，泄漏功耗为 $P_{\\mathrm{leak}} = 0.5$ W。为防止局部热失控而设定的单位功耗上限为 $P_{\\mathrm{cap}} = 3$ W。芯片级热设计功耗 (TDP) 为 $P_{\\mathrm{TDP}} = 200$ W，并且有一个固定的 uncore 基准功耗 $P_{\\mathrm{uncore}} = 20$ W，该功耗不依赖于活动计算单元的数量。\n\n假设所有活动计算单元都以共同的时钟频率 $f$ 运行，并且在恒定电压 $V$ 下，动态功耗与频率成线性关系。非活动（暗）单元被完全电源门控，其功耗可以忽略不计。仅根据这些信息，首先确定最大可行频率 $f_{\\max}$，使得单个活动单元的总功耗满足 $P_{\\mathrm{unit}}(f) \\leq P_{\\mathrm{cap}}$。然后，在 $f = f_{\\max}$ 时，确定可同时活动的最大计算单元数 $M$，使得芯片总功耗小于或等于 $P_{\\mathrm{TDP}}$。\n\n中间频率以 GHz 为单位表示。最终答案请报告单个整数 $M$。",
            "solution": "首先将根据所需准则对问题进行验证。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n问题陈述中提供的明确数据和条件如下：\n- 计算单元总数：$N = 128$\n- 电源电压：$V$ 为常数\n- 参考频率：$f_{0} = 1$ GHz\n- 在 $f_0$ 下每个活动单元的动态功耗：$P_{\\mathrm{dyn},0} = 2$ W\n- 每个活动单元的泄漏功耗：$P_{\\mathrm{leak}} = 0.5$ W\n- 单位功耗上限：$P_{\\mathrm{cap}} = 3$ W\n- 芯片级热设计功耗：$P_{\\mathrm{TDP}} = 200$ W\n- 固定的 uncore 基准功耗：$P_{\\mathrm{uncore}} = 20$ W\n- 假设：动态功耗与频率 $f$ 成线性关系。\n- 假设：非活动单元被完全电源门控，其功耗贡献可忽略不计。\n- 目标1：确定最大可行频率 $f_{\\max}$，使得单个活动单元的功耗 $P_{\\mathrm{unit}}(f)$ 不超过 $P_{\\mathrm{cap}}$。\n- 目标2：在 $f = f_{\\max}$ 时，确定最大活动单元数 $M$，使得芯片总功耗不超过 $P_{\\mathrm{TDP}}$。\n\n**步骤2：使用提取的已知条件进行验证**\n对问题的有效性进行分析：\n- **科学依据：** 该问题基于计算机体系结构和 VLSI 设计中的基本概念，特别是现代多核处理器的功耗特性。Dennard 缩放定律失效、动态功耗、泄漏功耗、功耗上限和热设计功耗 (TDP) 等概念都是标准且成熟的。在固定电压下，动态功耗随频率线性变化的模型是一个正确的一阶近似（$P_{\\mathrm{dyn}} = C V^2 f$，其中 $C$ 和 $V$ 是常数）。核心功耗与 uncore 功耗的区别也是标准做法。\n- **适定性：** 该问题提供了所有必要的数值和一组明确的约束条件，可以唯一地确定所求的两个量 $f_{\\max}$ 和 $M$。目标陈述清晰。\n- **客观性：** 语言精确且定量，没有任何主观或模糊的术语。\n- **完整性与一致性：** 数据是自洽且充分的，没有矛盾之处。例如，预期计算出的活动核心数将少于可用的核心总数（$M < N$），这是本问题所模拟的“暗硅”问题的一个标志。\n- **真实性：** 功耗和频率值对于高性能片上系统而言在合理范围内。\n\n**步骤3：结论与行动**\n问题被判定为**有效**。这是一个计算机工程领域中适定且有科学依据的问题。将提供完整的解答。\n\n### 解答\n\n单个活动计算单元的总功耗 $P_{\\mathrm{unit}}$ 是其动态功耗 $P_{\\mathrm{dyn}}$ 和泄漏功耗 $P_{\\mathrm{leak}}$ 的总和。\n$$P_{\\mathrm{unit}}(f) = P_{\\mathrm{dyn}}(f) + P_{\\mathrm{leak}}$$\n泄漏功耗给定为常数 $P_{\\mathrm{leak}} = 0.5$ W。\n动态功耗 $P_{\\mathrm{dyn}}(f)$ 被说明在恒定电源电压 $V$ 下与工作频率 $f$ 成线性关系。我们可以将此关系写为：\n$$P_{\\mathrm{dyn}}(f) = k \\cdot f$$\n其中 $k$ 是一个比例常数。我们可以根据给定的参考条件来确定 $k$：在 $f = f_0 = 1$ GHz 时，动态功耗为 $P_{\\mathrm{dyn},0} = 2$ W。\n$$k = \\frac{P_{\\mathrm{dyn},0}}{f_0} = \\frac{2 \\text{ W}}{1 \\text{ GHz}} = 2 \\frac{\\text{W}}{\\text{GHz}}$$\n因此，单个活动单元的功耗作为频率的函数是：\n$$P_{\\mathrm{unit}}(f) = \\left(\\frac{P_{\\mathrm{dyn},0}}{f_0}\\right)f + P_{\\mathrm{leak}}$$\n\n第一个目标是找到最大可行频率 $f_{\\max}$，使得单个单元的功耗不超过单位功耗上限 $P_{\\mathrm{cap}}$。这可以用不等式表示为：\n$$P_{\\mathrm{unit}}(f) \\leq P_{\\mathrm{cap}}$$\n为求得最大频率，我们将单元功耗设为功耗上限：\n$$P_{\\mathrm{unit}}(f_{\\max}) = P_{\\mathrm{cap}}$$\n代入 $P_{\\mathrm{unit}}(f)$ 的表达式：\n$$\\left(\\frac{P_{\\mathrm{dyn},0}}{f_0}\\right)f_{\\max} + P_{\\mathrm{leak}} = P_{\\mathrm{cap}}$$\n现在我们可以求解 $f_{\\max}$：\n$$f_{\\max} = \\frac{P_{\\mathrm{cap}} - P_{\\mathrm{leak}}}{\\left(\\frac{P_{\\mathrm{dyn},0}}{f_0}\\right)} = f_0 \\frac{P_{\\mathrm{cap}} - P_{\\mathrm{leak}}}{P_{\\mathrm{dyn},0}}$$\n代入给定的数值：\n$$f_{\\max} = (1 \\text{ GHz}) \\frac{3 \\text{ W} - 0.5 \\text{ W}}{2 \\text{ W}} = (1 \\text{ GHz}) \\frac{2.5}{2} = 1.25 \\text{ GHz}$$\n\n第二个目标是在此频率 $f_{\\max}$ 下运行时，找到可同时活动的最大计算单元数 $M$，且不超过芯片级热设计功耗 $P_{\\mathrm{TDP}}$。\n\n芯片的总功耗 $P_{\\mathrm{total}}$ 是 $M$ 个活动单元的功耗与固定的 uncore 功耗 $P_{\\mathrm{uncore}}$ 之和。\n$$P_{\\mathrm{total}} = M \\cdot P_{\\mathrm{unit}}(f_{\\max}) + P_{\\mathrm{uncore}}$$\n从上一步我们知道，在 $f = f_{\\max}$ 时，每个活动单元的功耗恰好达到其上限，因此 $P_{\\mathrm{unit}}(f_{\\max}) = P_{\\mathrm{cap}} = 3$ W。\n总功耗约束为：\n$$P_{\\mathrm{total}} \\leq P_{\\mathrm{TDP}}$$\n为求得最大活动单元数 $M$，我们将总功耗设为 TDP：\n$$M \\cdot P_{\\mathrm{cap}} + P_{\\mathrm{uncore}} = P_{\\mathrm{TDP}}$$\n求解 $M$：\n$$M = \\frac{P_{\\mathrm{TDP}} - P_{\\mathrm{uncore}}}{P_{\\mathrm{cap}}}$$\n代入给定的数值：\n$$M = \\frac{200 \\text{ W} - 20 \\text{ W}}{3 \\text{ W}} = \\frac{180 \\text{ W}}{3 \\text{ W}} = 60$$\n由于计算单元的数量必须是整数，所以最大数量为 $60$。这个数字小于可用的单元总数（$60  128$），这说明了暗硅问题。",
            "answer": "$$\\boxed{60}$$"
        },
        {
            "introduction": "暗硅问题并非一成不变，实际上随着每一代新工艺节点的推进，它正变得愈发严峻。这个练习将深入探讨其背后的物理原因，特别是更小工艺尺寸下热阻的增加以及对温度敏感的漏电功耗。通过比较两个不同工艺节点的芯片，你将量化地理解为何更新的芯片虽然晶体管更多，却面临着更严苛的功率挑战。",
            "id": "3639264",
            "problem": "一款片上系统（SoC）采用两种互补金属氧化物半导体（CMOS）工艺节点制造，分别为 $28\\ \\mathrm{nm}$ 和 $5\\ \\mathrm{nm}$。该芯片在相同的热设计功耗（TDP）预算下运行，因此其总电功率被限制为 $P_{\\max}$，且与工艺节点无关。假设芯片在强制风冷条件下稳态运行，其结温可通过广泛使用的热阻关系式进行建模\n$$\nT_{j} \\;=\\; T_{\\mathrm{amb}} \\;+\\; R_{\\theta} \\, P_{\\mathrm{total}},\n$$\n其中 $T_{\\mathrm{amb}}$ 是环境温度，$R_{\\theta}$ 是封装级结到环境的热阻，$P_{\\mathrm{total}}$ 是芯片总功耗。芯片总功耗是动态功耗和漏电功耗之和，\n$$\nP_{\\mathrm{total}} \\;=\\; P_{\\mathrm{dyn}} \\;+\\; P_{\\mathrm{leak}},\n$$\n其中动态功耗与芯片中主动开关部分的比例 $f$ 呈线性关系，$P_{\\mathrm{dyn}} = f \\, P_{\\mathrm{dyn,full}}$，而漏电功耗遵循一个经验支持的针对CMOS亚阈值和结漏电的温度依赖关系，\n$$\nI_{\\mathrm{leak}}(T) \\;=\\; I_{\\mathrm{leak}}(T_{\\mathrm{ref}})\\, 2^{\\frac{T - T_{\\mathrm{ref}}}{10}},\n\\quad\\text{即}\\quad\nP_{\\mathrm{leak}}(T) \\;=\\; V_{\\mathrm{DD}} \\, I_{\\mathrm{leak}}(T).\n$$\n假设未使用电源门控技术，因此无论 $f$ 为何值，整个芯片都会产生漏电功耗。以下参数已知，并且在两种节点上对于所有工作负载均相同：\n- 环境温度 $T_{\\mathrm{amb}} = 40\\ ^{\\circ}\\mathrm{C}$。\n- 热设计功耗 $P_{\\max} = 95\\ \\mathrm{W}$。\n- 参考温度 $T_{\\mathrm{ref}} = 60\\ ^{\\circ}\\mathrm{C}$。\n- 全活动动态功耗 $P_{\\mathrm{dyn,full}} = 120\\ \\mathrm{W}$（在此比较中，假设其与温度 $T$ 和节点无关）。\n\n各节点特定参数如下：\n- 在 $28\\ \\mathrm{nm}$ 节点：$R_{\\theta,28} = 0.25\\ \\mathrm{K/W}$，$V_{\\mathrm{DD},28} = 1.00\\ \\mathrm{V}$，以及 $I_{\\mathrm{leak},28}(T_{\\mathrm{ref}}) = 10.0\\ \\mathrm{A}$。\n- 在 $5\\ \\mathrm{nm}$ 节点：$R_{\\theta,5} = 0.35\\ \\mathrm{K/W}$，$V_{\\mathrm{DD},5} = 0.70\\ \\mathrm{V}$，以及 $I_{\\mathrm{leak},5}(T_{\\mathrm{ref}}) = \\dfrac{25.0}{0.70}\\ \\mathrm{A}$。\n\n假设芯片恰好在TDP极限下运行，即 $P_{\\mathrm{total}} = P_{\\max}$，因此每个节点的结温为 $T_{j} = T_{\\mathrm{amb}} + R_{\\theta} P_{\\max}$。将一个节点的暗硅比例定义为 $d \\equiv 1 - f$，其中 $f$ 是在稳态下满足TDP约束所需的活动比例。\n\n仅使用上述关系，计算节点间暗硅的缩放因子，其定义为比率\n$$\n\\frac{d_{5\\ \\mathrm{nm}}}{d_{28\\ \\mathrm{nm}}}.\n$$\n将最终答案四舍五入至四位有效数字。最终答案以无单位的纯数表示。",
            "solution": "用户希望计算 $5\\ \\mathrm{nm}$ 和 $28\\ \\mathrm{nm}$ CMOS 工艺节点之间暗硅比例的缩放因子，该因子定义为比率 $\\frac{d_{5\\ \\mathrm{nm}}}{d_{28\\ \\mathrm{nm}}}$。\n\n首先，我们必须验证问题陈述。\n\n**第一步：提取已知条件**\n问题提供了以下方程和定义：\n- 结温：$T_{j} = T_{\\mathrm{amb}} + R_{\\theta} \\, P_{\\mathrm{total}}$\n- 总功耗：$P_{\\mathrm{total}} = P_{\\mathrm{dyn}} + P_{\\mathrm{leak}}$\n- 动态功耗：$P_{\\mathrm{dyn}} = f \\, P_{\\mathrm{dyn,full}}$，其中 $f$ 是活动比例。\n- 漏电流温度依赖关系：$I_{\\mathrm{leak}}(T) = I_{\\mathrm{leak}}(T_{\\mathrm{ref}})\\, 2^{\\frac{T - T_{\\mathrm{ref}}}{10}}$\n- 漏电功耗：$P_{\\mathrm{leak}}(T) = V_{\\mathrm{DD}} \\, I_{\\mathrm{leak}}(T)$\n- 暗硅比例：$d = 1 - f$\n- 约束条件：$P_{\\mathrm{total}} = P_{\\max}$\n\n问题提供了以下对两个节点都相同的参数：\n- 环境温度：$T_{\\mathrm{amb}} = 40\\ ^{\\circ}\\mathrm{C}$\n- 热设计功耗：$P_{\\max} = 95\\ \\mathrm{W}$\n- 漏电参考温度：$T_{\\mathrm{ref}} = 60\\ ^{\\circ}\\mathrm{C}$\n- 全活动动态功耗：$P_{\\mathrm{dyn,full}} = 120\\ \\mathrm{W}$\n\n各节点特定参数如下：\n- 对于 $28\\ \\mathrm{nm}$ 节点：$R_{\\theta,28} = 0.25\\ \\mathrm{K/W}$，$V_{\\mathrm{DD},28} = 1.00\\ \\mathrm{V}$，$I_{\\mathrm{leak},28}(T_{\\mathrm{ref}}) = 10.0\\ \\mathrm{A}$。\n- 对于 $5\\ \\mathrm{nm}$ 节点：$R_{\\theta,5} = 0.35\\ \\mathrm{K/W}$，$V_{\\mathrm{DD},5} = 0.70\\ \\mathrm{V}$，$I_{\\mathrm{leak},5}(T_{\\mathrm{ref}}) = \\frac{25.0}{0.70}\\ \\mathrm{A}$。\n\n**第二步：使用提取的已知条件进行验证**\n该问题具有科学依据，使用了集成电路功耗和热行为的标准一阶模型。动态功耗、漏电功耗和热阻的模型在计算机体系结构和电气工程领域是通用的。参数值虽然是此问题特有的，但对于相应的技术节点而言是物理上合理的（例如，从 $1.0\\ \\mathrm{V}$ 到 $0.7\\ \\mathrm{V}$ 的电压缩放、较小节点热阻的增加以及漏电流的增加都是预期的趋势）。该问题提法得当，提供了计算唯一数值解所需的所有信息。其语言客观、精确。该问题与暗硅主题直接相关。因此，该问题被认为是有效的。\n\n**第三步：结论与行动**\n问题有效。我们开始求解。\n\n暗硅比例定义为 $d = 1 - f$。我们首先建立 $d$ 的通用表达式。\n总功耗受TDP限制，因此 $P_{\\mathrm{total}} = P_{\\max}$。\n总功耗是动态功耗和漏电功耗之和：\n$$P_{\\max} = P_{\\mathrm{dyn}} + P_{\\mathrm{leak}}$$\n代入动态功耗的表达式 $P_{\\mathrm{dyn}} = f \\, P_{\\mathrm{dyn,full}}$，我们得到：\n$$P_{\\max} = f \\, P_{\\mathrm{dyn,full}} + P_{\\mathrm{leak}}(T_j)$$\n我们可以解出活动比例 $f$：\n$$f = \\frac{P_{\\max} - P_{\\mathrm{leak}}(T_j)}{P_{\\mathrm{dyn,full}}}$$\n那么暗硅比例 $d$ 就是：\n$$d = 1 - f = 1 - \\frac{P_{\\max} - P_{\\mathrm{leak}}(T_j)}{P_{\\mathrm{dyn,full}}} = \\frac{P_{\\mathrm{dyn,full}} - P_{\\max} + P_{\\mathrm{leak}}(T_j)}{P_{\\mathrm{dyn,full}}}$$\n为了计算每个节点的 $d$，我们必须首先确定该节点的结温 $T_j$ 和漏电功耗 $P_{\\mathrm{leak}}(T_j)$。问题指明芯片在TDP极限下运行，因此我们在热学方程中使用 $P_{\\mathrm{total}} = P_{\\max}$。\n\n**$28\\ \\mathrm{nm}$ 节点的计算（用下标 $28$ 表示）：**\n1.  计算结温 $T_{j,28}$：\n    $$T_{j,28} = T_{\\mathrm{amb}} + R_{\\theta,28} \\, P_{\\max}$$\n    $$T_{j,28} = 40\\ ^{\\circ}\\mathrm{C} + (0.25\\ \\mathrm{K/W}) \\cdot (95\\ \\mathrm{W}) = 40\\ ^{\\circ}\\mathrm{C} + 23.75\\ ^{\\circ}\\mathrm{C} = 63.75\\ ^{\\circ}\\mathrm{C}$$\n    注意，开尔文温差等同于摄氏温差，因此单位是一致的。\n\n2.  计算此温度下的漏电功耗 $P_{\\mathrm{leak},28}$：\n    $$P_{\\mathrm{leak},28}(T_{j,28}) = V_{\\mathrm{DD},28} \\, I_{\\mathrm{leak},28}(T_{j,28}) = V_{\\mathrm{DD},28} \\, I_{\\mathrm{leak},28}(T_{\\mathrm{ref}}) \\, 2^{\\frac{T_{j,28} - T_{\\mathrm{ref}}}{10}}$$\n    $$P_{\\mathrm{leak},28}(T_{j,28}) = (1.00\\ \\mathrm{V}) \\cdot (10.0\\ \\mathrm{A}) \\cdot 2^{\\frac{63.75 - 60}{10}} = 10.0 \\cdot 2^{\\frac{3.75}{10}} \\ \\mathrm{W} = 10.0 \\cdot 2^{0.375}\\ \\mathrm{W}$$\n\n3.  计算暗硅比例 $d_{28}$：\n    $$d_{28} = \\frac{P_{\\mathrm{dyn,full}} - P_{\\max} + P_{\\mathrm{leak},28}(T_{j,28})}{P_{\\mathrm{dyn,full}}}$$\n    $$d_{28} = \\frac{120 - 95 + 10.0 \\cdot 2^{0.375}}{120} = \\frac{25 + 10.0 \\cdot 2^{0.375}}{120}$$\n\n**$5\\ \\mathrm{nm}$ 节点的计算（用下标 $5$ 表示）：**\n1.  计算结温 $T_{j,5}$：\n    $$T_{j,5} = T_{\\mathrm{amb}} + R_{\\theta,5} \\, P_{\\max}$$\n    $$T_{j,5} = 40\\ ^{\\circ}\\mathrm{C} + (0.35\\ \\mathrm{K/W}) \\cdot (95\\ \\mathrm{W}) = 40\\ ^{\\circ}\\mathrm{C} + 33.25\\ ^{\\circ}\\mathrm{C} = 73.25\\ ^{\\circ}\\mathrm{C}$$\n\n2.  计算此温度下的漏电功耗 $P_{\\mathrm{leak},5}$：\n    $$P_{\\mathrm{leak},5}(T_{j,5}) = V_{\\mathrm{DD},5} \\, I_{\\mathrm{leak},5}(T_{\\mathrm{ref}}) \\, 2^{\\frac{T_{j,5} - T_{\\mathrm{ref}}}{10}}$$\n    $$P_{\\mathrm{leak},5}(T_{j,5}) = (0.70\\ \\mathrm{V}) \\cdot \\left(\\frac{25.0}{0.70}\\ \\mathrm{A}\\right) \\cdot 2^{\\frac{73.25 - 60}{10}} = 25.0 \\cdot 2^{\\frac{13.25}{10}}\\ \\mathrm{W} = 25.0 \\cdot 2^{1.325}\\ \\mathrm{W}$$\n\n3.  计算暗硅比例 $d_5$：\n    $$d_5 = \\frac{P_{\\mathrm{dyn,full}} - P_{\\max} + P_{\\mathrm{leak},5}(T_{j,5})}{P_{\\mathrm{dyn,full}}}$$\n    $$d_5 = \\frac{120 - 95 + 25.0 \\cdot 2^{1.325}}{120} = \\frac{25 + 25.0 \\cdot 2^{1.325}}{120}$$\n\n**计算缩放因子（比率）：**\n最后，我们计算比率 $\\frac{d_{5\\ \\mathrm{nm}}}{d_{28\\ \\mathrm{nm}}}$。\n$$\\frac{d_{5}}{d_{28}} = \\frac{\\frac{25 + 25.0 \\cdot 2^{1.325}}{120}}{\\frac{25 + 10.0 \\cdot 2^{0.375}}{120}} = \\frac{25 + 25.0 \\cdot 2^{1.325}}{25 + 10.0 \\cdot 2^{0.375}}$$\n现在，我们代入指数项的数值：\n$2^{0.375} \\approx 1.29684$\n$2^{1.325} \\approx 2.50455$\n$$\\frac{d_5}{d_{28}} \\approx \\frac{25 + 25.0 \\cdot (2.50455)}{25 + 10.0 \\cdot (1.29684)} = \\frac{25 + 62.61375}{25 + 12.9684} = \\frac{87.61375}{37.9684}$$\n$$\\frac{d_5}{d_{28}} \\approx 2.307542$$\n将结果四舍五入到四位有效数字，得到 $2.308$。",
            "answer": "$$\\boxed{2.308}$$"
        },
        {
            "introduction": "在认识到暗硅问题后，架构师们开始思考如何“化危为机”，将“暗硅”视为一种可管理的资源。本练习将探讨一种架构上的权衡策略：将一部分功耗预算从不常用的芯片部件（如三级缓存）中解放出来，用于提升核心处理器的频率。通过分析，你将发现这种策略的有效性高度依赖于应用程序的特性，这揭示了在后登纳德时代进行负载感知功耗管理的必要性。",
            "id": "3639291",
            "problem": "一个在登纳德缩放（Dennard scaling）时代结束后设计的多核处理器，拥有八个相同的核心和一个共享的三级（L3）缓存。该芯片的热设计功耗（TDP）为 $95$ W。在一个启用L3缓存的标称工作点，核心以 $f_0 = 2.5$ GHz 的频率运行，芯片总功耗等于TDP。在此标称工作点，L3缓存消耗 $20$ W，八个核心共同消耗剩余的功率。假设核心动态功耗遵循标准的开关关系 $P_{\\text{dyn}} = \\alpha C V^2 f$，并且在该技术中，为了实现更高频率，$V$ 在允许范围内与 $f$ 近似线性相关，因此对于某个常数 $k$，$V = k f$。漏电功耗存在，但在所考虑的微小电压/频率变化范围内近似恒定，并且在微分分析中可以忽略不计。\n\n当L3缓存被禁用（保持关闭）以节省功耗时，所有节省的L3功耗通过提高核心的供电电压和频率重新分配给核心，直到芯片再次达到TDP。禁用L3后，存储器层次结构只包含一级（L1）和二级（L2）缓存；在启用L3的情况下L3命中的访问，在禁用L3的情况下将变成对主内存（DRAM）的访问。考虑两类应用：\n\n- 计算密集型应用：基础每指令周期数 $c_{\\text{CB}} = 1.0$，每指令平均内存操作数 $a_{\\text{CB}} = 0.01$。\n- 内存密集型应用：基础每指令周期数 $c_{\\text{MB}} = 1.5$，每指令平均内存操作数 $a_{\\text{MB}} = 0.30$。\n\n假设以下内存参数对所有应用均适用：\n- 每次内存操作的L1未命中概率 $m_1 = 0.10$。\n- 在L1未命中的情况下，L2的条件未命中概率 $m_2 = 0.50$。\n- 在启用L3的情况下，L2未命中时L3的条件未命中概率 $m_3 = 0.20$。\n- L2命中停顿时间 $T_{L2} = 6$ ns。\n- L3命中停顿时间 $T_{L3} = 20$ ns。\n- DRAM停顿时间 $T_{\\text{DRAM}} = 80$ ns。\n\n假设顺序依赖性阻止了内存停顿时间与计算时间的重叠；停顿时间线性相加，基础每指令周期数通过 $(\\text{周期数})/f$ 转换为时间。所有内存停顿时间均为绝对时间（纳秒），且不依赖于核心频率。忽略预取效应和写回成本。\n\n仅使用上述基本关系，确定当禁用L3缓存并提高核心时钟频率以保持在TDP内时，净性能变化。将性能定义为每秒指令数，并将“禁用L3，更高 $f$”配置相对于标称“启用L3，频率 $f_0$”配置的加速比定义为新吞吐量与旧吞吐量之比。计算两个加速比：一个用于计算密集型应用，一个用于内存密集型应用。将这两个加速比表示为无单位的十进制数值，顺序为“计算密集型，内存密集型”。将最终值四舍五入到四位有效数字。",
            "solution": "经评估，用户提供的问题是有效的，因为它在科学上基于计算机体系结构的原理，问题设定良好，参数完整且一致，并且表述客观。该问题提出了一个关于后登纳德缩放时代处理能力与存储器层次结构性能之间权衡的现实场景，这通常被称为暗硅问题。因此，我们可以进行完整的解答。\n\n解决方案分为三个部分：\n1.  计算当功耗从L3缓存重新分配后，新的核心频率。\n2.  计算两种配置（启用L3与禁用L3）的平均内存停顿时间。\n3.  计算两种指定应用的整体性能加速比。\n\n**1. 核心频率计算**\n\n问题陈述核心动态功耗 $P_{\\text{dyn}}$ 与电源电压 $V$ 和频率 $f$ 的关系为 $P_{\\text{dyn}} = \\alpha C V^2 f$，其中 $\\alpha$ 和 $C$ 是常数。此外，电压与频率线性相关，$V = kf$。将电压关系代入功耗方程，得到：\n$$P_{\\text{dyn}} = \\alpha C (kf)^2 f = (\\alpha C k^2) f^3$$\n由于在此微分分析中漏电功耗被认为是可忽略的，核心总功耗 $P_{\\text{cores}}$ 与频率的立方成正比：\n$$P_{\\text{cores}} = A f^3$$\n其中 $A$ 是一个比例常数。\n\n在标称配置（启用L3缓存）中，芯片的总功耗为热设计功耗（TDP），$P_{\\text{TDP}} = 95$ W。L3缓存消耗 $P_{L3} = 20$ W。剩余的功耗由8个核心消耗。\n$$P_{\\text{cores},0} = P_{\\text{TDP}} - P_{L3} = 95 \\text{ W} - 20 \\text{ W} = 75 \\text{ W}$$\n此功耗水平对应于标称频率 $f_0 = 2.5$ GHz。\n\n当L3缓存被禁用（“暗”）时，其功耗变为零，这部分功耗被重新分配给核心。芯片总功耗保持在TDP，因此核心的新功率预算为：\n$$P_{\\text{cores}, \\text{new}} = P_{\\text{TDP}} = 95 \\text{ W}$$\n\n我们可以通过建立功耗-频率关系的比率来求出新频率 $f_{\\text{new}}$：\n$$\\frac{P_{\\text{cores}, \\text{new}}}{P_{\\text{cores}, 0}} = \\frac{A f_{\\text{new}}^3}{A f_0^3} = \\left(\\frac{f_{\\text{new}}}{f_0}\\right)^3$$\n求解 $f_{\\text{new}}$：\n$$f_{\\text{new}} = f_0 \\left(\\frac{P_{\\text{cores}, \\text{new}}}{P_{\\text{cores}, 0}}\\right)^{1/3} = 2.5 \\text{ GHz} \\times \\left(\\frac{95}{75}\\right)^{1/3} = 2.5 \\text{ GHz} \\times \\left(\\frac{19}{15}\\right)^{1/3}$$\n数值上，$f_{\\text{new}} \\approx 2.7050$ GHz。\n\n**2. 内存停顿时间计算**\n\n每次内存操作的平均停顿时间 $T_{\\text{stall, mem-op}}$ 由存储器层次结构的未命中概率和惩罚延迟决定。停顿由L1未命中引发。惩罚是从下一级层次结构中检索数据所需的时间。\n\n每次内存操作的平均停顿时间由下式给出：\n$$T_{\\text{stall, mem-op}} = m_1 \\times (\\text{L1未命中惩罚})$$\n其中 $m_1$ 是L1未命中概率。L1未命中的惩罚取决于数据在何处被找到（L2、L3或DRAM）。\n$$\\text{L1未命中惩罚} = (1-m_2)T_{L2} + m_2 \\times (\\text{L2未命中惩罚})$$\n其中 $m_2$ 是在L1未命中情况下的条件L2未命中概率，$T_{L2}$ 是L2命中停顿时间。\n\n**配置1：启用L3缓存**\n\n在这种情况下，L2未命中可以由L3缓存或主内存（DRAM）服务。\n$$\\text{L2未命中惩罚}_{\\text{enabled}} = (1-m_3)T_{L3} + m_3 T_{\\text{DRAM}}$$\n其中 $m_3$ 是条件L3未命中概率。\n\n综合这些，每次内存操作的平均停顿时间为：\n$$T_{\\text{stall, enabled}} = m_1 \\left( (1-m_2)T_{L2} + m_2 \\left[ (1-m_3)T_{L3} + m_3 T_{\\text{DRAM}} \\right] \\right)$$\n使用给定值：$m_1=0.10$，$m_2=0.50$，$m_3=0.20$，$T_{L2}=6$ ns，以及 $T_{L3}=20$ ns，$T_{\\text{DRAM}}=80$ ns。\n$$T_{\\text{stall, enabled}} = 0.10 \\left( (1-0.50)(6) + 0.50 \\left[ (1-0.20)(20) + (0.20)(80) \\right] \\right) \\text{ ns}$$\n$$T_{\\text{stall, enabled}} = 0.10 \\left( (0.50)(6) + 0.50 \\left[ (0.80)(20) + 16 \\right] \\right) \\text{ ns}$$\n$$T_{\\text{stall, enabled}} = 0.10 \\left( 3 + 0.50 \\left[ 16 + 16 \\right] \\right) \\text{ ns} = 0.10 \\left( 3 + 0.50(32) \\right) \\text{ ns}$$\n$$T_{\\text{stall, enabled}} = 0.10 \\left( 3 + 16 \\right) \\text{ ns} = 1.9 \\text{ ns}$$\n\n**配置2：禁用L3缓存**\n\n当L3缓存被禁用时，L2缓存中的任何未命中都必须由DRAM服务。这等同于将L3未命中概率设置为 $m_3=1$。\n$$\\text{L2未命中惩罚}_{\\text{disabled}} = T_{\\text{DRAM}}$$\n平均停顿时间变为：\n$$T_{\\text{stall, disabled}} = m_1 \\left( (1-m_2)T_{L2} + m_2 T_{\\text{DRAM}} \\right)$$\n$$T_{\\text{stall, disabled}} = 0.10 \\left( (1-0.50)(6) + 0.50(80) \\right) \\text{ ns}$$\n$$T_{\\text{stall, disabled}} = 0.10 \\left( (0.50)(6) + 40 \\right) \\text{ ns} = 0.10 \\left( 3 + 40 \\right) \\text{ ns}$$\n$$T_{\\text{stall, disabled}} = 4.3 \\text{ ns}$$\n\n**3. 性能加速比计算**\n\n执行一条指令的总时间 $T_{\\text{inst}}$ 是核心计算时间和内存停顿时间之和。\n$$T_{\\text{inst}} = T_{\\text{compute}} + T_{\\text{stall}} = \\frac{c_{\\text{base}}}{f} + a \\times T_{\\text{stall, mem-op}}$$\n其中 $c_{\\text{base}}$ 是基础每指令周期数，$a$ 是每指令平均内存操作数。\n\n加速比 $S$ 是新吞吐量与旧吞吐量之比。吞吐量是每秒指令数，即 $1/T_{\\text{inst}}$。\n$$S = \\frac{\\text{吞吐量}_{\\text{new}}}{\\text{吞吐量}_{\\text{enabled}}} = \\frac{1 / T_{\\text{inst, new}}}{1 / T_{\\text{inst, enabled}}} = \\frac{T_{\\text{inst, enabled}}}{T_{\\text{inst, new}}}$$\n\n我们现在为这两类应用计算该值。注意，频率 $f$ 的单位是GHz，意味着 $1/f$ 的单位是纳秒。\n\n**计算密集型应用** ($c_{\\text{CB}} = 1.0$, $a_{\\text{CB}} = 0.01$)\n\n每条指令的时间（启用L3，标称频率 $f_0$）：\n$$T_{\\text{inst, enabled, CB}} = \\frac{c_{\\text{CB}}}{f_0} + a_{\\text{CB}} T_{\\text{stall, enabled}} = \\frac{1.0}{2.5} + 0.01 \\times 1.9 = 0.4 + 0.019 = 0.419 \\text{ ns}$$\n每条指令的时间（禁用L3，新频率 $f_{\\text{new}}$）：\n$$T_{\\text{inst, new, CB}} = \\frac{c_{\\text{CB}}}{f_{\\text{new}}} + a_{\\text{CB}} T_{\\text{stall, disabled}} = \\frac{1.0}{2.5 \\left(\\frac{19}{15}\\right)^{1/3}} + 0.01 \\times 4.3 \\approx 0.369686 \\text{ ns} + 0.043 \\text{ ns} = 0.412686 \\text{ ns}$$\n计算密集型应用的加速比：\n$$S_{\\text{CB}} = \\frac{T_{\\text{inst, enabled, CB}}}{T_{\\text{inst, new, CB}}} = \\frac{0.419}{0.412686} \\approx 1.015300$$\n四舍五入到四位有效数字，加速比为 $1.015$。\n\n**内存密集型应用** ($c_{\\text{MB}} = 1.5$, $a_{\\text{MB}} = 0.30$)\n\n每条指令的时间（启用L3，标称频率 $f_0$）：\n$$T_{\\text{inst, enabled, MB}} = \\frac{c_{\\text{MB}}}{f_0} + a_{\\text{MB}} T_{\\text{stall, enabled}} = \\frac{1.5}{2.5} + 0.30 \\times 1.9 = 0.6 + 0.57 = 1.17 \\text{ ns}$$\n每条指令的时间（禁用L3，新频率 $f_{\\text{new}}$）：\n$$T_{\\text{inst, new, MB}} = \\frac{c_{\\text{MB}}}{f_{\\text{new}}} + a_{\\text{MB}} T_{\\text{stall, disabled}} = \\frac{1.5}{2.5 \\left(\\frac{19}{15}\\right)^{1/3}} + 0.30 \\times 4.3 \\approx 0.554528 \\text{ ns} + 1.29 \\text{ ns} = 1.844528 \\text{ ns}$$\n内存密集型应用的加速比：\n$$S_{\\text{MB}} = \\frac{T_{\\text{inst, enabled, MB}}}{T_{\\text{inst, new, MB}}} = \\frac{1.17}{1.844528} \\approx 0.634323$$\n四舍五入到四位有效数字，加速比为 $0.6343$。小于1的值表示减速。",
            "answer": "$$\\boxed{\\begin{pmatrix} 1.015  0.6343 \\end{pmatrix}}$$"
        }
    ]
}