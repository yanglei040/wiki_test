{
    "hands_on_practices": [
        {
            "introduction": "处理器的性能并不仅仅取决于其时钟频率或发射宽度。程序的内在结构，特别是指令之间的依赖关系，构成了性能的根本瓶颈。这项练习将帮助你通过一个简化的思想实验，直观地理解关键路径（由依赖链决定）和可用指令级并行（ILP）之间的相互作用，这是理解超标量处理器性能的基础。",
            "id": "3661275",
            "problem": "考虑一个超标量多发射处理器，其发射宽度 $W=4$，在满足相关性的前提下，每个周期最多可以派发 $W$ 条指令。假设算术逻辑单元（ALU）是全流水线的，每条ALU指令具有单周期延迟，并且前递（forwarding）确保了依赖于前一结果的指令可以在紧接着的下一个周期被发射，无需停顿。该处理器实现了乱序执行（OoOE），具有完美的寄存器重命名、完美的分支预测，并且没有缓存或内存停顿，因此只有真实数据相关性和有限的发射宽度会限制调度。\n\n给定一个微内核，它由一个包含 $D=10$ 条ALU指令的纯相关链组成，其中每条指令都依赖于其直接前驱指令的结果。在第一部分中，该内核没有其他指令。在第二部分中，假设我们额外有 $k$ 条ALU指令，这些指令与所有其他指令完全无关，并且可以任意交错以最大化吞吐量，硬件假设与之前相同。\n\n- 从第一性原理以及发射宽度和指令级并行性的核心定义出发，推导在该 $W=4$ 处理器上完成这 $D=10$ 条指令的相关链所需的最少周期数。\n- 然后，推导一个关于 $k$ 的封闭形式表达式，表示可达到的最佳每周期指令数（IPC）提升。该提升定义为混合 $D+k$ 条指令时的IPC除以仅有 $D$ 条指令的基准IPC。\n\n将您的最终结果表示为第一部分的最小周期数（一个整数）和第二部分的IPC提升（一个关于 $k$ 的封闭形式解析表达式）。无需四舍五入，也无物理单位。按规定格式表达最终答案。",
            "solution": "问题要求关于超标量处理器性能的两个结果。第一，执行一个严格相关链所需的时间。第二，当加入无关指令时IPC的提升。我们首先分析题目所描述的处理器的约束和能力。\n\n处理器发射宽度为 $W=4$，意味着每个周期最多可以发射 $4$ 条指令。执行是乱序的，并带有完美的寄存器重命名，这消除了除真实数据相关（写后读）之外的所有相关性。问题通过假设完美的分支预测和无内存停顿来简化环境，因此性能仅受指令相关性和有限的发射宽度限制。ALU指令有 $1$ 个周期的延迟，而完全前递允许依赖于某条指令的后继指令在该指令发射后的紧邻周期内被发射。\n\n### 第一部分：D条指令链的最小周期数\n\n设这 $D=10$ 条指令的纯相关链表示为 $I_1, I_2, \\dots, I_{10}$。其相关结构为：对于 $j \\in \\{1, 2, \\dots, 9\\}$，指令 $I_{j+1}$ 需要 $I_j$ 的结果。\n\n处理器处理相关性的能力是关键。题目规定，$1$ 周期延迟与完全前递相结合意味着“依赖于前一结果的指令可以在紧接着的下一个周期被发射”。让我们根据这条规则追踪该链的执行过程：\n\n- 在周期 $c=1$ 时，指令 $I_1$ 可以被发射。\n- 在周期 $c=2$ 时，由于 $I_2$ 依赖于 $I_1$，它可以被发射。处理器的乱序执行能力和前递逻辑使得 $I_1$ 的结果可用于 $I_2$ 的执行。\n- 这个模式会持续下去。对于链中的任意指令 $I_j$，它可以在周期 $c=j$ 被发射。\n\n因此，这些指令的发射情况如下：\n- $I_1$ 在周期 $1$ 发射。\n- $I_2$ 在周期 $2$ 发射。\n- ...\n- $I_{10}$ 在周期 $10$ 发射。\n\n发射宽度 $W=4$ 无法加速这个序列，因为链本身内部没有指令级并行性（ILP）。在任何给定的周期，序列中只有一条指令准备好被发射。该周期内其他 $W-1=3$ 个发射槽将保持未使用状态。\n\n问题要求的是*完成*该链所需的周期数。一条ALU指令有 $1$ 个周期的延迟。假设这意味着在周期 $c$ 发射的指令在周期 $c$ 结束时完成执行，那么整个序列的完成时间由最后一条指令 $I_{10}$ 的完成时间决定。\n\n由于 $I_{10}$ 在周期 $10$ 发射，它在周期 $10$ 的末尾完成。因此，完成这 $D=10$ 条指令链所需的最少周期数为 $10$。\n\n一般来说，对于一个长度为 $D$ 的相关链，如果每个环节的发射延迟为 $1$ 个周期，则总时间为 $D$ 个周期。对于此部分，当 $D=10$ 时，周期数为 $10$。\n\n### 第二部分：加入 k 条无关指令后的IPC提升\n\n首先，我们建立仅有 $D=10$ 条指令链时的基准性能。\n- 指令数，$N_{\\text{base}} = D = 10$。\n- 周期数，$C_{\\text{base}} = D = 10$（来自第一部分）。\n- 基准每周期指令数，$\\text{IPC}_{\\text{base}} = \\frac{N_{\\text{base}}}{C_{\\text{base}}} = \\frac{10}{10} = 1$。\n\n接下来，我们分析增加了 $k$ 条完全无关的ALU指令的新场景。\n- 总指令数，$N_{\\text{new}} = D+k = 10+k$。\n- 我们必须找到执行这 $D+k$ 条混合指令所需的最少周期数 $C_{\\text{new}}$。\n\n在超标量处理器上执行一段代码的执行时间根本上受到两个因素的制约：关键路径长度（深度/跨度）和所需的总工作量（work）。\n1.  **深度约束：** 执行时间必须至少等于最长相关计算链的长度。在这种情况下，关键路径是 $D$ 指令链，根据第一部分的结论，它需要 $D$ 个周期。因此，$C_{\\text{new}} \\ge D$。\n2.  **工作量约束：** 处理器每个周期最多可以执行 $W$ 条指令。要执行总共 $N_{\\text{new}} = D+k$ 条指令，周期数必须至少是总指令数除以发射宽度。因此，$C_{\\text{new}} \\ge \\lceil \\frac{D+k}{W} \\rceil$。\n\n结合这两个下界，可能的最小周期数是两者的最大值：\n$$C_{\\text{new}} \\ge \\max\\left(D, \\left\\lceil \\frac{D+k}{W} \\right\\rceil\\right)$$\n对于一个理想的乱序调度器，这个下界是可以达到的。调度器可以优先处理关键路径上的指令（$I_j$），同时利用剩余的发射槽来执行无关指令。\n- 在每个周期 $j \\in \\{1, \\dots, D\\}$，调度器发射 $I_j$。这会消耗一个发射槽。\n- 在这 $D$ 个周期中的每一个周期，剩余的 $W-1$ 个发射槽可用于执行 $k$ 条无关指令。\n- 如果 $D \\ge \\lceil \\frac{D+k}{W} \\rceil$，这可以简化为 $k \\le D(W-1)$，那么在前 $D$ 个周期内有足够的“空闲”槽来执行所有 $k$ 条无关指令。执行在 $I_D$ 完成时结束，所以 $C_{\\text{new}} = D$。\n- 如果 $D  \\lceil \\frac{D+k}{W} \\rceil$，这可以简化为 $k > D(W-1)$，那么总指令数是限制因素。所有 $D$ 条关键路径指令和 $D(W-1)$ 条无关指令在头 $D$ 个周期内被发射。剩下的 $k - D(W-1)$ 条无关指令在随后的周期中使用所有 $W$ 个发射槽来发射。总时间由工作量约束决定。因此，$C_{\\text{new}} = \\lceil \\frac{D+k}{W} \\rceil$。\n\n这两种情况可以被完美地概括为以下表达式：\n$$C_{\\text{new}}(k) = \\max\\left(D, \\left\\lceil \\frac{D+k}{W} \\right\\rceil\\right)$$\n现在，我们可以计算混合了 $D+k$ 条指令的新IPC：\n$$\\text{IPC}_{\\text{new}}(k) = \\frac{N_{\\text{new}}}{C_{\\text{new}}(k)} = \\frac{D+k}{\\max\\left(D, \\left\\lceil \\frac{D+k}{W} \\right\\rceil\\right)}$$\n问题要求的是IPC提升，定义为比率 $\\frac{\\text{IPC}_{\\text{new}}}{\\text{IPC}_{\\text{base}}}$。\n由于 $\\text{IPC}_{\\text{base}}=1$，提升量 $I(k)$ 就是 $\\text{IPC}_{\\text{new}}(k)$。\n$$I(k) = \\frac{D+k}{\\max\\left(D, \\left\\lceil \\frac{D+k}{W} \\right\\rceil\\right)}$$\n代入给定值 $D=10$ 和 $W=4$，我们得到IPC提升作为 $k$ 的函数的封闭形式表达式：\n$$I(k) = \\frac{10+k}{\\max\\left(10, \\left\\lceil \\frac{10+k}{4} \\right\\rceil\\right)}$$\n这个表达式是问题第二部分的答案。\n\n最终结果总结：\n- 第一部分：最小周期数 = $10$。\n- 第二部分：IPC提升 $I(k) = \\frac{10+k}{\\max\\left(10, \\left\\lceil \\frac{10+k}{4} \\right\\rceil\\right)}$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 10  \\frac{10+k}{\\max\\left(10, \\left\\lceil \\frac{10+k}{4} \\right\\rceil\\right)} \\end{pmatrix}}$$"
        },
        {
            "introduction": "在掌握了并行性的理论极限后，让我们来扮演一次处理器调度器的角色。这个练习将你置于一个具体的调度情境中，你需要为一个指令序列在拥有有限功能单元（如ALU和内存单元）的处理器上安排执行顺序。通过解决这个调度难题，你将亲身体验如何在满足数据依赖性的同时，高效地利用硬件资源，从而最小化总执行时间。",
            "id": "3661333",
            "problem": "一个多发射处理器每周期最多可启动 $W=3$ 个操作，并包含两个算术逻辑单元（ALU）和一个存储单元（MEM）。考虑一个由有向无环图（DAG）表示的程序片段，该图有 $25$ 个节点 $v_1, v_2, \\dots, v_{25}$，其中每个节点都是一个单操作，在其所需资源上恰好占用一个周期，并在该周期结束时产生其输出。一条边 $v_i \\to v_j$ 表示一个写后读（RAW）相关：节点 $v_j$ 只能在严格晚于 $v_i$ 的周期中被调度。该机器在任何周期内最多可以发射两个 ALU 操作和一个 MEM 操作；不存在其他结构冒险。\n\n每个节点 $v_i$ 都有一个操作类型 $T(v_i) \\in \\{\\mathrm{ALU}, \\mathrm{MEM}\\}$，如下所示：\n- 链上节点与类型：$T(v_1)=\\mathrm{MEM}$, $T(v_2)=\\mathrm{ALU}$, $T(v_3)=\\mathrm{ALU}$, $T(v_4)=\\mathrm{MEM}$, $T(v_5)=\\mathrm{ALU}$, $T(v_6)=\\mathrm{MEM}$, $T(v_7)=\\mathrm{ALU}$, $T(v_8)=\\mathrm{ALU}$, $T(v_9)=\\mathrm{MEM}$, $T(v_{10})=\\mathrm{ALU}$, $T(v_{11})=\\mathrm{MEM}$, $T(v_{12})=\\mathrm{ALU}$。\n- 链外节点与类型：$T(v_{13})=\\mathrm{ALU}$, $T(v_{14})=\\mathrm{ALU}$, $T(v_{15})=\\mathrm{ALU}$, $T(v_{16})=\\mathrm{ALU}$, $T(v_{17})=\\mathrm{MEM}$, $T(v_{18})=\\mathrm{ALU}$, $T(v_{19})=\\mathrm{ALU}$, $T(v_{20})=\\mathrm{MEM}$, $T(v_{21})=\\mathrm{ALU}$, $T(v_{22})=\\mathrm{ALU}$, $T(v_{23})=\\mathrm{MEM}$, $T(v_{24})=\\mathrm{ALU}$, $T(v_{25})=\\mathrm{ALU}$。\n\n写后读（RAW）相关（有向边）如下：\n- 链上边：$v_1 \\to v_2 \\to v_3 \\to v_4 \\to v_5 \\to v_6 \\to v_7 \\to v_8 \\to v_9 \\to v_{10} \\to v_{11} \\to v_{12}$。\n- 链外边：$v_1 \\to v_{13}$, $v_1 \\to v_{14}$, $v_2 \\to v_{15}$, $v_2 \\to v_{16}$, $v_2 \\to v_{17}$, $v_4 \\to v_{21}$, $v_5 \\to v_{24}$, $v_8 \\to v_{22}$, $v_9 \\to v_{23}$, $v_{11} \\to v_{25}$。节点 $v_{18}$、$v_{19}$ 和 $v_{20}$ 没有入边。\n\n所有操作的执行延迟均为一个周期，在该周期结束时产生结果，并且仅在该周期内占用其类型对应的资源。任何操作都不能与其任何前驱节点在同一周期内调度。\n\n任务：在这些约束条件下，构建一个有效的调度以最小化完成时间（完工时间），然后计算：\n- 完成所有 $25$ 个节点所需的总周期数。\n- ALU 和 MEM 资源的利用率，分别定义为\n  执行的总 ALU 操作周期数与总 ALU 容量（在整个调度期间，每个周期 2 个单元）的比率，以及\n  执行的总 MEM 操作周期数与总 MEM 容量（在整个调度期间，每个周期 1 个单元）的比率。\n将利用率值表示为小数或分数，不带百分号。按顺序报告您的最终答案：（总周期数, ALU 利用率, MEM 利用率）。",
            "solution": "用户希望我解决一个针对多发射处理器的调度问题。\n\n### **问题验证**\n\n**第1步：提取已知信息**\n\n- 处理器发射宽度：$W=3$ 个操作/周期。\n- 功能单元：2个算术逻辑单元（ALU），1个存储单元（MEM）。\n- 总操作（节点）数：$N=25$，标记为 $v_1, \\dots, v_{25}$。\n- 操作延迟：所有操作均为1个周期。\n- 相关性约束：对于一条边 $v_i \\to v_j$，$v_j$ 必须在严格晚于 $v_i$ 的周期被调度。\n- 操作类型 $T(v_i)$:\n    -   $T(v_1)=\\mathrm{MEM}$, $T(v_2)=\\mathrm{ALU}$, $T(v_3)=\\mathrm{ALU}$, $T(v_4)=\\mathrm{MEM}$, $T(v_5)=\\mathrm{ALU}$, $T(v_6)=\\mathrm{MEM}$, $T(v_7)=\\mathrm{ALU}$, $T(v_8)=\\mathrm{ALU}$, $T(v_9)=\\mathrm{MEM}$, $T(v_{10})=\\mathrm{ALU}$, $T(v_{11})=\\mathrm{MEM}$, $T(v_{12})=\\mathrm{ALU}$。\n    -   $T(v_{13})=\\mathrm{ALU}$, $T(v_{14})=\\mathrm{ALU}$, $T(v_{15})=\\mathrm{ALU}$, $T(v_{16})=\\mathrm{ALU}$, $T(v_{17})=\\mathrm{MEM}$, $T(v_{18})=\\mathrm{ALU}$, $T(v_{19})=\\mathrm{ALU}$, $T(v_{20})=\\mathrm{MEM}$, $T(v_{21})=\\mathrm{ALU}$, $T(v_{22})=\\mathrm{ALU}$, $T(v_{23})=\\mathrm{MEM}$, $T(v_{24})=\\mathrm{ALU}$, $T(v_{25})=\\mathrm{ALU}$。\n- 写后读（RAW）相关（边）：\n    - 链上：$v_1 \\to v_2 \\to v_3 \\to v_4 \\to v_5 \\to v_6 \\to v_7 \\to v_8 \\to v_9 \\to v_{10} \\to v_{11} \\to v_{12}$。\n    - 链外：$v_1 \\to v_{13}$, $v_1 \\to v_{14}$, $v_2 \\to v_{15}$, $v_2 \\to v_{16}$, $v_2 \\to v_{17}$, $v_4 \\to v_{21}$, $v_5 \\to v_{24}$, $v_8 \\to v_{22}$, $v_9 \\to v_{23}$, $v_{11} \\to v_{25}$。\n- 没有入边的节点：$v_{18}, v_{19}, v_{20}$。\n- 任务：计算最小完成时间（完工时间）、ALU利用率和MEM利用率。\n\n**第2步：使用提取的已知信息进行验证**\n\n- **科学性**：该问题是计算机体系结构中一个标准的指令调度问题。多发射处理器、功能单元、数据相关（RAW）和有向无环图（DAG）等概念是该领域的基础。该问题在科学上是合理的。\n- **良构性**：该问题要求找到一个最优调度（最小完工时间）并计算派生指标（利用率）。约束条件（相关性和资源）定义清晰，使得这个优化问题是良构的。存在唯一的最小完工时间，且利用率指标的定义明确无歧。\n- **客观性**：问题陈述使用了精确、形式化的语言，没有主观或模糊的术语。\n- **一致性检查**：\n    - 由于资源限制，每周期可启动的最大操作数为 $2$ (ALU) $+ 1$ (MEM) $= 3$，这与发射宽度 $W=3$ 一致。\n    - 所有 $25$ 个节点都有明确的类型，并且它们的相关性也已指定。\n    - 问题是自洽的，没有矛盾之处。\n\n**第3步：结论与行动**\n\n问题有效。这是一个在计算机体系结构领域定义良好、一致且具有科学依据的问题。我将继续提供完整解答。\n\n### **解题过程**\n\n目标是为这 $25$ 个操作找到一个调度，使其在满足数据相关和资源约束的前提下，最小化总执行时间（完工时间）。解决方案包括三个主要部分：计算完工时间的下界，构建一个最优调度，然后计算所需的指标。\n\n**1. 完工时间的下界**\n\n完工时间 $T$ 受几个因素限制：关键路径长度、资源限制和发射宽度。完工时间必须大于或等于这些下界中的最大值。\n\n- **相关性下界（关键路径）**：相关性DAG中最长路径的长度决定了由数据相关性所规定的最短时间。\n    - 主链是 $v_1 \\to v_2 \\to \\dots \\to v_{12}$。这条路径包含 $12$ 个节点。由于每个操作需要一个周期，且相关的操作只能在下一个周期开始，所以这条路径的长度是 $12$ 个周期。\n    - 我们必须检查是否有任何涉及链外节点的路径更长。例如，路径 $v_1 \\to v_2 \\to \\dots \\to v_{11} \\to v_{25}$ 的长度也是 $12$ 个节点。\n    - 没有其他路径比 $12$ 个节点更长。例如，$v_1 \\to \\dots \\to v_9 \\to v_{23}$ 的长度为 $10$ 个节点。\n    - 因此，关键路径长度为 $12$ 个周期。这给出了一个下界 $T \\ge 12$。\n\n- **资源下界**：\n    - 操作类型计数：\n        - ALU操作：$v_2, v_3, v_5, v_7, v_8, v_{10}, v_{12}, v_{13}, v_{14}, v_{15}, v_{16}, v_{18}, v_{19}, v_{21}, v_{22}, v_{24}, v_{25}$。总计ALU操作 = $17$ 个。\n        - MEM操作：$v_1, v_4, v_6, v_9, v_{11}, v_{17}, v_{20}, v_{23}$。总计MEM操作 = $8$ 个。\n    - ALU资源下界：有 $17$ 个ALU操作和 $2$ 个ALU单元，最短时间为 $\\lceil \\frac{17}{2} \\rceil = \\lceil 8.5 \\rceil = 9$ 个周期。\n    - MEM资源下界：有 $8$ 个MEM操作和 $1$ 个MEM单元，最短时间为 $\\lceil \\frac{8}{1} \\rceil = 8$ 个周期。\n\n- **发射宽度下界**：总共有 $25$ 个操作，发射宽度为 $3$，最短时间为 $\\lceil \\frac{25}{3} \\rceil = \\lceil 8.33 \\rceil = 9$ 个周期。\n\n综合这些，完工时间必须至少为 $T \\ge \\max(12, 9, 8, 9) = 12$ 个周期。现在的挑战是找到一个能达到这个下界的调度。\n\n**2. 调度构建**\n\n我们使用列表调度算法，逐周期构建调度，优先调度关键路径上的操作。一个节点如果其所有前驱都已完成，则其为“就绪”状态。\n\n- **周期 1**：\n    - 就绪节点：$v_1$ (MEM), $v_{18}$ (ALU), $v_{19}$ (ALU), $v_{20}$ (MEM)。\n    - 可用资源：2个ALU，1个MEM。\n    - 调度：$\\{ v_1, v_{18}, v_{19} \\}$。（$v_1$ 在关键路径上）。\n\n- **周期 2**：\n    - 就绪节点：$v_2$ (ALU), $v_{13}$ (ALU), $v_{14}$ (ALU)（由 $v_1$ 完成产生），以及 $v_{20}$ (MEM)。\n    - 调度：$\\{ v_2, v_{13}, v_{20} \\}$。（$v_2$ 在关键路径上；我们使用一个ALU槽位给 $v_2$，第二个给 $v_{13}$，MEM槽位给 $v_{20}$）。\n\n- **周期 3**：\n    - 就绪节点：$v_3$ (ALU), $v_{15}$ (ALU), $v_{16}$ (ALU), $v_{17}$ (MEM)（由 $v_2$ 完成产生），以及 $v_{14}$ (ALU)（来自上一周期）。\n    - 调度：$\\{ v_3, v_{14}, v_{17} \\}$。（$v_3$ 在关键路径上）。\n\n- **周期 4**：\n    - 就绪节点：$v_4$ (MEM)（由 $v_3$ 完成产生），以及 $v_{15}$ (ALU), $v_{16}$ (ALU)（来自上一周期）。\n    - 调度：$\\{ v_4, v_{15}, v_{16} \\}$。（$v_4$ 在关键路径上）。\n\n- **周期 5**：\n    - 就绪节点：$v_5$ (ALU), $v_{21}$ (ALU)（由 $v_4$ 完成产生）。\n    - 调度：$\\{ v_5, v_{21} \\}$。（$v_5$ 在关键路径上）。\n\n- **周期 6**：\n    - 就绪节点：$v_6$ (MEM), $v_{24}$ (ALU)（由 $v_5$ 完成产生）。\n    - 调度：$\\{ v_6, v_{24} \\}$。（$v_6$ 在关键路径上）。\n\n- **周期 7**：\n    - 就绪节点：$v_7$ (ALU)（由 $v_6$ 完成产生）。\n    - 调度：$\\{ v_7 \\}$。\n\n- **周期 8**：\n    - 就绪节点：$v_8$ (ALU)（由 $v_7$ 完成产生）。\n    - 调度：$\\{ v_8 \\}$。\n\n- **周期 9**：\n    - 就绪节点：$v_9$ (MEM), $v_{22}$ (ALU)（由 $v_8$ 完成产生）。\n    - 调度：$\\{ v_9, v_{22} \\}$。\n\n- **周期 10**：\n    - 就绪节点：$v_{10}$ (ALU), $v_{23}$ (MEM)（由 $v_9$ 完成产生）。\n    - 调度：$\\{ v_{10}, v_{23} \\}$。\n\n- **周期 11**：\n    - 就绪节点：$v_{11}$ (MEM)（由 $v_{10}$ 完成产生）。\n    - 调度：$\\{ v_{11} \\}$。\n\n- **周期 12**：\n    - 就绪节点：$v_{12}$ (ALU), $v_{25}$ (ALU)（由 $v_{11}$ 完成产生）。\n    - 调度：$\\{ v_{12}, v_{25} \\}$。\n\n所有 $25$ 个操作在 $12$ 个周期内完成。由于这与关键路径下界相匹配，所以此调度是最优的。\n\n**3. 指标计算**\n\n- **总周期数（完工时间）**：\n    最优调度的完工时间为 $12$ 个周期。\n\n- **ALU 利用率**：\n    - 执行的ALU操作总数 = $17$。\n    - 调度期间的ALU总容量 = (ALU单元数) $\\times$ (完工时间) = $2 \\times 12 = 24$ 个ALU周期。\n    - ALU 利用率 = $\\frac{\\text{总ALU操作数}}{\\text{总ALU容量}} = \\frac{17}{24}$。\n\n- **MEM 利用率**：\n    - 执行的MEM操作总数 = $8$。\n    - 调度期间的MEM总容量 = (MEM单元数) $\\times$ (完工时间) = $1 \\times 12 = 12$ 个MEM周期。\n    - MEM 利用率 = $\\frac{\\text{总MEM操作数}}{\\text{总MEM容量}} = \\frac{8}{12} = \\frac{2}{3}$。\n\n最终结果是：完工时间 $12$ 周期，ALU利用率 $\\frac{17}{24}$，MEM利用率 $\\frac{2}{3}$。",
            "answer": "$$\\boxed{\\begin{pmatrix} 12  \\frac{17}{24}  \\frac{2}{3} \\end{pmatrix}}$$"
        },
        {
            "introduction": "现代乱序执行处理器通过复杂的硬件结构（如重排序缓存和物理寄存器堆）来发掘并利用指令级并行。然而，这些结构本身的有限规模也会成为新的性能瓶颈。这项练习将引导你分析这些关键硬件资源如何限制处理器的并行能力，并最终决定其在真实循环负载下的稳态性能，即每周期指令数（IPC）。",
            "id": "3661308",
            "problem": "考虑一个正在执行紧凑循环的乱序、多发射处理器。该核心拥有一个大小为 $Q=64$ 条目的重排序缓冲区（ROB）和一个大小为 $R=128$ 个整数寄存器的物理寄存器重命名文件。循环体包含 $10$ 个独立的累加器更新（每次更新是对一个不同累加器寄存器的单周期整数加法）、一次循环计数器递增和一次检查循环计数器的条件分支。假设具有以下微架构特性：\n- 流水线在解码、发射和提交阶段每周期最多支持 $8$ 条指令。\n- 整数加法的延迟为 $1$ 个周期，且有足够的功能单元以避免除宽度限制之外的结构性冒险。\n- 分支预测器的动态分支错误预测率为 $m=0.02$，一次错误预测会产生 $F=12$ 个周期的恢复开销，在此期间没有指令被提交。\n- 内存系统不会引入停顿，也没有缓存未命中。\n- 寄存器重命名为每个目标寄存器分配一个物理寄存器，直到相应的指令提交，之后旧的物理寄存器被释放。\n- 分支指令本身不产生目标寄存器。\n\n利用ROB和重命名文件施加的基本约束，确定可以同时在执行中的循环迭代次数。然后，使用指令级并行（ILP）和每周期指令数（IPC）的定义，确定当ROB饱和时持续的 $IPC$。将最终的 $IPC$ 四舍五入到四位有效数字。将最终答案表示为一个不带单位的纯数字。",
            "solution": "该问题被认为是有效的，因为它科学地基于计算机体系结构的原理，问题设定良好且客观。它描述了一个乱序超标量处理器的标准性能分析场景。\n\n第一步是确定可以同时在执行中的最大循环迭代次数。这个量，记为 $K$，受到重排序缓冲区（ROB）和物理寄存器文件（PRF）大小的限制。\n\n给定的参数如下：\n- ROB 大小: $Q = 64$ 条目\n- PRF 大小: $R = 128$ 寄存器\n- 处理器宽度（解码、发射、提交）: $W = 8$ 指令/周期\n- 分支错误预测率: $m = 0.02$\n- 分支错误预测开销: $F = 12$ 周期\n\n循环体包含：\n- $10$ 次独立的累加器更新（整数加法）。\n- $1$ 次循环计数器递增（整数加法）。\n- $1$ 次条件分支。\n\n首先，我们分析每次循环迭代的资源需求。\n每次迭代的总指令数是 $N_{\\text{inst}} = 10 + 1 + 1 = 12$。\n写入目标寄存器的指令数量是累加器更新和循环计数器递增的总和，所以 $N_{\\text{reg}} = 10 + 1 = 11$。分支指令没有目标寄存器。\n\n接下来，我们评估对在执行中的迭代次数 $K$ 的约束。\n\n1.  **ROB 约束**：ROB必须为每条在执行中的指令保留一个条目。对于 $K$ 次迭代，总指令数为 $K \\times N_{\\text{inst}}$。这不能超过ROB的大小 $Q$。\n    $$K \\times N_{\\text{inst}} \\le Q$$\n    $$K \\times 12 \\le 64$$\n    $$K \\le \\frac{64}{12} \\approx 5.333$$\n    由于 $K$ 必须是整数，受ROB约束的最大迭代次数为 $K_{\\text{ROB}} = \\lfloor 5.333 \\rfloor = 5$。\n\n2.  **PRF 约束**：PRF必须为已提交的体系结构状态和在执行中的指令的推测性结果都提供寄存器。问题指明，循环修改了 $N_{\\text{reg}} = 11$ 个不同的体系结构寄存器（10个累加器和1个循环计数器）。所需的物理寄存器数量是最后提交状态所需寄存器和新推测值所需寄存器的总和。对于 $N_{\\text{reg}}$ 个体系结构寄存器中的每一个，都有一个已提交的值和来自 $K$ 个在执行中的迭代的 $K$ 个推测性未来值。一个计算所需物理寄存器数量的标准模型是 $N_{\\text{reg}} \\times (K+1)$。一个更常见且更简单的模型指出，PRF大小 $R$ 必须容纳体系结构寄存器加上推测性寄存器，其中推测性寄存器的数量等于具有目标寄存器的在执行中的指令数量。我们假设相关的体系结构状态空间仅由循环操作的 $N_{\\text{reg}}$ 个寄存器组成，因此需要跟踪的体系结构寄存器数量为 $N_{AR} = 11$。因此，所需的物理寄存器总数为 $N_{AR} + K \\times N_{\\text{reg}}$。\n    $$N_{AR} + K \\times N_{\\text{reg}} \\le R$$\n    $$11 + K \\times 11 \\le 128$$\n    $$11 \\times (K + 1) \\le 128$$\n    $$K + 1 \\le \\frac{128}{11} \\approx 11.636$$\n    $$K \\le 10.636$$\n    由于 $K$ 必须是整数，受PRF约束的最大迭代次数为 $K_{\\text{PRF}} = \\lfloor 10.636 \\rfloor = 10$。\n\n同时在执行中的总迭代次数受这两个约束中更严格的一个限制：\n$$K = \\min(K_{\\text{ROB}}, K_{\\text{PRF}}) = \\min(5, 10) = 5$$\n因此，处理器受ROB大小的限制，可以维持 $5$ 次迭代在执行中。每次迭代有 $N_{\\text{inst}}=12$ 条指令，这对应于ROB中有 $5 \\times 12 = 60$ 条指令，这证实了“ROB饱和”的条件。\n\n在ROB饱和的情况下，处理器的性能受限于指令可以被提交的速率，提交指令会释放ROB条目以供新指令使用。这是一个受提交限制的场景。持续的每周期指令数（IPC）由提交宽度和任何暂停提交的停顿决定。\n\n提交宽度为 $W = 8$ 指令/周期。在没有任何停顿的情况下，提交一次迭代的指令（$N_{\\text{inst}} = 12$）所需的平均周期数为：\n$$C_{\\text{commit}} = \\frac{N_{\\text{inst}}}{W} = \\frac{12}{8} = 1.5 \\text{ 周期/迭代}$$\n然而，由于分支错误预测，处理器也会经历停顿。问题指出，一次错误预测会产生 $F = 12$ 个周期的开销，在此期间没有指令被提交。每次迭代包含一个分支，错误预测率为 $m = 0.02$。每次迭代的平均开销周期数为：\n$$C_{\\text{penalty}} = m \\times F = 0.02 \\times 12 = 0.24 \\text{ 周期/迭代}$$\n每次迭代的总平均周期数 $C_{\\text{iter}}$ 是提交所需周期数和平均开销周期数的总和。\n$$C_{\\text{iter}} = C_{\\text{commit}} + C_{\\text{penalty}} = 1.5 + 0.24 = 1.74 \\text{ 周期/迭代}$$\n持续的IPC是每次迭代的指令数除以每次迭代的平均周期数。\n$$IPC = \\frac{N_{\\text{inst}}}{C_{\\text{iter}}} = \\frac{12}{1.74}$$\n$$IPC = \\frac{12}{1.5 + 0.24} = \\frac{1}{\\frac{1.5}{12} + \\frac{0.24}{12}} = \\frac{1}{\\frac{1}{8} + 0.02} = \\frac{1}{0.125 + 0.02} = \\frac{1}{0.145}$$\n$$IPC \\approx 6.8965517...$$\n问题要求将最终答案四舍五入到四位有效数字。\n$$IPC \\approx 6.897$$\n这个值代表了在给定的体系结构约束下，处理器执行此特定循环时的持续吞吐量。$K=5$ 的计算对于确认处理器有足够的在执行中工作量以达到受提交限制的状态至关重要，从而证明了这种基于吞吐量的分析是合理的。",
            "answer": "$$\\boxed{6.897}$$"
        }
    ]
}