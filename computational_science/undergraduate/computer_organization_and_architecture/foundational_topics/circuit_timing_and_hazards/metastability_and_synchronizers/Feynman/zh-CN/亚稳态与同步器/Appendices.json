{
    "hands_on_practices": [
        {
            "introduction": "在处理跨时钟域（CDC）问题时，一个常见误区是认为只需为多位数据总线的每一位独立添加同步器即可。本练习旨在揭示这种方法的内在风险。通过构建一个具体的反例并从第一性原理推导数据相干性的概率，您将亲身体会为何简单的并行同步方案可能导致灾难性的数据损坏，并理解数据相干性在CDC设计中的核心地位。",
            "id": "3658817",
            "problem": "考虑一个计算机系统中的异步时钟域交叉，其中一个时钟域中的生产者同步地将一个 $N$ 位数据总线更新为一个新字，而另一个时钟域中的消费者通过一个由两个级联的数据触发器（DFF）组成的按位的两级同步器来对该总线进行采样。没有握手信号、选通信号或编码保护；消费者只是在每个周期简单地对 $N$ 个独立同步器的输出进行采样。假设生产者在其时钟域的某个特定边沿将总线从一个旧字更新为一个新字，使得 $N$ 个比特中的每一个都发生翻转（即，所有 $N$ 个比特在源端同时改变）。由于亚稳态，每个比特的同步器都表现出可变的延迟：在更新发生在接近消费者采样边沿的条件下，一个给定的比特以概率 $p$ 在一个消费者周期后出现在消费者端，并以概率 $1-p$ 在两个消费者周期后出现。假设不同比特之间的延迟结果是独立同分布的。\n\n任务：\n1. 仅使用双稳态存储元件中亚稳态的定义以及两级同步器在缓解亚稳态中的作用，为 $N=2$ 构建一个具体的反例，该反例要能证明消费者可能瞬间观察到一个既不等于旧字也不等于新字的字。你的构造必须指定旧的和新的两位字，并解释按位同步器延迟的独立性如何能在消费者端产生一个混合字。\n2. 在相同的独立性模型下，从第一性原理推导出一个解析表达式，作为 $p$ 和 $N$ 的函数，表示消费者在给定采样时刻观察到的字是相干的概率。相干意味着该时刻采样的所有 $N$ 个比特都来自同一个源周期（要么全部是旧的，要么全部是新的）。将你的最终答案表示为关于 $p$ 和 $N$ 的单个闭式表达式。\n\n不需要进行数值近似；请提供精确的表达式。最终答案必须是单个解析表达式。",
            "solution": "该问题研究了在异步时钟域交叉期间数据总线不相干的可能性，并要求对此效应进行定量分析。该问题陈述是有效的。它的科学基础是数字电路中被充分理解的亚稳态现象，它的提法是恰当的，提供了所有必要的参数和定义，并且没有矛盾或歧义。该模型虽然是对一个复杂物理过程的简化，但它是分析同步器行为的架构性后果的一个标准且有效的抽象。我们着手处理任务的两个部分。\n\n**第1部分：$N=2$ 的反例**\n\n任务是构建一个场景，其中有一个 $N=2$ 位的总线，消费者会瞬间观察到一个既不是原始（旧）字也不是最终（新）字的字。\n\n设数据总线的两位为 $B_1$ 和 $B_0$。问题陈述所有比特都发生翻转。我们可以选择旧字为 $W_{\\text{old}} = 01_2$，新字为 $W_{\\text{new}} = 10_2$。对于这个选择，$W_{\\text{old}}$ 对应于位向量 $(B_1, B_0) = (0, 1)$，而 $W_{\\text{new}}$ 对应于 $(B_1, B_0) = (1, 0)$。两个比特都翻转了，符合要求。\n\n生产者在一个与消费者时钟异步的时间点将总线从 $W_{\\text{old}}$ 更新到 $W_{\\text{new}}$。每个比特都通过一个独立的两级同步器。由于潜在的亚稳态，每个比特的新值出现在消费者端的延迟是可变的。根据所提供的模型，对于每个比特 $i \\in \\{0, 1\\}$，其新值在 $1$ 个消费者时钟周期后被消费者观察到的概率为 $p$，在 $2$ 个消费者时钟周期后被观察到的概率为 $1-p$。\n\n我们分析在生产者更新后的第一个采样时刻消费者观察到的字。在这个瞬间，如果比特 $B_i$ 的同步器有 $1$ 个周期的延迟，它将呈现其新值；如果其同步器有 $2$ 个周期的延迟，它将保留其旧值。\n\n让我们考虑两个比特延迟的一个特定结果，它们是独立事件。假设比特 $B_1$ 的同步器有 $1$ 个周期的延迟，而比特 $B_0$ 的同步器有 $2$ 个周期的延迟。\n\\begin{itemize}\n    \\item 对于比特 $B_1$，1个周期的延迟意味着消费者采样到新值 $B_{1, \\text{new}} = 1$。\n    \\item 对于比特 $B_0$，2个周期的延迟意味着消费者采样到旧值 $B_{0, \\text{old}} = 1$。\n\\end{itemize}\n在这种情况下，消费者观察到的组合字是 $(B_1, B_0) = (1, 1)$，或 $11_2$。这个观察到的字 $11_2$ 既不等于旧字 $W_{\\text{old}} = 01_2$，也不等于新字 $W_{\\text{new}} = 10_2$。这就构成了所要求的反例。\n\n该事件发生的概率由每个比特延迟的独立概率的乘积给出：$P(B_1 \\text{ has } 1\\text{-cycle latency}) \\times P(B_0 \\text{ has } 2\\text{-cycle latency}) = p \\times (1-p)$。因为 $p$ 是与亚稳态解决相关的概率，其范围通常在 $0  p  1$ 之间，所以这个结果发生的概率非零。这个瞬态的、无效的字是按位同步器的独立、可变延迟的直接后果。\n\n**第2部分：相干概率的推导**\n\n任务是推导出一个表达式，表示消费者观察到的字是相干的概率。一个相干的字被定义为所有 $N$ 个比特都来自同一个源周期的字，这意味着观察到的字要么是完整的旧字，要么是完整的新字。本分析关注生产者更新后的第一个消费者采样时刻，因为根据给定模型，这是唯一可能出现不相干性的时间点。在所有后续的时刻，所有比特都将稳定到它们的新值。\n\n让我们考虑在这个关键的采样时刻 $N$ 个比特的状态。对于每个比特 $i \\in \\{1, 2, \\ldots, N\\}$，基于其同步器的延迟，有两种可能的结果：\n\\begin{enumerate}\n    \\item 同步器有1个周期的延迟：消费者采样到比特的*新*值。这发生的概率为 $p$。\n    \\item 同步器有2个周期的延迟：消费者采样到比特的*旧*值。这发生的概率为 $1-p$。\n\\end{enumerate}\n\n所有 $N$ 个比特的延迟结果都是独立同分布的。如果两个互斥事件之一发生，则观察到的 $N$ 位字是相coherent的：\n\n**事件A：所有比特都已翻转到其新值。**\n这意味着对于每个比特 $i=1, \\ldots, N$，同步器都有1个周期的延迟。由于事件是独立的，其概率是每个比特的独立概率的乘积：\n$$P(\\text{all bits are new}) = \\prod_{i=1}^{N} P(\\text{bit } i \\text{ is new}) = \\prod_{i=1}^{N} p = p^N$$\n在这种情况下，消费者观察到完整的新字 $W_{\\text{new}}$。\n\n**事件B：所有比特都保持其旧值。**\n这意味着对于每个比特 $i=1, \\ldots, N$，同步器都有2个周期的延迟。同样，利用独立性，其概率是各个独立概率的乘积：\n$$P(\\text{all bits are old}) = \\prod_{i=1}^{N} P(\\text{bit } i \\text{ is old}) = \\prod_{i=1}^{N} (1-p) = (1-p)^N$$\n在这种情况下，消费者观察到完整的旧字 $W_{\\text{old}}$。\n\n观察到相干字的总概率 $P(\\text{coherent})$ 是这两个互斥事件概率的总和。\n$$P(\\text{coherent}) = P(\\text{all bits are new}) + P(\\text{all bits are old})$$\n代入上面推导出的表达式，我们得到：\n$$P(\\text{coherent}) = p^N + (1-p)^N$$\n这就是采样字相干的概率关于 $p$ 和 $N$ 的闭式解析表达式。这也可以从二项分布的角度来看。令 $K$ 为已稳定到新值的比特数。则 $K \\sim \\text{Binomial}(N,p)$。如果 $K=N$（全部为新）或 $K=0$（全部为旧），则该字是相干的。其概率为 $P(K=N) + P(K=0) = \\binom{N}{N}p^N(1-p)^0 + \\binom{N}{0}p^0(1-p)^N = p^N + (1-p)^N$，这证实了结果。",
            "answer": "$$\n\\boxed{p^{N} + (1-p)^{N}}\n$$"
        },
        {
            "introduction": "在数字系统设计中，提高时钟频率是提升性能的常用手段，但这会压缩亚稳态的解析时间，从而对系统可靠性构成挑战。本练习将引导您量化分析时钟频率、同步器级数与平均无故障时间（MTBF）之间的权衡关系。通过计算在时钟加倍后需要增加多少同步级来维持原有的可靠性，您将掌握在追求更高性能时如何做出相应的设计调整以保证系统的稳定性。",
            "id": "3658885",
            "problem": "一个事件率为 $f_{d}$ 的单比特异步状态信号，使用一个由边沿触发触发器组成的链，同步到一个目标时钟域中。最初，目标时钟频率为 $f_{c0}$，同步器使用 $k_{0}$ 级。从可能进入亚稳态的第一个触发器到最终采样触发器之间可用的亚稳态解析时间建模为 $T_{r} = (k-1) T_{c} - \\delta$，其中 $k$ 是总级数，$T_{c}$ 是目标时钟周期，$\\delta$ 是一个集总了建立时间和传播延迟的恒定时间预算。该器件表现出由时间常数 $\\tau$ 表征的指数级亚稳态解析特性，所有与器件相关的常数和 $f_{d}$ 在不同工作点均保持不变。\n\n之后，目标时钟频率加倍至 $f_{c1} = 2 f_{c0}$。为了将平均无故障时间（MTBF）保持在其初始值，你考虑为同步器增加额外的级数。假设 $k_{0} = 2$，$f_{c0} = 250\\,\\text{MHz}$，$f_{d} = 10\\,\\text{MHz}$，$\\tau = 28\\,\\text{ps}$，且 $\\delta = 120\\,\\text{ps}$。你可以假设 $\\delta$ 不随频率变化而改变，并且同步器的标准指数MTBF-解析时间模型适用。\n\n确定：\n1) 时钟频率加倍后，为保持MTBF恒定所需增加的最小整数同步器级数。\n2) 从MTBF模型推导出的必须提供的额外解析时间 $\\Delta T_{r}$。\n\n将 $\\Delta T_{r}$ 以皮秒为单位表示，并四舍五入到三位有效数字。将你的最终答案以一个双元素行矩阵的形式提供，该矩阵按顺序包含额外级数和以皮秒为单位的 $\\Delta T_{r}$。在最终的方框答案中不要包含单位。",
            "solution": "双稳态元件保持亚稳态的概率随时间近似指数衰减。一个被广泛使用并经实验验证的同步器失效模型是，失效率与 $f_{c} f_{d}$ 的乘积成正比，再乘以一个由可用解析时间 $T_{r}$ 和器件时间常数 $\\tau$ 决定的指数衰减因子。因此，平均无故障时间（MTBF）建模为\n$$\n\\text{MTBF} = \\frac{1}{K f_{c} f_{d}} \\exp\\!\\left(\\frac{T_{r}}{\\tau}\\right),\n$$\n其中 $K$ 是一个与器件/工艺相关的常数，包含孔径/窗口因子和其他比例项。这个形式捕捉了两个关键事实：目标采样越频繁（$f_{c}$），异步事件发生越频繁（$f_{d}$），潜在的违例就越常发生；解析时间 $T_{r}$ 越长，违例传播的可能性就越小，其指数敏感性由 $\\tau$ 控制。\n\n我们已知，初始时目标时钟频率为 $f_{c0}$，改变后为 $f_{c1} = 2 f_{c0}$。异步事件率 $f_{d}$、$\\tau$ 和 $K$ 不变。为保持 MTBF 恒定，令初始和最终的 MTBF 相等，解出 $T_{r}$ 必须如何变化。\n\n设初始解析时间为 $T_{r0}$，最终所需的解析时间为 $T_{r1}$。令 MTBF 值相等，\n$$\n\\frac{1}{K f_{c0} f_{d}} \\exp\\!\\left(\\frac{T_{r0}}{\\tau}\\right)\n=\n\\frac{1}{K f_{c1} f_{d}} \\exp\\!\\left(\\frac{T_{r1}}{\\tau}\\right).\n$$\n消去公共常数并取自然对数：\n$$\n\\frac{T_{r0}}{\\tau} - \\ln(f_{c0})\n=\n\\frac{T_{r1}}{\\tau} - \\ln(f_{c1}).\n$$\n重新整理以获得补偿频率变化的额外解析时间 $\\Delta T_{r} \\equiv T_{r1} - T_{r0}$：\n$$\n\\Delta T_{r} = \\tau \\ln\\!\\left(\\frac{f_{c1}}{f_{c0}}\\right).\n$$\n对于时钟加倍，$f_{c1}/f_{c0} = 2$，所以\n$$\n\\Delta T_{r} = \\tau \\ln(2).\n$$\n当 $\\tau = 28\\,\\text{ps}$ 时，\n$$\n\\Delta T_{r} = 28\\,\\text{ps} \\times \\ln(2) \\approx 28\\,\\text{ps} \\times 0.693147\\ldots \\approx 19.409\\,\\text{ps}.\n$$\n四舍五入到三位有效数字并以皮秒表示，$\\Delta T_{r} \\approx 19.4\\,\\text{ps}$。\n\n接下来，将解析时间与级数联系起来。对于一个以周期 $T_{c}$ 工作的 $k$ 级链，从第一个可能进入亚稳态的触发器到最终采样触发器之间的有效解析时间的标准时序抽象为\n$$\nT_{r} = (k-1) T_{c} - \\delta,\n$$\n其中 $\\delta$ 集总了固定的建立时间和传播裕量。最初，当 $k_{0} = 2$ 且 $T_{c0} = 1/f_{c0}$ 时，\n$$\nT_{r0} = (2-1) T_{c0} - \\delta = T_{c0} - \\delta.\n$$\n将时钟频率加倍至 $f_{c1} = 2 f_{c0}$ 后，新周期为 $T_{c1} = 1/f_{c1} = \\frac{1}{2} T_{c0}$。如果我们选择一个新的级数 $k_{1}$，新的解析时间为\n$$\nT_{r1} = (k_{1}-1) T_{c1} - \\delta.\n$$\n为了保持相同的 MTBF，我们必须满足\n$$\nT_{r1} \\ge T_{r0} + \\Delta T_{r}.\n$$\n代入表达式并消去 $\\delta$：\n$$\n(k_{1}-1) T_{c1} - \\delta \\ge (T_{c0} - \\delta) + \\Delta T_{r}\n\\quad\\Rightarrow\\quad\n(k_{1}-1) T_{c1} \\ge T_{c0} + \\Delta T_{r}.\n$$\n因此，满足要求的最小整数 $k_{1}$ 是\n$$\nk_{1} = \\left\\lceil 1 + \\frac{T_{c0} + \\Delta T_{r}}{T_{c1}} \\right\\rceil.\n$$\n现在进行数值计算。当 $f_{c0} = 250\\,\\text{MHz}$ 时，$T_{c0} = 1/f_{c0} = 4.0\\,\\text{ns}$。加倍后，$f_{c1} = 500\\,\\text{MHz}$，因此 $T_{c1} = 2.0\\,\\text{ns}$。使用计算出的 $\\Delta T_{r} \\approx 19.409\\,\\text{ps} = 0.019409\\,\\text{ns}$，\n$$\n1 + \\frac{T_{c0} + \\Delta T_{r}}{T_{c1}}\n=\n1 + \\frac{4.0\\,\\text{ns} + 0.019409\\,\\text{ns}}{2.0\\,\\text{ns}}\n=\n1 + \\frac{4.019409}{2.0}\n=\n1 + 2.0097045\n=\n3.0097045\\ldots.\n$$\n取上取整得到 $k_{1} = 4$。因为 $k_{0} = 2$，所以需要增加的最小同步器级数为\n$$\nk_{1} - k_{0} = 4 - 2 = 2.\n$$\n注意，$\\delta$ 在级数计算的条件中被代数消去，因此在这种情况下，它的具体值不影响最小整数级数；它会影响绝对的 $T_{r}$ 值，但在 $f_{c1}/f_{c0}$ 和 $\\tau$ 固定的情况下，不影响所需的级数增量。\n\n因此，所需的额外解析时间为 $\\Delta T_{r} \\approx 19.4\\,\\text{ps}$（三位有效数字），而所需的最小额外级数为 $2$。",
            "answer": "$$\\boxed{\\begin{pmatrix}2  19.4\\end{pmatrix}}$$"
        },
        {
            "introduction": "现代片上系统（SoC）中集成了成百上千个独立的时钟域交叉，每个交叉点都可能是一个潜在的故障源。单个同步器的可靠性可能极高，但系统整体的可靠性是所有这些独立故障风险累积的结果。本练习将指导您如何从单个同步器的平均无故障时间（MTBF）出发，计算整个系统的MTBF，并反向推算出在满足特定系统级可靠性目标的前提下，所能容纳的同步器最大数量。",
            "id": "3658848",
            "problem": "一个片上系统集成了 $N$ 个相同的跨时钟域接口，每个接口都由一个两级触发器同步器保护。在经验上观察到，单个同步器中由亚稳态引发的失效事件遵循一个具有恒定失效率的无记忆过程，这与泊松点过程模型一致。在最坏工作条件下，测得的单个同步器的平均无故障时间 (MTBF) 为 $MTBF_{\\text{single}} = 230$ 年。假设各接口的同步器失效是相互独立的。\n\n从以下假设出发：(i) 每个同步器的失效过程是具有恒定失效率的无记忆过程，以及 (ii) 独立的失效过程组合产生的总失效过程的失效率是各部分失效率之和，推导出系统级的平均无故障时间 $MTBF_{\\text{sys}}$ 作为 $N$ 的函数。然后，确定使系统级平均无故障时间满足 $MTBF_{\\text{sys}} \\ge 10$ 年连续运行的最大整数 $N$。\n\n将最终答案表示为不带单位的整数 $N$。无需四舍五入。",
            "solution": "在进行求解之前，首先评估问题陈述的有效性。该问题在科学和数学上是合理的，其基础是应用于数字系统中亚稳态的可靠性理论标准原则，这是计算机组成与体系结构中的一个核心课题。给定条件包括接口数量 $N$、单个同步器的平均无故障时间 $MTBF_{\\text{single}}$ 为 $230$ 年，以及目标系统级平均无故障时间 $MTBF_{\\text{sys}}$ 至少为 $10$ 年。问题依赖于以下假设：失效遵循具有恒定失效率的无记忆过程（泊松过程），并且系统的失效率是各个独立失效率之和。这些前提是一致、完整且为此类工程分析的标准。该问题提法明确且客观，允许得出唯一、可验证的解。因此，该问题被认定为有效，可以进行求解。\n\n问题陈述指出，同步器的失效过程是具有恒定失效率的无记忆过程。这意味着失效时间 $T$ 是一个服从指数分布的随机变量。对于此类分布，平均无故障时间 $MTBF$ 是恒定失效率 $\\lambda$ 的倒数。\n$$MTBF = \\frac{1}{\\lambda}$$\n这个关系允许我们用 $MTBF$ 来表示失效率：\n$$\\lambda = \\frac{1}{MTBF}$$\n\n对于单个同步器，其失效率（我们可以表示为 $\\lambda_{\\text{single}}$）由其给定的平均无故障时间 $MTBF_{\\text{single}} = 230$ 年计算得出。\n$$\\lambda_{\\text{single}} = \\frac{1}{MTBF_{\\text{single}}} = \\frac{1}{230 \\text{ 年}}$$\n\n该系统由 $N$ 个相同且独立的同步器组成。根据问题假设（这是可靠性理论中针对竞争性独立失效模式的标准结论），系统的总失效率 $\\lambda_{\\text{sys}}$ 是各个失效率之和。由于所有 $N$ 个同步器都是相同的，这个和为：\n$$\\lambda_{\\text{sys}} = \\sum_{i=1}^{N} \\lambda_{\\text{single}} = N \\cdot \\lambda_{\\text{single}}$$\n\n整个系统的失效过程也是一个具有恒定失效率 $\\lambda_{\\text{sys}}$ 的泊松过程。因此，系统级的平均无故障时间 $MTBF_{\\text{sys}}$ 是系统级失效率的倒数：\n$$MTBF_{\\text{sys}} = \\frac{1}{\\lambda_{\\text{sys}}}$$\n代入 $\\lambda_{\\text{sys}}$ 的表达式，我们可以将系统 MTBF 与单个组件的 MTBF 联系起来：\n$$MTBF_{\\text{sys}} = \\frac{1}{N \\cdot \\lambda_{\\text{single}}} = \\frac{1}{N} \\left( \\frac{1}{\\lambda_{\\text{single}}} \\right) = \\frac{MTBF_{\\text{single}}}{N}$$\n这个方程给出了作为 $N$ 的函数的系统级平均无故障时间，这是要求推导的第一部分。\n\n问题的第二部分要求找到使系统级 MTBF 大于或等于 $10$ 年的最大整数 $N$。该条件表示为以下不等式：\n$$MTBF_{\\text{sys}} \\ge 10 \\text{ 年}$$\n代入推导出的 $MTBF_{\\text{sys}}$ 表达式和给定的 $MTBF_{\\text{single}}$ 值：\n$$\\frac{230 \\text{ 年}}{N} \\ge 10 \\text{ 年}$$\n为了解出 $N$（$N$ 必须是正整数），我们整理这个不等式。我们可以将两边同乘以 $N$（因为 $N > 0$）并除以 $10$ 年，不等号方向不变：\n$$230 \\ge 10 \\cdot N$$\n$$ \\frac{230}{10} \\ge N$$\n$$23 \\ge N$$\n不等式 $N \\le 23$ 表明，如果要满足系统可靠性目标，接口数量不能超过 $23$ 个。问题要求的是满足此条件的最大整数 $N$。小于或等于 $23$ 的最大整数值为 $23$。",
            "answer": "$$\\boxed{23}$$"
        }
    ]
}