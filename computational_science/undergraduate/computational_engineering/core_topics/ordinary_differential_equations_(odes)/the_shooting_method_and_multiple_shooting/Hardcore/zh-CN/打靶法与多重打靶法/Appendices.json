{
    "hands_on_practices": [
        {
            "introduction": "打靶法将边值问题（BVP）转化为一个根查找问题，通常使用牛顿法等迭代算法求解。本练习将聚焦于牛顿法迭代过程中的一个关键步骤，通过对一个具体实例进行单步计算，帮助你直观地理解该算法的内在机制。我们将研究著名的Troesch问题，这是一个对初值极其敏感的难题，这也暗示了为何简单的单次打靶法有时会失效。",
            "id": "1127747",
            "problem": "以下边值问题，被称为Troesch问题，以其对初始条件极其敏感而闻名，这对标准的打靶法构成了挑战：\n$$ y'' = \\lambda \\sinh(\\lambda y), \\quad x \\in [0, 1] $$\n边界条件为 $y(0) = 0$ 和 $y(1) = B$。\n\n为了数值求解此问题，我们可以使用多重打靶法。区间 $[0,1]$ 被一个位于 $x_m$ 的内部节点分割。目标是找到满足 $x=1$ 处边界条件的正确初始斜率 $s = y'(0)$。这等价于寻找函数 $F(s) = y(1; s) - B$ 的一个根，其中 $y(1; s)$ 是对应于初始斜率 $s$ 的解在 $x=1$ 处的值。\n\n我们采用牛顿法来寻找 $F(s)=0$ 的根。初始猜测值 $s_{guess}$ 通过以下迭代更新为一个新的估计值 $s_{next}$：\n$$ s_{next} = s_{guess} - \\frac{F(s_{guess})}{F'(s_{guess})} $$\n导数 $F'(s)$ 由 $u(1; s) = \\frac{\\partial y(1;s)}{\\partial s}$ 给出，其中敏感度函数 $u(x)$ 满足变分方程\n$$ u'' = \\lambda^2 \\cosh(\\lambda y) u $$\n初始条件为 $u(0)=0$ 和 $u'(0)=1$。\n\n考虑 $\\lambda=5$，$B=1$，且内部打靶节点位于 $x_m = 1/2$ 的情况。设斜率的初始猜测值为 $s_{guess}$。对耦合系统 $(y, y', u, u')$ 进行数值积分，首先从 $x=0$ 积分到 $x_m$，然后从 $x_m$ 积分到 $x=1$。对于初始猜测值 $s_{guess} = 0.01$，积分在终点 $x=1$ 处得到以下值：\n- 解的值：$y(1; s_{guess}) = 29.89310035$\n- 敏感度的值：$u(1; s_{guess}) = 10091.24038$\n\n利用这些信息，计算斜率的改进估计值 $s_{next}$。",
            "solution": "1. 牛顿法更新：\n$$s_{\\rm next}=s_{\\rm guess}-\\frac{F(s_{\\rm guess})}{F'(s_{\\rm guess})},$$\n其中 $F(s_{\\rm guess})=y(1;s_{\\rm guess})-B$ 且 $F'(s_{\\rm guess})=u(1;s_{\\rm guess})$。\n\n2. 代入给定值：\n$$s_{\\rm next}\n=0.01-\\frac{29.89310035-1}{10091.24038}\n=0.01-\\frac{28.89310035}{10091.24038}.$$\n\n3. 计算除法：\n$$\\frac{28.89310035}{10091.24038}\\approx0.0028631863,$$\n所以\n$$s_{\\rm next}\\approx0.01-0.0028631863=0.0071368137.$$",
            "answer": "$$\\boxed{0.0071368137}$$"
        },
        {
            "introduction": "在理解了打靶法的单步迭代后，我们现在将视野从局部计算扩展到完整的算法实现。这个练习要求你编写程序，将一个二阶非线性常微分方程（ODE）转化为一阶系统，并构建一个调用ODE求解器的残差函数，最终利用根查找算法找到满足边界条件的“发射”斜率。通过这个实践，你将亲手揭示非线性边值问题中一个引人入胜的现象——解的非唯一性。",
            "id": "2377656",
            "problem": "考虑有限区间上的一个非线性常微分方程边值问题：求一个函数 $y(x)$，使其满足\n$$\ny''(x) + y(x)^3 = 0 \\quad \\text{对于 } x \\in [0,L], \\quad \\text{并满足} \\quad y(0)=0, \\; y(L)=0,\n$$\n其中 $L>0$ 是一个给定的长度。该问题是单位质量粒子在四次势 $V(y)=\\tfrac{1}{4}y^4$ 中运动的模型，其中 $x$ 扮演时间的角色。从经典力学和常微分方程的第一性原理出发，完成以下任务。\n\n1) 从牛顿第二定律和单位质量的机械能定义出发，利用势 $V(y)=\\tfrac{1}{4}y^4$ 证明初值条件为 $y(0)=0$ 和 $y'(0)=s$ 的初值问题能量守恒\n$$\nE = \\tfrac{1}{2}\\,[y'(x)]^2 + \\tfrac{1}{4}\\, [y(x)]^4,\n$$\n并且证明对于 $s>0$，解 $y(x)$ 是关于 $x$ 的周期函数，并在由能量决定的对称转折点 $\\pm A$ 之间振荡。然后，仅使用这些基本事实（不引用任何预先推导的周期公式），定性地论证为何对于一个固定的 $L$，该边值问题可以有多个不同的解：初始斜率 $s$ 的不同选择可以产生不同的轨迹，使得一个或多个半振荡周期恰好落在区间 $[0,L]$ 内，且都满足相同的最终边界条件 $y(L)=0$。\n\n2) 实现一个打靶法，以数值方式揭示这种非唯一性。将初始斜率 $s=y'(0)$ 作为可调的打靶参数，并定义残差\n$$\nR(s;L) := y(L;s),\n$$\n其中 $y(x;s)$ 是初值问题在 $y(0)=0$、$y'(0)=s$ 条件下的解。使用数值稳定的常微分方程积分器求解与二阶方程等价的一阶系统，并使用稳健的、基于区间法的单变量求根器来定位 $R(s;L)=0$ 的不同正根。具体要求如下：\n- 将二阶方程转换为一阶系统 $y_1' = y_2$, $y_2' = -y_1^3$，初始条件为 $y_1(0)=0$ 和 $y_2(0)=s$。\n- 对于每个给定的 $L$，计算两个最小的不同正值打靶值 $s_1(L)$ 和 $s_2(L)$，满足 $s_2(L) > s_1(L) > 0$，使得 $|R(s_k;L)| \\le \\varepsilon$（容差 $\\varepsilon = 10^{-8}$）。\n- 不考虑平凡解 $s=0$。\n\n3) 测试组。在以下三组区间长度上运行您的程序：\n- $L_1 = 1.00$,\n- $L_2 = 1.20$,\n- $L_3 = 0.75$.\n对于每个 $L_i$，返回列表 $[s_1(L_i), s_2(L_i)]$，结果四舍五入到 $6$ 位小数。您的程序最终输出必须是单行，包含一个用方括号括起来的、以逗号分隔的结果列表，顺序为 $L_1, L_2, L_3$，例如：\n$[[s_1(L_1),s_2(L_1)],[s_1(L_2),s_2(L_2)],[s_1(L_3),s_2(L_3)]]$。\n所有数字必须以十进制表示法书写。不应打印任何额外文本。\n\n额外的实现要求：\n- 使用标准的自适应步长常微分方程求解器，绝对和相对容差不高于 $10^{-9}$。\n- 使用区间求根方法，对 $s$ 的解的绝对容差不高于 $10^{-10}$。\n- 通过在足够大的 $s$ 区间内进行符号变化扫描，确保为每个 $L_i$ 分离出至少两个不同的正根，以保证稳健性。",
            "solution": "所述问题已经过验证，被认为是科学上可靠、适定、客观且内部一致的。这是一个计算物理和非线性动力学中的标准问题，涉及保守系统边值问题（BVP）的求解。所有必要的数据、方程和约束条件均已提供。因此，该问题被认定为有效。我们接下来提供一个完整的解法。\n\n根据要求，解答分为两部分：首先是从第一性原理出发的理论论证，其次是为解决该问题而设计的数值打靶法的描述。\n\n**1. 理论论证与定性分析**\n\n该问题涉及一个单位质量（$m=1$）的粒子，在由势能函数 $V(y)$ 导出的力 $F(y)$ 作用下的运动。牛顿第二定律指出 $ma = F$，其中加速度为 $a = y''(x)$，$x$ 代表时间。该力是保守力，由 $F(y) = -V'(y)$ 给出。对于给定的势 $V(y) = \\frac{1}{4}y^4$，相应的力为 $F(y) = -\\frac{d}{dy}(\\frac{1}{4}y^4) = -y^3$。将这些代入 $m=1$ 的牛顿定律，得到：\n$$\n(1) y''(x) = -y(x)^3\n$$\n整理后即为指定的常微分方程（ODE）：\n$$\ny''(x) + y(x)^3 = 0.\n$$\n这证实了控制方程的物理来源。\n\n为了证明机械能守恒，我们将常微分方程乘以速度 $y'(x)$:\n$$\ny''(x) y'(x) + y(x)^3 y'(x) = 0.\n$$\n该表达式等价于能量对时间的全导数。注意到 $y'' y' = \\frac{d}{dx}(\\frac{1}{2}[y'(x)]^2)$ 且 $y^3 y' = \\frac{d}{dx}(\\frac{1}{4}[y(x)]^4)$，我们有：\n$$\n\\frac{d}{dx} \\left( \\frac{1}{2}[y'(x)]^2 + \\frac{1}{4}[y(x)]^4 \\right) = 0.\n$$\n这意味着括号内的量，即总机械能 $E$，是一个运动常量：\n$$\nE = \\frac{1}{2}[y'(x)]^2 + \\frac{1}{4}[y(x)]^4 = \\text{常数}.\n$$\n能量 $E$ 由初始条件决定。对于初值条件为 $y(0)=0$ 和 $y'(0)=s$ 的初值问题（IVP），能量为：\n$$\nE = \\frac{1}{2}[y'(0)]^2 + \\frac{1}{4}[y(0)]^4 = \\frac{1}{2}s^2 + \\frac{1}{4}(0)^4 = \\frac{1}{2}s^2.\n$$\n对于任何 $s > 0$，能量 $E > 0$。粒子的运动受限于势场。振荡的转折点（记为 $\\pm A$）发生在速度 $y'(x)$ 为零的地方。在这些点，动能为零，所有能量都是势能：$E = V(A) = \\frac{1}{4}A^4$。令两种能量表达式相等，可得：\n$$\n\\frac{1}{2}s^2 = \\frac{1}{4}A^4 \\implies A = (2s^2)^{1/4}.\n$$\n粒子从 $y(0)=0$ 处以正速度 $s$ 开始运动，朝正转折点 $+A$ 移动，然后反向，以速度 $-s$ 通过 $y=0$，到达负转折点 $-A$，再返回到 $y=0$。这个循环构成了一个周期性运动。\n\n边值问题解的非唯一性源于初值问题解的周期性。边界条件 $y(L)=0$ 要求粒子在时间 $x=L$ 时位于原点。从 $y(0)=0$ 开始，粒子在经过一个半周期、两个半周期（一个完整周期）、三个半周期等之后，会再次到达 $y=0$。令 $T_{1/2}(s)$ 表示对应于初始斜率 $s$ 的振荡半周期。如果区间长度 $L$ 是半周期的整数倍，则边界条件 $y(L)=0$ 得到满足：\n$$\nL = k \\cdot T_{1/2}(s) \\quad \\text{对于 } k = 1, 2, 3, \\dots\n$$\n这个非谐振子的周期取决于其能量，因此也取决于 $s$。通过改变 $s$，我们可以改变周期。对于一个固定的长度 $L$，上述方程成为关于 $s$ 的一个隐式方程。这个方程很可能可以解出不同的 $s$ 值，每个值对应一个不同的整数 $k$。对于 $k=1$，我们寻找一个初始斜率 $s_1$，使得粒子恰好在区间 $[0, L]$ 内完成其第一个半振荡。这会得到基解，一个单拱形。对于 $k=2$，我们寻找一个不同的斜率 $s_2$，使得粒子在 $[0, L]$ 内完成两个半振荡（一个完整的波）。这些不同的值 $s_1, s_2, \\dots$ 都产生了解 $y(x; s_k)$，这些解同时满足两个边界条件 $y(0)=0$ 和 $y(L)=0$，从而解释了边值问题存在多个非平凡解的原因。\n\n**2. 数值设计：打靶法**\n\n为了数值化地找到这些不同的初始斜率，我们采用打靶法。该方法将边值问题重构为一个求根问题。\n\n打靶参数是未知的初始斜率 $s = y'(0)$。\n初值问题（IVP）定义为：\n$$\ny''(x) + y(x)^3 = 0, \\quad y(0)=0, \\quad y'(0)=s.\n$$\n为了数值求解，我们将二阶常微分方程转换为等价的一阶系统。令 $y_1(x) = y(x)$ 且 $y_2(x) = y'(x)$。该系统为：\n$$\n\\begin{cases}\ny_1'(x) = y_2(x) \\\\\ny_2'(x) = -y_1(x)^3\n\\end{cases}\n$$\n在 $x=0$ 处的初始条件为：\n$$\n\\begin{pmatrix} y_1(0) \\\\ y_2(0) \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ s \\end{pmatrix}.\n$$\n我们从 $x=0$ 到 $x=L$ 积分该系统。在 $x=L$ 处的解，我们记作 $y(L;s)$，它依赖于 $s$ 的选择。第二个边界条件 $y(L)=0$（即 $y_1(L)=0$）仅对特定的 $s$ 值成立。我们定义一个残差函数 $R(s;L)$，它度量在末端边界上的不匹配程度：\n$$\nR(s;L) = y_1(L;s).\n$$\n问题现在转化为求方程 $R(s;L) = 0$ 的根。\n\n数值步骤如下：\n1.  **定义残差函数**：创建一个函数，对于给定的 $s$ 和 $L$，使用高精度的自适应步长常微分方程积分器（例如 `scipy.integrate.solve_ivp`，绝对和相对容差设为 $10^{-10}$）从 $x=0$ 到 $x=L$ 数值求解初值问题。该函数返回 $y_1(L)$ 的值。\n2.  **确定根的区间**：正如定性分析所论证的，$R(s;L)$ 是一个关于 $s$ 的振荡函数。为了找到其根，我们首先需要将它们隔离在不同的区间内。我们通过在一系列 $s$ 网格点上评估 $R(s;L)$，并找出相邻点对 $(s_a, s_b)$，使得 $R(s_a;L)$ 和 $R(s_b;L)$ 的符号相反，从而实现这一点。每个这样的区间 $[s_a, s_b]$ 保证至少包含一个根。\n3.  **求解根**：对于找到的每个区间 $[s_a, s_b]$，使用一个稳健的单变量区间求根器（例如 Brent 方法，`scipy.optimize.brentq`）来高精度地定位根 $s_k$（对 $s$ 的容差设为 $10^{-11}$）。\n4.  **收集并报告**：我们对每个给定的长度 $L_i$ 应用此过程，以找到两个最小的不同正根 $s_{1}(L_i)$ 和 $s_{2}(L_i)$，将它们四舍五入到指定的精度，并按要求格式化输出。平凡解 $s=0$ 被明确排除。\n\n这种高保真度常微分方程求解器和可靠求根算法的组合，为确定非线性边值问题的非唯一解提供了一种稳健而准确的方法。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Solves the nonlinear BVP y'' + y^3 = 0 with y(0)=0, y(L)=0\n    using a shooting method to find the first two non-trivial positive\n    initial slopes s = y'(0) for given lengths L.\n    \"\"\"\n\n    # --- 1. Define the core components of the shooting method ---\n\n    # ODE system: y' = f(x, y), where y = [y_1, y_2] = [y, y']\n    def ode_system(t, y):\n        \"\"\"First-order system for y'' = -y^3\"\"\"\n        return [y[1], -y[0]**3]\n\n    # Residual function R(s; L) = y(L; s)\n    def residual(s, L):\n        \"\"\"\n        Computes the residual R(s;L) = y(L;s) by solving the IVP.\n\n        Args:\n            s (float): The initial slope y'(0), our shooting parameter.\n            L (float): The length of the interval [0, L].\n\n        Returns:\n            float: The value of y(L), which we want to be zero.\n        \"\"\"\n        if s == 0:\n            return 0.0 # Trivial solution y(x)=0 for all x\n\n        # Initial conditions for the IVP: y(0)=0, y'(0)=s\n        y0 = [0.0, s]\n        \n        # Integration interval\n        t_span = [0, L]\n        \n        # High-precision ODE solver settings\n        atol = 1e-10\n        rtol = 1e-10\n\n        # Solve the initial value problem\n        sol = solve_ivp(\n            fun=ode_system,\n            t_span=t_span,\n            y0=y0,\n            method='DOP853',\n            atol=atol,\n            rtol=rtol,\n        )\n        \n        # Return the final value of y(x), which is y_1(L)\n        # sol.y is a 2xN array. We need the first component at the last time step.\n        return sol.y[0, -1]\n\n    # --- 2. Implement the root-finding logic ---\n\n    def find_shooting_values(L, num_roots=2):\n        \"\"\"\n        Finds the first `num_roots` positive values of s for a given L.\n        \"\"\"\n        roots = []\n        \n        # Scan for sign changes to find brackets for the roots.\n        # The required s values increase as L decreases. The scan range\n        # must be large enough to find the required number of roots.\n        s_scan_points = np.linspace(0.1, 100.0, 500)\n        r_values = np.array([residual(s, L) for s in s_scan_points])\n        \n        # Find intervals where the sign of the residual changes\n        for i in range(len(s_scan_points) - 1):\n            if np.sign(r_values[i]) != np.sign(r_values[i+1]):\n                s_a, s_b = s_scan_points[i], s_scan_points[i+1]\n                \n                try:\n                    # Use a robust bracketing root-finder\n                    root = brentq(\n                        residual, \n                        a=s_a, \n                        b=s_b, \n                        args=(L,), \n                        xtol=1e-11 # Tolerance on the root s\n                    )\n                    roots.append(root)\n                    \n                    if len(roots) == num_roots:\n                        break\n                except ValueError:\n                    # brentq can fail if signs are not opposite, though our check prevents this.\n                    continue\n        \n        if len(roots)  num_roots:\n            raise RuntimeError(f\"Could not find {num_roots} roots for L={L}. Try increasing the scan range for s.\")\n        \n        return sorted(roots)\n\n    # --- 3. Execute for the test suite ---\n\n    # Define the test cases from the problem statement.\n    test_cases = [1.00, 1.20, 0.75]\n    \n    all_results = []\n    \n    for L_val in test_cases:\n        # Find the two smallest positive shooting values\n        s1, s2 = find_shooting_values(L_val, num_roots=2)\n        \n        # Round to 6 decimal places as required\n        result_pair = [round(s1, 6), round(s2, 6)]\n        all_results.append(result_pair)\n    \n    # Format the final output string exactly as specified\n    # e.g., [[val1,val2],[val3,val4]]\n    output_str = \"[\" + \",\".join([str(pair) for pair in all_results]) + \"]\"\n    \n    # Final print statement in the exact required format.\n    print(output_str.replace(\" \", \"\"))\n\nsolve()\n```"
        },
        {
            "introduction": "单次打靶法虽然直观，但在处理像Troesch问题那样的敏感或长区间问题时，其数值不稳定性会成为主要障碍。为了克服这一挑战，多次打靶法应运而生，它将求解区间分解为多个更短、更稳定的子区间。在着手实现这一强大技术之前，正确地构建其数学框架是至关重要的一步，本练习将引导你为同一个问题分别建立单次和多次打靶法的数学方程，从而深刻理解两种方法的联系与区别。",
            "id": "2445807",
            "problem": "考虑在区间 $[0,1]$ 上的标量函数 $y$ 的边值问题，由二阶常微分方程（ODE）给出\n$y''(x) + y(x) = \\sin(x)$，其中 $x \\in (0,1)$，\n并满足边界条件 $y(0) = 0$ 和 $y(1) + \\left(y'(1)\\right)^2 = 1$。\n\n为了进行数值处理，一个常见的重构方法是引入一阶状态 $z(x) = \\begin{bmatrix} z_1(x) \\\\ z_2(x) \\end{bmatrix} = \\begin{bmatrix} y(x) \\\\ y'(x) \\end{bmatrix}$ 和一个用于单次打靶法的打靶参数 $s = y'(0)$。对于在 $x = c \\in (0,1)$ 处有一个内部界面的两段多次打靶法，可以引入独立的分段初始状态并强制施加连续性约束。\n\n哪个选项提供了一个正确的表述，该表述包含：(i)一个与终端非线性边界条件相关的有效单次打靶标量残差 $R(s)$，以及一个用于计算 $\\mathrm{d}R/\\mathrm{d}s$ 的一致的线性灵敏度初值问题（Initial Value Problem, IVP），以及(ii)一个施加内部连续性和终端边界条件的一致的两段多次打靶未知向量和残差向量？\n\nA. 单次打靶法：定义 $f(x,z) = \\begin{bmatrix} z_2 \\\\ -z_1 + \\sin(x) \\end{bmatrix}$ 使得 $z'(x) = f(x,z(x))$，其中 $z(0) = \\begin{bmatrix} 0 \\\\ s \\end{bmatrix}$。定义残差 $R(s) = z_1(1;s) + \\left(z_2(1;s)\\right)^2 - 1$。灵敏度 $w(x) = \\partial z(x;s)/\\partial s$ 满足 $w'(x) = \\left(\\partial f/\\partial z\\right)(x,z(x;s))\\,w(x)$，其中 $w(0) = \\begin{bmatrix} 0 \\\\ 1 \\end{bmatrix}$，这里 $\\left(\\partial f/\\partial z\\right)(x,z) = \\begin{bmatrix} 0  1 \\\\ -1  0 \\end{bmatrix}$。那么 $\\mathrm{d}R/\\mathrm{d}s = w_1(1) + 2\\,z_2(1;s)\\,w_2(1)$。多次打靶法（在 $x=c$ 处有界面的两段）：未知向量 $u = \\begin{bmatrix} s \\\\ q_1 \\\\ q_2 \\end{bmatrix}$，其中 $q = \\begin{bmatrix} q_1 \\\\ q_2 \\end{bmatrix}$ 是右侧段在 $x=c$ 处的初始状态。残差向量 $F(u) = \\begin{bmatrix} z_1(c;s) - q_1 \\\\ z_2(c;s) - q_2 \\\\ \\tilde z_1(1;q) + \\left(\\tilde z_2(1;q)\\right)^2 - 1 \\end{bmatrix}$，其中 $\\tilde z(x;q)$ 在 $[c,1]$ 上求解 $z'(x) = f(x,z)$，并满足 $z(c) = q$。\n\nB. 单次打靶法：$R(s) = z_1(1;s) - 1$。灵敏度初值问题使用 $w'(x) = \\left(\\partial f/\\partial z\\right)(x,z)\\,w(x)$，其中 $w(0) = \\begin{bmatrix} 1 \\\\ 0 \\end{bmatrix}$，并且 $\\mathrm{d}R/\\mathrm{d}s = w_1(1)$。多次打靶法：未知向量 $u = \\begin{bmatrix} s \\\\ q_1 \\end{bmatrix}$ 和残差向量 $F(u) = \\begin{bmatrix} z_1(c;s) - q_1 \\\\ \\tilde z_1(1;q_1) + \\left(\\tilde z_2(1;q_1)\\right)^2 - 1 \\end{bmatrix}$，其中右侧段从 $z(c) = \\begin{bmatrix} q_1 \\\\ 0 \\end{bmatrix}$ 开始。\n\nC. 单次打靶法：$R(s) = z_1(1;s) + z_2(1;s) - 1$。灵敏度初值问题将 $w'(x) = \\left(\\partial f/\\partial z\\right)(x,z)\\,w(x)$ 增广为 $w'(x) = \\left(\\partial f/\\partial z\\right)(x,z)\\,w(x) + \\begin{bmatrix} 0 \\\\ 2\\,z_2(x;s)\\,w_2(x) \\end{bmatrix}$，其中 $w(0) = \\begin{bmatrix} 0 \\\\ 1 \\end{bmatrix}$，并且 $\\mathrm{d}R/\\mathrm{d}s = w_1(1) + w_2(1)$。多次打靶法：未知向量 $u = \\begin{bmatrix} s \\\\ q_1 \\\\ q_2 \\end{bmatrix}$ 和残差向量 $F(u) = \\begin{bmatrix} \\left(z_1(c;s) - q_1\\right)^2 + \\left(z_2(c;s) - q_2\\right)^2 \\\\ \\tilde z_1(1;q) + \\tilde z_2(1;q) - 1 \\\\ q_2 \\end{bmatrix}$。\n\nD. 单次打靶法：$R(s) = z_1(1;s) + \\left(z_2(1;s)\\right)^2 - 1$，且 $w'(x) = \\begin{bmatrix} 0  1 \\\\ -1  1 \\end{bmatrix} w(x)$，其中 $w(0) = \\begin{bmatrix} 0 \\\\ -1 \\end{bmatrix}$，使得 $\\mathrm{d}R/\\mathrm{d}s = w_1(1) + 2\\,z_2(1;s)\\,w_2(1)$。多次打靶法：未知向量 $u = \\begin{bmatrix} y_0 \\\\ s \\\\ q_1 \\\\ q_2 \\end{bmatrix}$，其中 $y_0$ 代表 $y(0)$，以及残差向量 $F(u) = \\begin{bmatrix} y_0 \\\\ z_1(c;s) - q_1 \\\\ z_2(c;s) - q_2 \\\\ \\tilde z_1(1;q) + \\left(\\tilde z_2(1;q)\\right)^2 - 1 \\end{bmatrix}$。",
            "solution": "任务是验证问题陈述的有效性，如果有效，则确定应用于给定边值问题（BVP）的单次打靶法和多次打靶法的正确表述。\n\n首先，对问题陈述进行验证。\n\n**步骤1：提取已知条件**\n- 常微分方程（ODE）为 $y''(x) + y(x) = \\sin(x)$，其中 $x \\in (0,1)$。\n- 边界条件（BCs）为 $y(0) = 0$ 和 $y(1) + \\left(y'(1)\\right)^2 = 1$。\n- 状态向量定义为 $z(x) = \\begin{bmatrix} z_1(x) \\\\ z_2(x) \\end{bmatrix} = \\begin{bmatrix} y(x) \\\\ y'(x) \\end{bmatrix}$。\n- 单次打靶法的打靶参数为 $s = y'(0)$。\n- 多次打靶法设置涉及两段，界面位于 $x = c \\in (0,1)$。\n\n**步骤2：使用提取的已知条件进行验证**\n- **科学依据：**该问题描述了一个二阶非线性边值问题。非线性源于 $x=1$ 处的边界条件。所提到的方法——单次打靶法和多次打靶法——是计算工程和应用数学中解决此类问题的标准、成熟的数值技术。将其重构为一阶系统也是一个标准程序。该问题在科学上是合理的。\n- **适定性：**该问题要求确定一种数值方法的正确数学表述。这个问题是明确的，并且基于数值分析的原理有一个确定的答案。这是一个关于方法论的适定问题。\n- **客观性：**该问题以精确的数学语言陈述，没有任何主观性或歧义。\n\n**步骤3：结论与行动**\n问题陈述是有效的。这是微分方程数值方法领域的一个标准问题。我将继续推导正确的表述并评估给定的选项。\n\n**正确表述的推导**\n\n**第(i)部分：单次打靶法**\n\n1.  **一阶系统：**\n    令 $z_1(x) = y(x)$ 且 $z_2(x) = y'(x)$。那么导数为：\n    $z_1'(x) = y'(x) = z_2(x)$\n    $z_2'(x) = y''(x) = -y(x) + \\sin(x) = -z_1(x) + \\sin(x)$\n    这可以写成一个向量值的初值问题（IVP）：\n    $$z'(x) = \\begin{bmatrix} z_1'(x) \\\\ z_2'(x) \\end{bmatrix} = \\begin{bmatrix} z_2(x) \\\\ -z_1(x) + \\sin(x) \\end{bmatrix} = f(x, z(x))$$\n    其中 $f(x,z) = \\begin{bmatrix} z_2 \\\\ -z_1 + \\sin(x) \\end{bmatrix}$。\n\n2.  **初始条件和残差：**\n    $x=0$ 处的边界条件是 $y(0)=0$。$y'(0)$ 的值是未知的，并被指定为打靶参数 $s$。因此，该初值问题的初始条件是：\n    $$z(0) = \\begin{bmatrix} y(0) \\\\ y'(0) \\end{bmatrix} = \\begin{bmatrix} 0 \\\\ s \\end{bmatrix}$$\n    我们从 $x=0$ 到 $x=1$ 求解这个初值问题。其解依赖于 $s$，记为 $z(x;s)$。\n    打靶法旨在寻找一个 $s$ 值，使得第二个边界条件 $y(1) + (y'(1))^2 = 1$ 得到满足。这个边界条件转换为 $z_1(1;s) + (z_2(1;s))^2 = 1$。\n    定义标量残差函数 $R(s)$，使其根 $R(s)=0$ 满足此条件：\n    $$R(s) = z_1(1;s) + (z_2(1;s))^2 - 1$$\n\n3.  **灵敏度分析：**\n    为了用牛顿-拉夫逊法求解 $R(s)=0$，我们需要导数 $\\mathrm{d}R/\\mathrm{d}s$。\n    令 $w(x) = \\frac{\\partial z(x;s)}{\\partial s} = \\begin{bmatrix} \\partial z_1(x;s)/\\partial s \\\\ \\partial z_2(x;s)/\\partial s \\end{bmatrix} = \\begin{bmatrix} w_1(x) \\\\ w_2(x) \\end{bmatrix}$。\n    对 $R(s)$ 应用链式法则：\n    $$\\frac{\\mathrm{d}R}{\\mathrm{d}s} = \\frac{\\partial z_1(1;s)}{\\partial s} + 2 z_2(1;s) \\frac{\\partial z_2(1;s)}{\\partial s} = w_1(1) + 2 z_2(1;s) w_2(1)$$\n    灵敏度向量 $w(x)$ 通过对 ODE 系统 $z'(x;s) = f(x, z(x;s))$ 关于 $s$ 求导得到：\n    $$\\frac{\\partial}{\\partial s} \\left( z'(x;s) \\right) = \\frac{\\mathrm{d}}{\\mathrm{d}x} \\left( \\frac{\\partial z(x;s)}{\\partial s} \\right) = w'(x)$$\n    $$w'(x) = \\frac{\\partial}{\\partial s} f(x, z(x;s)) = \\frac{\\partial f}{\\partial z}(x, z(x;s)) \\frac{\\partial z(x;s)}{\\partial s} = \\frac{\\partial f}{\\partial z}(x, z(x;s)) w(x)$$\n    雅可比矩阵 $\\partial f / \\partial z$ 是：\n    $$\\frac{\\partial f}{\\partial z} = \\begin{bmatrix} \\frac{\\partial f_1}{\\partial z_1}  \\frac{\\partial f_1}{\\partial z_2} \\\\ \\frac{\\partial f_2}{\\partial z_1}  \\frac{\\partial f_2}{\\partial z_2} \\end{bmatrix} = \\begin{bmatrix} 0  1 \\\\ -1  0 \\end{bmatrix}$$\n    $w(x)$ 的初始条件通过对 $z(x;s)$ 的初始条件求导得到：\n    $$w(0) = \\frac{\\partial z(0;s)}{\\partial s} = \\frac{\\partial}{\\partial s} \\begin{bmatrix} 0 \\\\ s \\end{bmatrix} = \\begin{bmatrix} 0 \\\\ 1 \\end{bmatrix}$$\n    因此，灵敏度初值问题是 $w'(x) = \\begin{bmatrix} 0  1 \\\\ -1  0 \\end{bmatrix} w(x)$，其中 $w(0) = \\begin{bmatrix} 0 \\\\ 1 \\end{bmatrix}$。\n\n**第(ii)部分：两段多次打靶法**\n\n1.  **未知量：**\n    域 $[0,1]$ 被分割为 $[0,c]$ 和 $[c,1]$。\n    - 对于第一段 $[0,c]$，我们有初值问题 $z'(x) = f(x,z)$，其中 $z(0)=\\begin{bmatrix} 0 \\\\ s \\end{bmatrix}$。未知量是 $s$。\n    - 对于第二段 $[c,1]$，我们在界面 $x=c$ 处定义一个新的初始状态，这是未知的。设这个状态为 $q = \\begin{bmatrix} q_1 \\\\ q_2 \\end{bmatrix}$。这又给出了两个未知量 $q_1$ 和 $q_2$。\n    总的未知向量是 $u = \\begin{bmatrix} s \\\\ q_1 \\\\ q_2 \\end{bmatrix}$，这是一个大小为 3 的向量。\n\n2.  **残差：**\n    我们需要 3 个方程来求解 3 个未知量。\n    - **在 $x=c$ 处的连续性：**第一段在 $x=c$ 处的解，记为 $z(c;s)$，必须等于第二段的初始状态 $q$。这提供了两个方程：\n        $F_1(u) = z_1(c;s) - q_1 = 0$\n        $F_2(u) = z_2(c;s) - q_2 = 0$\n    - **在 $x=1$ 处的终端条件：**第二段的解，记为 $\\tilde{z}(x;q)$，它求解 $\\tilde{z}'=f(x,\\tilde{z})$ 且满足 $\\tilde{z}(c)=q$，必须满足终端边界条件。\n        $\\tilde{z}_1(1;q) + (\\tilde{z}_2(1;q))^2 - 1 = 0$\n        这给出了第三个方程： $F_3(u) = \\tilde{z}_1(1;q) + (\\tilde{z}_2(1;q))^2 - 1 = 0$。\n    完整的残差向量是：\n    $$F(u) = \\begin{bmatrix} z_1(c;s) - q_1 \\\\ z_2(c;s) - q_2 \\\\ \\tilde{z}_1(1;q) + (\\tilde{z}_2(1;q))^2 - 1 \\end{bmatrix}$$\n\n**选项评估**\n\n*   **选项 A:**\n    - **单次打靶法：**残差 $R(s)$、ODE 系统函数 $f(x,z)$、灵敏度初值问题（方程、雅可比矩阵和初始条件）以及 $\\mathrm{d}R/\\mathrm{d}s$ 的表达式都与推导完全匹配。\n    - **多次打靶法：**未知向量 $u$ 和残差向量 $F(u)$ 也与推导完全匹配。\n    - **结论：**正确。\n\n*   **选项 B:**\n    - **单次打靶法：**残差 $R(s) = z_1(1;s) - 1$ 是不正确的；它对应于一个不同的边界条件 $y(1)=1$。灵敏度初始条件 $w(0) = \\begin{bmatrix} 1 \\\\ 0 \\end{bmatrix}$ 是不正确的；它将对应于对 $y(0)$ 进行打靶，但参数是 $s=y'(0)$。\n    - **多次打靶法：**未知向量 $u = \\begin{bmatrix} s \\\\ q_1 \\end{bmatrix}$ 是不完整的。它不合理地将界面处的第二个状态变量固定为 $z_2(c)=0$。由于未知量和方程的数量少于要求，该系统是不适定的。\n    - **结论：**不正确。\n\n*   **选项 C:**\n    - **单次打靶法：**残差 $R(s) = z_1(1;s) + z_2(1;s) - 1$ 是不正确的；它对应于一个线性边界条件 $y(1)+y'(1)=1$。灵敏度 ODE 被表述为非齐次的，这根本上是错误的。对于与参数无关的 $f$，灵敏度 ODE 必须是线性的和齐次的，$w'=Jw$。\n    - **多次打靶法：**残差向量对连续性使用了平方范数 $(\\dots)^2+(\\dots)^2=0$，这将两个必要的方程减少为一个，使得系统欠定。它还包含一个任意条件 $q_2=0$。该表述完全有缺陷。\n    - **结论：**不正确。\n\n*   **选项 D:**\n    - **单次打靶法：**灵敏度方程的雅可比矩阵被给出为 $\\begin{bmatrix} 0  1 \\\\ -1  1 \\end{bmatrix}$，这是不正确的。正确的雅可比矩阵是 $\\begin{bmatrix} 0  1 \\\\ -1  0 \\end{bmatrix}$。灵敏度初始条件 $w(0)=\\begin{bmatrix} 0 \\\\ -1 \\end{bmatrix}$ 也因为符号错误而不正确。\n    - **多次打靶法：**未知向量 $u$ 错误地将 $y_0=y(0)$ 作为一个变量包含进来。由于 $y(0)=0$ 是一个给定的固定值，在标准表述中它不应是未知向量的一部分。\n    - **结论：**不正确。\n\n基于此逐步分析，只有选项 A 为应用于给定边值问题的单次打靶法和多次打靶法提供了完全正确和一致的表述。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}