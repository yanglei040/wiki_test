{
    "hands_on_practices": [
        {
            "introduction": "自适应求解器如何“知道”何时应该增大或减小步长？这项基本练习将引导你通过比较一个低阶方法（前向欧拉法）和一个高阶方法（休恩法）的结果，来推导经典的步长控制公式。这种利用不同阶方法之差来估计误差的技术，是现代嵌入式龙格-库塔求解器的核心，通过这个练习，你将为理解误差估计的内在机制打下坚实的基础。",
            "id": "2181287",
            "problem": "在数值分析领域，自适应步长方法对于有效求解形式为 $y'(t) = f(t, y)$ 并带有初始条件 $y(t_0) = y_0$ 的常微分方程（ODE）至关重要。这些方法通过调整步长 $h$ 来维持所需的精度水平。\n\n考虑两种在 $t_0+h$ 处近似解的数值方法：\n1.  **前向欧拉法**：其近似值（我们称之为 $y_1$）由下式给出：\n    $$y_1 = y_0 + h f(t_0, y_0)$$\n2.  **休恩法（改进欧拉法）**：其近似值（我们称之为 $y_2$）由下式给出：\n    $$y_2 = y_0 + \\frac{h}{2} \\left[ f(t_0, y_0) + f(t_0+h, y_0 + hf(t_0,y_0)) \\right]$$\n\n前向欧拉法的局部截断误差是二阶的，意味着它与步长 $h$ 的平方 $h^2$ 成正比。休恩法更为精确，其局部截断误差具有更高的阶。一种常见的步长控制策略是使用两种近似值之差 $|y_2 - y_1|$ 来估计当前步长 $h$ 下精度较低方法（前向欧拉法）的误差。\n\n你的任务是为下一步的步长 $h_{\\text{new}}$ 推导一个控制规则。假设当前大小为 $h$ 的步长产生了近似值 $y_1$ 和 $y_2$。目标是选择 $h_{\\text{new}}$，使得下一步的估计误差等于预定义的目标容差 $\\epsilon$。找出用 $h$、$ \\epsilon$、$y_1$ 和 $y_2$ 表示 $h_{\\text{new}}$ 的表达式。",
            "solution": "令 $y(t)$ 表示精确解。前向欧拉法的局部截断误差为 $h^{2}$ 阶，因此对于某个取决于 $f$ 在 $(t_{0},y_{0})$ 处导数的常数 $K$，我们有\n$$\ny_{1}=y(t_{0}+h)-K h^{2}+O(h^{3}).\n$$\n休恩法是更高阶的，其局部截断误差为 $O(h^{3})$，所以\n$$\ny_{2}=y(t_{0}+h)+O(h^{3}).\n$$\n两式相减得到\n$$\ny_{2}-y_{1}=K h^{2}+O(h^{3}),\n$$\n因此，步长为 $h$ 时前向欧拉法的局部误差大小可以估计为\n$$\nE(h)\\approx |y_{2}-y_{1}|\\approx |K| h^{2}.\n$$\n假设在下一步中局部常数 $K$ 同样适用，则新步长 $h_{\\text{new}}$ 的误差满足\n$$\nE(h_{\\text{new}})\\approx |K| h_{\\text{new}}^{2}.\n$$\n使用 $|K|\\approx |y_{2}-y_{1}|/h^{2}$ 消去 $|K|$，得到\n$$\nE(h_{\\text{new}})\\approx \\frac{|y_{2}-y_{1}|}{h^{2}}\\,h_{\\text{new}}^{2}.\n$$\n设定控制目标 $E(h_{\\text{new}})=\\epsilon$ 并求解 $h_{\\text{new}}$：\n$$\n\\epsilon=\\frac{|y_{2}-y_{1}|}{h^{2}}\\,h_{\\text{new}}^{2}\n\\quad\\Longrightarrow\\quad\nh_{\\text{new}}=h\\left(\\frac{\\epsilon}{|y_{2}-y_{1}|}\\right)^{\\frac{1}{2}}.\n$$\n这就利用嵌入对（前向欧拉法，休恩法）提供的误差估计，将下一步长用 $h$、$\\epsilon$、$y_{1}$ 和 $y_{2}$ 表达了出来。",
            "answer": "$$\\boxed{h\\left(\\frac{\\epsilon}{|y_{2}-y_{1}|}\\right)^{\\frac{1}{2}}}$$"
        },
        {
            "introduction": "掌握了步长控制的基本规则后，我们便可以开始预测求解器在面对不同问题时的行为了。这个思想实验  要求你比较两种性质迥异的常微分方程——一个具有指数增长的解，另一个则具有高频振荡的解。通过分析解的高阶导数如何随时间变化，你将培养出一种重要的直觉，理解为什么某些问题会迫使求解器不断减小步长，而另一些问题则允许使用相对恒定的步长高效求解。",
            "id": "2153282",
            "problem": "一个自适应步长的常微分方程（ODE）求解器被用来在时间区间 $t \\in [0, T]$ 上数值近似求解两个不同的初值问题（IVP），其中 $T$ 是一个很大的正数。该求解器的核心机制是在每个时间点调整其步长（记为 $h(t)$），以确保每一步的估计局部截断误差保持近似恒定并低于一个预定义的容差。\n\n考虑以下两个初值问题：\n\n- **问题 A：** $y'(t) = y(t)$，初始条件为 $y(0) = 1$。设求解器为此问题选择的步长为 $h_A(t)$。\n- **问题 B：** $z'(t) = \\cos(\\omega t)$，初始条件为 $z(0) = 0$。这里，$\\omega$ 是一个大的、固定的正常数（即 $\\omega \\gg 1$）。设求解器为此问题选择的步长为 $h_B(t)$。\n\n假设求解器基于一个 $p$ 阶方法（其中 $p \\ge 1$），随着时间 $t$ 在区间 $[0, T]$ 上增加，以下哪个陈述最能描述步长 $h_A(t)$ 和 $h_B(t)$ 的总体趋势？\n\nA. $h_A(t)$ 将大致保持不变，而 $h_B(t)$ 将持续减小。\n\nB. $h_A(t)$ 将持续减小，而 $h_B(t)$ 将大致保持不变。\n\nC. $h_A(t)$ 和 $h_B(t)$ 都将持续减小。\n\nD. $h_A(t)$ 和 $h_B(t)$ 都将大致保持不变。\n\nE. $h_A(t)$ 将持续增大，而 $h_B(t)$ 将大致保持不变。",
            "solution": "一个 $p$ 阶的自适应方法选择步长 $h(t)$，以将局部截断误差（LTE）大致保持在目标容差（比如 $\\varepsilon$）上。对于一个 $p$ 阶的单步法，LTE 具有以下渐近形式\n$$\n\\text{LTE}(t) \\approx C(t)\\,h(t)^{p+1},\n$$\n其中 $C(t)$ 取决于精确解的最高达 $p+1$ 阶的导数（或等价地，$y'=f(t,y)$ 中 $f$ 的导数）。强制要求 $\\text{LTE}(t)\\approx\\varepsilon$ 会得到以下缩放定律\n$$\nh(t) \\approx \\left(\\frac{\\varepsilon}{C(t)}\\right)^{\\frac{1}{p+1}}.\n$$\n\n问题 A：$y'(t)=y(t)$，$y(0)=1$。精确解是 $y(t)=\\exp(t)$。所有高阶导数都满足 $y^{(k)}(t)=\\exp(t)$（对于任意整数 $k\\ge 0$）。因此，系数 $C_{A}(t)$ 与 $|y^{(p+1)}(t)|=|\\exp(t)|=\\exp(t)$ 成正比，所以\n$$\nh_{A}(t)\\approx \\left(\\frac{\\varepsilon}{C_{A}(t)}\\right)^{\\frac{1}{p+1}} \\propto \\exp\\!\\left(-\\frac{t}{p+1}\\right).\n$$\n因此，随着 $t$ 的增加，$h_{A}(t)$ 单调递减。\n\n问题 B：$z'(t)=\\cos(\\omega t)$，$z(0)=0$。精确解是 $z(t)=\\omega^{-1}\\sin(\\omega t)$。其导数满足\n$$\nz^{(k)}(t)=\\omega^{k-1}\\times(\\text{一个正弦或余弦因子}),\n$$\n所以 $|z^{(p+1)}(t)|$ 的上界是 $\\omega^{p}$ 的一个常数倍，与 $t$ 无关，并且只是关于 $t$ 的周期函数。因此 $C_{B}(t)$ 是有界和周期性的，没有随 $t$ 的长期增长，这意味着\n$$\nh_{B}(t)\\approx \\left(\\frac{\\varepsilon}{C_{B}(t)}\\right)^{\\frac{1}{p+1}} \\sim \\text{关于 } t \\text{ 为常数},\n$$\n其量级由 $\\omega$ 决定，因为 $h_{B}\\propto \\omega^{-\\frac{p}{p+1}}$，但不会随时间减小。\n\n因此，$h_{A}(t)$ 随 $t$ 持续减小，而 $h_{B}(t)$ 随着 $t$ 的增加大致保持不变。这对应于选项 B。",
            "answer": "$$\\boxed{B}$$"
        },
        {
            "introduction": "当一个显式自适应方法试图求解一个“刚性”问题时，会发生什么？在刚性问题中，数值稳定性而非局部精度，往往成为限制步长的主要因素。这项练习  将你置于一个关键的数值情景中：求解器所选的当前步长 $h_0$ 恰好位于其稳定性区域的边界。通过计算控制器建议的下一个步长 $h_1$，你将亲手揭示出自适应机制在这种临界状态下的剧烈且通常低效的反应，从而深刻理解刚性问题的核心挑战。",
            "id": "2153280",
            "problem": "一位工程师正在使用一个数值程序来模拟一个由一阶刚性常微分方程（ODE）控制的过程。该程序采用自适应步长策略。积分使用Heun方法（也称为改进欧拉法或二阶Runge-Kutta方法）进行，该方法通过以下步骤将解从时间 $t_n$推进到 $t_{n+1} = t_n + h$：\n1.  $k_1 = f(t_n, y_n)$\n2.  $k_2 = f(t_n + h, y_n + h k_1)$\n3.  $y_{n+1} = y_n + \\frac{h}{2}(k_1 + k_2)$\n\n为了控制步长，每一步的局部误差通过比较Heun方法的结果 $y_{n+1}$ 和更简单的前向欧拉法的结果 $\\hat{y}_{n+1} = y_n + h k_1$ 来估计。局部误差估计定义为 $\\text{err}_{n+1} = |y_{n+1} - \\hat{y}_{n+1}|$。\n\n然后使用标准的比例-积分控制器公式调整步长，为简化分析，此处仅考虑其比例部分：\n$$h_{n+1} = h_n \\left( \\frac{\\text{TOL}}{\\text{err}_{n+1}} \\right)^{p}$$\n其中 $h_n$ 是当前步长， $h_{n+1}$ 是建议的下一步长， $\\text{TOL}$ 是期望的误差容限，指数 $p$ 由 $p = 1/(q+1)$ 给出，其中 $q$ 是用于误差估计的低阶方法的阶数（在此情况下，为前向欧拉法，其阶数为 $q=1$）。\n\n被建模的系统是刚性问题 $y' = -\\lambda y$，其中 $\\lambda = 5 \\times 10^5~\\text{s}^{-1}$。模拟从 $t_0=0$ 开始，初始值为 $y(0) = y_0 = 0.1$。误差容限设置为 $\\text{TOL} = 2.0 \\times 10^{-8}$。\n\n假设由于剧烈的初始瞬态，步长控制器选择了一个初始步长 $h_0$，使得无量纲乘积 $h_0 \\lambda$ 恰好位于Heun方法绝对稳定区域的负实轴边界极值点上。\n\n计算建议的下一步长 $h_1$ 与当前步长 $h_0$ 的比率。将您的最终答案四舍五入到四位有效数字。",
            "solution": "对于线性测试方程 $y'=-\\lambda y$（其中 $\\lambda>0$），应用Heun方法可得\n$$\nk_{1}=-\\lambda y_{n},\\quad k_{2}=-\\lambda\\left(y_{n}+h k_{1}\\right)=-\\lambda y_{n}+h\\lambda^{2}y_{n}.\n$$\n因此\n$$\ny_{n+1}=y_{n}+\\frac{h}{2}\\left(k_{1}+k_{2}\\right)=y_{n}-h\\lambda y_{n}+\\frac{h^{2}}{2}\\lambda^{2}y_{n}.\n$$\n前向欧拉法的结果是\n$$\n\\hat{y}_{n+1}=y_{n}+h k_{1}=y_{n}-h\\lambda y_{n}.\n$$\n因此，局部误差估计为\n$$\n\\text{err}_{n+1}=\\left|y_{n+1}-\\hat{y}_{n+1}\\right|=\\left|\\frac{h^{2}}{2}\\lambda^{2}y_{n}\\right|=\\frac{h^{2}}{2}\\lambda^{2}\\left|y_{n}\\right|.\n$$\n\n对于Heun方法，其稳定函数为 $R(z)=1+z+\\frac{z^{2}}{2}$。沿负实轴，绝对稳定区间为 $z\\in[-2,0]$，其负向边界极值点在 $z=-2$。对于 $y'=-\\lambda y$，有 $z=-h\\lambda$，因此条件 $z=-2$ 意味着\n$$\nh_{0}\\lambda=2.\n$$\n在第一步， $y_{0}=0.1$，因此\n$$\n\\text{err}_{1}=\\frac{h_{0}^{2}}{2}\\lambda^{2}\\left|y_{0}\\right|=\\frac{1}{2}\\left(h_{0}\\lambda\\right)^{2}\\left|y_{0}\\right|=\\frac{1}{2}\\cdot 4 \\cdot 0.1=0.2.\n$$\n\n比例控制器的指数为 $p=\\frac{1}{q+1}=\\frac{1}{2}$（因为对于欧拉法 $q=1$），步长更新为\n$$\n\\frac{h_{1}}{h_{0}}=\\left(\\frac{\\text{TOL}}{\\text{err}_{1}}\\right)^{1/2}=\\left(\\frac{2.0\\times 10^{-8}}{0.2}\\right)^{1/2}=\\left(10^{-7}\\right)^{1/2}=10^{-3.5}=3.162277660\\dots\\times 10^{-4}.\n$$\n四舍五入到四位有效数字，该比率为 $3.162\\times 10^{-4}$。",
            "answer": "$$\\boxed{3.162 \\times 10^{-4}}$$"
        }
    ]
}