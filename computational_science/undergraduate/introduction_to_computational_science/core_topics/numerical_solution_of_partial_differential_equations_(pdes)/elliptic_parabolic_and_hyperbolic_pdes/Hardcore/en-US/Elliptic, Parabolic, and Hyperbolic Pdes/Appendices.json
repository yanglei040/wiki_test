{
    "hands_on_practices": [
        {
            "introduction": "We begin our practical journey with parabolic PDEs, using the heat equation as our model. The Crank-Nicolson scheme is widely praised for its unconditional stability, a property that might suggest that any choice of time step $ \\Delta t $ is safe from catastrophic error growth. This exercise challenges that simple interpretation by revealing a more subtle issue; by applying the scheme to an initial condition with a sharp discontinuity, you will observe and quantify unphysical oscillations that arise for large time steps . This practice is crucial for understanding the important distinction between numerical stability and the faithful representation of physical principles, like the maximum principle in diffusion problems.",
            "id": "2393571",
            "problem": "Consider the one-dimensional heat (diffusion) equation on the interval $[0,1]$ with homogeneous Dirichlet boundary conditions,\n$$\n\\frac{\\partial u}{\\partial t} = \\alpha \\frac{\\partial^2 u}{\\partial x^2}, \\quad x \\in (0,1), \\ t > 0, \\quad u(0,t) = 0, \\ u(1,t) = 0,\n$$\nand a discontinuous initial condition\n$$\nu(x,0) = \\begin{cases}\n1,  x \\in [0.45, 0.55],\\\\\n0,  \\text{otherwise}.\n\\end{cases}\n$$\nAll quantities are dimensionless. Use a uniform spatial grid with $N=201$ equally spaced points (including boundaries), so that $\\Delta x = 1/(N-1)$. Let $\\alpha = 1$.\n\nLet $u_i^n$ denote the numerical approximation to $u(x_i,t_n)$ at the interior grid points $x_i = i \\, \\Delta x$ for $i=1,2,\\dots,N-2$ and time level $t_n = n \\, \\Delta t$. Define the Crank–Nicolson finite difference scheme for advancing one time step from $t_n$ to $t_{n+1}$ as the unique solution $u^{n+1}$ of\n$$\n\\left( I - \\frac{r}{2} L \\right) u^{n+1} = \\left( I + \\frac{r}{2} L \\right) u^{n}, \\quad r = \\frac{\\alpha \\, \\Delta t}{(\\Delta x)^2},\n$$\nwhere $I$ is the identity operator on the interior grid, and $L$ is the standard second-difference operator with homogeneous Dirichlet boundary conditions acting on interior grid values:\n$$\n(L u)_i = u_{i+1} - 2 u_i + u_{i-1}, \\quad i=1,2,\\dots,N-2,\n$$\nwith the understanding that $u_0 = 0$ and $u_{N-1} = 0$ due to the boundary conditions.\n\nFor a given time step $\\Delta t$, define the oscillation amplitude after one Crank–Nicolson time step by\n$$\nA(\\Delta t) = \\max\\!\\left(0, \\ \\max_{1 \\le i \\le N-2} u_i^{1} - 1 \\right) \\;+\\; \\max\\!\\left(0, \\ 0 - \\min_{1 \\le i \\le N-2} u_i^{1} \\right).\n$$\nThis quantity is the sum of the overshoot above the physical upper bound $1$ and the undershoot below the physical lower bound $0$ in the interior after a single time step, starting from the specified discontinuous initial condition at $t=0$.\n\nTest Suite:\n- Use $N=201$ and $\\alpha = 1$ as specified.\n- Let $\\Delta x = 1/(N-1)$.\n- Consider the four time steps\n  1. $\\Delta t_1 = 0.2 \\, (\\Delta x)^2 / \\alpha$,\n  2. $\\Delta t_2 = 1.0 \\, (\\Delta x)^2 / \\alpha$,\n  3. $\\Delta t_3 = 5.0 \\, (\\Delta x)^2 / \\alpha$,\n  4. $\\Delta t_4 = 25.0 \\, (\\Delta x)^2 / \\alpha$.\n  \nFor each $\\Delta t_k$, compute $A(\\Delta t_k)$ as defined above. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order $[A(\\Delta t_1), A(\\Delta t_2), A(\\Delta t_3), A(\\Delta t_4)]$, with each value rounded to six decimal places. The output is dimensionless and contains floating-point numbers only.",
            "solution": "We begin from the heat equation $\\partial_t u = \\alpha \\partial_{xx} u$ on $[0,1]$ with homogeneous Dirichlet boundary conditions and a discontinuous step initial condition confined to $[0.45,0.55]$. The maximum principle for the continuous problem implies that, for $t>0$, the solution remains between $0$ and $1$. However, certain time discretizations, while stable in a norm, are not monotone and can produce nonphysical oscillations such as undershoot (values below $0$) or overshoot (values above $1$) when the initial data has sharp discontinuities. The Crank–Nicolson scheme is a second-order accurate, implicit, unconditionally stable method in the $\\ell^2$ sense, but it is not total variation diminishing nor monotonicity preserving, and can produce such oscillations for sufficiently large time steps.\n\nWe discretize the spatial domain with $N=201$ uniformly spaced nodes, including boundaries, so that $\\Delta x = 1/(N-1)$. We index interior nodes by $i=1,2,\\dots,N-2$ and denote by $u_i^n$ the numerical approximation at $x_i=i\\Delta x$ and time $t_n=n\\Delta t$. The standard centered second-difference operator with homogeneous Dirichlet boundary conditions is defined on interior indices by\n$$\n(Lu)_i = u_{i+1} - 2u_i + u_{i-1}, \\quad i=1,\\dots,N-2,\n$$\nwith boundary values $u_0=0$ and $u_{N-1}=0$ enforced.\n\nThe Crank–Nicolson time-stepping scheme for the semidiscrete system $\\dot{u}=\\alpha \\Delta_x u$ is\n$$\n\\left( I - \\frac{r}{2} L \\right) u^{n+1} = \\left( I + \\frac{r}{2} L \\right) u^{n}, \\quad r = \\frac{\\alpha \\Delta t}{(\\Delta x)^2}.\n$$\nOn a one-dimensional uniform grid, this becomes a tridiagonal linear system for $u^{n+1}$ at interior indices. Writing componentwise for $i=1,\\dots,N-2$,\n$$\n-\\frac{r}{2} \\, u_{i-1}^{n+1} + (1+r) \\, u_i^{n+1} - \\frac{r}{2} \\, u_{i+1}^{n+1}\n=\n\\frac{r}{2} \\, u_{i-1}^{n} + (1-r) \\, u_i^{n} + \\frac{r}{2} \\, u_{i+1}^{n},\n$$\nwith boundary contributions vanishing because $u_0^n=u_{N-1}^n=0$.\n\nThe initial data is set by\n$$\nu_i^0 = \\begin{cases}\n1,  x_i \\in [0.45,0.55],\\\\\n0,  \\text{otherwise},\n\\end{cases}\n\\qquad x_i = i \\Delta x, \\quad i=1,\\dots,N-2.\n$$\n\nTo quantify nonphysical oscillations after one time step, we define the amplitude\n$$\nA(\\Delta t) = \\max\\!\\left(0, \\ \\max_{1 \\le i \\le N-2} u_i^{1} - 1 \\right) \\;+\\; \\max\\!\\left(0, \\ 0 - \\min_{1 \\le i \\le N-2} u_i^{1} \\right).\n$$\nThe first term measures overshoot beyond the physical bound $1$, and the second term measures undershoot below $0$. For the heat equation with nonnegative, bounded initial data, the exact solution remains in $[0,1]$, so any positive $A(\\Delta t)$ indicates an unphysical oscillation caused by the discrete scheme.\n\nWe now discuss why large $r$ leads to oscillations. The discrete Laplacian $L$ on a uniform grid has eigenmodes resembling discrete sines. For a Fourier component with wavenumber $\\theta$, the discrete Laplacian has eigenvalue $\\lambda_d(\\theta) = -4\\sin^2(\\theta/2)$. The Crank–Nicolson amplification factor for this mode is\n$$\ng(\\theta; r) = \\frac{1 + \\frac{r}{2}\\lambda_d(\\theta)}{1 - \\frac{r}{2}\\lambda_d(\\theta)}\n= \\frac{1 - 2 r \\sin^2(\\theta/2)}{1 + 2 r \\sin^2(\\theta/2)}.\n$$\nFor any $r>0$, we have $|g(\\theta;r)|1$, ensuring unconditional stability in $\\ell^2$. However, if $2 r \\sin^2(\\theta/2) > 1$, then $g(\\theta;r)  0$, which flips the sign of those Fourier components in a single time step, generating oscillations near sharp discontinuities where high-frequency content is present. The largest $\\sin^2(\\theta/2)$ is $1$, hence for $r > 1/2$, the highest frequency modes are inverted in sign after one step. Therefore we anticipate negligible oscillations for $r=0.2$, increasing oscillatory undershoot/overshoot for $r=1$, and more pronounced oscillations for $r=5$ and $r=25$.\n\nAlgorithmically, for each specified $\\Delta t_k$ (equivalently $r_k$), we:\n1. Construct $u^0$ from the step initial condition on the interior grid.\n2. Form the tridiagonal system with subdiagonal entries $-r_k/2$, diagonal entries $1+r_k$, and superdiagonal entries $-r_k/2$.\n3. Assemble the right-hand side $(I + \\frac{r_k}{2} L) u^0$ using interior values and $0$ at the boundaries.\n4. Solve the tridiagonal system to obtain $u^1$.\n5. Compute $A(\\Delta t_k)$ as defined above from the interior values of $u^1$.\n6. Repeat for the four test values of $\\Delta t_k$ in the suite.\n\nFinally, we output the list $[A(\\Delta t_1), A(\\Delta t_2), A(\\Delta t_3), A(\\Delta t_4)]$, each rounded to six decimal places, as a single line, comma-separated within brackets. This procedure directly reflects the mathematical structure of the Crank–Nicolson method and quantifies the unphysical oscillations that can arise for large time steps with discontinuous initial data.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef thomas_tridiagonal(lower, diag, upper, rhs):\n    \"\"\"\n    Solve a tridiagonal system Ax = rhs with A having\n    lower (a), diagonal (b), and upper (c) diagonals.\n    All inputs are 1D numpy arrays:\n      lower: length n-1\n      diag:  length n\n      upper: length n-1\n      rhs:   length n\n    Returns x of length n.\n    \"\"\"\n    n = diag.size\n    # Copy to avoid modifying inputs\n    a = lower.astype(float).copy()\n    b = diag.astype(float).copy()\n    c = upper.astype(float).copy()\n    d = rhs.astype(float).copy()\n\n    # Forward elimination\n    for i in range(1, n):\n        w = a[i-1] / b[i-1]\n        b[i] = b[i] - w * c[i-1]\n        d[i] = d[i] - w * d[i-1]\n\n    # Back substitution\n    x = np.empty(n, dtype=float)\n    x[-1] = d[-1] / b[-1]\n    for i in range(n-2, -1, -1):\n        x[i] = (d[i] - c[i] * x[i+1]) / b[i]\n\n    return x\n\ndef crank_nicolson_first_step_amplitude(N, alpha, dt):\n    \"\"\"\n    Compute the oscillation amplitude A(dt) after one Crank-Nicolson step\n    for the 1D heat equation on [0,1] with homogeneous Dirichlet BCs and\n    discontinuous initial condition: u(x,0)=1 on [0.45,0.55], 0 otherwise.\n    \"\"\"\n    # Grid setup\n    L = 1.0\n    dx = L / (N - 1)\n    r = alpha * dt / (dx * dx)\n\n    # Interior indices: 1..N-2 (Python 0..M-1)\n    M = N - 2\n    x_interior = np.linspace(dx, L - dx, M)\n\n    # Initial condition on interior: 1 on [0.45,0.55], else 0\n    u0 = np.where((x_interior >= 0.45)  (x_interior = 0.55), 1.0, 0.0)\n\n    # Build Crank-Nicolson matrices (implicit LHS tridiagonal, RHS vector)\n    # LHS: (I - r/2 * L) => diag: 1 + r; off-diag: -r/2\n    lower = -0.5 * r * np.ones(M - 1)\n    diag = (1.0 + r) * np.ones(M)\n    upper = -0.5 * r * np.ones(M - 1)\n\n    # RHS: (I + r/2 * L) u0 => (1 - r) * u0 + (r/2) * (u0_{i-1} + u0_{i+1})\n    rhs = (1.0 - r) * u0.copy()\n    rhs[:-1] += 0.5 * r * u0[1:]     # contribution from u0_{i+1}\n    rhs[1:]  += 0.5 * r * u0[:-1]    # contribution from u0_{i-1}\n    # Boundary contributions are zero due to homogeneous Dirichlet BCs.\n\n    # Solve for u1\n    u1 = thomas_tridiagonal(lower, diag, upper, rhs)\n\n    # Compute amplitude A(dt) over interior values\n    max_val = float(np.max(u1))\n    min_val = float(np.min(u1))\n    overshoot = max(0.0, max_val - 1.0)\n    undershoot = max(0.0, -min_val)\n    A = overshoot + undershoot\n    return A\n\ndef solve():\n    # Parameters from the problem statement\n    N = 201\n    alpha = 1.0\n    L = 1.0\n    dx = L / (N - 1)\n\n    # Test suite time steps: dt_k = [0.2, 1.0, 5.0, 25.0] * dx^2 / alpha\n    r_values = [0.2, 1.0, 5.0, 25.0]\n    test_dts = [r * dx * dx / alpha for r in r_values]\n\n    results = []\n    for dt in test_dts:\n        A = crank_nicolson_first_step_amplitude(N, alpha, dt)\n        results.append(f\"{A:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nif __name__ == \"__main__\":\n    solve()\n```"
        },
        {
            "introduction": "Next, we turn our attention to hyperbolic PDEs, which govern wave propagation phenomena. Unlike the smoothing nature of parabolic equations, hyperbolic systems advect information, preserving sharp features. In this exercise , you will implement the second-order accurate Lax-Wendroff scheme to solve the linear advection equation for a discontinuous step profile, discovering that the scheme's attempt to capture the sharp, moving front results in spurious oscillations, a numerical artifact related to the Gibbs phenomenon. By quantifying these overshoots and undershoots, you will gain first-hand experience with the fundamental trade-off between higher-order accuracy and the non-oscillatory behavior required in modern shock-capturing methods.",
            "id": "2393549",
            "problem": "Consider the one-dimensional linear advection equation $u_t + a\\,u_x = 0$ on the periodic domain $x \\in [0,1)$ with constant advection speed $a > 0$. Let $a = 1$. The initial condition is the discontinuous step\n$$\nu(x,0) = \\begin{cases}\n1,  x \\ge 0.5,\\\\\n0,  x  0.5.\n\\end{cases}\n$$\nDiscretize space with $N$ uniform cell-centered points $x_j = (j + 0.5)\\,\\Delta x$ for $j \\in \\{0,1,\\dots,N-1\\}$, where $\\Delta x = 1/N$, and impose periodicity. Evolve the discrete solution using the Lax–Wendroff finite difference scheme defined by the update\n$$\nu_j^{n+1} = u_j^n - \\tfrac{1}{2}\\sigma\\left(u_{j+1}^n - u_{j-1}^n\\right) + \\tfrac{1}{2}\\sigma^2\\left(u_{j+1}^n - 2u_j^n + u_{j-1}^n\\right),\n$$\nwith periodic indexing, where the Courant–Friedrichs–Lewy (CFL) number $\\sigma$ is $\\sigma = a\\,\\Delta t / \\Delta x$ and $\\Delta t$ is the time step. For each case below, use the specified $N$, $\\sigma$, and terminal time $t_{\\mathrm{end}}$ to construct $\\Delta t = \\sigma\\,\\Delta x/a$ and evolve for the largest integer number of steps $n$ such that $t_n = n\\,\\Delta t \\le t_{\\mathrm{end}}$. Denote this evolution time by $t_n$.\n\nTo quantify Gibbs-like oscillations near the advected discontinuity, define the theoretical discontinuity location at time $t_n$ as $x_d(t_n) = \\mathrm{mod}(0.5 + a\\,t_n,\\,1)$. Extract a symmetric spatial window of half-width $w_x = 0.1$ centered at $x_d(t_n)$, that is, all grid points $x_j$ satisfying the shortest periodic distance to $x_d(t_n)$ not exceeding $w_x$. Within this window, compute the following three quantities for the discrete solution at time $t_n$:\n- The overshoot amplitude $O = \\max\\{0,\\,\\max_{\\text{window}} u - 1\\}$.\n- The undershoot amplitude $U = \\max\\{0,\\,0 - \\min_{\\text{window}} u\\}$.\n- The total-variation ratio $R = \\mathrm{TV}(u(\\cdot,t_n)) / \\mathrm{TV}(u(\\cdot,0))$, where the discrete total variation is $\\mathrm{TV}(v) = \\sum_{j=0}^{N-1} |v_{j+1} - v_j|$ with periodic indexing.\n\nYour program must evaluate $(O,U,R)$ for each of the following five test cases:\n1. $N=200$, $\\sigma=0.5$, $t_{\\mathrm{end}}=0.2$.\n2. $N=200$, $\\sigma=0.9$, $t_{\\mathrm{end}}=0.2$.\n3. $N=50$, $\\sigma=0.5$, $t_{\\mathrm{end}}=0.2$.\n4. $N=200$, $\\sigma=0.2$, $t_{\\mathrm{end}}=0.2$.\n5. $N=800$, $\\sigma=0.5$, $t_{\\mathrm{end}}=0.2$.\n\nAll quantities are dimensionless. Your program should produce a single line of output containing the results as a comma-separated list of lists, where the $k$-th inner list is $[O_k,U_k,R_k]$ for test case $k$, and each floating-point number is rounded to exactly six decimal places. For example, the required format is\n$$\n[\\,[O_1,U_1,R_1],\\,[O_2,U_2,R_2],\\,\\dots,\\,[O_5,U_5,R_5]\\,].\n$$",
            "solution": "The problem requires the numerical solution of the one-dimensional linear advection equation using the Lax-Wendroff finite difference scheme. The primary objective is to quantify the numerical artifacts, specifically the Gibbs-like oscillations, that arise when applying this second-order, non-monotonic scheme to a discontinuous initial profile.\n\nThe governing partial differential equation is the linear advection equation:\n$$\n\\frac{\\partial u}{\\partial t} + a \\frac{\\partial u}{\\partial x} = 0\n$$\nwhere $u(x, t)$ is the conserved quantity, $x \\in [0, 1)$ is the spatial coordinate with periodic boundary conditions, $t$ is time, and $a$ is the constant advection speed, given as $a=1$. The analytical solution to this equation is a simple translation of the initial profile, $u(x,t) = u_0(x-at)$, where $u_0(x) = u(x,0)$. For the given step-function initial condition:\n$$\nu(x,0) = \\begin{cases}\n1,  x \\ge 0.5 \\\\\n0,  x  0.5\n\\end{cases}\n$$\nthe discontinuity initially at $x=0.5$ advects with speed $a=1$, and its theoretical location at time $t$ is $x_d(t) = \\mathrm{mod}(0.5 + at, 1)$.\n\nThe computational domain is discretized into $N$ uniform cell-centered grid points $x_j = (j + 0.5)\\Delta x$ for $j \\in \\{0, 1, \\dots, N-1\\}$, with a spatial step size of $\\Delta x = 1/N$. Periodicity implies that the indices are treated modulo $N$, so that $x_{j+N} = x_j$.\n\nThe time evolution is governed by the explicit Lax-Wendroff scheme, which is second-order accurate in both space and time. The discrete update formula for the solution $u_j^n \\approx u(x_j, t_n)$ is given by:\n$$\nu_j^{n+1} = u_j^n - \\frac{1}{2}\\sigma(u_{j+1}^n - u_{j-1}^n) + \\frac{1}{2}\\sigma^2(u_{j+1}^n - 2u_j^n + u_{j-1}^n)\n$$\nHere, $\\sigma = a\\Delta t / \\Delta x$ is the Courant-Friedrichs-Lewy (CFL) number, which relates the time step $\\Delta t$, the spatial step $\\Delta x$, and the advection speed $a$. The scheme is stable for $|\\sigma| \\le 1$. The problem specifies $\\Delta t = \\sigma \\Delta x / a$. The simulation runs for the largest integer number of steps, $n_{\\text{steps}}$, such that the total evolution time $t_n = n_{\\text{steps}} \\Delta t$ does not exceed a given terminal time $t_{\\mathrm{end}}$.\n\nThe Lax-Wendroff scheme achieves second-order accuracy by incorporating a term proportional to the second spatial derivative, which counteracts the numerical diffusion of a first-order upwind scheme. However, this introduces numerical dispersion, causing non-physical oscillations (overshoots and undershoots) near sharp gradients or discontinuities, a phenomenon related to the Gibbs effect.\n\nTo quantify these oscillations, we analyze the numerical solution $u_j^{n}$ at the final time $t_n$. A spatial window of half-width $w_x = 0.1$ is defined around the theoretical location of the advected discontinuity, $x_d(t_n)$. This window contains all grid points $x_j$ such that the shortest periodic distance to $x_d(t_n)$, given by $\\min(|x_j - x_d(t_n)|, 1 - |x_j - x_d(t_n)|)$, is no more than $w_x$. Within this window, we compute:\n1.  The overshoot amplitude $O = \\max\\{0, \\max_{\\text{window}} u - 1\\}$. This measures the maximum value of the solution in the window that exceeds the initial maximum of $1$.\n2.  The undershoot amplitude $U = \\max\\{0, 0 - \\min_{\\text{window}} u\\}$. This measures the maximum value by which the solution in the window drops below the initial minimum of $0$.\n\nAdditionally, we evaluate the growth of oscillations by computing the ratio of the total variation (TV) at time $t_n$ to the initial total variation. The discrete total variation of a grid function $v$ is defined as $\\mathrm{TV}(v) = \\sum_{j=0}^{N-1} |v_{j+1} - v_j|$, with periodic indexing $v_N = v_0$. The initial condition is a step function on a periodic domain, which has two jumps (from $0$ to $1$ and from $1$ back to $0$), so its theoretical total variation is $\\mathrm{TV}(u(\\cdot,0)) = 2$. The ratio is $R = \\mathrm{TV}(u(\\cdot,t_n)) / \\mathrm{TV}(u(\\cdot,0))$. For a scheme that is not total variation diminishing (TVD), like Lax-Wendroff, this ratio is expected to be greater than $1$, indicating the creation of new extrema, i.e., oscillations.\n\nThe algorithmic procedure for each test case is as follows:\n1.  Initialize parameters: $N, \\sigma, t_{\\mathrm{end}}$, with $a=1$ and $w_x=0.1$.\n2.  Calculate simulation parameters: $\\Delta x = 1/N$, $\\Delta t = \\sigma \\Delta x / a$, and $n_{\\text{steps}} = \\lfloor t_{\\mathrm{end}} / \\Delta t \\rfloor$. The final time is $t_n = n_{\\text{steps}} \\Delta t$.\n3.  Set up the grid $x_j$ and the initial condition $u^0$, where $u_j^0 = 1$ if $x_j \\ge 0.5$ and $u_j^0 = 0$ otherwise.\n4.  Calculate the initial total variation, $\\mathrm{TV}(u^0)$.\n5.  Iteratively apply the Lax-Wendroff update formula for $n_{\\text{steps}}$ to obtain the final numerical solution $u^{n_{\\text{steps}}}$. Vectorized array operations are used for efficiency, employing circular shifts to handle periodic boundary conditions.\n6.  Determine the theoretical discontinuity location $x_d(t_n) = (0.5 + a t_n) \\pmod 1$.\n7.  Identify the grid points lying within the analysis window of half-width $w_x$ around $x_d(t_n)$.\n8.  Compute the maximum and minimum of the solution within this window to find the overshoot $O$ and undershoot $U$.\n9.  Compute the total variation of the final solution, $\\mathrm{TV}(u^{n_{\\text{steps}}})$, and the ratio $R$.\n10. Store the computed triplet $(O, U, R)$ for the case.\nThis process is repeated for all five specified test cases.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 1D linear advection equation using the Lax-Wendroff scheme for\n    multiple test cases and quantifies numerical oscillations.\n    \"\"\"\n    test_cases = [\n        (200, 0.5, 0.2),\n        (200, 0.9, 0.2),\n        (50, 0.5, 0.2),\n        (200, 0.2, 0.2),\n        (800, 0.5, 0.2),\n    ]\n\n    results = []\n    a = 1.0  # Advection speed\n    w_x = 0.1  # Window half-width for analysis\n\n    for N, sigma, t_end in test_cases:\n        # 1. Setup simulation parameters\n        dx = 1.0 / N\n        dt = sigma * dx / a\n        if dt == 0:\n            num_steps = 0\n        else:\n            num_steps = int(t_end / dt)\n        t_n = num_steps * dt\n\n        # 2. Initialize grid and solution\n        x = (np.arange(N) + 0.5) * dx\n        u = np.where(x >= 0.5, 1.0, 0.0)\n\n        # 3. Calculate initial total variation\n        # TV(v) = sum(|v_{j+1} - v_j|) with periodic indexing\n        # np.roll(u, -1) gives u_{j+1} at index j\n        tv_initial = np.sum(np.abs(np.roll(u, -1) - u))\n        if tv_initial == 0: tv_initial = 1.0 # Avoid division by zero, though not expected here.\n\n        # 4. Time evolution loop (Lax-Wendroff)\n        for _ in range(num_steps):\n            u_jp1 = np.roll(u, -1)  # u_{j+1}\n            u_jm1 = np.roll(u, 1)   # u_{j-1}\n            \n            # Central difference term (first derivative)\n            term1 = -0.5 * sigma * (u_jp1 - u_jm1)\n            \n            # Central difference term (second derivative)\n            term2 = 0.5 * sigma**2 * (u_jp1 - 2.0 * u + u_jm1)\n            \n            u = u + term1 + term2\n        \n        u_final = u\n\n        # 5. Analyze the final solution\n        # Theoretical discontinuity location\n        x_d = (0.5 + a * t_n) % 1.0\n\n        # Identify the analysis window\n        dist = np.abs(x - x_d)\n        periodic_dist = np.minimum(dist, 1.0 - dist)\n        window_mask = periodic_dist = w_x\n        \n        u_window = u_final[window_mask]\n\n        # Handle case where window might be empty, though unlikely with given params\n        if u_window.size > 0:\n            max_u_window = np.max(u_window)\n            min_u_window = np.min(u_window)\n        else:\n            max_u_window = 1.0\n            min_u_window = 0.0\n\n        # Calculate overshoot and undershoot\n        overshoot = max(0.0, max_u_window - 1.0)\n        undershoot = max(0.0, 0.0 - min_u_window)\n\n        # Calculate total variation ratio\n        tv_final = np.sum(np.abs(np.roll(u_final, -1) - u_final))\n        tv_ratio = tv_final / tv_initial\n        \n        results.append([overshoot, undershoot, tv_ratio])\n\n    # 6. Format and print the final output\n    formatted_results = []\n    for O, U, R in results:\n        formatted_results.append(f\"[{O:.6f},{U:.6f},{R:.6f}]\")\n    \n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Finally, we explore elliptic PDEs, which typically model steady-state systems and boundary-value problems. This practice focuses on the 2D Poisson equation, a cornerstone of the field, and investigates a subtle but critical weakness of the standard five-point finite difference approximation of the Laplacian operator . By manufacturing solutions with sharp features oriented differently—one aligned with the grid axes and one diagonally—you will directly measure the method's anisotropic error, providing a powerful demonstration of how the geometry of the computational grid itself can influence the accuracy of the numerical solution.",
            "id": "2393578",
            "problem": "Consider the two-dimensional Poisson equation on the unit square domain, with strong but smooth features whose principal direction is either aligned with the grid axes or diagonally. The mathematical model is the boundary value problem for the scalar field $u(x,y)$ on $[0,1]\\times[0,1]$,\n$$- \\nabla^2 u(x,y) = f(x,y), \\quad (x,y)\\in (0,1)\\times(0,1),$$\nwith Dirichlet boundary condition $u(x,y) = u_{\\text{exact}}(x,y)$ on the boundary $\\partial([0,1]\\times[0,1])$. The Laplacian operator $\\nabla^2$ is defined by $\\nabla^2 u = \\partial^2 u / \\partial x^2 + \\partial^2 u / \\partial y^2$. You must use the standard five-point central-difference finite difference method on a uniform grid to approximate the operator $\\nabla^2$ and solve the resulting linear system for $u(x,y)$ at interior grid points.\n\nUse the method of manufactured solutions to define two exact solutions $u_{\\text{exact}}(x,y)$ whose sharpness is controlled by a width parameter $\\sigma  0$, and whose directions are:\n- A diagonal ridge aligned with the line $x=y$: \n  $$u_{\\mathrm{diag}}(x,y;\\sigma) = \\exp\\!\\left(-\\frac{(x-y)^2}{2\\sigma^2}\\right).$$\n- An axis-aligned ridge along the $x$-axis direction centered at $x=0.5$:\n  $$u_{\\mathrm{axis}}(x,y;\\sigma) = \\exp\\!\\left(-\\frac{(x-0.5)^2}{2\\sigma^2}\\right).$$\n\nFor each manufactured solution, compute its continuous right-hand side $f(x,y)$ by applying the continuous Laplacian $\\nabla^2$ to $u_{\\text{exact}}$ and setting $f(x,y) = -\\nabla^2 u_{\\text{exact}}(x,y)$. For the diagonal ridge, note that $u_{\\mathrm{diag}}(x,y;\\sigma)$ depends on $s=x-y$ only; for a function $g(s)$, use the identities $\\partial^2 g/\\partial x^2 = g''(s)$ and $\\partial^2 g/\\partial y^2 = g''(s)$, which together imply $\\nabla^2 g(s) = 2 g''(s)$. For the axis-aligned ridge, note that $u_{\\mathrm{axis}}(x,y;\\sigma)$ depends only on $x$, so $\\nabla^2 u_{\\mathrm{axis}} = \\partial^2 u_{\\mathrm{axis}}/\\partial x^2$. These operations are all continuous derivatives; do not use discrete approximations to form $f(x,y)$.\n\nDiscretize the domain with a uniform Cartesian grid of $N\\times N$ points with spacing $h = 1/(N-1)$, where $N$ is an odd integer so that the line $y=0.5$ is a grid row. Assemble the standard five-point stencil for the Laplacian on interior points $(i,j)$, enforcing the Dirichlet boundary condition by setting the boundary to the exact manufactured solution. Form and solve the linear system for the interior unknowns using the standard five-point stencil only; do not use any higher-order or nine-point stencils.\n\nAfter computing the numerical solution for both the diagonal and axis-aligned manufactured solutions on the same grid and with the same $\\sigma$, reconstruct the full grid by inserting the exact boundary values. Then, evaluate the following two line-wise maximum absolute errors:\n- The diagonal-line error $E_{\\mathrm{diag}}$: the maximum absolute difference between the numerical and exact solutions along the discrete diagonal grid line $x=y$ (i.e., nodes with indices $i=j$), normalized by the exact maximum amplitude along that line. For $u_{\\mathrm{diag}}$, the exact value along $x=y$ is $1$ for all points on that line.\n- The axis-line error $E_{\\mathrm{axis}}$: the maximum absolute difference between the numerical and exact solutions along the horizontal line $y=0.5$ (i.e., nodes with index $j=(N-1)/2$), normalized by the exact maximum amplitude along that line. For $u_{\\mathrm{axis}}$, the exact peak value along $y=0.5$ occurs at $x=0.5$ and equals $1$.\n\nDefine the failure ratio\n$$R(N,\\sigma) = \\frac{E_{\\mathrm{diag}}}{E_{\\mathrm{axis}}}.$$\nValues $R(N,\\sigma)  1$ indicate that the five-point stencil exhibits a larger error for the diagonally aligned sharp feature than for the axis-aligned feature, which demonstrates the grid-aligned anisotropy and failure to resolve diagonal sharpness at comparable resolution.\n\nYour program must:\n- Implement the five-point central-difference method to solve the Poisson problem for both $u_{\\mathrm{diag}}$ and $u_{\\mathrm{axis}}$, using the same grid and $\\sigma$.\n- Compute $E_{\\mathrm{diag}}$, $E_{\\mathrm{axis}}$, and $R(N,\\sigma)$ for each test case.\n- Output all ratios as a single list on one line as specified below.\n\nNo physical units are involved. Angles are not used. Express all floating-point outputs in plain decimal notation.\n\nTest suite to evaluate coverage:\n- Case $1$ (under-resolved diagonal feature): $N=33$, $\\sigma=0.02$.\n- Case $2$ (improved resolution): $N=65$, $\\sigma=0.02$.\n- Case $3$ (wider feature on coarse grid): $N=33$, $\\sigma=0.04$.\n\nFinal output format:\n- Your program should produce a single line of output containing the three ratios $R(N,\\sigma)$ corresponding to the cases above, as a comma-separated list enclosed in square brackets and with each value rounded to $6$ decimal places (for example, $[r_1,r_2,r_3]$).",
            "solution": "The problem is to solve the Poisson equation on a unit square domain $\\Omega = [0,1]\\times[0,1]$:\n$$ - \\nabla^2 u(x,y) = f(x,y), \\quad (x,y) \\in (0,1)\\times(0,1) $$\nwith Dirichlet boundary conditions $u(x,y) = u_{\\text{exact}}(x,y)$ for $(x,y) \\in \\partial\\Omega$. The operator $\\nabla^2$ is the Laplacian, $\\nabla^2 u = \\frac{\\partial^2 u}{\\partial x^2} + \\frac{\\partial^2 u}{\\partial y^2}$.\n\nThe method of manufactured solutions is employed. We define two exact solutions, $u_{\\mathrm{diag}}$ and $u_{\\mathrm{axis}}$, and derive the corresponding forcing functions $f(x,y)$ by applying the continuous operator: $f = -\\nabla^2 u_{\\text{exact}}$.\n\nFor the diagonal ridge, $u_{\\mathrm{diag}}(x,y;\\sigma) = \\exp(-\\frac{(x-y)^2}{2\\sigma^2})$. Let $g(s) = \\exp(-s^2/(2\\sigma^2))$ with $s=x-y$. The derivatives are $g'(s) = -\\frac{s}{\\sigma^2}g(s)$ and $g''(s) = (\\frac{s^2}{\\sigma^4} - \\frac{1}{\\sigma^2})g(s)$. Using the identity $\\nabla^2 g(x-y) = 2g''(x-y)$, the forcing function is:\n$$ f_{\\mathrm{diag}}(x,y;\\sigma) = -2 g''(x-y) = -2 \\left(\\frac{(x-y)^2}{\\sigma^4} - \\frac{1}{\\sigma^2}\\right) \\exp\\left(-\\frac{(x-y)^2}{2\\sigma^2}\\right) = 2\\left(\\frac{1}{\\sigma^2} - \\frac{(x-y)^2}{\\sigma^4}\\right) \\exp\\left(-\\frac{(x-y)^2}{2\\sigma^2}\\right) $$\n\nFor the axis-aligned ridge, $u_{\\mathrm{axis}}(x,y;\\sigma) = \\exp(-\\frac{(x-0.5)^2}{2\\sigma^2})$. This function only depends on $x$. Let $h(x) = \\exp(-(x-0.5)^2/(2\\sigma^2))$. The Laplacian is $\\nabla^2 h(x) = \\frac{d^2h}{dx^2}$. The second derivative is $\\frac{d^2h}{dx^2} = (\\frac{(x-0.5)^2}{\\sigma^4} - \\frac{1}{\\sigma^2})h(x)$. The forcing function is:\n$$ f_{\\mathrm{axis}}(x,y;\\sigma) = -\\frac{d^2u_{\\mathrm{axis}}}{dx^2} = -\\left(\\frac{(x-0.5)^2}{\\sigma^4} - \\frac{1}{\\sigma^2}\\right) \\exp\\left(-\\frac{(x-0.5)^2}{2\\sigma^2}\\right) = \\left(\\frac{1}{\\sigma^2} - \\frac{(x-0.5)^2}{\\sigma^4}\\right) \\exp\\left(-\\frac{(x-0.5)^2}{2\\sigma^2}\\right) $$\n\nThe domain is discretized using a uniform Cartesian grid with $N \\times N$ points, where $N$ is an odd integer. The grid spacing is $h = 1/(N-1)$. Let the grid points be $(x_i, y_j) = (ih, jh)$ for $i,j \\in \\{0, 1, \\dots, N-1\\}$. Let $U_{i,j}$ be the numerical approximation of $u(x_i, y_j)$.\n\nThe standard $5$-point central difference approximation for the negative Laplacian at an interior grid point $(x_i, y_j)$ for $i,j \\in \\{1, \\dots, N-2\\}$ is:\n$$ -\\nabla^2 u(x_i, y_j) \\approx \\frac{-U_{i+1,j} - U_{i-1,j} - U_{i,j+1} - U_{i,j-1} + 4U_{i,j}}{h^2} $$\nSetting this equal to the forcing term $f(x_i, y_j) = f_{i,j}$ gives the discrete equation:\n$$ 4U_{i,j} - U_{i+1,j} - U_{i-1,j} - U_{i,j+1} - U_{i,j-1} = h^2 f_{i,j} $$\nThis system of linear equations must be solved for the $(N-2) \\times (N-2)$ unknown interior values $U_{i,j}$. The values on the boundary (where $i=0$, $i=N-1$, $j=0$, or $j=N-1$) are known from the Dirichlet condition, $U_{i,j} = u_{\\text{exact}}(x_i, y_j)$. These known boundary values are moved to the right-hand side of the equations for interior points adjacent to the boundary.\n\nThis leads to a linear system of the form $A\\mathbf{u} = \\mathbf{b}$, where $\\mathbf{u}$ is a vector of the $(N-2)^2$ unknown interior grid values, $A$ is a sparse, symmetric positive-definite, block-tridiagonal matrix of size $(N-2)^2 \\times (N-2)^2$, and $\\mathbf{b}$ is the right-hand side vector incorporating both the forcing term $f$ and the boundary conditions. The matrix $A$ has $4$ on its main diagonal, and entries of $-1$ corresponding to the four neighbors in the $5$-point stencil. This sparse system is solved numerically.\n\nAfter solving for the interior values, the full numerical solution grid is reconstructed by embedding the interior solution within the known exact boundary values.\n\nThe errors are then evaluated along specific lines. The diagonal-line error $E_{\\mathrm{diag}}$ is computed for the $u_{\\mathrm{diag}}$ case:\n$$ E_{\\mathrm{diag}} = \\frac{\\max_{i \\in \\{0, \\dots, N-1\\}} |U_{i,i} - u_{\\mathrm{diag}}(x_i, x_i)|}{\\max_{i} u_{\\mathrm{diag}}(x_i, x_i)} = \\max_{i} |U_{i,i} - 1| $$\nThe axis-line error $E_{\\mathrm{axis}}$ is computed for the $u_{\\mathrm{axis}}$ case along the line $y=0.5$, which corresponds to grid index $j_{\\text{mid}} = (N-1)/2$:\n$$ E_{\\mathrm{axis}} = \\frac{\\max_{i \\in \\{0, \\dots, N-1\\}} |U_{i,j_{\\text{mid}}} - u_{\\mathrm{axis}}(x_i, y_{j_{\\text{mid}}})|}{\\max_{i} u_{\\mathrm{axis}}(x_i, y_{j_{\\text{mid}}})} = \\max_{i} |U_{i,j_{\\text{mid}}} - u_{\\mathrm{axis}}(x_i, y_{j_{\\text{mid}}})| $$\nIn both cases, the normalizing maximum amplitude of the exact solution along the respective line is $1$.\n\nFinally, the failure ratio $R(N,\\sigma) = E_{\\mathrm{diag}} / E_{\\mathrm{axis}}$ is computed to quantify the stencil's anisotropic error. The provided program implements this entire procedure for each of the specified test cases.",
            "answer": "```python\nimport numpy as np\nfrom scipy import sparse\nfrom scipy.sparse.linalg import spsolve\n\ndef u_diag_func(X, Y, sigma):\n    \"\"\"Computes the exact solution for the diagonal ridge case.\"\"\"\n    s_sq = (X - Y)**2\n    sigma_sq = sigma**2\n    return np.exp(-s_sq / (2 * sigma_sq))\n\ndef f_diag_func(X, Y, sigma):\n    \"\"\"Computes the forcing term for the diagonal ridge case.\"\"\"\n    s_sq = (X - Y)**2\n    sigma_sq = sigma**2\n    sigma_4 = sigma**4\n    exp_term = np.exp(-s_sq / (2 * sigma_sq))\n    return 2 * (1 / sigma_sq - s_sq / sigma_4) * exp_term\n\ndef u_axis_func(X, Y, sigma):\n    \"\"\"Computes the exact solution for the axis-aligned ridge case.\"\"\"\n    z_sq = (X - 0.5)**2\n    sigma_sq = sigma**2\n    return np.exp(-z_sq / (2 * sigma_sq))\n\ndef f_axis_func(X, Y, sigma):\n    \"\"\"Computes the forcing term for the axis-aligned ridge case.\"\"\"\n    z_sq = (X - 0.5)**2\n    sigma_sq = sigma**2\n    sigma_4 = sigma**4\n    exp_term = np.exp(-z_sq / (2 * sigma_sq))\n    return (1 / sigma_sq - z_sq / sigma_4) * exp_term\n\ndef solve_poisson(N, sigma, u_exact_func, f_func):\n    \"\"\"\n    Solves the 2D Poisson equation using a 5-point finite difference stencil.\n    \"\"\"\n    h = 1.0 / (N - 1)\n    x = np.linspace(0.0, 1.0, N)\n    y = np.linspace(0.0, 1.0, N)\n    X, Y = np.meshgrid(x, y, indexing='xy')\n\n    # Evaluate exact solution and forcing term on the full grid\n    u_exact = u_exact_func(X, Y, sigma)\n    f = f_func(X, Y, sigma)\n    \n    # Number of interior points in one dimension\n    M = N - 2\n    \n    # Construct the sparse matrix A for the linear system\n    main_diag = np.ones(M) * 4\n    off_diag = np.ones(M - 1) * -1\n    T = sparse.diags([off_diag, main_diag, off_diag], [-1, 0, 1], shape=(M, M), format='csr')\n    I_M = sparse.eye(M, format='csr')\n    A = sparse.kron(I_M, T) + sparse.diags([np.ones(M*(M-1))*-1, np.ones(M*(M-1))*-1], [-M, M], format='csr')\n    A = A.tocsc()\n\n    # Construct the right-hand side vector b\n    b_2d = h**2 * f[1:-1, 1:-1]\n    \n    # Add boundary condition contributions to b\n    # Note: U[j, i] corresponds to u at (x_i, y_j)\n    b_2d[:, 0] += u_exact[1:-1, 0]   # Left boundary (x=0)\n    b_2d[:, -1] += u_exact[1:-1, -1] # Right boundary (x=1)\n    b_2d[0, :] += u_exact[0, 1:-1]   # Bottom boundary (y=0)\n    b_2d[-1, :] += u_exact[-1, 1:-1] # Top boundary (y=1)\n    \n    b = b_2d.flatten(order='F') # Flatten column-major, for (i,j) -> k=(i-1)*M+(j-1)\n\n    # Solve the linear system\n    u_vec = spsolve(A, b)\n    \n    # Reshape solution vector to grid and insert into full solution grid\n    U_interior = u_vec.reshape((M, M), order='F')\n    U_numerical = np.copy(u_exact)\n    U_numerical[1:-1, 1:-1] = U_interior\n    \n    return U_numerical, u_exact\n\ndef solve():\n    test_cases = [\n        (33, 0.02),\n        (65, 0.02),\n        (33, 0.04),\n    ]\n\n    results = []\n    for N, sigma in test_cases:\n        # Diagonal case\n        U_diag_numerical, u_exact_diag_grid = solve_poisson(N, sigma, u_diag_func, f_diag_func)\n        diag_numerical = np.diag(U_diag_numerical)\n        diag_exact = np.diag(u_exact_diag_grid)\n        E_diag = np.max(np.abs(diag_numerical - diag_exact))\n\n        # Axis-aligned case\n        U_axis_numerical, u_exact_axis_grid = solve_poisson(N, sigma, u_axis_func, f_axis_func)\n        j_mid = (N - 1) // 2\n        axis_numerical_row = U_axis_numerical[j_mid, :]\n        axis_exact_row = u_exact_axis_grid[j_mid, :]\n        E_axis = np.max(np.abs(axis_numerical_row - axis_exact_row))\n        \n        # Failure ratio\n        R = E_diag / E_axis\n        results.append(R)\n\n    # Format results for printing\n    formatted_results = [f'{r:.6f}' for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}