{
    "hands_on_practices": [
        {
            "introduction": "在深入研究计算方法之前，通过解析方法来掌握建立和求解多维积分是至关重要的。这个经典的“施泰因梅茨体”体积计算问题 () 为此提供了绝佳的练习。它要求我们将一个三维实体可视化，并选择合适的积分策略（如切片法），将一个复杂的三维问题简化为可解的一维积分，从而锻炼我们解决实际几何问题的基本功。",
            "id": "2414954",
            "problem": "考虑两个在三维欧几里得空间 $\\mathbb{R}^{3}$ 中半径为 $r>0$ 的无限长圆柱，其轴线相互垂直相交。设一个圆柱的轴线沿 $x$ 轴，因此其上的点满足 $y^{2}+z^{2}\\le r^{2}$，另一个圆柱的轴线沿 $y$ 轴，因此其上的点满足 $x^{2}+z^{2}\\le r^{2}$。这两个圆柱的交集（一个 Steinmetz 立体）是区域\n$$\nS=\\{(x,y,z)\\in\\mathbb{R}^{3}:\\ y^{2}+z^{2}\\le r^{2}\\ \\text{and}\\ x^{2}+z^{2}\\le r^{2}\\}.\n$$\n使用多维积分的基本原理，确定 $S$ 的精确体积，表示为关于 $r$ 的闭式表达式。请将您的最终答案表示为单个解析表达式。无需四舍五入，也无需单位。",
            "solution": "首先对问题陈述进行验证。\n\n步骤1：提取已知条件。\n- 两个在 $\\mathbb{R}^{3}$ 中半径为 $r>0$ 的无限长圆柱。\n- 圆柱的轴线相互垂直相交。\n- 第一个圆柱的轴线沿 $x$ 轴，由不等式 $y^{2}+z^{2}\\le r^{2}$ 描述。\n- 第二个圆柱的轴线沿 $y$ 轴，由不等式 $x^{2}+z^{2}\\le r^{2}$ 描述。\n- 两个圆柱的交集是立体区域 $S=\\{(x,y,z)\\in\\mathbb{R}^{3}:\\ y^{2}+z^{2}\\le r^{2}\\ \\text{and}\\ x^{2}+z^{2}\\le r^{2}\\}$。\n- 任务是使用多维积分确定 $S$ 的精确体积，并将其表示为关于 $r$ 的闭式表达式。\n\n步骤2：使用提取的已知条件进行验证。\n- **科学依据：** 该问题是多变量微积分中的一个标准练习，涉及欧几里得空间中立体的几何学。它基于已建立的数学原理。\n- **适定性：** 立体 $S$ 是 $\\mathbb{R}^{3}$ 中一个定义明确的紧致区域。其体积是一个唯一、明确定义的量，可以通过三重积分计算。该问题具有唯一、稳定且有意义的解。\n- **客观性：** 该问题使用精确的数学语言和符号陈述。没有主观或含糊不清的术语。\n\n步骤3：结论与行动。\n该问题是有效的。这是一个适定的、标准的数学问题。开始进行求解。\n\n立体区域 $S$ 的体积 $V$ 由函数 $f(x,y,z)=1$ 在区域 $S$ 上的三重积分给出：\n$$\nV = \\iiint_{S} dV\n$$\n区域 $S$ 由两个不等式 $y^{2}+z^{2}\\le r^{2}$ 和 $x^{2}+z^{2}\\le r^{2}$ 定义。\n\n为了计算这个积分，我们将使用切片法。我们将对垂直于某个坐标轴的立体横截面的面积进行积分。我们选择 $z$ 轴。体积可以表示为：\n$$\nV = \\int_{z_{\\min}}^{z_{\\max}} A(z) \\, dz\n$$\n其中 $A(z)$ 是在固定高度 $z$ 处，平行于 $xy$ 平面的立体横截面的面积。\n\n首先，我们确定 $z$ 的范围。对于立体 $S$ 中的任意点 $(x,y,z)$，两个不等式都必须成立。从 $x^{2}+z^{2}\\le r^{2}$，我们得到 $x^{2} \\le r^{2}-z^{2}$。为了使 $x$ 存在实数解，必须有 $r^{2}-z^{2} \\ge 0$，这意味着 $z^{2} \\le r^{2}$。这给出了 $z$ 的范围为 $-r \\le z \\le r$。\n\n接下来，对于在区间 $[-r, r]$ 内的固定值 $z$，定义横截面的不等式为：\n$$\ny^{2} \\le r^{2} - z^{2} \\quad \\implies \\quad -\\sqrt{r^{2}-z^{2}} \\le y \\le \\sqrt{r^{2}-z^{2}}\n$$\n$$\nx^{2} \\le r^{2} - z^{2} \\quad \\implies \\quad -\\sqrt{r^{2}-z^{2}} \\le x \\le \\sqrt{r^{2}-z^{2}}\n$$\n这些不等式描述了在 $xy$ 平面中一个以原点为中心的正方形。该正方形的边长是 $2\\sqrt{r^{2}-z^{2}}$。\n\n这个正方形横截面的面积 $A(z)$ 是：\n$$\nA(z) = \\left(2\\sqrt{r^{2}-z^{2}}\\right)^{2} = 4(r^{2}-z^{2})\n$$\n现在，我们可以通过将这个面积从 $z=-r$ 积分到 $z=r$ 来求得体积 $V$：\n$$\nV = \\int_{-r}^{r} A(z) \\, dz = \\int_{-r}^{r} 4(r^{2}-z^{2}) \\, dz\n$$\n被积函数 $4(r^{2}-z^{2})$ 是关于 $z$ 的偶函数，且积分区间 $[-r, r]$ 关于 $z=0$ 对称。因此，我们可以简化积分为：\n$$\nV = 2 \\int_{0}^{r} 4(r^{2}-z^{2}) \\, dz = 8 \\int_{0}^{r} (r^{2}-z^{2}) \\, dz\n$$\n我们现在对 $z$ 进行积分：\n$$\nV = 8 \\left[ r^{2}z - \\frac{z^{3}}{3} \\right]_{0}^{r}\n$$\n在积分上下限处计算反导函数的值：\n$$\nV = 8 \\left( \\left( r^{2}(r) - \\frac{(r)^{3}}{3} \\right) - \\left( r^{2}(0) - \\frac{(0)^{3}}{3} \\right) \\right)\n$$\n$$\nV = 8 \\left( r^{3} - \\frac{r^{3}}{3} - 0 \\right)\n$$\n$$\nV = 8 \\left( \\frac{3r^{3} - r^{3}}{3} \\right)\n$$\n$$\nV = 8 \\left( \\frac{2r^{3}}{3} \\right)\n$$\n$$\nV = \\frac{16r^{3}}{3}\n$$\n这就是由两个半径为 $r$ 的圆柱以直角相交形成的 Steinmetz 立体的精确体积。",
            "answer": "$$ \\boxed{\\frac{16r^{3}}{3}} $$"
        },
        {
            "introduction": "许多多维积分，尤其是在高维空间中，是无法通过解析方法求解的。蒙特卡洛方法作为一种强大而通用的数值技术应运而生。这个问题 () 提供了一个动手实践的机会，通过编写一个简单的蒙特卡洛模拟来估算一个复杂几何形状的体积。其核心思想——通过测量随机点落入形状内的概率来估计体积——既直观又极其强大，是计算科学中的基石之一。",
            "id": "3162123",
            "problem": "您需要实现一个程序，使用带有接受-拒绝（AR）的蒙特卡洛（MC）方法，估计一个单位超立方体与一个以该超立方体中点为中心的欧几里得球体之间交集的 $d$ 维勒贝格体积。形式上，估计\n$$\n\\text{Vol}\\left([0,1]^d \\cap \\left\\{\\left\\|\\mathbf{x}-\\tfrac{1}{2}\\mathbf{1}\\right\\|_2 \\le r\\right\\}\\right),\n$$\n其中，$d$ 是一个正整数维度，$r$ 是一个非负实数半径，$\\mathbf{x} \\in \\mathbb{R}^d$，$\\mathbf{1}$ 表示 $d$ 维全一向量。\n\n您的任务是从第一性原理出发推导出估计量，并将其实现为一个程序。该估计量必须基于以下基本事实：\n- 如果 $\\mathbf{X}$ 在 $[0,1]^d$ 上均匀分布，那么对于任何可测集 $A \\subseteq [0,1]^d$，\n$$\n\\mathbb{P}(\\mathbf{X} \\in A) = \\frac{\\text{Vol}(A)}{\\text{Vol}([0,1]^d)}.\n$$\n- 指示函数 $I_A(\\mathbf{x})$ 在 $\\mathbf{x} \\in A$ 时等于 $1$，否则等于 $0$。\n- 对于独立同分布的样本 $\\mathbf{X}_1,\\dots,\\mathbf{X}_N \\sim \\text{Uniform}([0,1]^d)$，\n$$\n\\frac{1}{N}\\sum_{i=1}^N I_A(\\mathbf{X}_i)\n$$\n是 $\\mathbb{P}(\\mathbf{X}\\in A)$ 的一个无偏估计量，其方差为\n$$\n\\frac{\\mathbb{P}(\\mathbf{X}\\in A)\\left(1-\\mathbb{P}(\\mathbf{X}\\in A)\\right)}{N}.\n$$\n\n基于这些事实，推导出一个算法，该算法从 $[0,1]^d$ 中均匀采样 $\\mathbf{X}_i$，如果 $\\left\\|\\mathbf{X}_i-\\tfrac{1}{2}\\mathbf{1}\\right\\|_2 \\le r$，则接受该样本。所需体积的 MC AR 估计值是接受样本的比例乘以 $\\text{Vol}([0,1]^d)$，即 $1$。\n\n您的程序必须：\n- 通过计算 $\\left\\|\\mathbf{X}-\\tfrac{1}{2}\\mathbf{1}\\right\\|_2 \\le r$ 来实现接受测试，其中使用欧几里得范数。\n- 使用用户指定的整数伪随机种子以保证可复现性。\n- 正确处理边界情况，包括 $r=0$（体积为 $0$）和 $r \\ge \\sqrt{d}/2$（球体完全覆盖超立方体，因此体积为 $1$）。\n\n此问题不涉及任何物理单位或角度。\n\n测试套件：\n在以下参数集上运行您的实现，每个参数集以元组 $(d, r, N, \\text{seed})$ 的形式给出，其中 $N$ 是样本数：\n- $(1, 0.3, 200000, 42)$\n- $(2, 0.5, 400000, 314159)$\n- $(3, 0.0, 100000, 7)$\n- $\\left(3, \\tfrac{\\sqrt{3}}{2} + 0.02, 100000, 2024\\right)$\n- $(5, 0.6, 600000, 271828)$\n- $(8, 0.5, 800000, 1001)$\n\n所需输出：\n您的程序应生成单行输出，其中包含按上述测试用例顺序排列的估计体积，形式为方括号内由逗号分隔的浮点数列表。每个浮点数必须四舍五入到六位小数。例如，输出格式必须是\n$$\n[\\text{v}_1, \\text{v}_2, \\text{v}_3, \\text{v}_4, \\text{v}_5, \\text{v}_6],\n$$\n其中每个 $\\text{v}_i$ 是一个四舍五入到六位小数的浮点数。",
            "solution": "用户提交了一个问题以进行验证和求解。\n\n### 步骤 1：提取已知信息\n- **目标**：估计一个单位超立方体与一个以该超立方体中点为中心的欧几里得球体之间交集的 $d$ 维勒贝格体积。\n- **形式化表达式**：$\\text{Vol}\\left([0,1]^d \\cap \\left\\{\\mathbf{x} \\in \\mathbb{R}^d \\,:\\, \\left\\|\\mathbf{x}-\\tfrac{1}{2}\\mathbf{1}\\right\\|_2 \\le r\\right\\}\\right)$。\n- **参数**：$d$ 是一个正整数维度；$r$ 是一个非负实数半径。\n- **向量**：$\\mathbf{x} \\in \\mathbb{R}^d$；$\\mathbf{1}$ 是 $d$ 维全一向量。\n- **方法**：带有接受-拒绝（AR）的蒙特卡洛（MC）方法。\n- **理论基础**：\n    - 对于 $\\mathbf{X} \\sim \\text{Uniform}([0,1]^d)$ 和一个可测集 $A \\subseteq [0,1]^d$，$\\mathbb{P}(\\mathbf{X} \\in A) = \\frac{\\text{Vol}(A)}{\\text{Vol}([0,1]^d)}$。\n    - 使用独立同分布样本 $\\mathbf{X}_1,\\dots,\\mathbf{X}_N$ 对 $\\mathbb{P}(\\mathbf{X}\\in A)$ 的估计量是 $\\frac{1}{N}\\sum_{i=1}^N I_A(\\mathbf{X}_i)$。\n- **实现要求**：\n    - 算法必须从 $\\text{Uniform}([0,1]^d)$ 中采样 $\\mathbf{X}_i$，如果 $\\left\\|\\mathbf{X}_i-\\tfrac{1}{2}\\mathbf{1}\\right\\|_2 \\le r$ 则接受。\n    - 估计值是接受样本的比例乘以 $\\text{Vol}([0,1]^d) = 1$。\n    - 必须使用用户指定的整数伪随机种子。\n    - 必须处理边界情况 $r=0$（体积为 $0$）和 $r \\ge \\sqrt{d}/2$（体积为 $1$）。\n- **测试套件**：\n    - $(1, 0.3, 200000, 42)$\n    - $(2, 0.5, 400000, 314159)$\n    - $(3, 0.0, 100000, 7)$\n    - $\\left(3, \\tfrac{\\sqrt{3}}{2} + 0.02, 100000, 2024\\right)$\n    - $(5, 0.6, 600000, 271828)$\n    - $(8, 0.5, 800000, 1001)$\n- **输出格式**：单行 `[v_1,v_2,v_3,v_4,v_5,v_6]`，其中每个 $v_i$ 是一个四舍五入到六位小数的浮点数。\n\n### 步骤 2：使用提取的已知信息进行验证\n对问题进行验证。\n- **科学依据**：该问题是蒙特卡洛积分的标准应用，这是计算科学和统计学中的一项基本技术。其底层的数学原理是正确的。\n- **适定性**：该问题是适定的。它要求使用明确描述的方法对特定体积进行数值估计。计算所需的所有参数都在测试套件中提供。\n- **客观性**：该问题使用精确无歧义的数学语言陈述。\n- **缺陷分析**：\n    1.  **科学/事实不健全**：无。数学前提是合理的。\n    2.  **非形式化/不相关**：无。该问题是在多维积分方面一个可形式化且相关的练习。\n    3.  **不完整/矛盾的设置**：无。该问题提供了所有必要的数据和定义。\n    4.  **不切实际/不可行**：不适用。该问题是一个数学抽象。\n    5.  **病态/结构不良**：无。可以计算出唯一（使用给定种子可复现）的解。\n    6.  **伪深刻/琐碎/同义反复**：无。虽然这个概念是基础性的，但其实现需要仔细应用这些原理，特别是在向量化方式下以提高效率。边界情况的陈述是正确的，并作为重要的检查。\n    7.  **超出科学可验证性范围**：无。结果由算法确定且可验证。\n\n### 步骤 3：结论与行动\n该问题是**有效的**。将提供一个合理的解决方案。\n\n该问题要求估计在 $d$ 维欧几里得空间 $\\mathbb{R}^d$ 中两个几何对象交集的体积。第一个对象是单位超立方体，定义为 $H = [0,1]^d$。第二个对象是一个闭合的欧几里得球体 $B$，半径为 $r \\ge 0$，中心点为 $\\mathbf{c} = \\frac{1}{2}\\mathbf{1}$，其中 $\\mathbf{1}$ 是 $d$ 维全一向量。中心点 $\\mathbf{c}$ 是超立方体 $H$ 的几何中点。球体形式上定义为 $B = \\{\\mathbf{x} \\in \\mathbb{R}^d \\,:\\, \\|\\mathbf{x}-\\mathbf{c}\\|_2 \\le r\\}$。我们的任务是使用蒙特卡洛方法估计 $\\text{Vol}(H \\cap B)$。\n\n该方法的基础在于概率论的原理。令 $A = H \\cap B$ 为我们希望估计其体积的区域。蒙特卡洛方法利用一个采样域，在这种情况下，自然是单位超立方体 $H$，因为 $A$ 是 $H$ 的子集。该超立方体的体积是 $\\text{Vol}(H) = 1^d = 1$。\n\n令 $\\mathbf{X}$ 是一个在超立方体 $H$ 上均匀分布的随机向量，记作 $\\mathbf{X} \\sim \\text{Uniform}(H)$。对于任意可测子集 $A \\subseteq H$，$\\mathbf{X}$ 落在 $A$ 内的概率由体积之比给出：\n$$\n\\mathbb{P}(\\mathbf{X} \\in A) = \\frac{\\text{Vol}(A)}{\\text{Vol}(H)}\n$$\n由于 $\\text{Vol}(H) = 1$，此关系简化为该问题的基本恒等式：\n$$\n\\mathbb{P}(\\mathbf{X} \\in A) = \\text{Vol}(A)\n$$\n这个恒等式意味着估计 $A$ 的体积等同于估计概率 $\\mathbb{P}(\\mathbf{X} \\in A)$。\n\n蒙特卡洛方法提供了一种估计该概率的方法。我们生成大量（$N$ 个）独立同分布（i.i.d.）的随机样本 $\\mathbf{X}_1, \\mathbf{X}_2, \\dots, \\mathbf{X}_N$，所有样本都从 $H$ 上的均匀分布中抽取。\n\n对于每个样本 $\\mathbf{X}_i$，我们检查它是否落在我们感兴趣的区域 $A$ 内。这是通过使用指示函数 $I_A(\\mathbf{x})$ 来完成的，其定义为：\n$$\nI_A(\\mathbf{x}) = \\begin{cases} 1  \\text{if } \\mathbf{x} \\in A \\\\ 0  \\text{if } \\mathbf{x} \\notin A \\end{cases}\n$$\n一个从 $H$ 中抽取的样本 $\\mathbf{X}_i$ 在 $A = H \\cap B$ 中当且仅当它也在 $B$ 中。一个点 $\\mathbf{x}$ 在 $B$ 中的条件是 $\\left\\|\\mathbf{x}-\\tfrac{1}{2}\\mathbf{1}\\right\\|_2 \\le r$。这是我们蒙特卡洛模拟的接受条件。\n\n根据大数定律，概率 $\\mathbb{P}(\\mathbf{X} \\in A)$ 的一个无偏估计量是指示函数值的样本均值：\n$$\n\\widehat{\\mathbb{P}(\\mathbf{X} \\in A)} = \\frac{1}{N} \\sum_{i=1}^N I_A(\\mathbf{X}_i)\n$$\n设 $N_{in}$ 为满足接受条件的样本数量。则 $N_{in} = \\sum_{i=1}^N I_A(\\mathbf{X}_i)$，概率的估计量变为接受样本的比例：\n$$\n\\widehat{\\mathbb{P}(\\mathbf{X} \\in A)} = \\frac{N_{in}}{N}\n$$\n由于 $\\text{Vol}(A) = \\mathbb{P}(\\mathbf{X} \\in A)$，我们对体积的估计 $\\widehat{\\text{Vol}}(A)$ 是：\n$$\n\\widehat{\\text{Vol}}(A) = \\frac{N_{in}}{N}\n$$\n这与问题陈述中给出的定义相符：接受样本的比例乘以 $\\text{Vol}([0,1]^d)$，即 $1$。\n\n对于一组给定的参数 $(d, r, N, \\text{seed})$，算法流程如下：\n1. 将伪随机数生成器的种子设置为指定值，以确保可复现性。\n\n2. 处理半径 $r$ 的边界情况。\n   - 如果 $r \\le 0$，球体 $B$ 退化为单点 $\\mathbf{c} = \\frac{1}{2}\\mathbf{1}$（或为空集）。在 $\\mathbb{R}^d$（对于 $d \\ge 1$）中，单点的勒贝格体积为 $0$。因此，交集的体积为 $0$。\n   - 从中心 $\\mathbf{c}$ 到超立方体 $H$ 中任意点 $\\mathbf{x}$ 的最大距离出现在超立方体的顶点处（例如，原点 $\\mathbf{0}$ 或点 $\\mathbf{1}$）。从中心到顶点的平方距离是 $\\left\\|\\mathbf{0}-\\tfrac{1}{2}\\mathbf{1}\\right\\|_2^2 = \\sum_{j=1}^d (-\\tfrac{1}{2})^2 = d(\\tfrac{1}{4}) = \\tfrac{d}{4}$。因此，最大距离是 $\\sqrt{\\tfrac{d}{4}} = \\tfrac{\\sqrt{d}}{2}$。如果半径 $r$ 大于或等于这个最大距离，即 $r \\ge \\tfrac{\\sqrt{d}}{2}$，那么球体 $B$ 完全包含超立方体 $H$。在这种情况下，交集 $H \\cap B$ 就是 $H$ 本身，其体积是 $\\text{Vol}(H) = 1$。\n\n3. 如果两种边界情况都不适用（即 $0  r  \\tfrac{\\sqrt{d}}{2}$），则继续进行蒙特卡洛模拟：\n   a. 初始化接受样本的计数器 $N_{in}$ 为 $0$。\n   b. 生成 $N$ 个随机向量 $\\mathbf{X}_1, \\dots, \\mathbf{X}_N$。每个向量 $\\mathbf{X}_i \\in \\mathbb{R}^d$ 通过从均匀分布 $\\text{Uniform}([0,1])$ 中独立抽取其 $d$ 个分量来生成。\n   c. 对于每个样本 $\\mathbf{X}_i$：\n      i. 计算与超立方体中心的欧几里得距离的平方：$D^2 = \\left\\|\\mathbf{X}_i - \\tfrac{1}{2}\\mathbf{1}\\right\\|_2^2$。这可以计算为 $\\sum_{j=1}^d (X_{ij} - \\tfrac{1}{2})^2$，其中 $X_{ij}$ 是向量 $\\mathbf{X}_i$ 的第 $j$ 个分量。\n      ii. 将平方距离与半径的平方 $r^2$ 进行比较。使用平方值可以避免在主循环中进行计算成本高昂的平方根运算。如果 $D^2 \\le r^2$，则接受该样本，并将计数器 $N_{in}$ 加一。\n   d. 检查完所有 $N$ 个样本后，估计的体积计算为比率 $\\frac{N_{in}}{N}$。\n\n在实现上，使用 NumPy 的向量化方法效率很高。所有 $N$ 个样本的生成可以在单个操作中完成，创建一个 $N \\times d$ 的矩阵。后续的距离计算和最终接受样本的计数也可以使用向量化的数组操作来执行，与显式循环相比，性能显著提高。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef estimate_volume(d: int, r: float, N: int, seed: int) - float:\n    \"\"\"\n    Estimates the volume of the intersection of a unit hypercube and a ball.\n\n    Args:\n        d: The dimension of the space.\n        r: The radius of the ball.\n        N: The number of Monte Carlo samples.\n        seed: The pseudorandom seed for reproducibility.\n\n    Returns:\n        The estimated volume.\n    \"\"\"\n    # Handle the boundary case where the radius is zero or negative.\n    # The intersection is a single point (or empty), which has zero volume.\n    if r = 0:\n        return 0.0\n\n    # Calculate the maximum distance from the center of the hypercube to any corner.\n    # This distance is sqrt(d * (1/2)^2) = sqrt(d)/2.\n    max_dist_from_center = np.sqrt(d) / 2.0\n    \n    # Handle the boundary case where the ball completely encloses the hypercube.\n    # The volume of the intersection is the volume of the hypercube, which is 1.\n    if r = max_dist_from_center:\n        return 1.0\n\n    # Set up the random number generator with the specified seed for reproducibility.\n    rng = np.random.default_rng(seed)\n\n    # Generate N random samples, each a d-dimensional vector. The components\n    # are uniformly distributed in [0, 1), which makes the vectors\n    # uniformly distributed in the hypercube [0, 1]^d.\n    # This creates a matrix of size N x d.\n    samples = rng.random((N, d))\n\n    # Center the samples around the origin by subtracting 0.5.\n    # This corresponds to computing the vector difference X - (1/2)*1.\n    # The hypercube is now effectively [-0.5, 0.5]^d.\n    centered_samples = samples - 0.5\n\n    # Calculate the squared Euclidean distance of each sample from the center (origin).\n    # This is done by squaring each component and summing along the rows (axis=1).\n    # Using squared distances avoids a costly square root operation for each sample.\n    sq_distances = np.sum(centered_samples**2, axis=1)\n\n    # The acceptance condition is that the distance is less than or equal to the radius r,\n    # which is equivalent to the squared distance being less than or equal to r^2.\n    r_squared = r**2\n    \n    # Count the number of samples that fall inside the ball.\n    # In NumPy, summing a boolean array treats True as 1 and False as 0.\n    accepted_count = np.sum(sq_distances = r_squared)\n\n    # The estimated volume is the fraction of accepted samples, since the volume\n    # of the sampling domain ([0,1]^d) is 1.\n    volume_estimate = accepted_count / N\n\n    return volume_estimate\n\ndef solve():\n    \"\"\"\n    Runs the volume estimation for the test suite specified in the problem.\n    \"\"\"\n    # Test Suite: (d, r, N, seed)\n    test_cases = [\n        (1, 0.3, 200000, 42),\n        (2, 0.5, 400000, 314159),\n        (3, 0.0, 100000, 7),\n        (3, np.sqrt(3)/2 + 0.02, 100000, 2024),\n        (5, 0.6, 600000, 271828),\n        (8, 0.5, 800000, 1001),\n    ]\n\n    results = []\n    for d, r, N, seed in test_cases:\n        volume = estimate_volume(d, r, N, seed)\n        # Format the result as a string rounded to six decimal places.\n        results.append(f\"{volume:.6f}\")\n\n    # Print the final list of results in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "虽然简单蒙特卡洛方法行之有效，但当被积函数存在尖峰或目标区域很小时，其收敛效率可能很低。为此，我们引入一种更高级的方差缩减技术——重要性采样。这个问题 () 挑战我们进行策略性思考，即如何选择一个与被积函数形态相似的概率分布进行采样，从而用更少的样本获得更精确的估计。它将积分的抽象数学与计算物理中的实际挑战联系起来，展示了理论在实践中的威力。",
            "id": "2414989",
            "problem": "您希望使用三维蒙特卡洛（MC）积分中的重要性采样来估计氢原子基态电子的期望值 $\\langle 1/r \\rangle$。基态空间波函数是经过充分检验的结果 $\\psi_{100}(\\mathbf{r}) = \\dfrac{1}{\\sqrt{\\pi a_0^3}} e^{-r/a_0}$，其中 $a_0$ 是玻尔半径，$r = \\|\\mathbf{r}\\|$。该期望值可以写成在三维空间上的勒贝格积分，\n$$\n\\langle 1/r \\rangle \\;=\\; \\int_{\\mathbb{R}^3} \\frac{1}{r}\\,|\\psi_{100}(\\mathbf{r})|^2 \\, d^3 \\mathbf{r},\n$$\n您将通过从一个概率密度函数 (PDF) $p(\\mathbf{r})$ 中进行随机采样，并使用重要性采样估计量来计算该积分。根据重要性采样的基本原理，一个理想的 $p(\\mathbf{r})$ 选择应在保持可归一化且在球坐标系中易于采样的同时，使估计量的方差最小化。\n\n以下哪个在 $\\mathbb{R}^3$ 上的各向同性 PDF 能够为 $\\langle 1/r \\rangle$ 产生一个零方差、无偏的 MC 估计量，并且允许一个可以用一维分布表示的简单径向采样规则？请选择一个选项。\n\nA. $p_A(\\mathbf{r}) \\;=\\; \\dfrac{1}{\\pi a_0^3}\\, e^{-2 r/a_0}$\n\nB. $p_B(\\mathbf{r}) \\;=\\; \\dfrac{1}{\\pi a_0^2}\\, \\dfrac{e^{-2 r/a_0}}{r}$\n\nC. $p_C(\\mathbf{r}) \\;=\\; \\dfrac{1}{Z}\\, \\dfrac{e^{-2 r/a_0}}{r^2}$，其中 $Z$ 是一个有限的归一化常数，其选择使得 $\\int_{\\mathbb{R}^3} p_C(\\mathbf{r})\\, d^3\\mathbf{r} = 1$\n\nD. 对于 $r \\le R$，$p_D(\\mathbf{r}) \\;=\\; \\dfrac{3}{4 \\pi R^3}$，而对于 $rR$，$p_D(\\mathbf{r})=0$，其中 $R0$ 是一个固定的截断半径",
            "solution": "我们从已知密度下的期望值定义和重要性采样估计量的构造开始。该期望值为\n$$\nI \\;\\equiv\\; \\langle 1/r \\rangle \\;=\\; \\int_{\\mathbb{R}^3} f(\\mathbf{r}) \\, d^3 \\mathbf{r}, \\quad \\text{其中} \\quad f(\\mathbf{r}) \\;=\\; \\frac{1}{r} |\\psi_{100}(\\mathbf{r})|^2.\n$$\n带有重要性采样的蒙特卡洛（MC）方法从一个概率密度函数（PDF）$p(\\mathbf{r})$ 中抽取 $\\mathbf{r}$ 并估计\n$$\n\\widehat{I}_N \\;=\\; \\frac{1}{N} \\sum_{i=1}^N \\frac{f(\\mathbf{r}_i)}{p(\\mathbf{r}_i)}, \\quad \\mathbf{r}_i \\sim p(\\mathbf{r}).\n$$\n只要在 $f(\\mathbf{r})\\neq 0$ 的所有地方都有 $p(\\mathbf{r})0$ 并且 $\\int p(\\mathbf{r})\\,d^3\\mathbf{r}=1$，这个估计量就是无偏的。其方差为\n$$\n\\mathrm{Var}_p\\!\\left[\\frac{f(\\mathbf{r})}{p(\\mathbf{r})}\\right] \\;=\\; \\int_{\\mathbb{R}^3} \\frac{f(\\mathbf{r})^2}{p(\\mathbf{r})} \\, d^3\\mathbf{r} \\;-\\; I^2,\n$$\n在归一化约束 $\\int p = 1$ 下，该方差可通过变分法选择\n$$\np_{\\star}(\\mathbf{r}) \\;\\propto\\; |f(\\mathbf{r})|\n$$\n来最小化。当 $f(\\mathbf{r}) \\ge 0$ 时，这个最优 PDF 会产生一个零方差估计量，因为 $f(\\mathbf{r})/p_{\\star}(\\mathbf{r})$ 几乎处处为常数。\n\n对于氢原子基态，\n$$\n|\\psi_{100}(\\mathbf{r})|^2 \\;=\\; \\frac{1}{\\pi a_0^3} e^{-2r/a_0},\n$$\n所以\n$$\nf(\\mathbf{r}) \\;=\\; \\frac{1}{r}\\, |\\psi_{100}(\\mathbf{r})|^2 \\;=\\; \\frac{1}{\\pi a_0^3}\\, \\frac{e^{-2r/a_0}}{r}.\n$$\n因此，最优重要性密度是\n$$\np_{\\star}(\\mathbf{r}) \\;=\\; C\\, \\frac{e^{-2r/a_0}}{r},\n$$\n其中归一化常数 $C$ 的选择要使得 $\\int_{\\mathbb{R}^3} p_{\\star}(\\mathbf{r})\\, d^3\\mathbf{r} = 1$。切换到球坐标系并使用 $d^3\\mathbf{r} = 4\\pi r^2 dr$，我们得到\n$$\n1 \\;=\\; \\int_{\\mathbb{R}^3} p_{\\star}(\\mathbf{r})\\, d^3\\mathbf{r} \\;=\\; 4\\pi C \\int_{0}^{\\infty} r \\, e^{-2r/a_0}\\, dr \\;=\\; 4\\pi C \\left(\\frac{a_0^2}{4}\\right),\n$$\n所以\n$$\nC \\;=\\; \\frac{1}{\\pi a_0^2},\n$$\n因此\n$$\np_{\\star}(\\mathbf{r}) \\;=\\; \\frac{1}{\\pi a_0^2}\\, \\frac{e^{-2r/a_0}}{r}.\n$$\n通过这个选择，重要性权重为\n$$\n\\frac{f(\\mathbf{r})}{p_{\\star}(\\mathbf{r})} \\;=\\; \\frac{\\dfrac{1}{\\pi a_0^3}\\, \\dfrac{e^{-2r/a_0}}{r}}{\\dfrac{1}{\\pi a_0^2}\\, \\dfrac{e^{-2r/a_0}}{r}} \\;=\\; \\frac{1}{a_0},\n$$\n这是一个常数。因此该估计量方差为零且无偏，我们立即得到精确结果 $I=\\langle 1/r \\rangle = 1/a_0$。\n\n一个实用的采样规则源于由 $p_{\\star}(\\mathbf{r})$ 导出的径向 PDF：\n$$\np_{\\star,r}(r) \\;=\\; \\int p_{\\star}(\\mathbf{r})\\, d\\Omega \\;=\\; 4\\pi r^2\\, p_{\\star}(\\mathbf{r}) \\;=\\; \\frac{4}{a_0^2}\\, r\\, e^{-2r/a_0}, \\quad r \\ge 0,\n$$\n这是一个形状参数 $k=2$、尺度参数 $\\theta = a_0/2$ 的 Gamma 分布。人们可以从 $\\mathrm{Gamma}(k=2, \\theta=a_0/2)$ 中采样 $r$，并在单位球面上均匀采样一个方向，从而得到 $\\mathbf{r}$。\n\n我们现在分析每个选项：\n\n选项 A. $p_A(\\mathbf{r}) = \\dfrac{1}{\\pi a_0^3} e^{-2 r / a_0}$。这是物理构型空间概率密度 $|\\psi_{100}|^2$。从 $p_A$ 采样得到的估计量为 $\\dfrac{f(\\mathbf{r})}{p_A(\\mathbf{r})} = \\dfrac{1}{r}$，它是无偏的。然而，其方差不为零。事实上，在 $p_A$ 下，径向 PDF 是 $p_{A,r}(r) = \\dfrac{4}{a_0^3} r^2 e^{-2r/a_0}$，对于此分布\n$$\n\\mathbb{E}_{p_A}\\!\\left[\\frac{1}{r}\\right] \\;=\\; \\frac{1}{a_0}, \\quad \\mathbb{E}_{p_A}\\!\\left[\\frac{1}{r^2}\\right] \\;=\\; \\frac{2}{a_0^2},\n$$\n所以\n$$\n\\mathrm{Var}_{p_A}\\!\\left[\\frac{1}{r}\\right] \\;=\\; \\frac{2}{a_0^2} - \\frac{1}{a_0^2} \\;=\\; \\frac{1}{a_0^2} \\;\\; 0.\n$$\n结论：不正确，因为它不满足零方差的标准。\n\n选项 B. $p_B(\\mathbf{r}) = \\dfrac{1}{\\pi a_0^2} \\dfrac{e^{-2 r / a_0}}{r}$。这与上面推导出的 $p_{\\star}(\\mathbf{r})$ 相匹配。它已被正确归一化，并产生常数权重 $\\dfrac{1}{a_0}$，因此是一个零方差、无偏的估计量。其径向 PDF 为 $p_{B,r}(r) = \\dfrac{4}{a_0^2} r e^{-2r/a_0}$，这是一个形状参数 $k=2$、尺度参数 $\\theta = a_0/2$ 的简单 Gamma 分布，使得采样变得直接。结论：正确。\n\n选项 C. $p_C(\\mathbf{r}) = \\dfrac{1}{Z}\\, \\dfrac{e^{-2 r/a_0}}{r^2}$，具有有限的 $Z$。这是可归一化的，因为 $\\int_{0}^{\\infty} e^{-2r/a_0}\\, dr$ 收敛，并且如果用于重要性权重中，它是无偏的。然而，其权重为\n$$\n\\frac{f(\\mathbf{r})}{p_C(\\mathbf{r})} \\;=\\; \\frac{\\dfrac{1}{\\pi a_0^3}\\, \\dfrac{e^{-2r/a_0}}{r}}{\\dfrac{1}{Z}\\, \\dfrac{e^{-2r/a_0}}{r^2}} \\;=\\; \\frac{Z}{\\pi a_0^3}\\, r,\n$$\n该权重不是常数，因此不会产生零方差。此外，权重随 $r$ 线性增长的趋势会相对于最优选择增加方差。结论：不符合所述标准。\n\n选项 D. 对于 $r \\le R$，$p_D(\\mathbf{r}) = \\dfrac{3}{4 \\pi R^3}$，在其他情况下为零，具有固定的 $R0$。这是可归一化且易于采样的，但对于任何有限的 $R$，它都会产生一个有偏估计量，因为对于所有 $r0$ 都有 $f(\\mathbf{r})0$，而对于 $rR$ 却有 $p_D(\\mathbf{r})=0$，因此来自 $rR$ 的积分贡献被忽略了。如果尝试令 $R \\to \\infty$，则该均匀密度在 $\\mathbb{R}^3$ 中将不可归一化。结论：不正确。\n\n因此，唯一能提供一个零方差、无偏的 MC 估计量且具有简单径向采样规则的选项是选项 B。",
            "answer": "$$\\boxed{B}$$"
        }
    ]
}