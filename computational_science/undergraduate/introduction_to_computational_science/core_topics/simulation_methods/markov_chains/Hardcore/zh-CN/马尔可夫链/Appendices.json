{
    "hands_on_practices": [
        {
            "introduction": "掌握马尔可夫链的第一步是学会如何将其应用于具体场景。这个练习将引导你完成一个基本但至关重要的任务：将一个系统的规则转化为一个转移矩阵，并用它来预测系统在未来几个时间步内的状态。通过为一个视频游戏角色建模，你将亲手计算状态概率的演变，这是理解马尔可夫链动态行为的基础。",
            "id": "1639029",
            "problem": "一位工程师正在为一款视频游戏编写一个非玩家角色（NPC）守卫的行为程序。该NPC的状态以离散的时间步长（或称为“更新周期”）进行更新。该NPC可以处于三种状态之一：“巡逻”（Patrol）、“警戒”（Alert）或“攻击”（Attack）。这些状态之间的转换是概率性的，并且仅取决于当前状态。\n\n- 如果NPC处于“巡逻”状态，它会遵循预定义的路线。在任何给定的更新周期中，它有80%的概率保持在“巡逻”状态，有20%的概率听到可疑声音并转换到“警戒”状态。它不能直接从“巡逻”状态转换到“攻击”状态。\n\n- 如果NPC处于“警戒”状态，它会主动调查干扰。在任何给定的更新周期中，它有30%的概率一无所获并返回“巡逻”状态，有40%的概率继续调查并保持在“警戒”状态，还有30%的概率发现玩家并转换到“攻击”状态。\n\n- 如果NPC处于“攻击”状态，它正在与玩家进行战斗。在任何给定的更新周期中，它有10%的概率失去玩家踪迹并返回“巡逻”状态。否则，它将保持在“攻击”状态。它不能从“攻击”状态转换回“警戒”状态。\n\n该NPC被初始化，并以“巡逻”状态开始其第一个更新周期。在第三个更新周期结束时，该NPC处于“攻击”状态的概率是多少？将你的最终答案四舍五入到四位有效数字。",
            "solution": "将NPC的状态建模为一个时间齐次马尔可夫链，其状态按巡逻（Patrol）、警戒（Alert）、攻击（Attack）的顺序排列为 $[P, A, T]$。一步转移矩阵 $M$ 为\n$$\nM=\\begin{pmatrix}\n0.8 & 0.2 & 0 \\\\\n0.3 & 0.4 & 0.3 \\\\\n0.1 & 0 & 0.9\n\\end{pmatrix}.\n$$\n设行向量 $p_{n}$ 表示第 $n$ 个更新周期结束时的状态分布。状态的演变由马尔可夫性质和矩阵乘法给出：\n$$\np_{n+1}=p_{n}M.\n$$\nNPC从巡逻状态开始，因此在第一个更新周期之前 $p_{0}=(1,0,0)$。在第一个更新周期之后，\n$$\np_{1}=p_{0}M=(1,0,0)M=(0.8,\\,0.2,\\,0).\n$$\n在第二个更新周期之后，\n$$\np_{2}=p_{1}M=(0.8,\\,0.2,\\,0)M,\n$$\n其分量为\n$$\n\\begin{aligned}\np_{2}(P)=0.8\\cdot 0.8+0.2\\cdot 0.3+0\\cdot 0.1=0.64+0.06=0.70,\\\\\np_{2}(A)=0.8\\cdot 0.2+0.2\\cdot 0.4+0\\cdot 0=0.16+0.08=0.24,\\\\\np_{2}(T)=0.8\\cdot 0+0.2\\cdot 0.3+0\\cdot 0.9=0.06.\n\\end{aligned}\n$$\n在第三个更新周期之后，\n$$\np_{3}=p_{2}M,\n$$\n根据关于当前状态的全概率定律，处于攻击状态的概率为，\n$$\np_{3}(T)=p_{2}(P)\\cdot 0+p_{2}(A)\\cdot 0.3+p_{2}(T)\\cdot 0.9=0.24\\cdot 0.3+0.06\\cdot 0.9=0.072+0.054=0.126.\n$$\n四舍五入到四位有效数字，结果为 $0.1260$。",
            "answer": "$$\\boxed{0.1260}$$"
        },
        {
            "introduction": "在理解了系统的短期演变之后，我们自然会问：随着时间的推移，系统最终会达到一种怎样的稳定状态？这个练习将探讨马尔可夫链的长期行为，引入“平稳分布”这一核心概念。你将通过求解一个代数方程组，来确定一个模拟网站用户浏览行为的系统在长时间运行后，用户停留在每个页面的概率。",
            "id": "1639030",
            "problem": "一个小型商业网站上的用户导航简化模型由一个离散时间马尔可夫链描述。该网站由三个不同的页面组成：主页（状态1）、博客页（状态2）和联系页（状态3）。浏览行为由以下转移概率建模：\n\n- 在主页（状态1）的用户将以概率 $p_1$ 导航到博客页（状态2），或以概率 $1-p_1$ 导航到联系页（状态3）。\n- 在博客页（状态2）的用户将以概率 $p_2$ 返回主页（状态1），以概率 $p_3$ 导航到联系页（状态3），或以剩余的概率停留在博客页上。\n- 在联系页（状态3）的用户将总是返回主页（状态1）。\n\n所有参数 $p_1, p_2, p_3$ 都是区间 $(0, 1)$ 内的常数，并且已知 $p_2 + p_3  1$。这组条件确保了马尔可夫链是遍历的，这意味着它有一个唯一的平稳分布。\n\n假设一个用户已经在网站上浏览了很长时间，该过程达到了一个平稳状态。确定平稳分布 $\\pi = (\\pi_1, \\pi_2, \\pi_3)$，其中 $\\pi_i$ 是在页面 $i$ 上找到用户的长期概率。用参数 $p_1$、$p_2$ 和 $p_3$ 将你的答案表示为一个行向量。",
            "solution": "设转移矩阵，其状态按主页（1）、博客（2）、联系（3）的顺序排列，为\n$$\nP=\\begin{pmatrix}\n0  p_{1}  1-p_{1} \\\\\np_{2}  1-p_{2}-p_{3}  p_{3} \\\\\n1  0  0\n\\end{pmatrix}.\n$$\n平稳分布 $\\pi=(\\pi_{1},\\pi_{2},\\pi_{3})$ 满足 $\\pi=\\pi P$ 和 $\\pi_{1}+\\pi_{2}+\\pi_{3}=1$。将平稳性方程按分量写出，得到\n$$\n\\pi_{1}=p_{2}\\pi_{2}+\\pi_{3},\\quad\n\\pi_{2}=p_{1}\\pi_{1}+(1-p_{2}-p_{3})\\pi_{2},\\quad\n\\pi_{3}=(1-p_{1})\\pi_{1}+p_{3}\\pi_{2}.\n$$\n由第二个方程可得，\n$$\n(p_{2}+p_{3})\\pi_{2}=p_{1}\\pi_{1}\\quad\\Rightarrow\\quad \\pi_{2}=\\frac{p_{1}}{p_{2}+p_{3}}\\pi_{1}.\n$$\n将此代入第三个方程，得到\n$$\n\\pi_{3}=(1-p_{1})\\pi_{1}+p_{3}\\cdot\\frac{p_{1}}{p_{2}+p_{3}}\\pi_{1}\n=\\frac{(1-p_{1})(p_{2}+p_{3})+p_1 p_3}{p_{2}+p_{3}}\\pi_{1} = \\frac{p_2+p_3-p_1 p_2}{p_{2}+p_{3}}\\pi_{1}.\n$$\n应用归一化条件：\n$$\n\\pi_{1}+\\pi_{2}+\\pi_{3}\n=\\pi_{1}\\left[1+\\frac{p_{1}}{p_{2}+p_{3}}+\\frac{p_2+p_3-p_1 p_2}{p_{2}+p_{3}}\\right]\n=1.\n$$\n合并方括号中的项，得到\n$$\n\\frac{p_2+p_3+p_1+p_2+p_3-p_1 p_2}{p_{2}+p_{3}} = \\frac{p_1+2p_2+2p_3-p_1 p_2}{p_{2}+p_{3}},\n$$\n所以\n$$\n\\pi_{1}=\\frac{p_{2}+p_{3}}{p_{1}+2p_{2}+2p_{3}-p_{1}p_{2}}.\n$$\n因此，\n$$\n\\pi_{2}=\\frac{p_{1}}{p_{2}+p_{3}}\\pi_{1}=\\frac{p_{1}}{p_{1}+2p_{2}+2p_{3}-p_{1}p_{2}},\\quad\n\\pi_{3}=\\frac{p_2+p_3-p_1 p_2}{p_{2}+p_{3}}\\pi_{1}=\\frac{(1-p_1)p_2+p_3}{p_{1}+2p_{2}+2p_{3}-p_{1}p_{2}}.\n$$\n因此，平稳分布，作为一个行向量，是\n$$\n\\left(\\frac{p_{2}+p_{3}}{p_{1}+2p_{2}+2p_{3}-p_{1}p_{2}},\\ \\frac{p_{1}}{p_{1}+2p_{2}+2p_{3}-p_{1}p_{2}},\\ \\frac{(1-p_{1})p_{2}+p_{3}}{p_{1}+2p_{2}+2p_{3}-p_{1}p_{2}}\\right).\n$$",
            "answer": "$$\\boxed{\\begin{pmatrix}\\frac{p_{2}+p_{3}}{p_{1}+2p_{2}+2p_{3}-p_{1}p_{2}}  \\frac{p_{1}}{p_{1}+2p_{2}+2p_{3}-p_{1}p_{2}}  \\frac{(1-p_{1})p_{2}+p_{3}}{p_{1}+2p_{2}+2p_{3}-p_{1}p_{2}}\\end{pmatrix}}$$"
        },
        {
            "introduction": "最后一个练习将理论与实践相结合，要求你从“纸上谈兵”转向“动手编程”。你将构建一个计算模型来模拟一个动态过程，并分析其在有限和无限时间范围内的行为。更重要的是，你将利用这个模型来评估不同干预措施的有效性，这充分展示了马尔可夫链在辅助决策和系统优化中的强大应用价值。",
            "id": "3158351",
            "problem": "考虑一个离散时间马尔可夫链 (DTMC)，其有限状态空间为 $\\mathcal{S} = \\{\\text{Attentive}, \\text{Distracted}, \\text{Absent}\\}$，分别索引为 $0, 1, 2$。令 $P$ 为状态转移矩阵，其中 $P_{ij}$ 是在一个时间步内从状态 $i$ 转移到状态 $j$ 的概率。令 $\\pi_0$ 为一个表示为行向量的状态初始分布，令 $H$ 为一个表示评估时间步数的正整数时间范围。我们将此过程于时间范围 $H$ 内处于“专注”状态的预期时间步数定义为在每个时间步处于“专注”状态的概率之和。\n\n干预被建模为对 $P$ 的修改，通过将指定行内的概率质量从源列转移到目标列一个非负量 $\\delta$，同时保持行的随机性。这表示为一个四元组 $(r, s, t, \\delta)$，意为：在行 $r$ 中，将 $P_{r s}$ 减小 $\\delta$（如有必要，以可用的 $P_{r s}$ 为上限），并将 $P_{r t}$ 增加相同的 $\\delta$。对于给定的干预，可以顺序应用多个此类转移。所有索引都是从0开始的。修改后，任何微小的数值偏差都应被校正，以使每行总和为1。\n\n对于每个测试用例，您的任务是：\n1. 使用基线矩阵 $P$ 和初始分布 $\\pi_0$ 计算在时间范围 $H$ 内的预期专注时间步数。\n2. 对于一组给定的候选干预，选择能够最大化第1项中预期数量的单个干预。通过选择具有较长期的专注分数（在第3项中定义）的干预来打破平局，如果仍然平局，则选择索引最小的干预。\n3. 计算基线 $P$ 和所选干预的长期专注分数。长期分数是满足 $\\pi_\\infty P = \\pi_\\infty$ 和 $\\sum_i (\\pi_\\infty)_i = 1$ 的平稳分布 $\\pi_\\infty$ 的专注分量。\n\n您必须使用马尔可夫链的基本定义和期望的线性性质来实现这一点。不允许使用启发式捷径。所有答案都必须以实数形式返回，不带百分号；此问题中不出现角度。最终输出必须是包含每个测试用例结果列表的单行，其中每个测试用例结果的格式为 $[$E_{\\text{base}}$, $E_{\\text{best}}$, $\\pi_{\\infty,\\text{att}}^{\\text{base}}$, $\\pi_{\\infty,\\text{att}}^{\\text{best}}$, $\\text{best\\_index}]$。将所有浮点值四舍五入到6位小数。最后一行必须严格为此列表格式，不得有任何附加文本。\n\n使用以下测试套件。对于每个测试用例，状态排序为 $[0=\\text{专注}, 1=\\text{分心}, 2=\\text{缺席}]$。\n\n测试用例 1 (一般课堂动态):\n- $$P = \\begin{bmatrix} 0.6  0.3  0.1 \\\\ 0.4  0.4  0.2 \\\\ 0.2  0.3  0.5 \\end{bmatrix}$$\n- $$\\pi_0 = \\begin{bmatrix} 1.0  0.0  0.0 \\end{bmatrix}$$\n- $H = 10$\n- 候选干预：\n  - 索引 $0$: $(1,1,0,0.1)$\n  - 索引 $1$: $(2,2,0,0.1)$\n  - 索引 $2$: $(0,2,0,0.05)$ 和 $(0,1,0,0.05)$\n\n测试用例 2 (从分心状态开始的近专注稳定性):\n- $$P = \\begin{bmatrix} 0.95  0.05  0.0 \\\\ 0.7  0.3  0.0 \\\\ 0.3  0.2  0.5 \\end{bmatrix}$$\n- $$\\pi_0 = \\begin{bmatrix} 0.0  1.0  0.0 \\end{bmatrix}$$\n- $H = 5$\n- 候选干预：\n  - 索引 $0$: $(1,1,0,0.15)$\n  - 索引 $1$: $(2,2,0,0.2)$\n  - 索引 $2$: $(0,1,0,0.04)$\n\n测试用例 3 (基线中缺席状态为吸收态):\n- $$P = \\begin{bmatrix} 0.5  0.4  0.1 \\\\ 0.3  0.3  0.4 \\\\ 0.0  0.0  1.0 \\end{bmatrix}$$\n- $$\\pi_0 = \\begin{bmatrix} 0.5  0.5  0.0 \\end{bmatrix}$$\n- $H = 8$\n- 候选干预：\n  - 索引 $0$: $(1,2,0,0.2)$\n  - 索引 $1$: $(0,2,0,0.1)$\n  - 索引 $2$: $(2,2,0,0.05)$\n\n测试用例 4 (短时间范围，混合初始状态):\n- $$P = \\begin{bmatrix} 0.7  0.2  0.1 \\\\ 0.2  0.7  0.1 \\\\ 0.1  0.2  0.7 \\end{bmatrix}$$\n- $$\\pi_0 = \\begin{bmatrix} \\frac{1}{3}  \\frac{1}{3}  \\frac{1}{3} \\end{bmatrix}$$\n- $H = 1$\n- 候选干预：\n  - 索引 $0$: $(0,1,0,0.1)$\n  - 索引 $1$: $(1,2,0,0.1)$\n  - 索引 $2$: $(2,2,0,0.2)$\n\n您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，其中每个元素对应一个测试用例，而每个这样的元素本身就是一个逗号分隔的列表 $[E_{\\text{base}}, E_{\\text{best}}, \\pi_{\\infty,\\text{att}}^{\\text{base}}, \\pi_{\\infty,\\text{att}}^{\\text{best}}, \\text{best\\_index}]$，浮点值四舍五入到6位小数。",
            "solution": "用户需要一个关于离散时间马尔可夫链 (DTMC) 问题的解决方案。我将首先验证问题陈述，如果有效，则提供一个合理的解决方案。\n\n### 步骤1：提取已知信息\n- **模型**：一个离散时间马尔可夫链 (DTMC)，其状态空间为 $\\mathcal{S} = \\{\\text{Attentive}, \\text{Distracted}, \\text{Absent}\\}$，索引为 $\\{0, 1, 2\\}$。\n- **参数**：一个状态转移矩阵 $P$，一个初始分布行向量 $\\pi_0$，以及一个正整数时间范围 $H$。\n- **关注指标**：在时间范围 $H$ 内处于专注状态的预期时间步数，定义为在每个时间步处于专注状态的概率之和。\n- **干预**：对 $P$ 的修改，定义为一个四元组 $(r, s, t, \\delta)$，其中概率质量 $\\delta$ 从行 $r$ 的 $P_{rs}$ 转移到 $P_{rt}$。转移量以可用的概率 $P_{rs}$ 为上限。修改后，行被重新归一化以确保总和为1。\n- **任务**：\n  1.  计算基线 $P$ 的预期专注步数 ($E_{\\text{base}}$)。\n  2.  从候选集合中选择最佳干预，该干预最大化此预期值。平局首先按长期专注分数打破，然后按最小干预索引打破。\n  3.  计算基线 ($\\pi_{\\infty,\\text{att}}^{\\text{base}}$) 和最佳干预矩阵 ($\\pi_{\\infty,\\text{att}}^{\\text{best}}$) 的长期专注分数。这是满足 $\\pi_\\infty P = \\pi_\\infty$ 的平稳分布 $\\pi_\\infty$ 的专注状态分量。\n- **输出**：对于每个测试用例，输出一个列表 $[E_{\\text{base}}, E_{\\text{best}}, \\pi_{\\infty,\\text{att}}^{\\text{base}}, \\pi_{\\infty,\\text{att}}^{\\text{best}}, \\text{best\\_index}]$，所有浮点值四舍五入到6位小数。\n- **测试用例**：提供了四个测试用例，包含具体的 $P, \\pi_0, H$ 和候选干预。\n\n### 步骤2：使用提取的已知信息进行验证\n1.  **科学依据（关键）**：该问题植根于 DTMC 的标准理论。转移矩阵、随时间变化的状态分布、期望值和平稳分布等概念是该领域的基础。该问题在科学上是合理的。\n2.  **良构性**：该问题定义明确。目标是定量的、清晰的。预期值的度量标准和选择最佳干预的标准，包括打破平局的规则，都已明确规定，确保可以确定唯一的解决方案。\n3.  **客观性（关键）**：问题陈述使用了精确、形式化的数学语言，没有任何主观性或歧义。\n4.  **完整性与一致性**：为每个测试用例提供了所有需要的数据（$P, \\pi_0, H$ 和干预）。定义与马尔可夫链的标准文献一致。所提供的转移矩阵是有效的随机矩阵（行和为1）。\n\n### 步骤3：结论与行动\n问题是有效的。我将继续设计并实现一个解决方案。\n\n### 解决方案设计\n\n该解决方案将构建为三个核心计算函数，这些函数将应用于每个测试用例。\n\n**1. 预期专注时间步数**\n令 $\\pi_k$ 为时间步 $k$ 的状态分布。它是一个行向量，其中 $(\\pi_k)_j = P(X_k = j)$。分布的演化由 $\\pi_k = \\pi_{k-1} P = \\pi_0 P^k$ 给出。\n问题将时间范围 $H$ 内的预期专注步数定义为在每个时间步处于专注状态（状态0）的概率之和。假设时间步为 $k \\in \\{0, 1, \\dots, H-1\\}$，则：\n$$E_{\\text{att}} = \\sum_{k=0}^{H-1} P(X_k = 0) = \\sum_{k=0}^{H-1} (\\pi_k)_0 = \\sum_{k=0}^{H-1} (\\pi_0 P^k)_0$$\n这可以迭代计算：初始化 $\\pi_{\\text{current}} = \\pi_0$ 和一个运行总和。在一个循环中执行 $H$ 步，将 $(\\pi_{\\text{current}})_0$ 加到总和中，并更新 $\\pi_{\\text{current}} \\leftarrow \\pi_{\\text{current}} P$。\n\n**2. 平稳分布与长期分数**\n平稳分布 $\\pi_\\infty$ 是一个在转移矩阵 $P$ 下保持不变的概率分布，即 $\\pi_\\infty P = \\pi_\\infty$。这可以重写为一个齐次线性方程组：\n$$\\pi_\\infty (P - I) = \\mathbf{0}$$\n其中 $I$ 是单位矩阵，$\\mathbf{0}$ 是零向量。为了获得唯一解，我们添加约束条件，即 $\\pi_\\infty$ 的元素之和必须为1：$\\sum_i (\\pi_\\infty)_i = 1$。\n该系统可以使用标准线性代数求解。对方程进行转置得到 $(P^T - I^T)\\pi_\\infty^T = \\mathbf{0}^T$。我们可以构建一个矩阵 $A = P^T - I$，将其中的一行（例如，最后一行）替换为全为1的行，以强制执行求和约束，并构建一个相应的右侧向量 $\\mathbf{b}$（例如，$[0, 0, \\dots, 1]^T$）。然后可以求解系统 $A \\pi_\\infty^T = \\mathbf{b}$ 得到 $\\pi_\\infty^T$。长期专注分数就是第一个分量，$(\\pi_\\infty)_0$。该方法适用于不可约链和具有瞬态导向吸收态的可约链，正如测试用例中所示。\n\n**3. 干预的应用与选择**\n一次干预由一个或多个转移 $(r, s, t, \\delta)$ 组成。对于每次转移，概率质量在行 $r$ 内移动。移动的质量量 $\\Delta$ 为 $\\min(\\delta, P_{rs})$。矩阵更新为 $P'_{rs} = P_{rs} - \\Delta$ 和 $P'_{rt} = P_{rt} + \\Delta$。在应用了为候选干预规定的所有转移之后，必须重新归一化修改后的行，以确保它们的和为1。\n\n对于每个测试用例，总体流程如下：\n1.  使用基线矩阵 $P$ 计算 $E_{\\text{base}}$ 和 $\\pi_{\\infty,\\text{att}}^{\\text{base}}$。\n2.  对于每个候选干预（索引为 $0, 1, \\dots$）：\n    a. 将指定的转移应用于 $P$ 的一个副本，以创建一个新矩阵 $P_{\\text{new}}$。\n    b. 使用 $P_{\\text{new}}$ 计算 $E_{\\text{new}}$ 和 $\\pi_{\\infty,\\text{att}}^{\\text{new}}$。\n    c. 将这些结果与干预索引一起存储。\n3.  根据指定标准比较所有候选者的结果：\n    a. 主要标准：最大化预期专注步数 $E$。\n    b. 打破平局标准1：最大化长期专注分数 $\\pi_{\\infty,\\text{att}}$。\n    c. 打破平局标准2：选择最小的干预索引。\n4.  这可以通过将候选者的结果按 $E$ 的降序、然后按 $\\pi_{\\infty,\\text{att}}$ 的降序、最后按索引的升序进行排序来高效地完成。排序后的第一个条目即为最佳干预。\n5.  提取最佳干预的统计数据（$E_{\\text{best}}, \\pi_{\\infty,\\text{att}}^{\\text{best}}, \\text{best\\_index}$）。\n6.  组装所需的五个值，并按规定格式化。对所有测试用例重复此过程。",
            "answer": "[[4.492576,4.764506,0.413793,0.476190,0],[2.555000,2.687500,0.933333,0.967742,0],[1.777000,1.831000,0.000000,0.111111,2],[0.333333,0.366667,0.333333,0.428571,0]]"
        }
    ]
}