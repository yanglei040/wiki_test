{
    "hands_on_practices": [
        {
            "introduction": "The core principle of Density Functional Theory is that all ground-state properties of a system can be determined by minimizing an energy functional of the electron density. This exercise brings this abstract principle to life by having you build a simple DFT solver from the ground up for a one-dimensional system. By applying the calculus of variations, you will derive the relationship between the density $n(x)$, the external potential $v_{\\text{ext}}(x)$, and the chemical potential $\\mu$, and then implement an algorithm to find the energy-minimizing density that contains a specific number of electrons $N$ .",
            "id": "2453860",
            "problem": "In the framework of Density Functional Theory (DFT), consider the one-dimensional simplified Thomas–Fermi model in atomic units. Let the electron density be a nonnegative function $n(x) \\ge 0$ on the finite interval $x \\in [-L,L]$. The total energy functional is\n$$\nE[n] \\;=\\; C_F \\int_{-L}^{L} n(x)^{5/3}\\,dx \\;+\\; \\int_{-L}^{L} v_{\\text{ext}}(x)\\,n(x)\\,dx,\n$$\nwhere $C_F = \\frac{3}{10}\\,(3\\pi^2)^{2/3}$ and $v_{\\text{ext}}(x)$ is a given external potential. The density must satisfy the particle-number constraint\n$$\n\\int_{-L}^{L} n(x)\\,dx \\;=\\; N.\n$$\nAll quantities are in atomic units. You must compute the minimizing density $n_{\\star}(x)$ that achieves the minimum of $E[n]$ subject to the constraints, and report the corresponding minimal energy $E_{\\min}$ in Hartree and the associated particle-number Lagrange multiplier (chemical potential) $\\mu$ in Hartree.\n\nWrite a complete program that, for each test case below, returns the pair of floats $(E_{\\min}, \\mu)$, expressed in Hartree and rounded to six decimal places. Your program must produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is itself a two-element list for $(E_{\\min}, \\mu)$, in the same order as the test suite, for example: $[[e_1,\\mu_1],[e_2,\\mu_2],\\dots]$.\n\nThe test suite consists of the following cases, each defined by a domain half-length $L$, a particle number $N$, and a specified external potential $v_{\\text{ext}}(x)$:\n\n- Case $1$: $L = 5$, $N = 2$, $v_{\\text{ext}}(x) = 0$ for all $x \\in [-L,L]$.\n- Case $2$: $L = 10$, $N = 1$, $v_{\\text{ext}}(x) = \\tfrac{1}{2} k x^2$ with $k = 1$.\n- Case $3$: $L = 10$, $N = 1$, $v_{\\text{ext}}(x) = -V_0 \\exp\\!\\big(-x^2/(2\\sigma^2)\\big)$ with $V_0 = 2$ and $\\sigma = 1$.\n- Case $4$: $L = 10$, $N = 1.5$, $v_{\\text{ext}}(x) = \\alpha\\,|x|$ with $\\alpha = 0.2$.\n\nYour program should compute, for each case, the minimizing density $n_{\\star}(x)$ consistent with the constraints, and output the list $[[E_{\\min}^{(1)},\\mu^{(1)}],[E_{\\min}^{(2)},\\mu^{(2)}],[E_{\\min}^{(3)},\\mu^{(3)}],[E_{\\min}^{(4)},\\mu^{(4)}]]$ as a single line. All energies and chemical potentials must be expressed in Hartree, rounded to six decimal places, and printed as decimal numbers without scientific notation and without any unit symbols.",
            "solution": "The problem posed is to find a non-negative function $n_{\\star}(x)$ that minimizes the one-dimensional Thomas-Fermi energy functional\n$$\nE[n] = C_F \\int_{-L}^{L} n(x)^{5/3}\\,dx + \\int_{-L}^{L} v_{\\text{ext}}(x)\\,n(x)\\,dx\n$$\nsubject to the particle number constraint\n$$\n\\int_{-L}^{L} n(x)\\,dx = N.\n$$\nThis is a standard problem in the calculus of variations. To find the minimizing density, we introduce a Lagrange multiplier $\\mu$, which physically represents the chemical potential, to incorporate the constraint. We seek a stationary point of the auxiliary functional $\\Omega[n]$:\n$$\n\\Omega[n] = E[n] - \\mu \\left( \\int_{-L}^{L} n(x)\\,dx - N \\right).\n$$\nThe condition for an extremum is that the functional derivative of $\\Omega[n]$ with respect to $n(x)$ must vanish for all $x$:\n$$\n\\frac{\\delta\\Omega[n]}{\\delta n(x)} = 0.\n$$\nThis yields the Euler-Lagrange equation for this system. The functional derivatives are:\n$$\n\\frac{\\delta}{\\delta n(x)} \\left( C_F \\int_{-L}^{L} n(y)^{5/3}\\,dy \\right) = C_F \\frac{5}{3} n(x)^{2/3},\n$$\n$$\n\\frac{\\delta}{\\delta n(x)} \\left( \\int_{-L}^{L} v_{\\text{ext}}(y)n(y)\\,dy \\right) = v_{\\text{ext}}(x),\n$$\n$$\n\\frac{\\delta}{\\delta n(x)} \\left( \\mu \\int_{-L}^{L} n(y)\\,dy \\right) = \\mu.\n$$\nSubstituting these expressions into the Euler-Lagrange equation gives:\n$$\nC_F \\frac{5}{3} n(x)^{2/3} + v_{\\text{ext}}(x) - \\mu = 0.\n$$\nSolving this algebraic equation for $n(x)$ yields:\n$$\nn(x)^{2/3} = \\frac{\\mu - v_{\\text{ext}}(x)}{(5/3)C_F}.\n$$\nThe problem requires the density to be non-negative, $n(x) \\ge 0$. This implies that the right-hand side of the equation above must also be non-negative. In regions where $\\mu - v_{\\text{ext}}(x)  0$, the only physically sound solution is $n(x)=0$. Therefore, the minimizing density $n_{\\star}(x)$ is given by:\n$$\nn_{\\star}(x) = \\left( \\frac{\\max(0, \\mu - v_{\\text{ext}}(x))}{(5/3)C_F} \\right)^{3/2}.\n$$\nThe constant $(5/3)C_F$ is equal to $\\frac{1}{2}(3\\pi^2)^{2/3}$. Let us denote this constant by $K$. The chemical potential $\\mu$ is not yet known; it is determined by the particle number constraint:\n$$\n\\int_{-L}^{L} n_{\\star}(x;\\mu)\\,dx = N.\n$$\nThis becomes a nonlinear algebraic equation for $\\mu$:\n$$\n\\int_{-L}^{L} \\left( \\frac{\\max(0, \\mu - v_{\\text{ext}}(x))}{K} \\right)^{3/2}\\,dx - N = 0.\n$$\nThis equation must be solved for $\\mu$. Since the integrand is a monotonically increasing function of $\\mu$ for a fixed $x$, the integral is also a monotonically increasing function of $\\mu$. This guarantees that a unique solution for $\\mu$ exists (provided a solution is possible), which can be found reliably using a numerical root-finding algorithm, such as the Brent-q method. A suitable search interval $[\\mu_{\\text{low}}, \\mu_{\\text{high}}]$ is required. A rigorous lower bound is $\\mu_{\\text{low}} = \\min_{x \\in [-L,L]} v_{\\text{ext}}(x)$, since for any $\\mu$ below this value the density would be identically zero.\n\nOnce $\\mu$ is determined, the minimum energy $E_{\\min} = E[n_{\\star}]$ can be computed. We can derive a more convenient expression for $E_{\\min}$. We substitute the relation for $n_{\\star}(x)$ back into the energy functional. In regions where $n_{\\star}(x)>0$, we have $C_F n_{\\star}(x)^{2/3} = \\frac{3}{5}(\\mu - v_{\\text{ext}}(x))$, which means $C_F n_{\\star}(x)^{5/3} = \\frac{3}{5}(\\mu-v_{\\text{ext}}(x))n_{\\star}(x)$.\nSubstituting this into the energy expression gives:\n$$\nE_{\\min} = \\int_{-L}^{L} \\left( \\frac{3}{5}(\\mu-v_{\\text{ext}}(x))n_{\\star}(x) + v_{\\text{ext}}(x)n_{\\star}(x) \\right) \\,dx,\n$$\nwhich simplifies to\n$$\nE_{\\min} = \\int_{-L}^{L} \\left( \\frac{3}{5}\\mu\\,n_{\\star}(x) + \\frac{2}{5}v_{\\text{ext}}(x)n_{\\star}(x) \\right) \\,dx.\n$$\nUsing the particle number constraint $\\int_{-L}^{L} n_{\\star}(x)dx = N$, we arrive at the final expression for the energy:\n$$\nE_{\\min} = \\frac{3}{5}\\mu N + \\frac{2}{5} \\int_{-L}^{L} v_{\\text{ext}}(x)n_{\\star}(x;\\mu)\\,dx.\n$$\nThe computational algorithm for each test case is as follows:\n$1$. For the given parameters $L$, $N$, and potential $v_{\\text{ext}}(x)$, define a function $f(\\mu) = \\int_{-L}^{L} n_{\\star}(x;\\mu)\\,dx - N$.\n$2$. Numerically solve the nonlinear equation $f(\\mu)=0$ for $\\mu$ using a root-finder over a determined bracket $[\\mu_{\\text{low}}, \\mu_{\\text{high}}]$. The integral within $f(\\mu)$ is evaluated using numerical quadrature.\n$3$. With the determined value of $\\mu$, compute the integral $I_v = \\int_{-L}^{L} v_{\\text{ext}}(x)n_{\\star}(x;\\mu)\\,dx$, again using numerical quadrature.\n$4$. Calculate the minimal energy $E_{\\min}$ using the derived formula $E_{\\min} = \\frac{3}{5}\\mu N + \\frac{2}{5}I_v$.\n$5$. Report the pair $(E_{\\min}, \\mu)$, with both values rounded to six decimal places.\n\nThis procedure is implemented in the following program for each of the four specified test cases.",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import quad\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Solves the 1D Thomas-Fermi problem for a given set of test cases.\n    \"\"\"\n\n    # Define physical constants in atomic units\n    C_F = (3.0/10.0) * (3.0 * np.pi**2)**(2.0/3.0)\n    K_CONST = (5.0/3.0) * C_F\n\n    def solve_case(L, N, v_ext_func):\n        \"\"\"\n        Solves for the chemical potential (mu) and minimum energy (E_min) for a single case.\n        \n        Args:\n            L (float): Half-length of the domain [-L, L].\n            N (float): Total number of particles.\n            v_ext_func (callable): The external potential v_ext(x).\n\n        Returns:\n            tuple: A tuple containing (E_min, mu) rounded to 6 decimal places.\n        \"\"\"\n\n        # Integrand for calculating the particle number N given a mu\n        def rho_integrand(x, mu):\n            val = mu - v_ext_func(x)\n            if val = 0:\n                return 0.0\n            return (val / K_CONST)**1.5\n\n        # Equation to solve for mu: integral(rho(x, mu)) dx - N = 0\n        def particle_number_eq(mu):\n            integral_val, _ = quad(rho_integrand, -L, L, args=(mu,), limit=100)\n            return integral_val - N\n\n        # Find a suitable bracket [mu_low, mu_high] for the root-finder\n        # mu_low is the minimum of the potential in the domain\n        x_grid = np.linspace(-L, L, 2001)\n        v_min = np.min(v_ext_func(x_grid))\n        mu_low = v_min\n        \n        # Iteratively find mu_high such that particle_number_eq(mu_high)  0\n        # Start with a reasonable guess and expand if necessary\n        mu_high = mu_low + 1.0\n        \n        # Handle cases where v_min itself is large or negative\n        if mu_high = mu_low :\n             mu_high = mu_low + abs(mu_low) + 1.0\n\n        iter_count = 0\n        max_iters = 30\n        while particle_number_eq(mu_high)  0 and iter_count  max_iters:\n            mu_high += abs(mu_high) + 1.0  # Adaptive step\n            iter_count += 1\n        \n        if iter_count == max_iters:\n            raise RuntimeError(\"Failed to find a valid bracket for mu.\")\n\n        # Solve for mu using Brent's method\n        mu_sol = brentq(particle_number_eq, mu_low, mu_high)\n\n        # Now, calculate the energy E_min\n        # E_min = (3/5)*mu*N + (2/5) * integral(v_ext(x) * rho(x)) dx\n        def energy_pot_integrand(x, mu):\n            rho = rho_integrand(x, mu)\n            return v_ext_func(x) * rho\n\n        V_ext_integral, _ = quad(energy_pot_integrand, -L, L, args=(mu_sol,), limit=100)\n        \n        E_min = (3.0/5.0) * mu_sol * N + (2.0/5.0) * V_ext_integral\n\n        return round(E_min, 6), round(mu_sol, 6)\n\n    # Test suite from the problem statement\n    test_cases = [\n        {'L': 5.0, 'N': 2.0, 'v_ext': lambda x: 0.0 * x}, # v_ext = 0\n        {'L': 10.0, 'N': 1.0, 'v_ext': lambda x: 0.5 * x**2},\n        {'L': 10.0, 'N': 1.0, 'v_ext': lambda x: -2.0 * np.exp(-x**2 / 2.0)},\n        {'L': 10.0, 'N': 1.5, 'v_ext': lambda x: 0.2 * np.abs(x)},\n    ]\n\n    results = []\n    for case in test_cases:\n        E_min, mu = solve_case(case['L'], case['N'], case['v_ext'])\n        results.append([E_min, mu])\n\n    # Format the output as specified\n    output_str = \"[\" + \",\".join([f\"[{e},{m}]\" for e, m in results]) + \"]\"\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "While exact in principle, DFT in practice relies on approximate exchange-correlation functionals, which inevitably have errors. One of the most significant and well-known deficiencies is the self-interaction error (SIE), where an electron incorrectly interacts with its own density. This hands-on coding exercise provides a direct way to visualize and quantify this abstract error by calculating it for the hydrogen atom, the simplest one-electron system, using the common Local Spin-Density Approximation (LSDA) .",
            "id": "2453879",
            "problem": "You are to write a complete program that quantifies the self-interaction error for a single hydrogen atom when using the Local Spin-Density Approximation (LSDA) exchange functional. Work entirely in Hartree atomic units. The self-interaction error for a one-electron system is defined as the sum of the classical Hartree (electrostatic) energy and the exchange energy. For a one-electron density, the exact Kohn–Sham exchange would cancel the Hartree energy exactly, so any residual value of this sum is the self-interaction error of the approximate exchange functional.\n\nConsider the normalized ground-state electron density of the hydrogen atom,\n$$\nn(\\mathbf{r}) = \\frac{1}{\\pi} e^{-2 r},\n$$\nwhere $r = \\lvert \\mathbf{r} \\rvert$ and $n(\\mathbf{r})$ integrates to $1$ electron.\n\nUse the following first-principles definitions:\n\n- The Hartree energy,\n$$\nE_{\\mathrm{H}}[n] = \\frac{1}{2} \\int \\int \\frac{n(\\mathbf{r})\\,n(\\mathbf{r}^{\\prime})}{\\lvert \\mathbf{r} - \\mathbf{r}^{\\prime} \\rvert} \\, d^3 r \\, d^3 r^{\\prime}.\n$$\n\n- The Local Spin-Density Approximation (LSDA) exchange energy for spin densities $n_{\\uparrow}(\\mathbf{r})$ and $n_{\\downarrow}(\\mathbf{r})$,\n$$\nE_{x}^{\\mathrm{LSDA}}[n_{\\uparrow}, n_{\\downarrow}] = - C_{x} \\int \\left[n_{\\uparrow}(\\mathbf{r})^{4/3} + n_{\\downarrow}(\\mathbf{r})^{4/3}\\right] \\, d^3 r,\n$$\nwith\n$$\nC_{x} = \\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}.\n$$\n\nDefine the self-interaction error as\n$$\n\\mathrm{SIE} = E_{\\mathrm{H}}[n] + E_{x}^{\\mathrm{LSDA}}[n_{\\uparrow}, n_{\\downarrow}].\n$$\n\nFor a single electron, consider the following two spin configurations:\n- Fully spin-polarized (physical for a single electron): $n_{\\uparrow}(\\mathbf{r}) = n(\\mathbf{r})$, $n_{\\downarrow}(\\mathbf{r}) = 0$.\n- Artificially spin-unpolarized (for sensitivity analysis): $n_{\\uparrow}(\\mathbf{r}) = n_{\\downarrow}(\\mathbf{r}) = \\tfrac{1}{2} n(\\mathbf{r})$.\n\nNumerically evaluate the required integrals in three test cases using a radial grid of $N_r$ points extending from $r=0$ to a finite cutoff $R_{\\max}$, both specified per test. All energies must be expressed in Hartree and reported as floating-point numbers rounded to six decimal places.\n\nTest suite (each case as a triple $(N_r, R_{\\max}, \\text{spin})$ where the spin is either the string \"polarized\" or \"unpolarized\"):\n1. $(8000, 20.0, \\text{\"polarized\"})$\n2. $(1000, 12.0, \\text{\"polarized\"})$\n3. $(2000, 8.0, \\text{\"unpolarized\"})$\n\nYour program should compute the self-interaction error $\\mathrm{SIE}$ for each test case and produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the same order as the test suite, e.g.,\n$$\n[\\mathrm{SIE}_1,\\mathrm{SIE}_2,\\mathrm{SIE}_3].\n$$\nAll three numbers must be in Hartree and rounded to six decimal places (do not include any unit symbols in the output).",
            "solution": "The problem requires the calculation of the self-interaction error (SIE) for a single hydrogen atom using the Local Spin-Density Approximation (LSDA) exchange functional. The system is defined in Hartree atomic units. The analysis will be performed for two spin configurations: fully spin-polarized and artificially spin-unpolarized.\n\nFirst, we validate the problem statement.\n**Givens:**\n- Electron density of the hydrogen atom ground state: $n(\\mathbf{r}) = \\frac{1}{\\pi} e^{-2 r}$, where $r = |\\mathbf{r}|$.\n- Self-Interaction Error definition: $\\mathrm{SIE} = E_{\\mathrm{H}}[n] + E_{x}^{\\mathrm{LSDA}}[n_{\\uparrow}, n_{\\downarrow}]$.\n- Hartree energy: $E_{\\mathrm{H}}[n] = \\frac{1}{2} \\int \\int \\frac{n(\\mathbf{r})\\,n(\\mathbf{r}^{\\prime})}{\\lvert \\mathbf{r} - \\mathbf{r}^{\\prime} \\rvert} \\, d^3 r \\, d^3 r^{\\prime}$.\n- LSDA exchange energy: $E_{x}^{\\mathrm{LSDA}}[n_{\\uparrow}, n_{\\downarrow}] = - C_{x} \\int \\left[n_{\\uparrow}(\\mathbf{r})^{4/3} + n_{\\downarrow}(\\mathbf{r})^{4/3}\\right] \\, d^3 r$, with a constant $C_{x} = \\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}$.\n- Spin configurations:\n    1. Spin-polarized: $n_{\\uparrow}(\\mathbf{r}) = n(\\mathbf{r})$, $n_{\\downarrow}(\\mathbf{r}) = 0$.\n    2. Spin-unpolarized: $n_{\\uparrow}(\\mathbf{r}) = n_{\\downarrow}(\\mathbf{r}) = \\tfrac{1}{2} n(\\mathbf{r})$.\n- Numerical parameters for three test cases: $(N_r, R_{\\max}, \\text{spin})$.\n\n**Validation:**\nThe problem is scientifically grounded, concerning a standard calculation in density functional theory. The provided formulae for the electron density, Hartree energy, and LSDA exchange energy are standard. The concept of self-interaction error as the sum of Hartree and approximate exchange energies for a one-electron system is a cornerstone of DFT functional analysis. The problem is well-posed, providing all necessary information for a numerical solution. The parameters for numerical integration are reasonable. The problem is therefore deemed **valid**.\n\nWe now proceed to the solution. The calculation requires evaluating two energy components: the Hartree energy $E_{\\mathrm{H}}[n]$ and the LSDA exchange energy $E_{x}^{\\mathrm{LSDA}}$. All integrations will be performed numerically on a radial grid as specified.\n\n**1. Hartree Energy, $E_{\\mathrm{H}}[n]$**\n\nThe Hartree energy represents the classical electrostatic self-repulsion of the electron density cloud. For a spherically symmetric density $n(r)$, the expression can be simplified. A direct application of classical electrostatics for the energy of a charge distribution, built up shell by shell, gives the total electrostatic energy as:\n$$\nE_{\\mathrm{H}} = \\int_0^\\infty \\frac{Q(r)}{r} \\, dq(r)\n$$\nwhere $dq(r) = n(r) 4\\pi r^2 dr$ is the electronic charge in a spherical shell of radius $r$ and thickness $dr$, and $Q(r) = \\int_0^r dq(r')$ is the total charge enclosed within a sphere of radius $r$. This formula correctly counts each pair interaction once and avoids the factor of $\\frac{1}{2}$ present in other formulations that lead to double counting.\n\nFor the given density $n(r) = \\frac{1}{\\pi}e^{-2r}$, the enclosed charge $Q(r)$ is:\n$$\nQ(r) = \\int_0^r 4\\pi (r')^2 \\left(\\frac{1}{\\pi} e^{-2r'}\\right) dr' = 4 \\int_0^r (r')^2 e^{-2r'} dr' = 1 - (2r^2 + 2r + 1)e^{-2r}\n$$\nThe Hartree energy is then the integral:\n$$\nE_{\\mathrm{H}}[n] = \\int_0^\\infty \\left[ \\frac{1 - (2r^2 + 2r + 1)e^{-2r}}{r} \\right] (4r^2 e^{-2r}) dr\n$$\n$$\nE_{\\mathrm{H}}[n] = \\int_0^\\infty \\left[ 4r e^{-2r} - 4r(2r^2 + 2r + 1) e^{-4r} \\right] dr\n$$\nEvaluation of this standard integral yields the exact analytical result:\n$$\nE_{\\mathrm{H}}[n] = 1 - \\left(\\frac{3}{16} + \\frac{4}{16} + \\frac{4}{16}\\right) = 1 - \\frac{11}{16} = \\frac{5}{16} \\text{ Hartree}.\n$$\nThis exact value of $E_{\\mathrm{H}}[n] = 0.3125$ Hartree serves as a reference for our numerical implementation. Discrepancies in some literature are often due to inconsistent definitions. Our derivation is from first principles.\n\nFor the numerical calculation, we first compute $Q(r)$ on the radial grid using a cumulative trapezoidal rule. Then, we compute $E_{\\mathrm{H}}$ by applying the trapezoidal rule to the integrand $4\\pi r n(r) Q(r)$.\n\n**2. LSDA Exchange Energy, $E_{x}^{\\mathrm{LSDA}}$**\n\nThe LSDA exchange energy integral must be evaluated for the two specified spin configurations. Since the density is spherically symmetric, the volume integral reduces to a radial integral:\n$$\nE_{x}^{\\mathrm{LSDA}} = -C_x \\int_0^\\infty \\left[ n_{\\uparrow}(r)^{4/3} + n_{\\downarrow}(r)^{4/3} \\right] 4\\pi r^2 dr\n$$\nThe constant is $C_x = \\frac{3}{4}\\left(\\frac{3}{\\pi}\\right)^{1/3}$.\n\nCase 1: Fully spin-polarized\nHere, $n_{\\uparrow}(r) = n(r)$ and $n_{\\downarrow}(r) = 0$. The expression simplifies to:\n$$\nE_{x}^{\\mathrm{LSDA, pol}} = -C_x \\int_0^\\infty n(r)^{4/3} 4\\pi r^2 dr\n$$\nThe term to integrate numerically is $-C_x \\left(\\frac{1}{\\pi} e^{-2r}\\right)^{4/3} 4\\pi r^2$.\n\nCase 2: Artificially spin-unpolarized\nHere, $n_{\\uparrow}(r) = n_{\\downarrow}(r) = \\frac{1}{2}n(r)$. The sum of the density terms is:\n$$\nn_{\\uparrow}^{4/3} + n_{\\downarrow}^{4/3} = 2 \\left( \\frac{n(r)}{2} \\right)^{4/3} = 2^{1 - 4/3} n(r)^{4/3} = 2^{-1/3} n(r)^{4/3}\n$$\nThe exchange energy is then:\n$$\nE_{x}^{\\mathrm{LSDA, unpol}} = -C_x \\cdot 2^{-1/3} \\int_0^\\infty n(r)^{4/3} 4\\pi r^2 dr\n$$\nThis is simply the polarized exchange energy multiplied by a factor of $2^{-1/3}$. The same numerical integral of $n(r)^{4/3}$ can be reused.\n\n**3. Total Self-Interaction Error, SIE**\n\nFor each test case, the SIE is the sum of the numerically computed energies:\n$$\n\\mathrm{SIE} = E_{\\mathrm{H}}[n] + E_{x}^{\\mathrm{LSDA}}[n]\n$$\nThe program will implement these steps for each tuple $(N_r, R_{\\max}, \\text{spin})$ in the test suite and report the results. The numerical integration is performed using the trapezoidal rule, which is provided by the `numpy` and `scipy` libraries. For a sufficiently large number of grid points $N_r$, this method provides accurate results.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import cumulative_trapezoid\n\ndef solve():\n    \"\"\"\n    Computes the self-interaction error (SIE) for a Hydrogen atom\n    using the Local Spin-Density Approximation (LSDA) exchange functional.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N_r, R_max, spin_case)\n        (8000, 20.0, \"polarized\"),\n        (1000, 12.0, \"polarized\"),\n        (2000, 8.0, \"unpolarized\"),\n    ]\n\n    results = []\n    \n    # Constant C_x for LSDA exchange in Hartree atomic units\n    C_x = (3.0 / 4.0) * (3.0 / np.pi)**(1.0 / 3.0)\n\n    for Nr, R_max, spin_case in test_cases:\n        # 1. Set up the radial grid\n        # We use a linear grid. r=0 is handled carefully.\n        r = np.linspace(0, R_max, Nr)\n        \n        # 2. Define the electron density n(r) for Hydrogen atom\n        # n(r) = (1/pi) * exp(-2r)\n        n_r = (1.0 / np.pi) * np.exp(-2.0 * r)\n        \n        # 3. Calculate the Hartree Energy E_H[n]\n        # E_H = integral [Q(r)/r] dq(r) over all space\n        # where Q(r) is enclosed charge and dq(r) is charge in a shell.\n        # This is equivalent to E_H = integral_0^inf [4*pi*r*n(r)*Q(r)] dr\n        \n        # First, compute Q(r) = integral_0^r 4*pi*r'^2*n(r') dr'\n        # Integrand for Q(r)\n        q_integrand = 4.0 * np.pi * r**2 * n_r\n        \n        # Use cumulative trapezoid rule for accurate Q(r)\n        # cumulative_trapezoid returns a result for r[1:], so we prepend 0\n        Q_r = cumulative_trapezoid(q_integrand, r, initial=0.0)\n\n        # Now, compute the integrand for Hartree energy\n        eh_integrand = 4.0 * np.pi * r * n_r * Q_r\n        \n        # Integrate using the trapezoidal rule\n        E_H = np.trapz(eh_integrand, r)\n        \n        # 4. Calculate the LSDA Exchange Energy E_x^LSDA[n]\n        # E_x = -C_x * integral [n_up^(4/3) + n_down^(4/3)] d^3r\n        \n        # Common part of the integral: integral_0^inf n(r)^(4/3) * 4*pi*r^2 dr\n        n_43 = n_r**(4.0 / 3.0)\n        ex_integrand_base = n_43 * 4.0 * np.pi * r**2\n        integral_val = np.trapz(ex_integrand_base, r)\n        \n        if spin_case == \"polarized\":\n            # n_up = n, n_down = 0\n            # Sum of densities term is n^(4/3)\n            spin_factor = 1.0\n        elif spin_case == \"unpolarized\":\n            # n_up = n/2, n_down = n/2\n            # Sum becomes 2 * (n/2)^(4/3) = 2^(-1/3) * n^(4/3)\n            spin_factor = 2.0**(-1.0 / 3.0)\n        \n        E_x = -C_x * spin_factor * integral_val\n        \n        # 5. Calculate the Self-Interaction Error\n        SIE = E_H + E_x\n        \n        results.append(SIE)\n\n    # Format the final output as specified\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "When a DFT calculation gives an inaccurate result, is it because the functional's mathematical form is inherently wrong, or because the flawed functional produced a poor-quality electron density? This advanced analysis problem teaches you to distinguish between these two sources of error: the *functional-driven error* and the *density-driven error*. By carefully interpreting a set of hypothetical but realistic computational results for a challenging system (stretched H$_2$), you will learn to dissect the total error and gain a much deeper understanding of a functional's performance .",
            "id": "2453913",
            "problem": "You will analyze sources of error in Density Functional Theory (DFT) calculations by distinguishing density-driven error from functional-driven error. Use the following fundamental bases: (i) the Hohenberg–Kohn theorems state that the ground-state energy is a functional of the ground-state electron density, and the exact energy is obtained by minimizing this energy functional with respect to the density; (ii) in the Kohn–Sham (KS) framework, an approximate exchange–correlation functional yields an approximate energy functional whose self-consistent minimizer is an approximate density; (iii) a finite one-electron basis set induces a discretization of the allowed densities and orbitals, leading to basis-set incompleteness error. Consider the Born–Oppenheimer ground state of H$_2$ at a stretched bond length of $R=3.0\\,\\mathrm{\\AA}$.\n\nYou have the following set of calculations. All energies are in Hartree units, $E_{\\mathrm{h}}$, and all calculations are spin-unrestricted when applicable. The notations $E_{\\mathrm{meth}}[n_{\\bullet}]$ indicate the total energy from method “meth” evaluated on the density $n_{\\bullet}$.\n\n- A near-exact reference in a very large basis (e.g., Full Configuration Interaction in a complete-basis limit): $E_{\\mathrm{ref}}=-1.000\\,E_{\\mathrm{h}}$.\n- Semi-local Generalized Gradient Approximation (GGA), specifically Perdew–Burke–Ernzerhof (PBE), self-consistent in a very large basis: $E_{\\mathrm{PBE}}[n_{\\mathrm{PBE}}]=-1.030\\,E_{\\mathrm{h}}$.\n- PBE evaluated non-self-consistently on an Unrestricted Hartree–Fock (UHF) density obtained in the same very large basis: $E_{\\mathrm{PBE}}[n_{\\mathrm{UHF}}]=-1.008\\,E_{\\mathrm{h}}$.\n- A global hybrid functional (e.g., PBE0) self-consistent in a minimal basis set: $E_{\\mathrm{hyb}}[n_{\\mathrm{hyb}}]_{\\mathrm{min}}=-0.990\\,E_{\\mathrm{h}}$.\n- The same hybrid functional evaluated on the UHF density, but both the UHF calculation and the hybrid energy evaluation are confined to the same minimal basis: $E_{\\mathrm{hyb}}[n_{\\mathrm{UHF}}]_{\\mathrm{min}}=-0.991\\,E_{\\mathrm{h}}$.\n\nConceptual reminders for interpretation:\n- Functional-driven error refers to the error that would remain even if the approximate functional were evaluated on the exact density (i.e., it originates in the functional form itself).\n- Density-driven error refers to the additional error arising because the approximate self-consistent density deviates from the exact density due to the approximate potential; it can be diagnosed in practice by how much the approximate energy changes when evaluated on a higher-fidelity density.\n- Basis-set incompleteness can limit the quality of both the density and the energy, potentially masking or mimicking other error sources.\n\nQuestion: Based on the data and principles above, which statements are correct?\n\nA. The large change from $E_{\\mathrm{PBE}}[n_{\\mathrm{PBE}}]$ to $E_{\\mathrm{PBE}}[n_{\\mathrm{UHF}}]$ in the large basis indicates that, for stretched H$_2$ with a semi-local functional, density-driven error is a major component of the total error.\n\nB. The near equality of $E_{\\mathrm{hyb}}[n_{\\mathrm{hyb}}]_{\\mathrm{min}}$ and $E_{\\mathrm{hyb}}[n_{\\mathrm{UHF}}]_{\\mathrm{min}}$ indicates that, in the minimal basis, basis-set incompleteness dominates over density-driven error for the hybrid functional.\n\nC. The residual gap between $E_{\\mathrm{PBE}}[n_{\\mathrm{UHF}}]$ and $E_{\\mathrm{ref}}$ in the large basis is attributable to functional-driven error (e.g., missing static correlation in the semi-local form).\n\nD. Because the approximate energy functional is minimized at its own self-consistent density, the Hohenberg–Kohn variational principle ensures that replacing $n_{\\mathrm{approx}}$ by a better density such as $n_{\\mathrm{UHF}}$ cannot reduce the total error relative to $E_{\\mathrm{ref}}$.\n\nE. In a minimal basis, density errors must dominate the energy error because the basis limits the variational space for $n(\\mathbf{r})$, so replacing $n_{\\mathrm{hyb}}$ by $n_{\\mathrm{UHF}}$ necessarily produces a large energy improvement.",
            "solution": "The problem statement will first be validated for scientific and logical soundness.\n\n**Step 1: Extract Givens**\n\nThe problem provides the following data and conceptual definitions for the ground state of H$_2$ at a bond length of $R=3.0\\,\\mathrm{\\AA}$:\n\n- **Principles:**\n    1.  Hohenberg-Kohn (HK) theorems: The ground-state energy $E$ is a functional of the ground-state electron density $n(\\mathbf{r})$, $E=E[n]$, and is minimized by the exact ground-state density.\n    2.  Kohn-Sham (KS) DFT: An approximate exchange-correlation functional $E_{xc}^{\\mathrm{approx}}[n]$ leads to an approximate total energy functional $E^{\\mathrm{approx}}[n]$ whose self-consistent minimizer is an approximate density $n_{\\mathrm{approx}}$.\n    3.  Basis-set incompleteness error: A finite one-electron basis set discretizes the space of allowed densities and orbitals.\n\n- **Energy Values (in Hartree, $E_{\\mathrm{h}}$):**\n    -   Near-exact reference energy in a very large basis: $E_{\\mathrm{ref}} = -1.000\\,E_{\\mathrm{h}}$.\n    -   PBE self-consistent energy in a very large basis: $E_{\\mathrm{PBE}}[n_{\\mathrm{PBE}}] = -1.030\\,E_{\\mathrm{h}}$.\n    -   PBE energy on a UHF density in the same very large basis: $E_{\\mathrm{PBE}}[n_{\\mathrm{UHF}}] = -1.008\\,E_{\\mathrm{h}}$.\n    -   Global hybrid self-consistent energy in a minimal basis: $E_{\\mathrm{hyb}}[n_{\\mathrm{hyb}}]_{\\mathrm{min}} = -0.990\\,E_{\\mathrm{h}}$.\n    -   Global hybrid energy on a UHF density in the same minimal basis: $E_{\\mathrm{hyb}}[n_{\\mathrm{UHF}}]_{\\mathrm{min}} = -0.991\\,E_{\\mathrm{h}}$.\n\n- **Error Definitions:**\n    -   **Functional-driven error:** Error remaining when an approximate functional is evaluated on the exact density.\n    -   **Density-driven error:** Additional error from the deviation of the approximate self-consistent density from the exact density.\n    -   **Basis-set incompleteness error:** Error from using a finite basis set.\n\n**Step 2: Validate Using Extracted Givens**\n\nThe problem is evaluated against the validation criteria.\n\n-   **Scientifically Grounded:** The problem is firmly rooted in the principles of density functional theory and quantum chemistry. The scenario of stretched H$_2$ is a canonical example used to illustrate the failure of semi-local functionals due to static correlation, a well-established concept. The definitions of functional-driven and density-driven errors are standard in modern DFT literature.\n-   **Well-Posed:** The problem provides a clear set of numerical data and definitions, and asks for an evaluation of several statements based on this information. The question is structured to have a definite set of correct and incorrect answers derivable from the provided data.\n-   **Objective:** The language is technical, precise, and free of subjectivity.\n-   **Self-Contained and Consistent:** All necessary data and definitions are provided. There are no internal contradictions. For example, the non-self-consistent energies ($E_{\\mathrm{PBE}}[n_{\\mathrm{UHF}}]$ and $E_{\\mathrm{hyb}}[n_{\\mathrm{UHF}}]_{\\mathrm{min}}$) are variationally higher (less negative) than their self-consistent counterparts ($E_{\\mathrm{PBE}}[n_{\\mathrm{PBE}}]$ and $E_{\\mathrm{hyb}}[n_{\\mathrm{hyb}}]_{\\mathrm{min}}$), which is consistent with the variational principle applied to an approximate functional. This is not strictly required in all cases, but its presence adds to the consistency. Note I check $E_{\\mathrm{hyb}}[n_{\\mathrm{UHF}}]_{\\mathrm{min}} = -0.991 E_{\\mathrm{h}}$ which is lower than $E_{\\mathrm{hyb}}[n_{\\mathrm{hyb}}]_{\\mathrm{min}} = -0.990 E_{\\mathrm{h}}$. This indicates an issue. Let's re-read. $E_{\\mathrm{hyb}}[n_{\\mathrm{hyb}}]_{\\mathrm{min}}=-0.990$, and $E_{\\mathrm{hyb}}[n_{\\mathrm{UHF}}]_{\\mathrm{min}}=-0.991$. This means $E_{\\mathrm{hyb}}[n_{\\mathrm{UHF}}]_{\\mathrm{min}}  E_{\\mathrm{hyb}}[n_{\\mathrm{hyb}}]_{\\mathrm{min}}$. This is a violation of the variational principle for the approximate functional $E_{\\mathrm{hyb}}$. This is a potential contradiction. However, in practice, numerical noise or convergence to a non-minimal saddle point can lead to such small apparent violations. But more likely, it is a typo in the problem statement, or the UHF density used was not obtained from the same basis as the hybrid calculation. Let me check the wording: \"both the UHF calculation and the hybrid energy evaluation are confined to the same minimal basis\". This confirms they are from the same basis. This very small violation ($0.001\\,E_{\\mathrm{h}}$) is on the edge of what might be considered a numerical artifact. However, a strict interpretation flags this as an inconsistency. Is it fatal to the logic of the problem? The core argument in the options related to this point relies on the *small magnitude* of the difference, not its sign. The difference is $|-0.990 - (-0.991)| = 0.001\\,E_{\\mathrm{h}}$, which is small regardless of sign. The logic of the options can still be assessed. Given that this is a conceptual problem and the magnitude is small, I will proceed, but note this slight inconsistency. It does not invalidate the entire problem structure.\n\n**Step 3: Verdict and Action**\n\nThe problem is deemed **valid** for analysis. The minor inconsistency in the provided data concerning the variational principle for the hybrid functional is noted, but it is not significant enough to prevent a logical evaluation of the options, which primarily depend on the magnitudes of the energy differences.\n\n**Solution Derivation**\n\nThe total error of an approximate DFT calculation, $\\Delta E_{\\mathrm{tot}}$, can be decomposed into a functional-driven error, $\\Delta E_F$, and a density-driven error, $\\Delta E_D$.\n$\\Delta E_{\\mathrm{tot}} = E_{\\mathrm{approx}}[n_{\\mathrm{approx}}] - E_{\\mathrm{exact}}[n_{\\mathrm{exact}}]$.\nThe decomposition is:\n$$ \\Delta E_{\\mathrm{tot}} = \\underbrace{\\left( E_{\\mathrm{approx}}[n_{\\mathrm{approx}}] - E_{\\mathrm{approx}}[n_{\\mathrm{exact}}] \\right)}_{\\Delta E_D} + \\underbrace{\\left( E_{\\mathrm{approx}}[n_{\\mathrm{exact}}] - E_{\\mathrm{exact}}[n_{\\mathrm{exact}}] \\right)}_{\\Delta E_F} $$\nIn practice, $n_{\\mathrm{exact}}$ is unknown. We use a high-quality reference density, here approximated by $n_{\\mathrm{UHF}}$ from a large basis, to estimate these components. Thus:\n$$ \\Delta E_D \\approx E_{\\mathrm{approx}}[n_{\\mathrm{approx}}] - E_{\\mathrm{approx}}[n_{\\mathrm{UHF}}] $$\n$$ \\Delta E_F \\approx E_{\\mathrm{approx}}[n_{\\mathrm{UHF}}] - E_{\\mathrm{ref}} $$\n\n**Analysis of PBE in a large basis:**\n- Total error: $\\Delta E_{\\mathrm{tot, PBE}} = E_{\\mathrm{PBE}}[n_{\\mathrm{PBE}}] - E_{\\mathrm{ref}} = -1.030 - (-1.000) = -0.030\\,E_{\\mathrm{h}}$.\n- Approximate density-driven error: $\\Delta E_{D, \\mathrm{PBE}} \\approx E_{\\mathrm{PBE}}[n_{\\mathrm{PBE}}] - E_{\\mathrm{PBE}}[n_{\\mathrm{UHF}}] = -1.030 - (-1.008) = -0.022\\,E_{\\mathrm{h}}$.\n- Approximate functional-driven error: $\\Delta E_{F, \\mathrm{PBE}} \\approx E_{\\mathrm{PBE}}[n_{\\mathrm{UHF}}] - E_{\\mathrm{ref}} = -1.008 - (-1.000) = -0.008\\,E_{\\mathrm{h}}$.\n\nThe sum of these approximate components is $(-0.022) + (-0.008) = -0.030\\,E_{\\mathrm{h}}$, which matches the total error. The magnitude of the density-driven error, $|-0.022| = 0.022\\,E_{\\mathrm{h}}$, is substantial compared to the magnitude of the total error, $|-0.030| = 0.030\\,E_{\\mathrm{h}}$.\n\n**Analysis of the hybrid functional in a minimal basis:**\n- Approximate density-driven error within the minimal basis: $\\Delta E_{D, \\mathrm{hyb}} \\approx E_{\\mathrm{hyb}}[n_{\\mathrm{hyb}}]_{\\mathrm{min}} - E_{\\mathrm{hyb}}[n_{\\mathrm{UHF}}]_{\\mathrm{min}} = -0.990 - (-0.991) = +0.001\\,E_{\\mathrm{h}}$.\nThe magnitude of this error component is extremely small, $0.001\\,E_{\\mathrm{h}}$.\n\n**Option-by-Option Analysis**\n\n**A. The large change from $E_{\\mathrm{PBE}}[n_{\\mathrm{PBE}}]$ to $E_{\\mathrm{PBE}}[n_{\\mathrm{UHF}}]$ in the large basis indicates that, for stretched H$_2$ with a semi-local functional, density-driven error is a major component of the total error.**\nThe energy change upon replacing the self-consistent PBE density with the UHF density is $E_{\\mathrm{PBE}}[n_{\\mathrm{UHF}}] - E_{\\mathrm{PBE}}[n_{\\mathrm{PBE}}] = -1.008 - (-1.030) = +0.022\\,E_{\\mathrm{h}}$. This change estimates the negative of the density-driven error. Its magnitude, $0.022\\,E_{\\mathrm{h}}$, accounts for approximately $73\\%$ of the total error's magnitude ($0.030\\,E_{\\mathrm{h}}$). This is unequivocally a \"major component\". This physical situation is characteristic of static correlation error, where the semi-local functional yields a qualitatively incorrect, over-delocalized density, leading to a large density-driven error.\n**Verdict: Correct.**\n\n**B. The near equality of $E_{\\mathrm{hyb}}[n_{\\mathrm{hyb}}]_{\\mathrm{min}}$ and $E_{\\mathrm{hyb}}[n_{\\mathrm{UHF}}]_{\\mathrm{min}}$ indicates that, in the minimal basis, basis-set incompleteness dominates over density-driven error for the hybrid functional.**\nThe energy difference is $|-0.990 - (-0.991)| = 0.001\\,E_{\\mathrm{h}}$. This near-zero change implies that the energetic consequence of switching from the self-consistent density to the UHF density is negligible *within this basis*. A minimal basis severely restricts the flexibility of the electron density. It is too small to represent significant differences between $n_{\\mathrm{hyb}}$ and $n_{\\mathrm{UHF}}$. Therefore, the error observed in the calculation, a large deviation from the exact energy ($E_{\\mathrm{hyb}}[n_{\\mathrm{hyb}}]_{\\mathrm{min}} - E_{\\mathrm{ref}} = -0.990 - (-1.000) = +0.010\\,E_{\\mathrm{h}}$), is not due to a poor density choice *within the allowed space* but rather due to the inadequacy of the space itself. This inadequacy is the basis-set incompleteness error. The statement accurately concludes that the small observable density-driven error suggests that basis-set error is the dominant factor.\n**Verdict: Correct.**\n\n**C. The residual gap between $E_{\\mathrm{PBE}}[n_{\\mathrm{UHF}}]$ and $E_{\\mathrm{ref}}$ in the large basis is attributable to functional-driven error (e.g., missing static correlation in the semi-local form).**\nThe gap is $E_{\\mathrm{PBE}}[n_{\\mathrm{UHF}}] - E_{\\mathrm{ref}} = -1.008 - (-1.000) = -0.008\\,E_{\\mathrm{h}}$. This quantity represents the error of the PBE functional when evaluated on a higher-fidelity density ($n_{\\mathrm{UHF}}$), which is our best proxy for the functional-driven error. This is the error stemming from the intrinsic mathematical form of the PBE functional itself, specifically its inability to correctly describe the multi-reference nature (static correlation) of the stretched H$_2$ bond, even when provided with a qualitatively correct density.\n**Verdict: Correct.**\n\n**D. Because the approximate energy functional is minimized at its own self-consistent density, the Hohenberg–Kohn variational principle ensures that replacing $n_{\\mathrm{approx}}$ by a better density such as $n_{\\mathrm{UHF}}$ cannot reduce the total error relative to $E_{\\mathrm{ref}}$.**\nThis statement conflates two different variational principles. The variational principle for an *approximate* functional $E_{\\mathrm{approx}}[n]$ states that $E_{\\mathrm{approx}}[n_{\\mathrm{approx}}] \\le E_{\\mathrm{approx}}[n]$ for any other density $n$. This is true for PBE: $E_{\\mathrm{PBE}}[n_{\\mathrm{PBE}}] = -1.030\\,E_{\\mathrm{h}}$ is indeed lower than $E_{\\mathrm{PBE}}[n_{\\mathrm{UHF}}] = -1.008\\,E_{\\mathrm{h}}$. However, the Hohenberg-Kohn variational principle applies to the *exact* functional, guaranteeing that $E_{\\mathrm{exact}}[n] \\ge E_{\\mathrm{ref}}$. There is no principle that guarantees that $E_{\\mathrm{approx}}[n_{\\mathrm{approx}}]$ is closer to $E_{\\mathrm{ref}}$ than $E_{\\mathrm{approx}}[n_{\\text{other}}]$ is. The data explicitly contradicts the statement's conclusion. The total error with the self-consistent density is $|-1.030 - (-1.000)| = 0.030\\,E_{\\mathrm{h}}$. The total error with the UHF density is $|-1.008 - (-1.000)| = 0.008\\,E_{\\mathrm{h}}$. The error *was* reduced by replacing the density.\n**Verdict: Incorrect.**\n\n**E. In a minimal basis, density errors must dominate the energy error because the basis limits the variational space for $n(\\mathbf{r})$, so replacing $n_{\\mathrm{hyb}}$ by $n_{\\mathrm{UHF}}$ necessarily produces a large energy improvement.**\nThis statement contains fallacious reasoning and a conclusion contradicted by the data. The premise that limiting the variational space causes density errors to dominate is incorrect; it actually *suppresses* the ability of the system to express different densities, thereby making the observable density-driven error small, as shown in the analysis for option B. The conclusion that replacing the density \"necessarily produces a large energy improvement\" is factually disproven by the data: the change is $E_{\\mathrm{hyb}}[n_{\\mathrm{hyb}}]_{\\mathrm{min}} - E_{\\mathrm{hyb}}[n_{\\mathrm{UHF}}]_{\\mathrm{min}} = +0.001\\,E_{\\mathrm{h}}$, which is a negligible change, not a large improvement.\n**Verdict: Incorrect.**",
            "answer": "$$\\boxed{ABC}$$"
        }
    ]
}