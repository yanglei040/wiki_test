{
    "hands_on_practices": [
        {
            "introduction": "双层优化在许多现实世界决策中都有应用，尤其是在存在层级结构的系统中。本练习将双层优化的抽象概念置于一个具体的交通网络设计场景中 。通过为道路设置通行费，交通规划者（领导者）旨在最小化整个系统的总通行时间，同时预测驾驶员（跟随者）会选择对自己最有利的路线。这个练习揭示了系统最优与用户均衡之间的内在冲突，并演示了如何通过定价策略来引导个体行为以实现集体利益。",
            "id": "3102902",
            "problem": "考虑一个单起点-单终点的交通网络，该网络有两个平行路段，标记为 $e \\in \\{1,2\\}$。单位时间内有 $Q=10$ 的固定车辆需求必须从起点行驶到终点。路段 $e$ 承载的流量为 $y_e \\geq 0$，使得 $y_1 + y_2 = Q$。路段 $e$ 上的行驶时间（成本）由 $c_e(y_e)$ 给出，规划者在路段 $e$ 上设置非负的通行费 $t_e$。\n\n底层行为遵循 Wardrop 用户均衡 (UE) 第一原则：在承载正流量的路段中，广义成本 $c_e(y_e) + t_e$ 是相等的；任何未被使用的路段的广义成本不低于该共同值。具体来说，由通行费 $t=(t_1,t_2)$ 引起的 UE 流量 $y^{*}(t)$ 满足 $y_e^{*}(t) \\geq 0$，$y_1^{*}(t)+y_2^{*}(t)=Q$，并且对于任何 $y_e^{*}(t)>0$ 的路段 $e$，$c_e\\!\\left(y_e^{*}(t)\\right)+t_e$ 在这些路段上是相等的。\n\n上层规划者选择 $t$ 以最小化总行驶成本\n$$\nF\\!\\left(t,y^{*}(t)\\right) \\;=\\; \\sum_{e=1}^{2} y_e^{*}(t)\\,c_e\\!\\left(y_e^{*}(t)\\right).\n$$\n\n假设路段成本函数为\n$$\nc_1(y_1) \\;=\\; 10 + y_1, \\qquad c_2(y_2) \\;=\\; 14 + \\frac{1}{2}\\,y_2.\n$$\n假设规划者可以设置 $t_1$ 和 $t_2$，确定能最小化 $F\\!\\left(t,y^{*}(t)\\right)$ 且满足 UE 行为的通行费 $(t_1^{*},t_2^{*})$。请以精确的有理数形式提供最终结果；无需四舍五入。",
            "solution": "用户提供了一个在交通网络分析背景下的双层优化问题。该问题旨在确定最优通行费，以在用户自私的路径选择行为下最小化总系统行驶时间。\n\n### 问题验证\n对问题陈述进行分析以确保其有效性。\n\n**步骤 1：提取已知条件**\n- 网络：两个平行路段，$e \\in \\{1, 2\\}$。\n- 总需求：$Q = 10$。\n- 流量变量：$y_1, y_2$，其中 $y_1, y_2 \\geq 0$ 且 $y_1 + y_2 = 10$。\n- 路段成本函数：$c_1(y_1) = 10 + y_1$ 和 $c_2(y_2) = 14 + \\frac{1}{2}y_2$。\n- 通行费：$t_1, t_2$，其中 $t_1, t_2 \\geq 0$。\n- 底层（用户均衡）：用户选择路段以最小化其个体广义成本，$g_e(y_e, t_e) = c_e(y_e) + t_e$。在均衡状态下，所有被使用的路段具有相等的广义成本，该成本不大于任何未使用路段的广义成本。\n- 上层（规划者目标）：最小化总系统行驶成本，$F\\left(t,y^{*}(t)\\right) = \\sum_{e=1}^{2} y_e^{*}(t)\\,c_e\\!\\left(y_e^{*}(t)\\right)$，其中 $y^*(t)$ 是由通行费 $t$ 产生的 UE 流量向量。\n\n**步骤 2：使用提取的已知条件进行验证**\n- **科学依据：** 该问题使用了交通科学和微观经济学中标准的、公认的概念，即 Wardrop 的用户均衡和系统最优。规划者与网络用户之间的 Stackelberg 博弈模型是网络设计和定价问题的经典范式。\n- **适定性：** 路段成本函数是连续且严格递增的，这保证了对于任何给定的通行费集合，用户均衡流量是唯一的。规划者的目标函数是良定义的。寻找能引导出系统最优流量的通行费问题是一个标准的、可解的双层规划问题。\n- **客观性：** 问题以数学上的精确性陈述，不包含任何主观或模糊的术语。\n- **完整性和一致性：** 提供了所有必要的数据和行为原则。没有矛盾之处。\n\n**步骤 3：结论与行动**\n该问题是有效的。可以构建一个严谨的解。\n\n### 解答\n\n此问题是一个经典的双层优化问题，也称为 Stackelberg 博弈。领导者（规划者）设置通行费 $(t_1, t_2)$，跟随者（用户）通过选择路径来做出反应，以建立用户均衡 (UE)。规划者预测到这种反应，并设置通行费以实现其自身的目标，即最小化总系统行驶成本。\n\n规划者的最优策略是设置能够激励用户共同产生一个与系统最优 (SO) 流量模式相同的流量模式。SO 流量模式是指无论用户在没有干预的情况下可能如何行为，都能最小化总行驶成本的流量模式。\n\n**1. 确定系统最优 (SO) 流量**\n\nSO 流量 $(y_1^{SO}, y_2^{SO})$ 是最小化总系统行驶成本 $F$ 的流量分布。函数 $F$ 由以下公式给出：\n$$\nF(y_1, y_2) = y_1 c_1(y_1) + y_2 c_2(y_2) = y_1(10+y_1) + y_2\\left(14+\\frac{1}{2}y_2\\right)\n$$\n使用流量守恒约束 $y_2 = 10 - y_1$，我们可以将 $F$ 表示为仅关于 $y_1$ 的函数，其中 $y_1 \\in [0, 10]$：\n$$\nF(y_1) = y_1(10+y_1) + (10-y_1)\\left(14+\\frac{1}{2}(10-y_1)\\right)\n$$\n$$\nF(y_1) = 10y_1 + y_1^2 + (10-y_1)\\left(14+5-\\frac{1}{2}y_1\\right)\n$$\n$$\nF(y_1) = 10y_1 + y_1^2 + (10-y_1)\\left(19-\\frac{1}{2}y_1\\right)\n$$\n$$\nF(y_1) = 10y_1 + y_1^2 + 190 - 5y_1 - 19y_1 + \\frac{1}{2}y_1^2\n$$\n$$\nF(y_1) = \\frac{3}{2}y_1^2 - 14y_1 + 190\n$$\n为了找到这个二次函数的最小值，我们对其关于 $y_1$ 求导并令其为零：\n$$\n\\frac{dF}{dy_1} = 3y_1 - 14\n$$\n令 $\\frac{dF}{dy_1} = 0$ 得到路段 1 上的最优流量：\n$$\n3y_1^{SO} - 14 = 0 \\implies y_1^{SO} = \\frac{14}{3}\n$$\n二阶导数 $\\frac{d^2F}{dy_1^2} = 3 > 0$，证实了这是一个最小值。\n由于 $0 \\leq \\frac{14}{3} \\leq 10$，这是一个有效的内部解。\n路段 2 上对应的流量为：\n$$\ny_2^{SO} = 10 - y_1^{SO} = 10 - \\frac{14}{3} = \\frac{30-14}{3} = \\frac{16}{3}\n$$\n因此，系统最优流量为 $(y_1^{SO}, y_2^{SO}) = \\left(\\frac{14}{3}, \\frac{16}{3}\\right)$。\n\n**2. 确定最优通行费**\n\n规划者必须设置通行费 $(t_1^*, t_2^*)$，使得产生的 UE 流量与 SO 流量相同。对于流量 $(y_1, y_2) = (\\frac{14}{3}, \\frac{16}{3})$，这是一个内部解（两个流量都为正），UE 条件要求两个路段上的广义成本相等：\n$$\nc_1(y_1^{SO}) + t_1^* = c_2(y_2^{SO}) + t_2^*\n$$\n设置此类通行费的经典方法是基于边际成本定价原则。路段上的最优通行费应等于边际外部拥堵成本，即在 SO 流量下，边际社会成本 ($MSC$) 与私人成本 ($c_e$) 之差。\n路段 $e$ 上的总成本是 $TC_e(y_e) = y_e c_e(y_e)$。边际社会成本是 $MSC_e(y_e) = \\frac{d}{dy_e}TC_e(y_e)$。最优通行费是 $t_e^* = MSC_e(y_e^{SO}) - c_e(y_e^{SO})$。\n\n使用乘法法则，$MSC_e(y_e) = c_e(y_e) + y_e c_e'(y_e)$。因此，通行费由更简单的公式给出：\n$$\nt_e^* = y_e^{SO} c_e'(y_e^{SO})\n$$\n我们计算每个成本函数的导数：\n对于路段 1：$c_1(y_1) = 10 + y_1 \\implies c_1'(y_1) = 1$。\n对于路段 2：$c_2(y_2) = 14 + \\frac{1}{2}y_2 \\implies c_2'(y_2) = \\frac{1}{2}$。\n\n现在我们可以使用我们找到的 SO 流量来计算最优通行费：\n对于路段 1：\n$$\nt_1^* = y_1^{SO} \\cdot c_1'(y_1^{SO}) = \\frac{14}{3} \\cdot 1 = \\frac{14}{3}\n$$\n对于路段 2：\n$$\nt_2^* = y_2^{SO} \\cdot c_2'(y_2^{SO}) = \\frac{16}{3} \\cdot \\frac{1}{2} = \\frac{8}{3}\n$$\n两个通行费都是非负的，满足问题约束。\n\n因此，引导出系统最优流量的最优通行费是 $(t_1^*, t_2^*) = \\left(\\frac{14}{3}, \\frac{8}{3}\\right)$。\n\n我们来验证这些通行费确实能引导出作为用户均衡的 SO 流量。广义成本必须相等：\n$$\ng_1 = c_1(y_1^{SO}) + t_1^* = \\left(10 + \\frac{14}{3}\\right) + \\frac{14}{3} = \\frac{30+14+14}{3} = \\frac{58}{3}\n$$\n$$\ng_2 = c_2(y_2^{SO}) + t_2^* = \\left(14 + \\frac{1}{2}\\frac{16}{3}\\right) + \\frac{8}{3} = \\left(14 + \\frac{8}{3}\\right) + \\frac{8}{3} = \\frac{42+8+8}{3} = \\frac{58}{3}\n$$\n由于 $g_1 = g_2$，流量处于均衡状态。这证实了我们的结果。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{14}{3} & \\frac{8}{3} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在处理双层优化问题时，一个关键的复杂性出现在下层问题存在多个最优解时。跟随者的选择会直接影响领导者的目标函数值，这导致了“乐观”和“悲观”两种不同的问题表述。本练习  旨在通过一个精心设计的例子，让您亲身体会这两种情况的区别。您将分析一个下层问题，其解不是唯一的，并分别计算在最有利于和最不利于上层目标的情况下，整个双层问题的最优解，从而量化这两种极端情况之间的差距。",
            "id": "3102843",
            "problem": "考虑一个双层优化问题，其上层决策变量为 $x \\in [0,2]$，下层决策向量为 $y = (y_{1}, y_{2}) \\in \\mathbb{R}^{2}$。上层目标是最小化实值函数 $F(x,y) = (x - 1)^{2} + y_{1} - y_{2}$。下层问题由上层决策 $x$ 参数化，是一个定义如下的线性规划(LP)问题：最小化 $y_{1} + y_{2}$，约束条件为 $y_{1} + y_{2} = x$，$0 \\leq y_{1} \\leq 1$ 和 $0 \\leq y_{2} \\leq 1$。定义：在乐观双层约定中，下层可以选择其任意一个最优解来最小化上层目标。在悲观双层约定中，下层可以选择其任意一个最优解来最大化上层目标。从双层优化和线性规划解性质的标准定义出发，确定乐观上层最优目标值 $F_{\\text{opt}}^{\\star}$ 和悲观上层最优目标值 $F_{\\text{pess}}^{\\star}$，然后计算数值差距 $G = F_{\\text{pess}}^{\\star} - F_{\\text{opt}}^{\\star}$。将 $G$ 的最终答案表示为精确值（无四舍五入）。",
            "solution": "问题陈述经核实具有科学依据、良定、客观且自洽。这是一个具有线性下层约束的标准双层优化问题。上层变量 $x \\in [0,2]$ 的定义域确保了下层问题的可行性。所有术语都定义明确。我们可以开始求解。\n\n双层优化问题如下：\n上层：\n$$ \\min_{x, y} F(x, y) = (x - 1)^{2} + y_{1} - y_{2} $$\n约束条件为 $x \\in [0, 2]$ 且 $y$ 是下层问题的最优解。\n\n下层（对于固定的 $x$）：\n$$ \\min_{y_1, y_2} f(y_1, y_2) = y_{1} + y_{2} $$\n约束条件为：\n$$ y_{1} + y_{2} = x $$\n$$ 0 \\leq y_{1} \\leq 1 $$\n$$ 0 \\leq y_{2} \\leq 1 $$\n\n首先，我们分析下层问题（LLP）。对于任何可行点 $(y_1, y_2)$，约束条件 $y_1 + y_2 = x$ 决定了下层目标函数 $f(y_1, y_2)$ 始终等于 $x$。这意味着任何对于 LLP 可行的点 $(y_1, y_2)$ 也是 LLP 的最优解。\n\n令 $S(x)$ 表示给定 $x$ 时 LLP 的最优解集。该集合与 LLP 的可行集相同。我们可以通过仅用 $y_1$ 表示约束来刻画 $S(x)$。由 $y_1 + y_2 = x$，我们得到 $y_2 = x - y_1$。箱式约束 $0 \\leq y_1 \\leq 1$ 和 $0 \\leq y_2 \\leq 1$ 变为：\n$1.$ $0 \\leq y_1 \\leq 1$\n$2.$ $0 \\leq x - y_1 \\leq 1 \\implies x - 1 \\leq y_1 \\leq x$\n\n结合这些，得到 $y_1$ 的范围：\n$$ \\max(0, x - 1) \\leq y_1 \\leq \\min(1, x) $$\n因此，下层最优解集为：\n$$ S(x) = \\{ (y_1, y_2) \\in \\mathbb{R}^2 \\mid y_2 = x - y_1, \\text{ and } \\max(0, x-1) \\leq y_1 \\leq \\min(1, x) \\} $$\n$x \\in [0, 2]$ 的定义域确保了 $y_1$ 的这个区间非空。当 $x=0$ 时，$y_1=0$，当 $x=2$ 时，$y_1=1$。\n\n上层目标是 $F(x, y) = (x - 1)^{2} + y_{1} - y_{2}$。代入 $y_2 = x - y_1$，我们得到：\n$$ F(x, y_1) = (x - 1)^{2} + y_{1} - (x - y_{1}) = (x - 1)^{2} + 2y_{1} - x $$\n现在，可以通过将 LLP 替换为从其可行范围内选择 $y_1$ 来重写双层问题。\n\n**乐观情况**\n在乐观约定中，对于每个 $x$，下层选择一个解 $y \\in S(x)$ 来最小化上层目标 $F(x,y)$。上层问题为：\n$$ F_{\\text{opt}}^{\\star} = \\min_{x \\in [0, 2]} \\left( \\min_{y \\in S(x)} F(x, y) \\right) $$\n内部最小化问题是：\n$$ \\min_{y \\in S(x)} F(x, y) = \\min_{y_1} \\left( (x - 1)^{2} + 2y_{1} - x \\right) \\quad \\text{s.t. } y_1 \\in [\\max(0, x-1), \\min(1, x)] $$\n为了关于 $y_1$ 最小化此表达式，我们必须选择 $y_1$ 的最小值，即 $y_1 = \\max(0, x-1)$。\n令 $F_{\\text{opt}}(x)$ 为得到的上层目标函数：\n$$ F_{\\text{opt}}(x) = (x - 1)^{2} + 2\\max(0, x-1) - x $$\n我们分情况在 $x \\in [0, 2]$ 上最小化 $F_{\\text{opt}}(x)$：\n情况1：$x \\in [0, 1]$。此时，$x-1 \\leq 0$，所以 $\\max(0, x-1) = 0$。\n$$ F_{\\text{opt}}(x) = (x - 1)^{2} - x = x^2 - 2x + 1 - x = x^2 - 3x + 1 $$\n导数为 $F'_{\\text{opt}}(x) = 2x - 3$。该抛物线的顶点在 $x=3/2$ 处，这在 $[0, 1]$ 之外。由于抛物线开口向上，在 $[0, 1]$ 上的最小值出现在端点处。\n$F_{\\text{opt}}(0) = 1$。\n$F_{\\text{opt}}(1) = 1^2 - 3(1) + 1 = -1$。\n在 $[0, 1]$ 上的最小值为 $-1$。\n\n情况2：$x \\in (1, 2]$。此时，$x-1 > 0$，所以 $\\max(0, x-1) = x-1$。\n$$ F_{\\text{opt}}(x) = (x - 1)^{2} + 2(x - 1) - x = x^2 - 2x + 1 + 2x - 2 - x = x^2 - x - 1 $$\n导数为 $F'_{\\text{opt}}(x) = 2x - 1$。顶点在 $x=1/2$ 处，这在 $(1, 2]$ 之外。由于抛物线开口向上，在 $(1, 2]$ 上的最小值在端点 $x \\to 1^+$ 或 $x=2$ 处取得。\n$\\lim_{x \\to 1^+} F_{\\text{opt}}(x) = 1^2 - 1 - 1 = -1$。\n$F_{\\text{opt}}(2) = 2^2 - 2 - 1 = 1$。\n在 $(1, 2]$ 上的最小值为 $-1$。\n\n综合两种情况，$F_{\\text{opt}}(x)$ 在 $[0, 2]$ 上的全局最小值是 $-1$，在 $x=1$ 处取得。因此，$F_{\\text{opt}}^{\\star} = -1$。\n\n**悲观情况**\n在悲观约定中，对于每个 $x$，下层选择一个解 $y \\in S(x)$ 来最大化上层目标 $F(x,y)$。上层问题为：\n$$ F_{\\text{pess}}^{\\star} = \\min_{x \\in [0, 2]} \\left( \\max_{y \\in S(x)} F(x, y) \\right) $$\n内部最大化问题是：\n$$ \\max_{y \\in S(x)} F(x, y) = \\max_{y_1} \\left( (x - 1)^{2} + 2y_{1} - x \\right) \\quad \\text{s.t. } y_1 \\in [\\max(0, x-1), \\min(1, x)] $$\n为了关于 $y_1$ 最大化此表达式，我们必须选择 $y_1$ 的最大值，即 $y_1 = \\min(1, x)$。\n令 $F_{\\text{pess}}(x)$ 为得到的上层目标函数：\n$$ F_{\\text{pess}}(x) = (x - 1)^{2} + 2\\min(1, x) - x $$\n我们分情况在 $x \\in [0, 2]$ 上最小化 $F_{\\text{pess}}(x)$：\n情况1：$x \\in [0, 1]$。此时，$\\min(1, x) = x$。\n$$ F_{\\text{pess}}(x) = (x - 1)^{2} + 2x - x = x^2 - 2x + 1 + x = x^2 - x + 1 $$\n导数为 $F'_{\\text{pess}}(x) = 2x - 1$。顶点在 $x=1/2$ 处，这在 $[0, 1]$ 内。\n最小值为 $F_{\\text{pess}}(1/2) = (1/2)^2 - 1/2 + 1 = 1/4 - 1/2 + 1 = 3/4$。\n\n情况2：$x \\in (1, 2]$。此时，$\\min(1, x) = 1$。\n$$ F_{\\text{pess}}(x) = (x - 1)^{2} + 2(1) - x = x^2 - 2x + 1 + 2 - x = x^2 - 3x + 3 $$\n导数为 $F'_{\\text{pess}}(x) = 2x - 3$。顶点在 $x=3/2$ 处，这在 $(1, 2]$ 内。\n最小值为 $F_{\\text{pess}}(3/2) = (3/2)^2 - 3(3/2) + 3 = 9/4 - 9/2 + 3 = 9/4 - 18/4 + 12/4 = 3/4$。\n\n综合两种情况，$F_{\\text{pess}}(x)$ 在 $[0, 2]$ 上的全局最小值是 $3/4$。因此，$F_{\\text{pess}}^{\\star} = 3/4$。\n\n**计算差距**\n数值差距 $G$ 是悲观和乐观最优目标值之间的差：\n$$ G = F_{\\text{pess}}^{\\star} - F_{\\text{opt}}^{\\star} $$\n$$ G = \\frac{3}{4} - (-1) = \\frac{3}{4} + 1 = \\frac{7}{4} $$\n最终答案是 $7/4$。",
            "answer": "$$ \\boxed{\\frac{7}{4}} $$"
        },
        {
            "introduction": "直接求解双层优化问题通常具有挑战性，因为其约束条件中隐含着一个优化问题。因此，发展近似求解方法至关重要。本练习  介绍了一种常见的技术：将下层的最优性条件（在此例中为 KKT 条件）作为一个惩罚项加入上层目标，从而将双层问题转化为一个单层优化问题。通过求解这个惩罚问题并将其结果与精确的双层最优解进行比较，您将能深入理解这种近似方法的原理、有效性及其与原始问题解的偏差。",
            "id": "3102923",
            "problem": "考虑一个双层优化问题，其中上层决策变量为 $x \\in \\mathbb{R}$，下层决策变量为 $y \\in \\mathbb{R}$。上层目标函数为 $F(x,y) = (x - 1)^{2} + (y - 2)^{2}$。由 $x$ 参数化的下层问题是，在 $\\mathbb{R}$ 上关于 $y$ 最小化强凸函数 $g(y; x) = (y - x)^{2} + y$。下层问题的一阶 Karush–Kuhn–Tucker (KKT) 平稳性条件（对于无约束问题，该条件简化为关于 $y$ 的梯度在最小值点处为零）由 $\\partial g/\\partial y = 2(y - x) + 1 = 0$ 给出。\n\n任务：\n1. 仅使用双层问题的基本定义和无约束凸最小化问题的一阶最优性条件，通过将下层解 $y^{\\star}(x)$ 表征为 $x$ 的函数来消除下层问题，然后求解精确的双层最优解 $(x^{\\star}, y^{\\star})$以及相应的上层最优值 $F^{\\star} = F(x^{\\star}, y^{\\star})$。\n2. 现在考虑一个单层惩罚形式，其中上层目标函数惩罚对下层KKT残差的违反。将KKT残差定义为 $r(x,y) = \\partial g/\\partial y = 2(y - x) + 1$。对于给定的惩罚参数 $\\rho = 1$，求解惩罚问题\n$\n\\min_{x \\in \\mathbb{R},\\, y \\in \\mathbb{R}} \\;\\; \\Phi_{\\rho}(x,y) \\equiv F(x,y) + \\rho \\, r(x,y)^{2}.\n$\n计算其最小值点 $(x_{\\rho}, y_{\\rho})$ 并在此惩罚解处评估上层目标函数 $F(x_{\\rho}, y_{\\rho})$ 的值。\n\n最后，计算标量差\n$\n\\Delta \\equiv F(x_{\\rho}, y_{\\rho}) - F^{\\star},\n$\n并将 $\\Delta$ 报告为单个精确值。无需四舍五入，不涉及单位。",
            "solution": "该问题是有效的。这是一个在双层优化领域（优化方法的一个子领域）中定义明确的数学问题。问题陈述是自洽的，提供了所有必要的函数和条件。所涉及的函数 $F(x,y)$ 和 $g(y;x)$ 是简单的多项式函数。下层问题是一个强凸函数的无约束最小化问题，这保证了其解的唯一性。由此产生的上层问题也是一个简单的无约束二次最小化问题。所述的惩罚方法是重构双层问题的标准技术。所有术语都有明确的定义，不存在科学或逻辑上的矛盾。\n\n解题过程按问题陈述的要求分为两部分。\n\n首先，我们解决双层优化问题。该双层优化问题由下式给出：\n$$ \\min_{x \\in \\mathbb{R}, y \\in \\mathbb{R}} F(x,y) = (x - 1)^{2} + (y - 2)^{2} $$\n$$ \\text{约束条件为 } y \\in \\arg\\min_{z \\in \\mathbb{R}} g(z; x) = (z - x)^{2} + z $$\n下层问题是无约束的，其目标函数 $g(z; x)$ 关于 $z$ 是严格凸的（因为 $\\frac{\\partial^2 g}{\\partial z^2} = 2 > 0$）。因此，唯一的最小值点 $y^{\\star}(x)$ 可以通过将关于下层变量的一阶导数设为零来找到。问题给出了这个一阶最优性条件：\n$$ \\frac{\\partial g}{\\partial y} = 2(y - x) + 1 = 0 $$\n将 $y$ 解为 $x$ 的函数，得到下层最优响应，或称为理性反应函数 $y^{\\star}(x)$：\n$$ 2(y - x) = -1 \\implies y - x = -\\frac{1}{2} \\implies y^{\\star}(x) = x - \\frac{1}{2} $$\n为了解决上层问题，我们将这个 $y$ 的表达式代入上层目标函数 $F(x,y)$，从而将问题简化为只含 $x$ 的单层优化问题：\n$$ \\hat{F}(x) = F(x, y^{\\star}(x)) = (x - 1)^{2} + \\left( \\left(x - \\frac{1}{2}\\right) - 2 \\right)^{2} = (x - 1)^{2} + \\left(x - \\frac{5}{2}\\right)^{2} $$\n为求最优值 $x^{\\star}$，我们通过寻找驻点来最小化 $\\hat{F}(x)$。我们计算关于 $x$ 的导数并将其设为零：\n$$ \\frac{d\\hat{F}}{dx} = \\frac{d}{dx} \\left[ (x - 1)^{2} + \\left(x - \\frac{5}{2}\\right)^{2} \\right] = 2(x - 1) + 2\\left(x - \\frac{5}{2}\\right) = 2x - 2 + 2x - 5 = 4x - 7 $$\n将导数设为零，得到：\n$$ 4x - 7 = 0 \\implies x^{\\star} = \\frac{7}{4} $$\n二阶导数为 $\\frac{d^2\\hat{F}}{dx^2} = 4 > 0$，这证实了 $x^{\\star}$ 是一个最小值点。现在我们求出相应的下层最优变量 $y^{\\star}$：\n$$ y^{\\star} = y^{\\star}(x^{\\star}) = \\frac{7}{4} - \\frac{1}{2} = \\frac{7}{4} - \\frac{2}{4} = \\frac{5}{4} $$\n双层最优解为 $(x^{\\star}, y^{\\star}) = \\left(\\frac{7}{4}, \\frac{5}{4}\\right)$。相应的上层最优值为 $F^{\\star}$：\n$$ F^{\\star} = F(x^{\\star}, y^{\\star}) = \\left(\\frac{7}{4} - 1\\right)^{2} + \\left(\\frac{5}{4} - 2\\right)^{2} = \\left(\\frac{3}{4}\\right)^{2} + \\left(-\\frac{3}{4}\\right)^{2} = \\frac{9}{16} + \\frac{9}{16} = \\frac{18}{16} = \\frac{9}{8} $$\n\n第二步，我们求解单层惩罚问题。当惩罚参数 $\\rho = 1$ 时，惩罚目标函数 $\\Phi_{\\rho}(x,y)$ 为：\n$$ \\Phi_{1}(x,y) = F(x,y) + 1 \\cdot r(x,y)^{2} = (x - 1)^{2} + (y - 2)^{2} + (2(y - x) + 1)^{2} $$\n我们需要关于 $x$ 和 $y$ 最小化这个函数。我们通过将 $\\Phi_{1}(x,y)$ 的梯度设为零来找到驻点。偏导数如下：\n$$ \\frac{\\partial \\Phi_{1}}{\\partial x} = \\frac{\\partial}{\\partial x} \\left[ (x - 1)^{2} + (y - 2)^{2} + (2y - 2x + 1)^{2} \\right] = 2(x - 1) + 2(2y - 2x + 1)(-2) = 2x - 2 - 8y + 8x - 4 = 10x - 8y - 6 $$\n$$ \\frac{\\partial \\Phi_{1}}{\\partial y} = \\frac{\\partial}{\\partial y} \\left[ (x - 1)^{2} + (y - 2)^{2} + (2y - 2x + 1)^{2} \\right] = 2(y - 2) + 2(2y - 2x + 1)(2) = 2y - 4 + 8y - 8x + 4 = 10y - 8x $$\n将偏导数设为零，得到一个关于最小值点 $(x_{\\rho}, y_{\\rho})$ 的线性方程组：\n1. $10x - 8y - 6 = 0 \\implies 5x - 4y = 3$\n2. $10y - 8x = 0 \\implies 10y = 8x \\implies y = \\frac{4}{5}x$\n将第二个方程中的 $y$ 的表达式代入第一个方程：\n$$ 5x - 4\\left(\\frac{4}{5}x\\right) = 3 \\implies 5x - \\frac{16}{5}x = 3 \\implies \\frac{25x - 16x}{5} = 3 \\implies \\frac{9}{5}x = 3 $$\n求解 $x$，我们得到惩罚解 $x_{\\rho}$：\n$$ x_{\\rho} = 3 \\cdot \\frac{5}{9} = \\frac{15}{9} = \\frac{5}{3} $$\n现在我们求出相应的 $y_{\\rho}$：\n$$ y_{\\rho} = \\frac{4}{5} x_{\\rho} = \\frac{4}{5} \\cdot \\frac{5}{3} = \\frac{4}{3} $$\n惩罚问题的最小值点是 $(x_{\\rho}, y_{\\rho}) = \\left(\\frac{5}{3}, \\frac{4}{3}\\right)$。接下来，我们计算上层目标函数 $F(x,y)$ 在此点的值：\n$$ F(x_{\\rho}, y_{\\rho}) = \\left(\\frac{5}{3} - 1\\right)^{2} + \\left(\\frac{4}{3} - 2\\right)^{2} = \\left(\\frac{2}{3}\\right)^{2} + \\left(-\\frac{2}{3}\\right)^{2} = \\frac{4}{9} + \\frac{4}{9} = \\frac{8}{9} $$\n\n最后，我们计算所需的标量差 $\\Delta$：\n$$ \\Delta = F(x_{\\rho}, y_{\\rho}) - F^{\\star} = \\frac{8}{9} - \\frac{9}{8} $$\n为了计算这个差值，我们找到公分母，即 $72$：\n$$ \\Delta = \\frac{8 \\cdot 8}{9 \\cdot 8} - \\frac{9 \\cdot 9}{8 \\cdot 9} = \\frac{64 - 81}{72} = -\\frac{17}{72} $$\n这个差是一个精确的有理数。",
            "answer": "$$\\boxed{-\\frac{17}{72}}$$"
        }
    ]
}