{
    "hands_on_practices": [
        {
            "introduction": "To begin our hands-on exploration of functional enrichment analysis, we'll start with the statistical cornerstone: the hypergeometric test. This practice allows you to calculate a $p$-value from first principles, giving you a concrete understanding of what it represents. By comparing this exact theoretical probability to an empirical $p$-value estimated from a permutation test, you'll gain insight into how significance is assessed in both theory and practice .",
            "id": "2392301",
            "problem": "In a functional enrichment analysis, consider a background of $N=100$ genes, a biological pathway containing $n=10$ genes, and a query gene list of size $k=5$. In an experiment, the observed overlap between the query gene list and the pathway is $x=3$ genes.\n\nAssume the null hypothesis that the query gene list is formed by sampling $k$ genes uniformly at random without replacement from the $N$ genes.\n\nUsing first principles of combinatorial counting, compute the one-sided hypergeometric $p$-value defined as the probability of observing an overlap of at least $x$ genes under the null hypothesis. Separately, a permutation-based test is conducted by generating $m=10{,}000$ independent random gene lists of size $k$ from the same background; among these, $h=61$ lists have an overlap with the pathway that is at least $x$.\n\nCompute the absolute difference between the hypergeometric $p$-value and the permutation-based $p$-value estimate. Express your final answer as a decimal. Round your answer to $4$ significant figures.",
            "solution": "The problem is subjected to rigorous validation before any attempt at a solution is made.\n\nStep 1: Extract Givens\nThe problem provides the following parameters:\n- Total number of genes in the background: $N=100$.\n- Number of genes in the biological pathway (successes in population): $n=10$.\n- Size of the query gene list (sample size): $k=5$.\n- Observed overlap (successes in sample): $x=3$.\n- Null hypothesis: The query gene list is a simple random sample of size $k$ drawn without replacement from the background of $N$ genes.\n- Definition of the one-sided hypergeometric $p$-value: The probability of observing an overlap of *at least* $x$ genes.\n- Number of permutations in a permutation test: $m=10,000$.\n- Number of permuted lists with overlap of at least $x$: $h=61$.\n\nStep 2: Validate Using Extracted Givens\nThe problem is evaluated against the required criteria.\n- **Scientifically Grounded**: The problem describes a canonical scenario in bioinformatics for functional enrichment analysis. The use of the hypergeometric distribution to model sampling without replacement and the concept of a permutation test to empirically estimate significance are fundamental and standard methods in this field. The setup is scientifically and mathematically sound.\n- **Well-Posed**: All necessary parameters ($N$, $n$, $k$, $x$, $m$, $h$) for the required calculations are explicitly provided. The questions posed—calculating two types of $p$-values and their difference—are unambiguous and lead to a single, verifiable numerical solution.\n- **Objective**: The problem is stated in precise, quantitative terms, free from any subjective or biased language.\n\nThe problem does not exhibit any flaws such as scientific unsoundness, incompleteness, contradiction, or ambiguity. The values provided are realistic for a model problem.\n\nStep 3: Verdict and Action\nThe problem is deemed **valid**. A complete solution will now be provided.\n\nThe first task is to compute the theoretical one-sided $p$-value using first principles. Under the null hypothesis, the number of genes, $X$, from the pathway found in a randomly selected query list follows a hypergeometric distribution. The total number of ways to choose $k$ genes from a background of $N$ is given by the binomial coefficient $\\binom{N}{k}$. The number of ways to choose $i$ genes from the pathway of size $n$ and $k-i$ genes from the remaining $N-n$ genes is $\\binom{n}{i}\\binom{N-n}{k-i}$.\n\nThe probability mass function for observing exactly $i$ overlapping genes is:\n$$ P(X=i) = \\frac{\\binom{n}{i} \\binom{N-n}{k-i}}{\\binom{N}{k}} $$\nThe problem asks for the one-sided $p$-value, $p_{\\text{hyper}}$, which is the probability of observing an overlap of at least $x=3$. Since the query list size is $k=5$, the maximum possible overlap is $\\min(n, k) = \\min(10, 5) = 5$.\nTherefore, we must calculate the cumulative probability $P(X \\ge 3)$.\n$$ p_{\\text{hyper}} = P(X \\ge 3) = P(X=3) + P(X=4) + P(X=5) = \\sum_{i=3}^{5} \\frac{\\binom{10}{i} \\binom{100-10}{5-i}}{\\binom{100}{5}} $$\nWe calculate the components of this sum.\nThe denominator is the total number of possible query gene lists of size $5$:\n$$ \\binom{N}{k} = \\binom{100}{5} = \\frac{100 \\times 99 \\times 98 \\times 97 \\times 96}{5 \\times 4 \\times 3 \\times 2 \\times 1} = 75,287,520 $$\nThe numerators for $i=3, 4, 5$ are:\n- For $i=3$: The number of ways to choose $3$ genes from the pathway and $2$ from outside the pathway.\n$$ \\binom{10}{3} \\binom{90}{2} = \\left(\\frac{10 \\times 9 \\times 8}{3 \\times 2 \\times 1}\\right) \\left(\\frac{90 \\times 89}{2 \\times 1}\\right) = (120)(4005) = 480,600 $$\n- For $i=4$: The number of ways to choose $4$ genes from the pathway and $1$ from outside.\n$$ \\binom{10}{4} \\binom{90}{1} = \\left(\\frac{10 \\times 9 \\times 8 \\times 7}{4 \\times 3 \\times 2 \\times 1}\\right) (90) = (210)(90) = 18,900 $$\n- For $i=5$: The number of ways to choose $5$ genes from the pathway and $0$ from outside.\n$$ \\binom{10}{5} \\binom{90}{0} = \\left(\\frac{10 \\times 9 \\times 8 \\times 7 \\times 6}{5 \\times 4 \\times 3 \\times 2 \\times 1}\\right) (1) = (252)(1) = 252 $$\nThe total number of favorable outcomes (overlap $\\ge 3$) is the sum of these numerators:\n$$ 480,600 + 18,900 + 252 = 499,752 $$\nThe hypergeometric $p$-value is the ratio of favorable outcomes to the total number of outcomes:\n$$ p_{\\text{hyper}} = \\frac{499,752}{75,287,520} \\approx 0.006637653 $$\nThe second task is to compute the permutation-based $p$-value estimate, $p_{\\text{perm}}$. This is an empirical estimate derived from simulations. It is given as the ratio of the number of permutations, $h$, that meet or exceed the observed statistic to the total number of permutations, $m$.\n$$ p_{\\text{perm}} = \\frac{h}{m} = \\frac{61}{10,000} = 0.0061 $$\nFinally, we compute the absolute difference between the theoretical hypergeometric $p$-value and the permutation-based estimate.\n$$ \\text{Difference} = | p_{\\text{hyper}} - p_{\\text{perm}} | = | 0.006637653... - 0.0061 | = 0.000537653... $$\nThe problem requires this result to be rounded to $4$ significant figures. The first significant figure is $5$, followed by $3$, $7$, and $6$. The subsequent digit is $5$, so we round up the last significant digit.\n$$ \\text{Difference} \\approx 0.0005377 $$",
            "answer": "$$\\boxed{0.0005377}$$"
        },
        {
            "introduction": "Now that you understand how to calculate an enrichment $p$-value, let's build an intuition for what it means in terms of signal strength. In this exercise, we will simulate the decay of a biological signal by systematically introducing noise into an enriched gene set. Your task is to determine the \"breaking point\" at which the signal is no longer statistically significant, providing a tangible sense of the relationship between signal robustness, data quality, and statistical power .",
            "id": "2392264",
            "problem": "You are given a universe of genes modeled as a finite set of size $N$, a known pathway (gene set) of size $M \\le N$, and a set of $K$ selected genes (e.g., differential genes) suspected to be enriched for the pathway. Under the standard null model for over-representation, the number of pathway genes observed in the selected set, denoted $X$, follows a hypergeometric distribution with parameters $(N, M, K)$. The enrichment $p$-value for an observed overlap $k$ is the upper-tail probability $\\mathbb{P}(X \\ge k)$, where $X \\sim \\text{Hypergeometric}(N, M, K)$. This is the core of the Fisher’s exact test (FET) inference for over-representation, which rests on the sampling-without-replacement assumption. The expected overlap under the null is $\\mathbb{E}[X] = K \\cdot M / N$.\n\nYou will simulate the effect of random noise on an initially enriched signal as follows. Suppose the initial selected set contains $k_0$ pathway genes, with $k_0$ typically exceeding the null expectation $K M / N$. Introduce random noise by replacing a fraction $f \\in [0,1]$ of the $K$ selected genes uniformly at random from the universe (without replacement). In expectation, the pathway overlap after applying noise fraction $f$ evolves as\n$$\nk(f) \\;=\\; (1 - f)\\,k_0 \\;+\\; f \\, K \\cdot \\frac{M}{N}.\n$$\nBecause statistical testing requires an integer overlap, define the deterministic proxy\n$$\nk^\\star(f) \\;=\\; \\mathrm{round}\\!\\big(k(f)\\big),\n$$\nwhere “round” means rounding to the nearest integer using the standard rule that halves are rounded to the nearest even integer. For each $f$, define the enrichment $p$-value as\n$$\np(f) \\;=\\; \\mathbb{P}\\!\\big(X \\ge k^\\star(f)\\big), \\quad X \\sim \\text{Hypergeometric}(N, M, K).\n$$\n\nYour task is to determine, for each test case, the smallest noise fraction $f^\\star$ on a fixed grid such that the enrichment becomes non-significant at level $\\alpha$, that is,\n$$\nf^\\star \\;=\\; \\min \\left\\{ f \\in \\{0, \\Delta f, 2\\Delta f, \\dots, 1\\} \\;:\\; p(f) \\ge \\alpha \\right\\}.\n$$\nIf $p(0) \\ge \\alpha$, then $f^\\star = 0$. If $p(f) < \\alpha$ for all grid values up to $f=1$, then report $f^\\star = 1$.\n\nImplement a complete, runnable program that:\n- Computes $p(f)$ using the hypergeometric upper tail $\\mathbb{P}(X \\ge k^\\star(f))$ for each grid value of $f$ defined by step size $\\Delta f$.\n- Returns the smallest $f^\\star$ satisfying the non-significance criterion $p(f^\\star) \\ge \\alpha$.\n- Rounds and reports each $f^\\star$ to exactly three decimal places.\n- Produces a single line of output containing all results in order as a comma-separated list enclosed in square brackets, for example, $[\\,0.125,0.003,1.000\\,]$.\n\nUse the following five test cases, each specified as a tuple $(N, M, K, k_0, \\alpha, \\Delta f)$:\n- $(20000, 300, 150, 60, 0.05, 0.01)$\n- $(20000, 300, 150, 2, 0.05, 0.01)$\n- $(500, 80, 40, 18, 0.01, 0.005)$\n- $(10000, 1000, 500, 120, 0.05, 0.02)$\n- $(100, 10, 10, 7, 0.001, 0.05)$\n\nAll outputs must be pure decimals in $[0,1]$ (not percentages), rounded to three decimal places. The program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (for example, $[\\,0.125,0.003,1.000\\,]$).",
            "solution": "The problem requires us to determine the minimum noise fraction $f^\\star$ that renders a statistically significant gene set enrichment non-significant. This involves modeling the decay of an enrichment signal and repeatedly applying a statistical test to find the point at which the significance is lost. The process is based on the principles of over-representation analysis (ORA) in bioinformatics, which is statistically modeled by the hypergeometric distribution.\n\nThe problem is valid as it is scientifically grounded in established statistical methods for bioinformatics, is mathematically well-posed with all necessary parameters and conditions defined, and is objective and computationally verifiable.\n\nThe solution is developed through the following steps:\n\n1.  **Modeling Gene Set Over-Representation**\n    The foundation of the analysis is Fisher's Exact Test, which relies on the hypergeometric distribution. Given a universe of $N$ genes, a specific pathway containing $M$ of these genes, and a selected set of $K$ genes, the probability of observing exactly $x$ genes from the pathway in the selected set is given by the hypergeometric probability mass function (PMF):\n    $$\n    \\mathbb{P}(X=x) = \\frac{\\binom{M}{x} \\binom{N-M}{K-x}}{\\binom{N}{K}}\n    $$\n    Here, $X$ is the random variable representing the number of overlapping genes. The parameters of the distribution are the population size $N$, the number of success states in the population $M$ (genes in the pathway), and the number of draws $K$ (selected genes). We write this as $X \\sim \\text{Hypergeometric}(N, M, K)$.\n\n2.  **Defining Statistical Significance**\n    For an observed overlap of $k$ genes, enrichment is typically assessed by calculating an upper-tail $p$-value. This is the probability of observing an overlap of at least $k$ genes under the null hypothesis of no association.\n    $$\n    p = \\mathbb{P}(X \\ge k) = \\sum_{i=k}^{\\min(M,K)} \\mathbb{P}(X=i)\n    $$\n    This is also known as the survival function (SF), often computed as $1 - \\mathbb{P}(X \\le k-1)$. An observation is deemed statistically significant if this $p$-value is less than a predefined significance level $\\alpha$.\n\n3.  **Modeling Signal Decay due to Noise**\n    The problem introduces a noise model to simulate the degradation of an initial, enriched signal. Starting with an initial overlap of $k_0$ genes in the selected set of size $K$, a fraction $f$ of these $K$ genes is replaced by genes drawn uniformly at random from the entire universe of $N$ genes.\n    The expected number of pathway genes in the selected set after this replacement, denoted $k(f)$, can be expressed as a linear interpolation between the initial state (at $f=0$) and the expected state under complete randomization (at $f=1$). The expected number of pathway genes in a random set of size $K$ is the null expectation $\\mathbb{E}[X] = K \\cdot M/N$.\n    - The $(1-f)K$ genes that are *not* replaced contribute $(1-f)k_0$ pathway genes on average (assuming the $k_0$ pathway genes are drawn from the original enriched set).\n    - The $fK$ newly-drawn genes contribute $fK \\cdot (M/N)$ pathway genes on average.\n    The problem statement provides the simplified expectation formula for the resulting overlap, which combines these effects:\n    $$\n    k(f) = (1 - f)k_0 + f \\frac{KM}{N}\n    $$\n    Since the hypergeometric test requires an integer count for the overlap, we define a deterministic integer proxy $k^\\star(f)$ by rounding the expected value $k(f)$ to the nearest integer, with halves rounded to the nearest even integer.\n    $$\n    k^\\star(f) = \\mathrm{round}(k(f))\n    $$\n    This rounding rule corresponds to the behavior of Python's built-in `round()` function since version 3 and `numpy.round()`.\n\n4.  **Algorithmic Procedure for Finding $f^\\star$**\n    The core task is to find the smallest noise fraction $f^\\star$ from a discrete grid of values $\\{0, \\Delta f, 2\\Delta f, \\dots, 1\\}$ for which the enrichment $p$-value is no longer significant, i.e., $p(f) \\ge \\alpha$.\n    The algorithm is as follows for each test case $(N, M, K, k_0, \\alpha, \\Delta f)$:\n    a. Construct the grid of noise fractions $f \\in [0, 1]$ with step size $\\Delta f$.\n    b. Calculate the expected overlap under the null hypothesis: $E = K \\cdot M / N$.\n    c. Iterate through the grid values of $f$, starting from $f=0$.\n    d. For each $f$:\n        i. Calculate the expected overlap after noise: $k(f) = (1 - f)k_0 + f \\cdot E$.\n        ii. Determine the integer overlap: $k^\\star(f) = \\mathrm{int}(\\mathrm{round}(k(f)))$.\n        iii. Calculate the $p$-value: $p(f) = \\mathbb{P}(X \\ge k^\\star(f))$, where $X \\sim \\text{Hypergeometric}(N, M, K)$. This is computed using the survival function of the hypergeometric distribution: `scipy.stats.hypergeom.sf(k_star - 1, N, M, K)`.\n        iv. Check the significance condition: If $p(f) \\ge \\alpha$, then the critical noise fraction has been found. Set $f^\\star = f$ and terminate the search for this test case.\n    e. If the loop completes without the condition being met for any $f$ up to and including $f=1$, the problem specifies that $f^\\star=1$. This is handled by initializing $f^\\star$ to $1$ or by ensuring the loop correctly finds the value at $f=1$ if it meets the criterion. Our implementation will search the full grid and break upon finding the first suitable $f$. An initial default of $f^\\star = 1.0$ covers the case where the condition is never met.\n\n    This procedure systematically evaluates the decay of statistical significance and correctly identifies the required threshold $f^\\star$ according to the problem's definition. The final value for each test case is then rounded to three decimal places for reporting.",
            "answer": "```python\nimport numpy as np\nfrom scipy.stats import hypergeom\n\ndef solve():\n    \"\"\"\n    Computes the smallest noise fraction f_star for which a gene set enrichment\n    signal becomes non-significant, for a series of test cases.\n    \"\"\"\n    # Test cases defined as (N, M, K, k_0, alpha, delta_f) tuples.\n    # N: universe size, M: pathway size, K: selected set size\n    # k_0: initial overlap, alpha: significance level, delta_f: noise grid step\n    test_cases = [\n        (20000, 300, 150, 60, 0.05, 0.01),\n        (20000, 300, 150, 2, 0.05, 0.01),\n        (500, 80, 40, 18, 0.01, 0.005),\n        (10000, 1000, 500, 120, 0.05, 0.02),\n        (100, 10, 10, 7, 0.001, 0.05)\n    ]\n\n    results = []\n    \n    for case in test_cases:\n        N, M, K, k_0, alpha, delta_f = case\n\n        # The number of steps for the grid, ensuring 1.0 is included.\n        # Add a small epsilon to avoid floating point inaccuracies with the division.\n        num_steps = int(1.0 / delta_f + 1e-9) + 1\n        f_grid = np.linspace(0.0, 1.0, num_steps)\n\n        # Expected overlap under the null hypothesis (random selection)\n        null_expectation = K * M / N\n        \n        # Initialize f_star to 1.0. This value will be used if the p-value\n        # remains below alpha for all f on the grid.\n        f_star = 1.0\n\n        for f in f_grid:\n            # Calculate the expected overlap k(f) after applying noise fraction f.\n            # This is a linear interpolation between the initial overlap k_0 and\n            # the null expectation.\n            k_f = (1.0 - f) * k_0 + f * null_expectation\n\n            # Round k(f) to the nearest integer, with halves rounded to the\n            # nearest even integer, as specified. np.round and then casting to int\n            # achieves this.\n            k_star = int(np.round(k_f))\n\n            # The p-value is the probability of observing k_star or more overlaps,\n            # which is the survival function (1 - CDF).\n            # hypergeom.sf(k-1, N, M, K) computes P(X >= k).\n            # scipy.stats.hypergeom takes parameters (M, n, k), which in our\n            # notation are (total population, number of type I items, number of draws)\n            # -> (N, M, K).\n            if k_star > min(M, K):\n                # If the required overlap is impossibly large, p-value is 0.\n                p_value = 0.0\n            else:\n                p_value = hypergeom.sf(k_star - 1, N, M, K)\n\n            # Check if the p-value meets or exceeds the significance threshold alpha.\n            # If so, we have found the smallest f on the grid that satisfies the\n            # condition.\n            if p_value >= alpha:\n                f_star = f\n                break\n        \n        results.append(f_star)\n\n    # Format the results as a list of strings, each rounded to 3 decimal places.\n    formatted_results = [f\"{res:.3f}\" for res in results]\n    \n    # Print the final output in the required single-line format.\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The validity of any enrichment analysis hinges on a crucial, and often overlooked, assumption: the correct definition of the background gene \"universe\". This final practice addresses a critical real-world pitfall where an improperly chosen universe can lead to misleading results. Through this coding exercise, you will quantify how altering the background set changes the resulting $p$-values, learning firsthand why careful consideration of the experimental context is paramount for sound biological interpretation .",
            "id": "2392318",
            "problem": "You are given a framework to quantify how using a mis-specified \"universe\" of genes alters enrichment significance in a one-sided over-representation analysis. Consider finite sets of genes where a \"universe\" is a set of genes from which a selection is made without replacement, a \"term\" is a subset of the universe that defines success states, and a \"selected set\" is the observed subset of genes of interest. For a given configuration, let $N$ be the size of the correct universe, $K$ be the number of universe genes annotated to the term, $n$ be the number of selected genes that belong to the universe, and $k$ be the number of selected genes that are annotated to the term. Define the $p$-value for enrichment as the probability, under random sampling without replacement of $n$ genes from $N$ with $K$ successes available, of observing at least $k$ successes. Formally, for given $N$, $K$, $n$, and $k$, the enrichment $p$-value is\n$$\np_{\\text{true}}(N,K,n,k) \\equiv \\sum_{i=k}^{\\min(n,K)} \\frac{\\binom{K}{i}\\binom{N-K}{n-i}}{\\binom{N}{n}}.\n$$\nNow suppose a mis-specified \"expressed\" universe is used that only includes genes deemed expressed. Let $N'$ be the size of this mis-specified universe, $K'$ be the number of genes annotated to the term within this mis-specified universe, $n'$ be the number of selected genes within this mis-specified universe, and $k'$ be the number of selected genes annotated to the term within this mis-specified universe. The corresponding enrichment $p$-value is\n$$\np_{\\text{mis}}(N',K',n',k') \\equiv \\sum_{i=k'}^{\\min(n',K')} \\frac{\\binom{K'}{i}\\binom{N'-K'}{n'-i}}{\\binom{N'}{n'}}.\n$$\nFor each test case below, compute the base-$10$ logarithm of the ratio of these $p$-values,\n$$\nr \\equiv \\log_{10}\\!\\left(\\frac{p_{\\text{mis}}(N',K',n',k')}{p_{\\text{true}}(N,K,n,k)}\\right).\n$$\nPositive $r$ indicates that the mis-specified universe yields a larger $p$-value (less significant), negative $r$ indicates a smaller $p$-value (more significant), and $r=0$ indicates no change. Return each $r$ rounded to $6$ decimal places as a decimal number.\n\nTest suite of parameter values:\n- Case A: $N=20000$, $K=500$, $n=200$, $k=12$; $N'=12000$, $K'=320$, $n'=180$, $k'=10$.\n- Case B: $N=15000$, $K=600$, $n=100$, $k=0$; $N'=9000$, $K'=400$, $n'=80$, $k'=0$.\n- Case C: $N=18000$, $K=150$, $n=40$, $k=30$; $N'=11000$, $K'=120$, $n'=35$, $k'=28$.\n- Case D: $N=25000$, $K=60$, $n=20$, $k=20$; $N'=10000$, $K'=30$, $n'=12$, $k'=12$.\n- Case E: $N=12000$, $K=400$, $n=150$, $k=8$; $N'=12000$, $K'=400$, $n'=150$, $k'=8$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the above cases, with each value rounded to $6$ decimal places (for example, $[x_A,x_B,x_C,x_D,x_E]$ where each $x_\\cdot$ is a decimal number).",
            "solution": "The problem statement has been subjected to validation and is found to be valid. It is scientifically grounded, well-posed, and objective. The problem describes a standard procedure in computational biology—over-representation analysis—and correctly formulates it as a hypergeometric test. The core of the task is to quantify the change in statistical significance when the background set of genes (the \"universe\") is altered, a known and important issue in bioinformatics. All provided parameters are consistent and sufficient for a unique solution. We therefore proceed to derive the computational solution.\n\nThe fundamental principle is the hypergeometric probability distribution. This distribution models sampling without replacement. Given a population of size $N$ containing $K$ items of interest (\"successes\"), the probability of drawing a sample of size $n$ that contains exactly $i$ successes is given by the probability mass function (PMF):\n$$\nP(X=i) = \\frac{\\binom{K}{i}\\binom{N-K}{n-i}}{\\binom{N}{n}}\n$$\nwhere $X$ is the random variable representing the count of successes in the sample.\n\nThe problem defines the enrichment $p$-value as the probability of observing at least $k$ successes. This corresponds to the tail probability of the distribution, also known as the survival function (SF). It is calculated by summing the probabilities of observing $k, k+1, \\dots, \\min(n,K)$ successes:\n$$\np(N,K,n,k) = P(X \\ge k) = \\sum_{i=k}^{\\min(n,K)} P(X=i)\n$$\nThis is the value defined as $p_{\\text{true}}$ and $p_{\\text{mis}}$ for the \"true\" and \"mis-specified\" parameter sets, respectively.\n\nDirect computation of the binomial coefficients, $\\binom{a}{b}$, is numerically unstable and computationally infeasible for the large numbers involved (e.g., $N=20000$). The correct computational approach is to use a library function that implements the hypergeometric distribution's properties using log-gamma functions for stability. The survival function, $P(X \\ge k)$, is equivalent to $1 - P(X \\le k-1)$, which is $SF(k-1)$. Most scientific computing libraries provide this function. We will use `scipy.stats.hypergeom.sf` from the `scipy` library. The parameters for this function are: the quantile $k-1$, the population size $M$ (our $N$), the total number of successes in the population $n$ (our $K$), and the sample size $N$ (our $n$).\n\nThe algorithm is as follows:\n1.  For each test case, we are given a \"true\" parameter set $(N, K, n, k)$ and a \"mis-specified\" set $(N', K', n', k')$.\n2.  The $p$-value for the true case, $p_{\\text{true}}$, is calculated using the hypergeometric survival function with parameters corresponding to the true universe: `hypergeom.sf(k-1, M=N, n=K, N=n)`.\n3.  Similarly, the $p$-value for the mis-specified case, $p_{\\text{mis}}$, is calculated using its corresponding parameters: `hypergeom.sf(k'-1, M=N', n=K', N=n')`.\n4.  The objective is to compute the quantity $r \\equiv \\log_{10}\\!\\left(\\frac{p_{\\text{mis}}}{p_{\\text{true}}}\\right)$. This is computed as $\\log_{10}(p_{\\text{mis}}) - \\log_{10}(p_{\\text{true}})$ to maintain numerical precision.\n5.  Two special cases are noteworthy. First, for Case B, where $k=0$ and $k'=0$, the $p$-value is the sum over all possible outcomes, which must be $1$. Thus, $p_{\\text{true}}=1$ and $p_{\\text{mis}}=1$, leading to $r=0$. The survival function `sf(k-1)` correctly handles this, as for $k=0$, it evaluates `sf(-1)`, which is defined as $1$.\n6.  Second, for Case E, the \"true\" and \"mis-specified\" parameters are identical. Consequently, $p_{\\text{true}} = p_{\\text{mis}}$, the ratio is $1$, and $r = \\log_{10}(1) = 0$. This serves as a trivial check on the implementation.\n7.  The final value of $r$ for each case is rounded to $6$ decimal places and presented in the required list format.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import hypergeom\n\ndef solve():\n    \"\"\"\n    Computes the log-ratio of p-values from a mis-specified universe\n    in a hypergeometric test for over-representation analysis.\n    \"\"\"\n\n    # Test cases are defined as tuples of:\n    # (N, K, n, k, N', K', n', k')\n    test_cases = [\n        # Case A\n        (20000, 500, 200, 12, 12000, 320, 180, 10),\n        # Case B\n        (15000, 600, 100, 0, 9000, 400, 80, 0),\n        # Case C\n        (18000, 150, 40, 30, 11000, 120, 35, 28),\n        # Case D\n        (25000, 60, 20, 20, 10000, 30, 12, 12),\n        # Case E\n        (12000, 400, 150, 8, 12000, 400, 150, 8),\n    ]\n\n    def calculate_p_value(N, K, n, k):\n        \"\"\"\n        Calculates the p-value for over-representation using the\n        hypergeometric survival function.\n\n        Args:\n            N (int): Population size (universe).\n            K (int): Number of successes in population (term size).\n            n (int): Sample size (selected set size).\n            k (int): Number of successes in sample.\n\n        Returns:\n            float: The p-value, P(X >= k).\n        \"\"\"\n        # The probability P(X >= k) is calculated by the survival function (sf)\n        # evaluated at k-1.\n        # Parameters for scipy.stats.hypergeom:\n        # M: The total number of items (our N, universe size).\n        # n: The total number of type I items (our K, term size).\n        # N: The number of items drawn (our n, selected set size).\n        return hypergeom.sf(k - 1, M=N, n=K, N=n)\n\n    results = []\n    for case in test_cases:\n        N, K, n, k, N_prime, K_prime, n_prime, k_prime = case\n\n        # Calculate p-value for the correct universe\n        p_true = calculate_p_value(N, K, n, k)\n\n        # Calculate p-value for the mis-specified universe\n        p_mis = calculate_p_value(N_prime, K_prime, n_prime, k_prime)\n        \n        # Guard against zero p-values to avoid issues with log.\n        # Based on problem validation, p_true is non-zero for all test cases.\n        if p_true == 0.0 or p_mis == 0.0:\n            if p_true == p_mis: # Both are 0\n                r = 0.0 # Define log(0/0) as 0, indicating no relative change\n            elif p_mis == 0.0:\n                 r = -np.inf # Transition to zero p-value\n            else: # p_true is 0, p_mis is not\n                 r = np.inf # Transition from impossible to possible\n        else:\n            # Compute the base-10 logarithm of the ratio\n            r = np.log10(p_mis / p_true)\n\n        results.append(r)\n\n    # Format output as a list of strings, with each number rounded to 6 decimal places.\n    # The f-string formatting handles rounding as required.\n    formatted_results = [f\"{res:.6f}\" for res in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}