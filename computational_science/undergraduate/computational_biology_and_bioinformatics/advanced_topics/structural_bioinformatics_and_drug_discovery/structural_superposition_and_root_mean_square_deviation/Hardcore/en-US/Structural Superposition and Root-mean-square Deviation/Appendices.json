{
    "hands_on_practices": [
        {
            "introduction": "The root-mean-square deviation ($RMSD$) provides a single, convenient number to summarize the difference between two structures. However, it is crucial to remember that it is an average. This exercise  is a thought experiment to probe the limits of this metric, challenging you to calculate the maximum possible deviation a single atom can have, given a modest overall $RMSD$. Solving this will build a powerful intuition about how to interpret $RMSD$ values and appreciate that large, localized differences can be masked by this global average.",
            "id": "2431541",
            "problem": "Two conformations of the same protein, each containing $100$ residues, are optimally aligned by a rigid-body superposition using only the carbon alpha ($\\mathrm{C}\\alpha$) atoms. The root-mean-square deviation (RMSD) across the $N=100$ matched $\\mathrm{C}\\alpha$ atoms is measured to be $3.0$ Å. By definition, the root-mean-square deviation (RMSD) over $N$ atoms is\n$$\n\\mathrm{RMSD} \\equiv \\sqrt{\\frac{1}{N}\\sum_{i=1}^{N} \\|\\Delta \\mathbf{r}_{i}\\|^{2}},\n$$\nwhere $\\Delta \\mathbf{r}_{i}$ is the displacement vector of atom $i$ between the two conformations after optimal superposition, and $\\|\\cdot\\|$ denotes the Euclidean norm. Without assuming any additional constraints beyond the definition above, determine the theoretical maximum possible value of $\\|\\Delta \\mathbf{r}_{j}\\|$ for a single atom $j$ that is consistent with the given RMSD. Give an exact value and express your answer in ångströms (Å). Do not include units in your final answer.",
            "solution": "The problem statement must first be subjected to rigorous validation.\n\nStep 1: Extract Givens.\nThe givens are:\n- The number of residues is $100$.\n- The atoms used for superposition and RMSD calculation are the carbon alpha ($\\mathrm{C}\\alpha$) atoms.\n- The number of matched atoms for the RMSD calculation is $N=100$.\n- The measured root-mean-square deviation is $\\mathrm{RMSD} = 3.0$ Å.\n- The definition of RMSD is given as $\\mathrm{RMSD} \\equiv \\sqrt{\\frac{1}{N}\\sum_{i=1}^{N} \\|\\Delta \\mathbf{r}_{i}\\|^{2}}$, where $\\Delta \\mathbf{r}_{i}$ is the displacement vector for atom $i$.\n- The task is to find the theoretical maximum possible value of $\\|\\Delta \\mathbf{r}_{j}\\|$ for a single, arbitrary atom $j$.\n- The problem states we must not assume any additional constraints beyond the provided definition.\n\nStep 2: Validate Using Extracted Givens.\nThe problem is evaluated against the validation criteria.\n- **Scientifically Grounded:** The problem is based on the standard definition of Root-Mean-Square Deviation (RMSD), a fundamental concept in structural bioinformatics for comparing macromolecular structures. The values provided ($N=100$ atoms, $\\mathrm{RMSD}=3.0$ Å) are physically realistic.\n- **Well-Posed:** The problem is a well-posed mathematical extremum problem. It asks for the maximum value of one component of a set, given a constraint on the root-mean-square of the entire set. A unique solution exists.\n- **Objective:** The problem is stated in precise, objective language. There is no ambiguity.\n\nThe problem exhibits none of the flaws listed for invalidity. It is scientifically sound, formalizable, complete, and well-posed. The condition of \"optimal superposition\" establishes the context in which the RMSD was measured, but the core of the problem is a mathematical question about the properties of the RMSD metric itself, as explicitly stated by the constraint \"Without assuming any additional constraints beyond the definition above\".\n\nStep 3: Verdict and Action.\nThe problem is valid. A solution will be derived.\n\nThe solution proceeds from the definition of RMSD. We are given:\n$$\n\\mathrm{RMSD} = \\sqrt{\\frac{1}{N}\\sum_{i=1}^{N} d_{i}^{2}}\n$$\nwhere for notational simplicity, we define $d_{i} \\equiv \\|\\Delta \\mathbf{r}_{i}\\|$ as the scalar magnitude of the displacement for atom $i$. We are given $N=100$ and $\\mathrm{RMSD}=3.0$.\n\nSubstituting the given values into the definition:\n$$\n3.0 = \\sqrt{\\frac{1}{100}\\sum_{i=1}^{100} d_{i}^{2}}\n$$\nTo analyze the sum, we square both sides of the equation:\n$$\n(3.0)^{2} = \\frac{1}{100}\\sum_{i=1}^{100} d_{i}^{2}\n$$\n$$\n9.0 = \\frac{1}{100}\\sum_{i=1}^{100} d_{i}^{2}\n$$\nThis provides a fixed constraint on the sum of the squared displacements:\n$$\n\\sum_{i=1}^{100} d_{i}^{2} = 9.0 \\times 100 = 900\n$$\nThe unit of this quantity is Å$^{2}$.\n\nOur objective is to determine the theoretical maximum possible value for a single displacement magnitude, which we denote as $d_{j}$ for an arbitrary atom $j$. We can isolate the term $d_{j}^{2}$ from the sum:\n$$\n\\sum_{i=1}^{100} d_{i}^{2} = d_{j}^{2} + \\sum_{i \\neq j} d_{i}^{2}\n$$\nSubstituting this back into our constraint equation:\n$$\nd_{j}^{2} + \\sum_{i \\neq j} d_{i}^{2} = 900\n$$\nTo maximize the value of $d_{j}$, and consequently $d_{j}^{2}$ (since $d_{j}$ is a non-negative magnitude), we must minimize the value of the term being subtracted from the constant $900$. That is, we must minimize the sum of the squared displacements of all other atoms, $\\sum_{i \\neq j} d_{i}^{2}$.\n\nBy definition, the magnitude of a vector $d_{i} = \\|\\Delta \\mathbf{r}_{i}\\|$ must be non-negative, $d_{i} \\ge 0$. Therefore, the square of the magnitude must also be non-negative, $d_{i}^{2} \\ge 0$. The minimum possible value for each term $d_{i}^{2}$ is $0$. This corresponds to a physical situation where the displacement of atom $i$ is zero.\n\nThe minimum value of the sum $\\sum_{i \\neq j} d_{i}^{2}$ is achieved when every term in the sum is at its minimum value. Thus, we set $d_{i}^{2} = 0$ for all $i \\neq j$.\n$$\n\\min\\left(\\sum_{i \\neq j} d_{i}^{2}\\right) = \\sum_{i \\neq j} 0 = 0\n$$\nSubstituting this minimum value back into the equation for $d_{j}^{2}$:\n$$\n(d_{j}^{2})_{\\max} + 0 = 900\n$$\n$$\n(d_{j}^{2})_{\\max} = 900\n$$\nTaking the square root to find the maximum possible displacement magnitude, $(d_{j})_{\\max}$:\n$$\n(d_{j})_{\\max} = \\sqrt{900} = 30\n$$\nThis result corresponds to a scenario where $N-1 = 99$ atoms are perfectly superimposed ($d_{i}=0$ for $i \\neq j$) and the entire sum of squared deviations is contributed by the single atom $j$. This is the theoretical upper limit for the deviation of any single atom, given the overall RMSD. The value is $30$ Å.",
            "answer": "$$\n\\boxed{30}\n$$"
        },
        {
            "introduction": "Moving from theory to a common bioinformatics task, we now tackle the comparison of protein complexes with identical subunits. When comparing two conformations of a homodimer, the one-to-one correspondence of atoms is ambiguous; should subunit A be compared to A, or could it align better with B? This hands-on coding challenge  requires you to implement a superposition algorithm and correctly handle this ambiguity to find the true, minimal $RMSD$ by testing all relevant subunit mappings.",
            "id": "2431556",
            "problem": "You will implement a program to compute the minimal Root-Mean-Square Deviation (RMSD) between two protein homodimer conformations under rigid-body superposition. The comparison must account for the ambiguity of identical subunits: for each homodimer comparison, you must evaluate both the direct correspondence (subunit $A$ mapped to subunit $A$, subunit $B$ mapped to subunit $B$) and the swapped correspondence (subunit $A$ mapped to subunit $B$, subunit $B$ mapped to subunit $A$), and report the minimal RMSD over these two possibilities.\n\nUse the following fundamental base and definitions. A rigid-body superposition seeks a $3 \\times 3$ rotation matrix $\\mathbf{R}$ with $\\det(\\mathbf{R}) = +1$ and an offset vector $\\mathbf{t} \\in \\mathbb{R}^3$ that minimize the mean squared Euclidean distance between corresponding points. Given $N$ corresponding points $\\{\\mathbf{x}_i\\}_{i=1}^N$ (reference) and $\\{\\mathbf{y}_i\\}_{i=1}^N$ (target), the objective is to minimize\n$$\n\\frac{1}{N} \\sum_{i=1}^N \\left\\| \\mathbf{x}_i - \\left(\\mathbf{R}\\,\\mathbf{y}_i + \\mathbf{t}\\right) \\right\\|_2^2\n$$\nover all admissible $\\mathbf{R}$ and $\\mathbf{t}$. The Root-Mean-Square Deviation (RMSD) is then the square root of this minimum mean squared value:\n$$\n\\mathrm{RMSD} \\;=\\; \\sqrt{ \\frac{1}{N} \\sum_{i=1}^N \\left\\| \\mathbf{x}_i - \\left(\\mathbf{R}\\,\\mathbf{y}_i + \\mathbf{t}\\right) \\right\\|_2^2 }.\n$$\nYou must determine the optimal rigid-body superposition from first principles using standard linear algebra and the orthogonality of $\\mathbf{R}$ (no non-rigid distortions, no reflections), and then compute the RMSD.\n\nFor each test case, each homodimer consists of two subunits with equal number of atoms. Denote the reference homodimer by ordered subunits $\\mathcal{A}_{\\mathrm{ref}} = \\{\\mathbf{a}_k\\}_{k=1}^{n}$ and $\\mathcal{B}_{\\mathrm{ref}} = \\{\\mathbf{b}_k\\}_{k=1}^{n}$, and the target homodimer by ordered subunits $\\mathcal{A}_{\\mathrm{tar}} = \\{\\mathbf{a}'_k\\}_{k=1}^{n}$ and $\\mathcal{B}_{\\mathrm{tar}} = \\{\\mathbf{b}'_k\\}_{k=1}^{n}$. You must evaluate two correspondences:\n- Direct: $\\left(\\mathcal{A}_{\\mathrm{ref}} \\parallel \\mathcal{A}_{\\mathrm{tar}}\\right)$ concatenated with $\\left(\\mathcal{B}_{\\mathrm{ref}} \\parallel \\mathcal{B}_{\\mathrm{tar}}\\right)$.\n- Swapped: $\\left(\\mathcal{A}_{\\mathrm{ref}} \\parallel \\mathcal{B}_{\\mathrm{tar}}\\right)$ concatenated with $\\left(\\mathcal{B}_{\\mathrm{ref}} \\parallel \\mathcal{A}_{\\mathrm{tar}}\\right)$.\nFor each correspondence, perform a single optimal rigid-body superposition over the concatenated point sets and compute the RMSD. Report the smaller of the two RMSDs.\n\nAngle units: all angles given below are in radians. There are no physical units involved. Your program must round each reported RMSD to exactly $6$ decimal places.\n\nTest suite. Implement the following five test cases. All vectors are $3$-dimensional row vectors. Define the base subunit $\\mathcal{A}_{\\mathrm{base}}$ with $n = 5$ atoms as\n- $\\mathbf{p}_1 = (\\,2.0,\\, 0.5,\\, 0.0\\,)$,\n- $\\mathbf{p}_2 = (\\,2.5,\\,-0.5,\\, 0.5\\,)$,\n- $\\mathbf{p}_3 = (\\,1.5,\\, 0.2,\\,-0.3\\,)$,\n- $\\mathbf{p}_4 = (\\,2.2,\\, 1.0,\\, 0.7\\,)$,\n- $\\mathbf{p}_5 = (\\,1.8,\\,-0.8,\\,-0.6\\,)$.\n\nLet $\\mathcal{A}_{\\mathrm{base}} = [\\mathbf{p}_1,\\mathbf{p}_2,\\mathbf{p}_3,\\mathbf{p}_4,\\mathbf{p}_5]$ and define the rotation about the $z$-axis by angle $\\theta$ as\n$$\n\\mathbf{R}_z(\\theta) \\;=\\;\n\\begin{bmatrix}\n\\cos\\theta  -\\sin\\theta  0\\\\\n\\sin\\theta  \\cos\\theta  0\\\\\n0  0  1\n\\end{bmatrix}.\n$$\nSimilarly, define the rotation about the $x$-axis by angle $\\phi$ as\n$$\n\\mathbf{R}_x(\\phi) \\;=\\;\n\\begin{bmatrix}\n1  0  0\\\\\n0  \\cos\\phi  -\\sin\\phi\\\\\n0  \\sin\\phi  \\cos\\phi\n\\end{bmatrix}.\n$$\n\nConstruct the reference and target dimers for each test case as follows.\n\n- Test case $1$ (perfectly symmetric $C_2$ homodimer, identical target):\n  - Reference: $\\mathcal{A}_{\\mathrm{ref}} = \\mathcal{A}_{\\mathrm{base}}$, $\\mathcal{B}_{\\mathrm{ref}} = \\mathcal{A}_{\\mathrm{base}}\\,\\mathbf{R}_z(\\pi)$.\n  - Target: $\\mathcal{A}_{\\mathrm{tar}} = \\mathcal{A}_{\\mathrm{ref}}$, $\\mathcal{B}_{\\mathrm{tar}} = \\mathcal{B}_{\\mathrm{ref}}$.\n\n- Test case $2$ (perfectly symmetric $C_2$ homodimer, subunits swapped in target, plus global rigid motion):\n  - Reference: as in test case $1$.\n  - Let $\\mathbf{R}_g = \\mathbf{R}_z(\\pi/4)$ and $\\mathbf{t}_g = (\\,1.25,\\,-0.75,\\,0.5\\,)$.\n  - Target before global motion: swap subunits, i.e., $\\tilde{\\mathcal{A}}_{\\mathrm{tar}} = \\mathcal{B}_{\\mathrm{ref}}$, $\\tilde{\\mathcal{B}}_{\\mathrm{tar}} = \\mathcal{A}_{\\mathrm{ref}}$.\n  - Target after global motion: for every point $\\mathbf{q}$ in $\\tilde{\\mathcal{A}}_{\\mathrm{tar}}$ and $\\tilde{\\mathcal{B}}_{\\mathrm{tar}}$, set $\\mathbf{q} \\leftarrow \\mathbf{q}\\,\\mathbf{R}_g + \\mathbf{t}_g$, to obtain $\\mathcal{A}_{\\mathrm{tar}}$ and $\\mathcal{B}_{\\mathrm{tar}}$.\n\n- Test case $3$ (symmetric, swapped target with small deterministic perturbations):\n  - Start from test case $2$ target $(\\mathcal{A}_{\\mathrm{tar}}, \\mathcal{B}_{\\mathrm{tar}})$.\n  - For each subunit independently, for atom index $k \\in \\{0,1,2,3,4\\}$ (zero-based within each subunit), add a perturbation vector\n    $$\n    \\boldsymbol{\\delta}_k \\;=\\; \\varepsilon \\cdot \\big(\\cos k,\\; \\sin k,\\; \\cos(2k)\\big)\n    $$\n    with $\\varepsilon = 10^{-2}$. Apply this to the corresponding atom in both $\\mathcal{A}_{\\mathrm{tar}}$ and $\\mathcal{B}_{\\mathrm{tar}}$ to obtain the perturbed target subunits.\n\n- Test case $4$ (asymmetric homodimer; unswapped target under a different global rigid motion):\n  - Reference: $\\mathcal{A}_{\\mathrm{ref}} = \\mathcal{A}_{\\mathrm{base}}$, and $\\mathcal{B}_{\\mathrm{ref}} = \\mathcal{A}_{\\mathrm{base}}\\,\\mathbf{R}_z(2\\pi/3) + \\mathbf{d}$, where $\\mathbf{d} = (\\,0.3,\\,-0.4,\\,0.2\\,)$.\n  - Let $\\mathbf{R}_g' = \\mathbf{R}_x(\\pi/6)$ and $\\mathbf{t}_g' = (\\,-0.5,\\,0.2,\\,-0.1\\,)$.\n  - Target: apply the same global motion to both subunits without swapping: $\\mathcal{A}_{\\mathrm{tar}} = \\mathcal{A}_{\\mathrm{ref}}\\,\\mathbf{R}_g' + \\mathbf{t}_g'$, $\\mathcal{B}_{\\mathrm{tar}} = \\mathcal{B}_{\\mathrm{ref}}\\,\\mathbf{R}_g' + \\mathbf{t}_g'$.\n\n- Test case $5$ (degenerate geometry: colinear atoms; symmetric, swapped target with global rotation):\n  - Define $\\mathcal{A}_{\\mathrm{line}}$ with $n=4$ atoms:\n    - $\\mathbf{u}_1 = (\\,0.0,\\,0.0,\\,0.0\\,)$,\n    - $\\mathbf{u}_2 = (\\,1.0,\\,0.0,\\,0.0\\,)$,\n    - $\\mathbf{u}_3 = (\\,2.0,\\,0.0,\\,0.0\\,)$,\n    - $\\mathbf{u}_4 = (\\,3.0,\\,0.0,\\,0.0\\,)$.\n  - Reference: $\\mathcal{A}_{\\mathrm{ref}} = \\mathcal{A}_{\\mathrm{line}}$, $\\mathcal{B}_{\\mathrm{ref}} = \\mathcal{A}_{\\mathrm{line}}\\,\\mathbf{R}_z(\\pi)$.\n  - Let $\\mathbf{R}_g'' = \\mathbf{R}_z(\\pi/2)$ and $\\mathbf{t}_g'' = (\\,0.0,\\,0.0,\\,0.0\\,)$.\n  - Target: swap subunits and apply the global rotation: $\\mathcal{A}_{\\mathrm{tar}} = \\mathcal{B}_{\\mathrm{ref}}\\,\\mathbf{R}_g'' + \\mathbf{t}_g''$, $\\mathcal{B}_{\\mathrm{tar}} = \\mathcal{A}_{\\mathrm{ref}}\\,\\mathbf{R}_g'' + \\mathbf{t}_g''$.\n\nImplementation requirements:\n- For each test case, construct the concatenated point sets for the direct and swapped correspondences as described, determine the optimal rigid-body superposition that minimizes the mean squared distance, compute the RMSD for each correspondence, and keep the smaller RMSD.\n- Your program must output a single line containing the five RMSD values, in the order of test cases $1$ through $5$, rounded to exactly $6$ decimal places, as a comma-separated list enclosed in square brackets (for example, \"[0.000000,0.000000,0.012345,0.000000,0.000000]\").",
            "solution": "The user has provided a well-defined problem in computational structural biology. The task is to calculate the minimal Root-Mean-Square Deviation (RMSD) between two homodimeric protein conformations. The core of the problem lies in recognizing and handling the inherent ambiguity in subunit correspondence. For a homodimer, one must consider both the direct mapping of subunits and the swapped mapping, and the final answer is the minimum of the two resulting RMSD values.\n\nThe problem is scientifically and mathematically sound. It requires implementing the Kabsch algorithm for optimal rigid-body superposition. The problem statement specifies that points are row vectors and transformations are applied via post-multiplication (a transformed point is $\\mathbf{p}' = \\mathbf{p}\\mathbf{R} + \\mathbf{t}$).\n\n**Step 1: Optimal Translation**\nThe optimal translation vector $\\mathbf{t}^*$ that minimizes the mean-squared error can be shown to be $\\mathbf{t}^* = \\bar{\\mathbf{x}} - \\bar{\\mathbf{y}}\\mathbf{R}$, where $\\bar{\\mathbf{x}}$ and $\\bar{\\mathbf{y}}$ are the centroids of the reference and target point sets. This step effectively decouples translation from rotation, reducing the problem to finding the optimal rotation for the centered coordinates $\\mathbf{x}'_i = \\mathbf{x}_i - \\bar{\\mathbf{x}}$ and $\\mathbf{y}'_i = \\mathbf{y}_i - \\bar{\\mathbf{y}}$. The objective becomes minimizing $\\sum_{i=1}^N \\left\\| \\mathbf{x}'_i - \\mathbf{y}'_i\\mathbf{R} \\right\\|^2$.\n\n**Step 2: Optimal Rotation**\nMinimizing the squared error is equivalent to maximizing the term $\\sum_{i=1}^N \\mathbf{x}'_i \\cdot (\\mathbf{y}'_i\\mathbf{R})$. This can be expressed using the trace operator as maximizing $\\text{Tr}\\left( \\mathbf{R}^T \\sum_{i=1}^N \\mathbf{y}'_i^T \\mathbf{x}'_i \\right)$. Let the $3 \\times 3$ covariance matrix be $\\mathbf{H} = \\sum_{i=1}^N \\mathbf{y}'_i^T \\mathbf{x}'_i$. If $\\mathbf{X}'$ and $\\mathbf{Y}'$ are $N \\times 3$ matrices of the centered row vectors, then $\\mathbf{H} = \\mathbf{Y}'^T \\mathbf{X}'$. The problem is to maximize $\\text{Tr}(\\mathbf{R}^T\\mathbf{H})$.\n\nWe use the Singular Value Decomposition (SVD) of the covariance matrix: $\\mathbf{H} = \\mathbf{U}\\mathbf{S}\\mathbf{V}^T$. The trace is maximized when $\\mathbf{R}^T = \\mathbf{V}\\mathbf{U}^T$. Therefore, the optimal rotation matrix is:\n$$ \\mathbf{R}_{\\text{opt}} = \\mathbf{U}\\mathbf{V}^T $$\n\n**Step 3: Handling Reflections**\nThe problem requires a pure rotation ($\\det(\\mathbf{R}) = +1$). If the SVD procedure results in $\\det(\\mathbf{R}_{\\text{opt}}) = -1$ (a reflection), we must find the closest proper rotation. This is done by effectively flipping the sign of the component related to the smallest singular value. If $\\det(\\mathbf{U}\\mathbf{V}^T) = -1$, the corrected proper rotation is:\n$$ \\mathbf{R}_{\\text{opt}} = \\mathbf{U}\\mathbf{D}\\mathbf{V}^T \\quad \\text{where} \\quad \\mathbf{D} = \\text{diag}(1, 1, -1) $$\n\n**Step 4: Algorithm for Homodimer RMSD**\nThe complete algorithm is:\n1.  Construct the coordinate matrices for the reference subunits ($\\mathcal{A}_{\\mathrm{ref}}, \\mathcal{B}_{\\mathrm{ref}}$) and target subunits ($\\mathcal{A}_{\\mathrm{tar}}, \\mathcal{B}_{\\mathrm{tar}}$).\n2.  Define the full reference point set $\\mathbf{X} = \\text{vstack}(\\mathcal{A}_{\\mathrm{ref}}, \\mathcal{B}_{\\mathrm{ref}})$.\n3.  **Direct Correspondence**:\n    -   Define target point set $\\mathbf{Y}_{\\text{direct}} = \\text{vstack}(\\mathcal{A}_{\\mathrm{tar}}, \\mathcal{B}_{\\mathrm{tar}})$.\n    -   Compute $\\text{RMSD}_1 = \\text{RMSD}(\\mathbf{X}, \\mathbf{Y}_{\\text{direct}})$ using the Kabsch algorithm.\n4.  **Swapped Correspondence**:\n    -   Define target point set $\\mathbf{Y}_{\\text{swapped}} = \\text{vstack}(\\mathcal{B}_{\\mathrm{tar}}, \\mathcal{A}_{\\mathrm{tar}})$.\n    -   Compute $\\text{RMSD}_2 = \\text{RMSD}(\\mathbf{X}, \\mathbf{Y}_{\\text{swapped}})$.\n5.  The final result for the test case is $\\min(\\text{RMSD}_1, \\text{RMSD}_2)$.\n\nThis procedure is implemented for each of the five test cases, and the final RMSD values are collected and formatted as requested.",
            "answer": "[0.000000,0.000000,0.012247,0.000000,0.000000]"
        },
        {
            "introduction": "Often, when comparing protein structures, we find that they are not globally similar but share a common \"structural core\" while other regions, like loops, are highly variable. A single $RMSD$ over all atoms might be high and misleadingly suggest the proteins are dissimilar. This advanced practice  challenges you to implement an iterative algorithm to identify the largest possible subset of atoms that can be superimposed below a given $RMSD$ threshold, a foundational technique for finding conserved structural motifs.",
            "id": "2431533",
            "problem": "Implement a program that, for each provided pair of three-dimensional point sets with one-to-one atom correspondences, identifies a subset of matched atom indices of maximum possible size such that there exists a rigid-body superposition whose Root-Mean-Square Deviation (RMSD) over that subset is less than or equal to a given threshold. A rigid-body superposition is defined as a rotation by an orthonormal matrix with determinant $+1$ (no reflections or scaling) followed by a translation. The Root-Mean-Square Deviation (RMSD) between two equally sized subsets $\\{ \\mathbf{x}_i \\}_{i \\in S}$ and $\\{ \\mathbf{y}_i \\}_{i \\in S}$ under a rotation $\\mathbf{R}$ and translation $\\mathbf{t}$ is\n$$\n\\mathrm{RMSD}(\\mathbf{R},\\mathbf{t};S) \\;=\\; \\sqrt{\\frac{1}{|S|} \\sum_{i \\in S} \\left\\| \\mathbf{R}\\,\\mathbf{x}_i + \\mathbf{t} - \\mathbf{y}_i \\right\\|_2^2 } \\,.\n$$\nYour task is to determine, for each test case, a subset $S^\\star$ of indices that maximizes $|S|$ subject to $\\min_{\\mathbf{R},\\mathbf{t}} \\mathrm{RMSD}(\\mathbf{R},\\mathbf{t};S) \\le \\tau$, where $\\tau$ is the given threshold, $\\mathbf{R}$ is a rotation matrix with $\\det(\\mathbf{R}) = +1$, and $\\mathbf{t}$ is a translation vector in $\\mathbb{R}^3$. Among all subsets with maximal cardinality, select the one that attains the minimal possible RMSD; if there is still a tie, select the subset with the lexicographically smallest ordered index tuple. Angles are specified in radians. Coordinates are specified in ångströms, and the RMSD must be reported in ångströms, rounded to exactly $6$ decimal places. The threshold constraint uses the condition “less than or equal to.”\n\nAll input data are fixed within this problem; no external input is required. Let the base structure $A$ consist of $N$ atoms with indices $0,1,\\dots,N-1$ and Cartesian coordinates $\\mathbf{x}_i \\in \\mathbb{R}^3$. The corresponding structure $B$ has coordinates $\\mathbf{y}_i \\in \\mathbb{R}^3$ for the same indices.\n\nDefinitions for the base structure $A$ used in all test cases:\n- $N = 8$ atoms with coordinates in ångströms:\n  - Index $0$: $(0.0,\\,0.0,\\,0.0)$\n  - Index $1$: $(1.0,\\,0.0,\\,0.0)$\n  - Index $2$: $(0.0,\\,1.0,\\,0.0)$\n  - Index $3$: $(0.0,\\,0.0,\\,1.0)$\n  - Index $4$: $(1.0,\\,1.0,\\,0.0)$\n  - Index $5$: $(1.0,\\,0.0,\\,1.0)$\n  - Index $6$: $(0.0,\\,1.0,\\,1.0)$\n  - Index $7$: $(1.0,\\,1.0,\\,1.0)$\n\nDefine the following rotation matrices (angles in radians):\n- $\\theta_z = \\pi/6$, $\\theta_x = \\pi/9$.\n- $\\mathbf{R}_z(\\theta_z) = \\begin{bmatrix}\n\\cos\\theta_z  -\\sin\\theta_z  0\\\\\n\\sin\\theta_z  \\cos\\theta_z  0\\\\\n0  0  1\n\\end{bmatrix}$,\n$\\mathbf{R}_x(\\theta_x) = \\begin{bmatrix}\n1  0  0\\\\\n0  \\cos\\theta_x  -\\sin\\theta_x\\\\\n0  \\sin\\theta_x  \\cos\\theta_x\n\\end{bmatrix}$,\nand composite rotation $\\mathbf{R} = \\mathbf{R}_x(\\theta_x)\\,\\mathbf{R}_z(\\theta_z)$.\nDefine translation $\\mathbf{t} = (0.5,\\,-0.3,\\,0.8)$.\n\nConstruct the test suite as follows:\n- Test case $1$ (happy path): Let $B^{(1)}$ be obtained from $A$ by the rigid transform $\\mathbf{R}$ and $\\mathbf{t}$, i.e., for each index $i$, $\\mathbf{y}^{(1)}_i = \\mathbf{R}\\,\\mathbf{x}_i + \\mathbf{t}$. Threshold $\\tau_1 = 10^{-8}$ ångströms.\n- Test case $2$ (outliers present): Start from $B^{(1)}$ and define $B^{(2)}$ by adding a displacement vector $\\mathbf{d} = (3.0,\\,-2.0,\\,1.5)$ ångströms to atoms with indices $1$ and $6$ only: for $i \\in \\{1,6\\}$ set $\\mathbf{y}^{(2)}_i = \\mathbf{y}^{(1)}_i + \\mathbf{d}$, and for all other indices $i$ set $\\mathbf{y}^{(2)}_i = \\mathbf{y}^{(1)}_i$. Threshold $\\tau_2 = 0.05$ ångströms.\n- Test case $3$ (degenerate small set): Define a two-atom structure $A^{(3)}$ with indices $0,1$ and coordinates $(0.0,\\,0.0,\\,0.0)$ and $(2.0,\\,0.0,\\,0.0)$ ångströms, respectively. Define $B^{(3)}$ by applying the same $\\mathbf{R}$ and $\\mathbf{t}$ as above: $\\mathbf{y}^{(3)}_i = \\mathbf{R}\\,\\mathbf{x}^{(3)}_i + \\mathbf{t}$ for $i \\in \\{0,1\\}$. Threshold $\\tau_3 = 10^{-8}$ ångströms.\n\nFor each test case, your program must:\n- Determine the subset $S^\\star$ of maximal size such that there exists a rigid-body superposition with $\\mathrm{RMSD} \\le \\tau$ on $S^\\star$.\n- Among all subsets with maximal size, pick one with minimal RMSD; if there remains a tie, choose the lexicographically smallest ordered index tuple.\n\nFinal output format:\n- For each test case $j \\in \\{1,2,3\\}$, output a pair $[k_j, r_j]$ where $k_j = |S^\\star|$ is an integer and $r_j$ is the minimal achievable RMSD on $S^\\star$ rounded to exactly $6$ decimal places.\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order of the test cases $1,2,3$. For example: $[[k_1,r_1],[k_2,r_2],[k_3,r_3]]$.",
            "solution": "The problem as stated is valid. It is a well-posed, scientifically grounded problem in computational structural biology that is free of contradictions or ambiguity. All necessary data and constraints are provided to arrive at a unique, verifiable solution. We shall therefore proceed with the derivation and implementation of a solution.\n\nThe problem requires us to find a subset of atom indices, $S^\\star$, of maximum possible size, for which there exists a rigid-body superposition (rotation $\\mathbf{R}$ and translation $\\mathbf{t}$) of two corresponding point sets, $\\{\\mathbf{x}_i\\}_{i \\in S^\\star}$ and $\\{\\mathbf{y}_i\\}_{i \\in S^\\star}$, such that the root-mean-square deviation (RMSD) is no greater than a given threshold $\\tau$. Formally, we must find $S^\\star$ that solves the optimization problem:\n$$ S^\\star = \\arg\\max_{S \\subseteq \\{0, ..., N-1\\}} |S| \\quad \\text{subject to} \\quad \\min_{\\mathbf{R},\\mathbf{t}} \\mathrm{RMSD}(\\mathbf{R},\\mathbf{t};S) \\le \\tau $$\nwhere $\\det(\\mathbf{R})=+1$. Tie-breaking rules are specified: among subsets of maximal size, select the one with the minimum RMSD, and subsequently, the one with the lexicographically smallest sorted index tuple.\n\nThis problem is a combinatorial search for an optimal subset. In the general case, this is an NP-hard problem, equivalent to finding the maximum clique in a graph where vertices represent atoms and edges connect pairs that are mutually superimposable within the given tolerance. However, for the small number of atoms given in the test cases ($N=8$ and $N=2$), an exhaustive search through all possible subsets is computationally feasible.\n\nOur strategy is therefore as follows:\n1.  Iterate through all possible subset sizes $k$ in descending order, from $N$ down to $1$.\n2.  For a given size $k$, generate all subsets of indices of that size.\n3.  For each subset, calculate the minimum possible RMSD between the corresponding point sets.\n4.  If the calculated RMSD is less than or equal to the threshold $\\tau$, the subset is a valid candidate.\n5.  Since we iterate from largest $k$ downwards, the first size $k$ for which we find any valid candidate(s) is the maximum possible cardinality, $|S^\\star|$. We then collect all valid candidates for this size $k$.\n6.  From this collection of maximal-size candidates, we select the one that satisfies the tie-breaking criteria: minimum RMSD, then lexicographically smallest index tuple.\n\nThe central component of this strategy is the calculation of the minimal RMSD for a given pair of point sets. This is a classic problem solved by the Kabsch algorithm, which finds the optimal rigid-body transformation.\n\nLet the two sets of coordinates for a given subset $S$ of size $k$ be $\\{\\mathbf{x}_i\\}_{i \\in S}$ and $\\{\\mathbf{y}_i\\}_{i \\in S}$. The Kabsch algorithm proceeds as follows:\n\nFirst, the minimization of RMSD can be decoupled. The optimal translation $\\mathbf{t}$ depends on the optimal rotation $\\mathbf{R}$. The squared RMSD is minimized by first centering both point sets at the origin. We compute the centroids:\n$$ \\mathbf{c}_x = \\frac{1}{k} \\sum_{i \\in S} \\mathbf{x}_i \\quad \\text{and} \\quad \\mathbf{c}_y = \\frac{1}{k} \\sum_{i \\in S} \\mathbf{y}_i $$\nThe centered coordinate vectors are $\\mathbf{x}'_i = \\mathbf{x}_i - \\mathbf{c}_x$ and $\\mathbf{y}'_i = \\mathbf{y}_i - \\mathbf{c}_y$. The problem reduces to finding the rotation $\\mathbf{R}$ that minimizes the sum of squared errors $\\sum_{i \\in S} \\|\\mathbf{R}\\mathbf{x}'_i - \\mathbf{y}'_i\\|^2$.\n\nSecond, we construct the $3 \\times 3$ covariance matrix $H$. In matrix notation, let $X'$ and $Y'$ be $k \\times 3$ matrices whose rows are the centered coordinate vectors $\\{\\mathbf{x}'_i\\}$ and $\\{\\mathbf{y}'_i\\}$. The covariance matrix is given by:\n$$ H = (X')^T Y' $$\n\nThird, we perform a singular value decomposition (SVD) on the covariance matrix $H$:\n$$ H = U \\Sigma V^T $$\nwhere $U$ and $V$ are $3 \\times 3$ orthogonal matrices and $\\Sigma$ is a diagonal matrix of non-negative singular values.\n\nFourth, the optimal rotation matrix is determined from the SVD components. The rotation that maximizes the overlap (and thus minimizes the RMSD) is $\\mathbf{R} = VU^T$. A critical check is required to ensure this is a proper rotation (i.e., no reflection), as specified by the condition $\\det(\\mathbf{R})=+1$. If $\\det(VU^T) = -1$, the calculated matrix represents a roto-reflection. To obtain the closest proper rotation, we must correct this. The standard correction is to invert the sign of the column of $V$ corresponding to the smallest singular value before re-computing $\\mathbf{R}$. This ensures $\\det(\\mathbf{R}) = +1$. Let this corrected rotation be $\\mathbf{R}^\\star$.\n\nFinally, with the optimal rotation $\\mathbf{R}^\\star$ determined, the optimal translation is given by $\\mathbf{t}^\\star = \\mathbf{c}_y - \\mathbf{R}^\\star\\mathbf{c}_x$. The minimal RMSD can then be computed directly using its definition:\n$$ \\mathrm{RMSD}_{\\min} = \\sqrt{\\frac{1}{k} \\sum_{i \\in S} \\|\\mathbf{R}^\\star\\mathbf{x}_i + \\mathbf{t}^\\star - \\mathbf{y}_i\\|^2} $$\n\nThis procedure will be implemented and applied to all subsets as described in the overall strategy to find the solution for each test case. Special attention is given to the cases with few points ($k3$). For $k=1$ or $k=2$, the minimal RMSD is always $0.0$, as one or two points can always be perfectly superimposed (assuming the inter-point distance is conserved, which is true in the problem setup). The general Kabsch implementation is robust to these cases.",
            "answer": "[[8, 0.000000],[6, 0.000000],[2, 0.000000]]"
        }
    ]
}