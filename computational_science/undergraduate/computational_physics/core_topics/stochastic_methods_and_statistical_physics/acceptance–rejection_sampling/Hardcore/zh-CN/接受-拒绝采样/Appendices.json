{
    "hands_on_practices": [
        {
            "introduction": "要真正掌握接受-拒绝采样法，不仅需要了解其算法步骤，更要深入理解接受与拒绝背后的概率意义。这个练习将带你深入剖析拒绝机制的核心。通过计算一个被*拒绝*样本的期望值，你将更清晰地看到该算法是如何通过选择性地过滤提议样本，从而塑造出最终符合目标分布的样本集的。这项练习能够锻炼你运用条件概率解决问题的能力，并让你对算法中的“拒绝”环节有一个更具体的认识。",
            "id": "760197",
            "problem": "接受-拒绝法是一种从目标概率分布 $f(x)$ 中生成随机样本的技术，它使用一个更简单的建议分布 $g(x)$。该方法需要一个常数 $M$，使得对于 $f(x)$ 定义域中的所有 $x$，都有 $f(x) \\le M g(x)$，并且 $g(x)$ 的定义域必须包含 $f(x)$ 的定义域。\n\n抽样算法如下：\n1.  从建议分布 $g(x)$ 中抽取一个样本 $X$。\n2.  从均匀分布 $U(0, 1)$ 中抽取一个样本 $U$。\n3.  如果 $$U \\le \\frac{f(X)}{M g(X)}$$，则样本 $X$ 被“接受”；否则，它被“拒绝”。重复此过程，直到一个样本被接受。\n\n考虑一个在区间 $[0, 1]$ 上定义的目标概率密度函数 (PDF) $f(x)$，它由一个线性函数给出：\n$$f(x) = C(1 + \\alpha x)$$\n其中 $C$ 是归一化常数，$\\alpha$ 是一个满足 $0  \\alpha \\le 1$ 的参数。\n\n建议分布是区间 $[0, 1]$ 上的均匀分布，即对于 $x \\in [0, 1]$，$g(x) = 1$。常数 $M$ 被选为满足条件 $f(x) \\le M g(x)$ 的最小可能值。\n\n设 $X$ 是从建议分布 $g(x)$ 中抽取的随机变量。求在 $X$ 被接受-拒绝算法拒绝的条件下，$X$ 的期望值，即求 $E[X | \\text{X is rejected}]$。",
            "solution": "1. 将 $f(x)$ 在 $[0,1]$ 上归一化：\n$$\\int_0^1 C(1+\\alpha x)\\,dx\n= C\\Bigl[1+\\tfrac{\\alpha}{2}\\Bigr]\n=1\n\\;\\Longrightarrow\\;\nC=\\frac{1}{1+\\tfrac{\\alpha}{2}}.$$\n\n2. 求最小的包络常数 $M$：\n$$M=\\max_{x\\in[0,1]}\\frac{f(x)}{g(x)}\n=\\max_{x}(C(1+\\alpha x))\n=C(1+\\alpha)\n=\\frac{1+\\alpha}{1+\\tfrac{\\alpha}{2}}.$$\n\n3. 在 $X=x$ 时的拒绝概率：\n$$P(\\text{reject}\\mid X=x)\n=1-\\frac{f(x)}{M\\,g(x)}\n=1-\\frac{C(1+\\alpha x)}{M}\n=1-\\frac{1+\\alpha x}{1+\\alpha}\n=\\frac{\\alpha(1-x)}{1+\\alpha}.$$\n\n4. $(X,\\text{reject})$ 的联合密度：\n$$h(x)=g(x)\\,P(\\text{reject}\\mid X=x)\n=\\frac{\\alpha(1-x)}{1+\\alpha},\\quad x\\in[0,1].$$\n\n5. 总拒绝概率：\n$$P(\\text{reject})\n=\\int_0^1 h(x)\\,dx\n=\\frac{\\alpha}{1+\\alpha}\\int_0^1(1-x)\\,dx\n=\\frac{\\alpha}{2(1+\\alpha)}.$$\n\n6. 给定拒绝条件下的条件密度：\n$$f_{X\\mid\\text{reject}}(x)\n=\\frac{h(x)}{P(\\text{reject})}\n=\\frac{\\alpha(1-x)/(1+\\alpha)}{\\alpha/[2(1+\\alpha)]}\n=2(1-x),\\quad x\\in[0,1].$$\n\n7. 计算 $E[X\\mid\\text{reject}]$：\n$$E[X\\mid\\text{reject}]\n=\\int_0^1 x\\cdot2(1-x)\\,dx\n=2\\int_0^1(x-x^2)\\,dx\n=2\\Bigl[\\tfrac12-\\tfrac13\\Bigr]\n=\\tfrac13.$$",
            "answer": "$$\\boxed{\\frac{1}{3}}$$"
        },
        {
            "introduction": "实现高效接受-拒绝采样的关键在于选择一个“优秀”的提议分布，这通常意味着需要调整提议分布族的参数以最大化接受率。本题提供了一个经典的优化挑战：在对一个比高斯分布具有更重尾部的四次势函数分布进行采样时，如何寻找高斯提议分布的最佳标准差。解决这个问题需要你将包络常数 $M$ 表达为提议分布参数 $\\alpha$ 的函数，然后通过微积分方法找到使 $M(\\alpha)$ 最小的最优 $\\alpha$ 值。这项练习是应用微积分来优化统计算法的绝佳范例，这在计算物理中是一项至关重要的技能。",
            "id": "2370842",
            "problem": "一个在一维无量纲四次禁闭势中的粒子，其未归一化的玻尔兹曼权重由目标函数 $\\varphi(x) = \\exp\\!\\big(-x^{4}/2\\big)$ 给出，其中 $x \\in \\mathbb{R}$。为了使用接受-拒绝采样方法从相应的归一化分布中抽取样本，考虑一个具有可控尺度参数 $\\alpha  0$ 的归一化高斯提议密度族 $q_{\\alpha}(x) = \\dfrac{1}{\\sqrt{2\\pi}\\,\\alpha}\\,\\exp\\!\\big(-x^{2}/(2\\alpha^{2})\\big)$。将包络常数 $M(\\alpha)$ 定义为满足 $\\varphi(x) \\leq M(\\alpha)\\,q_{\\alpha}(x)$ 对所有 $x \\in \\mathbb{R}$ 成立的最小实数。\n\n以闭合形式确定使 $M(\\alpha)$ 最小化的 $\\alpha$ 值。请以精确解析表达式的形式给出最优 $\\alpha$ 值，不进行数值近似且不带单位。",
            "solution": "接受-拒绝方法的核心是找到一个包络常数 $M(\\alpha)$，使得对所有 $x$ 都有 $\\varphi(x) \\le M(\\alpha) q_{\\alpha}(x)$。为了最大化采样算法的效率，必须找到该常数的最小可能值。对于给定的 $\\alpha$，此最小值由两个函数之比的最大值给出。\n$$M(\\alpha) = \\sup_{x \\in \\mathbb{R}} \\frac{\\varphi(x)}{q_{\\alpha}(x)}$$\n我们定义比率函数 $R(x, \\alpha)$：\n$$R(x, \\alpha) = \\frac{\\varphi(x)}{q_{\\alpha}(x)} = \\frac{\\exp(-x^{4}/2)}{\\frac{1}{\\sqrt{2\\pi}\\,\\alpha}\\,\\exp(-x^{2}/(2\\alpha^{2}))} = \\sqrt{2\\pi}\\,\\alpha \\exp\\left(-\\frac{x^{4}}{2} + \\frac{x^{2}}{2\\alpha^{2}}\\right)$$\n为了找到 $R(x, \\alpha)$ 对于固定 $\\alpha  0$ 时关于 $x$ 的最大值，更简单的方法是找到其自然对数的最大值，因为 $\\ln$ 是一个严格递增函数。令 $g(x, \\alpha) = \\ln(R(x, \\alpha))$。\n$$g(x, \\alpha) = \\ln(\\sqrt{2\\pi}\\,\\alpha) - \\frac{x^{4}}{2} + \\frac{x^{2}}{2\\alpha^{2}}$$\n为了求最大值，我们计算关于 $x$ 的偏导数并令其为零：\n$$\\frac{\\partial g}{\\partial x} = -2x^{3} + \\frac{x}{\\alpha^{2}} = x\\left(\\frac{1}{\\alpha^{2}} - 2x^{2}\\right)$$\n令 $\\frac{\\partial g}{\\partial x} = 0$ 得到临界点 $x=0$ 和 $x^{2} = \\frac{1}{2\\alpha^{2}}$。为了确定这些临界点的性质，我们考察二阶偏导数：\n$$\\frac{\\partial^{2} g}{\\partial x^{2}} = -6x^{2} + \\frac{1}{\\alpha^{2}}$$\n在 $x=0$ 处，$\\frac{\\partial^{2} g}{\\partial x^{2}}|_{x=0} = \\frac{1}{\\alpha^{2}}  0$，这对应一个局部最小值。\n在 $x^{2} = \\frac{1}{2\\alpha^{2}}$ 处，$\\frac{\\partial^{2} g}{\\partial x^{2}}|_{x^{2}=1/(2\\alpha^{2})} = -6\\left(\\frac{1}{2\\alpha^{2}}\\right) + \\frac{1}{\\alpha^{2}} = -\\frac{3}{\\alpha^{2}} + \\frac{1}{\\alpha^{2}} = -\\frac{2}{\\alpha^{2}}  0$。这表明是一个局部最大值。因此，$g(x, \\alpha)$ 的上确界出现在 $x^{2} = \\frac{1}{2\\alpha^{2}}$ 处。\n\n将这个 $x^2$ 的值代回 $g(x, \\alpha)$ 的表达式中，得到最大值，我们记为 $g_{\\max}(\\alpha)$：\n$$g_{\\max}(\\alpha) = \\ln(\\sqrt{2\\pi}\\,\\alpha) - \\frac{1}{2}\\left(\\frac{1}{2\\alpha^{2}}\\right)^{2} + \\frac{1}{2\\alpha^{2}}\\left(\\frac{1}{2\\alpha^{2}}\\right)$$\n$$g_{\\max}(\\alpha) = \\ln(\\sqrt{2\\pi}\\,\\alpha) - \\frac{1}{8\\alpha^{4}} + \\frac{1}{4\\alpha^{4}} = \\ln(\\sqrt{2\\pi}\\,\\alpha) + \\frac{1}{8\\alpha^{4}}$$\n包络常数 $M(\\alpha)$ 是该值的指数：\n$$M(\\alpha) = \\exp(g_{\\max}(\\alpha)) = \\exp\\left(\\ln(\\sqrt{2\\pi}\\,\\alpha) + \\frac{1}{8\\alpha^{4}}\\right) = \\sqrt{2\\pi}\\,\\alpha \\exp\\left(\\frac{1}{8\\alpha^{4}}\\right)$$\n目标是找到使 $M(\\alpha)$ 最小化的 $\\alpha$ 值。我们可以通过最小化 $\\ln(M(\\alpha))$ 来实现这一点，我们称之为 $h(\\alpha)$。\n$$h(\\alpha) = \\ln(M(\\alpha)) = \\ln(\\sqrt{2\\pi}) + \\ln(\\alpha) + \\frac{1}{8\\alpha^{4}} = \\ln(\\sqrt{2\\pi}) + \\ln(\\alpha) + \\frac{1}{8}\\alpha^{-4}$$\n我们将 $h(\\alpha)$ 对 $\\alpha$ 求导，并令导数为零：\n$$\\frac{dh}{d\\alpha} = \\frac{1}{\\alpha} + \\frac{1}{8}(-4)\\alpha^{-5} = \\frac{1}{\\alpha} - \\frac{1}{2\\alpha^{5}}$$\n令 $\\frac{dh}{d\\alpha} = 0$：\n$$\\frac{1}{\\alpha} - \\frac{1}{2\\alpha^{5}} = 0$$\n因为 $\\alpha  0$，我们可以两边乘以 $2\\alpha^{5}$ 得到：\n$$2\\alpha^{4} - 1 = 0 \\implies \\alpha^{4} = \\frac{1}{2}$$\n唯一的正实数解是：\n$$\\alpha = \\left(\\frac{1}{2}\\right)^{1/4}$$\n为了确认这是一个最小值，我们考察 $h(\\alpha)$ 的二阶导数：\n$$\\frac{d^{2}h}{d\\alpha^{2}} = \\frac{d}{d\\alpha}\\left(\\alpha^{-1} - \\frac{1}{2}\\alpha^{-5}\\right) = -\\alpha^{-2} - \\frac{1}{2}(-5)\\alpha^{-6} = -\\frac{1}{\\alpha^{2}} + \\frac{5}{2\\alpha^{6}}$$\n将 $\\alpha^4 = 1/2$ 的值代入二阶导数：\n$$\\frac{d^{2}h}{d\\alpha^{2}} = \\frac{1}{\\alpha^{6}}\\left(\\frac{5}{2} - \\alpha^{4}\\right) = \\frac{1}{\\alpha^{6}}\\left(\\frac{5}{2} - \\frac{1}{2}\\right) = \\frac{2}{\\alpha^{6}}$$\n由于 $\\alpha  0$，$\\alpha^{6}$ 为正，所以 $\\frac{d^{2}h}{d\\alpha^{2}}  0$。这证实了我们找到的 $\\alpha$ 值对应于 $M(\\alpha)$ 的一个局部最小值。\n因此，使包络常数 $M(\\alpha)$ 最小的 $\\alpha$ 值为 $\\left(\\frac{1}{2}\\right)^{1/4}$。",
            "answer": "$$\\boxed{\\left(\\frac{1}{2}\\right)^{1/4}}$$"
        },
        {
            "introduction": "在实际应用中，我们遇到的目标分布往往很复杂，例如呈现双峰或多峰形态。对于这类分布，使用简单的单峰提议分布会导致采样效率极低。本练习将探讨一种更强大的策略：使用混合模型作为提议分布，以更好地匹配复杂的目标分布。通过编程计算并比较单个高斯提议与双组分混合高斯提议的采样效率，你将能直观地量化这种高级策略所带来的性能提升。这项动手编程练习展示了如何应对更真实的采样问题，并强调了根据目标分布的具体特征来定制提议策略以实现高效率的重要性。",
            "id": "2370829",
            "problem": "您将使用两种不同的提议策略，比较从一维双峰目标概率密度函数中抽取样本的接受-拒绝采样 (ARS) 的效率。目标分布是两个正态分布的混合。效率度量是接受率，对于一个有效的ARS设置，它等于包络常数的倒数。\n\n基本原理和定义：\n- 概率密度函数 $f(x)$ 是一个非负函数，满足 $\\int_{-\\infty}^{\\infty} f(x)\\,dx = 1$。\n- 在接受-拒绝采样 (ARS) 中，我们选择一个提议密度 $g(x)$（满足 $\\int g(x)\\,dx = 1$）和一个常数 $M \\ge 1$，使得对于所有 $x \\in \\mathbb{R}$，都有 $M\\,g(x) \\ge f(x)$。ARS 过程从 $g$ 中抽取 $X$（记为 $X \\sim g$），并从 $(0,1)$ 上的均匀分布中抽取 $U$（记为 $U \\sim \\text{Uniform}(0,1)$），如果 $U \\le \\frac{f(X)}{M g(X)}$，则接受 $X$。这保证了被接受的 $X$ 值遵循分布 $f$。\n- 接受率是在 $X \\sim g$ 条件下的期望值 $\\mathbb{E}\\left[\\frac{f(X)}{M g(X)}\\right]$。在 ARS 条件下，且 $f$ 归一化（积分为1）时，接受率等于 $\\frac{1}{M}$。\n\n待研究的目标和提议：\n- 目标密度 $f(x)$：两个正态分量的混合，它们有共同的标准差 $\\sigma_t  0$，均值分别为 $\\mu_1$ 和 $\\mu_2$，第一个众数的混合权重为 $w \\in (0,1)$，\n$$\nf(x) \\;=\\; w\\,\\phi(x;\\mu_1,\\sigma_t) \\;+\\; (1-w)\\,\\phi(x;\\mu_2,\\sigma_t),\n$$\n其中 $\\phi(x;\\mu,\\sigma)$ 是正态密度\n$$\n\\phi(x;\\mu,\\sigma) \\;=\\; \\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\,\\exp\\!\\left(-\\frac{(x-\\mu)^2}{2\\sigma^2}\\right).\n$$\n- 提议 A（单峰提议）$g_s(x)$：一个单一的正态密度，其均值选为混合均值 $\\mu_p = w\\,\\mu_1 + (1-w)\\,\\mu_2$，标准差选为混合方差的平方根，\n$$\n\\sigma_p \\;=\\; \\sqrt{\\sigma_t^2 + w(1-w)(\\mu_2-\\mu_1)^2}, \\qquad g_s(x) = \\phi(x;\\mu_p,\\sigma_p).\n$$\n- 提议 B（两个策略性放置的单峰提议的混合）$g_m(x)$：两个正态分量的混合，其中心位于两个众数处，具有与目标相同的标准差和相同的权重，\n$$\ng_m(x) \\;=\\; w\\,\\phi(x;\\mu_1,\\sigma_t) \\;+\\; (1-w)\\,\\phi(x;\\mu_2,\\sigma_t).\n$$\n\n计算任务：\n- 对于下面套件中的每个测试用例，为每个提议计算一个有效的包络常数，\n$$\nM_s \\;\\ge\\; \\sup_{x \\in \\mathbb{R}} \\frac{f(x)}{g_s(x)}, \\qquad\nM_m \\;\\ge\\; \\sup_{x \\in \\mathbb{R}} \\frac{f(x)}{g_m(x)}.\n$$\n- 由于精确的上确界可能无法以闭式形式获得，因此通过在足够宽且密集的网格上评估该比率，然后将观察到的最大比率乘以一个小的安全因子以保证有效性，来计算一个数值上有效的上界。使用定义域\n$$\n[x_{\\min}, x_{\\max}] \\;=\\; \\big[\\min(\\mu_1,\\mu_2) - L,\\; \\max(\\mu_1,\\mu_2) + L\\big], \\quad L \\;=\\; 8\\,\\sigma_t + |\\mu_2-\\mu_1|,\n$$\n以及在此区间上的一个包含 $N_{\\text{grid}} = 200001$ 个点的均匀网格。令 $\\widehat{M}$ 表示在网格上观察到的最大比率。定义认证常数\n$$\nM \\;=\\; \\gamma\\,\\widehat{M}, \\quad \\text{安全因子 } \\gamma \\;=\\; 1.0005.\n$$\n- 分别计算提议 $g_s$ 和 $g_m$ 的接受率 $a_s = 1/M_s$ 和 $a_m = 1/M_m$。\n- 对于每个测试用例，以十进制数报告改进因子 $I = a_m/a_s$。\n\n测试套件：\n- 用例 1（平衡、分离良好的众数）：$\\mu_1 = -3$，$\\mu_2 = 3$，$\\sigma_t = 1$， $w = 0.5$。\n- 用例 2（平衡、中度重叠的众数）：$\\mu_1 = -1$，$\\mu_2 = 1$，$\\sigma_t = 1$， $w = 0.5$。\n- 用例 3（不等权重、分离的众数）：$\\mu_1 = 0$，$\\mu_2 = 8$，$\\sigma_t = 1$， $w = 0.9$。\n- 用例 4（平衡、极度分离的众数）：$\\mu_1 = -6$，$\\mu_2 = 6$，$\\sigma_t = 1$， $w = 0.5$。\n\n答案规格：\n- 对于每个测试用例，答案是一个浮点数 $I$，代表改进因子 $a_m/a_s$。\n- 您的程序必须生成单行输出，其中包含测试套件的改进因子结果，以逗号分隔的列表形式，顺序与上述相同，并用方括号括起来。每个浮点数必须四舍五入到六位小数（使用小数形式，而不是百分比）。例如，一个有效的输出格式是 $[1.234000,2.000000, \\dots]$。",
            "solution": "该问题要求对从一个双峰目标概率密度函数进行接受-拒绝采样 (ARS) 的两种不同提议策略的效率进行比较分析。效率由接受率量化，该接受率是包络常数 $M$ 的倒数。改进因子定义为两种提议的接受率之比。\n\n目标概率密度函数 $f(x)$ 是两个正态分布的混合：\n$$\nf(x) = w\\,\\phi(x;\\mu_1,\\sigma_t) + (1-w)\\,\\phi(x;\\mu_2,\\sigma_t)\n$$\n其中 $\\phi(x;\\mu,\\sigma)$ 是正态概率密度函数：\n$$\n\\phi(x;\\mu,\\sigma) = \\frac{1}{\\sqrt{2\\pi}\\,\\sigma}\\,\\exp\\left(-\\frac{(x-\\mu)^2}{2\\sigma^2}\\right)\n$$\n参数包括均值 $\\mu_1$ 和 $\\mu_2$、一个共同的标准差 $\\sigma_t  0$ 以及一个混合权重 $w \\in (0,1)$。\n\n指定了两种提议密度进行分析。\n\n提议 A，一个单峰提议 $g_s(x)$，是一个正态密度，其均值和方差与目标混合分布 $f(x)$ 的均值和方差相匹配。混合分布的均值为 $\\mu_p = w\\,\\mu_1 + (1-w)\\,\\mu_2$，方差为 $\\sigma_p^2 = \\sigma_t^2 + w(1-w)(\\mu_2-\\mu_1)^2$。因此，该提议为：\n$$\ng_s(x) = \\phi(x; \\mu_p, \\sigma_p) \\quad \\text{with} \\quad \\mu_p = w\\,\\mu_1 + (1-w)\\,\\mu_2, \\quad \\sigma_p = \\sqrt{\\sigma_t^2 + w(1-w)(\\mu_2-\\mu_1)^2}\n$$\n该策略试图用一个更宽的单一正态分布来近似双峰目标。\n\n提议 B，一个混合提议 $g_m(x)$，其构造与目标密度完全相同：\n$$\ng_m(x) = w\\,\\phi(x;\\mu_1,\\sigma_t) + (1-w)\\,\\phi(x;\\mu_2,\\sigma_t)\n$$\n这代表了一个‘完美’的提议，因为它具有与目标分布相同的形式。\n\n接受-拒绝采样的核心依赖于一个包络常数 $M$，使得对于所有 $x$ 都有 $f(x) \\le M\\,g(x)$。最小的此类常数为 $M = \\sup_{x \\in \\mathbb{R}} \\frac{f(x)}{g(x)}$。接受概率，或称效率，由 $a = 1/M$ 给出。我们必须分别计算提议 $g_s(x)$ 和 $g_m(x)$ 的包络常数 $M_s$ 和 $M_m$。\n\n对于提议 B，由于 $g_m(x) = f(x)$，其比率恒等于一：\n$$\n\\frac{f(x)}{g_m(x)} = 1, \\quad \\forall x \\in \\mathbb{R}\n$$\n因此，理论上的上确界是 $\\sup_{x} \\frac{f(x)}{g_m(x)} = 1$。在任何网格上数值观测到的最大值 $\\widehat{M}_m$ 将为 $1$（在浮点精度范围内）。根据问题说明，认证常数为 $M_m = \\gamma\\,\\widehat{M}_m = \\gamma \\cdot 1 = \\gamma$，其中安全因子 $\\gamma = 1.0005$。相应的接受率为 $a_m = 1/M_m = 1/\\gamma$。\n\n对于提议 A，比率 $r_s(x) = f(x)/g_s(x)$ 不是常数。其上确界的解析确定并非易事。问题要求采用数值方法：我们在一个指定的密集网格上找到该比率的最大值，$\\widehat{M}_s = \\max_{x \\in \\text{grid}} r_s(x)$。然后，认证常数为 $M_s = \\gamma\\,\\widehat{M}_s$。该提议的接受率为 $a_s = 1/M_s$。\n\n目标是计算改进因子 $I$，其定义为接受率之比：\n$$\nI = \\frac{a_m}{a_s}\n$$\n将接受率的表达式用认证常数代入，我们得到：\n$$\nI = \\frac{1/M_m}{1/M_s} = \\frac{M_s}{M_m}\n$$\n使用定义 $M_s = \\gamma\\,\\widehat{M}_s$ 和 $M_m = \\gamma$，改进因子的表达式简化为：\n$$\nI = \\frac{\\gamma\\,\\widehat{M}_s}{\\gamma} = \\widehat{M}_s\n$$\n因此，所需的改进因子恰好是在应用安全因子之前，在数值网格上观察到的比率 $f(x)/g_s(x)$ 的最大值。这就是我们必须为每个测试用例计算的量。\n\n每个测试用例的计算过程如下：\n1.  给定参数 $\\mu_1$、$\\mu_2$、$\\sigma_t$ 和 $w$。\n2.  定义目标密度函数 $f(x) = w\\,\\phi(x;\\mu_1,\\sigma_t) + (1-w)\\,\\phi(x;\\mu_2,\\sigma_t)$。\n3.  计算单一提议 $g_s(x)$ 的参数：\n    -   均值： $\\mu_p = w\\,\\mu_1 + (1-w)\\,\\mu_2$\n    -   标准差： $\\sigma_p = \\sqrt{\\sigma_t^2 + w(1-w)(\\mu_2-\\mu_1)^2}$\n4.  构建数值网格。定义域为 $[x_{\\min}, x_{\\max}]$，其中：\n    -   $L = 8\\,\\sigma_t + |\\mu_2-\\mu_1|$\n    -   $x_{\\min} = \\min(\\mu_1,\\mu_2) - L$\n    -   $x_{\\max} = \\max(\\mu_1,\\mu_2) + L$\n    -   网格由该定义域上的 $N_{\\text{grid}} = 200001$ 个均匀间隔的点组成。\n5.  在网格的每个点上评估函数 $f(x)$ 和 $g_s(x)$。\n6.  计算所有网格点的比率 $r_s(x) = f(x)/g_s(x)$。如果 $g_s(x)$ 接近于零，必须特别小心，但考虑到宽网格和正态分布的性质，在尾部，分子和分母都将趋于零，它们的比率将是良态的。\n7.  改进因子 $I$ 是在比率数组中找到的最大值：$I = \\max(r_s(x))$。\n8.  对套件中提供的所有四个测试用例重复此过程。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.stats import norm\n\ndef solve():\n    \"\"\"\n    Computes the improvement factor of a mixture proposal over a single \n    unimodal proposal for acceptance-rejection sampling.\n    \"\"\"\n    \n    # Define the test cases from the problem statement.\n    test_cases = [\n        # Case 1 (balanced, well-separated modes)\n        {'mu1': -3.0, 'mu2': 3.0, 'sigma_t': 1.0, 'w': 0.5},\n        # Case 2 (balanced, moderately overlapping modes)\n        {'mu1': -1.0, 'mu2': 1.0, 'sigma_t': 1.0, 'w': 0.5},\n        # Case 3 (unequal weights, separated modes)\n        {'mu1': 0.0, 'mu2': 8.0, 'sigma_t': 1.0, 'w': 0.9},\n        # Case 4 (balanced, extremely separated modes)\n        {'mu1': -6.0, 'mu2': 6.0, 'sigma_t': 1.0, 'w': 0.5},\n    ]\n\n    # Constants from the problem statement\n    N_grid = 200001\n    \n    results = []\n\n    for case in test_cases:\n        mu1 = case['mu1']\n        mu2 = case['mu2']\n        sigma_t = case['sigma_t']\n        w = case['w']\n\n        # 1. Define the target density function f(x)\n        def f(x_vals):\n            term1 = w * norm.pdf(x_vals, loc=mu1, scale=sigma_t)\n            term2 = (1.0 - w) * norm.pdf(x_vals, loc=mu2, scale=sigma_t)\n            return term1 + term2\n\n        # 2. Calculate parameters for the single proposal g_s(x)\n        mu_p = w * mu1 + (1.0 - w) * mu2\n        var_p = sigma_t**2 + w * (1.0 - w) * (mu2 - mu1)**2\n        sigma_p = np.sqrt(var_p)\n\n        # 3. Define the single proposal density g_s(x)\n        def g_s(x_vals):\n            return norm.pdf(x_vals, loc=mu_p, scale=sigma_p)\n\n        # 4. Construct the numerical grid\n        L = 8.0 * sigma_t + np.abs(mu2 - mu1)\n        x_min = min(mu1, mu2) - L\n        x_max = max(mu1, mu2) + L\n        x_grid = np.linspace(x_min, x_max, N_grid)\n\n        # 5. Evaluate f(x) and g_s(x) on the grid\n        f_vals = f(x_grid)\n        g_s_vals = g_s(x_grid)\n\n        # 6. Compute the ratio r_s(x) = f(x) / g_s(x)\n        # To avoid division by zero or NaN, we handle cases where g_s is very small.\n        # If g_s(x) is near zero, f(x) must also be near zero for the ratio to be finite.\n        # In the extreme tails, both are effectively zero, and the ratio tends to zero.\n        # We can safely replace g_s_vals=0 with a very small number, or filter them.\n        # Here, we only divide where g_s_vals is non-zero.\n        # The result of f(x)/g(x) approaches 0 where g(x) goes to 0 faster than f(x),\n        # which is the case in the tails.\n        ratio_s = np.zeros_like(f_vals)\n        non_zero_mask = g_s_vals > 0\n        ratio_s[non_zero_mask] = f_vals[non_zero_mask] / g_s_vals[non_zero_mask]\n\n        # 7. The improvement factor I is the max of the ratio\n        # I = M_s / M_m = (gamma * M_hat_s) / (gamma * M_hat_m)\n        # M_hat_m = 1 because g_m(x) = f(x). So, I = M_hat_s.\n        improvement_factor = np.max(ratio_s)\n        results.append(improvement_factor)\n\n    # Final print statement in the exact required format.\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}