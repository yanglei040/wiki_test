{
    "hands_on_practices": [
        {
            "introduction": "设计高效的拒绝采样算法，其关键在于最大化其效率。本练习旨在计算理论上的接受概率，该概率直接衡量平均有多少提议样本会被舍弃。通过解决这个问题，你将学会如何确定最优的缩放常数 $M$，并理解它与采样器性能的直接关系。",
            "id": "1387131",
            "problem": "一位数据科学家正在实现一个拒绝采样算法，以生成遵循特定目标分布的随机数。目标分布是参数为 $\\alpha = 2$ 和 $\\beta = 2$ 的Beta分布。该目标分布的概率密度函数 (PDF) 记为 $f(x)$，由下式给出：\n$$f(x) = 6x(1-x) \\quad \\text{for } x \\in [0, 1]$$\n其他情况下 $f(x) = 0$。\n\n对于提议分布，该数据科学家使用标准均匀分布 U(0, 1)。该提议分布的概率密度函数 (PDF) 记为 $g(x)$，为：\n$$g(x) = 1 \\quad \\text{for } x \\in [0, 1]$$\n其他情况下 $g(x) = 0$。\n\n拒绝采样方法需要找到一个常数 $M$，使得不等式 $f(x) \\le M g(x)$ 对所有可能的 $x$ 值都成立。为使采样过程的效率最大化，选择 $M$ 的最小可能值。该算法随后从提议分布 $g(x)$ 中生成一个样本 $Y$，并以概率 $\\frac{f(Y)}{M g(Y)}$ 接受该样本。\n\n计算从提议分布中抽取的样本被接受的总体理论概率。请用精确分数表示你的答案。",
            "solution": "我们需要找到最小的常数 $M$，使得对所有的 $x$ 都有 $f(x) \\le M g(x)$。因为当 $x \\in [0,1]$ 时 $g(x)=1$，否则 $g(x)=0$，所以该条件在 $[0,1]$ 上化简为 $f(x) \\le M$。因此，最小允许的 $M$ 是 $f(x)$ 在 $[0,1]$ 上的上确界。\n\n计算 $f(x)=6x(1-x)=6(x - x^{2})$ 在 $[0,1]$ 上的最大值。求导：\n$$\nf'(x)=6(1-2x), \\quad f''(x)=-12.\n$$\n令 $f'(x)=0$ 得到 $x=\\frac{1}{2}$。因为 $f''(x)  0$，所以这是一个最大值点。计算\n$$\nM=\\max_{x \\in [0,1]} f(x)=f\\!\\left(\\tfrac{1}{2}\\right)=6 \\cdot \\tfrac{1}{2} \\cdot \\left(1-\\tfrac{1}{2}\\right)=\\frac{3}{2}.\n$$\n\n给定 $Y \\sim g$，在 $Y=y$ 条件下的接受概率为 $\\frac{f(y)}{M g(y)}$。总体接受概率是在 $g$ 分布下的期望值：\n$$\n\\mathbb{P}(\\text{accept})=\\mathbb{E}_{g}\\!\\left[\\frac{f(Y)}{M g(Y)}\\right]=\\int_{0}^{1} \\frac{f(x)}{M g(x)} g(x) \\, dx=\\frac{1}{M} \\int_{0}^{1} f(x) \\, dx.\n$$\n由于 $f$ 是 $[0,1]$ 上的一个概率密度函数，所以 $\\int_{0}^{1} f(x) \\, dx=1$。为完整起见：\n$$\n\\int_{0}^{1} 6x(1-x)\\,dx=6 \\int_{0}^{1} \\left(x - x^{2}\\right) dx=6 \\left(\\frac{1}{2}-\\frac{1}{3}\\right)=1.\n$$\n因此，\n$$\n\\mathbb{P}(\\text{accept})=\\frac{1}{M}=\\frac{1}{\\frac{3}{2}}=\\frac{2}{3}.\n$$",
            "answer": "$$\\boxed{\\frac{2}{3}}$$"
        },
        {
            "introduction": "要真正掌握拒绝采样，从理论走向分步仿真是大有裨益的。本题提供了一个具体场景，即从离散的二项分布中进行采样，并给出了用于提议和接受步骤的预生成随机数。通过逐轮跟踪整个过程，你将在实践中巩固对该算法机制的理解。",
            "id": "1387121",
            "problem": "一位质量控制工程师正在检查每批3个物品的小批量产品。历史数据显示，任何给定的物品有50%的概率是次品，且与其他物品独立。一批产品中的次品数量，我们称之为随机变量 $X$，因此服从参数为 $n=3$ 和 $p=1/2$ 的二项分布。\n\n为了模拟可能的结果，该工程师使用了一种称为拒绝抽样的计算方法。该过程依赖于一个更简单的“提议”分布来生成候选值，然后这些值被接受或拒绝。对于此任务，提议分布是可能结果集合 $\\{0, 1, 2, 3\\}$ 上的离散均匀分布。\n\n模拟分轮进行。在每一轮中，从提议分布中抽取一个候选值，并从区间 $(0, 1)$ 上的连续均匀分布中抽取一个随机数。这两个数字用于一个接受测试。如果测试通过，该候选值被接受为目标二项分布的一个有效样本，模拟停止。如果测试失败，该候选值被拒绝，过程进入下一轮，使用新的随机数。\n\n假设为模拟生成了以下两个随机数序列：\n-   来自离散均匀分布的提议序列：`3, 0, 2, 1`\n-   来自 $(0, 1)$ 上均匀分布的抽样序列：`0.85, 0.60, 0.90, 0.45`\n\n使用这些序列，确定第一个被接受的次品数量值。",
            "solution": "目标分布是 $X \\sim \\mathrm{Binomial}(n=3,p=\\frac{1}{2})$，因此对于 $k \\in \\{0,1,2,3\\}$，其概率质量函数为\n$$\np(k)=\\mathbb{P}(X=k)=\\binom{3}{k}\\left(\\frac{1}{2}\\right)^{k}\\left(\\frac{1}{2}\\right)^{3-k}=\\binom{3}{k}\\,2^{-3}.\n$$\n因此，\n$$\np(0)=\\frac{1}{8},\\quad p(1)=\\frac{3}{8},\\quad p(2)=\\frac{3}{8},\\quad p(3)=\\frac{1}{8}.\n$$\n提议分布在 $\\{0,1,2,3\\}$ 上是均匀的，所以对所有 $k$ 都有 $q(k)=\\frac{1}{4}$。接受-拒绝方法使用一个常数 $c$，使得对所有 $k$ 都有 $p(k)\\leq c\\,q(k)$，即\n$$\nc=\\sup_{k}\\frac{p(k)}{q(k)}=\\sup_{k}\\left(4\\,p(k)\\right)=\\max\\left\\{\\frac{1}{2},\\frac{3}{2},\\frac{3}{2},\\frac{1}{2}\\right\\}=\\frac{3}{2}.\n$$\n一个提议值 $k$ 的接受概率是\n$$\n\\alpha(k)=\\frac{p(k)}{c\\,q(k)}=\\frac{p(k)}{(\\frac{3}{2})(\\frac{1}{4})}=\\frac{8}{3}\\,p(k).\n$$\n因此，\n$$\n\\alpha(0)=\\alpha(3)=\\frac{8}{3}\\cdot\\frac{1}{8}=\\frac{1}{3},\\qquad \\alpha(1)=\\alpha(2)=\\frac{8}{3}\\cdot\\frac{3}{8}=1.\n$$\n处理给定的序列：\n- 第1轮：提议 $k=3$，抽取 $u=0.85$。因为 $u=0.85>\\alpha(3)=\\frac{1}{3}$，拒绝。\n- 第2轮：提议 $k=0$，抽取 $u=0.60$。因为 $u=0.60>\\alpha(0)=\\frac{1}{3}$，拒绝。\n- 第3轮：提议 $k=2$，抽取 $u=0.90$。因为 $u=0.90\\leq\\alpha(2)=1$，接受。\n\n因此，第一个被接受的值是 $2$。",
            "answer": "$$\\boxed{2}$$"
        },
        {
            "introduction": "拒绝采样的理论条件并非只是建议，它们对算法的正确性至关重要。这个思想实验探讨了当一个关键假设被违反时会发生什么，特别是在缩放常数 $M$ 选择不当的情形下。通过推导被接受样本的实际分布，你将更深刻地体会到为什么 $f(x) \\le M g(x)$ 这个条件是确保最终样本能正确代表目标分布的根本。",
            "id": "1387128",
            "problem": "一位数据科学家正尝试从一个目标概率分布中生成随机数，该分布的概率密度函数 (PDF) 为：当 $x \\in [0, 1]$ 时，$f(x) = 2x$，否则 $f(x)=0$。他们决定使用拒绝采样法。\n\n其过程如下：\n1. 从一个均匀提议分布中抽取一个候选样本 $x^*$，该分布的 PDF 为：当 $x \\in [0, 1]$ 时，$g(x) = 1$，否则 $g(x)=0$。\n2. 从区间 $[0, 1]$ 上的均匀分布中抽取一个随机数 $u$。\n3. 如果满足条件 $u \\le \\frac{f(x^*)}{M g(x^*)}$，则接受候选样本 $x^*$。否则，拒绝该样本。\n\n然而，这位数据科学家犯了一个错误，将常数缩放因子设置为 $M=1$。尽管这个错误违反了该算法的一个关键假设，但该过程仍然生成了一组被接受的样本。\n\n请确定这些被接受样本的分布的 PDF（我们称之为 $h(x)$）。你的最终答案应表示为关于 $x$ 的分段函数。",
            "solution": "目标密度函数为：当 $x\\in[0,1]$ 时，$f(x)=2x$，否则为 $0$。提议分布为：当 $x\\in[0,1]$ 时，$g(x)=1$，否则为 $0$。在拒绝采样中，给定一个从 $g$ 中抽取的候选样本 $x$，接受事件为 $\\{u\\leq f(x)/(M g(x))\\}$，其中 $u\\sim\\text{Uniform}[0,1]$ 且独立于 $x$。因此，给定 $x$ 的条件下，接受概率为\n$$\na(x)=\\mathbb{P}\\!\\left(u\\leq \\frac{f(x)}{M g(x)}\\mid x\\right)=\\min\\!\\left(1,\\frac{f(x)}{M g(x)}\\right).\n$$\n在错误地选择 $M=1$ 的情况下，对于 $x\\in[0,1]$ 我们有\n$$\na(x)=\\min\\!\\left(1,\\frac{2x}{1}\\right)=\\min(1,2x)=\\begin{cases}\n2x,   0\\le x\\le \\frac{1}{2},\\\\\n1,   \\frac{1}{2}\\le x\\le 1,\n\\end{cases}\n$$\n且当 $x\\notin[0,1]$ 时，$a(x)=0$。被接受样本的密度函数是给定接受事件下 $x$ 的条件密度函数：\n$$\nh(x)=\\frac{g(x)\\,a(x)}{\\int_{-\\infty}^{\\infty} g(t)\\,a(t)\\,dt}.\n$$\n由于在 $[0,1]$ 上 $g(x)=1$，在其他情况下为 $0$，归一化常数为\n$$\nZ=\\int_{0}^{1} a(t)\\,dt=\\int_{0}^{1/2} 2t\\,dt+\\int_{1/2}^{1} 1\\,dt=\\left[t^{2}\\right]_{0}^{1/2}+\\left[t\\right]_{1/2}^{1}=\\frac{1}{4}+\\frac{1}{2}=\\frac{3}{4}.\n$$\n因此，对于 $x\\in[0,1]$，\n$$\nh(x)=\\frac{a(x)}{Z}=\\frac{4}{3}\\,a(x)=\\begin{cases}\n\\frac{8}{3}\\,x,   0\\le x\\le \\frac{1}{2},\\\\\n\\frac{4}{3},   \\frac{1}{2}\\le x\\le 1,\n\\end{cases}\n$$\n且当 $x\\notin[0,1]$ 时，$h(x)=0$。这个分段函数积分为 $1$，是在错误选择 $M=1$ 的情况下被接受样本的 PDF。",
            "answer": "$$\\boxed{h(x)=\\begin{cases}\\frac{8}{3}\\,x,  0\\le x\\le \\frac{1}{2},\\\\[4pt]\\frac{4}{3},  \\frac{1}{2}\\le x\\le 1,\\\\[4pt]0,  \\text{otherwise.}\\end{cases}}$$"
        }
    ]
}