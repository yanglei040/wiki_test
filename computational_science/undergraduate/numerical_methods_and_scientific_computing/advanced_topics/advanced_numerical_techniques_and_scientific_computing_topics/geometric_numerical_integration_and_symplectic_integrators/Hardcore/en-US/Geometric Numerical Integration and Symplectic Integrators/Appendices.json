{
    "hands_on_practices": [
        {
            "introduction": "To begin our hands-on exploration, we will analytically compare a geometric integrator with a classic, high-order method. A primary motivation for using symplectic integrators in physics is their superior ability to preserve the qualitative features of motion over long time scales, especially in oscillatory systems. This exercise will have you derive the phase error—the error in the oscillation's frequency—for both the Symplectic Euler and the classical fourth-order Runge-Kutta (RK4) methods, providing a concrete, mathematical justification for why the geometric approach often wins in the long run. ",
            "id": "3235367",
            "problem": "Consider the Hamiltonian simple harmonic oscillator with Hamiltonian $H(q,p) = \\tfrac{1}{2} p^{2} + \\tfrac{1}{2} \\omega^{2} q^{2}$, so that Hamilton’s equations give the linear ordinary differential equation (ODE) system $q' = p$, $p' = -\\omega^{2} q$, equivalently $y' = A y$ with $y = (q,p)^{\\mathsf{T}}$ and $A = \\begin{pmatrix} 0 & 1 \\\\ -\\omega^{2} & 0 \\end{pmatrix}$. For a one-step method with step size $h$, define the numerical frequency $\\Omega_{\\text{num}}$ as follows: if the one-step update is $y_{n+1} = M y_{n}$ and the eigenvalues of $M$ are $\\lambda_{\\pm} = \\rho \\exp(\\pm i \\theta)$ with $\\rho > 0$ and $\\theta \\in \\mathbb{R}$ (for sufficiently small $h$), then the rotation angle per step is $\\theta$ (in radians), and the numerical frequency is $\\Omega_{\\text{num}} = \\theta / h$.\n\nYou will analyze the leading-order phase error (error in frequency) $\\Delta \\Omega = \\Omega_{\\text{num}} - \\omega$ as $h \\to 0$ for the following two methods applied with fixed step size $h$ to the oscillator:\n\n- Symplectic Euler (semi-implicit, kick-then-drift): $p_{n+1} = p_{n} - h \\,\\omega^{2} q_{n}$, $q_{n+1} = q_{n} + h\\, p_{n+1}$. Assume $0 < \\omega h < 2$ so that the update is a rotation.\n\n- Classical Runge–Kutta method of order four (RK4): for $y' = f(y)$ with step size $h$, the method is given by\n$k_{1} = f(y_{n})$, \n$k_{2} = f(y_{n} + \\tfrac{h}{2} k_{1})$, \n$k_{3} = f(y_{n} + \\tfrac{h}{2} k_{2})$, \n$k_{4} = f(y_{n} + h k_{3})$, \n$y_{n+1} = y_{n} + \\tfrac{h}{6} (k_{1} + 2 k_{2} + 2 k_{3} + k_{4})$.\nApply this with $f(y) = A y$.\n\nStarting from these definitions and the linear algebra of $A$, derive, to leading nonzero order in $h$, the asymptotic expressions of the phase errors $\\Delta \\Omega_{\\text{SE}}$ and $\\Delta \\Omega_{\\text{RK4}}$ as functions of $\\omega$ and $h$, valid for small $h$.\n\nExpress your final answer as a single row matrix containing the two expressions in the order $\\bigl[\\Delta \\Omega_{\\text{SE}}, \\Delta \\Omega_{\\text{RK4}}\\bigr]$. Use radians for angles. Do not include units. No rounding is required; give exact symbolic coefficients.",
            "solution": "The problem asks for the leading-order phase error $\\Delta \\Omega = \\Omega_{\\text{num}} - \\omega$ for two numerical methods applied to the simple harmonic oscillator system $y' = Ay$, where $y = (q,p)^{\\mathsf{T}}$ and $A = \\begin{pmatrix} 0 & 1 \\\\ -\\omega^{2} & 0 \\end{pmatrix}$. The numerical frequency $\\Omega_{\\text{num}}$ is defined as $\\theta/h$, where $\\theta$ is the rotation angle per step from the eigenvalues $\\rho \\exp(\\pm i\\theta)$ of the one-step update matrix $M$.\n\nThe eigenvalues of the matrix $A$ are the solutions to $\\lambda^2 + \\omega^2 = 0$, which are $\\lambda_{\\pm} = \\pm i\\omega$. The exact flow for a step size $h$ is given by the matrix exponential $\\exp(hA)$. Its eigenvalues are $\\exp(\\pm i\\omega h)$. This corresponds to an exact rotation angle $\\theta_{\\text{exact}} = \\omega h$ and frequency $\\Omega_{\\text{exact}} = \\omega$.\n\n### Analysis of Symplectic Euler (SE)\n\nThe Symplectic Euler method as defined is:\n$p_{n+1} = p_{n} - h \\omega^{2} q_{n}$\n$q_{n+1} = q_{n} + h p_{n+1}$\n\nSubstituting the first equation into the second gives the explicit update rule for $y_{n} = (q_n, p_n)^{\\mathsf{T}}$:\n$q_{n+1} = q_{n} + h (p_n - h \\omega^2 q_n) = (1 - \\omega^2 h^2) q_n + h p_n$\n$p_{n+1} = p_n - h \\omega^2 q_n$\n\nThis can be written in matrix form $y_{n+1} = M_{\\text{SE}} y_n$, where the update matrix $M_{\\text{SE}}$ is:\n$$\nM_{\\text{SE}} = \\begin{pmatrix} 1 - \\omega^{2}h^{2} & h \\\\ -h\\omega^{2} & 1 \\end{pmatrix}\n$$\nThe eigenvalues $\\lambda$ of $M_{\\text{SE}}$ are given by the characteristic equation $\\det(M_{\\text{SE}} - \\lambda I) = 0$.\nThe trace of $M_{\\text{SE}}$ is $\\text{tr}(M_{\\text{SE}}) = 2 - \\omega^2 h^2$.\nThe determinant is $\\det(M_{\\text{SE}}) = (1 - \\omega^2 h^2)(1) - (h)(-h\\omega^2) = 1$.\nThe characteristic equation is $\\lambda^2 - \\text{tr}(M_{\\text{SE}})\\lambda + \\det(M_{\\text{SE}}) = 0$, which is:\n$$\n\\lambda^{2} - (2 - \\omega^{2}h^{2})\\lambda + 1 = 0\n$$\nThe discriminant is $D = (2 - \\omega^2 h^2)^2 - 4 = 4 - 4\\omega^2 h^2 + \\omega^4 h^4 - 4 = \\omega^2 h^2(\\omega^2 h^2 - 4)$.\nThe condition $0 < \\omega h < 2$ implies $D < 0$, so the eigenvalues are a complex conjugate pair on the unit circle (since $\\det(M_{\\text{SE}})=1$). Let the eigenvalues be $\\lambda_{\\pm} = \\exp(\\pm i \\theta_{\\text{SE}})$.\nThe sum of the eigenvalues is $\\lambda_+ + \\lambda_- = 2\\cos(\\theta_{\\text{SE}})$, which must equal the trace of $M_{\\text{SE}}$.\n$$\n2\\cos(\\theta_{\\text{SE}}) = 2 - \\omega^{2}h^{2} \\implies \\cos(\\theta_{\\text{SE}}) = 1 - \\frac{\\omega^{2}h^{2}}{2}\n$$\nThe numerical frequency is $\\Omega_{\\text{SE}} = \\theta_{\\text{SE}}/h$. We need to solve for $\\theta_{\\text{SE}}$ and expand for small $h$.\n$\\theta_{\\text{SE}} = \\arccos\\left(1 - \\frac{\\omega^{2}h^{2}}{2}\\right)$.\nLet $x = \\frac{\\omega^2 h^2}{2}$. For small $h$, $x$ is small. We use the Taylor series expansion of $\\arccos(1-x)$ for small $x>0$:\n$\\arccos(1-x) = \\sqrt{2x} + \\frac{1}{6\\sqrt{2}}x^{3/2} + O(x^{5/2})$.\nSubstituting $x = \\frac{\\omega^2 h^2}{2}$:\n$$\n\\theta_{\\text{SE}} = \\sqrt{2 \\cdot \\frac{\\omega^{2}h^{2}}{2}} + \\frac{1}{6\\sqrt{2}}\\left(\\frac{\\omega^{2}h^{2}}{2}\\right)^{3/2} + O(h^5)\n$$\n$$\n\\theta_{\\text{SE}} = \\omega h + \\frac{1}{6\\sqrt{2}} \\frac{\\omega^{3}h^{3}}{2\\sqrt{2}} + O(h^5) = \\omega h + \\frac{\\omega^{3}h^{3}}{24} + O(h^5)\n$$\nThe numerical frequency is:\n$$\n\\Omega_{\\text{SE}} = \\frac{\\theta_{\\text{SE}}}{h} = \\omega + \\frac{\\omega^{3}h^{2}}{24} + O(h^4)\n$$\nThe leading-order phase error for Symplectic Euler is:\n$$\n\\Delta \\Omega_{\\text{SE}} = \\Omega_{\\text{SE}} - \\omega = \\frac{\\omega^{3}h^{2}}{24}\n$$\n\n### Analysis of Classical Runge-Kutta (RK4)\n\nFor a linear ODE $y' = Ay$, the RK4 method gives a linear update $y_{n+1} = M_{\\text{RK4}}y_n$. The matrix $M_{\\text{RK4}}$ is a polynomial in $hA$:\n$$\nM_{\\text{RK4}} = I + hA + \\frac{(hA)^2}{2!} + \\frac{(hA)^3}{3!} + \\frac{(hA)^4}{4!}\n$$\nThe eigenvalues $\\lambda_{\\text{RK4}}$ of $M_{\\text{RK4}}$ are found by applying the same polynomial to the eigenvalues $\\pm i\\omega$ of $A$. Let $z=\\omega h$.\n$$\n\\lambda_{\\text{RK4}, \\pm} = 1 + (\\pm i\\omega h) + \\frac{(\\pm i\\omega h)^2}{2} + \\frac{(\\pm i\\omega h)^3}{6} + \\frac{(\\pm i\\omega h)^4}{24}\n$$\n$$\n\\lambda_{\\text{RK4}, \\pm} = 1 \\pm i(\\omega h) - \\frac{(\\omega h)^2}{2} \\mp i\\frac{(\\omega h)^3}{6} + \\frac{(\\omega h)^4}{24}\n$$\n$$\n\\lambda_{\\text{RK4}, \\pm} = \\left(1 - \\frac{z^2}{2} + \\frac{z^4}{24}\\right) \\pm i\\left(z - \\frac{z^3}{6}\\right)\n$$\nThe eigenvalues are of the form $\\rho \\exp(\\pm i\\theta_{\\text{RK4}})$. The angle $\\theta_{\\text{RK4}}$ is given by the argument of the complex number $\\lambda_{\\text{RK4},+}$.\n$$\n\\theta_{\\text{RK4}} = \\arg(\\lambda_{\\text{RK4},+}) = \\arctan\\left(\\frac{\\text{Im}(\\lambda_{\\text{RK4},+})}{\\text{Re}(\\lambda_{\\text{RK4},+})}\\right) = \\arctan\\left(\\frac{z - z^3/6}{1 - z^2/2 + z^4/24}\\right)\n$$\nTo find the leading-order error, we expand this expression for small $z = \\omega h$. Let the argument of the arctan function be $X$.\n$$\nX = \\frac{z(1-z^2/6)}{1-z^2/2+z^4/24}\n$$\nWe expand $X$ as a Taylor series in $z$:\n$X = z\\left(1-\\frac{z^2}{6}\\right)\\left(1 - \\left(\\frac{z^2}{2}-\\frac{z^4}{24}\\right)\\right)^{-1}$\n$ = z\\left(1-\\frac{z^2}{6}\\right)\\left(1 + \\left(\\frac{z^2}{2}-\\frac{z^4}{24}\\right) + \\left(\\frac{z^2}{2}\\right)^2 + O(z^6)\\right)$\n$ = z\\left(1-\\frac{z^2}{6}\\right)\\left(1 + \\frac{z^2}{2} + \\frac{5z^4}{24} + O(z^6)\\right)$\n$ = z\\left(1 + \\frac{z^2}{2} + \\frac{5z^4}{24} - \\frac{z^2}{6} - \\frac{z^4}{12} + O(z^6)\\right)$\n$ = z\\left(1 + \\frac{z^2}{3} + \\frac{z^4}{8} + O(z^6)\\right) = z + \\frac{z^3}{3} + \\frac{z^5}{8} + O(z^7)$\n\nThe Taylor series for $\\tan(z)$ is $\\tan(z) = z + \\frac{z^3}{3} + \\frac{2z^5}{15} + O(z^7)$.\nThus, we can write $X$ in terms of $\\tan(z)$:\n$X = \\tan(z) + \\left(\\frac{1}{8} - \\frac{2}{15}\\right)z^5 + O(z^7) = \\tan(z) - \\frac{z^5}{120} + O(z^7)$.\n\nNow we find $\\theta_{\\text{RK4}} = \\arctan(X)$. Let $T = \\tan(z)$ and $\\epsilon = -z^5/120 + O(z^7)$.\n$\\theta_{\\text{RK4}} = \\arctan(T+\\epsilon) = \\arctan(T) + \\frac{\\epsilon}{1+T^2} + O(\\epsilon^2)$.\nSince $\\arctan(T)=\\arctan(\\tan(z)) = z$ for small $z$, and $1/(1+T^2) = 1/(1+\\tan^2(z)) = \\cos^2(z) = 1-z^2/2+O(z^4)$, we have:\n$\\theta_{\\text{RK4}} = z + \\left(-\\frac{z^5}{120} + O(z^7)\\right)(\\cos^2(z)) = z - \\frac{z^5}{120} + O(z^7)$.\nSubstituting $z=\\omega h$:\n$$\n\\theta_{\\text{RK4}} = \\omega h - \\frac{(\\omega h)^5}{120} + O(h^7)\n$$\nThe numerical frequency for RK4 is:\n$$\n\\Omega_{\\text{RK4}} = \\frac{\\theta_{\\text{RK4}}}{h} = \\omega - \\frac{\\omega^5 h^4}{120} + O(h^6)\n$$\nThe leading-order phase error for RK4 is:\n$$\n\\Delta \\Omega_{\\text{RK4}} = \\Omega_{\\text{RK4}} - \\omega = -\\frac{\\omega^5 h^4}{120}\n$$\nThe final result consists of the two derived expressions for the phase errors.\n$\\Delta \\Omega_{\\text{SE}} = \\frac{\\omega^3 h^2}{24}$\n$\\Delta \\Omega_{\\text{RK4}} = -\\frac{\\omega^5 h^4}{120}$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{\\omega^{3}h^{2}}{24} & -\\frac{\\omega^{5}h^{4}}{120} \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Having established the theoretical advantages of symplectic methods, let's observe these benefits in practice. While analytical derivations are powerful, seeing the results of a simulation can provide a more intuitive understanding of concepts like energy drift and phase accuracy. This coding exercise asks you to implement and compare the Symplectic Euler method against a standard non-symplectic integrator (the second-order Heun's method) for the simple harmonic oscillator, allowing you to directly witness and quantify the bounded energy error and superior phase tracking that a geometric approach provides. ",
            "id": "3235506",
            "problem": "Consider the conservative harmonic oscillator governed by the second-order Ordinary Differential Equation (ODE) $q''(t) + q(t) = 0$ with unit angular frequency. Introduce the canonical momentum $p(t) = q'(t)$ to obtain the first-order system $q'(t) = p(t)$ and $p'(t) = -q(t)$, which defines a Hamiltonian system with Hamiltonian $H(q,p) = \\frac{1}{2} q^2 + \\frac{1}{2} p^2$. The exact solution rotates the state $(q(t),p(t))$ on circles of radius $\\sqrt{q^2 + p^2}$ at angular speed $1$ in radians per second. Your task is to implement two numerical integrators for this system, compare their phase accuracy, and assess their energy behavior.\n\nYou must implement:\n- The Explicit Trapezoidal (Heun) Method, which is a two-stage Runge–Kutta method of order $2$ formed by averaging slopes over a predictor and corrector step.\n- The Symplectic Euler Method (kick–drift variant), which updates momentum using the potential gradient and then updates position using the new momentum, preserving the canonical symplectic two-form.\n\nFor each test case, perform the following steps:\n1. Convert the second-order ODE to the first-order system $q'(t) = p(t)$ and $p'(t) = -q(t)$.\n2. Integrate from initial conditions $(q(0),p(0)) = (q_0,p_0)$ using both methods with uniform step size $h$ for $N = \\mathrm{round}(T/h)$ steps, where $T$ is the intended total time. Let $T_{\\text{eff}} = N h$ denote the effective integrated time.\n3. Compute the exact phase at $t = T_{\\text{eff}}$ as $\\phi_{\\text{exact}} = \\phi_0 - T_{\\text{eff}}$, where $\\phi_0 = \\mathrm{atan2}(p_0,q_0)$. Use the two-argument arctangent function to define phase, and express angles in radians.\n4. For each method, compute the numerical phase $\\phi_{\\text{num}} = \\mathrm{atan2}(p_N,q_N)$ at the final state $(q_N,p_N)$. Define the signed minimal angle difference $\\Delta \\phi = \\phi_{\\text{num}} - \\phi_{\\text{exact}}$ wrapped into the interval $[-\\pi,\\pi]$ and report the absolute value $|\\Delta \\phi|$ as the phase error, in radians.\n5. Compute the amplitude ratio $\\rho = \\frac{\\sqrt{q_N^2 + p_N^2}}{\\sqrt{q_0^2 + p_0^2}}$ to evaluate deviation from the exact circular motion.\n6. Produce a boolean flag for each test case indicating whether the Heun method exhibits a strictly larger absolute phase error than the Symplectic Euler method.\n\nAngle units must be in radians. Time $T$ and step size $h$ must be treated in seconds, with angular frequency equal to $1$ radian per second. All floating-point outputs must be rounded to $6$ decimal places.\n\nTest suite:\n- Case $1$: $(q_0,p_0) = (1.0,0.0)$, $h = 0.2$ s, $T = 40\\pi$ s.\n- Case $2$: $(q_0,p_0) = (1.0,0.0)$, $h = 0.9$ s, $T = 40\\pi$ s.\n- Case $3$: $(q_0,p_0) = (0.7,0.3)$, $h = 0.05$ s, $T = 80\\pi$ s.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, with one inner list per test case. Each inner list must have the form\n$[\\text{phase\\_error\\_Heun}, \\text{phase\\_error\\_SymplecticEuler}, \\text{amplitude\\_ratio\\_Heun}, \\text{amplitude\\_ratio\\_SymplecticEuler}, \\text{Heun\\_phase\\_worse}]$,\nwhere the first four entries are floats rounded to $6$ decimals and the last is a boolean. For example, the output format must look like $[[a_1,b_1,c_1,d_1,e_1],[a_2,b_2,c_2,d_2,e_2],[a_3,b_3,c_3,d_3,e_3]]$.",
            "solution": "The problem statement has been analyzed and is deemed valid. It is scientifically grounded, well-posed, objective, and contains all necessary information to proceed with a solution.\n\nThe problem investigates the numerical integration of a simple harmonic oscillator, a fundamental model in physics. The governing second-order Ordinary Differential Equation (ODE) is:\n$$\nq''(t) + q(t) = 0\n$$\nIntroducing the canonical momentum $p(t) = q'(t)$, we obtain the equivalent first-order Hamiltonian system:\n$$\n\\begin{cases}\nq'(t) = p(t) \\\\\np'(t) = -q(t)\n\\end{cases}\n$$\nThis system can be written in vector form as $\\mathbf{y}'(t) = f(\\mathbf{y}(t))$, where $\\mathbf{y} = [q, p]^T$ and $f(\\mathbf{y}) = [p, -q]^T$. The system's Hamiltonian, $H(q,p) = \\frac{1}{2}q^2 + \\frac{1}{2}p^2$, is a conserved quantity representing the total energy. The exact solution trajectories are circles in the $(q,p)$ phase space, corresponding to constant energy.\n\nWe will implement and compare two numerical methods to approximate the solution of this system.\n\n### The Explicit Trapezoidal (Heun) Method\nHeun's method is a second-order Runge-Kutta method. It is an explicit, two-stage predictor-corrector method. Given the state $\\mathbf{y}_n = [q_n, p_n]^T$ at time $t_n$, the state at $t_{n+1} = t_n + h$ is found by:\n$1$. Predictor step: $\\mathbf{k}_1 = f(\\mathbf{y}_n) = [p_n, -q_n]^T$. A preliminary state $\\mathbf{y}^*$ is estimated using the Forward Euler method: $\\mathbf{y}^* = \\mathbf{y}_n + h \\mathbf{k}_1$.\n$2$. Corrector step: Evaluate the slope at the predicted state: $\\mathbf{k}_2 = f(\\mathbf{y}^*) = f(\\mathbf{y}_n + h \\mathbf{k}_1)$.\n$3$. Update: Average the two slopes to update the state: $\\mathbf{y}_{n+1} = \\mathbf{y}_n + \\frac{h}{2}(\\mathbf{k}_1 + \\mathbf{k}_2)$.\n\nFor our specific system:\n$\\mathbf{k}_1 = [p_n, -q_n]^T$.\n$\\mathbf{y}^* = [q_n + h p_n, p_n - h q_n]^T$.\n$\\mathbf{k}_2 = [p_n - h q_n, -(q_n + h p_n)]^T$.\nThe update equations are:\n$$\nq_{n+1} = q_n + \\frac{h}{2}(p_n + (p_n - h q_n)) = (1 - \\frac{h^2}{2})q_n + h p_n\n$$\n$$\np_{n+1} = p_n + \\frac{h}{2}(-q_n - (q_n + h p_n)) = -h q_n + (1 - \\frac{h^2}{2})p_n\n$$\nIn matrix form, the update is $\\mathbf{y}_{n+1} = M_H \\mathbf{y}_n$, where the amplification matrix $M_H$ is:\n$$\nM_H = \\begin{pmatrix} 1 - \\frac{h^2}{2} & h \\\\ -h & 1 - \\frac{h^2}{2} \\end{pmatrix}\n$$\nThe determinant of this matrix is $\\det(M_H) = (1 - \\frac{h^2}{2})^2 + h^2 = 1 + \\frac{h^4}{4}$. Since $\\det(M_H) > 1$, the method is not symplectic. The area of phase space elements is not preserved, and for this system, the numerical energy (and amplitude) will systematically increase over time.\n\n### The Symplectic Euler Method (Kick-Drift)\nSymplectic integrators are designed to preserve the canonical symplectic two-form of Hamiltonian systems, which leads to superior long-term stability, particularly in energy conservation. The specified kick-drift variant is a first-order semi-implicit method. It updates the momentum first (kick), then uses the new momentum to update the position (drift).\nFor a separable Hamiltonian $H(q,p) = T(p) + V(q)$, the updates are:\n$1$. Kick: $p_{n+1} = p_n - h V'(q_n)$.\n$2$. Drift: $q_{n+1} = q_n + h T'(p_{n+1})$.\n\nFor our system, $V(q) = \\frac{1}{2}q^2 \\implies V'(q)=q$ and $T(p) = \\frac{1}{2}p^2 \\implies T'(p)=p$. The update equations are:\n$$\np_{n+1} = p_n - h q_n\n$$\n$$\nq_{n+1} = q_n + h p_{n+1} = q_n + h (p_n - h q_n) = (1 - h^2)q_n + h p_n\n$$\nIn matrix form, $\\mathbf{y}_{n+1} = M_{SE} \\mathbf{y}_n$, with the amplification matrix $M_{SE}$:\n$$\nM_{SE} = \\begin{pmatrix} 1 - h^2 & h \\\\ -h & 1 \\end{pmatrix}\n$$\nThe determinant is $\\det(M_{SE}) = (1 - h^2)(1) - (h)(-h) = 1$. The method is symplectic. It does not conserve the exact Hamiltonian $H$, but it exactly conserves a nearby \"shadow\" Hamiltonian. As a result, the numerical energy error remains bounded over long integration times.\n\n### Analysis and Computational Procedure\nFor each test case with initial conditions $(q_0, p_0)$, step size $h$, and total time $T$, we perform the following:\n$1$. Calculate the number of steps $N = \\mathrm{round}(T/h)$ and the effective integration time $T_{\\text{eff}} = N h$.\n$2$. For both methods, iterate the respective matrix update $N$ times to find the final state $(q_N, p_N)$.\n$3$. The initial radius is $R_0 = \\sqrt{q_0^2 + p_0^2}$. The final radius is $R_N = \\sqrt{q_N^2 + p_N^2}$. The amplitude ratio is $\\rho = R_N / R_0$. This ratio measures the numerical energy dissipation or growth, as $H = \\frac{1}{2}R^2$.\n$4$. The initial phase is $\\phi_0 = \\mathrm{atan2}(p_0, q_0)$. The exact solution has a phase that evolves as $\\phi(t) = \\phi_0 - t$. Thus, the exact final phase is $\\phi_{\\text{exact}} = \\phi_0 - T_{\\text{eff}}$.\n$5$. The numerical final phase is $\\phi_{\\text{num}} = \\mathrm{atan2}(p_N, q_N)$.\n$6$. The phase error is the minimal angle difference $\\Delta\\phi = \\phi_{\\text{num}} - \\phi_{\\text{exact}}$. This is wrapped into the interval $[-\\pi, \\pi]$ using $((\\Delta\\phi + \\pi) \\pmod{2\\pi}) - \\pi$. We report the absolute value $|\\Delta\\phi|$.\n$7.\n$ We compare the absolute phase errors to determine if the Heun method's error is strictly greater than the Symplectic Euler's.",
            "answer": "[[2.633519,1.319391,1.051410,1.000000,True],[0.407421,2.569482,7.394145,1.000000,False],[0.392701,0.392949,1.007873,1.000000,False]]"
        },
        {
            "introduction": "Finally, we tackle a more subtle and advanced concept that highlights the distinction between the properties of a numerical method and the properties of the physical system it models. A key property related to symplecticity is time-reversibility, but what happens when we apply a time-reversible integrator to a physically irreversible system, such as a damped oscillator with friction? This fascinating practice challenges you to build a symmetric, reversible integrator for a non-reversible system and investigate the counter-intuitive numerical behaviors, like momentary energy gains, that can arise. ",
            "id": "3235432",
            "problem": "Consider the linear damped harmonic oscillator defined by the system of ordinary differential equations\n$$\n\\dot{q}(t) = p(t), \\quad \\dot{p}(t) = -k\\,q(t) - \\gamma\\,p(t),\n$$\nwhere $q$ is position, $p$ is momentum, $k>0$ is stiffness, and $\\gamma \\ge 0$ is a linear drag coefficient. The mechanical energy of the undamped oscillator is\n$$\nE(q,p) = \\frac{1}{2}p^2 + \\frac{1}{2}k\\,q^2.\n$$\nIn the absence of drag ($\\gamma=0$), this system is Hamiltonian and admits structure-preserving, time-reversible integration methods. With drag ($\\gamma>0$), the system is physically irreversible under time-reversal, yet one may still design a reversible numerical method by composing exact and approximate subflows in a symmetric fashion.\n\nStarting only from core definitions of Hamiltonian flows, linear dissipation, and the concept of symmetric splitting, implement the following in a single program:\n\n1. A reversible integrator for the damped oscillator constructed by splitting the vector field into a Hamiltonian subflow $$(\\dot{q} = p,\\ \\dot{p} = -k\\,q)$$ and a dissipative subflow $$(\\dot{q} = 0,\\ \\dot{p} = -\\gamma\\,p).$$ Use a symmetric composition over a timestep $h$ in the order “half dissipative subflow, full Hamiltonian subflow, half dissipative subflow.” The dissipative subflow over time $h$ must be implemented exactly, and the Hamiltonian subflow must be integrated by a structure-preserving, time-reversible method. The overall integrator must be reversible in the numerical sense that applying it with timestep $h$ followed by timestep $-h$ returns to the original state up to roundoff error.\n\n2. A baseline non-reversible integrator constructed by applying the explicit Euler method directly to the full damped system over timestep $h$.\n\nFor each test case specified below, perform the following tasks:\n\n- Starting from initial conditions $(q_0,p_0)$, simulate $N$ timesteps of size $h$ using the reversible integrator, recording the energy $E_n = E(q_n,p_n)$ at each step. Compute the count of indices $n$ for which $E_{n+1} > E_n$ to quantify any step-to-step energy increases (interpreted as anti-friction-like behavior). Express this count as an integer.\n\n- Repeat the same simulation and energy increase counting using the explicit Euler baseline method.\n\n- Test numerical reversibility of the reversible integrator by applying $N$ steps of size $h$ from $(q_0,p_0)$ and then applying $N$ steps of size $-h$ from the resulting state. Compute the Euclidean norm of the difference between the final state and the initial state, i.e.,\n$$\n\\left\\|\\begin{bmatrix} q_{\\mathrm{final}} \\\\ p_{\\mathrm{final}} \\end{bmatrix} - \\begin{bmatrix} q_0 \\\\ p_0 \\end{bmatrix}\\right\\|_2,\n$$\nand report it as a floating-point number. This quantifies reversibility error.\n\nTest suite parameters:\n\n- Test case 1: $k=1.0$, $\\gamma=0.2$, $h=0.05$, $N=400$, $q_0=1.0$, $p_0=0.0$.\n- Test case 2: $k=1.0$, $\\gamma=0.05$, $h=0.2$, $N=200$, $q_0=1.0$, $p_0=0.0$.\n- Test case 3: $k=5.0$, $\\gamma=0.2$, $h=0.1$, $N=300$, $q_0=0.5$, $p_0=0.5$.\n\nYour program should produce a single line of output containing the results for all test cases as a comma-separated list enclosed in square brackets, where each test case result is itself a list of three values in the order:\n$$\n[\\text{reversibility\\_error},\\ \\text{energy\\_increase\\_count\\_reversible},\\ \\text{energy\\_increase\\_count\\_euler}].\n$$\nFor example, the overall output format must be\n$$\n[[r_1,c_{1,\\mathrm{rev}},c_{1,\\mathrm{euler}}],[r_2,c_{2,\\mathrm{rev}},c_{2,\\mathrm{euler}}],[r_3,c_{3,\\mathrm{rev}},c_{3,\\mathrm{euler}}]].\n$$\nAll quantities are dimensionless for this task. Angles are not involved. Each count is an integer; each reversibility error is a floating-point number.",
            "solution": "The problem presented is a valid exercise in geometric numerical integration. It requires the implementation and analysis of two different numerical methods for the damped harmonic oscillator, a canonical system in physics and engineering. The problem is scientifically grounded, well-posed, and all necessary parameters are provided. We shall proceed with a complete solution.\n\nThe system of ordinary differential equations (ODEs) for the linear damped harmonic oscillator is given by\n$$\n\\begin{cases}\n\\dot{q}(t) = p(t) \\\\\n\\dot{p}(t) = -k\\,q(t) - \\gamma\\,p(t)\n\\end{cases}\n$$\nwhere $q$ is the position, $p$ is the momentum, $k > 0$ is the stiffness constant, and $\\gamma \\ge 0$ is the linear drag coefficient. The mechanical energy of the corresponding undamped system ($\\gamma=0$) is\n$$\nE(q,p) = \\frac{1}{2}p^2 + \\frac{1}{2}k\\,q^2.\n$$\nThe rate of change of this energy for the damped system is $\\dot{E} = \\frac{\\partial E}{\\partial q}\\dot{q} + \\frac{\\partial E}{\\partial p}\\dot{p} = (k\\,q)(p) + (p)(-k\\,q - \\gamma\\,p) = -\\gamma\\,p^2$. Since $\\gamma \\ge 0$, $\\dot{E} \\le 0$, meaning the energy of the true physical system is non-increasing.\n\nThe problem asks for the construction of two numerical integrators.\n\n### Integrator 1: A Symmetric Reversible Integrator\n\nThis integrator is constructed using the principle of operator splitting. The vector field $f(q,p) = (p, -k\\,q - \\gamma\\,p)$ is split into a Hamiltonian part $f_A$ and a dissipative part $f_B$:\n$$\nf_A(q,p) = \\begin{pmatrix} p \\\\ -k\\,q \\end{pmatrix}, \\quad f_B(q,p) = \\begin{pmatrix} 0 \\\\ -\\gamma\\,p \\end{pmatrix}.\n$$\nThe one-step map for a timestep $h$, denoted $\\Psi_h$, is constructed using a symmetric Strang splitting, which is a second-order composition:\n$$\n\\Psi_h = \\Phi_B^{h/2} \\circ \\Phi_A^{h} \\circ \\Phi_B^{h/2},\n$$\nwhere $\\Phi_A^t$ and $\\Phi_B^t$ are the exact flow maps for the subsystems $\\dot{y} = f_A(y)$ and $\\dot{y} = f_B(y)$, respectively, over a time $t$.\n\n**1. Dissipative Subflow $\\Phi_B^t$:**\nThe subsystem is $\\dot{q} = 0$, $\\dot{p} = -\\gamma\\,p$. The exact solution is:\n$$\nq(t) = q(0), \\quad p(t) = p(0)\\,e^{-\\gamma t}.\n$$\nThus, the flow map is $\\Phi_B^t(q_0, p_0) = (q_0, p_0\\,e^{-\\gamma t})$.\n\n**2. Hamiltonian Subflow $\\Phi_A^t$:**\nThe subsystem is $\\dot{q} = p$, $\\dot{p} = -k\\,q$. This is a linear Hamiltonian system. We can find its exact flow map, which is intrinsically structure-preserving (symplectic) and time-reversible. The system can be written in matrix form:\n$$\n\\frac{d}{dt}\\begin{pmatrix} q \\\\ p \\end{pmatrix} = \\begin{pmatrix} 0 & 1 \\\\ -k & 0 \\end{pmatrix} \\begin{pmatrix} q \\\\ p \\end{pmatrix}.\n$$\nThe solution is given by the matrix exponential. Let $\\omega = \\sqrt{k}$. The solution operator is\n$$\n\\exp\\left(t\\begin{pmatrix} 0 & 1 \\\\ -k & 0 \\end{pmatrix}\\right) = \\begin{pmatrix} \\cos(\\omega t) & \\frac{1}{\\omega}\\sin(\\omega t) \\\\ -\\omega\\sin(\\omega t) & \\cos(\\omega t) \\end{pmatrix}.\n$$\nSo, the flow map is a rotation in scaled phase space:\n$$\n\\Phi_A^t(q_0, p_0) = \\left( q_0\\cos(\\omega t) + \\frac{p_0}{\\omega}\\sin(\\omega t), -q_0\\omega\\sin(\\omega t) + p_0\\cos(\\omega t) \\right).\n$$\n\n**3. Composition for $\\Psi_h$:**\nLet $(q_n, p_n)$ be the state at time $t_n$. To get $(q_{n+1}, p_{n+1})$, we apply the three steps:\na. Apply $\\Phi_B^{h/2}$: $(q', p') = (q_n, p_n\\,e^{-\\gamma h/2})$.\nb. Apply $\\Phi_A^{h}$ to $(q', p')$:\n$$\nq'' = q'\\cos(\\omega h) + \\frac{p'}{\\omega}\\sin(\\omega h) \\\\\np'' = -q'\\omega\\sin(\\omega h) + p'\\cos(\\omega h)\n$$\nc. Apply $\\Phi_B^{h/2}$ to $(q'', p'')$:\n$$\nq_{n+1} = q'' \\\\\np_{n+1} = p''\\,e^{-\\gamma h/2}\n$$\nThis defines one step of the reversible integrator. Its numerical reversibility, $\\Psi_{-h} = (\\Psi_h)^{-1}$, follows from the time-reversibility of the exact sub-flows.\n\n### Integrator 2: Explicit Euler Baseline\n\nThe explicit Euler method is a first-order, non-reversible method. Applied to the full system with a timestep $h$, it updates the state $(q_n, p_n)$ to $(q_{n+1}, p_{n+1})$ as follows:\n$$\n\\begin{pmatrix} q_{n+1} \\\\ p_{n+1} \\end{pmatrix} = \\begin{pmatrix} q_n \\\\ p_n \\end{pmatrix} + h \\begin{pmatrix} p_n \\\\ -k\\,q_n - \\gamma\\,p_n \\end{pmatrix}\n$$\nThis gives the explicit update rules:\n$$\nq_{n+1} = q_n + h\\,p_n \\\\\np_{n+1} = p_n + h(-k\\,q_n - \\gamma\\,p_n) = (1 - h\\gamma)p_n - h k\\,q_n\n$$\n\n### Analysis Tasks\n\nFor each test case, the problem requires calculating three quantities:\n1.  **Reversibility Error:** For the reversible integrator, we propagate the initial state $(q_0, p_0)$ for $N$ steps with timestep $h$ to get $(q_f, p_f)$, and then propagate $(q_f, p_f)$ for $N$ steps with timestep $-h$ to get $(q_{\\mathrm{final}}, p_{\\mathrm{final}})$. The error is the Euclidean norm of the difference vector: $\\|\\begin{bmatrix} q_{\\mathrm{final}} \\\\ p_{\\mathrm{final}} \\end{bmatrix} - \\begin{bmatrix} q_0 \\\\ p_0 \\end{bmatrix}\\|_2$. This should be close to floating-point precision.\n2.  **Energy Increase Count (Reversible):** We simulate for $N$ steps and count the number of steps $n$ ($0 \\le n < N$) for which $E(q_{n+1}, p_{n+1}) > E(q_n, p_n)$. This quantifies non-physical, step-to-step energy gains.\n3.  **Energy Increase Count (Euler):** The same count is computed for the explicit Euler method simulation.\n\nThe code below implements these integrators and performs the required analyses for the specified test cases.",
            "answer": "[[1.2588147814036384e-14,199,0],[2.585807986184766e-14,99,0],[2.1265203000572118e-14,149,0]]"
        }
    ]
}