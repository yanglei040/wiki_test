{
    "hands_on_practices": [
        {
            "introduction": "页式内存管理的核心机制是将程序使用的虚拟地址转换为物理内存中的实际地址。本次实践将通过一个具体的计算任务，帮助你掌握这一基本转换过程。你将学会如何从一个给定的虚拟地址中分离出页号和页内偏移，并利用页表信息计算出最终的物理地址，同时识别出何时会发生缺页中断。",
            "id": "3623012",
            "problem": "考虑一个单级分页系统，用于一个虚拟地址空间大小为 $2^{24}$ 字节的进程。页面大小为 $4\\,\\text{KiB}$，即 $2^{12}$ 字节。物理内存被组织成与页面大小相同的帧，帧索引范围从 $0$ 到 $2047$。当一个被引用的虚拟页面没有到物理帧的有效映射时，会发生缺页中断。\n\n该进程有以下部分页到帧的映射（列表中没有的映射意味着该页面当前未驻留，并将导致缺页中断）：\n- 虚拟页 $7$ 映射到物理帧 $33$。\n- 虚拟页 $15$ 映射到物理帧 $81$。\n- 虚拟页 $205$ 映射到物理帧 $512$。\n- 虚拟页 $3000$ 映射到物理帧 $1020$。\n- 虚拟页 $4095$ 映射到物理帧 $2047$。\n\n给定以下虚拟地址（均以字节为单位）：\n- $VA_1 = 28{,}795$。\n- $VA_2 = 33{,}024$。\n- $VA_3 = 842{,}752$。\n- $VA_4 = 12{,}293{,}120$。\n- $VA_5 = 16{,}777{,}215$。\n- $VA_6 = 61{,}440$。\n\n从核心定义出发，确定每个 $VA_i$ 是引用驻留页面还是引发缺页中断，如果页面驻留，则通过给定的映射转换虚拟地址来确定相应的物理地址。定义 $S$ 为所有驻留引用的物理地址之和，加上列表中缺页中断次数的 $1000$ 倍。计算 $S$。\n\n将 $S$ 的最终答案以字节为单位表示为一个精确的整数，不进行四舍五入，也不带单位。虽然您应在计算过程中识别缺页中断，但只需报告 $S$ 的值。",
            "solution": "该问题要求我们对一系列虚拟地址执行虚拟到物理的地址转换，确定哪些引用导致缺页中断，并根据结果计算最终得分 $S$。\n\n首先，我们确立分页系统中地址转换的基本原则。一个虚拟地址（表示为 $VA$）被划分为两个部分：虚拟页号（$p$）和页内偏移（$d$）。物理地址（$PA$）同样由一个物理帧号（$f$）和相同的偏移量 $d$ 组成。$p$ 到 $f$ 的映射由页表管理。\n\n转换过程如下：\n给定一个 $VA$ 和页面大小 $PS$：\n1.  虚拟页号通过整除计算：$p = \\lfloor \\frac{VA}{PS} \\rfloor$。\n2.  偏移量是余数：$d = VA \\pmod{PS}$。\n3.  查询页表以找到与页号 $p$ 对应的帧号 $f$。\n    - 如果存在有效映射，则该页面驻留在物理内存中。\n    - 如果不存在有效映射，则发生缺页中断。\n4.  如果页面驻留，则物理地址构造如下：$PA = f \\times PS + d$。\n\n根据题目陈述，我们有以下参数：\n- 页面大小为 $PS = 4\\,\\text{KiB} = 2^{12}\\,\\text{字节} = 4096\\,\\text{字节}$。\n- 部分页表映射如下：\n    - 虚拟页 $7 \\to$ 物理帧 $33$。\n    - 虚拟页 $15 \\to$ 物理帧 $81$。\n    - 虚拟页 $205 \\to$ 物理帧 $512$。\n    - 虚拟页 $3000 \\to$ 物理帧 $1020$。\n    - 虚拟页 $4095 \\to$ 物理帧 $2047$。\n\n现在我们将处理每个给定的虚拟地址。设 $N_{faults}$ 为缺页中断计数器，初始值为 $0$，$\\sum PA$ 为驻留页面的物理地址之和，初始值为 $0$。\n\n1.  对于 $VA_1 = 28{,}795$：\n    - 虚拟页号 $p_1 = \\lfloor \\frac{28795}{4096} \\rfloor = \\lfloor 7.0300... \\rfloor = 7$。\n    - 偏移量 $d_1 = 28795 \\pmod{4096} = 123$。\n    - 页表包含虚拟页 $p_1 = 7$ 的映射。对应的物理帧是 $f_1 = 33$。这是一次内存命中。\n    - 物理地址为 $PA_1 = f_1 \\times PS + d_1 = 33 \\times 4096 + 123 = 135168 + 123 = 135291$。\n    - 我们将其加入总和：$\\sum PA = 135291$。\n\n2.  对于 $VA_2 = 33{,}024$：\n    - 虚拟页号 $p_2 = \\lfloor \\frac{33024}{4096} \\rfloor = \\lfloor 8.0625 \\rfloor = 8$。\n    - 偏移量 $d_2 = 33024 \\pmod{4096} = 256$。\n    - 页表不包含虚拟页 $p_2 = 8$ 的映射。这是一次缺页中断。\n    - 我们将缺页中断计数器加一：$N_{faults} = 1$。\n\n3.  对于 $VA_3 = 842{,}752$：\n    - 虚拟页号 $p_3 = \\lfloor \\frac{842752}{4096} \\rfloor = \\lfloor 205.75 \\rfloor = 205$。\n    - 偏移量 $d_3 = 842752 \\pmod{4096} = 3072$。\n    - 页表包含虚拟页 $p_3 = 205$ 的映射。对应的物理帧是 $f_3 = 512$。这是一次内存命中。\n    - 物理地址为 $PA_3 = f_3 \\times PS + d_3 = 512 \\times 4096 + 3072 = 2097152 + 3072 = 2100224$。\n    - 我们将其加入总和：$\\sum PA = 135291 + 2100224 = 2235515$。\n\n4.  对于 $VA_4 = 12{,}293{,}120$：\n    - 虚拟页号 $p_4 = \\lfloor \\frac{12293120}{4096} \\rfloor = \\lfloor 3001.25 \\rfloor = 3001$。\n    - 偏移量 $d_4 = 12293120 \\pmod{4096} = 1024$。\n    - 页表不包含虚拟页 $p_4 = 3001$ 的映射。这是一次缺页中断。\n    - 我们将缺页中断计数器加一：$N_{faults} = 2$。\n\n5.  对于 $VA_5 = 16{,}777{,}215$：\n    - 虚拟页号 $p_5 = \\lfloor \\frac{16777215}{4096} \\rfloor = \\lfloor 4095.999... \\rfloor = 4095$。注意 $16777215 = 2^{24}-1$。因此，$p_5=\\lfloor \\frac{2^{24}-1}{2^{12}} \\rfloor = \\lfloor 2^{12} - 2^{-12} \\rfloor = 2^{12}-1=4095$。\n    - 偏移量 $d_5 = 16777215 \\pmod{4096} = 4095$。\n    - 页表包含虚拟页 $p_5 = 4095$ 的映射。对应的物理帧是 $f_5 = 2047$。这是一次内存命中。\n    - 物理地址为 $PA_5 = f_5 \\times PS + d_5 = 2047 \\times 4096 + 4095 = 8384512 + 4095 = 8388607$。\n    - 我们将其加入总和：$\\sum PA = 2235515 + 8388607 = 10624122$。\n\n6.  对于 $VA_6 = 61{,}440$：\n    - 虚拟页号 $p_6 = \\lfloor \\frac{61440}{4096} \\rfloor = \\lfloor 15 \\rfloor = 15$。\n    - 偏移量 $d_6 = 61440 \\pmod{4096} = 0$。\n    - 页表包含虚拟页 $p_6 = 15$ 的映射。对应的物理帧是 $f_6 = 81$。这是一次内存命中。\n    - 物理地址为 $PA_6 = f_6 \\times PS + d_6 = 81 \\times 4096 + 0 = 331776$。\n    - 我们将其加入总和：$\\sum PA = 10624122 + 331776 = 10955898$。\n\n处理完所有虚拟地址后，我们有以下总结：\n- 驻留页面的物理地址总和：$\\sum PA = 10955898$。\n- 缺页中断总数：$N_{faults} = 2$。\n\n最后，我们使用给定的公式计算 $S$ 的值：\n$S = (\\sum PA) + 1000 \\times N_{faults}$\n$S = 10955898 + 1000 \\times 2$\n$S = 10955898 + 2000$\n$S = 10957898$。",
            "answer": "$$\\boxed{10957898}$$"
        },
        {
            "introduction": "对于现代操作系统支持的巨大虚拟地址空间而言，简单的单级页表在空间上是不可行的。因此，多级页表结构被广泛采用。本练习将引导你剖析一个32位虚拟地址，将其分解为用于索引多级页表的各个部分以及页内偏移，这对于理解操作系统如何高效管理海量内存至关重要。",
            "id": "3623008",
            "problem": "一个计算机系统在其虚拟内存子系统中实现了两级分页。虚拟地址 (VA) 是一个 $32$ 位的无符号整数。页的大小为 $4$ kibibyte (KiB)，两级页表布局使用 $p_{1} = 10$ 位来索引外层页表，使用 $p_{2} = 10$ 位来索引内层页表。页内偏移量使用剩余的低位比特。因此，这个 $32$ 位虚拟地址的比特布局，从最高有效位到最低有效位，是 $[p_{1}][p_{2}][\\text{offset}]$。假设按照常规解释，最高有效位是第 $31$ 位，最低有效位是第 $0$ 位，并且该布局应用于虚拟地址整数值的逻辑比特字段（与字节序无关）。\n\n使用具体的虚拟地址 (VA) 值 $VA = \\texttt{0xCAFEBABE}$，计算：\n- 外层页表索引的数值（$p_{1}$ 比特字段），\n- 内层页表索引的数值（$p_{2}$ 比特字段），\n- 页内偏移量的数值。\n\n将您的最终答案表示为一个单行矩阵，其中包含三个整数，顺序为外层索引、内层索引、偏移量。不需要四舍五入，也不涉及物理单位。",
            "solution": "首先评估问题的有效性。\n\n### 步骤 1：提取已知条件\n- 虚拟地址 ($VA$) 大小：$32$ 位无符号整数。\n- 分页方案：两级。\n- 页大小：$4$ kibibyte (KiB)。\n- 外层页表索引字段大小：$p_1 = 10$ 位。\n- 内层页表索引字段大小：$p_2 = 10$ 位。\n- 偏移量字段大小：剩余的低位比特。\n- $VA$ 比特布局（从最高有效位到最低有效位）：$[p_1][p_2][\\text{offset}]$。\n- 要分析的具体 $VA$：$VA = \\texttt{0xCAFEBABE}$。\n- 要求输出：外层索引、内层索引和偏移量的数值。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据，因为两级分页是操作系统中一种标准的内存管理技术。检查给定参数的内部一致性。\n\n页大小为 $4$ KiB。一千位二进制字节 (one kibibyte) 是 $2^{10}$ 字节，所以页大小是 $4 \\times 2^{10} = 2^2 \\times 2^{10} = 2^{12}$ 字节。页内字节偏移量所需的比特数（我们称之为 $d$）由页大小决定：\n$$d = \\log_2(\\text{Page Size in bytes}) = \\log_2(2^{12}) = 12 \\text{ bits}$$\n虚拟地址的总比特数是索引和偏移量比特数的总和：\n$$\\text{Total bits} = p_1 + p_2 + d = 10 + 10 + 12 = 32 \\text{ bits}$$\n这与指定的 $32$ 位虚拟地址大小相匹配。该问题是自包含、一致且定义良好的。\n\n### 步骤 3：结论与行动\n问题有效。将推导解答。\n\n### 解答推导\n\n虚拟地址是一个 $32$ 位的值。其结构从最高有效位 (MSB) 第 $31$ 位到最低有效位 (LSB) 第 $0$ 位定义。\n- 外层页表索引 $p_1$ 由 $10$ 个最高有效位组成（从第 $31$ 位到第 $22$ 位）。\n- 内层页表索引 $p_2$ 由接下来的 $10$ 位组成（从第 $21$ 位到第 $12$ 位）。\n- 偏移量 $d$ 由 $12$ 个最低有效位组成（从第 $11$ 位到第 $0$ 位）。\n\n要分析的具体虚拟地址以十六进制形式给出，为 $VA = \\texttt{0xCAFEBABE}$。为了提取这些字段，我们首先将这个十六进制值转换为其 $32$ 位二进制表示。每个十六进制数字对应 $4$ 个二进制位：\n- $\\texttt{C}_{16} = 12_{10} = 1100_2$\n- $\\texttt{A}_{16} = 10_{10} = 1010_2$\n- $\\texttt{F}_{16} = 15_{10} = 1111_2$\n- $\\texttt{E}_{16} = 14_{10} = 1110_2$\n- $\\texttt{B}_{16} = 11_{10} = 1011_2$\n\n为 $VA = \\texttt{0xCAFEBABE}$ 组合完整的二进制字符串：\n$$VA_{\\text{bin}} = 11001010111111101011101010111110_2$$\n\n现在，我们根据指定的字段大小（$10$、$10$ 和 $12$ 位）将这个 $32$ 位的字符串划分为三个字段：\n$$VA_{\\text{bin}} = \\underbrace{1100101011}_{p_1 \\text{ (10 bits)}} \\underbrace{1111101011}_{p_2 \\text{ (10 bits)}} \\underbrace{101010111110}_{d \\text{ (12 bits)}}$$\n\n我们接着计算每个字段的十进制值。\n\n1.  **外层页表索引 ($p_1$)**：\n    二进制值为 $1100101011_2$。其十进制等价值为：\n    $$p_1 = 1 \\cdot 2^9 + 1 \\cdot 2^8 + 0 \\cdot 2^7 + 0 \\cdot 2^6 + 1 \\cdot 2^5 + 0 \\cdot 2^4 + 1 \\cdot 2^3 + 0 \\cdot 2^2 + 1 \\cdot 2^1 + 1 \\cdot 2^0$$\n    $$p_1 = 512 + 256 + 0 + 0 + 32 + 0 + 8 + 0 + 2 + 1 = 811$$\n\n2.  **内层页表索引 ($p_2$)**：\n    二进制值为 $1111101011_2$。其十进制等价值为：\n    $$p_2 = 1 \\cdot 2^9 + 1 \\cdot 2^8 + 1 \\cdot 2^7 + 1 \\cdot 2^6 + 1 \\cdot 2^5 + 0 \\cdot 2^4 + 1 \\cdot 2^3 + 0 \\cdot 2^2 + 1 \\cdot 2^1 + 1 \\cdot 2^0$$\n    $$p_2 = 512 + 256 + 128 + 64 + 32 + 0 + 8 + 0 + 2 + 1 = 1003$$\n\n3.  **偏移量 ($d$)**：\n    二进制值为 $101010111110_2$。这对应于最后三个十六进制数字 $\\texttt{ABE}_{16}$。其十进制等价值为：\n    $$d = 10 \\cdot 16^2 + 11 \\cdot 16^1 + 14 \\cdot 16^0$$\n    $$d = 10 \\cdot 256 + 11 \\cdot 16 + 14 \\cdot 1$$\n    $$d = 2560 + 176 + 14 = 2750$$\n    或者，从其二进制表示计算：\n    $$d = 1 \\cdot 2^{11} + 0 \\cdot 2^{10} + 1 \\cdot 2^9 + 0 \\cdot 2^8 + 1 \\cdot 2^7 + 0 \\cdot 2^6 + 1 \\cdot 2^5 + 1 \\cdot 2^4 + 1 \\cdot 2^3 + 1 \\cdot 2^2 + 1 \\cdot 2^1 + 0 \\cdot 2^0$$\n    $$d = 2048 + 512 + 128 + 32 + 16 + 8 + 4 + 2 = 2750$$\n\n计算出的整数值为：外层页表索引为 $811$，内层页表索引为 $1003$，偏移量为 $2750$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n811  1003  2750\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "每次内存访问都查询内存中的页表会带来巨大的性能开销。为了解决这个问题，现代处理器都配备了旁路转换缓冲（TLB），一个用于缓存近期地址转换信息的高速硬件。通过本练习，你将学会计算有效访问时间（EAT），这是一个衡量TLB性能影响的关键指标，从而将分页的理论机制与系统的实际性能联系起来。",
            "id": "3623058",
            "problem": "一个计算机系统使用单级分页和一个容量为 $64$ 条目的转换后备缓冲区 (Translation Lookaside Buffer, TLB)。在稳定工作负载下，测得的 TLB 命中率为 $h = 0.9$。主存访问时间为每次访问 $t_m$ 秒。TLB 查找与主存地址转换并行执行，因此在 TLB 命中的情况下，只需一次主存访问即可获取请求的数据。在 TLB 未命中但未导致缺页的情况下，处理器在主存中执行一次单级页表查找，然后继续进行数据访问，总共导致两次主存访问。忽略缺页服务时间以及单级分页模型所隐含的页表读取之外的任何 TLB 重新填充开销。\n\n从分页和概率期望的基本原理出发，推导有效访问时间（表示为 $EAT$）的封闭形式符号表达式，用 $t_m$ 表示。以秒为单位表示最终的有效访问时间。无需四舍五入。",
            "solution": "该问题是有效的，因为它具有科学依据、问题明确且客观。它描述了一个用于计算带有转换后备缓冲区（TLB）和单级分页的系统中有效内存访问时间的标准模型。所提供的数据对于推导所要求的表达式是充分且一致的。\n\n有效访问时间，表示为 $EAT$，是内存访问所需时间的期望值。它的计算方式是所有可能情况的访问时间的加权平均值，其中权重是这些情况发生的概率。在此系统中，一次内存访问可能导致两种结果之一：TLB 命中或 TLB 未命中。根据题目要求，我们忽略缺页。\n\n设 $h$ 为 TLB 命中率，即在 TLB 中找到页表条目的概率。题目指出 $h = 0.9$。\nTLB 命中的概率为 $P(\\text{hit}) = h$。\n因此，TLB 未命中的概率为 $P(\\text{miss}) = 1 - h$。\n\n接下来，我们必须确定与每种结果相关的时间成本。主存访问时间给定为 $t_m$ 秒。\n\n情况 1：TLB 命中\n题目指出，在 TLB 命中的情况下，在 TLB 中找到转换，然后“只需一次主存访问即可获取请求的数据”。这意味着在 TLB 命中的情况下，内存访问所需的时间 $T_{\\text{hit}}$ 是一次访问主存的时间。\n$$T_{\\text{hit}} = t_m$$\nTLB 查找本身的时间被认为是可忽略的，这在此类模型中很常见，或者它是并行执行的，并且在单次内存访问之外不会增加关键路径时间。\n\n情况 2：TLB 未命中（无缺页）\n题目指出，在 TLB 未命中的情况下，处理器首先在主存中执行一次页表查找。由于这是一个单级分页系统，此查找需要一次主存访问来获取页表条目。在获取物理帧号后，处理器执行第二次主存访问以获取实际数据。问题陈述证实了这一点：“...总共导致两次主存访问。”\n因此，在 TLB 未命中的情况下，内存访问所需的时间 $T_{\\text{miss}}$ 是这两次访问时间的总和。\n$$T_{\\text{miss}} = t_m + t_m = 2t_m$$\n\n现在，我们可以利用期望值原理来构建有效访问时间（$EAT$）的表达式：\n$$EAT = P(\\text{hit}) \\times T_{\\text{hit}} + P(\\text{miss}) \\times T_{\\text{miss}}$$\n代入上面推导出的概率和时间成本：\n$$EAT = h \\cdot T_{\\text{hit}} + (1 - h) \\cdot T_{\\text{miss}}$$\n$$EAT = h \\cdot (t_m) + (1 - h) \\cdot (2t_m)$$\n\n为了推导以 $t_m$ 表示的封闭形式符号表达式，我们进行代数简化：\n$$EAT = h \\cdot t_m + 2t_m - 2h \\cdot t_m$$\n$$EAT = (h - 2h) \\cdot t_m + 2t_m$$\n$$EAT = -h \\cdot t_m + 2t_m$$\n将 $t_m$ 因子提取出来，我们得到通用的符号表达式：\n$$EAT = (2 - h)t_m$$\n\n题目给出了命中率的具体数值 $h = 0.9$。我们将这个值代入符号表达式中以求得最终答案。\n$$EAT = (2 - 0.9)t_m$$\n$$EAT = 1.1 t_m$$\n单位是秒，因为 $t_m$ 的单位是秒。TLB 容量为 $64$ 条目是关于系统硬件的背景信息，但对于计算 $EAT$ 不是必需的。",
            "answer": "$$\\boxed{1.1 t_m}$$"
        }
    ]
}