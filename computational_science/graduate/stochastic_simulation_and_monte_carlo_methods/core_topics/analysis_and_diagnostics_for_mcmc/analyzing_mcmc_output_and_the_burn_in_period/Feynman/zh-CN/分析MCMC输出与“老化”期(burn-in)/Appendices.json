{
    "hands_on_practices": [
        {
            "introduction": "一旦我们完成了 MCMC 模拟，首要任务就是报告我们对目标期望值的估计及其不确定性。这个练习将指导你完成分析的最后一步：利用根据马尔可夫链中心极限定理得到的渐近方差估计，计算蒙特卡洛标准误差 (MCSE) 和置信区间。通过这个基于假设数据的计算，你将掌握如何量化 MCMC 估计量的精度。",
            "id": "3287635",
            "problem": "一位实践者运行马尔可夫链蒙特卡洛（MCMC）算法，以估计在 $\\mathbb{R}$ 上的平稳目标分布 $\\pi$ 下，可测函数 $f$ 的期望 $\\mathbb{E}_{\\pi} f$。该链由随机游走Metropolis转移构建，并且已知是几何遍历的。该实践者丢弃了 $B$ 次迭代的预热期（burn-in）以减轻瞬态偏差，并保留了 $n$ 个预热期后的样本 $\\{X_{B+1},\\dots,X_{B+n}\\}$，这些样本被假定为近似平稳的。令 $\\bar{f}_{n} = n^{-1}\\sum_{t=1}^{n} f(X_{B+t})$ 表示预热期后的平均值。\n\n从马尔可夫链中心极限定理以及蒙特卡洛标准误差（MCSE）的定义出发（MCSE定义为当样本由遍历马尔可夫链生成时，在 $\\pi$ 下 $\\bar{f}_{n}$ 的抽样分布的标准差），推导如何为 $\\mathbb{E}_{\\pi} f$ 构建一个考虑了自相关性的大样本置信区间。解释为什么丢弃预热期不会改变 $\\bar{f}_{n}$ 的渐近分布，但却被用来减少有限样本中的偏差。\n\n假设从 $n$ 个预热期后样本计算出的 $\\sqrt{n}(\\bar{f}_{n}-\\mathbb{E}_{\\pi} f)$ 的渐近方差的一个相合谱（或分批均值）估计量得出 $\\hat{\\sigma}^{2}_{f} = 2.5$。再假设 $n = 10^{5}$ 且观察到的预热期后平均值为 $\\bar{f}_{n} = 0.7321$。\n\n计算：\n- 蒙特卡洛标准误差（MCSE）。\n- 基于正态近似的 $\\mathbb{E}_{\\pi} f$ 的 $95\\%$ 置信区间。\n\n将所有数值答案四舍五入到四位有效数字。不要使用百分号；通过标准正态分位数来解释 $95\\%$。",
            "solution": "令 $\\mu_{f} = \\mathbb{E}_{\\pi} f$ 为目标期望。我们已知基于 $n$ 个预热期后样本的MCMC样本均值为 $\\bar{f}_{n} = \\frac{1}{n} \\sum_{t=1}^{n} f(X_{B+t})$。\n\n首先，我们讨论置信区间的理论构建。其基础是马尔可夫链中心极限定理（CLT）。对于一个几何遍历的马尔可夫链 $\\{X_t\\}$ 和一个满足 $\\mathbb{E}_\\pi [f(X_1)^2]  \\infty$ 的实值函数 $f$，中心极限定理指出：\n$$\n\\sqrt{n} (\\bar{f}_n - \\mu_f) \\xrightarrow{d} N(0, \\sigma^2_f)\n$$\n当 $n \\to \\infty$ 时，其中 $\\xrightarrow{d}$ 表示依分布收敛，$N(0, \\sigma^2_f)$ 是一个均值为 $0$、方差为 $\\sigma^2_f$ 的正态分布。渐近方差 $\\sigma^2_f$ 由下式给出：\n$$\n\\sigma^2_f = \\text{Var}_{\\pi}(f(X_1)) + 2 \\sum_{k=1}^{\\infty} \\text{Cov}_{\\pi}(f(X_1), f(X_{1+k}))\n$$\n这个表达式表明，$\\sigma^2_f$ 包含了在平稳分布 $\\pi$ 下 $f(X_1)$ 的方差，以及所有不同滞后 $k$ 的自协方差。这就是针对相关样本的中心极限定理如何考虑自相关性的方式。如果样本是独立的，所有协方差项都将为零，$\\sigma^2_f$ 将简化为 $\\text{Var}_{\\pi}(f(X_1))$。\n\n根据中心极限定理，对于大样本量 $n$，估计量 $\\bar{f}_n$ 的抽样分布可以近似为一个正态分布：\n$$\n\\bar{f}_n \\approx N\\left(\\mu_f, \\frac{\\sigma^2_f}{n}\\right)\n$$\n蒙特卡洛标准误差（MCSE）被定义为该抽样分布的标准差，即 $\\text{MCSE}(\\bar{f}_n) = \\sqrt{\\frac{\\sigma^2_f}{n}}$。为了使其具有可操作性，我们必须从样本中估计未知的 $\\sigma^2_f$。问题中提到，一个相合的估计量 $\\hat{\\sigma}^2_f$ 是可用的（通过诸如零频率谱分析或分批均值等方法计算）。于是，估计的MCSE为：\n$$\n\\widehat{\\text{MCSE}}(\\bar{f}_n) = \\sqrt{\\frac{\\hat{\\sigma}^2_f}{n}} = \\frac{\\hat{\\sigma}_f}{\\sqrt{n}}\n$$\n通过对 $\\bar{f}_n$ 进行标准化，可以构建一个 $\\mu_f$ 的大样本 $(1-\\alpha) \\times 100\\%$ 置信区间：\n$$\n\\frac{\\bar{f}_n - \\mu_f}{\\widehat{\\text{MCSE}}(\\bar{f}_n)} \\approx N(0, 1)\n$$\n这导出了置信区间的公式：\n$$\n\\bar{f}_n \\pm z_{1-\\alpha/2} \\cdot \\widehat{\\text{MCSE}}(\\bar{f}_n)\n$$\n其中 $z_{1-\\alpha/2}$ 是标准正态分布的 $(1-\\alpha/2)$-分位数。\n\n其次，我们讨论预热期的作用。丢弃最初的 $B$ 个样本不会改变 $\\bar{f}_n$ 的渐近分布。中心极限定理是当样本量 $n \\to \\infty$ 时的极限结果。任何有限数量的初始样本（例如 $B$ 个预热期样本）的影响在这个极限下都变得可以忽略不计。通过 $\\sqrt{n}$ 的归一化确保了固定数量项的贡献会消失。因此，无论我们是从 $t=1$ 还是从 $t=B+1$ 开始求和，渐近方差 $\\sigma^2_f$ 和极限正态分布都是相同的。然而，对于有限的样本量 $n$，预热期对于减少偏差至关重要。MCMC链从某个初始状态 $X_0$ 开始，该状态通常不是从平稳分布 $\\pi$ 中抽取的样本。对于较小的 $t$，$X_t$ 的分布尚未收敛到 $\\pi$。因此，期望 $\\mathbb{E}[f(X_t) \\mid X_0]$ 不等于 $\\mu_f = \\mathbb{E}_{\\pi} f$。通过丢弃前 $B$ 次迭代（其中 $B$ 被选择得足够大，以使链“忘记”其起始点，并使 $X_B$ 的分布接近 $\\pi$），我们确保保留的样本 $\\{X_{B+1}, \\dots, X_{B+n}\\}$ 近似服从分布 $\\pi$。这使得估计量 $\\bar{f}_n$ 对于 $\\mu_f$ 是近似无偏的，即 $\\mathbb{E}[\\bar{f}_n] \\approx \\mu_f$。如果没有预热期，由于链初始非平稳部分的影响，估计量将存在“瞬态偏差”。\n\n最后，我们计算所需的量。\n给定的数据是：\n- 样本量：$n = 10^5$\n- 预热期后平均值：$\\bar{f}_n = 0.7321$\n- 估计的渐近方差：$\\hat{\\sigma}^2_f = 2.5$\n\n蒙特卡洛标准误差（MCSE）估计如下：\n$$\n\\widehat{\\text{MCSE}} = \\sqrt{\\frac{\\hat{\\sigma}^2_f}{n}} = \\sqrt{\\frac{2.5}{10^5}} = \\sqrt{2.5 \\times 10^{-5}} = \\sqrt{25 \\times 10^{-6}} = 5 \\times 10^{-3} = 0.005\n$$\n四舍五入到四位有效数字，MCSE为 $0.005000$。\n\n对于 $95\\%$ 置信区间，显著性水平为 $\\alpha = 0.05$。相应的标准正态分位数为 $z_{1-\\alpha/2} = z_{0.975}$。我们使用标准值 $z_{0.975} \\approx 1.960$。\n误差范围（$ME$）为：\n$$\nME = z_{0.975} \\times \\widehat{\\text{MCSE}} \\approx 1.960 \\times 0.005000 = 0.009800\n$$\n$\\mathbb{E}_{\\pi} f$ 的 $95\\%$ 置信区间由 $\\bar{f}_n \\pm ME$ 给出：\n$$\n0.7321 \\pm 0.009800\n$$\n下界是：\n$$\nL = 0.7321 - 0.009800 = 0.7223\n$$\n上界是：\n$$\nU = 0.7321 + 0.009800 = 0.7419\n$$\n两个界限都已经是四位有效数字。因此，$95\\%$ 置信区间为 $[0.7223, 0.7419]$。\n\n数值答案总结：\n- MCSE: $0.005000$\n- $95\\%$ CI: $[0.7223, 0.7419]$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0.005000  0.7223  0.7419 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "上一个练习中使用的“渐近方差”并非凭空而来，它必须从样本数据中估计得出，并恰当地反映样本间的自相关性。这个实践将向你展示一种估计该方差的关键组成部分——积分自相关时间 (IACT) 的标准方法。通过对给定的样本自相关函数应用一种加窗估计量，你将学会如何处理自相关性对估计精度造成的影响。",
            "id": "3287640",
            "problem": "在丢弃初始的预热期（burn-in）后，我们分析一个单变量时间齐次马尔可夫链蒙特卡洛（MCMC）的输出 $\\{X_{t}\\}_{t=1}^{T}$，并且剩余的样本被认为是平稳和遍历的。设中心化过程为 $Y_{t} = X_{t} - \\mu$，其中均值 $\\mu$ 未知，平稳自协方差函数为 $\\gamma_{k} = \\operatorname{Cov}(Y_{t}, Y_{t+k})$，自相关函数为 $\\rho_{k} = \\gamma_{k}/\\gamma_{0}$。积分自相关时间 (IACT) $\\tau_{\\text{int}}$ 是通过马尔可夫链中心极限定理，由样本均值的渐近方差来定义的，即 $\\operatorname{Var}(\\bar{X}_{T}) \\approx \\sigma^{2}\\tau_{\\text{int}}/T$，其中 $\\sigma^{2} = \\gamma_{0}$ 且 $\\tau_{\\text{int}} = 1 + 2\\sum_{k=1}^{\\infty} \\rho_{k}$。 \n\n给定滞后阶数最高为 10 的样本自相关：$\\hat{\\rho}_{1} = 0.82$, $\\hat{\\rho}_{2} = 0.67$, $\\hat{\\rho}_{3} = 0.54$, $\\hat{\\rho}_{4} = 0.43$, $\\hat{\\rho}_{5} = 0.35$, $\\hat{\\rho}_{6} = 0.28$, $\\hat{\\rho}_{7} = 0.22$, $\\hat{\\rho}_{8} = 0.17$, $\\hat{\\rho}_{9} = 0.13$, $\\hat{\\rho}_{10} = 0.10$。\n\n考虑一个截断平顶窗估计器，它由一个零频率谱密度估计器和一个带宽 $m = 10$、平顶比例 $r = 1/2$ 的梯形平顶窗构成。定义窗函数 $w(k)$ 为 $w(0) = 1$，$w(k) = 1$ 对于 $1 \\le k \\le r m$，$w(k) = 2 - k/(m(1-r))$ 对于 $r m  k \\le m$，以及 $w(k) = 0$ 对于 $k > m$。在这些设置下，$w(k) = 1$ 对于 $1 \\le k \\le 5$，$w(6) = 0.8$，$w(7) = 0.6$，$w(8) = 0.4$，$w(9) = 0.2$，以及 $w(10) = 0$。\n\n从将平稳过程的渐近方差与零频率谱密度联系起来的基本定义出发，推导基于 $\\hat{\\rho}_{k}$ 和 $w(k)$ 的 $\\tau_{\\text{int}}$ 的窗估计器，然后使用上述数值计算其值。将最终数值答案四舍五入到四位有效数字。另外，在 $\\rho_{k}$ 在滞后 10 之后为正且单调递减的合理假设下，就此估计器的截断偏差的可能方向提供一个简短的定性评论。最终答案只应报告数值。",
            "solution": "首先，我们推导积分自相关时间 $\\tau_{\\text{int}}$ 的窗估计器。我们从样本均值的渐近方差与过程的零频率谱密度之间的基本关系开始。\n\n对于一个平稳过程 $\\{Y_t\\}$，谱密度定义为自协方差函数的傅里叶变换：\n$$S(\\omega) = \\frac{1}{2\\pi} \\sum_{k=-\\infty}^{\\infty} \\gamma_k \\exp(-i\\omega k)$$\n马尔可夫链中心极限定理指出，样本均值 $\\bar{Y}_{T} = \\frac{1}{T}\\sum_{t=1}^{T}Y_t$ 的渐近方差由下式给出：\n$$\\lim_{T \\to \\infty} T \\operatorname{Var}(\\bar{Y}_{T}) = 2\\pi S(0)$$\n其中 $S(0)$ 是频率 $\\omega=0$ 处的谱密度。将 $\\omega=0$ 代入 $S(\\omega)$ 的定义得到：\n$$S(0) = \\frac{1}{2\\pi} \\sum_{k=-\\infty}^{\\infty} \\gamma_k$$\n因此，渐近方差为：\n$$\\lim_{T \\to \\infty} T \\operatorname{Var}(\\bar{Y}_{T}) = \\sum_{k=-\\infty}^{\\infty} \\gamma_k = \\gamma_0 + \\sum_{k=1}^{\\infty} \\gamma_k + \\sum_{k=-1}^{-\\infty} \\gamma_k$$\n利用平稳过程的性质 $\\gamma_k = \\gamma_{-k}$，上式变为：\n$$\\lim_{T \\to \\infty} T \\operatorname{Var}(\\bar{Y}_{T}) = \\gamma_0 + 2\\sum_{k=1}^{\\infty} \\gamma_k$$\n问题陈述中给出了关系 $\\operatorname{Var}(\\bar{X}_{T}) \\approx \\sigma^{2}\\tau_{\\text{int}}/T$。由于 $\\operatorname{Var}(\\bar{X}_{T}) = \\operatorname{Var}(\\bar{Y}_{T})$ 且 $\\sigma^2 = \\gamma_0$，我们有 $T \\operatorname{Var}(\\bar{Y}_{T}) \\approx \\gamma_0 \\tau_{\\text{int}}$。将此与从谱密度推导出的表达式相等，得到：\n$$\\gamma_0 \\tau_{\\text{int}} \\approx \\gamma_0 + 2\\sum_{k=1}^{\\infty} \\gamma_k$$\n除以 $\\gamma_0$ 可恢复 $\\tau_{\\text{int}}$ 的定义：\n$$\\tau_{\\text{int}} \\approx 1 + 2\\sum_{k=1}^{\\infty} \\frac{\\gamma_k}{\\gamma_0} = 1 + 2\\sum_{k=1}^{\\infty} \\rho_k$$\n为了从有限样本中估计 $\\tau_{\\text{int}}$，必须对无穷级数进行近似。使用样本自协方差 $\\hat{\\gamma}_k$ 和一个在有限带宽 $m$ 处截断级数的窗函数 $w(k)$，可以构造出量 $\\gamma_0 \\tau_{\\text{int}} = \\sum_{k=-\\infty}^{\\infty} \\gamma_k$ 的窗估计器：\n$$\\widehat{\\gamma_0 \\tau_{\\text{int}}} = \\sum_{k=-m}^{m} w(k) \\hat{\\gamma}_k$$\n假设窗函数是对称的（$w(k)=w(-k)$）并且给定 $w(0)=1$，该估计器变为：\n$$\\widehat{\\gamma_0 \\tau_{\\text{int}}} = w(0)\\hat{\\gamma}_0 + 2\\sum_{k=1}^{m} w(k) \\hat{\\gamma}_k = \\hat{\\gamma}_0 + 2\\sum_{k=1}^{m} w(k) \\hat{\\gamma}_k$$\n$\\tau_{\\text{int}}$ 的相应估计器，记为 $\\hat{\\tau}_{\\text{int}}$，通过除以 $\\hat{\\gamma}_0$ 获得：\n$$\\hat{\\tau}_{\\text{int}} = 1 + 2\\sum_{k=1}^{m} w(k) \\frac{\\hat{\\gamma}_k}{\\hat{\\gamma}_0} = 1 + 2\\sum_{k=1}^{m} w(k) \\hat{\\rho}_k$$\n这就是所要求的 IACT 的窗估计器。\n\n现在，我们使用给定的数据计算其值。带宽为 $m=10$。\n$$\\hat{\\tau}_{\\text{int}} = 1 + 2\\sum_{k=1}^{10} w(k) \\hat{\\rho}_k$$\n求和项计算如下：\n$$ \\sum_{k=1}^{10} w(k) \\hat{\\rho}_k = \\sum_{k=1}^{5} (1) \\hat{\\rho}_k + \\sum_{k=6}^{9} w(k) \\hat{\\rho}_k + w(10) \\hat{\\rho}_{10} $$\n和的第一部分（平顶部分）是：\n$$ \\sum_{k=1}^{5} \\hat{\\rho}_k = 0.82 + 0.67 + 0.54 + 0.43 + 0.35 = 2.81 $$\n和的第二部分（锥形部分）是：\n$$ \\sum_{k=6}^{9} w(k) \\hat{\\rho}_k = w(6)\\hat{\\rho}_6 + w(7)\\hat{\\rho}_7 + w(8)\\hat{\\rho}_8 + w(9)\\hat{\\rho}_9 $$\n$$ = (0.8)(0.28) + (0.6)(0.22) + (0.4)(0.17) + (0.2)(0.13) $$\n$$ = 0.224 + 0.132 + 0.068 + 0.026 = 0.450 $$\n滞后 $k=10$ 的最后一项为零，因为 $w(10)=0$：\n$$ w(10) \\hat{\\rho}_{10} = (0)(0.10) = 0 $$\n将这些部分合并，总和为：\n$$ \\sum_{k=1}^{10} w(k) \\hat{\\rho}_k = 2.81 + 0.450 + 0 = 3.260 $$\n最后，我们将这个和代回到 $\\hat{\\tau}_{\\text{int}}$ 的表达式中：\n$$ \\hat{\\tau}_{\\text{int}} = 1 + 2(3.260) = 1 + 6.520 = 7.520 $$\n问题要求将答案四舍五入到四位有效数字。计算出的值 $7.520$ 已经有四位有效数字。\n\n另外，要求对截断偏差进行定性评论。真实的积分自相关时间 $\\tau_{\\text{int}}$ 包含自相关项 $\\rho_k$ 的无穷级数。估计器 $\\hat{\\tau}_{\\text{int}}$ 在滞后 $m=10$ 处截断此和，并对滞后 $k > 5$ 的项进行降权（即，对于所有 $k$，$w(k) \\le 1$）。在真实的自相关 $\\rho_k$ 在 $k > 10$ 时保持为正且单调递减的合理假设下，该估计器忽略了一系列正项（$\\sum_{k=11}^{\\infty} \\rho_k$），并减少了其他正项的贡献（$2\\sum_{k=6}^{10} (1-w(k))\\rho_k$ 是被减去的量）。这两种效应都会导致负偏差。因此，该估计器很可能低估了 $\\tau_{\\text{int}}$ 的真实值。",
            "answer": "$$\\boxed{7.520}$$"
        },
        {
            "introduction": "到目前为止，我们的分析都基于一个核心假设：马尔可夫链已经收敛到了平稳分布。然而，在实践中我们必须严格检验这一假设。这个练习将介绍诊断 MCMC 收敛性的黄金标准——Gelman-Rubin 诊断 (也称为 $\\hat{R}$ 统计量)，并将其推广到多维参数的情形。通过比较多条并行链的链内和链间变异，你将学会如何判断模拟是否已经充分“预热”并达到了可靠的平稳状态。",
            "id": "3287654",
            "problem": "一位从业者为一个 $p$ 维参数运行 $m$ 个独立的马尔可夫链蒙特卡洛（MCMC）链，以在预热期后评估收敛性。每条链的前 $b$ 次抽样作为预热期被丢弃，剩下的每条链 $n$ 次抽样用于估计链内和链间的变异性。\n\n设 $p=3$，$m=3$，每条链的总迭代次数为 $N_{\\text{total}}=1500$，预热期为 $b=500$，因此每条链保留 $n=1000$ 次预热后的抽样。假设从这些预热后的抽样中，合并的链内协方差估计量为\n$$\nW \\;=\\; \\begin{pmatrix}\n4  0  0 \\\\\n0  1  0 \\\\\n0  0  9\n\\end{pmatrix},\n$$\n以及缩放后的链间协方差估计量（定义为 $B = n$ 乘以 $m$ 个链均值的样本协方差）为\n$$\nB \\;=\\; \\begin{pmatrix}\n2.4  0  0 \\\\\n0  0.4  0 \\\\\n0  0  4.5\n\\end{pmatrix}.\n$$\n\n使用多链的链内协方差 $W$ 和链间协方差 $B$ 的基本定义，以及将多元估计潜在尺度缩减因子（MPSRF）解释为单变量潜在尺度缩减因子（PSRF）在参数空间所有单位长度线性投影上的上确界，计算预热后抽样的 MPSRF。将您的最终数值答案四舍五入到四位有效数字。",
            "solution": "该问题要求计算多元估计潜在尺度缩减因子（MPSRF）。问题陈述提供了一个关键的解释：MPSRF 是单变量潜在尺度缩减因子（PSRF）在 $p$ 维参数空间的所有单位长度线性投影上的上确界。\n\n设 $\\theta$ 为 $p$ 维参数向量。一个线性投影定义为 $\\psi = u^T \\theta$，其中 $u$ 是一个单位长度的 $p$ 维列向量，即 $u^T u = 1$。标量投影 $\\psi$ 的单变量 PSRF，记作 $\\hat{R}_{\\psi}$，由其平方定义：\n$$ \\hat{R}_{\\psi}^2 = \\frac{\\hat{V}_{\\psi}}{W_{\\psi}} $$\n其中 $W_{\\psi}$ 是 $\\psi$ 的估计链内方差，而 $\\hat{V}_{\\psi}$ 是 $\\psi$ 的估计混合方差。\n\n给定向量 $\\theta$ 的链内协方差矩阵 $W$ 和缩放后的链间协方差矩阵 $B$，投影 $\\psi$ 对应的标量方差由二次型给出：\n$$ W_{\\psi} = u^T W u $$\n$$ B_{\\psi} = u^T B u $$\n\n混合方差 $\\hat{V}_{\\psi}$ 的现代修正估计量，由 Brooks 和 Gelman (1998) 建立并在贝叶斯分析中常用，是链内和链间方差的加权和：\n$$ \\hat{V}_{\\psi} = \\frac{n-1}{n} W_{\\psi} + \\frac{m+1}{mn} B_{\\psi} $$\n这里，$n$ 是每条链预热后的抽样次数，$m$ 是链的数量。问题中提供的 $B$ 的定义，即 $n$ 乘以链均值的样本协方差，与此公式一致。\n\n将 $W_{\\psi}$、$B_{\\psi}$ 和 $\\hat{V}_{\\psi}$ 的表达式代入 $\\hat{R}_{\\psi}^2$ 的公式中，得到：\n$$ \\hat{R}_{\\psi}^2 = \\frac{\\frac{n-1}{n} (u^T W u) + \\frac{m+1}{mn} (u^T B u)}{u^T W u} = \\frac{n-1}{n} + \\frac{m+1}{mn} \\frac{u^T B u}{u^T W u} $$\n\nMPSRF 是 $\\hat{R}_{\\psi}^2$ 在所有可能的单位向量 $u$ 上的上确界的平方根。\n$$ (\\text{MPSRF})^2 = \\sup_{u : u^T u = 1} \\left( \\hat{R}_{\\psi}^2 \\right) = \\sup_{u : u^T u = 1} \\left( \\frac{n-1}{n} + \\frac{m+1}{mn} \\frac{u^T B u}{u^T W u} \\right) $$\n由于项 $\\frac{n-1}{n}$ 和系数 $\\frac{m+1}{mn}$ 相对于 $u$ 是常数，求上确界需要最大化广义瑞利商 $\\frac{u^T B u}{u^T W u}$。\n$$ (\\text{MPSRF})^2 = \\frac{n-1}{n} + \\frac{m+1}{mn} \\sup_{u : u^T u = 1} \\left( \\frac{u^T B u}{u^T W u} \\right) $$\n\n广义瑞利商的上确界是广义特征值问题 $Bv = \\lambda Wv$ 的最大特征值 $\\lambda_{\\max}$。由于 $W$ 是一个协方差矩阵，并且其给定形式是对角矩阵且对角线元素为正，因此它是正定的，从而可逆。因此，这个问题等价于求矩阵 $W^{-1}B$ 的最大特征值。\n\n给定的数据是：\n- 链的数量, $m=3$。\n- 预热后的抽样次数, $n=1000$。\n- 链内协方差矩阵, $W = \\begin{pmatrix} 4  0  0 \\\\ 0  1  0 \\\\ 0  0  9 \\end{pmatrix}$。\n- 缩放后的链间协方差矩阵, $B = \\begin{pmatrix} 2.4  0  0 \\\\ 0  0.4  0 \\\\ 0  0  4.5 \\end{pmatrix}$。\n\n首先，我们计算 $W$ 的逆矩阵。由于 $W$ 是一个对角矩阵，其逆矩阵是对角线上元素为原矩阵对角线元素倒数的对角矩阵：\n$$ W^{-1} = \\begin{pmatrix} 4^{-1}  0  0 \\\\ 0  1^{-1}  0 \\\\ 0  0  9^{-1} \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{4}  0  0 \\\\ 0  1  0 \\\\ 0  0  \\frac{1}{9} \\end{pmatrix} $$\n\n接下来，我们计算乘积 $W^{-1}B$：\n$$ W^{-1}B = \\begin{pmatrix} \\frac{1}{4}  0  0 \\\\ 0  1  0 \\\\ 0  0  \\frac{1}{9} \\end{pmatrix} \\begin{pmatrix} 2.4  0  0 \\\\ 0  0.4  0 \\\\ 0  0  4.5 \\end{pmatrix} $$\n$$ W^{-1}B = \\begin{pmatrix} \\frac{2.4}{4}  0  0 \\\\ 0  0.4  0 \\\\ 0  0  \\frac{4.5}{9} \\end{pmatrix} = \\begin{pmatrix} 0.6  0  0 \\\\ 0  0.4  0 \\\\ 0  0  0.5 \\end{pmatrix} $$\n对角矩阵的特征值就是其对角线上的元素。特征值为 $\\lambda_1 = 0.6$，$\\lambda_2 = 0.4$ 和 $\\lambda_3 = 0.5$。最大特征值是 $\\lambda_{\\max} = 0.6$。\n\n现在，我们将 $n$、$m$ 和 $\\lambda_{\\max}$ 的值代入 $(\\text{MPSRF})^2$ 的表达式中：\n$$ (\\text{MPSRF})^2 = \\frac{1000-1}{1000} + \\frac{3+1}{3 \\times 1000} \\lambda_{\\max} $$\n$$ (\\text{MPSRF})^2 = \\frac{999}{1000} + \\frac{4}{3000} (0.6) $$\n$$ (\\text{MPSRF})^2 = 0.999 + \\frac{2.4}{3000} = 0.999 + 0.0008 $$\n$$ (\\text{MPSRF})^2 = 0.9998 $$\n\n最后，MPSRF 是这个值的平方根：\n$$ \\text{MPSRF} = \\sqrt{0.9998} \\approx 0.999899995 $$\n四舍五入到四位有效数字，我们得到 $0.9999$。",
            "answer": "$$\n\\boxed{0.9999}\n$$"
        }
    ]
}