{
    "hands_on_practices": [
        {
            "introduction": "一阶自回归 (AR(1)) 过程是用于描述马尔可夫链蒙特卡洛 (MCMC) 模拟中样本间相关性的基本模型。推导其积分自相关时间 (IAT) 是一个经典练习，它能巩固我们对 IAT 如何与模型参数直接关联的理解。这项实践将为我们揭示负相关性如何提高采样效率，以及 IAT 在接近非平稳时如何发散，从而为后续更深入的探讨奠定基础。",
            "id": "3313056",
            "problem": "考虑一个由 $X_{t}=\\phi X_{t-1}+\\varepsilon_{t}$ ($t\\in\\mathbb{Z}$) 定义的平稳一阶自回归过程 (AR($1$))，其中 $\\{ \\varepsilon_{t} \\}$ 是独立同分布的，服从 $\\varepsilon_{t}\\sim \\mathcal{N}(0,\\sigma^{2})$，且 $|\\phi|1$。设自协方差函数为 $\\gamma(k)=\\mathbb{E}\\!\\left[(X_{t}-\\mu)(X_{t+k}-\\mu)\\right]$，其中 $\\mu=\\mathbb{E}[X_{t}]$；归一化自相关函数为 $\\rho_{k}=\\gamma(k)/\\gamma(0)$；以及积分自相关时间（在马尔可夫链蒙特卡洛 (MCMC) 中使用）定义为\n$$\n\\tau_{\\mathrm{int}}=1+2\\sum_{k=1}^{\\infty}\\rho_{k}.\n$$\n仅从这些定义和 AR($1$) 递归关系出发，推导 $\\tau_{\\mathrm{int}}$ 作为 $\\phi$ 的函数的闭式表达式，该表达式在 $|\\phi|1$ 时有效。然后，针对 $\\phi0$ 的情况，证明交替符号的相关性意味着 $\\tau_{\\mathrm{int}}1$。最后，确定在极限 $\\phi\\to -1^{+}$ 下 $\\tau_{\\mathrm{int}}$ 可达到的最小值。\n\n请以一个数对的形式提供你的最终答案，该数对包含 $\\tau_{\\mathrm{int}}(\\phi)$ 的精确闭式表达式和当 $\\phi\\to -1^{+}$ 时的极限最小值。不需要四舍五入，也不涉及物理单位。",
            "solution": "本题要求推导平稳 AR($1$) 过程的积分自相关时间 $\\tau_{\\mathrm{int}}$，并求其在极限 $\\phi\\to -1^{+}$ 下的最小值。\n\n首先，我们验证问题陈述。\n**步骤 1：提取已知条件**\n-   过程定义：平稳一阶自回归过程 (AR($1$)), $X_{t}=\\phi X_{t-1}+\\varepsilon_{t}$ for $t\\in\\mathbb{Z}$。\n-   噪声性质：$\\{ \\varepsilon_{t} \\}$ 是独立同分布 (i.i.d.) 的，服从 $\\varepsilon_{t}\\sim \\mathcal{N}(0,\\sigma^{2})$。\n-   平稳性条件：$|\\phi|1$。\n-   自协方差函数定义：$\\gamma(k)=\\mathbb{E}\\!\\left[(X_{t}-\\mu)(X_{t+k}-\\mu)\\right]$，其中 $\\mu=\\mathbb{E}[X_{t}]$。\n-   归一化自相关函数定义：$\\rho_{k}=\\gamma(k)/\\gamma(0)$。\n-   积分自相关时间定义：$\\tau_{\\mathrm{int}}=1+2\\sum_{k=1}^{\\infty}\\rho_{k}$。\n-   任务：\n    1.  推导 $\\tau_{\\mathrm{int}}$ 作为 $\\phi$ 的函数的闭式表达式。\n    2.  对于 $\\phi0$，证明 $\\tau_{\\mathrm{int}}1$。\n    3.  确定在极限 $\\phi\\to -1^{+}$ 下 $\\tau_{\\mathrm{int}}$ 的可达最小值。\n    4.  最终答案应为一个数对：$\\tau_{\\mathrm{int}}(\\phi)$ 的表达式及其极限最小值。\n\n**步骤 2：使用提取的已知条件进行验证**\n该问题具有科学依据，提法明确且客观。它是时间序列分析和蒙特卡洛方法领域的一个标准推导。所有术语都有正式定义，约束条件一致且充分，任务导向一个唯一、可验证的数学结果。该问题不违反任何无效性标准。\n\n**步骤 3：结论与行动**\n问题有效。我们继续进行解答。\n\n**推导过程**\n\n我们的推导分以下几个步骤进行：\n1.  确定过程的均值 $\\mu$。\n2.  确定自协方差函数 $\\gamma(k)$。\n3.  确定归一化自相关函数 $\\rho_{k}$。\n4.  计算求和以得到 $\\tau_{\\mathrm{int}}$。\n5.  分析在特定条件下的结果。\n\n**1. 过程的均值**\n我们对 AR($1$) 方程取期望：\n$$\n\\mathbb{E}[X_{t}] = \\mathbb{E}[\\phi X_{t-1}+\\varepsilon_{t}] = \\phi\\mathbb{E}[X_{t-1}] + \\mathbb{E}[\\varepsilon_{t}]\n$$\n由于过程是平稳的，均值是常数，即 $\\mathbb{E}[X_{t}] = \\mathbb{E}[X_{t-1}] = \\mu$。根据问题陈述，我们知道 $\\mathbb{E}[\\varepsilon_{t}]=0$。将这些代入方程得到：\n$$\n\\mu = \\phi\\mu + 0\n$$\n$$\n\\mu(1-\\phi) = 0\n$$\n给定条件 $|\\phi|1$，我们有 $1-\\phi \\neq 0$。因此，过程的均值必须为 $\\mu=0$。\n\n**2. 自协方差函数 $\\gamma(k)$**\n当 $\\mu=0$ 时，自协方差函数简化为 $\\gamma(k) = \\mathbb{E}[X_{t}X_{t+k}]$。\n\n首先，我们求方差 $\\gamma(0)$：\n$$\n\\gamma(0) = \\mathbb{E}[X_t^2] = \\mathbb{E}[(\\phi X_{t-1}+\\varepsilon_{t})^2] = \\mathbb{E}[\\phi^2 X_{t-1}^2 + 2\\phi X_{t-1}\\varepsilon_t + \\varepsilon_t^2]\n$$\n$$\n\\gamma(0) = \\phi^2 \\mathbb{E}[X_{t-1}^2] + 2\\phi \\mathbb{E}[X_{t-1}\\varepsilon_t] + \\mathbb{E}[\\varepsilon_t^2]\n$$\n根据平稳性，$\\mathbb{E}[X_{t-1}^2] = \\gamma(0)$。给定 $\\mathbb{E}[\\varepsilon_t^2] = \\sigma^2$。过程 $X_{t-1}$ 是 $\\varepsilon_{t-1}, \\varepsilon_{t-2}, \\dots$ 的函数。由于噪声项 $\\{\\varepsilon_t\\}$ 是独立同分布的，$X_{t-1}$ 与 $\\varepsilon_t$ 无关。因此，$\\mathbb{E}[X_{t-1}\\varepsilon_t] = \\mathbb{E}[X_{t-1}]\\mathbb{E}[\\varepsilon_t] = \\mu \\cdot 0 = 0$。\n代入这些结果：\n$$\n\\gamma(0) = \\phi^2 \\gamma(0) + \\sigma^2\n$$\n$$\n\\gamma(0)(1-\\phi^2) = \\sigma^2\n$$\n$$\n\\gamma(0) = \\frac{\\sigma^2}{1-\\phi^2}\n$$\n这是良定义的，因为 $|\\phi|1$ 意味着 $1-\\phi^2 > 0$。\n\n接下来，我们求 $k \\ge 1$ 时的 $\\gamma(k)$。我们从定义 $\\gamma(k) = \\mathbb{E}[X_{t}X_{t+k}]$ 开始，并代入 $X_{t+k}$ 的 AR($1$) 关系：\n$$\n\\gamma(k) = \\mathbb{E}[X_t(\\phi X_{t+k-1} + \\varepsilon_{t+k})] = \\phi\\mathbb{E}[X_t X_{t+k-1}] + \\mathbb{E}[X_t \\varepsilon_{t+k}]\n$$\n第一项是 $\\phi\\gamma(k-1)$。对于第二项，$X_t$ 是 $\\varepsilon_t, \\varepsilon_{t-1}, \\dots$ 的函数。因为 $k \\ge 1$，所以 $t+k > t$，且 $X_t$ 与 $\\varepsilon_{t+k}$ 无关。因此，$\\mathbb{E}[X_t \\varepsilon_{t+k}] = \\mathbb{E}[X_t]\\mathbb{E}[\\varepsilon_{t+k}] = \\mu \\cdot 0 = 0$。\n这就得到了 AR($1$) 过程的 Yule-Walker 方程：\n$$\n\\gamma(k) = \\phi\\gamma(k-1) \\quad \\text{for } k \\ge 1\n$$\n这是一个递归关系。从 $\\gamma(0)$ 开始，我们发现：\n$$\n\\gamma(1) = \\phi\\gamma(0)\n$$\n$$\n\\gamma(2) = \\phi\\gamma(1) = \\phi^2\\gamma(0)\n$$\n通过归纳法，对于任何整数 $k \\ge 0$：\n$$\n\\gamma(k) = \\phi^k \\gamma(0)\n$$\n\n**3. 归一化自相关函数 $\\rho_k$**\n归一化自相关函数定义为 $\\rho_k = \\gamma(k)/\\gamma(0)$。使用我们关于 $\\gamma(k)$ 的结果：\n$$\n\\rho_k = \\frac{\\phi^k \\gamma(0)}{\\gamma(0)} = \\phi^k\n$$\n\n**4. 积分自相关时间 $\\tau_{\\mathrm{int}}$**\n现在我们可以用其定义来计算 $\\tau_{\\mathrm{int}}$：\n$$\n\\tau_{\\mathrm{int}} = 1 + 2\\sum_{k=1}^{\\infty}\\rho_{k} = 1 + 2\\sum_{k=1}^{\\infty}\\phi^k\n$$\n这个和是一个几何级数。由于 $|\\phi|1$，级数收敛到：\n$$\n\\sum_{k=1}^{\\infty}\\phi^k = \\frac{\\phi}{1-\\phi}\n$$\n将此代入 $\\tau_{\\mathrm{int}}$ 的表达式中：\n$$\n\\tau_{\\mathrm{int}} = 1 + 2\\left(\\frac{\\phi}{1-\\phi}\\right) = \\frac{1-\\phi}{1-\\phi} + \\frac{2\\phi}{1-\\phi} = \\frac{1-\\phi+2\\phi}{1-\\phi}\n$$\n积分自相关时间的闭式表达式是：\n$$\n\\tau_{\\mathrm{int}}(\\phi) = \\frac{1+\\phi}{1-\\phi}\n$$\n这完成了问题的第一部分。\n\n**5. 特殊情况分析**\n\n**情况 $\\phi  0$**\n当 $\\phi0$ 时，相关性 $\\rho_k=\\phi^k$ 的符号交替出现：$\\rho_10$, $\\rho_2>0$, $\\rho_30$，依此类推。我们需要证明 $\\tau_{\\mathrm{int}}1$。\n使用推导出的表达式，如果我们有 $-1  \\phi  0$：\n- 分子 $1+\\phi$ 是正数，因为 $\\phi > -1$。并且，$1+\\phi  1$。\n- 分母 $1-\\phi$ 是正数且大于 1，因为 $\\phi  0$。\n所以我们有 $0  1+\\phi  1$ 和 $1  1-\\phi  2$。\n因此，比值 $\\tau_{\\mathrm{int}} = \\frac{1+\\phi}{1-\\phi}$ 是一个小于 1 的正数。要更正式地看这一点，$\\tau_{\\mathrm{int}}  1$ 等价于 $\\frac{1+\\phi}{1-\\phi}  1$。由于 $1-\\phi>0$，我们可以将不等式两边同乘以它而不改变不等号方向：\n$$\n1+\\phi  1-\\phi\n$$\n$$\n2\\phi  0\n$$\n$$\n\\phi  0\n$$\n这个不等式在此情况下根据假设成立，因此我们证明了对于 $\\phi  0$ 时 $\\tau_{\\mathrm{int}}  1$。这意味着反相关（对于奇数 $k$ 有 $\\rho_k0$）可以导致比独立抽样更有效的抽样（$\\tau_{\\mathrm{int}}1$），这是 MCMC 方法中的一个关键结果。\n\n**极限 $\\phi \\to -1^{+}$ 下的最小值**\n最后，我们需要求当 $\\phi$ 从上方趋近于 $-1$ 时 $\\tau_{\\mathrm{int}}$ 的最小值。这对应于极限：\n$$\n\\lim_{\\phi\\to -1^{+}} \\tau_{\\mathrm{int}}(\\phi) = \\lim_{\\phi\\to -1^{+}} \\frac{1+\\phi}{1-\\phi}\n$$\n由于函数在 $\\phi=-1$ 处是连续的，我们可以通过直接代入来计算极限：\n$$\n\\lim_{\\phi\\to -1^{+}} \\frac{1+\\phi}{1-\\phi} = \\frac{1+(-1)}{1-(-1)} = \\frac{0}{2} = 0\n$$\n为了确认这是在区间 $(-1,1)$ 上的可达最小值，我们可以考察 $\\tau_{\\mathrm{int}}(\\phi)$ 对 $\\phi$ 的导数：\n$$\n\\frac{d\\tau_{\\mathrm{int}}}{d\\phi} = \\frac{d}{d\\phi}\\left(\\frac{1+\\phi}{1-\\phi}\\right) = \\frac{(1)(1-\\phi) - (1+\\phi)(-1)}{(1-\\phi)^2} = \\frac{1-\\phi+1+\\phi}{(1-\\phi)^2} = \\frac{2}{(1-\\phi)^2}\n$$\n由于对于 $\\phi \\in (-1,1)$，导数总是正的，所以函数 $\\tau_{\\mathrm{int}}(\\phi)$ 在其整个定义域上是严格单调递增的。因此，其最小值在定义域的左边界处达到，即当 $\\phi \\to -1^{+}$ 时。最小值为 $0$。\n\n最终答案的两个部分是推导出的 $\\tau_{\\mathrm{int}}(\\phi)$ 表达式及其在 $\\phi \\to -1^{+}$ 时的极限值。\n1.  $\\tau_{\\mathrm{int}}(\\phi) = \\frac{1+\\phi}{1-\\phi}$\n2.  $\\lim_{\\phi\\to -1^{+}} \\tau_{\\mathrm{int}}(\\phi) = 0$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1+\\phi}{1-\\phi}  0 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "在上一项实践中，我们看到负相关（或反持续性）可以使积分自相关时间小于1，这意味着更高的采样效率。本练习将探讨一个关键的实际问题：当我们从一个表现出这种符号交替的振荡相关性的数据序列中估计 IAT 时，我们应该如何操作？通过实现并比较两种不同的估计方法，我们将从解析和计算两个层面证明，为何正确处理负相关项至关重要，以及一些简化的方法会如何导致严重的估计偏差。",
            "id": "3313017",
            "problem": "考虑一个离散时间、严格平稳、遍历、零均值的过程，该过程由随机变量序列 $\\{X_t\\}_{t \\in \\mathbb{Z}}$ 表示，其方差为 $\\mathbb{V}[X_t] = \\gamma_0$，自协方差函数为 $\\gamma_t = \\mathbb{E}[X_0 X_t]$，归一化自相关函数为 $\\rho_t = \\gamma_t / \\gamma_0$。算术平均值 $\\,\\bar{X}_n = \\frac{1}{n}\\sum_{t=1}^n X_t\\,$ 的方差可以通过对宽平稳过程成立的恒等式用 $\\gamma_t$ 表示。从这些核心定义出发，推导当 $n$ 很大时 $\\mathbb{V}[\\bar{X}_n]$ 的渐近形式，使其与 $\\gamma_0/n$ 成正比，并乘以一个汇集了滞后相关性贡献的无量纲因子。\n\n在马尔可夫链蒙特卡洛 (MCMC) 中，这个无量纲因子被称为积分自相关时间 (IACT)。在实践中，人们通常通过在窗口 $m$ 处截断滞后自相关贡献的总和来估计 IACT，有时还会舍弃负滞后贡献（即，当滞后 $t \\ge 1$ 时 $\\rho_t$ 的负值）。对于振荡的自相关（例如，符号交替变化的自相关），舍弃负贡献可能会在 IACT 估计中引入显著的正向偏差，因为它破坏了正项和负项之间本应发生的抵消。\n\n您将使用一个合成的、纯数学的自相关模型来分析这种偏差，并实现两种估计器，一种舍弃负滞后贡献，另一种则包含它们。\n\n定义和模型：\n- 设归一化自相关函数指定为 $\\rho_0 = 1$，对于正滞后 $t \\ge 1$，由下式给出\n$$\n\\rho_t = a^t (-1)^t,\n$$\n其中 $a \\in (0,1)$ 是一个几何衰减参数。这会产生一个符号交替的振荡自相关。\n- 设大样本 $n$ 的 IACT 是在 $\\mathbb{V}[\\bar{X}_n]$ 的大 $n$ 极限下，乘以 $\\gamma_0/n$ 的无量纲因子，该因子由滞后自相关贡献的汇集得到。\n- 考虑在窗口大小为 $m \\in \\mathbb{N}$ 时的两个有限窗口估计器：\n  1. “带符号”窗口估计器，它汇集了 $t=1,\\dots,m$ 的 $\\rho_t$，并保留其符号。\n  2. “舍弃负值”窗口估计器，它仅汇集 $t=1,\\dots,m$ 范围内 $\\rho_t$ 的正值，并舍弃负值。\n\n任务：\n1. 从 $\\gamma_t$ 和 $\\rho_t$ 的定义，以及将 $\\mathbb{V}[\\bar{X}_n]$ 表示为宽平稳过程自协方差的恒等式出发，推导出大样本 $n$ 的无量纲因子 (IACT)，其形式为一个关于 $\\rho_t$ 的无穷级数。不要假设任何快捷公式；从第一性原理出发推导得出大样本 $n$ 因子的汇集结构。\n2. 对于振荡模型 $\\rho_t = a^t (-1)^t$，通过对相关无穷级数求和，确定精确的大样本 $n$ IACT。将此 IACT 表示为 $a$ 的闭式函数。\n3. 对于有限窗口 $m$，推导两种窗口估计器的闭式形式：\n   - “带符号”窗口估计器，汇集了 $t=1,\\dots,m$ 的 $\\rho_t$ 并保留符号。\n   - “舍弃负值”窗口估计器，仅汇集该范围内为正的 $\\rho_t$。\n4. 从分析上说明为什么当 $\\rho_t$ 符号交替时，舍弃负滞后贡献会使估计器膨胀。您的解释必须基于交错级数中的抵消效应。\n5. 实现一个程序，对于每个测试用例 $(a,m)$，计算：\n   - 精确的大样本 $n$ IACT，\n   - 带符号的窗口估计值，\n   - 舍弃负值的窗口估计值，\n   - 绝对误差之比，定义为\n     $$\n     R(a,m) = \\frac{\\left|\\text{drop-negative}(a,m) - \\text{IACT}(a)\\right|}{\\left|\\text{signed}(a,m) - \\text{IACT}(a)\\right|},\n     $$\n     约定：当分母为零时，用一个小的正常数 $10^{-12}$ 替换，以进行正则化处理。\n   比率 $R(a,m) > 1$ 表明，与舍弃负滞后贡献相比，包含它们可以减少估计器的偏差。\n\n此问题不涉及角度单位。没有出现物理单位；所有量都是无量纲的。\n\n测试套件：\n使用以下参数对 $(a,m)$：\n- $(0.9,50)$：强相关性和合理大窗口的理想情况，\n- $(0.7,20)$：中等强度相关性，中等窗口，\n- $(0.99,100)$：接近单位根的边界情况，大窗口，\n- $(0.3,10)$：弱相关性，小窗口，\n- $(0.9,1)$：极端截断边界（极小窗口）。\n\n程序输出规范：\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表。\n- 每个测试用例的结果必须是一个包含四个浮点数的列表：\n  $[\\text{IACT}(a),\\ \\text{signed}(a,m),\\ \\text{drop-negative}(a,m),\\ R(a,m)]$。\n- 最终输出必须是一个包含这五个测试用例列表的单一列表，例如：\n  $[[v_{11},v_{12},v_{13},v_{14}],[v_{21},v_{22},v_{23},v_{24}],\\dots]$。",
            "solution": "用户提供的问题已经过评估，被确定为有效。这是一个在随机模拟方法领域内定义良好、有科学依据的客观问题。所有定义都是标准的，各项任务构成了基于第一性原理的严谨数学和计算练习。\n\n### 1. 大样本 $n$ 积分自相关时间 (IACT) 的推导\n\n我们从一个离散时间、严格平稳、遍历、零均值的过程 $\\{X_t\\}_{t \\in \\mathbb{Z}}$ 开始。方差为 $\\mathbb{V}[X_t] = \\gamma_0$，自协方差为 $\\gamma_t = \\mathbb{E}[X_0 X_t]$。$n$ 个样本的算术平均值为 $\\bar{X}_n = \\frac{1}{n}\\sum_{t=1}^n X_t$。\n\n算术平均值的方差由下式给出：\n$$\n\\mathbb{V}[\\bar{X}_n] = \\mathbb{V}\\left[\\frac{1}{n}\\sum_{t=1}^n X_t\\right]\n$$\n利用随机变量和的方差线性性质，我们有：\n$$\n\\mathbb{V}[\\bar{X}_n] = \\frac{1}{n^2} \\sum_{t=1}^n \\sum_{s=1}^n \\text{Cov}(X_t, X_s)\n$$\n对于平稳过程，协方差仅取决于时间滞后，$\\text{Cov}(X_t, X_s) = \\gamma_{|t-s|}$。将其代入求和式中：\n$$\n\\mathbb{V}[\\bar{X}_n] = \\frac{1}{n^2} \\sum_{t=1}^n \\sum_{s=1}^n \\gamma_{|t-s|}\n$$\n这个双重求和可以按滞后 $k = t-s$ 重新索引。滞后 $k$ 的范围是从 $-(n-1)$ 到 $n-1$。对于给定的滞后 $k$，求和中有 $n-|k|$ 对 $(t,s)$ 满足 $t-s=k$。这使我们可以将求和重写为：\n$$\n\\mathbb{V}[\\bar{X}_n] = \\frac{1}{n^2} \\sum_{k=-(n-1)}^{n-1} (n-|k|) \\gamma_k\n$$\n分配 $1/n^2$ 项：\n$$\n\\mathbb{V}[\\bar{X}_n] = \\frac{1}{n} \\sum_{k=-(n-1)}^{n-1} \\left(1 - \\frac{|k|}{n}\\right) \\gamma_k\n$$\n由于该过程是实值过程，其自协方差函数是偶函数，即 $\\gamma_k = \\gamma_{-k}$。我们可以分离出 $k=0$ 的项，并将正负滞后项合并：\n$$\n\\mathbb{V}[\\bar{X}_n] = \\frac{1}{n} \\left[ \\gamma_0 + 2 \\sum_{t=1}^{n-1} \\left(1 - \\frac{t}{n}\\right) \\gamma_t \\right]\n$$\n提出方差 $\\gamma_0$ 并使用归一化自相关函数 $\\rho_t = \\gamma_t / \\gamma_0$：\n$$\n\\mathbb{V}[\\bar{X}_n] = \\frac{\\gamma_0}{n} \\left[ 1 + 2 \\sum_{t=1}^{n-1} \\left(1 - \\frac{t}{n}\\right) \\rho_t \\right]\n$$\n对于相关性可求和的过程（即 $\\sum_{t=1}^\\infty |\\rho_t|  \\infty$），当 $n \\to \\infty$ 时，对于任何固定的 $t$，因子 $(1 - t/n) \\to 1$。该求和可以用其无穷对应项近似：\n$$\n\\mathbb{V}[\\bar{X}_n] \\approx \\frac{\\gamma_0}{n} \\left( 1 + 2 \\sum_{t=1}^\\infty \\rho_t \\right) \\quad \\text{for large } n\n$$\n因此，定义为积分自相关时间 ($\\tau$) 的无量纲因子是：\n$$\n\\tau = 1 + 2 \\sum_{t=1}^{\\infty} \\rho_t\n$$\n\n### 2. 振荡模型的精确 IACT\n\n问题指定了模型 $\\rho_t = a^t (-1)^t = (-a)^t$ (对于 $t \\ge 1$)，其中 $a \\in (0,1)$。我们将此代入 IACT 公式：\n$$\n\\tau_{\\text{exact}} = 1 + 2 \\sum_{t=1}^{\\infty} (-a)^t\n$$\n该求和是一个首项为 $-a$、公比为 $-a$ 的无穷几何级数。由于 $a \\in (0,1)$，公比的绝对值 $|-a|$ 小于 1，因此级数收敛。其和为：\n$$\n\\sum_{t=1}^{\\infty} (-a)^t = \\frac{\\text{first term}}{1 - \\text{ratio}} = \\frac{-a}{1 - (-a)} = \\frac{-a}{1+a}\n$$\n将此代回 $\\tau_{\\text{exact}}$ 的表达式中：\n$$\n\\tau_{\\text{exact}}(a) = 1 + 2 \\left( \\frac{-a}{1+a} \\right) = \\frac{1+a - 2a}{1+a} = \\frac{1-a}{1+a}\n$$\n\n### 3. 有限窗口估计器\n\n这两个估计器是通过在有限窗口 $m$ 处截断求和来定义的。\n\n**带符号窗口估计器**：此估计器包括直至滞后 $m$ 的所有项：\n$$\n\\tau_{\\text{signed}}(a,m) = 1 + 2 \\sum_{t=1}^{m} (-a)^t\n$$\n该求和是一个有限几何级数： $\\sum_{k=1}^m r^k = r \\frac{1-r^m}{1-r}$。令 $r=-a$：\n$$\n\\sum_{t=1}^{m} (-a)^t = (-a) \\frac{1 - (-a)^m}{1 - (-a)} = -a \\frac{1 - (-a)^m}{1+a}\n$$\n因此，该估计器为：\n$$\n\\tau_{\\text{signed}}(a,m) = 1 - \\frac{2a(1 - (-a)^m)}{1+a}\n$$\n\n**舍弃负值窗口估计器**：此估计器仅包括求和至 $m$ 的 $\\rho_t$ 中的正项。对于模型 $\\rho_t = (-a)^t$ 且 $a>0$，仅当滞后 $t$ 是偶数整数时，项才为正。该估计器为：\n$$\n\\tau_{\\text{drop-neg}}(a,m) = 1 + 2 \\sum_{\\substack{t=1,\\dots,m \\\\ t \\text{ is even}}} \\rho_t\n$$\n令 $t = 2k$。求和变为 $\\sum_{k=1}^{\\lfloor m/2 \\rfloor} \\rho_{2k} = \\sum_{k=1}^{\\lfloor m/2 \\rfloor} (-a)^{2k} = \\sum_{k=1}^{\\lfloor m/2 \\rfloor} (a^2)^k$。这是一个公比为 $a^2$ 的几何级数。令 $M = \\lfloor m/2 \\rfloor$。如果 $M=0$，则和为 $0$。如果 $M > 0$，则和为：\n$$\n\\sum_{k=1}^{M} (a^2)^k = a^2 \\frac{1 - (a^2)^M}{1 - a^2}\n$$\n因此，该估计器为：\n$$\n\\tau_{\\text{drop-neg}}(a,m) = 1 + 2 \\left( a^2 \\frac{1 - (a^2)^{\\lfloor m/2 \\rfloor}}{1 - a^2} \\right) \\quad \\text{for } \\lfloor m/2 \\rfloor > 0\n$$\n当 $\\lfloor m/2 \\rfloor = 0$ (即 $m2$) 时，$\\tau_{\\text{drop-neg}}(a,m) = 1$。\n\n### 4. 估计器偏差的分析性解释\n\n估计器的偏差是其期望值与真实值之间的偏差。在这里，我们分析由舍弃负相关项引入的系统性误差。\n\n精确的 IACT $\\tau_{\\text{exact}} = \\frac{1-a}{1+a}$ 是从和 $S_{\\infty} = \\sum_{t=1}^\\infty \\rho_t = \\frac{-a}{1+a}$ 推导出来的。由于 $a \\in (0,1)$，这个和是负的。这种负性源于一个交错级数中固有的抵消作用，其中第一项 ($\\rho_1 = -a$) 是负的且绝对值最大。负滞后项（奇数 $t$）的和超过了正滞后项（偶数 $t$）的和。\n\n**带符号估计器**用一个有限部分和 $S_m = \\sum_{t=1}^m \\rho_t$ 来近似这个交错级数。一个收敛的交错级数的部分和会在极限值周围振荡。误差 $|S_m - S_{\\infty}|$ 随着 $m$ 的增加而减小。该估计器正确地捕捉了级数的基本特征：正项和负项之间的抵消。\n\n**舍弃负值估计器**由和 $S'_m = \\sum_{t=1}^m \\max(0, \\rho_t)$ 构成。对于模型 $\\rho_t = (-a)^t$，这个和只包括 $t$ 为偶数时的正项 $\\rho_t$。\n$$\nS'_m = a^2 + a^4 + \\dots + a^{2\\lfloor m/2 \\rfloor}\n$$\n当 $m \\ge 2$ 时，这个和显然是正的。因此，估计器 $\\tau_{\\text{drop-neg}} = 1 + 2S'_m$ 总是大于 $1$。相比之下，真实值 $\\tau_{\\text{exact}} = (1-a)/(1+a)$ 总是小于 $1$。\n\n舍弃负值方法的基本缺陷在于，它试图用一个严格为正的和 ($S'_m$) 来估计一个基于负和 ($S_{\\infty}$) 的量。通过舍弃所有负贡献，它完全破坏了定义级数行为的关键抵消作用。这系统性地增大了估计值，导致较大的正向偏差。带符号估计器通过保留抵消作用，为相关系统的根本行为提供了远为准确的近似。误差比 $R(a,m)$ 预计会很大，证实了带符号估计器的偏差要小得多。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes IACT estimates for a set of test cases based on an oscillatory\n    autocorrelation model.\n    \"\"\"\n    # Test cases defined in the problem statement.\n    test_cases = [\n        (0.9, 50),\n        (0.7, 20),\n        (0.99, 100),\n        (0.3, 10),\n        (0.9, 1),\n    ]\n\n    results = []\n    \n    # Small constant for regularizing division by zero.\n    epsilon = 1e-12\n\n    for a, m in test_cases:\n        # Task 2: Calculate the exact large-n IACT.\n        # tau_exact = (1 - a) / (1 + a)\n        iact_exact = (1.0 - a) / (1.0 + a)\n\n        # Task 3: Calculate the signed windowed estimator.\n        # tau_signed = 1 - (2*a*(1 - (-a)**m)) / (1 + a)\n        sum_part_signed = (2.0 * a * (1.0 - (-a)**m)) / (1.0 + a)\n        signed_estimate = 1.0 - sum_part_signed\n\n        # Task 3: Calculate the drop-negative windowed estimator.\n        # This sums only positive rho_t, which occur at even lags t.\n        # The sum is for t = 2, 4, ..., 2*M where M = m // 2.\n        # Sum = a^2 * (1 - (a^2)^M) / (1 - a^2)\n        M = m // 2\n        if M == 0:\n            sum_part_drop_neg = 0.0\n        else:\n            a_sq = a**2\n            # Geometric series sum: r * (1-r^n) / (1-r) with r=a^2, n=M\n            sum_drop_neg_terms = a_sq * (1.0 - a_sq**M) / (1.0 - a_sq)\n            sum_part_drop_neg = 2.0 * sum_drop_neg_terms\n        \n        drop_negative_estimate = 1.0 + sum_part_drop_neg\n\n        # Task 5: Calculate the ratio of absolute errors.\n        # R(a,m) = |drop-negative - IACT| / |signed - IACT|\n        abs_error_signed = abs(signed_estimate - iact_exact)\n        abs_error_drop_neg = abs(drop_negative_estimate - iact_exact)\n        \n        # Regularize the denominator to avoid division by zero.\n        denominator = abs_error_signed if abs_error_signed > epsilon else epsilon\n\n        error_ratio = abs_error_drop_neg / denominator\n\n        results.append([\n            iact_exact,\n            signed_estimate,\n            drop_negative_estimate,\n            error_ratio\n        ])\n\n    # Format the final output string according to the specification.\n    # [[v11,v12,v13,v14],[v21,v22,v23,v24],...]\n    case_results_str = [\n        f\"[{','.join(f'{val:.8f}' for val in res)}]\" for res in results\n    ]\n    final_output = f\"[{','.join(case_results_str)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "前面的练习主要从时间序列模型的角度分析了积分自相关时间，现在我们将深入其根本来源：马尔可夫链的转移算符。这项高级实践旨在揭示某个特定可观测量 (observable) 的 IAT 与转移矩阵特征值之间的深刻联系。通过分析一个简单但非平凡的马尔可夫链，我们将看到，当可观测量是转移算符的一个特征函数时，其相关结构与 IAT 完全由与之对应的单个特征值决定，这为我们理解模拟效率提供了强大的谱理论视角。",
            "id": "3312998",
            "problem": "考虑一个离散时间、有限状态的可逆马尔可夫链，其状态空间为 $\\{1,2,3\\}$，转移矩阵为 $P(\\varepsilon)$，其中参数 $\\varepsilon \\in (0, \\tfrac{1}{2})$，由下式给出：\n$$\nP(\\varepsilon) \\;=\\;\n\\begin{pmatrix}\n\\tfrac{1}{2}  \\tfrac{1}{2}  0 \\\\\n\\tfrac{1}{2}  \\tfrac{1}{2} - \\varepsilon  \\varepsilon \\\\\n0  \\varepsilon  1 - \\varepsilon\n\\end{pmatrix}.\n$$\n假设该链从其平稳分布开始。令 $f$ 为 $P(\\varepsilon)$ 的任意非零特征函数，与模长较小的非平凡特征值相关联（即，在两个非单位特征值中，绝对值较小的那个）。仅使用可逆性、自协方差和积分自相关时间 (IAT) 的核心定义，以 $\\varepsilon$ 的闭合形式函数计算积分自相关时间 $\\tau_{\\mathrm{int}}(f)$。\n\n你的推导必须从基本定义开始（特别是，平稳状态下的自协方差 $\\gamma_t = \\mathrm{Cov}_{\\pi}(f(X_0), f(X_t))$ 和积分自相关时间 $\\tau_{\\mathrm{int}}(f) = 1 + 2 \\sum_{t=1}^{\\infty} \\rho_t$，其中 $\\rho_t = \\gamma_t / \\gamma_0$），并且可以使用关于可逆马尔可夫链和 $L^2(\\pi)$ 上对称算子的广为人知的事实，但不能使用任何现成的快捷公式。请以最简精确解析形式给出 $\\tau_{\\mathrm{int}}(f)$ 的最终表达式。无需四舍五入，也无需单位。",
            "solution": "问题要求计算给定可逆马尔可夫链上特定可观测量 $f$ 的积分自相关时间 $\\tau_{\\mathrm{int}}(f)$。推导必须从基本原理出发。\n\n首先，我们确定马尔可夫链的平稳分布 $\\pi = (\\pi_1, \\pi_2, \\pi_3)$。问题指出该链是可逆的，这意味着对于所有状态 $i, j \\in \\{1, 2, 3\\}$，细致平衡条件 $\\pi_i P_{ij} = \\pi_j P_{ji}$ 必须成立。\n对于 $i=1, j=2$：$\\pi_1 P_{12} = \\pi_2 P_{21} \\implies \\pi_1(\\frac{1}{2}) = \\pi_2(\\frac{1}{2}) \\implies \\pi_1 = \\pi_2$。\n对于 $i=2, j=3$：$\\pi_2 P_{23} = \\pi_3 P_{32} \\implies \\pi_2(\\varepsilon) = \\pi_3(\\varepsilon) \\implies \\pi_2 = \\pi_3$。\n对于 $i=1, j=3$：$\\pi_1 P_{13} = \\pi_3 P_{31} \\implies \\pi_1(0) = \\pi_3(0)$，这是平凡满足的。\n结合这些条件，我们有 $\\pi_1 = \\pi_2 = \\pi_3$。根据归一化约束 $\\sum_{i=1}^3 \\pi_i = 1$，我们发现 $3\\pi_1 = 1$，这得到 $\\pi_1 = \\pi_2 = \\pi_3 = \\frac{1}{3}$。平稳分布是均匀分布 $\\pi = (\\frac{1}{3}, \\frac{1}{3}, \\frac{1}{3})$。\n\n接下来，我们求转移矩阵 $P(\\varepsilon)$ 的特征值。特征方程为 $\\det(P(\\varepsilon) - \\lambda I) = 0$。\n$$\n\\det \\begin{pmatrix}\n\\frac{1}{2} - \\lambda  \\frac{1}{2}  0 \\\\\n\\frac{1}{2}  \\frac{1}{2} - \\varepsilon - \\lambda  \\varepsilon \\\\\n0  \\varepsilon  1 - \\varepsilon - \\lambda\n\\end{pmatrix} = 0\n$$\n展开行列式，我们得到：\n$$\n\\left(\\frac{1}{2} - \\lambda\\right)\\left[\\left(\\frac{1}{2} - \\varepsilon - \\lambda\\right)(1 - \\varepsilon - \\lambda) - \\varepsilon^2\\right] - \\frac{1}{2}\\left[\\frac{1}{2}(1 - \\varepsilon - \\lambda)\\right] = 0\n$$\n由于链是不可约和非周期的（因为 $P_{11} > 0$），存在唯一的平稳分布，且 $\\lambda_1=1$ 是一个单特征值。因此，$(\\lambda-1)$ 是特征多项式的一个因子。经过代数展开和化简，特征方程为：\n$$\n\\lambda^3 - (2-2\\varepsilon)\\lambda^2 + \\left(1-\\frac{5}{2}\\varepsilon\\right)\\lambda + \\frac{1}{2}\\varepsilon = 0\n$$\n将此多项式除以 $(\\lambda-1)$，我们得到：\n$$\n(\\lambda-1)\\left(\\lambda^2 + (2\\varepsilon-1)\\lambda - \\frac{\\varepsilon}{2}\\right) = 0\n$$\n特征值为 $\\lambda_1 = 1$ 以及二次方程 $\\lambda^2 + (2\\varepsilon-1)\\lambda - \\frac{\\varepsilon}{2} = 0$ 的根。使用求根公式，另外两个特征值为：\n$$\n\\lambda_{2,3} = \\frac{-(2\\varepsilon-1) \\pm \\sqrt{(2\\varepsilon-1)^2 - 4(1)(-\\frac{\\varepsilon}{2})}}{2} = \\frac{1-2\\varepsilon \\pm \\sqrt{4\\varepsilon^2 - 4\\varepsilon + 1 + 2\\varepsilon}}{2}\n$$\n$$\n\\lambda_{2,3} = \\frac{1-2\\varepsilon \\pm \\sqrt{4\\varepsilon^2 - 2\\varepsilon + 1}}{2}\n$$\n令 $\\lambda_2 = \\frac{1-2\\varepsilon + \\sqrt{4\\varepsilon^2 - 2\\varepsilon + 1}}{2}$ 且 $\\lambda_3 = \\frac{1-2\\varepsilon - \\sqrt{4\\varepsilon^2 - 2\\varepsilon + 1}}{2}$。\n问题要求我们使用模长较小的特征值。对于 $\\varepsilon \\in (0, \\frac{1}{2})$，我们有 $0  1-2\\varepsilon  1$。平方根下的项 $D = 4\\varepsilon^2 - 2\\varepsilon + 1$ 总是正的。我们比较 $(1-2\\varepsilon)^2 = 1 - 4\\varepsilon + 4\\varepsilon^2$ 与 $D = 1 - 2\\varepsilon + 4\\varepsilon^2$。由于 $\\varepsilon>0$，我们有 $1-4\\varepsilon  1-2\\varepsilon$，所以 $(1-2\\varepsilon)^2  D$，这意味着 $1-2\\varepsilon  \\sqrt{D}$。\n因此，$\\lambda_3 = \\frac{(1-2\\varepsilon) - \\sqrt{D}}{2}  0$。由于 $1-2\\varepsilon > 0$，所以 $\\lambda_2 > 0$。\n现在我们比较它们的模长：$|\\lambda_2| = \\lambda_2$ 且 $|\\lambda_3| = -\\lambda_3$。\n$|\\lambda_2| - |\\lambda_3| = \\frac{1-2\\varepsilon + \\sqrt{D}}{2} - \\frac{\\sqrt{D} - (1-2\\varepsilon)}{2} = \\frac{2(1-2\\varepsilon)}{2} = 1-2\\varepsilon$。\n由于 $\\varepsilon  \\frac{1}{2}$，$1-2\\varepsilon > 0$，所以 $|\\lambda_2| > |\\lambda_3|$。模长较小的非平凡特征值是 $\\lambda = \\lambda_3$。\n\n现在我们计算积分自相关时间 $\\tau_{\\mathrm{int}}(f)$。根据定义，$\\tau_{\\mathrm{int}}(f) = 1 + 2 \\sum_{t=1}^{\\infty} \\rho_t$，其中 $\\rho_t = \\gamma_t / \\gamma_0$ 是归一化自协方差。对于一个从平稳状态开始的过程，滞后 $t$ 的自协方差是 $\\gamma_t = \\mathrm{Cov}_{\\pi}(f(X_0), f(X_t)) = E_{\\pi}[f(X_0)f(X_t)] - (E_{\\pi}[f(X_0)])^2$。\n可观测量 $f$ 是 $P$ 对应于特征值 $\\lambda \\neq 1$ 的一个特征函数。对于可逆马尔可夫链，对应于不同特征值的特征函数在希尔伯特空间 $L^2(\\pi)$ 中是正交的。对应于 $\\lambda_1=1$ 的特征函数是常数函数 $f_1(i)=1$ 对所有 $i$ 成立。正交条件 $\\langle f, f_1 \\rangle_{\\pi} = 0$ 意味着：\n$$\n\\sum_{i=1}^3 \\pi_i f(i) f_1(i) = \\sum_{i=1}^3 \\pi_i f(i) = E_{\\pi}[f(X_0)] = 0\n$$\n因此，$f$ 的均值为零。自协方差化简为 $\\gamma_t = E_{\\pi}[f(X_0)f(X_t)]$。\n我们可以将这个期望表示为：\n$$\n\\gamma_t = \\sum_{i} \\pi_i f(i) E[f(X_t)|X_0=i] = \\sum_i \\pi_i f(i) (P^t f)(i)\n$$\n其中 $(P^t f)(i) = \\sum_j (P^t)_{ij}f(j)$。由于 $f$ 是 $P$ 的一个特征函数，其特征值为 $\\lambda$，我们有 $P f = \\lambda f$，并通过归纳法可得 $P^t f = \\lambda^t f$。\n将此代入 $\\gamma_t$ 的表达式中：\n$$\n\\gamma_t = \\sum_i \\pi_i f(i) (\\lambda^t f(i)) = \\lambda^t \\sum_i \\pi_i (f(i))^2 = \\lambda^t E_{\\pi}[(f(X_0))^2]\n$$\n方差是 $\\gamma_0 = E_{\\pi}[(f(X_0))^2] - (E_{\\pi}[f(X_0)])^2 = E_{\\pi}[(f(X_0))^2]$。\n所以，$\\gamma_t = \\lambda^t \\gamma_0$。\n归一化自协方差是 $\\rho_t = \\gamma_t / \\gamma_0 = \\lambda^t$。\n现在，我们计算 IAT：\n$$\n\\tau_{\\mathrm{int}}(f) = 1 + 2 \\sum_{t=1}^{\\infty} \\rho_t = 1 + 2 \\sum_{t=1}^{\\infty} \\lambda^t\n$$\n这是一个几何级数。由于 $|\\lambda| = |\\lambda_3|  1$，级数收敛于 $\\frac{\\lambda}{1-\\lambda}$。\n$$\n\\tau_{\\mathrm{int}}(f) = 1 + 2 \\frac{\\lambda}{1-\\lambda} = \\frac{1-\\lambda+2\\lambda}{1-\\lambda} = \\frac{1+\\lambda}{1-\\lambda}\n$$\n我们现在代入 $\\lambda = \\lambda_3$ 的表达式：\n$$\n\\lambda = \\frac{1-2\\varepsilon - \\sqrt{4\\varepsilon^2 - 2\\varepsilon + 1}}{2}\n$$\n令 $S = \\sqrt{4\\varepsilon^2 - 2\\varepsilon + 1}$。则 $\\lambda = \\frac{1-2\\varepsilon-S}{2}$。\n$$\n1+\\lambda = 1 + \\frac{1-2\\varepsilon-S}{2} = \\frac{2+1-2\\varepsilon-S}{2} = \\frac{3-2\\varepsilon-S}{2}\n$$\n$$\n1-\\lambda = 1 - \\frac{1-2\\varepsilon-S}{2} = \\frac{2-1+2\\varepsilon+S}{2} = \\frac{1+2\\varepsilon+S}{2}\n$$\n所以，$\\tau_{\\mathrm{int}}(f) = \\frac{3-2\\varepsilon-S}{1+2\\varepsilon+S}$。为了化简，我们将分子和分母同乘以分母的共轭项，即 $(1+2\\varepsilon)-S$：\n$$\n\\tau_{\\mathrm{int}}(f) = \\frac{(3-2\\varepsilon-S)((1+2\\varepsilon)-S)}{((1+2\\varepsilon)+S)((1+2\\varepsilon)-S)}\n$$\n分母变为 $(1+2\\varepsilon)^2 - S^2 = (1+4\\varepsilon+4\\varepsilon^2) - (4\\varepsilon^2-2\\varepsilon+1) = 6\\varepsilon$。\n分子变为 $(3-2\\varepsilon)(1+2\\varepsilon) - S(3-2\\varepsilon) - S(1+2\\varepsilon) + S^2$：\n$$\n(3+4\\varepsilon-4\\varepsilon^2) -S(3-2\\varepsilon+1+2\\varepsilon) + (4\\varepsilon^2-2\\varepsilon+1) = (3+4\\varepsilon-4\\varepsilon^2) - 4S + (4\\varepsilon^2-2\\varepsilon+1)\n$$\n$$\n= 4+2\\varepsilon-4S = 4+2\\varepsilon-4\\sqrt{4\\varepsilon^2-2\\varepsilon+1}\n$$\n综合这些，我们得到：\n$$\n\\tau_{\\mathrm{int}}(f) = \\frac{4+2\\varepsilon-4\\sqrt{4\\varepsilon^2-2\\varepsilon+1}}{6\\varepsilon} = \\frac{2+\\varepsilon-2\\sqrt{4\\varepsilon^2-2\\varepsilon+1}}{3\\varepsilon}\n$$\n这就是积分自相关时间的最终表达式。",
            "answer": "$$\n\\boxed{\\frac{2+\\varepsilon-2\\sqrt{4\\varepsilon^2-2\\varepsilon+1}}{3\\varepsilon}}\n$$"
        }
    ]
}