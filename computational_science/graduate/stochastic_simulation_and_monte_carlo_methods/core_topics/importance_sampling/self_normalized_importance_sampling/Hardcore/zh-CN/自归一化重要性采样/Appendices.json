{
    "hands_on_practices": [
        {
            "introduction": "在应用任何数值方法之前，我们必须理解其理论要求。对于重要性抽样，目标分布相对于提议分布的绝对连续性是一个关键先决条件。这项练习  使用具体的例子来探讨这一基本概念，包括具有不同支撑集和包含点质量的分布。通过完成这项练习，您将对自归一化重要性抽样（SNIS）何时是有效工具有了严谨的理解，并学会如何处理对其假设的常见违例情况。",
            "id": "3338579",
            "problem": "考虑一个在区间 $[0,1]$ 上的目标分布 $p$ 和一个在 $(0,\\infty)$ 上的提议分布 $q$。自归一化重要性采样 (Self-Normalized Importance Sampling, SNIS) 在 Radon–Nikodym 导数 $\\frac{\\mathrm{d}p}{\\mathrm{d}q}$ 存在之处使用它来构造归一化的重要性权重，并要求绝对连续性 $p \\ll q$（意味着对于任意可测集 $A$，若 $q(A) = 0$ 则 $p(A) = 0$）。令 $h:[0,1]\\to\\mathbb{R}$ 为一个有界可测函数，并假设我们希望使用从 $q$ 中抽取的样本，通过 SNIS 来估计 $\\mathbb{E}_p[h(X)]$。\n\n定义 $p$ 为在 $[0,1]$ 上参数为 $\\alpha=2$ 和 $\\beta=3$ 的贝塔分布 (Beta distribution)，即：\n$$\np(x) = \\frac{\\Gamma(2+3)}{\\Gamma(2)\\Gamma(3)}\\,x^{2-1}(1-x)^{3-1}\\,\\mathbf{1}_{[0,1]}(x),\n$$\n并定义 $q$ 为在 $(0,\\infty)$ 上形状参数 $k=2$ 和尺度参数 $\\theta=1$ 的伽玛分布 (Gamma distribution)，即：\n$$\nq(x) = \\frac{1}{\\Gamma(2)\\,1^2}\\,x^{2-1}e^{-x/1}\\,\\mathbf{1}_{(0,\\infty)}(x).\n$$\n此外，考虑变体目标\n$$\np_{\\varepsilon} = (1-\\varepsilon)\\,p + \\varepsilon\\,\\delta_{0},\n$$\n其中 $\\varepsilon \\in (0,1)$ 且 $\\delta_{0}$ 表示在 $0$ 处的单位点质量。\n\n假设所有随机变量都在一个共同的概率空间上定义，并且所有密度都是关于勒贝格测度 (Lebesgue measure) 的。关于 SNIS 的有效性以及确保 $p \\ll q$ 的约束条件，以下哪些陈述是正确的？选择所有适用项。\n\nA. 当 $p$ 为 $[0,1]$ 上的 $\\mathrm{Beta}(2,3)$ 分布，$q$ 为 $(0,\\infty)$ 上的 $\\mathrm{Gamma}(2,1)$ 分布时，SNIS 是有效的，因为 $p \\ll q$ 且比率 $p(x)/q(x)$ 是 $q$-几乎必然有定义的。\n\nB. 如果 $p$ 被替换为在 $0$ 处具有正原子质量的 $p_{\\varepsilon}$，则 $p \\ll q$ 仍然成立，因为 $q$ 的支撑集是 $(0,\\infty)$ 并且在任意接近 $0$ 的地方都赋予了正密度。\n\nC. 为确保当 $p$ 在 $0$ 处有原子质量时 $p \\ll q$ 成立，必须修改 $q$ 以使其在 $0$ 处包含一个点质量，而这与 $q$ 的支撑集在 $(0,\\infty)$ 上的约束是兼容的。\n\nD. 将提议分布截断为 $q_T(x) \\propto q(x)\\,\\mathbf{1}_{x\\in[0,1]}$ 并从 $q_T$ 采样，可以保持 SNIS 的有效性，并确保对于支撑集在 $[0,1]$ 上的绝对连续分布 $p$，有 $p \\ll q_T$。\n\nE. 实施对落在 $[0,1]$ 之外的样本 $X \\sim q$ 的拒绝（只保留 $X \\in [0,1]$ 的样本），同时使用权重 $w(X)=p(X)/q(X)$ 并对接受的样本进行归一化，会产生一个一致的 SNIS 估计量，该估计量在未归一化权重上与直接从截断提议分布 $q_T$ 采样等效（相差一个常数比例因子）。",
            "solution": "用户要求对问题陈述进行严格验证，然后提供详细的解答和对所有选项的评估。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n\n*   目标分布 $p$ 定义在 $[0,1]$ 上。\n*   提议分布 $q$ 定义在 $(0,\\infty)$ 上。\n*   方法：自归一化重要性采样 (SNIS)。\n*   SNIS 要求：绝对连续性 $p \\ll q$，即对于任何可测集 $A$，若 $q(A)=0$ 则必有 $p(A)=0$。\n*   SNIS 权重基于 Radon–Nikodym 导数 $\\frac{\\mathrm{d}p}{\\mathrm{d}q}$。\n*   感兴趣的函数：$h:[0,1]\\to\\mathbb{R}$，一个有界可测函数。\n*   目标：估计期望 $\\mathbb{E}_p[h(X)]$。\n*   $p$ 的定义：参数为 $\\alpha=2, \\beta=3$ 的贝塔分布。其概率密度函数 (PDF) 为 $p(x) = \\frac{\\Gamma(2+3)}{\\Gamma(2)\\Gamma(3)}\\,x^{2-1}(1-x)^{3-1}\\,\\mathbf{1}_{[0,1]}(x) = 12x(1-x)^2\\,\\mathbf{1}_{[0,1]}(x)$。\n*   $q$ 的定义：形状参数为 $k=2$，尺度参数为 $\\theta=1$ 的伽玛分布。其 PDF 为 $q(x) = \\frac{1}{\\Gamma(2)\\,1^2}\\,x^{2-1}e^{-x/1}\\,\\mathbf{1}_{(0,\\infty)}(x) = xe^{-x}\\,\\mathbf{1}_{(0,\\infty)}(x)$。\n*   变体目标：$p_{\\varepsilon} = (1-\\varepsilon)\\,p + \\varepsilon\\,\\delta_{0}$，对于 $\\varepsilon \\in (0,1)$，其中 $\\delta_{0}$ 是在 $0$ 处的狄拉克测度（单位点质量）。\n*   假设：所有密度都是关于勒贝格测度的。\n\n**步骤2：使用提取的已知条件进行验证**\n\n1.  **科学依据：** 该问题建立在概率论和蒙特卡洛方法的标准数学框架内。贝塔分布和伽玛分布、绝对连续性、Radon-Nikodym 导数和重要性采样等概念都是统计学领域中成熟且基础的概念。该问题在科学上是合理的。\n2.  **定义明确：** 该问题提供了具体、明确的概率分布，并询问在这些及相关条件下应用标准统计程序的有效性。问题是精确的，可以用测度论和概率论进行严格回答。该问题是定义明确的。\n3.  **客观性：** 该问题以正式的数学语言陈述，没有任何主观性、模糊性或观点。\n4.  **完整且一致：** 提供了定义分布 $p$、$q$ 和 $p_{\\varepsilon}$ 所需的所有定义。SNIS 的背景和要求已明确说明。设定中没有内部矛盾。\n5.  **现实且可行：** 该问题是一个统计学中的理论练习。所选的分布和参数是标准的，并且在数学上是易于处理的。\n\n**步骤3：结论与行动**\n\n问题陈述是有效的。这是一个关于一种重要统计方法的理论基础的、定义明确且科学上合理的问题。着手解答。\n\n### 解题推导\n\n这个问题的核心围绕着重要性采样有效性所要求的绝对连续性概念（$p \\ll q$）。这个条件确保了目标分布 $p$ 具有正概率的任何区域，也是提议分布 $q$ 具有正概率的区域。形式上，对于任何可测集 $A$，如果 $q(A)=0$，那么必须有 $p(A)=0$。对于具有关于共同参考测度（如勒贝格测度 $\\lambda$）的密度的分布，这通常表述为 $p$ 的支撑集需要是 $q$ 的支撑集的子集，即 $\\text{supp}(p) \\subseteq \\text{supp}(q)$。\n\n目标密度为 $p(x) = 12x(1-x)^2$，对于 $x \\in [0,1]$。$p(x)0$ 的集合是 $(0,1)$。$p$ 的支撑集是这个集合的闭包，所以 $\\text{supp}(p)=[0,1]$。\n提议密度为 $q(x) = xe^{-x}$，对于 $x \\in (0,\\infty)$。$q(x)0$ 的集合是 $(0,\\infty)$。$q$ 的支撑集是其闭包，所以 $\\text{supp}(q)=[0,\\infty)$。\n\n让我们逐一评估每个陈述。\n\n**A. 当 $p$ 为 $[0,1]$ 上的 $\\mathrm{Beta}(2,3)$ 分布，$q$ 为 $(0,\\infty)$ 上的 $\\mathrm{Gamma}(2,1)$ 分布时，SNIS 是有效的，因为 $p \\ll q$ 且比率 $p(x)/q(x)$ 是 $q$-几乎必然有定义的。**\n\n首先，我们验证绝对连续性条件 $p \\ll q$。如上所述，$\\text{supp}(p) = [0,1]$ 且 $\\text{supp}(q) = [0,\\infty)$。因为 $[0,1] \\subseteq [0,\\infty)$，所以支撑集条件得到满足。\n更正式地，设 $A$ 是一个可测集，使得 $q(A)=0$。\n$q(A) = \\int_A q(x)\\,d\\lambda(x) = \\int_{A \\cap (0,\\infty)} xe^{-x}\\,d\\lambda(x) = 0$。\n由于对于所有 $x \\in (0,\\infty)$，$xe^{-x}  0$，所以集合 $A \\cap (0,\\infty)$ 的勒贝格测度必须为零，即 $\\lambda(A \\cap (0,\\infty)) = 0$。\n现在我们检查 $p(A)$：\n$p(A) = \\int_A p(x)\\,d\\lambda(x) = \\int_{A \\cap [0,1]} 12x(1-x)^2\\,d\\lambda(x)$。\n由于 $A \\cap [0,1] \\subseteq A \\cap [0,\\infty)$，并且 $\\lambda(A \\cap (0,\\infty))=0$，可以推断出 $\\lambda(A \\cap [0,1])=0$ (因为 $\\lambda(\\{0\\})=0$)。\n由于分布 $p$ 关于勒贝格测度 $\\lambda$ 是绝对连续的，如果一个集合的勒贝格测度为零，那么它的 $p$-测度也为零。因此，$p(A)=0$。\n条件 $p \\ll q$ 成立。\n接下来，考虑比率 $w(x) = p(x)/q(x)$。我们为样本 $X \\sim q$ 构造这个比率。由于 $q$ 是一个连续分布，抽取任何特定点的概率为零，所以我们只需要关心具有正概率的区域。密度 $q(x)$ 对所有 $x \\in (0,\\infty)$ 都是正的。对于任何 $x \\in (0,1]$， $p(x)$ 和 $q(x)$ 都是正的，比率为 $w(x) = \\frac{12x(1-x)^2}{xe^{-x}} = 12(1-x)^2e^x$，这是有明确定义且有限的。对于 $x \\in (1,\\infty)$， $p(x)=0$，所以 $w(x)=0$。唯一有问题的点是 $x=0$，此时比率是 $0/0$ 的不定形式。然而，由于 $q$ 是一个连续随机变量，$P(X=0)=0$。因此，比率 $p(x)/q(x)$ 是 $q$-几乎必然有定义的。\n由于必要条件 $p \\ll q$ 得到满足，SNIS 是有效的。\n\n对 A 的结论：**正确**。\n\n**B. 如果 $p$ 被替换为在 $0$ 处具有正原子质量的 $p_{\\varepsilon}$，则 $p \\ll q$ 仍然成立，因为 $q$ 的支撑集是 $(0,\\infty)$ 并且在任意接近 $0$ 的地方都赋予了正密度。**\n\n新的目标测度是 $p_{\\varepsilon} = (1-\\varepsilon)\\,p + \\varepsilon\\,\\delta_{0}$。让我们检验绝对连续性条件 $p_{\\varepsilon} \\ll q$。我们必须检查是否对于所有可测集 $A$，$q(A)=0$ 意味着 $p_{\\varepsilon}(A)=0$。\n考虑集合 $A = \\{0\\}$。\n该集合在 $q$ 下的测度是 $q(\\{0\\}) = \\int_{\\{0\\}} xe^{-x}\\,d\\lambda(x) = 0$，因为 $q$ 是关于勒贝格测度绝对连续的。\n该集合在 $p_{\\varepsilon}$ 下的测度是 $p_{\\varepsilon}(\\{0\\}) = (1-\\varepsilon)p(\\{0\\}) + \\varepsilon\\delta_{0}(\\{0\\})$。\n由于 $p$ 是连续的贝塔分布，$p(\\{0\\})=0$。狄拉克测度 $\\delta_0$ 给出 $\\delta_0(\\{0\\}) = 1$。\n所以，$p_{\\varepsilon}(\\{0\\}) = (1-\\varepsilon)(0) + \\varepsilon(1) = \\varepsilon$。\n由于 $\\varepsilon \\in (0,1)$，我们有 $p_{\\varepsilon}(\\{0\\})  0$。\n我们找到了一个集合 $A=\\{0\\}$，对于它 $q(A)=0$ 但是 $p_{\\varepsilon}(A)  0$。这直接违反了绝对连续性的定义。因此，$p_{\\varepsilon} \\not\\ll q$。\n陈述中提供的理由（“因为 $q$ ... 在任意接近 $0$ 的地方都赋予了正密度”）与绝对连续性的严格定义无关，后者涉及零测度集，而不是密度函数在某点附近的行为。\n\n对 B 的结论：**不正确**。\n\n**C. 为确保当 $p$ 在 $0$ 处有原子质量时 $p \\ll q$ 成立，必须修改 $q$ 以使其在 $0$ 处包含一个点质量，而这与 $q$ 的支撑集在 $(0,\\infty)$ 上的约束是兼容的。**\n\n陈述的第一部分是正确的。如果目标分布在某点 $x_0$ 有点质量（原子），即 $p(\\{x_0\\})  0$，那么为了使绝对连续性 $p \\ll q$ 成立，提议分布也必须有 $q(\\{x_0\\})  0$。所以，如果 $p$ 在 $0$ 处有原子质量，提议分布 $q$ 必须被修改为在 $0$ 处也有原子质量。\n陈述的第二部分声称这种修改“与 $q$ 的支撑集在 $(0,\\infty)$ 上的约束是兼容的”。\n一个分布的支撑集是使其补集概率为零的最小闭集 $S$。如果一个分布 $q'$ 在 $0$ 处有一个点质量，那么 $q'(\\{0\\})  0$。任何包含 $0$ 的开集 $U$ 必须有 $q'(U)  0$。这意味着 $0$ 必须在 $q'$ 的支撑集中。$(0,\\infty)$ 的支撑集是不包括 $0$ 的非负实数集。一个支撑集包含 $0$ 的分布不能同时拥有一个 $(0,\\infty)$ 的支撑集。这两个条件是互相排斥的。\n\n对 C 的结论：**不正确**。\n\n**D. 将提议分布截断为 $q_T(x) \\propto q(x)\\,\\mathbf{1}_{x\\in[0,1]}$ 并从 $q_T$ 采样，可以保持 SNIS 的有效性，并确保对于支撑集在 $[0,1]$ 上的绝对连续分布 $p$，有 $p \\ll q_T$。**\n\n让我们定义截断的提议密度 $q_T(x)$。\n$q_T(x) = C^{-1} q(x) \\mathbf{1}_{[0,1]}(x)$，其中 $C = \\int_0^1 q(x)\\,dx = \\int_0^1 xe^{-x}\\,dx$。\n使用分部积分法，$C = [-xe^{-x} - e^{-x}]_0^1 = (-e^{-1} - e^{-1}) - (0 - e^0) = 1 - 2e^{-1}  0$。\n密度为 $q_T(x) = \\frac{xe^{-x}}{1-2e^{-1}}$，对于 $x \\in [0,1]$，其他地方为 $0$。$q_T$ 的支撑集是 $\\text{supp}(q_T) = [0,1]$。\n问题考虑一个支撑集在 $[0,1]$ 上的泛指的绝对连续目标 $p$。这意味着 $\\text{supp}(p) \\subseteq [0,1]$。对于我们特定的贝塔分布，$\\text{supp}(p)=[0,1]$。\n我们检查 $p \\ll q_T$。我们有 $\\text{supp}(p) \\subseteq [0,1] = \\text{supp}(q_T)$，所以支撑集条件满足。更正式地，设 $A$ 是一个测度为 $q_T(A)=0$ 的集合。$q_T(A)=\\int_A q_T(x)d\\lambda(x) = 0$。因为对于 $x \\in (0,1]$，$q_T(x)  0$，这意味着 $\\lambda(A \\cap (0,1]) = 0$，因此 $\\lambda(A \\cap [0,1]) = 0$。由于 $p$ 是关于勒贝格测度绝对连续的，并且其支撑集在 $[0,1]$ 上，所以 $p(A) = \\int_{A \\cap [0,1]} p(x)d\\lambda(x) = 0$。因此，$p \\ll q_T$ 成立。\n因为这个基本要求得到满足，使用这个新的提议分布 $q_T$ 时，SNIS 是有效的。该陈述是正确的。\n\n对 D 的结论：**正确**。\n\n**E. 实施对落在 $[0,1]$ 之外的样本 $X \\sim q$ 的拒绝（只保留 $X \\in [0,1]$ 的样本），同时使用权重 $w(X)=p(X)/q(X)$ 并对接受的样本进行归一化，会产生一个一致的 SNIS 估计量，该估计量在未归一化权重上与直接从截断提议分布 $q_T$ 采样等效（相差一个常数比例因子）。**\n\n这个陈述描述了一个实际的算法。让我们分析它的组成部分。\n1.  **采样过程：** 从 $q$ 中抽取样本，并且只在它们落入区间 $[0,1]$ 时接受它们，这是一种标准的拒绝采样技术。被接受的样本（我们称之为 $Y$）的分布是 $X \\sim q$ 在条件 $X \\in [0,1]$ 下的分布。这个条件分布的密度正是选项 D 中定义的截断密度 $q_T(x)$：$f_Y(y) = \\frac{q(y)}{P(X \\in [0,1])} = \\frac{q(y)}{C} = q_T(y)$，对于 $y \\in [0,1]$。所以这个过程生成了来自 $q_T$ 的独立同分布样本。\n\n2.  **加权：** 对于这些样本 $Y_i \\sim q_T$，该过程使用权重 $w(Y_i) = p(Y_i)/q(Y_i)$。\n\n3.  **等价性：** 从 $q_T$ 采样的“正确”重要性权重是 $w_T(Y_i) = p(Y_i)/q_T(Y_i)$。让我们比较 $w(Y_i)$ 和 $w_T(Y_i)$：\n    $w_T(Y_i) = \\frac{p(Y_i)}{q_T(Y_i)} = \\frac{p(Y_i)}{q(Y_i)/C} = C \\left(\\frac{p(Y_i)}{q(Y_i)}\\right) = C \\cdot w(Y_i)$。\n    未归一化的权重 $w_T$ 和 $w$ 是成比例的，相差一个常数因子 $C$。陈述“在未归一化权重上与...等效（相差一个常数比例因子）”是正确的。\n\n4.  **SNIS 估计量：** SNIS 估计量是通过对权重进行归一化形成的：\n    $\\hat{I}_{SNIS} = \\frac{\\sum_i w(Y_i)h(Y_i)}{\\sum_i w(Y_i)}$。\n    如果我们使用“正确”的权重 $w_T$，估计量将是：\n    $\\hat{I}'_{SNIS} = \\frac{\\sum_i w_T(Y_i)h(Y_i)}{\\sum_i w_T(Y_i)} = \\frac{\\sum_i C \\cdot w(Y_i)h(Y_i)}{\\sum_i C \\cdot w(Y_i)} = \\frac{C \\sum_i w(Y_i)h(Y_i)}{C \\sum_i w(Y_i)} = \\hat{I}_{SNIS}$。\n    这两个估计量是相同的，因为比例常数 $C$ 在分子和分母中被抵消了。由于从 $q_T$ 采样是一个有效的过程（如在 D 中所证），它会得到一个一致的估计量，因此这个等价的过程也会产生一个一致的估计量。\n\n对 E 的结论：**正确**。",
            "answer": "$$\\boxed{ADE}$$"
        },
        {
            "introduction": "评估一个统计估计量的一个关键方面是理解其方差，方差量化了估计的精度。对于自归一化重要性抽样（SNIS）估计量，其方variance可以通过样本量趋于无穷时的渐近行为来表征。这个问题  提供了一个实践指南，教你如何使用Delta方法推导SNIS估计量的渐近方差常数。虽然为了清晰起见，场景被简化了，但这个过程阐明了用于分析SNIS估计量稳定性和效率的通用数学工具。",
            "id": "3338585",
            "problem": "考虑使用自归一化重要性采样 (SNIS) 来估计目标分布下一个函数的期望。设目标分布为 $p=\\mathcal{N}(0,1)$，提议分布为 $q=\\mathcal{N}(0,1)$，被积函数为 $h(x)=x^{4}$。定义未归一化重要性权重 $w(x)$ 为 $w(x)=\\frac{p(x)}{q(x)}$，并基于独立同分布样本 $X_{1},\\dots,X_{n}\\sim q$ 定义 SNIS 估计量为\n$$\n\\hat{\\mu}_{n}=\\sum_{i=1}^{n}\\tilde{w}_{i}h(X_{i}),\\quad\\text{其中}\\quad \\tilde{w}_{i}=\\frac{w(X_{i})}{\\sum_{j=1}^{n}w(X_{j})}.\n$$\n从基本定义和中心极限定理 (CLT) 出发，使用 SNIS 的均值比表示和 Delta 方法推导由下式定义的渐近方差常数 $\\sigma^{2}$\n$$\n\\sqrt{n}\\left(\\hat{\\mu}_{n}-\\mu\\right)\\;\\Rightarrow\\;\\mathcal{N}\\!\\left(0,\\sigma^{2}\\right),\n$$\n其中 $\\mu=\\mathbb{E}_{p}[h(X)]$。计算 $\\mu$，明确求出 $w(x)$，然后推导 $\\sigma^{2}$ 的一个闭式表达式，对于给定的 $p$、$q$ 和 $h$，该表达式可简化为一个具体的实数。使用 LaTeX 的 $\\mathrm{pmatrix}$ 环境，将你的最终答案表示为行向量 $\\big(\\mu,\\;w(x),\\;\\sigma^{2}\\big)$。无需四舍五入，不涉及单位。",
            "solution": "该问题陈述被评估为有效。它在随机模拟和蒙特卡洛方法的既定理论，特别是自归一化重要性采样的框架内具有科学依据。该问题是适定的、客观的且自洽的，提供了推导所要求的所有量的必要信息。该设置虽然代表了目标分布和提议分布相同的简化情况，但它是一个有效的场景，用于测试指定理论工具（用于比率估计量的 Delta 方法）的应用。不存在科学或事实上的不健全、矛盾或模糊之处。\n\n求解过程如下。首先，确定目标期望 $\\mu$ 和未归一化重要性权重函数 $w(x)$。其次，将自归一化重要性采样 (SNIS) 估计量表示为两个样本均值的比率。第三，将 Delta 方法应用于此比率，以推导渐近方差常数 $\\sigma^2$ 的一般形式。最后，针对问题中给定的特定分布和被积函数，对此一般表达式进行求值，以获得数值结果。\n\n目标期望 $\\mu$ 定义为函数 $h(x)=x^4$ 关于目标分布 $p=\\mathcal{N}(0,1)$ 的期望。变量 $X$ 是一个标准正态随机变量。\n$$\n\\mu = \\mathbb{E}_{p}[h(X)] = \\mathbb{E}_{p}[X^4]\n$$\n这是标准正态分布的四阶矩。对于随机变量 $Z \\sim \\mathcal{N}(0, 1)$，其 $k$ 阶矩 $\\mathbb{E}[Z^k]$ 对于偶数 $k$ 由 $(k-1)!! = (k-1)(k-3)\\cdots 1$ 给出，对于奇数 $k$ 则为 $0$。对于 $k=4$，四阶矩为：\n$$\n\\mu = (4-1)!! = 3 \\times 1 = 3\n$$\n\n接下来，确定未归一化重要性权重函数 $w(x)$。它是目标概率密度函数 (PDF) $p(x)$ 与提议概率密度函数 (PDF) $q(x)$ 的比值。\n给定 $p(x) = \\mathcal{N}(0,1)$ 和 $q(x) = \\mathcal{N}(0,1)$，它们的 PDF 是相同的：\n$$\np(x) = \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{x^2}{2}\\right)\n$$\n$$\nq(x) = \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{x^2}{2}\\right)\n$$\n因此，权重函数为：\n$$\nw(x) = \\frac{p(x)}{q(x)} = \\frac{\\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{x^2}{2}\\right)}{\\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{x^2}{2}\\right)} = 1\n$$\n对于所有 $x$，权重是常数且等于 $1$。\n\nSNIS 估计量 $\\hat{\\mu}_n$ 可以表示为样本均值的比率。设 $Y_i = w(X_i)h(X_i)$ 和 $Z_i = w(X_i)$，其中 $X_i \\sim q$。该估计量为：\n$$\n\\hat{\\mu}_{n} = \\frac{\\sum_{i=1}^{n} Y_i}{\\sum_{j=1}^{n} Z_j} = \\frac{\\frac{1}{n}\\sum_{i=1}^{n} Y_i}{\\frac{1}{n}\\sum_{j=1}^{n} Z_j} = \\frac{\\bar{Y}_n}{\\bar{Z}_n}\n$$\n为了找到渐近方差，我们使用 Delta 方法。我们首先考虑向量 $(\\bar{Y}_n, \\bar{Z}_n)$ 的联合渐近分布。设 $V_i = \\begin{pmatrix} Y_i \\\\ Z_i \\end{pmatrix}$。$V_i$ 关于提议分布 $q$ 的期望是：\n$$\n\\mathbb{E}_q[V] = \\begin{pmatrix} \\mathbb{E}_q[Y] \\\\ \\mathbb{E}_q[Z] \\end{pmatrix} = \\begin{pmatrix} \\mathbb{E}_q[w(X)h(X)] \\\\ \\mathbb{E}_q[w(X)] \\end{pmatrix}\n$$\n计算这些期望：\n$$\n\\mathbb{E}_q[w(X)] = \\int w(x)q(x) \\,dx = \\int \\frac{p(x)}{q(x)}q(x) \\,dx = \\int p(x) \\,dx = 1\n$$\n$$\n\\mathbb{E}_q[w(X)h(X)] = \\int w(x)h(x)q(x) \\,dx = \\int \\frac{p(x)}{q(x)}h(x)q(x) \\,dx = \\int h(x)p(x) \\,dx = \\mathbb{E}_p[h(X)] = \\mu\n$$\n因此，$\\mathbb{E}_q[V] = \\begin{pmatrix} \\mu \\\\ 1 \\end{pmatrix}$。根据多元中心极限定理，\n$$\n\\sqrt{n}\\left(\\begin{pmatrix} \\bar{Y}_n \\\\ \\bar{Z}_n \\end{pmatrix} - \\begin{pmatrix} \\mu \\\\ 1 \\end{pmatrix}\\right) \\Rightarrow \\mathcal{N}(0, \\Sigma)\n$$\n其中 $\\Sigma$ 是 $V_i$ 在 $q$ 分布下的协方差矩阵：\n$$\n\\Sigma = \\text{Cov}_q(V) = \\begin{pmatrix} \\text{Var}_q(Y)  \\text{Cov}_q(Y,Z) \\\\ \\text{Cov}_q(Y,Z)  \\text{Var}_q(Z) \\end{pmatrix}\n$$\n估计量 $\\hat{\\mu}_n$ 是一个函数 $g(\\bar{Y}_n, \\bar{Z}_n)$，其中 $g(y,z) = y/z$。根据 Delta 方法，$\\sqrt{n}(\\hat{\\mu}_n - \\mu)$ 的渐近分布是 $\\mathcal{N}(0, \\sigma^2)$，其中 $\\sigma^2 = (\\nabla g)^T \\Sigma (\\nabla g)$，梯度 $\\nabla g$ 在点 $(\\mathbb{E}_q[Y], \\mathbb{E}_q[Z]) = (\\mu, 1)$ 处求值。\n$g(y,z)$ 的梯度是 $\\nabla g(y,z) = \\begin{pmatrix} 1/z \\\\ -y/z^2 \\end{pmatrix}$。在 $(\\mu, 1)$ 处求值为 $\\nabla g(\\mu,1) = \\begin{pmatrix} 1 \\\\ -\\mu \\end{pmatrix}$。\n渐近方差为：\n$$\n\\sigma^2 = \\begin{pmatrix} 1  -\\mu \\end{pmatrix} \\Sigma \\begin{pmatrix} 1 \\\\ -\\mu \\end{pmatrix}\n= \\begin{pmatrix} 1  -\\mu \\end{pmatrix} \\begin{pmatrix} \\text{Var}_q(Y)  \\text{Cov}_q(Y,Z) \\\\ \\text{Cov}_q(Y,Z)  \\text{Var}_q(Z) \\end{pmatrix} \\begin{pmatrix} 1 \\\\ -\\mu \\end{pmatrix}\n$$\n$$\n\\sigma^2 = \\text{Var}_q(Y) - 2\\mu\\text{Cov}_q(Y,Z) + \\mu^2\\text{Var}_q(Z)\n$$\n这是随机变量 $Y-\\mu Z$ 在 $q$ 分布下的方差。\n$$\n\\sigma^2 = \\text{Var}_q(Y - \\mu Z) = \\mathbb{E}_q\\left[ \\left( (Y - \\mu Z) - \\mathbb{E}_q[Y-\\mu Z] \\right)^2 \\right]\n$$\n因为 $\\mathbb{E}_q[Y-\\mu Z] = \\mathbb{E}_q[Y] - \\mu \\mathbb{E}_q[Z] = \\mu - \\mu(1) = 0$，这可以简化为：\n$$\n\\sigma^2 = \\mathbb{E}_q[(Y - \\mu Z)^2] = \\mathbb{E}_q[(w(X)h(X) - \\mu w(X))^2] = \\mathbb{E}_q[w(X)^2 (h(X) - \\mu)^2]\n$$\n这就是 SNIS 估计量的渐近方差常数的一般表达式。\n\n现在，我们代入此问题的具体值：$w(x)=1$，$h(x)=x^4$ 和 $\\mu=3$。期望是关于 $q = \\mathcal{N}(0,1)$ 计算的。\n$$\n\\sigma^2 = \\mathbb{E}_q[1^2 (X^4 - 3)^2] = \\mathbb{E}_q[(X^4 - 3)^2]\n$$\n展开平方项：\n$$\n\\sigma^2 = \\mathbb{E}_q[X^8 - 6X^4 + 9]\n$$\n根据期望的线性性质：\n$$\n\\sigma^2 = \\mathbb{E}_q[X^8] - 6\\mathbb{E}_q[X^4] + 9\n$$\n我们需要标准正态分布的八阶矩。使用公式 $(k-1)!!$，对于 $k=8$：\n$$\n\\mathbb{E}_q[X^8] = (8-1)!! = 7 \\times 5 \\times 3 \\times 1 = 105\n$$\n我们已经计算出 $\\mathbb{E}_q[X^4] = 3$（因为 $p=q$）。代入这些值：\n$$\n\\sigma^2 = 105 - 6(3) + 9 = 105 - 18 + 9 = 87 + 9 = 96\n$$\n作为验证，在 $p=q$ 的特殊情况下，$w(x)=1$，SNIS 估计量简化为标准蒙特卡洛估计量 $\\hat{\\mu}_n = \\frac{1}{n}\\sum_{i=1}^n h(X_i)$。根据标准中心极限定理，渐近方差就是被积函数相对于采样分布的方差，即 $\\text{Var}_q(h(X))$。\n$$\n\\sigma^2 = \\text{Var}_q(h(X)) = \\text{Var}_q(X^4) = \\mathbb{E}_q[(X^4)^2] - (\\mathbb{E}_q[X^4])^2 = \\mathbb{E}_q[X^8] - (\\mathbb{E}_q[X^4])^2\n$$\n$$\n\\sigma^2 = 105 - 3^2 = 105 - 9 = 96\n$$\n结果是一致的。\n\n最终答案是行向量 $(\\mu, w(x), \\sigma^2)$。代入计算出的值：\n$$\n(\\mu, w(x), \\sigma^2) = (3, 1, 96)\n$$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 3  1  96 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "虽然重要性抽样在理论上很强大，但它可能会遭受“维度灾难”的影响，即其效率随着维度数的增加而急剧下降。针对此问题的一个关键诊断指标是有效样本量（ESS），它衡量加权样本与未加权样本相比保留了多少信息。在这个高级实践中 ，你将推导高维高斯设定下渐近ESS的解析形式，揭示一个估计量性能崩溃的急剧“相变”。这项练习将抽象的矩阵属性与估计量的具体实际失效联系起来，为高维模拟的挑战提供了深刻的见解。",
            "id": "3338598",
            "problem": "考虑使用自归一化重要性采样 (Self-Normalized Importance Sampling, SNIS) 估计一个 $d$ 维高斯目标分布下的期望，其密度为 $\\pi(x) = \\mathcal{N}(0,\\Sigma)$，并使用高斯提议分布 $q(x) = \\mathcal{N}(0,I)$。其中，$\\Sigma \\in \\mathbb{R}^{d \\times d}$ 是对称正定矩阵，$I$ 是 $d \\times d$ 单位矩阵，$x \\in \\mathbb{R}^{d}$。设未归一化的重要性权重为 $w(x) = \\pi(x)/q(x)$，对于从 $q$ 中抽取的独立同分布样本 $x_{1},\\dots,x_{n} \\sim q$，归一化的权重为 $\\tilde{w}_{i} = w(x_{i}) / \\sum_{j=1}^{n} w(x_{j})$。SNIS 权重的有效样本量 (Effective Sample Size, ESS) 定义为 $\\mathrm{ESS} = \\left(\\sum_{i=1}^{n} w(x_{i})\\right)^{2} \\big/ \\sum_{i=1}^{n} w(x_{i})^{2}$。您的任务是分析归一化 ESS 分数 $\\mathrm{ESS}/n$ 作为 $\\Sigma$ 的谱与维度 $d$ 的函数时的高维行为。\n\n您必须仅从第一性原理和经过充分检验的事实出发。具体来说，您可以依赖大数定律 (Law of Large Numbers, LLN) 和二次型的高斯积分恒等式，但不得假设任何关于 $\\mathrm{ESS}/n$ 的预先推导出的公式。\n\n任务：\n- 从 SNIS 的定义和 LLN 出发，推导当 $n \\to \\infty$ 时 $\\mathrm{ESS}/n$ 的几乎必然收敛的极限的闭式表达式，用 $\\mathbb{E}_{q}[w(X)]$ 和 $\\mathbb{E}_{q}[w(X)^{2}]$ 表示，并假定这些期望是有限的。\n- 针对高斯情况 $\\pi = \\mathcal{N}(0,\\Sigma)$ 和 $q=\\mathcal{N}(0,I)$，仅使用二次型的基本高斯积分恒等式来计算 $\\mathbb{E}_{q}[w(X)]$ 和 $\\mathbb{E}_{q}[w(X)^{2}]$。将 $\\mathrm{ESS}/n$ 的极限表示为 $\\Sigma$ 的特征值 $\\{\\lambda_{i}\\}_{i=1}^{d}$ 的函数。\n- 确定使 $\\mathbb{E}_{q}[w(X)^{2}]$ 有限的谱条件，并描述当 $d$ 增长时 ESS 分数相应的相变。具体而言，确定谱上的乘积如何使极限趋于零或保持有界，并证明任何边界行为。\n- 实现一个程序，对于给定的有限谱集和维度，计算上述推导出的 $\\mathrm{ESS}/n$ 的理论极限。您不能进行模拟；必须使用特征值以闭式形式计算该极限。\n\n角度单位不相关。没有物理单位。\n\n测试套件和输出规范：\n- 使用以下五个测试用例，每个用例由维度 $d$ 和以块形式 $(\\lambda,\\text{计数})$ 给出的 $\\Sigma$ 的特征值的多重集指定：\n  $1.$ $d = 10$, 谱 $\\{(1,10)\\}$。\n  $2.$ $d = 10$, 谱 $\\{(1/2,10)\\}$。\n  $3.$ $d = 20$, 谱 $\\{(4/5,10),(6/5,10)\\}$。\n  $4.$ $d = 10$, 谱 $\\{(2,1),(1,9)\\}$。\n  $5.$ $d = 5$, 谱 $\\{(5/2,1),(1,4)\\}$。\n- 对于每个测试用例，计算根据您的分析推导出的当 $n \\to \\infty$ 时 $\\mathrm{ESS}/n$ 的理论极限。如果由于 $\\mathbb{E}_{q}[w(X)^{2}]$ 的发散或存在零因子而导致极限为零，则返回 $0$。\n- 您的程序应生成单行输出，其中包含五个结果，形式为逗号分隔的浮点数列表，四舍五入到六位小数，并用方括号括起来（例如，“[$r_{1},r_{2},r_{3},r_{4},r_{5}$]”）。",
            "solution": "该问题要求在高维高斯设定下，对自归一化重要性采样 (SNIS) 的有效样本量 (ESS) 的渐近行为进行分析。我们必须首先推导出当样本数量 $n$ 趋于无穷大时，归一化 ESS 分数 $\\mathrm{ESS}/n$ 的极限的闭式表达式。然后，必须针对特定的目标分布和提议分布对该表达式进行求值，并最终用于计算给定测试用例的结果。\n\n让我们从建立理论基础开始。\n\n**步骤 1：ESS 分数的渐近极限**\n\n有效样本量定义为：\n$$ \\mathrm{ESS} = \\frac{\\left(\\sum_{i=1}^{n} w(x_{i})\\right)^{2}}{\\sum_{i=1}^{n} w(x_{i})^{2}} $$\n其中 $w(x_i)$ 是从提议分布 $q(x)$ 中抽取的一组独立同分布样本 $x_1, \\dots, x_n$ 的未归一化重要性权重。我们感兴趣的是当 $n \\to \\infty$ 时，归一化 ESS 分数 $\\mathrm{ESS}/n$ 的几乎必然收敛的极限。我们可以将表达式重写为：\n$$ \\frac{\\mathrm{ESS}}{n} = \\frac{1}{n} \\frac{\\left(\\sum_{i=1}^{n} w(x_{i})\\right)^{2}}{\\sum_{i=1}^{n} w(x_{i})^{2}} = \\frac{\\left(\\frac{1}{n}\\sum_{i=1}^{n} w(x_{i})\\right)^{2}}{\\frac{1}{n}\\sum_{i=1}^{n} w(x_{i})^{2}} $$\n样本 $X_1, \\dots, X_n$ 是从 $q$ 中独立同分布抽取的，因此权重 $W_i = w(X_i)$ 也构成一个独立同分布随机变量序列。根据强大数定律 (LLN)，$W$ 和 $W^2$ 的样本均值几乎必然收敛到它们各自的期望，前提是这些期望是有限的：\n$$ \\frac{1}{n}\\sum_{i=1}^{n} w(X_{i}) \\xrightarrow{\\text{a.s.}} \\mathbb{E}_{q}[w(X)] \\quad \\text{当 } n \\to \\infty $$\n$$ \\frac{1}{n}\\sum_{i=1}^{n} w(X_{i})^{2} \\xrightarrow{\\text{a.s.}} \\mathbb{E}_{q}[w(X)^{2}] \\quad \\text{当 } n \\to \\infty $$\n根据连续映射定理，这些量的比率收敛到它们极限的比率，假设分母的极限非零。因此，ESS 分数的几乎必然收敛的极限是：\n$$ \\lim_{n \\to \\infty} \\frac{\\mathrm{ESS}}{n} \\xrightarrow{\\text{a.s.}} \\frac{\\left(\\mathbb{E}_{q}[w(X)]\\right)^{2}}{\\mathbb{E}_{q}[w(X)^{2}]} $$\n此结果在 $\\mathbb{E}_{q}[w(X)^2]$ 有限时成立。如果 $\\mathbb{E}_{q}[w(X)^2]$ 是无限的，则权重的方差是无限的，这导致估计器效率的崩溃，$\\mathrm{ESS}/n$ 的极限为 $0$。\n\n**步骤 2：高斯情况下期望的计算**\n\n目标分布和提议分布由下式给出：\n-   目标分布 $\\pi(x) = \\mathcal{N}(x | 0, \\Sigma) = \\frac{1}{(2\\pi)^{d/2} |\\Sigma|^{1/2}} \\exp\\left(-\\frac{1}{2} x^T \\Sigma^{-1} x\\right)$\n-   提议分布 $q(x) = \\mathcal{N}(x | 0, I) = \\frac{1}{(2\\pi)^{d/2}} \\exp\\left(-\\frac{1}{2} x^T x\\right)$\n其中 $|\\Sigma| = \\det(\\Sigma)$。未归一化的权重函数 $w(x) = \\pi(x)/q(x)$ 为：\n$$ w(x) = \\frac{1}{|\\Sigma|^{1/2}} \\exp\\left(-\\frac{1}{2} x^T \\Sigma^{-1} x + \\frac{1}{2} x^T x\\right) = \\frac{1}{|\\Sigma|^{1/2}} \\exp\\left(-\\frac{1}{2} x^T (\\Sigma^{-1} - I) x\\right) $$\n首先，我们计算权重的期望 $\\mathbb{E}_{q}[w(X)]$：\n$$ \\mathbb{E}_{q}[w(X)] = \\int_{\\mathbb{R}^d} w(x) q(x) dx = \\int_{\\mathbb{R}^d} \\frac{\\pi(x)}{q(x)} q(x) dx = \\int_{\\mathbb{R}^d} \\pi(x) dx = 1 $$\n这是一个通用性质，因为 $\\pi(x)$ 是一个概率密度函数。因此，$(\\mathbb{E}_{q}[w(X)])^2 = 1^2 = 1$。渐近 ESS 分数简化为：\n$$ \\lim_{n \\to \\infty} \\frac{\\mathrm{ESS}}{n} = \\frac{1}{\\mathbb{E}_{q}[w(X)^{2}]} $$\n接下来，我们计算权重的二阶矩 $\\mathbb{E}_{q}[w(X)^2]$：\n$$ \\mathbb{E}_{q}[w(X)^{2}] = \\int_{\\mathbb{R}^d} w(x)^2 q(x) dx $$\n项 $w(x)^2 q(x)$ 为：\n$$ w(x)^2 q(x) = \\left(\\frac{1}{|\\Sigma|^{1/2}} \\exp\\left[-\\frac{1}{2} x^T (\\Sigma^{-1} - I) x\\right]\\right)^2 \\frac{1}{(2\\pi)^{d/2}} \\exp\\left(-\\frac{1}{2} x^T x\\right) $$\n$$ = \\frac{1}{|\\Sigma|} \\frac{1}{(2\\pi)^{d/2}} \\exp\\left[-x^T (\\Sigma^{-1} - I) x - \\frac{1}{2} x^T x\\right] $$\n$$ = \\frac{1}{|\\Sigma|(2\\pi)^{d/2}} \\exp\\left[-\\frac{1}{2} x^T (2(\\Sigma^{-1} - I) + I) x\\right] $$\n$$ = \\frac{1}{|\\Sigma|(2\\pi)^{d/2}} \\exp\\left[-\\frac{1}{2} x^T (2\\Sigma^{-1} - I) x\\right] $$\n令矩阵 $A = 2\\Sigma^{-1} - I$。则期望为：\n$$ \\mathbb{E}_{q}[w(X)^{2}] = \\frac{1}{|\\Sigma|} \\int_{\\mathbb{R}^d} \\frac{1}{(2\\pi)^{d/2}} \\exp\\left(-\\frac{1}{2} x^T A x\\right) dx $$\n该积分与高斯分布的归一化常数有关。对于正定矩阵 $A$，使用恒等式 $\\int \\exp(-\\frac{1}{2}x^T A x) dx = (2\\pi)^{d/2} |A|^{-1/2}$，我们得到：\n$$ \\mathbb{E}_{q}[w(X)^{2}] = \\frac{1}{|\\Sigma|} |A|^{-1/2} = \\frac{1}{|\\Sigma| |2\\Sigma^{-1} - I|^{1/2}} $$\n设 $\\{\\lambda_i\\}_{i=1}^d$ 为 $\\Sigma$ 的特征值。行列式是特征值的乘积，所以 $|\\Sigma| = \\prod_{i=1}^d \\lambda_i$。$2\\Sigma^{-1} - I$ 的特征值是 $2/\\lambda_i - 1$。因此，其行列式为 $|2\\Sigma^{-1} - I| = \\prod_{i=1}^d (2/\\lambda_i - 1)$。\n将此代入期望的表达式中：\n$$ |2\\Sigma^{-1} - I|^{1/2} = \\left(\\prod_{i=1}^d \\frac{2-\\lambda_i}{\\lambda_i}\\right)^{1/2} = \\frac{\\sqrt{\\prod(2-\\lambda_i)}}{\\sqrt{\\prod\\lambda_i}} = \\frac{|\\sqrt{2I - \\Sigma}|}{|\\Sigma|^{1/2}} $$\n所以，\n$$ \\mathbb{E}_{q}[w(X)^{2}] = \\frac{1}{|\\Sigma| \\frac{|\\sqrt{2I - \\Sigma}|}{|\\Sigma|^{1/2}}} = \\frac{1}{|\\Sigma|^{1/2} |\\sqrt{2I - \\Sigma}|} = \\frac{1}{\\sqrt{|\\Sigma||2I - \\Sigma|}} $$\n$$ = \\left(\\prod_{i=1}^d \\lambda_i(2-\\lambda_i)\\right)^{-1/2} $$\n最后，渐近 ESS 分数为：\n$$ \\lim_{n \\to \\infty} \\frac{\\mathrm{ESS}}{n} = \\frac{1}{\\mathbb{E}_{q}[w(X)^{2}]} = \\sqrt{\\prod_{i=1}^d \\lambda_i(2-\\lambda_i)} $$\n\n**步骤 3：有限性条件和相变**\n\n$\\mathbb{E}_{q}[w(X)^2]$ 的积分收敛当且仅当矩阵 $A = 2\\Sigma^{-1} - I$ 是对称正定的。由于 $\\Sigma$ 是对称的，$A$ 也是对称的。要使其为正定，其所有特征值必须为正。$A$ 的特征值为 $2/\\lambda_i - 1$。\n$$ \\frac{2}{\\lambda_i} - 1  0 \\implies \\frac{2}{\\lambda_i}  1 $$\n由于 $\\Sigma$ 是正定的，其特征值 $\\lambda_i$ 均为正。因此，我们可以乘以 $\\lambda_i$ 而不等式方向不变：\n$$ 2  \\lambda_i $$\n权重二阶矩有限（从而渐近 ESS 分数非零）的条件是，$\\Sigma$ 的所有特征值必须严格小于 $2$。\n$$ 0  \\lambda_i  2 \\quad \\text{对于所有 } i \\in \\{1, \\dots, d\\} $$\n如果任何特征值 $\\lambda_k \\ge 2$，那么 $\\mathbb{E}_{q}[w(X)^2]$ 发散，渐近 ESS 分数坍缩为 $0$。这标志着一个相变。函数 $f(\\lambda) = \\lambda(2-\\lambda)$ 在 $\\lambda=1$ 处取得最大值 $f(1) = 1$，对于任何其他 $\\lambda \\in (0, 2)$，该函数值都小于 $1$。渐近 ESS 分数是 $d$ 个此类项（在平方根下）的乘积，因此除非所有 $\\lambda_i$ 都恰好为 $1$，否则当 $d \\to \\infty$ 时，它将指数衰减到 $0$。这说明了重要性采样中的维度灾难。\n\n**计算公式**\n\n对于给定的 $\\Sigma$ 的谱 $\\{\\lambda_i\\}_{i=1}^d$：\n1.  如果存在任何特征值 $\\lambda_k \\ge 2$，则 $\\mathrm{ESS}/n$ 的极限为 $0$。\n2.  否则，极限为 $\\sqrt{\\prod_{i=1}^d (\\lambda_i(2-\\lambda_i))}$。\n此公式将用于计算测试用例的结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the theoretical limit of ESS/n for the given test cases.\n\n    The problem asks for the analysis of the Self-Normalized Importance Sampling (SNIS)\n    Effective Sample Size (ESS) for a Gaussian target and proposal. The asymptotic limit\n    of the normalized ESS fraction ESS/n as n - infinity is given by:\n\n        lim (ESS/n) = (E_q[w(X)])^2 / E_q[w(X)^2]\n\n    For the specified Gaussian distributions pi = N(0, Sigma) and q = N(0, I),\n    this limit can be derived in closed form. E_q[w(X)] is always 1. The main\n    challenge is E_q[w(X)^2], which is finite only if all eigenvalues of Sigma,\n    lambda_i, satisfy 0  lambda_i  2.\n\n    The final formula for the limit in terms of the eigenvalues {lambda_i} is:\n\n        lim (ESS/n) = sqrt(product_{i=1 to d} [lambda_i * (2 - lambda_i)])\n\n    If any lambda_i = 2, the second moment of the weights diverges, and the\n    asymptotic ESS/n is 0.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (d, spectrum as list of (eigenvalue, count))\n        (10, [(1.0, 10)]),\n        (10, [(1.0/2.0, 10)]),\n        (20, [(4.0/5.0, 10), (6.0/5.0, 10)]),\n        (10, [(2.0, 1), (1.0, 9)]),\n        (5, [(5.0/2.0, 1), (1.0, 4)]),\n    ]\n\n    results = []\n    for d, spectrum in test_cases:\n        \n        product_val = 1.0\n        is_divergent = False\n\n        for val, count in spectrum:\n            if val = 2.0:\n                is_divergent = True\n                break\n            # Since Sigma is positive definite, val  0 is implied.\n\n            # We calculate the term lambda * (2 - lambda) for each eigenvalue\n            term = val * (2.0 - val)\n            \n            # The total product is the product of these terms, raised to the\n            # power of their multiplicity.\n            product_val *= (term ** count)\n\n        if is_divergent:\n            result = 0.0\n        else:\n            result = np.sqrt(product_val)\n\n        results.append(f\"{result:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}