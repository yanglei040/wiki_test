{
    "hands_on_practices": [
        {
            "introduction": "在应用重要性抽样时，首要任务是计算核心量：重要性权重。本练习将通过一个具体场景，即使用一个较宽的正态分布作为提议分布来估计标准正态分布下的期望，引导你动手推导权重函数 $w(x)$。通过计算加权被积函数 $h(X)w(X)$ 的一阶矩和二阶矩，你将深入理解这些量如何构成了重要性抽样估计量的基础 ()。",
            "id": "3338601",
            "problem": "在蒙特卡洛（MC）方法的大背景下，考虑自归一化重要性采样（SNIS）。设目标分布为标准正态密度 $p=\\mathcal{N}(0,1)$，提议分布为均值为零、方差为 $4$ 的正态分布 $q=\\mathcal{N}(0,4)$。定义被积函数 $h(x)=x^{2}$。从重要性采样的基本定义以及通过拉东-尼科迪姆导数建立的在 $p$ 和 $q$ 下的期望之间的关系出发，确定以下内容：\n\n1. 为了估计被积函数 $h(x)$ 在 $p$ 分布下的期望，从 $q$ 分布中采样时所关联的未归一化重要性权重 $w(x)$。\n2. 期望 $\\mathbb{E}_{q}\\!\\left[h(X)\\,w(X)\\right]$。\n3. 以闭合形式表示的方差 $\\mathrm{Var}_{q}\\!\\left(h(X)\\,w(X)\\right)$。\n\n在推导过程中，仅使用关于高斯概率密度函数和高斯积分恒等式的公认事实。提供精确表达式，不要近似或四舍五入。将最终答案表示为一个单行矩阵，按给定顺序包含所要求的三个表达式，并且最终答案中不包含任何解释性文字。",
            "solution": "该问题是有效的，因为它科学地基于蒙特卡洛方法的原理，提法恰当且提供了所有必要信息，并使用客观、正式的语言陈述。我们可以开始求解。\n\n该问题要求计算与重要性采样设置相关的三个量。目标分布是标准正态分布 $p=\\mathcal{N}(0,1)$，其概率密度函数 (PDF) 为 $p(x)$。提议分布是均值为零、方差为 $4$ 的正态分布 $q=\\mathcal{N}(0,4)$，其 PDF 为 $q(x)$。被积函数为 $h(x)=x^2$。\n\n目标分布 $p(x)$ 的 PDF 为：\n$$p(x) = \\frac{1}{\\sqrt{2\\pi \\cdot 1}} \\exp\\left(-\\frac{x^2}{2 \\cdot 1}\\right) = \\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{x^2}{2}\\right)$$\n提议分布 $q(x)$ 的 PDF 为：\n$$q(x) = \\frac{1}{\\sqrt{2\\pi \\cdot 4}} \\exp\\left(-\\frac{x^2}{2 \\cdot 4}\\right) = \\frac{1}{2\\sqrt{2\\pi}} \\exp\\left(-\\frac{x^2}{8}\\right)$$\n\n**1. 未归一化重要性权重 $w(x)$**\n\n未归一化重要性权重 $w(x)$ 定义为目标测度关于提议测度的拉东-尼科迪姆导数，对于绝对连续分布，它等于其 PDF 的比值：\n$$w(x) = \\frac{p(x)}{q(x)}$$\n代入 PDF 的表达式：\n$$w(x) = \\frac{\\frac{1}{\\sqrt{2\\pi}} \\exp\\left(-\\frac{x^2}{2}\\right)}{\\frac{1}{2\\sqrt{2\\pi}} \\exp\\left(-\\frac{x^2}{8}\\right)}$$\n常数项简化为：\n$$w(x) = 2 \\frac{\\exp\\left(-\\frac{x^2}{2}\\right)}{\\exp\\left(-\\frac{x^2}{8}\\right)} = 2 \\exp\\left(-\\frac{x^2}{2} - \\left(-\\frac{x^2}{8}\\right)\\right)$$\n$$w(x) = 2 \\exp\\left(-\\frac{4x^2}{8} + \\frac{x^2}{8}\\right) = 2 \\exp\\left(-\\frac{3x^2}{8}\\right)$$\n这是第一个所求的表达式。\n\n**2. 期望 $\\mathbb{E}_{q}\\!\\left[h(X)\\,w(X)\\right]$**\n\n乘积 $h(X)w(X)$ 的期望是相对于提议分布 $q$ 计算的。根据期望的定义：\n$$\\mathbb{E}_{q}\\!\\left[h(X)\\,w(X)\\right] = \\int_{-\\infty}^{\\infty} h(x) w(x) q(x) \\, dx$$\n通过代入 $w(x) = p(x)/q(x)$，我们看到了重要性采样的一个基本恒等式：\n$$\\mathbb{E}_{q}\\!\\left[h(X)\\,w(X)\\right] = \\int_{-\\infty}^{\\infty} h(x) \\frac{p(x)}{q(x)} q(x) \\, dx = \\int_{-\\infty}^{\\infty} h(x) p(x) \\, dx$$\n根据定义，这个积分是 $h(X)$ 相对于目标分布 $p$ 的期望：\n$$\\mathbb{E}_{q}\\!\\left[h(X)\\,w(X)\\right] = \\mathbb{E}_{p}\\!\\left[h(X)\\right]$$\n给定 $h(x) = x^2$ 和 $p = \\mathcal{N}(0,1)$，我们在计算一个标准正态随机变量的二阶矩。对于一个随机变量 $X \\sim \\mathcal{N}(\\mu, \\sigma^2)$，其二阶矩为 $\\mathbb{E}[X^2] = \\mathrm{Var}(X) + (\\mathbb{E}[X])^2 = \\sigma^2 + \\mu^2$。对于标准正态分布，$\\mu = 0$ 且 $\\sigma^2 = 1$。\n因此：\n$$\\mathbb{E}_{p}\\!\\left[X^2\\right] = 1 + 0^2 = 1$$\n所以，第二个所求的值是 $\\mathbb{E}_{q}\\!\\left[h(X)\\,w(X)\\right] = 1$。\n\n**3. 方差 $\\mathrm{Var}_{q}\\!\\left(h(X)\\,w(X)\\right)$**\n\n一个随机变量 $Y$ 的方差由 $\\mathrm{Var}(Y) = \\mathbb{E}[Y^2] - (\\mathbb{E}[Y])^2$ 给出。令 $Y = h(X)w(X)$。我们需要计算：\n$$\\mathrm{Var}_{q}\\!\\left(h(X)\\,w(X)\\right) = \\mathbb{E}_{q}\\!\\left[\\left(h(X)\\,w(X)\\right)^2\\right] - \\left(\\mathbb{E}_{q}\\!\\left[h(X)\\,w(X)\\right]\\right)^2$$\n我们已经求得 $\\mathbb{E}_{q}\\!\\left[h(X)\\,w(X)\\right] = 1$，所以第二项是 $1^2=1$。现在我们计算第一项 $\\mathbb{E}_{q}\\!\\left[\\left(h(X)\\,w(X)\\right)^2\\right]$：\n$$\\mathbb{E}_{q}\\!\\left[\\left(h(X)\\,w(X)\\right)^2\\right] = \\int_{-\\infty}^{\\infty} (h(x)w(x))^2 q(x) \\, dx$$\n让我们代入 $h(x)$、$w(x)$ 和 $q(x)$ 的表达式：\n$$(h(x)w(x))^2 = \\left(x^2 \\cdot 2 \\exp\\left(-\\frac{3x^2}{8}\\right)\\right)^2 = 4x^4 \\exp\\left(-2 \\cdot \\frac{3x^2}{8}\\right) = 4x^4 \\exp\\left(-\\frac{3x^2}{4}\\right)$$\n现在，我们将其代入包含 $q(x)$ 的积分中：\n$$\\mathbb{E}_{q}\\!\\left[\\left(h(X)\\,w(X)\\right)^2\\right] = \\int_{-\\infty}^{\\infty} \\left(4x^4 \\exp\\left(-\\frac{3x^2}{4}\\right)\\right) \\left(\\frac{1}{2\\sqrt{2\\pi}} \\exp\\left(-\\frac{x^2}{8}\\right)\\right) \\, dx$$\n合并各项：\n$$= \\frac{4}{2\\sqrt{2\\pi}} \\int_{-\\infty}^{\\infty} x^4 \\exp\\left(-\\frac{3x^2}{4} - \\frac{x^2}{8}\\right) \\, dx$$\n$$= \\frac{2}{\\sqrt{2\\pi}} \\int_{-\\infty}^{\\infty} x^4 \\exp\\left(-\\frac{6x^2+x^2}{8}\\right) \\, dx = \\frac{2}{\\sqrt{2\\pi}} \\int_{-\\infty}^{\\infty} x^4 \\exp\\left(-\\frac{7x^2}{8}\\right) \\, dx$$\n这个积分可以使用中心化高斯分布的矩的通用公式来求解。让我们考虑一个与 $\\exp(-ax^2)$ 成正比的未归一化高斯密度，其中 $a = 7/8$。一个 $\\mathcal{N}(0, \\sigma^2)$ 分布的四阶矩是 $3\\sigma^4$。这个相关高斯分布的方差可以通过设置 $a = 1/(2\\sigma^2)$ 来找到，这给出 $\\sigma^2 = 1/(2a) = 1/(2 \\cdot 7/8) = 4/7$。\n积分 $\\int_{-\\infty}^{\\infty} x^4 \\exp(-ax^2)dx$ 可以使用恒等式 $\\int_{-\\infty}^{\\infty} x^{2n} \\exp(-ax^2)dx = \\frac{(2n-1)!!}{2^n a^n}\\sqrt{\\frac{\\pi}{a}}$ 来求解。\n这里，$2n=4 \\implies n=2$ 且 $a=7/8$。\n$$\\int_{-\\infty}^{\\infty} x^4 \\exp\\left(-\\frac{7x^2}{8}\\right) \\, dx = \\frac{(2(2)-1)!!}{2^2 (7/8)^2}\\sqrt{\\frac{\\pi}{7/8}} = \\frac{3!!}{4(49/64)}\\sqrt{\\frac{8\\pi}{7}} = \\frac{3}{49/16}\\sqrt{\\frac{8\\pi}{7}} = \\frac{48}{49}\\sqrt{\\frac{8\\pi}{7}}$$\n乘以之前的常数 $\\frac{2}{\\sqrt{2\\pi}}$：\n$$\\mathbb{E}_{q}\\!\\left[\\left(h(X)\\,w(X)\\right)^2\\right] = \\frac{2}{\\sqrt{2\\pi}} \\cdot \\frac{48}{49}\\sqrt{\\frac{8\\pi}{7}} = \\frac{96}{49} \\sqrt{\\frac{8\\pi}{2\\pi \\cdot 7}} = \\frac{96}{49} \\sqrt{\\frac{4}{7}} = \\frac{96}{49} \\cdot \\frac{2}{\\sqrt{7}} = \\frac{192}{49\\sqrt{7}}$$\n最后，我们计算方差：\n$$\\mathrm{Var}_{q}\\!\\left(h(X)\\,w(X)\\right) = \\frac{192}{49\\sqrt{7}} - 1^2 = \\frac{192}{49\\sqrt{7}} - 1$$\n这是第三个所求的表达式。\n\n三个所求的表达式是：\n1. $w(x) = 2 \\exp\\left(-\\frac{3x^2}{8}\\right)$\n2. $\\mathbb{E}_{q}\\!\\left[h(X)\\,w(X)\\right] = 1$\n3. $\\mathrm{Var}_{q}\\!\\left(h(X)\\,w(X)\\right) = \\frac{192}{49\\sqrt{7}} - 1$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2 \\exp\\left(-\\frac{3x^2}{8}\\right)  1  \\frac{192}{49\\sqrt{7}} - 1\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "重要性抽样方法的正确性并非无条件成立，它依赖于一个关键的数学前提：目标分布 $p$ 相对于提议分布 $q$ 的绝对连续性 ($p \\ll q$)。本练习通过一系列假设情景，探讨了当此条件不满足时（例如，目标分布包含离散点质量）所产生的问题 ()。它还进一步展示了如何通过修正提议分布（如截断）等实用技巧，来确保方法的有效性。",
            "id": "3338579",
            "problem": "考虑一个在区间 $[0,1]$ 上的目标分布 $p$ 和一个在 $(0,\\infty)$ 上的提议分布 $q$。自归一化重要性采样 (SNIS) 在 Radon–Nikodym 导数 $\\frac{\\mathrm{d}p}{\\mathrm{d}q}$ 存在之处构建归一化重要性权重，并要求绝对连续性 $p \\ll q$（意味着对于每个可测集 $A$，若 $q(A) = 0$ 则 $p(A) = 0$）。设 $h:[0,1]\\to\\mathbb{R}$ 是一个有界可测函数，并假设我们希望使用从 $q$ 中抽取的样本，通过 SNIS 来估计 $\\mathbb{E}_p[h(X)]$。\n\n定义 $p$ 为在 $[0,1]$ 上参数为 $\\alpha=2$ 和 $\\beta=3$ 的贝塔分布，即\n$$\np(x) = \\frac{\\Gamma(2+3)}{\\Gamma(2)\\Gamma(3)}\\,x^{2-1}(1-x)^{3-1}\\,\\mathbf{1}_{[0,1]}(x),\n$$\n并定义 $q$ 为在 $(0,\\infty)$ 上形状参数为 $k=2$ 和尺度参数为 $\\theta=1$ 的伽马分布，即\n$$\nq(x) = \\frac{1}{\\Gamma(2)\\,1^2}\\,x^{2-1}e^{-x/1}\\,\\mathbf{1}_{(0,\\infty)}(x).\n$$\n此外，考虑变体目标\n$$\np_{\\varepsilon} = (1-\\varepsilon)\\,p + \\varepsilon\\,\\delta_{0},\n$$\n其中 $\\varepsilon \\in (0,1)$ 且 $\\delta_{0}$ 表示在 $0$ 处的单位点质量。\n\n假设所有随机变量都在一个共同的概率空间上定义，并且所有密度都是关于勒贝格测度的。关于 SNIS 的有效性以及确保 $p \\ll q$ 的约束条件，以下哪些陈述是正确的？选择所有适用的选项。\n\nA. 当 $p$ 为 $[0,1]$ 上的 $\\mathrm{Beta}(2,3)$ 分布，$q$ 为 $(0,\\infty)$ 上的 $\\mathrm{Gamma}(2,1)$ 分布时，SNIS 是有效的，因为 $p \\ll q$ 且比率 $p(x)/q(x)$ 是 q-几乎必然良定义的。\n\nB. 如果 $p$ 被替换为在 $0$ 处有正原子的 $p_{\\varepsilon}$，那么 $p \\ll q$ 仍然成立，因为 $q$ 的支撑集是 $(0,\\infty)$ 并且在任意接近 $0$ 的地方都具有正密度。\n\nC. 当 $p$ 在 $0$ 处有一个原子时，为了确保 $p \\ll q$，必须修改 $q$ 以包含在 $0$ 处的一个点质量，而这与 $q$ 的支撑集为 $(0,\\infty)$ 的约束是兼容的。\n\nD. 将提议分布截断为 $q_T(x) \\propto q(x)\\,\\mathbf{1}_{x\\in[0,1]}$ 并从 $q_T$ 采样，可以保持 SNIS 的有效性，并确保对于支撑在 $[0,1]$ 上的任何绝对连续的 $p$ 都有 $p \\ll q_T$。\n\nE. 对从 $q$ 中抽取的、落在 $[0,1]$ 之外的样本实施拒绝（只保留 $X \\in [0,1]$ 的样本），同时使用权重 $w(X)=p(X)/q(X)$ 并对接受的样本进行归一化，会产生一个相合的 SNIS 估计量，该估计量与直接从截断提议分布 $q_T$ 采样的结果，在未归一化权重上相差一个常数倍的情况下是等价的。",
            "solution": "用户需要对问题陈述进行审慎验证，然后提供详细的解答和对所有选项的评估。\n\n### 问题验证\n\n**步骤 1：提取已知条件**\n\n*   目标分布 $p$ 在 $[0,1]$ 上。\n*   提议分布 $q$ 在 $(0,\\infty)$ 上。\n*   方法：自归一化重要性采样 (SNIS)。\n*   SNIS 要求：绝对连续性 $p \\ll q$，即对于任意可测集 $A$，若 $q(A) = 0$ 则 $p(A) = 0$。\n*   SNIS 权重基于 Radon–Nikodym 导数 $\\frac{\\mathrm{d}p}{\\mathrm{d}q}$。\n*   目标函数：$h:[0,1]\\to\\mathbb{R}$，一个有界可测函数。\n*   目标：估计期望 $\\mathbb{E}_p[h(X)]$。\n*   $p$ 的定义：参数为 $\\alpha=2, \\beta=3$ 的贝塔分布。其概率密度函数 (PDF) 为 $p(x) = \\frac{\\Gamma(2+3)}{\\Gamma(2)\\Gamma(3)}\\,x^{2-1}(1-x)^{3-1}\\,\\mathbf{1}_{[0,1]}(x) = 12x(1-x)^2\\,\\mathbf{1}_{[0,1]}(x)$。\n*   $q$ 的定义：形状参数 $k=2$，尺度参数 $\\theta=1$ 的伽马分布。其 PDF 为 $q(x) = \\frac{1}{\\Gamma(2)\\,1^2}\\,x^{2-1}e^{-x/1}\\,\\mathbf{1}_{(0,\\infty)}(x) = xe^{-x}\\,\\mathbf{1}_{(0,\\infty)}(x)$。\n*   变体目标：$p_{\\varepsilon} = (1-\\varepsilon)\\,p + \\varepsilon\\,\\delta_{0}$，其中 $\\varepsilon \\in (0,1)$，$\\delta_{0}$ 是在 $0$ 处的狄拉克测度（单位点质量）。\n*   假设：所有密度都是关于勒贝格测度的。\n\n**步骤 2：使用提取的已知条件进行验证**\n\n1.  **科学依据：** 该问题设置在概率论和蒙特卡罗方法的标准数学框架内。贝塔分布和伽马分布、绝对连续性、Radon-Nikodym 导数和重要性采样等概念都是统计学领域中完善且基础的概念。该问题在科学上是合理的。\n2.  **适定性：** 问题提供了具体、明确的概率分布，并询问在这些及相关条件下应用标准统计程序的有效性。问题是精确的，可以用测度论和概率论进行严格回答。问题是适定的。\n3.  **客观性：** 问题以形式化的数学语言陈述，不含任何主观性、模糊性或个人观点。\n4.  **完整性和一致性：** 提供了分布 $p$、$q$ 和 $p_{\\varepsilon}$ 的所有必要定义。SNIS 的背景和要求都已明确说明。设置中没有内部矛盾。\n5.  **现实性和可行性：** 问题是一个统计学中的理论练习。所选的分布和参数是标准的，并且在数学上是可处理的。\n\n**步骤 3：结论和行动**\n\n问题陈述是有效的。这是一个关于一种重要统计方法理论基础的、适定的、科学上合理的问题。开始解答。\n\n### 解答推导\n\n这个问题的核心围绕着重要性采样有效性所要求的绝对连续性概念 ($p \\ll q$)。这个条件确保了目标分布 $p$ 具有正概率的任何区域，也同样是提议分布 $q$ 具有正概率的区域。形式上，对于任何可测集 $A$，如果 $q(A)=0$，那么必须有 $p(A)=0$。对于具有关于共同参考测度（如勒贝格测度 $\\lambda$）的密度的分布，这通常表述为 $p$ 的支撑集需要是 $q$ 支撑集的子集，即 $\\text{supp}(p) \\subseteq \\text{supp}(q)$。\n\n目标密度是 $p(x) = 12x(1-x)^2$，对于 $x \\in [0,1]$。$p(x)0$ 的集合是 $(0,1)$。$p$ 的支撑集是这个集合的闭包，所以 $\\text{supp}(p)=[0,1]$。\n提议密度是 $q(x) = xe^{-x}$，对于 $x \\in (0,\\infty)$。$q(x)0$ 的集合是 $(0,\\infty)$。$q$ 的支撑集是闭包，所以 $\\text{supp}(q)=[0,\\infty)$。\n\n让我们评估每个陈述。\n\n**A. 当 $p$ 为 $[0,1]$ 上的 $\\mathrm{Beta}(2,3)$ 分布，$q$ 为 $(0,\\infty)$ 上的 $\\mathrm{Gamma}(2,1)$ 分布时，SNIS 是有效的，因为 $p \\ll q$ 且比率 $p(x)/q(x)$ 是 q-几乎必然良定义的。**\n\n首先，我们验证绝对连续性条件 $p \\ll q$。如上所述，$\\text{supp}(p) = [0,1]$ 且 $\\text{supp}(q) = [0,\\infty)$。由于 $[0,1] \\subseteq [0,\\infty)$，支撑集条件得到满足。\n更形式化地，设 $A$ 为一个可测集，使得 $q(A)=0$。\n$q(A) = \\int_A q(x)\\,d\\lambda(x) = \\int_{A \\cap (0,\\infty)} xe^{-x}\\,d\\lambda(x) = 0$。\n由于对于所有 $x \\in (0,\\infty)$ 都有 $xe^{-x}  0$，集合 $A \\cap (0,\\infty)$ 的勒贝格测度必须为零，即 $\\lambda(A \\cap (0,\\infty)) = 0$。\n现在我们检查 $p(A)$：\n$p(A) = \\int_A p(x)\\,d\\lambda(x) = \\int_{A \\cap [0,1]} 12x(1-x)^2\\,d\\lambda(x)$。\n由于 $A \\cap [0,1] \\subseteq A \\cap [0,\\infty)$，且 $\\lambda(A \\cap (0,\\infty))=0$，因此 $\\lambda(A \\cap [0,1])=0$（因为 $\\lambda(\\{0\\})=0$）。\n因为分布 $p$ 关于勒贝格测度 $\\lambda$ 是绝对连续的，如果一个集合的勒贝格测度为零，它的 $p$-测度也为零。因此，$p(A)=0$。\n条件 $p \\ll q$ 成立。\n接下来，考虑比率 $w(x) = p(x)/q(x)$。我们对样本 $X \\sim q$ 形成这个比率。由于 $q$ 是一个连续分布，抽到任何特定点的概率为零，因此我们只需要关注具有正概率的区域。密度 $q(x)$ 对所有 $x \\in (0,\\infty)$ 都是正的。对于任何 $x \\in (0,1]$， $p(x)$ 和 $q(x)$ 都是正的，比率为 $w(x) = \\frac{12x(1-x)^2}{xe^{-x}} = 12(1-x)^2e^x$，这是良定义且有限的。对于 $x \\in (1,\\infty)$，$p(x)=0$ 所以 $w(x)=0$。唯一有问题的点是 $x=0$，此时比率是 $0/0$ 的不定形式。然而，由于 $q$ 是一个连续随机变量，所以 $P(X=0)=0$。因此，比率 $p(x)/q(x)$ 是 q-几乎必然良定义的。\n由于必要条件 $p \\ll q$ 得到满足，SNIS 是有效的。\n\n关于 A 的结论：**正确**。\n\n**B. 如果 $p$ 被替换为在 $0$ 处有正原子的 $p_{\\varepsilon}$，那么 $p \\ll q$ 仍然成立，因为 $q$ 的支撑集是 $(0,\\infty)$ 并且在任意接近 $0$ 的地方都具有正密度。**\n\n新的目标测度是 $p_{\\varepsilon} = (1-\\varepsilon)\\,p + \\varepsilon\\,\\delta_{0}$。让我们检验绝对连续性条件 $p_{\\varepsilon} \\ll q$。我们必须检查是否对所有可测集 $A$，$q(A)=0$ 都意味着 $p_{\\varepsilon}(A)=0$。\n考虑集合 $A = \\{0\\}$。\n这个集合在 $q$ 下的测度是 $q(\\{0\\}) = \\int_{\\{0\\}} xe^{-x}\\,d\\lambda(x) = 0$，因为 $q$ 关于勒贝格测度是绝对连续的。\n这个集合在 $p_{\\varepsilon}$ 下的测度是 $p_{\\varepsilon}(\\{0\\}) = (1-\\varepsilon)p(\\{0\\}) + \\varepsilon\\delta_{0}(\\{0\\})$。\n由于 $p$ 是连续的贝塔分布，$p(\\{0\\})=0$。狄拉克测度 $\\delta_0$ 给出 $\\delta_0(\\{0\\}) = 1$。\n所以，$p_{\\varepsilon}(\\{0\\}) = (1-\\varepsilon)(0) + \\varepsilon(1) = \\varepsilon$。\n由于 $\\varepsilon \\in (0,1)$，我们有 $p_{\\varepsilon}(\\{0\\})  0$。\n我们找到了一个集合 $A=\\{0\\}$，对于它有 $q(A)=0$ 但 $p_{\\varepsilon}(A)  0$。这直接违反了绝对连续性的定义。因此，$p_{\\varepsilon} \\not\\ll q$。\n陈述中提供的理由（“因为 $q$ ... 在任意接近 $0$ 的地方都具有正密度”）与绝对连续性的严格定义无关，后者涉及零测度集，而不是密度函数在某点附近的行为。\n\n关于 B 的结论：**不正确**。\n\n**C. 当 $p$ 在 $0$ 处有一个原子时，为了确保 $p \\ll q$，必须修改 $q$ 以包含在 $0$ 处的一个点质量，而这与 $q$ 的支撑集为 $(0,\\infty)$ 的约束是兼容的。**\n\n陈述的第一部分是正确的。如果目标分布在某点 $x_0$ 有一个点质量（原子），即 $p(\\{x_0\\})  0$，那么为了使绝对连续性 $p \\ll q$ 成立，提议分布也必须有 $q(\\{x_0\\})  0$。所以，如果 $p$ 在 $0$ 处有一个原子，提议分布 $q$ 必须被修改以使其在 $0$ 处也有一个原子。\n陈述的第二部分声称这种修改与“$q$ 的支撑集为 $(0,\\infty)$”的约束是“兼容的”。\n一个分布的支撑集是使其补集概率为零的最小闭集 $S$。如果一个分布 $q'$ 在 $0$ 处有一个点质量，那么 $q'(\\{0\\})  0$。任何包含 $0$ 的开集 $U$ 都必须有 $q'(U)  0$。这意味着 $0$ 必须在 $q'$ 的支撑集中。一个 $(0,\\infty)$ 的支撑集是排除了 $0$ 的非负实数集。一个支撑集包含 $0$ 的分布不能同时拥有一个为 $(0,\\infty)$ 的支撑集。这两个条件是互斥的。\n\n关于 C 的结论：**不正确**。\n\n**D. 将提议分布截断为 $q_T(x) \\propto q(x)\\,\\mathbf{1}_{x\\in[0,1]}$ 并从 $q_T$ 采样，可以保持 SNIS 的有效性，并确保对于支撑在 $[0,1]$ 上的任何绝对连续的 $p$ 都有 $p \\ll q_T$。**\n\n我们来定义截断提议密度 $q_T(x)$。\n$q_T(x) = C^{-1} q(x) \\mathbf{1}_{[0,1]}(x)$，其中 $C = \\int_0^1 q(x)\\,dx = \\int_0^1 xe^{-x}\\,dx$。\n使用分部积分法，$C = [-xe^{-x} - e^{-x}]_0^1 = (-e^{-1} - e^{-1}) - (0 - e^0) = 1 - 2e^{-1}  0$。\n密度为 $q_T(x) = \\frac{xe^{-x}}{1-2e^{-1}}$，对于 $x \\in [0,1]$，其他地方为 $0$。$q_T$ 的支撑集是 $\\text{supp}(q_T) = [0,1]$。\n问题考虑一个支撑在 $[0,1]$ 上的通用的绝对连续目标 $p$。这意味着 $\\text{supp}(p) \\subseteq [0,1]$。对于我们特定的贝塔分布，$\\text{supp}(p)=[0,1]$。\n我们检查 $p \\ll q_T$。我们有 $\\text{supp}(p) \\subseteq [0,1] = \\text{supp}(q_T)$，因此支撑集条件得到满足。更形式化地，设 $A$ 是一个 $q_T(A)=0$ 的集合。$q_T(A)=\\int_A q_T(x)d\\lambda(x) = 0$。由于对于 $x \\in (0,1]$ 有 $q_T(x)  0$，这意味着 $\\lambda(A \\cap (0,1]) = 0$，因此 $\\lambda(A \\cap [0,1]) = 0$。由于 $p$ 关于勒贝格测度是绝对连续的并且支撑在 $[0,1]$ 上，所以 $p(A) = \\int_{A \\cap [0,1]} p(x)d\\lambda(x) = 0$。因此，$p \\ll q_T$ 成立。\n因为这个基本要求得到满足，使用这个新的提议分布 $q_T$ 时 SNIS 是有效的。该陈述是正确的。\n\n关于 D 的结论：**正确**。\n\n**E. 对从 $q$ 中抽取的、落在 $[0,1]$ 之外的样本实施拒绝（只保留 $X \\in [0,1]$ 的样本），同时使用权重 $w(X)=p(X)/q(X)$ 并对接受的样本进行归一化，会产生一个相合的 SNIS 估计量，该估计量与直接从截断提议分布 $q_T$ 采样的结果，在未归一化权重上相差一个常数倍的情况下是等价的。**\n\n这个陈述描述了一个实际的算法。让我们分析它的组成部分。\n1.  **采样过程：** 从 $q$ 中抽取样本，并且只接受落在区间 $[0,1]$ 内的样本，这是一种标准的拒绝采样技术。被接受的样本（我们称之为 $Y$）的分布，是 $X \\sim q$ 在条件 $X \\in [0,1]$ 下的分布。这个条件分布的密度恰好是选项 D 中定义的截断密度 $q_T(x)$：$f_Y(y) = \\frac{q(y)}{P(X \\in [0,1])} = \\frac{q(y)}{C} = q_T(y)$，对于 $y \\in [0,1]$。所以这个过程生成了来自 $q_T$ 的独立同分布样本。\n\n2.  **加权：** 对于这些样本 $Y_i \\sim q_T$，该过程使用权重 $w(Y_i) = p(Y_i)/q(Y_i)$。\n\n3.  **等价性：** 从 $q_T$ 采样的“正确”重要性权重是 $w_T(Y_i) = p(Y_i)/q_T(Y_i)$。让我们比较 $w(Y_i)$ 和 $w_T(Y_i)$：\n    $w_T(Y_i) = \\frac{p(Y_i)}{q_T(Y_i)} = \\frac{p(Y_i)}{q(Y_i)/C} = C \\left(\\frac{p(Y_i)}{q(Y_i)}\\right) = C \\cdot w(Y_i)$。\n    未归一化的权重 $w_T$ 和 $w$ 是成比例的，相差一个常数因子 $C$。陈述中“在未归一化权重上相差一个常数倍的情况下是等价的”是正确的。\n\n4.  **SNIS 估计量：** SNIS 估计量是通过对权重进行归一化形成的：\n    $\\hat{I}_{SNIS} = \\frac{\\sum_i w(Y_i)h(Y_i)}{\\sum_i w(Y_i)}$。\n    如果我们使用了“正确”的权重 $w_T$，估计量将是：\n    $\\hat{I}'_{SNIS} = \\frac{\\sum_i w_T(Y_i)h(Y_i)}{\\sum_i w_T(Y_i)} = \\frac{\\sum_i C \\cdot w(Y_i)h(Y_i)}{\\sum_i C \\cdot w(Y_i)} = \\frac{C \\sum_i w(Y_i)h(Y_i)}{C \\sum_i w(Y_i)} = \\hat{I}_{SNIS}$。\n    这两个估计量是相同的，因为比例常数 $C$ 在分子和分母中被抵消了。由于从 $q_T$ 采样是一个有效的过程（如在 D 中所证），它会产生一个相合的估计量，因此这个等价的过程也会产生一个相合的估计量。\n\n关于 E 的结论：**正确**。",
            "answer": "$$\\boxed{ADE}$$"
        },
        {
            "introduction": "在处理高维问题时，即使是理论上有效的重要性抽样器，其效率也可能急剧下降，这一现象被称为“维度灾难”。本练习引入有效样本量 (ESS) 这一关键诊断工具，并指导你推导其在高斯设定下的精确渐近表达式 ()。通过分析 ESS 与协方差矩阵谱结构的关系，你将定量地理解维度如何影响抽样效率，并识别导致估计器失效的“相变”条件。",
            "id": "3338598",
            "problem": "考虑使用自归一化重要性采样 (Self-Normalized Importance Sampling, SNIS) 来估计一个 $d$ 维高斯目标分布下的期望。该目标分布的密度为 $\\pi(x) = \\mathcal{N}(0,\\Sigma)$，使用的提议分布为高斯分布 $q(x) = \\mathcal{N}(0,I)$，其中 $\\Sigma \\in \\mathbb{R}^{d \\times d}$ 是对称正定矩阵，$I$ 是 $d \\times d$ 的单位矩阵，且 $x \\in \\mathbb{R}^{d}$。设未归一化的重要性权重为 $w(x) = \\pi(x)/q(x)$，对于从 $q$ 中抽取的独立同分布样本 $x_{1},\\dots,x_{n}$，归一化的权重为 $\\tilde{w}_{i} = w(x_{i}) / \\sum_{j=1}^{n} w(x_{j})$。SNIS 权重的有效样本量 (Effective Sample Size, ESS) 定义为 $\\mathrm{ESS} = \\left(\\sum_{i=1}^{n} w(x_{i})\\right)^{2} \\big/ \\sum_{i=1}^{n} w(x_{i})^{2}$。您的任务是分析归一化的 ESS 分数 $\\mathrm{ESS}/n$ 作为 $\\Sigma$ 的谱和维度 $d$ 的函数时的高维行为。\n\n您必须仅从第一性原理和经过充分检验的事实出发。具体来说，您可以依赖大数定律 (Law of Large Numbers, LLN) 和二次型的高斯积分恒等式，但不得假设任何关于 $\\mathrm{ESS}/n$ 的预先推导的公式。\n\n任务：\n- 从 SNIS 的定义和 LLN 出发，推导当 $n \\to \\infty$ 时 $\\mathrm{ESS}/n$ 的几乎必然极限的闭式表达式，用 $\\mathbb{E}_{q}[w(X)]$ 和 $\\mathbb{E}_{q}[w(X)^{2}]$ 表示，前提是这些期望是有限的。\n- 将问题特化到高斯情况 $\\pi = \\mathcal{N}(0,\\Sigma)$ 和 $q=\\mathcal{N}(0,I)$，并仅使用二次型的基本高斯积分恒等式来计算 $\\mathbb{E}_{q}[w(X)]$ 和 $\\mathbb{E}_{q}[w(X)^{2}]$。将 $\\mathrm{ESS}/n$ 的极限表示为 $\\Sigma$ 的特征值 $\\{\\lambda_{i}\\}_{i=1}^{d}$ 的函数。\n- 确定使 $\\mathbb{E}_{q}[w(X)^{2}]$ 有限的谱条件，并描述随着 $d$ 增长，ESS 分数相应的相变。具体来说，确定谱上的乘积如何使极限趋于零或保持有界，并证明任何边界行为。\n- 实现一个程序，对于给定的有限谱集和维度，计算上述推导出的 $\\mathrm{ESS}/n$ 的理论极限。您不能进行模拟；必须使用特征值以闭式形式计算该极限。\n\n角度单位不相关。没有物理单位。\n\n测试套件和输出规范：\n- 使用以下五个测试用例，每个用例由一个维度 $d$ 和一个以块形式 $(\\lambda,\\text{计数})$ 给出的 $\\Sigma$ 特征值的多重集指定：\n  $1.$ $d = 10$，谱 $\\{(1,10)\\}$。\n  $2.$ $d = 10$，谱 $\\{(1/2,10)\\}$。\n  $3.$ $d = 20$，谱 $\\{(4/5,10),(6/5,10)\\}$。\n  $4.$ $d = 10$，谱 $\\{(2,1),(1,9)\\}$。\n  $5.$ $d = 5$，谱 $\\{(5/2,1),(1,4)\\}$。\n- 对每个测试用例，计算您分析得出的当 $n \\to \\infty$ 时 $\\mathrm{ESS}/n$ 的理论极限。如果由于 $\\mathbb{E}_{q}[w(X)^{2}]$ 的发散或存在零因子而导致极限为零，则返回 $0$。\n- 您的程序应产生单行输出，其中包含五个结果，形式为一个逗号分隔的浮点数列表，四舍五入到六位小数，并用方括号括起来（例如，“[$r_{1},r_{2},r_{3},r_{4},r_{5}$]”）。",
            "solution": "该问题要求在高维高斯设定下，对自归一化重要性采样 (SNIS) 的有效样本量 (ESS) 的渐近行为进行分析。我们必须首先推导当样本数量 $n$ 趋于无穷大时，归一化 ESS 分数 $\\mathrm{ESS}/n$ 极限的闭式表达式。然后，必须针对具体的目标分布和提议分布对该表达式进行求值，并最终用于计算给定测试用例的结果。\n\n让我们从建立理论基础开始。\n\n**第1步：ESS 分数的渐近极限**\n\n有效样本量定义为：\n$$ \\mathrm{ESS} = \\frac{\\left(\\sum_{i=1}^{n} w(x_{i})\\right)^{2}}{\\sum_{i=1}^{n} w(x_{i})^{2}} $$\n其中 $w(x_i)$ 是从提议分布 $q(x)$ 中抽取的独立同分布样本 $x_1, \\dots, x_n$ 的未归一化重要性权重。我们关心的是当 $n \\to \\infty$ 时，归一化 ESS 分数 $\\mathrm{ESS}/n$ 的几乎必然极限。我们可以将表达式重写为：\n$$ \\frac{\\mathrm{ESS}}{n} = \\frac{1}{n} \\frac{\\left(\\sum_{i=1}^{n} w(x_{i})\\right)^{2}}{\\sum_{i=1}^{n} w(x_{i})^{2}} = \\frac{\\left(\\frac{1}{n}\\sum_{i=1}^{n} w(x_{i})\\right)^{2}}{\\frac{1}{n}\\sum_{i=1}^{n} w(x_{i})^{2}} $$\n样本 $X_1, \\dots, X_n$ 是从 $q$ 中独立同分布抽取的，因此权重 $W_i = w(X_i)$ 也构成一个独立同分布的随机变量序列。根据强大数定律 (LLN)，只要期望有限，$W$ 和 $W^2$ 的样本均值几乎必然收敛于它们各自的期望：\n$$ \\frac{1}{n}\\sum_{i=1}^{n} w(X_{i}) \\xrightarrow{\\text{a.s.}} \\mathbb{E}_{q}[w(X)] \\quad \\text{当 } n \\to \\infty $$\n$$ \\frac{1}{n}\\sum_{i=1}^{n} w(X_{i})^{2} \\xrightarrow{\\text{a.s.}} \\mathbb{E}_{q}[w(X)^{2}] \\quad \\text{当 } n \\to \\infty $$\n根据连续映射定理，这些量的比率收敛于它们极限的比率，前提是分母的极限非零。因此，ESS 分数的几乎必然极限是：\n$$ \\lim_{n \\to \\infty} \\frac{\\mathrm{ESS}}{n} \\xrightarrow{\\text{a.s.}} \\frac{\\left(\\mathbb{E}_{q}[w(X)]\\right)^{2}}{\\mathbb{E}_{q}[w(X)^{2}]} $$\n如果 $\\mathbb{E}_{q}[w(X)^2]$ 是有限的，则此结果成立。如果 $\\mathbb{E}_{q}[w(X)^2]$ 是无限的，则权重的方差是无限的，这导致估计器效率的崩溃，$\\mathrm{ESS}/n$ 的极限为 $0$。\n\n**第2步：高斯情况下的期望求值**\n\n目标分布和提议分布由下式给出：\n-   目标分布 $\\pi(x) = \\mathcal{N}(x | 0, \\Sigma) = \\frac{1}{(2\\pi)^{d/2} |\\Sigma|^{1/2}} \\exp\\left(-\\frac{1}{2} x^T \\Sigma^{-1} x\\right)$\n-   提议分布 $q(x) = \\mathcal{N}(x | 0, I) = \\frac{1}{(2\\pi)^{d/2}} \\exp\\left(-\\frac{1}{2} x^T x\\right)$\n其中 $|\\Sigma| = \\det(\\Sigma)$。未归一化的权重函数 $w(x) = \\pi(x)/q(x)$ 为：\n$$ w(x) = \\frac{1}{|\\Sigma|^{1/2}} \\exp\\left(-\\frac{1}{2} x^T \\Sigma^{-1} x + \\frac{1}{2} x^T x\\right) = \\frac{1}{|\\Sigma|^{1/2}} \\exp\\left(-\\frac{1}{2} x^T (\\Sigma^{-1} - I) x\\right) $$\n首先，我们计算权重的期望 $\\mathbb{E}_{q}[w(X)]$：\n$$ \\mathbb{E}_{q}[w(X)] = \\int_{\\mathbb{R}^d} w(x) q(x) dx = \\int_{\\mathbb{R}^d} \\frac{\\pi(x)}{q(x)} q(x) dx = \\int_{\\mathbb{R}^d} \\pi(x) dx = 1 $$\n这是一个普遍性质，因为 $\\pi(x)$ 是一个概率密度函数。因此，$(\\mathbb{E}_{q}[w(X)])^2 = 1^2 = 1$。渐近 ESS 分数简化为：\n$$ \\lim_{n \\to \\infty} \\frac{\\mathrm{ESS}}{n} = \\frac{1}{\\mathbb{E}_{q}[w(X)^{2}]} $$\n接下来，我们计算权重的二阶矩 $\\mathbb{E}_{q}[w(X)^2]$：\n$$ \\mathbb{E}_{q}[w(X)^{2}] = \\int_{\\mathbb{R}^d} w(x)^2 q(x) dx $$\n$w(x)^2 q(x)$ 项为：\n$$ w(x)^2 q(x) = \\left(\\frac{1}{|\\Sigma|^{1/2}} \\exp\\left[-\\frac{1}{2} x^T (\\Sigma^{-1} - I) x\\right]\\right)^2 \\frac{1}{(2\\pi)^{d/2}} \\exp\\left(-\\frac{1}{2} x^T x\\right) $$\n$$ = \\frac{1}{|\\Sigma|} \\frac{1}{(2\\pi)^{d/2}} \\exp\\left[-x^T (\\Sigma^{-1} - I) x - \\frac{1}{2} x^T x\\right] $$\n$$ = \\frac{1}{|\\Sigma|(2\\pi)^{d/2}} \\exp\\left[-\\frac{1}{2} x^T (2(\\Sigma^{-1} - I) + I) x\\right] $$\n$$ = \\frac{1}{|\\Sigma|(2\\pi)^{d/2}} \\exp\\left[-\\frac{1}{2} x^T (2\\Sigma^{-1} - I) x\\right] $$\n令矩阵 $A = 2\\Sigma^{-1} - I$。则期望为：\n$$ \\mathbb{E}_{q}[w(X)^{2}] = \\frac{1}{|\\Sigma|} \\int_{\\mathbb{R}^d} \\frac{1}{(2\\pi)^{d/2}} \\exp\\left(-\\frac{1}{2} x^T A x\\right) dx $$\n该积分与高斯分布的归一化常数有关。对于一个正定矩阵 $A$，使用恒等式 $\\int \\exp(-\\frac{1}{2}x^T A x) dx = (2\\pi)^{d/2} |A|^{-1/2}$，我们得到：\n$$ \\mathbb{E}_{q}[w(X)^{2}] = \\frac{1}{|\\Sigma|} |A|^{-1/2} = \\frac{1}{|\\Sigma| |2\\Sigma^{-1} - I|^{1/2}} $$\n设 $\\{\\lambda_i\\}_{i=1}^d$ 为 $\\Sigma$ 的特征值。行列式是特征值的乘积，所以 $|\\Sigma| = \\prod_{i=1}^d \\lambda_i$。$2\\Sigma^{-1} - I$ 的特征值为 $2/\\lambda_i - 1$。因此，其行列式为 $|2\\Sigma^{-1} - I| = \\prod_{i=1}^d (2/\\lambda_i - 1)$。\n将此代入期望的表达式中：\n$$ |2\\Sigma^{-1} - I|^{1/2} = \\left(\\prod_{i=1}^d \\frac{2-\\lambda_i}{\\lambda_i}\\right)^{1/2} = \\frac{\\sqrt{\\prod(2-\\lambda_i)}}{\\sqrt{\\prod\\lambda_i}} = \\frac{|\\sqrt{2I - \\Sigma}|}{|\\Sigma|^{1/2}} $$\n所以，\n$$ \\mathbb{E}_{q}[w(X)^{2}] = \\frac{1}{|\\Sigma| \\frac{|\\sqrt{2I - \\Sigma}|}{|\\Sigma|^{1/2}}} = \\frac{1}{|\\Sigma|^{1/2} |\\sqrt{2I - \\Sigma}|} = \\frac{1}{\\sqrt{|\\Sigma||2I - \\Sigma|}} $$\n$$ = \\frac{1}{\\sqrt{\\prod \\lambda_i \\prod(2-\\lambda_i)}} = \\left(\\prod_{i=1}^d \\lambda_i(2-\\lambda_i)\\right)^{-1/2} $$\n最后，渐近 ESS 分数为：\n$$ \\lim_{n \\to \\infty} \\frac{\\mathrm{ESS}}{n} = \\frac{1}{\\mathbb{E}_{q}[w(X)^{2}]} = \\sqrt{\\prod_{i=1}^d \\lambda_i(2-\\lambda_i)} $$\n\n**第3步：有限性条件和相变**\n\n积分 $\\mathbb{E}_{q}[w(X)^2]$ 收敛当且仅当矩阵 $A = 2\\Sigma^{-1} - I$ 是对称正定的。由于 $\\Sigma$ 是对称的，$A$ 也是对称的。要使其为正定，其所有特征值必须为正。$A$ 的特征值是 $2/\\lambda_i - 1$。\n$$ \\frac{2}{\\lambda_i} - 1  0 \\implies \\frac{2}{\\lambda_i}  1 $$\n由于 $\\Sigma$ 是正定的，其特征值 $\\lambda_i$ 均为正。因此，我们可以乘以 $\\lambda_i$ 而不改变不等号方向：\n$$ 2  \\lambda_i $$\n权重二阶矩有限，从而渐近 ESS 分数非零的条件是，$\\Sigma$ 的所有特征值都严格小于 $2$。\n$$ 0  \\lambda_i  2 \\quad \\text{对于所有 } i \\in \\{1, \\dots, d\\} $$\n如果任何特征值 $\\lambda_k \\ge 2$，那么 $\\mathbb{E}_{q}[w(X)^2]$ 发散，渐近 ESS 分数崩溃为 $0$。这标志着一个相变。函数 $f(\\lambda) = \\lambda(2-\\lambda)$ 在 $\\lambda=1$ 时达到最大值 $f(1) = 1$，对于任何其他 $\\lambda \\in (0, 2)$，该函数值小于 $1$。渐近 ESS 分数是 $d$ 个此类项的乘积（在平方根下），因此除非所有 $\\lambda_i$ 都恰好为 $1$，否则随着 $d \\to \\infty$，它将指数级衰减到 $0$。这说明了重要性采样中的维度灾难。\n\n**计算公式**\n\n对于给定的 $\\Sigma$ 的谱 $\\{\\lambda_i\\}_{i=1}^d$：\n1.  如果存在任何特征值 $\\lambda_k \\ge 2$，则 $\\mathrm{ESS}/n$ 的极限为 $0$。\n2.  否则，极限为 $\\sqrt{\\prod_{i=1}^d (\\lambda_i(2-\\lambda_i))}$。\n该公式将用于计算测试用例的结果。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the theoretical limit of ESS/n for the given test cases.\n\n    The problem asks for the analysis of the Self-Normalized Importance Sampling (SNIS)\n    Effective Sample Size (ESS) for a Gaussian target and proposal. The asymptotic limit\n    of the normalized ESS fraction ESS/n as n - infinity is given by:\n\n        lim (ESS/n) = (E_q[w(X)])^2 / E_q[w(X)^2]\n\n    For the specified Gaussian distributions pi = N(0, Sigma) and q = N(0, I),\n    this limit can be derived in closed form. E_q[w(X)] is always 1. The main\n    challenge is E_q[w(X)^2], which is finite only if all eigenvalues of Sigma,\n    lambda_i, satisfy 0  lambda_i  2.\n\n    The final formula for the limit in terms of the eigenvalues {lambda_i} is:\n\n        lim (ESS/n) = sqrt(product_{i=1 to d} [lambda_i * (2 - lambda_i)])\n\n    If any lambda_i = 2, the second moment of the weights diverges, and the\n    asymptotic ESS/n is 0.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (d, spectrum as list of (eigenvalue, count))\n        (10, [(1.0, 10)]),\n        (10, [(1.0/2.0, 10)]),\n        (20, [(4.0/5.0, 10), (6.0/5.0, 10)]),\n        (10, [(2.0, 1), (1.0, 9)]),\n        (5, [(5.0/2.0, 1), (1.0, 4)]),\n    ]\n\n    results = []\n    for d, spectrum in test_cases:\n        \n        product_val = 1.0\n        is_divergent = False\n\n        for val, count in spectrum:\n            if val = 2.0:\n                is_divergent = True\n                break\n            # Since Sigma is positive definite, val > 0 is implied.\n\n            # We calculate the term lambda * (2 - lambda) for each eigenvalue\n            term = val * (2.0 - val)\n            \n            # The total product is the product of these terms, raised to the\n            # power of their multiplicity.\n            product_val *= (term ** count)\n\n        if is_divergent:\n            result = 0.0\n        else:\n            result = np.sqrt(product_val)\n\n        results.append(f\"{result:.6f}\")\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(results)}]\")\n\nsolve()\n```"
        }
    ]
}