{
    "hands_on_practices": [
        {
            "introduction": "随机梯度哈密顿蒙特卡洛（SGHMC）算法的核心在于其离散的更新步骤，它结合了哈密顿动力学、摩擦和随机噪声。为了深入理解这些组件如何相互作用，第一个练习将引导我们分析最简单情况下的单步动力学。通过对二次势能下的单步更新进行精确的解析计算，我们可以清晰地看到状态 $(q, p)$ 是如何演变的，以及高斯噪声如何通过仿射变换影响下一步的分布。",
            "id": "3349051",
            "problem": "考虑一个在单位温度下具有哈密顿动力学的一维系统，其二次势能函数为 $U(q) = \\frac{A}{2} q^{2}$，其中 $A > 0$。令 $(q_{k}, p_{k}) \\in \\mathbb{R}^{2}$ 表示在离散时间指标 $k$ 处的位置和动量。在单位质量和单位温度下的涨落-耗散条件下，随机梯度哈密顿蒙特卡洛 (SGHMC) 方法在连续时间内由欠阻尼朗之万随机微分方程 $\\mathrm{d}q = p \\, \\mathrm{d}t$ 和 $\\mathrm{d}p = - \\nabla U(q) \\, \\mathrm{d}t - c \\, p \\, \\mathrm{d}t + \\sqrt{2 c} \\, \\mathrm{d}W_{t}$ 建模，其中 $c > 0$ 是一个摩擦系数，且 $W_{t}$ 是一个标准维纳过程。考虑将步长为 $h > 0$ 的显式欧拉-丸山离散化应用于该系统：\n$$\np_{k+1} = p_{k} - h \\, \\nabla U(q_{k}) - c \\, h \\, p_{k} + \\sqrt{2 c h} \\, \\xi_{k}, \\quad \\xi_{k} \\sim \\mathcal{N}(0, 1),\n$$\n$$\nq_{k+1} = q_{k} + h \\, p_{k+1},\n$$\n其中 $\\xi_{k}$ 在各个步骤之间是独立的，并且独立于 $(q_{k}, p_{k})$。仅使用上述定义以及高斯随机变量仿射变换的标准性质，针对二次势能 $U(q) = \\frac{A}{2} q^{2}$，推导在给定 $(q_{k}, p_{k})$ 的条件下 $(q_{k+1}, p_{k+1})$ 的精确条件分布。\n\n以条件均值向量和协方差矩阵的六个标量条目的形式，按以下顺序提供您的最终答案：\n- 在给定 $(q_{k}, p_{k})$ 的条件下，$(q_{k+1}, p_{k+1})$ 的均值向量的两个分量 $(\\mu_{q}, \\mu_{p})$，\n- 接着是在给定 $(q_{k}, p_{k})$ 的条件下，$(q_{k+1}, p_{k+1})$ 的条件协方差矩阵的四个条目 $(\\sigma_{qq}, \\sigma_{qp}, \\sigma_{pq}, \\sigma_{pp})$，\n\n使用 $\\text{pmatrix}$ 格式以单行的形式列出。您的答案必须是关于 $A$、$c$、$h$、$q_{k}$ 和 $p_{k}$ 的单个闭式解析表达式。",
            "solution": "用户希望我解决一个关于随机梯度哈密顿蒙特卡洛的问题。\n\n### 第1步：问题验证\n\n我将首先对问题陈述进行强制性验证。\n\n#### 第1.1步：提取给定信息\n\n-   **系统**：一维系统。\n-   **势能**：$U(q) = \\frac{A}{2} q^{2}$，常数 $A > 0$。\n-   **状态变量**：离散时间指标 $k$ 处的位置 $q_{k}$ 和动量 $p_{k}$。\n-   **连续时间动力学**：单位质量 ($m=1$) 和单位温度 ($k_B T = 1$) 下 SGHMC 的欠阻尼朗之万随机微分方程 (SDE)。\n    $\\mathrm{d}q = p \\, \\mathrm{d}t$\n    $\\mathrm{d}p = - \\nabla U(q) \\, \\mathrm{d}t - c \\, p \\, \\mathrm{d}t + \\sqrt{2 c} \\, \\mathrm{d}W_{t}$，其中 $c > 0$ 是摩擦系数， $W_{t}$ 是标准维纳过程。\n-   **离散化**：步长为 $h > 0$ 的显式欧拉-丸山格式。\n    $p_{k+1} = p_{k} - h \\, \\nabla U(q_{k}) - c \\, h \\, p_{k} + \\sqrt{2 c h} \\, \\xi_{k}$\n    $q_{k+1} = q_{k} + h \\, p_{k+1}$\n-   **噪声项**：$\\xi_{k} \\sim \\mathcal{N}(0, 1)$，对于每一步 $k$ 都是独立同分布的，并且独立于状态 $(q_{k}, p_{k})$。\n-   **目标**：推导在给定 $(q_{k}, p_{k})$ 的条件下 $(q_{k+1}, p_{k+1})$ 的精确条件概率分布。\n-   **输出规格**：最终答案必须是条件均值向量和协方差矩阵的六个标量条目，顺序为 $(\\mu_{q}, \\mu_{p}, \\sigma_{qq}, \\sigma_{qp}, \\sigma_{pq}, \\sigma_{pp})$。\n\n#### 第1.2步：使用提取的给定信息进行验证\n\n-   **科学依据**：该问题在统计力学和计算统计学领域有充分的依据。欠阻尼朗之万方程是随机动力学的基础模型，而 SGHMC 算法及其离散化是现代机器学习和贝叶斯推断中广泛使用的标准方法。其数学框架完全有效。\n-   **适定性**：该问题是适定的。状态更新方程已明确给出。唯一的随机性来源是高斯变量 $\\xi_k$。$p_{k+1}$ 和 $q_{k+1}$ 的更新是 $\\xi_k$ 的仿射变换。高斯随机变量的仿射变换结果仍是高斯随机变量。因此，给定 $(q_{k}, p_{k})$ 时 $(q_{k+1}, p_{k+1})$ 的条件分布将是二元高斯分布，它由其均值向量和协方差矩阵唯一确定。所有必要的参数（$A, c, h$）和初始状态变量（$q_k, p_k$）都已提供。\n-   **客观性**：该问题使用精确无歧义的数学语言陈述。没有主观或非科学的元素。\n-   **结论**：该问题不违反任何无效性标准。它是科学上合理的、适定的和客观的。\n\n#### 第1.3步：判定与行动\n\n问题陈述是**有效**的。我将继续构建解决方案。\n\n### 第2步：求解推导\n\n目标是确定在给定状态向量 $X_{k} = \\begin{pmatrix} q_{k} \\\\ p_{k} \\end{pmatrix}$ 的情况下，状态向量 $X_{k+1} = \\begin{pmatrix} q_{k+1} \\\\ p_{k+1} \\end{pmatrix}$ 的条件分布。\n\n首先，我们确定势能函数 $U(q)$ 的梯度。\n对于二次势能 $U(q) = \\frac{A}{2} q^{2}$，其梯度为 $\\nabla U(q) = \\frac{dU}{dq} = A q$。\n\n将此代入给定的离散化格式，我们得到显式的更新规则：\n动量 $p_{k+1}$ 的更新为：\n$$p_{k+1} = p_{k} - h (A q_{k}) - c h p_{k} + \\sqrt{2 c h} \\, \\xi_{k}$$\n$$p_{k+1} = (1 - c h) p_{k} - A h q_{k} + \\sqrt{2 c h} \\, \\xi_{k}$$\n位置 $q_{k+1}$ 的更新为：\n$$q_{k+1} = q_{k} + h p_{k+1}$$\n\n这些方程描述了标准正态随机变量 $\\xi_k$ 到向量 $(q_{k+1}, p_{k+1})$ 的一个仿射变换。在条件分布的背景下，$q_k$ 和 $p_k$ 的值被视为固定常数。由于高斯变量的仿射变换仍然是高斯分布，因此 $(q_{k+1}, p_{k+1})$ 的条件分布是一个二元正态分布。该分布完全由其均值向量和协方差矩阵所表征。\n\n#### 条件均值向量的计算\n\n条件均值向量为 $\\mu = E[X_{k+1} | X_{k}] = \\begin{pmatrix} E[q_{k+1} | q_{k}, p_{k}] \\\\ E[p_{k+1} | q_{k}, p_{k}] \\end{pmatrix} = \\begin{pmatrix} \\mu_q \\\\ \\mu_p \\end{pmatrix}$。我们利用 $E[\\xi_k] = 0$ 这一事实。\n\n首先，我们计算动量的条件均值 $\\mu_p$：\n$$\\mu_p = E[p_{k+1} | q_{k}, p_{k}] = E[(1 - c h) p_{k} - A h q_{k} + \\sqrt{2 c h} \\, \\xi_{k} | q_{k}, p_{k}]$$\n根据期望的线性性质，并将 $q_k$ 和 $p_k$ 视为常数：\n$$\\mu_p = (1 - c h) p_{k} - A h q_{k} + \\sqrt{2 c h} \\, E[\\xi_{k}]$$\n$$\\mu_p = (1 - c h) p_{k} - A h q_{k}$$\n\n接下来，我们计算位置的条件均值 $\\mu_q$：\n$$\\mu_q = E[q_{k+1} | q_{k}, p_{k}] = E[q_{k} + h p_{k+1} | q_{k}, p_{k}]$$\n利用期望的线性性质和先前为 $E[p_{k+1} | q_k, p_k]$ 求得的结果：\n$$\\mu_q = q_{k} + h E[p_{k+1} | q_{k}, p_{k}] = q_{k} + h \\mu_p$$\n$$\\mu_q = q_{k} + h ((1 - c h) p_{k} - A h q_{k})$$\n$$\\mu_q = (1 - A h^{2}) q_{k} + h(1 - c h) p_{k}$$\n\n因此，条件均值向量为：\n$$\\mu = \\begin{pmatrix} (1 - A h^{2}) q_{k} + h(1 - c h) p_{k} \\\\ -A h q_{k} + (1 - c h) p_{k} \\end{pmatrix}$$\n\n#### 条件协方差矩阵的计算\n\n条件协方差矩阵为 $\\Sigma = \\text{Cov}(X_{k+1} | X_{k}) = \\begin{pmatrix} \\sigma_{qq}  \\sigma_{qp} \\\\ \\sigma_{pq}  \\sigma_{pp} \\end{pmatrix}$。矩阵的条目由 $q_{k+1}$ 和 $p_{k+1}$ 与其条件均值的偏差计算得出。让我们找出这些偏差：\n$$p_{k+1} - \\mu_p = \\left( (1 - c h) p_{k} - A h q_{k} + \\sqrt{2 c h} \\, \\xi_{k} \\right) - \\left( (1 - c h) p_{k} - A h q_{k} \\right) = \\sqrt{2 c h} \\, \\xi_{k}$$\n$$q_{k+1} - \\mu_q = (q_{k} + h p_{k+1}) - (q_{k} + h \\mu_p) = h (p_{k+1} - \\mu_p) = h \\sqrt{2 c h} \\, \\xi_{k}$$\n\n现在我们可以利用 $\\text{Var}(\\xi_k) = E[\\xi_k^2] - (E[\\xi_k])^2 = E[\\xi_k^2] = 1$ 这一事实来计算协方差矩阵的元素。\n\n一个随机变量 $Z$ 的方差是 $\\text{Var}(Z) = E[(Z - E[Z])^2]$。对于我们的条件设置：\n$\\sigma_{pp} = \\text{Var}(p_{k+1} | q_{k}, p_{k}) = E[(p_{k+1} - \\mu_p)^2 | q_k, p_k]$\n$$\\sigma_{pp} = E[(\\sqrt{2 c h} \\, \\xi_{k})^2] = (2 c h) \\, E[\\xi_k^2] = 2 c h$$\n\n$\\sigma_{qq} = \\text{Var}(q_{k+1} | q_{k}, p_{k}) = E[(q_{k+1} - \\mu_q)^2 | q_k, p_k]$\n$$\\sigma_{qq} = E[(h \\sqrt{2 c h} \\, \\xi_{k})^2] = h^2 (2 c h) \\, E[\\xi_k^2] = 2 c h^{3}$$\n\n$\\sigma_{pq} = \\text{Cov}(p_{k+1}, q_{k+1} | q_{k}, p_{k}) = E[(p_{k+1} - \\mu_p)(q_{k+1} - \\mu_q) | q_k, p_k]$\n$$\\sigma_{pq} = E[(\\sqrt{2 c h} \\, \\xi_{k}) (h \\sqrt{2 c h} \\, \\xi_{k})] = h (2 c h) \\, E[\\xi_k^2] = 2 c h^{2}$$\n\n协方差矩阵是对称的，所以 $\\sigma_{qp} = \\sigma_{pq} = 2 c h^{2}$。\n\n条件协方差矩阵是：\n$$\\Sigma = \\begin{pmatrix} 2 c h^{3}  2 c h^{2} \\\\ 2 c h^{2}  2 c h \\end{pmatrix}$$\n\n#### 结果总结\n\n在给定 $(q_{k}, p_{k})$ 的条件下，$(q_{k+1}, p_{k+1})$ 的条件分布是一个二元正态分布 $\\mathcal{N}(\\mu, \\Sigma)$。\n\n均值向量的分量是：\n- $\\mu_{q} = (1 - A h^{2}) q_{k} + h(1 - c h) p_{k}$\n- $\\mu_{p} = -A h q_{k} + (1 - c h) p_{k}$\n\n协方差矩阵的条目是：\n- $\\sigma_{qq} = 2 c h^{3}$\n- $\\sigma_{qp} = 2 c h^{2}$\n- $\\sigma_{pq} = 2 c h^{2}$\n- $\\sigma_{pp} = 2 c h$\n\n这六个标量按要求的顺序构成了最终答案。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n(1 - A h^{2}) q_{k} + h(1 - c h) p_{k}  -A h q_{k} + (1 - c h) p_{k}  2 c h^{3}  2 c h^{2}  2 c h^{2}  2 c h\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "在理解了单步更新的微观机制后，我们现在将视角提升到宏观层面，探究算法的长期行为和其理论基础。此练习将SGHMC动力学视为一个连续时间的Ornstein–Uhlenbeck过程，要求我们验证其平稳分布是否确实是我们期望的吉布斯-玻尔兹曼分布。通过运用随机微分方程和李雅普诺夫方程的理论，这个练习揭示了SGHMC算法为何能有效采样目标分布的根本原因。",
            "id": "3349094",
            "problem": "考虑一个 $d$ 维的随机梯度哈密顿蒙特卡洛（SGHMC）问题，其质量矩阵为单位矩阵，二次势能为 $U(q)=\\tfrac{1}{2} q^{\\top} A q$（其中 $A \\in \\mathbb{R}^{d \\times d}$ 是对称正定矩阵），摩擦矩阵 $C \\in \\mathbb{R}^{d \\times d}$ 是对称半正定矩阵。设 $(q_t,p_t)$ 满足伊藤随机微分方程（SDE）\n$$\n\\mathrm{d} q_t = p_t \\,\\mathrm{d} t,\\quad\n\\mathrm{d} p_t = -A q_t \\,\\mathrm{d} t - C p_t \\,\\mathrm{d} t + \\sqrt{2 C}\\,\\mathrm{d} W_t,\n$$\n其中 $W_t$ 是一个标准的 $d$ 维维纳过程，$\\sqrt{2 C}$ 表示满足 $(\\sqrt{2 C})(\\sqrt{2 C})^{\\top} = 2 C$ 的任意矩阵平方根。定义 $2d$ 维状态 $x_t = \\begin{pmatrix} q_t \\\\ p_t \\end{pmatrix}$。\n\n仅使用关于线性伊藤SDE和奥恩斯坦-乌伦贝克过程的基本事实，执行以下操作：\n\n1. 从SGHMC的线性SDE形式出发，根据漂移矩阵指数和随机卷积推导出 $x_t$ 的精确解。\n2. 确定一个与二次势能和单位质量所隐含的哈密顿目标密度相对应的 $x_t$ 的候选平稳高斯分布，并以分块形式计算其协方差矩阵 $\\Sigma_{\\star}$。\n3. 通过检验与线性SDE相关的连续时间李雅普诺夫方程，验证 $\\Sigma_{\\star}$ 在SGHMC动态下是不变的。\n4. 总结出 $\\Sigma_{\\star}$ 的显式分块矩阵表达式。\n\n您的最终答案必须是平稳协方差矩阵 $\\Sigma_{\\star}$ 的分块形式的单一闭式解析表达式。本问题不涉及数值舍入，也不涉及单位。请将您的最终答案表示为单个矩阵表达式。",
            "solution": "该问题要求推导特定随机梯度哈密顿蒙特卡洛（SGHMC）过程的平稳协方差矩阵。该过程由状态向量 $x_t = \\begin{pmatrix} q_t \\\\ p_t \\end{pmatrix} \\in \\mathbb{R}^{2d}$ 的线性伊藤随机微分方程（SDE）系统描述。我们将遵循问题陈述中概述的四个步骤。\n\n首先，我们将给定的SDE系统表述为单个线性向量SDE。状态为 $x_t = \\begin{pmatrix} q_t \\\\ p_t \\end{pmatrix}$。该系统由以下方程给出：\n$$\n\\mathrm{d} q_t = p_t \\,\\mathrm{d} t \\\\\n\\mathrm{d} p_t = -A q_t \\,\\mathrm{d} t - C p_t \\,\\mathrm{d} t + \\sqrt{2 C}\\,\\mathrm{d} W_t\n$$\n这可以写成矩阵-向量形式：\n$$\n\\mathrm{d} \\begin{pmatrix} q_t \\\\ p_t \\end{pmatrix} = \\begin{pmatrix} 0  I \\\\ -A  -C \\end{pmatrix} \\begin{pmatrix} q_t \\\\ p_t \\end{pmatrix} \\mathrm{d} t + \\begin{pmatrix} 0 \\\\ \\sqrt{2C} \\end{pmatrix} \\mathrm{d} W_t\n$$\n这是一个奥恩斯坦-乌伦贝克类型的线性SDE，$\\mathrm{d}x_t = B x_t \\mathrm{d}t + S \\mathrm{d}W_t$，其中漂移矩阵 $B$ 和扩散矩阵 $S$ 定义为：\n$$\nB = \\begin{pmatrix} 0  I \\\\ -A  -C \\end{pmatrix}, \\quad S = \\begin{pmatrix} 0 \\\\ \\sqrt{2C} \\end{pmatrix}\n$$\n这里，$I$ 是 $d \\times d$ 单位矩阵，在适当的情况下，$0$ 代表 $d \\times d$ 零矩阵。\n\n1. $x_t$ 的精确解：\n对于形式为 $\\mathrm{d}x_t = B x_t \\mathrm{d}t + S \\mathrm{d}W_t$ 且初始条件为 $x_0$ 的线性SDE，其形式解由常数变易法给出。解为：\n$$\nx_t = \\exp(Bt) x_0 + \\int_0^t \\exp(B(t-s)) S \\,\\mathrm{d}W_s\n$$\n该表达式用漂移矩阵的矩阵指数 $\\exp(Bt)$ 和随机卷积积分给出了时间 $t$ 的状态 $x_t$。随机卷积积分捕捉了维纳过程 $W_s$ 在区间 $[0, t]$ 上的累积效应。\n\n2. 候选平稳高斯分布：\nSGHMC动态旨在从与系统哈密顿量相关的目标分布中进行采样。势能为 $U(q) = \\frac{1}{2} q^{\\top} A q$，动能（单位质量矩阵 $M=I$）为 $K(p) = \\frac{1}{2} p^{\\top} p$。总哈密顿量为 $H(q,p) = U(q) + K(p)$。\n$$\nH(q,p) = \\frac{1}{2} q^{\\top} A q + \\frac{1}{2} p^{\\top} p\n$$\n涨落-耗散定理意味着这些动态的平稳分布是吉布斯-玻尔兹曼分布 $\\pi(q,p) \\propto \\exp(-H(q,p))$。用状态向量 $x$ 表示，即为：\n$$\n\\pi(x) \\propto \\exp\\left(-\\frac{1}{2}\\left(q^{\\top} A q + p^{\\top} p\\right)\\right) = \\exp\\left(-\\frac{1}{2} \\begin{pmatrix} q \\\\ p \\end{pmatrix}^{\\top} \\begin{pmatrix} A  0 \\\\ 0  I \\end{pmatrix} \\begin{pmatrix} q \\\\ p \\end{pmatrix}\\right)\n$$\n这对应于一个零均值的多元高斯分布，其密度函数为 $p(x) \\propto \\exp(-\\frac{1}{2} x^{\\top} \\Sigma_{\\star}^{-1} x)$。通过比较指数部分，我们可以确定平稳协方差矩阵 $\\Sigma_{\\star}$ 的逆矩阵：\n$$\n\\Sigma_{\\star}^{-1} = \\begin{pmatrix} A  0 \\\\ 0  I \\end{pmatrix}\n$$\n由于 $A$ 是对称正定的，因此它是可逆的。协方差矩阵 $\\Sigma_{\\star}$ 是 $\\Sigma_{\\star}^{-1}$ 的逆：\n$$\n\\Sigma_{\\star} = \\left(\\begin{pmatrix} A  0 \\\\ 0  I \\end{pmatrix}\\right)^{-1} = \\begin{pmatrix} A^{-1}  0 \\\\ 0  I^{-1} \\end{pmatrix} = \\begin{pmatrix} A^{-1}  0 \\\\ 0  I \\end{pmatrix}\n$$\n这是我们候选的平稳协方差矩阵。它描述了一个位置 $q$ 和动量 $p$ 不相关的分布，其中 $\\mathbb{E}[qq^\\top] = A^{-1}$，$\\mathbb{E}[pp^\\top] = I$，以及 $\\mathbb{E}[qp^\\top] = 0$。\n\n3. 通过李雅普诺夫方程验证不变性：\n对于一个线性SDE系统，协方差矩阵 $\\Sigma$ 是平稳的，当且仅当它是连续时间代数李雅普诺夫方程的一个半正定解：\n$$\nB \\Sigma + \\Sigma B^{\\top} + Q = 0\n$$\n其中 $Q = S S^\\top$ 是噪声项的协方差。我们来计算 $Q$：\n$$\nQ = S S^{\\top} = \\begin{pmatrix} 0 \\\\ \\sqrt{2C} \\end{pmatrix} \\begin{pmatrix} 0^{\\top}  (\\sqrt{2C})^{\\top} \\end{pmatrix} = \\begin{pmatrix} 0  0 \\\\ 0  (\\sqrt{2C})(\\sqrt{2C})^{\\top} \\end{pmatrix} = \\begin{pmatrix} 0  0 \\\\ 0  2C \\end{pmatrix}\n$$\n我们现在必须验证我们的候选矩阵 $\\Sigma_{\\star}$ 满足 $B \\Sigma_{\\star} + \\Sigma_{\\star} B^{\\top} + Q = 0$。\n漂移矩阵 $B$ 的转置是：\n$$\nB^{\\top} = \\begin{pmatrix} 0  I \\\\ -A  -C \\end{pmatrix}^{\\top} = \\begin{pmatrix} 0^{\\top}  -A^{\\top} \\\\ I^{\\top}  -C^{\\top} \\end{pmatrix} = \\begin{pmatrix} 0  -A \\\\ I  -C \\end{pmatrix}\n$$\n因为 $A$ 和 $C$ 是对称的。\n\n现在，我们计算 $B \\Sigma_{\\star}$ 项：\n$$\nB \\Sigma_{\\star} = \\begin{pmatrix} 0  I \\\\ -A  -C \\end{pmatrix} \\begin{pmatrix} A^{-1}  0 \\\\ 0  I \\end{pmatrix} = \\begin{pmatrix} 0 \\cdot A^{-1} + I \\cdot 0  0 \\cdot 0 + I \\cdot I \\\\ -A \\cdot A^{-1} - C \\cdot 0  -A \\cdot 0 - C \\cdot I \\end{pmatrix} = \\begin{pmatrix} 0  I \\\\ -I  -C \\end{pmatrix}\n$$\n接下来，我们计算 $\\Sigma_{\\star} B^{\\top}$ 项：\n$$\n\\Sigma_{\\star} B^{\\top} = \\begin{pmatrix} A^{-1}  0 \\\\ 0  I \\end{pmatrix} \\begin{pmatrix} 0  -A \\\\ I  -C \\end{pmatrix} = \\begin{pmatrix} A^{-1} \\cdot 0 + 0 \\cdot I  A^{-1}(-A) + 0 \\cdot (-C) \\\\ 0 \\cdot 0 + I \\cdot I  0 \\cdot (-A) + I \\cdot (-C) \\end{pmatrix} = \\begin{pmatrix} 0  -I \\\\ I  -C \\end{pmatrix}\n$$\n最后，我们将 $B \\Sigma_{\\star}$，$\\Sigma_{\\star} B^{\\top}$ 和 $Q$ 这三项相加：\n$$\nB \\Sigma_{\\star} + \\Sigma_{\\star} B^{\\top} + Q = \\begin{pmatrix} 0  I \\\\ -I  -C \\end{pmatrix} + \\begin{pmatrix} 0  -I \\\\ I  -C \\end{pmatrix} + \\begin{pmatrix} 0  0 \\\\ 0  2C \\end{pmatrix}\n$$\n$$\n= \\begin{pmatrix} 0+0+0  I-I+0 \\\\ -I+I+0  -C-C+2C \\end{pmatrix} = \\begin{pmatrix} 0  0 \\\\ 0  0 \\end{pmatrix}\n$$\n李雅普诺夫方程成立。这证实了 $\\Sigma_{\\star} = \\begin{pmatrix} A^{-1}  0 \\\\ 0  I \\end{pmatrix}$ 确实是给定SGHMC过程的平稳协方差矩阵，前提是存在唯一的平稳分布。\n\n4. 结论：\n通过李雅普诺夫方程的推导和后续验证证实，给定SGHMC过程的平稳状态是一个零均值高斯分布。该平稳分布的协方差矩阵 $\\Sigma_{\\star}$ 由上面推导出的分块矩阵给出。该矩阵是对称正定的，正如非退化高斯分布所要求的那样，因为 $A^{-1}$ 是正定的，$I$ 也是正定的。\n\n平稳协方差矩阵 $\\Sigma_{\\star}$ 的显式分块矩阵表达式为：\n$$\n\\Sigma_{\\star} = \\begin{pmatrix} \\mathbb{E}[q_t q_t^{\\top}]  \\mathbb{E}[q_t p_t^{\\top}] \\\\ \\mathbb{E}[p_t q_t^{\\top}]  \\mathbb{E}[p_t p_t^{\\top}] \\end{pmatrix} = \\begin{pmatrix} A^{-1}  0 \\\\ 0  I \\end{pmatrix}\n$$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} A^{-1}  0 \\\\ 0  I \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "理论上的正确性是基础，但在实际应用中，我们需要有效的方法来诊断和校准我们的采样器。这个练习将理论与实践联系起来，介绍一个基于“动能温度”的关键诊断工具。我们将从第一性原理出发，推导该诊断工具如何揭示梯度噪声估计中的校准误差，从而学会如何监控SGHMC模拟的“健康状况”并进行相应调整。",
            "id": "3349082",
            "problem": "考虑随机梯度哈密顿蒙特卡洛（SGHMC），它通过增加摩擦和随机驱动来增强哈密顿蒙特卡洛（HMC），以抵消随机梯度噪声。设位置 $q \\in \\mathbb{R}^d$ 上的目标密度与 $\\exp(-U(q))$ 成正比，哈密顿量为 $H(q,p) = U(q) + \\tfrac{1}{2} p^{\\top} M^{-1} p$，其中 $M \\in \\mathbb{R}^{d \\times d}$ 是一个对称正定质量矩阵。在连续时间下，动量 $p$ 根据一个随机微分方程（SDE）演化，该方程结合了哈密顿方程、线性摩擦以及来自人工注入噪声和随机梯度误差的随机驱动。为了分析的易处理性，假设以下各向同性设置：$M = m I_d$（其中 $m  0$），摩擦 $C = c I_d$（其中 $c  0$），并且随机梯度噪声可以建模为近似的白噪声，其均值为零，单位时间内的协方差为 $2 b I_d$（其中 $b \\ge 0$）。该算法使用 $b$ 的一个估计值 $\\hat b \\ge 0$ 来设置注入的扩散，使得净扩散旨在重现所需的 $p$ 的正则边缘分布。\n\n受平衡统计力学的启发，将边缘动能温度定义为标量泛函 $\\mathbb{E}\\!\\left[p^{\\top} M^{-1} p\\right]/d$，其中 $d$ 是维度。你需要基于沿 SGHMC 轨迹对该量的时间平均构造一个实用的诊断工具，并从第一性原理出发，推断其与 $1$ 的偏差如何反映梯度噪声估计 $\\hat b$ 中的校准误差。\n\n从正确校准下动量边缘分布的正则形式出发，并仅使用上述各向同性假设下动量的线性 Ornstein–Uhlenbeck 动力学的基本性质，判断以下哪个陈述正确地指定了一个一致的诊断方法及其关于 $\\hat b$ 对 $b$ 的低估与高估的解释。\n\nA. 将诊断量定义为沿马尔可夫链收集的运行平均 $\\hat T = \\tfrac{1}{K} \\sum_{k=1}^{K} \\tfrac{1}{d} p_k^{\\top} M^{-1} p_k$。在各向同性设置和小步长极限下，$\\mathbb{E}[\\hat T]$ 等于一个有效温度，该温度随 $b - \\hat b$ 相对于 $c$ 线性增加，因此 $\\hat T  1$ 表示注入的扩散相对于真实的梯度噪声太小（即 $\\hat b  b$），而 $\\hat T  1$ 表示 $\\hat b > b$。可以通过调整 $\\hat b$（或增加 $c$）来使 $\\hat T$ 回到 $1$。\n\nB. 将诊断量定义为 $\\hat T = \\tfrac{1}{K} \\sum_{k=1}^{K} \\tfrac{1}{d} p_k^{\\top} p_k$，忽略质量矩阵。在正确校准下，它总是等于 $1$，任何与 $1$ 的偏差仅由蒙特卡洛误差引起，并且与 $\\hat b$ 无关。\n\nC. 使用哈密顿量的运行平均 $\\tfrac{1}{K} \\sum_{k=1}^{K} H(q_k,p_k)$ 作为诊断量；如果它大于 $1$，则梯度噪声估计过大（即 $\\hat b > b$），如果小于 $1$，则 $\\hat b  b$。\n\nD. 在 HMC 类型的采样器中，无论摩擦 $c$ 和噪声校准如何，边缘动能温度都等于 $1$，因此它不能诊断 $b$ 和 $\\hat b$ 之间的任何不匹配。",
            "solution": "我们从正确校准下的正则动量边缘分布开始。在一个正确校准的 SGHMC 中，平稳联合分布与 $\\exp(-H(q,p))$ 成正比，它可以分解为关于 $q$ 和 $p$ 的乘积形式 $\\exp(-U(q)) \\exp\\!\\left(-\\tfrac{1}{2} p^{\\top} M^{-1} p\\right)$。因此，动量边缘分布是均值为零、协方差为 $M$ 的高斯分布。因此，边缘动能温度等于\n$$\n\\frac{\\mathbb{E}\\!\\left[p^{\\top} M^{-1} p\\right]}{d} \\;=\\; \\frac{\\operatorname{tr}\\!\\left(M^{-1} \\operatorname{Cov}(p)\\right)}{d} \\;=\\; \\frac{\\operatorname{tr}(I_d)}{d} \\;=\\; 1.\n$$\n这提供了基准：在正确校准下，动能温度等于 $1$。\n\n接下来我们考虑校准不当如何改变动量动力学。在各向同性假设 $M = m I_d$、$C = c I_d$ 下，随机梯度噪声建模为均值为零、单位时间内协方差为 $2 b I_d$ 的白噪声，并使用一个估计值 $\\hat b$ 来设置注入的扩散，动量 SDE 可以写成\n$$\n\\mathrm{d} p \\;=\\; - \\nabla U(q)\\, \\mathrm{d} t \\;-\\; c m^{-1} p\\, \\mathrm{d} t \\;+\\; \\sqrt{2\\,(c - \\hat b)}\\, \\mathrm{d} W_0 \\;+\\; \\sqrt{2\\, b}\\, \\mathrm{d} W_1,\n$$\n其中 $W_0$ 和 $W_1$ 是独立的标准 $d$ 维维纳过程。聚合独立的高斯扰动得到一个等价的表示\n$$\n\\mathrm{d} p \\;=\\; - \\nabla U(q)\\, \\mathrm{d} t \\;-\\; c m^{-1} p\\, \\mathrm{d} t \\;+\\; \\sqrt{2\\,\\big(c + (b - \\hat b)\\big)}\\, \\mathrm{d} \\widetilde{W},\n$$\n其中 $\\widetilde{W}$ 是一个标准的 $d$ 维维纳过程，前提是 $c - \\hat b \\ge 0$ 以确保良定性。项 $- \\nabla U(q)\\, \\mathrm{d} t$ 与 $q$ 耦合，但 $p$ 的线性部分是一个 Ornstein–Uhlenbeck (OU) 分量。为了分析平稳动量边缘分布，我们利用正则目标中的常见分离特性：期望的动量边缘分布与 $q$ 无关，而 OU 分量控制着 $p$ 的协方差。\n\n形式上，在各向同性设置中，OU 部分的平稳协方差 $\\Sigma = \\operatorname{Cov}(p)$ 满足连续时间李雅普诺夫方程\n$$\n\\left(c m^{-1}\\right) \\Sigma \\;+\\; \\Sigma \\left(c m^{-1}\\right) \\;=\\; 2\\,\\big(c + (b - \\hat b)\\big)\\, I_d,\n$$\n该方程可简化为\n$$\n\\frac{2 c}{m} \\,\\Sigma \\;=\\; 2\\,\\big(c + (b - \\hat b)\\big)\\, I_d \\quad \\Longrightarrow \\quad \\Sigma \\;=\\; m \\left(1 + \\frac{b - \\hat b}{c}\\right) I_d.\n$$\n因此，有效动量边缘分布是协方差为 $\\Sigma = T_{\\mathrm{eff}}\\, M$ 的高斯分布，其中标量有效温度为\n$$\nT_{\\mathrm{eff}} \\;=\\; 1 + \\frac{b - \\hat b}{c}.\n$$\n边缘动能温度则满足\n$$\n\\frac{\\mathbb{E}\\!\\left[p^{\\top} M^{-1} p\\right]}{d} \\;=\\; \\frac{\\operatorname{tr}\\!\\left(M^{-1} \\Sigma\\right)}{d} \\;=\\; \\frac{\\operatorname{tr}\\!\\left(M^{-1} \\cdot T_{\\mathrm{eff}}\\, M\\right)}{d} \\;=\\; T_{\\mathrm{eff}} \\;=\\; 1 + \\frac{b - \\hat b}{c}.\n$$\n因此：\n- 如果 $\\hat b = b$，则 $\\mathbb{E}\\!\\left[p^{\\top} M^{-1} p\\right]/d = 1$。\n- 如果 $\\hat b  b$，则 $b - \\hat b > 0$ 且 $\\mathbb{E}\\!\\left[p^{\\top} M^{-1} p\\right]/d > 1$（马尔可夫链太“热”）。\n- 如果 $\\hat b > b$，则 $b - \\hat b  0$ 且 $\\mathbb{E}\\!\\left[p^{\\top} M^{-1} p\\right]/d  1$（马尔可夫链太“冷”）。\n\n因此，一个一致的经验诊断方法是沿轨迹计算的时间平均\n$$\n\\hat T \\;=\\; \\frac{1}{K} \\sum_{k=1}^{K} \\frac{1}{d}\\, p_k^{\\top} M^{-1} p_k,\n$$\n在小步长极限下且对于大的 $K$，$\\hat T$ 集中在 $1 + \\tfrac{b - \\hat b}{c}$ 附近。它与 $1$ 的偏差表明了校准误差相对于摩擦 $c$ 的符号和大小：大于 $1$ 的值意味着对 $b$ 的低估，而小于 $1$ 的值意味着高估。\n\n我们现在评估每个选项。\n\n选项 A：该选项将 $\\hat T$ 定义为 $\\tfrac{1}{K} \\sum_{k=1}^{K} \\tfrac{1}{d} p_k^{\\top} M^{-1} p_k$ 并指出，在各向同性假设和小步长极限下，其期望等于一个有效温度，该温度随 $b - \\hat b$ 除以 $c$ 线性增加，并且具有正确的方向解释：当 $\\hat b  b$ 时 $\\hat T > 1$，当 $\\hat b > b$ 时 $\\hat T  1$。它还指出，可以调整 $\\hat b$（或增加 $c$）以使 $\\hat T$ 回到 $1$。这与推导 $T_{\\mathrm{eff}} = 1 + \\tfrac{b - \\hat b}{c}$ 相符。结论：正确。\n\n选项 B：该选项使用 $\\hat T = \\tfrac{1}{K} \\sum \\tfrac{1}{d} p_k^{\\top} p_k$，忽略了 $M$，并声称在正确校准下它等于 $1$ 且与 $\\hat b$ 无关。在正确校准下，$\\operatorname{Cov}(p) = M = m I_d$，所以 $\\mathbb{E}\\!\\left[\\tfrac{1}{d} p^{\\top} p\\right] = \\tfrac{1}{d} \\operatorname{tr}(M) = m$，而不是 $1$，除非 $m = 1$。此外，在校准不当的情况下，期望值会按 $1 + \\tfrac{b - \\hat b}{c}$ 缩放，因此它并非与 $\\hat b$ 无关。结论：不正确。\n\n选项 C：该选项建议使用哈密顿量的运行平均，并将其与 $1$ 的偏差解释为与推导相反的符号。哈密顿量既不是无量纲的，也没有归一化到 $1$，其在平稳状态下的平均值也不是一个普适常数；此外，所提出的符号映射与 $T_{\\mathrm{eff}} = 1 + \\tfrac{b - \\hat b}{c}$ 相矛盾。结论：不正确。\n\n选项 D：该选项断言，无论摩擦和校准如何，边缘动能温度都等于 $1$。如上所示，校准不当会导致 $T_{\\mathrm{eff}} \\ne 1$，除非 $\\hat b = b$。结论：不正确。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}