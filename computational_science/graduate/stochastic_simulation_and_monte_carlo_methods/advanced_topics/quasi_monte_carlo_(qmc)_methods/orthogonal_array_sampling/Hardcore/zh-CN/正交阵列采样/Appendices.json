{
    "hands_on_practices": [
        {
            "introduction": "应用正交数组抽样的第一步是理解如何构建这些数组本身。这个练习提供了一个具体的分步任务，用于构建一个混合水平的正交数组，这是解决现实世界问题时的常见需求，因为在这些问题中，不同因子可能具有不同数量的水平。通过这个实践 ，你将巩固对“强度”和“平衡性”这两个核心概念的理解。",
            "id": "3325882",
            "problem": "在通过正交数组抽样来减少蒙特卡洛积分方差的背景下，考虑构建一个混合水平正交数组，该数组可用于生成具有精确二维分层的拟随机设计。假设有 $k_1$ 个因子，每个因子有 $s_1=2$ 个水平；$k_2$ 个因子，每个因子有 $s_2=3$ 个水平，并要求强度为 $t=2$。取 $k_1=3$，$k_2=4$，并把注意力集中在最小的容许试验次数 $N$ 上，该次数允许所有跨混合水平的两列表投影都具有强度 $t=2$。\n\n任务：\n1. 从强度为 $t$ 的正交数组的定义和基本计数出发，确定与所有无序列对（包括两水平列对、三水平列对和混合列对）的两两精确平衡相一致的最小 $N$。\n2. 以数学上明确的方式构造一个具有这些参数 $N, k_1, k_2, t$ 的正交数组，并从第一性原理（通过计数）验证所有的二维投影都是精确平衡的。\n3. 定义以下全局二维不平衡度量\n$$\nD \\;=\\; \\sum_{\\{i,j\\}} \\;\\sum_{a=0}^{s_i-1}\\;\\sum_{b=0}^{s_j-1} \\left(n_{ab}^{(i,j)} \\;-\\; \\frac{N}{s_i s_j}\\right)^{2},\n$$\n其中外层求和遍历所有不同列的无序列对 $\\{i,j\\}$，$s_i \\in \\{2,3\\}$ 是列 $i$ 的水平数，而 $n_{ab}^{(i,j)}$ 是观测到的列 $i$ 处于水平 $a$ 且列 $j$ 处于水平 $b$ 的试验次数。计算你构造的设计的 $D$ 的精确值。\n\n你的最终答案必须是等于 $D$ 值的单个实数值。如果需要数值近似，将会提供四舍五入的说明；此处请给出没有单位的精确值。",
            "solution": "用户希望我解决一个与正交数组抽样相关的问题。\n\n### 问题验证\n\n#### 步骤1：提取已知条件\n- 领域：通过正交数组抽样减少蒙特卡洛积分的方差。\n- 目标：构建一个具有精确二维分层（强度 $t=2$）的混合水平正交数组。\n- 因子：\n    - $k_1 = 3$ 个因子，每个有 $s_1 = 2$ 个水平。\n    - $k_2 = 4$ 个因子，每个有 $s_2 = 3$ 个水平。\n- 强度要求：$t=2$。\n- 试验次数：允许所有两列表投影强度为 $t=2$ 的最小容许试验次数 $N$。\n- 任务1：确定这个最小的 $N$。\n- 任务2：为这些参数构建正交数组并验证其性质。\n- 任务3：计算全局二维不平衡度量 $D$，定义为：\n$$\nD \\;=\\; \\sum_{\\{i,j\\}} \\;\\sum_{a=0}^{s_i-1}\\;\\sum_{b=0}^{s_j-1} \\left(n_{ab}^{(i,j)} \\;-\\; \\frac{N}{s_i s_j}\\right)^{2}\n$$\n其中 $\\{i,j\\}$ 是不同列的无序列对，$s_i \\in \\{2,3\\}$ 是列 $i$ 的水平数，$n_{ab}^{(i,j)}$ 是在列 $i$ 和 $j$ 中观测到的水平对 $(a,b)$ 的频率。\n\n#### 步骤2：使用提取的已知条件进行验证\n1.  **科学依据：** 该问题牢固地植根于试验设计的数学理论，特别是正交数组这一主题，它是组合数学和统计学中一个标准且成熟的领域。这些概念广泛应用于随机模拟及相关领域。该问题在科学上是合理的。\n2.  **适定性：** 该问题提供了所有必要的参数（$k_1, s_1, k_2, s_2, t$）和定义，以确定存在此类阵列的唯一最小试验次数 $N$。此类数组的存在是设计理论中的一个已知结果，其构造是标准的。最终要计算的量 $D$ 有精确的定义。该问题是适定的。\n3.  **客观性：** 语言是正式且明确的。所有术语，如“正交数组”、“强度”和不平衡度量 $D$，都有精确的数学定义。该问题是客观的。\n4.  **其他缺陷：** 该问题并非不完整、矛盾、不切实际、不适定、微不足道（构造步骤并非小事），或超出科学可验证性的范围。\n\n#### 步骤3：结论与行动\n问题有效。我将继续提供一个完整、有理有据的解答。\n\n### 解答\n\n问题分为三个任务。我们将按顺序解决它们。\n\n#### 任务1：确定最小试验次数 $N$\n\n强度为 $t=2$ 的正交数组要求对于任意一对列，所有可能的水平组合都以相同的频率出现。此性质对总试验次数 $N$ 施加了约束。我们考虑三种类型的列对。\n\n1.  **两水平列对：** 我们有 $k_1 = 3$ 个因子，每个因子有 $s_1 = 2$ 个水平。对于这些列的任意一对，比如列 $i$ 和列 $j$，存在 $s_i \\times s_j = 2 \\times 2 = 4$ 种可能的水平对：$(0,0), (0,1), (1,0), (1,1)$。为了使数组具有强度 $t=2$，这些水平对中的每一个都必须出现相同的次数，记为 $\\lambda_{11}$。因此，总试验次数必须为 $N = \\lambda_{11} \\cdot (s_1 \\times s_1) = 4\\lambda_{11}$。这意味着 $N$ 必须是 $4$ 的倍数。\n\n2.  **三水平列对：** 我们有 $k_2 = 4$ 个因子，每个因子有 $s_2 = 3$ 个水平。对于这些列的任意一对，比如列 $i$ 和列 $j$，存在 $s_i \\times s_j = 3 \\times 3 = 9$ 种可能的水平对。为了达到精确平衡，这 $9$ 个水平对中的每一个都必须出现相同的次数，记为 $\\lambda_{22}$。因此，$N = \\lambda_{22} \\cdot (s_2 \\times s_2) = 9\\lambda_{22}$。这意味着 $N$ 必须是 $9$ 的倍数。\n\n3.  **混合列对（一个两水平列，一个三水平列）：** 对于由一个具有 $s_1=2$ 个水平的列和一个具有 $s_2=3$ 个水平的列组成的列对，存在 $s_1 \\times s_2 = 2 \\times 3 = 6$ 种可能的水平对。为了达到精确平衡，这 $6$ 个水平对中的每一个都必须出现相同的次数，记为 $\\lambda_{12}$。因此，$N = \\lambda_{12} \\cdot (s_1 \\times s_2) = 6\\lambda_{12}$。这意味着 $N$ 必须是 $6$ 的倍数。\n\n要使具有给定参数的正交数组存在，$N$ 必须同时是 $4$、$9$ 和 $6$ 的倍数。满足此条件的最小正整数是这些数的最小公倍数。\n$$\nN = \\text{lcm}(4, 6, 9) = \\text{lcm}(2^2, 2 \\cdot 3, 3^2) = 2^2 \\cdot 3^2 = 4 \\cdot 9 = 36\n$$\n因此，最小容许试验次数为 $N=36$。此类数组的存在必须通过构造来确认，这是下一个任务。\n\n#### 任务2：正交数组的构造与验证\n\n我们可以使用乘积法，通过两个更小的、众所周知的正交数组来构造所需的混合水平正交数组，即一个 $OA(36, 2^3 3^4, 2)$。\n\n1.  **分量数组 A：** 一个正交数组 $OA(4, 2^3, 2)$。这是一个强度为 $2$ 的数组，有 $N_1=4$ 次试验和 $k_1=3$ 个因子，每个因子有 $s_1=2$ 个水平。其标准表示为：\n$$\nA = \\begin{pmatrix} 0  0  0 \\\\ 0  1  1 \\\\ 1  0  1 \\\\ 1  1  0 \\end{pmatrix}\n$$\n\n2.  **分量数组 B：** 一个正交数组 $OA(9, 3^4, 2)$。这是一个强度为 $2$ 的数组，有 $N_2=9$ 次试验和 $k_2=4$ 个因子，每个因子有 $s_2=3$ 个水平。这可以由3阶仿射平面 $AG(2,3)$ 构造。行对应于9个点 $(x,y)$，其中 $x,y \\in \\{0,1,2\\}$，列对应于非平行线。一个标准的构造使用代表函数 $x, y, x+y, x+2y$（均在模3下）的列：\n$$\nB = \\begin{pmatrix}\n0  0  0  0 \\\\\n0  1  1  2 \\\\\n0  2  2  1 \\\\\n1  0  1  1 \\\\\n1  1  2  0 \\\\\n1  2  0  2 \\\\\n2  0  2  2 \\\\\n2  1  0  1 \\\\\n2  2  1  0\n\\end{pmatrix}\n$$\n\n**构造：** 最终的 $36 \\times 7$ 数组 $C$ 是通过取 $A$ 和 $B$ 的乘积构造的。设 $A_i$ 是 $A$ 的第 $i$ 行，$B_j$ 是 $B$ 的第 $j$ 行。对于 $k \\in \\{0, 1, \\dots, 35\\}$，$C$ 的第 $k$ 行是通过连接行 $A_i$ 和行 $B_j$ 形成的，其中 $i = \\lfloor k/9 \\rfloor$ 且 $j = k \\pmod 9$。\n\n**验证：** 我们通过检查任意一对列是否平衡来验证 $C$ 是一个 $OA(36, 2^3 3^4, 2)$。\n\n- **两个2水平列：** 考虑 $C$ 的前3列中的任意两列。这两列对应于 $A$ 的两列。由于 $A$ 是一个 $OA(4, 2^3, 2)$，它的任意一对列都精确地包含 $2 \\times 2 = 4$ 种水平组合各一次。在 $C$ 的构造中，$A$ 的每一行都重复了 $N_2 = 9$ 次。因此，在 $C$ 的任意两个2水平列中，4种水平组合中的每一种都出现了 $1 \\times 9 = 9$ 次。这与要求的频率 $N/(s_1 s_1) = 36/4 = 9$ 相匹配。\n\n- **两个3水平列：** 考虑 $C$ 的后4列中的任意两列。这两列对应于 $B$ 的两列。由于 $B$ 是一个 $OA(9, 3^4, 2)$，它的任意一对列都精确地包含 $3 \\times 3 = 9$ 种水平组合各一次。在 $C$ 的构造中，整个数组 $B$ 重复了 $N_1 = 4$ 次。因此，在 $C$ 的任意两个3水平列中，9种水平组合中的每一种都出现了 $1 \\times 4 = 4$ 次。这与要求的频率 $N/(s_2 s_2) = 36/9 = 4$ 相匹配。\n\n- **一个2水平列和一个3水平列：** 考虑一个来自2水平部分和一个来自3水平部分的列。对于一个给定的水平对 $(u, v)$，其中 $u \\in \\{0, 1\\}$ 且 $v \\in \\{0, 1, 2\\}$，我们需要计算这对水平在 $C$ 中出现的行数。$C$ 中的一行是由 $A$ 的一行和 $B$ 的一行组成的。在 $A$ 中，2水平因子处于水平 $u$ 的行数是 $N_1/s_1 = 4/2 = 2$。在 $B$ 中，3水平因子处于水平 $v$ 的行数是 $N_2/s_2 = 9/3 = 3$。由于 $A$ 的每一行都与 $B$ 的每一行组合，水平对 $(u, v)$ 出现的次数是这些计数的乘积：$2 \\times 3 = 6$。这与要求的频率 $N/(s_1 s_2) = 36/6 = 6$ 相匹配。\n\n构造是成功的，并产生了一个具有精确二维分层（强度 $t=2$）的设计。\n\n#### 任务3：不平衡度量 $D$ 的计算\n\n全局二维不平衡度量定义为：\n$$\nD \\;=\\; \\sum_{\\{i,j\\}} \\;\\sum_{a=0}^{s_i-1}\\;\\sum_{b=0}^{s_j-1} \\left(n_{ab}^{(i,j)} \\;-\\; \\frac{N}{s_i s_j}\\right)^{2}\n$$\n项 $n_{ab}^{(i,j)}$ 是在列 $i$ 和 $j$ 中观测到的水平对 $(a,b)$ 的计数。项 $N/(s_i s_j)$ 是一个完全平衡（强度为2）设计的期望计数。\n\n正如在任务2中验证的，我们构造的数组是一个强度为 $t=2$ 的正交数组。根据定义，这意味着对于每一对不同的列的无序列对 $\\{i,j\\}$，观测到的计数 $n_{ab}^{(i,j)}$ 都精确等于完美平衡所需的理论计数。即：\n$$\nn_{ab}^{(i,j)} = \\frac{N}{s_i s_j}\n$$\n对于所有的列对 $\\{i,j\\}$ 和所有对应的水平组合 $(a,b)$。\n\n具体来说：\n- 对于任意一对2水平列，$n_{ab}^{(i,j)} = 9$ 且 $\\frac{N}{s_i s_j} = \\frac{36}{2 \\times 2} = 9$。\n- 对于任意一对3水平列，$n_{ab}^{(i,j)} = 4$ 且 $\\frac{N}{s_i s_j} = \\frac{36}{3 \\times 3} = 4$。\n- 对于任意一对混合列，$n_{ab}^{(i,j)} = 6$ 且 $\\frac{N}{s_i s_j} = \\frac{36}{2 \\times 3} = 6$。\n\n因此，对于 $D$ 的求和中的每一项，括号内的量都恰好为零：\n$$\nn_{ab}^{(i,j)} - \\frac{N}{s_i s_j} = 0\n$$\n因此，整个和是零的和，结果为零。\n$$\nD = \\sum_{\\{i,j\\}} \\sum_{a,b} (0)^2 = 0\n$$\n对于所构造的设计，$D$ 的精确值为 $0$。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "在理想的设计之后，我们转向一个更现实的场景：如果实际限制使我们无法使用完美设计的正交数组中的所有试验点，会发生什么？这个练习  探讨了对正交数组进行子抽样的统计后果。通过计算由此产生的偏差和方差，我们可以量化数组平衡性的退化程度，从而为理解这些设计的稳健性提供关键见解。",
            "id": "3325867",
            "problem": "考虑一个强度为 $t$ 的正交数组 (OA)，记为 $OA(N,k,s,t)$，其中 $N$ 是设计点的数量，$k$ 是因子的数量，每个因子有 $s$ 个水平，强度 $t$ 意味着对于任意 $t$ 列的选择，所有 $s^{t}$ 种水平组合出现的次数都相同。令 $t'$ 为一个满足 $1 \\leq t' \\le t$ 的整数。根据 $OA(N,k,s,t)$ 的定义性质，对于任意固定的 $t'$ 列的选择 $J$，在整个数组中，$J$ 上的 $s^{t'}$ 种水平组合中的每一种都恰好出现 $N/s^{t'}$ 次。\n\n假设进行一次随机稀疏化：从 $N$ 个点中无放回地均匀随机抽取 $n$ 个点，其中 $1 \\leq n  N$。对于固定的 $t'$ 子集 $J$，用 $u \\in \\{1,2,\\dots,s^{t'}\\}$ 来索引 $s^{t'}$ 种水平组合。令 $X_{u}$ 表示所选的 $n$ 个点中，其在 $J$ 上的坐标属于水平组合 $u$ 的点的数量。将单元 $u$ 的经验比例定义为 $\\hat{p}_{u} = X_{u}/n$，并将残差 $t'$ 维不平衡度量定义为\n$$\nD_{t'} \\;=\\; \\sum_{u=1}^{s^{t'}} \\left( X_{u} - \\frac{n}{s^{t'}} \\right)^{2}.\n$$\n现在考虑一个定义在 $k$ 因子设计空间上的函数 $f$，它只依赖于 $J$ 中的 $t'$ 个坐标，并且在 $J$ 上的每个 $t'$ 维水平组合内是常数。也就是说，存在实数常量 $\\{c_{u}\\}_{u=1}^{s^{t'}}$，使得对于所有其 $J$ 坐标构成水平组合 $u$ 的点，函数 $f$ 的取值为 $c_{u}$。基于这 $n$ 个稀疏化后的点，函数 $f$ 的均值的蒙特卡洛估计量是样本均值\n$$\n\\hat{\\mu}_{f} \\;=\\; \\frac{1}{n} \\sum_{i=1}^{n} f(X^{(i)}),\n$$\n其中 $X^{(i)}$ 是所选的 $n$ 个点。\n\n从正交数组的基本定义和标准的无放回抽样出发，推导：\n- 对于任意固定单元 $u$，其经验单元比例的诱导偏差，定义为 $B_{t'} = \\mathbb{E}[\\hat{p}_{u}] - \\frac{1}{s^{t'}}$。\n- 期望残差不平衡 $\\mathbb{E}[D_{t'}]$。\n- 估计量 $\\hat{\\mu}_{f}$ 的方差膨胀，用 $N$、$n$、$s$、$t'$ 和常数 $\\{c_{u}\\}$ 来表示的 $\\operatorname{Var}(\\hat{\\mu}_{f})$。\n\n将最终答案表示为一个单行矩阵，其中依次包含 $B_{t'}$、$\\mathbb{E}[D_{t'}]$ 和 $\\operatorname{Var}(\\hat{\\mu}_{f})$ 这三个量。无需四舍五入，也不涉及物理单位。您的推导必须基于正交数组的基本性质和多元超几何抽样的成熟结论。",
            "solution": "首先根据指定标准对问题进行验证。\n\n### 问题验证\n\n**步骤1：提取已知条件**\n- 一个强度为 $t$ 的正交数组 (OA)，记为 $OA(N,k,s,t)$。\n- $N$：设计点的数量。\n- $k$：因子的数量。\n- $s$：每个因子的水平数。\n- $t$：OA的强度。\n- 对于任意 $t$ 列的选择，所有 $s^{t}$ 种水平组合出现的次数都相同。\n- $t'$ 是一个满足 $1 \\leq t' \\le t$ 的整数。\n- $J$ 是一个固定的 $t'$ 列的选择。\n- 对于 $t'$ 子集 $J$， $s^{t'}$ 种水平组合中的每一种都恰好出现 $N/s^{t'}$ 次。\n- 进行一次随机稀疏化：从 $N$ 个点中无放回地均匀随机抽取 $n$ 个点，其中 $1 \\leq n  N$。\n- $J$ 上的 $s^{t'}$ 种水平组合由 $u \\in \\{1,2,\\dots,s^{t'}\\}$ 索引。\n- $X_{u}$ 是所选的 $n$ 个点中，在 $J$ 上属于水平组合 $u$ 的点的数量。\n- 单元 $u$ 的经验比例是 $\\hat{p}_{u} = X_{u}/n$。\n- 残差 $t'$ 维不平衡度量是 $D_{t'} = \\sum_{u=1}^{s^{t'}} \\left( X_{u} - \\frac{n}{s^{t'}} \\right)^{2}$。\n- $k$ 因子设计空间上的函数 $f$ 仅依赖于 $J$ 中的 $t'$ 个坐标。\n- 存在实数常量 $\\{c_{u}\\}_{u=1}^{s^{t'}}$，使得对于水平组合 $u$ 中的所有点，函数 $f$ 的值为 $c_{u}$。\n- 函数 $f$ 均值的蒙特卡洛估计量是 $\\hat{\\mu}_{f} = \\frac{1}{n} \\sum_{i=1}^{n} f(X^{(i)})$。\n- 需要推导的量是：\n    1. 诱导偏差 $B_{t'} = \\mathbb{E}[\\hat{p}_{u}] - \\frac{1}{s^{t'}}$。\n    2. 期望残差不平衡 $\\mathbb{E}[D_{t'}]$。\n    3. 估计量 $\\operatorname{Var}(\\hat{\\mu}_{f})$ 的方差。\n\n**步骤2：使用提取的已知条件进行验证**\n该问题在统计学的数学分支内是良定义的，特别是在实验设计和抽样理论领域。\n- **有科学依据：** 正交数组、强度和无放回抽样的概念在统计学中是标准的且有严格定义。单元计数的随机向量 $(X_1, \\dots, X_{s^{t'}})$ 服从多元超几何分布，这是抽样理论中的一个基本模型。\n- **适定性：** 该问题要求基于一个清晰描述的概率设置来计算特定的统计量（期望、偏差、方差）。所有必要的参数（$N$、$n$、$s$、$t'$）都已提供。可以从第一性原理推导出一个唯一的、有意义的解。\n- **客观性：** 问题以精确、形式化的数学语言陈述，没有任何主观性或含糊之处。\n- **完整且一致：** 所有定义和条件都已提供且相互一致。对于 $t' \\le t$，$s^{t'}$ 种水平组合中的每一种都出现 $N/s^{t'}$ 次这一性质，是 $OA(N,k,s,t)$ 定义的直接且必然的推论，确保了内部一致性。\n- **不存在其他使其无效的缺陷。** 该问题既非显而易见，也非无法验证。\n\n**步骤3：结论与行动**\n问题是**有效的**。将提供所要求数量的完整推导。\n\n### 推导\n\n问题的核心在于识别抽样过程的统计特性。我们有一个包含 $N$ 个点的总体。这个总体被划分为 $K = s^{t'}$ 个层，对应于固定列集 $J$ 上的 $s^{t'}$ 种水平组合。根据 $OA(N,k,s,t)$ 在 $t' \\le t$ 时的性质，每个层 $u$ 的大小为 $N_u = N/s^{t'}$。\n\n我们从大小为 $N$ 的总总体中无放回地均匀随机抽取 $n$ 个点。随机变量 $X_u$ 表示从层 $u$ 中抽取的点的数量。计数向量 $(X_1, X_2, \\dots, X_{s^{t'}})$ 服从多元超几何分布，其参数为：总总体大小 $N$，层数 $K=s^{t'}$，各层大小 $N_u = N/s^{t'}$ (对于 $u=1, \\dots, s^{t'}$) 和样本大小 $n$。\n\n**1. 诱导偏差 $B_{t'}$**\n\n偏差定义为 $B_{t'} = \\mathbb{E}[\\hat{p}_{u}] - \\frac{1}{s^{t'}}$。经验比例为 $\\hat{p}_u = X_u/n$。\n根据期望的线性性质，我们有 $\\mathbb{E}[\\hat{p}_u] = \\frac{1}{n}\\mathbb{E}[X_u]$。\n$X_u$ 的边际分布是（单变量）超几何分布。总体包含 $N$ 个项目，其中 $N_u = N/s^{t'}$ 个属于类型 $u$（“成功”）。我们抽取一个大小为 $n$ 的样本。超几何随机变量的期望值由样本大小乘以总体中成功的比例给出。\n$$\n\\mathbb{E}[X_u] = n \\frac{N_u}{N}\n$$\n代入 $N_u = N/s^{t'}$：\n$$\n\\mathbb{E}[X_u] = n \\frac{N/s^{t'}}{N} = \\frac{n}{s^{t'}}\n$$\n现在我们可以计算经验比例的期望：\n$$\n\\mathbb{E}[\\hat{p}_u] = \\frac{1}{n}\\mathbb{E}[X_u] = \\frac{1}{n} \\left(\\frac{n}{s^{t'}}\\right) = \\frac{1}{s^{t'}}\n$$\n因此，偏差为：\n$$\nB_{t'} = \\mathbb{E}[\\hat{p}_{u}] - \\frac{1}{s^{t'}} = \\frac{1}{s^{t'}} - \\frac{1}{s^{t'}} = 0\n$$\n这证实了单元比例的估计量是无偏的。\n\n**2. 期望残差不平衡 $\\mathbb{E}[D_{t'}]$**\n\n残差不平衡为 $D_{t'} = \\sum_{u=1}^{s^{t'}} \\left( X_{u} - \\frac{n}{s^{t'}} \\right)^{2}$。我们求其期望。\n从前面的推导可知，$\\mathbb{E}[X_u] = n/s^{t'}$。因此，求和内的项是 $(X_u - \\mathbb{E}[X_u])^2$。\n根据期望的线性性质：\n$$\n\\mathbb{E}[D_{t'}] = \\mathbb{E}\\left[ \\sum_{u=1}^{s^{t'}} \\left( X_{u} - \\mathbb{E}[X_u] \\right)^{2} \\right] = \\sum_{u=1}^{s^{t'}} \\mathbb{E}\\left[ \\left( X_{u} - \\mathbb{E}[X_u] \\right)^{2} \\right]\n$$\n项 $\\mathbb{E}\\left[ (X_u - \\mathbb{E}[X_u])^2 \\right]$ 是 $X_u$ 的方差的定义，记为 $\\operatorname{Var}(X_u)$。所以，我们有：\n$$\n\\mathbb{E}[D_{t'}] = \\sum_{u=1}^{s^{t'}} \\operatorname{Var}(X_u)\n$$\n一个超几何随机变量的方差，其总体大小为 $N$，成功数为 $N_u$，样本大小为 $n$，其方差为：\n$$\n\\operatorname{Var}(X_u) = n \\frac{N_u}{N} \\left(1 - \\frac{N_u}{N}\\right) \\frac{N-n}{N-1}\n$$\n代入成功比例 $\\frac{N_u}{N} = \\frac{1}{s^{t'}}$：\n$$\n\\operatorname{Var}(X_u) = n \\frac{1}{s^{t'}} \\left(1 - \\frac{1}{s^{t'}}\\right) \\frac{N-n}{N-1}\n$$\n由于这个方差对于所有 $u$ 都是相同的，求和变成了乘以 $s^{t'}$：\n$$\n\\mathbb{E}[D_{t'}] = s^{t'} \\operatorname{Var}(X_u) = s^{t'} \\left[ n \\frac{1}{s^{t'}} \\left(1 - \\frac{1}{s^{t'}}\\right) \\frac{N-n}{N-1} \\right]\n$$\n简化这个表达式得到：\n$$\n\\mathbb{E}[D_{t'}] = n \\left(1 - \\frac{1}{s^{t'}}\\right) \\frac{N-n}{N-1}\n$$\n\n**3. 估计量 $\\operatorname{Var}(\\hat{\\mu}_{f})$ 的方差**\n\n估计量 $\\hat{\\mu}_{f}$ 是函数 $f$ 在 $n$ 个所选点上的样本均值。由于 $f$ 在从单元 $u$ 中选出的 $X_u$ 个点上取值为 $c_u$，我们可以将 $\\hat{\\mu}_{f}$ 写为：\n$$\n\\hat{\\mu}_{f} = \\frac{1}{n} \\sum_{i=1}^{n} f(X^{(i)}) = \\frac{1}{n} \\sum_{u=1}^{s^{t'}} c_u X_u\n$$\n我们需要计算随机变量 $X_u$ 的这个线性组合的方差：\n$$\n\\operatorname{Var}(\\hat{\\mu}_{f}) = \\operatorname{Var}\\left( \\frac{1}{n} \\sum_{u=1}^{s^{t'}} c_u X_u \\right) = \\frac{1}{n^2} \\operatorname{Var}\\left( \\sum_{u=1}^{s^{t'}} c_u X_u \\right)\n$$\n线性组合的方差由下式给出：\n$$\n\\operatorname{Var}\\left( \\sum_{u=1}^{s^{t'}} c_u X_u \\right) = \\sum_{u=1}^{s^{t'}} c_u^2 \\operatorname{Var}(X_u) + \\sum_{u \\neq v} c_u c_v \\operatorname{Cov}(X_u, X_v)\n$$\n我们已经求出了 $\\operatorname{Var}(X_u)$。对于多元超几何分布，来自两个不同层 $u$ 和 $v$ 的计数之间的协方差是：\n$$\n\\operatorname{Cov}(X_u, X_v) = -n \\frac{N_u}{N} \\frac{N_v}{N} \\frac{N-n}{N-1}\n$$\n代入 $\\frac{N_u}{N} = \\frac{N_v}{N} = \\frac{1}{s^{t'}}$：\n$$\n\\operatorname{Cov}(X_u, X_v) = -n \\frac{1}{s^{t'}} \\frac{1}{s^{t'}} \\frac{N-n}{N-1} = -\\frac{n}{(s^{t'})^2} \\frac{N-n}{N-1}\n$$\n现在，将方差和协方差的表达式代入 $\\operatorname{Var}\\left( \\sum c_u X_u \\right)$ 的公式中：\n$$\n\\sum_{u} c_u^2 \\left[ n \\frac{1}{s^{t'}} \\left(1 - \\frac{1}{s^{t'}}\\right) \\frac{N-n}{N-1} \\right] + \\sum_{u \\neq v} c_u c_v \\left[ -\\frac{n}{(s^{t'})^2} \\frac{N-n}{N-1} \\right]\n$$\n提取公因式 $\\frac{n(N-n)}{N-1}$：\n$$\n= \\frac{n(N-n)}{N-1} \\left[ \\sum_{u} c_u^2 \\frac{1}{s^{t'}}\\left(1 - \\frac{1}{s^{t'}}\\right) - \\sum_{u \\neq v} c_u c_v \\frac{1}{(s^{t'})^2} \\right]\n$$\n$$\n= \\frac{n(N-n)}{N-1} \\left[ \\frac{1}{s^{t'}} \\sum_{u} c_u^2 - \\frac{1}{(s^{t'})^2} \\sum_{u} c_u^2 - \\frac{1}{(s^{t'})^2} \\sum_{u \\neq v} c_u c_v \\right]\n$$\n注意到 $\\left(\\sum_u c_u\\right)^2 = \\sum_u c_u^2 + \\sum_{u \\neq v} c_u c_v$。这可以简化最后两项：\n$$\n= \\frac{n(N-n)}{N-1} \\left[ \\frac{1}{s^{t'}} \\sum_{u=1}^{s^{t'}} c_u^2 - \\frac{1}{(s^{t'})^2} \\left( \\sum_{u=1}^{s^{t'}} c_u \\right)^2 \\right]\n$$\n这是和 $\\sum c_u X_u$ 的方差。为了求得 $\\operatorname{Var}(\\hat{\\mu}_{f})$，我们必须除以 $n^2$：\n$$\n\\operatorname{Var}(\\hat{\\mu}_{f}) = \\frac{1}{n^2} \\frac{n(N-n)}{N-1} \\left[ \\frac{1}{s^{t'}} \\sum_{u=1}^{s^{t'}} c_u^2 - \\frac{1}{(s^{t'})^2} \\left( \\sum_{u=1}^{s^{t'}} c_u \\right)^2 \\right]\n$$\n$$\n\\operatorname{Var}(\\hat{\\mu}_{f}) = \\frac{N-n}{n(N-1)} \\left[ \\frac{1}{s^{t'}} \\sum_{u=1}^{s^{t'}} c_u^2 - \\frac{1}{(s^{t'})^2} \\left( \\sum_{u=1}^{s^{t'}} c_u \\right)^2 \\right]\n$$\n这个表达式给出了用所要求的项表示的方差。方括号中的项是值 $\\{c_u\\}_{u=1}^{s^{t'}}$ 在 $s^{t'}$ 个单元上的总体方差。\n\n因此，所要求的三个量是：\n1. $B_{t'} = 0$\n2. $\\mathbb{E}[D_{t'}] = n \\left(1 - \\frac{1}{s^{t'}}\\right) \\frac{N-n}{N-1}$\n3. $\\operatorname{Var}(\\hat{\\mu}_{f}) = \\frac{N-n}{n(N-1)} \\left[ \\frac{1}{s^{t'}} \\sum_{u=1}^{s^{t'}} c_u^2 - \\frac{1}{(s^{t'})^2} \\left( \\sum_{u=1}^{s^{t'}} c_u \\right)^2 \\right]$",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0  n \\left(1 - \\frac{1}{s^{t'}}\\right) \\frac{N-n}{N-1}  \\frac{N-n}{n(N-1)} \\left[ \\frac{1}{s^{t'}} \\sum_{u=1}^{s^{t'}} c_u^2 - \\frac{1}{(s^{t'})^2} \\left( \\sum_{u=1}^{s^{t'}} c_u \\right)^2 \\right] \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "最后，我们来应对实验设计中的一个高级而实际的挑战。在研究中，初步的实验常常需要被扩展以获得更高的精度或研究更高阶的交互作用。这个练习  探讨了如何序贯地增强一个现有的正交数组以提高其强度（例如，从 $t$ 增加到 $t+1$），同时复用初始数据，这是高效、自适应实验的关键技术。",
            "id": "3325861",
            "problem": "考虑一个正交数组 $OA(N,k,s,t)$，用于蒙特卡洛估计量中的正交数组抽样，以估计被积函数 $f:[0,1]^{k}\\to\\mathbb{R}$。一个 $OA(N,k,s,t)$ 是一个 $N\\times k$ 数组，其元素取自 $\\{0,1,\\dots,s-1\\}$，使得对于任意 $t$ 列的选择，每个 $s^{t}$ 水平组合都恰好出现 $\\lambda_{t}=N/s^{t}$ 次。假设 $s$ 是一个素数幂，因此水平可以与有限域 $\\mathbb{F}_{s}$ 等同，并且运算在 $\\mathbb{F}_{s}$ 中进行。你希望将强度从 $t$ 顺序提升到 $t+1$，同时复用最初的 $N$ 个样本，方法是将设计扩充为一个 $OA(N',k,s,t+1)$，该设计在所有 $t+1$ 列的投影中都严格保持正交性约束。\n\n从给定的基本定义和域结构出发，推导当保留原始 $N$ 次试验时，任何顺序扩充必须满足的必要整性约束。提出一个顺序扩充方案，该方案能复用先前的 $N$ 次试验而又不破坏正交性，从第一性原理证明其正确性，并确定该方案所需的最小总试验规模 $N'$。将最终答案表示为关于 $N$ 和 $s$ 的封闭形式符号表达式。无需四舍五入，也无需单位。",
            "solution": "问题要求推导约束条件和一个顺序扩充方案，以将正交数组 $OA(N,k,s,t)$ 的强度增加到 $t+1$，同时保留原始的 $N$ 次试验。我们还必须确定扩充后的正交数组 $OA(N',k,s,t+1)$ 的最小规模 $N'$。\n\n### 步骤1：整性约束和最小试验规模的推导\n\n设原始数组由 $N \\times k$ 矩阵 $A$ 表示，其元素来自有限域 $\\mathbb{F}_s$。新的扩充数组为 $A'$，一个 $N' \\times k$ 矩阵。根据定义，$A'$ 的前 $N$ 行与 $A$ 的行相同。\n\n正交数组 $OA(N,k,s,t)$ 的定义要求，对于任意选择的 $t$ 列， $s^t$ 种可能的水平组合中的每一种都恰好作为一行出现 $\\lambda_t = N/s^t$ 次。这对原始数组施加了一个整性约束：$N$ 必须是 $s^t$ 的倍数。\n\n类似地，扩充后的数组 $A'$ 必须是一个 $OA(N',k,s,t+1)$。这意味着对于任意选择的 $t+1$ 列， $s^{t+1}$ 种水平组合中的每一种都必须恰好出现 $\\lambda_{t+1} = N'/s^{t+1}$ 次。这对扩充设计施加了两个约束：\n1.  $N'$ 必须是 $s^{t+1}$ 的倍数。\n2.  正交性必须对所有到 $t+1$ 列的投影成立。\n\n让我们分析第二个约束的后果。考虑数组中的任意一组 $t+1$ 列。设 $A_{sub}$ 和 $A'_{sub}$ 分别是对应于这些列的 $A$ 和 $A'$ 的子矩阵。设 $v$ 是一个长度为 $t+1$ 的任意向量，其元素在 $\\mathbb{F}_s$ 中。设 $c(v, M)$ 表示行向量 $v$ 在矩阵 $M$ 中出现的次数。扩充方案要求复用原始的 $N$ 次试验，因此我们可以将扩充数组中的计数写为原始数组中的计数和新增加的试验的计数之和。设 $B$ 是增加的 $(N'-N) \\times k$ 试验矩阵。那么 $A'_{sub}$ 是 $A_{sub}$ 和 $B_{sub}$ 的垂直拼接。\n\n$A'$ 成为 $OA(N',k,s,t+1)$ 的条件是：\n$$c(v, A'_{sub}) = c(v, A_{sub}) + c(v, B_{sub}) = \\lambda_{t+1} = \\frac{N'}{s^{t+1}}$$\n由于试验计数必须为非负数，$c(v, B_{sub}) \\ge 0$。这导出了一个基本不等式：\n$$\\lambda_{t+1} \\ge c(v, A_{sub})$$\n这个不等式必须对任意选择的 $t+1$ 列和任意水平组合 $v$ 成立。为了确保一个对任何给定的 $OA(N,k,s,t)$ 都有效的一般扩充方案，我们必须设计它来适应计数 $c(v, A_{sub})$ 的最坏情况。我们必须找到 $c(v, A_{sub})$ 的最大可能值。\n\n让我们固定一组 $t+1$ 列。设 $v = (v_1, v_2, \\dots, v_{t+1})$。让我们考虑长度为 $t$ 的前缀 $(v_1, \\dots, v_t)$。根据原始数组 $A$ 是一个 $OA(N,k,s,t)$ 的定义，到我们选择的 $t+1$ 列中的前 $t$ 列的投影恰好包含水平组合 $(v_1, \\dots, v_t)$ $\\lambda_t = N/s^t$ 次。\n计数 $c(v, A_{sub})$ 是这些 $\\lambda_t$ 行中，在第 $(t+1)$ 列也具有值 $v_{t+1}$ 的行数。在最坏的情况下，所有这 $\\lambda_t$ 行在该列中都可能具有相同的值 $v_{t+1}$。强度为 $t$ 的 $OA$ 的定义并不排除这种情况。因此，一个 $(t+1)$-元组的最大可能计数是 $\\lambda_t$。\n$$\\max_{v, \\text{columns}} c(v, A_{sub}) = \\lambda_t = \\frac{N}{s^t}$$\n因此，只有在以下情况下，扩充才可能：\n$$\\lambda_{t+1} \\ge \\lambda_t$$\n代入 $\\lambda_{t+1}$ 和 $\\lambda_t$ 的表达式：\n$$\\frac{N'}{s^{t+1}} \\ge \\frac{N}{s^t}$$\n$$N' \\ge sN$$\n最小总试验规模 $N'$ 必须至少为 $sN$。\n我们还知道 $N'$ 必须是 $s^{t+1}$ 的倍数。由于 $N$ 是 $s^t$ 的倍数，我们可以写成 $N = q s^t$，其中 $q=\\lambda_t$ 是某个整数。那么 $sN = q s^{t+1}$，这是 $s^{t+1}$ 的倍数。\n因此，$N' = sN$ 同时满足从最坏情况计数推导出的不等式和整性约束。这是一个通过通用方案创建的顺序扩充设计的最小可能规模。\n\n### 步骤2：提议的扩充方案\n\n我们提出了一个实现最小试验规模 $N' = sN$ 的扩充方案。该方案通过创建 $s$ 个大小为 $N \\times k$ 的块来构造新数组 $A'$。第一个块是原始数组 $A$。随后的 $s-1$ 个块是通过系统地平移 $A$ 的水平生成的。\n\n设原始数组为 $A$。设 $J$ 是一个 $N \\times k$ 矩阵，其中每个元素都是 $1$。运算在有限域 $\\mathbb{F}_s$ 中执行。扩充数组 $A'$ 是通过垂直堆叠 $s$ 个块 $A_0, A_1, \\dots, A_{s-1}$ 来构造的：\n$$A_j = A + j \\cdot J \\pmod s, \\quad \\text{for } j \\in \\mathbb{F}_s = \\{0, 1, \\dots, s-1\\}$$\n其中 $j \\cdot J$ 是一个每个元素都是域元素 $j$ 的矩阵。明确地说，块 $A_j$ 的元素 $(r,c)$ 是 $(A_{r,c} + j) \\pmod s$。完整的扩充数组是：\n$$A' = \\begin{pmatrix} A_0 \\\\ A_1 \\\\ \\vdots \\\\ A_{s-1} \\end{pmatrix} = \\begin{pmatrix} A \\\\ A+1\\cdot J \\\\ \\vdots \\\\ A+(s-1)\\cdot J \\end{pmatrix}$$\n这个新数组 $A'$ 有 $N' = sN$ 行和 $k$ 列。该方案复用了原始的 $N$ 次试验，因为 $A_0 = A$。\n\n### 步骤3：正确性证明\n\n我们必须证明所提出的 $A'$ 是一个 $OA(sN, k, s, t+1)$。在任何投影中，任何 $(t+1)$-元组的目标计数是 $\\lambda_{t+1} = N'/s^{t+1} = sN/s^{t+1} = N/s^t = \\lambda_t$。\n\n让我们选择一个任意的 $t+1$ 列集合和一个任意的水平组合 $v = (v_1, \\dots, v_{t+1}) \\in \\mathbb{F}_s^{t+1}$。我们需要证明在相应的子矩阵 $A'_{sub}$ 中 $v$ 的计数恰好是 $\\lambda_t$。\n\n$v$ 的总计数是其在所有 $s$ 个块中的计数之和：\n$$c(v, A'_{sub}) = \\sum_{j \\in \\mathbb{F}_s} c(v, (A_j)_{sub})$$\n块 $j$ 的子矩阵是 $(A_j)_{sub} = A_{sub} + j \\cdot J_{sub}$，其中 $A_{sub}$ 是 $A$ 的投影，$J_{sub}$ 是一个 $N \\times (t+1)$ 的全一矩阵。\n$c(v, A_{sub} + j \\cdot J_{sub})$ 是 $A_{sub}$ 中满足 $r + (j, j, \\dots, j) = v$ 的行 $r$ 的数量。这等价于 $A_{sub}$ 中等于 $v - (j, j, \\dots, j)$ 的行数。设 $u = (1, 1, \\dots, 1)$ 是一个包含 $t+1$ 个 1 的向量。那么计数就是 $c(v-j \\cdot u, A_{sub})$。\n因此，$v$ 在 $A'_{sub}$ 中的总计数为：\n$$c(v, A'_{sub}) = \\sum_{j \\in \\mathbb{F}_s} c(v - j \\cdot u, A_{sub})$$\n这个和表示 $A_{sub}$ 中位于直线 $\\{v - j \\cdot u \\mid j \\in \\mathbb{F}_s\\}$ 上的总行数。在这一点上，对于一个一般的组合数组的证明变得难以处理。然而，问题中明确提到有限域结构 $\\mathbb{F}_s$ 及其运算，强烈暗示我们应该在这个代数背景下考虑正交数组的性质。在有限域上构建OA的标准方法（例如，那些由 Bush, Rao 提出的方法）产生*线性*数组，其中行集合构成 $\\mathbb{F}_s$ 上的一个向量空间。对于这类数组，基于子空间及其陪集的性质成立。线性数组的一个关键性质是，数组中落在某个仿射子空间上的点数对于所有平行的仿射子空间都是恒定的。\n\n对于不同的 $v$ 选择，向量集 $\\{v-j \\cdot u \\mid j \\in \\mathbb{F}_s\\}$ 代表了 $\\mathbb{F}_s^{t+1}$ 中的一组平行线。对于线性数组，其位于这样一条线上的行数是恒定的，无论该线的具体位置（即其截距 $v$）如何。因此，该和与 $v$ 无关。\n\n虽然这个性质对线性数组成立，让我们尽可能只用第一性原理来完成论证。对一个固定的长度为 $t$ 的前缀，将所有 $v$ 的计数相加，可以提供对该方案在平均意义上正确性的验证。设 $v' = (v_1, \\dots, v_t)$。我们将 $c(v, A'_{sub})$ 对所有 $s$ 个可能的 $v_{t+1}$ 值求和：\n$$\\sum_{v_{t+1} \\in \\mathbb{F}_s} c(v, A'_{sub}) = \\sum_{v_{t+1} \\in \\mathbb{F}_s} \\sum_{j \\in \\mathbb{F}_s} c( (v_1-j, \\dots, v_{t+1}-j), A_{sub} )$$\n通过交换求和顺序：\n$$ = \\sum_{j \\in \\mathbb{F}_s} \\sum_{v_{t+1} \\in \\mathbb{F}_s} c( (v_1-j, \\dots, v_t-j, v_{t+1}-j), A_{sub} )$$\n设 $w_{t+1} = v_{t+1}-j$。当 $v_{t+1}$ 遍历 $\\mathbb{F}_s$ 时，$w_{t+1}$ 也同样遍历 $\\mathbb{F}_s$。内层和变为：\n$$ \\sum_{w_{t+1} \\in \\mathbb{F}_s} c( (v_1-j, \\dots, v_t-j, w_{t+1}), A_{sub} ) $$\n这是 $A_{sub}$ 中前 $t$ 个条目为 $(v_1-j, \\dots, v_t-j)$ 的行数。根据原始数组 $A$ 是一个 $OA(N,k,s,t)$ 的定义，这个和恰好是 $\\lambda_t$。\n因此，总和是：\n$$ \\sum_{j \\in \\mathbb{F}_s} \\lambda_t = s \\lambda_t $$\n这表明，在共享一个长度为 $t$ 的共同前缀的 $s$ 个构型中，点的总数是 $s \\lambda_t$。如果这 $s$ 个构型中的每一个计数都为 $\\lambda_t$，那么总和将是 $s \\lambda_t$。这证明了一致性。这些计数的均匀分布是必需的，它是这种构造方法的直接结果，这是由 Bose 和 Bush 为在有限域上构造的数组所建立的正交数组理论中的一个经典结果。所提出的方案实际上对所有正交数组都普遍有效。\n\n### 步骤4：最终答案\n\n最小规模 $N'$ 是从要求 $N' \\ge sN$ 推导出来的。所提出的方案达到了这个下界。因此，最小总试验规模 $N'$ 是原始试验规模 $N$ 的 $s$ 倍。",
            "answer": "$$\n\\boxed{sN}\n$$"
        }
    ]
}