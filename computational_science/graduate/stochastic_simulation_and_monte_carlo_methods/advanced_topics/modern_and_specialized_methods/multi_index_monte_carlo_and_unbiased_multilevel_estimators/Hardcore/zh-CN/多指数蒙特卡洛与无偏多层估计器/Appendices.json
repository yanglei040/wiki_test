{
    "hands_on_practices": [
        {
            "introduction": "多层蒙特卡洛 (MLMC) 方法的强大之处在于它能够在减少偏差（使用高分辨率层级）和控制方差（在计算成本低的低分辨率层级上使用大量样本）之间实现最佳平衡。本练习将引导您完成 MLMC 计算复杂度的基本推导，展示如何在给定精度目标 $\\varepsilon$ 下最小化计算工作量。这个推导是理解 MLMC 方法为何高效的核心，它揭示了弱误差、强误差和计算成本的收敛速度如何共同决定了方法的整体效率。",
            "id": "3321906",
            "problem": "考虑一个离散近似序列 $\\{Y_{l}\\}_{l \\in \\mathbb{N}_{0}}$，它是对一个具有有限均值的目标随机变量 $X$ 的近似，通过在每个层级 $l$ 上以加密因子 $2$ 加密网格而构建。假设以下标准速率条件成立，其中 $c_{w}$、$c_{s}$ 和 $c_{c}$ 为正常数，$\\alpha$、$\\beta$ 和 $\\gamma$ 为指数：\n- 弱误差（偏差）率：对所有 $l$，有 $|\\mathbb{E}[Y_{l} - X]| \\leq c_{w} \\, 2^{-\\alpha l}$。\n- 强误差（层级差分方差）率：在连续层级的忠实耦合下，对所有 $l \\geq 1$，有 $\\mathbb{V}\\mathrm{ar}(Y_{l} - Y_{l-1}) \\leq c_{s} \\, 2^{-\\beta l}$，且 $\\mathbb{V}\\mathrm{ar}(Y_{0}) \\leq c_{s}$。\n- 层级 $l$ 上每个样本的工作量（成本）：对所有 $l$，有 $C_{l} = c_{c} \\, 2^{\\gamma l}$。\n\n将最大层级为 $L$ 的多层蒙特卡罗（MLMC）估计量 $\\widehat{Q}$ 通过跨层级独立抽样的伸缩求和定义如下：\n$$\n\\widehat{Q} \\;=\\; \\sum_{l=0}^{L} \\frac{1}{n_{l}} \\sum_{i=1}^{n_{l}} \\Delta_{l}^{(i)}, \\quad \\text{where} \\quad \\Delta_{0} := Y_{0}, \\;\\; \\Delta_{l} := Y_{l} - Y_{l-1} \\;\\; \\text{for} \\;\\; l \\geq 1,\n$$\n其中 $n_{l} \\in \\mathbb{N}$ 表示层级 $l$ 上的蒙特卡罗样本数量。设均方误差（MSE）为 $\\mathbb{E}\\big[(\\widehat{Q} - \\mathbb{E}[X])^{2}\\big] = \\mathrm{bias}^{2} + \\mathrm{variance}$，其中偏差由 $\\mathbb{E}[Y_{L} - X]$ 给出，方差在跨层级独立的条件下由 $\\sum_{l=0}^{L} \\mathbb{V}\\mathrm{ar}(\\Delta_{l})/n_{l}$ 给出。\n\n给定具体的参数值 $\\alpha = 2$、$\\beta = 3$、$\\gamma = 1$、$c_{w} = 3$、$c_{s} = 2$ 和 $c_{c} = 5$。对于一个预设的精度目标 $\\varepsilon \\in (0,1)$，请仅使用偏差-方差分解、上述速率假设以及约束优化的第一性原理，设计当 $\\varepsilon \\to 0$ 时的渐近最优 MLMC 配置 $(L, \\{n_{l}\\}_{l=0}^{L})$。选择 $L$ 和 $\\{n_{l}\\}$ 使得 MSE 至多为 $\\varepsilon^{2}$，方法是将相等的误差预算分配给偏差平方和方差。然后，确定最小预期计算工作量 $\\mathbb{E}[\\mathcal{W}]$ 作为 $\\varepsilon$ 的函数的前导阶渐近表达式，其形式为 $K \\, \\varepsilon^{-2}$，其中 $K$ 是一个仅依赖于 $c_{w}$、$c_{s}$、$c_{c}$、$\\alpha$、$\\beta$ 和 $\\gamma$ 的常数。提供当 $\\varepsilon \\to 0$ 时 $\\mathbb{E}[\\mathcal{W}]$ 的前导阶简化解析表达式。最终答案必须是单个解析表达式；不要包含单位。",
            "solution": "我们从多层蒙特卡罗（MLMC）估计量 $\\widehat{Q}$ 的均方误差（MSE）分解开始：\n$$\n\\mathbb{E}\\big[(\\widehat{Q} - \\mathbb{E}[X])^{2}\\big] \\;=\\; \\big(\\mathbb{E}[Y_{L} - X]\\big)^{2} \\;+\\; \\sum_{l=0}^{L} \\frac{\\mathbb{V}\\mathrm{ar}(\\Delta_{l})}{n_{l}},\n$$\n其中 $\\Delta_{0} := Y_{0}$ 且对 $l \\geq 1$ 有 $\\Delta_{l} := Y_{l} - Y_{l-1}$，并且跨层级进行独立抽样。预期的工作量为\n$$\n\\mathbb{E}[\\mathcal{W}] \\;=\\; \\sum_{l=0}^{L} n_{l} \\, C_{l}.\n$$\n我们已知速率假设\n$$\n|\\mathbb{E}[Y_{l} - X]| \\leq c_{w} \\, 2^{-\\alpha l}, \\quad \\mathbb{V}\\mathrm{ar}(\\Delta_{l}) \\leq c_{s} \\, 2^{-\\beta l} \\;\\; (l \\geq 1), \\;\\; \\mathbb{V}\\mathrm{ar}(\\Delta_{0}) \\leq c_{s}, \\quad C_{l} = c_{c} \\, 2^{\\gamma l}.\n$$\n使用具体值 $\\alpha = 2$、$\\beta = 3$、$\\gamma = 1$、$c_{w} = 3$、$c_{s} = 2$、$c_{c} = 5$，对所有 $l \\geq 1$，我们有\n$$\n\\mathbb{V}\\mathrm{ar}(\\Delta_{l}) \\leq 2 \\cdot 2^{-3l}, \\quad C_{l} = 5 \\cdot 2^{l}.\n$$\n我们将相等的误差预算分配给偏差平方和方差：\n$$\n\\big(\\mathbb{E}[Y_{L} - X]\\big)^{2} \\leq \\frac{\\varepsilon^{2}}{2}, \\qquad \\sum_{l=0}^{L} \\frac{\\mathbb{V}\\mathrm{ar}(\\Delta_{l})}{n_{l}} \\leq \\frac{\\varepsilon^{2}}{2}.\n$$\n首先，我们选择最大层级 $L$ 以满足基于弱误差率的偏差约束：\n$$\n|\\mathbb{E}[Y_{L} - X]| \\leq c_{w} \\, 2^{-\\alpha L} \\leq \\frac{\\varepsilon}{\\sqrt{2}}.\n$$\n这得到\n$$\n2^{-\\alpha L} \\leq \\frac{\\varepsilon}{\\sqrt{2}\\, c_{w}} \\;\\;\\Longleftrightarrow\\;\\; L \\geq \\frac{1}{\\alpha} \\log_{2}\\!\\left(\\frac{\\sqrt{2}\\, c_{w}}{\\varepsilon}\\right).\n$$\n当 $\\alpha = 2$ 且 $c_{w} = 3$ 时，一个方便的渐近最优选择是\n$$\nL \\;=\\; \\left\\lceil \\frac{1}{2} \\log_{2}\\!\\left(\\frac{3\\sqrt{2}}{\\varepsilon}\\right) \\right\\rceil,\n$$\n这确保了偏差平方至多为 $\\varepsilon^{2}/2$。\n\n其次，我们优化配置 $\\{n_{l}\\}_{l=0}^{L}$ 以在满足方差约束的条件下最小化工作量。令 $V_{l} := \\mathbb{V}\\mathrm{ar}(\\Delta_{l})$ 并回顾 $C_{l}$ 是每个样本的成本。我们求解\n$$\n\\min_{\\{n_{l} \\geq 1\\}} \\sum_{l=0}^{L} n_{l} C_{l} \\quad \\text{subject to} \\quad \\sum_{l=0}^{L} \\frac{V_{l}}{n_{l}} \\leq \\frac{\\varepsilon^{2}}{2}.\n$$\n将 $n_{l}$ 松弛为正实数并使用拉格朗日乘子 $\\lambda  0$，拉格朗日函数为\n$$\n\\mathcal{L}(\\{n_{l}\\},\\lambda) \\;=\\; \\sum_{l=0}^{L} n_{l} C_{l} \\;+\\; \\lambda\\!\\left(\\sum_{l=0}^{L} \\frac{V_{l}}{n_{l}} - \\frac{\\varepsilon^{2}}{2}\\right).\n$$\n关于 $n_{l}$ 的平稳性条件给出\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial n_{l}} \\;=\\; C_{l} \\;-\\; \\lambda \\frac{V_{l}}{n_{l}^{2}} \\;=\\; 0 \\;\\;\\Longrightarrow\\;\\; n_{l} \\;=\\; \\sqrt{\\lambda} \\, \\sqrt{\\frac{V_{l}}{C_{l}}}.\n$$\n施加等式形式的方差约束得到\n$$\n\\sum_{l=0}^{L} \\frac{V_{l}}{n_{l}} \\;=\\; \\sum_{l=0}^{L} \\frac{V_{l}}{\\sqrt{\\lambda} \\, \\sqrt{V_{l}/C_{l}}} \\;=\\; \\frac{1}{\\sqrt{\\lambda}} \\sum_{l=0}^{L} \\sqrt{V_{l} C_{l}} \\;=\\; \\frac{\\varepsilon^{2}}{2}.\n$$\n因此\n$$\n\\sqrt{\\lambda} \\;=\\; \\frac{2}{\\varepsilon^{2}} \\sum_{l=0}^{L} \\sqrt{V_{l} C_{l}}.\n$$\n相应的最小预期工作量是\n$$\n\\mathbb{E}[\\mathcal{W}]_{\\min} \\;=\\; \\sum_{l=0}^{L} n_{l} C_{l} \\;=\\; \\sum_{l=0}^{L} \\left(\\sqrt{\\lambda} \\, \\sqrt{\\frac{V_{l}}{C_{l}}}\\right) C_{l} \\;=\\; \\sqrt{\\lambda} \\sum_{l=0}^{L} \\sqrt{V_{l} C_{l}} \\;=\\; \\frac{2}{\\varepsilon^{2}} \\left(\\sum_{l=0}^{L} \\sqrt{V_{l} C_{l}}\\right)^{2}.\n$$\n现在我们使用给定的速率来评估这个和。对于 $l \\geq 1$，$V_{l} \\leq 2 \\cdot 2^{-3l}$ 且 $C_{l} = 5 \\cdot 2^{l}$，所以\n$$\n\\sqrt{V_{l} C_{l}} \\;\\leq\\; \\sqrt{(2 \\cdot 2^{-3l}) (5 \\cdot 2^{l})} \\;=\\; \\sqrt{10} \\, 2^{-(3-1)l/2} \\;=\\; \\sqrt{10} \\, 2^{-l}.\n$$\n对于 $l = 0$，$V_{0} \\leq 2$ 且 $C_{0} = 5$，因此 $\\sqrt{V_{0} C_{0}} \\leq \\sqrt{10}$。所以，\n$$\n\\sum_{l=0}^{L} \\sqrt{V_{l} C_{l}} \\;\\leq\\; \\sqrt{10} \\sum_{l=0}^{L} 2^{-l} \\;=\\; \\sqrt{10} \\, \\frac{1 - 2^{-(L+1)}}{1 - 2^{-1}} \\;=\\; 2 \\sqrt{10} \\, \\big(1 - 2^{-(L+1)}\\big).\n$$\n当 $\\varepsilon \\to 0$ 时，我们有 $L \\to \\infty$，且几何级数尾项 $2^{-(L+1)} \\to 0$。因此，到前导阶，\n$$\n\\sum_{l=0}^{L} \\sqrt{V_{l} C_{l}} \\;\\sim\\; 2 \\sqrt{10}.\n$$\n代入最小工作量表达式，我们得到前导阶渐近式\n$$\n\\mathbb{E}[\\mathcal{W}]_{\\min} \\;\\sim\\; \\frac{2}{\\varepsilon^{2}} \\left(2 \\sqrt{10}\\right)^{2} \\;=\\; \\frac{2}{\\varepsilon^{2}} \\cdot 4 \\cdot 10 \\;=\\; \\frac{80}{\\varepsilon^{2}}, \\quad \\text{as } \\varepsilon \\to 0.\n$$\n我们验证区域的一致性：由于 $\\beta = 3  \\gamma = 1$，几何比率 $2^{-(\\beta - \\gamma)/2} = 2^{-1}$ 严格小于 $1$，这意味着和 $\\sum_{l \\geq 0} \\sqrt{V_{l} C_{l}}$ 收敛，因此最优 MLMC 复杂度如推导的那样按 $\\varepsilon^{-2}$ 比例缩放，没有对数惩罚项。\n\n最后，偏差选择 $L = \\lceil \\frac{1}{2} \\log_{2}(\\frac{3\\sqrt{2}}{\\varepsilon}) \\rceil$ 的贡献仅通过可忽略的几何尾项影响低阶项，而前导常数保持不变。因此，前导阶的最小预期计算工作量为\n$$\n\\mathbb{E}[\\mathcal{W}]_{\\min} \\;\\sim\\; \\frac{80}{\\varepsilon^{2}} \\quad \\text{as } \\varepsilon \\to 0.\n$$\n这就完成了从偏差-方差分解、离散化速率和约束优化出发的推导。",
            "answer": "$$\\boxed{\\frac{80}{\\varepsilon^{2}}}$$"
        },
        {
            "introduction": "在理解了最优复杂度的理论之后，一个实际问题随之而来：我们应该如何将有限的计算预算分配到不同的层级或多重指标上？本练习将使用标准的拉格朗日乘子法来解决这个核心的实施问题，展示如何在固定成本下分配样本以最小化估计器的方差。掌握这种资源分配策略是将在 MLMC 或多指数蒙特卡洛 (MIMC) 方法付诸实践的关键一步。",
            "id": "3321940",
            "problem": "考虑一个有限多指标集 $\\mathcal{I}$，其中每个多指标 $\\alpha \\in \\mathcal{I}$ 标记一个用于多指标蒙特卡洛 (MIMC) 和无偏多层估计量的独立增量随机变量 $\\Delta_{\\alpha}$。对于每个 $\\alpha \\in \\mathcal{I}$，给定两个正参数：每个样本的计算成本 $\\kappa_{\\alpha}  0$ 和方差 $\\mathbb{V}[\\Delta_{\\alpha}] = v_{\\alpha} \\ge 0$。假设您构建一个全局目标量的无偏估计量，该估计量是各指标上独立样本均值的加权和，其中对指标 $\\alpha$ 使用 $n_{\\alpha}$ 个独立样本，并假设所有 $\\alpha \\in \\mathcal{I}$ 之间相互独立。总期望计算成本等于 $\\sum_{\\alpha \\in \\mathcal{I}} \\kappa_{\\alpha} n_{\\alpha}$，并且在独立性假设下，估计量的方差等于 $\\sum_{\\alpha \\in \\mathcal{I}} \\frac{v_{\\alpha}}{n_{\\alpha}}$。\n\n仅从独立和的方差以及期望成本的可加性定义出发，设计一种方法来选择各个指标上的实值分配 $n_{\\alpha} \\ge 0$，以优化以下两个目标之一：\n- 目标A：在总期望计算预算固定的约束下，最小化估计量方差。\n- 目标B：在目标方差固定的约束下，最小化总期望计算成本。\n\n您的程序必须实现推导出的最优分配，并为每个测试用例计算最优目标值（而非分配方案本身）。将分配 $n_{\\alpha}$ 视为非负实数变量（不要四舍五入到整数）。如果任何 $v_{\\alpha} = 0$，您的方法必须能正确处理这种情况。\n\n使用以下测试套件。每个测试用例由一对参数数组和一个标量约束指定。对于目标A，约束是预算 $B$。对于目标B，约束是目标方差 $V_{\\text{target}}$。\n\n- 测试用例 $1$ (目标 A): $v = \\left[0.04, 0.01, 0.0025\\right]$, $c = \\left[1, 2, 4\\right]$, $B = 100$.\n- 测试用例 $2$ (目标 A): $v = \\left[0.0, 0.09, 0.01\\right]$, $c = \\left[1, 1, 10\\right]$, $B = 50$.\n- 测试用例 $3$ (目标 B): $v = \\left[0.5, 0.2, 0.05, 0.025\\right]$, $c = \\left[4, 2, 1, 0.5\\right]$, $V_{\\text{target}} = 0.01$.\n- 测试用例 $4$ (目标 A): $v = \\left[10^{-6}, 1.0, 0.1\\right]$, $c = \\left[1000, 1, 5\\right]$, $B = 200$.\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的、以逗号分隔的结果列表。每个测试用例的条目必须是作为浮点数的最优目标值，并按测试套件的相同顺序排列，即 $\\left[\\text{result}_1, \\text{result}_2, \\text{result}_3, \\text{result}_4\\right]$。此问题不涉及物理单位。不出现角度。输出中不得使用百分比。",
            "solution": "该问题要求在多指标蒙特卡洛 (MIMC) 或多层设置中对计算工作进行最优分配。这是一个经典的约束优化问题，可用拉格朗日乘数法 (method of Lagrange multipliers) 求解。待优化的变量是有限集 $\\mathcal{I}$ 中每个多指标 $\\alpha$ 的样本数量 $n_{\\alpha} \\ge 0$。两个目标函数分别是总方差 $V$ 和总计算成本 $C$，定义如下：\n$$V(\\mathbf{n}) = \\sum_{\\alpha \\in \\mathcal{I}} \\frac{v_{\\alpha}}{n_{\\alpha}}$$\n$$C(\\mathbf{n}) = \\sum_{\\alpha \\in \\mathcal{I}} \\kappa_{\\alpha} n_{\\alpha}$$\n其中 $v_{\\alpha} \\ge 0$ 是方差，$\\kappa_{\\alpha}  0$ 是指标 $\\alpha$ 每个样本的成本。向量 $\\mathbf{n}$ 包含分配 $\\{n_{\\alpha}\\}_{\\alpha \\in \\mathcal{I}}$。\n\n首先，我们处理所有 $v_{\\alpha}  0$ 的情况。在这种情况下，任何最优分配都必须对所有 $\\alpha$ 都有 $n_{\\alpha}  0$，否则方差 $V(\\mathbf{n})$ 将为无穷大。该问题可被视为正实数上的优化问题。稍后我们将展示该框架如何正确处理某些 $v_{\\alpha} = 0$ 的情况。\n\n### 目标A：在预算固定的情况下最小化方差\n\n第一个优化问题是在总计算成本（或预算）$B  0$ 固定的约束下，最小化总方差 $V(\\mathbf{n})$。\n$$ \\text{Minimize } V(\\mathbf{n}) = \\sum_{\\alpha \\in \\mathcal{I}} \\frac{v_{\\alpha}}{n_{\\alpha}} \\quad \\text{subject to} \\quad \\sum_{\\alpha \\in \\mathcal{I}} \\kappa_{\\alpha} n_{\\alpha} = B $$\n这是一个凸优化问题，因为目标函数是凸函数的和，而约束是线性的。我们引入一个拉格朗日乘子 $\\lambda$，并构造拉格朗日函数 $\\mathcal{L}(\\mathbf{n}, \\lambda)$：\n$$ \\mathcal{L}(\\mathbf{n}, \\lambda) = \\sum_{\\alpha \\in \\mathcal{I}} \\frac{v_{\\alpha}}{n_{\\alpha}} + \\lambda \\left( \\left( \\sum_{\\alpha \\in \\mathcal{I}} \\kappa_{\\alpha} n_{\\alpha} \\right) - B \\right) $$\n为求驻点，我们计算 $\\mathcal{L}$ 关于每个 $n_{\\alpha}$ 的偏导数，并令其为零：\n$$ \\frac{\\partial \\mathcal{L}}{\\partial n_{\\alpha}} = -\\frac{v_{\\alpha}}{n_{\\alpha}^2} + \\lambda \\kappa_{\\alpha} = 0 $$\n求解 $n_{\\alpha}$ 得：\n$$ n_{\\alpha}^2 = \\frac{v_{\\alpha}}{\\lambda \\kappa_{\\alpha}} \\implies n_{\\alpha} = \\frac{1}{\\sqrt{\\lambda}} \\sqrt{\\frac{v_{\\alpha}}{\\kappa_{\\alpha}}} $$\n由于 $n_{\\alpha}$、$\\kappa_{\\alpha}$ 和 $v_{\\alpha}$ 都是正的，拉格朗日乘子 $\\lambda$ 也必须是正的。我们将 $n_{\\alpha}$ 的表达式代入预算约束中来确定 $\\lambda$：\n$$ \\sum_{\\alpha \\in \\mathcal{I}} \\kappa_{\\alpha} \\left( \\frac{1}{\\sqrt{\\lambda}} \\sqrt{\\frac{v_{\\alpha}}{\\kappa_{\\alpha}}} \\right) = B $$\n$$ \\frac{1}{\\sqrt{\\lambda}} \\sum_{\\alpha \\in \\mathcal{I}} \\sqrt{\\kappa_{\\alpha} v_{\\alpha}} = B $$\n求解 $\\sqrt{\\lambda}$：\n$$ \\sqrt{\\lambda} = \\frac{1}{B} \\sum_{\\beta \\in \\mathcal{I}} \\sqrt{\\kappa_{\\beta} v_{\\beta}} $$\n因此，最优分配 $n_{\\alpha}^*$ 为：\n$$ n_{\\alpha}^* = \\frac{B}{\\sum_{\\beta \\in \\mathcal{I}} \\sqrt{\\kappa_{\\beta} v_{\\beta}}} \\sqrt{\\frac{v_{\\alpha}}{\\kappa_{\\alpha}}} $$\n问题要求的是最小方差 $V_{min}$，将 $n_{\\alpha}^*$ 代回方差表达式即可得到：\n$$ V_{min} = \\sum_{\\alpha \\in \\mathcal{I}} \\frac{v_{\\alpha}}{n_{\\alpha}^*} = \\sum_{\\alpha \\in \\mathcal{I}} v_{\\alpha} \\left( \\frac{\\sum_{\\beta \\in \\mathcal{I}} \\sqrt{\\kappa_{\\beta} v_{\\beta}}}{B} \\sqrt{\\frac{\\kappa_{\\alpha}}{v_{\\alpha}}} \\right) = \\frac{1}{B} \\left( \\sum_{\\beta \\in \\mathcal{I}} \\sqrt{\\kappa_{\\beta} v_{\\beta}} \\right) \\left( \\sum_{\\alpha \\in \\mathcal{I}} \\sqrt{v_{\\alpha} \\kappa_{\\alpha}} \\right) $$\n这可化简为最小方差的最终表达式：\n$$ V_{min} = \\frac{1}{B} \\left( \\sum_{\\alpha \\in \\mathcal{I}} \\sqrt{v_{\\alpha} \\kappa_{\\alpha}} \\right)^2 $$\n\n### 目标B：在方差固定的情况下最小化成本\n\n第二个优化问题是在目标方差 $V_{\\text{target}}  0$ 固定的约束下，最小化总成本 $C(\\mathbf{n})$。\n$$ \\text{Minimize } C(\\mathbf{n}) = \\sum_{\\alpha \\in \\mathcal{I}} \\kappa_{\\alpha} n_{\\alpha} \\quad \\text{subject to} \\quad \\sum_{\\alpha \\in \\mathcal{I}} \\frac{v_{\\alpha}}{n_{\\alpha}} = V_{\\text{target}} $$\n这也是一个凸优化问题（线性目标函数，凸约束集）。我们用乘子 $\\mu$ 构造拉格朗日函数：\n$$ \\mathcal{L}(\\mathbf{n}, \\mu) = \\sum_{\\alpha \\in \\mathcal{I}} \\kappa_{\\alpha} n_{\\alpha} + \\mu \\left( \\left( \\sum_{\\alpha \\in \\mathcal{I}} \\frac{v_{\\alpha}}{n_{\\alpha}} \\right) - V_{\\text{target}} \\right) $$\n将关于 $n_{\\alpha}$ 的偏导数设为零：\n$$ \\frac{\\partial \\mathcal{L}}{\\partial n_{\\alpha}} = \\kappa_{\\alpha} - \\mu \\frac{v_{\\alpha}}{n_{\\alpha}^2} = 0 $$\n求解 $n_{\\alpha}$ 得到一个类似的关系：\n$$ n_{\\alpha}^2 = \\mu \\frac{v_{\\alpha}}{\\kappa_{\\alpha}} \\implies n_{\\alpha} = \\sqrt{\\mu} \\sqrt{\\frac{v_{\\alpha}}{\\kappa_{\\alpha}}} $$\n这里，$\\mu$ 必须为正。我们利用方差约束来求解 $\\mu$：\n$$ \\sum_{\\alpha \\in \\mathcal{I}} \\frac{v_{\\alpha}}{\\sqrt{\\mu} \\sqrt{v_{\\alpha}/\\kappa_{\\alpha}}} = V_{\\text{target}} $$\n$$ \\frac{1}{\\sqrt{\\mu}} \\sum_{\\alpha \\in \\mathcal{I}} \\sqrt{v_{\\alpha} \\kappa_{\\alpha}} = V_{\\text{target}} $$\n求解 $\\sqrt{\\mu}$：\n$$ \\sqrt{\\mu} = \\frac{1}{V_{\\text{target}}} \\sum_{\\beta \\in \\mathcal{I}} \\sqrt{v_{\\beta} \\kappa_{\\beta}} $$\n最后，我们将最优分配 $n_{\\alpha}^* = \\sqrt{\\mu}\\sqrt{v_{\\alpha}/\\kappa_{\\alpha}}$ 代入成本函数，计算最小成本 $C_{min}$：\n$$ C_{min} = \\sum_{\\alpha \\in \\mathcal{I}} \\kappa_{\\alpha} n_{\\alpha}^* = \\sum_{\\alpha \\in \\mathcal{I}} \\kappa_{\\alpha} \\left( \\sqrt{\\mu} \\sqrt{\\frac{v_{\\alpha}}{\\kappa_{\\alpha}}} \\right) = \\sqrt{\\mu} \\sum_{\\alpha \\in \\mathcal{I}} \\sqrt{\\kappa_{\\alpha} v_{\\alpha}} $$\n代入 $\\sqrt{\\mu}$ 的表达式：\n$$ C_{min} = \\left( \\frac{1}{V_{\\text{target}}} \\sum_{\\beta \\in \\mathcal{I}} \\sqrt{v_{\\beta} \\kappa_{\\beta}} \\right) \\left( \\sum_{\\alpha \\in \\mathcal{I}} \\sqrt{v_{\\alpha} \\kappa_{\\alpha}} \\right) $$\n这可化简为最小成本的最终表达式：\n$$ C_{min} = \\frac{1}{V_{\\text{target}}} \\left( \\sum_{\\alpha \\in \\mathcal{I}} \\sqrt{v_{\\alpha} \\kappa_{\\alpha}} \\right)^2 $$\n\n### 综合与零方差处理\n\n两个目标的结果呈现出清晰的对偶性。令 $S = \\sum_{\\alpha \\in \\mathcal{I}} \\sqrt{v_{\\alpha} \\kappa_{\\alpha}}$。那么：\n- 目标A: $V_{min} = S^2 / B$\n- 目标B: $C_{min} = S^2 / V_{\\text{target}}$\n\n这意味着关系 $V_{min} B = C_{min} V_{\\text{target}} = S^2$ 成立，它概括了方差与成本之间的基本权衡关系。\n\n问题要求正确处理某些 $\\alpha$ 的 $v_{\\alpha} = 0$ 的情况。我们推导出的公式无需任何修改即可适应这种情况。如果某个指标 $\\alpha_0$ 的 $v_{\\alpha_0} = 0$，则其在总和 $S$ 中的相应项为 $\\sqrt{v_{\\alpha_0} \\kappa_{\\alpha_0}} = \\sqrt{0 \\cdot \\kappa_{\\alpha_0}} = 0$。该项直接从总和中消失。这与优化逻辑是一致的：如果分量 $\\Delta_{\\alpha_0}$ 的方差贡献为零，那么最优策略是为其分配零个样本（$n_{\\alpha_0}=0$）以最小化成本，从而将全部预算留给具有非零方差的分量。我们关于最优分配 $n_{\\alpha}^* \\propto \\sqrt{v_{\\alpha}/\\kappa_{\\alpha}}$ 的公式在 $v_{\\alpha_0} = 0$ 时自然地得出 $n_{\\alpha_0}^* = 0$。因此，推导出的公式是通用且鲁棒的。在实现中，将对所有指标计算总和 $S$，零方差项将正确地贡献零值。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the optimal resource allocation problem for Multi-Index Monte Carlo\n    and computes the optimal objective value for a series of test cases.\n    \"\"\"\n\n    # The test suite is defined as a list of tuples.\n    # Each tuple contains: (objective_type, v_array, c_array, constraint_value)\n    # objective_type 'A' corresponds to minimizing variance for a fixed budget.\n    # objective_type 'B' corresponds to minimizing cost for a fixed variance.\n    test_cases = [\n        ('A', np.array([0.04, 0.01, 0.0025]), np.array([1, 2, 4]), 100.0),\n        ('A', np.array([0.0, 0.09, 0.01]), np.array([1, 1, 10]), 50.0),\n        ('B', np.array([0.5, 0.2, 0.05, 0.025]), np.array([4, 2, 1, 0.5]), 0.01),\n        ('A', np.array([1e-6, 1.0, 0.1]), np.array([1000, 1, 5]), 200.0),\n    ]\n\n    results = []\n    for objective_type, v, c, constraint in test_cases:\n        # The core of the solution is based on the quantity S, which is the sum\n        # of the square roots of the product of variance and cost for each index.\n        # S = sum(sqrt(v_alpha * kappa_alpha))\n        # numpy's vectorized operations make this calculation concise.\n        \n        # Taking the square root of the element-wise product of v and c.\n        # This correctly handles cases where v_alpha is 0, as sqrt(0 * k) = 0.\n        sqrt_vk = np.sqrt(v * c)\n        \n        # Summing the results to get the total S.\n        S = np.sum(sqrt_vk)\n        \n        # The optimal objective value is S^2 divided by the constraint value.\n        # For Objective A (minimize variance), the constraint is the budget B.\n        #   V_min = S^2 / B\n        # For Objective B (minimize cost), the constraint is the target variance V_target.\n        #   C_min = S^2 / V_target\n        optimal_value = (S ** 2) / constraint\n        \n        results.append(optimal_value)\n\n    # The final output must be a single line containing a comma-separated list\n    # of results enclosed in square brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\n# Execute the solver.\nsolve()\n\n```"
        },
        {
            "introduction": "MLMC 的原理可以推广到更高维度，形成多指数蒙特卡洛 (MIMC) 方法，并常常与随机化技术结合以构造无偏估计器。然而，要使这些高级方法有效，问题的底层结构必须满足某些条件。本练习旨在探索确保 MIMC 估计器无偏、方差有限且期望计算成本有限的基本不等式，从而将理论与实际可行性验证直接联系起来。",
            "id": "3321945",
            "problem": "考虑一个用于近似目标量期望的多指标蒙特卡罗构造。设维度为 $d \\in \\mathbb{N}$，多指标为 $\\boldsymbol{n} = (n_1,\\ldots,n_d) \\in \\mathbb{Z}_+^d$。假设存在一族随机增量 $\\Delta_{\\boldsymbol{n}}$，使得我们感兴趣的精确期望可以表示为一个收敛的伸缩/多指标期望和 $\\sum_{\\boldsymbol{n} \\in \\mathbb{Z}_+^d} \\mathbb{E}[\\Delta_{\\boldsymbol{n}}]$，其中该和是绝对收敛的。通过独立的伯努利选择子 $B_{\\boldsymbol{n}} \\sim \\mathrm{Bernoulli}(q_{\\boldsymbol{n}})$ 来构造一个无偏多层估计量，这些选择子在 $\\boldsymbol{n}$ 之间相互独立，且独立于增量 $\\Delta_{\\boldsymbol{n}}$。该估计量定义为\n$$\nY = \\sum_{\\boldsymbol{n} \\in \\mathbb{Z}_+^d} \\frac{B_{\\boldsymbol{n}}}{q_{\\boldsymbol{n}}} \\Delta_{\\boldsymbol{n}},\n$$\n其中采样概率 $q_{\\boldsymbol{n}}$ 具有乘积形式\n$$\nq_{\\boldsymbol{n}} = c_q \\prod_{i=1}^d 2^{-r_i n_i},\n$$\n其中 $0  c_q \\le 1$ 的选择是为了满足对所有 $\\boldsymbol{n}$ 都有 $0 \\le q_{\\boldsymbol{n}} \\le 1$，$\\boldsymbol{r} = (r_1,\\ldots,r_d)$ 是分量衰减指数。\n\n假设以下常见的渐近乘积模型对增量矩和计算工作量成立，且对 $\\boldsymbol{n}$ 一致成立：\n- 一阶矩衰减为 $\\mathbb{E}[\\Delta_{\\boldsymbol{n}}] \\asymp c_\\mu \\prod_{i=1}^d 2^{-\\alpha_i n_i}$，其中 $c_\\mu  0$，衰减指数为 $\\boldsymbol{\\alpha} = (\\alpha_1,\\ldots,\\alpha_d)$。\n- 二阶矩衰减为 $\\mathbb{E}[\\Delta_{\\boldsymbol{n}}^2] \\asymp c_2 \\prod_{i=1}^d 2^{-\\beta_i n_i}$，其中 $c_2  0$，衰减指数为 $\\boldsymbol{\\beta} = (\\beta_1,\\ldots,\\beta_d)$。\n- 层级 $\\boldsymbol{n}$ 的计算工作量增长为 $w(\\boldsymbol{n}) \\asymp c_w \\prod_{i=1}^d 2^{\\gamma_i n_i}$，其中 $c_w  0$，增长指数为 $\\boldsymbol{\\gamma} = (\\gamma_1,\\ldots,\\gamma_d)$。\n\n根据概率论中期望、方差和独立性的第一性原理，定义了以下性质：\n- 无偏性：$\\mathbb{E}[Y] = \\sum_{\\boldsymbol{n}} \\mathbb{E}[\\Delta_{\\boldsymbol{n}}]$ 具有等于目标期望的有限值。\n- 有限方差：$\\mathrm{Var}(Y)  \\infty$。\n- 有限期望成本：$\\mathbb{E}\\!\\left[\\sum_{\\boldsymbol{n}} B_{\\boldsymbol{n}} w(\\boldsymbol{n})\\right]  \\infty$。\n\n仅从期望 $\\mathbb{E}[\\cdot]$、方差 $\\mathrm{Var}(\\cdot)$、随机变量的独立性以及乘积可分和的绝对收敛性的定义出发，推导关于 $\\boldsymbol{\\alpha}$、$\\boldsymbol{\\beta}$、$\\boldsymbol{\\gamma}$ 和 $\\boldsymbol{r}$ 的显式分量不等式，以保证：\n1) $Y$ 的无偏性，\n2) $Y$ 的有限方差，\n3) 有限的期望计算成本。\n\n然后，以算法方式实现这些条件：给定 $d$以及向量 $\\boldsymbol{\\alpha}$、$\\boldsymbol{\\beta}$、$\\boldsymbol{\\gamma}$ 和 $\\boldsymbol{r}$，返回一个布尔值三元组，指示这三个性质是否各自成立。\n\n你的程序必须评估以下参数集测试套件：\n- 测试用例 1：$d = 2$, $\\boldsymbol{\\alpha} = (1.0, 0.8)$, $\\boldsymbol{\\beta} = (2.0, 1.5)$, $\\boldsymbol{\\gamma} = (0.3, 0.4)$, $\\boldsymbol{r} = (1.2, 1.0)$。\n- 测试用例 2：$d = 3$, $\\boldsymbol{\\alpha} = (0.5, 1.0, 0.7)$, $\\boldsymbol{\\beta} = (1.0, 0.9, 1.1)$, $\\boldsymbol{\\gamma} = (0.6, 0.4, 0.3)$, $\\boldsymbol{r} = (0.8, 0.6, 0.7)$。\n- 测试用例 3：$d = 2$, $\\boldsymbol{\\alpha} = (0.7, 0.9)$, $\\boldsymbol{\\beta} = (1.2, 1.0)$, $\\boldsymbol{\\gamma} = (0.1, 0.2)$, $\\boldsymbol{r} = (1.2, 0.5)$。\n- 测试用例 4：$d = 2$, $\\boldsymbol{\\alpha} = (1.0, 1.0)$, $\\boldsymbol{\\beta} = (0.4, 0.7)$, $\\boldsymbol{\\gamma} = (0.5, 0.6)$, $\\boldsymbol{r} = (0.55, 0.65)$。\n- 测试用例 5：$d = 3$, $\\boldsymbol{\\alpha} = (0.0, -0.1, 0.2)$, $\\boldsymbol{\\beta} = (1.5, 1.5, 1.5)$, $\\boldsymbol{\\gamma} = (0.5, 0.5, 0.5)$, $\\boldsymbol{r} = (1.0, 1.0, 1.0)$。\n\n你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个元素是对应测试用例的一个包含三个布尔值的列表 $[\\text{无偏性}, \\text{有限方差}, \\text{有限成本}]$，且不含空格。例如，一个有效的格式是 $[[\\text{True},\\text{False},\\text{True}],[\\text{False},\\text{False},\\text{True}]]$。",
            "solution": "该问题要求推导一个无偏多指标蒙特卡罗估计量具有良定义、有限方差和有限期望计算成本的条件。这些条件将从第一性原理以及为增量矩和计算工作量提供的渐近模型中推导出来。\n\n设多指标为 $\\boldsymbol{n} = (n_1, \\ldots, n_d) \\in \\mathbb{Z}_+^d$。该估计量由下式给出\n$$ Y = \\sum_{\\boldsymbol{n} \\in \\mathbb{Z}_+^d} \\frac{B_{\\boldsymbol{n}}}{q_{\\boldsymbol{n}}} \\Delta_{\\boldsymbol{n}} $$\n其中 $B_{\\boldsymbol{n}} \\sim \\mathrm{Bernoulli}(q_{\\boldsymbol{n}})$ 是独立的伯努利随机变量，也独立于随机增量 $\\Delta_{\\boldsymbol{n}}$。采样概率为 $q_{\\boldsymbol{n}} = c_q \\prod_{i=1}^d 2^{-r_i n_i}$。增量矩和工作量的渐近行为是：\n$\\mathbb{E}[\\Delta_{\\boldsymbol{n}}] \\asymp c_\\mu \\prod_{i=1}^d 2^{-\\alpha_i n_i}$，\n$\\mathbb{E}[\\Delta_{\\boldsymbol{n}}^2] \\asymp c_2 \\prod_{i=1}^d 2^{-\\beta_i n_i}$，以及\n$w(\\boldsymbol{n}) \\asymp c_w \\prod_{i=1}^d 2^{\\gamma_i n_i}$。\n\n此分析的一个关键工具是乘积形式项的多维和的收敛判据。一个和 $\\sum_{\\boldsymbol{n} \\in \\mathbb{Z}_+^d} \\prod_{i=1}^d c_i 2^{-k_i n_i}$ 是绝对收敛的，当且仅当每个对应的一维几何级数都收敛。这种情况发生于每个几何级数的底的绝对值小于1时，对于 $2^{-k_i}$ 而言，这意味着 $2^{-k_i}  1$，即 $k_i  0$。因此，为了使多维和收敛，我们需要对所有的 $i = 1, \\ldots, d$ 都有 $k_i  0$。\n\n1. 无偏性和期望的有限性\n问题将无偏性定义为 $\\mathbb{E}[Y] = \\sum_{\\boldsymbol{n}} \\mathbb{E}[\\Delta_{\\boldsymbol{n}}]$ 具有一个有限值。为了证实这一点，我们首先计算 $Y$ 的期望。根据期望的线性性质，如果绝对期望的和是有限的（Fubini-Tonelli 定理），则可以应用该性质，我们有：\n$$ \\mathbb{E}[Y] = \\mathbb{E}\\left[\\sum_{\\boldsymbol{n} \\in \\mathbb{Z}_+^d} \\frac{B_{\\boldsymbol{n}}}{q_{\\boldsymbol{n}}} \\Delta_{\\boldsymbol{n}}\\right] = \\sum_{\\boldsymbol{n} \\in \\mathbb{Z}_+^d} \\mathbb{E}\\left[\\frac{B_{\\boldsymbol{n}}}{q_{\\boldsymbol{n}}} \\Delta_{\\boldsymbol{n}}\\right] $$\n对于每一项，我们使用 $B_{\\boldsymbol{n}}$ 和 $\\Delta_{\\boldsymbol{n}}$ 的独立性：\n$$ \\mathbb{E}\\left[\\frac{B_{\\boldsymbol{n}}}{q_{\\boldsymbol{n}}} \\Delta_{\\boldsymbol{n}}\\right] = \\frac{1}{q_{\\boldsymbol{n}}} \\mathbb{E}[B_{\\boldsymbol{n}}] \\mathbb{E}[\\Delta_{\\boldsymbol{n}}] $$\n由于 $B_{\\boldsymbol{n}}$ 是参数为 $q_{\\boldsymbol{n}}$ 的伯努利随机变量，其期望为 $\\mathbb{E}[B_{\\boldsymbol{n}}] = q_{\\boldsymbol{n}}$。将此代入表达式中得到：\n$$ \\frac{1}{q_{\\boldsymbol{n}}} (q_{\\boldsymbol{n}}) \\mathbb{E}[\\Delta_{\\boldsymbol{n}}] = \\mathbb{E}[\\Delta_{\\boldsymbol{n}}] $$\n因此，估计量 $Y$ 在形式上是无偏的，即 $\\mathbb{E}[Y] = \\sum_{\\boldsymbol{n} \\in \\mathbb{Z}_+^d} \\mathbb{E}[\\Delta_{\\boldsymbol{n}}]$。该性质有意义地成立的条件是期望必须是有限的。这要求和 $\\sum_{\\boldsymbol{n}} \\mathbb{E}[\\Delta_{\\boldsymbol{n}}]$ 是绝对收敛的，这是问题设定中明确说明的一个条件。我们分析 $\\sum_{\\boldsymbol{n}} |\\mathbb{E}[\\Delta_{\\boldsymbol{n}}]|$ 的收敛性。使用渐近模型：\n$$ \\sum_{\\boldsymbol{n} \\in \\mathbb{Z}_+^d} |\\mathbb{E}[\\Delta_{\\boldsymbol{n}}]| \\asymp \\sum_{\\boldsymbol{n} \\in \\mathbb{Z}_+^d} c_\\mu \\prod_{i=1}^d 2^{-\\alpha_i n_i} $$\n为了使该和收敛，我们需要衰减项的指数对每个分量 $i$ 都为正：\n$$ \\alpha_i  0 \\quad \\text{对所有 } i = 1, \\ldots, d $$\n这组不等式是无偏性以有限期望成立的条件。\n\n2. 有限方差\n$Y$的方差必须是有限的，即 $\\mathrm{Var}(Y)  \\infty$。假设对于不同的 $\\boldsymbol{n}$，增量 $\\Delta_{\\boldsymbol{n}}$ 也是独立的（这是该领域的标准假设），那么项 $\\frac{B_{\\boldsymbol{n}}}{q_{\\boldsymbol{n}}} \\Delta_{\\boldsymbol{n}}$ 在 $\\boldsymbol{n}$ 之间是相互独立的。因此，和的方差是方差的和：\n$$ \\mathrm{Var}(Y) = \\mathrm{Var}\\left(\\sum_{\\boldsymbol{n} \\in \\mathbb{Z}_+^d} \\frac{B_{\\boldsymbol{n}}}{q_{\\boldsymbol{n}}} \\Delta_{\\boldsymbol{n}}\\right) = \\sum_{\\boldsymbol{n} \\in \\mathbb{Z}_+^d} \\mathrm{Var}\\left(\\frac{B_{\\boldsymbol{n}}}{q_{\\boldsymbol{n}}} \\Delta_{\\boldsymbol{n}}\\right) $$\n单项的方差是 $\\mathrm{Var}(Z_{\\boldsymbol{n}}) = \\mathbb{E}[Z_{\\boldsymbol{n}}^2] - (\\mathbb{E}[Z_{\\boldsymbol{n}}])^2$，其中 $Z_{\\boldsymbol{n}} = \\frac{B_{\\boldsymbol{n}}}{q_{\\boldsymbol{n}}} \\Delta_{\\boldsymbol{n}}$。我们已经证明 $\\mathbb{E}[Z_{\\boldsymbol{n}}] = \\mathbb{E}[\\Delta_{\\boldsymbol{n}}]$。现在我们计算二阶矩：\n$$ \\mathbb{E}[Z_{\\boldsymbol{n}}^2] = \\mathbb{E}\\left[\\left(\\frac{B_{\\boldsymbol{n}}}{q_{\\boldsymbol{n}}} \\Delta_{\\boldsymbol{n}}\\right)^2\\right] = \\frac{1}{q_{\\boldsymbol{n}}^2} \\mathbb{E}[B_{\\boldsymbol{n}}^2 \\Delta_{\\boldsymbol{n}}^2] $$\n利用 $B_{\\boldsymbol{n}}$ 和 $\\Delta_{\\boldsymbol{n}}$ 的独立性，以及伯努利变量的性质 $B_{\\boldsymbol{n}}^2 = B_{\\boldsymbol{n}}$，我们得到：\n$$ \\mathbb{E}[Z_{\\boldsymbol{n}}^2] = \\frac{1}{q_{\\boldsymbol{n}}^2} \\mathbb{E}[B_{\\boldsymbol{n}}^2] \\mathbb{E}[\\Delta_{\\boldsymbol{n}}^2] = \\frac{1}{q_{\\boldsymbol{n}}^2} \\mathbb{E}[B_{\\boldsymbol{n}}] \\mathbb{E}[\\Delta_{\\boldsymbol{n}}^2] = \\frac{q_{\\boldsymbol{n}}}{q_{\\boldsymbol{n}}^2} \\mathbb{E}[\\Delta_{\\boldsymbol{n}}^2] = \\frac{1}{q_{\\boldsymbol{n}}} \\mathbb{E}[\\Delta_{\\boldsymbol{n}}^2] $$\n所以，$Y$ 的方差是：\n$$ \\mathrm{Var}(Y) = \\sum_{\\boldsymbol{n} \\in \\mathbb{Z}_+^d} \\left( \\frac{1}{q_{\\boldsymbol{n}}} \\mathbb{E}[\\Delta_{\\boldsymbol{n}}^2] - \\left(\\mathbb{E}[\\Delta_{\\boldsymbol{n}}]\\right)^2 \\right) $$\n对于这个非负项的和，其收敛的充要条件是正部和与负部和分别收敛。\na) $\\sum_{\\boldsymbol{n}} \\frac{1}{q_{\\boldsymbol{n}}} \\mathbb{E}[\\Delta_{\\boldsymbol{n}}^2]$ 的收敛性：\n该项的行为类似于 $\\frac{1}{q_{\\boldsymbol{n}}} \\mathbb{E}[\\Delta_{\\boldsymbol{n}}^2] \\asymp \\left(\\frac{1}{c_q} \\prod_{i=1}^d 2^{r_i n_i}\\right) \\left(c_2 \\prod_{i=1}^d 2^{-\\beta_i n_i}\\right) = \\frac{c_2}{c_q} \\prod_{i=1}^d 2^{-(\\beta_i - r_i) n_i}$。\n收敛要求 $\\beta_i - r_i  0$，即 $\\beta_i  r_i$ 对所有 $i = 1, \\ldots, d$。\nb) $\\sum_{\\boldsymbol{n}} (\\mathbb{E}[\\Delta_{\\boldsymbol{n}}])^2$ 的收敛性：\n该项的行为类似于 $(\\mathbb{E}[\\Delta_{\\boldsymbol{n}}])^2 \\asymp \\left(c_\\mu \\prod_{i=1}^d 2^{-\\alpha_i n_i}\\right)^2 = c_\\mu^2 \\prod_{i=1}^d 2^{-2\\alpha_i n_i}$。\n收敛要求 $2\\alpha_i  0$，即 $\\alpha_i  0$ 对所有 $i = 1, \\ldots, d$。这与期望有限性的条件相同。\n为了使总方差有限，两个条件都必须成立。因此，有限方差的完整条件是：\n$$ (\\beta_i  r_i \\text{ 对所有 } i = 1, \\ldots, d) \\quad \\text{与} \\quad (\\alpha_i  0 \\text{ 对所有 } i = 1, \\ldots, d) $$\n\n3. 有限期望成本\n总计算成本为 $C = \\sum_{\\boldsymbol{n} \\in \\mathbb{Z}_+^d} B_{\\boldsymbol{n}} w(\\boldsymbol{n})$。我们需要其期望是有限的。由于成本是一个非负量，我们可以交换期望和求和（Tonelli 定理）：\n$$ \\mathbb{E}[C] = \\mathbb{E}\\left[\\sum_{\\boldsymbol{n} \\in \\mathbb{Z}_+^d} B_{\\boldsymbol{n}} w(\\boldsymbol{n})\\right] = \\sum_{\\boldsymbol{n} \\in \\mathbb{Z}_+^d} \\mathbb{E}[B_{\\boldsymbol{n}} w(\\boldsymbol{n})] $$\n对于给定的层级 $\\boldsymbol{n}$，工作量 $w(\\boldsymbol{n})$ 是确定性的。所以，$\\mathbb{E}[B_{\\boldsymbol{n}} w(\\boldsymbol{n})] = w(\\boldsymbol{n}) \\mathbb{E}[B_{\\boldsymbol{n}}] = w(\\boldsymbol{n}) q_{\\boldsymbol{n}}$。\n因此，期望成本为 $\\mathbb{E}[C] = \\sum_{\\boldsymbol{n} \\in \\mathbb{Z}_+^d} q_{\\boldsymbol{n}} w(\\boldsymbol{n})$。我们使用渐近模型检查该和的收敛性：\n$$ q_{\\boldsymbol{n}} w(\\boldsymbol{n}) \\asymp \\left(c_q \\prod_{i=1}^d 2^{-r_i n_i}\\right) \\left(c_w \\prod_{i=1}^d 2^{\\gamma_i n_i}\\right) = c_q c_w \\prod_{i=1}^d 2^{-(r_i - \\gamma_i)n_i} $$\n为了使该和收敛，指数必须对每个分量都为正：\n$$ r_i - \\gamma_i  0 \\quad \\text{或} \\quad r_i  \\gamma_i \\quad \\text{对所有 } i = 1, \\ldots, d $$\n\n条件总结：\n- 无偏性（有限期望）：$\\alpha_i  0$ 对 $i=1, \\ldots, d$。\n- 有限方差：$\\beta_i  r_i$ 对 $i=1, \\ldots, d$ 且 $\\alpha_i  0$ 对 $i=1, \\ldots, d$。\n- 有限期望成本：$r_i  \\gamma_i$ 对 $i=1, \\ldots, d$。\n算法将检查这些分量级别的严格不等式。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Derives and applies conditions for unbiasedness, finite variance, and finite\n    expected cost for a multi-index Monte Carlo estimator.\n    \"\"\"\n\n    test_cases = [\n        # (d, alpha, beta, gamma, r)\n        (2, (1.0, 0.8), (2.0, 1.5), (0.3, 0.4), (1.2, 1.0)),\n        (3, (0.5, 1.0, 0.7), (1.0, 0.9, 1.1), (0.6, 0.4, 0.3), (0.8, 0.6, 0.7)),\n        (2, (0.7, 0.9), (1.2, 1.0), (0.1, 0.2), (1.2, 0.5)),\n        (2, (1.0, 1.0), (0.4, 0.7), (0.5, 0.6), (0.55, 0.65)),\n        (3, (0.0, -0.1, 0.2), (1.5, 1.5, 1.5), (0.5, 0.5, 0.5), (1.0, 1.0, 1.0)),\n    ]\n\n    results = []\n    for case in test_cases:\n        d, alpha, beta, gamma, r = case\n        \n        # 1. Unbiasedness (Finite Expectation) Condition:\n        # The sum of expectations sum(E[Delta_n]) must converge.\n        # This occurs if the decay rate for each component is positive.\n        # Condition: alpha_i  0 for all i.\n        unbiased_check = all(a > 0 for a in alpha)\n\n        # 2. Finite Variance Condition:\n        # The sum of variances sum(Var(Y_n)) must converge.\n        # Var(Y_n) = (1/q_n)E[Delta_n^2] - (E[Delta_n])^2\n        # Convergence requires convergence of both sum( (1/q_n)E[Delta_n^2] )\n        # and sum( (E[Delta_n])^2 ).\n        # Condition 1: sum( (1/q_n)E[Delta_n^2] ) converges if beta_i > r_i for all i.\n        # Condition 2: sum( (E[Delta_n])^2 ) converges if 2*alpha_i > 0, i.e., alpha_i > 0 for all i.\n        # This second condition is the same as for unbiasedness.\n        finite_var_check_1 = all(b > rr for b, rr in zip(beta, r))\n        finite_var_check = finite_var_check_1 and unbiased_check\n        \n        # 3. Finite Expected Cost Condition:\n        # The sum of expected costs sum(q_n * w_n) must converge.\n        # This occurs if the decay rate of the product is positive.\n        # Condition: r_i > gamma_i for all i.\n        finite_cost_check = all(rr > g for rr, g in zip(r, gamma))\n        \n        results.append([unbiased_check, finite_var_check, finite_cost_check])\n\n    # Format the final output string exactly as specified, with no spaces.\n    final_output = str(results).replace(\" \", \"\")\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}