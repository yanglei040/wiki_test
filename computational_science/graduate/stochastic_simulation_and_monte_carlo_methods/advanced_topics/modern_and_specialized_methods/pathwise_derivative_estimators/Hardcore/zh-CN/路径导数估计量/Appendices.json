{
    "hands_on_practices": [
        {
            "introduction": "本练习将引导你完成路径微分估计最核心与直接的应用。你将为一个参数化的Ornstein–Uhlenbeck过程推导路径灵敏度过程，并构建一个路径梯度估计量 。通过将其期望与解析微分结果进行比较，本练习旨在验证该方法的无偏性，并为你掌握在光滑问题中应用路径微分法奠定坚实基础。",
            "id": "3328507",
            "problem": "考虑由标量参数 $\\theta \\in (0,\\infty)$ 参数化的 Ornstein–Uhlenbeck (OU) 过程，它被定义为以下线性随机微分方程 (SDE) 的唯一强解\n$$\ndX_{t}^{\\theta} = -\\lambda(\\theta)\\,X_{t}^{\\theta}\\,dt + \\sigma\\,dW_{t}, \\quad X_{0}^{\\theta} = x_{0},\n$$\n其中 $W_{t}$ 是标准维纳过程（也称为布朗运动），$\\sigma \\in (0,\\infty)$ 是一个固定的扩散系数，$x_{0} \\in \\mathbb{R}$ 是确定性的且独立于 $\\theta$。设均值回归速率为 $\\lambda(\\theta) = \\theta$。在固定的终端时间 $T \\in (0,\\infty)$，定义性能泛函为 $f(x) = x^{2}$，目标量为 $F(\\theta) = \\mathbb{E}[f(X_{T}^{\\theta})]$。\n\n仅使用随机过程和随机微分方程理论中的基础工具——即线性 SDE 的存在唯一性、线性方程的常数变易法、Itô 等距定理以及（根据需要使用的）控制收敛定理——完成以下任务：\n\n- 推导路径敏感性过程 $Y_{t} = \\nabla_{\\theta} X_{t}^{\\theta}$，并获得路径梯度估计量 $G(\\theta) = f'(X_{T}^{\\theta})\\,Y_{T}$ 的闭式表达式。\n\n- 计算 $\\mathbb{E}[G(\\theta)]$ 的闭式解，并将其与通过对 $\\mathbb{E}[X_{T}^{\\theta\\,2}]$ 的精确表达式关于 $\\theta$ 求导得到的解析导数 $\\nabla_{\\theta}\\,\\mathbb{E}[f(X_{T}^{\\theta})]$ 进行比较。在所述的正则性假设下，判断 $G(\\theta)$ 是否为 $\\nabla_{\\theta}\\,\\mathbb{E}[f(X_{T}^{\\theta})]$ 的无偏估计量。\n\n将最终答案表示为关于 $\\theta$、$T$、$\\sigma$ 和 $x_{0}$ 的 $\\nabla_{\\theta}\\,\\mathbb{E}[f(X_{T}^{\\theta})]$ 的单个闭式解析表达式。不需要数值近似或四舍五入。",
            "solution": "问题陈述被评估为具有科学依据、适定、客观、完整且可行。它代表了随机敏感性分析领域一个标准的、非平凡的问题。因此，该问题被认为是**有效的**，下面给出完整解答。\n\n目标是推导和分析 Ornstein-Uhlenbeck (OU) 過程中某个参数的路径梯度估计量。该过程包括几个步骤：求解主 SDE、推导并求解敏感性 SDE、构建估计量、计算其期望，并将其与真实的解析导数进行比较。\n\n设 OU 过程由以下 SDE 给出：\n$$\ndX_{t}^{\\theta} = -\\theta X_{t}^{\\theta}\\,dt + \\sigma\\,dW_{t}, \\quad X_{0}^{\\theta} = x_{0}\n$$\n其中 $\\lambda(\\theta) = \\theta$。\n\n**1. $X_{t}^{\\theta}$ 的闭式解**\n\n这是一个线性 SDE。我们可以使用积分因子 $I_{t} = \\exp(\\theta t)$ 来求解它。\n对 $I_{t}X_{t}^{\\theta}$ 应用 Itô 乘积法则：\n$$\nd(\\exp(\\theta t) X_{t}^{\\theta}) = \\theta \\exp(\\theta t) X_{t}^{\\theta}\\,dt + \\exp(\\theta t) dX_{t}^{\\theta}\n$$\n代入 $dX_{t}^{\\theta}$：\n$$\nd(\\exp(\\theta t) X_{t}^{\\theta}) = \\theta \\exp(\\theta t) X_{t}^{\\theta}\\,dt + \\exp(\\theta t) (-\\theta X_{t}^{\\theta}\\,dt + \\sigma\\,dW_{t}) = \\sigma \\exp(\\theta t)\\,dW_{t}\n$$\n从 $s=0$ 到 $s=t$ 积分：\n$$\n\\exp(\\theta t) X_{t}^{\\theta} - \\exp(0) X_{0}^{\\theta} = \\int_{0}^{t} \\sigma \\exp(\\theta s)\\,dW_{s}\n$$\n在 $X_{0}^{\\theta} = x_0$ 的条件下求解 $X_{t}^{\\theta}$：\n$$\nX_{t}^{\\theta} = x_{0}\\exp(-\\theta t) + \\sigma \\int_{0}^{t} \\exp(-\\theta(t-s))\\,dW_{s}\n$$\n在终端时间 $T$，我们有：\n$$\nX_{T}^{\\theta} = x_{0}\\exp(-\\theta T) + \\sigma \\int_{0}^{T} \\exp(-\\theta(T-s))\\,dW_{s}\n$$\n\n**2. 敏感性过程 $Y_{t} = \\nabla_{\\theta} X_{t}^{\\theta}$ 的推导和求解**\n\n路径导数过程 $Y_{t} = \\nabla_{\\theta} X_{t}^{\\theta}$ 是通过对 $X_{t}^{\\theta}$ 的 SDE 关于 $\\theta$ 进行形式上的微分得到的。在这里，微分和随机积分的交换是允许的，因为 SDE 的系数关于 $\\theta$ 是光滑的，并且扩散系数 $\\sigma$ 独立于 $\\theta$。\n$$\ndY_{t} = d(\\nabla_{\\theta} X_{t}^{\\theta}) = \\nabla_{\\theta}(dX_{t}^{\\theta}) = \\nabla_{\\theta}(-\\theta X_{t}^{\\theta}\\,dt + \\sigma\\,dW_{t})\n$$\n$$\ndY_{t} = -(\\nabla_{\\theta}(\\theta X_{t}^{\\theta}))\\,dt = -((\\nabla_{\\theta}\\theta) X_{t}^{\\theta} + \\theta (\\nabla_{\\theta} X_{t}^{\\theta}))\\,dt = -(X_{t}^{\\theta} + \\theta Y_{t})\\,dt\n$$\n这给出了关于 $Y_{t}$ 的线性常微分方程（对于每个样本路径）：\n$$\ndY_{t} = -\\theta Y_{t}\\,dt - X_{t}^{\\theta}\\,dt\n$$\n初始条件是 $Y_{0} = \\nabla_{\\theta} X_{0}^{\\theta} = \\nabla_{\\theta} x_{0} = 0$，因为 $x_{0}$ 独立于 $\\theta$。\n我们使用积分因子 $\\exp(\\theta t)$ 求解这个 ODE：\n$$\nd(\\exp(\\theta t) Y_{t}) = \\exp(\\theta t)(dY_{t} + \\theta Y_{t}\\,dt) = -\\exp(\\theta t)X_{t}^{\\theta}\\,dt\n$$\n从 $s=0$ 到 $s=t$ 积分：\n$$\n\\exp(\\theta t) Y_{t} - Y_0 = -\\int_{0}^{t} \\exp(\\theta s) X_{s}^{\\theta}\\,ds\n$$\n由于 $Y_0=0$，我们有 $Y_{t} = -\\exp(-\\theta t) \\int_{0}^{t} \\exp(\\theta s) X_{s}^{\\theta}\\,ds$。\n代入 $X_{s}^{\\theta}$ 的表达式：\n$$\nY_{t} = -\\exp(-\\theta t) \\int_{0}^{t} \\exp(\\theta s) \\left( x_{0}\\exp(-\\theta s) + \\sigma\\int_{0}^{s} \\exp(-\\theta(s-u))\\,dW_{u} \\right)\\,ds\n$$\n$$\nY_{t} = -\\exp(-\\theta t) \\int_{0}^{t} \\left( x_{0} + \\sigma\\int_{0}^{s} \\exp(\\theta u)\\,dW_{u} \\right)\\,ds\n$$\n$$\nY_{t} = -\\exp(-\\theta t) \\left( x_{0}t + \\sigma \\int_{0}^{t} \\int_{0}^{s} \\exp(\\theta u)\\,dW_{u}\\,ds \\right)\n$$\n使用随机 Fubini 定理来交换积分顺序：\n$$\n\\int_{0}^{t} \\int_{0}^{s} \\exp(\\theta u)\\,dW_{u}\\,ds = \\int_{0}^{t} (t-u)\\exp(\\theta u)\\,dW_{u}\n$$\n因此，敏感性过程为：\n$$\nY_{t} = -x_{0}t\\exp(-\\theta t) - \\sigma\\exp(-\\theta t)\\int_{0}^{t} (t-u)\\exp(\\theta u)\\,dW_{u} = -x_{0}t\\exp(-\\theta t) - \\sigma\\int_{0}^{t} (t-u)\\exp(-\\theta(t-u))\\,dW_{u}\n$$\n在终端时间 $T$：\n$$\nY_{T} = -x_{0}T\\exp(-\\theta T) - \\sigma\\int_{0}^{T} (T-u)\\exp(-\\theta(T-u))\\,dW_{u}\n$$\n\n**3. 路径梯度估计量 $G(\\theta)$ 及其期望**\n\n估计量为 $G(\\theta) = f'(X_{T}^{\\theta})Y_{T}$。对于 $f(x)=x^2$，我们有 $f'(x)=2x$。\n$$\nG(\\theta) = 2X_{T}^{\\theta}Y_{T}\n$$\n现在我们计算其期望 $\\mathbb{E}[G(\\theta)]$：\n$$\n\\mathbb{E}[G(\\theta)] = 2\\,\\mathbb{E}[X_{T}^{\\theta}Y_{T}]\n$$\n让我们展开乘积 $X_{T}^{\\theta}Y_{T}$：\n$$\nX_{T}^{\\theta}Y_{T} = \\left( x_{0}\\exp(-\\theta T) + \\sigma\\int_{0}^{T} \\exp(-\\theta(T-s))\\,dW_{s} \\right) \\left( -x_{0}T\\exp(-\\theta T) - \\sigma\\int_{0}^{T} (T-u)\\exp(-\\theta(T-u))\\,dW_{u} \\right)\n$$\n取期望时，由于具有确定性被积函数的 Itô 积分的期望为零，因此涉及单个 Itô 积分的交叉项为零。\n$$\n\\mathbb{E}[X_{T}^{\\theta}Y_{T}] = -x_{0}^{2}T\\exp(-2\\theta T) - \\sigma^{2}\\,\\mathbb{E}\\left[ \\left(\\int_{0}^{T} \\exp(-\\theta(T-s))\\,dW_{s}\\right) \\left(\\int_{0}^{T} (T-u)\\exp(-\\theta(T-u))\\,dW_{u}\\right) \\right]\n$$\n使用 Itô 等距性质 $\\mathbb{E}[(\\int g_1 dW)(\\int g_2 dW)] = \\int g_1 g_2 ds$：\n$$\n\\mathbb{E}[\\dots] = \\int_{0}^{T} \\exp(-\\theta(T-s)) \\cdot (T-s)\\exp(-\\theta(T-s))\\,ds = \\int_{0}^{T} (T-s)\\exp(-2\\theta(T-s))\\,ds\n$$\n设 $v=T-s$，则 $dv=-ds$。该积分变为 $\\int_{T}^{0} v\\exp(-2\\theta v)(-dv) = \\int_{0}^{T} v\\exp(-2\\theta v)\\,dv$。\n我们使用分部积分法 $\\int u'v_{int} = uv_{int} - \\int uv'_{int}$ 计算该积分：\n\\begin{align*}\n\\int_{0}^{T} v\\exp(-2\\theta v)\\,dv = \\left[v \\left(\\frac{\\exp(-2\\theta v)}{-2\\theta}\\right)\\right]_{0}^{T} - \\int_{0}^{T} \\frac{\\exp(-2\\theta v)}{-2\\theta} \\cdot 1 \\,dv \\\\\n= -\\frac{T}{2\\theta}\\exp(-2\\theta T) + \\frac{1}{2\\theta} \\int_{0}^{T} \\exp(-2\\theta v)\\,dv \\\\\n= -\\frac{T}{2\\theta}\\exp(-2\\theta T) + \\frac{1}{2\\theta} \\left[\\frac{\\exp(-2\\theta v)}{-2\\theta}\\right]_{0}^{T} \\\\\n= -\\frac{T}{2\\theta}\\exp(-2\\theta T) - \\frac{1}{4\\theta^2}(\\exp(-2\\theta T) - 1)\n\\end{align*}\n将此结果代回 $G(\\theta)$ 的期望中：\n$$\n\\mathbb{E}[G(\\theta)] = 2 \\left( -x_{0}^{2}T\\exp(-2\\theta T) - \\sigma^{2}\\left(-\\frac{T}{2\\theta}\\exp(-2\\theta T) - \\frac{1}{4\\theta^2}\\exp(-2\\theta T) + \\frac{1}{4\\theta^2}\\right) \\right)\n$$\n$$\n\\mathbb{E}[G(\\theta)] = -2x_{0}^{2}T\\exp(-2\\theta T) + \\frac{\\sigma^{2}T}{\\theta}\\exp(-2\\theta T) + \\frac{\\sigma^{2}}{2\\theta^2}\\exp(-2\\theta T) - \\frac{\\sigma^{2}}{2\\theta^2}\n$$\n\n**4. $\\mathbb{E}[f(X_{T}^{\\theta})]$ 的解析导数**\n\n首先，我们求 $F(\\theta) = \\mathbb{E}[f(X_{T}^{\\theta})] = \\mathbb{E}[(X_{T}^{\\theta})^2]$。对于任意随机变量 $Z$，有 $\\mathbb{E}[Z^2] = \\text{Var}(Z) + (\\mathbb{E}[Z])^2$。\n根据 $X_{T}^{\\theta}$ 的解，它是一个高斯随机变量，具有：\n均值：$\\mathbb{E}[X_{T}^{\\theta}] = x_{0}\\exp(-\\theta T)$。\n方差：$\\text{Var}(X_{T}^{\\theta}) = \\mathbb{E}[(\\sigma \\int_{0}^{T} \\exp(-\\theta(T-s))\\,dW_{s})^2] = \\sigma^2 \\int_{0}^{T} \\exp(-2\\theta(T-s))\\,ds$。\n令 $v=T-s$，该积分为 $\\int_{0}^{T} \\exp(-2\\theta v)\\,dv = \\frac{1-\\exp(-2\\theta T)}{2\\theta}$。\n所以，$\\text{Var}(X_{T}^{\\theta}) = \\frac{\\sigma^2}{2\\theta}(1-\\exp(-2\\theta T))$。\n因此，目标量为：\n$$\nF(\\theta) = \\mathbb{E}[(X_{T}^{\\theta})^2] = \\frac{\\sigma^2}{2\\theta}(1-\\exp(-2\\theta T)) + (x_{0}\\exp(-\\theta T))^2\n$$\n$$\nF(\\theta) = \\frac{\\sigma^2}{2\\theta} - \\frac{\\sigma^2}{2\\theta}\\exp(-2\\theta T) + x_{0}^{2}\\exp(-2\\theta T)\n$$\n现在，我们将 $F(\\theta)$ 对 $\\theta$求导：\n$$\n\\nabla_{\\theta}F(\\theta) = \\frac{d}{d\\theta}\\left(\\frac{\\sigma^2}{2}\\theta^{-1} - \\frac{\\sigma^2}{2}\\theta^{-1}\\exp(-2\\theta T) + x_0^2\\exp(-2\\theta T)\\right)\n$$\n逐项微分：\n\\begin{align*}\n\\nabla_{\\theta}F(\\theta) = \\frac{\\sigma^2}{2}(-\\theta^{-2}) - \\frac{\\sigma^2}{2}(-\\theta^{-2}\\exp(-2\\theta T) + \\theta^{-1}(-2T)\\exp(-2\\theta T)) + x_0^2(-2T)\\exp(-2\\theta T) \\\\\n= -\\frac{\\sigma^2}{2\\theta^2} + \\frac{\\sigma^2}{2\\theta^2}\\exp(-2\\theta T) + \\frac{\\sigma^2 T}{\\theta}\\exp(-2\\theta T) - 2x_0^2 T \\exp(-2\\theta T)\n\\end{align*}\n重新整理各项以匹配前面的结果：\n$$\n\\nabla_{\\theta}F(\\theta) = -2x_0^2 T \\exp(-2\\theta T) + \\frac{\\sigma^2 T}{\\theta}\\exp(-2\\theta T) + \\frac{\\sigma^2}{2\\theta^2}\\exp(-2\\theta T) - \\frac{\\sigma^2}{2\\theta^2}\n$$\n\n**5. 比较与结论**\n\n比较第3节中 $\\mathbb{E}[G(\\theta)]$ 的表达式和第4节中 $\\nabla_{\\theta}F(\\theta)$ 的表达式，我们发现它们是相同的：\n$$\n\\mathbb{E}[G(\\theta)] = \\nabla_{\\theta}\\mathbb{E}[f(X_{T}^{\\theta})]\n$$\n这表明路径梯度估计量 $G(\\theta) = f'(X_{T}^{\\theta})\\,Y_{T}$ 是真实梯度 $\\nabla_{\\theta}F(\\theta)$ 的无偏估计量。由于 SDE 的系数相对于参数 $\\theta$ 是光滑的，根据控制收斂定理，在问题的条件下，交换期望和微分算子（即 $\\nabla_{\\theta}\\mathbb{E}[\\cdot] = \\mathbb{E}[\\nabla_{\\theta}\\cdot]$）的有效性得到了保证。\n\n最终答案是 $\\nabla_{\\theta}F(\\theta)$ 的闭式表达式。它可以更紧凑地写成：\n$$\n\\nabla_{\\theta}\\mathbb{E}[f(X_{T}^{\\theta})] = -2x_0^2 T \\exp(-2\\theta T) + \\frac{\\sigma^2}{2\\theta^2}\\left[(1+2\\theta T)\\exp(-2\\theta T) - 1\\right]\n$$\n这就是所要求的解析表达式。",
            "answer": "$$\\boxed{-2x_0^2 T \\exp(-2\\theta T) + \\frac{\\sigma^2}{2\\theta^2} \\left[ (1+2\\theta T)\\exp(-2\\theta T) - 1 \\right]}$$"
        },
        {
            "introduction": "路径微分法并非万能的，其应用有严格的限制。本练习通过一个金融工程中的经典案例——数字期权的Delta计算，揭示了当收益函数不连续时，朴素的路径微分估计为何会失效 。你将从第一性原理出发，解释其偏差的来源，并学习如何运用Malliavin积分-分部积分法绕过对不连续函数的求导，从而得到一个无偏的估计量。",
            "id": "3328492",
            "problem": "考虑风险中性测度下的 Black–Scholes–Merton (BSM) 模型。标的资产价格 $\\{S_{t}\\}_{t \\in [0,T]}$ 满足随机微分方程 $dS_{t} = r S_{t}\\,dt + \\sigma S_{t}\\,dW_{t}$，其中 $S_{0}  0$，无风险利率为 $r \\in \\mathbb{R}$，波动率为 $\\sigma  0$，$\\{W_{t}\\}$ 是一个标准布朗运动。设到期日为 $T  0$，并考虑现金或无价值的数字看涨期权收益 $f(S_{T}) = \\mathbf{1}_{\\{S_{T}  K\\}}$，其执行价格为 $K  0$。风险中性价格为 $V(S_{0}) = \\mathbb{E}\\!\\left[\\exp(-rT)\\,f(S_{T})\\right]$，Delta 值为 $\\Delta(S_{0}) = \\frac{\\partial}{\\partial S_{0}} V(S_{0})$。\n\n请仅使用风险中性定价的基本原理、BSM 随机微分方程的显式强解，以及 Malliavin 微积分中 Malliavin 导数和 Skorohod 积分的核心定义（不得假定使用任何其他快捷公式），完成以下任务：\n\n- 从第一性原理出发，解释为何对于这种不连续收益，路径方法（又称无穷小扰动分析）估计量 $\\mathbb{E}\\!\\left[\\exp(-rT)\\,\\frac{\\partial}{\\partial S_{0}} f(S_{T})\\right]$ 是有偏的，而通过分部积分法得到的 Malliavin 微积分估计量是无偏的。\n\n- 然后，通过推导一个不微分不连续收益的 Malliavin 分部积分表达式，并将所得表达式化简为标准正态期望，以闭式形式计算 Delta 值 $\\Delta(S_{0})$。\n\n请以 $S_{0}$、$K$、$r$、$\\sigma$ 和 $T$ 表示的单一闭式解析表达式给出您的最终答案，使用标准正态密度函数 $\\varphi(\\cdot)$，并在需要时使用标准正态累积分布函数 $\\Phi(\\cdot)$。最终答案不要求数值取整，且不应包含任何单位。",
            "solution": "该问题是有效的，因为它在科学上基于金融数学和随机微积分的既定理论，问题定义良好、客观且自包含。\n\n此问题要求对 Black-Scholes-Merton (BSM) 模型中现金或无价值数字看涨期权的 Delta 值进行两部分分析。首先，我们解释路径导数估计量为何对该期权的不连续收益失效。其次，我们使用分部积分技巧推导 Delta 值的正确闭式表达式，该技巧是解决此类问题的 Malliavin 微积分方法的基础。\n\n在风险中性测度 $\\mathbb{Q}$ 下，标的资产价格 $S_t$ 服从几何布朗運動：\n$$dS_{t} = r S_{t}\\,dt + \\sigma S_{t}\\,dW_{t}$$\n给定初始价格 $S_0$，到期日 $T$ 的资产价格的显式解为：\n$$S_{T} = S_{0} \\exp\\left(\\left(r - \\frac{1}{2}\\sigma^{2}\\right)T + \\sigma W_{T}\\right)$$\n其中 $W_T$ 是一个均值为 $0$、方差为 $T$ 的正态分布随机变量，即 $W_T \\sim \\mathcal{N}(0, T)$。\n\n收益函数为现金或无价值数字看涨期权的形式：$f(S_{T}) = \\mathbf{1}_{\\{S_{T}  K\\}}$，其中 $\\mathbf{1}_{\\{\\cdot\\}}$ 是指示函数。期权的价格为 $V(S_{0}) = \\mathbb{E}_{\\mathbb{Q}}\\!\\left[\\exp(-rT)\\,f(S_{T})\\right]$，Delta 值定义为 $\\Delta(S_{0}) = \\frac{\\partial}{\\partial S_{0}} V(S_{0})$。\n\n**第一部分：路径导数估计量的偏差**\n\nDelta 由 $\\Delta(S_{0}) = \\frac{\\partial}{\\partial S_{0}} \\left( \\exp(-rT) \\mathbb{E}[f(S_T)] \\right)$ 给出。由于 $\\exp(-rT)$ 是关于 $S_0$ 的常数，我们有：\n$$\\Delta(S_{0}) = \\exp(-rT) \\frac{\\partial}{\\partial S_{0}} \\mathbb{E}[f(S_T)]$$\n路径导数估计量，也称为无穷小扰动分析 (IPA)，通过交换微分和期望算子来进行计算。如果这种交换有效，我们将得到：\n$$\\Delta(S_{0}) \\stackrel{?}{=} \\exp(-rT) \\mathbb{E}\\left[\\frac{\\partial}{\\partial S_{0}} f(S_T)\\right]$$\n使用链式法则，期望内的导数为：\n$$\\frac{\\partial}{\\partial S_{0}} f(S_T) = f'(S_T) \\cdot \\frac{\\partial S_T}{\\partial S_0}$$\n根据 $S_T$ 的显式解，我们计算第二项：\n$$\\frac{\\partial S_T}{\\partial S_0} = \\frac{\\partial}{\\partial S_0} \\left( S_{0} \\exp\\left(\\left(r - \\frac{1}{2}\\sigma^{2}\\right)T + \\sigma W_{T}\\right) \\right) = \\exp\\left(\\left(r - \\frac{1}{2}\\sigma^{2}\\right)T + \\sigma W_{T}\\right) = \\frac{S_T}{S_0}$$\n收益函数 $f(x) = \\mathbf{1}_{\\{x  K\\}}$ 是一个以 $K$ 为中心的亥维赛德阶跃函数。其在分布意义下的导数是狄拉克 δ 函数，$f'(x) = \\delta(x-K)$。将这些代入路径法表达式，得到：\n$$\\Delta_{\\text{pathwise}} = \\exp(-rT) \\mathbb{E}\\left[\\delta(S_T - K) \\frac{S_T}{S_0}\\right]$$\n该估计量存在两个根本性缺陷：\n1. **无效交换：** 微分和期望的交换需要被积函数满足一定的正则性条件，例如控制收敛定理所提供的条件。对于任何 $S_T = K$ 的路径，收益函数 $f(S_T)$ 都是不连续的。函数 $\\frac{\\partial}{\\partial S_0} f(S_T)$ 是一个缩放的狄拉克 δ 分布，而不是一个函数，交换算子的条件不满足。这种交换在数学上是无效的。\n2. **计算失败：** 在蒙特卡洛模拟中，我们为 $S_T$ 生成大量路径。由于 $S_T$ 是一个连续随机变量，任何单一路径产生 $S_T = K$ 的概率都恰好为零。因此，对于几乎所有模拟路径，$\\delta(S_T - K)$ 项的计算结果都为 $0$。由此得到的 Delta 的蒙特卡洛估计值将为 $0$，这是不正确的。真实的 Delta 值是非零的。这表明了朴素路径估计量的严重偏差。\n\nMalliavin 微积分方法通过使用分部积分公式，将微分从不连续的收益函数转移到期望中的一个光滑分量上，从而规避了这个问题，得到了一个无偏估计量。\n\n**第二部分：使用 Malliavin 分部积分法推导 Delta**\n\n我们将通过避免对指示函数进行微分来推导 Delta 的闭式表达式。核心思想是将期望表示为一个显式积分，并使用标准的分部积分法。\n\n令 $Z = W_T / \\sqrt{T}$，因此在 $\\mathbb{Q}$ 下 $Z \\sim \\mathcal{N}(0, 1)$。我们可以将 $S_T$ 写成 $S_0$ 和随机变量 $z$ 的函数：\n$$S_{T}(z) = S_{0} \\exp\\left(\\left(r - \\frac{1}{2}\\sigma^{2}\\right)T + \\sigma\\sqrt{T} z\\right)$$\n期望变成了一个关于标准正态概率密度函数 $\\varphi(z) = \\frac{1}{\\sqrt{2\\pi}} \\exp(-z^2/2)$ 的积分：\n$$\\mathbb{E}[f(S_T)] = \\int_{-\\infty}^{\\infty} f(S_T(z)) \\varphi(z) dz$$\n现在，我们可以计算期望关于 $S_0$ 的导数。由于被积函数关于 $S_0$ 具有足够的正则性，我们可以在积分号下进行微分：\n$$\\frac{\\partial}{\\partial S_{0}} \\mathbb{E}[f(S_T)] = \\int_{-\\infty}^{\\infty} \\frac{\\partial}{\\partial S_{0}} \\left[ f(S_T(z)) \\right] \\varphi(z) dz$$\n应用链式法则：\n$$\\frac{\\partial}{\\partial S_0} f(S_T(z)) = f'(S_T(z)) \\frac{\\partial S_T(z)}{\\partial S_0} = f'(S_T(z)) \\frac{S_T(z)}{S_0}$$\n这就回到了有问题的 $f'$ 项：\n$$\\frac{\\partial}{\\partial S_{0}} \\mathbb{E}[f(S_T)] = \\frac{1}{S_0} \\int_{-\\infty}^{\\infty} f'(S_T(z)) S_T(z) \\varphi(z) dz$$\n这里就需要应用分部积分法，它是 Malliavin 微积分原理的一个特例。我们将关于 $f$ 的自变量的导数与关于 $z$ 的导数联系起来：\n$$\\frac{df(S_T(z))}{dz} = f'(S_T(z)) \\frac{d S_T(z)}{dz} = f'(S_T(z)) \\left( S_0 \\exp\\left(\\dots\\right) \\cdot \\sigma\\sqrt{T} \\right) = f'(S_T(z)) S_T(z) \\sigma\\sqrt{T}$$\n我们可以将 $f'(S_T(z)) S_T(z)$ 表示为：\n$$f'(S_T(z)) S_T(z) = \\frac{1}{\\sigma\\sqrt{T}} \\frac{df(S_T(z))}{dz}$$\n将此代入灵敏度的积分中：\n$$\\frac{\\partial}{\\partial S_0} \\mathbb{E}[f(S_T)] = \\frac{1}{S_0 \\sigma \\sqrt{T}} \\int_{-\\infty}^{\\infty} \\frac{df(S_T(z))}{dz} \\varphi(z) dz$$\n现在我们对关于 $z$ 的积分执行标准的分部积分。令 $u(z) = \\varphi(z)$ 和 $dv = \\frac{df(S_T(z))}{dz} dz$。则 $du = \\varphi'(z) dz$ 且 $v = f(S_T(z))$。\n$$ \\int_{-\\infty}^{\\infty} u dv = \\left[ uv \\right]_{-\\infty}^{\\infty} - \\int_{-\\infty}^{\\infty} v du = \\left[ \\varphi(z) f(S_T(z)) \\right]_{-\\infty}^{\\infty} - \\int_{-\\infty}^{\\infty} f(S_T(z)) \\varphi'(z) dz $$\n边界项消失，因为当 $z \\to \\pm\\infty$ 时 $\\varphi(z) \\to 0$，并且 $f(S_T(z))$ 是有界的（在 $0$ 和 $1$ 之间）。对于剩余的积分，我们使用恒等式 $\\varphi'(z) = -z\\varphi(z)$：\n$$ - \\int_{-\\infty}^{\\infty} f(S_T(z)) (-z\\varphi(z)) dz = \\int_{-\\infty}^{\\infty} f(S_T(z)) z \\varphi(z) dz = \\mathbb{E}[f(S_T) Z] $$\n结合我们的结果，我们得到导数的分部积分公式：\n$$\\frac{\\partial}{\\partial S_0} \\mathbb{E}[f(S_T)] = \\frac{1}{S_0 \\sigma \\sqrt{T}} \\mathbb{E}[f(S_T) Z] = \\frac{1}{S_0 \\sigma T} \\mathbb{E}[f(S_T) W_T]$$\n这给了我们一个不涉及对收益函数微分的 Delta 表达式：\n$$\\Delta(S_0) = \\exp(-rT) \\frac{\\mathbb{E}[f(S_T) W_T]}{S_0 \\sigma T}$$\n这个表达式是无偏的，并且适用于蒙特卡洛估计。\n\n最后，我们通过计算期望来求解闭式解：\n$$\\mathbb{E}[f(S_T) Z] = \\mathbb{E}[\\mathbf{1}_{\\{S_T  K\\}} Z] = \\int_{-\\infty}^{\\infty} \\mathbf{1}_{\\{S_T(z)  K\\}} z \\varphi(z) dz$$\n条件 $S_T(z)  K$ 定义了 $z$ 的积分区域：\n$$S_0 \\exp\\left(\\left(r - \\frac{\\sigma^2}{2}\\right)T + \\sigma\\sqrt{T} z\\right)  K$$\n$$\\ln(S_0) + \\left(r - \\frac{\\sigma^2}{2}\\right)T + \\sigma\\sqrt{T} z  \\ln(K)$$\n$$\\sigma\\sqrt{T} z  \\ln(K/S_0) - \\left(r - \\frac{\\sigma^2}{2}\\right)T$$\n$$z  \\frac{\\ln(K/S_0) - (r - \\frac{\\sigma^2}{2})T}{\\sigma\\sqrt{T}} = - \\frac{\\ln(S_0/K) + (r - \\frac{\\sigma^2}{2})T}{\\sigma\\sqrt{T}}$$\n我们定义标准的 BSM 项 $d_2$：\n$$d_2 = \\frac{\\ln(S_0/K) + (r - \\frac{\\sigma^2}{2})T}{\\sigma\\sqrt{T}}$$\n该条件变为 $z  -d_2$。因此期望积分为：\n$$\\mathbb{E}[f(S_T) Z] = \\int_{-d_2}^{\\infty} z \\varphi(z) dz = \\int_{-d_2}^{\\infty} z \\frac{1}{\\sqrt{2\\pi}} \\exp(-z^2/2) dz$$\n这个积分可以直接求解：\n$$\\int_{-d_2}^{\\infty} z \\frac{1}{\\sqrt{2\\pi}} \\exp(-z^2/2) dz = -\\frac{1}{\\sqrt{2\\pi}} \\left[ \\exp(-z^2/2) \\right]_{-d_2}^{\\infty} = -\\frac{1}{\\sqrt{2\\pi}} (0 - \\exp(-(-d_2)^2/2)) = \\frac{1}{\\sqrt{2\\pi}} \\exp(-d_2^2/2) = \\varphi(d_2)$$\n将此结果代回我们的 Delta 表达式中：\n$$\\Delta(S_0) = \\exp(-rT) \\frac{1}{S_0 \\sigma \\sqrt{T}} \\mathbb{E}[f(S_T) Z] = \\frac{\\exp(-rT) \\varphi(d_2)}{S_0 \\sigma \\sqrt{T}}$$\n\n这就是现金或无价值数字看涨期权 Delta 值的最终闭式表达式。它正确地依赖于决策边界处的概率密度，这正是 $\\varphi(d_2)$ 项所代表的含义。",
            "answer": "$$\\boxed{\\frac{\\exp(-rT)\\,\\varphi\\left(\\frac{\\ln(S_{0}/K) + (r - \\frac{1}{2}\\sigma^{2})T}{\\sigma\\sqrt{T}}\\right)}{S_{0}\\sigma\\sqrt{T}}}$$"
        },
        {
            "introduction": "在掌握了有限时间范围内的路径微分法后，我们将视角转向稳态系统。本练习要求你计算Ornstein-Uhlenbeck过程在稳态分布下的参数灵敏度，并采用两种截然不同的方法：路径切线过程法和无穷小生成元与泊松方程法 。通过验证两种方法得到相同的结果，你将深化对路径微分法背后数学原理的理解，并将其与马尔可夫过程的算子理论联系起来。",
            "id": "3328470",
            "problem": "考虑 Ornstein–Uhlenbeck (OU) 扩散，这是一个常用于随机微分方程 (SDE) 建模的线性马尔可夫过程，由下式给出\n$$\ndX_t \\;=\\; -\\,\\theta\\,X_t\\,dt \\;+\\; \\sigma\\,dW_t,\n$$\n其中 $\\theta0$ 和 $\\sigma0$ 是参数，$W_t$ 是一个标准维纳过程。假设该过程在其唯一的平稳不变分布 $\\pi_\\theta$ 中初始化，因此关于 $\\pi_\\theta$ 的期望是与时间无关的。\n\n设 $h(x)=x^{2}$。你的任务是使用两种基于基本原理的不同方法计算参数敏感度 $\\partial_{\\theta}\\,\\mathbb{E}_{\\pi_\\theta}[h(X)]$，并验证它们的结果一致。\n\na) 使用 OU 过程的无穷小生成元 $L_\\theta$ 和平稳泊松方程，从以下定义出发：\n$$\nL_\\theta f(x) \\;=\\; -\\,\\theta\\,x\\,f'(x) \\;+\\; \\frac{\\sigma^{2}}{2}\\,f''(x),\n$$\n和平稳泊松方程\n$$\nL_\\theta g_\\theta(x) \\;=\\; h(x) \\;-\\; \\mathbb{E}_{\\pi_\\theta}[h(X)].\n$$\n从第一性原理推导出一个用 $(\\partial_\\theta L_\\theta)$ 和泊松方程的解 $g_\\theta$ 表示 $\\partial_{\\theta}\\,\\mathbb{E}_{\\pi_\\theta}[h(X)]$ 的表达式。然后在 OU 情况下显式求解 $g_\\theta$，并计算所得表达式以得到 $\\partial_{\\theta}\\,\\mathbb{E}_{\\pi_\\theta}[X^{2}]$。\n\nb) 使用路径向（切向）过程方法，对 SDE 路径关于 $\\theta$ 求导，得到切向过程 $Y_t=\\partial_\\theta X_t$ 的线性 SDE。从漂移项的线性化以及扩散系数不依赖于 $\\theta$ 这两点来论证该切向 SDE 的形式，然后使用伊藤微积分和平稳性推导出 $\\mathbb{E}_{\\pi_\\theta}[X_t Y_t]$ 的一个显式稳态公式。从而得出结论：\n$$\n\\partial_{\\theta}\\,\\mathbb{E}_{\\pi_\\theta}[X^{2}] \\;=\\; \\mathbb{E}_{\\pi_\\theta}\\big[2\\,X\\,Y\\big],\n$$\n并计算其值。\n\nc) 验证在 (a) 和 (b) 部分得到的答案相等。将最终答案表示为关于 $\\theta$ 和 $\\sigma$ 的单一闭式解析表达式。无需进行数值四舍五入。",
            "solution": "本题要求计算 Ornstein-Uhlenbeck (OU) 过程的参数敏感度 $\\partial_{\\theta}\\,\\mathbb{E}_{\\pi_\\theta}[X^{2}]$，其中 $X_t$ 遵循随机微分方程 (SDE) $dX_t = -\\theta X_t dt + \\sigma dW_t$。这里，$\\theta  0$ 和 $\\sigma  0$ 是参数，且过程处于其平稳分布 $\\pi_\\theta$ 中。\n\n首先，我们确定平稳分布 $\\pi_\\theta$。OU 过程是一个高斯过程。其平稳分布是一个均值为 $0$、方差为 $\\frac{\\sigma^2}{2\\theta}$ 的正态分布。因此，$\\pi_\\theta = \\mathcal{N}(0, \\frac{\\sigma^2}{2\\theta})$。\n在此分布下，$h(X) = X^2$ 的期望即为方差：\n$$\n\\mathbb{E}_{\\pi_\\theta}[X^2] = \\frac{\\sigma^2}{2\\theta}\n$$\n我们可以通过对该表达式关于 $\\theta$ 求导来直接计算敏感度：\n$$\n\\partial_{\\theta}\\,\\mathbb{E}_{\\pi_\\theta}[X^2] = \\partial_{\\theta} \\left( \\frac{\\sigma^2}{2\\theta} \\right) = \\frac{\\sigma^2}{2} \\partial_{\\theta}(\\theta^{-1}) = \\frac{\\sigma^2}{2} (-\\theta^{-2}) = -\\frac{\\sigma^2}{2\\theta^2}\n$$\n这就是我们期望通过题目中规定的两种方法得到的值。\n\na) **无穷小生成元与泊松方程法**\n\n该方法基于线性算子的微扰理论。敏感度 $\\partial_{\\theta} \\mathbb{E}_{\\pi_\\theta}[h(X)]$ 可以用涉及无穷小生成元 $L_\\theta$ 的泊松方程的解来表示。\n\n将敏感度与泊松方程的解联系起来的通用公式是：\n$$\n\\partial_{\\theta} \\mathbb{E}_{\\pi_\\theta}[h(X)] = - \\mathbb{E}_{\\pi_\\theta}[(\\partial_{\\theta} L_{\\theta})g_{\\theta}(X)]\n$$\n其中 $g_\\theta$ 是平稳泊松方程 $L_\\theta g_\\theta(x) = h(x) - \\mathbb{E}_{\\pi_\\theta}[h(X)]$ 的解。\n\n对于给定的 OU 过程，无穷小生成元为：\n$$\nL_\\theta f(x) = -\\theta x f'(x) + \\frac{\\sigma^2}{2} f''(x)\n$$\n我们计算算子 $L_\\theta$ 关于 $\\theta$ 的偏导数，并将 $f$ 视为与 $\\theta$ 无关：\n$$\n(\\partial_{\\theta} L_{\\theta})f(x) = \\partial_{\\theta} \\left( -\\theta x f'(x) + \\frac{\\sigma^2}{2} f''(x) \\right) = -x f'(x)\n$$\n因此，敏感度公式变为：\n$$\n\\partial_{\\theta} \\mathbb{E}_{\\pi_\\theta}[X^2] = - \\mathbb{E}_{\\pi_\\theta}[ -X g'_{\\theta}(X) ] = \\mathbb{E}_{\\pi_\\theta}[X g'_{\\theta}(X)]\n$$\n接下来，我们求解 $g_\\theta(x)$ 的泊松方程。我们有 $h(x) = x^2$ 且已确定 $\\mathbb{E}_{\\pi_\\theta}[X^2] = \\frac{\\sigma^2}{2\\theta}$。泊松方程为：\n$$\nL_\\theta g_\\theta(x) = x^2 - \\frac{\\sigma^2}{2\\theta}\n$$\n$$\n-\\theta x g'_{\\theta}(x) + \\frac{\\sigma^2}{2} g''_{\\theta}(x) = x^2 - \\frac{\\sigma^2}{2\\theta}\n$$\n由于右侧是一个 2 次多项式，我们假设 $g_\\theta(x)$ 具有多项式形式，设 $g_\\theta(x) = Ax^2 + Bx + C$。\n其导数为 $g'_\\theta(x) = 2Ax + B$ 和 $g''_\\theta(x) = 2A$。将这些代入方程中：\n$$\n-\\theta x (2Ax + B) + \\frac{\\sigma^2}{2} (2A) = x^2 - \\frac{\\sigma^2}{2\\theta}\n$$\n$$\n-2A\\theta x^2 - B\\theta x + A\\sigma^2 = 1 \\cdot x^2 + 0 \\cdot x - \\frac{\\sigma^2}{2\\theta}\n$$\n通过比较两边 $x$ 各次幂的系数：\n- $x^2$ 的系数：$-2A\\theta = 1 \\implies A = -\\frac{1}{2\\theta}$\n- $x$ 的系数：$-B\\theta = 0 \\implies B = 0$\n- 常数项：$A\\sigma^2 = -\\frac{\\sigma^2}{2\\theta}$。代入 $A = -\\frac{1}{2\\theta}$，我们得到 $(-\\frac{1}{2\\theta})\\sigma^2 = -\\frac{\\sigma^2}{2\\theta}$，结果一致。\n\n解为 $g_\\theta(x) = -\\frac{1}{2\\theta}x^2 + C$。常数 $C$ 是任意的，不影响导数 $g'_\\theta(x)$。我们可以设 $C=0$。\n所以，$g_\\theta(x) = -\\frac{1}{2\\theta}x^2$。\n其导数为 $g'_\\theta(x) = -\\frac{x}{\\theta}$。\n\n最后，我们计算敏感度的表达式：\n$$\n\\partial_{\\theta} \\mathbb{E}_{\\pi_\\theta}[X^2] = \\mathbb{E}_{\\pi_\\theta}[X g'_{\\theta}(X)] = \\mathbb{E}_{\\pi_\\theta}\\left[X \\left(-\\frac{X}{\\theta}\\right)\\right] = -\\frac{1}{\\theta} \\mathbb{E}_{\\pi_\\theta}[X^2]\n$$\n代入平稳方差的值 $\\mathbb{E}_{\\pi_\\theta}[X^2] = \\frac{\\sigma^2}{2\\theta}$：\n$$\n\\partial_{\\theta} \\mathbb{E}_{\\pi_\\theta}[X^2] = -\\frac{1}{\\theta} \\left(\\frac{\\sigma^2}{2\\theta}\\right) = -\\frac{\\sigma^2}{2\\theta^2}\n$$\n这证实了通过直接求导得到的结果。\n\nb) **路径向（切向）过程法**\n\n该方法涉及对 SDE 路径关于参数 $\\theta$ 求导。令 $Y_t = \\partial_{\\theta} X_t$ 为切向过程。我们通过对 OU SDE 进行形式上的求导来推导 $Y_t$ 的 SDE，假设驱动的维纳过程 $W_t$ 与 $\\theta$ 无关。\n$$\ndX_t = -\\theta X_t dt + \\sigma dW_t\n$$\n关于 $\\theta$ 求导：\n$$\nd(\\partial_{\\theta} X_t) = \\partial_{\\theta}(-\\theta X_t) dt + \\partial_{\\theta}(\\sigma dW_t)\n$$\n对漂移项使用乘法法则，并注意 $\\sigma$ 与 $\\theta$ 无关：\n$$\ndY_t = (-X_t - \\theta \\partial_{\\theta} X_t) dt + 0 = (-X_t - \\theta Y_t) dt\n$$\n因此，切向过程 $Y_t$ 满足常微分方程 $dY_t = (-X_t - \\theta Y_t) dt$，其中路径 $X_t$ 作为一个时变驱动项。这是一个不含扩散项的线性 SDE。\n\n题目要求我们使用恒等式 $\\partial_{\\theta} \\mathbb{E}_{\\pi_\\theta}[X^2] = \\mathbb{E}_{\\pi_\\theta}[2XY]$ 来计算 $\\partial_{\\theta} \\mathbb{E}_{\\pi_\\theta}[X^2]$。这个恒等式来自于交换期望和微分的运算，这对该过程是成立的。要使用它，我们需要计算平稳期望 $\\mathbb{E}_{\\pi_\\theta}[XY]$。\n\n我们对过程 $Z_t = X_t Y_t$ 使用伊藤乘积法则：\n$$\nd(X_t Y_t) = Y_t dX_t + X_t dY_t + d\\langle X, Y \\rangle_t\n$$\n二次协变项 $d\\langle X, Y \\rangle_t$ 为零，因为 $Y_t$ 没有扩散分量（其 SDE 中含有 $0 \\cdot dW_t$）。\n代入 $X_t$ 和 $Y_t$ 的 SDE：\n$$\nd(X_t Y_t) = Y_t (-\\theta X_t dt + \\sigma dW_t) + X_t (-X_t - \\theta Y_t) dt\n$$\n$$\nd(X_t Y_t) = -\\theta X_t Y_t dt + \\sigma Y_t dW_t - X_t^2 dt - \\theta X_t Y_t dt\n$$\n$$\nd(X_t Y_t) = (-2\\theta X_t Y_t - X_t^2) dt + \\sigma Y_t dW_t\n$$\n现在，我们对这个微分形式取期望。随机积分项 $\\mathbb{E}[\\int_0^t \\sigma Y_s dW_s]$ 的期望为零。\n$$\nd\\mathbb{E}[X_t Y_t] = \\mathbb{E}[-2\\theta X_t Y_t - X_t^2] dt = (-2\\theta \\mathbb{E}[X_t Y_t] - \\mathbb{E}[X_t^2]) dt\n$$\n在稳态下，所有期望都与时间无关，因此 $\\frac{d}{dt}\\mathbb{E}_{\\pi_\\theta}[XY] = 0$。这意味着：\n$$\n0 = -2\\theta \\mathbb{E}_{\\pi_\\theta}[XY] - \\mathbb{E}_{\\pi_\\theta}[X^2]\n$$\n求解 $\\mathbb{E}_{\\pi_\\theta}[XY]$，我们得到所要求的显式稳态公式：\n$$\n\\mathbb{E}_{\\pi_\\theta}[XY] = -\\frac{\\mathbb{E}_{\\pi_\\theta}[X^2]}{2\\theta}\n$$\n现在我们使用给定的敏感度恒等式：\n$$\n\\partial_{\\theta} \\mathbb{E}_{\\pi_\\theta}[X^2] = \\mathbb{E}_{\\pi_\\theta}[2XY] = 2 \\mathbb{E}_{\\pi_\\theta}[XY] = 2 \\left(-\\frac{\\mathbb{E}_{\\pi_\\theta}[X^2]}{2\\theta}\\right) = -\\frac{\\mathbb{E}_{\\pi_\\theta}[X^2]}{\\theta}\n$$\n代入 $\\mathbb{E}_{\\pi_\\theta}[X^2] = \\frac{\\sigma^2}{2\\theta}$：\n$$\n\\partial_{\\theta} \\mathbb{E}_{\\pi_\\theta}[X^2] = -\\frac{1}{\\theta} \\left(\\frac{\\sigma^2}{2\\theta}\\right) = -\\frac{\\sigma^2}{2\\theta^2}\n$$\n这个结果与通过生成元方法得到的结果相同。\n\nc) **验证**\n\n第一种方法，使用无穷小生成元和泊松方程，得出的结果是：\n$$\n\\partial_{\\theta} \\mathbb{E}_{\\pi_\\theta}[X^2] = -\\frac{\\sigma^2}{2\\theta^2}\n$$\n第二种方法，使用路径向求导（切向过程），得出的结果是：\n$$\n\\partial_{\\theta} \\mathbb{E}_{\\pi_\\theta}[X^2] = -\\frac{\\sigma^2}{2\\theta^2}\n$$\n两种方法都得出了相同的闭式解析表达式。这证实了两种方法的有效性以及计算的正确性。最终答案就是该表达式本身。",
            "answer": "$$\n\\boxed{-\\frac{\\sigma^{2}}{2\\theta^{2}}}\n$$"
        }
    ]
}