{
    "hands_on_practices": [
        {
            "introduction": "A robust implementation of any finite element method begins with a solid understanding of its underlying mathematical framework. For electromagnetics, the spectral element method relies on special curl-conforming vector function spaces, known as Nédélec spaces, to correctly represent the behavior of electric and magnetic fields. This practice provides a foundational exercise in analyzing these spaces, asking you to derive the number of degrees of freedom for a standard hexahedral element and verify its consistency within the broader structure of the discrete de Rham sequence . Mastering this concept is the first step toward building a correct and stable electromagnetic solver.",
            "id": "3350019",
            "problem": "Let $K$ be the reference hexahedron in three spatial dimensions, and let $\\mathcal{Q}_{a,b,c}$ denote the tensor-product polynomial space on $K$ consisting of polynomials of degree at most $a$, $b$, and $c$ in the first, second, and third coordinate, respectively. Consider the first-family Nédélec $H(\\mathrm{curl})$-conforming spectral element space on $K$ of polynomial order $p \\geq 1$, built from tensor-product polynomials, defined componentwise as\n$$\n\\mathcal{N}_{p}(K) \\equiv \\left[\\mathcal{Q}_{p-1,p,p}\\right] \\times \\left[\\mathcal{Q}_{p,p-1,p}\\right] \\times \\left[\\mathcal{Q}_{p,p,p-1}\\right].\n$$\nStarting from the tensor-product definition $\\dim \\mathcal{Q}_{a,b,c} = (a+1)(b+1)(c+1)$ and the discrete de Rham sequence on $K$\n$$\n\\mathcal{Q}_{p,p,p} \\xrightarrow{\\ \\nabla\\ } \\mathcal{N}_{p}(K) \\xrightarrow{\\ \\nabla \\times\\ } \\mathcal{R}\\mathcal{T}_{p}(K) \\xrightarrow{\\ \\nabla \\cdot\\ } \\mathcal{Q}_{p-1,p-1,p-1},\n$$\nwhere the Raviart–Thomas $H(\\mathrm{div})$ space is given by\n$$\n\\mathcal{R}\\mathcal{T}_{p}(K) \\equiv \\left[\\mathcal{Q}_{p,p-1,p-1}\\right] \\times \\left[\\mathcal{Q}_{p-1,p,p-1}\\right] \\times \\left[\\mathcal{Q}_{p-1,p-1,p}\\right],\n$$\nderive the closed-form expression for $\\dim \\mathcal{N}_{p}(K)$ as a function of $p$, and verify by dimension counting that it is consistent with the exactness of the above discrete sequence (that is, that the alternating sum identity implied by exactness holds). Provide your final answer as a single analytic expression in terms of $p$. No rounding is required and no units should be included.",
            "solution": "The problem as stated is scientifically sound, self-contained, and well-posed. It involves standard definitions and concepts from the theory of finite element exterior calculus. We may proceed with the solution.\n\nThe problem asks for two main tasks: first, to derive the dimension of the Nédélec space $\\mathcal{N}_{p}(K)$, and second, to verify this dimension by checking its consistency with the provided discrete de Rham sequence.\n\nThe first-family Nédélec $H(\\mathrm{curl})$-conforming space of polynomial order $p \\geq 1$ on the reference hexahedron $K$ is defined componentwise as a Cartesian product of tensor-product polynomial spaces:\n$$\n\\mathcal{N}_{p}(K) \\equiv \\left[\\mathcal{Q}_{p-1,p,p}\\right] \\times \\left[\\mathcal{Q}_{p,p-1,p}\\right] \\times \\left[\\mathcal{Q}_{p,p,p-1}\\right].\n$$\nThe dimension of a vector space defined as a Cartesian product of other vector spaces is the sum of the dimensions of its constituent spaces. Therefore, the dimension of $\\mathcal{N}_{p}(K)$ is given by:\n$$\n\\dim \\mathcal{N}_{p}(K) = \\dim \\mathcal{Q}_{p-1,p,p} + \\dim \\mathcal{Q}_{p,p-1,p} + \\dim \\mathcal{Q}_{p,p,p-1}.\n$$\nWe are given the formula for the dimension of the tensor-product polynomial space $\\mathcal{Q}_{a,b,c}$:\n$$\n\\dim \\mathcal{Q}_{a,b,c} = (a+1)(b+1)(c+1).\n$$\nApplying this formula to each of the component spaces of $\\mathcal{N}_{p}(K)$:\n\\begin{itemize}\n    \\item $\\dim \\mathcal{Q}_{p-1,p,p} = ((p-1)+1)(p+1)(p+1) = p(p+1)^{2}$\n    \\item $\\dim \\mathcal{Q}_{p,p-1,p} = (p+1)((p-1)+1)(p+1) = (p+1)p(p+1) = p(p+1)^{2}$\n    \\item $\\dim \\mathcal{Q}_{p,p,p-1} = (p+1)(p+1)((p-1)+1) = (p+1)^{2}p = p(p+1)^{2}$\n\\end{itemize}\nSumming these dimensions yields the total dimension of $\\mathcal{N}_{p}(K)$:\n$$\n\\dim \\mathcal{N}_{p}(K) = p(p+1)^{2} + p(p+1)^{2} + p(p+1)^{2} = 3p(p+1)^{2}.\n$$\nExpanding this polynomial gives $3p(p^{2}+2p+1) = 3p^{3}+6p^{2}+3p$.\n\nNext, we verify this result using the property of exactness for the provided discrete de Rham sequence. The full sequence, including the standard initial and terminal spaces, is:\n$$\n0 \\rightarrow \\mathbb{R} \\xrightarrow{\\ i\\ } \\mathcal{Q}_{p,p,p} \\xrightarrow{\\ \\nabla\\ } \\mathcal{N}_{p}(K) \\xrightarrow{\\ \\nabla \\times\\ } \\mathcal{R}\\mathcal{T}_{p}(K) \\xrightarrow{\\ \\nabla \\cdot\\ } \\mathcal{Q}_{p-1,p-1,p-1} \\rightarrow 0\n$$\nwhere $i$ is the inclusion of constant functions. For a finite-dimensional sequence of vector spaces to be exact, the alternating sum of the dimensions of the spaces must be zero. Let the spaces be denoted $W_0 = \\mathbb{R}$, $W_1 = \\mathcal{Q}_{p,p,p}$, $W_2 = \\mathcal{N}_{p}(K)$, $W_3 = \\mathcal{R}\\mathcal{T}_{p}(K)$, and $W_4 = \\mathcal{Q}_{p-1,p-1,p-1}$. The exactness condition implies:\n$$\n\\dim W_0 - \\dim W_1 + \\dim W_2 - \\dim W_3 + \\dim W_4 = 0.\n$$\nWe must compute the dimension of each space in the sequence:\n\\begin{itemize}\n    \\item $\\dim W_0 = \\dim \\mathbb{R} = 1$.\n    \\item $\\dim W_1 = \\dim \\mathcal{Q}_{p,p,p} = (p+1)(p+1)(p+1) = (p+1)^{3}$.\n    \\item $\\dim W_2 = \\dim \\mathcal{N}_{p}(K) = 3p(p+1)^{2}$, as derived above.\n    \\item $\\dim W_3 = \\dim \\mathcal{R}\\mathcal{T}_{p}(K)$. The Raviart-Thomas space is defined as $\\mathcal{R}\\mathcal{T}_{p}(K) \\equiv \\left[\\mathcal{Q}_{p,p-1,p-1}\\right] \\times \\left[\\mathcal{Q}_{p-1,p,p-1}\\right] \\times \\left[\\mathcal{Q}_{p-1,p-1,p}\\right]$. Its dimension is the sum of the dimensions of its components:\n    $$\n    \\dim \\mathcal{R}\\mathcal{T}_{p}(K) = \\dim \\mathcal{Q}_{p,p-1,p-1} + \\dim \\mathcal{Q}_{p-1,p,p-1} + \\dim \\mathcal{Q}_{p-1,p-1,p}.\n    $$\n    Each component has dimension $(p+1)((p-1)+1)((p-1)+1) = (p+1)p^{2}$. Thus,\n    $$\n    \\dim \\mathcal{R}\\mathcal{T}_{p}(K) = 3p^{2}(p+1).\n    $$\n    \\item $\\dim W_4 = \\dim \\mathcal{Q}_{p-1,p-1,p-1} = ((p-1)+1)((p-1)+1)((p-1)+1) = p^{3}$.\n\\end{itemize}\nSubstituting these dimensions into the alternating sum equation:\n$$\n1 - (p+1)^{3} + 3p(p+1)^{2} - 3p^{2}(p+1) + p^{3}.\n$$\nTo verify that this sum is zero, we expand the terms:\n\\begin{itemize}\n    \\item $(p+1)^{3} = p^{3} + 3p^{2} + 3p + 1$\n    \\item $3p(p+1)^{2} = 3p(p^{2} + 2p + 1) = 3p^{3} + 6p^{2} + 3p$\n    \\item $3p^{2}(p+1) = 3p^{3} + 3p^{2}$\n\\end{itemize}\nThe sum becomes:\n$$\n1 - (p^{3} + 3p^{2} + 3p + 1) + (3p^{3} + 6p^{2} + 3p) - (3p^{3} + 3p^{2}) + p^{3}.\n$$\nCollecting terms by powers of $p$:\n\\begin{itemize}\n    \\item $p^{3}$: $-1 + 3 - 3 + 1 = 0$\n    \\item $p^{2}$: $-3 + 6 - 3 = 0$\n    \\item $p$: $-3 + 3 = 0$\n    \\item Constant: $1 - 1 = 0$\n\\end{itemize}\nThe sum is identically zero for any $p$. Alternatively, one can recognize the expression (less the leading $1$) as a binomial expansion. Let $A=p$ and $B=p+1$. The sum can be written as:\n$$\n1 - B^{3} + 3(B-1)B^{2} - 3(B-1)^{2}B + (B-1)^{3} = 1 + \\left( -B^{3} + 3B^{2}(B-1) - 3B(B-1)^{2} + (B-1)^{3} \\right).\n$$\nThis is $1 + ((B-1) - B)^{3} = 1 + (-1)^{3} = 1 - 1 = 0$.\nThe dimension counting is consistent with the exactness of the sequence, thereby verifying our derived dimension for $\\mathcal{N}_{p}(K)$. The final answer is the closed-form expression for this dimension.",
            "answer": "$$\n\\boxed{3p(p+1)^{2}}\n$$"
        },
        {
            "introduction": "A common concern with high-order methods is their potential computational cost, as a large number of basis functions can lead to very large and dense element matrices. However, the efficiency of the spectral element method hinges on avoiding the formation of these matrices altogether. This exercise explores the core of SEM's performance: the sum-factorization technique, which exploits the tensor-product structure of the basis functions to apply operators like the curl-curl with dramatically reduced computational complexity . By analyzing the operation count, you will see how the cost scales much more favorably than a naive implementation, making high-order accuracy computationally feasible.",
            "id": "3349976",
            "problem": "Consider the frequency-domain Maxwell equations in a homogeneous, isotropic medium with constant permittivity and permeability, where the electric field $\\mathbf{E}$ satisfies the vector Helmholtz form $\\nabla \\times \\nabla \\times \\mathbf{E} - k^{2} \\mathbf{E} = \\mathbf{J}$. Focus on the element-local application of the curl-curl operator $\\nabla \\times \\nabla \\times \\mathbf{E}$ in a Spectral Element Method (SEM) on a single affine hexahedral element. Use a tensor-product Lagrange basis of degree $p$ with Gauss–Lobatto–Legendre (GLL) nodes in each one-dimensional coordinate, so that there are $N = p+1$ nodes per coordinate and $N^{3}$ nodes per element. Assume the mapping from the reference element to the physical element is affine, with constant geometric factors and Jacobian, so that metric terms are constant and can be ignored for operation counting at leading order.\n\nDefine the one-dimensional nodal basis functions $\\ell_{i}(\\xi)$, for $i = 0,\\dots,p$, on the reference interval with GLL nodes, and let the one-dimensional derivative matrix $D$ be the dense $(N \\times N)$ matrix with entries $D_{\\alpha\\beta} = \\frac{\\mathrm{d}\\ell_{\\beta}}{\\mathrm{d}\\xi}$ evaluated at the node $\\xi_{\\alpha}$. The three-dimensional tensor-product basis on the reference element $[-1,1]^{3}$ is $\\ell_{i}(\\xi)\\,\\ell_{j}(\\eta)\\,\\ell_{k}(\\zeta)$. The discrete vector field $\\mathbf{E}$ has three components, each represented on the same tensor-product grid. Consider a matrix-free, element-local operator application in which all derivatives and contractions are performed by sum-factorization, that is, by applying one-dimensional transforms along lines of fixed indices in the tensor-product grid rather than forming dense three-dimensional matrices.\n\nStarting from the weak form of the curl-curl operator and the definition of the tensor-product basis, derive the sum-factorized plan for evaluating the curl $\\nabla \\times \\mathbf{E}$ at the $N^{3}$ grid points and then accumulating the weak form contributions back to the nodal coefficients. In your derivation, treat each application of a one-dimensional $(N \\times N)$ derivative matrix to a line of length $N$ as costing $N^{2}$ scalar Floating-Point Multiply-Add (FMA) operations. Count only the leading-order operation terms and ignore all $O(N^{3})$ costs such as pointwise linear combinations, constant metric scalings, and diagonal mass operations.\n\nThen, analytically compare the leading-order operation count for a naive dense approach that applies a fully assembled element-local matrix of size $(3N^{3} \\times 3N^{3})$ to a vector, with the leading-order operation count for the sum-factorized approach. Finally, state the closed-form expression (in terms of $p$) for the leading-order number of FMA operations per element required to apply the curl-curl operator using sum-factorization.\n\nExpress your final answer as a single closed-form expression in $p$. No units are required. No rounding is required.",
            "solution": "The problem requires an analysis of the computational cost for applying the element-local curl-curl operator, $\\nabla \\times \\nabla \\times (\\cdot)$, within a Spectral Element Method (SEM) framework. We are asked to derive the operation count for a matrix-free sum-factorized approach and compare it to a naive dense matrix-vector product, providing the final cost in terms of the polynomial degree $p$.\n\nFirst, we establish the unit of computational work. A Floating-Point Multiply-Add (FMA) operation is a fused operation that computes $d = a \\times b + c$ and is counted as a single operation.\n\nThe core of the problem lies in evaluating the weak-form contribution from a single hexahedral element $\\Omega_e$. For a vector test function $\\mathbf{v}$ and the electric field $\\mathbf{E}$, this contribution is given by the integral:\n$$\n\\int_{\\Omega_e} (\\nabla \\times \\mathbf{v}) \\cdot (\\nabla \\times \\mathbf{E}) \\, dV\n$$\nTo analyze the computational cost, we map this integral to a reference element $\\hat{\\Omega} = [-1,1]^3$. Let the affine mapping be $\\mathbf{x}(\\boldsymbol{\\xi}) = F \\boldsymbol{\\xi} + \\mathbf{c}$, where $\\mathbf{x} = (x,y,z)$ are physical coordinates and $\\boldsymbol{\\xi} = (\\xi, \\eta, \\zeta)$ are reference coordinates. The Jacobian of this transformation, $J = \\frac{\\partial \\mathbf{x}}{\\partial \\boldsymbol{\\xi}}$, is a constant matrix. The differential volume element transforms as $dV = |J| d\\hat{V}$, where $|J|$ is the constant determinant of the Jacobian.\n\nThe curl operator transforms according to the relation $\\nabla \\times = (J^{-T} \\nabla_{\\boldsymbol{\\xi}}) \\times$, where $\\nabla_{\\boldsymbol{\\xi}}$ is the del operator in reference coordinates. Applying this to a vector field $\\mathbf{A}$, we get $\\nabla \\times \\mathbf{A} = J^{-T} (\\nabla_{\\boldsymbol{\\xi}} \\times \\mathbf{A})$, since $J^{-T}$ is a constant matrix. The weak form on the reference element becomes:\n$$\n\\int_{\\hat{\\Omega}} \\left( J^{-T} (\\nabla_{\\boldsymbol{\\xi}} \\times \\mathbf{v}) \\right) \\cdot \\left( J^{-T} (\\nabla_{\\boldsymbol{\\xi}} \\times \\mathbf{E}) \\right) |J| \\, d\\hat{V}\n$$\nThis can be rewritten using matrix notation for the dot product:\n$$\n|J| \\int_{\\hat{\\Omega}} (\\nabla_{\\boldsymbol{\\xi}} \\times \\mathbf{v})^T (J^{-1} J^{-T}) (\\nabla_{\\boldsymbol{\\xi}} \\times \\mathbf{E}) \\, d\\hat{V}\n$$\nThe matrix $G = J^{-1} J^{-T}$ contains the constant metric tensor components. The numerical evaluation of this integral using Gauss-Lobatto-Legendre (GLL) quadrature proceeds by evaluating the integrand at the $N^3$ GLL nodes and summing the results with appropriate quadrature weights. The overall operator application can be decomposed into a sequence of steps. Let the discrete nodal representation of $\\mathbf{E}$ be denoted by the vector of coefficients $\\underline{\\mathbf{E}}$.\n\nThe sum-factorized plan is as follows:\n1.  Compute the reference curl, $\\mathbf{c}_E = \\nabla_{\\boldsymbol{\\xi}} \\times \\mathbf{E}$, at all $N^3$ GLL nodes.\n2.  Apply the metric tensor and quadrature weights pointwise: at each node $(i,j,k)$, compute $\\tilde{\\mathbf{c}}_E = |J| w_{ijk} G (\\mathbf{c}_E)_{ijk}$.\n3.  Apply the transpose of the reference curl operator, $(\\nabla_{\\boldsymbol{\\xi}} \\times)^T$, to the field of weighted values $\\tilde{\\mathbf{c}}_E$ to accumulate the final nodal coefficients $\\underline{\\mathbf{F}}$.\n\nThe problem states that we should count only leading-order terms and ignore $O(N^3)$ costs such as pointwise linear combinations and scalings. Step 2 involves only pointwise operations at the $N^3$ nodes and thus has a cost of $O(N^3)$, which we will ignore. The dominant cost resides in Steps 1 and 3.\n\n**Step 1: Cost of Evaluating the Reference Curl $(\\nabla_{\\boldsymbol{\\xi}} \\times \\mathbf{E})$**\n\nThe reference curl is given by:\n$$\n\\nabla_{\\boldsymbol{\\xi}} \\times \\mathbf{E} = \\left(\\frac{\\partial E_z}{\\partial \\eta} - \\frac{\\partial E_y}{\\partial \\zeta}\\right)\\hat{\\xi} + \\left(\\frac{\\partial E_x}{\\partial \\zeta} - \\frac{\\partial E_z}{\\partial \\xi}\\right)\\hat{\\eta} + \\left(\\frac{\\partial E_y}{\\partial \\xi} - \\frac{\\partial E_x}{\\partial \\eta}\\right)\\hat{\\zeta}\n$$\nTo evaluate this at the $N^3$ nodes, we need to compute the nodal values of six partial derivatives: $\\frac{\\partial E_y}{\\partial \\xi}$, $\\frac{\\partial E_z}{\\partial \\xi}$, $\\frac{\\partial E_x}{\\partial \\eta}$, $\\frac{\\partial E_z}{\\partial \\eta}$, $\\frac{\\partial E_x}{\\partial \\zeta}$, and $\\frac{\\partial E_y}{\\partial \\zeta}$.\n\nLet's analyze the cost of computing one of these, for instance, $\\frac{\\partial E_x}{\\partial \\eta}$. The field component $E_x$ is represented on a tensor-product grid of $N \\times N \\times N$ nodal values. Using sum-factorization, the derivative with respect to $\\eta$ is computed by applying the one-dimensional $(N \\times N)$ derivative matrix $D$ to data along each of the $N^2$ lines oriented in the $\\eta$-direction.\n- The number of such lines is $N^2$ (one for each $(\\xi_i, \\zeta_k)$ index pair).\n- The cost of applying the dense $N \\times N$ matrix $D$ to a vector of length $N$ is given as $N^2$ FMA operations.\n- Therefore, the total cost to compute the derivative of one scalar field (like $E_x$) with respect to one direction (like $\\eta$) over the entire 3D grid is $N^2 \\text{ lines} \\times N^2 \\text{ FMA/line} = N^4$ FMA.\n\nSince we need to compute $6$ such partial derivatives, the total cost for Step 1 is:\n$$\n\\text{Cost}_{\\text{Step 1}} = 6 \\times N^4 \\text{ FMA}\n$$\nThe subsequent pointwise subtractions to form the components of $\\mathbf{c}_E$ are $O(N^3)$ operations and are ignored as per the problem's instructions.\n\n**Step 3: Cost of Applying the Transpose Reference Curl $(\\nabla_{\\boldsymbol{\\xi}} \\times)^T$**\n\nThis step involves applying the discrete transpose of the operator from Step 1. The operation consists of applying the transpose of the partial derivative operators. For example, the contribution to the final nodal coefficients of $E_x$ comes from the components of $\\tilde{\\mathbf{c}}_E$ that involved derivatives of $E_x$ in Step 1. This process requires applying the transpose of the 1D derivative matrix, $D^T$, along the corresponding grid lines. The cost of applying an $N \\times N$ matrix $D^T$ to a vector of length $N$ is also $N^2$ FMA. The structure of the operator $(\\nabla_{\\boldsymbol{\\xi}} \\times)^T$ is identical to that of $\\nabla_{\\boldsymbol{\\xi}} \\times$ in terms of the number of derivative applications. It also requires the evaluation of 6 partial derivative-like operations.\nTherefore, the cost of Step 3 is also:\n$$\n\\text{Cost}_{\\text{Step 3}} = 6 \\times N^4 \\text{ FMA}\n$$\n\n**Total Sum-Factorization Cost**\n\nThe total leading-order cost for the sum-factorized curl-curl operator application is the sum of the costs from Steps 1 and 3:\n$$\n\\text{Cost}_{\\text{SF}} = 6 N^4 + 6 N^4 = 12 N^4 \\text{ FMA}\n$$\n\n**Comparison with the Naive Dense Approach**\n\nIn a naive approach, one would explicitly form the element-local stiffness matrix, $K_e^{curlcurl}$.\n- The number of degrees of freedom (DoFs) on the element for the vector field $\\mathbf{E}$ is $3$ components per node $\\times$ $N^3$ nodes = $3N^3$.\n- The dense stiffness matrix $K_e^{curlcurl}$ would have dimensions $(3N^3) \\times (3N^3)$.\n- Applying this operator corresponds to a matrix-vector product. The cost of multiplying a $(3N^3 \\times 3N^3)$ dense matrix by a vector of length $3N^3$ is approximately $(3N^3)^2$ FMA operations.\n$$\n\\text{Cost}_{\\text{Dense}} = (3N^3)^2 = 9 N^6 \\text{ FMA}\n$$\nThe sum-factorization approach has a cost of $12N^4$, while the dense approach has a cost of $9N^6$. The ratio of costs is $\\text{Cost}_{\\text{Dense}} / \\text{Cost}_{\\text{SF}} = \\frac{9N^6}{12N^4} = \\frac{3}{4}N^2$. For any $p \\ge 1$ (i.e., $N \\ge 2$), the sum-factorized approach is vastly more efficient, and its advantage grows quadratically with the number of nodes per dimension, $N$.\n\n**Final Expression for Sum-Factorization Cost**\n\nThe problem asks for the closed-form expression for the leading-order number of FMA operations in terms of the polynomial degree $p$. With $N = p+1$, the total cost is:\n$$\n\\text{Cost}_{\\text{SF}} = 12 N^4 = 12 (p+1)^4\n$$",
            "answer": "$$\\boxed{12(p+1)^4}$$"
        },
        {
            "introduction": "Beyond the efficiency of operator application, the performance of implicit spectral element solvers is often dictated by the size of the global linear system that must be solved. Static condensation is a powerful algebraic technique used to significantly reduce this system size by eliminating degrees of freedom that are purely internal to each element. This practice guides you through the derivation and analysis of static condensation for the curl-curl operator, demonstrating how it reduces the per-element unknowns from a scaling of $O(p^3)$ to $O(p^2)$ . This reduction is critical for developing fast and scalable solvers for large-scale, high-frequency electromagnetic problems.",
            "id": "3350015",
            "problem": "Consider the time-harmonic electromagnetic field governed by Maxwell’s equations in a bounded Lipschitz domain $\\Omega \\subset \\mathbb{R}^3$. The electric field is $\\mathbf{E}(\\mathbf{x})$, the magnetic permeability is $\\mu(\\mathbf{x})$, and the electric permittivity is $\\varepsilon(\\mathbf{x})$. Under standard assumptions leading to the curl-curl operator in the weak formulation, the partial differential equation reduces to the bilinear form involving $\\nabla \\times \\mathbf{E}$ and the test functions. The Spectral Element Method (SEM) is employed with high-order, tensor-product hexahedral elements, using the curl-conforming vector space based on Nédélec first-kind elements constructed from tensor-product polynomial spaces.\n\nStarting from the weak form and the definition of the curl-conforming space, derive a static condensation procedure for the resulting discrete system associated with the curl-curl operator. Explicitly partition the element-level matrix into interior and boundary blocks, eliminate the interior unknowns, and form the Schur complement governing the boundary unknowns. Then, rigorously count the degrees of freedom per element for the curl-conforming spectral element space of order $p$, and split them into interior and boundary subsets. Use these counts to show that the full system dimension per element scales as $O(p^3)$ while the statically condensed dimension per element scales as $O(p^2)$, and explain why this dimensional reduction impacts solver performance for iterative methods whose per-iteration cost scales with the number of unknowns.\n\nYou must express the degrees-of-freedom counts using a tensor-product construction. Let the curl-conforming spectral element space on a reference hexahedron be built from polynomial spaces of the form $Q_{a,b,c}$, where the dimension is $(a+1)(b+1)(c+1)$. For the three vector components, the admissible triplets of degrees are such that the component aligned with a coordinate direction has one axis of degree $p-1$ and the other two axes of degree $p$. From first principles, derive the total count per element and the split between interior and boundary unknowns by analyzing which basis functions have zero tangential trace on the element boundary.\n\nNext, extend the counting to a structured mesh of $N_x \\times N_y \\times N_z$ hexahedral elements. Provide formulas for the global number of condensed (boundary) unknowns using unique counts of mesh edges and faces:\n- The number of edges aligned with the $x$-axis equals $N_x (N_y + 1) (N_z + 1)$, with analogous expressions for the other axes.\n- The number of faces orthogonal to the $x$-axis equals $(N_x + 1) N_y N_z$, with analogous expressions for the other axes.\nAssume the high-order Nédélec first-kind construction in which each edge carries $p$ unknowns and each face carries $2p(p-1)$ tangential unknowns. The full global unknown count equals the condensed count plus the interior count, where the interior count per element equals $3p(p-1)^2$ and interior unknowns do not couple across elements.\n\nFinally, implement a complete, runnable program that computes, for a given polynomial order $p$ and mesh dimensions $(N_x,N_y,N_z)$, the following three quantities:\n- The total number of unknowns in the full system.\n- The total number of unknowns in the statically condensed system.\n- The ratio of the two totals, interpreted as a proxy for per-iteration cost in an iterative solver whose work per iteration scales linearly with the number of unknowns.\n\nDesign a test suite that includes a general case, small-order boundary cases, and anisotropic mesh cases:\n- Case $1$: $p=1$, $N_x=1$, $N_y=1$, $N_z=1$.\n- Case $2$: $p=2$, $N_x=1$, $N_y=1$, $N_z=1$.\n- Case $3$: $p=4$, $N_x=2$, $N_y=2$, $N_z=2$.\n- Case $4$: $p=8$, $N_x=1$, $N_y=2$, $N_z=3$.\n- Case $5$: $p=10$, $N_x=3$, $N_y=3$, $N_z=1$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each test case’s result is the list $[N_{\\text{full}},N_{\\text{condensed}},\\text{ratio}]$. For example, the overall format must be $[[a_1,b_1,r_1],[a_2,b_2,r_2],\\dots]$. No physical units are required in the output.",
            "solution": "The problem is valid. It is a well-posed theoretical and computational exercise in the field of spectral element methods for computational electromagnetics, grounded in established mathematical and numerical principles.\n\nThe analysis begins with the weak formulation of the time-harmonic Maxwell's equations, leading to a system of linear equations $A\\mathbf{u}=\\mathbf{f}$ after discretization. We use the Spectral Element Method (SEM) with high-order curl-conforming vector basis functions on a mesh of hexahedral elements. The procedure of static condensation, its effect on system size, and its implementation for counting degrees of freedom (DoFs) are detailed below.\n\n**Static Condensation Procedure**\n\nStatic condensation is an efficient technique for solving linear systems by eliminating a subset of unknowns at the element level before global assembly. In the context of SEM, the unknowns (degrees of freedom) within each element are partitioned into two sets: interior unknowns ($u_I$), whose basis functions have support only within that element, and boundary unknowns ($u_B$), whose basis functions have support extending to the element boundary and are shared with adjacent elements.\n\nFor a single element $(e)$, the local system of equations $A^{(e)} u^{(e)} = f^{(e)}$ can be written in block form corresponding to this partitioning:\n$$\n\\begin{pmatrix} A_{II} & A_{IB} \\\\ A_{BI} & A_{BB} \\end{pmatrix}\n\\begin{pmatrix} u_I \\\\ u_B \\end{pmatrix} =\n\\begin{pmatrix} f_I \\\\ f_B \\end{pmatrix}\n$$\nHere, $A_{II}$ represents the coupling among interior DoFs, $A_{BB}$ represents the coupling among boundary DoFs, and $A_{IB}$ and $A_{BI}$ ($=A_{IB}^T$ for symmetric problems) represent the coupling between interior and boundary DoFs.\n\nBecause interior basis functions have zero trace on the element boundary, they do not couple with basis functions from any other element. This means the submatrix $A_{II}$ is purely local to the element and can be inverted independently. From the first row of the block system, we can express the interior unknowns in terms of the boundary unknowns:\n$$\nA_{II} u_I + A_{IB} u_B = f_I \\implies u_I = A_{II}^{-1} (f_I - A_{IB} u_B)\n$$\nSubstituting this expression into the second row of the block system eliminates $u_I$:\n$$\nA_{BI} \\left( A_{II}^{-1} (f_I - A_{IB} u_B) \\right) + A_{BB} u_B = f_B\n$$\nRearranging the terms to group those involving the unknown $u_B$ yields the condensed system for the boundary unknowns:\n$$\n(A_{BB} - A_{BI} A_{II}^{-1} A_{IB}) u_B = f_B - A_{BI} A_{II}^{-1} f_I\n$$\nThis equation is of the form $S u_B = \\hat{f}_B$, where:\n-   $S = A_{BB} - A_{BI} A_{II}^{-1} A_{IB}$ is the Schur complement matrix. It represents the effective stiffness matrix for the boundary unknowns after the interior effects have been \"condensed out\".\n-   $\\hat{f}_B = f_B - A_{BI} A_{II}^{-1} f_I$ is the modified load vector for the boundary unknowns.\n\nThe global system is formed by assembling the Schur complement matrices $S^{(e)}$ and modified load vectors $\\hat{f}_B^{(e)}$ from all elements. This results in a much smaller global system involving only the boundary DoFs. After solving the global condensed system for all $u_B$, the interior unknowns $u_I$ can be recovered for each element via back-substitution using the previously derived formula.\n\n**Degree-of-Freedom Counting and Asymptotic Scaling**\n\nTo understand the benefits of static condensation, we must count the number of interior and boundary DoFs. For a hexahedral element using Nédélec first-kind curl-conforming elements of polynomial order $p$, the vector basis functions $\\mathbf{E} = (E_x, E_y, E_z)^T$ are constructed from tensor-product polynomial spaces. On a reference element $\\hat{K} = [-1, 1]^3$ with coordinates $(\\xi_1, \\xi_2, \\xi_3)$, the function space is:\n$$\n\\mathbf{V}_p(\\hat{K}) = \\left\\{ \\mathbf{E} \\mid E_x \\in Q_{p-1, p, p}(\\hat{K}), \\quad E_y \\in Q_{p, p-1, p}(\\hat{K}), \\quad E_z \\in Q_{p, p, p-1}(\\hat{K}) \\right\\}\n$$\nwhere $Q_{a,b,c}$ is the space of polynomials with maximum degree $a$ in $\\xi_1$, $b$ in $\\xi_2$, and $c$ in $\\xi_3$. The dimension of $Q_{a,b,c}$ is $(a+1)(b+1)(c+1)$.\n\nThe total number of DoFs per element, $N_{\\text{total,elem}}$, is the dimension of $\\mathbf{V}_p(\\hat{K})$:\n$$\nN_{\\text{total,elem}} = \\dim(Q_{p-1, p, p}) + \\dim(Q_{p, p-1, p}) + \\dim(Q_{p, p, p-1})\n$$\n$$\nN_{\\text{total,elem}} = (p)(p+1)(p+1) + (p+1)(p)(p+1) + (p+1)(p+1)(p) = 3p(p+1)^2\n$$\nFor large $p$, the leading term is $3p(p^2) = 3p^3$, so the total number of DoFs per element scales as $O(p^3)$.\n\nInterior DoFs correspond to basis functions whose tangential trace vanishes on the element boundary $\\partial\\hat{K}$. For the $x$-component $E_x \\in Q_{p-1, p, p}$, its tangential components are zero on all faces if $E_x$ is zero on the faces orthogonal to the $\\xi_2$ and $\\xi_3$ axes (i.e., at $\\xi_2=\\pm 1$ and $\\xi_3=\\pm 1$). This requires $E_x$ to be of the form $E_x(\\xi_1, \\xi_2, \\xi_3) = (1-\\xi_2^2)(1-\\xi_3^2) \\psi(\\xi_1, \\xi_2, \\xi_3)$. For $E_x$ to remain in $Q_{p-1,p,p}$, the polynomial $\\psi$ must belong to $Q_{p-1, p-2, p-2}$. The number of such interior basis functions for the $x$-component is $\\dim(Q_{p-1, p-2, p-2}) = p(p-1)(p-1) = p(p-1)^2$.\nBy symmetry, the number of interior basis functions for the $y$ and $z$ components are also $p(p-1)^2$.\nThe total number of interior DoFs per element, $N_{I, \\text{elem}}$, is:\n$$\nN_{I, \\text{elem}} = 3p(p-1)^2\n$$\nFor large $p$, this also scales as $O(p^3)$.\n\nThe number of boundary DoFs per element, $N_{B, \\text{elem}}$, is the difference between the total and interior DoFs:\n$$\nN_{B, \\text{elem}} = N_{\\text{total,elem}} - N_{I, \\text{elem}} = 3p(p+1)^2 - 3p(p-1)^2\n$$\n$$\nN_{B, \\text{elem}} = 3p \\left[ (p^2+2p+1) - (p^2-2p+1) \\right] = 3p(4p) = 12p^2\n$$\nThe dimension of the statically condensed system at the element level, $N_{B, \\text{elem}}$, scales as $O(p^2)$.\n\nThis dimensional reduction from $O(p^3)$ to $O(p^2)$ per element is significant. The per-iteration cost of many iterative solvers, such as the Conjugate Gradient method, is dominated by the sparse matrix-vector product, which scales linearly with the number of unknowns in the global system. By eliminating the $O(p^3)$ interior unknowns from each element, static condensation reduces the size of the global system to only the $O(p^2)$ boundary unknowns (per element), thereby substantially decreasing the computational work required for each iteration of the global solve.\n\n**Global Degree-of-Freedom Counting**\n\nFor a structured mesh of $N_x \\times N_y \\times N_z$ elements, we can count the total number of unknowns in the full and condensed systems. The interior DoFs are unique to each element, while the boundary DoFs are shared across elements at common edges and faces.\n\nThe total number of unknowns in the condensed system, $N_{\\text{condensed}}$, is the sum of all unique boundary DoFs across the mesh. These are associated with the mesh edges and faces.\nNumber of edges:\n-   $x$-aligned: $N_{\\text{edges},x} = N_x (N_y + 1) (N_z + 1)$\n-   $y$-aligned: $N_{\\text{edges},y} = N_y (N_x + 1) (N_z + 1)$\n-   $z$-aligned: $N_{\\text{edges},z} = N_z (N_x + 1) (N_y + 1)$\nTotal edges: $N_{\\text{edges}} = N_{\\text{edges},x} + N_{\\text{edges},y} + N_{\\text{edges},z}$\nEach edge carries $p$ DoFs.\n\nNumber of faces:\n-   Orthogonal to $x$-axis: $N_{\\text{faces},x} = (N_x + 1) N_y N_z$\n-   Orthogonal to $y$-axis: $N_{\\text{faces},y} = N_x (N_y + 1) N_z$\n-   Orthogonal to $z$-axis: $N_{\\text{faces},z} = N_x N_y (N_z + 1)$\nTotal faces: $N_{\\text{faces}} = N_{\\text{faces},x} + N_{\\text{faces},y} + N_{\\text{faces},z}$\nEach face carries $2p(p-1)$ tangential DoFs.\n\nThus, the total number of unknowns in the condensed system is:\n$$\nN_{\\text{condensed}} = p \\cdot N_{\\text{edges}} + 2p(p-1) \\cdot N_{\\text{faces}}\n$$\nNote that for $p=1$, the face contribution vanishes, as expected.\n\nThe total number of unknowns in the full system, $N_{\\text{full}}$, is the sum of the condensed system unknowns and all interior unknowns across all elements.\nTotal number of elements is $N_e = N_x N_y N_z$.\nEach element has $N_{I, \\text{elem}} = 3p(p-1)^2$ interior DoFs.\n$$\nN_{\\text{full}} = N_{\\text{condensed}} + N_{I, \\text{elem}} \\cdot N_e = N_{\\text{condensed}} + 3p(p-1)^2 \\cdot (N_x N_y N_z)\n$$\nThese formulas allow for the direct computation of system sizes for both approaches.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the number of unknowns for full and statically condensed systems\n    in a Spectral Element Method discretization for electromagnetics.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    # Each case is a tuple: (p, Nx, Ny, Nz)\n    test_cases = [\n        (1, 1, 1, 1),\n        (2, 1, 1, 1),\n        (4, 2, 2, 2),\n        (8, 1, 2, 3),\n        (10, 3, 3, 1),\n    ]\n\n    results = []\n    for case in test_cases:\n        p, Nx, Ny, Nz = case\n\n        # Ensure integer types for calculations to avoid float precision issues\n        p, Nx, Ny, Nz = int(p), int(Nx), int(Ny), int(Nz)\n\n        # Calculate the total number of unique edges in the structured mesh\n        num_edges_x = Nx * (Ny + 1) * (Nz + 1)\n        num_edges_y = Ny * (Nx + 1) * (Nz + 1)\n        num_edges_z = Nz * (Nx + 1) * (Ny + 1)\n        total_edges = num_edges_x + num_edges_y + num_edges_z\n\n        # Calculate the total number of unique faces in the structured mesh\n        num_faces_x = (Nx + 1) * Ny * Nz\n        num_faces_y = Nx * (Ny + 1) * Nz\n        num_faces_z = Nx * Ny * (Nz + 1)\n        total_faces = num_faces_x + num_faces_y + num_faces_z\n\n        # Degrees of freedom (DoFs) per geometric entity based on polynomial order p\n        # For p=1, there are no face or interior DoFs.\n        dofs_per_edge = p\n        if p > 1:\n            dofs_per_face = 2 * p * (p - 1)\n            dofs_per_interior = 3 * p * (p - 1)**2\n        else: # p=1 case\n            dofs_per_face = 0\n            dofs_per_interior = 0\n\n        # Calculate the total number of unknowns in the statically condensed system\n        # This is the sum of boundary DoFs (on edges and faces).\n        N_condensed = (dofs_per_edge * total_edges) + (dofs_per_face * total_faces)\n\n        # Calculate the total number of unknowns in the full system\n        # This is the condensed size plus the interior DoFs for all elements.\n        num_elements = Nx * Ny * Nz\n        total_interior_dofs = dofs_per_interior * num_elements\n        N_full = N_condensed + total_interior_dofs\n        \n        # Calculate the ratio as a proxy for per-iteration cost reduction\n        # Handle the case where N_condensed could be 0, though not possible for p>=1.\n        if N_condensed > 0:\n            ratio = N_full / N_condensed\n        else:\n            ratio = 1.0 # If no boundary DoFs, full and condensed are same (e.g., size 0)\n\n        # Format results for the current test case\n        # N_full and N_condensed are integers, ratio is float\n        case_result = [N_full, N_condensed, ratio]\n        results.append(case_result)\n\n    # Final print statement in the exact required format.\n    # Example: [[12,12,1.0],[54,48,1.125]]\n    # Using str(item) handles converting lists to strings '[...]'\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}