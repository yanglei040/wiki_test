{
    "hands_on_practices": [
        {
            "introduction": "This first practice grounds the abstract theory of higher-order elements in a concrete calculation by having you construct a $p=2$ Nedelec vector basis function on a reference tetrahedron from first principles. Starting with the fundamental Whitney 1-form, this exercise demystifies the mathematical definitions and builds intuition for the structure of these vector fields and their curl .",
            "id": "3313865",
            "problem": "Consider the reference tetrahedron $T$ used in computational electromagnetics finite element formulations, with vertices $v_{0}=(0,0,0)$, $v_{1}=(1,0,0)$, $v_{2}=(0,1,0)$, and $v_{3}=(0,0,1)$, and the oriented edge $[v_{0},v_{1}]$ taken from $v_{0}$ to $v_{1}$. Let $\\lambda_{0}$, $\\lambda_{1}$, $\\lambda_{2}$, and $\\lambda_{3}$ denote the barycentric coordinates on $T$, and let $\\nabla\\lambda_{a}$ denote their gradients.\n\nIn higher-order curl-conforming finite elements used for solving Maxwell’s equations, the Nedelec first-kind (edge) shape functions are constructed from the Whitney $1$-forms associated with oriented edges and scalar polynomials. Using the fundamental definitions of barycentric coordinates and Whitney $1$-forms, and respecting the given edge orientation, perform the following:\n\n1. Construct two explicit $p=2$ Nedelec first-kind edge shape functions on $T$ associated with the oriented edge $[v_{0},v_{1}]$ by multiplying the Whitney $1$-form for $[v_{0},v_{1}]$ by each of the scalar linear polynomials $\\lambda_{0}$ and $\\lambda_{1}$. Write each shape function explicitly as a vector field in $(x,y,z)$-coordinates.\n\n2. Compute the curl of each of the two shape functions from part 1 explicitly.\n\n3. Compute the integral over $T$ of the squared magnitude of the curl of the shape function constructed with the scalar factor $\\lambda_{1}$, namely,\n$$\n\\int_{T} \\left\\| \\nabla \\times \\big(\\lambda_{1} \\, \\mathbf{w}_{01}\\big) \\right\\|^{2} \\, \\mathrm{d}V,\n$$\nand express the final result as an exact value (no rounding).\n\nYour final answer should be the single value of the integral in part 3, expressed in exact form without units.",
            "solution": "The solution proceeds by first defining the barycentric coordinates and their gradients for the specified reference tetrahedron. Then, the Whitney $1$-form for the edge $[v_{0},v_{1}]$ is constructed. Subsequently, the two requested higher-order shape functions and their curls are derived. Finally, the specified integral is computed.\n\nA point $\\mathbf{r} = (x,y,z)$ inside the tetrahedron $T$ can be expressed using barycentric coordinates $\\lambda_i$ as $\\mathbf{r} = \\sum_{i=0}^{3} \\lambda_i v_i$, with $\\sum_{i=0}^{3} \\lambda_i = 1$. Given the vertices $v_{0}=(0,0,0)$, $v_{1}=(1,0,0)$, $v_{2}=(0,1,0)$, and $v_3=(0,0,1)$, this becomes:\n$$\n(x,y,z) = \\lambda_0(0,0,0) + \\lambda_1(1,0,0) + \\lambda_2(0,1,0) + \\lambda_3(0,0,1) = (\\lambda_1, \\lambda_2, \\lambda_3).\n$$\nThus, we have $\\lambda_1 = x$, $\\lambda_2 = y$, and $\\lambda_3 = z$. The fourth coordinate is determined by the summation constraint: $\\lambda_0 = 1 - \\lambda_1 - \\lambda_2 - \\lambda_3 = 1-x-y-z$.\n\nThe gradients of the barycentric coordinates are constant vectors:\n$$\n\\nabla \\lambda_0 = (-1, -1, -1) \\\\\n\\nabla \\lambda_1 = (1, 0, 0) \\\\\n\\nabla \\lambda_2 = (0, 1, 0) \\\\\n\\nabla \\lambda_3 = (0, 0, 1)\n$$\n\nThe Whitney $1$-form, or lowest-order Nedelec edge function, associated with the oriented edge $[v_i, v_j]$ is given by $\\mathbf{w}_{ij} = \\lambda_i \\nabla \\lambda_j - \\lambda_j \\nabla \\lambda_i$. For the edge $[v_{0}, v_{1}]$, this is:\n$$\n\\mathbf{w}_{01} = \\lambda_0 \\nabla \\lambda_1 - \\lambda_1 \\nabla \\lambda_0 = (1-x-y-z)(1,0,0) - x(-1,-1,-1) = (1-x-y-z+x, x, x) = (1-y-z, x, x).\n$$\n\n**1. Construction of Higher-Order Shape Functions**\n\nThe two $p=2$ Nedelec shape functions associated with the edge $[v_{0},v_{1}]$ are formed by multiplying $\\mathbf{w}_{01}$ by $\\lambda_{0}$ and $\\lambda_{1}$. Let's denote them $\\mathbf{N}_A$ and $\\mathbf{N}_B$.\n\nFunction A (using $\\lambda_0$):\n$$\n\\mathbf{N}_A = \\lambda_0 \\mathbf{w}_{01} = (1-x-y-z)(1-y-z, x, x) = \\big( (1-y-z)^2 - x(1-y-z), x(1-x-y-z), x(1-x-y-z) \\big).\n$$\n\nFunction B (using $\\lambda_1$):\n$$\n\\mathbf{N}_B = \\lambda_1 \\mathbf{w}_{01} = x(1-y-z, x, x) = (x-xy-xz, x^2, x^2).\n$$\n\n**2. Computation of Curls**\n\nWe use the vector identity $\\nabla \\times (f \\mathbf{F}) = (\\nabla f) \\times \\mathbf{F} + f(\\nabla \\times \\mathbf{F})$.\nFirst, we compute the curl of the Whitney form $\\mathbf{w}_{01}$.\n$$\n\\nabla \\times \\mathbf{w}_{01} = \\nabla \\times (\\lambda_0 \\nabla \\lambda_1 - \\lambda_1 \\nabla \\lambda_0) = (\\nabla \\lambda_0 \\times \\nabla \\lambda_1) - (\\nabla \\lambda_1 \\times \\nabla \\lambda_0) = 2(\\nabla \\lambda_0 \\times \\nabla \\lambda_1).\n$$\nThe cross product of the gradients is:\n$$\n\\nabla \\lambda_0 \\times \\nabla \\lambda_1 = (-1, -1, -1) \\times (1, 0, 0) = \\begin{vmatrix} \\mathbf{i}  \\mathbf{j}  \\mathbf{k} \\\\ -1  -1  -1 \\\\ 1  0  0 \\end{vmatrix} = (0, -1, 1).\n$$\nThus, the curl of the Whitney form is a constant vector:\n$$\n\\nabla \\times \\mathbf{w}_{01} = 2(0, -1, 1) = (0, -2, 2).\n$$\nNow we compute the curls of $\\mathbf{N}_A$ and $\\mathbf{N}_B$.\n\nCurl of $\\mathbf{N}_A$:\n$$\n\\nabla \\times \\mathbf{N}_A = \\nabla \\times (\\lambda_0 \\mathbf{w}_{01}) = (\\nabla \\lambda_0) \\times \\mathbf{w}_{01} + \\lambda_0 (\\nabla \\times \\mathbf{w}_{01}).\n$$\nThe first term is:\n$$\n(\\nabla \\lambda_0) \\times \\mathbf{w}_{01} = (-1, -1, -1) \\times (1-y-z, x, x) = \\begin{vmatrix} \\mathbf{i}  \\mathbf{j}  \\mathbf{k} \\\\ -1  -1  -1 \\\\ 1-y-z  x  x \\end{vmatrix} = (0, x+y+z-1, 1-x-y-z) = (0, -\\lambda_0, \\lambda_0).\n$$\nCombining the terms:\n$$\n\\nabla \\times \\mathbf{N}_A = (0, -\\lambda_0, \\lambda_0) + \\lambda_0(0, -2, 2) = (0, -3\\lambda_0, 3\\lambda_0) = (0, 3x+3y+3z-3, 3-3x-3y-3z).\n$$\n\nCurl of $\\mathbf{N}_B$:\n$$\n\\nabla \\times \\mathbf{N}_B = \\nabla \\times (\\lambda_1 \\mathbf{w}_{01}) = (\\nabla \\lambda_1) \\times \\mathbf{w}_{01} + \\lambda_1 (\\nabla \\times \\mathbf{w}_{01}).\n$$\nThe first term is:\n$$\n(\\nabla \\lambda_1) \\times \\mathbf{w}_{01} = (1, 0, 0) \\times (1-y-z, x, x) = \\begin{vmatrix} \\mathbf{i}  \\mathbf{j}  \\mathbf{k} \\\\ 1  0  0 \\\\ 1-y-z  x  x \\end{vmatrix} = (0, -x, x).\n$$\nIn terms of barycentric coordinates, this is $(0, -\\lambda_1, \\lambda_1)$.\nCombining the terms:\n$$\n\\nabla \\times \\mathbf{N}_B = (0, -\\lambda_1, \\lambda_1) + \\lambda_1(0, -2, 2) = (0, -3\\lambda_1, 3\\lambda_1) = (0, -3x, 3x).\n$$\n\n**3. Computation of the Integral**\n\nThe problem asks for the evaluation of $I = \\int_{T} \\left\\| \\nabla \\times \\big(\\lambda_{1} \\, \\mathbf{w}_{01}\\big) \\right\\|^{2} \\, \\mathrm{d}V$.\nFrom the previous step, $\\nabla \\times (\\lambda_{1} \\, \\mathbf{w}_{01}) = (0, -3x, 3x)$.\nIts squared magnitude is:\n$$\n\\left\\| (0, -3x, 3x) \\right\\|^2 = (0)^2 + (-3x)^2 + (3x)^2 = 9x^2 + 9x^2 = 18x^2.\n$$\nThe integral becomes:\n$$\nI = \\int_T 18x^2 \\, \\mathrm{d}V.\n$$\nWe can evaluate this integral using the standard formula for integration of polynomials over a simplex, expressed in barycentric coordinates. The integrand in barycentric coordinates is $18\\lambda_1^2$. The formula is:\n$$\n\\int_T \\lambda_0^{a_0} \\lambda_1^{a_1} \\lambda_2^{a_2} \\lambda_3^{a_3} \\, \\mathrm{d}V = n! V_T \\frac{a_0! a_1! a_2! a_3!}{(a_0+a_1+a_2+a_3+n)!}\n$$\nwhere $n=3$ is the spatial dimension and $V_T$ is the volume of the tetrahedron. For the given vertices, the volume is $V_T = \\frac{1}{6} \\left| \\det \\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  1 \\end{pmatrix} \\right| = \\frac{1}{6}$.\nOur integral is $18 \\int_T \\lambda_1^2 \\, \\mathrm{d}V$, which corresponds to $a_1=2$ and $a_0=a_2=a_3=0$.\n$$\nI = 18 \\left( 3! \\cdot V_T \\cdot \\frac{0! \\, 2! \\, 0! \\, 0!}{(0+2+0+0+3)!} \\right) = 18 \\left( 6 \\cdot \\frac{1}{6} \\cdot \\frac{1 \\cdot 2 \\cdot 1 \\cdot 1}{5!} \\right) = 18 \\left( 1 \\cdot \\frac{2}{120} \\right) = 18 \\left( \\frac{1}{60} \\right).\n$$\n$$\nI = \\frac{18}{60} = \\frac{3}{10}.\n$$\n\nFor completeness, we can verify this result using direct integration in Cartesian coordinates. The domain of integration is $x \\in [0,1]$, $y \\in [0, 1-x]$, $z \\in [0, 1-x-y]$.\n$$\nI = \\int_0^1 \\int_0^{1-x} \\int_0^{1-x-y} 18x^2 \\, \\mathrm{d}z \\, \\mathrm{d}y \\, \\mathrm{d}x\n$$\n$$\nI = 18 \\int_0^1 x^2 \\int_0^{1-x} [z]_0^{1-x-y} \\, \\mathrm{d}y \\, \\mathrm{d}x = 18 \\int_0^1 x^2 \\int_0^{1-x} (1-x-y) \\, \\mathrm{d}y \\, \\mathrm{d}x\n$$\n$$\nI = 18 \\int_0^1 x^2 \\left[ (1-x)y - \\frac{y^2}{2} \\right]_0^{1-x} \\, \\mathrm{d}x = 18 \\int_0^1 x^2 \\left( (1-x)^2 - \\frac{(1-x)^2}{2} \\right) \\, \\mathrm{d}x\n$$\n$$\nI = 18 \\int_0^1 x^2 \\frac{(1-x)^2}{2} \\, \\mathrm{d}x = 9 \\int_0^1 x^2(1 - 2x + x^2) \\, \\mathrm{d}x = 9 \\int_0^1 (x^2 - 2x^3 + x^4) \\, \\mathrm{d}x\n$$\n$$\nI = 9 \\left[ \\frac{x^3}{3} - \\frac{2x^4}{4} + \\frac{x^5}{5} \\right]_0^1 = 9 \\left( \\frac{1}{3} - \\frac{1}{2} + \\frac{1}{5} \\right) = 9 \\left( \\frac{10 - 15 + 6}{30} \\right) = 9 \\left( \\frac{1}{30} \\right) = \\frac{9}{30} = \\frac{3}{10}.\n$$\nBoth methods yield the same result, confirming the calculation.",
            "answer": "$$\\boxed{\\frac{3}{10}}$$"
        },
        {
            "introduction": "Moving from function construction to application, this exercise addresses the critical task of numerical integration in a finite element implementation. You will determine the exact quadrature order needed to assemble the mass and curl-curl matrices by analyzing the polynomial degree of their integrands under an affine mapping . This analysis is fundamental to writing an accurate and stable finite element solver.",
            "id": "3313862",
            "problem": "Consider a frequency-domain computational electromagnetics formulation on a single three-dimensional tetrahedral element. Let the material coefficients be elementwise constant, with electric permittivity denoted by $\\varepsilon$ and magnetic permeability denoted by $\\mu$. The weak forms use trial and test functions from the Sobolev space of square-integrable vector fields with square-integrable curl, $\\mathbf{H}(\\mathrm{curl})$, discretized by first-family Nédélec $\\mathbf{H}(\\mathrm{curl})$ finite elements of polynomial order $p \\in \\mathbb{N}$. Assume an affine mapping $\\mathbf{x} = F(\\hat{\\mathbf{x}})$ from the reference tetrahedron $\\hat{T}$ to the physical tetrahedron $T$, with constant Jacobian matrix $\\mathbf{J} = \\frac{\\partial \\mathbf{x}}{\\partial \\hat{\\mathbf{x}}}$ and determinant $\\det(\\mathbf{J}) \\neq 0$. On the reference element, the components of the basis functions are polynomials of total degree at most $p$, and differentiation reduces polynomial degree by one.\n\nThe elementwise mass bilinear form is\n$$\nm(\\mathbf{E}, \\mathbf{F}) = \\int_{T} \\varepsilon \\, \\mathbf{E} \\cdot \\mathbf{F} \\, \\mathrm{d}\\mathbf{x},\n$$\nand the curl-curl bilinear form is\n$$\na(\\mathbf{E}, \\mathbf{F}) = \\int_{T} \\mu^{-1} \\, (\\nabla \\times \\mathbf{E}) \\cdot (\\nabla \\times \\mathbf{F}) \\, \\mathrm{d}\\mathbf{x}.\n$$\n\nUnder the covariant $\\mathbf{H}(\\mathrm{curl})$ Piola transformation, the physical field satisfies $\\mathbf{E}(\\mathbf{x}) = \\mathbf{J}^{-T} \\hat{\\mathbf{E}}(\\hat{\\mathbf{x}})$, and the curl transforms as\n$$\n\\nabla \\times \\mathbf{E}(\\mathbf{x}) = \\det(\\mathbf{J})^{-1} \\, \\mathbf{J} \\, (\\hat{\\nabla} \\times \\hat{\\mathbf{E}})(\\hat{\\mathbf{x}}),\n$$\nwhere $\\hat{\\nabla}$ denotes differentiation with respect to the reference coordinates.\n\nDerive, on the reference element $\\hat{T}$, the maximal total polynomial degree of the integrands for both $m(\\mathbf{E}, \\mathbf{F})$ and $a(\\mathbf{E}, \\mathbf{F})$ after applying the affine mapping. Using these degrees, determine the minimal exact quadrature degree required on $\\hat{T}$ to integrate each bilinear form exactly. Express your final answer as a two-entry row matrix $\\big[$quadrature degree for $m$, quadrature degree for $a\\big]$ in terms of $p$. No numerical rounding is required, and no physical units are to be reported in the final answer.",
            "solution": "The derivation starts from the polynomial structure of the basis functions and their transformation under the affine map. On the reference tetrahedron $\\hat{T}$, the first-family Nédélec $\\mathbf{H}(\\mathrm{curl})$ basis functions of order $p$ are vector-valued polynomials whose components have total degree at most $p$. Differentiation reduces the total degree by one, so for any such reference field $\\hat{\\mathbf{E}}$, the reference curl $\\hat{\\nabla} \\times \\hat{\\mathbf{E}}$ has components of total degree at most $p-1$.\n\nUnder the covariant $\\mathbf{H}(\\mathrm{curl})$ Piola mapping for affine $F$, the physical field and its curl are related to the reference field by\n$$\n\\mathbf{E}(\\mathbf{x}) = \\mathbf{J}^{-T} \\hat{\\mathbf{E}}(\\hat{\\mathbf{x}}), \\quad \\nabla \\times \\mathbf{E}(\\mathbf{x}) = \\det(\\mathbf{J})^{-1} \\, \\mathbf{J} \\, (\\hat{\\nabla} \\times \\hat{\\mathbf{E}})(\\hat{\\mathbf{x}}),\n$$\nwith $\\mathbf{J}$ and $\\det(\\mathbf{J})$ constant. The elementwise integrals transform via $\\mathrm{d}\\mathbf{x} = \\det(\\mathbf{J}) \\, \\mathrm{d}\\hat{\\mathbf{x}}$.\n\nWe now consider each bilinear form.\n\nFor the mass bilinear form,\n$$\nm(\\mathbf{E}, \\mathbf{F}) = \\int_{T} \\varepsilon \\, \\mathbf{E} \\cdot \\mathbf{F} \\, \\mathrm{d}\\mathbf{x} = \\int_{\\hat{T}} \\varepsilon \\, \\big(\\mathbf{J}^{-T} \\hat{\\mathbf{E}}(\\hat{\\mathbf{x}})\\big) \\cdot \\big(\\mathbf{J}^{-T} \\hat{\\mathbf{F}}(\\hat{\\mathbf{x}})\\big) \\, \\det(\\mathbf{J}) \\, \\mathrm{d}\\hat{\\mathbf{x}}.\n$$\nSince $\\mathbf{J}^{-T}$ and $\\det(\\mathbf{J})$ are constant, they do not change the polynomial degree. The dot product of two vector polynomials whose components have degree at most $p$ yields a scalar polynomial of degree at most $2p$. Therefore, the maximal total polynomial degree of the mass-form integrand on $\\hat{T}$ is\n$$\n\\deg_{\\mathrm{mass}} = 2p.\n$$\nOn a tetrahedron, a quadrature rule of degree $q$ integrates exactly all polynomials of total degree up to $q$. Hence the minimal exact quadrature degree required for the mass bilinear form is\n$$\nq_{\\mathrm{mass}}^{\\min} = 2p.\n$$\n\nFor the curl-curl bilinear form,\n$$\na(\\mathbf{E}, \\mathbf{F}) = \\int_{T} \\mu^{-1} \\, (\\nabla \\times \\mathbf{E}) \\cdot (\\nabla \\times \\mathbf{F}) \\, \\mathrm{d}\\mathbf{x} = \\int_{\\hat{T}} \\mu^{-1} \\, \\Big(\\det(\\mathbf{J})^{-1} \\mathbf{J} (\\hat{\\nabla} \\times \\hat{\\mathbf{E}})\\Big) \\cdot \\Big(\\det(\\mathbf{J})^{-1} \\mathbf{J} (\\hat{\\nabla} \\times \\hat{\\mathbf{F}})\\Big) \\, \\det(\\mathbf{J}) \\, \\mathrm{d}\\hat{\\mathbf{x}}.\n$$\nCollecting constants,\n$$\na(\\mathbf{E}, \\mathbf{F}) = \\int_{\\hat{T}} \\mu^{-1} \\, \\det(\\mathbf{J})^{-1} \\, \\big(\\mathbf{J} (\\hat{\\nabla} \\times \\hat{\\mathbf{E}})\\big) \\cdot \\big(\\mathbf{J} (\\hat{\\nabla} \\times \\hat{\\mathbf{F}})\\big) \\, \\mathrm{d}\\hat{\\mathbf{x}}.\n$$\nAgain, the constant factors $\\mu^{-1}$, $\\det(\\mathbf{J})^{-1}$, and $\\mathbf{J}$ do not affect the polynomial degree. Each reference curl $\\hat{\\nabla} \\times \\hat{\\mathbf{E}}$ and $\\hat{\\nabla} \\times \\hat{\\mathbf{F}}$ has components of degree at most $p-1$, so their dot product is a scalar polynomial of maximal degree\n$$\n\\deg_{\\mathrm{curl\\text{-}curl}} = 2(p-1) = 2p - 2.\n$$\nTherefore, the minimal exact quadrature degree required for the curl-curl bilinear form on the tetrahedron is\n$$\nq_{\\mathrm{curl\\text{-}curl}}^{\\min} = 2p - 2.\n$$\n\nIn summary, the minimal exact quadrature degrees on the reference tetrahedron $\\hat{T}$ are $2p$ for the mass bilinear form and $2p - 2$ for the curl-curl bilinear form. These follow directly from the maximal polynomial degrees of their integrands under the affine mapping and the covariant $\\mathbf{H}(\\mathrm{curl})$ Piola transformation, combined with the fact that quadrature degree on simplices is defined by the maximal total degree integrated exactly.",
            "answer": "$$\\boxed{\\begin{pmatrix} 2p  2p - 2 \\end{pmatrix}}$$"
        },
        {
            "introduction": "This final practice transitions from pen-and-paper analysis to computational implementation, bridging the gap between mathematical formulation and a working numerical tool. You are tasked with coding a set of modal Nédélec basis functions on a reference quadrilateral, verifying their essential properties like orthogonality, and using them to compute entries in the element mass matrix .",
            "id": "3313866",
            "problem": "Consider the time-harmonic Maxwell equations in a source-free region, where the electric field is represented in the Sobolev space of square-integrable fields with square-integrable curl, denoted by $H(\\mathrm{curl})$. The Finite Element Method (FEM) uses $H(\\mathrm{curl})$-conforming basis functions, notably the family introduced by Jean-Claude Nédélec and commonly referred to as Nédélec elements. On a reference quadrilateral element, the Nédélec second-kind family of order $p$ provides hierarchical, curl-conforming vectorial polynomial basis functions whose tangential traces are polynomials of degree up to $p$ along each edge, ensuring tangential continuity across inter-element boundaries.\n\nYour task is to implement a modal Nédélec second-kind basis restricted to edge functions on the reference quadrilateral $[-1,1]\\times[-1,1]$ for polynomial order $p=3$, ensure edge-orthogonality of these modes via appropriate modal polynomials, and compute the corresponding edge-edge block of the element mass matrix using tensor-product Gauss–Legendre quadrature of sufficient order.\n\nWork from the following fundamental base:\n- The tangential continuity requirement for $H(\\mathrm{curl})$ fields implies that, for each edge, the tangential component of the vector basis function along that edge must be a polynomial of degree at most $p$ in the edge coordinate and that it must vanish as a tangential trace on all other edges.\n- Orthogonality of modal edge functions can be imposed by choosing an orthonormal polynomial family along $[-1,1]$ for the edge coordinate so that the $L^{2}$ inner product along the edge yields the Kronecker delta.\n- The element mass matrix entry between two basis functions $\\mathbf{v}_{i}$ and $\\mathbf{v}_{j}$ is defined by\n$$\nM_{ij} \\;=\\; \\int_{-1}^{1}\\int_{-1}^{1} \\mathbf{v}_{i}(x,y)\\cdot \\mathbf{v}_{j}(x,y)\\,\\mathrm{d}x\\,\\mathrm{d}y,\n$$\nwhich requires quadrature exactness up to the polynomial degree of the integrand.\n\nImplement the following specific choices to ensure a testable and self-contained task:\n- Use the orthonormalized Legendre polynomials on $[-1,1]$, denoted by $P_{k}(s)$, for $k\\in\\{0,1,2,3\\}$, defined as $P_{k}(s)=\\sqrt{\\frac{2k+1}{2}}\\,L_{k}(s)$, where $L_{k}(s)$ is the standard Legendre polynomial of degree $k$.\n- Define edge blending functions that equal $1$ on a designated edge and $0$ on the opposite edge, and are linear across the element:\n  - Top edge ($y=1$, tangent direction along $x$): $E_{\\mathrm{top}}(y)=\\frac{1+y}{2}$ and unit tangent $\\mathbf{t}_{\\mathrm{top}}=(1,0)$.\n  - Bottom edge ($y=-1$, tangent direction along $x$): $E_{\\mathrm{bot}}(y)=\\frac{1-y}{2}$ and unit tangent $\\mathbf{t}_{\\mathrm{bot}}=(1,0)$.\n  - Right edge ($x=1$, tangent direction along $y$): $E_{\\mathrm{right}}(x)=\\frac{1+x}{2}$ and unit tangent $\\mathbf{t}_{\\mathrm{right}}=(0,1)$.\n  - Left edge ($x=-1$, tangent direction along $y$): $E_{\\mathrm{left}}(x)=\\frac{1-x}{2}$ and unit tangent $\\mathbf{t}_{\\mathrm{left}}=(0,1)$.\n- Construct edge basis functions for $k\\in\\{0,1,2,3\\}$ as:\n  - Top edge modes: $\\mathbf{v}^{\\mathrm{top}}_{k}(x,y)=P_{k}(x)\\,E_{\\mathrm{top}}(y)\\,\\mathbf{t}_{\\mathrm{top}}$.\n  - Bottom edge modes: $\\mathbf{v}^{\\mathrm{bot}}_{k}(x,y)=P_{k}(x)\\,E_{\\mathrm{bot}}(y)\\,\\mathbf{t}_{\\mathrm{bot}}$.\n  - Right edge modes: $\\mathbf{v}^{\\mathrm{right}}_{k}(x,y)=P_{k}(y)\\,E_{\\mathrm{right}}(x)\\,\\mathbf{t}_{\\mathrm{right}}$.\n  - Left edge modes: $\\mathbf{v}^{\\mathrm{left}}_{k}(x,y)=P_{k}(y)\\,E_{\\mathrm{left}}(x)\\,\\mathbf{t}_{\\mathrm{left}}$.\n\nEnsure the following in your implementation:\n- Edge-orthogonality: The tangential $L^{2}$ inner product along the designated edge between $\\mathbf{v}_{k}$ and $\\mathbf{v}_{m}$ must satisfy\n$$\n\\int_{-1}^{1} \\left(\\mathbf{v}_{k}\\cdot \\mathbf{t}\\right)\\left(\\mathbf{v}_{m}\\cdot \\mathbf{t}\\right)\\,\\mathrm{d}\\ell \\;=\\; \\delta_{km},\n$$\nwhere $\\mathbf{t}$ is the edge tangent unit vector and $\\mathrm{d}\\ell$ is the line element along the edge, using numerical quadrature sufficient for polynomials up to degree $2p$.\n- Element mass matrix block: Using tensor-product Gauss–Legendre quadrature on $[-1,1]\\times[-1,1]$, compute the edge-edge block of the element mass matrix for the top edge modes $\\{\\mathbf{v}^{\\mathrm{top}}_{k}\\}_{k=0}^{3}$, with quadrature orders chosen to integrate polynomials up to degree $6$ in $x$ and degree $2$ in $y$ exactly.\n\nDesign a test suite to validate the implementation with quantifiable results:\n- Test $1$ (edge orthogonality on the top edge): Verify that the numerical evaluation of the tangential inner products $\\int_{-1}^{1}P_{k}(x)P_{m}(x)\\,\\mathrm{d}x$ for all $(k,m)\\in\\{0,1,2,3\\}\\times\\{0,1,2,3\\}$ yields $1$ for $k=m$ and $0$ for $k\\neq m$ within a tolerance of $10^{-12}$. Output a single boolean indicating pass or fail of the entire set.\n- Test $2$ (mass matrix diagonal for top edge modes): Compute $M_{kk}=\\int_{-1}^{1}\\int_{-1}^{1}\\mathbf{v}^{\\mathrm{top}}_{k}\\cdot \\mathbf{v}^{\\mathrm{top}}_{k}\\,\\mathrm{d}x\\,\\mathrm{d}y$ for $k\\in\\{0,1,2,3\\}$ using tensor-product Gauss–Legendre quadrature with $n_{x}=4$ points in $x$ and $n_{y}=2$ points in $y$. Output the list of the four diagonal values as floats.\n- Test $3$ (top-bottom coupling for same mode index): Compute $C_{k}=\\int_{-1}^{1}\\int_{-1}^{1}\\mathbf{v}^{\\mathrm{top}}_{k}\\cdot \\mathbf{v}^{\\mathrm{bot}}_{k}\\,\\mathrm{d}x\\,\\mathrm{d}y$ for $k\\in\\{0,1,2,3\\}$ using the same quadrature as Test $2$. Output the list of four coupling values as floats.\n- Test $4$ (horizontal-vertical decoupling): Compute a representative cross-orientation mass entry $\\int_{-1}^{1}\\int_{-1}^{1}\\mathbf{v}^{\\mathrm{top}}_{2}\\cdot \\mathbf{v}^{\\mathrm{left}}_{1}\\,\\mathrm{d}x\\,\\mathrm{d}y$ using $n_{x}=4$, $n_{y}=2$. Output this single float, which should be numerically $0$.\n- Test $5$ (quadrature insufficiency edge case): Compute $M_{33}$ for the top edge using an insufficient quadrature with $n_{x}=1$, $n_{y}=1$, and report the absolute difference from the value computed in Test $2$ for $k=3$. Output this single float.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the order: $[\\text{Test 1 boolean}, \\text{Test 2 list}, \\text{Test 3 list}, \\text{Test 4 float}, \\text{Test 5 float}]$. No physical units are involved in this problem, and angles are not required. The numerical tolerance for comparisons is $10^{-12}$ in the orthogonality check.",
            "solution": "The problem requires the implementation and verification of modal, second-kind Nédélec edge basis functions of order $p=3$ on a reference quadrilateral element. This involves defining the basis functions using orthonormal Legendre polynomials, and then computing specific entries of the element mass matrix using tensor-product Gauss-Legendre quadrature.\n\nFirst, we establish the mathematical components. The basis functions are built upon the family of orthonormalized Legendre polynomials on the interval $[-1, 1]$. The standard Legendre polynomial of degree $k$, $L_k(s)$, is normalized to yield $P_k(s)$:\n$$\nP_k(s) = \\sqrt{\\frac{2k+1}{2}} L_k(s)\n$$\nBy definition, these polynomials form an orthonormal set with respect to the $L^2$ inner product on $[-1, 1]$, satisfying:\n$$\n\\int_{-1}^{1} P_k(s) P_m(s) \\, \\mathrm{d}s = \\delta_{km}\n$$\nwhere $\\delta_{km}$ is the Kronecker delta.\n\nThe vector basis functions are constructed by combining these polynomials with linear blending functions and constant tangent vectors. The blending functions, such as $E_{\\mathrm{top}}(y) = \\frac{1+y}{2}$, ensure the basis function's tangential component is non-zero on its associated edge (e.g., $y=1$ for the top edge) and zero on the opposite edge (e.g., $y=-1$). The four families of edge basis functions for $k \\in \\{0, 1, 2, 3\\}$ are:\n\\begin{itemize}\n    \\item Top edge: $\\mathbf{v}^{\\mathrm{top}}_{k}(x,y) = P_{k}(x) \\left(\\frac{1+y}{2}\\right) (1, 0)$\n    \\item Bottom edge: $\\mathbf{v}^{\\mathrm{bot}}_{k}(x,y) = P_{k}(x) \\left(\\frac{1-y}{2}\\right) (1, 0)$\n    \\item Right edge: $\\mathbf{v}^{\\mathrm{right}}_{k}(x,y) = P_{k}(y) \\left(\\frac{1+x}{2}\\right) (0, 1)$\n    \\item Left edge: $\\mathbf{v}^{\\mathrm{left}}_{k}(x,y) = P_{k}(y) \\left(\\frac{1-x}{2}\\right) (0, 1)$\n\\end{itemize}\n\nThe central task is to compute entries of the element mass matrix, defined by the integral $M_{ij} = \\int_{-1}^{1}\\int_{-1}^{1} \\mathbf{v}_{i}(x,y) \\cdot \\mathbf{v}_{j}(x,y) \\, \\mathrm{d}x\\,\\mathrm{d}y$. These integrals are evaluated numerically using tensor-product Gauss-Legendre quadrature. This method approximates the 2D integral as a sum over a grid of quadrature points:\n$$\n\\int_{-1}^{1}\\int_{-1}^{1} g(x,y) \\, \\mathrm{d}x\\,\\mathrm{d}y \\approx \\sum_{i=1}^{n_x} \\sum_{j=1}^{n_y} w_{x,i} w_{y,j} g(x_i, y_j)\n$$\nwhere $(x_i, w_{x,i})$ and $(y_j, w_{y,j})$ are the Gauss-Legendre quadrature points and weights in the $x$ and $y$ directions, respectively. A 1D Gauss-Legendre rule with $n$ points integrates polynomials of degree up to $2n-1$ exactly.\n\nThe problem defines five tests to validate the implementation.\n\n**Test 1: Edge Orthogonality**\nThis test verifies the orthonormality of the tangential traces of the basis functions along their corresponding edge. For the top edge, the tangential component is $\\mathbf{v}^{\\mathrm{top}}_{k} \\cdot \\mathbf{t}_{\\mathrm{top}} = P_k(x)$. The test numerically evaluates $\\int_{-1}^{1} P_k(x) P_m(x) \\, \\mathrm{d}x$ for $k, m \\in \\{0, 1, 2, 3\\}$. The integrand's maximum polynomial degree is $3+3=6$ (for $k=m=3$). To integrate this exactly, a Gauss-Legendre rule with $n$ points must satisfy $2n-1 \\ge 6$, which implies $n \\ge 3.5$. Thus, $n=4$ points are sufficient. The result should be $1$ for $k=m$ and $0$ for $k \\neq m$, within a small tolerance.\n\n**Test 2: Mass Matrix Diagonal for Top Edge Modes**\nThis test computes $M_{kk} = \\int_{-1}^{1}\\int_{-1}^{1} \\mathbf{v}^{\\mathrm{top}}_{k} \\cdot \\mathbf{v}^{\\mathrm{top}}_{k} \\, \\mathrm{d}x\\,\\mathrm{d}y$. The integrand is:\n$$\n\\mathbf{v}^{\\mathrm{top}}_{k} \\cdot \\mathbf{v}^{\\mathrm{top}}_{k} = \\left( P_k(x) \\frac{1+y}{2} \\right)^2 = P_k(x)^2 \\left( \\frac{1+y}{2} \\right)^2\n$$\nThe integral is separable:\n$$\nM_{kk} = \\left( \\int_{-1}^{1} P_k(x)^2 \\, \\mathrm{d}x \\right) \\left( \\int_{-1}^{1} \\left( \\frac{1+y}{2} \\right)^2 \\, \\mathrm{d}y \\right) = (1) \\cdot \\left( \\frac{1}{4} \\int_{-1}^{1} (1+2y+y^2) \\, \\mathrm{d}y \\right) = \\frac{1}{4} \\left[ y + y^2 + \\frac{y^3}{3} \\right]_{-1}^{1} = \\frac{2}{3}\n$$\nThe integrand has degree $2k$ in $x$ (up to $6$) and $2$ in $y$. The specified quadrature ($n_x=4$, $n_y=2$) is exact for polynomials up to degree $2(4)-1=7$ in $x$ and $2(2)-1=3$ in $y$. This is sufficient, so the numerical result for each $k$ should be $\\frac{2}{3}$.\n\n**Test 3: Top-Bottom Coupling**\nThis test computes $C_k = \\int_{-1}^{1}\\int_{-1}^{1} \\mathbf{v}^{\\mathrm{top}}_{k} \\cdot \\mathbf{v}^{\\mathrm{bot}}_{k} \\, \\mathrm{d}x\\,\\mathrm{d}y$. The integrand is:\n$$\n\\mathbf{v}^{\\mathrm{top}}_{k} \\cdot \\mathbf{v}^{\\mathrm{bot}}_{k} = \\left( P_k(x) \\frac{1+y}{2} \\right) \\left( P_k(x) \\frac{1-y}{2} \\right) = P_k(x)^2 \\left( \\frac{1-y^2}{4} \\right)\n$$\nThe integral is also separable:\n$$\nC_k = \\left( \\int_{-1}^{1} P_k(x)^2 \\, \\mathrm{d}x \\right) \\left( \\int_{-1}^{1} \\frac{1-y^2}{4} \\, \\mathrm{d}y \\right) = (1) \\cdot \\left( \\frac{1}{4} \\left[ y - \\frac{y^3}{3} \\right]_{-1}^{1} \\right) = \\frac{1}{3}\n$$\nThe integrand has degree $2k$ in $x$ (up to $6$) and $2$ in $y$. The quadrature ($n_x=4$, $n_y=2$) is exact, so the numerical result for each $k$ should be $\\frac{1}{3}$.\n\n**Test 4: Horizontal-Vertical Decoupling**\nThis test computes a cross-orientation mass entry $\\int_{-1}^{1}\\int_{-1}^{1}\\mathbf{v}^{\\mathrm{top}}_{2} \\cdot \\mathbf{v}^{\\mathrm{left}}_{1}\\,\\mathrm{d}x\\,\\mathrm{d}y$. The integrand involves a dot product of the basis vectors:\n$$\n\\mathbf{v}^{\\mathrm{top}}_{2} \\cdot \\mathbf{v}^{\\mathrm{left}}_{1} = \\left( P_2(x) E_{\\mathrm{top}}(y) \\mathbf{t}_{\\mathrm{top}} \\right) \\cdot \\left( P_1(y) E_{\\mathrm{left}}(x) \\mathbf{t}_{\\mathrm{left}} \\right)\n$$\nSince $\\mathbf{t}_{\\mathrm{top}} = (1, 0)$ and $\\mathbf{t}_{\\mathrm{left}} = (0, 1)$, their dot product $\\mathbf{t}_{\\mathrm{top}} \\cdot \\mathbf{t}_{\\mathrm{left}} = 0$. The integrand is identically zero, so the integral is analytically $0$. Any valid quadrature rule will yield exactly $0$.\n\n**Test 5: Quadrature Insufficiency**\nThis test re-computes $M_{33}$ using an insufficient quadrature rule with $n_x=1$ and $n_y=1$. This corresponds to a single quadrature point at $(x,y)=(0,0)$ with weights $w_x=2$ and $w_y=2$. The approximation is:\n$$\nM_{33} \\approx (2)(2) \\cdot \\left( \\mathbf{v}^{\\mathrm{top}}_{3}(0,0) \\cdot \\mathbf{v}^{\\mathrm{top}}_{3}(0,0) \\right) = 4 \\left( P_3(0) \\frac{1+0}{2} \\right)^2\n$$\nThe standard Legendre polynomial $L_3(s) = \\frac{1}{2}(5s^3-3s)$ is an odd function, so $L_3(0)=0$. Consequently, $P_3(0)=0$, and the numerical integration yields $0$. The absolute difference from the correct value ($2/3$, from Test 2) is $|0 - 2/3| = 2/3$. This test demonstrates the importance of choosing a quadrature rule of sufficient order.\n\nThe implementation will follow these principles, using `numpy` for numerical arrays and its polynomial sub-package for Legendre polynomials and quadrature rules.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom numpy.polynomial.legendre import Legendre, leggauss\n\ndef solve():\n    \"\"\"\n    Implements and tests modal Nédélec second-kind edge basis functions\n    of order p=3 on a reference quadrilateral.\n    \"\"\"\n\n    # --- Part 1: Helper Functions (Polynomials and Quadrature) ---\n\n    def orthonormal_legendre_poly(k, s):\n        \"\"\"\n        Evaluates the orthonormal Legendre polynomial P_k(s) on [-1, 1].\n        P_k(s) = sqrt((2k+1)/2) * L_k(s), where L_k is the standard Legendre polynomial.\n        \"\"\"\n        if k  0:\n            raise ValueError(\"Polynomial degree k must be non-negative.\")\n        s = np.asarray(s)\n        # Using numpy's Legendre class to represent L_k(s)\n        Lk = Legendre.basis(k)\n        normalization_factor = np.sqrt((2 * k + 1) / 2.0)\n        return normalization_factor * Lk(s)\n\n    def integrate_1d(func, n_quad):\n        \"\"\"\n        Computes 1D integral of func over [-1, 1] using n_quad-point Gauss-Legendre quadrature.\n        \"\"\"\n        points, weights = leggauss(n_quad)\n        return np.sum(weights * func(points))\n\n    def integrate_2d(func, nx_quad, ny_quad):\n        \"\"\"\n        Computes 2D integral of func over [-1, 1] x [-1, 1] using tensor product\n        Gauss-Legendre quadrature.\n        \"\"\"\n        x_points, x_weights = leggauss(nx_quad)\n        y_points, y_weights = leggauss(ny_quad)\n        integral_val = 0.0\n        for i in range(nx_quad):\n            for j in range(ny_quad):\n                integral_val += x_weights[i] * y_weights[j] * func(x_points[i], y_points[j])\n        return integral_val\n\n    # --- Part 2: Basis Function Definitions ---\n\n    def v_top_k(x, y, k):\n        val = orthonormal_legendre_poly(k, x) * ((1 + y) / 2.0)\n        return np.array([val, 0.0])\n\n    def v_bot_k(x, y, k):\n        val = orthonormal_legendre_poly(k, x) * ((1 - y) / 2.0)\n        return np.array([val, 0.0])\n        \n    def v_left_k(x, y, k):\n        val = orthonormal_legendre_poly(k, y) * ((1 - x) / 2.0)\n        return np.array([0.0, val])\n\n    # --- Part 3: Test Suite Execution ---\n\n    results = []\n    \n    # Test 1: Edge Orthogonality on the Top Edge\n    is_orthogonal = True\n    tolerance = 1e-12\n    n_quad_ortho = 4  # Sufficient for degree 2*3=6\n    for k in range(4):\n        for m in range(4):\n            integrand = lambda x: orthonormal_legendre_poly(k, x) * orthonormal_legendre_poly(m, x)\n            integral_val = integrate_1d(integrand, n_quad_ortho)\n            expected = 1.0 if k == m else 0.0\n            if abs(integral_val - expected) > tolerance:\n                is_orthogonal = False\n                break\n        if not is_orthogonal:\n            break\n    results.append(is_orthogonal)\n\n    # Test 2: Mass Matrix Diagonal for Top Edge Modes\n    m_kk_list = []\n    nx, ny = 4, 2\n    for k in range(4):\n        integrand = lambda x, y: np.dot(v_top_k(x, y, k), v_top_k(x, y, k))\n        m_kk = integrate_2d(integrand, nx, ny)\n        m_kk_list.append(m_kk)\n    results.append(m_kk_list)\n    \n    # Test 3: Top-Bottom Coupling for Same Mode Index\n    c_k_list = []\n    for k in range(4):\n        integrand = lambda x, y: np.dot(v_top_k(x, y, k), v_bot_k(x, y, k))\n        c_k = integrate_2d(integrand, nx, ny)\n        c_k_list.append(c_k)\n    results.append(c_k_list)\n\n    # Test 4: Horizontal-Vertical Decoupling\n    # Integrand is v_top_2 . v_left_1\n    integrand_t4 = lambda x, y: np.dot(v_top_k(x, y, 2), v_left_k(x, y, 1))\n    cross_coupling = integrate_2d(integrand_t4, nx, ny)\n    results.append(cross_coupling)\n\n    # Test 5: Quadrature Insufficiency Edge Case\n    # M_33 for top edge with insufficient quadrature\n    m33_accurate = m_kk_list[3]\n    nx_ins, ny_ins = 1, 1\n    integrand_t5 = lambda x, y: np.dot(v_top_k(x, y, 3), v_top_k(x, y, 3))\n    m33_insufficient = integrate_2d(integrand_t5, nx_ins, ny_ins)\n    abs_diff = abs(m33_accurate - m33_insufficient)\n    results.append(abs_diff)\n    \n    # --- Part 4: Final Output Formatting ---\n\n    # Flatten the list of lists for printing\n    final_output_str = f\"[{results[0]},[{','.join(f'{v:.15f}' for v in results[1])}],[{','.join(f'{v:.15f}' for v in results[2])}],{results[3]:.15f},{results[4]:.15f}]\"\n    print(final_output_str)\n\nsolve()\n```"
        }
    ]
}