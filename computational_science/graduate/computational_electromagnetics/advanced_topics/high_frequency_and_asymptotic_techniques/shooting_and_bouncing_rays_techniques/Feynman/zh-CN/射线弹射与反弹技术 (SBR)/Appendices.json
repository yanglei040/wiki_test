{
    "hands_on_practices": [
        {
            "introduction": "SBR方法的核心在于将电磁波视为光线的集合，并对它们的贡献进行相干叠加。本练习将引导你回顾波动物理学的基本原理，通过分析两条镜面反射路径的干涉，来理解路径长度差如何转化为可观测的场强变化。这是掌握SBR中相位计算和场叠加概念的关键一步。",
            "id": "3347312",
            "problem": "一个自由空间波长为 $\\lambda$ 的时谐电磁平面波照射一个电大且电光滑的导电结构，在高频区，远场观测点的接收场由两条镜面反射射线路径 $p_{1}$ 和 $p_{2}$ 主导。根据弹道射线追踪（SBR）技术，每条镜面路径贡献的相位由光程长度决定，其幅度由路径上的累积反射和几何扩展决定。假设两条路径都未被遮挡，局部曲率远大于 $\\lambda$，且观测点位于夫琅禾费区。\n\n从自由空间中时谐场的麦克斯韦方程组和标量亥姆霍兹方程出发，应用高频程函近似和镜面反射的稳相原理，推导由两条镜面路径引起的接收复电场的远场表达式。从此表达式中，用幅度 $A_{1}$、$A_{2}$、自由空间波数 $k$ 以及路径长度 $L_{1}$ 和 $L_{2}$ 来表示归一化强度（场的模的平方）。\n\n然后，用程差 $\\Delta L = L_{1} - L_{2}$ 和 $k$ 来确定远场中发生相长干涉和相消干涉的一般条件。\n\n最后，对于特定情况 $\\lambda = 0.03\\,\\mathrm{m}$，$A_{1} = 0.9$，$A_{2} = 0.6$ 和 $\\Delta L = 0.012\\,\\mathrm{m}$，计算归一化强度。将最终的归一化强度表示为一个无量纲数，并将答案四舍五入到四位有效数字。",
            "solution": "该问题被验证为有科学依据、适定且客观。这是一个基于成熟原理的高频计算电磁学中的标准问题。\n\n在无源、均匀介质（自由空间）中，时谐电磁场（时间依赖关系 $\\exp(i\\omega t)$ 已被省略）的出发点是麦克斯韦方程组，由此可导出电场 $\\mathbf{E}$ 的矢量亥姆霍兹方程：\n$$\n\\nabla^2 \\mathbf{E} + k^2 \\mathbf{E} = \\mathbf{0}\n$$\n其中 $k = \\omega\\sqrt{\\mu_0\\epsilon_0} = 2\\pi/\\lambda$ 是自由空间波数，$\\lambda$ 是自由空间波长。\n\n在高频区（$k \\to \\infty$ 或 $\\lambda \\to 0$），场可以局部近似为平面波。这是程函近似的基础，我们寻求以下形式的解：\n$$\n\\mathbf{E}(\\mathbf{r}) = \\mathbf{e}(\\mathbf{r}) \\exp(-ikS(\\mathbf{r}))\n$$\n在此，$S(\\mathbf{r})$ 是快变相位函数，或称为程函，而 $\\mathbf{e}(\\mathbf{r})$ 是一个缓变复振幅矢量。将此形式代入亥姆霍兹方程，并只保留 $k$ 的最高阶项，即可得到程函方程：\n$$\n|\\nabla S(\\mathbf{r})|^2 = 1\n$$\n等 $S$ 值的曲面是几何光学的波前，而矢量场 $\\nabla S$ 的积分曲线就是射线，在均匀介质中射线是直线。\n\n弹道射线追踪（SBR）技术是这些高频原理的一个应用。观测点的总场是通过对所有从源点传播到观测点（可能经过结构反射）的几何光学射线的贡献求和来计算的。\n\n对于远场观测点，问题陈述接收场由两条镜面反射射线路径 $p_1$ 和 $p_2$ 主导。每条路径的复电场贡献可以建模为一个具有幅度和相位的波。设路径 $p_i$ 的贡献为 $E_i$。相位由光程长度 $L_i$ 决定，而幅度（记为 $A_i$）包含了初始场强、反射系数和几何扩展（发散）的影响。由于我们关心的是强度（一个标量），且问题没有指明极化变化，我们可以将场视为标量，假设它们共享一个可以被归一化掉的共同极化矢量。\n\n来自两条路径的复场贡献为：\n$$\nE_1 = A_1 \\exp(-ikL_1)\n$$\n$$\nE_2 = A_2 \\exp(-ikL_2)\n$$\n观测点的总复电场是这两个贡献的相干叠加：\n$$\nE_{total} = E_1 + E_2 = A_1 \\exp(-ikL_1) + A_2 \\exp(-ikL_2)\n$$\n归一化强度 $I$ 是总复场的模的平方：\n$$\nI = |E_{total}|^2 = |A_1 \\exp(-ikL_1) + A_2 \\exp(-ikL_2)|^2\n$$\n我们展开这个表达式：\n$$\nI = (A_1 \\exp(-ikL_1) + A_2 \\exp(-ikL_2))(A_1 \\exp(-ikL_1) + A_2 \\exp(-ikL_2))^*\n$$\n假设幅度 $A_1$ 和 $A_2$ 如问题中的具体数值所暗示的是实数，则其共轭为：\n$$\nI = (A_1 \\exp(-ikL_1) + A_2 \\exp(-ikL_2))(A_1 \\exp(ikL_1) + A_2 \\exp(ikL_2))\n$$\n$$\nI = A_1^2 \\exp(-ikL_1)\\exp(ikL_1) + A_1 A_2 \\exp(-ikL_1)\\exp(ikL_2) + A_2 A_1 \\exp(-ikL_2)\\exp(ikL_1) + A_2^2 \\exp(-ikL_2)\\exp(ikL_2)\n$$\n$$\nI = A_1^2 + A_1 A_2 \\exp(ik(L_2 - L_1)) + A_1 A_2 \\exp(-ik(L_1 - L_2)) + A_2^2\n$$\n使用恒等式 $\\exp(i\\theta) + \\exp(-i\\theta) = 2\\cos(\\theta)$，并定义程差 $\\Delta L = L_1 - L_2$，我们得到：\n$$\nI = A_1^2 + A_2^2 + A_1 A_2 (\\exp(-ik\\Delta L) + \\exp(ik\\Delta L))\n$$\n$$\nI = A_1^2 + A_2^2 + 2 A_1 A_2 \\cos(k \\Delta L)\n$$\n这就是用 $A_1$、$A_2$、$k$ 以及通过程差 $\\Delta L$ 表示的路径长度来表达的归一化强度表达式。\n\n接下来，我们确定相长干涉和相消干涉的条件。\n相长干涉对应于可能的最大强度。这发生在 $\\cos(k \\Delta L)$ 项为最大值时，即 $\\cos(k \\Delta L) = 1$。条件是：\n$$\nk \\Delta L = 2 \\pi n, \\quad \\text{for } n \\in \\{0, \\pm 1, \\pm 2, \\dots\\}\n$$\n这意味着程差是波长的整数倍，即 $\\Delta L = n\\lambda$。\n\n相消干涉对应于可能的最小强度。这发生在 $\\cos(k \\Delta L)$ 项为最小值时，即 $\\cos(k \\Delta L) = -1$。条件是：\n$$\nk \\Delta L = (2m + 1) \\pi, \\quad \\text{for } m \\in \\{0, \\pm 1, \\pm 2, \\dots\\}\n$$\n这意味着程差是波长的半整数倍，即 $\\Delta L = (m + 1/2)\\lambda$。\n\n最后，我们计算特定情况下的归一化强度：\n$\\lambda = 0.03\\,\\mathrm{m}$\n$A_1 = 0.9$\n$A_2 = 0.6$\n$\\Delta L = 0.012\\,\\mathrm{m}$\n\n首先，我们计算自由空间波数 $k$：\n$$\nk = \\frac{2\\pi}{\\lambda} = \\frac{2\\pi}{0.03}\\,\\mathrm{m}^{-1}\n$$\n接下来，我们计算相位差宗量 $k \\Delta L$：\n$$\nk \\Delta L = \\left(\\frac{2\\pi}{0.03}\\right) \\times 0.012 = 2\\pi \\times \\frac{0.012}{0.03} = 2\\pi \\times \\frac{12}{30} = 2\\pi \\times \\frac{2}{5} = \\frac{4\\pi}{5}\n$$\n现在，将数值代入强度公式：\n$$\nI = A_1^2 + A_2^2 + 2 A_1 A_2 \\cos(k \\Delta L)\n$$\n$$\nI = (0.9)^2 + (0.6)^2 + 2(0.9)(0.6)\\cos\\left(\\frac{4\\pi}{5}\\right)\n$$\n$$\nI = 0.81 + 0.36 + 1.08 \\cos\\left(\\frac{4\\pi}{5}\\right)\n$$\n$$\nI = 1.17 + 1.08 \\cos\\left(\\frac{4\\pi}{5}\\right)\n$$\n$\\cos(4\\pi/5)$ 的精确值是已知的：$\\cos(4\\pi/5) = -\\frac{1+\\sqrt{5}}{4}$。\n其数值约为 $\\cos(4\\pi/5) \\approx -0.809017$。\n$$\nI \\approx 1.17 + 1.08 \\times (-0.809017)\n$$\n$$\nI \\approx 1.17 - 0.87373836\n$$\n$$\nI \\approx 0.29626164\n$$\n将结果四舍五入到四位有效数字，我们得到：\n$$\nI \\approx 0.2963\n$$",
            "answer": "$$\n\\boxed{0.2963}\n$$"
        },
        {
            "introduction": "SBR方法虽然功能强大，但对于包含数百万个面的复杂场景，若无优化，其计算成本将高得令人望而却步。本练习探讨了为何包围盒层次结构（BVH）等加速结构对SBR至关重要。你将估算其计算复杂度，并量化BVH带来的巨大性能提升，从而理解如何将一个理论上复杂度为 $O(N)$ 的问题转化为一个实践中复杂度为 $O(\\log N)$ 的高效解法。",
            "id": "3347334",
            "problem": "在高频计算电磁学中的射线弹射法 (SBR) 中，电磁波在几何光学极限下被建模为射线，这些射线在均匀区域中沿直线传播，在理想电导体表面发生镜面反射，并根据Fermat原理累积相位。枚举最多包含 $B$ 次反弹的射线路径时的主要计算成本，是针对一个由 $N$ 个面元组成的三角化环境进行的重复性射线-表面相交测试。为加速相交测试，一种常用策略是使用包围盒层次结构 (BVH)：这是一种由嵌套的轴对齐包围盒组成的树状结构，它对图元进行划分，从而使得遍历过程可以剪掉大部分空间。考虑这样一个设计：在 $N$ 个三角形上构建一个平衡二叉BVH，其包围盒为轴对齐包围盒，每个叶节点最多包含 $L$ 个三角形。假设射线方向均匀、几何形状非退化，且节点包围盒足够紧密，因此每次成功相交查询访问的内部节点的期望数量与树的深度成正比。设一次射线-包围盒测试的成本为 $t_b$ 秒，一次射线-三角形测试的成本为 $t_p$ 秒。在此场景下，取以下数值：$N=10^6$，$L=8$，$B=5$，$t_b=2\\times 10^{-9}\\,\\mathrm{s}$，以及 $t_p=1\\times 10^{-8}\\,\\mathrm{s}$。为了进行复杂度估计，我们将访问内部节点的期望数量建模为 $2\\,\\log_2(N/L)$，将叶节点图元测试的数量建模为 $L$。忽略诸如反射定律评估、路径记录和BVH构建时间等次要成本，仅关注路径枚举过程中的稳态下每次反弹的相交成本。\n\n在给定的BVH设计下，哪个选项最能描述每次射线-表面相交的期望计算复杂度，并正确计算出BVH加速情况下的稳态路径枚举吞吐量（射线/秒），以及相应的朴素（无加速）吞吐量和提升因子？\n\nA. 平衡二叉BVH意味着每次相交的期望工作量为 $\\mathcal{O}\\!\\left(\\log_2(N/L)+L\\right)$ 次测试，每次反弹的时间为 $T_{\\mathrm{BVH,\\,bounce}}\\approx 2\\,\\log_2(N/L)\\,t_b+L\\,t_p$。使用给定参数，$T_{\\mathrm{BVH,\\,bounce}}\\approx 2\\,\\log_2(10^6/8)\\cdot(2\\times 10^{-9})+8\\cdot(1\\times 10^{-8})\\approx 1.48\\times 10^{-7}\\,\\mathrm{s}$，因此每条路径的时间为 $T_{\\mathrm{BVH,\\,path}}\\approx B\\,T_{\\mathrm{BVH,\\,bounce}}\\approx 5\\cdot 1.48\\times 10^{-7}\\approx 7.4\\times 10^{-7}\\,\\mathrm{s}$，BVH的吞吐量约为 $1/T_{\\mathrm{BVH,\\,path}} \\approx 1.35 \\times 10^{6}$ 射线/秒。朴素方法每次反弹的时间为 $T_{\\mathrm{naive,\\,bounce}}\\approx N\\,t_p=10^6\\cdot(1\\times 10^{-8})=1\\times 10^{-2}\\,\\mathrm{s}$，得到 $T_{\\mathrm{naive,\\,path}}\\approx B\\,T_{\\mathrm{naive,\\,bounce}}=5\\times 10^{-2}\\,\\mathrm{s}$，朴素方法的吞吐量为 $1/T_{\\mathrm{naive,\\,path}} \\approx 20$ 射线/秒。提升因子约为 $(1/T_{\\mathrm{BVH,\\,path}})/(1/T_{\\mathrm{naive,\\,path}}) \\approx 6.7 \\times 10^{4}$。\n\nB. BVH中的空间相干性导致每次相交的期望工作量为 $\\mathcal{O}\\!\\left(\\sqrt{N}\\right)$ 次测试，因此 $T_{\\mathrm{BVH,\\,bounce}}\\approx \\sqrt{N}\\,t_b+L\\,t_p$。使用给定参数，$T_{\\mathrm{BVH,\\,path}}\\approx B\\,\\left(\\sqrt{10^6}\\cdot(2\\times 10^{-9})+8\\cdot(1\\times 10^{-8})\\right)\\approx 5\\cdot\\left(10^3\\cdot 2\\times 10^{-9}+8\\times 10^{-8}\\right)\\approx 5\\cdot\\left(2\\times 10^{-6}+8\\times 10^{-8}\\right)\\approx 1.04\\times 10^{-5}\\,\\mathrm{s}$，得到BVH的吞吐量约为 $9.6\\times 10^{4}$ 射线/秒。朴素方法的吞吐量仍约为 $20$ 射线/秒，因此提升因子约为 $\\approx 4.8\\times 10^{3}$。\n\nC. BVH确保每次相交的期望图元测试次数为常数，与 $N$ 无关，即 $\\mathcal{O}(1)$，因此无论 $N$ 为何值，$T_{\\mathrm{BVH,\\,bounce}}\\approx L\\,t_p$。使用给定的 $L$ 和 $t_p$，$T_{\\mathrm{BVH,\\,path}}\\approx B\\,L\\,t_p=5\\cdot 8\\cdot(1\\times 10^{-8})=4\\times 10^{-7}\\,\\mathrm{s}$，得到BVH的吞吐量约为 $2.5\\times 10^{6}$ 射线/秒。朴素方法的吞吐量约为 $20$ 射线/秒，因此提升因子约为 $\\approx 1.25\\times 10^{5}$。\n\nD. BVH遍历引入了开销，由于冗余的包围盒测试，将每次相交的成本增加到 $\\mathcal{O}\\!\\left(N\\right)$，因此 $T_{\\mathrm{BVH,\\,bounce}}\\approx N\\,t_b$。使用给定参数，$T_{\\mathrm{BVH,\\,path}}\\approx B\\,N\\,t_b=5\\cdot 10^6\\cdot(2\\times 10^{-9})=1\\times 10^{-2}\\,\\mathrm{s}$，与朴素方法的每条路径时间相同，没有提供吞吐量提升。",
            "solution": "射线弹射法 (SBR) 在Maxwell方程组的高频极限下运作，此时电磁场行为可以很好地用几何光学来近似：射线在均匀介质中沿直线传播，根据反射定律在理想导电边界上发生镜面反射，并累积与稳态光程长度一致的相位。SBR中的路径枚举计算包含 $B$ 次镜面相互作用的序列，这意味着核心的内循环成本是每次反弹的射线-表面相交测试。在朴素方法中，每次射线-表面相交测试会检查所有 $N$ 个三角形，因此每次反弹的复杂度为 $\\mathcal{O}(N)$ 次测试。\n\n为降低此成本，包围盒层次结构 (BVH) 使用嵌套的轴对齐包围盒来划分空间，使得遍历过程可以剪除不大可能与射线相交的大片区域。在一个叶节点容量为 $L$ 的平衡二叉BVH中，其高度 $h$ 的尺度关系为 $h\\approx \\log_2(N/L)$，并且在射线均匀分布和包围盒紧密的假设下，每次查询访问的内部节点的期望数量与树的深度成正比。通常情况下，每条射线访问节点的期望数量是树深度的某个常数倍；我们采用每次相交访问 $2\\,\\log_2(N/L)$ 个内部节点和测试 $L$ 个叶节点图元的模型。因此，每次反弹的期望相交时间为\n$$\nT_{\\mathrm{BVH,\\,bounce}}\\approx 2\\,\\log_2(N/L)\\,t_b + L\\,t_p,\n$$\n其测试次数的复杂度为 $\\mathcal{O}\\!\\left(\\log_2(N/L)+L\\right)$，对于固定的 $L$ 和较大的 $N$，主导项的复杂度为 $\\mathcal{O}\\!\\left(\\log N\\right)$，而朴素方法的复杂度为 $\\mathcal{O}(N)$。\n\n使用给定参数，我们首先计算\n$$\n\\log_2\\!\\left(\\frac{N}{L}\\right)=\\log_2\\!\\left(\\frac{10^6}{8}\\right)=\\log_2(125000)\\approx 16.97.\n$$\n因此，访问内部节点的期望数量大约为 $2\\cdot 16.97\\approx 33.94$，为方便起见，我们将其四舍五入为 $34$，而叶节点图元测试的数量为 $L=8$。每次反弹的时间变为\n$$\nT_{\\mathrm{BVH,\\,bounce}}\\approx 2\\,\\log_2(N/L)\\,t_b + L\\,t_p \\approx 2\\cdot 16.97\\cdot(2\\times 10^{-9}) + 8\\cdot(1\\times 10^{-8}) \\approx 6.8\\times 10^{-8} + 8.0\\times 10^{-8} \\approx 1.48\\times 10^{-7}\\,\\mathrm{s}.\n$$\n对于 $B=5$ 次反弹，每条路径的时间为\n$$\nT_{\\mathrm{BVH,\\,path}}\\approx B\\,T_{\\mathrm{BVH,\\,bounce}} \\approx 5\\cdot 1.48\\times 10^{-7} \\approx 7.4\\times 10^{-7}\\,\\mathrm{s}.\n$$\n因此，BVH加速后的吞吐量为\n$$\n\\mathrm{Throughput}_{\\mathrm{BVH}}\\approx \\frac{1}{T_{\\mathrm{BVH,\\,path}}}\\approx \\frac{1}{7.4\\times 10^{-7}}\\approx 1.35\\times 10^{6}\\ \\text{射线/秒}.\n$$\n\n对于朴素方法，每次反弹的时间为\n$$\nT_{\\mathrm{naive,\\,bounce}}\\approx N\\,t_p = 10^6\\cdot (1\\times 10^{-8})=1\\times 10^{-2}\\,\\mathrm{s},\n$$\n因此每条路径的时间和吞吐量为\n$$\nT_{\\mathrm{naive,\\,path}}\\approx B\\,T_{\\mathrm{naive,\\,bounce}}=5\\cdot 10^{-2}=5\\times 10^{-2}\\,\\mathrm{s},\\qquad \\mathrm{Throughput}_{\\mathrm{naive}}\\approx \\frac{1}{5\\times 10^{-2}} \\approx 20\\ \\text{射线/秒}.\n$$\n提升因子为\n$$\n\\frac{\\mathrm{Throughput}_{\\mathrm{BVH}}}{\\mathrm{Throughput}_{\\mathrm{naive}}}\\approx \\frac{1.35\\times 10^{6}}{20}\\approx 6.75\\times 10^{4}\\approx 6.7\\times 10^{4}.\n$$\n\n我们现在来评估每个选项：\n\n- 选项A：该选项指出，每次相交的期望工作量为 $\\mathcal{O}\\!\\left(\\log_2(N/L)+L\\right)$ 次测试，并给出每次反弹的时间模型为 $T_{\\mathrm{BVH,\\,bounce}}\\approx 2\\,\\log_2(N/L)\\,t_b+L\\,t_p$。然后，它使用所给参数计算了每条路径的时间、BVH吞吐量、朴素吞吐量和提升因子。这些值与上面的推导相符：$T_{\\mathrm{BVH,\\,bounce}}\\approx 1.48\\times 10^{-7}\\,\\mathrm{s}$，$T_{\\mathrm{BVH,\\,path}}\\approx 7.4\\times 10^{-7}\\,\\mathrm{s}$，$\\mathrm{Throughput}_{\\mathrm{BVH}}\\approx 1.35\\times 10^{6}$ 射线/秒，$\\mathrm{Throughput}_{\\mathrm{naive}}\\approx 20$ 射线/秒，以及提升因子 $\\approx 6.7\\times 10^{4}$。结论：正确。\n\n- 选项B：该选项声称由于空间相干性，测试次数为 $\\mathcal{O}\\!\\left(\\sqrt{N}\\right)$。虽然空间相干性可以减小常数因子，但在均匀分布和平衡树的条件下，标准的BVH遍历复杂度与树的深度成正比，即 $\\mathcal{O}(\\log N)$，而非 $\\mathcal{O}(\\sqrt{N})$。此处计算的吞吐量（$\\approx 9.6\\times 10^{4}$ 射线/秒）与正确的 $\\mathcal{O}(\\log N)$ 行为及我们推导出的数值不符。结论：错误。\n\n- 选项C：该选项断言，对于BVH，每次相交的期望图元测试次数为 $\\mathcal{O}(1)$，与 $N$ 无关。这通常是不正确的；虽然固定的叶节点容量 $L$ 限制了图元测试的次数，但BVH遍历仍然需要进行一定数量的包围盒测试，在平衡树中该数量随 $\\log N$ 增长。其计算的吞吐量 $2.5\\times 10^{6}$ 射线/秒忽略了随 $\\log N$ 增长且不可忽略的射线-包围盒测试成本。结论：错误。\n\n- 选项D：该选项声称由于冗余的包围盒测试，BVH遍历将成本增加到 $\\mathcal{O}(N)$，从而使BVH的性能等同于朴素方法。这与BVH固有的剪枝优势以及在典型几何场景中已得到公认的对数遍历复杂度相矛盾。结论：错误。\n\n因此，在所述假设下，唯一正确描述了复杂度并计算了吞吐量和提升因子的选项是 A。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "实现一个快速的射线追踪器是一回事，而实现一个*鲁棒*的追踪器则是另一项挑战。本练习深入探讨了计算几何中一个关键但常被忽视的挑战：浮点数精度问题。你将学习如何为BVH设计一个鲁棒的可见性测试，重点是采用尺度自适应的容差来防止错误的自相交等常见数值问题，这对于构建可靠的SBR求解器至关重要。",
            "id": "3347284",
            "problem": "考虑一个计算电磁学中的高频弹跳射线法（SBR）求解器，该求解器在三角化导体上的两个表面点之间追踪射线段以判断可见性。几何结构被组织在一个包围盒层次结构（BVH）中，其内部节点是具有中心、方向和范围的定向包围盒（OBB）。在某个小面片上的一个发射点和另一个小面片上的一个接收点之间的可见性查询，会构建一个具有参数表示的射线段，并遍历BVH以检测沿该射线段的任何遮挡相交。一个鲁棒的实现必须能防止在发射点小面片上的错误自相交，以及由浮点舍入引起的虚假未命中或命中。\n\n假设发射点位于小面片 $F_0$ 上的位置 $x_0 \\in \\mathbb{R}^3$，接收点位于小面片 $F_1$ 上的位置 $x_1 \\in \\mathbb{R}^3$，射线段方向为 $d = \\dfrac{x_1 - x_0}{\\|x_1 - x_0\\|}$，射线段长度为 $L = \\|x_1 - x_0\\|$。每个OBB节点由中心 $c \\in \\mathbb{R}^3$、一个其列为局部坐标轴的标准正交旋转矩阵 $R \\in \\mathbb{R}^{3 \\times 3}$，以及沿这些轴的半长 $h \\in \\mathbb{R}^3$ 来定义。浮点系统的机器精度（单位舍入误差）为 $\\epsilon_{\\mathrm{mach}}$。\n\n哪个选项正确地为 OBB/BVH 遍历制定了一个鲁棒的可见性测试，并指定了能够避免因浮点错误导致的错误自相交的尺度感知容差？请选择最佳选项。\n\nA. 通过 $x' = R^{\\top}(x_0 - c)$ 和 $d' = R^{\\top} d$（其中 $\\|d\\| = 1$）将射线段变换到每个OBB的局部坐标系中，并通过强制不等式 $-h_i \\le x'_i + t d'_i \\le h_i$（对于 $i \\in \\{1,2,3\\}$）来执行平板相交测试。对于每个轴，如果对于某个阈值 $\\delta_d$ 有 $\\lvert d'_i \\rvert  \\delta_d$，则在 $x'_i \\notin [-h_i,h_i]$ 时拒绝该节点；否则计算 $t_i^- = \\dfrac{-h_i - x'_i}{d'_i}$ 和 $t_i^+ = \\dfrac{h_i - x'_i}{d'_i}$，并定义 $t_{\\mathrm{entry}} = \\max_i \\min(t_i^-,t_i^+)$ 和 $t_{\\mathrm{exit}} = \\min_i \\max(t_i^-,t_i^+)$。如果 $t_{\\mathrm{entry}} \\le t_{\\mathrm{exit}}$、$t_{\\mathrm{exit}} \\ge t_{\\mathrm{min}}$ 和 $t_{\\mathrm{entry}} \\le t_{\\mathrm{max}}$，则遍历该节点，其中 $t_{\\mathrm{min}} = \\eta$ 和 $t_{\\mathrm{max}} = L - \\eta$，使用尺度感知的容差 $\\eta = \\max\\!\\big(\\alpha\\,\\epsilon_{\\mathrm{mach}}\\,L,\\ \\beta\\,\\epsilon_{\\mathrm{mach}}\\,S\\big)$，$S = \\max\\{\\|x_0\\|,\\|x_1\\|,\\|c\\|+\\|h\\|\\}$, 且常数 $\\alpha,\\beta  0$。使用 $\\delta_d = \\gamma\\,\\epsilon_{\\mathrm{mach}}$ 且 $\\gamma  0$。在叶节点中测试三角形时，拒绝满足 $t \\le t_{\\mathrm{min}}$ 或 $t \\ge t_{\\mathrm{max}}$ 的相交，以避免自命中和端点命中。\n\nB. 在世界坐标系中，针对轴对齐包围盒测试相交，而不变换到局部 OBB 坐标系，使用 $t_{\\mathrm{min}} = 0$ 和 $t_{\\mathrm{max}} = L$。对于 $\\lvert d_i \\rvert$ 较小的轴，通过设置 $d_i \\leftarrow d_i + \\epsilon_{\\mathrm{mach}}$ 来限制分母并继续。依赖严格的 $t$ 区间检查来消除自相交。\n\nC. 将发射点沿小面片 $F_0$ 的单位法线 $n_0$ 偏移一个固定的常数，$x_0 \\leftarrow x_0 + \\eta\\,n_0$，并使用一个用户选择的绝对容差 $\\eta = 10^{-12}$，然后使用标准的 BVH 遍历追踪射线段，其中 $t \\in [0,L]$ 且不对分母进行额外处理。不使用接收端的容差，因为端点误差可以忽略不计。\n\nD. 使用 BVH 遍历，其中 $t_{\\mathrm{min}} = \\epsilon_{\\mathrm{mach}}\\,\\|d\\|\\,L$ 且 $t_{\\mathrm{max}} = L$。不对 $d$ 进行归一化，让其大小携带尺度信息。对于平板测试中的小分母，接受相交以避免除零错误，并依赖三角形级别的重心坐标检查来解决假阳性问题。无需坐标变换到 OBB 坐标系，因为在实践中 BVH 节点近似是轴对齐的。",
            "solution": "用户想要对一个关于计算电磁学中弹跳射线法（SBR）上下文中鲁棒射线追踪的问题进行批判性评估。该任务涉及验证问题陈述，然后在四个选项中识别出执行对浮点错误具有鲁棒性的可见性测试的正确方法。\n\n### **问题陈述验证**\n\n*   **步骤 1：提取已知条件**\n    *   **领域**: 计算电磁学中的高频弹跳射线法（SBR）。\n    *   **几何表示**: 一个被组织在包围盒层次结构（BVH）中的三角化导体。\n    *   **BVH 节点类型**: 定向包围盒（OBB）。\n    *   **OBB 定义**: 中心 $c \\in \\mathbb{R}^3$，方向矩阵 $R \\in \\mathbb{R}^{3 \\times 3}$，以及半长 $h \\in \\mathbb{R}^3$。\n    *   **射线段**: 起点位于小面片 $F_0$ 上的 $x_0 \\in \\mathbb{R}^3$，终点位于小面片 $F_1$ 上的 $x_1 \\in \\mathbb{R}^3$。\n    *   **射线参数化**: 方向 $d = \\dfrac{x_1 - x_0}{\\|x_1 - x_0\\|}$，长度 $L = \\|x_1 - x_0\\|$。射线上的一个点是 $P(t) = x_0 + t d$。\n    *   **数值精度**: 机器精度为 $\\epsilon_{\\mathrm{mach}}$。\n    *   **核心问题**: 为 OBB/BVH 遍历制定一个鲁棒的可见性测试，包括使用尺度感知的容差以防止错误的自相交和其他浮点不精确性。\n\n*   **步骤 2：使用提取的已知条件进行验证**\n    1.  **科学依据**：该问题在计算几何、计算机图形学和计算电磁学领域有充分的依据。SBR 方法是一种依赖于几何光学的标准高频技术，而鲁棒的射线追踪是其实现的关键组成部分。BVH、OBB、平板测试以及使用容差处理浮点错误都是既定的概念。\n    2.  **适定性**：该问题是适定的。它要求从一组选项中识别出正确且鲁棒的算法。这是评估对复杂实现细节理解的标准格式。此问题存在最佳实践，并可通过分析确定。\n    3.  **客观性**：问题陈述是客观的，使用了精确的技术术语。“鲁棒”实现的目标是数值算法中一个客观且核心的关注点。\n    4.  **缺陷清单**：该问题没有违反任何指定的缺陷类别。它在科学上是合理的，可形式化的，就其目的而言是完整的，现实的，并构成了一个不小的技术挑战。\n\n*   **步骤 3：结论与行动**\n    问题陈述是**有效的**。所描述的场景是应用计算科学中一个标准且重要的问题。我将继续推导解决方案并分析各个选项。\n\n### **解决方案推导与选项分析**\n\n一个针对 OBB 的 BVH 的射线段鲁棒可见性测试必须解决几个关键挑战：\n1.  **高效的射线-OBB相交测试**：射线-OBB相交的标准算法是平板测试。当在 OBB 的局部坐标系中执行此测试时，效率最高，此时 OBB 变为一个轴对齐包围盒（AABB）。这需要使用其方向矩阵的逆矩阵 $R^{\\top}$ 将射线的原点 $x_0$ 和方向 $d$ 变换到 OBB 的局部坐标系中。\n2.  **平板测试的数值稳定性**：平板测试涉及到除以射线方向向量在局部坐标系中的分量 $d'_i$。如果某个分量 $d'_i$ 非常接近于零（即射线几乎平行于相应平板的面），则除以 $d'_i$ 在数值上是不稳定的。必须通过检查射线的原点是否在该轴向的平板范围内来单独处理此特殊情况。使用一个与 $\\epsilon_{\\mathrm{mach}}$ 成比例的小阈值（例如 $\\delta_d$）来检测这种情况。\n3.  **射线端点的浮点误差**：\n    *   **自相交**：由于浮点表示，位于发射点小面片 $F_0$ 上的射线原点 $x_0$ 可能不完全位于三角形的数学平面上。射线-三角形相交测试随后可能在极小的参数值 $t \\approx 0$ 处发现与 $F_0$ 的相交，这是一个假阳性。\n    *   **端点未命中**：类似地，由于舍入误差，一个非常靠近接收点 $x_1$ 的遮挡物可能会被错误地漏掉或命中。\n    *   **鲁棒的解决方案**：处理这些问题的标准方法不是偏移射线原点（这种方法很脆弱，并且可能产生其他错误），而是为射线参数 $t$ 定义一个有效区间。不是在 $t \\in [0, L]$ 中搜索相交，而是在 $t \\in [t_{\\min}, t_{\\max}]$ 中搜索，其中 $t_{\\min} = \\eta_0$ 且 $t_{\\max} = L - \\eta_1$。容差 $\\eta_0$ 和 $\\eta_1$ 必须仔细选择。\n4.  **尺度感知的容差**：一个固定的、绝对的容差（例如 $10^{-12}$）是不鲁棒的。在具有大坐标的场景中，这个容差可能小于浮点误差，无法防止错误的命中。在尺寸非常小的场景中，它可能又太大了，导致射线错过其原点附近的小特征。一个鲁棒的容差 $\\eta$ 必须是*尺度感知的*。浮点误差随着所涉及数值的大小而缩放。因此，容差应取决于问题的特征长度，例如射线长度 $L$ 和场景对象坐标的大小（例如 $\\|x_0\\|, \\|c\\|$）。因此，一个形式良好的容差与 $\\epsilon_{\\mathrm{mach}}$ 乘以这些特征长度成比例。\n\n基于这些原则，我们来评估每个选项。\n\n---\n\n**A. 通过 $x' = R^{\\top}(x_0 - c)$ 和 $d' = R^{\\top} d$（其中 $\\|d\\| = 1$）将射线段变换到每个OBB的局部坐标系中，并通过强制不等式 $-h_i \\le x'_i + t d'_i \\le h_i$（对于 $i \\in \\{1,2,3\\}$）来执行平板相交测试。对于每个轴，如果对于某个阈值 $\\delta_d$ 有 $\\lvert d'_i \\rvert  \\delta_d$，则在 $x'_i \\notin [-h_i,h_i]$ 时拒绝该节点；否则计算 $t_i^- = \\dfrac{-h_i - x'_i}{d'_i}$ 和 $t_i^+ = \\dfrac{h_i - x'_i}{d'_i}$，并定义 $t_{\\mathrm{entry}} = \\max_i \\min(t_i^-,t_i^+)$ 和 $t_{\\mathrm{exit}} = \\min_i \\max(t_i^-,t_i^+)$。如果 $t_{\\mathrm{entry}} \\le t_{\\mathrm{exit}}$、$t_{\\mathrm{exit}} \\ge t_{\\mathrm{min}}$ 和 $t_{\\mathrm{entry}} \\le t_{\\mathrm{max}}$，则遍历该节点，其中 $t_{\\mathrm{min}} = \\eta$ 和 $t_{\\mathrm{max}} = L - \\eta$，使用尺度感知的容差 $\\eta = \\max\\!\\big(\\alpha\\,\\epsilon_{\\mathrm{mach}}\\,L,\\ \\beta\\,\\epsilon_{\\mathrm{mach}}\\,S\\big)$，$S = \\max\\{\\|x_0\\|,\\|x_1\\|,\\|c\\|+\\|h\\|\\}$, 且常数 $\\alpha,\\beta  0$。使用 $\\delta_d = \\gamma\\,\\epsilon_{\\mathrm{mach}}$ 且 $\\gamma  0$。在叶节点中测试三角形时，拒绝满足 $t \\le t_{\\mathrm{min}}$ 或 $t \\ge t_{\\mathrm{max}}$ 的相交，以避免自命中和端点命中。**\n\n*   **分析**：该选项描述了鲁棒射线-OBB相交测试的最先进方法。\n    *   它正确地在 OBB 的局部坐标系中使用了平板测试。\n    *   它正确地处理了射线几乎平行于平板面的数值不稳定情况。\n    *   它正确地指出了需要一个有效区间 $[t_{\\min}, t_{\\max}]$ 来避免端点误差。\n    *   至关重要的是，它定义了一个精密的、尺度感知的容差 $\\eta$，该容差考虑了来自射线长度（$L$）和几何实体绝对位置/大小（$S$）的误差传播。这种双分量容差是真正鲁棒实现的标志。\n    *   区间重叠检查（$t_{\\mathrm{entry}} \\le t_{\\mathrm{exit}}$、$t_{\\mathrm{exit}} \\ge t_{\\mathrm{min}}$、$t_{\\mathrm{entry}} \\le t_{\\mathrm{max}}$）的结构是正确的。\n    *   它正确地将相同的逻辑应用于最终的三角形相交测试。\n*   **结论**：**正确**。\n\n**B. 在世界坐标系中，针对轴对齐包围盒测试相交，而不变换到局部 OBB 坐标系，使用 $t_{\\mathrm{min}} = 0$ 和 $t_{\\mathrm{max}} = L$。对于 $\\lvert d_i \\rvert$ 较小的轴，通过设置 $d_i \\leftarrow d_i + \\epsilon_{\\mathrm{mach}}$ 来限制分母并继续。依赖严格的 $t$ 区间检查来消除自相交。**\n\n*   **分析**：该选项有严重缺陷。\n    *   忽略 OBB 的方向而在世界坐标系中使用其 AABB 会显著降低 BVH 的紧密性，使其效率低下。使用 OBB 的目的就是为了捕捉方向。\n    *   使用 $t_{\\min}=0$ 无法解决自相交问题，因为浮点误差可能导致相交参数 $t$ 为正但极小。\n    *   通过加上 $\\epsilon_{\\mathrm{mach}}$ 来限制分母是一种数值上很差且有偏的方法来处理近平行射线；正确的方法是使用一个独立的逻辑路径。\n*   **结论**：**不正确**。\n\n**C. 将发射点沿小面片 $F_0$ 的单位法线 $n_0$ 偏移一个固定的常数，$x_0 \\leftarrow x_0 + \\eta\\,n_0$，并使用一个用户选择的绝对容差 $\\eta = 10^{-12}$，然后使用标准的 BVH 遍历追踪射线段，其中 $t \\in [0,L]$ 且不对分母进行额外处理。不使用接收端的容差，因为端点误差可以忽略不计。**\n\n*   **分析**：该选项描述了一种常见但脆弱且有问题的启发式方法。\n    *   使用像 $\\eta = 10^{-12}$ 这样的固定绝对容差不是尺度感知的，在许多场景中都会失败。\n    *   物理上偏移射线原点会改变射线路径，这会引入其自身的一类错误（例如，穿过薄壁或错过表面附近的遮挡物）。\n    *   “端点误差可以忽略不计”的断言是错误的；鲁棒性要求处理射线段两端的误差。\n    *   忽略对小分母进行特殊处理的需求可能导致除零异常或大的数值错误。\n*   **结论**：**不正确**。\n\n**D. 使用 BVH 遍历，其中 $t_{\\mathrm{min}} = \\epsilon_{\\mathrm{mach}}\\,\\|d\\|\\,L$ 且 $t_{\\mathrm{max}} = L$。不对 $d$ 进行归一化，让其大小携带尺度信息。对于平板测试中的小分母，接受相交以避免除零错误，并依赖三角形级别的重心坐标检查来解决假阳性问题。无需坐标变换到 OBB 坐标系，因为在实践中 BVH 节点近似是轴对齐的。**\n\n*   **分析**：该选项提出了多个不正确或被误导的想法。\n    *   如果 $d$ 未被归一化，则 $d = x_1 - x_0$，其大小为 $\\|d\\|=L$。所提出的容差 $t_{\\min} = \\epsilon_{\\mathrm{mach}}\\,\\|d\\|\\,L$ 变为 $t_{\\min} = \\epsilon_{\\mathrm{mach}}\\,L^2$。这是量纲不一致的。对于未归一化的射线 $P(t) = x_0 + t(x_1-x_0)$，参数 $t$ 是无量纲的，范围从 0 到 1。而 $L^2$ 的单位是长度的平方。这个提议是荒谬的。\n    *   对于小分母“接受相交”的策略是极其低效的。它使 BVH 的主要目的——快速剔除场景中未相交的部分——失效。\n    *   “在实践中 OBB 近似是轴对齐的”这一前提是错误的。使用 OBB 而非 AABB 的根本原因就是为了处理非轴对齐的定向几何体。\n*   **结论**：**不正确**。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}