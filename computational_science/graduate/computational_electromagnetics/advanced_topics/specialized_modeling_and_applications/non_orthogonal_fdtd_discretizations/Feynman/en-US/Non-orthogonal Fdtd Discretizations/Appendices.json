{
    "hands_on_practices": [
        {
            "introduction": "To accurately model complex geometries, computational electromagnetics often requires moving from simple Cartesian grids to non-orthogonal ones. This transition is elegantly handled by the framework of Discrete Exterior Calculus (DEC), which separates the grid's topology (how cells are connected) from its geometry (lengths, angles, and areas). This exercise provides a concrete starting point by having you construct the fundamental topological operators—the incidence matrices—for a single 2D skewed cell, and then use them to compute a discrete curl, directly connecting the abstract algebraic framework to the physical concept of circulation from Stokes' theorem .",
            "id": "3334470",
            "problem": "Consider a two-dimensional non-orthogonal cell used in Finite-Difference Time-Domain (FDTD) discretizations on skewed grids. The cell is a single convex quadrilateral with labeled nodes, edges, and one face. The nodes are labeled counterclockwise and have Cartesian coordinates\n$$\nn_1=(0,0),\\quad n_2=(2,0.5),\\quad n_3=(2.2,1.7),\\quad n_4=(0,1.5).\n$$\nDefine four oriented edges along the polygon boundary,\n$$\ne_1: n_1 \\to n_2,\\quad e_2: n_2 \\to n_3,\\quad e_3: n_3 \\to n_4,\\quad e_4: n_4 \\to n_1,\n$$\nand let the single face be oriented counterclockwise so that its boundary orientation is $n_1 \\to n_2 \\to n_3 \\to n_4 \\to n_1$. \n\n1) Construct explicitly the node–edge incidence matrix $G$ that maps a node-based scalar field to oriented edge differences, and the face–edge incidence matrix $C$ that maps oriented edge values to the oriented boundary sum around the face. Use the stated orientations and ordering $\\{n_1,n_2,n_3,n_4\\}$ for nodes, $\\{e_1,e_2,e_3,e_4\\}$ for edges, and the single face $\\{f_1\\}$.\n\n2) Starting from Faraday’s law in integral form and Stokes’ theorem, explain how the average out-of-plane component of the discrete curl of the electric field over the face can be computed from the oriented circulation around the boundary divided by the face area.\n\nNow suppose the edge field represents the line-integrated tangential electric field (voltage) along each oriented edge, given (in volts) by\n$$\ne_1=3.0,\\quad e_2=-1.5,\\quad e_3=0.8,\\quad e_4=2.7.\n$$\nCompute the average out-of-plane discrete curl over the face using these edge values and the stated orientation conventions. Express your final numerical answer in $\\mathrm{V}\\,\\mathrm{m}^{-2}$ and round your answer to four significant figures.",
            "solution": "The problem statement has been validated and found to be scientifically sound, well-posed, and objective. It is grounded in the established principles of computational electromagnetics and discrete calculus on manifolds. The provided data is complete and consistent, allowing for a unique and meaningful solution. We may therefore proceed.\n\nThe problem is addressed in three parts: construction of incidence matrices, theoretical explanation of the discrete curl, and numerical computation.\n\n**1) Construction of Incidence Matrices**\n\nThe problem requires the construction of two incidence matrices, $G$ and $C$, which represent discrete differential operators (gradient and curl, respectively) on the given quadrilateral cell.\n\nThe node–edge incidence matrix, $G$, maps a scalar potential field defined on the nodes to a vector field of differences defined on the oriented edges. It is often referred to as the discrete gradient operator. The matrix $G$ has dimensions $N_e \\times N_n$, where $N_e=4$ is the number of edges and $N_n=4$ is the number of nodes. The entry $G_{ij}$ is $+1$ if node $j$ is the head of edge $i$, $-1$ if it is the tail, and $0$ otherwise. The nodes are ordered $\\{n_1, n_2, n_3, n_4\\}$ and the edges are ordered $\\{e_1, e_2, e_3, e_4\\}$.\n\n- For edge $e_1: n_1 \\to n_2$, the corresponding row vector is $(-1, 1, 0, 0)$.\n- For edge $e_2: n_2 \\to n_3$, the corresponding row vector is $(0, -1, 1, 0)$.\n- For edge $e_3: n_3 \\to n_4$, the corresponding row vector is $(0, 0, -1, 1)$.\n- For edge $e_4: n_4 \\to n_1$, the corresponding row vector is $(1, 0, 0, -1)$.\n\nAssembling these rows gives the node–edge incidence matrix $G$:\n$$\nG = \\begin{pmatrix}\n-1 & 1 & 0 & 0 \\\\\n0 & -1 & 1 & 0 \\\\\n0 & 0 & -1 & 1 \\\\\n1 & 0 & 0 & -1\n\\end{pmatrix}\n$$\n\nThe face–edge incidence matrix, $C$, maps an oriented edge field to a scalar field on the faces, representing the oriented boundary sum (circulation) for each face. It is related to the discrete curl operator. The matrix $C$ has dimensions $N_f \\times N_e$, where $N_f=1$ is the number of faces and $N_e=4$ is the number of edges. The entry $C_{ij}$ is $+1$ if edge $j$ has the same orientation as the boundary of face $i$, $-1$ if it has the opposite orientation, and $0$ if it is not on the boundary.\n\nWe have one face, $f_1$, with a counterclockwise boundary orientation $n_1 \\to n_2 \\to n_3 \\to n_4 \\to n_1$. We compare the orientation of each edge to this boundary traversal:\n- Edge $e_1: n_1 \\to n_2$ matches the boundary orientation. The entry is $+1$.\n- Edge $e_2: n_2 \\to n_3$ matches the boundary orientation. The entry is $+1$.\n- Edge $e_3: n_3 \\to n_4$ matches the boundary orientation. The entry is $+1$.\n- Edge $e_4: n_4 \\to n_1$ matches the boundary orientation. The entry is $+1$.\n\nThus, the face–edge incidence matrix $C$ is a $1 \\times 4$ row matrix:\n$$\nC = \\begin{pmatrix}\n1 & 1 & 1 & 1\n\\end{pmatrix}\n$$\n\n**2) Discrete Curl from Stokes' Theorem**\n\nFaraday's law of induction in integral form states that the circulation of the electric field $\\mathbf{E}$ around a closed loop $\\partial\\Sigma$ is equal to the negative time rate of change of the magnetic flux through the surface $\\Sigma$ bounded by the loop:\n$$\n\\oint_{\\partial\\Sigma} \\mathbf{E} \\cdot d\\mathbf{l} = - \\frac{d}{dt} \\iint_{\\Sigma} \\mathbf{B} \\cdot d\\mathbf{S}\n$$\nBy the classical Stokes' theorem, the circulation of a vector field is also equal to the flux of its curl through the enclosed surface:\n$$\n\\oint_{\\partial\\Sigma} \\mathbf{E} \\cdot d\\mathbf{l} = \\iint_{\\Sigma} (\\nabla \\times \\mathbf{E}) \\cdot d\\mathbf{S}\n$$\nIn the context of a discrete FDTD grid, these continuum integrals are approximated. For a single planar face $f$ in the $xy$-plane with area $A_f$, the surface integral of the curl's component normal to the face (the out-of-plane or $z$-component) is approximated by the product of the average value of this component over the face and the face area:\n$$\n\\iint_{f} (\\nabla \\times \\mathbf{E}) \\cdot d\\mathbf{S} = \\iint_{f} (\\nabla \\times \\mathbf{E})_z dA \\approx \\langle (\\nabla \\times \\mathbf{E})_z \\rangle_f A_f\n$$\nThe line integral, or circulation, is approximated by summing the line-integrated tangential electric field components along each bounding edge. The problem provides these values directly as the edge fields $e_i$. The sum must account for the orientation of each edge relative to the counterclockwise boundary traversal of the face.\n$$\n\\oint_{\\partial f} \\mathbf{E} \\cdot d\\mathbf{l} \\approx \\sum_{i} s_i e_i\n$$\nwhere $s_i = +1$ if edge $i$ is aligned with the boundary path and $s_i = -1$ if it is opposed. This sum is precisely the circulation, which can be computed as the matrix product of $C$ and the column vector of edge fields.\n\nEquating the discrete approximations of the two sides of Stokes' theorem yields:\n$$\n\\text{Circulation} = \\sum_{i} s_i e_i \\approx \\langle (\\nabla \\times \\mathbf{E})_z \\rangle_f A_f\n$$\nTherefore, the average out-of-plane component of the discrete curl of the electric field over the face is computed as the ratio of the total oriented circulation around the face boundary to the area of the face:\n$$\n\\langle (\\nabla \\times \\mathbf{E})_z \\rangle_f = \\frac{\\text{Circulation}}{A_f}\n$$\n\n**3) Numerical Computation**\n\nFirst, we compute the circulation around the face using the given edge field values: $e_1=3.0\\,\\mathrm{V}$, $e_2=-1.5\\,\\mathrm{V}$, $e_3=0.8\\,\\mathrm{V}$, $e_4=2.7\\,\\mathrm{V}$. As established in Part 1, all edges $e_1, e_2, e_3, e_4$ are oriented in the same direction as the counterclockwise boundary of the face. Thus, the circulation is the direct sum of the edge values:\n$$\n\\text{Circulation} = e_1 + e_2 + e_3 + e_4 = 3.0 - 1.5 + 0.8 + 2.7 = 5.0\\,\\mathrm{V}\n$$\nNext, we compute the area of the quadrilateral face defined by the nodes $n_1=(0,0)$, $n_2=(2,0.5)$, $n_3=(2.2,1.7)$, and $n_4=(0,1.5)$. We use the shoelace formula for the area of a polygon with vertices $(x_i, y_i)$:\n$$\nA_f = \\frac{1}{2} |(x_1y_2 + x_2y_3 + x_3y_4 + x_4y_1) - (y_1x_2 + y_2x_3 + y_3x_4 + y_4x_1)|\n$$\nSubstituting the node coordinates, and assuming the coordinates are in meters ($\\mathrm{m}$), we get:\n$$\nx_1y_2 = 0 \\times 0.5 = 0\n\\quad\nx_2y_3 = 2 \\times 1.7 = 3.4\n\\quad\nx_3y_4 = 2.2 \\times 1.5 = 3.3\n\\quad\nx_4y_1 = 0 \\times 0 = 0\n$$\n$$\ny_1x_2 = 0 \\times 2 = 0\n\\quad\ny_2x_3 = 0.5 \\times 2.2 = 1.1\n\\quad\ny_3x_4 = 1.7 \\times 0 = 0\n\\quad\ny_4x_1 = 1.5 \\times 0 = 0\n$$\nThe area is then:\n$$\nA_f = \\frac{1}{2} |(0 + 3.4 + 3.3 + 0) - (0 + 1.1 + 0 + 0)| = \\frac{1}{2} |6.7 - 1.1| = \\frac{1}{2} (5.6) = 2.8\\,\\mathrm{m}^2\n$$\nFinally, we compute the average out-of-plane discrete curl:\n$$\n\\langle (\\nabla \\times \\mathbf{E})_z \\rangle_f = \\frac{5.0\\,\\mathrm{V}}{2.8\\,\\mathrm{m}^2} = \\frac{50}{28}\\,\\mathrm{V}\\,\\mathrm{m}^{-2} = \\frac{25}{14}\\,\\mathrm{V}\\,\\mathrm{m}^{-2} \\approx 1.785714...\\,\\mathrm{V}\\,\\mathrm{m}^{-2}\n$$\nRounding the result to four significant figures as requested gives $1.786\\,\\mathrm{V}\\,\\mathrm{m}^{-2}$.",
            "answer": "$$\\boxed{1.786}$$"
        },
        {
            "introduction": "A cornerstone of vector calculus is the identity $\\nabla \\cdot (\\nabla \\times \\mathbf{A}) = 0$. A robust numerical scheme should preserve such fundamental structural properties of the continuous equations. This practice first guides you through a coordinate-free derivation to show that the discrete version of this identity, often written as $d_2 d_1 = 0$, holds exactly within the DEC framework due to its purely topological nature . You will then contrast this \"exactness\" with the challenge of numerical accuracy by implementing and evaluating how well a common FDTD approximation captures the curl of a plane wave, revealing the sources of metric-dependent error.",
            "id": "3334437",
            "problem": "You are to work in the setting of computational electromagnetics on a non-orthogonal uniform Bravais lattice and use the language of Discrete Exterior Calculus (DEC) to connect the fundamental exactness property to a generalized Yee-type curl on an oblique grid. Your task has two parts: a derivation and an implementation. All lengths are in meters, all wave vectors are in radians per meter, and angles are in radians.\n\nPart A (principle). Start from the integral form of Maxwell’s equations, Stokes’ theorem, and the Discrete Exterior Calculus (DEC) definition of the exterior derivative on a cell complex. In DEC, discrete fields are cochains on a primal complex and its dual, the discrete exterior derivative is realized by incidence matrices between oriented cells, and the metric enters only through Hodge star operators. Use the following principles as the fundamental base:\n- The definition of the exterior derivative as the pullback of integration on oriented chains, i.e., for a smooth differential form, Stokes’ theorem relates the integral of its exterior derivative over a domain to the integral of the form over the boundary of the domain.\n- The topological identity that the boundary of a boundary is zero, expressed algebraically as the chain complex relation that the composition of boundary operators vanishes.\n- The identification in DEC that the discrete curl is the coboundary map from primal edges to primal faces, and the discrete divergence of a primal 2-cochain is the coboundary map from primal faces to primal 3-cells.\n\nFrom these principles derive, in a coordinate-free manner, that the discrete divergence of the discrete curl is identically zero on any well-oriented cell complex, independent of the metric or skewness of the cells. Express your derivation entirely in terms of oriented chains, cochains, and the composition of incidence matrices, and conclude that the discrete operator corresponding to $d_2 \\circ d_1$ must be the zero map. Do not use or quote any specialized formula for a particular grid.\n\nPart B (plane-wave comparison for generalized Yee curl). Consider a uniform non-orthogonal lattice with primitive vectors $\\mathbf{a}_1$, $\\mathbf{a}_2$, $\\mathbf{a}_3$ forming a parallelepiped cell with vertices at $\\mathbf{0}$, $\\mathbf{a}_1$, $\\mathbf{a}_2$, $\\mathbf{a}_3$, $\\mathbf{a}_1+\\mathbf{a}_2$, $\\mathbf{a}_1+\\mathbf{a}_3$, $\\mathbf{a}_2+\\mathbf{a}_3$, $\\mathbf{a}_1+\\mathbf{a}_2+\\mathbf{a}_3$. Let $\\mathbf{E}(\\mathbf{x})=\\mathbf{E}_0 e^{i \\mathbf{k}\\cdot \\mathbf{x}}$ be a time-harmonic plane wave with angular frequency $\\omega$ suppressed; here $\\mathbf{E}_0 \\in \\mathbb{C}^3$ is constant and $\\mathbf{k}\\in\\mathbb{R}^3$ is the wave vector.\n\nDefine the exact face-integrated curl on the three faces attached to the origin by Stokes’ theorem as the circulation of $\\mathbf{E}$ around each face:\n- Face spanned by $\\mathbf{a}_1$ and $\\mathbf{a}_2$ at $\\mathbf{0}$.\n- Face spanned by $\\mathbf{a}_2$ and $\\mathbf{a}_3$ at $\\mathbf{0}$.\n- Face spanned by $\\mathbf{a}_3$ and $\\mathbf{a}_1$ at $\\mathbf{0}$.\n\nFor each face, compute:\n- The exact circulation by summing exact line integrals along the four oriented edges of the face, where each line integral is computed exactly as $\\int_0^1 \\mathbf{E}_0\\cdot \\mathbf{v}\\ e^{i \\mathbf{k}\\cdot(\\mathbf{r}_s + s \\mathbf{v})}\\ ds$, with edge vector $\\mathbf{v}$ and starting point $\\mathbf{r}_s$.\n- The generalized Yee approximation by replacing each exact line integral with the midpoint approximation $\\mathbf{E}(\\mathbf{r}_s+\\mathbf{v}/2)\\cdot \\mathbf{v}$.\n\nFor each face, define the relative error as the ratio of the magnitude of the difference between the approximate circulation and the exact circulation to the magnitude of the exact circulation. If the magnitude of the exact circulation is smaller than a numerical threshold, normalize by that threshold to avoid division by zero. Report, for a given lattice and plane wave $(\\mathbf{a}_1,\\mathbf{a}_2,\\mathbf{a}_3,\\mathbf{k},\\mathbf{E}_0)$, the maximum of the three face-wise relative errors. Angles are in radians.\n\nProgramming task. Implement a program that:\n1) Constructs the oriented incidence matrix from edges to faces for the single skewed parallelepiped cell described above, and then computes a consistent face-to-cell incidence row such that the product of these incidence arrays is the zero row. Return a boolean indicating whether the Euclidean norm of this product is smaller than $10^{-12}$, thereby numerically verifying the exactness relation $d_2 d_1=0$.\n2) For each of the following test parameter sets, computes the maximum relative error across the three origin-attached faces for the generalized Yee circulation approximation compared with the exact circulation for the plane wave:\n- Test 1 (happy path, moderately skewed, long wavelength): $\\mathbf{a}_1=(1.0,0.0,0.0)$, $\\mathbf{a}_2=(0.3,0.9,0.0)$, $\\mathbf{a}_3=(0.1,0.2,1.1)$, $\\mathbf{k}=(0.2,0.1,0.15)$, $\\mathbf{E}_0=(1.0,0.7,-0.4)$.\n- Test 2 (boundary case near Nyquist along $\\mathbf{a}_1$): $\\mathbf{a}_1=(1.0,0.0,0.0)$, $\\mathbf{a}_2=(0.3,0.9,0.0)$, $\\mathbf{a}_3=(0.1,0.2,1.1)$, $\\mathbf{k}=(\\pi,0.0,0.0)$, $\\mathbf{E}_0=(1.0,0.7,-0.4)$.\n- Test 3 (strongly skewed lattice, moderate wavelength): $\\mathbf{a}_1=(1.0,0.2,0.1)$, $\\mathbf{a}_2=(0.9,1.1,0.3)$, $\\mathbf{a}_3=(0.2,0.4,0.95)$, $\\mathbf{k}=(1.2,-0.8,0.6)$, $\\mathbf{E}_0=(0.4,1.0,0.2)$.\n\nYour program must produce a single line of output containing the results as a comma-separated list enclosed in square brackets: first the boolean exactness verification, followed by the three floating-point relative errors for Tests 1–3, in that order, e.g., \"[True,0.00123,0.4567,0.089]\". The relative errors are dimensionless real numbers.\n\nDeliverables. Your derivation in Part A and Part B must be included in your written solution. Your program must implement the computations exactly as described, with no external input or files, and must adhere to the specified output format. The numerical tolerance for the exactness check must be $10^{-12}$, and use a normalization threshold of $10^{-12}$ when computing relative errors to avoid division by zero in degenerate cases. Angles must be interpreted in radians throughout.",
            "solution": "The problem is evaluated as valid. It is scientifically grounded in computational electromagnetics and Discrete Exterior Calculus (DEC), well-posed, objective, and contains all necessary information for a solution.\n\n### Part A: Derivation of the Exactness Property\n\nThe core of this derivation rests on the fundamental principles of algebraic topology as applied to a cell complex through the framework of Discrete Exterior Calculus (DEC).\n\nLet our computational domain be discretized into a cell complex, which is a collection of oriented k-cells (vertices for $k=0$, edges for $k=1$, faces for $k=2$, volumes for $k=3$). The space of formal linear combinations of $k$-cells is the chain group $C_k$.\n\nThe boundary operator, $\\partial_k: C_k \\rightarrow C_{k-1}$, maps a $k$-chain to its $(k-1)$-dimensional boundary. For an individual $k$-cell $\\sigma_k$, its boundary $\\partial_k \\sigma_k$ is a $(k-1)$-chain consisting of the $(k-1)$-cells on its surface, with orientations induced by the orientation of $\\sigma_k$. A fundamental property of any cell complex is that the boundary of a boundary is empty. This is expressed algebraically as the composition of two successive boundary operators being the zero map:\n$$\n\\partial_{k-1} \\circ \\partial_k = 0 \\quad \\text{for all } k > 0\n$$\nThis is a purely topological statement, independent of any metric or coordinate system.\n\nIn DEC, physical fields are represented by discrete differential forms, or cochains. A $k$-cochain, denoted $\\alpha^k$, is a linear map from the space of $k$-chains to the real or complex numbers, $\\alpha^k: C_k \\rightarrow \\mathbb{C}$. This map represents the integral of the corresponding continuous differential form over a chain. For a $k$-cochain $\\alpha^k$ and a $k$-chain $c_k = \\sum_i a_i \\sigma_k^i$, its action is $\\alpha^k(c_k) = \\sum_i a_i \\int_{\\sigma_k^i} \\omega^k$, where $\\omega^k$ is the continuous $k$-form.\n\nThe discrete exterior derivative, $d_k: C^k \\rightarrow C^{k+1}$, is the operator that maps $k$-cochains to $(k+1)$-cochains. It is defined as the dual (transpose) of the boundary operator $\\partial_{k+1}$. This relationship is encapsulated by the generalized Stokes' theorem for cochains. For any $k$-cochain $\\alpha^k$ and any $(k+1)$-chain $\\sigma_{k+1}$, the action of the $(k+1)$-cochain $d_k \\alpha^k$ on $\\sigma_{k+1}$ is defined as:\n$$\n(d_k \\alpha^k)(\\sigma_{k+1}) := \\alpha^k(\\partial_{k+1} \\sigma_{k+1})\n$$\nThis is the discrete version of Stokes' theorem, $\\int_{\\Omega} d\\omega = \\int_{\\partial\\Omega} \\omega$, where evaluating the cochain on the chain corresponds to integration.\n\nThe problem requires us to show that the discrete divergence of the discrete curl is identically zero.\nIn $3D$ electromagnetism, the electric field is represented as a $1$-cochain $e^1$ (values on primal edges), and the magnetic flux density is represented as a $2$-cochain $b^2$ (values on primal faces).\nThe discrete curl operator maps $1$-cochains to $2$-cochains. This is the discrete exterior derivative $d_1: C^1 \\rightarrow C^2$.\nThe discrete divergence of a flux field (represented by a $2$-cochain) maps $2$-cochains to $3$-cochains (values in primal volumes). This is the discrete exterior derivative $d_2: C^2 \\rightarrow C^3$.\n\nWe must show that the composition $d_2 \\circ d_1$ is the zero map from $C^1$ to $C^3$. Let $e^1$ be an arbitrary $1$-cochain. We want to evaluate the $3$-cochain $d_2(d_1 e^1)$. To do this, we evaluate its action on an arbitrary $3$-cell (volume) $V_3 \\in C_3$.\n\nUsing the definition of the discrete exterior derivative $d_2$:\n$$\n(d_2 (d_1 e^1))(V_3) = (d_1 e^1)(\\partial_3 V_3)\n$$\nHere, $\\partial_3 V_3$ is a $2$-chain, representing the collection of oriented faces that form the boundary of the volume $V_3$.\n\nNext, we apply the definition of the discrete exterior derivative $d_1$ to the $2$-chain $\\partial_3 V_3$:\n$$\n(d_1 e^1)(\\partial_3 V_3) = e^1(\\partial_2 (\\partial_3 V_3))\n$$\nHere, $\\partial_2(\\partial_3 V_3)$ is the $1$-chain representing the boundary of the boundary of the volume $V_3$.\n\nCombining these two steps, we get:\n$$\n(d_2 (d_1 e^1))(V_3) = e^1(\\partial_2 \\circ \\partial_3 (V_3))\n$$\nFrom the fundamental topological identity $\\partial_2 \\circ \\partial_3 = 0$, the argument to the cochain $e^1$ is the zero $1$-chain. Since a cochain is a linear map, its action on the zero chain is zero: $e^1(\\mathbf{0}) = 0$.\n\nSince this holds for any arbitrary $1$-cochain $e^1$ and any arbitrary $3$-cell $V_3$, the operator $d_2 \\circ d_1$ must be the zero operator.\n\nIn terms of matrix representations, if the boundary operator $\\partial_k$ is represented by an incidence matrix $M_k$, then the coboundary operator $d_{k-1}$ is represented by its transpose, $M_k^T$.\n- The discrete curl $d_1: C^1 \\to C^2$ is represented by the matrix $M_2^T$, where $M_2$ is the face-to-edge incidence matrix for $\\partial_2$.\n- The discrete divergence $d_2: C^2 \\to C^3$ is represented by the matrix $M_3^T$, where $M_3$ is the volume-to-face incidence matrix for $\\partial_3$.\n\nThe composition $d_2 \\circ d_1$ is represented by the matrix product $(M_3^T)(M_2^T)$. Using the property $(AB)^T = B^T A^T$, this is equivalent to $(M_2 M_3)^T$. The product $M_2 M_3$ represents the composition of boundary operators $\\partial_2 \\circ \\partial_3$, which is the zero operator. Thus, $M_2 M_3 = 0$ (the zero matrix), and its transpose is also the zero matrix. This confirms $(d_2 \\circ d_1) = 0$. This entire derivation is based on the topological structure of the cell complex and is independent of the geometry (metric) or skewness of the cells.\n\n### Part B: Plane-Wave Comparison for Generalized Yee Curl\n\nWe analyze the circulation of a plane wave $\\mathbf{E}(\\mathbf{x})=\\mathbf{E}_0 e^{i \\mathbf{k}\\cdot \\mathbf{x}}$ around the boundary of a face of a parallelepiped cell. Let the face be defined by an oriented loop of four edges $\\mathbf{v}_1, \\mathbf{v}_2, \\mathbf{v}_3, \\mathbf{v}_4$ with corresponding start points $\\mathbf{r}_{s1}, \\mathbf{r}_{s2}, \\mathbf{r}_{s3}, \\mathbf{r}_{s4}$. The circulation is $\\oint \\mathbf{E} \\cdot d\\mathbf{l} = \\sum_{j=1}^4 \\int_{\\text{edge }j} \\mathbf{E} \\cdot d\\mathbf{l}$.\n\nFor a single edge represented by vector $\\mathbf{v}$ starting at $\\mathbf{r}_s$, the path is $\\mathbf{r}(s) = \\mathbf{r}_s + s\\mathbf{v}$ for $s \\in [0,1]$.\nThe exact line integral is given by:\n$$\n\\int_0^1 \\mathbf{E}(\\mathbf{r}_s + s\\mathbf{v}) \\cdot \\mathbf{v} ds = \\int_0^1 (\\mathbf{E}_0 e^{i \\mathbf{k}\\cdot(\\mathbf{r}_s + s \\mathbf{v})}) \\cdot \\mathbf{v} ds = (\\mathbf{E}_0 \\cdot \\mathbf{v}) e^{i \\mathbf{k}\\cdot \\mathbf{r}_s} \\int_0^1 e^{i (\\mathbf{k} \\cdot \\mathbf{v}) s} ds\n$$\nThe integral term evaluates to:\n$$\nI(\\mathbf{k}, \\mathbf{v}) = \\int_0^1 e^{i (\\mathbf{k} \\cdot \\mathbf{v}) s} ds = \\begin{cases} \\frac{e^{i (\\mathbf{k} \\cdot \\mathbf{v})} - 1}{i (\\mathbf{k} \\cdot \\mathbf{v})} & \\text{if } \\mathbf{k} \\cdot \\mathbf{v} \\neq 0 \\\\ 1 & \\text{if } \\mathbf{k} \\cdot \\mathbf{v} = 0 \\end{cases}\n$$\nSo the exact contribution from one edge is $(\\mathbf{E}_0 \\cdot \\mathbf{v}) e^{i \\mathbf{k}\\cdot \\mathbf{r}_s} I(\\mathbf{k}, \\mathbf{v})$.\n\nThe generalized Yee approximation replaces the integral with a midpoint rule evaluation:\n$$\n\\int_{\\text{edge}} \\mathbf{E} \\cdot d\\mathbf{l} \\approx \\mathbf{E}(\\mathbf{r}_s + \\mathbf{v}/2) \\cdot \\mathbf{v} = (\\mathbf{E}_0 e^{i \\mathbf{k}\\cdot(\\mathbf{r}_s + \\mathbf{v}/2)}) \\cdot \\mathbf{v} = (\\mathbf{E}_0 \\cdot \\mathbf{v}) e^{i \\mathbf{k}\\cdot \\mathbf{r}_s} e^{i (\\mathbf{k} \\cdot \\mathbf{v}) / 2}\n$$\nThe exact circulation for a face, $\\Phi_{\\text{exact}}$, is the sum of the four exact edge contributions. The approximate circulation, $\\Phi_{\\text{approx}}$, is the sum of the four approximate edge contributions.\nThe relative error for one face is computed as:\n$$\n\\epsilon = \\frac{|\\Phi_{\\text{approx}} - \\Phi_{\\text{exact}}|}{ \\max(|\\Phi_{\\text{exact}}|, 10^{-12}) }\n$$\nThe final reported value for each test case is the maximum of the three relative errors computed for the three faces attached to the origin: the face spanned by $(\\mathbf{a}_1, \\mathbf{a}_2)$, the face by $(\\mathbf{a}_2, \\mathbf{a}_3)$, and the face by $(\\mathbf{a}_3, \\mathbf{a}_1)$.\n\nFor the face spanned by $\\mathbf{a}_1$ and $\\mathbf{a}_2$, the oriented boundary is composed of four edges:\n1. $\\mathbf{v} = \\mathbf{a}_1$, $\\mathbf{r}_s = \\mathbf{0}$\n2. $\\mathbf{v} = \\mathbf{a}_2$, $\\mathbf{r}_s = \\mathbf{a}_1$\n3. $\\mathbf{v} = -\\mathbf{a}_1$, $\\mathbf{r}_s = \\mathbf{a}_1+\\mathbf{a}_2$\n4. $\\mathbf{v} = -\\mathbf{a}_2$, $\\mathbf{r}_s = \\mathbf{a}_2$\n\nThe calculations for the other two faces follow this same pattern with cyclically permuted basis vectors.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main solver function to perform the two tasks required by the problem.\n    1. Numerically verify the exactness property d2*d1=0 for a single cell.\n    2. Compute the maximum relative error of the generalized Yee curl approximation for three test cases.\n    \"\"\"\n\n    def verify_exactness():\n        \"\"\"\n        Constructs incidence matrices for a parallelepiped and verifies d2*d1=0.\n        \n        The cell complex for a single parallelepiped has 1 volume, 6 faces, 12 edges.\n        d1 (curl) is the 6x12 edge-to-face coboundary matrix.\n        d2 (div) is the 1x6 face-to-volume coboundary matrix.\n        We verify that the product d2 @ d1 is the zero vector.\n        \n        A standard convention for a cell with outward face normals is used.\n        \"\"\"\n        # d1: Edge-to-face coboundary matrix (curl operator), size 6x12\n        # Edge indices:\n        # a1-dir: [(0,0,0)->(1,0,0)],[(0,1,0)->(1,1,0)],[(0,0,1)->(1,0,1)],[(0,1,1)->(1,1,1)] -> 0,1,2,3\n        # a2-dir: [(0,0,0)->(0,1,0)],[(1,0,0)->(1,1,0)],[(0,0,1)->(0,1,1)],[(1,0,1)->(1,1,1)] -> 4,5,6,7\n        # a3-dir: [(0,0,0)->(0,0,1)],[(1,0,0)->(1,0,1)],[(0,1,0)->(0,1,1)],[(1,1,0)->(1,1,1)] -> 8,9,10,11\n        D1 = np.zeros((6, 12), dtype=np.int8)\n        \n        # Faces are indexed as [x=0, x=1, y=0, y=1, z=0, z=1] faces.\n        # Face normals pointing outward, boundary orientation by right-hand-rule.\n        # Face x=0 (-a^1 normal): Path 000->001->011->010->000. Edges: 8, 6, -10, -4\n        D1[0, [8, 6, 10, 4]] = [1, 1, -1, -1]\n        # Face x=1 (+a^1 normal): Path 100->110->111->101->100. Edges: 5, 11, -7, -9\n        D1[1, [5, 11, 7, 9]] = [1, 1, -1, -1]\n        # Face y=0 (-a^2 normal): Path 000->100->101->001->000. Edges: 0, 9, -2, -8\n        D1[2, [0, 9, 2, 8]] = [1, 1, -1, -1]\n        # Face y=1 (+a^2 normal): Path 010->011->111->110->010. Edges: 10, 3, -11, -1\n        D1[3, [10, 3, 11, 1]] = [1, 1, -1, -1]\n        # Face z=0 (-a^3 normal): Path 000->010->110->100->000. Edges: 4, 1, -5, -0\n        D1[4, [4, 1, 5, 0]] = [1, 1, -1, -1]\n        # Face z=1 (+a^3 normal): Path 001->101->111->011->001. Edges: 2, 7, -3, -6\n        D1[5, [2, 7, 3, 6]] = [1, 1, -1, -1]\n        \n        # d2: Face-to-volume coboundary matrix (divergence operator), size 1x6\n        # With outward pointing face normals, the boundary of the volume is the sum of all faces.\n        D2 = np.ones((1, 6), dtype=np.int8)\n\n        # The composition d2*d1 must be a zero matrix (here, a 1x12 zero vector).\n        product = D2 @ D1\n        norm = np.linalg.norm(product)\n        return norm  1e-12\n\n    def calculate_relative_error(test_case):\n        \"\"\"\n        Calculates the max relative error for a given lattice and plane wave.\n        \"\"\"\n        a1, a2, a3, k, E0 = [np.array(v) for v in test_case]\n        \n        faces = [\n            # Face 1: span a1, a2\n            [(a1, np.array([0,0,0])), (a2, a1), (-a1, a1+a2), (-a2, a2)],\n            # Face 2: span a2, a3\n            [(a2, np.array([0,0,0])), (a3, a2), (-a2, a2+a3), (-a3, a3)],\n            # Face 3: span a3, a1\n            [(a3, np.array([0,0,0])), (a1, a3), (-a3, a3+a1), (-a1, a1)]\n        ]\n        \n        face_errors = []\n        \n        for face_edges in faces:\n            exact_circulation = 0j\n            approx_circulation = 0j\n            \n            for v, rs in face_edges:\n                E0_dot_v = np.dot(E0, v)\n                k_dot_rs = np.dot(k, rs)\n                k_dot_v = np.dot(k, v)\n                \n                exp_k_rs = np.exp(1j * k_dot_rs)\n                \n                # Exact integral term\n                if np.abs(k_dot_v)  1e-9:\n                    # Taylor expansion for (e^{ix}-1)/ix around x=0 is 1 + ix/2 - x^2/6 ...\n                    # We use the first few terms for stability.\n                    x = 1j * k_dot_v\n                    integral_factor = 1 + x/2 + x**2/6 + x**3/24\n                else:\n                    integral_factor = (np.exp(1j * k_dot_v) - 1) / (1j * k_dot_v)\n                \n                exact_circulation += E0_dot_v * exp_k_rs * integral_factor\n                \n                # Approximate (midpoint) term\n                approx_circulation += E0_dot_v * exp_k_rs * np.exp(1j * k_dot_v / 2)\n                \n            error_norm = np.abs(approx_circulation - exact_circulation)\n            exact_norm = np.abs(exact_circulation)\n            \n            relative_error = error_norm / max(exact_norm, 1e-12)\n            face_errors.append(relative_error)\n            \n        return max(face_errors)\n\n    # --- Main Execution ---\n    \n    # Part 1: Exactness Verification\n    is_exact = verify_exactness()\n    \n    results = [is_exact]\n    \n    # Part 2: Relative Error Calculation for Test Cases\n    test_cases = [\n        # Test 1\n        ((1.0, 0.0, 0.0), (0.3, 0.9, 0.0), (0.1, 0.2, 1.1), (0.2, 0.1, 0.15), (1.0, 0.7, -0.4)),\n        # Test 2\n        ((1.0, 0.0, 0.0), (0.3, 0.9, 0.0), (0.1, 0.2, 1.1), (np.pi, 0.0, 0.0), (1.0, 0.7, -0.4)),\n        # Test 3\n        ((1.0, 0.2, 0.1), (0.9, 1.1, 0.3), (0.2, 0.4, 0.95), (1.2, -0.8, 0.6), (0.4, 1.0, 0.2))\n    ]\n    \n    for case in test_cases:\n        error = calculate_relative_error(case)\n        results.append(error)\n        \n    bool_str = str(results[0])\n    float_strs = [f\"{x:.6g}\" for x in results[1:]]\n    \n    print(f\"[{bool_str},{','.join(float_strs)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "The accuracy of any wave propagation simulation is fundamentally limited by numerical dispersion, an artifact where the simulated wave speed depends on the frequency, propagation direction, and grid structure. This exercise moves from acknowledging numerical error to actively managing it by analyzing dispersion on a 2D oblique FDTD lattice . You will first derive the numerical dispersion relation $\\omega(\\mathbf{k}, \\theta)$ and then use it to quantify anisotropy—the directional dependence of phase velocity. This analysis culminates in a practical optimization task: determining the ideal grid angle $\\theta$ that minimizes anisotropy, a key step in designing more accurate and efficient simulations.",
            "id": "3334469",
            "problem": "Consider a two-dimensional Transverse Electric mode ($\\mathrm{TE}_z$) discretized by the staggered Finite-Difference Time-Domain (FDTD) scheme on a uniform oblique lattice. The lattice consists of two basis vectors of equal length $h$ forming a parallelogram cell with angle $\\theta \\in (0,\\pi)$ between the vectors. Let the vacuum wave speed be $c$, and assume the medium is homogeneous, isotropic, and source-free. A plane wave of wavenumber vector $\\mathbf{k}$ has magnitude $|\\mathbf{k}|$ and propagation direction specified by the angle $\\alpha$ measured from the first lattice vector.\n\nStarting from the integral form of Maxwell's equations and the standard Yee staggered update on a parallelogram cell, you must derive the numerical dispersion relation $\\omega(\\mathbf{k},\\theta)$ that relates the discrete angular frequency $\\omega$ to the physical wavenumber $\\mathbf{k}$ and the lattice angle $\\theta$. Your derivation must begin from the fundamental laws and core definitions of electromagnetic theory and geometric relations of the oblique lattice, without assuming any pre-known discrete dispersion formula. Then, using the derived dispersion, implement an algorithm to compute the discrete phase velocity $v_p(\\alpha,\\theta;|\\mathbf{k}|) = \\omega(\\mathbf{k},\\theta)/|\\mathbf{k}|$ across propagation directions $\\alpha \\in [0,2\\pi)$ for a given $|\\mathbf{k}|$ and lattice angle $\\theta$.\n\nDefine an anisotropy measure for fixed $|\\mathbf{k}|$ and $\\theta$ as $A(\\theta;|\\mathbf{k}|) = \\max_{\\alpha} v_p(\\alpha,\\theta;|\\mathbf{k}|) - \\min_{\\alpha} v_p(\\alpha,\\theta;|\\mathbf{k}|)$. Your task is to identify grid angles $\\theta$ that minimize $A(\\theta;|\\mathbf{k}|)$ over the search domain $\\theta \\in [\\pi/6, 5\\pi/6]$ for specified values of $|\\mathbf{k}|$. In all computations, use the Courant time step $\\Delta t = \\lambda h \\cos(\\theta/2)/c$ with Courant factor $\\lambda = 0.9$. Express all angles in radians.\n\nImplement the program to:\n- Evaluate the discrete frequency $\\omega(\\mathbf{k},\\theta)$ for plane waves parametrized by $(|\\mathbf{k}|,\\alpha)$ on the oblique lattice, using a uniform spatial step $h=1$ and wave speed $c=1$.\n- For each candidate lattice angle $\\theta$ in the search domain, sample $\\alpha$ uniformly over $[0,2\\pi)$ and compute $A(\\theta;|\\mathbf{k}|)$.\n- Identify the $\\theta$ that minimizes $A(\\theta;|\\mathbf{k}|)$ for each test case, breaking ties by choosing the smallest $\\theta$.\n\nYour program must solve the following test suite:\n- Test case $1$: $|\\mathbf{k}|h = 0.3$.\n- Test case $2$: $|\\mathbf{k}|h = 1.2$.\n- Test case $3$: $|\\mathbf{k}|h = 2.8$.\n\nIn all cases, take $h=1$ and $c=1$. Angles must be treated in radians. The required final output format is a single line containing a comma-separated list of the minimizing lattice angles $\\theta$ (one for each test case) rounded to six decimal places, enclosed in square brackets, for example, $[\\theta_1,\\theta_2,\\theta_3]$ where each $\\theta_i$ is in radians.",
            "solution": "The problem requires the derivation of the numerical dispersion relation for a two-dimensional Transverse Electric ($\\mathrm{TE}_z$) wave on a uniform oblique Finite-Difference Time-Domain (FDTD) lattice, and then to use this relation to find lattice angles that minimize phase velocity anisotropy.\n\n### 1. Theoretical Derivation of the Numerical Dispersion Relation\n\nThe derivation begins with Maxwell's equations in a source-free, homogeneous, isotropic medium, and proceeds by applying them to a discrete, non-orthogonal grid.\n\n#### 1.1. Maxwell's Equations in Oblique Coordinates\nFor a $\\mathrm{TE}_z$ mode, the electromagnetic fields are $\\mathbf{E} = (E_x, E_y, 0)$ and $\\mathbf{H} = (0, 0, H_z)$. We work in a general 2D oblique coordinate system $(\\xi^1, \\xi^2)$ defined by two basis vectors $\\mathbf{u}_1$ and $\\mathbf{u}_2$ of equal length $h$, with an angle $\\theta$ between them. The position vector is $\\mathbf{r} = \\xi^1 \\mathbf{u}_1 + \\xi^2 \\mathbf{u}_2$. The covariant basis vectors are $\\mathbf{g}_i = \\partial\\mathbf{r}/\\partial\\xi^i$, which are our $\\mathbf{u}_1$ and $\\mathbf{u}_2$. The area of a unit cell is $A = ||\\mathbf{u}_1 \\times \\mathbf{u}_2|| = h^2 \\sin\\theta$.\n\nIn this curvilinear system, for a $\\mathrm{TE}_z$ wave, Maxwell's curl equations can be written in terms of the contravariant components of the electric field ($E^1, E^2$) and the scalar magnetic field $H_z$:\n$$ \\varepsilon \\frac{\\partial E^1}{\\partial t} = \\frac{1}{\\sqrt{g}} \\frac{\\partial H_z}{\\partial \\xi^2} $$\n$$ \\varepsilon \\frac{\\partial E^2}{\\partial t} = -\\frac{1}{\\sqrt{g}} \\frac{\\partial H_z}{\\partial \\xi^1} $$\n$$ \\mu \\frac{\\partial H_z}{\\partial t} = -\\left( \\frac{\\partial E_2}{\\partial \\xi^1} - \\frac{\\partial E_1}{\\partial \\xi^2} \\right) $$\nwhere $\\sqrt{g}=h^2\\sin\\theta$ is the Jacobian determinant, and $E_i$ are the covariant components of the electric field, related to the contravariant components by $E_i = g_{ij} E^j$. The metric tensor components are $g_{ij} = \\mathbf{g}_i \\cdot \\mathbf{g}_j$:\n$g_{11} = h^2$, $g_{22} = h^2$, and $g_{12} = g_{21} = h^2 \\cos\\theta$.\nThus, the covariant field components are:\n$$ E_1 = g_{11}E^1 + g_{12}E^2 = h^2(E^1 + E^2 \\cos\\theta) $$\n$$ E_2 = g_{21}E^1 + g_{22}E^2 = h^2(E^1 \\cos\\theta + E^2) $$\n\n#### 1.2. FDTD Discretization and Plane Wave Analysis\nWe use a staggered grid where $H_z$ is located at integer indices in time $n$ and half-integer indices in space $(i+1/2, j+1/2)$, while $E^1$ is at $(i+1/2, j, n+1/2)$ and $E^2$ is at $(i, j+1/2, n+1/2)$. We analyze the behavior of a discrete plane wave of the form $F(i,j,n) = F_0 e^{j(\\omega n \\Delta t - \\mathbf{k} \\cdot \\mathbf{r}_{ij})}$, where $\\mathbf{r}_{ij} = i h \\mathbf{\\hat{e}}_1 + j h \\mathbf{\\hat{e}}_2$ (with $h$ being the length of a discrete step along a basis vector, not the vector itself). The propagation vector is $\\mathbf{k}$.\nLet $\\tilde{k}_1 = \\mathbf{k} \\cdot \\mathbf{u}_1$ and $\\tilde{k}_2 = \\mathbf{k} \\cdot \\mathbf{u}_2$.\nWith $\\mathbf{u}_1 = (h, 0)$ and $\\mathbf{u}_2 = (h\\cos\\theta, h\\sin\\theta)$, and $\\mathbf{k} = |\\mathbf{k}|(\\cos\\alpha, \\sin\\alpha)$, we have:\n$$ \\tilde{k}_1 = |\\mathbf{k}|h \\cos\\alpha $$\n$$ \\tilde{k}_2 = |\\mathbf{k}|h (\\cos\\alpha \\cos\\theta + \\sin\\alpha \\sin\\theta) = |\\mathbf{k}|h \\cos(\\alpha-\\theta) $$\n\nUnder the plane-wave assumption, the centered finite-difference operators become algebraic multipliers in the Fourier domain:\n$$ \\frac{\\partial}{\\partial t} \\rightarrow \\frac{2j}{\\Delta t} \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) $$\n$$ \\frac{\\partial}{\\partial \\xi^1} \\rightarrow \\frac{2j}{\\Delta \\xi^1} \\sin\\left(\\frac{\\tilde{k}_1}{2}\\right) = 2j \\sin\\left(\\frac{\\tilde{k}_1}{2}\\right) \\quad (\\text{since } \\Delta\\xi^1 = 1) $$\n$$ \\frac{\\partial}{\\partial \\xi^2} \\rightarrow \\frac{2j}{\\Delta \\xi^2} \\sin\\left(\\frac{\\tilde{k}_2}{2}\\right) = 2j \\sin\\left(\\frac{\\tilde{k}_2}{2}\\right) \\quad (\\text{since } \\Delta\\xi^2 = 1) $$\n\n#### 1.3. Derivation of the Dispersion Relation\nSubstituting these operators into Maxwell's equations yields a system of algebraic equations for the field amplitudes $(E^1_0, E^2_0, H_{z0})$:\n$$ \\varepsilon \\left(\\frac{2j}{\\Delta t}\\sin\\frac{\\omega\\Delta t}{2}\\right) E^1_0 = \\frac{1}{h^2\\sin\\theta} \\left(2j\\sin\\frac{\\tilde{k}_2}{2}\\right) H_{z0} $$\n$$ \\varepsilon \\left(\\frac{2j}{\\Delta t}\\sin\\frac{\\omega\\Delta t}{2}\\right) E^2_0 = -\\frac{1}{h^2\\sin\\theta} \\left(2j\\sin\\frac{\\tilde{k}_1}{2}\\right) H_{z0} $$\n$$ \\mu \\left(\\frac{2j}{\\Delta t}\\sin\\frac{\\omega\\Delta t}{2}\\right) H_{z0} = -\\left[ \\left(2j\\sin\\frac{\\tilde{k}_1}{2}\\right)E_{2_0} - \\left(2j\\sin\\frac{\\tilde{k}_2}{2}\\right)E_{1_0} \\right] $$\nFrom the first two equations, we solve for $E^1_0$ and $E^2_0$ in terms of $H_{z0}$:\n$$ E^1_0 = \\frac{\\Delta t}{\\varepsilon h^2 \\sin\\theta} \\frac{\\sin(\\tilde{k}_2/2)}{\\sin(\\omega\\Delta t/2)} H_{z0} $$\n$$ E^2_0 = -\\frac{\\Delta t}{\\varepsilon h^2 \\sin\\theta} \\frac{\\sin(\\tilde{k}_1/2)}{\\sin(\\omega\\Delta t/2)} H_{z0} $$\nSubstitute these into the expressions for the covariant components:\n$$ E_{1_0} = h^2(E^1_0 + E^2_0 \\cos\\theta) = \\frac{\\Delta t}{\\varepsilon \\sin\\theta} \\frac{H_{z0}}{\\sin(\\omega\\Delta t/2)} \\left(\\sin\\frac{\\tilde{k}_2}{2} - \\cos\\theta \\sin\\frac{\\tilde{k}_1}{2}\\right) $$\n$$ E_{2_0} = h^2(E^1_0 \\cos\\theta + E^2_0) = \\frac{\\Delta t}{\\varepsilon \\sin\\theta} \\frac{H_{z0}}{\\sin(\\omega\\Delta t/2)} \\left(\\cos\\theta \\sin\\frac{\\tilde{k}_2}{2} - \\sin\\frac{\\tilde{k}_1}{2}\\right) $$\nNow, substitute $E_{1_0}$ and $E_{2_0}$ into the third (Faraday's) equation:\n$$ \\frac{\\mu}{\\Delta t}\\sin\\frac{\\omega\\Delta t}{2} H_z = \\sin\\frac{\\tilde{k}_2}{2}E_{1_0} - \\sin\\frac{\\tilde{k}_1}{2}E_{2_0} $$\nDividing by $H_{z0}$ and substituting the expressions for $E_{1_0}$ and $E_{2_0}$ gives:\n$$ \\frac{\\mu}{\\Delta t}\\sin\\frac{\\omega\\Delta t}{2} = \\frac{\\Delta t}{\\varepsilon \\sin\\theta \\sin(\\omega\\Delta t/2)} \\left[ \\sin\\frac{\\tilde{k}_2}{2}\\left(\\sin\\frac{\\tilde{k}_2}{2} - \\cos\\theta \\sin\\frac{\\tilde{k}_1}{2}\\right) - \\sin\\frac{\\tilde{k}_1}{2}\\left(\\cos\\theta \\sin\\frac{\\tilde{k}_2}{2} - \\sin\\frac{\\tilde{k}_1}{2}\\right) \\right] $$\nLetting $c = 1/\\sqrt{\\varepsilon\\mu}$ and simplifying:\n$$ \\frac{\\sin^2(\\omega\\Delta t/2)}{c^2\\Delta t^2} = \\frac{1}{h^2 \\sin^2\\theta} \\left[ \\sin^2\\frac{\\tilde{k}_1}{2} + \\sin^2\\frac{\\tilde{k}_2}{2} - 2\\cos\\theta \\sin\\frac{\\tilde{k}_1}{2} \\sin\\frac{\\tilde{k}_2}{2} \\right] $$\nThis is the numerical dispersion relation for the oblique FDTD grid.\n\n#### 1.4. Phase Velocity, Anisotropy, and Numerical Implementation\nFrom the dispersion relation, we can solve for the numerical angular frequency $\\omega$:\n$$ \\omega(\\mathbf{k}, \\theta) = \\frac{2}{\\Delta t} \\arcsin\\left( \\frac{c\\Delta t}{h \\sin\\theta} \\sqrt{ \\sin^2\\frac{\\tilde{k}_1}{2} + \\sin^2\\frac{\\tilde{k}_2}{2} - 2\\cos\\theta \\sin\\frac{\\tilde{k}_1}{2} \\sin\\frac{\\tilde{k}_2}{2} } \\right) $$\nThe numerical phase velocity is $v_p(\\alpha, \\theta; |\\mathbf{k}|) = \\omega/|\\mathbf{k}|$. The given time step is $\\Delta t = \\lambda h \\cos(\\theta/2)/c$, with $\\lambda = 0.9$. This choice respects the Courant-Friedrichs-Lewy (CFL) stability condition for this scheme, ensuring the argument of $\\arcsin$ is always less than or equal to $\\lambda$, thus preventing numerical instability.\n\nThe anisotropy measure is $A(\\theta; |\\mathbf{k}|) = \\max_{\\alpha} v_p - \\min_{\\alpha} v_p$ for a fixed $|\\mathbf{k}|$ and $\\theta$. We seek to find a $\\theta$ that minimizes $A(\\theta; |\\mathbf{k}|)$. Due to the geometric symmetry of the lattice, the anisotropy function has the property $A(\\theta) = A(\\pi-\\theta)$. The problem asks to break ties by choosing the smallest $\\theta$. This can be accomplished by restricting the search domain for the minimization to $\\theta \\in [\\pi/6, \\pi/2]$. Any minimum found in $(\\pi/2, 5\\pi/6]$ will have a corresponding, smaller conjugate counterpart at $\\pi-\\theta$ in the restricted domain.\n\nThe numerical task is to implement a function for $A(\\theta; |\\mathbf{k}|)$ by sampling $v_p$ over a grid of propagation angles $\\alpha \\in [0, 2\\pi)$. Then, for each given $|\\mathbf{k}|h$, we use a numerical optimizer (`scipy.optimize.minimize_scalar`) to find the $\\theta$ in $[\\pi/6, \\pi/2]$ that minimizes this function.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize_scalar\n\ndef solve():\n    \"\"\"\n    Solves for the optimal FDTD oblique lattice angle to minimize phase velocity\n    anisotropy for given normalized wavenumbers.\n    \"\"\"\n    # Test cases for |k|h, where h=1, so this is |k|\n    test_cases = [0.3, 1.2, 2.8]\n    \n    # Constants from the problem statement\n    h = 1.0\n    c = 1.0\n    courant_factor_lambda = 0.9\n    \n    # Numerical parameters for the optimization\n    # Number of angles to sample for finding max/min phase velocity\n    N_ALPHA_SAMPLES = 2000\n    # Tolerance for the theta minimization routine\n    THETA_TOLERANCE = 1e-9\n\n    def get_phase_velocity(alpha: np.ndarray, theta: float, k_mag: float) -> np.ndarray:\n        \"\"\"\n        Calculates the numerical phase velocity for a plane wave on the oblique grid.\n\n        Args:\n            alpha: Array of propagation angles relative to the first lattice vector.\n            theta: The angle of the parallelogram grid cell.\n            k_mag: The magnitude of the wavenumber (|k| * h).\n\n        Returns:\n            An array of phase velocities corresponding to each alpha.\n        \"\"\"\n        # Time step depends on theta\n        delta_t = courant_factor_lambda * h * np.cos(theta / 2.0) / c\n\n        # Discrete wavenumbers along the grid axes u1 and u2\n        k1_tilde = k_mag * np.cos(alpha)\n        k2_tilde = k_mag * np.cos(alpha - theta)\n\n        # Intermediate terms for the dispersion relation\n        term1 = np.sin(k1_tilde / 2.0)\n        term2 = np.sin(k2_tilde / 2.0)\n\n        # The term inside the square root of the dispersion relation\n        S_sqrt = np.sqrt(term1**2 + term2**2 - 2 * np.cos(theta) * term1 * term2)\n\n        # Argument of the arcsin. A simplified expression is used for better\n        # numerical stability and efficiency.\n        # Original: arg = (c * delta_t / (h * np.sin(theta))) * S_sqrt\n        # Simplified:\n        arg = (courant_factor_lambda / (2.0 * np.sin(theta / 2.0))) * S_sqrt\n        \n        # Clamp argument to [-1, 1] to prevent domain errors from floating point noise\n        arg = np.clip(arg, -1.0, 1.0)\n\n        # Numerical angular frequency\n        omega = (2.0 / delta_t) * np.arcsin(arg)\n\n        # Numerical phase velocity (omega / |k|); since h=1, k_mag = |k|\n        v_p = omega / k_mag\n        \n        return v_p\n\n    def get_anisotropy(theta: float, k_mag: float) -> float:\n        \"\"\"\n        Calculates the phase velocity anisotropy for a given grid angle theta\n        and wavenumber magnitude k_mag.\n\n        Args:\n            theta: The angle of the parallelogram grid cell.\n            k_mag: The magnitude of the wavenumber.\n\n        Returns:\n            The anisotropy measure A = max(v_p) - min(v_p).\n        \"\"\"\n        if theta  np.pi/6 or theta > 5*np.pi/6:\n            return np.inf\n\n        # Sample propagation directions uniformly\n        alphas = np.linspace(0, 2 * np.pi, N_ALPHA_SAMPLES, endpoint=False)\n        \n        v_p_values = get_phase_velocity(alphas, theta, k_mag)\n        \n        # Check for any numerical errors\n        if np.isnan(v_p_values).any():\n            return np.inf\n            \n        anisotropy = np.max(v_p_values) - np.min(v_p_values)\n        return anisotropy\n\n    optimal_thetas = []\n    \n    # Due to symmetry A(theta) = A(pi - theta), we search in [pi/6, pi/2]\n    # to satisfy the tie-breaking rule of choosing the smallest theta.\n    search_bounds = (np.pi / 6.0, np.pi / 2.0)\n\n    for k_mag_h in test_cases:\n        # Define the objective function for the optimizer\n        objective_func = lambda theta: get_anisotropy(theta, k_mag_h)\n\n        # Use a bounded scalar minimizer to find the optimal theta\n        result = minimize_scalar(\n            objective_func,\n            bounds=search_bounds,\n            method='bounded',\n            options={'xatol': THETA_TOLERANCE}\n        )\n        \n        # If the minimum is found at the boundary pi/2, we check the other half of the domain\n        # to ensure it's not a local minimum due to symmetry.\n        # But since A(pi/2-e) = A(pi/2+e), a minimum at pi/2 is a true local min.\n        # So, the search in the first half is sufficient.\n        optimal_thetas.append(result.x)\n\n    # Format and print the final result as per problem specification\n    print(f\"[{','.join([f'{th:.6f}' for th in optimal_thetas])}]\")\n\nsolve()\n```"
        }
    ]
}