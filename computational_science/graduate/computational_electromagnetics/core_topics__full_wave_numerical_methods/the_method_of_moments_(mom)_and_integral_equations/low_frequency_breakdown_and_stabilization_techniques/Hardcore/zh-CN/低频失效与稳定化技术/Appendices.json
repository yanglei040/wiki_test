{
    "hands_on_practices": [
        {
            "introduction": "稳健的数值方法植根于对基本物理定律的严格遵守。本练习将引导你从第一性原理出发，推导在低频极限下必须强制执行的积分约束，例如闭合导体上的电荷中性，以及跨越多连通区域非收缩回路的磁通量守恒。通过这项练习，你将学会如何将这些物理约束转化为离散系统中的可计算量，并将其用作诊断低频不稳定性的有力工具 。",
            "id": "3326572",
            "problem": "考虑一个用于自由空间中理想电导体 (PEC) 物体散射问题的频域电场积分方程 (EFIE) 离散化。PEC 表面是闭合的，且可能为多连通。假设有 $M$ 个连通分量，对于分量 $m$，其亏格为 $g_m$，总共有 $g=\\sum_{m=1}^M g_m$ 个独立的环柄圈。表面被三角剖分，并使用 Rao–Wilton–Glisson (RWG) 基函数对切向表面电流密度 $\\mathbf{J}_t(\\mathbf{r})$ 进行离散化，从而产生一个系数向量 $\\mathbf{j} \\in \\mathbb{C}^N$。假设使用脉冲基来表示表面电荷密度 $\\rho_s(\\mathbf{r})$。假设时谐依赖关系为 $e^{\\mathrm{i} \\omega t}$，其中角频率 $\\omega>0$。\n\n从基本的时谐麦克斯韦方程组和边界条件出发，在外部介质中没有外加电荷或传导的情况下：磁高斯定律 $\\nabla \\cdot \\mathbf{B} = 0$、法拉第定律 $\\nabla \\times \\mathbf{E} = -\\mathrm{i}\\omega \\mathbf{B}$，以及连接表面电荷和表面电流的表面连续性方程 $\\mathrm{i}\\omega \\rho_s + \\nabla_s \\cdot \\mathbf{J}_t = 0$，同时还有表面上的 PEC 边界条件 $\\mathbf{n} \\times \\mathbf{E} = \\mathbf{0}$，其中 $\\nabla_s \\cdot (\\cdot)$ 是表面散度，$\\mathbf{n}$ 是向外单位法向量。磁矢量势由 $\\mathbf{B}=\\nabla \\times \\mathbf{A}$ 定义。\n\n你的任务是 (i) 计算并施加积分约束，以保证在低频下物理行为的正确性，以及 (ii) 使用这些相同的积分约束作为诊断工具，以检测数值解中残余的低频不稳定性。具体而言，你必须确保 (a) 每个闭合 PEC 分量上的净表面电荷为零，以及 (b) 围绕每个不可收缩表面回路的磁通量守恒，且与 PEC 边界条件一致。离散表面散度算子 $D \\in \\mathbb{R}^{P \\times N}$ 将 RWG 电流系数映射为 $\\nabla_s \\cdot \\mathbf{J}_t$ 的脉冲系数，并设 $\\mathbf{c}_m \\in \\mathbb{R}^P$ 是对第 m 个表面分量上的脉冲系数求和的选择器。\n\n从第一性原理出发，下列哪种方法对于计算和施加积分约束，并将其用作残余低频崩溃的诊断工具是正确的？请选择最佳选项。\n\nA. 根据表面连续性方程计算离散表面电荷向量为 $\\mathbf{q} = \\frac{1}{\\mathrm{i}\\omega} D \\mathbf{j}$。通过为每个分量 $m$ 增加一个拉格朗日乘子来施加 $\\mathbf{c}_m^{\\mathsf{T}} \\mathbf{q} = 0$ 的约束，从而在每个闭合分量上强制实现零净电荷。对于磁通量，在 PEC 上选择一组由 $g$ 个非边界表面回路组成的基 $\\{\\gamma_k\\}_{k=1}^g$，每个回路在外部区域都有一个辅助的张成曲面 $\\Sigma_k$，并计算由 $\\mathbf{j}$ 感应的散射磁通量为 $\\Phi_s^{(k)} = \\int_{\\Sigma_k} \\mathbf{B}_s[\\mathbf{j}] \\cdot \\mathbf{n}\\, \\mathrm{d}S = \\oint_{\\gamma_k} \\mathbf{A}_s[\\mathbf{j}] \\cdot \\mathrm{d}\\boldsymbol{\\ell}$。通过添加 $g$ 个约束 $\\Phi_s^{(k)} + \\Phi_{\\mathrm{inc}}^{(k)} = 0$ 来施加法拉第定律和 PEC 条件，其中 $\\Phi_{\\mathrm{inc}}^{(k)} = \\int_{\\Sigma_k} \\mathbf{B}_{\\mathrm{inc}} \\cdot \\mathbf{n}\\, \\mathrm{d}S = \\oint_{\\gamma_k} \\mathbf{A}_{\\mathrm{inc}} \\cdot \\mathrm{d}\\boldsymbol{\\ell}$。求解后，通过检查归一化残差 $\\left|\\mathbf{c}_m^{\\mathsf{T}} \\mathbf{q}\\right|/\\|\\mathbf{q}\\|_1$ 和 $\\left|\\Phi_s^{(k)} + \\Phi_{\\mathrm{inc}}^{(k)}\\right|/\\left|\\Phi_{\\mathrm{inc}}^{(k)}\\right|$，将这些相同的量用作诊断工具；一个稳定的低频公式产生的残差会保持有界，并在 $\\omega \\to 0$ 时通常接近机器精度，而残差的增长或出现 $\\mathcal{O}(1)$ 的平台则表明存在残余的低频不稳定性。\n\nB. 在每个分量 $S_m$ 上施加零净电流而非零净电荷的约束 $\\int_{S_m} \\mathbf{J}_t \\cdot \\mathbf{n}\\, \\mathrm{d}S = 0$，并指出这意味着电荷中性。对于磁通量，计算并通过约束使穿过每个环柄张成曲面的电位移通量 $\\int_{\\Sigma_k} \\epsilon \\mathbf{E} \\cdot \\mathbf{n}\\, \\mathrm{d}S$ 为零，因为该量在 PEC 上是守恒的。使用这些约束的残差作为诊断工具。\n\nC. 将电流分解为环路分量和星形分量，并通过在每个分量上强制环路分量的均值为零来间接实现电荷中性。对于磁行为，通过在包围散射体的任何闭合曲面 $\\partial \\Omega$ 上施加约束 $\\int_{\\partial \\Omega} \\mathbf{B}\\cdot \\mathbf{n}\\, \\mathrm{d}S = 0$ 来使用磁高斯定律；这强制了磁通量守恒。诊断检查应计算一个固定边界曲面上的 $\\int_{\\partial \\Omega} \\mathbf{B}\\cdot \\mathbf{n}\\, \\mathrm{d}S$ 的残差，并确保其在数值上很小。\n\nD. 计算离散表面电荷为 $\\mathbf{q} = D \\mathbf{j}$，并通过将 $\\mathbf{j}$ 投影到 $D$ 的零空间来强制实现电中性，从而使得在所有频率下 $\\mathbf{q}=\\mathbf{0}$ 恒成立。对于磁通量，在每个环柄回路上施加 $\\oint_{\\gamma_k} \\mathbf{H}\\cdot \\mathrm{d}\\boldsymbol{\\ell} = 0$，因为自由空间中没有传导电流流动；对于此约束，可以忽略入射场。使用范数 $\\|\\mathbf{q}\\|_2$ 和 $\\sum_k \\left|\\oint_{\\gamma_k} \\mathbf{H}\\cdot \\mathrm{d}\\boldsymbol{\\ell}\\right|$ 作为稳定性的诊断工具。\n\n你的答案必须仅基于所列出的基本定律，并应反映在低频下，哪些物理量在闭合 PEC 上是物理守恒或受约束的，它们如何在离散设定中产生，以及它们的残差如何揭示低频崩溃行为。",
            "solution": "问题陈述描述了计算电磁学中的一个典型问题：常规频域电场积分方程 (EFIE) 的低频崩溃。这种崩溃的发生是因为当频率 $\\omega$ 趋近于零时，积分算子变得病态，导致数值解不稳定且物理上不正确。一个稳定的公式需要显式地施加物理约束，这些约束在较高频率下是隐式满足的，但在低频极限下会因数值误差而被破坏。两个主要约束涉及电荷中性和磁通量守恒。\n\n我们将从给定的基本定律推导出这些约束。\n\n**1. 电荷约束**\n\n表面电荷密度 $\\rho_s$ 和表面电流密度 $\\mathbf{J}_t$ 之间的关系由表面连续性方程决定：\n$$ \\mathrm{i}\\omega \\rho_s + \\nabla_s \\cdot \\mathbf{J}_t = 0 $$\n这个方程必须在导体表面的每一点上都成立。为了找到单个、孤立的闭合导电分量 $S_m$ 的全局约束，我们将连续性方程在其整个表面积上积分：\n$$ \\int_{S_m} (\\mathrm{i}\\omega \\rho_s + \\nabla_s \\cdot \\mathbf{J}_t) \\, \\mathrm{d}S = 0 $$\n根据积分的线性性质，这变为：\n$$ \\mathrm{i}\\omega \\int_{S_m} \\rho_s \\, \\mathrm{d}S + \\int_{S_m} \\nabla_s \\cdot \\mathbf{J}_t \\, \\mathrm{d}S = 0 $$\n第二项，即表面散度在一个闭合曲面（没有边界的曲面）上的积分，根据表面散度定理恒等于零。这剩下：\n$$ \\mathrm{i}\\omega \\int_{S_m} \\rho_s \\, \\mathrm{d}S = 0 $$\n鉴于问题考虑的是 $\\omega > 0$ 的非静态情况，该方程强制要求每个孤立分量上的总电荷必须为零：\n$$ Q_m = \\int_{S_m} \\rho_s \\, \\mathrm{d}S = 0 $$\n在离散公式中，电流 $\\mathbf{j}$ 的系数通过算子 $D$ 映射到表面散度 $\\nabla_s \\cdot \\mathbf{J}_t$ 的系数。电荷密度 $\\rho_s$ 的系数包含在向量 $\\mathbf{q}$ 中。根据连续性方程，$\\mathrm{i}\\omega \\mathbf{q}$ 对应于 $-\\nabla_s \\cdot \\mathbf{J}_t$ 的系数。问题定义的离散关系使得 $\\nabla_s \\cdot \\mathbf{J}_t$ 的系数为 $D\\mathbf{j}$，从而得出电荷系数 $\\mathbf{q} = \\frac{1}{\\mathrm{i}\\omega} D \\mathbf{j}$。在分量 $m$ 上的积分由选择器向量 $\\mathbf{c}_m$ 的作用表示，因此离散约束为 $\\mathbf{c}_m^{\\mathsf{T}}\\mathbf{q} = 0$。这是对未知系数 $\\mathbf{j}$ 的一个线性约束。\n\n**2. 磁通量约束**\n\n此约束适用于多连通几何体（例如，环面），其亏格 $g \\geq 1$。这种几何体在其表面上拥有不可收缩的回路，或称环柄圈。设 $\\gamma_k$ 是这样一个回路，并设 $\\Sigma_k$ 是外部区域中一个以该回路为边界的任意开放曲面，即 $\\partial \\Sigma_k = \\gamma_k$。\n\n我们从法拉第感应定律开始：$\\nabla \\times \\mathbf{E} = -\\mathrm{i}\\omega \\mathbf{B}$。我们将此方程在曲面 $\\Sigma_k$ 上积分，并对左侧应用斯托克斯定理：\n$$ \\oint_{\\partial \\Sigma_k} \\mathbf{E} \\cdot \\mathrm{d}\\boldsymbol{\\ell} = \\int_{\\Sigma_k} (\\nabla \\times \\mathbf{E}) \\cdot \\mathbf{n}\\, \\mathrm{d}S = \\int_{\\Sigma_k} -\\mathrm{i}\\omega \\mathbf{B} \\cdot \\mathbf{n}\\, \\mathrm{d}S $$\n左侧的积分路径是回路 $\\gamma_k$。PEC 边界条件 $\\mathbf{n} \\times \\mathbf{E} = \\mathbf{0}$ 规定了在导体表面的任何地方，总电场 $\\mathbf{E}$ 的切向分量均为零。由于 $\\gamma_k$ 是表面上的一条路径，微分路径元 $\\mathrm{d}\\boldsymbol{\\ell}$ 始终是一个切向向量。因此，被积函数 $\\mathbf{E} \\cdot \\mathrm{d}\\boldsymbol{\\ell}$ 在 $\\gamma_k$ 上的所有点都为零，使得线积分为零：\n$$ \\oint_{\\gamma_k} \\mathbf{E} \\cdot \\mathrm{d}\\boldsymbol{\\ell} = 0 $$\n这也迫使方程的右侧为零。由于 $\\omega > 0$，穿过曲面 $\\Sigma_k$ 的总磁通量 $\\Phi^{(k)}$ 必须为零：\n$$ \\Phi^{(k)} = \\int_{\\Sigma_k} \\mathbf{B} \\cdot \\mathbf{n}\\, \\mathrm{d}S = 0 $$\n总磁场 $\\mathbf{B}$ 是入射场 $\\mathbf{B}_{\\mathrm{inc}}$ 和散射场 $\\mathbf{B}_s$ 的叠加。散射场是由感应电流 $\\mathbf{J}_t$ 产生的。因此约束变为：\n$$ \\Phi_{\\mathrm{inc}}^{(k)} + \\Phi_s^{(k)} = 0 \\quad \\text{或} \\quad \\Phi_s^{(k)}[\\mathbf{j}] = -\\Phi_{\\mathrm{inc}}^{(k)} $$\n这意味着散射磁通量必须精确抵消穿过环柄的入射磁通量。这为电流系数 $\\mathbf{j}$ 提供了一组 $g$ 个线性约束。使用磁矢量势 $\\mathbf{A}$ ($\\mathbf{B} = \\nabla \\times \\mathbf{A}$)，通量也可以通过斯托克斯定理计算为 $\\Phi^{(k)} = \\oint_{\\gamma_k} \\mathbf{A} \\cdot \\mathrm{d}\\boldsymbol{\\ell}$。\n\n**3. 诊断用途**\n如果在没有显式施加这两组约束的情况下获得了 $\\mathbf{j}$ 的数值解，可以通过计算残差来评估其物理正确性。对于分量 $m$ 上的电荷约束，计算 $|\\mathbf{c}_m^{\\mathsf{T}}\\mathbf{q}|$。对于环柄 $k$ 上的通量约束，计算 $|\\Phi_s^{(k)} + \\Phi_{\\mathrm{inc}}^{(k)}|$。对于一个稳定的公式，这些残差在适当归一化后，当 $\\omega \\to 0$ 时应接近机器精度。对于不稳定的解，它们将保持较大值，表明数值方法的失败。\n\n**逐项分析**\n\nA. 该选项从第一性原理正确地识别了电荷和磁通量约束。它正确地将离散电荷约束表述为 $\\mathbf{c}_m^{\\mathsf{T}} \\mathbf{q} = 0$，其中 $\\mathbf{q}$ 由连续性方程导出。它正确地将磁通量约束表述为 $\\Phi_s^{(k)} + \\Phi_{\\mathrm{inc}}^{(k)} = 0$，该约束由法拉第定律和 PEC 条件导出。它还正确地提议使用这些约束的残差作为低频稳定性的诊断工具，并准确描述了预期行为。这个过程是完全正确的。\n**结论：正确**\n\nB. 该选项不正确。提议的电荷约束 $\\int_{S_m} \\mathbf{J}_t \\cdot \\mathbf{n}\\, \\mathrm{d}S = 0$ 是一个平凡的恒等式，因为根据定义，切向电流 $\\mathbf{J}_t$ 与法向量 $\\mathbf{n}$ 正交。它没有施加任何约束。提议的关于穿过环柄的电位移通量的通量约束在物理上是没有根据的；相关的定律涉及磁通量。\n**结论：不正确**\n\nC. 该选项不正确。虽然环路-星形分解是一个有效的概念，但该选项错误地应用了它，建议对“环路分量的均值”施加约束以实现电荷中性；电荷与电流的非螺线（星形）部分有关。提议的基于磁高斯定律（在闭合曲面上 $\\int \\mathbf{B}\\cdot \\mathbf{n}\\, \\mathrm{d}S = 0$）的磁约束，对于任何磁场都是一个普适的恒等式，未能施加在低频下对 PEC 所需的特定条件，该条件是从开放曲面上的法拉第定律推导出来的。\n**结论：不正确**\n\nD. 该选项不正确。对于电荷部分，它从连续性方程中省略了因子 $1/(\\mathrm{i}\\omega)$，并提出了一个过于严格的约束 $\\rho_s = 0$ 在所有地方都成立，这在物理上是错误的，因为它禁止了电荷分离。对于通量部分，它错误地提议约束 $\\oint_{\\gamma_k} \\mathbf{H}\\cdot \\mathrm{d}\\boldsymbol{\\ell}$，这与安培定律有关，而与法拉第定律无关。正确的约束涉及 $\\mathbf{E}$ 的线积分。它还错误地声称可以忽略入射场。\n**结论：不正确**\n\n从第一性原理出发，唯一正确的过程在选项 A 中描述。",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "在了解了需要强制执行的物理约束之后，我们来深入分析一种具体的实现方法及其效果。本练习聚焦于通过拉格朗日乘子法强制施加全局电荷中性约束，并分析此举对电场积分方程 (EFIE) 系统矩阵在低频下的零空间和条件数的影响。这项实践将揭示一个关键点：虽然这种增强可以修正静态极限下的秩亏问题，但它本身并不足以解决由算子尺度不平衡引起的核心病态问题 。",
            "id": "3326560",
            "problem": "考虑一个为求解频域电场积分方程 (EFIE) 而离散化的闭合理想电导体 (PEC) 表面。感应表面电流密度用 Rao-Wilton-Glisson (RWG) 基函数展开，得到的未知展开系数汇集在向量 $\\mathbf{c} \\in \\mathbb{C}^{N_{\\mathrm{RWG}}}$ 中，其中 $N_{\\mathrm{RWG}}$ 是内部网格边的数量。设网格有 $N_{\\Delta}$ 个三角形，其面积为 $\\{A_{t}\\}_{t=1}^{N_{\\Delta}}$，并将表面电荷密度定义为分片常数表示 $\\boldsymbol{\\rho} \\in \\mathbb{C}^{N_{\\Delta}}$，其分量为每个三角形上的值 $\\rho_{t}$。\n\nEFIE 由麦克斯韦方程组（即旋度方程 $\\nabla \\times \\mathbf{H} = \\mathbf{J} + j \\omega \\epsilon \\mathbf{E}$ 和 $\\nabla \\times \\mathbf{E} = - j \\omega \\mu \\mathbf{H}$）以及表面上的 PEC 边界条件 $\\hat{\\mathbf{n}} \\times \\mathbf{E}_{\\mathrm{tot}} = \\mathbf{0}$ 构建。EFIE 算子包含两个在低频下具有不同标度律的项：矢量势项的贡献量级为 $j \\omega \\mu$，标量势项的贡献量级为 $1/(j \\omega \\epsilon)$；等效地，当 $k = \\omega \\sqrt{\\mu \\epsilon}$ 时，它们分别按 $\\mathcal{O}(k)$ 和 $\\mathcal{O}(1/k)$ 的标度变化。\n\n离散化后得到形如\n$$\n\\mathbf{Z}(k)\\, \\mathbf{c} = \\mathbf{v}(k),\n$$\n的线性系统，其中 $\\mathbf{Z}(k) = k\\, \\mathbf{Z}_{\\mathrm{V}} + \\frac{1}{k}\\, \\mathbf{Z}_{\\mathrm{S}}$，$\\mathbf{Z}_{\\mathrm{V}}$ 和 $\\mathbf{Z}_{\\mathrm{S}}$ 与 k 无关，分别反映了矢量势和标量势的贡献。离散连续性方程由电荷守恒 $\\nabla \\cdot \\mathbf{J} = - j \\omega \\rho$ 导出，其形式为\n$$\n\\mathbf{D}\\, \\mathbf{c} = - j \\omega\\, \\boldsymbol{\\rho},\n$$\n其中 $\\mathbf{D} \\in \\mathbb{R}^{N_{\\Delta} \\times N_{\\mathrm{RWG}}}$ 是一个固定的散度矩阵。\n\n对于一个没有外加传导路径的闭合 PEC，必须满足全局电荷中性条件：\n$$\n\\sum_{t=1}^{N_{\\Delta}} \\rho_{t}\\, A_{t} = 0.\n$$\n引入面积加权向量 $\\mathbf{a} \\in \\mathbb{R}^{N_{\\Delta}}$（其分量为 $a_{t} = A_{t}$），并通过引入拉格朗日乘子 $\\lambda \\in \\mathbb{C}$ 来对 EFIE 进行增广，以在离散系统中强制实现电荷中性：\n$$\n\\begin{bmatrix}\n\\mathbf{Z}(k)  & \\mathbf{B}^{\\top} \\\\\n\\mathbf{B}  & 0\n\\end{bmatrix}\n\\begin{bmatrix}\n\\mathbf{c} \\\\\n\\lambda\n\\end{bmatrix}\n=\n\\begin{bmatrix}\n\\mathbf{v}(k) \\\\\n0\n\\end{bmatrix},\n\\quad\n\\text{其中}\n\\quad\n\\mathbf{B} \\,\\mathbf{c} = \\mathbf{a}^{\\top} \\boldsymbol{\\rho} = - \\frac{1}{j \\omega}\\, \\mathbf{a}^{\\top} \\mathbf{D}\\, \\mathbf{c}.\n$$\n\n从麦克斯韦方程组和电荷守恒出发，并利用 EFIE 算子的低频标度律，分析引入电荷中性约束对以下方面的影响：\n\n- 当 $k \\to 0$ 时，离散算子零空间的维度。\n- 当 $k \\to 0$ 时，条件数 $\\kappa(\\mathbf{Z}(k))$ 的渐近标度律。\n\n选择关于增广系统的秩和条件数行为的最准确陈述：\n\nA. 该增广移除了一个在 $k \\to 0$ 时存在的伪模式，使得静态极限下的算子对于一般的闭合几何结构是满秩的；然而，其主导阶的条件数行为仍由 $k$ 与 $1/k$ 之间的不平衡所决定，且条件数仍然以 $\\mathcal{O}(1/k^{2})$ 的速度增长。\n\nB. 该增广消除了螺线向量和无旋向量的不平衡，使得 EFIE 是一致良态的，其条件数在 $k \\to 0$ 时有界。\n\nC. 该增广对秩或条件数没有影响；零空间和条件数保持不变。\n\nD. 该增广通过添加一个冗余约束使算子变得奇异，并导致条件数以更快的速度（如 $\\mathcal{O}(1/k^{3})$）爆炸。",
            "solution": "用户希望我验证并解决一个关于计算电磁学中电场积分方程 (EFIE) 低频行为的问题。\n\n### 第1步：提取已知条件\n- **系统**：一个闭合的理想电导体 (PEC) 表面。\n- **方程**：频域电场积分方程 (EFIE)。\n- **离散化**：表面电流密度 $\\mathbf{J}$ 使用 $N_{\\mathrm{RWG}}$ 个 Rao-Wilton-Glisson (RWG) 基函数展开，未知系数为 $\\mathbf{c} \\in \\mathbb{C}^{N_{\\mathrm{RWG}}}$。表面网格划分为 $N_{\\Delta}$ 个三角形，面积为 $\\{A_{t}\\}_{t=1}^{N_{\\Delta}}$。表面电荷密度由分片常数 $\\boldsymbol{\\rho} \\in \\mathbb{C}^{N_{\\Delta}}$ 表示。\n- **物理控制**：麦克斯韦方程组（$\\nabla \\times \\mathbf{H} = \\mathbf{J} + j \\omega \\epsilon \\mathbf{E}$，$\\nabla \\times \\mathbf{E} = - j \\omega \\mu \\mathbf{H}$）和 PEC 边界条件 $\\hat{\\mathbf{n}} \\times \\mathbf{E}_{\\mathrm{tot}} = \\mathbf{0}$。\n- **离散系统**：$\\mathbf{Z}(k)\\, \\mathbf{c} = \\mathbf{v}(k)$，其中 $k = \\omega \\sqrt{\\mu \\epsilon}$ 是波数。\n- **阻抗矩阵分解**：矩阵 $\\mathbf{Z}(k)$ 由矢量势和标量势的贡献组成，导致低频标度形式为 $\\mathbf{Z}(k) = k\\, \\mathbf{Z}_{\\mathrm{V}} + \\frac{1}{k}\\, \\mathbf{Z}_{\\mathrm{S}}$。矩阵 $\\mathbf{Z}_{\\mathrm{V}}$ 和 $\\mathbf{Z}_{\\mathrm{S}}$ 与 $k$ 无关。\n- **离散连续性方程**：$\\mathbf{D}\\, \\mathbf{c} = - j \\omega\\, \\boldsymbol{\\rho}$，它将散度矩阵 $\\mathbf{D} \\in \\mathbb{R}^{N_{\\Delta} \\times N_{\\mathrm{RWG}}}$ 与电流系数和电荷值联系起来。\n- **约束**：强制执行全局电荷中性，$\\sum_{t=1}^{N_{\\Delta}} \\rho_{t}\\, A_{t} = 0$。\n- **增广系统**：使用拉格朗日乘子 $\\lambda$ 来强制执行中性约束，得到系统：\n$$\n\\begin{bmatrix}\n\\mathbf{Z}(k)  & \\mathbf{B}^{\\top} \\\\\n\\mathbf{B}  & 0\n\\end{bmatrix}\n\\begin{bmatrix}\n\\mathbf{c} \\\\\n\\lambda\n\\end{bmatrix}\n=\n\\begin{bmatrix}\n\\mathbf{v}(k) \\\\\n0\n\\end{bmatrix}\n$$\n约束方程为 $\\mathbf{B} \\mathbf{c} = 0$，它由中性条件 $\\mathbf{a}^{\\top} \\boldsymbol{\\rho} = 0$ 导出，其中 $a_t = A_t$。使用连续性方程，这变为 $\\mathbf{a}^{\\top} (\\frac{1}{-j\\omega} \\mathbf{D} \\mathbf{c}) = 0$，意味着 $\\mathbf{a}^{\\top} \\mathbf{D} \\mathbf{c} = 0$。问题定义了 $\\mathbf{B}$，使得约束行确实为 $\\mathbf{a}^{\\top} \\mathbf{D} \\mathbf{c} = 0$（相差一个非零比例因子）。因此，我们可确定 $\\mathbf{B} \\propto \\mathbf{a}^{\\top} \\mathbf{D}$。\n\n### 第2步：使用提取的已知条件进行验证\n1.  **科学上成立**：问题陈述牢固地植根于计算电磁学的既定理论。EFIE、其低频失效、矢量势和标量势的作用、RWG 基函数、离散连续性方程和电荷中性条件都是标准且描述准确的概念。分解式 $\\mathbf{Z}(k) = k\\, \\mathbf{Z}_{\\mathrm{V}} + \\frac{1}{k}\\, \\mathbf{Z}_{\\mathrm{S}}$ 正确地捕捉了矢量势和标量势对积分算子贡献的低频标度律。\n2.  **定义良好**：问题是适定的。它要求对线性系统的秩和条件数进行定性分析，这是数值分析中的标准任务。给出的设置足以进行此分析。\n3.  **客观性**：问题以精确、技术性的语言陈述，没有主观性或歧义。在定义 `with B c = ...` 时的轻微不自然是次要的，从拉格朗日乘子和给定的中性约束的上下文中，其意图是明确的。\n\n该问题没有违反任何无效性标准。这是一个科学上合理、定义良好且客观的问题。\n\n### 第3步：结论与行动\n问题陈述有效。我将继续进行推导和求解。\n\n### 推导\n\nEFIE 的“低频失效”是一个众所周知的现象，其特征是在波数 $k \\to 0$ 时存在两个截然不同的问题：\n1.  静态极限下的秩亏。\n2.  由标度不平衡引起的严重病态。\n\n我们将首先分析未增广的系统，然后评估增广的效果。\n\n**未增广系统的分析：$\\mathbf{Z}(k)\\mathbf{c} = \\mathbf{v}(k)$**\n\n1.  **秩亏**：当 $k \\to 0$ 时，阻抗矩阵 $\\mathbf{Z}(k) = k\\, \\mathbf{Z}_{\\mathrm{V}} + \\frac{1}{k}\\, \\mathbf{Z}_{\\mathrm{S}}$ 主要由标量势项主导，其标度为 $\\mathcal{O}(1/k)$。静态极限行为由矩阵 $\\mathbf{Z}_{\\mathrm{S}}$ 控制。对于一个闭合的、单连通（亏格为0）的表面，与 $\\mathbf{Z}_{\\mathrm{S}}$ 对应的算子具有一维零空间。这个零模式，我们称其系数向量为 $\\mathbf{c}_{\\mathrm{null}}$，对应于在表面上沉积净电荷的电流分布，这反过来又在表面上产生一个恒定的标量势 $\\phi$。由于 $\\phi$ 是恒定的，其切向梯度为零，$\\mathbf{E}_{\\mathrm{tan}} = -(\\nabla \\phi)_{\\mathrm{tan}} = \\mathbf{0}$，这意味着该模式位于静态 EFIE 算子的零空间中。对于散射问题，这是一个伪的、非物理的模式，因为感应电荷必须为零。因此，当 $k \\to 0$ 时，$\\mathbf{Z}(k)$ 越来越接近一个奇异矩阵，其零空间维度趋近于1。\n\n2.  **条件数**：条件数定义为 $\\kappa(\\mathbf{A}) = \\|\\mathbf{A}\\| \\|\\mathbf{A}^{-1}\\| = \\sigma_{\\max}/\\sigma_{\\min}$，其中 $\\sigma$ 是奇异值。$\\mathbf{Z}(k)$ 的病态性源于其组成部分之间矛盾的标度。矩阵 $\\mathbf{Z}(k)$ 作用于电流系数空间 $\\mathbf{c}$。这个空间可以通过亥姆霍兹-霍奇分解分解为一个近似螺线（无散）电流的子空间和一个近似无旋（无旋度）电流的子空间。\n    - 矢量势项 $k\\mathbf{Z}_{\\mathrm{V}}$ 主要作用于螺线电流。其奇异值标度为 $\\mathcal{O}(k)$。\n    - 标量势项 $\\frac{1}{k}\\mathbf{Z}_{\\mathrmS}$ 主要作用于无旋电流。其非零奇异值标度为 $\\mathcal{O}(1/k)$。\n这种差异意味着 $\\mathbf{Z}(k)$ 的最大奇异值标度为 $\\sigma_{\\max} \\sim \\mathcal{O}(1/k)$，而最小奇异值标度为 $\\sigma_{\\min} \\sim \\mathcal{O}(k)$。由此产生的条件数标度为：\n$$\n\\kappa(\\mathbf{Z}(k)) \\sim \\frac{\\sigma_{\\max}}{\\sigma_{\\min}} \\sim \\frac{\\mathcal{O}(1/k)}{\\mathcal{O}(k)} = \\mathcal{O}(1/k^2)\n$$\n随着频率降低，条件数的这种急剧增长是低频失效的本质。\n\n**增广系统的分析**\n\n增广强制执行了全局电荷中性条件，$Q = \\sum_t \\rho_t A_t = 0$。用电流系数表示，即为 $\\mathbf{a}^{\\top}\\mathbf{D}\\mathbf{c} = 0$。令 $\\mathbf{B} = \\mathbf{a}^{\\top}\\mathbf{D}$。\n\n1.  **对秩的影响**：静态算子 $\\mathbf{Z}_{\\mathrmS}$ 的伪零模式 $\\mathbf{c}_{\\mathrm{null}}$ 正是产生非零净电荷的模式。因此，对于此模式，$\\mathbf{B}\\,\\mathbf{c}_{\\mathrm{null}} \\neq 0$。拉格朗日乘子约束 $\\mathbf{B}\\,\\mathbf{c} = 0$ 明确地将此伪模式从解空间中投影出去。因此，在静态极限下，增广算子 $\\begin{bsmallmatrix} \\mathbf{Z}_{\\mathrm{S}}  & \\mathbf{B}^{\\top} \\\\ \\mathbf{B}  & 0 \\end{bsmallmatrix}$ 对于一般几何结构是非奇异的（满秩）。增广成功地修复了静态算子的秩亏问题。\n\n2.  **对条件数的影响**：增广虽然修复了静态极限的秩，但*并未*解决矢量势和标量势项之间根本的标度不平衡问题。电流的基函数没有改变，因此矩阵 $\\mathbf{Z}_{\\mathrm{V}}$ 和 $\\mathbf{Z}_{\\mathrm{S}}$ 也没有改变。增广系统仍然包含矩阵 $\\mathbf{Z}(k) = k\\mathbf{Z}_{\\mathrm{V}} + \\frac{1}{k}\\mathbf{Z}_{\\mathrmS}$，它以 $\\mathcal{O}(k)$ 的强度与螺线模式耦合，并以 $\\mathcal{O}(1/k)$ 的强度与无旋模式耦合。整个系统矩阵 $\\mathbf{M}(k) = \\begin{bsmallmatrix} \\mathbf{Z}(k)  & \\mathbf{B}^{\\top} \\\\ \\mathbf{B}  & 0 \\end{bsmallmatrix}$ 继承了这种病态性。$\\mathbf{Z}(k)$ 奇异值的巨大差异是 $\\mathbf{M}(k)$ 条件数的主导因素。不平衡的物理机制并未被改变。因此，增广系统的条件数仍然受 $\\mathcal{O}(1/k^2)$ 标度律的支配。需要更先进的技术，例如环路-树/环路-星分解（通过重新标度基函数），才能解决标度不平衡问题，并实现一个在 $k \\to 0$ 时有界的条件数。\n\n### 逐项分析\n\n**A. 该增广移除了一个在 $k \\to 0$ 时存在的伪模式，使得静态极限下的算子对于一般的闭合几何结构是满秩的；然而，其主导阶的条件数行为仍由 $k$ 与 $1/k$ 之间的不平衡所决定，且条件数仍然以 $\\mathcal{O}(1/k^{2})$ 的速度增长。**\n- 这个陈述准确地描述了我们的发现。增广通过移除单个伪静态模式（对于亏格为0的表面）来修复秩亏。它正确地指出这并未修复标度不平衡，因此条件数仍然以 $\\mathcal{O}(1/k^2)$ 的速度恶化。\n- **结论：正确。**\n\n**B. 该增广消除了螺线向量和无旋向量的不平衡，使得 EFIE 是一致良态的，其条件数在 $k \\to 0$ 时有界。**\n- 这是错误的。增广仅作用于电流空间的无旋部分（通过约束总电荷），并且只修复了秩亏，而不是标度不平衡。实现有界条件数需要对系统进行更深刻的重构，而这种简单的增广无法提供。\n- **结论：错误。**\n\n**C. 该增广对秩或条件数没有影响；零空间和条件数保持不变。**\n- 这是错误的。增广明确地移除了静态算子的一个零模式，从而影响了其秩。这种改变会对条件数产生影响，即使它没有改善其渐近标度律。\n- **结论：错误。**\n\n**D. 该增广通过添加一个冗余约束使算子变得奇异，并导致条件数以更快的速度（如 $\\mathcal{O}(1/k^{3})$）爆炸。**\n- 这是错误的。该约束并非冗余；它旨在消除一个已知的伪解。它改善了秩亏，而不是创造一个新的秩亏。没有物理或数学依据表明条件数会恶化，更不用说增加一个额外的 $1/k$ 因子。\n- **结论：错误。**",
            "answer": "$$\\boxed{A}$$"
        },
        {
            "introduction": "理论分析之后，现在是时候通过编程实践来构建一个内在稳定的数值格式了。本练习要求你从头开始，通过将电荷连续性方程作为一个独立约束进行耦合，来构建一个鞍点线性系统，这是一种强大的低频稳定化策略。你将亲手构造离散算子，并通过计算离散inf-sup常数和系统条件数，来量化稳定与非稳定离散化配对的差异，以及正则化项在抑制低频崩溃中的关键作用 。",
            "id": "3326527",
            "problem": "考虑时谐麦克斯韦电荷连续性关系，其在频域中表示为 $i \\omega \\rho + \\nabla \\cdot \\mathbf{J} = 0$，其中 $i$ 是虚数单位，$\\omega$ 是角频率，单位为弧度/秒 (rad/s)，$\\rho$ 是电荷密度，单位为库仑/立方米，$\\mathbf{J}$ 是电流密度，单位为安培/平方米。在低频状态下（$|\\omega| \\to 0$），计算电磁学公式可能会遇到低频失效问题。一种稳健的稳定化策略是将离散连续性方程作为独立约束进行耦合，从而产生一个辅以适当正则化的鞍点系统。\n\n从基本守恒定律和结构化笛卡尔网格上的离散化出发，您将：\n\n- 为一个具有 $N_x \\times N_y$ 个单元、网格间距为 $h$ 米的均匀矩形网格剖分，构建一个最低阶离散散度算子 $D$以及质量矩阵 $M_J$ 和 $M_\\rho$。使用以下网格对齐的自由度：\n  - $\\mathbf{J}$ 的边法向通量未知数，每条边一个，表示法向分量在每条边上的积分，与矩形上最低阶的 Raviart–Thomas (RT) 空间一致。共有 $(N_x (N_y + 1))$ 条水平边和 $((N_x + 1) N_y)$ 条垂直边，因此电流未知数的总数为 $N_e = N_x (N_y + 1) + (N_x + 1) N_y$。\n  - $\\rho$ 的单元中心分片常数未知数，单元总数为 $N_c = N_x N_y$。\n- 组装离散散度算子 $D \\in \\mathbb{R}^{N_c \\times N_e}$，使得对于每个单元，其散度等于出射边法向通量的带符号总和除以单元面积。使用均匀间距 $h$ 和单元面积 $h^2$，并根据向外的方向将每个非零系数设置为 $\\pm \\frac{1}{h}$。具体而言：\n  - 对于整数坐标为 $(x,y)$、全局法线为 $+\\hat{\\mathbf{y}}$ 的水平边，$x \\in \\{0,\\dots,N_x - 1\\}, y \\in \\{0,\\dots,N_y\\}$，如果 $y < N_y$，则向上方单元 $(x,y)$ 贡献 $+\\frac{1}{h}$；如果 $y > 0$，则向下方单元 $(x,y-1)$ 贡献 $-\\frac{1}{h}$。\n  - 对于整数坐标为 $(x,y)$、全局法线为 $+\\hat{\\mathbf{x}}$ 的垂直边，$x \\in \\{0,\\dots,N_x\\}, y \\in \\{0,\\dots,N_y-1\\}$，如果 $x < N_x$，则向右侧单元 $(x,y)$ 贡献 $+\\frac{1}{h}$；如果 $x > 0$，则向左侧单元 $(x-1,y)$ 贡献 $-\\frac{1}{h}$。\n- 定义对角质量矩阵 $M_J \\in \\mathbb{R}^{N_e \\times N_e}$ 和 $M_\\rho \\in \\mathbb{R}^{N_c \\times N_c}$ 为 $M_J = \\operatorname{diag}(h, \\dots, h)$（每条边一个条目）和 $M_\\rho = \\operatorname{diag}(h^2, \\dots, h^2)$（每个单元一个条目）。\n- 考虑耦合未知向量 $(\\mathbf{j}, \\boldsymbol{\\rho})$ 的以下鞍点线性系统：\n  $$\n  \\begin{bmatrix}\n  A & D^\\top \\\\\n  D & -i \\omega M_\\rho + \\gamma M_\\rho\n  \\end{bmatrix}\n  \\begin{bmatrix}\n  \\mathbf{j} \\\\\n  \\boldsymbol{\\rho}\n  \\end{bmatrix}\n  =\n  \\begin{bmatrix}\n  \\mathbf{f} \\\\\n  \\mathbf{0}\n  \\end{bmatrix},\n  $$\n  其中 $A$ 是电流空间中的离散算子。在传导主导的准静态极限下，取 $A = \\sigma M_J$，其中 $\\sigma$ 是电导率，单位为西门子/米。标量 $\\gamma \\ge 0$ 是一个正则化参数，用于在电荷块中实现增广拉格朗日稳定化。在所有测试中，设置 $\\mathbf{f} = \\mathbf{0}$；下文定义的系统度量与外力无关。\n- 通过计算广义 inf-sup 常数，研究电流和电荷空间配对的离散 inf-sup 条件（Ladyzhenskaya–Babuška–Brezzi 稳定性）：\n  $$\n  \\beta = \\inf_{\\boldsymbol{\\rho} \\neq \\mathbf{0}} \\sup_{\\mathbf{j} \\neq \\mathbf{0}} \\frac{\\boldsymbol{\\rho}^\\top D \\mathbf{j}}{\\|\\boldsymbol{\\rho}\\|_{M_\\rho} \\, \\|\\mathbf{j}\\|_{M_J}},\n  $$\n  其中 $\\|\\boldsymbol{\\rho}\\|_{M_\\rho} = \\sqrt{\\boldsymbol{\\rho}^\\top M_\\rho \\boldsymbol{\\rho}}$ 且 $\\|\\mathbf{j}\\|_{M_J} = \\sqrt{\\mathbf{j}^\\top M_J \\mathbf{j}}$。在算法上，$\\beta$ 等于算子 $M_\\rho^{-1/2} D M_J^{-1/2}$ 的最小奇异值。\n- 通过计算 $2$-范数条件数来量化低频失效和稳定化的效果：\n  $$\n  \\kappa_2(S) = \\frac{\\sigma_{\\max}(S)}{\\sigma_{\\min}(S)},\n  $$\n  其中 $S$ 是鞍点矩阵，$\\sigma_{\\max}$ 和 $\\sigma_{\\min}$ 分别是 $S$ 的最大和最小奇异值。如果 $\\sigma_{\\min}$ 在数值上消失（在容差范围内），则定义 $\\kappa_2(S) = +\\infty$。\n\n为了探究稳定和不稳定的配对，使用以下构造方法：\n- 对于稳定配对，完全按照上述方式组装 $D$，这对应于矩形上规范的最低阶 Raviart–Thomas (RT) 和分片常数电荷配对。\n- 对于不稳定配对，通过将 $D$ 中所有垂直边贡献乘以一个因子 $\\varepsilon$（其中 $0 < \\varepsilon \\ll 1$）来人为地降低相干性，同时保持水平边贡献不变。这模拟了一种不匹配的离散化，其中一个通量族被严重低估，并随着 $\\varepsilon \\to 0$ 将 inf-sup 常数推向零。\n\n您的程序必须实现上述算子，并为以下测试套件计算指定的量。所有物理参数均采用国际单位制 (SI)，所有报告的答案均为无量纲浮点数，因为它们是奇异值和条件数。\n\n测试套件参数：\n- 测试用例 $\\mathrm{A}$（稳定配对）：\n  - $N_x = 3$，$N_y = 3$，$h = 0.5$ 米，$\\sigma = 1.0$ 西门子/米，$\\omega = 10^{-6}$ 弧度/秒，两种正则化：$\\gamma = 0.0$ 和 $\\gamma = 1.0$。\n- 测试用例 $\\mathrm{B}$（稳定配对，极低频）：\n  - $N_x = 2$，$N_y = 1$，$h = 0.5$ 米，$\\sigma = 0.1$ 西门子/米，$\\omega = 0.0$ 弧度/秒，两种正则化：$\\gamma = 0.0$ 和 $\\gamma = 0.5$。\n- 测试用例 $\\mathrm{C}$（通过垂直边缩放实现的不稳定配对）：\n  - $N_x = 3$，$N_y = 3$，$h = 0.5$ 米，$\\sigma = 1.0$ 西门子/米，$\\omega = 10^{-6}$ 弧度/秒，垂直边缩放因子 $\\varepsilon = 10^{-8}$，两种正则化：$\\gamma = 0.0$ 和 $\\gamma = 1.0$。\n\n对于每个测试用例，计算：\n- 给定 $D$、$M_J$ 和 $M_\\rho$ 配对的广义 inf-sup 常数 $\\beta$。\n- 对于两个指定的 $\\gamma$ 值，鞍点矩阵 $S$ 的 $2$-范数条件数 $\\kappa_2$。\n\n最终输出格式：\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表。该列表必须按以下顺序排列：\n  $$\n  [\\beta_{\\mathrm{A}}, \\kappa_{2,\\gamma=0}^{\\mathrm{A}}, \\kappa_{2,\\gamma=1}^{\\mathrm{A}}, \\beta_{\\mathrm{B}}, \\kappa_{2,\\gamma=0}^{\\mathrm{B}}, \\kappa_{2,\\gamma=0.5}^{\\mathrm{B}}, \\beta_{\\mathrm{C}}, \\kappa_{2,\\gamma=0}^{\\mathrm{C}}, \\kappa_{2,\\gamma=1}^{\\mathrm{C}}],\n  $$\n  其中每个条目都是以其默认数值表示法打印的浮点数。报告的数字是无单位的。",
            "solution": "该问题陈述已经过严格验证，并被认为是有效的。它在科学上基于电磁学和数值分析的原理，特别是关于麦克斯韦方程组的混合有限元方法。该问题是适定的，提供了构建所需矩阵和计算指定稳定性指标所需的所有定义、常数和参数。尽管离散散度算子的文字描述与其明确定义的系数之间存在轻微的歧义，但通过优先采用明确的数学公式，可以得到一种一致的解释，从而导出一个量纲一致的系统。该问题要求精确分析数值系统在何种条件下是良态或病态的，这是计算科学中的一项标准且有意义的任务。\n\n解决方案通过按规定实现数学构造来推进。任务的核心是在笛卡尔网格上组装几个表示离散算子的矩阵，然后分析由它们派生的复合矩阵的谱特性。\n\n### 1. 离散化与矩阵组装\n\n解决方案的基础是将连续的物理域转换为一组离散的未知数和算子。我们考虑一个具有均匀间距 $h$ 的 $N_x \\times N_y$ 矩形网格。\n\n**索引方案：** 一致的索引方案对于正确组装矩阵至关重要。\n-   **单元：** 共有 $N_c = N_x N_y$ 个单元，代表电荷未知数 $\\rho$。位于网格位置 $(i_x, i_y)$（其中 $i_x \\in \\{0, \\dots, N_x-1\\}$ 和 $i_y \\in \\{0, \\dots, N_y-1\\}$）的单元被赋予唯一索引 $c_{idx} = i_y N_x + i_x$。\n-   **边：** 共有 $N_e = N_x(N_y+1) + (N_x+1)N_y$ 条边，代表电流未知数 $\\mathbf{j}$。我们将其分为水平集和垂直集。\n    -   水平边：$N_{he} = N_x(N_y+1)$ 条边。位于 $(i_x, i_y)$（其中 $i_x \\in \\{0, \\dots, N_x-1\\}$ 和 $i_y \\in \\{0, \\dots, N_y\\}$）的边被索引为 $e_{h,idx} = i_y N_x + i_x$。\n    -   垂直边：$N_{ve} = (N_x+1)N_y$ 条边。位于 $(i_x, i_y)$（其中 $i_x \\in \\{0, \\dots, N_x\\}$ 和 $i_y \\in \\{0, \\dots, N_y-1\\}$）的边被索引为 $e_{v,idx} = i_x N_y + i_y$。其在完整未知数向量 $\\mathbf{j}$ 中的全局索引为 $N_{he} + e_{v,idx}$。\n\n**离散散度算子 ($D$):**\n算子 $D \\in \\mathbb{R}^{N_c \\times N_e}$ 对散度进行离散化，将基于边的电流通量映射到基于单元的散度。根据问题的明确指令，$D$ 的非零条目被设置为 $\\pm \\frac{1}{h}$。此公式确保了离散电荷连续性方程 $D \\mathbf{j} - (i \\omega - \\gamma)M_\\rho \\boldsymbol{\\rho} = 0$ 中的量纲一致性，其中两项的单位均为安培/米 (A/m)。\n\n对于每个单元 $(i_x, i_y)$，其散度是穿过其四个边界的通量之和，符号由向外法线约定确定。设 $c_{idx}$ 是单元 $(i_x, i_y)$ 的索引。构造如下：\n-   **上边：** 位于 $(i_x, i_y+1)$ 的水平边。其全局索引为 $e_{h,idx}(i_x, i_y+1)$。向外法线为正，因此 $D[c_{idx}, e_{h,idx}] = +\\frac{1}{h}$。\n-   **下边：** 位于 $(i_x, i_y)$ 的水平边。其全局索引为 $e_{h,idx}(i_x, i_y)$。向外法线为负，因此 $D[c_{idx}, e_{h,idx}] = -\\frac{1}{h}$。\n-   **右边：** 位于 $(i_x+1, i_y)$ 的垂直边。其全局索引为 $N_{he} + e_{v,idx}(i_x+1, i_y)$。向外法线为正，因此 $D[c_{idx}, e_{v,idx}] = +\\frac{1}{h} \\times \\varepsilon$。\n-   **左边：** 位于 $(i_x, i_y)$ 的垂直边。其全局索引为 $N_{he} + e_{v,idx}(i_x, i_y)$。向外法线为负，因此 $D[c_{idx}, e_{v,idx}] = -\\frac{1}{h} \\times \\varepsilon$。\n参数 $\\varepsilon$ 对于稳定配对为 $1$，对于不稳定配对为一个小数，仅缩放垂直边的贡献。\n\n**质量矩阵 ($M_J$, $M_\\rho$):**\n这些是对角矩阵，表示电流和电荷未知数空间中的内积。按规定，它们被构造为：\n-   $M_J = h \\cdot I_{N_e}$，其中 $I_{N_e}$ 是大小为 $N_e \\times N_e$ 的单位矩阵。\n-   $M_\\rho = h^2 \\cdot I_{N_c}$，其中 $I_{N_c}$ 是大小为 $N_c \\times N_c$ 的单位矩阵。\n\n### 2. Inf-Sup 常数 ($\\beta$) 的计算\n\nLadyzhenskaya–Babuška–Brezzi (LBB) 或 inf-sup 条件是混合有限元理论的基石，保证了鞍点问题的稳定性和适定性。Inf-sup 常数 $\\beta$ 量化了这种稳定性。为了保证稳定性，需要一个远离零的 $\\beta$ 值。广义 inf-sup 常数由下式给出：\n$$\n\\beta = \\inf_{\\boldsymbol{\\rho} \\neq \\mathbf{0}} \\sup_{\\mathbf{j} \\neq \\mathbf{0}} \\frac{\\boldsymbol{\\rho}^\\top D \\mathbf{j}}{\\|\\boldsymbol{\\rho}\\|_{M_\\rho} \\, \\|\\mathbf{j}\\|_{M_J}}\n$$\n这个表达式可以被转换。通过定义归一化未知数 $\\tilde{\\boldsymbol{\\rho}} = M_\\rho^{1/2} \\boldsymbol{\\rho}$ 和 $\\tilde{\\mathbf{j}} = M_J^{1/2} \\mathbf{j}$，范数变为标准的欧几里得范数：$\\|\\boldsymbol{\\rho}\\|_{M_\\rho} = \\|\\tilde{\\boldsymbol{\\rho}}\\|_2$ 和 $\\|\\mathbf{j}\\|_{M_J} = \\|\\tilde{\\mathbf{j}}\\|_2$。分子变为 $\\tilde{\\boldsymbol{\\rho}}^\\top (M_\\rho^{-1/2} D M_J^{-1/2}) \\tilde{\\mathbf{j}}$。问题因此简化为求矩阵 $B = M_\\rho^{-1/2} D M_J^{-1/2}$ 关于欧几里得范数的 inf-sup，这等同于其最小奇异值。\n在算法上，我们通过以下步骤计算 $\\beta$：\n1.  构造矩阵 $B = M_\\rho^{-1/2} D M_J^{-1/2}$。由于 $M_\\rho$ 和 $M_J$ 是对角矩阵，这只是对 $D$ 的条目进行简单的缩放。\n2.  使用标准数值库计算 $B$ 的奇异值。\n3.  将 $\\beta$ 确定为最小奇异值。\n\n### 3. 条件数分析\n\n通过计算完整鞍点系统矩阵 $S$ 的 $2$-范数条件数 $\\kappa_2(S)$ 来分析低频失效：\n$$\nS =\n\\begin{bmatrix}\nA & D^\\top \\\\\nD & -i \\omega M_\\rho + \\gamma M_\\rho\n\\end{bmatrix}\n$$\n这里，$A = \\sigma M_J = \\sigma h I_{N_e}$。矩阵 $S$ 是复数且非厄米的。其条件数是其最大奇异值与最小奇异值之比，即 $\\kappa_2(S) = \\sigma_{\\max}(S) / \\sigma_{\\min}(S)$。\n-   当 $\\omega \\to 0$ 且正则化参数 $\\gamma = 0$ 时，(2,2) 块消失。矩阵 $S$ 变为 $\\begin{bmatrix} A & D^\\top \\\\ D & 0 \\end{bmatrix}$。对于典型的网格，离散梯度算子（由 $D^\\top$ 近似）有一个对应于常数势的零空间。这导致矩阵 $S$ 是奇异的，即 $\\sigma_{\\min}(S) = 0$，从而导致无限大的条件数。这是低频失效的数值表现。\n-   正则化项 $\\gamma M_\\rho$（其中 $\\gamma > 0$）使得 (2,2) 块可逆，从而“稳定”了系统。矩阵 $S$ 变为非奇异的，$\\kappa_2(S)$ 变为有限值。\n-   不稳定配对（小 $\\varepsilon$）降低了电流和电荷之间的耦合，预计这会将 inf-sup 常数 $\\beta$ 推向接近零，从而增加条件数 $\\kappa_2(S)$。\n\n计算过程如下：\n1.  组装矩阵 $S$ 的四个块。右下块为 $Z = (\\gamma - i \\omega) M_\\rho$。\n2.  计算完整复数矩阵 $S$ 的奇异值。\n3.  计算 $\\kappa_2(S) = \\sigma_{\\max}(S) / \\sigma_{\\min}(S)$。如果 $\\sigma_{\\min}(S)$ 在数值上与零无法区分（例如，小于机器精度容差），则条件数取为无穷大。\n\n以下 Python 代码为所有指定的测试用例实现了此逻辑。",
            "answer": "```python\nimport numpy as np\nfrom scipy.linalg import svdvals\n\ndef solve():\n    \"\"\"\n    Solves the computational electromagnetics problem for three test cases.\n    \"\"\"\n\n    test_cases = [\n        # Case A: Stable pairing\n        {'name': 'A', 'Nx': 3, 'Ny': 3, 'h': 0.5, 'sigma': 1.0, 'omega': 1e-6, \n         'eps': 1.0, 'gammas': [0.0, 1.0]},\n        # Case B: Stable pairing, extreme low frequency\n        {'name': 'B', 'Nx': 2, 'Ny': 1, 'h': 0.5, 'sigma': 0.1, 'omega': 0.0, \n         'eps': 1.0, 'gammas': [0.0, 0.5]},\n        # Case C: Unstable pairing\n        {'name': 'C', 'Nx': 3, 'Ny': 3, 'h': 0.5, 'sigma': 1.0, 'omega': 1e-6, \n         'eps': 1e-8, 'gammas': [0.0, 1.0]},\n    ]\n    \n    TOL = 1e-15\n    results = []\n\n    for case in test_cases:\n        Nx, Ny, h = case['Nx'], case['Ny'], case['h']\n        sigma, omega, eps = case['sigma'], case['omega'], case['eps']\n        gammas = case['gammas']\n        \n        # Grid dimensions\n        Nc = Nx * Ny\n        N_he = Nx * (Ny + 1)\n        N_ve = (Nx + 1) * Ny\n        Ne = N_he + N_ve\n\n        # --- Assemble Discrete Divergence Operator D ---\n        D = np.zeros((Nc, Ne))\n        \n        def cell_idx(ix, iy): return iy * Nx + ix\n        def horz_edge_idx(ix, iy): return iy * Nx + ix\n        def vert_edge_idx(ix, iy): return ix * Ny + iy\n\n        for iy_cell in range(Ny):\n            for ix_cell in range(Nx):\n                c_idx = cell_idx(ix_cell, iy_cell)\n                \n                # Top edge: (ix_cell, iy_cell + 1), outward normal is +y\n                h_idx_top = horz_edge_idx(ix_cell, iy_cell + 1)\n                D[c_idx, h_idx_top] = 1.0 / h\n                \n                # Bottom edge: (ix_cell, iy_cell), outward normal is -y\n                h_idx_bot = horz_edge_idx(ix_cell, iy_cell)\n                D[c_idx, h_idx_bot] = -1.0 / h\n                \n                # Right edge: (ix_cell + 1, iy_cell), outward normal is +x\n                v_glob_idx_right = N_he + vert_edge_idx(ix_cell + 1, iy_cell)\n                D[c_idx, v_glob_idx_right] = (1.0 / h) * eps\n                \n                # Left edge: (ix_cell, iy_cell), outward normal is -x\n                v_glob_idx_left = N_he + vert_edge_idx(ix_cell, iy_cell)\n                D[c_idx, v_glob_idx_left] = (-1.0 / h) * eps\n\n        # --- Assemble Mass Matrices M_rho and M_J ---\n        M_rho = np.diag(np.full(Nc, h**2))\n        M_J = np.diag(np.full(Ne, h))\n\n        # --- Compute Inf-Sup Constant beta ---\n        M_rho_inv_sqrt = np.diag(np.full(Nc, 1.0 / h))\n        M_J_inv_sqrt = np.diag(np.full(Ne, 1.0 / np.sqrt(h)))\n        \n        B = M_rho_inv_sqrt @ D @ M_J_inv_sqrt\n        s_B = svdvals(B)\n        beta = s_B.min()\n        results.append(beta)\n        \n        # --- Compute Condition Numbers kappa_2 for each gamma ---\n        for gamma in gammas:\n            # Assemble saddle-point matrix S\n            A_block = sigma * M_J\n            Z_block = (gamma - 1j * omega) * M_rho\n            \n            S = np.block([\n                [A_block, D.T],\n                [D, Z_block]\n            ])\n            \n            s_S = svdvals(S)\n            s_min = s_S.min()\n            \n            if s_min  TOL:\n                kappa = np.inf\n            else:\n                s_max = s_S.max()\n                kappa = s_max / s_min\n            \n            results.append(kappa)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}