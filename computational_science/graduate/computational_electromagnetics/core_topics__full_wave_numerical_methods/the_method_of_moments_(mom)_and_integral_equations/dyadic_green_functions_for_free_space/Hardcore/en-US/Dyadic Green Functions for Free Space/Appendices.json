{
    "hands_on_practices": [
        {
            "introduction": "To truly grasp the power of the dyadic Green's function, we begin with its most fundamental application: determining the electromagnetic field radiated by a source. This first practice tackles the canonical problem of radiation from an oscillating electric dipole. By applying the far-field asymptotic form of the free-space dyadic Green's function, you will derive the classic radiation pattern and total radiated power, providing a concrete link between the abstract mathematical framework and observable physical phenomena .",
            "id": "3303047",
            "problem": "An oscillating point electric dipole with complex phasor dipole moment amplitude $\\mathbf{p}_{0} = p_{0}\\,\\hat{\\mathbf{z}}$ is located at the origin of homogeneous free space with permittivity $\\varepsilon_{0}$ and permeability $\\mu_{0}$. Assume the time dependence $\\exp(-i \\omega t)$, define the free-space wavenumber $k = \\omega \\sqrt{\\mu_{0}\\varepsilon_{0}}$, and denote the free-space wave impedance by $\\eta_{0} = \\sqrt{\\mu_{0}/\\varepsilon_{0}}$ and the speed of light by $c = 1/\\sqrt{\\mu_{0}\\varepsilon_{0}}$. Let the electric dyadic Green’s function in free space be the tensor $\\mathbf{G}^{E}(\\mathbf{r},\\mathbf{r}')$ that solves the vector Helmholtz equation in the sense that for any impressed electric current density $\\mathbf{J}(\\mathbf{r}')$, the radiated electric field satisfies\n$$\n\\nabla \\times \\nabla \\times \\mathbf{E}(\\mathbf{r}) - k^{2}\\mathbf{E}(\\mathbf{r}) = i \\omega \\mu_{0} \\mathbf{J}(\\mathbf{r}), \\quad \\mathbf{E}(\\mathbf{r}) = i \\omega \\mu_{0} \\int \\mathbf{G}^{E}(\\mathbf{r},\\mathbf{r}') \\cdot \\mathbf{J}(\\mathbf{r}') \\, dV'.\n$$\nTreat the oscillating electric dipole as a point source with equivalent current density $\\mathbf{J}(\\mathbf{r}) = -i \\omega \\mathbf{p}_{0}\\,\\delta(\\mathbf{r})$. Using only the frequency-domain Maxwell equations, the definition of the dyadic Green’s function for free space, its far-field asymptotic form, and the time-average version of Poynting’s theorem, do the following:\n\n1. Derive the far-field electric and magnetic fields radiated by the dipole, as functions of the observation direction $\\hat{\\mathbf{r}}$ and the polar angle $\\theta$ measured from the $+\\hat{\\mathbf{z}}$ axis.\n\n2. From these fields, derive the time-averaged radiated power per unit solid angle and identify the normalized angular radiation pattern $F(\\theta)$, defined to be dimensionless and normalized so that $\\max_{\\theta} F(\\theta) = 1$.\n\n3. Integrate over all solid angles to obtain the total time-averaged radiated power $P_{\\text{rad}}$.\n\nAnswer format requirements:\n- Provide your final answer as a pair consisting of:\n  - The normalized angular radiation pattern $F(\\theta)$ expressed purely as a function of $\\theta$.\n  - The total time-averaged radiated power $P_{\\text{rad}}$ expressed symbolically in terms of $\\omega$, $|p_{0}|$, $\\varepsilon_{0}$, and $c$.\n- Express $P_{\\text{rad}}$ in watts in the International System of Units (SI).\n- Provide the two answers inside a single row matrix as the final boxed answer.\n- No numerical evaluation or rounding is required.",
            "solution": "The problem statement is scientifically grounded, self-contained, and well-posed. It describes a canonical problem in electromagnetic theory—radiation from a point electric dipole—using standard definitions and equations. The problem is therefore deemed valid.\n\nThe electric field $\\mathbf{E}(\\mathbf{r})$ radiated by an impressed current density $\\mathbf{J}(\\mathbf{r}')$ is given by the integral relation involving the electric dyadic Green's function $\\mathbf{G}^{E}(\\mathbf{r},\\mathbf{r}')$:\n$$\n\\mathbf{E}(\\mathbf{r}) = i \\omega \\mu_{0} \\int \\mathbf{G}^{E}(\\mathbf{r},\\mathbf{r}') \\cdot \\mathbf{J}(\\mathbf{r}') \\, dV'\n$$\nThe point electric dipole at the origin is represented by the equivalent current density $\\mathbf{J}(\\mathbf{r}') = -i \\omega \\mathbf{p}_{0}\\,\\delta(\\mathbf{r}')$, where $\\mathbf{p}_{0} = p_{0}\\,\\hat{\\mathbf{z}}$ and $\\delta(\\mathbf{r}')$ is the three-dimensional Dirac delta function.\n\nSubstituting the current density into the integral for $\\mathbf{E}(\\mathbf{r})$ gives:\n$$\n\\mathbf{E}(\\mathbf{r}) = i \\omega \\mu_{0} \\int \\mathbf{G}^{E}(\\mathbf{r},\\mathbf{r}') \\cdot (-i \\omega \\mathbf{p}_{0}\\,\\delta(\\mathbf{r}')) \\, dV'\n$$\nUsing the sifting property of the Dirac delta function, which states that $\\int f(\\mathbf{x}')\\delta(\\mathbf{x}')d\\mathbf{x}'=f(\\mathbf{0})$, we can evaluate the integral at $\\mathbf{r}'=\\mathbf{0}$:\n$$\n\\mathbf{E}(\\mathbf{r}) = (i \\omega)(-i \\omega) \\mu_{0} \\mathbf{G}^{E}(\\mathbf{r},\\mathbf{0}) \\cdot \\mathbf{p}_{0} = \\omega^{2} \\mu_{0} \\mathbf{G}^{E}(\\mathbf{r},\\mathbf{0}) \\cdot \\mathbf{p}_{0}\n$$\nThe problem requires the far-field solution. The far-field asymptotic form of the free-space dyadic Green's function $\\mathbf{G}^{E}(\\mathbf{r},\\mathbf{r}')$ for a source at $\\mathbf{r}'=\\mathbf{0}$ is\n$$\n\\mathbf{G}^{E}(\\mathbf{r},\\mathbf{0}) \\approx (\\mathbf{I} - \\hat{\\mathbf{r}}\\hat{\\mathbf{r}}) \\frac{\\exp(ik|\\mathbf{r}|)}{4\\pi|\\mathbf{r}|} \\quad \\text{as } |\\mathbf{r}| \\to \\infty\n$$\nwhere $\\mathbf{I}$ is the identity dyad, $\\hat{\\mathbf{r}}=\\mathbf{r}/|\\mathbf{r}|$ is the radial unit vector, and $r=|\\mathbf{r}|$. The term $\\hat{\\mathbf{r}}\\hat{\\mathbf{r}}$ represents a dyadic product.\n\nSubstituting this asymptotic form into the expression for $\\mathbf{E}(\\mathbf{r})$ yields the far-field electric field:\n$$\n\\mathbf{E}(\\mathbf{r}) \\approx \\omega^{2} \\mu_{0} \\left[ (\\mathbf{I} - \\hat{\\mathbf{r}}\\hat{\\mathbf{r}}) \\frac{\\exp(ikr)}{4\\pi r} \\right] \\cdot \\mathbf{p}_{0}\n$$\nThe term $(\\mathbf{I} - \\hat{\\mathbf{r}}\\hat{\\mathbf{r}}) \\cdot \\mathbf{p}_{0}$ projects the dipole moment vector $\\mathbf{p}_{0}$ onto the plane perpendicular to the observation direction $\\hat{\\mathbf{r}}$. We are given $\\mathbf{p}_{0} = p_{0}\\hat{\\mathbf{z}}$. In spherical coordinates, $\\hat{\\mathbf{z}} = \\cos\\theta\\,\\hat{\\mathbf{r}} - \\sin\\theta\\,\\hat{\\boldsymbol{\\theta}}$, and the dot product with $\\hat{\\mathbf{r}}$ is $\\hat{\\mathbf{r}} \\cdot \\hat{\\mathbf{z}} = \\cos\\theta$.\nThus, the projection is:\n$$\n(\\mathbf{I} - \\hat{\\mathbf{r}}\\hat{\\mathbf{r}}) \\cdot \\mathbf{p}_{0} = \\mathbf{p}_{0} - \\hat{\\mathbf{r}}(\\hat{\\mathbf{r}} \\cdot \\mathbf{p}_{0}) = p_{0}\\hat{\\mathbf{z}} - \\hat{\\mathbf{r}}(p_{0}\\cos\\theta) = p_{0}(\\hat{\\mathbf{z}} - \\hat{\\mathbf{r}}\\cos\\theta)\n$$\nSubstituting the spherical representation of $\\hat{\\mathbf{z}}$:\n$$\np_{0}((\\cos\\theta\\,\\hat{\\mathbf{r}} - \\sin\\theta\\,\\hat{\\boldsymbol{\\theta}}) - \\hat{\\mathbf{r}}\\cos\\theta) = -p_{0}\\sin\\theta\\,\\hat{\\boldsymbol{\\theta}}\n$$\nInserting this result back into the expression for $\\mathbf{E}(\\mathbf{r})$:\n$$\n\\mathbf{E}(\\mathbf{r}) \\approx \\omega^{2} \\mu_{0} \\frac{\\exp(ikr)}{4\\pi r} (-p_{0}\\sin\\theta\\,\\hat{\\boldsymbol{\\theta}}) = -\\frac{\\omega^{2} \\mu_{0} p_{0} \\sin\\theta}{4\\pi r} \\exp(ikr) \\hat{\\boldsymbol{\\theta}}\n$$\nUsing the relations $k = \\omega\\sqrt{\\mu_0\\varepsilon_0}$ and $c=1/\\sqrt{\\mu_0\\varepsilon_0}$, we can write $\\omega^2\\mu_0 = k^2c^2\\mu_0 = k^2/ \\varepsilon_0$. The electric field is then:\n$$\n\\mathbf{E}(\\mathbf{r}) \\approx -\\frac{k^{2} p_{0}}{4\\pi\\varepsilon_{0}} \\frac{\\exp(ikr)}{r} \\sin\\theta\\,\\hat{\\boldsymbol{\\theta}}\n$$\nThis is the far-field electric field, which completes the first part of Task 1.\n\nFor the second part of Task 1, we find the far-field magnetic field $\\mathbf{H}(\\mathbf{r})$. In the far field, the radiated fields locally resemble a transverse electromagnetic (TEM) plane wave, for which the magnetic field is related to the electric field by $\\mathbf{H} = \\frac{1}{\\eta_{0}} \\hat{\\mathbf{r}} \\times \\mathbf{E}$, where $\\eta_{0} = \\sqrt{\\mu_{0}/\\varepsilon_{0}}$ is the free-space impedance.\n$$\n\\mathbf{H}(\\mathbf{r}) \\approx \\frac{1}{\\eta_{0}} \\hat{\\mathbf{r}} \\times \\left( -\\frac{k^{2} p_{0}}{4\\pi\\varepsilon_{0}} \\frac{\\exp(ikr)}{r} \\sin\\theta\\,\\hat{\\boldsymbol{\\theta}} \\right)\n$$\nUsing the cross product $\\hat{\\mathbf{r}} \\times \\hat{\\boldsymbol{\\theta}} = \\hat{\\boldsymbol{\\phi}}$:\n$$\n\\mathbf{H}(\\mathbf{r}) \\approx -\\frac{k^{2} p_{0}}{4\\pi\\eta_{0}\\varepsilon_{0}} \\frac{\\exp(ikr)}{r} \\sin\\theta\\,\\hat{\\boldsymbol{\\phi}}\n$$\nThe constant group can be simplified using $\\eta_0\\varepsilon_0 = \\sqrt{\\mu_0/\\varepsilon_0}\\varepsilon_0 = \\sqrt{\\mu_0\\varepsilon_0} = 1/c$.\nSo, $\\frac{k^2}{\\eta_0\\varepsilon_0} = k^2 c = k(\\omega)$.\n$$\n\\mathbf{H}(\\mathbf{r}) \\approx -\\frac{k\\omega p_{0}}{4\\pi} \\frac{\\exp(ikr)}{r} \\sin\\theta\\,\\hat{\\boldsymbol{\\phi}}\n$$\nThe expressions for $\\mathbf{E}(\\mathbf{r})$ and $\\mathbf{H}(\\mathbf{r})$ complete Task 1.\n\nFor Task 2, we derive the time-averaged radiated power per unit solid angle. This is obtained from the radial component of the time-averaged Poynting vector, $\\langle\\mathbf{S}\\rangle = \\frac{1}{2}\\text{Re}\\{\\mathbf{E} \\times \\mathbf{H}^*\\}$.\n$$\n\\mathbf{H}^*(\\mathbf{r}) \\approx -\\frac{k\\omega p_{0}^*}{4\\pi} \\frac{\\exp(-ikr)}{r} \\sin\\theta\\,\\hat{\\boldsymbol{\\phi}}\n$$\n$$\n\\mathbf{E} \\times \\mathbf{H}^* \\approx \\left( -\\frac{k^{2} p_{0}}{4\\pi\\varepsilon_{0}} \\frac{\\exp(ikr)}{r} \\sin\\theta\\,\\hat{\\boldsymbol{\\theta}} \\right) \\times \\left( -\\frac{k\\omega p_{0}^*}{4\\pi} \\frac{\\exp(-ikr)}{r} \\sin\\theta\\,\\hat{\\boldsymbol{\\phi}} \\right)\n$$\nThe minus signs cancel, and $\\exp(ikr)\\exp(-ikr)=1$. The vector cross product is $\\hat{\\boldsymbol{\\theta}} \\times \\hat{\\boldsymbol{\\phi}} = \\hat{\\mathbf{r}}$.\n$$\n\\mathbf{E} \\times \\mathbf{H}^* \\approx \\frac{k^3\\omega |p_0|^2 \\sin^2\\theta}{16\\pi^2\\varepsilon_0 r^2} \\hat{\\mathbf{r}}\n$$\nThis expression is purely real, so $\\text{Re}\\{\\mathbf{E} \\times \\mathbf{H}^*\\} = \\mathbf{E} \\times \\mathbf{H}^*$.\n$$\n\\langle\\mathbf{S}\\rangle = \\frac{1}{2} \\frac{k^3\\omega |p_0|^2 \\sin^2\\theta}{16\\pi^2\\varepsilon_0 r^2} \\hat{\\mathbf{r}} = \\frac{k^3\\omega |p_0|^2 \\sin^2\\theta}{32\\pi^2\\varepsilon_0 r^2} \\hat{\\mathbf{r}}\n$$\nTo express this in the requested variables, we substitute $k=\\omega/c$:\n$$\nk^3\\omega = (\\omega/c)^3\\omega = \\omega^4/c^3\n$$\n$$\n\\langle\\mathbf{S}\\rangle = \\frac{\\omega^4 |p_0|^2}{32\\pi^2\\varepsilon_0 c^3 r^2} \\sin^2\\theta\\,\\hat{\\mathbf{r}}\n$$\nThe time-averaged power radiated per unit solid angle, denoted $\\frac{dP_{\\text{rad}}}{d\\Omega}$, is given by $r^2$ times the magnitude of the Poynting vector:\n$$\n\\frac{dP_{\\text{rad}}}{d\\Omega} = r^2 |\\langle\\mathbf{S}\\rangle| = \\frac{\\omega^4 |p_0|^2}{32\\pi^2\\varepsilon_0 c^3} \\sin^2\\theta\n$$\nThe normalized angular radiation pattern $F(\\theta)$ is defined to be dimensionless with a maximum value of $1$. The angular dependence of the power is contained in the $\\sin^2\\theta$ term. The maximum value of $\\sin^2\\theta$ is $1$, occurring at $\\theta=\\pi/2$. Therefore, the normalized radiation pattern is:\n$$\nF(\\theta) = \\sin^2\\theta\n$$\nThis completes Task 2.\n\nFor Task 3, we find the total time-averaged radiated power $P_{\\text{rad}}$ by integrating the power per unit solid angle over all solid angles $\\Omega$. The differential solid angle is $d\\Omega = \\sin\\theta d\\theta d\\phi$.\n$$\nP_{\\text{rad}} = \\int_{\\Omega} \\frac{dP_{\\text{rad}}}{d\\Omega} d\\Omega = \\int_{0}^{2\\pi} \\int_{0}^{\\pi} \\left( \\frac{\\omega^4 |p_0|^2}{32\\pi^2\\varepsilon_0 c^3} \\sin^2\\theta \\right) \\sin\\theta d\\theta d\\phi\n$$\nThe integrand is independent of $\\phi$, so the integral over $\\phi$ yields $2\\pi$:\n$$\nP_{\\text{rad}} = \\frac{\\omega^4 |p_0|^2}{32\\pi^2\\varepsilon_0 c^3} (2\\pi) \\int_{0}^{\\pi} \\sin^3\\theta d\\theta = \\frac{\\omega^4 |p_0|^2}{16\\pi\\varepsilon_0 c^3} \\int_{0}^{\\pi} \\sin^3\\theta d\\theta\n$$\nWe evaluate the remaining integral:\n$$\n\\int_{0}^{\\pi} \\sin^3\\theta d\\theta = \\int_{0}^{\\pi} \\sin\\theta(1-\\cos^2\\theta)d\\theta\n$$\nLet $u = \\cos\\theta$, so $du = -\\sin\\theta d\\theta$. The limits of integration change from $\\theta=0 \\to u=1$ and $\\theta=\\pi \\to u=-1$.\n$$\n\\int_{0}^{\\pi} \\sin^3\\theta d\\theta = \\int_{1}^{-1} (1-u^2)(-du) = \\int_{-1}^{1} (1-u^2)du = \\left[u - \\frac{u^3}{3}\\right]_{-1}^{1}\n$$\n$$\n= \\left(1 - \\frac{1}{3}\\right) - \\left(-1 - \\frac{(-1)^3}{3}\\right) = \\frac{2}{3} - \\left(-1 + \\frac{1}{3}\\right) = \\frac{2}{3} - \\left(-\\frac{2}{3}\\right) = \\frac{4}{3}\n$$\nSubstituting this result into the expression for $P_{\\text{rad}}$:\n$$\nP_{\\text{rad}} = \\frac{\\omega^4 |p_0|^2}{16\\pi\\varepsilon_0 c^3} \\left(\\frac{4}{3}\\right) = \\frac{\\omega^4 |p_0|^2}{12\\pi\\varepsilon_0 c^3}\n$$\nThis is the total time-averaged power radiated by the dipole, expressed in terms of the required physical constants. The expression is in SI units (Watts). This completes Task 3.\n\nThe final answer consists of the pair $(F(\\theta), P_{\\text{rad}})$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n\\sin^2\\theta & \\frac{\\omega^4 |p_0|^2}{12\\pi\\varepsilon_0 c^3}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "While the dyadic Green's function provides an elegant analytical tool, its application in computational methods reveals a significant challenge: the singularity that occurs when the source and observation points coincide. This practice guides you through the theoretical derivation of a singularity subtraction scheme, a cornerstone of the Method of Moments (MoM) for solving integral equations. You will learn to decompose the dyadic kernel and use integration by parts to regularize the hypersingular terms, transforming them into forms suitable for numerical evaluation .",
            "id": "3309732",
            "problem": "Consider a perfectly electrically conducting surface in a homogeneous, isotropic, source-free region characterized by angular frequency $\\omega$, permeability $\\mu$, permittivity $\\epsilon$, and wavenumber $k = \\omega \\sqrt{\\mu \\epsilon}$. In the frequency-domain Electric Field Integral Equation (EFIE), one commonly writes the operator acting on the surface current density $\\mathbf{J}(\\mathbf{r}')$ in terms of the dyadic Green’s function $\\overline{\\overline{G}}(\\mathbf{r},\\mathbf{r}')$, where $\\mathbf{r}$ and $\\mathbf{r}'$ are position vectors on the surface, and $R = |\\mathbf{r} - \\mathbf{r}'|$. The dyadic Green’s function for the vector Helmholtz equation in free space is defined by the convolution of the scalar Helmholtz Green’s function with the Helmholtz operator and can be written as\n$$\n\\overline{\\overline{G}}(\\mathbf{r},\\mathbf{r}') = \\left( \\overline{\\overline{I}} + \\frac{1}{k^{2}} \\nabla \\nabla \\right) \\frac{\\exp(\\mathrm{i} k R)}{4 \\pi R},\n$$\nwhere $\\overline{\\overline{I}}$ is the identity dyadic and $\\nabla$ acts with respect to $\\mathbf{r}$. In a Method of Moments (MoM) Galerkin procedure with Rao–Wilton–Glisson (RWG) basis functions (piecewise linear tangential vector functions with piecewise constant surface divergence on each triangle), integrals involving $\\overline{\\overline{G}}(\\mathbf{r},\\mathbf{r}')$ are weakly to strongly singular when $\\mathbf{r}' \\to \\mathbf{r}$.\n\nStarting from the frequency-domain Maxwell equations and the definition of $\\overline{\\overline{G}}(\\mathbf{r},\\mathbf{r}')$ above, analyze the local singularity structure as $R \\to 0$ by systematically expanding the scalar kernel and by classifying the singularities arising from the dyadic operator $\\overline{\\overline{I}} + \\frac{1}{k^{2}} \\nabla \\nabla$. Then, construct a singularity subtraction scheme that renders all element-wise Galerkin-tested integrals with RWG basis and testing functions weakly singular at worst, and thus numerically integrable with standard singular quadrature (such as the Duffy transformation), by:\n\n- Decomposing the scalar kernel into a singular static part and a regular remainder.\n- Using integration by parts to recast hypersingular contributions into weakly singular forms involving the surface divergence of RWG functions, and\n- Identifying a closed-form analytic expression for the regularized dyadic kernel that must be integrated numerically.\n\nProvide the final regularized dyadic kernel as a single closed-form analytic expression in terms of $k$, $R$, $\\overline{\\overline{I}}$, and differential operators, suitable for direct use in Galerkin-tested MoM with RWG functions. No numerical evaluation is required.",
            "solution": "The problem requires the derivation of a regularized dyadic kernel for use in a Galerkin-tested Method of Moments (MoM) solution of the Electric Field Integral Equation (EFIE). The regularization procedure must handle the singularities that arise in the dyadic Green's function as the source and observation points coincide.\n\nThe starting point is the dyadic Green's function for the vector Helmholtz equation provided in the problem statement:\n$$\n\\overline{\\overline{G}}(\\mathbf{r},\\mathbf{r}') = \\left( \\overline{\\overline{I}} + \\frac{1}{k^{2}} \\nabla \\nabla \\right) G_s(R)\n$$\nwhere $G_s(R) = \\frac{\\exp(\\mathrm{i} k R)}{4 \\pi R}$ is the scalar Helmholtz Green's function, $R = |\\mathbf{r} - \\mathbf{r}'|$, $\\overline{\\overline{I}}$ is the identity dyadic, and $\\nabla$ is the gradient operator with respect to the observation coordinates $\\mathbf{r}$.\n\nThe singularities in $\\overline{\\overline{G}}$ as $R \\to 0$ are analyzed by examining the behavior of its constituent terms. The scalar Green's function $G_s(R)$ has a singularity of order $O(R^{-1})$. When integrated over a two-dimensional surface element, this leads to a weakly singular integral, which is integrable. The second term involves the operator $\\nabla \\nabla$. The derivatives of $G_s(R)$ behave as:\n$$\n\\nabla G_s(R) \\sim O(R^{-2})\n$$\n$$\n\\nabla \\nabla G_s(R) \\sim O(R^{-3})\n$$\nThe $O(R^{-3})$ behavior is termed a hypersingularity. A surface integral involving such a term is divergent and cannot be computed numerically using standard quadrature rules. The goal of a singularity subtraction scheme is to reformulate the problem to avoid the direct integration of this hypersingular term.\n\nThe procedure, as outlined in the problem, involves three main steps.\n\n**Step 1: Decomposition of the Scalar Kernel**\n\nWe decompose the scalar Green's function $G_s(R)$ into a singular static part and a regular remainder. The static part corresponds to the case where the wavenumber $k \\to 0$, which is the Green's function for the Laplace equation, $G_0(R)$.\n$$\nG_s(R) = G_0(R) + G_{rem}(R)\n$$\nwhere:\n- The singular static part is $G_0(R) = \\frac{1}{4 \\pi R}$.\n- The regular remainder is $G_{rem}(R) = G_s(R) - G_0(R) = \\frac{\\exp(\\mathrm{i} k R) - 1}{4 \\pi R}$.\n\nThe remainder term $G_{rem}(R)$ is regular (i.e., finite and smooth) as $R \\to 0$. This can be shown by a Taylor series expansion of the exponential term:\n$$\n\\exp(\\mathrm{i} k R) = 1 + \\mathrm{i} k R + \\frac{(\\mathrm{i} k R)^2}{2!} + \\dots\n$$\n$$\nG_{rem}(R) = \\frac{(1 + \\mathrm{i} k R + O(R^2)) - 1}{4 \\pi R} = \\frac{\\mathrm{i} k}{4 \\pi} + O(R)\n$$\nAs $R \\to 0$, $G_{rem}(R)$ approaches the constant value $\\frac{\\mathrm{i} k}{4 \\pi}$. All derivatives of $G_{rem}(R)$ with respect to $R$ are also regular as $R \\to 0$.\n\nBy substituting this decomposition into the expression for $\\overline{\\overline{G}}$, we can split the dyadic kernel into a singular part and a regular part:\n$$\n\\overline{\\overline{G}} = \\left( \\overline{\\overline{I}} + \\frac{1}{k^{2}} \\nabla \\nabla \\right) (G_0(R) + G_{rem}(R)) = \\overline{\\overline{G}}_{sing} + \\overline{\\overline{G}}_{reg}\n$$\nwhere:\n- The singular dyadic kernel is $\\overline{\\overline{G}}_{sing} = \\left( \\overline{\\overline{I}} + \\frac{1}{k^{2}} \\nabla \\nabla \\right) G_0(R)$.\n- The regular dyadic kernel is $\\overline{\\overline{G}}_{reg} = \\left( \\overline{\\overline{I}} + \\frac{1}{k^{2}} \\nabla \\nabla \\right) G_{rem}(R)$.\n\nThe regular kernel $\\overline{\\overline{G}}_{reg}$ is well-behaved for all $R$ and can be integrated numerically using standard quadrature methods. The singular kernel $\\overline{\\overline{G}}_{sing}$ contains all the problematic singularities and requires special treatment.\n\n**Step 2: Regularization of the Singular Part via Integration by Parts**\n\nIn a Galerkin procedure, we evaluate matrix elements of the form $\\langle \\mathbf{f}_m, \\mathcal{L} \\mathbf{f}_n \\rangle$, where $\\mathbf{f}_m$ and $\\mathbf{f}_n$ are testing and basis functions (here, RWG functions), and $\\mathcal{L}$ is the integral operator. The integral involving the hypersingular part of $\\overline{\\overline{G}}_{sing}$ is:\n$$\nI_{hyper} = \\frac{1}{k^2} \\int_S \\mathbf{f}_m(\\mathbf{r}) \\cdot \\left( \\int_{S'} (\\nabla \\nabla G_0(\\mathbf{r}, \\mathbf{r}')) \\cdot \\mathbf{f}_n(\\mathbf{r}') dS' \\right) dS\n$$\nThis integral can be regularized by transferring derivatives from the Green's function to the basis and testing functions using the surface divergence theorem (a form of Green's identity or integration by parts on a surface). The identity for tangential vector fields $\\mathbf{F}$ and scalar fields $\\phi$ on a surface $S$ is $\\int_S \\mathbf{F} \\cdot \\nabla_s \\phi \\, dS = - \\int_S (\\nabla_s \\cdot \\mathbf{F}) \\phi \\, dS$, assuming $\\mathbf{F}$ vanishes on the boundary of $S$. Applying this identity twice yields:\n$$\n\\int_S \\mathbf{f}_m \\cdot (\\nabla (\\nabla \\cdot \\mathbf{A})) dS = - \\int_S (\\nabla_s \\cdot \\mathbf{f}_m) (\\nabla \\cdot \\mathbf{A}) dS\n$$\nand\n$$\n\\int_{S'} (\\nabla' G_0) \\cdot \\mathbf{f}_n dS' = - \\int_{S'} G_0 (\\nabla'_s \\cdot \\mathbf{f}_n) dS'\n$$\nCombining these results, we can rewrite the hypersingular integral as:\n$$\nI_{hyper} = - \\frac{1}{k^2} \\int_S \\int_{S'} (\\nabla_s \\cdot \\mathbf{f}_m(\\mathbf{r})) G_0(R) (\\nabla'_s \\cdot \\mathbf{f}_n(\\mathbf{r}')) dS' dS\n$$\nThis transformed integral is only weakly singular because the kernel is now $G_0(R) \\sim O(R^{-1})$. For RWG basis functions, the surface divergence $\\nabla_s \\cdot \\mathbf{f}$ is piecewise constant, which makes this form particularly suitable for analytical or specialized numerical integration.\n\nThe integral of the full singular part $\\overline{\\overline{G}}_{sing}$ is therefore computed as:\n$$\n\\langle \\mathbf{f}_m, \\int \\overline{\\overline{G}}_{sing} \\cdot \\mathbf{f}_n dS' \\rangle = \\int_S \\int_{S'} G_0(R) (\\mathbf{f}_m \\cdot \\mathbf{f}_n) dS' dS - \\frac{1}{k^2} \\int_S \\int_{S'} (\\nabla_s \\cdot \\mathbf{f}_m) G_0(R) (\\nabla'_s \\cdot \\mathbf{f}_n) dS' dS\n$$\nBoth integrals on the right-hand side are weakly singular and are typically evaluated analytically or with special quadrature for coincident triangular elements.\n\n**Step 3: Identification of the Regularized Kernel for Numerical Integration**\n\nThe overall computational scheme involves splitting the total matrix element calculation into two parts:\n1.  An analytical or specialized evaluation of the integrals involving the singular static kernel, $G_0(R)$, using the regularized formulation derived in Step 2.\n2.  A standard numerical quadrature of the integral involving the regular kernel, $\\overline{\\overline{G}}_{reg}$.\n\nThe problem asks to identify the \"regularized dyadic kernel that must be integrated numerically\". This corresponds to the regular part of the full dyadic Green's function, which we have identified as $\\overline{\\overline{G}}_{reg}$. Its integrand is completely regular, making it suitable for direct numerical integration.\n\nTherefore, the closed-form analytic expression for the regularized dyadic kernel to be used in the numerical integration part of the scheme is:\n$$\n\\overline{\\overline{K}}_{num} = \\overline{\\overline{G}}_{reg} = \\left( \\overline{\\overline{I}} + \\frac{1}{k^{2}} \\nabla \\nabla \\right) G_{rem}(R)\n$$\nSubstituting the expression for $G_{rem}(R)$, we obtain the final form.",
            "answer": "$$\n\\boxed{\\left( \\overline{\\overline{I}} + \\frac{1}{k^{2}} \\nabla \\nabla \\right) \\left( \\frac{\\exp(\\mathrm{i} k R) - 1}{4 \\pi R} \\right)}\n$$"
        },
        {
            "introduction": "Building directly on the previous theoretical exercise, this practice transitions from derivation to implementation. You will develop a numerical scheme to compute the electric field from a volume current source, putting the singularity subtraction technique into practice within a discrete grid. This hands-on coding problem illustrates how to manage the singular kernel by subtracting its quasistatic part, integrating the now-regular remainder numerically, and adding back the analytically derived \"self-term\" correction, a crucial step for accurate field evaluation inside a source region .",
            "id": "3303052",
            "problem": "You are to design and implement a numerical scheme for evaluating the frequency-domain electric field generated by a volume current distribution in free space via a dyadic Green's function, using singularity subtraction by adding and subtracting a quasistatic kernel. The computation must be based on first principles of electromagnetics and fundamental definitions of Green's functions.\n\nThe foundational base from which you must derive your approach includes:\n- Maxwell's equations in the frequency domain with time dependence $e^{+i \\omega t}$, the constitutive relations in free space, and the wavenumber definition $k = \\omega \\sqrt{\\mu_0 \\epsilon_0}$.\n- The scalar free-space Helmholtz Green's function $G_0(\\mathbf{r},\\mathbf{r}') = \\dfrac{e^{i k |\\mathbf{r} - \\mathbf{r}'|}}{4 \\pi |\\mathbf{r} - \\mathbf{r}'|}$.\n- The dyadic Green's representation of the electric field due to an electric current density $\\mathbf{J}(\\mathbf{r}')$,\n  $$ \\mathbf{E}(\\mathbf{r}) = i \\omega \\mu_0 \\int_{\\mathbb{R}^3} \\left[ \\mathbf{I} + \\frac{1}{k^2} \\nabla \\nabla \\right] G_0(\\mathbf{r},\\mathbf{r}') \\cdot \\mathbf{J}(\\mathbf{r}') \\, d\\mathbf{r}' , $$\n  where $\\mathbf{I}$ is the identity dyadic and $\\nabla$ acts on $\\mathbf{r}$.\n- The decomposition of $\\nabla \\nabla f(|\\mathbf{r}-\\mathbf{r}'|)$ for a radial function $f$ into components along $\\hat{\\mathbf{R}} \\hat{\\mathbf{R}}$ and $\\mathbf{I} - \\hat{\\mathbf{R}} \\hat{\\mathbf{R}}$, where $\\mathbf{R} = \\mathbf{r} - \\mathbf{r}'$ and $\\hat{\\mathbf{R}} = \\mathbf{R}/|\\mathbf{R}|$.\n- The quasistatic kernel obtained by taking the limit $k \\to 0$ of the singular part, and the distributional identity for the Hessian of the Coulomb potential,\n  $$ \\nabla \\nabla \\left(\\frac{1}{R}\\right) = \\operatorname{PV}\\left[\\frac{3 \\hat{\\mathbf{R}} \\hat{\\mathbf{R}} - \\mathbf{I}}{R^3}\\right] - \\frac{4 \\pi}{3} \\mathbf{I} \\, \\delta(\\mathbf{R}), $$\n  where $\\operatorname{PV}$ denotes the Cauchy principal value.\n\nYour task is to:\n- Derive an explicit algorithmic form for the dyadic kernel acting on $\\mathbf{J}$ that is suitable for numerical evaluation on a discrete grid, starting from the above fundamental base and without invoking shortcut formulas that bypass the derivation.\n- Implement singularity subtraction by adding and subtracting the quasistatic kernel inside a small spherical neighborhood around the singularity ($\\mathbf{r} = \\mathbf{r}'$), and add back the analytically integrable delta-function self-term. Explicitly, the analytic correction due to the quasistatic kernel should be included as a local \"self-term\" proportional to $-\\mathbf{J}(\\mathbf{r})/(3k^2)$, multiplied by the appropriate physical prefactor for $\\mathbf{E}(\\mathbf{r})$.\n\nNumerical setup:\n- Consider a uniform current density $\\mathbf{J}(\\mathbf{r}') = J_0 \\, \\hat{\\mathbf{x}}$ within a finite cubic domain of side length $a$ centered at the origin, and zero outside. The cube is discretized uniformly with $N$ points per side, spacing $\\Delta = a/(N-1)$, and numerical integration is performed by summation of the kernel over grid cells.\n- The observation point $\\mathbf{r}$ may be inside or outside the cube. When $\\mathbf{r}$ is inside, perform singularity subtraction by excluding a ball of radius $R_0$ around $\\mathbf{r}$ for the quasistatic part (use $R_0 = 2 \\Delta$), numerically integrating the regularized kernel in that ball, and adding back the analytic self-term implied by the distributional identity. When $\\mathbf{r}$ is outside, no subtraction is required.\n- Use the vacuum constants $\\mu_0 = 4 \\pi \\times 10^{-7} \\, \\mathrm{H/m}$ and $c = 299{,}792{,}458 \\, \\mathrm{m/s}$, with $\\epsilon_0 = 1/(\\mu_0 c^2)$. The wavenumber is $k = \\omega/c$ where $\\omega = 2 \\pi f$.\n\nYour program must compute the magnitude of the electric field $|\\mathbf{E}(\\mathbf{r})|$ in volt per meter (V/m) for the following test suite of three cases, each specified by $(a, N, f, J_0, \\mathbf{r})$:\n1. Case A (general internal point with subtraction):\n   - $a = 0.2 \\, \\mathrm{m}$, $N = 41$, $f = 1.0 \\times 10^8 \\, \\mathrm{Hz}$, $J_0 = 1.0 \\, \\mathrm{A/m^2}$, $\\mathbf{r} = (0,0,0) \\, \\mathrm{m}$. The observation point is inside the cube. Apply singularity subtraction with $R_0 = 2 \\Delta$.\n2. Case B (external point without subtraction):\n   - $a = 0.2 \\, \\mathrm{m}$, $N = 41$, $f = 1.0 \\times 10^8 \\, \\mathrm{Hz}$, $J_0 = 1.0 \\, \\mathrm{A/m^2}$, $\\mathbf{r} = (0,0,1.0) \\, \\mathrm{m}$. The observation point is outside the cube. Do not apply subtraction.\n3. Case C (near-quasistatic internal point with subtraction):\n   - $a = 0.2 \\, \\mathrm{m}$, $N = 41$, $f = 1.0 \\times 10^6 \\, \\mathrm{Hz}$, $J_0 = 1.0 \\, \\mathrm{A/m^2}$, $\\mathbf{r} = (0,0,0) \\, \\mathrm{m}$. The observation point is inside the cube. Apply singularity subtraction with $R_0 = 2 \\Delta$.\n\nAngle units are not involved. Physical units: report magnitudes in volt per meter (V/m) as decimal floats.\n\nYour program should produce a single line of output containing the three results as a comma-separated list enclosed in square brackets, in the order [Case A, Case B, Case C], for example, \"[x_A,x_B,x_C]\". Each entry must be a float representing $|\\mathbf{E}(\\mathbf{r})|$ in V/m.\n\nYour implementation must be fully self-contained, must not require user input or external files, and must run as-is. All numerical steps and any constants used must be clearly defined within the program.",
            "solution": "The problem requires the design and implementation of a numerical scheme to compute the electric field $\\mathbf{E}(\\mathbf{r})$ generated by a volume current density $\\mathbf{J}(\\mathbf{r}')$. The method is based on the dyadic Green's function formalism and employs singularity subtraction to handle the kernel's singular behavior when the observation point $\\mathbf{r}$ is inside the source region.\n\n### 1. Theoretical Formulation\n\nThe electric field $\\mathbf{E}(\\mathbf{r})$ in the frequency domain (assuming $e^{+i\\omega t}$ time dependence) due to a current density $\\mathbf{J}(\\mathbf{r}')$ in free space is given by the volume integral equation:\n$$\n\\mathbf{E}(\\mathbf{r}) = \\int_{V'} \\overline{\\overline{K}}(\\mathbf{r}, \\mathbf{r}') \\cdot \\mathbf{J}(\\mathbf{r}') \\, dV'\n$$\nwhere $V'$ is the source volume and $\\overline{\\overline{K}}(\\mathbf{r}, \\mathbf{r}')$ is the electric field kernel. The kernel is related to the dyadic Green's function $\\overline{\\overline{G}}_E$ by $\\overline{\\overline{K}} = i \\omega \\mu_0 \\overline{\\overline{G}}_E$. The dyadic Green's function is given as:\n$$\n\\overline{\\overline{G}}_E(\\mathbf{r}, \\mathbf{r}') = \\left[ \\mathbf{I} + \\frac{1}{k^2} \\nabla \\nabla \\right] G_0(\\mathbf{r},\\mathbf{r}')\n$$\nHere, $\\mathbf{I}$ is the identity dyadic, $k = \\omega/c$ is the wavenumber in free space, $\\nabla$ operates on the observation coordinates $\\mathbf{r}$, and $G_0(\\mathbf{r},\\mathbf{r}')$ is the scalar free-space Helmholtz Green's function:\n$$\nG_0(\\mathbf{r}, \\mathbf{r}') = \\frac{e^{ikR}}{4\\pi R}\n$$\nwith $\\mathbf{R} = \\mathbf{r} - \\mathbf{r}'$ and $R = |\\mathbf{R}|$.\n\nThe primary challenge in evaluating the integral is the singular nature of the kernel as $R \\to 0$. The term $\\nabla\\nabla G_0$ contains a non-integrable (strong) singularity of order $O(1/R^3)$.\n\n### 2. Derivation of the Dyadic Kernel\n\nTo derive an explicit form for the kernel, we must evaluate the Hessian $\\nabla \\nabla G_0(R)$. For a general radial function $f(R)$, the Hessian can be expressed as:\n$$\n\\nabla \\nabla f(R) = \\left( \\frac{d^2f}{dR^2} - \\frac{1}{R}\\frac{df}{dR} \\right) \\hat{\\mathbf{R}}\\hat{\\mathbf{R}} + \\frac{1}{R}\\frac{df}{dR} \\mathbf{I}\n$$\nwhere $\\hat{\\mathbf{R}} = \\mathbf{R}/R$. For $f(R) = G_0(R) = \\frac{e^{ikR}}{4\\pi R}$, the derivatives are:\n$$\n\\frac{dG_0}{dR} = \\frac{e^{ikR}}{4\\pi} \\left( \\frac{ik}{R} - \\frac{1}{R^2} \\right)\n$$\n$$\n\\frac{d^2G_0}{dR^2} = \\frac{e^{ikR}}{4\\pi} \\left( \\frac{-k^2}{R} - \\frac{2ik}{R^2} + \\frac{2}{R^3} \\right)\n$$\nSubstituting these into the Hessian formula yields:\n$$\n\\nabla \\nabla G_0(R) = \\frac{e^{ikR}}{4\\pi R^3} \\left[ (-k^2R^2 - 3ikR + 3) \\hat{\\mathbf{R}}\\hat{\\mathbf{R}} + (ikR - 1) \\mathbf{I} \\right]\n$$\nThe full kernel $\\overline{\\overline{K}} = i\\omega\\mu_0 (\\mathbf{I} G_0 + \\frac{1}{k^2}\\nabla\\nabla G_0)$ can then be written as:\n$$\n\\overline{\\overline{K}}(\\mathbf{R}) = \\frac{i\\omega\\mu_0 e^{ikR}}{4\\pi k^2 R^3} \\left[ (k^2R^2+ikR-1)\\mathbf{I} + (-k^2R^2-3ikR+3)\\hat{\\mathbf{R}}\\hat{\\mathbf{R}} \\right]\n$$\nAs $R \\to 0$, the terms proportional to $3\\hat{\\mathbf{R}}\\hat{\\mathbf{R}}/R^3$ and $-\\mathbf{I}/R^3$ dominate, exhibiting the strong $O(1/R^3)$ singularity.\n\n### 3. Singularity Subtraction\n\nTo handle this singularity, we subtract and add a quasistatic kernel. The singular behavior of $\\nabla\\nabla G_0$ as $R \\to 0$ mirrors that of the simpler electrostatic potential $1/R$. The problem provides the distributional identity for the Hessian of the Coulomb potential:\n$$\n\\nabla \\nabla \\left(\\frac{1}{R}\\right) = \\operatorname{PV}\\left[\\frac{3 \\hat{\\mathbf{R}} \\hat{\\mathbf{R}} - \\mathbf{I}}{R^3}\\right] - \\frac{4 \\pi}{3} \\mathbf{I} \\, \\delta(\\mathbf{R})\n$$\nwhere $\\operatorname{PV}$ denotes the Cauchy Principal Value. The quasistatic part of the kernel, responsible for the strong singularity, is defined as:\n$$\n\\overline{\\overline{K}}_{\\text{qs,PV}}(\\mathbf{R}) = \\frac{i\\omega\\mu_0}{k^2} \\operatorname{PV}\\left[\\nabla\\nabla\\left(\\frac{1}{4\\pi R}\\right)\\right] = \\frac{i\\omega\\mu_0}{4\\pi k^2} \\operatorname{PV}\\left[\\frac{3 \\hat{\\mathbf{R}} \\hat{\\mathbf{R}} - \\mathbf{I}}{R^3}\\right]\n$$\nThe integral for $\\mathbf{E}(\\mathbf{r})$ is rewritten by adding and subtracting this quasistatic kernel and isolating the delta-function contribution:\n$$\n\\mathbf{E}(\\mathbf{r}) = \\int_{V'} \\left( \\overline{\\overline{K}}(\\mathbf{R}) - \\overline{\\overline{K}}_{\\text{qs,PV}}(\\mathbf{R}) \\right) \\cdot \\mathbf{J}(\\mathbf{r}') \\, dV' + \\operatorname{PV} \\int_{V'} \\overline{\\overline{K}}_{\\text{qs,PV}}(\\mathbf{R}) \\cdot \\mathbf{J}(\\mathbf{r}') \\, dV' + \\mathbf{E}_{\\text{self}}\n$$\nThe \"self-term\" $\\mathbf{E}_{\\text{self}}$ arises from the delta function part of the identity:\n$$\n\\mathbf{E}_{\\text{self}} = \\int_{V'} \\frac{i\\omega\\mu_0}{k^2} \\left(-\\frac{1}{3}\\mathbf{I}\\delta(\\mathbf{R})\\right) \\cdot \\mathbf{J}(\\mathbf{r}') \\, dV' = -\\frac{i\\omega\\mu_0}{3k^2} \\mathbf{J}(\\mathbf{r})\n$$\nThe remaining kernel, $\\overline{\\overline{K}}_{\\text{reg}}(\\mathbf{R}) = \\overline{\\overline{K}}(\\mathbf{R}) - \\overline{\\overline{K}}_{\\text{qs,PV}}(\\mathbf{R})$, is regularized. While it still weakly diverges as $O(1/R)$, this singularity is integrable, allowing for direct numerical summation.\n\n### 4. Numerical Algorithm\n\nFollowing the problem's prescription, for an observation point $\\mathbf{r}$ inside the source volume, we partition the numerical integration domain.\n1.  **Outside the subtraction ball ($R > R_0$)**: The full kernel $\\overline{\\overline{K}}(\\mathbf{R})$ is used. The integrand is well-behaved.\n2.  **Inside the subtraction ball ($0 < R \\le R_0$)**: The regularized kernel $\\overline{\\overline{K}}_{\\text{reg}}(\\mathbf{R}) = \\overline{\\overline{K}}(\\mathbf{R}) - \\overline{\\overline{K}}_{\\text{qs,PV}}(\\mathbf{R})$ is used for numerical integration. This avoids the strong singularity.\n3.  **Analytical Correction**: The contribution of the subtracted term, $\\int_{V' \\cap B_{R_0}} \\overline{\\overline{K}}_{\\text{qs,PV}} \\cdot \\mathbf{J}' dV'$, where $B_{R_0}$ is the ball of radius $R_0$, is handled analytically. For a spherical region and constant $\\mathbf{J}$, the principal value integral is zero by symmetry. The delta-function contribution is added back as the self-term $\\mathbf{E}_{\\text{self}}$.\n\nThe discretized computation for an internal point $\\mathbf{r}$ is:\n$$\n\\mathbf{E}(\\mathbf{r}) \\approx \\sum_{\\mathbf{r}'_i, |\\mathbf{R}_i| > R_0} \\overline{\\overline{K}}(\\mathbf{R}_i) \\cdot \\mathbf{J}(\\mathbf{r}'_i)\n\\Delta V + \\sum_{\\mathbf{r}'_i, 0 < |\\mathbf{R}_i| \\le R_0} \\overline{\\overline{K}}_{\\text{reg}}(\\mathbf{R}_i) \\cdot \\mathbf{J}(\\mathbf{r}'_i) \\Delta V + \\mathbf{E}_{\\text{self}}\n$$\nwhere $\\Delta V = (a/(N-1))^3$ is the volume of a grid cell. For an external point, $R$ is never zero, so no subtraction is needed and only the full kernel $\\overline{\\overline{K}}$ is used for all source cells.\n\nThe kernel-vector product can be expressed as $\\overline{\\overline{K}}\\cdot\\mathbf{J} = (\\alpha \\mathbf{I} + \\beta \\hat{\\mathbf{R}}\\hat{\\mathbf{R}}) \\cdot \\mathbf{J} = \\alpha \\mathbf{J} + \\beta(\\hat{\\mathbf{R}}\\cdot\\mathbf{J})\\hat{\\mathbf{R}}$. The coefficients for the full kernel are:\n$$\n\\alpha_{\\text{full}} = \\frac{i\\omega\\mu_0 e^{ikR}}{4\\pi k^2 R^3} (k^2R^2+ikR-1)\n$$\n$$\n\\beta_{\\text{full}} = \\frac{i\\omega\\mu_0 e^{ikR}}{4\\pi k^2 R^3} (-k^2R^2-3ikR+3)\n$$\nThe coefficients for the quasistatic part are:\n$$\n\\alpha_{\\text{qs}} = \\frac{i\\omega\\mu_0}{4\\pi k^2 R^3} (-1)\n$$\n$$\n\\beta_{\\text{qs}} = \\frac{i\\omega\\mu_0}{4\\pi k^2 R^3} (3)\n$$\nThe numerical implementation will use $\\alpha_{\\text{reg}} = \\alpha_{\\text{full}} - \\alpha_{\\text{qs}}$ and $\\beta_{\\text{reg}} = \\beta_{\\text{full}} - \\beta_{\\text{qs}}$ inside the subtraction radius $R_0$.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the electric field from a volume current source using a dyadic Green's function\n    with singularity subtraction.\n    \"\"\"\n    # Define physical constants\n    MU0 = 4 * np.pi * 1e-7  # Vacuum permeability (H/m)\n    C = 299792458.0         # Speed of light in vacuum (m/s)\n    EPS0 = 1 / (MU0 * C**2)  # Vacuum permittivity (F/m)\n\n    test_cases = [\n        # Case A: (a, N, f, J0, r_obs) - Internal point\n        (0.2, 41, 1.0e8, 1.0, np.array([0.0, 0.0, 0.0])),\n        # Case B: (a, N, f, J0, r_obs) - External point\n        (0.2, 41, 1.0e8, 1.0, np.array([0.0, 0.0, 1.0])),\n        # Case C: (a, N, f, J0, r_obs) - Near-quasistatic internal point\n        (0.2, 41, 1.0e6, 1.0, np.array([0.0, 0.0, 0.0])),\n    ]\n\n    results = []\n    for case in test_cases:\n        a, N, f, J0, r_obs = case\n\n        # Derived parameters\n        omega = 2 * np.pi * f\n        k = omega / C\n        delta = a / (N - 1)\n        dV = delta**3\n        R0 = 2 * delta\n        \n        # Current density vector\n        J_vec = np.array([J0, 0.0, 0.0], dtype=complex)\n        \n        # Grid setup for the source cube\n        half_width = a / 2.0\n        grid_coords = np.linspace(-half_width, half_width, N)\n        \n        E_total = np.array([0.0, 0.0, 0.0], dtype=complex)\n\n        # Check if observation point is inside the source volume\n        is_internal = np.all(np.abs(r_obs) = half_width + 1e-9)\n\n        # Numerical integration over the source volume\n        for x_p in grid_coords:\n            for y_p in grid_coords:\n                for z_p in grid_coords:\n                    r_prime = np.array([x_p, y_p, z_p])\n                    \n                    R_vec = r_obs - r_prime\n                    R = np.linalg.norm(R_vec)\n                    \n                    # Skip the singularity point r = r' itself. It is handled by the self-term.\n                    if R  1e-12:\n                        continue\n                    \n                    R_hat = R_vec / R\n                    \n                    # Select kernel based on position (internal/external point) and distance\n                    use_regularized_kernel = is_internal and R = R0\n                    \n                    if use_regularized_kernel:\n                        # Regularized kernel: K_full - K_qs\n                        # Numerically more stable to compute (K_full - K_qs) directly\n                        # Full kernel coeffients\n                        exp_ikR = np.exp(1j * k * R)\n                        \n                        common_factor_full = 1j * omega * MU0 * exp_ikR / (4 * np.pi * k**2 * R**3)\n                        alpha_full = common_factor_full * (k**2 * R**2 + 1j * k * R - 1)\n                        beta_full = common_factor_full * (-k**2 * R**2 - 3j * k * R + 3)\n                        \n                        # Quasistatic kernel coefficients\n                        common_factor_qs = 1j * omega * MU0 / (4 * np.pi * k**2 * R**3)\n                        alpha_qs = common_factor_qs * (-1)\n                        beta_qs = common_factor_qs * (3)\n                        \n                        alpha = alpha_full - alpha_qs\n                        beta = beta_full - beta_qs\n                    else:\n                        # Full kernel\n                        exp_ikR = np.exp(1j * k * R)\n                        \n                        common_factor = 1j * omega * MU0 * exp_ikR / (4 * np.pi * k**2 * R**3)\n                        alpha = common_factor * (k**2 * R**2 + 1j * k * R - 1)\n                        beta = common_factor * (-k**2 * R**2 - 3j * k * R + 3)\n                        \n                    # Calculate contribution from this source cell\n                    Rhat_dot_J = np.dot(R_hat, J_vec)\n                    dE = (alpha * J_vec + beta * Rhat_dot_J * R_hat) * dV\n                    E_total += dE\n                    \n        # Add the analytical self-term for internal points\n        if is_internal:\n            # E_self = - (1j * omega * MU0) / (3 * k**2) * J_vec\n            # This can also be written as -1j / (3 * omega * EPS0) * J_vec\n            J_at_r_obs = np.array([J0, 0.0, 0.0], dtype=complex)\n            E_self = -1j / (3 * omega * EPS0) * J_at_r_obs\n            E_total += E_self\n\n        # Calculate the magnitude of the total electric field\n        E_magnitude = np.linalg.norm(E_total)\n        results.append(E_magnitude)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}