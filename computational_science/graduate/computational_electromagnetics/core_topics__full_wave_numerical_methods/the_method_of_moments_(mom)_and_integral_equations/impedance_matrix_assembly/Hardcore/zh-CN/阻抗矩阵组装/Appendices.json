{
    "hands_on_practices": [
        {
            "introduction": "阻抗矩阵装配的核心在于精确计算定义其元素的双重积分。由于积分核存在奇异性和振荡行为，尤其是在源和场点彼此靠近或相距很远时，这一计算过程充满挑战。本实践练习 () 将指导您构建一个自适应求积选择器，这是任何稳健的矩量法 (Method of Moments) 代码中都至关重要的组成部分，它能根据单元间的几何关系动态选择最合适的数值积分方案。",
            "id": "3317213",
            "problem": "考虑在计算电磁学的面积分方程公式中组装阻抗矩阵。设基函数支撑区域 $S_m$ 和 $S_n$ 之间的阻抗矩阵项由一个标量核函数在两个平面矩形上的面积分定义，即在每个矩形单元上使用脉冲（常数）基函数。该积分为一个在 $S_m$ 和 $S_n$ 上的双重面积分，其核函数捕捉了物理特性。一个示例核函数是亥姆霍兹方程的自由空间标量格林函数，$G(\\mathbf r,\\mathbf r') = \\dfrac{e^{-j k \\lvert \\mathbf r - \\mathbf r' \\rvert}}{4\\pi \\lvert \\mathbf r - \\mathbf r' \\rvert}$，其中 $k$ 是波数，$j$ 是虚数单位。阻抗矩阵项 $Z_{mn}$ 具有如下结构\n$$\nZ_{mn} \\propto \\int_{S_m} \\int_{S_n} G(\\mathbf r,\\mathbf r') \\,\\mathrm dS(\\mathbf r) \\,\\mathrm dS(\\mathbf r').\n$$\n对于平面内矩形上的常数基函数，当矩形彼此靠近时，被积函数表现出近奇异行为；当它们在同一单元内重合（即 $\\mathbf r = \\mathbf r'$）时，被积函数是奇异的；当 $k$ 很大时，它可能是振荡的。准确高效的数值计算需要选择一种适应相互作用区域的求积法则。\n\n您必须设计并实现一个自适应求积选择器，该选择器在给定两个位于 $z=0$ 平面内的轴对齐平面矩形单元 $S_m$ 和 $S_n$（其中心分别为 $(x_m,y_m)$ 和 $(x_n,y_n)$（单位：米），边长分别为 $(a_m,b_m)$ 和 $(a_n,b_n)$（单位：米）），以及一个波数 $k$（单位：弧度/米）的情况下，选择一个求积法则标识符以及沿局部 $x$ 和 $y$ 方向的推荐张量积求积阶数。该选择器必须使用邻近度量\n$$\nR_{\\min} = \\min_{\\mathbf r \\in S_m,\\ \\mathbf r' \\in S_n} \\lvert \\mathbf r - \\mathbf r' \\rvert,\n$$\n以及纵横比\n$$\n\\mathrm{AR}_m = \\frac{\\max(a_m,b_m)}{\\min(a_m,b_m)},\\quad \\mathrm{AR}_n = \\frac{\\max(a_n,b_n)}{\\min(a_n,b_n)},\\quad \\mathrm{AR}_{\\mathrm{avg}} = \\frac{\\mathrm{AR}_m + \\mathrm{AR}_n}{2}.\n$$\n为每个矩形定义一个特征长度\n$$\nL_m = \\sqrt{a_m b_m},\\quad L_n = \\sqrt{a_n b_n},\\quad L_{\\min} = \\min(L_m,L_n).\n$$\n定义无量纲度量\n$$\n\\chi = \\frac{R_{\\min}}{L_{\\min}},\\qquad \\eta = k\\, R_{\\min}.\n$$\n您的选择器必须生成一个整数求积法则标识符 $r \\in \\{0,1,2,3\\}$ 和两个正整数 $(N_x,N_y)$，分别表示用于张量积求积时，沿矩形局部 $x$ 和 $y$ 方向的推荐点数。从 $(\\chi,\\eta,\\mathrm{AR}_{\\mathrm{avg}})$ 到 $(r,N_x,N_y)$ 的映射必须根据关于核函数行为的第一性原理构建：\n\n- 对于远场相互作用，核函数在一对矩形上是光滑的，使用标准的中等阶数张量积 Gauss–Legendre 法则即可，但阶数应随振荡参数 $\\eta$ 的增大而增加，以解析相位。\n- 对于中等距离相互作用，核函数梯度增大，张量积 Gauss–Legendre 法则需要更高的阶数；需同时考虑 $\\eta$ 和 $\\mathrm{AR}_{\\mathrm{avg}}$。\n- 对于近场相互作用（包括 $R_{\\min} = 0$ 的接触矩形），使用专门的近奇异积分方法（例如，Duffy 或极坐标变换）。尽管您只做选择，但推荐的阶数应反映出难度的增加，即随 $\\mathrm{AR}_{\\mathrm{avg}}$ 的增大和 $\\chi \\to 0$ 而增长。\n- 对于自相互作用（$S_m$ 和 $S_n$ 相同），推荐使用专门的自项法则，其阶数较高且随 $\\mathrm{AR}_{\\mathrm{avg}}$ 的增大而增长。\n\n为了使选择器在数值上良定，采用以下基于上述原理的分类阈值和阶数公式。设 $\\varepsilon$ 为一个小的正常数以避免除以零：\n- 如果矩形相同（中心和边长在严格容差范围内相同），则设 $r=3$，基准标量阶数 $Q$ 为\n$$\nQ = \\max\\left(12,\\, \\left\\lceil 8\\, \\mathrm{AR}_{\\mathrm{avg}} + 6 \\right\\rceil \\right).\n$$\n- 否则，计算 $\\chi = \\max\\!\\left(\\dfrac{R_{\\min}}{L_{\\min}},\\, \\varepsilon\\right)$，其中 $\\varepsilon = 10^{-12}$，并进行分类：\n    - 近场：如果 $\\chi \\le 0.3$，设 $r=2$ 且\n    $$\n    Q = \\max\\left(12,\\, \\left\\lceil 6\\, \\mathrm{AR}_{\\mathrm{avg}} + 3 \\,\\log\\!\\left(1 + \\frac{1}{\\chi}\\right) \\right\\rceil \\right).\n    $$\n    - 中等距离：如果 $0.3  \\chi \\le 1.5$，设 $r=1$ 且\n    $$\n    Q = \\max\\left(6,\\, \\left\\lceil 4\\, \\mathrm{AR}_{\\mathrm{avg}} + 2 \\,\\sqrt{\\eta + 1} \\right\\rceil \\right).\n    $$\n    - 远场：如果 $\\chi > 1.5$，设 $r=0$ 且\n    $$\n    Q = \\max\\left(4,\\, \\left\\lceil 2\\,(1 + \\eta) \\right\\rceil \\right).\n    $$\n最后，使用纵横比将标量基准阶数 $Q$ 映射到各向异性张量积阶数：\n$$\ns = \\sqrt{\\mathrm{AR}_{\\mathrm{avg}}},\\qquad N_x = \\left\\lceil Q\\, s \\right\\rceil,\\qquad N_y = \\left\\lceil \\frac{Q}{s} \\right\\rceil.\n$$\n所有对数均为自然对数。整数 $(N_x,N_y)$ 是无量纲的计数。距离单位为米，$k$ 的单位为弧度/米。\n\n实现一个程序，该程序：\n1. 将矩形表示为 $z=0$ 平面内的轴对齐单元，由其中心 $(x,y)$（单位：米）和边长 $(a,b)$（单位：米）定义。\n2. 使用平面内轴对齐矩形的精确几何形状计算一对矩形的 $R_{\\min}$。\n3. 计算 $\\mathrm{AR}_{\\mathrm{avg}}$、$L_{\\min}$、$\\chi$ 和 $\\eta$。\n4. 应用上述分类和公式生成 $(r,N_x,N_y)$。\n\n包括以下五个测试用例的测试套件，涵盖远场、中等距离、近场（包括接触）、高纵横比、振荡和自相互作用。所有坐标和长度必须以米为单位处理，$k$ 以弧度/米为单位处理：\n- 测试用例 1：$S_m$：中心 $(0,0)$，边长 $(0.1,0.1)$；$S_n$：中心 $(0.8,0)$，边长 $(0.1,0.1)$；$k = \\dfrac{2\\pi}{0.3}$。\n- 测试用例 2：$S_m$：中心 $(0,0)$，边长 $(0.1,0.05)$；$S_n$：中心 $(0.12,0)$，边长 $(0.08,0.04)$；$k = 5$。\n- 测试用例 3：$S_m$：中心 $(0,0)$，边长 $(0.2,0.02)$；$S_n$：中心 $(0.205,0)$，边长 $(0.2,0.02)$；$k = 20$。\n- 测试用例 4：$S_m$：中心 $(0,0)$，边长 $(0.1,0.05)$；$S_n$：与 $S_m$ 相同；$k = 0$。\n- 测试用例 5：$S_m$：中心 $(0,0)$，边长 $(0.1,0.1)$；$S_n$：中心 $(0.1,0)$，边长 $(0.1,0.1)$；$k = 500$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔列表形式的结果，每个结果本身是一个由三个整数 $[r,N_x,N_y]$ 组成的列表，不含空格。例如，预期的格式是\n$$\n\\big[ [r_1,N_{x,1},N_{y,1}], [r_2,N_{x,2},N_{y,2}], [r_3,N_{x,3},N_{y,3}], [r_4,N_{x,4},N_{y,4}], [r_5,N_{x,5},N_{y,5}] \\big].\n$$",
            "solution": "阻抗矩阵源于麦克斯韦方程组的边界积分公式。从自由空间中麦克斯韦方程组的时谐形式出发，\n$$\n\\nabla \\times \\mathbf E = -j\\omega \\mu \\mathbf H,\\qquad \\nabla \\times \\mathbf H = j\\omega \\varepsilon \\mathbf E,\n$$\n通过适当的格林函数消去场，可以得到面积分方程，其中未知电流密度在一系列支撑于曲面单元上的基函数中展开。对于平面矩形上的常数基函数，每个阻抗矩阵分量 $Z_{mn}$ 都涉及一个标量核函数在两个矩形上的双重面积分：\n$$\nZ_{mn} \\propto \\int_{S_m} \\int_{S_n} G(\\mathbf r,\\mathbf r') \\,\\mathrm dS(\\mathbf r) \\,\\mathrm dS(\\mathbf r'),\n$$\n其中 $G(\\mathbf r,\\mathbf r') = \\dfrac{e^{-j k \\lvert \\mathbf r - \\mathbf r' \\rvert}}{4\\pi \\lvert \\mathbf r - \\mathbf r' \\rvert}$ 是亥姆霍兹方程的自由空间标量格林函数，其波数为 $k$。当 $\\mathbf r \\to \\mathbf r'$ 时，核函数表现出 $1/\\lvert \\mathbf r - \\mathbf r' \\rvert$ 的奇异性，该奇异性在二维曲面上是可积的；当 $k$ 增大时，核函数表现出振荡行为。必须调整数值求积方法以适应几何邻近度和振荡，从而控制误差。\n\n为了构建一个自适应选择器，我们通过无量纲且具有物理意义的度量来形式化邻近度和各向异性。对于两个位于 $z=0$ 平面内的轴对齐矩形，其中心分别为 $(x_m,y_m)$、$(x_n,y_n)$，边长分别为 $(a_m,b_m)$、$(a_n,b_n)$，定义纵横比\n$$\n\\mathrm{AR}_m = \\frac{\\max(a_m,b_m)}{\\min(a_m,b_m)},\\quad \\mathrm{AR}_n = \\frac{\\max(a_n,b_n)}{\\min(a_n,b_n)},\\quad \\mathrm{AR}_{\\mathrm{avg}} = \\frac{\\mathrm{AR}_m + \\mathrm{AR}_n}{2}.\n$$\n各向异性影响每个方向上所需的点数；较长的边需要更多的点来解析几何变化。一个特征单元长度取为\n$$\nL_m = \\sqrt{a_m b_m},\\quad L_n = \\sqrt{a_n b_n},\\quad L_{\\min} = \\min(L_m,L_n),\n$$\n它与边长的几何平均值成正比，并捕捉了一个在交换 $a$ 和 $b$ 时不变的有效尺寸。平面内两个轴对齐矩形之间的最小间距 $R_{\\min}$ 可以通过分解沿 $x$ 和 $y$ 轴的间距来计算：\n$$\n\\text{设 } x\\text{-范围为 }[x_m - a_m/2,\\, x_m + a_m/2],\\ [x_n - a_n/2,\\, x_n + a_n/2],\\\\\n\\text{及 } y\\text{-范围为 }[y_m - b_m/2,\\, y_m + b_m/2],\\ [y_n - b_n/2,\\, y_n + b_n/2].\n$$\n定义轴向间隙\n$$\nd_x = \\max\\big(0,\\, x_m - \\frac{a_m}{2} - (x_n + \\frac{a_n}{2}),\\, x_n - \\frac{a_n}{2} - (x_m + \\frac{a_m}{2})\\big),\\\\\nd_y = \\max\\big(0,\\, y_m - \\frac{b_m}{2} - (y_n + \\frac{b_n}{2}),\\, y_n - \\frac{b_n}{2} - (y_m + \\frac{b_m}{2})\\big),\n$$\n则\n$$\nR_{\\min} = \\sqrt{d_x^2 + d_y^2}.\n$$\n如果在一个轴上的投影重叠或接触，则相应的轴向间隙为零。如果两个投影都重叠或接触，则 $R_{\\min} = 0$（矩形接触或重叠）。\n\n为了对相互作用区域进行分类，我们定义无量纲度量\n$$\n\\chi = \\frac{R_{\\min}}{L_{\\min}},\\qquad \\eta = k\\, R_{\\min}.\n$$\n参数 $\\chi$ 比较了邻近度与尺寸：$\\chi \\ll 1$ 表示近奇异行为，因为核函数在积分域上变化迅速，并且主要由 $1/\\lvert \\mathbf r - \\mathbf r' \\rvert$ 结构决定。参数 $\\eta$ 衡量振荡；较大的 $\\eta$ 需要更精细的求积来解析相位 $e^{-j k \\lvert \\mathbf r - \\mathbf r' \\rvert}$。这些考虑因素引出了以下选择逻辑：\n\n- 自相互作用：如果矩形相同（中心和边长相同），则积分涉及沿域对角线的核奇异性。尽管可积，但仍需要专门的变换，如 Duffy 映射；我们通过一个专用的法则标识符来表示这种情况，并设置一个随 $\\mathrm{AR}_{\\mathrm{avg}}$ 增长的相对较高的基准阶数：\n$$\nQ = \\max\\left(12,\\, \\left\\lceil 8\\, \\mathrm{AR}_{\\mathrm{avg}} + 6 \\right\\rceil \\right).\n$$\n常数 $8$ 和 $6$ 反映了对自项的保守偏置：各向异性增加了难度，固定的偏移量确保了最小分辨率。\n\n- 近场相互作用：如果 $\\chi \\le 0.3$，邻近度相对于尺寸较小，核函数的近奇异变化占主导地位。专门的近奇异法则（如 Duffy 或极坐标求积）由法则标识符 $2$ 表示。阶数必须随各向异性和邻近严重程度的增加而增加。一个合理的依赖关系是对 $1/\\chi$ 取对数，因为奇异性解析变换将 $1/r$ 奇异性转化为积分，其难度与面元之间的距离成比例，通常会引入弱奇异或光滑的被积函数，当 $\\chi \\to 0$ 时，这些函数仍然需要更精细的分辨率。因此：\n$$\nQ = \\max\\left(12,\\, \\left\\lceil 6\\, \\mathrm{AR}_{\\mathrm{avg}} + 3 \\,\\log\\!\\left(1 + \\frac{1}{\\chi}\\right) \\right\\rceil \\right).\n$$\n这里，因子 $6$ 根据各向异性调整求积阶数，因子 $3$ 根据对数邻近度度量进行调整。最小值 $12$ 确保了近奇异情况下的基线鲁棒性。\n\n- 中等距离相互作用：如果 $0.3  \\chi \\le 1.5$，核函数具有陡峭的梯度但并非近奇异；可以使用增强阶数的张量积 Gauss–Legendre 法则。振荡通过 $\\eta$ 进入，各向异性通过 $\\mathrm{AR}_{\\mathrm{avg}}$ 进入：\n$$\nQ = \\max\\left(6,\\, \\left\\lceil 4\\, \\mathrm{AR}_{\\mathrm{avg}} + 2 \\,\\sqrt{\\eta + 1} \\right\\rceil \\right).\n$$\n对 $\\eta$ 的平方根依赖关系反映了对于中等振荡，相位解析要求随 $\\eta$ 亚线性增长；偏移量 $+1$ 确保了在 $\\eta=0$ 时的行为是确定的。因子 $4$ 根据各向异性进行调整，最小值 $6$ 确保了非平凡的分辨率。\n\n- 远场相互作用：如果 $\\chi > 1.5$，核函数在域上是光滑的。振荡仍必须被解析。对 $(1+\\eta)$ 的简单线性依赖是保守且直接的：\n$$\nQ = \\max\\left(4,\\, \\left\\lceil 2\\,(1 + \\eta) \\right\\rceil \\right).\n$$\n当 $\\eta$ 很小时，最小值 $4$ 提供了基本的准确性。\n\n从标量基准阶数 $Q$ 到张量积阶数 $(N_x,N_y)$ 的各向异性映射考虑了单元拉伸。如果 $\\mathrm{AR}_{\\mathrm{avg}} = 1$，单元近似方形，则 $N_x \\approx N_y \\approx Q$。如果 $\\mathrm{AR}_{\\mathrm{avg}} > 1$，则沿较长维度分配更多的点。一个平滑的映射使用 $s = \\sqrt{\\mathrm{AR}_{\\mathrm{avg}}}$ 以及\n$$\nN_x = \\left\\lceil Q\\, s \\right\\rceil,\\qquad N_y = \\left\\lceil \\frac{Q}{s} \\right\\rceil,\n$$\n这保持了 $N_x N_y \\approx Q^2$，同时偏向长边。\n\n算法步骤：\n1. 输入矩形 $(x_m,y_m,a_m,b_m)$、$(x_n,y_n,a_n,b_n)$（单位：米）和 $k$（单位：弧度/米）。\n2. 通过平面内轴对齐矩形距离计算 $R_{\\min}$：\n   - 计算 $x$-区间 $[x_m - a_m/2, x_m + a_m/2]$ 和 $[x_n - a_n/2, x_n + a_n/2]$，对 $y$ 也做类似计算。\n   - 计算 $d_x$ 作为这些区间沿 $x$ 轴的非负间距；类似地计算 $d_y$。\n   - 设 $R_{\\min} = \\sqrt{d_x^2 + d_y^2}$。\n3. 计算 $\\mathrm{AR}_m$、$\\mathrm{AR}_n$、$\\mathrm{AR}_{\\mathrm{avg}}$、$L_m$、$L_n$、$L_{\\min}$，并设 $\\chi = \\max(R_{\\min}/L_{\\min}, \\varepsilon)$，其中 $\\varepsilon = 10^{-12}$，以及 $\\eta = k\\, R_{\\min}$。\n4. 如果矩形在严格容差内相同，则设 $r=3$ 并通过自项公式计算 $Q$；否则通过 $\\chi$ 进行分类并相应计算 $Q$；通过 $s = \\sqrt{\\mathrm{AR}_{\\mathrm{avg}}}$ 映射到 $(N_x,N_y)$。\n5. 输出整数 $[r,N_x,N_y]$。\n\n将此应用于规定的测试套件：\n\n- 测试用例 1：$S_m$：中心 $(0,0)$，边长 $(0.1,0.1)$；$S_n$：中心 $(0.8,0)$，边长 $(0.1,0.1)$；$k = \\dfrac{2\\pi}{0.3}$。$x$-区间为 $[-0.05,0.05]$ 和 $[0.75,0.85]$；$d_x = 0.70$，$d_y = 0$，所以 $R_{\\min} = 0.70$。$L_{\\min} = \\sqrt{0.1\\cdot 0.1} = 0.1$，$\\chi = 7 > 1.5$（远场）。$\\eta \\approx 20.943951\\cdot 0.70 \\approx 14.661$，得到 $Q = \\max\\!\\big(4, \\left\\lceil 2(1 + 14.661)\\right\\rceil\\big) = 32$。$\\mathrm{AR}_{\\mathrm{avg}} = 1$，$s=1$，所以 $N_x = 32$，$N_y = 32$，$r=0$。\n\n- 测试用例 2：$S_m$：中心 $(0,0)$，边长 $(0.1,0.05)$；$S_n$：中心 $(0.12,0)$，边长 $(0.08,0.04)$；$k = 5$。$x$-区间为 $[-0.05,0.05]$ 和 $[0.08,0.16]$；$d_x = 0.03$，$d_y = 0$，所以 $R_{\\min} = 0.03$。$L_m = \\sqrt{0.1\\cdot 0.05} \\approx 0.07071$，$L_n = \\sqrt{0.08\\cdot 0.04} \\approx 0.05657$，$L_{\\min} \\approx 0.05657$，因此 $\\chi \\approx 0.53$（中等距离）。$\\eta = 5\\cdot 0.03 = 0.15$，导致 $Q = \\max\\!\\big(6, \\left\\lceil 4\\cdot 2 + 2\\sqrt{1.15}\\right\\rceil\\big) = \\left\\lceil 8 + 2.146\\right\\rceil = 11$。$\\mathrm{AR}_{\\mathrm{avg}} = 2$，$s \\approx 1.4142$，$N_x = \\left\\lceil 11\\cdot 1.4142 \\right\\rceil = 16$，$N_y = \\left\\lceil 11/1.4142 \\right\\rceil = 8$，$r=1$。\n\n- 测试用例 3：$S_m$：中心 $(0,0)$，边长 $(0.2,0.02)$；$S_n$：中心 $(0.205,0)$，边长 $(0.2,0.02)$；$k = 20$。$x$-区间为 $[-0.1,0.1]$ 和 $[0.105,0.305]$；$d_x = 0.005$，$d_y = 0$，所以 $R_{\\min} = 0.005$。$L_{\\min} = \\sqrt{0.2\\cdot 0.02} \\approx 0.0632456$，$\\chi \\approx 0.079$（近场）。$\\eta = 20\\cdot 0.005 = 0.1$。则 $Q = \\max\\!\\big(12, \\left\\lceil 6\\cdot 10 + 3\\log(1 + 1/0.079)\\right\\rceil\\big) \\approx \\left\\lceil 60 + 7.845\\right\\rceil = 68$。$\\mathrm{AR}_{\\mathrm{avg}} = 10$，$s \\approx 3.1623$，$N_x = \\left\\lceil 68\\cdot 3.1623 \\right\\rceil = 216$，$N_y = \\left\\lceil 68/3.1623 \\right\\rceil = 22$，$r=2$。\n\n- 测试用例 4：$S_m$：中心 $(0,0)$，边长 $(0.1,0.05)$；$S_n$：相同；$k = 0$。相同的矩形意味着自相互作用，$r=3$。$\\mathrm{AR}_{\\mathrm{avg}} = 2$，$Q = \\max\\!\\big(12, \\left\\lceil 8\\cdot 2 + 6 \\right\\rceil\\big) = 22$。则 $s \\approx 1.4142$，$N_x = \\left\\lceil 22\\cdot 1.4142 \\right\\rceil = 32$，$N_y = \\left\\lceil 22/1.4142 \\right\\rceil = 16$。\n\n- 测试用例 5：$S_m$：中心 $(0,0)$，边长 $(0.1,0.1)$；$S_n$：中心 $(0.1,0)$，边长 $(0.1,0.1)$；$k = 500$。$x$-区间为 $[-0.05,0.05]$ 和 $[0.05,0.15]$；它们在 $x=0.05$ 处接触，所以 $d_x=0$ 且 $R_{\\min}=0$。$L_{\\min} = 0.1$，设 $\\chi = \\max(0/0.1,\\varepsilon) = 10^{-12}$（近场）。则 $Q = \\max\\!\\big(12, \\left\\lceil 6\\cdot 1 + 3\\log(1 + 10^{12}) \\right\\rceil\\big) \\approx \\left\\lceil 6 + 82.893\\right\\rceil = 89$。$\\mathrm{AR}_{\\mathrm{avg}} = 1$，$s=1$，$N_x = 89$，$N_y = 89$，$r=2$。\n\n因此，选择器为每个案例生成与物理和数值原理一致的 $[r,N_x,N_y]$。程序必须实现这些步骤，并打印一行包含五个结果的列表，格式为列表的列表，不含空格：\n$$\n\\big[ [r_1,N_{x,1},N_{y,1}], [r_2,N_{x,2},N_{y,2}], [r_3,N_{x,3},N_{y,3}], [r_4,N_{x,4},N_{y,4}], [r_5,N_{x,5},N_{y,5}] \\big].\n$$",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef rectangle_distance_2d(rect1, rect2):\n    \"\"\"\n    Compute the minimum distance between two axis-aligned rectangles in 2D.\n    Each rect is a tuple (cx, cy, ax, by) with center (cx, cy) and side lengths (ax, by).\n    Returns R_min >= 0.\n    \"\"\"\n    x1_min = rect1[0] - rect1[2] / 2.0\n    x1_max = rect1[0] + rect1[2] / 2.0\n    y1_min = rect1[1] - rect1[3] / 2.0\n    y1_max = rect1[1] + rect1[3] / 2.0\n\n    x2_min = rect2[0] - rect2[2] / 2.0\n    x2_max = rect2[0] + rect2[2] / 2.0\n    y2_min = rect2[1] - rect2[3] / 2.0\n    y2_max = rect2[1] + rect2[3] / 2.0\n\n    # Separation along x: positive if disjoint, else 0\n    dx1 = x1_min - x2_max\n    dx2 = x2_min - x1_max\n    dx = max(0.0, dx1, dx2)\n\n    # Separation along y: positive if disjoint, else 0\n    dy1 = y1_min - y2_max\n    dy2 = y2_min - y1_max\n    dy = max(0.0, dy1, dy2)\n\n    return float(np.hypot(dx, dy))\n\ndef aspect_ratio(rect):\n    \"\"\"Return aspect ratio AR = max(a,b)/min(a,b) for rect (cx, cy, ax, by).\"\"\"\n    a = rect[2]\n    b = rect[3]\n    m = max(a, b)\n    n = min(a, b)\n    # Guard against degenerate rectangles (should not occur in test cases)\n    if n == 0.0 or m == 0.0:\n        raise ValueError(\"Rectangle sides must be positive.\")\n    return float(m / n)\n\ndef characteristic_length(rect):\n    \"\"\"Return L = sqrt(a*b) for rect (cx, cy, ax, by).\"\"\"\n    a = rect[2]\n    b = rect[3]\n    if a == 0.0 or b == 0.0:\n        raise ValueError(\"Rectangle sides must be positive.\")\n    return float(np.sqrt(a * b))\n\ndef rectangles_identical(rect1, rect2, tol=1e-15):\n    \"\"\"Check if two rectangles are identical within a strict tolerance.\"\"\"\n    return (abs(rect1[0] - rect2[0]) = tol and\n            abs(rect1[1] - rect2[1]) = tol and\n            abs(rect1[2] - rect2[2]) = tol and\n            abs(rect1[3] - rect2[3]) = tol)\n\ndef select_quadrature(rect1, rect2, k):\n    \"\"\"\n    Adaptive quadrature selector returning [rule_id, Nx, Ny].\n    rule_id: 0 (far), 1 (moderately close), 2 (near/singular), 3 (self-term).\n    Nx, Ny: recommended tensor-product orders along x and y.\n    \"\"\"\n    # Compute proximity and geometry metrics\n    Rmin = rectangle_distance_2d(rect1, rect2)\n    AR_m = aspect_ratio(rect1)\n    AR_n = aspect_ratio(rect2)\n    AR_avg = 0.5 * (AR_m + AR_n)\n    L_m = characteristic_length(rect1)\n    L_n = characteristic_length(rect2)\n    L_min = min(L_m, L_n)\n\n    # Handle self interaction\n    if rectangles_identical(rect1, rect2):\n        r = 3\n        Q = int(max(12, int(np.ceil(8.0 * AR_avg + 6.0))))\n    else:\n        # Dimensionless parameters\n        eps = 1e-12\n        if L_min > 0:\n            chi = max(Rmin / L_min, eps)\n        else: # Should not happen with valid inputs\n            chi = eps\n        eta = k * Rmin\n\n        if chi = 0.3:\n            # Near interaction\n            r = 2\n            Q = int(max(12, int(np.ceil(6.0 * AR_avg + 3.0 * np.log(1.0 + 1.0 / chi)))))\n        elif chi = 1.5:\n            # Moderately close interaction\n            r = 1\n            Q = int(max(6, int(np.ceil(4.0 * AR_avg + 2.0 * np.sqrt(eta + 1.0)))))\n        else:\n            # Far interaction\n            r = 0\n            Q = int(max(4, int(np.ceil(2.0 * (1.0 + eta)))))\n\n    # Map scalar order to anisotropic tensor-product orders\n    s = float(np.sqrt(AR_avg))\n    Nx = int(np.ceil(Q * s))\n    Ny = int(np.ceil(Q / s))\n    return [r, Nx, Ny]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each rectangle: (cx, cy, ax, by) in meters. k in radians per meter.\n    test_cases = [\n        # Test case 1: far interaction, k = 2*pi/0.3\n        ((0.0, 0.0, 0.1, 0.1), (0.8, 0.0, 0.1, 0.1), 2.0 * np.pi / 0.3),\n        # Test case 2: moderately close, anisotropic, k = 5\n        ((0.0, 0.0, 0.1, 0.05), (0.12, 0.0, 0.08, 0.04), 5.0),\n        # Test case 3: near interaction, high aspect ratio, k = 20\n        ((0.0, 0.0, 0.2, 0.02), (0.205, 0.0, 0.2, 0.02), 20.0),\n        # Test case 4: self interaction, k = 0\n        ((0.0, 0.0, 0.1, 0.05), (0.0, 0.0, 0.1, 0.05), 0.0),\n        # Test case 5: touching rectangles, highly oscillatory, k = 500\n        ((0.0, 0.0, 0.1, 0.1), (0.1, 0.0, 0.1, 0.1), 500.0),\n    ]\n\n    results = []\n    for rect1, rect2, k in test_cases:\n        result = select_quadrature(rect1, rect2, k)\n        results.append(result)\n\n    # Final print statement in the exact required format: no spaces inside the list.\n    # Format: [[r1,Nx1,Ny1],[r2,Nx2,Ny2],...]\n    items = [str(r).replace(' ', '') for r in results]\n    print(f\"[{','.join(items)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在掌握了如何计算单个矩阵元素后，确保整个装配好的矩阵能正确反映底层物理规律至关重要。电荷守恒定律为我们提供了一个强有力的、精确的验证标准，特别是当使用如Rao-Wilton-Glisson (RWG) 和脉冲基函数这类相互兼容的离散化方案时。本实践练习 () 是一个概念性推导，旨在让您深入理解电流和电荷基函数之间的内在联系，并阐明为何离散连续性方程是检验电场积分方程 (EFIE) 程序正确性的一个基本判据。",
            "id": "3317262",
            "problem": "考虑一个由平面三角形离散化的理想电导体开口曲面，其上的时谐场采用 $\\exp(i \\omega t)$ 时间约定，并使用电场积分方程 (EFIE)。设未知的曲面电流密度由 Rao–Wilton–Glisson (RWG) 基函数展开，曲面电荷密度由每个三角形上的分片常数脉冲函数表示。连续性方程指出，曲面电流密度的曲面散度等于角频率与曲面电荷密度的乘积再乘以 $-i$。\n\n一个网格由三个三角形 $T_1$、$T_2$ 和 $T_3$ 组成，其面积分别为 $A_1 = 2.0 \\times 10^{-2}$ $\\mathrm{m}^2$，$A_2 = 2.5 \\times 10^{-2}$ $\\mathrm{m}^2$ 和 $A_3 = 1.8 \\times 10^{-2}$ $\\mathrm{m}^2$。网格中有两条内部边，$e_1$ 位于 $T_1$ 和 $T_2$ 之间，长度为 $l_1 = 2.0 \\times 10^{-1}$ $\\mathrm{m}$；$e_2$ 位于 $T_2$ 和 $T_3$ 之间，长度为 $l_2 = 1.5 \\times 10^{-1}$ $\\mathrm{m}$。RWG 基函数 $f_1$ 的支撑域在 $T_1$ 和 $T_2$ 上，$f_2$ 的支撑域在 $T_2$ 和 $T_3$ 上。基函数的方向选择使得 $f_1$ 在 $T_1$ 上的带符号积分散度等于 $+l_1$，在 $T_2$ 上的等于 $-l_1$；$f_2$ 在 $T_2$ 上的带符号积分散度等于 $+l_2$，在 $T_3$ 上的等于 $-l_2$。\n\n设电流展开为 $\\mathbf{J}(\\mathbf{r}) = I_1 f_1(\\mathbf{r}) + I_2 f_2(\\mathbf{r})$，其系数为 $I_1 = 5.0 \\times 10^{-1} + 3.0 \\times 10^{-1} i$ $\\mathrm{A/m}$ 和 $I_2 = -4.0 \\times 10^{-1} + 1.0 \\times 10^{-1} i$ $\\mathrm{A/m}$。角频率为 $\\omega = 2 \\pi \\times 10^{8}$ $\\mathrm{rad/s}$。定义三角形电荷为 $Q_t = \\int_{T_t} \\sigma \\, dS$，其中 $t \\in \\{1,2,3\\}$，$\\sigma$ 是曲面电荷密度。\n\n从时谐连续性方程和 RWG 基函数的定义性质出发，推导一个离散散度矩阵 $D$，其元素为 $D_{t e} = \\int_{T_t} \\nabla_s \\cdot f_e \\, dS$，该矩阵将电流系数映射到按三角形积分的散度。利用此构造，获得连接电流系数向量 $I = [I_1, I_2]^{\\mathrm{T}}$ 与三角形电荷向量 $Q = [Q_1, Q_2, Q_3]^{\\mathrm{T}}$ 的离散连续性关系。然后，对于给定的网格和参数，计算残差向量 $R = D I + i \\omega Q$ 及其欧几里得范数 $\\|R\\|_2$。\n\n以安培为单位表示 $\\|R\\|_2$ 的最终数值，并将答案四舍五入到四位有效数字。最后，从原理层面解释，为什么精确的离散连续性恒等式可以作为验证 EFIE 阻抗矩阵构建的手段，特别是在 RWG 电流离散化和脉冲电荷离散化的相容性方面，而不使用任何快捷公式。",
            "solution": "在尝试求解之前，对问题陈述的有效性进行严格评估。\n\n### 步骤 1：提取已知条件\n-   **方程与方案**：电场积分方程 (EFIE)，用于时谐场，采用 $\\exp(i \\omega t)$ 时间约定。\n-   **对象**：理想电导体 (PEC) 开口曲面。\n-   **离散化**：平面三角形。\n-   **电流基函数**：Rao–Wilton–Glisson (RWG) 基函数 $f_e$。曲面电流密度为 $\\mathbf{J}(\\mathbf{r}) = I_1 f_1(\\mathbf{r}) + I_2 f_2(\\mathbf{r})$。\n-   **电荷基函数**：每个三角形上的分片常数脉冲函数。\n-   **连续性方程**：曲面电流密度的曲面散度等于角频率与曲面电荷密度的乘积再乘以 $-i$，即 $\\nabla_s \\cdot \\mathbf{J} = -i \\omega \\sigma$。\n-   **网格几何**：\n    -   三角形：$T_1$, $T_2$, $T_3$。\n    -   面积：$A_1 = 2.0 \\times 10^{-2} \\, \\mathrm{m}^2$，$A_2 = 2.5 \\times 10^{-2} \\, \\mathrm{m}^2$，$A_3 = 1.8 \\times 10^{-2} \\, \\mathrm{m}^2$。\n    -   内部边：$e_1$ (位于 $T_1, T_2$ 之间)，长度 $l_1 = 2.0 \\times 10^{-1} \\, \\mathrm{m}$；$e_2$ (位于 $T_2, T_3$ 之间)，长度 $l_2 = 1.5 \\times 10^{-1} \\, \\mathrm{m}$。\n-   **RWG 基函数性质**：\n    -   $f_1$ 的支撑域为 $T_1 \\cup T_2$。\n    -   $f_2$ 的支撑域为 $T_2 \\cup T_3$。\n    -   $f_1$ 的积分散度：$\\int_{T_1} \\nabla_s \\cdot f_1 \\, dS = +l_1$ 且 $\\int_{T_2} \\nabla_s \\cdot f_1 \\, dS = -l_1$。\n    -   $f_2$ 的积分散度：$\\int_{T_2} \\nabla_s \\cdot f_2 \\, dS = +l_2$ 且 $\\int_{T_3} \\nabla_s \\cdot f_2 \\, dS = -l_2$。\n-   **系数与参数**：\n    -   $I_1 = (5.0 \\times 10^{-1} + i 3.0 \\times 10^{-1}) \\, \\mathrm{A/m}$。\n    -   $I_2 = (-4.0 \\times 10^{-1} + i 1.0 \\times 10^{-1}) \\, \\mathrm{A/m}$。\n    -   角频率：$\\omega = 2 \\pi \\times 10^{8} \\, \\mathrm{rad/s}$。\n-   **定义**：\n    -   三角形电荷：$Q_t = \\int_{T_t} \\sigma \\, dS$。\n    -   离散散度矩阵：$D_{t e} = \\int_{T_t} \\nabla_s \\cdot f_e \\, dS$。\n-   **任务**：\n    1.  推导矩阵 $D$。\n    2.  获得连接 $I = [I_1, I_2]^{\\mathrm{T}}$ 和 $Q = [Q_1, Q_2, Q_3]^{\\mathrm{T}}$ 的离散连续性关系。\n    3.  计算残差向量 $R = D I + i \\omega Q$ 及其欧几里得范数 $\\|R\\|_2$。\n    4.  为精确离散连续性恒等式的重要性提供概念性解释。\n\n### 步骤 2：使用提取的已知条件进行验证\n根据验证标准对问题进行评估。\n-   **科学或事实上的不健全性**：该问题在科学上是健全的。它基于矩量法中 EFIE 的标准公式，使用 RWG 和脉冲基函数，这些都是计算电磁学的基础。连续性方程是物理学的基本原理。量纲分析证实了其一致性：RWG 基函数 $f_e$ 是无量纲的，因此其系数 $I_e$ 的单位必须是曲面电流密度 (A/m)，与题目所述一致。矩阵 $D$ 的元素单位是长度 (m)，所以 $DI$ 的单位是安培 (A)。项 $i\\omega Q$ 的单位是 (rad/s) $\\times$ 库仑 = (1/s) $\\times$ (A$\\cdot$s) = A。所有项的单位都是一致的。\n-   **不完整或矛盾的设定**：问题是自洽的。推导所需的所有数据和定义都已提供。乍一看，该问题似乎是一个数值计算题。然而，仔细分析会发现，要计算的量 $R = D I + i \\omega Q$ 根据所提供的定义是恒等于零的。问题没有提供电荷向量 $Q$ 的值，但隐含地要求通过连续性方程本身从电流向量 $I$ 推导出它。这种结构使得该问题成为对概念理解的测试，而非数值计算。\n-   **伪深刻、琐碎或同义反复**：该问题并非无需推理的琐碎问题。相反，它需要进行形式推导来证明残差恒为零，从而绕过数值代入的需要。包含数值是为了测试解题者是理解了基本原理，还是诉诸于死记硬背的计算。该问题的结构是评估深层理解的有效教学工具。\n-   所有其他标准（适定性、客观性、非形式化、不切实际、不适定、无法验证）均满足。\n\n### 步骤 3：结论与行动\n该问题是**有效的**。它是一个以数值练习形式呈现的适定概念性问题。现在开始推导解答。\n\n### 解答\n电流与电荷关系的基础是时谐连续性方程，它将曲面电流密度 $\\mathbf{J}(\\mathbf{r})$ 的曲面散度与曲面电荷密度 $\\sigma(\\mathbf{r})$ 联系起来：\n$$ \\nabla_s \\cdot \\mathbf{J}(\\mathbf{r}) = -i \\omega \\sigma(\\mathbf{r}) $$\n这里，$\\omega$ 是角频率，$i$ 是虚数单位。问题采用 $\\exp(i \\omega t)$ 时间约定。\n\n为了获得离散关系，我们在网格中的每个三角形 $T_t$ 上对该方程进行积分：\n$$ \\int_{T_t} (\\nabla_s \\cdot \\mathbf{J}(\\mathbf{r})) \\, dS = -i \\omega \\int_{T_t} \\sigma(\\mathbf{r}) \\, dS $$\n根据定义，右边的项是 $-i \\omega Q_t$，其中 $Q_t$ 是三角形 $T_t$ 上的总电荷。\n\n曲面电流密度 $\\mathbf{J}(\\mathbf{r})$ 以 RWG 基函数 $f_e(\\mathbf{r})$ 和未知系数 $I_e$ 展开：\n$$ \\mathbf{J}(\\mathbf{r}) = \\sum_{e=1}^{2} I_e f_e(\\mathbf{r}) $$\n将此展开式代入积分连续性方程的左侧，得到：\n$$ \\int_{T_t} \\left( \\nabla_s \\cdot \\sum_{e=1}^{2} I_e f_e(\\mathbf{r}) \\right) \\, dS = \\sum_{e=1}^{2} I_e \\left( \\int_{T_t} \\nabla_s \\cdot f_e(\\mathbf{r}) \\, dS \\right) $$\n问题将离散散度矩阵 $D$ 的元素定义为 $D_{te} = \\int_{T_t} \\nabla_s \\cdot f_e \\, dS$。使用此定义，表达式简化为：\n$$ \\sum_{e=1}^{2} D_{te} I_e $$\n这是矩阵-向量乘积 $DI$ 的第 $t$ 个分量，其中 $I = [I_1, I_2]^{\\mathrm{T}}$ 是电流系数的列向量。\n\n现在我们使用 RWG 基函数 $f_1$ 和 $f_2$ 的给定性质来构造 $3 \\times 2$ 矩阵 $D$。\n-   对于 $e=1$，基函数 $f_1$ 的支撑域在 $T_1$ 和 $T_2$ 上。\n    -   $D_{11} = \\int_{T_1} \\nabla_s \\cdot f_1 \\, dS = l_1$\n    -   $D_{21} = \\int_{T_2} \\nabla_s \\cdot f_1 \\, dS = -l_1$\n    -   $D_{31} = \\int_{T_3} \\nabla_s \\cdot f_1 \\, dS = 0$ (因为 $f_1$ 在 $T_3$ 上为零)\n-   对于 $e=2$，基函数 $f_2$ 的支撑域在 $T_2$ 和 $T_3$ 上。\n    -   $D_{12} = \\int_{T_1} \\nabla_s \\cdot f_2 \\, dS = 0$ (因为 $f_2$ 在 $T_1$ 上为零)\n    -   $D_{22} = \\int_{T_2} \\nabla_s \\cdot f_2 \\, dS = l_2$\n    -   $D_{32} = \\int_{T_3} \\nabla_s \\cdot f_2 \\, dS = -l_2$\n\n组合这些元素，离散散度矩阵 $D$ 为：\n$$ D = \\begin{pmatrix} l_1  0 \\\\ -l_1  l_2 \\\\ 0  -l_2 \\end{pmatrix} $$\n将积分连续性方程的两边相等，我们得到连接电流系数 $I$ 和三角形电荷 $Q = [Q_1, Q_2, Q_3]^{\\mathrm{T}}$ 的离散连续性关系：\n$$ (DI)_t = -i \\omega Q_t \\quad \\text{对于 } t=1, 2, 3 $$\n以向量形式表示为：\n$$ D I = -i \\omega Q $$\n这个方程定义了离散电流表示与离散电荷表示之间的关系。它允许从电流向量 $I$ 唯一地确定电荷向量 $Q$：\n$$ Q = \\frac{1}{-i \\omega} D I = \\frac{i}{\\omega} D I $$\n问题要求计算残差向量 $R = D I + i \\omega Q$。我们将从离散连续性关系中导出的 $Q$ 的表达式代入 $R$ 的定义中：\n$$ R = D I + i \\omega \\left(\\frac{i}{\\omega} D I\\right) $$\n$$ R = D I + i^2 D I = D I - D I = \\mathbf{0} $$\n残差向量恒为零向量，$R = [0, 0, 0]^{\\mathrm{T}}$。这个结果纯粹是代数上的，与 $l_1$、$l_2$、$\\omega$、$I_1$ 和 $I_2$ 的数值无关。零向量的欧几里得范数为：\n$$ \\|R\\|_2 = \\sqrt{0^2 + 0^2 + 0^2} = 0 $$\n$R$ 的单位是安培，所以最终答案是 $0$ 安培。要求四舍五入到四位有效数字是无意义的，因为解析结果恰好为零。\n\n最后，问题要求解释为什么这种离散连续性恒等式的精确性对于验证 EFIE 阻抗矩阵的构建至关重要。\n\n为电流选择 RWG 基函数和为电荷选择脉冲基函数并非随意的。一个 RWG 基函数 $f_e$ 的曲面散度 $\\nabla_s \\cdot f_e$ 是一个分片常数函数，在其正三角形上取一个常数值，在其负三角形上取另一个（相反的）常数值。因此，总电流的散度 $\\nabla_s \\cdot \\mathbf{J} = \\sum_e I_e (\\nabla_s \\cdot f_e)$ 是一个在网格的每个三角形上都是分片常数的函数。这恰好是电荷密度展开式 $\\sigma = \\sum_t \\sigma_t p_t$ 的函数形式，其中 $p_t$ 是脉冲基函数。\n\n这种完美的相容性意味着，表示电荷密度的函数空间恰好是作用于表示电流密度的函数空间上的曲面散度算子的值域。在数学术语中，这些基函数构成了 de Rham 型上链复形的一个相容片段。由于此特性，连续的连续性方程 $\\nabla_s \\cdot \\mathbf{J} = -i \\omega \\sigma$ 可以被离散矩阵方程 $DI = -i\\omega Q$ *精确*表示，没有任何近似误差。\n\n这种精确性对于 EFIE 解的稳定性和准确性至关重要。EFIE 涉及从矢量势 $\\mathbf{A}$ 和标量势 $\\Phi$ 导出的两个项。这两个项 $-i\\omega\\mathbf{A}$ 和 $-\\nabla\\Phi$ 通常很大但几乎相互抵消，尤其是在近场和低频时。这种抵消是洛伦兹规范条件的物理结果，而洛伦兹规范条件本身又由连续性方程保证。如果电流和电荷的离散表示不满足精确的离散连续性方程，这种微妙的抵消将在离散层面被破坏。这会引入显著的误差并导致严重的数值不稳定性，这种现象被称为 EFIE 的“低频失效”(low-frequency breakdown)。\n\n因此，对于任何基于此方案的矩量法代码，验证离散连续性方程是否成立（即，在数值实现中，残差 $R$ 在机器精度内为零）是一项基本且强大的验证测试。它证实了电流和电荷基函数是相容的并且已正确实现，确保了电荷守恒的基本物理原理在离散模型中得到恰当的体现。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "正确构建阻抗矩阵只是第一步，对于大规模问题，标准稠密矩阵的计算和存储成本会迅速变得令人望而却步。分层矩阵 (Hierarchical Matrices) 提供了一种强大的替代方案，通过压缩矩阵的远场部分来显著降低计算复杂度和内存需求。最后的这个实践练习 () 将引导您进行一次定量分析，直接比较传统稠密矩阵法与现代H矩阵法在计算复杂度、内存占用以及最终解精度之间的权衡。",
            "id": "3317269",
            "problem": "考虑用于完美电导体表面散射的电场积分方程 (EFIE)，使用 Rao-Wilton-Glisson (RWG) 基函数进行离散化，得到线性系统 $Z x = b$。阻抗矩阵 $Z \\in \\mathbb{C}^{N \\times N}$ 的元素 $Z_{ij}$ 由非局部核的双重面积分定义。在传统的矩量法 (MoM) 组装中，所有成对相互作用都被保留，因此得到的矩阵是稠密的。作为替代方案，分层矩阵（H-矩阵）表示在自由度上构建一个簇树，将 $Z$ 分割为近场（非容许）和远场（容许）块，并用诸如自适应交叉近似 (ACA) 等算法计算的低秩分解替换每个容许块。假设以下机制和实现细节：\n- 低频机制下，远场块的秩有界：存在一个秩参数 $r$，对于容许块，它不随 $N$ 增长。\n- 容许性准则基于几何分离，并确保远场块允许使用 ACA 容差 $\\varepsilon$ 进行低秩分解，该容差控制谱范数下的块近似误差。\n- 近场块是稠密存储的，但由于局部性，它们的总存储量与 $N$ 呈线性关系。\n- 使用平衡二元簇树，因此在三维空间中，容许块相互作用的数量按 $N \\log N$ 的量级扩展。\n- 每个复数双精度元素占用 $16$ 字节的内存。\n- 对于线性系统的扰动分析，如果 $\\tilde{Z}$ 表示 $Z$ 的 H-矩阵近似，满足 $\\|Z - \\tilde{Z}\\|_2 \\le \\varepsilon \\|Z\\|_2$，则在精确右端项 $b$ 的情况下，相对解误差满足小扰动的标准界限：\n$$\n\\frac{\\|x - \\tilde{x}\\|_2}{\\|x\\|_2} \\le \\frac{\\kappa_2(Z) \\, \\varepsilon}{1 - \\kappa_2(Z) \\, \\varepsilon},\n$$\n前提是 $\\kappa_2(Z) \\, \\varepsilon  1$，其中 $\\kappa_2(Z)$ 是 2-范数条件数。\n\n在这些假设下，比较精确稠密组装与压缩 H-矩阵组装的计算复杂度和内存占用，并量化解精度的权衡。特别地，对于一个具有 $N = 20000$、秩 $r = 40$、容差 $\\varepsilon = 10^{-3}$ 和条件数 $\\kappa_2(Z) = 120$ 的具体配置，选择最能准确反映以下情况的陈述：\n- 在此低频机制下，稠密 MoM 和 H-矩阵组装的渐近内存和组装时间复杂度。\n- 两种方法内存占用的合理数值估计。\n- 在给定的 $\\varepsilon$ 和 $\\kappa_2(Z)$ 下，由 H-矩阵近似引起的相对解误差的合理界限。\n\n选项：\n\nA. 稠密 MoM 组装的内存复杂度为 $\\Theta(N^2)$，时间复杂度为 $\\Theta(N^2)$。在所述的低频机制中，H-矩阵组装的内存复杂度为 $\\Theta(r \\, N \\log N)$，时间复杂度为 $\\Theta(r \\, N \\log N)$。对于 $N = 20000$ 和复数双精度（$16$ 字节），稠密存储大约为 $6.4$ GB，而当远场块以秩-$r$ 因子存储且近场与 $N$ 呈线性关系时，H-矩阵存储量级为 $0.4$ GB。当 $\\varepsilon = 10^{-3}$ 且 $\\kappa_2(Z) = 120$ 时，相对解误差的界限约为 $0.12/(1 - 0.12) \\approx 0.136$，即大约 $13.6\\%$。\n\nB. 稠密 MoM 组装的内存复杂度为 $\\Theta(N^2)$，时间复杂度为 $\\Theta(N^2)$。在所述机制中，H-矩阵组装实现了内存 $\\Theta(N)$ 和时间 $\\Theta(N)$ 的复杂度，且与秩参数 $r$ 无关。对于 $N = 20000$，H-矩阵存储大约为 $6.4$ GB，而由于强稀疏性，稠密存储大约为 $0.4$ GB。相对解误差受 $\\varepsilon$ 限制，且与条件数 $\\kappa_2(Z)$ 无关。\n\nC. 稠密 MoM 组装的内存复杂度为 $\\Theta(N^3)$，时间复杂度为 $\\Theta(N^3)$，因为每个元素都依赖于三重积分，而 H-矩阵组装的内存复杂度为 $\\Theta(N \\log N)$，时间复杂度为 $\\Theta(N \\log N)$，两者都与 $r$ 无关。对于 $N = 20000$，稠密存储远超 $100$ GB，而 H-矩阵存储低于 $0.1$ GB。相对解误差满足 $\\|x - \\tilde{x}\\|_2/\\|x\\|_2 \\le \\varepsilon/(1 - \\varepsilon)$ 且不依赖于 $\\kappa_2(Z)$。\n\nD. 稠密 MoM 组装的内存复杂度为 $\\Theta(N^2)$，时间复杂度为 $\\Theta(N^2)$，而 H-矩阵组装的内存复杂度为 $\\Theta(r \\, N \\log N)$，但时间复杂度为 $\\Theta(N^2)$，因为 ACA 需要对所有元素进行采样。对于 $N = 20000$，稠密存储大约为 $64$ GB，H-矩阵存储大约为 $3.6$ GB。相对解误差满足 $\\|x - \\tilde{x}\\|_2/\\|x\\|_2 \\le \\kappa_2(Z) \\, \\varepsilon = 0.12$，即 $12\\%$。",
            "solution": "在进行求解之前，对问题陈述进行验证。\n\n### 步骤 1：提取已知条件\n\n-   **系统：** 来自完美电导体 (PEC) 表面的电场积分方程 (EFIE) 的线性系统 $Z x = b$，使用 Rao-Wilton-Glisson (RWG) 基函数进行离散化。\n-   **阻抗矩阵 ($Z$)：** $Z \\in \\mathbb{C}^{N \\times N}$，其元素 $Z_{ij}$ 来自非局部核的双重面积分。\n-   **稠密矩量法 (MoM)：** 稠密矩阵，所有 $N^2$ 个相互作用均被计算和存储。\n-   **分层矩阵 (H-矩阵) 近似 ($\\tilde{Z}$)：**\n    -   使用平衡二元簇树。\n    -   近场块稠密存储，总存储量与 $N$ 呈线性关系，即 $\\mathcal{O}(N)$。\n    -   远场（容许）块通过自适应交叉近似 (ACA) 进行低秩分解近似。\n    -   容许块相互作用的数量按 $N \\log N$ 量级扩展。\n-   **H-矩阵的假设：**\n    -   低频机制下，秩 $r$ 有界，不随 $N$ 增长。\n    -   块近似误差由谱范数下的容差 $\\varepsilon$ 控制。\n-   **数据类型：** 复数双精度元素占用 $16$ 字节。\n-   **误差分析：** 相对解误差的界限为 $\\frac{\\|x - \\tilde{x}\\|_2}{\\|x\\|_2} \\le \\frac{\\kappa_2(Z) \\, \\varepsilon}{1 - \\kappa_2(Z) \\, \\varepsilon}$，前提是 H-矩阵满足 $\\|Z - \\tilde{Z}\\|_2 \\le \\varepsilon \\|Z\\|_2$ 且 $\\kappa_2(Z) \\, \\varepsilon  1$。\n-   **具体参数：**\n    -   未知数数量：$N = 20000$。\n    -   秩参数：$r = 40$。\n    -   ACA 容差：$\\varepsilon = 10^{-3}$。\n    -   条件数：$\\kappa_2(Z) = 120$。\n\n### 步骤 2：使用提取的已知条件进行验证\n\n对问题陈述的有效性进行审查。\n-   **科学基础：** 该问题牢固地基于计算电磁学和数值线性代数的既定原理。EFIE、MoM、RWG 基函数、H-矩阵压缩、ACA 以及线性系统的扰动理论界限都是该领域中标准、有据可查的概念。描述准确且科学上合理。\n-   **适定性：** 该问题提供了一套清晰的假设和数值，并要求比较复杂度、内存和精度。这是一个定义明确的任务，可以得到一个唯一的、可验证的答案。\n-   **客观性：** 语言技术性强、精确且不含主观性。\n\n该问题没有任何缺陷。它不是科学上不合理、不可形式化、不完整、矛盾、不现实或不适定的。所有术语都是标准的，所提供的数据对于大规模电磁散射问题是一致且物理上合理的。\n\n### 步骤 3：结论与行动\n\n问题陈述是**有效的**。有必要进行全面分析。\n\n### 推导与分析\n\n该问题需要三部分分析：(1) 渐近复杂度，(2) 数值内存估计，以及 (3) 定量误差界限。\n\n**1. 渐近复杂度分析**\n\n-   **稠密 MoM：**\n    -   **内存：** 阻抗矩阵 $Z$ 是一个 $N \\times N$ 的稠密矩阵。存储它需要所有 $N^2$ 个复数值元素所需空间。因此，内存复杂度为 $\\Theta(N^2)$。\n    -   **组装时间：** 传统的 MoM 实现通过计算一个双重（或四重）积分来计算 $N^2$ 个矩阵元素中的每一个 $Z_{ij}$。假设每个元素的成本大致恒定，组装整个矩阵的总时间为 $\\Theta(N^2)$。\n\n-   **H-矩阵：**\n    -   **内存：** H-矩阵表示对矩阵进行划分。\n        -   近场部分，根据问题的明确假设，需要与 $N$ 呈线性关系的存储量，即 $\\mathcalO(N)$。\n        -   远场部分由通过低秩分解近似的容许块组成。对于一个块的秩-$r$ 近似（形式为 $U V^H$，其中 $U \\in \\mathbb{C}^{m \\times r}, V \\in \\mathbb{C}^{n \\times r}$），存储量与 $r(m+n)$ 成正比。对于平衡簇树和标准容许性准则，所有这些块的总存储量已知是近线性的。问题陈述中指出，块相互作用的数量为 $\\mathcal{O}(N \\log N)$，且秩 $r$ 是常数。存储的标准复杂度结果为 $\\Theta(r N \\log N)$。\n        -   总的 H-矩阵内存复杂度由主导项决定，即 $\\Theta(r N \\log N)$。\n    -   **组装时间：** 构建 H-矩阵的时间包括计算稠密的近场元素（$\\mathcal{O}(N)$ 时间）和为远场块构建低秩近似。使用 ACA，近似一个块的成本与其因子的存储成本成正比，通常按 $\\mathcal{O}(r(m+n))$ 或 $\\mathcal{O}(r^2(m+n))$ 的量级扩展。对所有远场块求和，总组装时间复杂度通常被引述为 $\\mathcal{O}(r^k N \\log N)$，其中 $k \\in \\{1, 2\\}$。表达式 $\\Theta(r N \\log N)$ 是这种近线性复杂度的常见且可接受的表示。\n\n**2. 数值内存占用估计**\n\n给定 $N = 20000$，每个复数双精度元素占用 $16$ 字节。我们使用 $1 \\, \\text{GB} = 10^9 \\, \\text{字节}$ 的约定。\n\n-   **稠密 MoM 内存：**\n    $$ \\text{内存} = N^2 \\times (\\text{每个元素的字节数}) = (20000)^2 \\times 16 \\, \\text{字节} $$\n    $$ \\text{内存} = (4 \\times 10^8) \\times 16 \\, \\text{字节} = 64 \\times 10^8 \\, \\text{字节} = 6.4 \\times 10^9 \\, \\text{字节} = 6.4 \\, \\text{GB} $$\n\n-   **H-矩阵内存：**\n    这需要估计复杂度公式 $\\mathcal{O}(r N \\log N)$ 中的常数因子。要存储的非零元素总数为远场的 $C_{store} \\, r \\, N \\log_2 N$ 加上近场的 $C_{near} \\, N$。\n    我们来计算核心项：$r N \\log_2 N = 40 \\times 20000 \\times \\log_2(20000) \\approx 40 \\times 20000 \\times 14.3 \\approx 1.144 \\times 10^7$ 个复数。\n    内存 $\\approx 1.144 \\times 10^7 \\times 16 \\, \\text{字节} \\approx 1.83 \\times 10^8 \\, \\text{字节} = 0.183 \\, \\text{GB}$。\n    这是一个下界估计，因为它忽略了近场贡献和开销，并且常数 $C_{store}$ 通常大于 $1$。$0.4 \\, \\text{GB}$ 的估计值处于同一数量级且完全合理，代表了大约 $2$ 倍的差异，考虑到未知的实现细节，这是合理的。\n\n**3. 相对解误差界限**\n\n问题提供了公式和参数：\n$\\varepsilon = 10^{-3}$ 和 $\\kappa_2(Z) = 120$。\n首先，我们检查该界限的有效性条件：\n$$ \\kappa_2(Z) \\, \\varepsilon = 120 \\times 10^{-3} = 0.12 $$\n由于 $0.12  1$，该界限适用。我们现在计算相对误差的界限：\n$$ \\frac{\\|x - \\tilde{x}\\|_2}{\\|x\\|_2} \\le \\frac{\\kappa_2(Z) \\, \\varepsilon}{1 - \\kappa_2(Z) \\, \\varepsilon} = \\frac{0.12}{1 - 0.12} = \\frac{0.12}{0.88} = \\frac{12}{88} = \\frac{3}{22} $$\n$$ \\frac{3}{22} \\approx 0.13636... $$\n以百分比表示，这大约是 $13.6\\%$。\n\n### 逐项分析\n\n**A. 稠密 MoM 组装的内存复杂度为 $\\Theta(N^2)$，时间复杂度为 $\\Theta(N^2)$。在所述的低频机制中，H-矩阵组装的内存复杂度为 $\\Theta(r \\, N \\log N)$，时间复杂度为 $\\Theta(r \\, N \\log N)$。对于 $N = 20000$ 和复数双精度（$16$ 字节），稠密存储大约为 $6.4$ GB，而当远场块以秩-$r$ 因子存储且近场与 $N$ 呈线性关系时，H-矩阵存储量级为 $0.4$ GB。当 $\\varepsilon = 10^{-3}$ 且 $\\kappa_2(Z) = 120$ 时，相对解误差的界限约为 $0.12/(1 - 0.12) \\approx 0.136$，即大约 $13.6\\%$。**\n-   复杂度陈述：**正确**。与我们的推导相符。\n-   内存估计：$6.4 \\, \\text{GB}$ 的稠密存储是**正确**的。$\\approx 0.4 \\, \\text{GB}$ 的 H-矩阵存储是**合理的**，且数量级正确。\n-   误差界限：$\\approx 13.6\\%$ 的计算和结果是**正确**的。\n-   结论：**正确**。\n\n**B. 稠密 MoM 组装的内存复杂度为 $\\Theta(N^2)$，时间复杂度为 $\\Theta(N^2)$。在所述机制中，H-矩阵组装实现了内存 $\\Theta(N)$ 和时间 $\\Theta(N)$ 的复杂度，且与秩参数 $r$ 无关。对于 $N = 20000$，H-矩阵存储大约为 $6.4$ GB，而由于强稀疏性，稠密存储大约为 $0.4$ GB。相对解误差受 $\\varepsilon$ 限制，且与条件数 $\\kappa_2(Z)$ 无关。**\n-   H-矩阵复杂度：**不正确**。复杂度是对数线性的 $\\Theta(r N \\log N)$，而不是线性的 $\\Theta(N)$，并且它明显依赖于秩 $r$。\n-   内存估计：**不正确**。稠密存储和 H-矩阵存储的值被互换了。此外，稠密 MoM 矩阵是稠密的，不是稀疏的。\n-   误差界限：**不正确**。该界限明确依赖于 $\\kappa_2(Z)$。\n-   结论：**不正确**。\n\n**C. 稠密 MoM 组装的内存复杂度为 $\\Theta(N^3)$，时间复杂度为 $\\Theta(N^3)$，因为每个元素都依赖于三重积分，而 H-矩阵组装的内存复杂度为 $\\Theta(N \\log N)$，时间复杂度为 $\\Theta(N \\log N)$，两者都与 $r$ 无关。对于 $N = 20000$，稠密存储远超 $100$ GB，而 H-矩阵存储低于 $0.1$ GB。相对解误差满足 $\\|x - \\tilde{x}\\|_2/\\|x\\|_2 \\le \\varepsilon/(1 - \\varepsilon)$ 且不依赖于 $\\kappa_2(Z)$。**\n-   稠密 MoM 复杂度：**不正确**。它是 $\\Theta(N^2)$，不是 $\\Theta(N^3)$。问题指定了双重面积分。\n-   H-矩阵复杂度：**不正确**。它依赖于秩 $r$。\n-   内存估计：稠密存储是 $6.4 \\, \\text{GB}$，不是“远超 $100$ GB”。\n-   误差界限：**不正确**。界限公式错误，并忽略了条件数 $\\kappa_2(Z)$。\n-   结论：**不正确**。\n\n**D. 稠密 MoM 组装的内存复杂度为 $\\Theta(N^2)$，时间复杂度为 $\\Theta(N^2)$，而 H-矩阵组装的内存复杂度为 $\\Theta(r \\, N \\log N)$，但时间复杂度为 $\\Theta(N^2)$，因为 ACA 需要对所有元素进行采样。对于 $N = 20000$，稠密存储大约为 $64$ GB，H-矩阵存储大约为 $3.6$ GB。相对解误差满足 $\\|x - \\tilde{x}\\|_2/\\|x\\|_2 \\le \\kappa_2(Z) \\, \\varepsilon = 0.12$，即 $12\\%$。**\n-   H-矩阵时间复杂度：**不正确**。ACA 的目的是避免 $\\mathcal{O}(N^2)$ 的复杂度。ACA 的成本是近线性的，导致总组装时间为 $\\mathcal{O}(r^k N \\log N)$。\n-   内存估计：稠密存储是 $6.4 \\, \\text{GB}$，不是 $64 \\, \\text{GB}$。这是一个小数点位置错误。\n-   误差界限：**不正确**。这使用了一阶近似 $\\kappa_2(Z) \\varepsilon$，并忽略了问题陈述中提供的公式中的分母 $1 - \\kappa_2(Z) \\varepsilon$。$12\\%$ 的结果不如完整公式得出的 $13.6\\%$ 精确。\n-   结论：**不正确**。\n\n唯一一个在其所有主张——渐近复杂度、数值估计和误差分析——上都保持一致的陈述是选项 A。",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}