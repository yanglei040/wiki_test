{
    "hands_on_practices": [
        {
            "introduction": "$H(\\mathrm{curl})$-适形方法的基石是在单元边界上强制实现矢量场的切向连续性。本练习通过一个直接的动手计算，揭示了为何Nédélec型自由度（边积分）能够完美地胜任此任务，即使场在法向分量上存在跳变。我们将显式地计算一个分段定义的矢量场在两个共享面的四面体边界上的边积分。",
            "id": "3297079",
            "problem": "考虑由平方可积且其旋度也平方可积的矢量场构成的索博列夫空间，记为 $H(\\mathrm{curl}, \\Omega)$，以及使用第一类 Nédélec (边) 单元对其进行的旋度协调有限元离散化。界面上的切向迹定义为场的切向分量沿每条边的线积分。在计算电磁学中，这些边自由度体现了切向连续性，而切向连续性是麦克斯韦方程组的弱形式以及 $H(\\mathrm{curl}, \\Omega)$ 的定义所要求的。\n\n设 $\\Omega \\subset \\mathbb{R}^{3}$ 是两个四面体 $T^{-}$ 和 $T^{+}$ 的并集，它们共享一个顶点为 $P_{1} = (1,0,0)$、$P_{2} = (0,1,0)$ 和 $P_{3} = (0,0,1)$ 的三角面 $S$。四面体 $T^{-}$ 的顶点为 $A_{0} = (0,0,0)$、$A_{1} = P_{1}$、$A_{2} = P_{2}$ 和 $A_{3} = P_{3}$，四面体 $T^{+}$ 的顶点为 $B_{0} = P_{1}$、$B_{1} = P_{2}$、$B_{2} = P_{3}$ 和 $B_{3} = (1,1,1)$。共享面 $S$ 位于平面 $x + y + z = 1$ 上，其单位法向量 $\\boldsymbol{n}_{S}$ 被选为从 $T^{-}$ 指向外部。\n\n定义分段电场 $\\boldsymbol{E} : \\Omega \\to \\mathbb{R}^{3}$ 如下\n$$\n\\boldsymbol{E}(\\boldsymbol{x}) = \n\\begin{cases}\n\\boldsymbol{E}^{-}(\\boldsymbol{x}) = \\begin{pmatrix} x + y \\\\ y + z \\\\ z + x \\end{pmatrix} \\ \\text{V/m},  \\boldsymbol{x} \\in T^{-}, \\\\\n\\boldsymbol{E}^{+}(\\boldsymbol{x}) = \\boldsymbol{E}^{-}(\\boldsymbol{x}) + \\gamma \\, \\boldsymbol{n}_{S} \\ \\text{V/m},  \\boldsymbol{x} \\in T^{+},\n\\end{cases}\n$$\n其中 $\\gamma \\in \\mathbb{R}$ 是一个常数，$\\boldsymbol{n}_{S}$ 是 $S$ 的单位法向量。\n\n使用 $S$ 的全局定向共享边，\n$$\ne_{1} : P_{1} \\to P_{2}, \\quad e_{2} : P_{2} \\to P_{3}, \\quad e_{3} : P_{3} \\to P_{1},\n$$\n其中边 $e$ 上的自由度定义为线积分\n$$\nI(\\boldsymbol{E}; e) = \\int_{e} \\boldsymbol{E} \\cdot \\boldsymbol{t}_{e} \\, \\mathrm{d}s = \\int_{e} \\boldsymbol{E} \\cdot \\mathrm{d}\\boldsymbol{l},\n$$\n其中 $\\boldsymbol{t}_{e}$ 是与 $e$ 的定向一致的单位切向量，且 $\\mathrm{d}\\boldsymbol{l} = \\boldsymbol{t}_{e} \\, \\mathrm{d}s$。\n\n计算 $\\boldsymbol{E}^{-}$ 和 $\\boldsymbol{E}^{+}$ 在三条共享边上的自由度，并通过计算平方差之和来验证跨越 $S$ 的切向连续性\n$$\nJ = \\sum_{i=1}^{3} \\left( I\\!\\left(\\boldsymbol{E}^{+}; e_{i}\\right) - I\\!\\left(\\boldsymbol{E}^{-}; e_{i}\\right) \\right)^{2}.\n$$\n用单位 $\\mathrm{V}^{2}$ 表示最终量 $J$。最终答案必须是单个实数或单个闭式解析表达式。",
            "solution": "目标是计算量 $J = \\sum_{i=1}^{3} \\left( I\\!\\left(\\boldsymbol{E}^{+}; e_{i}\\right) - I\\!\\left(\\boldsymbol{E}^{-}; e_{i}\\right) \\right)^{2}$。该量表示分段定义的电场 $\\boldsymbol{E}$ 跨越共享界面 $S$ 时，其边自由度的平方差之和。\n\n与矢量场 $\\boldsymbol{F}$ 和边 $e$ 相关联的自由度由线积分 $I(\\boldsymbol{F}; e) = \\int_{e} \\boldsymbol{F} \\cdot \\mathrm{d}\\boldsymbol{l}$ 给出。我们首先分析单条边 $e_i$ 的差值项：\n$$\n\\Delta I_i = I(\\boldsymbol{E}^{+}; e_{i}) - I(\\boldsymbol{E}^{-}; e_{i}) = \\int_{e_i} \\boldsymbol{E}^{+}(\\boldsymbol{x}) \\cdot \\mathrm{d}\\boldsymbol{l} - \\int_{e_i} \\boldsymbol{E}^{-}(\\boldsymbol{x}) \\cdot \\mathrm{d}\\boldsymbol{l}\n$$\n根据积分的线性性质，这可以合并为对矢量场之差的单个积分：\n$$\n\\Delta I_i = \\int_{e_i} \\left( \\boldsymbol{E}^{+}(\\boldsymbol{x}) - \\boldsymbol{E}^{-}(\\boldsymbol{x}) \\right) \\cdot \\mathrm{d}\\boldsymbol{l}\n$$\n根据题目描述，电场定义为当 $\\boldsymbol{x} \\in T^{+}$ 时，$\\boldsymbol{E}^{+}(\\boldsymbol{x}) = \\boldsymbol{E}^{-}(\\boldsymbol{x}) + \\gamma \\, \\boldsymbol{n}_{S}$。此关系对于界面 $S$ 上的点（包括边 $e_i$）成立。因此，沿这些边的场之差是恒定的：\n$$\n\\boldsymbol{E}^{+}(\\boldsymbol{x}) - \\boldsymbol{E}^{-}(\\boldsymbol{x}) = \\gamma \\, \\boldsymbol{n}_{S}\n$$\n将此代入 $\\Delta I_i$ 的表达式中：\n$$\n\\Delta I_i = \\int_{e_i} (\\gamma \\, \\boldsymbol{n}_{S}) \\cdot \\mathrm{d}\\boldsymbol{l}\n$$\n项 $\\gamma \\, \\boldsymbol{n}_{S}$ 是一个常矢量。因此，可以将其从积分中提出：\n$$\n\\Delta I_i = \\gamma \\, \\boldsymbol{n}_{S} \\cdot \\int_{e_i} \\mathrm{d}\\boldsymbol{l}\n$$\n剩余的积分 $\\int_{e_i} \\mathrm{d}\\boldsymbol{l}$ 表示从边 $e_i$ 的起点到终点的矢量位移。\n\n基本的洞察在于，每条边 $e_i$ 完全位于面 $S$ 内。根据定义，向量 $\\boldsymbol{n}_{S}$ 与包含面 $S$ 的平面垂直（正交）。任何位于该平面内的向量都必须与 $\\boldsymbol{n}_{S}$ 正交。位移向量 $\\int_{e_i} \\mathrm{d}\\boldsymbol{l}$ 就是这样一个向量。因此，它们的点积必须为零：\n$$\n\\boldsymbol{n}_{S} \\cdot \\int_{e_i} \\mathrm{d}\\boldsymbol{l} = 0\n$$\n这意味着对于每条边 $i=1, 2, 3$，都有 $\\Delta I_i = \\gamma \\cdot 0 = 0$。\n\n为了验证这一点，我们可以进行显式计算。面 $S$ 的顶点是 $P_{1} = (1,0,0)$、$P_{2} = (0,1,0)$ 和 $P_{3} = (0,0,1)$。这些点满足平面方程 $x+y+z=1$。该平面的一个法向量是 $\\boldsymbol{n} = (1,1,1)^T$。相应的单位法向量是：\n$$\n\\boldsymbol{n}_{S} = \\frac{1}{\\sqrt{1^2+1^2+1^2}} \\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\end{pmatrix} = \\frac{1}{\\sqrt{3}} \\begin{pmatrix} 1 \\\\ 1 \\\\ 1 \\end{pmatrix}\n$$\n定向边的位移向量为：\n- $e_1: P_1 \\to P_2$，所以 $\\boldsymbol{v}_1 = P_2 - P_1 = (0-1, 1-0, 0-0)^T = \\begin{pmatrix} -1 \\\\ 1 \\\\ 0 \\end{pmatrix}$。\n- $e_2: P_2 \\to P_3$，所以 $\\boldsymbol{v}_2 = P_3 - P_2 = (0-0, 0-1, 1-0)^T = \\begin{pmatrix} 0 \\\\ -1 \\\\ 1 \\end{pmatrix}$。\n- $e_3: P_3 \\to P_1$，所以 $\\boldsymbol{v}_3 = P_1 - P_3 = (1-0, 0-0, 0-1)^T = \\begin{pmatrix} 1 \\\\ 0 \\\\ -1 \\end{pmatrix}$。\n\n现在我们计算点积：\n- 对于 $e_1$：$\\Delta I_1 = \\gamma \\boldsymbol{n}_{S} \\cdot \\boldsymbol{v}_1 = \\gamma \\frac{1}{\\sqrt{3}}(1,1,1) \\cdot (-1,1,0) = \\frac{\\gamma}{\\sqrt{3}}(-1+1+0) = 0$。\n- 对于 $e_2$：$\\Delta I_2 = \\gamma \\boldsymbol{n}_{S} \\cdot \\boldsymbol{v}_2 = \\gamma \\frac{1}{\\sqrt{3}}(1,1,1) \\cdot (0,-1,1) = \\frac{\\gamma}{\\sqrt{3}}(0-1+1) = 0$。\n- 对于 $e_3$：$\\Delta I_3 = \\gamma \\boldsymbol{n}_{S} \\cdot \\boldsymbol{v}_3 = \\gamma \\frac{1}{\\sqrt{3}}(1,1,1) \\cdot (1,0,-1) = \\frac{\\gamma}{\\sqrt{3}}(1+0-1) = 0$。\n\n由于所有三条共享边的自由度之差 $\\Delta I_i$ 均为 $0$，因此量 $J$ 为：\n$$\nJ = \\sum_{i=1}^{3} (\\Delta I_i)^2 = 0^2 + 0^2 + 0^2 = 0\n$$\n结果 $J=0$（单位为 $\\mathrm{V}^2$）证实了电场 $\\boldsymbol{E}$ 的切向分量在界面 $S$ 上是连续的，这与 $\\boldsymbol{E}^{-}$ 的具体形式或法向跳跃参数 $\\gamma$ 的值无关。这是 $H(\\mathrm{curl}, \\Omega)$ 空间中场的一个基本性质，也是 Nédélec 有限元方法的基础。",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "从手工计算转向数值实现，关键一步是验证代码能否正确表示有限元基函数和算子。本练习将通过一个有限元分析中的标准流程——“补丁测试”(patch test)，来数值验证最低阶Nédélec基函数的旋度在从参考单元到物理单元的映射下是否变换正确，从而确保对于稳定模拟至关重要的交换图性质得以保持。",
            "id": "3297150",
            "problem": "通过计算最低阶 Nédélec（第一类）基函数在参考三角形上的旋度，并数值验证离散旋度算子在到物理三角形的仿射映射下与解析表达式相匹配，为旋度协调 Sobolev 空间实现一个小型斑块检验。此验证必须纯粹使用标准构造以数学术语进行，无需外部文件或用户输入。\n\n从以下基本基础开始：\n- 二维中的旋度协调 Sobolev 空间是 $H(\\operatorname{curl};\\Omega) = \\{\\boldsymbol{v} \\in [L^2(\\Omega)]^2 \\mid \\operatorname{curl}\\,\\boldsymbol{v} \\in L^2(\\Omega)\\}$，其中对于 $\\boldsymbol{v} = (v_x,v_y)$，$\\operatorname{curl}\\,\\boldsymbol{v} = \\partial v_y/\\partial x - \\partial v_x/\\partial y$。\n- 在顶点为 $\\hat{\\boldsymbol{x}}_1=(0,0)$、$\\hat{\\boldsymbol{x}}_2=(1,0)$、$\\hat{\\boldsymbol{x}}_3=(0,1)$ 的参考三角形 $\\hat{T}$ 上，重心坐标为 $\\hat{\\lambda}_1 = 1 - \\hat{x} - \\hat{y}$、$\\hat{\\lambda}_2 = \\hat{x}$、$\\hat{\\lambda}_3 = \\hat{y}$，其常数梯度为 $\\nabla_{\\hat{\\boldsymbol{x}}}\\hat{\\lambda}_1 = (-1,-1)^\\top$、$\\nabla_{\\hat{\\boldsymbol{x}}}\\hat{\\lambda}_2 = (1,0)^\\top$、$\\nabla_{\\hat{\\boldsymbol{x}}}\\hat{\\lambda}_3 = (0,1)^\\top$。\n- 在 $\\hat{T}$ 上，与有向边 $(i \\to j)$ 相关联的最低阶 Nédélec（第一类）边基函数为\n$$\n\\hat{\\boldsymbol{N}}_{ij} = \\hat{\\lambda}_i \\,\\nabla_{\\hat{\\boldsymbol{x}}}\\hat{\\lambda}_j \\;-\\; \\hat{\\lambda}_j \\,\\nabla_{\\hat{\\boldsymbol{x}}}\\hat{\\lambda}_i.\n$$\n这些基函数沿其关联的有向边的切向线积分为单位1，而沿其他边的积分为零。\n- 对于由 $\\boldsymbol{x} = \\boldsymbol{x}_1 + J \\hat{\\boldsymbol{x}}$ 定义的仿射映射 $F:\\hat{T}\\to T$（其中雅可比矩阵 $J \\in \\mathbb{R}^{2\\times 2}$ 为常数），旋度协调场的协变 Piola 映射为\n$$\n\\boldsymbol{v}(\\boldsymbol{x}) = J^{-\\top}\\,\\hat{\\boldsymbol{v}}(\\hat{\\boldsymbol{x}}),\n\\quad \\text{其中} \\quad \\hat{\\boldsymbol{x}} = J^{-1}(\\boldsymbol{x}-\\boldsymbol{x}_1).\n$$\n- 最低阶 de Rham 复形上的离散旋度算子通过有向边界关联将边自由度映射到单元自由度，并且到常数标量空间 $P_0(T)$ 的 $L^2$ 投影使用单元质量（面积）$|T|$。对于单个三角形，其局部边按顺序 $(1\\to 2)$、$(2\\to 3)$、$(3\\to 1)$ 定向，$\\operatorname{curl}\\,\\boldsymbol{v}$ 在 $T$ 上的有向积分等于边切向积分的有向和。\n\n要实现和验证的任务：\n1. 实现 $\\hat{T}$ 上对应于有向边 $(1\\to 2)$、$(2\\to 3)$、$(3\\to 1)$ 的三个局部 Nédélec 基函数。对于每个基函数，使用定义 $\\operatorname{curl}\\,\\boldsymbol{v} = \\partial v_y/\\partial x - \\partial v_x/\\partial y$ 计算其在 $\\hat{T}$ 上的解析标量旋度。\n2. 对于一个具有顶点 $\\boldsymbol{x}_1$、$\\boldsymbol{x}_2$、$\\boldsymbol{x}_3$ 的仿射图像三角形 $T$，使用链式法则数值计算映射场 $\\boldsymbol{v} = J^{-\\top}\\hat{\\boldsymbol{v}} \\circ F^{-1}$ 的标量旋度。具体来说，如果 $\\nabla_{\\hat{\\boldsymbol{x}}}\\hat{\\boldsymbol{v}}$ 是 $\\hat{\\boldsymbol{v}}$ 关于 $\\hat{\\boldsymbol{x}}$ 的 $2\\times 2$ 雅可比矩阵，则计算\n$$\n\\nabla_{\\boldsymbol{x}}\\boldsymbol{v} = J^{-\\top}\\,(\\nabla_{\\hat{\\boldsymbol{x}}}\\hat{\\boldsymbol{v}})\\,J^{-1},\n$$\n并提取 $\\operatorname{curl}\\,\\boldsymbol{v}$ 为 $\\left(\\nabla_{\\boldsymbol{x}}\\boldsymbol{v}\\right)_{21} - \\left(\\nabla_{\\boldsymbol{x}}\\boldsymbol{v}\\right)_{12}$。\n3. 如下实现单个三角形上的离散旋度算子。根据 Stokes 定理，旋度的有向积分等于边切向自由度的有向和。对于单个边基函数，此积分等于 $\\pm 1$，具体取决于顶点顺序引起的三角形定向是逆时针还是顺时针。到 $P_0(T)$ 的 $L^2$ 投影是该积分除以三角形面积 $|T|$。这在 $T$ 上产生一个常数系数；将 $|T|$ 视为 $\\mathbb{R}^2$ 中的正面积，并通过 $\\operatorname{sign}(\\det J)$ 编码定向符号。\n4. 通过检查第3项中计算的 $L^2$ 投影离散旋度是否与第2项中计算的解析旋度对每个基函数和每个三角形都匹配，来数值验证交换图性质。\n5. 测试集。使用以下五个由其在 $\\mathbb{R}^2$ 中的顶点 $\\boldsymbol{x}_1$、$\\boldsymbol{x}_2$、$\\boldsymbol{x}_3$ 指定的三角形 $T_k$：\n   - $T_1$：$(0,0)$、$(1,0)$、$(0,1)$。\n   - $T_2$：$(0,0)$、$(2,0)$、$(0,3)$。\n   - $T_3$：$(1,2)$、$(4,2.5)$、$(1.2,3.8)$。\n   - $T_4$：$(0,0)$、$(0,1)$、$(1,0)$。\n   - $T_5$：$(0,0)$、$(0.1,0)$、$(0,0.1)$。\n   对于每个三角形，测试所有三个局部边基函数 $(1\\to 2)$、$(2\\to 3)$、$(3\\to 1)$。\n6. 定量答案。对于每种情况（三角形和边），计算三个标量：\n   - 来自第2项的在 $T$ 上的解析旋度，\n   - 来自第3项的离散 $P_0$ 系数，\n   - 以及，作为参考，仅使用仿射数据从第1项中在 $\\hat{T}$ 上的解析旋度映射到 $T$ 的值。\n   报告每种情况下这三个标量之间的最大绝对差（浮点数）。如果此误差小于 $10^{-12}$，则该情况的验证被认为是成功的。\n7. 最终输出格式。您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表的结果（例如 $[e_1,e_2,\\dots,e_{15}]$），其中每个 $e_m$ 是按三角形 $T_1,\\dots,T_5$ 以及每个三角形内边 $(1\\to 2)$、$(2\\to 3)$、$(3\\to 1)$ 的顺序排列的一种情况的最大绝对误差。\n\n本问题不涉及物理单位。所有可能通过几何形状隐式出现的角度，默认单位为弧度，但不需要进行显式角度计算。所有计算都必须以双精度浮点数进行。最终答案是如上所述的浮点数。",
            "solution": "该问题要求对最低阶 Nédélec（第一类）旋度协调有限元的交换图性质进行数值验证。这是一种斑块检验，是有限元分析中的一个基本健全性检查。该验证涉及比较三种不同但解析上等价的方法，来计算物理三角形单元 $T$（一个参考三角形 $\\hat{T}$ 的仿射图像）上基函数的旋度。该问题具有良定性，其科学基础是计算电磁学理论，并为获得唯一解提供了所有必要的定义和数据。\n\n首先，我们在参考单元 $\\hat{T}$ 上建立基函数及其旋度的解析表达式。参考三角形 $\\hat{T}$ 的顶点为 $\\hat{\\boldsymbol{x}}_1=(0,0)$、$\\hat{\\boldsymbol{x}}_2=(1,0)$ 和 $\\hat{\\boldsymbol{x}}_3=(0,1)$。重心坐标为 $\\hat{\\lambda}_1 = 1 - \\hat{x} - \\hat{y}$、$\\hat{\\lambda}_2 = \\hat{x}$ 和 $\\hat{\\lambda}_3 = \\hat{y}$。它们关于参考坐标 $\\hat{\\boldsymbol{x}}=(\\hat{x}, \\hat{y})^\\top$ 的梯度是常数向量：\n$$\n\\nabla_{\\hat{\\boldsymbol{x}}}\\hat{\\lambda}_1 = \\begin{pmatrix} -1 \\\\ -1 \\end{pmatrix}, \\quad\n\\nabla_{\\hat{\\boldsymbol{x}}}\\hat{\\lambda}_2 = \\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix}, \\quad\n\\nabla_{\\hat{\\boldsymbol{x}}}\\hat{\\lambda}_3 = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}.\n$$\n与有向边 $(i \\to j)$ 关联的最低阶 Nédélec 基函数由 $\\hat{\\boldsymbol{N}}_{ij} = \\hat{\\lambda}_i \\nabla_{\\hat{\\boldsymbol{x}}}\\hat{\\lambda}_j - \\hat{\\lambda}_j \\nabla_{\\hat{\\boldsymbol{x}}}\\hat{\\lambda}_i$ 给出。我们计算逆时针定向的局部边 $(1 \\to 2)$、$(2 \\to 3)$ 和 $(3 \\to 1)$ 的三个基函数。\n\n- 对于边 $(1 \\to 2)$:\n$$\n\\hat{\\boldsymbol{N}}_{12}(\\hat{\\boldsymbol{x}}) = \\hat{\\lambda}_1 \\nabla_{\\hat{\\boldsymbol{x}}}\\hat{\\lambda}_2 - \\hat{\\lambda}_2 \\nabla_{\\hat{\\boldsymbol{x}}}\\hat{\\lambda}_1 = (1-\\hat{x}-\\hat{y})\\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} - \\hat{x}\\begin{pmatrix} -1 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} 1-\\hat{y} \\\\ \\hat{x} \\end{pmatrix}.\n$$\n- 对于边 $(2 \\to 3)$:\n$$\n\\hat{\\boldsymbol{N}}_{23}(\\hat{\\boldsymbol{x}}) = \\hat{\\lambda}_2 \\nabla_{\\hat{\\boldsymbol{x}}}\\hat{\\lambda}_3 - \\hat{\\lambda}_3 \\nabla_{\\hat{\\boldsymbol{x}}}\\hat{\\lambda}_2 = \\hat{x}\\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} - \\hat{y}\\begin{pmatrix} 1 \\\\ 0 \\end{pmatrix} = \\begin{pmatrix} -\\hat{y} \\\\ \\hat{x} \\end{pmatrix}.\n$$\n- 对于边 $(3 \\to 1)$:\n$$\n\\hat{\\boldsymbol{N}}_{31}(\\hat{\\boldsymbol{x}}) = \\hat{\\lambda}_3 \\nabla_{\\hat{\\boldsymbol{x}}}\\hat{\\lambda}_1 - \\hat{\\lambda}_1 \\nabla_{\\hat{\\boldsymbol{x}}}\\hat{\\lambda}_3 = \\hat{y}\\begin{pmatrix} -1 \\\\ -1 \\end{pmatrix} - (1-\\hat{x}-\\hat{y})\\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} -\\hat{y} \\\\ \\hat{x}-1 \\end{pmatrix}.\n$$\n对于向量场 $\\boldsymbol{v}=(v_x, v_y)^\\top$，二维标量旋度为 $\\operatorname{curl}\\,\\boldsymbol{v} = \\partial v_y / \\partial x - \\partial v_x / \\partial y$。参考基函数的旋度为：\n$$\n\\operatorname{curl}_{\\hat{\\boldsymbol{x}}}\\,\\hat{\\boldsymbol{N}}_{12} = \\frac{\\partial}{\\partial \\hat{x}}(\\hat{x}) - \\frac{\\partial}{\\partial \\hat{y}}(1-\\hat{y}) = 1 - (-1) = 2.\n$$\n$$\n\\operatorname{curl}_{\\hat{\\boldsymbol{x}}}\\,\\hat{\\boldsymbol{N}}_{23} = \\frac{\\partial}{\\partial \\hat{x}}(\\hat{x}) - \\frac{\\partial}{\\partial \\hat{y}}(-\\hat{y}) = 1 - (-1) = 2.\n$$\n$$\n\\operatorname{curl}_{\\hat{\\boldsymbol{x}}}\\,\\hat{\\boldsymbol{N}}_{31} = \\frac{\\partial}{\\partial \\hat{x}}(\\hat{x}-1) - \\frac{\\partial}{\\partial \\hat{y}}(-\\hat{y}) = 1 - (-1) = 2.\n$$\n所有三个基函数在参考单元 $\\hat{T}$ 上都具有常数旋度 2。\n\n接下来，我们考虑仿射映射 $F: \\hat{T} \\to T$，其中 $\\boldsymbol{x} = F(\\hat{\\boldsymbol{x}}) = \\boldsymbol{x}_1 + J\\hat{\\boldsymbol{x}}$。该变换的雅可比矩阵 $J$ 是常数，由 $J = [\\boldsymbol{x}_2 - \\boldsymbol{x}_1, \\boldsymbol{x}_3 - \\boldsymbol{x}_1]$ 给出。$\\hat{T}$ 上的旋度协调向量场 $\\hat{\\boldsymbol{v}}$ 通过协变 Piola 变换转换为 $T$ 上的场 $\\boldsymbol{v}$：$\\boldsymbol{v}(\\boldsymbol{x}) = (J^{-1})^\\top \\hat{\\boldsymbol{v}}(F^{-1}(\\boldsymbol{x}))$。\n\n问题要求用三种方法计算映射后基函数在 $T$ 上的旋度。让我们将 $\\boldsymbol{v}$ 在 $T$ 上的旋度表示为 $C$。\n\n1.  **通过链式法则的解析旋度：** 映射场 $\\boldsymbol{v}$ 关于坐标 $\\boldsymbol{x}$ 的雅可比矩阵是 $\\nabla_{\\boldsymbol{x}}\\boldsymbol{v} = (J^{-1})^\\top (\\nabla_{\\hat{\\boldsymbol{x}}}\\hat{\\boldsymbol{v}}) J^{-1}$。参考基函数的雅可比矩阵 $\\nabla_{\\hat{\\boldsymbol{x}}}\\hat{\\boldsymbol{N}}_{ij}$ 都是相同的：\n    $$\n    \\hat{K} = \\nabla_{\\hat{\\boldsymbol{x}}}\\hat{\\boldsymbol{N}}_{12} = \\nabla_{\\hat{\\boldsymbol{x}}}\\hat{\\boldsymbol{N}}_{23} = \\nabla_{\\hat{\\boldsymbol{x}}}\\hat{\\boldsymbol{N}}_{31} = \\begin{pmatrix} 0  -1 \\\\ 1  0 \\end{pmatrix}.\n    $$\n    令 $V = \\nabla_{\\boldsymbol{x}}\\boldsymbol{v}$。旋度为 $C_1 = V_{21} - V_{12}$。解析上，设 $A = J^{-1}$，则有 $(A^\\top \\hat{K} A)_{21} - (A^\\top \\hat{K} A)_{12} = \\det(A) - (-\\det(A)) = 2\\det(A) = 2/\\det(J)$。\n\n2.  **离散 $P_0$ 旋度：** $\\operatorname{curl}\\,\\boldsymbol{v}$ 在 $T$ 上的常数函数空间 $P_0(T)$ 上的 $L^2$ 投影由 $(\\int_T \\operatorname{curl}\\,\\boldsymbol{v}\\,dA) / |T|$ 给出，其中 $|T|$ 是三角形 $T$ 的面积。使用变量替换和旋度变换法则 $\\operatorname{curl}_{\\boldsymbol{x}}\\boldsymbol{v} = (\\det J)^{-1} \\operatorname{curl}_{\\hat{\\boldsymbol{x}}}\\hat{\\boldsymbol{v}}$，我们有：\n    $$\n    \\int_T \\operatorname{curl}\\,\\boldsymbol{v}\\,dA = \\int_{\\hat{T}} \\frac{\\operatorname{curl}_{\\hat{\\boldsymbol{x}}}\\hat{\\boldsymbol{v}}}{\\det J} |\\det J| \\,d\\hat{A} = \\operatorname{sign}(\\det J) \\int_{\\hat{T}} \\operatorname{curl}_{\\hat{\\boldsymbol{x}}}\\hat{\\boldsymbol{v}} \\,d\\hat{A}.\n    $$\n    由于 $\\operatorname{curl}_{\\hat{\\boldsymbol{x}}}\\hat{\\boldsymbol{v}} = 2$ 且 $\\hat{T}$ 的面积是 $1/2$，该积分变为 $\\operatorname{sign}(\\det J) \\times 2 \\times (1/2) = \\operatorname{sign}(\\det J)$。因此，离散旋度系数是 $C_2 = \\operatorname{sign}(\\det J) / |T|$。因为面积 $|T| = (1/2)|\\det J|$，这简化为 $C_2 = \\operatorname{sign}(\\det J) / ( (1/2) |\\det J| ) = 2/\\det J$。\n\n3.  **从 $\\hat{T}$ 映射的解析旋度：** 第三个值使用标量旋度场的直接变换法则计算：$C_3 = (\\det J)^{-1} \\operatorname{curl}_{\\hat{\\boldsymbol{x}}}\\hat{\\boldsymbol{v}}$。由于 $\\operatorname{curl}_{\\hat{\\boldsymbol{x}}}\\hat{\\boldsymbol{v}} = 2$，我们得到 $C_3 = 2/\\det J$。\n\n所有三种方法都得出相同的解析结果 $C = 2/\\det J$。数值测试验证了它们的浮点实现产生的结果在小公差范围内相等，从而证实了这些基本有限元概念实现的正确性。代码将为每个测试用例（一个特定的三角形和一个基函数）计算这三个值，并报告它们之间的最大绝对差。由于解析结果与边基函数的选择无关，在给定三角形上对边 $(1 \\to 2)$、$(2 \\to 3)$ 和 $(3 \\to 1)$ 的计算将是相同的，但我们按要求执行循环。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a patch test for lowest-order Nédélec curl-conforming elements.\n    \n    This function verifies the commuting diagram property by computing the curl\n    of Nédélec basis functions on several affine triangular elements using three\n    different but analytically equivalent methods. It then calculates the maximum\n    absolute difference between the results of these methods for each test case.\n    \"\"\"\n\n    # Define the 5 test triangles by their vertices (x1, x2, x3)\n    test_cases = [\n        # T1: Reference triangle\n        ((0.0, 0.0), (1.0, 0.0), (0.0, 1.0)),\n        # T2: Scaled triangle\n        ((0.0, 0.0), (2.0, 0.0), (0.0, 3.0)),\n        # T3: Generic affine triangle\n        ((1.0, 2.0), (4.0, 2.5), (1.2, 3.8)),\n        # T4: Flipped orientation\n        ((0.0, 0.0), (0.0, 1.0), (1.0, 0.0)),\n        # T5: Small-scale triangle\n        ((0.0, 0.0), (0.1, 0.0), (0.0, 0.1)),\n    ]\n\n    # The local edges are (1->2), (2->3), (3->1). The calculations are\n    # identical for all three on a given triangle, but the loop is\n    # performed to match the problem's case structure.\n    edge_indices = [(1, 2), (2, 3), (3, 1)]\n\n    # The Jacobian of the reference basis functions is constant\n    # K_hat = [[d(vx)/dx, d(vx)/dy], [d(vy)/dx, d(vy)/dy]]\n    K_hat = np.array([[0.0, -1.0], [1.0, 0.0]])\n    \n    # The curl of the reference basis functions is constant\n    curl_hat = 2.0\n    \n    results = []\n\n    for vertices in test_cases:\n        x1 = np.array(vertices[0], dtype=np.float64)\n        x2 = np.array(vertices[1], dtype=np.float64)\n        x3 = np.array(vertices[2], dtype=np.float64)\n\n        # The Jacobian of the affine map x = x1 + J * x_hat\n        # J = [x2 - x1, x3 - x1]\n        J = np.array([x2 - x1, x3 - x1]).T\n\n        det_J = np.linalg.det(J)\n        \n        # Guard against degenerate triangles\n        if np.abs(det_J)  1e-15:\n            # For the given test cases, this path is not taken.\n            # Assigning an arbitrary large error for a degenerate case.\n            error = 1.0\n            for _ in edge_indices:\n                results.append(error)\n            continue\n\n        J_inv = np.linalg.inv(J)\n        \n        # The positive area of the triangle T\n        area_T = 0.5 * np.abs(det_J)\n\n        for _ in edge_indices:\n            # The calculation is the same for all 3 basis functions of the element.\n            \n            # Method 1: Analytical curl from the Jacobian of the mapped field\n            # curl(v) = (grad(v)_21 - grad(v)_12)\n            # grad(v) = (J^-T) * K_hat * (J^-1)\n            grad_v = J_inv.T @ K_hat @ J_inv\n            curl_method1 = grad_v[1, 0] - grad_v[0, 1]\n            \n            # Method 2: Discrete P0 curl from Stokes' theorem\n            # curl_P0 = ( oriented_integral_of_curl / area )\n            # oriented_integral_of_curl = sign(det(J))\n            curl_method2 = np.sign(det_J) / area_T\n            \n            # Method 3: Mapped analytical curl from the reference element\n            # curl(v) = curl(v_hat) / det(J)\n            curl_method3 = curl_hat / det_J\n            \n            # Calculate the maximum absolute difference between the three methods\n            max_abs_diff = max(\n                np.abs(curl_method1 - curl_method2),\n                np.abs(curl_method1 - curl_method3),\n                np.abs(curl_method2 - curl_method3)\n            )\n            results.append(max_abs_diff)\n            \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        },
        {
            "introduction": "在掌握了离散算子的基础上，我们现在可以解决一个更复杂的、涉及整个网格的问题：亥姆霍兹分解（Helmholtz decomposition）。这项强大的技术能将任意矢量场分解为一个无旋（梯度）部分和一个无散（螺线）部分。本练习将指导您利用有限元离散化中的图结构来实现这一分解，为您提供一个分析和预处理电磁场问题的实用工具。",
            "id": "3297121",
            "problem": "要求您在非结构化网格上，为旋度整合索伯列夫空间 $H(\\mathrm{curl})$ 中的亥姆霍兹分解设计并实现一个离散算法。从基本定义出发，推导该分解的变分特征，并将其转化为作用于边积分自由度的、基于图的线性代数公式。目标是将一个离散矢量场 $\\mathbf{E}$ 数值地分解为一个梯度分量和一个正交的旋度整合补。\n\n使用的基本依据和定义：\n- 域 $\\Omega \\subset \\mathbb{R}^3$ 上的旋度整合索伯列夫空间 $H(\\mathrm{curl})$ 定义为 $H(\\mathrm{curl};\\Omega) = \\{\\mathbf{v} \\in (L^2(\\Omega))^3 : \\nabla \\times \\mathbf{v} \\in (L^2(\\Omega))^3\\}$，需要时可作类似的二维特化。\n- $H(\\mathrm{curl})$ 中的亥姆霍兹分解表示为 $\\mathbf{E} = \\nabla \\phi + \\mathbf{E}_\\perp$，其中 $\\phi \\in H^1(\\Omega)$，并且 $\\mathbf{E}_\\perp$ 在适当的内积下与梯度正交，即对于所有 $\\psi \\in H^1(\\Omega)$，都有 $(\\mathbf{E}_\\perp, \\nabla \\psi) = 0$，其中 $(\\cdot,\\cdot)$ 表示 $L^2$ 内积。\n- 在非结构化网格上，对于每个单位切向量为 $\\mathbf{t}$ 的有向边 $e$，离散场由边积分自由度 $\\int_e \\mathbf{E} \\cdot \\mathbf{t}\\, \\mathrm{d}s$ 表示。对于节点标量势 $\\phi$，沿有向边 $(i \\to j)$ 的离散梯度是势差 $\\phi_j - \\phi_i$。\n- 离散关联算子 $B$ 将节点势映射到边差分：如果边 $e$ 的方向是从节点 $i$ 指向节点 $j$，则 $B_{e,i}=-1$ 且 $B_{e,j}=+1$。离散梯度子空间是 $\\mathrm{range}(B)$，而与梯度的离散正交性通过要求 $B^\\top W \\mathbf{E}_\\perp = \\mathbf{0}$ 来强制执行，其中 $W$ 是一个对称正定边权重矩阵，它编码了边上的内积。在本问题中，使用单位矩阵 $W = I$ 来定义边自由度上的离散内积为 $(\\mathbf{u},\\mathbf{v}) = \\sum_e u_e v_e$。\n\n推导目标：\n- 从对所有离散测试势 $\\psi$ 成立的正交条件 $(\\mathbf{E}-B\\phi, B\\psi) = 0$ 出发，推导出关于节点势 $\\phi$ 的法向方程 $B^\\top B \\phi = B^\\top \\mathbf{E}$（相差一个加性常数）。从 $\\phi$ 恢复梯度分量 $B\\phi$ 和旋度整合补 $\\mathbf{E}_\\perp = \\mathbf{E} - B\\phi$。讨论并论证固定规范（例如，将一个节点的势钉扎为零）以使线性系统非奇异的必要性。\n\n算法要求：\n- 使用上述表示，在非结构化网格上实现离散亥姆霍兹分解。钉扎单个节点（选择任意节点）以固定规范，并求解约化后的线性系统以得到 $\\phi$。\n- 生成梯度分量和正交补，并数值验证其正交性 $B^\\top \\mathbf{E}_\\perp \\approx \\mathbf{0}$。\n\n网格与测试套件：\n- 使用以下具有 $N$ 个节点和一组有向边的二维非结构化网格。节点坐标（无量纲单位）：\n  - 节点 $0$: $(0.0,\\, 0.0)$\n  - 节点 $1$: $(1.0,\\, 0.0)$\n  - 节点 $2$: $(0.2,\\, 0.8)$\n  - 节点 $3$: $(1.1,\\, 0.9)$\n  - 节点 $4$: $(-0.2,\\, 0.9)$\n  - 节点 $5$: $(0.5,\\, -0.1)$\n  - 节点 $6$: $(0.8,\\, 0.5)$\n- 有向边（每条边从较小节点索引指向较大节点索引）：$(0,1)$, $(0,2)$, $(0,5)$, $(1,2)$, $(1,3)$, $(1,5)$, $(1,6)$, $(2,3)$, $(2,4)$, $(2,6)$, $(3,6)$, $(5,6)$。\n- 为三个测试案例定义以下离散场，均表示为边积分自由度：\n  1. 混合场：设坐标为 $(x_i, y_i)$ 的节点 $i$ 上的节点势为 $\\phi_i = \\sin(\\pi x_i) + 0.3\\, y_i$。定义沿每条有向边 $(i,j)$ 的梯度分量为 $\\phi_j - \\phi_i$。在节点闭合回路 $[0,1,6,3,2,0]$ 上叠加一个螺线环流，其沿回路方向的边值振幅为常数 $0.7$；对于回路中使用但方向与存储方向相反的有向边，赋予其振幅的负值。总场 $\\mathbf{E}$ 是梯度分量和螺线分量之和。\n  2. 纯梯度场：使用与上文相同的 $\\phi_i$，并设 $\\mathbf{E}$ 等于离散梯度分量 $B\\phi$（不添加螺线环流）。\n  3. 纯螺线场：仅使用沿回路 $[0,1,6,3,2,0]$ 且振幅为 $0.7$ 的环流（无梯度分量）。\n\n输出规格：\n- 对于每个测试案例，使用 $W=I$ 计算离散亥姆霍兹分解，将节点 $0$ 钉扎到 $\\phi_0 = 0$，求解 $\\phi$，构成 $B\\phi$，并计算 $\\mathbf{E}_\\perp = \\mathbf{E} - B\\phi$。\n- 报告整个测试套件的以下聚合指标：\n  - 对于混合场（测试案例 1）：正交残差比 $r_{\\mathrm{orth}} = \\|B^\\top \\mathbf{E}_\\perp\\|_2 / (\\|B^\\top \\mathbf{E}\\|_2 + \\varepsilon)$，以及重构残差比 $r_{\\mathrm{rec}} = \\|\\mathbf{E} - (B\\phi + \\mathbf{E}_\\perp)\\|_2 / \\|\\mathbf{E}\\|_2$，其中 $\\varepsilon$ 是一个小的正常数以避免在边缘情况下除以零；取 $\\varepsilon = 10^{-12}$。\n  - 对于纯梯度场（测试案例 2）：一个布尔值，指示补的相对范数 $\\|\\mathbf{E}_\\perp\\|_2 / \\|\\mathbf{E}\\|_2$ 是否小于 $10^{-10}$。\n  - 对于纯螺线场（测试案例 3）：一个布尔值，指示梯度分量的相对范数 $\\|B\\phi\\|_2 / \\|\\mathbf{E}\\|_2$ 是否小于 $10^{-10}$。\n- 您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，顺序为 $[r_{\\mathrm{orth}}, r_{\\mathrm{rec}}, \\text{bool\\_case2}, \\text{bool\\_case3}]$。\n\n所有量都是无量纲的；不要引入任何物理单位。角度仅通过正弦函数出现在 $\\phi_i$ 的定义中，并以弧度为单位进行计算。",
            "solution": "该问题要求为定义在非结构化网格上的矢量场设计并实现一种离散亥姆霍兹分解算法。该场由其边积分自由度表示。该分解将场 $\\mathbf{E}$ 分离为一个纯梯度（无旋）分量 $\\mathbf{E}_{\\nabla}$ 和一个正交补 $\\mathbf{E}_{\\perp}$，该补是旋度整合的（在此离散上下文中，是无散的）。该方法的基础在于一个变分原理，该原理被转化为一个线性方程组。\n\n设节点集为 $\\mathcal{N}$，有向边集为 $\\mathcal{E}$，其基数分别为 $N_n=|\\mathcal{N}|$ 和 $N_e=|\\mathcal{E}|$。离散标量势是一个向量 $\\phi \\in \\mathbb{R}^{N_n}$，为每个节点赋一个值。离散矢量场是一个向量 $\\mathbf{E} \\in \\mathbb{R}^{N_e}$，为每条边赋一个值。\n\n离散梯度算子由关联矩阵 $B \\in \\mathbb{R}^{N_e \\times N_n}$ 表示。对于一条从节点 $i$ 指向节点 $j$ 的有向边 $e \\in \\mathcal{E}$，$B$ 的对应行中的元素为 $B_{e,i} = -1$ 和 $B_{e,j} = +1$，其他位置为 0。节点势 $\\phi$ 的梯度是一个边场，由 $\\mathbf{E}_{\\nabla} = B\\phi$ 给出。这是对标量函数求梯度的离散模拟。\n\n离散亥姆霍兹分解写为：\n$$ \\mathbf{E} = B\\phi + \\mathbf{E}_{\\perp} $$\n其中 $\\mathbf{E}_{\\nabla} = B\\phi$ 是梯度分量，$\\mathbf{E}_{\\perp}$ 是其正交补。问题将边场空间 $\\mathbb{R}^{N_e}$ 上的内积定义为 $(\\mathbf{u}, \\mathbf{v}) = \\mathbf{u}^\\top \\mathbf{v}$，对应于权重矩阵 $W=I$。\n\n该分解的定义性质是 $\\mathbf{E}_{\\perp}$ 必须与整个梯度场子空间正交，该子空间是算子 $B$ 的值域。这意味着对于所有可能的节点势向量 $\\psi \\in \\mathbb{R}^{N_n}$，都有 $(\\mathbf{E}_{\\perp}, B\\psi) = 0$。代入 $\\mathbf{E}_{\\perp} = \\mathbf{E} - B\\phi$，我们构建变分问题：寻找 $\\phi \\in \\mathbb{R}^{N_n}$ 使得\n$$ (\\mathbf{E} - B\\phi, B\\psi) = 0 \\quad \\forall \\psi \\in \\mathbb{R}^{N_n} $$\n使用内积定义和矩阵转置的性质，这变为：\n$$ (B\\psi)^\\top (\\mathbf{E} - B\\phi) = 0 $$\n$$ \\psi^\\top B^\\top (\\mathbf{E} - B\\phi) = 0 $$\n由于此式必须对任意向量 $\\psi$ 成立，因此括号中的项必须是零向量。这就得到了势 $\\phi$ 的法向方程：\n$$ B^\\top (\\mathbf{E} - B\\phi) = \\mathbf{0} \\implies B^\\top B \\phi = B^\\top \\mathbf{E} $$\n矩阵 $L = B^\\top B$ 是图拉普拉斯算子。它是一个对称半正定矩阵。对于任何连通图，$L$ 都有一个由常数向量 $\\mathbf{1} = [1, 1, \\dots, 1]^\\top$ 张成的一维零空间。这是因为常数势的梯度为零：对于任意标量 $c$，$B(c\\mathbf{1}) = \\mathbf{0}$。因此，$L(c\\mathbf{1}) = B^\\top B (c\\mathbf{1}) = \\mathbf{0}$。$L$ 的奇异性意味着系统 $L\\phi = B^\\top\\mathbf{E}$ 没有唯一解；如果 $\\phi^*$ 是一个解，那么 $\\phi^* + c\\mathbf{1}$ 也是解。\n\n为了获得 $\\phi$ 的唯一解，我们必须通过施加一个额外约束来“固定规范”。一个标准的选择是将一个节点的势钉扎到一个常数值，例如 $\\phi_0 = 0$。这消除了模糊性。为实现这一点，我们从矩阵 $L$ 中移除对应于节点 $0$ 的行和列，并从向量 $\\phi$ 和 $B^\\top\\mathbf{E}$ 中移除相应的条目。设 $L_R$ 是得到的 $(N_n-1) \\times (N_n-1)$ 约化矩阵，$\\phi_R$ 和 $(B^\\top\\mathbf{E})_R$ 是约化向量。修改后的系统为：\n$$ L_R \\phi_R = (B^\\top\\mathbf{E})_R $$\n对于连通图，约化矩阵 $L_R$ 是可逆的，从而为 $\\phi_R$ 产生唯一解。然后通过重新插入 $\\phi_0=0$ 来重构完整的势向量 $\\phi$。\n\n总的计算过程如下：\n1.  从网格拓扑构造关联矩阵 $B$。\n2.  为每个测试案例定义输入边场 $\\mathbf{E}$。\n3.  计算图拉普拉斯算子 $L = B^\\top B$ 和右侧向量 $\\mathbf{f} = B^\\top \\mathbf{E}$。\n4.  通过构建约化系统 $L_R \\phi_R = \\mathbf{f}_R$ 来应用规范固定条件（$\\phi_0=0$）。\n5.  求解约化线性系统以得到 $\\phi_R$。\n6.  重构完整的势向量 $\\phi$。\n7.  计算梯度分量 $\\mathbf{E}_{\\nabla} = B\\phi$。\n8.  计算正交补 $\\mathbf{E}_{\\perp} = \\mathbf{E} - \\mathbf{E}_{\\nabla}$。\n9.  最后，评估每个测试案例的指定质量指标，以验证分解的正确性。正交残差比 $r_{\\mathrm{orth}} = \\|B^\\top \\mathbf{E}_\\perp\\|_2 / (\\|B^\\top \\mathbf{E}\\|_2 + \\varepsilon)$ 应该很小，这证实了 $\\mathbf{E}_\\perp$ 是离散无散的。重构残差 $r_{\\mathrm{rec}} = \\|\\mathbf{E} - (\\mathbf{E}_{\\nabla} + \\mathbf{E}_\\perp)\\|_2 / \\|\\mathbf{E}\\|_2$ 应在机器精度量级。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements and tests the discrete Helmholtz decomposition on a given\n    unstructured mesh.\n    \"\"\"\n    # Define mesh and constants\n    nodes = np.array([\n        [0.0, 0.0],  # Node 0\n        [1.0, 0.0],  # Node 1\n        [0.2, 0.8],  # Node 2\n        [1.1, 0.9],  # Node 3\n        [-0.2, 0.9], # Node 4\n        [0.5, -0.1], # Node 5\n        [0.8, 0.5],  # Node 6\n    ])\n    num_nodes = nodes.shape[0]\n\n    # Edges are oriented from smaller to larger node index\n    edges = [\n        (0, 1), (0, 2), (0, 5), (1, 2), (1, 3), (1, 5), \n        (1, 6), (2, 3), (2, 4), (2, 6), (3, 6), (5, 6)\n    ]\n    num_edges = len(edges)\n    edge_map = {edge: i for i, edge in enumerate(edges)}\n\n    epsilon = 1e-12\n\n    # 1. Construct the incidence matrix B\n    B = np.zeros((num_edges, num_nodes))\n    for i, (u, v) in enumerate(edges):\n        B[i, u] = -1\n        B[i, v] = 1\n\n    # --- Test Case Field Generation ---\n\n    # Base potential for gradient fields\n    phi_true = np.sin(np.pi * nodes[:, 0]) + 0.3 * nodes[:, 1]\n    \n    # Gradient component (used in cases 1 and 2)\n    E_grad_true = B @ phi_true\n\n    # Solenoidal component (used in cases 1 and 3)\n    # Circulation along loop [0, 1, 6, 3, 2, 0] with amplitude 0.7\n    E_sol = np.zeros(num_edges)\n    amplitude = 0.7\n    loop_edges_oriented = [(0, 1), (1, 6), (6, 3), (3, 2), (2, 0)]\n    \n    for u, v in loop_edges_oriented:\n        if (u, v) in edge_map:\n            E_sol[edge_map[(u, v)]] += amplitude\n        elif (v, u) in edge_map:\n            E_sol[edge_map[(v, u)]] -= amplitude\n        # else: This case is not expected for the given mesh and loop\n    \n    test_fields = {\n        1: E_grad_true + E_sol, # Mixed field\n        2: E_grad_true,           # Pure gradient field\n        3: E_sol                  # Pure solenoidal field\n    }\n\n    # --- Decomposition and Metric Calculation ---\n    results = []\n\n    def perform_decomposition(E):\n        \"\"\"Solves for the potential and returns the decomposed fields.\"\"\"\n        # 3. Compute L and f\n        L = B.T @ B\n        f = B.T @ E\n\n        # 4. Apply gauge fixing (pin node 0 to 0)\n        # We solve for nodes 1 to N-1\n        pinned_node = 0\n        active_nodes = list(range(num_nodes))\n        active_nodes.remove(pinned_node)\n        \n        L_reduced = L[np.ix_(active_nodes, active_nodes)]\n        f_reduced = f[active_nodes]\n\n        # 5. Solve the reduced system\n        phi_reduced = np.linalg.solve(L_reduced, f_reduced)\n\n        # 6. Reconstruct full potential vector\n        phi = np.zeros(num_nodes)\n        phi[active_nodes] = phi_reduced\n        \n        # 7.  8. Compute gradient and orthogonal components\n        E_grad = B @ phi\n        E_perp = E - E_grad\n        \n        return E_grad, E_perp\n\n    # Case 1: Mixed field\n    E1 = test_fields[1]\n    E1_grad, E1_perp = perform_decomposition(E1)\n    \n    # Orthogonality residual ratio\n    orth_num = np.linalg.norm(B.T @ E1_perp)\n    orth_den = np.linalg.norm(B.T @ E1) + epsilon\n    r_orth = orth_num / orth_den\n    results.append(r_orth)\n    \n    # Reconstruction residual ratio\n    rec_num = np.linalg.norm(E1 - (E1_grad + E1_perp))\n    rec_den = np.linalg.norm(E1)\n    r_rec = rec_num / rec_den if rec_den > 0 else 0.0\n    results.append(r_rec)\n    \n    # Case 2: Pure gradient field\n    E2 = test_fields[2]\n    _, E2_perp = perform_decomposition(E2)\n    \n    norm_E2 = np.linalg.norm(E2)\n    relative_norm_perp = np.linalg.norm(E2_perp) / norm_E2 if norm_E2 > 0 else 0.0\n    bool_case2 = relative_norm_perp  1e-10\n    results.append(bool_case2)\n    \n    # Case 3: Pure solenoidal field\n    E3 = test_fields[3]\n    E3_grad, _ = perform_decomposition(E3)\n    \n    norm_E3 = np.linalg.norm(E3)\n    relative_norm_grad = np.linalg.norm(E3_grad) / norm_E3 if norm_E3 > 0 else 0.0\n    bool_case3 = relative_norm_grad  1e-10\n    results.append(bool_case3)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}