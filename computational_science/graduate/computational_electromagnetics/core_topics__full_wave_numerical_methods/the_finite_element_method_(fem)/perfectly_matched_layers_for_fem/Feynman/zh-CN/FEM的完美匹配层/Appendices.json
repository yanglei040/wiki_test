{
    "hands_on_practices": [
        {
            "introduction": "完美匹配层 (PML) 的有效性源于其在数学上作为一种坐标变换的精妙构造，该变换保持了麦克斯韦方程组的形式不变。然而，这种变换对材料本构关系有严格要求。本练习 () 通过一个反例，即只变换介电常数 $\\epsilon$ 而不变换磁导率 $\\mu$，来展示为何一种看似直观却不正确的简化是失败的，从而加深对正确 PML 设计原则的理解。",
            "id": "3339585",
            "problem": "考虑一个用于计算电磁学 (CEM) 中有限元法 (FEM) 的二维横电场结构，其中完美匹配层 (PML) 用于截断一个无界域。物理空间被位于 $x=0$ 的平面分界面分割成两个均匀的半空间。区域 $x<0$ 是自由空间，其介电常数为 $\\epsilon_{0}$，磁导率为 $\\mu_{0}$。区域 $x>0$ 是通过在 $x$ 方向上使用一个恒定的复数拉伸因子 $s$ 进行一维坐标拉伸而构建的，目的是形成一种理想情况下应为完美匹配的材料。根据麦克斯韦方程组在坐标变换下的不变性，正确的构建方式应同时变换介电常数和磁导率。然而，在本问题中，您将提供一个具体的反例，其中仅变换介电常数，而磁导率保持不变。\n\n具体来说，取一个恒定的拉伸因子 $s=2$，并定义 $x>0$ 区域的材料本构参数为 $\\epsilon_{2}=\\epsilon_{0}/s$ 和 $\\mu_{2}=\\mu_{0}$（也就是说，只变换了 $\\epsilon$，而 $\\mu$ 保持不变）。一个角频率为 $\\omega$ 的时谐平面波从 $x<0$ 区域垂直入射到位于 $x=0$ 的分界面上，其电场沿 $\\hat{\\mathbf{y}}$ 方向极化，磁场沿 $\\hat{\\mathbf{z}}$ 方向极化。\n\n利用麦克斯韦方程组、平面分界面上的边界条件以及均匀各向同性介质中平面波阻抗的定义，推导出在 $x=0$ 处切向电场振幅的反射系数。然后，针对指定的反例（$s=2$，$\\epsilon_{2}=\\epsilon_{0}/s$，$\\mu_{2}=\\mu_{0}$）计算该系数值。\n\n将最终答案表示为一个无量纲数。将您的答案四舍五入到四位有效数字。",
            "solution": "该问题陈述经评估是有效的。它在科学上基于麦克斯韦电磁理论，是适定的，并提供了足够的信息来确定唯一解，且陈述客观。该问题提出了一个波传播中的标准边值问题，而分析一种具有不正确变换的本构关系的材料，在计算电磁学中是一个有效且具有指导意义的练习。\n\n该问题考虑一个时谐平面波，其场的时变关系为 $\\exp(j\\omega t)$，此处已省略。该波垂直入射到 $x=0$ 处的分界面上。电场沿 $\\hat{\\mathbf{y}}$ 方向极化，磁场沿 $\\hat{\\mathbf{z}}$ 方向极化。因此，场可以写为 $\\mathbf{E} = E_y(x) \\hat{\\mathbf{y}}$ 和 $\\mathbf{H} = H_z(x) \\hat{\\mathbf{z}}$。\n\n在一个无源、均匀且各向同性的介质中，麦克斯韦旋度方程的相量形式为：\n$$ \\nabla \\times \\mathbf{E} = -j\\omega\\mu \\mathbf{H} $$\n$$ \\nabla \\times \\mathbf{H} = j\\omega\\epsilon \\mathbf{E} $$\n对于给定的场结构，这些方程得以简化。$\\mathbf{E}$ 的旋度为 $\\nabla \\times \\mathbf{E} = \\frac{\\partial E_y}{\\partial x} \\hat{\\mathbf{z}}$，$\\mathbf{H}$ 的旋度为 $\\nabla \\times \\mathbf{H} = -\\frac{\\partial H_z}{\\partial x} \\hat{\\mathbf{y}}$。麦克斯韦方程组简化为一个耦合常微分方程组：\n$$ \\frac{dE_y}{dx} = -j\\omega\\mu H_z $$\n$$ \\frac{dH_z}{dx} = -j\\omega\\epsilon E_y $$\n将第一个方程对 $x$ 求导，并代入第二个方程，得到关于 $E_y$ 的一维亥姆霍兹方程：\n$$ \\frac{d^2E_y}{dx^2} = -j\\omega\\mu \\frac{dH_z}{dx} = -j\\omega\\mu(-j\\omega\\epsilon E_y) = -\\omega^2\\mu\\epsilon E_y $$\n$$ \\frac{d^2E_y}{dx^2} + k^2 E_y = 0 $$\n其中 $k = \\omega\\sqrt{\\mu\\epsilon}$ 是波数。\n\n在区域 1 ($x<0$) 中，介质是自由空间，参数为 $\\epsilon_1 = \\epsilon_0$ 和 $\\mu_1 = \\mu_0$。波数为 $k_1 = \\omega\\sqrt{\\mu_0\\epsilon_0}$。电场是沿 $+x$ 方向传播的入射波和沿 $-x$ 方向传播的反射波的叠加：\n$$ E_{y1}(x) = E_I \\exp(-jk_1 x) + E_R \\exp(jk_1 x) $$\n其中 $E_I$ 是入射波振幅，$E_R$ 是反射波振幅。相应的磁场为：\n$$ H_{z1}(x) = \\frac{j}{\\omega\\mu_1} \\frac{dE_{y1}}{dx} = \\frac{j}{\\omega\\mu_1} [-jk_1 E_I \\exp(-jk_1 x) + jk_1 E_R \\exp(jk_1 x)] = \\frac{k_1}{\\omega\\mu_1} [E_I \\exp(-jk_1 x) - E_R \\exp(jk_1 x)] $$\n区域 1 的本征阻抗为 $\\eta_1 = \\frac{\\omega\\mu_1}{k_1} = \\frac{\\omega\\mu_0}{\\omega\\sqrt{\\mu_0\\epsilon_0}} = \\sqrt{\\frac{\\mu_0}{\\epsilon_0}}$，即自由空间阻抗 $\\eta_0$。因此，\n$$ H_{z1}(x) = \\frac{1}{\\eta_1} [E_I \\exp(-jk_1 x) - E_R \\exp(jk_1 x)] $$\n\n在区域 2 ($x>0$) 中，材料由 $\\epsilon_2 = \\epsilon_0/s$ 和 $\\mu_2 = \\mu_0$ 定义。波数为 $k_2 = \\omega\\sqrt{\\mu_2\\epsilon_2} = \\omega\\sqrt{\\mu_0(\\epsilon_0/s)} = \\frac{\\omega\\sqrt{\\mu_0\\epsilon_0}}{\\sqrt{s}} = \\frac{k_1}{\\sqrt{s}}$。该区域的场是沿 $+x$ 方向传播的透射波：\n$$ E_{y2}(x) = E_T \\exp(-jk_2 x) $$\n其中 $E_T$ 是透射波振幅。相应的磁场为：\n$$ H_{z2}(x) = \\frac{k_2}{\\omega\\mu_2} E_T \\exp(-jk_2 x) = \\frac{1}{\\eta_2} E_T \\exp(-jk_2 x) $$\n区域 2 的本征阻抗为 $\\eta_2 = \\sqrt{\\frac{\\mu_2}{\\epsilon_2}} = \\sqrt{\\frac{\\mu_0}{\\epsilon_0/s}} = \\sqrt{s\\frac{\\mu_0}{\\epsilon_0}} = \\eta_1\\sqrt{s}$。\n\n在分界面 $x=0$ 处，电场和磁场的切向分量必须连续。\n$E_y$ 的连续性：$E_{y1}(0) = E_{y2}(0)$\n$$ E_I + E_R = E_T $$\n$H_z$ 的连续性：$H_{z1}(0) = H_{z2}(0)$\n$$ \\frac{1}{\\eta_1} [E_I - E_R] = \\frac{1}{\\eta_2} E_T $$\n我们现在得到一个包含三个未知振幅的两个方程的方程组。反射系数 $\\Gamma$ 定义为反射电场振幅与入射电场振幅之比，即 $\\Gamma = E_R/E_I$。为求得 $\\Gamma$，我们消去 $E_T$。由第一个方程得 $E_T = E_I + E_R$。将其代入第二个方程：\n$$ \\frac{1}{\\eta_1} [E_I - E_R] = \\frac{1}{\\eta_2} [E_I + E_R] $$\n整理各项以求解比值 $E_R/E_I$：\n$$ \\eta_2 [E_I - E_R] = \\eta_1 [E_I + E_R] $$\n$$ E_I(\\eta_2 - \\eta_1) = E_R(\\eta_1 + \\eta_2) $$\n$$ \\Gamma = \\frac{E_R}{E_I} = \\frac{\\eta_2 - \\eta_1}{\\eta_2 + \\eta_1} $$\n这是垂直入射时反射系数的通用表达式。\n\n现在，我们代入本问题的具体阻抗值：$\\eta_1 = \\eta_0$ 和 $\\eta_2 = \\eta_0\\sqrt{s}$。\n$$ \\Gamma = \\frac{\\eta_0\\sqrt{s} - \\eta_0}{\\eta_0\\sqrt{s} + \\eta_0} = \\frac{\\eta_0(\\sqrt{s} - 1)}{\\eta_0(\\sqrt{s} + 1)} = \\frac{\\sqrt{s} - 1}{\\sqrt{s} + 1} $$\n问题指定了拉伸因子 $s=2$。将该值代入 $\\Gamma$ 的表达式中：\n$$ \\Gamma = \\frac{\\sqrt{2} - 1}{\\sqrt{2} + 1} $$\n为得到数值，我们首先对表达式进行有理化：\n$$ \\Gamma = \\left(\\frac{\\sqrt{2} - 1}{\\sqrt{2} + 1}\\right) \\left(\\frac{\\sqrt{2} - 1}{\\sqrt{2} - 1}\\right) = \\frac{(\\sqrt{2} - 1)^2}{(\\sqrt{2})^2 - 1^2} = \\frac{2 - 2\\sqrt{2} + 1}{2 - 1} = 3 - 2\\sqrt{2} $$\n使用近似值 $\\sqrt{2} \\approx 1.41421356$：\n$$ \\Gamma \\approx 3 - 2(1.41421356) = 3 - 2.82842712 = 0.17157288 $$\n将结果四舍五入到四位有效数字，我们得到 $0.1716$。非零的反射系数证实了这种未变换磁导率的材料结构与自由空间并非完美匹配，这与预期相符。",
            "answer": "$$\\boxed{0.1716}$$"
        },
        {
            "introduction": "在理解了 PML 变换的必要条件后，我们转向其实际设计的核心。这个练习 () 将引导你推导出 PML 设计的基石——一个连接 PML 物理参数（如厚度 $L$ 和电导率分布 $\\sigma(x)$）与所需性能（目标反射系数 $R$）的解析公式。掌握这个推导过程对于在工程实践中有效设计和优化 PML 至关重要。",
            "id": "3339737",
            "problem": "考虑在有限元法 (FEM) 中，使用完美匹配层 (PML) 对一个均匀、各向同性的电磁域进行一维截断。物理域占据 $x \\le 0$ 的空间，其材料参数为介电常数 $\\epsilon$ 和磁导率 $\\mu$。该物理域在 $x \\geq 0$ 处被一个厚度为 $L$ 的单轴 PML 截断。假设场为时谐场，遵循 $\\exp(j \\omega t)$ 的约定，并且一束平面波从 $x  0$ 处正入射到 PML 中。设物理域的特性阻抗为 $\\eta_{0} = \\sqrt{\\mu / \\epsilon}$，其波数为 $k_{0} = \\omega \\sqrt{\\mu \\epsilon}$。\n\nPML 是通过在 $x$ 方向上进行复坐标伸展来实现的，伸展函数为 $s_{x}(x) = 1 + \\frac{\\sigma(x)}{j \\omega \\epsilon}$，其中标量电导率 $\\sigma(x)$ 在其厚度上按 $m \\in \\mathbb{N}$ 阶多项式分级：\n$$\n\\sigma(x) = \\sigma_{\\max} \\left( \\frac{x}{L} \\right)^{m}, \\quad x \\in [0, L].\n$$\n假设 $s_{x}$ 是唯一的非平凡伸展（即 $\\kappa_{x} = 1$ 且无辅助损耗项），并且 PML 在 $x = L$ 处由理想电导体终端。在这些假设下，位于 $x=0$ 处的入射界面是完美匹配的，任何在物理域中测量到的反射都仅由衰减 PML 的有限厚度以及 $x = L$ 处的终端引起。\n\n从物理域中的频域 Maxwell 旋度方程出发，\n$$\n\\nabla \\times \\mathbf{H} = j \\omega \\epsilon \\mathbf{E}, \\qquad \\nabla \\times \\mathbf{E} = - j \\omega \\mu \\mathbf{H},\n$$\n并考虑复坐标伸展对一维平面波解的影响，推导出一个在 $x = 0$ 处实现指定幅度反射系数 $R$（其中 $0  R  1$）的 $\\sigma_{\\max}$ 的闭式解析表达式。您的结果必须仅用 $m$, $R$, $\\eta_{0}$ 和 $L$ 表示。不要引入任何额外参数。请提供 $\\sigma_{\\max}$ 的最终表达式作为您的答案。不需要进行数值计算，最终表达式中也不应包含任何单位。",
            "solution": "该问题被认为是有效的，因为它有科学依据、适定且客观，代表了计算电磁学中的一个标准理论问题。我们继续推导 $\\sigma_{\\max}$ 的表达式。\n\n该问题考虑一个时间依赖关系为 $\\exp(j \\omega t)$ 的时谐平面波，从物理域（$x \\le 0$）正入射到占据区域 $0 \\le x \\le L$ 的完美匹配层 (PML) 上。\n\n在物理域（$x \\le 0$）中，介质是均匀且各向同性的，介电常数为 $\\epsilon$，磁导率为 $\\mu$。假设电场在 y 方向极化，是入射波和反射波的叠加：\n$$\nE_y(x) = E_{inc} \\exp(-j k_0 x) + E_{ref} \\exp(j k_0 x)\n$$\n其中 $k_0 = \\omega \\sqrt{\\mu \\epsilon}$ 是波数。相应的磁场为：\n$$\nH_z(x) = \\frac{1}{\\eta_0} \\left( E_{inc} \\exp(-j k_0 x) - E_{ref} \\exp(j k_0 x) \\right)\n$$\n其中 $\\eta_0 = \\sqrt{\\mu / \\epsilon}$ 是介质的特性阻抗。在界面 $x=0$ 处的反射系数定义为 $\\Gamma = E_{ref} / E_{inc}$。\n\n在 PML 内部（$0 \\le x \\le L$），我们采用基于复坐标伸展的单轴 PML 公式。伸展函数为 $s_x(x) = 1 + \\frac{\\sigma(x)}{j \\omega \\epsilon}$。这修改了在 x 方向传播的平面波的 Maxwell 方程。相关的旋度方程变为：\n$$\n\\frac{\\partial E_y}{\\partial x} = -j \\omega \\mu s_x(x) H_z\n$$\n$$\n\\frac{\\partial H_z}{\\partial x} = -j \\omega \\epsilon s_x(x) E_y\n$$\n结合这两个一阶方程，得到关于 $E_y(x)$ 的二阶波动方程：\n$$\n\\frac{\\partial^2 E_y}{\\partial x^2} - \\frac{1}{s_x(x)} \\frac{\\partial s_x(x)}{\\partial x} \\frac{\\partial E_y}{\\partial x} + k_0^2 [s_x(x)]^2 E_y = 0\n$$\n该方程的精确通解由前向传播波和后向传播波的叠加给出：\n$$\nE_y(x) = A \\exp(-j k_0 \\phi(x)) + B \\exp(j k_0 \\phi(x))\n$$\n其中 $\\phi(x)$ 是复相位积分：\n$$\n\\phi(x) = \\int_0^x s_x(u) \\, du\n$$\nPML 内部相应的磁场由 $H_z = \\frac{j}{\\omega \\mu s_x} \\frac{\\partial E_y}{\\partial x}$ 求得：\n$$\nH_z(x) = \\frac{1}{\\eta_0} \\left( A \\exp(-j k_0 \\phi(x)) - B \\exp(j k_0 \\phi(x)) \\right)\n$$\n这个结果表明，局部波阻抗在整个 PML 中保持为 $\\eta_0$，这就是“完美匹配”特性。\n\n我们首先使用给定的电导率分布 $\\sigma(x) = \\sigma_{\\max} (x/L)^m$ 来计算相位积分 $\\phi(x)$：\n$$\ns_x(u) = 1 + \\frac{\\sigma_{\\max} (u/L)^m}{j \\omega \\epsilon} = 1 - j \\frac{\\sigma_{\\max}}{\\omega \\epsilon L^m} u^m\n$$\n从 $0$ 到 $x$ 积分：\n$$\n\\phi(x) = \\int_0^x \\left( 1 - j \\frac{\\sigma_{\\max}}{\\omega \\epsilon L^m} u^m \\right) du = x - j \\frac{\\sigma_{\\max}}{\\omega \\epsilon L^m} \\frac{x^{m+1}}{m+1}\n$$\n接下来，我们应用边界条件。\n在 PML 的后端 $x=L$ 处，有一个理想电导体 (PEC)，因此总的切向电场必须为零：\n$$\nE_y(L) = A \\exp(-j k_0 \\phi(L)) + B \\exp(j k_0 \\phi(L)) = 0\n$$\n这给出了系数 $A$ 和 $B$ 之间的一个关系：\n$$\nB = -A \\exp(-2 j k_0 \\phi(L))\n$$\n在界面 $x=0$ 处，切向电场和磁场必须连续。通过将入射波幅度归一化为 $E_{inc}=1$，我们有 $E_{ref} = \\Gamma$。\n$E_y$ 在 $x=0$ 处的连续性：\n$$\nE_y(0^-) = 1 + \\Gamma \\quad \\text{和} \\quad E_y(0^+) = A \\exp(0) + B \\exp(0) = A+B\n$$\n$$\n1 + \\Gamma = A + B\n$$\n$H_z$ 在 $x=0$ 处的连续性：\n$$\nH_z(0^-) = \\frac{1}{\\eta_0}(1 - \\Gamma) \\quad \\text{和} \\quad H_z(0^+) = \\frac{1}{\\eta_0}(A - B)\n$$\n$$\n1 - \\Gamma = A - B\n$$\n求解这两个关于 $A$ 和 $B$ 的界面方程，得到 $A=1$ 和 $B=\\Gamma$。将这些代入由 PEC 边界条件得到的关系式中，即可得到反射系数 $\\Gamma$：\n$$\n\\Gamma = -(1) \\exp(-2 j k_0 \\phi(L)) = -\\exp(-2 j k_0 \\phi(L))\n$$\n问题指定了一个目标幅度反射系数 $R = |\\Gamma|$。因此，我们取其模：\n$$\nR = |-\\exp(-2 j k_0 \\phi(L))| = |\\exp(\\text{Re}\\{-2 j k_0 \\phi(L)\\}) \\exp(j \\cdot \\text{Im}\\{-2 j k_0 \\phi(L)\\})|\n$$\n$R = \\exp(\\text{Re}\\{-2 j k_0 \\phi(L)\\})$。\n我们来计算指数部分。首先，我们求 $\\phi(L)$：\n$$\n\\phi(L) = L - j \\frac{\\sigma_{\\max}}{\\omega \\epsilon L^m} \\frac{L^{m+1}}{m+1} = L - j \\frac{\\sigma_{\\max} L}{\\omega \\epsilon (m+1)}\n$$\n现在，我们计算指数 $-2 j k_0 \\phi(L)$：\n$$\n-2 j k_0 \\phi(L) = -2 j k_0 \\left( L - j \\frac{\\sigma_{\\max} L}{\\omega \\epsilon (m+1)} \\right) = -2 j k_0 L - \\frac{2 k_0 \\sigma_{\\max} L}{\\omega \\epsilon (m+1)}\n$$\n我们使用关系式 $k_0 = \\omega\\sqrt{\\mu\\epsilon}$ 和 $\\eta_0 = \\sqrt{\\mu/\\epsilon}$ 来化简第二项：\n$$\n\\frac{k_0}{\\omega \\epsilon} = \\frac{\\omega\\sqrt{\\mu\\epsilon}}{\\omega\\epsilon} = \\sqrt{\\frac{\\mu}{\\epsilon}} = \\eta_0\n$$\n指数变为：\n$$\n-2 j k_0 \\phi(L) = -2 j k_0 L - \\frac{2 \\eta_0 \\sigma_{\\max} L}{m+1}\n$$\n该指数的实部决定了幅度的衰减：\n$$\n\\text{Re}\\{-2 j k_0 \\phi(L)\\} = -\\frac{2 \\eta_0 \\sigma_{\\max} L}{m+1}\n$$\n因此，幅度反射系数 $R$ 为：\n$$\nR = \\exp\\left(-\\frac{2 \\eta_0 \\sigma_{\\max} L}{m+1}\\right)\n$$\n最后，我们对该方程求解 $\\sigma_{\\max}$。对两边取自然对数：\n$$\n\\ln(R) = -\\frac{2 \\eta_0 \\sigma_{\\max} L}{m+1}\n$$\n由于问题说明 $0  R  1$，所以 $\\ln(R)$ 为负，这确保了 $\\sigma_{\\max}$ 为正。整理得到 $\\sigma_{\\max}$：\n$$\n\\sigma_{\\max} = -\\frac{(m+1) \\ln(R)}{2 \\eta_0 L}\n$$\n该表达式按要求给出了所需的最大电导率 $\\sigma_{\\max}$，它由多项式阶数 $m$、目标反射 $R$、特性阻抗 $\\eta_0$ 和 PML 厚度 $L$ 表示。",
            "answer": "$$\n\\boxed{-\\frac{(m+1) \\ln(R)}{2 \\eta_{0} L}}\n$$"
        },
        {
            "introduction": "理论公式为 PML 设计提供了理想化的指导，但在真实的有限元 (FEM) 仿真中，其性能会受到离散化效应和极端物理情境的挑战。本练习 () 将理论与实践相结合，要求你处理 PML 在掠射角 (grazing incidence) 下的性能问题，并考虑 FEM 网格分辨率带来的实际约束。通过这个练习，你将学会如何在实际数值模型中平衡解析设计与数值精度要求，这是进行高保真度电磁仿真的关键技能。",
            "id": "3339573",
            "problem": "考虑一个时谐电磁平面波，在均匀、各向同性、无源介质中传播，其角频率为 $\\omega$，自由空间波数为 $k = 2\\pi/\\lambda$，其中 $\\lambda$ 是以米为单位表示的波长。该波向一个截断边界传播，并由一个完美匹配层 (PML) 终结，该PML通过有限元法 (FEM) 实现。该波以相对于边界法线的掠射入射角 $\\theta = 89.9^\\circ$ 入射到PML上（角度单位使用度）。PML沿边界法向坐标 $x$ 应用，并通过形式为 $s_x(x) = 1 + i a(x)$ 的复坐标伸展进行建模，其中 $a(x)$ 是一个非负衰减剖面。假设采用标准的多项式分级衰减剖面 $a(x) = a_{\\max}(x/L)^m$，其中 PML 厚度 $L$ 以米为单位，最大衰减参数 $a_{\\max} > 0$，多项式阶数 $m \\in \\mathbb{N}$。应选择 PML 厚度 $L$，使得入口平面的往返反射振幅小于目标水平 $R_{\\text{target}} = 10^{-6}$。\n\n请将您的推导基于以下基本原则：\n- 在无源均匀介质中的麦克斯韦方程组，其导出具有色散关系 $|\\mathbf{k}| = k$ 的平面波解，以及边界法向波数分量 $k_n = k\\cos\\theta$ 的定义。\n- 完美匹配层 (PML) 的概念定义，即在边界法向上的复坐标伸展，以及由边界法向波分量所经历的伸展后波数的虚部所决定的指数衰减。\n- 有限元法 (FEM) 离散化，其中 PML 区域的多项式阶数为 $p$，单元尺寸为 $h$（米），这意味着对每个自由度的相位变化和振幅衰减都存在分辨率约束。\n\n除了连续衰减要求外，为了数值上的真实性，还需施加以下有限元分辨率约束：\n- 相位分辨率约束：每个有效自由度的边界法向相位前移必须满足 $k_n \\Delta x \\le \\varphi_{\\max}$，其中 $\\Delta x = h/p$ 且 $\\varphi_{\\max} = 0.5$ 弧度。\n- 衰减分辨率约束：每个有效自由度的边界法向振幅衰减必须满足 $\\operatorname{Im}(k_n s_x)\\Delta x \\le \\delta_{\\max}$，其中 $\\delta_{\\max} = 0.3$（无量纲），且 $\\operatorname{Im}(k_n s_x) = k_n a(x)$。\n\n除非衰减分辨率约束强制要求更严格的上限，否则假设标称设计选择为 $a_{\\max} = 1.0$。您必须确定：\n1. 在忽略离散化限制但使用指定的 $a(x)$ 剖面时，实现 $R_{\\text{target}}$ 的最小连续厚度估计 $L_{\\text{cont}}(\\theta)$。\n2. 在遵守相位和衰减分辨率约束（将后者视为 $a_{\\max}$ 的上限）的同时，实现 $R_{\\text{target}}$ 的最小有限元约束厚度 $L_{\\text{fem}}(\\theta)$。如果得到的 $L_{\\text{fem}}$ 小于单个 PML 单元的厚度 $h$，则设置 $L_{\\text{fem}} = h$ 以至少保留一个 PML 单元。\n\n您的程序必须计算以下测试套件中各情况的 $L_{\\text{fem}}$ 和 $L_{\\text{cont}}$（所有长度单位为米，角度单位为度，输出厚度单位为米）：\n- 情况 1 (理想情况): $\\lambda = 0.01$, $p = 4$, $h = 0.001$, $m = 3$, $\\theta = 89.9^\\circ$.\n- 情况 2 (衰减受限边缘情况): $\\lambda = 0.001$, $p = 3$, $h = 0.002$, $m = 3$, $\\theta = 89.9^\\circ$.\n- 情况 3 (中间状态): $\\lambda = 0.002$, $p = 10$, $h = 0.005$, $m = 3$, $\\theta = 89.9^\\circ$.\n- 情况 4 (细网格边界): $\\lambda = 0.01$, $p = 8$, $h = 0.0002$, $m = 3$, $\\theta = 89.9^\\circ$.\n\n您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔结果列表，顺序为 $[L_{\\text{fem},1},L_{\\text{cont},1},L_{\\text{fem},2},L_{\\text{cont},2},L_{\\text{fem},3},L_{\\text{cont},3},L_{\\text{fem},4},L_{\\text{cont},4}]$，每个厚度都以米表示。在计算 $\\cos\\theta$ 时，角度必须以度为单位进行解释。使用 $R_{\\text{target}} = 10^{-6}$ 和 $a_{\\max} = 1.0$，除非因衰减分辨率约束而减小。",
            "solution": "我们从无源、均匀、各向同性介质中的麦克斯韦方程组开始，对于角频率为 $\\omega$ 的时谐场，该方程组会产生平面波解。令 $\\mathbf{k}$ 表示波矢量，其大小为 $k = 2\\pi/\\lambda$，其中 $\\lambda$ 是波长。考虑一个平面截断边界，其外法线沿 $x$ 轴方向。以相对于边界法线成 $\\theta$ 角入射的平面波，其边界法向波数分量为 $k_n = k\\cos\\theta$。在掠射入射角 $\\theta = 89.9^\\circ$ 时，$\\cos\\theta$ 很小，因此 $k_n$ 也很小。\n\n完美匹配层 (PML) 可以被看作是边界法向上的复坐标伸展，$x \\mapsto \\bar{x}$，其伸展函数为 $s_x(x) = 1 + i a(x)$，其中 $a(x) \\ge 0$。在此变换下，波数的边界法向分量变为 $k_n s_x(x) = k_n \\left(1 + i a(x)\\right)$，其虚部 $\\operatorname{Im}\\left(k_n s_x(x)\\right) = k_n a(x)$ 会产生沿 $x$ 方向的指数振幅衰减。对于一条从 $x=0$ 到 $x=L$ 穿过 PML 并从终端反射的射线，其在入口平面的往返振幅反射的领头阶估计由累积衰减 $A$ 决定，其中\n$$\nA \\equiv \\int_0^L \\operatorname{Im}\\left(k_n s_x(x)\\right)\\,\\mathrm{d}x = \\int_0^L k_n a(x)\\,\\mathrm{d}x = k_n \\int_0^L a(x)\\,\\mathrm{d}x.\n$$\n假设由于完美匹配，入口处的失配可以忽略不计，则往返反射振幅的变化规律如下\n$$\nR \\approx \\exp\\!\\left(-2A\\right).\n$$\n为了强制满足 $R \\le R_{\\text{target}}$，我们需要\n$$\n2A \\ge \\ln\\!\\left(\\frac{1}{R_{\\text{target}}}\\right).\n$$\n\n我们选择一个标准的多项式衰减剖面 $a(x) = a_{\\max} (x/L)^m$，适用于 $x \\in [0,L]$，其中 $m \\in \\mathbb{N}$ 且 $a_{\\max} > 0$。$a(x)$ 在整个厚度上的积分为\n$$\n\\int_0^L a(x)\\,\\mathrm{d}x = a_{\\max} \\int_0^L \\left(\\frac{x}{L}\\right)^m \\mathrm{d}x = a_{\\max} L \\int_0^1 t^m \\,\\mathrm{d}t = a_{\\max} L \\frac{1}{m+1}.\n$$\n因此，累积衰减变为\n$$\nA = k_n a_{\\max} \\frac{L}{m+1}.\n$$\n施加条件 $\\exp(-2A) \\le R_{\\text{target}}$ 可得\n$$\n2 k_n a_{\\max} \\frac{L}{m+1} \\ge \\ln\\!\\left(\\frac{1}{R_{\\text{target}}}\\right),\n$$\n因此，最小连续厚度估计（忽略离散化限制）为\n$$\nL_{\\text{cont}}(\\theta) = \\frac{\\ln\\!\\left(\\frac{1}{R_{\\text{target}}}\\right)}{2 k_n} \\cdot \\frac{m+1}{a_{\\max}} = \\frac{\\ln\\!\\left(\\frac{1}{R_{\\text{target}}}\\right)}{2 k\\cos\\theta} \\cdot \\frac{m+1}{a_{\\max}}.\n$$\n\n在有限元法 (FEM) 离散化中，PML 区域的多项式阶数为 $p$，单元尺寸为 $h$，令有效自由度间距为 $\\Delta x = h/p$。数值精度对每个有效自由度的相位前移和衰减都施加了分辨率约束。我们强制执行：\n- 相位分辨率约束：\n$$\nk_n \\Delta x \\le \\varphi_{\\max},\n$$\n其中 $\\varphi_{\\max} = 0.5$ 弧度。此约束要求网格能够充分分辨边界法向的振荡。在本基准测试中，所选的测试用例满足此界限，因此不单独基于相位对 $L$ 进行调整。\n- 衰减分辨率约束：\n$$\n\\operatorname{Im}\\!\\left(k_n s_x\\right)\\Delta x = k_n a(x)\\Delta x \\le \\delta_{\\max},\n$$\n其中 $\\delta_{\\max} = 0.3$。由于 $a(x)$ 是单调递增的，其最大值为 $a_{\\max}$，因此在 $x=L$ 处满足该约束即可保证在所有位置都满足。这给出了 $a_{\\max}$ 的一个上界：\n$$\nk_n a_{\\max}\\Delta x \\le \\delta_{\\max}\n\\Rightarrow\na_{\\max} \\le \\frac{\\delta_{\\max}}{k_n \\Delta x}\n= \\frac{\\delta_{\\max} p}{k_n h}.\n$$\n我们采用标称设计 $a_{\\max}^{\\text{nom}} = 1.0$，并通过定义以下公式来强制执行衰减分辨率约束\n$$\na_{\\max}^{\\text{eff}} = \\min\\!\\left(a_{\\max}^{\\text{nom}}, \\frac{\\delta_{\\max} p}{k_n h}\\right).\n$$\n将 $a_{\\max}^{\\text{eff}}$ 代入连续厚度公式，得到有限元约束下的最小厚度\n$$\nL_{\\text{fem}}(\\theta) = \\frac{\\ln\\!\\left(\\frac{1}{R_{\\text{target}}}\\right)}{2 k\\cos\\theta} \\cdot \\frac{m+1}{a_{\\max}^{\\text{eff}}}.\n$$\n最后，为确保至少存在一个 PML 单元，我们强制执行\n$$\nL_{\\text{fem}} \\leftarrow \\max\\!\\left(L_{\\text{fem}},h\\right).\n$$\n\n每个测试用例的算法步骤：\n1. 计算 $k = 2\\pi/\\lambda$ 和 $k_n = k \\cos\\theta$，其中 $\\theta$ 以度为单位。\n2. 设置 $a_{\\max}^{\\text{nom}} = 1.0$，$\\varphi_{\\max} = 0.5$ 弧度，以及 $\\delta_{\\max} = 0.3$。\n3. 计算 $\\Delta x = h/p$。验证 $k_n \\Delta x \\le \\varphi_{\\max}$（所提供的测试套件满足此条件）。\n4. 计算 $a_{\\max}^{\\text{eff}} = \\min\\!\\left(1.0, \\delta_{\\max} p/(k_n h)\\right)$。\n5. 计算 $L_{\\text{cont}} = \\ln(1/R_{\\text{target}})\\big/\\left(2 k_n\\right) \\cdot (m+1)/a_{\\max}^{\\text{nom}}$。\n6. 计算 $L_{\\text{fem}} = \\ln(1/R_{\\text{target}})\\big/\\left(2 k_n\\right) \\cdot (m+1)/a_{\\max}^{\\text{eff}}$，然后设置 $L_{\\text{fem}} \\leftarrow \\max(L_{\\text{fem}}, h)$。\n\n通过报告每个测试用例的 $L_{\\text{fem}}$ 和 $L_{\\text{cont}}$ 来实现与解析估计的验证。当 $a_{\\max}^{\\text{eff}} = a_{\\max}^{\\text{nom}}$ 时，等式成立；否则，由于对 $a_{\\max}$ 的衰减分辨率上限，有 $L_{\\text{fem}} \\ge L_{\\text{cont}}$。在掠射入射角 $\\theta = 89.9^\\circ$ 时，因子 $\\cos\\theta$ 很小，因此连续估计和约束估计都可能很大，这凸显了在不使用复频率移动等额外技术的情况下，标准PML在掠射入射下面临的众所周知的困难。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_Ls(lambda_m, p, h, m, theta_deg, R_target=1e-6,\n               a_max_nom=1.0, delta_max=0.3, phi_max=0.5):\n    # Compute wavenumber and boundary-normal component\n    k = 2.0 * np.pi / lambda_m\n    theta_rad = np.deg2rad(theta_deg)\n    cos_theta = np.cos(theta_rad)\n    k_n = k * cos_theta\n\n    # Effective DOF spacing\n    dx = h / p\n\n    # Phase resolution check (not altering L, just for completeness)\n    # Ensure k_n * dx = phi_max; test cases are chosen to satisfy this.\n    # If violated, the FEM setup is under-resolved in phase.\n    # We proceed regardless but could flag or adjust in a more elaborate tool.\n\n    # Attenuation resolution constraint: k_n * a_max_eff * dx = delta_max\n    # => a_max_eff = delta_max / (k_n * dx) = delta_max * p / (k_n * h)\n    # Use nominal a_max unless limited by attenuation resolution.\n    # Handle extremely small k_n to avoid division by zero.\n    if k_n == 0.0:\n        # In pathological case (exact grazing or beyond), set huge L_fem and L_cont.\n        return float('inf'), float('inf')\n\n    a_lim = delta_max * p / (k_n * h)\n    a_max_eff = min(a_max_nom, a_lim)\n\n    # Continuous estimate with nominal a_max\n    L_cont = (np.log(1.0 / R_target) / (2.0 * k_n)) * ((m + 1) / a_max_nom)\n\n    # FEM-constrained estimate\n    L_fem = (np.log(1.0 / R_target) / (2.0 * k_n)) * ((m + 1) / a_max_eff)\n\n    # Ensure at least one PML element is present\n    L_fem = max(L_fem, h)\n\n    return L_fem, L_cont\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (lambda_m, p, h, m, theta_deg)\n    test_cases = [\n        (0.01, 4, 0.001, 3, 89.9),   # Case 1: happy path\n        (0.001, 3, 0.002, 3, 89.9),  # Case 2: attenuation-limited edge\n        (0.002, 10, 0.005, 3, 89.9), # Case 3: intermediate regime\n        (0.01, 8, 0.0002, 3, 89.9),  # Case 4: fine mesh boundary\n    ]\n\n    results = []\n    for lam, p, h, m, theta in test_cases:\n        L_fem, L_cont = compute_Ls(lam, p, h, m, theta)\n        results.append(L_fem)\n        results.append(L_cont)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}