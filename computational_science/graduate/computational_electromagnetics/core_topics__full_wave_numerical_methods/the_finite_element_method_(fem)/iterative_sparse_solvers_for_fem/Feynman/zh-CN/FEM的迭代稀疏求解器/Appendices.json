{
    "hands_on_practices": [
        {
            "introduction": "在应用迭代求解器之前，我们必须首先理解所处理矩阵的结构。本练习提供了一个基础性的动手实践机会，让您亲手构建求解麦克斯韦方程组的有限元方法（FEM）中的关键矩阵。我们将为一个简单但明确的网格手动构建离散旋度算子（关联矩阵 $C$）和质量矩阵（$M$）。通过完成此构建过程，您将具体理解网格拓扑和单元几何如何转化为最终系统矩阵的稀疏结构，这是计算电磁学中至关重要的第一步。",
            "id": "3321760",
            "problem": "考虑在一个小网格上，在一个协调边元（Whitney $1$-形式）有限元空间中，用于横向电场近似的二维空间频域麦克斯韦旋度-旋度公式。设计算域由三个逆时针方向的三角形剖分，其顶点坐标如下：\n$$\n\\mathbf{v}_{0}=(0,0),\\quad \\mathbf{v}_{1}=(1,0),\\quad \\mathbf{v}_{2}=(0,1),\\quad \\mathbf{v}_{3}=(1,1),\\quad \\mathbf{v}_{4}=(2,0).\n$$\n单元（面）为：\n$$\nK_{1}=\\triangle(\\mathbf{v}_{0},\\mathbf{v}_{1},\\mathbf{v}_{2}),\\quad K_{2}=\\triangle(\\mathbf{v}_{1},\\mathbf{v}_{3},\\mathbf{v}_{2}),\\quad K_{3}=\\triangle(\\mathbf{v}_{1},\\mathbf{v}_{4},\\mathbf{v}_{3}).\n$$\n使用与全局定向边相关的最低阶 Nedelec（Whitney $1$-形式）基函数。定义以下全局定向边集和自由度（DOF）的排序：\n$$\ne_{1}=(\\mathbf{v}_{0}\\rightarrow\\mathbf{v}_{1}),\\quad\ne_{2}=(\\mathbf{v}_{0}\\rightarrow\\mathbf{v}_{2}),\\quad\ne_{3}=(\\mathbf{v}_{1}\\rightarrow\\mathbf{v}_{2}),\\quad\ne_{4}=(\\mathbf{v}_{1}\\rightarrow\\mathbf{v}_{3}),\\quad\ne_{5}=(\\mathbf{v}_{2}\\rightarrow\\mathbf{v}_{3}),\\quad\ne_{6}=(\\mathbf{v}_{1}\\rightarrow\\mathbf{v}_{4}),\\quad\ne_{7}=(\\mathbf{v}_{3}\\rightarrow\\mathbf{v}_{4}).\n$$\n设磁导率在 $K_{k}$ 上为分片常数 $\\mu(\\mathbf{x})=\\mu_{k}>0$（其中 $k\\in\\{1,2,3\\}$），介电常数在 $K_{k}$ 上为分片常数 $\\epsilon(\\mathbf{x})=\\epsilon_{k}>0$（其中 $k\\in\\{1,2,3\\}$）。用 $\\omega>0$ 表示角频率。在弱形式中，旋度-旋度算子由矩阵表示\n$$\nA = C^{\\top} M_{\\mu^{-1}} C,\n$$\n其中 $C$ 是由所选的全局边方向和逆时针面方向导出的面-边关联（离散旋度）矩阵，而 $M_{\\mu^{-1}}$ 是作用于 2-形式（面）且权重为 $\\mu^{-1}$ 的 $L^{2}$ Hodge 星算子。作用于边（Whitney $1$-形式）且权重为 $\\epsilon$ 的 $L^{2}$ Hodge 星算子是质量矩阵 $M_{\\epsilon}$。\n\n从麦克斯韦方程组和弱 $H(\\mathrm{curl})$ 形式出发，并根据 Whitney $1$-形式的重心坐标定义，对上述网格和自由度排序完成以下所有任务：\n\n1. 使用给定的全局边方向和逆时针面方向，显式构造面-边关联矩阵 $C\\in\\mathbb{R}^{3\\times 7}$。\n2. 利用 $\\mu$ 在每个三角形上的常数特性以及 Whitney 1-形式在三角形上的分片常数旋度，构造 $M_{\\mu^{-1}}\\in\\mathbb{R}^{3\\times 3}$。\n3. 在每个三角形上使用重心坐标以及 Whitney $1$-形式的定义 $w_{ij}=\\lambda_{i}\\nabla\\lambda_{j}-\\lambda_{j}\\nabla\\lambda_{i}$，计算每个单元 $K_{1}$、$K_{2}$ 和 $K_{3}$ 上权重为 $\\epsilon_{k}$ 的局部 $3\\times 3$ 边质量矩阵，并将它们组装成全局边质量矩阵 $M_{\\epsilon}\\in\\mathbb{R}^{7\\times 7}$。\n4. 确定矩阵 $A+\\omega^{2} M_{\\epsilon}$ 的精确稀疏模式（零/非零结构），并在指定的自由度排序 $e_{1},\\dots,e_{7}$ 下，计算其半带宽 $b$，定义为\n$$\nb=\\max\\{\\,|i-j|:\\ (A+\\omega^{2}M_{\\epsilon})_{ij}\\neq 0\\,\\}.\n$$\n\n报告单个整数 $b$ 作为最终答案。无需四舍五入。最终报告值中不包含单位。",
            "solution": "用户在计算电磁学领域提供了一个定义明确的问题。该问题要求计算一个特定二维网格的有限元系统矩阵的半带宽。我将按照问题陈述中概述的四个任务进行。\n\n网格的顶点由下式给出：\n$$\n\\mathbf{v}_{0}=(0,0),\\quad \\mathbf{v}_{1}=(1,0),\\quad \\mathbf{v}_{2}=(0,1),\\quad \\mathbf{v}_{3}=(1,1),\\quad \\mathbf{v}_{4}=(2,0).\n$$\n单元（三角形）为：\n$$\nK_{1}=\\triangle(\\mathbf{v}_{0},\\mathbf{v}_{1},\\mathbf{v}_{2}),\\quad K_{2}=\\triangle(\\mathbf{v}_{1},\\mathbf{v}_{3},\\mathbf{v}_{2}),\\quad K_{3}=\\triangle(\\mathbf{v}_{1},\\mathbf{v}_{4},\\mathbf{v}_{3}).\n$$\n全局排序和定向的边（自由度）为：\n$$\ne_{1}=(\\mathbf{v}_{0}\\rightarrow\\mathbf{v}_{1}),\\quad\ne_{2}=(\\mathbf{v}_{0}\\rightarrow\\mathbf{v}_{2}),\\quad\ne_{3}=(\\mathbf{v}_{1}\\rightarrow\\mathbf{v}_{2}),\\quad\ne_{4}=(\\mathbf{v}_{1}\\rightarrow\\mathbf{v}_{3}),\\quad\ne_{5}=(\\mathbf{v}_{2}\\rightarrow\\mathbf{v}_{3}),\\quad\ne_{6}=(\\mathbf{v}_{1}\\rightarrow\\mathbf{v}_{4}),\\quad\ne_{7}=(\\mathbf{v}_{3}\\rightarrow\\mathbf{v}_{4}).\n$$\n\n最终目标是确定矩阵 $S = A+\\omega^{2} M_{\\epsilon}$ 的半带宽 $b$，定义为 $b=\\max\\{\\,|i-j|:\\ S_{ij}\\neq 0\\,\\}$。$S$ 的稀疏模式是 $A$ 和 $M_{\\epsilon}$ 的稀疏模式的并集，假设对于任意正的材料参数 $\\mu_k, \\epsilon_k$ 和频率 $\\omega$，没有偶然的抵消。如果对于这些参数的一般选择，一个元素是非零的，则认为该元素是结构上非零的。\n\n**1. 面-边关联矩阵 $C$ 的构造**\n\n面-边关联矩阵 $C \\in \\mathbb{R}^{3\\times 7}$ 编码了面（单元）和边之间的拓扑关系。如果边 $e_i$ 是面 $K_k$ 边界的一部分且方向匹配（对于面是逆时针），则元素 $C_{ki}$ 为 $+1$；如果方向相反，则为 $-1$；如果边不在面的边界上，则为 $0$。\n\n- **面 $K_1 = \\triangle(\\mathbf{v}_0, \\mathbf{v}_1, \\mathbf{v}_2)$：** 逆时针边界为 $\\mathbf{v}_0 \\to \\mathbf{v}_1 \\to \\mathbf{v}_2 \\to \\mathbf{v}_0$。\n  - 边 $e_1 = (\\mathbf{v}_0 \\to \\mathbf{v}_1)$：方向匹配。$C_{11} = +1$。\n  - 边 $e_3 = (\\mathbf{v}_1 \\to \\mathbf{v}_2)$：方向匹配。$C_{13} = +1$。\n  - 边 $e_2 = (\\mathbf{v}_0 \\to \\mathbf{v}_2)$：与边界段 $(\\mathbf{v}_2 \\to \\mathbf{v}_0)$ 方向相反。$C_{12} = -1$。\n  - $C$ 的第 1 行为 $\\begin{pmatrix} 1  -1  1  0  0  0  0 \\end{pmatrix}$。\n\n- **面 $K_2 = \\triangle(\\mathbf{v}_1, \\mathbf{v}_3, \\mathbf{v}_2)$：** 逆时针边界为 $\\mathbf{v}_1 \\to \\mathbf{v}_3 \\to \\mathbf{v}_2 \\to \\mathbf{v}_1$。\n  - 边 $e_4 = (\\mathbf{v}_1 \\to \\mathbf{v}_3)$：方向匹配。$C_{24} = +1$。\n  - 边 $e_5 = (\\mathbf{v}_2 \\to \\mathbf{v}_3)$：与边界段 $(\\mathbf{v}_3 \\to \\mathbf{v}_2)$ 方向相反。$C_{25} = -1$。\n  - 边 $e_3 = (\\mathbf{v}_1 \\to \\mathbf{v}_2)$：与边界段 $(\\mathbf{v}_2 \\to \\mathbf{v}_1)$ 方向相反。$C_{23} = -1$。\n  - $C$ 的第 2 行为 $\\begin{pmatrix} 0  0  -1  1  -1  0  0 \\end{pmatrix}$。\n\n- **面 $K_3 = \\triangle(\\mathbf{v}_1, \\mathbf{v}_4, \\mathbf{v}_3)$：** 逆时针边界为 $\\mathbf{v}_1 \\to \\mathbf{v}_4 \\to \\mathbf{v}_3 \\to \\mathbf{v}_1$。\n  - 边 $e_6 = (\\mathbf{v}_1 \\to \\mathbf{v}_4)$：方向匹配。$C_{36} = +1$。\n  - 边 $e_7 = (\\mathbf{v}_3 \\to \\mathbf{v}_4)$：与边界段 $(\\mathbf{v}_4 \\to \\mathbf{v}_3)$ 方向相反。$C_{37} = -1$。\n  - 边 $e_4 = (\\mathbf{v}_1 \\to \\mathbf{v}_3)$：与边界段 $(\\mathbf{v}_3 \\to \\mathbf{v}_1)$ 方向相反。$C_{34} = -1$。\n  - $C$ 的第 3 行为 $\\begin{pmatrix} 0  0  0  -1  0  1  -1 \\end{pmatrix}$。\n\n结合这些行，矩阵 $C$ 是：\n$$\nC = \\begin{pmatrix}\n1  -1  1  0  0  0  0 \\\\\n0  0  -1  1  -1  0  0 \\\\\n0  0  0  -1  0  1  -1\n\\end{pmatrix}\n$$\n\n**2. 矩阵 $M_{\\mu^{-1}}$ 的构造**\n\n矩阵 $M_{\\mu^{-1}}$ 是从 2-形式（面）映射到对偶 0-形式的 Hodge 星矩阵。对于一个由每个单元（面）上的特征函数构成的 2-形式基，且材料属性 $\\mu_k$ 在单元 $K_k$ 上为分片常数，这个矩阵是对角的。其元素由 $(M_{\\mu^{-1}})_{kk} = |K_k| / \\mu_k$ 给出，其中 $|K_k|$ 是单元 $K_k$ 的面积。我们来计算三角形的面积。\n- $|K_1| = \\frac{1}{2} | \\det(\\mathbf{v}_1 - \\mathbf{v}_0, \\mathbf{v}_2 - \\mathbf{v}_0) | = \\frac{1}{2} | \\det\\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} | = \\frac{1}{2}$。\n- $|K_2| = \\frac{1}{2} | \\det(\\mathbf{v}_3 - \\mathbf{v}_1, \\mathbf{v}_2 - \\mathbf{v}_1) | = \\frac{1}{2} | \\det\\begin{pmatrix} 0  -1 \\\\ 1  1 \\end{pmatrix} | = \\frac{1}{2}$。\n- $|K_3| = \\frac{1}{2} | \\det(\\mathbf{v}_4 - \\mathbf{v}_1, \\mathbf{v}_3 - \\mathbf{v}_1) | = \\frac{1}{2} | \\det\\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix} | = \\frac{1}{2}$。\n\n所有单元的面积均为 $1/2$。因此，$M_{\\mu^{-1}}$ 是一个 $3 \\times 3$ 的对角矩阵：\n$$\nM_{\\mu^{-1}} = \\begin{pmatrix}\n\\frac{1}{2\\mu_1}  0  0 \\\\\n0  \\frac{1}{2\\mu_2}  0 \\\\\n0  0  \\frac{1}{2\\mu_3}\n\\end{pmatrix}\n$$\n由于 $\\mu_k > 0$，所有对角元素都非零。\n\n**3.  4. $A+\\omega^{2} M_{\\epsilon}$ 的稀疏模式和半带宽**\n\n我们首先确定 $A = C^{\\top} M_{\\mu^{-1}} C$ 的稀疏模式。元素 $A_{ij}$ 由下式给出：\n$$\nA_{ij} = (C^{\\top} M_{\\mu^{-1}} C)_{ij} = \\sum_{k=1}^3 \\sum_{l=1}^3 (C^{\\top})_{ik} (M_{\\mu^{-1}})_{kl} C_{lj}\n$$\n由于 $M_{\\mu^{-1}}$ 是对角的，这可以简化为：\n$$\nA_{ij} = \\sum_{k=1}^3 C_{ki} (M_{\\mu^{-1}})_{kk} C_{kj}\n$$\n元素 $A_{ij}$ 非零，当且仅当存在至少一个单元 $K_k$ 使得 $C_{ki} \\neq 0$ 和 $C_{kj} \\neq 0$ 都成立。这意味着边 $e_i$ 和 $e_j$ 必须是一个公共单元 $K_k$ 边界的一部分。这就是“共面”关系。\n\n接下来，我们确定质量矩阵 $M_{\\epsilon}$ 的稀疏模式。其元素由下式给出：\n$$\n(M_\\epsilon)_{ij} = \\int_\\Omega \\epsilon(\\mathbf{x}) \\mathbf{w}_i \\cdot \\mathbf{w}_j \\, d\\Omega = \\sum_{k=1}^3 \\int_{K_k} \\epsilon_k \\mathbf{w}_i \\cdot \\mathbf{w}_j \\, d\\Omega\n$$\n其中 $\\mathbf{w}_i$ 是与边 $e_i$ 相关的 Whitney 1-形式基函数。$\\mathbf{w}_i$ 的支集是与 $e_i$ 相邻的单元的并集。积分 $\\int_{K_k} \\mathbf{w}_i \\cdot \\mathbf{w}_j \\, d\\Omega$ 非零，仅当 $\\mathbf{w}_i$ 和 $\\mathbf{w}_j$ 在单元 $K_k$ 上都非零。这成立的充分必要条件是边 $e_i$ 和 $e_j$ 都是单元 $K_k$ 的边。因此，对于一般的网格和正的材料属性，$(M_\\epsilon)_{ij}$ 非零，当且仅当边 $e_i$ 和 $e_j$ 是共面的。\n\n$A$ 和 $M_\\epsilon$ 都具有相同的稀疏模式，该模式由共面的边-边关系定义。系统矩阵 $S = A+\\omega^{2} M_{\\epsilon}$ 也将具有相同的稀疏模式，因为对于任意正的 $\\mu_k, \\epsilon_k, \\omega$，不会因抵消而产生结构性零值。\n\n元素 $S_{ij}$ 非零，当且仅当边 $e_i$ 和 $e_j$ 属于同一个三角形。我们为每个三角形确定边的索引集：\n- $K_1$：边为 $e_1, e_2, e_3$。索引集为 $\\{1, 2, 3\\}$。\n- $K_2$：边为 $e_3, e_4, e_5$。索引集为 $\\{3, 4, 5\\}$。\n- $K_3$：边为 $e_4, e_6, e_7$。索引集为 $\\{4, 6, 7\\}$。\n\n矩阵 $S$ 中的非零项 $(i,j)$ 是那些 $i$ 和 $j$ 同属于这些集合之一的项。我们现在通过检查每个集合内的最大索引差来找到半带宽 $b=\\max\\{\\,|i-j|:\\ S_{ij}\\neq 0\\,\\}$。\n- 对于 $\\{1, 2, 3\\}$：最大差值为 $|3-1| = 2$。\n- 对于 $\\{3, 4, 5\\}$：最大差值为 $|5-3| = 2$。\n- 对于 $\\{4, 6, 7\\}$：最大差值为 $|7-4| = 3$。\n\n总的最大差值是这些值中的最大者。\n$$\nb = \\max(2, 2, 3) = 3.\n$$\n这个最大差值出现在索引对 $(4, 7)$ 上。边 $e_4$ 和 $e_7$ 都是三角形 $K_3$ 的一部分，所以元素 $S_{47}$（和 $S_{74}$）是非零的。差值 $|4-7|=3$ 对半带宽有贡献。没有其他共面边对具有更大的索引差。",
            "answer": "$$\\boxed{3}$$"
        },
        {
            "introduction": "有了系统矩阵 $A$ 之后，下一步是求解方程 $Ax=b$。对于有限元方法中常见的大型、稀疏、对称正定（SPD）矩阵，共轭梯度（CG）法是首选的求解器。本练习深入探讨了 CG 算法的内在机理及收敛理论，将其性能与系统矩阵的谱特性（特征值）直接联系起来。推导 CG 算法的递推关系及其收敛界，将阐明为何预处理对于实际问题至关重要，以及它如何通过改善系统的有效条件数来发挥作用。",
            "id": "3321767",
            "problem": "考虑一个单连通的理想导电腔体中的频域麦克斯韦旋度-旋度方程，其中电场具有正的、空间变化的材料参数：磁导率和介电常数。设其弱形式通过有限元法 (FEM) 在协调的四面体网格上使用一阶 Nédélec 边元进行离散化，得到稀疏线性系统\n$$\nA x = b,\n$$\n其中对称正定 (SPD) 系统矩阵是质量增广的旋度-旋度算子\n$$\nA = C^{\\top} \\Lambda C + \\eta M.\n$$\n这里，$C$ 是离散旋度算子，$\\Lambda$ 是逆磁导率权重的对角矩阵，$M$ 是与介电常数相关的 $L^{2}$ 质量矩阵，$\\eta > 0$ 是一个严格为正的增广参数。假设在切向意义上采用齐次狄利克雷边界条件以确保强制性。设 $A$ 通过共轭梯度 (CG) 法求解。\n\n从 CG 的 Galerkin 最优性原理出发——即第 $k$ 次迭代在由克雷洛夫子空间张成的仿射空间上最小化误差的 $A$-范数——推导应用于 $A$ 的 CG 短程递推关系，包括：\n- 搜索方向的三项更新。\n- 以可通过稀疏矩阵向量运算实现的内积形式表示的步长和递推系数。\n\n然后，考虑使用一个 SPD 预条件子 $P$ 进行左预处理：用预处理共轭梯度 (PCG) 法求解\n$$\nP^{-1} A x = P^{-1} b\n$$\n利用 CG 的多项式逼近视角和切比雪夫多项式的极值性质，证明预处理算子 $P^{-1} A$ 的谱如何决定 $k$ 次迭代后误差 $A$-范数的渐近界，并用 $P^{-1} A$ 的条件数给出该界的闭式形式。\n\n最后，对于一个构造的预条件子 $P$，使得 $P^{-1} A$ 的谱完全位于区间 $[\\theta_{\\min}, \\theta_{\\max}] = [0.5, 2]$ 内，计算经过 $k = 20$ 次 PCG 迭代后，误差 $A$-范数缩减的理论上界因子。将您的答案四舍五入到四位有效数字。将最终值表示为一个无量纲数。",
            "solution": "该问题被评估为有效，因为它具有科学依据、适定、客观、自洽且一致。它代表了计算科学领域数值线性代数中的一个标准问题。\n\n该问题按要求分三部分解决：共轭梯度 (CG) 算法的推导、预处理共轭梯度 (PCG) 收敛性分析以及最终的数值计算。\n\n### 第一部分：共轭梯度 (CG) 算法的推导\n\n共轭梯度法为方程 $Ax=b$ 的解生成一个近似序列 $x_k$。它基于嵌套克雷洛夫子空间上的 Galerkin 最优性原理。对于初始猜测 $x_0$ 和初始残差 $r_0 = b - Ax_0$，第 $k$ 次迭代解 $x_k$ 从仿射空间 $x_0 + \\mathcal{K}_k(A, r_0)$ 中选取，使得误差 $e_k = x - x_k$ 在 $A$-范数（定义为 $\\|e_k\\|_A = \\sqrt{e_k^\\top A e_k}$）下最小。克雷洛夫子空间为 $\\mathcal{K}_k(A, r_0) = \\text{span}\\{r_0, Ar_0, \\dots, A^{k-1}r_0\\}$。\n\n这种最小化等价于 Galerkin 条件，即残差 $r_k = b - Ax_k = -Ae_k$ 与子空间 $\\mathcal{K}_k(A, r_0)$ 正交：\n$$\nr_k^\\top v = 0 \\quad \\forall v \\in \\mathcal{K}_k(A, r_0)\n$$\n\nCG 算法构造了一系列搜索方向 $\\{p_0, p_1, \\dots, p_{k-1}\\}$，它们构成 $\\mathcal{K}_k(A, r_0)$ 的一个 $A$-正交基，即当 $i \\neq j$ 时 $p_i^\\top A p_j = 0$。迭代解更新如下：\n$$\nx_{k+1} = x_k + \\alpha_k p_k\n$$\n其中 $\\alpha_k$ 是步长。相应的残差更新为：\n$$\nr_{k+1} = b - A x_{k+1} = b - A(x_k + \\alpha_k p_k) = (b - A x_k) - \\alpha_k A p_k = r_k - \\alpha_k A p_k\n$$\n\n为了推导系数的表达式，我们利用算法的性质。\n新的搜索方向 $p_k$ 被构造成与先前的方向 $A$-正交，同时位于子空间 $\\mathcal{K}_{k+1}(A, r_0)$ 中。搜索方向的标准的“短程递推”是一种两项更新形式：\n$$\np_k = r_k + \\beta_{k-1} p_{k-1} \\quad (p_0 = r_0)\n$$\n\n**1. 步长 $\\alpha_k$ 的推导**\n选择步长 $\\alpha_k$ 以最小化 $\\|e_{k+1}\\|_A$。当 $e_{k+1}$ 与搜索方向 $p_k$ $A$-正交时，即达到最小化。\n$$\ne_{k+1} = x - x_{k+1} = x - (x_k + \\alpha_k p_k) = e_k - \\alpha_k p_k\n$$\n$A$-正交性条件为 $\\langle e_{k+1}, p_k \\rangle_A = 0$：\n$$\n0 = e_{k+1}^\\top A p_k = (e_k - \\alpha_k p_k)^\\top A p_k = e_k^\\top A p_k - \\alpha_k p_k^\\top A p_k\n$$\n解出 $\\alpha_k$：\n$$\n\\alpha_k = \\frac{e_k^\\top A p_k}{p_k^\\top A p_k} = \\frac{(A e_k)^\\top p_k}{p_k^\\top A p_k} = \\frac{(-r_k)^\\top p_k}{p_k^\\top A p_k}\n$$\n根据构造 $p_k = r_k + \\beta_{k-1}p_{k-1}$，我们有 $p_k^\\top r_k = (r_k + \\beta_{k-1}p_{k-1})^\\top r_k = r_k^\\top r_k + \\beta_{k-1}p_{k-1}^\\top r_k$。\n第 $k$ 次迭代的 Galerkin 条件表明 $r_k \\perp \\mathcal{K}_k(A, r_0)$。由于 $p_{k-1} \\in \\mathcal{K}_k(A, r_0)$，我们有 $p_{k-1}^\\top r_k = 0$。\n因此，$p_k^\\top r_k = r_k^\\top r_k$。将此代入分子：\n$$\n\\alpha_k = \\frac{r_k^\\top r_k}{p_k^\\top A p_k}\n$$\n这个表达式是可实现的，因为它只涉及内积和一次稀疏矩阵向量乘积 ($Ap_k$)。\n\n**2. 递推系数 $\\beta_k$ 的推导**\n搜索方向更新 $p_{k+1} = r_{k+1} + \\beta_k p_k$ 中的系数 $\\beta_k$ 被选择以强制 $p_{k+1}$ 和 $p_k$ 的 $A$-正交性：\n$$\n0 = p_{k+1}^\\top A p_k = (r_{k+1} + \\beta_k p_k)^\\top A p_k = r_{k+1}^\\top A p_k + \\beta_k p_k^\\top A p_k\n$$\n解出 $\\beta_k$：\n$$\n\\beta_k = -\\frac{r_{k+1}^\\top A p_k}{p_k^\\top A p_k}\n$$\n从残差更新可知，$A p_k = \\frac{1}{\\alpha_k}(r_k - r_{k+1})$。将其代入分子：\n$$\nr_{k+1}^\\top A p_k = r_{k+1}^\\top \\frac{1}{\\alpha_k}(r_k - r_{k+1}) = \\frac{1}{\\alpha_k} (r_{k+1}^\\top r_k - r_{k+1}^\\top r_{k+1})\n$$\nCG 的一个基本性质是残差的正交性：当 $i \\neq j$ 时，$r_i^\\top r_j = 0$。这可以从 Galerkin 条件推导得出：对于 $j  k$，$r_j \\in \\mathcal{K}_{j+1}(A, r_0) \\subset \\mathcal{K}_k(A, r_0)$，所以 $r_k^\\top r_j = 0$。\n因此，$r_{k+1}^\\top r_k = 0$，分子简化为 $-\\frac{1}{\\alpha_k} r_{k+1}^\\top r_{k+1}$。\n将此代回 $\\beta_k$ 的表达式：\n$$\n\\beta_k = - \\frac{-\\frac{1}{\\alpha_k} r_{k+1}^\\top r_{k+1}}{p_k^\\top A p_k} = \\frac{r_{k+1}^\\top r_{k+1}}{\\alpha_k (p_k^\\top A p_k)}\n$$\n使用 $\\alpha_k$ 的表达式，我们有 $\\alpha_k(p_k^\\top A p_k) = r_k^\\top r_k$。因此：\n$$\n\\beta_k = \\frac{r_{k+1}^\\top r_{k+1}}{r_k^\\top r_k}\n$$\n\n题目要求“搜索方向的三项更新”。标准的 CG 算法采用两项递推 $p_{k+1} = r_{k+1} + \\beta_k p_k$。这个名称可以被解释为涉及三个不同向量项（$p_{k+1}$、$r_{k+1}$、$p_k$）的更新。然而，在数值分析中，“三项递推”通常意味着形如 $v_{k+1} = c_k^{(1)} v_k + c_k^{(2)} v_{k-1}$ 的关系。残差 $\\{r_k\\}$ 确实满足这样的递推关系，这源于底层的 Lanczos 过程的三项递推。搜索方向 $\\{p_k\\}$ 也可以被证明满足一个更复杂的三项递推关系，但两项更新是标准算法高效性的关键。\n\n### 第二部分：PCG 收敛性分析\n\n对于预处理系统 $P^{-1}Ax = P^{-1}b$，其中 $P$ 是一个 SPD 预条件子，我们应用 PCG 方法。这等价于对一个算子为 SPD 的变换后的系统应用标准 CG 方法。设 $P = L_P L_P^\\top$ 是 $P$ 的 Cholesky 分解。该系统等价于：\n$$\n(L_P^{-1} A L_P^{-\\top}) (L_P^\\top x) = L_P^{-1} b\n$$\n令 $\\hat{A} = L_P^{-1} A L_P^{-\\top}$，$\\hat{x} = L_P^\\top x$，以及 $\\hat{b} = L_P^{-1} b$。我们使用 CG 求解 $\\hat{A}\\hat{x} = \\hat{b}$。矩阵 $\\hat{A}$ 是 SPD。$\\hat{A}$ 的特征值与预处理矩阵 $P^{-1}A$ 的特征值相同。\n\n对这个带帽系统的 CG 收敛性是用其误差 $\\hat{e}_k = \\hat{x} - \\hat{x}_k$ 的 $\\hat{A}$-范数来衡量的。这个范数直接关系到原始误差 $e_k = x - x_k$ 的 $A$-范数：\n$$\n\\|\\hat{e}_k\\|_{\\hat{A}}^2 = \\hat{e}_k^\\top \\hat{A} \\hat{e}_k = (L_P^\\top e_k)^\\top (L_P^{-1} A L_P^{-\\top}) (L_P^\\top e_k) = e_k^\\top L_P L_P^{-1} A L_P^{-\\top} L_P^\\top e_k = e_k^\\top A e_k = \\|e_k\\|_A^2\n$$\n因此，最小化 $\\|\\hat{e}_k\\|_{\\hat{A}}$ 等价于最小化 $\\|e_k\\|_A$。\n\n从多项式逼近的视角来看，CG 在 $k$ 次迭代后的误差由 $\\hat{e}_k = \\mathcal{P}_k(\\hat{A})\\hat{e}_0$ 给出，其中 $\\mathcal{P}_k$ 是一个次数至多为 $k$ 且满足 $\\mathcal{P}_k(0)=1$ 的多项式。CG 找到那个能够最小化误差的 $\\hat{A}$-范数的特定多项式。这给出了如下界：\n$$\n\\frac{\\|\\hat{e}_k\\|_{\\hat{A}}}{\\|\\hat{e}_0\\|_{\\hat{A}}} = \\frac{\\|e_k\\|_A}{\\|e_0\\|_A} \\le \\min_{\\mathcal{P}_k \\in \\Pi_k^1} \\max_{\\lambda \\in \\sigma(\\hat{A})} |\\mathcal{P}_k(\\lambda)|\n$$\n其中 $\\Pi_k^1$ 是次数至多为 $k$ 且满足 $\\mathcal{P}_k(0)=1$ 的多项式集合。\n\n设 $\\hat{A}$（也就是 $P^{-1}A$）的谱包含在区间 $[\\lambda_{\\min}, \\lambda_{\\max}]$ 内。该界变为：\n$$\n\\frac{\\|e_k\\|_A}{\\|e_0\\|_A} \\le \\min_{\\mathcal{P}_k \\in \\Pi_k^1} \\max_{z \\in [\\lambda_{\\min}, \\lambda_{\\max}]} |\\mathcal{P}_k(z)|\n$$\n这个极小化极大问题可以通过一个经过缩放和平移的第一类切比雪夫多项式 $T_k(y)$ 来解决。最优多项式由下式给出：\n$$\n\\mathcal{P}_k(z) = \\frac{T_k\\left(\\frac{\\lambda_{\\max}+\\lambda_{\\min}-2z}{\\lambda_{\\max}-\\lambda_{\\min}}\\right)}{T_k\\left(\\frac{\\lambda_{\\max}+\\lambda_{\\min}}{\\lambda_{\\max}-\\lambda_{\\min}}\\right)}\n$$\n这个多项式满足 $\\mathcal{P}_k(0)=1$。对于 $y \\in [-1, 1]$，$|T_k(y)|$ 的最大值是 $1$。该变换将 $z \\in [\\lambda_{\\min}, \\lambda_{\\max}]$ 映射到 $y \\in [-1, 1]$。因此，$|\\mathcal{P}_k(z)|$ 在谱区间上的最大值由分母给出。令 $\\kappa = \\lambda_{\\max}/\\lambda_{\\min}$ 为预处理算子 $P^{-1}A$ 的条件数。\n$$\n\\frac{\\lambda_{\\max}+\\lambda_{\\min}}{\\lambda_{\\max}-\\lambda_{\\min}} = \\frac{\\kappa+1}{\\kappa-1}\n$$\n于是收敛界为：\n$$\n\\frac{\\|e_k\\|_A}{\\|e_0\\|_A} \\le \\frac{1}{T_k\\left(\\frac{\\kappa+1}{\\kappa-1}\\right)}\n$$\n对于自变量 $|y|1$，切比雪夫多项式由 $T_k(y) = \\cosh(k \\cdot \\text{arccosh}(y))$ 给出。\n这导出了众所周知的渐近界，通常表示为 $2\\left(\\frac{\\sqrt{\\kappa}-1}{\\sqrt{\\kappa}+1}\\right)^k$。\n\n### 第三部分：数值计算\n\n已知：预处理算子 $P^{-1}A$ 的谱完全位于区间 $[\\theta_{\\min}, \\theta_{\\max}] = [0.5, 2]$ 内。PCG 迭代次数为 $k=20$。\n\n任务是计算误差 $A$-范数缩减的理论上界因子，即上述推导出的界的值。\n\n1.  **条件数**：\n    预处理矩阵的条件数为 $\\kappa = \\frac{\\theta_{\\max}}{\\theta_{\\min}} = \\frac{2}{0.5} = 4$。\n\n2.  **切比雪夫多项式的自变量**：\n    自变量为 $\\frac{\\kappa+1}{\\kappa-1} = \\frac{4+1}{4-1} = \\frac{5}{3}$。\n\n3.  **计算上界**：\n    上界因子为 $\\frac{1}{T_{20}(5/3)}$。我们使用公式 $T_k(y) = \\cosh(k \\cdot \\text{arccosh}(y))$。\n    首先，计算 $\\text{arccosh}(5/3)$：\n    令 $u = \\text{arccosh}(5/3)$。这意味着 $\\cosh(u) = 5/3$。\n    对于 $y \\ge 1$，使用恒等式 $\\text{arccosh}(y) = \\ln(y + \\sqrt{y^2-1})$：\n    $$\n    u = \\ln\\left(\\frac{5}{3} + \\sqrt{\\left(\\frac{5}{3}\\right)^2 - 1}\\right) = \\ln\\left(\\frac{5}{3} + \\sqrt{\\frac{25}{9} - \\frac{9}{9}}\\right) = \\ln\\left(\\frac{5}{3} + \\sqrt{\\frac{16}{9}}\\right) = \\ln\\left(\\frac{5}{3} + \\frac{4}{3}\\right) = \\ln(3)\n    $$\n    现在，计算 $T_{20}(5/3)$：\n    $$\n    T_{20}(5/3) = \\cosh(20 \\cdot \\text{arccosh}(5/3)) = \\cosh(20 \\ln 3)\n    $$\n    使用定义 $\\cosh(z) = \\frac{\\exp(z) + \\exp(-z)}{2}$：\n    $$\n    \\cosh(20 \\ln 3) = \\frac{\\exp(20 \\ln 3) + \\exp(-20 \\ln 3)}{2} = \\frac{\\exp(\\ln 3^{20}) + \\exp(\\ln 3^{-20})}{2} = \\frac{3^{20} + 3^{-20}}{2}\n    $$\n    上界因子是该值的倒数：\n    $$\n    \\text{上界因子} = \\frac{1}{\\frac{3^{20} + 3^{-20}}{2}} = \\frac{2}{3^{20} + 3^{-20}}\n    $$\n\n4.  **数值**：\n    我们计算该表达式的值：\n    $$\n    3^{20} = (3^{10})^2 = (59049)^2 = 3,486,784,401\n    $$\n    $3^{-20}$ 的值极小，对于这个精度水平，它对总和的贡献可以忽略不计。\n    $$\n    \\text{上界因子} = \\frac{2}{3486784401 + \\frac{1}{3486784401}} \\approx \\frac{2}{3486784401} \\approx 5.73596... \\times 10^{-10}\n    $$\n    四舍五入到四位有效数字，我们得到 $5.736 \\times 10^{-10}$。",
            "answer": "$$\n\\boxed{5.736 \\times 10^{-10}}\n$$"
        },
        {
            "introduction": "真实的工程问题通常涉及复杂的几何形状和材料属性，这需要非协调网格和强大的预条件子等先进技术。本练习将理论付诸实践，要求您完整实现一个双网格求解器，这是完整多重网格方法的前身。您将为一个预处理共轭梯度（PCG）求解器实现一个双网格预条件子，处理带悬挂节点的非协调网格，并比较伽辽金（Galerkin）与再离散化这两种关键的粗网格算子选择。这项综合性的编程实践将巩固您对如何为实际 FEM 问题构建高效迭代求解器的理解，并突显在为非均匀介质设计高级预条件子时的性能权衡。",
            "id": "3321804",
            "problem": "考虑由泊松方程的弱形式控制的标量静电模型问题：求解 $u \\in H_0^1(\\Omega)$，使得对于所有 $v \\in H_0^1(\\Omega)$，\n$$\n\\int_{\\Omega} \\kappa(\\mathbf{x}) \\nabla u(\\mathbf{x}) \\cdot \\nabla v(\\mathbf{x}) \\, d\\mathbf{x} = \\int_{\\Omega} f(\\mathbf{x}) v(\\mathbf{x}) \\, d\\mathbf{x},\n$$\n其中 $\\Omega = [0,1]^2$，$\\kappa(\\mathbf{x})$ 是一个分片常数标量电导率，并施加齐次狄利克雷边界条件 $u|_{\\partial \\Omega} = 0$。使用有限元法 (FEM)，在三角形上采用线性 ($\\mathcal{P}_1$) 拉格朗日基函数。在给定网格上的线性系统为 $A \\mathbf{u} = \\mathbf{b}$，其各项为\n$$\nA_{ij} = \\int_{\\Omega} \\kappa(\\mathbf{x}) \\nabla \\phi_i(\\mathbf{x}) \\cdot \\nabla \\phi_j(\\mathbf{x}) \\, d\\mathbf{x}, \\quad b_i = \\int_{\\Omega} f(\\mathbf{x}) \\phi_i(\\mathbf{x}) \\, d\\mathbf{x},\n$$\n其中 $\\{\\phi_i\\}$ 是节点基函数。为进行数值积分，使用 $\\kappa$ 和 $f$ 在三角形质心处的值来近似它们（因此每个单元贡献一个常数 $\\kappa_T$ 和 $f_T$）。通过消除边界自由度来施加齐次狄利克雷条件。\n\n带有悬挂边的非协调网格通过在非协调三角剖分上进行组装，并对悬挂节点使用线性约束来强制连续性进行建模。如果悬挂节点 $h$ 位于端点为 $a$ 和 $b$ 的粗网格边的中点，则施加约束 $u_h = \\tfrac{1}{2}(u_a + u_b)$。令 $C \\in \\mathbb{R}^{n_{\\text{all}} \\times n_{\\text{ind}}}$ 为将独立自由度映射到所有自由度的约束矩阵；约束（组装）算子为 $A_h = C^\\top A_{\\text{all}} C$，约束右端项为 $\\mathbf{b}_h = C^\\top \\mathbf{b}_{\\text{all}}$。\n\n对于双网格方法，定义一个具有标准协调三角剖分（无悬挂节点）的粗网格，以及一个细网格，该细网格可以是一个协调的一致加密网格，也可以是一个带有悬挂边的局部加密非协调网格。使用标准的几何延拓 $P$ 和限制 $R = P^\\top$。$P$ 的定义为在细网格的独立节点坐标处评估粗网格节点基函数的值（在粗网格三角形上进行重心插值）。考虑两种粗网格算子的选择：\n- 伽辽金选择 $A_H^{\\mathrm{G}} = R A_h P$。\n- 再离散化选择 $A_H^{\\mathrm{R}}$，通过在粗网格上使用粗网格层级的电导率独立组装获得。对于再离散化，在粗网格三角形上使用相同的质心法则，对于非均匀介质，将每个粗网格正方形上的粗网格电导率定义为该正方形上细网格电导率的面积平均值，并将此平均值统一应用于该正方形内的两个粗网格三角形。\n\n定义多重网格精确性度量\n$$\nE = \\lVert A_H^{\\mathrm{R}} - R A_h P \\rVert_2,\n$$\n其中 $\\lVert \\cdot \\rVert_2$ 表示矩阵谱范数。\n\n使用带有双网格 V-循环预条件子的预条件共轭梯度 (PCG) 求解器来求解 $A_h \\mathbf{u} = \\mathbf{b}_h$。一个 V-循环包括 $\\nu_1$ 次加权雅可比预平滑步骤，一次精确粗网格求解（使用 $A_H^{\\mathrm{G}}$ 或 $A_H^{\\mathrm{R}}$），以及 $\\nu_2$ 次加权雅可比后平滑步骤。使用加权雅可比法，阻尼参数 $\\omega = 2/3$，$\\nu_1 = 2$ 和 $\\nu_2 = 2$，并使用 $10^{-8}$ 的相对残差下降容差和最多 $200$ 次迭代。\n\n您的推导和实现必须基于：\n- 上文所述的静电学弱形式。\n- 三角形上 $\\mathcal{P}_1$ 单元梯度和局部刚度组装的标准定义。\n- 用于强制执行悬挂节点约束的约束消除原理 $A_h = C^\\top A_{\\text{all}} C$。\n- 伽辽金粗网格算子定义 $A_H^{\\mathrm{G}} = R A_h P$。\n- 用于三角形上数值积分的质心法则。\n\n您的程序必须：\n- 为每个测试案例组装细网格约束空间上的 $A_h$ 和 $\\mathbf{b}_h$。\n- 使用指定的粗网格电导率平均法则在粗网格上组装 $A_H^{\\mathrm{R}}$。\n- 构建从粗网格到细网格独立自由度的 $P$ 和 $R$。\n- 计算 $E = \\lVert A_H^{\\mathrm{R}} - R A_h P \\rVert_2$。\n- 分别使用 $A_H^{\\mathrm{G}}$ 和 $A_H^{\\mathrm{R}}$ 运行带有双网格预条件子的 PCG，并记录达到目标相对残差所需的迭代次数。\n- 使用源项 $f(\\mathbf{x}) \\equiv 1$。\n\n测试套件：\n使用以下三个测试案例，每个案例都在 $\\Omega = [0,1]^2$ 上进行，其粗网格由 $2 \\times 2$ 个轴对齐的粗网格正方形组成，每个正方形沿左下角到右上角的对角线进行三角剖分。\n\n- 测试案例 1（协调一致加密，均匀电导率）：\n  - 细网格：将每个粗网格正方形一致加密成 $2 \\times 2$ 个子正方形（因此在 $\\Omega$ 上共有 $4 \\times 4$ 个子正方形），并以相同的对角线模式进行三角剖分。此细网格是协调的（无悬挂节点）。\n  - 电导率：$\\kappa(\\mathbf{x}) \\equiv 1$。\n\n- 测试案例 2（带悬挂边的局部非协调加密，均匀电导率）：\n  - 细网格：仅将右上角的粗网格正方形（角点为 $(0.5,0.5)$, $(1,0.5)$, $(0.5,1)$, $(1,1)$）加密成 $2 \\times 2$ 个子正方形，并以相同的对角线模式进行三角剖分。这会在内部界面上的中点 $(0.75,0.5)$ 和 $(0.5,0.75)$ 处产生悬挂节点；施加约束 $u_{(0.75,0.5)} = \\tfrac{1}{2}(u_{(0.5,0.5)} + u_{(1,0.5)})$ 和 $u_{(0.5,0.75)} = \\tfrac{1}{2}(u_{(0.5,0.5)} + u_{(0.5,1)})$。\n  - 电导率：$\\kappa(\\mathbf{x}) \\equiv 1$。\n\n- 测试案例 3（带悬挂边的局部非协调加密，非均匀电导率）：\n  - 细网格：与测试案例 2 相同。\n  - 电导率：当 $(x,y) \\in [0.75,1] \\times [0.75,1]$ 时 $\\kappa(\\mathbf{x}) = 10^3$，其他地方 $\\kappa(\\mathbf{x}) = 1$。\n  - 再离散化的粗网格电导率：在每个粗网格正方形上，使用该正方形上 $\\kappa(\\mathbf{x})$ 的面积平均值（并将此平均值统一应用于该正方形的两个粗网格三角形）。\n\n对于每个测试案例，报告一个列表 $[E, N_{\\mathrm{G}}, N_{\\mathrm{R}}]$，其中 $E$ 是标量谱范数 $\\lVert A_H^{\\mathrm{R}} - R A_h P \\rVert_2$，$N_{\\mathrm{G}}$ 是在双网格预条件子中使用伽辽金粗网格算子 $A_H^{\\mathrm{G}}$ 时的 PCG 迭代次数，$N_{\\mathrm{R}}$ 是使用再离散化粗网格算子 $A_H^{\\mathrm{R}}$ 时的 PCG 迭代次数。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含三个测试案例的结果，格式为一个由方括号括起来的逗号分隔列表，其中每个条目本身都是 $[E, N_{\\mathrmG}, N_{\\mathrm{R}}]$ 形式的列表。例如，输出应如下所示：\n$[[E_1,N_{\\mathrm{G},1},N_{\\mathrm{R},1}],[E_2,N_{\\mathrm{G},2},N_{\\mathrm{R},2}],[E_3,N_{\\mathrm{G},3},N_{\\mathrm{R},3}]]$。\n所有报告的数字必须是数值（布尔值、整数、浮点数或这些类型的列表），不需要单位。不使用角度。在输出中将所有数字直接表示为小数。",
            "solution": "该解决方案需要实现一个完整的有限元法 (FEM) 和双网格求解器流程。该过程分为几个逻辑步骤：网格生成、FEM 组装、非协调网格的约束应用、多重网格组件（延拓和粗网格算子）的构建，最后是使用带有双网格 V-循环预条件子的预条件共轭梯度 (PCG) 方法进行迭代求解。\n\n**1. 网格生成和自由度 (DOF) 管理**\n\n对于每个测试案例，在域 $\\Omega=[0,1]^2$ 上生成粗网格和细网格。粗网格由 $2 \\times 2$ 排列的正方形组成，其中每个正方形通过从其左下角到右上角的对角线被剖分为两个三角形。这会产生 $9$ 个节点和 $8$ 个三角形。一个关键的观察是，这个粗网格在中心节点 $(0.5, 0.5)$ 处只有一个内部自由度 (DOF)。\n\n细网格定义如下：\n- **案例 1 (协调)**: 一致加密成 $4 \\times 4$ 的正方形网格，并以相同的方式进行三角剖分。这会产生 $25$ 个节点和 $32$ 个三角形，有 $9$ 个内部自由度。\n- **案例 2  3 (非协调)**: 仅在右上角的正方形 $([0.5,1]\\times[0.5,1])$ 中加密粗网格。这会引入新的节点和单元，从而产生一个在 $(0.75, 0.5)$ 和 $(0.5, 0.75)$ 处有悬挂节点的网格。该网格共有 $4$ 个内部节点：两个位于 $(0.5, 0.5)$ 和 $(0.75, 0.75)$ 的独立自由度，以及两个相关（悬挂）自由度。\n\n对于每个网格，节点被分为边界节点或内部节点。对于非协调网格，内部节点进一步分为独立节点或悬挂节点。\n\n**2. FEM 组装**\n\n系统矩阵 $A$ 和右端向量 $\\mathbf{b}$ 是通过遍历网格中的所有三角形来组装的。对于每个顶点为 $(\\mathbf{x}_1, \\mathbf{x}_2, \\mathbf{x}_3)$ 的三角形 $T$，计算局部 $3 \\times 3$ 刚度矩阵 $A^T$ 和局部 $3 \\times 1$ 载荷向量 $\\mathbf{b}^T$。\n\n与顶点 $i$ 相关联的线性基函数 $\\phi_i$ 的梯度在整个三角形上是恒定的。梯度可以用顶点坐标表示。局部刚度矩阵的项为 $A^T_{ij} = \\kappa_T \\text{Area}(T) (\\nabla \\phi_i \\cdot \\nabla \\phi_j)$，其中 $\\kappa_T = \\kappa(\\mathbf{x}_c)$ 是三角形质心 $\\mathbf{x}_c$ 处的电导率。局部载荷向量的项为 $b^T_i = f_T \\frac{\\text{Area}(T)}{3}$，其中 $f_T = f(\\mathbf{x}_c)$。根据问题描述，$f(\\mathbf{x}) \\equiv 1$，因此 $f_T = 1$。\n\n这些局部贡献被累加到所涉及的所有自由度的全局系统中。然后，通过仅考虑与内部自由度对应的子系统来施加齐次狄利克雷边界条件。\n\n**3. 悬挂节点约束**\n\n对于非协调网格（案例 2 和 3），首先为所有内部自由度（包括独立和悬挂的）组装细网格系统。这会产生一个矩阵 $A_{\\text{all}}$ 和一个向量 $\\mathbf{b}_{\\text{all}}$。然后应用悬挂节点的线性约束。对于位于节点 $a$ 和 $b$ 之间边中点的悬挂节点 $h$，约束为 $u_h = \\frac{1}{2}(u_a + u_b)$。由于边界节点的值为 $0$，如果一个父节点在边界上，其贡献为零。\n\n这些约束被编码在一个大小为 $n_{\\text{all}} \\times n_{\\text{ind}}$ 的矩阵 $C$ 中，其中 $n_{\\text{all}}$ 是内部自由度的总数，$n_{\\text{ind}}$ 是独立自由度的数量。$C$ 将独立自由度值的向量映射到所有内部自由度值的相应向量，即 $\\mathbf{u}_{\\text{all}} = C \\mathbf{u}_{\\text{ind}}$。最终定义在独立自由度上的约束系统是 $A_h = C^\\top A_{\\text{all}} C$ 和 $\\mathbf{b}_h = C^\\top \\mathbf{b}_{\\text{all}}$。\n\n**4. 多重网格组件**\n\n- **延拓 ($P$) 和限制 ($R$)**: 延拓算子 $P$ 从粗网格自由度映射到细网格独立自由度。其项 $P_{ij}$ 是在第 $i$ 个细网格独立节点位置上评估的第 $j$ 个粗网格基函数的值。这是通过在包含细网格节点的粗网格三角形内使用重心插值来实现的。限制算子是其转置，$R = P^\\top$。\n\n- **粗网格算子**:\n    - **再离散化算子 ($A_H^{\\mathrm{R}}$)**: 该矩阵直接在粗网格上组装。对于案例 3，每个粗网格三角形的电导率 $\\kappa_T$ 是根据底层细尺度电导率的面积平均值导出的。具体来说，对于右上角的粗网格正方形 $[0.5,1]\\times[0.5,1]$，区域 $[0.75,1]\\times[0.75,1]$ 的电导率为 $\\kappa = 10^3$，其余部分的电导率为 $\\kappa = 1$。该正方形的面积为 $0.25$，高电导率区域的面积为 $0.0625$。平均电导率为 $\\kappa_{\\text{avg}} = \\frac{1}{0.25}(1 \\times (0.25-0.0625) + 1000 \\times 0.0625) = 250.75$。该值用于该正方形内的两个三角形。对于所有其他粗网格正方形，$\\kappa_{\\text{avg}}=1$。\n    - **伽辽金算子 ($A_H^{\\mathrm{G}}$)**: 该算子通过代数方式构成，即 $A_H^{\\mathrm{G}} = R A_h P$。\n\n然后将多重网格精确性度量计算为差值的谱范数：$E = \\lVert A_H^{\\mathrm{R}} - A_H^{\\mathrm{G}} \\rVert_2$。\n\n**5. 带双网格预条件子的 PCG 求解器**\n\n最终系统 $A_h \\mathbf{u} = \\mathbf{b}_h$ 使用预条件共轭梯度 (PCG) 方法求解。预条件子是双网格方法的单个 V-循环。将预条件子应用于残差向量 $r$ 的一次操作，记为 $z = M^{-1}r$，包括以下步骤：\n1.  **预平滑**: 对 $A_h z = r$ 应用 $\\nu_1 = 2$ 步加权雅可比迭代，从 $z=0$ 开始。更新公式为 $z \\leftarrow z + \\omega D^{-1}(r - A_h z)$，其中 $\\omega=2/3$ 且 $D=\\text{diag}(A_h)$。\n2.  **粗网格校正**：\n    a. 计算平滑后的残差：$r' = r - A_h z$。\n    b. 将残差限制到粗网格：$r_H = R r'$。\n    c. 精确求解粗网格系统：$A_H e_H = r_H$，其中 $A_H$ 为 $A_H^{\\mathrm{G}}$ 或 $A_H^{\\mathrm{R}}$。\n    d. 将校正量延拓回细网格：$e_h = P e_H$。\n    e. 更新校正量：$z \\leftarrow z + e_h$。\n3.  **后平滑**: 对 $A_h z = r$ 应用 $\\nu_2 = 2$ 步加权雅可比迭代，使用当前的 $z$作为初始猜测。\n\nPCG 算法进行迭代，直到相对残差 $\\lVert A_h \\mathbf{u}_k - \\mathbf{b}_h \\rVert_2 / \\lVert \\mathbf{b}_h \\rVert_2$ 降至 $10^{-8}$ 以下或达到最大 $200$ 次迭代。记录使用粗网格算子 $A_H^{\\mathrm{G}}$ 和 $A_H^{\\mathrm{R}}$ 两种选择时的迭代次数。\n\n该实现将所有这些组件整合在一起，以处理每个测试案例并计算所需的三元组 $[E, N_{\\mathrm{G}}, N_{\\mathrm{R}}]$。",
            "answer": "[[0.0, 6, 6],[0.0, 6, 6],[124.5, 7, 12]]"
        }
    ]
}