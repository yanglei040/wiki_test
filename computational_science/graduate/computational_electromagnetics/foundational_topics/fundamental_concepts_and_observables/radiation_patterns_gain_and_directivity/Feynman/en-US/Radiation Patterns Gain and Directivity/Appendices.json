{
    "hands_on_practices": [
        {
            "introduction": "A powerful approach in engineering is to begin with an idealized model to establish fundamental relationships. This exercise uses a Gaussian function to approximate an antenna's main beam, a common practice for highly directive antennas. By deriving key parameters like Half-Power Beamwidth ($HPBW$) and maximum Directivity ($D_{\\max}$) from first principles, you will solidify your understanding of their definitions and learn to quantify the estimation error introduced by real-world features like sidelobes .",
            "id": "3344121",
            "problem": "Consider a highly directive antenna whose radiation intensity about its boresight is narrow and well-approximated, in a local small-angle chart on the unit sphere, by a separable two-dimensional Gaussian mainlobe, with sidelobes initially neglected. Let the normalized power pattern in the tangent-plane coordinates $(x,y)$ (defined as the small angular offsets along two orthogonal principal cuts through the boresight, with the small-angle approximation so that $d\\Omega \\approx dx\\,dy$) be\n$$\nF(x,y)=\\exp\\!\\Big(-\\frac{x^{2}}{\\sigma_{x}^{2}}-\\frac{y^{2}}{\\sigma_{y}^{2}}\\Big),\n$$\nwhere $F(0,0)=1$, and $\\sigma_{x}$ and $\\sigma_{y}$ (in radians) are the $1/\\exp(1)$ angular scale parameters along the two principal cuts. Assume the beam is sufficiently narrow that the small-angle approximation holds over the mainlobe support.\n\nStarting only from the definitions that the total radiated power is $P_{\\mathrm{rad}}=\\displaystyle\\int_{4\\pi} U(\\theta,\\phi)\\,d\\Omega$, the directivity is $D(\\theta,\\phi)=4\\pi\\,U(\\theta,\\phi)/P_{\\mathrm{rad}}$, and the half-power beamwidth (HPBW) along a cut is the full angular width between the two points where the power drops to one-half of its peak value, do the following:\n\n1) Derive the closed-form expressions for the half-power beamwidths along the $x$- and $y$-principal cuts, denoted $\\mathrm{HPBW}_{x}$ and $\\mathrm{HPBW}_{y}$, in radians.\n\n2) Using the same definitions, derive the maximum directivity $D_{\\max}$ of this Gaussian-beam approximation (with sidelobes neglected), expressed in terms of $\\sigma_{x}$ and $\\sigma_{y}$.\n\n3) Now suppose that, in reality, the antenna also has sidelobes that are flat (constant in power) at a level of $-S$ dB relative to the boresight peak and occupy a fraction $\\alpha$ (with $0 \\le \\alpha \\le 1$) of the full sphere. Assume the sidelobe region is disjoint from the mainlobe region used in the Gaussian integral and that the mainlobe peak remains unchanged. Quantify the relative overestimation error incurred by neglecting sidelobes when estimating $D_{\\max}$ from the Gaussian mainlobe only. Specifically, define the relative error as $\\delta=(D_{\\mathrm{est}}-D_{\\mathrm{true}})/D_{\\mathrm{true}}$, where $D_{\\mathrm{est}}$ is the directivity obtained by neglecting sidelobes and $D_{\\mathrm{true}}$ accounts for them. Derive $\\delta$ as a closed-form expression in terms of $\\sigma_{x}$, $\\sigma_{y}$, $S$, and $\\alpha$.\n\nExpress $\\mathrm{HPBW}_{x}$ and $\\mathrm{HPBW}_{y}$ in radians, and treat directivity as dimensionless. The final answer must be the row vector containing, in order, $\\mathrm{HPBW}_{x}$, $\\mathrm{HPBW}_{y}$, $D_{\\max}$ (with sidelobes neglected), and $\\delta$.",
            "solution": "This is a multi-part problem requiring the derivation of antenna parameters from a given power pattern model. We will proceed by addressing each part sequentially.\n\n**Part 1: Derivation of Half-Power Beamwidths ($\\mathrm{HPBW}_{x}$ and $\\mathrm{HPBW}_{y}$)**\n\nThe normalized power pattern is given by $F(x,y)=\\exp(-x^{2}/\\sigma_{x}^{2}-y^{2}/\\sigma_{y}^{2})$. The maximum value of this pattern occurs at the boresight, $(x,y)=(0,0)$, where $F(0,0)=1$. The half-power beamwidth ($\\mathrm{HPBW}$) is defined as the full angular width between the two points where the power drops to one-half of its peak value.\n\nTo find $\\mathrm{HPBW}_{x}$, we consider the principal cut along the $x$-axis, which corresponds to setting $y=0$. The power pattern along this cut is $F(x,0) = \\exp(-x^2/\\sigma_x^2)$. We must find the values of $x$ for which $F(x,0) = 1/2$.\n$$\n\\exp\\Big(-\\frac{x^2}{\\sigma_x^2}\\Big) = \\frac{1}{2}\n$$\nTaking the natural logarithm of both sides:\n$$\n-\\frac{x^2}{\\sigma_x^2} = \\ln\\Big(\\frac{1}{2}\\Big) = -\\ln(2)\n$$\nSolving for $x^2$:\n$$\nx^2 = \\sigma_x^2 \\ln(2)\n$$\nThis gives two solutions for $x$:\n$$\nx = \\pm \\sigma_x \\sqrt{\\ln(2)}\n$$\nThe $\\mathrm{HPBW}_x$ is the full angular width, which is the difference between these two values:\n$$\n\\mathrm{HPBW}_{x} = \\sigma_x \\sqrt{\\ln(2)} - (-\\sigma_x \\sqrt{\\ln(2)}) = 2\\sigma_x\\sqrt{\\ln(2)}\n$$\nBy symmetry, the derivation for $\\mathrm{HPBW}_{y}$ is identical. We set $x=0$ to get the pattern along the $y$-axis, $F(0,y) = \\exp(-y^2/\\sigma_y^2)$. Setting this to $1/2$ and solving for $y$ yields $y = \\pm \\sigma_y \\sqrt{\\ln(2)}$. Thus, the half-power beamwidth along the $y$-axis is:\n$$\n\\mathrm{HPBW}_{y} = 2\\sigma_y\\sqrt{\\ln(2)}\n$$\n\n**Part 2: Derivation of Maximum Directivity ($D_{\\max}$) Neglecting Sidelobes**\n\nThe directivity is defined as $D(\\theta,\\phi) = 4\\pi U(\\theta,\\phi)/P_{\\mathrm{rad}}$, where $U(\\theta,\\phi)$ is the radiation intensity and $P_{\\mathrm{rad}}$ is the total radiated power. The maximum directivity $D_{\\max}$ occurs at the peak of the radiation intensity, $U_{\\max}$.\n$$\nD_{\\max} = \\frac{4\\pi U_{\\max}}{P_{\\mathrm{rad}}}\n$$\nThe radiation intensity can be written as $U(x,y) = U_{\\max} F(x,y)$ in the small-angle approximation. To find $P_{\\mathrm{rad}}$, we integrate $U(x,y)$ over all solid angles. With the small-angle approximation $d\\Omega \\approx dx\\,dy$ and neglecting sidelobes, the integral is taken over the entire plane, as the Gaussian function decays rapidly:\n$$\nP_{\\mathrm{rad}} = \\int_{4\\pi} U(\\theta,\\phi)\\,d\\Omega \\approx \\int_{-\\infty}^{\\infty}\\int_{-\\infty}^{\\infty} U(x,y)\\,dx\\,dy\n$$\nSubstituting the expression for $U(x,y)$:\n$$\nP_{\\mathrm{rad}} = U_{\\max} \\int_{-\\infty}^{\\infty}\\int_{-\\infty}^{\\infty} \\exp\\Big(-\\frac{x^2}{\\sigma_x^2}-\\frac{y^2}{\\sigma_y^2}\\Big)\\,dx\\,dy\n$$\nThis double integral is separable:\n$$\nP_{\\mathrm{rad}} = U_{\\max} \\left( \\int_{-\\infty}^{\\infty} \\exp\\Big(-\\frac{x^2}{\\sigma_x^2}\\Big)\\,dx \\right) \\left( \\int_{-\\infty}^{\\infty} \\exp\\Big(-\\frac{y^2}{\\sigma_y^2}\\Big)\\,dy \\right)\n$$\nWe use the standard Gaussian integral formula $\\int_{-\\infty}^{\\infty} \\exp(-az^2)\\,dz = \\sqrt{\\pi/a}$.\nFor the $x$-integral, $a = 1/\\sigma_x^2$, so the integral evaluates to $\\sqrt{\\pi/(1/\\sigma_x^2)} = \\sigma_x\\sqrt{\\pi}$.\nFor the $y$-integral, $a = 1/\\sigma_y^2$, so the integral evaluates to $\\sqrt{\\pi/(1/\\sigma_y^2)} = \\sigma_y\\sqrt{\\pi}$.\nTherefore, the total radiated power is:\n$$\nP_{\\mathrm{rad}} = U_{\\max} (\\sigma_x\\sqrt{\\pi})(\\sigma_y\\sqrt{\\pi}) = U_{\\max} \\pi \\sigma_x \\sigma_y\n$$\nThis is the estimated power, $P_{\\mathrm{est}}$, obtained by considering only the mainlobe. The corresponding estimated maximum directivity, $D_{\\mathrm{est}}$, is:\n$$\nD_{\\max} = D_{\\mathrm{est}} = \\frac{4\\pi U_{\\max}}{P_{\\mathrm{est}}} = \\frac{4\\pi U_{\\max}}{U_{\\max} \\pi \\sigma_x \\sigma_y} = \\frac{4}{\\sigma_x \\sigma_y}\n$$\n\n**Part 3: Derivation of Relative Error $\\delta$ Due to Sidelobes**\n\nNow we account for sidelobes. The total radiated power, $P_{\\mathrm{true}}$, is the sum of the power in the mainlobe, $P_{\\mathrm{ml}}$, and the power in the sidelobes, $P_{\\mathrm{sl}}$.\nThe mainlobe power is the one calculated in Part 2, $P_{\\mathrm{ml}} = U_{\\max} \\pi \\sigma_x \\sigma_y$.\nThe sidelobes are described as having a constant power intensity level of $-S$ dB relative to the peak, $U_{\\max}$. In linear scale, this intensity is $U_{\\mathrm{sl}} = U_{\\max} \\times 10^{-S/10}$.\nThe sidelobes occupy a fraction $\\alpha$ of the full sphere ($4\\pi$ steradians), so the solid angle they cover is $\\Omega_{\\mathrm{sl}} = 4\\pi\\alpha$.\nThe power radiated by the sidelobes is their constant intensity multiplied by their solid angle:\n$$\nP_{\\mathrm{sl}} = U_{\\mathrm{sl}} \\Omega_{\\mathrm{sl}} = (U_{\\max} 10^{-S/10})(4\\pi\\alpha) = 4\\pi\\alpha U_{\\max} 10^{-S/10}\n$$\nThe true total radiated power is $P_{\\mathrm{true}} = P_{\\mathrm{ml}} + P_{\\mathrm{sl}}$:\n$$\nP_{\\mathrm{true}} = U_{\\max} \\pi \\sigma_x \\sigma_y + 4\\pi\\alpha U_{\\max} 10^{-S/10} = \\pi U_{\\max}(\\sigma_x \\sigma_y + 4\\alpha 10^{-S/10})\n$$\nThe peak intensity $U_{\\max}$ is unchanged. The true maximum directivity, $D_{\\mathrm{true}}$, is:\n$$\nD_{\\mathrm{true}} = \\frac{4\\pi U_{\\max}}{P_{\\mathrm{true}}} = \\frac{4\\pi U_{\\max}}{\\pi U_{\\max}(\\sigma_x \\sigma_y + 4\\alpha 10^{-S/10})} = \\frac{4}{\\sigma_x \\sigma_y + 4\\alpha 10^{-S/10}}\n$$\nThe relative overestimation error $\\delta$ is defined as $\\delta = (D_{\\mathrm{est}}-D_{\\mathrm{true}})/D_{\\mathrm{true}}$. This can be rewritten as $\\delta = D_{\\mathrm{est}}/D_{\\mathrm{true}} - 1$.\n$$\n\\frac{D_{\\mathrm{est}}}{D_{\\mathrm{true}}} = \\frac{4/(\\sigma_x \\sigma_y)}{4/(\\sigma_x \\sigma_y + 4\\alpha 10^{-S/10})} = \\frac{\\sigma_x \\sigma_y + 4\\alpha 10^{-S/10}}{\\sigma_x \\sigma_y} = 1 + \\frac{4\\alpha 10^{-S/10}}{\\sigma_x \\sigma_y}\n$$\nTherefore, the relative error is:\n$$\n\\delta = \\left(1 + \\frac{4\\alpha 10^{-S/10}}{\\sigma_x \\sigma_y}\\right) - 1 = \\frac{4\\alpha 10^{-S/10}}{\\sigma_x \\sigma_y}\n$$\n\nThe four required quantities are $\\mathrm{HPBW}_{x}$, $\\mathrm{HPBW}_{y}$, $D_{\\max}$ (which is $D_{\\mathrm{est}}$), and $\\delta$.\n$$\n\\mathrm{HPBW}_{x} = 2\\sigma_x\\sqrt{\\ln(2)} \\\\\n\\mathrm{HPBW}_{y} = 2\\sigma_y\\sqrt{\\ln(2)} \\\\\nD_{\\max} = \\frac{4}{\\sigma_x \\sigma_y} \\\\\n\\delta = \\frac{4\\alpha 10^{-S/10}}{\\sigma_x \\sigma_y}\n$$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n2\\sigma_{x}\\sqrt{\\ln(2)} & 2\\sigma_{y}\\sqrt{\\ln(2)} & \\frac{4}{\\sigma_{x}\\sigma_{y}} & \\frac{4\\alpha 10^{-S/10}}{\\sigma_{x}\\sigma_{y}}\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "When we transition from continuous analytical functions to discrete numerical data, we must be aware of potential artifacts introduced by the sampling process. This practice explores the systematic bias that arises when estimating a peak value, such as maximum radiation intensity, directly from a sampled grid. By analyzing this bias and deriving a quadratic interpolation method to correct for it, you will gain insight into improving the accuracy of numerical post-processing and develop a crucial skill for validating computational results .",
            "id": "3344125",
            "problem": "Consider a numerical estimation of radiation pattern quantities in computational electromagnetics. The radiation intensity is a smooth function $U(\\theta,\\phi)$ on the unit sphere, and the total radiated power is $P_{\\text{rad}} = \\int_{0}^{2\\pi}\\int_{0}^{\\pi} U(\\theta,\\phi)\\sin\\theta\\,\\mathrm{d}\\theta\\,\\mathrm{d}\\phi$. The directivity is defined as $D(\\theta,\\phi) = \\frac{4\\pi U(\\theta,\\phi)}{P_{\\text{rad}}}$, and the maximum directivity is $D_{\\max} = \\max_{\\theta,\\phi} D(\\theta,\\phi)$.\n\nSuppose the radiation intensity is sampled on a uniform spherical grid with angular spacing $\\Delta$ (measured in radians) that is sufficiently small so that locally near the true maximum direction $(\\theta^{\\star},\\phi^{\\star})$ the restriction of $U$ to the geodesic coordinate $s$ along the direction of largest curvature can be approximated by a twice-differentiable Taylor expansion. Define $s=0$ at $(\\theta^{\\star},\\phi^{\\star})$, and let $U(s)$ denote $U(\\theta(s),\\phi(s))$ along that geodesic. The naive discrete-grid estimator of the maximum intensity is $\\widehat{U}_{\\max,\\text{grid}} = \\max_{k\\in\\mathbb{Z}} U(k\\Delta)$, yielding the naive maximum directivity estimate $\\widehat{D}_{\\max,\\text{grid}} = \\frac{4\\pi\\widehat{U}_{\\max,\\text{grid}}}{P_{\\text{rad}}}$.\n\nWorking from definitions and Taylor expansions, do the following:\n\n1. Argue from first principles why $\\widehat{U}_{\\max,\\text{grid}}$ is biased low relative to the true maximum $U(0)$, under the assumption that the offset between $s=0$ and its nearest grid point is distributed uniformly in $[0,\\Delta/2]$ due to the arbitrary alignment of $(\\theta^{\\star},\\phi^{\\star})$ with the sampling grid. Quantify the leading-order bias in $\\widehat{U}_{\\max,\\text{grid}}$ in terms of the local second derivative of $U$ at $s=0$ and $\\Delta$.\n\n2. To reduce this bias in the maximum directivity estimate, derive a sub-grid interpolation method based on fitting a quadratic model $f(s) = a s^{2} + b s + c$ to three consecutive samples $U_{-1} = U(-\\Delta)$, $U_{0} = U(0)$, and $U_{+1} = U(+\\Delta)$ taken along the geodesic direction of largest curvature identified around the discrete maximizer. Use the fitted quadratic to obtain a closed-form expression for the interpolated peak intensity $U^{\\star}_{\\text{quad}}$ at its vertex and then express the corrected maximum directivity estimate $\\widehat{D}_{\\max,\\text{quad}}$ in terms of $U_{-1}$, $U_{0}$, $U_{+1}$, and $P_{\\text{rad}}$.\n\nProvide your final answer as a single closed-form analytic expression for $\\widehat{D}_{\\max,\\text{quad}}$. No numerical evaluation is required, and no rounding is necessary. Since directivity is dimensionless, you do not need to include any units. Angles are measured in radians.",
            "solution": "The problem presents a valid and well-posed question in the field of computational electromagnetics, concerning the numerical estimation of maximum directivity from a sampled radiation pattern. The problem is scientifically grounded, free of contradictions, and contains all necessary information for its resolution. We will proceed by addressing the two parts of the problem in sequence.\n\nThe problem requires a two-part analysis. First, we will demonstrate and quantify the inherent low-bias of estimating the maximum radiation intensity directly from grid samples. Second, we will derive a corrected estimator for the maximum directivity using quadratic interpolation.\n\nPart 1: Bias of the Discrete-Grid Maximum Estimator\n\nThe true maximum of the radiation intensity $U(\\theta, \\phi)$ occurs at some direction $(\\theta^{\\star}, \\phi^{\\star})$. We analyze the behavior of $U$ along a geodesic coordinate $s$ aligned with the direction of largest curvature, with $s=0$ corresponding to the location of the true maximum. The function along this geodesic is denoted $U(s)$.\n\nBy definition of a maximum, the first derivative of $U(s)$ at $s=0$ must be zero, i.e., $U'(0)=0$. Furthermore, for the maximum to be stable, the second derivative must be negative, $U''(0) < 0$. A second-order Taylor series expansion of $U(s)$ around $s=0$ is given by:\n$$\nU(s) \\approx U(0) + U'(0)s + \\frac{1}{2}U''(0)s^2 = U(0) + \\frac{1}{2}U''(0)s^2\n$$\nThis quadratic approximation is valid for sufficiently small $s$, an assumption justified by the problem statement that the angular grid spacing $\\Delta$ is small.\n\nThe discrete-grid estimator, $\\widehat{U}_{\\max,\\text{grid}}$, is the maximum value of $U$ found on the sampling grid, $\\widehat{U}_{\\max,\\text{grid}} = \\max_{k\\in\\mathbb{Z}} U(k\\Delta)$. For a small $\\Delta$, the grid point yielding this maximum value will be one of the two grid points bracketing the true maximum at $s=0$. Let the offset of the true maximum from its nearest grid point be $\\delta s$. Since the position of the true maximum $(\\theta^{\\star},\\phi^{\\star})$ is arbitrary relative to the grid, the problem models this offset $\\delta s$ as a random variable uniformly distributed in the interval $[0, \\frac{\\Delta}{2}]$. The value of the radiation intensity at this nearest grid point is approximately:\n$$\nU(\\delta s) \\approx U(0) + \\frac{1}{2}U''(0)(\\delta s)^2\n$$\nSince $U''(0) < 0$ and $(\\delta s)^2 \\ge 0$, the second term is non-positive. Consequently, $U(\\delta s) \\le U(0)$. As the discrete-grid maximum $\\widehat{U}_{\\max,\\text{grid}}$ will be approximately $U(\\delta s)$, we can see that $\\widehat{U}_{\\max,\\text{grid}}$ is an estimator that is systematically lower than or equal to the true maximum $U(0)$. This demonstrates why the estimator is biased low.\n\nTo quantify this bias, we compute its expected value. The bias $B$ of the estimator $\\widehat{U}_{\\max,\\text{grid}}$ for the true value $U(0)$ is defined as $B(\\widehat{U}_{\\max,\\text{grid}}) = E[\\widehat{U}_{\\max,\\text{grid}}] - U(0)$. Using our approximation:\n$$\nB(\\widehat{U}_{\\max,\\text{grid}}) \\approx E\\left[U(0) + \\frac{1}{2}U''(0)(\\delta s)^2\\right] - U(0) = \\frac{1}{2}U''(0)E[(\\delta s)^2]\n$$\nThe offset $\\delta s$ is a random variable $X$ with a uniform probability density function $p(x) = \\frac{1}{\\Delta/2} = \\frac{2}{\\Delta}$ for $x \\in [0, \\frac{\\Delta}{2}]$. The expectation of $X^2$ is:\n$$\nE[X^2] = \\int_{0}^{\\frac{\\Delta}{2}} x^2 p(x) \\, \\mathrm{d}x = \\int_{0}^{\\frac{\\Delta}{2}} x^2 \\left(\\frac{2}{\\Delta}\\right) \\, \\mathrm{d}x = \\frac{2}{\\Delta} \\left[ \\frac{x^3}{3} \\right]_{0}^{\\frac{\\Delta}{2}} = \\frac{2}{\\Delta} \\frac{(\\Delta/2)^3}{3} = \\frac{2}{\\Delta} \\frac{\\Delta^3}{24} = \\frac{\\Delta^2}{12}\n$$\nSubstituting this result into the expression for the bias, we find the leading-order bias to be:\n$$\nB(\\widehat{U}_{\\max,\\text{grid}}) \\approx \\frac{1}{2}U''(0) \\left(\\frac{\\Delta^2}{12}\\right) = \\frac{U''(0)\\Delta^2}{24}\n$$\nSince $U''(0) < 0$, the bias is negative, confirming that the discrete-grid estimator is, on average, biased low.\n\nPart 2: Corrected Maximum Directivity via Quadratic Interpolation\n\nTo correct for this bias, we employ a sub-grid interpolation technique. We identify the grid point with the maximum sampled intensity, $\\widehat{U}_{\\max,\\text{grid}}$. We then consider this point and its two immediate neighbors along the geodesic of largest curvature. For notational convenience, we define a local coordinate system centered on the discrete maximizer. Let the three sample points be $(-\\Delta, U_{-1})$, $(0, U_0)$, and $(\\Delta, U_{+1})$, where $U_0 = \\widehat{U}_{\\max,\\text{grid}}$ is the central and largest sample value.\n\nWe fit a quadratic model $f(s) = as^2 + bs + c$ to these three points. This yields a system of three linear equations for the coefficients $a$, $b$, and $c$:\n\\begin{align*}\nf(-\\Delta) &= a\\Delta^2 - b\\Delta + c = U_{-1} \\\\\nf(0) &= c = U_0 \\\\\nf(\\Delta) &= a\\Delta^2 + b\\Delta + c = U_{+1}\n\\end{align*}\nFrom the second equation, we immediately have $c = U_0$. Substituting $c$ into the other two equations gives:\n\\begin{align*}\na\\Delta^2 - b\\Delta &= U_{-1} - U_0 \\\\\na\\Delta^2 + b\\Delta &= U_{+1} - U_0\n\\end{align*}\nAdding these two equations yields $2a\\Delta^2 = U_{-1} + U_{+1} - 2U_0$, from which we solve for $a$:\n$$\na = \\frac{U_{-1} + U_{+1} - 2U_0}{2\\Delta^2}\n$$\nSubtracting the first from the second yields $2b\\Delta = U_{+1} - U_{-1}$, from which we solve for $b$:\n$$\nb = \\frac{U_{+1} - U_{-1}}{2\\Delta}\n$$\nThe interpolated maximum intensity, $U^{\\star}_{\\text{quad}}$, is the value of the quadratic function at its vertex. The vertex occurs at $s^{\\star}$ where the derivative $f'(s) = 2as + b$ is zero, so $s^{\\star} = -\\frac{b}{2a}$. The value at the vertex is:\n$$\nU^{\\star}_{\\text{quad}} = f(s^{\\star}) = a\\left(-\\frac{b}{2a}\\right)^2 + b\\left(-\\frac{b}{2a}\\right) + c = \\frac{b^2}{4a} - \\frac{b^2}{2a} + c = c - \\frac{b^2}{4a}\n$$\nSubstituting the expressions for $a$, $b$, and $c$:\n$$\nU^{\\star}_{\\text{quad}} = U_0 - \\frac{\\left(\\frac{U_{+1} - U_{-1}}{2\\Delta}\\right)^2}{4\\left(\\frac{U_{-1} + U_{+1} - 2U_0}{2\\Delta^2}\\right)} = U_0 - \\frac{\\frac{(U_{+1} - U_{-1})^2}{4\\Delta^2}}{\\frac{2(U_{-1} + U_{+1} - 2U_0)}{\\Delta^2}}\n$$\nSimplifying the expression by canceling terms:\n$$\nU^{\\star}_{\\text{quad}} = U_0 - \\frac{(U_{+1} - U_{-1})^2}{8(U_{-1} + U_{+1} - 2U_0)}\n$$\nTo make the correction term positive, we can factor out $-1$ from the denominator:\n$$\nU^{\\star}_{\\text{quad}} = U_0 + \\frac{(U_{+1} - U_{-1})^2}{8(2U_0 - U_{-1} - U_{+1})}\n$$\nThe corrected maximum directivity, $\\widehat{D}_{\\max,\\text{quad}}$, is defined as $\\frac{4\\pi U^{\\star}_{\\text{quad}}}{P_{\\text{rad}}}$. Substituting our expression for $U^{\\star}_{\\text{quad}}$:\n$$\n\\widehat{D}_{\\max,\\text{quad}} = \\frac{4\\pi}{P_{\\text{rad}}} \\left( U_0 + \\frac{(U_{+1} - U_{-1})^2}{8(2U_0 - U_{-1} - U_{+1})} \\right)\n$$\nThis expression provides the final closed-form result for the quadratically corrected maximum directivity in terms of the three relevant intensity samples and the total radiated power.",
            "answer": "$$\n\\boxed{\\frac{4\\pi}{P_{\\text{rad}}} \\left( U_0 + \\frac{(U_{+1} - U_{-1})^2}{8(2U_0 - U_{-1} - U_{+1})} \\right)}\n$$"
        },
        {
            "introduction": "This final practice synthesizes the preceding concepts into a comprehensive computational task that mirrors a real-world antenna characterization workflow. You will work with a set of simulated data to calculate the maximum *realized gain*, a metric that accounts for the antenna's directivity as well as losses from impedance mismatch and material dissipation. Completing this exercise  will solidify your ability to translate fundamental definitions into a practical program for evaluating an antenna's true performance, including its gain-bandwidth product.",
            "id": "3344172",
            "problem": "You are tasked with building a complete, runnable program that computes the realized maximum gain over direction and frequency for a single-port antenna, and then quantifies how a frequency-dependent radiation efficiency influences the achieved gain bandwidth. Your derivation and algorithm must start from core definitions in electromagnetics: radiation intensity, total radiated power, directivity, radiation efficiency, and mismatch efficiency. You must not assume any specialized antenna formulas beyond these definitions. All angles must be in radians. All gain values must be reported in decibels relative to an isotropic radiator, which must be expressed in dBi. The bandwidth metric must be a dimensionless fraction expressed as a decimal.\n\nGiven are a set of discrete frequencies, measured reflection coefficient magnitude, a radiation efficiency estimate derived from conductor (ohmic) losses, and a numerically specified radiation intensity pattern that varies with frequency. From these data, you must compute, for each frequency, the maximum realized gain over all directions, and then compute two discrete gain-bandwidth estimates under a $3$ dB-down criterion: one using the given frequency-dependent radiation efficiency and one using a flattened, frequency-independent radiation efficiency equal to the value at the center frequency. You must then output all results aggregated into a single line in a specified list format.\n\nUse the following definitions and requirements to design your algorithm and implement your program.\n\n- Use the foundational definitions. Radiation intensity $U(\\theta,\\phi;f)$ is the time-average power per unit solid angle in the $(\\theta,\\phi)$ direction at frequency $f$. The total radiated power $P_{\\text{rad}}(f)$ is the integral of $U$ over the full solid angle. Directivity $D(\\theta,\\phi;f)$ is the ratio of the radiation intensity to the average radiation intensity over all directions. Radiation efficiency $\\eta_r(f)$ aggregates dissipation losses within the antenna. Mismatch efficiency $\\eta_m(f)$ accounts for power not accepted due to input mismatch and depends only on the magnitude of the measured reflection coefficient $S_{11}(f)$. Use these definitions to construct the realized gain $G_{\\text{real}}(\\theta,\\phi;f)$ and to determine $G_{\\text{real,max}}(f)$ over all directions.\n\n- Angle grids and integration. Numerically approximate the required angular integrals over the unit sphere using a tensor-product grid:\n  - Let $\\theta \\in [0,\\pi]$ be sampled with $N_\\theta = 721$ equally spaced points.\n  - Let $\\phi \\in [0,2\\pi]$ be sampled with $N_\\phi = 361$ equally spaced points.\n  - Use the standard spherical integral with the $\\sin\\theta$ Jacobian factor to compute $P_{\\text{rad}}(f)$ from the grid samples $U(\\theta_i,\\phi_j;f)$.\n  - The angle unit is radians.\n\n- Radiation intensity specification for the test suite. For each frequency $f$, use the following numerically specified radiation intensity model that is independent of $\\phi$ and forward-hemisphere-only:\n  - $U(\\theta,\\phi;f) = \\max(\\cos\\theta,0)^{n(f)}$ for all $(\\theta,\\phi)$, with exponent $n(f)$ specified per frequency below. This is a numerically evaluable function and stands in for a precomputed numerical pattern.\n  - This pattern is not normalized; it must be integrated numerically to form the total radiated power needed for directivity.\n\n- Test suite parameter values. Use exactly the following lists for the test suite:\n  - Frequencies (in hertz): $[1.80\\times 10^{9},\\, 2.10\\times 10^{9},\\, 2.40\\times 10^{9},\\, 2.70\\times 10^{9},\\, 3.00\\times 10^{9}]$.\n  - Measured reflection coefficient magnitudes $|S_{11}(f)|$: $[0.70,\\, 0.40,\\, 0.10,\\, 0.35,\\, 0.65]$.\n  - Radiation efficiencies $\\eta_r(f)$ (unitless): $[0.78,\\, 0.83,\\, 0.88,\\, 0.82,\\, 0.75]$.\n  - Pattern exponents $n(f)$: $[2.0,\\, 2.5,\\, 3.0,\\, 3.5,\\, 4.0]$.\n  - The mismatch efficiency must be computed as $\\eta_m(f) = 1 - |S_{11}(f)|^2$.\n\n- Computation goals.\n  - For each frequency $f$, compute $G_{\\text{real,max}}(f)$ in linear units by searching over all sampled $(\\theta,\\phi)$ directions, and then convert to dBi via $10\\log_{10}(\\cdot)$.\n  - Compute the $3$ dB-down gain-bandwidth fraction for the frequency-dependent radiation efficiency case as follows. Let $G_{\\text{max,pk}}^{\\text{dBi}}$ be the maximum, over all test frequencies, of the per-frequency $G_{\\text{real,max}}^{\\text{dBi}}(f)$. Count how many frequencies satisfy $G_{\\text{real,max}}^{\\text{dBi}}(f) \\geq G_{\\text{max,pk}}^{\\text{dBi}} - 3$. The fraction is this count divided by the total number of test frequencies, expressed as a decimal (unitless).\n  - Repeat the bandwidth calculation for a hypothetical flattened efficiency $\\eta_r^{\\text{flat}}$ equal to the radiation efficiency at the center frequency, i.e., the third entry in the list (corresponding to $2.40\\times 10^{9}$ Hz), applied uniformly across all frequencies. In this second case, recompute all $G_{\\text{real,max}}^{\\text{dBi}}(f)$ with $\\eta_r(f)$ replaced by $\\eta_r^{\\text{flat}}$, and then recompute the $3$ dB-down fraction using the new peak across frequencies.\n\n- Required units and angle unit. Report all $G_{\\text{real,max}}$ values in dBi. Report bandwidth fractions as decimals with no unit. All angles are in radians.\n\n- Final output format. Your program must produce a single line of output containing a single list comprised of exactly three items:\n  - The first item is a list of length $5$ containing the $G_{\\text{real,max}}^{\\text{dBi}}(f)$ for the five test frequencies, in the same order as provided.\n  - The second item is the $3$ dB-down fractional bandwidth for the frequency-dependent $\\eta_r(f)$ case (a single float).\n  - The third item is the $3$ dB-down fractional bandwidth for the flattened $\\eta_r^{\\text{flat}}$ case (a single float).\n  For example, the printed structure must look like $[[g_1, g_2, g_3, g_4, g_5], b_1, b_2]$ with no extra text, where each $g_k$ is in dBi and each $b_k$ is a decimal fraction.\n\nYour program must be fully self-contained, must not read any input, and must not access the network or filesystem. It must compute and print only the specified single-line result for the given test suite.",
            "solution": "The problem is found to be valid as it is scientifically grounded in the fundamental principles of antenna theory, well-posed with a complete and consistent set of data and definitions, and objective in its formulation. We will, therefore, proceed with a complete solution.\n\nThe objective is to compute the maximum realized gain for an antenna at several frequencies and to analyze the impact of radiation efficiency on the gain bandwidth. The solution is derived from first principles as specified.\n\nLet $f$ be the frequency. The primary quantities are:\n- Frequencies: $f \\in \\{1.80\\times 10^{9}, 2.10\\times 10^{9}, 2.40\\times 10^{9}, 2.70\\times 10^{9}, 3.00\\times 10^{9}\\}$ Hz.\n- Pattern exponents: $n(f) \\in \\{2.0, 2.5, 3.0, 3.5, 4.0\\}$.\n- Reflection coefficient magnitudes: $|S_{11}(f)| \\in \\{0.70, 0.40, 0.10, 0.35, 0.65\\}$.\n- Radiation efficiencies: $\\eta_r(f) \\in \\{0.78, 0.83, 0.88, 0.82, 0.75\\}$.\n\n**1. Radiation Intensity and Total Radiated Power**\n\nThe radiation intensity $U(\\theta, \\phi; f)$ is given by the model $U(\\theta, \\phi; f) = \\max(\\cos\\theta, 0)^{n(f)}$. This function describes the power density as a function of direction, specified by the spherical coordinates $\\theta$ (polar angle) and $\\phi$ (azimuthal angle). The exponent $n(f)$ controls the pattern's directivity and varies with frequency. Note that the pattern is independent of $\\phi$.\n\nThe total radiated power, $P_{\\text{rad}}(f)$, is the integral of the radiation intensity over all solid angles:\n$$ P_{\\text{rad}}(f) = \\int_{\\Omega} U(\\theta, \\phi; f) \\, d\\Omega = \\int_{0}^{2\\pi} \\int_{0}^{\\pi} U(\\theta, \\phi; f) \\sin\\theta \\, d\\theta \\, d\\phi $$\nDue to the azimuthal symmetry of $U$, the integral over $\\phi$ yields a factor of $2\\pi$:\n$$ P_{\\text{rad}}(f) = 2\\pi \\int_{0}^{\\pi} \\max(\\cos\\theta, 0)^{n(f)} \\sin\\theta \\, d\\theta $$\nThis integral is computed numerically using the trapezoidal rule over a discrete grid of $\\theta$ values. The grid for $\\theta$ is defined from $0$ to $\\pi$ with $N_\\theta = 721$ points. Let the discrete angles be $\\theta_i$ for $i=0, \\dots, N_\\theta-1$. The integral is approximated as:\n$$ P_{\\text{rad}}(f) \\approx 2\\pi \\sum_{i=0}^{N_\\theta-2} \\frac{1}{2} (y_i + y_{i+1}) (\\theta_{i+1} - \\theta_i) $$\nwhere $y_i = \\max(\\cos\\theta_i, 0)^{n(f)} \\sin\\theta_i$. This is implemented using `numpy.trapz`.\n\n**2. Directivity, Efficiency, and Realized Gain**\n\nDirectivity, $D(\\theta, \\phi; f)$, is the ratio of the radiation intensity in a given direction to the average radiation intensity, $U_{\\text{avg}}(f) = P_{\\text{rad}}(f) / (4\\pi)$:\n$$ D(\\theta, \\phi; f) = \\frac{U(\\theta, \\phi; f)}{U_{\\text{avg}}(f)} = \\frac{4\\pi U(\\theta, \\phi; f)}{P_{\\text{rad}}(f)} $$\nThe maximum directivity, $D_{\\text{max}}(f)$, occurs in the direction of maximum radiation intensity, $(\\theta=0, \\phi=0)$. At this direction, $U_{\\text{max}}(f) = \\max(\\cos 0, 0)^{n(f)} = 1^{n(f)} = 1$. Thus:\n$$ D_{\\text{max}}(f) = \\frac{4\\pi U_{\\text{max}}(f)}{P_{\\text{rad}}(f)} = \\frac{4\\pi}{P_{\\text{rad}}(f)} $$\nThe realized gain, $G_{\\text{real}}(\\theta, \\phi; f)$, incorporates both internal losses (radiation efficiency, $\\eta_r(f)$) and mismatch losses at the input port (mismatch efficiency, $\\eta_m(f)$):\n$$ G_{\\text{real}}(\\theta, \\phi; f) = \\eta_m(f) \\eta_r(f) D(\\theta, \\phi; f) $$\nThe mismatch efficiency is calculated from the reflection coefficient:\n$$ \\eta_m(f) = 1 - |S_{11}(f)|^2 $$\nThe maximum realized gain, $G_{\\text{real,max}}(f)$, corresponds to the direction of maximum directivity:\n$$ G_{\\text{real,max}}(f) = \\eta_m(f) \\eta_r(f) D_{\\text{max}}(f) = \\left(1 - |S_{11}(f)|^2\\right) \\eta_r(f) \\frac{4\\pi}{P_{\\text{rad}}(f)} $$\nThis value is computed in linear units and then converted to decibels relative to an isotropic radiator (dBi):\n$$ G_{\\text{real,max}}^{\\text{dBi}}(f) = 10 \\log_{10} \\left( G_{\\text{real,max}}(f) \\right) $$\n\n**3. Gain-Bandwidth Calculation**\n\nThe $3$ dB-down gain-bandwidth quantifies the frequency range over which the gain remains close to its peak. It is calculated as a fractional bandwidth.\nFirst, we find the peak gain across all test frequencies: $G_{\\text{max,pk}}^{\\text{dBi}} = \\max_{f} \\{G_{\\text{real,max}}^{\\text{dBi}}(f)\\}$.\nThe gain threshold is $G_{\\text{thresh}}^{\\text{dBi}} = G_{\\text{max,pk}}^{\\text{dBi}} - 3$ dB.\nThe number of frequencies, $N_{\\text{pass}}$, for which the gain meets or exceeds this threshold ($G_{\\text{real,max}}^{\\text{dBi}}(f) \\geq G_{\\text{thresh}}^{\\text{dBi}}$) is counted.\nThe fractional bandwidth is the ratio $B = N_{\\text{pass}} / N_{\\text{total}}$, where $N_{\\text{total}}$ is the total number of frequency points ($5$ in this case).\n\nThis calculation is performed for two scenarios:\n1.  **Frequency-Dependent Efficiency**: Using the provided $\\eta_r(f)$ values directly.\n2.  **Flattened Efficiency**: Replacing $\\eta_r(f)$ for all frequencies with a constant value $\\eta_r^{\\text{flat}}$, which is the efficiency at the center frequency ($2.40 \\times 10^9$ Hz), i.e., $\\eta_r^{\\text{flat}} = 0.88$. A new set of realized gains is computed, a new peak gain is found, and the fractional bandwidth is determined based on this new set of values.\n\nThe algorithm iterates through each frequency, calculates $P_{\\text{rad}}(f)$, $D_{\\text{max}}(f)$, and finally $G_{\\text{real,max}}^{\\text{dBi}}(f)$ for both efficiency cases. Subsequently, the two fractional bandwidths are computed. The final result is assembled into the specified list format.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes realized maximum gain and gain-bandwidth for a single-port antenna\n    based on fundamental electromagnetic definitions.\n    \"\"\"\n    # Test suite parameter values\n    # Frequencies are not used in calculations but define the correspondence\n    # of other parameters.\n    # frequencies_hz = np.array([1.80e9, 2.10e9, 2.40e9, 2.70e9, 3.00e9]) # Not directly used\n    s11_mags = np.array([0.70, 0.40, 0.10, 0.35, 0.65])\n    eta_r_vals = np.array([0.78, 0.83, 0.88, 0.82, 0.75])\n    n_vals = np.array([2.0, 2.5, 3.0, 3.5, 4.0])\n    num_freqs = len(n_vals)\n\n    # Numerical integration parameters\n    N_theta = 721\n    theta_grid = np.linspace(0, np.pi, N_theta)\n\n    # Mismatch efficiencies\n    eta_m_vals = 1 - s11_mags**2\n\n    # Case 1: Frequency-dependent radiation efficiency\n    g_real_max_dbi_case1 = []\n    \n    # Store D_max to reuse in case 2\n    d_max_vals_linear = []\n\n    for i in range(num_freqs):\n        n = n_vals[i]\n        \n        # Radiation intensity U(theta) for the given n(f)\n        # U is normalized such that its maximum value is 1.\n        # U is independent of phi.\n        u_theta = np.maximum(np.cos(theta_grid), 0)**n\n        \n        # Integrand for total radiated power calculation\n        integrand = u_theta * np.sin(theta_grid)\n        \n        # Numerically integrate over theta using the trapezoidal rule\n        integral_theta = np.trapz(integrand, theta_grid)\n        \n        # Total radiated power P_rad. The integral over phi gives 2*pi.\n        p_rad = 2 * np.pi * integral_theta\n        \n        # Maximum directivity D_max\n        # U_max is 1, as max(cos(theta)) is 1 at theta=0.\n        u_max = 1.0\n        d_max_linear = 4 * np.pi * u_max / p_rad\n        d_max_vals_linear.append(d_max_linear)\n        \n        # Maximum realized gain in linear scale\n        g_real_max_linear = eta_m_vals[i] * eta_r_vals[i] * d_max_linear\n        \n        # Convert to dBi\n        g_real_max_dbi = 10 * np.log10(g_real_max_linear)\n        g_real_max_dbi_case1.append(g_real_max_dbi)\n\n    # Calculate 3 dB-down fractional bandwidth for Case 1\n    g_max_pk_case1 = np.max(g_real_max_dbi_case1)\n    threshold_case1 = g_max_pk_case1 - 3.0\n    count_case1 = np.sum(np.array(g_real_max_dbi_case1) >= threshold_case1)\n    bw_frac_case1 = count_case1 / num_freqs\n\n    # Case 2: Flattened, frequency-independent radiation efficiency\n    # The value is from the center frequency (index 2)\n    eta_r_flat = eta_r_vals[2]\n    g_real_max_dbi_case2 = []\n\n    for i in range(num_freqs):\n        # D_max is the same as in case 1\n        d_max_linear = d_max_vals_linear[i]\n        \n        # Maximum realized gain with flattened efficiency\n        g_real_max_linear = eta_m_vals[i] * eta_r_flat * d_max_linear\n        \n        # Convert to dBi\n        g_real_max_dbi = 10 * np.log10(g_real_max_linear)\n        g_real_max_dbi_case2.append(g_real_max_dbi)\n\n    # Calculate 3 dB-down fractional bandwidth for Case 2\n    g_max_pk_case2 = np.max(g_real_max_dbi_case2)\n    threshold_case2 = g_max_pk_case2 - 3.0\n    count_case2 = np.sum(np.array(g_real_max_dbi_case2) >= threshold_case2)\n    bw_frac_case2 = count_case2 / num_freqs\n    \n    # Assemble the final result list\n    final_result = [g_real_max_dbi_case1, bw_frac_case1, bw_frac_case2]\n\n    # Final print statement in the exact required format.\n    print(final_result)\n\nsolve()\n```"
        }
    ]
}