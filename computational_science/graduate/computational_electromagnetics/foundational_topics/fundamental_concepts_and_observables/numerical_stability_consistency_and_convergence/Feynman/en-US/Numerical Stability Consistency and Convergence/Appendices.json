{
    "hands_on_practices": [
        {
            "introduction": "The Lax-Richtmyer Equivalence Theorem forms the cornerstone of numerical analysis for time-dependent problems, stating that a consistent scheme converges if and only if it is stable. This exercise provides a hands-on demonstration of one half of this theorem by constructing a linear scheme that is provably stable yet fails to converge . By analyzing why it fails, we gain a concrete understanding of consistency as a non-negotiable requirement for a numerical method to solve the intended problem.",
            "id": "3394996",
            "problem": "Consider the periodic linear advection initial value problem $u_t + a\\,u_x = 0$ for $x \\in [0,2\\pi]$ and $t \\ge 0$, with periodic boundary conditions and zero initial data $u(x,0) = 0$. This problem is well-posed in the sense that for any admissible initial data in a suitable normed space, there exists a unique solution that depends continuously on the initial data. In the context of spectral methods and Discontinuous Galerkin (DG) methods, a linear scheme is called stable if its homogeneous part generates a bounded evolution in the chosen norm and is called consistent if the discrete operator applied to sufficiently smooth exact solutions yields a residual that tends to zero under refinement.\n\nConstruct the following Fourier spectral semi-discrete scheme with $N$ modes (labeled by integers $k$ with $|k| \\le K$ where $N = 2K+1$): expand $u_N(x,t) = \\sum_{|k| \\le K} \\hat{u}_k(t)\\,\\exp(i k x)$ and evolve the modal coefficients according to\n$$\n\\frac{d}{dt}\\,\\hat{u}_{k}(t) \\;=\\; -\\,i\\,a\\,k\\,\\hat{u}_{k}(t) \\;+\\; \\gamma\\,\\delta_{k,0},\n$$\nwith parameter $a = 1$, forcing amplitude $\\gamma = 1$, and Kronecker delta $\\delta_{k,0}$. Assume exact time integration of this semi-discrete system. This scheme is linear and its homogeneous part corresponds to the standard Fourier spectral discretization of the skew-adjoint advection operator, which is norm-preserving in the $L^{2}$ norm. However, the added zero-mode forcing makes the scheme inconsistent with the original homogeneous problem.\n\nUsing first-principles reasoning starting from the definitions above and the exact evolution of the semi-discrete system, show that the scheme is stable (in the sense that the homogeneous evolution preserves the $L^{2}$ norm) yet inconsistent, and explain why it does not converge to the exact solution $u \\equiv 0$. Then, compute the limit of the $L^{2}$ error at time $t = 1$ as the number of modes $N \\to \\infty$:\n$$\n\\lim_{N \\to \\infty} \\,\\left\\| u_{N}(\\cdot,1) - 0 \\right\\|_{L^{2}(0,2\\pi)}.\n$$\nProvide your final answer as a single closed-form analytic expression. No rounding is required. Angles, if any, must be expressed in radians.",
            "solution": "The problem is first validated to ensure it is scientifically grounded, well-posed, and objective.\n\nThe givens are:\n1.  The partial differential equation (PDE) is the linear advection equation: $u_t + a\\,u_x = 0$.\n2.  The spatial domain is $x \\in [0,2\\pi]$ with periodic boundary conditions.\n3.  The temporal domain is $t \\ge 0$.\n4.  The initial condition is $u(x,0) = 0$.\n5.  A Fourier spectral semi-discrete scheme is proposed for a numerical solution $u_N(x,t) = \\sum_{|k| \\le K} \\hat{u}_k(t)\\,\\exp(i k x)$, where $N = 2K+1$.\n6.  The evolution of the modal coefficients $\\hat{u}_k(t)$ is given by the ordinary differential equation (ODE) system: $\\frac{d}{dt}\\,\\hat{u}_{k}(t) \\;=\\; -\\,i\\,a\\,k\\,\\hat{u}_{k}(t) \\;+\\; \\gamma\\,\\delta_{k,0}$.\n7.  The initial conditions for the scheme are consistent with $u(x,0)=0$, which implies $\\hat{u}_k(0)=0$ for all $k$.\n8.  The parameters are specified as $a = 1$ and $\\gamma = 1$.\n9.  The exact solution to the initial value problem is $u(x,t) = 0$ for all $x$ and $t$.\n10. The task is to show the scheme is stable but inconsistent, explain the resulting non-convergence, and compute the limit of the $L^{2}$ error at $t=1$ as $N \\to \\infty$.\n\nThe problem is mathematically well-defined, internally consistent, and directly pertains to the analysis of numerical methods for PDEs, specifically the interplay of stability, consistency, and convergence as described by the Lax equivalence theorem. The constructed scheme is a textbook example used to illustrate the importance of consistency. The problem is therefore valid.\n\nWe proceed with the solution, which consists of three parts: analysis of stability and consistency, explanation of non-convergence, and computation of the error.\n\nFirst, we analyze the stability of the scheme. According to the problem statement, stability is determined by the behavior of the homogeneous part of the scheme. The given semi-discrete scheme is:\n$$\n\\frac{d}{dt}\\,\\hat{u}_{k}(t) \\;=\\; -\\,i\\,a\\,k\\,\\hat{u}_{k}(t) \\;+\\; \\gamma\\,\\delta_{k,0}\n$$\nThe homogeneous part is obtained by removing the forcing term $\\gamma\\,\\delta_{k,0}$:\n$$\n\\frac{d}{dt}\\,\\hat{u}_{k}^{h}(t) \\;=\\; -\\,i\\,a\\,k\\,\\hat{u}_{k}^{h}(t)\n$$\nwhere $\\hat{u}_k^h(t)$ denotes the coefficients of the homogeneous evolution. The solution to this linear ODE is $\\hat{u}_k^h(t) = \\hat{u}_k^h(0) \\exp(-iakt)$. The $L^{2}$ norm of the numerical solution $u_{N}(x,t)$ is related to its Fourier coefficients by Parseval's theorem:\n$$\n\\left\\| u_{N}(\\cdot, t) \\right\\|_{L^{2}(0,2\\pi)}^{2} = \\int_{0}^{2\\pi} |u_{N}(x,t)|^{2} dx = 2\\pi \\sum_{|k| \\le K} |\\hat{u}_{k}(t)|^{2}\n$$\nFor the homogeneous evolution, we examine the squared magnitude of the coefficients:\n$$\n|\\hat{u}_{k}^{h}(t)|^{2} = \\left| \\hat{u}_{k}^{h}(0) \\exp(-iakt) \\right|^{2} = |\\hat{u}_{k}^{h}(0)|^{2} |\\exp(-iakt)|^{2} = |\\hat{u}_{k}^{h}(0)|^{2}\n$$\nsince $|\\exp(i\\theta)|=1$ for any real $\\theta$. Summing over all modes, we find:\n$$\n\\sum_{|k| \\le K} |\\hat{u}_{k}^{h}(t)|^{2} = \\sum_{|k| \\le K} |\\hat{u}_{k}^{h}(0)|^{2}\n$$\nThis implies that $\\left\\| u_{N}^{h}(\\cdot, t) \\right\\|_{L^{2}}^{2} = \\left\\| u_{N}^{h}(\\cdot, 0) \\right\\|_{L^{2}}^{2}$. The $L^{2}$ norm of the solution to the homogeneous scheme is conserved for all time. An evolution that preserves the norm is bounded (with an operator norm of $1$). Therefore, by the definition provided, the scheme is stable.\n\nSecond, we analyze the consistency. A scheme is consistent with a PDE if the truncation error—the residual obtained by substituting the exact solution of the PDE into the numerical scheme—tends to zero as the discretization is refined ($N \\to \\infty$). The exact solution to $u_t + a u_x = 0$ with $u(x,0)=0$ is $u(x,t) = 0$ for all $t \\ge 0$. The Fourier coefficients of the exact solution are $\\hat{u}_{k,exact}(t) = 0$ for all $k$ and $t$.\nWe substitute these exact solution coefficients into the full numerical scheme to find the residual for each mode, $\\tau_k(t)$:\n$$\n\\tau_k(t) = \\frac{d}{dt}\\hat{u}_{k,exact}(t) - \\left( -iak\\,\\hat{u}_{k,exact}(t) + \\gamma\\,\\delta_{k,0} \\right)\n$$\nPlugging in $\\hat{u}_{k,exact}(t) = 0$ and its time-derivative $\\frac{d}{dt}(0)=0$:\n$$\n\\tau_k(t) = 0 - \\left( -iak \\cdot 0 + \\gamma\\,\\delta_{k,0} \\right) = -\\gamma\\,\\delta_{k,0}\n$$\nWith $\\gamma=1$, the residual is $\\tau_k(t) = -\\delta_{k,0}$. For the mode $k=0$, the residual is $\\tau_0 = -1$, while for all other modes $k \\neq 0$, the residual is $\\tau_k = 0$. The residual for the zeroth mode is a constant nonzero value. It does not depend on the number of modes $N$ and thus does not tend to zero as $N \\to \\infty$. Therefore, the scheme is inconsistent with the homogeneous PDE $u_t + a u_x = 0$.\n\nThe failure to converge is a direct consequence of this inconsistency, as explained by the Lax-Richtmyer equivalence theorem. The theorem states that for a well-posed linear initial value problem, a consistent linear finite-difference scheme is convergent if and only if it is stable. Here, the scheme is stable but not consistent. The conditions of the theorem for convergence are not met. The scheme is actually a consistent discretization of a different PDE: $u_t + a u_x = F(x)$, where $F(x)$ is a function whose Fourier coefficients are $\\gamma\\,\\delta_{k,0}$. This corresponds to a spatially constant forcing term $F(x) = \\gamma=1$. The numerical scheme is solving the wrong problem, so its solution does not converge to the solution of the intended problem. The source term $\\gamma\\,\\delta_{k,0}$ continuously injects a non-physical signal into the zeroth mode, causing the numerical solution to diverge from the true solution $u=0$.\n\nFinally, we compute the limit of the $L^{2}$ error at $t=1$. We must find the exact solution to the semi-discrete system with the specified parameters $a=1$, $\\gamma=1$ and initial conditions $\\hat{u}_k(0)=0$. The system of ODEs is:\n$$\n\\frac{d}{dt}\\hat{u}_{k}(t) = -ik\\hat{u}_{k}(t) + \\delta_{k,0}\n$$\nWe solve this for two cases.\nCase 1: $k \\neq 0$. The equation is $\\frac{d}{dt}\\hat{u}_{k}(t) = -ik\\hat{u}_{k}(t)$. With the initial condition $\\hat{u}_k(0)=0$, the unique solution is $\\hat{u}_k(t)=0$ for all $t$.\nCase 2: $k=0$. The equation is $\\frac{d}{dt}\\hat{u}_{0}(t) = -i(0)\\hat{u}_{0}(t) + 1$, which simplifies to $\\frac{d}{dt}\\hat{u}_{0}(t) = 1$. Integrating from $0$ to $t$ gives $\\hat{u}_{0}(t) - \\hat{u}_{0}(0) = \\int_0^t 1 ds = t$. Since $\\hat{u}_{0}(0)=0$, we have $\\hat{u}_0(t)=t$.\n\nThe coefficients of the numerical solution are thus $\\hat{u}_{k}(t) = t\\,\\delta_{k,0}$. The numerical solution in physical space is:\n$$u_N(x,t) = \\sum_{|k| \\le K} \\hat{u}_{k}(t)\\,\\exp(ikx) = \\hat{u}_{0}(t)\\exp(i \\cdot 0 \\cdot x) = t$$\nThe solution $u_N(x,t)=t$ is a spatially constant function that grows linearly in time. This solution is valid for any $N \\ge 1$ (i.e., $K \\ge 0$).\n\nThe error is $e_N(x,t) = u_N(x,t) - u(x,t) = t - 0 = t$.\nWe are asked to compute the $L^{2}$ norm of the error at time $t=1$. The error at this time is $e_N(x,1) = 1$.\nThe squared $L^{2}$ norm of the error is:\n$$\n\\left\\| e_{N}(\\cdot,1) \\right\\|_{L^{2}(0,2\\pi)}^{2} = \\int_{0}^{2\\pi} |e_{N}(x,1)|^{2} dx = \\int_{0}^{2\\pi} |1|^{2} dx = \\int_{0}^{2\\pi} 1 dx = 2\\pi\n$$\nThus, the $L^{2}$ norm of the error at $t=1$ is $\\left\\| e_{N}(\\cdot,1) \\right\\|_{L^{2}(0,2\\pi)} = \\sqrt{2\\pi}$.\n\nThis result is independent of $N$. Therefore, the limit as $N \\to \\infty$ is the same value:\n$$\n\\lim_{N \\to \\infty} \\,\\left\\| u_{N}(\\cdot,1) - 0 \\right\\|_{L^{2}(0,2\\pi)} = \\sqrt{2\\pi}\n$$\nThis nonzero limit confirms that the scheme does not converge to the exact solution.",
            "answer": "$$\n\\boxed{\\sqrt{2\\pi}}\n$$"
        },
        {
            "introduction": "After establishing the necessity of consistency, we now examine its partner concept: stability. A scheme can be perfectly consistent, meaning its local truncation error vanishes upon refinement, but still produce catastrophic results if it is unstable. This practical coding exercise explores such a scenario on a nonuniform grid, highlighting a common implementation pitfall and providing a tangible demonstration of how instability allows small errors to amplify uncontrollably, leading to a complete failure of convergence .",
            "id": "3217060",
            "problem": "Consider the one-dimensional heat equation $u_t = u_{xx}$ on the spatial interval $x \\in (0,1)$ with homogeneous Dirichlet boundary conditions $u(0,t) = 0$ and $u(1,t) = 0$, and the smooth initial condition $u(x,0) = \\sin(\\pi x)$. The goal is to examine the interaction of consistency, stability, and convergence for an explicit time-stepping scheme on nonuniform grids, and to test the Lax equivalence theorem in practice.\n\nStarting from core definitions:\n- Consistency: the local truncation error tends to zero as the spatial steps $h_i$ and the time step $\\Delta t$ tend to zero.\n- Stability: the discrete solution operator is bounded with respect to perturbations in input data or roundoff, typically characterized by a bound on the amplification factor.\n- Convergence: the numerical solution approaches the exact solution of the original continuous model in a chosen norm (here the square-integrable norm).\n\nConstruct the explicit forward Euler method of lines scheme using a nonuniform second-derivative finite difference at interior nodes $x_i$ as\n$$u^{n+1}_i = u^n_i + \\Delta t \\, D^{(2)}u^n_i,$$\nwhere $D^{(2)}$ is the three-point second derivative approximation derived by Taylor expansions on a nonuniform mesh with spacings $h_{i-1} = x_i - x_{i-1}$ and $h_i = x_{i+1} - x_i$,\n$$D^{(2)}u_i \\approx 2\\left(\\frac{u_{i-1}}{h_{i-1}(h_{i-1}+h_i)} - \\frac{u_i}{h_{i-1}h_i} + \\frac{u_{i+1}}{h_i(h_{i-1}+h_i)}\\right).$$\nImpose the boundary conditions by setting $u^n_0 = 0$ and $u^n_{N+1} = 0$.\n\nDefine the discrete spatial operator $L$ as the matrix representation of $D^{(2)}$ acting on the vector of interior nodal values $\\mathbf{u}^n = (u^n_1,\\dots,u^n_N)^\\top$, so that the method can be written as $\\mathbf{u}^{n+1} = \\left(I + \\Delta t\\, L\\right)\\mathbf{u}^n$. For the exact solution with the given initial condition, one has $u(x,t) = e^{-\\pi^2 t}\\sin(\\pi x)$.\n\nYou must:\n1. Implement the nonuniform grid second-derivative operator $L$ on a strictly increasing grid $\\{x_i\\}_{i=0}^{N+1}$ with $x_0 = 0$ and $x_{N+1} = 1$.\n2. For each test case, compute:\n   - The maximum one-step amplification factor $a_{\\max} = \\max_{\\lambda \\in \\mathrm{spec}(L)} |1 + \\Delta t\\, \\lambda|$, where $\\mathrm{spec}(L)$ denotes the spectrum (set of eigenvalues) of $L$.\n   - The discrete square-integrable norm (the $L^2$ norm) of the one-step error compared to $u(x,\\Delta t)$, using quadrature weights $w_i = \\tfrac{h_{i-1} + h_i}{2}$ for interior nodes and defining the norm $\\|\\mathbf{v}\\|_{L^2} = \\left(\\sum_{i=1}^N w_i v_i^2\\right)^{1/2}$.\n   - The refinement error ratio $r = E_{2N} / E_N$, where $E_N$ is the one-step discrete $L^2$ error on a grid with $N$ interior points and $E_{2N}$ is the analogous error on the grid with $2N$ interior points, both using the same step-selection policy as described below.\n   - The stability boolean defined by $a_{\\max} \\le 1$.\n3. Explain, via the computed values, how the scheme can be pointwise consistent (local truncation error goes to zero as $N \\to \\infty$ and $\\Delta t \\to 0$) yet unstable and therefore nonconvergent in the $L^2$ norm if the time step is not scaled with the smallest mesh size. Specifically, show that when the grid is strongly nonuniform, scaling $\\Delta t$ with the average step size squared can yield $a_{\\max} > 1$, violating stability and preventing convergence by the Lax equivalence theorem.\n\nUse the following test suite. For each case, build the grid and choose the time step according to the specified policy:\n- Case A (happy path, uniform and stable): $N = 64$, uniform grid $x_i = i/(N+1)$, choose $\\Delta t = 0.45\\, h_{\\min}^2$ where $h_{\\min} = \\min_i (x_{i+1} - x_i)$.\n- Case B (edge case, nonuniform and unstable by average scaling): $N = 64$, graded grid $x_i = \\left(\\frac{i}{N+1}\\right)^p$ with $p = 2$, choose $\\Delta t = 0.45\\, \\bar{h}^2$ where $\\bar{h} = \\frac{1}{N+1}\\sum_{i=0}^N (x_{i+1} - x_i)$.\n- Case C (nonuniform but stable by minimum scaling): $N = 64$, graded grid $x_i = \\left(\\frac{i}{N+1}\\right)^p$ with $p = 2$, choose $\\Delta t = 0.45\\, h_{\\min}^2$.\n\nFor each case, compute $a_{\\max}$, the stability boolean, and the refinement error ratio $r$ by comparing $E_N$ to $E_{2N}$ under the same policy. All quantities are dimensionless.\n\nYour program should produce a single line of output containing the results, formatted as a comma-separated list enclosed in square brackets with no spaces, where each case contributes a sublist of the form $[$stable\\_boolean$,a_{\\max},r]$. For example, an output with three cases should look like $[[\\mathrm{True},0.9,0.5],[\\mathrm{False},3.1,1.8],[\\mathrm{True},0.8,0.6]]$ with no spaces anywhere in the line.",
            "solution": "The problem as stated is a well-posed and scientifically sound exercise in numerical analysis, designed to investigate the interdependence of consistency, stability, and convergence for a numerical scheme solving the one-dimensional heat equation. All provided equations, conditions, and definitions are standard and correct. The problem is valid.\n\nThe core of this problem lies in the Lax Equivalence Theorem, which states that for a consistent linear finite difference scheme, stability is the necessary and sufficient condition for convergence. We will demonstrate this principle by applying an explicit forward-in-time, centered-in-space (FTCS) scheme to the heat equation $u_t = u_{xx}$ on nonuniform grids.\n\nThe numerical method is defined by the update rule $\\mathbf{u}^{n+1} = \\left(I + \\Delta t\\, L\\right)\\mathbf{u}^n$, where $\\mathbf{u}^n$ is the vector of numerical solutions at the interior grid points at time step $n$, $I$ is the identity matrix, $\\Delta t$ is the time step, and $L$ is the matrix representation of the second-derivative operator $D^{(2)}$ given by\n$$D^{(2)}u_i = 2\\left(\\frac{u_{i-1}}{h_{i-1}(h_{i-1}+h_i)} - \\frac{u_i}{h_{i-1}h_i} + \\frac{u_{i+1}}{h_i(h_{i-1}+h_i)}\\right)$$\nfor a grid with spacings $h_{i-1} = x_i - x_{i-1}$ and $h_i = x_{i+1} - x_i$. This operator is consistent with the continuous second derivative $u_{xx}$; its local truncation error tends to zero as mesh spacings tend to zero.\n\nThe stability of this explicit scheme is governed by the spectral radius of the amplification matrix $G = I + \\Delta t\\, L$. Stability requires that the one-step amplification factor, $a_{\\max} = \\rho(G) = \\max_{\\lambda \\in \\mathrm{spec}(L)} |1 + \\Delta t\\, \\lambda|$, must not exceed $1$. The eigenvalues $\\lambda$ of the discrete Laplacian operator $L$ are real and non-positive. Let $\\lambda_{\\min}$ be the most negative eigenvalue of $L$. The stability condition simplifies to $1 + \\Delta t\\, \\lambda_{\\min} \\ge -1$, which yields the constraint:\n$$\\Delta t \\le \\frac{-2}{\\lambda_{\\min}}$$\nFor a nonuniform grid, the magnitude of $|\\lambda_{\\min}|$ is dictated by the smallest grid spacing, $h_{\\min}$. It can be shown that $|\\lambda_{\\min}|$ scales as $1/h_{\\min}^2$. This leads to the well-known stability requirement for explicit schemes:\n$$\\Delta t \\le C \\cdot h_{\\min}^2$$\nfor some constant $C$ (for the uniform grid case, $C=1/2$). A crucial insight is that stability depends on the *minimum* spacing, $h_{\\min}$, not the average spacing, $\\bar{h}$. The problem's test cases are designed to illustrate this point.\n\nFor each case, we will compute the maximum amplification factor $a_{\\max}$, determine stability via the condition $a_{\\max} \\le 1$, and assess convergence behavior through the one-step error refinement ratio $r = E_N / E_N$. A ratio $r < 1$ indicates convergence, while $r \\ge 1$ suggests divergence.\n\n**Case A: Uniform Grid, Stable Time Step**\nThe grid is uniform, meaning $h_i = h = \\bar{h} = h_{\\min}$ for all $i$. The time step is chosen as $\\Delta t = 0.45\\, h_{\\min}^2 = 0.45\\, h^2$. This satisfies the stability condition $\\Delta t \\le 0.5\\, h^2$. Consequently, we expect the scheme to be stable, with $a_{\\max} \\le 1$. Since the scheme is consistent and stable, the Lax Equivalence Theorem guarantees convergence. This should be reflected by a refinement ratio $r < 1$.\n\n**Case B: Nonuniform Grid, Unstable Time Step**\nA graded mesh $x_i = (i/(N+1))^2$ is employed, which concentrates points near $x=0$, resulting in a very small $h_{\\min}$ compared to the average spacing $\\bar{h}$. The time step is set to $\\Delta t = 0.45\\, \\bar{h}^2$. Since $\\bar{h} \\gg h_{\\min}$, this choice of $\\Delta t$ will be far larger than what is permitted by the stability condition based on $h_{\\min}^2$.\n$$\\Delta t = 0.45\\, \\bar{h}^2 = 0.45 \\left(\\frac{\\bar{h}}{h_{\\min}}\\right)^2 h_{\\min}^2 \\gg h_{\\min}^2$$\nWe therefore predict that the scheme will be unstable, with $a_{\\max} > 1$. Despite being a consistent scheme, this instability will lead to non-convergence, which should be demonstrated by an error ratio $r \\ge 1$.\n\n**Case C: Nonuniform Grid, Stable Time Step**\nThis case uses the same graded mesh as Case B but corrects the flaw in the time-stepping policy. The time step is chosen as $\\Delta t = 0.45\\, h_{\\min}^2$. This choice respects the constraint imposed by the smallest mesh cells and is designed to satisfy the stability condition. We expect to find $a_{\\max} \\le 1$. With both consistency and stability re-established, the scheme should again be convergent, yielding a refinement ratio $r < 1$.\n\nThe implementation will construct the matrix $L$, compute its eigenvalues to find $a_{\\max}$, and calculate the one-step $L^2$ error against the exact solution $u(x,t) = e^{-\\pi^2 t}\\sin(\\pi x)$ to determine the refinement ratio $r$. The results will provide a practical demonstration of the Lax Equivalence Theorem and the critical importance of selecting a time step based on the most restrictive local grid spacing.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef compute_case_metrics(N, p, dt_policy):\n    \"\"\"\n    Computes stability and error metrics for a given grid and time step policy.\n\n    Args:\n        N (int): Number of interior grid points.\n        p (float): Power for graded grid generation. p=1 gives a uniform grid.\n        dt_policy (str): Time step policy, either 'min' or 'avg'.\n\n    Returns:\n        tuple: A tuple containing:\n            - l2_error (float): The discrete L2 norm of the one-step error.\n            - a_max (float): The maximum one-step amplification factor.\n            - is_stable (bool): True if the scheme is stable, False otherwise.\n    \"\"\"\n    # 1. Grid Generation\n    i_vals = np.arange(N + 2, dtype=float)\n    x = (i_vals / (N + 1))**p\n    h = np.diff(x)  # h has length N+1, h_i = x_{i+1} - x_i\n\n    # 2. Time Step Calculation\n    h_min = np.min(h)\n    # The problem defines h_bar as the sum over N+1 spacings divided by N+1\n    h_bar = np.mean(h)\n    \n    if dt_policy == 'min':\n        dt = 0.45 * h_min**2\n    elif dt_policy == 'avg':\n        dt = 0.45 * h_bar**2\n    else:\n        raise ValueError(\"Invalid dt_policy specified.\")\n\n    # 3. Construct the discrete operator matrix L\n    L = np.zeros((N, N))\n    # Loop over interior nodes i = 1, ..., N\n    # Matrix row j = i - 1 corresponds to node i\n    for j in range(N):\n        h_im1 = h[j]      # This is h_{i-1}\n        h_i   = h[j + 1]  # This is h_i\n        \n        # Diagonal term (coefficient of u_i)\n        L[j, j] = 2.0 * (-1.0 / (h_im1 * h_i))\n        \n        # Sub-diagonal term (coefficient of u_{i-1})\n        if j > 0:\n            L[j, j - 1] = 2.0 / (h_im1 * (h_im1 + h_i))\n        \n        # Super-diagonal term (coefficient of u_{i+1})\n        if j < N - 1:\n            L[j, j + 1] = 2.0 / (h_i * (h_im1 + h_i))\n\n    # 4. Compute stability metrics\n    eigenvalues = np.linalg.eigvals(L)\n    a_max = np.max(np.abs(1.0 + dt * eigenvalues))\n    is_stable = a_max <= 1.0\n\n    # 5. Compute one-step L2 error\n    x_interior = x[1:N + 1]\n    \n    # Initial condition at interior nodes\n    u0 = np.sin(np.pi * x_interior)\n    \n    # Numerical solution at t = dt\n    u1_num = u0 + dt * (L @ u0)\n    \n    # Exact solution at t = dt\n    u1_exact = np.exp(-np.pi**2 * dt) * np.sin(np.pi * x_interior)\n    \n    # Error vector\n    error_vec = u1_num - u1_exact\n    \n    # Quadrature weights for L2 norm\n    # w_i = (h_{i-1} + h_i)/2. For interior nodes i=1..N, these are h_0..h_{N-1} + h_1..h_N\n    weights = 0.5 * (h[0:N] + h[1:N + 1])\n    \n    l2_error = np.sqrt(np.sum(weights * error_vec**2))\n    \n    return l2_error, a_max, is_stable\n\ndef solve():\n    \"\"\"\n    Main function to run all test cases and print results.\n    \"\"\"\n    # (N_base, p, dt_policy) for each case\n    # p=1 represents a uniform grid as (i/(N+1))^1.\n    test_cases_params = [\n        (64, 1.0, 'min'),  # Case A: Uniform grid, stable by h_min\n        (64, 2.0, 'avg'),  # Case B: Graded grid, unstable by h_bar\n        (64, 2.0, 'min'),  # Case C: Graded grid, stable by h_min\n    ]\n\n    final_results = []\n    for N_base, p, policy in test_cases_params:\n        # Calculate metrics for the base grid N\n        E_N, a_max, is_stable = compute_case_metrics(N_base, p, policy)\n        \n        # Calculate error for the refined grid 2N to find the ratio\n        E_2N, _, _ = compute_case_metrics(2 * N_base, p, policy)\n        \n        # Refinement error ratio\n        r = E_2N / E_N\n        \n        final_results.append([is_stable, a_max, r])\n    \n    # Format the output string exactly as specified: [[val,val,val],[val,val,val],...]\n    case_strings = []\n    for s_bool, a_val, r_val in final_results:\n        # Python's bool __str__ is 'True' or 'False'\n        case_strings.append(f\"[{str(s_bool)},{a_val},{r_val}]\")\n    \n    print(f\"[{','.join(case_strings)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "With a firm grasp of the interplay between consistency and stability, we can now apply these tools to evaluate and compare sophisticated methods used in computational electromagnetics. This practice involves a rigorous von Neumann stability analysis to derive the Courant-Friedrichs-Lewy (CFL) conditions for two powerful time-domain solvers: the standard finite-difference Yee scheme and the high-order pseudo-spectral time-domain (PSTD) method . This direct comparison reveals the practical trade-offs in accuracy and computational cost, a crucial skill for designing efficient electromagnetic simulations.",
            "id": "3335810",
            "problem": "Consider Maxwell’s equations in vacuum on a three-dimensional periodic cubic domain with uniform grid spacing $\\Delta$ in each coordinate direction. Let $c$ denote the speed of light in vacuum, satisfying $c = 1/\\sqrt{\\varepsilon \\mu}$ with permittivity $\\varepsilon$ and permeability $\\mu$. A pseudo-spectral time-domain (PSTD) scheme updates the electric field $\\mathbf{E}$ and magnetic field $\\mathbf{H}$ in a leapfrog manner (fields staggered by half a time step) using the spatial curl operator evaluated spectrally via the Fourier transform so that spatial derivatives are represented exactly for resolved Fourier modes. To enforce dealiasing, assume a spherically truncated spectral representation with a sharp cutoff at wavenumber magnitude $k_c = \\frac{2}{3}\\frac{\\pi}{\\Delta}$ (the Orszag two-thirds rule implemented isotropically in $\\mathbf{k}$-space).\n\nStarting from the vacuum Maxwell equations and the leapfrog PSTD update, perform a von Neumann (Fourier) analysis for a divergence-free plane wave mode with wavevector $\\mathbf{k}$ of magnitude $|\\mathbf{k}| \\leq k_c$. Derive the discrete dispersion relation for the PSTD leapfrog scheme and hence the stability condition on the time step $\\Delta t$ in terms of the maximum retained wavenumber magnitude $k_c$. Use this to obtain the maximum stable time step $\\Delta t_{\\max,\\mathrm{PSTD}}$ under the stated dealiased cutoff.\n\nFor comparison, consider the standard staggered-grid finite-difference time-domain scheme of Yee (the Yee scheme) on the same cubic grid with spacing $\\Delta$ and leapfrog time stepping. Using a von Neumann analysis of the Yee scheme, derive the Courant–Friedrichs–Lewy (CFL) time-step bound $\\Delta t_{\\max,\\mathrm{Yee}}$ in three dimensions in terms of $\\Delta$ and $c$.\n\nFinally, compute the exact closed-form expression for the ratio\n$$\nR \\equiv \\frac{\\Delta t_{\\max,\\mathrm{PSTD}}}{\\Delta t_{\\max,\\mathrm{Yee}}}\n$$\nunder the stated assumptions. Provide your final result for $R$ as a single simplified analytic expression. Do not include units. Do not approximate or round your result.",
            "solution": "The problem requires the derivation of the maximum stable time steps for two numerical schemes for solving Maxwell's equations—the pseudo-spectral time-domain (PSTD) scheme and the finite-difference time-domain (FDTD) Yee scheme—and then computing the ratio of these time steps.\n\nThe analysis begins with Maxwell's curl equations in a vacuum, which are given by:\n$$ \\nabla \\times \\mathbf{E} = -\\mu \\frac{\\partial \\mathbf{H}}{\\partial t} $$\n$$ \\nabla \\times \\mathbf{H} = \\varepsilon \\frac{\\partial \\mathbf{E}}{\\partial t} $$\nwhere $\\mathbf{E}$ is the electric field, $\\mathbf{H}$ is the magnetic field, $\\varepsilon$ is the permittivity, and $\\mu$ is the permeability. The speed of light in vacuum is $c = 1/\\sqrt{\\varepsilon\\mu}$.\n\nA von Neumann stability analysis will be performed for both schemes. This involves considering a single Fourier mode (plane wave) of the form $\\mathbf{F}(\\mathbf{r}, t) = \\mathbf{F}_0 e^{i(\\mathbf{k} \\cdot \\mathbf{r} - \\omega t)}$, where $\\mathbf{F}$ is either $\\mathbf{E}$ or $\\mathbf{H}$, $\\mathbf{k}$ is the wavevector, and $\\omega$ is the angular frequency. For a discretized system, we analyze the amplification factor $g$ per time step. The scheme is stable if $|g| \\leq 1$ for all wavevectors $\\mathbf{k}$ supported by the numerical grid.\n\nFor a divergence-free plane wave, we have $\\nabla \\cdot \\mathbf{E} = 0$ and $\\nabla \\cdot \\mathbf{H} = 0$, which in Fourier space corresponds to $\\mathbf{k} \\cdot \\mathbf{E}_0 = 0$ and $\\mathbf{k} \\cdot \\mathbf{H}_0 = 0$. This allows the use of the vector identity $\\mathbf{k} \\times (\\mathbf{k} \\times \\mathbf{F}_0) = \\mathbf{k}(\\mathbf{k} \\cdot \\mathbf{F}_0) - k^2 \\mathbf{F}_0 = -k^2 \\mathbf{F}_0$, where $k = |\\mathbf{k}|$.\n\nFirst, we analyze the PSTD scheme. The leapfrog time-stepping scheme for Maxwell's equations is:\n$$ \\frac{\\mathbf{E}^{n+1} - \\mathbf{E}^{n}}{\\Delta t} = \\frac{1}{\\varepsilon} (\\nabla \\times \\mathbf{H}^{n+1/2}) $$\n$$ \\frac{\\mathbf{H}^{n+1/2} - \\mathbf{H}^{n-1/2}}{\\Delta t} = -\\frac{1}{\\mu} (\\nabla \\times \\mathbf{E}^{n}) $$\nwhere the superscript denotes the time index, and $\\Delta t$ is the time step. In the PSTD method, the spatial curl operator $\\nabla \\times$ is evaluated in the Fourier domain, where it becomes $i\\mathbf{k} \\times$. For the resolved modes, this representation is exact. Combining the two leapfrog equations to eliminate one field (e.g., $\\mathbf{H}$) leads to a second-order update equation for the other field ($\\mathbf{E}$):\n$$ \\frac{\\mathbf{E}^{n+1} - 2\\mathbf{E}^{n} + \\mathbf{E}^{n-1}}{(\\Delta t)^2} = \\frac{1}{\\varepsilon\\mu} \\nabla \\times (\\nabla \\times \\mathbf{E}^n) = -c^2 k^2 \\mathbf{E}^n $$\nWe substitute a trial solution for the time evolution of a single Fourier mode, $\\mathbf{E}^n = \\mathbf{E}_0 g^n$, where $g$ is the amplification factor:\n$$ g^{n+1} - 2g^n + g^{n-1} = - (c k \\Delta t)^2 g^n $$\nDividing by $g^{n-1}$ yields a quadratic equation for $g$:\n$$ g^2 - (2 - (c k \\Delta t)^2) g + 1 = 0 $$\nFor stability, we require $|g| \\leq 1$. The roots of this quadratic equation are given by $g = \\frac{(2 - (ck\\Delta t)^2) \\pm \\sqrt{(2 - (ck\\Delta t)^2)^2 - 4}}{2}$. The scheme is stable without dissipation if the discriminant is non-positive, which ensures $|g|=1$.\n$$ (2 - (ck\\Delta t)^2)^2 - 4 \\leq 0 $$\n$$ (ck\\Delta t)^2 ( (ck\\Delta t)^2 - 4 ) \\leq 0 $$\nSince $(ck\\Delta t)^2 \\geq 0$, this requires $(ck\\Delta t)^2 - 4 \\leq 0$, or $|ck\\Delta t| \\leq 2$.\nThe discrete dispersion relation can also be derived by setting $g = e^{-i\\tilde{\\omega}\\Delta t}$, where $\\tilde{\\omega}$ is the numerical frequency. Substituting this into the recursion gives $2\\cos(\\tilde{\\omega}\\Delta t) = 2 - (ck\\Delta t)^2$, which simplifies to:\n$$ \\sin\\left(\\frac{\\tilde{\\omega}\\Delta t}{2}\\right) = \\pm\\frac{ck\\Delta t}{2} $$\nFor the right-hand side to be a valid sine value, we must have $|\\frac{ck\\Delta t}{2}| \\leq 1$, which is the same stability condition $|ck\\Delta t| \\leq 2$.\nThis condition must hold for all wavevectors present in the simulation. The problem specifies a sharp spherical cutoff at $k_c = \\frac{2}{3}\\frac{\\pi}{\\Delta}$, so the maximum wavenumber magnitude is $k_{\\max} = k_c$. The stability condition is therefore:\n$$ c k_c \\Delta t \\leq 2 $$\nThis gives the maximum stable time step for the PSTD scheme:\n$$ \\Delta t_{\\max,\\mathrm{PSTD}} = \\frac{2}{c k_c} = \\frac{2}{c \\left(\\frac{2}{3}\\frac{\\pi}{\\Delta}\\right)} = \\frac{6\\Delta}{2\\pi c} = \\frac{3\\Delta}{\\pi c} $$\n\nNext, we analyze the Yee FDTD scheme. This scheme uses central finite differences on a staggered grid. For a cubic grid with spacing $\\Delta$, the finite difference approximation of a spatial derivative, e.g., $\\partial/\\partial x$, acts on a Fourier mode $e^{ik_x x}$ as:\n$$ \\frac{e^{ik_x(x+\\Delta/2)} - e^{ik_x(x-\\Delta/2)}}{\\Delta} \\rightarrow \\frac{2i}{\\Delta}\\sin\\left(\\frac{k_x\\Delta}{2}\\right) $$\nThus, the continuous wavevector component $k_x$ is replaced by an effective (or numerical) wavevector component $\\tilde{k}_x = \\frac{2}{\\Delta}\\sin(\\frac{k_x\\Delta}{2})$. The entire analysis for the PSTD scheme carries over, but with the continuous wavevector $\\mathbf{k}$ replaced by the effective wavevector $\\tilde{\\mathbf{k}} = (\\tilde{k}_x, \\tilde{k}_y, \\tilde{k}_z)$.\nThe stability condition for the Yee scheme is:\n$$ c |\\tilde{\\mathbf{k}}| \\Delta t \\leq 2 $$\nTo find the maximum stable time step, we must find the maximum possible value of $|\\tilde{\\mathbf{k}}|$. The components of the effective wavevector are:\n$$ \\tilde{k}_x = \\frac{2}{\\Delta}\\sin\\left(\\frac{k_x\\Delta}{2}\\right), \\quad \\tilde{k}_y = \\frac{2}{\\Delta}\\sin\\left(\\frac{k_y\\Delta}{2}\\right), \\quad \\tilde{k}_z = \\frac{2}{\\Delta}\\sin\\left(\\frac{k_z\\Delta}{2}\\right) $$\nThe magnitude squared is $|\\tilde{\\mathbf{k}}|^2 = \\frac{4}{\\Delta^2}\\left[\\sin^2\\left(\\frac{k_x\\Delta}{2}\\right) + \\sin^2\\left(\\frac{k_y\\Delta}{2}\\right) + \\sin^2\\left(\\frac{k_z\\Delta}{2}\\right)\\right]$.\nThe maximum value of the sine function is $1$, which occurs when its argument is $\\pi/2$. The components of the continuous wavevector $\\mathbf{k}$ can range up to the edge of the first Brillouin zone, i.e., $|k_x|, |k_y|, |k_z| \\leq \\pi/\\Delta$. Thus, the maximum value of each $\\sin^2$ term is $\\sin^2(\\frac{(\\pi/\\Delta)\\Delta}{2}) = \\sin^2(\\pi/2) = 1$.\nThe maximum of $|\\tilde{\\mathbf{k}}|$ occurs when all three components are maximized, corresponding to a wave propagating along the main diagonal of the grid's Brillouin zone ($k_x = k_y = k_z = \\pi/\\Delta$):\n$$ |\\tilde{\\mathbf{k}}|_{\\max}^2 = \\frac{4}{\\Delta^2}(1 + 1 + 1) = \\frac{12}{\\Delta^2} $$\n$$ |\\tilde{\\mathbf{k}}|_{\\max} = \\frac{2\\sqrt{3}}{\\Delta} $$\nInserting this into the stability condition:\n$$ c \\left(\\frac{2\\sqrt{3}}{\\Delta}\\right) \\Delta t \\leq 2 $$\n$$ \\Delta t \\leq \\frac{\\Delta}{c\\sqrt{3}} $$\nThis is the Courant–Friedrichs–Lewy (CFL) condition for the 3D Yee scheme. The maximum stable time step is:\n$$ \\Delta t_{\\max,\\mathrm{Yee}} = \\frac{\\Delta}{c\\sqrt{3}} $$\n\nFinally, we compute the ratio $R = \\frac{\\Delta t_{\\max,\\mathrm{PSTD}}}{\\Delta t_{\\max,\\mathrm{Yee}}}$.\n$$ R = \\frac{\\frac{3\\Delta}{\\pi c}}{\\frac{\\Delta}{c\\sqrt{3}}} = \\frac{3\\Delta}{\\pi c} \\cdot \\frac{c\\sqrt{3}}{\\Delta} $$\nThe terms $\\Delta$ and $c$ cancel out, leaving:\n$$ R = \\frac{3\\sqrt{3}}{\\pi} $$\nThis is the exact closed-form expression for the ratio.",
            "answer": "$$\\boxed{\\frac{3\\sqrt{3}}{\\pi}}$$"
        }
    ]
}