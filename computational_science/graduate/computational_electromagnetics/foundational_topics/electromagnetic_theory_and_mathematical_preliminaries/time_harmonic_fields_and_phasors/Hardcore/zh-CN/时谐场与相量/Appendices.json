{
    "hands_on_practices": [
        {
            "introduction": "相量法是分析时间谐波场的有力工具，但其核心是一种数学约定。一个看似微小的约定选择，例如使用 $\\exp(j\\omega t)$ 还是 $\\exp(-j\\omega t)$ 作为时间因子，会对整个理论框架产生深远的影响。本练习  设计了一个思想实验，通过揭示混合使用不同约定将如何导致诸如负辐射电阻之类的物理谬误，来强调在所有推导和仿真中保持约定一致性的重要性。",
            "id": "3356064",
            "problem": "计算电磁学中的一个核心困难源于时间谐波相量约定的不一致使用及其在频域麦克斯韦方程组中引起的符号变化。考虑一个均匀、无源区域中的时域麦克斯韦方程组，其磁导率为 $\\mu$，介电常数为 $\\epsilon$：$\\nabla \\times \\mathbf{E}(\\mathbf{r},t) = -\\partial \\mathbf{B}(\\mathbf{r},t)/\\partial t$ 和 $\\nabla \\times \\mathbf{H}(\\mathbf{r},t) = \\partial \\mathbf{D}(\\mathbf{r},t)/\\partial t$，其中 $\\mathbf{B} = \\mu \\mathbf{H}$ 和 $\\mathbf{D} = \\epsilon \\mathbf{E}$。对于时间依赖性，使用两种标准的相量约定：$\\exp(j\\omega t)$ 和 $\\exp(-j\\omega t)$。从这些定律和相量的定义出发，确定在每种约定下旋度方程的形式，并特别注意 $j$ 的符号。\n\n现在设计一个思想实验，以揭示误用约定的后果。考虑一个沿 $z$ 轴放置的细直、中心馈电的理想电导体（PEC）偶极子，其长度为 $\\ell$，且满足 $\\ell \\ll \\lambda$，其中 $\\lambda$ 是自由空间波长。设馈电电流是一个振幅为 $I_0$ 的时间谐波相量，并均匀分布在导线段上。从麦克斯韦方程组和辐射区近似出发，当使用正确的 $\\exp(j\\omega t)$ 约定时，推导辐射场的远场相量表达式，并用它们通过坡印亭矢量计算时间平均辐射功率，以及在馈电端观察到的相应辐射电阻 $R_{\\mathrm{rad}}$。然后，构造误用情况：保留在 $\\exp(j\\omega t)$ 约定下得到的辐射 $\\mathbf{E}$ 场表达式，但使用由相反的 $\\exp(-j\\omega t)$ 约定得出的频域旋度方程来关联 $\\mathbf{H}$ 与 $\\mathbf{E}$。使用标准的时间平均功率表达式，证明这种不一致性如何导致对相同几何结构预测出负的辐射电阻。\n\n将差异定义为 $\\Delta R = R_{\\mathrm{wrong}} - R_{\\mathrm{correct}}$，其中 $R_{\\mathrm{wrong}}$ 是在上述误用情况下预测的辐射电阻，而 $R_{\\mathrm{correct}}$ 是在一致使用 $\\exp(j\\omega t)$ 情况下推导出的辐射电阻。对于一个在自由空间中频率为 $f = 300\\,\\mathrm{MHz}$、长度为 $\\ell = 0.05\\,\\mathrm{m}$ 的偶极子，计算 $\\Delta R$，并以欧姆为单位表示最终结果。将答案四舍五入至四位有效数字。你可以取自由空间本征阻抗为 $\\eta_0 = 120\\pi$，波数为 $k = 2\\pi/\\lambda$，其中 $\\lambda = c/f$，并且你必须从麦克斯韦方程组和相量定义出发，推导所有需要的关系式，不得使用快捷公式。",
            "solution": "首先验证问题，以确保其科学上成立、良定且客观。\n\n### 步骤1：提取已知条件\n- 均匀、无源区域中的时域麦克斯韦方程组：$\\nabla \\times \\mathbf{E}(\\mathbf{r},t) = -\\partial \\mathbf{B}(\\mathbf{r},t)/\\partial t$ 和 $\\nabla \\times \\mathbf{H}(\\mathbf{r},t) = \\partial \\mathbf{D}(\\mathbf{r},t)/\\partial t$。\n- 本构关系：$\\mathbf{B} = \\mu \\mathbf{H}$ 和 $\\mathbf{D} = \\epsilon \\mathbf{E}$。\n- 时间依赖性的相量约定：$\\exp(j\\omega t)$ 和 $\\exp(-j\\omega t)$。\n- 天线：沿 $z$ 轴放置的细直、中心馈电的理想电导体（PEC）偶极子，长度为 $\\ell$。\n- 条件：$\\ell \\ll \\lambda$，其中 $\\lambda$ 是自由空间波长。\n- 源：馈电电流是振幅为 $I_0$ 的时间谐波相量，均匀分布在导线上。\n- 任务1（正确）：使用 $\\exp(j\\omega t)$ 约定，推导辐射场的远场相量，计算时间平均辐射功率，并求出辐射电阻 $R_{\\mathrm{correct}}$。\n- 任务2（误用）：保留任务1中的 $\\mathbf{E}$ 场，但使用由 $\\exp(-j\\omega t)$ 约定得出的旋度方程来关联 $\\mathbf{H}$ 与 $\\mathbf{E}$。使用标准的时间平均功率表达式求出最终的辐射电阻 $R_{\\mathrm{wrong}}$。\n- 任务3（差异）：计算 $\\Delta R = R_{\\mathrm{wrong}} - R_{\\mathrm{correct}}$。\n- 数值：$f = 300\\,\\mathrm{MHz}$，$\\ell = 0.05\\,\\mathrm{m}$。\n- 常数和关系式：自由空间本征阻抗 $\\eta_0 = 120\\pi$，波数 $k = 2\\pi/\\lambda$，波长 $\\lambda = c/f$。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题是科学上成立的，基于麦克斯韦方程组和天线理论。这是一个良定的思想实验，旨在说明计算电磁学中一个关于相量约定的已知关键问题。所用的语言和要求的推导在电磁理论中是标准的。“均匀分布”电流的假设是一种理想化，对应于赫兹偶极子模型，这是对短偶极子（$\\ell \\ll \\lambda$）的一个有效且标准的近似。问题是自洽的，推导和数值计算所需的所有数据均已提供。不存在矛盾、歧义或科学上不成立的前提。\n\n### 步骤3：结论与行动\n该问题被判定为**有效**。将提供一个完整的、有理有据的解答。\n\n### 解答推导\n\n我们首先为两种指定的时间谐波约定建立麦克斯韦旋度方程的频域（相量）形式。\n\n设一个一般的时间谐波矢量场为 $\\mathbf{F}(\\mathbf{r},t)$。\n1.  **约定1：$e^{j\\omega t}$ 时间依赖性。**\n    场表示为 $\\mathbf{F}(\\mathbf{r},t) = \\mathrm{Re}[\\tilde{\\mathbf{F}}(\\mathbf{r}) e^{j\\omega t}]$。时间导数算子变为 $\\frac{\\partial}{\\partial t} \\rightarrow j\\omega$。\n    麦克斯韦方程组的相量形式为：\n    $$ \\nabla \\times \\tilde{\\mathbf{E}} = -\\frac{\\partial \\tilde{\\mathbf{B}}}{\\partial t} = -j\\omega\\tilde{\\mathbf{B}} = -j\\omega\\mu\\tilde{\\mathbf{H}} $$\n    $$ \\nabla \\times \\tilde{\\mathbf{H}} = \\frac{\\partial \\tilde{\\mathbf{D}}}{\\partial t} = j\\omega\\tilde{\\mathbf{D}} = j\\omega\\epsilon\\tilde{\\mathbf{E}} $$\n\n2.  **约定2：$e^{-j\\omega t}$ 时间依赖性。**\n    场表示为 $\\mathbf{F}(\\mathbf{r},t) = \\mathrm{Re}[\\tilde{\\mathbf{F}}(\\mathbf{r}) e^{-j\\omega t}]$。时间导数算子变为 $\\frac{\\partial}{\\partial t} \\rightarrow -j\\omega$。\n    麦克斯韦方程组的相量形式为：\n    $$ \\nabla \\times \\tilde{\\mathbf{E}} = -(-j\\omega\\tilde{\\mathbf{B}}) = j\\omega\\mu\\tilde{\\mathbf{H}} $$\n    $$ \\nabla \\times \\tilde{\\mathbf{H}} = (-j\\omega\\tilde{\\mathbf{D}}) = -j\\omega\\epsilon\\tilde{\\mathbf{E}} $$\n    一个关键后果是方程虚部的符号变化。\n\n**第1部分：使用 $\\exp(j\\omega t)$ 约定的正确推导**\n\n我们推导由一个具有均匀电流 $I_0$ 的短、细偶极子辐射的场。这种结构被称为赫兹偶极子。电流密度相量为 $\\tilde{\\mathbf{J}}(\\mathbf{r}') = I_0 \\delta(x')\\delta(y')\\hat{\\mathbf{z}}$，其中 $z' \\in [-\\ell/2, \\ell/2]$。矢量势 $\\tilde{\\mathbf{A}}$ 由亥姆霍兹方程求得，其在自由空间中的解是推迟势积分：\n$$ \\tilde{\\mathbf{A}}(\\mathbf{r}) = \\frac{\\mu_0}{4\\pi} \\int_V \\frac{\\tilde{\\mathbf{J}}(\\mathbf{r}') e^{-jkR}}{R} dV' $$\n其中 $R=|\\mathbf{r}-\\mathbf{r}'|$，$k = \\omega/c = \\omega\\sqrt{\\mu_0\\epsilon_0}$ 是自由空间波数。\n\n在远场区（$r \\gg \\ell, r \\gg \\lambda$），我们在分母中近似 $R \\approx r$，在指数中近似 $R \\approx r - \\mathbf{r}'\\cdot\\hat{\\mathbf{r}}$。对于一个沿 $z$ 轴的偶极子，$\\mathbf{r}'\\cdot\\hat{\\mathbf{r}} = z'\\cos\\theta$。\n$$ \\tilde{\\mathbf{A}}(\\mathbf{r}) \\approx \\frac{\\mu_0}{4\\pi} \\frac{e^{-jkr}}{r} \\int_{-\\ell/2}^{\\ell/2} (I_0 \\hat{\\mathbf{z}}) e^{jkz'\\cos\\theta} dz' $$\n由于 $\\ell \\ll \\lambda$，则 $k\\ell \\ll 1$，因此对于偶极子上的所有 $z'$，都有 $kz'\\cos\\theta \\ll 1$。我们可以近似 $e^{jkz'\\cos\\theta} \\approx 1$。\n$$ \\tilde{\\mathbf{A}}(\\mathbf{r}) \\approx \\frac{\\mu_0 I_0 \\hat{\\mathbf{z}}}{4\\pi r} e^{-jkr} \\int_{-\\ell/2}^{\\ell/2} dz' = \\frac{\\mu_0 I_0 \\ell}{4\\pi r} e^{-jkr} \\hat{\\mathbf{z}} $$\n接下来，我们使用 $\\tilde{\\mathbf{H}} = \\frac{1}{\\mu_0}\\nabla \\times \\tilde{\\mathbf{A}}$ 来求磁场相量 $\\tilde{\\mathbf{H}}_{\\mathrm{correct}}$。在球坐标系中，$\\hat{\\mathbf{z}} = \\hat{\\mathbf{r}}\\cos\\theta - \\hat{\\mathbf{\\theta}}\\sin\\theta$。\n$$ \\tilde{A}_r = \\tilde{A}_z \\cos\\theta = \\frac{\\mu_0 I_0 \\ell}{4\\pi r} e^{-jkr} \\cos\\theta $$\n$$ \\tilde{A}_\\theta = -\\tilde{A}_z \\sin\\theta = -\\frac{\\mu_0 I_0 \\ell}{4\\pi r} e^{-jkr} \\sin\\theta $$\n球坐标系中的旋度给出一个非零的 $\\phi$ 分量：$\\tilde{H}_\\phi = \\frac{1}{\\mu_0 r} (\\frac{\\partial}{\\partial r}(r\\tilde{A}_\\theta) - \\frac{\\partial \\tilde{A}_r}{\\partial\\theta})$。在远场区，我们只保留 $1/r$ 阶的项：\n$$ \\frac{\\partial}{\\partial r}(r\\tilde{A}_\\theta) = \\frac{\\partial}{\\partial r} \\left(-\\frac{\\mu_0 I_0 \\ell}{4\\pi} e^{-jkr} \\sin\\theta\\right) = \\frac{j k \\mu_0 I_0 \\ell}{4\\pi} e^{-jkr} \\sin\\theta $$\n项 $\\partial \\tilde{A}_r/\\partial\\theta$ 产生 $1/r^2$ 的依赖性，因此被忽略。于是：\n$$ \\tilde{\\mathbf{H}}_{\\mathrm{correct}} = \\hat{\\mathbf{\\phi}} \\tilde{H}_\\phi \\approx \\hat{\\mathbf{\\phi}} \\frac{1}{\\mu_0 r} \\left( \\frac{j k \\mu_0 I_0 \\ell}{4\\pi} e^{-jkr} \\sin\\theta \\right) = \\hat{\\mathbf{\\phi}} \\frac{j k I_0 \\ell}{4\\pi r} e^{-jkr} \\sin\\theta $$\n电场相量 $\\tilde{\\mathbf{E}}_{\\mathrm{correct}}$ 由 $\\nabla \\times \\tilde{\\mathbf{H}} = j\\omega\\epsilon_0\\tilde{\\mathbf{E}}$ 求得。在远场区，这简化为平面波关系 $\\tilde{\\mathbf{E}} = \\eta_0 (\\hat{\\mathbf{r}} \\times \\tilde{\\mathbf{H}})$，其中 $\\eta_0 = \\sqrt{\\mu_0/\\epsilon_0}$。\n$$ \\tilde{\\mathbf{E}}_{\\mathrm{correct}} = \\eta_0 (\\hat{\\mathbf{r}} \\times \\hat{\\mathbf{\\phi}} \\tilde{H}_\\phi) = \\eta_0 \\tilde{H}_\\phi \\hat{\\mathbf{\\theta}} = \\hat{\\mathbf{\\theta}} \\eta_0 \\frac{j k I_0 \\ell}{4\\pi r} e^{-jkr} \\sin\\theta $$\n时间平均坡印亭矢量为 $\\langle \\mathbf{S} \\rangle = \\frac{1}{2}\\mathrm{Re}[\\tilde{\\mathbf{E}} \\times \\tilde{\\mathbf{H}}^*]$。\n$$ \\langle \\mathbf{S} \\rangle_{\\mathrm{correct}} = \\frac{1}{2}\\mathrm{Re}[(\\hat{\\mathbf{\\theta}} \\eta_0 \\tilde{H}_\\phi) \\times (\\hat{\\mathbf{\\phi}} \\tilde{H}_\\phi^*)] = \\frac{1}{2}\\mathrm{Re}[\\hat{\\mathbf{r}} \\eta_0 |\\tilde{H}_\\phi|^2] = \\hat{\\mathbf{r}} \\frac{\\eta_0}{2} |\\tilde{H}_\\phi|^2 $$\n$$ |\\tilde{H}_\\phi|^2 = \\left| \\frac{j k I_0 \\ell}{4\\pi r} e^{-jkr} \\sin\\theta \\right|^2 = \\left( \\frac{k I_0 \\ell}{4\\pi r} \\sin\\theta \\right)^2 $$\n$$ \\langle \\mathbf{S} \\rangle_{\\mathrm{correct}} = \\hat{\\mathbf{r}} \\frac{\\eta_0}{2} \\left( \\frac{k I_0 \\ell}{4\\pi r} \\right)^2 \\sin^2\\theta $$\n总辐射功率 $P_{\\mathrm{correct}}$ 是 $\\langle \\mathbf{S} \\rangle_{\\mathrm{correct}}$ 在球面上的积分。\n$$ P_{\\mathrm{correct}} = \\oint_S \\langle \\mathbf{S} \\rangle_{\\mathrm{correct}} \\cdot d\\mathbf{S} = \\int_0^{2\\pi} \\int_0^\\pi \\left( \\frac{\\eta_0 k^2 I_0^2 \\ell^2}{32\\pi^2 r^2} \\sin^2\\theta \\right) r^2 \\sin\\theta d\\theta d\\phi $$\n$$ P_{\\mathrm{correct}} = \\frac{\\eta_0 k^2 I_0^2 \\ell^2}{32\\pi^2} (2\\pi) \\int_0^\\pi \\sin^3\\theta d\\theta $$\n积分为 $\\int_0^\\pi \\sin^3\\theta d\\theta = 4/3$。\n$$ P_{\\mathrm{correct}} = \\frac{\\eta_0 k^2 I_0^2 \\ell^2}{16\\pi} \\left(\\frac{4}{3}\\right) = \\frac{\\eta_0 k^2 I_0^2 \\ell^2}{12\\pi} $$\n辐射电阻 $R_{\\mathrm{correct}}$ 由 $P_{\\mathrm{correct}} = \\frac{1}{2}I_0^2 R_{\\mathrm{correct}}$ 定义。\n$$ R_{\\mathrm{correct}} = \\frac{2P_{\\mathrm{correct}}}{I_0^2} = \\frac{2}{I_0^2} \\left( \\frac{\\eta_0 k^2 I_0^2 \\ell^2}{12\\pi} \\right) = \\frac{\\eta_0 k^2 \\ell^2}{6\\pi} $$\n\n**第2部分：不一致的“误用”情况**\n\n根据指示，我们保持 $\\tilde{\\mathbf{E}}_{\\mathrm{wrong}} = \\tilde{\\mathbf{E}}_{\\mathrm{correct}}$，并使用来自相反的 $\\exp(-j\\omega t)$ 约定的旋度方程 $\\nabla \\times \\tilde{\\mathbf{E}} = j\\omega\\mu_0 \\tilde{\\mathbf{H}}$ 来求 $\\tilde{\\mathbf{H}}_{\\mathrm{wrong}}$。\n$$ \\tilde{\\mathbf{H}}_{\\mathrm{wrong}} = \\frac{1}{j\\omega\\mu_0} \\nabla \\times \\tilde{\\mathbf{E}}_{\\mathrm{wrong}} = \\frac{1}{j\\omega\\mu_0} \\nabla \\times \\tilde{\\mathbf{E}}_{\\mathrm{correct}} $$\n从正确的推导中，我们知道 $\\nabla \\times \\tilde{\\mathbf{E}}_{\\mathrm{correct}} = -j\\omega\\mu_0 \\tilde{\\mathbf{H}}_{\\mathrm{correct}}$。代入此式可得：\n$$ \\tilde{\\mathbf{H}}_{\\mathrm{wrong}} = \\frac{1}{j\\omega\\mu_0} (-j\\omega\\mu_0 \\tilde{\\mathbf{H}}_{\\mathrm{correct}}) = -\\tilde{\\mathbf{H}}_{\\mathrm{correct}} $$\n现在我们用这个不一致的场对计算辐射功率。\n$$ \\langle \\mathbf{S} \\rangle_{\\mathrm{wrong}} = \\frac{1}{2}\\mathrm{Re}[\\tilde{\\mathbf{E}}_{\\mathrm{wrong}} \\times \\tilde{\\mathbf{H}}_{\\mathrm{wrong}}^*] = \\frac{1}{2}\\mathrm{Re}[\\tilde{\\mathbf{E}}_{\\mathrm{correct}} \\times (-\\tilde{\\mathbf{H}}_{\\mathrm{correct}})^*] $$\n由于 $(-\\tilde{\\mathbf{H}})^* = -\\tilde{\\mathbf{H}}^*$，\n$$ \\langle \\mathbf{S} \\rangle_{\\mathrm{wrong}} = \\frac{1}{2}\\mathrm{Re}[-\\tilde{\\mathbf{E}}_{\\mathrm{correct}} \\times \\tilde{\\mathbf{H}}_{\\mathrm{correct}}^*] = -\\left( \\frac{1}{2}\\mathrm{Re}[\\tilde{\\mathbf{E}}_{\\mathrm{correct}} \\times \\tilde{\\mathbf{H}}_{\\mathrm{correct}}^*] \\right) = -\\langle \\mathbf{S} \\rangle_{\\mathrm{correct}} $$\n这意味着功率流是负的（径向向内），因此 $P_{\\mathrm{wrong}} = -P_{\\mathrm{correct}}$。由此产生的辐射电阻为：\n$$ R_{\\mathrm{wrong}} = \\frac{2P_{\\mathrm{wrong}}}{I_0^2} = \\frac{-2P_{\\mathrm{correct}}}{I_0^2} = -R_{\\mathrm{correct}} $$\n相量约定的误用导致预测出负的辐射电阻，这是一个物理上荒谬的结果，意味着天线从自由空间吸收功率。\n\n**第3部分：差异 $\\Delta R$ 的计算**\n\n差异定义为 $\\Delta R = R_{\\mathrm{wrong}} - R_{\\mathrm{correct}}$。\n$$ \\Delta R = -R_{\\mathrm{correct}} - R_{\\mathrm{correct}} = -2R_{\\mathrm{correct}} = -2 \\left( \\frac{\\eta_0 k^2 \\ell^2}{6\\pi} \\right) = -\\frac{\\eta_0 k^2 \\ell^2}{3\\pi} $$\n代入 $k = 2\\pi/\\lambda$：\n$$ \\Delta R = -\\frac{\\eta_0 (2\\pi/\\lambda)^2 \\ell^2}{3\\pi} = -\\frac{\\eta_0 (4\\pi^2/\\lambda^2) \\ell^2}{3\\pi} = -\\frac{4\\pi\\eta_0}{3} \\left(\\frac{\\ell}{\\lambda}\\right)^2 $$\n\n**数值计算**\n我们已知：\n$f = 300\\,\\mathrm{MHz} = 3 \\times 10^8\\,\\mathrm{Hz}$\n$\\ell = 0.05\\,\\mathrm{m}$\n$\\eta_0 = 120\\pi\\,\\Omega$\n真空中的光速为 $c \\approx 3 \\times 10^8\\,\\mathrm{m/s}$。\n波长为 $\\lambda = c/f = (3 \\times 10^8\\,\\mathrm{m/s}) / (3 \\times 10^8\\,\\mathrm{Hz}) = 1\\,\\mathrm{m}$。\n比率 $\\ell/\\lambda = 0.05/1 = 0.05$。\n\n现在，我们将这些值代入 $\\Delta R$ 的表达式中：\n$$ \\Delta R = -\\frac{4\\pi (120\\pi)}{3} (0.05)^2 = -160\\pi^2 (0.0025) = -0.4\\pi^2 $$\n使用计算器计算 $\\pi^2 \\approx 9.8696044$：\n$$ \\Delta R = -0.4 \\times 9.8696044 \\approx -3.94784176\\,\\Omega $$\n将结果四舍五入到四位有效数字，我们得到：\n$$ \\Delta R \\approx -3.948\\,\\Omega $$",
            "answer": "$$ \\boxed{-3.948} $$"
        },
        {
            "introduction": "在建立了使用相量的严格规则后，我们可以将其应用于一个经典的电磁学问题。波导分析是相量方法大放异彩的典型场景，它将复杂的含时麦克斯韦方程组转化为一个更易于处理的空间问题——一个本征值问题。本练习  将引导你从第一性原理出发，推导波导中的传播模式，展示几何形状和边界条件如何决定一组离散的传播解（本征模）及其相应的截止频率。",
            "id": "3356080",
            "problem": "考虑一个中空、笔直、横截面均匀的矩形金属波导，其沿 $z$ 轴放置。横截面占据矩形区域 $\\{(x,y)\\,:\\,0 \\le x \\le a,\\;0 \\le y \\le b\\}$，其中 $a$ 和 $b$ 是正常数。波导壁是理想电导体 (Perfect Electric Conductor, PEC)。波导内均匀填充着介电常数为 $\\epsilon$、磁导率为 $\\mu$ 的均匀、各向同性、无损耗介质。时间依赖性是时谐的，采用相量表示法 $\\exp(j \\omega t)$，其中 $j^2 = -1$ 且 $\\omega$ 是角频率。\n\n从频域无源 Maxwell 方程组和波导壁上的 PEC 边界条件 $\\,\\hat{\\mathbf{n}} \\times \\mathbf{E} = \\mathbf{0}\\,$ 出发，完成以下任务：\n\n- 为纵向标量场 $\\psi(x,y)$ 建立本征值问题。该标量场代表横磁 (TM) 模的纵向电场 $\\psi = E_{z}$ 或横电 (TE) 模的纵向磁场 $\\psi = H_{z}$。你的表述应明确作用于 $\\psi$ 的算子、本征值参数，以及分别在 TE 和 TM 情况下由 PEC 条件在矩形边界 $\\partial \\Omega$ 上导出的正确边界条件。\n\n- 通过分离变量法求解所得的矩形域上的二维本征值问题，以获得允许的本征对 $(\\psi_{mn}, \\lambda_{mn})$，并确定每种边界条件下允许的模式指数 $(m,n)$。从这些本征值推导出 TE 和 TM 模式的截止角频率。\n\n- 在截止频率以上，推导传播模式的轴向相移常数 $\\,\\beta(\\omega)\\,$。将其表示为关于 $\\,\\omega,\\mu,\\epsilon,a,b,m,n\\,$ 的单个闭式函数，该函数在相应模式指数被允许时对 TE 和 TM 模式均有效。\n\n答案规格：\n- 提供 TE 截止角频率、TM 截止角频率和截止频率以上的轴向相移常数的最终表达式。角频率以弧度/秒为单位，轴向相移常数以弧度/米为单位。\n- 最终答案必须是单个闭式解析表达式或由这类表达式组成的单行矩阵。不要在最终的方框答案中包含单位。无需四舍五入。",
            "solution": "所提出的问题是电磁理论中关于矩形金属波导中波传播的典型问题。该问题具有科学依据、提法恰当、客观且内部一致。所有必要的数据和条件均已提供。因此，该问题被认为是有效的，并将提供解答。\n\n我们从频域中的无源 Maxwell 方程组开始，假设时谐依赖关系为 $\\exp(j \\omega t)$：\n$$ \\nabla \\times \\mathbf{E} = -j \\omega \\mu \\mathbf{H} $$\n$$ \\nabla \\times \\mathbf{H} = j \\omega \\epsilon \\mathbf{E} $$\n在简单介质的无源区域中，这些方程导出电场和磁场的矢量 Helmholtz 方程：\n$$ \\nabla^2 \\mathbf{E} + k^2 \\mathbf{E} = \\mathbf{0} $$\n$$ \\nabla^2 \\mathbf{H} + k^2 \\mathbf{H} = \\mathbf{0} $$\n其中 $k^2 = \\omega^2 \\mu \\epsilon$ 是介质中波数的平方。\n\n对于沿 $z$ 轴传播的波，我们假设场的依赖形式为 $\\mathbf{F}(x,y,z) = \\mathbf{f}(x,y) \\exp(-j\\beta z)$，其中 $\\mathbf{F}$ 是 $\\mathbf{E}$ 或 $\\mathbf{H}$，$\\beta$ 是轴向相移常数。在这个假设下，微分算子 $\\frac{\\partial}{\\partial z}$ 可以被替换为 $-j\\beta$。拉普拉斯算子可以分离为 $\\nabla^2 = \\nabla_t^2 + \\frac{\\partial^2}{\\partial z^2} = \\nabla_t^2 - \\beta^2$，其中 $\\nabla_t^2 = \\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2}$ 是横向拉普拉斯算子。\n\n将此应用于 Helmholtz 方程的 $z$ 分量，我们得到纵向场分量 $E_z(x,y)$ 和 $H_z(x,y)$ 的二维 Helmholtz 方程：\n$$ \\nabla_t^2 E_z + (k^2 - \\beta^2) E_z = 0 $$\n$$ \\nabla_t^2 H_z + (k^2 - \\beta^2) H_z = 0 $$\n令 $\\psi(x,y)$ 代表 $E_z$ 或 $H_z$。令截止波数为 $k_c$，定义为 $k_c^2 = k^2 - \\beta^2 = \\omega^2\\mu\\epsilon - \\beta^2$。则 $\\psi$ 的控制方程为：\n$$ \\nabla_t^2 \\psi + k_c^2 \\psi = 0 $$\n\n这个方程可以表述为一个本征值问题。算子是负的横向拉普拉斯算子，$L = -\\nabla_t^2$。方程变为 $L\\psi = k_c^2 \\psi$。因此，本征函数 $\\psi$ 对应于横向平面中的模式结构，而本征值 $\\lambda = k_c^2$ 决定了这些模式的传播特性。\n\n$\\psi$ 的边界条件由波导壁上的理想电导体 (PEC) 条件 $\\hat{\\mathbf{n}} \\times \\mathbf{E} = \\mathbf{0}$ 导出。这意味着电场 $\\mathbf{E}$ 的切向分量在矩形 $\\{(x,y) \\,|\\, 0 \\le x \\le a, 0 \\le y \\le b\\}$ 的边界 $\\partial \\Omega$ 上必须为零。切向分量是 $E_z$ 和平行于壁的 $\\mathbf{E}_t = E_x \\hat{\\mathbf{x}} + E_y \\hat{\\mathbf{y}}$ 分量。\n\n横向场可以用纵向场表示：\n$$ \\mathbf{E}_t = \\frac{-j}{k_c^2} \\left( \\beta \\nabla_t E_z - \\omega\\mu (\\hat{\\mathbf{z}} \\times \\nabla_t H_z) \\right) $$\n$$ \\mathbf{H}_t = \\frac{-j}{k_c^2} \\left( \\beta \\nabla_t H_z + \\omega\\epsilon (\\hat{\\mathbf{z}} \\times \\nabla_t E_z) \\right) $$\n\n我们分析两种不同的情况：横磁 (TM) 模式和横电 (TE) 模式。\n\n**横磁 (TM) 模式**\n对于 TM 模式，根据定义 $H_z = 0$。纵向标量函数是 $\\psi = E_z$。\nPEC 边界条件要求在所有壁上 $E_z = 0$，因为 $E_z$ 与所有四个壁相切。这是一个 Dirichlet 边界条件。\nTM 模式的本征值问题是：\n- 算子：$L = -\\nabla_t^2 = -\\left(\\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial y^2}\\right)$\n- 本征值：$\\lambda = k_c^2$\n- 本征函数：$\\psi(x,y) = E_z(x,y)$\n- 区域：$\\Omega = [0,a]\\times[0,b]$\n- 边界条件：在 $\\partial\\Omega$ 上 $\\psi = 0$。\n\n**横电 (TE) 模式**\n对于 TE 模式，根据定义 $E_z = 0$。纵向标量函数是 $\\psi = H_z$。\n当 $E_z=0$ 时，横向电场简化为 $\\mathbf{E}_t = \\frac{j\\omega\\mu}{k_c^2} (\\hat{\\mathbf{z}} \\times \\nabla_t H_z) = \\frac{j\\omega\\mu}{k_c^2} \\left(\\frac{\\partial H_z}{\\partial x}\\hat{\\mathbf{y}} - \\frac{\\partial H_z}{\\partial y}\\hat{\\mathbf{x}}\\right)$。\nPEC 边界条件是：\n- 在壁 $x=0$ 和 $x=a$ 上：切向分量是 $E_y$。$E_y(0,y) = E_y(a,y) = 0 \\implies \\frac{\\partial H_z}{\\partial x}|_{x=0,a} = 0$。\n- 在壁 $y=0$ 和 $y=b$ 上：切向分量是 $E_x$。$E_x(x,0) = E_x(x,b) = 0 \\implies \\frac{\\partial H_z}{\\partial y}|_{y=0,b} = 0$。\n这等效于在 $\\partial\\Omega$ 上 $\\frac{\\partial \\psi}{\\partial n} = 0$，这是一个 Neumann 边界条件。\nTE 模式的本征值问题是：\n- 算子：$L = -\\nabla_t^2$\n- 本征值：$\\lambda = k_c^2$\n- 本征函数：$\\psi(x,y) = H_z(x,y)$\n- 区域：$\\Omega = [0,a]\\times[0,b]$\n- 边界条件：在 $\\partial\\Omega$ 上 $\\frac{\\partial \\psi}{\\partial n} = 0$。\n\n为求解本征值问题 $\\nabla_t^2 \\psi + k_c^2 \\psi = 0$，我们使用分离变量法，令 $\\psi(x,y) = X(x)Y(y)$。这会得到两个常微分方程：\n$$ X''(x) + k_x^2 X(x) = 0 $$\n$$ Y''(y) + k_y^2 Y(y) = 0 $$\n其中 $k_x^2 + k_y^2 = k_c^2$。通解是正弦形式的：\n$X(x) = A\\cos(k_x x) + B\\sin(k_x x)$\n$Y(y) = C\\cos(k_y y) + D\\sin(k_y y)$\n\n对于 **TM 模式** (Dirichlet 条件)：\n$\\psi(0,y)=0 \\implies X(0)=0 \\implies A=0$。\n$\\psi(a,y)=0 \\implies X(a)=0 \\implies \\sin(k_x a)=0 \\implies k_x = \\frac{m\\pi}{a}$，对于整数 $m$。\n$\\psi(x,0)=0 \\implies Y(0)=0 \\implies C=0$。\n$\\psi(x,b)=0 \\implies Y(b)=0 \\implies \\sin(k_y b)=0 \\implies k_y = \\frac{n\\pi}{b}$，对于整数 $n$。\n得到的本征函数为 $\\psi_{mn} \\propto \\sin(\\frac{m\\pi x}{a})\\sin(\\frac{n\\pi y}{b})$。为了得到非平凡场， $m$ 和 $n$ 都必须是正整数。\n所以，对于 TM 模式，$m \\in \\{1, 2, 3, ...\\}$ 且 $n \\in \\{1, 2, 3, ...\\}$。\n\n对于 **TE 模式** (Neumann 条件)：\n$\\frac{\\partial\\psi}{\\partial x}|_{x=0}=0 \\implies X'(0)=0 \\implies B=0$。\n$\\frac{\\partial\\psi}{\\partial x}|_{x=a}=0 \\implies X'(a)=0 \\implies \\sin(k_x a)=0 \\implies k_x = \\frac{m\\pi}{a}$，对于整数 $m$。\n$\\frac{\\partial\\psi}{\\partial y}|_{y=0}=0 \\implies Y'(0)=0 \\implies D=0$。\n$\\frac{\\partial\\psi}{\\partial y}|_{y=b}=0 \\implies Y'(b)=0 \\implies \\sin(k_y b)=0 \\implies k_y = \\frac{n\\pi}{b}$，对于整数 $n$。\n得到的本征函数为 $\\psi_{mn} \\propto \\cos(\\frac{m\\pi x}{a})\\cos(\\frac{n\\pi y}{b})$。\n如果 $m=0$ 且 $n=0$，$\\psi$ 是一个常数，导致 $\\mathbf{E}_t = \\mathbf{0}$ 和 $\\mathbf{H}_t = \\mathbf{0}$。这不是一个波模式，所以 $(m,n)=(0,0)$ 的情况被排除。然而，当 $m=0$ 或 $n=0$（但不是两者同时为零）时的模式是有效的。\n所以，对于 TE 模式，$m,n \\in \\{0, 1, 2, ...\\}$ 且 $(m,n) \\neq (0,0)$。\n\n两种情况下的本征值 $\\lambda_{mn} = k_{c,mn}^2$ 是相同的：\n$$ k_{c,mn}^2 = \\left(\\frac{m\\pi}{a}\\right)^2 + \\left(\\frac{n\\pi}{b}\\right)^2 $$\n**截止角频率** $\\omega_c$ 是 $\\beta=0$ 时的频率。从 $k_c^2 = \\omega^2\\mu\\epsilon - \\beta^2$，令 $\\beta=0$ 可得 $\\omega_c^2\\mu\\epsilon = k_c^2$。\n$$ \\omega_{c,mn} = \\frac{k_{c,mn}}{\\sqrt{\\mu\\epsilon}} = \\frac{1}{\\sqrt{\\mu\\epsilon}} \\sqrt{\\left(\\frac{m\\pi}{a}\\right)^2 + \\left(\\frac{n\\pi}{b}\\right)^2} = \\frac{\\pi}{\\sqrt{\\mu\\epsilon}} \\sqrt{\\left(\\frac{m}{a}\\right)^2 + \\left(\\frac{n}{b}\\right)^2} $$\n这个表达式对 TE 和 TM 模式都有效，只需遵循它们各自对整数指数 $(m,n)$ 的约束。\n\n对于一个模式 $(m,n)$，在角频率 $\\omega > \\omega_{c,mn}$ 时的**轴向相移常数** $\\beta$ 可以从色散关系 $\\beta^2 = \\omega^2\\mu\\epsilon - k_{c,mn}^2$ 中找到。\n取正根表示正向传播：\n$$ \\beta_{mn}(\\omega) = \\sqrt{\\omega^2\\mu\\epsilon - k_{c,mn}^2} $$\n代入 $k_{c,mn}^2$ 的表达式：\n$$ \\beta_{mn}(\\omega) = \\sqrt{\\omega^2\\mu\\epsilon - \\left(\\left(\\frac{m\\pi}{a}\\right)^2 + \\left(\\frac{n\\pi}{b}\\right)^2\\right)} $$\n这个单一表达式对 TE 和 TM 模式都有效，前提是指数 $(m,n)$ 对于相应的模式类型是允许的。\n\n最终要求的表达式是 TE 截止角频率、TM 截止角频率和轴向相移常数。",
            "answer": "$$ \\boxed{ \\begin{pmatrix} \\frac{\\pi}{\\sqrt{\\mu\\epsilon}} \\sqrt{\\left(\\frac{m}{a}\\right)^2 + \\left(\\frac{n}{b}\\right)^2} & \\frac{\\pi}{\\sqrt{\\mu\\epsilon}} \\sqrt{\\left(\\frac{m}{a}\\right)^2 + \\left(\\frac{n}{b}\\right)^2} & \\sqrt{\\omega^2\\mu\\epsilon - \\left(\\frac{m\\pi}{a}\\right)^2 - \\left(\\frac{n\\pi}{b}\\right)^2} \\end{pmatrix} } $$"
        },
        {
            "introduction": "在频域分析的基础上，我们可以将任意复杂的场分解为一系列简单平面波的叠加，每个平面波对应一个特定的空间频率。这种“角谱”方法是模拟波传播的一种强大计算工具。本练习  演示了如何实现该方法来模拟场在通过孔径后的传播，并关键性地探讨了倏逝波 (evanescent waves) 的作用——这些非传播分量携带了亚波长尺度的高分辨率信息，是实现超分辨率近场成像的关键。",
            "id": "3356119",
            "problem": "要求您实现一个时谐电磁场相量在亚波长双高斯孔径后的一维角谱传播，并量化倏逝分量的影响。假设场是标量且线性偏振，因此标量表示是有效的，并且介质是均匀、各向同性且无损耗的，折射率等于1。时间相关性是谐波的，角频率为 $\\,\\omega\\,$，并使用相量约定来抑制。推导必须从频域麦克斯韦方程组开始，导出标量亥姆霍兹方程和与辐射条件一致的平面波（角）谱表示。您不得假定任何预先引用的传播公式；而是通过第一性原理确定表示，然后使用离散傅里叶变换进行数值实现。\n\n在一个横向维度 $\\,x\\,$ 和纵向传播方向 $\\,z \\ge 0\\,$ 上实现以下数值实验：\n\n- 物理常数和单位：\n  - 使用光速 $\\,c = 2.99792458\\times 10^{8}\\,\\mathrm{m/s}\\,$。\n  - 所有长度必须以米为单位，空间频率以弧度每米为单位，频率以赫兹为单位。无需报告角度；所有内部计算均以弧度为单位。\n- 在 $\\,z=0\\,$ 处的孔径场：\n  - 入射标量相量场是一个对称的双高斯函数，\n    $$E(x,0) \\equiv E_0(x) = \\exp\\left(-\\frac{(x - d/2)^2}{2\\sigma^2}\\right) + \\exp\\left(-\\frac{(x + d/2)^2}{2\\sigma^2}\\right).$$\n  - 在提供的测试中，间距 $\\,d\\,$ 严格为亚波长。\n- 角谱传播任务：\n  - 从均匀介质的标量亥姆霍兹方程（波数为 $\\,k = 2\\pi/\\lambda\\,$）开始，推导出与辐射条件一致的唯一平面波谱表示，并用它将 $\\,E_0(x)\\,$ 传播到距离 $\\,z>0\\,$ 的观察平面，生成包含传播分量和倏逝分量的 $\\,E_{\\mathrm{full}}(x,z)\\,$。\n  - 通过抑制所有倏逝分量同时保留所有传播分量，构建一个截断谱近似 $\\,E_{\\mathrm{trunc}}(x,z)\\,$。\n- 离散化要求：\n  - 在宽度为 $\\,L_x = 20\\times 10^{-6}\\,\\mathrm{m}\\,$、以 $\\,x=0\\,$ 为中心的窗口上使用 $\\,N_x = 4096\\,$ 个样本的均匀网格。令 $\\,\\Delta x = L_x/N_x\\,$ 并采样 $\\,x_n = -L_x/2 + n\\,\\Delta x\\,$，其中 $\\,n=0,1,\\dots,N_x-1\\,$。\n  - 使用与 $\\,x\\,$ 和 $\\,k_x\\,$ 一致的离散傅里叶变换对，使得离散角谱乘子应用于相应的 $\\,k_x\\,$ 样本。确保复数平方根的选择强制场向外辐射，并且倏逝分量随着 $\\,z\\,$ 的增加而衰减。\n- 在观察平面上计算以进行定量比较的指标：\n  - 定义感兴趣区域 $\\,\\mathrm{ROI} = \\{x: |x|\\le 2\\times 10^{-6}\\,\\mathrm{m}\\}\\,$。以下所有指标必须仅在此区域内使用落在此区间内的离散样本计算。\n  - 截断重构和完整重构之间的归一化均方根误差 (NRMSE)：\n    $$\\mathrm{NRMSE}(z) = \\frac{\\left\\|E_{\\mathrm{full}}(\\cdot,z) - E_{\\mathrm{trunc}}(\\cdot,z)\\right\\|_{2,\\mathrm{ROI}}}{\\left\\|E_{\\mathrm{full}}(\\cdot,z)\\right\\|_{2,\\mathrm{ROI}}},$$\n    其中 $\\,\\|\\cdot\\|_{2,\\mathrm{ROI}}\\,$ 表示感兴趣区域内样本的离散 $\\,\\ell_2\\,$ 范数。\n  - 基于强度 $\\,I(x,z)=|E(x,z)|^2\\,$ 的分辨能力对比度指标：\n    - 令 $\\,I_{\\mathrm{left}}\\,$ 和 $\\,I_{\\mathrm{right}}\\,$ 分别为以 $\\,x=-d/2\\,$ 和 $\\,x=+d/2\\,$ 为中心的窗口中的最大强度，每个窗口的半宽为 $\\,\\max\\{3\\sigma,\\, d/2\\}\\,$，并与感兴趣区域相交。\n    - 令 $\\,I_{\\mathrm{valley}}\\,$ 为最接近 $\\,x=0\\,$ 的样本处的强度。\n    - 定义对比度 $\\,C(z) = 1 - \\dfrac{I_{\\mathrm{valley}}}{\\tfrac{1}{2}(I_{\\mathrm{left}}+I_{\\mathrm{right}})}\\,$，并裁剪到区间 $[0,1]$。\n    - 将由倏逝分量引起的对比度改善报告为 $\\,\\Delta C(z) = C_{\\mathrm{full}}(z) - C_{\\mathrm{trunc}}(z)\\,$。\n- 测试套件：\n  - 使用以下三个测试用例，每个用例由波长 $\\,\\lambda\\,$、间距 $\\,d\\,$、高斯宽度 $\\,\\sigma\\,$ 和传播距离 $\\,z\\,$ 指定：\n    1. 案例 A（深近场，亚波长特征）：$\\,\\lambda = 1.0\\times 10^{-6}\\,\\mathrm{m}\\,$，$\\,d = 0.4\\times 10^{-6}\\,\\mathrm{m}\\,$，$\\,\\sigma = 0.10\\times 10^{-6}\\,\\mathrm{m}\\,$，$\\,z = 0.10\\times 10^{-6}\\,\\mathrm{m}\\,$。\n    2. 案例 B（孔径平面边界）：$\\,\\lambda = 1.0\\times 10^{-6}\\,\\mathrm{m}\\,$，$\\,d = 0.4\\times 10^{-6}\\,\\mathrm{m}\\,$，$\\,\\sigma = 0.10\\times 10^{-6}\\,\\mathrm{m}\\,$，$\\,z = 0\\,\\mathrm{m}\\,$。\n    3. 案例 C（中等传播，多个波长）：$\\,\\lambda = 1.0\\times 10^{-6}\\,\\mathrm{m}\\,$，$\\,d = 0.4\\times 10^{-6}\\,\\mathrm{m}\\,$，$\\,\\sigma = 0.10\\times 10^{-6}\\,\\mathrm{m}\\,$，$\\,z = 5.0\\times 10^{-6}\\,\\mathrm{m}\\,$。\n- 程序输出规范：\n  - 对于每个测试用例，计算如上定义的 $\\,\\mathrm{NRMSE}(z)\\,$ 和 $\\,\\Delta C(z)\\,$。将每个值四舍五入到六位小数。\n  - 您的程序应生成一行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，顺序为\n    $$[\\mathrm{NRMSE}_A,\\,\\Delta C_A,\\,\\mathrm{NRMSE}_B,\\,\\Delta C_B,\\,\\mathrm{NRMSE}_C,\\,\\Delta C_C].$$\n\n所有计算必须以双精度进行。所有量均以上述单位表示，并确保在传播模型中满足辐射条件。您的算法必须是自包含的，且不要求用户输入。最终列表元素必须是按指定格式化的浮点数。",
            "solution": "用户提供了一个在计算电磁学领域中有效、适定且具有科学依据的问题。任务是模拟一个标量时谐场从亚波长双高斯孔径的一维传播，并量化倏逝波的作用。解决方案需要从第一性原理推导角谱传播算子，然后进行数值实现。\n\n### **1. 角谱传播算子的理论推导**\n\n在无源、均匀、各向同性且无损耗的介质中，时谐电磁场的传播由Maxwell方程组控制。假设时间相关性形式为 $e^{-i\\omega t}$，相量域中的旋度方程为：\n$$ \\nabla \\times \\mathbf{E} = i\\omega\\mu\\mathbf{H} $$\n$$ \\nabla \\times \\mathbf{H} = -i\\omega\\epsilon\\mathbf{E} $$\n其中 $\\mathbf{E}$ 和 $\\mathbf{H}$ 是复数电场和磁场相量，$\\omega$ 是角频率，$\\mu$ 和 $\\epsilon$ 分别是介质的磁导率和介电常数。\n\n对第一个方程取旋度，并代入第二个方程，得到：\n$$ \\nabla \\times (\\nabla \\times \\mathbf{E}) = i\\omega\\mu (\\nabla \\times \\mathbf{H}) = i\\omega\\mu (-i\\omega\\epsilon\\mathbf{E}) = \\omega^2\\mu\\epsilon\\mathbf{E} $$\n使用矢量恒等式 $\\nabla \\times (\\nabla \\times \\mathbf{E}) = \\nabla(\\nabla \\cdot \\mathbf{E}) - \\nabla^2 \\mathbf{E}$ 以及在均匀 $\\epsilon$ 的无源区域中 $\\nabla \\cdot \\mathbf{E} = 0$ 的事实，我们得到矢量亥姆霍兹方程：\n$$ \\nabla^2 \\mathbf{E} + k^2 \\mathbf{E} = 0 $$\n波数 $k$ 定义为 $k = \\omega\\sqrt{\\mu\\epsilon} = \\omega/v_p$。问题指定介质的折射率为1，因此相速度 $v_p$ 是真空中的光速 $c$。因此，$k = \\omega/c = 2\\pi/\\lambda$，其中 $\\lambda$ 是波长。\n\n问题指出，对于线性偏振场，标量表示 $E(x,z)$ 是有效的，其中 $x$ 是横向坐标， $z$ 是传播方向。$\\mathbf{E}$ 的每个笛卡尔分量都满足标量亥姆霍兹方程。对于这个二维问题（$x,z$），方程为：\n$$ \\left( \\frac{\\partial^2}{\\partial x^2} + \\frac{\\partial^2}{\\partial z^2} \\right) E(x,z) + k^2 E(x,z) = 0 $$\n\n为求解此偏微分方程，我们对横向坐标 $x$ 采用傅里叶变换。令 $\\tilde{E}(k_x, z)$ 为 $E(x,z)$ 的空间傅里叶变换，由以下变换对定义：\n$$ \\tilde{E}(k_x, z) = \\mathcal{F}_x\\{E(x,z)\\} = \\int_{-\\infty}^{\\infty} E(x,z) e^{-i k_x x} dx $$\n$$ E(x,z) = \\mathcal{F}_x^{-1}\\{\\tilde{E}(k_x, z)\\} = \\frac{1}{2\\pi} \\int_{-\\infty}^{\\infty} \\tilde{E}(k_x, z) e^{i k_x x} dk_x $$\n将傅里叶变换应用于亥姆霍兹方程，算子 $\\frac{\\partial^2}{\\partial x^2}$ 变为乘以 $(i k_x)^2 = -k_x^2$。这将偏微分方程转换为一个关于 $z$ 的常微分方程，对应于每个空间频率分量 $k_x$：\n$$ \\frac{d^2 \\tilde{E}(k_x, z)}{dz^2} - k_x^2 \\tilde{E}(k_x, z) + k^2 \\tilde{E}(k_x, z) = 0 $$\n$$ \\frac{d^2 \\tilde{E}(k_x, z)}{dz^2} + (k^2 - k_x^2) \\tilde{E}(k_x, z) = 0 $$\n让我们定义 $k_z^2 = k^2 - k_x^2$。这个二阶常微分方程的通解是：\n$$ \\tilde{E}(k_x, z) = A(k_x) e^{i k_z z} + B(k_x) e^{-i k_z z} $$\n系数 $A(k_x)$ 和 $B(k_x)$ 由边界条件确定。场在孔径平面 $z=0$ 处是已知的，所以 $\\tilde{E}(k_x, 0) = \\mathcal{F}_x\\{E(x,0)\\}$。辐射条件要求对于 $z>0$，场必须由从 $z=0$ 处的源传播开或衰减开的波组成。前向传播波的时间相关形式为 $e^{i(k_z z - \\omega t)}$，对应于相量项 $e^{i k_z z}$。项 $e^{-i k_z z}$ 表示一个向 $z=0$ 传播的波，这是不符合物理规律的。因此，我们必须设置 $B(k_x) = 0$。\n\n这剩下 $\\tilde{E}(k_x, z) = A(k_x) e^{i k_z z}$。在 $z=0$ 处，我们有 $\\tilde{E}(k_x, 0) = A(k_x)$，因此传播后的角谱解为：\n$$ \\tilde{E}(k_x, z) = \\tilde{E}(k_x, 0) e^{i k_z z} $$\n其中传播算子取决于 $k_z = \\sqrt{k^2 - k_x^2}$。然后通过傅里叶逆变换找到空间域中的场：\n$$ E(x,z) = \\mathcal{F}_x^{-1}\\left\\{ \\mathcal{F}_x\\{E(x,0)\\} \\cdot e^{i z \\sqrt{k^2 - k_x^2}} \\right\\} $$\n项 $\\sqrt{k^2 - k_x^2}$ 的性质决定了波分量的类型：\n1.  **传播分量**：对于 $|k_x| \\le k$，$k_z$ 是实数且为正。项 $e^{i k_z z}$ 是一个纯相位因子，表示一个相对于 $z$ 轴成一定角度传播的平面波。\n2.  **倏逝分量**：对于 $|k_x| > k$，$k_z^2$ 是负数，所以 $k_z$ 是纯虚数。为了满足辐射条件（在 $z>0$ 时衰减），我们必须选择具有非负虚部的根：$k_z = i\\sqrt{k_x^2 - k^2}$。传播算子变为 $e^{i(i\\sqrt{k_x^2 - k^2})z} = e^{-z\\sqrt{k_x^2 - k^2}}$。该项表示一个随距离 $z$ 指数衰减的非传播波。这些倏逝波携带了关于源的高分辨率（亚波长）信息，这些信息在几个波长的传播距离后就会丢失。\n\n### **2. 数值实现策略**\n\n连续傅里叶变换被离散傅里叶变换 (DFT) 所取代，后者通过快速傅里叶变换 (FFT) 算法高效计算。\n\n1.  **离散化**：连续横向坐标 $x$ 在一个有 $N_x$ 个点、间距为 $\\Delta x = L_x/N_x$ 的均匀网格上采样。相应的 $k_x$ 空间频率网格由 DFT 的性质确定。\n2.  **算法**：\n    a.  在离散空间网格上定义初始场 $E_0(x) = E(x,0)$。\n    b.  使用 FFT 计算其角谱 $\\tilde{E}_0(k_x) = \\mathcal{F}_x\\{E_0(x)\\}$。\n    c.  构建传播传递函数 $H(k_x, z) = e^{i z k_z}$。\n    d.  对每个离散的 $k_x$ 值计算 $k_z = \\sqrt{k^2 - k_x^2}$。必须使用复数平方根来正确处理传播（$k^2 > k_x^2$）和倏逝（$k^2  k_x^2$）两种情况，确保 $\\mathrm{Im}(k_z) \\ge 0$。\n    e.  完整的传播谱为 $\\tilde{E}_{\\mathrm{full}}(k_x, z) = \\tilde{E}_0(k_x) \\cdot H(k_x, z)$。\n    f.  截断谱 $\\tilde{E}_{\\mathrm{trunc}}(k_x, z)$ 是通过将所有倏逝分量的传播算子设置为零来获得的：\n        $$ H_{\\mathrm{trunc}}(k_x, z) = \\begin{cases} e^{i z k_z}  \\text{若 } k_x^2 \\le k^2 \\\\ 0  \\text{若 } k_x^2 > k^2 \\end{cases} $$\n    g.  空间场 $E_{\\mathrm{full}}(x,z)$ 和 $E_{\\mathrm{trunc}}(x,z)$ 通过对其各自的谱应用逆 FFT 来恢复。\n3.  **指标计算**：\n    a.  **NRMSE**：归一化均方根误差在感兴趣区域（ROI），即 $|x| \\le 2\\times 10^{-6}\\,\\mathrm{m}$ 内的离散样本上计算。它衡量了倏逝分量对该区域总场能量的相对贡献。\n    b.  **对比度改善 $\\Delta C$**：对比度指标 $C(z)$ 量化了分辨两个高斯峰的能力。倏逝波对应于高空间频率，对于分辨精细特征至关重要。通过比较全场对比度 ($C_{\\mathrm{full}}$) 与截断场对比度 ($C_{\\mathrm{trunc}}$)，我们可以量化由这些近场分量带来的分辨率提升。差值 $\\Delta C = C_{\\mathrm{full}} - C_{\\mathrm{trunc}}$ 按规定计算。\n\n对每个提供的测试用例，实现将遵循这些步骤。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Implements a one-dimensional angular spectrum propagation of a time-harmonic\n    electromagnetic field, computes specified metrics, and prints the results.\n    \"\"\"\n\n    # Physical constants\n    c = 2.99792458e8  # Speed of light in m/s\n\n    # Discretization parameters\n    Nx = 4096\n    Lx = 20e-6  # m\n\n    # Spatial grid\n    dx = Lx / Nx\n    x = np.linspace(-Lx / 2, Lx / 2 - dx, Nx)\n\n    # Spatial frequency grid\n    kx = 2 * np.pi * np.fft.fftfreq(Nx, d=dx)\n\n    # Region of Interest (ROI)\n    roi_boundary = 2e-6\n    roi_mask = np.abs(x) <= roi_boundary\n\n    def calculate_contrast(E, x_grid, d, sigma, roi_mask_):\n        \"\"\"\n        Calculates the resolving-power contrast metric C(z).\n        \"\"\"\n        I = np.abs(E)**2\n        \n        # Find intensity at the valley (center)\n        idx_zero = np.argmin(np.abs(x_grid))\n        I_valley = I[idx_zero]\n\n        # Define peak search windows\n        w = max(3 * sigma, d / 2)\n        \n        # Left peak search window\n        left_peak_window_mask = (x_grid >= -d/2 - w) & (x_grid <= -d/2 + w) & roi_mask_\n        \n        # Right peak search window\n        right_peak_window_mask = (x_grid >= d/2 - w) & (x_grid <= d/2 + w) & roi_mask_\n\n        I_left = np.max(I[left_peak_window_mask]) if np.any(left_peak_window_mask) else 0.0\n        I_right = np.max(I[right_peak_window_mask]) if np.any(right_peak_window_mask) else 0.0\n        \n        I_peaks_avg = 0.5 * (I_left + I_right)\n\n        if I_peaks_avg == 0:\n            return 0.0\n        \n        contrast_raw = 1 - I_valley / I_peaks_avg\n        contrast = np.clip(contrast_raw, 0, 1)\n        \n        return contrast\n\n    test_cases = [\n        # Case A: deep near-field, subwavelength features\n        {'lambda_': 1.0e-6, 'd': 0.4e-6, 'sigma': 0.10e-6, 'z': 0.10e-6},\n        # Case B: aperture plane boundary\n        {'lambda_': 1.0e-6, 'd': 0.4e-6, 'sigma': 0.10e-6, 'z': 0.0},\n        # Case C: moderate propagation, many wavelengths\n        {'lambda_': 1.0e-6, 'd': 0.4e-6, 'sigma': 0.10e-6, 'z': 5.0e-6},\n    ]\n\n    results = []\n\n    for case in test_cases:\n        lambda_ = case['lambda_']\n        d = case['d']\n        sigma = case['sigma']\n        z = case['z']\n\n        # Wavenumber\n        k = 2 * np.pi / lambda_\n\n        # 1. Define initial field at z=0\n        E0 = np.exp(-(x - d/2)**2 / (2 * sigma**2)) + \\\n             np.exp(-(x + d/2)**2 / (2 * sigma**2))\n\n        # 2. Compute angular spectrum via FFT\n        E0_tilde = np.fft.fft(E0)\n\n        # 3. Construct propagator\n        # kz must have Im(kz) >= 0 to ensure decay for z > 0\n        kz_sq = k**2 - kx**2\n        kz = np.sqrt(kz_sq.astype(np.complex128))\n\n        # Full propagator (propagating + evanescent)\n        propagator_full = np.exp(1j * kz * z)\n        \n        # Truncated propagator (propagating only)\n        propagating_mask = kx**2 <= k**2\n        propagator_trunc = np.zeros_like(propagator_full)\n        propagator_trunc[propagating_mask] = propagator_full[propagating_mask]\n        \n        # 4. Propagate in spectral domain\n        E_full_tilde = E0_tilde * propagator_full\n        E_trunc_tilde = E0_tilde * propagator_trunc\n\n        # 5. Transform back to spatial domain via IFFT\n        E_full = np.fft.ifft(E_full_tilde)\n        E_trunc = np.fft.ifft(E_trunc_tilde)\n\n        # 6. Compute metrics\n        \n        # NRMSE\n        E_full_roi = E_full[roi_mask]\n        E_trunc_roi = E_trunc[roi_mask]\n        \n        norm_full_roi = np.linalg.norm(E_full_roi)\n        norm_diff_roi = np.linalg.norm(E_full_roi - E_trunc_roi)\n\n        nrmse = norm_diff_roi / norm_full_roi if norm_full_roi > 0 else 0.0\n        \n        # Contrast Improvement\n        C_full = calculate_contrast(E_full, x, d, sigma, roi_mask)\n        C_trunc = calculate_contrast(E_trunc, x, d, sigma, roi_mask)\n        delta_C = C_full - C_trunc\n        \n        results.extend([nrmse, delta_C])\n\n    # Format output as specified\n    formatted_results = [f\"{val:.6f}\" for val in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}