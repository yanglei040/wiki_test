{
    "hands_on_practices": [
        {
            "introduction": "A cornerstone of agent-based modeling is understanding the connection between microscopic agent rules and macroscopic continuum descriptions. This practice solidifies this concept by formalizing the implementation of common boundary conditions—absorbing, reflecting, and periodic—at both the agent and continuum levels. By subsequently calculating the mean exit time for a diffusing cell, you will apply the theory of stochastic processes to derive a key observable property, bridging the gap between individual particle paths and predictable population-level behavior .",
            "id": "3287941",
            "problem": "Consider an agent-based model (ABM) of non-interacting cells undergoing unbiased Brownian motion with diffusion coefficient $D$ within a rectangular domain $\\Omega = (0,L_{x}) \\times (0,L_{y})$. In discrete time with time step $\\Delta t$, a single cell at position $\\mathbf{X}(t) \\in \\Omega$ proposes an unconstrained Euler–Maruyama update $\\mathbf{X}^{\\ast}(t+\\Delta t) = \\mathbf{X}(t) + \\sqrt{2D\\,\\Delta t}\\,\\boldsymbol{\\xi}$, where $\\boldsymbol{\\xi} \\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{I}_{2})$. The physical boundary $\\partial \\Omega$ imposes a boundary-handling rule that maps $\\mathbf{X}^{\\ast}(t+\\Delta t)$ to the realized $\\mathbf{X}(t+\\Delta t)$ or terminates the agent, depending on the boundary type. In the hydrodynamic limit $\\Delta t \\to 0$ with $D$ fixed, the one-cell probability density $p(\\mathbf{x},t)$ for the agent’s position evolves by the diffusion equation with Fickian flux.\n\nTask A (formal specification): Give precise, mechanistically implementable ABM boundary-handling rules at $\\partial \\Omega$ for each of the following three boundary types, and state their corresponding continuum boundary conditions for the probability density $p(\\mathbf{x},t)$ and flux $\\mathbf{J}(\\mathbf{x},t)$:\n- Absorbing boundary.\n- Reflecting (specular) boundary.\n- Periodic boundary.\n\nYour ABM rules must be well-defined for any component of $\\mathbf{X}^{\\ast}(t+\\Delta t)$ that exits $\\Omega$, and your continuum statement must be given in terms of $p(\\mathbf{x},t)$, the unit outward normal $\\mathbf{n}(\\mathbf{x})$ on $\\partial \\Omega$, and the diffusive flux $\\mathbf{J}(\\mathbf{x},t) = -D \\nabla p(\\mathbf{x},t)$.\n\nTask B (mean exit time calculation): Specialize to one spatial dimension with domain $[0,L]$ for some fixed $L>0$. Impose an absorbing boundary at $x=0$ and a reflecting boundary at $x=L$. A single cell starts at position $x \\in (0,L)$ and moves as an unbiased Brownian motion with diffusion coefficient $D$. Using a valid first-principles derivation based on the infinitesimal generator or a first-step argument in the $\\Delta t \\to 0$ limit, derive and compute the mean time $T(x)$ to absorption at $x=0$. Provide your final answer as a single closed-form analytic expression in terms of $x$, $L$, and $D$. No numerical evaluation or rounding is required. Do not report intermediate steps or boundary-condition statements in your final answer; only report the expression for $T(x)$.",
            "solution": "The problem statement has been validated and is deemed sound. It is scientifically grounded in the principles of stochastic processes and diffusion theory, well-posed with sufficient and consistent information, and formulated with objective, precise language. All provided givens are standard in the field of computational systems biology and mathematical physics. The problem is a valid test of understanding of the relationship between microscopic agent-based rules and macroscopic continuum descriptions, as well as the calculation of mean first passage times.\n\n**Task A: Boundary-Handling Rules and Continuum Conditions**\n\nThe problem concerns an agent-based model (ABM) where a cell's position $\\mathbf{X}(t)$ is updated via $\\mathbf{X}^{\\ast}(t+\\Delta t) = \\mathbf{X}(t) + \\sqrt{2D\\,\\Delta t}\\,\\boldsymbol{\\xi}$, where $\\boldsymbol{\\xi}$ is a random vector from a standard bivariate normal distribution. The domain is $\\Omega = (0, L_{x}) \\times (0, L_{y})$. If the proposed position $\\mathbf{X}^{\\ast}$ falls outside $\\Omega$, a rule is applied to determine the final position $\\mathbf{X}(t+\\Delta t)$. In the continuum limit, the probability density $p(\\mathbf{x}, t)$ obeys the diffusion equation $\\frac{\\partial p}{\\partial t} = D \\nabla^2 p$, and the diffusive flux is $\\mathbf{J}(\\mathbf{x}, t) = -D \\nabla p(\\mathbf{x}, t)$. The unit outward normal vector on the boundary $\\partial \\Omega$ is denoted by $\\mathbf{n}(\\mathbf{x})$.\n\nThe rules and corresponding continuum conditions for the three specified boundary types are as follows.\n\n**Absorbing Boundary**\n\nAn absorbing boundary acts as a \"sink,\" where agents are removed from the simulation upon contact.\n\n*   **ABM Rule:** Let the proposed position be $\\mathbf{X}^{\\ast}(t+\\Delta t)$. If $\\mathbf{X}^{\\ast}(t+\\Delta t) \\notin \\Omega$, the agent is terminated and removed from the simulation. Its trajectory ends at the time of crossing the boundary.\n*   **Continuum Condition:** Since any agent reaching the boundary is instantly removed, the probability of finding an agent at any point on the boundary must be zero at all times. This is a Dirichlet boundary condition.\n    $$p(\\mathbf{x}, t) = 0, \\quad \\forall \\mathbf{x} \\in \\partial \\Omega$$\n    This condition implies a non-zero flux $\\mathbf{J}(\\mathbf{x},t)$ directed out of the domain, representing the rate of absorption.\n\n**Reflecting (Specular) Boundary**\n\nA reflecting boundary acts as an impenetrable barrier that causes agents to \"bounce\" off. No agents can cross this boundary.\n\n*   **ABM Rule:** Let the proposed position be $\\mathbf{X}^{\\ast}(t+\\Delta t) = (X^{\\ast}, Y^{\\ast})$. If a component of this vector lies outside its corresponding interval (e.g., $X^{\\ast} < 0$), that component is reflected back into the domain. The reflection rule is applied independently to each coordinate that exits the domain.\n    *   If $X^{\\ast} < 0$, the new x-coordinate is $X(t+\\Delta t) = -X^{\\ast}$.\n    *   If $X^{\\ast} > L_x$, the new x-coordinate is $X(t+\\Delta t) = L_x - (X^{\\ast} - L_x) = 2L_x - X^{\\ast}$.\n    *   If $Y^{\\ast} < 0$, the new y-coordinate is $Y(t+\\Delta t) = -Y^{\\ast}$.\n    *   If $Y^{\\ast} > L_y$, the new y-coordinate is $Y(t+\\Delta t) = L_y - (Y^{\\ast} - L_y) = 2L_y - Y^{\\ast}$.\n    If both coordinates exit, both rules are applied. The final position $\\mathbf{X}(t+\\Delta t)$ is guaranteed to be in $\\Omega$.\n*   **Continuum Condition:** Since no agents can pass through the boundary, the net flux of probability density normal to the boundary must be zero. This is a Neumann boundary condition.\n    $$\\mathbf{J}(\\mathbf{x}, t) \\cdot \\mathbf{n}(\\mathbf{x}) = 0, \\quad \\forall \\mathbf{x} \\in \\partial \\Omega$$\n    Using the definition of the flux, this is equivalent to stating that the normal derivative of the probability density is zero at the boundary: $\\nabla p(\\mathbf{x}, t) \\cdot \\mathbf{n}(\\mathbf{x}) = 0$.\n\n**Periodic Boundary**\n\nPeriodic boundaries model a system that is topologically equivalent to a torus. An agent exiting one side of the domain instantaneously re-enters on the opposite side.\n\n*   **ABM Rule:** Let the proposed position be $\\mathbf{X}^{\\ast}(t+\\Delta t) = (X^{\\ast}, Y^{\\ast})$. The final position coordinates are mapped back into the domain using modular arithmetic.\n    *   The new x-coordinate is $X(t+\\Delta t) = X^{\\ast} \\pmod{L_x}$. This is implemented as: if $X^{\\ast} < 0$, set $X(t+\\Delta t) = X^{\\ast} + L_x$; if $X^{\\ast} > L_x$, set $X(t+\\Delta t) = X^{\\ast} - L_x$.\n    *   The new y-coordinate is $Y(t+\\Delta t) = Y^{\\ast} \\pmod{L_y}$. This is implemented as: if $Y^{\\ast} < 0$, set $Y(t+\\Delta t) = Y^{\\ast} + L_y$; if $Y^{\\ast} > L_y$, set $Y(t+\\Delta t) = Y^{\\ast} - L_y$.\n*   **Continuum Condition:** The probability density and the flux must be continuous across opposite boundaries. For any pair of corresponding points on opposite faces of the rectangular domain (e.g., $\\mathbf{x}_1 = (0, y)$ and $\\mathbf{x}_2 = (L_x, y)$), the probability densities and fluxes must match.\n    *   $p(0, y, t) = p(L_x, y, t)$\n    *   $p(x, 0, t) = p(x, L_y, t)$\n    And for the flux:\n    *   $\\mathbf{J}(0, y, t) = \\mathbf{J}(L_x, y, t)$\n    *   $\\mathbf{J}(x, 0, t) = \\mathbf{J}(x, L_y, t)$\n    The condition on the flux is equivalent to matching the gradient of the density, $\\nabla p$, on opposite faces.\n\n**Task B: Mean Exit Time Calculation**\n\nWe are tasked with finding the mean time $T(x)$ for a particle starting at $x \\in (0,L)$ to be absorbed at the boundary $x=0$. The domain is $[0,L]$, with an absorbing boundary at $x=0$ and a reflecting boundary at $x=L$. The particle undergoes Brownian motion with diffusion coefficient $D$.\n\nLet $T(x)$ be the mean first passage time to $0$, starting from $x$. The function $T(x)$ satisfies the backward Fokker-Planck equation, which for this problem is given by:\n$$\\mathcal{A} T(x) = -1$$\nwhere $\\mathcal{A}$ is the infinitesimal generator of the stochastic process. For one-dimensional Brownian motion with diffusion coefficient $D$, the generator is $\\mathcal{A} = D \\frac{d^2}{dx^2}$.\n\nSubstituting the generator into the equation gives the governing ordinary differential equation (ODE) for $T(x)$:\n$$D \\frac{d^2 T}{dx^2} = -1$$\nThis can be written as:\n$$\\frac{d^2 T}{dx^2} = -\\frac{1}{D}$$\nWe solve this ODE by integrating twice with respect to $x$:\n$$\\frac{dT}{dx} = -\\frac{x}{D} + C_1$$\n$$T(x) = -\\frac{x^2}{2D} + C_1 x + C_2$$\nwhere $C_1$ and $C_2$ are integration constants determined by the boundary conditions.\n\nThe boundary conditions for the mean exit time $T(x)$ are derived from the physical nature of the boundaries on the original process:\n\n1.  **Absorbing boundary at $x=0$**: If the particle starts at the absorbing boundary, it is absorbed immediately. Therefore, the time to absorption is zero.\n    $$T(0) = 0$$\n2.  **Reflecting boundary at $x=L$**: At a reflecting boundary, there is no net flux of particles. For the mean exit time problem, this translates to a zero-gradient condition. This can be understood by considering that a particle at $L-\\epsilon$ has its possible future paths mirrored by a virtual particle at $L+\\epsilon$, making $T(x)$ locally symmetric around $x=L$.\n    $$\\left. \\frac{dT}{dx} \\right|_{x=L} = 0$$\n\nNow, we apply these conditions to find $C_1$ and $C_2$.\n\nApplying the first condition, $T(0)=0$:\n$$T(0) = -\\frac{0^2}{2D} + C_1(0) + C_2 = 0 \\implies C_2 = 0$$\nThe solution simplifies to $T(x) = -\\frac{x^2}{2D} + C_1 x$.\n\nNext, we apply the second condition, $T'(L)=0$, to the first derivative $T'(x) = -\\frac{x}{D} + C_1$:\n$$\\left. \\frac{dT}{dx} \\right|_{x=L} = -\\frac{L}{D} + C_1 = 0 \\implies C_1 = \\frac{L}{D}$$\n\nSubstituting the determined constant $C_1$ back into the expression for $T(x)$:\n$$T(x) = -\\frac{x^2}{2D} + \\frac{L}{D}x$$\nThis is the closed-form analytic expression for the mean time to absorption. It can be factored for clarity:\n$$T(x) = \\frac{2Lx - x^2}{2D} = \\frac{x(2L - x)}{2D}$$\nThis is the final expression for the mean exit time as a function of the starting position $x$.",
            "answer": "$$ \\boxed{\\frac{x(2L - x)}{2D}} $$"
        },
        {
            "introduction": "Beyond spatial dynamics, realistic agent-based models must accurately capture the internal state transitions of agents, such as receptor binding. This hands-on coding exercise explores the principle of detailed balance, which links kinetic rates to thermodynamic free energies. By simulating a system both with and without this constraint, you will directly demonstrate how enforcing thermodynamic consistency ensures that your model's steady-state behavior correctly reproduces the fundamental Boltzmann distribution, a vital step in building physically grounded models .",
            "id": "3288015",
            "problem": "You are to implement an agent-based simulation for a population of independent cellular agents (for example, receptors) that each undergo stochastic binding and unbinding to an implicit ligand reservoir. Each agent is a two-state continuous-time Markov process with states \"unbound\" and \"bound.\" Let $k_\\text{on}$ denote the transition rate from unbound to bound and $k_\\text{off}$ denote the transition rate from bound to unbound. The fundamental base to use includes the Markovian Master equation for two-state systems, the principle of detailed balance for thermodynamic consistency, and the Boltzmann distribution of microstate probabilities. The dimensionless binding free energy difference is defined as $\\Delta g = \\Delta G/(k_B T)$, where $k_B$ is the Boltzmann constant and $T$ is absolute temperature; in this problem all energies are expressed in units of $k_B T$, so $\\Delta g$ is dimensionless and no physical energy units are required. Time is in arbitrary units, and rates $k_\\text{on}$, $k_\\text{off}$ have units of inverse time consistent with those arbitrary units.\n\nStarting from first principles, derive the long-time distribution of the bound state for a single agent as a function of $k_\\text{on}$ and $k_\\text{off}$. Then, using the condition for detailed balance $k_\\text{on}/k_\\text{off} = \\exp(-\\Delta g)$, show how thermodynamic consistency constrains the long-time bound fraction to agree with the Boltzmann distribution over the two states. Separately, consider a scenario where detailed balance is violated by setting $k_\\text{on}$ and $k_\\text{off}$ independently of $\\Delta g$; determine the resulting long-time bound fraction and explain how and why it deviates from the Boltzmann prediction.\n\nYour program must:\n- Simulate a heterogeneous population of agents partitioned into groups, where each group is characterized by its own $\\Delta g$ and number of agents.\n- For each group, assume all agents start in the unbound state at time $t=0$. Using your derived solution to the Master equation, compute the bound-state probability at a specified large time $T$ under two scenarios:\n  1. Thermodynamically consistent (detailed balance enforced): choose $k_\\text{on}$ and $k_\\text{off}$ such that $k_\\text{on}/k_\\text{off} = \\exp(-\\Delta g)$.\n  2. Thermodynamically inconsistent (detailed balance violated): choose $k_\\text{on}$ and $k_\\text{off}$ independent of $\\Delta g$.\n- For each scenario and each group, sample the number of bound agents at time $T$ as independent Bernoulli trials with the computed bound probability, report the empirical bound fraction, and compare it to the Boltzmann prediction $\\exp(-\\Delta g)/(1+\\exp(-\\Delta g))$.\n- Quantify the discrepancy per test case as the mean absolute difference between empirical bound fractions and the Boltzmann prediction across all groups in that test case.\n- For each test case, produce a boolean result that is true if the discrepancy under detailed balance enforcement is less than or equal to the discrepancy under detailed balance violation within a tolerance $\\epsilon$.\n\nUse a fixed random seed for reproducibility. All energies are dimensionless multiples of $k_B T$, time is in arbitrary units, and rates are in inverse time of those units. Do not use any external inputs. Implement the computation and sampling precisely as specified.\n\nTest suite:\n- Case A (heterogeneity, \"happy path\"): $\\Delta g$ values $[0, 2, 6]$, group sizes $[5000, 3000, 2000]$, baseline rate $k_0 = 5$ (inverse time), total time $T = 5$, tolerance $\\epsilon = 0.02$, random seed $42$.\n- Case B (boundary condition): $\\Delta g$ values $[0]$, group sizes $[10000]$, baseline rate $k_0 = 3$, total time $T = 5$, tolerance $\\epsilon = 0.02$, random seed $43$.\n- Case C (extreme heterogeneity): $\\Delta g$ values $[-4, 2]$, group sizes $[8000, 2000]$, baseline rate $k_0 = 1$, total time $T = 2$, tolerance $\\epsilon = 0.02$, random seed $44$.\n\nImplementation details:\n- In the thermodynamically consistent scenario, you must choose $k_\\text{on}$ and $k_\\text{off}$ such that $k_\\text{on}/k_\\text{off} = \\exp(-\\Delta g)$ for each group; you may select a common timescale via $k_0$ to set one of the rates (for example, $k_\\text{off} = k_0$ and $k_\\text{on} = k_0 \\exp(-\\Delta g)$).\n- In the thermodynamically inconsistent scenario, set $k_\\text{on} = k_0$ and $k_\\text{off} = k_0$ for all groups (i.e., independent of $\\Delta g$).\n- Use your derived time-dependent solution for the two-state Master equation to compute the bound probability at time $T$ from the initial condition.\n\nFinal output format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[True,False,True]\"). The list must contain exactly three boolean values corresponding to Cases A, B, and C, in that order.",
            "solution": "The problem is valid as it is scientifically grounded in the principles of statistical mechanics and chemical kinetics, is well-posed with a clear objective and sufficient information, and uses objective, formal language. It represents a standard exercise in computational systems biology.\n\nWe begin by deriving the necessary theoretical results from first principles as stipulated.\n\nLet the two states of a cellular agent be \"unbound\" ($U$) and \"bound\" ($B$). The system is a continuous-time Markov process governed by the transition rates $k_\\text{on}$ (for $U \\to B$) and $k_\\text{off}$ (for $B \\to U$). Let $P_U(t)$ and $P_B(t)$ be the probabilities of finding the agent in the unbound and bound states at time $t$, respectively. The conservation of probability requires $P_U(t) + P_B(t) = 1$ for all $t$.\n\nThe evolution of the probability of the bound state, $P_B(t)$, is described by the Master equation:\n$$\n\\frac{dP_B(t)}{dt} = (\\text{rate of flux into } B) - (\\text{rate of flux out of } B)\n$$\n$$\n\\frac{dP_B(t)}{dt} = k_\\text{on} P_U(t) - k_\\text{off} P_B(t)\n$$\nSubstituting $P_U(t) = 1 - P_B(t)$ into the equation gives a closed-form ordinary differential equation for $P_B(t)$:\n$$\n\\frac{dP_B(t)}{dt} = k_\\text{on} (1 - P_B(t)) - k_\\text{off} P_B(t)\n$$\n$$\n\\frac{dP_B(t)}{dt} = k_\\text{on} - (k_\\text{on} + k_\\text{off}) P_B(t)\n$$\nThis is a first-order linear inhomogeneous differential equation. The long-time distribution, or steady-state probability $P_{B,ss}$, is found by setting the time derivative to zero, $\\frac{dP_B}{dt} = 0$:\n$$\n0 = k_\\text{on} - (k_\\text{on} + k_\\text{off}) P_{B,ss}\n$$\nSolving for $P_{B,ss}$ yields the long-time bound fraction:\n$$\nP_{B,ss} = \\frac{k_\\text{on}}{k_\\text{on} + k_\\text{off}}\n$$\nTo solve the time-dependent equation with the initial condition that all agents are unbound at $t=0$, i.e., $P_B(0) = 0$, we can rearrange the ODE as:\n$$\n\\frac{dP_B}{k_\\text{on} - (k_\\text{on} + k_\\text{off}) P_B} = dt\n$$\nIntegrating both sides from $t'=0$ to $t'=t$ and from $P_B=0$ to $P_B=P_B(t)$:\n$$\n\\int_{0}^{P_B(t)} \\frac{dP'_B}{k_\\text{on} - (k_\\text{on} + k_\\text{off}) P'_B} = \\int_{0}^{t} dt'\n$$\n$$\n\\left[ -\\frac{1}{k_\\text{on} + k_\\text{off}} \\ln(k_\\text{on} - (k_\\text{on} + k_\\text{off}) P'_B) \\right]_0^{P_B(t)} = t\n$$\n$$\n\\ln\\left(\\frac{k_\\text{on} - (k_\\text{on} + k_\\text{off}) P_B(t)}{k_\\text{on}}\\right) = -(k_\\text{on} + k_\\text{off})t\n$$\n$$\n1 - \\frac{k_\\text{on} + k_\\text{off}}{k_\\text{on}} P_B(t) = e^{-(k_\\text{on} + k_\\text{off})t}\n$$\nSolving for $P_B(t)$ gives the full time-dependent solution:\n$$\nP_B(t) = \\frac{k_\\text{on}}{k_\\text{on} + k_\\text{off}} \\left( 1 - e^{-(k_\\text{on} + k_\\text{off})t} \\right)\n$$\nThis is the equation we will use to compute the bound probability at a finite time $T$.\n\nNext, we examine the system under the constraint of thermodynamic consistency, which is enforced by the principle of detailed balance. At thermodynamic equilibrium, the ratio of forward and backward rates is related to the dimensionless free energy difference $\\Delta g = (G_B - G_U)/(k_B T)$ between the states:\n$$\n\\frac{k_\\text{on}}{k_\\text{off}} = e^{-\\Delta g}\n$$\nSubstituting this into the steady-state probability $P_{B,ss}$:\n$$\nP_{B,ss} = \\frac{k_\\text{on}}{k_\\text{on} + k_\\text{off}} = \\frac{k_\\text{on}/k_\\text{off}}{k_\\text{on}/k_\\text{off} + 1} = \\frac{e^{-\\Delta g}}{1 + e^{-\\Delta g}}\n$$\nThis is precisely the Boltzmann probability for the bound state, given a two-state system where the unbound state has energy $0$ and the bound state has energy $\\Delta g$ (in units of $k_B T$). The partition function is $Z = e^{-0/k_B T} + e^{-\\Delta G/k_B T} = 1 + e^{-\\Delta g}$, and the probability of the bound state is $e^{-\\Delta g}/Z$. Thus, detailed balance ensures that the kinetic steady state corresponds to the thermodynamic equilibrium distribution.\n\nIn a scenario where detailed balance is violated, the rates $k_\\text{on}$ and $k_\\text{off}$ are set independently of $\\Delta g$. For example, if we set $k_\\text{on} = k_0$ and $k_\\text{off} = k_0$, the steady-state bound fraction becomes:\n$$\nP_{B,ss} = \\frac{k_0}{k_0 + k_0} = \\frac{1}{2}\n$$\nThis resulting distribution is a non-equilibrium steady state (NESS). It is determined solely by the chosen kinetics and not by the underlying energetic difference $\\Delta g$. It will only match the Boltzmann prediction by coincidence, specifically if $\\Delta g=0$, for which the Boltzmann probability is $\\frac{e^{-0}}{1+e^{-0}} = \\frac{1}{2}$. For any other $\\Delta g \\neq 0$, the NESS distribution deviates from the thermodynamic equilibrium prediction because the kinetic rates do not correctly reflect the relative stability of the states.\n\nThe algorithm for the simulation proceeds as follows. For each test case:\n1. Initialize parameters: a list of $\\Delta g_i$ values, corresponding group sizes $N_i$, a baseline rate $k_0$, a total time $T$, a tolerance $\\epsilon$, and a random seed.\n2. For each of the two scenarios (thermodynamically consistent and inconsistent), calculate the mean absolute discrepancy across all groups.\n3. To calculate the discrepancy for a scenario:\n   a. Initialize an empty list to store absolute differences.\n   b. For each group $i$ (with energy $\\Delta g_i$ and size $N_i$):\n      i. Set the rates $k_\\text{on}$ and $k_\\text{off}$ according to the scenario's rules.\n      ii. Calculate the theoretical bound probability $P_{B,i}(T)$ using the derived time-dependent solution: $P_{B,i}(T) = \\frac{k_\\text{on}}{k_\\text{on} + k_\\text{off}} (1 - e^{-(k_\\text{on} + k_\\text{off})T})$.\n      iii. Generate the number of bound agents by drawing from a binomial distribution: $n_{\\text{bound}, i} \\sim \\text{Binomial}(N_i, P_{B,i}(T))$.\n      iv. Compute the empirical bound fraction $f_i = n_{\\text{bound}, i} / N_i$.\n      v. Calculate the reference Boltzmann probability $P_{\\text{Boltzmann}, i} = \\frac{e^{-\\Delta g_i}}{1 + e^{-\\Delta g_i}}$.\n      vi. Compute the absolute difference $|f_i - P_{\\text{Boltzmann}, i}|$ and add it to the list.\n   c. The discrepancy for the scenario is the mean of the collected absolute differences.\n4. Compare the two discrepancies. The result for the test case is `True` if the discrepancy from the consistent scenario is less than or equal to the discrepancy from the inconsistent scenario plus the tolerance $\\epsilon$.\n5. Collect the boolean results for all test cases and format them as specified.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the problem by simulating a population of two-state cellular agents\n    under thermodynamically consistent and inconsistent kinetic schemes.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"name\": \"Case A\",\n            \"dg_values\": [0.0, 2.0, 6.0],\n            \"group_sizes\": [5000, 3000, 2000],\n            \"k0\": 5.0,\n            \"T\": 5.0,\n            \"epsilon\": 0.02,\n            \"seed\": 42\n        },\n        {\n            \"name\": \"Case B\",\n            \"dg_values\": [0.0],\n            \"group_sizes\": [10000],\n            \"k0\": 3.0,\n            \"T\": 5.0,\n            \"epsilon\": 0.02,\n            \"seed\": 43\n        },\n        {\n            \"name\": \"Case C\",\n            \"dg_values\": [-4.0, 2.0],\n            \"group_sizes\": [8000, 2000],\n            \"k0\": 1.0,\n            \"T\": 2.0,\n            \"epsilon\": 0.02,\n            \"seed\": 44\n        }\n    ]\n\n    results = []\n\n    for case in test_cases:\n        dg_values = np.array(case[\"dg_values\"])\n        group_sizes = np.array(case[\"group_sizes\"])\n        k0 = case[\"k0\"]\n        T = case[\"T\"]\n        epsilon = case[\"epsilon\"]\n        seed = case[\"seed\"]\n\n        np.random.seed(seed)\n\n        # --- Scenario 1: Thermodynamically Consistent (Detailed Balance) ---\n        diffs_consistent = []\n        for dg, N in zip(dg_values, group_sizes):\n            # Set rates according to detailed balance: k_on/k_off = exp(-dg)\n            # We choose k_off = k0 as a common timescale.\n            k_off = k0\n            k_on = k0 * np.exp(-dg)\n\n            # Calculate time-dependent bound probability P_B(T)\n            # P_B(t) = [k_on / (k_on + k_off)] * (1 - exp(-(k_on + k_off)*t))\n            k_sum = k_on + k_off\n            if k_sum == 0:\n                 # Avoid division by zero if both rates are zero\n                 p_bound_at_T = 0.0\n            else:\n                 p_ss = k_on / k_sum\n                 p_bound_at_T = p_ss * (1.0 - np.exp(-k_sum * T))\n\n            # Sample number of bound agents\n            num_bound = np.random.binomial(n=N, p=p_bound_at_T)\n            empirical_fraction = num_bound / N\n\n            # Calculate Boltzmann prediction\n            boltzmann_prediction = np.exp(-dg) / (1.0 + np.exp(-dg))\n\n            # Calculate absolute difference and store it\n            diffs_consistent.append(np.abs(empirical_fraction - boltzmann_prediction))\n\n        discrepancy_consistent = np.mean(diffs_consistent)\n\n        # --- Scenario 2: Thermodynamically Inconsistent (Detailed Balance Violated) ---\n        diffs_inconsistent = []\n        for dg, N in zip(dg_values, group_sizes):\n            # Set rates independent of dg\n            k_off = k0\n            k_on = k0\n\n            # Calculate time-dependent bound probability P_B(T)\n            k_sum = k_on + k_off\n            p_ss = k_on / k_sum\n            p_bound_at_T = p_ss * (1.0 - np.exp(-k_sum * T))\n\n            # Sample number of bound agents\n            num_bound = np.random.binomial(n=N, p=p_bound_at_T)\n            empirical_fraction = num_bound / N\n            \n            # Calculate Boltzmann prediction (same as before)\n            boltzmann_prediction = np.exp(-dg) / (1.0 + np.exp(-dg))\n\n            # Calculate absolute difference and store it\n            diffs_inconsistent.append(np.abs(empirical_fraction - boltzmann_prediction))\n\n        discrepancy_inconsistent = np.mean(diffs_inconsistent)\n\n        # --- Final Comparison ---\n        # The result is true if discrepancy_consistent is less than or equal to\n        # discrepancy_inconsistent within the tolerance epsilon.\n        is_less_or_equal = (discrepancy_consistent = discrepancy_inconsistent + epsilon)\n        results.append(is_less_or_equal)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Advanced models often couple agents to a dynamic environment, such as a diffusing chemical field described by a partial differential equation (PDE). This exercise addresses a critical and practical challenge in implementing such hybrid models: choosing a stable simulation time step, $\\Delta t$. You will derive constraints on $\\Delta t$ arising from the PDE solver's stability (the Courant-Friedrichs-Lewy condition), agent movement, and stochastic reaction events, synthesizing them into a single, robust criterion for a stable and accurate coupled simulation .",
            "id": "3287966",
            "problem": "In a two-dimensional coupled partial differential equation–agent-based model (PDE–ABM) of a chemotactic cellular system, the extracellular chemoattractant concentration field $c(x,y,t)$ obeys the constant-coefficient advection–diffusion equation\n$$\n\\frac{\\partial c}{\\partial t} + u_x \\frac{\\partial c}{\\partial x} + u_y \\frac{\\partial c}{\\partial y} = D \\left(\\frac{\\partial^2 c}{\\partial x^2} + \\frac{\\partial^2 c}{\\partial y^2}\\right),\n$$\nwhich is advanced in time by an explicit forward Euler method on a uniform Cartesian grid with spacing $h$ in both directions, using first-order upwind differences for advection and a five-point stencil for diffusion. Agents move in continuous space with speed bounded by $v_{\\max}$ and experience stochastic reactions (e.g., receptor binding) modeled as independent Poisson processes with maximum per-agent propensity $\\lambda_{\\max}$.\n\nUsing only fundamental discretization principles and the definition of a Poisson process, derive the Courant–Friedrichs–Lewy (CFL) stability condition for the explicit PDE solver and relate it to ABM time step constraints so that a single synchronous time step $\\Delta t$ ensures coupled stability and consistency. Concretely,\n\n- derive a sufficient explicit-step stability/monotonicity condition for the PDE in terms of $D$, $u_x$, $u_y$, and $h$;\n- derive ABM constraints that prevent an agent from traversing more than one PDE grid spacing in a single step and that bound the per-step reaction probability by a small tolerance $\\varepsilon$.\n\nThen, given the parameter values\n$$\nD = 2 \\times 10^{-10}\\ \\mathrm{m^2\\,s^{-1}},\\quad u_x = 1 \\times 10^{-5}\\ \\mathrm{m\\,s^{-1}},\\quad u_y = 5 \\times 10^{-6}\\ \\mathrm{m\\,s^{-1}},\n$$\n$$\nh = 5 \\times 10^{-6}\\ \\mathrm{m},\\quad v_{\\max} = 15\\ \\mathrm{\\mu m\\,min^{-1}},\\quad \\lambda_{\\max} = 0.5\\ \\mathrm{s^{-1}},\\quad \\varepsilon = 0.05,\n$$\ncompute the largest admissible synchronous time step $\\Delta t^{\\ast}$ that satisfies all constraints simultaneously. Express your final answer in seconds and round to four significant figures.",
            "solution": "We begin from the linear advection–diffusion equation and its explicit forward Euler spatial discretization with first-order upwind for advection and a five-point Laplacian for diffusion on a uniform grid. Let the grid spacing be $h$ in both $x$ and $y$, and denote the discrete concentration as $c_{i,j}^n \\approx c(x_i,y_j,t^n)$.\n\nFor constant advection velocities $u_x$ and $u_y$ and diffusion coefficient $D$, the forward Euler update at interior nodes takes the form\n$$\nc_{i,j}^{n+1} = c_{i,j}^{n} - \\alpha_x \\left(c_{i,j}^{n} - c_{i-\\sigma_x,j}^{n}\\right) - \\alpha_y \\left(c_{i,j}^{n} - c_{i,j-\\sigma_y}^{n}\\right) + \\beta \\left(c_{i+1,j}^{n}+c_{i-1,j}^{n}+c_{i,j+1}^{n}+c_{i,j-1}^{n}-4c_{i,j}^{n}\\right),\n$$\nwhere $\\sigma_x = \\operatorname{sign}(u_x)$ chooses the upwind direction, and the nonnegative coefficients are\n$$\n\\alpha_x = \\frac{|u_x|\\,\\Delta t}{h},\\quad \\alpha_y = \\frac{|u_y|\\,\\Delta t}{h},\\quad \\beta = \\frac{D\\,\\Delta t}{h^2}.\n$$\nA sufficient condition for stability and monotonicity (discrete maximum principle) of this explicit update for a linear scalar problem is that $c_{i,j}^{n+1}$ is a convex combination of current and neighboring values, which requires all weights to be nonnegative and to sum to one. Collecting the coefficient of $c_{i,j}^{n}$ gives\n$$\n\\text{coeff}(c_{i,j}^{n}) = 1 - \\alpha_x - \\alpha_y - 4\\beta,\n$$\nand the neighbor coefficients are nonnegative by construction. Thus, a sufficient stability/monotonicity condition is\n$$\n1 - \\alpha_x - \\alpha_y - 4\\beta \\ge 0 \\quad \\Longleftrightarrow \\quad \\alpha_x + \\alpha_y + 4\\beta \\le 1.\n$$\nSubstituting the definitions of $\\alpha_x$, $\\alpha_y$, and $\\beta$ yields the Courant–Friedrichs–Lewy (CFL) type bound for the explicit advection–diffusion scheme,\n$$\n\\Delta t \\le \\frac{1}{\\dfrac{|u_x|}{h} + \\dfrac{|u_y|}{h} + \\dfrac{4D}{h^2}}.\n$$\n\nWe now connect this to agent-based model (ABM) constraints. Two fundamental requirements ensure coupled stability and consistency:\n\n1. Kinematic coupling to the grid: Let $v_{\\max}$ be the maximum agent speed. To prevent an agent from traversing more than one grid spacing in a single step, we require that the displacement $v_{\\max}\\,\\Delta t$ does not exceed $h$,\n$$\nv_{\\max}\\,\\Delta t \\le h \\quad \\Longrightarrow \\quad \\Delta t \\le \\frac{h}{v_{\\max}}.\n$$\n\n2. Poisson event resolution: For a Poisson process with rate $\\lambda_{\\max}$, the probability of at least one event in a step of size $\\Delta t$ is $P(\\text{event in }\\Delta t) = 1 - \\exp(-\\lambda_{\\max}\\,\\Delta t)$. To bound this per-step probability by a small tolerance $\\varepsilon$ (to avoid multiple events per step and maintain accuracy),\n$$\n1 - \\exp(-\\lambda_{\\max}\\,\\Delta t) \\le \\varepsilon \\quad \\Longleftrightarrow \\quad \\Delta t \\le \\frac{-\\ln(1-\\varepsilon)}{\\lambda_{\\max}}.\n$$\n\nCombining the three independent requirements, a synchronous coupled time step $\\Delta t$ must satisfy\n$$\n\\Delta t \\le \\min\\!\\left\\{ \\frac{1}{\\dfrac{|u_x|}{h} + \\dfrac{|u_y|}{h} + \\dfrac{4D}{h^2}},\\ \\frac{h}{v_{\\max}},\\ \\frac{-\\ln(1-\\varepsilon)}{\\lambda_{\\max}} \\right\\}.\n$$\n\nWe now evaluate each bound using the provided parameters. First, we express all quantities in coherent units. We have\n$$\nD = 2 \\times 10^{-10}\\ \\mathrm{m^2\\,s^{-1}},\\quad u_x = 1 \\times 10^{-5}\\ \\mathrm{m\\,s^{-1}},\\quad u_y = 5 \\times 10^{-6}\\ \\mathrm{m\\,s^{-1}},\n$$\n$$\nh = 5 \\times 10^{-6}\\ \\mathrm{m},\\quad v_{\\max} = 15\\ \\mathrm{\\mu m\\,min^{-1}} = \\frac{15 \\times 10^{-6}}{60}\\ \\mathrm{m\\,s^{-1}} = 2.5 \\times 10^{-7}\\ \\mathrm{m\\,s^{-1}},\n$$\n$$\n\\lambda_{\\max} = 0.5\\ \\mathrm{s^{-1}},\\quad \\varepsilon = 0.05.\n$$\n\nPDE CFL bound:\n$$\n\\frac{|u_x|}{h} = \\frac{1 \\times 10^{-5}}{5 \\times 10^{-6}} = 2\\ \\mathrm{s^{-1}},\\quad \\frac{|u_y|}{h} = \\frac{5 \\times 10^{-6}}{5 \\times 10^{-6}} = 1\\ \\mathrm{s^{-1}},\n$$\n$$\n\\frac{4D}{h^2} = \\frac{4 \\times 2 \\times 10^{-10}}{(5 \\times 10^{-6})^2} = \\frac{8 \\times 10^{-10}}{25 \\times 10^{-12}} = 32\\ \\mathrm{s^{-1}}.\n$$\nTherefore,\n$$\n\\Delta t_{\\mathrm{PDE}} \\le \\frac{1}{2 + 1 + 32} = \\frac{1}{35}\\ \\mathrm{s} \\approx 0.02857142857\\ \\mathrm{s}.\n$$\n\nABM kinematic bound:\n$$\n\\Delta t_{\\mathrm{move}} \\le \\frac{h}{v_{\\max}} = \\frac{5 \\times 10^{-6}}{2.5 \\times 10^{-7}} = 20\\ \\mathrm{s}.\n$$\n\nABM Poisson bound:\n$$\n\\Delta t_{\\mathrm{react}} \\le \\frac{-\\ln(1-\\varepsilon)}{\\lambda_{\\max}} = \\frac{-\\ln(1 - 0.05)}{0.5} = \\frac{-\\ln(0.95)}{0.5}.\n$$\nCompute $-\\ln(0.95)$:\n$$\n-\\ln(0.95) \\approx 0.05129329439,\n$$\nso\n$$\n\\Delta t_{\\mathrm{react}} \\approx \\frac{0.05129329439}{0.5} \\approx 0.1025865888\\ \\mathrm{s}.\n$$\n\nTaking the minimum,\n$$\n\\Delta t^{\\ast} = \\min\\!\\left\\{ \\frac{1}{35},\\ 20,\\ 0.1025865888 \\right\\}\\ \\mathrm{s} = \\frac{1}{35}\\ \\mathrm{s} \\approx 0.02857142857\\ \\mathrm{s}.\n$$\n\nRounded to four significant figures and expressed in seconds, the largest admissible synchronous time step is\n$$\n0.02857\\ \\mathrm{s}.\n$$",
            "answer": "$$\\boxed{0.02857}$$"
        }
    ]
}