{
    "hands_on_practices": [
        {
            "introduction": "系统生物学的一个主要任务是从相互作用或相似性数据中揭示隐藏的组织结构。层次凝聚聚类提供了一种强大的、数据驱动的方法来构建树状图，从而直观地表示系统的多尺度模块化结构。本练习  提供了单链接算法的动手实践，这是一种推断层次结构的基本方法。",
            "id": "3318635",
            "problem": "在计算系统生物学中，可以通过对节点相似性矩阵进行聚类来推断层次化网络组织和多尺度结构，从而揭示跨尺度的模块。考虑一个包含$5$个分子子系统的系统，标记为$1,2,3,4,5$。给定对称相似性矩阵 $S \\in \\mathbb{R}^{5 \\times 5}$，其元素为 $s_{ij}$，其中对所有 $i$ 都有 $s_{ii} = 1$，且当 $i \\neq j$ 时 $s_{ij} \\in [0,1]$：\n$$\nS = \\begin{pmatrix}\n1.00  0.95  0.67  0.69  0.90 \\\\\n0.95  1.00  0.66  0.70  0.88 \\\\\n0.67  0.66  1.00  0.92  0.72 \\\\\n0.69  0.70  0.92  1.00  0.71 \\\\\n0.90  0.88  0.72  0.71  1.00\n\\end{pmatrix}.\n$$\n从以下定义出发：(i) 不相似性可通过相似性计算得出，$d_{ij} = 1 - s_{ij}$；(ii) 单链接层次凝聚聚类 (HAC) 在每一步合并两个簇间不相似性最小的簇，其中簇 $A$ 和 $B$ 之间的距离为 $\\min_{i \\in A, j \\in B} d_{ij}$；(iii) 两个叶节点 $i$ 和 $j$ 之间的超度量（谱系）距离 $u_{ij}$ 等于在树状图中 $i$ 和 $j$ 首次属于同一簇时的合并高度。请执行以下操作：\n\n- 对 $S$ 应用单链接HAC，首先形成不相似性矩阵 $D$，然后不断合并簇，直到只剩下一个簇。如果在选择要合并的簇时出现平局，则选择簇标签字典序最小的有序对来打破平局，其中簇以其排序后的成员集合作为标签。\n- 根据生成的树状图，确定所有 $1 \\leq i  j \\leq 5$ 的超度量距离 $u_{ij}$。\n\n最后，计算标量\n$$\nU_{\\mathrm{sum}} = \\sum_{1 \\leq i  j \\leq 5} u_{ij}.\n$$\n将最终答案表示为一个四舍五入到$4$位有效数字的无量纲实数。",
            "solution": "该问题已经过验证，被认为是合理、适定、客观的，并且在计算系统生物学领域具有科学依据。它提供了一套完整且一致的数据和定义，可以通过一个标准的算法程序得到唯一的解。\n\n解题过程分为四个主要步骤：\n1.  将相似性矩阵 $S$ 转换为不相似性矩阵 $D$。\n2.  对 $D$ 应用单链接层次凝聚聚类 (HAC)。\n3.  从生成的树状图中确定超度量（谱系）距离 $u_{ij}$。\n4.  计算最终的和 $U_{\\mathrm{sum}}$。\n\n**步骤 1：计算不相似性矩阵**\n\n不相似性 $d_{ij}$ 定义为 $d_{ij} = 1 - s_{ij}$。使用给定的相似性矩阵 $S$：\n$$\nS = \\begin{pmatrix}\n1.00  0.95  0.67  0.69  0.90 \\\\\n0.95  1.00  0.66  0.70  0.88 \\\\\n0.67  0.66  1.00  0.92  0.72 \\\\\n0.69  0.70  0.92  1.00  0.71 \\\\\n0.90  0.88  0.72  0.71  1.00\n\\end{pmatrix}\n$$\n得到的不相似性矩阵 $D$ 是：\n$$\nD = 1 - S = \\begin{pmatrix}\n0.00  0.05  0.33  0.31  0.10 \\\\\n0.05  0.00  0.34  0.30  0.12 \\\\\n0.33  0.34  0.00  0.08  0.28 \\\\\n0.31  0.30  0.08  0.00  0.29 \\\\\n0.10  0.12  0.28  0.29  0.00\n\\end{pmatrix}\n$$\n对角线元素为 $d_{ii} = 1 - 1 = 0$，符合预期。\n\n**步骤 2：执行单链接层次凝聚聚类 (HAC)**\n\n聚类过程开始时，5个子系统各自作为一个簇：$\\{1\\}, \\{2\\}, \\{3\\}, \\{4\\}, \\{5\\}$。在每一步，我们合并具有最小簇间不相似性的两个簇。对于单链接，两个簇 $A$ 和 $B$ 之间的距离由 $d(A, B) = \\min_{i \\in A, j \\in B} d_{ij}$ 给出。\n\n**迭代 1：**\n初始的簇间距离是矩阵 $D$ 的元素。最小的非对角线元素是 $d_{12} = 0.05$。\n- 合并簇 $\\{1\\}$ 和 $\\{2\\}$，形成新簇 $\\{1, 2\\}$。\n- 合并高度（不相似性）为 $0.05$。\n- 当前簇：$\\{1, 2\\}, \\{3\\}, \\{4\\}, \\{5\\}$。\n\n**迭代 2：**\n我们计算新簇 $\\{1, 2\\}$ 与其余簇之间的不相似性：\n- $d(\\{1, 2\\}, \\{3\\}) = \\min(d_{13}, d_{23}) = \\min(0.33, 0.34) = 0.33$。\n- $d(\\{1, 2\\}, \\{4\\}) = \\min(d_{14}, d_{24}) = \\min(0.31, 0.30) = 0.30$。\n- $d(\\{1, 2\\}, \\{5\\}) = \\min(d_{15}, d_{25}) = \\min(0.10, 0.12) = 0.10$。\n其他距离保持不变：$d_{34} = 0.08$, $d_{35} = 0.28$, $d_{45} = 0.29$。\n当前簇间不相似性的集合是 $\\{0.33, 0.30, 0.10, 0.08, 0.28, 0.29\\}$。最小值是 $d_{34} = 0.08$。\n- 合并簇 $\\{3\\}$ 和 $\\{4\\}$，形成新簇 $\\{3, 4\\}$。\n- 合并高度为 $0.08$。\n- 当前簇：$\\{1, 2\\}, \\{3, 4\\}, \\{5\\}$。\n\n**迭代 3：**\n我们计算当前簇之间的不相似性：\n- $d(\\{1, 2\\}, \\{5\\}) = 0.10$ (来自上一步)。\n- $d(\\{3, 4\\}, \\{5\\}) = \\min(d_{35}, d_{45}) = \\min(0.28, 0.29) = 0.28$。\n- $d(\\{1, 2\\}, \\{3, 4\\}) = \\min(d_{13}, d_{14}, d_{23}, d_{24}) = \\min(0.33, 0.31, 0.34, 0.30) = 0.30$。\n当前簇间不相似性的集合是 $\\{0.10, 0.28, 0.30\\}$。最小值是 $0.10$。\n- 合并簇 $\\{1, 2\\}$ 和 $\\{5\\}$，形成新簇 $\\{1, 2, 5\\}$。\n- 合并高度为 $0.10$。\n- 当前簇：$\\{1, 2, 5\\}, \\{3, 4\\}$。\n\n**迭代 4：**\n只剩下两个簇。我们计算它们之间的不相似性：\n- $d(\\{1, 2, 5\\}, \\{3, 4\\}) = \\min(d(\\{1, 2\\}, \\{3, 4\\}), d(\\{5\\}, \\{3, 4\\})) = \\min(0.30, 0.28) = 0.28$。\n- 合并簇 $\\{1, 2, 5\\}$ 和 $\\{3, 4\\}$，形成最终簇 $\\{1, 2, 3, 4, 5\\}$。\n- 合并高度为 $0.28$。\n聚类过程完成。\n\n**步骤 3：确定超度量（谱系）距离**\n\n两个初始项目 $i$ 和 $j$ 之间的超度量距离 $u_{ij}$ 是它们首次出现在同一个簇中的合并高度。根据HAC的步骤：\n- $\\{1\\}$ 和 $\\{2\\}$ 的合并发生在高度 $0.05$ 处。所以，$u_{12} = 0.05$。\n- $\\{3\\}$ 和 $\\{4\\}$ 的合并发生在高度 $0.08$ 处。所以，$u_{34} = 0.08$。\n- $\\{1, 2\\}$ 和 $\\{5\\}$ 的合并发生在高度 $0.10$ 处。这是来自 $\\{1, 2\\}$ 的元素首次与 $5$ 聚类。因此，$u_{15} = 0.10$ 且 $u_{25} = 0.10$。\n- $\\{1, 2, 5\\}$ 和 $\\{3, 4\\}$ 的合并发生在高度 $0.28$ 处。这是来自 $\\{1, 2, 5\\}$ 的元素首次与来自 $\\{3, 4\\}$ 的元素聚类。这适用于 $3 \\times 2 = 6$ 对。\n  - $u_{13} = u_{14} = 0.28$。\n  - $u_{23} = u_{24} = 0.28$。\n  - $u_{35} = u_{45} = 0.28$。(注意 $u_{35} = u_{53}$ 且 $u_{45}=u_{54}$)\n\n总而言之，$\\binom{5}{2} = 10$ 个唯一的超度量距离是：\n- $u_{12} = 0.05$\n- $u_{13} = 0.28$\n- $u_{14} = 0.28$\n- $u_{15} = 0.10$\n- $u_{23} = 0.28$\n- $u_{24} = 0.28$\n- $u_{25} = 0.10$\n- $u_{34} = 0.08$\n- $u_{35} = 0.28$\n- $u_{45} = 0.28$\n\n**步骤 4：计算总和**\n\n我们现在计算总和 $U_{\\mathrm{sum}} = \\sum_{1 \\leq i  j \\leq 5} u_{ij}$。\n$$\nU_{\\mathrm{sum}} = u_{12} + u_{13} + u_{14} + u_{15} + u_{23} + u_{24} + u_{25} + u_{34} + u_{35} + u_{45}\n$$\n对值进行分组：\n$$\nU_{\\mathrm{sum}} = (u_{12}) + (u_{34}) + (u_{15} + u_{25}) + (u_{13} + u_{14} + u_{23} + u_{24} + u_{35} + u_{45})\n$$\n$$\nU_{\\mathrm{sum}} = (0.05) + (0.08) + 2 \\times (0.10) + 6 \\times (0.28)\n$$\n$$\nU_{\\mathrm{sum}} = 0.05 + 0.08 + 0.20 + 1.68\n$$\n$$\nU_{\\mathrm{sum}} = 0.13 + 0.20 + 1.68\n$$\n$$\nU_{\\mathrm{sum}} = 0.33 + 1.68\n$$\n$$\nU_{\\mathrm{sum}} = 2.01\n$$\n问题要求答案四舍五入到4位有效数字。精确答案 $2.01$ 有三位有效数字。为了用四位有效数字表示，我们追加一个零。\n$$\nU_{\\mathrm{sum}} \\approx 2.010\n$$",
            "answer": "$$\\boxed{2.010}$$"
        },
        {
            "introduction": "网络模块化结构的功能意义通常在于它如何塑造系统动力学。一个关键问题是我们是否能将一个复杂的模型简化为一个在模块而非单个节点上运行的“粗粒化”模型。本练习  介绍了马尔可夫链的“强集总性”这一形式化条件，为判断这种模型简化何时能做到精确提供了严谨的方法。",
            "id": "3318660",
            "problem": "一个生化信号基序因磷酸化和衔接子结合构型的不同而表现出四种快速的微观状态。在较长时间尺度上，该系统被假设可以采用一种粗粒化的双宏观状态描述，分别对应于低输出和高输出活性。微观状态动力学被建模为一个连续时间马尔可夫链 (CTMC)，其生成元矩阵为 $Q \\in \\mathbb{R}^{4 \\times 4}$ (单位为 $\\mathrm{min}^{-1}$)，状态标签 $1,2,3,4$ 代表不同的微观构型。该生成元为\n$$\nQ \\;=\\;\n\\begin{pmatrix}\n-0.9  0.4  0.3  0.2 \\\\\n0.7  -1.2  0.3  0.2 \\\\\n0.25  0.15  -0.9  0.5 \\\\\n0.25  0.15  0.6  -1.0\n\\end{pmatrix}.\n$$\n给定一个建议的双区块划分 $\\mathcal{B} = \\{B_{1}, B_{2}\\}$，其中 $B_{1}=\\{1,2\\}$ (低输出) 且 $B_{2}=\\{3,4\\}$ (高输出)。请仅使用 CTMC 生成元的定义和连续时间马尔可夫链 (CTMC) 的强集总性概念，判断划分 $\\mathcal{B}$ 是否能在 CTMC 层面上产生一个有效的强可集总粗粒化。如果可以，请计算控制宏观状态过程 $\\{B_{1},B_{2}\\}$ 的聚合 $2 \\times 2$ 生成元 $\\tilde{Q}$ (单位为 $\\mathrm{min}^{-1}$)。\n\n请以 $\\mathrm{min}^{-1}$ 为单位，使用精确小数（不进行四舍五入）表示最终的 $2 \\times 2$ 矩阵。最终矩阵请勿包含任何额外评注。",
            "solution": "该问题要求我们判断一个连续时间马尔可夫链 (CTMC) 的状态空间的给定划分是否是强可集总的，如果是，则计算聚合（集总）过程的生成元矩阵。\n\n首先，我们必须验证所提供的矩阵 $Q$ 是否是一个有效的 CTMC 生成元。一个矩阵 $Q = (Q_{ij})$ 是生成元当且仅当其非对角元素为非负数（对于 $i \\ne j$，$Q_{ij} \\ge 0$），并且每行的元素之和为零（对于所有 $i$，$\\sum_{j} Q_{ij} = 0$）。我们来验证给定矩阵是否满足这些条件：\n$$\nQ \\;=\\;\n\\begin{pmatrix}\n-0.9  0.4  0.3  0.2 \\\\\n0.7  -1.2  0.3  0.2 \\\\\n0.25  0.15  -0.9  0.5 \\\\\n0.25  0.15  0.6  -1.0\n\\end{pmatrix}\n$$\n所有非对角元素显然都是非负的。我们检查行和：\n行 1: $-0.9 + 0.4 + 0.3 + 0.2 = -0.9 + 0.9 = 0$。\n行 2: $0.7 - 1.2 + 0.3 + 0.2 = 1.2 - 1.2 = 0$。\n行 3: $0.25 + 0.15 - 0.9 + 0.5 = 0.9 - 0.9 = 0$。\n行 4: $0.25 + 0.15 + 0.6 - 1.0 = 1.0 - 1.0 = 0$。\n由于所有条件都满足，$Q$ 是一个有效的生成元矩阵。该问题是良定义的。\n\n问题的核心在于 CTMC 的强集总性定义。设状态空间为 $S = \\{1, 2, 3, 4\\}$，划分为 $\\mathcal{B} = \\{B_1, B_2, \\dots, B_M\\}$。对于生成元 $Q$，一个划分是强可集总的，如果对于任意两个区块（宏观状态）$B_I, B_J \\in \\mathcal{B}$，从区块 $B_I$ 中的任意微观状态 $i$ 到区块 $B_J$ 的转移速率之和是恒定的。也就是说，对于所有的 $i, k \\in B_I$，必须满足以下条件：\n$$\n\\sum_{j \\in B_J} Q_{ij} = \\sum_{j \\in B_J} Q_{kj}\n$$\n如果此条件成立，则聚合过程也是一个在宏观状态 $\\{B_1, \\dots, B_M\\}$ 上的 CTMC，其生成元 $\\tilde{Q}$ 的元素 $\\tilde{Q}_{IJ}$ 由这个共同的和给出。\n\n给定的划分为 $\\mathcal{B} = \\{B_1, B_2\\}$，其中 $B_1 = \\{1,2\\}$ 且 $B_2 = \\{3,4\\}$。我们必须对所有宏观状态对 $(B_I, B_J)$ 检查可集总性条件。\n\n1.  **源于宏观状态 $B_1 = \\{1,2\\}$ 的转移：**\n    我们需要检查从微观状态 $1$ 和 $2$ 到每个宏观状态（$B_1$ 和 $B_2$）的速率之和是否相等。\n\n    a.  **从 $B_1$ 到 $B_1$ 的速率**：检查 $\\sum_{j \\in B_1} Q_{1j} = \\sum_{j \\in B_1} Q_{2j}$ 是否成立。\n        对于微观状态 $i=1$：$\\sum_{j \\in \\{1,2\\}} Q_{1j} = Q_{11} + Q_{12} = -0.9 + 0.4 = -0.5$。\n        对于微观状态 $i=2$：$\\sum_{j \\in \\{1,2\\}} Q_{2j} = Q_{21} + Q_{22} = 0.7 + (-1.2) = -0.5$。\n        和相等。此条件满足。\n\n    b.  **从 $B_1$ 到 $B_2$ 的速率**：检查 $\\sum_{j \\in B_2} Q_{1j} = \\sum_{j \\in B_2} Q_{2j}$ 是否成立。\n        对于微观状态 $i=1$：$\\sum_{j \\in \\{3,4\\}} Q_{1j} = Q_{13} + Q_{14} = 0.3 + 0.2 = 0.5$。\n        对于微观状态 $i=2$：$\\sum_{j \\in \\{3,4\\}} Q_{2j} = Q_{23} + Q_{24} = 0.3 + 0.2 = 0.5$。\n        和相等。此条件也满足。\n\n2.  **源于宏观状态 $B_2 = \\{3,4\\}$ 的转移：**\n    我们需要检查从微观状态 $3$ 和 $4$ 到每个宏观状态（$B_1$ 和 $B_2$）的速率之和是否相等。\n\n    a.  **从 $B_2$ 到 $B_1$ 的速率**：检查 $\\sum_{j \\in B_1} Q_{3j} = \\sum_{j \\in B_1} Q_{4j}$ 是否成立。\n        对于微观状态 $i=3$：$\\sum_{j \\in \\{1,2\\}} Q_{3j} = Q_{31} + Q_{32} = 0.25 + 0.15 = 0.4$。\n        对于微观状态 $i=4$：$\\sum_{j \\in \\{1,2\\}} Q_{4j} = Q_{41} + Q_{42} = 0.25 + 0.15 = 0.4$。\n        和相等。此条件满足。\n\n    b.  **从 $B_2$ 到 $B_2$ 的速率**：检查 $\\sum_{j \\in B_2} Q_{3j} = \\sum_{j \\in B_2} Q_{4j}$ 是否成立。\n        对于微观状态 $i=3$：$\\sum_{j \\in \\{3,4\\}} Q_{3j} = Q_{33} + Q_{34} = -0.9 + 0.5 = -0.4$。\n        对于微观状态 $i=4$：$\\sum_{j \\in \\{3,4\\}} Q_{4j} = Q_{43} + Q_{44} = 0.6 + (-1.0) = -0.4$。\n        和相等。此条件也满足。\n\n由于强可集总性的所有四个条件都得到满足，划分 $\\mathcal{B} = \\{\\{1,2\\}, \\{3,4\\}\\}$ 是一个有效的强可集总划分。现在我们可以构建 $2 \\times 2$ 的聚合生成元矩阵 $\\tilde{Q}$，其中状态对应于 $B_1$ (低输出) 和 $B_2$ (高输出)。矩阵元素 $\\tilde{Q}_{IJ}$ 是我们计算出的共同的和。\n\n$\\tilde{Q}_{11} = (\\text{从 } B_1 \\text{ 到 } B_1 \\text{ 的速率}) = -0.5 \\, \\mathrm{min}^{-1}$。\n$\\tilde{Q}_{12} = (\\text{从 } B_1 \\text{ 到 } B_2 \\text{ 的速率}) = 0.5 \\, \\mathrm{min}^{-1}$。\n$\\tilde{Q}_{21} = (\\text{从 } B_2 \\text{ 到 } B_1 \\text{ 的速率}) = 0.4 \\, \\mathrm{min}^{-1}$。\n$\\tilde{Q}_{22} = (\\text{从 } B_2 \\text{ 到 } B_2 \\text{ 的速率}) = -0.4 \\, \\mathrm{min}^{-1}$。\n\n作为最终检查，$\\tilde{Q}$ 的各行之和必须为零：\n行 1: $\\tilde{Q}_{11} + \\tilde{Q}_{12} = -0.5 + 0.5 = 0$。\n行 2: $\\tilde{Q}_{21} + \\tilde{Q}_{22} = 0.4 + (-0.4) = 0$。\n结果矩阵是一个有效的生成元。\n\n聚合生成元矩阵为：\n$$\n\\tilde{Q} =\n\\begin{pmatrix}\n-0.5  0.5 \\\\\n0.4  -0.4\n\\end{pmatrix}\n$$\n单位为 $\\mathrm{min}^{-1}$，继承自原始生成元 $Q$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-0.5  0.5 \\\\\n0.4  -0.4\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "许多生物系统具有跨越多个、分离良好的时间尺度的过程，这是层次组织的标志。本练习  探究了一个反应-扩散系统，其中快速的模块内反应通过慢速的模块间扩散耦合在一起。通过应用准稳态近似（quasi-steady-state approximation, QSSA），您将推导出一个描述慢速动力学的简化模型，这是多尺度建模中的一项基石技术。",
            "id": "3318636",
            "problem": "给定一个双模块反应-扩散网络，该网络模型了每个模块内的一种可逆反应以及各物种在模块间的线性扩散。在每个模块中，物种 $A_i$ 和 $B_i$ 根据质量作用动力学相互转化，并且每个物种通过菲克耦合在两个模块之间扩散。该系统由以下常微分方程（ODE）组成，其中模块 $i \\in \\{1,2\\}$，$j$ 表示另一个模块：\n- 模块内反应 $A_i \\rightleftharpoons B_i$，正向速率常数为 $k_{f,i}$（对于 $A_i \\to B_i$），逆向速率常数为 $k_{b,i}$（对于 $B_i \\to A_i$）。\n- 模块间扩散，物种 $A$ 的扩散系数为 $D_A$，物种 $B$ 的扩散系数为 $D_B$。\n\n设状态向量为 $(A_1,B_1,A_2,B_2)$。动力学方程为\n$$\n\\frac{dA_1}{dt} = -k_{f,1} A_1 + k_{b,1} B_1 + D_A (A_2 - A_1), \\quad\n\\frac{dB_1}{dt} = \\phantom{-}k_{f,1} A_1 - k_{b,1} B_1 + D_B (B_2 - B_1),\n$$\n$$\n\\frac{dA_2}{dt} = -k_{f,2} A_2 + k_{b,2} B_2 + D_A (A_1 - A_2), \\quad\n\\frac{dB_2}{dt} = \\phantom{-}k_{f,2} A_2 - k_{b,2} B_2 + D_B (B_1 - B_2).\n$$\n假设总量\n$$\nN_{\\mathrm{tot}} = A_1 + B_1 + A_2 + B_2\n$$\n是守恒的。所有量均为无单位量。\n\n任务：\n1) 通过应用时间尺度分离和准稳态近似（QSSA），推导模块总量 $T_i = A_i + B_i$ 的慢动力学简化模型。在该近似中，模块内反应相比于模块间扩散会迅速达到松弛状态。在此假设下，每个模块 $i$ 内的快速反应达到平衡，使得\n$$\nA_i \\approx \\alpha_i T_i, \\qquad B_i \\approx (1 - \\alpha_i) T_i, \\qquad \\alpha_i = \\frac{k_{b,i}}{k_{f,i} + k_{b,i}}.\n$$\n证明慢动力学满足\n$$\n\\frac{dT_1}{dt} = D_A \\big(\\alpha_2 T_2 - \\alpha_1 T_1\\big) + D_B \\big((1-\\alpha_2) T_2 - (1-\\alpha_1) T_1\\big), \\qquad \\frac{dT_2}{dt} = -\\frac{dT_1}{dt},\n$$\n并计算在约束条件 $T_1^\\ast + T_2^\\ast = N_{\\mathrm{tot}}$ 下的简化稳态 $(T_1^\\ast,T_2^\\ast)$。\n2) 通过将常微分方程的右侧设为零并施加守恒约束，计算完整系统的稳态 $(A_1^\\ast,B_1^\\ast,A_2^\\ast,B_2^\\ast)$。这将形成一个线性代数系统。然后计算完整系统的模块总量 $T_1^{\\mathrm{full}} = A_1^\\ast + B_1^\\ast$ 和 $T_2^{\\mathrm{full}} = A_2^\\ast + B_2^\\ast$。\n3) 通过报告以下内容，比较简化稳态和完整系统稳态：\n- 来自简化模型的 $T_1^\\ast$，\n- 来自完整系统的 $T_1^{\\mathrm{full}}$，\n- 绝对差 $\\lvert T_1^\\ast - T_1^{\\mathrm{full}} \\rvert$，\n- 完整稳态与稳态下简化模型物种重构之间的物种层面差异的欧几里得范数，定义为\n$$\n\\Delta_{\\mathrm{species}} = \\sqrt{(A_1^\\ast - \\alpha_1 T_1^\\ast)^2 + (B_1^\\ast - (1-\\alpha_1) T_1^\\ast)^2 + (A_2^\\ast - \\alpha_2 T_2^\\ast)^2 + (B_2^\\ast - (1-\\alpha_2) T_2^\\ast)^2}.\n$$\n\n数值要求：\n- 对于每个测试用例，将上述四个量以浮点数形式输出，并精确到 $6$ 位小数。\n- 你的程序应生成单行输出，其中包含一个以逗号分隔的列表的列表，不含空格，并用方括号括起来。每个内部列表对应一个测试用例，顺序与下文相同。例如，格式应为“[[x11,x12,x13,x14],[x21,x22,x23,x24],[x31,x32,x33,x34]]”，其中每个 $x_{ij}$ 是一个精确到 $6$ 位小数的浮点数。\n\n测试套件：\n为以下三组参数计算指定的输出。所有量均为无单位量。\n\n- 情况 $\\mathbf{1}$（对称模块）：\n  - $k_{f,1} = 2$, $k_{b,1} = 1$, $k_{f,2} = 2$, $k_{b,2} = 1$, $D_A = 0.5$, $D_B = 0.5$, $N_{\\mathrm{tot}} = 10$。\n- 情况 $\\mathbf{2}$（非对称反应，扩散有利于 $B$）：\n  - $k_{f,1} = 10$, $k_{b,1} = 1$, $k_{f,2} = 1$, $k_{b,2} = 10$, $D_A = 0.2$, $D_B = 1.0$, $N_{\\mathrm{tot}} = 10$。\n- 情况 $\\mathbf{3}$（只有 $A$ 扩散）：\n  - $k_{f,1} = 3$, $k_{b,1} = 1$, $k_{f,2} = 1$, $k_{b,2} = 3$, $D_A = 1.5$, $D_B = 0.0$, $N_{\\mathrm{tot}} = 8$。\n\n你的程序必须为每种情况计算简化稳态和完整系统稳态，按规定进行比较，并按照上述确切的单行格式输出所有三种情况的结果。不需要用户输入。所有数字都是无单位的，并且应精确到 $6$ 位小数。最终输出必须是指定格式的单行字符串。",
            "solution": "我们从基本且广为接受的规则开始：可逆反应的质量作用动力学和线性物种交换的菲克扩散。对于模块 $i \\in \\{1,2\\}$，可逆反应 $A_i \\rightleftharpoons B_i$ 遵循\n$$\n\\frac{dA_i}{dt}\\Big|_{\\mathrm{rxn}} = -k_{f,i} A_i + k_{b,i} B_i, \\qquad \\frac{dB_i}{dt}\\Big|_{\\mathrm{rxn}} = k_{f,i} A_i - k_{b,i} B_i,\n$$\n这会守恒模块总量 $T_i = A_i + B_i$，因为反应项在求和时会相互抵消。模块间扩散，建模为线性交换，其贡献为\n$$\n\\frac{dA_i}{dt}\\Big|_{\\mathrm{diff}} = D_A (A_j - A_i), \\qquad \\frac{dB_i}{dt}\\Big|_{\\mathrm{diff}} = D_B (B_j - B_i),\n$$\n其中 $j \\neq i$。结合反应和扩散，得到所给出的常微分方程（ODE），并保持全局总量 $N_{\\mathrm{tot}} = A_1 + B_1 + A_2 + B_2$ 守恒。\n\n通过时间尺度分离和准稳态近似（QSSA）得到的简化模型：\n- 假设：每个模块内的反应在相对于扩散的快速时间尺度上达到平衡。在快速流形上，对于每个模块 $i$，我们将反应项设为零：\n$$\n-k_{f,i} A_i + k_{b,i} B_i \\approx 0 \\quad \\Rightarrow \\quad \\frac{B_i}{A_i} \\approx \\frac{k_{f,i}}{k_{b,i}}.\n$$\n用模块总量 $T_i = A_i + B_i$ 表示 $A_i$ 和 $B_i$ 可得\n$$\nA_i \\approx \\alpha_i T_i, \\qquad B_i \\approx (1 - \\alpha_i) T_i, \\qquad \\alpha_i = \\frac{k_{b,i}}{k_{f,i} + k_{b,i}}.\n$$\n- 模块总量的慢动力学可以通过对模块内的常微分方程求和得到（这将抵消反应项）：\n$$\n\\frac{dT_1}{dt} = \\frac{dA_1}{dt} + \\frac{dB_1}{dt} = D_A (A_2 - A_1) + D_B (B_2 - B_1).\n$$\n代入准稳态表达式 $A_i \\approx \\alpha_i T_i$，$B_i \\approx (1 - \\alpha_i) T_i$ 可得\n$$\n\\frac{dT_1}{dt} = D_A \\big(\\alpha_2 T_2 - \\alpha_1 T_1\\big) + D_B \\big((1 - \\alpha_2) T_2 - (1 - \\alpha_1) T_1\\big),\n$$\n并且根据守恒定律，$\\frac{dT_2}{dt} = -\\frac{dT_1}{dt}$。简化稳态 $(T_1^\\ast, T_2^\\ast)$ 满足 $\\frac{dT_1}{dt} = 0$ 和 $T_1^\\ast + T_2^\\ast = N_{\\mathrm{tot}}$。定义系数\n$$\nc_1 = D_A \\alpha_1 + D_B (1 - \\alpha_1), \\qquad c_2 = D_A \\alpha_2 + D_B (1 - \\alpha_2).\n$$\n那么稳态条件简化为\n$$\n0 = -c_1 T_1^\\ast + c_2 T_2^\\ast, \\qquad T_2^\\ast = N_{\\mathrm{tot}} - T_1^\\ast,\n$$\n由此可得\n$$\n(c_1 + c_2) T_1^\\ast = c_2 N_{\\mathrm{tot}} \\quad \\Rightarrow \\quad T_1^\\ast = \\frac{c_2}{c_1 + c_2} N_{\\mathrm{tot}}, \\qquad T_2^\\ast = N_{\\mathrm{tot}} - T_1^\\ast.\n$$\n稳态下的简化模型物种重构为\n$$\nA_i^{\\mathrm{red}} = \\alpha_i T_i^\\ast, \\qquad B_i^{\\mathrm{red}} = (1 - \\alpha_i) T_i^\\ast.\n$$\n\n完整系统稳态：\n- 将常微分方程的右侧设为零并施加守恒。变量顺序为 $x = [A_1, B_1, A_2, B_2]^\\top$，稳态方程是线性的：\n$$\n\\begin{aligned}\n(-k_{f,1} - D_A) A_1 + k_{b,1} B_1 + D_A A_2 + 0 \\cdot B_2 = 0, \\\\\n{f,1} A_1 + (-k_{b,1} - D_B) B_1 + 0 \\cdot A_2 + D_B B_2 = 0, \\\\\n A_1 + 0 \\cdot B_1 + (-k_{f,2} - D_A) A_2 + k_{b,2} B_2 = 0, \\\\\n0 \\cdot A_1 + D_B B_1 + k_{f,2} A_2 + (-k_{b,2} - D_B) B_2 = 0,\n\\end{aligned}\n$$\n以及\n$$\nA_1 + B_1 + A_2 + B_2 = N_{\\mathrm{tot}}.\n$$\n由于动力学中隐含的守恒定律，这五个方程存在一个线性相关；因此，我们在最小二乘意义下同时求解它们，以获得满足所有约束的唯一解。然后，完整模块的总量为\n$$\nT_1^{\\mathrm{full}} = A_1^\\ast + B_1^\\ast, \\qquad T_2^{\\mathrm{full}} = A_2^\\ast + B_2^\\ast.\n$$\n\n比较指标：\n- 模块 $1$ 总量的绝对差：$\\lvert T_1^\\ast - T_1^{\\mathrm{full}} \\rvert$。\n- 完整稳态与简化模型重构之间的物种层面欧几里得差异：\n$$\n\\Delta_{\\mathrm{species}} = \\sqrt{(A_1^\\ast - \\alpha_1 T_1^\\ast)^2 + (B_1^\\ast - (1 - \\alpha_1) T_1^\\ast)^2 + (A_2^\\ast - \\alpha_2 T_2^\\ast)^2 + (B_2^\\ast - (1 - \\alpha_2) T_2^\\ast)^2 }.\n$$\n\n每个测试用例的算法实现步骤：\n- 使用 $\\alpha_i = \\frac{k_{b,i}}{k_{f,i} + k_{b,i}}$ 计算 $i \\in \\{1,2\\}$ 的 $\\alpha_i$。\n- 计算 $c_1$ 和 $c_2$，然后计算 $T_1^\\ast = \\frac{c_2}{c_1 + c_2} N_{\\mathrm{tot}}$ 和 $T_2^\\ast = N_{\\mathrm{tot}} - T_1^\\ast$。\n- 通过 $A_i^{\\mathrm{red}} = \\alpha_i T_i^\\ast$，$B_i^{\\mathrm{red}} = (1 - \\alpha_i) T_i^\\ast$ 重构简化模型物种 $(A_i^{\\mathrm{red}}, B_i^{\\mathrm{red}})$。\n- 构建与四个稳态方程加上守恒方程相对应的线性系统矩阵和向量，并使用最小二乘求解器求解 $(A_1^\\ast, B_1^\\ast, A_2^\\ast, B_2^\\ast)$。\n- 计算 $T_1^{\\mathrm{full}} = A_1^\\ast + B_1^\\ast$ 和 $T_2^{\\mathrm{full}} = A_2^\\ast + B_2^\\ast$。\n- 计算 $\\lvert T_1^\\ast - T_1^{\\mathrm{full}} \\rvert$ 和 $\\Delta_{\\mathrm{species}}$。\n- 将所有报告值精确到 $6$ 位小数，并将最终输出格式化为单行字符串：一个由方括号括起的、逗号分隔的三个内部列表组成的列表，每个内部列表包含一个测试用例的四个四舍五入后的浮点数，不含空格。\n\n提供的测试套件涵盖：\n- 一种对称情况，用于验证简化稳态和完整系统稳态的一致性。\n- 一种非对称反应情况，其中扩散有利于物种 $B$，以评估模块总量如何不同。\n- 一种只有 $A$ 扩散的情况，以探究边缘行为以及反应-扩散耦合如何重新分配模块总量。\n\n所有量均为无单位量，且不需要用户输入。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef reduced_steady_state(kf1, kb1, kf2, kb2, DA, DB, Ntot):\n    # Compute alpha_i for each module\n    alpha1 = kb1 / (kf1 + kb1)\n    alpha2 = kb2 / (kf2 + kb2)\n    # Effective coefficients for the slow T dynamics\n    c1 = DA * alpha1 + DB * (1 - alpha1)\n    c2 = DA * alpha2 + DB * (1 - alpha2)\n    # Solve for T1*, T2* under T1* + T2* = Ntot and steady-state condition\n    denom = c1 + c2\n    # To avoid numerical issues in edge cases (should not occur in given tests)\n    if denom == 0:\n        # If both c1 and c2 are zero, diffusion does not change totals; split evenly\n        T1_star = Ntot / 2.0\n    else:\n        T1_star = (c2 / denom) * Ntot\n    T2_star = Ntot - T1_star\n    # Reduced species reconstruction\n    A1r = alpha1 * T1_star\n    B1r = (1 - alpha1) * T1_star\n    A2r = alpha2 * T2_star\n    B2r = (1 - alpha2) * T2_star\n    return (T1_star, T2_star), (A1r, B1r, A2r, B2r), (alpha1, alpha2)\n\ndef full_steady_state(kf1, kb1, kf2, kb2, DA, DB, Ntot):\n    # Build the linear system M x = b with 5 equations (4 steady-state, 1 conservation)\n    # Variables x = [A1, B1, A2, B2]\n    M = np.array([\n        [-kf1 - DA,   kb1,        DA,      0.0],   # dA1/dt = 0\n        [  kf1,     -kb1 - DB,    0.0,     DB ],   # dB1/dt = 0\n        [  DA,         0.0,     -kf2 - DA, kb2],   # dA2/dt = 0\n        [  0.0,        DB,        kf2,   -kb2 - DB], # dB2/dt = 0\n        [  1.0,        1.0,       1.0,     1.0]    # conservation\n    ], dtype=float)\n    b = np.array([0.0, 0.0, 0.0, 0.0, Ntot], dtype=float)\n    # Solve least squares to handle linear dependence (one redundant equation)\n    x, residuals, rank, s = np.linalg.lstsq(M, b, rcond=None)\n    A1, B1, A2, B2 = x\n    return (A1, B1, A2, B2)\n\ndef format_inner_list(vals):\n    # Format a list of floats with exactly 6 decimals, no spaces, enclosed in brackets\n    return \"[\" + \",\".join(f\"{v:.6f}\" for v in vals) + \"]\"\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (kf1, kb1, kf2, kb2, DA, DB, Ntot)\n    test_cases = [\n        (2.0, 1.0, 2.0, 1.0, 0.5, 0.5, 10.0),  # Case 1\n        (10.0, 1.0, 1.0, 10.0, 0.2, 1.0, 10.0), # Case 2\n        (3.0, 1.0, 1.0, 3.0, 1.5, 0.0, 8.0),    # Case 3\n    ]\n\n    results = []\n    for case in test_cases:\n        kf1, kb1, kf2, kb2, DA, DB, Ntot = case\n\n        # Reduced model steady state\n        (T1_star, T2_star), (A1r, B1r, A2r, B2r), (alpha1, alpha2) = reduced_steady_state(\n            kf1, kb1, kf2, kb2, DA, DB, Ntot\n        )\n\n        # Full system steady state\n        A1, B1, A2, B2 = full_steady_state(kf1, kb1, kf2, kb2, DA, DB, Ntot)\n        T1_full = A1 + B1\n        T2_full = A2 + B2\n\n        # Comparisons\n        abs_diff_T1 = abs(T1_star - T1_full)\n        # Species-level Euclidean discrepancy\n        species_diff = np.array([A1 - A1r, B1 - B1r, A2 - A2r, B2 - B2r], dtype=float)\n        delta_species = float(np.linalg.norm(species_diff, ord=2))\n\n        # Prepare output for this case: [T1_reduced, T1_full, |diff|, species_L2]\n        results.append([T1_star, T1_full, abs_diff_T1, delta_species])\n\n    # Final print statement in the exact required format: list of lists, no spaces\n    output = \"[\" + \",\".join(format_inner_list(r) for r in results) + \"]\"\n    print(output)\n\nif __name__ == \"__main__\":\n    solve()\n```"
        }
    ]
}