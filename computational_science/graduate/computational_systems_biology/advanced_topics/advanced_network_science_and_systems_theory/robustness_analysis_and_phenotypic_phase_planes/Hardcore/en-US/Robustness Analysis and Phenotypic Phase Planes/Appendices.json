{
    "hands_on_practices": [
        {
            "introduction": "This first exercise provides a foundational walkthrough of how to construct a phenotypic phase plane from scratch. By using a minimal metabolic network, you will formalize a linear program, derive the analytical solution for optimal growth, and partition the parameter space into distinct metabolic regimes based on which nutrient is limiting. This practice  connects the abstract principles of Flux Balance Analysis directly to a visual and intuitive representation of metabolic trade-offs.",
            "id": "3346773",
            "problem": "You are given a minimal flux balance analysis (FBA) model with two exchange reactions and one biomass reaction. The goal is to formalize the linear program, analyze its parametric optimum with respect to the uptake bounds, and compute a phenotypic phase plane in the $(a,b)$ parameter space, where $a$ and $b$ are maximal uptake capacities.\n\nFundamental base:\n- At steady state, intracellular metabolite concentrations satisfy the mass balance constraint $S v = 0$, where $S$ is the stoichiometric matrix and $v$ is the vector of reaction fluxes.\n- Exchange reactions connect the system to the environment and are subject to bounds representing transport or availability limits.\n- The FBA objective is to maximize the biomass production rate.\n\nModel specification:\n- Metabolites: $A_c$, $B_c$.\n- Reactions (in the order $v_{ex,A}$, $v_{ex,B}$, $v_{bio}$):\n  1. Uptake of $A$: external source to $A_c$, represented as $v_{ex,A}$ with stoichiometry producing $A_c$.\n  2. Uptake of $B$: external source to $B_c$, represented as $v_{ex,B}$ with stoichiometry producing $B_c$.\n  3. Biomass formation: $A_c + 2 B_c \\rightarrow \\text{biomass}$, represented as $v_{bio}$ draining $A_c$ and $B_c$.\n- Stoichiometric matrix $S$ over metabolites $[A_c, B_c]$ and reactions $[v_{ex,A}, v_{ex,B}, v_{bio}]$:\n$$\nS = \\begin{bmatrix}\n1 & 0 & -1 \\\\\n0 & 1 & -2\n\\end{bmatrix}.\n$$\n- Objective: maximize $v_{bio}$, i.e., $\\max c^\\top v$ with $c = [0, 0, 1]^\\top$.\n- Bounds: $0 \\le v_{ex,A} \\le a$, $0 \\le v_{ex,B} \\le b$, and $0 \\le v_{bio} < \\infty$.\n- All fluxes are in units of millimoles per gram dry weight per hour (mmol gDW$^{-1}$ h$^{-1}$). All answers must be expressed in these units where applicable.\n\nTasks:\n1. Construct the linear program $\\max c^\\top v$ subject to $S v = 0$ and the above bounds.\n2. Determine, as a function of $(a,b)$, the phenotypic phase plane partition that characterizes which exchange bound is growth-limiting at the optimum. Your analysis must be based only on the model specification and the steady-state mass balance.\n3. Implement a program that, for each parameter pair $(a,b)$ in the test suite below, solves the linear program and outputs:\n   - The optimal biomass flux $v_{bio}^\\star(a,b)$, rounded to nine decimal places.\n   - A regime code as an integer that encodes the limiting regime at the optimum:\n     - $0$ if the upper bound on $v_{ex,A}$ is binding and the upper bound on $v_{ex,B}$ is not binding (A-limited region).\n     - $1$ if the upper bound on $v_{ex,B}$ is binding and the upper bound on $v_{ex,A}$ is not binding (B-limited region).\n     - $2$ if both upper bounds are binding (co-limited boundary).\n     - $3$ if $v_{bio}^\\star(a,b) = 0$ (no growth; this includes cases where either $a = 0$ or $b = 0$).\n   Binding and equality comparisons must be decided using a numerical tolerance $\\varepsilon = 10^{-9}$.\n\nTest suite:\n- Case $1$: $(a,b) = (10.0, 30.0)$\n- Case $2$: $(a,b) = (10.0, 15.0)$\n- Case $3$: $(a,b) = (0.0, 10.0)$\n- Case $4$: $(a,b) = (5.0, 0.0)$\n- Case $5$: $(a,b) = (8.0, 16.0)$\n- Case $6$: $(a,b) = (10^{-6}, 10^{-6})$\n- Case $7$: $(a,b) = (100.0, 1.0)$\n\nFinal output format:\n- Your program should produce a single line of output containing a flat list with entries alternating between the rounded optimal biomass flux and the regime code for each test case in order. Specifically, print\n  $[v_1^\\star,code_1,v_2^\\star,code_2,\\dots,v_7^\\star,code_7]$\n  as a comma-separated list enclosed in square brackets, where each $v_i^\\star$ is rounded to nine decimal places and each $code_i$ is an integer.",
            "solution": "The user wants to analyze a minimal Flux Balance Analysis (FBA) model and implement a program to compute its phenotypic phase plane.\n\n### 1. Problem Validation and Formalization\n\nThe problem statement provides a complete and consistent definition for a simple FBA model. It includes the stoichiometric matrix $S$, the objective function $c$, and the flux bounds, which are parameterized by variables $a$ and $b$. The tasks are clearly stated, mathematically well-defined, and grounded in standard systems biology principles. The problem is valid.\n\nThe linear program (LP) is formulated as follows:\n- **Variables**: The flux vector $v = [v_{ex,A}, v_{ex,B}, v_{bio}]^\\top$.\n- **Objective**: Maximize the biomass production rate, $v_{bio}$. This is equivalent to $\\max c^\\top v$ with $c = [0, 0, 1]^\\top$.\n- **Constraints**:\n    1.  **Steady-state mass balance**: $S v = 0$.\n    2.  **Flux bounds**:\n        -   $0 \\le v_{ex,A} \\le a$\n        -   $0 \\le v_{ex,B} \\le b$\n        -   $0 \\le v_{bio} < \\infty$\n\nGiven the stoichiometric matrix:\n$$\nS = \\begin{bmatrix}\n1 & 0 & -1 \\\\\n0 & 1 & -2\n\\end{bmatrix}\n$$\nthe mass balance constraint $S v = 0$ translates to the following system of linear equations:\n$$\n\\begin{cases}\n1 \\cdot v_{ex,A} + 0 \\cdot v_{ex,B} - 1 \\cdot v_{bio} = 0 \\\\\n0 \\cdot v_{ex,A} + 1 \\cdot v_{ex,B} - 2 \\cdot v_{bio} = 0\n\\end{cases}\n$$\nThis system implies a fixed relationship between the fluxes at steady state:\n$$\nv_{ex,A} = v_{bio}\n$$\n$$\nv_{ex,B} = 2 v_{bio}\n$$\n\n### 2. Analytical Solution and Phenotypic Phase Plane\n\nThe relationships derived from the mass balance condition allow us to express the LP solely in terms of the variable we wish to maximize, $v_{bio}$. We substitute these relationships into the flux bound constraints:\n1.  The constraint $0 \\le v_{ex,A} \\le a$ becomes $0 \\le v_{bio} \\le a$.\n2.  The constraint $0 \\le v_{ex,B} \\le b$ becomes $0 \\le 2 v_{bio} \\le b$, which simplifies to $0 \\le v_{bio} \\le \\frac{b}{2}$.\n\nTo maximize $v_{bio}$, we must satisfy both of these derived constraints simultaneously. Therefore, the optimal biomass flux $v_{bio}^\\star$ is the maximum value that satisfies both $v_{bio} \\le a$ and $v_{bio} \\le \\frac{b}{2}$. This is given by:\n$$\nv_{bio}^\\star(a,b) = \\min\\left(a, \\frac{b}{2}\\right)\n$$\n\nThe phenotypic phase plane is partitioned into regions based on which resource, $A$ or $B$, limits the growth rate. This is determined by which uptake flux's upper bound is active (or \"binding\") at the optimum. An upper bound $u_i$ for a flux $v_i$ is considered binding if the optimal flux $v_i^\\star$ is equal to $u_i$ within a numerical tolerance $\\varepsilon = 10^{-9}$. That is, $u_i - v_i^\\star \\le \\varepsilon$.\n\nThe optimal uptake fluxes are:\n-   $v_{ex,A}^\\star = v_{bio}^\\star = \\min(a, b/2)$\n-   $v_{ex,B}^\\star = 2 v_{bio}^\\star = 2 \\min(a, b/2)$\n\nThe regimes are defined as follows:\n-   **Regime 3 (No growth)**: This occurs when $v_{bio}^\\star(a,b) = 0$. With tolerance, this is checked as $v_{bio}^\\star < \\varepsilon$. This is true if $a=0$ or $b=0$.\n-   **Regime 0 (A-limited)**: The bound on $v_{ex,A}$ is binding, but the bound on $v_{ex,B}$ is not.\n    -   Binding condition: $a - v_{ex,A}^\\star \\le \\varepsilon$.\n    -   Not binding condition: $b - v_{ex,B}^\\star > \\varepsilon$.\n    This corresponds to the region where $a < b/2$.\n-   **Regime 1 (B-limited)**: The bound on $v_{ex,B}$ is binding, but the bound on $v_{ex,A}$ is not.\n    -   Binding condition: $b - v_{ex,B}^\\star \\le \\varepsilon$.\n    -   Not binding condition: $a - v_{ex,A}^\\star > \\varepsilon$.\n    This corresponds to the region where $a > b/2$.\n-   **Regime 2 (Co-limited)**: Both bounds on $v_{ex,A}$ and $v_{ex,B}$ are binding.\n    -   Binding condition: $a - v_{ex,A}^\\star \\le \\varepsilon$ AND $b - v_{ex,B}^\\star \\le \\varepsilon$.\n    This corresponds to the boundary line where $a = b/2$.\n\n### 3. Algorithmic Implementation\n\nThe program implements this analytical solution. For each test case pair $(a,b)$:\n1.  It calculates the optimal biomass flux $v_{bio}^\\star = \\min(a, b/2)$.\n2.  It first checks for the no-growth condition ($v_{bio}^\\star < \\varepsilon$) to assign regime code $3$.\n3.  If there is growth, it calculates the corresponding optimal uptake fluxes $v_{ex,A}^\\star$ and $v_{ex,B}^\\star$.\n4.  It then determines which bounds are binding by comparing the optimal fluxes to their maximum allowed values ($a$ and $b$) using the tolerance $\\varepsilon$.\n5.  Based on the combination of binding and non-binding constraints, it assigns the appropriate regime code ($0$, $1$, or $2$).\n6.  The calculated $v_{bio}^\\star$ is formatted to nine decimal places, and the result pair ($v_{bio}^\\star$, code) is appended to a list for final output.\nThis direct implementation of the binding conditions is robust and correctly partitions the $(a,b)$ parameter space.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the FBA problem for a series of test cases, determining the optimal\n    biomass flux and the limiting growth regime for each.\n    \"\"\"\n    test_cases = [\n        (10.0, 30.0),  # Case 1\n        (10.0, 15.0),  # Case 2\n        (0.0, 10.0),   # Case 3\n        (5.0, 0.0),    # Case 4\n        (8.0, 16.0),   # Case 5\n        (10**-6, 10**-6), # Case 6\n        (100.0, 1.0)   # Case 7\n    ]\n\n    epsilon = 1e-9\n    results = []\n\n    for a, b in test_cases:\n        # Step 1: Calculate the analytical solution for the optimal biomass flux.\n        # v_bio_star = min(a, b/2)\n        v_bio_star = min(a, b / 2.0)\n\n        code = -1 # Initialize with a sentinel value.\n\n        # Step 2: Determine the regime code based on the binding constraints.\n        \n        # Regime 3: No growth. This occurs if v_bio_star is effectively zero.\n        if v_bio_star < epsilon:\n            code = 3\n        else:\n            # For growth cases, determine optimal uptake fluxes.\n            # v_ex_A_star = v_bio_star\n            # v_ex_B_star = 2 * v_bio_star\n            v_ex_A_star = v_bio_star\n            v_ex_B_star = 2.0 * v_bio_star\n\n            # Determine if the upper bounds on uptake are binding.\n            # A flux is binding if its optimal value is within epsilon of its bound.\n            is_A_binding = (a - v_ex_A_star) <= epsilon\n            is_B_binding = (b - v_ex_B_star) <= epsilon\n\n            if is_A_binding and is_B_binding:\n                # Regime 2: Co-limited (both bounds are active).\n                code = 2\n            elif is_A_binding:\n                # Regime 0: A-limited (only bound 'a' is active).\n                code = 0\n            elif is_B_binding:\n                # Regime 1: B-limited (only bound 'b' is active).\n                code = 1\n            # Note: The case where neither is binding is impossible if v_bio_star > 0,\n            # as the optimum of a linear program must lie on the boundary of the\n            # feasible set.\n\n        # Step 3: Format results as required.\n        # Format the biomass flux to nine decimal places.\n        formatted_v_bio = f\"{v_bio_star:.9f}\"\n        \n        results.append(formatted_v_bio)\n        results.append(code)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Having established how phase planes are constructed, this practice delves into the mathematical properties of the boundaries between metabolic regimes. You will use numerical finite differences to investigate the sensitivity of the optimal growth rate to changes in nutrient availability, revealing the non-differentiable nature of the solution at phase boundaries. This exercise  is crucial for understanding the implications of piecewise linear solutions in biological systems and the potential pitfalls of standard sensitivity analysis methods.",
            "id": "3346751",
            "problem": "Consider a simplified Flux Balance Analysis (FBA) problem for a two-substrate toy metabolic network that captures the essence of a phenotypic phase plane. Let $v_1$ and $v_2$ denote uptake fluxes of two substrates, with upper bounds $a$ and $b$, respectively, and let $v_B$ denote the biomass production rate. Assume a steady-state linear resource allocation approximation in which the biomass rate is proportional to the uptake fluxes with yields $y_1$ and $y_2$, and a global capacity constraint $c$ on the total uptake. The optimization problem is to maximize biomass rate, subject to linear bounds and the capacity limit:\nMaximize $y_1 v_1 + y_2 v_2$ subject to $0 \\le v_1 \\le a$, $0 \\le v_2 \\le b$, and $v_1 + v_2 \\le c$. Within this model, the phenotypic phase plane in the $(a,b)$ space is piecewise linear, and there is a phase boundary at $b = c - a$ where the identity of the active constraint changes. At this boundary, the optimal biomass rate is continuous but nondifferentiable with respect to $a$ and $b$.\n\nStarting from the fundamental flux balance perspective that cellular growth at steady state can be modeled as a linear program with linear constraints derived from resource bounds and stoichiometric feasibility, and that linear programs yield piecewise linear optimal value functions as parameters vary, your task is to numerically estimate finite difference sensitivities of the optimal biomass rate $f(a,b)$ with respect to $a$ and $b$ near and across the phase boundary. Specifically, use the following well-tested setup:\n- Let $y_1 = 1.0$, $y_2 = 0.8$, and $c = 1.0$.\n- Define $f(a,b)$ as the optimal objective value of the linear program: $\\max_{v_1,v_2} \\; y_1 v_1 + y_2 v_2$ such that $0 \\le v_1 \\le a$, $0 \\le v_2 \\le b$, $v_1 + v_2 \\le c$.\n- Compute finite difference approximations to the partial derivatives $\\partial f/\\partial a$ and $\\partial f/\\partial b$ using a small step size $h = 10^{-6}$:\n  - Forward difference with respect to $a$: $\\frac{f(a+h,b) - f(a,b)}{h}$; backward difference with respect to $a$: $\\frac{f(a,b) - f(a-h,b)}{h}$; central difference with respect to $a$: $\\frac{f(a+h,b) - f(a-h,b)}{2h}$.\n  - Forward difference with respect to $b$: $\\frac{f(a,b+h) - f(a,b)}{h}$; backward difference with respect to $b$: $\\frac{f(a,b) - f(a,b-h)}{h}$; central difference with respect to $b$: $\\frac{f(a,b+h) - f(a,b-h)}{2h}$.\n\nThe program must solve the linear program for each evaluation of $f(a,b)$.\n\nExplain, in your solution narrative, how nondifferentiability at the phase boundary $b = c - a$ leads to numerical artifacts in central difference estimates, and how forward and backward differences relate to one-sided derivatives. Your implementation must compute the finite differences for the following test suite of parameter pairs $(a,b)$:\n1. $a = 0.3$, $b = 0.5$ (uptake-limited interior, $a + b < c$ and $b < c - a$).\n2. $a = 0.6$, $b = 0.5$ (capacity-limited regime with mixed allocation, $b > c - a$).\n3. $a = 0.49$, $b = 0.51$ (exactly at the phase boundary $b = c - a$).\n4. $a = 1.2$, $b = 0.8$ (one source alone saturates capacity, $a \\ge c$).\n5. $a = 0.2$, $b = 0.3$ (both uptake-limited, slack capacity, $a + b \\le c$).\n6. $a = 0.49$, $b = 0.50$ (near the boundary on the $b < c - a$ side).\n7. $a = 0.49$, $b = 0.515$ (near the boundary on the $b > c - a$ side).\n\nAll quantities are dimensionless. The program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case in the order listed above, return an inner list of seven floating-point numbers:\n$[$central-$\\partial f/\\partial a$, forward-$\\partial f/\\partial a$, backward-$\\partial f/\\partial a$, central-$\\partial f/\\partial b$, forward-$\\partial f/\\partial b$, backward-$\\partial f/\\partial b$, $f(a,b)$$]$.\nThus the final output should be a single list of seven-element lists, for the seven test cases, printed as one line, for example: $[[\\dots],[\\dots],\\dots]$.",
            "solution": "The problem statement has been validated and is scientifically sound, well-posed, and objective. It presents a simplified but canonical problem in computational systems biology, specifically Flux Balance Analysis (FBA), which is grounded in the principles of linear programming and metabolic stoichiometry. All parameters and conditions are clearly defined, permitting a unique and meaningful solution.\n\nThe core of this problem is to analyze the sensitivity of an optimal metabolic objective—biomass production—to changes in nutrient availability. This is modeled as a linear program (LP), where the optimal value is a function of the parameters defining the constraints. The task requires calculating the finite difference approximations of the partial derivatives of this optimal value function, $f(a,b)$, with respect to the nutrient uptake bounds $a$ and $b$.\n\nThe optimization problem is formulated as:\n$$\n\\text{Maximize } Z = y_1 v_1 + y_2 v_2\n$$\nsubject to the constraints:\n$$\n\\begin{align*}\n0 &\\le v_1 \\le a \\\\\n0 &\\le v_2 \\le b \\\\\nv_1 + v_2 &\\le c\n\\end{align*}\n$$\nWith the given parameters, $y_1 = 1.0$, $y_2 = 0.8$, and $c = 1.0$, the objective is to maximize $Z = 1.0 v_1 + 0.8 v_2$. The feasible region in the $(v_1, v_2)$ flux space is a convex polygon defined by the intersection of the rectangle $[0, a] \\times [0, b]$ and the half-plane $v_1 + v_2 \\le 1$.\n\nThe solution to an LP occurs at a vertex of the feasible region. The direction of maximization is given by the objective function's gradient vector, $\\nabla Z = (y_1, y_2) = (1.0, 0.8)$. Since $y_1 > y_2$, the optimization will always prioritize increasing $v_1$ over $v_2$. This allows for an analytical characterization of the optimal biomass function $f(a,b) = \\max Z$ by identifying the optimal vertex for any given pair $(a,b)$. The parameter space $(a,b)$ partitions into distinct regions, or \"phenotypic phases,\" based on which set of constraints is active at the optimum.\n\n1.  **Region I (Uptake-Limited):** If $a+b \\le c$, the total capacity constraint $v_1+v_2 \\le c$ is inactive. The optimum occurs at the vertex $(v_1^*, v_2^*) = (a, b)$, where both uptake limits are met. The optimal biomass is:\n    $$\n    f(a,b) = y_1 a + y_2 b = 1.0a + 0.8b\n    $$\n    In this region, the function is linear, and its partial derivatives are constant:\n    $$\n    \\frac{\\partial f}{\\partial a} = y_1 = 1.0, \\quad \\frac{\\partial f}{\\partial b} = y_2 = 0.8\n    $$\n\n2.  **Region II (Capacity-Limited, Mixed Uptake):** If $a+b > c$ and $a \\le c$, the optimum is limited by both the uptake of substrate $1$ ($v_1 \\le a$) and the total capacity ($v_1+v_2 = c$). To maximize the objective, we set $v_1$ to its maximum possible value, $v_1^* = a$, and thus $v_2^* = c-a$. This vertex is feasible as long as $v_2^* \\ge 0$ (i.e., $a \\le c$) and $v_2^* \\le b$ (i.e., $c-a \\le b$, or $a+b \\ge c$). The optimal biomass is:\n    $$\n    f(a,b) = y_1 a + y_2 (c-a) = (y_1 - y_2)a + y_2 c = 0.2a + 0.8\n    $$\n    In this region, the optimal value depends only on $a$ and $c$, not $b$. The partial derivatives are:\n    $$\n    \\frac{\\partial f}{\\partial a} = y_1 - y_2 = 0.2, \\quad \\frac{\\partial f}{\\partial b} = 0\n    $$\n\n3.  **Region III (Capacity-Limited, Single Substrate):** If $a > c$, the bound $v_1 \\le a$ is redundant. The feasible region for $v_1$ is $[0, c]$. To maximize $Z$, we take the largest possible $v_1$, which is $v_1^*=c$, leaving $v_2^*=0$. The optimal biomass is constant:\n    $$\n    f(a,b) = y_1 c = 1.0\n    $$\n    The partial derivatives are both zero:\n    $$\n    \\frac{\\partial f}{\\partial a} = 0, \\quad \\frac{\\partial f}{\\partial b} = 0\n    $$\n\nThe line $a+b=c$ constitutes a **phenotypic phase boundary**. As parameters $(a,b)$ cross this line, the identity of the active constraints at the optimum changes, leading to a change in the analytical form of $f(a,b)$. While the function $f(a,b)$ is continuous across this boundary, its partial derivatives are not. This is the definition of nondifferentiability. At any point on the line $a+b=c$, the gradient $\\nabla f$ is undefined.\n\nThis nondifferentiability has a predictable effect on numerical differentiation:\n-   A **forward difference** derivative, e.g., $(f(a+h, b) - f(a,b))/h$, probes the function's behavior to the \"right\" of the point. At the boundary, if a step in $a$ moves into Region II, this will estimate the right-sided derivative, which is $\\partial f_{II}/\\partial a = 0.2$.\n-   A **backward difference**, $(f(a, b) - f(a-h,b))/h$, probes to the \"left\". If a step back in $a$ moves into Region I, this will estimate the left-sided derivative, $\\partial f_{I}/\\partial a = 1.0$.\n-   A **central difference**, $(f(a+h, b) - f(a-h,b))/(2h)$, straddles the point of nondifferentiability. It effectively averages the slopes on both sides, yielding a value that is not representative of the derivative on either side but rather an interpolation. For $\\partial f/\\partial a$ at the boundary, it will approximate $(1.0 + 0.2)/2 = 0.6$.\n\nThe implementation will solve the specified LP for each required evaluation of $f(a,b)$ using `scipy.optimize.linprog`. For each test case $(a,b)$, we compute $f$ at $(a,b)$, $(a \\pm h, b)$, and $(a, b \\pm h)$ with $h = 10^{-6}$. From these values, we calculate the forward, backward, and central difference approximations for the partial derivatives with respect to $a$ and $b$, and report these along with the objective value $f(a,b)$.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves the FBA sensitivity analysis problem for a suite of test cases.\n    \"\"\"\n    \n    # Define constants from the problem statement\n    y1 = 1.0\n    y2 = 0.8\n    c_cap = 1.0\n    h = 1e-6\n\n    # Test cases for parameter pairs (a, b)\n    test_cases = [\n        (0.3, 0.5),    # Case 1: Uptake-limited interior\n        (0.6, 0.5),    # Case 2: Capacity-limited, mixed allocation\n        (0.49, 0.51),  # Case 3: Exactly at the phase boundary\n        (1.2, 0.8),    # Case 4: Substrate 1 saturates capacity\n        (0.2, 0.3),    # Case 5: Both uptake-limited, slack capacity\n        (0.49, 0.50),  # Case 6: Near boundary, uptake-limited side\n        (0.49, 0.515), # Case 7: Near boundary, capacity-limited side\n    ]\n\n    # Pre-compile LP parameters that do not change\n    c_obj = np.array([-y1, -y2])\n    A_ub = np.array([[1, 1]])\n    b_ub = np.array([c_cap])\n\n    memo = {}\n\n    def f_objective(a, b):\n        \"\"\"\n        Solves the LP to find the maximum biomass rate f(a,b).\n        Uses memoization to avoid re-computing for the same (a,b) tuple.\n        \"\"\"\n        if (a, b) in memo:\n            return memo[(a, b)]\n\n        bounds = ((0, a), (0, b))\n        \n        # Method 'highs-ds' is the default in recent SciPy versions and is robust.\n        res = linprog(c=c_obj, A_ub=A_ub, b_ub=b_ub, bounds=bounds, method='highs-ds')\n\n        if not res.success:\n            # This should not happen for this well-behaved LP\n            # Fallback or error for robustness in a real application\n            # For this problem, we can assume success\n            raise RuntimeError(f\"LP solver failed for a={a}, b={b}. Message: {res.message}\")\n        \n        # linprog minimizes, so we negate the result to get the maximum\n        result = -res.fun\n        memo[(a, b)] = result\n        return result\n\n    final_results = []\n    for a, b in test_cases:\n        # Evaluate the function at the center point and neighboring points\n        f_center = f_objective(a, b)\n        f_a_plus = f_objective(a + h, b)\n        f_a_minus = f_objective(a - h, b)\n        f_b_plus = f_objective(a, b + h)\n        f_b_minus = f_objective(a, b - h)\n\n        # Calculate finite differences for partial derivative w.r.t. 'a'\n        central_da = (f_a_plus - f_a_minus) / (2 * h)\n        forward_da = (f_a_plus - f_center) / h\n        backward_da = (f_center - f_a_minus) / h\n\n        # Calculate finite differences for partial derivative w.r.t. 'b'\n        central_db = (f_b_plus - f_b_minus) / (2 * h)\n        forward_db = (f_b_plus - f_center) / h\n        backward_db = (f_center - f_b_minus) / h\n\n        # Assemble the result list for the current test case\n        case_results = [\n            central_da, forward_da, backward_da,\n            central_db, forward_db, backward_db,\n            f_center\n        ]\n        final_results.append(case_results)\n\n    # Format the final output string to match the required format `[[...],[...],...]`\n    # without any whitespace.\n    output_str = str(final_results).replace(\" \", \"\")\n    print(output_str)\n\nsolve()\n```"
        },
        {
            "introduction": "This final practice demonstrates how to apply the phase plane concept to answer a quantitative biological question about system robustness. You will define a region of \"overflow metabolism\" within the phase plane and calculate its area, providing a concrete measure of the system's propensity for this phenotype. This exercise  bridges the gap between the geometric representation of metabolic strategies and the quantification of emergent biological properties.",
            "id": "3346780",
            "problem": "Consider a coarse-grained metabolic model of a single-celled organism exhibiting overflow metabolism. The organism assimilates glucose and oxygen to produce biomass via two lumped pathways: a respiratory pathway and a fermentative pathway that secretes acetate. The Phenotypic Phase Plane (PPP) spans the rectangular domain of glucose uptake and oxygen uptake, denoted by $(a,b)$ with $a \\in [0,A_{\\max}]$ and $b \\in [0,B_{\\max}]$, where $a$ and $b$ are fluxes measured in millimoles per gram dry weight per hour (mmol gDW$^{-1}$ h$^{-1}$). Overflow is defined operationally as the production of acetate, and robustness is quantified as the area within this PPP domain where acetate secretion is strictly positive.\n\nAssume the following coarse-grained flux variables: $v_{R}$ for the respiratory pathway, $v_{F}$ for the fermentative pathway, and $v_{\\text{Ac}}$ for any acetate-wasting pathway (which produces acetate without biomass). The respiratory pathway requires oxygen with stoichiometric requirement $r_{o}$ (mmol O$_2$ per mmol glucose respired). Biomass yields are $y_{R}$ (for respiration) and $y_{F}$ (for fermentation), with $y_{R} > y_{F} > 0$. The maximum respiratory capacity imposes $v_{R} \\leq R_{\\max}$. Glucose uptake satisfies the allocation constraint $v_{R} + v_{F} + v_{\\text{Ac}} = a$, and oxygen uptake satisfies $r_{o} \\, v_{R} \\leq b$. The organism maximizes biomass production subject to these constraints, and acetate secretion is given by a positive proportionality to $v_{F}$ (since fermentative flux secretes acetate) and possibly $v_{\\text{Ac}}$ (which does not increase biomass and therefore is not used under a biomass-maximizing objective).\n\nStarting from these definitions and constraints, acetate secretion is strictly positive if and only if fermentative flux $v_{F}$ is strictly positive under the biomass-maximizing allocation of $a$ and $b$ given $R_{\\max}$. The robustness to overflow is quantified by the Lebesgue measure (area) of the set $\\{(a,b) \\in [0,A_{\\max}] \\times [0,B_{\\max}] : v_{F}(a,b; R_{\\max}) > 0\\}$, expressed in $(\\text{mmol gDW}^{-1} \\text{ h}^{-1})^{2}$.\n\nYour task is to write a complete, runnable program that, for a specified set of parameters, computes the robustness (area of the acetate-producing region) in the $(a,b)$ plane and reports how this area changes with variations in the maximum respiratory capacity $R_{\\max}$. You must adhere to the following requirements:\n\n- Use the fundamental constraints and logic described above, without introducing any additional shortcut formulas beyond what follows from the biomass-maximizing allocation.\n- Parameters to use are $A_{\\max} = 10$ mmol gDW$^{-1}$ h$^{-1}$, $B_{\\max} = 10$ mmol gDW$^{-1}$ h$^{-1}$, and $r_{o} = 2$ mmol O$_2$ per mmol glucose respired. Biomass yields satisfy $y_{R} > y_{F} > 0$ but do not otherwise affect the acetate condition, provided the organism maximizes biomass.\n- The program must compute the area of the acetate-producing region using mathematically justified reasoning that follows from the constraints and the biomass-maximizing objective.\n- Express the final areas in $(\\text{mmol gDW}^{-1} \\text{ h}^{-1})^{2}$ as real numbers (floats).\n- Test Suite:\n    1. $R_{\\max} = 0.0$ mmol gDW$^{-1}$ h$^{-1}$ (boundary case of zero respiratory capacity).\n    2. $R_{\\max} = 1.0$ mmol gDW$^{-1}$ h$^{-1}$ (low capacity).\n    3. $R_{\\max} = 2.5$ mmol gDW$^{-1}$ h$^{-1}$ (moderate capacity).\n    4. $R_{\\max} = 10.0$ mmol gDW$^{-1}$ h$^{-1}$ (high capacity).\n- Final Output Format: Your program should produce a single line of output containing the areas for the four test cases as a comma-separated list enclosed in square brackets, for example, \"[area1,area2,area3,area4]\". Each area must be a float.\n\nThe solution must be scientifically sound and derived from the core constraints and objective. No external inputs are provided to your program, and it must run deterministically as-is.",
            "solution": "The user has provided a scientifically sound and well-posed problem statement from the field of computational systems biology. The problem is validated as follows:\n- **Givens Extraction**:\n  - Domain of analysis: Phenotypic Phase Plane (PPP), a rectangle defined by glucose uptake flux $a \\in [0,A_{\\max}]$ and oxygen uptake flux $b \\in [0,B_{\\max}]$.\n  - Problem variables: respiratory flux $v_{R}$, fermentative flux $v_{F}$, and acetate-wasting flux $v_{\\text{Ac}}$.\n  - Objective: The organism maximizes its biomass production rate.\n  - Constraints:\n    1. Glucose balance: $v_{R} + v_{F} + v_{\\text{Ac}} = a$.\n    2. Oxygen balance: $r_{o} \\, v_{R} \\leq b$, where $r_{o}$ is the stoichiometric coefficient.\n    3. Respiratory capacity: $v_{R} \\leq R_{\\max}$.\n    4. Non-negativity: $v_{R} \\geq 0$, $v_{F} \\geq 0$, $v_{\\text{Ac}} \\geq 0$.\n  - Biomass production: The total biomass flux is a linear combination of pathway fluxes, $\\mu = y_{R}v_{R} + y_{F}v_{F}$, with yields satisfying $y_{R} > y_{F} > 0$. The flux $v_{\\text{Ac}}$ does not contribute to biomass.\n  - Acetate production condition: Acetate secretion is strictly positive if and only if $v_{F} > 0$.\n  - Robustness measure: Area of the region in the PPP where $v_{F} > 0$.\n  - Parameters: $A_{\\max} = 10$, $B_{\\max} = 10$, $r_{o} = 2$.\n  - Test cases: $R_{\\max} \\in \\{0.0, 1.0, 2.5, 10.0\\}$.\n\n- **Validation**: The problem is scientifically grounded in metabolic modeling, well-posed with a clear objective and constraints, and formulated with objective, precise language. The statement that biomass yields $y_R$ and $y_F$ do not affect the condition for acetate secretion (beyond $y_R > y_F$) is correct, as maximizing biomass under this condition is equivalent to maximizing the flux through the higher-yield pathway, $v_R$. All parameters are physically consistent. The problem is therefore valid.\n\nThe solution proceeds by first deriving the condition for acetate secretion and then calculating the area of the corresponding region in the $(a,b)$ plane.\n\n**Step 1: Derivation of the Optimal Flux Distribution**\nThe objective is to maximize the biomass production rate, $\\mu = y_{R}v_{R} + y_{F}v_{F}$. The acetate-wasting pathway, $v_{\\text{Ac}}$, does not produce biomass and consumes the glucose substrate; therefore, under a biomass-maximization objective, its flux will be zero ($v_{\\text{Ac}} = 0$). The glucose balance constraint simplifies to $v_{R} + v_{F} = a$. We can express $v_{F}$ as $v_{F} = a - v_{R}$ and substitute it into the objective function:\n$$ \\mu = y_{R}v_{R} + y_{F}(a - v_{R}) = (y_{R} - y_{F})v_{R} + y_{F}a $$\nGiven that $y_{R} > y_{F}$, the term $(y_{R} - y_{F})$ is positive. For a fixed glucose uptake $a$, maximizing $\\mu$ is equivalent to maximizing the respiratory flux $v_{R}$.\n\nThe organism will therefore choose the largest possible value for $v_{R}$ that is consistent with all constraints. The constraints on $v_{R}$ are:\n1. $v_{R} \\geq 0$ (Non-negativity)\n2. From $v_{F} = a - v_{R} \\geq 0$, we have $v_{R} \\leq a$.\n3. $v_{R} \\leq R_{\\max}$ (Respiratory capacity)\n4. $r_{o} v_{R} \\leq b$, which implies $v_{R} \\leq \\frac{b}{r_{o}}$ (Oxygen availability)\n\nCombining these, the optimal respiratory flux, $v_{R}^{\\text{opt}}$, is the maximum value satisfying all upper bounds:\n$$ v_{R}^{\\text{opt}}(a, b) = \\min\\left(a, R_{\\max}, \\frac{b}{r_{o}}\\right) $$\nThe corresponding optimal fermentative flux is $v_{F}^{\\text{opt}} = a - v_{R}^{\\text{opt}}$.\n\n**Step 2: Condition for Acetate Secretion**\nAcetate secretion occurs when $v_{F}^{\\text{opt}} > 0$. This implies:\n$$ a - v_{R}^{\\text{opt}} > 0 \\implies a > v_{R}^{\\text{opt}} $$\nSubstituting the expression for $v_{R}^{\\text{opt}}$:\n$$ a > \\min\\left(a, R_{\\max}, \\frac{b}{r_{o}}\\right) $$\nSince $a$ is one of the arguments of the $\\min$ function, the minimum value can never be strictly greater than $a$. The strict inequality holds if and only if one of the other arguments is strictly smaller than $a$. Thus, the condition for acetate secretion ($v_F > 0$) simplifies to:\n$$ a > R_{\\max} \\quad \\lor \\quad a > \\frac{b}{r_{o}} $$\n\n**Step 3: Calculating the Robustness (Area of Acetate Secretion)**\nThe robustness is the area of the acetate-secreting region within the domain $[0, A_{\\max}] \\times [0, B_{\\max}]$. It is simpler to first calculate the area of the complementary region—where no acetate is secreted ($v_{F} = 0$)—and subtract it from the total area of the domain, which is $A_{\\max}B_{\\max}$.\n\nThe condition for no acetate secretion is the negation of the condition for secretion:\n$$_F = 0 \\iff \\neg \\left( a > R_{\\max} \\lor a > \\frac{b}{r_{o}} \\right) \\iff a \\leq R_{\\max} \\land a \\leq \\frac{b}{r_{o}} $$\nThe second inequality can be rewritten as $b \\geq a \\cdot r_{o}$. So, the region of no acetate secretion is the set of points $(a,b)$ in the domain $[0, A_{\\max}] \\times [0, B_{\\max}]$ that satisfy:\n1. $a \\leq R_{\\max}$\n2. $b \\geq a \\cdot r_{o}$\n\nThe area of this non-secreting region, $\\mathcal{A}_{\\text{no-acetate}}$, is given by the integral over the sub-domain defined by these inequalities. The integration bounds for $a$ are from $0$ to $\\min(A_{\\max}, R_{\\max})$. The bounds for $b$ are from $a \\cdot r_{o}$ to $B_{\\max}$. The region is non-empty only if the lower bound for $b$ does not exceed the upper bound, i.e., $a \\cdot r_{o} \\leq B_{\\max}$, or $a \\leq B_{\\max}/r_{o}$.\nTherefore, the effective upper limit for the integration over $a$ is $a_{\\text{lim}} = \\min(A_{\\max}, R_{\\max}, B_{\\max}/r_{o})$.\n\nThe area is calculated by the integral:\n$$ \\mathcal{A}_{\\text{no-acetate}} = \\int_{0}^{a_{\\text{lim}}} \\left( \\int_{a \\cdot r_{o}}^{B_{\\max}} db \\right) da = \\int_{0}^{a_{\\text{lim}}} (B_{\\max} - a \\cdot r_{o}) \\, da $$\nEvaluating the integral gives:\n$$ \\mathcal{A}_{\\text{no-acetate}} = \\left[ B_{\\max} a - \\frac{1}{2} r_{o} a^2 \\right]_0^{a_{\\text{lim}}} = B_{\\max} a_{\\text{lim}} - \\frac{1}{2} r_{o} a_{\\text{lim}}^2 $$\nThe robustness, which is the area of the acetate-producing region, is then:\n$$ \\mathcal{A}_{\\text{robustness}} = (A_{\\max} B_{\\max}) - \\mathcal{A}_{\\text{no-acetate}} $$\n\n**Step 4: Computation for Test Cases**\nWe use the given parameters: $A_{\\max}=10$, $B_{\\max}=10$, $r_{o}=2$.\nThe total area of the PPP is $10 \\times 10 = 100$.\nThe upper limit for the integral is $a_{\\text{lim}} = \\min(10, R_{\\max}, 10/2) = \\min(R_{\\max}, 5)$.\nThe area of the non-secreting region is $\\mathcal{A}_{\\text{no-acetate}} = 10 \\cdot a_{\\text{lim}} - \\frac{1}{2}(2) a_{\\text{lim}}^2 = 10 a_{\\text{lim}} - a_{\\text{lim}}^2$.\nThe robustness is $\\mathcal{A}_{\\text{robustness}} = 100 - (10 a_{\\text{lim}} - a_{\\text{lim}}^2)$.\n\n1.  **$R_{\\max} = 0.0$**:\n    $a_{\\text{lim}} = \\min(0.0, 5) = 0.0$.\n    $\\mathcal{A}_{\\text{no-acetate}} = 10(0.0) - (0.0)^2 = 0.0$.\n    $\\mathcal{A}_{\\text{robustness}} = 100.0 - 0.0 = 100.0$.\n\n2.  **$R_{\\max} = 1.0$**:\n    $a_{\\text{lim}} = \\min(1.0, 5) = 1.0$.\n    $\\mathcal{A}_{\\text{no-acetate}} = 10(1.0) - (1.0)^2 = 9.0$.\n    $\\mathcal{A}_{\\text{robustness}} = 100.0 - 9.0 = 91.0$.\n\n3.  **$R_{\\max} = 2.5$**:\n    $a_{\\text{lim}} = \\min(2.5, 5) = 2.5$.\n    $\\mathcal{A}_{\\text{no-acetate}} = 10(2.5) - (2.5)^2 = 25.0 - 6.25 = 18.75$.\n    $\\mathcal{A}_{\\text{robustness}} = 100.0 - 18.75 = 81.25$.\n\n4.  **$R_{\\max} = 10.0$**:\n    $a_{\\text{lim}} = \\min(10.0, 5) = 5.0$.\n    $\\mathcal{A}_{\\text{no-acetate}} = 10(5.0) - (5.0)^2 = 50.0 - 25.0 = 25.0$.\n    $\\mathcal{A}_{\\text{robustness}} = 100.0 - 25.0 = 75.0$.\n\nThese calculations are implemented in the following program.",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the robustness to overflow metabolism for different respiratory capacities.\n\n    The robustness is defined as the area of the region in the Phenotypic Phase Plane (PPP)\n    where acetate secretion is strictly positive. The PPP is the space of glucose uptake (a)\n    and oxygen uptake (b).\n\n    The derivation shows that the area of the non-secreting region is given by:\n    Area_no_acetate = B_max * a_lim - 0.5 * r_o * a_lim^2\n    where a_lim = min(A_max, R_max, B_max / r_o).\n\n    The robustness area is then TotalArea - Area_no_acetate.\n    \"\"\"\n    # Define the parameters from the problem statement.\n    A_max = 10.0  # mmol gDW^-1 h^-1\n    B_max = 10.0  # mmol gDW^-1 h^-1\n    r_o = 2.0     # mmol O2 per mmol glucose\n    \n    # Test cases for maximum respiratory capacity.\n    test_cases_R_max = [0.0, 1.0, 2.5, 10.0]\n\n    results = []\n    \n    # Total area of the Phenotypic Phase Plane domain.\n    total_area = A_max * B_max\n    \n    # Pre-calculate the limit imposed by oxygen availability.\n    oxygen_limit_on_a = B_max / r_o\n\n    for R_max in test_cases_R_max:\n        # Determine the effective upper limit for 'a' in the non-secreting region.\n        # This limit is the minimum of the maximum glucose uptake, the respiratory capacity,\n        # and the constraint imposed by maximum oxygen uptake.\n        a_lim = np.min([A_max, R_max, oxygen_limit_on_a])\n        \n        # Calculate the area of the region where NO acetate is secreted.\n        # This corresponds to the region where metabolism is purely respiratory.\n        # Formula: B_max * a_lim - 0.5 * r_o * a_lim^2\n        area_no_acetate = B_max * a_lim - 0.5 * r_o * (a_lim ** 2)\n        \n        # The robustness is the area of the total domain minus the non-secreting area.\n        robustness_area = total_area - area_no_acetate\n        \n        results.append(robustness_area)\n\n    # Format the output as a comma-separated list of floats inside square brackets.\n    output_str = f\"[{','.join(map(str, results))}]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}