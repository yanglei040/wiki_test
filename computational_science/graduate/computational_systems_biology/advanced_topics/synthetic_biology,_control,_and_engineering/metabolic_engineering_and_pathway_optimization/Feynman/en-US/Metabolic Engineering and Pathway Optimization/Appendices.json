{
    "hands_on_practices": [
        {
            "introduction": "Flux Balance Analysis (FBA) is a cornerstone of computational systems biology, allowing us to predict metabolic capabilities based on network stoichiometry. This first practice provides a foundational exercise in FBA, stripping the method down to its essential components. By manually solving for the optimal flux distribution in a simple linear pathway, you will gain a concrete understanding of how the steady-state assumption, represented by the equation $S v = 0$, constrains the solution space and directly determines the maximum achievable yield of a target product .",
            "id": "3325736",
            "problem": "Consider a minimal pathway optimization scenario in computational systems biology for metabolic engineering, modeled using Flux Balance Analysis (FBA). A pathway involves two intracellular metabolites and three irreversible reactions arranged in series. The network is represented by a stoichiometric matrix $S$ that encodes mass conservation at steady state. The flux vector is $v \\in \\mathbb{R}^{3}$ with components $v_1$, $v_2$, and $v_3$ corresponding to three reactions. The system is operated at steady state, so metabolite accumulation is zero and the intracellular fluxes satisfy $S v = 0$.\n\nYou are given the stoichiometric matrix\n$$\nS=\\begin{bmatrix}\n-1  1  0 \\\\\n0  -1  1\n\\end{bmatrix},\n$$\nflux bounds $0 \\leq v_i \\leq 10$ for each $i \\in \\{1,2,3\\}$, and the linear objective vector $c=(0,0,1)$ that encodes the engineering target of maximizing the flux through reaction $3$ (for instance, the synthesis or export of a desired product). Assume all reactions are irreversible (thermodynamically constrained to nonnegative fluxes) and there are no additional constraints beyond the stated bounds and steady-state mass balance.\n\nFormulate and solve the FBA optimization problem of maximizing $c^{\\top} v$ subject to $S v = 0$ and the given bounds. Determine the optimal objective value $\\max c^{\\top} v$. Express the final answer in $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$. No rounding is necessary; report the exact value.",
            "solution": "The problem posed is a standard application of Flux Balance Analysis (FBA), which is a mathematical method used to predict metabolic flux distributions. The problem is a linear program, which can be formally stated as follows:\n\nMaximize:\n$$z = c^{\\top} v$$\nSubject to:\n$$S v = 0$$\n$$v_{lb} \\leq v \\leq v_{ub}$$\n\nHere, we are given the specific components for this problem. The flux vector is $v = \\begin{pmatrix} v_1 \\\\ v_2 \\\\ v_3 \\end{pmatrix}$. The stoichiometric matrix is given as:\n$$\nS=\\begin{bmatrix}\n-1  1  0 \\\\\n0  -1  1\n\\end{bmatrix}\n$$\nThe objective vector is $c = \\begin{pmatrix} 0 \\\\ 0 \\\\ 1 \\end{pmatrix}$, which means the objective function to maximize is $z = c^{\\top} v = (0)v_1 + (0)v_2 + (1)v_3 = v_3$.\n\nThe flux bounds are given as $0 \\leq v_i \\leq 10$ for each flux $v_i$, where $i \\in \\{1, 2, 3\\}$. This can be written as lower bounds $v_{lb} = \\begin{pmatrix} 0 \\\\ 0 \\\\ 0 \\end{pmatrix}$ and upper bounds $v_{ub} = \\begin{pmatrix} 10 \\\\ 10 \\\\ 10 \\end{pmatrix}$.\n\nFirst, we analyze the steady-state mass balance constraint, $S v = 0$. This matrix equation expands into a system of linear equations:\n$$\n\\begin{bmatrix}\n-1  1  0 \\\\\n0  -1  1\n\\end{bmatrix}\n\\begin{pmatrix}\nv_1 \\\\\nv_2 \\\\\nv_3\n\\end{pmatrix}\n=\n\\begin{pmatrix}\n0 \\\\\n0\n\\end{pmatrix}\n$$\n\nThis system corresponds to two equations:\nEquation 1: $(-1)v_1 + (1)v_2 + (0)v_3 = 0 \\implies -v_1 + v_2 = 0 \\implies v_1 = v_2$.\nEquation 2: $(0)v_1 + (-1)v_2 + (1)v_3 = 0 \\implies -v_2 + v_3 = 0 \\implies v_2 = v_3$.\n\nCombining these two results, we find that the steady-state condition imposes the following relationship between the fluxes:\n$$v_1 = v_2 = v_3$$\nThis is the expected outcome for a simple linear pathway operating at steady state, where the flux must be conserved through each step of the pathway. Let us define a common flux variable $v_c$ such that $v_c = v_1 = v_2 = v_3$.\n\nNow we can reformulate the optimization problem in terms of this single variable $v_c$. The objective is to maximize $v_3$, which is equivalent to maximizing $v_c$.\nThe constraints on the individual fluxes must all be satisfied. We substitute $v_c$ into the flux bounds:\n1. For $v_1$: $0 \\leq v_1 \\leq 10 \\implies 0 \\leq v_c \\leq 10$.\n2. For $v_2$: $0 \\leq v_2 \\leq 10 \\implies 0 \\leq v_c \\leq 10$.\n3. For $v_3$: $0 \\leq v_3 \\leq 10 \\implies 0 \\leq v_c \\leq 10$.\n\nAll three constraints are identical. The problem is thus reduced to finding the maximum value of $v_c$ that satisfies the condition $0 \\leq v_c \\leq 10$.\nThe optimization problem simplifies to:\nMaximize: $v_c$\nSubject to: $0 \\leq v_c \\leq 10$.\n\nThe maximum value of $v_c$ that satisfies this inequality is clearly $10$.\nThe optimal objective value is the maximum value of $z = v_3$. Since $v_3 = v_c$, the maximum value is:\n$$\\max(z) = \\max(v_3) = \\max(v_c) = 10$$\nThe optimal flux distribution is $v_{opt} = \\begin{pmatrix} v_1 \\\\ v_2 \\\\ v_3 \\end{pmatrix} = \\begin{pmatrix} 10 \\\\ 10 \\\\ 10 \\end{pmatrix}$. We can verify that this solution satisfies all constraints:\n$S v_{opt} = \\begin{bmatrix} -1  1  0 \\\\ 0  -1  1 \\end{bmatrix} \\begin{pmatrix} 10 \\\\ 10 \\\\ 10 \\end{pmatrix} = \\begin{pmatrix} -10+10 \\\\ -10+10 \\end{pmatrix} = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$. The steady-state condition is met.\nThe bounds $0 \\leq 10 \\leq 10$ are also met.\nThe objective value is $c^{\\top} v_{opt} = v_3 = 10$.\n\nThe problem phrasing requests the answer in units of $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$. Since the problem is defined with dimensionless numbers, we assume the flux values and bounds are given in these units. Therefore, the optimal objective value is $10$ in the specified units.",
            "answer": "$$\\boxed{10}$$"
        },
        {
            "introduction": "While FBA can identify an optimal metabolic state, it often masks the underlying flexibility inherent in complex biological networks. This practice introduces Flux Variability Analysis (FVA), a powerful technique to explore the full range of achievable fluxes for each reaction while the primary biological objective remains optimal. By implementing FVA for several small networks, you will learn how phenomena like parallel pathways create a solution space rather than a single point, providing crucial insights into metabolic robustness and alternative optimal states .",
            "id": "3325767",
            "problem": "Consider a steady-state metabolic network represented by a stoichiometric matrix $S \\in \\mathbb{R}^{m \\times n}$, a flux vector $v \\in \\mathbb{R}^n$, and lower and upper bounds on reaction fluxes given by $l \\in \\mathbb{R}^n$ and $u \\in \\mathbb{R}^n$. The steady-state assumption imposes the mass balance constraints $S v = 0$. Reaction bounds impose $l_i \\le v_i \\le u_i$ for all $i \\in \\{1,\\dots,n\\}$. Flux Balance Analysis (FBA) seeks to maximize a linear objective function $c^\\top v$ under these constraints. Flux Variability Analysis (FVA) at optimality seeks the range of each reaction flux while the objective is fixed at its optimal value, by solving two linear programs: one minimizing $v_j$ and one maximizing $v_j$ subject to $S v = 0$, $l \\le v \\le u$, and $c^\\top v = c^\\top v^\\star$, where $v^\\star$ solves the original FBA.\n\nAll fluxes must be expressed in millimoles per gram dry weight per hour (mmol\\,gDW$^{-1}$\\,h$^{-1}$). Your program must compute FVA ranges at optimality for one specified reaction in each test case and print the results rounded to three decimals, without printing the unit symbol.\n\nUse the following test suite, which employs physically plausible, low-dimensional networks to test different facets including a unique optimum, alternative parallel pathways that induce variability, and an upper-bound-limited optimum:\n\n- Test case $1$ (unique optimum): $S = \\begin{bmatrix} -1  1  0 \\\\ -1  0  1 \\end{bmatrix}$, bounds $0 \\le v_i \\le 10$ for all $i \\in \\{1,2,3\\}$, objective $\\max v_3$ (that is, $c = (0,0,1)$), and compute the FVA range for $v_2$ at optimality.\n- Test case $2$ (parallel pathways induce variability): $S = \\begin{bmatrix} 1  -1  0  -1 \\\\ 0  1  -1  1 \\end{bmatrix}$, bounds $0 \\le v_i \\le 10$ for all $i \\in \\{1,2,3,4\\}$, objective $\\max v_3$ (that is, $c = (0,0,1,0)$), and compute the FVA range for $v_2$ at optimality.\n- Test case $3$ (upper-bound-limited optimum): $S = \\begin{bmatrix} -1  1  0 \\\\ -1  0  1 \\end{bmatrix}$, bounds $0 \\le v_1 \\le 10$, $0 \\le v_2 \\le 10$, $0 \\le v_3 \\le 5$, objective $\\max v_3$ (that is, $c = (0,0,1)$), and compute the FVA range for $v_2$ at optimality.\n\nIn all cases, treat reactions as irreversible within the stated bounds. Explicitly, the general FBA problem is:\n$$\n\\begin{aligned}\n\\text{maximize} \\quad  c^\\top v \\\\\n\\text{subject to} \\quad  S v = 0, \\\\\n l \\le v \\le u.\n\\end{aligned}\n$$\nGiven the optimal value $c^\\top v^\\star$, the FVA range for index $j$ is computed by solving:\n$$\n\\begin{aligned}\n\\text{minimize} \\quad  v_j \\\\\n\\text{subject to} \\quad  S v = 0, \\\\\n l \\le v \\le u, \\\\\n c^\\top v = c^\\top v^\\star,\n\\end{aligned}\n$$\nand\n$$\n\\begin{aligned}\n\\text{maximize} \\quad  v_j \\\\\n\\text{subject to} \\quad  S v = 0, \\\\\n l \\le v \\le u, \\\\\n c^\\top v = c^\\top v^\\star.\n\\end{aligned}\n$$\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is a two-element list $[v_j^{\\min}, v_j^{\\max}]$ for the corresponding test case. For example, the output format must be exactly like $[[a_1,b_1],[a_2,b_2],[a_3,b_3]]$, where each $a_k$ and $b_k$ are floats rounded to three decimals in mmol\\,gDW$^{-1}$\\,h$^{-1}$.",
            "solution": "The problem statement is subjected to a rigorous validation process before a solution is attempted.\n\n### Step 1: Extract Givens\nThe problem provides the following information:\n- A steady-state metabolic network is described by a stoichiometric matrix $S \\in \\mathbb{R}^{m \\times n}$ and a flux vector $v \\in \\mathbb{R}^n$.\n- Mass balance constraints are given by $S v = 0$.\n- Flux bounds are given by $l \\le v \\le u$, where $l, u \\in \\mathbb{R}^n$.\n- Flux Balance Analysis (FBA) is defined as the optimization problem:\n$$\n\\begin{aligned}\n\\text{maximize} \\quad  c^\\top v \\\\\n\\text{subject to} \\quad  S v = 0, \\\\\n l \\le v \\le u.\n\\end{aligned}\n$$\n- Flux Variability Analysis (FVA) at optimality for a flux $v_j$ is defined by finding the minimum and maximum of $v_j$ subject to the FBA constraints plus the additional constraint that the objective function equals its optimal value, $c^\\top v = c^\\top v^\\star$.\n- All fluxes are in units of mmol\\,gDW$^{-1}$\\,h$^{-1}$.\n- Test Case 1: $S = \\begin{bmatrix} -1  1  0 \\\\ -1  0  1 \\end{bmatrix}$, bounds $0 \\le v_i \\le 10$ for $i \\in \\{1,2,3\\}$, objective $c = (0,0,1)^\\top$ (maximize $v_3$), FVA for $v_2$.\n- Test Case 2: $S = \\begin{bmatrix} 1  -1  0  -1 \\\\ 0  1  -1  1 \\end{bmatrix}$, bounds $0 \\le v_i \\le 10$ for $i \\in \\{1,2,3,4\\}$, objective $c = (0,0,1,0)^\\top$ (maximize $v_3$), FVA for $v_2$.\n- Test Case 3: $S = \\begin{bmatrix} -1  1  0 \\\\ -1  0  1 \\end{bmatrix}$, bounds $0 \\le v_1 \\le 10$, $0 \\le v_2 \\le 10$, $0 \\le v_3 \\le 5$, objective $c = (0,0,1)^\\top$ (maximize $v_3$), FVA for $v_2$.\n- The output format is specified as a single line containing a comma-separated list of two-element lists, e.g., $[[a_1,b_1],[a_2,b_2],[a_3,b_3]]$, with numbers rounded to three decimal places.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is assessed against the validation criteria.\n- **Scientifically Grounded**: The problem is based on Flux Balance Analysis and Flux Variability Analysis, which are standard, well-established techniques in computational systems biology and metabolic engineering. The underlying principle is the conservation of mass in a biochemical reaction network at steady state, a fundamental concept in physical chemistry and biology. The problem is scientifically sound.\n- **Well-Posed**: The problem requires solving a series of linear programs (LPs). For a given set of constraints, an LP is well-posed: it either has an optimal solution, is unbounded, or is infeasible. The constraints provided (bounded flux variables) ensure that the solution space is a convex polytope, guaranteeing that the objective function will have a finite optimum. The problem is well-posed.\n- **Objective**: The problem is stated using precise mathematical formalism and objective language. All terms ($S$, $v$, $l$, $u$, $c$) are clearly defined, and the optimization problems are specified unambiguously.\n- **Completeness**: All necessary data (stoichiometric matrices, bounds, objectives) are provided for each test case.\n- **Consistency**: The givens for each test case are internally consistent and do not contain contradictions.\n\n### Step 3: Verdict and Action\nThe problem is valid. It is a well-defined computational problem in metabolic engineering that is scientifically grounded, mathematically consistent, and complete. A solution will be provided.\n\n### Principle-Based Solution\n\nThe task is to compute the Flux Variability Analysis (FVA) range for a specific reaction flux at the optimal objective value. This is a two-stage process for each test case, involving the solution of Linear Programming (LP) problems.\n\n**Stage 1: Flux Balance Analysis (FBA)**\nFirst, we determine the maximum value of the biological objective function. This is achieved by solving the FBA problem, which is an LP:\n$$\n\\begin{aligned}\nz^\\star = \\max_{v} \\quad  c^\\top v \\\\\n\\text{subject to} \\quad  S v = 0 \\\\\n l \\le v \\le u\n\\end{aligned}\n$$\nThe result of this optimization is the optimal objective value, $z^\\star$.\n\n**Stage 2: Flux Variability Analysis (FVA)**\nNext, we determine the feasible range $[v_j^{\\min}, v_j^{\\max}]$ for a specific flux $v_j$ while ensuring the objective remains at its optimum, $z^\\star$. This requires solving two additional LPs.\n\nTo find the minimum possible flux, $v_j^{\\min}$:\n$$\n\\begin{aligned}\nv_j^{\\min} = \\min_{v} \\quad  v_j \\\\\n\\text{subject to} \\quad  S v = 0 \\\\\n l \\le v \\le u \\\\\n c^\\top v = z^\\star\n\\end{aligned}\n$$\nTo find the maximum possible flux, $v_j^{\\max}$:\n$$\n\\begin{aligned}\nv_j^{\\max} = \\max_{v} \\quad  v_j \\\\\n\\text{subject to} \\quad  S v = 0 \\\\\n l \\le v \\le u \\\\\n c^\\top v = z^\\star\n\\end{aligned}\n$$\nThese LPs will be solved computationally using the `scipy.optimize.linprog` function, which finds the minimum of an objective function. Maximization problems are solved by minimizing the negative of the objective function.\n\n**Analysis of Test Cases**\n\n**Test Case 1: Unique Optimum**\n- $S = \\begin{bmatrix} -1  1  0 \\\\ -1  0  1 \\end{bmatrix}$, $l=(0,0,0)^\\top$, $u=(10,10,10)^\\top$, $c=(0,0,1)^\\top$, FVA for $v_2$.\n- The steady-state constraints $Sv=0$ translate to:\n  $$-v_1 + v_2 = 0 \\implies v_1 = v_2$$\n  $$-v_1 + v_3 = 0 \\implies v_1 = v_3$$\n- Thus, we must have $v_1 = v_2 = v_3$.\n- The FBA objective is to maximize $v_3$. Given the bounds $0 \\le v_i \\le 10$, the maximum value for $v_3$ is $10$. So, $z^\\star = 10$.\n- The optimal state is unique: $v_1^\\star = v_2^\\star = v_3^\\star = 10$.\n- For the FVA, we add the constraint $c^\\top v = v_3 = 10$. This, combined with $v_1 = v_2 = v_3$, forces $v_2$ to be exactly $10$.\n- The FVA range for $v_2$ is $[10.0, 10.0]$.\n\n**Test Case 2: Parallel Pathways**\n- $S = \\begin{bmatrix} 1  -1  0  -1 \\\\ 0  1  -1  1 \\end{bmatrix}$, $l=(0,0,0,0)^\\top$, $u=(10,10,10,10)^\\top$, $c=(0,0,1,0)^\\top$, FVA for $v_2$.\n- The constraints $Sv=0$ translate to:\n  $$v_1 - v_2 - v_4 = 0 \\implies v_1 = v_2 + v_4$$\n  $$v_2 - v_3 + v_4 = 0 \\implies v_3 = v_2 + v_4$$\n- This implies $v_1 = v_3$.\n- The FBA objective is to maximize $v_3$. Since $v_3 = v_1$ and $v_1$ is bounded by $0 \\le v_1 \\le 10$, the maximum value for $v_3$ is $10$. So, $z^\\star = 10$.\n- For the FVA, we add the constraint $c^\\top v = v_3 = 10$. This implies $v_1 = 10$. The system equations become $10 = v_2 + v_4$.\n- We need to find the range of $v_2$ subject to $v_2 + v_4 = 10$ and the bounds $0 \\le v_2 \\le 10$ and $0 \\le v_4 \\le 10$.\n  - To minimize $v_2$, we maximize $v_4$. The maximum value for $v_4$ is $10$, which gives $v_2 = 10 - 10 = 0$. So, $v_2^{\\min} = 0$.\n  - To maximize $v_2$, we minimize $v_4$. The minimum value for $v_4$ is $0$, which gives $v_2 = 10 - 0 = 10$. So, $v_2^{\\max} = 10$.\n- The FVA range for $v_2$ is $[0.0, 10.0]$.\n\n**Test Case 3: Upper-Bound-Limited Optimum**\n- $S = \\begin{bmatrix} -1  1  0 \\\\ -1  0  1 \\end{bmatrix}$, $l=(0,0,0)^\\top$, $u=(10,10,5)^\\top$, $c=(0,0,1)^\\top$, FVA for $v_2$.\n- The system of equations is the same as in Case 1: $v_1 = v_2 = v_3$.\n- The FBA objective is to maximize $v_3$. The bounds are $0 \\le v_1 \\le 10$, $0 \\le v_2 \\le 10$, and $0 \\le v_3 \\le 5$.\n- The maximum value for $v_3$ is directly limited by its upper bound, $u_3=5$. So, $z^\\star = 5$.\n- The optimal state is unique: $v_1^\\star = v_2^\\star = v_3^\\star = 5$.\n- For the FVA, we add the constraint $c^\\top v = v_3 = 5$. This, combined with $v_1 = v_2 = v_3$, forces $v_2$ to be exactly $5$.\n- The FVA range for $v_2$ is $[5.0, 5.0]$.\n\n**Computational Implementation**\nA Python function is implemented to automate this two-stage process. The function (`run_fva`) takes the model parameters ($S, c, l, u$) and the index of the flux to analyze.\n1. It first sets up and solves the FBA problem using `scipy.optimize.linprog`. The objective vector for `linprog` is $-c$ to perform maximization. The equality constraints are $A_{eq}=S$ and $b_{eq}=0$.\n2. The optimal objective value $z^\\star$ is extracted from the result.\n3. For the FVA step, the equality constraint matrix is augmented to include the new constraint $c^\\top v = z^\\star$. The new matrix is $A'_{eq} = \\begin{bmatrix} S \\\\ c^\\top \\end{bmatrix}$ and the vector is $b'_{eq} = \\begin{bmatrix} 0 \\\\ \\vdots \\\\ 0 \\\\ z^\\star \\end{bmatrix}$.\n4. Two LPs are then solved with these new constraints.\n   - To find $v_j^{\\min}$, the objective vector has a $1$ at index $j$ and zeros elsewhere.\n   - To find $v_j^{\\max}$, the objective vector has a $-1$ at index $j$ and zeros elsewhere. The result is then negated.\nThe results from all test cases are collected, rounded, and formatted into the required output string.",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef run_fva(S, c_obj, l, u, fva_idx):\n    \"\"\"\n    Performs Flux Balance Analysis (FBA) followed by Flux Variability Analysis (FVA)\n    for a specified reaction.\n\n    Args:\n        S (np.ndarray): Stoichiometric matrix (m x n).\n        c_obj (np.ndarray): Objective function vector (n,).\n        l (np.ndarray): Lower bounds for fluxes (n,).\n        u (np.ndarray): Upper bounds for fluxes (n,).\n        fva_idx (int): Index of the reaction for which to compute the FVA range.\n\n    Returns:\n        list: A list containing the minimum and maximum flux values [v_min, v_max],\n              or [None, None] if any optimization fails.\n    \"\"\"\n    n_metabolites, n_reactions = S.shape\n    \n    # Stage 1: FBA to find the optimal objective value z_star\n    # We negate c_obj because linprog minimizes\n    c_fba = -c_obj\n    A_eq = S\n    b_eq = np.zeros(n_metabolites)\n    bounds = list(zip(l, u))\n\n    res_fba = linprog(c=c_fba, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs-ipm')\n\n    if not res_fba.success:\n        # FBA optimization failed\n        return [None, None]\n    \n    # The optimal objective value. Negate back because we minimized -c'v\n    z_star = -res_fba.fun\n\n    # Stage 2: FVA\n    # Add the constraint c'v = z_star to the equality constraints\n    A_eq_fva = np.vstack([S, c_obj])\n    # Use a small tolerance for floating point comparison in the constraint\n    # This can improve robustness, although standard linprog handles it well.\n    # The value z_star is used directly.\n    b_eq_fva = np.hstack([b_eq, z_star])\n\n    v_min, v_max = None, None\n\n    # --- Minimize v_j ---\n    c_fva_min = np.zeros(n_reactions)\n    c_fva_min[fva_idx] = 1.0\n    res_min = linprog(c=c_fva_min, A_eq=A_eq_fva, b_eq=b_eq_fva, bounds=bounds, method='highs-ipm')\n    if res_min.success:\n        v_min = res_min.fun\n\n    # --- Maximize v_j (by minimizing -v_j) ---\n    c_fva_max = np.zeros(n_reactions)\n    c_fva_max[fva_idx] = -1.0\n    res_max = linprog(c=c_fva_max, A_eq=A_eq_fva, b_eq=b_eq_fva, bounds=bounds, method='highs-ipm')\n    if res_max.success:\n        v_max = -res_max.fun\n\n    return [v_min, v_max]\n\n\ndef solve():\n    \"\"\"\n    Defines and solves the test cases provided in the problem statement.\n    \"\"\"\n    test_cases = [\n        {\n            \"name\": \"Test Case 1: Unique Optimum\",\n            \"S\": np.array([\n                [-1, 1, 0],\n                [-1, 0, 1]\n            ]),\n            \"c_obj\": np.array([0, 0, 1]),\n            \"l\": np.array([0, 0, 0]),\n            \"u\": np.array([10, 10, 10]),\n            \"fva_idx\": 1  # FVA for v2 (0-indexed)\n        },\n        {\n            \"name\": \"Test Case 2: Parallel Pathways\",\n            \"S\": np.array([\n                [1, -1, 0, -1],\n                [0, 1, -1, 1]\n            ]),\n            \"c_obj\": np.array([0, 0, 1, 0]),\n            \"l\": np.array([0, 0, 0, 0]),\n            \"u\": np.array([10, 10, 10, 10]),\n            \"fva_idx\": 1  # FVA for v2\n        },\n        {\n            \"name\": \"Test Case 3: Upper-bound-limited Optimum\",\n            \"S\": np.array([\n                [-1, 1, 0],\n                [-1, 0, 1]\n            ]),\n            \"c_obj\": np.array([0, 0, 1]),\n            \"l\": np.array([0, 0, 0]),\n            \"u\": np.array([10, 10, 5]),\n            \"fva_idx\": 1  # FVA for v2\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        v_min, v_max = run_fva(case[\"S\"], case[\"c_obj\"], case[\"l\"], case[\"u\"], case[\"fva_idx\"])\n        \n        # Round final results to three decimal places\n        if v_min is not None and v_max is not None:\n             # Handle potential -0.0 from rounding\n            v_min_rounded = 0.0 if np.isclose(v_min, 0) else round(v_min, 3)\n            v_max_rounded = 0.0 if np.isclose(v_max, 0) else round(v_max, 3)\n            results.append([v_min_rounded, v_max_rounded])\n        else:\n            # Append a placeholder if optimization fails, though it shouldn't for these cases\n            results.append([None, None])\n\n    # Format the output string exactly as required\n    result_strings = [f\"[{r[0]:.3f}, {r[1]:.3f}]\" for r in results]\n    final_output = f\"[{','.join(result_strings)}]\"\n    \n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "Moving from analysis to design, this final practice tackles a core challenge in metabolic engineering: creating microbial strains that are optimized for chemical production. You will explore the concept of growth-coupled production, where the synthesis of a desired product becomes obligatory for cell growth. This advanced coding exercise employs a bilevel optimization framework, similar to that used in algorithms like OptKnock, to computationally identify gene knockout strategies that align the cell's intrinsic objective (growth) with the engineering goal (production), a key strategy for designing stable and efficient cell factories .",
            "id": "3325708",
            "problem": "Consider a minimal Flux Balance Analysis (FBA) model of a single-internal-metabolite network used in metabolic engineering and pathway optimization. The network consists of three reactions, with stoichiometry written for the internal metabolite $X$:\n\n- Reaction $R1$: $S \\rightarrow X$ with flux $v_1$,\n- Reaction $R2$: $X \\rightarrow \\text{Biomass}$ with flux $v_2$,\n- Reaction $R3$: $X \\rightarrow \\text{Product}$ with flux $v_3$.\n\nAssume a steady-state condition for the internal metabolite $X$, so that the mass balance is enforced by the linear algebraic constraint\n$$\nv_1 - v_2 - v_3 = 0.\n$$\n\nAssume standard FBA bounds on the fluxes as follows:\n- $v_1 \\in [\\ell_1, u_1]$ representing the substrate supply rate (e.g., a fixed feed rate when $\\ell_1 = u_1$),\n- $v_2 \\in [0, u_2]$ representing the maximum biomass formation capacity,\n- $v_3 \\in [0, u_3]$ representing the maximum product formation capacity.\n\nA gene knockout set $K$ among $\\{R2, R3\\}$ modifies bounds by forcing $v_j = 0$ for any $Rj \\in K$, equivalently $v_j \\in [0, 0]$ for any knocked-out reaction. The substrate uptake $R1$ cannot be knocked out in this problem. Let $\\epsilon  0$ denote a viability threshold for growth.\n\nGrowth-coupling of product is assessed by the following bilevel optimization logic:\n1. Compute the growth-optimal biomass flux\n$$\nv_2^\\star(K) \\in \\arg\\max_{v} \\; v_2 \\quad \\text{subject to} \\quad v_1 - v_2 - v_3 = 0, \\; v_1 \\in [\\ell_1, u_1], \\; v_2 \\in [0, u_2^K], \\; v_3 \\in [0, u_3^K],\n$$\nwhere $u_2^K = 0$ if $R2 \\in K$ else $u_2$, and $u_3^K = 0$ if $R3 \\in K$ else $u_3$.\n2. If $v_2^\\star(K)  \\epsilon$ or the problem is infeasible, discard $K$ as non-viable.\n3. Otherwise, compute the minimum product achievable at growth optimality by solving\n$$\nv_3^{\\min}(K) \\in \\min_{v} \\; v_3 \\quad \\text{subject to} \\quad v_1 - v_2 - v_3 = 0, \\; v_2 = v_2^\\star(K), \\; v_1 \\in [\\ell_1, u_1], \\; v_2 \\in [0, u_2^K], \\; v_3 \\in [0, u_3^K].\n$$\n\nA gene knockout set $K$ growth-couples product if $v_3^{\\min}(K)  0$, meaning that at the optimal growth rate, all feasible flux distributions necessarily maintain strictly positive product formation.\n\nYour task is to programmatically determine the optimal gene knockout set $K$ among the power set $\\{\\emptyset, \\{R2\\}, \\{R3\\}, \\{R2,R3\\}\\}$ that maximizes $v_3^{\\min}(K)$ subject to viability $v_2^\\star(K) \\ge \\epsilon$. In case of ties, prefer the $K$ with the smallest cardinality, and then lexicographically prefer $\\{R2\\}$ over $\\{R3\\}$ if needed. If no viable knockout set yields $v_3^{\\min}(K)  0$, return the empty set $\\emptyset$.\n\nYou must implement this as a complete, runnable program that uses linear programming to solve the inner optimization problems, adhering to the constraints exactly as stated. The program must not accept any user input; it must compute the answers for the following test suite of parameter sets. All fluxes are to be interpreted in millimoles per gram dry weight per hour (mmol\\,gDW$^{-1}$\\,h$^{-1}$), and the output minimal product fluxes must be reported as floating-point numbers in those units.\n\nTest suite (each case is $(\\ell_1, u_1, u_2, u_3, \\epsilon)$):\n- Case $1$: $(10, 10, 10, 100, 0.1)$,\n- Case $2$: $(10, 10, 6, 100, 0.1)$,\n- Case $3$: $(8, 8, 7, 1, 0.1)$,\n- Case $4$: $(5, 5, 4, 0.5, 0.1)$,\n- Case $5$: $(5, 5, 0.05, 5, 0.1)$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. For each test case, output a two-element list $[K, m]$, where $K$ is the selected knockout set represented as a list of integers (use $2$ for $R2$ and $3$ for $R3$), and $m$ is the computed $v_3^{\\min}(K)$ as a floating-point number in mmol\\,gDW$^{-1}$\\,h$^{-1}$. For example, the overall output should look like\n$$\n[[\\dots, m_1],[\\dots, m_2],[\\dots, m_3],[\\dots, m_4],[\\dots, m_5]],\n$$\nwith no additional text before or after.",
            "solution": "The user-provided problem is a valid, well-posed, and scientifically grounded exercise in computational systems biology, specifically focusing on metabolic pathway analysis using Flux Balance Analysis (FBA). The task is to identify an optimal gene knockout strategy to maximize growth-coupled product formation in a simplified metabolic network. The problem is structured as a search over a discrete set of strategies, where the evaluation of each strategy requires solving a bilevel linear programming problem.\n\nThe problem can be decomposed into two main parts:\n1.  For each potential gene knockout set $K$, evaluate its performance by calculating the maximum possible growth rate, $v_2^\\star(K)$, and the corresponding minimum product flux, $v_3^{\\min}(K)$.\n2.  Compare the results for all viable knockout sets to find the optimal one according to the specified criteria.\n\nThe metabolic network consists of a single internal metabolite $X$ and three reactions with fluxes $v_1, v_2, v_3$. The system is governed by the steady-state mass balance equation:\n$$v_1 - v_2 - v_3 = 0$$\nThe fluxes are constrained by lower and upper bounds:\n- $v_1 \\in [\\ell_1, u_1]$\n- $v_2 \\in [0, u_2]$\n- $v_3 \\in [0, u_3]$\n\nA gene knockout set $K$ is a subset of $\\{R2, R3\\}$. A knockout of reaction $Rj$ imposes the constraint $v_j=0$. The possible knockout sets are $K \\in \\{\\emptyset, \\{R2\\}, \\{R3\\}, \\{R2,R3\\}\\}$. For each set $K$, the flux bounds are modified: $v_2 \\in [0, u_2^K]$ and $v_3 \\in [0, u_3^K]$, where the upper bound is $0$ if the corresponding reaction is in $K$, and the original upper bound otherwise.\n\nThe evaluation for a given $K$ follows a two-step procedure involving linear programming (LP). Let the vector of fluxes be $v = [v_1, v_2, v_3]^T$.\n\n**Step 1: Maximization of Biomass Flux**\nThe first step is to find the maximum possible biomass production rate (growth rate), $v_2^\\star(K)$. This is formulated as a linear programming problem:\n$$\n\\begin{align*}\nv_2^\\star(K) = \\max_{v} \\quad  v_2 \\\\\n\\text{subject to} \\quad  v_1 - v_2 - v_3 = 0 \\\\\n \\ell_1 \\le v_1 \\le u_1 \\\\\n 0 \\le v_2 \\le u_2^K \\\\\n 0 \\le v_3 \\le u_3^K\n\\end{align*}\n$$\nTo solve this using a standard LP solver that minimizes, we can equivalently minimize $-v_2$. If this LP is infeasible, or if the resulting optimal value $v_2^\\star(K)$ is less than the viability threshold $\\epsilon$, the knockout set $K$ is deemed non-viable and is discarded.\n\n**Step 2: Minimization of Product Flux at Optimal Growth**\nIf $K$ is viable, we proceed to find the minimum guaranteed product flux when the cell operates at its maximal growth rate. This is another LP problem, where we add a constraint fixing the biomass flux to its optimal value $v_2^\\star(K)$:\n$$\n\\begin{align*}\nv_3^{\\min}(K) = \\min_{v} \\quad  v_3 \\\\\n\\text{subject to} \\quad  v_1 - v_2 - v_3 = 0 \\\\\n v_2 = v_2^\\star(K) \\\\\n \\ell_1 \\le v_1 \\le u_1 \\\\\n 0 \\le v_2 \\le u_2^K \\\\\n 0 \\le v_3 \\le u_3^K\n\\end{align*}\n$$\nThe value $v_3^{\\min}(K)$ represents the minimum product formation that is obligatorily coupled to achieving the maximum biomass rate $v_2^\\star(K)$. A value $v_3^{\\min}(K)  0$ indicates successful growth-coupling.\n\n**Overall Optimization Strategy**\nThe overall goal is to find the knockout set $K$ that maximizes $v_3^{\\min}(K)$ among all viable strategies. The procedure is as follows:\n1.  For each of the four possible knockout sets $K_i \\in \\{\\emptyset, \\{R2\\}, \\{R3\\}, \\{R2,R3\\}\\}$, perform the two-step LP analysis to compute $v_3^{\\min}(K_i)$, provided $K_i$ is viable.\n2.  Collect all viable results $(v_3^{\\min}(K_i), |K_i|, K_i)$.\n3.  The primary objective is to maximize $v_3^{\\min}(K)$.\n4.  If multiple sets yield the same maximal $v_3^{\\min}(K)$, the tie is broken by choosing the set with the smallest cardinality (fewest knockouts).\n5.  If a tie still persists (which can only happen between $\\{R2\\}$ and $\\{R3\\}$), the set $\\{R2\\}$ is preferred.\n6.  If no viable knockout set results in a strictly positive minimal product flux (i.e., $\\max_K v_3^{\\min}(K) \\le 0$), the default solution is the empty set $K=\\emptyset$, with an associated product flux of $0.0$. This also covers cases where no viable sets exist at all.\n\nThis systematic procedure is implemented programmatically by iterating through the test cases and, for each, applying the described search and optimization logic. The `scipy.optimize.linprog` function is used to solve the constituent LP problems. The knockout sets are examined in an order that respects the tie-breaking rules: $\\emptyset$, $\\{R2\\}$, $\\{R3\\}$, $\\{R2,R3\\}$. This allows for a straightforward selection of the best candidate based on sequential comparison.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.optimize import linprog\n\ndef solve():\n    \"\"\"\n    Solves the metabolic engineering problem for a suite of test cases.\n    \"\"\"\n    # Test suite (l1, u1, u2, u3, epsilon)\n    test_cases = [\n        (10, 10, 10, 100, 0.1),\n        (10, 10, 6, 100, 0.1),\n        (8, 8, 7, 1, 0.1),\n        (5, 5, 4, 0.5, 0.1),\n        (5, 5, 0.05, 5, 0.1),\n    ]\n\n    all_results = []\n\n    for case_params in test_cases:\n        l1, u1, u2, u3, epsilon = case_params\n\n        # Knockout sets to evaluate, ordered to handle tie-breaking.\n        # k_repr is used for lexicographical tie-breaking {R2} vs {R3}.\n        knockout_sets = [\n            {'k': [], 'card': 0, 'k_repr': 0},\n            {'k': [2], 'card': 1, 'k_repr': 1},\n            {'k': [3], 'card': 1, 'k_repr': 2},\n            {'k': [2, 3], 'card': 2, 'k_repr': 3},\n        ]\n\n        viable_results = []\n\n        for ko_info in knockout_sets:\n            K = ko_info['k']\n            \n            # Set bounds based on the knockout set K\n            u2_k = 0 if 2 in K else u2\n            u3_k = 0 if 3 in K else u3\n\n            # --- LP 1: Maximize v2 ---\n            # Objective: min -v2. Variables are [v1, v2, v3]\n            c1 = np.array([0, -1, 0])\n            # v1 - v2 - v3 = 0\n            A_eq = np.array([[1, -1, -1]])\n            b_eq = np.array([0])\n            bounds = [(l1, u1), (0, u2_k), (0, u3_k)]\n\n            res1 = linprog(c1, A_eq=A_eq, b_eq=b_eq, bounds=bounds, method='highs')\n\n            if not res1.success:\n                # Problem is infeasible for this K, so K is not viable.\n                continue\n\n            v2_star = res1.x[1]\n\n            # Check viability threshold\n            if v2_star  epsilon:\n                # K is not viable.\n                continue\n\n            # --- LP 2: Minimize v3 at v2 = v2_star ---\n            # Objective: min v3\n            c2 = np.array([0, 0, 1])\n            # Constraints: v1 - v2 - v3 = 0  AND  v2 = v2_star\n            A_eq2 = np.array([[1, -1, -1], [0, 1, 0]])\n            b_eq2 = np.array([0, v2_star])\n            \n            # Re-using the same bounds\n            res2 = linprog(c2, A_eq=A_eq2, b_eq=b_eq2, bounds=bounds, method='highs')\n\n            if res2.success:\n                v3_min = res2.fun\n                # SciPy can return very small negative numbers due to precision\n                if v3_min  0 and np.isclose(v3_min, 0):\n                    v3_min = 0.0\n                \n                viable_results.append({\n                    'k': K,\n                    'v3_min': v3_min,\n                    'card': ko_info['card'],\n                    'k_repr': ko_info['k_repr']\n                })\n        \n        # --- Select the best knockout set ---\n        # Default result if no viable set with v3_min  0 is found\n        best_k = []\n        best_m = 0.0\n\n        # Filter for sets that growth-couple product (v3_min  0)\n        positive_coupling_results = [r for r in viable_results if r['v3_min']  0]\n        \n        if positive_coupling_results:\n            # Sort to find the best:\n            # 1. Maximize v3_min (sort descending)\n            # 2. Minimize cardinality (sort ascending)\n            # 3. Lexicographical preference {R2} over {R3} (sort ascending by k_repr)\n            positive_coupling_results.sort(key=lambda r: (-r['v3_min'], r['card'], r['k_repr']))\n            \n            best_result = positive_coupling_results[0]\n            best_k = best_result['k']\n            best_m = best_result['v3_min']\n        else:\n            # If no K yields v3_min  0, we must find the best among those with v3_min = 0.\n            # The problem states to return [] if no viable set gives v3_min  0.\n            # However, if some viable sets give v3_min=0, we should still return the best one\n            # by tie-breaking. The rule is somewhat ambiguous. Adhering to the explicit\n            # rule: \"If no viable knockout set yields v_3^min(K)0, return the empty set.\"\n            # We'll also associate v3_min=0 with it. If K=empty was viable, its v3_min might be a candidate.\n            \n            zero_coupling_results = [r for r in viable_results if np.isclose(r['v3_min'], 0)]\n            if zero_coupling_results:\n                 zero_coupling_results.sort(key=lambda r: (r['card'], r['k_repr']))\n                 best_k_zero = zero_coupling_results[0]['k']\n                 best_m_zero = zero_coupling_results[0]['v3_min']\n                 \n                 # Per \"return the empty set\" rule, we select [] if max m is not positive\n                 best_k = []\n                 # The 'm' should be the value for the selected K. But rule suggests fixed K=[].\n                 # If K=[] was viable, use its m. otherwise it is 0.\n                 k_empty_res = next((r for r in zero_coupling_results if r['k'] == []), None)\n                 if k_empty_res:\n                     best_m = k_empty_res['v3_min']\n                 else:\n                     best_m = 0.0\n\n            # This branch handles cases where no viable set exists, or all viable sets\n            # have v3_min = 0.\n            pass # Keep default best_k=[], best_m=0.0 as per the rule.\n\n        all_results.append([best_k, best_m])\n\n    # Format the final list of results into the required string format\n    result_strings = []\n    for k_val, m_val in all_results:\n        result_strings.append(f\"[{k_val},{m_val}]\")\n    \n    print(f\"[{','.join(result_strings)}]\")\n\nsolve()\n```"
        }
    ]
}