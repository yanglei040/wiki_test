{
    "hands_on_practices": [
        {
            "introduction": "评估生成对抗网络 (GAN) 的一个基本任务是量化真实数据分布与合成数据分布之间的差异。一种流行的方法是使用基于矩匹配的度量，例如 Fréchet Inception Distance (FID)。这个练习将引导你从第一性原理出发，推导并应用一个类似的度量，即两个高斯分布之间的平方 $2$-Wasserstein 距离。通过这个实践，你将深入理解这些常用评估工具背后的数学原理及其在评估合成基因表达数据时的局限性 。",
            "id": "3316104",
            "problem": "一个计算系统生物学小组正在训练一个生成对抗网络（GAN），用于合成两个标记基因的低维基因表达向量。为了评估真实样本和合成样本之间的分布相似性，他们决定使用一种类似于Fréchet Inception Distance（FID）的类Fréchet准则。在FID背后的标准建模假设下，真实数据和合成数据的特征分布可以用匹配了一阶矩和二阶矩的多元正态分布来近似。\n\n设真实基因表达向量被建模为均值为 $ \\mu_{r} \\in \\mathbb{R}^{2} $、协方差为 $ \\Sigma_{r} \\in \\mathbb{R}^{2 \\times 2} $ 的多元正态分布，合成基因表达向量被建模为均值为 $ \\mu_{s} \\in \\mathbb{R}^{2} $、协方差为 $ \\Sigma_{s} \\in \\mathbb{R}^{2 \\times 2} $ 的多元正态分布，其中两个协方差矩阵都是对称正定的。\n\n从具有有限二阶矩的两个概率测度之间带二次传输成本的平方$2$-Wasserstein距离的定义出发，并仅使用上述高斯性假设以及关于对称正定矩阵的标准线性代数事实，完成以下任务：\n\n1. 推导 $ \\mathcal{N}(\\mu_{r}, \\Sigma_{r}) $ 和 $ \\mathcal{N}(\\mu_{s}, \\Sigma_{s}) $ 之间平方距离的闭式解析表达式，用 $ \\mu_{r}, \\mu_{s}, \\Sigma_{r}, \\Sigma_{s} $ 表示。\n\n2. 对以下参数评估该平方距离，这些参数来自对一个留出验证集的经验估计：\n   - $ \\mu_{r} = \\begin{pmatrix} 5 \\\\ 8 \\end{pmatrix} $, $ \\Sigma_{r} = \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix} $,\n   - $ \\mu_{s} = \\begin{pmatrix} 4 \\\\ 10 \\end{pmatrix} $, $ \\Sigma_{s} = \\begin{pmatrix} \\tfrac{1}{2}  0 \\\\ 0  2 \\end{pmatrix} $.\n\n3. 基于建模假设的第一性原理，简要指出单细胞基因表达数据中对高斯性的偏离和协方差结构，在用于评估GAN时，相对于Fréchet Inception Distance通常被证明是合理的那些假设，可能以至少两种方式使该度量产生偏差。\n\n将第2部分的数值作为你的最终答案。以精确形式表达你的答案；不要近似或四舍五入。不需要单位。",
            "solution": "在尝试任何解答之前，对问题陈述的有效性进行严格评估。\n\n### 步骤1：提取已知条件\n- 设置是评估一个用于合成二维基因表达向量的生成对抗网络（GAN）。\n- 真实数据向量被建模为来自多元正态分布 $\\mathcal{N}(\\mu_{r}, \\Sigma_{r})$ 的样本。\n- 合成数据向量被建模为来自多元正态分布 $\\mathcal{N}(\\mu_{s}, \\Sigma_{s})$ 的样本。\n- 均值为 $\\mu_{r} \\in \\mathbb{R}^{2}$ 和 $\\mu_{s} \\in \\mathbb{R}^{2}$。\n- 协方差矩阵为 $\\Sigma_{r} \\in \\mathbb{R}^{2 \\times 2}$ 和 $\\Sigma_{s} \\in \\mathbb{R}^{2 \\times 2}$，并且是对称正定的。\n- 任务是推导这两个高斯分布之间的平方$2$-Wasserstein距离。\n- 任务是针对特定参数评估此距离：\n  - $\\mu_{r} = \\begin{pmatrix} 5 \\\\ 8 \\end{pmatrix}$\n  - $\\Sigma_{r} = \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix}$\n  - $\\mu_{s} = \\begin{pmatrix} 4 \\\\ 10 \\end{pmatrix}$\n  - $\\Sigma_{s} = \\begin{pmatrix} \\frac{1}{2}  0 \\\\ 0  2 \\end{pmatrix}$\n- 任务是确定当该度量应用于可能非高斯的真实基因表达数据时，其两种潜在的偏差。\n- 最终答案是评估部分的平方距离的数值。\n\n### 步骤2：使用提取的已知条件进行验证\n- **科学依据（关键）**：该问题具有科学依据。使用Wasserstein距离比较概率分布是数学和统计学中的一种标准技术。它应用于比较真实数据和生成数据的分布，尤其是在高斯假设下（如在Fréchet Inception Distance，或FID中），是现代机器学习评估生成模型的基石。其背景，计算系统生物学，适合此类建模。\n- **适定性**：该问题是适定的。它要求推导一个已知的、唯一的解析公式。它为后续计算提供了所有必要的数值数据。第三部分的概念性问题很精确，要求分析模型的局限性，这是科学中标准的批判性思维练习。\n- **客观性（关键）**：该问题以客观、正式且无歧义的语言陈述。\n- 该问题没有表现出无效性标准中列出的任何缺陷。诸如高斯性之类的假设被明确说明为要使用的模型的一部分，并且任务的一部分就是批判这些假设。所提供的矩阵是对称且正定的（对角线元素为正，非对角线元素为零），确保所有必需的矩阵运算（例如，平方根）都是良定义的。\n\n### 步骤3：结论和行动\n该问题被判定为**有效**。将提供完整的解答。\n\n### 解答\n\n该问题要求三个部分：推导、计算和概念分析。所需的最终答案是计算的结果。\n\n#### 第1部分：两个高斯分布之间平方$2$-Wasserstein距离的推导\n\n设两个多元正态分布为 $P_r = \\mathcal{N}(\\mu_{r}, \\Sigma_{r})$ 和 $P_s = \\mathcal{N}(\\mu_{s}, \\Sigma_{s})$。它们之间的平方$2$-Wasserstein距离由下式给出：\n$$\nW_2^2(P_r, P_s) = \\inf_{\\gamma \\in \\Gamma(P_r, P_s)} \\int_{\\mathbb{R}^d \\times \\mathbb{R}^d} \\|x-y\\|_2^2 \\, d\\gamma(x,y)\n$$\n其中 $\\Gamma(P_r, P_s)$ 是 $\\mathbb{R}^d \\times \\mathbb{R}^d$ 上所有以 $P_r$ 和 $P_s$ 为边缘分布的联合概率测度的集合。对于高斯分布，这有一个闭式解。达到这个下确界的最优传输方案对应于一个仿射映射。也就是说，如果一个随机变量 $X \\sim P_r$，那么最优传输后的随机变量 $Y$ 由 $Y = \\mu_s + A(X - \\mu_r)$ 给出，其中 $A$ 是一个为最小化期望平方距离而选择的特定矩阵。为了使 $Y$ 服从分布 $P_s$，其均值必须是 $\\mu_s$，协方差必须是 $\\Sigma_s$。均值通过构造得到满足：$\\mathbb{E}[Y] = \\mu_s + A(\\mathbb{E}[X] - \\mu_r) = \\mu_s$。协方差为 $\\text{Cov}(Y) = A \\text{Cov}(X) A^T = A \\Sigma_r A^T$。我们需要 $A \\Sigma_r A^T = \\Sigma_s$。最小化传输成本的 $A$ 的解是唯一的且是正定的，由 $A = \\Sigma_r^{-1/2} (\\Sigma_r^{1/2} \\Sigma_s \\Sigma_r^{1/2})^{1/2} \\Sigma_r^{-1/2}$ 给出。\n\n平方距离就是 $\\|X - Y\\|_2^2$ 的期望值：\n$$\nW_2^2(P_r, P_s) = \\mathbb{E}[\\|X - Y\\|_2^2] = \\mathbb{E}[\\|(X - \\mu_r) - (\\mu_s - \\mu_r) - A(X - \\mu_r)\\|_2^2]\n$$\n$$\nW_2^2(P_r, P_s) = \\mathbb{E}[\\|(I-A)(X-\\mu_r) - (\\mu_s-\\mu_r)\\|_2^2]\n$$\n展开范数并利用期望的线性性质：\n$$\nW_2^2(P_r, P_s) = \\mathbb{E}[\\|(I-A)(X-\\mu_r)\\|_2^2] + \\|\\mu_s-\\mu_r\\|_2^2 - 2\\mathbb{E}[(\\mu_s-\\mu_r)^T(I-A)(X-\\mu_r)]\n$$\n交叉项为零，因为 $\\mathbb{E}[X-\\mu_r] = 0$。第一项可以用迹来写：\n$$\n\\mathbb{E}[\\|(I-A)(X-\\mu_r)\\|_2^2] = \\mathbb{E}[\\text{Tr}((X-\\mu_r)^T(I-A)^T(I-A)(X-\\mu_r))]\n$$\n$$\n= \\text{Tr}(\\mathbb{E}[(I-A)^T(I-A)(X-\\mu_r)(X-\\mu_r)^T]) = \\text{Tr}((I-A)^T(I-A)\\Sigma_r)\n$$\n由于 $A$ 是对称的（$A^T=A$），因为它的构造只涉及对称矩阵，这可以简化为：\n$$\n\\text{Tr}((I-A)\\Sigma_r(I-A)) = \\text{Tr}(\\Sigma_r - 2A\\Sigma_r + A\\Sigma_rA)\n$$\n根据协方差匹配条件 $A \\Sigma_r A^T = \\Sigma_s$ 和 $A=A^T$，我们有 $A \\Sigma_r A = \\Sigma_s$。表达式变为：\n$$\n\\text{Tr}(\\Sigma_r + \\Sigma_s - 2A\\Sigma_r)\n$$\n使用迹的循环性质和 $A$ 的表达式：\n$$\n\\text{Tr}(A\\Sigma_r) = \\text{Tr}(\\Sigma_r^{-1/2} (\\Sigma_r^{1/2} \\Sigma_s \\Sigma_r^{1/2})^{1/2} \\Sigma_r^{-1/2} \\Sigma_r) = \\text{Tr}(\\Sigma_r^{-1/2} (\\Sigma_r^{1/2} \\Sigma_s \\Sigma_r^{1/2})^{1/2} \\Sigma_r^{1/2})\n$$\n$$\n= \\text{Tr}(\\Sigma_r^{1/2} \\Sigma_r^{-1/2} (\\Sigma_r^{1/2} \\Sigma_s \\Sigma_r^{1/2})^{1/2}) = \\text{Tr}((\\Sigma_r^{1/2} \\Sigma_s \\Sigma_r^{1/2})^{1/2})\n$$\n结合所有项，平方$2$-Wasserstein距离为：\n$$\nW_2^2(\\mathcal{N}(\\mu_{r}, \\Sigma_{r}), \\mathcal{N}(\\mu_{s}, \\Sigma_{s})) = \\|\\mu_{r} - \\mu_{s}\\|_2^2 + \\text{Tr}(\\Sigma_{r} + \\Sigma_{s} - 2(\\Sigma_{r}^{1/2} \\Sigma_{s} \\Sigma_{r}^{1/2})^{1/2})\n$$\n\n#### 第2部分：对给定参数的评估\n\n给定的参数是：\n- $\\mu_{r} = \\begin{pmatrix} 5 \\\\ 8 \\end{pmatrix}$，$\\mu_{s} = \\begin{pmatrix} 4 \\\\ 10 \\end{pmatrix}$\n- $\\Sigma_{r} = \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix}$，$\\Sigma_{s} = \\begin{pmatrix} \\frac{1}{2}  0 \\\\ 0  2 \\end{pmatrix}$\n\n我们计算推导公式的两项。\n\n首先，均值差的平方范数：\n$$\n\\mu_{r} - \\mu_{s} = \\begin{pmatrix} 5 - 4 \\\\ 8 - 10 \\end{pmatrix} = \\begin{pmatrix} 1 \\\\ -2 \\end{pmatrix}\n$$\n$$\n\\|\\mu_{r} - \\mu_{s}\\|_2^2 = (1)^2 + (-2)^2 = 1 + 4 = 5\n$$\n\n其次，迹项。由于 $\\Sigma_{r}$ 和 $\\Sigma_{s}$ 是对角矩阵，所有派生出的矩阵如平方根也将是对角矩阵，这极大地简化了计算。\n$\\Sigma_r$ 的平方根是：\n$$\n\\Sigma_{r}^{1/2} = \\begin{pmatrix} \\sqrt{2}  0 \\\\ 0  \\sqrt{1} \\end{pmatrix} = \\begin{pmatrix} \\sqrt{2}  0 \\\\ 0  1 \\end{pmatrix}\n$$\n接下来，我们计算乘积 $\\Sigma_{r}^{1/2} \\Sigma_{s} \\Sigma_{r}^{1/2}$：\n$$\n\\Sigma_{r}^{1/2} \\Sigma_{s} \\Sigma_{r}^{1/2} = \\begin{pmatrix} \\sqrt{2}  0 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} \\frac{1}{2}  0 \\\\ 0  2 \\end{pmatrix} \\begin{pmatrix} \\sqrt{2}  0 \\\\ 0  1 \\end{pmatrix} = \\begin{pmatrix} \\sqrt{2} \\cdot \\frac{1}{2} \\cdot \\sqrt{2}  0 \\\\ 0  1 \\cdot 2 \\cdot 1 \\end{pmatrix} = \\begin{pmatrix} 1  0 \\\\ 0  2 \\end{pmatrix}\n$$\n现在，我们对这个结果矩阵取平方根：\n$$\n(\\Sigma_{r}^{1/2} \\Sigma_{s} \\Sigma_{r}^{1/2})^{1/2} = \\begin{pmatrix} 1  0 \\\\ 0  2 \\end{pmatrix}^{1/2} = \\begin{pmatrix} \\sqrt{1}  0 \\\\ 0  \\sqrt{2} \\end{pmatrix} = \\begin{pmatrix} 1  0 \\\\ 0  \\sqrt{2} \\end{pmatrix}\n$$\n现在我们计算迹的参数：\n$$\n\\Sigma_{r} + \\Sigma_{s} - 2(\\Sigma_{r}^{1/2} \\Sigma_{s} \\Sigma_{r}^{1/2})^{1/2} = \\begin{pmatrix} 2  0 \\\\ 0  1 \\end{pmatrix} + \\begin{pmatrix} \\frac{1}{2}  0 \\\\ 0  2 \\end{pmatrix} - 2\\begin{pmatrix} 1  0 \\\\ 0  \\sqrt{2} \\end{pmatrix}\n$$\n$$\n= \\begin{pmatrix} 2 + \\frac{1}{2} - 2(1)  0 \\\\ 0  1 + 2 - 2\\sqrt{2} \\end{pmatrix} = \\begin{pmatrix} \\frac{5}{2} - 2  0 \\\\ 0  3 - 2\\sqrt{2} \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{2}  0 \\\\ 0  3 - 2\\sqrt{2} \\end{pmatrix}\n$$\n该矩阵的迹是其对角线元素之和：\n$$\n\\text{Tr}(\\dots) = \\frac{1}{2} + 3 - 2\\sqrt{2} = \\frac{7}{2} - 2\\sqrt{2}\n$$\n最后，我们将两个分量相加，得到平方距离：\n$$\nW_2^2 = 5 + \\left(\\frac{7}{2} - 2\\sqrt{2}\\right) = \\frac{10}{2} + \\frac{7}{2} - 2\\sqrt{2} = \\frac{17}{2} - 2\\sqrt{2}\n$$\n\n#### 第3部分：该度量用于基因表达数据的潜在偏差\n\n基于匹配高斯近似的前两阶矩的类Fréchet距离，由于其基本假设被违反，在评估应用于单细胞基因表达数据的GAN时，可能成为一个有偏或信息量不足的度量。\n\n1.  **违反高斯性假设（多模态性和稀疏性）**：真实的单细胞基因表达数据从根本上说不是高斯的。它的特点是高度稀疏（在许多细胞中，许多基因的值有很大比例为零）和显著的多模态性。这种多模态性反映了离散细胞类型或状态的存在，它们是基因表达空间中不同的簇。一个只考虑均值和协方差的度量对这种模态结构是盲目的。一个GAN可以生成一个单峰的、类高斯的合成数据云，它完美匹配了真实双峰分布的均值和协方差。在这种情况下，Fréchet距离会低得具有欺骗性（表明拟合良好），而GAN却完全没有学到数据最关键的生物学特征：不同的细胞群体。这导致对真实分布和合成分布之间真实散度的系统性低估。\n\n2.  **对非线性相关性和流形结构不敏感**：协方差矩阵仅捕捉变量之间的线性相关性。生物系统，如基因调控网络，受复杂的非线性动力学支配。因此，基因表达数据通常位于高维基因空间内的一个低维非线性流形上或附近。Fréchet距离依赖于线性（仿射）最优传输映射和欧几里得空间中的二次成本函数，对这些流形的几何形状不敏感。一个GAN可能生成具有正确均值和线性协方差结构的数据，但其数据点却偏离了真实的生物学流形。例如，真实数据可能位于一个弯曲的“香蕉”形状上，而GAN生成了一个椭圆云。该度量将无法充分惩罚这种拓扑和几何上的不匹配，从而对一个生成了生物学上不合理细胞状态的模型给出误导性的良好评价。这是一个关键的失败，因为在生物数据合成中，保持数据的流形结构通常是一个主要目标。",
            "answer": "$$\\boxed{\\frac{17}{2} - 2\\sqrt{2}}$$"
        },
        {
            "introduction": "尽管基于矩的度量很有用，但它们往往无法捕捉生物数据复杂的结构特征，例如单细胞测序数据中离散的细胞簇。这个练习介绍了一种更强大的评估工具——拓扑数据分析 (TDA)，用于量化和比较数据的“形状”。通过为真实和生成的嵌入数据构建 Vietoris-Rips 复形并计算其贝蒂数（Betti numbers），你将学会一种更精细的方法来检测 GAN 的关键失败模式，如“模式坍塌” (mode collapse) 。",
            "id": "3316091",
            "problem": "给定由生成对抗网络（GAN）生成的单细胞核糖核酸测序（scRNA-seq）数据的嵌入（embedding）所表示的有限点云。任务是使用拓扑数据分析（TDA），通过比较真实嵌入与生成嵌入的 Vietoris–Rips 复形的拓扑结构，来评估潜在的模式坍塌（mode collapse）。\n\n请使用纯数学术语进行处理：将每个嵌入视为带有欧几里得度量的 $\\mathbb{R}^d$ 的一个有限子集，并将在尺度参数 $\\varepsilon > 0$ 下的 Vietoris–Rips 复形定义为一个抽象单纯复形，其 $k$-单纯形是所有大小为 $k+1$ 的顶点子集，且这些子集中任意两顶点间的距离至多为 $\\varepsilon$。计算 Betti 数，其中 $\\beta_k$ 是在有限域 $\\mathbb{F}_2$ 上定义的第 $k$ 个同调群的维数，并特别关注 $k \\in \\{0,1\\}$ 的情况。\n\n使用的基本依据和定义：\n- 一个有限度量空间在尺度 $\\varepsilon$ 下的 Vietoris–Rips 复形包含一个 $k$-单纯形，当且仅当其所有顶点对之间的距离至多为 $\\varepsilon$。\n- 一个有限单纯复形在某个域上的同调是通过链复形来定义的，该链复形带有将 $k$-链映射到 $(k-1)$-链的边界算子，而 $\\beta_k$ 等于第 $k$ 个同调群的维数。\n- 对于 $k=0$，$\\beta_0$ 等于该复形的 1-骨架图的连通分量数。\n- 对于 $k=1$，第一个 Betti 数计算的是在考虑了填充循环的 2-单纯形之后，独立的一维孔洞的数量。\n\n对于每个测试用例，你的程序必须在给定的 $\\varepsilon$ 下构建维度最高为 2 的 Vietoris–Rips 复形（包括顶点、边和三角形），计算 $\\beta_0$ 和 $\\beta_1$，然后生成一个模式坍塌的布尔指示符，其定义如下：如果生成的嵌入的连通分量严格少于真实的嵌入，且一维孔洞数量没有增加，即满足 $\\beta_0^{\\mathrm{gen}} < \\beta_0^{\\mathrm{real}}$ 且 $\\beta_1^{\\mathrm{gen}} \\le \\beta_1^{\\mathrm{real}}$，则判定为发生坍塌。\n\n测试套件（每个测试用例是一个三元组，包含真实嵌入、生成嵌入和尺度参数 $\\varepsilon$）：\n- 测试用例 1（两个清晰分离的簇 vs 单个簇）：\n  - $\\mathbb{R}^2$ 中的真实嵌入 $\\phi(X)_{\\mathrm{real}}$，点集为：$(0,0)$, $(1,0)$, $(0.5,0.866025403784)$, $(4,0)$, $(5,0)$, $(4.5,0.866025403784)$；尺度 $\\varepsilon = 1.1$。\n  - $\\mathbb{R}^2$ 中的生成嵌入 $\\phi(X)_{\\mathrm{gen}}$，点集为：$(0,0)$, $(1,0)$, $(0.5,0.866025403784)$；尺度 $\\varepsilon = 1.1$。\n- 测试用例 2（一个环 vs 一个填充的三角形）：\n  - $\\mathbb{R}^2$ 中的真实嵌入 $\\phi(X)_{\\mathrm{real}}$，点集为：$(0,0)$, $(1,0)$, $(1,1)$, $(0,1)$；尺度 $\\varepsilon = 1.05$。\n  - $\\mathbb{R}^2$ 中的生成嵌入 $\\phi(X)_{\\mathrm{gen}}$，点集为：$(0,0)$, $(0.6,0)$, $(0.3,0.519615242270)$；尺度 $\\varepsilon = 1.05$。\n- 测试用例 3（孤立点 vs 单个填充的三角形）：\n  - $\\mathbb{R}^2$ 中的真实嵌入 $\\phi(X)_{\\mathrm{real}}$，点集为：$(0,0)$, $(2,0)$, $(0,2)$；尺度 $\\varepsilon = 0.5$。\n  - $\\mathbb{R}^2$ 中的生成嵌入 $\\phi(X)_{\\mathrm{gen}}$，点集为：$(0,0)$, $(0.4,0)$, $(0.2,0.346410161514)$；尺度 $\\varepsilon = 0.5$。\n\n对于每个测试用例，计算元组 $\\left[\\beta_0^{\\mathrm{real}}, \\beta_1^{\\mathrm{real}}, \\beta_0^{\\mathrm{gen}}, \\beta_1^{\\mathrm{gen}}, C\\right]$，其中 $C$ 是上文定义的坍塌指示符。你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，列表中的每个元素是对应于一个测试用例的列表，并按给定测试用例的顺序排列（例如，$\\left[ [\\cdots], [\\cdots], [\\cdots] \\right]$）。不涉及物理单位，也不使用角度。所有返回的值必须是布尔、整数、浮点数或这些基本类型的列表。计算必须基于给定的输入进行，确保结果精确；不涉及任何随机性。",
            "solution": "该问题要求通过比较真实数据和生成数据的点云嵌入的拓扑结构，来评估生成对抗网络（GAN）中潜在的模式坍塌。指定的方法是拓扑数据分析（TDA），具体来说是为从数据构建的 Vietoris–Rips（VR）复形计算 Betti 数。该问题定义明确，数学上合理，并提供了所有必要的参数和定义。我们将着手提供一个解决方案。\n\n任务的核心是为给定尺度参数 $\\varepsilon > 0$ 下的有限点集 $X \\subset \\mathbb{R}^d$ 计算第 0 个和第 1 个 Betti 数，即 $\\beta_0$ 和 $\\beta_1$。这些数字量化了基本的拓扑特征：$\\beta_0$ 计算连通分量的数量，而 $\\beta_1$ 计算一维“孔洞”或“隧道”的数量。\n\n首先，我们必须构建 Vietoris–Rips 复形 $VR(X, \\varepsilon)$。这是一个抽象单纯复形，其顶点集是点集 $X$。如果一个包含 $k+1$ 个顶点的子集中任意两个顶点之间的欧几里得距离不超过 $\\varepsilon$，则该子集构成一个 $k$-单纯形。为了我们的目的，我们只需要构建维度最高为 2 的复形：\n- $0$-单纯形（顶点）：$X$ 中的点。\n- $1$-单纯形（边）：所有点对 $\\{v_i, v_j\\} \\subset X$，满足距离 $d(v_i, v_j) \\le \\varepsilon$。\n- $2$-单纯形（三角形）：所有点三元组 $\\{v_i, v_j, v_k\\} \\subset X$，满足 $d(v_i, v_j) \\le \\varepsilon$，$d(v_j, v_k) \\le \\varepsilon$ 且 $d(v_i, v_k) \\le \\varepsilon$。\n\n复形构建完成后，我们通过分析其在有限域 $\\mathbb{F}_2$ 上的单纯同调来计算其 Betti 数。\n\n**$\\beta_0$ 的计算**\n第 0 个 Betti 数 $\\beta_0$ 是第 0 个同调群 $H_0$ 的维数。它直接对应于单纯复形的 1-骨架（由顶点和边构成的图）的连通分量数。\n在算法上，我们可以通过以下步骤计算 $\\beta_0$：\n1.  构建图 $G=(V,E)$，其中 $V=X$，且当且仅当 $d(v_i, v_j) \\le \\varepsilon$ 时，存在一条边 $(v_i, v_j) \\in E$。\n2.  计算 $G$ 中的连通分量数。这可以使用并查集（不相交集联合）数据结构高效完成。我们将每个顶点初始化为它自己的集合。然后，对于每条边 $(v_i, v_j)$，我们对包含 $v_i$ 和 $v_j$ 的集合执行 `union` 操作。最终不相交集的数量即为 $\\beta_0$。\n\n**$\\beta_1$ 的计算**\n第 1 个 Betti 数 $\\beta_1$ 是第 1 个同调群 $H_1 = \\ker(\\partial_1) / \\operatorname{im}(\\partial_2)$ 的维数。边界算子 $\\partial_k$ 将 $k$-链映射到 $(k-1)$-链。这些群的维数通过秩-零度定理相关联。对于一个具有 $|V|$ 个顶点、$|E|$ 条边和 $|T|$ 个三角形的单纯复形，在域上计算 $\\beta_1$ 的公式为：\n$$ \\beta_1 = \\dim(\\ker \\partial_1) - \\dim(\\operatorname{im} \\partial_2) $$\n根据秩-零度定理，$\\dim(\\ker \\partial_1) = \\dim(C_1) - \\operatorname{rank}(\\partial_1)$，其中 $C_1$ 是 1-单纯形的链群。我们有 $\\dim(C_1) = |E|$。边界算子 $\\partial_1: C_1 \\to C_0$ 的秩与图的连通性有关：$\\operatorname{rank}(\\partial_1) = |V| - \\beta_0$。项 $\\dim(\\operatorname{im} \\partial_2)$ 就是边界算子 $\\partial_2: C_2 \\to C_1$ 的秩。\n将这些结合起来，我们得到公式：\n$$ \\beta_1 = (|E| - (|V| - \\beta_0)) - \\operatorname{rank}(\\partial_2) $$\n为了计算 $\\beta_1$，我们需要求出 $\\operatorname{rank}(\\partial_2)$。这通过以下步骤实现：\n1.  识别 VR 复形中的所有顶点、边和三角形。设它们的数量分别为 $|V|$、$|E|$ 和 $|T|$。我们已经计算出 $\\beta_0$。\n2.  构建边界矩阵 $\\mathbf{M}_{\\partial_2}$。这是一个在 $\\mathbb{F}_2$ 上的 $|E| \\times |T|$ 矩阵。每一列对应一个 2-单纯形（三角形），每一行对应一个 1-单纯形（边）。如果第 $i$ 条边是第 $j$ 个三角形的一个面，则矩阵元素 $m_{ij}$ 为 $1$，否则为 $0$。\n3.  计算 $\\mathbf{M}_{\\partial_2}$ 在 $\\mathbb{F}_2$ 上的秩。这通过高斯消元法完成，其中算术运算（加法和减法）被异或（XOR）运算取代。秩是在消元过程中找到的主元数量。\n4.  将所有计算出的值代入 $\\beta_1$ 的公式中。\n\n**模式坍塌指示符**\n最后，对于每个测试用例，我们为真实嵌入（$\\beta_0^{\\mathrm{real}}$, $\\beta_1^{\\mathrm{real}}$）和生成嵌入（$\\beta_0^{\\mathrm{gen}}$, $\\beta_1^{\\mathrm{gen}}$）计算 Betti 数。坍塌指示符 $C$ 是一个布尔值，由以下条件定义：\n$$ C = (\\beta_0^{\\mathrm{gen}} < \\beta_0^{\\mathrm{real}}) \\land (\\beta_1^{\\mathrm{gen}} \\le \\beta_1^{\\mathrm{real}}) $$\n这个条件从拓扑学意义上形式化了“模式坍塌”的概念，即生成的数据未能捕获所有不同的簇（$\\beta_0$ 下降），同时没有引入新的、虚假的拓扑结构（$\\beta_1$ 没有增加）。\n\n每个测试用例的总体算法是将此 Betti 数计算应用于真实点集和生成点集，然后评估 $C$ 的布尔表达式。最终输出是一个包含所有测试用例结果的列表。",
            "answer": "[[2, 0, 1, 0, True], [1, 1, 1, 0, False], [3, 0, 1, 0, True]]"
        },
        {
            "introduction": "除了评估生成数据的统计相似性，确保其符合已知的生物学定律也至关重要。对于许多生物系统，例如代谢网络，生成的样本必须遵守严格的物理或化学守恒定律才能具有实际意义。本练习将探讨如何将领域知识整合到 GAN 工作流中，具体方法是将一个原始的生成向量投影到满足约束条件的可行解空间上。你将以代谢通量向量和化学计量约束 $S v = 0$ 为例，推导并计算实现这一目标的投影算子，从而连接纯数据驱动生成与生物学知识引导的建模 。",
            "id": "3316149",
            "problem": "一个生成对抗网络 (GAN) 被训练用于为一个包含两种内部代谢物的线性三反应通路合成稳态代谢通量向量。其化学计量矩阵由下式给出\n$$\nS = \\begin{pmatrix}\n1  -1  0 \\\\\n0  1  -1\n\\end{pmatrix},\n$$\n该矩阵通过约束 $S v = 0$ 对任何可行的通量向量 $v \\in \\mathbb{R}^{3}$ 编码了稳态下的质量平衡。矩阵 $S$ 是行满秩的。\n\n为了在对生成的通量向量 $\\tilde{v} \\in \\mathbb{R}^{3}$ 严格执行化学计量约束的同时，在标准欧几里得范数下做出尽可能小的改变，我们考虑寻找 $v^{\\star}$ 作为在以下线性约束下到 $\\tilde{v}$ 的无约束距离的最小化问题：\n$$\n\\text{minimize } \\frac{1}{2}\\|v - \\tilde{v}\\|_{2}^{2} \\quad \\text{subject to} \\quad S v = 0.\n$$\n从稳态质量守恒 ($S v = 0$) 的原理、正交投影的欧几里得几何以及标准的拉格朗日乘数法出发，推导出一个显式的线性算子 $P \\in \\mathbb{R}^{3 \\times 3}$，该算子将任意 $\\tilde{v}$ 映射到上述优化问题的唯一解 $v^{\\star}$。然后，使用给定的 $S$ 计算 $P$。\n\n请以具有有理数项的单一闭式矩阵形式，精确提供最终的算子 $P$。最终表达式中不需四舍五入，也不应包含单位。",
            "solution": "所述问题是有效的。它在科学上基于代谢建模和凸优化的原理，问题提法良好且有唯一解，并且形式上规范无歧义。因此，我们可以进行推导。\n\n问题在于找到向量 $v^{\\star}$，它是以下约束优化问题的解：\n$$\n\\text{minimize } f(v) = \\frac{1}{2}\\|v - \\tilde{v}\\|_{2}^{2} \\quad \\text{subject to} \\quad S v = 0\n$$\n其中 $v, \\tilde{v} \\in \\mathbb{R}^{3}$ 且 $S \\in \\mathbb{R}^{2 \\times 3}$。向量 $v^{\\star}$ 是生成的向量 $\\tilde{v}$ 在化学计量矩阵 $S$ 的零空间（记作 $\\text{Null}(S)$）上的正交投影。零空间代表了所有可行稳态通量向量的集合。\n\n我们将使用拉格朗日乘数法来解决这个问题。拉格朗日函数 $\\mathcal{L}(v, \\lambda)$ 是通过将目标函数与由拉格朗日乘数向量 $\\lambda \\in \\mathbb{R}^{2}$ 加权的等式约束相加来构造的：\n$$\n\\mathcal{L}(v, \\lambda) = \\frac{1}{2}\\|v - \\tilde{v}\\|_{2}^{2} + \\lambda^T (S v)\n$$\n目标函数 $f(v)$ 是严格凸的，且约束是线性的，因此一阶最优性必要条件也是充分条件。通过将拉格朗日函数相对于 $v$ 和 $\\lambda$ 的梯度设置为零，可以找到这些条件。\n\n相对于 $v$ 的梯度是：\n$$\n\\nabla_v \\mathcal{L}(v, \\lambda) = \\frac{\\partial}{\\partial v} \\left( \\frac{1}{2}(v - \\tilde{v})^T(v - \\tilde{v}) + \\lambda^T S v \\right) = (v - \\tilde{v}) + S^T \\lambda\n$$\n将此梯度设为零，得到第一个条件：\n$$\nv - \\tilde{v} + S^T \\lambda = 0 \\implies v = \\tilde{v} - S^T \\lambda\n$$\n相对于 $\\lambda$ 的梯度只是恢复了原始约束：\n$$\n\\nabla_\\lambda \\mathcal{L}(v, \\lambda) = S v = 0\n$$\n为了找到最优解 $v^{\\star}$，我们将第一个条件中 $v$ 的表达式代入第二个条件：\n$$\nS(\\tilde{v} - S^T \\lambda) = 0\n$$\n$$\nS\\tilde{v} - S S^T \\lambda = 0\n$$\n这导出了关于拉格朗日乘数 $\\lambda$ 的一个线性系统：\n$$\nS S^T \\lambda = S \\tilde{v}\n$$\n问题陈述指明矩阵 $S$ 是行满秩的。对于 $S \\in \\mathbb{R}^{2 \\times 3}$，这意味着 $\\text{rank}(S) = 2$。因此，格拉姆矩阵 $S S^T \\in \\mathbb{R}^{2 \\times 2}$ 是可逆的。所以我们可以解出 $\\lambda$：\n$$\n\\lambda = (S S^T)^{-1} S \\tilde{v}\n$$\n现在，我们将 $\\lambda$ 的这个表达式代回到最优向量的方程中，我们将其表示为 $v^{\\star}$：\n$$\nv^{\\star} = \\tilde{v} - S^T \\left( (S S^T)^{-1} S \\tilde{v} \\right)\n$$\n通过提出公因子 $\\tilde{v}$，我们可以确定线性算子 $P$，使得 $v^{\\star} = P \\tilde{v}$：\n$$\nv^{\\star} = \\left( I - S^T (S S^T)^{-1} S \\right) \\tilde{v}\n$$\n因此，投影算子为：\n$$\nP = I - S^T (S S^T)^{-1} S\n$$\n其中 $I$ 是 $3 \\times 3$ 的单位矩阵。这是到 $S$ 的零空间上的正交投影矩阵的一般形式。\n\n现在，我们为给定的化学计量矩阵计算这个算子：\n$$\nS = \\begin{pmatrix} 1  -1  0 \\\\ 0  1  -1 \\end{pmatrix}\n$$\n$S$ 的转置是：\n$$\nS^T = \\begin{pmatrix} 1  0 \\\\ -1  1 \\\\ 0  -1 \\end{pmatrix}\n$$\n首先，我们计算乘积 $S S^T$：\n$$\nS S^T = \\begin{pmatrix} 1  -1  0 \\\\ 0  1  -1 \\end{pmatrix} \\begin{pmatrix} 1  0 \\\\ -1  1 \\\\ 0  -1 \\end{pmatrix} = \\begin{pmatrix} 1 \\cdot 1 + (-1) \\cdot (-1)  1 \\cdot 0 + (-1) \\cdot 1 \\\\ 0 \\cdot 1 + 1 \\cdot (-1)  0 \\cdot 0 + 1 \\cdot 1 + (-1) \\cdot (-1) \\end{pmatrix} = \\begin{pmatrix} 2  -1 \\\\ -1  2 \\end{pmatrix}\n$$\n接下来，我们求 $S S^T$ 的逆。其行列式为 $\\det(S S^T) = (2)(2) - (-1)(-1) = 4 - 1 = 3$。\n$$\n(S S^T)^{-1} = \\frac{1}{3} \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}\n$$\n现在我们计算乘积 $S^T (S S^T)^{-1} S$：\n$$\nS^T (S S^T)^{-1} = \\begin{pmatrix} 1  0 \\\\ -1  1 \\\\ 0  -1 \\end{pmatrix} \\frac{1}{3} \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix} = \\frac{1}{3} \\begin{pmatrix} 1 \\cdot 2 + 0 \\cdot 1  1 \\cdot 1 + 0 \\cdot 2 \\\\ -1 \\cdot 2 + 1 \\cdot 1  -1 \\cdot 1 + 1 \\cdot 2 \\\\ 0 \\cdot 2 + (-1) \\cdot 1  0 \\cdot 1 + (-1) \\cdot 2 \\end{pmatrix} = \\frac{1}{3} \\begin{pmatrix} 2  1 \\\\ -1  1 \\\\ -1  -2 \\end{pmatrix}\n$$\n$$\nS^T (S S^T)^{-1} S = \\frac{1}{3} \\begin{pmatrix} 2  1 \\\\ -1  1 \\\\ -1  -2 \\end{pmatrix} \\begin{pmatrix} 1  -1  0 \\\\ 0  1  -1 \\end{pmatrix} = \\frac{1}{3} \\begin{pmatrix} 2  -1  -1 \\\\ -1  2  -1 \\\\ -1  -1  2 \\end{pmatrix}\n$$\n最后，我们计算投影算子 $P = I - S^T (S S^T)^{-1} S$：\n$$\nP = \\begin{pmatrix} 1  0  0 \\\\ 0  1  0 \\\\ 0  0  1 \\end{pmatrix} - \\frac{1}{3} \\begin{pmatrix} 2  -1  -1 \\\\ -1  2  -1 \\\\ -1  -1  2 \\end{pmatrix}\n$$\n$$\nP = \\begin{pmatrix} 1 - \\frac{2}{3}  & 0 - (-\\frac{1}{3})  & 0 - (-\\frac{1}{3}) \\\\ 0 - (-\\frac{1}{3})  & 1 - \\frac{2}{3}  & 0 - (-\\frac{1}{3}) \\\\ 0 - (-\\frac{1}{3})  & 0 - (-\\frac{1}{3})  & 1 - \\frac{2}{3} \\end{pmatrix} = \\begin{pmatrix} \\frac{1}{3}  \\frac{1}{3}  \\frac{1}{3} \\\\ \\frac{1}{3}  \\frac{1}{3}  \\frac{1}{3} \\\\ \\frac{1}{3}  \\frac{1}{3}  \\frac{1}{3} \\end{pmatrix}\n$$\n这个矩阵将任何向量 $\\tilde{v} \\in \\mathbb{R}^{3}$ 投影到 $S$ 的零空间上。$S$ 的零空间由 $v_1 - v_2 = 0$ 和 $v_2 - v_3 = 0$ 定义，这意味着 $v_1 = v_2 = v_3$。这是由向量 $(1, 1, 1)^T$ 张成的一维子空间。推导出的算子 $P$ 正确地将任何向量投影到这个子空间上。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} \\frac{1}{3}  \\frac{1}{3}  \\frac{1}{3} \\\\ \\frac{1}{3}  \\frac{1}{3}  \\frac{1}{3} \\\\ \\frac{1}{3}  \\frac{1}{3}  \\frac{1}{3} \\end{pmatrix}}\n$$"
        }
    ]
}