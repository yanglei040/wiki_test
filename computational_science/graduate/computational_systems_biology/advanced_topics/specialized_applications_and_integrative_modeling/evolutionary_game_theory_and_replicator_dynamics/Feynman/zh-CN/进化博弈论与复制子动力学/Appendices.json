{
    "hands_on_practices": [
        {
            "introduction": "这第一个练习  旨在探索复制子方程的动态行为与静态博弈论概念“风险占优”之间的根本联系。在一个简单的双策略协调博弈背景下，您将推导每个均衡的吸引盆，以理解进化选择如何能够偏爱某个稳定状态。这个练习为均衡选择标准提供了动态的合理解释，并帮助建立对初始种群构成如何决定长期进化结果的基础理解。",
            "id": "3307090",
            "problem": "在计算系统生物学中，考虑一个充分混合的微生物种群，其中细胞采用两种信号策略之一，记为 $A$ 和 $B$。相互作用是成对且对称的，焦点细胞的支付仅取决于焦点细胞和伙伴细胞的策略，其支付矩阵如下：\n$$\n\\begin{pmatrix} a  b \\\\ c  d \\end{pmatrix},\n$$\n其中 $a$、$b$、$c$ 和 $d$ 是代表相互作用支付的实常数。假设存在一个具有两个纯策略均衡的协调机制，即 $ac$ 和 $db$。令 $x \\in [0,1]$ 表示种群中使用策略 $A$ 的比例。\n\n在弱选择下，适应度是支付的仿射函数：对于选择强度 $w \\in (0,1)$，使用策略 $i \\in \\{A,B\\}$ 的细胞的适应度为 $f_{i}(x) = 1 - w + w\\,\\pi_{i}(x)$，其中 $\\pi_{A}(x) = a x + b (1-x)$ 且 $\\pi_{B}(x) = c x + d (1-x)$。种群动力学遵循复制子方程 $\\dot{x} = x\\,(f_{A}(x) - \\bar{f}(x))$，其中 $\\bar{f}(x)$ 是种群的平均适应度。\n\n从这些定义和假设出发，从第一性原理推导，在弱选择极限 $w \\to 0^{+}$ 下，对于从 $[0,1]$ 中均匀随机抽取的初始种群状态 $x(0)$，其在复制子动力学下收敛到 $A$ 单态均衡的比例的解析表达式。最终答案应纯粹用 $a$、$b$、$c$ 和 $d$ 以闭式表达式表示。答案中不应陈述任何中间公式。无需四舍五入，表达式中也不应包含单位。在推导过程中，请证明为什么弱选择极限能识别出具有更大吸引盆的均衡，并根据吸引盆边界解释这如何与对称 $2 \\times 2$ 协调博弈中的风险优势相关联，而无需直接引用预先形成的选择标准。",
            "solution": "该问题要求计算在对称的 $2 \\times 2$ 协调博弈中，在复制子动力学下收敛到 A 单态均衡的初始种群状态的比例。这个比例对应于该均衡（即种群完全由策略 A 的使用者组成）的吸引盆的归一化大小。\n\n首先，我们根据给定的定义将复制子方程形式化。种群状态由 $x$ 给出，即使用策略 A 的个体比例，其中 $x \\in [0,1]$。动力学由 $\\dot{x} = x(f_{A}(x) - \\bar{f}(x))$ 描述，其中 $f_{A}(x)$ 是策略 A 使用者的适应度，$\\bar{f}(x)$ 是种群的平均适应度。\n\n平均适应度定义为 $\\bar{f}(x) = x f_{A}(x) + (1-x) f_{B}(x)$。将其代入复制子方程可得：\n$$\n\\dot{x} = x(f_{A}(x) - [x f_{A}(x) + (1-x) f_{B}(x)])\n$$\n$$\n\\dot{x} = x( (1-x)f_{A}(x) - (1-x)f_{B}(x) )\n$$\n$$\n\\dot{x} = x(1-x)(f_{A}(x) - f_{B}(x))\n$$\n这种形式的复制子方程表明，比例 $x$ 的变化与两种策略之间的适应度差异成正比。\n\n适应度函数为 $f_{i}(x) = 1 - w + w\\,\\pi_{i}(x)$，其中 $w \\in (0,1)$ 是选择强度。适应度之差为：\n$$\nf_{A}(x) - f_{B}(x) = (1 - w + w\\,\\pi_{A}(x)) - (1 - w + w\\,\\pi_{B}(x)) = w(\\pi_{A}(x) - \\pi_{B}(x))\n$$\n期望支付 $\\pi_A(x)$ 和 $\\pi_B(x)$ 为：\n$$\n\\pi_{A}(x) = a x + b (1-x)\n$$\n$$\n\\pi_{B}(x) = c x + d (1-x)\n$$\n期望支付之差为：\n$$\n\\pi_{A}(x) - \\pi_{B}(x) = (ax + b(1-x)) - (cx + d(1-x)) = (a-c)x - (d-b)(1-x) = (a-c+d-b)x - (d-b)\n$$\n将此代回复制子方程，得到 $x$ 的完整动力学方程：\n$$\n\\dot{x} = w x(1-x)[(a-c+d-b)x - (d-b)]\n$$\n动力学系统的不动点是使 $\\dot{x}=0$ 的 $x$ 值。从方程中，我们可以确定三个这样的点：\n1.  $x^* = 0$，即B单态均衡。\n2.  $x^* = 1$，即A单态均衡。\n3.  一个内部不动点 $x_{int}$，此时方括号内的项为零：\n    $$\n    (a-c+d-b)x_{int} - (d-b) = 0\n    $$\n    解出 $x_{int}$ 得：\n    $$\n    x_{int} = \\frac{d-b}{a-c+d-b}\n    $$\n问题陈述我们处于一个协调机制中，其中 $ac$ 和 $db$。这些条件确保 $x_{int}$ 严格位于 $0$ 和 $1$ 之间。分子 $d-b$ 是正的，分母 $(a-c)+(d-b)$ 也是正的。因此，$x_{int}  0$。此外，由于 $a-c  0$，有 $d-b  (a-c)+(d-b)$，这意味着 $x_{int}  1$。\n\n接下来，我们分析这些不动点的稳定性，以确定吸引盆。对于 $x \\in (0,1)$，$\\dot{x}$ 的符号由多项式 $P(x) = (a-c+d-b)x - (d-b)$ 的符号决定。这是一个关于 $x$ 的线性函数，斜率为正（因为 $a-c+d-b  0$），根在 $x=x_{int}$。\n- 对于 $x \\in (0, x_{int})$，我们有 $P(x)  0$，这意味着 $\\dot{x}  0$。从该区间开始的轨迹将朝 $x=0$ 移动。\n- 对于 $x \\in (x_{int}, 1)$，我们有 $P(x)  0$，这意味着 $\\dot{x}  0$。从该区间开始的轨迹将朝 $x=1$ 移动。\n\n该分析表明，单态均衡 $x^*=0$ 和 $x^*=1$ 是稳定不动点（吸引子），而内部不动点 $x_{int}$ 是不稳定不动点（排斥子）。点 $x_{int}$ 作为一条分界线，将状态空间 $[0,1]$ 分为两个吸引盆。\n- B单态均衡（$x^*=0$）的吸引盆是区间 $[0, x_{int})$。\n- A单态均衡（$x^*=1$）的吸引盆是区间 $(x_{int}, 1]$。\n\n问题要求从 $[0,1]$ 中均匀随机抽取的初始状态 $x(0)$ 收敛到 A 单态均衡的比例。这等价于 $x^*=1$ 的吸引盆的勒贝格测度（长度），因为总区间的长度为 $1$。\n$x^*=1$ 的吸引盆长度为：\n$$\n\\text{Length}((x_{int}, 1]) = 1 - x_{int}\n$$\n代入 $x_{int}$ 的表达式：\n$$\n1 - x_{int} = 1 - \\frac{d-b}{a-c+d-b} = \\frac{(a-c+d-b) - (d-b)}{a-c+d-b} = \\frac{a-c}{a-c+d-b}\n$$\n该表达式仅依赖于支付参数 $a, b, c, d$，而与选择强度 $w$ 无关。因此，取弱选择极限 $w \\to 0^{+}$ 对结果没有影响，因为只要 $w0$，相空间的几何结构就由支付矩阵决定。弱选择假设 $f_i = 1-w+w\\pi_i$ 的作用是确保演化动力学直接反映基础博弈的支付结构，使得动力学系统的内部不动点与该博弈的混合策略纳什均衡相同。\n\n最后，我们将此结果与风险优势的概念联系起来。在对称的 $2 \\times 2$ 协调博弈中，如果满足条件 $a-c  d-b$，则称策略 A 风险优势于策略 B。该条件比较了从每个纯策略纳什均衡单方面偏离的支付惩罚。\n\n如果策略 A 的吸引盆大小 $1-x_{int}$ 大于 $1/2$，则其吸引盆大于策略 B 的吸引盆。\n$$\n1-x_{int}  \\frac{1}{2} \\implies x_{int}  \\frac{1}{2}\n$$\n代入吸引盆边界 $x_{int}$ 的表达式：\n$$\n\\frac{d-b}{a-c+d-b}  \\frac{1}{2}\n$$\n由于分母为正，我们可以在两边同乘以 $2(a-c+d-b)$：\n$$\n2(d-b)  a-c+d-b\n$$\n$$\nd-b  a-c\n$$\n这恰好是策略 A 具有风险优势的条件。因此，复制子动力学预测，与风险优势策略对应的均衡将具有更大的吸引盆。吸引盆边界 $x_{int}$ 是临界阈值；如果一个策略的初始频率大于其在不稳定混合均衡中的比例，它最终将占领整个种群。风险优势均衡是能够从更高不确定性状态（即较小的初始频率，只要它高于小于 $1/2$ 的阈值 $x_{int}$）入侵的均衡。这个推导将种群水平的动力学与博弈论中的风险优势概念联系起来，而没有先验地假设除复制子方程本身之外的任何选择标准。\n\n收敛到 A 单态均衡的初始状态比例的解析表达式是 $\\frac{a-c}{a-c+d-b}$。",
            "answer": "$$\n\\boxed{\\frac{a-c}{a-c+d-b}}\n$$"
        },
        {
            "introduction": "从两个策略扩展到三个策略，为更复杂的动态行为（如振荡和循环占优）打开了大门。本练习  以经典的“石头-剪刀-布”博弈为例，这是一个模拟微生物群落中循环竞争的模型，旨在培养您分析高维系统的技能。您将练习在内部均衡点附近对动力学进行线性化并判断其稳定性，最终计算出振荡频率，该频率刻画了系统在不动点附近的行为特征。",
            "id": "3307089",
            "problem": "在一个关于 $3$ 种微生物菌株之间循环优势的计算系统生物学模型中，假设成对相互作用由演化博弈论意义下的对称适应度博弈编码，种群构成 $x = (x_{1}, x_{2}, x_{3})$ 在单位单纯形上根据复制子常微分方程 (ODE) 演化\n$$\n\\dot{x}_{i} = x_{i} \\left( (A x)_{i} - x^{\\top} A x \\right), \\quad i \\in \\{1,2,3\\},\n$$\n其中 $A \\in \\mathbb{R}^{3 \\times 3}$ 是收益矩阵，而 $x^{\\top} A x$ 表示平均适应度。考虑具有反对称收益矩阵的石头剪刀布 (RPS) 相互作用结构\n$$\nA = \\begin{pmatrix}\n0  a  -c \\\\\n-a  0  b \\\\\nc  -b  0\n\\end{pmatrix},\n$$\n其中 $a$、$b$ 和 $c$ 是实数参数，量化了在循环优势中一个菌株相对于另一个菌株的优势。假设 $a0$、$b0$ 和 $c0$，以便所有三个菌株都能以循环方式相互入侵，并且存在一个内部均衡点。\n\n从复制子 ODE 的基本定义和给定的 $A$ 的反对称结构出发，完成以下任务：\n- 推导内部均衡点 $x^{\\ast}$。\n- 在 $x^{\\ast}$ 处对复制子动力学进行线性化，并根据参数 $a$、$b$ 和 $c$ 对 $x^{\\ast}$ 的稳定性进行分类。\n- 计算 $x^{\\ast}$ 邻域内小振幅循环的精确角频率 $\\omega$，并以 $a$、$b$ 和 $c$ 的闭式函数形式表示。\n\n将最终答案表示为 $\\omega$ 的单个闭式解析表达式。无需四舍五入，也无需物理单位。如果 $a$、$b$ 或 $c$ 为零或负数，请用文字解释分类如何变化，但您的最终答案仍必须是在 $a0$、$b0$ 和 $c0$ 假设下的 $\\omega$ 表达式。",
            "solution": "针对 $3$ 种策略的复制子常微分方程 (ODE) 为\n$$\n\\dot{x}_{i} = x_{i} \\left( (A x)_{i} - x^{\\top} A x \\right), \\quad i \\in \\{1,2,3\\}。\n$$\n我们首先利用 $A$ 的反对称性。因为 $A^{\\top} = -A$，对于任何 $x \\in \\mathbb{R}^{3}$，我们有\n$$\nx^{\\top} A x = - x^{\\top} A x \\;\\Rightarrow\\; x^{\\top} A x = 0。\n$$\n因此，对于反对称的石头剪刀布 (RPS) 博弈，复制子 ODE 简化为\n$$\n\\dot{x}_{i} = x_{i} (A x)_{i}, \\quad i \\in \\{1,2,3\\}。\n$$\n一个内部均衡点 $x^{\\ast}$（满足 $x_{i}^{\\ast}  0$ 且 $x_{1}^{\\ast} + x_{2}^{\\ast} + x_{3}^{\\ast} = 1$）必须对所有 $i$ 满足 $(A x^{\\ast})_{i} = 0$，因为 $x^{\\top} A x \\equiv 0$ 且 $\\dot{x}_{i} = x_{i} (A x)_{i}$。因此，$x^{\\ast}$ 位于 $A$ 的核空间中：\n$$\nA x^{\\ast} = 0。\n$$\n对于\n$$\nA = \\begin{pmatrix}\n0  a  -c \\\\\n-a  0  b \\\\\nc  -b  0\n\\end{pmatrix},\n$$\n记 $x^{\\ast} = (x_{1}^{\\ast}, x_{2}^{\\ast}, x_{3}^{\\ast})$。方程 $A x^{\\ast} = 0$ 为\n$$\na x_{2}^{\\ast} - c x_{3}^{\\ast} = 0, \\quad - a x_{1}^{\\ast} + b x_{3}^{\\ast} = 0, \\quad c x_{1}^{\\ast} - b x_{2}^{\\ast} = 0。\n$$\n这些方程给出了比率\n$$\nx_{2}^{\\ast} = \\frac{c}{a} x_{3}^{\\ast}, \\qquad x_{1}^{\\ast} = \\frac{b}{a} x_{3}^{\\ast}。\n$$\n归一化到单位单纯形 $x_{1}^{\\ast} + x_{2}^{\\ast} + x_{3}^{\\ast} = 1$ 上，得到\n$$\nx^{\\ast} = \\frac{1}{a + b + c} \\left( b,\\, c,\\, a \\right)。\n$$\n在 $a0$、$b0$ 和 $c0$ 的假设下，$x^{\\ast}$ 确实是一个内部均衡点。\n\n为了对稳定性进行分类，我们在 $x^{\\ast}$ 处对动力学进行线性化。考虑雅可比矩阵 $J$，其元素为\n$$\nJ_{ij} = \\left. \\frac{\\partial \\dot{x}_{i}}{\\partial x_{j}} \\right|_{x = x^{\\ast}}。\n$$\n根据 $\\dot{x}_{i} = x_{i} (A x)_{i}$ 和乘法法则，\n$$\n\\frac{\\partial \\dot{x}_{i}}{\\partial x_{j}} = \\delta_{ij} (A x)_{i} + x_{i} A_{ij}。\n$$\n在 $x = x^{\\ast}$ 处，$(A x^{\\ast})_{i} = 0$，所以第一项消失，\n$$\nJ_{ij} = x_{i}^{\\ast} A_{ij}。\n$$\n因此，\n$$\nJ = D A, \\quad \\text{其中} \\quad D = \\mathrm{diag}(x_{1}^{\\ast}, x_{2}^{\\ast}, x_{3}^{\\ast})。\n$$\n因为 $A$ 是反对称的，而 $D$ 是正定对角矩阵，所以 $J$ 有一个零特征值，对应于与单纯形约束相关的不变方向，另外两个特征值是纯虚数且共轭的。要证明这一点并量化振荡频率，一种方法是计算 $\\mathrm{trace}(J^{2})$ 并使用以下恒等式：如果 $J$ 的特征值为 $\\{0,\\, \\mathrm{i} \\omega,\\, - \\mathrm{i} \\omega\\}$，则\n$$\n\\mathrm{trace}(J^{2}) = 0 + (-\\omega^{2}) + (-\\omega^{2}) = - 2 \\omega^{2}。\n$$\n因此，我们计算 $J^{2}$ 及其迹。对于\n$$\nJ = \\begin{pmatrix}\n0  x_{1}^{\\ast} a  - x_{1}^{\\ast} c \\\\\n- x_{2}^{\\ast} a  0  x_{2}^{\\ast} b \\\\\nx_{3}^{\\ast} c  - x_{3}^{\\ast} b  0\n\\end{pmatrix},\n$$\n$J^{2}$ 的对角线元素是\n$$\n(J^{2})_{11} = J_{12} J_{21} + J_{13} J_{31} = - x_{1}^{\\ast} x_{2}^{\\ast} a^{2} - x_{1}^{\\ast} x_{3}^{\\ast} c^{2},\n$$\n$$\n(J^{2})_{22} = J_{21} J_{12} + J_{23} J_{32} = - x_{1}^{\\ast} x_{2}^{\\ast} a^{2} - x_{2}^{\\ast} x_{3}^{\\ast} b^{2},\n$$\n$$\n(J^{2})_{33} = J_{31} J_{13} + J_{32} J_{23} = - x_{1}^{\\ast} x_{3}^{\\ast} c^{2} - x_{2}^{\\ast} x_{3}^{\\ast} b^{2}。\n$$\n因此，\n$$\n\\mathrm{trace}(J^{2}) = (J^{2})_{11} + (J^{2})_{22} + (J^{2})_{33} = - 2 \\left( x_{1}^{\\ast} x_{2}^{\\ast} a^{2} + x_{1}^{\\ast} x_{3}^{\\ast} c^{2} + x_{2}^{\\ast} x_{3}^{\\ast} b^{2} \\right)。\n$$\n令其等于 $- 2 \\omega^{2}$ 可得\n$$\n\\omega^{2} = x_{1}^{\\ast} x_{2}^{\\ast} a^{2} + x_{1}^{\\ast} x_{3}^{\\ast} c^{2} + x_{2}^{\\ast} x_{3}^{\\ast} b^{2}。\n$$\n代入 $x^{\\ast} = \\frac{1}{a + b + c} (b, c, a)$ 可得\n$$\nx_{1}^{\\ast} x_{2}^{\\ast} a^{2} = \\frac{b c}{(a + b + c)^{2}} a^{2}, \\quad x_{1}^{\\ast} x_{3}^{\\ast} c^{2} = \\frac{b a}{(a + b + c)^{2}} c^{2}, \\quad x_{2}^{\\ast} x_{3}^{\\ast} b^{2} = \\frac{c a}{(a + b + c)^{2}} b^{2}。\n$$\n因此，\n$$\n\\omega^{2} = \\frac{a^{2} b c + b a c^{2} + c a b^{2}}{(a + b + c)^{2}} = \\frac{a b c (a + b + c)}{(a + b + c)^{2}} = \\frac{a b c}{a + b + c},\n$$\n且角频率为\n$$\n\\omega = \\sqrt{\\frac{a b c}{a + b + c}}。\n$$\n这表明对于所有 $a0$、$b0$ 和 $c0$，内部均衡点是一个中性稳定中心，其邻域内的小振幅闭合轨道具有如上所述的角频率 $\\omega$。中性稳定性源于 $A$ 的反对称性，这使得复制子动力学在内部是保守的（存在一个运动常数），从而导致 $x^{\\ast}$ 附近的特征值为纯虚数。\n\n关于当 $a$、$b$ 或 $c$ 为零或负数时的分类：\n- 如果 $a$、$b$ 或 $c$ 中任何一个为零，则循环优势在一条边上被打破，矩阵 $A$ 变为秩亏的，其简化后的动力学通常具有一条不动点线或中性稳定的边；内部均衡点要么与边界碰撞，要么不复存在。\n- 如果 $a$、$b$ 或 $c$ 中任何一个为负数而其他为正数，则由 $(b, c, a)/(a + b + c)$ 决定的相应 $x^{\\ast}$ 分量将不为严格正数，因此不存在内部均衡点；动力学被限制在面上和边上，并可能出现异宿行为。\n在所述的 $a0$、$b0$ 和 $c0$ 假设下，内部均衡点存在且是中性稳定的，其精确角频率如上所示。",
            "answer": "$$\\boxed{\\sqrt{\\frac{a b c}{a + b + c}}}$$"
        },
        {
            "introduction": "复制子方程是一个假设种群无限大的确定性模型。这最后一个练习  将挑战您，要求您将这一理想化模型与更现实的、描述有限种群的随机 Wright-Fisher 模型联系起来。通过在弱选择条件下推导这两种框架之间的形式对应关系，并进行计算比较，您将更深刻地理解确定性模型的局限性，以及选择强度和遗传漂变在塑造进化轨迹中的关键作用。",
            "id": "3307058",
            "problem": "你的任务是在计算系统生物学领域内，形式化并检验一个从连续时间复制子动态到一个双策略博弈中离散世代赖特-费雪（WF）选择模型的原则性映射。你的解决方案必须是一个完整的、可运行的程序，用于评估该映射在指定条件下是否能保持轨迹。\n\n使用的基本原理：\n- 双策略的复制子动态：对于一个种群，策略 $A$ 的频率为 $x$，策略 $B$ 的频率为 $1-x$，其期望支付 $f_A(x)$ 和 $f_B(x)$ 由一个 $2 \\times 2$ 的支付矩阵 $\\Pi = \\begin{pmatrix} a  b \\\\ c  d \\end{pmatrix}$ 决定，连续时间复制子方程为\n$$\n\\frac{dx}{dt} = x \\left(f_A(x) - \\bar f(x)\\right) = x(1-x)\\left(f_A(x) - f_B(x)\\right),\n$$\n其中 $f_A(x) = a x + b (1-x)$，$f_B(x) = c x + d (1-x)$，且 $\\bar f(x) = x f_A(x) + (1-x) f_B(x)$。\n- 赖特-费雪选择模型：在一个有效种群大小为 $N_e$（有效种群大小）的种群中，对于单倍体基因型。在离散的第 $k$ 代，策略 $A$ 的频率为 $x_k$，选择过程产生的抽样概率与适应度成正比，下一代中 $A$ 的数量服从二项分布。在弱选择下，使用适应度参数化 $w_A(x) = 1 + s f_A(x)$ 和 $w_B(x) = 1 + s f_B(x)$，其中 $s$ 是选择系数且 $s$ 很小。一个个体 $A$ 的条件抽样概率为 $p(x) = \\frac{x w_A(x)}{x w_A(x) + (1-x) w_B(x)}$。\n\n任务：\n1. 仅使用上述基本原理，进行原则性推导，确定复制子时间步长与赖特-费雪选择系数之间的映射关系，使一个离散的WF代与一个无穷小的复制子时间步长对齐。你不能假设任何预先推导出的映射关系；相反，应从定义出发。\n2. 实现一个程序，对下述每个测试用例执行以下操作：\n   - 将复制子动态常微分方程（ODE）从 $t=0$ 积分到 $t = G \\cdot s$，其中 $G$ 是离散WF的世代数，并记录在时间 $t_k = k \\cdot s$（对于 $k \\in \\{0,1,\\dots,G\\}$）时的解。使用 $2 \\times 2$ 支付矩阵计算当前 $x$ 对应的 $f_A(x)$ 和 $f_B(x)$。\n   - 使用递归 $x^{\\mathrm{det}}_{k+1} = p(x^{\\mathrm{det}}_k)$（其中 $x^{\\mathrm{det}}_0 = x_0$，$p(x)$ 如上定义）计算一个确定性WF平均轨迹 $\\{x^{\\mathrm{det}}_k\\}_{k=0}^G$。\n   - 通过模拟 $R$ 个独立的WF重复实验（有效种群大小为 $N_e$）来计算一个随机WF系综平均轨迹 $\\{x^{\\mathrm{stoch}}_k\\}_{k=0}^G$。每个重复实验按 $X^{(r)}_{k+1} \\sim \\mathrm{Binomial}\\left(N_e, p\\left(X^{(r)}_k\\right)\\right)/N_e$ 进行更新，其中每个重复实验 $r \\in \\{1,\\dots,R\\}$ 的初始值为 $X^{(r)}_0 = x_0$。然后在每一代对所有重复实验进行平均，得到 $x^{\\mathrm{stoch}}_k = \\frac{1}{R}\\sum_{r=1}^R X^{(r)}_k$。为保证可复现性，请使用固定的伪随机种子。\n   - 使用均方根（RMS）误差量化复制子轨迹 $\\{x^{\\mathrm{rep}}(t_k)\\}$ 与两个WF轨迹之间的差异，\n     $$\n     \\mathrm{RMS}_{\\mathrm{det}} = \\sqrt{\\frac{1}{G+1} \\sum_{k=0}^G \\left( x^{\\mathrm{rep}}(t_k) - x^{\\mathrm{det}}_k \\right)^2}, \\quad\n     \\mathrm{RMS}_{\\mathrm{stoch}} = \\sqrt{\\frac{1}{G+1} \\sum_{k=0}^G \\left( x^{\\mathrm{rep}}(t_k) - x^{\\mathrm{stoch}}_k \\right)^2 }。\n     $$\n   - 对每个测试用例，返回一个布尔值，指示 $\\mathrm{RMS}_{\\mathrm{det}}$ 和 $\\mathrm{RMS}_{\\mathrm{stoch}}$ 是否都低于各自的容差 $\\varepsilon_{\\mathrm{det}}$ 和 $\\varepsilon_{\\mathrm{stoch}}$。\n3. 你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔的结果列表（例如，\"[True,False,True,False,True]\"）。\n\n角度单位不适用。答案不涉及物理单位。所有数值阈值和参数必须视为纯数字。\n\n使用以下测试套件。每个测试用例是一个元组：\n- $\\left([a,b;c,d], \\, x_0, \\, s, \\, N_e, \\, G, \\, R, \\, \\varepsilon_{\\mathrm{det}}, \\, \\varepsilon_{\\mathrm{stoch}}\\right)$\n\n按此顺序提供以下五个用例：\n1. $\\left([\\,3.0,\\,2.0;\\,1.0,\\,0.0\\,], \\, 0.2, \\, 0.01, \\, 5000, \\, 40, \\, 200, \\, 0.005, \\, 0.01\\right)$\n2. $\\left([\\,3.0,\\,0.0;\\,2.0,\\,1.0\\,], \\, 0.6, \\, 0.005, \\, 4000, \\, 60, \\, 200, \\, 0.004, \\, 0.01\\right)$\n3. $\\left([\\,3.0,\\,0.0;\\,2.0,\\,1.0\\,], \\, 0.6, \\, 0.25, \\, 5000, \\, 20, \\, 200, \\, 0.004, \\, 0.01\\right)$\n4. $\\left([\\,3.0,\\,0.0;\\,2.0,\\,1.0\\,], \\, 0.6, \\, 0.01, \\, 50, \\, 80, \\, 30, \\, 0.005, \\, 0.007\\right)$\n5. $\\left([\\,1.0,\\,1.0;\\,1.0,\\,1.0\\,], \\, 0.37, \\, 0.2, \\, 1000, \\, 50, \\, 200, \\, 1.0\\times 10^{-6}, \\, 0.003\\right)$\n\n你的程序必须实现你所推导的连续时间复制子动态与离散赖特-费雪过程之间的映射，并且必须为每个用例判断该映射是否根据指定的阈值保持了轨迹。最终输出必须是且仅为一行包含五个布尔值的Python列表，按顺序排列，无任何附加文本。",
            "solution": "该问题被评估为有效。它在科学上基于演化博弈论的既定原则，特别是复制子动态和群体遗传学的赖特-费雪模型。问题阐述清晰，提供了执行所需推导、模拟和分析所必需的所有定义、方程和参数。其语言客观，任务可形式化且计算上可行。\n\n解决方案主要分为两部分：首先，对连续时间模型和离散时间模型之间的映射关系进行原则性推导；其次，通过算法实现来数值检验此映射。\n\n**1. 时间步长映射的推导**\n\n目标是建立赖特-费雪（WF）选择模型的一个离散世代与连续时间复制子动态中的一个无穷小时间步长之间的形式对应关系。\n\n对于一个种群，策略A的频率为 $x$，策略B的频率为 $1-x$，其连续时间复制子方程由下式给出：\n$$\n\\frac{dx}{dt} = x(1-x) \\left( f_A(x) - f_B(x) \\right)\n$$\n其中 $f_A(x)$ 和 $f_B(x)$ 分别是策略A和B的期望支付，由支付矩阵 $\\Pi = \\begin{pmatrix} a  b \\\\ c  d \\end{pmatrix}$ 导出。具体而言，$f_A(x) = a x + b (1-x)$ 且 $f_B(x) = c x + d (1-x)$。\n\n赖特-费雪模型描述了频率在离散世代间的变化。第 $k+1$ 代中策略A的期望频率，记为 $x_{k+1}$，由第 $k$ 代的频率 $x_k$ 和策略的相对适应度决定。使用所给的弱选择（$s \\ll 1$）适应度参数化，适应度为 $w_A(x) = 1 + s f_A(x)$ 和 $w_B(x) = 1 + s f_B(x)$。在给定种群频率为 $x_k$ 的条件下，抽样到一个具有策略A的个体的条件概率为：\n$$\np(x_k) = \\frac{x_k w_A(x_k)}{x_k w_A(x_k) + (1-x_k) w_B(x_k)}\n$$\n这是下一代的期望频率，即 $x^{\\mathrm{det}}_{k+1} = p(x_k)$。一代内的频率变化 $\\Delta x_k$ 为：\n$$\n\\Delta x_k = x_{k+1} - x_k = p(x_k) - x_k = \\frac{x_k w_A(x_k)}{x_k w_A(x_k) + (1-x_k) w_B(x_k)} - x_k\n$$\n令 $\\bar w(x_k) = x_k w_A(x_k) + (1-x_k) w_B(x_k)$ 为种群的平均适应度。\n$$\n\\Delta x_k = \\frac{x_k w_A - x_k \\bar w}{\\bar w} = \\frac{x_k w_A - x_k (x_k w_A + (1-x_k) w_B)}{\\bar w} = \\frac{x_k(1-x_k)w_A - x_k(1-x_k)w_B}{\\bar w} = \\frac{x_k(1-x_k)(w_A - w_B)}{\\bar w}\n$$\n现在，我们代入适应度的定义：\n$$\nw_A(x_k) - w_B(x_k) = (1 + s f_A(x_k)) - (1 + s f_B(x_k)) = s (f_A(x_k) - f_B(x_k))\n$$\n平均适应度为：\n$$\n\\bar w(x_k) = x_k (1+sf_A(x_k)) + (1-x_k)(1+sf_B(x_k)) = 1 + s(x_k f_A(x_k) + (1-x_k)f_B(x_k)) = 1 + s \\bar f(x_k)\n$$\n其中 $\\bar f(x_k)$ 是平均支付。将这些代入 $\\Delta x_k$ 的表达式中：\n$$\n\\Delta x_k = \\frac{x_k(1-x_k) s (f_A(x_k) - f_B(x_k))}{1 + s \\bar f(x_k)}\n$$\n为了将此离散变化与连续微分方程联系起来，我们考虑弱选择的极限，即选择系数 $s$ 非常小（$s \\to 0$）。在此极限下，分母 $1 + s \\bar f(x_k) \\approx 1$。因此，每代的频率变化变为：\n$$\n\\Delta x_k \\approx s \\cdot x_k(1-x_k) (f_A(x_k) - f_B(x_k))\n$$\n我们可以将连续复制子方程视为一个离散过程在时间步长 $\\Delta t$ 趋于零时的极限，即 $\\frac{dx}{dt} = \\lim_{\\Delta t \\to 0} \\frac{\\Delta x}{\\Delta t}$。如果我们将一个WF世代等同于一个时长为 $\\Delta t$ 的时间步长，我们有：\n$$\n\\frac{\\Delta x_k}{\\Delta t} \\approx \\frac{s \\cdot x_k(1-x_k) (f_A(x_k) - f_B(x_k))}{\\Delta t}\n$$\n为了使这与复制子方程 $\\frac{dx}{dt} = x(1-x)(f_A(x) - f_B(x))$ 一致，我们必须有：\n$$\n\\frac{s}{\\Delta t} \\approx 1 \\implies \\Delta t \\approx s\n$$\n因此，WF模型中的一个离散世代对应于连续复制子动态中一个长度为 $\\Delta t = s$ 的时间间隔。因此，WF过程在 $k$ 代后的状态应与复制子ODE在时间 $t_k = k \\cdot s$ 的解进行比较。$G$ 个世代的总模拟时间为 $T = G \\cdot s$。这个推导出的映射是实现的核心。\n\n**2. 算法实现**\n\n该程序基于推导出的映射关系，为每个测试用例实现三个并行模拟。\n\n**复制子轨迹：** 对连续时间复制子ODE进行数值求解。\n- ODE函数实现 $\\frac{dx}{dt} = x(1-x)((a-c)x + (b-d)(1-x))$。\n- 我们使用 `scipy.integrate.solve_ivp`，一个鲁棒的自适应步长ODE求解器，从 $t=0$ 积分到 $t_{final} = G \\cdot s$。\n- 参数 `t_eval` 设置为 `np.linspace(0, G*s, G+1)`，以确保在时间点 $t_k = k \\cdot s$（其中 $k \\in \\{0, 1, \\dots, G\\}$）对解进行评估。这产生了轨迹 $\\{x^{\\mathrm{rep}}(t_k)\\}$。\n\n**确定性WF轨迹：** 使用精确的平均场更新规则计算确定性轨迹。\n- 从 $x^{\\mathrm{det}}_0 = x_0$ 开始，通过递归 $x^{\\mathrm{det}}_{k+1} = p(x^{\\mathrm{det}}_k)$（对于 $k \\in \\{0, \\dots, G-1\\}$）生成轨迹 $\\{x^{\\mathrm{det}}_k\\}$。\n- 函数 $p(x)$ 使用完整、未近似的下一代频率公式计算：$p(x) = \\frac{x(1+sf_A(x))}{x(1+sf_A(x))+(1-x)(1+sf_B(x))}$。\n- 该模拟可作为对推导中使用的弱选择近似的检验，因为此轨迹与复制子路径之间的误差预计会随 $s$ 的增大而增大。\n\n**随机WF轨迹：** 运行一组随机模拟以考虑遗传漂变。\n- 为了可复现性，使用固定种子初始化伪随机数生成器。\n- 模拟 $R$ 个独立的重复实验。对于每个重复实验 $r$ 和世代 $k$，从 $X_0^{(r)} = x_0$ 开始，下一代中策略A的个体数从二项分布中抽取：$N_{A, k+1}^{(r)} \\sim \\mathrm{Binomial}(N_e, p(X_k^{(r)}))$。频率更新为 $X_{k+1}^{(r)} = N_{A, k+1}^{(r)} / N_e$。\n- 通过在每个世代 $k$ 对所有 $R$ 个重复实验的频率进行平均来计算系综平均轨迹 $\\{x^{\\mathrm{stoch}}_k\\}$：$x^{\\mathrm{stoch}}_k = \\frac{1}{R} \\sum_{r=1}^R X_k^{(r)}$。当 $N_e$ 和 $R$ 很大时，该轨迹预计会逼近复制子路径。\n\n**差异与评估：**\n对于每个测试用例，计算均方根（RMS）误差以量化连续复制子轨迹 $\\{x^{\\mathrm{rep}}(t_k)\\}$ 与两个离散WF轨迹 $\\{x^{\\mathrm{det}}_k\\}$ 和 $\\{x^{\\mathrm{stoch}}_k\\}$ 之间的差异。\n$$\n\\mathrm{RMS}_{\\mathrm{det}} = \\sqrt{\\frac{1}{G+1} \\sum_{k=0}^G \\left( x^{\\mathrm{rep}}(t_k) - x^{\\mathrm{det}}_k \\right)^2}\n$$\n$$\n\\mathrm{RMS}_{\\mathrm{stoch}} = \\sqrt{\\frac{1}{G+1} \\sum_{k=0}^G \\left( x^{\\mathrm{rep}}(t_k) - x^{\\mathrm{stoch}}_k \\right)^2}\n$$\n如果 $\\mathrm{RMS}_{\\mathrm{det}}  \\varepsilon_{\\mathrm{det}}$ 和 $\\mathrm{RMS}_{\\mathrm{stoch}}  \\varepsilon_{\\mathrm{stoch}}$（其中 $\\varepsilon_{\\mathrm{det}}$ 和 $\\varepsilon_{\\mathrm{stoch}}$ 是给定的容差）同时成立，则认为测试用例成功。最终输出是表示每个用例成功或失败的布尔值列表。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.integrate import solve_ivp\n\ndef run_one_case(payoff_matrix, x0, s, Ne, G, R, eps_det, eps_stoch):\n    \"\"\"\n    Runs a single test case comparing replicator dynamics with a Wright-Fisher model.\n    \"\"\"\n    # Unpack payoff matrix\n    Pi = np.array(payoff_matrix)\n    a, b, c, d = Pi.flatten()\n\n    # Define payoff functions based on the payoff matrix\n    def fA(x):\n        return a * x + b * (1.0 - x)\n\n    def fB(x):\n        return c * x + d * (1.0 - x)\n\n    # 1. Replicator Dynamics Integration\n    def replicator_ode(t, y):\n        x = y[0]\n        # dx/dt = x(1-x)(fA(x) - fB(x))\n        # Handle boundary cases to prevent numerical issues if x goes slightly out of [0, 1]\n        if x = 0.0 or x = 1.0:\n            return 0.0\n        return x * (1.0 - x) * (fA(x) - fB(x))\n\n    t_final = G * s\n    t_eval_points = np.linspace(0, t_final, G + 1)\n    \n    sol = solve_ivp(\n        replicator_ode,\n        [0.0, t_final],\n        [x0],\n        t_eval=t_eval_points,\n        method='RK45'\n    )\n    x_rep = sol.y[0]\n\n    # Define the discrete update function for WF model\n    def get_p(x_k):\n        # Handle boundary cases\n        if x_k = 0.0: return 0.0\n        if x_k = 1.0: return 1.0\n        \n        # Fitnesses\n        wA = 1.0 + s * fA(x_k)\n        wB = 1.0 + s * fB(x_k)\n        \n        # Average fitness\n        w_bar = x_k * wA + (1.0 - x_k) * wB\n        if w_bar == 0.0:\n            return x_k\n        \n        return (x_k * wA) / w_bar\n\n    # 2. Deterministic Wright-Fisher Trajectory\n    x_det = np.zeros(G + 1)\n    x_det[0] = x0\n    \n    for k in range(G):\n        x_det[k+1] = get_p(x_det[k])\n\n    # 3. Stochastic Wright-Fisher Trajectory\n    # Use a fixed seed for reproducibility as requested.\n    rng = np.random.default_rng(seed=42)\n    \n    X_stoch_replicates = np.zeros((R, G + 1))\n    X_stoch_replicates[:, 0] = x0\n    \n    for r in range(R):\n        for k in range(G):\n            current_x = X_stoch_replicates[r, k]\n            p_k = get_p(current_x)\n            num_A_next = rng.binomial(Ne, p_k)\n            X_stoch_replicates[r, k+1] = num_A_next / float(Ne)\n\n    x_stoch = np.mean(X_stoch_replicates, axis=0)\n\n    # 4. Quantify Discrepancy (RMS Error)\n    rms_det = np.sqrt(np.mean((x_rep - x_det)**2))\n    rms_stoch = np.sqrt(np.mean((x_rep - x_stoch)**2))\n\n    # 5. Return Boolean Decision\n    return (rms_det  eps_det) and (rms_stoch  eps_stoch)\n\ndef solve():\n    \"\"\"\n    Main function to define test cases and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (Payoff_matrix, x0, s, Ne, G, R, eps_det, eps_stoch)\n        ([[3.0, 2.0], [1.0, 0.0]], 0.2, 0.01, 5000, 40, 200, 0.005, 0.01),\n        ([[3.0, 0.0], [2.0, 1.0]], 0.6, 0.005, 4000, 60, 200, 0.004, 0.01),\n        ([[3.0, 0.0], [2.0, 1.0]], 0.6, 0.25, 5000, 20, 200, 0.004, 0.01),\n        ([[3.0, 0.0], [2.0, 1.0]], 0.6, 0.01, 50, 80, 30, 0.005, 0.007),\n        ([[1.0, 1.0], [1.0, 1.0]], 0.37, 0.2, 1000, 50, 200, 1.0e-6, 0.003),\n    ]\n\n    results = []\n    for case in test_cases:\n        result = run_one_case(*case)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}