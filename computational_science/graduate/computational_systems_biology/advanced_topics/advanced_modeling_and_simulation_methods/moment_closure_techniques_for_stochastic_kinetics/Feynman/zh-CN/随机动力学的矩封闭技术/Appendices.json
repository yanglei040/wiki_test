{
    "hands_on_practices": [
        {
            "introduction": "第一个练习将引导您逐步完成矩封闭技术的基础计算。通过分析一个经典的双分子反应，您将练习如何从化学主方程推导原始矩的动力学，如何将其转换为中心矩（如方差和协方差），并最终应用高斯矩封闭假设得到一个封闭的微分方程组。这个过程是分析那些过于复杂而无法精确求解的随机系统的基石。",
            "id": "3329113",
            "problem": "考虑双分子反应系统 $X + Y \\xrightarrow{k} Z$，该反应发生在一个大小有限 $\\Omega$ 且混合均匀的腔室中，其中 $k$ 是宏观质量作用速率常数。令 $X(t)$、$Y(t)$ 和 $Z(t)$ 表示时间 $t$ 时的离散分子数。假设动力学由化学主方程（CME）控制，且反应倾向为 $a(X,Y) = \\frac{k}{\\Omega} X Y$。定义原始矩 $m_{ij}(t) = \\mathbb{E}[X(t)^{i} Y(t)^{j}]$、均值 $\\mu_{X}(t) = \\mathbb{E}[X(t)]$、$\\mu_{Y}(t) = \\mathbb{E}[Y(t)]$、$\\mu_{Z}(t) = \\mathbb{E}[Z(t)]$，以及协方差矩阵项 $C_{XX}(t) = \\mathrm{Var}[X(t)]$、$C_{YY}(t) = \\mathrm{Var}[Y(t)]$、$C_{XY}(t) = \\mathrm{Cov}[X(t), Y(t)]$。从CME出发，仅使用基本定义，完成以下任务：\n1. 推导构建双物种子系统 $(X,Y)$ 的二阶矩封闭所需的一阶和二阶原始矩时间演化的常微分方程（ODE）。明确地用 $X$ 和 $Y$ 乘积的期望来表示 $\\,\\frac{d}{dt}\\mu_{X}(t)$、$\\,\\frac{d}{dt}\\mu_{Y}(t)$、$\\,\\frac{d}{dt}m_{20}(t)$、$\\,\\frac{d}{dt}m_{02}(t)$ 和 $\\,\\frac{d}{dt}m_{11}(t)$。\n2. 展示 $(X,Y)$ 的原始矩和中心矩之间直到二阶的代数变换，用 $\\mu_{X}(t)$、$\\mu_{Y}(t)$、$C_{XX}(t)$、$C_{YY}(t)$ 和 $C_{XY}(t)$ 来表示 $m_{20}(t)$、$m_{02}(t)$ 和 $m_{11}(t)$。\n3. 通过将 $(X,Y)$ 的所有三阶中心矩设为零，对 $(X,Y)$ 实现二阶正态（高斯）矩封闭。在此封闭下，用 $\\mu_{X}(t)$、$\\mu_{Y}(t)$、$C_{XX}(t)$、$C_{YY}(t)$ 和 $C_{XY}(t)$ 来计算 $\\,\\mathbb{E}[X(t)^{2} Y(t)]$ 和 $\\,\\mathbb{E}[X(t) Y(t)^{2}]$。\n4. 利用第1-3部分的结果，推导在二阶高斯封闭下，均值 $\\mu_{X}(t)$、$\\mu_{Y}(t)$、$\\mu_{Z}(t)$ 和协方差 $C_{XX}(t)$、$C_{YY}(t)$、$C_{XY}(t)$ 的封闭常微分方程组。\n你最终报告的答案必须是第4部分中得到的协方差交叉项 $\\,\\frac{d}{dt}C_{XY}(t)$ 的封闭右侧的单一解析表达式，用 $k$、$\\Omega$、$\\mu_{X}(t)$、$\\mu_{Y}(t)$、$C_{XX}(t)$、$C_{YY}(t)$ 和 $C_{XY}(t)$ 表示。最终表达式中不需进行数值近似或四舍五入，也不应包含单位。",
            "solution": "用户的问题经确认在科学上是合理的、提法得当、客观，并完全符合所要求的标准。未检测到任何缺陷。\n\n该问题要求对一个随机双分子反应系统的矩封闭进行多部分推导。解答将按要求分为四个部分呈现。\n\n反应系统为 $X + Y \\xrightarrow{k} Z$，其倾向为 $a(X,Y) = \\frac{k}{\\Omega}XY$。$(X,Y)$ 的状态变化向量为 $\\nu = (-1, -1)$。根据主方程范式，状态的任意函数 $f(X,Y)$ 的期望值随时间的演化由下式给出：\n$$ \\frac{d\\mathbb{E}[f(X,Y)]}{dt} = \\mathbb{E}[a(X,Y) (f(X-1, Y-1) - f(X,Y))] $$\n\n### 第1部分：原始矩的常微分方程\n我们推导一阶和二阶原始矩 $m_{ij} = \\mathbb{E}[X^i Y^j]$ 的方程。\n\n1.  **对于 $\\mu_X(t) = m_{10}(t) = \\mathbb{E}[X(t)]$**：\n    令 $f(X,Y) = X$。每次反应中 $f$ 的变化为 $f(X-1, Y-1) - f(X,Y) = (X-1) - X = -1$。\n    $$ \\frac{d\\mu_X}{dt} = \\mathbb{E}\\left[\\frac{k}{\\Omega}XY \\cdot (-1)\\right] = -\\frac{k}{\\Omega}\\mathbb{E}[XY] = -\\frac{k}{\\Omega}m_{11}(t) $$\n\n2.  **对于 $\\mu_Y(t) = m_{01}(t) = \\mathbb{E}[Y(t)]$**：\n    与 $X$ 对称，$f(X,Y)=Y$，变化为 $-1$。\n    $$ \\frac{d\\mu_Y}{dt} = \\mathbb{E}\\left[\\frac{k}{\\Omega}XY \\cdot (-1)\\right] = -\\frac{k}{\\Omega}\\mathbb{E}[XY] = -\\frac{k}{\\Omega}m_{11}(t) $$\n\n3.  **对于 $m_{20}(t) = \\mathbb{E}[X(t)^2]$**：\n    令 $f(X,Y) = X^2$。变化为 $f(X-1, Y-1) - f(X,Y) = (X-1)^2 - X^2 = X^2 - 2X + 1 - X^2 = -2X + 1$。\n    $$ \\frac{dm_{20}}{dt} = \\mathbb{E}\\left[\\frac{k}{\\Omega}XY(-2X+1)\\right] = \\frac{k}{\\Omega}\\mathbb{E}[-2X^2Y + XY] = -\\frac{2k}{\\Omega}\\mathbb{E}[X^2Y] + \\frac{k}{\\Omega}\\mathbb{E}[XY] $$\n    $$ \\frac{dm_{20}}{dt} = -\\frac{2k}{\\Omega}m_{21}(t) + \\frac{k}{\\Omega}m_{11}(t) $$\n\n4.  **对于 $m_{02}(t) = \\mathbb{E}[Y(t)^2]$**：\n    与 $X^2$ 对称，\n    $$ \\frac{dm_{02}}{dt} = -\\frac{2k}{\\Omega}\\mathbb{E}[XY^2] + \\frac{k}{\\Omega}\\mathbb{E}[XY] = -\\frac{2k}{\\Omega}m_{12}(t) + \\frac{k}{\\Omega}m_{11}(t) $$\n\n5.  **对于 $m_{11}(t) = \\mathbb{E}[X(t)Y(t)]$**：\n    令 $f(X,Y) = XY$。变化为 $f(X-1, Y-1) - f(X,Y) = (X-1)(Y-1) - XY = XY - X - Y + 1 - XY = -X - Y + 1$。\n    $$ \\frac{dm_{11}}{dt} = \\mathbb{E}\\left[\\frac{k}{\\Omega}XY(-X-Y+1)\\right] = \\frac{k}{\\Omega}\\mathbb{E}[-X^2Y - XY^2 + XY] $$\n    $$ \\frac{dm_{11}}{dt} = -\\frac{k}{\\Omega}\\left(m_{21}(t) + m_{12}(t)\\right) + \\frac{k}{\\Omega}m_{11}(t) $$\n这些方程是不封闭的，因为二阶矩的动力学依赖于三阶矩 ($m_{21}, m_{12}$)。\n\n### 第2部分：原始矩与中心矩之间的变换\n我们用均值（$\\mu_X, \\mu_Y$）和二阶中心矩（方差 $C_{XX}, C_{YY}$ 和协方差 $C_{XY}$）来表示二阶原始矩。\n\n1.  **方差 $C_{XX}$**：\n    $C_{XX} = \\mathrm{Var}[X] = \\mathbb{E}[(X-\\mu_X)^2] = \\mathbb{E}[X^2 - 2X\\mu_X + \\mu_X^2] = \\mathbb{E}[X^2] - 2\\mu_X\\mathbb{E}[X] + \\mu_X^2 = m_{20} - 2\\mu_X\\mu_X + \\mu_X^2 = m_{20} - \\mu_X^2$。\n    因此，$m_{20}(t) = C_{XX}(t) + \\mu_X(t)^2$。\n\n2.  **方差 $C_{YY}$**：\n    根据对称性，$m_{02}(t) = C_{YY}(t) + \\mu_Y(t)^2$。\n\n3.  **协方差 $C_{XY}$**：\n    $C_{XY} = \\mathrm{Cov}[X,Y] = \\mathbb{E}[(X-\\mu_X)(Y-\\mu_Y)] = \\mathbb{E}[XY - X\\mu_Y - Y\\mu_X + \\mu_X\\mu_Y] = \\mathbb{E}[XY] - \\mu_Y\\mathbb{E}[X] - \\mu_X\\mathbb{E}[Y] + \\mu_X\\mu_Y = m_{11} - \\mu_Y\\mu_X - \\mu_X\\mu_Y + \\mu_X\\mu_Y = m_{11} - \\mu_X\\mu_Y$。\n    因此，$m_{11}(t) = C_{XY}(t) + \\mu_X(t)\\mu_Y(t)$。\n\n### 第3部分：二阶正态（高斯）矩封闭\n正态封闭近似将所有三阶及更高阶的中心矩设为零。我们用这个方法来表示第1部分中所需的三阶原始矩。令 $\\tilde{X} = X-\\mu_X$ 且 $\\tilde{Y} = Y-\\mu_Y$。\n\n1.  **对于 $\\mathbb{E}[X^2Y]$**：\n    相应的三阶中心矩是 $\\mathbb{E}[\\tilde{X}^2\\tilde{Y}] = \\mathbb{E}[(X-\\mu_X)^2(Y-\\mu_Y)]$。我们将其设为零。\n    $0 = \\mathbb{E}[(X^2 - 2X\\mu_X + \\mu_X^2)(Y-\\mu_Y)]$\n    $0 = \\mathbb{E}[X^2Y - X^2\\mu_Y - 2X\\mu_X Y + 2X\\mu_X\\mu_Y + \\mu_X^2 Y - \\mu_X^2\\mu_Y]$\n    $0 = \\mathbb{E}[X^2Y] - \\mu_Y\\mathbb{E}[X^2] - 2\\mu_X\\mathbb{E}[XY] + 2\\mu_X\\mu_Y\\mathbb{E}[X] + \\mu_X^2\\mathbb{E}[Y] - \\mu_X^2\\mu_Y$\n    $0 = \\mathbb{E}[X^2Y] - \\mu_Y m_{20} - 2\\mu_X m_{11} + 2\\mu_X^2\\mu_Y + \\mu_X^2\\mu_Y - \\mu_X^2\\mu_Y$\n    $\\mathbb{E}[X^2Y] = \\mu_Y m_{20} + 2\\mu_X m_{11} - 2\\mu_X^2\\mu_Y$\n    代入第2部分的关系式：\n    $\\mathbb{E}[X^2Y] = \\mu_Y(C_{XX} + \\mu_X^2) + 2\\mu_X(C_{XY} + \\mu_X\\mu_Y) - 2\\mu_X^2\\mu_Y$\n    $\\mathbb{E}[X^2Y] = \\mu_Y C_{XX} + \\mu_X^2\\mu_Y + 2\\mu_X C_{XY} + 2\\mu_X^2\\mu_Y - 2\\mu_X^2\\mu_Y$\n    $\\mathbb{E}[X^2Y] = \\mu_X^2\\mu_Y + \\mu_Y C_{XX} + 2\\mu_X C_{XY}$\n\n2.  **对于 $\\mathbb{E}[XY^2]$**：\n    根据对称性，交换 $X$ 和 $Y$ 的角色：\n    $\\mathbb{E}[XY^2] = \\mu_Y^2\\mu_X + \\mu_X C_{YY} + 2\\mu_Y C_{XY}$\n\n### 第4部分：封闭的常微分方程组\n现在我们结合前面几部分的结果，推导均值和协方差的封闭常微分方程组。\n\n**均值动力学**：\n使用第1部分和第2部分的结果：\n$\\frac{d\\mu_X}{dt} = -\\frac{k}{\\Omega}m_{11} = -\\frac{k}{\\Omega}(\\mu_X\\mu_Y + C_{XY})$\n$\\frac{d\\mu_Y}{dt} = -\\frac{k}{\\Omega}m_{11} = -\\frac{k}{\\Omega}(\\mu_X\\mu_Y + C_{XY})$\n对于 $\\mu_Z$，化学计量为 $\\Delta Z = +1$。\n$\\frac{d\\mu_Z}{dt} = \\mathbb{E}[a(X,Y)\\cdot (+1)] = \\frac{k}{\\Omega}m_{11} = \\frac{k}{\\Omega}(\\mu_X\\mu_Y + C_{XY})$\n\n**协方差动力学**：\n我们推导 $C_{XY}(t)$ 的常微分方程。$C_{XX}$ 和 $C_{YY}$ 的常微分方程遵循类似的步骤，但最终答案不需要它们。协方差的时间导数由链式法则给出：\n$$ \\frac{dC_{XY}}{dt} = \\frac{d}{dt}(m_{11} - \\mu_X\\mu_Y) = \\frac{dm_{11}}{dt} - \\left(\\mu_Y\\frac{d\\mu_X}{dt} + \\mu_X\\frac{d\\mu_Y}{dt}\\right) $$\n代入推导出的导数表达式：\n$$ \\frac{dC_{XY}}{dt} = \\left(-\\frac{k}{\\Omega}(\\mathbb{E}[X^2Y] + \\mathbb{E}[XY^2]) + \\frac{k}{\\Omega}\\mathbb{E}[XY]\\right) - \\left(\\mu_Y(-\\frac{k}{\\Omega}\\mathbb{E}[XY]) + \\mu_X(-\\frac{k}{\\Omega}\\mathbb{E}[XY])\\right) $$\n提出因子 $\\frac{k}{\\Omega}$：\n$$ \\frac{dC_{XY}}{dt} = \\frac{k}{\\Omega} \\left( -\\mathbb{E}[X^2Y] - \\mathbb{E}[XY^2] + \\mathbb{E}[XY] + \\mu_Y\\mathbb{E}[XY] + \\mu_X\\mathbb{E}[XY] \\right) $$\n$$ \\frac{dC_{XY}}{dt} = \\frac{k}{\\Omega} \\left( -\\mathbb{E}[X^2Y] - \\mathbb{E}[XY^2] + (1+\\mu_X+\\mu_Y)\\mathbb{E}[XY] \\right) $$\n现在，代入第3部分的封闭表达式和第2部分中关于 $\\mathbb{E}[XY]$ 的关系式：\n\\begin{itemize}\n    \\item $-\\mathbb{E}[X^2Y] = -(\\mu_X^2\\mu_Y + \\mu_Y C_{XX} + 2\\mu_X C_{XY})$\n    \\item $-\\mathbb{E}[XY^2] = -(\\mu_Y^2\\mu_X + \\mu_X C_{YY} + 2\\mu_Y C_{XY})$\n    \\item $(1+\\mu_X+\\mu_Y)\\mathbb{E}[XY] = (1+\\mu_X+\\mu_Y)(\\mu_X\\mu_Y + C_{XY}) = \\mu_X\\mu_Y + C_{XY} + \\mu_X^2\\mu_Y + \\mu_X C_{XY} + \\mu_X\\mu_Y^2 + \\mu_Y C_{XY}$\n\\end{itemize}\n将 $\\frac{dC_{XY}}{dt}$ 方程括号内的这些项相加：\n$$ (-\\mu_X^2\\mu_Y - \\mu_Y C_{XX} - 2\\mu_X C_{XY}) + (-\\mu_Y^2\\mu_X - \\mu_X C_{YY} - 2\\mu_Y C_{XY}) + (\\mu_X\\mu_Y + C_{XY} + \\mu_X^2\\mu_Y + \\mu_X C_{XY} + \\mu_X\\mu_Y^2 + \\mu_Y C_{XY}) $$\n按变量分组各项：\n\\begin{itemize}\n    \\item 均值乘积项： $(-\\mu_X^2\\mu_Y + \\mu_X^2\\mu_Y) + (-\\mu_Y^2\\mu_X + \\mu_X\\mu_Y^2) + \\mu_X\\mu_Y = \\mu_X\\mu_Y$\n    \\item $C_{XX}$ 项： $-\\mu_Y C_{XX}$\n    \\item $C_{YY}$ 项： $-\\mu_X C_{YY}$\n    \\item $C_{XY}$ 项： $(-2\\mu_X C_{XY} - 2\\mu_Y C_{XY}) + (C_{XY} + \\mu_X C_{XY} + \\mu_Y C_{XY}) = C_{XY} - \\mu_X C_{XY} - \\mu_Y C_{XY}$\n\\end{itemize}\n组合这些简化后的项，得到右侧的表达式：\n$$ \\mu_X\\mu_Y - \\mu_Y C_{XX} - \\mu_X C_{YY} + C_{XY} - \\mu_X C_{XY} - \\mu_Y C_{XY} $$\n为清晰起见，可以稍微进行因式分解：\n$$ \\mu_X\\mu_Y - \\mu_Y C_{XX} - \\mu_X C_{YY} + (1-\\mu_X-\\mu_Y)C_{XY} $$\n协方差交叉项的最终封闭常微分方程为：\n$$ \\frac{dC_{XY}}{dt}(t) = \\frac{k}{\\Omega}\\left[\\mu_X\\mu_Y - \\mu_Y C_{XX} - \\mu_X C_{YY} + (1-\\mu_X-\\mu_Y)C_{XY}\\right] $$\n其中右侧的均值和协方差的时间依赖性是隐式的。",
            "answer": "$$\n\\boxed{\\frac{k}{\\Omega}\\left(\\mu_X\\mu_Y - \\mu_Y C_{XX} - \\mu_X C_{YY} + (1-\\mu_X-\\mu_Y)C_{XY}\\right)}\n$$"
        },
        {
            "introduction": "虽然高斯矩封闭被广泛使用，但根据反应网络的不同，其他矩封闭方案可能更自然或在计算上更方便。本练习介绍阶乘矩的概念，它特别适用于质量作用动力学，并演示了泊松矩封闭拟设的应用。您将看到这种方法如何简化矩方程，并为近似系统行为提供了另一种视角。",
            "id": "3329136",
            "problem": "考虑一个单物种随机反应网络，其分子计数过程为 $X(t) \\in \\{0,1,2,\\dots\\}$，包含以下质量作用反应：\n$$(\\mathrm{R1})\\;\\; \\varnothing \\xrightarrow{k_0} X,\\qquad (\\mathrm{R2})\\;\\; X \\xrightarrow{k_1} \\varnothing,\\qquad (\\mathrm{R3})\\;\\; 2X \\xrightarrow{k_2} \\varnothing,$$\n其中 $k_0$、$k_1$ 和 $k_2$ 是正常数率。反应 $(\\mathrm{R1})$ 使计数增加 $+1$，$(\\mathrm{R2})$ 使其减少 $-1$，而 $(\\mathrm{R3})$ 使其减少 $-2$。设 $X(t)$ 根据化学主方程 (CME) 演化，并定义降阶乘 $x^{\\underline{n}} := x(x-1)\\cdots(x-n+1)$（对于 $n \\in \\mathbb{N}$），其常规值为 $x^{\\underline{0}} := 1$。定义阶乘矩 $f_n(t) := \\mathbb{E}\\!\\left[X^{\\underline{n}}(t)\\right]$。\n\n从 CME 和阶乘矩的定义出发，推导第一阶乘矩 $f_1(t)$ 的精确时间演化方程。在此过程中，仅利用 CME 的结构和质量作用倾向，并明确说明一个 $n$ 阶反应如何通过阶乘矩 $f_n(t)$ 自然地产生贡献。然后，通过假设 $X(t)$ 在所有 $t \\ge 0$ 时近似服从均值为 $m(t)$ 的泊松分布，施加一个泊松矩封闭拟设，使得 $f_n(t) = m(t)^n$。在此拟设下，获得 $m(t)$ 的闭式常微分方程，并用 $k_0$、$k_1$ 和 $k_2$ 计算正常稳态均值 $m^\\ast$。\n\n将最终答案表示为 $m^\\ast$ 的单个闭式解析表达式。无需进行数值四舍五入。最终表达式中不包含任何单位。",
            "solution": "首先对问题进行严格的验证程序。\n\n### 第 1 步：提取已知条件\n- **系统**：一个单物种随机反应网络，其分子计数过程为 $X(t) \\in \\{0, 1, 2, \\dots\\}$。\n- **反应**：\n  - $(\\mathrm{R1})\\;\\; \\varnothing \\xrightarrow{k_0} X$ (生成)\n  - $(\\mathrm{R2})\\;\\; X \\xrightarrow{k_1} \\varnothing$ (线性降解)\n  - $(\\mathrm{R3})\\;\\; 2X \\xrightarrow{k_2} \\varnothing$ (二聚化/二次降解)\n- **反应速率常数**：$k_0$、$k_1$ 和 $k_2$ 是正常数率。\n- **化学计量**：反应 $(\\mathrm{R1})$ 使计数改变 $+1$，$(\\mathrm{R2})$ 改变 $-1$，$(\\mathrm{R3})$ 改变 $-2$。\n- **控制方程**：该过程根据化学主方程 (CME) 演化。\n- **定义**：\n  - 降阶乘：$x^{\\underline{n}} := x(x-1)\\cdots(x-n+1)$（对于 $n \\in \\mathbb{N}$），其中 $x^{\\underline{0}} := 1$。\n  - 阶乘矩：$f_n(t) := \\mathbb{E}\\!\\left[X^{\\underline{n}}(t)\\right]$。\n- **任务**：\n  1. 推导第一阶乘矩 $f_1(t)$ 的精确时间演化方程。\n  2. 施加泊松矩封闭拟设，$f_n(t) = m(t)^n$，其中 $m(t)$ 是均值。\n  3. 获得 $m(t)$ 的闭式常微分方程(ODE)。\n  4. 计算正常稳态均值 $m^\\ast$。\n\n### 第 2 步：使用提取的已知条件进行验证\n- **科学依据**：该问题描述了一个带有二次死亡的生灭过程，这是随机化学生物动力学和种群动态学中的一个典型模型。化学主方程、阶乘矩和矩封闭技术的使用都是计算系统生物学中标准且成熟的方法。该模型在科学上是合理的。\n- **适定性**：问题定义清晰。反应、定义和任务都是明确的。提供了所有必要的信息，以便在指定的封闭条件下推导出稳态均值的唯一解析解。\n- **客观性**：语言精确且数学化，没有任何主观或基于意见的论断。\n- **完整性与一致性**：问题是自洽的。所提供的信息是充分且内部一致的。\n\n### 第 3 步：结论与行动\n问题有效。将提供完整的解答。\n\n### 解答推导\n\n对于由 CME 控制的过程，任何函数 $g(X(t))$ 的期望值的时间演化由下式给出\n$$\n\\frac{d}{dt}\\mathbb{E}[g(X(t))] = \\sum_{j} \\mathbb{E}[a_j(X(t))(g(X(t)+s_j) - g(X(t)))]\n$$\n其中，总和遍历所有反应通道 $j$，$a_j(x)$ 是反应 $j$ 的倾向函数，$s_j$ 是物种计数 $X$ 相应的化学计量变化。\n\n对于给定的质量作用反应网络，倾向和化学计量变化如下：\n- 反应 $(\\mathrm{R1})$: $s_1 = +1$。零级反应的倾向是恒定的，$a_1(x) = k_0$。\n- 反应 $(\\mathrm{R2})$: $s_2 = -1$。一级反应的倾向与分子数成正比，$a_2(x) = k_1 x$。\n- 反应 $(\\mathrm{R3})$: $s_3 = -2$。涉及两个相同分子的二级反应的倾向与分子的不同对数成正比，即 $\\binom{x}{2} = \\frac{x(x-1)}{2}$。因此，倾向为 $a_3(x) = k_2 \\binom{x}{2}$。在化学生物动力学中，一个常见的约定是定义速率常数 $k_2$ 以吸收组合因子 $1/2! = 1/2$。在本问题中，我们将遵循更基本的定义，即倾向是速率常数乘以反应物组合的数量。所以，$a_3(x) = k_2 \\frac{x(x-1)}{2}$。\n\n我们需要推导第一阶乘矩 $f_1(t) = \\mathbb{E}[X(t)]$ 的时间演化方程。为此，我们设 $g(x) = x$。每个反应中 $g(x)$ 的变化如下：\n- 对于 $(\\mathrm{R1})$: $g(x+1) - g(x) = (x+1) - x = 1$。\n- 对于 $(\\mathrm{R2})$: $g(x-1) - g(x) = (x-1) - x = -1$。\n- 对于 $(\\mathrm{R3})$: $g(x-2) - g(x) = (x-2) - x = -2$。\n\n将这些代入通用演化方程：\n$$\n\\frac{d}{dt}\\mathbb{E}[X(t)] = \\mathbb{E}[a_1(X)(1)] + \\mathbb{E}[a_2(X)(-1)] + \\mathbb{E}[a_3(X)(-2)]\n$$\n$$\n\\frac{d}{dt}\\mathbb{E}[X(t)] = \\mathbb{E}[k_0] + \\mathbb{E}[k_1 X (-1)] + \\mathbb{E}\\left[k_2 \\frac{X(X-1)}{2} (-2)\\right]\n$$\n利用期望算子的线性性质，我们得到：\n$$\n\\frac{d}{dt}\\mathbb{E}[X(t)] = k_0 - k_1 \\mathbb{E}[X] - k_2 \\mathbb{E}[X(X-1)]\n$$\n根据定义，$f_1(t) = \\mathbb{E}[X(t)]$ 且 $f_2(t) = \\mathbb{E}[X(X-1)] = \\mathbb{E}[X^{\\underline{2}}(t)]$。所以，第一阶乘矩的精确方程是：\n$$\n\\frac{df_1}{dt} = k_0 - k_1 f_1 - k_2 f_2\n$$\n这个方程是不封闭的，因为第一矩 $f_1$ 的动态依赖于第二矩 $f_2$。这说明了矩封闭问题。对于质量作用系统，使用阶乘矩是自然的，因为 $n$ 阶反应的倾向与 $x^{\\underline{n}}$ 成正比，这在演化方程中直接与第 $n$ 阶乘矩 $f_n$ 耦合。\n\n接下来，我们施加泊松矩封闭拟设。这假设 $X(t)$ 的分布在所有 $t \\ge 0$ 时近似为均值为 $m(t)$ 的泊松分布。泊松分布的一个关键性质是其第 $n$ 阶乘矩是均值的 $n$ 次方，即 $f_n = m^n$。\n在这个假设下，我们有：\n- $f_1(t) = m(t)^1 = m(t)$\n- $f_2(t) = m(t)^2$\n\n将这些代入精确矩方程，得到关于均值 $m(t)$ 的闭式常微分方程(ODE)：\n$$\n\\frac{dm}{dt} = k_0 - k_1 m - k_2 m^2\n$$\n这是在泊松封闭下 $m(t)$ 的闭式常微分方程。\n\n最后，我们计算正常稳态均值 $m^\\ast$。在稳态下，均值不随时间变化，因此 $\\frac{dm}{dt} = 0$。这导出了代数方程：\n$$\nk_0 - k_1 m^\\ast - k_2 (m^\\ast)^2 = 0\n$$\n整理成标准二次型 $ax^2 + bx + c = 0$：\n$$\nk_2 (m^\\ast)^2 + k_1 m^\\ast - k_0 = 0\n$$\n$m^\\ast$ 的解由二次公式给出：\n$$\nm^\\ast = \\frac{-k_1 \\pm \\sqrt{k_1^2 - 4(k_2)(-k_0)}}{2k_2} = \\frac{-k_1 \\pm \\sqrt{k_1^2 + 4 k_0 k_2}}{2 k_2}\n$$\n问题指明速率常数 $k_0$、$k_1$ 和 $k_2$ 均为正。因此，判别式 $k_1^2 + 4 k_0 k_2$ 总是正的。分子的平均数 $m^\\ast$ 必须是一个非负量。我们分析这两个根：\n1. $m^\\ast_1 = \\frac{-k_1 + \\sqrt{k_1^2 + 4 k_0 k_2}}{2 k_2}$。由于 $4 k_0 k_2 > 0$，我们有 $\\sqrt{k_1^2 + 4 k_0 k_2} > \\sqrt{k_1^2} = k_1$。因此，分子为正。分母也为正。所以，$m^\\ast_1 > 0$。\n2. $m^\\ast_2 = \\frac{-k_1 - \\sqrt{k_1^2 + 4 k_0 k_2}}{2 k_2}$。分子显然为负，而分母为正。所以，$m^\\ast_2  0$。\n\n唯一具有物理意义的解是正解。因此，正常稳态均值为：\n$$\nm^\\ast = \\frac{-k_1 + \\sqrt{k_1^2 + 4 k_0 k_2}}{2 k_2}\n$$",
            "answer": "$$\n\\boxed{\\frac{-k_1 + \\sqrt{k_1^2 + 4 k_0 k_2}}{2 k_2}}\n$$"
        },
        {
            "introduction": "推导出矩方程是第一步；对其进行数值求解是下一个实际挑战。这个动手编程练习要求您为一个封闭的矩系统实现一个积分器，并处理“可实现性”这一关键问题。您将设计并应用一种投影方法，以确保数值计算出的矩（例如均值和方差）在整个模拟过程中保持物理上的有效性（例如，方差非负）。",
            "id": "3329153",
            "problem": "考虑计算系统生物学中一个由化学主方程（CME）控制的单物种随机反应网络。该物种的拷贝数为 $X(t) \\in \\{0,1,2,\\dots\\}$，并受三种反应影响：化学计量为 $+1$、倾向性为 $a_1(X) = k_b$ 的生成反应；化学计量为 $-1$、倾向性为 $a_2(X) = k_d X$ 的死亡反应；以及化学计量为 $-2$、倾向性为 $a_3(X) = k_a X (X - 1)$ 的成对湮灭反应。所有速率常数均为非负：$k_b \\ge 0$ 的单位为 $\\mathrm{s}^{-1}$，$k_d \\ge 0$ 的单位为 $\\mathrm{s}^{-1}$ 每分子，以及 $k_a \\ge 0$ 的单位为 $\\mathrm{s}^{-1}$ 每对。令一阶矩为 $\\mu(t) = \\mathbb{E}[X(t)]$，单位为分子；二阶中心矩为 $\\sigma^2(t) = \\mathrm{Var}(X(t))$，单位为分子$^2$。二阶原点矩为 $m_2(t) = \\mathbb{E}[X(t)^2] = \\mu(t)^2 + \\sigma^2(t)$。\n\n从 CME 和对于任意函数 $g$ 的定义 $\\frac{d}{dt}\\mathbb{E}[g(X)] = \\mathbb{E}\\left[\\sum_r \\left(g(X+\\nu_r) - g(X)\\right) a_r(X)\\right]$ 出发（其中 $r$ 为反应的索引，其化学计量变化为 $\\nu_r$，倾向性为 $a_r(X)$），推导关于 $\\frac{d}{dt}\\mu(t)$ 和 $\\frac{d}{dt}m_2(t)$ 的确定性常微分方程，并用 $\\mu(t)$、$m_2(t)$ 和 $\\mathbb{E}[X(t)^3]$ 表示。然后，通过采用高斯矩封闭，假设三阶及更高阶的累积量为零，从而用 $\\mu(t)$ 和 $\\sigma^2(t)$ 表示 $\\mathbb{E}[X(t)^3]$，得到一个关于 $\\mu(t)$ 和 $\\sigma^2(t)$ 的封闭系统。使用恒等式 $\\sigma^2(t) = m_2(t) - \\mu(t)^2$ 和乘积法则，将 $\\frac{d}{dt}\\sigma^2(t)$ 表示为 $\\frac{d}{dt}m_2(t)$ 和 $\\frac{d}{dt}\\mu(t)$ 的函数。\n\n在对所得封闭系统进行数值积分时，必须强制执行可实现性：截断矩矩阵 $M_2(t) = \\begin{pmatrix} 1  \\mu(t) \\\\ \\mu(t)  \\mu(t)^2 + \\sigma^2(t) \\end{pmatrix}$ 对于所有 $t \\ge 0$ 都必须是半正定的。此外，对于一个取非负整数值的物种，其均值必须保持非负：$\\mu(t) \\ge 0$。设计一个投影映射 $\\Pi$，该映射将任意点对 $(\\mu,\\sigma^2)$ 映至集合 $\\mathcal{F} = \\{(\\mu,\\sigma^2) \\mid \\mu \\ge 0,\\; M_2 \\succeq 0\\}$ 中在 $\\mathbb{R}^2$ 的欧几里得范数下最近的可行点，并在每个积分步应用此投影。明确指定 $\\Pi$ 的形式并说明理由。\n\n实现一个显式欧拉方法，从初始条件 $\\mu(0) = \\mu_0$ 和 $\\sigma^2(0) = \\sigma_0^2$ 开始，以固定步长 $\\Delta t$ 对该封闭系统进行积分，直至最终时间 $T$，并在每个欧拉步结束时应用投影 $\\Pi$。使用以下参数集测试套件，这些参数集分别用于测试一般情况、强非线性阻尼、边界方差情况以及大步长压力测试：\n\n- 测试用例1：$k_b = 20.0\\,\\mathrm{s}^{-1}$，$k_d = 0.5\\,\\mathrm{s}^{-1}$ 每分子，$k_a = 0.01\\,\\mathrm{s}^{-1}$ 每对，$\\mu_0 = 10.0$ 分子，$\\sigma_0^2 = 5.0$ 分子$^2$，$T = 10.0$ 秒，$\\Delta t = 0.2$ 秒。\n- 测试用例2：$k_b = 5.0\\,\\mathrm{s}^{-1}$，$k_d = 0.3\\,\\mathrm{s}^{-1}$ 每分子，$k_a = 0.5\\,\\mathrm{s}^{-1}$ 每对，$\\mu_0 = 25.0$ 分子，$\\sigma_0^2 = 40.0$ 分子$^2$，$T = 10.0$ 秒，$\\Delta t = 1.0$ 秒。\n- 测试用例3：$k_b = 0.0\\,\\mathrm{s}^{-1}$，$k_d = 0.1\\,\\mathrm{s}^{-1}$ 每分子，$k_a = 0.2\\,\\mathrm{s}^{-1}$ 每对，$\\mu_0 = 50.0$ 分子，$\\sigma_0^2 = 0.0$ 分子$^2$，$T = 5.0$ 秒，$\\Delta t = 0.5$ 秒。\n- 测试用例4：$k_b = 100.0\\,\\mathrm{s}^{-1}$，$k_d = 2.0\\,\\mathrm{s}^{-1}$ 每分子，$k_a = 1.0\\,\\mathrm{s}^{-1}$ 每对，$\\mu_0 = 1.0$ 分子，$\\sigma_0^2 = 0.1$ 分子$^2$，$T = 5.0$ 秒，$\\Delta t = 2.0$ 秒。\n\n你的程序必须为每个测试用例计算最终的投影值 $\\mu(T)$ 和 $\\sigma^2(T)$，单位分别为指定的分子和分子$^2$。你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表，每个测试用例的结果以一个包含两个浮点数的列表 $[\\mu(T),\\sigma^2(T)]$ 的形式报告。例如，输出格式必须类似于 $[[\\mu_1,\\sigma^2_1],[\\mu_2,\\sigma^2_2],[\\mu_3,\\sigma^2_3],[\\mu_4,\\sigma^2_4]]$，不附加任何单位字符串。",
            "solution": "化学主方程（CME）通过恒等式 $\\frac{d}{dt}\\mathbb{E}[g(X)] = \\mathbb{E}\\left[\\sum_r \\left(g(X+\\nu_r) - g(X)\\right) a_r(X)\\right]$ 给出了期望值的演化，其中反应 $r$ 的化学计量增量为 $\\nu_r$，倾向性为 $a_r(X)$。对于具有生成反应 $\\nu_1 = +1$, $a_1(X) = k_b$、死亡反应 $\\nu_2 = -1$, $a_2(X) = k_d X$ 和成对湮灭反应 $\\nu_3 = -2$, $a_3(X) = k_a X(X-1)$ 的单物种网络，我们通过选择 $g(X) \\in \\{X,X^2\\}$ 并应用期望的线性性质来计算一阶和二阶原点矩方程。\n\n对于一阶矩，取 $g(X)=X$，我们使用 $\\Delta_r X = X+\\nu_r - X = \\nu_r$。因此\n$$\n\\frac{d}{dt}\\mu(t) \\;=\\; \\mathbb{E}\\left[\\nu_1 a_1(X) + \\nu_2 a_2(X) + \\nu_3 a_3(X)\\right]\n\\;=\\; \\mathbb{E}\\left[1\\cdot k_b + (-1)\\cdot k_d X + (-2)\\cdot k_a X(X-1)\\right].\n$$\n逐项计算期望可得\n$$\n\\frac{d}{dt}\\mu(t) \\;=\\; k_b \\;-\\; k_d\\,\\mu(t) \\;-\\; 2 k_a\\,\\mathbb{E}[X(t)(X(t)-1)].\n$$\n使用 $\\mathbb{E}[X(X-1)] = \\mathbb{E}[X^2] - \\mathbb{E}[X] = m_2(t) - \\mu(t)$ 可得\n$$\n\\frac{d}{dt}\\mu(t) \\;=\\; k_b \\;-\\; k_d\\,\\mu(t) \\;-\\; 2 k_a\\,\\big(m_2(t) - \\mu(t)\\big).\n$$\n\n对于二阶原点矩，取 $g(X)=X^2$，我们计算 $\\Delta_r X^2 = (X+\\nu_r)^2 - X^2$。代数增量为 $\\Delta_1 X^2 = (X+1)^2 - X^2 = 2X + 1$，$\\Delta_2 X^2 = (X-1)^2 - X^2 = -2X + 1$，以及 $\\Delta_3 X^2 = (X-2)^2 - X^2 = -4X + 4$。因此\n$$\n\\frac{d}{dt} m_2(t) \\;=\\; \\mathbb{E}\\left[(2X+1) k_b + (-2X+1) k_d X + (-4X+4) k_a X(X-1)\\right].\n$$\n通过线性性质计算期望，\n$$\n\\frac{d}{dt} m_2(t) \\;=\\; 2 k_b\\,\\mu(t) + k_b \\;-\\; 2 k_d\\,\\mathbb{E}[X^2] + k_d\\,\\mu(t) \\;+\\; k_a\\,\\mathbb{E}\\big[(-4X+4) X(X-1)\\big].\n$$\n为了简化湮灭项，注意 $\\mathbb{E}[(-4X+4) X(X-1)] = -4\\,\\mathbb{E}[X^2(X-1)] + 4\\,\\mathbb{E}[X(X-1)]$ 以及 $\\mathbb{E}[X^2(X-1)] = \\mathbb{E}[X^3 - X^2] = \\mathbb{E}[X^3] - \\mathbb{E}[X^2]$。使用 $\\mathbb{E}[X(X-1)] = \\mathbb{E}[X^2] - \\mathbb{E}[X] = m_2(t) - \\mu(t)$，我们得到\n$$\n\\frac{d}{dt} m_2(t) \\;=\\; 2 k_b\\,\\mu(t) + k_b \\;-\\; 2 k_d\\, m_2(t) + k_d\\,\\mu(t) \\;+\\; k_a\\left[-4\\,\\mathbb{E}[X^3] + 8\\, m_2(t) - 4\\, \\mu(t)\\right].\n$$\n\n该系统涉及 $\\mathbb{E}[X^3]$。为了得到一个用 $\\mu(t)$ 和 $\\sigma^2(t)$ 表示的封闭系统，我们采用高斯矩封闭，该方法假设三阶及更高阶的累积量为零。在此封闭下，单变量分布的三阶原点矩通过以下方式与前两个矩相关联\n$$\n\\mathbb{E}[X^3] \\;=\\; \\mu(t)^3 + 3\\,\\mu(t)\\,\\sigma^2(t).\n$$\n这一选择与以下假设一致：$X$ 的分布在矩的层面上可由正态分布近似，这是矩方法中广泛使用的一种封闭方法。\n\n使用 $m_2(t) = \\mu(t)^2 + \\sigma^2(t)$，我们通过代入将第二个方程完全用 $\\mu(t)$ 和 $\\sigma^2(t)$ 表示。我们还通过恒等式来表达方差的动态变化\n$$\n\\sigma^2(t) \\;=\\; m_2(t) - \\mu(t)^2,\\quad\\text{所以}\\quad \\frac{d}{dt}\\sigma^2(t) \\;=\\; \\frac{d}{dt} m_2(t) - 2\\,\\mu(t)\\,\\frac{d}{dt}\\mu(t).\n$$\n这保证了方差的更新既能反映二阶原点矩的动态，也能反映其与均值的相互作用。\n\n必须强制执行可实现性条件，因为积分和封闭近似可能产生不符合物理实际的状态。截断矩矩阵\n$$\nM_2(t) \\;=\\; \\begin{pmatrix}\n1  \\mu(t) \\\\\n\\mu(t)  \\mu(t)^2 + \\sigma^2(t)\n\\end{pmatrix}\n$$\n必须是半正定的，以对应一个有效的测度；此外，对于非负物种，均值必须满足 $\\mu(t) \\ge 0$。对于一个 $2\\times 2$ 的对称矩阵，$M_2 \\succeq 0$ 等价于主子式非负：(1,1) 位置的元素为 1，是非负的；行列式约束为 $1\\cdot(\\mu^2+\\sigma^2) - \\mu^2 \\ge 0$，可简化为 $\\sigma^2 \\ge 0$。因此，可行集为\n$$\n\\mathcal{F} \\;=\\; \\{(\\mu,\\sigma^2) \\in \\mathbb{R}^2 \\mid \\mu \\ge 0,\\; \\sigma^2 \\ge 0\\}.\n$$\n到 $\\mathcal{F}$ 上的欧几里得投影 $\\Pi$ 是在 $(\\tilde{\\mu},\\tilde{\\sigma}^2) \\in \\mathcal{F}$ 约束下 $\\|(\\tilde{\\mu},\\tilde{\\sigma}^2) - (\\mu,\\sigma^2)\\|_2$ 的最小化子。由于 $\\mathcal{F}$ 是半线的笛卡尔积，此投影可按坐标解耦：\n$$\n\\Pi(\\mu,\\sigma^2) \\;=\\; \\big(\\max\\{\\mu,0\\},\\; \\max\\{\\sigma^2,0\\}\\big).\n$$\n这一选择在欧几里得意义上以最小的改动改变状态，同时强制了 $M_2 \\succeq 0$ 和均值的非负性。\n\n算法实现如下：\n- 初始化 $\\mu \\leftarrow \\mu_0$ 和 $\\sigma^2 \\leftarrow \\sigma_0^2$。\n- 对于时间步 $t \\in \\{0,\\Delta t,2\\Delta t,\\dots,T\\}$，如有必要，缩短最后一步以确保在 $T$ 精确结束：\n  - 计算 $m_2 = \\mu^2 + \\sigma^2$ 和 $\\mathbb{E}[X^3] = \\mu^3 + 3\\mu\\sigma^2$。\n  - 计算 $\\frac{d}{dt}\\mu = k_b - k_d \\mu - 2 k_a (m_2 - \\mu)$。\n  - 计算 $\\frac{d}{dt} m_2 = 2 k_b \\mu + k_b - 2 k_d m_2 + k_d \\mu + k_a(-4\\mathbb{E}[X^3] + 8 m_2 - 4 \\mu)$。\n  - 计算 $\\frac{d}{dt}\\sigma^2 = \\frac{d}{dt} m_2 - 2 \\mu \\frac{d}{dt}\\mu$。\n  - 执行显式欧拉更新：$\\mu \\leftarrow \\mu + \\Delta t \\cdot \\frac{d}{dt}\\mu$，$\\sigma^2 \\leftarrow \\sigma^2 + \\Delta t \\cdot \\frac{d}{dt}\\sigma^2$。\n  - 投影：$(\\mu,\\sigma^2) \\leftarrow \\Pi(\\mu,\\sigma^2) = (\\max\\{\\mu,0\\},\\max\\{\\sigma^2,0\\})$。\n- 报告最终的 $(\\mu(T),\\sigma^2(T))$。\n\n单位保持一致：$\\mu$ 的单位是分子，$\\sigma^2$ 的单位是分子$^2$，时间的单位是秒。测试套件涵盖：\n- 一个练习所有项的一般情况。\n- 一个具有强成对湮灭的情况，可能导致快速阻尼并挑战数值稳定性。\n- 一个初始方差为零的边界情况。\n- 一个大步长压力测试，可能引起过冲，使得投影变得至关重要。\n\n最终程序将四个测试用例的结果汇总到所需格式的单行中：$[[\\mu_1,\\sigma^2_1],[\\mu_2,\\sigma^2_2],[\\mu_3,\\sigma^2_3],[\\mu_4,\\sigma^2_4]]$。",
            "answer": "```python\nimport numpy as np\n\ndef gaussian_closure_third_moment(mu, var):\n    # E[X^3] under Gaussian closure (zero third cumulant)\n    return mu**3 + 3.0 * mu * var\n\ndef integrate_moments(kb, kd, ka, mu0, var0, T, dt):\n    mu = float(mu0)\n    var = float(var0)\n\n    t = 0.0\n    # Integrate to exactly time T with possibly shortened last step\n    while t  T - 1e-15:\n        h = dt\n        if t + h > T:\n            h = T - t\n\n        m2 = mu**2 + var\n        E3 = gaussian_closure_third_moment(mu, var)\n\n        dmu = kb - kd * mu - 2.0 * ka * (m2 - mu)\n        dm2 = (2.0 * kb * mu + kb\n               - 2.0 * kd * m2 + kd * mu\n               + ka * (-4.0 * E3 + 8.0 * m2 - 4.0 * mu))\n        dvar = dm2 - 2.0 * mu * dmu\n\n        mu_new = mu + h * dmu\n        var_new = var + h * dvar\n\n        # Euclidean projection onto feasible set: mu >= 0, var >= 0\n        mu = max(mu_new, 0.0)\n        var = max(var_new, 0.0)\n\n        t += h\n\n    return mu, var\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each case: (kb, kd, ka, mu0, var0, T, dt)\n    test_cases = [\n        (20.0, 0.5, 0.01, 10.0, 5.0, 10.0, 0.2),\n        (5.0, 0.3, 0.5, 25.0, 40.0, 10.0, 1.0),\n        (0.0, 0.1, 0.2, 50.0, 0.0, 5.0, 0.5),\n        (100.0, 2.0, 1.0, 1.0, 0.1, 5.0, 2.0),\n    ]\n\n    results = []\n    for kb, kd, ka, mu0, var0, T, dt in test_cases:\n        muT, varT = integrate_moments(kb, kd, ka, mu0, var0, T, dt)\n        results.append([muT, varT])\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join('[' + ','.join(map(str, pair)) + ']' for pair in results)}]\")\n\nsolve()\n```"
        }
    ]
}