{
    "hands_on_practices": [
        {
            "introduction": "The foundation of any constraint-based model is the stoichiometric matrix, $S$, which mathematically represents the network's structure. Before applying optimization, it is crucial to understand the properties of this matrix, as they define the space of all possible steady-state behaviors. In this exercise (), you will construct the $S$ matrix for a simple linear pathway and use linear algebra to determine its rank and the dimension of its nullspace, revealing the system's intrinsic degrees of freedom.",
            "id": "3339838",
            "problem": "Consider a minimal internal metabolic network with three irreversible reactions $R_1: A \\rightarrow B$, $R_2: B \\rightarrow C$, and $R_3: C \\rightarrow \\text{biomass}$, where the biomass is a pseudo-metabolite that is not included among the internal, mass-balanced metabolites. The internal metabolites are $A$, $B$, and $C$. In constraint-based modeling, the mass balance at steady state is given by $S v = 0$, where $S$ is the stoichiometric matrix (rows indexed by internal metabolites and columns indexed by reactions) and $v$ is the flux vector.\n\nStarting from first principles, namely the definition of the stoichiometric coefficients (negative for substrates consumed, positive for products formed) and the steady-state mass balance $S v = 0$, construct the stoichiometric matrix $S$ for this network using the ordering of metabolites $(A, B, C)$ and reactions $(R_1, R_2, R_3)$, compute the matrix rank $\\mathrm{rank}(S)$ and the nullspace dimension $\\dim(\\ker S)$, and interpret these quantities in terms of the structural degrees of freedom of the steady-state flux solution space.\n\nExpress your final answer as a row matrix with the first entry equal to $\\mathrm{rank}(S)$ and the second entry equal to $\\dim(\\ker S)$. No rounding is required.",
            "solution": "The problem requires the construction and analysis of the stoichiometric matrix for a given minimal metabolic network. The analysis is to be performed from first principles, based on the definition of stoichiometry and the steady-state mass balance condition.\n\nThe network is defined by three irreversible reactions involving three internal, mass-balanced metabolites:\nReaction $1$ ($R_1$): $A \\rightarrow B$\nReaction $2$ ($R_2$): $B \\rightarrow C$\nReaction $3$ ($R_3$): $C \\rightarrow \\text{biomass}$\n\nThe internal metabolites are specified as $A$, $B$, and $C$. The biomass is a pseudo-metabolite and is not included in the mass balance equations for the internal metabolites. The steady-state condition is given by the linear system $S v = 0$, where $S$ is the stoichiometric matrix and $v$ is the vector of reaction fluxes.\n\nThe first step is to construct the stoichiometric matrix $S$. The dimensions of $S$ are $m \\times n$, where $m$ is the number of internal metabolites and $n$ is the number of reactions. Based on the problem statement, we have $m=3$ and $n=3$. The rows of $S$ correspond to the metabolites, ordered as $(A, B, C)$, and the columns correspond to the reactions, ordered as $(R_1, R_2, R_3)$. An entry $S_{ij}$ in the matrix represents the stoichiometric coefficient of metabolite $i$ in reaction $j$. By convention, this coefficient is negative for a substrate (consumed) and positive for a product (formed).\n\nLet us determine the columns of $S$ one by one.\n\nFor reaction $R_1: A \\rightarrow B$:\n- Metabolite $A$ is consumed with a stoichiometry of $1$. Thus, $S_{11} = -1$.\n- Metabolite $B$ is produced with a stoichiometry of $1$. Thus, $S_{21} = 1$.\n- Metabolite $C$ is not involved. Thus, $S_{31} = 0$.\nThe first column of $S$ is $\\begin{pmatrix} -1 \\\\ 1 \\\\ 0 \\end{pmatrix}$.\n\nFor reaction $R_2: B \\rightarrow C$:\n- Metabolite $A$ is not involved. Thus, $S_{12} = 0$.\n- Metabolite $B$ is consumed with a stoichiometry of $1$. Thus, $S_{22} = -1$.\n- Metabolite $C$ is produced with a stoichiometry of $1$. Thus, $S_{32} = 1$.\nThe second column of $S$ is $\\begin{pmatrix} 0 \\\\ -1 \\\\ 1 \\end{pmatrix}$.\n\nFor reaction $R_3: C \\rightarrow \\text{biomass}$:\n- Metabolite $A$ is not involved. Thus, $S_{13} = 0$.\n- Metabolite $B$ is not involved. Thus, $S_{23} = 0$.\n- Metabolite $C$ is consumed with a stoichiometry of $1$. Thus, $S_{33} = -1$.\n(Biomass is an external sink and does not have a corresponding row in $S$).\nThe third column of $S$ is $\\begin{pmatrix} 0 \\\\ 0 \\\\ -1 \\end{pmatrix}$.\n\nCombining these columns, the stoichiometric matrix $S$ is:\n$$ S = \\begin{pmatrix} -1  0  0 \\\\ 1  -1  0 \\\\ 0  1  -1 \\end{pmatrix} $$\n\nThe next task is to compute the rank of $S$, denoted $\\mathrm{rank}(S)$. The rank of a matrix is the dimension of the vector space spanned by its columns (or rows), which is equivalent to the maximum number of linearly independent columns (or rows). The matrix $S$ is a $3 \\times 3$ square matrix. It is also a lower triangular matrix. The determinant of a triangular matrix is the product of its diagonal entries.\n$$ \\det(S) = S_{11} \\times S_{22} \\times S_{33} = (-1) \\times (-1) \\times (-1) = -1 $$\nSince the determinant of $S$ is non-zero ($\\det(S) = -1 \\neq 0$), the matrix is invertible and has full rank. For a $3 \\times 3$ matrix, full rank is $3$.\nTherefore, $\\mathrm{rank}(S) = 3$.\n\nThe subsequent task is to compute the dimension of the nullspace of $S$, denoted $\\dim(\\ker S)$. The nullspace (or kernel) of $S$ is the set of all vectors $v$ that satisfy the equation $S v = 0$. The dimension of the nullspace is related to the rank of the matrix by the rank-nullity theorem, which states:\n$$ \\mathrm{rank}(S) + \\dim(\\ker S) = n $$\nwhere $n$ is the number of columns in the matrix $S$. In this case, $n=3$, corresponding to the number of reactions.\nSubstituting the calculated rank:\n$$ 3 + \\dim(\\ker S) = 3 $$\n$$ \\dim(\\ker S) = 3 - 3 = 0 $$\nTherefore, the dimension of the nullspace of $S$ is $0$.\n\nFinally, we must interpret these results.\nThe equation $S v = 0$ represents the set of mass balance constraints at steady state. The metabolites must be produced and consumed at equal rates. The rank, $\\mathrm{rank}(S) = 3$, indicates that there are three linearly independent mass balance constraints on the three fluxes, one for each of the three internal metabolites. This means none of the metabolite balances are redundant.\n\nThe nullspace, $\\ker S$, represents the space of all possible steady-state flux distributions $v = (v_1, v_2, v_3)^T$. The dimension of the nullspace, $\\dim(\\ker S)$, gives the number of degrees of freedom in the system. It is the number of independent flux values that can be chosen freely while satisfying the steady-state constraints. A non-zero dimension implies the existence of internal cycles or multiple independent pathways through the network.\n\nIn this case, $\\dim(\\ker S) = 0$. This indicates that there are zero degrees of freedom. The only solution to the system $S v = 0$ is the trivial solution $v = (0, 0, 0)^T$. This means the only possible steady-state flux distribution for this network, as modeled, is one where all fluxes are zero. From a structural perspective, this is because the network is a simple linear chain with no inputs of metabolite $A$. For the concentration of $A$ to be at steady state, its consumption rate via $R_1$ must be zero, implying $v_1=0$. This in turn implies $v_2=0$ to balance metabolite $B$, and subsequently $v_3=0$ to balance metabolite $C$. This specific network structure allows for no non-trivial steady-state flux.\n\nThe final answer is to be expressed as a row matrix containing $\\mathrm{rank}(S)$ and $\\dim(\\ker S)$.\n$\\mathrm{rank}(S) = 3$\n$\\dim(\\ker S) = 0$\nThe row matrix is $(3, 0)$.",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 3  0 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "Flux Balance Analysis (FBA) finds a single, optimal metabolic state by maximizing a biological objective within the space of feasible steady-state fluxes. This practice () provides a first-principles walkthrough of this core process. By solving a minimal FBA problem analytically, you will gain a concrete understanding of how the steady-state constraint, $S v = 0$, combines with flux bounds and an objective function to define a specific solution.",
            "id": "3339878",
            "problem": "Consider a minimal metabolic network with two irreversible reactions, $R_1: A \\rightarrow B$ and $R_2: B \\rightarrow \\varnothing$, where $\\varnothing$ denotes an external sink. Assume that metabolite $A$ is external and unconstrained by intracellular mass balance, and that metabolite $B$ is the only internal metabolite subject to steady-state. The stoichiometric matrix for the internal metabolite $B$ is therefore $S \\in \\mathbb{R}^{1 \\times 2}$ with entries $S_{B,R_1} = 1$ and $S_{B,R_2} = -1$. Flux Balance Analysis (FBA) seeks a flux vector $v \\in \\mathbb{R}^2$ that maximizes a linear objective $c^{\\top} v$ subject to the steady-state constraint $S v = 0$ and bounds $l \\leq v \\leq u$.\n\nGiven the objective weights $c = (0, 1)$, lower bounds $l = (0, 0)$, and upper bounds $u = (10, 10)$, solve the FBA problem analytically. Report the optimal flux vector $v^{\\star}$ and the optimal objective value $z^{\\star} = c^{\\top} v^{\\star}$. Explicitly justify your solution from first principles by deriving the feasible set from $S v = 0$ and the bounds, and show how the objective achieves its maximum. Then, analyze whether the optimal solution is unique and discuss any degeneracy at the optimum in terms of the linear programming constraints. Express fluxes in $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$ (grams dry weight (gDW)), and express the objective value in $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$. No rounding is required since the optimal values are exact.",
            "solution": "The task is to solve the following linear programming (LP) problem analytically:\nMaximize $z = c^{\\top} v$\nSubject to:\n$S v = 0$\n$l \\leq v \\leq u$\n\nThe given parameters are:\nThe flux vector is $v = \\begin{pmatrix} v_1 \\\\ v_2 \\end{pmatrix}$, corresponding to the fluxes through reactions $R_1$ and $R_2$.\nThe stoichiometric matrix for the single internal metabolite $B$ is $S = \\begin{pmatrix} 1  -1 \\end{pmatrix}$.\nThe objective function weights are given by the vector $c = \\begin{pmatrix} 0 \\\\ 1 \\end{pmatrix}$.\nThe lower and upper bounds on the fluxes are $l = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$ and $u = \\begin{pmatrix} 10 \\\\ 10 \\end{pmatrix}$, respectively.\n\nFirst, we explicitly write out the objective function and the constraints.\nThe objective function to be maximized is:\n$$z = c^{\\top} v = \\begin{pmatrix} 0  1 \\end{pmatrix} \\begin{pmatrix} v_1 \\\\ v_2 \\end{pmatrix} = 0 \\cdot v_1 + 1 \\cdot v_2 = v_2$$\n\nThe constraints are:\n$1$. The steady-state mass balance constraint, $S v = 0$:\n$$\\begin{pmatrix} 1  -1 \\end{pmatrix} \\begin{pmatrix} v_1 \\\\ v_2 \\end{pmatrix} = 0$$\n$$v_1 - v_2 = 0 \\implies v_1 = v_2$$\nThis constraint implies that any feasible flux distribution must have equal fluxes for reaction $R_1$ (production of $B$) and reaction $R_2$ (consumption of $B$), which is necessary to maintain the concentration of metabolite $B$ at a steady state.\n\n$2$. The flux bounds, $l \\leq v \\leq u$:\n$$ \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix} \\leq \\begin{pmatrix} v_1 \\\\ v_2 \\end{pmatrix} \\leq \\begin{pmatrix} 10 \\\\ 10 \\end{pmatrix} $$\nThis expands to four individual inequalities:\n$$v_1 \\geq 0$$\n$$v_2 \\geq 0$$\n$$v_1 \\leq 10$$\n$$v_2 \\leq 10$$\n\nTo find the optimal solution, we must first define the feasible set of all possible flux vectors $v$ that satisfy all constraints simultaneously.\nFrom the steady-state constraint, we have $v_1 = v_2$. Substituting this into the bound inequalities:\nSince $v_1 = v_2$, the constraints $v_1 \\geq 0$ and $v_2 \\geq 0$ are equivalent.\nSimilarly, the constraints $v_1 \\leq 10$ and $v_2 \\leq 10$ are equivalent.\nCombining these, we find that the feasible set is described by all points $(v_1, v_2)$ such that:\n$$v_1 = v_2$$\nand\n$$0 \\leq v_1 \\leq 10$$\nGeometrically, this feasible set is the line segment in the $v_1$-$v_2$ plane starting from the origin $(0, 0)$ and ending at the point $(10, 10)$.\n\nNow, we solve the optimization problem. We wish to maximize the objective function $z = v_2$ over this feasible set. Since any feasible point must satisfy $v_1 = v_2$, we can state that $z = v_2 = v_1$ for any feasible flux distribution.\nThe value of $v_2$ over the feasible set is constrained by $0 \\leq v_2 \\leq 10$. The maximum possible value for $v_2$ is therefore $10$.\nThis maximum value is achieved when $v_2 = 10$.\nAccording to the steady-state constraint, if $v_2 = 10$, then $v_1$ must also equal $10$.\nThus, the optimal flux vector is:\n$$v^{\\star} = \\begin{pmatrix} v_1^{\\star} \\\\ v_2^{\\star} \\end{pmatrix} = \\begin{pmatrix} 10 \\\\ 10 \\end{pmatrix}$$\nThe optimal objective value is:\n$$z^{\\star} = c^{\\top} v^{\\star} = v_2^{\\star} = 10$$\nAccording to the problem statement, the flux and objective values are expressed in units of $\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$. So, $v_1^{\\star} = 10\\,\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$, $v_2^{\\star} = 10\\,\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$, and $z^{\\star} = 10\\,\\mathrm{mmol}\\,\\mathrm{gDW}^{-1}\\,\\mathrm{h}^{-1}$.\n\nNext, we analyze the uniqueness of the solution. The feasible set is the line segment connecting $(0,0)$ and $(10,10)$. The objective function $z = v_2$ is maximized by finding the point on this segment with the largest $v_2$ coordinate. This unequivocally occurs at the endpoint $(10, 10)$. Since there is only one such point in the feasible set that achieves the maximum objective value, the optimal solution $v^{\\star} = \\begin{pmatrix} 10 \\\\ 10 \\end{pmatrix}$ is unique.\n\nFinally, we analyze degeneracy. A vertex solution in an LP is degenerate if more constraints are active (i.e., hold at equality) than the dimension of the space. The space of variables $(v_1, v_2)$ is two-dimensional ($n=2$). Let's examine the constraints at the optimal solution $v^{\\star} = (10, 10)$:\n1. Mass balance: $v_1 - v_2 = 10-10 = 0$. This constraint is active.\n2. Lower bound on $v_1$: $v_1 \\geq 0$. This is $10 \\geq 0$, which is inactive.\n3. Lower bound on $v_2$: $v_2 \\geq 0$. This is $10 \\geq 0$, which is inactive.\n4. Upper bound on $v_1$: $v_1 \\leq 10$. This is $10 \\leq 10$, so the constraint $v_1 = 10$ is active.\n5. Upper bound on $v_2$: $v_2 \\leq 10$. This is $10 \\leq 10$, so the constraint $v_2 = 10$ is active.\n\nAt the optimal point $(10, 10)$, there are three active constraints: $v_1 - v_2 = 0$, $v_1 = 10$, and $v_2 = 10$. Since three constraints are active in a two-dimensional space (i.e., more than $n=2$), the optimal solution is degenerate. Geometrically, the optimal vertex $(10, 10)$ is the intersection of three lines, whereas a non-degenerate vertex in a 2D plane would be the intersection of exactly two lines. This over-determination of the vertex is the hallmark of degeneracy.\n\nIn summary, the optimal flux vector is $v^{\\star} = \\begin{pmatrix} 10 \\\\ 10 \\end{pmatrix}$, the optimal objective value is $z^{\\star} = 10$, the solution is unique, and it is degenerate. The final answer should report the numerical values of the components of $v^{\\star}$ ($v_1^{\\star}$, $v_2^{\\star}$) followed by $z^{\\star}$.",
            "answer": "$$\\boxed{\\begin{pmatrix} 10  10  10 \\end{pmatrix}}$$"
        },
        {
            "introduction": "A common challenge in FBA is that maximizing an objective like biomass production may yield an entire family of equally optimal flux distributions, a situation known as degeneracy. To obtain a single, predictive solution, we can apply a secondary criterion through lexicographic optimization. This practice () introduces parsimonious FBA (pFBA), a powerful method that selects the most efficient phenotype by minimizing the total metabolic flux among all growth-optimal solutions.",
            "id": "3339908",
            "problem": "You are given a family of linear steady-state metabolic models expressed in the canonical constraint-based modeling form. The model consists of a stoichiometric matrix $\\mathbf{S} \\in \\mathbb{R}^{m \\times n}$, a flux vector $\\mathbf{v} \\in \\mathbb{R}^{n}$, lower and upper bounds $\\mathbf{l}, \\mathbf{u} \\in \\mathbb{R}^{n}$ with $\\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}$, and a linear biomass objective vector $\\mathbf{c} \\in \\mathbb{R}^{n}$. The steady-state (mass balance) constraints are $\\mathbf{S}\\mathbf{v} = \\mathbf{0}$. The primary objective is to maximize the growth rate $\\mu = \\mathbf{c}^{\\top}\\mathbf{v}$ subject to the constraints.\n\nYour task is to implement a lexicographic objective known as parsimonious Flux Balance Analysis (pFBA): first, maximize $\\mu$; second, among all flux vectors that achieve the maximum growth $\\mu^\\star$, minimize the $\\ell_1$ norm $\\lVert \\mathbf{v} \\rVert_1 = \\sum_{i=1}^{n} |v_i|$. In all test cases below, the flux bounds are nonnegative so that $|v_i| = v_i$, and the $\\ell_1$ objective reduces to minimizing $\\sum_{i=1}^{n} v_i$.\n\nStarting from the core definitions in constraint-based modeling (steady-state $\\mathbf{S}\\mathbf{v}=\\mathbf{0}$, bounds $\\mathbf{l}\\le \\mathbf{v}\\le \\mathbf{u}$, and a linear objective $\\mathbf{c}^{\\top}\\mathbf{v}$), examine degeneracy in the optimal growth solution: identify a network where the growth optimum lies on a high-dimensional face, and then use pFBA to select a unique phenotype. To make this inherently testable, implement and solve the following three cases. For each case, you must perform the two-stage lexicographic optimization and also compute the quantities listed under Outputs. All computations must be purely numerical; no physical units are required.\n\nFundamental setup (applies to all cases):\n- Steady-state mass balance: $\\mathbf{S}\\mathbf{v} = \\mathbf{0}$.\n- Bounds: $\\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}$ with componentwise inequalities.\n- Primary objective: maximize $\\mu = \\mathbf{c}^{\\top}\\mathbf{v}$.\n- Secondary objective (parsimonious step): minimize $\\sum_{i=1}^{n} v_i$ subject to $\\mathbf{S}\\mathbf{v} = \\mathbf{0}$, $\\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}$, and $\\mathbf{c}^{\\top}\\mathbf{v} = \\mu^\\star$ where $\\mu^\\star$ is the maximum achieved in the primary step.\n\nTest suite (three cases):\n- Case A (degenerate growth optimum with an internal cycle; pFBA resolves to a unique phenotype). Metabolites are internal $A, B, C$ (external pools and the biomass sink are not balanced). Reactions $V_1,\\dots,V_6$:\n  1. $V_1$: uptake $A_\\text{ext} \\to A$,\n  2. $V_2$: $A \\to \\text{Biomass}$,\n  3. $V_3$: $A \\to B$,\n  4. $V_4$: $B \\to A$,\n  5. $V_5$: $A \\to C$,\n  6. $V_6$: $C \\to \\text{Biomass}$.\n  The stoichiometric matrix $\\mathbf{S} \\in \\mathbb{R}^{3 \\times 6}$ with rows ordered as $(A,B,C)$ and columns $(V_1,\\dots,V_6)$ is\n  $$\n  \\mathbf{S} =\n  \\begin{bmatrix}\n  1  -1  -1  1  -1  0 \\\\\n  0  0  1  -1  0  0 \\\\\n  0  0  0  0  1  -1\n  \\end{bmatrix}.\n  $$\n  Bounds (componentwise): $\\mathbf{l} = \\mathbf{0}$, $\\mathbf{u} = [10, 1000, 1000, 1000, 1000, 1000]^{\\top}$. Biomass objective: $\\mathbf{c} = [0, 1, 0, 0, 0, 1]^{\\top}$ so that $\\mu = v_2 + v_6$.\n\n- Case B (boundary case with zero uptake). Same $\\mathbf{S}$ and $\\mathbf{c}$ as Case A, but with $\\mathbf{u} = [0, 1000, 1000, 1000, 1000, 1000]^{\\top}$ (i.e., $V_1$ has upper bound $0$ while all others retain upper bound $1000$). Lower bounds remain $\\mathbf{l} = \\mathbf{0}$.\n\n- Case C (degenerate growth optimum with a duplicated parallel biomass pathway; pFBA fails to fully resolve uniqueness). Extend Case A by adding a seventh reaction $V_7$: $A \\to \\text{Biomass}$, which is a duplicate of $V_2$. The stoichiometric matrix $\\mathbf{S} \\in \\mathbb{R}^{3 \\times 7}$ is\n  $$\n  \\mathbf{S} =\n  \\begin{bmatrix}\n  1  -1  -1  1  -1  0  -1 \\\\\n  0  0  1  -1  0  0  0 \\\\\n  0  0  0  0  1  -1  0\n  \\end{bmatrix}.\n  $$\n  Bounds (componentwise): $\\mathbf{l} = \\mathbf{0}$, $\\mathbf{u} = [10, 1000, 1000, 1000, 1000, 1000, 1000]^{\\top}$. Biomass objective: $\\mathbf{c} = [0, 1, 0, 0, 0, 1, 1]^{\\top}$ so that $\\mu = v_2 + v_6 + v_7$.\n\nOutputs required for each case:\n- Compute the primary optimum $\\mu^\\star = \\max\\{\\mathbf{c}^{\\top}\\mathbf{v}: \\mathbf{S}\\mathbf{v} = \\mathbf{0}, \\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}\\}$ and report it as a floating-point number rounded to $6$ decimal places.\n- Compute the dimension $d$ of the optimal face when only equality constraints are considered, defined as\n  $$\n  d \\equiv n - \\operatorname{rank}(\\mathbf{A}_\\text{eq}), \\quad \\text{where } \\mathbf{A}_\\text{eq} =\n  \\begin{bmatrix}\n  \\mathbf{S} \\\\\n  \\mathbf{c}^{\\top}\n  \\end{bmatrix}.\n  $$\n  Report $d$ as an integer. This $d$ counts degrees of freedom of the affine subspace $\\{\\mathbf{v}: \\mathbf{S}\\mathbf{v}=\\mathbf{0}, \\mathbf{c}^{\\top}\\mathbf{v}=\\mu^\\star\\}$, ignoring which bound inequalities happen to be active.\n- Compute the pFBA secondary optimum value $z^\\star = \\min\\{\\sum_{i=1}^{n} v_i: \\mathbf{S}\\mathbf{v}=\\mathbf{0}, \\mathbf{l}\\le \\mathbf{v}\\le \\mathbf{u}, \\mathbf{c}^{\\top}\\mathbf{v}=\\mu^\\star\\}$ and the corresponding flux vector $\\mathbf{v}^\\star$. Report $z^\\star$ as a floating-point number rounded to $6$ decimal places, and report $\\mathbf{v}^\\star$ as a list of floating-point numbers rounded to $6$ decimal places.\n- Determine whether the pFBA solution is unique within the feasible polyhedron by testing the existence of a nonzero direction $\\mathbf{h} \\neq \\mathbf{0}$ that preserves all equalities and the pFBA objective, i.e.,\n  $$\n  \\mathbf{S}\\mathbf{h} = \\mathbf{0}, \\quad \\mathbf{c}^{\\top}\\mathbf{h} = 0, \\quad \\mathbf{1}^{\\top}\\mathbf{h} = 0,\n  $$\n  and that can be scaled by a sufficiently small $\\delta  0$ so that $\\mathbf{l} \\le \\mathbf{v}^\\star \\pm \\delta \\mathbf{h} \\le \\mathbf{u}$ remains satisfied. If such a direction exists, output the boolean value false; otherwise, output true. Use a numerical tolerance for the step size test of $10^{-9}$.\n- Final output format: Your program should produce a single line of output containing the results for the three cases as a comma-separated list enclosed in square brackets. Each caseâ€™s result must itself be a list structured as\n  $$\n  [\\mu^\\star, z^\\star, d, \\text{is\\_unique}, \\mathbf{v}^\\star],\n  $$\n  where $\\mu^\\star$ and $z^\\star$ are floats (rounded to $6$ decimals), $d$ is an integer, is_unique is a boolean, and $\\mathbf{v}^\\star$ is a list of floats (rounded to $6$ decimals). For example, a syntactically valid output line for three cases would look like\n  $$\n  [[0.000000,0.000000,0,true,[0.000000,0.000000]], [\\dots], [\\dots]].\n  $$\n\nYour implementation must solve the specified linear programs, compute matrix ranks using standard numerical linear algebra, and implement the small-step feasibility test described above to assess uniqueness. The output must use the exact format described, with all floating-point numbers rounded to $6$ decimal places.",
            "solution": "The user has provided a problem in the field of computational systems biology, specifically concerning parsimonious Flux Balance Analysis (pFBA). The task is to implement a two-step lexicographic optimization and analyze the resulting solution space for three distinct metabolic models.\n\n### Problem Validation\n\n**Step 1: Extract Givens**\n\n- **Model Form**: Linear steady-state metabolic model.\n- **Constraints**:\n    1.  Steady-state mass balance: $\\mathbf{S}\\mathbf{v} = \\mathbf{0}$, where $\\mathbf{S} \\in \\mathbb{R}^{m \\times n}$ is the stoichiometric matrix and $\\mathbf{v} \\in \\mathbb{R}^{n}$ is the flux vector.\n    2.  Flux bounds: $\\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}$.\n- **Optimization (Lexicographic)**:\n    1.  **Primary Objective**: Maximize growth rate $\\mu = \\mathbf{c}^{\\top}\\mathbf{v}$. Let the optimum be $\\mu^\\star$.\n    2.  **Secondary Objective (Parsimony)**: Minimize the $\\ell_1$ norm $\\lVert \\mathbf{v} \\rVert_1 = \\sum_{i=1}^{n} |v_i|$, subject to the original constraints and the additional constraint that growth is maximal, i.e., $\\mathbf{c}^{\\top}\\mathbf{v} = \\mu^\\star$. It is stated that for all cases, $\\mathbf{v} \\ge \\mathbf{0}$, so the objective becomes minimizing $\\sum_{i=1}^{n} v_i$.\n- **Test Cases**:\n    - **Case A**:\n        - $\\mathbf{S} = \\begin{bmatrix} 1  -1  -1  1  -1  0 \\\\ 0  0  1  -1  0  0 \\\\ 0  0  0  0  1  -1 \\end{bmatrix}$ ($n=6, m=3$)\n        - $\\mathbf{l} = \\mathbf{0}$, $\\mathbf{u} = [10, 1000, 1000, 1000, 1000, 1000]^{\\top}$\n        - $\\mathbf{c} = [0, 1, 0, 0, 0, 1]^{\\top}$\n    - **Case B**:\n        - Same $\\mathbf{S}$ and $\\mathbf{c}$ as Case A.\n        - $\\mathbf{l} = \\mathbf{0}$, $\\mathbf{u} = [0, 1000, 1000, 1000, 1000, 1000]^{\\top}$\n    - **Case C**:\n        - $\\mathbf{S} = \\begin{bmatrix} 1  -1  -1  1  -1  0  -1 \\\\ 0  0  1  -1  0  0  0 \\\\ 0  0  0  0  1  -1  0 \\end{bmatrix}$ ($n=7, m=3$)\n        - $\\mathbf{l} = \\mathbf{0}$, $\\mathbf{u} = [10, 1000, 1000, 1000, 1000, 1000, 1000]^{\\top}$\n        - $\\mathbf{c} = [0, 1, 0, 0, 0, 1, 1]^{\\top}$\n- **Required Outputs for each case**:\n    1.  Optimal growth rate $\\mu^\\star$.\n    2.  Dimension of the optimal growth face $d = n - \\operatorname{rank}(\\begin{bmatrix} \\mathbf{S} \\\\ \\mathbf{c}^{\\top} \\end{bmatrix})$.\n    3.  Optimal parsimonious flux sum $z^\\star = \\min \\sum v_i$ and the corresponding flux vector $\\mathbf{v}^\\star$.\n    4.  Uniqueness of the pFBA solution (`is_unique`), determined by testing for a nonzero direction $\\mathbf{h}$ such that $\\mathbf{S}\\mathbf{h} = \\mathbf{0}$, $\\mathbf{c}^{\\top}\\mathbf{h} = 0$, $\\mathbf{1}^{\\top}\\mathbf{h} = 0$, and $\\mathbf{l} \\le \\mathbf{v}^\\star \\pm \\delta \\mathbf{h} \\le \\mathbf{u}$ for some small $\\delta  0$ (using a tolerance of $10^{-9}$).\n\n**Step 2: Validate Using Extracted Givens**\n\nThe problem is a well-defined mathematical exercise in the domain of computational systems biology.\n- **Scientifically Grounded**: The problem is based on the standard and widely accepted framework of constraint-based modeling (Flux Balance Analysis). The concept of parsimonious FBA is a known method for resolving degeneracy in metabolic models. The network structures are simplified but plausible representations of metabolic pathways, including uptake, biomass production, and internal cycles.\n- **Well-Posed**: All matrices, vectors, bounds, and objectives are explicitly defined. The tasks involve solving linear programs (LPs) and performing linear algebra computations (rank, null space), which have well-defined solutions. The lexicographic optimization is a standard procedure.\n- **Objective**: The problem is stated using precise mathematical notation and formal definitions, leaving no room for subjective interpretation. The criteria for outputs, including the specific test for uniqueness, are unambiguous.\n- **Completeness**: The problem is self-contained. All necessary data and definitions for solving the three cases and producing the required outputs are provided.\n- **Consistency**: The definitions and data within the problem are internally consistent.\n\n**Step 3: Verdict and Action**\n\nThe problem is valid. It is a formal, well-posed, and scientifically sound problem in applied mathematics and systems biology. I will now proceed with the solution.\n\n### Solution\n\nThe solution requires a two-stage linear programming approach to implement parsimonious Flux Balance Analysis (pFBA), followed by an analysis of the solution's uniqueness.\n\n**Stage 1: Maximization of Growth Rate**\n\nThe first step is to find the maximum possible growth rate, $\\mu^\\star$. This is achieved by solving the following linear program (LP):\n$$\n\\begin{aligned}\n\\text{maximize} \\quad  \\mu = \\mathbf{c}^{\\top}\\mathbf{v} \\\\\n\\text{subject to} \\quad  \\mathbf{S}\\mathbf{v} = \\mathbf{0} \\\\\n \\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}\n\\end{aligned}\n$$\nThis is a standard LP problem. The maximization of $\\mathbf{c}^{\\top}\\mathbf{v}$ is equivalent to the minimization of $(-\\mathbf{c})^{\\top}\\mathbf{v}$.\n\n**Stage 2: Minimization of Total Flux (Parsimony)**\n\nThe second step selects, from the set of all flux distributions that achieve the maximal growth rate $\\mu^\\star$, the one that minimizes the total flux absolute sum. Since all fluxes are constrained to be non-negative ($\\mathbf{l}=\\mathbf{0}$), this simplifies to minimizing the sum of all fluxes. This is formulated as a second LP:\n$$\n\\begin{aligned}\n\\text{minimize} \\quad  z = \\sum_{i=1}^{n} v_i = \\mathbf{1}^{\\top}\\mathbf{v} \\\\\n\\text{subject to} \\quad  \\mathbf{S}\\mathbf{v} = \\mathbf{0} \\\\\n \\mathbf{c}^{\\top}\\mathbf{v} = \\mu^\\star \\\\\n \\mathbf{l} \\le \\mathbf{v} \\le \\mathbf{u}\n\\end{aligned}\n$$\nThe solution to this LP gives the parsimonious flux sum $z^\\star$ and the corresponding optimal flux vector $\\mathbf{v}^\\star$. Note that for non-unique pFBA solutions, the solver will return one specific point from the optimal solution set.\n\n**Calculation of Optimal Face Dimension, $d$**\n\nThe problem defines $d$ as the dimension of the affine subspace of flux vectors that satisfy the steady-state and maximal growth equality constraints, ignoring bounds. This is equivalent to the dimension of the null space of the combined constraint matrix $\\mathbf{A}_{\\text{eq}} = \\begin{bmatrix} \\mathbf{S} \\\\ \\mathbf{c}^{\\top} \\end{bmatrix}$. The dimension is calculated as:\n$$\nd = n - \\operatorname{rank}(\\mathbf{A}_{\\text{eq}})\n$$\nwhere $n$ is the number of fluxes (columns of $\\mathbf{S}$).\n\n**Uniqueness Test**\n\nThe uniqueness of the pFBA solution $\\mathbf{v}^\\star$ is assessed based on a specific criterion provided. The solution is considered non-unique if there exists a non-zero direction vector $\\mathbf{h} \\in \\mathbb{R}^n$ such that moving from $\\mathbf{v}^\\star$ along $\\mathbf{h}$ (in both positive and negative directions) preserves feasibility and optimality. This requires:\n1.  $\\mathbf{S}\\mathbf{h} = \\mathbf{0}$ (preserves steady state)\n2.  $\\mathbf{c}^{\\top}\\mathbf{h} = 0$ (preserves maximal growth)\n3.  $\\mathbf{1}^{\\top}\\mathbf{h} = 0$ (preserves minimal total flux)\n4.  $\\mathbf{l} \\le \\mathbf{v}^\\star \\pm \\delta \\mathbf{h} \\le \\mathbf{u}$ for some small scalar $\\delta  0$.\n\nCondition 4 is the most restrictive. For it to hold, any component $h_i$ of $\\mathbf{h}$ that is non-zero must correspond to a flux $v_i^\\star$ that is strictly between its lower and upper bounds ($l_i  v_i^\\star  u_i$). If $v_i^\\star$ is at a bound, we cannot move in both directions, so we must have $h_i=0$.\n\nThe test for uniqueness can thus be algorithmically implemented as follows:\n1.  Identify the set of flux indices $I_{active}$ for which the corresponding flux in $\\mathbf{v}^\\star$ is at its lower or upper bound: $I_{active} = \\{ i \\mid v_i^\\star = l_i \\text{ or } v_i^\\star = u_i \\}$.\n2.  Construct a matrix $\\mathbf{A}_{\\text{test}}$ by augmenting the matrix from conditions 1-3 with constraints that force $h_i=0$ for all $i \\in I_{active}$. The rows of $\\mathbf{A}_{\\text{test}}$ are the rows of $\\mathbf{S}$, $\\mathbf{c}^{\\top}$, $\\mathbf{1}^{\\top}$, and the standard basis vectors $\\mathbf{e}_i^\\top$ for each $i \\in I_{active}$.\n3.  We are looking for a non-zero solution to $\\mathbf{A}_{\\text{test}}\\mathbf{h} = \\mathbf{0}$. The existence of such a solution depends on the nullity of $\\mathbf{A}_{\\text{test}}$. The nullity is given by $n - \\operatorname{rank}(\\mathbf{A}_{\\text{test}})$.\n4.  If the nullity is greater than $0$, a valid non-zero $\\mathbf{h}$ exists, and the solution $\\mathbf{v}^\\star$ is not unique according to the specified criterion. Otherwise, the solution is unique.\n\nThis procedure will be applied to each of the three test cases using numerical methods for solving LPs and computing matrix ranks. The use of an interior-point LP solver is important, as it tends to find solutions in the center of the optimal face, which is crucial for the uniqueness test in cases of degeneracy (like Case C).",
            "answer": "[[10.000000,10.000000,2,true,[10.000000,10.000000,0.000000,0.000000,0.000000,0.000000]],[0.000000,0.000000,2,true,[0.000000,0.000000,0.000000,0.000000,0.000000,0.000000]],[10.000000,10.000000,3,false,[10.000000,5.000000,0.000000,0.000000,0.000000,0.000000,5.000000]]]"
        }
    ]
}