{
    "hands_on_practices": [
        {
            "introduction": "理论学习的最佳方式是实践。本节的第一个练习旨在巩固您对稳态概念的理解，并将其与基因表达等过程中固有的随机性联系起来。通过分析一个经典的“生灭”模型，您将亲手推导线性噪声近似（LNA）预测的涨落，并将其与化学主方程（CME）给出的精确解进行比较，从而深刻理解线性化方法在量化生物噪声中的威力与适用范围 。",
            "id": "3351256",
            "problem": "考虑一个单基因生灭模型，用于描述蛋白质拷贝数 $x(t) \\in \\{0,1,2,\\dots\\}$，该模型由两个基本反应控制：合成反应 $x \\to x+1$，其速率为常数 $k$（对 $x$ 是零级反应）；以及一级降解反应 $x \\to x-1$，其速率为 $\\gamma x$，其中 $k0$ 且 $\\gamma0$。假设在一个充分混合的区室中，因此质量作用动力学适用，且涨落由化学主方程（CME）控制。使用确定性平均场极限 $dx/dt = f(x)$ 以及稳态（不动点）的定义，即解 $x^{\\ast}$ 满足 $f(x^{\\ast})=0$，将随机动力学在 $x^{\\ast}$ 附近线性化，以获得线性噪声近似（LNA）。然后，从LNA出发，通过求解所得线性随机过程的稳态协方差方程，推导出 $x$ 的稳态方差 $\\Sigma_{\\mathrm{LNA}}$。独立地，求解稳态CME以获得精确的稳态分布，从而得到精确的稳态方差 $\\Sigma_{\\mathrm{exact}}$。最后，计算稳态下的比率 $\\Sigma_{\\mathrm{LNA}} / \\Sigma_{\\mathrm{exact}}$。请将最终答案表示为一个无单位的纯数，无需四舍五入。",
            "solution": "用户希望分析一个单基因生灭模型，并计算由线性噪声近似（LNA）预测的方差与从化学主方程（CME）推导出的精确方差之比。\n\n问题指定了蛋白质拷贝数 $x(t)$ 的以下基本反应：\n1. 合成：$\\emptyset \\xrightarrow{k} x$，倾向（速率）为 $w_1 = k$。化学计量变化为 $\\Delta x = +1$。\n2. 降解：$x \\xrightarrow{\\gamma x} \\emptyset$，倾向为 $w_2 = \\gamma x$。化学计量变化为 $\\Delta x = -1$。\n\n参数 $k$ 和 $\\gamma$ 是正常数。\n\n首先，我们建立确定性平均场动力学并找到稳态。\n通过将 $x$ 视为连续变量，并对生成和消耗的速率求和，可以得到拷贝数 $x$ 的确定性速率方程：\n$$\n\\frac{dx}{dt} = f(x) = k - \\gamma x\n$$\n稳态，或不动点 $x^{\\ast}$，是使变化率为零的 $x$ 值，即 $f(x^{\\ast})=0$。\n$$\nk - \\gamma x^{\\ast} = 0\n$$\n求解 $x^{\\ast}$ 得到稳态蛋白质拷贝数：\n$$\nx^{\\ast} = \\frac{k}{\\gamma}\n$$\n\n接下来，我们使用线性噪声近似（LNA）推导方差。LNA描述了围绕确定性稳态的涨落 $\\xi(t) = x(t) - x^{\\ast}$。对于一维系统，LNA采用Ornstein-Uhlenbeck过程的形式：\n$$\nd\\xi = J\\xi dt + \\sqrt{D} dW(t)\n$$\n其中 $J$ 是速率函数 $f(x)$ 在稳态 $x^{\\ast}$ 处的雅可比矩阵，$D$ 是扩散系数，$dW(t)$ 是维纳过程项。\n\n雅可比矩阵 $J$ 是 $f(x)$ 关于 $x$ 的导数：\n$$\nJ = \\frac{df}{dx} \\bigg|_{x=x^{\\ast}} = \\frac{d}{dx}(k - \\gamma x) \\bigg|_{x=x^{\\ast}} = -\\gamma\n$$\n扩散系数 $D$ 由各自倾向乘以其化学计量变化平方的和给出，并在稳态 $x^{\\ast}$ 处求值：\n$$\nD = \\sum_{i=1}^{2} (\\text{stoichiometry}_i)^2 \\times w_i(x^{\\ast})\n$$\n对于我们的两个反应：\n- 反应1（合成）：化学计量 $S_1 = +1$，倾向 $w_1(x) = k$。在稳态下，$w_1(x^{\\ast}) = k$。\n- 反应2（降解）：化学计量 $S_2 = -1$，倾向 $w_2(x) = \\gamma x$。在稳态下，$w_2(x^{\\ast}) = \\gamma x^{\\ast} = \\gamma \\left(\\frac{k}{\\gamma}\\right) = k$。\n\n因此，扩散系数为：\n$$\nD = (1)^2 w_1(x^{\\ast}) + (-1)^2 w_2(x^{\\ast}) = (1)(k) + (1)(k) = 2k\n$$\n涨落的稳态方差 $\\Sigma_{\\mathrm{LNA}} = \\langle \\xi^2 \\rangle_{\\mathrm{ss}}$，通过求解连续时间Lyapunov方程得到。对于一维系统，方程为：\n$$\nJ \\Sigma_{\\mathrm{LNA}} + \\Sigma_{\\mathrm{LNA}} J^T = -D\n$$\n由于系统是一维的，$J$ 是一个标量，且 $J^T = J$。\n$$\n2J \\Sigma_{\\mathrm{LNA}} = -D\n$$\n代入 $J$ 和 $D$ 的值：\n$$\n2(-\\gamma) \\Sigma_{\\mathrm{LNA}} = -2k\n$$\n求解LNA方差得到：\n$$\n\\Sigma_{\\mathrm{LNA}} = \\frac{k}{\\gamma}\n$$\n\n现在，我们通过求解稳态下的化学主方程（CME）来推导精确的稳态方差 $\\Sigma_{\\mathrm{exact}}$。设 $P_n$ 是有 $n$ 个分子的稳态概率。稳态CME要求流入任何状态 $n$ 的净概率通量为零。对于生灭过程，如果从状态 $n-1$ 到 $n$ 的通量等于从 $n$ 到 $n-1$ 的通量（细致平衡），则此条件得到满足：\n$$\nk P_{n-1} = \\gamma n P_n \\quad \\text{for } n \\ge 1\n$$\n这给出了递推关系：\n$$\nP_n = \\frac{k}{\\gamma n} P_{n-1}\n$$\n我们可以通过迭代求解这个关系：\n$$\nP_n = \\left(\\frac{k}{\\gamma n}\\right) P_{n-1} = \\left(\\frac{k}{\\gamma n}\\right) \\left(\\frac{k}{\\gamma (n-1)}\\right) P_{n-2} = \\dots = \\frac{(k/\\gamma)^n}{n!} P_0\n$$\n为了找到 $P_0$，我们使用归一化条件 $\\sum_{n=0}^{\\infty} P_n = 1$：\n$$\n\\sum_{n=0}^{\\infty} \\frac{(k/\\gamma)^n}{n!} P_0 = 1\n$$\n$$\nP_0 \\left( \\sum_{n=0}^{\\infty} \\frac{(k/\\gamma)^n}{n!} \\right) = 1\n$$\n这个和是指数函数 $\\exp(k/\\gamma)$ 的泰勒级数。\n$$\nP_0 \\exp\\left(\\frac{k}{\\gamma}\\right) = 1 \\implies P_0 = \\exp\\left(-\\frac{k}{\\gamma}\\right)\n$$\n将此代回 $P_n$ 的表达式，我们找到精确的稳态分布：\n$$\nP_n = \\frac{(k/\\gamma)^n \\exp(-k/\\gamma)}{n!}\n$$\n这是一个参数为 $\\lambda = k/\\gamma$ 的泊松分布。\n\n参数为 $\\lambda$ 的泊松分布的方差等于 $\\lambda$。因此，精确的稳态方差是：\n$$\n\\Sigma_{\\mathrm{exact}} = \\text{Var}(x) = \\lambda = \\frac{k}{\\gamma}\n$$\n值得注意的是，该分布的均值也是 $\\lambda = k/\\gamma$，这与确定性稳态 $x^{\\ast}$ 相同。\n\n最后，我们计算所需的比率 $\\Sigma_{\\mathrm{LNA}} / \\Sigma_{\\mathrm{exact}}$：\n$$\n\\frac{\\Sigma_{\\mathrm{LNA}}}{\\Sigma_{\\mathrm{exact}}} = \\frac{k/\\gamma}{k/\\gamma} = 1\n$$\n对于这个特定的线性生灭模型，LNA提供了精确的方差。这是因为反应倾向是物种计数的仿射函数（0次和1次），在这种条件下，从相应的Fokker-Planck方程（LNA是其近似）推导出的前两阶矩是精确的。",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "在掌握了基本的线性稳定性分析之后，我们来探讨一个更为微妙但至关重要的现象：瞬时放大。即使一个系统的所有特征值都预示其最终会回归稳定，但其网络的特定结构（即非正规性）可能导致扰动或噪声在衰减之前被短暂地急剧放大。这个计算练习将引导您使用数值横坐标和瞬时增益等工具来量化这种行为，揭示即使是稳定的基因调控网络也可能产生爆发性的瞬时响应 。",
            "id": "3351305",
            "problem": "考虑一个在一个稳态附近线性化的基因调控网络，其小偏差 $x(t) \\in \\mathbb{R}^{n}$ 产生一个形式为 $dx/dt = J x(t)$ 的线性时不变动力学系统，其中 $J \\in \\mathbb{R}^{n \\times n}$ 是在稳态处计算的雅可比矩阵。在存在外在或内在波动的情况下，一个标准的线性随机模型通过一个加性白噪声输入来扩展此系统，得到 $dx/dt = J x(t) + \\eta(t)$，其中 $\\eta(t)$ 是零均值高斯白噪声，其协方差矩阵为 $Q = \\sigma^{2} I$，其中 $\\sigma^{2} \\in \\mathbb{R}_{0}$ 是给定的噪声强度，$I$ 是单位矩阵。如果 $J$ 的所有特征值的实部都严格为负，则称该稳态是线性渐近稳定的。尽管系统具有渐近稳定性，$J$ 的非正规性（即，$J$ 与其转置不可交换）可能在扰动衰减前引起瞬态放大。我们基于核心定义，定义以下量：\n\n- 谱横坐标为 $\\alpha(J) = \\max \\{\\Re(\\lambda) : \\lambda \\text{ is an eigenvalue of } J\\}$。\n- 数值横坐标为 $\\omega(J) = \\sup_{\\|x\\|_{2} = 1} \\Re(x^{\\top} J x)$，它等于在 $t = 0$ 时沿方向 $x$ 的欧几里得范数的瞬时对数增长率（其中 $\\|\\cdot\\|_{2}$ 表示欧几里得范数）。\n- 时间 $t \\ge 0$ 时的瞬态放大因子为 $G(t) = \\|e^{J t}\\|_{2}$，即矩阵指数的诱导矩阵 2-范数。\n- 对于具有 $Q = \\sigma^{2} I$ 的随机系统，如果稳态是渐近稳定的，则稳态协方差 $P$ 满足连续时间李雅普诺夫方程 $J P + P J^{\\top} + Q = 0$。为了量化由耦合和非正规性引起的第一个基因表达中的潜在爆发性，定义一个基线解耦系统，其矩阵为 $J_{0} = \\mathrm{diag}(J)$，并让 $P_{0}$ 解方程 $J_{0} P_{0} + P_{0} J_{0}^{\\top} + Q = 0$。将第一个基因的爆发性指数定义为 $B = P_{11} / (P_{0})_{11}$，该指数比较了有耦合和无耦合情况下的稳态方差。\n\n任务：编写一个程序，对于下面给出的每个测试用例，计算：\n- 一个指示线性渐近稳定性的布尔值，即 $\\alpha(J)  0$ 是否成立。\n- 上面定义的数值横坐标 $\\omega(J)$。\n- 在 $[0, T_{\\max}]$ 上使用包含 $N$ 个点的均匀时间网格计算最大瞬态放大 $G_{\\max} = \\max_{t \\in [0, T_{\\max}]} G(t)$（其中 $T_{\\max} = 10$，$N = 2001$），以及在网格上达到此最大值的最早时间 $t_{\\mathrm{peak}} \\in [0, T_{\\max}]$。\n- 上面定义的爆发性指数 $B$，前提是稳态协方差存在（即，系统是渐近稳定的）。\n\n你必须使用的基本出发点：\n- 在不动点附近对光滑非线性系统进行线性化，得到 $dx/dt = J x$。\n- $dx/dt = J x$ 的解是 $x(t) = e^{J t} x(0)$。\n- 对于一个具有加性白噪声协方差 $Q$ 的稳定线性随机系统，其稳态协方差 $P$ 解方程 $J P + P J^{\\top} + Q = 0$。\n\n避免跳过必要推理的捷径；将你的算法决策建立在这些标准事实和定义之上。\n\n测试套件：\n- 用例 1：$J = \\begin{bmatrix} -1  0 \\\\ 0  -2 \\end{bmatrix}$，$\\sigma^{2} = 1$。\n- 用例 2：$J = \\begin{bmatrix} -1  10 \\\\ 0  -2 \\end{bmatrix}$，$\\sigma^{2} = 1$。\n- 用例 3：$J = \\begin{bmatrix} -1  2 \\\\ -2  -1 \\end{bmatrix}$，$\\sigma^{2} = 1$。\n- 用例 4：$J = \\begin{bmatrix} -0.1  1.5 \\\\ 0  -0.2 \\end{bmatrix}$，$\\sigma^{2} = 0.5$。\n- 用例 5：$J = \\begin{bmatrix} -1  15  0 \\\\ 0  -2  15 \\\\ 0  0  -3 \\end{bmatrix}$，$\\sigma^{2} = 1$。\n\n输出规范：\n- 对于每个用例，输出一个包含五个条目的列表：$[\\text{stable}, \\omega, G_{\\max}, t_{\\mathrm{peak}}, B]$，其中 $\\text{stable}$ 是一个布尔值，$\\omega$、$G_{\\max}$、$t_{\\mathrm{peak}}$ 和 $B$ 是保留六位小数的实数。如果系统不是渐近稳定的，则仅当李雅普诺夫方程的解存在时才将 $B$ 设为其计算出的特殊值；否则，将 $B$ 定义为 $0.0$。\n- 你的程序应生成单行输出，其中包含所有用例的结果，格式为方括号括起来的逗号分隔列表，例如 $[[\\text{stable}_{1}, \\omega_{1}, G_{\\max,1}, t_{\\mathrm{peak},1}, B_{1}], \\ldots, [\\text{stable}_{5}, \\omega_{5}, G_{\\max,5}, t_{\\mathrm{peak},5}, B_{5}]]$。\n\n输出中的所有数值量必须是纯数字（布尔值或实数），不带单位，且布尔值必须是字面值 True 或 False。如果出现角度，则必须以弧度为单位。不允许使用百分号；在需要时使用小数。",
            "solution": "该问题要求对几个线性时不变系统进行全面分析，这些系统是作为基因调控网络的线性化模型提出的。分析涉及评估稳定性、量化瞬态行为以及表征存在噪声时的稳态波动。解决方案将通过为每个所需指标系统地应用线性系统理论和矩阵分析的基本原理来制定。\n\n**1. 线性渐近稳定性**\n\n动力学系统中一个稳态的稳定性由其对小扰动的响应来定义。对于给定的线性系统 $\\frac{dx}{dt} = J x(t)$，从稳态 $x=0$ 开始的扰动 $x(t)$ 的时间演化由 $x(t) = e^{Jt} x(0)$ 给出。当 $t \\to \\infty$ 时的长期行为由雅可比矩阵 $J$ 的特征值决定。解可以表示为形如 $p(t)e^{\\lambda t}$ 的模态的线性组合，其中 $\\lambda$ 是 $J$ 的特征值，如果 $\\lambda$ 的几何重数小于其代数重数，则 $p(t)$ 是一个关于 $t$ 的多项式。\n\n为使状态 $x(t)$ 对于任何初始条件 $x(0)$ 都能衰减到零，所有这些模态都必须衰减。当且仅当 $J$ 的所有特征值 $\\lambda$ 的实部都严格为负时，即 $\\Re(\\lambda)  0$，这一点才能得到保证。谱横坐标定义为 $\\alpha(J) = \\max \\{\\Re(\\lambda) : \\lambda \\text{ is an eigenvalue of } J\\}$，它为稳定性提供了一个简洁的判据。当且仅当其谱横坐标为负，即 $\\alpha(J)  0$ 时，系统是线性渐近稳定的。\n\n因此，计算过程如下：\n1.  计算矩阵 $J$ 的所有特征值集合。\n2.  计算每个特征值的实部。\n3.  这些实部中的最大值即为谱横坐标 $\\alpha(J)$。\n4.  如果 $\\alpha(J)  0$，则稳定性的布尔标志设置为 `True`，否则设置为 `False`。\n\n**2. 数值横坐标**\n\n虽然谱横坐标决定了渐近衰减率，但扰动大小的初始、瞬时行为由另一个量决定。对于给定的初始方向 $x(0)$（其中 $\\|x(0)\\|_2 = 1$），欧几里得范数 $\\|x(t)\\|_2$ 在 $t=0$ 时的瞬时对数增长率由下式给出：\n$$\n\\frac{d}{dt}\\ln(\\|x(t)\\|_2)\\Big|_{t=0} = \\Re(x(0)^{\\top} J x(0))\n$$\n由于 $x(0)$ 是一个实向量，这可以简化。我们首先注意到 $x^{\\top} J x$ 是一个标量，因此它等于其转置 $x^{\\top} J^{\\top} x$。因此，我们可以写出 $x^{\\top} J x = \\frac{1}{2}(x^{\\top} J x + x^{\\top} J^{\\top} x) = x^{\\top} \\left( \\frac{J + J^{\\top}}{2} \\right) x$。数值横坐标 $\\omega(J)$ 是此增长率在所有可能的单位范数方向 $x(0)$ 上的上确界：\n$$\n\\omega(J) = \\sup_{\\|x\\|_{2} = 1} x^{\\top} \\left( \\frac{J + J^{\\top}}{2} \\right) x\n$$\n根据 Rayleigh-Ritz 定理，这个上确界等于对称矩阵 $H = \\frac{J + J^{\\top}}{2}$ 的最大特征值。一个正的数值横坐标 $\\omega(J)  0$ 表明存在初始扰动，其大小会瞬时增长，即使系统是渐近稳定的（$\\alpha(J)  0$）。\n\n计算过程如下：\n1.  构造 $J$ 的对称部分：$H = \\frac{1}{2}(J + J^{\\top})$。\n2.  计算 $H$ 的特征值。由于 $H$ 是对称的，其特征值是实数。\n3.  数值横坐标 $\\omega(J)$ 是 $H$ 的最大特征值。\n\n**3. 最大瞬态放大**\n\n在一个稳定的非正规系统中，瞬态增长现象由瞬态放大因子 $G(t) = \\|e^{Jt}\\|_2$ 来量化，其中 $\\|\\cdot\\|_2$ 是诱导 2-范数（或谱范数）。该因子表示单位范数的初始条件在时间 $t$ 时可能经历的最大放大。对于一个正规矩阵 $J$（即与其转置可交换的矩阵，$JJ^{\\top} = J^{\\top}J$），有 $\\|e^{Jt}\\|_2 = e^{\\alpha(J)t}$ 成立。在这种情况下，如果系统是稳定的（$\\alpha(J)0$），$G(t)$ 是一个单调递减函数，其最大值为 $G(0)=1$。然而，对于非正规矩阵，$G(t)$ 可以在最终衰减到 0 之前上升到 1 以上。\n\n为了找到最大放大 $G_{\\max}$ 及其发生的最早时间 $t_{\\mathrm{peak}}$，我们必须在指定区间 $[0, T_{\\max}]$ 上计算 $G(t)$。由于通常无法获得最大值的解析表达式，我们在一个离散网格上进行数值搜索。\n\n计算过程如下：\n1.  在区间 $[0, T_{\\max}=10]$ 上定义一个包含 $N=2001$ 个点的离散时间网格 $t_i$，这些点是均匀分布的。\n2.  对于每个时间点 $t_i$：\n    a.  计算矩阵指数 $E_i = e^{Jt_i}$。\n    b.  计算 $E_i$ 的诱导 2-范数 $G(t_i) = \\|E_i\\|_2$，它等于其最大奇异值。\n3.  在所有计算出的 $G(t_i)$ 中找到最大值以获得 $G_{\\max}$。\n4.  识别该最大值首次出现的索引，并从网格中找到相应的时间 $t_{\\mathrm{peak}}$。\n\n**4. 爆发性指数**\n\n对于具有噪声协方差 $Q = \\sigma^2 I$ 的随机系统 $\\frac{dx}{dt} = J x(t) + \\eta(t)$，当且仅当系统是渐近稳定的，稳态协方差矩阵 $P = \\mathbb{E}[x(t) x(t)^{\\top}]$ 才存在。在此条件下，$P$ 是连续时间李雅普诺夫方程的唯一的半正定解：\n$$\nJ P + P J^{\\top} + Q = 0\n$$\n对角元素 $P_{11}$ 是状态向量第一个分量的稳态方差，代表第一个基因的表达水平。\n\n为了量化网络耦合对该方差的贡献，我们将其与系统解耦的基线情景进行比较。解耦动力学由矩阵 $J_0 = \\mathrm{diag}(J)$ 控制，该矩阵仅保留网络的自我调节项。此解耦系统的稳态协方差 $P_0$ 是其相应李雅普诺夫方程的解：\n$$\nJ_0 P_0 + P_0 J_0^{\\top} + Q = 0\n$$\n爆发性指数 $B$ 定义为耦合系统中第一个基因的方差与解耦系统中该基因方差之比：\n$$\nB = \\frac{P_{11}}{(P_0)_{11}}\n$$\n$B1$ 的值表示网络耦合放大了第一个基因的波动。如果系统不是渐近稳定的，稳态协方差在物理上不存在，爆发性指数定义为 $0.0$。\n\n计算过程如下：\n1.  使用步骤 1 中的判据验证系统是否稳定。如果不稳定，则设置 $B=0.0$。\n2.  如果稳定，则构造噪声协方差矩阵 $Q = \\sigma^2 I$，其中 $I$ 是 $n \\times n$ 的单位矩阵。\n3.  使用数值求解器求解李雅普诺夫方程 $J P + P J^{\\top} = -Q$ 以获得矩阵 $P$。\n4.  构造解耦的雅可比矩阵 $J_0 = \\mathrm{diag}(J)$。\n5.  求解第二个李雅普诺夫方程 $J_0 P_0 + P_0 J_0^{\\top} = -Q$ 以获得矩阵 $P_0$。\n6.  计算爆发性指数 $B = P_{11} / (P_0)_{11}$。\n\n这种全面的方法为给定的线性系统提供了多方面的表征，并遵循了问题陈述中概述的基本原理。",
            "answer": "```python\nimport numpy as np\nfrom scipy import linalg\n\ndef solve():\n    \"\"\"\n    Solves the problem for all specified test cases.\n    \"\"\"\n\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (np.array([[-1.0, 0.0], [0.0, -2.0]]), 1.0),\n        (np.array([[-1.0, 10.0], [0.0, -2.0]]), 1.0),\n        (np.array([[-1.0, 2.0], [-2.0, -1.0]]), 1.0),\n        (np.array([[-0.1, 1.5], [0.0, -0.2]]), 0.5),\n        (np.array([[-1.0, 15.0, 0.0], [0.0, -2.0, 15.0], [0.0, 0.0, -3.0]]), 1.0)\n    ]\n\n    all_results = []\n    \n    for J, sigma_sq in test_cases:\n        result = compute_metrics(J, sigma_sq)\n        all_results.append(result)\n\n    # Format the final output string as specified\n    formatted_strings = []\n    for res in all_results:\n        stable = res[0]\n        # round all numeric values to 6 decimal places\n        omega = f\"{res[1]:.6f}\"\n        g_max = f\"{res[2]:.6f}\"\n        t_peak = f\"{res[3]:.6f}\"\n        b = f\"{res[4]:.6f}\"\n        formatted_strings.append(f\"[{stable},{omega},{g_max},{t_peak},{b}]\")\n    \n    final_output = f\"[{','.join(formatted_strings)}]\"\n    print(final_output)\n\ndef compute_metrics(J, sigma_sq):\n    \"\"\"\n    Computes all required metrics for a single test case.\n\n    Args:\n        J (np.ndarray): The Jacobian matrix.\n        sigma_sq (float): The noise strength.\n\n    Returns:\n        list: A list containing [stable, omega, G_max, t_peak, B].\n    \"\"\"\n    n = J.shape[0]\n\n    # 1. Linear Asymptotic Stability (Spectral Abscissa)\n    eigenvalues = linalg.eigvals(J)\n    spectral_abscissa = np.max(np.real(eigenvalues))\n    is_stable = spectral_abscissa  0\n\n    # 2. Numerical Abscissa\n    H = (J + J.T) / 2.0\n    # For a symmetric/Hermitian matrix, eigvals are real\n    # eigvalsh is specialized and more efficient for this\n    omega = np.max(linalg.eigvalsh(H))\n\n    # 3. Maximum Transient Amplification\n    T_max = 10.0\n    N = 2001\n    t_grid = np.linspace(0, T_max, N)\n    \n    G_values = []\n    for t in t_grid:\n        if t == 0:\n            # ||e^0||_2 = ||I||_2 = 1.0\n            norm_val = 1.0\n        else:\n            exp_Jt = linalg.expm(J * t)\n            norm_val = linalg.norm(exp_Jt, ord=2)\n        G_values.append(norm_val)\n\n    G_max = np.max(G_values)\n    # Get the index of the first occurrence of the maximum value\n    t_peak_idx = np.argmax(G_values)\n    t_peak = t_grid[t_peak_idx]\n\n    # 4. Burstiness Index\n    B = 0.0\n    if is_stable:\n        Q = sigma_sq * np.eye(n)\n        \n        # Full system covariance\n        # solve JP + PJ^T = -Q\n        P = linalg.solve_lyapunov(J, -Q)\n        \n        # Decoupled system covariance\n        J0 = np.diag(np.diag(J))\n        # solve J0*P0 + P0*J0^T = -Q\n        P0 = linalg.solve_lyapunov(J0, -Q)\n\n        P11 = P[0, 0]\n        P0_11 = P0[0, 0]\n        \n        # Avoid division by zero, though not expected in this problem for stable systems\n        if P0_11 != 0:\n            B = P11 / P0_11\n\n    return [is_stable, omega, G_max, t_peak, B]\n\nsolve()\n```"
        },
        {
            "introduction": "生物系统很少是孤立和恒定的；它们常常受到外部环境的周期性驱动，例如昼夜节律或细胞周期。在这种情况下，系统可能不会收敛到一个固定的稳态，而是进入一个与外部驱动同步的周期性轨道。这个练习将带您走出静态不动点的框架，应用弗洛凯理论（Floquet theory）来分析这种非自治周期性系统的稳定性，并判断系统是否能被外部节律“拖曳”，这对于理解生物钟和环境适应等现象至关重要 。",
            "id": "3351265",
            "problem": "考虑一个具有正向自调节的单物种基因产物，其合成速率受到外部施加的季节性调制。状态变量是浓度 $x(t)$，以任意单位 (A.U.) 计量，时间 $t$ 以小时计量。合成速率被调制为一个周期函数 $ \\theta(t) = \\theta_0 + \\epsilon \\cos(\\omega t) $，其中 $ \\theta_0 $ 和 $ \\epsilon $ 的单位是 A.U./小时，角频率 $ \\omega $ 的单位是弧度/小时。降解为一级反应，速率常数为 $ \\delta $ (单位: $ \\mathrm{hour}^{-1} $)。自调节遵循Hill型激活，指数为 $ n $，半饱和浓度为 $ K $ (单位: A.U.)。一个无量纲的基础合成组分 $ b $ 确保了即使在 $ x $ 趋于零时也有非零的产物生成。动力学定律由以下常微分方程给出\n$$\n\\frac{dx}{dt} = \\theta(t) \\left[ b + \\frac{\\left(\\frac{x}{K}\\right)^n}{1 + \\left(\\frac{x}{K}\\right)^n} \\right] - \\delta x.\n$$\n在周期驱动系统的线性稳定性分析框架内，目标是围绕一个周期为 $T$ 的响应 $x^*(t)$ 来表征其对周期 $T = \\frac{2\\pi}{\\omega}$ (单位：小时)的驱动的拖拽与不稳定性。周期为 $T$ 的解 $x^*(t)$ 由频闪不动点条件 $x^*(0) = x_0^*$ 定义，使得 $x(T; x_0^*) = x_0^*$，其中 $x(T; x_0)$ 表示在给定驱动下，系统从初始值 $x(0) = x_0$ 积分到时间 $T$ 后达到的状态。\n\n从该模型和Floquet理论的基本定义出发，您必须：\n- 通过求解频闪不动点条件 $ x(T; x_0^*) = x_0^* $ 来数值确定 $ x_0^* $。在一个物理上合理的区间内，对标量函数 $ g(x_0) = x(T; x_0) - x_0 $ 使用一种数学上具有良好原理的方法（例如求根法）。\n- 围绕周期解 $ x^*(t) $ 对系统进行线性化，以获得变分方程 $ \\frac{d \\varphi}{dt} = a(t) \\varphi $，其中 $ a(t) $ 是瞬时雅可比矩阵 $ \\frac{\\partial f}{\\partial x} $ 沿着 $ x^*(t) $ 求得的值，且 $ f(x,t) = \\theta(t)\\left[ b + \\frac{\\left(\\frac{x}{K}\\right)^n}{1 + \\left(\\frac{x}{K}\\right)^n} \\right] - \\delta x $。在初始条件 $ \\varphi(0) = 1 $ 下，对变分方程在一个驱动周期 $ T $ 上进行积分，以获得Floquet乘子 $ \\mu = \\varphi(T) $。\n- 使用线性稳定性准则 $ |\\mu|  1 $（拖拽）和线性不稳定性准则 $ |\\mu|  1 $（无拖拽）来预测拖拽与不稳定性区域，并相应地以布尔值形式表示结果。\n\n角度单位：$ \\omega $ 使用弧度，时间使用小时。Floquet乘子 $ \\mu $ 是无量纲的。计算出的 $ \\mu $ 值必须报告并四舍五入到六位小数。\n\n测试套件：\n使用以下参数集，表示为有序元组 $ (\\theta_0, \\epsilon, \\omega, \\delta, K, n, b) $。对于每种情况，$ \\omega $ 对应于24小时周期，因此 $ \\omega = \\frac{2\\pi}{24} $ 弧度/小时，且 $ T = 24 $ 小时。\n1. $(2.5, 1.0, \\frac{2\\pi}{24}, 1.2, 1.0, 4, 0.05)$\n2. $(10.0, 8.0, \\frac{2\\pi}{24}, 0.15, 1.0, 6, 0.05)$\n3. $(3.5, 3.0, \\frac{2\\pi}{24}, 0.5, 1.0, 5, 0.05)$\n\n要求的最终输出格式：\n您的程序应生成单行输出，其中包含三个测试用例的结果，形式为一个用方括号括起来的逗号分隔列表。每个测试用例的结果本身必须是一个列表，包含两个条目：Floquet乘子（一个四舍五入到六位小数的浮点数）和稳定性分类（一个布尔值），并按此顺序排列。例如： \n$ [ [\\mu_1, \\text{True}], [\\mu_2, \\text{False}], [\\mu_3, \\text{True}] ] $。\n\n不允许外部输入；所有参数必须硬编码。程序必须是自包含的，并且可以按原样运行。",
            "solution": "该问题要求对一个代表具有周期性驱动的单基因自调节回路的非自治常微分方程（ODE）的周期解进行稳定性分析。这种周期为$T$的解 $x^*(t)$ 的稳定性是使用Floquet理论来确定的。其核心思想是围绕该周期轨道对系统进行线性化，并分析小扰动在一个驱动周期内的演变。\n\n控制ODE为：\n$$\n\\frac{dx}{dt} = f(x, t) = \\theta(t) \\left[ b + \\frac{\\left(\\frac{x}{K}\\right)^n}{1 + \\left(\\frac{x}{K}\\right)^n} \\right] - \\delta x\n$$\n其中合成速率由$\\theta(t) = \\theta_0 + \\epsilon \\cos(\\omega t)$周期性调制。外部驱动的周期为 $T = \\frac{2\\pi}{\\omega}$。\n\n分析过程按以下三个顺序步骤进行：\n\n第1步：确定周期解 $x^*(t)$。\n周期解 $x^*(t)$ 必须对所有 $t$ 满足条件 $x^*(t+T) = x^*(t)$。这等同于找到一个“频闪不动点” $x_0^* = x^*(0)$，使得如果我们从 $x(0) = x_0^*$ 开始积分ODE，轨迹在一个周期后返回到相同的值，即 $x(T; x_0^*) = x_0^*$。这里，$x(T; x_0)$ 表示初始条件为 $x_0$ 时ODE在时间 $T$ 的数值解。为了找到 $x_0^*$，我们定义一个函数 $g(x_0) = x(T; x_0) - x_0$。所期望的初始值 $x_0^*$ 是方程 $g(x_0) = 0$ 的一个根。这是一个标量函数的求根问题。我们将采用一种数值求根算法，特别是Brent-Dekker方法，该方法需要一个区间 $[a, b]$，其中 $g(a)$ 和 $g(b)$ 的符号相反。为浓度 $x$（必须为非负）建立一个物理上有意义的搜索区间，例如，从一个非常小的正值到一个基于最大产率和最小降解率估计出的上限。对于给定的 $x_0$，$g(x_0)$ 的值是通过使用自适应求解器（如 `scipy.integrate.solve_ivp`）将ODE从 $t=0$ 积分到 $t=T$ 来计算的。\n\n第2步：将系统线性化并计算Floquet乘子 $\\mu$。\n一旦通过其初始条件 $x_0^*$ 确定了周期轨道 $x^*(t)$，我们就分析其稳定性。我们考虑对周期解的一个小扰动 $\\varphi(t)$，$x(t) = x^*(t) + \\varphi(t)$。将此代入ODE并进行一阶泰勒展开，得到变分方程：\n$$\n\\frac{d\\varphi}{dt} \\approx \\frac{\\partial f(x,t)}{\\partial x}\\bigg|_{x=x^*(t)} \\varphi(t)\n$$\n令 $a(t) = \\frac{\\partial f(x,t)}{\\partial x}\\big|_{x=x^*(t)}$。变分方程为 $\\frac{d\\varphi}{dt} = a(t) \\varphi(t)$。\n雅可比项 $a(t)$ 计算如下：\n$$\na(t) = \\frac{\\partial}{\\partial x} \\left( \\theta(t) \\left[ b + \\frac{x^n}{K^n + x^n} \\right] - \\delta x \\right) \\Bigg|_{x=x^*(t)}\n$$\n$$\na(t) = \\theta(t) \\frac{n K^n (x^*(t))^{n-1}}{(K^n + (x^*(t))^n)^2} - \\delta\n$$\n线性变分方程的解为 $\\varphi(t) = \\varphi(0) \\exp\\left(\\int_0^t a(\\tau) d\\tau\\right)$。Floquet乘子 $\\mu$ 给出了扰动在一个周期 $T$ 后被缩放的因子。它被定义为 $\\mu = \\varphi(T) / \\varphi(0)$。通过将初始扰动设为1，即 $\\varphi(0) = 1$，乘子就是 $\\mu = \\varphi(T)$。\n为了计算 $\\mu$，我们构建一个包含两个ODE的耦合系统：\n$$\n\\begin{cases}\n\\frac{dx}{dt} = f(x, t) \\\\\n\\frac{d\\varphi}{dt} = a(t) \\varphi = \\left( \\theta(t) \\frac{n K^n x^{n-1}}{(K^n + x^n)^2} - \\delta \\right) \\varphi\n\\end{cases}\n$$\n我们在初始条件 $x(0) = x_0^*$ 和 $\\varphi(0) = 1$ 下，将此系统在一个周期内（从 $t=0$ 到 $t=T$）进行积分。解向量在 $t=T$ 时的第二个分量的值即为Floquet乘子 $\\mu$。\n\n第3步：对稳定性进行分类。\n周期轨道 $x^*(t)$ 的稳定性由Floquet乘子 $\\mu$ 的幅值决定：\n- 如果 $|\\mu|  1$，扰动随时间衰减，轨道是线性稳定的。称系统被周期性驱动所“拖拽”。\n- 如果 $|\\mu|  1$，扰动会增长，轨道是不稳定的。系统未能被驱动周期拖拽，并可能表现出更复杂的动力学行为，如准周期性或混沌。\n- $|\\mu| = 1$ 的情况是临界（中性稳定）情况，通常指示一个分岔点。\n\n将要实现的算法将对测试套件中提供的每个参数集执行这三个步骤。每个案例的最终输出将包括计算出的Floquet乘子 $\\mu$（四舍五入到六位小数）和一个指示稳定性的布尔值（如果 $|\\mu|  1$ 则为$True$，否则为$False$）。",
            "answer": "```python\nimport numpy as np\nfrom scipy.integrate import solve_ivp\nfrom scipy.optimize import brentq\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test cases.\n    It iterates through each parameter set, calculates the Floquet multiplier\n    and stability, and prints the results in the required format.\n    \"\"\"\n    \n    # Test cases as tuples: (theta0, epsilon, omega, delta, K, n, b)\n    test_cases = [\n        (2.5, 1.0, 2 * np.pi / 24, 1.2, 1.0, 4, 0.05),\n        (10.0, 8.0, 2 * np.pi / 24, 0.15, 1.0, 6, 0.05),\n        (3.5, 3.0, 2 * np.pi / 24, 0.5, 1.0, 5, 0.05)\n    ]\n\n    results = []\n    for params in test_cases:\n        mu, is_stable = analyze_system(params)\n        results.append([round(mu, 6), is_stable])\n\n    # Format the output as a string representation of a list of lists.\n    # e.g., [[-0.00018, True],[1.75881, False],[1.309038, False]]\n    # The default str() for a list provides the correct spacing and format.\n    print(f\"[{','.join(map(str, results))}]\")\n\ndef analyze_system(params):\n    \"\"\"\n    Analyzes a single parameter set to find the Floquet multiplier and stability.\n    \n    Args:\n        params (tuple): A tuple of a single test case's parameters.\n    \n    Returns:\n        tuple: A tuple containing the Floquet multiplier (float) and stability (bool).\n    \"\"\"\n    theta0, eps, omega, delta, K, n, b = params\n    T = 2 * np.pi / omega\n\n    def ode_system(t, y, p):\n        \"\"\" The coupled ODE system for [x, phi]. \"\"\"\n        x, phi = y\n        theta0_p, eps_p, omega_p, delta_p, K_p, n_p, b_p = p\n        \n        theta_t = theta0_p + eps_p * np.cos(omega_p * t)\n        \n        # Non-linear term (Hill function)\n        x_over_K_n = (x / K_p)**n_p\n        hill_term = x_over_K_n / (1 + x_over_K_n)\n        \n        # dx/dt\n        dxdt = theta_t * (b_p + hill_term) - delta_p * x\n        \n        # Jacobian component a(t)\n        # Derivative of the Hill term w.r.t x\n        deriv_hill = (n_p * K_p**n_p * x**(n_p - 1)) / (K_p**n_p + x**n_p)**2\n        a_t = theta_t * deriv_hill - delta_p\n        \n        # dphi/dt\n        dphidt = a_t * phi\n        \n        return [dxdt, dphidt]\n\n    def stroboscopic_map_error(x0, p):\n        \"\"\"\n        Calculates g(x0) = x(T; x0) - x0. The root of this function is the\n        stroboscopic fixed point.\n        \"\"\"\n        # We only need to integrate the x component to find the fixed point.\n        # Initial condition y0 = [x, phi], but phi component is not used here.\n        y0 = [x0, 1.0] \n        sol = solve_ivp(ode_system, [0, T], y0, args=(p,), dense_output=True, rtol=1e-9, atol=1e-12)\n        x_T = sol.sol(T)[0]\n        return x_T - x0\n\n    # Step 1: Find the stroboscopic fixed point x0_star\n    # A robust search bracket for concentration, which must be positive.\n    # The upper bound is estimated based on maximum synthesis rate.\n    search_bracket = [1e-9, 2 * (theta0 + eps) / delta + 10]\n    try:\n        x0_star = brentq(stroboscopic_map_error, a=search_bracket[0], b=search_bracket[1], args=(params,), xtol=1e-12)\n    except ValueError:\n        # This might happen if g(a) and g(b) have the same sign.\n        # For this problem, the bracket should be safe. If not, this indicates an issue.\n        print(f\"Root finding failed for params: {params}\")\n        return np.nan, False\n\n    # Step 2: Calculate the Floquet multiplier mu\n    # Integrate the full coupled system with x(0) = x0_star and phi(0) = 1\n    y0_star = [x0_star, 1.0]\n    sol_full = solve_ivp(ode_system, [0, T], y0_star, args=(params,), rtol=1e-9, atol=1e-12)\n    phi_T = sol_full.y[1, -1]\n    mu = phi_T\n\n    # Step 3: Determine stability\n    is_stable = np.abs(mu)  1.0\n\n    return mu, is_stable\n\nif __name__ == '__main__':\n    solve()\n```"
        }
    ]
}