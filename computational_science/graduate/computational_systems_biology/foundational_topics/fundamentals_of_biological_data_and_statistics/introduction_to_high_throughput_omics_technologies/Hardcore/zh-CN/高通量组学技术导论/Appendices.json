{
    "hands_on_practices": [
        {
            "introduction": "任何下游分析的成功都取决于测序数据的质量。本练习将深入探讨“文库复杂度”这一基本概念，它量化了你所制备样本中分子的多样性。通过推导和应用一个测序饱和度模型 ，你将学会如何预测独特信息的产出，并理解测序收益递減的临界点，这是设计高性价比测序实验的一项关键技能。",
            "id": "3321409",
            "problem": "在新一代测序（NGS）中，测序文库是为测序而准备的一组不同分子的集合。聚合酶链式反应（PCR）扩增和有限的文库大小会导致多个读数（reads）源于同一个原始分子，从而产生重复。将文库复杂度定义为文库中存在的不同分子的总数 $M$，并假设每次读取都是从这 $M$ 个分子中有放回地均匀随机抽样一个分子。如果一个读数对应于一个先前未被观察到的分子，则该读数被认为是唯一的；如果它对应于一个已经产生至少一个读数的分子，则被认为是重复的。\n\n从随机抽样和期望的线性性的核心定义出发，推导从一个大小为 $M$ 的文库中进行 $N$ 次独立读取后，至少被观察到一次的不同分子的期望数量。解释在该随机抽样模型下，这个期望数量如何形式化重复率和文库复杂度的概念，并论证在规划更深层次测序时使用该推导表达式的合理性。\n\n然后，对于一个全基因组NGS文库，其中有 $M=2\\times 10^{7}$ 个不同分子和 $N=5\\times 10^{7}$ 次读取，计算你的推导所隐含的唯一读数的期望数量。将你的数值答案四舍五入到四位有效数字。最终答案以无单位的纯数字表示。",
            "solution": "问题需要经过验证。\n\n### 步骤1：提取已知条件\n- 文库复杂度是不同分子的总数，$M$。\n- 有 $N$ 次独立读取。\n- 每次读取都是从 $M$ 个分子中有放回地均匀随机抽样一个分子。\n- 如果一个读数对应于一个先前未被观察到的分子，则该读数是唯一的。\n- 如果一个读数对应于一个已经产生至少一个读数的分子，则该读数是重复的。\n- 任务1：推导从大小为 $M$ 的文库中进行 $N$ 次读取后，至少被观察到一次的不同分子的期望数量。\n- 任务2：解释这如何形式化重复率和文库复杂度。\n- 任务3：论证在规划更深层次测序时使用该表达式的合理性。\n- 任务4：对于特定情况，$M=2 \\times 10^{7}$ 和 $N=5 \\times 10^{7}$，计算唯一读数的期望数量。\n- 任务5：将数值答案四舍五入到四位有效数字。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，因为它描述了一个用于测序文库饱和度的标准且广泛使用的概率模型，通常被类比为“优惠券收集者问题”。文库复杂度、随机抽样和重复率的概念是高通量测序数据分析的基础。该问题提法明确，提供了所有必要的参数（$M$，$N$）和一个清晰的抽样模型（有放回均匀抽样），以推导出唯一且有意义的解。语言客观，给定的数值对于现代测序实验是符合实际的。未发现与科学合理性、完整性、一致性或客观性相关的缺陷。\n\n### 步骤3：结论与行动\n该问题有效。将提供完整解答。\n\n### 不同分子期望数量的推导\n\n设 $M$ 为文库中不同分子的总数（文库复杂度），设 $N$ 为总读取次数。问题陈述，每次读取都是从 $M$ 个分子中有放回地均匀随机抽样。我们需要求出至少被观察到一次的不同分子的期望数量。\n\n设 $X$ 是一个随机变量，表示经过 $N$ 次读取后观察到的不同分子的数量。为了求出 $X$ 的期望 $E[X]$，我们可以使用期望的线性性。我们为文库中的每个分子定义一组指示随机变量 $X_i$，其中 $i$ 的范围从 $1$ 到 $M$。\n\n设 $X_i$ 定义为：\n$$\nX_i = \n\\begin{cases} \n1  \\text{如果分子 } i \\text{ 在 } N \\text{ 次读取中至少被观察到一次} \\\\\n0  \\text{如果分子 } i \\text{ 在 } N \\text{ 次读取中从未被观察到}\n\\end{cases}\n$$\n观察到的不同分子的总数 $X$ 是这些指示变量的和：\n$$\nX = \\sum_{i=1}^{M} X_i\n$$\n根据期望的线性性，$X$ 的期望值是各个指示变量期望值的和：\n$$\nE[X] = E\\left[\\sum_{i=1}^{M} X_i\\right] = \\sum_{i=1}^{M} E[X_i]\n$$\n指示变量的期望是它所指示事件的概率。因此，$E[X_i] = P(X_i = 1)$。\n\n概率 $P(X_i = 1)$ 是分子 $i$ 至少被观察到一次的概率。更直接的方法是先计算其互补概率 $P(X_i = 0)$，即分子 $i$ 从未被观察到的概率。\n\n对于单次读取，由于均匀抽样假设，抽到任何特定分子 $i$ 的概率为 $p = \\frac{1}{M}$。因此，在单次读取中*不*抽到分子 $i$ 的概率是 $1 - p = 1 - \\frac{1}{M}$。\n\n由于 $N$ 次读取是独立事件，因此在 $N$ 次读取中都未观察到分子 $i$ 的概率是每次读取中都未观察到它的概率的乘积：\n$$\nP(X_i = 0) = \\left(1 - \\frac{1}{M}\\right)^N\n$$\n因此，至少观察到一次分子 $i$ 的概率是：\n$$\nP(X_i = 1) = 1 - P(X_i = 0) = 1 - \\left(1 - \\frac{1}{M}\\right)^N\n$$\n这就给出了每个指示变量的期望：$E[X_i] = 1 - \\left(1 - \\frac{1}{M}\\right)^N$。\n\n由于这个概率对于所有分子 $i=1, \\dots, M$ 都是相同的，我们现在可以计算总期望 $E[X]$：\n$$\nE[X] = \\sum_{i=1}^{M} \\left(1 - \\left(1 - \\frac{1}{M}\\right)^N\\right) = M \\left(1 - \\left(1 - \\frac{1}{M}\\right)^N\\right)\n$$\n这就是推导出的观察到的不同分子的期望数量的表达式。\n\n### 重复率和文库复杂度的形式化\n\n推导出的表达式 $E[X] = M \\left(1 - \\left(1 - \\frac{1}{M}\\right)^N\\right)$ 形式化了测序深度（$N$）、文库复杂度（$M$）和唯一信息预期产出之间的关系。\n\n1.  **唯一读数与重复读数**：根据定义，“唯一读数”是从一个给定分子产生的第一个读数。来自同一分子的所有后续读数都是“重复读数”。因此，一个实验中唯一读数的总数恰好是观察到的不同分子的数量。推导出的量 $E[X]$ 因此是唯一读数的期望数量。重复读数的期望数量是总读数减去唯一读数的期望数量：$E[\\text{duplicates}] = N - E[X]$。预期的重复率，一个关键的质量指标，是重复读数所占的比例：\n    $$\n    \\text{Expected Duplication Rate} = \\frac{N - E[X]}{N} = 1 - \\frac{E[X]}{N} = 1 - \\frac{M}{N}\\left(1 - \\left(1 - \\frac{1}{M}\\right)^N\\right)\n    $$\n\n2.  **文库复杂度（$M$）的影响**：如果 $M$ 相对于 $N$ 非常大（$M \\gg N$），重新抽样一个分子的概率很低。项 $\\left(1 - \\frac{1}{M}\\right)^N$ 可以使用二项式展开近似为 $1 - \\frac{N}{M}$。那么，$E[X] \\approx M \\left(1 - \\left(1 - \\frac{N}{M}\\right)\\right) = M \\left(\\frac{N}{M}\\right) = N$。这表明对于一个高复杂度的文库，几乎每一次读取都是唯一的，并且发现的不同分子的数量随测序深度线性增加。\n\n3.  **测序深度（$N$）的影响**：对于固定的 $M$，随着 $N$ 的增加，项 $\\left(1 - \\frac{1}{M}\\right)^N$ 趋近于 $0$。因此，$E[X]$ 趋近于 $M$。这描述了文库饱和现象。随着测序深度的增加，发现新分子的概率降低，重复读数的比例也随之增加。最终，几乎所有 $M$ 个分子都将被抽样到，$E[X]$ 在 $M$ 处达到平台期。\n\n### 规划更深层次测序的合理性\n\n这个模型对于实验设计至关重要。在投入资源进行深度测序之前，研究人员可以估算文库复杂度 $M$，或许可以通过一次浅度的预实验测序来完成。利用推导出的公式，可以预测在任何给定的测序深度 $N$ 下，唯一分子的预期产出。绘制 $E[X]$ 对 $N$ 的曲线图可以揭示收益递减点，即 $N$ 的显著增加只带来 $E[X]$ 的微小增加。这种分析有助于做出成本效益决策：测序应该足够深，以捕获文库复杂度的理想部分，但又不能太深，以至于大部分新读数都是冗余的重复，这将是对资源的低效利用。\n\n### 数值计算\n\n给定 $M = 2 \\times 10^{7}$ 和 $N = 5 \\times 10^{7}$。我们需要计算 $E[X] = M \\left(1 - \\left(1 - \\frac{1}{M}\\right)^N\\right)$。\n\n对于大的 $M$，表达式 $\\left(1 - \\frac{1}{M}\\right)^N$ 可以使用指数函数的极限定义 $\\lim_{k \\to \\infty} (1 + \\frac{x}{k})^k = \\exp(x)$ 进行精确近似。\n具体来说，$\\left(1 - \\frac{1}{M}\\right)^N = \\exp\\left(N \\ln\\left(1 - \\frac{1}{M}\\right)\\right)$。\n使用 $\\ln(1-y) = -y - \\frac{y^2}{2} - \\dots$ 的泰勒级数展开，并令 $y = \\frac{1}{M}$，我们得到 $\\ln\\left(1 - \\frac{1}{M}\\right) \\approx -\\frac{1}{M}$。由于 $M$ 非常大，这个近似非常精确。\n因此，我们有：\n$$\n\\left(1 - \\frac{1}{M}\\right)^N \\approx \\exp\\left(N \\left(-\\frac{1}{M}\\right)\\right) = \\exp\\left(-\\frac{N}{M}\\right)\n$$\n不同分子的期望数量的公式变为：\n$$\nE[X] \\approx M \\left(1 - \\exp\\left(-\\frac{N}{M}\\right)\\right)\n$$\n现在，我们代入给定的值：\n$$\n\\frac{N}{M} = \\frac{5 \\times 10^{7}}{2 \\times 10^{7}} = 2.5\n$$\n将此比率代入近似公式：\n$$\nE[X] \\approx (2 \\times 10^{7}) \\left(1 - \\exp(-2.5)\\right)\n$$\n使用计算器计算 $\\exp(-2.5)$ 的值：\n$$\n\\exp(-2.5) \\approx 0.0820849986\n$$\n现在，我们计算括号中的表达式：\n$$\n1 - \\exp(-2.5) \\approx 1 - 0.0820849986 = 0.9179150014\n$$\n最后，我们计算唯一分子的期望数量：\n$$\nE[X] \\approx (2 \\times 10^{7}) \\times 0.9179150014 = 18358300.028\n$$\n问题要求将最终答案四舍五入到四位有效数字。\n这个数字是 $18,358,300.028$。用科学记数法表示，大约是 $1.83583 \\times 10^{7}$。\n四舍五入到四位有效数字得到 $1.836 \\times 10^{7}$。\n因此，唯一读数的期望数量是 $18,360,000$。",
            "answer": "$$\n\\boxed{1.836 \\times 10^{7}}\n$$"
        },
        {
            "introduction": "RNA-seq实验产生的原始读段计数可能具有误导性，因为它们天然地受到基因长度的偏好影响。本练习将直面这个问题，通过比较两种广为人知的标准化指标：RPKM和TPM。通过一次动手计算 ，你将精确地看到这些方法如何校正长度偏好，将原始计数转化为更准确的真实转录本丰度估算值。",
            "id": "3321416",
            "problem": "在一个单端信使RNA测序实验中，考虑两个基因，分别标记为基因 $1$ 和基因 $2$。其真实的潜在读段生成遵循以下原则：来自基因 $i$ 的期望读段计数与其有效转录本长度和其转录本丰度的乘积成正比，并按总测序深度进行缩放。具体而言，假设这两个基因的唯一比对读段计数为 $[1000, 1000]$，它们的有效长度为 $[500, 2000]$ 碱基对。假设文库中的所有读段都比对到这两个基因上，因此总比对读段数为 $N = 2000$。您可以假设一个标准的抽样模型，其中对于每个基因 $i$，期望计数满足 $\\mathbb{E}[C_i] \\propto L_i \\,\\theta_i \\, s$，其中 $L_i$ 是以碱基对为单位的有效长度，$\\theta_i$ 是每碱基的转录本丰度，$s$ 是测序深度。\n\n使用此建模基础及其衍生的“每千碱基每百万比对读段数 (Reads Per Kilobase per Million mapped reads, RPKM)”和“每百万转录本数 (Transcripts Per Million, TPM)”的标准定义，完成以下任务：\n- 从第一性原理出发，推导通常称为 RPKM 和 TPM 的样本内度量表达式，用基因 $i$ 的 $C_i$、$L_i$ 和适当的样本水平归一化因子来表示。\n- 使用计数 $[1000, 1000]$、长度 $[500, 2000]$ 碱基对和总比对读段数 $N = 2000$ 来计算基因 $1$ 和基因 $2$ 的 RPKM 和 TPM 数值。\n- 使用这些计算来解释与原始计数相比，长度归一化如何改变表观的相对表达量。\n\n对于最终报告的量，请提供无单位的比率 $\\mathrm{TPM}_1 / \\mathrm{TPM}_2$ 作为一个单一数字。无需四舍五入，最终答案中不应包含单位。在需要时，一致地表达任何以每千碱基为单位的中间速率，但只有 $\\mathrm{TPM}_1 / \\mathrm{TPM}_2$ 将作为最终答案进行评分。",
            "solution": "该问题陈述被评估为有效。其科学基础在于高通量测序分析的原理，问题设置良好，信息充分且一致，并且表述客观。该问题要求推导和应用转录组学中的标准定量指标，这是一项合理且可形式化的任务。\n\n按要求，分析过程分为三个部分：指标的推导、根据给定数据计算其值，以及解释长度归一化效应。\n\n### 第 1 部分：RPKM 和 TPM 的推导\n\n问题陈述指出，对于一个基因 $i$，其期望读段计数 $\\mathbb{E}[C_i]$ 与其有效转录本长度 $L_i$、其转录本丰度 $\\theta_i$ 和测序深度 $s$ 的乘积成正比。我们可以将其写为：\n$$\n\\mathbb{E}[C_i] = k \\cdot \\theta_i \\cdot L_i \\cdot s\n$$\n其中 $k$ 是一个比例常数。归一化的目标是通过消除基因长度 $L_i$ 和测序深度 $s$ 的混杂效应，来推导出一个能更好地代表真实转录本丰度 $\\theta_i$ 的量。我们使用观测到的计数 $C_i$ 作为 $\\mathbb{E}[C_i]$ 的估计值。\n\n**每千碱基每百万比对读段数 (RPKM)：**\nRPKM 指标通过两个连续的步骤对原始读段计数 $C_i$ 进行归一化：\n1.  **基因长度归一化：** 为了解释在相同表达水平下，较长的基因自然会产生更多读段这一事实，我们将读段计数除以基因的有效长度。长度通常以千碱基 (kb) 为单位表示。以千碱基为单位的有效长度是 $L_i^{\\text{kb}} = L_i / 1000$。这得到一个每千碱基的读段速率：\n    $$\n    \\frac{C_i}{L_i^{\\text{kb}}} = \\frac{C_i}{L_i / 1000}\n    $$\n2.  **测序深度归一化：** 为了能够在不同实验（样本）之间进行比较，我们用文库中总比对读段数 $N$ 进行归一化。总读段数通常以百万为单位表示。以百万为单位的总读段数是 $N^{\\text{M}} = N / 10^6$。\n\n结合这两种归一化方法，基因 $i$ 的 RPKM 定义为每千碱基转录本长度上每百万比对读段的数目。\n$$\n\\mathrm{RPKM}_i = \\frac{C_i / (L_i / 1000)}{N / 10^6} = \\frac{C_i \\cdot 10^3 \\cdot 10^6}{L_i \\cdot N} = \\frac{C_i \\cdot 10^9}{N \\cdot L_i}\n$$\n这个表达式用给定量的形式提供了 RPKM 的形式化定义。\n\n**每百万转录本数 (TPM)：**\n与 RPKM 相比，TPM 指标提供了样本间相对丰度更稳定的估计。其推导过程颠倒了归一化操作的顺序。\n1.  **基因长度归一化：** 与 RPKM 一样，我们首先通过将读段计数 $C_i$ 除以以千碱基为单位的基因长度 $L_i^{\\text{kb}} = L_i / 1000$ 来计算一个速率。我们称这个速率为 $R_i$：\n    $$\n    R_i = \\frac{C_i}{L_i^{\\text{kb}}} = \\frac{C_i}{L_i / 1000}\n    $$\n    该速率与转录本丰度 $\\theta_i$（以及测序深度 $s$）成正比。\n2.  **测序深度归一化（相对于其他基因）：** TPM 将一个基因的丰度表示为它在样本中占总转录本的比例，并缩放到一百万。我们计算样本中所有基因 $j$ 的这类速率的总和：$\\sum_j R_j$。这个总和代表了整个文库的总“每千碱基读段数”速率。基因 $i$ 的分数表示即为 $\\frac{R_i}{\\sum_j R_j}$。\n3.  **缩放：** 然后将此分数缩放到一百万的总量。\n    $$\n    \\mathrm{TPM}_i = \\left( \\frac{R_i}{\\sum_j R_j} \\right) \\cdot 10^6 = \\left( \\frac{C_i / (L_i / 1000)}{\\sum_j (C_j / (L_j / 1000))} \\right) \\cdot 10^6\n    $$\n    主分数式中分子和分母的因子 $1000$ 相互抵消，得到一个更简单的表达式：\n    $$\n    \\mathrm{TPM}_i = \\left( \\frac{C_i / L_i}{\\sum_j (C_j / L_j)} \\right) \\cdot 10^6\n    $$\n    这是 TPM 的形式化定义。TPM 的一个关键特性是，一个样本中所有基因的 TPM 值之和恒为 $10^6$。\n\n### 第 2 部分：数值计算\n\n给定以下数据：\n-   读段计数：$C_1 = 1000$, $C_2 = 1000$。\n-   有效长度：$L_1 = 500$ bp, $L_2 = 2000$ bp。\n-   总比对读段数：$N = C_1 + C_2 = 1000 + 1000 = 2000$。\n\n**RPKM 计算：**\n使用推导出的公式 $\\mathrm{RPKM}_i = \\frac{C_i \\cdot 10^9}{N \\cdot L_i}$：\n对于基因 $1$：\n$$\n\\mathrm{RPKM}_1 = \\frac{1000 \\cdot 10^9}{2000 \\cdot 500} = \\frac{10^3 \\cdot 10^9}{2 \\cdot 10^3 \\cdot 5 \\cdot 10^2} = \\frac{10^{12}}{10 \\cdot 10^5} = \\frac{10^{12}}{10^6} = 1,000,000\n$$\n对于基因 $2$：\n$$\n\\mathrm{RPKM}_2 = \\frac{1000 \\cdot 10^9}{2000 \\cdot 2000} = \\frac{10^3 \\cdot 10^9}{4 \\cdot 10^6} = \\frac{10^{12}}{4 \\cdot 10^6} = 0.25 \\cdot 10^6 = 250,000\n$$\nRPKM 值对于基因 $1$ 是 $1,000,000$，对于基因 $2$ 是 $250,000$。\n\n**TPM 计算：**\n使用推导出的公式 $\\mathrm{TPM}_i = \\left( \\frac{C_i / L_i}{\\sum_j (C_j / L_j)} \\right) \\cdot 10^6$。\n首先，我们计算速率 $C_i / L_i$：\n-   基因 $1$ 的速率：$C_1 / L_1 = 1000 / 500 = 2$。\n-   基因 $2$ 的速率：$C_2 / L_2 = 1000 / 2000 = 0.5$。\n接着，我们计算这些速率的总和：\n-   $\\sum_j (C_j / L_j) = (C_1 / L_1) + (C_2 / L_2) = 2 + 0.5 = 2.5$。\n现在我们计算每个基因的 TPM：\n对于基因 $1$：\n$$\n\\mathrm{TPM}_1 = \\left( \\frac{2}{2.5} \\right) \\cdot 10^6 = 0.8 \\cdot 10^6 = 800,000\n$$\n对于基因 $2$：\n$$\n\\mathrm{TPM}_2 = \\left( \\frac{0.5}{2.5} \\right) \\cdot 10^6 = 0.2 \\cdot 10^6 = 200,000\n$$\nTPM 值对于基因 $1$ 是 $800,000$，对于基因 $2$ 是 $200,000$。\n\n### 第 3 部分：长度归一化效应的解释\n\n两个基因的原始读段计数是相同的：$C_1 = 1000$ 和 $C_2 = 1000$。一个朴素的解释会认为这两个基因的表达水平相同，相对表达比率为 $C_1/C_2 = 1$。\n\n然而，这两个基因的有效长度显著不同：$L_1 = 500$ bp 和 $L_2 = 2000$ bp。基因 $2$ 是基因 $1$ 长度的四倍。基础模型 $\\mathbb{E}[C_i] \\propto \\theta_i \\cdot L_i$ 规定了，对于相同的转录本丰度（$\\theta_1 = \\theta_2$），预计较长的基因会产生更多的读段。具体来说，如果基因 $1$ 和基因 $2$ 的丰度相同，我们预期基因 $2$ 产生的读段数大约是基因 $1$ 的四倍。\n\n两个基因都产生了相同数量的读段（$1000$）这一观察结果与丰度相等的假设相矛盾。为了产生与一个四倍于其长度的基因相同数量的读段，较短的基因（基因 $1$）必须具有显著更高的转录本丰度。\n\n长度归一化，正如在 RPKM 和 TPM 中所实现的，纠正了这种偏差。通过将读段计数除以基因长度，这些指标估计了潜在的转录本丰度。我们的计算显示：\n-   通过 RPKM 计算的相对表达量：$\\mathrm{RPKM}_1 / \\mathrm{RPKM}_2 = 1,000,000 / 250,000 = 4$。\n-   通过 TPM 计算的相对表达量：$\\mathrm{TPM}_1 / \\mathrm{TPM}_2 = 800,000 / 200,000 = 4$。\n\n两种归一化指标都表明，基因 $1$ 的丰度是基因 $2$ 的四倍。这与最初的推理一致：基因 $1$ 的长度是基因 $2$ 的四分之一，但产生了相同数量的读段，这意味着其转录本的浓度高出四倍。因此，对于从读段计数中准确推断相对基因表达而言，长度归一化至关重要，它纠正了原始计数给出的误导性印象。\n\n最终需要报告的量是比率 $\\mathrm{TPM}_1 / \\mathrm{TPM}_2$。\n$$\n\\frac{\\mathrm{TPM}_1}{\\mathrm{TPM}_2} = \\frac{800,000}{200,000} = 4\n$$\n或者，使用符号公式：\n$$\n\\frac{\\mathrm{TPM}_1}{\\mathrm{TPM}_2} = \\frac{\\left( \\frac{C_1 / L_1}{\\sum_j (C_j / L_j)} \\right) \\cdot 10^6}{\\left( \\frac{C_2 / L_2}{\\sum_j (C_j / L_j)} \\right) \\cdot 10^6} = \\frac{C_1 / L_1}{C_2 / L_2} = \\frac{C_1 L_2}{C_2 L_1} = \\frac{1000 \\cdot 2000}{1000 \\cdot 500} = \\frac{2000}{500} = 4\n$$\n该结果是稳健的。",
            "answer": "$$\\boxed{4}$$"
        },
        {
            "introduction": "在校正了样本内的基因长度偏好之后，比较不同样本间的表达水平还需要进行稳健的标准化，以消除文库大小和组成差异的影响。这个高级练习将介绍强大的“比例中值”方法，它构成了像DESeq2这样现代分析工具的统计基础。通过推导和计算这些标准化因子 ，你将掌握如何使基因计数在不同实验条件间真正具有可比性，这是进行差异表达分析前的关键一步。",
            "id": "3321413",
            "problem": "在基于计数的核糖核酸测序（RNA-seq）分析中，观测到的基因计数通过一个反映文库大小和组成的样本特异性乘法缩放因子来建模。考虑 $n$ 个样本（由 $i \\in \\{1,\\dots,n\\}$ 索引）和 $G$ 个基因（由 $g \\in \\{1,\\dots,G\\}$ 索引）。令 $x_{g i}$ 表示样本 $i$ 中基因 $g$ 的观测计数。在组成缩放模型下，假设对于大多数基因，其期望计数满足 $x_{g i} \\approx s_{i} q_{g}$，其中 $s_{i}  0$ 是一个样本特异性大小因子，$q_{g}  0$ 是一个与基因丰度成正比的基因特异性量。为了构建一个对基因特异性乘法效应不变且对少数强烈差异表达基因具有稳健性的 $s_{i}$ 估计量，请从以下基本定义出发：\n- 每个基因在样本间的几何平均数为 $m_{g} = \\left( \\prod_{i=1}^{n} x_{g i} \\right)^{1/n}$。\n- 一个在基因间稳健的位置泛函是样本中位数，记为 $\\operatorname{median}_{g}(\\cdot)$。\n\n从这些原理和乘法模型出发，推导样本特异性大小因子 $s_{i}$ 的估计量，该估计量使用每个基因的几何平均数作为基准，并通过在基因间进行稳健聚合。然后，对于 $n=2$ 个样本和 $G=3$ 个基因，其观测计数为\n$$\nx^{(1)} = [100,\\,1000,\\,300], \\quad x^{(2)} = [120,\\,800,\\,600],\n$$\n使用您推导出的估计量计算这两个样本的大小因子。将最终数值答案四舍五入到四位有效数字，并将其表示为无量纲量。将最终答案表示为包含两个大小因子的行向量。",
            "solution": "用户提供了一个来自计算系统生物学领域的问题，具体涉及 RNA-seq 计数数据的归一化。任务是首先推导样本特异性大小因子的估计量，然后将其应用于一个小数据集。\n\n### 问题验证\n\n首先，我将验证问题陈述。\n\n#### 第1步：提取已知条件\n-   **索引**：样本 $i \\in \\{1,\\dots,n\\}$，基因 $g \\in \\{1,\\dots,G\\}$。\n-   **数据**：$x_{g i}$ 是样本 $i$ 中基因 $g$ 的观测计数。\n-   **模型**：期望计数被建模为 $x_{gi} \\approx s_i q_g$，其中 $s_{i}  0$ 是样本特异性大小因子，$q_{g}  0$ 是基因特异性量。\n-   **定义**：\n    -   每个基因的几何平均数：$m_{g} = \\left( \\prod_{i=1}^{n} x_{g i} \\right)^{1/n}$。\n    -   稳健的位置泛函：样本中位数，$\\operatorname{median}_{g}(\\cdot)$。\n-   **任务**：\n    1.  推导 $s_{i}$ 的估计量。\n    2.  对于 $n=2$ 个样本和 $G=3$ 个基因，其计数为 $x^{(1)} = [100,\\,1000,\\,300]$ 和 $x^{(2)} = [120,\\,800,\\,600]$，计算大小因子 $s_{1}$ 和 $s_{2}$。\n-   **约束**：将最终数值答案四舍五入到四位有效数字。将最终答案表示为一个行向量。\n\n#### 第2步：使用提取的已知条件进行验证\n-   **科学依据**：该问题具有科学依据。模型 $x_{gi} \\approx s_i q_g$ 是生物信息学中用于计数数据的标准简化。待推导的方法，即“比率中位数”归一化法，是一种成熟且广泛使用的技术，已在像 DESeq2 这样的著名软件包中实现。它是差异基因表达分析的基石。\n-   **适定性**：该问题是适定的。它提供了所有必要的定义、一个清晰的模型以及一个用于计算的明确数据集。这些说明导向一个唯一、可确定的结果。几何平均数的使用要求非零计数，所提供的数据满足此条件（对于所有 $g, i$，$x_{gi}  0$）。\n-   **客观性**：该问题以精确、客观和技术性的语言陈述，没有歧义或主观陈述。\n\n#### 第3步：结论与行动\n该问题被认为是有效的，因为它在科学上合理、适定、客观且完整。我现在将进行推导和求解。\n\n### 大小因子估计量的推导\n\n目标是从模型 $x_{g i} \\approx s_{i} q_{g}$ 中估计样本特异性大小因子 $s_{i}$。挑战在于 $s_{i}$ 和基因特异性量 $q_{g}$ 都是未知的。关键是构造一个独立于 $q_{g}$ 的量。\n\n根据问题描述，我们使用每个基因的几何平均数 $m_{g}$ 作为基准。让我们将模型代入 $m_{g}$ 的定义中：\n$$\nm_{g} = \\left( \\prod_{j=1}^{n} x_{g j} \\right)^{1/n} \\approx \\left( \\prod_{j=1}^{n} (s_{j} q_{g}) \\right)^{1/n}\n$$\n对于一个给定的基因，基因特异性项 $q_{g}$ 在所有样本中是共同的。因此，我们可以将其从乘积中提出来：\n$$\nm_{g} \\approx \\left( q_{g}^{n} \\prod_{j=1}^{n} s_{j} \\right)^{1/n} = q_{g} \\left( \\prod_{j=1}^{n} s_{j} \\right)^{1/n}\n$$\n这个表达式表明，几何平均数 $m_g$ 近似正比于 $q_g$。比例常数是所有样本大小因子的几何平均数。\n\n为了消除 $q_{g}$，我们可以考虑观测计数 $x_{gi}$ 与同一基因的几何平均数 $m_g$ 的比率：\n$$\n\\frac{x_{g i}}{m_{g}} \\approx \\frac{s_{i} q_{g}}{q_{g} \\left( \\prod_{j=1}^{n} s_{j} \\right)^{1/n}} = \\frac{s_{i}}{\\left( \\prod_{j=1}^{n} s_{j} \\right)^{1/n}}\n$$\n这个比率独立于基因特异性项 $q_{g}$。对于一个给定的样本 $i$，每个基因 $g$ 都提供了一个关于 $s_{i}$ 值相对于所有大小因子几何平均数的估计。\n\n问题陈述指出，该估计量应对少数强烈差异表达的基因具有稳健性。这类基因会违背“$q_g$ 在不同样本所代表的各种条件下是恒定的”这一假设，但此处构建的模型假设 $q_g$ 是基因的属性，独立于样本条件。一个更通用的模型可能是 $x_{gi} \\approx s_i q_{gi}$，其中对于非差异表达基因，$q_{gi}$ 在一组样本中是恒定的。中位数是一个稳健的统计量，意味着它不受离群值的强烈影响。因此，为了得到大小因子 $s_{i}$ 的一个单一稳健估计，我们取这些比率在所有基因 $g \\in \\{1, \\dots, G\\}$ 上的中位数。\n\n因此，大小因子 $s_i$ 的估计量（记为 $\\hat{s}_i$）是：\n$$\n\\hat{s}_{i} = \\operatorname{median}_{g} \\left( \\frac{x_{gi}}{m_g} \\right) = \\operatorname{median}_{g \\in \\{1,\\dots,G\\}} \\left\\{ \\frac{x_{gi}}{\\left( \\prod_{j=1}^{n} x_{gj} \\right)^{1/n}} \\right\\}\n$$\n这个推导出的估计量就是比率中位数归一化因子。这些估计量的一个性质是它们的几何平均数约等于 $1$，因为中位数的几何平均数将近似于几何平均数的中位数，而后者为 1。\n\n### 针对给定数据的计算\n\n我们有 $n=2$ 个样本和 $G=3$ 个基因。计数数据如下：\n-   样本1：$x^{(1)} = [x_{11}, x_{21}, x_{31}] = [100, 1000, 300]$\n-   样本2：$x^{(2)} = [x_{12}, x_{22}, x_{32}] = [120, 800, 600]$\n\n**第1步：计算每个基因的几何平均数 $m_g$。**\n对于 $n=2$，几何平均数简化为每个基因两个计数值乘积的平方根。\n-   基因1：$m_{1} = \\sqrt{x_{11} \\cdot x_{12}} = \\sqrt{100 \\cdot 120} = \\sqrt{12000}$\n-   基因2：$m_{2} = \\sqrt{x_{21} \\cdot x_{22}} = \\sqrt{1000 \\cdot 800} = \\sqrt{800000}$\n-   基因3：$m_{3} = \\sqrt{x_{31} \\cdot x_{32}} = \\sqrt{300 \\cdot 600} = \\sqrt{180000}$\n\n**第2步：为每个样本计算比率 $x_{gi} / m_g$。**\n\n**对于样本1（$i=1$）：**\n-   基因1的比率：$\\frac{x_{11}}{m_{1}} = \\frac{100}{\\sqrt{12000}} \\approx 0.91287$\n-   基因2的比率：$\\frac{x_{21}}{m_{2}} = \\frac{1000}{\\sqrt{800000}} \\approx 1.11803$\n-   基因3的比率：$\\frac{x_{31}}{m_{3}} = \\frac{300}{\\sqrt{180000}} \\approx 0.70711$\n\n**对于样本2（$i=2$）：**\n-   基因1的比率：$\\frac{x_{12}}{m_{1}} = \\frac{120}{\\sqrt{12000}} \\approx 1.09545$\n-   基因2的比率：$\\frac{x_{22}}{m_{2}} = \\frac{800}{\\sqrt{800000}} \\approx 0.89443$\n-   基因3的比率：$\\frac{x_{32}}{m_{3}} = \\frac{600}{\\sqrt{180000}} \\approx 1.41421$\n\n**第3步：计算每个样本的比率中位数，以求得 $\\hat{s}_1$ 和 $\\hat{s}_2$。**\n\n**对于样本1（$\\hat{s}_1$）：**\n我们求比率集合 $\\{0.91287, 1.11803, 0.70711\\}$ 的中位数。\n首先，我们对这些值进行排序：$\\{0.70711, 0.91287, 1.11803\\}$。\n中位数是中间的那个值。\n$$\n\\hat{s}_{1} = 0.91287\n$$\n\n**对于样本2（$\\hat{s}_2$）：**\n我们求比率集合 $\\{1.09545, 0.89443, 1.41421\\}$ 的中位数。\n首先，我们对这些值进行排序：$\\{0.89443, 1.09545, 1.41421\\}$。\n中位数是中间的那个值。\n$$\n\\hat{s}_{2} = 1.09545\n$$\n\n**第4步：将结果四舍五入到四位有效数字。**\n-   $\\hat{s}_{1} = 0.91287 \\approx 0.9129$\n-   $\\hat{s}_{2} = 1.09545 \\approx 1.095$\n\n两个样本的大小因子分别约为 $0.9129$ 和 $1.095$。这些是按要求计算的无量纲量。最终答案以行向量形式表示。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n0.9129  1.095\n\\end{pmatrix}\n}\n$$"
        }
    ]
}