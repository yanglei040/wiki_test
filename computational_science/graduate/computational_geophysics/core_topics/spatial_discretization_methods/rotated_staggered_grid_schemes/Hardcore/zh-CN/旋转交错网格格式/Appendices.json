{
    "hands_on_practices": [
        {
            "introduction": "本节的第一个实践是基础性的理论分析。通过为旋转交错网格格式推导离散色散关系 ，我们可以从解析上理解其数值特性，例如数值波速如何依赖于频率和传播方向。这是评估任何数值格式准确性和稳定性的第一步，而本练习的一个关键发现将揭示该格式在减少数值各向异性方面的内在优势。",
            "id": "3613907",
            "problem": "考虑一个二维均匀、各向同性的声介质，其密度 $\\rho$ 和声速 $c$ 均为常数。声场由声波方程的速度-压力一阶方程组控制，\n$$\n\\partial_{t} p = -\\kappa \\nabla \\cdot \\mathbf{v}, \\qquad \\partial_{t} \\mathbf{v} = -\\frac{1}{\\rho} \\nabla p,\n$$\n其中 $p$ 是压力，$\\mathbf{v}$ 是质点速度，$\\kappa = \\rho c^{2}$ 是体积模量。该区域在 $x$ 和 $y$ 方向上间距均为 $h$ 的均匀笛卡尔网格上进行离散化，但有限差分算子是以旋转交错网格的方式构造的：定义通过将笛卡尔坐标轴旋转角度 $\\alpha$ 得到的标准正交轴 $\\mathbf{e}_{u}$ 和 $\\mathbf{e}_{v}$，其中\n$$\n\\mathbf{e}_{u} = (\\cos \\alpha, \\sin \\alpha), \\qquad \\mathbf{e}_{v} = (-\\sin \\alpha, \\cos \\alpha).\n$$\n令 $v_{u} = \\mathbf{v} \\cdot \\mathbf{e}_{u}$ 且 $v_{v} = \\mathbf{v} \\cdot \\mathbf{e}_{v}$。使用标准的二阶时间交错和空间交错时域有限差分 (FDTD) 格式：$p$ 位于网格中心，时间为整数时间步 $t^{n} = n \\Delta t$；$v_{u}, v_{v}$ 位于适当交错的空间位置，时间为半整数时间步 $t^{n+\\frac{1}{2}} = (n+\\frac{1}{2}) \\Delta t$。空间导数由与交错布局一致的中心差分近似。将沿 $x$ 和 $y$ 方向的离散方向导数算子表示为 $D_{x}$ 和 $D_{y}$，并定义旋转方向导数\n$$\nD_{u} = \\cos \\alpha \\, D_{x} + \\sin \\alpha \\, D_{y}, \\qquad D_{v} = -\\sin \\alpha \\, D_{x} + \\cos \\alpha \\, D_{y}.\n$$\n离散更新方程为\n$$\nv_{u}^{\\,n+\\frac{1}{2}} = v_{u}^{\\,n-\\frac{1}{2}} - \\frac{\\Delta t}{\\rho} \\, D_{u} p^{\\,n}, \\qquad\nv_{v}^{\\,n+\\frac{1}{2}} = v_{v}^{\\,n-\\frac{1}{2}} - \\frac{\\Delta t}{\\rho} \\, D_{v} p^{\\,n},\n$$\n$$\np^{\\,n+1} = p^{\\,n} - \\kappa \\Delta t \\left( D_{u} v_{u}^{\\,n+\\frac{1}{2}} + D_{v} v_{v}^{\\,n+\\frac{1}{2}} \\right).\n$$\n对于交错网格上的平面波分析，作用于交错位置之间的中心差分具有经过充分检验的离散傅里叶符号：对于波数分量为 $k_{x}$ 和 $k_{y}$ 的平面波，\n$$\nD_{x} \\;\\longleftrightarrow\\; i \\,\\hat{k}_{x}, \\quad \\hat{k}_{x} = \\frac{2}{h} \\sin\\!\\left(\\frac{k_{x} h}{2}\\right), \\qquad\nD_{y} \\;\\longleftrightarrow\\; i \\,\\hat{k}_{y}, \\quad \\hat{k}_{y} = \\frac{2}{h} \\sin\\!\\left(\\frac{k_{y} h}{2}\\right).\n$$\n假设一个形式为 $p(\\mathbf{x},t) = P \\exp\\!\\left( i (k_{x} x + k_{y} y - \\omega t) \\right)$ 的单色平面波，其传播角 $\\theta$ 由 $k_{x} = k \\cos \\theta$ 和 $k_{y} = k \\sin \\theta$ 定义。从上述控制方程和指定的离散格式出发，推导精确的离散色散关系，并求解以获得数值角频率 $\\omega$ 作为 $k$、$ \\theta$、$c$、$h$ 和 $\\Delta t$ 的解析函数（保持 $\\alpha$ 为符号，不要假设特定的旋转角度）。将 $\\omega$ 的最终答案以弧度/秒为单位表示。角度 $\\theta$ 必须以弧度处理。请以闭合形式提供最终表达式。不需要进行数值计算，也不需要四舍五入。",
            "solution": "用户要求我推导使用旋转交错网格时域有限差分 (FDTD) 格式求解声波方程的离散色散关系。\n\n### 步骤 1：提取已知条件\n- **控制方程**:\n  $$ \\partial_{t} p = -\\kappa \\nabla \\cdot \\mathbf{v}, \\qquad \\partial_{t} \\mathbf{v} = -\\frac{1}{\\rho} \\nabla p $$\n- **常数和定义**:\n  - 压力: $p$\n  - 质点速度: $\\mathbf{v} = (v_x, v_y)$\n  - 密度 (常数): $\\rho$\n  - 声速 (常数): $c$\n  - 体积模量: $\\kappa = \\rho c^2$\n- **网格和离散化**:\n  - 在 $x$ 和 $y$ 方向上间距均为 $h$ 的均匀笛卡尔网格。\n  - 时间步长: $\\Delta t$。\n  - 旋转的标准正交轴: $\\mathbf{e}_{u} = (\\cos \\alpha, \\sin \\alpha)$, $\\mathbf{e}_{v} = (-\\sin \\alpha, \\cos \\alpha)$\n  - 旋转速度分量: $v_{u} = \\mathbf{v} \\cdot \\mathbf{e}_{u}$, $v_{v} = \\mathbf{v} \\cdot \\mathbf{e}_{v}$\n  - 交错格式: $p$ 位于网格中心 $(x_j, y_l)$，时间为整数时间步 $t^n = n \\Delta t$。$v_u, v_v$ 位于交错的空间位置，时间为半整数时间步 $t^{n+1/2} = (n+1/2)\\Delta t$。\n- **离散算子**:\n  - 旋转方向导数算子:\n    $$ D_{u} = \\cos \\alpha \\, D_{x} + \\sin \\alpha \\, D_{y} $$\n    $$ D_{v} = -\\sin \\alpha \\, D_{x} + \\cos \\alpha \\, D_{y} $$\n- **离散更新方程**:\n  $$ v_{u}^{\\,n+\\frac{1}{2}} = v_{u}^{\\,n-\\frac{1}{2}} - \\frac{\\Delta t}{\\rho} \\, D_{u} p^{\\,n} $$\n  $$ v_{v}^{\\,n+\\frac{1}{2}} = v_{v}^{\\,n-\\frac{1}{2}} - \\frac{\\Delta t}{\\rho} \\, D_{v} p^{\\,n} $$\n  $$ p^{\\,n+1} = p^{\\,n} - \\kappa \\Delta t \\left( D_{u} v_{u}^{\\,n+\\frac{1}{2}} + D_{v} v_{v}^{\\,n+\\frac{1}{2}} \\right) $$\n- **导数的傅里叶符号**:\n  - 对于交错位置之间的中心差分:\n    $$ D_{x} \\;\\longleftrightarrow\\; i \\,\\hat{k}_{x}, \\quad \\hat{k}_{x} = \\frac{2}{h} \\sin\\left(\\frac{k_{x} h}{2}\\right) $$\n    $$ D_{y} \\;\\longleftrightarrow\\; i \\,\\hat{k}_{y}, \\quad \\hat{k}_{y} = \\frac{2}{h} \\sin\\left(\\frac{k_{y} h}{2}\\right) $$\n- **平面波拟设**:\n  - 形式: $p(\\mathbf{x}, t) = P \\exp(i (k_x x + k_y y - \\omega t))$\n  - 波数矢量分量: $k_x = k \\cos\\theta$, $k_y = k \\sin\\theta$\n\n### 步骤 2：使用提取的已知条件进行验证\n- **科学基础（关键）**: 该问题基于一阶声波方程，这是物理学和地球物理学中的一个基本模型。所描述的数值方法，即旋转交错网格 FDTD 格式，是计算地震学中一种成熟的技术。分析方法（平面波分析或 von Neumann 分析）是推导数值色散关系的标准程序。所有方面都具有科学合理性。\n- **适定的**: 问题结构清晰。它提供了推导所需的数值频率 $\\omega$ 表达式所必需的所有方程、定义和离散算子。预期会有一个唯一的解析解。\n- **客观的（关键）**: 问题以精确、形式化的数学和物理语言陈述，没有任何主观性或模糊性。\n- **其他缺陷**: 问题是自洽的、一致的、且可形式化的。它并非无足轻重，也没有表现出任何其他无效标准。\n\n### 步骤 3：结论和行动\n该问题是有效的。将提供一个完整的解。\n\n### 解题推导\n目标是找到数值色散关系，它将给定数值格式的角频率 $\\omega$ 与波数分量 $k_x$ 和 $k_y$ 联系起来。我们通过将平面波解代入离散 FDTD 方程来实现这一目标。\n\n设压力 $p$ 和旋转速度分量 $v_u$、$v_v$ 的离散平面波解具有以下形式：\n$$ p^n \\propto P \\, \\exp(-i \\omega n \\Delta t) $$\n$$ v_u^{n \\pm 1/2} \\propto V_u \\, \\exp(-i \\omega (n \\pm 1/2) \\Delta t) $$\n$$ v_v^{n \\pm 1/2} \\propto V_v \\, \\exp(-i \\omega (n \\pm 1/2) \\Delta t) $$\n此处，$P$、$V_u$ 和 $V_v$ 是复振幅，其中隐式包含了空间相位因子 $\\exp(i(k_x x + k_y y))$。作用于这些平面波的空间导数算子 $D_x$ 和 $D_y$ 分别变换为其傅里叶符号 $i\\hat{k}_x$ 和 $i\\hat{k}_y$ 的乘法。\n\n首先，我们确定旋转导数算子 $D_u$ 和 $D_v$ 的傅里叶符号：\n$$ D_u \\longleftrightarrow i \\hat{k}_u = \\cos \\alpha (i \\hat{k}_x) + \\sin \\alpha (i \\hat{k}_y) = i (\\hat{k}_x \\cos \\alpha + \\hat{k}_y \\sin \\alpha) $$\n$$ D_v \\longleftrightarrow i \\hat{k}_v = -\\sin \\alpha (i \\hat{k}_x) + \\cos \\alpha (i \\hat{k}_y) = i (-\\hat{k}_x \\sin \\alpha + \\hat{k}_y \\cos \\alpha) $$\n\n现在，将平面波形式代入离散更新方程。为清晰起见，我们使用时间中心差分重写更新方程：\n$$ \\frac{v_u^{n+1/2} - v_u^{n-1/2}}{\\Delta t} = -\\frac{1}{\\rho} D_u p^n $$\n$$ \\frac{v_v^{n+1/2} - v_v^{n-1/2}}{\\Delta t} = -\\frac{1}{\\rho} D_v p^n $$\n$$ \\frac{p^{n+1} - p^n}{\\Delta t} = -\\kappa (D_u v_u^{n+1/2} + D_v v_v^{n+1/2}) $$\n\n将平面波拟设和算子符号代入第一个方程（关于 $v_u$）：\n$$ \\frac{V_u e^{-i\\omega(n+1/2)\\Delta t} - V_u e^{-i\\omega(n-1/2)\\Delta t}}{\\Delta t} = -\\frac{1}{\\rho} (i \\hat{k}_u) P e^{-i\\omega n \\Delta t} $$\n提出公因子：\n$$ \\frac{V_u e^{-i\\omega n \\Delta t} (e^{-i\\omega \\Delta t/2} - e^{i\\omega \\Delta t/2})}{\\Delta t} = - \\frac{i}{\\rho} \\hat{k}_u P e^{-i\\omega n \\Delta t} $$\n使用恒等式 $\\sin(z) = \\frac{e^{iz} - e^{-iz}}{2i}$：\n$$ \\frac{V_u (-2i \\sin(\\frac{\\omega \\Delta t}{2}))}{\\Delta t} = -\\frac{i}{\\rho} \\hat{k}_u P $$\n求解振幅 $V_u$：\n$$ V_u = \\frac{\\Delta t \\hat{k}_u}{2 \\rho \\sin(\\frac{\\omega \\Delta t}{2})} P $$\n通过相同的推导，关于 $v_v$ 的方程得出：\n$$ V_v = \\frac{\\Delta t \\hat{k}_v}{2 \\rho \\sin(\\frac{\\omega \\Delta t}{2})} P $$\n\n接下来，将拟设代入压力更新方程：\n$$ \\frac{P e^{-i\\omega(n+1)\\Delta t} - P e^{-i\\omega n \\Delta t}}{\\Delta t} = -\\kappa \\left( (i \\hat{k}_u) V_u e^{-i\\omega(n+1/2)\\Delta t} + (i \\hat{k}_v) V_v e^{-i\\omega(n+1/2)\\Delta t} \\right) $$\n提出公因子：\n$$ \\frac{P e^{-i\\omega(n+1/2)\\Delta t} (e^{-i\\omega \\Delta t/2} - e^{i\\omega \\Delta t/2})}{\\Delta t} = -i \\kappa (\\hat{k}_u V_u + \\hat{k}_v V_v) e^{-i\\omega(n+1/2)\\Delta t} $$\n$$ \\frac{P (-2i \\sin(\\frac{\\omega \\Delta t}{2}))}{\\Delta t} = -i \\kappa (\\hat{k}_u V_u + \\hat{k}_v V_v) $$\n$$ 2P \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) = \\kappa \\Delta t (\\hat{k}_u V_u + \\hat{k}_v V_v) $$\n\n现在，将 $V_u$ 和 $V_v$ 的表达式代入此方程：\n$$ 2P \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) = \\kappa \\Delta t \\left( \\hat{k}_u \\left( \\frac{\\Delta t \\hat{k}_u}{2 \\rho \\sin(\\frac{\\omega \\Delta t}{2})} P \\right) + \\hat{k}_v \\left( \\frac{\\Delta t \\hat{k}_v}{2 \\rho \\sin(\\frac{\\omega \\Delta t}{2})} P \\right) \\right) $$\n假设为非平凡波（$P \\neq 0$），我们可以消去等式两边的 $P$：\n$$ 2 \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) = \\frac{\\kappa (\\Delta t)^2}{2 \\rho \\sin(\\frac{\\omega \\Delta t}{2})} (\\hat{k}_u^2 + \\hat{k}_v^2) $$\n整理后得到色散关系：\n$$ 4 \\sin^2\\left(\\frac{\\omega \\Delta t}{2}\\right) = \\frac{\\kappa (\\Delta t)^2}{\\rho} (\\hat{k}_u^2 + \\hat{k}_v^2) $$\n使用定义 $\\kappa = \\rho c^2$，可简化为：\n$$ 4 \\sin^2\\left(\\frac{\\omega \\Delta t}{2}\\right) = c^2 (\\Delta t)^2 (\\hat{k}_u^2 + \\hat{k}_v^2) $$\n\n一个重要的步骤是计算 $\\hat{k}_u^2 + \\hat{k}_v^2$ 项：\n$$ \\hat{k}_u^2 = (\\hat{k}_x \\cos \\alpha + \\hat{k}_y \\sin \\alpha)^2 = \\hat{k}_x^2 \\cos^2 \\alpha + \\hat{k}_y^2 \\sin^2 \\alpha + 2 \\hat{k}_x \\hat{k}_y \\cos \\alpha \\sin \\alpha $$\n$$ \\hat{k}_v^2 = (-\\hat{k}_x \\sin \\alpha + \\hat{k}_y \\cos \\alpha)^2 = \\hat{k}_x^2 \\sin^2 \\alpha + \\hat{k}_y^2 \\cos^2 \\alpha - 2 \\hat{k}_x \\hat{k}_y \\sin \\alpha \\cos \\alpha $$\n将这两个表达式相加，我们看到交叉项抵消了：\n$$ \\hat{k}_u^2 + \\hat{k}_v^2 = \\hat{k}_x^2 (\\cos^2 \\alpha + \\sin^2 \\alpha) + \\hat{k}_y^2 (\\sin^2 \\alpha + \\cos^2 \\alpha) = \\hat{k}_x^2 + \\hat{k}_y^2 $$\n这个结果表明，该数值格式的有效波数平方在速度分量的旋转下是不变的，这是这种特定旋转交错网格的一个关键特性。因此，旋转角 $\\alpha$ 从色散关系中消去。\n\n将其代回色散关系：\n$$ 4 \\sin^2\\left(\\frac{\\omega \\Delta t}{2}\\right) = c^2 (\\Delta t)^2 (\\hat{k}_x^2 + \\hat{k}_y^2) $$\n现在，代入 $\\hat{k}_x$ 和 $\\hat{k}_y$ 的定义：\n$$ \\hat{k}_x^2 + \\hat{k}_y^2 = \\left(\\frac{2}{h} \\sin\\left(\\frac{k_x h}{2}\\right)\\right)^2 + \\left(\\frac{2}{h} \\sin\\left(\\frac{k_y h}{2}\\right)\\right)^2 = \\frac{4}{h^2} \\left[ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) \\right] $$\n色散关系变为：\n$$ 4 \\sin^2\\left(\\frac{\\omega \\Delta t}{2}\\right) = c^2 (\\Delta t)^2 \\left( \\frac{4}{h^2} \\left[ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) \\right] \\right) $$\n$$ \\sin^2\\left(\\frac{\\omega \\Delta t}{2}\\right) = \\frac{c^2 (\\Delta t)^2}{h^2} \\left[ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) \\right] $$\n对两边取平方根（并选择对应于前向传播波的正根，$\\omega > 0$）：\n$$ \\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) = \\frac{c \\Delta t}{h} \\sqrt{ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) } $$\n通过应用反正弦函数求解 $\\omega$：\n$$ \\frac{\\omega \\Delta t}{2} = \\arcsin\\left( \\frac{c \\Delta t}{h} \\sqrt{ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) } \\right) $$\n$$ \\omega = \\frac{2}{\\Delta t} \\arcsin\\left( \\frac{c \\Delta t}{h} \\sqrt{ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) } \\right) $$\n\n最后，我们使用 $k_x = k \\cos\\theta$ 和 $k_y = k \\sin\\theta$，将结果表示为总波数 $k$ 和传播角 $\\theta$ 的函数：\n$$ \\omega = \\frac{2}{\\Delta t} \\arcsin\\left( \\frac{c \\Delta t}{h} \\sqrt{ \\sin^2\\left(\\frac{k h \\cos\\theta}{2}\\right) + \\sin^2\\left(\\frac{k h \\sin\\theta}{2}\\right) } \\right) $$\n这就是数值角频率的最终解析表达式。",
            "answer": "$$\\boxed{\\frac{2}{\\Delta t} \\arcsin\\left( \\frac{c \\Delta t}{h} \\sqrt{ \\sin^2\\left(\\frac{k h \\cos\\theta}{2}\\right) + \\sin^2\\left(\\frac{k h \\sin\\theta}{2}\\right) } \\right)}$$"
        },
        {
            "introduction": "在色散关系的理论基础之上，本实践将进入定量分析阶段 。我们将通过编程实现数值群速度和相速度的计算公式，从而直接衡量和可视化理论上存在的数值频散和各向异性。这有助于培养对网格伪影如何影响波传播以及旋转网格如何缓解这些问题的直观理解。",
            "id": "3613860",
            "problem": "给定一个二维、常密度声学介质，其波速 $c$ 为常数（单位为 $\\mathrm{m/s}$）。考虑声波的一阶速度-压力系统，\n$$\n\\frac{\\partial p}{\\partial t} = -K \\left( \\frac{\\partial v_x}{\\partial x} + \\frac{\\partial v_y}{\\partial y} \\right), \\quad\n\\frac{\\partial v_x}{\\partial t} = -\\frac{1}{\\rho} \\frac{\\partial p}{\\partial x}, \\quad\n\\frac{\\partial v_y}{\\partial t} = -\\frac{1}{\\rho} \\frac{\\partial p}{\\partial y},\n$$\n其中 $p$ 是压力，$v_x$ 和 $v_y$ 是速度分量，$K$ 是体积模量，$\\rho$ 是密度，且 $c^2 = K/\\rho$。该系统在一个均匀的、旋转的交错网格上进行离散化，空间上使用二阶精度的中心差分，时间上使用蛙跳格式。网格相对于物理坐标轴旋转了一个角度 $\\varphi$（单位为度）。等距网格间距为 $\\Delta h$（单位为 $\\mathrm{m}$），时间步长为 $\\Delta t$（单位为 $\\mathrm{s}$）。定义库朗数 $\\nu = c \\Delta t / \\Delta h$。\n\n在具有波矢 $\\mathbf{k}$ 和角频率 $\\omega$ 的平面波拟设下，对旋转交错网格格式进行离散傅里叶（von Neumann）分析，得到如下形式的离散色散关系\n$$\n\\sin\\left( \\frac{\\omega \\Delta t}{2} \\right) = \\nu \\sqrt{ \\sin^2(\\alpha) + \\sin^2(\\beta) },\n$$\n其中\n$$\n\\alpha = \\frac{1}{2} f \\pi \\cos(\\theta - \\varphi), \\quad \\beta = \\frac{1}{2} f \\pi \\sin(\\theta - \\varphi),\n$$\n$f \\in (0,1]$ 是相对于奈奎斯特波数的无量纲波数大小分数（即 $|\\mathbf{k}| = f \\pi / \\Delta h$），$\\theta$（单位为度）是在物理坐标系中 $\\mathbf{k}$ 传播方向的方位角。在任何计算中，角度 $\\theta$ 和 $\\varphi$ 都必须以弧度进行解释。\n\n群速度的大小为 $|\\nabla_{\\mathbf{k}} \\omega|$，相速度为 $c_{\\mathrm{phase}} = \\omega/|\\mathbf{k}|$。由于数值各向异性，两者都依赖于方向。使用上述色散关系，以下无量纲量化了数值各向异性：\n- 归一化群速度大小\n$$\n\\frac{|\\nabla_{\\mathbf{k}} \\omega|}{c} = \\frac{1}{2} \\frac{\\sqrt{ \\sin^2(2\\alpha) + \\sin^2(2\\beta) }}{ \\sqrt{ \\sin^2(\\alpha) + \\sin^2(\\beta) } } \\cdot \\frac{1}{ \\sqrt{ 1 - \\nu^2 \\left( \\sin^2(\\alpha) + \\sin^2(\\beta) \\right) } }.\n$$\n- 归一化相速度\n$$\n\\frac{c_{\\mathrm{phase}}}{c} = \\frac{2}{f \\pi \\nu} \\arcsin\\left( \\nu \\sqrt{ \\sin^2(\\alpha) + \\sin^2(\\beta) } \\right),\n$$\n以及方向相误差\n$$\n\\varepsilon(\\theta) = \\frac{c_{\\mathrm{phase}}}{c} - 1.\n$$\n\n您的任务是：\n- 实现一个程序，对于指定的参数，计算：\n  1) 在给定方向 $\\theta$ 上的归一化群速度大小 $|\\nabla_{\\mathbf{k}} \\omega|/c$，\n  2) 在相同 $\\theta$ 上的方向相误差 $\\varepsilon(\\theta)$，以及\n  3) 对于给定的网格旋转角度 $\\varphi$、波数分数 $f$ 和库朗数 $\\nu$，在所有方向 $\\theta \\in [0^\\circ, 360^\\circ)$ 上的最大绝对相误差。\n- 所有角度作为输入参数时必须以度为单位处理，但在内部计算时需转换为弧度。\n- 物理单位：$c$ 的单位是 $\\mathrm{m/s}$，$\\Delta h$ 的单位是 $\\mathrm{m}$，$\\Delta t$ 的单位是 $\\mathrm{s}$。为保证数值稳定性和物理真实性，假设 $\\nu \\in (0,1/\\sqrt{2}]$。\n- 每个测试用例的输出必须是三个浮点数：$|\\nabla_{\\mathbf{k}} \\omega|/c$、$\\varepsilon(\\theta)$ 和 $\\max_{\\theta'} |\\varepsilon(\\theta')|$，每个数都四舍五入到六位小数。这些都是无量纲数。\n\n对所有测试用例使用以下固定的物理参数：\n- $c = 2000 \\ \\mathrm{m/s}$,\n- $\\Delta h = 10 \\ \\mathrm{m}$.\n\n通过 $\\Delta t = \\nu \\Delta h / c$ 在内部计算 $\\Delta t$。\n\n测试套件：\n为以下四组参数 $(\\varphi \\ \\mathrm{[deg]}, f, \\theta \\ \\mathrm{[deg]}, \\nu)$ 提供结果：\n- 测试 $1$: $(0.0, 0.3, 30.0, 0.6)$。\n- 测试 $2$: $(45.0, 0.6, 45.0, 0.6)$。\n- 测试 $3$: $(0.0, 0.8, 0.0, 0.6)$。\n- 测试 $4$: $(22.5, 0.05, 67.5, 0.6)$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含一个列表，该列表有四个子列表（每个测试用例一个）。每个子列表必须按顺序包含三个浮点数 $[|\\nabla_{\\mathbf{k}} \\omega|/c, \\varepsilon(\\theta), \\max_{\\theta'} |\\varepsilon(\\theta')|]$，每个数都四舍五入到六位小数。例如：\n\"[[a1,b1,c1],[a2,b2,c2],[a3,b3,c3],[a4,b4,c4]]\" 不含多余的空格或文本。\n\n角度单位要求：所有角度必须按规定以度为单位解释和处理，并在内部计算时转换为弧度。",
            "solution": "该问题要求对二维声波方程的二阶旋转交错网格有限差分格式所引入的数值各向异性进行定量分析。该分析在傅里叶域中进行，从给定的离散色散关系出发。主要任务是计算归一化群速度、特定传播方向的方向相误差以及在所有可能方向上的最大绝对相误差。\n\n连续物理系统由一阶速度-压力声波方程描述：\n$$\n\\frac{\\partial p}{\\partial t} = -K \\left( \\frac{\\partial v_x}{\\partial x} + \\frac{\\partial v_y}{\\partial y} \\right)\n$$\n$$\n\\frac{\\partial v_x}{\\partial t} = -\\frac{1}{\\rho} \\frac{\\partial p}{\\partial x}, \\quad \\frac{\\partial v_y}{\\partial t} = -\\frac{1}{\\rho} \\frac{\\partial p}{\\partial y}\n$$\n在这个连续介质中，波以恒定的相速度和群速度进行各向同性传播，其速度等于介质的波速 $c = \\sqrt{K/\\rho}$。在网格上进行离散化会引入数值色散，即波速变得依赖于波的频率和相对于网格轴的传播方向。这种方向依赖性被称为数值各向异性。\n\n由数值格式的 von Neumann 稳定性分析导出的离散色散关系如下：\n$$\n\\sin\\left( \\frac{\\omega \\Delta t}{2} \\right) = \\nu \\sqrt{ \\sin^2(\\alpha) + \\sin^2(\\beta) }\n$$\n其中 $\\omega$ 是具有波矢 $\\mathbf{k}$ 的平面波的数值角频率。库朗数为 $\\nu = c \\Delta t / \\Delta h$。项 $\\alpha$ 和 $\\beta$ 是与方向相关的归一化波数分量：\n$$\n\\alpha = \\frac{1}{2} |\\mathbf{k}| \\Delta h \\cos(\\theta - \\varphi) = \\frac{1}{2} f \\pi \\cos(\\theta - \\varphi)\n$$\n$$\n\\beta = \\frac{1}{2} |\\mathbf{k}| \\Delta h \\sin(\\theta - \\varphi) = \\frac{1}{2} f \\pi \\sin(\\theta - \\varphi)\n$$\n在这里，$f$ 是无量纲波数大小，$\\theta$ 是物理传播方向，$\\varphi$ 是网格旋转角度。\n\n数值相速度 $c_{\\mathrm{phase}} = \\omega / |\\mathbf{k}|$ 衡量等相波前的速度。其归一化形式由色散关系导出。重新排列色散关系以求解 $\\omega$：\n$$\n\\omega = \\frac{2}{\\Delta t} \\arcsin\\left( \\nu \\sqrt{ \\sin^2(\\alpha) + \\sin^2(\\beta) } \\right)\n$$\n那么归一化的相速度为：\n$$\n\\frac{c_{\\mathrm{phase}}}{c} = \\frac{\\omega/|\\mathbf{k}|}{c} = \\frac{\\omega}{c |\\mathbf{k}|} = \\frac{\\omega}{c (f \\pi / \\Delta h)} = \\frac{\\omega \\Delta t}{c \\Delta t (f \\pi / \\Delta h)} = \\frac{\\omega \\Delta t}{\\nu f \\pi}\n$$\n代入 $\\omega$ 的表达式，得到问题描述中提供的公式：\n$$\n\\frac{c_{\\mathrm{phase}}}{c} = \\frac{2}{f \\pi \\nu} \\arcsin\\left( \\nu \\sqrt{ \\sin^2(\\alpha) + \\sin^2(\\beta) } \\right)\n$$\n方向相误差 $\\varepsilon(\\theta) = c_{\\mathrm{phase}}/c - 1$ 量化了与理想各向同性行为的偏差，在理想情况下，该值对所有 $\\theta$ 都为零。\n\n数值群速度 $\\mathbf{v}_g = \\nabla_{\\mathbf{k}} \\omega$ 描述了波包能量的传播速度。其大小为 $|\\nabla_{\\mathbf{k}} \\omega|$。其归一化大小的公式，\n$$\n\\frac{|\\nabla_{\\mathbf{k}} \\omega|}{c} = \\frac{1}{2} \\frac{\\sqrt{ \\sin^2(2\\alpha) + \\sin^2(2\\beta) }}{ \\sqrt{ \\sin^2(\\alpha) + \\sin^2(\\beta) } } \\cdot \\frac{1}{ \\sqrt{ 1 - \\nu^2 \\left( \\sin^2(\\alpha) + \\sin^2(\\beta) \\right) } }\n$$\n是通过将 $\\omega(\\mathbf{k})$ 的表达式对波矢 $\\mathbf{k}$ 的分量求导得到的。\n\n实现计划如下：\n1.  将创建一套模块化函数来计算所需量。以度为单位提供的角度必须通过关系式 $\\theta_{\\mathrm{rad}} = \\theta_{\\mathrm{deg}} \\cdot \\pi / 180$ 转换为弧度，以便在三角函数中使用。\n2.  函数 `get_group_velocity_norm` 将实现归一化群速度大小的公式。\n3.  函数 `get_phase_error` 将实现方向相误差的公式。\n4.  为了找到最大绝对相误差 $\\max_{\\theta'} |\\varepsilon(\\theta')|$，我们注意到误差函数 $\\varepsilon$ 仅通过差值 $\\theta' - \\varphi$ 依赖于 $\\theta'$。项 $\\sin^2(\\alpha)$ 和 $\\sin^2(\\beta)$ 赋予了核心表达式 $\\sin^2(\\alpha) + \\sin^2(\\beta)$ 一个 $\\pi/2$ 弧度（或 $90^\\circ$）的周期性。因此，可以通过在任何长度为 $90^\\circ$ 的区间上搜索来找到所有角度 $\\theta' \\in [0^\\circ, 360^\\circ)$ 上的最大误差。我们将使用 `scipy.optimize.minimize_scalar` 进行数值优化，在范围 $\\theta' \\in [0^\\circ, 90^\\circ]$ 内找到负绝对误差 $-|\\varepsilon(\\theta')|$ 的最小值。此最小值的相反数即为所求的最大绝对误差。\n5.  主循环将遍历提供的四个测试用例。对于每个用例，它将使用指定的参数 $(\\varphi, f, \\theta, \\nu)$ 调用已开发的函数来计算三个所需的值。最终结果将被收集并按规定格式化为单个字符串。",
            "answer": "```python\nimport numpy as np\nfrom scipy.optimize import minimize_scalar\n\ndef get_alpha_beta(phi_deg, f, theta_deg):\n    \"\"\"\n    Computes the intermediate angle-dependent terms alpha and beta.\n    All input angles are in degrees.\n    \"\"\"\n    phi_rad = np.deg2rad(phi_deg)\n    theta_rad = np.deg2rad(theta_deg)\n    \n    # Angle of propagation in the rotated grid coordinate system\n    theta_prime = theta_rad - phi_rad\n    \n    alpha = 0.5 * f * np.pi * np.cos(theta_prime)\n    beta = 0.5 * f * np.pi * np.sin(theta_prime)\n    \n    return alpha, beta\n\ndef get_phase_error(phi_deg, f, theta_deg, nu):\n    \"\"\"\n    Computes the directional phase error epsilon(theta).\n    \"\"\"\n    if f < 1e-12: # For f -> 0, error is 0\n        return 0.0\n        \n    alpha, beta = get_alpha_beta(phi_deg, f, theta_deg)\n    \n    sin2_alpha = np.sin(alpha)**2\n    sin2_beta = np.sin(beta)**2\n    S = sin2_alpha + sin2_beta\n    \n    # Argument for arcsin must be in [-1, 1]. The stability condition ensures this,\n    # but clipping provides numerical robustness.\n    arg_asin = np.clip(nu * np.sqrt(S), -1.0, 1.0)\n    \n    c_phase_norm = (2.0 / (f * np.pi * nu)) * np.arcsin(arg_asin)\n    \n    return c_phase_norm - 1.0\n\ndef get_group_velocity_norm(phi_deg, f, theta_deg, nu):\n    \"\"\"\n    Computes the normalized group velocity magnitude |grad_k omega| / c.\n    \"\"\"\n    if f < 1e-12: # For f -> 0, group velocity is c\n        return 1.0\n        \n    alpha, beta = get_alpha_beta(phi_deg, f, theta_deg)\n    \n    sin2_alpha = np.sin(alpha)**2\n    sin2_beta = np.sin(beta)**2\n    S = sin2_alpha + sin2_beta\n    \n    if S < 1e-20: # For k -> 0, group velocity is c\n        return 1.0\n        \n    # Check for instability, though problem constraints should prevent this.\n    stability_term = 1.0 - nu**2 * S\n    if stability_term <= 0:\n        return np.inf\n\n    sin2_2alpha = np.sin(2.0 * alpha)**2\n    sin2_2beta = np.sin(2.0 * beta)**2\n    \n    numerator_vg = 0.5 * np.sqrt(sin2_2alpha + sin2_2beta)\n    denominator_vg_1 = np.sqrt(S)\n    denominator_vg_2 = np.sqrt(stability_term)\n    \n    vg_norm = (numerator_vg / denominator_vg_1) / denominator_vg_2\n    return vg_norm\n\ndef get_max_abs_phase_error(phi_deg, f, nu):\n    \"\"\"\n    Finds the maximum absolute phase error over all propagation directions.\n    The error function has a 90-degree period, so we search over [0, 90].\n    \"\"\"\n    # The objective function to minimize is the negative of the absolute error.\n    def objective_func(theta_deg_for_opt):\n        err = get_phase_error(phi_deg, f, theta_deg_for_opt, nu)\n        return -np.abs(err)\n\n    # `minimize_scalar` finds the minimum of the objective function.\n    res = minimize_scalar(\n        objective_func,\n        bounds=(0.0, 90.0),\n        method='bounded'\n    )\n    \n    # The maximum absolute error is the negative of the found minimum.\n    max_abs_error = -res.fun\n    return max_abs_error\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print the formatted results.\n    \"\"\"\n    # Test Suite: (phi [deg], f, theta [deg], nu)\n    test_cases = [\n        (0.0, 0.3, 30.0, 0.6),\n        (45.0, 0.6, 45.0, 0.6),\n        (0.0, 0.8, 0.0, 0.6),\n        (22.5, 0.05, 67.5, 0.6),\n    ]\n\n    # The problem specifies c and delta_h, but only nu is needed for the\n    # dimensionless quantities.\n    # c = 2000.0\n    # delta_h = 10.0\n\n    results_as_strings = []\n    for case in test_cases:\n        phi_deg, f, theta_deg, nu = case\n        \n        # 1. Compute normalized group velocity magnitude\n        vg_norm = get_group_velocity_norm(phi_deg, f, theta_deg, nu)\n        \n        # 2. Compute directional phase error\n        phase_err = get_phase_error(phi_deg, f, theta_deg, nu)\n        \n        # 3. Compute maximum absolute phase error\n        max_phase_err = get_max_abs_phase_error(phi_deg, f, nu)\n        \n        # Format the three results for the current test case\n        # using f-string formatting to ensure 6 decimal places.\n        sublist_str = (\n            f\"[{vg_norm:.6f},\"\n            f\"{phase_err:.6f},\"\n            f\"{max_phase_err:.6f}]\"\n        )\n        results_as_strings.append(sublist_str)\n\n    # Join all formatted sublists into the final output string\n    print(f\"[{','.join(results_as_strings)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "最后一个实践深入探讨了地球物理反演问题中的一个核心高级主题 。我们将为一个离散的波动方程算子推导其伴随算子。理解并正确实现伴随算子是全波形反演（FWI）等现代反演方法的基石，因为它能够高效地计算模型梯度。本练习通过一个具体的小尺度算例，对这一关键概念进行了实践。",
            "id": "3613858",
            "problem": "考虑一个二维一阶线性声学系统，在旋转坐标系下，旋转角度为 $\\theta=\\pi/4$（角度以弧度为单位）。设旋转后的单位方向为 $\\mathbf{e}_{s_1}=(\\mathbf{e}_x+\\mathbf{e}_y)/\\sqrt{2}$ 和 $\\mathbf{e}_{s_2}=(\\mathbf{e}_x-\\mathbf{e}_y)/\\sqrt{2}$。其连续介质方程为\n$$\n\\partial_t p \\;=\\; -\\kappa\\left(\\partial_{s_1} v_1 + \\partial_{s_2} v_2\\right),\\qquad\n\\partial_t v_1 \\;=\\; -\\frac{1}{\\rho}\\,\\partial_{s_1} p,\\qquad\n\\partial_t v_2 \\;=\\; -\\frac{1}{\\rho}\\,\\partial_{s_2} p,\n$$\n其中 $p$ 是压强，$v_1$ 和 $v_2$ 分别是沿 $s_1$ 和 $s_2$ 方向的速度分量，$\\kappa$ 是体积模量，$\\rho$ 是密度。\n\n在一个 $2\\times 2$ 单元域上，使用旋转交错网格对该系统进行离散化，空间步长为 $\\Delta x=\\Delta y=1$，并采用周期性边界条件。将 $p_{i,j}$ 放置在单元中心 $(i,j)\\in\\{0,1\\}\\times\\{0,1\\}$，将 $v_1$ 放置在由 $(i,j)\\in\\{0,1\\}^2$ 索引的对角边位置 $(i+\\tfrac{1}{2},j+\\tfrac{1}{2})$，将 $v_2$ 放置在由 $(i,j)\\in\\{0,1\\}^2$ 索引的反对角边位置 $(i+\\tfrac{1}{2},j-\\tfrac{1}{2})$。定义离散方向导数如下\n$$\n\\left[\\partial_{s_1} p\\right]_{i+\\frac{1}{2},\\,j+\\frac{1}{2}} \\;=\\; \\frac{p_{i+1,\\,j+1}-p_{i,\\,j}}{\\sqrt{2}},\\qquad\n\\left[\\partial_{s_2} p\\right]_{i+\\frac{1}{2},\\,j-\\frac{1}{2}} \\;=\\; \\frac{p_{i+1,\\,j}-p_{i,\\,j-1}}{\\sqrt{2}},\n$$\n以及离散散度如下\n$$\n\\left[\\partial_{s_1} v_1\\right]_{i,\\,j} \\;=\\; \\frac{v_{1,\\,i+\\frac{1}{2},\\,j+\\frac{1}{2}}-v_{1,\\,i-\\frac{1}{2},\\,j-\\frac{1}{2}}}{\\sqrt{2}},\\qquad\n\\left[\\partial_{s_2} v_2\\right]_{i,\\,j} \\;=\\; \\frac{v_{2,\\,i+\\frac{1}{2},\\,j-\\frac{1}{2}}-v_{2,\\,i-\\frac{1}{2},\\,j+\\frac{1}{2}}}{\\sqrt{2}},\n$$\n所有指标均对 $2$ 取模，以强制施加周期性。\n\n定义作用于状态向量 $\\mathbf{u}=[p,\\;v_1,\\;v_2]$ 的线性空间算子（传播子）$\\mathcal{L}$ 如下\n$$\n\\left[\\mathcal{L}\\,\\mathbf{u}\\right]_p \\;=\\; \\kappa\\left(\\partial_{s_1} v_1 + \\partial_{s_2} v_2\\right),\\qquad\n\\left[\\mathcal{L}\\,\\mathbf{u}\\right]_{v_1} \\;=\\; \\frac{1}{\\rho}\\,\\partial_{s_1} p,\\qquad\n\\left[\\mathcal{L}\\,\\mathbf{u}\\right]_{v_2} \\;=\\; \\frac{1}{\\rho}\\,\\partial_{s_2} p.\n$$\n\n使用离散内积\n$$\n\\langle \\mathbf{a},\\mathbf{b}\\rangle \\;=\\; \\sum_{i,j} a_{p,\\,i,j}\\,b_{p,\\,i,j}\n\\;+\\; \\sum_{i,j} a_{v_1,\\,i,j}\\,b_{v_1,\\,i,j}\n\\;+\\; \\sum_{i,j} a_{v_2,\\,i,j}\\,b_{v_2,\\,i,j},\n$$\n其中求和遍及 $(i,j)\\in\\{0,1\\}^2$，并设置物理参数为 $\\rho=1$ 和 $\\kappa=2$。\n\n1) 从上述离散定义和伴随算子相对于内积的基本性质出发，推导显式离散伴随算子 $\\mathcal{L}^\\dagger$，使得对于所有 $\\mathbf{a}$ 和 $\\mathbf{b}$，$\\langle \\mathbf{a}, \\mathcal{L}\\,\\mathbf{b}\\rangle = \\langle \\mathcal{L}^\\dagger \\mathbf{a}, \\mathbf{b}\\rangle$ 均成立。\n\n2) 使用推导出的 $\\mathcal{L}^\\dagger$，通过对以下特定场计算 $\\langle \\mathbf{a}, \\mathcal{L}\\,\\mathbf{b}\\rangle$ 和 $\\langle \\mathcal{L}^\\dagger \\mathbf{a}, \\mathbf{b}\\rangle$ 来执行梯度检验：\n- 对于 $\\mathbf{b}$：\n  - $p^{(b)}_{0,0}=1$, $p^{(b)}_{1,0}=2$, $p^{(b)}_{0,1}=0$, $p^{(b)}_{1,1}=-1$。\n  - $v^{(b)}_{1,\\,0,0}=1$, $v^{(b)}_{1,\\,1,0}=0$, $v^{(b)}_{1,\\,0,1}=2$, $v^{(b)}_{1,\\,1,1}=-1$。\n  - $v^{(b)}_{2,\\,0,0}=3$, $v^{(b)}_{2,\\,1,0}=-2$, $v^{(b)}_{2,\\,0,1}=0$, $v^{(b)}_{2,\\,1,1}=1$。\n- 对于 $\\mathbf{a}$：\n  - $p^{(a)}_{0,0}=0$, $p^{(a)}_{1,0}=1$, $p^{(a)}_{0,1}=-2$, $p^{(a)}_{1,1}=3$。\n  - $v^{(a)}_{1,\\,0,0}=2$, $v^{(a)}_{1,\\,1,0}=-1$, $v^{(a)}_{1,\\,0,1}=1$, $v^{(a)}_{1,\\,1,1}=0$。\n  - $v^{(a)}_{2,\\,0,0}=0$, $v^{(a)}_{2,\\,1,0}=1$, $v^{(a)}_{2,\\,0,1}=-1$, $v^{(a)}_{2,\\,1,1}=2$。\n\n将最终的标量值表示为精确的解析表达式。无需四舍五入，不涉及物理单位。",
            "solution": "该问题分为两部分：首先，对于给定的线性算子 $\\mathcal{L}$ 和指定的内积，推导离散伴随算子 $\\mathcal{L}^\\dagger$；其次，使用特定的场 $\\mathbf{a}$ 和 $\\mathbf{b}$ 进行数值梯度检验。\n\n### 第1部分：伴随算子 $\\mathcal{L}^\\dagger$ 的推导\n\n伴随算子 $\\mathcal{L}^\\dagger$ 由关系式 $\\langle \\mathbf{a}, \\mathcal{L}\\,\\mathbf{b}\\rangle = \\langle \\mathcal{L}^\\dagger \\mathbf{a}, \\mathbf{b}\\rangle$ 定义，此关系式对所有状态向量 $\\mathbf{a}=[p^{(a)}, v_1^{(a)}, v_2^{(a)}]$ 和 $\\mathbf{b}=[p^{(b)}, v_1^{(b)}, v_2^{(b)}]$ 成立。内积由以下公式给出：\n$$\n\\langle \\mathbf{a},\\mathbf{b}\\rangle \\;=\\; \\sum_{i,j=0,1} p^{(a)}_{i,j}\\,p^{(b)}_{i,j}\n\\;+\\; \\sum_{i,j=0,1} v^{(a)}_{1,\\,i,j}\\,v^{(b)}_{1,\\,i,j}\n\\;+\\; \\sum_{i,j=0,1} v^{(a)}_{2,\\,i,j}\\,v^{(b)}_{2,\\,i,j}\n$$\n这里，整数指标 $(i,j)$ 用作交错网格位置的简写。\n\n我们首先写出伴随定义的左侧，即 $\\langle \\mathbf{a}, \\mathcal{L}\\,\\mathbf{b}\\rangle$：\n$$\n\\langle \\mathbf{a}, \\mathcal{L}\\,\\mathbf{b}\\rangle = \\sum_{i,j} p^{(a)}_{i,j} [\\mathcal{L}\\,\\mathbf{b}]_{p,i,j} + \\sum_{i,j} v^{(a)}_{1,i,j} [\\mathcal{L}\\,\\mathbf{b}]_{v_1,i,j} + \\sum_{i,j} v^{(a)}_{2,i,j} [\\mathcal{L}\\,\\mathbf{b}]_{v_2,i,j}\n$$\n$\\mathcal{L}\\mathbf{b}$ 的分量是：\n$$\n[\\mathcal{L}\\,\\mathbf{b}]_{p,i,j} = \\kappa\\left([\\partial_{s_1} v_1^{(b)}]_{i,j} + [\\partial_{s_2} v_2^{(b)}]_{i,j}\\right)\n$$\n$$\n[\\mathcal{L}\\,\\mathbf{b}]_{v_1,i,j} = \\frac{1}{\\rho}\\,[\\partial_{s_1} p^{(b)}]_{i,j}\n$$\n$$\n[\\mathcal{L}\\,\\mathbf{b}]_{v_2,i,j} = \\frac{1}{\\rho}\\,[\\partial_{s_2} p^{(b)}]_{i,j}\n$$\n代入离散算子：\n$$\n\\langle \\mathbf{a}, \\mathcal{L}\\,\\mathbf{b}\\rangle = \\sum_{i,j} p^{(a)}_{i,j} \\kappa\\left( \\frac{v^{(b)}_{1,i,j}-v^{(b)}_{1,i-1,j-1}}{\\sqrt{2}} + \\frac{v^{(b)}_{2,i,j}-v^{(b)}_{2,i-1,j+1}}{\\sqrt{2}} \\right) \\\\\n+ \\sum_{i,j} v^{(a)}_{1,i,j} \\frac{1}{\\rho} \\left( \\frac{p^{(b)}_{i+1,j+1}-p^{(b)}_{i,j}}{\\sqrt{2}} \\right) \\\\\n+ \\sum_{i,j} v^{(a)}_{2,i,j} \\frac{1}{\\rho} \\left( \\frac{p^{(b)}_{i+1,j}-p^{(b)}_{i,j-1}}{\\sqrt{2}} \\right)\n$$\n我们对每一项执行离散分部求和，以将导数算子从 $\\mathbf{b}$ 移至 $\\mathbf{a}$。所有指标均对 $2$ 取模。\n\n对于第一个和式中包含 $v_1^{(b)}$ 的项：\n$$\n\\sum_{i,j} p^{(a)}_{i,j} (v^{(b)}_{1,i,j}-v^{(b)}_{1,i-1,j-1}) = \\sum_{i,j} p^{(a)}_{i,j} v^{(b)}_{1,i,j} - \\sum_{i,j} p^{(a)}_{i,j} v^{(b)}_{1,i-1,j-1}\n$$\n对第二部分应用指标平移 $i' = i-1, j' = j-1$ 得到 $\\sum_{i',j'} p^{(a)}_{i'+1,j'+1} v^{(b)}_{1,i',j'}$。因此，和式变为：\n$$\n\\sum_{i,j} (p^{(a)}_{i,j} - p^{(a)}_{i+1,j+1}) v^{(b)}_{1,i,j}\n$$\n对于第一个和式中包含 $v_2^{(b)}$ 的项：\n$$\n\\sum_{i,j} p^{(a)}_{i,j} (v^{(b)}_{2,i,j}-v^{(b)}_{2,i-1,j+1}) = \\sum_{i,j} p^{(a)}_{i,j} v^{(b)}_{2,i,j} - \\sum_{i,j} p^{(a)}_{i,j} v^{(b)}_{2,i-1,j+1}\n$$\n对第二部分应用指标平移 $i' = i-1, j' = j+1$ 得到 $\\sum_{i',j'} p^{(a)}_{i'+1,j'-1} v^{(b)}_{2,i',j'}$。和式变为：\n$$\n\\sum_{i,j} (p^{(a)}_{i,j} - p^{(a)}_{i+1,j-1}) v^{(b)}_{2,i,j}\n$$\n对于第二个和式中包含 $p^{(b)}$ 的项（来自 $v_1$ 方程）：\n$$\n\\sum_{i,j} v^{(a)}_{1,i,j} (p^{(b)}_{i+1,j+1}-p^{(b)}_{i,j}) = \\sum_{i,j} v^{(a)}_{1,i,j} p^{(b)}_{i+1,j+1} - \\sum_{i,j} v^{(a)}_{1,i,j} p^{(b)}_{i,j}\n$$\n对第一部分应用指标平移 $i' = i+1, j' = j+1$ 得到 $\\sum_{i',j'} v^{(a)}_{1,i'-1,j'-1} p^{(b)}_{i',j'}$。和式变为：\n$$\n\\sum_{i,j} (v^{(a)}_{1,i-1,j-1} - v^{(a)}_{1,i,j}) p^{(b)}_{i,j}\n$$\n对于第三个和式中包含 $p^{(b)}$ 的项（来自 $v_2$ 方程）：\n$$\n\\sum_{i,j} v^{(a)}_{2,i,j} (p^{(b)}_{i+1,j}-p^{(b)}_{i,j-1}) = \\sum_{i,j} v^{(a)}_{2,i,j} p^{(b)}_{i+1,j} - \\sum_{i,j} v^{(a)}_{2,i,j} p^{(b)}_{i,j-1}\n$$\n对第一部分平移指标 $i' = i+1, j' = j$，对第二部分平移指标 $i'=i, j'=j-1$，得到 $\\sum_{i',j'} (v^{(a)}_{2,i'-1,j'} - v^{(a)}_{2,i',j'+1}) p^{(b)}_{i',j'}$。和式变为：\n$$\n\\sum_{i,j} (v^{(a)}_{2,i-1,j} - v^{(a)}_{2,i,j+1}) p^{(b)}_{i,j}\n$$\n现在，我们收集乘以 $p^{(b)}$、$v_1^{(b)}$ 和 $v_2^{(b)}$ 的项来构造 $\\langle \\mathcal{L}^\\dagger \\mathbf{a}, \\mathbf{b}\\rangle$：\n$$\n\\langle \\mathcal{L}^\\dagger \\mathbf{a}, \\mathbf{b}\\rangle = \\sum_{i,j} p^{(b)}_{i,j} \\frac{1}{\\rho \\sqrt{2}} \\left( (v^{(a)}_{1,i-1,j-1} - v^{(a)}_{1,i,j}) + (v^{(a)}_{2,i-1,j} - v^{(a)}_{2,i,j+1}) \\right) \\\\\n+ \\sum_{i,j} v^{(b)}_{1,i,j} \\frac{\\kappa}{\\sqrt{2}} (p^{(a)}_{i,j} - p^{(a)}_{i+1,j+1}) \\\\\n+ \\sum_{i,j} v^{(b)}_{2,i,j} \\frac{\\kappa}{\\sqrt{2}} (p^{(a)}_{i,j} - p^{(a)}_{i+1,j-1})\n$$\n通过将其与内积的定义 $\\langle \\mathcal{L}^\\dagger \\mathbf{a}, \\mathbf{b}\\rangle$ 进行比较，我们确定 $\\mathcal{L}^\\dagger \\mathbf{a}$ 的分量：\n$$\n[\\mathcal{L}^\\dagger\\mathbf{a}]_{p,i,j} = \\frac{1}{\\rho\\sqrt{2}} \\left( v^{(a)}_{1,i-1,j-1} - v^{(a)}_{1,i,j} + v^{(a)}_{2,i-1,j} - v^{(a)}_{2,i,j+1} \\right) = -\\frac{1}{\\rho}\\left( \\frac{v^{(a)}_{1,i,j} - v^{(a)}_{1,i-1,j-1}}{\\sqrt{2}} + \\frac{v^{(a)}_{2,i,j+1} - v^{(a)}_{2,i-1,j}}{\\sqrt{2}} \\right)\n$$\n$$\n[\\mathcal{L}^\\dagger\\mathbf{a}]_{v_1,i,j} = \\frac{\\kappa}{\\sqrt{2}} (p^{(a)}_{i,j} - p^{(a)}_{i+1,j+1}) = -\\kappa \\frac{p^{(a)}_{i+1,j+1} - p^{(a)}_{i,j}}{\\sqrt{2}}\n$$\n$$\n[\\mathcal{L}^\\dagger\\mathbf{a}]_{v_2,i,j} = \\frac{\\kappa}{\\sqrt{2}} (p^{(a)}_{i,j} - p^{(a)}_{i+1,j-1}) = -\\kappa \\frac{p^{(a)}_{i+1,j-1} - p^{(a)}_{i,j}}{\\sqrt{2}}\n$$\n这些方程定义了显式离散伴随算子 $\\mathcal{L}^\\dagger$。\n\n### 第2部分：梯度检验\n\n现在我们使用给定的数值和参数 $\\rho=1, \\kappa=2$ 计算 $\\langle \\mathbf{a}, \\mathcal{L}\\,\\mathbf{b}\\rangle$ 和 $\\langle \\mathcal{L}^\\dagger \\mathbf{a}, \\mathbf{b}\\rangle$ 来执行梯度检验。所有指标均对 $2$ 取模。\n\n输入场为：\n$p^{(b)} = \\begin{pmatrix} 1 & 2 \\\\ 0 & -1 \\end{pmatrix}$，$v^{(b)}_1 = \\begin{pmatrix} 1 & 0 \\\\ 2 & -1 \\end{pmatrix}$，$v^{(b)}_2 = \\begin{pmatrix} 3 & -2 \\\\ 0 & 1 \\end{pmatrix}$\n$p^{(a)} = \\begin{pmatrix} 0 & 1 \\\\ -2 & 3 \\end{pmatrix}$，$v^{(a)}_1 = \\begin{pmatrix} 2 & -1 \\\\ 1 & 0 \\end{pmatrix}$，$v^{(a)}_2 = \\begin{pmatrix} 0 & 1 \\\\ -1 & 2 \\end{pmatrix}$\n\n**$\\langle \\mathbf{a}, \\mathcal{L}\\,\\mathbf{b}\\rangle$ 的计算**\n\n首先，我们计算 $\\mathbf{c} = \\mathcal{L}\\mathbf{b}$：\n$c_{p,i,j} = \\frac{2}{\\sqrt{2}}\\left( (v^{(b)}_{1,i,j}-v^{(b)}_{1,i-1,j-1}) + (v^{(b)}_{2,i,j}-v^{(b)}_{2,i-1,j+1}) \\right)$\n$c_{p,0,0} = \\sqrt{2}[(1 - (-1)) + (3 - 1)] = 4\\sqrt{2}$\n$c_{p,1,0} = \\sqrt{2}[(0 - 2) + (-2 - 0)] = -4\\sqrt{2}$\n$c_{p,0,1} = \\sqrt{2}[(2 - 0) + (0 - (-2))] = 4\\sqrt{2}$\n$c_{p,1,1} = \\sqrt{2}[(-1 - 1) + (1 - 3)] = -4\\sqrt{2}$\n\n$c_{v_1,i,j} = \\frac{1}{\\sqrt{2}}(p^{(b)}_{i+1,j+1}-p^{(b)}_{i,j})$\n$c_{v_1,0,0} = \\frac{1}{\\sqrt{2}}(-1-1) = -2/\\sqrt{2}$\n$c_{v_1,1,0} = \\frac{1}{\\sqrt{2}}(0-2) = -2/\\sqrt{2}$\n$c_{v_1,0,1} = \\frac{1}{\\sqrt{2}}(2-0) = 2/\\sqrt{2}$\n$c_{v_1,1,1} = \\frac{1}{\\sqrt{2}}(1-(-1)) = 2/\\sqrt{2}$\n\n$c_{v_2,i,j} = \\frac{1}{\\sqrt{2}}(p^{(b)}_{i+1,j}-p^{(b)}_{i,j-1})$\n$c_{v_2,0,0} = \\frac{1}{\\sqrt{2}}(2-0) = 2/\\sqrt{2}$\n$c_{v_2,1,0} = \\frac{1}{\\sqrt{2}}(1-(-1)) = 2/\\sqrt{2}$\n$c_{v_2,0,1} = \\frac{1}{\\sqrt{2}}(-1-1) = -2/\\sqrt{2}$\n$c_{v_2,1,1} = \\frac{1}{\\sqrt{2}}(0-2) = -2/\\sqrt{2}$\n\n现在，计算内积 $\\langle \\mathbf{a}, \\mathbf{c} \\rangle = \\sum p^{(a)}_{i,j}c_{p,i,j} + \\sum v^{(a)}_{1,i,j}c_{v_1,i,j} + \\sum v^{(a)}_{2,i,j}c_{v_2,i,j}$：\n$\\sum p^{(a)}c_p = 0(4\\sqrt{2}) + 1(-4\\sqrt{2}) + (-2)(4\\sqrt{2}) + 3(-4\\sqrt{2}) = (-4 - 8 - 12)\\sqrt{2} = -24\\sqrt{2}$\n$\\sum v^{(a)}_1 c_{v_1} = \\frac{1}{\\sqrt{2}}[2(-2) + (-1)(-2) + 1(2) + 0(2)] = \\frac{1}{\\sqrt{2}}[-4 + 2 + 2] = 0$\n$\\sum v^{(a)}_2 c_{v_2} = \\frac{1}{\\sqrt{2}}[0(2) + 1(2) + (-1)(-2) + 2(-2)] = \\frac{1}{\\sqrt{2}}[2 + 2 - 4] = 0$\n因此，$\\langle \\mathbf{a}, \\mathcal{L}\\,\\mathbf{b}\\rangle = -24\\sqrt{2}$。\n\n**$\\langle \\mathcal{L}^\\dagger \\mathbf{a}, \\mathbf{b}\\rangle$ 的计算**\n\n首先，我们计算 $\\mathbf{d} = \\mathcal{L}^\\dagger\\mathbf{a}$：\n$d_{p,i,j} = -\\frac{1}{\\sqrt{2}} \\left( (v^{(a)}_{1,i,j}-v^{(a)}_{1,i-1,j-1}) + (v^{(a)}_{2,i,j+1}-v^{(a)}_{2,i-1,j}) \\right)$\n$d_{p,0,0} = -\\frac{1}{\\sqrt{2}}[(2-0) + (-1-1)] = 0$\n$d_{p,1,0} = -\\frac{1}{\\sqrt{2}}[(-1-1) + (2-0)] = 0$\n$d_{p,0,1} = -\\frac{1}{\\sqrt{2}}[(1-(-1)) + (0-2)] = 0$\n$d_{p,1,1} = -\\frac{1}{\\sqrt{2}}[(0-2) + (1-(-1))] = 0$\n\n$d_{v_1,i,j} = -\\frac{2}{\\sqrt{2}} (p^{(a)}_{i+1,j+1} - p^{(a)}_{i,j})$\n$d_{v_1,0,0} = -\\sqrt{2}(3-0) = -3\\sqrt{2}$\n$d_{v_1,1,0} = -\\sqrt{2}(-2-1) = 3\\sqrt{2}$\n$d_{v_1,0,1} = -\\sqrt{2}(1-(-2)) = -3\\sqrt{2}$\n$d_{v_1,1,1} = -\\sqrt{2}(0-3) = 3\\sqrt{2}$\n\n$d_{v_2,i,j} = -\\frac{2}{\\sqrt{2}} (p^{(a)}_{i+1,j-1} - p^{(a)}_{i,j})$\n$d_{v_2,0,0} = -\\sqrt{2}(p^{(a)}_{1,1}-p^{(a)}_{0,0}) = -\\sqrt{2}(3-0) = -3\\sqrt{2}$\n$d_{v_2,1,0} = -\\sqrt{2}(p^{(a)}_{0,1}-p^{(a)}_{1,0}) = -\\sqrt{2}(-2-1) = 3\\sqrt{2}$\n$d_{v_2,0,1} = -\\sqrt{2}(p^{(a)}_{1,0}-p^{(a)}_{0,1}) = -\\sqrt{2}(1-(-2)) = -3\\sqrt{2}$\n$d_{v_2,1,1} = -\\sqrt{2}(p^{(a)}_{0,0}-p^{(a)}_{1,1}) = -\\sqrt{2}(0-3) = 3\\sqrt{2}$\n\n现在，计算内积 $\\langle \\mathbf{d}, \\mathbf{b} \\rangle = \\sum d_{p,i,j}p^{(b)}_{i,j} + \\sum d_{v_1,i,j}v^{(b)}_{1,i,j} + \\sum d_{v_2,i,j}v^{(b)}_{2,i,j}$：\n$\\sum d_p p^{(b)} = 0$\n$\\sum d_{v_1}v^{(b)}_1 = (-3\\sqrt{2})(1) + (3\\sqrt{2})(0) + (-3\\sqrt{2})(2) + (3\\sqrt{2})(-1) = (-3 - 6 - 3)\\sqrt{2} = -12\\sqrt{2}$\n$\\sum d_{v_2}v^{(b)}_2 = (-3\\sqrt{2})(3) + (3\\sqrt{2})(-2) + (-3\\sqrt{2})(0) + (3\\sqrt{2})(1) = (-9 - 6 + 3)\\sqrt{2} = -12\\sqrt{2}$\n因此，$\\langle \\mathcal{L}^\\dagger \\mathbf{a}, \\mathbf{b}\\rangle = 0 - 12\\sqrt{2} - 12\\sqrt{2} = -24\\sqrt{2}$。\n\n两次计算得出相同的结果，证实了所推导的伴随算子 $\\mathcal{L}^\\dagger$ 的正确性，并成功完成了梯度检验。最终的标量值为 $-24\\sqrt{2}$。",
            "answer": "$$\n\\boxed{-24\\sqrt{2}}\n$$"
        }
    ]
}