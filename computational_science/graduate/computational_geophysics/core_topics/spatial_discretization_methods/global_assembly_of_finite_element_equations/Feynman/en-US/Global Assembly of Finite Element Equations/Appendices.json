{
    "hands_on_practices": [
        {
            "introduction": "This first exercise lays the foundation for understanding matrix assembly by focusing on the element mass matrix. You will derive the computational formula for the consistent mass matrix using numerical quadrature and explore the widely used approximation of mass lumping. This practice solidifies the connection between the continuous weak form and its discrete representation at the element level, a crucial first step in any finite element analysis. ",
            "id": "3600322",
            "problem": "Consider the scalar acoustic wave equation used in computational seismology on a three-dimensional domain, where the semi-discrete finite element method with trilinear hexahedral elements leads to a mass matrix. Let the weak form mass bilinear form be the elementwise integral of the density-weighted inner product, so that the consistent element mass matrix satisfies $M_e = \\left[m_{ij}^{(e)}\\right]$ with entries $m_{ij}^{(e)} = \\int_{\\Omega_e} \\rho(\\boldsymbol{x}) N_i(\\boldsymbol{x}) N_j(\\boldsymbol{x}) \\, \\mathrm{d}V$, where $N_i$ are the trilinear shape functions on element $\\Omega_e$. Use the isoparametric mapping $\\boldsymbol{x}(\\xi,\\eta,\\zeta)$ from the reference cube $\\hat{\\Omega} = [-1,1]^3$ to the physical hexahedron and denote the Jacobian determinant by $J(\\xi,\\eta,\\zeta) = \\det\\left(\\partial \\boldsymbol{x} / \\partial (\\xi,\\eta,\\zeta)\\right)$.\n\nTasks:\n1) Starting from the weak-form definition $m_{ij}^{(e)} = \\int_{\\Omega_e} \\rho N_i N_j \\, \\mathrm{d}V$ and the isoparametric transformation, derive the explicit tensor-product $2 \\times 2 \\times 2$ Gauss–Legendre quadrature formula for $M_e$, writing it in a compact matrix form that exhibits the sum over the $8$ quadrature points $(\\xi_a,\\eta_b,\\zeta_c) \\in \\{\\pm 1/\\sqrt{3}\\}^3$ with weights equal to $1$ in each dimension. Your expression must explicitly include the vector of shape functions evaluated at quadrature points, the density evaluated at mapped quadrature points, and $J(\\xi,\\eta,\\zeta)$.\n2) Using first principles, discuss precise conditions on the element mapping and material density field under which diagonal mass lumping is exact in the following two senses: (i) exactness of the consistent element mass computed by quadrature, and (ii) exactness of the diagonal lumped mass matrix when compared to the consistent mass in reproducing elementwise weighted $L^2$ integrals of functions in the finite element space. Your discussion must clearly identify which notions of “exactness” can and cannot hold for standard trilinear hexahedra with positive quadrature weights.\n3) Consider the rectangular domain $\\Omega = [0, 2L_x] \\times [0, L_y] \\times [0, L_z]$ with constant density $\\rho$, discretized by two axis-aligned, congruent trilinear hexahedral elements $\\Omega_1 = [0, L_x] \\times [0, L_y] \\times [0, L_z]$ and $\\Omega_2 = [L_x, 2L_x] \\times [0, L_y] \\times [0, L_z]$. Perform diagonal mass lumping by the standard row-sum procedure at the element level and assemble globally. Determine the lumped global mass associated with the shared global corner node at $\\boldsymbol{x} = (L_x, 0, 0)$. Express your final answer as a single closed-form analytic expression in terms of $\\rho$, $L_x$, $L_y$, and $L_z$. Do not substitute numerical values. No rounding is required. Do not include units in your final expression; however, interpret $\\rho$ as mass density measured in $\\mathrm{kg}\\,\\mathrm{m}^{-3}$ and $L_x$, $L_y$, $L_z$ as lengths measured in $\\mathrm{m}$.",
            "solution": "The problem presents a three-part query concerning the mass matrix in the finite element method as applied to computational seismology. The tasks involve derivation, theoretical discussion, and a specific calculation. The problem will be addressed by sequentially solving each of the three tasks.\n\n### Step 1: Validation of the Problem Statement\nThe givens are extracted verbatim as follows:\n- **Equation**: Scalar acoustic wave equation in a three-dimensional domain.\n- **Method**: Semi-discrete finite element method.\n- **Element**: Trilinear hexahedral element $\\Omega_e$.\n- **Mass Matrix Weak Form**: $m_{ij}^{(e)} = \\int_{\\Omega_e} \\rho(\\boldsymbol{x}) N_i(\\boldsymbol{x}) N_j(\\boldsymbol{x}) \\, \\mathrm{d}V$, where $N_i$ are trilinear shape functions.\n- **Mapping**: Isoparametric mapping $\\boldsymbol{x}(\\xi,\\eta,\\zeta)$ from the reference cube $\\hat{\\Omega} = [-1,1]^3$.\n- **Jacobian**: $J(\\xi,\\eta,\\zeta) = \\det\\left(\\partial \\boldsymbol{x} / \\partial (\\xi,\\eta,\\zeta)\\right)$.\n- **Task 1**: Derive the $2 \\times 2 \\times 2$ Gauss–Legendre quadrature formula for the element mass matrix $M_e$. Quadrature points are $(\\xi_a,\\eta_b,\\zeta_c) \\in \\{\\pm 1/\\sqrt{3}\\}^3$ with uni-dimensional weights of $1$.\n- **Task 2**: Discuss conditions for the exactness of diagonal mass lumping in two specified senses.\n- **Task 3**: For a domain $\\Omega = [0, 2L_x] \\times [0, L_y] \\times [0, L_z]$ with constant density $\\rho$, discretized by two elements $\\Omega_1 = [0, L_x] \\times [0, L_y] \\times [0, L_z]$ and $\\Omega_2 = [L_x, 2L_x] \\times [0, L_y] \\times [0, L_z]$, determine the lumped global mass at the shared node $\\boldsymbol{x} = (L_x, 0, 0)$ using the row-sum procedure.\n\nThe problem statement is scientifically grounded in the established theory of the finite element method. It is well-posed, objective, and internally consistent. All terms are standard in computational mechanics, and the tasks are well-defined mathematical exercises. The problem is formalizable and relevant to its stated field. The provided data is complete and sufficient for solving all three tasks. The problem is neither trivial nor ill-posed. Therefore, the problem is deemed valid.\n\n### Task 1: Quadrature Formula for the Element Mass Matrix\n\nThe entry $m_{ij}^{(e)}$ of the consistent element mass matrix $M_e$ is given by the integral over the physical element domain $\\Omega_e$:\n$$m_{ij}^{(e)} = \\int_{\\Omega_e} \\rho(\\boldsymbol{x}) N_i(\\boldsymbol{x}) N_j(\\boldsymbol{x}) \\, \\mathrm{d}V$$\nUsing the isoparametric mapping $\\boldsymbol{x} = \\boldsymbol{x}(\\xi, \\eta, \\zeta)$ from the reference cube $\\hat{\\Omega} = [-1,1]^3$ to $\\Omega_e$, the integral is transformed into the reference coordinates $(\\xi, \\eta, \\zeta)$. The shape functions become functions on the reference element, $N_i(\\boldsymbol{x}) = N_i(\\boldsymbol{x}(\\xi, \\eta, \\zeta)) \\equiv \\hat{N}_i(\\xi, \\eta, \\zeta)$, and the volume element transforms as $\\mathrm{d}V = J(\\xi, \\eta, \\zeta) \\, \\mathrm{d}\\xi \\, \\mathrm{d}\\eta \\, \\mathrm{d}\\zeta$, where $J$ is the Jacobian determinant of the mapping.\nThe integral becomes:\n$$m_{ij}^{(e)} = \\int_{-1}^{1} \\int_{-1}^{1} \\int_{-1}^{1} \\rho(\\boldsymbol{x}(\\xi,\\eta,\\zeta)) \\hat{N}_i(\\xi,\\eta,\\zeta) \\hat{N}_j(\\xi,\\eta,\\zeta) J(\\xi,\\eta,\\zeta) \\, \\mathrm{d}\\xi \\, \\mathrm{d}\\eta \\, \\mathrm{d}\\zeta$$\nWe approximate this integral using a $2 \\times 2 \\times 2$ tensor-product Gauss-Legendre quadrature. The quadrature points are $(\\xi_a, \\eta_b, \\zeta_c)$ where $a,b,c \\in \\{1,2\\}$ and $\\{\\xi_1, \\xi_2\\} = \\{\\eta_1, \\eta_2\\} = \\{\\zeta_1, \\zeta_2\\} = \\{-1/\\sqrt{3}, 1/\\sqrt{3}\\}$. The corresponding weights are given as $w_a = w_b = w_c = 1$. The total number of quadrature points is $8$. Let a generic quadrature point be denoted by $\\boldsymbol{q}_k$ with corresponding weight $W_k$, for $k=1, \\dots, 8$. For the tensor-product rule specified, the 3D weight is the product of the 1D weights, so $W_k = w_a w_b w_c = 1 \\cdot 1 \\cdot 1 = 1$ for all $k$.\n\nThe integral is approximated by the sum:\n$$m_{ij}^{(e)} \\approx \\sum_{k=1}^{8} W_k \\left[ \\rho(\\boldsymbol{x}(\\boldsymbol{q}_k)) \\hat{N}_i(\\boldsymbol{q}_k) \\hat{N}_j(\\boldsymbol{q}_k) J(\\boldsymbol{q}_k) \\right]$$\nSince all $W_k=1$, and henceforth dropping the hat notation for shape functions on the reference element, this simplifies to:\n$$m_{ij}^{(e)} \\approx \\sum_{k=1}^{8} \\rho(\\boldsymbol{x}(\\boldsymbol{q}_k)) J(\\boldsymbol{q}_k) N_i(\\boldsymbol{q}_k) N_j(\\boldsymbol{q}_k)$$\nTo write this in a compact matrix form for the entire $8 \\times 8$ element mass matrix $M_e = [m_{ij}^{(e)}]$, we define a column vector of shape functions $\\boldsymbol{N}(\\boldsymbol{q}) = [N_1(\\boldsymbol{q}), N_2(\\boldsymbol{q}), \\dots, N_8(\\boldsymbol{q})]^T$. The term $N_i(\\boldsymbol{q}_k) N_j(\\boldsymbol{q}_k)$ is the $(i,j)$ entry of the outer product $\\boldsymbol{N}(\\boldsymbol{q}_k) \\boldsymbol{N}(\\boldsymbol{q}_k)^T$.\nThe element mass matrix is therefore the sum of $8$ rank-$1$ matrices, each corresponding to a quadrature point:\n$$M_e \\approx \\sum_{k=1}^{8} \\rho(\\boldsymbol{x}(\\boldsymbol{q}_k)) J(\\boldsymbol{q}_k) \\boldsymbol{N}(\\boldsymbol{q}_k) \\boldsymbol{N}(\\boldsymbol{q}_k)^T$$\nTo be more explicit with the tensor-product structure, let the quadrature points be $\\boldsymbol{q}_{abc} = (\\xi_a, \\eta_b, \\zeta_c)$ with $a,b,c \\in \\{1,2\\}$ and weights $w_a=w_b=w_c=1$. The mass matrix formula is:\n$$M_e \\approx \\sum_{a=1}^2 \\sum_{b=1}^2 \\sum_{c=1}^2 w_a w_b w_c \\rho(\\boldsymbol{x}(\\boldsymbol{q}_{abc})) J(\\boldsymbol{q}_{abc}) \\boldsymbol{N}(\\boldsymbol{q}_{abc}) \\boldsymbol{N}(\\boldsymbol{q}_{abc})^T$$\nGiven the weights are unity, this is:\n$$M_e \\approx \\sum_{a=1}^2 \\sum_{b=1}^2 \\sum_{c=1}^2 \\rho(\\boldsymbol{x}(\\xi_a,\\eta_b,\\zeta_c)) J(\\xi_a,\\eta_b,\\zeta_c) \\boldsymbol{N}(\\xi_a,\\eta_b,\\zeta_c) \\boldsymbol{N}(\\xi_a,\\eta_b,\\zeta_c)^T$$\n\n### Task 2: Conditions for Exact Mass Lumping\n\n(i) **Exactness of the consistent element mass computed by quadrature.**\nThe $2 \\times 2 \\times 2$ Gauss-Legendre quadrature rule is exact for integrands that are polynomials of degree at most $2n-1 = 2(2)-1=3$ in each variable independently. The integrand for $m_{ij}^{(e)}$ in reference coordinates is $f(\\xi,\\eta,\\zeta) = \\rho(\\boldsymbol{x}(\\xi,\\eta,\\zeta)) J(\\xi,\\eta,\\zeta) N_i(\\xi,\\eta,\\zeta) N_j(\\xi,\\eta,\\zeta)$.\nThe trilinear shape functions $N_i$ are polynomials of degree $1$ in each variable (e.g., $N_1 = \\frac{1}{8}(1-\\xi)(1-\\eta)(1-\\zeta)$). The product $N_i N_j$ is therefore a polynomial of degree at most $2$ in each variable (e.g., for $i \\neq j$, $N_1 N_8 = \\frac{1}{64}(1-\\xi^2)(1-\\eta^2)(1-\\zeta^2)$). Since degree $2  3$, the shape function product part of the integrand is integrated exactly.\nThe mapping is $\\boldsymbol{x}(\\xi,\\eta,\\zeta) = \\sum_k \\boldsymbol{x}_k N_k(\\xi,\\eta,\\zeta)$. The entries of the Jacobian matrix $\\partial\\boldsymbol{x}/\\partial(\\xi,\\eta,\\zeta)$ involve derivatives of $N_k$, which are bilinear (e.g., $\\partial N_k/\\partial\\xi$ is linear in $\\eta$ and $\\zeta$). The Jacobian determinant $J$ is the determinant of a $3 \\times 3$ matrix of such bilinear functions, resulting in a polynomial in $\\xi, \\eta, \\zeta$ whose degree can be up to $6$ in each variable. This is far higher than the degree $3$ that the quadrature rule can handle.\nTherefore, the integration is generally not exact. The precise condition for the quadrature to be exact is that the product $\\rho(\\boldsymbol{x}(\\xi,\\eta,\\zeta)) J(\\xi,\\eta,\\zeta)$ must be of a form such that the total integrand $f(\\xi,\\eta,\\zeta)$ is a polynomial of degree at most $3$ in each variable. A simple, sufficient condition is that both the density $\\rho$ and the Jacobian determinant $J$ are constant. Constant $J$ occurs when the mapping is affine, which for a hexahedral element implies it is a parallelepiped (a rectangular brick being a special case). Constant $\\rho$ is a material property. Under these conditions, the integrand's polynomial degree is determined solely by $N_i N_j$, which is at most $2$ in each variable, and the integration is exact.\n\n(ii) **Exactness of the diagonal lumped mass matrix.**\nThe standard row-sum lumped mass matrix $M_L$ has diagonal entries $(M_L)_{ii} = \\sum_j m_{ij}^{(e)}$ and zero off-diagonal entries. By the partition of unity property of shape functions, $\\sum_j N_j(\\boldsymbol{x}) = 1$, the diagonal entries are equivalent to the nodal mass:\n$$(M_L)_{ii} = \\sum_{j=1}^8 \\int_{\\Omega_e} \\rho N_i N_j \\, \\mathrm{d}V = \\int_{\\Omega_e} \\rho N_i \\left( \\sum_{j=1}^8 N_j \\right) \\, \\mathrm{d}V = \\int_{\\Omega_e} \\rho N_i \\, \\mathrm{d}V$$\nThe question asks for the condition under which lumping is exact in reproducing the elementwise weighted $L^2$ integral of a function $u_h(\\boldsymbol{x}) = \\sum_i u_i N_i(\\boldsymbol{x})$ from the finite element space. Let $\\boldsymbol{u}$ be the vector of nodal values $u_i$. The integral computed with the consistent mass matrix is $\\boldsymbol{u}^T M_e \\boldsymbol{u}$. The same quantity computed with the lumped matrix is $\\boldsymbol{u}^T M_L \\boldsymbol{u}$.\nExactness requires $\\boldsymbol{u}^T M_e \\boldsymbol{u} = \\boldsymbol{u}^T M_L \\boldsymbol{u}$ for any arbitrary choice of nodal values $\\boldsymbol{u}$.\n$$\\sum_{i,j} u_i m_{ij}^{(e)} u_j = \\sum_i u_i^2 (M_L)_{ii} = \\sum_i u_i^2 \\sum_j m_{ij}^{(e)}$$\nThis equality must hold for all $\\boldsymbol{u}$. By expanding the sums and comparing coefficients of terms like $u_i u_j$ for $i \\neq j$, we find that the equality holds if and only if all off-diagonal entries $m_{ij}^{(e)}$ (for $i \\neq j$) are zero. This means the consistent mass matrix $M_e$ must be diagonal.\nThe condition $m_{ij}^{(e)} = \\int_{\\Omega_e} \\rho N_i N_j \\, \\mathrm{d}V = 0$ for $i \\neq j$ implies that the shape functions $N_i$ must be an orthogonal set with respect to the inner product weighted by $\\rho(\\boldsymbol{x})$. Standard Lagrange-type shape functions, including trilinear functions, are not orthogonal; their supports overlap significantly, leading to a non-diagonal (in this case, dense) consistent mass matrix $M_e$. The use of positive quadrature weights as specified further ensures that the computed $M_e$ is not diagonal.\nTherefore, for standard trilinear hexahedra, there are no non-trivial conditions on the element mapping or density field that make mass lumping exact in this sense. Lumping is fundamentally an approximation that alters this quadratic form, though it does preserve the total element mass (i.e., $\\boldsymbol{1}^T M_e \\boldsymbol{1} = \\boldsymbol{1}^T M_L \\boldsymbol{1}$).\n\n### Task 3: Calculation of Lumped Mass at a Shared Node\n\nWe need to compute the global lumped mass at the node $P = (L_x, 0, 0)$. This node is shared by two elements, $\\Omega_1 = [0, L_x] \\times [0, L_y] \\times [0, L_z]$ and $\\Omega_2 = [L_x, 2L_x] \\times [0, L_y] \\times [0, L_z]$. The global lumped mass at a node is the sum of the local lumped mass contributions from all elements that share the node.\n$$M_P^{\\text{global}} = \\sum_{e \\in \\{\\Omega_1, \\Omega_2\\}} (m_{ii}^{(e)})_L$$\nwhere $i$ is the local index of node $P$ in element $e$.\nThe local lumped mass for a node $i$ in an element $e$ is given by $(m_{ii}^{(e)})_L = \\int_{\\Omega_e} \\rho N_i^{(e)} \\, \\mathrm{d}V$.\n\nContribution from element $\\Omega_1$:\nThe element $\\Omega_1$ is a rectangular brick of dimensions $L_x \\times L_y \\times L_z$. The density $\\rho$ is constant. The lumped mass at node $P$ from $\\Omega_1$ is $\\rho \\int_{\\Omega_1} N_P^{(1)} \\, \\mathrm{d}V$, where $N_P^{(1)}$ is the local shape function in $\\Omega_1$ that is unity at $P$.\nWe can evaluate this integral by transforming to the reference element $\\hat{\\Omega}=[-1,1]^3$. The mapping from $\\hat{\\Omega}$ to $\\Omega_1$ is $x=\\frac{L_x}{2}(1+\\xi)$, $y=\\frac{L_y}{2}(1+\\eta)$, $z=\\frac{L_z}{2}(1+\\zeta)$. The Jacobian determinant is constant: $J = \\frac{L_x L_y L_z}{8}$.\nThe node $P=(L_x,0,0)$ corresponds to the reference coordinates $(\\xi,\\eta,\\zeta)=(1,-1,-1)$. The shape function for this node is $N_P^{(1)}(\\xi,\\eta,\\zeta) = \\frac{1}{8}(1+\\xi)(1-\\eta)(1-\\zeta)$.\nThe integral is:\n$$\\int_{\\Omega_1} N_P^{(1)} \\, \\mathrm{d}V = \\int_{-1}^1 \\int_{-1}^1 \\int_{-1}^1 N_P^{(1)}(\\xi,\\eta,\\zeta) J \\, \\mathrm{d}\\xi \\mathrm{d}\\eta \\mathrm{d}\\zeta$$\n$$= J \\int_{-1}^1 \\int_{-1}^1 \\int_{-1}^1 \\frac{1}{8}(1+\\xi)(1-\\eta)(1-\\zeta) \\, \\mathrm{d}\\xi \\mathrm{d}\\eta \\mathrm{d}\\zeta$$\n$$= \\frac{J}{8} \\left( \\int_{-1}^1 (1+\\xi) \\mathrm{d}\\xi \\right) \\left( \\int_{-1}^1 (1-\\eta) \\mathrm{d}\\eta \\right) \\left( \\int_{-1}^1 (1-\\zeta) \\mathrm{d}\\zeta \\right)$$\nEach of the one-dimensional integrals evaluates to $2$. For instance, $\\int_{-1}^1 (1+u) \\mathrm{d}u = [u+u^2/2]_{-1}^1 = 2$.\nSo, $\\int_{\\Omega_1} N_P^{(1)} \\, \\mathrm{d}V = \\frac{J}{8} (2)(2)(2) = J = \\frac{L_x L_y L_z}{8}$.\nThis is $1/8$ of the volume of the element, $\\text{Vol}(\\Omega_1) = L_x L_y L_z$.\nThe mass contribution from $\\Omega_1$ is $(m^{(1)})_L = \\rho \\frac{\\text{Vol}(\\Omega_1)}{8} = \\frac{\\rho L_x L_y L_z}{8}$.\n\nContribution from element $\\Omega_2$:\nThe element $\\Omega_2$ is congruent to $\\Omega_1$, with the same dimensions $L_x \\times L_y \\times L_z$ and the same constant density $\\rho$. The node $P=(L_x,0,0)$ is also a corner node for $\\Omega_2$. By an identical argument, the integral of the corresponding shape function $N_P^{(2)}$ over $\\Omega_2$ is $1/8$ of the element's volume.\nThe mass contribution from $\\Omega_2$ is $(m^{(2)})_L = \\rho \\frac{\\text{Vol}(\\Omega_2)}{8} = \\frac{\\rho L_x L_y L_z}{8}$.\n\nTotal Global Mass:\nThe total lumped mass at node $P$ is the sum of the contributions from the two elements:\n$$M_P^{\\text{global}} = (m^{(1)})_L + (m^{(2)})_L = \\frac{\\rho L_x L_y L_z}{8} + \\frac{\\rho L_x L_y L_z}{8} = 2 \\frac{\\rho L_x L_y L_z}{8} = \\frac{\\rho L_x L_y L_z}{4}$$\nThe final expression for the lumped global mass at the specified node is $\\frac{\\rho L_x L_y L_z}{4}$.",
            "answer": "$$\\boxed{\\frac{\\rho L_x L_y L_z}{4}}$$"
        },
        {
            "introduction": "Building on the concepts of consistent and lumped mass matrices, this practice investigates the profound impact of this assembly choice on dynamic simulations. You will analyze how different mass matrix representations alter the numerical dispersion properties of a simulated seismic wave, a critical factor for the accuracy of wave propagation modeling. This exercise demonstrates that choices made during assembly are not merely computational conveniences but have direct, quantifiable consequences on the physical behavior of the numerical solution. ",
            "id": "3600285",
            "problem": "You are to model scalar seismic wave propagation in a one-dimensional, homogeneous, periodic medium using the Finite Element Method (FEM). Beginning from the small-strain elastic wave equation, assume constant density and shear modulus so that the wave speed is nondimensionalized to $c = 1$. The governing equation for displacement $u(x,t)$ is the second-order hyperbolic partial differential equation\n$$\n\\partial_{tt} u(x,t) = c^2 \\, \\partial_{xx} u(x,t),\n$$\nwith $c$ constant. Use a standard Galerkin discretization with piecewise linear basis functions on a uniform mesh with spacing $h$, and construct the globally assembled system from elemental contributions. Consider two mass assembly options: the consistent mass matrix and the lumped mass matrix obtained by diagonal row-sum lumping. Impose Bloch-Floquet periodicity for the infinite uniform mesh, with discrete mode shape $v_j = \\exp(i \\kappa j h)$, where the nondimensional discrete wavenumber $\\kappa h$ is in the open interval $(0,\\pi)$ and angles are measured in radians.\n\nStarting from the fundamental definitions of the FEM elemental matrices and the global assembly process, derive the semi-discrete equations of motion in the form\n$$\n\\mathbf{M} \\, \\ddot{\\mathbf{u}}(t) + c^2 \\, \\mathbf{K} \\, \\mathbf{u}(t) = \\mathbf{0},\n$$\nwhere $\\mathbf{M}$ is the global mass matrix (either consistent or lumped) and $\\mathbf{K}$ is the global stiffness matrix. Then, for a Bloch mode with nondimensional wavenumber $q \\equiv \\kappa h$ and harmonic time dependence, derive the discrete dispersion relation, extract the discrete angular frequency $\\omega(q)$, and define the discrete phase velocity\n$$\nc_{\\mathrm{d}}(q) \\equiv \\frac{\\omega(q)}{\\kappa}.\n$$\nYour goal is to compute the discrete dispersion curves and quantify how the assembly choice (consistent versus lumped mass matrix) shifts the phase velocity. Specifically, define the nondimensional phase velocity ratio for each assembly as $c_{\\mathrm{d}}(q)/c$ and the assembly-induced shift\n$$\n\\Delta(q) \\equiv \\frac{c_{\\mathrm{d,cons}}(q)}{c} - \\frac{c_{\\mathrm{d,lump}}(q)}{c}.\n$$\nWork entirely in nondimensional variables with $c = 1$ and angles in radians.\n\nYour program must implement the derived expressions and evaluate $\\Delta(q)$ for the following test suite of nondimensional wavenumbers $q$:\n- Boundary limit as $q \\to 0$, reported by evaluating at $q = 0$ using the appropriate limiting values.\n- Happy-path case $q = 0.1$.\n- Mid-spectrum case $q = \\pi/2$.\n- Edge case approaching the Nyquist limit $q = \\pi - 10^{-6}$.\n\nAdditionally, your program must compute the maximum absolute assembly-induced shift over the interval $q \\in (0,\\pi)$ by sampling a uniformly spaced grid of $N$ points with $N = 20001$ and report\n$$\n\\max_{q \\in (0,\\pi)} \\left| \\Delta(q) \\right|.\n$$\n\nAll angle inputs and outputs must be interpreted in radians. No physical units are involved since the formulation is nondimensional.\n\nFinal Output Format:\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, in the following order:\n$$\n\\left[ \\Delta(0), \\, \\Delta(0.1), \\, \\Delta\\left(\\frac{\\pi}{2}\\right), \\, \\Delta\\left(\\pi - 10^{-6}\\right), \\, \\max_{q \\in (0,\\pi)} |\\Delta(q)| \\right].\n$$\nEach entry must be a floating-point number.",
            "solution": "The problem requires the derivation of the numerical dispersion relation for the 1D scalar wave equation using the Finite Element Method (FEM) with two different mass matrix assembly schemes. We then quantify the difference in phase velocity induced by the choice of mass matrix. The problem is well-posed and scientifically sound, based on standard principles of computational physics.\n\n### 1. FEM Formulation and Elemental Matrices\n\nThe governing equation is the 1D scalar wave equation:\n$$\n\\partial_{tt} u(x,t) = c^2 \\, \\partial_{xx} u(x,t)\n$$\nWe discretize a one-dimensional spatial domain into elements of uniform length $h$. Within each element, the displacement field $u(x,t)$ is approximated using piecewise linear basis functions (also known as shape functions), $N_a(x)$. For an element spanning from node $j$ to $j+1$, the approximation is $u^e(x,t) = u_j(t) N_j(x) + u_{j+1}(t) N_{j+1}(x)$.\n\nThe standard Galerkin procedure leads to the elemental matrix system:\n$$\n\\mathbf{M}^e \\ddot{\\mathbf{u}}^e + c^2 \\mathbf{K}^e \\mathbf{u}^e = \\mathbf{0}\n$$\nwhere the elemental stiffness matrix $\\mathbf{K}^e$ and mass matrix $\\mathbf{M}^e$ are given by:\n$$\nK^e_{ab} = \\int_{\\text{element}} \\frac{dN_a}{dx} \\frac{dN_b}{dx} \\, dx\n$$\n$$\nM^e_{ab} = \\int_{\\text{element}} N_a N_b \\, dx\n$$\n\nFor a linear element of length $h$, the basis functions in local coordinates $\\xi = (x-x_j)/h \\in [0,1]$ are $N_1(\\xi) = 1-\\xi$ and $N_2(\\xi) = \\xi$. Their derivatives are $\\frac{dN_1}{dx} = -1/h$ and $\\frac{dN_2}{dx} = 1/h$.\n\nThe elemental stiffness matrix is calculated as:\n$$\n\\mathbf{K}^e = \\int_0^h \\frac{1}{h^2} \\begin{pmatrix} (-1)(-1)  (-1)(1) \\\\ (1)(-1)  (1)(1) \\end{pmatrix} dx = \\frac{1}{h} \\begin{pmatrix} 1  -1 \\\\ -1  1 \\end{pmatrix}\n$$\n\nThe elemental **consistent mass matrix** is calculated as:\n$$\n\\mathbf{M}^e_{\\mathrm{cons}} = \\int_0^h \\begin{pmatrix} (1-\\xi)^2  (1-\\xi)\\xi \\\\ \\xi(1-\\xi)  \\xi^2 \\end{pmatrix} dx = h \\int_0^1 \\begin{pmatrix} (1-\\xi)^2  \\xi-\\xi^2 \\\\ \\xi-\\xi^2  \\xi^2 \\end{pmatrix} d\\xi = \\frac{h}{6} \\begin{pmatrix} 2  1 \\\\ 1  2 \\end{pmatrix}\n$$\n\nThe elemental **lumped mass matrix** is obtained by summing the rows of the consistent mass matrix and placing the sums on the diagonal (row-sum lumping):\n$$\n\\mathbf{M}^e_{\\mathrm{lump}} = \\text{diag}\\left(\\frac{h}{6}(2+1), \\frac{h}{6}(1+2)\\right) = \\frac{h}{2} \\begin{pmatrix} 1  0 \\\\ 0  1 \\end{pmatrix}\n$$\n\n### 2. Global Assembly and Semi-Discrete Equations of Motion\n\nFor an infinite, uniform mesh, we can write the equation of motion for a representative node $j$ by assembling contributions from the two adjacent elements: element $(j-1, j)$ and element $(j, j+1)$.\n\nThe stiffness term for node $j$ is:\n$$\n(\\mathbf{K} \\mathbf{u})_j = \\left(\\frac{1}{h}(u_j - u_{j-1})\\right) + \\left(\\frac{1}{h}(u_j - u_{j+1})\\right) = \\frac{1}{h}(-u_{j-1} + 2u_j - u_{j+1})\n$$\n\nThe mass term depends on the chosen scheme:\nFor the **consistent mass matrix**:\n$$\n(\\mathbf{M}_{\\mathrm{cons}} \\ddot{\\mathbf{u}})_j = \\left(\\frac{h}{6}(\\ddot{u}_{j-1} + 2\\ddot{u}_j)\\right) + \\left(\\frac{h}{6}(2\\ddot{u}_j + \\ddot{u}_{j+1})\\right) = \\frac{h}{6}(\\ddot{u}_{j-1} + 4\\ddot{u}_j + \\ddot{u}_{j+1})\n$$\nThe equation of motion is:\n$$\n\\frac{h}{6}(\\ddot{u}_{j-1} + 4\\ddot{u}_j + \\ddot{u}_{j+1}) + \\frac{c^2}{h}(-u_{j-1} + 2u_j - u_{j+1}) = 0\n$$\n\nFor the **lumped mass matrix**:\n$$\n(\\mathbf{M}_{\\mathrm{lump}} \\ddot{\\mathbf{u}})_j = \\left(\\frac{h}{2}\\ddot{u}_j\\right) + \\left(\\frac{h}{2}\\ddot{u}_j\\right) = h\\ddot{u}_j\n$$\nThe equation of motion is:\n$$\nh\\ddot{u}_j + \\frac{c^2}{h}(-u_{j-1} + 2u_j - u_{j+1}) = 0\n$$\n\n### 3. Dispersion Analysis\n\nWe seek a Bloch-Floquet plane wave solution of the form $u_j(t) = A e^{i(\\kappa x_j - \\omega t)}$, where $x_j = jh$. Substituting $u_j(t) = e^{i(qj - \\omega t)}$ with the nondimensional wavenumber $q = \\kappa h$, we have:\n$u_{j\\pm 1} = u_j e^{\\pm iq}$ and $\\ddot{u}_j = -\\omega^2 u_j$.\n\nFor the **consistent mass** scheme, substituting into its equation of motion yields:\n$$\n-\\omega^2 \\frac{h}{6}(e^{-iq} + 4 + e^{iq}) + \\frac{c^2}{h}(-e^{-iq} + 2 - e^{iq}) = 0\n$$\n$$\n-\\omega^2 \\frac{h}{6}(2\\cos(q) + 4) + \\frac{c^2}{h}(2 - 2\\cos(q)) = 0\n$$\nSolving for $\\omega^2$ gives the dispersion relation:\n$$\n\\omega^2_{\\mathrm{cons}}(q) = \\frac{6c^2}{h^2} \\frac{1 - \\cos(q)}{2 + \\cos(q)}\n$$\n\nFor the **lumped mass** scheme, the substitution yields:\n$$\n-h\\omega^2 + \\frac{c^2}{h}(-e^{-iq} + 2 - e^{iq}) = 0\n$$\n$$\n-h\\omega^2 + \\frac{c^2}{h}(2 - 2\\cos(q)) = 0\n$$\nSolving for $\\omega^2$ gives the dispersion relation:\n$$\n\\omega^2_{\\mathrm{lump}}(q) = \\frac{2c^2}{h^2}(1 - \\cos(q))\n$$\n\n### 4. Phase Velocity Ratio and Assembly-Induced Shift\n\nThe discrete phase velocity is defined as $c_{\\mathrm{d}}(q) = \\omega(q) / \\kappa$. Using $q = \\kappa h$ and setting the analytical wave speed $c=1$, the nondimensional phase velocity ratio is $c_{\\mathrm{d}}(q)/c = c_{\\mathrm{d}}(q) = \\omega(q) h / q$.\n\nFor the **consistent mass** scheme:\n$$\n\\frac{c_{\\mathrm{d,cons}}(q)}{c} = \\frac{h}{q} \\sqrt{\\frac{6}{h^2} \\frac{1 - \\cos(q)}{2 + \\cos(q)}} = \\frac{1}{q} \\sqrt{6 \\frac{2\\sin^2(q/2)}{2 + \\cos(q)}} = \\frac{2|\\sin(q/2)|}{q} \\sqrt{\\frac{3}{2 + \\cos(q)}}\n$$\nSince $q \\in (0, \\pi)$, $\\sin(q/2) > 0$. We can write this using the sinc function $\\text{sinc}(x) = \\sin(x)/x$:\n$$\n\\frac{c_{\\mathrm{d,cons}}(q)}{c} = \\frac{\\sin(q/2)}{q/2} \\sqrt{\\frac{3}{2 + \\cos(q)}}\n$$\n\nFor the **lumped mass** scheme:\n$$\n\\frac{c_{\\mathrm{d,lump}}(q)}{c} = \\frac{h}{q} \\sqrt{\\frac{2}{h^2}(1 - \\cos(q))} = \\frac{h}{q} \\frac{1}{h} \\sqrt{4\\sin^2(q/2)} = \\frac{2|\\sin(q/2)|}{q} = \\frac{\\sin(q/2)}{q/2}\n$$\n\nThe assembly-induced shift $\\Delta(q)$ is the difference between these two ratios:\n$$\n\\Delta(q) = \\frac{c_{\\mathrm{d,cons}}(q)}{c} - \\frac{c_{\\mathrm{d,lump}}(q)}{c} = \\frac{\\sin(q/2)}{q/2} \\left[ \\sqrt{\\frac{3}{2 + \\cos(q)}} - 1 \\right]\n$$\n\nFor the long-wavelength limit ($q \\to 0$), both phase velocity ratios approach $1$, as expected for a consistent numerical method. We can see this using $\\lim_{x\\to0} \\sin(x)/x = 1$ and $\\cos(0)=1$:\n$$\n\\lim_{q\\to 0} \\Delta(q) = \\left(\\lim_{q\\to 0} \\frac{\\sin(q/2)}{q/2}\\right) \\left[ \\sqrt{\\frac{3}{2 + \\cos(0)}} - 1 \\right] = 1 \\cdot \\left[ \\sqrt{\\frac{3}{3}} - 1 \\right] = 0\n$$\nThus, $\\Delta(0) = 0$. For all $q \\in (0, \\pi)$, it can be shown that $1 > \\cos(q)$, which implies $\\sqrt{3/(2+\\cos q)} > 1$, and therefore $\\Delta(q) > 0$. The maximum absolute shift is thus the maximum value of $\\Delta(q)$ on the interval $(0, \\pi)$, which must be found numerically as requested.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the assembly-induced phase velocity shift for FEM\n    discretization of the 1D wave equation.\n    \"\"\"\n\n    def delta_q(q_values):\n        \"\"\"\n        Calculates the assembly-induced shift Delta(q) for an array of\n        nondimensional wavenumbers q.\n\n        The formula is Delta(q) = sinc(q/2) * [sqrt(3 / (2 + cos(q))) - 1],\n        where sinc(x) = sin(x)/x.\n        \n        Args:\n            q_values (np.ndarray): An array of nondimensional wavenumbers.\n\n        Returns:\n            np.ndarray: The corresponding values of Delta(q).\n        \"\"\"\n        # np.sinc(x) computes sin(pi*x)/(pi*x). To get sin(y)/y, we need to pass\n        # y/pi as the argument. Here, y = q/2.\n        # This handles the case q=0 correctly, where np.sinc(0) returning 1.\n        q_arr = np.asarray(q_values)\n        sinc_term = np.sinc(q_arr / (2 * np.pi))\n        \n        # The term inside the radical\n        radicand = 3 / (2 + np.cos(q_arr))\n        sqrt_term = np.sqrt(radicand)\n        \n        return sinc_term * (sqrt_term - 1)\n\n    # Define the test cases from the problem statement.\n    test_suite_q = [\n        0.0,\n        0.1,\n        np.pi / 2,\n        np.pi - 1e-6\n    ]\n\n    # Calculate Delta(q) for the specified test cases\n    results = list(delta_q(test_suite_q))\n\n    # Compute the maximum absolute assembly-induced shift\n    # The problem defines q in the open interval (0, pi).\n    # Delta(q) > 0 for q in (0, pi) and Delta(0) = 0.\n    # The derivative Delta'(pi) is negative, so the max is not at pi.\n    # Therefore, searching over the closed interval [0, pi] is sufficient to find\n    # the maximum in the open interval (0, pi).\n    N = 20001\n    q_grid = np.linspace(0, np.pi, N)\n    \n    delta_values_on_grid = delta_q(q_grid)\n    \n    # Since Delta(q) >= 0 on [0, pi], max|Delta(q)| = max(Delta(q))\n    max_abs_shift = np.max(delta_values_on_grid)\n    results.append(max_abs_shift)\n    \n    # Final print statement in the exact required format.\n    print(f\"[{','.join(f'{r:.15f}' for r in results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "This advanced practice addresses a subtle but critical challenge in assembling the stiffness matrix for realistic geophysical models involving anisotropic materials and non-ideal mesh geometries. You will investigate how improper handling of geometric transformations during assembly can lead to a non-symmetric matrix, violating the symmetry of the underlying physical operator. By diagnosing and correcting this implementation error, you will gain insight into preserving the fundamental mathematical integrity of the finite element model, a vital skill for developing robust simulation codes. ",
            "id": "3600339",
            "problem": "You are to study the global assembly of the Finite Element Method (FEM) stiffness matrix for three-dimensional anisotropic diffusion as used in mantle convection modeling, with a focus on assembly-induced asymmetry. Start from the strong form of steady diffusion for a scalar field $T(\\mathbf{x})$ in a domain $\\Omega \\subset \\mathbb{R}^3$ with a symmetric positive definite conductivity tensor $\\mathbf{A}(\\mathbf{x})$, given by $-\\nabla \\cdot (\\mathbf{A} \\nabla T) = 0$. The Galerkin weak form is: find $T \\in V$ such that for all test functions $v \\in V_0$,\n$$\na(T,v) = \\int_{\\Omega} (\\nabla v)^{\\top} \\mathbf{A}(\\mathbf{x}) \\nabla T \\, d\\mathbf{x} = 0,\n$$\nwhere $V$ is an appropriate Sobolev space and $V_0$ accounts for Dirichlet boundary conditions. The bilinear form $a(\\cdot,\\cdot)$ is symmetric because $\\mathbf{A}(\\mathbf{x})$ is symmetric positive definite. In an isoparametric trilinear hexahedral element, the mapping $\\mathbf{x}(\\boldsymbol{\\xi})$ from the reference element $\\hat{K} = [-1,1]^3$ to the physical element $K$ is defined by the same shape functions as the solution interpolation. Denote by $\\mathbf{J} = \\partial \\mathbf{x}/\\partial \\boldsymbol{\\xi}$ the Jacobian of the mapping. The gradient of a shape function $N_i$ in physical coordinates is obtained by the Piola transformation $\\nabla_{\\mathbf{x}} N_i = \\mathbf{J}^{-T} \\nabla_{\\boldsymbol{\\xi}} N_i$. With exact quadrature and consistent mapping, the element stiffness tensor is\n$$\n\\mathbf{K}^{(e)} = \\int_{\\hat{K}} \\mathbf{B}(\\boldsymbol{\\xi})^{\\top} \\mathbf{A}(\\mathbf{x}(\\boldsymbol{\\xi})) \\, \\mathbf{B}(\\boldsymbol{\\xi}) \\, \\det(\\mathbf{J}(\\boldsymbol{\\xi})) \\, d\\boldsymbol{\\xi},\n$$\nwhere $\\mathbf{B}(\\boldsymbol{\\xi})$ has as its columns the physical gradients of the shape functions. This expression is symmetric by construction. However, in practice, non-affine mappings and implementation inconsistencies can produce element stiffness tensors that are not symmetric when an incorrect pullback is used on one of the gradient factors during assembly.\n\nYour task is to implement a program that:\n- Constructs element stiffness matrices for trilinear hexahedra using Gaussian quadrature and an anisotropic, symmetric positive definite conductivity tensor.\n- Demonstrates that for an affine mapping and consistent use of $\\mathbf{J}^{-1}$ in the gradient transformation, the assembled stiffness matrix is symmetric.\n- Demonstrates that for a distorted (non-affine) mapping, if one incorrectly applies $\\mathbf{J}^{-T}$ to the left gradient factor and $\\mathbf{J}^{-1}$ to the right gradient factor in the element integrand, the resulting element stiffness matrix is non-symmetric.\n- Detects and quantifies the asymmetry by computing the Frobenius norm of the skew-symmetric part.\n- Corrects the asymmetry at the global level by replacing $\\mathbf{K}$ with $\\tfrac{1}{2}(\\mathbf{K} + \\mathbf{K}^{\\top})$ and verifies symmetry after correction.\n- Verifies positive definiteness of the corrected, Dirichlet-reduced global matrix for a specified set of Dirichlet nodes.\n\nUse the following fundamental bases and facts:\n- The symmetric positive definiteness of $\\mathbf{A}$ implies that the continuous bilinear form $a(\\cdot,\\cdot)$ is symmetric and coercive under appropriate boundary conditions.\n- In an isoparametric element with mapping $\\mathbf{x}(\\boldsymbol{\\xi})$, the correct pullback of gradients is $\\nabla_{\\mathbf{x}} N = \\mathbf{J}^{-T} \\nabla_{\\boldsymbol{\\xi}} N$, which, when implemented consistently in both left and right gradient factors of the element integrand, yields a symmetric element tensor.\n- The Gaussian quadrature rule with $2\\times 2\\times 2$ points is sufficient to integrate the trilinear hexahedral element stiffness exactly when $\\mathbf{A}$ is constant within the element and the mapping is affine. For non-affine trilinear mappings, it provides a standard consistent approximation.\n\nDefine the anisotropic conductivity tensor as constant within each element and given by\n$$\n\\mathbf{A} = \\mathbf{R} \\, \\mathrm{diag}(k_1,k_2,k_3) \\, \\mathbf{R}^{\\top},\n$$\nwith $k_1 = 6.0$, $k_2 = 1.0$, $k_3 = 0.5$. The rotation $\\mathbf{R}$ is the composition $\\mathbf{R} = \\mathbf{R}_z(\\theta_z)\\mathbf{R}_y(\\theta_y)\\mathbf{R}_x(\\theta_x)$, using angles $\\theta_x = -0.2$, $\\theta_y = 0.5$, $\\theta_z = 0.3$ in radians.\n\nUse trilinear shape functions on the reference hexahedron with the standard node ordering corresponding to the corners at $(\\xi_i,\\eta_i,\\zeta_i) \\in \\{-1,1\\}^3$:\n- $(\\xi_1,\\eta_1,\\zeta_1) = (-1,-1,-1)$,\n- $(\\xi_2,\\eta_2,\\zeta_2) = (1,-1,-1)$,\n- $(\\xi_3,\\eta_3,\\zeta_3) = (1,1,-1)$,\n- $(\\xi_4,\\eta_4,\\zeta_4) = (-1,1,-1)$,\n- $(\\xi_5,\\eta_5,\\zeta_5) = (-1,-1,1)$,\n- $(\\xi_6,\\eta_6,\\zeta_6) = (1,-1,1)$,\n- $(\\xi_7,\\eta_7,\\zeta_7) = (1,1,1)$,\n- $(\\xi_8,\\eta_8,\\zeta_8) = (-1,1,1)$.\n\nAdopt the $2\\times 2\\times 2$ Gauss quadrature with abscissae $\\pm 1/\\sqrt{3}$ and weights $1$ in each direction.\n\nTest suite. You must implement and evaluate the following three test cases and one verification:\n\n- Case A (baseline affine, consistent):\n  - Physical node coordinates for a single element (unit cube):\n    - $\\mathbf{X}_1 = (0,0,0)$, $\\mathbf{X}_2 = (1,0,0)$, $\\mathbf{X}_3 = (1,1,0)$, $\\mathbf{X}_4 = (0,1,0)$,\n    - $\\mathbf{X}_5 = (0,0,1)$, $\\mathbf{X}_6 = (1,0,1)$, $\\mathbf{X}_7 = (1,1,1)$, $\\mathbf{X}_8 = (0,1,1)$.\n  - Assemble the element stiffness with the correct gradient pullback on both sides of the integrand. Assemble globally (single element) and compute the Frobenius norm\n    $$\n    s_A = \\left\\| \\mathbf{K} - \\mathbf{K}^{\\top} \\right\\|_F.\n    $$\n    Return $s_A$ as a floating-point number.\n\n- Case B (distorted mapping, broken assembly to induce asymmetry):\n  - Physical node coordinates for a single distorted element:\n    - $\\mathbf{X}_1 = (0,0,0)$, $\\mathbf{X}_2 = (1,0,0)$, $\\mathbf{X}_3 = (1,1.02,0)$, $\\mathbf{X}_4 = (0,1,0)$,\n    - $\\mathbf{X}_5 = (0,0,1)$, $\\mathbf{X}_6 = (1.03,0,1)$, $\\mathbf{X}_7 = (1.05,0.95,1.02)$, $\\mathbf{X}_8 = (0,1.01,1)$.\n  - Assemble the element stiffness using an inconsistent integrand of the form\n    $$\n    \\tilde{\\mathbf{K}}^{(e)} = \\int_{\\hat{K}} \\tilde{\\mathbf{B}}(\\boldsymbol{\\xi})^{\\top} \\mathbf{A} \\, \\mathbf{B}(\\boldsymbol{\\xi}) \\, \\det(\\mathbf{J}(\\boldsymbol{\\xi})) \\, d\\boldsymbol{\\xi},\n    $$\n    where $\\mathbf{B}$ uses the correct pullback $\\nabla_{\\mathbf{x}} N = \\mathbf{J}^{-T}\\nabla_{\\boldsymbol{\\xi}} N$ and $\\tilde{\\mathbf{B}}$ uses the incorrect pullback $\\nabla_{\\mathbf{x}} N = \\mathbf{J}^{-1}\\nabla_{\\boldsymbol{\\xi}} N$ applied to the left gradient factor. Assemble globally (single element) and compute\n    $$\n    s_B = \\left\\| \\tilde{\\mathbf{K}} - \\tilde{\\mathbf{K}}^{\\top} \\right\\|_F.\n    $$\n    Return $s_B$ as a floating-point number.\n\n- Case C (symmetry correction):\n  - From Case B, define the corrected global stiffness as\n    $$\n    \\mathbf{K}_{\\mathrm{corr}} = \\tfrac{1}{2}\\left(\\tilde{\\mathbf{K}} + \\tilde{\\mathbf{K}}^{\\top}\\right).\n    $$\n  - Compute\n    $$\n    s_C = \\left\\| \\mathbf{K}_{\\mathrm{corr}} - \\mathbf{K}_{\\mathrm{corr}}^{\\top} \\right\\|_F.\n    $$\n    Return $s_C$ as a floating-point number.\n\n- Verification D (positive definiteness under Dirichlet reduction):\n  - Impose homogeneous Dirichlet conditions on the face with minimal $x$-coordinate nodes of the distorted element from Case B, that is, all nodes $\\mathbf{X}_i$ with $x_i = \\min_j x_j$.\n  - Extract the free-free submatrix $\\mathbf{K}_{\\mathrm{ff}}$ from $\\mathbf{K}_{\\mathrm{corr}}$ corresponding to the remaining unconstrained nodes.\n  - Determine whether all eigenvalues of $\\mathbf{K}_{\\mathrm{ff}}$ are strictly positive (greater than a numerical tolerance of $10^{-10}$), and return a boolean value $b_D$ that is true if and only if $\\mathbf{K}_{\\mathrm{ff}}$ is positive definite.\n\nNumerical and implementation requirements:\n- All computations are dimensionless; do not include physical units in the output.\n- Implement trilinear shape functions and their derivatives on the reference element. Use the isoparametric mapping $\\mathbf{x}(\\boldsymbol{\\xi}) = \\sum_{i=1}^{8} N_i(\\boldsymbol{\\xi}) \\, \\mathbf{X}_i$ and $\\mathbf{J} = \\sum_{i=1}^{8} \\mathbf{X}_i \\, (\\nabla_{\\boldsymbol{\\xi}} N_i)^{\\top}$ at quadrature points.\n- Use the Gaussian quadrature points at $\\xi,\\eta,\\zeta \\in \\{-1/\\sqrt{3}, 1/\\sqrt{3}\\}$, with weights $1$.\n- For symmetry detection, use the Frobenius norm $\\| \\cdot \\|_F$.\n- For positive definiteness, use dense eigenvalue computation of $\\mathbf{K}_{\\mathrm{ff}}$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets in the order $[s_A, s_B, s_C, b_D]$. The first three entries must be floating-point numbers, and the fourth entry must be a boolean literal. For example, a valid output would look like $[0.0,0.1234,0.0,True]$.",
            "solution": "We begin from the strong form $-\\nabla \\cdot (\\mathbf{A} \\nabla T) = 0$ with symmetric positive definite $\\mathbf{A}$. The standard Galerkin weak form over $\\Omega$ is $a(T,v) = \\int_{\\Omega} (\\nabla v)^{\\top} \\mathbf{A} \\, \\nabla T \\, d\\mathbf{x}$. Because $\\mathbf{A}$ is symmetric positive definite and the gradient is linear, the bilinear form $a(\\cdot,\\cdot)$ is symmetric. This implies that, when discretized consistently, the global stiffness matrix $\\mathbf{K}$ assembled from element contributions should be symmetric: $\\mathbf{K} = \\mathbf{K}^{\\top}$.\n\nFor trilinear isoparametric hexahedra, we map the reference element $\\hat{K} = [-1,1]^3$ to a physical element $K$ using the same shape functions $N_i(\\boldsymbol{\\xi})$ to interpolate the node coordinates: $\\mathbf{x}(\\boldsymbol{\\xi}) = \\sum_{i=1}^{8} N_i(\\boldsymbol{\\xi}) \\mathbf{X}_i$. The Jacobian matrix is $\\mathbf{J}(\\boldsymbol{\\xi}) = \\frac{\\partial \\mathbf{x}}{\\partial \\boldsymbol{\\xi}} = \\sum_{i=1}^{8} \\mathbf{X}_i (\\nabla_{\\boldsymbol{\\xi}} N_i(\\boldsymbol{\\xi}))^{\\top}$. The correct physical gradients of shape functions are obtained via the Piola transformation $\\nabla_{\\mathbf{x}} N_i = \\mathbf{J}^{-T} \\nabla_{\\boldsymbol{\\xi}} N_i$, or, equivalently for row vectors, $(\\nabla_{\\mathbf{x}} N_i)^{\\top} = \\mathbf{J}^{-1} (\\nabla_{\\boldsymbol{\\xi}} N_i)^{\\top}$.\n\nThe consistent element stiffness is\n$$\n\\mathbf{K}^{(e)} = \\int_{\\hat{K}} \\mathbf{B}(\\boldsymbol{\\xi})^{\\top} \\, \\mathbf{A} \\, \\mathbf{B}(\\boldsymbol{\\xi}) \\, \\det(\\mathbf{J}(\\boldsymbol{\\xi})) \\, d\\boldsymbol{\\xi},\n$$\nwhich is symmetric because it is of the form $\\int \\mathbf{C}^{\\top} \\mathbf{A} \\mathbf{C} \\, dV$ with $\\mathbf{A} = \\mathbf{A}^{\\top}$.\n\nIn practice, non-symmetry can arise if the gradient pullback is applied inconsistently to the two factors of the bilinear form when evaluated numerically. An example of such an inconsistency is to compute the left gradient factor using $\\mathbf{J}^{-1}$ (incorrect for column-vector gradients) and the right gradient factor using $\\mathbf{J}^{-T}$ (correct). This yields an element-level integrand of the form $\\tilde{\\mathbf{B}}^{\\top} \\mathbf{A} \\mathbf{B}$, where $\\tilde{\\mathbf{B}} \\neq \\mathbf{B}$, which does not produce a symmetric tensor in general because $(\\tilde{\\mathbf{B}}^{\\top} \\mathbf{A} \\mathbf{B})^{\\top} = \\mathbf{B}^{\\top} \\mathbf{A} \\tilde{\\mathbf{B}} \\neq \\tilde{\\mathbf{B}}^{\\top} \\mathbf{A} \\mathbf{B}$ unless $\\tilde{\\mathbf{B}} = \\mathbf{B}$.\n\nAlgorithmic design:\n- Implement the trilinear shape functions $N_i(\\xi,\\eta,\\zeta) = \\tfrac{1}{8} (1+\\xi \\xi_i)(1+\\eta \\eta_i)(1+\\zeta \\zeta_i)$ and their reference gradients $\\nabla_{\\boldsymbol{\\xi}} N_i$ using the standard node signs $(\\xi_i,\\eta_i,\\zeta_i) \\in \\{-1,1\\}^3$.\n- For a given set of physical node coordinates $\\{\\mathbf{X}_i\\}_{i=1}^8$, compute $\\mathbf{J}$ and $\\det(\\mathbf{J})$ at each Gauss point $(\\xi,\\eta,\\zeta)$ with weights $w=1$. Check that $\\det(\\mathbf{J})0$ to avoid inverted elements.\n- Compute two versions of the gradient matrices:\n  - Consistent: $\\mathbf{B}$ has columns $\\nabla_{\\mathbf{x}} N_i = (\\nabla_{\\boldsymbol{\\xi}} N_i)^{\\top} \\mathbf{J}^{-T}$ or row-wise $\\nabla_{\\mathbf{x}} N_i = \\nabla_{\\boldsymbol{\\xi}} N_i \\, \\mathbf{J}^{-1}$.\n  - Broken: $\\tilde{\\mathbf{B}}$ is computed by incorrectly using $\\nabla_{\\mathbf{x}} N_i = \\nabla_{\\boldsymbol{\\xi}} N_i \\, \\mathbf{J}^{-T}$ for the left factor, while the right factor uses the correct $\\mathbf{B}$.\n- Evaluate the element matrices by Gaussian quadrature:\n  - Consistent element: $\\mathbf{K}^{(e)} \\approx \\sum_{q} w_q \\, \\det(\\mathbf{J}_q) \\, \\mathbf{B}_q^{\\top} \\, \\mathbf{A} \\, \\mathbf{B}_q$.\n  - Broken element: $\\tilde{\\mathbf{K}}^{(e)} \\approx \\sum_{q} w_q \\, \\det(\\mathbf{J}_q) \\, \\tilde{\\mathbf{B}}_q^{\\top} \\, \\mathbf{A} \\, \\mathbf{B}_q$.\n- Assemble globally by summing the element contributions. With one element, the global matrix equals the element matrix.\n- Detect asymmetry by computing the Frobenius norm of the skew-symmetric part: $s = \\|\\mathbf{K} - \\mathbf{K}^{\\top}\\|_F$.\n- Correct asymmetry by symmetrization: $\\mathbf{K}_{\\mathrm{corr}} = \\tfrac{1}{2}(\\mathbf{K} + \\mathbf{K}^{\\top})$ and recompute the asymmetry measure $s_C$.\n- For the positive definiteness check, apply homogeneous Dirichlet conditions on all nodes whose $x$-coordinate equals the minimum $x$ among the element nodes (the plane $x = \\min_i x_i$). Extract the free-free submatrix $\\mathbf{K}_{\\mathrm{ff}}$ from $\\mathbf{K}_{\\mathrm{corr}}$ and compute its eigenvalues. If $\\min \\lambda(\\mathbf{K}_{\\mathrm{ff}})  10^{-10}$, report true; otherwise, false.\n\nJustification of tests:\n- Case A uses an affine mapping and consistent gradient pullback. Because $\\mathbf{B}$ is computed consistently, each integrand $\\mathbf{B}^{\\top} \\mathbf{A} \\mathbf{B}$ is symmetric, so $s_A$ should be on the order of roundoff, demonstrating a correct symmetric assembly.\n- Case B uses a distorted mapping and the broken left-right gradient application, so $s_B$ should be significantly larger than roundoff, demonstrating detectable asymmetry due to inconsistent implementation.\n- Case C corrects the asymmetry by projection onto the symmetric part, so $s_C$ should be near zero (roundoff), restoring the expected symmetry of the diffusion operator.\n- Verification D demonstrates that, after correction and with appropriate Dirichlet reduction, the matrix is not only symmetric but also positive definite, consistent with the coercivity of the bilinear form under Dirichlet boundary conditions.\n\nThe anisotropic conductivity tensor is constructed as $\\mathbf{A} = \\mathbf{R} \\, \\mathrm{diag}(6.0, 1.0, 0.5) \\, \\mathbf{R}^{\\top}$ where $\\mathbf{R}$ is the rotation about the $x$-, $y$-, and $z$-axes by angles $-0.2$, $0.5$, and $0.3$ radians, respectively. This ensures a non-trivial, rotated anisotropy typical of mantle fabrics.\n\nThe program should output a single line in the format $[s_A,s_B,s_C,b_D]$ as specified, with the first three entries being floating-point numbers and the last a boolean literal.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef rotation_matrix_xyz(theta_x, theta_y, theta_z):\n    cx, sx = np.cos(theta_x), np.sin(theta_x)\n    cy, sy = np.cos(theta_y), np.sin(theta_y)\n    cz, sz = np.cos(theta_z), np.sin(theta_z)\n    Rx = np.array([[1.0, 0.0, 0.0],\n                   [0.0, cx, -sx],\n                   [0.0, sx, cx]])\n    Ry = np.array([[cy, 0.0, sy],\n                   [0.0, 1.0, 0.0],\n                   [-sy, 0.0, cy]])\n    Rz = np.array([[cz, -sz, 0.0],\n                   [sz, cz, 0.0],\n                   [0.0, 0.0, 1.0]])\n    # Composition R = Rz * Ry * Rx\n    return Rz @ Ry @ Rx\n\ndef quad_points_2x2x2():\n    g = 1.0/np.sqrt(3.0)\n    pts = []\n    for xi in (-g, g):\n        for eta in (-g, g):\n            for zeta in (-g, g):\n                pts.append((xi, eta, zeta, 1.0))\n    return pts\n\ndef shape_functions_Q1_and_grads(xi, eta, zeta):\n    # Node signs for reference hexahedron\n    signs = np.array([\n        [-1, -1, -1],\n        [ 1, -1, -1],\n        [ 1,  1, -1],\n        [-1,  1, -1],\n        [-1, -1,  1],\n        [ 1, -1,  1],\n        [ 1,  1,  1],\n        [-1,  1,  1],\n    ], dtype=float)\n    N = np.zeros(8, dtype=float)\n    dN_dxi = np.zeros((8, 3), dtype=float)\n    for i in range(8):\n        sx, sy, sz = signs[i]\n        N[i] = 0.125 * (1 + sx*xi) * (1 + sy*eta) * (1 + sz*zeta)\n        dN_dxi[i, 0] = 0.125 * sx * (1 + sy*eta) * (1 + sz*zeta)\n        dN_dxi[i, 1] = 0.125 * sy * (1 + sx*xi) * (1 + sz*zeta)\n        dN_dxi[i, 2] = 0.125 * sz * (1 + sx*xi) * (1 + sy*eta)\n    return N, dN_dxi\n\ndef jacobian_and_grads(phys_nodes, dN_dxi):\n    # phys_nodes: (8,3), dN_dxi: (8,3)\n    # J = X^T * dN_dxi\n    J = phys_nodes.T @ dN_dxi  # (3,8) @ (8,3) -> (3,3)\n    detJ = np.linalg.det(J)\n    invJ = np.linalg.inv(J)\n    # Correct physical gradients: grad_x N = dN_dxi @ invJ\n    dN_dx_correct = dN_dxi @ invJ\n    # Wrong/incorrect physical gradients for left factor: using invJ.T\n    dN_dx_wrong = dN_dxi @ invJ.T\n    return J, detJ, dN_dx_correct, dN_dx_wrong\n\ndef element_stiffness(phys_nodes, A, mode=\"consistent\"):\n    # mode: \"consistent\" -> K = sum B^T A B\n    #       \"broken\"     -> K = sum B_wrong^T A B_right (asymmetric)\n    K = np.zeros((8,8), dtype=float)\n    for xi, eta, zeta, w in quad_points_2x2x2():\n        N, dN_dxi = shape_functions_Q1_and_grads(xi, eta, zeta)\n        J, detJ, dN_dx_correct, dN_dx_wrong = jacobian_and_grads(phys_nodes, dN_dxi)\n        if detJ = 0:\n            raise ValueError(\"Non-positive Jacobian determinant encountered.\")\n        # Build B matrices: 3x8 with columns grad N_i\n        B_right = dN_dx_correct.T  # shape (3,8)\n        if mode == \"consistent\":\n            integrand = B_right.T @ A @ B_right  # (8,3)(3,3)(3,8) -> (8,8), symmetric\n        elif mode == \"broken\":\n            B_left_wrong = dN_dx_wrong.T  # (3,8)\n            integrand = B_left_wrong.T @ A @ B_right  # (8,3)(3,3)(3,8) -> (8,8), not symmetric\n        else:\n            raise ValueError(\"Unknown mode.\")\n        K += w * detJ * integrand\n    return K\n\ndef frobenius_norm(M):\n    return np.sqrt(np.sum(M*M))\n\ndef solve():\n    # Define anisotropic conductivity tensor A\n    R = rotation_matrix_xyz(theta_x=-0.2, theta_y=0.5, theta_z=0.3)\n    k = np.diag([6.0, 1.0, 0.5])\n    A = R @ k @ R.T\n\n    # Case A: affine unit cube\n    cube_nodes = np.array([\n        [0.0, 0.0, 0.0],  # X1\n        [1.0, 0.0, 0.0],  # X2\n        [1.0, 1.0, 0.0],  # X3\n        [0.0, 1.0, 0.0],  # X4\n        [0.0, 0.0, 1.0],  # X5\n        [1.0, 0.0, 1.0],  # X6\n        [1.0, 1.0, 1.0],  # X7\n        [0.0, 1.0, 1.0],  # X8\n    ], dtype=float)\n    K_A = element_stiffness(cube_nodes, A, mode=\"consistent\")\n    s_A = frobenius_norm(K_A - K_A.T)\n\n    # Case B: distorted element, broken assembly\n    distorted_nodes = np.array([\n        [0.0,   0.0,  0.0],   # X1\n        [1.0,   0.0,  0.0],   # X2\n        [1.0,   1.02, 0.0],   # X3\n        [0.0,   1.0,  0.0],   # X4\n        [0.0,   0.0,  1.0],   # X5\n        [1.03,  0.0,  1.0],   # X6\n        [1.05,  0.95, 1.02],  # X7\n        [0.0,   1.01, 1.0],   # X8\n    ], dtype=float)\n    K_B = element_stiffness(distorted_nodes, A, mode=\"broken\")\n    s_B = frobenius_norm(K_B - K_B.T)\n\n    # Case C: symmetrization correction\n    K_corr = 0.5 * (K_B + K_B.T)\n    s_C = frobenius_norm(K_corr - K_corr.T)\n\n    # Verification D: positive definiteness under Dirichlet reduction on min-x face\n    x_coords = distorted_nodes[:, 0]\n    xmin = np.min(x_coords)\n    dirichlet_nodes = np.where(np.abs(x_coords - xmin)  1e-12)[0].tolist()\n    all_nodes = list(range(8))\n    free_nodes = [i for i in all_nodes if i not in dirichlet_nodes]\n    # Extract free-free block\n    if len(free_nodes) == 0:\n        # Degenerate case: no free nodes, treat as vacuously positive definite\n        b_D = True\n    else:\n        K_ff = K_corr[np.ix_(free_nodes, free_nodes)]\n        # Check symmetry just in case\n        K_ff = 0.5 * (K_ff + K_ff.T)\n        # Eigenvalues\n        eigvals = np.linalg.eigvalsh(K_ff)\n        b_D = bool(np.min(eigvals) > 1e-10)\n\n    results = [s_A, s_B, s_C, b_D]\n    # Final print statement in the exact required format.\n    print(f\"[{results[0]},{results[1]},{results[2]},{results[3]}]\")\n\nsolve()\n```"
        }
    ]
}