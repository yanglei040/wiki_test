{
    "hands_on_practices": [
        {
            "introduction": "Numerical stability is the foremost requirement for any explicit time-stepping simulation; an unstable scheme produces physically meaningless results that grow without bound. This practice delves into the core theoretical foundation of stability for staggered-grid methods by deriving the celebrated Courant-Friedrichs-Lewy (CFL) condition. You will perform a von Neumann stability analysis to determine the maximum allowable time step, $\\Delta t$, for a given grid spacing, $h$, and wave speed, $c$, ensuring that your simulations remain well-behaved and physically realistic .",
            "id": "3615279",
            "problem": "Consider the constant-coefficient acoustic system in two spatial dimensions,\n$$\n\\frac{\\partial p}{\\partial t} \\;=\\; -\\kappa\\, \\nabla \\cdot \\boldsymbol{v}, \n\\qquad\n\\rho\\,\\frac{\\partial \\boldsymbol{v}}{\\partial t} \\;=\\; -\\nabla p,\n$$\nwhere $p$ is pressure, $\\boldsymbol{v}=(v_{x},v_{y})$ is particle velocity, $\\rho$ is density, and $\\kappa$ is bulk modulus, with wave speed $c=\\sqrt{\\kappa/\\rho}$. Discretize space on a uniform square grid of spacing $h$ using a standard staggered-grid arrangement: $p$ at cell centers $(i h,j h)$, $v_{x}$ at $( (i+\\tfrac{1}{2}) h, j h)$, and $v_{y}$ at $( i h, (j+\\tfrac{1}{2}) h)$. Discretize time with a leapfrog staggering: $p$ at integer times $t^{n}=n\\,\\Delta t$ and velocities at half-integer times $t^{n+\\tfrac{1}{2}}=(n+\\tfrac{1}{2})\\,\\Delta t$. Use second-order centered finite differences for spatial gradients and divergence:\n$$\nD_{x} p\\big|_{i+\\tfrac{1}{2},j} \\;=\\; \\frac{p_{i+1,j}-p_{i,j}}{h}, \n\\qquad\nD_{y} p\\big|_{i,j+\\tfrac{1}{2}} \\;=\\; \\frac{p_{i,j+1}-p_{i,j}}{h},\n$$\n$$\nD_{x}^{*} v_{x}\\big|_{i,j} \\;=\\; \\frac{v_{x,i+\\tfrac{1}{2},j}-v_{x,i-\\tfrac{1}{2},j}}{h}, \n\\qquad\nD_{y}^{*} v_{y}\\big|_{i,j} \\;=\\; \\frac{v_{y,i,j+\\tfrac{1}{2}}-v_{y,i,j-\\tfrac{1}{2}}}{h}.\n$$\nThe time-stepping scheme is\n$$\nv_{x}^{n+\\tfrac{1}{2}} \\;=\\; v_{x}^{n-\\tfrac{1}{2}} \\;-\\; \\frac{\\Delta t}{\\rho}\\, D_{x} p^{n}, \n\\qquad\nv_{y}^{n+\\tfrac{1}{2}} \\;=\\; v_{y}^{n-\\tfrac{1}{2}} \\;-\\; \\frac{\\Delta t}{\\rho}\\, D_{y} p^{n},\n$$\n$$\np^{n+1} \\;=\\; p^{n} \\;-\\; \\kappa\\, \\Delta t \\left( D_{x}^{*} v_{x}^{n+\\tfrac{1}{2}} + D_{y}^{*} v_{y}^{n+\\tfrac{1}{2}} \\right).\n$$\nPerform a von Neumann (Fourier) stability analysis by inserting plane-wave solutions of the form $\\exp\\!\\big(i(k_{x} i h + k_{y} j h)\\big)$ in space and $\\exp\\!\\big(i\\omega n \\Delta t\\big)$ in time, assuming periodicity. Derive the Courant-Friedrichs-Lewy (CFL) condition $C=\\dfrac{c_{\\max}\\,\\Delta t}{h} \\le C_{\\text{crit}}$ that guarantees stability for all spatial wavenumbers, and compute $C_{\\text{crit}}$ explicitly for the above second-order spatial differences on the staggered grid. Express the final value of $C_{\\text{crit}}$ as an exact real number with no units.",
            "solution": "The problem statement is a standard exercise in the numerical analysis of finite-difference schemes for wave propagation and is valid. It is scientifically grounded, well-posed, and objective, providing all necessary information to derive the stability condition.\n\nWe begin the von Neumann stability analysis for the given second-order staggered-grid finite-difference scheme. The scheme discretizes the 2D acoustic wave equations:\n$$\n\\frac{\\partial p}{\\partial t} = -\\kappa \\left( \\frac{\\partial v_x}{\\partial x} + \\frac{\\partial v_y}{\\partial y} \\right)\n$$\n$$\n\\rho \\frac{\\partial v_x}{\\partial t} = -\\frac{\\partial p}{\\partial x}, \\qquad \\rho \\frac{\\partial v_y}{\\partial t} = -\\frac{\\partial p}{\\partial y}\n$$\nThe analysis involves substituting plane-wave solutions (Fourier modes) into the discretized equations and determining the conditions under which these modes do not grow in amplitude over time.\n\nWe assume periodic plane-wave solutions for the pressure $p$ and velocity components $v_x, v_y$ on the staggered grid. The ansatz for each variable is defined at its respective grid location and time level:\n$$\np_{i,j}^{n} = \\hat{p}(t^n) \\, \\exp\\big( i(k_x i h + k_y j h) \\big)\n$$\n$$\nv_{x, i+\\frac{1}{2}, j}^{n \\pm \\frac{1}{2}} = \\hat{v}_x(t^{n \\pm \\frac{1}{2}}) \\, \\exp\\big( i(k_x (i+\\tfrac{1}{2}) h + k_y j h) \\big)\n$$\n$$\nv_{y, i, j+\\frac{1}{2}}^{n \\pm \\frac{1}{2}} = \\hat{v}_y(t^{n \\pm \\frac{1}{2}}) \\, \\exp\\big( i(k_x i h + k_y (j+\\tfrac{1}{2}) h) \\big)\n$$\nwhere $\\hat{p}$, $\\hat{v}_x$, and $\\hat{v}_y$ are the time-dependent Fourier amplitudes, $k_x$ and $k_y$ are the spatial wavenumbers, and $i, j, n$ are integer indices for space and time.\n\nNext, we transform the finite-difference operators into their Fourier space representations. For the gradient operator $D_x$ acting on $p$ at location $(i+\\frac{1}{2},j)$:\n$$\nD_x p_{i+\\frac{1}{2},j}^n = \\frac{p_{i+1,j}^n - p_{i,j}^n}{h} = \\frac{\\hat{p}^n}{h} \\left[ \\exp\\big(i(k_x(i+1)h + k_y j h)\\big) - \\exp\\big(i(k_x i h + k_y j h)\\big) \\right]\n$$\nFactoring out the plane-wave term at the target location $(i+\\frac{1}{2},j)$ gives:\n$$\nD_x p_{i+\\frac{1}{2},j}^n = \\frac{\\hat{p}^n}{h} \\exp\\big(i(k_x(i+\\tfrac{1}{2})h + k_y j h)\\big) \\left[ \\exp\\big(i\\frac{k_x h}{2}\\big) - \\exp\\big(-i\\frac{k_x h}{2}\\big) \\right] = \\hat{p}^n \\frac{2i}{h}\\sin\\left(\\frac{k_x h}{2}\\right) \\exp(\\dots)\n$$\nSimilarly, for the other operators:\n$$\nD_y p_{i,j+\\frac{1}{2}}^n \\rightarrow \\hat{p}^n \\frac{2i}{h}\\sin\\left(\\frac{k_y h}{2}\\right)\n$$\n$$\nD_x^* v_{x,i,j}^{n+\\frac{1}{2}} = \\frac{v_{x,i+\\frac{1}{2},j}^{n+\\frac{1}{2}} - v_{x,i-\\frac{1}{2},j}^{n+\\frac{1}{2}}}{h} \\rightarrow \\hat{v}_x^{n+\\frac{1}{2}} \\frac{2i}{h}\\sin\\left(\\frac{k_x h}{2}\\right)\n$$\n$$\nD_y^* v_{y,i,j}^{n+\\frac{1}{2}} = \\frac{v_{y,i,j+\\frac{1}{2}}^{n+\\frac{1}{2}} - v_{y,i,j-\\frac{1}{2}}^{n+\\frac{1}{2}}}{h} \\rightarrow \\hat{v}_y^{n+\\frac{1}{2}} \\frac{2i}{h}\\sin\\left(\\frac{k_y h}{2}\\right)\n$$\nSubstituting these into the time-stepping scheme yields a system for the Fourier amplitudes:\n$$\n\\hat{v}_x^{n+\\frac{1}{2}} = \\hat{v}_x^{n-\\frac{1}{2}} - \\frac{\\Delta t}{\\rho} \\left( \\frac{2i}{h}\\sin\\left(\\frac{k_x h}{2}\\right) \\right) \\hat{p}^n\n$$\n$$\n\\hat{v}_y^{n+\\frac{1}{2}} = \\hat{v}_y^{n-\\frac{1}{2}} - \\frac{\\Delta t}{\\rho} \\left( \\frac{2i}{h}\\sin\\left(\\frac{k_y h}{2}\\right) \\right) \\hat{p}^n\n$$\n$$\n\\hat{p}^{n+1} = \\hat{p}^n - \\kappa \\Delta t \\left[ \\left( \\frac{2i}{h}\\sin\\left(\\frac{k_x h}{2}\\right) \\right) \\hat{v}_x^{n+\\frac{1}{2}} + \\left( \\frac{2i}{h}\\sin\\left(\\frac{k_y h}{2}\\right) \\right) \\hat{v}_y^{n+\\frac{1}{2}} \\right]\n$$\nTo obtain a single recurrence relation for pressure, we first express the pressure update at two consecutive time steps:\n$$\n\\hat{p}^{n+1} - \\hat{p}^n = - \\kappa \\Delta t \\left[ \\dots \\hat{v}_x^{n+\\frac{1}{2}} + \\dots \\hat{v}_y^{n+\\frac{1}{2}} \\right]\n$$\n$$\n\\hat{p}^n - \\hat{p}^{n-1} = - \\kappa \\Delta t \\left[ \\dots \\hat{v}_x^{n-\\frac{1}{2}} + \\dots \\hat{v}_y^{n-\\frac{1}{2}} \\right]\n$$\nSubtracting the second equation from the first gives the centered second-order time derivative for pressure:\n$$\n\\hat{p}^{n+1} - 2\\hat{p}^n + \\hat{p}^{n-1} = - \\kappa \\Delta t \\left[ \\frac{2i}{h}\\sin\\left(\\frac{k_x h}{2}\\right) (\\hat{v}_x^{n+\\frac{1}{2}}-\\hat{v}_x^{n-\\frac{1}{2}}) + \\frac{2i}{h}\\sin\\left(\\frac{k_y h}{2}\\right) (\\hat{v}_y^{n+\\frac{1}{2}}-\\hat{v}_y^{n-\\frac{1}{2}}) \\right]\n$$\nWe substitute the expressions for $(\\hat{v}^{n+\\frac{1}{2}}-\\hat{v}^{n-\\frac{1}{2}})$ from the velocity update equations:\n$$\n\\hat{p}^{n+1} - 2\\hat{p}^n + \\hat{p}^{n-1} = - \\kappa \\Delta t \\left[ \\frac{2i}{h}\\sin\\left(\\frac{k_x h}{2}\\right) \\left(-\\frac{\\Delta t}{\\rho} \\frac{2i}{h}\\sin\\left(\\frac{k_x h}{2}\\right) \\hat{p}^n\\right) + \\frac{2i}{h}\\sin\\left(\\frac{k_y h}{2}\\right) \\left(-\\frac{\\Delta t}{\\rho} \\frac{2i}{h}\\sin\\left(\\frac{k_y h}{2}\\right) \\hat{p}^n\\right) \\right]\n$$\nSimplifying this expression, we use $i^2 = -1$ and the definition of wave speed $c^2=\\kappa/\\rho$:\n$$\n\\hat{p}^{n+1} - 2\\hat{p}^n + \\hat{p}^{n-1} = -\\frac{\\kappa \\Delta t^2}{\\rho} \\frac{4}{h^2} \\left[ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) \\right] \\hat{p}^n\n$$\n$$\n\\hat{p}^{n+1} - 2\\hat{p}^n + \\hat{p}^{n-1} = -4 \\frac{c^2 \\Delta t^2}{h^2} \\left[ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) \\right] \\hat{p}^n\n$$\nLet the amplification factor be $g$, such that $\\hat{p}^n = g^n \\hat{p}^0$. Substituting this gives a quadratic characteristic equation for $g$:\n$$\ng^2 - 2g + 1 = -4 \\frac{c^2 \\Delta t^2}{h^2} \\left[ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) \\right] g\n$$\n$$\ng^2 - \\left(2 - A\\right)g + 1 = 0\n$$\nwhere the term $A$ is defined as:\n$$\nA = 4 \\frac{c^2 \\Delta t^2}{h^2} \\left[ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) \\right]\n$$\nFor a leapfrog scheme, the stability condition $|g| \\le 1$ requires the roots of this quadratic equation to lie on the unit circle in the complex plane, which means $|g|=1$. This occurs if the discriminant of the quadratic is non-positive:\n$$\n(2-A)^2 - 4 \\le 0 \\implies (2-A)^2 \\le 4\n$$\nTaking the square root gives $-2 \\le 2-A \\le 2$. This implies two conditions:\n1. $2-A \\le 2 \\implies A \\ge 0$. This is always satisfied since $A$ is a sum of squares.\n2. $2-A \\ge -2 \\implies 4 \\ge A$. This is the stability constraint.\n\nSubstituting the expression for $A$ into the stability constraint:\n$$\n4 \\frac{c^2 \\Delta t^2}{h^2} \\left[ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) \\right] \\le 4\n$$\n$$\n\\frac{c^2 \\Delta t^2}{h^2} \\left[ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) \\right] \\le 1\n$$\nThis condition must hold for all possible wavenumbers $k_x$ and $k_y$. To find the most restrictive condition (the Courant-Friedrichs-Lewy condition), we must maximize the term in the square brackets. The maximum value of $\\sin^2(\\theta)$ is $1$. This occurs for the highest frequency modes resolvable by the grid, where $k_x h = \\pi$ and $k_y h = \\pi$.\n$$\n\\max_{k_x, k_y} \\left[ \\sin^2\\left(\\frac{k_x h}{2}\\right) + \\sin^2\\left(\\frac{k_y h}{2}\\right) \\right] = \\sin^2\\left(\\frac{\\pi}{2}\\right) + \\sin^2\\left(\\frac{\\pi}{2}\\right) = 1^2 + 1^2 = 2\n$$\nSubstituting this maximum value into the inequality gives the stability limit:\n$$\n\\frac{c^2 \\Delta t^2}{h^2} (2) \\le 1 \\implies \\left(\\frac{c \\Delta t}{h}\\right)^2 \\le \\frac{1}{2}\n$$\nTaking the square root of both sides, we obtain the CFL condition for the 2D scheme:\n$$\n\\frac{c \\Delta t}{h} \\le \\frac{1}{\\sqrt{2}}\n$$\nThe problem statement defines the Courant number as $C = \\frac{c_{\\max}\\,\\Delta t}{h}$. In this constant-coefficient case, $c_{\\max} = c$. The critical Courant number $C_{\\text{crit}}$ is the maximum value for which the scheme is stable. Therefore:\n$$\nC_{\\text{crit}} = \\frac{1}{\\sqrt{2}}\n$$",
            "answer": "$$\\boxed{\\frac{1}{\\sqrt{2}}}$$"
        },
        {
            "introduction": "Once a stable numerical grid is established, the next challenge is to introduce energy into the system in a physically meaningful way. The manner in which a source term is discretized and injected onto the grid significantly impacts the accuracy and fidelity of the simulated wavefield, with improper handling leading to spurious, high-frequency noise known as aliasing. This hands-on coding exercise challenges you to implement and compare several common source interpolation functions, analyze their spectral properties, and quantify their effect on numerical dispersion, providing crucial insights into designing high-fidelity simulations .",
            "id": "3615325",
            "problem": "Consider one-dimensional linear acoustics on a uniform staggered grid, with pressure $p$ sampled at integer spatial nodes $x_i = i\\,\\Delta x$ and half-time levels $t^{n+\\tfrac{1}{2}} = \\left(n+\\tfrac{1}{2}\\right)\\Delta t$, and particle velocity $v$ sampled at half-integer spatial nodes $x_{i+\\tfrac{1}{2}} = \\left(i+\\tfrac{1}{2}\\right)\\Delta x$ and integer time levels $t^n = n\\,\\Delta t$. The governing continuous equations are\n$$\n\\partial_t p(x,t) + \\rho c^2 \\,\\partial_x v(x,t) = s_p(x,t), \\quad \\partial_t v(x,t) + \\frac{1}{\\rho}\\,\\partial_x p(x,t) = s_v(x,t),\n$$\nwhere $\\rho$ is density and $c$ is wave speed. Assume that only a monopole source is present, so that $s_v(x,t) = 0$ and the continuous spatial profile of the source at a fixed time is modeled by a regularized Dirac delta $\\varphi(x-x_0)$ centered at $x_0$. For a second-order accurate explicit finite-difference time-domain scheme on this staggered grid, the discrete updates for homogeneous media are\n$$\np^{n+\\tfrac{1}{2}}_i = p^{n-\\tfrac{1}{2}}_i - \\rho c^2 \\frac{\\Delta t}{\\Delta x}\\left(v^n_{i+\\tfrac{1}{2}} - v^n_{i-\\tfrac{1}{2}}\\right) + \\Delta t\\, s^n_{p,i},\n$$\n$$\nv^{n+1}_{i+\\tfrac{1}{2}} = v^{n}_{i+\\tfrac{1}{2}} - \\frac{\\Delta t}{\\rho\\,\\Delta x}\\left(p^{n+\\tfrac{1}{2}}_{i+1} - p^{n+\\tfrac{1}{2}}_{i}\\right).\n$$\nYou will study aliasing in source injection for this staggered grid by designing spatial interpolation of $\\varphi(x-x_0)$ to both integer and half-integer spatial nodes and analyzing the induced wavenumber content and its interaction with numerical dispersion.\n\nDefine a periodic spatial domain of length $L = N\\,\\Delta x$, with $N$ an even integer. Let $y[m]$ denote the sampled source profile on the composite staggered grid of spacing $\\Delta x/2$, where for $m = 0,1,\\dots,2N-1$,\n$$\ny[m] = \\varphi\\!\\left(x_m - x_0\\right), \\quad x_m = \\frac{m}{2}\\,\\Delta x,\n$$\nwith periodic wrap-around on $[0,L)$ as needed. This composite sampling interleaves the pressure nodes at even indices $m=2i$ and the velocity nodes at odd indices $m=2i+1$. You will consider three choices for the regularized delta $\\varphi(x)$, all normalized to unit integral so that $\\int_{-\\infty}^{\\infty} \\varphi(x)\\,dx = 1$:\n\n- Box (nearest-neighbor) kernel of width $\\Delta x$:\n$$\n\\varphi_B(x) = \\begin{cases}\n\\frac{1}{\\Delta x}, & |x| \\le \\frac{\\Delta x}{2},\\\\\n0, & \\text{otherwise.}\n\\end{cases}\n$$\n\n- Hat (linear) kernel of width $2\\,\\Delta x$:\n$$\n\\varphi_H(x) = \\frac{1}{\\Delta x}\\,\\max\\!\\left(1 - \\frac{|x|}{\\Delta x},\\,0\\right).\n$$\n\n- Cubic $M_4$ B-spline kernel of width $4\\,\\Delta x$, with $a = |x|/\\Delta x$,\n$$\n\\varphi_C(x) = \\frac{1}{\\Delta x}\\times\n\\begin{cases}\n\\frac{4 - 6 a^2 + 3 a^3}{6}, & 0 \\le a < 1, \\\\\n\\frac{(2 - a)^3}{6}, & 1 \\le a < 2, \\\\\n0, & a \\ge 2.\n\\end{cases}\n$$\n\nDefine the discrete Fourier transform of $y[m]$ over the periodic domain using the $2N$-point discrete Fourier transform with spatial sample spacing $\\Delta x/2$, and let $Y[k]$ denote its complex spectrum at wavenumbers $k \\in \\mathcal{K}$, where the wavenumber grid is\n$$\n\\mathcal{K} = \\left\\{ k_\\ell = 2\\pi\\,\\frac{\\ell}{L} \\,:\\, \\ell = -N, -N+1,\\dots, N-1 \\right\\}.\n$$\nAngles must be treated in radians. Consider the scheme parameterized by the Courant number $r = c\\,\\Delta t / \\Delta x$ with $0 < r < 1$.\n\nYour tasks:\n\n1. Starting from the discrete update equations given above, derive the discrete dispersion relation linking angular frequency $\\omega$ and wavenumber $k$ for plane-wave solutions of the homogeneous scheme. Then, define the numerical phase velocity $c_p^{\\text{num}}(k)$ as the ratio $\\omega(k)/k$ for $k \\neq 0$. This derivation must begin from the discrete updates and the definition of a plane wave ansatz and must not assume any pre-existing discrete dispersion formula.\n\n2. For each source kernel $\\varphi \\in \\{\\varphi_B,\\varphi_H,\\varphi_C\\}$, construct the composite sampled source $y[m]$ on the periodic domain $[0,L)$ at a specified source location $x_0$. Compute its discrete spectrum $Y[k]$ and use it to define two scalar diagnostics:\n   - Aliasing ratio $A$, the fraction of total spectral energy that lies outside the schemeâ€™s representable band $\\left|k\\right| \\le \\pi/\\Delta x$, i.e.,\n     $$\n     A = \\frac{\\sum\\limits_{k \\in \\mathcal{K},\\, |k| > \\pi/\\Delta x} \\left|Y[k]\\right|^2}{\\sum\\limits_{k \\in \\mathcal{K}} \\left|Y[k]\\right|^2}.\n     $$\n   - Spectrum-weighted average relative phase velocity error $E$, computed only over the representable band $\\left|k\\right| \\le \\pi/\\Delta x$ as\n     $$\n     E = \\frac{\\sum\\limits_{k \\in \\mathcal{K},\\, 0 < |k| \\le \\pi/\\Delta x} \\left|Y[k]\\right|^2 \\,\\left|\\frac{c_p^{\\text{num}}(k) - c}{c}\\right|}{\\sum\\limits_{k \\in \\mathcal{K},\\, 0 < |k| \\le \\pi/\\Delta x} \\left|Y[k]\\right|^2}.\n     $$\n     At $k=0$, define the contribution to be zero and exclude it from the sums to avoid division by zero.\n\nAll physical quantities must use the International System of Units: distances in meters, time in seconds, wavenumbers in radians per meter, and velocities in meters per second. The angle unit for any trigonometric functions must be radians.\n\nImplement a program that performs the above analysis for the following test suite of parameter sets, each specified as a tuple $(N,\\Delta x,c,r,x_0,\\varphi)$:\n\n- Test $1$ (general offset, box): $(N=\\;512,\\;\\Delta x=\\;10\\,\\text{m},\\; c=\\;1500\\,\\text{m/s},\\; r=\\;0.5,\\; x_0=\\; \\tfrac{L}{2} + 0.27\\,\\Delta x,\\; \\varphi=\\; \\varphi_B)$.\n- Test $2$ (general offset, hat): $(N=\\;512,\\;\\Delta x=\\;10\\,\\text{m},\\; c=\\;1500\\,\\text{m/s},\\; r=\\;0.5,\\; x_0=\\; \\tfrac{L}{2} + 0.27\\,\\Delta x,\\; \\varphi=\\; \\varphi_H)$.\n- Test $3$ (general offset, cubic): $(N=\\;512,\\;\\Delta x=\\;10\\,\\text{m},\\; c=\\;1500\\,\\text{m/s},\\; r=\\;0.5,\\; x_0=\\; \\tfrac{L}{2} + 0.27\\,\\Delta x,\\; \\varphi=\\; \\varphi_C)$.\n- Test $4$ (grid-aligned source, hat; boundary case for aliasing): $(N=\\;512,\\;\\Delta x=\\;10\\,\\text{m},\\; c=\\;1500\\,\\text{m/s},\\; r=\\;0.5,\\; x_0=\\; \\tfrac{L}{2},\\; \\varphi=\\; \\varphi_H)$.\n\nYour program must compute, for each test, the pair $(A,E)$ as defined above and produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each element is a two-element list $[A,E]$ in this order. For example, the output format must be\n$$\n\\texttt{[[A\\_1,E\\_1],[A\\_2,E\\_2],[A\\_3,E\\_3],[A\\_4,E\\_4]]}\n$$\nwith all numbers rendered as decimal floating-point values without units. No additional text must be printed.",
            "solution": "The problem is valid as it is scientifically grounded, well-posed, and objective. It presents a standard task in computational geophysics: the analysis of numerical artifacts (aliasing and dispersion) in a finite-difference scheme for the acoustic wave equation. All necessary parameters and definitions are provided for a unique solution.\n\nThe solution is divided into two main parts as requested: first, the derivation of the numerical dispersion relation, and second, the numerical computation of the aliasing and error diagnostics for the specified source kernels and parameters.\n\n### Part 1: Derivation of the Discrete Dispersion Relation\n\nThe task is to derive the discrete dispersion relation for the given second-order staggered-grid finite-difference scheme in a homogeneous medium. The governing discrete equations are:\n$$\np^{n+\\tfrac{1}{2}}_i = p^{n-\\tfrac{1}{2}}_i - \\rho c^2 \\frac{\\Delta t}{\\Delta x}\\left(v^n_{i+\\tfrac{1}{2}} - v^n_{i-\\tfrac{1}{2}}\\right) \\quad (1)\n$$\n$$\nv^{n+1}_{i+\\tfrac{1}{2}} = v^{n}_{i+\\tfrac{1}{2}} - \\frac{1}{\\rho}\\frac{\\Delta t}{\\Delta x}\\left(p^{n+\\tfrac{1}{2}}_{i+1} - p^{n+\\tfrac{1}{2}}_{i}\\right) \\quad (2)\n$$\nHere, $p$ is pressure, $v$ is particle velocity, $\\rho$ is density, $c$ is the wave speed, $\\Delta t$ is the time step, and $\\Delta x$ is the grid spacing. The indices $i$ and $n$ refer to spatial and temporal grid points, respectively.\n\nWe seek plane-wave solutions (a von Neumann analysis) for these difference equations. Given the staggered nature of the grid in both space and time, we define the following plane-wave ansatz:\n$$\np_i^{n+\\tfrac{1}{2}} = P_0 \\, e^{i(k x_i - \\omega t^{n+\\tfrac{1}{2}})} = P_0 \\, e^{i(k (i\\Delta x) - \\omega (n+\\tfrac{1}{2})\\Delta t)}\n$$\n$$\nv_{i+\\tfrac{1}{2}}^{n} = V_0 \\, e^{i(k x_{i+\\tfrac{1}{2}} - \\omega t^n)} = V_0 \\, e^{i(k (i+\\tfrac{1}{2})\\Delta x - \\omega n\\Delta t)}\n$$\nwhere $P_0$ and $V_0$ are the complex amplitudes, $k$ is the wavenumber, and $\\omega$ is the angular frequency.\n\nFirst, we substitute the ansatz into equation $(1)$:\n$$\nP_0 e^{i(ki\\Delta x - \\omega(n+\\tfrac{1}{2})\\Delta t)} = P_0 e^{i(ki\\Delta x - \\omega(n-\\tfrac{1}{2})\\Delta t)} - \\rho c^2 \\frac{\\Delta t}{\\Delta x} \\left( V_0 e^{i(k(i+\\tfrac{1}{2})\\Delta x - \\omega n\\Delta t)} - V_0 e^{i(k(i-\\tfrac{1}{2})\\Delta x - \\omega n\\Delta t)} \\right)\n$$\nWe divide the entire equation by the common factor $e^{i(ki\\Delta x - \\omega n\\Delta t)}$:\n$$\nP_0 e^{-i\\omega\\tfrac{\\Delta t}{2}} = P_0 e^{i\\omega\\tfrac{\\Delta t}{2}} - \\rho c^2 \\frac{\\Delta t}{\\Delta x} V_0 \\left( e^{ik\\tfrac{\\Delta x}{2}} - e^{-ik\\tfrac{\\Delta x}{2}} \\right)\n$$\nRearranging the terms:\n$$\nP_0 \\left(e^{i\\omega\\tfrac{\\Delta t}{2}} - e^{-i\\omega\\tfrac{\\Delta t}{2}}\\right) = \\rho c^2 \\frac{\\Delta t}{\\Delta x} V_0 \\left( e^{ik\\tfrac{\\Delta x}{2}} - e^{-ik\\tfrac{\\Delta x}{2}} \\right)\n$$\nUsing Euler's identity, $\\sin(\\theta) = \\frac{e^{i\\theta} - e^{-i\\theta}}{2i}$, this equation simplifies to:\n$$\nP_0 \\left(2i \\sin\\left(\\frac{\\omega\\Delta t}{2}\\right)\\right) = \\rho c^2 \\frac{\\Delta t}{\\Delta x} V_0 \\left(2i \\sin\\left(\\frac{k\\Delta x}{2}\\right)\\right)\n$$\nwhich gives the first linear relation between the amplitudes $P_0$ and $V_0$:\n$$\nP_0 \\sin\\left(\\frac{\\omega\\Delta t}{2}\\right) = \\rho c^2 \\frac{\\Delta t}{\\Delta x} V_0 \\sin\\left(\\frac{k\\Delta x}{2}\\right) \\quad (A)\n$$\nNext, we substitute the ansatz into equation $(2)$:\n$$\nV_0 e^{i(k(i+\\tfrac{1}{2})\\Delta x - \\omega(n+1)\\Delta t)} = V_0 e^{i(k(i+\\tfrac{1}{2})\\Delta x - \\omega n\\Delta t)} - \\frac{\\Delta t}{\\rho \\Delta x} \\left( P_0 e^{i(k(i+1)\\Delta x - \\omega(n+\\tfrac{1}{2})\\Delta t)} - P_0 e^{i(k i\\Delta x - \\omega(n+\\tfrac{1}{2})\\Delta t)} \\right)\n$$\nThis time, we divide by the common factor $e^{i(k(i+\\tfrac{1}{2})\\Delta x - \\omega (n+\\tfrac{1}{2})\\Delta t)}$:\n$$\nV_0 e^{-i\\omega\\tfrac{\\Delta t}{2}} = V_0 e^{i\\omega\\tfrac{\\Delta t}{2}} - \\frac{P_0}{\\rho V_0} \\frac{\\Delta t}{\\Delta x} \\left( e^{ik\\tfrac{\\Delta x}{2}} - e^{-ik\\tfrac{\\Delta x}{2}} \\right)\n$$\nRearranging and applying Euler's identity as before:\n$$\nV_0 \\left(e^{i\\omega\\tfrac{\\Delta t}{2}} - e^{-i\\omega\\tfrac{\\Delta t}{2}}\\right) = \\frac{P_0}{\\rho} \\frac{\\Delta t}{\\Delta x} \\left( e^{ik\\tfrac{\\Delta x}{2}} - e^{-ik\\tfrac{\\Delta x}{2}} \\right)\n$$\n$$\nV_0 \\left(2i\\sin\\left(\\frac{\\omega\\Delta t}{2}\\right)\\right) = \\frac{P_0}{\\rho} \\frac{\\Delta t}{\\Delta x} \\left(2i\\sin\\left(\\frac{k\\Delta x}{2}\\right)\\right)\n$$\nThis yields the second linear relation between $P_0$ and $V_0$:\n$$\nV_0 \\sin\\left(\\frac{\\omega\\Delta t}{2}\\right) = \\frac{1}{\\rho} \\frac{\\Delta t}{\\Delta x} P_0 \\sin\\left(\\frac{k\\Delta x}{2}\\right) \\quad (B)\n$$\nFor a non-trivial plane-wave solution to exist (i.e., $P_0, V_0$ not both zero), equations $(A)$ and $(B)$ must be consistent. We can express the ratio $P_0/V_0$ from both equations. From $(A)$:\n$$\n\\frac{P_0}{V_0} = \\frac{\\rho c^2 \\frac{\\Delta t}{\\Delta x} \\sin\\left(\\frac{k\\Delta x}{2}\\right)}{\\sin\\left(\\frac{\\omega\\Delta t}{2}\\right)}\n$$\nFrom $(B)$:\n$$\n\\frac{P_0}{V_0} = \\frac{\\rho \\sin\\left(\\frac{\\omega\\Delta t}{2}\\right)}{\\frac{\\Delta t}{\\Delta x} \\sin\\left(\\frac{k\\Delta x}{2}\\right)}\n$$\nEquating these two expressions for $P_0/V_0$:\n$$\n\\frac{\\rho c^2 \\frac{\\Delta t}{\\Delta x} \\sin\\left(\\frac{k\\Delta x}{2}\\right)}{\\sin\\left(\\frac{\\omega\\Delta t}{2}\\right)} = \\frac{\\rho \\sin\\left(\\frac{\\omega\\Delta t}{2}\\right)}{\\frac{\\Delta t}{\\Delta x} \\sin\\left(\\frac{k\\Delta x}{2}\\right)}\n$$\nCross-multiplying and simplifying gives:\n$$\nc^2 \\left(\\frac{\\Delta t}{\\Delta x}\\right)^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) = \\sin^2\\left(\\frac{\\omega\\Delta t}{2}\\right)\n$$\nIntroducing the Courant number $r = c\\,\\Delta t / \\Delta x$:\n$$\nr^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) = \\sin^2\\left(\\frac{\\omega\\Delta t}{2}\\right)\n$$\nFor a forward-propagating wave, we take the positive square root, which leads to the discrete dispersion relation:\n$$\n\\sin\\left(\\frac{\\omega\\Delta t}{2}\\right) = r \\sin\\left(\\frac{k\\Delta x}{2}\\right)\n$$\nFrom this relation, we can solve for the numerical angular frequency $\\omega(k)$:\n$$\n\\omega(k) = \\frac{2}{\\Delta t} \\arcsin\\left(r \\sin\\left(\\frac{k\\Delta x}{2}\\right)\\right)\n$$\nThe numerical phase velocity $c_p^{\\text{num}}(k)$ is defined as the ratio $\\omega(k)/k$ for $k \\ne 0$:\n$$\nc_p^{\\text{num}}(k) = \\frac{\\omega(k)}{k} = \\frac{2}{k \\Delta t} \\arcsin\\left(r \\sin\\left(\\frac{k\\Delta x}{2}\\right)\\right)\n$$\nIn the limit as $k \\to 0$, we can use the approximations $\\sin(x) \\approx x$ and $\\arcsin(x) \\approx x$, which shows that $c_p^{\\text{num}}(k) \\to c$, meaning the scheme is consistent and non-dispersive for very long wavelengths. For finite $k$, $c_p^{\\text{num}}(k) < c$, a characteristic feature known as numerical dispersion.\n\n### Part 2: Computation of Diagnostics\n\nThe analysis of source aliasing and its interaction with numerical dispersion requires the implementation of the specified source kernels and the diagnostic metrics $A$ and $E$. The overall procedure involves:\n1.  Defining the physical and numerical grid parameters for each test case.\n2.  Constructing the source functions $\\varphi_B(x)$, $\\varphi_H(x)$, and $\\varphi_C(x)$.\n3.  Generating the composite sampled source profile $y[m]$ on the grid with spacing $\\Delta x/2$, respecting the domain periodicity.\n4.  Computing the $2N$-point discrete Fourier transform of $y[m]$ to obtain its spectrum $Y[k]$ over the wavenumber grid $\\mathcal{K}$.\n5.  Calculating the aliasing ratio $A$ by comparing the spectral energy inside and outside the staggered-grid's representable band $|k| \\le \\pi/\\Delta x$.\n6.  Calculating the spectrum-weighted average relative phase velocity error $E$ using the derived expression for $c_p^{\\text{num}}(k)$ and the spectral energy distribution within the representable band.\n\nThis procedure is implemented in the provided Python program, which iterates through the four test cases and computes the $(A, E)$ pair for each.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef phi_B(x, dx):\n    \"\"\"\n    Box (nearest-neighbor) kernel of width dx.\n    Normalized to unit integral.\n    \"\"\"\n    return np.where(np.abs(x) <= dx / 2.0, 1.0 / dx, 0.0)\n\ndef phi_H(x, dx):\n    \"\"\"\n    Hat (linear) kernel of width 2*dx.\n    Normalized to unit integral.\n    \"\"\"\n    abs_x = np.abs(x)\n    return (1.0 / dx) * np.maximum(1.0 - abs_x / dx, 0.0)\n\ndef phi_C(x, dx):\n    \"\"\"\n    Cubic M4 B-spline kernel of width 4*dx.\n    Normalized to unit integral.\n    \"\"\"\n    a = np.abs(x) / dx\n    val = np.zeros_like(a)\n    \n    # Mask for 0 <= a < 1\n    mask1 = a < 1\n    a1 = a[mask1]\n    val[mask1] = (4.0 - 6.0 * a1**2 + 3.0 * a1**3) / 6.0\n    \n    # Mask for 1 <= a < 2\n    mask2 = (a >= 1) & (a < 2)\n    a2 = a[mask2]\n    val[mask2] = (2.0 - a2)**3 / 6.0\n    \n    return val / dx\n\ndef compute_diagnostics(N, dx, c, r, x0_str, phi_key):\n    \"\"\"\n    Computes the aliasing ratio (A) and weighted phase velocity error (E)\n    for a given set of parameters.\n    \"\"\"\n    L = N * dx\n    dt = r * dx / c\n    M = 2 * N\n    dx_c = dx / 2.0\n    \n    # Evaluate x0 from its string definition\n    x0 = eval(x0_str, {\"L\": L, \"dx\": dx})\n\n    phi_map = {'B': phi_B, 'H': phi_H, 'C': phi_C}\n    phi_func = phi_map[phi_key]\n\n    # 1. Construct the composite sampled source y[m]\n    x_grid = np.arange(M) * dx_c\n    d = x_grid - x0\n    d_periodic = d - L * np.round(d / L)  # Periodic distance in [-L/2, L/2]\n    y = phi_func(d_periodic, dx)\n\n    # 2. Compute the discrete spectrum Y[k]\n    # The normalization of the DFT cancels in the ratios A and E.\n    Y = np.fft.fftshift(np.fft.fft(y))\n    Y_sq_mag = np.abs(Y)**2\n    \n    # 3. Establish the wavenumber grid K\n    k = 2 * np.pi * np.fft.fftshift(np.fft.fftfreq(M, d=dx_c))\n\n    # 4. Compute aliasing ratio A\n    total_energy = np.sum(Y_sq_mag)\n    if total_energy == 0:\n        A = 0.0\n    else:\n        k_band_limit = np.pi / dx\n        is_aliased = np.abs(k) > k_band_limit\n        aliased_energy = np.sum(Y_sq_mag[is_aliased])\n        A = aliased_energy / total_energy\n\n    # 5. Compute spectrum-weighted average relative phase velocity error E\n    k_band_limit = np.pi / dx\n    repr_mask = (np.abs(k) <= k_band_limit) & (k != 0)\n    \n    repr_weights = Y_sq_mag[repr_mask]\n    denom_E = np.sum(repr_weights)\n\n    if denom_E == 0:\n        E = 0.0\n    else:\n        k_repr = k[repr_mask]\n        \n        # Calculate numerical phase velocity for representable wavenumbers\n        # c_num = (2 / (k*dt)) * arcsin(r * sin(k*dx/2))\n        arg_arcsin = r * np.sin(k_repr * dx / 2.0)\n        # The argument is always in [-r, r] with r < 1, so arcsin is safe.\n        c_num_repr = (2.0 / (k_repr * dt)) * np.arcsin(arg_arcsin)\n        \n        rel_err = np.abs(c_num_repr - c) / c\n        \n        num_E = np.sum(repr_weights * rel_err)\n        E = num_E / denom_E\n        \n    return [A, E]\n\ndef solve():\n    # Define the test cases from the problem statement.\n    # Each test case is a tuple (N, dx, c, r, x0_string, phi_string)\n    test_cases = [\n        (512, 10.0, 1500.0, 0.5, 'L/2 + 0.27*dx', 'B'),\n        (512, 10.0, 1500.0, 0.5, 'L/2 + 0.27*dx', 'H'),\n        (512, 10.0, 1500.0, 0.5, 'L/2 + 0.27*dx', 'C'),\n        (512, 10.0, 1500.0, 0.5, 'L/2', 'H')\n    ]\n\n    results = []\n    for case in test_cases:\n        N, dx, c, r, x0_str, phi_key = case\n        result_pair = compute_diagnostics(N, dx, c, r, x0_str, phi_key)\n        results.append(result_pair)\n\n    # Final print statement in the exact required format.\n    # The use of map(str, ...) correctly formats the list of lists.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Geophysical applications almost always involve wave propagation through heterogeneous media with sharp interfaces between different rock types. The staggered-grid formulation, where different physical quantities are sampled at different locations within a grid cell, requires careful consideration of how to define material properties like density and bulk modulus at these interfaces. This exercise guides you through a finite-volume derivation to determine the physically consistent averaging scheme for density at a material boundary, a critical detail for ensuring accuracy and stability in realistic earth models .",
            "id": "3615311",
            "problem": "Consider the one-dimensional, linearized acoustic equations for a heterogeneous fluid with piecewise-constant base density $\\,\\rho(x)\\,$ and bulk modulus $\\,K(x)\\,$,\n$$\n\\rho(x)\\,\\frac{\\partial v}{\\partial t} \\;=\\; -\\,\\frac{\\partial p}{\\partial x}, \n\\qquad\n\\frac{\\partial p}{\\partial t} \\;=\\; -\\,K(x)\\,\\frac{\\partial v}{\\partial x},\n$$\nposed on a uniform grid of spacing $\\,\\Delta x\\,$ with a standard staggered arrangement: pressure $\\,p_i(t)\\,$ at cell centers $\\,x_i\\,$ and velocity $\\,v_{i+\\tfrac{1}{2}}(t)\\,$ at faces $\\,x_{i+\\tfrac{1}{2}}\\,$. Suppose $\\,\\rho(x)\\,$ has a jump discontinuity across an interface exactly located at the face $\\,x_{i+\\tfrac{1}{2}}\\,$, with left and right limiting values $\\,\\rho_L\\,$ and $\\,\\rho_R\\,$, respectively. You are to determine the consistent coefficient to use at the staggered face when updating $\\,v_{i+\\tfrac{1}{2}}\\,$ in a finite-volume semi-discretization.\n\nStarting from the momentum balance written in integral form over the dual control volume attached to the face $\\,x_{i+\\tfrac{1}{2}}\\,$, namely the union of the two half-cells $[x_i,x_{i+\\tfrac{1}{2}}]$ and $[x_{i+\\tfrac{1}{2}},x_{i+1}]$ of total length $\\,\\Delta x\\,$, derive the appropriate face coefficient that multiplies the discrete pressure difference when updating $\\,v_{i+\\tfrac{1}{2}}\\,$. Your choice must satisfy all of the following requirements:\n- It follows from the control-volume (finite-volume) statement of momentum, with $\\,v_{i+\\tfrac{1}{2}}\\,$ interpreted as a piecewise-constant velocity over the dual control volume.\n- It yields the correct limiting behavior as $\\,\\rho_L \\to \\infty\\,$ or $\\,\\rho_R \\to \\infty\\,$ (the face velocity should have zero acceleration in the rigid-limit on either side).\n- It is consistent with second-order accuracy on smooth $\\,\\rho(x)\\,$ under the given staggered discretization.\n\nWhich of the following prescriptions for the face coefficient is consistent with these requirements when used in the semi-discrete update\n$$\n\\frac{\\mathrm{d} v_{i+\\tfrac{1}{2}}}{\\mathrm{d} t} \\;=\\; -\\,\\Big(\\text{face coefficient at }x_{i+\\tfrac{1}{2}}\\Big)\\,\\frac{p_{i+1}-p_i}{\\Delta x}\\,?\n$$\n\nA. Use the arithmetic average of density at the face in the sense $\\,\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=\\dfrac{\\rho_L+\\rho_R}{2}\\,$ and set the face coefficient to $\\,1/\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}\\,.$\n\nB. Use the harmonic average of density at the face in the sense $\\,\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=\\dfrac{2}{\\tfrac{1}{\\rho_L}+\\tfrac{1}{\\rho_R}}\\,$ and set the face coefficient to $\\,1/\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}\\,.$\n\nC. Use the arithmetic average of inverse density at the face in the sense $\\,\\left(\\dfrac{1}{\\rho}\\right)_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=\\dfrac{1}{2}\\left(\\dfrac{1}{\\rho_L}+\\dfrac{1}{\\rho_R}\\right)\\,,$ and set the face coefficient directly to $\\,\\left(1/\\rho\\right)_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}\\,.$\n\nD. Use an upwind selection of density at the face, i.e., choose $\\,\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=\\rho_L\\,$ if $\\,p_{i+1}-p_i>0\\,$ and $\\,\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=\\rho_R\\,$ otherwise, and set the face coefficient to $\\,1/\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}\\,.$\n\nE. Both B and C are equivalent and satisfy the stated requirements because they represent the same physical averaging in different algebraic forms.\n\nSelect the single best answer.",
            "solution": "We begin from the integral form of the linear momentum equation for the dual control volume attached to the velocity degree of freedom at $\\,x_{i+\\tfrac{1}{2}}\\,$. Let $\\,V_{i+\\tfrac{1}{2}}\\,$ denote the one-dimensional control volume $[x_i,x_{i+1}]$ of length $\\,\\Delta x\\,$ (in multiple dimensions, this would be the face-centered hexahedron; the one-dimensional derivation captures the essential point). The momentum balance states\n$$\n\\int_{x_i}^{x_{i+1}} \\rho(x)\\,\\frac{\\partial v}{\\partial t}(x,t)\\,\\mathrm{d}x \\;=\\; - \\int_{x_i}^{x_{i+1}} \\frac{\\partial p}{\\partial x}(x,t)\\,\\mathrm{d}x \\;=\\; -\\Big(p_{i+1}(t)-p_i(t)\\Big).\n$$\nOn the staggered grid, $\\,v_{i+\\tfrac{1}{2}}(t)\\,$ represents the average velocity over the dual control volume. Under the standard finite-volume assumption that $\\,v\\,$ is piecewise constant on $\\,V_{i+\\tfrac{1}{2}}\\,$, we can factor $\\,\\partial v/\\partial t\\,$ outside the left integral:\n$$\n\\left(\\frac{\\partial v_{i+\\tfrac{1}{2}}}{\\partial t}\\right)\\int_{x_i}^{x_{i+1}} \\rho(x)\\,\\mathrm{d}x \\;=\\; -\\Big(p_{i+1}-p_i\\Big).\n$$\nDefine the effective face mass (per unit area in higher dimensions) as the volume average\n$$\n\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}} \\;=\\; \\frac{1}{\\Delta x}\\int_{x_i}^{x_{i+1}} \\rho(x)\\,\\mathrm{d}x.\n$$\nThen the semi-discrete velocity update induced by the finite-volume momentum balance is\n$$\n\\frac{\\mathrm{d} v_{i+\\tfrac{1}{2}}}{\\mathrm{d} t} \\;=\\; -\\,\\frac{1}{\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}}\\,\\frac{p_{i+1}-p_i}{\\Delta x}.\n$$\nWhen the interface lies at $\\,x_{i+\\tfrac{1}{2}}\\,$ with piecewise-constant $\\,\\rho(x)\\,$ taking values $\\,\\rho_L\\,$ on $[x_i,x_{i+\\tfrac{1}{2}})$ and $\\,\\rho_R\\,$ on $(x_{i+\\tfrac{1}{2}},x_{i+1}]$, the volume average over the two half-cells gives\n$$\n\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}} \\;=\\; \\frac{1}{\\Delta x}\\left(\\int_{x_i}^{x_{i+\\tfrac{1}{2}}} \\rho_L\\,\\mathrm{d}x + \\int_{x_{i+\\tfrac{1}{2}}}^{x_{i+1}} \\rho_R\\,\\mathrm{d}x\\right) \\;=\\; \\frac{\\rho_L+\\rho_R}{2}.\n$$\nThus the consistent face coefficient in the velocity update is\n$$\n\\left(\\frac{1}{\\rho}\\right)_{i+\\tfrac{1}{2}}^{\\mathrm{FV}} \\;=\\; \\frac{1}{\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}} \\;=\\; \\frac{2}{\\rho_L+\\rho_R}.\n$$\n\nWe now verify the stated requirements.\n\nRequirement based on the control-volume momentum balance. The derivation above follows directly from the integral statement over the dual control volume and therefore enforces that the discrete pressure work $\\,\\big(p_{i+1}-p_i\\big)\\,v_{i+\\tfrac{1}{2}}\\,$ equals the rate of change of the kinetic energy associated with the face degree of freedom with mass $\\,\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}\\,.$ This is the standard finite-volume consistency.\n\nRigid-limit test. Consider the limit $\\,\\rho_L \\to \\infty\\,$ with $\\,\\rho_R\\,$ fixed. Physically, the face velocity represents the motion of two half-masses attached to the same degree of freedom; as one half-mass becomes infinitely heavy, the acceleration of the shared velocity should vanish: $\\,\\mathrm{d} v_{i+\\tfrac{1}{2}}/\\mathrm{d} t \\to 0\\,.$ With the finite-volume choice,\n$$\n\\left(\\frac{1}{\\rho}\\right)_{i+\\tfrac{1}{2}}^{\\mathrm{FV}} \\;=\\; \\frac{2}{\\rho_L+\\rho_R} \\;\\longrightarrow\\; 0 \\quad \\text{as} \\quad \\rho_L \\to \\infty,\n$$\nso $\\,\\mathrm{d} v_{i+\\tfrac{1}{2}}/\\mathrm{d} t \\to 0\\,$ as required. The same conclusion holds for $\\,\\rho_R \\to \\infty\\,$ by symmetry.\n\nSecond-order accuracy on smooth coefficients. If $\\,\\rho(x)\\,$ is smooth, then the midpoint rule yields that the control-volume average over $[x_i,x_{i+1}]$ is a second-order accurate approximation to $\\,\\rho(x_{i+\\tfrac{1}{2}})\\,.$ Thus $\\,\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=(\\rho_L+\\rho_R)/2\\,$ is a second-order accurate face value on a uniform grid when $\\,\\rho_L=\\rho(x_{i+\\tfrac{1}{2}}-\\tfrac{\\Delta x}{2})\\,$ and $\\,\\rho_R=\\rho(x_{i+\\tfrac{1}{2}}+\\tfrac{\\Delta x}{2})\\,.$\n\nWe now evaluate each option.\n\nOption A. This prescribes $\\,\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=(\\rho_L+\\rho_R)/2\\,$, i.e., the control-volume (arithmetic) average of density across the two half-cells, and sets the face coefficient to its reciprocal. This matches the finite-volume derivation exactly. In the rigid-limit $\\,\\rho_L\\to\\infty\\,$, the coefficient $\\,2/(\\rho_L+\\rho_R)\\to 0\\,$, so the acceleration vanishes as required. For smooth $\\,\\rho(x)\\,$, the arithmetic average across the symmetric stencil is second-order accurate for the face value. Verdict: Correct.\n\nOption B. This prescribes the harmonic average density $\\,\\rho_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=2/(\\tfrac{1}{\\rho_L}+\\tfrac{1}{\\rho_R})\\,$ and uses its reciprocal as the face coefficient, i.e., $\\,(\\tfrac{1}{\\rho})_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=(\\tfrac{1}{2})(\\tfrac{1}{\\rho_L}+\\tfrac{1}{\\rho_R})\\,.$ While harmonic averaging is appropriate for diffusive fluxes of the form $\\,\\partial_x\\!\\big(a\\,\\partial_x u\\big)\\,$ to enforce flux continuity with discontinuous coefficients, here the coefficient multiplies the time derivative when written as $\\,\\rho\\,\\partial_t v=-\\partial_x p\\,$. In the rigid-limit $\\,\\rho_L\\to\\infty\\,$, this choice yields $\\,(\\tfrac{1}{\\rho})_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}\\to (\\tfrac{1}{2})(0+\\tfrac{1}{\\rho_R})=\\tfrac{1}{2\\rho_R}\\,$, a nonzero acceleration, which contradicts the correct physical limit. It also does not follow from the control-volume momentum balance. Verdict: Incorrect.\n\nOption C. This prescribes the arithmetic average of inverse density directly as the face coefficient, $\\,(\\tfrac{1}{\\rho})_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}=(\\tfrac{1}{2})(\\tfrac{1}{\\rho_L}+\\tfrac{1}{\\rho_R})\\,.$ This is algebraically identical to the reciprocal of the harmonic average density in Option B, and therefore shares the same deficiencies. In the rigid-limit $\\,\\rho_L\\to\\infty\\,$, it again yields $\\,(\\tfrac{1}{\\rho})_{i+\\tfrac{1}{2}}^{\\mathrm{eff}}\\to \\tfrac{1}{2\\rho_R}\\,$, implying a nonzero acceleration, violating the rigid-limit requirement. It also does not follow from the control-volume momentum balance, which averages $\\,\\rho\\,$ rather than $\\,1/\\rho\\,$ for the mass. Verdict: Incorrect.\n\nOption D. This proposes upwinding $\\,\\rho\\,$ based on the sign of $\\,p_{i+1}-p_i\\,$. The linearized acoustics system is non-dissipative and the face coefficient is a material property independent of wave direction; introducing upwinding at this location breaks the symmetry required for discrete energy conservation and gives incorrect behavior in symmetric configurations. In particular, consider $\\,\\rho_L \\neq \\rho_R\\,$ with $\\,p_{i+1}-p_i=0\\,$; then the selection is undefined by the stated rule. Moreover, in the rigid-limit $\\,\\rho_L\\to\\infty\\,$, if the rule selects the finite side, it fails to produce zero acceleration. This option is also not derivable from the control-volume momentum balance. Verdict: Incorrect.\n\nOption E. Options B and C are indeed algebraically equivalent, but, as shown above, they do not satisfy the rigid-limit requirement and do not emerge from the finite-volume momentum balance. Therefore, they are not correct, either individually or jointly. Verdict: Incorrect.\n\nTherefore, the only option satisfying all stated requirements is the arithmetic average of density over the dual control volume, used via its reciprocal as the face coefficient in the velocity update, i.e., Option A.",
            "answer": "$$\\boxed{A}$$"
        }
    ]
}