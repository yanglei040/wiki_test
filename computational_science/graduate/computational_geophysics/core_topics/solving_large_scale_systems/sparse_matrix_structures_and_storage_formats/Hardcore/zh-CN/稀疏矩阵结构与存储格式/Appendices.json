{
    "hands_on_practices": [
        {
            "introduction": "在许多计算地球物理学的应用中，例如有限元或有限体积方法，全局矩阵的各个元素通常是以无序的数据流形式生成的。坐标（COO）格式是捕捉这些原始数据的自然选择，但在进行高效计算前，必须对重复的条目进行合并。这个练习将带你亲手完成这一基本但至关重要的“合并”步骤，模拟如何从一个无序的三元组流中构建一个定义明确的稀疏矩阵。",
            "id": "3614751",
            "problem": "在结构化网格上组装二维扩散算子的线性系统时，通过对局部模板贡献进行流式传输和聚合，会产生稀疏矩阵。考虑一个大小为 $5 \\times 5$ 的网格，其节点使用从0开始的行索引和列索引。全局稀疏矩阵 $A \\in \\mathbb{R}^{5 \\times 5}$ 将以坐标列表（COO）格式构建，其中贡献以三元组 $(i_{k}, j_{k}, v_{k})$ 的流形式到达，分别代表行索引 $i_{k}$、列索引 $j_{k}$ 和值 $v_{k}$。\n\n假设输入流由 $K = 19$ 个三元组组成，其顺序严格如下所列：\n$(i_{1}, j_{1}, v_{1}) = (1, 1, 4.0)$，\n$(i_{2}, j_{2}, v_{2}) = (0, 1, -1.0)$，\n$(i_{3}, j_{3}, v_{3}) = (2, 2, 1.0)$，\n$(i_{4}, j_{4}, v_{4}) = (2, 1, -0.5)$，\n$(i_{5}, j_{5}, v_{5}) = (0, 0, 2.0)$，\n$(i_{6}, j_{6}, v_{6}) = (2, 1, -0.25)$，\n$(i_{7}, j_{7}, v_{7}) = (1, 2, -0.5)$，\n$(i_{8}, j_{8}, v_{8}) = (2, 2, 4.0)$，\n$(i_{9}, j_{9}, v_{9}) = (3, 2, 0.1)$，\n$(i_{10}, j_{10}, v_{10}) = (1, 1, -0.5)$，\n$(i_{11}, j_{11}, v_{11}) = (2, 3, 0.1)$，\n$(i_{12}, j_{12}, v_{12}) = (1, 0, -1.0)$，\n$(i_{13}, j_{13}, v_{13}) = (0, 1, -0.5)$，\n$(i_{14}, j_{14}, v_{14}) = (1, 1, 0.25)$，\n$(i_{15}, j_{15}, v_{15}) = (2, 1, -1.0)$，\n$(i_{16}, j_{16}, v_{16}) = (0, 0, 0.5)$，\n$(i_{17}, j_{17}, v_{17}) = (4, 4, 1.0)$，\n$(i_{18}, j_{18}, v_{18}) = (3, 3, 3.0)$，\n$(i_{19}, j_{19}, v_{19}) = (1, 2, -1.0)$。\n\n任务：\n1. 严格按照流给出的顺序，使用从0开始的索引构建长度为 $K=19$ 的COO数组 $I, J, V$。\n2. 按 $(I, J)$ 进行稳定字典序排序，即先按 $I$ 递增排序，再按 $J$ 递增排序，并保持相等键 $(I, J)$ 之间的原始顺序。\n3. 通过稳定求和合并重复项：对于排序后数组中的每一组相等键 $(i, j)$，用一个新条目替换它们，该条目的值是按保留的（稳定）顺序对相应 $v_{k}$ 求和的结果。\n4. 合并后，矩阵元素 $A_{2,1}$ 的最终值是多少？\n\n请以实数形式表示最终答案。不要四舍五入。",
            "solution": "该问题被评估为有效。它在计算线性代数领域具有科学依据，特别是稀疏矩阵组装，这是求解偏微分方程数值方法的基础。该问题是适定的，提供了所有必要的数据——一个完整的矩阵贡献流——以及一个用于处理这些数据的清晰、确定性的算法。指示是客观且无歧义的，可以导出一个唯一且可验证的解。\n\n任务是确定从一个COO格式的三元组流组装稀疏矩阵 $A \\in \\mathbb{R}^{5 \\times 5}$ 后，矩阵元素 $A_{2,1}$ 的最终值。组装过程包括三个步骤：构建初始COO数组，执行稳定字典序排序，以及通过求和合并重复条目。\n\n给定的输入流由 $K=19$ 个三元组 $(i_{k}, j_{k}, v_{k})$ 组成，其中 $k = 1, \\dots, 19$。索引 $i$ 和 $j$ 是从0开始的。\n\n初始的COO数组 $I$、$J$ 和 $V$ 是通过按给定顺序从输入流中提取行索引、列索引和值来构建的：\n$I = [1, 0, 2, 2, 0, 2, 1, 2, 3, 1, 2, 1, 0, 1, 2, 0, 4, 3, 1]$\n$J = [1, 1, 2, 1, 0, 1, 2, 2, 2, 1, 3, 0, 1, 1, 1, 0, 4, 3, 2]$\n$V = [4.0, -1.0, 1.0, -0.5, 2.0, -0.25, -0.5, 4.0, 0.1, -0.5, 0.1, -1.0, -0.5, 0.25, -1.0, 0.5, 1.0, 3.0, -1.0]$\n\n下一步是使用 $(I, J)$ 作为排序键，对三元组进行稳定字典序排序。此操作将对同一矩阵元素的所有贡献归为一组。排序的稳定性确保了对任何给定条目的贡献的原始顺序得以保留。\n\n问题要求的是矩阵元素 $A_{2,1}$ 的最终值。这对应于行索引 $i=2$ 和列索引 $j=1$。我们可以将分析重点放在输入流中满足 $(i_k, j_k) = (2, 1)$ 的三元组上。\n\n扫描输入流，我们识别出以下对条目 $A_{2,1}$ 有贡献的三元组：\n1.  第4个三元组是 $(i_4, j_4, v_4) = (2, 1, -0.5)$。\n2.  第6个三元组是 $(i_6, j_6, v_6) = (2, 1, -0.25)$。\n3.  第15个三元组是 $(i_{15}, j_{15}, v_{15}) = (2, 1, -1.0)$。\n\n这些三元组的原始索引是 $k=4$、$k=6$ 和 $k=15$。稳定排序会将这三个三元组归为一组，并且由于它们的键 $(2, 1)$ 相同，它们的相对顺序将被保留。因此，在排序后的列表中，它们将以在原始流中被找到的顺序出现。\n\n最后一步是通过稳定求和合并这些重复项。这意味着我们按照它们被保留的顺序对这三个三元组的值求和，以获得矩阵条目 $A_{2,1}$ 的最终值。\n\n和的计算如下：\n$$A_{2,1} = v_4 + v_6 + v_{15}$$\n代入给定值：\n$$A_{2,1} = (-0.5) + (-0.25) + (-1.0)$$\n执行加法：\n$$A_{2,1} = -0.75 + (-1.0)$$\n$$A_{2,1} = -1.75$$\n\n因此，行索引为2、列索引为1的矩阵元素的最终值为 $-1.75$。",
            "answer": "$$\\boxed{-1.75}$$"
        },
        {
            "introduction": "在实践中，没有任何一种稀疏矩阵格式能适用于所有类型的矩阵结构。混合（HYB）格式结合了ELLPACK（ELL）和坐标（COO）格式的优点，为处理非零元素分布不规则的矩阵提供了一种实用的解决方案。这个练习提出了一个真实的优化问题：如何选择最佳的ELL部分宽度$k$以最小化总存储空间，这在大规模地球物理模型中是一个关键的性能考量。",
            "id": "3614722",
            "problem": "一个稀疏系统矩阵产生于地球物理储层模型中三维非结构化网格上非均匀扩散的隐式有限体积离散化。该矩阵有 $n$ 行，由于局部连接性的可变性，每行的非零元数量呈一定分布。您需要在一个结合了 ELLPACK (ELL) 和坐标 (COO) 存储的混合 (HYB) 稀疏格式中选择 ELLPACK (ELL) 宽度 $k$，以最小化总存储空间，然后计算所得 ELL 和 COO 组件的大小。\n\n假设如下：\n- 行数为 $n = 100000$。\n- 每行非零元数量 $d$ 的直方图如下：\n  - $20000$ 行，每行 $d=7$ 个非零元，\n  - $40000$ 行，每行 $d=8$ 个非零元，\n  - $25000$ 行，每行 $d=9$ 个非零元，\n  - $10000$ 行，每行 $d=12$ 个非零元，\n  - $5000$ 行，每行 $d=20$ 个非零元。\n- 在 HYB 格式中，ELL 组件为每行存储 $k$ 个填充槽位，每个槽位包含一个浮点数值和一个列索引。COO 组件存储每行超出 $k$ 的任何溢出项，每个溢出项包含一个浮点数值、一个行索引和一个列索引。\n- 使用 8 字节的双精度浮点值和 4 字节的 32 位整数。\n- 忽略除上述每项表示方式之外的任何额外元数据、填充或对齐开销。\n\n设 $S_{\\mathrm{ELL}}(k)$ 表示以字节为单位的 ELL 存储空间，$S_{\\mathrm{COO}}(k)$ 表示以字节为单位的 COO 存储空间。选择整数 $k \\ge 0$ 以最小化总存储空间 $S_{\\mathrm{ELL}}(k) + S_{\\mathrm{COO}}(k)$，并计算在这个最优 $k$ 值下 $S_{\\mathrm{ELL}}(k)$ 和 $S_{\\mathrm{COO}}(k)$ 的值。两种存储大小都以字节表示。不要四舍五入，报告精确整数。\n\n以行向量 $\\big(k, S_{\\mathrm{ELL}}(k), S_{\\mathrm{COO}}(k)\\big)$ 的形式提供您的最终答案。",
            "solution": "用户希望找到最优的 ELLPACK 宽度 $k$，以最小化混合 ELL/COO 格式下稀疏矩阵的总存储空间，并计算在此最优 $k$ 值下 ELL 和 COO 组件的存储大小。\n\n### 步骤1：提取已知条件\n- 总行数：$n = 100000$。\n- 每行非零元数量 ($d$) 的直方图：\n  - $n_7 = 20000$ 行，每行 $d=7$。\n  - $n_8 = 40000$ 行，每行 $d=8$。\n  - $n_9 = 25000$ 行，每行 $d=9$。\n  - $n_{12} = 10000$ 行，每行 $d=12$。\n  - $n_{20} = 5000$ 行，每行 $d=20$。\n- 存储成本：\n  - 双精度浮点值：$s_f = 8$ 字节。\n  - 32 位整数：$s_i = 4$ 字节。\n- 混合 (HYB) 格式存储结构：\n  - ELL 组件：对于 $n$ 行中的每一行，存储 $k$ 个槽位。每个槽位包含一个浮点数值和一个列索引。\n  - COO 组件：存储溢出项。对于有 $d$ 个非零元的行，如果 $d > k$，则存储 $d-k$ 个项。每个项包含一个浮点数值、一个行索引和一个列索引。\n\n### 步骤2：使用提取的已知条件进行验证\n该问题具有科学依据，因为它涉及稀疏矩阵的标准存储格式，这是计算科学与工程（包括计算地球物理学）的核心课题。问题是适定的，提供了所有必要的数值数据和清晰的定义来构建一个待最小化的成本函数。直方图中的行数总和等于总行数（$20000+40000+25000+10000+5000 = 100000$），因此数据是内部一致的。语言客观而精确。该问题有效。\n\n### 步骤3：进行求解\n\n目标是找到整数 $k \\ge 0$，以最小化总存储空间 $S_{\\mathrm{total}}(k) = S_{\\mathrm{ELL}}(k) + S_{\\mathrm{COO}}(k)$。\n\n首先，我们确定每种格式中每个条目的存储成本。\n- 对于 ELL 组件，每个条目由一个浮点数值和一个列索引组成。每个 ELL 条目的存储空间为 $s_{\\mathrm{ell\\_entry}} = s_f + s_i = 8 + 4 = 12$ 字节。\n- 对于 COO 组件，每个条目由一个浮点数值、一个行索引和一个列索引组成。每个 COO 条目的存储空间为 $s_{\\mathrm{coo\\_entry}} = s_f + 2s_i = 8 + 2 \\times 4 = 16$ 字节。\n\n接下来，我们构建存储函数 $S_{\\mathrm{ELL}}(k)$ 和 $S_{\\mathrm{COO}}(k)$。\n\n**ELL 存储空间, $S_{\\mathrm{ELL}}(k)$：**\nELL 组件为 $n$ 行中的每一行分配 $k$ 个槽位，而不管每行中非零元的实际数量。\n$$S_{\\mathrm{ELL}}(k) = n \\cdot k \\cdot s_{\\mathrm{ell\\_entry}} = 100000 \\cdot k \\cdot 12 = 1200000 \\cdot k$$\n\n**COO 存储空间, $S_{\\mathrm{COO}}(k)$：**\nCOO 组件存储非零元数量 $d$ 超过 ELL 宽度 $k$ 的那些行的条目。对于一个有 $d$ 个非零元的行，溢出条目的数量是 $\\max(0, d-k)$。\nCOO 条目的总数 $N_{\\mathrm{COO}}(k)$ 是直方图中所有行类型的总和：\n$$N_{\\mathrm{COO}}(k) = \\sum_{d \\in \\{7,8,9,12,20\\}} n_d \\cdot \\max(0, d-k)$$\n那么总的 COO 存储空间是：\n$$S_{\\mathrm{COO}}(k) = N_{\\mathrm{COO}}(k) \\cdot s_{\\mathrm{coo\\_entry}} = 16 \\cdot N_{\\mathrm{COO}}(k)$$\n\n**总存储空间, $S_{\\mathrm{total}}(k)$：**\n$$S_{\\mathrm{total}}(k) = 1200000 \\cdot k + 16 \\cdot \\sum_{d \\in \\{7,8,9,12,20\\}} n_d \\cdot \\max(0, d-k)$$\n我们需要找到最小化此函数的整数 $k$。我们可以分析当 $k$ 增加 1 时总存储空间的变化量 $\\Delta S_{\\mathrm{total}}(k) = S_{\\mathrm{total}}(k+1) - S_{\\mathrm{total}}(k)$。当这个差值从负变正时，就找到了最小值。\n\nELL 存储空间的变化量是：\n$$\\Delta S_{\\mathrm{ELL}}(k) = S_{\\mathrm{ELL}}(k+1) - S_{\\mathrm{ELL}}(k) = 1200000(k+1) - 1200000k = 1200000$$\n\nCOO 存储空间的变化量是：\n$$\\Delta S_{\\mathrm{COO}}(k) = S_{\\mathrm{COO}}(k+1) - S_{\\mathrm{COO}}(k) = 16 \\cdot (N_{\\mathrm{COO}}(k+1) - N_{\\mathrm{COO}}(k))$$\n让我们分析 COO 条目数量的变化量 $\\Delta N_{\\mathrm{COO}}(k) = N_{\\mathrm{COO}}(k+1) - N_{\\mathrm{COO}}(k)$。\n对于具有 $n_d$ 行的单一类型行，变化量是 $n_d \\cdot [\\max(0, d-(k+1)) - \\max(0, d-k)]$。\n- 如果 $d \\le k$，这个差值为 $0-0=0$。\n- 如果 $d > k$，那么 $d-k > 0$ 且 $d-(k+1) \\ge 0$。差值为 $n_d \\cdot [(d-k-1) - (d-k)] = -n_d$。\n因此，$\\Delta N_{\\mathrm{COO}}(k)$ 是非零元数量多于 $k$ 的行数的负值。\n设 $N_{>k}$ 是 $d > k$ 的行数。\n$$N_{>k} = \\sum_{d' > k} n_{d'}$$\n那么，$\\Delta N_{\\mathrm{COO}}(k) = -N_{>k}$，且 $\\Delta S_{\\mathrm{COO}}(k) = -16 \\cdot N_{>k}$。\n\n总存储空间的变化量是：\n$$\\Delta S_{\\mathrm{total}}(k) = \\Delta S_{\\mathrm{ELL}}(k) + \\Delta S_{\\mathrm{COO}}(k) = 1200000 - 16 \\cdot N_{>k}$$\n只要 $\\Delta S_{\\mathrm{total}}(k)  0$，总存储空间 $S_{\\mathrm{total}}(k)$ 就会减小。\n$$1200000 - 16 \\cdot N_{k}  0 \\implies 1200000  16 \\cdot N_{k} \\implies N_{k} > \\frac{1200000}{16} = 75000$$\n我们需要找到最大的 $k$ 值，使得非零元数量多于 $k$ 的行数大于 $75000$。\n\n让我们计算在给定分布点附近的 $k$ 值的 $N_{k}$：\n- 对于 $k \\in \\{0, 1, \\dots, 6\\}$：$N_{k} = n_7+n_8+n_9+n_{12}+n_{20} = 20000+40000+25000+10000+5000 = 100000$。由于 $100000  75000$，成本持续下降直到 $k=7$。\n- 对于 $k=7$：$N_{7} = n_8+n_9+n_{12}+n_{20} = 40000+25000+10000+5000 = 80000$。由于 $80000  75000$，$\\Delta S_{\\mathrm{total}}(7)  0$，这意味着 $S_{\\mathrm{total}}(8)  S_{\\mathrm{total}}(7)$。成本继续下降。\n- 对于 $k=8$：$N_{8} = n_9+n_{12}+n_{20} = 25000+10000+5000 = 40000$。由于 $40000  75000$，$\\Delta S_{\\mathrm{total}}(8) > 0$，这意味着 $S_{\\mathrm{total}}(9) > S_{\\mathrm{total}}(8)$。成本开始增加。\n\n因此，在 $k=8$ 时达到最小总存储空间。\n\n现在，我们计算存储大小 $S_{\\mathrm{ELL}}(8)$ 和 $S_{\\mathrm{COO}}(8)$。\n对于最优宽度 $k=8$：\n- **ELL 存储空间：**\n$$S_{\\mathrm{ELL}}(8) = 1200000 \\cdot 8 = 9600000 \\text{ 字节}$$\n- **COO 存储空间：**\n我们计算溢出条目的数量 $N_{\\mathrm{COO}}(8)$。当行的 $d  8$ 时发生溢出。\n- 对于 $d=9$ 的行 ($n_9 = 25000$)：$25000 \\times (9-8) = 25000$ 个条目。\n- 对于 $d=12$ 的行 ($n_{12} = 10000$)：$10000 \\times (12-8) = 40000$ 个条目。\n- 对于 $d=20$ 的行 ($n_{20} = 5000$)：$5000 \\times (20-8) = 60000$ 个条目。\nCOO 条目的总数是：\n$$N_{\\mathrm{COO}}(8) = 25000 + 40000 + 60000 = 125000$$\n总 COO 存储空间是：\n$$S_{\\mathrm{COO}}(8) = 125000 \\cdot s_{\\mathrm{coo\\_entry}} = 125000 \\cdot 16 = 2000000 \\text{ 字节}$$\n\n最优 ELL 宽度是 $k=8$，此时 ELL 存储空间为 $9600000$ 字节，COO 存储空间为 $2000000$ 字节。所求答案为行向量 $\\big(k, S_{\\mathrm{ELL}}(k), S_{\\mathrm{COO}}(k)\\big)$。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n8  9600000  2000000\n\\end{pmatrix}\n}\n$$"
        }
    ]
}