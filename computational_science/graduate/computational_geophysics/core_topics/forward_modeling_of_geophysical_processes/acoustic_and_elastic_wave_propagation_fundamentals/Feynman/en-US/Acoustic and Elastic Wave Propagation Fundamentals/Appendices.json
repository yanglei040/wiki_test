{
    "hands_on_practices": [
        {
            "introduction": "Understanding how a material's intrinsic properties govern wave propagation is a cornerstone of geophysics. This first practice connects the abstract equations of linear elasticity to the tangible speeds of seismic waves. By deriving the expressions for compressional ($c_P$) and shear ($c_S$) wave speeds from first principles, you will solidify your understanding of how a medium's density, $\\rho$, and elastic Lamé parameters, $\\lambda$ and $\\mu$, dictate its seismic response .",
            "id": "3573453",
            "problem": "Consider a homogeneous, isotropic, linear elastic solid representative of crystalline crustal rock. Small-amplitude elastic waves propagate according to conservation of linear momentum and the isotropic linear stress-strain relationship. Let the mass density be $\\rho$, and let the Lamé parameters be $\\lambda$ and $\\mu$. Starting from conservation of linear momentum and the isotropic Hooke law, and using a plane-wave ansatz in the absence of body forces, derive the expressions for the compressional-wave speed $c_{P}$ and shear-wave speed $c_{S}$, and separately derive the expression for the Poisson ratio $\\nu$ from its definition under uniaxial stress using the same constitutive law.\n\nThen, evaluate the derived expressions for the parameter set $\\lambda = 20\\ \\mathrm{GPa}$, $\\mu = 30\\ \\mathrm{GPa}$, and $\\rho = 2500\\ \\mathrm{kg/m^3}$. Convert gigapascals to pascals before computing. Express the final wave speeds in $\\mathrm{m/s}$ and the Poisson ratio as a dimensionless decimal. Round your numerical values to $4$ significant figures. Report your final numerical results in the order $c_{P}$, $c_{S}$, $\\nu$.",
            "solution": "The problem is evaluated to be valid as it represents a standard derivation in continuum mechanics and elastodynamics, is scientifically grounded, well-posed, objective, and provides all necessary information for a unique solution.\n\nThe derivation proceeds in three parts: first, the derivation of compressional and shear wave speeds from the elastic wave equation; second, the derivation of the Poisson ratio from its definition; and third, the numerical evaluation of these quantities for the given parameters.\n\n**Part 1: Derivation of Wave Speeds ($c_P$ and $c_S$)**\n\nThe propagation of small-amplitude elastic waves in a homogeneous, isotropic solid is governed by the equation of motion. In the absence of body forces, the conservation of linear momentum is expressed as:\n$$\n\\rho \\frac{\\partial^2 u_i}{\\partial t^2} = \\frac{\\partial \\sigma_{ij}}{\\partial x_j}\n$$\nwhere $\\rho$ is the mass density, $\\mathbf{u}(\\mathbf{x}, t)$ is the displacement vector with components $u_i$, $t$ is time, $\\mathbf{x}$ is the position vector with components $x_j$, and $\\sigma_{ij}$ is the stress tensor. The Einstein summation convention is used for repeated indices.\n\nThe stress-strain relationship for a linear, isotropic elastic material is given by Hooke's Law:\n$$\n\\sigma_{ij} = \\lambda \\epsilon_{kk} \\delta_{ij} + 2\\mu \\epsilon_{ij}\n$$\nHere, $\\lambda$ and $\\mu$ are the Lamé parameters, $\\delta_{ij}$ is the Kronecker delta, and $\\epsilon_{ij}$ is the infinitesimal strain tensor. The term $\\epsilon_{kk} = \\nabla \\cdot \\mathbf{u}$ represents the volumetric strain. The strain tensor is related to the displacement field by:\n$$\n\\epsilon_{ij} = \\frac{1}{2} \\left( \\frac{\\partial u_i}{\\partial x_j} + \\frac{\\partial u_j}{\\partial x_i} \\right)\n$$\nSubstituting the expression for strain into Hooke's Law, and then the result into the equation of motion:\n$$\n\\rho \\frac{\\partial^2 u_i}{\\partial t^2} = \\frac{\\partial}{\\partial x_j} \\left[ \\lambda \\left(\\frac{\\partial u_k}{\\partial x_k}\\right) \\delta_{ij} + 2\\mu \\frac{1}{2} \\left( \\frac{\\partial u_i}{\\partial x_j} + \\frac{\\partial u_j}{\\partial x_i} \\right) \\right]\n$$\n$$\n\\rho \\frac{\\partial^2 u_i}{\\partial t^2} = \\lambda \\frac{\\partial}{\\partial x_i} \\left(\\frac{\\partial u_k}{\\partial x_k}\\right) + \\mu \\left( \\frac{\\partial^2 u_i}{\\partial x_j \\partial x_j} + \\frac{\\partial^2 u_j}{\\partial x_j \\partial x_i} \\right)\n$$\nThis equation can be written in vector form as the elastic wave equation:\n$$\n\\rho \\frac{\\partial^2 \\mathbf{u}}{\\partial t^2} = (\\lambda + \\mu) \\nabla(\\nabla \\cdot \\mathbf{u}) + \\mu \\nabla^2 \\mathbf{u}\n$$\nWe seek plane-wave solutions of the form $\\mathbf{u}(\\mathbf{x}, t) = \\mathbf{A} \\exp(i(\\mathbf{k} \\cdot \\mathbf{x} - \\omega t))$, where $\\mathbf{A}$ is a constant amplitude vector, $\\mathbf{k}$ is the wave vector, and $\\omega$ is the angular frequency. The required derivatives are:\n$$\n\\frac{\\partial^2 \\mathbf{u}}{\\partial t^2} = -\\omega^2 \\mathbf{u}\n$$\n$$\n\\nabla \\cdot \\mathbf{u} = i \\mathbf{k} \\cdot \\mathbf{u}\n$$\n$$\n\\nabla(\\nabla \\cdot \\mathbf{u}) = -\\mathbf{k}(\\mathbf{k} \\cdot \\mathbf{u})\n$$\n$$\n\\nabla^2 \\mathbf{u} = -|\\mathbf{k}|^2 \\mathbf{u} = -k^2 \\mathbf{u}\n$$\nSubstituting these into the wave equation yields:\n$$\n-\\rho \\omega^2 \\mathbf{u} = -(\\lambda + \\mu) \\mathbf{k}(\\mathbf{k} \\cdot \\mathbf{u}) - \\mu k^2 \\mathbf{u}\n$$\nRearranging gives the characteristic equation:\n$$\n\\rho \\omega^2 \\mathbf{u} = (\\lambda + \\mu) (\\mathbf{k} \\cdot \\mathbf{u})\\mathbf{k} + \\mu k^2 \\mathbf{u}\n$$\nWe analyze two distinct cases for the polarization $\\mathbf{A}$ relative to the propagation direction $\\mathbf{k}$.\n\nCase 1: Compressional (P-wave). The displacement is parallel to the wave vector ($\\mathbf{A} \\parallel \\mathbf{k}$).\nIn this case, $\\mathbf{k} \\cdot \\mathbf{u} = k u$, where $u = |\\mathbf{u}|$. The equation becomes:\n$$\n\\rho \\omega^2 \\mathbf{u} = (\\lambda + \\mu) (k u) \\frac{\\mathbf{u}}{u} k + \\mu k^2 \\mathbf{u} = (\\lambda + \\mu) k^2 \\mathbf{u} + \\mu k^2 \\mathbf{u}\n$$\n$$\n\\rho \\omega^2 = (\\lambda + 2\\mu) k^2\n$$\nThe compressional wave speed is $c_P = \\omega/k$. Thus:\n$$\nc_P^2 = \\frac{\\omega^2}{k^2} = \\frac{\\lambda + 2\\mu}{\\rho} \\implies c_P = \\sqrt{\\frac{\\lambda + 2\\mu}{\\rho}}\n$$\n\nCase 2: Shear (S-wave). The displacement is perpendicular to the wave vector ($\\mathbf{A} \\perp \\mathbf{k}$).\nIn this case, $\\mathbf{k} \\cdot \\mathbf{u} = 0$. The equation simplifies to:\n$$\n\\rho \\omega^2 \\mathbf{u} = (\\lambda + \\mu) (0)\\mathbf{k} + \\mu k^2 \\mathbf{u} = \\mu k^2 \\mathbf{u}\n$$\n$$\n\\rho \\omega^2 = \\mu k^2\n$$\nThe shear wave speed is $c_S = \\omega/k$. Thus:\n$$\nc_S^2 = \\frac{\\omega^2}{k^2} = \\frac{\\mu}{\\rho} \\implies c_S = \\sqrt{\\frac{\\mu}{\\rho}}\n$$\n\n**Part 2: Derivation of Poisson's Ratio ($\\nu$)**\n\nPoisson's ratio $\\nu$ is defined under a state of uniaxial stress as the negative ratio of transverse strain to axial strain. Let a stress $\\sigma_{11}$ be applied along the $x_1$ axis, with all other stress components being zero. Then $\\nu = -\\epsilon_{22}/\\epsilon_{11} = -\\epsilon_{33}/\\epsilon_{11}$.\n\nWe must invert the constitutive relation $\\sigma_{ij} = \\lambda \\epsilon_{kk} \\delta_{ij} + 2\\mu \\epsilon_{ij}$ to express strain in terms of stress.\nTaking the trace of the stress tensor: $\\sigma_{kk} = \\sigma_{11}+\\sigma_{22}+\\sigma_{33} = 3\\lambda \\epsilon_{kk} + 2\\mu \\epsilon_{kk} = (3\\lambda+2\\mu)\\epsilon_{kk}$.\nSo, $\\epsilon_{kk} = \\frac{\\sigma_{kk}}{3\\lambda+2\\mu}$.\nSubstitute this back into the constitutive equation:\n$$\n2\\mu \\epsilon_{ij} = \\sigma_{ij} - \\lambda \\epsilon_{kk} \\delta_{ij} = \\sigma_{ij} - \\frac{\\lambda \\sigma_{ll}}{3\\lambda+2\\mu} \\delta_{ij}\n$$\n$$\n\\epsilon_{ij} = \\frac{1}{2\\mu} \\sigma_{ij} - \\frac{\\lambda}{2\\mu(3\\lambda+2\\mu)} \\sigma_{ll} \\delta_{ij}\n$$\nFor uniaxial stress $\\sigma_{11} \\neq 0$ and all other $\\sigma_{ij}=0$, we have $\\sigma_{ll} = \\sigma_{11}$.\nThe axial strain $\\epsilon_{11}$ ($i=j=1$) is:\n$$\n\\epsilon_{11} = \\frac{1}{2\\mu} \\sigma_{11} - \\frac{\\lambda}{2\\mu(3\\lambda+2\\mu)} \\sigma_{11} = \\frac{(3\\lambda+2\\mu)-\\lambda}{2\\mu(3\\lambda+2\\mu)} \\sigma_{11} = \\frac{2\\lambda+2\\mu}{2\\mu(3\\lambda+2\\mu)} \\sigma_{11} = \\frac{\\lambda+\\mu}{\\mu(3\\lambda+2\\mu)} \\sigma_{11}\n$$\nThe transverse strain $\\epsilon_{22}$ ($i=j=2$) is:\n$$\n\\epsilon_{22} = \\frac{1}{2\\mu} (0) - \\frac{\\lambda}{2\\mu(3\\lambda+2\\mu)} \\sigma_{11} = - \\frac{\\lambda}{2\\mu(3\\lambda+2\\mu)} \\sigma_{11}\n$$\nNow, we compute the ratio $\\nu = -\\frac{\\epsilon_{22}}{\\epsilon_{11}}$:\n$$\n\\nu = - \\frac{- \\frac{\\lambda}{2\\mu(3\\lambda+2\\mu)} \\sigma_{11}}{\\frac{\\lambda+\\mu}{\\mu(3\\lambda+2\\mu)} \\sigma_{11}} = \\frac{\\lambda}{2\\mu} \\frac{\\mu}{\\lambda+\\mu}\n$$\n$$\n\\nu = \\frac{\\lambda}{2(\\lambda+\\mu)}\n$$\n\n**Part 3: Numerical Evaluation**\n\nThe given parameters are $\\lambda = 20\\ \\mathrm{GPa} = 20 \\times 10^9\\ \\mathrm{Pa}$, $\\mu = 30\\ \\mathrm{GPa} = 30 \\times 10^9\\ \\mathrm{Pa}$, and $\\rho = 2500\\ \\mathrm{kg/m^3}$.\n\nThe P-wave speed $c_P$ is:\n$$\nc_P = \\sqrt{\\frac{\\lambda + 2\\mu}{\\rho}} = \\sqrt{\\frac{20 \\times 10^9\\ \\mathrm{Pa} + 2(30 \\times 10^9\\ \\mathrm{Pa})}{2500\\ \\mathrm{kg/m^3}}} = \\sqrt{\\frac{80 \\times 10^9}{2500}}\\ \\mathrm{m/s}\n$$\n$$\nc_P = \\sqrt{32 \\times 10^6}\\ \\mathrm{m/s} \\approx 5656.854\\ \\mathrm{m/s}\n$$\nRounding to $4$ significant figures, $c_P = 5657\\ \\mathrm{m/s}$.\n\nThe S-wave speed $c_S$ is:\n$$\nc_S = \\sqrt{\\frac{\\mu}{\\rho}} = \\sqrt{\\frac{30 \\times 10^9\\ \\mathrm{Pa}}{2500\\ \\mathrm{kg/m^3}}} = \\sqrt{\\frac{300 \\times 10^8}{25 \\times 10^2}}\\ \\mathrm{m/s}\n$$\n$$\nc_S = \\sqrt{12 \\times 10^6}\\ \\mathrm{m/s} \\approx 3464.102\\ \\mathrm{m/s}\n$$\nRounding to $4$ significant figures, $c_S = 3464\\ \\mathrm{m/s}$.\n\nThe Poisson ratio $\\nu$ is:\n$$\n\\nu = \\frac{\\lambda}{2(\\lambda+\\mu)} = \\frac{20 \\times 10^9\\ \\mathrm{Pa}}{2(20 \\times 10^9\\ \\mathrm{Pa} + 30 \\times 10^9\\ \\mathrm{Pa})} = \\frac{20 \\times 10^9}{2(50 \\times 10^9)} = \\frac{20}{100} = 0.2\n$$\nAs a dimensionless decimal with $4$ significant figures, $\\nu = 0.2000$.\n\nThe final results are reported in the order $c_P$, $c_S$, $\\nu$.",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n5657 & 3464 & 0.2000\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "A correct physical model is only useful if its numerical simulation is stable. This exercise tackles the crucial Courant-Friedrichs-Lewy (CFL) stability condition, which limits the time step size in explicit wave simulations . You will derive this stability bound and apply it to the more complex case of anisotropic media, learning how to find the maximum wave speed using the Christoffel equation—an essential skill for modeling realistic geological materials.",
            "id": "3573435",
            "problem": "You are to derive and implement a programmatic assessment of the stability limit for explicit time stepping of the linear elastic wave equation in heterogeneous, anisotropic media on mixed-element meshes. Begin from the three-dimensional linear momentum balance and Hooke’s law, and deduce the directional elastic wave phase speeds by reducing the governing equations with a plane-wave ansatz to a Christoffel-type eigenvalue problem. Then, starting from a second-order accurate explicit central-difference time integration for the semi-discrete system, derive a conservative Courant-Friedrichs-Lewy (CFL) bound that relates the stable time step to a dimension-dependent constant, a characteristic element length, and the maximum phase speed. Your implementation should compute, for each test case, the maximal phase speed by numerical search over propagation directions and the minimum element length over a mixed set of element types, and return the largest stable time step according to your derived bound.\n\nBase your reasoning and derivation on these fundamental laws and definitions:\n- The linear momentum balance in the absence of body forces is $ \\rho \\, \\ddot{\\boldsymbol{u}} = \\nabla \\cdot \\boldsymbol{\\sigma} $, where $ \\rho $ is mass density, $ \\boldsymbol{u} $ is displacement, and $ \\boldsymbol{\\sigma} $ is stress.\n- Linear elasticity with an anisotropic fourth-order stiffness tensor $ \\mathsf{C} $ obeys $ \\boldsymbol{\\sigma} = \\mathsf{C} : \\boldsymbol{\\varepsilon} $ with strain $ \\boldsymbol{\\varepsilon} = \\tfrac{1}{2} \\left( \\nabla \\boldsymbol{u} + \\nabla \\boldsymbol{u}^{\\mathsf{T}} \\right) $.\n- For a plane wave $ \\boldsymbol{u}(\\boldsymbol{x},t) = \\Re \\left\\{ \\boldsymbol{a} \\, e^{\\mathrm{i} \\omega \\left( \\boldsymbol{n} \\cdot \\boldsymbol{x} - t \\right)} \\right\\} $ with unit direction $ \\boldsymbol{n} $, angular frequency $ \\omega $, and polarization $ \\boldsymbol{a} $, the associated Christoffel matrix is $ \\Gamma_{ij}(\\boldsymbol{n}) = C_{ikjl} \\, n_k \\, n_l $, and nontrivial solutions satisfy $ \\left[ \\Gamma(\\boldsymbol{n}) - \\rho \\, v^2(\\boldsymbol{n}) \\, \\mathsf{I} \\right] \\boldsymbol{a} = \\boldsymbol{0} $, where $ v(\\boldsymbol{n}) = \\omega / \\lvert \\boldsymbol{k} \\rvert $ is phase speed, and $ \\mathsf{I} $ is the identity.\n- The maximum phase speed is $ c_{\\max} = \\max_{\\lVert \\boldsymbol{n} \\rVert = 1} \\sqrt{ \\lambda_{\\max} \\left( \\Gamma(\\boldsymbol{n}) \\right) / \\rho } $, where $ \\lambda_{\\max} $ denotes the largest eigenvalue.\n- Consider a semi-discrete formulation with consistent or lumped mass and a second-order accurate explicit central-difference time integration. Using a von Neumann argument on a uniform partition in dimension $ d $ with linear elements, derive a conservative dimension-dependent constant $ \\alpha(d) $ such that a stability bound can be written $ \\Delta t \\le \\alpha(d) \\, \\min_{e} \\left( \\Delta x_e / c_{\\max,e} \\right) $, where $ \\Delta x_e $ is a characteristic element size and $ c_{\\max,e} $ is the maximum phase speed in element $ e $. For this assignment, define the characteristic element size as the minimum edge length of the element.\n- For two-dimensional cases, restrict propagation directions $ \\boldsymbol{n} $ to the plane (that is, $ \\boldsymbol{n} = (\\cos \\theta, \\sin \\theta, 0) $), and for three-dimensional cases, use directions on the unit sphere. The angle $ \\theta $ must be in radians.\n\nYour program must:\n- Construct the fourth-order stiffness tensor $ \\mathsf{C} $ from a given $ 6 \\times 6 $ Voigt matrix using the standard engineering-shear convention, and evaluate $ c_{\\max} $ by numerical maximization of $ \\sqrt{ \\lambda_{\\max}(\\Gamma(\\boldsymbol{n})) / \\rho } $ over a prescribed set of directions.\n- Compute $ \\Delta x_e $ as the minimum Euclidean distance between any pair of distinct vertices of element $ e $, for triangles, quadrilaterals, tetrahedra, and hexahedra.\n- Use your derived conservative constant $ \\alpha(d) $ to compute a stable time step $ \\Delta t_{\\text{stable}} $.\n\nTest suite and materials, with all physical quantities in SI units:\n- Case A (two-dimensional isotropic, mixed triangle and quadrilateral, answer in seconds):\n  - Dimension $ d = 2 $.\n  - Density $ \\rho = 2500 $ kg/m$^3$.\n  - Isotropic Lamé parameters $ \\lambda = 2.0 \\times 10^{9} $ Pa, $ \\mu = 3.0 \\times 10^{9} $ Pa; build the corresponding $ 6 \\times 6 $ Voigt stiffness matrix.\n  - Elements (coordinates in meters):\n    - Triangle with nodes $ (0,0,0) $, $ (10,0,0) $, $ (0,10,0) $.\n    - Quadrilateral with nodes $ (0,0,0) $, $ (12,0,0) $, $ (12,12,0) $, $ (0,12,0) $.\n  - Restrict directions to the $ x$-$y $ plane for evaluating $ c_{\\max} $.\n\n- Case B (three-dimensional orthorhombic, mixed tetrahedron and hexahedron, answer in seconds):\n  - Dimension $ d = 3 $.\n  - Density $ \\rho = 2600 $ kg/m$^3$.\n  - Orthorhombic $ 6 \\times 6 $ Voigt stiffness (Pa):\n    - $ c_{11} = 5.0 \\times 10^{10} $, $ c_{22} = 4.0 \\times 10^{10} $, $ c_{33} = 3.0 \\times 10^{10} $,\n      $ c_{44} = 1.0 \\times 10^{10} $, $ c_{55} = 1.2 \\times 10^{10} $, $ c_{66} = 0.8 \\times 10^{10} $,\n      $ c_{12} = 1.5 \\times 10^{10} $, $ c_{13} = 1.2 \\times 10^{10} $, $ c_{23} = 1.0 \\times 10^{10} $,\n      with all other entries symmetric and zero where not listed.\n  - Elements (coordinates in meters):\n    - Tetrahedron with nodes $ (0,0,0) $, $ (10,0,0) $, $ (0,9,0) $, $ (0,0,8) $.\n    - Hexahedron (a cube of side $ 20 $) with nodes $ (0,0,0) $, $ (20,0,0) $, $ (20,20,0) $, $ (0,20,0) $, $ (0,0,20) $, $ (20,0,20) $, $ (20,20,20) $, $ (0,20,20) $.\n\n- Case C (three-dimensional transversely isotropic about the $ z $ axis, mixed tetrahedron and hexahedron, answer in seconds):\n  - Dimension $ d = 3 $.\n  - Density $ \\rho = 2700 $ kg/m$^3$.\n  - Transversely isotropic $ 6 \\times 6 $ Voigt stiffness (Pa), with symmetry relations $ c_{22} = c_{11} $, $ c_{23} = c_{13} $, $ c_{55} = c_{44} $, $ c_{66} = \\tfrac{1}{2}(c_{11} - c_{12}) $:\n    - $ c_{11} = 6.0 \\times 10^{10} $, $ c_{33} = 8.0 \\times 10^{10} $,\n      $ c_{44} = 2.0 \\times 10^{10} $, $ c_{12} = 3.0 \\times 10^{10} $, $ c_{13} = 2.5 \\times 10^{10} $.\n  - Elements (coordinates in meters):\n    - Tetrahedron with nodes $ (0,0,0) $, $ (1,0,0) $, $ (0,1,0) $, $ (0,0,1) $.\n    - Hexahedron (a cube of side $ 5 $) with nodes $ (0,0,0) $, $ (5,0,0) $, $ (5,5,0) $, $ (0,5,0) $, $ (0,0,5) $, $ (5,0,5) $, $ (5,5,5) $, $ (0,5,5) $.\n\nImplementation requirements:\n- Use plane strain interpretation for two-dimensional cases by restricting directions to the $ x$-$y $ plane; the stiffness is still treated in three-dimensional form, but the directional search is two-dimensional.\n- For two-dimensional searches, uniformly sample angles $ \\theta \\in [0, 2\\pi) $ in radians with sufficient resolution to accurately approximate $ c_{\\max} $. For three-dimensional searches, sample directions on the unit sphere using a deterministic, approximately uniform sequence with sufficient resolution to accurately approximate $ c_{\\max} $.\n- The characteristic element length $ \\Delta x_e $ for each element is the minimum edge length across the element’s vertex set, computed using the Euclidean norm.\n- Your derived conservative constant $ \\alpha(d) $ must be used to compute $ \\Delta t_{\\text{stable}} $ for each case.\n\nWhat to output:\n- For each case $ \\in \\{ \\text{A}, \\text{B}, \\text{C} \\} $, compute the single scalar $ \\Delta t_{\\text{stable}} $ in seconds, using your derived $ \\alpha(d) $ and the definitions above.\n- Your program must produce a single line of output containing the results as a comma-separated list of three floating-point numbers, rounded to six decimal places, enclosed in square brackets, in the order $ [ \\Delta t_{\\text{A}}, \\Delta t_{\\text{B}}, \\Delta t_{\\text{C}} ] $.",
            "solution": "The user-provided problem is assessed as valid. It is scientifically grounded in the principles of continuum mechanics and numerical analysis, is well-posed with a clear objective and sufficient data, and uses objective, formal language. The solution proceeds as follows.\n\n### Theoretical Derivation\n\nThe problem requires the derivation and implementation of a stability criterion for the numerical solution of the linear elastic wave equation. This involves two main theoretical steps: understanding the propagation of elastic waves and analyzing the stability of the numerical time-stepping scheme.\n\n#### 1. Elastic Wave Propagation and the Christoffel Equation\n\nThe propagation of linear elastic waves in a homogeneous anisotropic medium is governed by the linear momentum balance, absent body forces:\n$$ \\rho \\, \\ddot{\\boldsymbol{u}} = \\nabla \\cdot \\boldsymbol{\\sigma} \\quad(1) $$\nwhere $ \\rho $ is the mass density, $ \\boldsymbol{u} $ is the displacement vector, and $ \\boldsymbol{\\sigma} $ is the Cauchy stress tensor. The constitutive behavior is described by the generalized Hooke's law for a linear elastic material:\n$$ \\boldsymbol{\\sigma} = \\mathsf{C} : \\boldsymbol{\\varepsilon} \\quad(2) $$\nwhere $ \\mathsf{C} $ is the fourth-order stiffness tensor and $ \\boldsymbol{\\varepsilon} $ is the infinitesimal strain tensor, given by the symmetric part of the displacement gradient:\n$$ \\boldsymbol{\\varepsilon} = \\frac{1}{2} \\left( \\nabla \\boldsymbol{u} + (\\nabla \\boldsymbol{u})^{\\mathsf{T}} \\right) \\quad(3) $$\nCombining these equations and using the minor symmetries of the stiffness tensor ($ C_{ijkl} = C_{ijlk} = C_{jikl} $), the equation of motion can be written in component form as:\n$$ \\rho \\, \\ddot{u}_i = \\partial_j \\sigma_{ij} = \\partial_j (C_{ijkl} \\varepsilon_{kl}) = C_{ijkl} \\partial_j \\partial_k u_l \\quad(4) $$\nWe analyze this partial differential equation by considering a plane-wave ansatz of the form:\n$$ \\boldsymbol{u}(\\boldsymbol{x}, t) = \\boldsymbol{a} \\, \\exp\\left[\\mathrm{i} \\omega \\left(\\frac{\\boldsymbol{n} \\cdot \\boldsymbol{x}}{v} - t\\right)\\right] $$\nwhere $ \\boldsymbol{a} $ is the constant polarization vector, $ \\omega $ is the angular frequency, $ v $ is the phase speed, and $ \\boldsymbol{n} $ is a unit vector in the direction of wave propagation. Substituting this into Equation ($4$) yields:\n$$ -\\rho \\omega^2 a_i = C_{ijkl} \\left( \\frac{\\mathrm{i}\\omega}{v} n_j \\right) \\left( \\frac{\\mathrm{i}\\omega}{v} n_k \\right) a_l = -\\frac{\\omega^2}{v^2} C_{ijkl} n_j n_k a_l $$\nRearranging gives the eigenvalue problem:\n$$ (C_{ikjl} n_k n_l) a_j = \\rho v^2 a_i $$\nThis is known as the Christoffel equation. The matrix $ \\Gamma_{ij}(\\boldsymbol{n}) = C_{ikjl} n_k n_l $ is the Christoffel matrix. The equation is rewritten as:\n$$ \\left[ \\boldsymbol{\\Gamma}(\\boldsymbol{n}) - \\rho v^2(\\boldsymbol{n}) \\mathsf{I} \\right] \\boldsymbol{a} = \\boldsymbol{0} $$\nFor any propagation direction $ \\boldsymbol{n} $, nontrivial solutions for the polarization $ \\boldsymbol{a} $ exist only if the term in brackets is singular. This means $ \\rho v^2 $ must be an eigenvalue of $ \\boldsymbol{\\Gamma}(\\boldsymbol{n}) $. Since $ \\boldsymbol{\\Gamma} $ is symmetric and positive definite, there are three real, positive eigenvalues for any $ \\boldsymbol{n} $, corresponding to three distinct wave modes (one quasi-longitudinal and two quasi-shear) with mutually orthogonal polarizations. The maximum phase speed, $ c_{\\max} $, is found by maximizing the largest phase speed over all possible propagation directions:\n$$ c_{\\max} = \\max_{\\|\\boldsymbol{n}\\|=1} \\sqrt{ \\frac{\\lambda_{\\max}(\\boldsymbol{\\Gamma}(\\boldsymbol{n}))}{\\rho} } $$\nwhere $ \\lambda_{\\max} $ denotes the largest eigenvalue of the Christoffel matrix.\n\n#### 2. CFL Stability Condition\n\nThe problem specifies a semi-discrete system integrated in time with a second-order accurate explicit central-difference scheme. For a generic second-order system $ \\ddot{\\boldsymbol{u}} + \\boldsymbol{\\Omega}^2 \\boldsymbol{u} = 0 $, where $ \\boldsymbol{\\Omega}^2 $ represents the spatial discretization operator (e.g., $ \\boldsymbol{M}^{-1}\\boldsymbol{K} $ in finite elements), the central-difference update is:\n$$ \\frac{\\boldsymbol{u}^{n+1} - 2\\boldsymbol{u}^n + \\boldsymbol{u}^{n-1}}{(\\Delta t)^2} + \\boldsymbol{\\Omega}^2 \\boldsymbol{u}^n = 0 $$\nA von Neumann stability analysis shows that this scheme is stable if $ \\Delta t \\le 2/\\omega_{\\max} $, where $ \\omega_{\\max} $ is the maximum natural frequency (eigenvalue) of the operator $ \\boldsymbol{\\Omega} $.\n\nTo derive the dimension-dependent constant $ \\alpha(d) $, we follow the prompt and analyze a scalar wave equation $ \\ddot{u} = c^2 \\nabla^2 u $ on a uniform hypercubic grid of dimension $ d $ with spacing $ \\Delta h $. The spatial operator $ \\nabla^2 $ is approximated by a standard central-difference stencil. The semi-discrete equation at a grid point is:\n$$ \\ddot{u}_{\\boldsymbol{i}} = c^2 \\sum_{j=1}^{d} \\frac{u_{\\boldsymbol{i}+\\boldsymbol{e}_j} - 2u_{\\boldsymbol{i}} + u_{\\boldsymbol{i}-\\boldsymbol{e}_j}}{(\\Delta h)^2} $$\nThe maximum frequency of this discrete operator corresponds to the highest-frequency Fourier mode the grid can represent (Nyquist frequency), where the solution alternates sign at every grid point along a direction. The amplification factor for the numerical scheme is largest when the term $ \\sum (\\dots) $ is maximized. This occurs for a mode with wavevector $ \\boldsymbol{k} = (\\pi/\\Delta h, \\dots, \\pi/\\Delta h) $. For this mode, the effective discrete wavenumber-squared is $ k_{\\text{eff}}^2 = \\sum_{j=1}^d \\frac{4}{(\\Delta h)^2} = \\frac{4d}{(\\Delta h)^2} $. The maximum frequency is approximately $ \\omega_{\\max} \\approx c k_{\\text{eff}} = c \\frac{2\\sqrt{d}}{\\Delta h} $.\nThe stability limit is then:\n$$ \\Delta t \\le \\frac{2}{\\omega_{\\max}} = \\frac{2}{c \\frac{2\\sqrt{d}}{\\Delta h}} = \\frac{\\Delta h}{c\\sqrt{d}} $$\nThis provides a conservative stability bound. Comparing this to the requested form $ \\Delta t \\le \\alpha(d) (\\Delta x_e / c_{\\max,e}) $, we identify the characteristic length $ \\Delta x_e $ with $ \\Delta h $, the maximum speed $ c_{\\max,e} $ with $ c $, and the conservative dimension-dependent constant as:\n$$ \\alpha(d) = \\frac{1}{\\sqrt{d}} $$\nFor the problem, we apply this general result to a mixed-element mesh by taking $ c_{\\max} $ as the maximum phase speed in the material and $ \\Delta x_{\\min} = \\min_{e} \\Delta x_e $ as the minimum characteristic length over all elements in the mesh. The final stability criterion used for computation is:\n$$ \\Delta t_{\\text{stable}} = \\alpha(d) \\frac{\\min_{e} \\Delta x_e}{c_{\\max}} = \\frac{1}{\\sqrt{d}} \\frac{\\Delta x_{\\min}}{c_{\\max}} $$\n\n### Algorithmic Implementation\n\nThe program systematically implements the derived formulas for each test case.\n\n1.  **Stiffness Tensor Construction**: For each case, the $6 \\times 6$ Voigt matrix $ C_V $ is constructed based on the given parameters (Lamé for isotropic, explicit components for orthorhombic, and Thomsen-style parameters for transversely isotropic). This is then converted to the full $3 \\times 3 \\times 3 \\times 3$ stiffness tensor $ C_{ijkl} $. The conversion maps Voigt indices $(1,2,3,4,5,6)$ to tensor index pairs $(11, 22, 33, 23, 13, 12)$ respectively. A mapping array `v_map = [[0, 5, 4], [5, 1, 3], [4, 3, 2]]` (using 0-based indexing) facilitates this: $ C_{ijkl} = C_V[\\text{v\\_map}[i,j], \\text{v\\_map}[k,l]] $.\n\n2.  **Maximum Phase Speed Calculation ($ c_{\\max} $)**: a numerical search is performed.\n    *   For 2D cases ($ d=2 $), propagation directions $ \\boldsymbol{n}=(\\cos\\theta, \\sin\\theta, 0) $ are sampled uniformly for $ \\theta \\in [0, 2\\pi) $.\n    *   For 3D cases ($ d=3 $), a set of approximately uniform directions on the unit sphere is generated using a Fibonacci lattice.\n    *   For each direction $ \\boldsymbol{n} $, the Christoffel matrix $ \\Gamma_{ij} = C_{ikjl} n_k n_l $ is computed efficiently using `numpy.einsum`.\n    *   The eigenvalues of the symmetric matrix $ \\boldsymbol{\\Gamma}(\\boldsymbol{n}) $ are computed. The maximum phase speed for that direction is $ v(\\boldsymbol{n}) = \\sqrt{\\lambda_{\\max}(\\boldsymbol{\\Gamma}) / \\rho} $.\n    *   $ c_{\\max} $ is the maximum of these speeds over all sampled directions.\n\n3.  **Minimum Element Length Calculation ($ \\Delta x_{\\min} $)**:\n    *   For each element in a test case, the set of its vertex coordinates is processed.\n    *   The Euclidean distance between every pair of distinct vertices is calculated. `scipy.spatial.distance.pdist` is used for this.\n    *   The minimum of these distances is the characteristic length $ \\Delta x_e $ for that element.\n    *   $ \\Delta x_{\\min} $ for the test case is the minimum of all $ \\Delta x_e $.\n\n4.  **Stable Time Step Calculation ($ \\Delta t_{\\text{stable}} $)**:\n    *   The final stable time step is computed for each case using the derived formula: $ \\Delta t_{\\text{stable}} = \\frac{1}{\\sqrt{d}} \\frac{\\Delta x_{\\min}}{c_{\\max}} $.\n\nThis procedure is applied to each of the three test cases, and the resulting stable time steps are collected.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.spatial.distance import pdist\n\ndef solve():\n    \"\"\"\n    Main function to derive and compute stable time steps for elastic wave propagation.\n    \"\"\"\n\n    def voigt_to_tensor(C_voigt):\n        \"\"\"Converts a 6x6 Voigt matrix to a 3x3x3x3 stiffness tensor C_ijkl.\"\"\"\n        C_tensor = np.zeros((3, 3, 3, 3))\n        # 0-based index mapping from (i,j) to Voigt index\n        v_map = [[0, 5, 4], [5, 1, 3], [4, 3, 2]]\n        for i in range(3):\n            for j in range(3):\n                for k in range(3):\n                    for l in range(3):\n                        C_tensor[i, j, k, l] = C_voigt[v_map[i][j], v_map[k][l]]\n        return C_tensor\n\n    def get_stiffness_voigt(case_params):\n        \"\"\"Constructs the 6x6 Voigt stiffness matrix from case parameters.\"\"\"\n        name = case_params['name']\n        if name == 'isotropic':\n            lmbda, mu = case_params['lame_lambda'], case_params['lame_mu']\n            C_voigt = np.zeros((6, 6))\n            C_voigt[0, 0] = C_voigt[1, 1] = C_voigt[2, 2] = lmbda + 2 * mu\n            C_voigt[0, 1] = C_voigt[0, 2] = C_voigt[1, 0] = C_voigt[1, 2] = C_voigt[2, 0] = C_voigt[2, 1] = lmbda\n            C_voigt[3, 3] = C_voigt[4, 4] = C_voigt[5, 5] = mu\n            return C_voigt\n        elif name == 'orthorhombic' or name == 'transversely_isotropic':\n            c = case_params['voigt_stiffness']\n            C_voigt = np.zeros((6, 6))\n            # Fill upper triangle from dictionary\n            for key, val in c.items():\n                i, j = int(key[0]) - 1, int(key[1]) - 1\n                C_voigt[i, j] = val\n                if i != j:\n                    C_voigt[j, i] = val\n            return C_voigt\n        else:\n            raise ValueError(f\"Unknown material name: {name}\")\n\n    def calculate_c_max(C_tensor, rho, dim, num_dirs_2d=720, num_dirs_3d=2000):\n        \"\"\"\n        Calculates the maximum phase speed c_max by numerical search over directions.\n        \"\"\"\n        max_v_sq = 0.0\n\n        if dim == 2:\n            thetas = np.linspace(0, 2 * np.pi, num_dirs_2d, endpoint=False)\n            directions = np.zeros((num_dirs_2d, 3))\n            directions[:, 0] = np.cos(thetas)\n            directions[:, 1] = np.sin(thetas)\n        else: # dim == 3\n            # Fibonacci sphere for approximately uniform directions\n            N = num_dirs_3d\n            golden_ratio = (1 + np.sqrt(5)) / 2\n            i = np.arange(0, N)\n            theta = 2 * np.pi * i / golden_ratio\n            phi = np.arccos(1 - 2 * (i + 0.5) / N)\n            x = np.cos(theta) * np.sin(phi)\n            y = np.sin(theta) * np.sin(phi)\n            z = np.cos(phi)\n            directions = np.stack((x, y, z), axis=-1)\n\n        for n in directions:\n            # Christoffel matrix: Gamma_ij = C_ikjl * n_k * n_l\n            gamma = np.einsum('ikjl,k,l->ij', C_tensor, n, n)\n            \n            # Eigenvalues of the Christoffel matrix\n            # Use eigvalsh as Gamma is symmetric\n            eigenvalues = np.linalg.eigvalsh(gamma)\n            \n            # v^2 = lambda / rho\n            v_sq = np.max(eigenvalues) / rho\n            if v_sq > max_v_sq:\n                max_v_sq = v_sq\n\n        return np.sqrt(max_v_sq)\n\n    def get_min_element_length(elements):\n        \"\"\"\n        Computes the minimum characteristic length over a set of elements.\n        The characteristic length is the minimum distance between any two vertices of an element.\n        \"\"\"\n        min_len_global = np.inf\n        for vertices in elements:\n            if len(vertices) < 2:\n                continue\n            # pdist calculates pairwise distances between all rows\n            distances = pdist(np.array(vertices))\n            min_len_local = np.min(distances)\n            if min_len_local < min_len_global:\n                min_len_global = min_len_local\n        return min_len_global\n\n    test_cases = [\n        {\n            \"d\": 2, \"rho\": 2500,\n            \"material\": {\"name\": \"isotropic\", \"lame_lambda\": 2.0e9, \"lame_mu\": 3.0e9},\n            \"elements\": [\n                [(0, 0, 0), (10, 0, 0), (0, 10, 0)],\n                [(0, 0, 0), (12, 0, 0), (12, 12, 0), (0, 12, 0)]\n            ]\n        },\n        {\n            \"d\": 3, \"rho\": 2600,\n            \"material\": {\"name\": \"orthorhombic\", \"voigt_stiffness\": {\n                '11': 5.0e10, '22': 4.0e10, '33': 3.0e10, '44': 1.0e10,\n                '55': 1.2e10, '66': 0.8e10, '12': 1.5e10, '13': 1.2e10, '23': 1.0e10\n            }},\n            \"elements\": [\n                [(0, 0, 0), (10, 0, 0), (0, 9, 0), (0, 0, 8)],\n                [(0, 0, 0), (20, 0, 0), (20, 20, 0), (0, 20, 0),\n                 (0, 0, 20), (20, 0, 20), (20, 20, 20), (0, 20, 20)]\n            ]\n        },\n        {\n            \"d\": 3, \"rho\": 2700,\n            \"material\": {\"name\": \"transversely_isotropic\", \"voigt_stiffness\": {\n                '11': 6.0e10, '33': 8.0e10, '44': 2.0e10, '12': 3.0e10, '13': 2.5e10,\n                '22': 6.0e10, '23': 2.5e10, '55': 2.0e10, '66': 0.5 * (6.0e10 - 3.0e10)\n            }},\n            \"elements\": [\n                [(0, 0, 0), (1, 0, 0), (0, 1, 0), (0, 0, 1)],\n                [(0, 0, 0), (5, 0, 0), (5, 5, 0), (0, 5, 0),\n                 (0, 0, 5), (5, 0, 5), (5, 5, 5), (0, 5, 5)]\n            ]\n        }\n    ]\n\n    results = []\n    for case in test_cases:\n        d = case[\"d\"]\n        rho = case[\"rho\"]\n        \n        # 1. Construct stiffness tensor\n        C_voigt = get_stiffness_voigt(case[\"material\"])\n        C_tensor = voigt_to_tensor(C_voigt)\n        \n        # 2. Calculate max phase speed\n        c_max = calculate_c_max(C_tensor, rho, d)\n        \n        # 3. Calculate min element length\n        dx_min = get_min_element_length(case[\"elements\"])\n        \n        # 4. Calculate stable time step\n        alpha_d = 1.0 / np.sqrt(d)\n        dt_stable = alpha_d * (dx_min / c_max)\n        \n        results.append(dt_stable)\n    \n    # Format output as a list of strings rounded to 6 decimal places\n    formatted_results = [f\"{r:.6f}\" for r in results]\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "Finite computational domains introduce artificial boundaries that can generate spurious reflections, contaminating wavefield simulations. This advanced practice introduces the Perfectly Matched Layer (PML), a sophisticated absorbing boundary condition designed to mitigate this issue . You will derive the key stability condition for a modern complex-frequency-shifted PML and implement a numerical protocol to verify its performance, gaining hands-on experience with a state-of-the-art tool in computational geophysics.",
            "id": "3573446",
            "problem": "You are given a two-dimensional isotropic elastic shear-horizontal (SH) wave model in a homogeneous half-space. The displacement field $u(x,z,t)$ (polarized perpendicular to the $x$-$z$ plane) satisfies the second-order partial differential equation\n$$\n\\rho \\,\\frac{\\partial^2 u}{\\partial t^2} = \\mu \\left( \\frac{\\partial^2 u}{\\partial x^2} + \\frac{\\partial^2 u}{\\partial z^2} \\right),\n$$\nwhere $\\rho$ is the density, $\\mu$ is the shear modulus, and $V_s = \\sqrt{\\mu/\\rho}$ is the shear-wave speed. You will model a Perfectly Matched Layer (PML) truncation applied in the $+x$ direction only, with thickness $L$, using complex coordinate stretching in the frequency domain and verify stability for oblique plane-wave incidences by tracking a late-time displacement norm.\n\nFundamental base and definitions:\n- Start from the SH wave equation above and the definition of the plane-wave solution in a homogeneous medium: for angular frequency $\\omega$ and incidence angle $\\theta$ (measured from the $+x$ axis toward $+z$),\n$$\nu(x,z,t) \\propto \\exp\\left( i \\left( k_x x + k_z z - \\omega t \\right) \\right), \\quad k = \\frac{\\omega}{V_s}, \\quad k_x = k \\cos\\theta, \\quad k_z = k \\sin\\theta.\n$$\n- In a PML layer occupying $x \\in [0,L]$, the $x$-derivative is replaced by the stretched derivative $\\frac{\\partial}{\\partial x} \\to \\frac{1}{s_x(\\omega,x)}\\frac{\\partial}{\\partial x}$, with\n$$\ns_x(\\omega,x) = \\kappa(x) + \\frac{\\sigma(x)}{i\\omega} + i \\frac{\\alpha(x)}{\\omega} = \\kappa(x) + i \\frac{\\alpha(x) - \\sigma(x)}{\\omega},\n$$\nwhere $\\sigma(x) \\ge 0$ is the damping profile, $\\kappa(x) \\ge 1$ is the PML impedance-scaling profile, and $\\alpha(x) \\ge 0$ is the complex frequency shift parameter. All three are real-valued functions of $x$. The PML boundary is at $x=L$.\n\nTasks:\n1. Derive the condition for no evanescent growth in the PML for propagating SH plane waves. Starting from the plane-wave ansatz and the stretched derivative, show that the field within the PML has frequency-domain amplitude evolution\n$$\n\\widehat{U}(L,\\omega) = \\widehat{U}(0,\\omega)\\,\\exp\\!\\left(i k_x \\int_0^L \\frac{1}{s_x(\\omega,\\xi)}\\,d\\xi\\right).\n$$\nArgue that the amplitude factor magnitude is\n$$\n\\left|\\exp\\!\\left(i k_x \\int_0^L \\frac{1}{s_x(\\omega,\\xi)}\\,d\\xi\\right)\\right| = \\exp\\!\\left(- k_x \\int_0^L \\operatorname{Im}\\!\\left(\\frac{1}{s_x(\\omega,\\xi)}\\right)\\,d\\xi\\right),\n$$\nand hence the necessary and sufficient pointwise condition for non-growth with depth (monotone non-increase of amplitude) for all positive $\\omega$ in the wavelet’s support is\n$$\n\\operatorname{Im}\\!\\left(\\frac{1}{s_x(\\omega,x)}\\right) \\ge 0 \\quad \\text{for all } \\omega>0, \\; x\\in[0,L].\n$$\nShow that for real $\\kappa$, $\\sigma$, $\\alpha$, this inequality reduces to the simple algebraic condition\n$$\n\\alpha(x) \\le \\sigma(x) \\quad \\text{for all } x\\in[0,L],\n$$\ntogether with $\\kappa(x) \\ge 1$ and $\\sigma(x) \\ge 0$.\n\n2. Calibrate the damping profile $\\sigma(x)$ to target a prescribed one-way amplitude reduction at $x=L$ for normal incidence. Use a polynomial profile\n$ \\sigma(x) = \\sigma_{\\max}\\left(\\frac{x}{L}\\right)^m $, $ \\kappa(x) = 1 + \\left(\\kappa_{\\max}-1\\right)\\left(\\frac{x}{L}\\right)^m $, $ \\alpha(x) = r\\,\\sigma(x) $,\nwith integer $m \\ge 1$, $\\kappa_{\\max} \\ge 1$, and $0 \\le r < \\infty$. For $\\alpha(x)=0$ and ignoring frequency dispersion of $1/s_x$ in the weak-damping limit, the magnitude reduction at $x=L$ for normal incidence ($\\theta=0$) can be approximated by\n$$\n\\left|\\frac{\\widehat{U}(L,\\omega)}{\\widehat{U}(0,\\omega)}\\right| \\approx \\exp\\!\\left(-\\frac{1}{V_s}\\int_0^L \\frac{\\sigma(\\xi)}{\\kappa(\\xi)^2}\\,d\\xi\\right).\n$$\nImpose a target one-way magnitude $R_{\\text{target}}$ and solve for $\\sigma_{\\max}$:\n$$\n\\int_0^L \\frac{\\sigma(\\xi)}{\\kappa(\\xi)^2}\\,d\\xi = - V_s \\ln R_{\\text{target}} \\;\\;\\Rightarrow\\;\\; \\sigma_{\\max} = \\frac{- V_s \\ln R_{\\text{target}}}{\\displaystyle \\int_0^L \\frac{(\\xi/L)^m}{\\left(1+(\\kappa_{\\max}-1)(\\xi/L)^m\\right)^2} \\, d\\xi }.\n$$\n\n3. Verification protocol by time-domain synthesis. Let the incident signal at $x=0$ be a Ricker wavelet centered at time $t_0$, with peak frequency $f_0$ (in hertz), expressed as\n$$\nu(0,t) = \\left(1 - 2\\pi^2 f_0^2 (t - t_0)^2 \\right)\\exp\\!\\left( -\\pi^2 f_0^2 (t - t_0)^2 \\right).\n$$\nDefine the two-sided Fourier transform convention $\\widehat{u}(\\omega) = \\int_{-\\infty}^{\\infty} u(t) e^{i\\omega t}\\, dt$. For a given incidence angle $\\theta$ (in degrees), construct the transmitted spectrum at $x=L$:\n$$\n\\widehat{u}_L(\\omega) = \\widehat{u}(0,\\omega)\\, \\exp\\!\\left( i \\, \\frac{\\omega \\cos\\theta}{V_s} \\int_0^L \\frac{1}{s_x(\\omega,\\xi)}\\, d\\xi \\right),\n$$\nwith $s_x(\\omega,\\xi)$ as above and $\\theta$ understood in radians within the formula. Inverse transform to obtain $u(L,t)$ on a finite time window. Define a late-time norm as the root-mean-square (RMS) of $u(L,t)$ over the last quarter of the time window, and define a peak norm as the maximum absolute value of $u(L,t)$ over the entire window. Declare the PML configuration “stable” for the tested incidence if the ratio of late-time RMS to peak norm is strictly less than a threshold $\\varepsilon = 5\\times 10^{-2}$ (unitless).\n\nImplementation requirements and units:\n- Use $\\rho$ in $\\mathrm{kg/m^3}$, $\\mu$ in $\\mathrm{Pa}$, $V_s$ in $\\mathrm{m/s}$, $L$ in $\\mathrm{m}$, $f_0$ in $\\mathrm{Hz}$, time $t$ in $\\mathrm{s}$, angular frequency $\\omega$ in $\\mathrm{rad/s}$, and angle $\\theta$ in degrees as input but convert to radians internally for trigonometric functions. Report only the boolean stability determinations per test case.\n- Time discretization: uniformly sample with step $\\Delta t$ (in $\\mathrm{s}$) over a total duration $T$ (in $\\mathrm{s}$). Use the Discrete Fourier Transform with the standard unitary-free scaling consistent with the inverse transform used in common software libraries.\n- The final output of your program must be a single line containing a Python list of booleans in the order of the test suite.\n\nTest suite:\n- Physical parameters common to all tests: $\\rho = 2000\\,\\mathrm{kg/m^3}$, $\\mu = 1.8\\times 10^{10}\\,\\mathrm{Pa}$, hence $V_s = \\sqrt{\\mu/\\rho}$ in $\\mathrm{m/s}$; PML thickness $L = 200\\,\\mathrm{m}$; polynomial order $m=2$; $\\kappa_{\\max}=3$; target magnitude $R_{\\text{target}}=10^{-6}$; Ricker wavelet peak frequency $f_0 = 10\\,\\mathrm{Hz}$; time window $T=4.0\\,\\mathrm{s}$ with step $\\Delta t = 0.002\\,\\mathrm{s}$; center time $t_0 = 1.0\\,\\mathrm{s}$.\n- Define the following five test cases, each specified by a pair $(\\theta, r)$ where $r$ is the ratio defining $\\alpha(x) = r\\,\\sigma(x)$:\n    1. $(0^\\circ, 0.3)$\n    2. $(30^\\circ, 0.3)$\n    3. $(60^\\circ, 0.3)$\n    4. $(30^\\circ, 1.2)$\n    5. $(30^\\circ, 1.5)$\n- For each test case, compute the boolean stability result as described above. Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets (e.g., \"[True,False,True,True,False]\").\n\nDeliverables:\n- A complete, runnable program that carries out the above computations and prints the boolean list.\n- All numerical results must be in the specified units; the ratio is unitless.\n- Angles in the input are in degrees; use radians internally.",
            "solution": "The user has provided a problem statement regarding the analysis of a Perfectly Matched Layer (PML) for Shear-Horizontal (SH) waves. The first step, as per the established protocol, is a meticulous validation of the problem itself.\n\n### Step 1: Extract Givens\n\nThe problem provides the following data, definitions, and tasks:\n\n*   **Governing Equation**: The two-dimensional isotropic elastic SH wave equation:\n    $$\n    \\rho \\,\\frac{\\partial^2 u}{\\partial t^2} = \\mu \\left( \\frac{\\partial^2 u}{\\partial x^2} + \\frac{\\partial^2 u}{\\partial z^2} \\right)\n    $$\n*   **Physical Parameters**: Density $\\rho$, shear modulus $\\mu$, and shear-wave speed $V_s = \\sqrt{\\mu/\\rho}$.\n*   **Plane-Wave Solution**: $u(x,z,t) \\propto \\exp\\left( i \\left( k_x x + k_z z - \\omega t \\right) \\right)$, with wavenumbers $k = \\omega/V_s$, $k_x = k \\cos\\theta$, $k_z = k \\sin\\theta$.\n*   **PML Definition**: A layer for $x \\in [0,L]$ where the derivative $\\frac{\\partial}{\\partial x}$ is replaced by $\\frac{1}{s_x(\\omega,x)}\\frac{\\partial}{\\partial x}$.\n*   **PML Stretching Function**: $s_x(\\omega,x) = \\kappa(x) + \\frac{\\sigma(x)}{i\\omega} + i \\frac{\\alpha(x)}{\\omega}$, with $\\sigma(x) \\ge 0$, $\\kappa(x) \\ge 1$, $\\alpha(x) \\ge 0$.\n*   **Task 1**: Derive the stability condition $\\alpha(x) \\le \\sigma(x)$ for non-growing evanescent waves, starting from the provided amplitude evolution formula.\n*   **Task 2**: Calibrate the damping profile $\\sigma(x)$ using a provided approximation for normal incidence to achieve a target amplitude reduction $R_{\\text{target}}$. This involves solving for $\\sigma_{\\max}$ using a specified integral formula.\n*   **Task 3**: Implement a numerical verification protocol.\n    *   **Incident Signal**: A Ricker wavelet, $u(0,t) = \\left(1 - 2\\pi^2 f_0^2 (t - t_0)^2 \\right)\\exp\\!\\left( -\\pi^2 f_0^2 (t - t_0)^2 \\right)$.\n    *   **Transmitted Spectrum**: $\\widehat{u}_L(\\omega) = \\widehat{u}(0,\\omega)\\, \\exp\\!\\left( i \\, \\frac{\\omega \\cos\\theta}{V_s} \\int_0^L \\frac{1}{s_x(\\omega,\\xi)}\\, d\\xi \\right)$.\n    *   **Stability Metric**: The ratio of a late-time Root-Mean-Square (RMS) norm to a peak norm of the transmitted signal $u(L,t)$ must be less than a threshold $\\varepsilon = 5 \\times 10^{-2}$.\n*   **Numerical Parameters**:\n    *   $\\rho = 2000\\,\\mathrm{kg/m^3}$, $\\mu = 1.8 \\times 10^{10}\\,\\mathrm{Pa}$, $L = 200\\,\\mathrm{m}$\n    *   $m=2$, $\\kappa_{\\max}=3$, $R_{\\text{target}}=10^{-6}$\n    *   $f_0 = 10\\,\\mathrm{Hz}$, $T=4.0\\,\\mathrm{s}$, $\\Delta t = 0.002\\,\\mathrm{s}$, $t_0 = 1.0\\,\\mathrm{s}$\n*   **Test Cases**: Five pairs of $(\\theta, r)$ are provided: $(0^\\circ, 0.3)$, $(30^\\circ, 0.3)$, $(60^\\circ, 0.3)$, $(30^\\circ, 1.2)$, $(30^\\circ, 1.5)$.\n*   **Required Output**: A single-line Python list of booleans indicating the stability for each test case.\n\n### Step 2: Validate Using Extracted Givens\n\nThe problem statement is evaluated against the required criteria:\n\n*   **Scientifically Grounded**: The problem is based on the fundamental linear wave equation and the widely-used complex-frequency-shifted PML method, which are standard topics in computational geophysics and acoustics. The derivations and numerical tasks are consistent with established theory. All provided physical parameters are realistic.\n*   **Well-Posed**: The problem is exceptionally well-posed. It provides all necessary equations, parameters, boundary conditions (via the incident wavelet), and a clear, objective procedure for determining the final output. The tasks are structured logically, from theoretical derivation to numerical implementation and verification.\n*   **Objective**: The language is entirely mathematical and procedural, free from any subjectivity or ambiguity.\n\nThe problem statement exhibits no flaws. It is scientifically sound, fully specified, computationally feasible, and directly relevant to the field of computational wave propagation.\n\n### Step 3: Verdict and Action\n\nThe problem is **valid**. A step-by-step solution will be developed and implemented.\n\n### Solution\n\nThe solution proceeds by addressing the three tasks outlined in the problem statement, culminating in a numerical program that executes the specified tests.\n\n**Part 1: Derivation of the PML Stability Condition**\n\nThe problem asks to analyze the amplitude of a plane wave as it propagates through the PML. The frequency-domain field amplitude at a position $x=L$ within the PML is given relative to the amplitude at the PML entrance $x=0$ by the transfer function $H(\\omega, \\theta, L)$:\n$$\n\\widehat{U}(L,\\omega) = \\widehat{U}(0,\\omega)\\,H(\\omega, \\theta, L) \\quad \\text{where} \\quad H(\\omega, \\theta, L) = \\exp\\!\\left(i k_x \\int_0^L \\frac{1}{s_x(\\omega,\\xi)}\\,d\\xi\\right)\n$$\nHere, $k_x = (\\omega/V_s)\\cos\\theta$ is the horizontal wavenumber of the incident plane wave. For a wave to be attenuated (or at least not grow), the magnitude of this transfer function must be less than or equal to one. The magnitude is:\n$$\n|H(\\omega, \\theta, L)| = \\left|\\exp\\!\\left(i k_x \\int_0^L \\frac{1}{s_x(\\omega,\\xi)}\\,d\\xi\\right)\\right| = \\exp\\!\\left(\\operatorname{Re}\\left(i k_x \\int_0^L \\frac{1}{s_x(\\omega,\\xi)}\\,d\\xi\\right)\\right)\n$$\nUsing the identity $\\operatorname{Re}(iz) = -\\operatorname{Im}(z)$, and given that $k_x$ is real for a propagating wave, we have:\n$$\n|H(\\omega, \\theta, L)| = \\exp\\!\\left(-k_x \\operatorname{Im}\\left(\\int_0^L \\frac{1}{s_x(\\omega,\\xi)}\\,d\\xi\\right)\\right) = \\exp\\!\\left(-k_x \\int_0^L \\operatorname{Im}\\left(\\frac{1}{s_x(\\omega,\\xi)}\\right)\\,d\\xi\\right)\n$$\nFor attenuation, the exponent must be non-positive. For an incident wave propagating into the PML ($x>0$), we have $\\omega>0$ and $|\\theta| < 90^\\circ$, which means $k_x > 0$. Thus, for the magnitude to be $\\le 1$, the integral must be non-negative:\n$$\n\\int_0^L \\operatorname{Im}\\left(\\frac{1}{s_x(\\omega,\\xi)}\\right)\\,d\\xi \\ge 0\n$$\nFor this condition to hold for any arbitrary thickness $L>0$, we require the integrand to be pointwise non-negative:\n$$\n\\operatorname{Im}\\!\\left(\\frac{1}{s_x(\\omega,x)}\\right) \\ge 0 \\quad \\text{for all } \\omega>0, \\; x\\in[0,L].\n$$\nThis is the necessary and sufficient condition for monotonic decay (non-growth) within the PML. Now we analyze this condition using the definition of $s_x(\\omega,x)$:\n$$\ns_x(\\omega,x) = \\kappa(x) + \\frac{\\sigma(x)}{i\\omega} + i \\frac{\\alpha(x)}{\\omega} = \\kappa(x) + i \\frac{\\alpha(x)-\\sigma(x)}{\\omega}\n$$\nWe compute the reciprocal:\n$$\n\\frac{1}{s_x(\\omega,x)} = \\frac{1}{\\kappa(x) + i \\frac{\\alpha(x)-\\sigma(x)}{\\omega}} = \\frac{\\kappa(x) - i \\frac{\\alpha(x)-\\sigma(x)}{\\omega}}{\\left(\\kappa(x)\\right)^2 + \\left(\\frac{\\alpha(x)-\\sigma(x)}{\\omega}\\right)^2}\n$$\nThe imaginary part is:\n$$\n\\operatorname{Im}\\!\\left(\\frac{1}{s_x(\\omega,x)}\\right) = \\frac{-\\left(\\frac{\\alpha(x)-\\sigma(x)}{\\omega}\\right)}{\\left(\\kappa(x)\\right)^2 + \\left(\\frac{\\alpha(x)-\\sigma(x)}{\\omega}\\right)^2} = \\frac{\\frac{\\sigma(x)-\\alpha(x)}{\\omega}}{\\left(\\kappa(x)\\right)^2 + \\left(\\frac{\\alpha(x)-\\sigma(x)}{\\omega}\\right)^2}\n$$\nFor this expression to be non-negative for all $\\omega > 0$, given that the denominator is strictly positive (since $\\kappa(x) \\ge 1$), the numerator must be non-negative. Since $\\omega>0$, this simplifies to:\n$$\n\\sigma(x) - \\alpha(x) \\ge 0 \\implies \\alpha(x) \\le \\sigma(x)\n$$\nThis fundamental algebraic condition, along with the base assumptions $\\kappa(x) \\ge 1$ and $\\sigma(x) \\ge 0$, ensures that the PML does not amplify any propagating waves, thus guaranteeing stability.\n\n**Part 2: Calibration of the Damping Profile**\n\nThe problem provides polynomial profiles for the PML parameters and an approximate formula to calibrate the peak damping $\\sigma_{\\max}$. The goal is to solve for $\\sigma_{\\max}$ such that a desired attenuation $R_{\\text{target}}$ is achieved.\n$$\n\\sigma_{\\max} = \\frac{- V_s \\ln R_{\\text{target}}}{\\displaystyle \\int_0^L \\frac{(\\xi/L)^m}{\\left(1+(\\kappa_{\\max}-1)(\\xi/L)^m\\right)^2} \\, d\\xi }\n$$\nThe integral in the denominator will be computed numerically. By substituting $y = \\xi/L$, the integral becomes:\n$$\nI = L \\int_0^1 \\frac{y^m}{\\left(1+(\\kappa_{\\max}-1)y^m\\right)^2} \\, dy\n$$\nWith the given values $L=200\\,\\mathrm{m}$, $m=2$, and $\\kappa_{\\max}=3$, we can compute this integral and subsequently find $\\sigma_{\\max}$.\n\n**Part 3: Algorithmic Design for Numerical Verification**\n\nThe verification protocol requires synthesizing a time-domain signal transmitted through the PML and analyzing its behavior. The algorithmic steps are as follows:\n\n1.  **Parameter Calculation**: Compute the shear wave speed $V_s = \\sqrt{\\mu/\\rho}$ and the peak damping $\\sigma_{\\max}$ using the formula from Part 2. The integral for $\\sigma_{\\max}$ will be evaluated using numerical quadrature (`scipy.integrate.quad`).\n\n2.  **Discretization**: Set up the time and frequency grids. A time vector $t$ is created from $t=0$ to $T$ with step $\\Delta t$. The corresponding angular frequency vector $\\omega$ is obtained via the Fast Fourier Transform (FFT) frequency conventions (`numpy.fft.fftfreq`).\n\n3.  **Source Wavelet**: Generate the incident Ricker wavelet $u(0,t)$ in the time domain. Compute its spectrum $\\widehat{u}(0,\\omega)$ using an FFT (`numpy.fft.fft`). The problem statement's Fourier transform convention $\\int u(t) e^{i\\omega t} dt$ implies a conjugation of the standard `numpy` FFT result for real signals, but as the transfer function $H(\\omega)$ is defined as the ratio of output to input spectra, this convention detail does not affect the final result if a consistent FFT/IFFT pair is used. We use the standard `numpy` pair.\n\n4.  **PML Transfer Function**: For each test case $(\\theta, r)$, compute the complex transfer function $H(\\omega, \\theta)$. This is the core computation:\n    *   For each discrete frequency $\\omega_k$ in our grid:\n        *   Define the integrand $f(\\xi, \\omega_k) = 1/s_x(\\omega_k, \\xi)$, where $s_x$ is constructed using the given profiles for $\\sigma(x)$, $\\kappa(x)$, and $\\alpha(x) = r\\,\\sigma(x)$.\n        *   Numerically compute the complex-valued integral $I_s(\\omega_k) = \\int_0^L f(\\xi, \\omega_k) \\,d\\xi$. Special care is taken for $\\omega_k=0$, where $s_x=\\kappa(x)$ and the exponent in $H$ becomes zero, yielding $H(0, \\theta)=1$.\n        *   Calculate the transfer function value $H_k = \\exp(i \\frac{\\omega_k \\cos\\theta}{V_s} I_s(\\omega_k))$.\n\n5.  **Transmitted Signal**: Compute the spectrum of the transmitted signal by element-wise multiplication in the frequency domain: $\\widehat{u}_L(\\omega_k) = \\widehat{u}(0,\\omega_k) \\cdot H_k$. Transform this spectrum back to the time domain using an inverse FFT (`numpy.fft.ifft`) to obtain $u(L,t)$. The real part of the result is taken to discard negligible numerical noise.\n\n6.  **Stability Analysis**:\n    *   Calculate the peak norm: $p = \\max_t |u(L,t)|$.\n    *   Isolate the last quarter of the signal $u(L,t)$ for the late-time analysis.\n    *   Calculate the RMS norm of this late-time portion: $l = \\sqrt{\\text{mean}(u_{\\text{late}}^2)}$.\n    *   Compare the ratio $l/p$ to the threshold $\\varepsilon = 5 \\times 10^{-2}$. The configuration is \"stable\" if the ratio is less than $\\varepsilon$.\n\n7.  **Final Output**: Collect the boolean stability results for all five test cases and format them into the specified list. Cases with $r = \\alpha/\\sigma > 1$ are expected to be unstable, as they violate the derived condition from Part 1, leading to wave amplification instead of attenuation.",
            "answer": "```python\nimport numpy as np\nfrom scipy import integrate\n\ndef solve():\n    \"\"\"\n    Validates PML stability for SH waves based on a time-domain synthesis protocol.\n    \"\"\"\n    # Physical parameters common to all tests\n    rho = 2000.0  # kg/m^3\n    mu = 1.8e10   # Pa\n    L = 200.0     # m\n    m = 2         # integer\n    kappa_max = 3.0\n    R_target = 1e-6\n    f0 = 10.0     # Hz\n    T = 4.0       # s\n    dt = 0.002    # s\n    t0 = 1.0      # s\n    epsilon = 5e-2\n\n    # Test suite: list of tuples (theta_deg, r)\n    test_cases = [\n        (0.0, 0.3),\n        (30.0, 0.3),\n        (60.0, 0.3),\n        (30.0, 1.2),\n        (30.0, 1.5)\n    ]\n\n    # --- Step 1: Pre-calculations ---\n    Vs = np.sqrt(mu / rho)\n\n    # Calibrate sigma_max using numerical integration\n    # Integrand for sigma_max calculation, with y = xi/L\n    def sigma_integrand(y, m_order, k_max):\n        return (y**m_order) / (1 + (k_max - 1) * y**m_order)**2\n    \n    integral_val, _ = integrate.quad(sigma_integrand, 0, 1, args=(m, kappa_max))\n    \n    # The full integral is L * integral_val\n    sigma_max = (-Vs * np.log(R_target)) / (L * integral_val)\n\n    # --- Step 2: Time/Frequency setup ---\n    N = int(T / dt)\n    time_vec = np.arange(N) * dt\n    freqs = np.fft.fftfreq(N, d=dt)\n    omegas = 2 * np.pi * freqs\n\n    # --- Step 3: Incident Signal (Ricker wavelet) ---\n    a = (np.pi * f0 * (time_vec - t0))**2\n    u0 = (1 - 2 * a) * np.exp(-a)\n    u0_fft = np.fft.fft(u0)\n\n    results = []\n\n    for theta_deg, r in test_cases:\n        theta_rad = np.deg2rad(theta_deg)\n\n        # --- Step 4: PML Transfer Function Calculation ---\n        \n        # Define PML parameter profiles as functions of position xi\n        def sigma_func(xi):\n            return sigma_max * (xi / L)**m\n        \n        def kappa_func(xi):\n            return 1.0 + (kappa_max - 1.0) * (xi / L)**m\n        \n        def alpha_func(xi):\n            return r * sigma_func(xi)\n\n        # Integrand for the transfer function's exponent\n        def pml_integrand(xi, omega):\n            if omega == 0:\n                # Avoid division by zero; s_x simplifies\n                return 1.0 / kappa_func(xi)\n            \n            s_x = kappa_func(xi) + (alpha_func(xi) - sigma_func(xi)) / (1j * omega)\n            return 1.0 / s_x\n\n        # Compute the transfer function H for all frequencies\n        H = np.zeros_like(omegas, dtype=np.complex128)\n        \n        for k, omega in enumerate(omegas):\n            if omega == 0:\n                H[k] = 1.0\n                continue\n            \n            # Use quad to integrate the complex-valued function\n            integral_real, _ = integrate.quad(lambda xi: np.real(pml_integrand(xi, omega)), 0, L)\n            integral_imag, _ = integrate.quad(lambda xi: np.imag(pml_integrand(xi, omega)), 0, L)\n            \n            integral_complex = integral_real + 1j * integral_imag\n            \n            exponent = 1j * omega * np.cos(theta_rad) / Vs * integral_complex\n            H[k] = np.exp(exponent)\n            \n        # --- Step 5: Transmitted Signal ---\n        uL_fft = u0_fft * H\n        uL = np.real(np.fft.ifft(uL_fft))\n        \n        # --- Step 6: Stability Analysis ---\n        peak_norm = np.max(np.abs(uL))\n        \n        # Late-time norm (last quarter of the signal)\n        late_time_start_index = 3 * N // 4\n        late_time_signal = uL[late_time_start_index:]\n        late_time_rms = np.sqrt(np.mean(late_time_signal**2))\n\n        # Avoid division by zero if signal is zero\n        if peak_norm < 1e-15:\n            ratio = 0.0\n        else:\n            ratio = late_time_rms / peak_norm\n        \n        is_stable = ratio < epsilon\n        results.append(is_stable)\n\n    # Final print statement in the exact required format\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}