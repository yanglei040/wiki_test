{
    "hands_on_practices": [
        {
            "introduction": "在使用显式有限差分格式求解波动方程时，首要任务是确保数值计算的稳定性。一个不稳定的数值格式会导致计算结果出现毫无物理意义的指数级增长，最终使模拟失效。本练习将引导你运用冯·诺依曼（von Neumann）分析这一核心工具，为声波方程的标准二阶差分格式推导出其稳定性条件，即著名的 Courant-Friedrichs-Lewy (CFL) 条件 。",
            "id": "3592805",
            "problem": "考虑一个标量场 $u(x,t)$ 在恒定密度和恒定波速 $c$ 下的一维声波方程，由 $u_{tt}(x,t) = c^{2} u_{xx}(x,t)$ 给出。设空间域在均匀网格 $x_{i} = i\\,\\Delta x$ 上离散化，时间离散化为 $t^{n} = n\\,\\Delta t$，其中 $i$ 和 $n$ 为整数，$\\Delta x$ 和 $\\Delta t$ 为正常数。在时间和空间上均使用二阶中心有限差分，为每个内部网格点构建一个显式更新格式，并在周期性边界条件下执行 von Neumann (傅里叶) 稳定性分析，以确定所有傅里叶模态在时间上保持有界的条件。定义库朗数 $\\lambda = \\dfrac{c\\,\\Delta t}{\\Delta x}$，并推导形式为 $c\\,\\Delta t / \\Delta x \\le \\lambda_{\\max}$ 的 Courant–Friedrichs–Lewy (CFL) 条件。计算 $\\lambda_{\\max}$ 的精确值。将最终答案表示为单个实数。无需四舍五入，最终答案不应包含任何单位。",
            "solution": "问题陈述有效。这是一个计算物理学中标准的、适定的问题，它具有科学依据、客观性，并包含获得唯一解所需的所有必要信息。\n\n一维声波方程由下式给出：\n$$\n\\frac{\\partial^2 u}{\\partial t^2} = c^2 \\frac{\\partial^2 u}{\\partial x^2}\n$$\n其中 $u(x,t)$ 是标量场，$c$ 是恒定波速。\n\n我们用均匀网格对区域进行离散化，使得 $x_i = i\\,\\Delta x$ 和 $t^n = n\\,\\Delta t$。$u(x_i, t^n)$ 的数值近似值记为 $u_i^n$。我们使用二阶中心有限差分来近似偏导数。\n\n在 $(x_i, t^n)$ 处，关于时间的二阶偏导数 $u_{tt}$ 近似为：\n$$\n\\frac{\\partial^2 u}{\\partial t^2}\\bigg|_{i,n} \\approx \\frac{u_i^{n+1} - 2u_i^n + u_i^{n-1}}{(\\Delta t)^2}\n$$\n在 $(x_i, t^n)$ 处，关于空间的二阶偏导数 $u_{xx}$ 近似为：\n$$\n\\frac{\\partial^2 u}{\\partial x^2}\\bigg|_{i,n} \\approx \\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{(\\Delta x)^2}\n$$\n将这些近似值代入波动方程，得到有限差分方程：\n$$\n\\frac{u_i^{n+1} - 2u_i^n + u_i^{n-1}}{(\\Delta t)^2} = c^2 \\frac{u_{i+1}^n - 2u_i^n + u_{i-1}^n}{(\\Delta x)^2}\n$$\n为了创建一个显式更新格式，我们求解 $u_i^{n+1}$：\n$$\nu_i^{n+1} = 2u_i^n - u_i^{n-1} + \\frac{c^2 (\\Delta t)^2}{(\\Delta x)^2} (u_{i+1}^n - 2u_i^n + u_{i-1}^n)\n$$\n我们引入库朗数 $\\lambda = \\frac{c\\,\\Delta t}{\\Delta x}$。方程变为：\n$$\nu_i^{n+1} = 2u_i^n - u_i^{n-1} + \\lambda^2 (u_{i+1}^n - 2u_i^n + u_{i-1}^n)\n$$\n对于 von Neumann 稳定性分析，我们考虑以下形式的单个傅里叶模态解：\n$$\nu_i^n = \\xi^n e^{j k x_i} = \\xi^n e^{j k i \\Delta x}\n$$\n其中 $k$ 是波数，$j = \\sqrt{-1}$，$\\xi = \\xi(k)$ 是放大因子。为使格式稳定，放大因子的模必须对所有可能的波数 $k$ 满足 $|\\xi| \\le 1$。\n\n将傅里叶模态代入有限差分格式：\n$$\n\\xi^{n+1} e^{j k i \\Delta x} = 2\\xi^n e^{j k i \\Delta x} - \\xi^{n-1} e^{j k i \\Delta x} + \\lambda^2 \\left( \\xi^n e^{j k (i+1) \\Delta x} - 2\\xi^n e^{j k i \\Delta x} + \\xi^n e^{j k (i-1) \\Delta x} \\right)\n$$\n将整个方程除以公因子 $\\xi^{n-1} e^{j k i \\Delta x}$ 得：\n$$\n\\xi^2 = 2\\xi - 1 + \\lambda^2 \\left( \\xi e^{j k \\Delta x} - 2\\xi + \\xi e^{-j k \\Delta x} \\right)\n$$\n我们可以将右侧的 $\\xi$ 提取出来，并使用 Euler 公式 $e^{j\\theta} + e^{-j\\theta} = 2\\cos(\\theta)$，其中 $\\theta = k\\Delta x$：\n$$\n\\xi^2 = 2\\xi - 1 + \\lambda^2 \\xi (e^{j k \\Delta x} + e^{-j k \\Delta x} - 2)\n$$\n$$\n\\xi^2 = 2\\xi - 1 + \\lambda^2 \\xi (2\\cos(k\\Delta x) - 2)\n$$\n$$\n\\xi^2 = 2\\xi - 1 - 2\\lambda^2 \\xi (1 - \\cos(k\\Delta x))\n$$\n使用半角恒等式 $1 - \\cos(\\theta) = 2\\sin^2(\\theta/2)$：\n$$\n\\xi^2 = 2\\xi - 1 - 4\\lambda^2 \\xi \\sin^2\\left(\\frac{k\\Delta x}{2}\\right)\n$$\n将其重新整理成关于 $\\xi$ 的标准二次方程：\n$$\n\\xi^2 - \\left( 2 - 4\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\right)\\xi + 1 = 0\n$$\n这是一个形式为 $a\\xi^2 + b\\xi + c = 0$ 的二次方程，其中 $a=1$，$b = -2P$，$c=1$，且 $P = 1 - 2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right)$。根由二次公式给出：\n$$\n\\xi = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a} = P \\pm \\sqrt{P^2 - 1}\n$$\n为使解保持有界，我们需要 $|\\xi| \\le 1$。\n让我们根据 $P$ 的值来分析这些根：\n1. 如果 $P^2 > 1$ (即 $|P| > 1$), 则项 $\\sqrt{P^2-1}$ 是实数且为正。其中一个根的模将大于 $1$。例如，如果 $P > 1$，则 $\\xi_+ = P + \\sqrt{P^2-1} > 1$。如果 $P  -1$，则 $\\xi_- = P - \\sqrt{P^2-1}  -1$，所以 $|\\xi_-|  1$。在这两种情况下，格式都是不稳定的。\n2. 如果 $P^2 \\le 1$ (即 $|P| \\le 1$), 则项 $P^2-1$ 是非正的。根为 $\\xi = P \\pm j\\sqrt{1-P^2}$。这些复数根的模为：\n$$\n|\\xi| = \\sqrt{P^2 + \\left(\\sqrt{1-P^2}\\right)^2} = \\sqrt{P^2 + 1 - P^2} = \\sqrt{1} = 1\n$$\n在这种情况下，傅里叶模态的振幅是守恒的，格式是稳定的。边界情况 $P^2=1$ 给出单个实根 $\\xi=P$，其模为 $|\\xi|=1$，这也是稳定的。\n\n因此，对于所有波数 $k$，稳定性的条件是 $|P| \\le 1$：\n$$\n\\left| 1 - 2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\right| \\le 1\n$$\n这个不等式可以写成：\n$$\n-1 \\le 1 - 2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\le 1\n$$\n我们来分析不等式的两部分。右侧是：\n$$\n1 - 2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\le 1 \\implies -2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\le 0\n$$\n由于 $\\lambda^2 \\ge 0$ 且 $\\sin^2(\\cdot) \\ge 0$，这部分总是满足的。\n左侧给出了决定性的稳定性约束：\n$$\n-1 \\le 1 - 2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\implies 2\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\le 2\n$$\n$$\n\\lambda^2 \\sin^2\\left(\\frac{k\\Delta x}{2}\\right) \\le 1\n$$\n这个条件必须对所有波数 $k$ 成立。为确保这一点，我们必须考虑“最坏情况”，即对应于使项 $\\sin^2\\left(\\frac{k\\Delta x}{2}\\right)$ 最大化的 $k$ 值。$\\sin^2(\\cdot)$ 的最大值是 $1$。这发生在网格上可以表示的最高频率模态，即 $k = \\pi / \\Delta x$，此时正弦函数的参数为 $\\pi/2$。\n对这种最坏情况施加该条件可得：\n$$\n\\lambda^2 \\cdot \\max_{k}\\left[\\sin^2\\left(\\frac{k\\Delta x}{2}\\right)\\right] \\le 1 \\implies \\lambda^2 \\cdot 1 \\le 1\n$$\n$$\n\\lambda^2 \\le 1\n$$\n由于库朗数 $\\lambda = \\frac{c\\Delta t}{\\Delta x}$ 是由正常数 $\\Delta t$ 和 $\\Delta x$ 定义的，且波速 $c$ 也为正，所以 $\\lambda$ 是一个非负量。因此，稳定性条件简化为：\n$$\n0 \\le \\lambda \\le 1\n$$\n问题要求以 $\\frac{c\\,\\Delta t}{\\Delta x} \\le \\lambda_{\\max}$ 的形式给出 Courant–Friedrichs–Lewy (CFL) 条件。这对应于 $\\lambda \\le \\lambda_{\\max}$，因此我们可以确定 $\\lambda_{\\max}$ 是稳定范围的上界。\n$$\n\\lambda_{\\max} = 1\n$$",
            "answer": "$$\\boxed{1}$$"
        },
        {
            "introduction": "在保证了数值格式的稳定性之后，我们便需要关心其计算精度。本练习聚焦于一种被称为“数值频散”的常见计算伪影，即在离散网格中，不同频率的波会以不同的速度传播，从而导致波形失真。通过推导数值相速度的表达式，你将能够量化分析离散参数（如时间步长 $\\Delta t$ 和空间步长 $\\Delta x$）如何影响模拟的真实度 。",
            "id": "3592755",
            "problem": "考虑无限长直线上的 一维($1$D) 恒定密度声波方程 $u_{tt}(x,t) = c^{2} u_{xx}(x,t)$，其中 $u(x,t)$ 是声压，$c$ 是真实波速。使用间距为 $\\Delta x$ 的均匀空间网格点 $x_{j} = j \\Delta x$ 和时间步长为 $\\Delta t$ 的均匀时间层 $t_{n} = n \\Delta t$ 对该方程进行离散化。在空间和时间上均使用二阶中心有限差分近似，以获得一个关联 $u^{n+1}_{j}$、$u^{n}_{j}$、$u^{n-1}_{j}$ 与 $u^{n}_{j+1}$ 和 $u^{n}_{j-1}$ 的线性显式更新方程。从这个离散更新方程出发，并将网格视为无限大，通过假设解的形式为 $u^{n}_{j} = A \\exp\\!\\big(i \\big(k j \\Delta x - \\omega n \\Delta t\\big)\\big)$ 来分析离散傅里叶模式的频散，其中 $k$ 是傅里叶波数，$\\omega$ 是离散角频率，$A$ 是恒定振幅。推导离散频散关系 $\\omega(k)$，然后推导数值相速度 $v_{p}(\\omega) = \\omega/k$。定义 Courant–Friedrichs–Lewy (CFL) 数 $\\sigma = c \\Delta t / \\Delta x$ 和无量纲波数 $\\kappa = k \\Delta x$。将最终答案表示为仅含 $\\sigma$ 和 $\\kappa$ 的、关于比率 $v_{p}(\\omega)/c$ 的单一闭式解析表达式。无需进行数值计算，也无需四舍五入。最终答案必须是一个解析表达式。",
            "solution": "该问题要求推导应用于一维声波方程的有限差分格式的数值相速度。该过程从验证问题陈述开始。\n\n### 步骤 1：提取已知条件\n- **控制方程：** 一维恒定密度声波方程为 $u_{tt}(x,t) = c^{2} u_{xx}(x,t)$。\n- **域：** 无限长直线。\n- **变量：** $u(x,t)$ 是声压，$c$ 是真实波速。\n- **离散化：**\n    - 空间网格：$x_{j} = j \\Delta x$，均匀间距为 $\\Delta x$。\n    - 时间网格：$t_{n} = n \\Delta t$，均匀时间步长为 $\\Delta t$。\n- **数值格式：** 在空间和时间上均采用二阶中心有限差分近似。\n- **分析形式：** 假设一个离散傅里叶模式解：$u^{n}_{j} = A \\exp\\!\\big(i \\big(k j \\Delta x - \\omega n \\Delta t\\big)\\big)$，其中 $k$ 是波数，$\\omega$ 是离散角频率，$A$ 是一个恒定振幅。\n- **要求推导：**\n    1. 离散更新方程。\n    2. 离散频散关系 $\\omega(k)$。\n    3. 数值相速度 $v_{p}(\\omega) = \\omega/k$。\n- **参数定义：**\n    - Courant–Friedrichs–Lewy (CFL) 数：$\\sigma = c \\Delta t / \\Delta x$。\n    - 无量纲波数：$\\kappa = k \\Delta x$。\n- **最终输出：** 用 $\\sigma$ 和 $\\kappa$ 表示的比率 $v_{p}(\\omega)/c$ 的解析表达式。\n\n### 步骤 2：使用提取的已知条件进行验证\n该问题具有科学依据，因为它涉及对一个基本物理模型（波动方程）的数值方法（有限差分）的标准分析。这是计算物理学和地球物理学中的一个经典课题。该问题是适定的，为唯一的解析推导提供了所有必要信息。术语精确、客观。没有科学或事实错误，没有矛盾，且设定是完整的。该问题是应用数学中的一个非平凡的练习，并且没有验证标准中列出的任何缺陷。\n\n### 步骤 3：结论与行动\n问题有效。将提供完整的解法。\n\n### 推导\n控制偏微分方程为一维声波方程：\n$$\n\\frac{\\partial^2 u}{\\partial t^2} = c^2 \\frac{\\partial^2 u}{\\partial x^2}\n$$\n我们在一个网格上离散化这个方程，其中 $u(x_j, t_n)$ 由 $u^n_j$ 近似。二阶偏导数的二阶中心有限差分近似为：\n$$\n\\frac{\\partial^2 u}{\\partial t^2} \\bigg|_{j,n} \\approx \\frac{u^{n+1}_j - 2u^n_j + u^{n-1}_j}{(\\Delta t)^2}\n$$\n$$\n\\frac{\\partial^2 u}{\\partial x^2} \\bigg|_{j,n} \\approx \\frac{u^n_{j+1} - 2u^n_j + u^n_{j-1}}{(\\Delta x)^2}\n$$\n将这些近似代入波动方程，得到离散形式：\n$$\n\\frac{u^{n+1}_j - 2u^n_j + u^{n-1}_j}{(\\Delta t)^2} = c^2 \\frac{u^n_{j+1} - 2u^n_j + u^n_{j-1}}{(\\Delta x)^2}\n$$\n重新整理以获得 $u^{n+1}_j$ 的显式更新方程：\n$$\nu^{n+1}_j = 2u^n_j - u^{n-1}_j + \\left(\\frac{c \\Delta t}{\\Delta x}\\right)^2 (u^n_{j+1} - 2u^n_j + u^n_{j-1})\n$$\n使用 CFL 数的定义 $\\sigma = c \\Delta t / \\Delta x$，方程变为：\n$$\nu^{n+1}_j = 2u^n_j - u^{n-1}_j + \\sigma^2 (u^n_{j+1} - 2u^n_j + u^n_{j-1})\n$$\n为进行频散分析，我们将给定的傅里叶模式解 $u^{n}_{j} = A \\exp\\!\\big(i \\big(k x_j - \\omega t_n\\big)\\big) = A \\exp\\!\\big(i \\big(k j \\Delta x - \\omega n \\Delta t\\big)\\big)$ 代入离散方程。网格点值之间的关系如下：\n$$\nu^{n+1}_j = u^n_j \\exp(-i \\omega \\Delta t)\n$$\n$$\nu^{n-1}_j = u^n_j \\exp(i \\omega \\Delta t)\n$$\n$$\nu^n_{j+1} = u^n_j \\exp(i k \\Delta x)\n$$\n$$\nu^n_{j-1} = u^n_j \\exp(-i k \\Delta x)\n$$\n将这些代入离散方程的第一个形式，并除以公共的非零因子 $u^n_j$，得到：\n$$\n\\frac{\\exp(-i \\omega \\Delta t) - 2 + \\exp(i \\omega \\Delta t)}{(\\Delta t)^2} = c^2 \\frac{\\exp(i k \\Delta x) - 2 + \\exp(-i k \\Delta x)}{(\\Delta x)^2}\n$$\n使用由欧拉公式和半角恒等式推导出的恒等式 $2\\cos\\theta - 2 = -4\\sin^2(\\theta/2)$，我们可以简化方程的两边：\n$$\n\\frac{-4\\sin^2(\\frac{\\omega \\Delta t}{2})}{(\\Delta t)^2} = c^2 \\frac{-4\\sin^2(\\frac{k \\Delta x}{2})}{(\\Delta x)^2}\n$$\n简化此表达式得到：\n$$\n\\frac{\\sin^2(\\frac{\\omega \\Delta t}{2})}{(\\Delta t)^2} = c^2 \\frac{\\sin^2(\\frac{k \\Delta x}{2})}{(\\Delta x)^2}\n$$\n对两边取正平方根（对应于前向传播的波），得到离散频散关系：\n$$\n\\frac{\\sin(\\frac{\\omega \\Delta t}{2})}{\\Delta t} = \\frac{c}{\\Delta x} \\sin\\left(\\frac{k \\Delta x}{2}\\right)\n$$\n这可以重写为：\n$$\n\\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) = \\frac{c \\Delta t}{\\Delta x} \\sin\\left(\\frac{k \\Delta x}{2}\\right)\n$$\n现在我们引入无量纲参数 $\\sigma = c \\Delta t / \\Delta x$ 和 $\\kappa = k \\Delta x$。频散关系变为：\n$$\n\\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) = \\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\n$$\n由此，我们求解离散角频率 $\\omega$：\n$$\n\\frac{\\omega \\Delta t}{2} = \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right) \\implies \\omega = \\frac{2}{\\Delta t} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right)\n$$\n数值相速度定义为 $v_p = \\omega/k$。代入 $\\omega$ 的表达式：\n$$\nv_p = \\frac{1}{k} \\frac{2}{\\Delta t} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right)\n$$\n为将其表示为所需的最终形式，我们代入 $k = \\kappa / \\Delta x$：\n$$\nv_p = \\frac{\\Delta x}{\\kappa} \\frac{2}{\\Delta t} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right) = \\frac{2 \\Delta x}{\\kappa \\Delta t} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right)\n$$\n最后，我们计算数值相速度与真实波速之比 $v_p/c$：\n$$\n\\frac{v_p}{c} = \\frac{1}{c} \\left(\\frac{2 \\Delta x}{\\kappa \\Delta t}\\right) \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right) = \\left(\\frac{\\Delta x}{c \\Delta t}\\right) \\frac{2}{\\kappa} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right)\n$$\n因为 $\\sigma = c \\Delta t / \\Delta x$，我们有 $1/\\sigma = \\Delta x / (c \\Delta t)$。将此代入方程，得到仅用 $\\sigma$ 和 $\\kappa$ 表示的最终表达式：\n$$\n\\frac{v_p}{c} = \\frac{2}{\\sigma \\kappa} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right)\n$$\n该表达式表示单个傅里叶分量在离散网格中传播的速度与真实物理波速之比。这种传播速度依赖于波长的现象，被称为数值频散。为使解为实值，$\\arcsin$ 函数的自变量的绝对值必须小于或等于 $1$。由于 $|\\sin(\\kappa/2)|$ 的最大值为 $1$，这施加了条件 $|\\sigma| \\le 1$，即该显式格式著名的 CFL 稳定性条件。",
            "answer": "$$\\boxed{\\frac{2}{\\sigma \\kappa} \\arcsin\\left(\\sigma \\sin\\left(\\frac{\\kappa}{2}\\right)\\right)}$$"
        },
        {
            "introduction": "本章的最终实践将理论从一维推广到二维，并将数值方法与一个深刻的物理原理——互易性——联系起来。你将通过编写代码来检验，在何种情况下，这一物理对称性会被常见的数值方法（例如非对称差分格式或吸收边界层）所保持或破坏 。这项练习不仅能提升你的编程能力，还能让你直观地理解数值实施细节如何影响物理守恒律，为进行实际的波场模拟提供宝贵经验。",
            "id": "3592795",
            "problem": "考虑均匀介质中压力 $p(\\mathbf{x},t)$ 的二维声波方程，其波速 $c$ 为常数，\n$$\n\\partial_{tt} p(\\mathbf{x},t) - c^2 \\nabla^2 p(\\mathbf{x},t) = s(t)\\,\\delta(\\mathbf{x}-\\mathbf{x}_s),\n$$\n其中 $\\mathbf{x} = (x,y)$ 表示位置，$t$ 表示时间，$c$ 表示波速，$\\nabla^2$ 表示空间拉普拉斯算子，$s(t)$ 表示一个时域紧致的源子波，$\\delta(\\cdot)$ 表示 Dirac delta 分布。在适当的边界条件下，对于线性、时不变、自伴的空间算子，格林函数 $G(\\mathbf{x}_s,\\mathbf{x}_r,t)$（定义为在接收点位置 $\\mathbf{x}_r$ 记录到的、由位于 $\\mathbf{x}_s$ 的脉冲源所产生的压力）在交换源和接收点位置时是对称的，\n$$\nG(\\mathbf{x}_s,\\mathbf{x}_r,t) = G(\\mathbf{x}_r,\\mathbf{x}_s,t).\n$$\n该性质被称为互易性。在计算地球物理学中，声波方程的有限差分离散化必须保持算子对称性，以维持离散互易性。非对称格式和阻尼层，例如完美匹配层 (PML) 边界处理中使用的那些，会破坏互易性，因为它们使得离散算子变为非自伴的。\n\n仅从声波方程、互易性的定义以及自伴性的概念出发，推导在使用对称中心差分和反射边界条件下，离散互易性应如何成立，并解释当使用非对称格式或近似 PML 行为的空间变化一阶阻尼项时，它如何被破坏。然后，实现一个二维声波方程时域有限差分求解器，以在以下三种情况下对离散互易性进行经验性测试：\n- 情况 A：对称中心差分拉普拉斯算子，无阻尼。\n- 情况 B：非对称前向差分拉普拉斯算子，无阻尼。\n- 情况 C：对称中心差分拉普拉斯算子，带有边界阻尼层（类似 PML 的海绵边界），通过在方程中添加额外项 $+\\sigma(\\mathbf{x})\\,\\partial_t p$ 来实现。\n\n使用以下科学上自洽的参数和单位：\n- 网格大小：$N_x = 64$, $N_y = 64$ 空间采样点。\n- 空间采样间隔：$\\Delta x = 10\\,\\mathrm{m}$, $\\Delta y = 10\\,\\mathrm{m}$。\n- 恒定波速：$c = 1500\\,\\mathrm{m/s}$。\n- 时间步长：$\\Delta t = 0.45\\,\\Delta x/(c\\sqrt{2})\\,\\mathrm{s}$。\n- 时间步数：$N_t = 400$。\n- 源子波：Ricker 子波，主频 $f_0 = 5\\,\\mathrm{Hz}$，峰值时间 $t_0 = 1.5/f_0\\,\\mathrm{s}$，\n$$\ns(t) = \\left(1 - 2\\pi^2 f_0^2 (t-t_0)^2\\right)\\,\\exp\\left(-\\pi^2 f_0^2 (t-t_0)^2\\right).\n$$\n- 无阻尼情况的边界条件：均匀 Dirichlet 边界，通过在每次更新后将区域边缘的 $p$ 设为 0 来实现。\n- 情况 C 的边界阻尼：厚度为 $N_{\\mathrm{pml}} = 12$ 个网格点的海绵边界剖面，其\n$$\n\\sigma(\\mathbf{x}) = \\begin{cases}\n\\sigma_{\\max}\\left(1 - \\frac{d(\\mathbf{x})}{N_{\\mathrm{pml}}}\\right)^2  \\text{若 } d(\\mathbf{x})  N_{\\mathrm{pml}}, \\\\\n0  \\text{其他情况},\n\\end{cases}\n$$\n其中 $d(\\mathbf{x})$ 是从 $\\mathbf{x}$ 到任意区域边界的最小距离（以网格点数为单位），且 $\\sigma_{\\max} = 50\\,\\mathrm{s}^{-1}$。\n- 源和接收点的索引对以网格索引 $(i,j)$ 给出，其中 $i\\in\\{0,\\dots,N_x-1\\}$，$j\\in\\{0,\\dots,N_y-1\\}$：\n    - 情况 A：$\\mathbf{x}_s = (32,20)$，$\\mathbf{x}_r = (42,44)$。\n    - 情况 B：$\\mathbf{x}_s = (32,20)$，$\\mathbf{x}_r = (42,44)$。\n    - 情况 C：$\\mathbf{x}_s = (14,14)$，$\\mathbf{x}_r = (50,40)$。\n\n使用二阶蛙跳格式进行时间离散步进，并为每种情况使用指定的空间格式。对于情况 C，在每个网格点上使用时间上的一阶后向差分来离散化阻尼项 $+\\sigma(\\mathbf{x})\\,\\partial_t p$，以获得完全显式的更新方案。\n\n对于每种情况，计算两个接收点时间序列 $g_A[n]$ 和 $g_B[n]$，$n\\in\\{0,\\dots,N_t-1\\}$，它们分别对应于在 $\\mathbf{x}_s$ 处激发、在 $\\mathbf{x}_r$ 处记录的压力，以及在 $\\mathbf{x}_r$ 处激发、在 $\\mathbf{x}_s$ 处记录的压力。通过归一化残差来量化互易性\n$$\n\\rho = \\frac{\\left\\|\\mathbf{g}_A - \\mathbf{g}_B\\right\\|_2}{\\max\\left(\\left\\|\\mathbf{g}_A\\right\\|_2,\\,\\left\\|\\mathbf{g}_B\\right\\|_2\\right)},\n$$\n该值为无量纲。每种情况报告一个 $\\rho$ 值。\n\n你的程序应产生单行输出，其中包含三个残差值，格式为方括号内由逗号分隔的列表，无空格，单位为无量纲。例如，格式必须与 $[\\rho_A,\\rho_B,\\rho_C]$ 完全一样。输出类型必须是包含三个浮点数的列表。测试套件即为上述三种情况，它们共同测试了理想情况（情况 A，对称格式且无阻尼）、一个重要的边界情况（情况 B，非对称格式破坏了自伴性）以及边界阻尼效应（情况 C，类似 PML 的 $\\sigma(\\mathbf{x})$ 层通过非自伴性破坏了互易性）。不允许用户输入；所有参数均按给定值固定。",
            "solution": "该问题要求首先对声波方程有限差分格式中的离散互易性进行理论推导，然后通过数值实现来验证所推导的原理。\n\n均匀介质中压力 $p(\\mathbf{x},t)$ 的二维声波方程由下式给出：\n$$\n\\partial_{tt} p(\\mathbf{x},t) - c^2 \\nabla^2 p(\\mathbf{x},t) = s(t)\\,\\delta(\\mathbf{x}-\\mathbf{x}_s)\n$$\n此处，$\\partial_{tt}$ 是关于时间 $t$ 的二阶偏导数，$c$ 是恒定波速，$\\nabla^2$ 是空间拉普拉斯算子，$s(t)$ 是震源时间函数，$\\delta(\\mathbf{x}-\\mathbf{x}_s)$ 代表位于 $\\mathbf{x}_s$ 的点源。\n\n互易性原理指的是，由位于 $\\mathbf{x}_s$ 的震源所引起、在接收点位置 $\\mathbf{x}_r$ 记录的波场，与由位于 $\\mathbf{x}_r$ 的震源所引起、在 $\\mathbf{x}_s$ 处记录的波场是完全相同的。在格林函数 $G(\\mathbf{x}_s, \\mathbf{x}_r, t)$ 的背景下，这表示为：\n$$\nG(\\mathbf{x}_s,\\mathbf{x}_r,t) = G(\\mathbf{x}_r,\\mathbf{x}_s,t)\n$$\n这一性质源于空间算子（此处为 $-c^2\\nabla^2$）的自伴性以及波动方程的时间反演对称性。当我们对该方程进行离散化时，这些性质必须在离散算子中得以保持，才能维持离散互易性。\n\n设压力场在网格上离散化为 $p_{i,j}^n \\approx p(i\\Delta x, j\\Delta y, n\\Delta t)$。一个通用的显式有限差分格式可以写成矩阵-向量形式。设 $\\mathbf{p}^n$ 是一个包含所有网格点在时间步 $n$ 的压力值的向量。标准的时间二阶蛙跳离散格式为：\n$$\n\\frac{\\mathbf{p}^{n+1} - 2\\mathbf{p}^n + \\mathbf{p}^{n-1}}{\\Delta t^2} - c^2 \\mathbf{L} \\mathbf{p}^n = \\mathbf{s}^n\n$$\n其中 $\\mathbf{L}$ 是代表离散拉普拉斯算子的矩阵，$\\mathbf{s}^n$ 是离散源向量。重新整理得到时间步进更新式：\n$$\n\\mathbf{p}^{n+1} = 2\\mathbf{p}^n - \\mathbf{p}^{n-1} + c^2 \\Delta t^2 \\mathbf{L} \\mathbf{p}^n + \\Delta t^2 \\mathbf{s}^n\n$$\n离散互易性成立的充分必要条件是，由矩阵 $\\mathbf{L}$ 代表的离散空间算子是对称的，即 $\\mathbf{L} = \\mathbf{L}^T$。这是自伴性质的离散对应。\n\n让我们分析问题中提出的三种情况。\n\n情况 A：对称中心差分拉普拉斯算子\n在网格点 $(i,j)$ 处，拉普拉斯算子的二阶中心差分近似为：\n$$\n(\\nabla^2 p)_{i,j} \\approx \\frac{p_{i+1,j} - 2p_{i,j} + p_{i-1,j}}{\\Delta x^2} + \\frac{p_{i,j+1} - 2p_{i,j} + p_{i,j-1}}{\\Delta y^2}\n$$\n当根据此格式构建矩阵 $\\mathbf{L}$ 时，表示网格点 $v$ 对网格点 $u$ 处拉普拉斯算子贡献的矩阵元素 $L_{uv}$ 仅在 $u$ 和 $v$ 是邻居时才非零。由于该格式的对称性，点 $j$ 对点 $i$ 方程的贡献与点 $i$ 对点 $j$ 方程的贡献是相同的。例如，对于两个水平相邻的点 $u=(i,j)$ 和 $v=(i+1,j)$，对应于 $u$ 的行和 $v$ 的列的系数是 $1/\\Delta x^2$，而对应于 $v$ 的行和 $u$ 的列的系数也是 $1/\\Delta x^2$。这确保了矩阵 $\\mathbf{L}$ 是对称的。通过在边界上强制压力为零来实现的均匀 Dirichlet 边界条件也遵守这种对称性。因此，离散算子是自伴的，我们预期离散互易性在机器精度范围内成立。互易性残差 $\\rho$ 应接近于零。\n\n情况 B：非对称前向差分拉普拉斯算子\n可以通过两次应用前向差分算子来构造拉普拉斯算子的非对称近似。$x$方向二阶导数的前向差分近似为：\n$$\n(\\partial_{xx} p)_{i,j} \\approx \\frac{p_{i+2,j} - 2p_{i+1,j} + p_{i,j}}{\\Delta x^2}\n$$\n由此产生的离散拉普拉斯算子 $\\mathbf{L}$ 不再是对称的。$p_{i,j}$ 的方程依赖于 $p_{i,j}$、$p_{i+1,j}$ 和 $p_{i+2,j}$ 的值。在矩阵 $\\mathbf{L}$ 中，对应于点 $(i,j)$ 的行将在对应于点 $(i,j)$、$(i+1,j)$ 和 $(i+2,j)$ 的列上有非零项。然而，对应于点 $(i+1,j)$ 的行将不会以相同的方式包含来自点 $(i,j)$ 的相应贡献。得到的矩阵是非对称的（$\\mathbf{L} \\neq \\mathbf{L}^T$），通常是一个带状矩阵，其非零项位于非关于主对角线对称的对角线上。这破坏了离散算子的自伴性，因此，预计离散互易性将被破坏。残差 $\\rho$ 应显著大于零。\n\n情况 C：带阻尼的对称拉普拉斯算子\n波动方程被一个一阶阻尼项修正为：\n$$\n\\partial_{tt} p + \\sigma(\\mathbf{x})\\,\\partial_t p - c^2 \\nabla^2 p = s(t)\\,\\delta(\\mathbf{x}-\\mathbf{x}_s)\n$$\n该项旨在吸收边界处的外行波，以模仿完美匹配层（PML）。我们对 $\\nabla^2 p$ 使用对称格式，但新项 $\\sigma(\\mathbf{x})\\,\\partial_t p$ 破坏了算子的整体对称性。使用一阶后向差分 $\\partial_t p \\approx (p^n - p^{n-1})/\\Delta t$ 对该项进行离散化，可以维持一个显式的更新方案。点 $(i,j)$ 的完整离散方程为：\n$$\n\\frac{p_{i,j}^{n+1} - 2p_{i,j}^n + p_{i,j}^{n-1}}{\\Delta t^2} + \\sigma_{i,j} \\frac{p_{i,j}^n - p_{i,j}^{n-1}}{\\Delta t} - c^2 (\\nabla^2 p^n)_{i,j} = s_{i,j}^n\n$$\n求解 $p_{i,j}^{n+1}$：\n$$\np_{i,j}^{n+1} = (2 - \\sigma_{i,j}\\Delta t) p_{i,j}^n - (1 - \\sigma_{i,j}\\Delta t) p_{i,j}^{n-1} + c^2 \\Delta t^2 (\\nabla^2 p^n)_{i,j} + \\Delta t^2 s_{i,j}^n\n$$\n阻尼项引入了耗散，这破坏了系统的时间反演对称性。一个有耗散的系统是非保守的。这种时间反演对称性的丧失与自伴性的丧失有根本的联系。即使空间拉普拉斯部分 $\\mathbf{L}$ 是对称的，控制演化的算子也不再是自伴的。因此，互易性被破坏。对于与阻尼层（$\\sigma(\\mathbf{x})  0$）相互作用的波路径，这种破坏将最为显著。我们预计残差 $\\rho$ 将显著不为零。\n\n下面的数值实现将计算这三种情况下的互易性残差 $\\rho$，以证实这些理论预期。",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the 2D acoustic wave equation using finite differences to test\n    the principle of discrete reciprocity under three different conditions.\n    \"\"\"\n\n    # --- Problem Parameters ---\n    Nx = 64  # Grid points in x\n    Ny = 64  # Grid points in y\n    dx = 10.0  # Spatial step in x (m)\n    dy = 10.0  # Spatial step in y (m)\n    c = 1500.0  # Wave speed (m/s)\n    Nt = 400  # Number of time steps\n    f0 = 5.0  # Peak frequency of Ricker wavelet (Hz)\n    Npml = 12 # Thickness of sponge layer (grid points)\n    sigma_max = 50.0 # Maximum damping coefficient (s^-1)\n\n    # Stability condition (CFL)\n    # dt = dx / (c * sqrt(2)) for dx=dy\n    # A factor of 0.45 is used, well within the stable limit of 1.\n    dt = 0.45 * dx / (c * np.sqrt(2))\n\n    t0 = 1.5 / f0  # Peak time of Ricker wavelet\n\n    # --- Test Case Definitions ---\n    test_cases = [\n        # Case A: Symmetric stencil, no damping\n        ('A', (32, 20), (42, 44)),\n        # Case B: Non-symmetric stencil, no damping\n        ('B', (32, 20), (42, 44)),\n        # Case C: Symmetric stencil, damping\n        ('C', (14, 14), (50, 40)),\n    ]\n\n    # --- Helper Functions ---\n    def ricker_wavelet(t, f0, t0):\n        \"\"\"Generates a Ricker wavelet.\"\"\"\n        arg = (np.pi * f0 * (t - t0))**2\n        return (1.0 - 2.0 * arg) * np.exp(-arg)\n\n    # Pre-calculate source time series\n    time_vec = np.arange(Nt) * dt\n    source_ts = ricker_wavelet(time_vec, f0, t0)\n    \n    # Pre-calculate damping profile for Case C\n    sigma = np.zeros((Nx, Ny), dtype=np.float64)\n    xx, yy = np.meshgrid(np.arange(Nx), np.arange(Ny), indexing='ij')\n    dist_to_left = xx\n    dist_to_right = Nx - 1 - xx\n    dist_to_top = yy\n    dist_to_bottom = Ny - 1 - yy\n    d = np.minimum.reduce([dist_to_left, dist_to_right, dist_to_top, dist_to_bottom])\n    pml_zone = d  Npml\n    sigma[pml_zone] = sigma_max * (1 - d[pml_zone] / Npml)**2\n\n    def run_simulation(src_pos, rec_pos, case_type):\n        \"\"\"\n        Runs a single FDTD simulation for a given setup.\n        \"\"\"\n        p_prev = np.zeros((Nx, Ny), dtype=np.float64)\n        p_now = np.zeros((Nx, Ny), dtype=np.float64)\n        p_next = np.zeros((Nx, Ny), dtype=np.float64)\n        \n        seismogram = np.zeros(Nt, dtype=np.float64)\n        \n        src_ix, src_iy = src_pos\n        rec_ix, rec_iy = rec_pos\n\n        # Source scaling to approximate Dirac delta\n        source_amp_scaled = source_ts / (dx * dy)\n\n        # Time-stepping loop\n        for n in range(Nt):\n            # Record pressure at receiver\n            seismogram[n] = p_now[rec_ix, rec_iy]\n            \n            # --- Calculate Laplacian ---\n            lap_p = np.zeros_like(p_now)\n            if case_type == 'A' or case_type == 'C':\n                # 5-point symmetric central-difference stencil\n                p_ip1 = p_now[2:, 1:-1]\n                p_im1 = p_now[0:-2, 1:-1]\n                p_jp1 = p_now[1:-1, 2:]\n                p_jm1 = p_now[1:-1, 0:-2]\n                p_cen = p_now[1:-1, 1:-1]\n                lap_p[1:-1, 1:-1] = (p_ip1 + p_im1 + p_jp1 + p_jm1 - 4 * p_cen) / dx**2\n            \n            elif case_type == 'B':\n                # Non-symmetric forward-difference second derivative\n                lap_p_x = np.zeros_like(p_now)\n                lap_p_y = np.zeros_like(p_now)\n                \n                # Forward difference for d^2/dx^2 and d^2/dy^2\n                # (f[i+2] - 2f[i+1] + f[i]) / h^2\n                # This stencil is valid for i in 0..Nx-3\n                lap_p_x[0:Nx-2, :] = (p_now[2:Nx, :] - 2 * p_now[1:Nx-1, :] + p_now[0:Nx-2, :]) / dx**2\n                lap_p_y[:, 0:Ny-2] = (p_now[:, 2:Ny] - 2 * p_now[:, 1:Ny-1] + p_now[:, 0:Ny-2]) / dy**2\n                lap_p = lap_p_x + lap_p_y\n\n            # --- Time update ---\n            c_eff = c * dt\n            if case_type == 'C':\n                # Update with damping\n                p_next = (2.0 - sigma * dt) * p_now - (1.0 - sigma * dt) * p_prev + c_eff**2 * lap_p\n            else:\n                # Standard leapfrog update\n                p_next = 2.0 * p_now - p_prev + c_eff**2 * lap_p\n            \n            # --- Add source ---\n            p_next[src_ix, src_iy] += source_amp_scaled[n] * dt**2\n            \n            # --- Apply boundary conditions ---\n            if case_type == 'A' or case_type == 'B':\n                # Homogeneous Dirichlet BC\n                p_next[0, :] = 0.0\n                p_next[-1, :] = 0.0\n                p_next[:, 0] = 0.0\n                p_next[:, -1] = 0.0\n            \n            # --- Update pressure fields ---\n            p_prev, p_now = p_now, p_next\n            \n        return seismogram\n\n    results = []\n    for case, src_pos, rec_pos in test_cases:\n        # Run simulation for (source, receiver)\n        g_A = run_simulation(src_pos, rec_pos, case)\n        \n        # Run simulation for (receiver, source)\n        g_B = run_simulation(rec_pos, src_pos, case)\n        \n        # Calculate normalized residual\n        norm_g_A = np.linalg.norm(g_A)\n        norm_g_B = np.linalg.norm(g_B)\n        norm_diff = np.linalg.norm(g_A - g_B)\n        \n        if max(norm_g_A, norm_g_B) == 0:\n            rho = 0.0\n        else:\n            rho = norm_diff / max(norm_g_A, norm_g_B)\n        \n        results.append(rho)\n\n    # Format and print the final output\n    print(f\"[{','.join(f'{r:.8f}' for r in results)}]\")\n\nsolve()\n```"
        }
    ]
}