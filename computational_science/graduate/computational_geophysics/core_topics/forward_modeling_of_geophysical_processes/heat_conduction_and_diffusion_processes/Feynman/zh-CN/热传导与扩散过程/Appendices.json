{
    "hands_on_practices": [
        {
            "introduction": "地球物理材料（如矿物晶体和层状岩石）的物理性质通常是各向异性的，这意味着它们在不同方向上有所不同。热导率就是这样一个性质，必须用一个二阶张量 $\\mathbf{K}$ 来精确描述，而非一个简单的标量。本练习将指导您完成一个基本但至关重要的任务：在坐标系旋转时正确地变换该张量。掌握这一技能对于在实际地理坐标中模拟具有特定晶体学或结构方向的岩石的热传导至关重要 。",
            "id": "3602771",
            "problem": "一块用于计算地球物理学的晶体岩石标本，在其热输运方面表现出正交各向异性，其主热导率分别为 $k_1$、$k_2$ 和 $k_3$，分别沿着晶轴 $\\hat{a}$、$\\hat{b}$ 和 $\\hat{c}$。在晶体坐标系中，热导率张量是对角的。在实验室（地理）笛卡尔坐标系 $(\\hat{x},\\hat{y},\\hat{z})$ 中，该标本的取向为：先绕 $\\hat{z}$ 轴偏航 $\\varphi$ 角，再绕 $\\hat{y}$ 轴倾斜 $\\theta$ 角。两个角度均以弧度为单位。热传导遵循傅里叶定律，其在笛卡尔坐标系中的表达式为 $\\boldsymbol{q}=-\\mathbf{K}\\,\\nabla T$，其中 $\\boldsymbol{q}$ 是热通量矢量，$\\mathbf{K}$ 是二阶热导率张量，$T$ 是温度。在适当的标准正交基变换下，矢量和梯度以相同的旋转方式进行变换，且标量缩并 $\\boldsymbol{q}\\cdot\\nabla T$ 是不变的。\n\n从这些原理出发，推导旋转后热导率张量的非对角分量 $K_{xz}$ 在实验室坐标系下的表达式。从晶体坐标系到实验室坐标系的旋转由以下矩阵定义：\n$$\n\\mathbf{R}=\\mathbf{R}_y(\\theta)\\,\\mathbf{R}_z(\\varphi),\n$$\n其中\n$$\n\\mathbf{R}_z(\\varphi)=\\begin{pmatrix}\n\\cos(\\varphi)  -\\sin(\\varphi)  0 \\\\\n\\sin(\\varphi)  \\cos(\\varphi)  0 \\\\\n0  0  1\n\\end{pmatrix},\\qquad\n\\mathbf{R}_y(\\theta)=\\begin{pmatrix}\n\\cos(\\theta)  0  \\sin(\\theta) \\\\\n0  1  0 \\\\\n-\\sin(\\theta)  0  \\cos(\\theta)\n\\end{pmatrix}.\n$$\n设晶体坐标系中的热导率张量为\n$$\n\\mathbf{K}_{\\mathrm{c}}=\\operatorname{diag}(k_1,k_2,k_3).\n$$\n利用物理定律 $\\boldsymbol{q}=-\\mathbf{K}\\,\\nabla T$ 在旋转下的不变性，求得实验室坐标系中旋转后的张量，然后写出 $K_{xz}$ 关于 $k_1$、$k_2$、$k_3$、$\\varphi$ 和 $\\theta$ 的闭式解析表达式。请提供您最终的 $K_{xz}$ 表达式，并以 $\\mathrm{W\\,m^{-1}\\,K^{-1}}$ 表示其物理单位。不需要进行数值计算。",
            "solution": "在尝试解答之前，需对问题陈述进行验证。\n\n### 问题验证\n\n**第1步：提取已知条件**\n- **物理系统**：具有正交热各向异性的晶体岩石。\n- **主热导率**：$k_1$、$k_2$、$k_3$，分别沿晶轴 $\\hat{a}$、$\\hat{b}$、$\\hat{c}$。\n- **晶体坐标系中的热导率张量**：$\\mathbf{K}_{\\mathrm{c}} = \\operatorname{diag}(k_1, k_2, k_3)$。\n- **控制方程**：傅里叶定律，$\\boldsymbol{q}=-\\mathbf{K}\\,\\nabla T$。\n- **坐标变换**：实验室坐标系 $(\\hat{x},\\hat{y},\\hat{z})$ 是通过从晶体坐标系进行一次旋转 $\\mathbf{R}=\\mathbf{R}_y(\\theta)\\,\\mathbf{R}_z(\\varphi)$ 得到的。\n- **旋转矩阵**：\n$$\n\\mathbf{R}_z(\\varphi)=\\begin{pmatrix}\n\\cos(\\varphi)  -\\sin(\\varphi)  0 \\\\\n\\sin(\\varphi)  \\cos(\\varphi)  0 \\\\\n0  0  1\n\\end{pmatrix},\\qquad\n\\mathbf{R}_y(\\theta)=\\begin{pmatrix}\n\\cos(\\theta)  0  \\sin(\\theta) \\\\\n0  1  0 \\\\\n-\\sin(\\theta)  0  \\cos(\\theta)\n\\end{pmatrix}.\n$$\n- **不变性条件**：标量缩并 $\\boldsymbol{q}\\cdot\\nabla T$ 在标准正交基变换下是不变的。\n- **目标**：推导实验室坐标系中热导率张量的非对角分量 $K_{xz}$ 的表达式。\n\n**第2步：使用提取的已知条件进行验证**\n1.  **科学依据**：该问题基于连续介质力学和热力学的既定原理，特别是各向异性介质中的热传导理论。使用二阶张量表示热导率及其在旋转下的变换是物理学和工程学中的标准概念。对于地球物理学研究的材料，该物理设置是现实的。\n2.  **适定性**：问题定义清晰，并提供了推导所求量所需的所有信息。初始张量、旋转操作和变换定律都已明确给出。存在唯一解，并且可以通过直接计算得到。\n3.  **客观性**：问题以精确、客观和定量的术语陈述，没有任何主观性或模糊性。\n\n该问题是自洽的、科学上合理的和适定的。验证标准中列出的缺陷均不存在。\n\n**第3步：结论与行动**\n问题有效。将提供解答。\n\n### 解答推导\n\n由二阶张量描述的物理性质，如热导率 $\\mathbf{K}$，在坐标系旋转下会发生变换。设晶体坐标系为未加撇的坐标系，实验室坐标系为加撇的坐标系。未加撇坐标系中的矢量 $\\mathbf{v}$ 变换到加撇坐标系中为 $\\mathbf{v}' = \\mathbf{R}\\mathbf{v}$。问题陈述，从晶体坐标系到实验室坐标系的旋转由矩阵 $\\mathbf{R}$ 给出。因此，我们记为 $\\mathbf{K}$ 的实验室坐标系中的热导率张量，与晶体坐标系中的热导率张量 $\\mathbf{K}_{\\mathrm{c}}$ 通过相似变换相关联：\n$$\n\\mathbf{K} = \\mathbf{R} \\mathbf{K}_{\\mathrm{c}} \\mathbf{R}^{T}\n$$\n其中 $\\mathbf{R}^{T}$ 是 $\\mathbf{R}$ 的转置。\n\n变换后张量 $\\mathbf{K}$ 的分量由下式给出：\n$$\nK_{ij} = \\sum_{l=1}^{3} \\sum_{m=1}^{3} R_{il} (K_{\\mathrm{c}})_{lm} R_{jm}\n$$\n由于 $\\mathbf{K}_{\\mathrm{c}}$ 是一个对角张量，其分量为 $(K_{\\mathrm{c}})_{lm} = k_l \\delta_{lm}$，其中 $\\delta_{lm}$ 是克罗内克 δ 符号，表达式可简化为：\n$$\nK_{ij} = \\sum_{l=1}^{3} R_{il} (k_l) R_{jl} = \\sum_{l=1}^{3} k_l R_{il} R_{jl}\n$$\n我们需要求解分量 $K_{xz}$，在矩阵索引表示法中对应于 $K_{13}$。设 $i=1$ 和 $j=3$，我们有：\n$$\nK_{xz} = K_{13} = \\sum_{l=1}^{3} k_l R_{1l} R_{3l} = k_1 R_{11} R_{31} + k_2 R_{12} R_{32} + k_3 R_{13} R_{33}\n$$\n下一步是计算旋转矩阵 $\\mathbf{R} = \\mathbf{R}_y(\\theta)\\mathbf{R}_z(\\varphi)$。\n$$\n\\mathbf{R} = \\begin{pmatrix}\n\\cos(\\theta)  0  \\sin(\\theta) \\\\\n0  1  0 \\\\\n-\\sin(\\theta)  0  \\cos(\\theta)\n\\end{pmatrix}\n\\begin{pmatrix}\n\\cos(\\varphi)  -\\sin(\\varphi)  0 \\\\\n\\sin(\\varphi)  \\cos(\\varphi)  0 \\\\\n0  0  1\n\\end{pmatrix}\n$$\n执行矩阵乘法得到：\n$$\n\\mathbf{R} = \\begin{pmatrix}\n\\cos(\\theta)\\cos(\\varphi)  -\\cos(\\theta)\\sin(\\varphi)  \\sin(\\theta) \\\\\n\\sin(\\varphi)  \\cos(\\varphi)  0 \\\\\n-\\sin(\\theta)\\cos(\\varphi)  \\sin(\\theta)\\sin(\\varphi)  \\cos(\\theta)\n\\end{pmatrix}\n$$\n从这个矩阵中，我们确定所需的分量：\n- $R_{11} = \\cos(\\theta)\\cos(\\varphi)$\n- $R_{12} = -\\cos(\\theta)\\sin(\\varphi)$\n- $R_{13} = \\sin(\\theta)$\n- $R_{31} = -\\sin(\\theta)\\cos(\\varphi)$\n- $R_{32} = \\sin(\\theta)\\sin(\\varphi)$\n- $R_{33} = \\cos(\\theta)$\n\n现在我们将这些分量代入 $K_{xz}$ 的表达式中：\n$$\nK_{xz} = k_1 (\\cos(\\theta)\\cos(\\varphi))(-\\sin(\\theta)\\cos(\\varphi)) + k_2 (-\\cos(\\theta)\\sin(\\varphi))(\\sin(\\theta)\\sin(\\varphi)) + k_3 (\\sin(\\theta))(\\cos(\\theta))\n$$\n简化每一项：\n$$\nK_{xz} = -k_1 \\sin(\\theta)\\cos(\\theta)\\cos^{2}(\\varphi) - k_2 \\sin(\\theta)\\cos(\\theta)\\sin^{2}(\\varphi) + k_3 \\sin(\\theta)\\cos(\\theta)\n$$\n我们可以提出公因式 $\\sin(\\theta)\\cos(\\theta)$：\n$$\nK_{xz} = \\sin(\\theta)\\cos(\\theta) \\left[ k_3 - k_1\\cos^{2}(\\varphi) - k_2\\sin^{2}(\\varphi) \\right]\n$$\n为了得到一个更具物理洞察力的形式，我们可以使用恒等式 $1 = \\cos^{2}(\\varphi) + \\sin^{2}(\\varphi)$ 来重写 $k_3$：\n$$\nK_{xz} = \\sin(\\theta)\\cos(\\theta) \\left[ k_3(\\cos^{2}(\\varphi) + \\sin^{2}(\\varphi)) - k_1\\cos^{2}(\\varphi) - k_2\\sin^{2}(\\varphi) \\right]\n$$\n将含有 $\\cos^{2}(\\varphi)$ 和 $\\sin^{2}(\\varphi)$ 的项分组：\n$$\nK_{xz} = \\sin(\\theta)\\cos(\\theta) \\left[ (k_3 - k_1)\\cos^{2}(\\varphi) + (k_3 - k_2)\\sin^{2}(\\varphi) \\right]\n$$\n这就是实验室坐标系中热导率张量 $K_{xz}$ 分量的最终闭式表达式。该表达式表明，仅当材料是各向异性的（即 $k_1, k_2, k_3$ 不全相等）且取向包含一个不为 $\\pi/2$ 整数倍的倾斜角 $\\theta$ 时，非对角分量 $K_{xz}$ 才不为零。热导率张量的每个分量（包括 $K_{xz}$）的物理单位是 $\\mathrm{W\\,m^{-1}\\,K^{-1}}$。",
            "answer": "$$\n\\boxed{\\sin(\\theta)\\cos(\\theta) \\left[ (k_3 - k_1)\\cos^{2}(\\varphi) + (k_3 - k_2)\\sin^{2}(\\varphi) \\right]}\n$$"
        },
        {
            "introduction": "建立控制方程后，下一个关键步骤是从中提取物理洞见。本练习探讨了一个典型的地球物理场景：侵入岩床的冷却。通过对该问题的分析，您将学习如何通过求解热传导方程并分析其解的渐近行为，来识别控制系统演化的主导物理机制。这个练习特别强调了毕渥数（Biot number, $\\mathrm{Bi}$）的重要性，它量化了内部传导热阻与表面对流换热热阻之间的比率，从而揭示了从边界控制到内部传导控制的转变 。",
            "id": "3602787",
            "problem": "一个厚度均匀为 $2L$、横向延伸的岩床，以初始均匀温度 $T_{i}$ 侵入到一个环境温度为 $T_{\\infty}$ 的较冷环境中。位于 $x=\\pm L$ 的岩床表面通过对流与周围流体进行热交换，传热系数为恒定的 $h$。该岩床是均匀且各向同性的，其密度为 $\\rho$、比热容为 $c$、热导率为 $k$，并且辐射传热可忽略不计。假设热传导是沿着板方向 $x$ 的一维过程，系统关于中平面 $x=0$ 对称，且所有热物理性质均为常数。从能量守恒和傅里叶热传导定律出发，根据第一性原理推导出控制模型，并计算与环境温度的空间平均温差的主导指数冷却时间尺度 $\\tau$。该时间尺度由温差 $\\theta(x,t)=T(x,t)-T_{\\infty}$ 的解的主导衰减常数所定义。\n\n引入毕渥数 $\\mathrm{Bi}=hL/k$，并分析 $\\mathrm{Bi}\\ll 1$ 和 $\\mathrm{Bi}\\gg 1$ 这两种渐近情况。在每种情况下，求出主导冷却时间尺度 $\\tau$ 作为 $L$、$h$、$k$、$\\rho$ 和 $c$ 函数的领头阶闭式解析表达式。请按 $\\mathrm{Bi}\\ll 1$ 然后 $\\mathrm{Bi}\\gg 1$ 的顺序，以两个表达式的形式给出最终答案。无需进行数值计算或四舍五入。最终的方框答案中请勿包含单位。",
            "solution": "合适的出发点是连续介质的局域能量守恒定律与傅里叶热传导定律相结合。令 $\\theta(x,t)=T(x,t)-T_{\\infty}$ 表示与环境温度的温差。对于密度为 $\\rho$、比热容为 $c$、热导率为 $k$ 的均匀介质，其内能平衡方程为\n$$\n\\rho c \\,\\frac{\\partial \\theta}{\\partial t} = k \\,\\frac{\\partial^{2} \\theta}{\\partial x^{2}},\n$$\n这便是一维瞬态热传导方程。它可以写作\n$$\n\\frac{\\partial \\theta}{\\partial t} = \\alpha \\,\\frac{\\partial^{2} \\theta}{\\partial x^{2}},\n$$\n其中热扩散率为 $\\alpha = \\frac{k}{\\rho c}$。根据对称性，求解域为半板 $0 \\le x \\le L$，初始条件为 $\\theta(x,0)=T_{i}-T_{\\infty}$。\n\n边界条件由对称性和对流换热确定。在中平面 $x=0$ 处，根据对称性，梯度为零，即\n$$\n\\left.\\frac{\\partial \\theta}{\\partial x}\\right|_{x=0} = 0.\n$$\n在表面 $x=L$ 处，傅里叶定律给出的传导热通量为 $-k \\,\\partial \\theta/\\partial x$，牛顿冷却定律给出的对流热通量为 $h\\,\\theta(L,t)$。边界处的能量平衡要求两者相等（即向外的传导通量等于对流损失），\n$$\n-k \\left.\\frac{\\partial \\theta}{\\partial x}\\right|_{x=L} = h\\,\\theta(L,t).\n$$\n\n我们通过分离变量法寻找模态解。令 $\\theta(x,t) = X(x)\\,G(t)$。将其代入热传导方程得到\n$$\nX(x)\\,\\frac{\\mathrm{d}G}{\\mathrm{d}t} = \\alpha\\,G(t)\\,\\frac{\\mathrm{d}^{2}X}{\\mathrm{d}x^{2}},\n$$\n分离变量后可得\n$$\n\\frac{1}{\\alpha}\\,\\frac{1}{G}\\,\\frac{\\mathrm{d}G}{\\mathrm{d}t} = \\frac{1}{X}\\,\\frac{\\mathrm{d}^{2}X}{\\mathrm{d}x^{2}} = -\\lambda,\n$$\n其中 $\\lambda>0$ 是一个分离常数（本征值）。时间因子为\n$$\nG(t) = G(0)\\,\\exp(-\\alpha \\lambda t),\n$$\n空间本征函数满足\n$$\n\\frac{\\mathrm{d}^{2}X}{\\mathrm{d}x^{2}} + \\lambda X = 0.\n$$\n其通解为\n$$\nX(x) = A \\cos(\\sqrt{\\lambda}\\,x) + B \\sin(\\sqrt{\\lambda}\\,x).\n$$\n在 $x=0$ 处的对称边界条件意味着 $X'(0)=0$，这得出 $B=0$。因此\n$$\nX(x) = A \\cos(\\sqrt{\\lambda}\\,x).\n$$\n在 $x=L$ 处施加对流边界条件，\n$$\n-k\\,X'(L) = h\\,X(L),\n$$\n得到\n$$\n-k\\left[-A \\sqrt{\\lambda} \\sin(\\sqrt{\\lambda}\\,L)\\right] = h\\left[A \\cos(\\sqrt{\\lambda}\\,L)\\right],\n$$\n或等价地写为\n$$\nk \\sqrt{\\lambda}\\,\\sin(\\sqrt{\\lambda}\\,L) = h \\cos(\\sqrt{\\lambda}\\,L).\n$$\n两边同除以 $k \\sqrt{\\lambda}\\,\\cos(\\sqrt{\\lambda}\\,L)$，得到\n$$\n\\tan(\\sqrt{\\lambda}\\,L) = \\frac{h}{k \\sqrt{\\lambda}}.\n$$\n定义无量纲本征值 $\\mu = \\sqrt{\\lambda}\\,L$。引入毕渥数 $\\mathrm{Bi} = \\frac{h L}{k}$，本征值条件变为\n$$\n\\tan(\\mu) = \\frac{\\mathrm{Bi}}{\\mu}\n\\quad\\Longleftrightarrow\\quad\n\\mu\\,\\tan(\\mu) = \\mathrm{Bi}.\n$$\n这个超越方程决定了一组离散的本征值 $\\mu_{n}$ ($n=1,2,\\dots$)，其相应的时间衰减率为 $\\alpha \\lambda_{n} = \\alpha \\mu_{n}^{2}/L^{2}$。任何容许的初始条件都可以用这些本征模展开，而在长时间后，解由衰减最慢的模态（$n=1$，对应最小的正本征值 $\\mu_{1}$）主导。\n\n空间平均温差的主导指数冷却时间尺度 $\\tau$ 由领头衰减率决定，\n$$\n\\tau = \\frac{1}{\\alpha \\lambda_{1}} = \\frac{L^{2}}{\\alpha \\mu_{1}^{2}}.\n$$\n为得到显式的闭式表达式，我们分析 $\\mathrm{Bi}$ 的两种渐近情况。\n\n情况 $\\mathrm{Bi}\\ll 1$（弱对流，集总参数极限）：\n对于小的 $\\mathrm{Bi}$，本征值 $\\mu_{1}$ 也很小。使用展开式 $\\tan(\\mu) = \\mu + \\frac{\\mu^{3}}{3} + \\mathcal{O}(\\mu^{5})$。代入 $\\mu \\tan(\\mu) = \\mathrm{Bi}$ 得到\n$$\n\\mu^{2} + \\frac{\\mu^{4}}{3} + \\mathcal{O}(\\mu^{6}) = \\mathrm{Bi}.\n$$\n取领头阶，$\\mu_{1}^{2} \\approx \\mathrm{Bi}$，因此\n$$\n\\tau \\approx \\frac{L^{2}}{\\alpha\\,\\mathrm{Bi}}.\n$$\n用材料参数表示，利用 $\\alpha = k/(\\rho c)$ 和 $\\mathrm{Bi} = hL/k$，\n$$\n\\tau \\approx \\frac{L^{2}}{(k/(\\rho c))\\,(hL/k)} = \\frac{\\rho c\\,L}{h}.\n$$\n这就是经典的集总参数时间尺度，它反映了当内部热传导使板内温度迅速达到平衡时，由边界控制的冷却过程。\n\n情况 $\\mathrm{Bi}\\gg 1$（强对流，内部传导受限）：\n对于大的 $\\mathrm{Bi}$，边界近似为等温的（温度等于环境温度），最小本征值趋近于狄利克雷-诺伊曼混合边界条件下的情况。令 $\\mu_{1} = \\frac{\\pi}{2} - \\varepsilon$，其中 $\\varepsilon \\ll 1$。使用 $\\tan\\left(\\frac{\\pi}{2}-\\varepsilon\\right) = \\cot(\\varepsilon) \\approx \\frac{1}{\\varepsilon} - \\frac{\\varepsilon}{3} + \\mathcal{O}(\\varepsilon^{3})$，我们发现\n$$\n\\mu_{1}\\,\\tan(\\mu_{1}) \\approx \\left(\\frac{\\pi}{2} - \\varepsilon\\right)\\left(\\frac{1}{\\varepsilon} - \\frac{\\varepsilon}{3}\\right)\n= \\frac{\\pi}{2}\\,\\frac{1}{\\varepsilon} - \\frac{\\pi}{6}\\,\\varepsilon - 1 + \\mathcal{O}(\\varepsilon^{3}).\n$$\n将领头项与 $\\mathrm{Bi}$ 平衡得到 $\\varepsilon \\approx \\frac{\\pi}{2\\,\\mathrm{Bi}}$。于是\n$$\n\\mu_{1}^{2} = \\left(\\frac{\\pi}{2} - \\varepsilon\\right)^{2} \\approx \\frac{\\pi^{2}}{4} - \\frac{\\pi^{2}}{2\\,\\mathrm{Bi}} + \\mathcal{O}\\!\\left(\\frac{1}{\\mathrm{Bi}^{2}}\\right).\n$$\n取领头阶，\n$$\n\\mu_{1}^{2} \\approx \\frac{\\pi^{2}}{4},\n\\qquad\n\\tau \\approx \\frac{L^{2}}{\\alpha\\,(\\pi^{2}/4)} = \\frac{4 L^{2}}{\\pi^{2}\\,\\alpha}.\n$$\n用材料参数表示，\n$$\n\\tau \\approx \\frac{4 L^{2}}{\\pi^{2}\\,(k/(\\rho c))} = \\frac{4 \\rho c\\,L^{2}}{\\pi^{2}\\,k}.\n$$\n这个传导受限的时间尺度反映了在表面温度被有效钉扎（在环境温度）的情况下，最慢的内部扩散模态。\n\n按要求的顺序（先 $\\mathrm{Bi}\\ll 1$ 后 $\\mathrm{Bi}\\gg 1$）收集领头阶结果，主导冷却时间尺度为\n$$\n\\tau \\approx \\frac{\\rho c\\,L}{h}\n\\quad\\text{for}\\quad \\mathrm{Bi}\\ll 1,\n\\qquad\n\\tau \\approx \\frac{4 \\rho c\\,L^{2}}{\\pi^{2}\\,k}\n\\quad\\text{for}\\quad \\mathrm{Bi}\\gg 1.\n$$",
            "answer": "$$\\boxed{\\begin{pmatrix}\\dfrac{\\rho c\\,L}{h} & \\dfrac{4\\,\\rho c\\,L^{2}}{\\pi^{2}\\,k}\\end{pmatrix}}$$"
        },
        {
            "introduction": "许多真实的地球物理问题由于其复杂的几何形状和不均匀的材料属性，无法获得解析解，必须依赖强大的数值方法。本练习是一个综合性的计算项目，要求您为一个具有挑战性的问题——在球体表面上具有非均匀热导率的稳态热传导——开发一个谱方法求解器。您将通过实现谱伽辽金方法（spectral Galerkin method）、使用球谐函数作为基函数以及应用预处理共轭梯度法（PCG）来解决该问题，从而将在偏微分方程、数值线性代数和科学计算方面的知识融会贯通 。",
            "id": "3602798",
            "problem": "考虑单位球面 $S^2$ 上的稳态热传导问题，其导热系数 $k(\\theta,\\phi)$ 非均匀，该问题由光滑流形上的守恒定律和傅里叶定律控制：求解在 $S^2$ 上均值为零的标量温度场 $T(\\theta,\\phi)$，满足\n$$\n\\nabla_s \\cdot \\left(k(\\theta,\\phi)\\,\\nabla_s T(\\theta,\\phi)\\right) = f(\\theta,\\phi)\n$$\n其中 $\\nabla_s$ 是曲面梯度算子，$\\nabla_s\\cdot$ 是曲面散度。算子 $\\nabla_s^2 = \\nabla_s\\cdot\\nabla_s$ 是 $S^2$ 上的拉普拉斯-贝尔特拉米算子。角度必须以弧度处理。\n\n本题将实现一种谱伽辽金方法，使用在 $l_{\\mathrm{max}}$ 阶截断的球谐函数基，并由对角拉普拉斯-贝尔特拉米谱进行预处理。未知数在一个实球谐函数基 $\\{Y_{\\alpha}(\\theta,\\phi)\\}$ 中展开，该基由模态 $\\alpha$ 索引，对应于一对 $(l,m)$ 和一个三角函数类型：\n- 对于 $m=0$：$Y_{l,0}(\\theta,\\phi) = N_{l,0} P_l^0(\\cos\\theta)$，\n- 对于 $m>0$（余弦类型）：$Y^{(c)}_{l,m}(\\theta,\\phi) = \\sqrt{2}\\,N_{l,m} P_l^m(\\cos\\theta)\\cos(m\\phi)$，\n- 对于 $m>0$（正弦类型）：$Y^{(s)}_{l,m}(\\theta,\\phi) = \\sqrt{2}\\,N_{l,m} P_l^m(\\cos\\theta)\\sin(m\\phi)$，\n其中 $P_l^m$ 是连带勒让德多项式，归一化系数 $N_{l,m}$ 为\n$$\nN_{l,m} = \\sqrt{\\frac{2l+1}{4\\pi}\\,\\frac{(l-m)!}{(l+m)!}}.\n$$\n该实数基在 $S^2$ 上关于曲面测度 $d\\Omega = \\sin\\theta\\,d\\theta\\,d\\phi$ 是标准正交的。刚度矩阵由弱形式定义\n$$\nA_{\\alpha\\beta} \\equiv \\int_{S^2} k(\\theta,\\phi)\\,\\nabla_s Y_\\beta(\\theta,\\phi)\\cdot\\nabla_s Y_\\alpha(\\theta,\\phi)\\,d\\Omega,\n$$\n载荷向量的分量为\n$$\nb_\\alpha \\equiv \\int_{S^2} f(\\theta,\\phi)\\,Y_\\alpha(\\theta,\\phi)\\,d\\Omega.\n$$\n预条件子 $M$ 必须在球谐函数基中是对角的，使用由面积加权平均热导率 $\\overline{k}$ 缩放的拉普拉斯-贝尔特拉米特征值：\n$$\nM_{\\alpha\\alpha} = \\overline{k}\\,l(l+1),\n$$\n适用于每个 $l\\ge 1$ 的激活模态。对应于 $l=0$ 的零空间必须从线性系统中排除（以强制执行零均值约束）。\n\n通过使用避免极点的中点进行等角求积来离散化曲面积分：\n- 在 $\\theta_i = \\left(i+\\frac{1}{2}\\right)\\frac{\\pi}{N_\\theta}$（对于 $i=0,\\dots,N_\\theta-1$）处使用 $N_\\theta$ 个极向样本，\n- 在 $\\phi_j = j\\frac{2\\pi}{N_\\phi}$（对于 $j=0,\\dots,N_\\phi-1$）处使用 $N_\\phi$ 个方位向样本，\n权重为 $w_{ij} = \\sin\\theta_i\\,\\Delta\\theta\\,\\Delta\\phi$，其中 $\\Delta\\theta=\\pi/N_\\theta$ 且 $\\Delta\\phi=2\\pi/N_\\phi$。对于刚度矩阵，被积函数使用\n$$\n\\nabla_s Y_\\beta\\cdot\\nabla_s Y_\\alpha = \\left(\\frac{\\partial Y_\\beta}{\\partial \\theta}\\frac{\\partial Y_\\alpha}{\\partial \\theta}\\right) + \\left(\\frac{1}{\\sin^2\\theta}\\frac{\\partial Y_\\beta}{\\partial \\phi}\\frac{\\partial Y_\\alpha}{\\partial \\phi}\\right).\n$$\n使用恒等式 $\\frac{\\partial}{\\partial \\theta}P_l^m(\\cos\\theta) = -\\sin\\theta\\,\\frac{d}{dx}P_l^m(x)\\big|_{x=\\cos\\theta}$ 计算极向导数，并对方位项使用精确的三角函数导数。右侧项必须取为具有零均值的实球谐函数的固定组合，\n$$\nf(\\theta,\\phi) = Y_{2,0}(\\theta,\\phi) + \\frac{1}{2}Y^{(c)}_{3,2}(\\theta,\\phi),\n$$\n从而在移除 $l=0$ 模态后保证可解性。\n\n热导率的非均匀性是光滑的，并由对比度因子 $r\\ge 1$ 参数化为\n$$\nk(\\theta,\\phi;r) = 1 + (r-1)\\,\\left(\\sin^4\\theta\\right)\\,\\left(\\cos^2(2\\phi)\\right),\n$$\n使得 $\\min k = 1$ 且 $\\max k = r$。面积加权平均热导率 $\\overline{k}$ 必须按如下方式计算\n$$\n\\overline{k} = \\frac{\\int_{S^2} k(\\theta,\\phi)\\,d\\Omega}{\\int_{S^2} d\\Omega}\n$$\n并使用相同的求积方法。\n\n实现一个预条件共轭梯度（PCG）求解器，用于求解激活模态 $l\\ge 1$ 的降维对称正定线性系统，相对残差 $\\|r\\|_2/\\|b\\|_2$ 的容差为 $\\varepsilon$，最大迭代次数为 $K_{\\max}$。预条件子的应用是逐元素的 $z = M^{-1}r$。初始化 $x=0$ 并迭代直至收敛。报告达到 $\\|r\\|_2/\\|b\\|_2 \\le \\varepsilon$ 所需的迭代次数。\n\n您的程序必须：\n- 完全按照测试套件中的规定使用截断阶数 $l_{\\mathrm{max}}$ 以及求积大小 $N_\\theta$ 和 $N_\\phi$，\n- 如上文所述通过求积组装 $A$ 和 $b$，\n- 从 $A$、$b$ 和 $M$ 中排除 $l=0$ 模态，\n- 使用 PCG 和球谐对角预条件子 $M$ 求解；不要使用任何外部迭代求解器例程。\n\n测试套件：\n- 情况 1：$N_\\theta=36$，$N_\\phi=72$，$l_{\\mathrm{max}}=9$，$r=1$，$\\varepsilon=10^{-8}$，$K_{\\max}=500$。\n- 情况 2：$N_\\theta=36$，$N_\\phi=72$，$l_{\\mathrm{max}}=9$，$r=10$，$\\varepsilon=10^{-8}$，$K_{\\max}=500$。\n- 情况 3：$N_\\theta=36$，$N_\\phi=72$，$l_{\\mathrm{max}}=9$，$r=100$，$\\varepsilon=10^{-8}$，$K_{\\max}=500$。\n- 情况 4：$N_\\theta=36$，$N_\\phi=72$，$l_{\\mathrm{max}}=9$，$r=1000$，$\\varepsilon=10^{-8}$，$K_{\\max}=500$。\n\n最终输出格式：\n您的程序应生成单行输出，其中包含四个情况的迭代次数，格式为方括号内的逗号分隔列表（例如，“[$i_1$,$i_2$,$i_3$,$i_4$]”），其中每个 $i_k$ 是一个整数。不得打印任何额外文本。",
            "solution": "用户希望使用谱伽辽金方法解决球体上的稳态热传导问题。\n\n### 1. 问题陈述的验证\n\n该问题旨在求解单位球面 $S^2$ 上的温度场 $T(\\theta, \\phi)$，该温度场由椭圆型偏微分方程控制：\n$$\n\\nabla_s \\cdot \\left(k(\\theta,\\phi)\\,\\nabla_s T(\\theta,\\phi)\\right) = f(\\theta,\\phi)\n$$\n其中包含一个指定的非均匀热导率 $k(\\theta,\\phi)$ 和一个源项 $f(\\theta,\\phi)$。解 $T$ 被约束为在球面上具有零均值，即 $\\int_{S^2} T\\,d\\Omega=0$。这是数学物理和地球物理学中的一个标准问题，通常被称为流形上的变系数类泊松方程。\n\n提出的求解方法是使用实球谐函数基的谱伽辽金法。对于球域上的问题，这是一种合适且强大的技术。该问题详细说明了所有必要的组成部分：基函数、推导线性系统的方法（弱形式）、数值积分（求积）方案、预条件子的结构以及迭代求解器（预条件共轭梯度法）。\n\n所有参数、函数和约束都定义明确且科学上一致。源项 $f(\\theta,\\phi)$ 由阶数 $l \\ge 1$ 的球谐函数组成，这正确地意味着 $\\int_{S^2} f\\,d\\Omega = 0$。这是偏微分方程解存在所必需的相容性条件。从解空间中移除 $l=0$（常数）模态可以正确地施加零均值约束，并确保最终的线性系统是非奇异的。该问题是适定的、计算上具体的，并且有科学依据的。因此，它被认为是有效的。\n\n### 2. 理论框架与算法设计\n\n#### 2.1. 弱形式与伽辽金方法\n第一步是推导偏微分方程的弱形式。我们将方程乘以一个均值为零的光滑测试函数 $v(\\theta, \\phi)$，并在球面 $S^2$ 上积分：\n$$\n\\int_{S^2} v \\left(\\nabla_s \\cdot (k \\nabla_s T)\\right) d\\Omega = \\int_{S^2} v f d\\Omega\n$$\n利用格林第一恒等式（流形上的分部积分法），并注意到球面没有边界，左侧变为：\n$$\n- \\int_{S^2} k(\\theta, \\phi) \\nabla_s v \\cdot \\nabla_s T \\, d\\Omega = \\int_{S^2} v f \\,d\\Omega\n$$\n伽辽金方法将未知温度场 $T$ 近似为基函数 $\\{Y_\\alpha\\}$ 的有限线性组合：\n$$\nT(\\theta, \\phi) \\approx \\sum_{\\beta} x_\\beta Y_\\beta(\\theta, \\phi)\n$$\n其中 $x_\\beta$ 是待确定的未知系数。基函数 $\\{Y_\\alpha\\}$ 是实球谐函数，在最大阶数 $l_{\\mathrm{max}}$ 处截断。由于 $T$ 必须具有零均值，我们从基中排除了 $Y_{0,0}$ 模态（它是一个常数）。\n\n我们选择测试函数 $v$ 为我们截断集合中的相同基函数 $Y_\\alpha$。将 $T$ 的展开式代入，并对集合中的每个基函数设置 $v = Y_\\alpha$，我们得到一个线性方程组 $Ax=b$：\n$$\n\\sum_{\\beta} \\left( \\int_{S^2} k(\\theta, \\phi) \\nabla_s Y_\\alpha \\cdot \\nabla_s Y_\\beta \\, d\\Omega \\right) x_\\beta = \\int_{S^2} Y_\\alpha f \\, d\\Omega\n$$\n这就定义了刚度矩阵 $A$ 和载荷向量 $b$：\n$$\nA_{\\alpha\\beta} = \\int_{S^2} k(\\theta, \\phi) \\nabla_s Y_\\alpha \\cdot \\nabla_s Y_\\beta \\, d\\Omega\n$$\n$$\nb_\\alpha = \\int_{S^2} f Y_\\alpha d\\Omega\n$$\n球坐标中曲面梯度的点积由以下公式给出：\n$$\n\\nabla_s Y_\\alpha \\cdot \\nabla_s Y_\\beta = \\frac{\\partial Y_\\alpha}{\\partial\\theta}\\frac{\\partial Y_\\beta}{\\partial\\theta} + \\frac{1}{\\sin^2\\theta} \\frac{\\partial Y_\\alpha}{\\partial\\phi}\\frac{\\partial Y_\\beta}{\\partial\\phi}\n$$\n\n#### 2.2. 数值组装\n$A_{\\alpha\\beta}$ 的积分是使用指定的等角求积法则进行数值计算的。球体被离散化为一个 $N_\\theta \\times N_\\phi$ 点 $(\\theta_i, \\phi_j)$ 的网格，并带有相关的权重 $w_{ij} = \\sin\\theta_i \\Delta\\theta \\Delta\\phi$。该积分通过这些网格点上的加权和来近似：\n$$\nA_{\\alpha\\beta} \\approx \\sum_{i,j} k(\\theta_i, \\phi_j) \\left( \\frac{\\partial Y_\\alpha}{\\partial\\theta}\\frac{\\partial Y_\\beta}{\\partial\\theta} + \\frac{1}{\\sin^2\\theta_i} \\frac{\\partial Y_\\alpha}{\\partial\\phi}\\frac{\\partial Y_\\beta}{\\partial\\phi} \\right)_{(\\theta_i, \\phi_j)} w_{ij}\n$$\n载荷向量 $b$ 可以直接确定。由于源项 $f(\\theta,\\phi) = Y_{2,0} + \\frac{1}{2}Y^{(c)}_{3,2}$ 是以基函数的线性组合形式给出的，并且基是标准正交的，所以系数 $b_\\alpha$ 就是展开式的系数。除了对应于模态 $Y_{2,0}$ 和 $Y^{(c)}_{3,2}$ 的分量外，$b$ 的所有分量都为零。\n\n#### 2.3. 预条件共轭梯度（PCG）求解器\n由此产生的线性系统 $Ax=b$ 是对称正定的，这使得共轭梯度（CG）方法成为一种有效的求解器。为了加速收敛，特别是对于高热导率对比度 $r$，我们采用了一个预条件子 $M$。一个好的预条件子 $M$ 应该是 $A$ 的一个近似，并且系统 $M^{-1}z = r$ 应该易于求解。\n\n该问题指定了一个基于拉普拉斯-贝尔特拉米算子特征值的对角预条件子，该特征值由平均热导率 $\\overline{k}$ 进行缩放。球谐函数是拉普拉斯-贝尔特拉米算子 $\\nabla_s^2 = \\nabla_s \\cdot \\nabla_s$ 的特征函数：\n$$\n\\nabla_s^2 Y_\\alpha = -l(l+1) Y_\\alpha\n$$\n对于常数热导率 $k(\\theta,\\phi) = \\overline{k}$，算子变为 $\\overline{k} \\nabla_s^2$，刚度矩阵 $A$ 将是对角的，其对角元为 $\\overline{k}\\, l(l+1)$。这建议使用一个预条件子：\n$$\nM_{\\alpha\\alpha} = \\overline{k}\\, l_\\alpha(l_\\alpha+1)\n$$\n其中 $l_\\alpha$ 是模态 $Y_\\alpha$ 的阶数。这个矩阵是对角的，因此它的逆很容易计算。平均热导率 $\\overline{k}$ 使用相同的求积法则计算：\n$$\n\\overline{k} = \\frac{\\sum_{i,j} k(\\theta_i, \\phi_j) w_{ij}}{\\sum_{i,j} w_{ij}}\n$$\nPCG 算法通过最小化误差的 A-范数来迭代地找到解 $x$。它维护一个残差序列 $r_k$、搜索方向序列 $p_k$ 和预处理后的残差序列 $z_k = M^{-1}r_k$。\n\n该算法按以下步骤进行：\n1. 初始化解 $x_0 = 0$，残差 $r_0 = b$，预处理后的残差 $z_0 = M^{-1}r_0$，以及搜索方向 $p_0 = z_0$。\n2. 对于 $k = 0, 1, 2, \\ldots$ 直到收敛：\n   a. 计算矩阵向量乘积：$v_k = A p_k$。\n   b. 计算步长：$\\alpha_k = (r_k^T z_k) / (p_k^T v_k)$。\n   c. 更新解：$x_{k+1} = x_k + \\alpha_k p_k$。\n   d. 更新残差：$r_{k+1} = r_k - \\alpha_k v_k$。\n   e. 检查收敛性：如果 $\\|r_{k+1}\\|_2 / \\|b\\|_2 \\le \\varepsilon$，停止。\n   f. 更新预处理后的残差：$z_{k+1} = M^{-1}r_{k+1}$。\n   g. 计算改进因子：$\\beta_k = (r_{k+1}^T z_{k+1}) / (r_k^T z_k)$。\n   h. 更新搜索方向：$p_{k+1} = z_{k+1} + \\beta_k p_k$。\n\n收敛所需的迭代次数是衡量预条件子有效性和系统条件数的指标，它受热导率对比度 $r$ 的影响。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import lpmn, factorial\n\ndef pcg_solve(A, b, M_inv, tol, max_iter):\n    \"\"\"\n    Solves the linear system Ax=b using the Preconditioned Conjugate Gradient method.\n    \"\"\"\n    x = np.zeros_like(b)\n    r = b - A @ x\n    \n    b_norm = np.linalg.norm(b)\n    if b_norm == 0:\n        return 0\n\n    if np.linalg.norm(r) / b_norm < tol:\n        return 0\n\n    z = M_inv * r\n    p = z.copy()\n    rs_old = np.dot(r, z)\n\n    if rs_old == 0:\n        return 1\n\n    for k in range(max_iter):\n        Ap = A @ p\n        alpha = rs_old / np.dot(p, Ap)\n        \n        x += alpha * p\n        r -= alpha * Ap\n\n        rel_res = np.linalg.norm(r) / b_norm\n        if rel_res < tol:\n            return k + 1\n\n        z = M_inv * r\n        rs_new = np.dot(r, z)\n\n        beta = rs_new / rs_old\n        p = z + beta * p\n        rs_old = rs_new\n        \n    return max_iter\n\nclass SpectralSolver:\n    \"\"\"\n    Implements the spectral Galerkin method for steady heat conduction on a sphere.\n    \"\"\"\n    def __init__(self, l_max, N_theta, N_phi):\n        self.l_max = l_max\n        self.N_theta = N_theta\n        self.N_phi = N_phi\n        \n        self._generate_mode_info()\n        self._setup_grid()\n        self._precompute_basis_functions()\n\n    def _generate_mode_info(self):\n        self.mode_info = []\n        for l in range(1, self.l_max + 1):\n            # m = 0 mode\n            self.mode_info.append({'l': l, 'm': 0, 'type': 'z'})\n            for m in range(1, l + 1):\n                # m > 0 cosine mode\n                self.mode_info.append({'l': l, 'm': m, 'type': 'c'})\n                # m > 0 sine mode\n                self.mode_info.append({'l': l, 'm': m, 'type': 's'})\n        self.num_active_modes = len(self.mode_info)\n\n    def _setup_grid(self):\n        theta = (np.arange(self.N_theta) + 0.5) * (np.pi / self.N_theta)\n        phi = np.arange(self.N_phi) * (2 * np.pi / self.N_phi)\n        self.theta_grid, self.phi_grid = np.meshgrid(theta, phi, indexing='ij')\n        \n        delta_theta = np.pi / self.N_theta\n        delta_phi = 2 * np.pi / self.N_phi\n        self.weights = np.sin(self.theta_grid) * delta_theta * delta_phi\n\n    def _precompute_basis_functions(self):\n        # Precompute Legendre polynomials and their derivatives\n        cos_theta_1d = np.cos(self.theta_grid[:, 0])\n        plm_vals, plm_derivs = lpmn(self.l_max, self.l_max, cos_theta_1d)\n\n        self.Y_grid = np.zeros((self.num_active_modes, self.N_theta, self.N_phi))\n        self.dY_dtheta_grid = np.zeros_like(self.Y_grid)\n        self.dY_dphi_grid = np.zeros_like(self.Y_grid)\n        \n        sin_theta = np.sin(self.theta_grid)\n\n        for idx, mode in enumerate(self.mode_info):\n            l, m = mode['l'], mode['m']\n            \n            # Normalization constant N_lm\n            norm_factor = np.sqrt(((2 * l + 1) / (4 * np.pi)) * (factorial(l - m) / factorial(l + m)))\n            \n            # Legendre polynomials and derivatives for this mode\n            P_lm = plm_vals[m, l, :].reshape(-1, 1)\n            dP_lm_dx = plm_derivs[m, l, :].reshape(-1, 1)\n            dP_lm_dtheta = -sin_theta[:, 0].reshape(-1, 1) * dP_lm_dx\n\n            cos_m_phi = np.cos(m * self.phi_grid[0, :])\n            sin_m_phi = np.sin(m * self.phi_grid[0, :])\n            \n            if m == 0:  # Zonal harmonics\n                self.Y_grid[idx, :, :] = norm_factor * P_lm\n                self.dY_dtheta_grid[idx, :, :] = norm_factor * dP_lm_dtheta\n                self.dY_dphi_grid[idx, :, :] = 0.0\n            else:\n                prefactor = np.sqrt(2) * norm_factor\n                if mode['type'] == 'c':  # Cosine type\n                    self.Y_grid[idx, :, :] = prefactor * P_lm * cos_m_phi\n                    self.dY_dtheta_grid[idx, :, :] = prefactor * dP_lm_dtheta * cos_m_phi\n                    self.dY_dphi_grid[idx, :, :] = -prefactor * m * P_lm * sin_m_phi\n                else:  # Sine type\n                    self.Y_grid[idx, :, :] = prefactor * P_lm * sin_m_phi\n                    self.dY_dtheta_grid[idx, :, :] = prefactor * dP_lm_dtheta * sin_m_phi\n                    self.dY_dphi_grid[idx, :, :] = prefactor * m * P_lm * cos_m_phi\n\n    def assemble_and_solve(self, r, tol, max_iter):\n        # 1. Assemble stiffness matrix A\n        k_grid = 1 + (r - 1) * (np.sin(self.theta_grid)**4) * (np.cos(2 * self.phi_grid)**2)\n        \n        A = np.zeros((self.num_active_modes, self.num_active_modes))\n        inv_sin2_theta = 1.0 / np.sin(self.theta_grid)**2\n\n        for i in range(self.num_active_modes):\n            for j in range(i, self.num_active_modes):\n                integrand = k_grid * (\n                    self.dY_dtheta_grid[i] * self.dY_dtheta_grid[j] +\n                    inv_sin2_theta * self.dY_dphi_grid[i] * self.dY_dphi_grid[j]\n                )\n                A[i, j] = np.sum(integrand * self.weights)\n                if i != j:\n                    A[j, i] = A[i, j]\n\n        # 2. Assemble load vector b\n        b = np.zeros(self.num_active_modes)\n        # Find indices for f = Y_{2,0} + 0.5 * Y^{(c)}_{3,2}\n        idx_2_0 = next(i for i, mode in enumerate(self.mode_info) if mode['l'] == 2 and mode['m'] == 0)\n        idx_3_2_c = next(i for i, mode in enumerate(self.mode_info) if mode['l'] == 3 and mode['m'] == 2 and mode['type'] == 'c')\n        b[idx_2_0] = 1.0\n        b[idx_3_2_c] = 0.5\n\n        # 3. Assemble preconditioner M\n        k_bar = np.sum(k_grid * self.weights) / np.sum(self.weights)\n        M_diag = np.array([k_bar * mode['l'] * (mode['l'] + 1) for mode in self.mode_info])\n        M_inv_diag = 1.0 / M_diag\n        \n        # 4. Solve using PCG\n        iterations = pcg_solve(A, b, M_inv_diag, tol, max_iter)\n        return iterations\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    test_cases = [\n        # (N_theta, N_phi, l_max, r, epsilon, K_max)\n        (36, 72, 9, 1, 1e-8, 500),\n        (36, 72, 9, 10, 1e-8, 500),\n        (36, 72, 9, 100, 1e-8, 500),\n        (36, 72, 9, 1000, 1e-8, 500),\n    ]\n\n    N_theta, N_phi, l_max = test_cases[0][:3]\n    solver = SpectralSolver(l_max, N_theta, N_phi)\n\n    results = []\n    for _, _, _, r, epsilon, K_max in test_cases:\n        iterations = solver.assemble_and_solve(r, epsilon, K_max)\n        results.append(iterations)\n\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n\n```"
        }
    ]
}