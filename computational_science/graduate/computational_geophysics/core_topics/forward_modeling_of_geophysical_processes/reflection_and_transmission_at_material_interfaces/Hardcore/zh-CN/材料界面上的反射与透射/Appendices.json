{
    "hands_on_practices": [
        {
            "introduction": "本练习将基础的法向入射扩展到更普遍的斜入射情况，这是地球物理勘探中的常见场景。通过推导基于慢度的反射系数公式，你将应用互易原理——一个深刻的物理定律——来验证你的计算结果。这项实践不仅能加深你对波在界面处行为的理解，还能培养你设计数值验证方案的关键技能。",
            "id": "3613481",
            "problem": "考虑一个位于 $z=0$ 的单一平面界面，该界面分隔了两种均匀、各向同性的声学流体，标记为介质 $1$（$z0$）和介质 $2$（$z>0$）。每种介质的特性由密度 $\\rho$（单位：$\\mathrm{kg/m^3}$）和压缩（声）波速度 $c$（单位：$\\mathrm{m/s}$）描述。一个角频率为 $\\omega$ 的时谐平面波在 $x$-$z$ 平面内传播，其水平慢度为 $p$（单位：$\\mathrm{s/m}$），因此相位为 $\\omega \\left(p x + q z - t\\right)$，其中 $q$ 是满足色散关系的垂直慢度。假设介质无损，并且除了声波的反射和透射外，没有其他模式转换。中间推导过程中出现的所有角度均以弧度为单位。\n\n从适用于计算地球物理学的第一性原理出发，使用以下基础：\n- 通过声速 $c$ 和密度 $\\rho$ 联系压力 $p(x,z,t)$ 和质点速度 $\\mathbf{v}(x,z,t)$ 的声学本构关系和运动方程，以及均匀介质中的平面波解。\n- 在界面 $z=0$ 处的压力连续性和质点速度法向分量连续性的边界条件。\n- 以慢度形式表示的界面处平面波的斯涅尔定律：水平慢度 $p$ 跨界面守恒。\n\n定义介质 $j\\in\\{1,2\\}$ 中声波的垂直慢度为\n$$\nq_j = \\sqrt{\\frac{1}{c_j^2} - p^2},\n$$\n以及入射/透射角（相对于界面法线）的余弦为\n$$\n\\cos\\theta_j = c_j q_j = \\sqrt{1 - \\left(p c_j\\right)^2}.\n$$\n定义介质 $j$ 中与角度相关的法向比声阻抗为\n$$\nZ_j^{(n)} = \\frac{\\rho_j c_j}{\\cos\\theta_j}.\n$$\n\n任务：\n1. 从边界条件和平面波运动学出发，推导从介质 $1$ 入射到介质 $2$ 的压力反射系数（记为 $R_{12}(p)$），以及从介质 $2$ 入射到介质 $1$ 的压力反射系数（记为 $R_{21}(p)$），两者都在相同的水平慢度 $p$ 下。\n2. 利用互易性并仔细考虑质点速度法向分量方向的符号，展示对从两侧计算的反射率进行数值交叉检验所需的适当归一化。具体而言，解释为什么将 $R_{12}(p)$ 与 $-R_{21}(p)$ 进行比较是界面处压力反射率基于互易性的正确归一化方法，并解释为什么在理想无损声学中，对于所有容许的 $p$ 值，该比较应得出相等的结果。\n3. 实现一个程序，对于每个给定的测试用例，使用上述基于基本原理推导出的物理有效表达式计算 $R_{12}(p)$ 和 $R_{21}(p)$，然后评估其绝对差\n$$\n\\Delta(p) = \\left|R_{12}(p) - \\left(-R_{21}(p)\\right)\\right|.\n$$\n您的程序应为每个测试用例返回一个浮点数 $\\Delta(p)$。\n\n重要实现细节：\n- 使用基于慢度的表达式计算 $\\cos\\theta_j = \\sqrt{1 - \\left(p c_j\\right)^2}$；为确保科学真实性，测试套件中只应包含 $p  \\min\\left\\{\\frac{1}{c_1},\\frac{1}{c_2}\\right\\}$ 的情况，以使 $\\cos\\theta_1$ 和 $\\cos\\theta_2$ 均为实数且非负，对应于两种介质中均无衰减波的传播波。\n- 反射系数是无量纲的；以无量纲浮点数形式返回绝对差 $\\Delta(p)$。\n- 数值角度通过 $\\cos\\theta_j$ 隐式给出；如果需要明确报告任何角度，其单位应为弧度。无需输出任何角度。\n- 最终输出必须是单行文本，包含所有测试用例的结果，形式为方括号内以逗号分隔的列表，例如 `[0.0,0.0,0.0]`。\n\n测试套件：\n为以下科学上合理的案例计算 $\\Delta(p)$（所有参数单位为 $\\mathrm{kg/m^3}$、$\\mathrm{m/s}$，以及 $p$ 的单位为 $\\mathrm{s/m}$）：\n- 案例 $1$（一般性差异，斜入射）：$(\\rho_1,c_1,\\rho_2,c_2,p) = (1000,1500,2200,1800,0.0002)$。\n- 案例 $2$（法向入射）：$(\\rho_1,c_1,\\rho_2,c_2,p) = (1000,1500,2200,1800,0.0)$。\n- 案例 $3$（相同介质）：$(\\rho_1,c_1,\\rho_2,c_2,p) = (2000,2500,2000,2500,0.0001)$。\n- 案例 $4$（在较快介质中接近临界角，仍为传播波）：$(\\rho_1,c_1,\\rho_2,c_2,p) = (1800,1800,2200,2500,0.000399)$。\n- 案例 $5$（强阻抗差异，斜入射）：$(\\rho_1,c_1,\\rho_2,c_2,p) = (1000,1500,2700,6000,0.00015)$。\n\n答案规格：\n- 对于每个案例，以完整的双精度准确度计算 $\\Delta(p)$ 并以浮点数形式返回。\n- 您的程序应生成单行输出，其中包含一个由方括号括起来的逗号分隔列表的结果，例如 `[\\Delta_1,\\Delta_2,\\Delta_3,\\Delta_4,\\Delta_5]`，不含多余的空格或注释。",
            "solution": "该问题要求推导和数值验证两种声学流体介质之间平面界面上的压力反射系数。解答将按要求分为三部分进行：首先，推导反射系数 $R_{12}(p)$ 和 $R_{21}(p)$；其次，解释它们之间的互易关系；第三，设计一个数值算法来验证此关系。\n\n### 第1部分：反射系数的推导\n\n我们从流体中声波传播的第一性原理开始。对于时谐平面波，压力场 $P$ 和质点速度场 $\\mathbf{v}$ 之间的关系由线性化的运动方程 $\\rho \\frac{\\partial \\mathbf{v}}{\\partial t} = -\\nabla P$ 决定。对于形式为 $P(x,z,t) = P_0 e^{i\\omega(px + qz - t)}$ 的平面波，其中 $p$ 是水平慢度，$q$ 是垂直慢度，其梯度为 $\\nabla P = i\\omega(p\\hat{\\mathbf{x}} + q\\hat{\\mathbf{z}})P$。速度的时间导数为 $\\frac{\\partial \\mathbf{v}}{\\partial t} = -i\\omega\\mathbf{v}$。将这些代入运动方程得到：\n$\\rho(-i\\omega\\mathbf{v}) = -i\\omega(p\\hat{\\mathbf{x}} + q\\hat{\\mathbf{z}})P$\n$\\mathbf{v} = \\frac{1}{\\rho}(p\\hat{\\mathbf{x}} + q\\hat{\\mathbf{z}})P$\n\n垂直于界面 $z=0$ 的质点速度分量是 $z$ 分量，即 $v_z$：\n$v_z = \\frac{q}{\\rho} P$\n\n$q$ 的符号决定了垂直传播的方向。我们采用惯例，$q_j = \\sqrt{1/c_j^2 - p^2}$ 对于沿 $+z$ 方向传播的波（下行波）为正，其垂直相位项为 $e^{i\\omega q_j z}$。沿 $-z$ 方向传播的波（上行波）的垂直相位项为 $e^{-i\\omega q_j z}$，这对应于 $-q_j$ 的垂直慢度。\n\n**推导 $R_{12}(p)$：从介质 1 入射**\n\n对于从介质 $1$ ($z0$) 入射到介质 $2$ ($z>0$) 的情况，总波场由介质 $1$ 中的入射波 ($I$) 和反射波 ($R$)，以及介质 $2$ 中的透射波 ($T$) 组成。\n\n在介质 $1$ ($z0$) 中：\n压力为 $P_1 = P_I + P_R$。入射波是下行的（$+q_1$），反射波是上行的（$-q_1$）。\n$P_1(x,z,t) = \\left( A_I e^{i\\omega q_1 z} + A_R e^{-i\\omega q_1 z} \\right) e^{i\\omega(px - t)}$\n法向速度 $v_{z,1}$ 是入射波和反射波贡献的总和：\n$v_{z,1} = \\frac{q_1}{\\rho_1} P_I + \\frac{-q_1}{\\rho_1} P_R = \\frac{q_1}{\\rho_1} (P_I - P_R) = \\frac{q_1}{\\rho_1} \\left( A_I e^{i\\omega q_1 z} - A_R e^{-i\\omega q_1 z} \\right) e^{i\\omega(px - t)}$\n\n在介质 $2$ ($z>0$) 中：\n压力 $P_2 = P_T$ 仅包含下行（$+q_2$）的透射波。\n$P_2(x,z,t) = A_T e^{i\\omega q_2 z} e^{i\\omega(px - t)}$\n法向速度 $v_{z,2}$ 为：\n$v_{z,2} = \\frac{q_2}{\\rho_2} P_T = \\frac{q_2}{\\rho_2} A_T e^{i\\omega q_2 z} e^{i\\omega(px - t)}$\n\n在界面 $z=0$ 处的边界条件是压力连续（$P_1=P_2$）和法向质点速度连续（$v_{z,1}=v_{z,2}$）。\n$1$. $P_1(z=0) = P_2(z=0) \\implies A_I + A_R = A_T$\n$2$. $v_{z,1}(z=0) = v_{z,2}(z=0) \\implies \\frac{q_1}{\\rho_1}(A_I - A_R) = \\frac{q_2}{\\rho_2}A_T$\n\n压力反射系数为 $R_{12}(p) = A_R / A_I$。将第一个方程中的 $A_T$ 代入第二个方程：\n$\\frac{q_1}{\\rho_1}(A_I - A_R) = \\frac{q_2}{\\rho_2}(A_I + A_R)$\n两边除以 $A_I$：\n$\\frac{q_1}{\\rho_1}(1 - R_{12}) = \\frac{q_2}{\\rho_2}(1 + R_{12})$\n重新整理以求解 $R_{12}$：\n$\\frac{q_1}{\\rho_1} - \\frac{q_2}{\\rho_2} = R_{12} \\left(\\frac{q_1}{\\rho_1} + \\frac{q_2}{\\rho_2}\\right) \\implies R_{12}(p) = \\frac{\\frac{q_1}{\\rho_1} - \\frac{q_2}{\\rho_2}}{\\frac{q_1}{\\rho_1} + \\frac{q_2}{\\rho_2}}$\n\n使用问题中定义的与角度相关的法向比声阻抗，$Z_j^{(n)} = \\frac{\\rho_j c_j}{\\cos\\theta_j} = \\frac{\\rho_j c_j}{c_j q_j} = \\frac{\\rho_j}{q_j}$，我们可以写出 $\\frac{q_j}{\\rho_j} = \\frac{1}{Z_j^{(n)}}$。\n将此代入 $R_{12}$ 的表达式：\n$$\nR_{12}(p) = \\frac{\\frac{1}{Z_1^{(n)}} - \\frac{1}{Z_2^{(n)}}}{\\frac{1}{Z_1^{(n)}} + \\frac{1}{Z_2^{(n)}}} = \\frac{Z_2^{(n)} - Z_1^{(n)}}{Z_2^{(n)} + Z_1^{(n)}}\n$$\n\n**推导 $R_{21}(p)$：从介质 2 入射**\n\n现在，入射波在介质 $2$ 中，向上（$-z$方向）传播。\n在介质 $2$ ($z>0$) 中：\n入射波是上行的（$-q_2$），反射波是下行的（$+q_2$）。\n$P_2(x,z,t) = \\left( A'_I e^{-i\\omega q_2 z} + A'_R e^{i\\omega q_2 z} \\right) e^{i\\omega(px - t)}$\n$v_{z,2} = \\frac{-q_2}{\\rho_2}P'_I + \\frac{q_2}{\\rho_2}P'_R = \\frac{q_2}{\\rho_2}(-A'_I e^{-i\\omega q_2 z} + A'_R e^{i\\omega q_2 z}) e^{i\\omega(px - t)}$\n\n在介质 $1$ ($z0$) 中：\n透射波是上行的（$-q_1$）。\n$P_1(x,z,t) = A'_T e^{-i\\omega q_1 z} e^{i\\omega(px - t)}$\n$v_{z,1} = \\frac{-q_1}{\\rho_1}P'_T = \\frac{-q_1}{\\rho_1}A'_T e^{-i\\omega q_1 z} e^{i\\omega(px - t)}$\n\n在 $z=0$ 处应用边界条件：\n$1$. $P_1(z=0) = P_2(z=0) \\implies A'_T = A'_I + A'_R$\n$2$. $v_{z,1}(z=0) = v_{z,2}(z=0) \\implies \\frac{-q_1}{\\rho_1} A'_T = \\frac{q_2}{\\rho_2}(-A'_I + A'_R)$\n\n反射系数为 $R_{21}(p) = A'_R / A'_I$。代入 $A'_T$：\n$\\frac{-q_1}{\\rho_1}(A'_I + A'_R) = \\frac{q_2}{\\rho_2}(-A'_I + A'_R)$\n两边除以 $A'_I$：\n$\\frac{-q_1}{\\rho_1}(1 + R_{21}) = \\frac{q_2}{\\rho_2}(-1 + R_{21})$\n重新整理：\n$\\frac{q_2}{\\rho_2} - \\frac{q_1}{\\rho_1} = R_{21}\\left(\\frac{q_1}{\\rho_1} + \\frac{q_2}{\\rho_2}\\right) \\implies R_{21}(p) = \\frac{\\frac{q_2}{\\rho_2} - \\frac{q_1}{\\rho_1}}{\\frac{q_1}{\\rho_1} + \\frac{q_2}{\\rho_2}}$\n\n用法向阻抗表示：\n$$\nR_{21}(p) = \\frac{\\frac{1}{Z_2^{(n)}} - \\frac{1}{Z_1^{(n)}}}{\\frac{1}{Z_1^{(n)}} + \\frac{1}{Z_2^{(n)}}} = \\frac{Z_1^{(n)} - Z_2^{(n)}}{Z_1^{(n)} + Z_2^{(n)}}\n$$\n\n### 第2部分：互易性与归一化\n\n通过比较两个反射系数的推导表达式：\n$R_{12}(p) = \\frac{Z_2^{(n)} - Z_1^{(n)}}{Z_2^{(n)} + Z_1^{(n)}}$\n$R_{21}(p) = \\frac{Z_1^{(n)} - Z_2^{(n)}}{Z_1^{(n)} + Z_2^{(n)}} = -\\frac{Z_2^{(n)} - Z_1^{(n)}}{Z_2^{(n)} + Z_1^{(n)}}$\n\n显而易见，对于任何介质对和任何容许的水平慢度 $p$：\n$$\nR_{12}(p) = -R_{21}(p)\n$$\n这个基本关系，有时被称为斯托克斯关系，是波物理学中互易性原理的直接结果。与测量 $R_{12}$ 的物理设置相比，测量 $R_{21}$ 的物理设置在运动学上是反转的。入射波相对于界面法线的方向是相反的（上行对下行）。在保持坐标系固定的情况下，这种入射波和反射波几何排列的反转，在法向速度的边界条件中引入了一个符号变化，该变化通过推导过程传递，最终导致反射系数本身产生一个符号变化。\n\n因此，交叉检验从相反两侧计算的反射率的正确方法是验证等式 $R_{12}(p) = -R_{21}(p)$，或者等效地，$R_{12}(p) + R_{21}(p) = 0$。计算 $\\Delta(p) = |R_{12}(p) - (-R_{21}(p))| = |R_{12}(p) + R_{21}(p)|$ 为这一恒等式提供了数值检验。对于无损介质和精确计算，$\\Delta(p)$ 必须恒等于零。在数值实现中，它的值可以作为对公式及其代码转换正确性的严格测试，因为它应该在浮点精度的限制内为零。\n\n### 第3部分：算法实现\n\n程序将通过实现推导出的公式来为每个测试用例计算 $\\Delta(p)$。对于给定的一组参数 $(\\rho_1, c_1, \\rho_2, c_2, p)$：\n1. 计算每个介质中垂直慢度的平方：$q_j^2 = (1/c_j)^2 - p^2$。问题陈述保证 $p  \\min(1/c_1, 1/c_2)$，因此 $q_j^2$ 为正。\n2. 计算垂直慢度 $q_j = \\sqrt{q_j^2}$。\n3. 计算每个介质中与角度相关的法向比声阻抗：$Z_j^{(n)} = \\rho_j / q_j$。\n4. 使用基于阻抗的公式计算反射系数 $R_{12}(p)$ 和 $R_{21}(p)$：\n   $R_{12}(p) = (Z_2^{(n)} - Z_1^{(n)}) / (Z_2^{(n)} + Z_1^{(n)})$\n   $R_{21}(p) = (Z_1^{(n)} - Z_2^{(n)}) / (Z_1^{(n)} + Z_2^{(n)})$\n5. 计算绝对差 $\\Delta(p) = |R_{12}(p) + R_{21}(p)|$。\n对所有测试用例重复此过程，并将结果收集到一个列表中。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Computes the absolute difference |R_12(p) - (-R_21(p))| for a series of test cases\n    involving acoustic wave reflection at a planar interface.\n    \"\"\"\n\n    # test_cases are tuples of (rho1, c1, rho2, c2, p)\n    # Units: rho in kg/m^3, c in m/s, p in s/m\n    test_cases = [\n        # Case 1 (general contrast, oblique incidence)\n        (1000, 1500, 2200, 1800, 0.0002),\n        # Case 2 (normal incidence)\n        (1000, 1500, 2200, 1800, 0.0),\n        # Case 3 (identical media)\n        (2000, 2500, 2000, 2500, 0.0001),\n        # Case 4 (near critical in the faster medium, still propagating)\n        (1800, 1800, 2200, 2500, 0.000399),\n        # Case 5 (strong impedance contrast, oblique incidence)\n        (1000, 1500, 2700, 6000, 0.00015),\n    ]\n\n    results = []\n    for case in test_cases:\n        rho1, c1, rho2, c2, p = case\n        \n        # Calculate square of horizontal slowness\n        p_sq = p**2\n        \n        # Calculate square of vertical slowness for each medium.\n        # The problem statement guarantees that the arguments to the square root\n        # will be positive (p  min(1/c1, 1/c2)).\n        q1_sq = (1.0/c1)**2 - p_sq\n        q2_sq = (1.0/c2)**2 - p_sq\n        \n        # Calculate vertical slowness\n        q1 = np.sqrt(q1_sq)\n        q2 = np.sqrt(q2_sq)\n        \n        # Calculate angle-dependent normal specific acoustic impedance\n        # Z_j^(n) = rho_j / q_j\n        # This is equivalent to the provided definition:\n        # Z_j^(n) = (rho_j * c_j) / sqrt(1 - (p * c_j)^2)\n        z1_n = rho1 / q1\n        z2_n = rho2 / q2\n        \n        # Calculate the pressure reflection coefficient for incidence from medium 1 to 2\n        # R_12(p) = (Z_2^(n) - Z_1^(n)) / (Z_2^(n) + Z_1^(n))\n        r12 = (z2_n - z1_n) / (z2_n + z1_n)\n        \n        # Calculate the pressure reflection coefficient for incidence from medium 2 to 1\n        # R_21(p) = (Z_1^(n) - Z_2^(n)) / (Z_1^(n) + Z_2^(n))\n        r21 = (z1_n - z2_n) / (z1_n + z2_n)\n        \n        # Evaluate the absolute difference described in the problem.\n        # This tests the reciprocity relation R_12(p) = -R_21(p).\n        # Analytically, delta should be zero. Numerically, it should be zero\n        # or a value very close to machine precision.\n        delta = abs(r12 - (-r21))\n        \n        results.append(delta)\n\n    # Format the final output as a comma-separated list in square brackets.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        },
        {
            "introduction": "在单个界面的基础上，本练习将模型扩展到层状介质，这能更真实地近似地球的地下结构。你将学习如何为复杂的层状模型建立波动方程，并通过实现和比较两种核心算法——传播矩阵法和递归阻抗法——来求解。这项实践让你能够深入了解这两种算法的优缺点及其在数值计算中的稳定性问题。",
            "id": "3613499",
            "problem": "考虑水平分层介质中法向入射的一维时谐线性声学问题。设时间依赖性为 $e^{i \\omega t}$，其中 $\\omega = 2 \\pi f$，$f$ 是频率，单位为 $\\mathrm{Hz}$。每个均匀层 $i$ 的特征在于其密度 $\\rho_i$ (单位 $\\mathrm{kg/m^3}$)、压缩波速 $c_i$ (单位 $\\mathrm{m/s}$)、厚度 $d_i$ (单位 $\\mathrm{m}$)、声阻抗 $Z_i = \\rho_i c_i$ (单位 $\\mathrm{Pa \\cdot s/m}$) 和波数 $k_i = \\omega / c_i$ (单位 $\\mathrm{rad/m}$)。该叠层上方为一个半无限入射介质，其密度为 $\\rho_0$ (单位 $\\mathrm{kg/m^3}$)，波速为 $c_0$ (单位 $\\mathrm{m/s}$) (因此阻抗为 $Z_0 = \\rho_0 c_0$)；下方为一个半无限背衬半空间，其密度为 $\\rho_b$ (单位 $\\mathrm{kg/m^3}$)，波速为 $c_b$ (单位 $\\mathrm{m/s}$) (因此阻抗为 $Z_b = \\rho_b c_b$)。假设介质无损且为平面波法向入射。\n\n仅从声学的线性化动量和连续性方程以及声阻抗的定义出发，您必须：\n\n- 推导一个逐层传播算子，该算子将一层底部的复声压和法向质点速度映射到其顶部。利用该算子为背衬和顶部之间的整个叠层构建一个总传播算子。\n- 在底部施加进入背衬半空间的辐射条件，并在顶部半空间施加入射加反射平面波的条件，以获得顶部介质处的复反射系数 $r$。\n- 从背衬开始逐层嵌入，独立推导从顶部看入叠层的输入阻抗的递推关系，然后从该输入阻抗获得相同的复反射系数 $r$。\n- 确保始终使用一致的相量符号约定，并解决在存在大相位厚度 $k_i d_i$ 时的数值稳定性问题。\n\n然后，实现一个程序，计算通过传递算子法和递归输入阻抗法获得的复反射系数之间的绝对差异，并应用于以下测试套件。所有物理单位必须严格按照上述规定使用；由于问题是法向入射，因此不使用角度。对于每种情况，将差异报告为无量纲浮点值（复反射系数之差的绝对值）。您的程序必须输出单行结果，即用方括号括起来的、由逗号分隔的这些浮点数列表。\n\n测试套件（每种情况指定顶部的 $(\\rho_0, c_0)$、层列表 $(\\rho_i, c_i, d_i)$、底部的 $(\\rho_b, c_b)$ 以及频率 $f$）：\n\n1. 正常情况，两个对比鲜明的层：\n   - 顶部：$\\rho_0 = 1000\\,\\mathrm{kg/m^3}$, $c_0 = 1500\\,\\mathrm{m/s}$。\n   - 层：$(\\rho_1 = 1800\\,\\mathrm{kg/m^3}, c_1 = 2000\\,\\mathrm{m/s}, d_1 = 50\\,\\mathrm{m})$, $(\\rho_2 = 2700\\,\\mathrm{kg/m^3}, c_2 = 5000\\,\\mathrm{m/s}, d_2 = 200\\,\\mathrm{m})$。\n   - 背衬：$\\rho_b = 3300\\,\\mathrm{kg/m^3}$, $c_b = 8000\\,\\mathrm{m/s}$。\n   - 频率：$f = 10\\,\\mathrm{Hz}$。\n\n2. 边界情况，包含一个零厚度层：\n   - 顶部：$\\rho_0 = 1000\\,\\mathrm{kg/m^3}$, $c_0 = 1500\\,\\mathrm{m/s}$。\n   - 层：$(\\rho_1 = 1800\\,\\mathrm{kg/m^3}, c_1 = 2000\\,\\mathrm{m/s}, d_1 = 0\\,\\mathrm{m})$, $(\\rho_2 = 2700\\,\\mathrm{kg/m^3}, c_2 = 5000\\,\\mathrm{m/s}, d_2 = 150\\,\\mathrm{m})$。\n   - 背衬：$\\rho_b = 3000\\,\\mathrm{kg/m^3}$, $c_b = 6000\\,\\mathrm{m/s}$。\n   - 频率：$f = 25\\,\\mathrm{Hz}$。\n\n3. 高频厚层稳定性测试：\n   - 顶部：$\\rho_0 = 1000\\,\\mathrm{kg/m^3}$, $c_0 = 1500\\,\\mathrm{m/s}$。\n   - 层：$(\\rho_1 = 2200\\,\\mathrm{kg/m^3}, c_1 = 2500\\,\\mathrm{m/s}, d_1 = 1000\\,\\mathrm{m})$, $(\\rho_2 = 2600\\,\\mathrm{kg/m^3}, c_2 = 4500\\,\\mathrm{m/s}, d_2 = 500\\,\\mathrm{m})$。\n   - 背衬：$\\rho_b = 3200\\,\\mathrm{kg/m^3}$, $c_b = 7000\\,\\mathrm{m/s}$。\n   - 频率：$f = 200\\,\\mathrm{Hz}$。\n\n4. 全程阻抗匹配（预计无反射）：\n   - 顶部：$\\rho_0 = 1000\\,\\mathrm{kg/m^3}$, $c_0 = 1500\\,\\mathrm{m/s}$。\n   - 层：$(\\rho_1 = 750\\,\\mathrm{kg/m^3}, c_1 = 2000\\,\\mathrm{m/s}, d_1 = 300\\,\\mathrm{m})$, $(\\rho_2 = 500\\,\\mathrm{kg/m^3}, c_2 = 3000\\,\\mathrm{m/s}, d_2 = 500\\,\\mathrm{m})$；注意 $Z_1 = \\rho_1 c_1 = 1.5 \\times 10^6\\,\\mathrm{Pa \\cdot s/m}$ 且 $Z_2 = \\rho_2 c_2 = 1.5 \\times 10^6\\,\\mathrm{Pa \\cdot s/m}$，与 $Z_0$ 和 $Z_b$ 匹配。\n   - 背衬：$\\rho_b = 1000\\,\\mathrm{kg/m^3}$, $c_b = 1500\\,\\mathrm{m/s}$。\n   - 频率：$f = 50\\,\\mathrm{Hz}$。\n\n5. 通过低阻抗薄层实现的强反射体：\n   - 顶部：$\\rho_0 = 1000\\,\\mathrm{kg/m^3}$, $c_0 = 1500\\,\\mathrm{m/s}$。\n   - 层：$(\\rho_1 = 200\\,\\mathrm{kg/m^3}, c_1 = 600\\,\\mathrm{m/s}, d_1 = 10\\,\\mathrm{m})$, $(\\rho_2 = 2500\\,\\mathrm{kg/m^3}, c_2 = 4000\\,\\mathrm{m/s}, d_2 = 300\\,\\mathrm{m})$。\n   - 背衬：$\\rho_b = 2700\\,\\mathrm{kg/m^3}$, $c_b = 6000\\,\\mathrm{m/s}$。\n   - 频率：$f = 30\\,\\mathrm{Hz}$。\n\n您的程序应生成单行输出，其中包含用方括号括起来的、以逗号分隔的结果列表（例如 `[x_1,x_2,x_3,x_4,x_5]`），其中 $x_j$ 是测试用例 $j$ 的两个计算出的复反射系数之间的绝对差异。所有输出均为无量纲浮点数，并按编程语言的默认数值格式进行四舍五入。",
            "solution": "该问题要求推导并实现两种不同的方法，用以计算均匀无损声学叠层在法向入射时的平面波反射系数。这两种方法，即传递算子（传播矩阵）法和递归输入阻抗法，必须从第一性原理推导得出，并对给定的测试套件比较其结果。时谐依赖性给定为 $e^{i \\omega t}$。\n\n设空间坐标 $z$ 向下为正，以顶部半无限介质（介质 0）与叠层第一层之间的界面为 $z=0$。每一层 $j$（$j=1, \\dots, N$）的厚度为 $d_j$，密度为 $\\rho_j$，压缩波速为 $c_j$。派生的属性有声阻抗 $Z_j = \\rho_j c_j$、角频率 $\\omega = 2\\pi f$ 和波数 $k_j = \\omega/c_j$。\n\n一维线性声学的基本方程是动量方程和连续性方程。对于 $e^{i \\omega t}$ 的时间依赖性，它们的形式为：\n$$ i\\omega \\rho v_z = -\\frac{\\partial p}{\\partial z} \\quad \\text{(动量)} $$\n$$ i\\omega p = -K \\frac{\\partial v_z}{\\partial z} \\quad \\text{(连续性)} $$\n其中 $p$ 是复声压，$v_z$ 是复法向质点速度，$K = \\rho c^2$ 是体积模量。\n\n在单个均匀层内，压力的通解是下行和上行平面波的叠加：\n$$ p(z) = A e^{-ik(z-z_0)} + B e^{ik(z-z_0)} $$\n其中 $z_0$ 是该层顶部的坐标。利用动量方程，相应的质点速度为：\n$$ v_z(z) = \\frac{1}{Z} \\left( A e^{-ik(z-z_0)} - B e^{ik(z-z_0)} \\right) $$\n\n### 方法一：传递算子（传播矩阵）法\n\n该方法将每层顶部和底部的压力和速度状态向量 $S(z) = [p(z), v_z(z)]^T$ 联系起来。设层 $j$ 从 $z_{top}$ 延伸到 $z_{bottom} = z_{top} + d_j$。我们寻求一个矩阵 $M_j$，使得 $S(z_{top}) = M_j S(z_{bottom})$。\n\n在层的顶部（$z=z_{top}$），场为：\n$$ p_{top} = A + B $$\n$$ v_{z,top} = \\frac{1}{Z_j}(A - B) $$\n\n在层的底部（$z=z_{bottom}$），场为：\n$$ p_{bot} = A e^{-ik_j d_j} + B e^{ik_j d_j} $$\n$$ v_{z,bot} = \\frac{1}{Z_j} \\left( A e^{-ik_j d_j} - B e^{ik_j d_j} \\right) $$\n\n我们求解底部方程组以得到波幅 $A$ 和 $B$：\n$$ A e^{-ik_j d_j} = \\frac{1}{2}(p_{bot} + Z_j v_{z,bot}) \\implies A = \\frac{1}{2}(p_{bot} + Z_j v_{z,bot})e^{ik_j d_j} $$\n$$ B e^{ik_j d_j} = \\frac{1}{2}(p_{bot} - Z_j v_{z,bot}) \\implies B = \\frac{1}{2}(p_{bot} - Z_j v_{z,bot})e^{-ik_j d_j} $$\n\n将这些代入顶部场的表达式中：\n$$ p_{top} = A+B = \\frac{1}{2} \\left[ (p_{bot} + Z_j v_{z,bot})e^{ik_j d_j} + (p_{bot} - Z_j v_{z,bot})e^{-ik_j d_j} \\right] $$\n$$ p_{top} = p_{bot} \\left(\\frac{e^{ik_j d_j} + e^{-ik_j d_j}}{2}\\right) + Z_j v_{z,bot} \\left(\\frac{e^{ik_j d_j} - e^{-ik_j d_j}}{2}\\right) $$\n$$ p_{top} = p_{bot} \\cos(k_j d_j) + i Z_j v_{z,bot} \\sin(k_j d_j) $$\n\n同样地，对于速度：\n$$ v_{z,top} = \\frac{A-B}{Z_j} = \\frac{1}{2Z_j} \\left[ (p_{bot} + Z_j v_{z,bot})e^{ik_j d_j} - (p_{bot} - Z_j v_{z,bot})e^{-ik_j d_j} \\right] $$\n$$ v_{z,top} = \\frac{p_{bot}}{Z_j} \\left(\\frac{e^{ik_j d_j} - e^{-ik_j d_j}}{2}\\right) + v_{z,bot} \\left(\\frac{e^{ik_j d_j} + e^{-ik_j d_j}}{2}\\right) $$\n$$ v_{z,top} = \\frac{i p_{bot}}{Z_j} \\sin(k_j d_j) + v_{z,bot} \\cos(k_j d_j) $$\n\n这两个方程可以写成矩阵形式，定义了单层传播矩阵 $M_j$：\n$$ \\begin{pmatrix} p_{top} \\\\ v_{z,top} \\end{pmatrix} = \\begin{pmatrix} \\cos(k_j d_j)  iZ_j\\sin(k_j d_j) \\\\ \\frac{i}{Z_j}\\sin(k_j d_j)  \\cos(k_j d_j) \\end{pmatrix} \\begin{pmatrix} p_{bot} \\\\ v_{z,bot} \\end{pmatrix} = M_j \\begin{pmatrix} p_{bot} \\\\ v_{z,bot} \\end{pmatrix} $$\n对于一个 $N$ 层的叠层，叠层顶部（第 1 层顶部）的状态向量与叠层底部（第 $N$ 层底部）的状态向量通过各层矩阵的乘积相关联：\n$$ S_{top\\_stack} = M_1 M_2 \\cdots M_N S_{bot\\_stack} = M_{total} S_{bot\\_stack} $$\n总传播矩阵为 $M_{total} = \\prod_{j=1}^{N} M_j$。\n\n为了求得反射系数，我们应用边界条件。在叠层底部，场辐射到背衬半空间（介质 $b$）中，因此只存在下行波。这施加了条件 $p_{bot\\_stack} = Z_b v_{z,bot\\_stack}$。顶部的状态向量则为：\n$$ \\begin{pmatrix} p_{top} \\\\ v_{z,top} \\end{pmatrix} = M_{total} \\begin{pmatrix} Z_b v_{z,bot\\_stack} \\\\ v_{z,bot\\_stack} \\end{pmatrix} = M_{total} \\begin{pmatrix} Z_b \\\\ 1 \\end{pmatrix} v_{z,bot\\_stack} $$\n记 $M_{total} = \\begin{pmatrix} m_{11}  m_{12} \\\\ m_{21}  m_{22} \\end{pmatrix}$，我们求得叠层的输入阻抗 $Z_{in}$：\n$$ Z_{in} = \\frac{p_{top}}{v_{z,top}} = \\frac{m_{11} Z_b + m_{12}}{m_{21} Z_b + m_{22}} $$\n在叠层顶部，入射介质（介质 0）中的场由振幅为 $A_i$ 的入射波和振幅为 $A_r$ 的反射波组成。在 $z=0$ 处：\n$$ p_{top} = A_i + A_r $$\n$$ v_{z,top} = \\frac{A_i}{Z_0} - \\frac{A_r}{Z_0} $$\n反射系数为 $r = A_r/A_i$。输入阻抗也由这些场的比值给出：\n$$ Z_{in} = \\frac{p_{top}}{v_{z,top}} = \\frac{A_i(1+r)}{A_i(1-r)/Z_0} = Z_0 \\frac{1+r}{1-r} $$\n求解 $r$ 得到最终表达式：\n$$ r = \\frac{Z_{in} - Z_0}{Z_{in} + Z_0} $$\n\n### 方法二：递归输入阻抗法\n\n该方法从底部开始，递归地计算叠层的输入阻抗。设 $Z_{in}^{(j)}$ 为第 $j$ 层顶部的输入阻抗。第 $j$ 层的“负载”是其下方整个子结构的输入阻抗，即 $Z_{in}^{(j+1)}$。递推从基本情况开始：最底层（第 $N$ 层）的负载是背衬半空间的阻抗，因此 $Z_{in}^{(N+1)} = Z_b$。\n\n我们需要一个公式，将一层顶部（阻抗 $Z$，厚度 $d$，波数 $k$）的输入阻抗 $Z_{in}$ 与其底部的负载阻抗 $Z_L$ 联系起来。根据方法一，对于一个终止于负载（其中 $p_{bot} = Z_L v_{z,bot}$）的单层，我们可以写出其输入阻抗 $Z_{in} = p_{top}/v_{z,top}$：\n$$ p_{top} = p_{bot} \\cos(kd) + i Z v_{z,bot} \\sin(kd) = v_{z,bot} (Z_L \\cos(kd) + i Z \\sin(kd)) $$\n$$ v_{z,top} = \\frac{i p_{bot}}{Z} \\sin(kd) + v_{z,bot} \\cos(kd) = v_{z,bot} \\left(\\frac{i Z_L}{Z} \\sin(kd) + \\cos(kd)\\right) $$\n取其比值得到阻抗变换公式：\n$$ Z_{in} = \\frac{Z_L \\cos(kd) + i Z \\sin(kd)}{\\frac{i Z_L}{Z} \\sin(kd) + \\cos(kd)} = Z \\frac{Z_L \\cos(kd) + i Z \\sin(kd)}{Z \\cos(kd) + i Z_L \\sin(kd)} $$\n这个形式在数值上是稳定的，特别是与使用 $\\tan(kd)$ 的等价公式相比，后者在层厚度为四分之一波长的奇数倍（$kd = (n+1/2)\\pi$）时可能会出现奇异性。\n\n递归算法如下：\n1. 用背衬阻抗初始化负载阻抗：$Z_{load} = Z_b$。\n2. 从第 $j = N$ 层向上迭代至第 1 层：\n   $$ Z_{load} \\leftarrow Z_j \\frac{Z_{load} \\cos(k_j d_j) + i Z_j \\sin(k_j d_j)}{Z_j \\cos(k_j d_j) + i Z_{load} \\sin(k_j d_j)} $$\n3. 循环结束后的 $Z_{load}$ 的最终值即为整个叠层的输入阻抗 $Z_{in}$。\n4. 然后按之前的方法计算反射系数 $r$：\n   $$ r = \\frac{Z_{in} - Z_0}{Z_{in} + Z_0} $$\n\n### 数值实现与比较\n\n两种方法都在软件中实现，以计算复反射系数 $r$。传递算子法依赖于矩阵乘法，这很直接，但对于大量层数可能会累积数值误差。递归阻抗法通常被认为更稳定，因为它避免了显式的矩阵乘积。在无损情况下，对于中等数量的层和中等相位厚度，两种方法产生的结果应在机器精度内一致。问题要求计算绝对差异 $|r_1 - r_2|$，其中 $r_1$ 来自传递算子法，$r_2$ 来自递归阻抗法。对于正确的实现，该值应接近于零。复数运算的使用至关重要。所选编程环境中的 `cos` 和 `sin` 函数能正确处理大参数，从而减轻了高频测试用例的稳定性问题。零厚度层应正确地导致一个单位运算：传播矩阵成为单位矩阵，阻抗递推返回负载阻抗不变。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Solves the reflection coefficient problem using two methods\n    and computes the discrepancy for a suite of test cases.\n    \"\"\"\n\n    test_cases = [\n        {\n            \"top\": (1000.0, 1500.0), # rho0, c0\n            \"layers\": [\n                (1800.0, 2000.0, 50.0), # rho1, c1, d1\n                (2700.0, 5000.0, 200.0),  # rho2, c2, d2\n            ],\n            \"backing\": (3300.0, 8000.0), # rho_b, c_b\n            \"freq\": 10.0,\n        },\n        {\n            \"top\": (1000.0, 1500.0),\n            \"layers\": [\n                (1800.0, 2000.0, 0.0), # Zero-thickness layer\n                (2700.0, 5000.0, 150.0),\n            ],\n            \"backing\": (3000.0, 6000.0),\n            \"freq\": 25.0,\n        },\n        {\n            \"top\": (1000.0, 1500.0),\n            \"layers\": [\n                (2200.0, 2500.0, 1000.0), # High-frequency, thick layers\n                (2600.0, 4500.0, 500.0),\n            ],\n            \"backing\": (3200.0, 7000.0),\n            \"freq\": 200.0,\n        },\n        {\n            \"top\": (1000.0, 1500.0),\n            \"layers\": [\n                (750.0, 2000.0, 300.0), # Impedance matching\n                (500.0, 3000.0, 500.0),\n            ],\n            \"backing\": (1000.0, 1500.0),\n            \"freq\": 50.0,\n        },\n        {\n            \"top\": (1000.0, 1500.0),\n            \"layers\": [\n                (200.0, 600.0, 10.0), # Low-impedance thin layer\n                (2500.0, 4000.0, 300.0),\n            ],\n            \"backing\": (2700.0, 6000.0),\n            \"freq\": 30.0,\n        },\n    ]\n\n    discrepancies = []\n\n    for case in test_cases:\n        r1 = calculate_r_transfer_matrix(case)\n        r2 = calculate_r_recursive_impedance(case)\n        discrepancy = np.abs(r1 - r2)\n        discrepancies.append(discrepancy)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, discrepancies))}]\")\n\ndef calculate_r_transfer_matrix(params):\n    \"\"\"\n    Calculates the reflection coefficient using the transfer-operator matrix method.\n    \"\"\"\n    rho0, c0 = params[\"top\"]\n    layers_params = params[\"layers\"]\n    rho_b, c_b = params[\"backing\"]\n    freq = params[\"freq\"]\n\n    Z0 = rho0 * c0\n    Z_b = rho_b * c_b\n    omega = 2.0 * np.pi * freq\n\n    total_matrix = np.identity(2, dtype=complex)\n\n    for rho_j, c_j, d_j in layers_params:\n        if d_j == 0:\n            # A zero-thickness layer is an identity operator\n            layer_matrix = np.identity(2, dtype=complex)\n        else:\n            Z_j = rho_j * c_j\n            k_j = omega / c_j\n            kd = k_j * d_j\n            cos_kd = np.cos(kd)\n            sin_kd = np.sin(kd)\n\n            layer_matrix = np.array([\n                [cos_kd, 1j * Z_j * sin_kd],\n                [1j / Z_j * sin_kd, cos_kd]\n            ], dtype=complex)\n        \n        total_matrix = total_matrix @ layer_matrix\n\n    m11, m12 = total_matrix[0, 0], total_matrix[0, 1]\n    m21, m22 = total_matrix[1, 0], total_matrix[1, 1]\n\n    # Check for division by zero, although unlikely in physical scenarios\n    denominator = m21 * Z_b + m22\n    if np.abs(denominator)  1e-15:\n        # This case suggests infinite input impedance, handle as needed.\n        # For simplicity, we can assume it's very large.\n        Z_in = np.inf\n    else:\n        Z_in = (m11 * Z_b + m12) / denominator\n\n    if np.isinf(Z_in):\n        # r = (inf - Z0)/(inf + Z0) -> 1\n        r = 1.0 + 0.0j\n    else:\n        r = (Z_in - Z0) / (Z_in + Z0)\n\n    return r\n\ndef calculate_r_recursive_impedance(params):\n    \"\"\"\n    Calculates the reflection coefficient using the recursive input-impedance method.\n    \"\"\"\n    rho0, c0 = params[\"top\"]\n    layers_params = params[\"layers\"]\n    rho_b, c_b = params[\"backing\"]\n    freq = params[\"freq\"]\n\n    Z0 = rho0 * c0\n    Z_b = rho_b * c_b\n    omega = 2.0 * np.pi * freq\n\n    # Start with the impedance of the backing half-space\n    Z_load = complex(Z_b)\n\n    # Iterate upwards from the bottom layer\n    for rho_j, c_j, d_j in reversed(layers_params):\n        if d_j == 0:\n            # A zero-thickness layer does not change the impedance\n            continue\n\n        Z_j = rho_j * c_j\n        k_j = omega / c_j\n        kd = k_j * d_j\n\n        cos_kd = np.cos(kd)\n        sin_kd = np.sin(kd)\n        \n        # Use the numerically stable formula with cos and sin\n        numerator = Z_load * cos_kd + 1j * Z_j * sin_kd\n        denominator = Z_j * cos_kd + 1j * Z_load * sin_kd\n\n        if np.abs(denominator)  1e-15:\n            # This can happen at resonance, e.g., quarter-wave transformer with Z_load=0\n            # resulting in Z_in -> infinity\n            Z_load = np.inf\n        else:\n            Z_load = Z_j * numerator / denominator\n\n    Z_in = Z_load\n    \n    if np.isinf(Z_in):\n        # r = (inf - Z0)/(inf + Z0) -> 1\n        r = 1.0 + 0.0j\n    else:\n        r = (Z_in - Z0) / (Z_in + Z0)\n    \n    return r\n\nsolve()\n```"
        },
        {
            "introduction": "这是计算地震学的核心实践，要求你从简化的声波模型进阶到完整的线弹性介质模型。通过求解著名的Zoeppritz方程组，你将掌握在弹性介质中处理P波和SV波模式转换的复杂性，并学习如何稳健地处理超临界角情况下的复数计算。这项技能对于准确模拟和解释振幅随偏移距（AVO）的变化至关重要。",
            "id": "3613464",
            "problem": "您的任务是构建一个完整、可运行的程序，该程序使用完整的 Zoeppritz 方程，计算在两个均匀、各向同性、线性弹性半空间之间的平面界面上，平面波 P-SV 耦合的复振幅反射和透射系数。当穿过透射 P 波的临界角时（此时透射角因 $\\sin\\theta_t>1$ 而变为复数），求解器必须保持稳定。您必须在此区域内实现一个有数学原理支持的延拓策略，该策略要尊重物理上的出射波条件，并且您必须测试复数透射角的数值稳定性和分支选择。角度必须以弧度为单位指定。所有物理量必须使用国际单位制。\n\n使用的基本理论：\n- 各向同性介质的线性弹性理论，涉及拉梅参数 $\\lambda$ 和 $\\mu$、质量密度 $\\rho$、压缩波波速 $\\alpha$ 和剪切波波速 $\\beta$，它们之间的关系为 $\\mu=\\rho\\beta^2$ 和 $\\lambda=\\rho\\alpha^2-2\\mu$。\n- 平面波运动学，涉及水平慢度 $p$ 和垂直慢度 $q$，对于速度为 $v$ 的波，\n$$\np=\\frac{\\sin\\theta}{\\alpha_1}\\quad\\text{对于在顶部介质中以角度}\\theta\\text{入射的 P 波},\n$$\n并且\n$$\nq(v,p)=\\sqrt{\\frac{1}{v^2}-p^2},\n$$\n其中平方根在复平面上取值，以便在 $p>1/v$（消逝区）时，分支产生的 $q$ 对于下行波具有正虚部。垂直坐标向下增加，界面位于 $z=0$，平面波相位为 $e^{i\\omega(px+szqz)}$，其中 $s=+1$ 代表下行波组分，$s=-1$ 代表上行波组分。\n\n您必须基于位移分量 $u_x$、$u_z$ 的连续性和应力分量 $\\sigma_{xz}$、$\\sigma_{zz}$ 的连续性，推导并实现界面上的边界条件。对于标记为 $1$（顶部）和 $2$（底部）的两个半空间，以及在介质 $1$ 中入射的单位势振幅的 P 波，定义以下未知的复振幅系数：\n- $R_{PP}$：介质 $1$ 中的上行反射 P 波，\n- $R_{PS}$：介质 $1$ 中的上行反射 SV 波，\n- $T_{PP}$：介质 $2$ 中的下行透射 P 波，\n- $T_{PS}$：介质 $2$ 中的下行透射 SV 波。\n\n使用 P 波的标量势 $\\phi$ 和 SV 波的标量势 $\\psi$，具有符号 $s\\in\\{+1,-1\\}$ 的波组分的平面波位移和应力贡献为\n$$\nu_x = i\\omega\\left(p\\,\\phi - s\\,q\\,\\psi\\right),\\quad\nu_z = i\\omega\\left(s\\,q\\,\\phi + p\\,\\psi\\right),\n$$\n$$\n\\sigma_{xz} = -\\mu\\,\\omega^2\\left(2p\\,s\\,q\\,\\phi + \\left(p^2-(s\\,q)^2\\right)\\psi\\right),\\quad\n\\sigma_{zz} = -\\omega^2\\left(\\left((\\lambda+2\\mu)(s\\,q)^2+\\lambda p^2\\right)\\phi + 2\\mu p\\,s\\,q\\,\\psi\\right).\n$$\n通过叠加入射波和散射波组分，并强制执行 $z=0$ 处的边界条件，您必须构建并求解一个关于 $\\left[R_{PP},R_{PS},T_{PP},T_{PS}\\right]^\\top$ 的 $4\\times 4$ 复数线性系统。使用水平慢度 $p$、垂直慢度 $q_{1P},q_{1S},q_{2P},q_{2S}$、拉梅参数 $(\\lambda_1,\\mu_1)$ 和 $(\\lambda_2,\\mu_2)$ 以及密度 $(\\rho_1,\\rho_2)$ 来表示该系统。需要组合的四个标量方程是：\n1. $u_x$ 的连续性：\n$$\np(1+R_{PP}) + q_{1S}R_{PS} = p\\,T_{PP} - q_{2S}T_{PS}.\n$$\n2. $u_z$ 的连续性：\n$$\nq_{1P}(1 - R_{PP}) + p\\,R_{PS} = q_{2P}T_{PP} + p\\,T_{PS}.\n$$\n3. $\\sigma_{xz}$ 的连续性：\n$$\n2\\mu_1 p q_{1P} (1 - R_{PP}) - \\mu_1(p^2 - q_{1S}^2)R_{PS} = 2\\mu_2 p q_{2P} T_{PP} + \\mu_2(p^2 - q_{2S}^2)T_{PS}.\n$$\n4. $\\sigma_{zz}$ 的连续性：\n$$\n-\\left(\\left(\\lambda_1+2\\mu_1\\right)q_{1P}^2 + \\lambda_1 p^2\\right)(1+R_{PP}) + 2\\mu_1 p\\,q_{1S} R_{PS} + \\left(\\left(\\lambda_2+2\\mu_2\\right)q_{2P}^2 + \\lambda_2 p^2\\right)T_{PP} + 2\\mu_2 p\\,q_{2S}T_{PS} = 0.\n$$\n\n算法要求：\n- 全程使用复数算术，以便 $q(v,p)$ 在跨越临界角时保持稳健。\n- 为 $q(v,p)$ 实现一种分支选择策略，使其在消逝区中产生 $\\operatorname{Im}(q)\\ge 0$，以确保介质 $2$ 中物理上可接受的下行衰减，并通过公式中的符号 $s$ 保证介质 $1$ 中一致的上行行为。\n- 使用数值稳定的方法求解 $4\\times 4$ 系统。如果矩阵在临界角附近是病态的，则使用最小二乘法作为后备方案。\n\n单位和角度约定：\n- $\\alpha, \\beta$ 单位为 $\\text{m/s}$，\n- $\\rho$ 单位为 $\\text{kg/m}^3$，\n- 角度单位为弧度，\n- 返回的系数是无量纲的复振幅。\n\n测试套件：\n您的程序必须为以下六组参数 $(\\alpha_1,\\beta_1,\\rho_1,\\alpha_2,\\beta_2,\\rho_2,\\theta_1)$ 评估求解器，其中 $\\theta_1$ 是介质 $1$ 中的入射 P 波角度（以弧度为单位）。\n1. $(2500,\\,1200,\\,2200,\\,3000,\\,1500,\\,2400,\\,0.8)$：亚临界参考。\n2. $(2500,\\,1200,\\,2200,\\,3000,\\,1500,\\,2400,\\,0.985)$：接近透射 P 波临界角，略低于临界角。\n3. $(2500,\\,1200,\\,2200,\\,3000,\\,1500,\\,2400,\\,0.995)$：刚刚超过透射 P 波临界角（$q_{2P}$ 为消逝波）。\n4. $(3000,\\,1500,\\,2200,\\,3000,\\,1500,\\,2200,\\,0.5)$：介质相同情况的合理性检查。\n5. $(2000,\\,1000,\\,2000,\\,4000,\\,2200,\\,2800,\\,1.2)$：强对比度，大角度，在介质 $2$ 中 P 波为超临界。\n6. $(2500,\\,1400,\\,2100,\\,3200,\\,1800,\\,2600,\\,1.3)$：在中等对比度下的大角度。\n\n最终输出规范：\n- 对于每个测试用例，返回列表 $[ \\Re(R_{PP}), \\Im(R_{PP}), \\Re(R_{PS}), \\Im(R_{PS}), \\Re(T_{PP}), \\Im(T_{PP}), \\Re(T_{PS}), \\Im(T_{PS}) ]$。\n- 您的程序应生成单行输出，其中包含所有测试用例的结果，形式为由方括号括起来的列表的逗号分隔列表。例如：`[[a1,a2,...,a8],[b1,b2,...,b8],...]`。",
            "solution": "问题陈述已经过严格审查并被确定为有效。它提出了一个定义明确、具有科学依据的计算地球物理学问题，基于线性弹性动力学的既定原理。所提供的方程、定义和参数在内部是一致的，并允许构建和求解一个完整的物理问题。\n\n任务是计算平面 P 波入射到两个不同弹性介质之间的平面边界时的复数反射和透射系数。这由 Zoeppritz 方程控制，该方程是通过在界面上强制执行位移和应力的边界条件而得出的。该问题是为 P-SV 耦合波制定的，需要求解一个 $4 \\times 4$ 线性系统以获得四个未知波的振幅：反射 P 波 ($R_{PP}$)、反射 SV 波 ($R_{PS}$)、透射 P 波 ($T_{PP}$) 和透射 SV 波 ($T_{PS}$)。\n\n求解过程遵循以下步骤：\n\n**1. 运动学参数**\n所有平面波的运动学都通过斯涅尔定律联系在一起，该定律指出水平慢度 $p$ 在界面上是守恒的。对于在介质 $1$ 中以速度 $\\alpha_1$、法线夹角 $\\theta_1$ 入射的 P 波，水平慢度为：\n$$\np = \\frac{\\sin\\theta_1}{\\alpha_1}\n$$\n对于任何速度为 $v$ 的波（P 波或 SV 波），其垂直慢度 $q$ 取决于 $p$：\n$$\nq(v, p) = \\sqrt{\\frac{1}{v^2} - p^2}\n$$\n为了处理超临界入射（其中 $p > 1/v$），平方根内的项变为负数，$q$ 变为虚数。计算必须在复平面中进行。稳定解的物理要求是消逝波（虚数 $q$）必须在远离界面处衰减。给定 $z$ 向下增加的坐标系，介质 $2$ ($z > 0$) 中的下行透射波必须随 $z$ 的增加而衰减，而介质 $1$ ($z  0$) 中的上行反射波必须随 $z$ 的减小而衰减。通过选择复数平方根的分支使得 $\\operatorname{Im}(q) \\ge 0$，可以同时满足这两个条件。标准的复数算术数值库（如 NumPy）对于主根遵循此约定。因此，我们定义四个所需的垂直慢度：\n- 介质 1 中的入射/反射 P 波：$q_{1P} = \\sqrt{1/\\alpha_1^2 - p^2 + 0j}$\n- 介质 1 中的反射 SV 波：$q_{1S} = \\sqrt{1/\\beta_1^2 - p^2 + 0j}$\n- 介质 2 中的透射 P 波：$q_{2P} = \\sqrt{1/\\alpha_2^2 - p^2 + 0j}$\n- 介质 2 中的透射 SV 波：$q_{2S} = \\sqrt{1/\\beta_2^2 - p^2 + 0j}$\n\n**2. 线性系统的构建**\n四个边界条件（水平位移 $u_x$、垂直位移 $u_z$、剪切应力 $\\sigma_{xz}$ 和法向应力 $\\sigma_{zz}$ 的连续性）产生一个由四个线性方程组成的系统。设未知复振幅向量为 $\\mathbf{x} = [R_{PP}, R_{PS}, T_{PP}, T_{PS}]^\\top$。该系统可以写成矩阵形式 $A\\mathbf{x} = \\mathbf{b}$。通过重新排列问题陈述中提供的四个方程，我们确定了矩阵 $A$ 的分量和向量 $\\mathbf{b}$。\n\n由 $u_x$ 的连续性得：\n$$ p R_{PP} + q_{1S} R_{PS} - p T_{PP} + q_{2S} T_{PS} = -p $$\n由 $u_z$ 的连续性得：\n$$ -q_{1P} R_{PP} + p R_{PS} - q_{2P} T_{PP} - p T_{PS} = -q_{1P} $$\n由 $\\sigma_{xz}$ 的连续性得：\n$$ 2\\mu_1 p q_{1P} R_{PP} - \\mu_1(p^2-q_{1S}^2) R_{PS} + 2\\mu_2 p q_{2P} T_{PP} + \\mu_2(p^2-q_{2S}^2) T_{PS} = 2\\mu_1 p q_{1P} $$\n由 $\\sigma_{zz}$ 的连续性，经过如下详述的重新排列和简化后得：\n$$ -C_1 R_{PP} + (2\\mu_1 p q_{1S}) R_{PS} + C_2 T_{PP} + (2\\mu_2 p q_{2S}) T_{PS} = C_1 $$\n其中 $C_1 = \\rho_1(1-2\\beta_1^2 p^2)$ 和 $C_2 = \\rho_2(1-2\\beta_2^2 p^2)$。这种简化来自于将拉梅参数 $\\lambda$ 表示为密度 $\\rho$ 和波速 $\\alpha, \\beta$ 的函数，即 $\\lambda = \\rho(\\alpha^2 - 2\\beta^2)$，并使用恒等式 $p^2+q_P^2 = 1/\\alpha^2$。\n\n得到的 $4 \\times 4$ 复数矩阵 $A$ 是：\n$$\nA = \\begin{pmatrix}\np  q_{1S}  -p  q_{2S} \\\\\n-q_{1P}  p  -q_{2P}  -p \\\\\n2\\mu_1 p q_{1P}  -\\mu_1(p^2-q_{1S}^2)  2\\mu_2 p q_{2P}  \\mu_2(p^2-q_{2S}^2) \\\\\n-C_1  2\\mu_1 p q_{1S}  C_2  2\\mu_2 p q_{2S}\n\\end{pmatrix}\n$$\n而复数向量 $\\mathbf{b}$ 是：\n$$\n\\mathbf{b} = \\begin{pmatrix} -p \\\\ -q_{1P} \\\\ 2\\mu_1 p q_{1P} \\\\ C_1 \\end{pmatrix}\n$$\n这里，剪切模量为 $\\mu_1 = \\rho_1\\beta_1^2$ 和 $\\mu_2 = \\rho_2\\beta_2^2$。\n\n**3. 算法解**\n对于每个测试用例，算法按以下步骤进行：\n1. 给定材料属性 $(\\alpha_1, \\beta_1, \\rho_1, \\alpha_2, \\beta_2, \\rho_2)$ 和入射角 $\\theta_1$。\n2. 计算水平慢度 $p$。\n3. 计算四个复数垂直慢度 $q_{1P}, q_{1S}, q_{2P}, q_{2S}$。\n4. 计算必要的中间项，如 $\\mu_1, \\mu_2, C_1, C_2$。\n5. 按照上述定义构建复数矩阵 $A$ 和向量 $\\mathbf{b}$。\n6. 求解线性系统 $A\\mathbf{x} = \\mathbf{b}$，得到系数向量 $\\mathbf{x}$。标准的线性求解器，如 `numpy.linalg.solve` 提供的求解器，对于非奇异情况是足够且数值稳定的。问题中提到的最小二乘回退对于通用的稳健实现是一个有效的考虑，但在这里直接求解是合适的。\n7. 得到的向量 $\\mathbf{x} = [R_{PP}, R_{PS}, T_{PP}, T_{PS}]^\\top$ 包含了所需的复数系数。\n8. 对于最终输出，提取每个系数的实部和虚部，并按规定格式化。介质相同的特殊情况可作为合理性检查，其解必须是 $\\mathbf{x}=[0,0,1,0]^\\top$，对应于完全透射而无反射。\n\n该过程正确且稳健地实现了 Zoeppritz 方程，尊重了波传播的物理原理，包括在临界角及超临界角下的行为。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve_zoeppritz(alpha1, beta1, rho1, alpha2, beta2, rho2, theta1_rad):\n    \"\"\"\n    Computes P-SV reflection/transmission coefficients using the Zoeppritz equations.\n\n    The implementation solves the 4x4 linear system derived from boundary conditions\n    at the interface between two elastic half-spaces. Complex arithmetic is used\n    throughout to handle post-critical angle scenarios.\n\n    Args:\n        alpha1 (float): P-wave speed in medium 1 (m/s).\n        beta1 (float): S-wave speed in medium 1 (m/s).\n        rho1 (float): Density of medium 1 (kg/m^3).\n        alpha2 (float): P-wave speed in medium 2 (m/s).\n        beta2 (float): S-wave speed in medium 2 (m/s).\n        rho2 (float): Density of medium 2 (kg/m^3).\n        theta1_rad (float): Incident P-wave angle in medium 1 (radians).\n\n    Returns:\n        list: A list of 8 floats representing the real and imaginary parts of\n              the four complex coefficients [R_PP, R_PS, T_PP, T_PS].\n    \"\"\"\n    # 1. Calculate slowness and other parameters\n    # For theta1_rad approaching pi/2, p can be very close to 1/alpha1.\n    # A small tolerance may be needed for numerical stability if grazing angle is allowed.\n    # Here we assume test cases are not at exactly pi/2.\n    if np.isclose(theta1_rad, np.pi/2):\n        p = 1.0 / alpha1\n    else:\n        p = np.sin(theta1_rad) / alpha1\n\n    # 2. Calculate vertical slownesses\n    # Using complex numbers from the start ensures correct branch cuts for evanescent waves.\n    # The condition Im(q) >= 0 is handled correctly by np.sqrt for a complex argument.\n    q_alpha1 = np.sqrt(1/alpha1**2 - p**2 + 0j)\n    q_beta1 = np.sqrt(1/beta1**2 - p**2 + 0j)\n    q_alpha2 = np.sqrt(1/alpha2**2 - p**2 + 0j)\n    q_beta2 = np.sqrt(1/beta2**2 - p**2 + 0j)\n\n    # 3. Assemble the Zoeppritz matrix A and vector b\n    # These are derived directly from the four boundary condition equations provided\n    # in the problem statement.\n    # The unknown vector is x = [R_PP, R_PS, T_PP, T_PS]^T\n    \n    A = np.zeros((4, 4), dtype=np.complex128)\n    b = np.zeros(4, dtype=np.complex128)\n    \n    mu1 = rho1 * beta1**2\n    mu2 = rho2 * beta2**2\n\n    # Row 1: Continuity of horizontal displacement u_x\n    A[0, 0] = p\n    A[0, 1] = q_beta1\n    A[0, 2] = -p\n    A[0, 3] = q_beta2\n    b[0] = -p\n\n    # Row 2: Continuity of vertical displacement u_z\n    A[1, 0] = -q_alpha1\n    A[1, 1] = p\n    A[1, 2] = -q_alpha2\n    A[1, 3] = -p\n    b[1] = -q_alpha1\n\n    # Row 3: Continuity of shear traction sigma_xz\n    # This row is based on the corrected form: A_R - A_T = -A_I\n    # Multiplied by -1 to match the Python code in the prompt.\n    A[2, 0] = 2 * mu1 * p * q_alpha1\n    A[2, 1] = -mu1 * (p**2 - q_beta1**2)\n    A[2, 2] = 2 * mu2 * p * q_alpha2\n    A[2, 3] = mu2 * (p**2 - q_beta2**2)\n    b[2] = 2 * mu1 * p * q_alpha1\n\n    # Row 4: Continuity of normal traction sigma_zz\n    # Using the simplified expressions C1 and C2 as derived in the solution description.\n    C1 = rho1 * (1 - 2 * beta1**2 * p**2)\n    C2 = rho2 * (1 - 2 * beta2**2 * p**2)\n    A[3, 0] = -C1\n    A[3, 1] = 2 * mu1 * p * q_beta1\n    A[3, 2] = C2\n    A[3, 3] = 2 * mu2 * p * q_beta2\n    b[3] = C1\n    \n    # 4. Solve the linear system\n    try:\n        coeffs = np.linalg.solve(A, b)\n    except np.linalg.LinAlgError:\n        # Fallback to least-squares for ill-conditioned matrices (e.g., at critical angles)\n        coeffs, _, _, _ = np.linalg.lstsq(A, b, rcond=None)\n\n    # 5. Format output\n    # Flatten the complex coefficients into a list of real and imaginary parts\n    # [Re(R_PP), Im(R_PP), Re(R_PS), Im(R_PS), Re(T_PP), Im(T_PP), Re(T_PS), Im(T_PS)]\n    result = [\n        coeffs[0].real, coeffs[0].imag,\n        coeffs[1].real, coeffs[1].imag,\n        coeffs[2].real, coeffs[2].imag,\n        coeffs[3].real, coeffs[3].imag,\n    ]\n    return result\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (2500, 1200, 2200, 3000, 1500, 2400, 0.8),\n        (2500, 1200, 2200, 3000, 1500, 2400, 0.985),\n        (2500, 1200, 2200, 3000, 1500, 2400, 0.995),\n        (3000, 1500, 2200, 3000, 1500, 2200, 0.5),\n        (2000, 1000, 2000, 4000, 2200, 2800, 1.2),\n        (2500, 1400, 2100, 3200, 1800, 2600, 1.3),\n    ]\n\n    results = []\n    for case in test_cases:\n        # Calculate the coefficients for one case\n        coefficients = solve_zoeppritz(*case)\n        results.append(coefficients)\n\n    # Format the final output string exactly as required.\n    # e.g., [[a1,a2,...,a8],[b1,b2,...,b8],...]\n    # No spaces after commas inside the inner lists.\n    inner_parts = [f\"[{','.join(f'{x:.17g}' for x in r)}]\" for r in results]\n    final_output = f\"[{','.join(inner_parts)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n```"
        }
    ]
}