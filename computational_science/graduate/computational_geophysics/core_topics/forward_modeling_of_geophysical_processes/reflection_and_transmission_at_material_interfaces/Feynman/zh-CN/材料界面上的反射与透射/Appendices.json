{
    "hands_on_practices": [
        {
            "introduction": "理解波的反射与透射始于最简单的情景：声波的正向入射。这项基础练习 () 要求你从第一性原理出发，推导反射和透射系数，并将其与声阻抗这一关键概念联系起来。通过将这些公式应用于一个假设情景，你还将探索负反射系数的物理意义，即波的相位反转。",
            "id": "3613488",
            "problem": "一束平面简谐正入射压缩（声）波在介质 $1$ 中，于 $x=0$ 处遇到与介质 $2$ 的平面分界面。假设为线性声学近似，无波型转换，且两种介质均为均匀、各向同性、无损耗的。设质量密度分别为 $\\rho_{1}$ 和 $\\rho_{2}$，压缩波速分别为 $c_{1}$ 和 $c_{2}$，声阻抗分别为 $Z_{1}=\\rho_{1} c_{1}$ 和 $Z_{2}=\\rho_{2} c_{2}$。入射波从介质 $1$ 沿 $+x$ 方向传播至介质 $2$。振幅反射系数 $R$ 和振幅透射系数 $T$ 分别定义为反射波与入射波、透射波与入射波的压力振幅的复数比。\n\n从声学的线性化运动方程和质量守恒方程出发，结合 $x=0$ 处压力和法向质点速度的连续性条件，推导正入射情况下 $R$ 和 $T$ 的表达式。然后根据给定的材料特性 $\\rho_{1}=2900\\,\\mathrm{kg\\,m^{-3}}$，$c_{1}=6000\\,\\mathrm{m\\,s^{-1}}$，$\\rho_{2}=1800\\,\\mathrm{kg\\,m^{-3}}$ 以及 $c_{2}=2000\\,\\mathrm{m\\,s^{-1}}$，计算 $R$ 和 $T$ 的值。简要解释在 $Z_{2}  Z_1$ 的情况下，$R$ 的负号的物理意义。",
            "solution": "所提出的问题是有效的。这是一个线性声学和波传播中的标准、适定问题，基于基本的物理原理。该问题是自洽的，提供了所有必要的数据和条件，没有任何科学或逻辑上的不一致之处。因此，我们可以进行正式的求解。\n\n推导始于均匀、无损耗流体中声波的一维线性化方程。运动方程（欧拉方程）为：\n$$\n\\rho \\frac{\\partial v_x}{\\partial t} = -\\frac{\\partial p}{\\partial x}\n$$\n质量守恒方程，结合流体的本构关系，为：\n$$\n\\frac{1}{\\rho c^2} \\frac{\\partial p}{\\partial t} = -\\frac{\\partial v_x}{\\partial x}\n$$\n在此，$p$ 是声压，$v_x$ 是 $x$ 方向的质点速度，$\\rho$ 是质量密度，$c$ 是波速，$t$ 是时间，$x$ 是空间坐标。\n\n我们寻求形如 $p(x,t) = P(x)e^{-i\\omega t}$ 和 $v_x(x,t) = V_x(x)e^{-i\\omega t}$ 的简谐解，其中 $\\omega$ 是角频率。将这些形式代入控制方程，得到：\n$$\n-i\\omega \\rho V_x(x) = -\\frac{d P(x)}{dx}\n$$\n$$\n-i\\omega \\frac{1}{\\rho c^2} P(x) = -\\frac{d V_x(x)}{dx}\n$$\n这些方程可以组合成关于压力的亥姆霍兹方程 $\\frac{d^2 P(x)}{dx^2} + k^2 P(x) = 0$，其中 $k = \\omega/c$ 是波数。通解描述了沿 $+x$ 和 $-x$ 方向传播的平面波。\n\n在介质 $1$ ($x0$) 中，我们有一个沿 $+x$ 方向传播的入射波和一个沿 $-x$ 方向传播的反射波。总压力场是这两个波的叠加：\n$$\np_1(x,t) = P_I e^{i(k_1 x - \\omega t)} + P_R e^{i(-k_1 x - \\omega t)}\n$$\n其中 $k_1 = \\omega/c_1$。$P_I$ 是入射压力波的复振幅，$P_R$ 是反射压力波的复振幅。\n\n在介质 $2$ ($x>0$) 中，只有一个沿 $+x$ 方向传播的透射波：\n$$\np_2(x,t) = P_T e^{i(k_2 x - \\omega t)}\n$$\n其中 $k_2 = \\omega/c_2$，$P_T$ 是透射压力波的复振幅。\n\n接下来，我们推导质点速度的表达式。根据运动方程，$V_x(x) = \\frac{1}{i\\omega\\rho} \\frac{dP(x)}{dx}$。将此应用于每个介质中的压力场：\n对于介质 1：\n$$\nv_{x1}(x,t) = \\frac{1}{i\\omega\\rho_1} \\frac{\\partial}{\\partial x} \\left( P_I e^{ik_1 x} + P_R e^{-ik_1 x} \\right) e^{-i\\omega t} = \\frac{k_1}{\\omega\\rho_1} \\left( P_I e^{ik_1 x} - P_R e^{-ik_1 x} \\right) e^{-i\\omega t}\n$$\n使用 $k_1 = \\omega/c_1$ 和声阻抗的定义 $Z_1 = \\rho_1 c_1$，上式简化为：\n$$\nv_{x1}(x,t) = \\frac{1}{Z_1} \\left( P_I e^{ik_1 x} - P_R e^{-ik_1 x} \\right) e^{-i\\omega t}\n$$\n对于介质 2：\n$$\nv_{x2}(x,t) = \\frac{1}{i\\omega\\rho_2} \\frac{\\partial}{\\partial x} \\left( P_T e^{ik_2 x} \\right) e^{-i\\omega t} = \\frac{k_2}{\\omega\\rho_2} \\left( P_T e^{ik_2 x} \\right) e^{-i\\omega t}\n$$\n使用 $k_2 = \\omega/c_2$ 和 $Z_2 = \\rho_2 c_2$，上式简化为：\n$$\nv_{x2}(x,t) = \\frac{1}{Z_2} P_T e^{ik_2 x} e^{-i\\omega t}\n$$\n在界面 $x=0$ 处，物理边界条件要求压力连续和质点速度的法向分量连续。\n$1$. $p_1(0,t) = p_2(0,t)$\n$2$. $v_{x1}(0,t) = v_{x2}(0,t)$\n\n在 $x=0$ 处应用第一个边界条件：\n$$\nP_I e^{0} + P_R e^{0} = P_T e^{0} \\implies P_I + P_R = P_T\n$$\n在 $x=0$ 处应用第二个边界条件：\n$$\n\\frac{1}{Z_1} \\left( P_I e^{0} - P_R e^{0} \\right) = \\frac{1}{Z_2} P_T e^{0} \\implies \\frac{1}{Z_1}(P_I - P_R) = \\frac{1}{Z_2} P_T\n$$\n我们现在有一个二元线性方程组。我们求解振幅反射系数 $R = P_R/P_I$ 和振幅透射系数 $T = P_T/P_I$。\n将 $P_T = P_I + P_R$ 代入第二个方程：\n$$\n\\frac{1}{Z_1}(P_I - P_R) = \\frac{1}{Z_2}(P_I + P_R)\n$$\n两边同乘 $Z_1 Z_2$ 以消去分母：\n$$\nZ_2(P_I - P_R) = Z_1(P_I + P_R)\n$$\n$$\nZ_2 P_I - Z_2 P_R = Z_1 P_I + Z_1 P_R\n$$\n将含有 $P_I$ 和 $P_R$ 的项分组：\n$$\nP_I(Z_2 - Z_1) = P_R(Z_1 + Z_2)\n$$\n求解反射系数 $R = P_R/P_I$：\n$$\nR = \\frac{Z_2 - Z_1}{Z_1 + Z_2}\n$$\n为了求透射系数 $T = P_T/P_I$，我们使用关系式 $P_T = P_I + P_R$。两边同除以 $P_I$ 得到 $T = 1 + R$：\n$$\nT = 1 + \\frac{Z_2 - Z_1}{Z_1 + Z_2} = \\frac{(Z_1 + Z_2) + (Z_2 - Z_1)}{Z_1 + Z_2} = \\frac{2 Z_2}{Z_1 + Z_2}\n$$\n现在，我们根据给定的材料特性计算这些表达式的值：\n$\\rho_{1}=2900\\,\\mathrm{kg\\,m^{-3}}$，$c_{1}=6000\\,\\mathrm{m\\,s^{-1}}$\n$\\rho_{2}=1800\\,\\mathrm{kg\\,m^{-3}}$，$c_{2}=2000\\,\\mathrm{m\\,s^{-1}}$\n\n首先，计算声阻抗 $Z_1$ 和 $Z_2$：\n$$\nZ_1 = \\rho_1 c_1 = (2900)(6000) = 17,400,000\\,\\mathrm{kg\\,m^{-2}\\,s^{-1}} = 1.74 \\times 10^7\\,\\mathrm{Pa\\,s\\,m^{-1}}\n$$\n$$\nZ_2 = \\rho_2 c_2 = (1800)(2000) = 3,600,000\\,\\mathrm{kg\\,m^{-2}\\,s^{-1}} = 3.6 \\times 10^6\\,\\mathrm{Pa\\,s\\,m^{-1}}\n$$\n现在，计算 $R$ 和 $T$：\n$$\nR = \\frac{Z_2 - Z_1}{Z_1 + Z_2} = \\frac{3.6 \\times 10^6 - 17.4 \\times 10^6}{17.4 \\times 10^6 + 3.6 \\times 10^6} = \\frac{-13.8 \\times 10^6}{21.0 \\times 10^6} = -\\frac{13.8}{21.0} \\approx -0.6571428...\n$$\n$$\nT = \\frac{2 Z_2}{Z_1 + Z_2} = \\frac{2 \\times (3.6 \\times 10^6)}{17.4 \\times 10^6 + 3.6 \\times 10^6} = \\frac{7.2 \\times 10^6}{21.0 \\times 10^6} = \\frac{7.2}{21.0} \\approx 0.3428571...\n$$\n四舍五入到四位有效数字，我们得到 $R = -0.6571$ 和 $T = 0.3429$。\n\n最后，我们解释在 $Z_2  Z_1$ 的情况下 $R$ 的符号，给定的数值就属于这种情况。反射系数 $R = P_R/P_I$ 是复压力振幅之比。$R$ 为负实数表示在边界处，反射压力波与入射压力波之间存在 $\\pi$ 弧度（$180^\\circ$）的相移，因为 $P_R = R P_I = -|R| P_I$。在复平面上，乘以 $-1$ 等效于旋转 $\\pi$。因此，当声波从声阻抗较低的介质的界面反射时，反射压力波会发生相位反转。这类似于一根弦上的机械波（位移）从固定端反射。",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n-0.6571  0.3429\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "尽管声学模型提供了基本直觉，但真实的地球物理应用需要更完备的弹性波描述。这项实践 () 向你发起了挑战：实现完整的Zoeppritz方程，该方程描述了能量在界面处如何分配给反射和透射的P波与SV波。本练习的一个关键部分是处理在临界角及其附近出现的复杂情况，此时透射波变为倏逝波，需要使用复数进行精细处理。",
            "id": "3613464",
            "problem": "你的任务是构建一个完整、可运行的程序，该程序使用完整的 Zoeppritz 方程，计算在两个均匀、各向同性、线性弹性半空间之间的平面界面上，平面波 P-SV 波耦合的复振幅反射和透射系数。当穿过透射 P 波临界角时（此时由于 $\\sin\\theta_t1$ 透射角变为复数），求解器必须保持稳定。你必须实现一个有数学原理支持的延拓策略来处理此区域，该策略需遵循物理上的出射波条件，并且你必须测试复数透射角下的数值稳定性和分支选择。角度必须以弧度为单位。所有物理量必须使用国际单位制。\n\n使用的基本原理：\n- 各向同性介质的线性弹性理论，涉及拉梅参数 $\\lambda$ 和 $\\mu$、质量密度 $\\rho$、纵波速度 $\\alpha$ 和横波速度 $\\beta$，它们之间的关系为 $\\mu=\\rho\\beta^2$ 和 $\\lambda=\\rho\\alpha^2-2\\mu$。\n- 平面波运动学，涉及水平慢度 $p$ 和垂直慢度 $q$。对于速度为 $v$ 的波，\n$$\np=\\frac{\\sin\\theta}{\\alpha_1}\\quad\\text{对于顶部介质中入射角为 }\\theta\\text{ 的入射 P 波}，\n$$\n并且\n$$\nq(v,p)=\\sqrt{\\frac{1}{v^2}-p^2},\n$$\n其中平方根在复平面上取值，以确保在 $p1/v$（消逝波区域）时，所选分支对下行波产生的 $q$ 具有正虚部。垂直坐标向下增加，界面位于 $z=0$ 处，平面波相位为 $e^{i\\omega(px+szqz)}$，其中对于下行分量 $s=+1$，对于上行分量 $s=-1$。\n\n你必须基于位移分量 $u_x$、$u_z$ 和应力分量 $\\sigma_{xz}$、$\\sigma_{zz}$ 的连续性，推导并实现界面上的边界条件。对于标记为 $1$（顶部）和 $2$（底部）的两个半空间，以及介质 $1$ 中单位势函数振幅的入射 P 波，定义以下未知的复振幅系数：\n- $R_{PP}$：介质 $1$ 中的上行反射 P 波，\n- $R_{PS}$：介质 $1$ 中的上行反射 SV 波，\n- $T_{PP}$：介质 $2$ 中的下行透射 P 波，\n- $T_{PS}$：介质 $2$ 中的下行透射 SV 波。\n\n使用 P 波的标量势 $\\phi$ 和 SV 波的标量势 $\\psi$，对于符号为 $s\\in\\{+1,-1\\}$ 的波分量，其平面波位移和应力贡献为\n$$\nu_x = i\\omega\\left(p\\,\\phi - s\\,q\\,\\psi\\right),\\quad\nu_z = i\\omega\\left(s\\,q\\,\\phi + p\\,\\psi\\right),\n$$\n$$\n\\sigma_{xz} = -\\mu\\,\\omega^2\\left(2p\\,s\\,q\\,\\phi + \\left(p^2-(s\\,q)^2\\right)\\psi\\right),\\quad\n\\sigma_{zz} = -\\omega^2\\left(\\left((\\lambda+2\\mu)(s\\,q)^2+\\lambda p^2\\right)\\phi + 2\\mu p\\,s\\,q\\,\\psi\\right).\n$$\n通过叠加入射波和散射波分量，并在 $z=0$ 处施加边界条件，你必须为 $\\left[R_{PP},R_{PS},T_{PP},T_{PS}\\right]^\\top$ 建立并求解一个 $4\\times 4$ 的复线性系统。使用水平慢度 $p$、垂直慢度 $q_{1P},q_{1S},q_{2P},q_{2S}$、拉梅参数 $(\\lambda_1,\\mu_1)$ 和 $(\\lambda_2,\\mu_2)$ 以及密度 $(\\rho_1,\\rho_2)$ 来表示该系统。需要组合的四个标量方程是：\n1. $u_x$ 的连续性：\n$$\np(1+R_{PP}) + q_{1S}R_{PS} = p\\,T_{PP} - q_{2S}T_{PS}.\n$$\n2. $u_z$ 的连续性：\n$$\nq_{1P}(1 - R_{PP}) + p\\,R_{PS} = q_{2P}T_{PP} + p\\,T_{PS}.\n$$\n3. $\\sigma_{xz}$ 的连续性：\n$$\n\\mu_1\\left(2p\\,q_{1P}R_{PP} - \\left(p^2-q_{1S}^2\\right)R_{PS}\\right) + \\mu_2\\left(2p\\,q_{2P}T_{PP} + \\left(p^2-q_{2S}^2\\right)T_{PS}\\right) = \\mu_1(2p\\,q_{1P}).\n$$\n4. $\\sigma_{zz}$ 的连续性：\n$$\n-\\left(\\left(\\lambda_1+2\\mu_1\\right)q_{1P}^2 + \\lambda_1 p^2\\right)(1+R_{PP}) + 2\\mu_1 p\\,q_{1S} R_{PS} + \\left(\\left(\\lambda_2+2\\mu_2\\right)q_{2P}^2 + \\lambda_2 p^2\\right)T_{PP} + 2\\mu_2 p\\,q_{2S}T_{PS} = 0.\n$$\n\n算法要求：\n- 全程使用复数运算，以确保 $q(v,p)$ 在跨越临界角时保持稳健。\n- 为 $q(v,p)$ 实现一个分支选择策略，在消逝波区域产生 $\\operatorname{Im}(q)\\ge 0$ 的结果，从而确保介质 $2$ 中物理上可接受的下行衰减，并通过公式中的符号 $s$ 保证介质 $1$ 中一致的上行行为。\n- 使用数值稳定的方法求解 $4\\times 4$ 系统。如果矩阵在临界角附近是病态的，则使用最小二乘法作为备用方案。\n\n单位和角度约定：\n- $\\alpha$、$\\beta$ 单位为 $\\text{m/s}$，\n- $\\rho$ 单位为 $\\text{kg/m}^3$，\n- 角度单位为弧度，\n- 返回的系数是无量纲的复振幅。\n\n测试套件：\n你的程序必须使用以下六组参数 $(\\alpha_1,\\beta_1,\\rho_1,\\alpha_2,\\beta_2,\\rho_2,\\theta_1)$ 来评估求解器，其中 $\\theta_1$ 是介质 $1$ 中入射 P 波的角度（以弧度为单位）。\n1. $(2500,\\,1200,\\,2200,\\,3000,\\,1500,\\,2400,\\,0.8)$: 亚临界参考。\n2. $(2500,\\,1200,\\,2200,\\,3000,\\,1500,\\,2400,\\,0.985)$: 接近透射 P 波临界角，略低于临界角。\n3. $(2500,\\,1200,\\,2200,\\,3000,\\,1500,\\,2400,\\,0.995)$: 刚超过透射 P 波临界角（$q_{2P}$ 为消逝波）。\n4. $(3000,\\,1500,\\,2200,\\,3000,\\,1500,\\,2200,\\,0.5)$: 相同介质的合理性检查。\n5. $(2000,\\,1000,\\,2000,\\,4000,\\,2200,\\,2800,\\,1.2)$: 强对比度、大角度，在介质 $2$ 中 P 波超临界。\n6. $(2500,\\,1400,\\,2100,\\,3200,\\,1800,\\,2600,\\,1.3)$: 中等对比度下的大角度。\n\n最终输出规格：\n- 对于每个测试用例，返回列表 $[ \\Re(R_{PP}), \\Im(R_{PP}), \\Re(R_{PS}), \\Im(R_{PS}), \\Re(T_{PP}), \\Im(T_{PP}), \\Re(T_{PS}), \\Im(T_{PS}) ]$。\n- 你的程序应生成单行输出，其中包含所有测试用例的结果，格式为一个由逗号分隔的列表组成的列表，并用方括号括起来。例如：`[ [a1,a2,...,a8], [b1,b2,...,b8], ... ]`。",
            "solution": "问题陈述已经过严格审查，并被确定为有效。它提出了一个计算地球物理学中适定的、有科学依据的问题，该问题基于线性弹性动力学的既定原理。所提供的方程、定义和参数是内部一致的，能够用于构建和求解一个完整的物理问题。\n\n任务是计算一个平面 P 波入射到两个不同弹性介质之间的平面边界时的复反射和透射系数。这个问题由 Zoeppritz 方程控制，这些方程源于在界面上对位移和应力施加边界条件。该问题是为 P-SV 耦合波构建的，需要求解一个 $4 \\times 4$ 的线性系统，以求得四个未知的波振幅：反射 P 波（$R_{PP}$）、反射 SV 波（$R_{PS}$）、透射 P 波（$T_{PP}$）和透射 SV 波（$T_{PS}$）。\n\n求解过程遵循以下步骤：\n\n**1. 运动学参数**\n所有平面波的运动学都通过斯涅尔定律（Snell's law）联系在一起，该定律指出水平慢度 $p$ 在穿过界面时是守恒的。对于介质 1 中速度为 $\\alpha_1$、与法线夹角为 $\\theta_1$ 的入射 P 波，其水平慢度为：\n$$\np = \\frac{\\sin\\theta_1}{\\alpha_1}\n$$\n对于任何速度为 $v$ 的波（P 波或 SV 波），其垂直慢度 $q$ 依赖于 $p$：\n$$\nq(v, p) = \\sqrt{\\frac{1}{v^2} - p^2}\n$$\n为了处理超临界入射（其中 $p  1/v$），平方根内的项变为负数，$q$ 变为虚数。计算必须在复平面上进行。稳定解的物理要求是消逝波（$q$ 为虚数）必须在远离界面时衰减。在 $z$ 向下增加的坐标系中，介质 2（$z>0$）中的下行透射波必须随着 $z$ 的增加而衰减，而介质 1（$z0$）中的上行反射波必须随着 $z$ 的减小而衰减。通过选择复数平方根的分支使得 $\\operatorname{Im}(q) \\ge 0$，这两个条件都可以得到满足。诸如 NumPy 之类的标准复数算术库，其主根的计算遵循此约定。因此，我们定义所需的四个垂直慢度：\n- 介质 1 中的入射/反射 P 波：$q_{1P} = \\sqrt{1/\\alpha_1^2 - p^2 + 0j}$\n- 介质 1 中的反射 SV 波：$q_{1S} = \\sqrt{1/\\beta_1^2 - p^2 + 0j}$\n- 介质 2 中的透射 P 波：$q_{2P} = \\sqrt{1/\\alpha_2^2 - p^2 + 0j}$\n- 介质 2 中的透射 SV 波：$q_{2S} = \\sqrt{1/\\beta_2^2 - p^2 + 0j}$\n\n**2. 线性系统的构建**\n四个边界条件（水平位移 $u_x$、垂直位移 $u_z$、剪切应力 $\\sigma_{xz}$ 和法向应力 $\\sigma_{zz}$ 的连续性）产生一个包含四个线性方程的系统。设未知复振幅向量为 $\\mathbf{x} = [R_{PP}, R_{PS}, T_{PP}, T_{PS}]^\\top$。该系统可以写成矩阵形式 $A\\mathbf{x} = \\mathbf{b}$。通过重新整理问题陈述中提供的四个方程，我们确定了矩阵 $A$ 和向量 $\\mathbf{b}$ 的分量。\n\n根据 $u_x$ 的连续性：\n$$ p R_{PP} + q_{1S} R_{PS} - p T_{PP} + q_{2S} T_{PS} = -p $$\n根据 $u_z$ 的连续性：\n$$ -q_{1P} R_{PP} + p R_{PS} - q_{2P} T_{PP} - p T_{PS} = -q_{1P} $$\n根据 $\\sigma_{xz}$ 的连续性：\n$$ (2\\mu_1 p q_{1P}) R_{PP} - \\mu_1(p^2-q_{1S}^2) R_{PS} + (2\\mu_2 p q_{2P}) T_{PP} + \\mu_2(p^2-q_{2S}^2) T_{PS} = 2\\mu_1 p q_{1P} $$\n根据 $\\sigma_{zz}$ 的连续性，经过如下详述的重新整理和简化：\n$$ -C_1 R_{PP} + (2\\mu_1 p q_{1S}) R_{PS} + C_2 T_{PP} + (2\\mu_2 p q_{2S}) T_{PS} = C_1 $$\n其中 $C_1 = \\rho_1(1-2\\beta_1^2 p^2)$ 且 $C_2 = \\rho_2(1-2\\beta_2^2 p^2)$。这种简化源于将拉梅参数 $\\lambda$ 用密度 $\\rho$ 和波速 $\\alpha, \\beta$ 表示（即 $\\lambda = \\rho(\\alpha^2 - 2\\beta^2)$），并使用了恒等式 $p^2+q_P^2 = 1/\\alpha^2$。\n\n得到的 $4 \\times 4$ 复数矩阵 $A$ 为：\n$$\nA = \\begin{pmatrix}\np   q_{1S}   -p   q_{2S} \\\\\n-q_{1P}   p   -q_{2P}   -p \\\\\n2\\mu_1 p q_{1P}   -\\mu_1(p^2-q_{1S}^2)   2\\mu_2 p q_{2P}   \\mu_2(p^2-q_{2S}^2) \\\\\n-C_1   2\\mu_1 p q_{1S}   C_2   2\\mu_2 p q_{2S}\n\\end{pmatrix}\n$$\n复数向量 $\\mathbf{b}$ 为：\n$$\n\\mathbf{b} = \\begin{pmatrix} -p \\\\ -q_{1P} \\\\ 2\\mu_1 p q_{1P} \\\\ C_1 \\end{pmatrix}\n$$\n此处，剪切模量为 $\\mu_1 = \\rho_1\\beta_1^2$ 和 $\\mu_2 = \\rho_2\\beta_2^2$。\n\n**3. 算法求解**\n对于每个测试用例，算法按以下步骤进行：\n1. 给定材料属性 $(\\alpha_1, \\beta_1, \\rho_1, \\alpha_2, \\beta_2, \\rho_2)$ 和入射角 $\\theta_1$。\n2. 计算水平慢度 $p$。\n3. 计算四个复数垂直慢度 $q_{1P}, q_{1S}, q_{2P}, q_{2S}$。\n4. 计算必要的中间项，例如 $\\mu_1, \\mu_2, C_1, C_2$。\n5. 如上定义，构建复数矩阵 $A$ 和向量 $\\mathbf{b}$。\n6. 求解线性系统 $A\\mathbf{x} = \\mathbf{b}$ 以得到系数向量 $\\mathbf{x}$。一个标准的线性求解器，例如 `numpy.linalg.solve` 提供的求解器，对于非奇异情况是足够且数值稳定的。问题中提到的最小二乘备用方案是实现通用稳健程序时的一个有效考虑，但在此处直接求解是合适的。\n7. 结果向量 $\\mathbf{x} = [R_{PP}, R_{PS}, T_{PP}, T_{PS}]^\\top$ 包含了所需的复系数。\n8. 为了最终输出，提取每个系数的实部和虚部，并按规定格式化。介质相同的特殊情况可作为合理性检查，其解必须是 $\\mathbf{x}=[0,0,1,0]^\\top$，对应于完美透射和无反射。\n\n此过程正确且稳健地实现了 Zoeppritz 方程，遵循了波传播的物理原理，包括在临界角及超临界角下的行为。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\n\ndef solve_zoeppritz(alpha1, beta1, rho1, alpha2, beta2, rho2, theta1_rad):\n    \"\"\"\n    Computes P-SV reflection/transmission coefficients using the Zoeppritz equations.\n\n    The implementation solves the 4x4 linear system derived from boundary conditions\n    at the interface between two elastic half-spaces. Complex arithmetic is used\n    throughout to handle post-critical angle scenarios.\n\n    Args:\n        alpha1 (float): P-wave speed in medium 1 (m/s).\n        beta1 (float): S-wave speed in medium 1 (m/s).\n        rho1 (float): Density of medium 1 (kg/m^3).\n        alpha2 (float): P-wave speed in medium 2 (m/s).\n        beta2 (float): S-wave speed in medium 2 (m/s).\n        rho2 (float): Density of medium 2 (kg/m^3).\n        theta1_rad (float): Incident P-wave angle in medium 1 (radians).\n\n    Returns:\n        list: A list of 8 floats representing the real and imaginary parts of\n              the four complex coefficients [R_PP, R_PS, T_PP, T_PS].\n    \"\"\"\n    # 1. Calculate slowness and other parameters\n    # For theta1_rad approaching pi/2, p can be very close to 1/alpha1.\n    # A small tolerance may be needed for numerical stability if grazing angle is allowed.\n    # Here we assume test cases are not at exactly pi/2.\n    if np.isclose(theta1_rad, np.pi/2):\n        p = 1.0 / alpha1\n    else:\n        p = np.sin(theta1_rad) / alpha1\n\n    # 2. Calculate vertical slownesses\n    # Using complex numbers from the start ensures correct branch cuts for evanescent waves.\n    # The condition Im(q) >= 0 is handled correctly by np.sqrt for a complex argument.\n    q_alpha1 = np.sqrt(1/alpha1**2 - p**2 + 0j)\n    q_beta1 = np.sqrt(1/beta1**2 - p**2 + 0j)\n    q_alpha2 = np.sqrt(1/alpha2**2 - p**2 + 0j)\n    q_beta2 = np.sqrt(1/beta2**2 - p**2 + 0j)\n\n    # 3. Assemble the Zoeppritz matrix A and vector b\n    # These are derived directly from the four boundary condition equations provided\n    # in the problem statement.\n    # The unknown vector is x = [R_PP, R_PS, T_PP, T_PS]^T\n    \n    A = np.zeros((4, 4), dtype=np.complex128)\n    b = np.zeros(4, dtype=np.complex128)\n    \n    mu1 = rho1 * beta1**2\n    mu2 = rho2 * beta2**2\n\n    # Row 1: Continuity of horizontal displacement u_x\n    A[0, 0] = p\n    A[0, 1] = q_beta1\n    A[0, 2] = -p\n    A[0, 3] = q_beta2\n    b[0] = -p\n\n    # Row 2: Continuity of vertical displacement u_z\n    A[1, 0] = -q_alpha1\n    A[1, 1] = p\n    A[1, 2] = -q_alpha2\n    A[1, 3] = -p\n    b[1] = -q_alpha1\n\n    # Row 3: Continuity of shear traction sigma_xz\n    A[2, 0] = 2 * mu1 * p * q_alpha1\n    A[2, 1] = -mu1 * (p**2 - q_beta1**2)\n    A[2, 2] = 2 * mu2 * p * q_alpha2\n    A[2, 3] = mu2 * (p**2 - q_beta2**2)\n    b[2] = 2 * mu1 * p * q_alpha1\n\n    # Row 4: Continuity of normal traction sigma_zz\n    # Using the simplified expressions C1 and C2 as derived in the solution description.\n    C1 = rho1 * (1 - 2 * beta1**2 * p**2)\n    C2 = rho2 * (1 - 2 * beta2**2 * p**2)\n    A[3, 0] = -C1\n    A[3, 1] = 2 * mu1 * p * q_beta1\n    A[3, 2] = C2\n    A[3, 3] = 2 * mu2 * p * q_beta2\n    b[3] = C1\n    \n    # 4. Solve the linear system\n    try:\n        coeffs = np.linalg.solve(A, b)\n    except np.linalg.LinAlgError:\n        # Fallback to least-squares for ill-conditioned matrices (e.g., at critical angles)\n        coeffs, _, _, _ = np.linalg.lstsq(A, b, rcond=None)\n\n    # 5. Format output\n    # Flatten the complex coefficients into a list of real and imaginary parts\n    # [Re(R_PP), Im(R_PP), Re(R_PS), Im(R_PS), Re(T_PP), Im(T_PP), Re(T_PS), Im(T_PS)]\n    result = [\n        coeffs[0].real, coeffs[0].imag,\n        coeffs[1].real, coeffs[1].imag,\n        coeffs[2].real, coeffs[2].imag,\n        coeffs[3].real, coeffs[3].imag,\n    ]\n    return result\n\ndef solve():\n    \"\"\"\n    Main function to run the test suite and print results.\n    \"\"\"\n    # Define the test cases from the problem statement.\n    test_cases = [\n        (2500, 1200, 2200, 3000, 1500, 2400, 0.8),\n        (2500, 1200, 2200, 3000, 1500, 2400, 0.985),\n        (2500, 1200, 2200, 3000, 1500, 2400, 0.995),\n        (3000, 1500, 2200, 3000, 1500, 2200, 0.5),\n        (2000, 1000, 2000, 4000, 2200, 2800, 1.2),\n        (2500, 1400, 2100, 3200, 1800, 2600, 1.3),\n    ]\n\n    results = []\n    for case in test_cases:\n        # Calculate the coefficients for one case\n        coefficients = solve_zoeppritz(*case)\n        results.append(coefficients)\n\n    # Format the final output string exactly as required.\n    # e.g., [[a1,a2,...,a8],[b1,b2,...,b8],...]\n    # No spaces after commas inside the inner lists.\n    inner_parts = [f\"[{','.join(f'{x:.17g}' for x in r)}]\" for r in results]\n    final_output = f\"[{','.join(inner_parts)}]\"\n    \n    # Final print statement in the exact required format.\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "将连续介质物理学转化为计算模型会引入数值伪影，其中数值频散是最重要的影响之一。这项练习 () 从理想化的解析方程转向有限差分模拟的实际挑战。你将分析网格间距如何改变反射波和透射波的传播角度，并推导出一个标准来确保这种数值误差保持在可接受的阈值以下。",
            "id": "3613525",
            "problem": "考虑由标量声波方程控制的二维平面波传播，该传播发生在由一个平面界面分隔的两个均匀、各向同性的半空间中。其控制偏微分方程为标量声波方程\n$$\n\\frac{\\partial^2 p}{\\partial t^2} = v^2 \\nabla^2 p,\n$$\n其中 $p$ 为声压，$v$ 为波速。假设界面两侧的质量密度相等，因此声阻抗与波速成正比。设界面为 $x$ 轴，向上法线沿 $+y$ 方向，并考虑一平面波从介质 $1$（$y>0$，波速 $v_1$）入射到介质 $2$（$y0$，波速 $v_2$），两种介质的波速均为常数。入射平面波的角频率为 $\\omega=2\\pi f$，入射角 $\\theta_{\\mathrm{inc}}$ 是相对于界面法线测量的。\n\n从以下基本出发点开始：\n- 连续介质中的标量声波方程及其平面波解形式 $p(\\mathbf{x},t) = \\Re\\{ P_0 e^{\\mathrm{i}(\\mathbf{k}\\cdot\\mathbf{x}-\\omega t)} \\}$，其连续介质色散关系为\n$$\n\\omega^2 = v^2 |\\mathbf{k}|^2,\n$$\n以及切向波数分量 $k_x$ 在界面上保持不变。在连续介质中，这意味着\n$$\nk_x = \\frac{\\omega}{v_1} \\sin \\theta_{\\mathrm{inc}} = \\frac{\\omega}{v_2} \\sin \\theta_{\\mathrm{trans,true}},\n$$\n因此透射角满足斯涅尔定律，\n$$\n\\frac{\\sin \\theta_{\\mathrm{inc}}}{v_1} = \\frac{\\sin \\theta_{\\mathrm{trans,true}}}{v_2}.\n$$\n连续介质中的反射角为 $\\theta_{\\mathrm{refl,true}} = \\theta_{\\mathrm{inc}}$。\n\n- 在间距为 $\\Delta x=\\Delta y=\\Delta$ 的均匀笛卡尔网格和时间步长为 $\\Delta t$ 的情况下，一个标准的显式时间二阶、空间二阶有限差分格式可得到平面波的数值色散关系\n$$\n\\sin^2\\!\\left(\\frac{\\omega \\Delta t}{2}\\right) = (v \\Delta t)^2 \\left[\\frac{\\sin^2\\!\\left(\\frac{k_x \\Delta}{2}\\right)}{\\Delta^2} + \\frac{\\sin^2\\!\\left(\\frac{k_y \\Delta}{2}\\right)}{\\Delta^2}\\right].\n$$\n假设一个固定的类库朗数 $r$（$0  r \\le 1/\\sqrt{2}$），使得 $\\Delta t = r\\Delta/v_{\\max}$，其中 $v_{\\max} = \\max(v_1, v_2)$。",
            "solution": "本解答旨在完成问题陈述中列出的三项任务。所有角度在计算中均假定为弧度单位。\n\n### 1. 从色散关系到相角误差\n\n问题陈述为从基本数值色散关系到相角误差定义了一条清晰的路径。我们对此过程进行形式化。\n\n对于每个以波速 $v_i$ 为特征的介质 $i \\in \\{1, 2\\}$，角频率 $\\omega$、网格间距 $\\Delta$、时间步长 $\\Delta t$ 与数值波矢分量 $(k_x, k_{y,i}^{\\mathrm{num}})$ 之间的关系由数值色散关系给出：\n$$\n\\sin^2\\!\\left(\\frac{\\omega \\Delta t}{2}\\right) = (v_i \\Delta t)^2 \\left[\\frac{\\sin^2\\!\\left(\\frac{k_x \\Delta}{2}\\right)}{\\Delta^2} + \\frac{\\sin^2\\!\\left(\\frac{k_{y,i}^{\\mathrm{num}} \\Delta}{2}\\right)}{\\Delta^2}\\right]\n$$\n波矢的切向分量 $k_x$ 在界面上是连续的，并由连续介质中的入射波条件决定：$k_x = (\\omega/v_1)\\sin\\theta_{\\mathrm{inc}}$。数值格式保留了这个 $k_x$ 值。\n\n为了找到数值垂直波数分量 $k_{y,i}^{\\mathrm{num}}$，我们重排色散关系：\n$$\n\\sin^2\\!\\left(\\frac{k_{y,i}^{\\mathrm{num}} \\Delta}{2}\\right) = \\frac{\\Delta^2}{(v_i \\Delta t)^2} \\sin^2\\!\\left(\\frac{\\omega \\Delta t}{2}\\right) - \\sin^2\\!\\left(\\frac{k_x \\Delta}{2}\\right)\n$$\n为使传播波存在于数值网格中，等式右侧必须为非负。解出 $k_{y,i}^{\\mathrm{num}}$ 可得：\n$$\nk_{y,i}^{\\mathrm{num}} = \\frac{2}{\\Delta} \\arcsin\\!\\left(\\sqrt{ \\frac{\\Delta^2}{(v_i \\Delta t)^2} \\sin^2\\!\\left(\\frac{\\omega \\Delta t}{2}\\right) - \\sin^2\\!\\left(\\frac{k_x \\Delta}{2}\\right) }\\right)\n$$\n数值相角 $\\theta_i^{\\mathrm{num}}$ 是数值波矢 $\\mathbf{k}^{\\mathrm{num}} = (k_x, k_{y,i}^{\\mathrm{num}})$ 相对于垂直方向（$y$轴）的角度。其定义为：\n$$\n\\theta_{i}^{\\mathrm{num}} = \\arctan\\!\\left(\\frac{k_x}{k_{y,i}^{\\mathrm{num}}}\\right)\n$$\n对于连续介质，相应的真实相角 $\\theta_i^{\\mathrm{true}}$ 由斯涅尔定律给出。对于介质1中的反射波，$\\theta_{1}^{\\mathrm{true}} = \\theta_{\\mathrm{inc}}$。对于介质2中的透射波，$\\sin\\theta_{2}^{\\mathrm{true}} = (v_2/v_1)\\sin\\theta_{\\mathrm{inc}}$。\n\n反射波和透射波的相角误差即为数值角度与真实角度之间的绝对差：\n$$\n\\delta\\theta_{\\mathrm{refl}} = \\delta\\theta_1 = \\left|\\theta_{1}^{\\mathrm{num}} - \\theta_{1}^{\\mathrm{true}}\\right|\n$$\n$$\n\\delta\\theta_{\\mathrm{trans}} = \\delta\\theta_2 = \\left|\\theta_{2}^{\\mathrm{num}} - \\theta_{2}^{\\mathrm{true}}\\right|\n$$\n这些表达式将离散色散关系与待控制的量之间的联系形式化了。\n\n### 2. 网格间距 $\\Delta$ 的渐近准则\n\n我们寻求一个关于 $\\Delta$ 的显式不等式，以保证对于一个小的阈值 $\\tau$，有 $\\max(\\delta\\theta_1, \\delta\\theta_2) \\le \\tau$。这需要对数值色散关系进行小 $\\Delta$ 渐近分析。我们对小宗量 $z$ 使用泰勒级数展开：$\\sin(z) \\approx z - z^3/6$ 和 $\\sin^2(z) \\approx z^2 - z^4/3$。\n\n从 $k_{y,i}^{\\mathrm{num}}$ 的表达式开始：\n$$\n\\sin^2\\!\\left(\\frac{k_{y,i}^{\\mathrm{num}} \\Delta}{2}\\right) = \\left(\\frac{\\Delta}{v_i \\Delta t}\\right)^2 \\sin^2\\!\\left(\\frac{\\omega \\Delta t}{2}\\right) - \\sin^2\\!\\left(\\frac{k_x \\Delta}{2}\\right)\n$$\n我们将每一项展开到 $O(\\Delta^4)$ 阶：\n$$\n\\text{LHS} \\approx \\left(\\frac{k_{y,i}^{\\mathrm{num}} \\Delta}{2}\\right)^2 - \\frac{1}{3}\\left(\\frac{k_{y,i}^{\\mathrm{num}} \\Delta}{2}\\right)^4 = \\frac{\\Delta^2}{4}(k_{y,i}^{\\mathrm{num}})^2 - \\frac{\\Delta^4}{48}(k_{y,i}^{\\mathrm{num}})^4\n$$\n$$\n\\text{RHS term 1} \\approx \\left(\\frac{\\Delta}{v_i \\Delta t}\\right)^2 \\left[\\left(\\frac{\\omega \\Delta t}{2}\\right)^2 - \\frac{1}{3}\\left(\\frac{\\omega \\Delta t}{2}\\right)^4\\right] = \\frac{\\Delta^2\\omega^2}{4v_i^2} - \\frac{\\Delta^2\\omega^4\\Delta t^2}{48v_i^2}\n$$\n$$\n\\text{RHS term 2} \\approx \\left(\\frac{k_x \\Delta}{2}\\right)^2 - \\frac{1}{3}\\left(\\frac{k_x \\Delta}{2}\\right)^4 = \\frac{\\Delta^2 k_x^2}{4} - \\frac{\\Delta^4 k_x^4}{48}\n$$\n合并各项并回顾连续介质关系 $(k_{y,i}^{\\mathrm{true}})^2 = (\\omega/v_i)^2 - k_x^2$：\n$$\n\\frac{\\Delta^2}{4}(k_{y,i}^{\\mathrm{num}})^2 - \\frac{\\Delta^4}{48}(k_{y,i}^{\\mathrm{num}})^4 \\approx \\frac{\\Delta^2}{4}(k_{y,i}^{\\mathrm{true}})^2 - \\frac{\\Delta^2\\omega^4\\Delta t^2}{48v_i^2} + \\frac{\\Delta^4 k_x^4}{48}\n$$\n在左侧的 $O(\\Delta^4)$ 项中近似 $k_{y,i}^{\\mathrm{num}} \\approx k_{y,i}^{\\mathrm{true}}$，并代入 $\\Delta t = r\\Delta/v_{\\max}$：\n$$\n(k_{y,i}^{\\mathrm{num}})^2 \\approx (k_{y,i}^{\\mathrm{true}})^2 + \\frac{\\Delta^2}{12}\\left[ (k_{y,i}^{\\mathrm{true}})^4 - k_x^4 - \\frac{\\omega^4 r^2 v_i^2}{v_i^2 v_{\\max}^2} \\right] = (k_{y,i}^{\\mathrm{true}})^2 + \\frac{\\Delta^2}{12}\\left[ (k_{y,i}^{\\mathrm{true}})^4 - k_x^4 - \\frac{\\omega^4 r^2}{v_{\\max}^2} \\right]\n$$\n$k_{y,i}$ 的误差为 $\\delta k_{y,i} = k_{y,i}^{\\mathrm{num}} - k_{y,i}^{\\mathrm{true}}$。对于小误差，$(k_{y,i}^{\\mathrm{true}} + \\delta k_{y,i})^2 \\approx (k_{y,i}^{\\mathrm{true}})^2 + 2k_{y,i}^{\\mathrm{true}}\\delta k_{y,i}$。\n$$\n2k_{y,i}^{\\mathrm{true}}\\delta k_{y,i} \\approx \\frac{\\Delta^2}{12}\\left[ (k_{y,i}^{\\mathrm{true}})^4 - k_x^4 - \\frac{\\omega^4 r^2}{v_{\\max}^2} \\right]\n$$\n角度误差 $\\delta\\theta_i$ 通过 $\\delta\\theta_i \\approx (\\partial\\theta_i/\\partial k_{y,i})\\,\\delta k_{y,i}$ 与 $\\delta k_{y,i}$ 相关。\n$$\n\\frac{\\partial\\theta_i}{\\partial k_{y,i}} = \\frac{\\partial}{\\partial k_{y,i}}\\arctan\\left(\\frac{k_x}{k_{y,i}}\\right) = \\frac{1}{1+(k_x/k_{y,i})^2}\\left(-\\frac{k_x}{k_{y,i}^2}\\right) = -\\frac{k_x}{k_x^2+k_{y,i}^2} = -\\frac{k_x}{(\\omega/v_i)^2}\n$$\n结合这些结果并在真值处求值：\n$$\n\\delta\\theta_i \\approx -\\frac{k_x}{(\\omega/v_i)^2} \\frac{1}{2k_{y,i}^{\\mathrm{true}}} \\frac{\\Delta^2}{12}\\left[ (k_{y,i}^{\\mathrm{true}})^4 - k_x^4 - \\frac{\\omega^4 r^2}{v_{\\max}^2} \\right]\n$$\n使用连续介质关系 $k_x = \\frac{\\omega}{v_i}\\sin\\theta_i^{\\mathrm{true}}$，$k_{y,i}^{\\mathrm{true}} = \\frac{\\omega}{v_i}\\cos\\theta_i^{\\mathrm{true}}$：\n$$\n\\delta\\theta_i \\approx -\\frac{\\tan\\theta_i^{\\mathrm{true}}}{24} \\left(\\frac{\\omega\\Delta}{v_i}\\right)^2 \\left[ (\\cos^4\\theta_i^{\\mathrm{true}} - \\sin^4\\theta_i^{\\mathrm{true}}) - r^2\\left(\\frac{v_i}{v_{\\max}}\\right)^2 \\right]\n$$\n简化 $\\cos^4\\theta - \\sin^4\\theta = (\\cos^2\\theta - \\sin^2\\theta)(\\cos^2\\theta + \\sin^2\\theta) = \\cos(2\\theta)$：\n$$\n\\delta\\theta_i \\approx -\\frac{\\tan\\theta_i^{\\mathrm{true}}}{24} \\left(\\frac{\\omega\\Delta}{v_i}\\right)^2 \\left[ \\cos(2\\theta_i^{\\mathrm{true}}) - r^2\\left(\\frac{v_i}{v_{\\max}}\\right)^2 \\right]\n$$\n要求 $|\\delta\\theta_i| \\le \\tau$ 得到一个关于 $\\Delta^2$ 的不等式：\n$$\n\\Delta^2 \\le \\frac{24\\tau v_i^2}{\\omega^2 |\\tan\\theta_i^{\\mathrm{true}}| \\left| \\cos(2\\theta_i^{\\mathrm{true}}) - r^2(v_i/v_{\\max})^2 \\right|}\n$$\n总体准则必须同时满足两种介质（$i=1$ 和 $i=2$）的约束，因此我们必须取两个边界的最小值：\n$$\n\\Delta \\le \\Delta_{\\max} = \\min_{i \\in \\{1,2\\}} \\left\\{ \\frac{v_i}{\\omega} \\sqrt{\\frac{24\\tau}{|\\tan\\theta_i^{\\mathrm{true}}| \\left| \\cos(2\\theta_i^{\\mathrm{true}}) - r^2(v_i/v_{\\max})^2 \\right|}} \\right\\}\n$$\n**假设与局限性**：该准则依赖于泰勒级数展开，在 $\\Delta \\omega / v_i$ 很小（即每个波长内有多个网格点）时有效。该公式在 $\\theta_i^{\\mathrm{true}}=0$（垂直入射）和 $\\theta_i^{\\mathrm{true}}=\\pi/2$（临界入射，此时 $\\tan\\theta$ 发散）时是奇异的。\n- 在垂直入射（$\\theta_i=0$）时，$k_x=0$，这导致 $\\theta_i^{\\mathrm{num}}=0$，因此 $\\delta\\theta_i=0$。该公式正确地预测了当 $\\theta_i \\to 0$ 时 $\\delta\\theta_i \\to 0$。\n- 在临界入射时，$k_{y,i}^{\\mathrm{true}}=0$，渐近误差标度从 $O(\\Delta^2)$ 变为 $O(\\Delta)$。上述公式不适用于这种特定情况。\n\n### 3. 数值算法\n\n目标是找到最大网格间距 $\\Delta_{\\max}$，使得 $\\max(\\delta\\theta_1, \\delta\\theta_2) \\le \\tau$。题目要求使用数值搜索方法，而不是使用任务2中的渐近公式。二分法搜索是一种鲁棒且合适的方法。\n\n算法如下：\n1.  对于一组给定的参数 $(v_1, v_2, f, \\theta_{\\mathrm{inc}}, \\tau, r)$，首先检查垂直入射的特殊情况。如果 $\\theta_{\\mathrm{inc}} = 0$，则对于任何 $\\Delta$，误差都恒为零，因此根据题目规定，我们定义 $\\Delta_{\\max}=0.0$。\n2.  如果 $\\theta_{\\mathrm{inc}} \\neq 0$，我们定义一个函数 `check(Delta)`，该函数计算 $\\max(|\\theta_1^{\\mathrm{num}} - \\theta_1^{\\mathrm{true}}|, |\\theta_2^{\\mathrm{num}} - \\theta_2^{\\mathrm{true}}|)$，如果该值小于或等于 $\\tau$，则返回 `True`，否则返回 `False`。\n    - 在 `check(Delta)` 内部，我们使用完整的、非近似的数值色散关系计算 $i=1,2$ 对应的 $\\theta_i^{\\mathrm{num}}$。\n    - 一个关键步骤是在计算 $k_{y,i}^{\\mathrm{num}}$ 时检查 `arcsin` 函数的宗量。如果值 `RHS` 不在 $[0, 1]$ 范围内，则表示对于给定的 $\\Delta$ 出现了数值倏逝或不稳定性。导致此情况的 `Delta` 值是无效的，应被视为未通过检查（即误差大于 $\\tau$）。\n3.  为二分法算法建立一个搜索区间 $[\\Delta_{\\mathrm{low}}, \\Delta_{\\mathrm{high}}]$。\n    - 设置 $\\Delta_{\\mathrm{low}} = 0$。在此值处，误差为 $0$，因此 `check(0)` 为 `True`。\n    - 找到一个合适的 $\\Delta_{\\mathrm{high}}$，使得 `check(Delta_high)` 为 `False`。一种鲁棒的方法是从一个猜测值（例如，$\\Delta_{\\mathrm{high}}=1.0$）开始，并反复加倍，直到违反误差条件。这保证了一个有效的搜索区间。\n4.  在 $[\\Delta_{\\mathrm{low}}, \\Delta_{\\mathrm{high}}]$ 内对 $\\Delta$ 执行二分法搜索。对于固定数量的迭代（例如，100次，足以实现双精度收敛）：\n    - 计算中点 $\\Delta_{\\mathrm{mid}} = (\\Delta_{\\mathrm{low}} + \\Delta_{\\mathrm{high}}) / 2$。\n    - 如果 `check(Delta_mid)` 为 `True`，则意味着 $\\Delta_{\\mathrm{mid}}$ 是一个有效的间距。我们或许可以使用更大的间距，因此设置 $\\Delta_{\\mathrm{low}} = \\Delta_{\\mathrm{mid}}$。\n    - 如果 `check(Delta_mid)` 为 `False`，则 $\\Delta_{\\mathrm{mid}}$ 太大。我们必须减小间距，因此设置 $\\Delta_{\\mathrm{high}} = \\Delta_{\\mathrm{mid}}$。\n5.  迭代结束后，$\\Delta_{\\mathrm{low}}$ 的值即为所需的 $\\Delta_{\\max}$，表示满足误差容限的最大网格间距。该值为此测试用例的结果。\n该算法通过数值方法找到了 $\\Delta$ 的可接受域的边界，而无需依赖可能不准确的渐近近似，这符合要求。",
            "answer": "```python\nimport numpy as np\n\ndef compute_errors_and_check_validity(delta, params):\n    \"\"\"\n    Computes numerical phase angle errors for a given grid spacing delta.\n\n    Args:\n        delta (float): The grid spacing Delta.\n        params (tuple): A tuple of physical parameters (v1, v2, f, theta_inc_deg, r).\n\n    Returns:\n        tuple: (is_valid, error_refl, error_trans)\n               is_valid is False if delta causes numerical evanescence.\n    \"\"\"\n    v1, v2, f, theta_inc_deg, r = params\n\n    if delta = 1e-12:\n        return True, 0.0, 0.0\n\n    # Convert to radians and calculate constants\n    theta_inc_rad = np.deg2rad(theta_inc_deg)\n    \n    omega = 2.0 * np.pi * f\n    v_max = max(v1, v2)\n    delta_t = r * delta / v_max\n    \n    # Continuum (true) values\n    theta_1_true = theta_inc_rad\n    sin_theta2_arg = v2 / v1 * np.sin(theta_1_true)\n    \n    # Problem guarantees no continuum evanescence\n    sin_theta2_arg = min(1.0, sin_theta2_arg) # Clamp for float precision at critical angle\n    theta_2_true = np.arcsin(sin_theta2_arg)\n\n    k_x = (omega / v1) * np.sin(theta_1_true)\n\n    errors = []\n    \n    for i, v_i in enumerate([v1, v2]):\n        # Calculate the argument for the arcsin in the ky_num formula\n        term1_arg = omega * delta_t / 2.0\n        term2_arg = k_x * delta / 2.0\n        \n        rhs = (delta / (v_i * delta_t))**2 * np.sin(term1_arg)**2 - np.sin(term2_arg)**2\n        \n        # Check if delta is too large, causing numerical evanescence\n        if not (0.0 = rhs = 1.0):\n            return False, np.inf, np.inf\n\n        # Calculate numerical ky and then the numerical angle\n        ky_num = (2.0 / delta) * np.arcsin(np.sqrt(rhs))\n        \n        # Avoid division by zero if ky_num is numerically zero\n        if np.isclose(ky_num, 0.0):\n            if np.isclose(k_x, 0.0):\n                theta_num = 0.0\n            else:\n                theta_num = np.pi / 2.0\n        else:\n            theta_num = np.arctan(k_x / ky_num)\n        \n        theta_true = theta_1_true if i == 0 else theta_2_true\n        error = np.abs(theta_num - theta_true)\n        errors.append(error)\n        \n    return True, errors[0], errors[1]\n\n\ndef find_delta_max(case_params):\n    \"\"\"\n    Finds the maximum grid spacing delta using a bisection search.\n    \"\"\"\n    v1, v2, f, theta_inc_deg, tau, r = case_params\n\n    # Handle special case of normal incidence\n    if np.isclose(theta_inc_deg, 0.0):\n        return 0.0\n\n    params_for_checker = (v1, v2, f, theta_inc_deg, r)\n\n    # --- Bisection Search ---\n    \n    # 1. Set search interval [low, high]\n    low = 0.0\n    high = 1.0  # Initial guess for the upper bound\n\n    # 2. Find a robust upper bound where the error condition is violated\n    max_iter_bound = 20\n    for _ in range(max_iter_bound):\n        is_valid, err1, err2 = compute_errors_and_check_validity(high, params_for_checker)\n        if not is_valid or max(err1, err2) > tau:\n            break\n        high *= 2.0\n    else:\n        # This case suggests even a large delta satisfies the constraint,\n        # which is unlikely for the given problems but handled for robustness.\n        return high\n\n    # 3. Perform bisection search\n    for _ in range(100):  # 100 iterations provide more than enough precision\n        mid = (low + high) / 2.0\n        if mid == low or mid == high:\n             break # Precision limit reached\n        \n        is_valid, err1, err2 = compute_errors_and_check_validity(mid, params_for_checker)\n        \n        if is_valid and max(err1, err2) = tau:\n            low = mid  # This delta is acceptable, try a larger one\n        else:\n            high = mid # This delta is too large or invalid\n\n    return low\n\ndef solve():\n    \"\"\"\n    Main function to solve the problem for the given test suite.\n    \"\"\"\n    # Test suite: (v1, v2, f, theta_inc, tau, r)\n    test_cases = [\n        (1500.0, 3000.0, 20.0, 30.0, 0.01, 0.45),\n        (2500.0, 1500.0, 30.0, 35.0, 0.005, 0.45),\n        (2000.0, 2200.0, 100.0, 10.0, 0.002, 0.45),\n        (2000.0, 2500.0, 40.0, 45.0, 0.01, 0.45),\n        (1800.0, 2200.0, 25.0, 0.0, 0.005, 0.45),\n    ]\n\n    results = []\n    for case in test_cases:\n        delta_max = find_delta_max(case)\n        results.append(delta_max)\n\n    # Format the output as specified in the problem statement\n    # with rounding to four decimal places.\n    output_str = f\"[{','.join(f'{res:.4f}' for res in results)}]\"\n    print(output_str)\n\nsolve()\n```"
        }
    ]
}