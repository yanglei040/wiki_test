{
    "hands_on_practices": [
        {
            "introduction": "掌握任何优化算法的第一步都是理解其核心机制。这个练习将带你手动完成一个基本的 Armijo 回溯线搜索过程。通过为一个简单的二次目标函数计算可接受的步长，你将具体地看到 Armijo 条件如何确保每一步迭代都能带来足够的函数值下降，这是保证优化算法收敛的关键一步。这个基础计算是后续更复杂策略的基石。",
            "id": "3607600",
            "problem": "考虑一个线性化的地球物理反演问题，其中数据失配由最小二乘泛函 $F(m) = \\frac{1}{2}\\|A m - b\\|_{2}^{2}$ 建模。正演算子 $A$ 和数据 $b$ 由下式给出：\n$$\nA = \\begin{pmatrix} 4  0 \\\\ 0  1 \\end{pmatrix}, \\qquad b = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}.\n$$\n从当前的模型向量\n$$\nm_k = \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix},\n$$\n出发，采用最速下降方向 $p_k = -\\nabla F(m_k)$ 并执行 Armijo 回溯线搜索，其中充分下降参数为 $c = \\frac{1}{10}$，初始步长为 $\\alpha_0 = 1$，缩减因子为 $\\tau = \\frac{1}{2}$。从 $\\alpha = \\alpha_0$ 开始回溯，并通过 $\\alpha \\leftarrow \\tau \\alpha$ 逐步缩减步长，直到满足沿 $p_k$ 方向的 Armijo 充分下降准则，求出第一个可接受的步长 $\\alpha$。将最终答案表示为精确值，不进行四舍五入，也不带单位。",
            "solution": "用户提供了一个数值优化中的适定问题。我将给出详细的解答。\n\n该问题要求在线搜索过程中找到第一个可接受的步长 $\\alpha$，以最小化给定的目标泛函。该线搜索采用 Armijo 回溯策略。\n\n目标泛函由下式给出\n$$F(m) = \\frac{1}{2}\\|A m - b\\|_{2}^{2}$$\n其中 $m = \\begin{pmatrix} m_1 \\\\ m_2 \\end{pmatrix}$ 是模型向量，正演算子 $A$ 和数据向量 $b$ 为\n$$A = \\begin{pmatrix} 4  0 \\\\ 0  1 \\end{pmatrix}, \\qquad b = \\begin{pmatrix} 0 \\\\ 0 \\end{pmatrix}$$\n由于 $b=0$，该泛函简化为 $F(m) = \\frac{1}{2}\\|A m\\|_{2}^{2}$。\n\n首先，我们计算泛函的梯度 $\\nabla F(m)$。\n$$F(m) = \\frac{1}{2}(A m - b)^T(A m - b)$$\n梯度由下式给出\n$$\\nabla F(m) = A^T(A m - b)$$\n代入给定的 $A$ 和 $b$，并注意到 $A$ 是对称的 ($A^T=A$)，我们得到\n$$\\nabla F(m) = A(A m) = A^2 m = \\begin{pmatrix} 16  0 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} m_1 \\\\ m_2 \\end{pmatrix} = \\begin{pmatrix} 16m_1 \\\\ m_2 \\end{pmatrix}$$\n当前模型向量为 $m_k = \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix}$。我们在此点计算梯度：\n$$\\nabla F(m_k) = \\begin{pmatrix} 16(1) \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} 16 \\\\ -1 \\end{pmatrix}$$\n问题指定了最速下降方向，即梯度的负方向：\n$$p_k = -\\nabla F(m_k) = -\\begin{pmatrix} 16 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} -16 \\\\ 1 \\end{pmatrix}$$\n接下来，我们构建步长 $\\alpha$ 必须满足的 Armijo 充分下降条件：\n$$F(m_k + \\alpha p_k) \\le F(m_k) + c \\alpha \\nabla F(m_k)^T p_k$$\n其中充分下降参数给定为 $c = \\frac{1}{10}$。\n\n我们必须计算此不等式中的每一项。\n首先，泛函在当前点 $m_k$ 的值：\n$$A m_k = \\begin{pmatrix} 4  0 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} = \\begin{pmatrix} 4 \\\\ -1 \\end{pmatrix}$$\n$$F(m_k) = \\frac{1}{2}\\|A m_k\\|_{2}^{2} = \\frac{1}{2} \\left\\| \\begin{pmatrix} 4 \\\\ -1 \\end{pmatrix} \\right\\|_{2}^{2} = \\frac{1}{2}(4^2 + (-1)^2) = \\frac{1}{2}(16+1) = \\frac{17}{2}$$\n其次，方向导数项 $\\nabla F(m_k)^T p_k$：\n$$\\nabla F(m_k)^T p_k = \\begin{pmatrix} 16  -1 \\end{pmatrix} \\begin{pmatrix} -16 \\\\ 1 \\end{pmatrix} = (16)(-16) + (-1)(1) = -256 - 1 = -257$$\n注意，对于最速下降方向，这等价于 $-\\|\\nabla F(m_k)\\|_{2}^{2}$。确实，$\\|\\nabla F(m_k)\\|_{2}^{2} = 16^2+(-1)^2 = 256+1=257$。\n\n现在，我们计算 Armijo 条件的左侧，$F(m_k + \\alpha p_k)$：\n$$m_k + \\alpha p_k = \\begin{pmatrix} 1 \\\\ -1 \\end{pmatrix} + \\alpha \\begin{pmatrix} -16 \\\\ 1 \\end{pmatrix} = \\begin{pmatrix} 1 - 16\\alpha \\\\ -1 + \\alpha \\end{pmatrix}$$\n$$A(m_k + \\alpha p_k) = \\begin{pmatrix} 4  0 \\\\ 0  1 \\end{pmatrix} \\begin{pmatrix} 1 - 16\\alpha \\\\ -1 + \\alpha \\end{pmatrix} = \\begin{pmatrix} 4(1 - 16\\alpha) \\\\ -1 + \\alpha \\end{pmatrix} = \\begin{pmatrix} 4 - 64\\alpha \\\\ -1 + \\alpha \\end{pmatrix}$$\n$$F(m_k + \\alpha p_k) = \\frac{1}{2} \\left\\| \\begin{pmatrix} 4 - 64\\alpha \\\\ -1 + \\alpha \\end{pmatrix} \\right\\|_{2}^{2} = \\frac{1}{2}((4 - 64\\alpha)^2 + (-1 + \\alpha)^2)$$\n展开各项：\n$$F(m_k + \\alpha p_k) = \\frac{1}{2}(16 - 512\\alpha + 4096\\alpha^2 + 1 - 2\\alpha + \\alpha^2) = \\frac{1}{2}(17 - 514\\alpha + 4097\\alpha^2)$$\n将所有项代回 Armijo 不等式：\n$$\\frac{1}{2}(17 - 514\\alpha + 4097\\alpha^2) \\le \\frac{17}{2} + \\frac{1}{10}\\alpha(-257)$$\n$$\\frac{1}{2}(17 - 514\\alpha + 4097\\alpha^2) \\le \\frac{17}{2} - \\frac{257}{10}\\alpha$$\n两边同乘以 $2$：\n$$17 - 514\\alpha + 4097\\alpha^2 \\le 17 - \\frac{257}{5}\\alpha$$\n两边同减去 $17$：\n$$-514\\alpha + 4097\\alpha^2 \\le -\\frac{257}{5}\\alpha$$\n由于在线搜索中 $\\alpha > 0$，我们可以两边同除以 $\\alpha$：\n$$-514 + 4097\\alpha \\le -\\frac{257}{5}$$\n$$4097\\alpha \\le 514 - \\frac{257}{5}$$\n$$4097\\alpha \\le \\frac{2570 - 257}{5} = \\frac{2313}{5}$$\n$$\\alpha \\le \\frac{2313}{5 \\times 4097} = \\frac{2313}{20485}$$\n数值上，$\\frac{2313}{20485} \\approx 0.1129$。\n\nArmijo 回溯过程从初始步长 $\\alpha_0 = 1$ 开始，并以因子 $\\tau = \\frac{1}{2}$ 迭代地缩减步长，直到满足条件。试验步长序列为 $\\alpha = \\alpha_0, \\tau \\alpha_0, \\tau^2 \\alpha_0, \\dots$，即 $\\alpha = 1, \\frac{1}{2}, \\frac{1}{4}, \\frac{1}{8}, \\frac{1}{16}, \\dots$。\n\n我们将此序列中的每个值与推导出的条件 $\\alpha \\le \\frac{2313}{20485}$ 进行核对。\n- 测试 $\\alpha = 1$：$1 > \\frac{2313}{20485}$。条件不满足。\n- 测试 $\\alpha = \\frac{1}{2} = 0.5$：$\\frac{1}{2} > \\frac{2313}{20485}$。条件不满足。\n- 测试 $\\alpha = \\frac{1}{4} = 0.25$：$\\frac{1}{4} > \\frac{2313}{20485}$。条件不满足。\n- 测试 $\\alpha = \\frac{1}{8} = 0.125$：$\\frac{1}{8} = \\frac{2560.625}{20485} > \\frac{2313}{20485}$。条件不满足。\n- 测试 $\\alpha = \\frac{1}{16} = 0.0625$：$\\frac{1}{16} = \\frac{1280.3125}{20485}  \\frac{2313}{20485}$。条件满足。\n\n第一个可接受的步长是 $\\alpha = \\frac{1}{16}$。",
            "answer": "$$\\boxed{\\frac{1}{16}}$$"
        },
        {
            "introduction": "在真实的地球物理反演中，数据往往包含由仪器故障或环境噪声引起的离群值。这些“重尾”噪声会严重干扰标准的优化算法，导致线搜索频繁失败。这个练习模拟了这样一个具有挑战性但非常现实的场景。通过分析一个包含鲁棒损失函数（Student's t 分布）的目标，你将探索如何明智地选择 Wolfe 条件的参数 $c_1$ 和 $c_2$，以提高线搜索在非理想数据下的成功率和稳定性。",
            "id": "3607649",
            "problem": "在基于梯度的地震振幅反演中，目标函数通常由许多数据残差组合而成。当一部分接收器出现不稳定行为（例如，间歇性耦合或削波）时，它们的误差可能呈重尾分布。这会使得采用经典 Armijo 回溯策略的线搜索接受变得不可靠，因为沿试探步长的函数值可能表现出非凸性或突然增加。考虑以下一个特意简化但科学上一致的设定，该设定隔离了这种效应，并研究了在稳健损失下如何选择线搜索参数以提高接受率。\n\n一个线性化的正演模型贡献了一个主要部分，该部分由许多表现良好的测量数据产生的二次项和一个单一的重尾离群值组成。设当前模型迭代为 $m$，最速下降方向为 $p=-\\nabla f(m)$，单变量线搜索函数为 $\\phi(\\alpha)=f(m+\\alpha p)$。假设：\n- 表现良好的测量数据产生一个二次项贡献，其沿 $p$ 方向的下降曲率由 $\\|\\nabla f(m)\\|^{2}=A$ 和 $p^{\\top}\\nabla^{2}f(m)p=K$ 来表征，因此它们对 $\\phi(\\alpha)$ 的贡献是 $-A\\,\\alpha+\\tfrac{1}{2}K\\alpha^{2}$。\n- 一个离群残差 $r(\\alpha)$ 的行为符合自由度 $\\nu=1$（柯西分布）和尺度 $\\sigma=1$ 的重尾学生 t 分布的负对数似然，即\n$$\n\\ell(r)=\\frac{\\nu+1}{2}\\ln\\!\\left(1+\\frac{r^{2}}{\\nu\\sigma^{2}}\\right)=\\ln\\!\\left(1+r^{2}\\right).\n$$\n- 沿着搜索射线，离群残差是仿射的：$r(\\alpha)=r_{0}-s\\,\\alpha$，其中 $r_{0}=10$ 且 $s=10$。\n- 总的二次项贡献满足 $A=100$ 和 $K=400$。\n\n1) 明确证明，如果所有项的失配都是最小二乘（忽略稳健性），在存在上述数值的离群值的情况下，使用单位试探步长 $\\alpha=1$ 的 Armijo 充分下降条件会经常失效。使用基于最速下降模型的预测来量化对于标准 Armijo 常数 $c_{1}=10^{-4}$ 的失效情况。\n\n2) 现在采用稳健目标函数，它将二次部分与单个学生 t 分布离群值结合起来：\n$$\n\\phi(\\alpha)=\\phi(0)-A\\,\\alpha+\\frac{1}{2}K\\alpha^{2}+\\ln\\!\\left(\\frac{1+\\left(r_{0}-s\\alpha\\right)^{2}}{1+r_{0}^{2}}\\right),\n$$\n因此 $\\phi(0)$ 是一个与接受条件无关的常数。请明确写出 $\\phi'(\\alpha)$ 和 $\\phi'(0)$ 关于 $A,K,r_{0},s$ 的表达式。\n\n3) 考虑一个回溯候选步长集合 $\\alpha\\in[\\alpha_{\\min},\\alpha_{\\max}]$，其中 $\\alpha_{\\min}=0.1$ 且 $\\alpha_{\\max}=0.25$。对于稳健目标函数，常数为 $c_{1}\\in(0,1)$ 的 Armijo 条件是\n$$\n\\phi(\\alpha)\\le \\phi(0)+c_{1}\\,\\alpha\\,\\phi'(0),\n$$\n以及常数为 $c_{2}\\in(c_{1},1)$ 的（弱）Wolfe 曲率条件是\n$$\n\\phi'(\\alpha)\\ge c_{2}\\,\\phi'(0).\n$$\n在 $[\\alpha_{\\min},\\alpha_{\\max}]$ 上定义两个诊断函数：\n$$\nT(\\alpha)=\\frac{\\phi(\\alpha)-\\phi(0)}{\\alpha\\,\\phi'(0)},\\qquad L(\\alpha)=\\frac{\\phi'(\\alpha)}{\\phi'(0)}.\n$$\n根据构造，区间中的步长 $\\alpha$ 满足 Armijo 条件当且仅当 $T(\\alpha) \\ge c_1$，满足曲率条件当且仅当 $L(\\alpha) \\le c_2$。选择一个单一的数对 $(c_{1},c_{2})$ 使得 $[\\alpha_{\\min},\\alpha_{\\max}]$ 中的所有步长都可接受，需要满足\n$$\nc_{1}\\le \\min_{\\alpha\\in[\\alpha_{\\min},\\alpha_{\\max}]}T(\\alpha),\\qquad c_{2}\\ge \\max_{\\alpha\\in[\\alpha_{\\min},\\alpha_{\\max}]}L(\\alpha).\n$$\n\n对于给定的 $A,K,r_{0},s,\\nu,\\sigma$ 精确计算这两个极值，然后报告限制性最小的数对\n$$\nc_{1}^{\\star}=\\min_{\\alpha\\in[\\alpha_{\\min},\\alpha_{\\max}]}T(\\alpha),\\qquad c_{2}^{\\star}=\\max_{\\alpha\\in[\\alpha_{\\min},\\alpha_{\\max}]}L(\\alpha),\n$$\n四舍五入到四位有效数字。\n\n你的最终答案必须是行向量 $\\begin{pmatrix}c_{1}^{\\star}  c_{2}^{\\star}\\end{pmatrix}$，两个条目都四舍五入到四位有效数字，且不带单位。",
            "solution": "该问题在科学上是一致的、适定的，并包含解决问题所需的所有必要信息。我们将按顺序处理这三个部分。\n\n### 第 1 部分：最小二乘失配下 Armijo 条件的失效\n\n首先，我们在假设离群值也用最小二乘（二次）损失函数处理的情况下，构建目标函数。离群残差对目标函数的贡献形式为 $\\frac{1}{2} C r(\\alpha)^2$，其中 $C$ 是某个常数。与问题中二次部分为 $\\frac{1}{2}K\\alpha^2$ 的表述一致，我们可以将沿搜索方向 $p$ 的总目标函数 $\\Phi(\\alpha)$ 建模为给定的二次部分与来自离群值的二次损失之和。为了匹配 $\\phi(\\alpha) = f(m+\\alpha p)$ 的结构，我们可以写出：\n$$\n\\Phi(\\alpha) = C_{\\text{const}} - A\\,\\alpha+\\frac{1}{2}K\\alpha^{2} + \\frac{1}{2}\\left(r_{0}-s\\,\\alpha\\right)^{2}\n$$\n在我们的情况下，目标函数由表现良好的部分和假设为最小二乘形式 $\\frac{1}{2} r(\\alpha)^2$ 的离群值部分组成。那么线搜索函数为：\n$$\n\\Phi(\\alpha) = C_{\\text{const}} - A\\,\\alpha+\\frac{1}{2}K\\alpha^{2} + \\frac{1}{2}\\left(r_{0}-s\\,\\alpha\\right)^{2}\n$$\n其中 $C_{\\text{const}}$ 包括来自表现良好部分的 $\\phi(0)$ 和在 $\\alpha=0$ 时来自离群值的 $\\frac{1}{2}r_0^2$。从 $\\alpha=0$ 开始的变化量是：\n$$\n\\Phi(\\alpha) - \\Phi(0) = -A\\,\\alpha+\\frac{1}{2}K\\alpha^{2} + \\frac{1}{2}\\left(r_{0}-s\\,\\alpha\\right)^{2} - \\frac{1}{2}r_0^2\n$$\n关于 $\\alpha$ 的导数是：\n$$\n\\Phi'(\\alpha) = -A + K\\alpha + (r_0 - s\\alpha)(-s) = -A + K\\alpha - s(r_0 - s\\alpha)\n$$\n在 $\\alpha=0$ 处的导数，它决定了初始下降方向，是：\n$$\n\\Phi'(0) = -A -sr_0\n$$\nArmijo-Goldstein 充分下降条件是：\n$$\n\\Phi(\\alpha) \\le \\Phi(0) + c_1 \\alpha \\Phi'(0)\n$$\n我们被要求用单位试探步长 $\\alpha=1$、Armijo 常数 $c_{1}=10^{-4}$ 以及给定的参数 $A=100$、$K=400$、$r_{0}=10$ 和 $s=10$ 来检验这个条件。\n\n首先，我们计算左侧（LHS），即目标函数的实际变化：\n$$\n\\Phi(1) - \\Phi(0) = -A(1) + \\frac{1}{2}K(1)^2 + \\frac{1}{2}(r_0-s(1))^2 - \\frac{1}{2}r_0^2\n$$\n$$\n\\Phi(1) - \\Phi(0) = -100 + \\frac{1}{2}(400) + \\frac{1}{2}(10-10)^2 - \\frac{1}{2}(10)^2 = -100 + 200 + 0 - 50 = 50\n$$\n目标函数值*增加*了 $50$。\n\n接下来，我们计算右侧（RHS），即基于初始梯度的充分下降目标：\n$$\n\\Phi'(0) = -A - sr_0 = -100 - (10)(10) = -200\n$$\n$$\nc_1 \\alpha \\Phi'(0) = (10^{-4})(1)(-200) = -0.02\n$$\nArmijo 条件变为：\n$$\n50 \\le -0.02\n$$\n这个不等式是错误的。实际函数值急剧增加，而局部模型（梯度）预测的是急剧下降。这种巨大的差异导致 Armijo 条件失效，步长 $\\alpha=1$ 将被拒绝。失效是由于大离群值残差引入的强非线性造成的，其贡献 $(r_0-s\\alpha)^2$ 具有很大的正曲率，压倒了初始的下降趋势。\n\n### 第 2 部分：稳健目标函数的导数\n\n稳健目标函数由下式给出：\n$$\n\\phi(\\alpha)=\\phi(0)-A\\,\\alpha+\\frac{1}{2}K\\alpha^{2}+\\ln\\!\\left(\\frac{1+\\left(r_{0}-s\\alpha\\right)^{2}}{1+r_{0}^{2}}\\right)\n$$\n我们可以通过分离对数来重写此式：\n$$\n\\phi(\\alpha) = \\phi(0)-A\\,\\alpha+\\frac{1}{2}K\\alpha^{2}+\\ln(1+(r_0-s\\alpha)^2) - \\ln(1+r_0^2)\n$$\n为了求 $\\phi'(\\alpha)$，我们对 $\\alpha$ 求导：\n$$\n\\phi'(\\alpha) = \\frac{d}{d\\alpha} \\left[ -A\\,\\alpha+\\frac{1}{2}K\\alpha^{2}+\\ln(1+(r_0-s\\alpha)^2) \\right]\n$$\n对对数项使用链式法则：\n$$\n\\frac{d}{d\\alpha}\\ln(1+(r_0-s\\alpha)^2) = \\frac{1}{1+(r_0-s\\alpha)^2} \\cdot \\left( 2(r_0-s\\alpha) \\cdot (-s) \\right) = -\\frac{2s(r_0-s\\alpha)}{1+(r_0-s\\alpha)^2}\n$$\n因此，完整的导数是：\n$$\n\\phi'(\\alpha) = -A + K\\alpha - \\frac{2s(r_0-s\\alpha)}{1+(r_0-s\\alpha)^2}\n$$\n在 $\\alpha=0$ 处求值得到 $\\phi'(0)$：\n$$\n\\phi'(0) = -A + K(0) - \\frac{2s(r_0-s(0))}{1+(r_0-s(0))^2} = -A - \\frac{2sr_0}{1+r_0^2}\n$$\n\n### 第 3 部分：限制性最小的线搜索参数的计算\n\n我们需要在区间 $[\\alpha_{\\min},\\alpha_{\\max}]=[0.1, 0.25]$ 上计算 $c_{1}^{\\star}=\\min_{\\alpha\\in[\\alpha_{\\min},\\alpha_{\\max}]}T(\\alpha)$ 和 $c_{2}^{\\star}=\\max_{\\alpha\\in[\\alpha_{\\min},\\alpha_{\\max}]}L(\\alpha)$。\n\n诊断函数为 $T(\\alpha)=\\frac{\\phi(\\alpha)-\\phi(0)}{\\alpha\\,\\phi'(0)}$ 和 $L(\\alpha)=\\frac{\\phi'(\\alpha)}{\\phi'(0)}$。\n首先，我们用给定的参数 $A=100$，$r_0=10$，$s=10$ 计算常数值 $\\phi'(0)$：\n$$\n\\phi'(0) = -100 - \\frac{2(10)(10)}{1+10^2} = -100 - \\frac{200}{101} = -\\frac{10100+200}{101} = -\\frac{10300}{101}\n$$\n这个值是负数，正如对下降方向所预期的那样。\n\n**分析 $L(\\alpha)$ 以求得 $c_2^\\star$**\n我们需要在 $[0.1, 0.25]$ 上找到 $L(\\alpha) = \\frac{\\phi'(\\alpha)}{\\phi'(0)}$ 的最大值。最大值的位置可以通过检查其导数 $L'(\\alpha) = \\frac{\\phi''(\\alpha)}{\\phi'(0)}$ 的符号来找到。由于 $\\phi'(0)  0$，$L'(\\alpha)$ 的符号与 $\\phi''(\\alpha)$ 的符号相反。\n我们通过对 $\\phi'(\\alpha)$ 求导来计算 $\\phi''(\\alpha)$：\n$$\n\\phi''(\\alpha) = \\frac{d}{d\\alpha} \\left( -A + K\\alpha - \\frac{2s(r_0-s\\alpha)}{1+(r_0-s\\alpha)^2} \\right) = K - 2s \\frac{d}{d\\alpha} \\left( \\frac{r_0-s\\alpha}{1+(r_0-s\\alpha)^2} \\right)\n$$\n使用商法则，该分数部分的导数是：\n$$\n\\frac{-s(1+(r_0-s\\alpha)^2) - (r_0-s\\alpha)(2(r_0-s\\alpha)(-s))}{(1+(r_0-s\\alpha)^2)^2} = \\frac{-s - s(r_0-s\\alpha)^2 + 2s(r_0-s\\alpha)^2}{(1+(r_0-s\\alpha)^2)^2} = \\frac{s((r_0-s\\alpha)^2-1)}{(1+(r_0-s\\alpha)^2)^2}\n$$\n所以，二阶导数是：\n$$\n\\phi''(\\alpha) = K - \\frac{2s^2((r_0-s\\alpha)^2-1)}{(1+(r_0-s\\alpha)^2)^2}\n$$\n让我们在区间 $[0.1, 0.25]$ 上对其求值。设 $r(\\alpha) = r_0 - s\\alpha = 10-10\\alpha$。对于 $\\alpha \\in [0.1, 0.25]$，$r(\\alpha)$ 在 $[10-2.5, 10-1] = [7.5, 9]$ 的范围内。因此，项 $(r(\\alpha)^2-1)$ 是正的，范围从 $7.5^2-1=55.25$到 $9^2-1=80$。\n分数项是 $\\frac{2(10)^2(r(\\alpha)^2-1)}{(1+r(\\alpha)^2)^2}$。它在区间上的最大值出现在 $\\alpha=0.25$（$r=7.5$）处：$\\frac{200(55.25)}{(1+56.25)^2} \\approx 3.37$。其最小值出现在 $\\alpha=0.1$（$r=9$）处：$\\frac{200(80)}{(1+81)^2} \\approx 2.38$。\n由于 $K=400$，远大于这个分数项，$\\phi''(\\alpha) = 400 - (\\text{一个介于 } 2.38 \\text{ 和 } 3.37 \\text{ 之间的值})$ 总是正的。\n由于 $\\phi''(\\alpha) > 0$ 且 $\\phi'(0)  0$，我们有 $L'(\\alpha) = \\phi''(\\alpha)/\\phi'(0)  0$。这意味着 $L(\\alpha)$ 在 $[0.1, 0.25]$ 上是一个严格递减的函数。\n因此，$L(\\alpha)$ 的最大值出现在左端点 $\\alpha_{\\min}=0.1$ 处。\n$$\nc_2^\\star = L(0.1) = \\frac{\\phi'(0.1)}{\\phi'(0)}\n$$\n$$\n\\phi'(0.1) = -100 + 400(0.1) - \\frac{2(10)(10-10(0.1))}{1+(10-10(0.1))^2} = -60 - \\frac{20(9)}{1+9^2} = -60 - \\frac{180}{82} = -60 - \\frac{90}{41} = -\\frac{2550}{41}\n$$\n$$\nc_2^\\star = \\frac{-2550/41}{-10300/101} = \\frac{2550 \\times 101}{41 \\times 10300} = \\frac{257550}{422300} \\approx 0.60989817...\n$$\n四舍五入到四位有效数字，$c_2^\\star = 0.6099$。\n\n**分析 $T(\\alpha)$ 以求得 $c_1^\\star$**\n我们需要在 $[0.1, 0.25]$ 上找到 $T(\\alpha) = \\frac{\\phi(\\alpha)-\\phi(0)}{\\alpha\\phi'(0)}$ 的最小值。我们分析其导数：\n$$\nT'(\\alpha) = \\frac{\\phi'(\\alpha)(\\alpha\\phi'(0)) - (\\phi(\\alpha)-\\phi(0))(\\phi'(0))}{(\\alpha\\phi'(0))^2} = \\frac{\\alpha\\phi'(\\alpha) - (\\phi(\\alpha)-\\phi(0))}{\\alpha^2\\phi'(0)}\n$$\n设 $g(\\alpha) = \\alpha\\phi'(\\alpha) - (\\phi(\\alpha)-\\phi(0))$。由于 $\\phi'(0)0$，$T'(\\alpha)$ 的符号与 $g(\\alpha)$ 的符号相反。$g(\\alpha)$ 的导数是：\n$$\ng'(\\alpha) = (\\phi'(\\alpha) + \\alpha\\phi''(\\alpha)) - \\phi'(\\alpha) = \\alpha\\phi''(\\alpha)\n$$\n在区间 $[0.1, 0.25]$ 上，$\\alpha > 0$。我们已经确定 $\\phi''(\\alpha) > 0$。因此，$g'(\\alpha) > 0$，意味着 $g(\\alpha)$ 是一个严格递增的函数。\n为了确定 $g(\\alpha)$ 在区间上的符号，我们检查其在区间起点 $\\alpha_{\\min}=0.1$ 处的值：\n$$\ng(0.1) = 0.1\\phi'(0.1) - (\\phi(0.1)-\\phi(0))\n$$\n我们有 $\\phi'(0.1) = -2550/41 \\approx -62.1951$。\n$\\phi(0.1)-\\phi(0) = -100(0.1) + \\frac{1}{2}400(0.1)^2 + \\ln(1+(10-1)^2) - \\ln(1+10^2) = -10 + 2 + \\ln(82) - \\ln(101) = -8 + \\ln(82/101) \\approx -8.2084$。\n$$\ng(0.1) \\approx 0.1(-62.1951) - (-8.2084) = -6.21951 + 8.2084 = 1.98889 > 0\n$$\n由于 $g(\\alpha)$ 是递增的且在 $\\alpha=0.1$ 处为正，所以 $g(\\alpha)$ 在整个区间 $[0.1, 0.25]$ 上都是正的。\n由于 $g(\\alpha)>0$ 且 $T'(\\alpha)$ 的分母为负，所以对于所有 $\\alpha \\in [0.1, 0.25]$，$T'(\\alpha)0$。因此，$T(\\alpha)$ 是一个严格递减的函数。\n$T(\\alpha)$ 的最小值必然出现在右端点 $\\alpha_{\\max}=0.25$ 处。\n$$\nc_1^\\star = T(0.25) = \\frac{\\phi(0.25)-\\phi(0)}{0.25\\phi'(0)}\n$$\n$$\n\\phi(0.25)-\\phi(0) = -100(0.25) + \\frac{1}{2}400(0.25)^2 + \\ln(1+(10-2.5)^2) - \\ln(101)\n$$\n$$\n= -25 + 200(0.0625) + \\ln(1+7.5^2) - \\ln(101) = -25 + 12.5 + \\ln(57.25) - \\ln(101) = -12.5 + \\ln(57.25/101)\n$$\n分母是 $0.25\\phi'(0) = 0.25(-\\frac{10300}{101}) = -\\frac{2575}{101}$。\n$$\nc_1^\\star = \\frac{-12.5 + \\ln(57.25/101)}{-2575/101} \\approx \\frac{-12.5 - 0.56766345}{-25.4950495} = \\frac{-13.06766345}{-25.4950495} \\approx 0.5125574\n$$\n四舍五入到四位有效数字，$c_1^\\star=0.5126$。\n\n限制性最小的数对 $(c_1^\\star, c_2^\\star)$ 是 $(0.5126, 0.6099)$。注意弱 Wolfe 条件 $c_2 > c_1$ 得到满足，因为 $0.6099 > 0.5126$。",
            "answer": "$$\n\\boxed{\\begin{pmatrix} 0.5126  0.6099 \\end{pmatrix}}\n$$"
        },
        {
            "introduction": "理论知识最终需要通过代码实现来转化为解决实际问题的能力。这个综合性练习要求你从头开始构建一个完整且高效的强 Wolfe 条件线搜索算法。在大型计算地球物理学中，模型正演和伴随状态法的计算成本极高，因此算法效率至关重要。本练习的核心是实现一个包含“划界”和“缩放”阶段的经典算法，并学习如何通过缓存计算结果来最大限度地减少昂贵的函数和梯度求值次数。",
            "id": "3607601",
            "problem": "考虑一个形式为 $F(m)=\\sum_{i=1}^{Q}\\phi\\big(\\mathcal{F}_i(m)-d_i\\big)$ 的非线性地震数据失配，其中 $m\\in\\mathbb{R}^n$ 表示模型参数，$d_i\\in\\mathbb{R}$ 表示第 $i$ 个源-接收器实验的观测数据，$\\mathcal{F}_i$ 表示第 $i$ 个实验的正演映射，$\\phi$ 是一个光滑凸函数。假设正演算子和 $\\phi$ 均可微。在实际的大规模计算地球物理学中，对于给定的模型 $m$，评估正演算子 $\\mathcal{F}_i$ 及其伴随状态的计算成本非常高昂。用于确定步长 $\\alpha$ 的线搜索算法必须在满足沿搜索方向 $p$ 的强 Wolfe 条件的同时，最小化正演和伴随评估的次数。强 Wolfe 条件包含沿标量化函数 $\\varphi(\\alpha)=F(m+\\alpha p)$ 的充分下降条件和曲率条件。\n\n在以下模拟非线性地震建模的合成但科学一致的设置下，实现一个区间限定与缩放过程，以找到一个满足强 Wolfe 条件的步长 $\\alpha0$，并最小化正演和伴随评估次数：\n\n- 使用每个实验 $i$ 的合成非线性正演算子，定义为 $\\mathcal{F}_i(m)=\\sin(a_i^\\top m)$，其中 $a_i\\in\\mathbb{R}^n$ 是一个固定向量。使用光滑凸惩罚项 $\\phi(y)=\\tfrac{1}{2}y^2$，因此失配函数为 $F(m)=\\tfrac{1}{2}\\sum_{i=1}^{Q} \\left(\\sin(a_i^\\top m)-d_i\\right)^2$。\n\n- 定义一个计算成本模型来追踪高成本的评估：\n    - 在任何模型 $m$ 处对 $F(m)$ 的单次评估计为 1 次“正演求解”。\n    - 在任何模型 $m$ 处对梯度 $g(m)=\\nabla F(m)$ 的单次评估计为 1 次“伴随求解”。如果梯度评估需要评估尚未为该特定 $m$ 计算的正演状态，则还需要 1 次“正演求解”。如果该 $m$ 的正演状态已经被计算过（例如，刚刚评估了 $F(m)$），那么重用它可以避免额外的正演求解，只计算伴随求解。\n    - 沿线的标量化函数为 $\\varphi(\\alpha)=F(m+\\alpha p)$，其方向导数为 $\\varphi'(\\alpha)=g(m+\\alpha p)^\\top p$。\n\n- 实现一个区间限定策略，使用初始试验值 $\\alpha_00$ 和一个扩展规则来找到一个包含满足强 Wolfe 条件的步长的区间 $[\\alpha_{\\mathrm{lo}},\\alpha_{\\mathrm{hi}}]$，并仅在必要时进行梯度评估。具体来说，该算法必须：\n    - 在扩展区间时仅评估 $F$ 值，并且仅在满足充分下降条件时或在需要决定区间更新时才计算方向导数 $\\varphi'(\\alpha)$。\n    - 在计算相同 $\\alpha$ 处的 $\\varphi'(\\alpha)$ 时，重用先前为相同模型计算的正演状态，以避免额外的正演求解。\n\n- 在该区间上实现一个缩放过程，以精确找到一个满足强 Wolfe 条件的 $\\alpha$。该缩放过程必须：\n    - 使用稳健的策略（可接受二分法）在区间内提出新的 $\\alpha$。\n    - 首先评估 $F$ 以检查充分下降条件，然后仅在必要时评估方向导数以检查曲率条件。\n    - 在对相同 $\\alpha$ 进行 $F$ 和 $g$ 评估时，重用正演状态。\n    - 以满足强 Wolfe 条件的 $\\alpha$ 终止，或者如果达到最大迭代次数，则返回一个合理的回退值（例如，当前最佳的区间值）。\n\n- 通过对 $F(m)$ 微分来定义合成模型的梯度：给定 $z_i=a_i^\\top m$，残差 $r_i=\\sin(z_i)-d_i$，并使用链式法则，计算 $g(m)=\\sum_{i=1}^Q r_i\\cos(z_i)\\,a_i$。\n\n- 如果初始方向不是下降方向，即如果 $g(m_0)^\\top p\\ge 0$，则对该测试用例返回 $0.0$。\n\n使用以下测试套件。在所有情况下，使用 $c_1=10^{-4}$ 和 $c_2=0.9$，无量纲的 $\\alpha$，角度以弧度为单位，并且不需要物理单位。为清楚起见，$A$ 表示行向量为 $a_i^\\top$ 的矩阵。\n\n测试用例 1（理想情况，中等非线性）：\n- $n=3$, $Q=6$,\n- $A=\\begin{bmatrix}\n0.8  -0.3  0.5\\\\\n1.2  0.4  -0.6\\\\\n-0.7  0.9  1.1\\\\\n0.3  -1.5  0.2\\\\\n1.0  0.0  -0.9\\\\\n0.6  0.8  -0.4\n\\end{bmatrix}$,\n- $d=\\begin{bmatrix}0.2  -0.5  0.7  -0.1  0.3  -0.4\\end{bmatrix}^\\top$,\n- $m_0=\\begin{bmatrix}0.5  -0.8  0.3\\end{bmatrix}^\\top$,\n- 初始猜测值 $\\alpha_0=1.0$，\n- 搜索方向 $p=-g(m_0)$（最速下降）。\n\n测试用例 2（初始试验值已足够好，步长较小）：\n- $n=3$, $Q=5$,\n- $A=\\begin{bmatrix}\n0.4  -0.2  0.1\\\\\n0.9  0.3  -0.5\\\\\n-0.5  0.7  0.9\\\\\n0.2  -1.1  0.1\\\\\n0.7  -0.1  -0.6\n\\end{bmatrix}$,\n- $d=\\begin{bmatrix}0.1  -0.3  0.5  -0.05  0.2\\end{bmatrix}^\\top$,\n- $m_0=\\begin{bmatrix}0.2  -0.4  0.1\\end{bmatrix}^\\top$,\n- 初始猜测值 $\\alpha_0=0.05$，\n- 搜索方向 $p=-g(m_0)$。\n\n测试用例 3（初始步长较大，需要进行强区间限定和缩放）：\n- $n=3$, $Q=7$,\n- $A=\\begin{bmatrix}\n1.5  -0.5  0.2\\\\\n0.7  0.6  -0.9\\\\\n-1.0  1.4  0.8\\\\\n0.5  -1.2  0.3\\\\\n1.1  0.2  -1.0\\\\\n0.3  0.9  -0.2\\\\\n-0.8  0.4  1.3\n\\end{bmatrix}$,\n- $d=\\begin{bmatrix}0.3  -0.6  0.9  -0.2  0.4  -0.3  0.5\\end{bmatrix}^\\top$,\n- $m_0=\\begin{bmatrix}0.6  -0.7  0.2\\end{bmatrix}^\\top$,\n- 初始猜测值 $\\alpha_0=5.0$，\n- 搜索方向 $p=-g(m_0)$。\n\n测试用例 4（非下降方向；算法必须返回 $0.0$）：\n- 使用与测试用例 1 相同的 $A$、$d$ 和 $m_0$，\n- 初始猜测值 $\\alpha_0=1.0$，\n- 搜索方向 $p=+g(m_0)$。\n\n算法约束和输出：\n- 实现一个区间限定阶段，对 $\\alpha$ 进行几何扩展，直到找到一个区间或达到最大值 $\\alpha_{\\max}$（使用 $\\alpha_{\\max}=50$）。\n- 实现一个使用二分法的缩放阶段，最大迭代次数为 $50$ 次。\n- 通过在检查条件时重用相同 $\\alpha$ 的计算来最小化正演和伴随评估。\n- 对于每个测试用例，输出结果步长 $\\alpha$ 作为浮点数。\n- 您的程序应生成单行输出，其中包含用方括号括起来的逗号分隔的结果列表（例如，'[result1,result2,result3,result4]'）。\n\n不允许外部输入；所有参数都在程序中固定。三角函数中的角度必须以弧度解释。步长 $\\alpha$ 是无量纲的。程序必须遵守指定的运行时环境。",
            "solution": "该问题要求实现一种线搜索算法，为计算地球物理学中出现的非线性优化问题找到满足强 Wolfe 条件的步长 $\\alpha$。该实现必须是高效的，最大限度地减少计算成本高昂的函数和梯度评估次数。该问题定义明确，其科学基础根植于数值优化和反演问题的原理，并为合成模型、算法约束和测试用例提供了一套完整的规范。\n\n目标函数，或称失配，由下式给出\n$$\nF(m) = \\frac{1}{2}\\sum_{i=1}^{Q} \\left(\\sin(a_i^\\top m)-d_i\\right)^2\n$$\n其中 $m \\in \\mathbb{R}^n$ 是模型参数的向量，$A$ 是一个 $Q \\times n$ 的矩阵，其行是向量 $a_i^\\top$，$d \\in \\mathbb{R}^Q$ 是观测数据向量。这是一个非线性最小二乘问题。该函数是可微的，其梯度使用链式法则推导得出：\n$$\ng(m) = \\nabla F(m) = \\sum_{i=1}^{Q} \\left(\\sin(a_i^\\top m)-d_i\\right) \\cos(a_i^\\top m) a_i = A^\\top (\\mathbf{r} \\odot \\cos(\\mathbf{z}))\n$$\n其中 $\\mathbf{z} = Am$，$\\mathbf{r} = \\sin(\\mathbf{z}) - d$，$\\odot$ 表示逐元素（Hadamard）积。\n\n给定当前模型估计 $m_k$ 和搜索方向 $p_k$，线搜索旨在寻找一个步长 $\\alpha > 0$ 来最小化标量函数 $\\varphi(\\alpha) = F(m_k + \\alpha p_k)$。此函数关于 $\\alpha$ 的导数是 $\\varphi'(\\alpha) = \\nabla F(m_k + \\alpha p_k)^\\top p_k = g(m_k + \\alpha p_k)^\\top p_k$。为使搜索方向有效，它必须是一个下降方向，即 $p_k$ 必须满足 $g(m_k)^\\top p_k  0$，这意味着 $\\varphi'(0)  0$。如果不满足此条件，则无法保证改进，线搜索应终止，这种情况通过返回 $\\alpha=0$ 来处理。\n\n强 Wolfe 条件为接受步长 $\\alpha$ 提供了一套标准且稳健的准则。它们确保了目标函数的充分下降和投影梯度幅度的充分减小。这些条件是：\n$1$. **充分下降（Armijo）条件**：\n$$\n\\varphi(\\alpha) \\le \\varphi(0) + c_1 \\alpha \\varphi'(0)\n$$\n$2$. **强曲率条件**：\n$$\n|\\varphi'(\\alpha)| \\le c_2 |\\varphi'(0)|\n$$\n常数 $c_1$ 和 $c_2$ 通常是满足 $0  c_1  c_2  1$ 的小正数。对于此问题，它们被指定为 $c_1 = 10^{-4}$ 和 $c_2 = 0.9$。\n\n任务的核心是实现一个两阶段算法，即区间限定后跟缩放，以找到这样一个 $\\alpha$。该算法旨在节省函数和梯度评估，这在像地震反演这样的大规模应用中至关重要。一个关键的实现细节是，对于给定的模型 $m$，或等效地，对于给定的步长 $\\alpha$，缓存正演（$F(m)$）和伴随（$g(m)$）求解的结果。$\\varphi(\\alpha)$ 的评估需要一次正演求解。$\\varphi'(\\alpha)$ 的评估需要一次伴随求解，而这又需要同一点上的正演求解结果。通过缓存对 $(\\varphi(\\alpha), \\varphi'(\\alpha))$，我们对每个唯一的 $\\alpha$ 值只执行一次昂贵的正演-伴随对计算。\n\n**阶段1：区间限定**\n区间限定阶段寻找一个区间 $[\\alpha_{\\mathrm{lo}}, \\alpha_{\\mathrm{hi}}]$，该区间保证包含一个满足强 Wolfe 条件的点。从一个初始猜测值 $\\alpha_0 > 0$ 开始，我们生成一系列试验步长。\n设 $\\alpha_{i-1}$ 是前一个步长（初始为 $0$），$\\alpha_i$ 是当前步长。\n$1$. 评估 $\\varphi(\\alpha_i)$。如果它违反了充分下降条件，或者如果 $\\varphi(\\alpha_i) \\ge \\varphi(\\alpha_{i-1})$，那么已经找到了一个不下降的区域。所需的步长必须位于区间 $[\\alpha_{i-1}, \\alpha_i]$ 内。我们用这个区间进入缩放阶段。\n$2$. 如果满足充分下降条件，我们评估 $\\varphi'(\\alpha_i)$。\n$3$. 如果 $|\\varphi'(\\alpha_i)| \\le c_2 |\\varphi'(0)|$，则满足强 Wolfe 条件，我们以 $\\alpha = \\alpha_i$ 终止。\n$4$. 如果 $\\varphi'(\\alpha_i) \\ge 0$，函数已开始增加，所以局部最小值必定在 $[\\alpha_{i-1}, \\alpha_i]$ 中。我们进入缩放阶段。\n$5$. 如果以上条件均不成立（满足充分下降但梯度幅度仍然过大且为负），我们必须扩大搜索区域。我们设置 $\\alpha_{i-1} \\leftarrow \\alpha_i$ 并选择一个新的、更大的 $\\alpha_i$，例如通过几何扩展 $\\alpha_i \\leftarrow \\rho \\alpha_{i-1}$（在本实现中 $\\rho=2$），直到达到指定的最大值 $\\alpha_{\\max} = 50$。\n\n**阶段2：缩放**\n一旦确定了一个区间 $[\\alpha_{\\mathrm{lo}}, \\alpha_{\\mathrm{hi}}]$，缩放阶段会对其进行细化以找到一个合适的 $\\alpha$。该区间保证具有这样的性质：$\\alpha_{\\mathrm{lo}}$ 满足充分下降条件并且具有负方向导数 $\\varphi'(\\alpha_{\\mathrm{lo}})  0$。\n缩放过程迭代地减小区间的大小：\n$1$. 在当前区间 $(\\alpha_{\\mathrm{lo}}, \\alpha_{\\mathrm{hi}})$ 内部严格选择一个试验步长 $\\alpha_j$。二分法 $\\alpha_j = (\\alpha_{\\mathrm{lo}} + \\alpha_{\\mathrm{hi}})/2$ 是一个稳健的选择。\n$2$. 评估 $\\varphi(\\alpha_j)$。如果 $\\varphi(\\alpha_j)$ 违反充分下降条件或 $\\varphi(\\alpha_j) \\ge \\varphi(\\alpha_{\\mathrm{lo}})$，则新的上界变为 $\\alpha_j$（即设置 $\\alpha_{\\mathrm{hi}} \\leftarrow \\alpha_j$）。下界保持不变。\n$3$. 如果 $\\varphi(\\alpha_j)$ 满足充分下降条件，我们评估 $\\varphi'(\\alpha_j)$。\n$4$. 如果满足强曲率条件 $|\\varphi'(\\alpha_j)| \\le c_2 |\\varphi'(0)|$，我们找到了步长，算法终止并返回 $\\alpha_j$。\n$5$. 如果不满足曲率条件，我们必须更新区间。如果 $\\varphi'(\\alpha_j)(\\alpha_{\\mathrm{hi}} - \\alpha_{\\mathrm{lo}}) \\ge 0$，我们将 $\\alpha_{\\mathrm{hi}}$ 设为 $\\alpha_{\\mathrm{lo}}$。在此分支的所有其他情况下，我们将 $\\alpha_{\\mathrm{lo}}$ 设为 $\\alpha_j$。\n这个过程保证了新的区间 $[\\alpha_{\\mathrm{lo}}, \\alpha_{\\mathrm{hi}}]$ 继续包含一个可接受的点，并且其大小减小，从而确保收敛。如果达到最大迭代次数（$50$ 次），算法返回最后找到的满足充分下降条件的 $\\alpha_j$ 值，该值存储在 $\\alpha_{\\mathrm{lo}}$ 中。",
            "answer": "$$\n\\boxed{[0.60946271,0.05000000,1.25000000,0.00000000]}\n$$"
        }
    ]
}