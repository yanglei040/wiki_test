{
    "hands_on_practices": [
        {
            "introduction": "任何有限元方法的基础都是在单个单元上构建离散算子，即质量矩阵和刚度矩阵。这个练习将引导您完成谱元法 (SEM) 中的一个核心操作：在标准化的“参考单元”上构建这些矩阵，然后通过等参映射将它们转换到实际的“物理单元”上。掌握参考单元与物理单元之间的雅可比 (Jacobian) 变换关系，是编写任何有限元代码的基石，它深刻揭示了单元几何形状如何影响离散系统的性质。",
            "id": "3594501",
            "problem": "考虑一个定义在长度为 $L = x_{b} - x_{a}$ 的单个物理单元 $\\Omega_{e} = [x_{a}, x_{b}]$ 上的一维声波方程 $u_{tt} = c^{2} u_{xx}$，及其通过乘以一个测试函数 $v$ 并在 $\\Omega_{e}$ 上积分得到的标准弱形式。在参考单元 $\\hat{\\Omega} = [-1,1]$ 上，使用阶数为 $N=4$ 的谱元法 (SEM)，构建 $\\hat{\\Omega}$ 上的单元级质量矩阵和刚度矩阵，然后通过等参仿射变换 $x(\\xi) = \\frac{x_{a}+x_{b}}{2} + \\frac{x_{b}-x_{a}}{2}\\,\\xi$ 将它们映射到 $\\Omega_{e}$，使得雅可比为 $J = \\partial x / \\partial \\xi = L/2$。\n\n在采用 Gauss–Lobatto–Legendre (GLL) 节点和权重的配置法中进行计算。设 $\\{\\xi_{i}\\}_{i=0}^{4}$ 表示 $N=4$ 时的五个 GLL 节点，$\\{w_{i}\\}_{i=0}^{4}$ 表示它们的 GLL 求积权重。定义与这些节点相关联的拉格朗日插值基函数 $\\{\\ell_{i}(\\xi)\\}_{i=0}^{4}$，使得 $\\ell_{i}(\\xi_{j}) = \\delta_{ij}$。$\\hat{\\Omega}$ 上的 SEM 单元质量矩阵和刚度矩阵由下式给出\n$$\nM_{\\text{ref},ij} = \\int_{-1}^{1} \\ell_{i}(\\xi)\\,\\ell_{j}(\\xi)\\,d\\xi, \\qquad\nK_{\\text{ref},ij} = \\int_{-1}^{1} \\ell'_{i}(\\xi)\\,\\ell'_{j}(\\xi)\\,d\\xi,\n$$\n其中撇号表示关于 $\\xi$ 的微分。在 SEM 配置法中，使用 GLL 求积来近似这些积分，从而得到\n$$\nM_{\\text{ref}} = W, \\quad W = \\operatorname{diag}(w_{0},w_{1},w_{2},w_{3},w_{4}), \\qquad\nK_{\\text{ref}} = D^{\\top} W D,\n$$\n其中 $D_{ki} = \\ell'_{i}(\\xi_{k})$ 是在节点处求值的微分矩阵。\n\n首先，利用勒让德多项式 $P_{4}(\\xi)$ 的性质，明确确定 $N=4$ 时的 GLL 节点 $\\xi_{i}$ 和权重 $w_{i}$。然后，用重心权重写出 $D$ 各项的显式公式，并符号化地组装 $M_{\\text{ref}}$ 和 $K_{\\text{ref}}$。接下来，使用仿射映射将物理单元矩阵 $M_{\\text{phys}}$ 和 $K_{\\text{phys}}$ 用 $M_{\\text{ref}}$、$K_{\\text{ref}}$ 和 $J$ 表示。最后，确定标量 $s$，使得 $\\Omega_{e}$ 上的广义离散算子满足\n$$\nM_{\\text{phys}}^{-1} K_{\\text{phys}} \\;=\\; s\\, M_{\\text{ref}}^{-1} K_{\\text{ref}}.\n$$\n\n请以单元长度 $L$ 的单个闭式解析表达式的形式提供 $s$。无需四舍五入。",
            "solution": "问题陈述经过验证，具有科学依据、适定性、客观性和自洽性。它描述了计算力学和谱元法 (SEM) 中的一个标准流程。所有数据和定义均与既定理论一致。因此，我们开始求解。\n\n目标是找到一个标量常数 $s$，使得关系式 $M_{\\text{phys}}^{-1} K_{\\text{phys}} = s\\, M_{\\text{ref}}^{-1} K_{\\text{ref}}$ 成立，其中 $M_{\\text{phys}}$ 和 $K_{\\text{phys}}$ 是物理单元 $\\Omega_{e} = [x_a, x_b]$ 上的质量矩阵和刚度矩阵，而 $M_{\\text{ref}}$ 和 $K_{\\text{ref}}$ 是参考单元 $\\hat{\\Omega} = [-1, 1]$ 上的相应矩阵。\n\n物理单元矩阵由在物理域 $\\Omega_{e}$ 上的积分定义：\n$$\nM_{\\text{phys},ij} = \\int_{x_{a}}^{x_{b}} \\phi_{i}(x)\\,\\phi_{j}(x)\\,dx\n$$\n$$\nK_{\\text{phys},ij} = \\int_{x_{a}}^{x_{b}} \\frac{d\\phi_{i}}{dx}(x)\\,\\frac{d\\phi_{j}}{dx}(x)\\,dx\n$$\n其中 $\\{\\phi_{i}(x)\\}$ 是物理单元上的基函数。\n\n问题指定了从参考坐标 $\\xi \\in [-1,1]$ 到物理坐标 $x \\in [x_a, x_b]$ 的等参仿射变换：\n$$\nx(\\xi) = \\frac{x_{a}+x_{b}}{2} + \\frac{x_{b}-x_{a}}{2}\\,\\xi\n$$\n该变换的雅可比 $J$ 是一个常数：\n$$\nJ = \\frac{dx}{d\\xi} = \\frac{x_{b}-x_{a}}{2} = \\frac{L}{2}\n$$\n其中 $L = x_{b} - x_{a}$ 是物理单元的长度。\n\n为了将物理矩阵与参考矩阵联系起来，我们在积分中进行变量替换。物理基函数 $\\phi_i(x)$ 通过复合关系 $\\phi_i(x(\\xi)) = \\ell_i(\\xi)$ 与参考拉格朗日插值基函数 $\\ell_i(\\xi)$ 相关。\n\n首先，我们来变换质量矩阵。微分元变换为 $dx = J\\,d\\xi$。\n$$\nM_{\\text{phys},ij} = \\int_{x_{a}}^{x_{b}} \\phi_{i}(x)\\,\\phi_{j}(x)\\,dx = \\int_{-1}^{1} \\phi_{i}(x(\\xi))\\,\\phi_{j}(x(\\xi))\\,J\\,d\\xi\n$$\n代入基函数关系，我们得到：\n$$\nM_{\\text{phys},ij} = J \\int_{-1}^{1} \\ell_{i}(\\xi)\\,\\ell_{j}(\\xi)\\,d\\xi\n$$\n右侧的积分是参考质量矩阵项 $M_{\\text{ref},ij} = \\int_{-1}^{1} \\ell_{i}(\\xi)\\,\\ell_{j}(\\xi)\\,d\\xi$ 的定义。因此，矩阵关系为：\n$$\nM_{\\text{phys}} = J \\cdot M_{\\text{ref}}\n$$\n接下来，我们变换刚度矩阵。这需要使用链式法则来变换微分算子 $d/dx$：\n$$\n\\frac{d}{dx} = \\frac{d\\xi}{dx} \\frac{d}{d\\xi} = \\left(\\frac{dx}{d\\xi}\\right)^{-1} \\frac{d}{d\\xi} = \\frac{1}{J} \\frac{d}{d\\xi}\n$$\n将此应用于刚度矩阵积分：\n$$\nK_{\\text{phys},ij} = \\int_{x_{a}}^{x_{b}} \\left(\\frac{d\\phi_{i}}{dx}\\right)\\left(\\frac{d\\phi_{j}}{dx}\\right)\\,dx = \\int_{-1}^{1} \\left(\\frac{1}{J}\\frac{d\\ell_{i}}{d\\xi}\\right)\\left(\\frac{1}{J}\\frac{d\\ell_{j}}{d\\xi}\\right)\\,J\\,d\\xi\n$$\n由于 $J$ 是常数，我们可以将其从积分中提出来：\n$$\nK_{\\text{phys},ij} = \\frac{J}{J^2} \\int_{-1}^{1} \\frac{d\\ell_{i}}{d\\xi}\\,\\frac{d\\ell_{j}}{d\\xi}\\,d\\xi = \\frac{1}{J} \\int_{-1}^{1} \\ell'_{i}(\\xi)\\,\\ell'_{j}(\\xi)\\,d\\xi\n$$\n右侧的积分定义了参考刚度矩阵项 $K_{\\text{ref},ij} = \\int_{-1}^{1} \\ell'_{i}(\\xi)\\,\\ell'_{j}(\\xi)\\,d\\xi$。因此，矩阵关系为：\n$$\nK_{\\text{phys}} = \\frac{1}{J} \\cdot K_{\\text{ref}}\n$$\n值得注意的是，这些缩放法则是纯几何的，与多项式阶数 $N$ 或求积所用的节点和权重的具体选择无关。问题给出的定义 $M_{\\text{ref}} = W$ 和 $K_{\\text{ref}} = D^{\\top} W D$ 是参考矩阵的具体实例，但推导出的缩放关系对任何一致的定义都成立。\n\n现在，我们构建算子 $M_{\\text{phys}}^{-1} K_{\\text{phys}}$。首先，我们求物理质量矩阵的逆：\n$$\nM_{\\text{phys}} = J \\cdot M_{\\text{ref}} \\implies M_{\\text{phys}}^{-1} = (J \\cdot M_{\\text{ref}})^{-1} = \\frac{1}{J} M_{\\text{ref}}^{-1}\n$$\n这里我们使用了标量与矩阵乘积的逆等于标量的倒数与矩阵的逆的乘积这一性质。\n\n接下来，我们用这个逆矩阵左乘物理刚度矩阵：\n$$\nM_{\\text{phys}}^{-1} K_{\\text{phys}} = \\left(\\frac{1}{J} M_{\\text{ref}}^{-1}\\right) \\left(\\frac{1}{J} K_{\\text{ref}}\\right)\n$$\n由于标量与矩阵可交换，我们可以将标量项组合在一起：\n$$\nM_{\\text{phys}}^{-1} K_{\\text{phys}} = \\frac{1}{J^2} \\left(M_{\\text{ref}}^{-1} K_{\\text{ref}}\\right)\n$$\n题目要求我们找到标量 $s$，使得 $M_{\\text{phys}}^{-1} K_{\\text{phys}} = s\\, M_{\\text{ref}}^{-1} K_{\\text{ref}}$。通过将推导出的表达式与目标形式直接比较，我们确定 $s$ 为：\n$$\ns = \\frac{1}{J^2}\n$$\n最后，我们代入雅可比的给定表达式 $J = L/2$：\n$$\ns = \\frac{1}{(L/2)^2} = \\frac{1}{L^2/4} = \\frac{4}{L^2}\n$$\n这就是用单元长度 $L$ 表示的标量 $s$ 的最终解析表达式。",
            "answer": "$$\n\\boxed{\\frac{4}{L^2}}\n$$"
        },
        {
            "introduction": "在构建了空间离散算子之后，下一步关键是将它们与时间推进格式相结合，并确保整个计算过程的稳定性。对于双曲型问题，这通常涉及满足一个类似于 Courant-Friedrichs-Lewy (CFL) 的条件。本练习将运用谱分析（一种适用于均匀网格的傅里叶分析）来推导一维波动方程在一阶 ($P1$) 连续有限元和显式中心差分时间格式下的最大稳定时间步长。这个过程将清晰地展示空间离散的特性（特别是质量矩阵的形式）如何直接决定时间步长的上限，这对于进行任何显式时间积分的模拟都至关重要。",
            "id": "3594567",
            "problem": "考虑一维标量声波方程 $u_{tt}(x,t) = c^{2} u_{xx}(x,t)$，该方程定义在长度为 $L$ 的周期性域上，其中 $c$ 为正常数波速。用包含 $N$ 个单元的均匀网格对空间域进行离散化，间距为 $\\Delta x = L/N$，并使用连续分片线性（$P1$）有限元来近似 $u(x,t)$。在空间上使用标准的 Galerkin 公式，并采用一致质量矩阵。使用显式二阶中心差分格式对得到的半离散方程进行时间推进。\n\n从标量声波方程的变分形式以及所选基底隐含的质量矩阵和刚度矩阵的定义出发，对得到的均匀、周期性离散系统进行谱（Fourier）分析，以确定显式时间离散化的最大稳定时间步长 $\\Delta t_{\\max}$。您的推导应能识别出离散 Fourier 符号和最坏情况下的离散角频率，并最终得出一个仅用 $\\Delta x$ 和 $c$ 表示的 $\\Delta t_{\\max}$ 表达式。\n\n请以 $\\Delta x$ 和 $c$ 表示的单个闭式符号表达式的形式提供您的最终答案。最终答案中不要包含单位。",
            "solution": "该问题旨在确定应用于一维标量声波方程的特定数值格式的最大稳定时间步长。该过程涉及使用有限元方法推导半离散方程，然后对全离散系统进行 Fourier 稳定性分析。\n\n控制偏微分方程（PDE）是标量声波方程：\n$$ \\frac{\\partial^2 u}{\\partial t^2}(x,t) = c^{2} \\frac{\\partial^2 u}{\\partial x^2}(x,t) $$\n该方程定义在长度为 $L$ 的周期性域上，其中 $c$ 是常数波速。\n\n首先，我们建立变分（或弱）形式。我们将 PDE 乘以一个足够光滑的检验函数 $v(x)$，并在域 $[0, L]$ 上积分：\n$$ \\int_{0}^{L} \\frac{\\partial^2 u}{\\partial t^2} v \\,dx = c^2 \\int_{0}^{L} \\frac{\\partial^2 u}{\\partial x^2} v \\,dx $$\n对右侧进行分部积分可得：\n$$ \\int_{0}^{L} \\frac{\\partial^2 u}{\\partial t^2} v \\,dx = c^2 \\left[ \\frac{\\partial u}{\\partial x} v \\right]_{0}^{L} - c^2 \\int_{0}^{L} \\frac{\\partial u}{\\partial x} \\frac{\\partial v}{\\partial x} \\,dx $$\n由于 $u$ 和 $v$ 均满足周期性边界条件，边界项 $\\left[ c^2 \\frac{\\partial u}{\\partial x} v \\right]_{0}^{L}$ 为零。这导出弱形式：求 $u(x,t)$，使得对于所有有效的检验函数 $v(x)$，\n$$ \\int_{0}^{L} \\frac{\\partial^2 u}{\\partial t^2} v \\,dx + c^2 \\int_{0}^{L} \\frac{\\partial u}{\\partial x} \\frac{\\partial v}{\\partial x} \\,dx = 0 $$\n\n接下来，我们进行空间离散化。该域被划分为 $N$ 个大小均匀的单元，$\\Delta x = L/N$。我们使用连续分片线性（$P1$）基函数 $\\phi_j(x)$ 来近似解 $u(x,t)$：\n$$ u_h(x,t) = \\sum_{j=1}^{N} u_j(t) \\phi_j(x) $$\n其中 $u_j(t)$ 是随时间变化的系数，表示在节点 $x_j = j\\Delta x$ 处的解，$u_h(x,t)$ 是有限元近似解。在 Galerkin 方法中，检验函数 $v$ 从与基函数相同的空间中选取，因此我们令 $v(x) = \\phi_i(x)$，其中 $i=1, \\dots, N$。将 $u_h$ 的展开式代入弱形式，得到一个常微分方程（ODEs）组：\n$$ \\sum_{j=1}^{N} \\left( \\int_{0}^{L} \\phi_i \\phi_j \\,dx \\right) \\frac{d^2 u_j}{dt^2} + c^2 \\sum_{j=1}^{N} \\left( \\int_{0}^{L} \\frac{d\\phi_i}{dx} \\frac{d\\phi_j}{dx} \\,dx \\right) u_j = 0 \\quad \\text{对于 } i=1, \\dots, N $$\n这可以写成矩阵形式：\n$$ \\mathbf{M} \\ddot{\\mathbf{u}}(t) + \\mathbf{K} \\mathbf{u}(t) = \\mathbf{0} $$\n其中 $\\mathbf{u}(t)$ 是节点值的向量 $[u_1(t), \\dots, u_N(t)]^T$。一致质量矩阵 $\\mathbf{M}$ 和刚度矩阵 $\\mathbf{K}$ 的元素为：\n$$ M_{ij} = \\int_{0}^{L} \\phi_i \\phi_j \\,dx $$\n$$ K_{ij} = c^2 \\int_{0}^{L} \\frac{d\\phi_i}{dx} \\frac{d\\phi_j}{dx} \\,dx $$\n\n对于均匀的 $P1$ 单元，基函数 $\\phi_j(x)$ 是一个以 $x_j$ 为中心的“帽子”函数，仅在 $[x_{j-1}, x_{j+1}]$ 上非零。积分计算结果为：\n$M_{j,j} = \\int_{x_{j-1}}^{x_{j+1}} \\phi_j^2 \\,dx = \\frac{2\\Delta x}{3}$\n$M_{j, j\\pm 1} = \\int_{x_{j}}^{x_{j\\pm 1}} \\phi_j \\phi_{j\\pm 1} \\,dx = \\frac{\\Delta x}{6}$\n$K_{j,j} = c^2 \\int_{x_{j-1}}^{x_{j+1}} (\\phi'_j)^2 \\,dx = \\frac{2c^2}{\\Delta x}$\n$K_{j, j\\pm 1} = c^2 \\int_{x_{j}}^{x_{j\\pm 1}} \\phi'_j \\phi'_{j\\pm 1} \\,dx = -\\frac{c^2}{\\Delta x}$\n所有其他元素均为零。矩阵系统的第 $i$ 行对应于以下模板操作：\n$$ \\frac{\\Delta x}{6}(\\ddot{u}_{i-1} + 4\\ddot{u}_i + \\ddot{u}_{i+1}) + \\frac{c^2}{\\Delta x}(-u_{i-1} + 2u_i - u_{i+1}) = 0 $$\n\n为了进行谱分析，我们寻求形式为 $u_j(t) = \\hat{u}_k(t) e^{i k x_j}$ 的网格尺度 Fourier 模态解，其中 $k$ 是波数，$x_j = j \\Delta x$。将此代入模板方程，我们可以找到矩阵 $\\mathbf{M}$ 和 $\\mathbf{K}$ 的 Fourier 符号（特征值）。\n对于质量矩阵项：\n$\\frac{\\Delta x}{6}(\\ddot{\\hat{u}}_k e^{ik(j-1)\\Delta x} + 4\\ddot{\\hat{u}}_k e^{ikj\\Delta x} + \\ddot{\\hat{u}}_k e^{ik(j+1)\\Delta x}) = \\ddot{\\hat{u}}_k e^{ikj\\Delta x} \\frac{\\Delta x}{6}(e^{-ik\\Delta x} + 4 + e^{ik\\Delta x}) = \\ddot{\\hat{u}}_k e^{ikj\\Delta x} \\frac{\\Delta x}{3}(2 + \\cos(k\\Delta x))$。\n质量矩阵算子的 Fourier 符号为 $\\hat{M}(k) = \\frac{\\Delta x}{3}(2 + \\cos(k\\Delta x))$。\n\n对于刚度矩阵项：\n$\\frac{c^2}{\\Delta x}(-u_{i-1} + 2u_i - u_{i+1}) \\to \\hat{u}_k e^{ikj\\Delta x} \\frac{c^2}{\\Delta x}(-e^{-ik\\Delta x} + 2 - e^{ik\\Delta x}) = \\hat{u}_k e^{ikj\\Delta x} \\frac{2c^2}{\\Delta x}(1 - \\cos(k\\Delta x))$。\n刚度矩阵算子的 Fourier 符号为 $\\hat{K}(k) = \\frac{2c^2}{\\Delta x}(1 - \\cos(k\\Delta x))$。\n\n半离散系统对于每个模态 $k$ 变换为一个标量 ODE：\n$$ \\hat{M}(k) \\ddot{\\hat{u}}_k(t) + \\hat{K}(k) \\hat{u}_k(t) = 0 \\implies \\ddot{\\hat{u}}_k(t) + \\omega_d^2(k) \\hat{u}_k(t) = 0 $$\n其中 $\\omega_d(k)$ 是离散角频率，由离散色散关系给出：\n$$ \\omega_d^2(k) = \\frac{\\hat{K}(k)}{\\hat{M}(k)} = \\frac{\\frac{2c^2}{\\Delta x}(1 - \\cos(k\\Delta x))}{\\frac{\\Delta x}{3}(2 + \\cos(k\\Delta x))} = \\frac{6c^2}{(\\Delta x)^2} \\frac{1 - \\cos(k\\Delta x)}{2 + \\cos(k\\Delta x)} $$\n\n现在我们使用显式二阶中心差分格式对 $\\ddot{\\hat{u}}_k$ 进行时间离散化。设 $\\hat{u}_k^n$ 表示在时间 $t_n = n\\Delta t$ 的解：\n$$ \\frac{\\hat{u}_k^{n+1} - 2\\hat{u}_k^n + \\hat{u}_k^{n-1}}{(\\Delta t)^2} + \\omega_d^2(k) \\hat{u}_k^n = 0 $$\n我们通过假设解的形式为 $\\hat{u}_k^n = g^n$ 来分析稳定性，其中 $g$ 是放大因子。\n$$ g^{n-1}(g^2 - 2g + 1) + \\omega_d^2(k)(\\Delta t)^2 g^n = 0 $$\n$$ g^2 - (2 - (\\omega_d(k)\\Delta t)^2)g + 1 = 0 $$\n为使格式稳定，此二次方程的根的模必须不大于1，即 $|g| \\le 1$。此条件当且仅当时间步长 $\\Delta t$ 满足以下条件时成立：\n$$ |\\omega_d(k) \\Delta t| \\le 2 $$\n这必须对所有可能的波数 $k$ 成立。为保证稳定性，我们必须根据最大可能的离散频率来限制时间步长：\n$$ \\Delta t \\le \\frac{2}{\\max_k |\\omega_d(k)|} \\implies \\Delta t_{\\max} = \\frac{2}{\\omega_{d,\\max}} $$\n\n我们通过最大化 $\\omega_d^2(k)$ 来找到 $\\omega_{d,\\max}$。设 $\\theta = k\\Delta x$。物理上可区分的网格尺度模态的范围是 $\\theta \\in [-\\pi, \\pi]$。我们需要最大化函数：\n$$ f(\\theta) = \\frac{1 - \\cos\\theta}{2 + \\cos\\theta} $$\n$f(\\theta)$ 关于 $\\cos\\theta$ 的导数为 $\\frac{d}{d(\\cos\\theta)}\\left(\\frac{1 - \\cos\\theta}{2 + \\cos\\theta}\\right) = \\frac{-(2+\\cos\\theta) - (1-\\cos\\theta)(1)}{(2+\\cos\\theta)^2} = \\frac{-3}{(2+\\cos\\theta)^2}$，该值恒为负。因此，$f(\\theta)$ 是 $\\cos\\theta$ 的单调递减函数。$f(\\theta)$ 的最大值出现在 $\\cos\\theta$ 的最小值处，即在 $\\theta = \\pm\\pi$ 时为 $-1$。这对应于网格上可表示的最高频率模态（波长为 $2\\Delta x$）。\n最大值为：\n$$ f_{\\max} = f(\\pi) = \\frac{1 - (-1)}{2 + (-1)} = \\frac{2}{1} = 2 $$\n最大离散角频率的平方为：\n$$ \\omega_{d,\\max}^2 = \\frac{6c^2}{(\\Delta x)^2} f_{\\max} = \\frac{6c^2}{(\\Delta x)^2} \\cdot 2 = \\frac{12c^2}{(\\Delta x)^2} $$\n最大离散角频率为：\n$$ \\omega_{d,\\max} = \\sqrt{\\frac{12c^2}{(\\Delta x)^2}} = \\frac{2\\sqrt{3}c}{\\Delta x} $$\n最后，我们将此代入稳定性条件，求得最大稳定时间步长：\n$$ \\Delta t_{\\max} = \\frac{2}{\\omega_{d,\\max}} = \\frac{2}{\\frac{2\\sqrt{3}c}{\\Delta x}} = \\frac{\\Delta x}{\\sqrt{3}c} $$\n此结果也可以表示为 Courant–Friedrichs–Lewy (CFL) 数，$\\mathcal{C} = \\frac{c\\Delta t}{\\Delta x}$，其中稳定性极限为 $\\mathcal{C} \\le \\frac{1}{\\sqrt{3}}$。",
            "answer": "$$\\boxed{\\frac{\\Delta x}{\\sqrt{3} c}}$$"
        },
        {
            "introduction": "在前两个练习掌握了单元构建和稳定性分析的基础后，我们现在转向一个更高级且更贴近实际应用的挑战：使用间断伽辽金 (DG) 方法模拟各向异性介质中的弹性波。DG 方法的稳定性和精度在很大程度上取决于单元交界处的“数值通量”设计。本练习将指导您完成一个从理论到实践的过程：通过求解克里斯托费尔 (Christoffel) 方程来计算材料在特定方向上的物理波速，并利用这些波速来设定能保证能量稳定性的数值通量罚参数。这是一个基于代码的实践，它完美地连接了抽象的理论（如各向异性弹性力学和 DG 稳定性）与计算实现，是计算地球物理学研究中不可或缺的技能。",
            "id": "3594473",
            "problem": "要求您为一阶对称双曲形式的二维各向异性弹性波方程的间断伽辽金有限元 (DG FE) 离散化设计和验证能量稳定的数值通量。目标是利用方向特征速度来调整界面通量惩罚参数，以便在存在强各向异性的情况下平衡精度和稳定性。您的任务是从第一性原理出发，推导出一个可计算的能量稳定性判据，并实现一个程序，该程序针对一组测试界面，计算稳定性所需的最小惩罚项以及一个使用准压缩波速和准剪切波速的平衡建议值。\n\n从无体力作用的线性弹性动力学出发，其中位移场为 $u_j$，速度场为 $v_j = \\partial_t u_j$，应力张量为 $\\sigma_{ij}$，质量密度为 $\\rho$，四阶刚度张量为 $C_{ijkl}$：\n$$\n\\rho \\, \\partial_t v_j = \\partial_i \\sigma_{ij}, \\quad \\sigma_{ij} = C_{ijkl} \\, \\partial_l u_k.\n$$\n在具有单位法向量 $n$ 和与 $n$ 正交的切线方向的材料界面上，定义方向 $n$ 上的 Christoffel 矩阵为\n$$\n\\Gamma_{jk}(n) = C_{j i k l} \\, n_i \\, n_l,\n$$\n并将方向准波速的平方定义为广义特征值问题的特征值\n$$\n\\Gamma(n) \\, q = \\rho \\, v^2 \\, q,\n$$\n因此，两个特征值 $v_1^2 \\le v_2^2$ 沿 $n$ 方向给出了准剪切波速 $V_s = v_1$ 和准压缩波速 $V_p = v_2$。\n\n考虑一个用于一阶系统的 DG FE 界面数值通量，该通量写为一个中心项减去一个在跳跃的适当能量范数上带有标量惩罚参数 $\\alpha$ 的跳跃惩罚项。使用对称双曲系统的能量方法，如果惩罚项在法向上的贡献超过了物理通量雅可比矩阵的贡献，则界面项是稳定的。具体来说，对于单参数标量惩罚，充分的能量稳定性条件是\n$$\n\\alpha \\ge \\max\\left\\{ V_p^{(L)}(n), V_s^{(L)}(n), V_p^{(R)}(n), V_s^{(R)}(n) \\right\\},\n$$\n其中上标 $(L)$ 和 $(R)$ 表示界面左右两侧的材料。为了平衡准压缩波族和准剪切波族的数值耗散，一个实用的平衡惩罚建议值是\n$$\n\\alpha_{\\mathrm{bal}} = \\frac{1}{2} \\left( \\max\\{ V_p^{(L)}(n), V_p^{(R)}(n) \\} + \\max\\{ V_s^{(L)}(n), V_s^{(R)}(n) \\} \\right).\n$$\n\n假设在二维平面应变条件下，介质为正交各向异性，其材料轴与坐标轴对齐，无正交-剪切耦合，且 Voigt 标记的刚度参数为 $\\{ C_{11}, C_{22}, C_{12}, C_{66} \\}$，对应于物理刚度分量 $C_{xxxx} = C_{11}$，$C_{yyyy} = C_{22}$，$C_{xxyy} = C_{12}$ 和 $C_{xyxy} = C_{66}$。对于单位法向 $n = (\\cos\\theta, \\sin\\theta)$（其中角度 $\\theta$ 以弧度为单位），在这种正交各向异性情况下，Christoffel 矩阵简化为\n$$\n\\Gamma(n) = \\begin{bmatrix}\nC_{11} \\, n_x^2 + C_{66} \\, n_y^2 & (C_{12} + C_{66}) \\, n_x \\, n_y \\\\\n(C_{12} + C_{66}) \\, n_x \\, n_y & C_{22} \\, n_y^2 + C_{66} \\, n_x^2\n\\end{bmatrix},\n$$\n其中 $n_x = \\cos\\theta$ 且 $n_y = \\sin\\theta$。方向速度为 $V_{p,s}(n) = \\sqrt{\\lambda_{p,s} / \\rho}$，其中 $\\lambda_{p,s}$ 是 $\\Gamma(n)$ 的特征值。\n\n您的程序必须为每个测试界面计算：\n- 以 $\\mathrm{m/s}$ 为单位的最小能量稳定惩罚 $\\alpha_{\\min}$，\n- 判断一个给定的候选惩罚 $\\alpha_{\\mathrm{cand}}$（以 $\\mathrm{m/s}$ 为单位）是否满足能量稳定性，结果为一个布尔值，\n- 上述定义的平衡建议值 $\\alpha_{\\mathrm{bal}}$（以 $\\mathrm{m/s}$ 为单位）。\n\n必须遵守物理单位如下：材料密度单位为 $\\mathrm{kg/m^3}$，刚度单位为 $\\mathrm{Pa}$，速度和惩罚项单位为 $\\mathrm{m/s}$。角度 $\\theta$ 必须以弧度为单位进行解释。所有速度和惩罚项的输出都必须以 $\\mathrm{m/s}$ 表示。\n\n测试界面套件（每个案例都是一个包含左右材料属性、角度和候选惩罚项的元组）：\n1. 案例 A（各向同性基线，理想情况）：左右密度 $\\rho^{(L)} = \\rho^{(R)} = 2500$ $\\mathrm{kg/m^3}$，各向同性 Lamé 参数 $\\lambda = 4 \\cdot 10^9$ $\\mathrm{Pa}$ 和 $\\mu = 3 \\cdot 10^9$ $\\mathrm{Pa}$ 映射到正交各向异性参数 $C_{11} = \\lambda + 2\\mu = 10 \\cdot 10^9$ $\\mathrm{Pa}$，$C_{22} = 10 \\cdot 10^9$ $\\mathrm{Pa}$，$C_{12} = \\lambda = 4 \\cdot 10^9$ $\\mathrm{Pa}$，$C_{66} = \\mu = 3 \\cdot 10^9$ $\\mathrm{Pa}$；角度 $\\theta = 0.0$；候选惩罚 $\\alpha_{\\mathrm{cand}} = 6000.0$ $\\mathrm{m/s}$。\n2. 案例 B（左侧强各向异性，混合界面）：左侧密度 $\\rho^{(L)} = 2700$ $\\mathrm{kg/m^3}$，左侧刚度 $C_{11}^{(L)} = 20 \\cdot 10^9$ $\\mathrm{Pa}$，$C_{22}^{(L)} = 5 \\cdot 10^9$ $\\mathrm{Pa}$，$C_{12}^{(L)} = 3 \\cdot 10^9$ $\\mathrm{Pa}$，$C_{66}^{(L)} = 2 \\cdot 10^9$ $\\mathrm{Pa}$；右侧为案例 A 中的各向同性材料；角度 $\\theta = 0.7853981633974483$；候选惩罚 $\\alpha_{\\mathrm{cand}} = 2500.0$ $\\mathrm{m/s}$。\n3. 案例 C（近简并剪切，边界情况）：左右密度 $\\rho^{(L)} = \\rho^{(R)} = 2600$ $\\mathrm{kg/m^3}$，刚度 $C_{11}^{(\\cdot)} = 12 \\cdot 10^9$ $\\mathrm{Pa}$，$C_{22}^{(\\cdot)} = 12 \\cdot 10^9$ $\\mathrm{Pa}$，$C_{12}^{(\\cdot)} = 5 \\cdot 10^9$ $\\mathrm{Pa}$，$C_{66}^{(\\cdot)} = 0.1 \\cdot 10^9$ $\\mathrm{Pa}$；角度 $\\theta = 1.5707963267948966$；候选惩罚 $\\alpha_{\\mathrm{cand}} = 1800.0$ $\\mathrm{m/s}$。\n4. 案例 D（极强各向异性与非均匀界面，边界条件）：左侧密度 $\\rho^{(L)} = 2400$ $\\mathrm{kg/m^3}$，左侧刚度 $C_{11}^{(L)} = 30 \\cdot 10^9$ $\\mathrm{Pa}$，$C_{22}^{(L)} = 8 \\cdot 10^9$ $\\mathrm{Pa}$，$C_{12}^{(L)} = 4 \\cdot 10^9$ $\\mathrm{Pa}$，$C_{66}^{(L)} = 1 \\cdot 10^9$ $\\mathrm{Pa}$；右侧密度 $\\rho^{(R)} = 2900$ $\\mathrm{kg/m^3}$，右侧刚度 $C_{11}^{(R)} = 15 \\cdot 10^9$ $\\mathrm{Pa}$，$C_{22}^{(R)} = 7 \\cdot 10^9$ $\\mathrm{Pa}$，$C_{12}^{(R)} = 2 \\cdot 10^9$ $\\mathrm{Pa}$，$C_{66}^{(R)} = 3 \\cdot 10^9$ $\\mathrm{Pa}$；角度 $\\theta = 0.001$；候选惩罚 $\\alpha_{\\mathrm{cand}} = 3500.0$ $\\mathrm{m/s}$。\n\n您的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果。每个结果对应一个测试案例，并且本身必须是包含四个条目的列表，顺序完全如下\n$$\n[\\alpha_{\\min}, \\alpha_{\\mathrm{cand}}, \\text{is\\_stable}, \\alpha_{\\mathrm{bal}}],\n$$\n其中 $\\alpha_{\\min}$ 和 $\\alpha_{\\mathrm{bal}}$ 是以 $\\mathrm{m/s}$ 为单位的浮点数，$\\alpha_{\\mathrm{cand}}$ 是以 $\\mathrm{m/s}$ 为单位的候选浮点数，而 $\\text{is\\_stable}$ 是一个布尔值，指示 $\\alpha_{\\mathrm{cand}} \\ge \\alpha_{\\min}$ 是否成立。因此，最终输出必须采用以下格式\n$$\n[[a_1,c_1,b_1,r_1],[a_2,c_2,b_2,r_2],[a_3,c_3,b_3,r_3],[a_4,c_4,b_4,r_4]],\n$$\n该行中任何地方都不能有空格。",
            "solution": "该问题要求为应用于二维各向异性弹性波方程的间断伽辽金有限元 (DG-FE) 方法设计和验证能量稳定的数值通量惩罚参数。任务的核心是从第一性原理出发，推导和计算惩罚参数，具体方法是使用从材料的 Christoffel 矩阵获得的方向波速。\n\n一阶对称双曲形式的线性弹性动力学控制方程如下：\n$$\n\\rho \\, \\partial_t v_j = \\partial_i \\sigma_{ij}\n$$\n$$\n\\partial_t \\epsilon_{kl} = \\frac{1}{2}(\\partial_l v_k + \\partial_k v_l)\n$$\n其中 $v_j$ 是速度，$\\rho$ 是质量密度，$\\sigma_{ij}$ 是应力张量。应力通过本构关系 $\\sigma_{ij} = C_{ijkl} \\epsilon_{kl}$ 与应变张量 $\\epsilon_{kl}$ 相关联，其中 $C_{ijkl}$ 是四阶刚度张量。\n\n在 DG-FE 框架中，区域被划分为单元，解在单元界面上允许不连续。单元之间的耦合通过数值通量建立。对于对称双曲系统，一个常见的选择是结合了中心平均和与解变量的跳跃成比例的惩罚项的通量。这种格式的稳定性（通过能量方法评估）关键取决于此惩罚项的大小。\n\n惩罚项必须足够大，以耗散由界面项引起的任何能量增长。能量稳定的一个充分条件是，惩罚参数 $\\alpha$ 必须大于或等于系统在垂直于界面方向上的最大特征速度。这些特征速度就是物理波的传播速度。\n\n对于各向异性弹性体，波速是与方向相关的。它们由 Christoffel 矩阵 $\\Gamma(n)$ 推导得出，该矩阵是为给定的单位法向量 $n$ 定义的：\n$$\n\\Gamma_{jk}(n) = C_{j i k l} \\, n_i \\, n_l\n$$\n广义特征值问题 $\\Gamma(n) q = \\rho v^2 q$ 的特征值给出了在 $n$ 方向传播的波的波速平方 $v^2$。对于二维问题，每个方向有两个这样的速度：准压缩波速 $V_p(n)$ 和准剪切波速 $V_s(n)$。它们分别对应于较大和较小的特征值。\n\n该问题特化为二维平面应变下的正交各向异性介质，其材料轴与坐标轴对齐。界面法向量为 $n = (n_x, n_y) = (\\cos\\theta, \\sin\\theta)$。$2 \\times 2$ 的 Christoffel 矩阵给出如下：\n$$\n\\Gamma(n) = \\begin{bmatrix}\nC_{11} n_x^2 + C_{66} n_y^2 & (C_{12} + C_{66}) n_x n_y \\\\\n(C_{12} + C_{66}) n_x n_y & C_{22} n_y^2 + C_{66} n_x^2\n\\end{bmatrix}\n$$\n必须计算 $\\Gamma(n)$ 的特征值，我们称之为 $\\lambda_1$ 和 $\\lambda_2$，其中 $\\lambda_1 \\le \\lambda_2$。它们是特征方程 $\\det(\\Gamma(n) - \\lambda I) = 0$ 的根，其中 $I$ 是单位矩阵。如果我们将 $\\Gamma(n)$ 的分量表示为 $A = \\Gamma_{11}$、$D = \\Gamma_{22}$ 和 $B = \\Gamma_{12}$，则特征方程为 $\\lambda^2 - (A+D)\\lambda + (AD-B^2) = 0$。其根为：\n$$\n\\lambda_{1,2} = \\frac{(A+D) \\pm \\sqrt{(A+D)^2 - 4(AD - B^2)}}{2} = \\frac{(A+D) \\pm \\sqrt{(A-D)^2 + 4B^2}}{2}\n$$\n然后通过将这些特征值与密度 $\\rho$ 相关联来找到方向波速：\n$$\nV_s(n) = \\sqrt{\\frac{\\lambda_1}{\\rho}} = \\sqrt{\\frac{(A+D) - \\sqrt{(A-D)^2 + 4B^2}}{2\\rho}}\n$$\n$$\nV_p(n) = \\sqrt{\\frac{\\lambda_2}{\\rho}} = \\sqrt{\\frac{(A+D) + \\sqrt{(A-D)^2 + 4B^2}}{2\\rho}}\n$$\n一个界面分隔两种材料，用上标 $(L)$ 和 $(R)$ 表示。每种材料都有其自身的属性（$\\rho, C_{ijkl}$），因此有其自己的一组方向波速 $V_s^{(L)}(n), V_p^{(L)}(n)$ 和 $V_s^{(R)}(n), V_p^{(R)}(n)$。\n\n问题定义了基于这些速度需要计算的三个量：\n1.  最小能量稳定惩罚 $\\alpha_{\\min}$。这是跨界面的最大特征速度，确保惩罚对于两种材料中的两种波族都足够。由于 $V_p \\ge V_s$，这简化为准压缩波速的最大值。\n    $$\n    \\alpha_{\\min} = \\max\\left\\{ V_p^{(L)}(n), V_s^{(L)}(n), V_p^{(R)}(n), V_s^{(R)}(n) \\right\\} = \\max\\left\\{ V_p^{(L)}(n), V_p^{(R)}(n) \\right\\}\n    $$\n2.  一个稳定性检查，它是一个布尔值 `is_stable`，如果给定的候选惩罚 $\\alpha_{\\mathrm{cand}}$ 满足稳定性条件，则为真：\n    $$\n    \\text{is\\_stable} \\iff \\alpha_{\\mathrm{cand}} \\ge \\alpha_{\\min}\n    $$\n3.  一个平衡惩罚建议值 $\\alpha_{\\mathrm{bal}}$，它平均了 p 波和 s 波族的最大速度，旨在平衡精度和耗散。\n    $$\n    \\alpha_{\\mathrm{bal}} = \\frac{1}{2} \\left( \\max\\{ V_p^{(L)}(n), V_p^{(R)}(n) \\} + \\max\\{ V_s^{(L)}(n), V_s^{(R)}(n) \\} \\right)\n    $$\n\n每个测试案例的计算流程如下：\n1.  对于给定的界面角度 $\\theta$，计算分量 $n_x = \\cos\\theta$ 和 $n_y = \\sin\\theta$。\n2.  对于左侧材料 $(L)$，使用其属性（$\\rho^{(L)}$, $C_{ij}^{(L)}$）和 $n$ 来构建其 Christoffel 矩阵 $\\Gamma^{(L)}(n)$。计算其特征值 $\\lambda_1^{(L)}, \\lambda_2^{(L)}$，从而得到波速 $V_s^{(L)}$ 和 $V_p^{(L)}$。\n3.  对右侧材料 $(R)$ 重复步骤2，以找到 $V_s^{(R)}$ 和 $V_p^{(R)}$。\n4.  使用这四个速度（$V_s^{(L)}, V_p^{(L)}, V_s^{(R)}, V_p^{(R)}$）和给定的 $\\alpha_{\\mathrm{cand}}$，根据各自的公式计算 $\\alpha_{\\min}$、`is_stable` 和 $\\alpha_{\\mathrm{bal}}$。\n将此过程应用于所提供的四个测试案例中的每一个。所有物理量均以国际单位制（$\\mathrm{kg/m^3}$、$\\mathrm{Pa}$）给出，因此计算出的速度和惩罚项自然会以 $\\mathrm{m/s}$ 为单位。",
            "answer": "```python\nimport numpy as np\n\ndef compute_wave_speeds(rho, C11, C22, C12, C66, theta):\n    \"\"\"\n    Computes the quasi-shear and quasi-compressional wave speeds for a 2D\n    orthotropic material in a given propagation direction theta.\n\n    Args:\n        rho (float): Density in kg/m^3.\n        C11, C22, C12, C66 (float): Stiffness parameters in Pa.\n        theta (float): Propagation angle in radians.\n\n    Returns:\n        tuple[float, float]: A tuple containing (Vs, Vp) in m/s.\n    \"\"\"\n    n_x = np.cos(theta)\n    n_y = np.sin(theta)\n\n    # Components of the 2x2 Christoffel matrix Gamma(n)\n    G11 = C11 * n_x**2 + C66 * n_y**2\n    G22 = C22 * n_y**2 + C66 * n_x**2\n    G12 = (C12 + C66) * n_x * n_y\n\n    # Eigenvalues lambda of Gamma(n) are found from the characteristic equation:\n    # lambda^2 - tr(G_ij)*lambda + det(G_ij) = 0\n    # The solution is lambda = (tr +/- sqrt(tr^2 - 4*det)) / 2\n    # The term under the sqrt simplifies to (G11 - G22)^2 + 4 * G12^2\n    trace = G11 + G22\n    discriminant_sqrt = np.sqrt((G11 - G22)**2 + 4 * G12**2)\n    \n    # The two eigenvalues, sorted as lambda1 = lambda2\n    lambda1 = (trace - discriminant_sqrt) / 2.0\n    lambda2 = (trace + discriminant_sqrt) / 2.0\n    \n    # Wave speeds v are related by lambda = rho * v^2, so v = sqrt(lambda / rho).\n    # Vs (quasi-shear) corresponds to the smaller eigenvalue, Vp (quasi-compressional) to the larger.\n    Vs = np.sqrt(lambda1 / rho)\n    Vp = np.sqrt(lambda2 / rho)\n\n    return Vs, Vp\n\ndef solve():\n    \"\"\"\n    Solves the problem for the given test suite of interfaces.\n    \"\"\"\n    test_cases = [\n        # Case A\n        {\n            \"left\": {\"rho\": 2500.0, \"C11\": 10e9, \"C22\": 10e9, \"C12\": 4e9, \"C66\": 3e9},\n            \"right\": {\"rho\": 2500.0, \"C11\": 10e9, \"C22\": 10e9, \"C12\": 4e9, \"C66\": 3e9},\n            \"theta\": 0.0,\n            \"alpha_cand\": 6000.0,\n        },\n        # Case B\n        {\n            \"left\": {\"rho\": 2700.0, \"C11\": 20e9, \"C22\": 5e9, \"C12\": 3e9, \"C66\": 2e9},\n            \"right\": {\"rho\": 2500.0, \"C11\": 10e9, \"C22\": 10e9, \"C12\": 4e9, \"C66\": 3e9},\n            \"theta\": 0.7853981633974483,  # pi/4\n            \"alpha_cand\": 2500.0,\n        },\n        # Case C\n        {\n            \"left\": {\"rho\": 2600.0, \"C11\": 12e9, \"C22\": 12e9, \"C12\": 5e9, \"C66\": 0.1e9},\n            \"right\": {\"rho\": 2600.0, \"C11\": 12e9, \"C22\": 12e9, \"C12\": 5e9, \"C66\": 0.1e9},\n            \"theta\": 1.5707963267948966,  # pi/2\n            \"alpha_cand\": 1800.0,\n        },\n        # Case D\n        {\n            \"left\": {\"rho\": 2400.0, \"C11\": 30e9, \"C22\": 8e9, \"C12\": 4e9, \"C66\": 1e9},\n            \"right\": {\"rho\": 2900.0, \"C11\": 15e9, \"C22\": 7e9, \"C12\": 2e9, \"C66\": 3e9},\n            \"theta\": 0.001,\n            \"alpha_cand\": 3500.0,\n        }\n    ]\n\n    all_results = []\n    \n    for case in test_cases:\n        # Unpack properties for the left and right materials\n        left_props = case[\"left\"]\n        right_props = case[\"right\"]\n        theta = case[\"theta\"]\n        alpha_cand = case[\"alpha_cand\"]\n        \n        # Calculate wave speeds for left and right materials\n        Vs_L, Vp_L = compute_wave_speeds(\n            left_props[\"rho\"], left_props[\"C11\"], left_props[\"C22\"],\n            left_props[\"C12\"], left_props[\"C66\"], theta\n        )\n        \n        Vs_R, Vp_R = compute_wave_speeds(\n            right_props[\"rho\"], right_props[\"C11\"], right_props[\"C22\"],\n            right_props[\"C12\"], right_props[\"C66\"], theta\n        )\n        \n        # 1. Minimal stable penalty alpha_min\n        # Since Vp >= Vs, this is the maximum of the two p-wave speeds.\n        alpha_min = max(Vp_L, Vp_R)\n        \n        # 2. Stability check for the candidate penalty\n        is_stable = alpha_cand >= alpha_min\n        \n        # 3. Balanced penalty recommendation alpha_bal\n        max_Vp = max(Vp_L, Vp_R)\n        max_Vs = max(Vs_L, Vs_R)\n        alpha_bal = 0.5 * (max_Vp + max_Vs)\n\n        all_results.append([alpha_min, alpha_cand, is_stable, alpha_bal])\n\n    # Format the final output string according to the problem specification.\n    # The boolean must be converted to a lowercase string 'true' or 'false'.\n    result_strings = []\n    for res in all_results:\n        # res[0]: alpha_min, res[1]: alpha_cand, res[2]: is_stable, res[3]: alpha_bal\n        bool_str = str(res[2]).lower()\n        result_strings.append(f\"[{res[0]},{res[1]},{bool_str},{res[3]}]\")\n    \n    final_output = f\"[[{','.join(result_strings)}]]\"\n    print(final_output)\n\nsolve()\n\n```"
        }
    ]
}