{
    "hands_on_practices": [
        {
            "introduction": "我们的实践始于探索任何有限元类方法的核心构件：单元质量矩阵和刚度矩阵。本练习将指导您推导这些矩阵如何随单元尺寸 $h$ 缩放，以及离散拉普拉斯算子的谱半径如何随多项式阶数 $N$ 缩放。理解这些缩放定律对于分析谱元法的精度、稳定性（例如，CFL条件）和计算成本至关重要。",
            "id": "3381183",
            "problem": "考虑计算流体动力学中谱元法（SEM）的单个谱元上的一维扩散算子。设物理单元为长度为 $h = x_{R} - x_{L}$ 的区间 $\\Omega_{e} = [x_{L}, x_{R}]$，它通过仿射映射 $x(\\xi) = x_{c} + \\frac{h}{2}\\,\\xi$ 从参考单元 $\\hat{\\Omega} = [-1, 1]$ 获得，其中 $x_{c}$ 是单元中心。在 $\\hat{\\Omega}$上，设 $\\{\\hat{\\ell}_{i}(\\xi)\\}_{i=0}^{N}$ 是与 Legendre–Gauss–Lobatto (LGL) 节点相关的 $N$ 次节点 Lagrange 基函数，并设 $\\{\\phi_{i}(x)\\}_{i=0}^{N}$ 是它们到 $\\Omega_{e}$ 上的拉回，即 $\\phi_{i}(x(\\xi)) = \\hat{\\ell}_{i}(\\xi)$。在 $x_{L}$ 和 $x_{R}$ 处施加齐次 Dirichlet 边界条件，使得容许函数在端点处为零。\n\n在内部节点上定义单元质量矩阵 $M_{e} \\in \\mathbb{R}^{(N-1)\\times(N-1)}$ 和单元刚度矩阵 $K_{e} \\in \\mathbb{R}^{(N-1)\\times(N-1)}$ 如下\n$$\n(M_{e})_{ij} = \\int_{\\Omega_{e}} \\phi_{i}(x)\\,\\phi_{j}(x)\\,dx, \n\\qquad\n(K_{e})_{ij} = \\int_{\\Omega_{e}} \\frac{d\\phi_{i}}{dx}(x)\\,\\frac{d\\phi_{j}}{dx}(x)\\,dx,\n$$\n对于 $i,j=1,\\dots,N-1$。假设关于 $x$ 的积分为精确积分。\n\n从第一性原理出发，即上述的仿射映射以及 $M_{e}$ 和 $K_{e}$ 的定义，并仅使用 $[-1,1]$ 上的标准多项式反演/Markov–Bernstein 不等式，完成以下任务：\n\n1. 推导 $M_{e}$ 和 $K_{e}$ 相对于其在参考单元 $\\hat{\\Omega}$ 上类似定义的对应矩阵 $\\hat{M}$ 和 $\\hat{K}$，如何随单元尺寸 $h$ 缩放。\n\n2. 使用矩阵对 $(K_{e}, M_{e})$ 的广义特征值的 Rayleigh 商刻画，以及 $[-1,1]$ 上 $N$ 次多项式的尖锐反演不等式，确定谱半径 $\\rho(M_{e}^{-1} K_{e})$ 随 $N$ 的渐近缩放规律。\n\n提供一个关于 $h$ 和 $N$ 的谱半径缩放的单一闭式解析表达式，不考虑一个与 $h$ 和 $N$ 无关的乘法常数。将您的最终答案表示为仅包含 $h$ 和 $N$ 的单个表达式，省略任何乘法常数和单位。无需四舍五入。",
            "solution": "用户要求我分析一维谱元质量矩阵和刚度矩阵的缩放性质，然后确定矩阵 $M_e^{-1} K_e$ 的谱半径的缩放规律。\n\n### 问题验证\n\n**第 1 步：提取已知条件**\n-   **物理单元**：$\\Omega_{e} = [x_{L}, x_{R}]$\n-   **单元尺寸**：$h = x_{R} - x_{L}$\n-   **参考单元**：$\\hat{\\Omega} = [-1, 1]$\n-   **仿射映射**：$x(\\xi) = x_{c} + \\frac{h}{2}\\,\\xi$，其中 $x_c$ 是单元中心。\n-   **基函数**：$\\{\\hat{\\ell}_{i}(\\xi)\\}_{i=0}^{N}$ 是 $\\hat{\\Omega}$ 上 Legendre-Gauss-Lobatto (LGL) 节点上的 $N$ 次 Lagrange 多项式。 $\\{\\phi_{i}(x)\\}_{i=0}^{N}$ 是它们到 $\\Omega_e$ 上的拉回，其中 $\\phi_{i}(x(\\xi)) = \\hat{\\ell}_{i}(\\xi)$。\n-   **边界条件**：在 $x_L$ 和 $x_R$ 处为齐次 Dirichlet 条件，意味着分析仅限于内部节点 $i, j = 1, \\dots, N-1$。\n-   **单元质量矩阵**：$(M_{e})_{ij} = \\int_{\\Omega_{e}} \\phi_{i}(x)\\,\\phi_{j}(x)\\,dx$，对于 $i,j=1,\\dots,N-1$。\n-   **单元刚度矩阵**：$(K_{e})_{ij} = \\int_{\\Omega_{e}} \\frac{d\\phi_{i}}{dx}(x)\\,\\frac{d\\phi_{j}}{dx}(x)\\,dx$，对于 $i,j=1,\\dots,N-1$。\n-   **参考矩阵**：$\\hat{M}$ 和 $\\hat{K}$ 在参考单元 $\\hat{\\Omega}$ 上有类似的定义。\n-   **假设**：精确积分。\n-   **任务 1**：推导 $M_e$ 和 $K_e$ 相对于 $h$ 的缩放规律。\n-   **任务 2**：使用 Rayleigh 商和尖锐反演不等式，求出谱半径 $\\rho(M_{e}^{-1} K_{e})$ 随 $N$ 的渐近缩放规律。\n-   **最终答案**：提供一个关于 $h$ 和 $N$ 的 $\\rho(M_{e}^{-1} K_{e})$ 缩放的单一闭式表达式。\n\n**第 2 步：使用提取的已知条件进行验证**\n该问题是谱元法数值分析中的一个标准练习。\n-   **科学依据**：参考单元、仿射映射、LGL 节点上的 Lagrange 基多项式、质量和刚度矩阵、Rayleigh 商以及多项式反演不等式等概念，在数值偏微分方程领域，特别是谱方法和有限元方法中，都是基础且成熟的概念。该问题在科学上和数学上都是合理的。\n-   **适定性**：该问题是适定的。它要求推导缩放定律，这些定律在相差一个常数因子的意义下是唯一确定的。通过提及所需的工具（Rayleigh 商、反演不等式），清晰地指明了求解路径。\n-   **客观性**：问题使用精确的数学语言陈述，没有任何歧义或主观声明。\n-   **完整性**：所有必要的定义和约束都已提供。问题是自洽的。\n\n**第 3 步：结论与行动**\n问题有效。我将继续进行解答。\n\n### 解答推导\n\n根据题目要求，解答分为两部分。首先，我们推导单元矩阵 $M_e$ 和 $K_e$ 随单元尺寸 $h$ 的缩放规律。其次，我们确定谱半径 $\\rho(M_e^{-1} K_e)$ 相对于 $h$ 和多项式次数 $N$ 的缩放规律。\n\n**第 1 部分：$M_e$ 和 $K_e$ 随单元尺寸 $h$ 的缩放**\n\n我们使用仿射映射 $x(\\xi) = x_c + \\frac{h}{2}\\xi$ 将积分从物理单元 $\\Omega_e = [x_L, x_R]$ 变换到参考单元 $\\hat{\\Omega} = [-1, 1]$。\n微分元变换如下：\n$$ dx = \\frac{dx}{d\\xi}d\\xi = \\frac{h}{2}d\\xi $$\n函数 $\\phi(x)$ 的导数使用链式法则进行变换。令 $\\hat{\\phi}(\\xi) = \\phi(x(\\xi))$。\n$$ \\frac{d\\hat{\\phi}}{d\\xi} = \\frac{d\\phi}{dx} \\frac{dx}{d\\xi} \\implies \\frac{d\\phi}{dx} = \\frac{d\\hat{\\phi}}{d\\xi} \\left(\\frac{dx}{d\\xi}\\right)^{-1} = \\frac{2}{h}\\frac{d\\hat{\\phi}}{d\\xi} $$\n\n现在我们将这些变换应用于矩阵的定义。\n\n对于质量矩阵 $M_e$：\n其元素由 $(M_e)_{ij} = \\int_{x_L}^{x_R} \\phi_i(x)\\phi_j(x)dx$ 给出。将变量更改为 $\\xi$：\n$$ (M_e)_{ij} = \\int_{-1}^{1} \\phi_i(x(\\xi))\\phi_j(x(\\xi)) \\frac{dx}{d\\xi}d\\xi = \\int_{-1}^{1} \\hat{\\ell}_i(\\xi)\\hat{\\ell}_j(\\xi) \\left(\\frac{h}{2}\\right)d\\xi $$\n$$ (M_e)_{ij} = \\frac{h}{2} \\int_{-1}^{1} \\hat{\\ell}_i(\\xi)\\hat{\\ell}_j(\\xi)d\\xi $$\n右侧的积分是参考单元上质量矩阵元素 $(\\hat{M})_{ij}$ 的定义。因此，我们有以下矩阵关系：\n$$ M_e = \\frac{h}{2}\\hat{M} $$\n质量矩阵 $M_e$ 随单元尺寸 $h$ 线性缩放。\n\n对于刚度矩阵 $K_e$：\n其元素由 $(K_e)_{ij} = \\int_{x_L}^{x_R} \\frac{d\\phi_i}{dx}(x)\\frac{d\\phi_j}{dx}(x)dx$ 给出。\n使用导数和微分元的变换：\n$$ (K_e)_{ij} = \\int_{-1}^{1} \\left(\\frac{2}{h}\\frac{d\\hat{\\ell}_i}{d\\xi}(\\xi)\\right) \\left(\\frac{2}{h}\\frac{d\\hat{\\ell}_j}{d\\xi}(\\xi)\\right) \\left(\\frac{h}{2}\\right)d\\xi $$\n$$ (K_e)_{ij} = \\frac{4}{h^2}\\frac{h}{2} \\int_{-1}^{1} \\frac{d\\hat{\\ell}_i}{d\\xi}(\\xi)\\frac{d\\hat{\\ell}_j}{d\\xi}(\\xi)d\\xi = \\frac{2}{h} \\int_{-1}^{1} \\frac{d\\hat{\\ell}_i}{d\\xi}(\\xi)\\frac{d\\hat{\\ell}_j}{d\\xi}(\\xi)d\\xi $$\n右侧的积分是参考单元上刚度矩阵元素 $(\\hat{K})_{ij}$ 的定义。因此，我们有以下矩阵关系：\n$$ K_e = \\frac{2}{h}\\hat{K} $$\n刚度矩阵 $K_e$ 随单元尺寸 $h$ 反比缩放。\n\n**第 2 部分：谱半径 $\\rho(M_e^{-1} K_e)$ 的缩放**\n\n谱半径 $\\rho(M_e^{-1} K_e)$ 是矩阵 $M_e^{-1} K_e$ 的最大特征值。$M_e^{-1} K_e$ 的特征值 $\\lambda$ 是广义特征值问题 $K_e \\mathbf{v} = \\lambda M_e \\mathbf{v}$ 的解。其中最大的特征值 $\\lambda_{\\max}$ 由 Rayleigh 商刻画：\n$$ \\lambda_{\\max} = \\rho(M_e^{-1} K_e) = \\max_{\\mathbf{v} \\neq \\mathbf{0}} \\frac{\\mathbf{v}^T K_e \\mathbf{v}}{\\mathbf{v}^T M_e \\mathbf{v}} $$\n设 $u_h(x) = \\sum_{j=1}^{N-1} v_j \\phi_j(x)$ 是由内部基函数张成的多项式空间中的任意函数，其中 $\\mathbf{v}$ 是系数向量 $\\{v_j\\}$。Rayleigh 商的分子和分母可以表示为该函数的范数：\n$$ \\mathbf{v}^T K_e \\mathbf{v} = \\int_{\\Omega_e} \\left(\\frac{du_h}{dx}\\right)^2 dx = \\|u_h'\\|_{L^2(\\Omega_e)}^2 $$\n$$ \\mathbf{v}^T M_e \\mathbf{v} = \\int_{\\Omega_e} (u_h)^2 dx = \\|u_h\\|_{L^2(\\Omega_e)}^2 $$\n最大化是在所有容许空间中的非零函数上进行的，该空间是 $\\Omega_e$ 上次数至多为 $N$ 且在端点处为零的多项式空间，记为 $\\mathcal{P}_N^0(\\Omega_e)$。\n$$ \\lambda_{\\max} = \\max_{u_h \\in \\mathcal{P}_N^0(\\Omega_e)} \\frac{\\|u_h'\\|_{L^2(\\Omega_e)}^2}{\\|u_h\\|_{L^2(\\Omega_e)}^2} $$\n现在我们使用第 1 部分中推导的关系，将此表达式变换到参考单元 $\\hat{\\Omega}$ 上。设 $\\hat{u}(\\xi) = u_h(x(\\xi))$ 是 $\\hat{\\Omega}$ 上的相应多项式。\n$$ \\|u_h'\\|_{L^2(\\Omega_e)}^2 = \\int_{-1}^{1} \\left(\\frac{2}{h}\\frac{d\\hat{u}}{d\\xi}\\right)^2 \\left(\\frac{h}{2}\\right)d\\xi = \\frac{2}{h} \\|\\hat{u}'\\|_{L^2(\\hat{\\Omega})}^2 $$\n$$ \\|u_h\\|_{L^2(\\Omega_e)}^2 = \\int_{-1}^{1} (\\hat{u}(\\xi))^2 \\left(\\frac{h}{2}\\right)d\\xi = \\frac{h}{2} \\|\\hat{u}\\|_{L^2(\\hat{\\Omega})}^2 $$\n将这些代入 $\\lambda_{\\max}$ 的表达式中：\n$$ \\lambda_{\\max} = \\frac{\\frac{2}{h} \\max_{\\hat{u} \\in \\mathcal{P}_N^0(\\hat{\\Omega})} \\|\\hat{u}'\\|_{L^2(\\hat{\\Omega})}^2}{\\frac{h}{2} \\|\\hat{u}\\|_{L^2(\\hat{\\Omega})}^2} = \\frac{4}{h^2} \\max_{\\hat{u} \\in \\mathcal{P}_N^0(\\hat{\\Omega})} \\frac{\\|\\hat{u}'\\|_{L^2(\\hat{\\Omega})}^2}{\\|\\hat{u}\\|_{L^2(\\hat{\\Omega})}^2} $$\n问题现在简化为确定参考单元上 Rayleigh 商最大值的缩放规律，该值仅取决于多项式次数 $N$。设这个最大值为 $\\Lambda_{N, \\max}$：\n$$ \\Lambda_{N, \\max} = \\max_{p \\in \\mathcal{P}_N^0([-1,1])} \\frac{\\|p'\\|_{L^2([-1,1])}^2}{\\|p\\|_{L^2([-1,1])}^2} $$\n题目引导我们使用尖锐多项式反演不等式。对于区间 $[-1,1]$ 上任意次数至多为 $N$ 的多项式 $p$，以下反演不等式成立：\n$$ \\|p'\\|_{L^2([-1,1])} \\le C N^2 \\|p\\|_{L^2([-1,1])} $$\n其中 $C$ 是一个与 $N$ 无关的常数。已知这个不等式是尖锐的，意味着存在一个多项式序列 $\\{p_N\\}$，使得比率 $\\|p_N'\\|_{L^2} / \\|p_N\\|_{L^2}$ 与 $N^2$ 成正比。因此，Rayleigh 商的最大值，即该比率的平方，必须按 $(N^2)^2 = N^4$ 的规律缩放。这是谱方法理论中的一个经典结果。\n$$ \\Lambda_{N, \\max} \\propto N^4 $$\n结合对 $h$ 和 $N$ 的依赖关系，我们得到谱半径的缩放规律：\n$$ \\rho(M_e^{-1} K_e) = \\lambda_{\\max} = \\frac{4}{h^2} \\Lambda_{N, \\max} \\propto \\frac{N^4}{h^2} $$\n该表达式表示单个谱元上离散拉普拉斯算子最大特征值的缩放规律。\n\n所要求的最终答案是此缩放规律的闭式表达式，省略了乘法常数。该缩放与 $N^4$ 成正比，与 $h^2$ 成反比。",
            "answer": "$$\\boxed{\\frac{N^4}{h^2}}$$"
        },
        {
            "introduction": "虽然谱元法提供了高阶精度，但将其应用于非线性方程（如伯格斯方程）会带来独特的挑战。本练习聚焦于混淆误差（aliasing error），这是一种因非线性项积分不精确而产生的数值伪影，可能导致非物理的能量行为和不稳定性。通过在一个简单案例中精确计算虚假的能量生成率，您将具体理解为何朴素的配置法（naive collocation）不满足能量守恒。",
            "id": "3381178",
            "problem": "考虑参考单元 $[-1,1]$ 上守恒形式的一维粘性 Burgers 方程，\n$$\n\\frac{\\partial u}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(\\frac{u^{2}}{2}\\right) = \\nu \\frac{\\partial^{2} u}{\\partial x^{2}},\n$$\n其运动粘度为 $\\nu$。采用多项式阶数为 $p=3$ 的单单元谱元法 (SEM)，并使用 Gauss–Lobatto–Legendre (GLL) 配置。设 GLL 节点为 $x_{0}=-1$、$x_{1}=-1/\\sqrt{5}$、$x_{2}=1/\\sqrt{5}$、$x_{3}=1$，相关的求积权重为 $w_{0}=w_{3}=1/6$、$w_{1}=w_{2}=5/6$。令 $W=\\operatorname{diag}(w_{0},w_{1},w_{2},w_{3})$ 为在 GLL 点上进行质量集中所得到的对角质量矩阵，令 $D$ 为 GLL 微分矩阵，其元素为 $D_{ij}=\\ell_{j}'(x_{i})$，其中 $\\ell_{j}(x)$ 是与 GLL 节点相关的 Lagrange 多项式。非线性通量通过 $f=\\frac{1}{2}u\\odot u$ 进行朴素配置，其中 $\\odot$ 表示逐分量乘法。\n\n假设对流算子具有周期性边界，使得当 $u(-1)=u(1)$ 时，在 $[-1,1]$ 上的连续对流能量转移是边界中性的。考虑无粘性情况 $\\nu=0$，并通过在 GLL 节点上对多项式场 $u(x)=x^{3}-x$ 进行采样来初始化节点值，因此 $u(-1)=u(1)=0$。\n\n将离散能量定义为\n$$\nE_{h}(t)=\\frac{1}{2} u(t)^{\\top} W\\, u(t),\n$$\n以及半离散强形式配置谱元法为\n$$\nW\\,\\frac{d u}{dt} + W\\,D\\,f = 0,\\qquad f=\\frac{1}{2}u\\odot u.\n$$\n因此，对能量速率的离散对流贡献为\n$$\n\\frac{dE_{h}}{dt} = -\\,u^{\\top} W\\,D\\,f.\n$$\n将 $\\frac{dE_{h}}{dt}$ 与精确的无粘性、周期性对流能量转移（对于 $[-1,1]$ 上的该场，其值为零）之间的差异视为由非线性项的朴素配置引入的混叠误差。\n\n计算混叠误差的精确标量值，\n$$\n\\mathcal{R} \\equiv -\\,u^{\\top} W\\,D\\,f,\n$$\n对于指定的设置。请用一个精确的数字表示您的最终答案。不需要四舍五入，也不需要单位。",
            "solution": "用户希望我为一个特定的谱元法设置计算混叠误差。\n\n### 步骤 1：问题验证\n\n**1.1. 提取已知条件**\n\n- **控制方程：** 一维粘性 Burgers 方程：$\\frac{\\partial u}{\\partial t} + \\frac{\\partial}{\\partial x}\\left(\\frac{u^{2}}{2}\\right) = \\nu \\frac{\\partial^{2} u}{\\partial x^{2}}$。\n- **域：** 参考单元 $x \\in [-1,1]$。\n- **数值方法：** 多项式阶数为 $p=3$ 的单单元谱元法 (SEM)。\n- **配置点：** Gauss–Lobatto–Legendre (GLL) 节点：$x_{0}=-1$、$x_{1}=-1/\\sqrt{5}$、$x_{2}=1/\\sqrt{5}$、$x_{3}=1$。\n- **求积权重：** 相关的 GLL 权重：$w_{0}=w_{3}=1/6$、$w_{1}=w_{2}=5/6$。\n- **矩阵：** $W=\\operatorname{diag}(w_{0},w_{1},w_{2},w_{3})$ 是集中质量矩阵。$D$ 是 GLL 微分矩阵，其元素为 $D_{ij}=\\ell_{j}'(x_{i})$，其中 $\\ell_{j}(x)$ 是 Lagrange 基多项式。\n- **非线性通量：** 通过 $f=\\frac{1}{2}u\\odot u$ 进行朴素配置，其中 $\\odot$ 是逐分量乘积。\n- **问题特定条件：**\n    - 无粘性情况：$\\nu=0$。\n    - 初始场：从多项式 $u(x)=x^{3}-x$ 采样。这意味着 $u(-1)=u(1)=0$，与周期性条件下的边界中性连续能量转移的假设一致。\n- **定义：**\n    - 离散能量：$E_{h}(t)=\\frac{1}{2} u(t)^{\\top} W\\, u(t)$。\n    - 半离散格式：$W\\,\\frac{d u}{dt} + W\\,D\\,f = 0$。\n    - 离散对流能量速率：$\\frac{dE_{h}}{dt} = -\\,u^{\\top} W\\,D\\,f$。\n- **待计算量：** 混叠误差 $\\mathcal{R} \\equiv -\\,u^{\\top} W\\,D\\,f$。\n\n**1.2. 使用提取的已知条件进行验证**\n\n该问题具有科学依据，是适定且客观的。它描述了计算流体动力学中的一个标准数值实验，用以演示谱方法中的混叠误差。所有组成部分（方程、节点、权重、定义）都是标准的且定义一致。该问题是自包含的，并为计算提供了清晰的路径。它并非微不足道，因为它需要理解谱元法中微分矩阵、求积规则和多项式插值之间的相互作用。\n\n**1.3. 结论和行动**\n\n问题有效。我将继续进行求解。\n\n### 步骤 2：求解推导\n\n目标是计算标量 $\\mathcal{R} = -u^{\\top} W D f$。\n\n**2.1. 计算节点值**\n\n首先，我们通过在 $p=3$ 的 GLL 节点上对给定的多项式 $u(x) = x^3 - x$ 进行采样，来确定节点值的向量 $u$。\n\n- 在 $x_0 = -1$ 处：$u_0 = (-1)^3 - (-1) = -1 + 1 = 0$。\n- 在 $x_1 = -1/\\sqrt{5}$ 处：$u_1 = \\left(-\\frac{1}{\\sqrt{5}}\\right)^3 - \\left(-\\frac{1}{\\sqrt{5}}\\right) = -\\frac{1}{5\\sqrt{5}} + \\frac{1}{\\sqrt{5}} = \\frac{-1+5}{5\\sqrt{5}} = \\frac{4}{5\\sqrt{5}}$。\n- 在 $x_2 = 1/\\sqrt{5}$ 处：$u_2 = \\left(\\frac{1}{\\sqrt{5}}\\right)^3 - \\left(\\frac{1}{\\sqrt{5}}\\right) = \\frac{1}{5\\sqrt{5}} - \\frac{1}{\\sqrt{5}} = \\frac{1-5}{5\\sqrt{5}} = -\\frac{4}{5\\sqrt{5}}$。\n- 在 $x_3 = 1$ 处：$u_3 = (1)^3 - (1) = 1 - 1 = 0$。\n\n节点值的向量为 $u = \\begin{pmatrix} 0  \\frac{4}{5\\sqrt{5}}  -\\frac{4}{5\\sqrt{5}}  0 \\end{pmatrix}^{\\top}$。\n\n**2.2. 计算节点通量值**\n\n接下来，我们计算非线性通量向量 $f = \\frac{1}{2} u \\odot u$。\n\n- $f_0 = \\frac{1}{2} u_0^2 = \\frac{1}{2} (0)^2 = 0$。\n- $f_1 = \\frac{1}{2} u_1^2 = \\frac{1}{2} \\left(\\frac{4}{5\\sqrt{5}}\\right)^2 = \\frac{1}{2} \\frac{16}{25 \\cdot 5} = \\frac{1}{2} \\frac{16}{125} = \\frac{8}{125}$。\n- $f_2 = \\frac{1}{2} u_2^2 = \\frac{1}{2} \\left(-\\frac{4}{5\\sqrt{5}}\\right)^2 = \\frac{1}{2} \\frac{16}{125} = \\frac{8}{125}$。\n- $f_3 = \\frac{1}{2} u_3^2 = \\frac{1}{2} (0)^2 = 0$。\n\n节点通量值的向量为 $f = \\begin{pmatrix} 0  \\frac{8}{125}  \\frac{8}{125}  0 \\end{pmatrix}^{\\top}$。\n\n**2.3. 简化 $\\mathcal{R}$ 的表达式**\n\n混叠误差定义为 $\\mathcal{R} = -u^{\\top} W D f$。我们展开这个表达式：\n$$\n\\mathcal{R} = - \\sum_{i=0}^{3} (u^{\\top} W)_i (Df)_i = - \\sum_{i=0}^{3} u_i w_i \\left( \\sum_{j=0}^{3} D_{ij} f_j \\right)\n$$\n根据定义，$D_{ij} = \\ell_j'(x_i)$。因此，内层求和是 $f$ 的多项式插值函数在节点 $x_i$ 处的导数。设 $f_I(x) = \\sum_{j=0}^3 f_j \\ell_j(x)$ 为该插值函数。则 $\\sum_{j=0}^3 D_{ij} f_j = f_I'(x_i)$。\n表达式变为：\n$$\n\\mathcal{R} = - \\sum_{i=0}^{3} w_i u_i f_I'(x_i)\n$$\n这个和恰好是积分 $-\\int_{-1}^{1} u_I(x) f_I'(x) dx$ 的 GLL 求积公式，其中 $u_I(x)$ 是节点值 $u_i$ 的插值函数。\n\n使用 $p+1$ 个点的 GLL 求积的一个关键特性是，它对于次数最高为 $2p-1$ 的任何多项式被积函数都是精确的。在我们的例子中，$p=3$，因此该求积对于次数最高为 $2(3)-1=5$ 的多项式是精确的。\n\n- 初始函数 $u(x) = x^3 - x$ 是一个 3 次多项式。它在 $p=3$ GLL 节点上的插值函数 $u_I(x)$ 就是函数本身，因此 $u_I(x) = x^3 - x$。\n- 节点值 $f_i$ 由一个次数最多为 3 的多项式 $f_I(x)$ 插值。\n- 乘积 $u_I(x) f_I'(x)$ 是一个次数最多为 $3 + (3-1) = 5$ 的多项式。\n\n由于被积函数的次数在求积规则的精确范围内，我们可以用连续积分替换离散求和：\n$$\n\\mathcal{R} = - \\int_{-1}^{1} u_I(x) f_I'(x) \\, dx\n$$\n这种方法避免了显式构造微分矩阵 $D$。\n\n**2.4. 确定通量插值多项式 $f_I(x)$**\n\n我们需要找到一个次数最多为 3 且通过点 $(x_i, f_i)$ 的多项式 $f_I(x)$：\n$(-1, 0)$、$(-1/\\sqrt{5}, 8/125)$、$(1/\\sqrt{5}, 8/125)$ 和 $(1, 0)$。\n\n由于节点 $x_i$ 关于 $x=0$ 对称，并且值 $f_i$ 也对称（$f_0=f_3$，$f_1=f_2$），插值多项式 $f_I(x)$ 必须是偶函数。对于一个次数最多为 3 的多项式，这意味着奇次幂（$x^3, x$）的系数必须为零。因此，$f_I(x)$ 的形式为 $f_I(x) = Ax^2 + B$。\n\n使用已知点：\n- 在 $x=1$ 处：$f_I(1) = A(1)^2 + B = A+B = 0 \\implies B = -A$。\n所以，$f_I(x) = A(x^2 - 1)$。\n- 在 $x=1/\\sqrt{5}$ 处：$f_I(1/\\sqrt{5}) = A\\left(\\left(\\frac{1}{\\sqrt{5}}\\right)^2 - 1\\right) = A\\left(\\frac{1}{5} - 1\\right) = A\\left(-\\frac{4}{5}\\right) = \\frac{8}{125}$。\n- 解出 $A$：$A = \\frac{8}{125} \\cdot \\left(-\\frac{5}{4}\\right) = -\\frac{2}{25}$。\n\n因此，通量的插值多项式为 $f_I(x) = -\\frac{2}{25}(x^2 - 1) = \\frac{2}{25}(1 - x^2)$。\n\n**2.5. 计算积分**\n\n现在我们计算 $\\mathcal{R}$ 的积分。首先求 $f_I(x)$ 的导数：\n$$\nf_I'(x) = \\frac{d}{dx} \\left( \\frac{2}{25}(1 - x^2) \\right) = -\\frac{4}{25}x\n$$\n将 $u_I(x)$ 和 $f_I'(x)$ 代入积分：\n$$\n\\mathcal{R} = - \\int_{-1}^{1} (x^3 - x) \\left(-\\frac{4}{25}x\\right) \\, dx\n$$\n$$\n\\mathcal{R} = \\frac{4}{25} \\int_{-1}^{1} (x^4 - x^2) \\, dx\n$$\n被积函数是偶函数，所以我们可以简化积分：\n$$\n\\mathcal{R} = \\frac{4}{25} \\cdot 2 \\int_{0}^{1} (x^4 - x^2) \\, dx = \\frac{8}{25} \\int_{0}^{1} (x^4 - x^2) \\, dx\n$$\n计算积分：\n$$\n\\mathcal{R} = \\frac{8}{25} \\left[ \\frac{x^5}{5} - \\frac{x^3}{3} \\right]_{0}^{1}\n$$\n$$\n\\mathcal{R} = \\frac{8}{25} \\left( \\left(\\frac{1^5}{5} - \\frac{1^3}{3}\\right) - 0 \\right)\n$$\n$$\n\\mathcal{R} = \\frac{8}{25} \\left( \\frac{1}{5} - \\frac{1}{3} \\right) = \\frac{8}{25} \\left( \\frac{3 - 5}{15} \\right)\n$$\n$$\n\\mathcal{R} = \\frac{8}{25} \\left( -\\frac{2}{15} \\right)\n$$\n$$\n\\mathcal{R} = -\\frac{16}{375}\n$$\n混叠误差的精确标量值为 $-\\frac{16}{375}$。",
            "answer": "$$\\boxed{-\\frac{16}{375}}$$"
        },
        {
            "introduction": "高阶多项式在表示不连续性（例如地球物理学中常见的尖锐材料界面）时会遇到困难，从而导致称为吉布斯现象（Gibbs phenomenon）的伪振荡。这最后一个基于编程的实践将指导您实现一种谱滤波器——一种缓解此问题的标准技术。您将为振荡和相位畸变建立量化指标，以找到一个最优的滤波器，在抑制振荡的同时不破坏波场中具有物理意义的部分。",
            "id": "3617116",
            "problem": "考虑一个长度归一化到区间 $[-1,1]$ 的一维谱元。谱元法在Gauss-Lobatto-Legendre节点上使用拉格朗日插值，并且可以等效地表示在勒让德多项式的模态基中。设 $\\{P_k(x)\\}_{k=0}^N$ 表示最高次数为 $N$ 的勒让德多项式，设 $\\{x_i,w_i\\}_{i=0}^N$ 表示 $[-1,1]$ 上的Gauss-Lobatto-Legendre节点和权重。勒让德多项式满足正交性 $\\int_{-1}^1 P_k(x) P_m(x) \\, dx = \\frac{2}{2k+1} \\delta_{km}$。在计算地球物理学中，当用高阶多项式逼近具有跳跃（例如，材料属性跳跃）的函数时，会出现吉布斯振铃现象，而在模态空间中使用谱滤波器来抑制引起振铃的高阶内容。该滤波器在模态空间中应用一个乘法因子，保持低阶模态不变，同时衰减高阶模态。\n\n基于这些基础，推导一族光滑、单调的模态滤波器 $\\sigma_k$（对于 $k=0,1,\\dots,N$），使其满足以下结构性约束：\n- 对于所有 $k$，$\\sigma_k \\in (0,1]$。\n- 对于截至截止指数 $k_c$ 的低阶模态，$\\sigma_k = 1$，然后在 $k  k_c$ 时平滑衰减。\n- 衰减由一个光滑度参数 $p$（一个正偶数）和一个强度参数 $\\alpha  0$ 控制，它们共同决定了 $\\sigma_k$ 在最高阶模态处逼近一个小的目标衰减值的速度。\n\n解释如何使用Gauss-Lobatto-Legendre求积和正交性来计算函数 $u(x)$ 的勒让德模态系数，如何应用模态滤波器，以及如何在任意点重建滤波后的场。为了调整截止指数 $k_c$ 以“在不扭曲相位的情况下抑制材料跳跃附近的吉布斯振铃”，定义并计算以下两个定量指标：\n\n1. 跳跃点 $x=0$ 附近的吉布斯振铃指标：设 $u_{\\text{step}}(x)$ 是由 $u_{\\text{step}}(x)=0$ (当 $x0$) 和 $u_{\\text{step}}(x)=1$ (当 $x\\ge 0$) 定义的阶跃函数。滤波后，在 $[-1,1]$ 上的一个精细均匀网格上重建 $u_{\\text{step}}^{\\text{filt}}(x)$。将振铃指标 $R$ 定义为跳跃点邻域内的最大绝对过冲，\n$$\nR = \\max\\left\\{\\max_{x \\in [0,0.25]} \\left(u_{\\text{step}}^{\\text{filt}}(x) - 1\\right), \\; \\max_{x \\in [-0.25,0]} \\left(0 - u_{\\text{step}}^{\\text{filt}}(x)\\right), \\; 0 \\right\\}.\n$$\n\n2. 光滑谐波的相位失真指标：对于给定的波数 $k$（单位长度的弧度数），设 $u_{\\text{sin}}(x)=\\cos(k x)$。在滤波并重建到相同的精细网格后，通过在 $[-1,1]$ 上使用均匀间距的离散内积来估计原始波数下最佳拟合余弦的相位 $\\phi$，\n$$\nC = \\int_{-1}^1 u_{\\text{sin}}^{\\text{filt}}(x) \\cos(k x) \\, dx, \\quad S = \\int_{-1}^1 u_{\\text{sin}}^{\\text{filt}}(x) \\sin(k x) \\, dx,\n$$\n并计算相位估计值 $\\phi = \\arctan2(-S, C)$。将相位误差定义为 $E_\\phi = |\\phi|$（单位为弧度）。所有角度必须以弧度表示。\n\n您必须实现一个程序，对每个测试用例，在整数截止指数 $k_c \\in \\{0,1,\\dots,N\\}$ 上进行搜索，以找到满足约束条件 $R \\le R_{\\text{tol}}$ 和 $E_\\phi \\le E_{\\phi,\\text{tol}}$ 的最大 $k_c$。如果不存在这样的 $k_c$，则报告 $-1$。使用以下测试套件，其中指定了 $(N, p, \\alpha, k, R_{\\text{tol}}, E_{\\phi,\\text{tol}})$：\n\n- 测试用例 1 (理想路径): $N=16$, $p=8$, $\\alpha=18.420680744$, $k=\\tfrac{3\\pi}{2}$, $R_{\\text{tol}}=0.03$, $E_{\\phi,\\text{tol}}=0.01$。\n- 测试用例 2 (相位优先边界): $N=16$, $p=8$, $\\alpha=18.420680744$, $k=\\tfrac{3\\pi}{2}$, $R_{\\text{tol}}=0.15$, $E_{\\phi,\\text{tol}}=10^{-6}$。\n- 测试用例 3 (振铃抑制边缘): $N=16$, $p=8$, $\\alpha=18.420680744$, $k=\\tfrac{3\\pi}{2}$, $R_{\\text{tol}}=0.01$, $E_{\\phi,\\text{tol}}=0.05$。\n- 测试用例 4 (低阶边界): $N=4$, $p=6$, $\\alpha=18.420680744$, $k=\\pi$, $R_{\\text{tol}}=0.10$, $E_{\\phi,\\text{tol}}=0.05$。\n- 测试用例 5 (高阶元): $N=32$, $p=12$, $\\alpha=30.0$, $k=2\\pi$, $R_{\\text{tol}}=0.02$, $E_{\\phi,\\text{tol}}=0.005$。\n\n您的程序应生成单行输出，其中包含所有测试用例的已调整截止指数，格式为用方括号括起来的逗号分隔列表（例如，$[k_{c,1},k_{c,2},k_{c,3},k_{c,4},k_{c,5}]$）。此问题中的所有量都是无量纲的，除了角度必须以弧度为单位。",
            "solution": "此问题被判定为有效。解法如下。\n\n### **问题验证**\n\n**步骤 1：提取已知条件**\n\n- **域**：归一化到区间 $[-1, 1]$ 的一维谱元。\n- **基**：勒让德多项式 $\\{P_k(x)\\}_{k=0}^N$。\n- **正交性**：$\\int_{-1}^1 P_k(x) P_m(x) \\, dx = \\frac{2}{2k+1} \\delta_{km}$。\n- **求积**：Gauss-Lobatto-Legendre (GLL) 节点和权重 $\\{x_i, w_i\\}_{i=0}^N$。\n- **滤波器定义**：必须推导一个模态滤波器 $\\sigma_k$，其中 $k=0, 1, \\dots, N$。\n- **滤波器约束**：\n    - 对于所有 $k$，$\\sigma_k \\in (0, 1]$。\n    - 对于 $k \\le k_c$（截止指数），$\\sigma_k = 1$。\n    - 对于 $k  k_c$，$\\sigma_k$ 平滑衰减。\n    - 衰减由一个正偶数 $p$（光滑度）和 $\\alpha  0$（强度）控制。\n- **指标 1 (振铃, $R$)**：对于 $u_{\\text{step}}(x) = \\{0 \\text{ 若 } x0; 1 \\text{ 若 } x \\ge 0\\}$，振铃指标为 $R = \\max\\left\\{\\max_{x \\in [0,0.25]} \\left(u_{\\text{step}}^{\\text{filt}}(x) - 1\\right), \\; \\max_{x \\in [-0.25,0]} \\left(0 - u_{\\text{step}}^{\\text{filt}}(x)\\right), \\; 0 \\right\\}$。\n- **指标 2 (相位误差, $E_\\phi$)**：对于 $u_{\\text{sin}}(x) = \\cos(k x)$，相位误差为 $E_\\phi = |\\phi|$，其中 $\\phi = \\arctan2(-S, C)$，且 $C = \\int_{-1}^1 u_{\\text{sin}}^{\\text{filt}}(x) \\cos(k x) \\, dx$，$S = \\int_{-1}^1 u_{\\text{sin}}^{\\text{filt}}(x) \\sin(k x) \\, dx$。\n- **目标**：对每个测试用例，找到满足 $R \\le R_{\\text{tol}}$ 和 $E_\\phi \\le E_{\\phi,\\text{tol}}$ 的最大整数 $k_c \\in \\{0, 1, \\dots, N\\}$。如果不存在这样的 $k_c$，则报告 $-1$。\n- **测试用例**：\n    1. $(N, p, \\alpha, k, R_{\\text{tol}}, E_{\\phi,\\text{tol}}) = (16, 8, 18.420680744, \\tfrac{3\\pi}{2}, 0.03, 0.01)$\n    2. $(N, p, \\alpha, k, R_{\\text{tol}}, E_{\\phi,\\text{tol}}) = (16, 8, 18.420680744, \\tfrac{3\\pi}{2}, 0.15, 10^{-6})$\n    3. $(N, p, \\alpha, k, R_{\\text{tol}}, E_{\\phi,\\text{tol}}) = (16, 8, 18.420680744, \\tfrac{3\\pi}{2}, 0.01, 0.05)$\n    4. $(N, p, \\alpha, k, R_{\\text{tol}}, E_{\\phi,\\text{tol}}) = (4, 6, 18.420680744, \\pi, 0.10, 0.05)$\n    5. $(N, p, \\alpha, k, R_{\\text{tol}}, E_{\\phi,\\text{tol}}) = (32, 12, 30.0, 2\\pi, 0.02, 0.005)$\n\n**步骤 2：使用提取的已知条件进行验证**\n\n- **科学依据**：该问题在谱方法理论中有充分的依据，这是数值分析和计算物理学中的一个标准课题。它解决了吉布斯振铃这一现实问题及其通过谱滤波的缓解方法。所有概念（勒让德多项式、GLL求积、模态分析）都是标准的。\n- **适定性**：目标是在一个有限集合中找到满足两个明确定义的不等式的最大整数。这是一个适定的搜索问题。为“未找到”情况（返回-1）提供的规定处理了所有可能的结果。\n- **客观性**：该问题对所有量和指标都使用了精确的数学定义。测试用例提供了具体的、客观的数值数据。\n- **滤波器推导**：该问题要求根据给定的约束推导一个合适的滤波器族。这并不会使其无效；相反，在该领域的问题中，提出一个函数形式是标准部分。一个满足所有标准的常见且适当的选择是指数（或超高斯）滤波器。我将在解法中明确定义此滤波器。\n- **完整性**：通过对滤波器的明确定义，问题变得完全指定且自包含。所有必要的数据和约束都已提供。\n- **其他缺陷**：该问题没有表现出清单中的其他缺陷，如科学上不健全、矛盾或含糊不清。\n\n**步骤 3：结论与行动**\n\n该问题被判定为**有效**。将提供一个解法。\n\n### **解法：理论与算法设计**\n\n该解法需要一个多步骤过程，涉及模态分析、滤波和指标评估。我们首先建立必要的理论组件。\n\n**1. Gauss-Lobatto-Legendre (GLL) 求积**\n对于一个多项式次数 $N$，这 $N+1$ 个 GLL 节点 $\\{x_i\\}_{i=0}^N$ 是多项式 $(1-x^2)P'_N(x)$ 的根，其中 $P'_N(x)$ 是 $N$ 次勒让德多项式的导数。这些节点总是包含端点 $x_0 = -1$ 和 $x_N = 1$。内部节点是 $P'_N(x)$ 的根，它们也是雅可比多项式 $P_{N-1}^{(1,1)}(x)$ 的根。相应的求积权重 $\\{w_i\\}_{i=0}^N$ 由以下公式给出：\n$$ w_i = \\frac{2}{N(N+1) [P_N(x_i)]^2} $$\n该求积法则对于最高次数为 $2N-1$ 的多项式是精确的。\n\n**2. 模态分析：从物理空间到谱空间**\n一个函数 $u(x)$ 在谱元中通过其在 GLL 节点上的多项式插值 $u_N(x)$ 来近似。这个插值函数可以在勒让德多项式的模态基中表示为：\n$$ u_N(x) = \\sum_{k=0}^N \\hat{u}_k P_k(x) $$\n模态系数 $\\hat{u}_k$ 是通过将 $u_N(x)$ 投影到每个基函数 $P_k(x)$ 上并利用正交性来计算的。该积分使用 GLL 求积进行评估：\n$$ \\hat{u}_k = \\frac{\\int_{-1}^1 u_N(x) P_k(x) \\, dx}{\\int_{-1}^1 [P_k(x)]^2 \\, dx} = \\frac{2k+1}{2} \\int_{-1}^1 u_N(x) P_k(x) \\, dx $$\n$$ \\hat{u}_k \\approx \\frac{2k+1}{2} \\sum_{j=0}^N u(x_j) P_k(x_j) w_j $$\n此处，$u(x_j)$ 是函数 $u(x)$ 在 GLL 节点 $x_j$ 上的采样值。这个公式计算了函数样本的离散勒让德变换。\n\n**3. 模态滤波器定义**\n根据要求，我们定义一族光滑、单调的模态滤波器 $\\sigma_k$。一种合适且广泛使用的形式是指数滤波器：\n$$ \\sigma_k(k_c, p, \\alpha) = \\begin{cases} 1  \\text{如果 } k \\le k_c \\\\ \\exp\\left(-\\alpha \\left(\\frac{k - k_c}{N - k_c}\\right)^p\\right)  \\text{如果 } k  k_c \\text{ 且 } k_c  N \\end{cases} $$\n对于 $k_c = N$ 的情况，没有模态被衰减，因此对于所有 $k \\in \\{0, \\dots, N\\}$，$\\sigma_k = 1$。该滤波器满足所有问题约束：\n- 对于截至截止指数 $k_c$ 的低阶模态，它等于 $1$。\n- 对于 $k  k_c$，它从 $1$ 平滑且单调地衰减至 $k=N$ 时的 $\\exp(-\\alpha)$。\n- 围绕 $k_c$ 的衰减光滑度由偶数整数 $p$ 控制。\n- 强度参数 $\\alpha$ 决定了最高阶模态的衰减，$\\sigma_N = \\exp(-\\alpha)$。值 $\\alpha \\approx 18.42$ 对应于 $10^{-8}$ 的衰减因子。\n\n**4. 滤波与重建**\n滤波通过在模态域中进行逐元素相乘来执行：\n$$ \\hat{u}_k^{\\text{filt}} = \\sigma_k \\hat{u}_k $$\n然后，通过用滤波后的系数合成模态级数，可以在任意点集 $\\{x\\}$ 上重建滤波后的函数 $u^{\\text{filt}}(x)$：\n$$ u^{\\text{filt}}(x) = \\sum_{k=0}^N \\hat{u}_k^{\\text{filt}} P_k(x) $$\n\n**5. 指标计算**\n为了评估滤波器的性能，我们计算两个指定的指标。这需要在 $[-1, 1]$ 上的一个精细、均匀的网格上重建滤波后的函数。\n\n- **振铃指标 ($R$)**：\n    1. 在 GLL 节点 $\\{x_j\\}$ 上对阶跃函数 $u_{\\text{step}}(x)$ 进行采样。\n    2. 计算其模态系数 $\\hat{u}_{\\text{step}, k}$。\n    3. 应用滤波器 $\\sigma_k$ 得到 $\\hat{u}_{\\text{step}, k}^{\\text{filt}}$。\n    4. 在一个精细均匀网格上重建 $u_{\\text{step}}^{\\text{filt}}(x)$。\n    5. 识别 $x \\in [-0.25, 0]$ 和 $x \\in [0, 0.25]$ 的子网格。\n    6. 根据 $R$ 的公式，计算正侧的最大过冲和负侧的最大下冲。\n\n- **相位误差指标 ($E_\\phi$)**：\n    1. 在 GLL 节点上对谐波函数 $u_{\\text{sin}}(x) = \\cos(kx)$ 进行采样。\n    2. 计算其模态系数 $\\hat{u}_{\\text{sin}, k}$。\n    3. 应用相同的滤波器 $\\sigma_k$ 得到 $\\hat{u}_{\\text{sin}, k}^{\\text{filt}}$。\n    4. 在相同的精细网格上重建 $u_{\\sin}^{\\text{filt}}(x)$。\n    5. 使用梯形法则在精细网格上数值计算积分 $C$ 和 $S$。\n    6. 计算相移 $\\phi = \\arctan2(-S, C)$ 和误差 $E_\\phi = |\\phi|$。\n\n**6. 搜索最优截止指数 $k_c$**\n对于每个测试用例，我们必须找到满足 $R \\le R_{\\text{tol}}$ 和 $E_\\phi \\le E_{\\phi,\\text{tol}}$ 的最大整数 $k_c \\in \\{0, 1, \\dots, N\\}$。\n- 增加 $k_c$ 会减少滤波量。这通常会增加吉布斯振铃 ($R$)，但会减少相位失真 ($E_\\phi$）。\n- 因此，我们可以通过从 $N$ 向下搜索来找到最优的 $k_c$。第一个（即最大的）满足两个约束条件的 $k_c$ 值就是解。\n- 算法如下：\n    - 对于一个给定的测试用例 $(N, p, \\alpha, k, R_{\\text{tol}}, E_{\\phi,\\text{tol}})$：\n    - 对于 $k_c$ in $\\{N, N-1, \\dots, 0\\}$：\n        a. 构建滤波器 $\\sigma_k$。\n        b. 计算振铃指标 $R$。\n        c. 计算相位误差指标 $E_\\phi$。\n        d. 如果 $R \\le R_{\\text{tol}}$ 且 $E_\\phi \\le E_{\\phi,\\text{tol}}$，则返回 $k_c$。\n    - 如果循环完成而没有找到合适的 $k_c$，则返回 $-1$。\n\n此过程在以下 Python 程序中实现。",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.special import roots_jacobi, eval_legendre\n\ndef gll_nodes_weights(N):\n    \"\"\"\n    Computes Gauss-Lobatto-Legendre (GLL) nodes and weights for a given polynomial degree N.\n    \"\"\"\n    if N == 0:\n        return np.array([0.0]), np.array([2.0])\n    if N == 1:\n        return np.array([-1.0, 1.0]), np.array([1.0, 1.0])\n    \n    # Interior nodes are roots of P'_N(x), which are roots of Jacobi polynomial P_{N-1}^{(1,1)}(x)\n    interior_nodes, _ = roots_jacobi(N - 1, 1, 1)\n    \n    nodes = np.concatenate(([-1.0], interior_nodes, [1.0]))\n    \n    # Weights formula: w_i = 2 / (N(N+1) * [P_N(x_i)]^2)\n    pn_at_nodes = eval_legendre(N, nodes)\n    weights = 2.0 / (N * (N + 1) * pn_at_nodes**2)\n    \n    return nodes, weights\n\ndef solve_case(N, p, alpha, k_wave, R_tol, E_phi_tol):\n    \"\"\"\n    Solves for the optimal cutoff kc for a single test case.\n    \"\"\"\n    # 1. GLL quadrature and basis properties\n    gll_x, gll_w = gll_nodes_weights(N)\n    \n    # Pre-compute Legendre polynomials at GLL nodes: P_kj = P_k(x_j)\n    P_kj = np.array([eval_legendre(k, gll_x) for k in range(N + 1)])\n    modal_basis_norm = (2 * np.arange(N + 1) + 1) / 2.0\n\n    # 2. Define functions and compute their modal coefficients\n    u_step_at_nodes = (gll_x >= 0).astype(float)\n    u_sin_at_nodes = np.cos(k_wave * gll_x)\n\n    # Transform to modal (Legendre) space\n    # u_hat_k = modal_norm_k * sum_j( u(x_j) * P_k(x_j) * w_j )\n    u_hat_step = modal_basis_norm * np.dot(P_kj, u_step_at_nodes * gll_w)\n    u_hat_sin = modal_basis_norm * np.dot(P_kj, u_sin_at_nodes * gll_w)\n    \n    # 3. Setup for reconstruction and metric evaluation\n    fine_x = np.linspace(-1, 1, 2001)\n    P_k_fine = np.array([eval_legendre(k, fine_x) for k in range(N + 1)])\n\n    # 4. Search for the largest k_c satisfying the constraints\n    for kc in range(N, -1, -1):\n        # Define the filter sigma_k\n        sigma = np.ones(N + 1)\n        if kc  N:\n            k_indices = np.arange(kc + 1, N + 1)\n            # The formula: exp(-alpha * ((k-kc)/(N-kc))^p)\n            ratio = (k_indices - kc) / (N - kc)\n            exponent = -alpha * (ratio**p)\n            sigma[kc + 1:] = np.exp(exponent)\n\n        # ----- Metric 1: Ringing (R) for the step function -----\n        u_hat_step_filt = u_hat_step * sigma\n        u_step_filt = np.dot(u_hat_step_filt, P_k_fine)\n        \n        # Calculate overshoot and undershoot\n        mask_pos = (fine_x >= 0)  (fine_x = 0.25)\n        mask_neg = (fine_x >= -0.25)  (fine_x  0)\n        \n        max_overshoot = np.max(u_step_filt[mask_pos] - 1.0, initial=0.0)\n        max_undershoot = np.max(-u_step_filt[mask_neg], initial=0.0)\n        \n        R = max(max_overshoot, max_undershoot)\n\n        # ----- Metric 2: Phase Error (E_phi) for the sine function -----\n        u_hat_sin_filt = u_hat_sin * sigma\n        u_sin_filt = np.dot(u_hat_sin_filt, P_k_fine)\n\n        # Calculate phase shift using discrete inner products\n        C = np.trapz(u_sin_filt * np.cos(k_wave * fine_x), fine_x)\n        S = np.trapz(u_sin_filt * np.sin(k_wave * fine_x), fine_x)\n        \n        phi = np.arctan2(-S, C)\n        E_phi = np.abs(phi)\n\n        # ----- Check constraints -----\n        if R = R_tol and E_phi = E_phi_tol:\n            return kc\n\n    return -1\n\n\ndef solve():\n    # Define the test cases from the problem statement.\n    test_cases = [\n        # (N, p, alpha, k, R_tol, E_phi_tol)\n        (16, 8, 18.420680744, 3 * np.pi / 2, 0.03, 0.01),\n        (16, 8, 18.420680744, 3 * np.pi / 2, 0.15, 1e-6),\n        (16, 8, 18.420680744, 3 * np.pi / 2, 0.01, 0.05),\n        (4, 6, 18.420680744, np.pi, 0.10, 0.05),\n        (32, 12, 30.0, 2 * np.pi, 0.02, 0.005),\n    ]\n\n    results = []\n    for case in test_cases:\n        N, p, alpha, k_wave, R_tol, E_phi_tol = case\n        result = solve_case(N, p, alpha, k_wave, R_tol, E_phi_tol)\n        results.append(result)\n\n    # Final print statement in the exact required format.\n    print(f\"[{','.join(map(str, results))}]\")\n\nsolve()\n```"
        }
    ]
}