{
    "hands_on_practices": [
        {
            "introduction": "The particle integrator, or \"pusher,\" is the engine of the Lagrangian step in any Particle-in-Cell simulation. For problems involving long-term evolution, such as charged particles in magnetic fields, selecting an integrator with excellent conservation properties is paramount to avoid unphysical energy drift. This first practice invites you to derive a remarkable property of the Boris pusher—the de facto standard in plasma physics—demonstrating from its algebraic structure that it perfectly conserves kinetic energy in a pure magnetic field .",
            "id": "3612560",
            "problem": "A single nonrelativistic charged particle with charge $q$ and mass $m$ moves in a uniform magnetic field $\\mathbf{B} = B \\,\\hat{\\mathbf{z}}$ and zero electric field $\\mathbf{E} = \\mathbf{0}$. In the Particle-In-Cell (PIC) method, the Boris pusher is used to advance the particle velocity. Starting from the Lorentz force law and core definitions, derive the energy change for the particle advanced by the Boris pusher over one exact cyclotron period, and compare it with the exact circular motion solution.\n\nAssume the time step $\\Delta t$ is chosen such that $N = \\frac{2\\pi}{\\Omega \\,\\Delta t}$ is a positive integer, where the cyclotron frequency is $\\Omega = \\frac{|q| B}{m}$. The Boris update for the pure magnetic case can be written in the standard split form with\n$$\n\\mathbf{v}^{-} = \\mathbf{v}^{n}, \\quad \\mathbf{t} = \\frac{q\\,\\Delta t}{2 m}\\,\\mathbf{B}, \\quad \\mathbf{s} = \\frac{2\\,\\mathbf{t}}{1 + |\\mathbf{t}|^{2}},\n$$\n$$\n\\mathbf{v}' = \\mathbf{v}^{-} + \\mathbf{v}^{-} \\times \\mathbf{t}, \\quad \\mathbf{v}^{+} = \\mathbf{v}^{-} + \\mathbf{v}' \\times \\mathbf{s}, \\quad \\mathbf{v}^{n+1} = \\mathbf{v}^{+}.\n$$\nLet the initial velocity be $\\mathbf{v}^{0}$ with magnitude $|\\mathbf{v}^{0}| = v_{0}$, and define the kinetic energy at step $n$ as $K_{n} = \\frac{1}{2} m |\\mathbf{v}^{n}|^{2}$. The exact solution under the Lorentz force with $\\mathbf{E} = \\mathbf{0}$ is circular motion at constant speed $v_{0}$ in the plane perpendicular to $\\mathbf{B}$, with period $T = \\frac{2\\pi}{\\Omega}$.\n\nCompute the dimensionless energy error after one exact cyclotron period, defined as\n$$\n\\delta K \\equiv \\frac{K_{N} - K_{0}}{K_{0}},\n$$\nwhere $N = \\frac{T}{\\Delta t}$ is an integer, using the Boris pusher described above. Express your final answer as a single real number. No rounding is required, and no physical units should be included in your final answer because $\\delta K$ is dimensionless.",
            "solution": "The user wants to find the dimensionless energy error after one cyclotron period for a particle simulated with the Boris pusher in a uniform magnetic field.\n\n### Step 1: Problem Validation\n\n**1. Extract Givens**\n- Particle charge: $q$\n- Particle mass: $m$\n- Magnetic field: $\\mathbf{B} = B \\,\\hat{\\mathbf{z}}$ (uniform)\n- Electric field: $\\mathbf{E} = \\mathbf{0}$\n- Cyclotron frequency: $\\Omega = \\frac{|q| B}{m}$\n- Time step: $\\Delta t$\n- Number of steps per period: $N = \\frac{2\\pi}{\\Omega \\,\\Delta t}$, where $N$ is a positive integer.\n- Boris pusher definitions:\n  - $\\mathbf{v}^{-} = \\mathbf{v}^{n}$\n  - $\\mathbf{t} = \\frac{q\\,\\Delta t}{2 m}\\,\\mathbf{B}$\n  - $\\mathbf{s} = \\frac{2\\,\\mathbf{t}}{1 + |\\mathbf{t}|^{2}}$\n  - $\\mathbf{v}' = \\mathbf{v}^{-} + \\mathbf{v}^{-} \\times \\mathbf{t}$\n  - $\\mathbf{v}^{+} = \\mathbf{v}^{-} + \\mathbf{v}' \\times \\mathbf{s}$\n  - $\\mathbf{v}^{n+1} = \\mathbf{v}^{+}$\n- Initial velocity: $\\mathbf{v}^{0}$ with magnitude $|\\mathbf{v}^{0}| = v_{0}$.\n- Kinetic energy at step $n$: $K_{n} = \\frac{1}{2} m |\\mathbf{v}^{n}|^{2}$.\n- Exact solution: Circular motion at constant speed $v_{0}$, with period $T = \\frac{2\\pi}{\\Omega}$.\n- Quantity to compute: Dimensionless energy error $\\delta K \\equiv \\frac{K_{N} - K_{0}}{K_{0}}$, where $N = T/\\Delta t$.\n\n**2. Validate Using Extracted Givens**\n- **Scientifically Grounded:** The problem is based on fundamental principles of classical mechanics (Lorentz force) and a standard, widely used numerical algorithm in computational plasma physics and geophysics (the Boris pusher). The setup is scientifically sound.\n- **Well-Posed:** The problem provides a complete set of definitions and equations to determine the result. All terms are defined, and the task is specific and formalizable.\n- **Objective:** The problem statement is precise, quantitative, and free of any subjectivity or ambiguity.\n\n**3. Verdict and Action**\nThe problem is scientifically sound, well-posed, and objective. It is deemed **valid**. I will proceed with a full solution.\n\n### Step 2: Solution Derivation\n\nThe goal is to compute the dimensionless energy error $\\delta K = \\frac{K_{N} - K_{0}}{K_{0}}$. The kinetic energy at step $n$ is defined as $K_{n} = \\frac{1}{2} m |\\mathbf{v}^{n}|^2$. Therefore, the energy error depends on the change in the magnitude of the particle's velocity, $|\\mathbf{v}^n|$, as it is advanced by the Boris pusher.\n\nWe will analyze a single time step of the Boris algorithm to determine the relationship between $|\\mathbf{v}^{n+1}|$ and $|\\mathbf{v}^{n}|$. According to the problem's definitions, the velocity at the beginning of the step is $\\mathbf{v}^n$ (denoted as $\\mathbf{v}^{-}$) and the velocity at the end of the step is $\\mathbf{v}^{n+1}$ (denoted as $\\mathbf{v}^{+}$). We need to compare $|\\mathbf{v}^{+}|$ and $|\\mathbf{v}^{-}|$.\n\nLet's compute the squared magnitude of $\\mathbf{v}^{+}$:\n$$\n|\\mathbf{v}^{+}|^2 = \\mathbf{v}^{+} \\cdot \\mathbf{v}^{+} = (\\mathbf{v}^{-} + \\mathbf{v}' \\times \\mathbf{s}) \\cdot (\\mathbf{v}^{-} + \\mathbf{v}' \\times \\mathbf{s})\n$$\nExpanding the dot product gives:\n$$\n|\\mathbf{v}^{+}|^2 = |\\mathbf{v}^{-}|^2 + 2 \\mathbf{v}^{-} \\cdot (\\mathbf{v}' \\times \\mathbf{s}) + |\\mathbf{v}' \\times \\mathbf{s}|^2\n$$\nWe can rewrite the middle term using the scalar triple product identity $\\mathbf{a} \\cdot (\\mathbf{b} \\times \\mathbf{c}) = (\\mathbf{a} \\times \\mathbf{b}) \\cdot \\mathbf{c}$:\n$$\n|\\mathbf{v}^{+}|^2 = |\\mathbf{v}^{-}|^2 + 2 (\\mathbf{v}^{-} \\times \\mathbf{v}') \\cdot \\mathbf{s} + |\\mathbf{v}' \\times \\mathbf{s}|^2\n$$\nNow, we must evaluate the terms involving $\\mathbf{v}'$, $\\mathbf{s}$, and $\\mathbf{t}$.\nFirst, let's find the cross product $\\mathbf{v}^{-} \\times \\mathbf{v}'$. Using the definition $\\mathbf{v}' = \\mathbf{v}^{-} + \\mathbf{v}^{-} \\times \\mathbf{t}$:\n$$\n\\mathbf{v}^{-} \\times \\mathbf{v}' = \\mathbf{v}^{-} \\times (\\mathbf{v}^{-} + \\mathbf{v}^{-} \\times \\mathbf{t}) = \\mathbf{v}^{-} \\times \\mathbf{v}^{-} + \\mathbf{v}^{-} \\times (\\mathbf{v}^{-} \\times \\mathbf{t})\n$$\nSince $\\mathbf{v}^{-} \\times \\mathbf{v}^{-} = \\mathbf{0}$, and using the vector triple product identity $\\mathbf{a} \\times (\\mathbf{b} \\times \\mathbf{c}) = \\mathbf{b}(\\mathbf{a} \\cdot \\mathbf{c}) - \\mathbf{c}(\\mathbf{a} \\cdot \\mathbf{b})$:\n$$\n\\mathbf{v}^{-} \\times \\mathbf{v}' = \\mathbf{v}^{-}(\\mathbf{v}^{-} \\cdot \\mathbf{t}) - \\mathbf{t}(\\mathbf{v}^{-} \\cdot \\mathbf{v}^{-}) = \\mathbf{v}^{-}(\\mathbf{v}^{-} \\cdot \\mathbf{t}) - \\mathbf{t}|\\mathbf{v}^{-}|^2\n$$\nNow, substitute this into the middle term of our expression for $|\\mathbf{v}^{+}|^2$:\n$$\n2 (\\mathbf{v}^{-} \\times \\mathbf{v}') \\cdot \\mathbf{s} = 2 (\\mathbf{v}^{-}(\\mathbf{v}^{-} \\cdot \\mathbf{t}) - \\mathbf{t}|\\mathbf{v}^{-}|^2) \\cdot \\mathbf{s} = 2 [(\\mathbf{v}^{-} \\cdot \\mathbf{s})(\\mathbf{v}^{-} \\cdot \\mathbf{t}) - |\\mathbf{v}^{-}|^2 (\\mathbf{t} \\cdot \\mathbf{s})]\n$$\nThe problem defines $\\mathbf{s} = \\frac{2\\,\\mathbf{t}}{1 + |\\mathbf{t}|^{2}}$. Let's define a scalar constant $k = \\frac{2}{1 + |\\mathbf{t}|^2}$, so $\\mathbf{s} = k\\mathbf{t}$. Substituting this into the expression:\n$$\n2 [(\\mathbf{v}^{-} \\cdot k\\mathbf{t})(\\mathbf{v}^{-} \\cdot \\mathbf{t}) - |\\mathbf{v}^{-}|^2 (\\mathbf{t} \\cdot k\\mathbf{t})] = 2k [(\\mathbf{v}^{-} \\cdot \\mathbf{t})^2 - |\\mathbf{v}^{-}|^2 |\\mathbf{t}|^2]\n$$\nThis can be written as $-2k (|\\mathbf{v}^{-}|^2 |\\mathbf{t}|^2 - (\\mathbf{v}^{-} \\cdot \\mathbf{t})^2)$. Recognizing the standard identity $|\\mathbf{a} \\times \\mathbf{b}|^2 = |\\mathbf{a}|^2 |\\mathbf{b}|^2 - (\\mathbf{a} \\cdot \\mathbf{b})^2$, we get:\n$$\n2 (\\mathbf{v}^{-} \\times \\mathbf{v}') \\cdot \\mathbf{s} = -2k |\\mathbf{v}^{-} \\times \\mathbf{t}|^2\n$$\nNext, we evaluate the last term, $|\\mathbf{v}' \\times \\mathbf{s}|^2$.\n$$\n\\mathbf{v}' \\times \\mathbf{s} = \\mathbf{v}' \\times (k\\mathbf{t}) = k (\\mathbf{v}' \\times \\mathbf{t})\n$$\nUsing $\\mathbf{v}' = \\mathbf{v}^{-} + \\mathbf{v}^{-} \\times \\mathbf{t}$:\n$$\n\\mathbf{v}' \\times \\mathbf{t} = (\\mathbf{v}^{-} + \\mathbf{v}^{-} \\times \\mathbf{t}) \\times \\mathbf{t} = (\\mathbf{v}^{-} \\times \\mathbf{t}) + ((\\mathbf{v}^{-} \\times \\mathbf{t}) \\times \\mathbf{t})\n$$\nLet the vector $\\mathbf{w} = \\mathbf{v}^{-} \\times \\mathbf{t}$. The expression is $\\mathbf{w} + (\\mathbf{w} \\times \\mathbf{t})$. These two vectors are orthogonal, since $(\\mathbf{w} \\times \\mathbf{t})$ is perpendicular to $\\mathbf{w}$. Thus, the squared magnitude is the sum of the squared magnitudes:\n$$\n|\\mathbf{v}' \\times \\mathbf{t}|^2 = |\\mathbf{w}|^2 + |\\mathbf{w} \\times \\mathbf{t}|^2 = |\\mathbf{v}^{-} \\times \\mathbf{t}|^2 + |(\\mathbf{v}^{-} \\times \\mathbf{t}) \\times \\mathbf{t}|^2\n$$\nThe vector $\\mathbf{v}^{-} \\times \\mathbf{t}$ is perpendicular to $\\mathbf{t}$. So, the magnitude of their cross product is simply the product of their magnitudes: $|(\\mathbf{v}^{-} \\times \\mathbf{t}) \\times \\mathbf{t}| = |\\mathbf{v}^{-} \\times \\mathbf{t}| |\\mathbf{t}|$.\n$$\n|\\mathbf{v}' \\times \\mathbf{t}|^2 = |\\mathbf{v}^{-} \\times \\mathbf{t}|^2 + |\\mathbf{v}^{-} \\times \\mathbf{t}|^2 |\\mathbf{t}|^2 = |\\mathbf{v}^{-} \\times \\mathbf{t}|^2 (1 + |\\mathbf{t}|^2)\n$$\nTherefore, the last term in the expression for $|\\mathbf{v}^{+}|^2$ is:\n$$\n|\\mathbf{v}' \\times \\mathbf{s}|^2 = |k(\\mathbf{v}' \\times \\mathbf{t})|^2 = k^2 |\\mathbf{v}' \\times \\mathbf{t}|^2 = k^2 |\\mathbf{v}^{-} \\times \\mathbf{t}|^2 (1 + |\\mathbf{t}|^2)\n$$\nNow, assemble the complete expression for $|\\mathbf{v}^{+}|^2$:\n$$\n|\\mathbf{v}^{+}|^2 = |\\mathbf{v}^{-}|^2 - 2k |\\mathbf{v}^{-} \\times \\mathbf{t}|^2 + k^2 |\\mathbf{v}^{-} \\times \\mathbf{t}|^2 (1 + |\\mathbf{t}|^2)\n$$\nWe can factor out $|\\mathbf{v}^{-} \\times \\mathbf{t}|^2$:\n$$\n|\\mathbf{v}^{+}|^2 = |\\mathbf{v}^{-}|^2 + |\\mathbf{v}^{-} \\times \\mathbf{t}|^2 [-2k + k^2(1 + |\\mathbf{t}|^2)]\n$$\nRecall the definition $k = \\frac{2}{1 + |\\mathbf{t}|^2}$. This implies $k(1 + |\\mathbf{t}|^2) = 2$.\nSubstitute this into the bracketed term:\n$$\n-2k + k^2(1 + |\\mathbf{t}|^2) = -2k + k(k(1 + |\\mathbf{t}|^2)) = -2k + k(2) = 0\n$$\nThe entire term proportional to $|\\mathbf{v}^{-} \\times \\mathbf{t}|^2$ vanishes.\nThis leaves us with the remarkable result:\n$$\n|\\mathbf{v}^{+}|^2 = |\\mathbf{v}^{-}|^2\n$$\nRecalling that $\\mathbf{v}^{+} = \\mathbf{v}^{n+1}$ and $\\mathbf{v}^{-} = \\mathbf{v}^{n}$, we have shown that for any single step $n$:\n$$\n|\\mathbf{v}^{n+1}|^2 = |\\mathbf{v}^{n}|^2 \\implies |\\mathbf{v}^{n+1}| = |\\mathbf{v}^{n}|\n$$\nThe Boris pusher, when applied in a pure magnetic field, exactly conserves the particle's speed, and therefore its kinetic energy, at every time step.\n\nBy induction, after $N$ steps, the velocity magnitude will be unchanged from its initial value:\n$$\n|\\mathbf{v}^{N}| = |\\mathbf{v}^{N-1}| = \\dots = |\\mathbf{v}^{1}| = |\\mathbf{v}^{0}|\n$$\nThe kinetic energy at the start is $K_{0} = \\frac{1}{2}m|\\mathbf{v}^{0}|^2$. The kinetic energy after $N$ steps is $K_{N} = \\frac{1}{2}m|\\mathbf{v}^{N}|^2$.\nSince $|\\mathbf{v}^{N}| = |\\mathbf{v}^{0}|$, it follows that $K_{N} = K_{0}$.\n\nThis result from the Boris pusher is consistent with the exact analytical solution. For the Lorentz force $\\mathbf{F} = q(\\mathbf{v} \\times \\mathbf{B})$, the rate of work done on the particle is $P = \\mathbf{F} \\cdot \\mathbf{v} = q(\\mathbf{v} \\times \\mathbf{B}) \\cdot \\mathbf{v}$. Since $\\mathbf{v} \\times \\mathbf{B}$ is orthogonal to $\\mathbf{v}$, this dot product is always zero. Thus, a pure magnetic field does no work, and the kinetic energy of the particle is exactly conserved. The Boris pusher perfectly reproduces this feature.\n\nFinally, we compute the dimensionless energy error:\n$$\n\\delta K = \\frac{K_{N} - K_{0}}{K_{0}} = \\frac{K_{0} - K_{0}}{K_{0}} = \\frac{0}{K_{0}}\n$$\nAssuming the particle is in motion, $K_0 > 0$, so:\n$$\n\\delta K = 0\n$$",
            "answer": "$$\\boxed{0}$$"
        },
        {
            "introduction": "A core feature of PIC/MAC methods is the hybrid framework, which requires a robust dialogue between Lagrangian particles and the Eulerian grid. This exercise addresses a critical aspect of this dialogue: how to consistently define material properties on the grid using information from the particles . By requiring physical flux continuity across cell boundaries, you will derive the correct averaging scheme for viscosity on a staggered grid, discovering why a naive arithmetic average fails and why a harmonic average is required.",
            "id": "3612571",
            "problem": "A creeping shear flow in a heterogeneous viscous column is to be computed on a Marker-And-Cell (MAC) staggered grid, with face-centered velocities and cell-centered pressure. Cell-centered viscosity values are obtained by Particle-In-Cell (PIC) marker sampling within each control volume. Consider two adjacent control volumes that share a common vertical face at location $x_{f}$, with their centers located at $x_{L}$ and $x_{R}$ and distances to the face denoted by $\\Delta x_{L} = x_{f} - x_{L}$ and $\\Delta x_{R} = x_{R} - x_{f}$. The cell-centered viscosities inferred from the markers are $\\eta_{L}$ and $\\eta_{R}$, assumed piecewise constant within each control volume. Denote the face-normal velocity by $u(x)$, with values $u_{L} = u(x_{L})$ and $u_{R} = u(x_{R})$. In the absence of body forces and pressure gradients, the one-dimensional steady Stokes momentum balance reduces to the statement that the viscous shear flux is constant in space.\n\nIn a finite-volume discretization, one seeks an effective face viscosity $\\eta_{f}$ such that the discrete viscous flux constructed from the two-point difference between $u_{L}$ and $u_{R}$ across the distance $\\Delta x_{L} + \\Delta x_{R}$ matches the exact constant viscous flux that would result from the piecewise-constant viscosity profile. Starting from the definition of viscous shear stress in Stokes flow and the requirement of flux continuity, derive from first principles a closed-form expression for $\\eta_{f}$ in terms of $\\eta_{L}$, $\\eta_{R}$, $\\Delta x_{L}$, and $\\Delta x_{R}$ that guarantees continuity of viscous flux across the face for arbitrary positive $\\eta_{L}$, $\\eta_{R}$ and nonuniform $\\Delta x_{L}$, $\\Delta x_{R}$. Then, briefly explain why the arithmetic average of $\\eta_{L}$ and $\\eta_{R}$ generally fails to preserve flux continuity in this setting.\n\nReport your final answer as the single explicit expression for $\\eta_{f}$ in terms of $\\eta_{L}$, $\\eta_{R}$, $\\Delta x_{L}$, and $\\Delta x_{R}$. No numerical evaluation is required and no rounding is needed. Do not include units in your final answer.",
            "solution": "The user has submitted a problem for validation and solution.\n\n### Step 1: Extract Givens\n- **Flow type:** Creeping shear flow in a heterogeneous viscous column.\n- **Numerical scheme:** Marker-And-Cell (MAC) staggered grid.\n- **Variable locations:** Face-centered velocities, cell-centered pressure.\n- **Viscosity:** Cell-centered values $\\eta_{L}$ and $\\eta_{R}$, obtained via Particle-In-Cell (PIC) sampling, assumed piecewise constant in each control volume.\n- **Geometry:** Two adjacent control volumes with centers at $x_{L}$ and $x_{R}$, sharing a vertical face at $x_{f}$.\n- **Grid spacing:** Non-uniform distances defined as $\\Delta x_{L} = x_{f} - x_{L}$ and $\\Delta x_{R} = x_{R} - x_{f}$.\n- **Velocities:** Face-normal velocity function $u(x)$, with cell-centered values $u_{L} = u(x_{L})$ and $u_{R} = u(x_{R})$.\n- **Governing Physics:** One-dimensional steady Stokes momentum balance in the absence of body forces and pressure gradients. This simplifies to the condition that the viscous shear flux (stress) is constant in space.\n- **Objective:** Derive a closed-form expression for an effective face viscosity $\\eta_{f}$.\n- **Constraint:** The discrete viscous flux, defined as $\\eta_{f}$ times the two-point velocity difference quotient, must match the exact constant viscous flux derived from the piecewise-constant viscosity profile.\n- **Secondary objective:** Explain why the arithmetic average of $\\eta_{L}$ and $\\eta_{R}$ is generally incorrect.\n\n### Step 2: Validate Using Extracted Givens\nThe problem is evaluated against the specified criteria:\n- **Scientifically Grounded:** The problem is firmly rooted in the principles of continuum mechanics (Stokes flow) and standard numerical methods for computational fluid dynamics (finite volume, MAC grids, PIC methods). The physical simplification to 1D constant shear stress is a valid and standard starting point for discretizing the viscous term. All concepts are standard in the field.\n- **Well-Posed:** The problem is well-posed. It provides a clear physical constraint (continuity of flux) and a defined mathematical structure (piecewise constant properties, finite volume discretization) from which a unique expression for the effective viscosity $\\eta_f$ can be derived.\n- **Objective:** The language is technical, precise, and devoid of any subjectivity or ambiguity.\n\nThe problem does not exhibit any of the listed flaws. It is not scientifically unsound, non-formalizable, incomplete, unrealistic, ill-posed, or trivial. It represents a a fundamental derivation for handling material heterogeneities in numerical models of viscous flow.\n\n### Step 3: Verdict and Action\nThe problem is **valid**. A solution will be provided.\n\n### Solution Derivation\nThe problem requires the derivation of an effective face viscosity $\\eta_{f}$ that ensures the numerical scheme preserves the physical continuity of flux across a material interface.\n\nThe governing physics is the one-dimensional steady Stokes momentum equation without pressure gradients or body forces, which is given by the divergence of the stress tensor being zero. In one dimension, for shear flow, this reduces to:\n$$\n\\frac{d\\tau}{dx} = 0\n$$\nwhere $\\tau$ is the viscous shear stress. This implies that the shear stress $\\tau$ must be constant throughout the domain. Let us denote this constant stress by $\\tau_c$. The constitutive relation for a Newtonian fluid defines the shear stress as:\n$$\n\\tau(x) = \\eta(x) \\frac{du}{dx}\n$$\nwhere $\\eta(x)$ is the dynamic viscosity and $u(x)$ is the velocity.\n\nSince $\\tau(x) = \\tau_c$, we can write the velocity gradient as:\n$$\n\\frac{du}{dx} = \\frac{\\tau_c}{\\eta(x)}\n$$\nThe problem states that the viscosity is piecewise constant: $\\eta(x) = \\eta_L$ for $x \\in [x_L, x_f]$ and $\\eta(x) = \\eta_R$ for $x \\in [x_f, x_R]$. We can integrate the velocity gradient equation across the two segments connecting the cell centers to the common face.\n\nFirst, we integrate from the left cell center $x_L$ to the face $x_f$:\n$$\n\\int_{u(x_L)}^{u(x_f)} du = \\int_{x_L}^{x_f} \\frac{\\tau_c}{\\eta_L} dx\n$$\n$$\nu(x_f) - u_L = \\frac{\\tau_c}{\\eta_L} (x_f - x_L) = \\frac{\\tau_c \\Delta x_L}{\\eta_L}\n$$\n\nNext, we integrate from the face $x_f$ to the right cell center $x_R$:\n$$\n\\int_{u(x_f)}^{u(x_R)} du = \\int_{x_f}^{x_R} \\frac{\\tau_c}{\\eta_R} dx\n$$\n$$\nu_R - u(x_f) = \\frac{\\tau_c}{\\eta_R} (x_R - x_f) = \\frac{\\tau_c \\Delta x_R}{\\eta_R}\n$$\n\nIn a cell-centered velocity formulation, the face velocity $u(x_f)$ is not an explicit variable. We can eliminate it by summing the two equations above:\n$$\n(u_R - u(x_f)) + (u(x_f) - u_L) = \\frac{\\tau_c \\Delta x_R}{\\eta_R} + \\frac{\\tau_c \\Delta x_L}{\\eta_L}\n$$\n$$\nu_R - u_L = \\tau_c \\left( \\frac{\\Delta x_L}{\\eta_L} + \\frac{\\Delta x_R}{\\eta_R} \\right)\n$$\nThis allows us to express the exact, constant physical flux $\\tau_c$ in terms of the known cell-centered velocities $u_L$ and $u_R$ and the given properties:\n$$\n\\tau_c = \\frac{u_R - u_L}{\\frac{\\Delta x_L}{\\eta_L} + \\frac{\\Delta x_R}{\\eta_R}}\n$$\nThis is the \"exact constant viscous flux\" that the discrete formulation must match.\n\nNow, we consider the finite-volume discretization of the flux at the face $x_f$. This discrete flux, which we denote $\\tau_f$, is constructed using an effective face viscosity $\\eta_f$ and a finite difference approximation for the velocity gradient based on the two cell-centered values $u_L$ and $u_R$. The total distance between these points is $x_R - x_L = (x_R - x_f) + (x_f - x_L) = \\Delta x_R + \\Delta x_L$. The discrete flux is therefore defined as:\n$$\n\\tau_f = \\eta_f \\left( \\frac{u_R - u_L}{x_R - x_L} \\right) = \\eta_f \\frac{u_R - u_L}{\\Delta x_L + \\Delta x_R}\n$$\nTo ensure the numerical scheme is physically consistent, we enforce the condition that the discrete flux equals the exact flux, $\\tau_f = \\tau_c$:\n$$\n\\eta_f \\frac{u_R - u_L}{\\Delta x_L + \\Delta x_R} = \\frac{u_R - u_L}{\\frac{\\Delta x_L}{\\eta_L} + \\frac{\\Delta x_R}{\\eta_R}}\n$$\nAssuming a non-static case where $u_R \\neq u_L$, we can cancel the term $(u_R - u_L)$ from both sides:\n$$\n\\frac{\\eta_f}{\\Delta x_L + \\Delta x_R} = \\frac{1}{\\frac{\\Delta x_L}{\\eta_L} + \\frac{\\Delta x_R}{\\eta_R}}\n$$\nSolving for the effective face viscosity $\\eta_f$:\n$$\n\\eta_f = (\\Delta x_L + \\Delta x_R) \\left( \\frac{1}{\\frac{\\Delta x_L \\eta_R + \\Delta x_R \\eta_L}{\\eta_L \\eta_R}} \\right)\n$$\n$$\n\\eta_f = (\\Delta x_L + \\Delta x_R) \\left( \\frac{\\eta_L \\eta_R}{\\Delta x_L \\eta_R + \\Delta x_R \\eta_L} \\right)\n$$\nThis can be written as the final closed-form expression:\n$$\n\\eta_f = \\frac{(\\Delta x_L + \\Delta x_R) \\eta_L \\eta_R}{\\Delta x_L \\eta_R + \\Delta x_R \\eta_L}\n$$\nThis expression represents the distance-weighted harmonic mean of the two cell-centered viscosities.\n\nFinally, we briefly explain why a simple arithmetic average generally fails. The arithmetic average, possibly weighted by distance, would be $\\eta_{a} = \\frac{\\Delta x_L \\eta_L + \\Delta x_R \\eta_R}{\\Delta x_L + \\Delta x_R}$. Using this viscosity in the discrete flux formulation would give $\\tau_a = \\eta_a \\frac{u_R - u_L}{\\Delta x_L + \\Delta x_R} = \\frac{\\Delta x_L \\eta_L + \\Delta x_R \\eta_R}{\\Delta x_L + \\Delta x_R} \\frac{u_R - u_L}{\\Delta x_L + \\Delta x_R}$. This flux $\\tau_a$ is not equal to the exact flux $\\tau_c$ unless $\\eta_L = \\eta_R$. The physical reason is that the flow resistance of the two layers is in series. In an electrical analogy where velocity is potential, stress is current, and $\\frac{\\Delta x}{\\eta}$ is resistance, the total resistance is the sum of the individual resistances: $R_{total} = R_L + R_R = \\frac{\\Delta x_L}{\\eta_L} + \\frac{\\Delta x_R}{\\eta_R}$. The derived effective viscosity correctly reflects this series summation. The arithmetic average of viscosities is analogous to averaging conductivities (reciprocal of resistivity), which would be appropriate for a parallel flow configuration, not the series configuration described in the problem. Thus, arithmetic averaging violates the physical constraint of constant flux.",
            "answer": "$$ \\boxed{ \\frac{(\\Delta x_L + \\Delta x_R)\\eta_L \\eta_R}{\\Delta x_L \\eta_R + \\Delta x_R \\eta_L} } $$"
        },
        {
            "introduction": "The stability of any explicit numerical scheme hinges on a careful choice of the time step, $\\Delta t$. If the time step is too large, numerical errors can amplify exponentially, destroying the solution. This final practice synthesizes concepts from both the grid-based field solver and the particle advection step to derive a stable time step for a coupled system . You will establish the famous Courant-Friedrichs-Lewy (CFL) condition and see how it combines with particle transport constraints to govern the overall algorithm's stability.",
            "id": "3612596",
            "problem": "Consider a one-dimensional explicit elastic–acoustic field solver on a uniform staggered grid, coupled to a Particle-In-Cell (PIC) particle update for material markers, as is common in computational geophysics when using Particle-In-Cell (PIC) and Marker-And-Cell (MAC) strategies to advect properties through an evolving wave field. The medium is linear, homogeneous, and isotropic over sufficiently small spatial neighborhoods, with mass density $\\rho$ and bulk modulus $K$. The maximum characteristic wave speed is $c = \\sqrt{K/\\rho}$ and the grid spacing is $\\Delta x$. The field solver advances first-order acoustic variables (pressure and velocity) with a centered-in-space, centered-in-time (leapfrog) explicit method on a staggered grid. Particles are advanced with a first-order explicit update using the interpolated velocity field.\n\nStarting from the first-order acoustic system, the definition of the characteristic speed, and the explicit staggered-grid leapfrog update, derive a conservative upper bound on the time step $\\Delta t$ that simultaneously enforces both of the following:\n- explicit field-update stability for all spatial Fourier modes admissible by the mesh, and\n- the particle-crossing constraint that no particle traverses more than one grid cell in a single time step.\n\nYour answer must be a single closed-form analytic expression in terms of $c$ and $\\Delta x$. Express the time step in seconds. No numerical evaluation is required.",
            "solution": "The problem is deemed valid as it is scientifically grounded, well-posed, and objective. It describes a standard problem in computational physics involving the stability of a coupled numerical scheme. All variables and conditions are clearly defined.\n\nThe task is to derive a conservative upper bound on the time step $\\Delta t$ for a coupled Particle-In-Cell (PIC) and finite-difference field solver system. This requires satisfying two independent conditions simultaneously: the stability of the explicit field solver and a particle-crossing constraint. The final expression must be in terms of the characteristic wave speed $c$ and the grid spacing $\\Delta x$.\n\nLet's derive the condition for each constraint separately.\n\n**1. Explicit Field-Update Stability (CFL Condition)**\n\nThe governing equations are the first-order, one-dimensional linear acoustic system:\n$$\n\\frac{\\partial p}{\\partial t} + K \\frac{\\partial v_x}{\\partial x} = 0\n$$\n$$\n\\rho \\frac{\\partial v_x}{\\partial t} + \\frac{\\partial p}{\\partial x} = 0\n$$\nwhere $p$ is the acoustic pressure, $v_x$ is the particle velocity in the $x$-direction, $\\rho$ is the mass density, and $K$ is the bulk modulus. The characteristic wave speed is given as $c = \\sqrt{K/\\rho}$.\n\nThe numerical method is a centered-in-space, centered-in-time (leapfrog) explicit scheme on a staggered grid. Let pressure $p$ be defined at grid nodes $x_j = j \\Delta x$ and integer time steps $t^n = n \\Delta t$. Let velocity $v_x$ be defined at staggered nodes $x_{j+1/2} = (j+1/2) \\Delta x$ and half-integer time steps $t^{n+1/2} = (n+1/2) \\Delta t$. The finite-difference approximation of the system is:\n$$\n\\frac{p_j^{n+1} - p_j^n}{\\Delta t} = -K \\frac{v_{x, j+1/2}^{n+1/2} - v_{x, j-1/2}^{n+1/2}}{\\Delta x}\n$$\n$$\n\\rho \\frac{v_{x, j+1/2}^{n+1/2} - v_{x, j+1/2}^{n-1/2}}{\\Delta t} = - \\frac{p_{j+1}^{n} - p_j^n}{\\Delta x}\n$$\nTo analyze the stability, we perform a von Neumann stability analysis. We seek solutions of the form $p_j^n = \\hat{p}(k) G^n \\exp(i k x_j)$ and $v_{x, j+1/2}^{n \\pm 1/2} = \\hat{v}_x(k) G^{n \\pm 1/2} \\exp(i k x_{j+1/2})$, where $G$ is the amplification factor and $k$ is the wavenumber. Substituting these into the finite-difference equations and simplifying leads to the numerical dispersion relation for this scheme:\n$$\n\\sin\\left(\\frac{\\omega \\Delta t}{2}\\right) = \\pm \\frac{c \\Delta t}{\\Delta x} \\sin\\left(\\frac{k \\Delta x}{2}\\right)\n$$\nwhere $\\omega$ is the angular frequency such that $G = \\exp(-i \\omega \\Delta t)$. For the scheme to be stable, the amplification factor $G$ must have a magnitude $|G| \\le 1$. This requires $\\omega$ to be a real number. For $\\omega$ to be real, the argument of the arcsin function used to solve for $\\omega$ must be real and have a magnitude less than or equal to $1$:\n$$\n\\left| \\frac{c \\Delta t}{\\Delta x} \\sin\\left(\\frac{k \\Delta x}{2}\\right) \\right| \\le 1\n$$\nThis inequality must hold for all spatial Fourier modes $k$ admissible by the mesh. The most restrictive case (i.e., the one that places the tightest constraint on $\\Delta t$) occurs for the mode that maximizes the term $|\\sin(k \\Delta x / 2)|$. The maximum value of this term is $1$, which occurs at the Nyquist wavenumber $k_{max} = \\pi / \\Delta x$.\nSubstituting this worst-case value, the stability condition becomes:\n$$\n\\frac{c \\Delta t}{\\Delta x} \\le 1\n$$\nThis yields the first constraint on the time step, known as the Courant-Friedrichs-Lewy (CFL) condition:\n$$\n\\Delta t \\le \\frac{\\Delta x}{c}\n$$\n\n**2. Particle-Crossing Constraint**\n\nThe second constraint is that no particle should traverse more than one grid cell in a single time step. The particles are advected using a first-order explicit update:\n$$\nx_p(t + \\Delta t) = x_p(t) + v_p(t) \\Delta t\n$$\nwhere $x_p$ is the particle's position and $v_p$ is its velocity, obtained by interpolating the velocity field $v_x$ from the grid.\nThe displacement of a particle in one time step is $|v_p(t)| \\Delta t$. The constraint requires this displacement to be less than or equal to the grid cell width $\\Delta x$:\n$$\n|v_p(t)| \\Delta t \\le \\Delta x\n$$\nTo ensure this condition holds for all particles at all times, we must consider the maximum possible particle velocity in the simulation, $\\max(|v_x|)$:\n$$\n\\Delta t \\le \\frac{\\Delta x}{\\max(|v_x|)}\n$$\n\n**3. Combined Conservative Upper Bound**\n\nThe time step $\\Delta t$ must simultaneously satisfy both constraints. Therefore, it must be less than or equal to the minimum of the two derived upper bounds:\n$$\n\\Delta t \\le \\min\\left( \\frac{\\Delta x}{c}, \\frac{\\Delta x}{\\max(|v_x|)} \\right)\n$$\nTo determine a single analytical expression in terms of only $c$ and $\\Delta x$, we must evaluate the relationship between $c$ and $\\max(|v_x|)$. The problem states that the solver is for a \"linear, homogeneous, and isotropic\" elastic–acoustic field. A fundamental tenet of linear acoustic theory is that the particle (or material) velocity is very small compared to the speed of wave propagation. That is, the physical regime being modeled is one where:\n$$\n\\max(|v_x|) \\ll c\n$$\nThis inequality has a direct consequence for the two stability bounds. If $\\max(|v_x|) \\ll c$, then $\\frac{1}{\\max(|v_x|)} \\gg \\frac{1}{c}$. This implies:\n$$\n\\frac{\\Delta x}{\\max(|v_x|)} \\gg \\frac{\\Delta x}{c}\n$$\nThe particle-crossing constraint is therefore far less restrictive than the field-solver (CFL) constraint. To satisfy both conditions simultaneously, we must adhere to the stricter of the two. The minimum of the two upper bounds is thus the CFL condition.\n\nTherefore, the conservative upper bound on the time step $\\Delta t$ that enforces both conditions is dictated by the field-update stability:\n$$\n\\Delta t \\le \\frac{\\Delta x}{c}\n$$\nThe maximum allowable value for $\\Delta t$ is this upper bound.",
            "answer": "$$\\boxed{\\frac{\\Delta x}{c}}$$"
        }
    ]
}