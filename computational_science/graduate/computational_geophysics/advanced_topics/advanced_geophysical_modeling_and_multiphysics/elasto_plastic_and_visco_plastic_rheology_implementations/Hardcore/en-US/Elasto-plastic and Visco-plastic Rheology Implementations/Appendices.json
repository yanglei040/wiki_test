{
    "hands_on_practices": [
        {
            "introduction": "This first practice grounds your understanding in the fundamentals of rate-independent plasticity. By deriving the analytical stress-strain response for a classic uniaxial loading path, you will build concrete intuition for abstract concepts like the yield condition, isotropic hardening, and elastic unloading. Mastering this benchmark  is a crucial first step, providing an exact solution against which you can verify a numerical implementation.",
            "id": "3588540",
            "problem": "Consider a small-strain uniaxial tension/compression benchmark to verify a radial return mapping implementation for isotropic von Mises ($J_2$) plasticity with linear isotropic hardening. The material is linear elastic-perfectly plastic-hardening with Young’s modulus $E$, initial yield stress $\\sigma_{y0}$, and hardening modulus $H$ (isotropic hardening). Adopt the standard von Mises yield function with associated flow and the conventional definition of the equivalent plastic strain. Assume isothermal, rate-independent behavior and neglect geometric nonlinearity (small deformation).\n\nDesign the following benchmark and derive analytical predictions from first principles:\n\n- Material parameters: $E = 60 \\,\\mathrm{GPa}$, $\\sigma_{y0} = 200 \\,\\mathrm{MPa}$, $H = 1.2 \\,\\mathrm{GPa}$. You may assume that Poisson’s ratio does not affect the uniaxial axial stress prediction in this setting.\n- Loading path (total axial strain control): \n  1) Monotonic tension from zero to $\\epsilon_{1} = 0.010$,\n  2) Unload to $\\epsilon_{2} = 0.004$,\n  3) Reverse into compression to $\\epsilon_{3} = -0.004$.\n\nStarting from the definitions of small-strain kinematics, linear elasticity, the von Mises ($J_2$) yield function, associated flow, and the consistency condition, derive the uniaxial stress–strain response for this path. Then, using your derived expressions, compute the final axial Cauchy stress at the end of the path (at $\\epsilon = \\epsilon_{3}$). Express the final answer in $\\mathrm{MPa}$, and round your answer to four significant figures.",
            "solution": "The problem is evaluated as valid, as it describes a standard, well-posed benchmark in continuum plasticity theory based on scientifically established principles and provides a complete set of parameters and conditions.\n\nThe solution is derived from first principles by analyzing the stress-strain response over the three segments of the prescribed loading path.\n\nFirst, we establish the constitutive framework for uniaxial loading. The material is governed by small-strain kinematics, where the total strain tensor $\\boldsymbol{\\epsilon}$ is the sum of the elastic part $\\boldsymbol{\\epsilon}^e$ and the plastic part $\\boldsymbol{\\epsilon}^p$: $\\boldsymbol{\\epsilon} = \\boldsymbol{\\epsilon}^e + \\boldsymbol{\\epsilon}^p$.\n\nFor a uniaxial stress state, the Cauchy stress tensor is $\\boldsymbol{\\sigma} = \\sigma \\mathbf{e}_1 \\otimes \\mathbf{e}_1$, where $\\sigma$ is the axial stress.\nThe von Mises equivalent stress $\\sigma_{eq}$, defined as $\\sigma_{eq} = \\sqrt{\\frac{3}{2}\\mathbf{s}:\\mathbf{s}}$ where $\\mathbf{s}$ is the deviatoric stress tensor, simplifies to $\\sigma_{eq} = |\\sigma|$ for the uniaxial case.\nThe yield function $f$ for von Mises plasticity with linear isotropic hardening is given by:\n$$f(\\sigma, \\bar{\\epsilon}^p) = |\\sigma| - \\sigma_y(\\bar{\\epsilon}^p) = |\\sigma| - (\\sigma_{y0} + H \\bar{\\epsilon}^p) \\le 0$$\nwhere $\\sigma_{y0}$ is the initial yield stress, $H$ is the hardening modulus, and $\\bar{\\epsilon}^p$ is the equivalent plastic strain, a scalar measure of accumulated plastic deformation.\n\nThe elastic response is governed by Hooke's Law for the axial components: $\\sigma = E \\epsilon^e$, where $E$ is Young's modulus.\nThe plastic flow is governed by the associated flow rule, which for uniaxial loading simplifies to $\\dot{\\bar{\\epsilon}}^p = |\\dot{\\epsilon}^p|$, where $\\dot{\\epsilon}^p$ is the rate of axial plastic strain.\n\nDuring plastic loading (when $f=0$), the consistency condition $\\dot{f}=0$ must be maintained. For monotonic tensile loading ($\\sigma  0$), this gives $\\dot{\\sigma} - H \\dot{\\bar{\\epsilon}}^p = 0$. Combining this with the rate form of the strain decomposition and Hooke's law, we derive the tangent modulus $E_T$ for the plastic regime:\n$$\\frac{d\\sigma}{d\\epsilon} = E_T = \\frac{EH}{E+H}$$\n\nThe given material parameters are:\n$E = 60 \\,\\mathrm{GPa} = 60000 \\,\\mathrm{MPa}$\n$\\sigma_{y0} = 200 \\,\\mathrm{MPa}$\n$H = 1.2 \\,\\mathrm{GPa} = 1200 \\,\\mathrm{MPa}$\n\nFrom these, we can calculate the plastic tangent modulus:\n$$E_T = \\frac{60000 \\times 1200}{60000 + 1200} = \\frac{72000000}{61200} = \\frac{20000}{17} \\,\\mathrm{MPa}$$\n\nThe analysis proceeds by tracking the state variables $(\\epsilon, \\sigma, \\bar{\\epsilon}^p)$ through the loading path.\n\n**Path 1: Monotonic tension to $\\epsilon_1 = 0.010$**\nThe material first loads elastically. Yielding begins when $\\sigma = \\sigma_{y0}$. The strain at yield, $\\epsilon_y$, is:\n$$\\epsilon_y = \\frac{\\sigma_{y0}}{E} = \\frac{200}{60000} = \\frac{1}{300} \\approx 0.00333$$\nSince the target strain $\\epsilon_1 = 0.010  \\epsilon_y$, the material will undergo plastic deformation. For $\\epsilon  \\epsilon_y$, the stress is given by:\n$$\\sigma(\\epsilon) = \\sigma_{y0} + E_T(\\epsilon - \\epsilon_y)$$\nAt the end of this path (Point 1), the stress $\\sigma_1$ is:\n$$\\sigma_1 = 200 + \\frac{20000}{17} \\left(0.010 - \\frac{1}{300}\\right) = 200 + \\frac{20000}{17} \\left(\\frac{1}{100} - \\frac{1}{300}\\right) = 200 + \\frac{20000}{17} \\left(\\frac{2}{300}\\right) = 200 + \\frac{400}{51} = \\frac{10600}{51} \\,\\mathrm{MPa}$$\nThe accumulated equivalent plastic strain $\\bar{\\epsilon}^p_1$ at this point is found from the hardening law:\n$$\\sigma_1 = \\sigma_{y0} + H \\bar{\\epsilon}^p_1 \\implies \\bar{\\epsilon}^p_1 = \\frac{\\sigma_1 - \\sigma_{y0}}{H} = \\frac{\\frac{10600}{51} - 200}{1200} = \\frac{\\frac{400}{51}}{1200} = \\frac{1}{153}$$\nThe current yield strength is $\\sigma_{y,1} = \\sigma_1 = \\frac{10600}{51} \\,\\mathrm{MPa}$.\n\n**Path 2: Unload to $\\epsilon_2 = 0.004$**\nUnloading is purely elastic, so the stress-strain relation follows a line with slope $E$ starting from $(\\epsilon_1, \\sigma_1)$:\n$$\\sigma(\\epsilon) = \\sigma_1 + E(\\epsilon - \\epsilon_1)$$\nThe stress at Point 2 is:\n$$\\sigma_2 = \\sigma_1 + E(\\epsilon_2 - \\epsilon_1) = \\frac{10600}{51} + 60000(0.004 - 0.010) = \\frac{10600}{51} - 360 = \\frac{10600 - 18360}{51} = -\\frac{7760}{51} \\,\\mathrm{MPa}$$\nDuring elastic unloading, plastic strain does not change, so $\\bar{\\epsilon}^p_2 = \\bar{\\epsilon}^p_1 = 1/153$. The yield surface has expanded due to isotropic hardening, with the yield strength remaining at $\\sigma_{y,2} = \\sigma_{y,1} = \\frac{10600}{51} \\,\\mathrm{MPa}$.\nWe check if reverse yielding occurs. Yielding in compression would start when $\\sigma = -\\sigma_{y,2}$. Let's find the strain $\\epsilon_{yc}$ at which this happens:\n$$-\\sigma_{y,2} = \\sigma_1 + E(\\epsilon_{yc} - \\epsilon_1) \\implies \\epsilon_{yc} = \\epsilon_1 - \\frac{\\sigma_1+\\sigma_{y,2}}{E} = \\epsilon_1 - \\frac{2\\sigma_1}{E}$$\n$$\\epsilon_{yc} = 0.010 - \\frac{2 \\times \\frac{10600}{51}}{60000} = \\frac{1}{100} - \\frac{106}{15300} = \\frac{153 - 106}{15300} = \\frac{47}{15300} \\approx 0.00307$$\nSince $\\epsilon_2 = 0.004  \\epsilon_{yc}$, the path from Point 1 to Point 2 is entirely elastic.\n\n**Path 3: Reverse into compression to $\\epsilon_3 = -0.004$**\nThe loading continues from Point 2. The material behavior is elastic until the strain reaches $\\epsilon_{yc}$. Since the final strain $\\epsilon_3 = -0.004  \\epsilon_{yc}$, the material will yield in compression.\nThe stress at the onset of reverse yielding is $\\sigma_{yc} = -\\sigma_{y,2} = -\\frac{10600}{51} \\,\\mathrm{MPa}$.\nFor strains $\\epsilon  \\epsilon_{yc}$, the material deforms plastically with a tangent modulus $E_T$. The final stress $\\sigma_3$ at $\\epsilon_3$ is:\n$$\\sigma_3 = \\sigma_{yc} + E_T(\\epsilon_3 - \\epsilon_{yc})$$\nSubstituting the values:\n$$\\sigma_3 = -\\frac{10600}{51} + \\frac{20000}{17}\\left(-0.004 - \\frac{47}{15300}\\right)$$\nThe term in the parenthesis is:\n$$-0.004 - \\frac{47}{15300} = -\\frac{1}{250} - \\frac{47}{15300} = \\frac{-61.2 - 47}{15300} = -\\frac{108.2}{15300}$$\nThe change in stress during the plastic portion of this path is:\n$$\\Delta\\sigma = \\frac{20000}{17} \\left(-\\frac{108.2}{15300}\\right) = \\frac{20000}{17} \\left(-\\frac{108.2}{900 \\times 17}\\right) = -\\frac{200 \\times 108.2}{289 \\times 9} = -\\frac{21640}{2601} \\,\\mathrm{MPa}$$\nThe final stress $\\sigma_3$ is the sum of the stress at the start of reverse yield and this plastic stress increment:\n$$\\sigma_3 = -\\frac{10600}{51} - \\frac{21640}{2601} = -\\frac{10600 \\times 51}{2601} - \\frac{21640}{2601} = \\frac{-540600 - 21640}{2601} = -\\frac{562240}{2601} \\,\\mathrm{MPa}$$\nNow, we compute the numerical value:\n$$\\sigma_3 \\approx -216.163014... \\,\\mathrm{MPa}$$\nRounding to four significant figures, we get:\n$$\\sigma_3 \\approx -216.2 \\,\\mathrm{MPa}$$",
            "answer": "$$\\boxed{-216.2}$$"
        },
        {
            "introduction": "Moving from analytical solutions to numerical code, this exercise challenges you to implement a return-mapping algorithm for the Drucker-Prager model. This is a foundational task for modeling geomaterials, as it introduces pressure-dependent yield strength and the critical concept of non-associated flow, which governs plastic dilatancy. This practice  will equip you with the skills to update stress invariants for a smooth, cohesive-frictional rheology.",
            "id": "3588499",
            "problem": "You are to implement a return-mapping algorithm for a non-associated Drucker–Prager plasticity model under plane strain in the context of computational geophysics. The goal is to derive, implement, and evaluate the update of the mean (hydrostatic) stress $p^{n+1}$ and equivalent (deviatoric) stress $q^{n+1}$ after an imposed infinitesimal strain increment, using principles from linear isotropic elasticity and classical plasticity. The implementation must include the volumetric correction induced by non-associated flow through the dilatancy angle.\n\nStart from the following fundamental base:\n- Linear isotropic elasticity defined by Hooke’s law in three dimensions with bulk modulus $K$ and shear modulus $G$, where $K$ and $G$ are functions of Young’s modulus $E$ and Poisson’s ratio $\\nu$. Recall the relationships $G = \\dfrac{E}{2(1+\\nu)}$ and $K = \\dfrac{E}{3(1-2\\nu)}$, and the three-dimensional constitutive form $\\boldsymbol{\\sigma} = 2 G \\boldsymbol{\\varepsilon} + \\lambda \\,\\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\mathbf{I}$ with Lamé parameter $\\lambda = K - \\dfrac{2}{3}G$.\n- Definition of the mean stress $p = \\dfrac{1}{3}\\mathrm{tr}(\\boldsymbol{\\sigma})$, the deviatoric stress tensor $\\mathbf{s} = \\boldsymbol{\\sigma} - p\\mathbf{I}$, the second invariant of its deviatoric part $J_{2} = \\dfrac{1}{2}\\mathbf{s}:\\mathbf{s}$, and the equivalent stress $q = \\sqrt{3 J_{2}}$.\n- Drucker–Prager yield function $f(\\boldsymbol{\\sigma})$ characterized by a friction angle $\\phi$ (in degrees) and cohesion $c$ (in Pascals), and a non-associated plastic potential $g(\\boldsymbol{\\sigma})$ characterized by a dilatancy angle $\\psi$ (in degrees). Use the classical geomechanics mapping to define the Drucker–Prager parameters in terms of the Mohr–Coulomb parameters: $\\beta_{\\phi} = \\dfrac{6 \\sin\\phi}{3 - \\sin\\phi}$, $\\beta_{\\psi} = \\dfrac{6 \\sin\\psi}{3 - \\sin\\psi}$, and $k = \\dfrac{6 c \\cos\\phi}{3 - \\sin\\phi}$, and the yield function form $f = q + \\beta_{\\phi} p - k$.\n- Plane strain constraint defined by $\\Delta\\varepsilon_{zz} = 0$ for each increment. Adopt the engineering shear strain convention where the in-plane engineering shear strain increment $\\Delta\\gamma_{xy}$ is related to the tensorial shear strain by $\\Delta\\varepsilon_{xy} = \\dfrac{1}{2}\\Delta\\gamma_{xy}$.\n\nDerive, from first principles, a consistent algorithm that:\n1. Forms the elastic trial stress tensor $\\boldsymbol{\\sigma}^{\\text{tr}}$ from the strain increment under plane strain using the three-dimensional Hooke’s law, and computes the corresponding trial invariants $p^{\\text{tr}}$ and $q^{\\text{tr}}$.\n2. Evaluates the trial yield function $f^{\\text{tr}} = q^{\\text{tr}} + \\beta_{\\phi} p^{\\text{tr}} - k$ to decide whether the response is elastic or plastic for the increment.\n3. If elastic ($f^{\\text{tr}} \\leq 0$), sets $p^{n+1} = p^{\\text{tr}}$ and $q^{n+1} = q^{\\text{tr}}$.\n4. If plastic ($f^{\\text{tr}}  0$), enforces consistency $f(\\boldsymbol{\\sigma}^{n+1}) = 0$ with a non-associated flow rule based on the plastic potential $g = q + \\beta_{\\psi} p$, and derives the scalar plastic multiplier increment that controls the corrections in both invariants. Show explicitly how the volumetric correction enters the update of the mean stress $p^{n+1}$ due to non-zero $\\beta_{\\psi}$, and how the deviatoric correction controls $q^{n+1}$.\n\nScientific realism requirements:\n- Use the stress sign convention where compression is positive and $p = \\dfrac{1}{3}\\mathrm{tr}(\\boldsymbol{\\sigma})$ is positive in compression.\n- Angles $\\phi$ and $\\psi$ are provided in degrees and must be converted to radians before using trigonometric functions.\n- All stress outputs must be expressed in Pascals. Strain increments are dimensionless.\n\nYour program must implement the described algorithm and, for the following test suite, compute and output the updated invariants $p^{n+1}$ and $q^{n+1}$ for each case. Assume the previous stress state is zero for all cases, so the elastic trial stress is formed directly from the given strain increment via Hooke’s law.\n\nTest suite (each case is a tuple $(E,\\nu,\\phi,\\psi,c,\\Delta\\varepsilon_{xx},\\Delta\\varepsilon_{yy},\\Delta\\gamma_{xy})$):\n- Case A (elastic baseline): $(E = 30\\times 10^{9}\\ \\text{Pa},\\, \\nu = 0.25,\\, \\phi = 20^{\\circ},\\, \\psi = 0^{\\circ},\\, c = 20\\times 10^{6}\\ \\text{Pa},\\, \\Delta\\varepsilon_{xx} = 1\\times 10^{-6},\\, \\Delta\\varepsilon_{yy} = 1\\times 10^{-6},\\, \\Delta\\gamma_{xy} = 0)$.\n- Case B (plastic with dilatancy): $(E = 30\\times 10^{9}\\ \\text{Pa},\\, \\nu = 0.25,\\, \\phi = 30^{\\circ},\\, \\psi = 10^{\\circ},\\, c = 1\\times 10^{6}\\ \\text{Pa},\\, \\Delta\\varepsilon_{xx} = 1\\times 10^{-4},\\, \\Delta\\varepsilon_{yy} = -1\\times 10^{-4},\\, \\Delta\\gamma_{xy} = 2\\times 10^{-4})$.\n- Case C (cohesionless, zero dilatancy, pure shear): $(E = 70\\times 10^{9}\\ \\text{Pa},\\, \\nu = 0.33,\\, \\phi = 35^{\\circ},\\, \\psi = 0^{\\circ},\\, c = 0\\ \\text{Pa},\\, \\Delta\\varepsilon_{xx} = 0,\\, \\Delta\\varepsilon_{yy} = 0,\\, \\Delta\\gamma_{xy} = 5\\times 10^{-4})$.\n- Case D (near-yield mixed loading): $(E = 30\\times 10^{9}\\ \\text{Pa},\\, \\nu = 0.25,\\, \\phi = 25^{\\circ},\\, \\psi = 5^{\\circ},\\, c = 2\\times 10^{6}\\ \\text{Pa},\\, \\Delta\\varepsilon_{xx} = 5\\times 10^{-6},\\, \\Delta\\varepsilon_{yy} = -5\\times 10^{-6},\\, \\Delta\\gamma_{xy} = 1\\times 10^{-5})$.\n\nFinal output format:\n- Your program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets. Each element corresponds to one test case and must be a two-element list $[p^{n+1},q^{n+1}]$ in Pascals. For example: $[[p_{A},q_{A}],[p_{B},q_{B}],[p_{C},q_{C}],[p_{D},q_{D}]]$.",
            "solution": "The task is to derive and implement a return-mapping algorithm for a non-associated Drucker-Prager plasticity model under plane strain conditions. We begin by validating the problem statement and then proceed with a first-principles derivation of the algorithm.\n\nThe problem states that compression is positive. The provided form of Hooke's Law, $\\boldsymbol{\\sigma} = 2 G \\boldsymbol{\\varepsilon} + \\lambda \\,\\mathrm{tr}(\\boldsymbol{\\varepsilon}) \\mathbf{I}$, combined with the definition of mean stress $p = \\frac{1}{3}\\mathrm{tr}(\\boldsymbol{\\sigma})$, implies that a positive (extensional) strain yields a positive (tensile) stress. To reconcile this with the geomechanics convention of positive compression, we must assume that the input strain increments, $\\Delta\\varepsilon_{ij}$, are themselves defined with compression as positive. This interpretation ensures that a positive (compressive) strain results in a positive (compressive) stress, consistent with the yield function $f = q + \\beta_{\\phi} p - k$ where higher compressive pressure $p$ increases strength.\n\nThe derivation proceeds in three main steps: an elastic predictor, a yield check, and a plastic corrector.\n\n**1. Constitutive Relations**\n\nThe material behavior is governed by linear isotropic elasticity and Drucker-Prager plasticity.\n\n- **Linear Elasticity**: The stress-strain relationship is given by Hooke's Law. In terms of the bulk modulus $K$ and shear modulus $G$, the volumetric and deviatoric responses are decoupled:\n$$ p = K \\varepsilon_v $$\n$$ \\mathbf{s} = 2G \\mathbf{e} $$\nwhere $p = \\frac{1}{3}\\mathrm{tr}(\\boldsymbol{\\sigma})$ is the mean stress, $\\mathbf{s} = \\boldsymbol{\\sigma} - p\\mathbf{I}$ is the deviatoric stress tensor, $\\varepsilon_v = \\mathrm{tr}(\\boldsymbol{\\varepsilon})$ is the volumetric strain, and $\\mathbf{e} = \\boldsymbol{\\varepsilon} - \\frac{1}{3}\\varepsilon_v\\mathbf{I}$ is the deviatoric strain tensor. The elastic moduli are related to Young's modulus $E$ and Poisson's ratio $\\nu$ by:\n$$ G = \\frac{E}{2(1+\\nu)}, \\quad K = \\frac{E}{3(1-2\\nu)} $$\nThe stress tensor can also be computed using Lamé's first parameter $\\lambda = K - \\frac{2}{3}G$:\n$$ \\boldsymbol{\\sigma} = 2G\\boldsymbol{\\varepsilon} + \\lambda\\varepsilon_v\\mathbf{I} $$\n\n- **Drucker-Prager Model**: The yield surface and plastic potential define the limits of elastic behavior and the direction of plastic flow.\nThe yield function $f$ is:\n$$ f(\\boldsymbol{\\sigma}) = q + \\beta_{\\phi} p - k = 0 $$\nThe non-associated plastic potential $g$ is:\n$$ g(\\boldsymbol{\\sigma}) = q + \\beta_{\\psi} p $$\nHere, $q = \\sqrt{3J_2} = \\sqrt{\\frac{3}{2}\\mathbf{s}:\\mathbf{s}}$ is the equivalent deviatoric stress. The parameters $\\beta_{\\phi}$, $\\beta_{\\psi}$, and $k$ are derived from the Mohr-Coulomb friction angle $\\phi$ (in radians), dilatancy angle $\\psi$ (in radians), and cohesion $c$:\n$$ \\beta_{\\phi} = \\frac{6 \\sin\\phi}{3 - \\sin\\phi}, \\quad \\beta_{\\psi} = \\frac{6 \\sin\\psi}{3 - \\sin\\psi}, \\quad k = \\frac{6 c \\cos\\phi}{3 - \\sin\\phi} $$\nPlastic flow occurs when $f(\\boldsymbol{\\sigma})  0$ during a trial elastic step.\n\n**2. Return-Mapping Algorithm Derivation**\n\nThe algorithm updates the stress state from a known state $\\boldsymbol{\\sigma}^n$ (here, $\\boldsymbol{\\sigma}^n = \\mathbf{0}$) over a given strain increment $\\Delta\\boldsymbol{\\varepsilon}$.\n\n**2.1. Elastic Predictor Step**\n\nFirst, we assume the entire strain increment is elastic and calculate a \"trial\" stress state, $\\boldsymbol{\\sigma}^{\\text{tr}}$.\nGiven the imposed plane strain increments $\\Delta\\varepsilon_{xx}$, $\\Delta\\varepsilon_{yy}$, and $\\Delta\\gamma_{xy}$, the strain increment tensor $\\Delta\\boldsymbol{\\varepsilon}$ has components:\n$$ \\Delta\\varepsilon_{xx}, \\quad \\Delta\\varepsilon_{yy}, \\quad \\Delta\\varepsilon_{zz} = 0, \\quad \\Delta\\varepsilon_{xy} = \\frac{1}{2}\\Delta\\gamma_{xy}, \\quad \\Delta\\varepsilon_{yz}=0, \\quad \\Delta\\varepsilon_{zx}=0 $$\nThe volumetric strain increment is $\\Delta\\varepsilon_v = \\mathrm{tr}(\\Delta\\boldsymbol{\\varepsilon}) = \\Delta\\varepsilon_{xx} + \\Delta\\varepsilon_{yy}$. With the initial stress being zero, the trial stress is computed directly from Hooke's Law:\n$$ \\boldsymbol{\\sigma}^{\\text{tr}} = \\mathbf{C} : \\Delta\\boldsymbol{\\varepsilon} $$\nThe components of the trial stress tensor are:\n$$ \\sigma_{xx}^{\\text{tr}} = 2G\\Delta\\varepsilon_{xx} + \\lambda\\Delta\\varepsilon_v $$\n$$ \\sigma_{yy}^{\\text{tr}} = 2G\\Delta\\varepsilon_{yy} + \\lambda\\Delta\\varepsilon_v $$\n$$ \\sigma_{zz}^{\\text{tr}} = 2G\\Delta\\varepsilon_{zz} + \\lambda\\Delta\\varepsilon_v = \\lambda\\Delta\\varepsilon_v $$\n$$ \\sigma_{xy}^{\\text{tr}} = 2G\\Delta\\varepsilon_{xy} = G\\Delta\\gamma_{xy} $$\nFrom these, we compute the trial mean stress $p^{\\text{tr}}$ and trial equivalent stress $q^{\\text{tr}}$:\n$$ p^{\\text{tr}} = \\frac{1}{3}(\\sigma_{xx}^{\\text{tr}} + \\sigma_{yy}^{\\text{tr}} + \\sigma_{zz}^{\\text{tr}}) $$\n$$ \\mathbf{s}^{\\text{tr}} = \\boldsymbol{\\sigma}^{\\text{tr}} - p^{\\text{tr}}\\mathbf{I} $$\n$$ q^{\\text{tr}} = \\sqrt{\\frac{3}{2}\\mathbf{s}^{\\text{tr}}:\\mathbf{s}^{\\text{tr}}} = \\sqrt{\\frac{3}{2}\\left((s_{xx}^{\\text{tr}})^2 + (s_{yy}^{\\text{tr}})^2 + (s_{zz}^{\\text{tr}})^2 + 2(s_{xy}^{\\text{tr}})^2\\right)} $$\n\n**2.2. Yield Check**\n\nWe evaluate the yield function at the trial state:\n$$ f^{\\text{tr}} = q^{\\text{tr}} + \\beta_{\\phi}p^{\\text{tr}} - k $$\n- If $f^{\\text{tr}} \\leq 0$, the assumption was correct. The step is elastic, and the trial state is the final state: $\\boldsymbol{\\sigma}^{n+1} = \\boldsymbol{\\sigma}^{\\text{tr}}$, so $p^{n+1} = p^{\\text{tr}}$ and $q^{n+1} = q^{\\text{tr}}$.\n- If $f^{\\text{tr}}  0$, the trial state lies outside the yield surface. Plastic deformation occurs, and a correction is required.\n\n**2.3. Plastic Corrector Step**\n\nThe total strain increment is additively decomposed into elastic and plastic parts: $\\Delta\\boldsymbol{\\varepsilon} = \\Delta\\boldsymbol{\\varepsilon}^e + \\Delta\\boldsymbol{\\varepsilon}^p$. The final stress $\\boldsymbol{\\sigma}^{n+1}$ is related to the elastic part of the strain:\n$$ \\boldsymbol{\\sigma}^{n+1} = \\mathbf{C}:\\Delta\\boldsymbol{\\varepsilon}^e = \\mathbf{C}:(\\Delta\\boldsymbol{\\varepsilon} - \\Delta\\boldsymbol{\\varepsilon}^p) = \\boldsymbol{\\sigma}^{\\text{tr}} - \\mathbf{C}:\\Delta\\boldsymbol{\\varepsilon}^p $$\nThe plastic strain increment is governed by the non-associated flow rule, which states that it is proportional to the gradient of the plastic potential $g$:\n$$ \\Delta\\boldsymbol{\\varepsilon}^p = \\Delta\\gamma \\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}} $$\nwhere $\\Delta\\gamma$ is the scalar plastic multiplier. The required gradient is:\n$$ \\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}} = \\frac{\\partial q}{\\partial \\boldsymbol{\\sigma}} + \\beta_{\\psi} \\frac{\\partial p}{\\partial \\boldsymbol{\\sigma}} = \\frac{3}{2q}\\mathbf{s} + \\frac{\\beta_{\\psi}}{3}\\mathbf{I} $$\nThe stress update equations can be decoupled into volumetric and deviatoric parts:\n$$ p^{n+1} = p^{\\text{tr}} - K \\Delta\\varepsilon_v^p $$\n$$ \\mathbf{s}^{n+1} = \\mathbf{s}^{\\text{tr}} - 2G \\Delta\\mathbf{e}^p $$\nThe volumetric plastic strain increment is $\\Delta\\varepsilon_v^p = \\mathrm{tr}(\\Delta\\boldsymbol{\\varepsilon}^p) = \\Delta\\gamma \\mathrm{tr}(\\frac{\\partial g}{\\partial \\boldsymbol{\\sigma}}) = \\Delta\\gamma \\beta_{\\psi}$. The deviatoric plastic strain increment is $\\Delta\\mathbf{e}^p = \\Delta\\gamma \\frac{3}{2q^{n+1}}\\mathbf{s}^{n+1}$.\nSubstituting these into the update equations:\n$$ p^{n+1} = p^{\\text{tr}} - K \\Delta\\gamma \\beta_{\\psi} $$\n$$ \\mathbf{s}^{n+1} = \\mathbf{s}^{\\text{tr}} - 2G \\left( \\Delta\\gamma \\frac{3}{2q^{n+1}}\\mathbf{s}^{n+1} \\right) = \\mathbf{s}^{\\text{tr}} - 3G\\Delta\\gamma \\frac{\\mathbf{s}^{n+1}}{q^{n+1}} $$\nFrom the deviatoric update, we see that $\\mathbf{s}^{n+1}$ is co-directional with $\\mathbf{s}^{\\text{tr}}$, which implies $\\frac{\\mathbf{s}^{n+1}}{q^{n+1}} = \\frac{\\mathbf{s}^{\\text{tr}}}{q^{\\text{tr}}}$. Taking the magnitude of the deviatoric update (scaled by $\\sqrt{3/2}$) yields:\n$$ q^{n+1} = q^{\\text{tr}} - 3G\\Delta\\gamma $$\nWe have two equations for $p^{n+1}$ and $q^{n+1}$ in terms of one unknown, $\\Delta\\gamma$. The final piece is the consistency condition, which demands that the final stress state lies on the yield surface: $f(\\boldsymbol{\\sigma}^{n+1}) = 0$.\n$$ q^{n+1} + \\beta_{\\phi}p^{n+1} - k = 0 $$\nSubstituting the expressions for $p^{n+1}$ and $q^{n+1}$:\n$$ (q^{\\text{tr}} - 3G\\Delta\\gamma) + \\beta_{\\phi}(p^{\\text{tr}} - K\\Delta\\gamma\\beta_{\\psi}) - k = 0 $$\nRearranging to solve for $\\Delta\\gamma$:\n$$ (q^{\\text{tr}} + \\beta_{\\phi}p^{\\text{tr}} - k) - \\Delta\\gamma(3G + K\\beta_{\\phi}\\beta_{\\psi}) = 0 $$\n$$ f^{\\text{tr}} = \\Delta\\gamma(3G + K\\beta_{\\phi}\\beta_{\\psi}) $$\nThis gives the explicit expression for the plastic multiplier:\n$$ \\Delta\\gamma = \\frac{f^{\\text{tr}}}{3G + K\\beta_{\\phi}\\beta_{\\psi}} $$\nWith $\\Delta\\gamma$ known, the final stress invariants are calculated:\n$$ p^{n+1} = p^{\\text{tr}} - K \\Delta\\gamma \\beta_{\\psi} $$\n$$ q^{n+1} = q^{\\text{tr}} - 3G\\Delta\\gamma $$\nThis completes the derivation of the return-mapping algorithm. The non-associated nature of the flow ($\\psi \\neq \\phi$) introduces the term $K\\beta_{\\phi}\\beta_{\\psi}$ in the denominator for $\\Delta\\gamma$ and, crucially, couples the volumetric stress update to the deviatoric yielding through the term $K \\Delta\\gamma \\beta_{\\psi}$. If the flow were associated ($\\psi = \\phi$), this coupling term would be $K\\beta_{\\phi}^2$. If dilatancy is zero ($\\psi=0$), then $\\beta_{\\psi}=0$, and the mean stress is not corrected ($p^{n+1} = p^{\\text{tr}}$).",
            "answer": "```python\nimport numpy as np\n\ndef solve():\n    \"\"\"\n    Main function to execute the test suite for the Drucker-Prager\n    return-mapping algorithm.\n    \"\"\"\n\n    test_cases = [\n        # Case A (elastic baseline)\n        (30e9, 0.25, 20.0, 0.0, 20e6, 1e-6, 1e-6, 0.0),\n        # Case B (plastic with dilatancy)\n        (30e9, 0.25, 30.0, 10.0, 1e6, 1e-4, -1e-4, 2e-4),\n        # Case C (cohesionless, zero dilatancy, pure shear)\n        (70e9, 0.33, 35.0, 0.0, 0.0, 0.0, 0.0, 5e-4),\n        # Case D (near-yield mixed loading)\n        (30e9, 0.25, 25.0, 5.0, 2e6, 5e-6, -5e-6, 1e-5),\n    ]\n\n    results = []\n    for case in test_cases:\n        p_n1, q_n1 = compute_stress_update(*case)\n        results.append([p_n1, q_n1])\n\n    # Format the final output as specified\n    formatted_results = \",\".join(map(str, results))\n    print(f\"[{formatted_results}]\")\n\ndef compute_stress_update(E, nu, phi_deg, psi_deg, c, deps_xx, deps_yy, dgamma_xy):\n    \"\"\"\n    Implements the return-mapping algorithm for a non-associated\n    Drucker-Prager model under plane strain.\n\n    Args:\n        E (float): Young's modulus (Pa)\n        nu (float): Poisson's ratio\n        phi_deg (float): Friction angle (degrees)\n        psi_deg (float): Dilatancy angle (degrees)\n        c (float): Cohesion (Pa)\n        deps_xx (float): Normal strain increment in x\n        deps_yy (float): Normal strain increment in y\n        dgamma_xy (float): Engineering shear strain increment in xy\n\n    Returns:\n        tuple[float, float]: Updated mean stress p and equivalent stress q.\n    \"\"\"\n    # 1. Convert angles to radians\n    phi = np.radians(phi_deg)\n    psi = np.radians(psi_deg)\n\n    # 2. Calculate elastic moduli\n    G = E / (2.0 * (1.0 + nu))\n    K = E / (3.0 * (1.0 - 2.0 * nu))\n    # Lamé's first parameter\n    lmbda = K - 2.0 * G / 3.0\n\n    # 3. Calculate Drucker-Prager material parameters\n    sin_phi = np.sin(phi)\n    cos_phi = np.cos(phi)\n    \n    # Handle denominator close to zero for small angles (not an issue here)\n    den_phi = 3.0 - sin_phi\n    beta_phi = (6.0 * sin_phi) / den_phi\n    k = (6.0 * c * cos_phi) / den_phi\n\n    sin_psi = np.sin(psi)\n    den_psi = 3.0 - sin_psi\n    beta_psi = (6.0 * sin_psi) / den_psi if psi  1e-9 else 0.0\n\n    # 4. Form elastic trial state from strain increment\n    # Strain increment tensor components (plane strain condition)\n    deps_zz = 0.0\n    deps_xy = 0.5 * dgamma_xy\n    \n    # Volumetric strain increment\n    deps_vol = deps_xx + deps_yy + deps_zz\n\n    # Trial stress tensor components (initial stress is zero)\n    sigma_xx_tr = 2.0 * G * deps_xx + lmbda * deps_vol\n    sigma_yy_tr = 2.0 * G * deps_yy + lmbda * deps_vol\n    sigma_zz_tr = lmbda * deps_vol\n    sigma_xy_tr = G * dgamma_xy\n    \n    # Trial stress invariants\n    p_tr = (sigma_xx_tr + sigma_yy_tr + sigma_zz_tr) / 3.0\n\n    # Trial deviatoric stress components\n    s_xx_tr = sigma_xx_tr - p_tr\n    s_yy_tr = sigma_yy_tr - p_tr\n    s_zz_tr = sigma_zz_tr - p_tr\n    s_xy_tr = sigma_xy_tr\n\n    # Second invariant of trial deviatoric stress\n    J2_tr = 0.5 * (s_xx_tr**2 + s_yy_tr**2 + s_zz_tr**2 + 2.0 * s_xy_tr**2)\n    # Trial equivalent stress\n    q_tr = np.sqrt(3.0 * J2_tr)\n\n    # 5. Evaluate yield function at trial state\n    f_tr = q_tr + beta_phi * p_tr - k\n\n    # 6. Check for plasticity and apply correction if needed\n    if f_tr = 1e-9:  # Using a small tolerance for floating point comparisons\n        # Elastic response\n        p_n1 = p_tr\n        q_n1 = q_tr\n    else:\n        # Plastic response: apply return-mapping\n        denominator = 3.0 * G + K * beta_phi * beta_psi\n        \n        # Scalar plastic multiplier\n        d_gamma = f_tr / denominator\n        \n        # Update stress invariants\n        p_n1 = p_tr - K * d_gamma * beta_psi\n        q_n1 = q_tr - 3.0 * G * d_gamma\n\n    return p_n1, q_n1\n\nif __name__ == \"__main__\":\n    solve()\n\n```"
        },
        {
            "introduction": "This final practice advances to a key challenge in computational geophysics: implementing models with non-smooth yield surfaces. You will develop a return-mapping strategy for the Mohr-Coulomb model, which, unlike the smooth Drucker-Prager criterion, features edges and an apex in principal stress space. This exercise  develops the sophisticated logic required to handle these geometric singularities, a vital skill for accurately simulating the behavior of frictional materials like soils and rocks.",
            "id": "3588544",
            "problem": "You are tasked with deriving and implementing an apex/edge return mapping strategy for the Mohr-Coulomb (MC) elasto-plastic model under small-strain, isotropic elasticity in three dimensions, with compression taken as positive. The implementation must decide, for a given elastic trial state, whether the plastic correction targets a face, an edge, or the apex of the Mohr-Coulomb yield surface in principal stress space, and then compute the corresponding corrected principal stresses. Your final program must produce numerical outputs for a specified test suite.\n\nStart from the following fundamental bases:\n\n- The Cauchy stress tensor has principal values denoted by $\\sigma_1 \\ge \\sigma_2 \\ge \\sigma_3$.\n- Linear isotropic elasticity relates stress increments and strain increments through Hooke’s law, with bulk modulus $K$ and shear modulus $G$. The fourth-order elasticity tensor $\\mathsf{C}$ maps any symmetric second-order tensor $\\mathsf{A}$ as\n$$\\mathsf{C}:\\mathsf{A} = 3K\\frac{\\mathrm{tr}(\\mathsf{A})}{3}\\mathsf{I} + 2G\\left(\\mathsf{A}-\\frac{\\mathrm{tr}(\\mathsf{A})}{3}\\mathsf{I}\\right),$$\nwhere $\\mathsf{I}$ is the identity tensor and $\\mathrm{tr}(\\cdot)$ denotes the trace.\n- The Mohr-Coulomb yield condition, expressed on the planes associated with ordered principal stresses, is piecewise-linear. For faces formed by pairs of principal stresses, define the three face functions:\n$$\nf_{12} = (1-\\sin\\varphi)\\sigma_1 - (1+\\sin\\varphi)\\sigma_2 - 2c\\cos\\varphi, \\\\\nf_{13} = (1-\\sin\\varphi)\\sigma_1 - (1+\\sin\\varphi)\\sigma_3 - 2c\\cos\\varphi, \\\\\nf_{23} = (1-\\sin\\varphi)\\sigma_2 - (1+\\sin\\varphi)\\sigma_3 - 2c\\cos\\varphi,\n$$\nwhere $\\varphi$ is the friction angle and $c$ is the cohesion. A trial state violates a face when the corresponding $f_{ij} > 0$. The intersection of two violated faces defines an edge, and the intersection of all three violated faces defines the apex.\n- Adopt a plastic potential of Mohr-Coulomb type with dilation angle $\\psi$ (generally different from $\\varphi$). For each face, the gradient of the plastic potential with respect to the principal stresses provides the flow direction. Define\n$$\na_p = 1-\\sin\\psi, \\qquad b_p = 1+\\sin\\psi,\n$$\nand the plastic potential gradients (face flow normals) in principal stress coordinates as\n$$\n\\mathbf{n}^{12} = \\begin{bmatrix} a_p\\\\ -b_p\\\\ 0\\end{bmatrix}, \\qquad\n\\mathbf{n}^{13} = \\begin{bmatrix} a_p\\\\ 0\\\\ -b_p\\end{bmatrix}, \\qquad\n\\mathbf{n}^{23} = \\begin{bmatrix} 0\\\\ a_p\\\\ -b_p\\end{bmatrix}.\n$$\nUnder isotropic elasticity, the stress correction induced by a plastic multiplier $\\lambda$ in direction $\\mathbf{n}$ is\n$$\n\\Delta\\boldsymbol{\\sigma} = -\\lambda(\\mathsf{C}:\\mathbf{n}),\n$$\nwhich, in principal components, yields a vector $\\mathbf{v}$ with components\n$$\nv_i = K\\,\\mathrm{tr}(\\mathbf{n}) + 2G\\left(n_i - \\frac{\\mathrm{tr}(\\mathbf{n})}{3}\\right), \\qquad i\\in\\{1,2,3\\}.\n$$\nThus a single-face return produces\n$$\n\\sigma_i = \\sigma_i^{\\mathrm{tr}} - \\lambda v_i,\n$$\nfor $i\\in\\{1,2,3\\}$, where $\\sigma_i^{\\mathrm{tr}}$ are the trial principal stresses. For edges, use two plastic multipliers along the two corresponding flow normals; for the apex, use three plastic multipliers, one per face. In all cases, impose the consistency conditions that the active faces satisfy their yield equations at the corrected stress, and enforce non-negativity of plastic multipliers.\n\nYour implementation must:\n\n1. Sort the trial principal stresses so that $\\sigma_1^{\\mathrm{tr}} \\ge \\sigma_2^{\\mathrm{tr}} \\ge \\sigma_3^{\\mathrm{tr}}$. Use these sorted values to evaluate $f_{12}, f_{13}, f_{23}$ and to perform the return mapping.\n2. Decide the target region:\n   - Face return when exactly one $f_{ij} > 0$.\n   - Edge return when exactly two $f_{ij} > 0$.\n   - Apex return when all three $f_{ij} > 0$.\n   - Elastic if none $f_{ij} > 0$.\n3. For face return, solve a single linear consistency equation for $\\lambda$. For edge return, set up a $2 \\times 2$ linear system for the two plastic multipliers. For apex return, set up a $3 \\times 3$ linear system. If any plastic multiplier from the solution is negative, adjust the active set by removing the corresponding face and re-solve with the reduced set. If the reduced set becomes empty, the state is elastic.\n4. Output the corrected principal stresses in the same sorted order used by the algorithm, and a numeric code indicating the region targeted by the return mapping:\n   - $0$: elastic,\n   - $1$: face $12$,\n   - $2$: face $13$,\n   - $3$: face $23$,\n   - $4$: edge $12$-$13$,\n   - $5$: edge $12$-$23$,\n   - $6$: edge $13$-$23$,\n   - $7$: apex.\n\nAngle unit specification: Use degrees for $\\varphi$ and $\\psi$ in all inputs. Physical unit specification: All internal calculations must use Pascals ($\\mathrm{Pa}$). Your program must print corrected principal stresses in megapascals ($\\mathrm{MPa}$), rounded to three decimal places.\n\nTest Suite and Required Final Output Format:\n\nUse material parameters $K=30 \\times 10^9\\,\\mathrm{Pa}$, $G=10 \\times 10^9\\,\\mathrm{Pa}$, $\\varphi=30^\\circ$, $\\psi=5^\\circ$, $c=10 \\times 10^6\\,\\mathrm{Pa}$. Evaluate the following five elastic trial states (each provided as a list of the three principal stresses in Pascals):\n\n- Case $1$: $[100 \\times 10^6, 80 \\times 10^6, 20 \\times 10^6]$\n- Case $2$: $[250 \\times 10^6, 20 \\times 10^6, 50 \\times 10^6]$\n- Case $3$: $[-50 \\times 10^6, -50 \\times 10^6, -50 \\times 10^6]$\n- Case $4$: $[30 \\times 10^6, 28 \\times 10^6, 25 \\times 10^6]$\n- Case $5$: $[64.641016 \\times 10^6, 30 \\times 10^6, 10 \\times 10^6]$ which lies exactly on the face $13$ for the specified $\\varphi$ and $c$.\n\nYour program should produce a single line of output containing the results as a comma-separated list enclosed in square brackets, where each result is itself a list of four numbers $[\\sigma_1^{\\mathrm{corr}},\\sigma_2^{\\mathrm{corr}},\\sigma_3^{\\mathrm{corr}},\\text{code}]$ with stresses in megapascals. For example, the final print should look like\n$[[\\sigma_{1,1}, \\sigma_{2,1}, \\sigma_{3,1}, \\text{code}_1], [\\sigma_{1,2}, \\sigma_{2,2}, \\sigma_{3,2}, \\text{code}_2], \\dots]$\nwith no additional text.",
            "solution": "The problem statement is assessed to be valid. It is scientifically grounded in the principles of continuum mechanics and elasto-plasticity, well-posed with a clear algorithmic path to a unique solution, and formally objective. All necessary constitutive laws, material parameters, and boundary conditions (in the form of trial stress states) are provided. The problem constitutes a standard, non-trivial exercise in computational geomechanics. We may therefore proceed with the derivation and implementation of the solution.\n\nThe core of the problem is to implement a return mapping algorithm for a multi-surface Mohr-Coulomb yield criterion. This involves identifying which yield criteria are violated by an elastic trial stress state and then calculating the necessary plastic strain to return the stress state to the appropriate region of the yield surface (a face, an edge, or the apex).\n\nFirst, we define the material and model constants from the given parameters: friction angle $\\varphi$, dilation angle $\\psi$, and cohesion $c$. The angles must be converted to radians for use in trigonometric functions. We define two sets of coefficients, one for the yield function ($f$) and one for the plastic potential ($g$).\nFor the yield function:\n$$ a_y = 1 - \\sin\\varphi,\\quad b_y = 1 + \\sin\\varphi,\\quad c_y = 2c\\cos\\varphi $$\nFor the plastic potential (flow rule):\n$$ a_p = 1 - \\sin\\psi,\\quad b_p = 1 + \\sin\\psi $$\nThe three yield functions for the principal stresses, sorted as $\\sigma_1 \\ge \\sigma_2 \\ge \\sigma_3$, are:\n$$\nf_{12}(\\boldsymbol{\\sigma}) = a_y\\sigma_1 - b_y\\sigma_2 - c_y \\\\\nf_{13}(\\boldsymbol{\\sigma}) = a_y\\sigma_1 - b_y\\sigma_3 - c_y \\\\\nf_{23}(\\boldsymbol{\\sigma}) = a_y\\sigma_2 - b_y\\sigma_3 - c_y\n$$\nA plastic state occurs if any $f_{ij}  0$. The plastic flow rule is non-associated, meaning the plastic potential function $g$ has a different functional form from $f$, achieved by using $\\psi$ instead of $\\varphi$. The gradients of the plastic potential functions $g_{12}$, $g_{13}$, and $g_{23}$ with respect to the principal stresses give the plastic flow direction vectors (normals):\n$$\n\\mathbf{n}^{12} = \\frac{\\partial g_{12}}{\\partial \\boldsymbol{\\sigma}} = \\begin{bmatrix} a_p \\\\ -b_p \\\\ 0 \\end{bmatrix}, \\quad\n\\mathbf{n}^{13} = \\frac{\\partial g_{13}}{\\partial \\boldsymbol{\\sigma}} = \\begin{bmatrix} a_p \\\\ 0 \\\\ -b_p \\end{bmatrix}, \\quad\n\\mathbf{n}^{23} = \\frac{\\partial g_{23}}{\\partial \\boldsymbol{\\sigma}} = \\begin{bmatrix} 0 \\\\ a_p \\\\ -b_p \\end{bmatrix}\n$$\nThe stress update is given by the elasto-plastic decomposition. The total strain increment is decomposed into an elastic and a plastic part, $\\Delta\\boldsymbol{\\varepsilon} = \\Delta\\boldsymbol{\\varepsilon}^e + \\Delta\\boldsymbol{\\varepsilon}^p$. The stress increment is purely elastic, $\\Delta\\boldsymbol{\\sigma} = \\mathsf{C}:\\Delta\\boldsymbol{\\varepsilon}^e = \\mathsf{C}:(\\Delta\\boldsymbol{\\varepsilon} - \\Delta\\boldsymbol{\\varepsilon}^p)$. The plastic strain increment is given by the flow rule, $\\Delta\\boldsymbol{\\varepsilon}^p = \\sum_k \\lambda_k \\mathbf{n}^k$, where $\\lambda_k \\ge 0$ are plastic multipliers for each active yield surface $k$.\nAssuming an elastic trial step, the corrected stress $\\boldsymbol{\\sigma}$ is related to the trial stress $\\boldsymbol{\\sigma}^{\\mathrm{tr}}$ by:\n$$ \\boldsymbol{\\sigma} = \\boldsymbol{\\sigma}^{\\mathrm{tr}} - \\mathsf{C}:\\Delta\\boldsymbol{\\varepsilon}^p = \\boldsymbol{\\sigma}^{\\mathrm{tr}} - \\sum_k \\lambda_k (\\mathsf{C}:\\mathbf{n}^k) $$\nLet's define the vectors $\\mathbf{v}^k = \\mathsf{C}:\\mathbf{n}^k$. In principal stress space, for an isotropic elastic material with bulk modulus $K$ and shear modulus $G$, the components of $\\mathbf{v}^k$ corresponding to a normal $\\mathbf{n}^k$ are:\n$$ v_i^k = K\\,\\mathrm{tr}(\\mathbf{n}^k) + 2G\\left(n_i^k - \\frac{\\mathrm{tr}(\\mathbf{n}^k)}{3}\\right) $$\nThe corrected stress vector is then $\\boldsymbol{\\sigma} = \\boldsymbol{\\sigma}^{\\mathrm{tr}} - \\sum_k \\lambda_k \\mathbf{v}^k$.\nThe plastic multipliers $\\lambda_k$ are determined by the consistency condition, which states that for each active yield surface $j$, the final stress state must lie on it, i.e., $f_j(\\boldsymbol{\\sigma}) = 0$.\n$$ f_j(\\boldsymbol{\\sigma}^{\\mathrm{tr}} - \\sum_k \\lambda_k \\mathbf{v}^k) = 0 $$\nDue to the linearity of the yield functions, this becomes:\n$$ f_j(\\boldsymbol{\\sigma}^{\\mathrm{tr}}) - \\sum_k \\lambda_k f_j(\\mathbf{v}^k) = 0 $$\nThis forms a system of linear equations for the unknown multipliers $\\boldsymbol{\\lambda}$:\n$$ \\mathbf{A}\\boldsymbol{\\lambda} = \\mathbf{b} $$\nwhere $b_j = f_j(\\boldsymbol{\\sigma}^{\\mathrm{tr}})$ and $A_{jk} = f_j(\\mathbf{v}^k)$. The indices $j$ and $k$ span the set of active yield surfaces.\n\nThe algorithm proceeds as follows:\n1.  For a given trial stress vector $\\boldsymbol{\\sigma}^{\\mathrm{tr,raw}}$, sort its components in descending order to get $\\boldsymbol{\\sigma}^{\\mathrm{tr}} = [\\sigma_1^{\\mathrm{tr}}, \\sigma_2^{\\mathrm{tr}}, \\sigma_3^{\\mathrm{tr}}]$.\n2.  Calculate the values of the three yield functions, $f_{12}(\\boldsymbol{\\sigma}^{\\mathrm{tr}}), f_{13}(\\boldsymbol{\\sigma}^{\\mathrm{tr}}), f_{23}(\\boldsymbol{\\sigma}^{\\mathrm{tr}})$.\n3.  Compile an initial \"active set\" of yield surfaces for which $f_{ij}  0$.\n4.  If the active set is empty, the state is elastic, and no correction is needed. $\\boldsymbol{\\sigma}^{\\mathrm{corr}} = \\boldsymbol{\\sigma}^{\\mathrm{tr}}$.\n5.  If the active set is not empty, construct the linear system $\\mathbf{A}\\boldsymbol{\\lambda} = \\mathbf{b}$ using the corresponding functions and vectors for the active set.\n6.  Solve the system for $\\boldsymbol{\\lambda}$.\n7.  Check the signs of the computed multipliers. If all $\\lambda_k \\ge 0$, the active set is correct. The stress correction is $\\Delta\\boldsymbol{\\sigma} = \\sum_k \\lambda_k \\mathbf{v}^k$, and the final corrected stress is $\\boldsymbol{\\sigma}^{\\mathrm{corr}} = \\boldsymbol{\\sigma}^{\\mathrm{tr}} - \\Delta\\boldsymbol{\\sigma}$. The process terminates.\n8.  If any $\\lambda_k  0$, it signifies that the corresponding yield surface should not be active. The standard procedure is to remove the constraint associated with the most negative multiplier from the active set and repeat from step 5 with the reduced system. This iterative process continues until a set of non-negative multipliers is found. The case where the active set becomes empty means the trial stress was in a region that maps back to the elastic domain, making the state elastic.\n\nFinally, a numerical code is determined based on the final active set that yielded the valid solution. The corrected principal stresses are then converted to megapascals ($\\mathrm{MPa}$) and rounded.\n- Active set empty: code $0$ (elastic)\n- $\\{12\\}$: code $1$ (face 12)\n- $\\{13\\}$: code $2$ (face 13)\n- $\\{23\\}$: code $3$ (face 23)\n- $\\{12, 13\\}$: code $4$ (edge 12-13)\n- $\\{12, 23\\}$: code $5$ (edge 12-23)\n- $\\{13, 23\\}$: code $6$ (edge 13-23)\n- $\\{12, 13, 23\\}$: code $7$ (apex)\n\nThis completes the theoretical framework for the implementation.",
            "answer": "```python\n# The complete and runnable Python 3 code goes here.\n# Imports must adhere to the specified execution environment.\nimport numpy as np\nfrom scipy.linalg import solve as solve_linear_system\n\ndef solve():\n    \"\"\"\n    Derives and implements an apex/edge return mapping strategy for the\n    Mohr-Coulomb elasto-plastic model.\n    \"\"\"\n    # Define material parameters and test cases\n    K = 30.0e9  # Bulk modulus in Pa\n    G = 10.0e9  # Shear modulus in Pa\n    phi_deg = 30.0  # Friction angle in degrees\n    psi_deg = 5.0  # Dilation angle in degrees\n    c = 10.0e6  # Cohesion in Pa\n    \n    test_cases = [\n        [100e6, 80e6, 20e6],\n        [250e6, 20e6, 50e6],\n        [-50e6, -50e6, -50e6],\n        [30e6, 28e6, 25e6],\n        [64.641016e6, 30e6, 10e6]\n    ]\n\n    # Pre-compute material constants\n    phi_rad = np.deg2rad(phi_deg)\n    psi_rad = np.deg2rad(psi_deg)\n    sin_phi = np.sin(phi_rad)\n    cos_phi = np.cos(phi_rad)\n    sin_psi = np.sin(psi_rad)\n    \n    a_y = 1.0 - sin_phi\n    b_y = 1.0 + sin_phi\n    c_y = 2.0 * c * cos_phi\n    \n    a_p = 1.0 - sin_psi\n    b_p = 1.0 + sin_psi\n\n    # Flow normals (as rows in a matrix for easier access)\n    # 0: n12, 1: n13, 2: n23\n    n_matrix = np.array([\n        [a_p, -b_p, 0.0],\n        [a_p, 0.0, -b_p],\n        [0.0, a_p, -b_p]\n    ])\n\n    # Stress correction vectors v = C:n\n    # v_vectors[i] corresponds to n_matrix[i]\n    v_vectors = np.zeros((3, 3))\n    for i in range(3):\n        n = n_matrix[i, :]\n        tr_n = np.sum(n)\n        for j in range(3):\n            v_vectors[i, j] = K * tr_n + 2 * G * (n[j] - tr_n / 3.0)\n\n    # Yield function definitions (coefficients for [s1, s2, s3])\n    # 0: f12, 1: f13, 2: f23\n    yield_coeffs = np.array([\n        [a_y, -b_y, 0.0],\n        [a_y, 0.0, -b_y],\n        [0.0, a_y, -b_y]\n    ])\n\n    # System matrix A where A[i, j] = f_i(v_j)\n    A_full = np.zeros((3, 3))\n    for i in range(3):  # Yield function index\n        for j in range(3):  # Flow normal index\n            A_full[i, j] = np.dot(yield_coeffs[i, :], v_vectors[j, :])\n\n    # Map from final active set (as sorted tuple) to output code\n    code_map = {\n        (): 0, (0,): 1, (1,): 2, (2,): 3,\n        (0, 1): 4, (0, 2): 5, (1, 2): 6,\n        (0, 1, 2): 7\n    }\n\n    results = []\n    TOL = 1e-9 # Tolerance for floating point comparisons\n\n    for sigma_tr_raw in test_cases:\n        # 1. Sort trial stresses: sigma_1 = sigma_2 = sigma_3\n        sigma_tr = np.sort(np.array(sigma_tr_raw))[::-1]\n        \n        # 2. Evaluate yield functions\n        f_tr = yield_coeffs @ sigma_tr - c_y\n        \n        # 3. Determine initial active set\n        active_set = [i for i, f_val in enumerate(f_tr) if f_val  TOL]\n        \n        if not active_set:\n            final_sigma = sigma_tr\n            code = 0\n        else:\n            # 4. Iterative solver for plastic multipliers\n            current_active_set = list(active_set)\n            while True:\n                n_active = len(current_active_set)\n                if n_active == 0:\n                    # All constraints removed, falls back to elastic\n                    final_sigma = sigma_tr\n                    break\n\n                # Build linear system for current active set\n                A_sub = A_full[np.ix_(current_active_set, current_active_set)]\n                b_sub = f_tr[current_active_set]\n                \n                # Solve for lambdas\n                lambdas = solve_linear_system(A_sub, b_sub)\n                \n                # Check sign of lambdas. If all are non-negative, solution is found.\n                if np.all(lambdas = -TOL):\n                    delta_sigma = np.zeros(3)\n                    for i, face_idx in enumerate(current_active_set):\n                        delta_sigma += lambdas[i] * v_vectors[face_idx, :]\n                    \n                    final_sigma = sigma_tr - delta_sigma\n                    break\n                else:\n                    # Remove constraint with the most negative multiplier\n                    min_lambda_idx = np.argmin(lambdas)\n                    current_active_set.pop(min_lambda_idx)\n            \n            # Determine code from the final valid active set\n            final_active_key = tuple(sorted(current_active_set))\n            code = code_map[final_active_key]\n\n        # 5. Format and store result\n        # Convert stresses to MPa and round to 3 decimal places\n        final_sigma_mpa = np.round(final_sigma / 1e6, 3)\n        results.append([*final_sigma_mpa, code])\n\n    # Final print statement in the exact required format\n    formatted_results = []\n    for res in results:\n        s_vals = res[:3]\n        code = res[3]\n        # Create strings for each float value\n        s_strs = [f\"{s:.3f}\" for s in s_vals]\n        # Re-form the string to ensure no spaces and exact format\n        formatted_results.append(f\"[{','.join(s_strs)},{code}]\")\n    print(f\"[{','.join(formatted_results)}]\")\n\nsolve()\n```"
        }
    ]
}