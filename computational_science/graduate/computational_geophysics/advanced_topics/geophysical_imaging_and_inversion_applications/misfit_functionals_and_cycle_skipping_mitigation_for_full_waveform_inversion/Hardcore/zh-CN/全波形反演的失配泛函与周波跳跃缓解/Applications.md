## 应用与跨学科联系

在前面的章节中，我们已经系统地探讨了[全波形反演](@entry_id:749622)（FWI）中[失配泛函](@entry_id:752011)的基本原理和机制，特别是标准 $L^2$ 范数[失配泛函](@entry_id:752011)的非凸性如何导致[周期跳跃](@entry_id:748134)问题，以及为缓解这一问题而设计的各种替代[失配泛函](@entry_id:752011)。理论的价值最终体现在其应用之中。本章的宗旨在于，展示这些核心原理如何在多样的、真实的以及跨学科的背景下被应用、扩展和整合，从而解决实际的科学与工程挑战。

我们将探索如何基于这些原理来设计高效的反演策略，深入剖析高级[失配泛函](@entry_id:752011)的设计哲学，并揭示 FWI 与地球物理学其他分支（如[地震成像](@entry_id:273056)、[重力学](@entry_id:196007)、地震干涉学）之间的深刻联系。最后，我们还将展示这些思想如何超越地球物理学的边界，在[医学超声](@entry_id:270486)成像等其他波形成像领域中找到用武之地。通过这些应用实例，我们希望读者能够认识到，为解决 FWI 非凸性问题而发展出的理论与方法，不仅是[地球物理学](@entry_id:147342)工具箱中的重要组成部分，更是一套具有广泛适用性的、处理波反演问题的通用思想体系。

### FWI 反演中的策略设计

将理论转化为成功的反演结果，需要精心的策略设计。其中，如何根据[模型误差](@entry_id:175815)和数据特性来规划反演流程，以及如何处理现实世界中普遍存在的震源未知问题，是两个至关重要的环节。

#### 多尺度策略与频率优选

[周期跳跃](@entry_id:748134)问题的核心在于初始模型的运动学误差（即走时误差）超出了所用频率的半个周期。这一原理直接催生了 FWI 中最基本也最重要的策略——[多尺度反演](@entry_id:752259)（multiscale inversion）。该策略的核心思想是“由简入繁，由大到小”，即从低频成分开始反演，逐步引入高频成分。

低频波形具有更长的波长，使得[失配泛函](@entry_id:752011)的形态更为平滑，拥有更宽广的“凸”盆，从而能够容忍更大的初始模型误差。一个被广泛接受的准则是，为了避免[周期跳跃](@entry_id:748134)，初始模型数据与观测数据之间的最大走时误差 $|\delta t|$ 必须满足 $|\delta t| \lt T/2$，其中 $T$ 是所用频率分量中的最低频率 $f_{\min}$ 对应的周期，即 $|\delta t| \lt 1/(2f_{\min})$。因此，一个成功的 FWI 工作流设计，必须首先估计初始模型的误差水平，并据此选择一个足够低的起始频率 $f_{\min}$ 来保证反演的初步收敛。例如，若估计最大走时误差约为 $0.1$ 秒，则起始频率必须显著低于 $1/(2 \times 0.1) = 5\,\text{Hz}$，选择 $2$ 或 $3\,\text{Hz}$ 作为起点将是安全的选择。若贸然从 $5\,\text{Hz}$ 或更高频率开始，反演将极有可能从一开始就陷入[周期跳跃](@entry_id:748134)的陷阱，收敛到一个错误的局部极小值。当低频反演已经校正了模型的大尺度（长波长）结构，减小了走时误差后，再逐步引入更高频率的数据，以刻画更精细的细节 。

这种多尺度思想可以被进一步量化，以设计自动化的频率递增策略。假设在反演的每个阶段，通过使用更鲁棒的[失配泛函](@entry_id:752011)（如后文将讨论的基于相关或最优传输的[失配泛函](@entry_id:752011)）可以使最大走时误差减小一个固定的[比例因子](@entry_id:266678) $r$（例如 $r=0.5$）。那么，在第 $k$ 阶段，最大走时误差为 $|\Delta t_k|$，允许使用的最高频率为 $f_k \approx 1/(2|\Delta t_k|)$。进入下一阶段后，误差变为 $|\Delta t_{k+1}| = r |\Delta t_k|$，此时允许的最高频率则变为 $f_{k+1} \approx 1/(2|\Delta t_{k+1}|) = (1/r) f_k$。若每次误差减半（$r=0.5$），则频率便可以加倍。基于此，我们可以根据初始误差计算出起始频率 $f_0$，并设计一个[指数增长](@entry_id:141869)的频率序列 $\{f_0, 2f_0, 4f_0, \dots\}$，直至达到目标频带上限。这为 FWI 的自动化和流程化提供了理论依据 。

#### 目标函数工程：处理未知震源与[数据失配](@entry_id:748209)

在实际应用中，除了模型本身，其他因素如未知的震源子波和复杂的数据误差也会使[失配泛函](@entry_id:752011)复杂化。目标函数工程（Objective function engineering）通过扩展[优化问题](@entry_id:266749)，将这些“滋扰”因素作为额外变量进行[联合反演](@entry_id:750950)，从而净化[失配泛函](@entry_id:752011)，使其对模型参数的依赖关系更为良好。

一个典型的例子是处理未知的震源子波。在[频域](@entry_id:160070)中，预测数据可以表示为 $d_{\text{pred}}(m, w; \omega) = S(m; \omega) w(\omega)$，其中 $S(m; \omega)$ 是模型 $m$ 对[单位脉冲](@entry_id:272155)的响应，而 $w(\omega)$ 是未知的震源子波。与其固定一个可能不准确的 $w(\omega)$，不如在每个模型更新步骤中，将其视为一个待求的 nuisance parameter（滋扰参数）。通过变量[投影法](@entry_id:144836)（variable-projection method），可以在每个频率独立地解析求解出能使当前模型 $S(m; \omega)$ 与观测数据 $d_{\text{obs}}(\omega)$ 之间 $L^2$ 误差最小的最优子波 $w_{\star}(m; \omega)$。几何上，这等价于将观测数据向量 $d_{\text{obs}}$ 正交投影到由模型响应向量 $S(m)$ 张成的[子空间](@entry_id:150286)上。代入 $w_{\star}$ 后的归约[失配泛函](@entry_id:752011)，度量的不再是原始波形的差异，而是观测数据中无法被当前模型响应（无论如何进行线性的振幅和相位调整）所解释的“正交分量”的大小。由于 $w(\omega)$ 是复数，这种方法同时校正了频率相关的振幅和相位，极大地放宽了对初始模型的要求，使失配景观对模型参数 $m$ 变得更平滑，从而有效缓解[周期跳跃](@entry_id:748134)。根据 Golub-Pereyra 定理，计算这个归约[失配泛函](@entry_id:752011)的梯度时，包含了 $\partial w_{\star} / \partial m$ 的[链式法则](@entry_id:190743)项会自然消失，这使得梯度计算得以简化 。

自适应波形反演（Adaptive Waveform Inversion, AWI）采用了类似的思想。它在模型数据和观测数据之间引入一个[匹配滤波器](@entry_id:137210) $h(t)$，并将其与模型 $m$ 进行[联合反演](@entry_id:750950)。[目标函数](@entry_id:267263)变为 $\mathcal{J}(m,h) = \frac{1}{2} \| h * s(\cdot; m) - d(\cdot) \|_2^2 + \mathcal{R}_h(h)$。当正则化项 $\mathcal{R}_h(h)$ 的权重很小时，滤波器 $h$ 可以自由地吸收数据之间的相位（运动学）和振幅（动力学）差异。这同样起到了平滑失配景观、扩大收敛盆的作用。当模型逐渐改善后，可以通过增加正则化权重，迫使滤波器 $h$ 趋近于一个狄拉克函数 $\delta(t)$，从而使 AWI 失配最终回归到标准的 $L^2$ 失配，以实现高精度的细节刻画 。

然而，这种[联合反演](@entry_id:750950)策略也引入了新的挑战：参数的唯一性（identifiability）。如果不加约束，滤波器 $h$ 可能会完全“吸收”掉本该由模型 $m$ 更新来解释的运动学信息。例如，一个纯粹的走时误差可以被一个具有[线性相位](@entry_id:274637)的[全通滤波器](@entry_id:199836)完美校正，而模型参数 $m$ 却原地踏步。因此，必须对滤波器 $h$ 施加合理的物理约束来打破这种模糊性。常见的约束包括：强制滤波器为零相位（即 $h(t)$ 为偶函数），或者强力惩罚其[群延迟](@entry_id:267197)，或者在多道数据处理中强制所有道共用同一个滤波器。这些约束确保了滤波器主要用于校正整体的振幅和相位谱，而将随偏移距变化的[运动学](@entry_id:173318)信息留给模型参数 $m$ 来解释，从而保证了反演的物理意义 。

### 高级[失配泛函](@entry_id:752011)的设计与分析

除了改造目标函数，另一条核心路径是直接替换 $L^2$ 范数，设计出对[运动学](@entry_id:173318)误差不那么敏感的新度量方式。

#### 基于相关的[失配泛函](@entry_id:752011)

[互相关](@entry_id:143353)（cross-correlation）是信号处理中衡量相似度的经典方法。基于相关的[失配泛函](@entry_id:752011)旨在最大化预测数据与观测数据之间的[互相关](@entry_id:143353)，而非最小化它们的点对点差异。一个典型的形式是 $J = 1 - \max_{\tau} C(u_r, d_r; \tau)$，其中 $C$ 是归一化[互相关函数](@entry_id:147301)，$\tau$ 是时间延迟。这种形式天然地对走时误差鲁棒，因为它通过搜索最佳延迟 $\tau$ 来主动对齐波形。为了在[基于梯度的优化](@entry_id:169228)框架中使用这类[失配泛函](@entry_id:752011)，必须推导出其伴随源（adjoint source）。应用包络定理（envelope theorem）可以证明，其伴随源不再是简单的波形残差，而是一个更复杂的项，它包括了被最优延迟 $\tau^\star$ 平移后的观测数据，以及一个与预测数据能量有关的投影校正项。这一推导是实现这类经典鲁棒[失配泛函](@entry_id:752011)的关键一步 。

#### 基于属性分离的[失配泛函](@entry_id:752011)

波形可以被分解为不同的物理属性，如振幅和相位。[周期跳跃](@entry_id:748134)主要源于相位的[非线性](@entry_id:637147)。因此，一个有效的设计思路是在[频域](@entry_id:160070)中将振幅和相位（或其导数）分离开，并为它们设计不同的[失配泛函](@entry_id:752011)。一个复合[失配泛函](@entry_id:752011)可以写成如下形式：
$$
\Phi(m) = \int \left[ \alpha w_a(\omega)(A_{\text{syn}}-A_{\text{obs}})^2 + \beta w_g(\omega)(\tau_{\text{syn}}-\tau_{\text{obs}})^2 \right]\,d\omega
$$
这里，$A$ 代表振幅谱，而 $\tau = -\partial_{\omega}\phi$ 是[群延迟](@entry_id:267197)，即相位谱 $\phi(\omega)$ 对频率的负导数。使用群延迟而非原始相位是此方法的精髓。一个恒定的走时误差 $\Delta t$ 在相位上表现为线性项 $-\omega \Delta t$，其 $2\pi$ 缠绕（wrapping）导致了非凸性。然而，它在[群延迟](@entry_id:267197)上表现为一个与频率无关的常数 $\Delta t$。因此，群延迟差异的平方 $(\tau_{\text{syn}}-\tau_{\text{obs}})^2$ 对走时误差 $\Delta t$ 是二次凸的，从而根本上消除了[周期跳跃](@entry_id:748134)的根源。同时，振幅项 $(A_{\text{syn}}-A_{\text{obs}})^2$ 依然能够保证反演结果的动力学特征是正确的。这种方法通过属性分离，巧妙地将非凸的相位匹配问题转化为了凸的[群延迟](@entry_id:267197)[匹配问题](@entry_id:275163) 。

#### 基于波形扭曲的[失配泛函](@entry_id:752011)

波形扭曲（warping）或动态时间扭曲（Dynamic Time Warping, DTW）方法，旨在通过一个[非线性](@entry_id:637147)的时间重参数化函数 $\phi(t)$ 来对齐两个时间序列。其[失配泛函](@entry_id:752011)通常形如：
$$
J(\phi) = \frac{1}{2}\int |u(t)-d(\phi(t))|^2\,dt + \alpha\int |\phi'(t)-1|^2\,dt
$$
第一项度量了扭曲后的波形差异，第二项是正则化项，用于惩罚扭曲函数 $\phi(t)$ 偏离恒等映射（即 $\phi(t)=t$）的程度。正则化参数 $\alpha$ 控制了[数据拟合](@entry_id:149007)与扭曲[函数平滑](@entry_id:201048)性之间的权衡。若 $\alpha$ 过小，$\phi(t)$ 会剧烈[振荡](@entry_id:267781)以实现任意匹配，可能导致非物理的对齐；若 $\alpha$ 过大，$\phi(t)$ 被迫接近于 $t$，[失配泛函](@entry_id:752011)退化为标准的 $L^2$ 范数。合理的选择 $\alpha$ 是为了在允许足够大的走时校正以跳出[局部极小值](@entry_id:143537)的同时，防止产生过度拉伸或压缩等非物理结果 。

然而，一个关键的物理约束是因果性：时间不能倒流，事件的先后顺序不能颠倒。这意味着扭曲函数 $\phi(t)$ 必须是单调非减的，即 $\phi'(t) \ge 0$。任何允许 $\phi'(t)  0$ 的无约束扭曲方法，即便在数学上可能找到一个更小的失配值，其结果也是没有物理意义的。因此，施加单调性约束是 warping 方法在物理应用中的必要条件。此外，真实介质中的[波速](@entry_id:186208)是有限的，这意味着时间扭曲的局部拉伸或压缩程度（即 $\phi'(t)$ 的值）也应该被一个由物理波速上下限决定的范围所约束。这些约束保证了扭曲对齐的物理一致性 。

#### 基于最优传输的[失配泛函](@entry_id:752011)

最优传输（Optimal Transport, OT）理论为比较两个[分布](@entry_id:182848)提供了强大的数学框架。它将[失配泛函](@entry_id:752011)视为将一个[分布](@entry_id:182848)“搬运”成另一个[分布](@entry_id:182848)所需的最小代价。将此思想应用于 FWI 时，需要先将有符号、[振荡](@entry_id:267781)的地震道信号转化为非负的、归一化的“质量”[分布](@entry_id:182848)。一个常用的方法是取信号的包络，然后进行归一化，得到概率密度函数。

当使用二次 Wasserstein 距离 ($W_2^2$) 作为[失配泛函](@entry_id:752011)时，其优越性在于它对整体的时间平移表现出完美的凸性。对于两个仅相差一个[时间平移](@entry_id:261541) $\Delta t$ 的一维[分布](@entry_id:182848)，它们的 $W_2^2$ 距离恰好等于 $(\Delta t)^2$。这与[群延迟](@entry_id:267197)[失配泛函](@entry_id:752011)的效果异曲同工，都将一个高度非凸的[匹配问题](@entry_id:275163)转化为了一个简单的二次型问题，从而极大地扩展了收敛盆。

然而，将信号转化为归一化[概率密度](@entry_id:175496)的过程会丢失所有的振幅信息。这对于需要精确反演振[幅相](@entry_id:269870)关参数（如密度、衰减）的 FWI 是不可接受的。因此，实用的 OT-FWI 方法通常采用复合[失配泛函](@entry_id:752011)，即在 OT 项之外，额外加入惩罚振幅差异的项，例如包络差异的 $L^2$ 范数，或总能量差异的范数。这样既利用了 OT 在[运动学](@entry_id:173318)上的鲁棒性，又保留了对动力学信息的敏感性 。值得一提的是，施加[单调性](@entry_id:143760)约束的 warping 方法与一维 OT 在数学上是紧密相关的，后者天然地保证了映射的[单调性](@entry_id:143760)，是实现物理一致性对齐的理想框架 。

### 与地球物理学其他领域的[交叉](@entry_id:147634)

FWI 及其[失配泛函](@entry_id:752011)理论并非孤立存在，它与[地球物理学](@entry_id:147342)中的其他经典理论和方法有着深刻的内在联系，并能通过联合应用，取长补短，实现更强大的反演能力。

#### FWI 梯度的[波数](@entry_id:172452)分析：连接[层析成像](@entry_id:756051)与偏移成像

FWI 的梯度，即模型更新的方向，其空间[频谱](@entry_id:265125)（[波数](@entry_id:172452)）特征揭示了 FWI 的物理本质。通过[平面波](@entry_id:189798)分析可以证明，FWI 梯度在某一点的贡献，是由穿过该点的正向传播波场和反向传播的伴随波场（由数据残差作为震源）的干涉产生的。模型更新量的波数 $\mathbf{k}_m$ 由这两个波场的波数 $\mathbf{k}_u$ 和 $\mathbf{k}_{\lambda}$ 决定：$\mathbf{k}_m = \mathbf{k}_u - \mathbf{k}_{\lambda}$。其大小为 $|\mathbf{k}_m| = 2 (\omega/c) \sin(\theta/2)$，其中 $\omega$ 是角频率， $c$ 是[波速](@entry_id:186208)，$\theta$ 是[散射角](@entry_id:171822)。

这个关系清晰地划分了 FWI 的两种工作模式：
1.  **层析成像（Tomography）模式**：当散射角 $\theta$ 很小（透射或近散射）时，或频率 $\omega$ 很低时，$|\mathbf{k}_m|$ 很小。这意味着梯度主要更新模型的长波长（大尺度）成分。这对应于经典的射线层析成像，其目标就是构建背景速度模型。
2.  **偏移成像（Migration）模式**：当散射角 $\theta$ 很大（特别是背散射，$\theta \approx \pi$）时，$|\mathbf{k}_m|$ 很大。这意味着梯度主要更新模型的短波长（高分辨率）成分，如反射界面。这对应于经典的[逆时偏移](@entry_id:754327)（RTM）。

标准的 $L^2$ FWI 混合了这两种模式。而旨在缓解[周期跳跃](@entry_id:748134)的[失配泛函](@entry_id:752011)，如基于相位、包络或最优传输的[失配泛函](@entry_id:752011)，通过隐式或显式地对低频信息加权，实际上是强化了 FWI 的[层析成像](@entry_id:756051)能力。它们优先生成长波长的模型更新，用于校正背景速度，一旦背景速度足够准确，走时误差减小，[周期跳跃](@entry_id:748134)问题便迎刃而解，此时便可切换回标准 $L^2$ [失配泛函](@entry_id:752011)以利用其偏移成像能力来刻画细节 。

#### Marchenko Redatuming：数据驱动的多次波压制

多次波是 FWI 的另一大挑战，它们是数据中的真实信号，但通常不包含在简化的正演模型中，因此会产生巨大的残差，将反演引入歧途。传统的多次波压制方法通常基于模型，但如果模型不准，效果便会打折扣。Marchenko Redatuming 是一种先进的数据驱动方法，它利用地震干涉学原理，仅从地表记录的数据中就能预测并分离出一次波和多次波。

将 Marchenko 方法作为 FWI 的预处理步骤，可以为反演提供“净化”后的观测数据——即只包含一次反射波的数据。然后，FWI 的正演模型也只需模拟一次波。在这种“一次波对一次波”的失配比较中，由多次波引起的复杂[非线性](@entry_id:637147)和局部极小值得以消除。这极大地简化了[失配泛函](@entry_id:752011)的形态，使其更接近于凸形，从而显著提高了 FWI 在[复杂介质](@entry_id:164088)中的鲁棒性 。

#### [联合反演](@entry_id:750950)：结合地震与重力数据

FWI 的一个固有缺陷是其对模型长波长成分的敏感度不足（所谓的“波数谱的零频缺失”），这是导致[周期跳跃](@entry_id:748134)的根本原因。与之相反，重力勘探方法对地下介质的密度[分布](@entry_id:182848)的长波长成分极为敏感，但无法提供高分辨率的细节。这两种方法在波数域上形成了完美的互补。

通过构建一个包含 FWI 失配和重力失配的联合[目标函数](@entry_id:267263)：
$$
\min_{m} \alpha \Phi_{\text{FWI}}(m) + \beta \Phi_{\text{grav}}(m)
$$
并利用岩石物理关系（如 Gardner 关系）将速度模型 $m$ 与密度模型 $\rho$ 联系起来，可以实现[联合反演](@entry_id:750950)。在反演过程中，重力数据提供了对模型长波长结构的强力约束，有效地构建了 FWI 所需的准确背景模型。这相当于从外部“填补”了 FWI 在零频附近的敏感度缺失，从而使 FWI 从一开始就在一个良好的起点上进行，有效避免了[周期跳跃](@entry_id:748134)。[联合反演](@entry_id:750950)是地球物理[多源](@entry_id:170321)信息融合的典范，展示了如何通过结合不同物理原理的观测来克服单一方法的固有局限性 。

#### 与速度分析和成像方法的联系

FWI 的目标与传统的偏移速度分析（Migration Velocity Analysis, MVA）是一致的：都是为了获得准确的地下速度模型。MVA 的一个经典准则是“共成像点道集（Common Image Gathers, CIGs）拉平”。当偏移速度准确时，来自不同偏移距或角度的成像能量会聚焦在正确的深度，CIGs 表现为水平的。当速度不准时，CIGs 会出现“笑脸”或“哭脸”状的弯曲。可以从理论上证明，基于最优传输的[失配泛函](@entry_id:752011)与 CIG 拉平准则之间存在着深刻的数学联系。对于一个纯粹的运动学误差，最小化数据域的 $W_2^2$ 失配在数学上等价于最小化成像域 CIG 的弯曲程度。这为现代 FWI 失配设计提供了一个来自经典成像理论的直观物理解释，揭示了不同方法论之间的内在统一性 。

### 跨学科应用：[医学超声](@entry_id:270486)成像

波形成像的原理是普适的。FWI 中为解决[周期跳跃](@entry_id:748134)问题而发展出的理论和方法，完全可以“转译”到其他领域，其中一个最直接的应用就是[医学超声](@entry_id:270486)成像。超声成像与[地震成像](@entry_id:273056)共享相同的物理基础（声波传播），只是尺度和频率截然不同。在超声成像中，目标是反演人体软组织的声速、密度和衰减等参数，以实现疾病的早期诊断。

传统的超声成像（如 B-mode）主要是一种定性的偏移成像。而定量的“全波形”超声反演，同样面临着因初始模型不准（如假设为均匀水速）而导致的[周期跳跃](@entry_id:748134)问题。地震 FWI 中的[失配泛函](@entry_id:752011)“工具箱”可以被直接应用到超声射频（RF）数据上。例如，可以提取超声 RF 信号的包络，构建基于最优传输的 $W_2$ 失配，来克服因脂肪层等引起的显著走时误差。实验和数值模拟表明，相较于传统的 $L^2$ 失配，这些先进的[失配泛函](@entry_id:752011)能够显著提高超声声速重建的鲁棒性和准确性。这充分说明，本章所讨论的原理和方法，是解决一般性[非线性波](@entry_id:273091)反演问题的宝贵财富，其应用前景远不止于[地球物理学](@entry_id:147342) 。