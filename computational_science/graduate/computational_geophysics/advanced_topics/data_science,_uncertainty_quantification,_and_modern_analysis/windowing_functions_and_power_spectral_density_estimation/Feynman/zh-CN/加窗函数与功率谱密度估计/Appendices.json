{
    "hands_on_practices": [
        {
            "introduction": "在频谱分析中，窗函数的选择并非随意，而是一个权衡利弊的设计过程。本练习将以灵活的凯泽窗为例，指导你如何根据期望的旁瓣衰减来设计窗函数，并使用等效噪声带宽（Equivalent Noise Bandwidth, ENBW）来量化分辨率损失，从而让你亲身体验主瓣宽度与旁瓣抑制之间的核心权衡关系。通过这个练习，你将掌握为特定信号处理任务选择和评估窗函数性能的关键技能。",
            "id": "3618894",
            "problem": "一个以均匀间隔采样的离散时间地球物理信号，通过长度为 $N$ 的离散傅里叶变换 (DFT) 进行分析。为了在功率谱密度 (PSD) 的估计中减轻谱泄漏，在计算周期图之前，使用窗函数 $w[n]$ 对时间序列进行锥削。考虑 Kaiser 窗，其在索引集 $n = 0,1,\\dots,N-1$ 上定义为\n$$\nw[n] = \\frac{I_0\\left(\\beta \\sqrt{1 - \\left(\\frac{n - \\alpha}{\\alpha}\\right)^2}\\right)}{I_0(\\beta)}, \\quad \\alpha = \\frac{N-1}{2},\n$$\n其中 $I_0(\\cdot)$ 是第一类零阶修正贝塞尔函数，$\\beta \\ge 0$ 是一个可调的形状参数，用于控制主瓣宽度和旁瓣衰减之间的权衡。对于给定的目标旁瓣衰减（以负分贝水平指定，例如 $-60$ $\\mathrm{dB}$），一个被广泛接受的设计规则将衰减的幅度与相应的 $\\beta$ 选择联系起来。\n\n窗函数的等效噪声带宽 (ENBW) 量化了窗函数频谱响应对白噪声进行平均的带宽。在连续频率中，ENBW 定义为\n$$\n\\mathrm{ENBW} = \\frac{\\int_{-\\infty}^{\\infty} \\left|W(f)\\right|^2 \\, df}{\\left|W(0)\\right|^2},\n$$\n其中 $W(f)$ 是 $w[n]$ 的傅里叶变换。对于基于 DFT 的分析，其谱线间距为 $\\Delta f$，并以矩形窗作为比较基准，通常将 ENBW 表示为以 DFT 谱线为单位。使用将离散时间设置中的帕塞瓦尔定理与积分平方窗谱相关联的第一性原理，推导出一个关于 $N$ 和 $w[n]$ 的 ENBW（以谱线为单位）的离散求和表达式。然后，使用该表达式计算下面定义的测试套件中 Kaiser 窗实例的 ENBW。\n\n将分辨率损失定义为所选窗函数的 ENBW（以谱线为单位）与矩形窗的 ENBW 之比。对于矩形窗 $w[n]=1$，使用离散求和表达式证明其 ENBW 等于 1 个谱线，从而使得分辨率损失等于所选窗函数的 ENBW。\n\n你的任务是：\n1. 给定一个以分贝为单位的目标旁瓣衰减（负数，例如 $-60$ $\\mathrm{dB}$），使用一个经过充分检验的设计规则来选择满足目标的 Kaiser 参数 $\\beta$，该规则将衰减幅度映射到 $\\beta$。\n2. 使用你推导的离散求和表达式，计算长度为 $N$ 的 Kaiser 窗的 ENBW（以谱线为单位）。\n3. 根据上面定义的 ENBW 比值，估计相对于矩形窗的分辨率损失。\n\n所有数值量均以无量纲浮点数作答。不出现角度。不需要物理单位，因为 ENBW 以谱线表示，分辨率损失是一个比率。将所有报告的浮点数四舍五入到六位小数。\n\n实现一个程序来评估以下测试套件，其中每个案例都是一个对 $(S_{\\mathrm{dB}}, N)$：\n- 案例 1（理想路径）：$(-60.0, 1024)$。\n- 案例 2（设计规则边界）：$(-50.0, 1024)$。\n- 案例 3（导致 $\\beta=0$ 的边缘情况）：$(-10.0, 1024)$。\n- 案例 4（更高衰减，更小的 $N$）：$(-80.0, 256)$。\n- 案例 5（非常高的衰减，更大的 $N$）：$(-100.0, 4096)$。\n\n对于每个案例，生成一个三元组 $[\\beta, \\mathrm{ENBW\\_bins}, \\mathrm{resolution\\_loss}]$。你的程序应生成单行输出，其中包含一个用方括号括起来的逗号分隔列表形式的结果，每个案例表示为一个包含三个浮点数的嵌套列表，例如：\n$[[\\beta_1,\\mathrm{ENBW}_1,\\mathrm{loss}_1],[\\beta_2,\\mathrm{ENBW}_2,\\mathrm{loss}_2],\\dots]$。",
            "solution": "该问题要求在频谱分析的背景下，推导并应用一个用于窗函数（特别是 Kaiser 窗）等效噪声带宽 (ENBW) 的离散求和公式。解决方案主要分为三个阶段：首先，从基本原理推导 ENBW 公式；其次，明确 Kaiser 窗的设计规则；第三，应用这些结果计算所提供测试用例所需的量。\n\n### ENBW 离散求和表达式的推导\n\n等效噪声带宽 (ENBW) 是衡量滤波器或窗函数对噪声的有效带宽的指标。连续频率下的定义如下：\n$$\n\\mathrm{ENBW_{Hz}} = \\frac{\\int_{-\\infty}^{\\infty} \\left|W(f)\\right|^2 \\, df}{\\left|W(0)\\right|^2}\n$$\n其中 $W(f)$ 是连续时间窗函数 $w(t)$ 的傅里叶变换。在我们的离散时间设置中，给定一个长度为 $N$ 的窗序列 $w[n]$，定义域为 $n = 0, 1, \\dots, N-1$。相关的傅里叶变换是离散时间傅里叶变换 (DTFT) $W(e^{j\\omega})$，它在频率上是周期的，周期为采样率 $f_s$。因此，积分在一个周期内进行，例如从 $-f_s/2$ 到 $f_s/2$。\n$$\n\\mathrm{ENBW_{Hz}} = \\frac{\\int_{-f_s/2}^{f_s/2} \\left|W(e^{j2\\pi f T_s})\\right|^2 \\, df}{\\left|W(e^{j0})\\right|^2}\n$$\n其中 $T_s = 1/f_s$ 是采样周期。\n\n分子涉及 DTFT 幅度平方的积分。我们可以使用帕塞瓦尔定理（针对离散时间信号）将此积分与时域序列的能量联系起来：\n$$\n\\sum_{n=-\\infty}^{\\infty} \\left|w[n]\\right|^2 = \\frac{1}{2\\pi} \\int_{-\\pi}^{\\pi} \\left|W(e^{j\\omega})\\right|^2 \\, d\\omega\n$$\n我们对分子积分中的变量进行替换，从频率 $f$ 变为归一化角频率 $\\omega = 2\\pi f T_s$。这得到 $df = d\\omega / (2\\pi T_s)$，积分限从 $[-f_s/2, f_s/2]$ 变为 $[-\\pi, \\pi]$。\n$$\n\\int_{-f_s/2}^{f_s/2} \\left|W(e^{j2\\pi f T_s})\\right|^2 \\, df = \\int_{-\\pi}^{\\pi} \\left|W(e^{j\\omega})\\right|^2 \\frac{d\\omega}{2\\pi T_s} = \\frac{1}{T_s} \\left( \\frac{1}{2\\pi} \\int_{-\\pi}^{\\pi} \\left|W(e^{j\\omega})\\right|^2 \\, d\\omega \\right)\n$$\n应用帕塞瓦尔定理，并注意到 $w[n]$ 在 $n = 0, \\dots, N-1$ 之外为零，该表达式变为：\n$$\n\\frac{1}{T_s} \\sum_{n=0}^{N-1} \\left|w[n]\\right|^2\n$$\n由于窗函数通常是实值的，这可以简化为 $\\frac{1}{T_s} \\sum_{n=0}^{N-1} w[n]^2$。\n\n分母是 DTFT 在零频率（$f=0$, $\\omega=0$）处的幅度平方，即直流分量：\n$$\nW(e^{j0}) = \\sum_{n=0}^{N-1} w[n] e^{-j0 \\cdot n} = \\sum_{n=0}^{N-1} w[n]\n$$\n因此，分母为 $\\left(\\sum_{n=0}^{N-1} w[n]\\right)^2$。\n\n结合分子和分母，我们得到以赫兹 (Hz) 为单位的 ENBW：\n$$\n\\mathrm{ENBW_{Hz}} = \\frac{\\frac{1}{T_s} \\sum_{n=0}^{N-1} w[n]^2}{\\left(\\sum_{n=0}^{N-1} w[n]\\right)^2}\n$$\n问题要求 ENBW 以 DFT 谱线为单位。对于一个 $N$ 点 DFT，频率分辨率或谱线间距为 $\\Delta f = f_s/N$。要从赫兹转换为谱线单位，我们除以 $\\Delta f$：\n$$\n\\mathrm{ENBW_{bins}} = \\frac{\\mathrm{ENBW_{Hz}}}{\\Delta f} = \\frac{\\mathrm{ENBW_{Hz}}}{f_s/N} = \\frac{N}{f_s} \\mathrm{ENBW_{Hz}}\n$$\n代入 $\\mathrm{ENBW_{Hz}}$ 的表达式：\n$$\n\\mathrm{ENBW_{bins}} = \\frac{N}{f_s} \\frac{\\frac{1}{T_s} \\sum_{n=0}^{N-1} w[n]^2}{\\left(\\sum_{n=0}^{N-1} w[n]\\right)^2}\n$$\n由于 $T_s = 1/f_s$，这些项相互抵消，得到最终的 ENBW（以谱线为单位）的离散求和表达式：\n$$\n\\mathrm{ENBW_{bins}} = N \\frac{\\sum_{n=0}^{N-1} w[n]^2}{\\left(\\sum_{n=0}^{N-1} w[n]\\right)^2}\n$$\n这就是所要求的离散求和表达式。\n\n### 使用矩形窗进行验证及分辨率损失的定义\n\n对于矩形窗，$w[n] = 1$ 对 $n = 0, \\dots, N-1$ 成立。我们应用推导出的公式：\n求和为 $\\sum_{n=0}^{N-1} w[n] = \\sum_{n=0}^{N-1} 1 = N$。\n平方和为 $\\sum_{n=0}^{N-1} w[n]^2 = \\sum_{n=0}^{N-1} 1^2 = N$。\n将这些代入 ENBW 公式：\n$$\n\\mathrm{ENBW_{bins, rect}} = N \\frac{N}{N^2} = 1\n$$\n矩形窗的 ENBW 恰好是 1 个谱线。问题将分辨率损失定义为所选窗的 ENBW 与矩形窗的 ENBW 之比。因此：\n$$\n\\mathrm{Resolution\\;Loss} = \\frac{\\mathrm{ENBW_{bins}}(w)}{\\mathrm{ENBW_{bins, rect}}} = \\frac{\\mathrm{ENBW_{bins}}(w)}{1} = \\mathrm{ENBW_{bins}}(w)\n$$\n因此，对于任何窗函数，分辨率损失在数值上等于其以谱线为单位表示的 ENBW。\n\n### Kaiser 窗设计与计算过程\n\nKaiser 窗定义为\n$$\nw[n] = \\frac{I_0\\left(\\beta \\sqrt{1 - \\left(\\frac{n - \\alpha}{\\alpha}\\right)^2}\\right)}{I_0(\\beta)}, \\quad \\text{for } n = 0, \\dots, N-1\n$$\n其中 $\\alpha = (N-1)/2$，$I_0(\\cdot)$ 是第一类零阶修正贝塞尔函数，$\\beta$ 是形状参数。一个关键特性是，如果 $\\beta=0$，分子中 $I_0$ 的参数为 0，并且由于 $I_0(0)=1$，窗函数简化为 $w[n]=1$，即矩形窗。\n\n参数 $\\beta$ 是根据期望的旁瓣衰减 $A = -S_{\\mathrm{dB}}$ 来选择的，其中 $S_{\\mathrm{dB}}$ 是以分贝为单位的衰减（一个负值）。一组标准的经验公式是：\n$$ \\beta = \\begin{cases} 0, & A \\le 21 \\\\ 0.5842(A - 21)^{0.4} + 0.07886(A - 21), & 21 < A \\le 50 \\\\ 0.1102(A - 8.7), & A > 50 \\end{cases} $$\n\n对于每个测试用例 $(S_{\\mathrm{dB}}, N)$ 的计算过程如下：\n1.  计算正的衰减值 $A = -S_{\\mathrm{dB}}$。\n2.  使用上述分段公式确定 Kaiser 参数 $\\beta$。\n3.  使用计算出的 $\\beta$ 和给定的 $N$ 生成 $N$ 点 Kaiser 窗序列 $w[n]$。函数 $I_0(x)$ 使用标准的数值库进行计算。\n4.  计算窗样本之和 $\\sum_{n=0}^{N-1} w[n]$，以及窗样本平方和 $\\sum_{n=0}^{N-1} w[n]^2$。\n5.  使用推导的公式计算以谱线为单位的 ENBW：$\\mathrm{ENBW_{bins}} = N \\frac{\\sum w[n]^2}{(\\sum w[n])^2}$。\n6.  分辨率损失等于计算出的 $\\mathrm{ENBW_{bins}}$。\n7.  将最终结果 $[\\beta, \\mathrm{ENBW_{bins}}, \\mathrm{Resolution\\;Loss}]$ 四舍五入到六位小数。\n\n此过程被实现以解决指定的测试套件。",
            "answer": "```python\nimport numpy as np\nfrom scipy.special import i0\n\ndef solve():\n    \"\"\"\n    Computes Kaiser window parameters, ENBW, and resolution loss for a given\n    test suite of sidelobe attenuations and window lengths.\n    \"\"\"\n    # Test suite format: (S_dB, N)\n    # S_dB: Target sidelobe attenuation in decibels\n    # N: Window length\n    test_cases = [\n        (-60.0, 1024),\n        (-50.0, 1024),\n        (-10.0, 1024),\n        (-80.0, 256),\n        (-100.0, 4096),\n    ]\n\n    results = []\n    \n    for s_db, n in test_cases:\n        # 1. Calculate positive attenuation A\n        A = -s_db\n\n        # 2. Determine Kaiser parameter beta from attenuation A\n        if A = 21:\n            beta = 0.0\n        elif 21  A = 50:\n            beta = 0.5842 * (A - 21)**0.4 + 0.07886 * (A - 21)\n        else: # A > 50\n            beta = 0.1102 * (A - 8.7)\n        \n        # 3. Handle the special case of beta=0 (rectangular window)\n        if beta == 0.0:\n            enbw_bins = 1.0\n            resolution_loss = 1.0\n        else:\n            # 4. Generate the N-point Kaiser window sequence\n            # Create the index array for the window\n            indices = np.arange(n)\n            alpha = (n - 1) / 2.0\n            \n            # Argument for the Bessel function in the numerator\n            # The argument inside the sqrt is 1 - ((n-alpha)/alpha)^2\n            # which is mathematically guaranteed to be non-negative.\n            # Using floating point arithmetic, it should remain so.\n            arg = beta * np.sqrt(1 - ((indices - alpha) / alpha)**2)\n            \n            window = i0(arg) / i0(beta)\n            \n            # 5. Compute sums needed for ENBW calculation\n            sum_w = np.sum(window)\n            sum_w_sq = np.sum(window**2)\n            \n            # 6. Calculate ENBW in bins using the derived discrete-sum formula\n            enbw_bins = n * sum_w_sq / (sum_w**2)\n            \n            # 7. Resolution loss equals ENBW in bins\n            resolution_loss = enbw_bins\n\n        # 8. Round results to six decimal places and store them\n        beta_rounded = round(beta, 6)\n        enbw_rounded = round(enbw_bins, 6)\n        loss_rounded = round(resolution_loss, 6)\n        \n        results.append([beta_rounded, enbw_rounded, loss_rounded])\n\n    # Format the final output string as specified\n    case_strings = []\n    for r in results:\n        # Creates a string like \"[val1,val2,val3]\" for each case\n        case_strings.append(f\"[{r[0]},{r[1]},{r[2]}]\")\n    \n    final_output = f\"[{','.join(case_strings)}]\"\n    print(final_output)\n\nsolve()\n```"
        },
        {
            "introduction": "对信号应用窗函数后，正确地缩放所得的频谱以保持能量守恒是至关重要的一步。本练习将探讨两种不同的归一化方法，揭示仅使用相干增益（coherent gain）进行校正为何会导致总功率估算的偏差。通过计算这种常见但错误的估计方法所产生的误差，你将深刻理解基于窗函数能量进行正确归一化的重要性，并巩固前一个练习中关于窗函数性质的知识。",
            "id": "3618920",
            "problem": "考虑一个离散时间、零均值、宽义平稳地球物理信号 $x[n]$，其方差为 $\\sigma_{x}^{2}$，采样频率为 $f_{s}$，在 $n=0,1,\\dots,N-1$ 的索引上观测了 $N=1001$ 个样本。将一个通用的锥形窗（窗函数）$w[n]$ 应用于记录，形成 $x_{w}[n]=w[n]x[n]$。将加窗记录的离散时间傅里叶变换定义为\n$$\nX_{w}(\\omega)=\\sum_{n=0}^{N-1} w[n]\\,x[n]\\,\\exp(-\\mathrm{i}\\,\\omega n),\n$$\n其中角频率 $\\omega\\in[-\\pi,\\pi]$。根据 Parseval 定理，\n$$\n\\frac{1}{2\\pi}\\int_{-\\pi}^{\\pi}\\left|X_{w}(\\omega)\\right|^{2}\\,\\mathrm{d}\\omega=\\sum_{n=0}^{N-1}\\left|w[n]x[n]\\right|^{2}.\n$$\n考虑两种不同的功率谱密度（PSD）估计量。\n\n1.  一种能量归一化估计量，\n$$\n\\widehat{S}_{U}(\\omega)=\\frac{1}{2\\pi\\,N\\,U}\\,\\left|X_{w}(\\omega)\\right|^{2},\\quad U=\\frac{1}{N}\\sum_{n=0}^{N-1}w[n]^{2},\n$$\n其在 $\\omega\\in[-\\pi,\\pi]$ 上的积分用于恢复时域方差。\n\n2.  一种从业者常用的估计量，它试图通过相干增益 $G_{c}$ 来校正窗函数的幅频响应，但（错误地）将等效噪声带宽设置为1，\n$$\n\\widehat{S}_{B}(\\omega)=\\frac{1}{2\\pi\\,N\\,G_{c}^{2}}\\,\\left|X_{w}(\\omega)\\right|^{2},\\quad G_{c}=\\frac{1}{N}\\sum_{n=0}^{N-1}w[n],\n$$\n即，此选择隐含地在离散频率点上取 $B_{e}=1$。\n\n任务：\n- 从上述定义和 Parseval 定理出发，证明当 $x[n]$ 是零均值宽义平稳信号时，对于任何窗函数 $w[n]$，$\\int_{-\\pi}^{\\pi}\\widehat{S}_{U}(\\omega)\\,\\mathrm{d}\\omega$ 在期望上等于时域方差。\n- 对于“仅用 $G_{c}$”的从业者估计量 $\\widehat{S}_{B}(\\omega)$，推导乘性偏差因子\n$$\nD_{w}=\\frac{\\mathbb{E}\\left[\\int_{-\\pi}^{\\pi}\\widehat{S}_{B}(\\omega)\\,\\mathrm{d}\\omega\\right]}{\\sigma_{x}^{2}},\n$$\n用 $w[n]$ 和 $N$ 表示。然后，使用 $N=1001$ 和在 $n=0,1,\\dots,N-1$ 上定义的以下窗函数，其中 $\\theta_{n}=\\frac{2\\pi n}{N-1}$，\n- 矩形窗：$w[n]=1$，\n- Hann 窗：$w[n]=\\frac{1}{2}\\left(1-\\cos\\theta_{n}\\right)$，\n- Hamming 窗：$w[n]=0.54-0.46\\cos\\theta_{n}$，\n- Blackman 窗：$w[n]=0.42-0.50\\cos\\theta_{n}+0.08\\cos(2\\theta_{n})$，\n计算每个窗函数的 $D_{w}$。\n\n报告四个无量纲值 $\\left(D_{\\text{rect}},D_{\\text{hann}},D_{\\text{hamming}},D_{\\text{blackman}}\\right)$，四舍五入到四位有效数字。不需要单位。相关角度以弧度为单位。",
            "solution": "该问题被验证为具有科学依据、问题明确且客观。这是数字信号处理中的一个标准练习，具体涉及不同窗函数下功率谱密度估计量的性质。所有必需的定义和数据均已提供。\n\n首先，我们证明通过对能量归一化估计量 $\\widehat{S}_{U}(\\omega)$ 进行积分得到的总功率，在期望上等于信号方差 $\\sigma_{x}^{2}$。我们从 $\\widehat{S}_{U}(\\omega)$ 在其频域 $\\omega \\in [-\\pi, \\pi]$ 上的积分开始：\n$$\n\\int_{-\\pi}^{\\pi}\\widehat{S}_{U}(\\omega)\\,\\mathrm{d}\\omega = \\int_{-\\pi}^{\\pi}\\frac{1}{2\\pi\\,N\\,U}\\,\\left|X_{w}(\\omega)\\right|^{2}\\,\\mathrm{d}\\omega\n$$\n项 $\\frac{1}{N\\,U}$ 相对于 $\\omega$ 是常数，可以从积分中提出：\n$$\n\\int_{-\\pi}^{\\pi}\\widehat{S}_{U}(\\omega)\\,\\mathrm{d}\\omega = \\frac{1}{N\\,U} \\left( \\frac{1}{2\\pi}\\int_{-\\pi}^{\\pi}\\left|X_{w}(\\omega)\\right|^{2}\\,\\mathrm{d}\\omega \\right)\n$$\n使用给定的 Parseval 定理，$\\frac{1}{2\\pi}\\int_{-\\pi}^{\\pi}\\left|X_{w}(\\omega)\\right|^{2}\\,\\mathrm{d}\\omega=\\sum_{n=0}^{N-1}\\left|w[n]x[n]\\right|^{2}$，我们将积分替换为求和：\n$$\n\\int_{-\\pi}^{\\pi}\\widehat{S}_{U}(\\omega)\\,\\mathrm{d}\\omega = \\frac{1}{N\\,U} \\sum_{n=0}^{N-1}\\left(w[n]x[n]\\right)^{2}\n$$\n接下来，我们取该量的期望 $\\mathbb{E}[\\cdot]$。由于窗函数 $w[n]$ 和归一化因子 $U$ 是确定性的，期望算子仅作用于信号项 $x[n]$：\n$$\n\\mathbb{E}\\left[\\int_{-\\pi}^{\\pi}\\widehat{S}_{U}(\\omega)\\,\\mathrm{d}\\omega\\right] = \\frac{1}{N\\,U} \\sum_{n=0}^{N-1}w[n]^{2}\\mathbb{E}\\left[x[n]^{2}\\right]\n$$\n信号 $x[n]$ 被定义为零均值和宽义平稳（WSS）。对于零均值过程，方差 $\\sigma_{x}^{2}$ 等于均方值：$\\sigma_{x}^{2} = \\mathbb{E}[x[n]^2] - (\\mathbb{E}[x[n]])^2 = \\mathbb{E}[x[n]^2] - 0^2 = \\mathbb{E}[x[n]^2]$。WSS 属性确保了该方差对所有 $n$ 都是恒定的。代入 $\\mathbb{E}[x[n]^2] = \\sigma_{x}^{2}$：\n$$\n\\mathbb{E}\\left[\\int_{-\\pi}^{\\pi}\\widehat{S}_{U}(\\omega)\\,\\mathrm{d}\\omega\\right] = \\frac{1}{N\\,U} \\sum_{n=0}^{N-1}w[n]^{2}\\sigma_{x}^{2} = \\frac{\\sigma_{x}^{2}}{N\\,U} \\sum_{n=0}^{N-1}w[n]^{2}\n$$\n现在，我们代入能量归一化因子 $U$ 的定义，即 $U=\\frac{1}{N}\\sum_{n=0}^{N-1}w[n]^{2}$：\n$$\n\\mathbb{E}\\left[\\int_{-\\pi}^{\\pi}\\widehat{S}_{U}(\\omega)\\,\\mathrm{d}\\omega\\right] = \\frac{\\sigma_{x}^{2}}{N\\left(\\frac{1}{N}\\sum_{n=0}^{N-1}w[n]^{2}\\right)} \\sum_{n=0}^{N-1}w[n]^{2} = \\frac{\\sigma_{x}^{2}}{\\sum_{n=0}^{N-1}w[n]^{2}} \\sum_{n=0}^{N-1}w[n]^{2} = \\sigma_{x}^{2}\n$$\n证明完毕。\n\n接下来，我们推导从业者估计量 $\\widehat{S}_{B}(\\omega)$ 的乘性偏差因子 $D_{w}$。过程是类似的。我们从积分谱的期望值开始：\n$$\n\\mathbb{E}\\left[\\int_{-\\pi}^{\\pi}\\widehat{S}_{B}(\\omega)\\,\\mathrm{d}\\omega\\right] = \\mathbb{E}\\left[\\int_{-\\pi}^{\\pi}\\frac{1}{2\\pi\\,N\\,G_{c}^{2}}\\,\\left|X_{w}(\\omega)\\right|^{2}\\,\\mathrm{d}\\omega\\right]\n$$\n遵循应用 Parseval 定理和取期望的相同步骤：\n$$\n\\mathbb{E}\\left[\\int_{-\\pi}^{\\pi}\\widehat{S}_{B}(\\omega)\\,\\mathrm{d}\\omega\\right] = \\frac{1}{N\\,G_{c}^{2}} \\mathbb{E}\\left[\\sum_{n=0}^{N-1}\\left(w[n]x[n]\\right)^{2}\\right] = \\frac{1}{N\\,G_{c}^{2}} \\sum_{n=0}^{N-1}w[n]^{2}\\mathbb{E}\\left[x[n]^{2}\\right] = \\frac{\\sigma_{x}^{2}}{N\\,G_{c}^{2}} \\sum_{n=0}^{N-1}w[n]^{2}\n$$\n偏差因子 $D_{w}$ 被定义为该期望总功率与真实方差 $\\sigma_{x}^{2}$ 的比值：\n$$\nD_{w} = \\frac{\\mathbb{E}\\left[\\int_{-\\pi}^{\\pi}\\widehat{S}_{B}(\\omega)\\,\\mathrm{d}\\omega\\right]}{\\sigma_{x}^{2}} = \\frac{\\frac{\\sigma_{x}^{2}}{N\\,G_{c}^{2}} \\sum_{n=0}^{N-1}w[n]^{2}}{\\sigma_{x}^{2}} = \\frac{1}{N\\,G_{c}^{2}} \\sum_{n=0}^{N-1}w[n]^{2}\n$$\n代入相干增益的定义，$G_{c}=\\frac{1}{N}\\sum_{n=0}^{N-1}w[n]$：\n$$\nD_{w} = \\frac{\\sum_{n=0}^{N-1}w[n]^{2}}{N \\left( \\frac{1}{N}\\sum_{n=0}^{N-1}w[n] \\right)^{2}} = \\frac{N \\sum_{n=0}^{N-1}w[n]^{2}}{\\left(\\sum_{n=0}^{N-1}w[n]\\right)^{2}}\n$$\n这是 $D_w$ 的通用表达式。我们现在对每个窗函数计算此值，其中 $N=1001$。令 $M=N-1=1000$ 且 $\\theta_n = \\frac{2\\pi n}{M}$。我们利用求和恒等式 $\\sum_{n=0}^{M} \\cos(k\\theta_n) = 1$，其中整数 $k$ 不能被 $M$ 整除。\n\n1.  **矩形窗**：$w[n]=1$ for $n=0, \\dots, N-1$。\n    $\\sum_{n=0}^{N-1} w[n] = \\sum_{n=0}^{N-1} 1 = N$。\n    $\\sum_{n=0}^{N-1} w[n]^2 = \\sum_{n=0}^{N-1} 1^2 = N$。\n    $D_{\\text{rect}} = \\frac{N \\cdot N}{N^2} = 1$。\n\n2.  **Hann 窗**：$w[n]=\\frac{1}{2}\\left(1-\\cos\\theta_{n}\\right)$。\n    $\\sum_{n=0}^{N-1} w[n] = \\frac{1}{2}\\sum_{n=0}^{M} (1-\\cos\\theta_n) = \\frac{1}{2}\\left(\\sum_0^M 1 - \\sum_0^M \\cos\\theta_n\\right) = \\frac{1}{2}(N-1) = \\frac{M}{2}$。\n    $\\sum_{n=0}^{N-1} w[n]^2 = \\frac{1}{4}\\sum_{n=0}^{M} (1-\\cos\\theta_n)^2 = \\frac{1}{4}\\sum (1 - 2\\cos\\theta_n + \\cos^2\\theta_n)$。\n    使用 $\\cos^2\\theta_n = \\frac{1}{2}(1+\\cos(2\\theta_n))$，求和变为 $\\frac{1}{4}\\sum( \\frac{3}{2} - 2\\cos\\theta_n + \\frac{1}{2}\\cos(2\\theta_n) ) = \\frac{1}{4}(\\frac{3}{2}N - 2(1) + \\frac{1}{2}(1)) = \\frac{1}{4}(\\frac{3N-3}{2}) = \\frac{3(N-1)}{8}$。\n    $D_{\\text{hann}} = \\frac{N \\cdot \\frac{3(N-1)}{8}}{(\\frac{N-1}{2})^2} = \\frac{3N(N-1)/8}{(N-1)^2/4} = \\frac{3N}{2(N-1)}$。\n    对于 $N=1001$，$D_{\\text{hann}} = \\frac{3 \\cdot 1001}{2 \\cdot 1000} = \\frac{3003}{2000} = 1.5015$。\n\n3.  **Hamming 窗**：$w[n]=0.54-0.46\\cos\\theta_{n}$。令 $a=0.54, b=0.46$。\n    $\\sum w[n] = \\sum(a-b\\cos\\theta_n) = aN - b(1) = 0.54(1001) - 0.46 = 540.08$。\n    $\\sum w[n]^2 = \\sum(a^2 - 2ab\\cos\\theta_n + b^2\\cos^2\\theta_n) = a^2N - 2ab(1) + b^2\\sum \\frac{1+\\cos(2\\theta_n)}{2} = a^2N - 2ab + b^2(\\frac{N+1}{2})$。\n    $= (0.54)^2(1001) - 2(0.54)(0.46) + (0.46)^2(\\frac{1002}{2}) = 0.2916(1001) - 0.4968 + 0.2116(501) = 291.8916 - 0.4968 + 106.0116 = 397.4064$。\n    $D_{\\text{hamming}} = \\frac{1001 \\cdot 397.4064}{(540.08)^2} = \\frac{397803.8064}{291686.4064} \\approx 1.363806$。\n\n4.  **Blackman 窗**：$w[n]=0.42-0.50\\cos\\theta_{n}+0.08\\cos(2\\theta_{n})$。令 $a_0=0.42, a_1=0.50, a_2=0.08$。\n    $\\sum w[n] = \\sum (a_0 - a_1\\cos\\theta_n + a_2\\cos(2\\theta_n)) = a_0N - a_1(1) + a_2(1) = 0.42(1001) - 0.50 + 0.08 = 420.0$。\n    $\\sum w[n]^2 = \\sum (a_0 - a_1\\cos\\theta_n + a_2\\cos(2\\theta_n))^2$。展开后得到包含 $1$, $\\cos(k\\theta_n)$, $\\cos^2(k\\theta_n)$ 以及交叉乘积项 $\\cos(j\\theta_n)\\cos(k\\theta_n)$ 的和。使用求和恒等式：\n    $\\sum w[n]^2 = a_0^2N + (a_1^2+a_2^2)\\frac{N+1}{2} - 2(a_0a_1 - a_0a_2 + a_1a_2)$。\n    $= (0.42)^2(1001) + (0.50^2+0.08^2)\\frac{1002}{2} - 2(0.42 \\cdot 0.50 - 0.42 \\cdot 0.08 + 0.50 \\cdot 0.08)$。\n    $= 0.1764(1001) + (0.25+0.0064)(501) - 2(0.21 - 0.0336 + 0.04)$。\n    $= 176.5764 + (0.2564)(501) - 2(0.2164) = 176.5764 + 128.4564 - 0.4328 = 304.6$。\n    $D_{\\text{blackman}} = \\frac{1001 \\cdot 304.6}{(420.0)^2} = \\frac{304904.6}{176400} \\approx 1.728484$。\n\n将值四舍五入到四位有效数字：\n- $D_{\\text{rect}} = 1.000$\n- $D_{\\text{hann}} = 1.5015 \\to 1.502$\n- $D_{\\text{hamming}} = 1.363806... \\to 1.364$\n- $D_{\\text{blackman}} = 1.728484... \\to 1.728$",
            "answer": "$$\n\\boxed{\n\\begin{pmatrix}\n1.000  1.502  1.364  1.728\n\\end{pmatrix}\n}\n$$"
        },
        {
            "introduction": "离散傅里叶变换（DFT）在离散的频率网格上提供信息，但信号的真实频率可能落在网格点之间。本练习将介绍一种经典技术——二次插值法，它利用频谱峰值附近的形状来精确估计正弦波的真实频率，实现亚像素级别的精度。通过推导该方法并分析其在不同窗函数下的表现，你将不仅学会一种高精度频率估计算法，还能进一步理解窗函数的选择如何影响参数估计的准确性。",
            "id": "3618941",
            "problem": "一条窄带微震迹以采样率 $f_{s}$ 采样 $N$ 个样本，并通过离散傅里叶变换 (DFT) 进行分析，以估计主导正弦分量的频率。观测到的时间序列 $x[n]$ 被建模为一个频率 $f_{0}$、振幅 $A$ 和相位 $\\phi$ 未知的单正弦波，该正弦波受到附加噪声的污染，噪声对三个相邻 DFT 频箱的贡献与正弦波峰值相比可以忽略不计。为了获得功率谱密度 (PSD) 估计，时间序列通过一个矩形窗 $w[n]$ 进行加窗，该窗定义为：当 $n=0,1,\\dots,N-1$ 时 $w[n]=1$，否则 $w[n]=0$。然后计算 DFT 为 $X[k]=\\sum_{n=0}^{N-1}x[n]\\exp(-\\mathrm{i}\\,2\\pi kn/N)$。\n\n设 $k$ 为周期图在与 $f_{0}$ 相关的谱峰局部邻域内取得最大值的 DFT 频箱索引，并定义三个局部主导的周期图样本 $P_{k-1}$、$P_{k}$ 和 $P_{k+1}$ 为 $P_{m}=\\left|X[m]\\right|^{2}$，其中 $m\\in\\{k-1,k,k+1\\}$。假设在 $k$ 的邻域内，潜在的无噪声峰形足够平滑，以至于在 $\\{k-1,k,k+1\\}$ 这三个频箱的邻域内，$\\left|X[m]\\right|^{2}$ 的变化可以被近似为一个关于频箱偏移量 $d\\in\\{-1,0,1\\}$ 的凹二次函数。\n\n仅从上述定义和矩形窗在周期图最大值附近引起的局部二次行为的假设出发，使用三个样本 $P_{k-1}$、$P_{k}$、$P_{k+1}$，推导子频箱偏移量 $\\delta$（其中真实频率的频箱索引为 $k+\\delta$，且 $-0.5\\leq\\delta\\leq 0.5$）的闭式二次插值估计器。然后，将相应的频率估计值 $\\hat{f}$（单位为赫兹）表示为关于 $f_{s}$、$N$、$k$、$P_{k-1}$、$P_{k}$ 和 $P_{k+1}$ 的单一解析表达式。\n\n最后，不进行额外的数值计算，讨论为什么当对 DFT 幅度或幅度平方使用此二次插值频率估计器时，应用非矩形窗（例如汉宁窗或汉明窗）会引入偏差。您的讨论应将窗谱主瓣的形状与二次拟合所依据的曲率特性联系起来。\n\n将您最终的频率估计值（单位：Hz）表示为单一的闭式解析表达式。无需四舍五入。",
            "solution": "问题陈述已经过验证，被认为是可靠、适定且具有科学依据的。它提出了一个使用数字信号处理技术进行频率估计的标准问题。我们将按要求进行推导。\n\n任务是推导一个基于周期图峰值二次插值的频率估计器。这包括三个部分：首先，推导子频箱频率偏移的公式；其次，构建最终的频率估计值（单位为赫兹）；第三，讨论非矩形窗对该估计器的影响。\n\n**第一部分：子频箱偏移量 $\\delta$ 的推导**\n\n我们已知在谱峰邻域内，周期图 $P_m = |X[m]|^2$ 可以近似为一个凹二次函数。设 $k$ 为周期图峰值最大样本的整数频箱索引。我们考虑三个相邻的样本 $P_{k-1}$、$P_k$ 和 $P_{k+1}$。设 $d$ 是相对于中心频箱索引 $k$ 的偏移量，因此频箱索引为 $m = k+d$。我们将周期图在局部建模为关于 $d$ 的抛物线：\n$$p(d) = ad^2 + bd + c$$\n该抛物线上的三个已知点对应于 $d \\in \\{-1, 0, 1\\}$：\n1. 当 $d=-1$ 时，我们有 $p(-1) = P_{k-1}$。代入二次函数形式得到：\n   $$a(-1)^2 + b(-1) + c = a - b + c = P_{k-1}$$\n2. 当 $d=0$ 时，我们有 $p(0) = P_{k}$。这得到：\n   $$a(0)^2 + b(0) + c = c = P_k$$\n3. 当 $d=1$ 时，我们有 $p(1) = P_{k+1}$。这得到：\n   $$a(1)^2 + b(1) + c = a + b + c = P_{k+1}$$\n\n我们得到了一个关于系数 $a$、$b$ 和 $c$ 的三元线性方程组。从第二个方程，我们立即得到 $c = P_k$。将此结果代入第一个和第三个方程，得到：\n$$a - b + P_k = P_{k-1} \\implies a - b = P_{k-1} - P_k$$\n$$a + b + P_k = P_{k+1} \\implies a + b = P_{k+1} - P_k$$\n\n我们可以解这个 $2 \\times 2$ 方程组来求 $a$ 和 $b$。将两个方程相加得到：\n$$(a - b) + (a + b) = (P_{k-1} - P_k) + (P_{k+1} - P_k)$$\n$$2a = P_{k-1} + P_{k+1} - 2P_k$$\n$$a = \\frac{1}{2}(P_{k-1} + P_{k+1} - 2P_k)$$\n\n用第二个方程减去第一个方程得到：\n$$(a + b) - (a - b) = (P_{k+1} - P_k) - (P_{k-1} - P_k)$$\n$$2b = P_{k+1} - P_{k-1}$$\n$$b = \\frac{1}{2}(P_{k+1} - P_{k-1})$$\n\n子频箱偏移量，我们记为 $\\delta$，对应于抛物线 $p(d)$ 达到其最大值时的 $d$ 值。为了找到这个最大值，我们对 $p(d)$ 关于 $d$ 求导，并令其为零：\n$$\\frac{dp}{dd} = 2ad + b = 0$$\n求解 $d$ 得到峰值的位置：\n$$\\delta = d_{\\text{max}} = -\\frac{b}{2a}$$\n\n代入我们得到的 $a$ 和 $b$ 的表达式：\n$$\\delta = -\\frac{\\frac{1}{2}(P_{k+1} - P_{k-1})}{2 \\left( \\frac{1}{2}(P_{k-1} + P_{k+1} - 2P_k) \\right)} = -\\frac{P_{k+1} - P_{k-1}}{2(P_{k-1} + P_{k+1} - 2P_k)}$$\n通过对分子和分母同时取负，可以将其写成更常规的形式：\n$$\\delta = \\frac{P_{k-1} - P_{k+1}}{2(P_{k-1} - 2P_k + P_{k+1})}$$\n这就是子频箱偏移量 $\\delta$ 的闭式表达式。根据定义，$\\delta$ 的范围是 $[-0.5, 0.5]$，因为 $k$ 是局部三元组中幅度最大的频箱。\n\n**第二部分：频率估计值 $\\hat{f}$ 的表达式**\n\n对应于 DFT 频箱索引 $m$ 的频率由 $f = \\frac{m \\cdot f_s}{N}$ 给出，其中 $f_s$ 是采样频率， $N$ 是样本数。我们修正后的真实频箱索引估计值为 $k + \\delta$。因此，估计的频率 $\\hat{f}$ 为：\n$$\\hat{f} = (k + \\delta) \\frac{f_s}{N}$$\n代入我们推导出的 $\\delta$ 的表达式：\n$$\\hat{f} = \\left( k + \\frac{P_{k-1} - P_{k+1}}{2(P_{k-1} - 2P_k + P_{k+1})} \\right) \\frac{f_s}{N}$$\n这就是频率估计的最终解析表达式。\n\n**第三部分：关于非矩形窗引入偏差的讨论**\n\n上述推导严重依赖于一个关键假设：周期图在其峰值附近可以被二次函数精确建模。对于单个正弦波，周期图峰值的形状由窗函数的傅里叶变换的幅度平方决定，该变换以正弦波的频率为中心。\n\n对于矩形窗，其傅里叶变换是一个 sinc 函数，其幅度平方 $|S(f)|^2 \\propto \\text{sinc}^2\\left(\\pi (f-f_0) T\\right)$，其中 $T$ 是窗的持续时间。$\\text{sinc}^2$ 函数的峰值在其最大值附近非常接近抛物线。因此，对于用矩形窗加窗的信号，二次插值估计器非常精确，因为模型假设很好地成立。可以认为该估计器是针对 $\\text{sinc}^2$ 函数主瓣的特定曲率进行“调谐”的。\n\n非矩形窗，例如汉宁窗或汉明窗，其边缘是锥形的，以减少频谱泄漏（即降低其频率响应中的旁瓣）。然而，这种锥形处理的副作用是加宽了窗谱的主瓣。这些更宽的主瓣（例如，对于汉宁窗）的形状在数学上与 $\\text{sinc}^2$ 函数不同。特别是，其峰值比 $\\text{sinc}^2$ 峰值更“平坦”。\n\n这种形状上的差异意味着，与矩形窗相比，二次函数对于由汉宁窗或汉明窗生成的周期图峰值的近似效果更差。峰值的“平坦性”意味着最大值处的曲率（二阶导数）的绝对值更小。我们用于 $\\delta$ 的估计器中的项 $P_{k-1} - 2P_k + P_{k+1}$ 是周期图二阶导数的有限差分近似。当使用汉宁窗时，对于给定的真实子频箱偏移，该项的值将不同于使用矩形窗时的值，因为其主瓣更宽且曲率更小。\n\n将为 $\\text{sinc}^2$ 函数的曲率隐式推导出的 $\\delta$ 公式应用于来自非矩形窗的周期图样本，将导致 $\\delta$ 估计值出现系统性误差。该误差取决于频率的真实子频箱位置，因此是一种偏差。如果真实频率正好落在频箱中心（$\\delta=0$），由于对称性（$P_{k-1} = P_{k+1}$），估计器将是无偏的。然而，对于任何其他位置（例如，$\\delta=0.5$），假设的二次形状与实际主瓣形状之间的不匹配将导致有偏估计 $\\hat{\\delta} \\neq \\delta$。总之，二次插值公式是针对矩形窗的频谱形状而定的，将其应用于其他窗的数据会引入偏差，因为它们的主瓣形状和曲率不满足模型的基本假设。",
            "answer": "$$\n\\boxed{\\hat{f} = \\left( k + \\frac{P_{k-1} - P_{k+1}}{2(P_{k-1} - 2P_k + P_{k+1})} \\right) \\frac{f_s}{N}}\n$$"
        }
    ]
}